/*! For license information please see 7465.df174388.js.LICENSE.txt */
(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[7465],{5251:function(e,t,n){"use strict";n(7418);var i=n(7294),r=60103;if(60107,"function"==typeof Symbol&&Symbol.for){var o=Symbol.for;r=o("react.element"),o("react.fragment")}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,c={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var i,o={},u=null,d=null;for(i in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(d=t.ref),t)s.call(t,i)&&!c.hasOwnProperty(i)&&(o[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===o[i]&&(o[i]=t[i]);return{$$typeof:r,type:e,key:u,ref:d,props:o,_owner:a.current}}t.jsx=u,t.jsxs=u},5893:function(e,t,n){"use strict";e.exports=n(5251)},7465:function(e,t,n){"use strict";n.d(t,{hG:function(){return Ny},xd:function(){return My}});var i,r=n(7294),o=n(3935),a=n(5893),s=Object.defineProperty,c=Object.defineProperties,u=Object.getOwnPropertyDescriptors,d=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,m=(e,t,n)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&m(e,n,t[n]);if(d)for(var n of d(t))p.call(t,n)&&m(e,n,t[n]);return e},h=(e,t)=>c(e,u(t)),v=(e,t)=>{var n={};for(var i in e)l.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&d)for(var i of d(e))t.indexOf(i)<0&&p.call(e,i)&&(n[i]=e[i]);return n},g="colors",I="sizes",y="space",w={gap:y,gridGap:y,columnGap:y,gridColumnGap:y,rowGap:y,gridRowGap:y,inset:y,insetBlock:y,insetBlockEnd:y,insetBlockStart:y,insetInline:y,insetInlineEnd:y,insetInlineStart:y,margin:y,marginTop:y,marginRight:y,marginBottom:y,marginLeft:y,marginBlock:y,marginBlockEnd:y,marginBlockStart:y,marginInline:y,marginInlineEnd:y,marginInlineStart:y,padding:y,paddingTop:y,paddingRight:y,paddingBottom:y,paddingLeft:y,paddingBlock:y,paddingBlockEnd:y,paddingBlockStart:y,paddingInline:y,paddingInlineEnd:y,paddingInlineStart:y,top:y,right:y,bottom:y,left:y,scrollMargin:y,scrollMarginTop:y,scrollMarginRight:y,scrollMarginBottom:y,scrollMarginLeft:y,scrollMarginX:y,scrollMarginY:y,scrollMarginBlock:y,scrollMarginBlockEnd:y,scrollMarginBlockStart:y,scrollMarginInline:y,scrollMarginInlineEnd:y,scrollMarginInlineStart:y,scrollPadding:y,scrollPaddingTop:y,scrollPaddingRight:y,scrollPaddingBottom:y,scrollPaddingLeft:y,scrollPaddingX:y,scrollPaddingY:y,scrollPaddingBlock:y,scrollPaddingBlockEnd:y,scrollPaddingBlockStart:y,scrollPaddingInline:y,scrollPaddingInlineEnd:y,scrollPaddingInlineStart:y,fontSize:"fontSizes",background:g,backgroundColor:g,backgroundImage:g,borderImage:g,border:g,borderBlock:g,borderBlockEnd:g,borderBlockStart:g,borderBottom:g,borderBottomColor:g,borderColor:g,borderInline:g,borderInlineEnd:g,borderInlineStart:g,borderLeft:g,borderLeftColor:g,borderRight:g,borderRightColor:g,borderTop:g,borderTopColor:g,caretColor:g,color:g,columnRuleColor:g,fill:g,outline:g,outlineColor:g,stroke:g,textDecorationColor:g,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:I,minBlockSize:I,maxBlockSize:I,inlineSize:I,minInlineSize:I,maxInlineSize:I,width:I,minWidth:I,maxWidth:I,height:I,minHeight:I,maxHeight:I,flexBasis:I,gridTemplateColumns:I,gridTemplateRows:I,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},U=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,b=()=>{const e=Object.create(null);return(t,n,...i)=>{const r=(o=t,JSON.stringify(o,U));var o;return r in e?e[r]:e[r]=n(t,...i)}},S=Symbol.for("sxs.internal"),P=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),D=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:N}=Object.prototype,M=e=>e.includes("-")?e:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),T=/\s+(?![^()]*\))/,E=e=>t=>e(..."string"==typeof t?String(t).split(T):[t]),A={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:E(((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e}))),marginInline:E(((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e}))),maxSize:E(((e,t)=>({maxBlockSize:e,maxInlineSize:t||e}))),minSize:E(((e,t)=>({minBlockSize:e,minInlineSize:t||e}))),paddingBlock:E(((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e}))),paddingInline:E(((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e})))},R=/([\d.]+)([^]*)/,C=(e,t)=>e.length?e.reduce(((e,n)=>(e.push(...t.map((e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(e)?`:is(${n})`:n):n+" "+e))),e)),[]):t,x=(e,t)=>e in O&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,n,i,r)=>n+("stretch"===i?`-moz-available${r};${M(e)}:${n}-webkit-fill-available`:`-moz-fit-content${r};${M(e)}:${n}fit-content`)+r)):String(t),O={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},k=e=>e?e+"-":"",F=(e,t,n)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((e,i,r,o,a)=>"$"==o==!!r?e:(i||"--"==o?"calc(":"")+"var(--"+("$"===o?k(t)+(a.includes("$")?"":k(n))+a.replace(/\$/g,"-"):a)+")"+(i||"--"==o?"*"+(i||"")+(r||"1")+")":""))),L=/\s*,\s*(?![^()]*\))/,j=Object.prototype.toString,B=(e,t,n,i,r)=>{let o,a,s;const c=(e,t,n)=>{let u,d;const l=e=>{for(u in e){const f=64===u.charCodeAt(0),h=f&&Array.isArray(e[u])?e[u]:[e[u]];for(d of h){const e=/[A-Z]/.test(m=u)?m:m.replace(/-[^]/g,(e=>e[1].toUpperCase())),h="object"==typeof d&&d&&d.toString===j&&(!i.utils[e]||!t.length);if(e in i.utils&&!h){const t=i.utils[e];if(t!==a){a=t,l(t(d)),a=null;continue}}else if(e in A){const t=A[e];if(t!==s){s=t,l(t(d)),s=null;continue}}if(f&&(p=u.slice(1)in i.media?"@media "+i.media[u.slice(1)]:u,u=p.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((e,t,n,i,r,o)=>{const a=R.test(t),s=.0625*(a?-1:1),[c,u]=a?[i,t]:[t,i];return"("+("="===n[0]?"":">"===n[0]===a?"max-":"min-")+c+":"+("="!==n[0]&&1===n.length?u.replace(R,((e,t,i)=>Number(t)+s*(">"===n?1:-1)+i)):u)+(r?") and ("+(">"===r[0]?"min-":"max-")+c+":"+(1===r.length?o.replace(R,((e,t,n)=>Number(t)+s*(">"===r?-1:1)+n)):o):"")+")"}))),h){const e=f?n.concat(u):[...n],i=f?[...t]:C(t,u.split(L));void 0!==o&&r(V(...o)),o=void 0,c(d,i,e)}else void 0===o&&(o=[[],t,n]),u=f||36!==u.charCodeAt(0)?u:`--${k(i.prefix)}${u.slice(1).replace(/\$/g,"-")}`,d=h?d:"number"==typeof d?d&&e in $?String(d)+"px":String(d):F(x(e,null==d?"":d),i.prefix,i.themeMap[e]),o[0].push(`${f?`${u} `:`${M(u)}:`}${d}`)}}var p,m};l(e),void 0!==o&&r(V(...o)),o=void 0};c(e,t,n)},V=(e,t,n)=>`${n.map((e=>`${e}{`)).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(n.length?n.length+1:0).join("}")}`,$={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},G=e=>String.fromCharCode(e+(e>25?39:97)),_=e=>(e=>{let t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=G(t%52)+n;return G(t%52)+n})(((e,t)=>{let n=t.length;for(;n;)e=33*e^t.charCodeAt(--n);return e})(5381,JSON.stringify(e))>>>0),W=b(),q=(e,t)=>W(e,(()=>(...n)=>{let i={type:null,composers:new Set};for(const t of n)if(null!=t)if(t[S]){null==i.type&&(i.type=t[S].type);for(const e of t[S].composers)i.composers.add(e)}else t.constructor!==Object||t.$$typeof?null==i.type&&(i.type=t):i.composers.add(z(t,e));return null==i.type&&(i.type="span"),i.composers.size||i.composers.add(["PJLV",{},[],[],{},[]]),H(e,i,t)})),z=(e,t)=>{var n=e,{variants:i,compoundVariants:r,defaultVariants:o}=n,a=v(n,["variants","compoundVariants","defaultVariants"]);const s=`${k(t.prefix)}c-${_(a)}`,c=[],u=[],d=Object.create(null),l=[];for(const f in o)d[f]=String(o[f]);if("object"==typeof i&&i)for(const f in i){p=d,m=f,N.call(p,m)||(d[f]="undefined");const e=i[f];for(const t in e){const n={[f]:String(t)};"undefined"===String(t)&&l.push(f);const i=e[t],r=[n,i,!D(i)];c.push(r)}}var p,m;if("object"==typeof r&&r)for(const f of r){let e=f,{css:t}=e,n=v(e,["css"]);t="object"==typeof t&&t||{};for(const r in n)n[r]=String(n[r]);const i=[n,t,!D(t)];u.push(i)}return[s,a,c,u,d,l]},H=(e,t,n)=>{const[i,r,o,a]=K(t.composers),s=`.${i}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,c=c=>{const u=c="object"==typeof c&&c||J,{css:d}=u,l=v(u,["css"]),p={};for(const e in o)if(delete l[e],e in c){let t=c[e];"object"==typeof t&&t?p[e]=f({"@initial":o[e]},t):(t=String(t),p[e]="undefined"!==t||a.has(e)?t:o[e])}else p[e]=o[e];const m=new Set([...r]);for(const[i,r,o,a]of t.composers){n.rules.styled.cache.has(i)||(n.rules.styled.cache.add(i),B(r,[`.${i}`],[],e,(e=>{n.rules.styled.apply(e)})));const t=Y(o,p,e.media),s=Y(a,p,e.media,!0);for(const r of t)if(void 0!==r)for(const[t,o]of r){const r=`${i}-${_(o)}-${t}`;m.add(r),n.rules.onevar.cache.has(r)||(n.rules.onevar.cache.add(r),B(o,[`.${r}`],[],e,(e=>{n.rules.onevar.apply(e)})))}for(const r of s)if(void 0!==r)for(const[t,o]of r){const r=`${i}-${_(o)}-${t}`;m.add(r),n.rules.allvar.cache.has(r)||(n.rules.allvar.cache.add(r),B(o,[`.${r}`],[],e,(e=>{n.rules.allvar.apply(e)})))}}if("object"==typeof d&&d){const t=`${i}-i${_(d)}-css`;m.add(t),n.rules.inline.cache.has(t)||(n.rules.inline.cache.add(t),B(d,[`.${t}`],[],e,(e=>{n.rules.inline.apply(e)})))}for(const e of String(c.className||"").trim().split(/\s+/))e&&m.add(e);const h=l.className=[...m].join(" ");return{type:t.type,className:h,selector:s,props:l,toString:()=>h}};return P(c,{className:i,selector:s,[S]:t,toString:()=>(n.rules.styled.cache.has(i)||c(),i)})},K=e=>{let t="";const n=[],i={},r=[];for(const[o,,,,a,s]of e){""===t&&(t=o),n.push(o),r.push(...s);for(const e in a){const t=a[e];(void 0===i[e]||"undefined"!==t||s.includes(t))&&(i[e]=t)}}return[t,n,i,new Set(r)]},Y=(e,t,n,i)=>{const r=[];e:for(let[o,a,s]of e){if(s)continue;let e,c=0;for(e in o){const i=o[e];let r=t[e];if(r!==i){if("object"!=typeof r||!r)continue e;{let e,t=0;for(const o in r)i===String(r[o])&&("@initial"!==o&&(a={[o in n?n[o]:o]:a}),c+=t,e=!0),++t;if(!e)continue e}}}(r[c]=r[c]||[]).push([i?"cv":`${e}-${o[e]}`,a])}return r},J={},Z=b(),Q=(e,t)=>Z(e,(()=>(...n)=>{const i=()=>{for(let i of n){i="object"==typeof i&&i||{};let n=_(i);if(!t.rules.global.cache.has(n)){if(t.rules.global.cache.add(n),"@import"in i){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let n of[].concat(i["@import"]))n=n.includes('"')||n.includes("'")?n:`"${n}"`,t.sheet.insertRule(`@import ${n};`,e++);delete i["@import"]}B(i,[],[],e,(e=>{t.rules.global.apply(e)}))}}return""};return P(i,{toString:i})})),X=b(),ee=(e,t)=>X(e,(()=>n=>{const i=`${k(e.prefix)}k-${_(n)}`,r=()=>{if(!t.rules.global.cache.has(i)){t.rules.global.cache.add(i);const r=[];B(n,[],[],e,(e=>r.push(e)));const o=`@keyframes ${i}{${r.join("")}}`;t.rules.global.apply(o)}return i};return P(r,{get name(){return r()},toString:r})})),te=class{constructor(e,t,n,i){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==n?"":String(n),this.prefix=null==i?"":String(i)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+k(this.prefix)+k(this.scale)+this.token}toString(){return this.computedValue}},ne=b(),ie=(e,t)=>ne(e,(()=>(n,i)=>{i="object"==typeof n&&n||Object(i);const r=`.${n=(n="string"==typeof n?n:"")||`${k(e.prefix)}t-${_(i)}`}`,o={},a=[];for(const t in i){o[t]={};for(const n in i[t]){const r=`--${k(e.prefix)}${t}-${n}`,s=F(String(i[t][n]),e.prefix,t);o[t][n]=new te(n,s,t,e.prefix),a.push(`${r}:${s}`)}}const s=()=>{if(a.length&&!t.rules.themed.cache.has(n)){t.rules.themed.cache.add(n);const r=`${i===e.theme?":root,":""}.${n}{${a.join(";")}}`;t.rules.themed.apply(r)}return n};return h(f({},o),{get className(){return s()},selector:r,toString:s})})),re=["themed","global","styled","onevar","allvar","inline"],oe=e=>{let t;const n=()=>{if(t){const{rules:e,sheet:n}=t;if(!n.deleteRule){for(;3===Object(Object(n.cssRules)[0]).type;)n.cssRules.splice(0,1);n.cssRules=[]}for(const t in e)delete e[t];n.ownerRule&&(n.ownerRule.textContent=n.ownerRule.textContent)}const i=Object(e).styleSheets||[];for(const e of i)if(!e.href||e.href.startsWith(location.origin)){for(let i=0,r=e.cssRules;r[i];++i){const o=Object(r[i]);if(1!==o.type)continue;const a=Object(r[i+1]);if(4!==a.type)continue;++i;const{cssText:s}=o;if(!s.startsWith("--sxs"))continue;const c=s.slice(14,-3).trim().split(/\s+/),u=re[c[0]];u&&(t||(t={sheet:e,reset:n,rules:{}}),t.rules[u]={group:a,index:i,cache:new Set(c)})}if(t)break}if(!t){const i=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,i(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,(e=>e.cssText)).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:i("","text/css"),rules:{},reset:n,toString(){const{cssRules:e}=t.sheet;return[].map.call(e,((n,i)=>{const{cssText:r}=n;let o="";if(r.startsWith("--sxs"))return"";if(e[i-1]&&(o=e[i-1].cssText).startsWith("--sxs")){if(!n.cssRules.length)return"";for(const e in t.rules)if(t.rules[e].group===n)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${r}`;return n.cssRules.length?`${o}${r}`:""}return r})).join("")}}}const{sheet:r,rules:o}=t;if(!o.inline){const e=r.cssRules.length;r.insertRule("@media{}",e),r.insertRule("--sxs{--sxs:5}",e),o.inline={index:e,group:r.cssRules[e+1],cache:new Set([5])}}if(ae(o.inline),!o.allvar){const e=o.inline.index;r.insertRule("@media{}",e),r.insertRule("--sxs{--sxs:4}",e),o.allvar={index:e,group:r.cssRules[e+1],cache:new Set([4])}}if(ae(o.allvar),!o.onevar){const e=o.allvar.index;r.insertRule("@media{}",e),r.insertRule("--sxs{--sxs:3}",e),o.onevar={index:e,group:r.cssRules[e+1],cache:new Set([3])}}if(ae(o.onevar),!o.styled){const e=o.onevar.index;r.insertRule("@media{}",e),r.insertRule("--sxs{--sxs:2}",e),o.styled={index:e,group:r.cssRules[e+1],cache:new Set([2])}}if(ae(o.styled),!o.global){const e=o.styled.index;r.insertRule("@media{}",e),r.insertRule("--sxs{--sxs:1}",e),o.global={index:e,group:r.cssRules[e+1],cache:new Set([1])}}if(ae(o.global),!o.themed){const e=o.global.index;r.insertRule("@media{}",e),r.insertRule("--sxs{--sxs:0}",e),o.themed={index:e,group:r.cssRules[e+1],cache:new Set([0])}}ae(o.themed)};return n(),t},ae=e=>{const t=e.group;let n=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,n),++n}catch{}}},se=b(),ce=b(),ue=e=>{const t=(e=>{let t=!1;const n=se(e,(e=>{t=!0;const n="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",i="object"==typeof e.media&&e.media||{},r="object"==typeof e.root?e.root||null:globalThis.document||null,o="object"==typeof e.theme&&e.theme||{},a={prefix:n,media:i,theme:o,themeMap:"object"==typeof e.themeMap&&e.themeMap||f({},w),utils:"object"==typeof e.utils&&e.utils||{}},s=oe(r),c={css:q(a,s),globalCss:Q(a,s),keyframes:ee(a,s),createTheme:ie(a,s),reset(){s.reset(),c.theme.toString()},theme:{},sheet:s,config:a,prefix:n,getCssText:s.toString,toString:s.toString};return String(c.theme=c.createTheme(o)),c}));return t||n.reset(),n})(e);return t.styled=(({config:e,sheet:t})=>ce(e,(()=>{const n=q(e,t);return(...e)=>{const t=n(...e),i=t[S].type,o=r.forwardRef(((e,n)=>{const o=e&&e.as||i,a=t(e).props;return delete a.as,a.ref=n,r.createElement(o,a)}));return o.className=t.className,o.displayName=`Styled.${i.displayName||i.name||i}`,o.selector=t.selector,o.toString=()=>t.selector,o[S]=t[S],o}})))(t),t},de=()=>i||(i=ue()),le=(...e)=>de().keyframes(...e),pe=(...e)=>de().css(...e),me=(...e)=>de().styled(...e);const{createTheme:fe}=ue({theme:{borderWidths:{matchUp:"1px",matchUpInline:"1px 1px",factor:2},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},matchUp:{borderInlineStart:"1px 1px"},colors:{backgroundColor:"white",border:"darkgray",borderInlineStart:"darkgray",internalDividers:"lightgray",color:"black"},participant:{textTransform:"capitalize",seed:"gray"},score:{setWidth:"1.5rem"}}}),he=fe("australian-theme",{colors:{connector:"#999",borderHover:"#0091d2"}}),ve=fe("wimbledon-theme",{borderWidths:{matchUpInline:"10px 1px"},matchUp:{borderInlineStart:"10px solid green"},colors:{backgroundColor:"#00703c",connector:"transparent",borderHover:"lightgray",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),ge=fe("french-theme",{colors:{winner:"#01503d!important",winnerName:"#01503d!important",borderHover:"#0091d2",connector:"lightgray",borderInlineStart:"#F8F9F9",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),Ie=fe("usopen-theme",{colors:{connector:"#999",borderHover:"#0091d2",internalDividers:"darkgray",matchUpBackgroundColor:"#F8F9F9"}}),ye=fe("basic-theme",{colors:{winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999",internalDividers:"transparent"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),we=fe("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),Ue={Australian:{name:"oz",theme:he,configuration:{id:"A",flags:!0}},Basic:{name:"basic",theme:ye,configuration:{gameScoreOnly:!0,teamLogo:!1}},French:{name:"fr",theme:ge,configuration:{id:"F",bracketedSeeds:!0,flags:!0}},Wimbledon:{name:"gb",theme:ve,configuration:{id:"W",resultsInfo:!0,flags:!0}},"US Open":{name:"us",theme:Ie,configuration:{id:"U",scoreBox:!0,flags:!0}},ITF:{name:"itf",theme:fe("itf-theme",{borderWidths:{centerInfo:1,factor:1},colors:{backgroundColor:"lightgray",connector:"#999",borderHover:"#0091d2",matchUp:"#fff"},participant:{textTransform:"capitalize",seed:"gray"}}),configuration:{id:"I",centerInfo:30,winnerChevron:!0,flags:!0}},National:{name:"ngb",theme:he,configuration:{id:"U",bracketedSeeds:"square",drawPositions:!0,showAddress:!0,scheduleInfo:30}},Night:{name:"xx",theme:we,configuration:{id:"N",flags:!0}}};function be(e,t){const n=r.createContext(t);function i(e){const t=e,{children:i}=t,o=v(t,["children"]),a=r.useMemo((()=>o),Object.values(o));return r.createElement(n.Provider,{value:a},i)}return i.displayName=e+"Provider",[i,function(i){const o=r.useContext(n);if(o)return o;if(void 0!==t)return t;throw new Error(`\`${i}\` must be used within \`${e}\``)}]}function Se(e,t=[]){let n=[];const i=()=>{const t=n.map((e=>r.createContext(e)));return function(n){const i=(null==n?void 0:n[e])||t;return r.useMemo((()=>({[`__scope${e}`]:h(f({},n),{[e]:i})})),[n,i])}};return i.scopeName=e,[function(t,i){const o=r.createContext(i),a=n.length;function s(t){const n=t,{scope:i,children:s}=n,c=v(n,["scope","children"]),u=(null==i?void 0:i[e][a])||o,d=r.useMemo((()=>c),Object.values(c));return r.createElement(u.Provider,{value:d},s)}return n=[...n,i],s.displayName=t+"Provider",[s,function(n,s){const c=(null==s?void 0:s[e][a])||o,u=r.useContext(c);if(u)return u;if(void 0!==i)return i;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},Pe(i,...t)]}function Pe(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const i=n.reduce(((t,{useScope:n,scopeName:i})=>f(f({},t),n(e)[`__scope${i}`])),{});return r.useMemo((()=>({[`__scope${t.scopeName}`]:i})),[i])}};return n.scopeName=t.scopeName,n}function De(){return(De=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}const Ne={prefix:Math.round(1e10*Math.random()),current:0},[Me,Te]=be("IdProvider",Ne);function Ee(e){const t=Te("IdProviderConsumer");return Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)||t!==Ne||console.warn("When server rendering, you must wrap your application in an <IdProvider> to ensure consistent ids are generated between the client and server."),r.useMemo((()=>e||`radix-id-${t.prefix}-${++t.current}`),[e])}let Ae=0;function Re(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}function Ce(e){const t=r.useRef(e);return r.useEffect((()=>{t.current=e})),r.useMemo((()=>(...e)=>{var n;return null===(n=t.current)||void 0===n?void 0:n.call(t,...e)}),[])}function xe({prop:e,defaultProp:t,onChange:n=(()=>{})}){const[i,o]=function({defaultProp:e,onChange:t}){const n=r.useState(e),[i]=n,o=r.useRef(i),a=Ce(t);return r.useEffect((()=>{o.current!==i&&(a(i),o.current=i)}),[i,o,a]),n}({defaultProp:t,onChange:n}),a=void 0!==e,s=a?e:i,c=Ce(n);return[s,r.useCallback((t=>{if(a){const n=t,i="function"==typeof t?n(e):t;i!==e&&c(i)}else o(t)}),[a,e,o,c])]}function Oe(...e){return t=>e.forEach((e=>{return i=t,void("function"==typeof(n=e)?n(i):null!=n&&(n.current=i));var n,i}))}function ke(...e){return r.useCallback(Oe(...e),e)}const Fe=r.forwardRef(((e,t)=>{const n=e,{children:i}=n,o=v(n,["children"]),a=r.Children.toArray(i);return a.some(Be)?r.createElement(r.Fragment,null,a.map((e=>Be(e)?r.createElement(Le,De({},o,{ref:t}),e.props.children):e))):r.createElement(Le,De({},o,{ref:t}),i)}));Fe.displayName="Slot";const Le=r.forwardRef(((e,t)=>{const n=e,{children:i}=n,o=v(n,["children"]);return r.isValidElement(i)?r.cloneElement(i,h(f({},function(e,t){const n=f({},t);for(const i in t){const r=e[i],o=t[i];/^on[A-Z]/.test(i)?n[i]=(...e)=>{null==o||o(...e),null==r||r(...e)}:"style"===i?n[i]=f(f({},r),o):"className"===i&&(n[i]=[r,o].filter(Boolean).join(" "))}return f(f({},e),n)}(o,i.props)),{ref:Oe(t,i.ref)})):r.Children.count(i)>1?r.Children.only(null):null}));Le.displayName="SlotClone";const je=({children:e})=>r.createElement(r.Fragment,null,e);function Be(e){return r.isValidElement(e)&&e.type===je}const Ve=["a","button","div","h2","h3","img","li","nav","p","span","svg","ul"].reduce(((e,t)=>h(f({},e),{[t]:r.forwardRef(((e,n)=>{const i=e,{asChild:o}=i,a=v(i,["asChild"]),s=o?Fe:t;return r.useEffect((()=>{window[Symbol.for("radix-ui")]=!0}),[]),e.as&&console.error($e),r.createElement(s,De({},a,{ref:n}))}))})),{}),$e="Warning: The `as` prop has been removed in favour of `asChild`. For details, see https://radix-ui.com/docs/primitives/overview/styling#changing-the-rendered-element";function Ge(e){const t=e+"CollectionProvider",[n,i]=Se(t),[o,a]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e+"CollectionSlot",c=e+"CollectionItemSlot",u="data-radix-collection-item";return[{Provider:e=>{const{scope:t,children:n}=e,i=r.useRef(null),a=r.useRef(new Map).current;return r.createElement(o,{scope:t,itemMap:a,collectionRef:i},n)},Slot:r.forwardRef(((e,t)=>{const{scope:n,children:i}=e,o=ke(t,a(s,n).collectionRef);return r.createElement(Fe,{ref:o},i)})),ItemSlot:r.forwardRef(((e,t)=>{const n=e,{scope:i,children:o}=n,s=v(n,["scope","children"]),d=r.useRef(null),l=ke(t,d),p=a(c,i);return r.useEffect((()=>(p.itemMap.set(d,f({ref:d},s)),()=>{p.itemMap.delete(d)}))),r.createElement(Fe,{[u]:"",ref:l},o)}))},function(t){const n=a(e+"CollectionConsumer",t);return r.useCallback((()=>{const e=n.collectionRef.current;if(!e)return[];const t=Array.from(e.querySelectorAll(`[${u}]`));return Array.from(n.itemMap.values()).sort(((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current)))}),[n.collectionRef,n.itemMap])},i]}function _e(e,t,{checkForDefaultPrevented:n=!0}={}){return function(i){if(null==e||e(i),!1===n||!i.defaultPrevented)return null==t?void 0:t(i)}}const We={bubbles:!1,cancelable:!0},[qe,ze,He]=Ge("RovingFocusGroup"),[Ke,Ye]=Se("RovingFocusGroup",[He]),[Je,Ze]=Ke("RovingFocusGroup"),Qe=r.forwardRef(((e,t)=>r.createElement(qe.Provider,{scope:e.__scopeRovingFocusGroup},r.createElement(qe.Slot,{scope:e.__scopeRovingFocusGroup},r.createElement(Xe,De({},e,{ref:t})))))),Xe=r.forwardRef(((e,t)=>{const n=e,{__scopeRovingFocusGroup:i,orientation:o,dir:a="ltr",loop:s=!1,currentTabStopId:c,defaultCurrentTabStopId:u,onCurrentTabStopIdChange:d,onEntryFocus:l}=n,p=v(n,["__scopeRovingFocusGroup","orientation","dir","loop","currentTabStopId","defaultCurrentTabStopId","onCurrentTabStopIdChange","onEntryFocus"]),m=r.useRef(null),h=ke(t,m),[g=null,I]=xe({prop:c,defaultProp:u,onChange:d}),[y,w]=r.useState(!1),U=Ce(l),b=ze(i),S=r.useRef(!1);return r.useEffect((()=>{const e=m.current;if(e)return e.addEventListener("rovingFocusGroup.onEntryFocus",U),()=>e.removeEventListener("rovingFocusGroup.onEntryFocus",U)}),[U]),r.createElement(Je,{scope:i,orientation:o,dir:a,loop:s,currentTabStopId:g,onItemFocus:r.useCallback((e=>I(e)),[I]),onItemShiftTab:r.useCallback((()=>w(!0)),[])},r.createElement(Ve.div,De({tabIndex:y?-1:0,"aria-orientation":o,"data-orientation":o},p,{ref:h,style:f({outline:"none"},e.style),onMouseDown:_e(e.onMouseDown,(()=>{S.current=!0})),onFocus:_e(e.onFocus,(e=>{const t=!S.current;if(e.target===e.currentTarget&&t&&!y){const t=new Event("rovingFocusGroup.onEntryFocus",We);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){const e=b().filter((e=>e.focusable));nt([e.find((e=>e.active)),e.find((e=>e.id===g)),...e].filter(Boolean).map((e=>e.ref.current)))}}S.current=!1})),onBlur:_e(e.onBlur,(()=>w(!1)))})))})),et=r.forwardRef(((e,t)=>{const n=e,{__scopeRovingFocusGroup:i,focusable:o=!0,active:a=!1}=n,s=v(n,["__scopeRovingFocusGroup","focusable","active"]),c=Ee(),u=Ze("RovingFocusGroupItem",i),d=u.currentTabStopId===c,l=ze(i);return r.createElement(qe.ItemSlot,{scope:i,id:c,focusable:o,active:a},r.createElement(Ve.span,De({tabIndex:d?0:-1,"data-orientation":u.orientation},s,{ref:t,onMouseDown:_e(e.onMouseDown,(e=>{o?u.onItemFocus(c):e.preventDefault()})),onFocus:_e(e.onFocus,(()=>u.onItemFocus(c))),onKeyDown:_e(e.onKeyDown,(e=>{if("Tab"===e.key&&e.shiftKey)return void u.onItemShiftTab();if(e.target!==e.currentTarget)return;const t=function(e,t,n){const i=(r=e.key,"rtl"!==n?r:"ArrowLeft"===r?"ArrowRight":"ArrowRight"===r?"ArrowLeft":r);var r;return"vertical"===t&&["ArrowLeft","ArrowRight"].includes(i)||"horizontal"===t&&["ArrowUp","ArrowDown"].includes(i)?void 0:tt[i]}(e,u.orientation,u.dir);if(void 0!==t){e.preventDefault();let r=l().filter((e=>e.focusable)).map((e=>e.ref.current));if("last"===t)r.reverse();else if("prev"===t||"next"===t){"prev"===t&&r.reverse();const o=r.indexOf(e.currentTarget);r=u.loop?(i=o+1,(n=r).map(((e,t)=>n[(i+t)%n.length]))):r.slice(o+1)}setTimeout((()=>nt(r)))}var n,i}))})))})),tt={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function nt(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}const it=Qe,rt=et,ot=Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)?r.useLayoutEffect:()=>{},at=r.forwardRef(((e,t)=>{var n,i;const a=e,{containerRef:s,style:c}=a,u=v(a,["containerRef","style"]),d=null!==(n=null==s?void 0:s.current)&&void 0!==n?n:null===globalThis||void 0===globalThis||null===(i=globalThis.document)||void 0===i?void 0:i.body,[,l]=r.useState({});return ot((()=>{l({})}),[]),d?o.createPortal(r.createElement(Ve.div,De({"data-radix-portal":""},u,{ref:t,style:d===document.body?f({position:"absolute",top:0,left:0,zIndex:2147483647},c):void 0})),d):null})),st=r.forwardRef(((e,t)=>{const n=e,{children:i,width:o=10,height:a=5}=n,s=v(n,["children","width","height"]);return r.createElement(Ve.svg,De({},s,{ref:t,width:o,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),e.asChild?i:r.createElement("polygon",{points:"0,0 30,0 15,10"}))}));function ct(e){const[t,n]=r.useState(void 0);return r.useEffect((()=>{if(e){const t=new ResizeObserver((t=>{if(!Array.isArray(t))return;if(!t.length)return;const i=t[0];let r,o;if("borderBoxSize"in i){const e=i.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,o=t.blockSize}else{const t=e.getBoundingClientRect();r=t.width,o=t.height}n({width:r,height:o})}));return t.observe(e,{box:"border-box"}),()=>{n(void 0),t.unobserve(e)}}}),[e]),t}let ut;const dt=new Map;function lt(){const e=[];dt.forEach(((t,n)=>{const i=n.getBoundingClientRect();var r,o;o=i,((r=t.rect).width!==o.width||r.height!==o.height||r.top!==o.top||r.right!==o.right||r.bottom!==o.bottom||r.left!==o.left)&&(t.rect=i,e.push(t))})),e.forEach((e=>{e.callbacks.forEach((t=>t(e.rect)))})),ut=requestAnimationFrame(lt)}function pt(e){const[t,n]=r.useState();return r.useEffect((()=>{if(e){const t=function(e,t){const n=dt.get(e);return void 0===n?(dt.set(e,{rect:{},callbacks:[t]}),1===dt.size&&(ut=requestAnimationFrame(lt))):(n.callbacks.push(t),t(e.getBoundingClientRect())),()=>{const n=dt.get(e);if(void 0===n)return;const i=n.callbacks.indexOf(t);i>-1&&n.callbacks.splice(i,1),0===n.callbacks.length&&(dt.delete(e),0===dt.size&&cancelAnimationFrame(ut))}}(e,n);return()=>{n(void 0),t()}}}),[e]),t}function mt(e,t,n){const i=e["x"===n?"left":"top"],r="x"===n?"width":"height",o=e[r],a=t[r];return{before:i-a,start:i,center:i+(o-a)/2,end:i+o-a,after:i+o}}function ft(e){return{position:"absolute",top:0,left:0,minWidth:"max-content",willChange:"transform",transform:`translate3d(${Math.round(e.x+window.scrollX)}px, ${Math.round(e.y+window.scrollY)}px, 0)`}}function ht(e,t,n,i,r){const o="top"===t||"bottom"===t,a=r?r.width:0,s=r?r.height:0,c=a/2+i;let u="",d="";return o?(u={start:`${c}px`,center:"center",end:e.width-c+"px"}[n],d="top"===t?`${e.height+s}px`:-s+"px"):(u="left"===t?`${e.width+s}px`:-s+"px",d={start:`${c}px`,center:"center",end:e.height-c+"px"}[n]),`${u} ${d}`}const vt={position:"fixed",top:0,left:0,opacity:0,transform:"translate3d(0, -200%, 0)"},gt={position:"absolute",opacity:0};function It({popperSize:e,arrowSize:t,arrowOffset:n,side:i,align:r}){const o=(e.width-t.width)/2,a=(e.height-t.width)/2,s={top:0,right:90,bottom:180,left:-90}[i],c=Math.max(t.width,t.height),u={width:`${c}px`,height:`${c}px`,transform:`rotate(${s}deg)`,willChange:"transform",position:"absolute",[i]:"100%",direction:yt(i,r)};return"top"!==i&&"bottom"!==i||("start"===r&&(u.left=`${n}px`),"center"===r&&(u.left=`${o}px`),"end"===r&&(u.right=`${n}px`)),"left"!==i&&"right"!==i||("start"===r&&(u.top=`${n}px`),"center"===r&&(u.top=`${a}px`),"end"===r&&(u.bottom=`${n}px`)),u}function yt(e,t){return("top"!==e&&"right"!==e||"end"!==t)&&("bottom"!==e&&"left"!==e||"end"===t)?"ltr":"rtl"}function wt(e){return{top:"bottom",right:"left",bottom:"top",left:"right"}[e]}function Ut(e,t){return{top:e.top<t.top,right:e.right>t.right,bottom:e.bottom>t.bottom,left:e.left<t.left}}const[bt,St]=Se("Popper"),[Pt,Dt]=bt("Popper"),Nt=r.forwardRef(((e,t)=>{const n=e,{__scopePopper:i,virtualRef:o}=n,a=v(n,["__scopePopper","virtualRef"]),s=Dt("PopperAnchor",i),c=r.useRef(null),u=ke(t,c);return r.useEffect((()=>{s.onAnchorChange((null==o?void 0:o.current)||c.current)})),o?null:r.createElement(Ve.div,De({},a,{ref:u}))})),[Mt,Tt]=bt("PopperContent"),Et=e=>{const{__scopePopper:t,children:n}=e,[i,o]=r.useState(null);return r.createElement(Pt,{scope:t,anchor:i,onAnchorChange:o},n)},At=Nt,Rt=r.forwardRef(((e,t)=>{const n=e,{__scopePopper:i,side:o="bottom",sideOffset:a,align:s="center",alignOffset:c,collisionTolerance:u,avoidCollisions:d=!0}=n,l=v(n,["__scopePopper","side","sideOffset","align","alignOffset","collisionTolerance","avoidCollisions"]),p=Dt("PopperContent",i),[m,g]=r.useState(),I=pt(p.anchor),[y,w]=r.useState(null),U=ct(y),[b,S]=r.useState(null),P=ct(b),D=ke(t,(e=>w(e))),N=function(){const[e,t]=r.useState(void 0);return r.useEffect((()=>{let e;function n(){t({width:window.innerWidth,height:window.innerHeight})}function i(){window.clearTimeout(e),e=window.setTimeout(n,100)}return n(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)}),[]),e}(),M=N?DOMRect.fromRect(h(f({},N),{x:0,y:0})):void 0,{popperStyles:T,arrowStyles:E,placedSide:A,placedAlign:R}=function({anchorRect:e,popperSize:t,arrowSize:n,arrowOffset:i=0,side:r,sideOffset:o=0,align:a,alignOffset:s=0,shouldAvoidCollisions:c=!0,collisionBoundariesRect:u,collisionTolerance:d=0}){if(!e||!t||!u)return{popperStyles:vt,arrowStyles:gt};const l=function(e,t,n=0,i=0,r){const o=r?r.height:0,a=mt(t,e,"x"),s=mt(t,e,"y"),c=s.before-n-o,u=s.after+n+o,d=a.before-n-o,l=a.after+n+o;return{top:{start:{x:a.start+i,y:c},center:{x:a.center,y:c},end:{x:a.end-i,y:c}},right:{start:{x:l,y:s.start+i},center:{x:l,y:s.center},end:{x:l,y:s.end-i}},bottom:{start:{x:a.start+i,y:u},center:{x:a.center,y:u},end:{x:a.end-i,y:u}},left:{start:{x:d,y:s.start+i},center:{x:d,y:s.center},end:{x:d,y:s.end-i}}}}(t,e,o,s,n),p=l[r][a];if(!1===c){const e=ft(p);let o=gt;return n&&(o=It({popperSize:t,arrowSize:n,arrowOffset:i,side:r,align:a})),{popperStyles:h(f({},e),{"--radix-popper-transform-origin":ht(t,r,a,i,n)}),arrowStyles:o,placedSide:r,placedAlign:a}}const m=DOMRect.fromRect(f(f({},t),p)),v=(g=u,I=d,DOMRect.fromRect({width:g.width-2*I,height:g.height-2*I,x:g.left+I,y:g.top+I}));var g,I;const y=Ut(m,v),w=l[wt(r)][a],U=function(e,t,n){const i=wt(e);return t[e]&&!n[i]?i:e}(r,y,Ut(DOMRect.fromRect(f(f({},t),w)),v)),b=function(e,t,n,i,r){const o="top"===n||"bottom"===n,a=o?"left":"top",s=o?"right":"bottom",c=o?"width":"height",u=t[c]>e[c];return"start"!==i&&"center"!==i||!(r[a]&&u||r[s]&&!u)?"end"!==i&&"center"!==i||!(r[s]&&u||r[a]&&!u)?i:"start":"end"}(t,e,r,a,y),S=ft(l[U][b]);let P=gt;return n&&(P=It({popperSize:t,arrowSize:n,arrowOffset:i,side:U,align:b})),{popperStyles:h(f({},S),{"--radix-popper-transform-origin":ht(t,U,b,i,n)}),arrowStyles:P,placedSide:U,placedAlign:b}}({anchorRect:I,popperSize:U,arrowSize:P,arrowOffset:m,side:o,sideOffset:a,align:s,alignOffset:c,shouldAvoidCollisions:d,collisionBoundariesRect:M,collisionTolerance:u}),C=void 0!==A;return r.createElement("div",{style:T,"data-radix-popper-content-wrapper":""},r.createElement(Mt,{scope:i,arrowStyles:E,onArrowChange:S,onArrowOffsetChange:g},r.createElement(Ve.div,De({"data-side":A,"data-align":R},l,{style:h(f({},l.style),{animation:C?void 0:"none"}),ref:D}))))})),Ct=r.forwardRef((function(e,t){const n=e,{__scopePopper:i,offset:o}=n,a=v(n,["__scopePopper","offset"]),s=Tt("PopperArrow",i),{onArrowOffsetChange:c}=s;return r.useEffect((()=>c(o)),[c,o]),r.createElement("span",{style:h(f({},s.arrowStyles),{pointerEvents:"none"})},r.createElement("span",{ref:s.onArrowChange,style:{display:"inline-block",verticalAlign:"top",pointerEvents:"auto"}},r.createElement(st,De({},a,{ref:t,style:h(f({},a.style),{display:"block"})}))))})),xt=e=>{const{present:t,children:n}=e,i=function(e){const[t,n]=r.useState(),i=r.useRef({}),o=r.useRef(e),a=r.useRef("none"),s=e?"mounted":"unmounted",[c,u]=(d=s,l={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},r.useReducer(((e,t)=>{const n=l[e][t];return null!=n?n:e}),d));var d,l;return r.useEffect((()=>{const e=Ot(i.current);a.current="mounted"===c?e:"none"}),[c]),ot((()=>{const t=i.current,n=o.current;if(n!==e){const i=a.current,r=Ot(t);if(e)u("MOUNT");else if("none"===r||"none"===(null==t?void 0:t.display))u("UNMOUNT");else{const e=i!==r;u(n&&e?"ANIMATION_OUT":"UNMOUNT")}o.current=e}}),[e,u]),ot((()=>{if(t){const e=e=>{const n=Ot(i.current).includes(e.animationName);e.target===t&&n&&u("ANIMATION_END")},n=e=>{e.target===t&&(a.current=Ot(i.current))};return t.addEventListener("animationstart",n),t.addEventListener("animationcancel",e),t.addEventListener("animationend",e),()=>{t.removeEventListener("animationstart",n),t.removeEventListener("animationcancel",e),t.removeEventListener("animationend",e)}}}),[t,u]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:r.useCallback((e=>{e&&(i.current=getComputedStyle(e)),n(e)}),[])}}(t),o="function"==typeof n?n({present:i.isPresent}):r.Children.only(n),a=ke(i.ref,o.ref);return"function"==typeof n||i.isPresent?r.cloneElement(o,{ref:a}):null};function Ot(e){return(null==e?void 0:e.animationName)||"none"}xt.displayName="Presence";const kt={bubbles:!1,cancelable:!0},Ft=r.forwardRef(((e,t)=>{const n=e,{loop:i=!1,trapped:o=!1,onMountAutoFocus:a,onUnmountAutoFocus:s}=n,c=v(n,["loop","trapped","onMountAutoFocus","onUnmountAutoFocus"]),[u,d]=r.useState(null),l=Ce(a),p=Ce(s),m=r.useRef(null),f=ke(t,(e=>d(e))),h=r.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;r.useEffect((()=>{if(o){let e=function(e){if(h.paused||!u)return;const t=e.target;u.contains(t)?m.current=t:Vt(m.current,{select:!0})},t=function(e){!h.paused&&u&&(u.contains(e.relatedTarget)||Vt(m.current,{select:!0}))};return document.addEventListener("focusin",e),document.addEventListener("focusout",t),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t)}}}),[o,u,h.paused]),r.useEffect((()=>{if(u){$t.add(h);const e=document.activeElement;if(!u.contains(e)){const t=new Event("focusScope.autoFocusOnMount",kt);u.addEventListener("focusScope.autoFocusOnMount",l),u.dispatchEvent(t),t.defaultPrevented||(function(e,{select:t=!1}={}){const n=document.activeElement;for(const i of e)if(Vt(i,{select:t}),document.activeElement!==n)return}(Lt(u),{select:!0}),document.activeElement===e&&Vt(u))}return()=>{u.removeEventListener("focusScope.autoFocusOnMount",l),setTimeout((()=>{const t=new Event("focusScope.autoFocusOnUnmount",kt);u.addEventListener("focusScope.autoFocusOnUnmount",p),u.dispatchEvent(t),t.defaultPrevented||Vt(null!=e?e:document.body,{select:!0}),u.removeEventListener("focusScope.autoFocusOnUnmount",p),$t.remove(h)}),0)}}}),[u,l,p,h]);const g=r.useCallback((e=>{if(!i&&!o)return;if(h.paused)return;const t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,n=document.activeElement;if(t&&n){const t=e.currentTarget,[r,o]=function(e){const t=Lt(e);return[jt(t,e),jt(t.reverse(),e)]}(t);r&&o?e.shiftKey||n!==o?e.shiftKey&&n===r&&(e.preventDefault(),i&&Vt(o,{select:!0})):(e.preventDefault(),i&&Vt(r,{select:!0})):n===t&&e.preventDefault()}}),[i,o,h.paused]);return r.createElement(Ve.div,De({tabIndex:-1},c,{ref:f,onKeyDown:g}))}));function Lt(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function jt(e,t){for(const n of e)if(!Bt(n,{upTo:t}))return n}function Bt(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(void 0!==t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function Vt(e,{select:t=!1}={}){if(e&&e.focus){const i=document.activeElement;e.focus({preventScroll:!0}),e!==i&&((n=e)instanceof HTMLInputElement&&"select"in n)&&t&&e.select()}var n}const $t=function(){let e=[];return{add(t){const n=e[0];t!==n&&(null==n||n.pause()),e=Gt(e,t),e.unshift(t)},remove(t){var n;e=Gt(e,t),null===(n=e[0])||void 0===n||n.resume()}}}();function Gt(e,t){const n=[...e],i=n.indexOf(t);return-1!==i&&n.splice(i,1),n}let _t,Wt=0;const[qt,zt]=tn(),[Ht,Kt]=nn(),[Yt,Jt]=tn(),[Zt,Qt]=nn(),Xt=r.forwardRef(((e,t)=>{const n=0===Kt(),i=r.createElement(en,De({},e,{ref:t}));return n?r.createElement(qt,null,r.createElement(Yt,null,i)):i})),en=r.forwardRef(((e,t)=>{const n=e,{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:o,onPointerDownOutside:a,onFocusOutside:s,onInteractOutside:c,onDismiss:u}=n,d=v(n,["disableOutsidePointerEvents","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss"]),l=zt(),p=Kt()+1,m=p===l,h=Jt(i),g=Qt()+(i?1:0),I=g<h;(function({disabled:e}){const t=r.useRef(!1),n=r.useRef(!1);r.useEffect((()=>{const e=e=>{const i="mouse"===e.pointerType;t.current=!i,n.current=i&&0===e.button},i=()=>{t.current=!1,n.current=!1};return document.addEventListener("pointerdown",e),document.addEventListener("pointerup",i),()=>{document.removeEventListener("pointerdown",e),document.removeEventListener("pointerup",i)}}),[]),ot((()=>{if(e){let e=function(){Wt--,0===Wt&&(document.body.style.pointerEvents=_t)};return 0===Wt&&(_t=document.body.style.pointerEvents),document.body.style.pointerEvents="none",Wt++,()=>{t.current?document.addEventListener("click",e,{once:!0}):n.current?document.addEventListener("pointerup",e,{once:!0}):e()}}}),[e])})({disabled:i}),function(e){const t=Ce(e);r.useEffect((()=>{const e=e=>{"Escape"===e.key&&t(e)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[t])}((e=>{m&&(null==o||o(e),e.defaultPrevented||null==u||u())}));const{onPointerDownCapture:y}=function(e){const t=Ce((e=>{I||(null==a||a(e),null==c||c(e),e.defaultPrevented||null==u||u())})),n=r.useRef(!1);return r.useEffect((()=>{const e=e=>{const i=e.target;if(i&&!n.current){const n=new CustomEvent("dismissableLayer.pointerDownOutside",{bubbles:!1,cancelable:!0,detail:{originalEvent:e}});i.addEventListener("dismissableLayer.pointerDownOutside",t,{once:!0}),i.dispatchEvent(n)}n.current=!1},i=window.setTimeout((()=>{document.addEventListener("pointerdown",e)}),0);return()=>{window.clearTimeout(i),document.removeEventListener("pointerdown",e)}}),[t]),{onPointerDownCapture:()=>n.current=!0}}(),{onBlurCapture:w,onFocusCapture:U}=function(e){const t=Ce((e=>{null==s||s(e),null==c||c(e),e.defaultPrevented||null==u||u()})),n=r.useRef(!1);return r.useEffect((()=>{const e=e=>{const i=e.target;if(i&&!n.current){const n=new CustomEvent("dismissableLayer.focusOutside",{bubbles:!1,cancelable:!0,detail:{originalEvent:e}});i.addEventListener("dismissableLayer.focusOutside",t,{once:!0}),i.dispatchEvent(n)}};return document.addEventListener("focusin",e),()=>document.removeEventListener("focusin",e)}),[t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}(),b=h>0&&!I;return r.createElement(Ht,{runningCount:p},r.createElement(Zt,{runningCount:g},r.createElement(Ve.div,De({},d,{ref:t,style:f({pointerEvents:b?"auto":void 0},d.style),onPointerDownCapture:_e(e.onPointerDownCapture,y),onBlurCapture:_e(e.onBlurCapture,w),onFocusCapture:_e(e.onFocusCapture,U)}))))}));function tn(e){const[t,n]=be("TotalLayerCount",{total:0,onTotalIncrease:()=>{},onTotalDecrease:()=>{}});return[({children:e})=>{const[n,i]=r.useState(0);return r.createElement(t,{total:n,onTotalIncrease:r.useCallback((()=>i((e=>e+1))),[]),onTotalDecrease:r.useCallback((()=>i((e=>e-1))),[])},e)},function(e=!0){const{total:t,onTotalIncrease:i,onTotalDecrease:o}=n("TotalLayerCountConsumer");return r.useLayoutEffect((()=>{if(e)return i(),()=>o()}),[e,i,o]),t}]}function nn(e){const[t,n]=be("RunningLayerCount",{count:0});return[e=>{const{children:n,runningCount:i}=e;return r.createElement(t,{count:i},n)},function(){return n("RunningLayerCountConsumer").count||0}]}var rn=new WeakMap,on=new WeakMap,an={},sn=0,cn=function(e,t,n){void 0===t&&(t=function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body}(e)),void 0===n&&(n="data-aria-hidden");var i=Array.isArray(e)?e:[e];an[n]||(an[n]=new WeakMap);var r=an[n],o=[],a=new Set,s=function(e){e&&!a.has(e)&&(a.add(e),s(e.parentNode))};i.forEach(s);var c=function(e){!e||i.indexOf(e)>=0||Array.prototype.forEach.call(e.children,(function(e){if(a.has(e))c(e);else{var t=e.getAttribute("aria-hidden"),i=null!==t&&"false"!==t,s=(rn.get(e)||0)+1,u=(r.get(e)||0)+1;rn.set(e,s),r.set(e,u),o.push(e),1===s&&i&&on.set(e,!0),1===u&&e.setAttribute(n,"true"),i||e.setAttribute("aria-hidden","true")}}))};return c(t),a.clear(),sn++,function(){o.forEach((function(e){var t=rn.get(e)-1,i=r.get(e)-1;rn.set(e,t),r.set(e,i),t||(on.has(e)||e.removeAttribute("aria-hidden"),on.delete(e)),i||e.removeAttribute(n)})),--sn||(rn=new WeakMap,rn=new WeakMap,on=new WeakMap,an={})}},un=function(){return(un=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var dn="right-scroll-bar-position",ln="width-before-scroll-bar",pn=function(){return(pn=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function mn(e){return e}var fn=function(e){var t=e.sideCar,n=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=t.read();if(!i)throw new Error("Sidecar medium not found");return r.createElement(i,pn({},n))};fn.isSideCarExport=!0;var hn=function(e){void 0===e&&(e={});var t=function(e,t){void 0===t&&(t=mn);var n=[],i=!1;return{read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var r=t(e,i);return n.push(r),function(){n=n.filter((function(e){return e!==r}))}},assignSyncMedium:function(e){for(i=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){i=!0;var t=[];if(n.length){var r=n;n=[],r.forEach(e),t=n}var o=function(){var n=t;t=[],n.forEach(e)},a=function(){return Promise.resolve().then(o)};a(),n={push:function(e){t.push(e),a()},filter:function(e){return t=t.filter(e),n}}}}}(null);return t.options=pn({async:!0,ssr:!1},e),t}();function vn(e,t){return n=t,i=function(t){return e.forEach((function(e){return function(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}(e,t)}))},(o=(0,r.useState)((function(){return{value:n,callback:i,facade:{get current(){return o.value},set current(e){var t=o.value;t!==e&&(o.value=e,o.callback(e,t))}}}}))[0]).callback=i,o.facade;var n,i,o}var gn=function(){},In=r.forwardRef((function(e,t){var n=r.useRef(null),i=r.useState({onScrollCapture:gn,onWheelCapture:gn,onTouchMoveCapture:gn}),o=i[0],a=i[1],s=e.forwardProps,c=e.children,u=e.className,d=e.removeScrollBar,l=e.enabled,p=e.shards,m=e.sideCar,f=e.noIsolation,h=e.inert,v=e.allowPinchZoom,g=e.as,I=void 0===g?"div":g,y=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),w=m,U=vn([n,t]),b=un({},y,o);return r.createElement(r.Fragment,null,l&&r.createElement(w,{sideCar:hn,removeScrollBar:d,shards:p,noIsolation:f,inert:h,setCallbacks:a,allowPinchZoom:!!v,lockRef:n}),s?r.cloneElement(r.Children.only(c),un({},b,{ref:U})):r.createElement(I,un({},b,{className:u,ref:U}),c))}));In.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},In.classNames={fullWidth:ln,zeroRight:dn};function yn(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=n.nc;return t&&e.setAttribute("nonce",t),e}var wn=function(){var e=0,t=null;return{add:function(n){var i,r;0==e&&(t=yn())&&(r=n,(i=t).styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r)),function(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}(t)),e++},remove:function(){!--e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},Un=function(){var e,t=(e=wn(),function(t){r.useEffect((function(){return e.add(t),function(){e.remove()}}),[])});return function(e){var n=e.styles;return t(n),null}},bn={left:0,top:0,right:0,gap:0},Sn=function(e){return parseInt(e||"",10)||0},Pn=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return bn;var t=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],i=t["padding"===e?"paddingTop":"marginTop"],r=t["padding"===e?"paddingRight":"marginRight"];return[Sn(n),Sn(i),Sn(r)]}(e),n=document.documentElement.clientWidth,i=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,i-n+t[2]-t[0])}},Dn=Un(),Nn=function(e,t,n,i){var r=e.left,o=e.top,a=e.right,s=e.gap;return void 0===n&&(n="margin"),"\n  .with-scroll-bars-hidden {\n   overflow: hidden "+i+";\n   padding-right: "+s+"px "+i+";\n  }\n  body {\n    overflow: hidden "+i+";\n    "+[t&&"position: relative "+i+";","margin"===n&&"\n    padding-left: "+r+"px;\n    padding-top: "+o+"px;\n    padding-right: "+a+"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: "+s+"px "+i+";\n    ","padding"===n&&"padding-right: "+s+"px "+i+";"].filter(Boolean).join("")+"\n  }\n  \n  ."+dn+" {\n    right: "+s+"px "+i+";\n  }\n  \n  ."+ln+" {\n    margin-right: "+s+"px "+i+";\n  }\n  \n  ."+dn+" ."+dn+" {\n    right: 0 "+i+";\n  }\n  \n  ."+ln+" ."+ln+" {\n    margin-right: 0 "+i+";\n  }\n  \n  body {\n    --removed-body-scroll-bar-size: "+s+"px;\n  }\n"},Mn=function(e){var t=r.useState(Pn(e.gapMode)),n=t[0],i=t[1];r.useEffect((function(){i(Pn(e.gapMode))}),[e.gapMode]);var o=e.noRelative,a=e.noImportant,s=e.gapMode,c=void 0===s?"margin":s;return r.createElement(Dn,{styles:Nn(n,!o,c,a?"":"!important")})},Tn=function(e,t){var n=t;do{if("undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot&&(n=n.host),En(e,n)){var i=An(e,n);if(i[1]>i[2])return!0}n=n.parentNode}while(n&&n!==document.body);return!1},En=function(e,t){return"v"===e?function(e){var t=window.getComputedStyle(e);return"hidden"!==t.overflowY&&!(t.overflowY===t.overflowX&&"visible"===t.overflowY)}(t):function(e){var t=window.getComputedStyle(e);return"range"===e.type||"hidden"!==t.overflowX&&!(t.overflowY===t.overflowX&&"visible"===t.overflowX)}(t)},An=function(e,t){return"v"===e?[(n=t).scrollTop,n.scrollHeight,n.clientHeight]:function(e){return[e.scrollLeft,e.scrollWidth,e.clientWidth]}(t);var n},Rn=!1;if("undefined"!=typeof window)try{var Cn=Object.defineProperty({},"passive",{get:function(){return Rn=!0,!0}});window.addEventListener("test",Cn,Cn),window.removeEventListener("test",Cn,Cn)}catch(Ty){Rn=!1}var xn=!!Rn&&{passive:!1},On=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},kn=function(e){return[e.deltaX,e.deltaY]},Fn=function(e){return e&&"current"in e?e.current:e},Ln=function(e){return"\n  .block-interactivity-"+e+" {pointer-events: none;}\n  .allow-interactivity-"+e+" {pointer-events: all;}\n"},jn=0,Bn=[];var Vn,$n=(Vn=function(e){var t=r.useRef([]),n=r.useRef([0,0]),i=r.useRef(),o=r.useState(jn++)[0],a=r.useState((function(){return Un()}))[0],s=r.useRef(e);r.useEffect((function(){s.current=e}),[e]),r.useEffect((function(){if(e.inert){document.body.classList.add("block-interactivity-"+o);var t=[e.lockRef.current].concat((e.shards||[]).map(Fn)).filter(Boolean);return t.forEach((function(e){return e.classList.add("allow-interactivity-"+o)})),function(){document.body.classList.remove("block-interactivity-"+o),t.forEach((function(e){return e.classList.remove("allow-interactivity-"+o)}))}}}),[e.inert,e.lockRef.current,e.shards]);var c=r.useCallback((function(e,t){if("touches"in e&&2===e.touches.length)return!s.current.allowPinchZoom;var r,o=On(e),a=n.current,c="deltaX"in e?e.deltaX:a[0]-o[0],u="deltaY"in e?e.deltaY:a[1]-o[1],d=e.target,l=Math.abs(c)>Math.abs(u)?"h":"v",p=Tn(l,d);if(!p)return!0;if(p?r=l:(r="v"===l?"h":"v",p=Tn(l,d)),!p)return!1;if(!i.current&&"changedTouches"in e&&(c||u)&&(i.current=r),!r)return!0;var m=i.current||r;return function(e,t,n,i,r){var o=i,a=n.target,s=t.contains(a),c=!1,u=o>0,d=0,l=0;do{var p=An(e,a),m=p[0],f=p[1]-p[2]-m;(m||f)&&En(e,a)&&(d+=f,l+=m),a=a.parentNode}while(!s&&a!==document.body||s&&(t.contains(a)||t===a));return(u&&(r&&0===d||!r&&o>d)||!u&&(r&&0===l||!r&&-o>l))&&(c=!0),c}(m,t,e,"h"===m?c:u,!0)}),[]),u=r.useCallback((function(e){var n=e;if(Bn.length&&Bn[Bn.length-1]===a){var i="deltaY"in n?kn(n):On(n),r=t.current.filter((function(e){return e.name===n.type&&e.target===n.target&&(t=e.delta,r=i,t[0]===r[0]&&t[1]===r[1]);var t,r}))[0];if(r&&r.should)n.preventDefault();else if(!r){var o=(s.current.shards||[]).map(Fn).filter(Boolean).filter((function(e){return e.contains(n.target)}));(o.length>0?c(n,o[0]):!s.current.noIsolation)&&n.preventDefault()}}}),[]),d=r.useCallback((function(e,n,i,r){var o={name:e,delta:n,target:i,should:r};t.current.push(o),setTimeout((function(){t.current=t.current.filter((function(e){return e!==o}))}),1)}),[]),l=r.useCallback((function(e){n.current=On(e),i.current=void 0}),[]),p=r.useCallback((function(t){d(t.type,kn(t),t.target,c(t,e.lockRef.current))}),[]),m=r.useCallback((function(t){d(t.type,On(t),t.target,c(t,e.lockRef.current))}),[]);r.useEffect((function(){return Bn.push(a),e.setCallbacks({onScrollCapture:p,onWheelCapture:p,onTouchMoveCapture:m}),document.addEventListener("wheel",u,xn),document.addEventListener("touchmove",u,xn),document.addEventListener("touchstart",l,xn),function(){Bn=Bn.filter((function(e){return e!==a})),document.removeEventListener("wheel",u,xn),document.removeEventListener("touchmove",u,xn),document.removeEventListener("touchstart",l,xn)}}),[]);var f=e.removeScrollBar,h=e.inert;return r.createElement(r.Fragment,null,h?r.createElement(a,{styles:Ln(o)}):null,f?r.createElement(Mn,{gapMode:"margin"}):null)},hn.useMedium(Vn),fn),Gn=r.forwardRef((function(e,t){return r.createElement(In,un({},e,{ref:t,sideCar:$n}))}));Gn.classNames=In.classNames;var _n=Gn;const Wn=["Enter"," "],qn=["ArrowUp","PageDown","End"],zn=["ArrowDown","PageUp","Home",...qn],Hn={ltr:[...Wn,"ArrowRight"],rtl:[...Wn,"ArrowLeft"]},Kn={ltr:["ArrowLeft"],rtl:["ArrowRight"]},[Yn,Jn,Zn]=Ge("Menu"),[Qn,Xn]=Se("Menu",[Zn,St,Ye]),ei=St(),ti=Ye(),[ni,ii]=Qn("Menu"),ri=r.forwardRef(((e,t)=>{const n=e,{__scopeMenu:i}=n,o=v(n,["__scopeMenu"]),a=ei(i);return r.createElement(At,De({},a,o,{ref:t}))})),[oi,ai]=Qn("MenuContent"),si=r.forwardRef(((e,t)=>{const n=e,{forceMount:i}=n,o=v(n,["forceMount"]),a=ii("MenuContent",e.__scopeMenu);return r.createElement(Yn.Provider,{scope:e.__scopeMenu},r.createElement(xt,{present:i||a.open},r.createElement(Yn.Slot,{scope:e.__scopeMenu},a.isSubmenu?r.createElement(li,De({},o,{ref:t})):r.createElement(ci,De({},o,{ref:t})))))})),ci=r.forwardRef(((e,t)=>ii("MenuContent",e.__scopeMenu).modal?r.createElement(ui,De({},e,{ref:t})):r.createElement(di,De({},e,{ref:t})))),ui=r.forwardRef(((e,t)=>{const n=ii("MenuContent",e.__scopeMenu),i=r.useRef(null),o=ke(t,i);return r.useEffect((()=>{const e=i.current;if(e)return cn(e)}),[]),r.createElement(pi,De({},e,{ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:_e(e.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)}))})),di=r.forwardRef(((e,t)=>{const n=ii("MenuContent",e.__scopeMenu);return r.createElement(pi,De({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))})),li=r.forwardRef(((e,t)=>{const n=ii("MenuContent",e.__scopeMenu),i=r.useRef(null),o=ke(t,i);return n.isSubmenu?r.createElement(pi,De({id:n.contentId,"aria-labelledby":n.triggerId},e,{ref:o,align:"start",side:"rtl"===n.dir?"left":"right",portalled:!0,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;n.isUsingKeyboardRef.current&&(null===(t=i.current)||void 0===t||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:_e(e.onFocusOutside,(e=>{e.target!==n.trigger&&n.onOpenChange(!1)})),onEscapeKeyDown:_e(e.onEscapeKeyDown,n.onRootClose),onKeyDown:_e(e.onKeyDown,(e=>{const t=e.currentTarget.contains(e.target),i=Kn[n.dir].includes(e.key);var r;t&&i&&(n.onOpenChange(!1),null===(r=n.trigger)||void 0===r||r.focus(),e.preventDefault())}))})):null})),pi=r.forwardRef(((e,t)=>{const n=e,{__scopeMenu:i,loop:o=!1,trapFocus:a,onOpenAutoFocus:s,onCloseAutoFocus:c,disableOutsidePointerEvents:u,onEscapeKeyDown:d,onPointerDownOutside:l,onFocusOutside:p,onInteractOutside:m,onDismiss:h,disableOutsideScroll:g,allowPinchZoom:I,portalled:y}=n,w=v(n,["__scopeMenu","loop","trapFocus","onOpenAutoFocus","onCloseAutoFocus","disableOutsidePointerEvents","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss","disableOutsideScroll","allowPinchZoom","portalled"]),U=ii("MenuContent",i),b=ei(i),S=ti(i),P=Jn(i),[D,N]=r.useState(null),M=r.useRef(null),T=ke(t,M,U.onContentChange),E=r.useRef(0),A=r.useRef(""),R=r.useRef(0),C=r.useRef(null),x=r.useRef("right"),O=r.useRef(0),k=y?at:r.Fragment,F=g?_n:r.Fragment,L=g?{allowPinchZoom:I}:void 0;r.useEffect((()=>()=>window.clearTimeout(E.current)),[]),r.useEffect((()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=n[0])&&void 0!==e?e:Re()),document.body.insertAdjacentElement("beforeend",null!==(t=n[1])&&void 0!==t?t:Re()),Ae++,()=>{1===Ae&&document.querySelectorAll("[data-radix-focus-guard]").forEach((e=>e.remove())),Ae--}}),[]);const j=r.useCallback((e=>{var t,n,i,r;return x.current===(null===(t=C.current)||void 0===t?void 0:t.side)&&(i=e,!!(r=null===(n=C.current)||void 0===n?void 0:n.area)&&function(e,t){const{x:n,y:i}=e;let r=!1;for(let o=0,a=t.length-1;o<t.length;a=o++){const e=t[o].x,s=t[o].y,c=t[a].x,u=t[a].y;s>i!=u>i&&n<(c-e)*(i-s)/(u-s)+e&&(r=!r)}return r}({x:i.clientX,y:i.clientY},r))}),[]);return r.createElement(k,null,r.createElement(F,L,r.createElement(oi,{scope:i,searchRef:A,onItemEnter:r.useCallback((e=>{j(e)&&e.preventDefault()}),[j]),onItemLeave:r.useCallback((e=>{var t;j(e)||(null===(t=M.current)||void 0===t||t.focus(),N(null))}),[j]),onTriggerLeave:r.useCallback((e=>{j(e)&&e.preventDefault()}),[j]),pointerGraceTimerRef:R,onPointerGraceIntentChange:r.useCallback((e=>{C.current=e}),[])},r.createElement(Ft,{asChild:!0,trapped:a,onMountAutoFocus:_e(s,(e=>{var t;e.preventDefault(),null===(t=M.current)||void 0===t||t.focus()})),onUnmountAutoFocus:c},r.createElement(Xt,{asChild:!0,disableOutsidePointerEvents:u,onEscapeKeyDown:d,onPointerDownOutside:l,onFocusOutside:p,onInteractOutside:m,onDismiss:h},r.createElement(it,De({asChild:!0},S,{dir:U.dir,orientation:"vertical",loop:o,currentTabStopId:D,onCurrentTabStopIdChange:N,onEntryFocus:e=>{U.isUsingKeyboardRef.current||e.preventDefault()}}),r.createElement(Rt,De({role:"menu",dir:U.dir,"data-state":Si(U.open)},b,w,{ref:T,style:f({outline:"none"},w.style),onKeyDown:_e(w.onKeyDown,(e=>{const t=e.target,n=e.currentTarget.contains(t),i=e.ctrlKey||e.altKey||e.metaKey;n&&!i&&1===e.key.length&&(e=>{var t,n;const i=A.current+e,r=P().filter((e=>!e.disabled)),o=document.activeElement,a=null===(t=r.find((e=>e.ref.current===o)))||void 0===t?void 0:t.textValue,s=function(e,t,n){const i=t.length>1&&Array.from(t).every((e=>e===t[0]))?t[0]:t,r=n?e.indexOf(n):-1;let o=(a=e,s=Math.max(r,0),a.map(((e,t)=>a[(s+t)%a.length])));var a,s;1===i.length&&(o=o.filter((e=>e!==n)));const c=o.find((e=>e.toLowerCase().startsWith(i.toLowerCase())));return c!==n?c:void 0}(r.map((e=>e.textValue)),i,a),c=null===(n=r.find((e=>e.textValue===s)))||void 0===n?void 0:n.ref.current;!function e(t){A.current=t,window.clearTimeout(E.current),""!==t&&(E.current=window.setTimeout((()=>e("")),1e3))}(i),c&&setTimeout((()=>c.focus()))})(e.key),"Tab"===e.key&&e.preventDefault();const r=M.current;if(e.target!==r)return;if(!zn.includes(e.key))return;e.preventDefault();const o=P().filter((e=>!e.disabled)).map((e=>e.ref.current));qn.includes(e.key)&&o.reverse(),function(e){const t=document.activeElement;for(const n of e){if(n===t)return;if(n.focus(),document.activeElement!==t)return}}(o)})),onBlur:_e(e.onBlur,(e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(E.current),A.current="")})),onPointerMove:_e(e.onPointerMove,Di((e=>{const t=e.target,n=O.current!==e.clientX;if(e.currentTarget.contains(t)&&n){const t=e.clientX>O.current?"right":"left";x.current=t,O.current=e.clientX}})))}))))))))})),mi=r.forwardRef(((e,t)=>{const n=e,{__scopeMenu:i}=n,o=v(n,["__scopeMenu"]);return r.createElement(Ve.div,De({},o,{ref:t}))})),fi=r.forwardRef(((e,t)=>{const n=e,{disabled:i=!1,onSelect:o}=n,a=v(n,["disabled","onSelect"]),s=r.useRef(null),c=ii("MenuItem",e.__scopeMenu),u=ai("MenuItem",e.__scopeMenu),d=ke(t,s),l=r.useRef(!1);return r.createElement(vi,De({},a,{ref:d,disabled:i,onClick:_e(e.onClick,(()=>{const e=s.current;if(!i&&e){const t=new Event("menu.itemSelect",{bubbles:!0,cancelable:!0});e.addEventListener("menu.itemSelect",(e=>null==o?void 0:o(e)),{once:!0}),e.dispatchEvent(t),t.defaultPrevented?l.current=!1:c.onRootClose()}})),onPointerDown:t=>{var n;null===(n=e.onPointerDown)||void 0===n||n.call(e,t),l.current=!0},onPointerUp:_e(e.onPointerUp,(e=>{var t;l.current||null===(t=e.currentTarget)||void 0===t||t.click()})),onKeyDown:_e(e.onKeyDown,(e=>{const t=""!==u.searchRef.current;i||t&&" "===e.key||Wn.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())}))}))})),hi=r.forwardRef(((e,t)=>{const n=ii("MenuSubTrigger",e.__scopeMenu),i=ai("MenuSubTrigger",e.__scopeMenu),o=r.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:s}=i,c=r.useCallback((()=>{o.current&&window.clearTimeout(o.current),o.current=null}),[]);return r.useEffect((()=>c),[c]),r.useEffect((()=>{const e=a.current;return()=>{window.clearTimeout(e),s(null)}}),[a,s]),n.isSubmenu?r.createElement(ri,De({asChild:!0},e),r.createElement(vi,De({id:n.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Si(n.open)},e,{ref:Oe(t,n.onTriggerChange),onClick:t=>{var i;null===(i=e.onClick)||void 0===i||i.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:_e(e.onPointerMove,Di((t=>{i.onItemEnter(t),t.defaultPrevented||e.disabled||n.open||o.current||(i.onPointerGraceIntentChange(null),o.current=window.setTimeout((()=>{n.onOpenChange(!0),c()}),100))}))),onPointerLeave:_e(e.onPointerLeave,Di((e=>{var t;c();const r=null===(t=n.content)||void 0===t?void 0:t.getBoundingClientRect();if(r){var o;const t=null===(o=n.content)||void 0===o?void 0:o.dataset.side,s="right"===t,c=s?-5:5,u=r[s?"left":"right"],d=r[s?"right":"left"];i.onPointerGraceIntentChange({area:[{x:e.clientX+c,y:e.clientY},{x:u,y:r.top},{x:d,y:r.top},{x:d,y:r.bottom},{x:u,y:r.bottom}],side:t}),window.clearTimeout(a.current),a.current=window.setTimeout((()=>i.onPointerGraceIntentChange(null)),300)}else{if(i.onTriggerLeave(e),e.defaultPrevented)return;i.onPointerGraceIntentChange(null)}}))),onKeyDown:_e(e.onKeyDown,(t=>{const r=""!==i.searchRef.current;var o;e.disabled||r&&" "===t.key||Hn[n.dir].includes(t.key)&&(n.onOpenChange(!0),null===(o=n.content)||void 0===o||o.focus(),t.preventDefault())}))}))):null})),vi=r.forwardRef(((e,t)=>{const n=e,{__scopeMenu:i,disabled:o=!1,textValue:a}=n,s=v(n,["__scopeMenu","disabled","textValue"]),c=ai("MenuItem",i),u=ti(i),d=r.useRef(null),l=ke(t,d),[p,m]=r.useState("");return r.useEffect((()=>{const e=d.current;var t;e&&m((null!==(t=e.textContent)&&void 0!==t?t:"").trim())}),[s.children]),r.createElement(Yn.ItemSlot,{scope:i,disabled:o,textValue:null!=a?a:p},r.createElement(rt,De({asChild:!0},u,{focusable:!o}),r.createElement(Ve.div,De({role:"menuitem","aria-disabled":o||void 0,"data-disabled":o?"":void 0},s,{ref:l,onPointerMove:_e(e.onPointerMove,Di((e=>{o?c.onItemLeave(e):(c.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus())}))),onPointerLeave:_e(e.onPointerLeave,Di((e=>c.onItemLeave(e))))}))))})),gi=r.forwardRef(((e,t)=>{const n=e,{checked:i=!1,onCheckedChange:o}=n,a=v(n,["checked","onCheckedChange"]);return r.createElement(Ui,{scope:e.__scopeMenu,checked:i},r.createElement(fi,De({role:"menuitemcheckbox","aria-checked":i},a,{ref:t,"data-state":Pi(i),onSelect:_e(a.onSelect,(()=>null==o?void 0:o(!i)),{checkForDefaultPrevented:!1})})))})),[Ii,yi]=Qn("MenuRadioGroup",{value:void 0,onValueChange:()=>{}}),wi=r.forwardRef(((e,t)=>{const n=e,{value:i}=n,o=v(n,["value"]),a=yi("MenuRadioItem",e.__scopeMenu),s=i===a.value;return r.createElement(Ui,{scope:e.__scopeMenu,checked:s},r.createElement(fi,De({role:"menuitemradio","aria-checked":s},o,{ref:t,"data-state":Pi(s),onSelect:_e(o.onSelect,(()=>{var e;return null===(e=a.onValueChange)||void 0===e?void 0:e.call(a,i)}),{checkForDefaultPrevented:!1})})))})),[Ui,bi]=Qn("MenuItemIndicator",{checked:!1});function Si(e){return e?"open":"closed"}function Pi(e){return e?"checked":"unchecked"}function Di(e){return t=>"mouse"===t.pointerType?e(t):void 0}const Ni=e=>{const{__scopeMenu:t,open:n=!1,children:i,onOpenChange:o,modal:a=!0}=e,s=ei(t),[c,u]=r.useState(null),d=r.useRef(!1),l=Ce(o),p=function(e,t){const[n,i]=r.useState("ltr"),[o,a]=r.useState(),s=r.useRef(0);return r.useEffect((()=>{if(void 0===t&&null!=e&&e.parentElement){const t=getComputedStyle(e.parentElement);a(t)}}),[e,t]),r.useEffect((()=>(void 0===t&&function e(){s.current=requestAnimationFrame((()=>{const t=null==o?void 0:o.direction;t&&i(t),e()}))}(),()=>cancelAnimationFrame(s.current))),[o,t,i]),t||n}(c,e.dir);return r.useEffect((()=>{const e=()=>d.current=!0,t=()=>d.current=!1;return document.addEventListener("keydown",e,{capture:!0}),document.addEventListener("pointerdown",t,{capture:!0}),document.addEventListener("pointermove",t,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}}),[]),r.createElement(Et,s,r.createElement(ni,{scope:t,isSubmenu:!1,isUsingKeyboardRef:d,dir:p,open:n,onOpenChange:l,content:c,onContentChange:u,onRootClose:r.useCallback((()=>l(!1)),[l]),modal:a},i))},Mi=e=>{const{__scopeMenu:t,children:n,open:i=!1,onOpenChange:o}=e,a=ii("MenuSub",t),s=ei(t),[c,u]=r.useState(null),[d,l]=r.useState(null),p=Ce(o);return r.useEffect((()=>(!1===a.open&&p(!1),()=>p(!1))),[a.open,p]),r.createElement(Et,s,r.createElement(ni,{scope:t,isSubmenu:!0,isUsingKeyboardRef:a.isUsingKeyboardRef,dir:a.dir,open:i,onOpenChange:p,content:d,onContentChange:l,onRootClose:a.onRootClose,contentId:Ee(),trigger:c,onTriggerChange:u,triggerId:Ee(),modal:!1},n))},Ti=ri,Ei=hi,Ai=si,Ri=mi,Ci=fi,xi=gi,Oi=wi,ki=r.forwardRef(((e,t)=>{const n=e,{__scopeMenu:i,forceMount:o}=n,a=v(n,["__scopeMenu","forceMount"]),s=bi("MenuItemIndicator",i);return r.createElement(xt,{present:o||s.checked},r.createElement(Ve.span,De({},a,{ref:t,"data-state":Pi(s.checked)})))})),Fi=r.forwardRef(((e,t)=>{const n=e,{__scopeMenu:i}=n,o=v(n,["__scopeMenu"]);return r.createElement(Ve.div,De({role:"separator","aria-orientation":"horizontal"},o,{ref:t}))})),Li=r.forwardRef(((e,t)=>{const n=e,{__scopeMenu:i}=n,o=v(n,["__scopeMenu"]),a=ei(i);return r.createElement(Ct,De({},a,o,{ref:t}))})),[ji,Bi]=Se("DropdownMenu",[Xn]),Vi=Xn(),[$i,Gi]=ji("DropdownMenu"),_i=e=>{const{__scopeDropdownMenu:t,children:n,dir:i,open:o,onOpenChange:a,onOpenToggle:s,modal:c=!0}=e,u=Vi(t),d=r.useRef(null);return r.createElement($i,{scope:t,isRootMenu:!0,triggerId:Ee(),triggerRef:d,contentId:Ee(),open:o,onOpenChange:a,onOpenToggle:s,modal:c},r.createElement(Ni,De({},u,{open:o,onOpenChange:a,dir:i,modal:c}),n))},Wi=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Gi("DropdownMenuTrigger",i),s=Vi(i);return a.isRootMenu?r.createElement(Ti,De({asChild:!0},s),r.createElement(Ve.button,De({type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":!!a.open||void 0,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed"},o,{ref:Oe(t,a.triggerRef),onPointerDown:_e(e.onPointerDown,(e=>{0===e.button&&!1===e.ctrlKey&&(a.open||e.preventDefault(),a.onOpenToggle())})),onKeyDown:_e(e.onKeyDown,(e=>{[" ","Enter","ArrowDown"].includes(e.key)&&(e.preventDefault(),a.onOpenChange(!0))}))}))):null})),[qi,zi]=ji("DropdownMenuContent",{isInsideContent:!1}),Hi=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Gi("DropdownMenuContent",i),s=Vi(i),c=h(f({},o),{style:h(f({},e.style),{"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)"})});return r.createElement(qi,{scope:i,isInsideContent:!0},a.isRootMenu?r.createElement(Ki,De({__scopeDropdownMenu:i},c,{ref:t})):r.createElement(Ai,De({},s,c,{ref:t})))})),Ki=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i,portalled:o=!0}=n,a=v(n,["__scopeDropdownMenu","portalled"]),s=Gi("DropdownMenuContent",i),c=Vi(i),u=r.useRef(!1);return s.isRootMenu?r.createElement(Ai,De({id:s.contentId,"aria-labelledby":s.triggerId},c,a,{ref:t,portalled:o,onCloseAutoFocus:t=>{var n,i;null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),t.defaultPrevented||(u.current||null===(i=s.triggerRef.current)||void 0===i||i.focus(),t.preventDefault()),u.current=!1},onInteractOutside:t=>{var n,i;if(null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),!t.defaultPrevented){const e=t.detail.originalEvent,n=0===e.button&&!0===e.ctrlKey,i=2===e.button||n;s.modal&&!i||(u.current=!0)}const r=t.target;(null===(i=s.triggerRef.current)||void 0===i?void 0:i.contains(r))&&t.preventDefault()}})):null})),Yi=e=>{const{__scopeDropdownMenu:t,children:n,open:i,defaultOpen:o,onOpenChange:a}=e,s=zi("DropdownMenu",t),c=Vi(t),[u=!1,d]=xe({prop:i,defaultProp:o,onChange:a}),l=r.useCallback((()=>d((e=>!e))),[d]);return s.isInsideContent?r.createElement($i,{scope:t,isRootMenu:!1,open:u,onOpenChange:d,onOpenToggle:l},r.createElement(Mi,De({},c,{open:u,onOpenChange:d}),n)):r.createElement(_i,De({},e,{open:u,onOpenChange:d,onOpenToggle:l}),n)},Ji=Wi,Zi=Hi,Qi=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Vi(i);return r.createElement(Ri,De({},a,o,{ref:t}))})),Xi=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Vi(i);return r.createElement(Ci,De({},a,o,{ref:t}))})),er=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Vi(i);return r.createElement(Ei,De({},a,o,{ref:t}))})),tr=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Vi(i);return r.createElement(xi,De({},a,o,{ref:t}))})),nr=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Vi(i);return r.createElement(Oi,De({},a,o,{ref:t}))})),ir=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Vi(i);return r.createElement(ki,De({},a,o,{ref:t}))})),rr=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Vi(i);return r.createElement(Fi,De({},a,o,{ref:t}))})),or=r.forwardRef(((e,t)=>{const n=e,{__scopeDropdownMenu:i}=n,o=v(n,["__scopeDropdownMenu"]),a=Vi(i);return r.createElement(Li,De({},a,o,{ref:t}))})),ar="hsl(255 3.7% 78.8%)",sr="hsl(252 4.0% 44.8%)",cr="hsl(255 65.0% 99.4%)",ur="hsl(252 96.9% 97.4%)",dr="hsl(252 91.5% 95.5%)",lr="hsl(252 77.8% 89.4%)",pr="hsl(252 56.0% 57.5%)",mr="hsl(250 43.0% 48.0%)",fr=le({"0%":{opacity:0,transform:"translateY(2px)"},"100%":{opacity:1,transform:"translateY(0)"}}),hr=le({"0%":{opacity:0,transform:"translateX(-2px)"},"100%":{opacity:1,transform:"translateX(0)"}}),vr=le({"0%":{opacity:0,transform:"translateY(-2px)"},"100%":{opacity:1,transform:"translateY(0)"}}),gr=le({"0%":{opacity:0,transform:"translateX(2px)"},"100%":{opacity:1,transform:"translateX(0)"}}),Ir=me(Zi,{backgroundColor:"white",borderRadius:6,padding:5,boxShadow:"0px 10px 38px -10px rgba(22, 23, 24, 0.35), 0px 10px 20px -15px rgba(22, 23, 24, 0.2)","@media (prefers-reduced-motion: no-preference)":{animationDuration:"400ms",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",willChange:"transform, opacity",'&[data-state="open"]':{'&[data-side="top"]':{animationName:vr},'&[data-side="right"]':{animationName:gr},'&[data-side="bottom"]':{animationName:fr},'&[data-side="left"]':{animationName:hr}}}}),yr={all:"unset",fontSize:13,lineHeight:1,color:mr,borderRadius:3,display:"flex",alignItems:"center",height:25,padding:"0 5px",position:"relative",userSelect:"none","&[data-disabled]":{color:ar,pointerEvents:"none"},"&:focus":{backgroundColor:pr,color:cr}},wr=me(Xi,f({},yr));me(tr,f({},yr)),me(nr,f({},yr)),me(er,f({'&[data-state="open"]':{backgroundColor:dr,color:mr}},yr)),me(Qi,{paddingInlineStart:25,fontSize:12,lineHeight:"25px",color:sr}),me(rr,{height:1,backgroundColor:lr,margin:5}),me(ir,{position:"absolute",left:0,width:25,display:"inline-flex",alignItems:"center",justifyContent:"center"}),me(or,{fill:"white"});const Ur=Yi,br=Ji,Sr=Ir,Pr=wr,Dr=me("div",{}),Nr=me("div",{marginInlineStart:"auto",paddingInlineStart:20,color:sr,":focus > &":{color:"white"},"[data-disabled] &":{color:ar}}),Mr=me("button",{all:"unset",fontFamily:"inherit",borderRadius:5,minWidth:50,height:35,paddingInlineStart:10,paddingInlineEnd:10,display:"inline-flex",alignItems:"center",justifyContent:"center",color:mr,backgroundColor:"white",boxShadow:"0 2px 10px hsl(0 0% 0% / 0.141)","&:hover":{backgroundColor:ur},"&:focus":{boxShadow:"0 0 0 2px black"}}),Tr=({structures:e=[],structureId:t,onSelect:n})=>{var i;const r=({structureName:e,structureId:t,keyCombo:i})=>(0,a.jsxs)(Pr,{onSelect:e=>((e,t)=>{"function"==typeof n&&n(t)})(0,t),children:[e,i?(0,a.jsx)(Nr,{children:i}):null]}),o=(null==(i=null==e?void 0:e.find((e=>e.structureId===t)))?void 0:i.structureName)||"Select...";return(0,a.jsx)(Dr,{children:(0,a.jsxs)(Ur,{children:[(0,a.jsx)(br,{asChild:!0,children:(0,a.jsxs)(Mr,{"aria-label":"Customise options",children:[o," "]})}),(0,a.jsx)(Sr,{sideOffset:-10,children:null==e?void 0:e.map((e=>(0,a.jsx)(r,{structureName:e.structureName,structureId:e.structureId},e.structureId)))})]})})},Er={S:"normal",F:"final"};function Ar(e,t){if(e&&"object"==typeof e){if(e.timed&&!isNaN(e.minutes))return Cr(e);if(e.bestOf&&e.setFormat)return function(e,t){const n=Rr(e.bestOf),i=n&&`SET${n}`||"",r=xr(e.setFormat,t),o=r&&`S:${r}`||"",a=xr(e.finalSetFormat,t),s=n>1&&a&&!a.invalid&&r!==a&&`F:${a}`||"";if(i&&r&&!r.invalid&&(!a||!a.invalid))return[i,o,s].filter((e=>e)).join("-")}(e,t)}}function Rr(e){return!isNaN(Number(e))&&Number(e)}function Cr(e){return`T${e.minutes}`}function xr(e,t){if(e&&"object"==typeof e){if(e.timed)return Cr(e);if(e.tiebreakSet)return Or(e.tiebreakSet);const n=Rr(e.setTo);if(n){const i=e.NoAD?"NOAD":"",r=Or(e.tiebreakFormat),o=r&&!r.invalid&&`/${r}`||"",a=Rr(e.tiebreakAt),s=a&&(a!==n||t)&&`@${a}`||"";return r&&r.invalid?{invalid:!0}:`${n}${i}${o}${s}`}return{invalid:!0}}}function Or(e){if(e)return"object"!=typeof e||e.tiebreakTo?"object"==typeof e&&Rr(e.tiebreakTo)?`TB${e.tiebreakTo}${e.NoAD?"NOAD":""}`:{invalid:!0}:""}function kr(e){if(e&&"string"==typeof e){const t=0===e.indexOf("T")?"timed":0===e.indexOf("SET")?"SET":"";if("timed"===t){const t={bestOf:1,setFormat:jr(e)};if(t.setFormat)return t}if("SET"===t)return function(e){const t=e.split("-"),n=Vr(t[0].slice(3)),i=t&&Fr(t[1]),r=t&&Fr(t[2]),o=n&&n<6,a=!t[2]||r&&!r.invalid,s=i&&!i.invalid,c={bestOf:n,setFormat:i};if(r&&(c.finalSetFormat=r),o&&s&&a)return c}(e)}}function Fr(e){if(e&&":"===e[1]){const t=e.split(":"),n=Er[t[0]],i=t[1];if(n&&i){if(0===i.indexOf("TB"))return{tiebreakSet:Lr(i)};if(0===i.indexOf("T"))return jr(i);const t=e.match(/^[FS]{1}:(\d+)([A-Za-z]*)/),n=t&&Br(t[2])||!1,r=!t||!t[2]||n,o=t&&Vr(t[1]),a=function(e){const t=e&&e.indexOf("@")>0&&e.split("@");if(t)return Vr(t[1])||{invalid:!0}}(i),s=!a||a&&!a.invalid,c=s&&a||o,u=Lr(i.split("/")[1]),d=!u||!u.invalid,l={setTo:o};return n&&(l.NoAD=!0),u?(l.tiebreakFormat=u,l.tiebreakAt=c):l.noTiebreak=!0,o&&r&&d&&s&&l||{invalid:!0}}}}function Lr(e){if(e){if(0===e.indexOf("TB")){const t=e.match(/^TB(\d+)([A-Za-z]*)/),n=t&&t[1],i=t&&Br(t[2]),r=!t||!t[2]||i,o=Vr(n);if(o&&r){const e={tiebreakTo:o};return i&&(e.NoAD=!0),e}return{invalid:!0}}return{invalid:!0}}}function jr(e){const t=Vr(e.slice(1));if(t)return{timed:!0,minutes:t}}function Br(e){return e&&e.indexOf("NOAD")>=0}function Vr(e){return!isNaN(Number(e))&&Number(e)}function $r(e){var t;if("string"!=typeof e)return!1;const n=kr(e);if(null!=n&&null!==(t=n.setFormat)&&void 0!==t&&t.timed&&1===(null==n?void 0:n.bestOf)&&e.indexOf("SET1-S:")<1&&0===e.indexOf("T"))return Ar(n).slice(7)===e;const i=e.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),r=null==i?void 0:i[0],o=null==i?void 0:i[2],a=e.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),s=null==a?void 0:a[0],c=null==a?void 0:a[2];return Ar(n,i&&r===o||a&&s===c)===e}const Gr={isValidMatchUpFormat:$r,stringify:Ar,isValid:$r,parse:kr},_r="SET3-S:6/TB7",Wr="ABANDONED",qr="BYE",zr="CANCELLED",Hr="COMPLETED",Kr="DEFAULTED",Yr="DOUBLE_WALKOVER",Jr="IN_PROGRESS",Zr="INCOMPLETE",Qr="RETIRED",Xr="SUSPENDED",eo="TO_BE_PLAYED",to="WALKOVER",no=["AWAITING_RESULT",Hr,Kr,Yr,Jr,Zr,Qr,Xr,to],io=[Wr,"AWAITING_RESULT",qr,zr,Hr,"DEAD_RUBBER",Kr,Yr,Jr,Zr,"NOT_PLAYED",Qr,Xr,eo,to],ro=[qr,Hr,Kr,Yr,Qr,to],oo=[Wr,"AWAITING_RESULT",zr,"DEAD_RUBBER",Jr,Zr,"NOT_PLAYED",Xr,eo,void 0],ao=[zr,Wr,Hr,"DEAD_RUBBER",Kr,Yr,Qr,to],so=[Wr,Hr,Kr,Yr,Jr,Qr,to],co=[Jr,Zr,Xr,eo],uo={ABANDONED:Wr,AWAITING_RESULT:"AWAITING_RESULT",BYE:qr,CANCELLED:zr,COMPLETED:Hr,DEAD_RUBBER:"DEAD_RUBBER",DEFAULTED:Kr,DOUBLE_WALKOVER:Yr,IN_PROGRESS:Jr,INCOMPLETE:Zr,NOT_PLAYED:"NOT_PLAYED",RETIRED:Qr,SUSPENDED:Xr,TO_BE_PLAYED:eo,WALKOVER:to};function lo({winningSide:e,matchUpFormat:t=_r,matchUpStatus:n,tallyPolicy:i,score:r}){const o=[0,0],{sets:a}=r||{},s=e-1,c=kr(t),u=po((null==c?void 0:c.bestOf)||1);return n===Kr&&null!=i&&i.setsCreditForDefaults||n===to&&null!=i&&i.setsCreditForWalkovers?o[s]=u:a&&a.forEach((e=>{const{winningSide:t}=e;t&&(o[t-1]+=1)})),n===Qr&&(+o[1-s]===u&&(o[1-s]-=1),o[s]=u),o}function po(e){return e&&Math.ceil(e/2)||1}function mo(e){return!isNaN(e)&&e&&0==(e&e-1)}function fo(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function ho(e){return!isNaN(parseFloat(e))}function vo(e){if(isNaN(e))return!1;for(;!mo(e);)e++;return e}function go(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function Io(e){return Number.isSafeInteger("string"==typeof e?+e:e)}function yo(e,t,n,i=2,r){const o=1-Math.random(),a=1-Math.random();let s=Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*a);return s=s/10+.5,s>1||s<0?s=yo(e,t,n):(s=Math.pow(s,n),s*=t-e,s+=e),r&&(s=function(e,t){t||(t=1);var n=1/t;return Math.round(e*n)/n}(s,r)),parseFloat(s.toFixed(i))}function wo(e){if(null===e)return{};const{source:t,template:n}=e||{},i={};return function e(t,n,i){if(!t||!n)return;const r=Object.keys(t),o=Object.keys(n);for(let a=0;a<r.length;a++)if(o.indexOf(r[a])>=0){const o=n[r[a]],s=t[r[a]];o&&"object"==typeof o&&"function"!=typeof s?Array.isArray(s)?i[r[a]]=s.map((t=>{const n={};return e(t,o,n),n})):s&&(i[r[a]]={},e(s,o,i[r[a]])):n[r[a]]&&(i[r[a]]=t[r[a]])}}(t,n,i),i}function Uo(e=0){const t=new Date;return t.setHours(t.getHours()+e),t.getTime().toString(36).slice(-6).toUpperCase()}function bo(e){return e.filter(((e,t,n)=>n.lastIndexOf(e)===t))}function So(e){return e.map((e=>[Math.random(),e])).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]))}function Po(e){return e.reduce(((e,t)=>(e[t]||(e[t]=0),e[t]++,e)),{})}function Do(e,t,n){return n.indexOf(e)===t}function No(e){return e.filter(Do)}function Mo(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function To(e){return e[Math.floor(Math.random()*e.length)]}function Eo(e,t){return Array.from({length:t-e},((t,n)=>n+e))}function Ao(e,t){return t.reduce(((t,n,i)=>(n===e&&t.push(i),t)),[])}function Ro(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>-1!==t.indexOf(e))).filter(((e,t,n)=>n.indexOf(e)===t)):0}function Co(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some((e=>t.includes(e)))}function xo(e,t){return e.reduce(((e,n,i)=>{const r=Math.floor(i/t);return e[r]=[].concat(e[r]||[],n),e}),[])}function Oo(e,t,n){return e.reduce(((e,i,r)=>{const o=!!n&&!!(Math.floor(r/t)%2),a=r%t,s=o?t-1-a:a;return e[s]||(e[s]=[]),e[s].push(i),e}),[])}const ko={success:!0},Fo="records must be an object with tournamentId keys",Lo="Missing tournamentRecord",jo="Missing drawDefinition",Bo="drawPosition already assigned",Vo="Missing event / eventId",$o="Missing value",Go="Invalid Date",_o="Invalid values",Wo="Not found",qo={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},notices:[]},zo={timers:{default:{elapsedTime:0}},devContext:void 0,deepCopyAttributes:{threshold:void 0,stringify:[],ignore:[],toJSON:[]},deepCopy:!0};let Ho=function({topic:e,payload:t,key:n}){"string"==typeof e&&"object"==typeof t&&!qo.disableNotifications&&qo.subscriptions[e]&&(n&&(qo.notices=qo.notices.filter((t=>!(t.topic===e&&t.key===n)))),qo.notices.push({topic:e,payload:t,key:n}))},Ko=function({topic:e,notices:t}){const n=qo.subscriptions[e];n&&"function"==typeof n&&n(t)},Yo=function(){qo.notices=[]},Jo=function(){qo.disableNotifications=!0},Zo=function(){qo.disableNotifications=!1},Qo=function({topic:e}){const t=qo.notices.filter((t=>t.topic===e)).map((e=>e.payload));return t.length&&t},Xo=function(){return{topics:Object.keys(qo.subscriptions)}},ea=function(){return qo.tournamentId},ta=function(e){return qo.tournamentRecords[e]},na=function(){return qo.tournamentRecords},ia=function(e){if("string"!=typeof e)return{error:_o};if(!qo.tournamentRecords[e])return{error:Wo};delete qo.tournamentRecords[e];const t=Object.keys(qo.tournamentRecords);return 1===t.length?qo.tournamentId=t[0]:t.length||(qo.tournamentId=void 0),{success:!0}},ra=function(e){return qo.tournamentRecords[e]?(qo.tournamentId=e,{success:!0}):{error:Lo}},oa=function(e){const t=null==e?void 0:e.tournamentId;return t?(qo.tournamentRecords[t]=e,{success:!0}):{error:"Invalid tournamentRecord"}},aa=function(e){qo.tournamentRecords=e;const t=Object.keys(e);1===t.length?qo.tournamentId=t[0]:t.length||(qo.tournamentId=void 0)};function sa(e){return e&&"object"==typeof e?"object"==typeof zo.devContext&&Object.keys(e).every((t=>zo.devContext[t]===e[t]))&&zo.devContext:zo.devContext||!1}function ca(e){zo.devContext=e}function ua(){Zo()}function da(e,t){"boolean"==typeof e&&(zo.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(zo.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(zo.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(zo.deepCopyAttributes.stringify=t.stringify),t.threshold&&(zo.deepCopyAttributes.threshold=t.threshold))}function la(e){return Ho(e)}function pa(e){return Qo(e)}function ma(){return Yo()}function fa(){return Xo()}async function ha(e){return Ko(e)}function va(){return ea()}function ga(e){return ta(e)}function Ia(){return na()}function ya(e){return oa(e)}function wa(e){return aa(e)}function Ua(e){return ra(e)}function ba(e){return ia(e)}const Sa=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,Pa=/^((0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)([.,][0-9]{3})?$/,Da=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))([ T](0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/,Na=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))?([ T]?(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/;function Ma(e){return"object"==typeof e&&!Array.isArray(e)&&"[object Date]"===Object.prototype.toString.call(e)}function Ta(e){return ka(e)||Sa.test(e)}const Ea=e=>{const t=Ca(e)||ka(e)?new Date(e):new Date,n=t.getUTCMonth()+1,i=n<10?`0${n}`:`${n}`;return`${t.getUTCFullYear()}-${Ha(i)}-${Ha(t.getUTCDate())}`};function Aa(e,t="-",n="YMD"){if(!e)return"";"string"==typeof e&&e.indexOf("T")<0&&(e+="T00:00");const i=new Date(e);let r=""+(i.getMonth()+1),o=""+i.getDate();const a=i.getFullYear();return r.length<2&&(r="0"+r),o.length<2&&(o="0"+o),"DMY"===n?[o,r,a].join(t):"MDY"===n?[r,o,a].join(t):"YDM"===n?[a,o,r].join(t):"DYM"===n?[o,a,r].join(t):"MYD"===n?[r,a,o].join(t):[a,r,o].join(t)}function Ra(e){const t=e?new Date(e):new Date,n=t.getTimezoneOffset();return new Date(t.getTime()-60*n*1e3)}function Ca(e){if("boolean"==typeof e)return!1;const t=e instanceof Date?e:!isNaN(e)&&new Date(e);return t&&!isNaN(t.valueOf())}function xa(e,t){const n=new Date(e),i=new Date(t);var r;const o=[];let a=0;if(Ca(i)&&Ca(n)&&(r=i,Ra(n)<=Ra(r))){const e=Ra(n),t=Ra(i);for(;e<=t&&a<300;)a+=1,o.push(new Date(e)),e.setDate(e.getDate()+1)}return o}const Oa=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function ka(e){return"string"==typeof e&&Oa.test(e)}function Fa(e){if("string"!=typeof e)return!1;const t=e.split("Z")[0].split(":"),n=t.every((e=>!isNaN(e)));return!(t.length<2||!n||parseInt(t[0])>23||parseInt(t[1])>60)}function La(e){const t=Ba(e);if(!t)return 0;const[n,i]=t.split(":").map((e=>parseInt(e)));return 60*n+i}function ja(e){return Fa(e)?e.split(":").slice(0,2).map(Ha).join(":"):void 0}function Ba(e){return ka(e)&&e.indexOf("T")>0?ja(e.split("T").reverse()[0]):ja(e)}function Va(e){return ka(e)||Da.test(e)?e.split("T")[0]:void 0}function $a(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),Va(n.toISOString())}function Ga(e){e="string"!=typeof e?"00:00":e;const t={},n={};return({0:t.time,1:t.ampm}=e.split(" ")||[]),({0:n.hours,1:n.minutes}=t.time.split(":")||[]),n.ampm=t.ampm,isNaN(n.hours)||isNaN(n.minutes)||n.ampm&&!["AM","PM"].includes(n.ampm.toUpperCase())?{}:n}function _a(e,t){const[n,i]=(e||"00:00").split(":").map(Ha),r=Ra(t).setHours(n,i,0,0);return Ra(r)}function Wa(e,t,n=!0){const i=new Date(e),r=(new Date(t).getTime()-i.getTime())/1e3/60;return n?Math.abs(Math.round(r)):Math.round(r)}function qa(e,t){const n=Ba(e);if(!n)return"00:00";const i=isNaN(t)?0:t;return Ba(za(_a(n),i).toISOString())}function za(e,t){const n=new Date(e);return new Date(n.getTime()+6e4*t)}function Ha(e){return e.toString()[1]?e:"0"+e}function Ka(e,t){const n=new Date(e),i=new Date(t);return n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth()&&n.getDate()===i.getDate()}const Ya={addMinutesToTimeString:qa,convertTime:function(e,t){return t?function(e){const t=Ga(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&parseInt(t.hours)<12&&(t.hours=(t.hours&&parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),`${t.hours||"12"}:${t.minutes||"00"}`.split(":").map(Ha).join(":")}(e):function(e){const t=Ga(e);return t.ampm?e:(t.hours>12?(t.hours-=12,t.ampm="PM"):"12"===t.hours?t.ampm="PM":"00"===t.hours?(t.hours="12",t.ampm="AM"):t.ampm="AM","0"===t.hours[0]&&(t.hours=t.hours.slice(1)),`${t.hours||"12"}:${t.minutes||"00"} ${t.ampm}`)}(e)},getUTCdateString:Ea,DateHHMM:function(e){const t=new Date(e);return function(e,t){const n=parseInt(e,10),i=Math.floor(n/3600),r=Math.floor((n-3600*i)/60);return(!t||t&&t.displaySeconds?i+":"+r+":"+(n-3600*i-60*r):i+":"+r).split(":").map(Ha).join(":")}(t.getSeconds()+60*t.getMinutes()+3600*t.getHours(),{displaySeconds:!1})},extractDate:Va,extractTime:Ba,formatDate:Aa,getDateByWeek:function(e,t,n,i=!1){let r=new Date(t,0,1+7*(e-1));const o=i?0:1;return r.setDate(r.getDate()+(o-r.getDay())),Aa(r,n)},isISODateString:ka,isTimeString:Fa,offsetDate:Ra,offsetTime:function(e){return Ra(e).getTime()},sameDay:Ka,timeStringMinutes:La,timeToDate:_a,timeUTC:function(e){const t=Ca(e)||ka(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())}};function Ja(e,t,n,i,r=0){const o=f({enabled:zo.deepCopy},zo.deepCopyAttributes);if((null==o||!o.enabled)&&!n||"object"!=typeof e||"function"==typeof e||null===e||"number"==typeof(null==o?void 0:o.threshold)&&r>=o.threshold)return e;const a=sa({makeDeepCopy:!0});a&&r>(a.iterations||15)&&console.log(r,e,{devContext:a});const s=Array.isArray(e)?[]:{},c=Object.keys(e).filter((e=>!n||!(null!=o&&o.ignore.includes(e))));for(const d of c){const a=e[d];if(t&&"extensions"===d&&Array.isArray(a)){const e=null==(u=a)?void 0:u.map((e=>{const{name:t,value:n}=e;return t&&n&&{[`_${t}`]:n}})).filter(Boolean);Object.assign(s,...e)}else i&&"extensions"===d?s[d]=[]:n&&null!=o&&o.stringify.includes(d)?s[d]="function"==typeof(null==a?void 0:a.toString)?a.toString():JSON.stringify(a):n&&null!=o&&o.toJSON.includes(d)&&"function"==typeof(null==a?void 0:a.toJSON)?s[d]=a.toJSON():null===a?s[d]=void 0:Ma(a)?s[d]=new Date(a).toISOString():s[d]=Ja(a,t,n,i,r+1)}var u;return s}function Za(e,t,n){if("object"!=typeof e||null===e)return e;const i=["",void 0,null];t&&i.push(!1);const r=Object.keys(e).filter((t=>!i.includes(e[t])&&(!n||!Array.isArray(e[t])||e[t].length)));return Object.assign({},...r.map((t=>Array.isArray(e[t])?{[t]:e[t].map((e=>Za(e)))}:{[t]:Za(e[t])})))}function Qa(e){return Array.isArray(e)?e.length+e.map(Qa).reduce(((e,t)=>e+t),0):"object"==typeof e&&null!==e?Object.keys(e).length+Object.keys(e).map((t=>Qa(e[t]))).reduce(((e,t)=>e+t),0):0}function Xa(e,t){return e-t}function es(){const e=[];for(let o=0;o<256;o++)e[o]=(o<16?"0":"")+o.toString(16);const t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]}function ts({participantIds:e,matchUpFormat:t,tallyPolicy:n,perPlayer:i,matchUps:r}){const o={};function a(e){o[e]||(o[e]={allDefaults:0,defaults:0,retirements:0,walkovers:0,matchUpsWon:0,matchUpsLost:0,victories:[],defeats:[],matchUpsCancelled:0,setsWon:0,setsLost:0,gamesWon:0,gamesLost:0,pointsWon:0,pointsLost:0})}return r.filter((t=>!(null!=e&&e.length)||2===Ro(e,[ns(t,0),ns(t,1)]).length)).forEach((e=>{const{matchUpStatus:i,score:r,winningSide:s}=e,c=s&&ns(d=e,d.winningSide-1),u=s&&function(e){return ns(e,1-(e.winningSide-1))}(e);var d;if(!c||!u){const t=ns(e,0),n=ns(e,1);return t&&(a(t),o[t].matchUpsCancelled+=1),void(n&&(a(n),o[n].matchUpsCancelled+=1))}const l=s&&s-1,p=1-l;a(c),a(u),i===to&&(o[u].walkovers+=1),i===Kr&&(o[u].defaults+=1),i===Qr&&(o[u].retirements+=1),[Kr,Qr,to].includes(i)&&(o[u].allDefaults+=1),o[c].matchUpsWon+=1,o[u].matchUpsLost+=1,o[u].defeats.push(c),o[c].victories.push(u);const m=lo({score:r,matchUpStatus:i,matchUpFormat:t,tallyPolicy:n,winningSide:s});o[c].setsWon+=m[l],o[c].setsLost+=m[p],o[u].setsWon+=m[p],o[u].setsLost+=m[l];const f=function({winningSide:e,matchUpFormat:t=_r,matchUpStatus:n,tallyPolicy:i,score:r}){var o,a;const{sets:s}=r||{},c=e-1,u=kr(t);let d=0,l=0;const p=po((null==u?void 0:u.bestOf)||1),m=(null==u||null===(o=u.setFormat)||void 0===o?void 0:o.setTo)||0,f=(null==u||null===(a=u.setFormat)||void 0===a?void 0:a.tiebreakAt)||0;if(!s)return[d,l];const h=p*m,v=[[],[]];if(n===Kr&&null!=i&&i.gamesCreditForDefaults||n===to&&null!=i&&i.gamesCreditForWalkovers?v[c].push(h):s&&s.forEach((e=>{({side1Score:d,side2Score:l}=e),v[0].push(parseInt(d||0)),v[1].push(parseInt(l||0))})),n===Qr){const i=lo({winningSide:e,matchUpStatus:n,matchUpFormat:t,sets:s}),r=i.reduce(((e,t)=>e+t),0);if(v.map((e=>e[c]<=e[1-c])).reduce(((e,t)=>e+t),0)>i[1-c]){const e=v[c].length,t=function(e){if(u&&""!==e)return+e==f-1||+e===f?parseInt(f||0)+1:+e<f?m:f}(v[1-c][e-1]);t&&(v[c][e-1]=t)}r>v[c].length&&v[c].push(m)}const g=[v[0].reduce(((e,t)=>e+t),0),v[1].reduce(((e,t)=>e+t),0)];return[Qr,to,Kr].includes(n)&&g[c]<h&&(g[c]=h),g}({score:r,matchUpStatus:i,matchUpFormat:t,tallyPolicy:n,winningSide:s});o[c].gamesWon+=f[l],o[c].gamesLost+=f[p],o[u].gamesWon+=f[p],o[u].gamesLost+=f[l];const h=function({score:e}){var t;const n=[0,0];return null==e||null===(t=e.sets)||void 0===t||t.forEach((e=>{e.side1TiebreakScore&&(n[0]+=parseInt(e.side1TiebreakScore)),e.side2TiebreakScore&&(n[1]+=parseInt(e.side2TiebreakScore))})),n}({score:r,tallyPolicy:n});o[c].pointsWon+=h[l],o[c].pointsLost+=h[p],o[u].pointsWon+=h[p],o[u].pointsLost+=h[l]})),function({participantResults:e,matchUpFormat:t,perPlayer:n}){var i;const r=t&&kr(t)||{},o=r.bestOf,a=o&&Math.ceil(o/2)||1,s=null===(i=r.setFormat)||void 0===i?void 0:i.setTo;Object.keys(e).forEach((t=>{const i=e[t].setsWon,r=e[t].setsLost,o=n*(a||0)||i;let c=Math.round(i/r*1e3)/1e3;(c===1/0||isNaN(c))&&(c=o);const u=e[t].matchUpsWon,d=e[t].matchUpsLost;let l=Math.round(u/d*1e3)/1e3;(l===1/0||isNaN(l))&&(l=u);const p=e[t].gamesWon||0,m=e[t].gamesLost||0,f=(n||0)*(a||0)*(s||0),h=Math.max(f,p+m);let v=Math.round(p/h*1e3)/1e3;(v===1/0||isNaN(v))&&(v=0);let g=Math.round(e[t].pointsWon/e[t].pointsLost*1e3)/1e3;(g===1/0||isNaN(g))&&(g=0),e[t].setsRatio=c,e[t].matchUpsRatio=l,e[t].gamesRatio=v,e[t].pointsRatio=g,e[t].result=`${e[t].matchUpsWon}/${e[t].matchUpsLost}`,e[t].games=`${e[t].gamesWon}/${e[t].gamesLost}`}))}({participantResults:o,perPlayer:i,matchUpFormat:t}),{participantResults:o}}function ns(e,t){if(!e||!e.sides)return console.log("no sides:",{matchUp:e}),"foo";const n=e.sides[t];return n?n.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function is(e){return ao.includes(null==e?void 0:e.matchUpStatus)||(null==e?void 0:e.winningSide)}const rs=[{attribute:"matchUpsRatio",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsRatio",idsFilter:!1},{attribute:"gamesRatio",idsFilter:!1},{attribute:"pointsRatio",idsFilter:!1},{attribute:"matchUpsRatio",idsFilter:!0},{attribute:"setsRatio",idsFilter:!0},{attribute:"gamesRatio",idsFilter:!0},{attribute:"pointsRatio",idsFilter:!0}];function os(e){const{participantResults:t,subOrderMap:n}=e;if(!function({participantResults:e,participantsCount:t}){let n=cs({participantResults:e}).filter((e=>t-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled));return t===n.length}(e))return;const i=ss({attribute:"matchUpsWon",participantResults:t}),r=Object.keys(i).map((e=>parseFloat(e))).sort(((e,t)=>t-e)).map((e=>i[e])).map((t=>as(f({participantIds:t},e)))).flat(1/0);let o,a=1;r.forEach(((e,t)=>{t&&(e.resolved||o&&!e.resolved)&&(a+=1),o=e.resolved,e.resolved?(e.position=t+1,a=e.position):e.position=a}));const s=Po(r.map((({position:e})=>e)));return r.forEach((e=>{const i=t[e.participantId],r=s[e.position];var o;void 0!==e&&void 0!==e.position&&(r>1&&(i.ties=r,n&&(i.subOrder=n[e.participantId])),e.groupOrder=e.position+(i.subOrder||1)-1,i.rankOrder=e.position),i.GEMscore=(o=i).matchUpsRatio*Math.pow(10,16)+o.setsRatio*Math.pow(10,12)+o.gamesRatio*Math.pow(10,8)+o.pointsRatio*Math.pow(10,3)})),r}function as({participantResults:e,disableHeadToHead:t,participantIds:n,matchUpFormat:i,tallyPolicy:r,matchUps:o}){if(1===n.length)return{resolved:!0,participantId:n[0]};if(2===n.length&&(null==r||!r.headToHead||!r.headToHead.disabled&&!t)){const t=function({participantIds:e,participantResults:t}){return t[e[0]].victories.includes(e[1])?e.map((e=>({resolved:!0,participantId:e}))):t[e[1]].victories.includes(e[0])?e.reverse().map((e=>({resolved:!0,participantId:e}))):void 0}({participantIds:n,participantResults:e});if(t)return t}let a;return((null==r?void 0:r.tallyDirectives)||rs).every((({attribute:e,reversed:t,idsFilter:s,disableHeadToHead:c})=>(a=function({disableHeadToHead:e,participantIds:t,matchUpFormat:n,tallyPolicy:i,attribute:r,idsFilter:o,matchUps:a,reversed:s}){const{participantResults:c}=ts({participantIds:o&&t,matchUpFormat:n,tallyPolicy:i,matchUps:a}),u=ss({participantResults:c,participantIds:t,attribute:r});if(Object.keys(u).length>1)return Object.keys(u).map((e=>parseFloat(e))).sort(((e,t)=>s?e-t:t-e)).map((e=>u[e])).map((t=>as({participantResults:c,disableHeadToHead:e,participantIds:t,matchUpFormat:n,tallyPolicy:i,matchUps:a}))).flat(1/0)}({disableHeadToHead:c,participantIds:n,matchUpFormat:i,tallyPolicy:r,attribute:e,idsFilter:s,matchUps:o,reversed:t}),!a))),a||n.map((e=>({participantId:e})))}function ss({participantResults:e,participantIds:t,attribute:n}){return cs({participantResults:e,participantIds:t}).reduce(((e,t)=>{const{participantId:i,results:r}=t,o=r[n];return e[o]?e[o].push(i):e[o]=[i],e}),{})}function cs({participantResults:e,participantIds:t}){return(t=t||Object.keys(e)).reduce(((t,n,i)=>(t.push({participantId:n,i:i,results:e[n]}),t)),[])}function us({policyDefinitions:e,matchUpFormat:t,matchUps:n=[],subOrderMap:i,perPlayer:r}){if(!Array.isArray(n))return{error:"Missing matchUps"};if(1!==n.reduce(((e,{structureId:t})=>e.includes(t)?e:e.concat(t)),[]).length)return{error:_o};const o=n.filter((e=>e&&e.matchUpStatus!==qr)),a=o.length&&bo(o.map((({drawPositions:e})=>e)).flat()).length,s=o.filter(is).length===o.length;s||(r=0);const c=e&&e.roundRobinTally,u=n.filter(is),{participantResults:d}=ts({matchUps:u,matchUpFormat:t,tallyPolicy:c,perPlayer:r}),l=os({matchUps:u,participantResults:d,participantsCount:a,matchUpFormat:t,tallyPolicy:c,subOrderMap:i});return s&&l&&l.forEach((e=>{d[e.participantId].groupOrder=e.groupOrder})),{participantResults:d}}const ds="CHECK_IN",ls="CHECK_OUT",ps="SCHEDULE.ASSIGNMENT.COURT",ms="SCHEDULE.ASSIGNMENT.VENUE",fs="SCHEDULE.TIME.START",hs="SCHEDULE.TIME.STOP",vs="SCHEDULE.TIME.RESUME",gs="SCHEDULE.TIME.END",Is="SCALE";function ys(e){if(Pa.test(e)){const t=Ea();return new Date(`${t}T${e}`)}return new Date(e)}function ws({matchUp:e}){if(!e)return{error:"Missing matchUp"};if(!e.timeItems)return{error:"Missing timeItems"};const t=e.timeItems.filter((e=>[fs,hs,vs,gs].includes(null==e?void 0:e.itemType))).sort(((e,t)=>ys(e.itemValue)-ys(t.itemValue))),n=t.reduce(((e,t)=>{var n,i;let r;const o=null==t||null===(n=t.itemType)||void 0===n?void 0:n.split("."),a=`SCHEDULE.TIME.${(null==t||null===(i=t.itemType)||void 0===i?void 0:i.startsWith("SCHEDULE.TIME"))&&o[2]}`;switch(a){case fs:r=0;break;case gs:if(e.lastValue&&[fs,vs].includes(e.lastType)){const n=ys(t.itemValue)-ys(e.lastValue);r=e.milliseconds+n}else r=e.milliseconds;break;case hs:if([fs,"SCHECULE.TIME.RESUME"].includes(e.lastType)){const n=ys(t.itemValue)-ys(e.lastValue);r=e.milliseconds+n}else r=e.milliseconds;break;default:r=e.milliseconds}return{milliseconds:r,lastType:a,lastValue:t.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([fs,vs].includes(n.lastType)){const e=new Date-ys(n.lastValue);n.milliseconds+=e}return{milliseconds:n.milliseconds,time:Us(n.milliseconds),relevantTimeItems:t}}function Us(e){const t=(e,t=2)=>("00"+e).slice(-t);return t(e/36e5|0)+":"+t(e%36e5/6e4|0)+":"+t(e%6e4/1e3|0)}function bs({categoryName:e,categoryType:t,timesBlockArray:n}){return n.filter((e=>Array.isArray(e))).map((n=>n.sort(((e,t)=>{var n,i;return((null===(n=t.categoryNames)||void 0===n?void 0:n.length)||0)-((null===(i=e.categoryNames)||void 0===i?void 0:i.length)||0)})).find((({categoryTypes:n,categoryNames:i})=>!(null!=i&&i.length)&&!(null!=n&&n.length)||(null==i?void 0:i.includes(e))||(null==n?void 0:n.includes(t)))))).find(Boolean)}function Ss({matchUpAverageTimes:e,matchUpFormat:t}={}){const n=(null==e?void 0:e.map((({matchUpFormatCodes:e})=>null==e?void 0:e.filter((e=>e===t)))).flat().filter(Boolean).sort(((e,t)=>((null==e?void 0:e.length)||0)-((null==t?void 0:t.length)||0))))||[],i=n.includes(t)?t:n[0],r=null==e?void 0:e.find((({matchUpFormatCodes:e,averageTimes:t})=>(null==e?void 0:e.find((e=>i===e)))&&t));return null==r?void 0:r.averageTimes}function Ps({matchUpRecoveryTimes:e,averageMinutes:t,matchUpFormat:n}={}){var i;return null==e||null===(i=e.find((({matchUpFormatCodes:e,averageTimes:i,recoveryTimes:r})=>{if(i&&t){const{greaterThan:e=0,lessThan:n=360}=i;if(t>e&&t<n)return!0}return(null==e?void 0:e.find((e=>e===n)))&&r})))||void 0===i?void 0:i.recoveryTimes}const Ds={APPLIED_POLICIES:"appliedPolicies",DELEGATED_OUTCOME:"delegatedOutcome",DISABLE_LINKS:"disableLinks",DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:"entryProfile",FLIGHT_PROFILE:"flightProfile",GROUPING_ATTRIBUTE:"groupingAttribute",LINEUPS:"lineUps",LINKED_TOURNAMENTS:"linkedTournamentsIds",PARTICIPANT_REPRESENTATIVES:"participantRepresentatives",PERSON_REQUESTS:"personRequests",SCHEDULE_LIMITS:"scheduleLimits",SCHEDULE_TIMING:"scheduleTiming",SCHEDULING_PROFILE:"schedulingProfile",SUB_ORDER:"subOrder",TALLY:"tally"};function Ns({tournamentRecord:e}){return Ts({extensions:(null==e?void 0:e.extensions)||[]})}function Ms({event:e}){return e?Ts({extensions:e.extensions||[]}):{error:Vo}}function Ts({extensions:e}){const t=e.find((e=>"appliedPolicies"===e.name));return{appliedPolicies:(null==t?void 0:t.value)||{}}}function Es({tournamentRecord:e,event:t,policyType:n}){if(!e)return{error:Lo};if(t){const{appliedPolicies:e}=Ms({event:t});if(e&&e[n])return{policy:e[n]}}const{appliedPolicies:i}=Ns({tournamentRecord:e});return null!=i&&i[n]?{policy:i[n]}:{error:"Policy not found"}}function As({tournamentParticipants:e=[],policyDefinitions:t={},participantId:n,personId:i}){const r=e.find((e=>n&&e.participantId===n||i&&e.person&&e.person.personId===i)),o=null==t?void 0:t.participant;return null!=o&&o.participant?wo({template:o.participant,source:r}):Ja(r)}function Rs({tournamentRecord:e,participantId:t}){return{participant:(e.participants||[]).reduce(((e,n)=>n.participantId===t?n:e),void 0)}}function Cs({element:e,name:t}){if(!e||!t)return{error:$o};if(!Array.isArray(e.extensions))return{message:Wo};const n=e.extensions.find((e=>(null==e?void 0:e.name)===t));return{extension:n,message:n?void 0:Wo}}function xs({tournamentRecord:e,name:t}){return Cs({element:e,name:t})}function Os({event:e,name:t}){return e?Cs({element:e,name:t}):{error:Vo}}function ks({drawDefinition:e,name:t}){return e?Cs({element:e,name:t}):{error:jo}}function Fs({tournamentRecord:e,categoryName:t,categoryType:n,event:i}){var r,o,a;t=t||(null==i||null===(r=i.category)||void 0===r?void 0:r.categoryName)||(null==i||null===(o=i.category)||void 0===o?void 0:o.ageCategoryCode),n=n||(null==i||null===(a=i.category)||void 0===a?void 0:a.categoryType);const{policy:s}=Es({policyType:"scheduling",tournamentRecord:e,event:i}),{extension:c}=xs({tournamentRecord:e,name:"scheduleTiming"}),u=null==c?void 0:c.value,{extension:d}=Os({event:i,name:"scheduleTiming"});return{scheduleTiming:{categoryName:t,categoryType:n,eventScheduling:null==d?void 0:d.value,tournamentScheduling:u,policy:s}}}const Ls="SINGLES",js="DOUBLES",Bs="TEAM",Vs="total";function $s({defaultAverageMinutes:e=90,defaultRecoveryMinutes:t=0,tournamentRecord:n,matchUpFormat:i,categoryName:r,categoryType:o,eventType:a,event:s}){if(!n)return{error:Lo};a=a||(null==s?void 0:s.eventType);const c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},{scheduleTiming:u}=Fs({tournamentRecord:n,categoryName:r,categoryType:o,event:s});return Gs({eventType:a,timingDetails:h(f({},u),{matchUpFormat:i,categoryType:o,defaultTiming:c})})}function Gs({eventType:e,timingDetails:t}){const n=function({matchUpFormat:e,categoryName:t,categoryType:n,defaultTiming:i,tournamentScheduling:r,eventScheduling:o,policy:a}){var s;return bs({categoryName:t,categoryType:n,timesBlockArray:[(null==o?void 0:o.matchUpAverageTimes)&&Ss(h(f({},o),{matchUpFormat:e})),(null==r?void 0:r.matchUpAverageTimes)&&Ss(h(f({},r),{matchUpFormat:e})),(null==a?void 0:a.matchUpAverageTimes)&&Ss(h(f({},a),{matchUpFormat:e})),null==a||null===(s=a.defaultTimes)||void 0===s?void 0:s.averageTimes,null==i?void 0:i.averageTimes]})}(t),i=Object.keys((null==n?void 0:n.minutes)||{}),r=(null==n?void 0:n.minutes)&&((null==i?void 0:i.includes(e))&&n.minutes[e]||n.minutes.default),o=function({matchUpFormat:e,categoryName:t,categoryType:n,averageMinutes:i,defaultTiming:r,tournamentScheduling:o,eventScheduling:a,policy:s}){var c;return bs({categoryName:t,categoryType:n,timesBlockArray:[(null==a?void 0:a.matchUpRecoveryTimes)&&Ps(h(f({},a),{averageMinutes:i,matchUpFormat:e})),(null==o?void 0:o.matchUpRecoveryTimes)&&Ps(h(f({},o),{averageMinutes:i,matchUpFormat:e})),(null==s?void 0:s.matchUpRecoveryTimes)&&Ps(h(f({},s),{averageMinutes:i,matchUpFormat:e})),null==s||null===(c=s.defaultTimes)||void 0===c?void 0:c.recoveryTimes,null==r?void 0:r.recoveryTimes]})}(h(f({},t),{averageMinutes:r})),a=Object.keys((null==o?void 0:o.minutes)||{}),s=(null==o?void 0:o.minutes)&&((null==a?void 0:a.includes(e))&&o.minutes[e]||o.minutes.default),c=e===Ls?"SINGLES_DOUBLES":"DOUBLES_SINGLES";return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:(null==o?void 0:o.minutes)&&((null==a?void 0:a.includes(c))&&o.minutes[c]||s)}}function _s({tournamentRecord:e,eventId:t,drawId:n}){if(!e)return{error:Lo};const i=(null==e?void 0:e.events)||[];if(n){let e;const t=i.find((t=>{const i=((null==t?void 0:t.drawDefinitions)||[]).find((e=>e.drawId===n));return i&&(e=i),i}));if(t)return{event:t,drawDefinition:e}}if(t){const e=i.find((e=>e.eventId===t));return e?{event:e}:{error:"Event not found"}}return{error:$o}}function Ws({tournamentRecord:e,drawId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing drawId"};const n=(e.events||[]).reduce(((e,n)=>{const i=(n.drawDefinitions||[]).reduce(((e,n)=>n.drawId===t?n:e),void 0);return i&&i.drawId===t?{event:n,drawDefinition:i}:e}),void 0);return n?h(f({},n),{SUCCESS:ko}):{error:"drawDefinition not found"}}function qs(e,t,n){const i=e=>e.createdAt?new Date(e.createdAt).getTime():0,r=e.filter((e=>e&&e.itemType===t&&(!n||i(e)<n))).sort(((e,t)=>i(e)-i(t))).pop();return r&&r.itemValue}function zs({matchUp:e,visibilityThreshold:t}){return{scheduledTime:qs((null==e?void 0:e.timeItems)||[],"SCHEDULE.TIME.SCHEDULED",t)}}function Hs({matchUp:e,visibilityThreshold:t}){return{scheduledDate:qs((null==e?void 0:e.timeItems)||[],"SCHEDULE.DATE",t)}}function Ks({matchUp:e,visibilityThreshold:t}){return{courtId:qs((null==e?void 0:e.timeItems)||[],ps,t)}}function Ys({matchUp:e,visibilityThreshold:t}){return{venueId:qs((null==e?void 0:e.timeItems)||[],ms,t)}}const Js="SINGLES",Zs="DOUBLES",Qs="TEAM";function Xs({tournamentRecord:e}){if(!e)return{error:Lo};const t=Ja(e.venues||[]),n=t.reduce(((e,t)=>{var n;return null!=t&&null!==(n=t.courts)&&void 0!==n&&n.length?e.concat(t.courts):e}),[]);return{venues:t,courts:n}}function ec({tournamentRecord:e,venueId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing venueId"};const n=(e.venues||[]).reduce(((e,n)=>n.venueId===t?n:e),void 0);return n&&{venue:n}||{error:"Venue not found"}}function tc({tournamentRecord:e,courtId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing courtId"};let n,i;return(e.venues||[]).forEach((e=>{(e.courts||[]).forEach((r=>{r.courtId===t&&(n=r,i=e)}))})),n&&{court:n,venue:i}||{error:"Court not found"}}function nc({tournamentRecord:e,venueId:t,venueIds:n}){return e?{courts:(e.venues||[]).filter((e=>t?e.venueId===t:n?n.includes(e.venueId):!t&&!n)).map((e=>{const{venueId:t}=e,n=Ja(e.courts||[]);return n.forEach((e=>Object.assign(e,{venueId:t}))),n})).flat()}:{error:Lo}}function ic({tournamentRecord:e,courtId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing courtId"};const{court:n,error:i}=tc({tournamentRecord:e,courtId:t});if(i)return{error:i};const r=(({altitude:e,courtId:t,courtName:n,courtDimensions:i,latitude:r,longitude:o,surfaceCategory:a,surfaceType:s,surfaceDate:c,pace:u,notes:d})=>({altitude:e,courtId:t,courtName:n,courtDimensions:i,latitude:r,longitude:o,surfaceCategory:a,surfaceType:s,surfaceDate:c,pace:u,notes:d}))(n);return h(f({},ko),{courtInfo:Ja(r)})}function rc({tournamentRecord:e,venueId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing venueId"};const{venue:n,error:i}=ec({tournamentRecord:e,venueId:t});if(i)return{error:i};const r=(n.courts||[]).map((t=>(({courtInfo:e})=>f({},e))(ic({tournamentRecord:e,courtId:t.courtId})))),o=(({venueId:e,venueName:t,venueAbbreviation:n})=>({venueId:e,venueName:t,venueAbbreviation:n}))(n),a=h(f({},o),{courtsInfo:r});return h(f({},ko),{venueData:Ja(a)})}function oc({scheduleVisibilityFilters:e,afterRecoveryTimes:t=!0,tournamentRecord:n,scheduleTiming:i,matchUpFormat:r,matchUpType:o,matchUp:a,event:s}){if(!a)return{error:"Missing matchUp"};if(!a.matchUpType&&!o&&(s||n)&&a.drawId){var c,u,d,l,p,m;let e=null===(c=s)||void 0===c?void 0:c.drawDefinitions.find((e=>e.drawId===a.drawId));!e&&n&&({drawDefinition:e,event:s}=_s({tournamentRecord:n,drawId:a.drawId}));const t=a.structureId&&(null===(u=e)||void 0===u||null===(d=u.structures)||void 0===d?void 0:d.find((({structureId:e})=>e===a.structureId)));o=(null==t?void 0:t.matchUpType)||(null===(l=e)||void 0===l?void 0:l.matchUpType)||(null===(p=s)||void 0===p?void 0:p.eventType)!==Qs&&(null===(m=s)||void 0===m?void 0:m.eventType)}const{milliseconds:h,time:v}=ws({matchUp:a}),{startTime:g}=function({matchUp:e}){const t=(null==e?void 0:e.timeItems)||[],n=e=>e.createdAt?new Date(e.createdAt).getTime():0,i=t.reduce(((e,t)=>{const i=t.itemType===fs&&t;return i&&(!e||n(i)<n(e))?i:e}),void 0);return{startTime:i&&i.itemValue}}({matchUp:a}),{endTime:I}=function({matchUp:e}){const t=(null==e?void 0:e.timeItems)||[],n=e=>e.createdAt?new Date(e.createdAt).getTime():0,i=t.reduce(((e,t)=>{const i=t.itemType===gs&&t;return i&&(!e||n(i)>n(e))?i:e}),void 0);return{endTime:i&&i.itemValue}}({matchUp:a});let y;const{visibilityThreshold:w,eventIds:U,drawIds:b}=e||{};if(U&&!U.includes(a.eventId)||b&&!b.includes(a.drawId))y=Za({time:v,startTime:g,endTime:I,milliseconds:h});else{var S;const e={matchUp:a,visibilityThreshold:w};let{scheduledDate:s}=Hs(e);const{scheduledTime:c}=zs(e),{courtId:u}=Ks(e),{venueId:d}=Ys(e);let l,p,m,U,b;if(null!=i&&i.policy&&c&&t){const e=f({matchUpFormat:a.matchUpFormat||r},i);({averageMinutes:p=0,recoveryMinutes:m=0,typeChangeRecoveryMinutes:U=0}=Gs({eventType:a.matchUpType||o,timingDetails:e})),(p||m)&&(l=I?qa(Ba(I),m):qa(c,p+m)),U&&(b=I?qa(Ba(I),U):qa(c,p+U))}!s&&c&&(s=Va(c));const P=Ba(c);let D=Va(s);D&&P&&(D+=`T${P}`);const N=(null===(S=n&&d&&rc({tournamentRecord:n,venueId:d}))||void 0===S?void 0:S.venueData)||{},{venueName:M,venueAbbreviation:T,courtsInfo:E}=N,A=u&&(null==E?void 0:E.find((e=>e.courtId===u)));y=Za({typeChangeTimeAfterRecovery:b,timeAfterRecovery:l,scheduledDate:s,scheduledTime:c,isoDateString:D,venueAbbreviation:T,venueName:M,venueId:d,courtName:null==A?void 0:A.courtName,courtId:u,typeChangeRecoveryMinutes:U,recoveryMinutes:m,averageMinutes:p,milliseconds:h,startTime:g,endTime:I,time:v})}const P=ao.includes(a.matchUpStatus),{scheduledDate:D}=Hs({matchUp:a}),{scheduledTime:N}=zs({matchUp:a});return{schedule:y,endDate:P&&(Va(I)||Va(D)||Va(N))||void 0}}function ac({matchUps:e,matchUpId:t}){return{matchUp:(e||[]).find((e=>e.matchUpId===t))}}function sc({checkCollectionIds:e=!0,tieFormat:t}={}){var n,i,r,o;const a=[];if("object"!=typeof t)return a.push("tieformat must be an object"),{error:"Invalid tieFormat",errors:a};if("object"!=typeof t.winCriteria)return a.push("tieFormat.winCriteria must be an object"),{error:"Invalid tieFormat",errors:a};if(!Array.isArray(t.collectionDefinitions))return a.push("tieFormat.collectionDefinitiosn must be an array of objects"),{error:"Invalid tieFormat",errors:a};const s="number"==typeof(null===(n=t.winCriteria)||void 0===n?void 0:n.valueGoal)&&(null===(i=t.winCriteria)||void 0===i?void 0:i.valueGoal)>0||(null===(r=t.winCriteria)||void 0===r?void 0:r.aggregateValue);if(!(s||null!==(o=t.winCriteria)&&void 0!==o&&o.aggregateValue))return a.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),{error:"Invalid tieFormat",errors:a};const c=t.collectionDefinitions.every((t=>{if("object"!=typeof t)return a.push(`collectionDefinition must be an object: ${t}`),!1;const{collectionValueProfile:n,collectionGroupNumber:i,collectionValue:r,collectionId:o,matchUpCount:s,matchUpFormat:c,matchUpValue:u,matchUpType:d,scoreValue:l,setValue:p}=t;if(e&&"string"!=typeof o)return a.push(`collectionId is not type string: ${o}`),!1;if("number"!=typeof s)return a.push(`matchUpCount is not type number: ${s}`),!1;if(![Ls,js].includes(d))return a.push(`matchUpType must be SINGLES or DOUBLES: ${d}`),!1;if(!(u||r||n||l||p))return a.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfile"),!1;if(u&&"number"!=typeof u)return a.push(`matchUpValue is not type number: ${u}`),!1;if(r&&"number"!=typeof r)return a.push(`collectionValue is not type number: ${r}`),!1;if(n){if(!Array.isArray(n))return a.push(`collectionValueProfile is not an array: ${n}`),!1;if(n.length!==s)return a.push("collectionValueProfile does not align with matchUpsCount"),!1;for(const t of n){if("object"!=typeof t)return a.push(`valueProfile is not type object: ${t}`),!1;const{value:e,collectionPosition:n}=t;if("number"!=typeof e||"number"!=typeof n||n>s||n<1)return a.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),!1}const e=n.map((e=>e.collectionPosition));if(e.length!==bo(e).length)return a.push("collectionPositions are not unique"),!1}return i&&"number"!=typeof i?(a.push(`collectionValue is not type number: ${r}`),!1):!(c&&!Gr.isValid(c)&&(a.push(`Invalid matchUpFormat: ${c}`),1))})),u=t.collectionDefinitions.map((({collectionId:e})=>e)),d=!e||u.length===bo(u).length,l=c&&s&&d,p={valid:l,errors:a};return l||(p.error="Invalid tieFormat"),p}function cc({sideAdjustments:e=[0,0],separator:t="-",tieFormat:n,matchUp:i}){var r,o;if(!Array.isArray(e)||2!==e.length||isNaN(e.reduce(((e,t)=>e+t))))return{error:_o};if(!i)return{error:"Missing matchUp"};if(!(n=i.tieFormat||n))return{error:"Missing tieFormat"};const a=sc({tieFormat:n});if(!a.valid)return{error:_o,errors:a.errors};const s=[0,0],c=(null==i?void 0:i.tieMatchUps)||[],u=(null===(r=n)||void 0===r?void 0:r.collectionDefinitions)||[];for(const h of u){const e=c.filter((e=>e.collectionId===h.collectionId)),t=[0,0];let n=[0,0];const i=e.every((e=>ao.includes(e.matchUpStatus))),{collectionValueProfile:r,collectionValue:o,matchUpValue:a,winCriteria:u,scoreValue:d,setValue:l}=h;if(a?e.forEach((e=>{e.winningSide&&(t[e.winningSide-1]+=a)})):l?e.forEach((e=>{var n,i;null===(n=e.score)||void 0===n||null===(i=n.sets)||void 0===i||i.forEach((e=>{e.winningSide&&(t[e.winningSide-1]+=l)}))})):d?e.forEach((e=>{var n,i;null===(n=e.score)||void 0===n||null===(i=n.sets)||void 0===i||i.forEach((e=>{const{side1Score:n=0,side2Score:i=0}=e;t[0]+=n,t[1]+=i}))})):Array.isArray(r)&&e.forEach((e=>{if(e.winningSide){const n=e.collectionPosition,i=uc({collectionDefinition:h,collectionPosition:n});t[e.winningSide-1]+=i}})),o){const r=[0,0];let a;if(e.forEach((e=>{e.winningSide&&(r[e.winningSide-1]+=1)})),null!=u&&u.aggregateValue)i&&t[0]!==t[1]&&(a=t[0]>t[1]?1:2);else if(null!=u&&u.valueGoal)a=t.reduce(((e,t,n)=>t>=u.valueGoal?n+1:e),void 0);else{const e=Math.floor(h.matchUpCount/2)+1;a=r.reduce(((t,n,i)=>n>=e?i+1:t),void 0)}a&&(n[a-1]+=o)}else n=t;n.forEach(((e,t)=>s[t]+=e))}const d=s.map(((t,n)=>t+e[n])),l={side1Score:d[0],side2Score:d[1]},p=d.join(t),m=d.slice().reverse().join(t);let f;if(null!==(o=n)&&void 0!==o&&o.winCriteria){const{valueGoal:e,aggregateValue:t}=n.winCriteria;if(e){const t=d.map(((e,t)=>({sideNumber:t+1,points:e}))).find((({points:t})=>t>=e));f=null==t?void 0:t.sideNumber}else if(t){c.every((e=>ao.includes(e.matchUpStatus)||e.winningSide))&&d[0]!==d[1]&&(f=d[0]>d[1]?1:2)}}return{scoreStringSide1:p,scoreStringSide2:m,winningSide:f,set:l}}function uc({collectionDefinition:e,collectionPosition:t}){const n=e.collectionValueProfile||[],i=null==n?void 0:n.find((e=>e.collectionPosition===t));return null==i?void 0:i.matchUpValue}const dc="INDIVIDUAL",lc="TEAM",pc="PAIR",mc="GROUP",fc={INDIVIDUAL:dc,TEAM:lc,PAIR:pc,GROUP:mc},hc=e=>{var t;const{isSide1:n,lowValue:i,setTo:r,tiebreakAt:o,NoAD:a}=e;if(void 0===i)return{error:$o};let s,c=parseInt(i);return(null===(t=c)||void 0===t?void 0:t.toString().length)>2&&(c=parseInt(c.toString().slice(0,2))),o&&o<r&&c>o&&(c=o),s=a&&!o?c<r?r:r-1:c+1<r||o&&o<r&&c===o?r:o?r+1:c+2,[n?c:s,n?s:c]},vc=e=>{var t;const{isSide1:n,lowValue:i,tiebreakTo:r,tiebreakNoAd:o}=e;if(void 0===i)return{error:$o};let a=parseInt(i);(null===(t=a)||void 0===t?void 0:t.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),o&&a>r-1&&(a=r-1);const s=function(e){const{lowValue:t,NoAD:n,tiebreakTo:i}=e;return t+1>=i?t+(n?1:2):i}({lowValue:a,NoAD:o,tiebreakTo:r});return[n?a:s,n?s:a]};function gc({analysis:e,set:t}){const n=yc({set:t}),{isDecidingSet:i,isTiebreakSet:r,matchUpScoringFormat:o}=e;return Ic({matchUpScoringFormat:o,isDecidingSet:i,isTiebreakSet:r,set:t})&&n}function Ic({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:n,isTiebreakSet:i,isDecidingSet:r,set:o}){var a;if(!o)return{error:$o};t=t||n;const s=r&&t.finalSetFormat||(null===(a=t)||void 0===a?void 0:a.setFormat)||{},{side1Score:c,side2Score:u}=o,{NoAD:d,setTo:l,tiebreakAt:p,tiebreakFormat:m}=s,f=null==m?void 0:m.NoAd,h=yc({set:o}),v=Math.abs(c-u),g=c>=l||u>=l,I=i||c>=l&&u>=l||p&&p<l&&(c===p||u===p),y=e||I&&(1===h&&o.side1TiebreakScore>o.side2TiebreakScore||2===h&&o.side2TiebreakScore>o.side1TiebreakScore);return(g&&(v>=(d||I&&(p&&!i||i&&f)?1:2)||I)||i)&&(!I||y)}function yc({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}const wc=["RET","DEF","WO","WO/WO","ABN","SUS","INT"],Uc="ABANDONED",bc="SUSPENDED",Sc="INTERRUPTED",Pc=["RETIRED","DEFAULTED","WALKOVER"],Dc="backspace",Nc=["r","d","w","a","s","i"],Mc=["[","("],Tc=["up","left","shift+tab","enter","down","tab","right","space","]"],Ec="-",Ac="-",Rc=["/"],Cc=["0","1","2","3","4","5","6","7","8","9"].concat(Nc),xc=Cc.map((e=>`shift+${e}`)),Oc=[Cc,xc,[Ec,Dc].concat(Tc,Rc)].join(",");function kc({scoreString:e,lowSide:t,outcome:n}){return({scoreString:e}=Fc({scoreString:e})),2===t?e+(" "!==(e&&e[e.length-1])?" ":"")+n:n+" "+e}function Fc({scoreString:e}){if(!e)return{scoreString:""};let t=!1;for(const i of wc){var n;const r=null===(n=e)||void 0===n?void 0:n.indexOf(i);0===r?e=e.slice(i.length+1).trim()+" ":r>0&&(e=e.slice(0,r)),r>=0&&(t=!0)}return e&&e.trim()||(e=""),{scoreString:e,removed:t}}function Lc({analysis:e,scoreString:t,sets:n,lowSide:i}){let r,o;if(!t)return{scoreString:t,sets:n};const{scoreString:a,removed:s}=Fc({scoreString:t});if(t=a,s)return{scoreString:t,sets:n,outcomeRemoved:!0};let c=n[n.length-1]||{};const u=Object.values(c).filter((e=>void 0!==e)).length;c.setNumber&&1===u&&(c=(n=n.slice(0,n.length-1))[n.length-1]||{});const{tiebreakSet:d}=e.setFormat,{tiebreakTo:l,NoAD:p}=d||{},{isTiebreakEntry:m}=jc({scoreString:t,brackets:"[]"}),f=t.split("").reduce(((e,t,n)=>(t.match(/\d+/g)&&e.push(n),e)),[]).pop();if(f>=0){r=t.slice(0,f);const{isTiebreakEntry:a}=jc({scoreString:r,brackets:"()"}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=jc({scoreString:r,brackets:"[]"}),d=r&&r[r.length-1].trim(),b=r&&!isNaN(d);let S=e.isIncompleteSetScore;if(m&&u){const e=r.slice(s+1).split(Ac),n=(null==e?void 0:e.length)>0&&void 0!==e[0]&&!isNaN(parseInt(e[0]))&&parseInt(e[0])||void 0,o=(null==e?void 0:e.length)>1&&void 0!==e[1]&&parseInt(e[1])||void 0,a=[n,o];if(o){const e=1===i?1:0;a[e]=a[1-e]+(p?1:2),a[e]<l&&(a[e]=l),r=t.slice(0,s+1),r+=a.join(Ac)}else void 0!==n?(r=t.slice(0,s+1),r+=n):(r=t.slice(0,s),S=!0);c.side1TiebreakScore=a[0]||0,c.side2TiebreakScore=a[1]||0}if(r.length||(r=void 0),S){var h;const t=null===(h=c.side1Score)||void 0===h?void 0:h.toString();if(t){const e=null==t?void 0:t.slice(0,t.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}var v,g;e.isTimedSet?(o=c.side1Score?n:(null===(v=n)||void 0===v?void 0:v.slice(0,n.length-1))||[],o[n.length-1]=c):o=(null===(g=n)||void 0===g?void 0:g.slice(0,n.length-1))||[]}else if(b){var I,y;const t=null===(I=c.side2Score)||void 0===I?void 0:I.toString(),i=null===(y=c.side1Score)||void 0===y?void 0:y.toString();if(!e.isTiebreakEntry&&!e.isMatchTiebreak)if(c.side2Score){const e=null==t?void 0:t.slice(0,t.length-1);c.side2Score=!isNaN(e)&&parseInt(e)||void 0}else{const e=null==i?void 0:i.slice(0,i.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0}var w;e.isTimedSet?c.side1Score?(o=n||[],o[n.length-1]=c):o=(null===(w=n)||void 0===w?void 0:w.slice(0,n.length-1))||[]:(o=n||[],o[n.length-1]=c),o[o.length-1]&&Object.assign(o[o.length-1],{winningSide:void 0})}else if(a)o=n||[],Object.assign(o[o.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0});else{var U;m&&!u?o=(null===(U=n)||void 0===U?void 0:U.slice(0,n.length-1))||[]:(o=n,o[n.length-1]=c),m||(o[o.length-1].side2Score=0,o[o.length-1].winningSide=void 0)}return{scoreString:r,sets:o}}return{scoreString:t,sets:n}}function jc({scoreString:e,brackets:t="()"}){if(!e)return!1;const[n,i]=t.split(""),r=e.split(""),o=Math.max(...Ao(n,r));return{isTiebreakEntry:o>Math.max(...Ao(i,r)),lastOpenBracketIndex:o}}function Bc({lowValue:e=0,NoAD:t=!1,tiebreakTo:n}={}){return e+1>=n?e+(t?1:2):parseInt(n)}function Vc({matchUpFormat:e,matchUpStatus:t,winningSide:n,sets:i}){const r=kr(e),{bestOf:o}=r,a=Math.ceil(o/2),s=i&&i.reduce(((e,t)=>{const{winningSide:n}=t;return n&&e[n-1]++,e}),[0,0]);let c=(null==s?void 0:s.indexOf(a))+1||void 0;return Pc.includes(t)&&n&&(c=n),{matchUpWinningSide:c}}function $c({lowSide:e,value:t,sets:n,scoreString:i,winningSide:r,matchUpStatus:o}){let a;return"r"===t?i?(a=!0,i=kc({scoreString:i,lowSide:e,outcome:"RET"}),r=2===e?1:2,o="RETIRED"):(a=!0,i=kc({scoreString:i,lowSide:e,outcome:"DEF"}),r=2===e?1:2,o="DEFAULTED"):"d"===t?(a=!0,i=kc({scoreString:i,lowSide:e,outcome:"DEF"}),r=2===e?1:2,o="DEFAULTED"):"w"===t?(a=!0,n=[],i="WO",r=2===e?1:2,o="WALKOVER"):"s"===t&&i?(a=!0,i=kc({scoreString:i,lowSide:e,outcome:"SUS"}),o=bc,r=void 0):"a"===t?(a=!0,i=kc({scoreString:i,lowSide:e,outcome:"ABN"}),o=Uc,r=void 0):"i"===t&&i&&(a=!0,i=kc({scoreString:i,lowSide:e,outcome:"INT"}),o=Sc,r=void 0),{updated:a,sets:n,scoreString:i,matchUpStatus:o,winningSide:r}}function Gc(e){const{sets:t,winningSide:n,autoComplete:i,matchUpStatus:r,reversed:o=!1,winnerFirst:a=!0,addOutcomeString:s}=e;if(!t)return{error:$o};const c=o||!(!a||!n||1===n),u=s?function({matchUpStatus:e}){return e&&{[Qr]:"RET",[to]:"WO",[Yr]:"WO/WO",[Xr]:"SUS",[Wr]:"ABN",[Kr]:"DEF",DEAD_RUBBER:"DR"}[e]||""}({matchUpStatus:r}):"",d=(null==t?void 0:t.sort(_c).map((function(e){const t=!(ho(null==(l=e)?void 0:l.side1Score)||ho(null==l?void 0:l.side2Score))&&(ho(null==(d=e)?void 0:d.side1TiebreakScore)||ho(null==d?void 0:d.side2TiebreakScore)),{side1Score:n,side2Score:r,side1TiebreakScore:o,side2TiebreakScore:a}=e,s=o||(ho(o)||i?0:""),u=a||(ho(a)||i?0:"");var d,l;if(t)return`[${(c?[u,s]:[s,u]).join("-")}]`;const p=Math.min(s,u),m=p?`(${p})`:"",f=n||(ho(n)||i?0:""),h=r||(ho(r)||i?0:"");let v=c?`${[h,f].join("-")}${m}`:`${[f,h].join("-")}${m}`;return["-"," "].includes(v)&&(v=""),v})).filter(Boolean).join(" "))||"";return u?2===n?`${u} ${d}`:`${d} ${u}`:d}function _c(e,t){return e.setNumber-t.setNumber}function Wc({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:n,setObject:i}){if(!i)return;const r=qc({set:i});return function({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:n,isTiebreakSet:i,isDecidingSet:r,set:o}){var a;if(!o)return{error:$o};t=t||n;const s=r&&t.finalSetFormat||(null===(a=t)||void 0===a?void 0:a.setFormat)||{},{side1Score:c,side2Score:u}=o,{setTo:d,tiebreakAt:l,tiebreakFormat:p}=s,m=null==p?void 0:p.NoAd,f=qc({set:o}),h=Math.abs(c-u),v=c>=d||u>=d,g=i||c>=d&&u>=d||l&&l<d&&(c===l||u===l),I=e||g&&(1===f&&o.side1TiebreakScore>o.side2TiebreakScore||2===f&&o.side2TiebreakScore>o.side1TiebreakScore);return(v&&(h>=(g&&(l&&!i||i&&m)?1:2)||g)||i)&&(!g||I)}({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:n,set:i})&&r||void 0}function qc({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}function zc(e){const{setObject:t,matchUpScoringFormat:n}=e;if(!t)return{error:"Missing setObject"};const{setNumber:i}=t||{},{bestOf:r}=n||{},o=!(!i||!r||i!==r),a=o&&(null==n?void 0:n.finalSetFormat)||(null==n?void 0:n.setFormat),s=!(null==a||!a.tiebreakSet),c=!(null==a||!a.timed),u=!s&&!c,d=!!(i&&r&&i<=r),l=[null==t?void 0:t.side1Score,null==t?void 0:t.side2Score],p=[null==t?void 0:t.side1PointScore,null==t?void 0:t.side2PointScore],m=[null==t?void 0:t.side1TiebreakScore,null==t?void 0:t.side2TiebreakScore],f=l.filter((e=>void 0!==e)).length,h=p.filter((e=>void 0!==e)).length,v=m.filter((e=>void 0!==e)).length,g=null==l?void 0:l.filter((e=>!isNaN(e))).length,I=null==m?void 0:m.filter((e=>!isNaN(e))).length,{tiebreakAt:y}=a||{},w=y&&2===l.filter((e=>e>=y)).length,U=w&&(l[0]>l[1]?1:l[1]>l[0]?2:void 0),b=!(!I||g),S=!(!t||null==t||!t.winningSide),{error:P,result:D}=function({setObject:e,setFormat:t,sideGameScores:n,sideTiebreakScores:i}){if(!e)return{result:!1,error:"Missing setObject"};const r=!(null==t||!t.tiebreakSet),o=!(null==t||!t.timed);if(!t||r||o)return{result:!1,error:"not standard set"};if(2!==(null==n?void 0:n.filter((e=>!isNaN(e))).length))return{result:!1,error:"Invalid game scores"};const{setTo:a,tiebreakAt:s,tiebreakFormat:c,NoAD:u}=t||{};if(!a||null==n||!n.find((e=>e>=a)))return{result:!1,error:"Invalid game scores"};const d=[1,2].includes(null==e?void 0:e.winningSide);if(!e||!d)return{result:!1,error:"Invalid winningSide"};const l=(null==e?void 0:e.winningSide)-1,p=1-l,m=n[l],f=n[p],h=m-f;if(!(m>f))return{result:!1,error:"winningSide game scoreString is not high"};const v=s&&c,g=2===(null==i?void 0:i.filter((e=>!isNaN(e))).length),I=i&&i[l],y=i&&i[p],w=s&&2===n.filter((e=>e>=s)).length;if(v){const{NoAD:e,tiebreakTo:t}=c;if(w){if(h>1)return{result:!1,error:"invalid winning game scoreString (5)"};if(!g)return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(t))return{result:!1,error:"tiebreakTo error"};if(!t||null==i||!i.find((e=>e>=t)))return{result:!1,error:"invalid tiebreak scores (2)"};if(m>(s<a?a:a+1))return{result:!1,error:"invalid winning game scoreString (1)"};if(!I||!y||I<y)return{result:!1,error:"winningSide tiebreak value is not high"};const n=e?1:2,r=I-y,o=y>=t-1;if(r&&o&&r<n)return{result:!1,error:"invalid tiebreak scores (3)"}}if(m>a&&(!v||!w))return{result:!1,error:"invalid winning game scoreString (2)"}}const U=u?1:2;return h&&f>=a-1&&!w&&h<U?{result:!1,error:"invalid winning game scoreString (3)"}:h>U&&m>a?{result:!1,error:"invalid winning game scoreString (4)"}:{result:!0}}({setObject:t,setFormat:a,sideGameScores:l,sideTiebreakScores:m}),{error:N,result:M}=function({setObject:e,setFormat:t,sideTiebreakScores:n}){if(!e)return{result:!1,error:"Missing setObject"};const i=!(null==t||!t.tiebreakSet),r=!(null==t||!t.timed);if(!t||!i||r)return{result:!1,error:"not tiebreak set"};const o=[1,2].includes(null==e?void 0:e.winningSide);if(!e||!o)return{result:!1,error:"Invalid winningSide"};const{tiebreakSet:a}=t||{},{NoAD:s,tiebreakTo:c}=a||{};if(2!==(null==n?void 0:n.filter((e=>!isNaN(e))).length))return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(c))return{result:!1,error:"tiebreakTo error"};if(null==n||!n.find((e=>e>=c)))return{result:!1,error:"invalid tiebreak scores (2)"};const u=(null==e?void 0:e.winningSide)-1,d=1-u,l=n[u],p=n[d];if(!l||!p||l<p)return{result:!1,error:"winningSide tiebreak value is not high"};const m=l-p;return m&&p>=c-1&&m<(s?1:2)?{result:!1,error:"invalid tiebreak scores (3)"}:{result:!0}}({setObject:t,setFormat:a,sideTiebreakScores:m}),T=u&&!b&&D||s&&b&&M,E={expectTiebreakSet:s,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:S,isDecidingSet:o,isTiebreakSet:b,isValidSet:d&&!(s&&!b)&&!(u&&b)&&(!S||T),isValidSetNumber:d,isValidSetOutcome:T,leadingSide:U,setFormat:a,sideGameScores:l,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:h,sideTiebreakScores:m,sideTiebreakScoresCount:v,winningSide:Wc({isDecidingSet:o,isTiebreakSet:b,matchUpScoringFormat:n,setObject:t})};return void 0!==(null==t?void 0:t.winningSide)&&(b?(E.isValidTiebreakSetOutcome=M,M||(E.tiebreakSetError=N)):(E.isValidStandardSetOutcome=D,D||(E.standardSetError=P))),E}function Hc(e){var t;const{matchUp:n,sideNumber:i,setNumber:r,isTiebreakValue:o,isPointValue:a}=e||{};let{matchUpFormat:s}=e||{};if(!n)return{error:"Missing matchUp"};s=s||(null==n?void 0:n.matchUpFormat);const c=kr(s),u=!(null==n||!n.winningSide),d=null===(t=n.score)||void 0===t?void 0:t.sets,l=null==d?void 0:d.length,p=r&&r-1,m=!(null==d||!d.find(((e,t)=>e.setNumber===r&&t===p))),h=(null==d?void 0:d.filter((e=>null==e?void 0:e.winningSide)))||[],v=(null==h?void 0:h.length)||0,g=r&&(null==d?void 0:d.slice(r))||[],I=!!(l&&r&&null!=g&&g.reduce(((e,t)=>(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e),!0)),y=r<=l&&d.find((e=>e.setNumber===r)),w=y&&zc({setObject:y,matchUpScoringFormat:c}),{isCompletedSet:U,sideGameScores:b,sideTiebreakScores:S}=w||{},P=!!(y&&!U&&I||r&&r===l+1&&!u),D=[1,2].includes(i),N=D?i-1:0,M=y&&D&&(!o&&!a&&void 0!==b[N]&&b[N]||o&&void 0!==S[N]&&S[N]),T=!!M,E=h&&h.map((e=>zc({setObject:e,matchUpScoringFormat:c}).isValidSetOutcome)).reduce(((e,t)=>e&&t),!0),A=h.reduce(((e,t)=>{const{winningSide:n}=t;return e[n-1]++,e}),[0,0]),R=null==n?void 0:n.winningSide,C=R&&R-1,x=1-C,O=A[C],k=A[x],F=Math.max(...A),L=Po(A)[F],{bestOf:j}=c||{},B=F===(j&&Math.ceil(j/2)||1)&&1===L&&A.indexOf(F)+1||void 0,V=O>k&&R===B;return f({isActiveSet:P,isExistingSet:m,existingValue:M,hasExistingValue:T,isValidSideNumber:D,completedSetsCount:v,isCompletedMatchUp:u,isLastSetWithValues:I,validMatchUpOutcome:B&&E&&V,matchUpScoringFormat:c,calculatedWinningSide:B,validMatchUpWinningSide:V,completedSetsHaveValidOutcomes:E},w)}const Kc={stringifyMatchUpFormat:Ar,isValidMatchUpFormat:$r,parseMatchUpFormat:kr,generateTieMatchUpScore:cc,tallyParticipantResults:us,getTiebreakComplement:vc,generateScoreString:Gc,checkSetIsComplete:Ic,validateTieFormat:sc,getSetComplement:hc,analyzeMatchUp:Hc,keyValueScore:function(e){let{lowSide:t=1,value:n}=e,{scoreString:i,sets:r,winningSide:o,matchUpStatus:a}=e;const{matchUpFormat:s,shiftFirst:c,auto:u=!0}=e;let d,l;const p=c&&2===t||!c&&1===t;if(!Oc.includes(n))return{updated:!1,message:"invalid key"};c&&(t=3-t);const{matchUpWinningSide:m}=Vc({sets:r,winningSide:o,matchUpStatus:a,matchUpFormat:s});o=m;const f=function({sets:e,scoreString:t,winningSide:n,matchUpFormat:i,value:r}){var o,a;const s=((null==e||null===(o=e.filter((e=>null==e?void 0:e.winningSide)))||void 0===o?void 0:o.length)||0)+(n?0:1),c=kr(i),u=s===(null==c?void 0:c.bestOf),d=u&&c.finalSetFormat||c.setFormat||{},l=(null==d?void 0:d.timed)||c.timed,p=u&&e[(null==c?void 0:c.bestOf)-1],m=p&&p.winningSide,{isTiebreakEntry:f}=jc({scoreString:t,brackets:"()"}),{isTiebreakEntry:h}=jc({scoreString:t,brackets:"[]"}),v=f||h,g=!!d.tiebreakSet,I=t&&t[t.length-1].trim(),y=t&&!isNaN(I),w=!v&&I===Ec,U=f&&Mc.includes(I),b=h&&Mc.includes(I),S=h&&I===Ac,P=t&&t.split(""),[D]="[]".split(""),N=P&&Math.max(...Ao(D,P)),M=P&&Math.max(...Ao(Ac,P)),T=P&&M>N,E=null===(a=e[e.length-1])||void 0===a?void 0:a.winningSide,A=(null==e?void 0:e.length)&&!E,R=wc.find((e=>(null==t?void 0:t.indexOf(e))>=0)),C=!isNaN(r),x="space"===r,O=Tc.includes(r),k=null==t?void 0:t.split("").find((e=>Mc.includes(e)));return{isTiebreakSetValue:g&&C,matchUpScoringFormat:c,setNumber:s,setFormat:d,matchTiebreakHasJoiner:T,isGameScoreEntry:A,isSpace:x,isCloser:O,isTiebreakCloser:O&&k&&v&&y,isDecidingSet:u,isTiebreakSet:g,isTimedSet:l,isNumericEnding:y,isNumericValue:C,hasOpener:k,hasOutcome:R,finalSet:p,finalSetIsComplete:m,lastSetIsComplete:E,isInvalidSetTiebreakValue:x&&v&&U,isInvalidMatchTiebreakValue:O&&h&&!b&&(S||!function({scoreString:e}){if(!e)return!1;const t=e&&e[e.length-1].trim(),n=e&&!isNaN(t),[i,r]="[]".split(""),o=e.split(""),a=Math.max(...Ao(i,o)),s=Math.max(...Ao(r,o)),c=Math.max(...Ao(Ac,o));return n&&a>s&&c>a}({scoreString:t})),isTiebreakEntry:v,isSetTiebreakEntry:f,isMatchTiebreakEntry:h,isIncompleteSetScore:w,isIncompleteSetTiebreak:U,isIncompleteMatchTiebreak:b,isPartialMatchTiebreakValue:S}}({value:n,winningSide:o,scoreString:i,sets:r,matchUpFormat:s});if(Rc.includes(n)&&(n=Ec),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===parseInt(n)&&(f.isTiebreakCloser=!0),Tc.includes(n)&&f.hasOpener&&(n=""),Tc.includes(n)&&(n="space"),f.lastSetIsComplete){var h;const e=(null===(h=i)||void 0===h?void 0:h.length)&&i[i.length-1];i&&" "!==e&&(i+=" ")}if(f.isTimedSet)({message:l,sets:r,scoreString:i,updated:d,matchUpStatus:a,winningSide:o}=function({analysis:e,lowSide:t,scoreString:n,sets:i,winningSide:r,matchUpStatus:o,message:a,value:s}){var c;let u,d;null!==(c=i)&&void 0!==c&&c.length||s===Dc||(i=[{setNumber:1}]);const l=i.length-1;if(Nc.includes(s)){const c=i[i.length-1]||{},{side1Score:d,side2Score:l}=c;d&&!l?a="missing side2Score":e.finalSetIsComplete||r?a="final set is already complete":e.isIncompleteSetScore?a="incomplete set scoreString":e.isIncompleteSetScore||({sets:i,scoreString:n,winningSide:r,matchUpStatus:o,updated:u}=$c({lowSide:t,value:s,sets:i,scoreString:n,matchUpStatus:o,winningSide:r}))}else if(s===Dc){var p;if(({scoreString:n,sets:i,outcomeRemoved:d}=Lc({analysis:e,scoreString:n,sets:i})),""===(null===(p=n)||void 0===p?void 0:p.trim())&&(n=n.trim()),n||(i=[]),d){const e=i[i.length-1]||{},{side1Score:t,side2Score:n}=e;if(t&&n){const r=t>n?1:n>t?2:void 0;r&&(e.winningSide=r,i.push({setNumber:i.length+1}))}}o=void 0,r=void 0,u=!0}else if(e.hasOutcome)a="has outcome";else{if(r)return{sets:i,scoreString:n,winningSide:r,matchUpStatus:o,updated:!1,message:"matchUp is complete"};if("space"===s){const t=i[i.length-1]||{},{side1Score:o,side2Score:a}=t,s=o>a?1:a>o?2:void 0;!s||r||e.isIncompleteSetScore||(i[i.length-1].winningSide=s,i.push({setNumber:i.length+1}),n+=" ",u=!0)}else if(s===Ec&&void 0!==i[l].side1Score&&void 0===i[l].side2Score&&n&&e.isNumericEnding)n+="-",i[l].side2Score=0,o=void 0,r=void 0,u=!0;else if(!isNaN(s)){let e;if(void 0===i[l].side2Score){const t=parseInt((i[l].side1Score||0).toString()+s).toString().slice(0,2);i[l].side1Score=parseInt(t),e=i[l].side1Score.toString(),u=!0}else{const t=parseInt((i[l].side2Score||0).toString()+s).toString().slice(0,2);i[l].side2Score=parseInt(t),e=[i[l].side1Score,i[l].side2Score].join("-"),u=!0}if(u){const t=(i.slice(0,l)||[]).filter((e=>e)).map((e=>{const{side1Score:t,side2Score:n}=e;return[t,n].join("-")})).join(" ");n=t?t+" "+e:e}}}return{sets:i,scoreString:n,winningSide:r,matchUpStatus:o,message:a,updated:u}}({analysis:f,lowSide:t,scoreString:i,sets:r,matchUpStatus:a,winningSide:o,value:n}));else if(Nc.includes(n))f.finalSetIsComplete||o?l="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?l="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:n}):({sets:r,scoreString:i,matchUpStatus:a,winningSide:o,updated:d}=$c({lowSide:t,sets:r,scoreString:i,matchUpStatus:a,winningSide:o,value:n}));else if(n===Dc)d=!0,({scoreString:i,sets:r}=Lc({analysis:f,scoreString:i,sets:r,lowSide:t,auto:u})),i||(r=[]),a=void 0,o=void 0;else if(f.hasOutcome)l="has outcome";else if(n!==Ec||f.isMatchTiebreakEntry)if(n===Ac&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?l="existing joiner":f.isNumericEnding&&(d=!0,i+=Ac);else if([Ec,Ac].includes(n))l="invalid location for joiner";else{if(o)return{updated:!1,message:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:i,updated:d}=function({analysis:e,scoreString:t,sets:n,value:i}){let r;if(null==n||!n.length)return{sets:[]};const o=n[n.length-1];i=parseInt(i);const{validSide2Score:a,requiresTiebreak:s}=function({analysis:e,set:t={},value:n}){const i=e.isDecidingSet&&e.matchUpScoringFormat.finalSetFormat||e.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:o,NoAD:a}=i,{side1Score:s}=t;let c,u;return c=r&&r<o?s===r?n<=o:n<=r:s===o?a?n<o:n<=o+1:s===o-1?a?n<=o:n<=o+1:s===o+1?n===o||n===o-1:n<=o,c&&(u=r&&r<o?s===o&&n===r||s===r&&n===o:s>=o&&n>=o&&s!==n),{validSide2Score:c,requiresTiebreak:u}}({analysis:e,set:o,value:i});if(a){r=!0,t=(t||"")+i,o.side2Score=i;const a=gc({analysis:e,set:n[n.length-1]});o.winningSide=a||void 0,s?t+="()".split("")[0]:e.isDecidingSet||(t+=" ")}return{sets:n,scoreString:t,updated:r}}({analysis:f,scoreString:i,sets:r,value:n}));else if(f.isInvalidMatchTiebreakValue)l="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)l="invalid set tiebreak character";else if(f.isTiebreakCloser){const e=f.isSetTiebreakEntry?"()":"[]",t=e.split("").reverse()[0],n=e.split("")[0],o=r[r.length-1],{tiebreakFormat:a}=f.setFormat,{tiebreakTo:s,NoAD:c}=a||{},u=yc({set:o});if(!f.isTiebreakSet){const e=parseInt(i.split(n).reverse()[0]),t=Bc({lowValue:e,tiebreakTo:s,NoAD:c});1===u?(o.side1TiebreakScore=t,o.side2TiebreakScore=e):(o.side1TiebreakScore=e,o.side2TiebreakScore=t)}i=(i||"")+t,f.isDecidingSet||(i+=" ");const l=gc({analysis:f,set:o});o.winningSide=l||void 0,d=!0}else if(f.isTiebreakSetValue)({message:l,scoreString:i,sets:r,updated:d}=function({analysis:e,auto:t,lowSide:n,scoreString:i="",sets:r,value:o}){let a,s;const{tiebreakSet:{tiebreakTo:c,NoAD:u}}=e.setFormat,[d]="[]".split("");if(e.isMatchTiebreakEntry||(i+=d),r[e.setNumber-1]){var l;const{lastOpenBracketIndex:e}=jc({scoreString:i,brackets:"[]"}),d=(i.slice(e+1)+(t?"":o)).split(Ac);if(((null===(l=d[n-1])||void 0===l?void 0:l.length)||0)>=2)s="tiebreak digit limit";else if(t){1===n&&(d[0]=(d[0]||"")+o),2===n&&(d[1]=(d[1]||"")+o);const t=[d[0]||0,d[1]||0].map((e=>parseInt(e))),s=1===n?1:0;t[s]=t[1-s]+(u?1:2),t[s]<c&&(t[s]=c);const l=r[r.length-1];l.side1TiebreakScore=t[0],l.side2TiebreakScore=t[1],i=i.slice(0,e+1),i+=t.join(Ac),a=!0}else{const e=[d[0]||0,d[1]||0].map((e=>parseInt(e))),t=r[r.length-1];t.side1TiebreakScore=e[0],t.side2TiebreakScore=e[1],i+=o,a=!0}}else{const e=Bc({lowValue:parseInt(o||0),tiebreakTo:c,NoAD:u}),t=[parseInt(o),e];2===n&&t.reverse();const s={side1TiebreakScore:t[0],side2TiebreakScore:t[1],setNumber:(null==r?void 0:r.length)+1||1};r.push(s),i+=t.join(Ac),a=!0}return{message:s,scoreString:i,sets:r,updated:a}}({analysis:f,auto:u,lowSide:t,scoreString:i,sets:r,value:n}));else if(f.isSetTiebreakEntry){const[e]="()".split(""),t=Math.max(...Ao(e,i.split(""))),r=i.slice(t+1),o=r&&0===parseInt(r),a=parseInt(r?r+n:n),{tiebreakFormat:s}=f.setFormat,{tiebreakTo:c,NoAD:u}=s||{};!o&&r.length<2?u&&a>c-1?l="invalid low value for NoAD tiebreak":(d=!0,i=(i||"")+n):l=o?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)l=`invalid key: ${n}`;else if(f.isGameScoreEntry)l="game scoreString entry";else if(f.lastSetIsComplete||!r.length){var v,g;d=!0;const{scoreString:e,set:o}=function({analysis:e,lowSide:t,scoreString:n,value:i}){const{setTo:r,tiebreakAt:o,NoAD:a}=null==e?void 0:e.setFormat,s=i===parseInt(o||r);if(o&&o<r&&i>o)return{scoreString:n};if(a&&i===r||i>r)return{scoreString:n};const c=[i,s?i+1:i+1===r?i+(a?1:2):r];2===t&&c.reverse();const u="()".split("")[0];n=(n||"")+(c.join(Ec)+(s?u:" "));const d={side1Score:c[0],side2Score:c[1]},l=gc({analysis:e,set:d});return d.winningSide=l||void 0,{scoreString:n,set:d}}({analysis:f,lowSide:t,scoreString:i,value:parseInt(n)});o&&(o.setNumber=(null===(v=r)||void 0===v?void 0:v.length)+1||1),r=(null===(g=r)||void 0===g?void 0:g.concat(o).filter(Boolean))||[o],i=e||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(d=!0,({scoreString:i,sets:r}=Lc({analysis:f,scoreString:i,sets:r,lowSide:t,auto:u})),a=void 0);if(d){var I;r=null===(I=r)||void 0===I?void 0:I.filter(Boolean);const{matchUpWinningSide:e}=Vc({sets:r,winningSide:o,matchUpStatus:a,matchUpFormat:s});return o=e,!e||a&&![eo,Zr].includes(a)?!i||o||[bc,Uc,Sc].includes(a)||(a=void 0):(a="COMPLETED",r=r.filter((e=>{const{side1Score:t,side2Score:n,side1TiebreakScore:i,side2TiebreakScore:r}=e;return t||n||i||r}))),{updated:d,scoreString:i,sets:r,winningSide:o,matchUpStatus:a,message:l}}return{updated:d,scoreString:i,sets:r,winningSide:o,matchUpStatus:a,message:l}},analyzeSet:zc},Yc=[{ioc:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso:"AD",label:"Andorra",phone:"376"},{ioc:"UAE",iso:"AE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso:"AF",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso:"AG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso:"AI",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso:"AL",label:"Albania",phone:"355"},{ioc:"ARM",iso:"AM",label:"Armenia",phone:"374"},{ioc:"ANG",iso:"AO",label:"Angola",phone:"244"},{ioc:"",iso:"AQ",label:"Antarctica",phone:"672"},{ioc:"ARG",iso:"AR",label:"Argentina",phone:"54"},{ioc:"ASA",iso:"AS",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso:"AT",label:"Austria",phone:"43"},{ioc:"AUS",iso:"AU",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso:"AW",label:"Aruba",phone:"297"},{ioc:"",iso:"AX",label:"Alland Islands",phone:"358"},{ioc:"AZE",iso:"AZ",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso:"BA",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso:"BB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso:"BD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso:"BE",label:"Belgium",phone:"32"},{ioc:"BUR",iso:"BF",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso:"BG",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso:"BH",label:"Bahrain",phone:"973"},{ioc:"BDI",iso:"BI",label:"Burundi",phone:"257"},{ioc:"BEN",iso:"BJ",label:"Benin",phone:"229"},{ioc:"",iso:"BL",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso:"BM",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso:"BN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso:"BO",label:"Bolivia",phone:"591"},{ioc:"BRA",iso:"BR",label:"Brazil",phone:"55"},{ioc:"BAH",iso:"BS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso:"BT",label:"Bhutan",phone:"975"},{ioc:"",iso:"BV",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso:"BW",label:"Botswana",phone:"267"},{ioc:"BLR",iso:"BY",label:"Belarus",phone:"375"},{ioc:"BIZ",iso:"BZ",label:"Belize",phone:"501"},{ioc:"CAN",iso:"CA",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso:"CC",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso:"CD",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso:"CF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso:"CG",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso:"CH",label:"Switzerland",phone:"41"},{ioc:"CIV",iso:"CI",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso:"CK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso:"CL",label:"Chile",phone:"56"},{ioc:"CMR",iso:"CM",label:"Cameroon",phone:"237"},{ioc:"CHN",iso:"CN",label:"China",phone:"86"},{ioc:"COL",iso:"CO",label:"Colombia",phone:"57"},{ioc:"CRC",iso:"CR",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso:"CU",label:"Cuba",phone:"53"},{ioc:"CPV",iso:"CV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso:"CW",label:"Curacao",phone:"599"},{ioc:"CXR",iso:"CX",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso:"CY",label:"Cyprus",phone:"357"},{ioc:"CZE",iso:"CZ",label:"Czech Republic",phone:"420"},{ioc:"GER",iso:"DE",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso:"DJ",label:"Djibouti",phone:"253"},{ioc:"DEN",iso:"DK",label:"Denmark",phone:"45"},{ioc:"DMA",iso:"DM",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso:"DO",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso:"DZ",label:"Algeria",phone:"213"},{ioc:"ECU",iso:"EC",label:"Ecuador",phone:"593"},{ioc:"EST",iso:"EE",label:"Estonia",phone:"372"},{ioc:"EGY",iso:"EG",label:"Egypt",phone:"20"},{ioc:"",iso:"EH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso:"ER",label:"Eritrea",phone:"291"},{ioc:"ESP",iso:"ES",label:"Spain",phone:"34"},{ioc:"ETH",iso:"ET",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso:"FI",label:"Finland",phone:"358"},{ioc:"FIJ",iso:"FJ",label:"Fiji",phone:"679"},{ioc:"FLK",iso:"FK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso:"FM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso:"FO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso:"FR",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso:"GA",label:"Gabon",phone:"241"},{ioc:"GBR",iso:"GB",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso:"GD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso:"GE",label:"Georgia",phone:"995"},{ioc:"FGU",iso:"GF",label:"French Guiana",phone:"594"},{ioc:"",iso:"GG",label:"Guernsey",phone:"44"},{ioc:"",iso:"GH",label:"Ghana",phone:"233"},{ioc:"GIB",iso:"GI",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso:"GL",label:"Greenland",phone:"299"},{ioc:"GAM",iso:"GM",label:"Gambia",phone:"220"},{ioc:"GUI",iso:"GN",label:"Guinea",phone:"224"},{ioc:"GUD",iso:"GP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso:"GQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso:"GR",label:"Greece",phone:"30"},{ioc:"",iso:"GS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso:"GT",label:"Guatemala",phone:"502"},{ioc:"GUM",iso:"GU",label:"Guam",phone:"1-671"},{ioc:"GBS",iso:"GW",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso:"GY",label:"Guyana",phone:"592"},{ioc:"HKG",iso:"HK",label:"Hong Kong",phone:"852"},{ioc:"",iso:"HM",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso:"HN",label:"Honduras",phone:"504"},{ioc:"CRO",iso:"HR",label:"Croatia",phone:"385"},{ioc:"HAI",iso:"HT",label:"Haiti",phone:"509"},{ioc:"HUN",iso:"HU",label:"Hungary",phone:"36"},{ioc:"INA",iso:"ID",label:"Indonesia",phone:"62"},{ioc:"IRL",iso:"IE",label:"Ireland",phone:"353"},{ioc:"ISR",iso:"IL",label:"Israel",phone:"972"},{ioc:"",iso:"IM",label:"Isle of Man",phone:"44"},{ioc:"IND",iso:"IN",label:"India",phone:"91"},{ioc:"",iso:"IO",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso:"IQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso:"IR",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso:"IS",label:"Iceland",phone:"354"},{ioc:"ITA",iso:"IT",label:"Italy",phone:"39"},{ioc:"",iso:"JE",label:"Jersey",phone:"44"},{ioc:"JAM",iso:"JM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso:"JO",label:"Jordan",phone:"962"},{ioc:"JPN",iso:"JP",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso:"KE",label:"Kenya",phone:"254"},{ioc:"KGZ",iso:"KG",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso:"KH",label:"Cambodia",phone:"855"},{ioc:"KIR",iso:"KI",label:"Kiribati",phone:"686"},{ioc:"COM",iso:"KM",label:"Comoros",phone:"269"},{ioc:"SKN",iso:"KN",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso:"KP",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso:"KR",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso:"KW",label:"Kuwait",phone:"965"},{ioc:"CAY",iso:"KY",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso:"KZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso:"LA",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso:"LB",label:"Lebanon",phone:"961"},{ioc:"LCA",iso:"LC",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso:"LI",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso:"LK",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso:"LR",label:"Liberia",phone:"231"},{ioc:"LES",iso:"LS",label:"Lesotho",phone:"266"},{ioc:"LTU",iso:"LT",label:"Lithuania",phone:"370"},{ioc:"LUX",iso:"LU",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso:"LV",label:"Latvia",phone:"371"},{ioc:"LBA",iso:"LY",label:"Libya",phone:"218"},{ioc:"MAR",iso:"MA",label:"Morocco",phone:"212"},{ioc:"MON",iso:"MC",label:"Monaco",phone:"377"},{ioc:"MDA",iso:"MD",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso:"ME",label:"Montenegro",phone:"382"},{ioc:"",iso:"MF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso:"MG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso:"MH",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso:"MK",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso:"ML",label:"Mali",phone:"223"},{ioc:"MYA",iso:"MM",label:"Myanmar",phone:"95"},{ioc:"MGL",iso:"MN",label:"Mongolia",phone:"976"},{ioc:"MAC",iso:"MO",label:"Macao",phone:"853"},{ioc:"NMA",iso:"MP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso:"MQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso:"MR",label:"Mauritania",phone:"222"},{ioc:"MNT",iso:"MS",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso:"MT",label:"Malta",phone:"356"},{ioc:"MRI",iso:"MU",label:"Mauritius",phone:"230"},{ioc:"MDV",iso:"MV",label:"Maldives",phone:"960"},{ioc:"MAW",iso:"MW",label:"Malawi",phone:"265"},{ioc:"MEX",iso:"MX",label:"Mexico",phone:"52"},{ioc:"MAS",iso:"MY",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso:"MZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso:"NA",label:"Namibia",phone:"264"},{ioc:"NCL",iso:"NC",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso:"NE",label:"Niger",phone:"227"},{ioc:"NFI",iso:"NF",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso:"NG",label:"Nigeria",phone:"234"},{ioc:"NCA",iso:"NI",label:"Nicaragua",phone:"505"},{ioc:"NED",iso:"NL",label:"Netherlands",phone:"31"},{ioc:"NOR",iso:"NO",label:"Norway",phone:"47"},{ioc:"NEP",iso:"NP",label:"Nepal",phone:"977"},{ioc:"NRU",iso:"NR",label:"Nauru",phone:"674"},{ioc:"NIU",iso:"NU",label:"Niue",phone:"683"},{ioc:"NZL",iso:"NZ",label:"New Zealand",phone:"64"},{ioc:"OMA",iso:"OM",label:"Oman",phone:"968"},{ioc:"PAN",iso:"PA",label:"Panama",phone:"507"},{ioc:"PER",iso:"PE",label:"Peru",phone:"51"},{ioc:"FPO",iso:"PF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso:"PG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso:"PH",label:"Philippines",phone:"63"},{ioc:"PAK",iso:"PK",label:"Pakistan",phone:"92"},{ioc:"POL",iso:"PL",label:"Poland",phone:"48"},{ioc:"SPM",iso:"PM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso:"PN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso:"PR",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso:"PS",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso:"PT",label:"Portugal",phone:"351"},{ioc:"PlW",iso:"PW",label:"Palau",phone:"680"},{ioc:"PAR",iso:"PY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso:"QA",label:"Qatar",phone:"974"},{ioc:"REU",iso:"RE",label:"Reunion",phone:"262"},{ioc:"ROU",iso:"RO",label:"Romania",phone:"40"},{ioc:"SRB",iso:"RS",label:"Serbia",phone:"381"},{ioc:"RUS",iso:"RU",label:"Russia",phone:"7"},{ioc:"RWA",iso:"RW",label:"Rwanda",phone:"250"},{ioc:"KSA",iso:"SA",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso:"SB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso:"SC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso:"SD",label:"Sudan",phone:"249"},{ioc:"SWE",iso:"SE",label:"Sweden",phone:"46"},{ioc:"SIN",iso:"SG",label:"Singapore",phone:"65"},{ioc:"HEL",iso:"SH",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso:"SI",label:"Slovenia",phone:"386"},{ioc:"",iso:"SJ",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso:"SK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso:"SL",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso:"SM",label:"San Marino",phone:"378"},{ioc:"SEN",iso:"SN",label:"Senegal",phone:"221"},{ioc:"SOM",iso:"SO",label:"Somalia",phone:"252"},{ioc:"SUR",iso:"SR",label:"Suriname",phone:"597"},{ioc:"",iso:"SS",label:"South Sudan",phone:"211"},{ioc:"STP",iso:"ST",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso:"SV",label:"El Salvador",phone:"503"},{ioc:"",iso:"SX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso:"SY",label:"Syria",phone:"963"},{ioc:"",iso:"SZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso:"TC",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso:"TD",label:"Chad",phone:"235"},{ioc:"",iso:"TF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso:"TG",label:"Togo",phone:"228"},{ioc:"THA",iso:"TH",label:"Thailand",phone:"66"},{ioc:"TJK",iso:"TJ",label:"Tajikistan",phone:"992"},{ioc:"",iso:"TK",label:"Tokelau",phone:"690"},{ioc:"TLS",iso:"TL",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso:"TM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso:"TN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso:"TO",label:"Tonga",phone:"676"},{ioc:"TUR",iso:"TR",label:"Turkey",phone:"90"},{ioc:"TTO",iso:"TT",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso:"TV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso:"TW",label:"Taiwan",phone:"886"},{ioc:"TAN",iso:"TZ",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso:"UA",label:"Ukraine",phone:"380"},{ioc:"UGA",iso:"UG",label:"Uganda",phone:"256"},{ioc:"USA",iso:"US",label:"United States",phone:"1",suggested:!0},{ioc:"URU",iso:"UY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso:"UZ",label:"Uzbekistan",phone:"998"},{ioc:"",iso:"VA",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso:"VC",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso:"VE",label:"Venezuela",phone:"58"},{ioc:"IVB",iso:"VG",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso:"VI",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso:"VN",label:"Vietnam",phone:"84"},{ioc:"VAN",iso:"VU",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso:"WF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso:"WS",label:"Samoa",phone:"685"},{ioc:"KOS",iso:"XK",label:"Kosovo",phone:"383"},{ioc:"YEM",iso:"YE",label:"Yemen",phone:"967"},{ioc:"MAY",iso:"YT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso:"ZA",label:"South Africa",phone:"27"},{ioc:"ZAM",iso:"ZM",label:"Zambia",phone:"260"},{ioc:"ZIM",iso:"ZW",label:"Zimbabwe",phone:"263"}];var Jc={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:6/TB10",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Zc={winCriteria:{valueGoal:13},collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}]},Qc={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}};const Xc={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:Jc,LAVER_CUP:Zc,TEAM_DOUBLES_3_AGGREGATION:Qc},eu="MAIN",tu="QUALIFYING",nu="CONSOLATION",iu="PLAY_OFF",ru=[eu,tu,nu,iu,"VOLUNTARY_CONSOLATION"],ou={[tu]:1,[eu]:2,[iu]:3,[nu]:3,VOLUNTARY_CONSOLATION:4},au="CONTAINER",su="TOP_DOWN",cu="LOSER",uu="AD_HOC",du="FEED_IN",lu="SINGLE_ELIMINATION",pu="DOUBLE_ELIMINATION",mu="LUCKY_DRAW",fu="CURTIS_CONSOLATION",hu="FEED_IN_CHAMPIONSHIP_TO_SF",vu="FEED_IN_CHAMPIONSHIP_TO_QF",gu="FEED_IN_CHAMPIONSHIP_TO_R16",Iu="ROUND_ROBIN",yu="ROUND_ROBIN_WITH_PLAYOFF",wu={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-3":{name:"NORTHEAST",abbreviation:"NE"},"0-1-1":{name:"SOUTH",abbreviation:"S"},"0-1-2":{name:"SOUTHWEST",abbreviation:"SW"},"0-2-1":{name:"NORTHWEST",abbreviation:"NW"},"0-1-1-1":{name:"SOUTHEAST",abbreviation:"SE"}},Uu={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-1-1":{name:"SOUTH",abbreviation:"S"}},bu=["COMPASS",fu,"FEED_IN_CHAMPIONSHIP_TO_QF","FEED_IN_CHAMPIONSHIP_TO_R16","FEED_IN_CHAMPIONSHIP_TO_SF","FEED_IN_CHAMPIONSHIP",vu,gu,hu,"FIRST_MATCH_LOSER_CONSOLATION","FIRST_ROUND_LOSER_CONSOLATION",mu,"MODIFIED_FEED_IN_CHAMPIONSHIP","OLYMPIC",iu,yu],Su={positionActions:{policyName:"positionActionsDefault",enabledStructures:[{stages:[tu,eu],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:["SEED_VALUE","NICKNAME","PENALTY"],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1}},Pu={roundNaming:{policyName:"Round Naming Default",abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q"},stageConstants:{[eu]:"",[iu]:"P",[tu]:"Q",[nu]:"C"}}},Du={seeding:{policyName:"USTA",seedingProfile:"SEPARATE",duplicateSeedNumbers:!0,drawSizeProgression:!0,validSeedPositions:{ignore:!0},seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function Nu({courtDate:e,includeBookingTypes:t=[]}){const n=[];let i=_a(e.startTime);(e.bookings||[]).filter((e=>!e.bookingType||!t.includes(e.bookingType))).sort(((e,t)=>ja(e.startTime).localeCompare(ja(t.startTime)))).forEach((e=>{const t={startTime:Ba(i.toISOString()),endTime:e.startTime};_a(e.startTime)>i&&n.push(t),_a(e.endTime)>i&&(i=_a(e.endTime))}));const r={startTime:Ba(i.toISOString()),endTime:e.endTime};return _a(e.endTime)>i&&n.push(r),n}function Mu({includeBookingTypes:e,averageMatchUpMinutes:t,periodStartTime:n,periodEndTime:i,periodLength:r,date:o}){function a(e){const r=_a(e.startTime),o=_a(e.endTime);return!(r>n)&&(!(o<i)&&Wa(n,o)>=t)}return{sameDate:e=>!e.date||Ka(e.date,o),enoughTime:t=>!!Nu({courtDate:t,periodLength:r,includeBookingTypes:e}).filter(a).length}}function Tu({includeBookingTypes:e,averageMatchUpMinutes:t,periodLength:n,periodStart:i,courts:r,date:o}){const a=_a(i),s=za(a,t),{sameDate:c,enoughTime:u}=Mu({includeBookingTypes:e,averageMatchUpMinutes:t,periodStartTime:a,periodEndTime:s,periodLength:n,date:o});return{availableToScheduleCount:r.filter((e=>!!(Array.isArray(e.dateAvailability)&&e.dateAvailability.filter(c).filter(u)).length)).length}}function Eu({remainingScheduleTimes:e=[],clearScheduleDates:t,periodLength:n=30,bookings:i=[],scheduleDate:r,courts:o=[]}){if(!Array.isArray(o)||!o.length)return{error:_o,courts:o};if(!Array.isArray(i))return{error:"Invalid bookings"};if(!Ta(r))return{error:Go};t&&(Array.isArray(t)?t.includes(r)&&(i=[]):i=[]);const{courtBookings:a,unassignedBookings:s}=i.reduce(((e,t)=>{const{courtId:n}=t;return n?e.courtBookings[n]?e.courtBookings[n].push(t):e.courtBookings[n]=[t]:e.unassignedBookings.push(t),e}),{courtBookings:{},unassignedBookings:[]}),{sameDate:c}=Mu({date:r}),u=o.map((({courtId:t,dateAvailability:n},i)=>{const r=a[t]||[],o=n.find(c)||{},{date:s,startTime:u,endTime:d,bookings:l=[]}=o;return{courtId:t,dateAvailability:{date:s,startTime:u,endTime:d,bookings:[e[i]&&{startTime:u,endTime:e[i]},...Ja(l,!1,!0),...r].filter(Boolean)}}}));s.sort(((e,t)=>La(e.startTime)-La(t.startTime)));for(const d of s){const{startTime:e,endTime:t,averageMinutes:i,recoveryMinutes:r,matchUpId:o}=d,a=La(e),s=La(t),c=u.map((e=>{const t=Nu({courtDate:e.dateAvailability});return{courtId:e.courtId,timeSlots:t}})).flat().reduce(((e,{courtId:t,timeSlots:i})=>{let r;return i.find((({startTime:t,endTime:i})=>{r=La(t)-a;const o=a>=La(t);return s<=La(i)&&0!==e.startDifference&&((0===r||r+n>=0)&&(void 0===e.startDifference||r<e.startDifference)||o)}))?{courtId:t,startDifference:r}:e}),{courtId:void 0,startDifference:void 0});if(c.courtId){const n={averageMinutes:i,recoveryMinutes:r,matchUpId:o,startTime:e,endTime:t};u.find((({courtId:e})=>e===c.courtId)).dateAvailability.bookings.push(n)}else console.log({unassignedBooking:d})}return{virtualCourts:u.map((({courtId:e,dateAvailability:t})=>({courtId:e,dateAvailability:[t]})))}}function Au({startTime:e="8:00",endTime:t="20:30",count:n=10,date:i}={}){return Eo(0,n).map((()=>({dateAvailability:[{date:i,startTime:e,endTime:t}]})))}function Ru({calculateStartTimeFromCourts:e=!0,remainingScheduleTimes:t,averageMatchUpMinutes:n=90,date:i=Ea(),clearScheduleDates:r,periodLength:o=30,startTime:a="08:00",endTime:s="19:00",courtsCount:c,bookings:u,courts:d}={}){i=Va(i),a=Ba(a),s=Ba(s);let l=0,p=0,m=0,f=0,h=0;!d&&c&&(d=Au({startTime:a,endTime:s,count:c,date:i}));const{virtualCourts:v}=Eu({remainingScheduleTimes:t,scheduleDate:i,clearScheduleDates:r,periodLength:o,bookings:u,courts:d}),{firstTimeSlotStartTime:g}=function({averageMinutes:e,startTime:t,endTime:n,courts:i,date:r}){const{sameDate:o}=Mu({date:r});let a;if(t&&n){const r=_a(t),s=_a(n);i.every((t=>!!Array.isArray(t.dateAvailability)&&t.dateAvailability.filter(o).find((t=>Nu({courtDate:t}).find((t=>{const n=_a(t.startTime),i=_a(t.endTime);if(n>s||n<r)return!1;if(i<r)return!1;const o=Wa(n,i)>=e;if(o){const e=Ba(n.toISOString());(!a||e<a)&&(a=e)}return o}))))))}return{firstTimeSlotStartTime:a}}({averageMinutes:n,courts:v,startTime:a,endTime:s,date:i});e&&g&&(a=g||a);const I=La(a),y=La(s)-I,w=Eo(0,Math.floor(y/o)+1).map((e=>{const t=function(e){let t=Math.floor(e/60);const n=e-60*t;return t>23&&(t%=24),[Ha(t),Ha(n)].join(":")}(I+e*o),{availableToScheduleCount:r}=Tu({courts:v,averageMatchUpMinutes:n,periodLength:o,periodStart:t,period:e,date:i}),a=r>p?r-p:0;h+=e?r:0;const s=e?h/e:r,c=e?o*s/n*(e-1)+s:s,u=r?p?c-l:a:0;l=c,p=r,m+=u;const d=parseInt(m)-f;return f+=d,{periodStart:t,add:d,availableToScheduleCount:r,newCourts:a,totalMatchUps:f}}));return{scheduleTimes:w.reduce(((e,t)=>e.concat(...Eo(0,t.add).map((()=>({scheduleTime:t.periodStart}))))),[]).flat(),timingProfile:w,totalMatchUps:f}}const Cu={getCourtsAvailableAtPeriodStart:Tu,generateTimeSlots:Nu,getScheduleTimes:Ru,courtGenerator:Au};function xu({consideredDate:e,category:t}={}){var n,i,r;const o={error:_o};if("object"!=typeof t||!Ta(e))return o;const a=parseInt(e.split("-")[0]),s=[];let c,{ageCategoryCode:u,categoryName:d,ageMaxDate:l,ageMinDate:p,ageMax:m,ageMin:f}=t;if("string",![u,l,p,d].filter(Boolean).every((e=>"string"==typeof e))||![m,f].filter(Boolean).every(ho))return o;u=u||d;const h=/^([UO]?)(\d{1,2})([UO]?)$/,v=/^C(\d{1,2})-(\d{1,2})$/,g=(null===(n=u)||void 0===n?void 0:n.indexOf("-"))>0,I=g&&(null===(i=u)||void 0===i?void 0:i.match(v)),y=null===(r=u)||void 0===r?void 0:r.match(h),w=(e,t,n)=>Ta(t)?t:t&&t.match(/^\d{2}-\d{2}$/)?`${e}-${t}`:`${e}-${n}`,U=e=>{const[t,n,i]=(e.match(h)||[]).slice(1),r=parseInt(n);var o;"U"===t&&({ageMinDate:p,ageMax:m}=(p=w(a-(o=r),p,"01-01"),m&&m!==o-1&&s.push(`Invalid ageMax: ${m}`),m||(m=o-1),{ageMinDate:p,ageMax:m})),"U"===i&&({ageMinDate:p,ageMax:m}=(e=>(p=w(a-e-1,p,"01-01"),m&&m!==e&&s.push(`Invalid ageMax: ${m}`),m||(m=e),{ageMinDate:p,ageMax:m}))(r)),"O"===t&&({ageMaxDate:l,ageMin:f}=(e=>(l=w(a-e-2,l,"12-31"),f&&f!==e+1&&s.push(`Invalid ageMin: ${f}`),f||(f=e+1),{ageMaxDate:l,ageMin:f}))(r)),"O"===i&&({ageMaxDate:l,ageMin:f}=(e=>(l=w(a-e-1,l,"12-31"),f&&f!==e&&s.push(`Invalid ageMin: ${f}`),f||(f=e),{ageMaxDate:l,ageMin:f}))(r))};if(I){const[e,t]=u.match(v).slice(1).map((e=>parseInt(e)));e<=t?(f=f||e,m=m||t,c=!0):s.push(`Invalid combined age range ${u}`)}else g?u.split("-").forEach(U):y&&U(u);return s.length?{error:s}:Za({combinedAge:c,ageMaxDate:l,ageMinDate:p,ageMax:m,ageMin:f})}function Ou(e,t,n=[]){return"object"==typeof e&&Object.keys(e).reduce(((i,r)=>"object"!=typeof e[r]?(i[n.concat(r).join(t)]=e[r],i):Object.assign(i,Ou(e[r],t,n.concat(r)))),{})}function ku({element:e,itemType:t,itemSubTypes:n,returnPreviousValues:i}){if(!e)return{error:$o};if(!Array.isArray(e.timeItems))return{error:"Missing timeItems"};const r=e.timeItems.filter((e=>(null==e?void 0:e.itemType)===t)).filter((e=>{var t;return!(null!=n&&n.length)||(null==e||null===(t=e.itemSubTypes)||void 0===t?void 0:t.includes(n))})).sort(((e,t)=>new Date(e.createdAt||void 0)-new Date(t.createdAt||void 0))),o=r.pop();if(o){const e=f({timeItem:o},ko);return i&&Object.assign(e,{previousItems:r}),e}return{message:Wo}}function Fu({event:e,itemType:t,itemSubTypes:n,returnPreviousValues:i}){if(!e)return{error:Vo};if(!e.timeItems)return{message:Wo};const{timeItem:r,previousItems:o,message:a}=ku({element:e,itemType:t,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:o}||{message:a}}function Lu({element:e,timeItem:t,duplicateValues:n=!0}){if(!e)return{error:$o};if(!t)return{error:"Missing timeItem"};const i=t&&Object.keys(t),r=["itemType","itemValue"];if(r.filter((e=>i.includes(e))).length!==r.length)return{error:"Invalid timeItem"};if(e.timeItems){const{itemType:i,itemSubTypes:r,itemValue:o}=t,{timeItem:a}=ku({element:e,itemType:i,itemSubTypes:r});if(JSON.stringify(null==a?void 0:a.itemValue)===JSON.stringify(o)&&!n)return ko}else e.timeItems=[];t.itemSubTypes&&!t.itemSubTypes.length&&delete t.itemSubTypes;const o=(new Date).toISOString();return Object.assign(t,{createdAt:o}),e.timeItems.push(t),ko}function ju({tournamentRecord:e,duplicateValues:t,participantId:n,timeItem:i}){if(!e)return{error:Lo};if(!n)return{error:"Missing participantId"};const r=Rs({tournamentRecord:e,participantId:n});return r.error?r:Lu({element:r.participant,duplicateValues:t,timeItem:i})}function Bu({tournamentRecord:e,duplicateValues:t,timeItem:n}){return e?Lu({element:e,timeItem:n,duplicateValues:t}):{error:Lo}}function Vu({event:e,timeItem:t,duplicateValues:n}){return e?Lu({element:e,timeItem:t,duplicateValues:n}):{error:"Event not found"}}function $u(e,t){var n;if(!e)return;let i=Date.now();i===e.updatedAt&&(i+=1);const r=null==t?void 0:t.filter(Boolean);e.updatedAt=i,null===(n=e.structures)||void 0===n||n.forEach((e=>{(null==r||!r.length||null!=r&&r.includes(e.structureId))&&(e.updatedAt=i)}))}function Gu({drawDefinition:e,matchUps:t}){$u(e),la({topic:"addMatchUps",payload:{matchUps:t}})}function _u({drawDefinition:e,matchUpIds:t,action:n}){$u(e),la({topic:"deletedMatchUpIds",payload:{action:n,matchUpIds:t}})}function Wu({drawDefinition:e,matchUp:t}){zu({drawDefinition:e,structureIds:[t.structureId]}),la({topic:"modifyMatchUp",payload:{matchUp:t},key:t.matchUpId})}function qu({drawDefinition:e}){$u(e),la({topic:"addDrawDefinition",payload:{drawDefinition:e},key:e.drawId})}function zu({drawDefinition:e,structureIds:t}){$u(e,t),la({topic:"modifyDrawDefinition",payload:{drawDefinition:e},key:e.drawId})}function Hu({tournamentParticipants:e,tournamentRecord:t,participantIds:n}){if(!e&&!t)return{error:Lo};if(!Array.isArray(n)||n.length>2)return{error:"Invalid participantIds"};if(!n.length)return{error:"Missing participantIds"};const i=(e=e||(null==t?void 0:t.participants)||[]).filter((e=>e.participantType===pc&&Ro(n,e.individualParticipantIds).length===n.length&&e.individualParticipantIds.length===n.length)),r=i[0];if(!r)return{error:"Participant Not Found"};const o=Ja(i.slice(1));return f({participant:Ja(r),duplicatedPairParticipants:o},ko)}function Ku({drawDefinition:e,participantId:t}){if("object"!=typeof e)return{error:jo};if("string"!=typeof t)return{error:"Missing participantId"};const{extension:n}=Cs({element:e,name:"lineUps"});return{lineUp:((null==n?void 0:n.value)||{})[t]}}const Yu=e=>t=>e[t],Ju=(e=[])=>e.map(ed).filter(Boolean),Zu=(e=[])=>e.map(Qu).filter(Boolean),Qu=(e={})=>Yu(e)("participantId"),Xu=(e={})=>Yu(e)("drawPosition"),ed=(e={})=>Yu(e)("matchUpId");function td({drawDefinition:e}){if(!e)return{error:jo};const t=(e.extensions||[]).find((e=>"appliedPolicies"===e.name));return{appliedPolicies:(null==t?void 0:t.value)||{}}}function nd({matchUps:e=[]}){if(!Array.isArray(e))return{error:_o};const t=e.reduce(((e,t)=>!t.roundNumber||e.includes(t.roundNumber)?e:e.concat(parseInt(t.roundNumber))),[]).sort(Xa).map((t=>{const n=e.filter((e=>e.roundNumber===t)),i=n.find((({matchUpType:e})=>e===Bs))?n.filter((({matchUpType:e})=>e===Bs)):n;return{[t]:i.sort(((e,t)=>Xa(e.roundPosition,t.roundPosition)))}})),n=e.reduce(((e,t)=>(e[t.roundNumber]||(e[t.roundNumber]=Za({finishingRound:t.finishingRound,abbreviatedRoundName:t.abbreviatedRoundName,roundName:t.roundName})),e)),{}),i=Object.assign({},...t);let r=0;const o=Object.assign({},...Object.keys(i).map((e=>{var t,n,o;const a=null===(t=i[e])||void 0===t?void 0:t.length,s=null===(n=i[e])||void 0===n||null===(o=n.filter((e=>{var t;return!(ao.includes(e.matchUpStatus)||null!==(t=e.score)&&void 0!==t&&t.scoreStringSide1)})))||void 0===o?void 0:o.length,c=a&&a===s;return r=Math.max(r,a),{[e]:{matchUpsCount:a,inactiveCount:s,inactiveRound:c}}})));let a=0,s=0;const c=Object.keys(i).map((e=>parseInt(e))).filter((e=>!isNaN(e)));return c.forEach((e=>{const t=i[e].sort(((e,t)=>e.roundPosition-t.roundPosition)),c=t.map((e=>(null==e?void 0:e.drawPositions)||[])).flat();if(o[e].roundNumber=e,o[e].roundFactor=o[e].matchUpsCount?r/o[e].matchUpsCount:1,o[e].finishingRound=n[e].finishingRound,o[e].roundName=n[e].roundName,o[e].abbreviatedRoundName=n[e].abbreviatedRoundName,o[e].finishingPositionRange=i[e][0].finishingPositionRange,1!==e&&o[e-1]){const n=o[e-1].drawPositions,i=n.length/c.length,r=xo(n,i),a=t.map((t=>{const{roundPosition:i,drawPositions:o}=t;if(!i)return o;const a=(null==o?void 0:o.filter(Boolean))||[];if(null==a||!a.length)return[void 0,void 0];if(e<3&&2===(null==a?void 0:a.length))return null==o?void 0:o.slice().sort(Xa);if(null!=a&&a.length&&Ro(n,a).length!==(null==a?void 0:a.length))return 1===(null==a?void 0:a.length)?[a[0],void 0]:null==o?void 0:o.slice().sort(Xa);const s=2*(i-1);return r.slice(s,s+2).map((e=>null==o?void 0:o.find((t=>e.includes(t)))))}));o[e].drawPositions=null==a?void 0:a.flat(),o[e].pairedDrawPositions=a}else{const t=c.sort(Xa),n=xo(t,2);o[e].drawPositions=t,o[e].pairedDrawPositions=n}o[e+1]&&o[e+1].matchUpsCount===o[e].matchUpsCount&&(o[e+1].feedRound=!0,o[e+1].feedRoundIndex=s,o[e].preFeedRound=!0,s+=1),o[e]&&!o[e].feedRound&&(o[e].roundIndex=a,a+=1)})),{hasOddMatchUpsCount:!!Object.values(o).find((({matchUpsCount:e})=>!mo(e))),maxMatchUpsCount:r,roundMatchUps:i,roundNumbers:c,roundProfile:o}}function id({drawDefinition:e,structure:t}){const n={},i=[];return((null==e?void 0:e.structures)||[t]).filter((e=>e&&"object"==typeof e)).forEach((e=>{const{structureId:t,matchUps:r,structures:o}=e,a=Array.isArray(o);if(a)a&&o.forEach((e=>{const{structureName:r}=e,o=e.matchUps;n[e.structureId]={matchUps:o,structureName:r},i.push(...o),o.forEach((e=>{i.push(e),e.tieMatchUps&&i.push(...e.tieMatchUps)})),n[t]||(n[t]={}),n[t].itemStructureIds||(n[t].itemStructureIds=[]),n[t].itemStructureIds.push(e.structureId)}));else{const e=r;n[t]={matchUps:e},e.forEach((e=>{i.push(e),e.tieMatchUps&&i.push(...e.tieMatchUps)}))}})),{mappedMatchUps:n,drawMatchUps:i}}function rd({mappedMatchUps:e,matchUpsMap:t,structureId:n,inContext:i}){let r=(e=(null==t?void 0:t.mappedMatchUps)||e)[n];const o=((null==r?void 0:r.itemStructureIds)||[]).map((t=>{const{matchUps:r,structureName:o}=e[t];return i?r.map((e=>Object.assign(Ja(e,!0,!0),{containerStructureId:n,structureId:t,structureName:o}))):r})).flat();return((null==r?void 0:r.matchUps)||[]).concat(...o)}function od(e,t){var n,i;return(ou[null==e?void 0:e.stage]||0)-(ou[null==t?void 0:t.stage]||0)||((null==t||null===(n=t.positionAssignments)||void 0===n?void 0:n.length)||9999)-((null==e||null===(i=e.positionAssignments)||void 0===i?void 0:i.length)||9999)||((null==e?void 0:e.stageSequence)||0)-((null==t?void 0:t.stageSequence)||0)}function ad({drawDefinition:e,structureId:t}){if(!e)return{error:jo};if(!t)return{error:"Missing structureId"};const{structures:n}=sd({drawDefinition:e}),i=n.map((e=>e.structures?[].concat(...e.structures,e):e)).flat().find((e=>e.structureId===t));return i?{structure:i}:{error:"structure not found"}}function sd({stage:e,stageSequence:t,drawDefinition:n}){var i;const r=n?n.structures?void 0:"Missing structures":jo;return r?{error:r}:{structures:null===(i=n.structures)||void 0===i?void 0:i.filter((function(t){return!e||t.stage===e})).filter((function(e){return!t||e.stageSequence===t})).sort(od)}}function cd(e){if(!e||"object"!=typeof e)return!1;if("string"!=typeof e.name)return!1;const t=Object.keys(e),n=["name","value"];return n.filter((e=>t.includes(e))).length===n.length}function ud({element:e,extension:t}={}){if(!e)return{error:$o};if("object"!=typeof e)return{error:_o};if(!cd(t))return{error:_o};e.extensions||(e.extensions=[]);const n=(new Date).toISOString();Object.assign(t,{createdAt:n});const i=e.extensions.find((({name:e})=>e===t.name));return i?i.value=t.value:t.value&&e.extensions.push(t),f({},ko)}function dd({element:e,name:t}={}){return e?"object"!=typeof e?{error:_o}:t?e.extensions?(e.extensions=e.extensions.filter((e=>(null==e?void 0:e.name)!==t)),f({},ko)):h(f({},ko),{message:Wo}):{error:$o,message:"Missing name"}:{error:$o}}function ld({tournamentRecord:e,extension:t}={}){return e?ud({element:e,extension:t}):{error:Lo}}function pd({drawDefinition:e,extension:t}={}){return e?ud({element:e,extension:t}):{error:"drawDefinition not found"}}function md({event:e,extension:t}={}){return e?ud({element:e,extension:t}):{error:Vo}}function fd({tournamentRecord:e,name:t}={}){return e?dd({element:e,name:t}):{error:Lo}}function hd({event:e,name:t}={}){return e?dd({element:e,name:t}):{error:"Event not found"}}function vd({drawDefinition:e,attributes:t}){var n;let{extension:i}=ks({name:"entryProfile",drawDefinition:e});const r=(null===(n=i)||void 0===n?void 0:n.value)||e.entryProfile||{};return t.forEach((e=>{Object.keys(e).forEach((t=>{r[t]?Object.assign(r[t],e[t]):r[t]=e[t]}))})),i={name:"entryProfile",value:r},pd({drawDefinition:e,extension:i}),{entryProfile:r}}var gd,Id;(Id=gd||(gd={})).CONFIRMED="CONFIRMED",Id.DIRECT_ACCEPTANCE="DIRECT_ACCEPTANCE",Id.ORGANISER_ACCEPTANCE="ORGANISER_ACCEPTANCE",Id.ALTERNATE="ALTERNATE",Id.WITHDRAWN="WITHDRAWN",Id.UNPAIRED="UNPAIRED",Id.UNGROUPED="UNGROUPED",Id.LUCKY_LOSER="LUCKY_LOSER",Id.FEED_IN="FEED_IN",Id.QUALIFIER="QUALIFIER",Id.WILDCARD="WILDCARD";var yd=gd.ALTERNATE,wd=gd.FEED_IN,Ud=gd.QUALIFIER,bd=gd.WILDCARD,Sd=gd.DIRECT_ACCEPTANCE,Pd=gd.CONFIRMED,Dd=gd.LUCKY_LOSER,Nd=gd.ORGANISER_ACCEPTANCE,Md=gd.WITHDRAWN,Td=gd.UNPAIRED,Ed=gd.UNGROUPED,Ad=[Pd,Sd,Nd],Rd=[Dd,wd,Ud,bd],Cd=[wd,Ud,Dd,bd,Pd,Sd,Nd],xd=[yd,Md,wd,Td,Ed,Ud,bd,Sd,Pd,Dd,Nd];function Od({drawDefinition:e}){let{extension:t}=ks({name:"entryProfile",drawDefinition:e});return{entryProfile:(null==t?void 0:t.value)||e.entryProfile||{}}}function kd({stage:e,drawDefinition:t}){return Boolean(Fd({stage:e,drawDefinition:t})&&Ld({stage:e,drawDefinition:t}))}function Fd({stage:e,drawDefinition:t}){const{entryProfile:n}=Od({drawDefinition:t}),i=Object.keys(n).includes(e);return!i&&ru.includes(e)?(vd({drawDefinition:t,attributes:[{[e]:{drawSize:void 0,alternates:!0}}]}),!0):i}function Ld({stage:e,drawDefinition:t}){var n;const{entryProfile:i}=Od({drawDefinition:t});return i&&(null===(n=i[e])||void 0===n?void 0:n.drawSize)||0}function jd({stage:e,drawDefinition:t}){var n;const{entryProfile:i}=Od({drawDefinition:t});return i&&(null===(n=i[e])||void 0===n?void 0:n.qualifiersCount)||0}function Bd({stage:e,drawDefinition:t,entryStatus:n}){return t.entries.reduce(((t,i)=>i.entryStage===e&&i.entryStatus===n?t+1:t),0)}function Vd({drawDefinition:e,stageSequence:t,entryStatuses:n,structureId:i,stages:r,stage:o}){var a;const s=(null===(a=e.entries)||void 0===a?void 0:a.reduce(((e,i)=>{const a=o&&i.entryStage===o||(null==r?void 0:r.length)&&r.includes(i.entryStage),s=!n||n.includes(i.entryStatus),c=i.stageSequence||1;return!a||t&&c!==t||!s?e:e.concat(i)}),[]))||[];return i&&!s.length?function({drawDefinition:e,structureId:t}){const n=[],i=(e.links||[]).find((e=>"POSITION"===e.linkType&&e.target.structureId===t));if(i){const{finishingPositions:t,structureId:r}=i.source,{structure:o}=ad({drawDefinition:e,structureId:r});o.structureType===au&&(o.structures||[]).forEach((e=>{const{positionAssignments:i}=e,{structureId:r}=e,o=r,a=Object.assign({},...i.map((e=>{var t;const{participantId:n}=e,i=null===(t=Cs({element:e,name:"tally"}).extension)||void 0===t?void 0:t.value;return i?{[n]:i}:void 0})).filter(Boolean));Object.keys(a).filter((e=>{const n=a[e];return t.includes(n.groupOrder)})).forEach((e=>{const i=a[e],{groupOrder:r,GEMscore:s}=i,c=t.sort().indexOf(r)+1;n.push({GEMscore:s,groupingValue:o,participantId:e,placementGroup:c,entryStage:iu,entryStatus:wd})}))}))}return n}({drawDefinition:e,structureId:i}):s}function $d({stage:e,drawDefinition:t}){return Bd({entryStatus:Sd,drawDefinition:t,stage:e})}function Gd({stage:e,drawDefinition:t}){return Bd({entryStatus:bd,drawDefinition:t,stage:e})}function _d({entryStatus:e=Sd,drawDefinition:t,stage:n}){if(e===yd)return function({stage:e,drawDefinition:t}){var n;const{entryProfile:i}=Od({drawDefinition:t});return(null===(n=i[e])||void 0===n?void 0:n.alternates)||0}({stage:n,drawDefinition:t})?Object.assign({positionsAvailable:1/0},ko):{error:"entryStatus not allowed in stage"};const i=function({stage:e,drawDefinition:t}){const n=Ld({stage:e,drawDefinition:t}),i=jd({drawDefinition:t,stage:e});return n&&n-i}({drawDefinition:t,stage:n}),r=function({stage:e,drawDefinition:t}){const{entryProfile:n}=Od({drawDefinition:t});return n[e].wildcardsCount||0}({stage:n,drawDefinition:t}),o=Bd({entryStatus:bd,drawDefinition:t,stage:n}),a=o+Bd({entryStatus:Sd,drawDefinition:t,stage:n}),s=i-a;return a>=i?{error:"No stage space available for entryStatus"}:e===bd?o<r?ko:{error:"No stage space available for entryStatus"}:Object.assign({positionsAvailable:s},ko)}function Wd({drawDefinition:e,structureId:t,structure:n}){var i,r;let o,a=[];if(n||({structure:n,error:o}=ad({drawDefinition:e,structureId:t})),!n)return{seedAssignments:[],error:"structure not found"};t||(t=n.structureId);const{stage:s,stageSequence:c}=n;return o||(s===iu&&e?a=Vd({drawDefinition:e,stageSequence:c,structureId:t,stage:s}).filter((e=>1===e.placementGroup)).sort(((e,t)=>e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore?-1:0)).map(((e,t)=>({participantId:e.participantId,seedNumber:t+1,seedValue:t+1,seedProxy:!0}))):n.seedAssignments?a=n.seedAssignments:o="Missing seedAssignments"),{seedAssignments:a,seedLimit:n.seedLimit||(null===(i=n)||void 0===i||null===(r=i.positionAssignments)||void 0===r?void 0:r.length),stage:s,stageSequence:c,error:o}}function qd({groupedOrder:e,roundPositionsCount:t}){if(!e||(null==e?void 0:e.length)<=t)return e;const n=xo(e,e.length/t).map((e=>e.reduce(((e,t)=>e+t)))),i=n.slice().sort(Xa);return n.map((e=>i.indexOf(e)+1))}function zd(e){if(!Array.isArray(e))return"";const t=e.filter(ho);return t.length?bo([Math.min(...t),Math.max(...t)]).join("-"):""}function Hd({drawDefinition:e,structureId:t,structure:n}){let i,r=[];if(!n){if(!e)return{positionAssignments:r,error:jo};if(({structure:n,error:i}=ad({drawDefinition:e,structureId:t})),i)return{positionAssignments:r,error:i}}return n.structures?r=[].concat(...n.structures.map((e=>Hd({structure:e}).positionAssignments))):n.positionAssignments?r=n.positionAssignments:i="Missing positionAssignments",{positionAssignments:r,error:i}}function Kd({structure:e,drawDefinition:t,structureId:n}){const{positionAssignments:i}=Hd({drawDefinition:t,structureId:n,structure:e}),r=i.filter((e=>e.participantId||e.bye||e.qualifier)),o=i.length===r.length,a=i.filter((e=>!e.participantId&&!e.bye&&!e.qualifier));return{byePositions:i.filter((e=>!e.participantId&&e.bye)),assignedPositions:r,qualifierPositions:i.filter((e=>!e.participantId&&e.qualifier)),unassignedPositions:a,positionAssignments:i,allPositionsAssigned:o}}function Yd({drawDefinition:e,structure:t}){return!!t&&!(null!=t&&t.structures||null!=e&&e.drawType&&e.drawType!==uu||null!=t&&t.matchUps.find((({roundPosition:e})=>!!e)))}function Jd({matchUp:e}){let t,n=[],i=[],r=[],o=[];if(e||(t="Missing matchUp"),e&&!e.sides&&(t="Invalid matchUp"),e&&!e.hasContext&&(t="Missing context"),!t){n=e.sides.map((e=>e.participantId));const t=e.sides.filter((e=>e.participantType===dc)).map((e=>e.participantId)).filter(Boolean);o=e.sides.map((e=>e.participant&&e.participant.individualParticipants)).filter(Boolean).map((e=>e.map((e=>null==e?void 0:e.participantId)).filter(Boolean))),i=[].concat(...t,...o.flat()).filter(Boolean),r=bo(i.concat(n)).filter(Boolean)}return{error:t,sideParticipantIds:n,individualParticipantIds:i,allRelevantParticipantIds:r,nestedIndividualParticipantIds:o}}function Zd({matchUp:e}){if(!e)return{error:"Missing matchUp"};if(!e.hasContext)return{error:"Missing context"};if(!e.sides||2!==e.sides.filter(Boolean).length)return{error:"Invalid matchUp"};const{sideParticipantIds:t,nestedIndividualParticipantIds:n,allRelevantParticipantIds:i}=Jd({matchUp:e}),r=(e.timeItems||[]).filter((e=>[ds,ls].includes(null==e?void 0:e.itemType))).sort(((e,t)=>new Date(e.createdAt)-new Date(t.createdAt))),o=r.map((e=>e.itemValue)).filter((e=>r.filter((t=>(null==t?void 0:t.itemValue)===e)).reverse()[0].itemType===ds));return null==n||n.forEach(((e,n)=>{const i=t[n],r=(null==e?void 0:e.length)&&e.reduce(((e,t)=>e&&t&&o.includes(t)),!0);i&&r&&!o.includes(i)&&o.push(i)})),t.forEach(((e,t)=>{o.includes(e)&&(n[t]||[]).forEach((e=>{e&&!o.includes(e)&&o.push(e)}))})),{allParticipantsCheckedIn:t.reduce(((e,t)=>o.includes(t)&&e),!0),checkedInParticipantIds:o,allRelevantParticipantIds:i}}function Qd(e){const{matchUps:t,isCollectionMatchUp:n,matchUpStatuses:i,matchUpFormats:r,roundPositions:o,matchUpFormat:a,collectionIds:s,isMatchUpTie:c,matchUpTypes:u,roundNumbers:d,matchUpIds:l,scheduledDates:p,scheduledDate:m,processContext:f,tournamentIds:h,structureIds:v,courtIds:g,eventIds:I,venueIds:y,drawIds:w,stages:U,filterMatchUpIds:b=!0,filterMatchUpTypes:S=!0}=e,P=Array.isArray(i)?i.filter(Boolean):[],D=Array.isArray(U)?U.filter(Boolean):[],N=Array.isArray(s)?s.filter(Boolean):[],M=Array.isArray(d)?d.filter(Boolean):[],T=Array.isArray(o)?o.filter(Boolean):[],E=Array.isArray(l)&&b?l.filter(Boolean):[],A=Array.isArray(u)&&S?u.filter(Boolean):[],R=Array.isArray(g)?g.filter(Boolean):[],C=Array.isArray(y)?y.filter(Boolean):[],x=Array.isArray(r)?r.filter(Boolean):"string"==typeof a?[a]:[],O=Array.isArray(p)?p.filter(Boolean):"string"==typeof m&&m.length?[m]:[],k=Array.isArray(h)?h.filter(Boolean):[],F=Array.isArray(I)?I.filter(Boolean):[],L=Array.isArray(w)?w.filter(Boolean):[],j=Array.isArray(v)?v.filter(Boolean):[];return t.filter((e=>{if(void 0!==c){if(c&&!e.tieMatchUps)return!1;if(!c&&e.tieMatchUps)return!1}if(void 0!==n){if(n&&!e.collectionId)return!1;if(!n&&e.collectionId)return!1}if(D.length&&!D.includes(e.stage))return!1;if(N.length&&!N.includes(e.collectionId))return!1;if(M.length&&!d.includes(e.roundNumber))return!1;if(T.length&&!o.includes(e.roundPosition))return!1;if(P.length&&!P.includes(e.matchUpStatus))return!1;if(E.length&&!E.includes(e.matchUpId))return!1;if(A.length&&!A.includes(e.matchUpType))return!1;if(x.length&&!x.includes(e.matchUpFormat))return!1;if(null!=O&&O.length){const{scheduledTime:t}=zs({matchUp:e}),{scheduledDate:n}=Hs({matchUp:e}),i=Va(t)||n;if(!O.find((e=>Ka(e,i))))return!1}if(R.length){const{courtId:t}=Ks({matchUp:e});if(!g.filter(Boolean).includes(t))return!1}if(C.length){const{venueId:t}=Ys({matchUp:e});if(!y.filter(Boolean).includes(t))return!1}if(f){if(k.length&&!k.includes(e.tournamentId))return!1;if(F.length&&!F.includes(e.eventId))return!1;if(L.length&&!L.includes(e.drawId))return!1;if(j.length&&!j.includes(e.structureId))return!1}return!0}))}function Xd({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,tournamentParticipants:n,policyDefinitions:i,tournamentRecord:r,seedAssignments:o,drawDefinition:a,contextFilters:s,contextProfile:c,matchUpFilters:u,scheduleTiming:d,context:l={},matchUpsMap:p,roundFilter:m,structure:v,inContext:g,event:I}){var y,w,U,b,S;let P={},D={};if(!v)return{collectionPositionMatchUps:P,error:"Missing structure",roundMatchUps:D,matchUps:[]};const N=Array.isArray(null==u?void 0:u.eventIds)?u.eventIds.filter(Boolean):[],M=Array.isArray(null==u?void 0:u.structureIds)?u.structureIds.filter(Boolean):[],T=Array.isArray(null==u?void 0:u.drawIds)?u.drawIds.filter(Boolean):[],E=!(null!=l&&l.eventId)||!N.length&&!(null!=s&&null!==(y=s.eventIds)&&void 0!==y&&y.filter(Boolean).length)||N.includes(l.eventId)||(null==s||null===(w=s.eventIds)||void 0===w?void 0:w.includes(l.eventId)),A=!M.length||M.includes(v.structureId),R=!a||!T.length||T.includes(a.drawId);if(!E||!A||!R)return{matchUps:[],collectionPositionMatchUps:P,roundMatchUps:D};const{appliedPolicies:C}=td({drawDefinition:a}),x=Object.assign({},t,C,i),O=null==x||null===(U=x.scoring)||void 0===U?void 0:U.structures,k=(null==O?void 0:O.stage)&&(null==O?void 0:O.stage[v.stage]),F=(null==k?void 0:k.stageSequence)&&k.stageSequence[v.stageSequence],L=(null==x||null===(b=x.scoring)||void 0===b?void 0:b.requireAllPositionsAssigned)||(null==k?void 0:k.requireAllPositionsAssigned)||(null==F?void 0:F.requireAllPositionsAssigned);p||(p=id({drawDefinition:a,structure:v}));const{positionAssignments:j,allPositionsAssigned:B}=Kd({structure:v}),V=!L||B,{seedAssignments:$}=Wd({drawDefinition:a,matchUpsMap:p,structure:v});o=o||$;const{structureId:G,structureName:_,stage:W,stageSequence:q,exitProfile:z}=v,{drawId:H,drawName:K}=a||{},Y=!!v.structures;let J=rd({matchUpsMap:p,structureId:G,inContext:g});const Z=x&&x.roundNaming,{roundNamingProfile:Q,roundProfile:X}=function({roundNamingPolicy:e,structure:t,matchUps:n}){const i={},r=t.structures,o=Yd({structure:t}),a=function({drawDefinition:e,structure:t}){var n,i;if(!t)return!1;const{hasOddMatchUpsCount:r,roundMatchUps:o}=nd({matchUps:t.matchUps||[]}),a=!(null==o||null===(n=o[1])||void 0===n||!n.find((({drawPositions:e})=>e))),s=!(null!=o&&null!==(i=o[2])&&void 0!==i&&i.find((({drawPositions:e})=>e)));return r&&!(null!=t&&t.structures)&&a&&s&&!(null!=e&&e.drawType&&e.drawType!==mu)}({structure:t}),{roundProfile:s}=nd({matchUps:n}),{structureAbbreviation:c,stage:u}=t,d=Pu.roundNaming,l=(null==e?void 0:e.roundNamingMap)||d.roundNamingMap||{},p=(null==e?void 0:e.abbreviatedRoundNamingMap)||d.abbreviatedRoundNamingMap||{},m=(null==e?void 0:e.affixes)||d.affixes,f=u&&u!==eu&&u[0],h=null==e?void 0:e.stageConstants,v=h&&h[u]||f;return r||o||a?Object.assign(i,...Object.keys(s).map((e=>({[e]:{roundName:`Round ${e}`,abbreviatedRoundName:`R${e}`}})))):Object.assign(i,...Object.keys(s).map((e=>{const{matchUpsCount:t,preFeedRound:n}=s[e],i=2*t,r=l[t]||`${m.roundNumber}${i}`,o=n?`-${m.preFeedRound}`:"",a=[v,c,`${r}${o}`].filter(Boolean).join("-"),u=p[t]||`${m.roundNumber}${i}`;return{[e]:{abbreviatedRoundName:[v,c,`${u}${o}`].filter(Boolean).join("-"),roundName:a}}}))),{roundNamingProfile:i,roundProfile:s}}({roundNamingPolicy:Z,drawDefinition:a,structure:v,matchUps:J});if(u&&(J=Qd(h(f({matchUps:J},u),{filterMatchUpTypes:!1,filterMatchUpIds:!1}))),g){var ee;const{sourceDrawPositionRanges:t}=function({drawDefinition:e,structureId:t,matchUpsMap:n}){if(!e)return{error:jo};if(!t)return{error:"Missing structureId"};const{structure:i}=ad({drawDefinition:e,structureId:t});if(i.stage!==nu)return{message:"Structure is not CONSOLATION stage"};const{links:r}=e,o=(null==r?void 0:r.filter((e=>e.target.structureId===t)))||[],a=(null==o?void 0:o.reduce(((e,t)=>{const{structureId:n}=t.source;return e.includes(n)?e:e.concat(n)}),[]))||[],s=Object.assign({},...a.map((e=>{const t=rd({matchUpsMap:n,structureId:e}),{roundProfile:i}=nd({matchUps:t});return{[e]:i}}))),c=rd({matchUpsMap:n,structureId:t}),{roundProfile:u}=nd({matchUps:c}),d={};return null==o||o.forEach((e=>{const{structureId:t,roundNumber:n}=e.source,{feedProfile:i,groupedOrder:r,positionInterleave:o,roundNumber:a}=e.target,c=s[t],l=c[1]&&c[1].drawPositions,p=c[n],m=null==p?void 0:p.matchUpsCount;if(!m)return;const f=m?l.length/m:0,h=l.length/f;let v=l.slice();const g=qd({groupedOrder:r,roundPositionsCount:v.length}),I=(null==g?void 0:g.length)||1;if(I<=h){const e=xo(v,l.length/I);"BOTTOM_UP"===i&&e.forEach((e=>e.reverse())),v=(null==g?void 0:g.length)&&(null==g?void 0:g.map((t=>e[t-1])).flat())||v}let y=xo(v,f);if(null!=g&&g.length||"BOTTOM_UP"===i&&y.reverse(),o){const e=Eo(0,o.interleave).map((()=>{})),t=Eo(0,o.offset).map((()=>{}));y=y.map((t=>[t,...e])),y.unshift(t),y=y.flat(1);const n=y.length-o.offset;y=y.slice(0,n)}d[a]||(d[a]={});const w=u[a],U=null!=w&&w.feedRound?2:1;y.forEach(((e,t)=>{const n=1+t*U;d[a][n]||(d[a][n]=zd(e))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:a,matchUpsMap:p,structureId:G}),{drawPositionsRanges:n}=function({drawDefinition:e,structureId:t,matchUpsMap:n}){var i;if(!e)return{error:jo};if(!t)return{error:"Missing structureId"};const r=rd({matchUpsMap:n,structureId:t}),{roundProfile:o}=nd({matchUps:r}),a=(Math.min(...(null===(i=o[1])||void 0===i?void 0:i.drawPositions)||[])||1)-1,s=Object.keys(o);return{drawPositionsRanges:Object.assign({},...(s||[]).map((e=>{var t;const{matchUpsCount:n}=o[e],i=(null===(t=o[1])||void 0===t?void 0:t.drawPositions)||[],r=xo(i,i.length/n),c=r.map(zd),u=r.map((e=>e.map((e=>e-a)))).map(zd),d=s.map((t=>{if(t>e)return;const{drawPositions:i}=o[t];return xo(i,i.length/n)})).filter(Boolean),l=Eo(0,n).map((e=>d.map((t=>t[e])).flat().filter(Boolean).sort(Xa))).map((e=>bo(e))),p=l.map((e=>{return(t=e,t.reduce(((e,t)=>{const n=e[e.length-1];return n&&n[n.length-1]===t-1||e.push([]),e[e.length-1].push(t),e}),[])).map(zd).join(", ");var t})),m=Object.assign({},...Eo(0,n).map((e=>({[e+1]:{firstRoundDrawPositionsRange:c[e],firstRoundOffsetDrawPositionsRange:u[e],possibleDrawPositions:l[e],drawPositionsRange:p[e]}}))));return{[e]:m}})))}}({drawDefinition:a,matchUpsMap:p,structureId:G});J=J.map((i=>ne({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,drawPositionsRanges:n,roundNamingProfile:Q,appliedPolicies:x,isRoundRobin:Y,roundProfile:X,matchUp:i,event:I}))),(null===(ee=J)||void 0===ee?void 0:ee.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{const t=e.tieMatchUps;J=J.concat(...t)})),s&&(J=Qd(h(f({processContext:!0},s),{matchUps:J})))}else{var te;(null===(te=J)||void 0===te?void 0:te.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{const t=e.tieMatchUps;J=J.concat(...t)}))}return(null!=u&&u.matchUpTypes||null!=u&&u.matchUpIds)&&(J=Qd({matchUpTypes:u.matchUpTypes,matchUpIds:u.matchUpIds,matchUps:J})),({roundMatchUps:D}=nd({matchUps:J})),({collectionPositionMatchUps:P}=function({matchUps:e}){const t=e.reduce(((e,t)=>!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition)),[]).map((t=>({[t]:e.filter((e=>e.collectionPosition===t))})));return{collectionPositionMatchUps:Object.assign({},...t)}}({matchUps:J})),m&&(J=null===(S=J)||void 0===S?void 0:S.filter((e=>e.roundNumber===m))),{matchUps:J,roundMatchUps:D,collectionPositionMatchUps:P};function ne({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,additionalContext:i={},drawPositionsRanges:s,roundNamingProfile:u,tieDrawPositions:p,appliedPolicies:m,isCollectionBye:h,matchUpTieId:g,isRoundRobin:I,roundProfile:y,sideLineUps:w,matchUp:U,event:b}){var S,P,D,N,M;const T=U.tieFormat||v.tieFormat||(null==a?void 0:a.tieFormat)||(null==b?void 0:b.tieFormat)||void 0,E=null==T?void 0:T.collectionDefinitions,A=U.collectionId&&(null==E?void 0:E.find((e=>e.collectionId===U.collectionId))),R=U.matchUpFormat||U.collectionId?A&&A.matchUpFormat:v.matchUpFormat||(null==a?void 0:a.matchUpFormat)||(null==b?void 0:b.matchUpFormat),C=U.matchUpType||(null==A?void 0:A.matchUpType)||v.matchUpType||(null==a?void 0:a.matchUpType)||(null==b?void 0:b.eventType)!==Qs&&(null==b?void 0:b.eventType),x=h?qr:U.matchUpStatus,{schedule:O,endDate:k}=oc({scheduleVisibilityFilters:e,tournamentRecord:r,scheduleTiming:d,matchUpFormat:R,matchUpType:C,matchUp:U,event:b}),F=p||U.drawPositions,{collectionPosition:L,collectionId:B,roundPosition:$}=U,Y=U.roundNumber||i.roundNumber,J=function({tournamentParticipants:e,positionAssignments:t,collectionPosition:n,drawPositions:i=[],drawDefinition:r,collectionId:o,sideLineUps:a,matchUpType:s}){if(!o||!n)return;const c=(null==i?void 0:i.map((i=>{var c,u,d;const l=null===(c=t.find((e=>e.drawPosition===i)))||void 0===c?void 0:c.participantId,p=null==a?void 0:a.find((e=>(null==e?void 0:e.drawPosition)===i)),m=(null==p?void 0:p.teamParticipant)||(null==e?void 0:e.find((({participantId:e})=>e===l))),f=(null==p?void 0:p.lineUp)||(null===(u=Ku({participantId:l,drawDefinition:r}))||void 0===u?void 0:u.lineUp),h=null==f?void 0:f.filter((e=>e.collectionAssignments.find((e=>e.collectionId===o&&e.collectionPosition===n))));if(s===js||2===(null==h?void 0:h.length)){const t=null==h?void 0:h.map(Qu),{participant:n}=Hu({tournamentParticipants:e,participantIds:t}),r=null==n?void 0:n.participantId;return{[i]:{participantId:r,teamParticipant:m}}}const v=null==h||null===(d=h[0])||void 0===d?void 0:d.participantId;return v&&{[i]:{participantId:v,teamParticipant:m}}})).filter(Boolean))||{};return Object.assign({},...c)}({tournamentParticipants:n,positionAssignments:j,collectionPosition:L,drawDefinition:a,drawPositions:F,collectionId:B,sideLineUps:w,matchUpType:C}),Z=u&&(null===(S=u[Y])||void 0===S?void 0:S.roundName)||i.roundName,Q=u&&(null===(P=u[Y])||void 0===P?void 0:P.abbreviatedRoundName)||i.abbreviatedRoundName,X=null==y||null===(D=y[Y])||void 0===D?void 0:D.feedRound,ee=null==y||null===(N=y[Y])||void 0===N?void 0:N.preFeedRound,te=null==y||null===(M=y[Y])||void 0===M?void 0:M.roundFactor,ie=s&&s[Y],re=ie&&ie[$],oe=t&&t[Y],ae=e=>Za(e,void 0,!0),se=Object.assign({},ae(l),ae({matchUpFormat:U.matchUpType===Qs?void 0:R,tieFormat:U.matchUpType!==Qs?void 0:T,endDate:U.endDate||k,abbreviatedRoundName:Q,drawPositionsRange:re,structureName:_,stageSequence:q,drawPositions:F,matchUpStatus:x,isRoundRobin:I,matchUpTieId:g,preFeedRound:ee,roundFactor:te,matchUpType:C,exitProfile:z,structureId:G,roundNumber:Y,feedRound:X,roundName:Z,drawName:K,schedule:O,drawId:H,stage:W}),Ja(ae(U),!0,!0));if(Array.isArray(F)){const{orderedDrawPositions:e,displayOrder:t}=function({drawPositions:e,roundProfile:t,roundNumber:n}){const i=[void 0,void 0];if(e.reduce(((e,t)=>isNaN(parseInt(t))&&e),!0))return{orderedDrawPositions:i,displayOrder:i};const r=t[n],o=(null==r?void 0:r.pairedDrawPositions.find((t=>Co(t||[],e.filter(Boolean)))))||i,a=null==r?void 0:r.feedRound;if(e.reduce(((e,t)=>!isNaN(parseInt(t))&&e),!0)){const t=e.sort(Xa);return{orderedDrawPositions:t,displayOrder:a?t:o}}if(a){const t=[e.find((e=>!isNaN(parseInt(e)))),void 0];return{orderedDrawPositions:t,displayOrder:t}}return{orderedDrawPositions:o,displayOrder:o}}({drawPositions:F,roundProfile:y,roundPosition:$,roundNumber:Y}),n=y[Y]&&y[Y].feedRound,i=t[0]!==e[0],r=e.map(((e,t)=>{var r;const a=t+1,s=function({drawPositionCollectionAssignment:e,positionAssignments:t,displaySideNumber:n,seedAssignments:i,drawPosition:r,isFeedRound:o,sideNumber:a}){var s,c,u;const d=t.find((e=>e.drawPosition===r)),l=e?null===(s=e[r])||void 0===s?void 0:s.participantId:null==d?void 0:d.participantId,p=d?function({displaySideNumber:e,seedAssignments:t,participantId:n,assignment:i,sideNumber:r}){const o={drawPosition:i.drawPosition,displaySideNumber:e,sideNumber:r};if(n){const e=function({seedAssignments:e,participantId:t}){return e.find((e=>!e.seedProxy&&e.participantId===t))}({seedAssignments:t,participantId:n});Object.assign(o,e,{participantId:n})}else i.bye?Object.assign(o,{bye:!0}):i.qualifier&&Object.assign(o,{qualifier:!0});return o}({displaySideNumber:n,seedAssignments:i,participantId:l,assignment:d,sideNumber:a}):{};o&&(1===a?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0}));const m=null==e||null===(c=e[r])||void 0===c?void 0:c.teamParticipant,f=null==e||null===(u=e[r])||void 0===u?void 0:u.participant;return f&&Object.assign(p,{participant:f}),m&&Object.assign(p,{teamParticipant:m}),p}({drawPositionCollectionAssignment:J,positionAssignments:j,displaySideNumber:i?3-a:a,seedAssignments:o,drawPosition:e,isFeedRound:n,sideNumber:a}),c=null===(r=U.sides)||void 0===r?void 0:r.find((e=>e.sideNumber===a)),u=oe&&oe[2*($-1)+t+1];return ae(f(f({sourceDrawPositionRange:u},c),s))}));Object.assign(se,Ja({sides:r},!0,!0))}if(n&&se.sides&&(se.sides.filter(Boolean).forEach((e=>{var t;if(e.participantId){const t=As({policyDefinitions:m,participantId:e.participantId,tournamentParticipants:n});if(t){if(null!=a&&a.entries){const n=a.entries.find((t=>t.participantId===e.participantId));null!=n&&n.entryStatus&&(t.entryStatus=n.entryStatus||yd)}Object.assign(e,{participant:t})}}if(null!=e&&null!==(t=e.participant)&&void 0!==t&&t.individualParticipantIds){const t=e.participant.individualParticipantIds.map((e=>As({policyDefinitions:m,tournamentParticipants:n,participantId:e})));Object.assign(e.participant,{individualParticipants:t})}})),!se.matchUpType)){const{matchUpType:e}=function({matchUp:e={}}={}){var t;let n=e.matchUpType;if(!n&&null!==(t=e.sides)&&void 0!==t&&t.length){const t=e.sides.find((({participant:e})=>e)),i=null==t?void 0:t.participant,r=null==i?void 0:i.participantType;n=r===dc?Ls:r===pc?js:r===lc?lc:void 0}return{matchUpType:n}}({matchUp:se});e&&Object.assign(se,{matchUpType:e})}if(se.tieMatchUps){var ce;const n=se.matchUpStatus===qr,i=null===(ce=se.sides)||void 0===ce?void 0:ce.map((({participant:e,drawPosition:t,sideNumber:n,lineUp:i})=>{const r=(null==e?void 0:e.participantType)===Qs&&e;return{teamParticipant:r&&Za({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participanOthertName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}),drawPosition:t,sideNumber:n,lineUp:i}}));se.tieMatchUps=se.tieMatchUps.map((r=>{const o=se.matchUpId;return ne({tieDrawPositions:F,scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,sideLineUps:i,drawPositionsRanges:s,roundNamingProfile:u,additionalContext:{abbreviatedRoundName:Q,roundNumber:Y,roundName:Z},appliedPolicies:m,isCollectionBye:n,matchUpTieId:o,isRoundRobin:I,roundProfile:y,matchUp:r,event:b})}))}const ue=se.sides&&2===se.sides.filter((e=>e&&e.participantId)).length,de=!se.winningSide,le=V&&ue&&de;if(Object.assign(se,{readyToScore:le,hasContext:!0}),ue){const{allParticipantsCheckedIn:e,checkedInParticipantIds:t}=Zd({matchUp:se});Object.assign(se,{allParticipantsCheckedIn:e,checkedInParticipantIds:t})}return Array.isArray(null==c?void 0:c.exclude),se}}function el({tournamentParticipants:e,drawDefinition:t,contextProfile:n,matchUpsMap:i,matchUpId:r,inContext:o,context:a,event:s}){if(!t)return{error:jo};if(!r)return{error:"Missing matchUpId"};if("string"!=typeof r)return{error:_o};const{structures:c}=sd({drawDefinition:t});for(const u of c){const{matchUps:c}=Xd({tournamentParticipants:e,drawDefinition:t,contextProfile:n,matchUpsMap:i,inContext:o,structure:u,context:a,event:s}),{matchUp:d}=ac({matchUps:c,matchUpId:r});if(d)return{matchUp:d,structure:u}}return{error:"matchUp not found"}}function tl({duplicateValues:e,drawDefinition:t,disableNotice:n,matchUpId:i,timeItem:r,event:o}){const{matchUp:a}=el({drawDefinition:t,event:o,matchUpId:i});if(!a)return{error:"matchUp not found"};const s=Lu({element:a,timeItem:r,duplicateValues:e});return n||Wu({drawDefinition:t,matchUp:a}),s}function nl({tournamentRecord:e,drawDefinition:t,matchUpId:n,venueId:i,disableNotice:r}){if(!e)return{error:Lo};if(!n)return{error:"Missing matchUpId"};if(i){const{error:t}=ec({tournamentRecord:e,venueId:i});if(t)return{error:t}}return tl({drawDefinition:t,matchUpId:n,timeItem:{itemType:ms,itemValue:i},disableNotice:r,duplicateValues:!1})}function il({tournamentRecord:e,drawDefinition:t,courtDayDate:n,matchUpId:i,courtId:r,disableNotice:o}){if(!e)return{error:Lo};if(!i)return{error:"Missing matchUpId"};if(r){const{venue:n,error:a}=tc({tournamentRecord:e,courtId:r});if(a)return{error:a};nl({tournamentRecord:e,drawDefinition:t,matchUpId:i,venueId:null==n?void 0:n.venueId,disableNotice:o})}return tl({drawDefinition:t,matchUpId:i,timeItem:{itemType:ps,itemDate:n,itemValue:r},disableNotice:o,duplicateValues:!1})}function rl(e){if(Pa.test(e)){const t=Aa(new Date);return new Date(`${t}T${e}`)}return new Date(e)}function ol(e){return!(void 0!==e&&!Na.test(e))}function al({tournamentRecord:e,drawDefinition:t,disableNotice:n,matchUpId:i,schedule:r,event:o}){if(!t)return{error:jo};if(!i)return{error:"Missing matchUpId"};if(!r)return{error:$o};const{endTime:a,courtId:s,resumeTime:c,scheduledDate:u,scheduledTime:d,startTime:l,stopTime:p,venueId:m}=r;if(void 0!==u){const e=sl({disableNotice:!0,drawDefinition:t,scheduledDate:u,matchUpId:i});if(null!=e&&e.error)return{error:e.error,scheduledDate:u}}if(void 0!==d){const e=cl({disableNotice:!0,drawDefinition:t,scheduledTime:d,matchUpId:i});if(null!=e&&e.error)return{error:e.error,scheduledTime:d}}if(void 0!==l){const e=dl({disableNotice:!0,drawDefinition:t,matchUpId:i,startTime:l,event:o});if(null!=e&&e.error)return{error:e.error,startTime:l}}if(void 0!==p){const e=pl({disableNotice:!0,drawDefinition:t,matchUpId:i,stopTime:p,event:o});if(null!=e&&e.error)return{error:e.error,stopTime:p}}if(void 0!==c){const e=ml({disableNotice:!0,drawDefinition:t,resumeTime:c,matchUpId:i,event:o});if(null!=e&&e.error)return{error:e.error,resumeTime:c}}if(void 0!==a){const e=ll({disableNotice:!0,drawDefinition:t,matchUpId:i,endTime:a,event:o});if(null!=e&&e.error)return{error:e.error,endTime:a}}if(void 0!==s&&void 0!==u){const n=il({courtDayDate:u,disableNotice:!0,tournamentRecord:e,drawDefinition:t,matchUpId:i,courtId:s,event:o});if(null!=n&&n.error)return{error:n.error,courtId:s}}else if(void 0!==m){const n=nl({disableNotice:!0,tournamentRecord:e,drawDefinition:t,matchUpId:i,venueId:m,event:o});if(null!=n&&n.error)return{error:n.error,venueId:m}}if(!n){const{matchUp:e}=el({drawDefinition:t,event:o,matchUpId:i});if(!e)return{error:"matchUp not found"};Wu({drawDefinition:t,matchUp:e})}return f({},ko)}function sl({drawDefinition:e,disableNotice:t,scheduledDate:n,matchUpId:i}){if(!i)return{error:"Missing matchUpId"};const r=Da.test(n);return n&&!r?{error:Go}:tl({duplicateValues:!1,drawDefinition:e,disableNotice:t,matchUpId:i,timeItem:{itemType:"SCHEDULE.DATE",itemValue:n}})}function cl({drawDefinition:e,disableNotice:t,scheduledTime:n,matchUpId:i}){return i?ol(n)?tl({duplicateValues:!1,drawDefinition:e,disableNotice:t,matchUpId:i,timeItem:{itemType:"SCHEDULE.TIME.SCHEDULED",itemValue:n}}):{error:"Invalid time"}:{error:"Missing matchUpId"}}function ul({drawDefinition:e,disableNotice:t,participantId:n,officialType:i,matchUpId:r}){return r?tl({duplicateValues:!1,drawDefinition:e,disableNotice:t,matchUpId:r,timeItem:{itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemSubTypes:[i],itemValue:n}}):{error:"Missing matchUpId"}}function dl({drawDefinition:e,disableNotice:t,matchUpId:n,startTime:i,event:r}){if(!n)return{error:"Missing matchUpId"};if(!ol(i))return{error:"Invalid time"};const{matchUp:o}=el({drawDefinition:e,event:r,matchUpId:n}),a=(o.timeItems||[]).filter((e=>[hs,vs,gs].includes(null==e?void 0:e.itemType))).map((e=>rl(e.itemValue))).reduce(((e,t)=>!e||t<e?t:e),void 0);return!a||rl(i)<a?(o.timeItems&&(o.timeItems=o.timeItems.filter((e=>e.itemType!==fs))),tl({duplicateValues:!1,drawDefinition:e,disableNotice:t,matchUpId:n,timeItem:{itemType:fs,itemValue:i}})):{error:"Invalid startTime"}}function ll({drawDefinition:e,disableNotice:t,matchUpId:n,endTime:i,event:r}){if(!n)return{error:"Missing matchUpId"};if(!ol(i))return{error:"Invalid time"};const{matchUp:o}=el({drawDefinition:e,event:r,matchUpId:n}),a=(o.timeItems||[]).filter((e=>[fs,vs,hs].includes(null==e?void 0:e.itemType))).map((e=>rl(e.itemValue))).reduce(((e,t)=>!e||t>e?t:e),void 0);return!a||rl(i)>a?(o.timeItems&&(o.timeItems=o.timeItems.filter((e=>e.itemType!==gs))),tl({duplicateValues:!1,drawDefinition:e,disableNotice:t,matchUpId:n,timeItem:{itemType:gs,itemValue:i}})):{error:"Invalid endTime"}}function pl({drawDefinition:e,disableNotice:t,matchUpId:n,stopTime:i,event:r}){if(!n)return{error:"Missing matchUpId"};if(!ol(i))return{error:"Invalid time"};const{matchUp:o}=el({drawDefinition:e,event:r,matchUpId:n}),a=o.timeItems||[];if(a.reduce(((e,t)=>t.itemType===gs||e),void 0))return{error:"Existing endTime"};const s=a.filter((e=>[fs,vs,hs].includes(null==e?void 0:e.itemType))).sort(((e,t)=>rl(e.itemValue)-rl(t.itemValue))),c=s[s.length-1],u=c&&c.itemType===hs,d=s.filter((e=>!u||e.createdAt!==c.createdAt)).map((e=>rl(e.itemValue))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(rl(i)>d){if(o.timeItems&&u){const e=c.createdAt;o.timeItems=o.timeItems.filter((t=>t.createdAt!==e))}return tl({duplicateValues:!0,drawDefinition:e,disableNotice:t,matchUpId:n,timeItem:{itemType:hs,itemValue:i}})}return{error:"Invalid stopTime"}}function ml({drawDefinition:e,disableNotice:t,resumeTime:n,matchUpId:i,event:r}){if(!i)return{error:"Missing matchUpId"};if(!ol(n))return{error:"Invalid time"};const{matchUp:o}=el({drawDefinition:e,event:r,matchUpId:i}),a=o.timeItems||[];if(a.reduce(((e,t)=>t.itemType===gs||e),void 0))return{error:"Existing endTime"};const s=a.filter((e=>[fs,vs,hs].includes(null==e?void 0:e.itemType))).sort(((e,t)=>rl(e.itemValue)-rl(t.itemValue))),c=s[s.length-1],u=c&&c.itemType===vs,d=s.filter((e=>!u||e.createdAt!==c.createdAt)).map((e=>rl(e.itemValue))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(rl(n)>d){if(o.timeItems&&u){const e=c.createdAt;o.timeItems=o.timeItems.filter((t=>t.createdAt!==e))}return tl({duplicateValues:!0,drawDefinition:e,disableNotice:t,matchUpId:i,timeItem:{itemType:vs,itemValue:n}})}return{error:"Invalid resumeTime"}}function fl(e){const{nationalityCode:t}=e||{};if(t){const n=Yc.find((({ioc:e})=>e===t));null!=n&&n.iso&&!e.isoNationalityCode&&(e.isoNationalityCode=n.iso),null!=n&&n.label&&!e.countryName&&(e.countryName=n.label)}}function hl({participant:e}){const{person:t,individualParticipants:n}=e;[t,null==n?void 0:n.map((({person:e})=>e))].flat().filter(Boolean).forEach(fl)}function vl({participants:e=[]}){const t=Ja(e,!0,!0),n=t.filter((e=>e.participantType===lc)),i=t.filter((e=>e.participantType===mc)),r=t.filter((e=>e.participantType===pc));return t.forEach((e=>{if(e.participantType===dc){const{participantId:t}=e;e.groupParticipantIds=[],e.teamParticipantIds=[],e.pairParticipantIds=[],e.groups=[],e.teams=[],n.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==t||e.teamParticipantIds.includes(n.participantId)||(e.teamParticipantIds.push(n.participantId),e.teams.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId,teamId:n.teamId}))}))})),r.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==t||e.pairParticipantIds.includes(n.participantId)||e.pairParticipantIds.push(n.participantId)}))})),i.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==t||e.groupParticipantIds.includes(n.participantId)||(e.groupParticipantIds.push(n.participantId),e.groups.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId}))}))}))}})),t}function gl({drawDefinition:e,inContextDrawMatchUps:t,targetLink:n,sourceRoundPosition:i,sourceRoundMatchUpCount:r}){if(!n)return{error:"Missing targetLink"};const{target:{structureId:o,feedProfile:a,groupedOrder:s,roundNumber:c,positionInterleave:u}}=n,{structure:d}=ad({drawDefinition:e,structureId:o}),{positionAssignments:l}=Hd({structure:d}),p=(null==t?void 0:t.filter((e=>e.structureId===d.structureId))).filter((e=>e.roundNumber===c)),m=p.length,f=Eo(1,m+1),h=m/r;let v=Math.ceil(h*i),g=1-i%2;if(null!=u&&u.interleave&&.5!==h){const e=i+(u.offset+(i-1)*u.interleave);v=Math.ceil(e/2),g=1-e%2}let I=f,y=f[v-1];const w=qd({groupedOrder:s,roundPositionsCount:f.length}),U=(null==w?void 0:w.length)||1;if(U<=f.length){const e=xo(f,m/U);"BOTTOM_UP"===a&&e.forEach((e=>e.reverse())),I=(null==w?void 0:w.length)&&(null==w?void 0:w.map((t=>e[t-1])).flat())||I}a===su?y=I[v-1]:"BOTTOM_UP"===a?((null==w||!w.length||U>f.length)&&(v=p.length+1-v),y=I[v-1]):"RANDOM"===a?sa()&&console.log("not implemented:",{feedProfile:a}):"DRAW"===a&&sa()&&console.log("not implemented:",{feedProfile:a});const b=y&&p.reduce(((e,t)=>t.roundPosition===y?t:e),void 0);let S;var P;null!=b&&b.feedRound?(g=0,S=Math.min(...(b.drawPositions||[]).filter(Boolean))):S=2===(null==b||null===(P=b.drawPositions)||void 0===P?void 0:P.length)&&(null==b?void 0:b.drawPositions[g]);const D=l.find((({drawPosition:e})=>e===S));if(D){const{extension:e}=Cs({element:D,name:"disableLinks"});if(null!=e&&e.value)return{disabledDrawPosition:S}}return{matchUp:b,targetDrawPosition:S,matchUpDrawPositionIndex:g}}function Il({source:e,linkType:t,finishingPositions:n}){return e.reduce(((e,i)=>{var r,o;return null!==(r=i.source)&&void 0!==r&&r.finishingPositions&&n&&!Co(n,null===(o=i.source)||void 0===o?void 0:o.finishingPositions)||i.linkType!==t?e:i}),void 0)}function yl({drawDefinition:e,structureId:t,roundNumber:n}){return e?t?{links:(e.links||[]).filter(Boolean).reduce(((e,i)=>{var r,o;return(null===(r=i.source)||void 0===r?void 0:r.structureId)!==t||n&&i.source.roundNumber!==n||(e.source=e.source.concat(i)),(null===(o=i.target)||void 0===o?void 0:o.structureId)!==t||n&&i.target.roundNumber!==n||(e.target=e.target.concat(i)),e}),{source:[],target:[]})}:{error:"Missing structureId"}:{error:jo}}function wl({matchUpId:e,drawDefinition:t,inContextDrawMatchUps:n=[],inContextMatchUp:i,useTargetMatchUpIds:r=!1}){let o=i;n.length&&!o&&(o=n.find((t=>t.matchUpId===e)));const{structure:a}=ad({drawDefinition:t,structureId:o.structureId}),{finishingPosition:s}=a;return"ROUND_OUTCOME"===s?function({matchUp:e,structure:t,drawDefinition:n,inContextDrawMatchUps:i,useTargetMatchUpIds:r}){const{links:{source:o}}=function({drawDefinition:e,roundNumber:t,structureId:n}){if(!e)return{error:jo};if(!n)return{error:"Missing structureId"};const{links:i}=yl({drawDefinition:e,structureId:n});return{links:{source:i.source.reduce(((e,n)=>n.source.roundNumber&&n.source.roundNumber!==t?e:e.concat(n)),[]),target:i.target.reduce(((e,n)=>n.target.roundNumber&&n.target.roundNumber!==t?e:e.concat(n)),[])}}}({drawDefinition:n,roundNumber:e.roundNumber,structureId:t.structureId}),a=Il({source:o,linkType:"WINNER"}),s=Il({source:o,linkType:cu}),{winnerMatchUpId:c,loserMatchUpId:u}=e;let d,l,p,m,f,h,v;if(r&&(m=c&&i.find((({matchUpId:e})=>e===c)),d=u&&i.find((({matchUpId:e})=>e===u))),a&&!m||s&&!d){const{roundPosition:r}=e;v=v||i.filter((e=>e.structureId===t.structureId));const o=v.reduce(((t,n)=>n.roundNumber===e.roundNumber?t+1:t),0);s&&({matchUp:d,matchUpDrawPositionIndex:p,targetDrawPosition:l}=gl({drawDefinition:n,inContextDrawMatchUps:i,sourceRoundPosition:r,sourceRoundMatchUpCount:o,targetLink:s})),a&&({matchUp:m,matchUpDrawPositionIndex:h,targetDrawPosition:f}=gl({drawDefinition:n,inContextDrawMatchUps:i,sourceRoundPosition:r,sourceRoundMatchUpCount:o,targetLink:a}))}return m||(v=v||i.filter((e=>e.structureId===t.structureId)),({matchUp:m}=function({structureMatchUps:e,matchUp:t}){const{roundNumber:n,roundPosition:i}=t,r=e.filter((e=>e.roundNumber===n)),o=e.filter((e=>e.roundNumber===n+1));if(o.length){let e;return o.length===r.length?e=o.find((e=>e.roundPosition===i)):o.length===r.length/2&&(e=o.find((e=>e.roundPosition===Math.ceil(i/2)))),{matchUp:e}}return{error:"no progression found"}}({structureMatchUps:v,matchUp:e}))),{matchUp:e,targetLinks:{loserTargetLink:s,winnerTargetLink:a},targetMatchUps:{loserMatchUp:d,winnerMatchUp:m,loserTargetDrawPosition:l,winnerTargetDrawPosition:f,loserMatchUpDrawPositionIndex:p,winnerMatchUpDrawPositionIndex:h}}}({drawDefinition:t,inContextDrawMatchUps:n,structure:a,matchUp:o,useTargetMatchUpIds:r}):function({matchUp:e}){return{matchUp:e,targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0}}}({drawDefinition:t,matchUp:o,structure:a})}function Ul({drawDefinition:e,inContextDrawMatchUps:t}){const n={};return t.forEach((i=>{const{matchUpId:r,structureId:o,drawPositions:a=[]}=i,{structure:s}=ad({drawDefinition:e,structureId:o});if("WIN_RATIO"===(null==s?void 0:s.finishingPosition)){const{roundNumber:e}=i,t=e&&parseInt(e)+1,n=s.matchUps||[],{roundMatchUps:r}=nd({matchUps:n});if(t&&r[t]){const e=a.sort().map(((e,n)=>{const i=r[t].find((t=>{var n;return null===(n=t.drawPositions)||void 0===n?void 0:n.includes(e)}));return{matchUpId:null==i?void 0:i.matchUpId,roundNumber:t,schedule:null==i?void 0:i.schedule,sideNumber:n+1,structureName:s.structureName}}));Object.assign(i,{sidesTo:e})}}else{var c,u;const o=wl({matchUpId:r,drawDefinition:e,inContextMatchUp:i,inContextDrawMatchUps:t,useTargetMatchUpIds:!0}),{winnerMatchUp:a,loserMatchUp:s}=o.targetMatchUps;!i.winnerMatchUpId&&a&&(i.winnerMatchUpId=a.matchUpId),!i.loserMatchUpId&&s&&(i.loserMatchUpId=s.matchUpId);const v=Sl({upcomingMatchUp:a});let g=Sl({upcomingMatchUp:s});if(i.matchUpStatus!==qr&&(null==s?void 0:s.matchUpStatus)===qr){const{matchUp:n}=bl({matchUp:s,drawDefinition:e,inContextDrawMatchUps:t})||{};g=n&&Sl({upcomingMatchUp:n})||g}const I=null===(c=i.schedule)||void 0===c?void 0:c.timeAfterRecovery;var d,l,p;if(I)null!=v&&null!==(d=v.schedule)&&void 0!==d&&d.scheduledTime&&La(v.schedule.scheduledTime)<La(I)&&(n[v.matchUpId]=i.matchUpId,v.schedule.scheduleConflict=i.matchUpId),null!==(l=g)&&void 0!==l&&null!==(p=l.schedule)&&void 0!==p&&p.scheduledTime&&La(g.schedule.scheduledTime)<La(I)&&(n[g.matchUpId]=i.matchUpId,g.schedule.scheduleConflict=i.matchUpId);if(Object.assign(i,{winnerTo:v,loserTo:g}),null!==(u=i.drawPositions)&&void 0!==u&&u.filter(Boolean).length){var m;const e=null===(m=o.targetLinks)||void 0===m?void 0:m.loserTargetLink,t="FIRST_MATCHUP"===(null==e?void 0:e.linkCondition),n=(null==(f=i)||null===(h=f.sides)||void 0===h?void 0:h.map((({participant:e,participantId:t,qualifier:n})=>e||t&&{participantId:t}||n&&{qualifier:n})).filter(Boolean))||[];if(n.length){const e=Zu(null==a?void 0:a.sides),i=Zu(null==s?void 0:s.sides),r=n.find((({participantId:t})=>e.includes(t)))?[]:n,o=n.find((({participantId:e})=>i.includes(e)))?[]:n;s&&t&&o.length<2&&o.push({bye:!0,tbd:!0}),null!=r&&r.length&&a&&(a.potentialParticipants||(a.potentialParticipants=[]),a.potentialParticipants.push(r)),null!=o&&o.length&&s&&(s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(o))}}}var f,h})),Object.keys(n).length&&t.forEach((e=>{Object.keys(n).includes(e.matchUpId)&&(e.schedule.scheduleConflict=n[e.matchUpId])})),{scheduleConflictMatchUpIds:n}}function bl({matchUp:e,drawDefinition:t,inContextDrawMatchUps:n}){const{matchUpId:i,matchUpStatus:r,structureId:o}=e||{};if(!e||!o||(null==e?void 0:e.matchUpStatus)===eo)return{matchUp:e};if(r===qr){let r;if(e.winnerMatchUpId)r=n.find((({matchUpId:t})=>t===e.winnerMatchUpId));else{const e=wl({matchUpId:i,drawDefinition:t,inContextDrawMatchUps:n});({winnerMatchUp:r}=(null==e?void 0:e.targetMatchUps)||{})}return bl({matchUp:r,drawDefinition:t,inContextDrawMatchUps:n})}return{matchUp:void 0}}function Sl({upcomingMatchUp:e}={}){if(e)return(({matchUpId:e,structureId:t,schedule:n,roundNumber:i,roundPosition:r,structureName:o})=>({matchUpId:e,structureId:t,schedule:n,roundNumber:i,roundPosition:r,structureName:o}))(e)}function Pl({requireParticipants:e=!0,scheduleVisibilityFilters:t,tournamentAppliedPolicies:n,tournamentParticipants:i,policyDefinitions:r,tournamentRecord:o,drawDefinition:a,matchUpFilters:s,contextFilters:c,contextProfile:u,scheduleTiming:d,matchUpsMap:l,roundFilter:p,structureId:m,inContext:f,structure:h,context:v,event:g}){!h&&m&&({structure:h}=ad({drawDefinition:a,structureId:m}));const{matchUps:I,error:y}=Xd({tournamentAppliedPolicies:n,scheduleVisibilityFilters:t,tournamentParticipants:i,policyDefinitions:r,tournamentRecord:o,drawDefinition:a,matchUpFilters:s,contextFilters:c,contextProfile:u,scheduleTiming:d,matchUpsMap:l,structure:h,inContext:f,context:v,event:g});if(y)return{error:y};const{assignedPositions:w}=Kd({structure:h}),U=w.filter((e=>e.participantId)).map((e=>e.drawPosition)),b=[],S=[],P=[],D=[],N=[];return I.filter((e=>{var t;const n=1===(null==s||null===(t=s.matchUpTypes)||void 0===t?void 0:t.length)&&s.matchUpTypes[0]===Bs;return e.matchUpType===Bs||!n})).forEach((t=>{var n,i,r;if(t.matchUpStatus===Wr)return void D.push(t);const o=t.collectionId,a=o&&t.sides.every((e=>e.participantId)),s=t.roundNumber===p,c=!o&&2===(null===(n=t.drawPositions)||void 0===n?void 0:n.filter(Boolean).length),u=!o&&(null===(i=t.drawPositions)||void 0===i?void 0:i.every((e=>U.includes(e)))),d=w.filter((e=>e.bye)).map((e=>e.drawPosition)),l=!o&&(null===(r=t.drawPositions)||void 0===r?void 0:r.find((e=>d.includes(e)))),m=co.includes(t.matchUpStatus)&&(a||c&&(!p||s)&&(!e||u));return l?b.push(t):is(t)?N.push(t):m?P.push(t):S.push(t)})),{completedMatchUps:N,upcomingMatchUps:P,pendingMatchUps:S,abandonedMatchUps:D,byeMatchUps:b,structure:h}}function Dl(e){if(!e.drawDefinition)return{error:jo};Object.assign(e,{requireParticipants:!1});const{abandonedMatchUps:t,completedMatchUps:n,upcomingMatchUps:i,pendingMatchUps:r,byeMatchUps:o,matchUpsMap:a}=Nl(e);return{matchUps:[].concat(...t,...n,...i,...r,...o),matchUpsMap:a}}function Nl({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,tournamentParticipants:n,requireParticipants:i,participantsProfile:r,includeByeMatchUps:o,policyDefinitions:a,tournamentRecord:s,drawDefinition:c,matchUpFilters:u,contextFilters:d,contextProfile:l,scheduleTiming:p,nextMatchUps:m,roundFilter:h,matchUpsMap:v,inContext:g,context:I,event:y}){var w,U;if(!c)return{error:jo};let b=[],S=[],P=[],D=[],N=[];n=(null===(w=n)||void 0===w?void 0:w.length)&&n||(null==s?void 0:s.participants),(g||null!=r&&r.withGroupings)&&null!==(U=n)&&void 0!==U&&U.length&&(n=vl({participants:n}));const{structures:M}=sd({drawDefinition:c});v||(v=id({drawDefinition:c})),M.forEach((r=>{const{byeMatchUps:f=[],pendingMatchUps:w,upcomingMatchUps:U,completedMatchUps:M,abandonedMatchUps:T}=Pl({inContext:g||m,tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:n,requireParticipants:i,includeByeMatchUps:o,policyDefinitions:a,tournamentRecord:s,drawDefinition:c,matchUpFilters:u,contextFilters:d,contextProfile:l,scheduleTiming:p,matchUpsMap:v,roundFilter:h,structure:r,context:I,event:y});b=b.concat(...T),S=S.concat(...M),P=P.concat(...U),D=D.concat(...w),N=N.concat(...f)}));const T=f({abandonedMatchUps:b,completedMatchUps:S,upcomingMatchUps:P,pendingMatchUps:D,byeMatchUps:N,matchUpsMap:v},ko);if(m){const e="object"==typeof m&&m||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:t,completed:n,upcoming:i,pending:r,bye:o}=e,a=[].concat(...t&&T.abandonedMatchUps||[],...n&&T.completedMatchUps||[],...i&&T.upcomingMatchUps||[],...r&&T.pendingMatchUps||[],...o&&T.byeMatchUps||[]);Ul({drawDefinition:c,inContextDrawMatchUps:a})}return T}function Ml({scheduleVisibilityFilters:e,participantsProfile:t,policyDefinitions:n,tournamentRecord:i,inContext:r=!0,contextProfile:o,matchUpFilters:a,contextFilters:s,nextMatchUps:c,context:u}){var d;if(!i)return{error:Lo};const l=(null===(d=i.unifiedTournamentId)||void 0===d?void 0:d.tournamentId)||i.tournamentId,p=(null==i?void 0:i.events)||[],m=Cl({participantsProfile:t,tournamentRecord:i}),{appliedPolicies:v}=Ns({tournamentRecord:i}),g=h(f({},u),{tournamentId:l,indoorOutDoor:i.indoorOutDoor,surfaceCategory:i.surfaceCategory,endDate:i.endDate});return{matchUps:p.map((u=>El({context:g,scheduleVisibilityFilters:e,tournamentAppliedPolicies:v,participantsProfile:t,policyDefinitions:n,tournamentRecord:i,matchUpFilters:a,contextFilters:s,contextProfile:o,nextMatchUps:c,participants:m,inContext:r,event:u}).matchUps)).flat(1/0).concat(...i.matchUps||[])}}function Tl({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,participantsProfile:n,policyDefinitions:i,tournamentRecord:r,matchUpFilters:o,contextFilters:a,drawDefinition:s,contextProfile:c,participants:u,nextMatchUps:d,inContext:l,context:p,event:m}){const{eventId:v,eventName:g,category:I,gender:y,matchUpFormat:w}=m||{};return Dl({context:h(f({},p),{eventId:v,eventName:g,category:I,gender:y,matchUpFormat:w,indoorOutDoor:(null==m?void 0:m.indoorOutDoor)||(null==r?void 0:r.indoorOutDoor),surfaceCategory:(null==m?void 0:m.surfaceCategory)||(null==r?void 0:r.surfaceCategory),endDate:null==m?void 0:m.endDate}),tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:u||r&&Cl({tournamentRecord:r,participantsProfile:n})||[],participantsProfile:n,policyDefinitions:i,tournamentRecord:r,drawDefinition:s,matchUpFilters:o,contextFilters:a,contextProfile:c,nextMatchUps:d,inContext:l,event:m})}function El({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,participantsProfile:n,policyDefinitions:i,participants:r=[],tournamentRecord:o,matchUpFilters:a,contextFilters:s,contextProfile:c,nextMatchUps:u,inContext:d,context:l,event:p}){if(!p)return{error:Vo};const{eventId:m,eventName:h,endDate:v,category:g,gender:I,matchUpFormat:y}=p,w=f(f({},l),Za({indoorOutDoor:p.indoorOutDoor||(null==o?void 0:o.indoorOutDoor),surfaceCategory:p.surfaceCategory||(null==o?void 0:o.surfaceCategory),endDate:p.endDate||(null==o?void 0:o.endDate),tournamentId:null==o?void 0:o.tournamentId,matchUpFormat:y,eventName:h,category:g,gender:I,eventId:m}));v&&(w.endDate=v),r=r||o&&Cl({tournamentRecord:o,participantsProfile:n});const U=p.drawDefinitions||[],b=Fs({tournamentRecord:o,event:p}).scheduleTiming;return{matchUps:U.map((l=>{const{matchUps:m}=Dl({tournamentParticipants:r,tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,context:w,participantsProfile:n,policyDefinitions:i,tournamentRecord:o,drawDefinition:l,matchUpFilters:a,contextFilters:s,contextProfile:c,scheduleTiming:b,nextMatchUps:u,inContext:d,event:p});return m})).flat(1/0)}}function Al({scheduleVisibilityFilters:e,participantsProfile:t,policyDefinitions:n,tournamentRecord:i,inContext:r=!0,matchUpFilters:o,contextFilters:a,contextProfile:s,nextMatchUps:c,context:u}){var d;if(!i)return{error:Lo};const l=(null===(d=i.unifiedTournamentId)||void 0===d?void 0:d.tournamentId)||i.tournamentId,p=i&&i.events||[],m=Cl({participantsProfile:t,tournamentRecord:i}),{appliedPolicies:f}=Ns({tournamentRecord:i}),h=a&&a.eventIds||[];return p.filter((e=>!h.includes(e.eventId))).map((d=>Rl({tournamentAppliedPolicies:f,scheduleVisibilityFilters:e,participantsProfile:t,policyDefinitions:n,tournamentRecord:i,matchUpFilters:o,contextFilters:a,contextProfile:s,participants:m,tournamentId:l,nextMatchUps:c,inContext:r,context:u,event:d}))).reduce(((e,t)=>{const n=t&&Object.keys(t).filter((e=>!["success","matchUpsMap"].includes(e)));return null==n||n.forEach((n=>{e[n]||(e[n]=[]),e[n]=e[n].concat(t[n]),e.matchUpsCount+=t[n].length})),e}),{matchUpsCount:0})}function Rl({tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,participantsProfile:n,policyDefinitions:i,tournamentRecord:r,matchUpFilters:o,contextFilters:a,contextProfile:s,nextMatchUps:c,participants:u,tournamentId:d,inContext:l,context:p,event:m}){if(!m)return{error:Vo};const{eventId:h,eventName:v,endDate:g}=m,I=f(f({},p),Za({eventId:h,eventName:v,endDate:g||(null==r?void 0:r.endDate),tournamentId:d||(null==r?void 0:r.tournamentId),indoorOutDoor:m.indoorOutDoor||(null==r?void 0:r.indoorOutDoor),surfaceCategory:m.surfaceCategory||(null==r?void 0:r.surfaceCategory)})),y=u||r&&Cl({tournamentRecord:r,participantsProfile:n});return(m.drawDefinitions||[]).reduce(((u,d)=>{const p=Nl({context:I,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:y,participantsProfile:n,policyDefinitions:i,tournamentRecord:r,drawDefinition:d,matchUpFilters:o,contextFilters:a,contextProfile:s,nextMatchUps:c,inContext:l,event:m}),f=Object.keys(p);return null==f||f.forEach((e=>{u[e]||(u[e]=[]),u[e]=u[e].concat(p[e])})),u}),{})}function Cl({tournamentRecord:e,participantsProfile:t}){const n=e.participants||[];null!=t&&t.withISO&&n.forEach((e=>hl({participant:e})))}function xl({participantsProfile:e,tournamentRecord:t,contextProfile:n,nextMatchUps:i,matchUpId:r,inContext:o}){if(!t)return{error:Lo};if("string"!=typeof r)return{error:"Missing matchUpId"};const{matchUps:a}=Ml({tournamentRecord:t}),s=a.find((e=>e.matchUpId===r));if(!s)return{error:"matchUp not found"};const{eventId:c,drawId:u}=s,{event:d,drawDefinition:l}=_s({tournamentRecord:t,eventId:c,drawId:u}),p={surfaceCategory:d.surfaceCategory||t.surfaceCategory,indoorOutDoor:d.indoorOutDoor||t.indoorOutDoor,endDate:d.endDate||t.endDate,tournamentId:t.tournamentId,eventId:c,drawId:u},m=t.participants||[],{matchUp:f,structure:h}=el({context:o&&p,tournamentParticipants:m,participantsProfile:e,drawDefinition:l,contextProfile:n,nextMatchUps:i,matchUpId:r,inContext:o,event:d});return{matchUp:f,structure:h,drawDefinition:l}}function Ol({tournamentRecord:e,matchUpIds:t,schedule:n}){if(!e)return{error:Lo};if(!t||!Array.isArray(t))return{error:"Missing matchUpIds"};if(!n||"object"!=typeof n)return{error:"Missing schedule"};const{matchUps:i}=Ml({tournamentRecord:e}),r=i.reduce(((e,t)=>{const{matchUpId:n,drawId:i}=t;return e[i]?e[i].push(n):e[i]=[n],e}),{});for(const o of Object.keys(r)){const{drawDefinition:i}=Ws({tournamentRecord:e,drawId:o}),a=r[o].filter((e=>t.includes(e)));for(const t of a){const r=al({tournamentRecord:e,drawDefinition:i,matchUpId:t,schedule:n});if(r.error)return r}}return f({},ko)}function kl({tournamentRecords:e}){return e?Object.keys(e).reduce(((t,n)=>{t.tournamentIdMap[n]=[];const i=e[n].events||[],r=i.map((({eventId:e})=>e)),o=i.map((e=>(e.drawDefinitions||[]).map((({drawId:e})=>e)))).flat();return t.tournamentIdMap[n].push(...r,...o),t.eventIds.push(...r),t.drawIds.push(...o),t}),{eventIds:[],drawIds:[],tournamentIdMap:{}}):{error:"Missing tournamentRecords"}}function Fl({drawId:e,eventId:t,tournamentRecords:n}){const{tournamentIdMap:i}=kl({tournamentRecords:n});return Object.keys(i).find((n=>i[n].includes(t)||i[n].includes(e)))}function Ll({drawPosition:e,matchUps:t=[]}){return{initialRoundNumber:t.filter((({drawPositions:t})=>e&&(null==t?void 0:t.includes(e)))).map((({roundNumber:e})=>parseInt(e))).sort(Xa)[0]}}function jl({inContextDrawMatchUps:e,positionAssignments:t,targetDrawPosition:n,drawDefinition:i,dualMatchUp:r,matchUp:o}){if(r){var a,s,c;const t=null===(a=e.find((({matchUpId:e})=>o.matchUpId===e)).sides)||void 0===a||null===(s=a.find((e=>e.drawPosition===n)))||void 0===s?void 0:s.sideNumber,i=null===(c=o.sides)||void 0===c?void 0:c.find((e=>e.sideNumber===t));i&&delete i.lineUp}o.drawPositions=(o.drawPositions||[]).map((e=>e===n?void 0:e));const u=t.filter((({drawPosition:e})=>o.drawPositions.includes(e))).filter((e=>e.bye)).length;return o.matchUpStatus=u?qr:o.matchUpStatus===to?to:eo,o.matchUpStatus===to&&(o.winningSide=void 0),Wu({drawDefinition:i,matchUp:o}),f({},ko)}function Bl({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:n}){return e||({matchUps:e,matchUpsMap:n}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:n})),(e||[]).filter((({collectionId:e})=>!e)).forEach((i=>{const{matchUpId:r,structureId:o}=i,a=wl({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:r}),{winnerMatchUp:s,loserMatchUp:c}=a.targetMatchUps,u=null==s?void 0:s.matchUpId,d=null==c?void 0:c.matchUpId,l=rd({matchUpsMap:n,structureId:o}).find((e=>e.matchUpId===r));l&&(u&&(Object.assign(l,{winnerMatchUpId:u}),Object.assign(i,{winnerMatchUpId:u})),d&&(Object.assign(l,{loserMatchUpId:d}),Object.assign(i,{loserMatchUpId:d})))})),{inContextDrawMatchUps:e}}function Vl(e){var t;const{sides:n,matchUpType:i}=e||{},r=null!==(t=e.potentialParticipants)&&void 0!==t&&t.length?e.potentialParticipants.flat().map((e=>i===js?(null==e?void 0:e.individualParticipantIds)||[]:e.participantId)).flat():[],o=(n||[]).map((e=>{var t;return i===js?(null==e||null===(t=e.participant)||void 0===t?void 0:t.individualParticipantIds)||[]:null!=e&&e.participantId?[e.participantId]:[]})).flat();return{individualParticipantIds:o.concat(r).flat(),enteredIndividualParticipantIds:o,potentialIndividualParticipantIds:r}}function $l({tournamentRecords:e,schedulingProfile:t}){if(!t)return{valid:!0};if(!Array.isArray(t))return{valid:!1,error:_o};const{venueIds:n,tournamentsMap:i}=function({tournamentRecords:e={}}={}){const t=e&&Object.values(e)||[],n={},{venueIds:i,eventIds:r,drawIds:o,structureIds:a,tournamentIds:s}=t.reduce(((e,t)=>{const{venueIds:i,eventIds:r,drawIds:o,structureIds:a,tournamentIds:s,tournamentMap:c}=Gl({tournamentRecord:t});return i.forEach((t=>{e.venueIds.includes(t)||e.venueIds.push(t)})),e.tournamentIds.push(...s),e.structureIds.push(...a),e.eventIds.push(...r),e.drawIds.push(...o),Object.assign(n,c),e}),{venueIds:[],eventIds:[],drawIds:[],structureIds:[],tournamentIds:[]});return{venueIds:i,eventIds:r,drawIds:o,structureIds:a,tournamentIds:s,tournamentsMap:n}}({tournamentRecords:e});let r,o;const a=t.every((e=>{const{scheduleDate:t,venues:a}=e;return!!Ta(t)&&a.every((e=>{const{venueId:t,rounds:a}=e;if("string"!=typeof t)return o="venueId should be a string",!1;if(!Array.isArray(a))return o="rounds should be an array",!1;if(!n.includes(t))return r="Venue not found",!1;return!!a.every((e=>{if(!e)return o="empty round",!1;const{tournamentId:t,eventId:n,drawId:r,structureId:a,roundNumber:s,roundSegment:c}=e,u=i[t]&&i[t][n]&&i[t][n][r]&&i[t][n][r][a],d=null==u?void 0:u.includes(s);d||(o="Invalid rounds");const{segmentNumber:l,segmentsCount:p}=c||{},m=!c||Io(l)&&mo(p)&&l<=p;return m||(o="Invalid segment"),d&&m}))}))}));return a||r||(r=_o),{valid:!!a,error:r,message:o}}function Gl({tournamentRecord:e={},tournamentMap:t={},requireCourts:n}={}){const i=[],r=[],o=[],a=[],s=((null==e?void 0:e.venues)||[]).map((({venueId:e,courts:t})=>(!n||(null==t?void 0:t.length))&&e)),c=null==e?void 0:e.tournamentId;return c&&(a.push(c),t[c]={},((null==e?void 0:e.events)||[]).forEach((e=>{const n=e.eventId;r.push(n),t[c][n]={},(e.drawDefinitions||[]).forEach((e=>{const r=e.drawId;i.push(r),t[c][n][r]={};const{structures:a}=sd({drawDefinition:e});(a||[]).forEach((e=>{var i;const a=e.structureId,{matchUps:s}=Xd({structure:e}),{roundMatchUps:u}=nd({matchUps:s}),d=u&&Object.keys(u).map((e=>parseInt(e)));t[c][n][r][a]=d,o.push(a),null!==(i=e.structures)&&void 0!==i&&i.length&&e.structures.forEach((e=>{o.push(e.structureId),t[c][n][r][e.structureId]=d}))}))}))}))),{tournamentIds:a,venueIds:s,eventIds:r,drawIds:i,structureIds:o,tournamentMap:t}}function _l({tournamentRecord:e}){if(!e)return{error:Lo};const t=(({tournamentId:e,tournamentRank:t,formalName:n,tournamentName:i,promotionalName:r,onlineResources:o,localTimeZone:a,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l})=>({tournamentId:e,tournamentRank:t,formalName:n,tournamentName:i,promotionalName:r,onlineResources:o,localTimeZone:a,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l}))(e);return h(f({},ko),{tournamentInfo:Ja(t)})}function Wl({tournamentRecords:e}){const t=Object.keys(e).reduce(((t,n)=>{const i=e[n],{tournamentInfo:{startDate:r,endDate:o}}=_l({tournamentRecord:i}),a=r&&new Date(Va(r));(!t.startDate||a&&a<t.startDate)&&(t.startDate=a);const s=o&&new Date(Va(o));return(!t.endDate||s&&s>t.endDate)&&(t.endDate=s),t}),{startDate:void 0,endDate:void 0}),n=t.startDate&&Va(t.startDate.toISOString()),i=t.endDate&&Va(t.endDate.toISOString());return n&&i?{startDate:n,endDate:i}:{error:"Missing date"}}function ql({tournamentRecords:e,venueIds:t=[]}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const n=[],i=[],r=[],o=[];return Object.keys(e).forEach((a=>{var s;null===(s=e[a].venues)||void 0===s||s.filter((({venueId:e})=>!t.length||t.includes(e))).forEach((e=>{var t;r.includes(e.venueId)||(n.push(Ja(e)),r.push(e.venueId)),null===(t=e.courts)||void 0===t||t.forEach((t=>{if(!o.includes(t.courtId)){const n=h(f({},Ja(t,!1,!0)),{venueId:e.venueId});i.push(n),o.push(t.courtId)}}))}))})),{courts:i,venues:n}}function zl({tournamentRecords:e,requireCourts:t}){return"object"==typeof e&&Object.keys(e).length?Object.keys(e).reduce(((n,i)=>{const r=e[i],{venues:o}=Xs({tournamentRecord:r});return o.forEach((e=>{const{venueId:i,courts:r}=e;(!t||(null==r?void 0:r.length))&&!n.venueIds.includes(i)&&(n.venues.push(e),n.venueIds.push(i))})),n}),{venues:[],venueIds:[]}):{error:"Missing tournamentRecords"}}function Hl({tournamentRecords:e,extension:t}){if(!cd(t))return{error:_o};for(const n of Object.values(e)){const e=ld({tournamentRecord:n,extension:t});if(e.error)return e}return f({},ko)}function Kl({tournamentRecords:e,name:t}){if(!t)return{error:$o,message:"Missing name"};let n;return Object.keys(e).find((i=>{const r=e[i],{extension:o}=xs({tournamentRecord:r,name:t});return n=o,!!o}))?{extension:n}:{error:Wo}}function Yl({tournamentRecords:e,name:t}){if(!t)return{error:$o,message:"Missing name"};let n=0;for(const i of Object.keys(e)){const r=fd({tournamentRecord:e[i],name:t});if(r.error)return r;r.message!==Wo&&n++}return h(f({},ko),{removed:n})}function Jl({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const{extension:t}=Kl({tournamentRecords:e,name:"schedulingProfile"});let n=(null==t?void 0:t.value)||[];if(n.length){const{venueIds:t}=zl({tournamentRecords:e,requireCourts:!0}),{eventIds:i,drawIds:r}=kl({tournamentRecords:e}),{updatedSchedulingProfile:o,modifications:a,issues:s}=Xl({schedulingProfile:n,venueIds:t,eventIds:i,drawIds:r});if(a){n=o;const t=Zl({tournamentRecords:e,schedulingProfile:n});return t.error?t:{schedulingProfile:n,modifications:a,issues:s}}}return{schedulingProfile:n,modifications:0}}function Zl({tournamentRecords:e,schedulingProfile:t}){const n=$l({tournamentRecords:e,schedulingProfile:t});return n.error?n:t?Hl({tournamentRecords:e,extension:{name:"schedulingProfile",value:t}}):Yl({tournamentRecords:e,name:"schedulingProfile"})}function Ql({tournamentRecords:e,scheduleDate:t,venueId:n,round:i}){if(!Ta(t))return{error:Go};const{extension:r}=Kl({tournamentRecords:e,name:"schedulingProfile"}),o=(null==r?void 0:r.value)||[];let a=o.find((e=>Ka(t,e.scheduleDate)));if(!a){const{startDate:n,endDate:i}=Wl({tournamentRecords:e}),r=new Date(t);if(r<new Date(n)||r>new Date(i))return{error:Go};a={scheduleDate:t,venues:[]},o.push(a)}let s=a.venues.find((e=>e.venueId===n));s||(s={venueId:n,rounds:[]},a.venues.push(s));const c=["notBeforeTime"],u=e=>Object.keys(e).filter((e=>!c.includes(e))).sort().map((t=>e[t])).join("|");if(s.rounds.find((e=>u(e)===u(i))))return{error:"Existing round"};s.rounds.push(i);const d=Zl({tournamentRecords:e,schedulingProfile:o});return d.error?d:ko}function Xl({schedulingProfile:e,venueIds:t,eventIds:n,drawIds:i}){const r=[];return{updatedSchedulingProfile:null==e?void 0:e.map((e=>{const o=Va(null==e?void 0:e.scheduleDate);if(!o)return void r.push(`Invalid date: ${null==e?void 0:e.scheduledDate}`);const a=((null==e?void 0:e.venues)||[]).map((e=>{const{rounds:o,venueId:a}=e;if(!t.includes(a))return void r.push(`Missing venueId: ${a}`);const s=o.filter((e=>{const t=n.includes(e.eventId)&&i.includes(e.drawId);return t||r.push(`Invalid eventId: ${e.eventId} or drawId: ${e.drawId}`),t}));return s.length?{venueId:a,rounds:s}:void 0})).filter(Boolean);return a.length&&o&&h(f({},e),{venues:a})})).filter(Boolean),modifications:r.length,issues:r}}function ep({tournamentRecords:e}){const{schedulingProfile:t}=Jl({tournamentRecords:e,requireCourts:!0});if(t){const{venueIds:n}=zl({tournamentRecords:e}),{eventIds:i,drawIds:r}=kl({tournamentRecords:e}),{updatedSchedulingProfile:o,modifications:a}=Xl({schedulingProfile:t,venueIds:n,eventIds:i,drawIds:r});if(a)return Zl({tournamentRecords:e,schedulingProfile:o})}return ko}function tp({matchUps:e=[],schedulingProfile:t}){const n={},i=({eventId:e,drawId:t,structureId:n,roundNumber:i})=>`${e}|${t}|${n}${i}`;null!=t&&t.length&&t.map((({venues:e})=>e.map((({rounds:e})=>e)))).flat().forEach((e=>{e.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))).forEach((({eventId:e,drawId:t,structureId:r,roundNumber:o},a)=>{const s=i({eventId:e,drawId:t,structureId:r,roundNumber:o});n[s]=a}))}));const r=[],o={noScheduledDate:[]};for(const s of e){const e=s.schedule||{},t=e.scheduledDate&&Va(e.scheduledDate)||e.scheduledTime&&Va(e.scheduledTime)||"noScheduledDate";o[t]||(o[t]=[]),o[t].push(s)}const a=Object.keys(o).sort();for(const s of a){const e=o[s],t={noScheduledTime:[]};for(const n of e){const e=n.schedule||{},i=e.scheduledTime&&Ba(e.scheduledTime)||"noScheduledTime";t[i]||(t[i]=[]),t[i].push(n)}const a=Object.keys(t).sort();for(const o of a){const e=t[o];e.sort(((e,t)=>(n[i(e)]||0)-(n[i(t)]||0))),r.push(...e)}}return r}function np({scheduleVisibilityFilters:e,tournamentRecords:t,matchUpFilters:n,contextFilters:i,nextMatchUps:r}){return"object"==typeof t&&Object.keys(t).length?{matchUps:Object.keys(t).map((o=>{const a=t[o],{matchUps:s}=Ml({scheduleVisibilityFilters:e,tournamentRecord:a,matchUpFilters:n,contextFilters:i,nextMatchUps:r});return s})).flat()}:{error:"Missing tournamentRecords"}}function ip(e){if("object"!=typeof(null==e?void 0:e.tournamentRecords)||!Object.keys(null==e?void 0:e.tournamentRecords).length)return{error:"Missing tournamentRecords"};const{courts:t,venues:n}=ql(e),{sortCourtsData:i,sortDateMatchUps:r=!0}=e,o=Jl(e).schedulingProfile,{completedMatchUps:a,upcomingMatchUps:s,pendingMatchUps:c}=rp(e),u=[...s||[],...c||[]],d=r?tp({matchUps:u,schedulingProfile:o}):u;return{courtsData:t.map((e=>{const t=function({courtId:e}){const t=d.filter((t=>{var n;return(null===(n=t.schedule)||void 0===n?void 0:n.courtId)===e}));return i?tp({matchUps:t,schedulingProfile:o}):t}(e);return h(f({},e),{matchUps:t,surfaceCategory:(null==e?void 0:e.surfaceCategory)||""})})),completedMatchUps:a,dateMatchUps:d,venues:n}}function rp({scheduleVisibilityFilters:e,tournamentRecords:t,matchUpFilters:n,contextFilters:i}){return"object"==typeof t&&Object.keys(t).length?Object.keys(t).map((r=>{const o=t[r];return Al({scheduleVisibilityFilters:e,tournamentRecord:o,matchUpFilters:n,contextFilters:i})})).reduce(((e,t)=>(Object.keys(t).forEach((n=>{e[n]||(e[n]=[]),e[n]=e[n].concat(t[n])})),e)),{}):{error:"Missing tournamentRecords"}}function op(e,t){return i=t,(ou[null==(n=e)?void 0:n.stage]||0)-(ou[null==i?void 0:i.stage]||0)||((null==e?void 0:e.stageSequence)||0)-((null==t?void 0:t.stageSequence)||0)||(null==e?void 0:e.roundNumber)-(null==t?void 0:t.roundNumber)||((null==e?void 0:e.roundPosition)||0)-((null==t?void 0:t.roundPosition)||0);var n,i}function ap({includeParticipantDependencies:e,tournamentRecords:t={},drawDefinition:n,matchUps:i=[],drawIds:r=[]}){if(!Array.isArray(i))return{error:"Missing matchUps"};if(!Array.isArray(r))return{error:"Missing drawId"};const o={},a=e=>{o[e]||(o[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[]})},s=(t,n)=>{o[t].matchUpIds.forEach((e=>o[n].matchUpIds.push(e))),o[n].matchUpIds.push(t),o[t].dependentMatchUpIds.push(n),e&&o[t].participantIds.forEach((e=>o[n].participantIds.push(e)))},c=t=>{for(const n of t){const{matchUpId:t,winnerMatchUpId:i,loserMatchUpId:r}=n;if(a(t),e){const{individualParticipantIds:e}=Vl(n);o[t].participantIds=e}i&&(a(i),s(t,i)),r&&(a(r),s(t,r))}};if(n)Bl({drawDefinition:n}),i.length||({matchUps:i}=Tl({drawDefinition:n})),c(i);else{i.length||({matchUps:i}=np({tournamentRecords:t,nextMatchUps:!0})),r.length||(r=t?Object.values(t).map((({events:e=[]})=>e.map((({drawDefinitions:e=[]})=>e.map((({drawId:e})=>e)))))).flat(1/0):[]);for(const e of r){let n=i.filter((t=>t.drawId===e)).sort(op);if(!n.find((({winnerMatchUpId:e,loserMatchUpId:t})=>e||t))&&!n.find((({roundPosition:e})=>e))){const i=n.find((({tournamentId:e})=>e)),{drawDefinition:r}=_s({tournamentRecord:t[i.tournamentId],drawId:e});Bl({drawDefinition:r})}c(n)}}return f({matchUpDependencies:o},ko)}function sp({matchUpStatus:e}){return ro.includes(e)}function cp({matchUpStatus:e}){return oo.includes(e)}function up({score:e,winningSide:t,matchUpStatus:n}){return(null==e?void 0:e.scoreStringSide1)||t||function({matchUpStatus:e}){return so.includes(e)}({matchUpStatus:n})}function dp({drawDefinition:e,structureId:t,structure:n}){if(!n){const i=ad({drawDefinition:e,structureId:t});if(i.error)return i;n=i.structure}const{matchUps:i}=Xd({inContext:!0,drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},structure:n}),r=bo([].concat(...i.map((e=>e.drawPositions||[]))).filter(Boolean)).sort(Xa),{matchUpDependencies:o}=ap({matchUps:i,drawIds:[e.drawId],drawDefinition:e}),a=bo(i.filter(up).map((e=>{var t;return[].concat(...(null===(t=o[e.matchUpId])||void 0===t?void 0:t.matchUpIds)||[],e.matchUpId)})).flat()),s=bo(i.map((({matchUpId:e,drawPositions:t})=>a.includes(e)?t:[])).flat().filter(Boolean)).sort(Xa),{positionAssignments:c}=Hd({drawDefinition:e,structure:n}),u=c.filter((e=>e.bye)).map((e=>e.drawPosition)),d=(null==r?void 0:r.filter((e=>!s.includes(e))))||[];return{allDrawPositions:r,inContextStructureMatchUps:i,activeDependentMatchUpIds:a,inactiveDrawPositions:d,positionAssignments:c,activeDrawPositions:s,byeDrawPositions:u,structure:n}}function lp({positionAssignments:e,drawDefinition:t,matchUpsMap:n,structure:i,event:r}){const{matchUps:o}=Xd({drawDefinition:t,matchUpsMap:n,structure:i,event:r});o.forEach((n=>{const i=e.filter((({drawPosition:e})=>{var t;return null===(t=n.drawPositions)||void 0===t?void 0:t.includes(e)})).filter((e=>e.bye)).length;if(!n.winningSide){const e=i?qr:eo;Object.assign(n,{matchUpStatus:e}),Wu({drawDefinition:t,matchUp:n})}}))}function pp({inContextDrawMatchUps:e,drawDefinition:t,drawPosition:n,matchUpsMap:i,structureId:r,event:o}){const{structure:a}=ad({drawDefinition:t,structureId:r}),{positionAssignments:s}=Kd({drawDefinition:t,structure:a}),c=s.some((e=>{if(e.drawPosition===n)return delete e.participantId,delete e.qualifier,delete e.bye,!0}));if(a.structureType===au)return lp({positionAssignments:s,drawDefinition:t,structure:a,matchUpsMap:i}),{drawPositionCleared:c};const{matchUps:u}=Xd({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:a,event:o}),{roundProfile:d,roundMatchUps:l}=nd({matchUps:u}),p=Object.keys(d).map((e=>parseInt(e)));let m=n;const f=p.map((e=>{const t=d[e].pairedDrawPositions.find((e=>e.includes(m))),n=null==t?void 0:t.find((e=>e!==m)),i=s.find((e=>e.drawPosition===n)),r=d[e+1],o=null==i?void 0:i.bye,a=r&&r.pairedDrawPositions.find((e=>e.includes(n))),c=o&&a&&r&&r.drawPositions.includes(n),u=t&&{roundNumber:e,relevantPair:t,pairedDrawPosition:n,pairedDrawPositionByeAdvancedPair:!c&&a,targetDrawPosition:m};return c&&(m=n),u})).filter((e=>null==e?void 0:e.targetDrawPosition)).reduce(((e,t)=>{const{roundNumber:n,relevantPair:i,targetDrawPosition:r,pairedDrawPosition:o,pairedDrawPositionByeAdvancedPair:a}=t,s=[{roundNumber:n,targetDrawPosition:r,relevantPair:i},a&&{roundNumber:n+1,targetDrawPosition:o,relevantPair:a,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat(...s)}),[]);return f.forEach((({roundNumber:o,targetDrawPosition:c,relevantPair:u})=>{const d=l[o].find((e=>Co(e.drawPositions.filter(Boolean),u.filter(Boolean))));d&&(function({inContextDrawMatchUps:e,targetDrawPosition:t,drawDefinition:n,matchUpsMap:i,roundNumber:r,structureId:o}){var a;const{structure:s}=ad({drawDefinition:n,structureId:o});if(s.structureType===au)return;const c=((null===(a=i=i||id({drawDefinition:n}))||void 0===a?void 0:a.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=Ll({drawPosition:t,matchUps:c}),d=null==c?void 0:c.filter((e=>e.roundNumber>=r&&e.roundNumber!==u&&e.drawPositions.includes(t))),{positionAssignments:l}=Hd({drawDefinition:n,structureId:o});null==d||d.forEach((r=>mp({drawPosition:t,targetMatchUp:r,inContextDrawMatchUps:e,positionAssignments:l,drawDefinition:n,matchUpsMap:i,structure:s})))}({drawDefinition:t,structureId:r,roundNumber:o,targetDrawPosition:c,matchUpsMap:i,inContextDrawMatchUps:e}),mp({drawDefinition:t,structure:a,positionAssignments:s,targetMatchUp:d,drawPosition:n,matchUpsMap:i,inContextDrawMatchUps:e}))})),{tasks:f,drawPositionCleared:c}}function mp({inContextDrawMatchUps:e,positionAssignments:t,drawDefinition:n,targetMatchUp:i,drawPosition:r,matchUpsMap:o,structure:a}){const s=(o=o||id({drawDefinition:n})).mappedMatchUps[a.structureId].matchUps,{initialRoundNumber:c}=Ll({drawPosition:r,matchUps:s});i.roundNumber>c&&(i.drawPositions=(i.drawPositions||[]).map((e=>e===r?void 0:e)));const u=wl({matchUpId:i.matchUpId,structure:a,drawDefinition:n,inContextDrawMatchUps:e}),{targetLinks:{winnerTargetLink:d},targetMatchUps:{loserMatchUp:l,winnerMatchUp:p,loserMatchUpDrawPositionIndex:m,winnerMatchUpDrawPositionIndex:f}}=u,h=t.filter((({drawPosition:e})=>i.drawPositions.includes(e))).filter((e=>e.bye)).length;if(i.matchUpStatus=h?qr:i.matchUpStatus===to?to:eo,i.matchUpStatus===to&&(i.winningSide=void 0),Wu({drawDefinition:n,matchUp:i}),l&&l.structureId!==u.matchUp.structureId&&!h){const{drawPositions:t,roundNumber:i}=l;if(1===i){const i=t[m];pp({drawDefinition:n,structureId:l.structureId,drawPosition:i,matchUpsMap:o,inContextDrawMatchUps:e})}else{var v;const r=Math.min(...t.filter(Boolean)),a=((null===(v=o)||void 0===v?void 0:v.mappedMatchUps)||{})[l.structureId].matchUps,{initialRoundNumber:s}=Ll({drawPosition:r,matchUps:a});s===i&&pp({drawDefinition:n,structureId:l.structureId,drawPosition:r,matchUpsMap:o,inContextDrawMatchUps:e})}}p&&p.structureId!==u.matchUp.structureId&&console.log("linked structure winnerMatchUp removal",{winnerTargetLink:d,winnerMatchUpDrawPositionIndex:f})}function fp({drawDefinition:e,drawPosition:t,participantId:n,structureId:i,matchUpsMap:r,inContextDrawMatchUps:o}){const{structure:a}=ad({drawDefinition:e,structureId:i}),{positionAssignments:s}=Kd({drawDefinition:e,structure:a}),c=s.find((e=>n&&e.participantId===n||t&&e.drawPosition===t));if(n&&!t&&(t=null==c?void 0:c.drawPosition),!t)return{error:"Missing drawPosition"};n||(n=null==c?void 0:c.participantId);const{activeDrawPositions:u}=dp({drawDefinition:e,structureId:i});if(u.includes(t))return{error:"drawPosition is active"};o||({matchUps:o}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:r}));const{drawPositionCleared:d,error:l}=pp({drawDefinition:e,structureId:i,drawPosition:t,matchUpsMap:r,inContextDrawMatchUps:o});return l?{error:l}:d?(zu({drawDefinition:e,structureIds:[i]}),h(f({},ko),{participantId:n})):{error:"drawPosition not cleared"}}function hp({element:e,notes:t}={}){return"object"!=typeof e?{error:_o}:t?"string"==typeof t||null!=t&&t.testing?(Object.assign(e,{notes:t}),ko):{error:_o}:{error:$o}}function vp({tournamentRecord:e,drawDefinition:t,policyTypes:n=[],event:i}){if(!Array.isArray(n))return{error:"Missing policyType"};const r={},o=e=>{for(const t of n){const n=e[t];n&&!r[t]&&(r[t]=n)}};if(t){const{appliedPolicies:e}=td({drawDefinition:t})||{};o(e)}if(i){const{appliedPolicies:e}=Ms({event:i})||{};o(e)}if(e){const{appliedPolicies:t}=Ns({tournamentRecord:e})||{};o(t)}return Object.keys(r).length?{policyDefinitions:r}:{error:"Policy not found"}}const gp=e=>null==e?void 0:e.participantId;function Ip({positionAssignments:e,tournamentRecord:t,drawDefinition:n,matchUpFormat:i,matchUps:r,event:o}){if(!Array.isArray(r))return{error:_o};if(!e)return{error:_o};const{policyDefinitions:a}=vp({tournamentRecord:t,drawDefinition:n,event:o,policyTypes:["roundRobinTally"]}),{subOrderMap:s}=function({positionAssignments:e}){const t=(e||[]).filter(gp).map((e=>{const{extension:t}=Cs({element:e,name:"subOrder"}),n=parseInt(null==t?void 0:t.value),i=!isNaN(n)&&n;return i&&{participantId:e.participantId,subOrder:i}})).filter(Boolean),n=Po(t.map((({subOrder:e})=>e)));return{subOrderMap:Object.assign({},...t.filter((({subOrder:e})=>1===n[e])).map((({participantId:e,subOrder:t})=>({[e]:t}))))}}({positionAssignments:e}),c=us({policyDefinitions:a,matchUpFormat:i,subOrderMap:s,matchUps:r});if(c.error)return c;const{participantResults:u}=c,d=Object.keys(u);return e.forEach((e=>{const{participantId:t}=e;d.includes(t)?(ud({element:e,extension:{name:"tally",value:u[t]}}),u[t].ties||dd({element:e,name:"subOrder"})):(dd({element:e,name:"tally"}),dd({element:e,name:"subOrder"}))})),zu({drawDefinition:n}),h(f({},ko),{participantResults:u})}function yp({event:e,eventId:t}){if(!e)return{error:Vo};const{extension:n}=Os({event:e,name:"flightProfile"}),i=t?Ja(null==n?void 0:n.value,!1,!0):null==n?void 0:n.value;var r;return t&&(null===(r=e.drawDefinitions)||void 0===r||r.forEach((e=>{var t;null==i||null===(t=i.flights)||void 0===t||t.forEach((t=>{t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})}))}))),{flightProfile:i}}const wp={matchUpStatus:eo,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Up({matchUpStatusCodes:e,removeWinningSide:t,tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpStatus:o,removeScore:a,winningSide:s,matchUpId:c,matchUp:u,event:d,notes:l,score:p}){var m;let f;const h=u.matchUpType===Bs;if(h?c&&u.matchUpId!==c&&({matchUp:u,structure:f}=el({drawDefinition:i,matchUpId:c,event:d})):u.matchUpId!==c&&console.log("!!!!!"),a?Object.assign(u,wp):p&&(u.score=p),o&&(u.matchUpStatus=o),r&&(u.matchUpFormat=r),e&&(u.matchUpStatusCodes=e),s&&(u.winningSide=s),t&&(u.winningSide=void 0),f||({structure:f}=el({drawDefinition:i,matchUpId:c,event:d})),(null===(m=f)||void 0===m?void 0:m.structureType)===au&&!u.collectionId){var v;r=h?"SET1-S:T100":r||u.matchUpFormat||(null===(v=f)||void 0===v?void 0:v.matchUpFormat)||i.matchUpFormat||(null==d?void 0:d.matchUpFormat);const e=f.structures.find((e=>null==e?void 0:e.matchUps.find((e=>e.matchUpId===c)))),t=h&&{matchUpTypes:[Bs]},{matchUps:o}=Xd({structure:e,inContext:!0,matchUpFilters:t,event:d}),a=Ip({positionAssignments:e.positionAssignments,tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUps:o,event:d});if(a.error)return a}if(s!==u.winningSide){var g;const{flightProfile:e}=yp({event:d}),t=null==e||null===(g=e.flights)||void 0===g?void 0:g.find((e=>e.drawId===i.drawId));null!=t&&t.matchUpValue&&console.log("recalculate team point tallies")}if(l){const e=hp({element:u,notes:l});if(e.error)return e}return Wu({drawDefinition:i,matchUp:u}),ko}function bp({drawDefinition:e,matchUpId:t,structure:n,event:i}){const r=el({drawDefinition:e,event:i,matchUpId:t});if(r.error)return r;const o=r.matchUp,a=o.tieFormat||(null==n?void 0:n.tieFormat)||(null==e?void 0:e.tieFormat)||(null==i?void 0:i.tieFormat)||void 0,{winningSide:s,set:c,scoreStringSide1:u,scoreStringSide2:d}=cc({matchUp:o,tieFormat:a}),l=[1,2].includes(s),p=l?Hr:u?Jr:eo,m=o.winningSide&&!l;return Up({score:{scoreStringSide1:u,scoreStringSide2:d,sets:[c]},removeWinningSide:m,drawDefinition:e,matchUpStatus:p,winningSide:s,matchUpId:t,matchUp:o,event:i}),h(f({},ko),{removeWinningSide:m})}function Sp(e){const{dualWinningSideChange:t,inContextDrawMatchUps:n,drawDefinition:i,matchUpStatus:r,matchUpsMap:o,dualMatchUp:a,targetData:s,structure:c,event:u}=e,d=Boolean(e.matchUp.collectionId),l=Yd({drawDefinition:i,structure:c}),{drawPositions:p,winningSide:m}=s.matchUp||{};if(!l&&!p)return{error:"Missing drawPositions"};const{targetLinks:{loserTargetLink:v,winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:y}}=s,w=Up(h(f({},e),{matchUpStatus:r||eo,removeWinningSide:!0}));if(w.error)return w;if(d){const{matchUpTieId:n}=e,{removeWinningSide:r}=bp({matchUpId:n,drawDefinition:i,structure:c,event:u});if(!t&&!r)return f({},ko)}if(l)return f({},ko);const{matchUps:U}=Xd({inContext:!0,drawDefinition:i,matchUpsMap:o,structure:c}),{positionAssignments:b}=Kd({structure:c}),S=m-1,P=1-S,D=p[S],N=p[P],{winnerParticipantId:M,loserParticipantId:T}=b.reduce(((e,t)=>(t.drawPosition===N&&(e.loserParticipantId=t.participantId),t.drawPosition===D&&(e.winnerParticipantId=t.participantId),e)),{winnerParticipantId:void 0,loserParticipantId:void 0}),E=U.filter((e=>e.drawPositions.includes(N)));if(y){const e=Pp({inContextDrawMatchUps:n,winningDrawPosition:D,winnerParticipantId:M,winnerTargetLink:g,drawDefinition:i,winnerMatchUp:y,dualMatchUp:a,matchUpsMap:o});if(e.error)return e}if(I){const{winnerHadMatchUpStatus:e}=function({sourceMatchUps:e,loserDrawPosition:t,drawPositionMatchUps:n,matchUpStatuses:i=[qr,to,Kr]}){var r;const o=null==n?void 0:n.reduce(((e,t)=>!e||t.roundNumber>e.roundNumber?t:e),void 0),a=null==o||null===(r=o.drawPositions)||void 0===r?void 0:r.find((e=>e!==t)),s=e.filter((e=>{var t;return null==e||null===(t=e.drawPositions)||void 0===t?void 0:t.includes(a)})).map((e=>e.matchUpStatus)),c=e.filter((e=>{var n;return null==e||null===(n=e.drawPositions)||void 0===n?void 0:n.includes(t)})).map((e=>e.matchUpStatus));return{sourceMatchUp:o,winnerHadMatchUpStatus:Co(s||[],i),winnerMatchUpStatuses:s,loserHadMatchUpStatus:Co(c||[],i),loserMatchUpStatuses:c}}({drawPositionMatchUps:E,loserDrawPosition:N,sourceMatchUps:U}),t="FIRST_MATCHUP"===v.linkCondition;if(e&&t){const e=Dp({targetLink:v,inContextDrawMatchUps:n,drawDefinition:i,drawPosition:Math.min(...I.drawPositions),matchUpsMap:o});if(e.error)return e}const r=function({inContextDrawMatchUps:e,loserParticipantId:t,loserTargetLink:n,drawDefinition:i,loserMatchUp:r,dualMatchUp:o}){const a=n.target.structureId,{structure:s}=ad({drawDefinition:i,structureId:a}),{positionAssignments:c}=Kd({structure:s});if(c.forEach((e=>{e.participantId===t&&delete e.participantId})),o){var u,d;const t=o.drawPositions,n=null==r||null===(u=r.sides)||void 0===u?void 0:u.find((e=>t.includes(e.drawPosition))),a=e.find((({matchUpId:e})=>e===r.matchUpId)),s=n&&(null==a||null===(d=a.sides)||void 0===d?void 0:d.find((e=>e.sideNumber===n)));s&&(delete s.lineUp,Wu({drawDefinition:i,matchUp:a}))}return f({},ko)}({inContextDrawMatchUps:n,loserParticipantId:T,loserTargetLink:v,drawDefinition:i,loserMatchUp:I,dualMatchUp:a,matchUpsMap:o});if(r)return r}return f({},ko)}function Pp({inContextDrawMatchUps:e,winningDrawPosition:t,winnerParticipantId:n,winnerTargetLink:i,drawDefinition:r,winnerMatchUp:o,matchUpsMap:a,dualMatchUp:s,event:c}){const{structureId:u,roundNumber:d}=o;if(i){const e=i.target.structureId,{structure:t}=ad({drawDefinition:r,structureId:e}),{positionAssignments:o}=Kd({structure:t}),a=o.find((e=>e.participantId===n)),s=null==a?void 0:a.drawPosition,{matchUps:u}=Xd({drawDefinition:r,structure:t,event:c});1===Po(u.map((e=>e.drawPositions)).flat(1/0).filter(Boolean))[s]?o.forEach((e=>{e.participantId===n&&delete e.participantId})):console.log("not removing from position assignments since instances > 1")}const l=function({inContextDrawMatchUps:e,targetDrawPosition:t,drawDefinition:n,structureId:i,dualMatchUp:r,roundNumber:o,matchUpsMap:a}){var s;const{structure:c}=ad({drawDefinition:n,structureId:i});if(c.structureType===au)return;const u=((null===(s=a=a||id({drawDefinition:n}))||void 0===s?void 0:s.mappedMatchUps)||{})[i].matchUps,{initialRoundNumber:d}=Ll({drawPosition:t,matchUps:u}),l=null==u?void 0:u.filter((e=>{var n;return e.roundNumber>=o&&e.roundNumber!==d&&(null===(n=e.drawPositions)||void 0===n?void 0:n.includes(t))})),{positionAssignments:p}=Hd({drawDefinition:n,structureId:i});for(const m of l){const i=jl({inContextDrawMatchUps:e,positionAssignments:p,targetDrawPosition:t,drawDefinition:n,dualMatchUp:r,matchUpsMap:a,matchUp:m});if(i.error)return i}return f({},ko)}({targetDrawPosition:t,inContextDrawMatchUps:e,drawDefinition:r,dualMatchUp:s,matchUpsMap:a,roundNumber:d,structureId:u});return l.error?l:f({},ko)}function Dp({inContextDrawMatchUps:e,drawDefinition:t,drawPosition:n,matchUpsMap:i,targetLink:r}){return fp({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:i,drawPosition:n,structureId:r.target.structureId}),f({},ko)}function Np(e){var t;let{sourceMatchUp:n}=e;const{winnerMatchUp:i,structure:r,matchUpsMap:o,drawPosition:a}=e,s=i.roundNumber>1&&i.roundNumber-1,c=rd({structureId:r.structureId,matchUpsMap:o});!n&&a&&(n=c.find((({drawPositions:e,roundNumber:t})=>t===s&&(null==e?void 0:e.includes(a)))));const u=null===(t=n)||void 0===t?void 0:t.roundPosition,d=u+(u%2?1:-1),l=s&&c.find((({roundNumber:e,roundPosition:t})=>e===s&&t===d)),p=null==l?void 0:l.matchUpStatus;return{pairedPreviousMatchUp:l,pairedPreviousMatchUpisWOWO:[Yr].includes(p)}}function Mp({drawDefinition:e,drawPosition:t,matchUpsMap:n,structureId:i,structure:r}){var o;if(!e)return{error:jo};if(r||({structure:r}=ad({drawDefinition:e,structureId:i})),!r)return{error:"structure not found"};i||({structureId:i}=r),n||(n=id({drawDefinition:e}));const{positionAssignments:a}=Hd({structure:r}),{activeDrawPositions:s}=dp({drawDefinition:e,structureId:i});if(a.find((e=>e.drawPosition===t)).bye)return f({},ko);if(s.includes(t))return{error:"drawPosition is active"};const c=a.find((e=>e.drawPosition===t));if(!c)return{error:"Invlid drawPosition"};const{filled:u,containsBye:d}=function(e){const t=e.bye,n=e.qualifier,i=e.participantId;return{containsBye:t,containsQualifier:n,containsParticipant:i,filled:t||n||i}}(c);if(d)return f({},ko);if(u&&!d)return{error:"drawPosition already assigned"};const{matchUps:l}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:n}),{matchUps:p}=Xd({drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:r});if(a.forEach((e=>{e.drawPosition===t&&(e.bye=!0)})),r.structureType===au)return function({drawDefinition:e,matchUps:t,drawPosition:n}){t.forEach((t=>{t.drawPositions.includes(n)&&Tp({drawDefinition:e,matchUp:t})}))}({drawDefinition:e,matchUps:p,drawPosition:t}),f({},ko);const{roundProfile:m,roundMatchUps:h}=nd({matchUps:p}),v=h[Object.keys(m).map((e=>parseInt(e))).reverse().find((e=>m[e].drawPositions.includes(t)))].find((({drawPositions:e})=>e.includes(t)));Tp({drawDefinition:e,matchUp:v});const g=null===(o=v.drawPositions)||void 0===o?void 0:o.find((e=>e!==t));if(g){const t=Ep({sourceDrawPositions:v.drawPositions,matchUpId:v.matchUpId,inContextDrawMatchUps:l,drawPositionToAdvance:g,drawDefinition:e,matchUpsMap:n});if(t.error)return t}return zu({drawDefinition:e,structureIds:[i]}),f({},ko)}function Tp({drawDefinition:e,matchUp:t}){Object.assign(t,{matchUpStatus:qr,score:void 0,winningSide:void 0}),Wu({drawDefinition:e,matchUp:t})}function Ep({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:n,drawDefinition:i,matchUpsMap:r,matchUpId:o}){const a=r.drawMatchUps.find((e=>e.matchUpId===o)),s=t.find((e=>e.matchUpId===o)),c=null==s?void 0:s.structureId,{structure:u}=ad({drawDefinition:i,structureId:c}),{positionAssignments:d}=Hd({structure:u}),l=d.filter((e=>e.bye)).map((e=>e.drawPosition)),p=a.drawPositions.find((t=>t!==e)),m=l.includes(p),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:v,winnerMatchUp:g,loserTargetDrawPosition:I}}=wl({inContextDrawMatchUps:t,drawDefinition:i,matchUpId:o,structure:u});if(g&&g.structureId===u.structureId&&function({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:n,drawDefinition:i,winnerMatchUp:r,matchUpsMap:o}){var a,s,c;const u=o.drawMatchUps.find((e=>e.matchUpId===r.matchUpId)),d=t.find((e=>e.matchUpId===r.matchUpId)),l=null==d?void 0:d.structureId,{structure:p}=ad({drawDefinition:i,structureId:l}),{positionAssignments:m}=Hd({structure:p}),f=m.find((({drawPosition:t})=>t===e)).bye,h=null===(a=u.drawPositions)||void 0===a?void 0:a.filter(Boolean),v=m.filter((e=>null==h?void 0:h.includes(e.drawPosition))),g=m.find((({drawPosition:t})=>t===e)),I=null==n?void 0:n.find((t=>t!==e)),y=I&&v.find((({drawPosition:e})=>e===I)),w=null==y?void 0:y.bye,U=f&&w;if(U&&console.log({isByeAdvancedBye:U}),(null==h?void 0:h.length)>1&&f&&!w)return{error:Bo};const b=null==h?void 0:h.find((t=>t!==e));let S=U;const P=[].concat(...(u.drawPositions||[]).filter(Boolean),void 0,void 0).slice(0,2).map((t=>t||S?t===e?(S=!0,e):t:(S=!0,e)));if(!S)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:e,existingAssignments:v}),{error:Bo};const D=null===(s=m.find((({drawPosition:e})=>e===b)))||void 0===s?void 0:s.bye,N=null===(c=m.find((({drawPosition:t})=>t===e)))||void 0===c?void 0:c.bye,M=N||D?qr:eo;if(Object.assign(u,{matchUpStatus:M,score:void 0,winningSide:void 0,drawPositions:P}),Wu({drawDefinition:i,matchUp:u}),D||N){const n=D?e:b;if(n)Ep({drawPositionToAdvance:n,matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:i,iterative:"brightmagenta",matchUpsMap:o});else if(N){const{targetLinks:{loserTargetLink:e},targetMatchUps:{loserMatchUp:n,loserTargetDrawPosition:a}}=wl({matchUpId:r.matchUpId,structure:p,drawDefinition:i,inContextDrawMatchUps:t});if(e&&n)if(n.feedRound)Ap({drawDefinition:i,loserMatchUp:n,loserTargetLink:e,loserTargetDrawPosition:a,matchUpsMap:o});else{const t=1-r.roundPosition%2,o=n.drawPositions[t];Mp({drawDefinition:i,structureId:e.target.structureId,drawPosition:o,loserTargetDrawPosition:a,iterative:"brightgreen"}).error}}}}({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:n,drawDefinition:i,winnerMatchUp:g,matchUpsMap:r}),v&&m&&v.structureId!==u.structureId){const{roundNumber:e}=v;if(1===e){const e=Mp({drawDefinition:i,structureId:h.target.structureId,drawPosition:I,iterative:"brightyellow"});if(e.error)return e}else Ap({loserTargetDrawPosition:I,loserTargetLink:h,drawDefinition:i,loserMatchUp:v,matchUpsMap:r})}return f({},ko)}function Ap({drawDefinition:e,loserMatchUp:t,loserTargetLink:n,loserTargetDrawPosition:i,matchUpsMap:r}){const{roundNumber:o}=t,a=((null==r?void 0:r.mappedMatchUps)||{})[t.structureId].matchUps,{initialRoundNumber:s}=Ll({drawPosition:i,matchUps:a});if(s===o){const t=Mp({drawDefinition:e,structureId:n.target.structureId,drawPosition:i,iterative:"red"});if(t.error)return t}}function Rp({inContextDrawMatchUps:e,matchUpId:t,drawPosition:n}){const i=e.filter((({winnerMatchUpId:e,loserMatchUpId:n})=>n===t||e===t)).sort(((e,t)=>e.roundPosition-t.roundPosition));return i.find((({feedRound:e})=>e))?1:i.reduce(((e,t,i)=>t.drawPositions.includes(n)?i+1:e),void 0)}function Cp({inContextDrawMatchUps:e,drawDefinition:t,matchUpStatus:n,drawPosition:i,matchUpsMap:r,matchUpId:o}){var a,s,c;r||(r=id({drawDefinition:t})),e||({matchUps:e}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const u=e.find((e=>e.matchUpId===o)),d=null==u?void 0:u.structureId,l=null==t||null===(a=t.structures)||void 0===a?void 0:a.find((e=>e.structureId===d)),p=null===(s=r)||void 0===s||null===(c=s.drawMatchUps)||void 0===c?void 0:c.find((e=>e.matchUpId===o)),m=p.drawPositions||[],{positionAdded:f,positionAssigned:h,updatedDrawPositions:v}=function({drawPosition:e,drawPositions:t}){let n,i=null==t?void 0:t.includes(e);return{updatedDrawPositions:i?t:[].concat(...t,void 0,void 0).slice(0,2).map((t=>t||i?t:(i=!0,n=!0,e))).sort(Xa),positionAdded:n,positionAssigned:i}}({drawPosition:i,drawPositions:m}),{positionAssignments:g}=Hd({drawDefinition:t,structure:l}),I=g.filter((e=>v.includes(e.drawPosition))).find((({bye:e})=>e)),y=p.matchUpStatus===to&&v.filter(Boolean).length<2;if(n=I?qr:n||(y?to:p.matchUpStatus===Yr?Yr:eo),f){({matchUps:e}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const a=y&&Rp({inContextDrawMatchUps:e,drawPosition:i,matchUpId:o})||void 0;Object.assign(p,{drawPositions:v,winningSide:a,matchUpStatus:n}),Wu({drawDefinition:t,matchUp:p})}const w=wl({inContextDrawMatchUps:e,inContextMatchUp:u,drawDefinition:t,matchUpId:o}),{targetMatchUps:{winnerMatchUp:U,loserMatchUp:b,loserTargetDrawPosition:S},targetLinks:{loserTargetLink:P}}=w,D=rd({structureId:l.structureId,matchUpsMap:r});if(h&&I){if(U)if([qr,Yr].includes(n)){const n=Cp({matchUpId:U.matchUpId,iterative:"brightmagenta",inContextDrawMatchUps:e,drawDefinition:t,drawPosition:i,matchUpsMap:r});if(n.error)return n}else{const{structureId:e}=U;e!==l.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(U&&!u.feedRound){const{pairedPreviousMatchUpisWOWO:n}=Np({winnerMatchUp:p,drawPosition:i,matchUpsMap:r,structure:l});if(n){const n=Cp({matchUpId:U.matchUpId,iterative:"brightred",inContextDrawMatchUps:e,drawDefinition:t,drawPosition:i,matchUpsMap:r});if(n.error)return n}}if("FIRST_MATCHUP"===(null==P?void 0:P.linkCondition)&&2===v.filter(Boolean).length&&!I){if(D.filter((({drawPositions:e,roundNumber:t})=>1===t&&Co(e,v))).every((({matchUpStatus:e})=>[Hr,Qr].includes(e)))&&b){const{structureId:e}=b,n=Mp({drawDefinition:t,structureId:e,drawPosition:S,matchUpsMap:r});if(n.error)return n}}return h?ko:{error:Bo,drawPosition:i}}function xp(e){const{drawDefinition:t,matchUpsMap:n,targetData:i,structure:r}=e;if(r.structureType===au)return ko;const{matchUp:o,targetMatchUps:a,targetLinks:s}=i,{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}=a;if(c){const{loserTargetLink:e}=s,i=Op({loserTargetDrawPosition:d,loserTargetLink:e,drawDefinition:t,loserMatchUp:c,matchUpsMap:n});if(i.error)return i}if(u){const t=function(e){var t,n,i;const{inContextDrawMatchUps:r,drawDefinition:o,sourceMatchUp:a,winnerMatchUp:s,matchUpsMap:c,structure:u}=e,d=c.drawMatchUps.find((e=>e.matchUpId===s.matchUpId));if(!d)return{error:"Missing matchUp"};const l=(null==a?void 0:a.drawPositions)||[];let p=null===(t=d.drawPositions)||void 0===t?void 0:t.filter(Boolean);if(Co(l,p)&&(p=p.filter((e=>!l.includes(e)))),p.length>1)return{error:Bo};const{pairedPreviousMatchUpisWOWO:m}=Np(e),v=wl({matchUpId:s.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,structure:u}),{targetMatchUps:g,targetLinks:I}=v,{loserTargetDrawPosition:y,winnerMatchUp:w,loserMatchUp:U}=g;if(U){const{loserTargetLink:e}=I,t=Op({loserTargetDrawPosition:y,loserMatchUp:U,loserTargetLink:e,drawDefinition:o,matchUpsMap:c});if(t.error)return t}const b=(null===(n=d.drawPositions)||void 0===n?void 0:n.filter(Boolean))||[],S=1===b.length&&Rp({drawPosition:b[0],matchUpId:s.matchUpId,inContextDrawMatchUps:r})||void 0,P=d.matchUpStatus===to&&!b.length,D=1===d.finishingRound,N=P&&!D?Yr:to,M=Up(h(f({},e),{matchUp:d,winningSide:S,matchUpStatus:N}));if(M.error)return M;if(P)return xp(h(f({},e),{targetData:v}));if(!w)return f({},ko);const T=p[0],{positionAssignments:E}=Hd({structure:u}),A=E.find((e=>e.drawPosition===T)),R=c.drawMatchUps.find((e=>e.matchUpId===w.matchUpId)),C=null==R||null===(i=R.drawPositions)||void 0===i?void 0:i.filter(Boolean),x=1===C.length;if(T){if(A.bye){const t=wl({matchUpId:R.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,structure:u});if(x){const e=Up({matchUpId:R.matchUpId,matchUp:R,matchUpStatus:to,removeScore:!0,drawDefinition:o,winningSide:1});return e.error?e:Ep({drawPositionToAdvance:C.filter(Boolean)[0],inContextDrawMatchUps:r,drawDefinition:o,matchUpsMap:c,matchUpId:R.matchUpId})}if(w.matchUpStatus===to){const n=xp(h(f({},e),{targetData:t,matchUpId:R.matchUpId}));if(n.error)return n}return f({},ko)}return Cp({matchUpId:w.matchUpId,drawPosition:T,inContextDrawMatchUps:r,drawDefinition:o})}if(m){if(!R)return{error:"Missing matchUp"};if(x){const e=C[0],t=Rp({matchUpId:s.matchUpId,inContextDrawMatchUps:r,drawPosition:e});console.log("existing drawPosition is winningSide",{walkoverWinningSide:t})}const t=R.matchUpStatus===to?to:Yr,n=Up({matchUpId:R.matchUpId,matchUp:R,removeScore:!0,drawDefinition:o,matchUpStatus:t});if(n.error)return n;if(t===Yr){const t=xp(h(f({},e),{targetData:v,matchUpId:s.matchUpId}));if(t.error)return t}}return ko}(h(f({},e),{matchUpId:u.matchUpId,sourceMatchUp:o,winnerMatchUp:u}));if(t.error)return t}return ko}function Op(e){var t;const{loserTargetDrawPosition:n,loserTargetLink:i,drawDefinition:r,matchUpsMap:o}=e,a=null==i||null===(t=i.target)||void 0===t?void 0:t.structureId,{structure:s}=ad({drawDefinition:r,structureId:a});return s?Mp({drawPosition:n,drawDefinition:r,structureId:a,matchUpsMap:o}):{error:"Missing structure"}}function kp(e){var t;const n=e.isCollectionMatchUp&&(null===(t=e.dualMatchUp)||void 0===t?void 0:t.winningSide)&&e.projectedWinningSide,i=Boolean(e.matchUp.collectionId),r=Up(e);if(i){const{matchUpTieId:t,drawDefinition:i}=e,{removeWinningSide:r}=bp({matchUpId:t,drawDefinition:i});console.log("atsms",{removeWinningSide:r,removeDirected:n})}return r}function Fp({tournamentRecord:e,drawDefinition:t,event:n}){const i=(null==e?void 0:e.events)||n&&[n],r=(null==i?void 0:i.map((e=>null==e?void 0:e.drawDefinitions)).flat().filter(Boolean))||t&&[t]||[],o={},a={},s=r.map((({structures:e})=>null==e?void 0:e.filter((e=>null==e?void 0:e.structures)))).flat().filter(Boolean);for(const c of s){const{structures:e,structureId:t}=c||{};e&&(o[t]=null==e?void 0:e.map((e=>e.structureId)))&&e.forEach((e=>a[e.structureId]=c.structureId))}return{containedStructures:o,containerStructures:a}}function Lp({drawDefinition:e,structureId:t}){if(!e)return{error:jo};const{structure:n}=ad({drawDefinition:e,structureId:t}),i=((null==e?void 0:e.links)||[]).filter((e=>{var n;return(null===(n=e.source)||void 0===n?void 0:n.structureId)===t})).map((e=>{var t;return null===(t=e.target)||void 0===t?void 0:t.structureId}));return{playoffStructures:((null==e?void 0:e.structures)||[]).filter((e=>i.includes(e.structureId)&&e.stage===iu)),structure:n}}function jp(e){if(null==e||!e.drawDefinition)return{error:jo};const t=Pl(e),{completedMatchUps:n,pendingMatchUps:i,upcomingMatchUps:r}=t||{};return!(!(null==n?void 0:n.length)||null!=i&&i.length||r.length)}function Bp(e){var t,n;const{drawDefinition:i,structureId:r}=e;if(!i)return{error:jo};const{playoffStructures:o}=Lp({drawDefinition:i,structureId:r});if(null==o||!o.length)return!1;const a=(null==i||null===(t=i.entries)||void 0===t||null===(n=t.filter((e=>Cd.includes(null==e?void 0:e.entryStatus))))||void 0===n?void 0:n.length)||0;let s=0;return(o||[]).reduce(((e,t)=>{var n;return!(null!=t&&null!==(n=t.positionAssignments)&&void 0!==n&&n.filter((e=>(e.participantId&&s++,!(null!=e&&e.bye||null!=e&&e.participantId)))).length)&&e}),!0)||s===a}function Vp({drawDefinition:e,structure:t,matchUp:n}){const i=[];if("WIN_RATIO"===t.finishingPosition&&jp({drawDefinition:e,structure:t})){const{structureIds:r}=function({drawDefinition:e,structure:t,matchUp:n}){const{drawPositions:i}=n,{positionAssignments:r}=Hd({drawDefinition:e,structure:t}),o=r.filter((({drawPosition:e})=>i.includes(e))).map((e=>{var t;const{extension:n}=Cs({element:e,name:"tally"});return null==n||null===(t=n.value)||void 0===t?void 0:t.groupOrder})),{containerStructures:a}=Fp({drawDefinition:e}),s=a[t.structureId],{links:{source:c}}=yl({drawDefinition:e,structureId:s});return{structureIds:null==c?void 0:c.filter((e=>{var t;return Co(o,(null===(t=e.source)||void 0===t?void 0:t.finishingPositions)||[])})).map((e=>e.source.structureId))}}({drawDefinition:e,structure:t,matchUp:n});null!=r&&r.length&&i.push(...r)}return{connectedStructureIds:i}}function $p({drawPositions:e,structure:t}){if([tu,eu].includes(t.stage)&&1===t.stageSequence)return;const{positionAssignments:n}=Hd({structure:t});n.filter((({drawPosition:t})=>e.includes(t))).forEach((e=>{ud({element:e,extension:{name:"disableLinks",value:!0}})}))}function Gp({drawDefinition:e,positionAction:t}){const{extension:n}=Cs({element:e,name:"positionActions"});ud({element:e,extension:{name:"positionActions",value:Array.isArray(null==n?void 0:n.value)?n.value.concat(t):[t]}})}function _p({participantsCount:e,cluster:t}){const n=vo(e),i=Eo(1,n+1);let r=[],o=n/2;for(;o>1;){const e=xo(i,o),n=e.length;e.forEach(((e,i)=>{let o;const a=i<n/2,s=i%2==0,c=e[0],u=e[e.length-1];o=t&&n>4?8===n?a?u:c:s?c:u:a?c:u,Co(e,r)||r.push(o)})),o/=2}const a=i.filter((e=>!r.includes(e)));for(;a.length;)a.length%2==0?r.push(a.pop()):r.push(a.shift());const s=Eo(0,20).map((e=>Math.pow(2,e)));s.unshift(1);const c=s.indexOf(n);let u=0;const d=[];return Eo(0,c).forEach((e=>{d.push(r.slice(u,u+s[e])),u+=s[e]})),{seedBlocks:d}}function Wp({appliedPolicies:e,drawDefinition:t,allPositions:n,structure:i}){var r;let o,a,s,c,u,d=0,l=[];if(!i)return{error:"Missing structure"};const{roundMatchUps:p}=Xd({roundFilter:1,structure:i}),{seedAssignments:m}=Wd({drawDefinition:t,structure:i}),{positionAssignments:f}=Kd({structure:i}),h=f.length,v=(null==m?void 0:m.length)||0;let g=[];const I=Object.keys(p).sort(((e,t)=>e-t)).map((e=>{const t=p[e].map((e=>e.drawPositions)).flat(1/0).filter(Boolean),n=t.filter((e=>!g.includes(e)));return g=g.concat(...t),n})).filter((e=>e.length)).reverse(),y=I.pop(),w=y&&Math.min(...y)-1||0,U=null==e||null===(r=e.seeding)||void 0===r?void 0:r.seedingProfile,b=(null==y?void 0:y.length)||0,S=I.filter((e=>e.filter((e=>e<=v)).length)),P=n?h:v;if(i.structureType===au){if(a=!0,({validSeedBlocks:l,error:u}=function({seedingProfile:e,structure:t,seedBlocks:n}){const i=t.structures||[],r=[];for(const l of i){const{positionAssignments:t}=Kd({structure:l}),i=Math.min(...t.map((e=>e.drawPosition)))-1,o=t.length;let a,s;if(mo(o)?({blocks:a,error:s}=qp({seedBlocks:n,baseDrawSize:o,seedingProfile:e,drawPositionOffset:i,seedCountGoal:o})):({blocks:a,error:s}=zp({baseDrawSize:o,drawPositionOffset:i,seedCountGoal:o})),s)return{error:s};r.push(a)}const o=r.map((e=>e.map((e=>e.seedNumbers.map(((t,n)=>({seedNumber:t,drawPosition:e.drawPositions[n]}))))))).flat(1/0).sort(((e,t)=>e.seedNumber-t.seedNumber)).reduce(((e,t)=>{const n=t.seedNumber;return e[n]||(e[n]=[]),e[n].push(t.drawPosition),e}),{});let a=1,s=[];o[1]&&o[1].forEach(((e,t)=>{s.push({seedNumbers:[t+1],drawPositions:[e]}),a++})),[[2],[3,4],[5,6,7,8],Eo(9,17)].forEach((e=>{const t=[].concat(...e.map((e=>o[e]||[]))),n=t.map(((e,t)=>a+t)),i={seedNumbers:n,drawPositions:t};s.push(i),a+=n.length}));const c=(e,t)=>e-t,u=(e,t)=>t-e,d=Object.keys(o).map(((e,t)=>o[e].sort(t%2?u:c))).flat().map(((e,t)=>({seedNumbers:[t+1],drawPositions:[e]})));return"WATERFALL"===t.seedingProfile&&(s=d),{validSeedBlocks:s}}({seedingProfile:U,structure:i})),u)return{error:u}}else if(I.length){s=!0,l=S.map((e=>({seedNumbers:e,drawPositions:e})));const e=S.flat(1/0);o=e.length<P?P-e.length:0,d=e.length}else y&&!mo(b)?(o=0,c=!0):o=P;if(!a&&!c){const{blocks:e,error:t}=qp({drawPositionOffset:w,seedNumberOffset:d,seedCountGoal:o,seedingProfile:U,baseDrawSize:b});if(t)return{validSeedBlocks:[],isContainer:a,isFeedIn:s,error:t};e.forEach((e=>l.push(e)))}c&&xo(y,2).map(((e,t)=>({drawPositions:[e[0]],seedNumbers:[t+1]}))).forEach((e=>l.push(e)));const D=[].concat(...l.map((e=>e.drawPositions))).reduce(((e,t)=>(null==y?void 0:y.includes(t))&&e),!0);return c||s||a||D?{validSeedBlocks:l,isContainer:a,isFeedIn:s,isLucky:c}:{error:"Invalid seedPosition",validSeedBlocks:[],isContainer:a,isFeedIn:s}}function qp({drawPositionOffset:e=0,seedNumberOffset:t=0,seedingProfile:n,seedCountGoal:i,baseDrawSize:r}){let o=1;const a=[],{seedBlocks:s}=_p({participantsCount:r,cluster:"CLUSTER"===n});o=0;for(const u of s){if(o+1>i)break;const n=u.map((t=>t+e)),r=c(o+1,u.length).map((e=>+e+t));o+=u.length,a.push({drawPositions:n,seedNumbers:r})}return{blocks:a};function c(e,t){return Array.from(new Array(t),((t,n)=>n+e))}}function zp({baseDrawSize:e,seedCountGoal:t,drawPositionOffset:n=0}){let i=1;const r=[],o=Eo(n+1,n+e+1);return[[1],[2],[3,4],[5,6,7,8],Eo(9,17),Eo(17,33),Eo(33,65)].forEach((e=>{const n=e.map((()=>o.reverse().pop())).filter(Boolean),a={seedNumbers:e=e.slice(0,n.length),drawPositions:n};i<=t&&r.push(a),i+=n.length})),{blocks:r}}function Hp({seedNumber:e,drawDefinition:t,structureId:n,drawPosition:i}){var r,o,a,s;const{structure:c}=ad({drawDefinition:t,structureId:n}),{appliedPolicies:u}=td({drawDefinition:t}),{validSeedBlocks:d}=Wp({structure:c,drawDefinition:t,appliedPolicies:u});if(null!=u&&null!==(r=u.seeding)&&void 0!==r&&null!==(o=r.validSeedPositions)&&void 0!==o&&o.ignore)return!0;if(null!=u&&null!==(a=u.seeding)&&void 0!==a&&null!==(s=a.validSeedPositions)&&void 0!==s&&s.strict){const t=d.find((t=>t.seedNumbers.includes(e)));return((null==t?void 0:t.drawPositions)||[]).includes(i)}return[].concat(...d.map((e=>e.drawPositions))).includes(i)}function Kp({drawDefinition:e,structureId:t,randomize:n}){var i;const{structure:r}=ad({drawDefinition:e,structureId:t}),{seedAssignments:o}=Wd({drawDefinition:e,structure:r}),{positionAssignments:a}=Kd({structure:r}),s=a.filter((e=>e.participantId||e.bye||e.qualifier)).map((e=>e.drawPosition)).filter(Boolean),{appliedPolicies:c}=td({drawDefinition:e}),{validSeedBlocks:u}=Wp({structure:r,drawDefinition:e,appliedPolicies:c}),d=(u||[]).filter((e=>e.drawPositions.filter((e=>!s.includes(e))).length))[0],l=o.map((e=>e.participantId)).filter(Boolean),p=a.map((e=>e.participantId)).filter(Boolean),m=l.filter((e=>p.includes(e))),f=l.filter((e=>!p.includes(e))),h=o.filter((e=>f.includes(e.participantId))),v=o.filter((e=>!e.participantId)),g=(h.length||v.length)&&(null==d?void 0:d.drawPositions.filter((e=>!s.includes(e))))||[],I=n?So(g):g,y=[],w=I.map((()=>{const e=function(e,t){const n=e.filter((e=>!t.includes(e.participantId))),i=Math.min(...n.map((e=>e.seedValue)));return So(n.filter((e=>e.seedValue===i))).pop()}(h,y),t=e&&e.participantId;return t&&y.push(t),t})).filter(Boolean),U=o.filter((e=>m.includes(e.participantId))).map((e=>e.seedNumber)),b=(d&&d.seedNumbers||[]).filter((e=>!U.includes(e))),S=o.filter((e=>b.includes(e.seedNumber))).map((e=>e.participantId)),P=null==c||null===(i=c.seeding)||void 0===i?void 0:i.duplicateSeedNumbers;return{nextSeedBlock:d,unplacedSeedParticipantIds:void 0===P||P?w:S,unplacedSeedNumbers:b,unfilledPositions:I,unplacedSeedAssignments:h}}function Yp({inContextDrawMatchUps:e,automaticPlacement:t,drawDefinition:n,participantId:i,drawPosition:r,matchUpsMap:o,structureId:a,event:s}){o=o||id({drawDefinition:n}),e||({matchUps:e}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:o}));const{structure:c,error:u}=ad({drawDefinition:n,structureId:a});if(u)return{error:u};if(Yd({drawDefinition:n,structure:c}))return{error:"Invalid matchUp"};const{positionAssignments:d}=Kd({structure:c}),{seedAssignments:l}=Wd({drawDefinition:n,structure:c}),p=l.find((e=>e.participantId===i)),m=null==p?void 0:p.seedNumber;if(m&&!Hp({structureId:a,drawPosition:r,drawDefinition:n,seedNumber:m}))return{error:"Invalid drawPosition for seedAssignment"};const f=d.find((e=>e.drawPosition===r));if(!f)return{error:"Invlid drawPosition"};if(!i)return{error:"Missing participantId"};if(d.map(Qu).includes(i))return{error:"Existing participant drawPosition assignment"};const{containsParticipant:h,containsBye:v}=function(e){const t=e.bye,n=e.qualifier,i=e.participantId;return{containsBye:t,containsQualifier:n,containsParticipant:i,filled:t||n||i}}(f);if(h&&f.participantId!==i){const{activeDrawPositions:e}=dp({drawDefinition:n,structureId:a});if(e.includes(r))return{error:"drawPosition is active"}}if(v){let t=fp({drawDefinition:n,drawPosition:r,structureId:a,matchUpsMap:o,inContextDrawMatchUps:e});if(t.error)return t}return f.participantId=i,c.structureType!==au?function({inContextDrawMatchUps:e,automaticPlacement:t,drawDefinition:n,drawPosition:i,matchUpsMap:r,structure:o,event:a}){const{matchUps:s}=Xd({inContextDrawMatchUps:e,drawDefinition:n,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:o,event:a}),{roundMatchUps:c}=nd({matchUps:s}),{initialRoundNumber:u}=Ll({drawPosition:i,matchUps:s}),d=c[u].find((e=>e.drawPositions.includes(i)));if(d){Cp({drawDefinition:n,drawPosition:i,automaticPlacement:t,matchUpId:d.matchUpId,matchUpsMap:r,inContextDrawMatchUps:e}).error}}({inContextDrawMatchUps:e,positionAssignments:d,automaticPlacement:t,drawDefinition:n,matchUpsMap:o,drawPosition:r,structure:c,event:s}):lp({inContextDrawMatchUps:e,positionAssignments:d,drawDefinition:n,matchUpsMap:o,structure:c}),t||($p({structure:c,drawPositions:[r]}),Gp({drawDefinition:n,positionAction:{name:"positionAssignment",drawPosition:r,structureId:a,participantId:i}})),zu({drawDefinition:n,structureIds:[a]}),Object.assign({positionAssignments:d},ko)}function Jp(e){const{dualWinningSideChange:t,projectedWinningSide:n,inContextDrawMatchUps:i,matchUpStatusCodes:r,tournamentRecord:o,drawDefinition:a,matchUpFormat:s,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:l,targetData:p,matchUpId:m,structure:v,matchUp:g,event:I,score:y}=e,w=Boolean(g.collectionId),U=Yd({drawDefinition:a,structure:v});if(!(w||U||function({structure:e,matchUp:t}){const{drawPositions:n}=t,{positionAssignments:i}=Kd({structure:e});return 2===i.filter((e=>n.includes(e.drawPosition)&&e.participantId)).length}({structure:v,matchUp:g})))return{error:"Missing assignments"};const b=sp({matchUpStatus:c}),S=[to].includes(c),P=Up({matchUpStatusCodes:b&&r||[],matchUpStatus:b&&c||Hr,tournamentRecord:o,drawDefinition:a,matchUpFormat:s,removeScore:S,winningSide:l,matchUpId:m,matchUp:g,event:I,score:y});if(P.error)return P;let D=g.drawPositions;if(w){const{matchUpTieId:n}=e;bp({matchUpId:n,drawDefinition:a,structure:v,event:I});const r=i.find((({matchUpId:e})=>e===n));if(D=null==r?void 0:r.drawPositions,!t)return f({},ko)}if(U)return f({},ko);if(!D)return{error:"Missing drawPositions"};{const e=l-1,t=1-e,r=D[e],o=D[t],{targetLinks:{loserTargetLink:s,winnerTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:v,loserMatchUpDrawPositionIndex:g,winnerMatchUp:y,loserMatchUp:w}}=p;if(y){const e=function({winnerMatchUpDrawPositionIndex:e,inContextDrawMatchUps:t,projectedWinningSide:n,winningDrawPosition:i,winnerTargetLink:r,drawDefinition:o,winnerMatchUp:a,dualMatchUp:s,matchUpsMap:c,event:u}){if(r){const n=a.drawPositions||[],s=n[e],u=r.source.structureId,{positionAssignments:d}=Kd({structureId:u,drawDefinition:o}),l=d.find((e=>e.drawPosition===i)),p=null==l?void 0:l.participantId,m=r.target.structureId,{positionAssignments:f}=Kd({structureId:m,drawDefinition:o}),h=f.find((e=>e.participantId===p)),v=null==h?void 0:h.drawPosition,g=f.filter((e=>{const t=n.includes(e.drawPosition),i=!e.participantId&&!e.bye&&!e.qualifier;return t&&i})).map((e=>e.drawPosition)),I=g.includes(s);if(1===r.target.roundNumber&&I)Yp({drawPosition:s,participantId:p,structureId:m,inContextDrawMatchUps:t,drawDefinition:o,matchUpsMap:c});else if(g.length){const e=g.pop();Yp({participantId:p,structureId:m,inContextDrawMatchUps:t,drawDefinition:o,drawPosition:e,matchUpsMap:c})}else{if(!v){const e="winner target position unavaiallble";return console.log(e),{error:e}}{const e=Cp({drawPosition:v,matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:o,matchUpsMap:c});if(e.error)return e}}}else{const e=Cp({matchUpId:a.matchUpId,drawPosition:i,inContextDrawMatchUps:t,drawDefinition:o,matchUpsMap:c});if(e.error)return e}if(s&&n){var d;const e=null===(d=s.sides)||void 0===d?void 0:d.find((e=>e.sideNumber===n));if(null!=e&&e.lineUp){const t=s.roundPosition,n=a.roundPosition,i=t===n&&1!==t||Math.floor(t/2)===n?2:1,{matchUp:r}=el({matchUpId:a.matchUpId,drawDefinition:o,matchUpsMap:c,event:u}),d=[1,2].map((e=>{var t;const n=(null===(t=r.sides)||void 0===t?void 0:t.find((t=>t.sideNumber===e)))||{};return h(f({},n),{sideNumber:e})}));r.sides=d;const l=r.sides.find((e=>e.sideNumber===i));l&&(l.lineUp=e.lineUp,Wu({drawDefinition:o,matchUp:r}))}}return f({},ko)}({winnerMatchUpDrawPositionIndex:v,inContextDrawMatchUps:i,projectedWinningSide:n,winningDrawPosition:r,winnerTargetLink:m,drawDefinition:a,winnerMatchUp:y,dualMatchUp:u,matchUpsMap:d,event:I});if(e.error)return e}if(w){const e=function(e){const{loserMatchUpDrawPositionIndex:t,inContextDrawMatchUps:n,projectedWinningSide:i,loserDrawPosition:r,loserTargetLink:o,drawDefinition:a,loserMatchUp:s,dualMatchUp:c,matchUpsMap:u,event:d}=e,l=o.linkCondition,p=s.drawPositions||[],m="FIRST_MATCHUP"===l&&2===s.roundNumber&&Math.min(...p.filter(Boolean)),v=m||p[t],g=m||p[1-t],I=o.source.structureId,{structure:y}=ad({drawDefinition:a,structureId:I}),{matchUps:w}=Xd({inContext:!0,drawDefinition:a,structure:y,event:d}),U=w.filter((e=>{var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.includes(r)})).filter((e=>{var t;const n=e.sides.find((e=>e.drawPosition===r)),i=e.matchUpStatus===to||e.matchUpStatus===Kr&&!(null===(t=e.score)||void 0===t||!t.scoreStringSide1);return(null==n?void 0:n.sideNumber)===e.winningSide&&!i})),b="FIRST_MATCHUP"===l&&0===U.length,{positionAssignments:S}=Kd({drawDefinition:a,structureId:I}),P=S.find((e=>e.drawPosition===r)),D=null==P?void 0:P.participantId,N=o.target.structureId,{positionAssignments:M}=Kd({drawDefinition:a,structureId:N}),T=M.filter((({drawPosition:e})=>p.includes(e)));if(T.some((e=>e.participantId===D)))return ko;const E=T.filter((e=>{const t=p.includes(e.drawPosition),n=!e.participantId&&!e.bye&&!e.qualifier;return t&&n})).map((e=>e.drawPosition)),A=E.includes(v),R=o.target.roundNumber>1&&E.length,C=1===o.target.roundNumber&&A;if(m){const e=b?O():Mp({drawDefinition:a,structureId:N,drawPosition:g});if(e.error)return e}else if(C){const e=O();if(e.error)return e}else{if(!R)return{error:"Invlid drawPosition"};{const e=E.sort(Xa)[0],t=Yp({participantId:D,structureId:N,drawPosition:e,automaticPlacement:!0,inContextDrawMatchUps:n,drawDefinition:a,matchUpsMap:u});if(t.error)return t}}if(c&&i){var x;const e=null===(x=c.sides)||void 0===x?void 0:x.find((e=>e.sideNumber===3-i));if(null!=e&&e.lineUp){const{roundNumber:t}=s,{roundPosition:n}=c,i=1===t?n%2+1:1,{matchUp:r}=el({matchUpId:s.matchUpId,drawDefinition:a,matchUpsMap:u,event:d}),o=[1,2].map((e=>{var t;const n=(null===(t=r.sides)||void 0===t?void 0:t.find((t=>t.sideNumber===e)))||{};return h(f({},n),{sideNumber:e})}));r.sides=o;const l=r.sides.find((e=>e.sideNumber===i));l&&(l.lineUp=e.lineUp,Wu({drawDefinition:a,matchUp:r}))}}return f({},ko);function O(){return Yp({drawDefinition:a,participantId:D,structureId:N,drawPosition:v,automaticPlacement:!0,matchUpsMap:u,inContextDrawMatchUps:n})}}({loserMatchUpDrawPositionIndex:g,inContextDrawMatchUps:i,projectedWinningSide:n,loserDrawPosition:o,loserTargetLink:s,drawDefinition:a,matchUpStatus:c,loserMatchUp:w,winningSide:l,matchUpsMap:d,dualMatchUp:u,event:I});if(e.error)return e}}return ko}function Zp(e){const{inContextDrawMatchUps:t,drawDefinition:n,matchUpsMap:i,targetData:r,structure:o,matchUp:a}=e,{targetLinks:{loserTargetLink:s},targetMatchUps:{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}}=r;if(c){const e=Dp({targetLink:s,drawPosition:d,drawDefinition:n,inContextDrawMatchUps:t,matchUpsMap:i});if(e.error)return e}if(u){const r=wl({matchUpId:u.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetMatchUps:{winnerMatchUp:s}}=r,c=null==i?void 0:i.drawMatchUps.find((e=>e.matchUpId===u.matchUpId));let d,m,v=[];if(u.feedRound){var l;v=null==s||null===(l=s.drawPositions)||void 0===l?void 0:l.filter(Boolean),d=!0}else{var p;const{pairedPreviousMatchUp:e}=function({structureId:e,matchUpsMap:t,matchUp:n}){const i=null==n?void 0:n.roundPosition,r=i+(i%2?1:-1);return{pairedPreviousMatchUp:rd({matchUpsMap:t,structureId:e}).find((({roundNumber:e,roundPosition:t})=>e===n.roundNumber&&t===r))}}({structureId:o.structureId,matchUpsMap:i,matchUp:a});m=(null==e?void 0:e.matchUpStatus)===Yr,v=(null==e||null===(p=e.drawPositions)||void 0===p?void 0:p.filter(Boolean))||[],d=[...ao,qr].includes(null==e?void 0:e.matchUpStatus)||(null==e?void 0:e.winningSide)}if(d){const e=a.drawPositions||[];let r=u.drawPositions.filter(Boolean);Co(e,r)&&(r=r.filter((t=>!e.includes(t))));const o=e.concat(v).find((e=>r.includes(e)));if(s&&o){const e=Pp({winningDrawPosition:o,winnerMatchUp:s,inContextDrawMatchUps:t,drawDefinition:n,matchUpsMap:i});if(e.error)return e}}Zp({targetData:r,matchUp:u,inContextDrawMatchUps:t,drawDefinition:n,matchUpsMap:i,structure:o});let g=[to,Yr].includes(null==c?void 0:c.matchUpStatus)&&m?to:eo;const I=!m;let y=Up(h(f({},e),{matchUpStatus:g,removeScore:I,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:c,matchUpId:u.matchUpId}));if(y.error)return y}return f({},ko)}function Qp({score:e}={}){const{sets:t,scoreStringSide1:n,scoreStringSide2:i}=e||{};return!!e&&(!(!n&&!i)||!(null==t||!t.length)&&Object.values(t[0]).some((e=>e)))}function Xp(e){const{matchUp:t,matchUpStatus:n,score:i,winningSide:r}=e;if((null==t?void 0:t.matchUpStatus)===Yr&&n!==Yr){const t=Zp(e);if(t.error)return t}const o=n===Yr,a=Qp({score:i})&&!o&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!r),s=![Zr,Wr].includes(n||Zr),c=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||t.winningSide&&!r&&!Qp({score:i}),u=n&&n!==eo,d=({removeScore:n}={})=>{let i;const{structure:r,drawDefinition:o}=e,{connectedStructureIds:a}=Vp({drawDefinition:o,structure:r,matchUp:t});a.length&&(console.log({connectedStructureIds:a}),i=!0),Object.assign(e,{removeScore:n});const s=Sp(e);return s.error?s:h(f({},ko),{connectedStructures:i})};return r&&function(e){const{drawDefinition:t,winningSide:n,structure:i,matchUp:r}=e;let o;if(r.winningSide&&r.winningSide!==n){const{connectedStructureIds:n}=Vp({drawDefinition:t,structure:i,matchUp:r});n.length&&(console.log({connectedStructureIds:n}),o=!0);const a=Sp(e);if(a.error)return a}const a=Jp(e);return a.error?a:h(f({},ko),{connectedStructures:o})}(e)||a&&d({removeScore:s})||u&&function(e){const{drawDefinition:t,matchUp:n,structure:i,matchUpStatus:r}=e,o=r===qr,a=n.winningSide,s=r===Yr,c=sp({matchUpStatus:r}),u=cp({matchUpStatus:r}),d=a&&s;return!c&&!u&&{error:"Unrecognized matchUpStatus"}||a&&c&&!s&&kp(e)||d&&function(e){let t=Sp(e);return t.error?t:xp(e)}(e)||a&&Sp(e)||u&&Up(h(f({},e),{removeScore:[zr,to].includes(r),matchUpStatus:r||eo}))||o&&function({drawDefinition:e,structure:t,matchUp:n}){var i;if(null!=n&&n.winningSide)return{error:"Invalid matchUpStatus",matchUpStatus:qr};const{positionAssignments:r}=Kd({structure:t}),o=r.filter((e=>e.bye)).map((e=>e.drawPosition));return(null===(i=n.drawPositions)||void 0===i?void 0:i.some((e=>o.includes(e))))?(n.matchUpStatus=qr,n.matchUpStatusCodes=[],Wu({drawDefinition:e,matchUp:n}),ko):{error:"Cannot Assign BYE status if no assignment: { bye: true }"}}({drawDefinition:t,matchUp:n,structure:i})||!c&&{error:"Unrecognized matchUpStatus"}||s&&function(e){const t=kp(h(f({},e),{removeScore:!0}));return t.error?t:xp(e)}(e)||{error:"Invalid matchUpStatus"}}(e)||c&&d()||t&&function(e){var t;const n=Boolean(e.matchUp.collectionId),i=e.isCollectionMatchUp&&(null===(t=e.dualMatchUp)||void 0===t?void 0:t.winningSide)&&e.projectedWinningSide,r=Up(h(f({},e),{removeScore:!0}));if(n){const{matchUpTieId:t,drawDefinition:n,structure:r,event:o}=e,{removeWinningSide:a}=bp({matchUpId:t,drawDefinition:n,structure:r,event:o});console.log("ndd",{removeWinningSide:a,removeDirected:i})}return r}(h(f({},e),{removeScore:!0}))||console.log("unknown condition")&&f({},ko)}function em(e){var t;const{inContextDrawMatchUps:n,targetData:i,drawDefinition:r}=e,{targetMatchUps:{loserMatchUp:o,winnerMatchUp:a}}=i,s=(null==a||null===(t=a.drawPositions)||void 0===t?void 0:t.filter(Boolean).length)||0;if(null!=o&&o.winningSide||2===s&&null!=a&&a.winningSide)return!0;let c=o&&wl({matchUpId:o.matchUpId,drawDefinition:r,inContextDrawMatchUps:n}),u=a&&wl({matchUpId:a.matchUpId,drawDefinition:r,inContextDrawMatchUps:n});const d=c&&em({inContextDrawMatchUps:n,drawDefinition:r,targetData:c});return!!(u&&em({inContextDrawMatchUps:n,drawDefinition:r,targetData:u})||d)}function tm(e){var t,n;const{allowChangePropagation:i,tournamentRecord:r,drawDefinition:o,matchUpStatus:a,winningSide:s,matchUpId:c,event:u,score:d}=e;if(!o)return{error:jo};if([zr,Zr,Wr,eo].includes(a)&&s)return{error:_o,winningSide:s,matchUpStatus:a};if(![void 0,...io].includes(a))return{error:"Invalid matchUpStatus"};const l=id({drawDefinition:o});let{matchUps:p}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:o,matchUpsMap:l});p.find((({winnerMatchUpId:e,loserMatchUpId:t})=>e||t))||({inContextDrawMatchUps:p}=Bl({inContextDrawMatchUps:p,drawDefinition:o,matchUpsMap:l}));const m=l.drawMatchUps.find((e=>e.matchUpId===c)),f=p.find((e=>e.matchUpId===c));if(!m||!p)return{error:"matchUp not found"};if((m.winningSide||s)&&a===qr)return{error:"Incompatible matchUpStatus",matchUpStatus:a};const h=null===(t=f.drawPositions)||void 0===t?void 0:t.filter(Boolean);if(m.matchUpType===Bs)return{error:"DIRECT SCORING of TEAM matchUp not implemented"};const v=f.matchUpTieId,g=wl({matchUpId:v||c,inContextDrawMatchUps:p,drawDefinition:o}),I=f.structureId,{structure:y}=ad({drawDefinition:o,structureId:I});if(d&&m.matchUpType!==Bs&&!m.collectionId){const e=m.matchUpFormat||(null==y?void 0:y.matchUpFormat)||(null==o?void 0:o.matchUpFormat)||(null==u?void 0:u.matchUpFormat),t=function({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:n,winningSide:i,score:r}){if("object"!=typeof r)return{error:_o};const{sets:o,scoreStringSide1:a,scoreStringSide2:s}=r;if(void 0!==a&&"string"!=typeof a)return{error:_o,message:"scoreString must be a string!"};if(void 0!==s&&"string"!=typeof s)return{error:_o,message:"scoreString must be a string!"};if(void 0!==o&&!Array.isArray(o))return{error:_o,message:"sets must be an array"};if(null!=o&&o.length){const a=o.map((e=>null==e?void 0:e.setNumber));if(a.length!==bo(a).length)return{error:_o,message:"setNumbers not unique"};for(const e of o){const{side1Score:t,side2Score:n,side1TiebreakScore:i,side2TiebreakScore:r,side1PointScore:o,side2PointScore:a,winningSide:s,setNumber:c}=e;if(![t,n,i,r,o,a,c,s].filter((e=>void 0!==e)).every((e=>Io(e))))return{error:_o,message:"non-numeric values"};if(s&&![1,2].includes(s))return{error:_o,message:"winningSide must be 1 or 2"}}if(!function({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:n,winningSide:i,score:r}){const o=null==r?void 0:r.sets,a=((null==o?void 0:o.filter((e=>null==e?void 0:e.winningSide)))||[]).reduce(((e,t)=>{const{winningSide:n}=t;return e[n-1]++,e}),[0,0]),s=i&&i-1,c=1-s,u=a[s],d=a[c],l=kr(t),p=Math.max(...a),m=Po(a)[p],{bestOf:f}=l||{},h=f&&Math.ceil(f/2)||1,v=[Kr,Qr,to].includes(n||e),g=(!t||p===h)&&1===m&&a.indexOf(p)+1||void 0;return i&&u>d&&i===g||!i&&!g||v}({existingMatchUpStatus:e,matchUpStatus:n,matchUpFormat:t,winningSide:i,score:r}))return{error:"Invalid winningSide",message:"winningSide does not match analyzed score"}}return{valid:!0}}({existingMatchUpStatus:m.matchUpStatus,matchUpFormat:e,matchUpStatus:a,winningSide:s,score:d});if(t.error)return t}const w=2===(null===(n=m.sides)||void 0===n?void 0:n.map((e=>e.participantId)).filter(Boolean).length)||2===(null==h?void 0:h.length);if(a&&no.includes(a)&&!w)return{error:"Invalid matchUpStatus"};let U;if(Object.assign(e,{inContextDrawMatchUps:p,inContextMatchUp:f,matchUpTieId:v,matchUpsMap:l,targetData:g,structure:y,matchUp:m}),v){const{matchUp:t}=el({matchUpId:v,inContext:!0,drawDefinition:o,matchUpsMap:l,event:u}),n=(null==t?void 0:t.tieFormat)||(null==o?void 0:o.tieFormat)||(null==u?void 0:u.tieFormat)||void 0,{projectedWinningSide:i}=function({drawDefinition:e,winningSide:t,dualMatchUp:n,tieFormat:i,structure:r,matchUp:o,event:a,score:s}){const c=Ja(n,void 0,!0);for(const d of(null==c?void 0:c.tieMatchUps)||[])d.matchUpId===o.matchUpId&&(d.winningSide=t,d.score=s);i=i||(null==o?void 0:o.tieFormat)||(null==r?void 0:r.tieFormat)||(null==e?void 0:e.tieFormat)||(null==a?void 0:a.tieFormat);const{winningSide:u}=cc({matchUp:c,tieFormat:i});return{projectedWinningSide:u}}({winningSide:s,dualMatchUp:t,tieFormat:n,structure:y,matchUp:m,event:u,score:d});U=i!==t.winningSide,Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:U,projectedWinningSide:i,matchUpTieId:v,dualMatchUp:t,tieFormat:n})}const b=em(e),S=sp({matchUpStatus:a});if(!v){if(b&&!s&&cp({matchUpStatus:a}))return{error:"Incompatible matchUpStatus",activeDownstream:b,winningSide:s};if(s&&s===m.winningSide&&a&&!S)return{error:"Incompatible matchUpStatus",directingMatchUpStatus:S,matchUpStatus:a}}const{schedule:P}=e;if(P){const e=al({tournamentRecord:r,disableNotice:!0,drawDefinition:o,matchUpId:c,schedule:P});if(e.error)return e}const D=m.matchUpType!==Bs&&!U&&s&&m.winningSide&&m.winningSide!==s;if(i&&D&&m.roundPosition)return function(e){var t;const{inContextMatchUp:n,structure:i,drawDefinition:r}=e,o=n.roundNumber,a=n.sides.find((e=>e.sideNumber===n.winningSide)),s=n.sides.find((e=>e.sideNumber!==n.winningSide)),{drawPosition:c,participantId:u}=a,{drawPosition:d,participantId:l}=s,{matchUps:p}=Xd(e),m=p.filter((({drawPositions:e,roundNumber:t})=>(null==e?void 0:e.includes(c))&&t>o));sa({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach((e=>{var t;e.drawPositions=(null===(t=e.drawPositions)||void 0===t?void 0:t.map((e=>e===c?d:e)))||[],Wu({drawDefinition:r,matchUp:e})}));const{stage:f,stageSequence:h}=i,v=r.structures.filter((({stage:e,stageSequence:t})=>e===f&&t>h)).map((({structureId:e})=>e)),{targetLinks:{loserTargetLink:g,winnerTargetLink:I}}=e.targetData,y=[null==g?void 0:g.target.structureId,null==I||null===(t=I.target)||void 0===t?void 0:t.structureId].filter(Boolean);return r.structures.filter((({stage:e,structureId:t})=>e!==f&&y.includes(t))).forEach((({stage:e,stageSequence:t,structureId:n})=>{v.includes(n)||v.push(n),r.structures.filter((({stage:n,stageSequence:i})=>n===e&&i>t)).forEach((({structureId:e})=>{v.includes(e)||v.push(e)}))})),r.structures.filter((({structureId:e})=>v.includes(e))).forEach((e=>{const{positionAssignments:t}=Hd({structure:e}),n=t.find((({participantId:e})=>e===u)),i=t.find((({participantId:e})=>e===l));n&&(n.participantId=l),i&&(i.participantId=u)})),Up(e)}(e);const N=s&&!v||e.projectedWinningSide;return!b&&Xp(e)||N&&function(e){const{matchUp:t,winningSide:n,matchUpTieId:i,dualWinningSideChange:r}=e;return n===t.winningSide||i&&!r?nm(e):{error:"Cannot change winningSide"}}(e)||S&&nm(e)||{error:"No valid actions"}}function nm(e){const{matchUp:t,event:n}=e,i=e.isCollectionMatchUp&&t.winningSide&&!e.winningSide&&!Qp({score:e.score}),r=e.isCollectionMatchUp?e.machUpStatus||i&&eo:e.matchUpStatus||Hr,o=[zr,to].includes(r)&&![Zr,Wr].includes(r),a=Up(h(f({},e),{matchUpStatus:r,removeWinningSide:i,removeScore:o}));if(e.isCollectionMatchUp){const{matchUpTieId:t,drawDefinition:i,structure:r}=e,{removeWinningSide:o}=bp({matchUpId:t,drawDefinition:i,structure:r,event:n});console.log("sms",{removeWinningSide:o})}return a}function im(e){const{drawDefinition:t,event:n,matchUpFormat:i,structureId:r,matchUpId:o}=e;let{tieFormat:a}=e;if(!t)return{error:jo};if(!i&&!a)return{error:"Missing matchUpFormat"};if(i&&!$r(i))return{error:"Unrecognized matchUpFormat"};if(a){const e=function(e){const t=sc({tieFormat:e,checkCollectionIds:!1});if(t.error)return t;for(const n of e.collectionDefinitions)n.collectionId||(n.collectionId=es());return{tieFormat:e}}(a);if(e.error)return e;a=e.tieFormat}if(o){const{matchUp:e,error:r}=el({drawDefinition:t,matchUpId:o,event:n});if(r)return{error:r};if(i&&e.matchUpType!==lc)e.matchUpFormat=i;else{if(!a||e.matchUpType!==lc)return{error:_o};e.tieFormat=a}Wu({drawDefinition:t,matchUp:e})}else if(r){const{structure:e,error:n}=ad({drawDefinition:t,structureId:r});if(n)return{error:n};if(!e)return{error:"structure not found"};i&&e.matchUpType!==lc?e.matchUpFormat=i:a&&(e.tieFormat=a)}else t&&(i?t.matchUpFormat=i:a&&(t.tieFormat=a));return zu({drawDefinition:t,structureIds:r?[r]:void 0}),h(f({},ko),{tieFormat:a})}function rm({score:e,winningSide:t,matchUpStatus:n}={}){if(!e)return{sets:[]};const i=e.sets||[];let r=Gc({winnerFirst:!1,matchUpStatus:n,sets:i}),o=Gc({winnerFirst:!1,matchUpStatus:n,reversed:!0,sets:i}),a=Gc({winningSide:t,matchUpStatus:n,sets:i}),s=r===a?o:r;return t&&(r=1===t?a:s,o=2===t?a:s),{score:{sets:i,scoreStringSide1:r,scoreStringSide2:o}}}function om(e){var t;const{tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpId:o,schedule:a,event:s,notes:c}=e;if(!i)return{error:"Missing drawId"};if(!o)return{error:"Missing matchUpId"};const{policy:u}=Es({policyType:"scoring",tournamentRecord:n,event:s}),d=void 0!==e.allowChangePropagation?e.allowChangePropagation:void 0!==(null==u?void 0:u.allowChangePropagation)?u.allowChangePropagation:void 0;let{outcome:l}=e;if(r){const e=im({drawDefinition:i,matchUpFormat:r,matchUpId:o,event:s});if(e.error)return e}if(null!=l&&null!==(t=l.score)&&void 0!==t&&t.sets&&!l.score.scoreStringSide1){const{score:e}=rm(l);l.score=e,l.score.sets=l.score.sets.filter((e=>e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore))}return tm({matchUpStatusCodes:null==l?void 0:l.matchUpStatusCodes,matchUpStatus:null==l?void 0:l.matchUpStatus,winningSide:null==l?void 0:l.winningSide,allowChangePropagation:d,score:null==l?void 0:l.score,tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpId:o,schedule:a,event:s,notes:c})}function am(e){if(!e.tournamentRecord)return{error:Lo};const{tournamentRecord:t,outcomes:n}=e,i={};n.forEach((e=>{const{eventId:t}=e;i[t]||(i[t]=[]),i[t].push(e)}));for(const r of Object.keys(i)){const{event:e}=_s({tournamentRecord:t,eventId:r});for(const n of i[r]){const{drawId:i}=n,r=e.drawDefinitions.find((e=>e.drawId===i));if(r){const{matchUpFormat:o,matchUpId:a}=n,s=om({tournamentRecord:t,drawDefinition:r,event:e,drawId:i,matchUpFormat:o,matchUpId:a,schedule:null==n?void 0:n.schedule,outcome:n});if(s.error)return s}}}return ko}function sm({tournamentRecord:e}){if(!e)return{error:Lo};const t=e.tournamentId,{extension:n}=xs({tournamentRecord:e,name:"schedulingProfile"});let i=(null==n?void 0:n.value)||[];if(i.length){const n=e.venues.map((({venueId:e,courts:t})=>(null==t?void 0:t.length)&&e)),{eventIds:r,drawIds:o}=kl({tournamentRecords:{[t]:e}}),{updatedSchedulingProfile:a,modifications:s,issues:c}=Xl({schedulingProfile:i,venueIds:n,eventIds:r,drawIds:o});if(s){i=a;const t=function({tournamentRecord:e,schedulingProfile:t}){return ld({tournamentRecord:e,extension:{name:"schedulingProfile",value:t}})}({tournamentRecord:e,schedulingProfile:i});return t.error?t:{schedulingProfile:i,modifications:s,issues:c}}}return{schedulingProfile:i,modifications:0}}function cm({tournamentRecord:e,schedulingProfile:t,requireCourts:n=!0}){if(!t){const{modifications:t,issues:n}=sm({tournamentRecord:e});return{success:!t,modifications:t,issues:n}}const{venueIds:i,eventIds:r,drawIds:o}=Gl({tournamentRecord:e,requireCourts:n}),{modifications:a,issues:s}=Xl({schedulingProfile:t,venueIds:i,eventIds:r,drawIds:o});return{success:!a,modifications:a,issues:s}}function um({tournamentRecord:e,courtId:t,scheduleVisibilityFilters:n,matchUpFilters:i}){if(!e)return{error:Lo};if(!t)return{error:"Missing courtId"};const{schedulingProfile:r}=sm({tournamentRecord:e}),{matchUps:o}=Ml({tournamentRecord:e,scheduleVisibilityFilters:n,matchUpFilters:i});return{matchUps:function({matchUps:e,courtId:t}){return tp({matchUps:e.filter((e=>{var n;return(null===(n=e.schedule)||void 0===n?void 0:n.courtId)===t})),schedulingProfile:r})}({matchUps:o,courtId:t})}}function dm({matchUpsCount:e=0}){const t=`Schedule would be deleted from ${e} ${1===e?"matchUp":"matchUps"}; use { force: true }`;return{message:t,error:t}}function lm({startTime:e,endTime:t}={}){if(!Na.test(e)||!Na.test(t))return!1;const[n,i]=e.split(":"),[r,o]=t.split(":");return!(r<n||n===r&&o<i)}function pm({dateAvailability:e}){if(!e)return{error:"Missing dateAvailability"};if(!Array.isArray(e))return{error:"Invalid dateAvailability"};const t="Times must be 24 hour => 00:00";for(const n of e){if("object"!=typeof n)return{error:"Invalid dateAvailability"};const{date:e,startTime:i,endTime:r,bookings:o=[]}=n;if(!i||!r)return{error:"Invalid dateAvailability"};if(e&&!Da.test(e))return{error:Go,dateAvailability:{date:e},message:"Dates must be formated => YYYY-MM-DD"};if(!Na.test(i))return{error:"Invalid time",dateAvailability:{startTime:i},message:t};if(!Na.test(r))return{error:"Invalid time",dateAvailability:{endTime:r},message:t};if(i===r)return{error:"Invalid time",dateAvailability:{startTime:i,endTime:r},message:"startTime and endTime are equivalent"};if(!lm({startTime:i,endTime:r}))return{error:"Invalid time",dateAvailability:{startTime:i,endTime:r},message:"endTime must be after startTime"};if(o){if(!Array.isArray(o))return{error:"Invalid bookings"};for(const e of o){if("object"!=typeof e)return{error:"Invalid bookings"};const{startTime:n,endTime:i}=e;if(!Na.test(n))return{error:"Invalid time",booking:{startTime:n},message:t};if(!Na.test(i))return{error:"Invalid time",booking:{endTime:i},message:t};if(n===i)return{error:"Invalid time",dateAvailability:{startTime:n,endTime:i},message:"startTime and endTime are equivalent"};if(!lm({startTime:n,endTime:i}))return{error:"Invalid time",dateAvailability:{startTime:n,endTime:i},message:"endTime must be after startTime"}}}}return{valid:!0}}function mm({tournamentRecord:e,dateAvailability:t,disableNotice:n,courtId:i,force:r}){if(!e)return{error:Lo};if(!i)return{error:"Missing courtId"};const o=pm({dateAvailability:t});if(o.error)return o;const{court:a,venue:s,error:c}=tc({tournamentRecord:e,courtId:i});return c?{error:c}:(a.dateAvailability=t,n||la({topic:"modifyVenue",payload:{venue:s},key:s.venueId}),ko)}function fm({tournamentRecord:e,modifications:t,disableNotice:n,courtId:i,force:r}){if(!e)return{error:Lo};if(!i)return{error:"Missing courtId"};if(!t||"object"!=typeof t)return{error:"Invalid object"};const{court:o,venue:a,error:s}=tc({tournamentRecord:e,courtId:i});if(s)return{error:s};const c=Object.keys({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}).filter((e=>"courtId"!==e));if(!Object.keys(t).filter((e=>c.includes(e))).length)return{error:"No valid attributes"};const u=c.filter((e=>!["dateAvailability"].includes(e)));if(Object.keys(t).filter((e=>u.includes(e))).forEach((e=>Object.assign(o,{[e]:t[e]}))),t.dateAvailability){const o=mm({tournamentRecord:e,dateAvailability:t.dateAvailability,disableNotice:n,courtId:i,force:r});if(o.error)return o}return n||la({topic:"modifyVenue",payload:{venue:a},key:a.venueId}),h(f({},ko),{court:Ja(o)})}function hm({tournamentRecord:e,disableNotice:t,returnDetails:n,venueId:i,courtId:r,court:o}){const{venue:a}=ec({tournamentRecord:e,venueId:i});if(!a)return{error:"Venue not found"};a.courts||(a.courts=[]);const s={altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0,venueId:i,courtId:r};if(s.courtId||(s.courtId=es()),a.courts.reduce(((e,t)=>e||t.courtId===s.courtId),void 0))return{error:"Court exists"};{const e=((null==o?void 0:o.dateAvailability)||[]).map((e=>{var t;return h(f({},e),{date:Va(e.date),startTime:Ba(e.startTime),endTime:Ba(e.endTime),bookings:null===(t=e.bookings)||void 0===t?void 0:t.map((({startTime:e,endTime:t,bookingType:n})=>({startTime:Ba(e),endTime:Ba(t),bookingType:n})))})}));for(const t of Object.keys(s))if(o[t])if("dateAvailability"===t){const t=pm({dateAvailability:e}),{valid:n,error:i}=t;if(n)s.dateAvailability=e;else if(i)return{error:i}}else s[t]=o[t];return a.courts.push(s),t||la({topic:"modifyVenue",payload:{venue:a},key:a.venueId}),sa()||n?h(f({},ko),{court:Ja(s),venueId:i}):f({},ko)}}function vm({dateAvailability:e=[],tournamentRecord:t,courtNames:n=[],courtsCount:i,courtIds:r,venueId:o}){if(!o)return{error:"Missing venueId"};if(!ho(i)||!n)return{error:"Missing courtsCount/courtNames"};const a=Eo(0,i=i||n.length).map((t=>({courtName:n[t]||`Court ${t+1}`,dateAvailability:e}))).map((e=>{const n=null==r?void 0:r.pop();return hm({disableNotice:!0,returnDetails:!0,tournamentRecord:t,courtId:n,venueId:o,court:e})})),s=a.map((e=>e.court)).filter(Boolean);if(s.length===i){const{venue:e}=ec({tournamentRecord:t,venueId:o});return la({topic:"modifyVenue",payload:{venue:e},key:e.venueId}),h(f({},ko),{courts:Ja(s)})}return Object.assign({},{courts:Ja(s)},{error:a})}function gm({tournamentRecord:e,modifications:t,venueId:n,force:i}){var r,o;if(!e)return{error:Lo};if(!t||"object"!=typeof t)return{error:"Invalid object"};if(!n)return{error:"Missing venueId"};const{venue:a,error:s}=ec({tournamentRecord:e,venueId:n});if(s)return{error:s};const c=Object.keys({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}).filter((e=>"venueId"!==e));if(!Object.keys(t).filter((e=>c.includes(e))).length)return{error:"No valid attributes"};const u=c.filter((e=>!["courts"].includes(e)));Object.keys(t).filter((e=>u.includes(e))).forEach((e=>Object.assign(a,{[e]:t[e]})));const d=(null==a||null===(r=a.courts)||void 0===r?void 0:r.map((e=>e.courtId)))||[],l=(null===(o=t.courts)||void 0===o?void 0:o.map((e=>e.courtId)))||[],p=d.filter((e=>!l.includes(e)));if(p.length){const t=a.courts.filter((e=>p.includes(e.courtId))).map((t=>{const{matchUps:n}=um({tournamentRecord:e,courtId:t.courtId});return n.length})).reduce(((e,t)=>e+t));if(t&&!i)return{error:dm({matchUpsCount:t})};a.courts=a.courts.filter((e=>l.includes(e.courtId)))}if(t.courts)for(const m of t.courts){const{courtId:t}=m||{};let r=fm({tournamentRecord:e,modifications:m,disableNotice:!0,courtId:t,force:i});if("Court not found"===r.error&&(r=hm({tournamentRecord:e,venueId:n,court:m,disableNotice:!0})),r.error)return r}return cm({tournamentRecord:e}),la({topic:"modifyVenue",payload:{venue:a},key:a.venueId}),h(f({},ko),{venue:Ja(a)})}function Im({tournamentRecord:e,drawDefinition:t,drawId:n,matchUpId:i}){if(!i)return{error:"Missing matchUpId"};if(!t&&!n)return{error:"Missing drawId"};let r;if(!t){if(!e)return{error:Lo};({drawDefinition:t}=_s({tournamentRecord:e,drawId:n}))}if(t)({matchUp:r}=el({drawDefinition:t,matchUpId:i}));else{if(!e)return{error:Lo};const{matchUps:t}=Al({tournamentRecord:e});({matchUp:r}=ac({matchUps:t,matchUpId:i}))}if(!r)return{error:"matchUp not found"};if(r.timeItems&&r.timeItems.reduce(((e,t)=>t.itemType===ps||e),void 0)){const e={itemType:ps,itemValue:"",itemDate:""};r.timeItems.push(e),Wu({drawDefinition:t,matchUp:r})}return ko}function ym({tournamentRecord:e,venueId:t,force:n}){if(!e)return{error:Lo};if("string"!=typeof t)return{error:"Missing venueId"};const{courts:i}=nc({tournamentRecord:e,venueId:t}),r={courtIds:i.map((e=>e.courtId))},{matchUps:o}=Ml({tournamentRecord:e,contextFilters:r});if(o.length&&!n)return dm({matchUpsCount:o.length});for(const s of o){const t=Im({tournamentRecord:e,drawId:s.drawId,matchUpId:s.matchUpId});if(t.error)return t}let a;return e.venues=(e.venues||[]).filter((e=>{if(e.venueId!==t)return!0;a=!0})),a&&la({topic:"deleteVenue",payload:{venueId:t}}),ko}function wm({flight:e,checkEntryStatus:t=!0,modifyEventEntries:n,existingDrawCount:i,drawDefinition:r,event:o}){var a,s,c,u,d;if(!r)return{error:"Missing drawId"};if(!o)return{error:Vo};o.drawDefinitions||(o.drawDefinitions=[]);const{drawId:l,drawName:p,entries:m}=r,{entries:v}=o;let g=0;if(void 0!==i&&i!==o.drawDefinitions.length)return{error:_o,message:"drawDefintions count mismatch"};if(!!o.drawDefinitions.find((e=>e.drawId===l)))return{error:"drawId exists"};const{flightProfile:I}=yp({event:o}),y=e&&(null==I||null===(a=I.flights)||void 0===a?void 0:a.find((t=>t.flightNumber===e.flightNumber)));if(y&&y.drawId!==r.drawId)return{error:"Invalid drawDefinition",relevantFlight:y};const w=null==y?void 0:y.drawEntries.every((({participantId:e,entryStatus:t})=>{const n=m.find((t=>t&&t.participantId===e));return(null==n?void 0:n.entryStatus)===t})),U=!t||v&&(null==m?void 0:m.every((({participantId:e,entryStatus:t})=>{const n=v.find((t=>t.participantId===e));return(null==n?void 0:n.entryStatus)===t})));if(y&&!w)return{error:"Invalid drawDefinition",relevantFlight:y,matchingEventEntries:U};if(n&&m.filter(Boolean).forEach((e=>{if(Cd.includes(null==e?void 0:e.entryStatus)){const t=v.filter(Boolean).find((t=>t.participantId===e.participantId));e.entryStatus&&t.entryStatus!==e.entryStatus&&(t.entryStatus=e.entryStatus,g+=1)}})),v&&!U)return{error:"Invalid drawDefinition",eventEntries:v,matchingEventEntries:U};const b=(null==I||null===(s=I.flights)||void 0===s||null===(c=s.map((({flightNumber:e})=>!isNaN(e)&&parseInt(e))))||void 0===c?void 0:c.filter(Boolean))||[],S=(null===(u=o.drawDefinitions.map((({drawOrder:e})=>!isNaN(e)&&parseInt(e))))||void 0===u?void 0:u.filter(Boolean))||[];let P=Math.max(0,...S,...b)+1;const D=null==I||null===(d=I.flights)||void 0===d?void 0:d.find((e=>e.drawId===l));let N;if(D){D.drawName=r.drawName,N={name:"flightProfile",value:h(f({},I),{flights:I.flights})};const e=D.flightNumber;e&&!S.includes(e)?P=e:D.flightNumber=P}else{const e=(null==I?void 0:I.flights)||[];e.push({manuallyAdded:!0,flightNumber:P,drawEntries:m,drawName:p,drawId:l}),N={name:"flightProfile",value:h(f({},I||{}),{flights:e})}}md({event:o,extension:N}),Object.assign(r,{drawOrder:P}),o.drawDefinitions.push(r);const{topics:M}=fa();if(M.includes("addMatchUps")){const{matchUps:e}=Tl({drawDefinition:r,event:o});Gu({drawDefinition:r,matchUps:e})}return qu({drawDefinition:r}),h(f({},ko),{modifiedEventEntryStatusCount:g})}function Um({tournamentRecord:e,returnDetails:t,disableNotice:n,venue:i}){return e?i?(e.venues||(e.venues=[]),i.venueId||(i.venueId=es()),e.venues.reduce(((e,t)=>e||t.venueId===i.venueId),void 0)?{error:"Venue exists"}:(e.venues.push(i),n||la({topic:"addVenue",payload:{venue:i}}),sa({addVenue:!0})?h(f({},ko),{venue:Ja(i)}):t?i:f({},ko))):{error:$o}:{error:Lo}}function bm({allowDuplicateParticipantIdPairs:e,returnParticipant:t,tournamentRecord:n,disableNotice:i,pairOverride:r,participant:o}){if(!n)return{error:Lo};if(!o)return{error:"Missing participant"};o.participantId||(o.participantId=es()),n.participants||(n.participants=[]);const{participantId:a}=o;if(n.participants.reduce(((e,t)=>t.participantId===a||e),!1))return{error:"participantId exists"};const{participantType:s,participantRole:c}=o;if(!Object.keys(fc).includes(s))return{error:"Invalid participantType",participantType:s};if(!c)return{error:"Missing participantRole"};const u=n.participants||[],d=u.filter((e=>e.participantType===dc)).map((e=>e.participantId));if(s===pc){if(o.person)return{error:_o,person:o.person};if(!o.individualParticipantIds)return{error:"Missing participantIds"};if(2!==o.individualParticipantIds.length&&!r)return{error:"Invalid participantIds",message:"PAIR must be 2 individualParticipantIds"};{const e=u.filter((e=>e.participantType===dc)).map((e=>e.participantId));if(!Array.isArray(o.individualParticipantIds))return{error:"Invalid participantIds"};if(!o.individualParticipantIds.reduce(((t,n)=>e.includes(n)&&t),!0))return{error:"Invalid participantIds"}}const n=u.filter((e=>e.participantType===pc)).map((e=>({participant:e,individualParticipantIds:e.individualParticipantIds}))),i=o.participantType===pc&&n.find((e=>2===Ro(e.individualParticipantIds,o.individualParticipantIds).length));if(i&&!e)return h(f({},ko),{existingParticipant:!0,participant:t&&Ja(i.participant)});if(!o.participantName){const e=u.filter((e=>o.individualParticipantIds.includes(e.participantId)));let t=e.map((e=>{var t;return null===(t=e.person)||void 0===t?void 0:t.standardFamilyName})).filter(Boolean).join("/");1===e.length&&(t+="/Unknown"),o.participantName=t}}else if(s===dc){if(!o.person||!o.person.standardFamilyName||!o.person.standardGivenName)return{error:"Missing person details"};if(!o.participantName){const e=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=e,o.name=e}}else{if(o.person)return{error:_o,person:o.person};const{individualParticipantIds:e}=o;if(null!=e&&e.length)for(const t of e){if("string"!=typeof t)return{error:_o,participantId:t};if(!d.includes(t))return{error:"Participant Not Found",participantId:t}}}return n.participants.push(o),i||la({topic:"addParticipants",payload:{participants:[o]}}),f({participant:t&&Ja(o)},ko)}function Sm({allowDuplicateParticipantIdPairs:e,returnParticipants:t,participants:n=[],tournamentRecord:i}){if(!i)return{error:Lo};i.participants||(i.participants=[]);const r=i.participants.map((e=>e.participantId))||[];n.forEach((e=>{e.participantId||(e.participantId=es())}));const o=n.filter((e=>!r.includes(e.participantId))),a=n.filter((e=>r.includes(e.participantId))),s=o.filter((e=>e.participantType===dc)),c=o.filter((e=>e.participantType!==dc)),u=s.concat(...c),d=[];if(u.length){for(const t of u){const n=bm({allowDuplicateParticipantIdPairs:e,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:t});if(n.error)return n;n.success&&!n.existingParticipant&&d.push(n.participant)}d.length&&la({topic:"addParticipants",payload:{participants:d}});const n=f({participants:t&&Ja(d),addedCount:d.length},ko);return a.length&&Object.assign(n,{notAdded:a,message:"Existing participant"}),n}return f({message:"No new participants to add",addedCount:0},ko)}const Pm=({scheduleAttributes:e=["scheduledDate","scheduledTime"],schedule:t})=>!!Object.keys(t).filter((t=>e.includes(t))).filter((e=>t[e])).length;function Dm({matchUps:e=[],scheduleAttributes:t=["scheduledDate","scheduledTime"]}){if(!Array.isArray(e))return{error:"Missing matchUps"};if(!Array.isArray(t))return{error:_o};const n=e.filter((({schedule:e})=>Pm({schedule:e,scheduleAttributes:t}))).reduce(((e,t)=>{const{schedule:n}=t,i=Va(null==n?void 0:n.scheduledDate),r=Ba(null==n?void 0:n.scheduledTime);return i&&r&&(e[i]?e[i].push(t):e[i]=[t]),e}),{});return Object.keys(n).forEach((e=>{n[e].sort(((e,t)=>{var n,i;return function(e,t){const n=Ga(e),i=Ga(t);if(parseInt(n.hours)<parseInt(i.hours))return-1;if(parseInt(n.hours)>parseInt(i.hours))return 1;if(n.hours===i.hours){if(parseInt(n.minutes)<parseInt(i.minutes))return-1;if(parseInt(n.minutes)>parseInt(i.minutes))return 1}return 0}(Ba(null===(n=e.schedule)||void 0===n?void 0:n.scheduledTime),Ba(null===(i=t.schedule)||void 0===i?void 0:i.scheduledTime))}))})),{scheduledMatchUps:n}}var Nm;!function(e){e.INDIVIDUAL="INDIVIDUAL",e.PAIR="PAIR",e.TEAM="TEAM"}(Nm||(Nm={}));var Mm,Tm=Nm.INDIVIDUAL,Em=Nm.PAIR;Nm.TEAM,function(e){e.SIGNED_IN="SIGNED_IN",e.SIGNED_OUT="SIGNED_OUT"}(Mm||(Mm={}));var Am=Mm.SIGNED_IN,Rm=Mm.SIGNED_OUT;const Cm="SCALE",xm="RATING",Om="RANKING";function km({element:e,accessor:t}){if("string"!=typeof t)return{values:[]};const n=Ja(e),i=t.split(".");let r,o=[];!function e({targetElement:t,attributes:n=[],significantCharacters:i}){for(const[r,o]of n.entries())if(t&&t[o])if(Array.isArray(t[o])){const i=t[o],a=n.slice(r);i.forEach((t=>e({targetElement:t,attributes:a})))}else a({targetElement:t=t[o],index:r});function a({targetElement:e,index:t}){if(e&&t===n.length-1&&["string","number"].includes(typeof e)){const t=i?e.slice(0,i):e;r?o.includes(t)||o.push(t):(r=t,o.push(t))}}}({targetElement:n,attributes:i});const a={value:r};return o.length&&(a.values=o),a}function Fm({tournamentRecord:e,participantFilters:t,participants:n}){var i,r;let{eventIds:o}=t;const{accessorValues:a,drawEntryStatuses:s,positionedParticipants:c,eventEntryStatuses:u,participantRoles:d,participantRoleResponsibilities:l,participantTypes:p,participantIds:m,signInStatus:f,enableOrFiltering:h}=t,v=Lm(o)&&(null===(i=e.events)||void 0===i?void 0:i.filter((e=>o.includes(e.eventId))))||e.events||[],g=s&&function({drawEntryStatuses:e,tournamentEvents:t}){const n=({entryStatus:t})=>!Array.isArray(e)||e.includes(t);return bo(t.reduce(((e,t)=>{var i,r;const{flightProfile:o}=yp({event:t}),a=(null==o||null===(i=o.flights)||void 0===i?void 0:i.map((({drawEntries:e})=>Array.isArray(e)?e.filter(n).map(Qu):[])).flat())||[],s=(null===(r=t.drawDefinitions)||void 0===r?void 0:r.map((({entries:e})=>e?e.filter(n).map(Qu):[])))||[];return e.concat(...a,...s)}),[]))}({drawEntryStatuses:s,tournamentEvents:v}),I=u&&function({eventEntryStatuses:e,tournamentEvents:t}){return bo(t.reduce(((t,n)=>{const i=(n.entries||[]).filter((({entryStatus:t})=>!Array.isArray(e)||e.includes(t))).map(Qu);return t.concat(...i)}),[]))}({eventEntryStatuses:u,tournamentEvents:v}),y=[!0,!1].includes(c)&&v.reduce(((e,t)=>e.concat(...(t.drawDefinitions||[]).map((e=>function({drawDefinition:e}){return e?(e.structures||[]).map((e=>{const{positionAssignments:t}=Hd({structure:e});return Zu(t)})).flat():{error:jo}}({drawDefinition:e}))).filter(Boolean))),[]),w=e=>a.reduce(((t,n)=>{const{accessor:i,value:r}=n,{values:o}=km({element:e,accessor:i});return t&&(null==o?void 0:o.includes(r))}),!0);if(n=null===(r=n)||void 0===r?void 0:r.filter((e=>{const t=ku({element:e,itemType:"SIGN_IN_STATUS"}),{participantId:n,participantType:i,participantRole:r,participantRoleResponsibilities:o}=e;return h?c&&y.includes(n)||!1===c&&!y.includes(n)||g&&g.includes(n)||I&&I.includes(n)||m&&m.includes(n)||f&&t===f||p&&Lm(p)&&p.includes(i)||d&&Lm(d)&&d.includes(r)||l&&Lm(o)&&Lm(l)&&l.find((e=>o.includes(e)))||(null==a?void 0:a.length)&&Lm(a)&&w(e):(void 0===c||c&&y.includes(n)||!1===c&&!y.includes(n))&&(!g||g.includes(n))&&(!I||I.includes(n))&&(!m||m.includes(n))&&(!f||t===f)&&(!p||Lm(p)&&p.includes(i))&&(!d||Lm(d)&&d.includes(r))&&(!l||Lm(o)&&Lm(l)&&l.find((e=>o.includes(e))))&&(!(null!=a&&a.length)||Lm(a)&&w(e))})),v.length&&o){var U;const t=v.filter((e=>o.includes(e.eventId))).map((t=>{const n=(t.entries||[]).map((e=>e.participantId));if(t.eventType===Js)return n;const i=(e.participants||[]).filter((e=>n.includes(e.participantId))).map((e=>e.individualParticipantIds)).flat(1);return n.concat(...i)})).flat(1);n=null===(U=n)||void 0===U?void 0:U.filter((e=>t.includes(e.participantId)))}return n}function Lm(e){return e&&Array.isArray(e)&&e.length}function jm({participantFilters:e={},convertExtensions:t,policyDefinitions:n,withScheduleItems:i,tournamentRecord:r,scheduleAnalysis:o,withStatistics:a,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l,inContext:p,withISO:m}){if(!r)return{error:Lo};if(!r.participants)return{error:"Missing participants"};let v=r.participants.map((e=>Ja(e,t)));if("object"!=typeof e)return{error:"Invalid object",participantFilters:e};var g;let I;if(p&&(null===(g=v)||void 0===g||g.forEach((e=>{[pc,lc,mc].includes(e.participantType)&&(e.individualParticipants=e.individualParticipantIds.map((e=>Ja(r.participants.find((t=>t.participantId===e)),t,!0))))}))),e&&(v=Fm({tournamentRecord:r,participantFilters:e,participants:v})),i||o||a||s||c||u||d||l||m||p){const t=function(e){var t,n;const i=[],r={},o={},{tournamentRecord:a,participantFilters:s}=e,c=(null==a?void 0:a.participants)||[],{relevantParticipantIdsMap:u}=function({tournamentRecord:e,tournamentRecords:t,processParticipantId:n}){if("object"!=typeof e&&"object"!=typeof t)return{error:Lo};const i=t?Object.values(t).map((({participants:e=[]})=>e)).flat():e.participants||[];return{relevantParticipantIdsMap:Object.assign({},...i.map((({participantId:e,participantType:t,individualParticipantIds:i})=>("function"==typeof n&&n(e),{[e]:(i||[]).map((e=>({relevantParticipantId:e,participantType:Tm}))).concat({relevantParticipantId:e,participantType:t})}))))}}({processParticipantId:e=>{o[e]||(o[e]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},groups:[],teams:[],draws:{},losses:0,wins:0})},tournamentRecord:a}),d=null==s?void 0:s.participantIds,l=e=>{const t=e&&u[e]||[];return t.some((e=>!d||d.includes(e.relevantParticipantId)))?t:[]};return c.forEach((e=>{if(e.participantType===mc){var t;const n=e.participantId;null==e||null===(t=e.individualParticipantIds)||void 0===t||t.forEach((t=>{o[t].groupParticipantIds.includes(n)||(o[t].groupParticipantIds.push(n),o[t].groups.push({participantRoleResponsibilities:e.participantRoleResponsibilities,participantOtherName:e.participantOtherName,participantName:e.participantName,participantId:e.participantId}))}))}if(e.participantType===Bs){var n;const t=e.participantId;null==e||null===(n=e.individualParticipantIds)||void 0===n||n.forEach((n=>{o[n].teamParticipantIds.includes(t)||(o[n].teamParticipantIds.push(t),o[n].teams.push({participantRoleResponsibilities:e.participantRoleResponsibilities,participantOtherName:e.participantOtherName,participantName:e.participantName,participantId:e.participantId,teamId:e.teamId}))}))}if(e.participantType===pc){var i;const t=e.participantId;null==e||null===(i=e.individualParticipantIds)||void 0===i||i.forEach((e=>{o[e].pairParticipantIds.includes(t)||o[e].pairParticipantIds.push(t)}))}})),null===(t=e.tournamentEvents)||void 0===t||t.forEach((e=>{var t,n,i;const s=Ja(e,!0,!0),{eventId:c,eventName:d,eventType:p,category:m}=s,v={eventId:c,eventName:d,eventType:p,category:m},g=s&&Object.keys(s).filter((e=>"_"===e[0]));null==g||g.forEach((e=>v[e]=s[e]));const I=s.entries||[],y=[].concat(...Object.values(Ds)).map((e=>`_${e}`)),w=v&&Object.keys(v).filter((e=>!y.includes(e))).reduce(((e,t)=>(e[t]=v[t],e)),{});null==I||I.filter((e=>null==e?void 0:e.participantId)).forEach((e=>{const{participantId:t,entryStage:n,entryStatus:i,entryPosition:r}=e,a=l(t);null==a||a.forEach((({relevantParticipantId:e})=>{o[e].events[c]=h(f({},w),{partnerParticipantIds:[],entryPosition:r,entryStatus:i,entryStage:n,drawIds:[]})}))}));const U=(null===(t=s.drawDefinitions)||void 0===t?void 0:t.map((({drawId:e})=>e)))||[];null===(n=v._flightProfile)||void 0===n||null===(i=n.flights)||void 0===i||i.forEach((e=>{const{drawId:t,drawEntries:n}=e;U.includes(t)||null==n||n.forEach((e=>(({drawId:e,drawEntry:t,drawName:n,drawType:i})=>{const{participantId:a,entryStage:s,entryStatus:u,entryPosition:d}=t,p=l(a);null==p||p.forEach((({relevantParticipantId:t})=>{var a,l;o[t].events[c]||(o[t].events[c]=h(f({},w),{partnerParticipantIds:[],entryPosition:d,entryStatus:u,entryStage:s,drawIds:[]})),o[t].draws[e]||(o[t].draws[e]={qualifyingDrawSize:null===(a=r[e])||void 0===a?void 0:a.qualifyingDrawSize,drawSize:null===(l=r[e])||void 0===l?void 0:l.drawSize,partnerParticipantIds:[],entryPosition:d,entryStatus:u,entryStage:s,drawName:n,drawType:i,eventId:c,drawId:e});const p=o[t].events[c].drawIds;!p||null!=p&&p.includes(e)||o[t].events[c].drawIds.push(e)}))})({drawId:t,drawEntry:e})))}));const{matchUps:b}=El({tournamentRecord:a,nextMatchUps:!0,inContext:!0,event:s}),S=Object.assign({},...(s.drawDefinitions||[]).map((e=>{var t,n,i,o;const a=Object.assign({},...I.filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))),...e.entries.filter((e=>e.participantId)).map((e=>({[e.participantId]:e})))),s=Object.values(a),c=sd({stageSequence:1,drawDefinition:e,stage:eu}),u=c&&(null===(t=Hd({structure:c}))||void 0===t||null===(n=t.positionAssignments)||void 0===n?void 0:n.length),d=sd({stageSequence:1,drawDefinition:e,stage:tu}),l=c&&(null===(i=Hd({structure:d}))||void 0===i||null===(o=i.positionAssignments)||void 0===o?void 0:o.length);return r[e.drawId]={drawSize:u,qualifyingDrawSize:l},{[e.drawId]:{drawType:e.drawType,drawEntries:s}}})));null==b||b.forEach((e=>function({matchUp:e,drawDetails:t,eventType:n}){const{drawId:i,drawName:a,eventId:s,eventName:c,finishingPositionRange:d,loserTo:p,matchUpId:m,matchUpType:f,matchUpFormat:h,matchUpStatus:v,roundName:g,roundNumber:I,roundPosition:y,score:w,sides:U,schedule:b,structureName:S,structureId:P,tieFormat:D,tieMatchUps:N,tournamentId:M,winnerTo:T,winningSide:E}=e,{winner:A,loser:R}=d||{},C=(null==N?void 0:N.length)&&N.filter((({matchUpType:e})=>e===js)).map((({sides:e})=>e.map((({sideNumber:e,participantId:t})=>e&&t&&{sideNumber:e,participantId:t})))).flat().filter(Boolean);if(null==U||U.forEach((({participantId:d,sideNumber:N}={})=>{if(!d)return;const{drawType:x,drawEntries:O}=t[i],k=1===N?null==w?void 0:w.scoreStringSide1:null==w?void 0:w.scoreStringSide2,F=E&&N===E,L=e.sides.find((({sideNumber:e}={})=>e===3-N)),j=null==L?void 0:L.participantId,B=j&&u[j]||[],V=E&&(F?A:R),$=O.find((e=>e.participantId===d)),G=l(d).filter((e=>n!==Bs||n===Bs&&f===js||e.participantType!==pc));null==C||C.filter((e=>e.sideNumber===N)).forEach((({participantId:e})=>{e&&!G.includes(e)&&G.push({relevantParticipantId:e,participantType:pc})})),null==G||G.forEach((({relevantParticipantId:e,participantType:t})=>{const{entryStage:u,entryStatus:d,entryPosition:l}=$||{};var N,A;o[e].draws[i]||(o[e].draws[i]={qualifyingDrawSize:null===(N=r[i])||void 0===N?void 0:N.qualifyingDrawSize,drawSize:null===(A=r[i])||void 0===A?void 0:A.drawSize,partnerParticipantIds:[],entryPosition:l,entryStatus:d,entryStage:u,drawName:a,drawType:x,eventId:s,drawId:i}),o[e].events[s]||(o[e].events[s]={partnerParticipantIds:[],drawIds:[],eventName:c,eventId:s});const R=o[e].events[s].drawIds;let C;if(!R||null!=R&&R.includes(i)||o[e].events[s].drawIds.push(i),t===dc&&f===js){const t=G.find((t=>t.relevantParticipantId!==e&&t.participantType===dc));C=null==t?void 0:t.relevantParticipantId}null==B||B.filter((e=>t===dc||e.participantType===t)).forEach((({relevantParticipantId:t,participantType:n})=>{o[e].opponents[t]?o[e].opponents[t].push({eventId:s,drawId:i,matchUpId:m,participantType:n,participantId:t}):o[e].opponents[t]=[{eventId:s,drawId:i,matchUpId:m,participantType:n,participantId:t}]}));const O=B.map((({relevantParticipantId:e,participantType:t})=>({participantId:e,participantType:t})));o[e].matchUps[m]=Za({drawId:i,eventId:s,eventType:n,finishingPositionRange:V,loserTo:p,matchUpId:m,matchUpType:f,matchUpFormat:h,matchUpStatus:v,opponentParticipantInfo:O,participantWon:F,partnerParticipantId:C,perspectiveScoreString:k,roundName:g,roundNumber:I,roundPosition:y,schedule:b,score:w,sides:U,structureName:S,structureId:P,tieFormat:D,tournamentId:M,winnerTo:T,winningSide:E}),C&&(o[e].events[s].partnerParticipantIds.push(C),o[e].draws[i].partnerParticipantIds.push(C),o[e].events[s].partnerParticipantId=C,o[e].draws[i].partnerParticipantId=C),E&&(F?o[e].wins++:o[e].losses++)}))})),Array.isArray(e.potentialParticipants)){const t=Zu(e.potentialParticipants.flat());null==t||t.forEach((e=>{const t=l(e);null==t||t.forEach((({relevantParticipantId:e})=>{o[e].potentialMatchUps[m]=Za({drawId:i,eventId:s,eventType:n,matchUpId:m,matchUpType:f,matchUpFormat:h,roundName:g,roundNumber:I,roundPosition:y,schedule:b,tieFormat:D,structureName:S,potential:!0})}))}))}}({matchUp:e,drawDetails:S,eventType:p})))})),null===(n=e.tournamentParticipants)||void 0===n||n.forEach((t=>{const{scheduleConflicts:n,scheduleItems:r}=function({withEvents:e=!0,withDraws:t=!0,participantIdMap:n,scheduleAnalysis:i,withStatistics:r,withOpponents:o,withMatchUps:a,participant:s,withISO:c}){var u;const d=[],l=[];c&&hl({participant:s});const p=null===(u=s.timeItems)||void 0===u?void 0:u.filter((({itemType:e})=>e.startsWith(Cm)&&[Om,xm].includes(e.split(".")[1])));if(null!=p&&p.length){const e=e=>p.filter((t=>(null==t?void 0:t.itemType)===e)).sort(((e,t)=>new Date(e.createdAt||void 0)-new Date(t.createdAt||void 0))).pop();for(const t of bo(p.map((({itemType:e})=>e)))){const n=e(t);if(n){const[,e,t,i]=n.itemType.split("."),r=e===Om?"rankings":"ratings";s[r]||(s[r]={}),s[r][t]||(s[r][t]=[]),s[r][t].push({scaleValue:n.itemValue,scaleName:i})}}}const m=null==s?void 0:s.participantId;if(!m||!n[m])return{};const{wins:v,losses:g,matchUps:I,potentialMatchUps:y,events:w,draws:U,opponents:b}=n[m],S=v+g,P={statCode:"winRatio",numerator:v,denominator:S,statValue:S&&v/S},D=Object.values(U),N=Object.values(w);t&&D&&(s.draws=D),e&&N&&(s.events=N);const M=Object.values(b).flat();o&&null!=M&&M.length&&(s.opponents=M,null==D||D.forEach((e=>{e.opponents=M.filter((t=>t.drawId===e.drawId))})));const T=Object.values(y),E=Object.values(I);a&&(s.potentialMatchUps=T,s.matchUps=E);const A=E.concat(T),{scheduledMatchUps:R}=Dm({matchUps:A}),{scheduledMinutesDifference:C}=i||{};return Object.keys(R).forEach((e=>{R[e].forEach(((t,n)=>{const{schedule:{scheduledTime:i,timeAfterRecovery:r,typeChangeTimeAfterRecovery:o},matchUpStatus:a,matchUpId:s,roundNumber:c,roundPosition:u,structureName:p,matchUpType:m,drawId:v}=t;if(d.push(h(f({drawId:v,matchUpType:m,matchUpId:s,structureName:p,roundNumber:c,roundPosition:u},t.schedule),{scheduledTime:Ba(t.schedule.scheduledTime)})),i&&a!==qr){const c=La(i),u=R[e].slice(n+1);for(const e of u){var g;if(a!==qr&&null!==(g=e.schedule)&&void 0!==g&&g.scheduledTime){const n=t.matchUpType!==e.matchUpType&&o||r,i=t.drawId===e.drawId,a=t.potential&&e.potential,u=La(e.schedule.scheduledTime)-c;!(C&&!isNaN(C)?u<=C:La(n)>La(e.schedule.scheduledTime))||a&&i||l.push({priorScheduledMatchUpId:e.matchUpId,matchUpIdWithConflict:s})}}}}))})),null==D||D.forEach((e=>{const t=I&&E.filter((t=>t.drawId===e.drawId))||[],n=e=>Math.abs(e[0]-e[1]),i=t.reduce(((e,t)=>e?e&&t.finishingPositionRange&&n(e)>n(t.finishingPositionRange)?t.finishingPositionRange:e:t.finishingPositionRange),void 0);e.finishingPositionRange=i})),r&&(s.statistics=[P]),{scheduleConflicts:l,scheduleItems:d}}(h(f({},e),{participant:t,participantIdMap:o}));if(e.withScheduleItems&&(t.scheduleItems=r),e.scheduleAnalysis&&(t.scheduleConflicts=n,null!=n&&n.length&&(i.includes(t.participantId)||i.push(t.participantId))),!1!==e.withGroupings){const e=o[t.participantId];t.groupParticipantIds=e.groupParticipantIds,t.pairParticipantIds=e.pairParticipantIds,t.teamParticipantIds=e.teamParticipantIds,t.groups=e.groups,t.teams=e.teams}})),{participantIdsWithConflicts:i}}({tournamentEvents:r.events,tournamentParticipants:v,participantFilters:e,withScheduleItems:i,tournamentRecord:r,scheduleAnalysis:o,withStatistics:a,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l,withISO:m});I=null==t?void 0:t.participantIdsWithConflicts}const y=null==n?void 0:n.participant;return null!=y&&y.participant&&(v=v.map((e=>wo({source:e,template:y.participant})))),{tournamentParticipants:v,participantIdsWithConflicts:I}}function Bm(e,t,n){return!e&&t?t:e&&!t||"object"!=typeof e||"object"!=typeof t?e:bo(Object.keys(e).concat(Object.keys(t))).reduce(((i,r)=>{if(t[r])if(e[r])if(typeof e[r]!=typeof t[r])i[r]=t[r];else if(Array.isArray(e[r]))if(!0===n||Array.isArray(n)&&n.includes(r)){const n=bo(e[r].map((e=>JSON.stringify(e))).concat(t[r].map((e=>JSON.stringify(e))))).map((e=>JSON.parse(e)));i[r]=n}else i[r]=t[r];else"object"==typeof e[r]?i[r]=Bm(e[r],t[r],n):i[r]=t[r];else i[r]=t[r];else i[r]=e[r];return i}),{})}function Vm(e){return{tournamentIds:Object.keys(e).filter(Boolean)}}const $m=({penaltyId:e=es()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:e});function Gm({tournamentRecord:e,participantIds:t,penaltyCode:n,penaltyType:i,penaltyId:r,matchUpId:o,notes:a,extensions:s,issuedAt:c,refereeParticipantId:u}){if(!e)return{error:Lo};if(!t)return{error:"Missing participantId"};if(!i)return{error:"Missing penaltyType"};const d=((null==e?void 0:e.participants)||[]).filter((e=>t.includes(e.participantId)));if(!d.length)return{error:"Participant Not Found"};const l=(new Date).toISOString(),p=Object.assign($m({penaltyId:r}),{refereeParticipantId:u,penaltyCode:n,penaltyType:i,matchUpId:o,notes:a,issuedAt:c,createdAt:l});return Array.isArray(s)&&s.forEach((e=>ud({element:p,extension:e}))),d.forEach((e=>{e.penalties||(e.penalties=[]),e.penalties.push(p)})),la({topic:"modifyParticipants",payload:{participants:d}}),h(f({},ko),{penaltyId:p.penaltyId})}function _m({tournamentRecord:e,penaltyId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing penaltyId"};const n=(null==e?void 0:e.participants)||[],i=[];let r,o=!1;return n.forEach((e=>{let n=!1;e.penalties=(e.penalties||[]).filter((a=>(a.penaltyId===t&&(n=!0,o||(r=a,o=!0)),n&&i.push(e),a.penaltyId!==t)))})),r&&la({topic:"modifyParticipants",payload:{participants:i}}),r?h(f({},ko),{penalty:r}):{error:"Penalty not found"}}function Wm({tournamentRecord:e}){if(!e)return{error:Lo};const t=((null==e?void 0:e.participants)||[]).reduce(((e,t)=>{const{participantId:n}=t;return(t.penalties||[]).forEach((t=>{const{penaltyId:i}=t||{};e[i]?e[i].participants.push(n):e[i]=h(f({},t),{participantIds:[n]})})),e}),{});return{penalties:Object.values(t)}}function qm({tournamentRecord:e,penaltyId:t,modifications:n}){if(!e)return{error:Lo};if(!n)return{error:_o,modifications:n};if(!t)return{error:"Missing penaltyId"};const i=(null==e?void 0:e.participants)||[],r=Object.keys($m()).filter((e=>"penaltyId"!==e)),o=Object.keys(n).filter((e=>r.includes(e)));if(!o.length)return{error:"No valid attributes"};let a;const s=[];return i.forEach((e=>{let i=!1;e.penalties=(e.penalties||[]).map((e=>(e.penaltyId===t&&(i=!0,o.forEach((t=>Object.assign(e,{[t]:n[t]}))),a||(a=e)),e))),i&&s.push(e)})),a&&la({topic:"modifyParticipants",payload:{participants:s}}),a?h(f({},ko),{penalty:a}):{error:"Penalty not found"}}const zm={addExtension:Hl,findExtension:Kl,removeExtension:Yl,addEventExtension:function({tournamentRecords:e,eventId:t,extension:n}){if("string"!=typeof t)return{error:Vo};if(!cd(n))return{error:_o};for(const i of Object.values(e)){const{event:e}=_s({tournamentRecord:i,eventId:t});if(e)return md({event:e,extension:n})}return{error:"Event not found"}},linkTournaments:function({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const{tournamentIds:t,error:n}=Vm(e);return n?{error:n}:(null==t?void 0:t.length)>1?Hl({tournamentRecords:e,extension:{name:"linkedTournamentsIds",value:{tournamentIds:t}}}):ko},unlinkTournament:function({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e)return{error:_o};if(!t)return{error:"Missing tournamentId"};const{tournamentIds:n,error:i}=Vm(e);if(i)return{error:i};if(!n.includes(t))return{error:"Missing tournamentId"};let r;return n.every((n=>{var i;const o=e[n],{extension:a}=xs({tournamentRecord:o,name:"linkedTournamentsIds"});if(!a)return!0;let s=(null==a||null===(i=a.value)||void 0===i?void 0:i.tournamentIds)||[];if(null==s||!s.length||1===s.length&&s.includes(t)||n===t){const e=fd({tournamentRecord:o,name:"linkedTournamentsIds"});return e.error&&(r=e.error),e.success}const c=s.filter((e=>e!==t));a.value={tournamentIds:c};const u=ld({tournamentRecord:o,extension:a});return u.error&&(r=u.error),u.success})),r?{error:r}:f({},ko)},unlinkTournaments:function({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?Yl({tournamentRecords:e,name:"linkedTournamentsIds"}):{error:"Missing tournamentRecords"}},getLinkedTournamentIds:function({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?{linkedTournamentIds:Object.assign({},...Object.keys(e).map((t=>{var n;const i=e[t],r=null==i?void 0:i.tournamentId,{extension:o}=xs({tournamentRecord:i,name:"linkedTournamentsIds"});return{[t]:((null==o||null===(n=o.value)||void 0===n?void 0:n.tournamentIds)||[]).filter((e=>e!==r))}})))}:{error:"Missing tournamentRecords"}},addDrawDefinition:function({tournamentRecords:e,drawDefinition:t,tournamentId:n,eventId:i,flight:r,existingDrawCount:o}){if(!i)return{error:Vo};if(!(n=n||Fl({tournamentRecords:e,eventId:i})))return{error:"Missing tournamentId"};const a=e[n];if(!a)return{error:Lo};const{event:s,error:c}=_s({tournamentRecord:a,eventId:i});return c?{error:c}:wm({drawDefinition:t,event:s,flight:r,existingDrawCount:o})},getCompetitionParticipants:function(e){const{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};let n=[];const i=[],r=[];for(const o of Object.values(t)){const{tournamentParticipants:t,participantIdsWithConflicts:a}=jm(f({tournamentRecord:o},e));for(const e of t){const{participantId:t}=e;i.includes(t)?n=n.map((n=>n.participantId!==t?n:Bm(n,e,!0))):(i.push(t),n.push(e))}a&&a.forEach((e=>{r.includes(e)||r.push(e)}))}return{competitionParticipants:n,participantIdsWithConflicts:r}},addParticipant:function({tournamentRecords:e,returnParticipant:t,pairOverride:n,tournamentId:i,participant:r}){if("string"!=typeof i)return{error:"Missing tournamentId"};const o=e[i];return o?bm({returnParticipant:t,tournamentRecord:o,pairOverride:n,participant:r}):{error:Lo}},setMatchUpStatus:function(e){const t=e.tournamentRecords,n=e.tournamentId||Fl(e);if("string"!=typeof n)return{error:"Missing tournamentId"};const i=t[n];if(!i)return{error:Lo};const{drawDefinition:r,event:o}=_s({eventId:e.eventId,drawId:e.drawId,tournamentRecord:i});return om(h(f({tournamentRecord:i},e),{drawDefinition:r,event:o}))},bulkMatchUpStatusUpdate:function(e){const{tournamentRecords:t,outcomes:n}=e;if(!Array.isArray(n))return{error:$o};const i=n.reduce(((e,t)=>e.includes(t.tournamentId)?e:e.concat(t.tournamentId)),[]);for(const r of i){const e=t[r];if(!e)return{error:Lo};const i=n.filter((e=>e.tournamentId===r));if(i.length){const t=am({tournamentRecord:e,outcomes:i});if(t.error)return t}}return f({},ko)},bulkScheduleMatchUps:function({tournamentRecords:e,matchUpContextIds:t,schedule:n}){if(!e)return{error:"Missing tournamentRecords"};if(!Array.isArray(t))return{error:_o};for(const i of Object.values(e)){const{tournamentId:e}=i,r=t.filter((t=>t.tournamentId===e)).map(ed);if(null!=r&&r.length){const e=Ol({tournamentRecord:i,matchUpIds:r,schedule:n});if(e.error)return e}}return ko},addVenue:function({tournamentRecords:e,venue:t,disableNotice:n}){if("object"!=typeof t)return{error:_o};t.venueId||(t.venueId=es());for(const i of Object.values(e)){const e=Um({tournamentRecord:i,returnDetails:!0,disableNotice:!0,venue:t});if(null!=e&&e.error)return e}return n||la({topic:"addVenue",payload:{venue:t}}),ko},deleteVenue:function({tournamentRecords:e,venueId:t,force:n}){if(!e)return{error:"Missing tournamentRecords"};if("string"!=typeof t)return{error:"Missing venueId"};let i;for(const r of Object.values(e)){const e=ym({tournamentRecord:r,venueId:t,force:n});if(e.error&&"Venue not found"!==e.error)return e;i=!0}return ep({tournamentRecords:e}),i?ko:{error:"Venue not found"}},modifyVenue:function({tournamentRecords:e,modifications:t,venueId:n,force:i}){if(!e)return{error:"Missing tournamentRecords"};if("string"!=typeof n)return{error:"Missing venueId"};let r,o;for(const a of Object.values(e)){const e=gm({tournamentRecord:a,modifications:t,venueId:n,force:i});if(e.success&&(o=!0),e.error&&(r=e.error),e.error&&"Venue not found"!==e.error)return e}return ep({tournamentRecords:e}),o?f({},ko):{error:r}},addCourts:function(e){const{tournamentRecords:t,venueId:n}=e;if("string"!=typeof n||!n)return{error:"Missing venueId"};let i;for(const r of Object.values(t)){const{venue:t}=ec({tournamentRecord:r,venueId:n});if(t){const t=vm(f({tournamentRecord:r},e));if(t.error)return t;i=!0}}return i?ko:{error:"Venue not found"}},addPenalty:function(e){const{tournamentRecords:t,participantIds:n}=e;let i;for(const r of Object.values(t)){const{tournamentParticipants:t}=jm({tournamentRecord:r}),o=Zu(t).filter((e=>n.includes(e)));o.length&&(i=Gm(h(f({},e),{penaltyId:e.penaltyId||i,tournamentRecord:r,participantIds:o})).penaltyId)}return i?h(f({},ko),{penaltyId:i}):{error:"Participant Not Found"}},removePenalty:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};for(const n of Object.values(t)){const t=_m(f({tournamentRecord:n},e));if(t.error&&"Penalty not found"!==t.error)return t}return f({},ko)},modifyPenalty:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};for(const n of Object.values(t)){const t=qm(f({tournamentRecord:n},e));if(t.error&&"Penalty not found"!==t.error)return t}return f({},ko)},getCompetitionPenalties:function({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const t=[];for(const n of Object.values(e)){const{penalties:e}=Wm({tournamentRecord:n});t.push(...e)}return{penalties:t}},findParticipant:function({tournamentRecords:e,participantId:t,personId:n,policyDefinitions:i,inContext:r}){if(!e)return{error:"Missing tournamentRecords"};if("string"!=typeof t&&"string"!=typeof n)return{error:$o};let o;for(const a of Object.values(e)){const{tournamentParticipants:e}=jm({tournamentRecord:a,policyDefinitions:i,inContext:r});if(o=As({tournamentParticipants:e,participantId:t,personId:n,policyDefinitions:i}),o)break}return{participant:Ja(o,!1,!0)}}};function Hm(){const{topics:e}=fa();for(const t of e){const e=pa({topic:t});e&&ha({topic:t,notices:e})}}function Km({tournamentRecord:e,matchUpFormat:t,event:n}){if(!e)return{error:Lo};if(!$r(t))return{error:"Unrecognized matchUpFormat"};const{extension:i}=Os({event:n,name:"scheduleTiming"}),r=null==i?void 0:i.value,{extension:o}=xs({tournamentRecord:e,name:"scheduleTiming"}),a=null==o?void 0:o.value;return{matchUpFormat:t,averageTimes:[(null==r?void 0:r.matchUpAverageTimes)&&Ss(h(f({},r),{matchUpFormat:t})),(null==a?void 0:a.matchUpAverageTimes)&&Ss(h(f({},a),{matchUpFormat:t}))].find((e=>e)),recoveryTimes:[(null==r?void 0:r.matchUpRecoveryTimes)&&Ps(h(f({},r),{matchUpFormat:t})),(null==a?void 0:a.matchUpRecoveryTimes)&&Ps(h(f({},a),{matchUpFormat:t}))].find((e=>e))}}function Ym({tournamentRecord:e,matchUpFormat:t,averageTimes:n,recoveryTimes:i,event:r}){if(!e)return{error:Lo};if(n&&!Array.isArray(n))return{error:_o};if(i&&!Array.isArray(i))return{error:_o};const o="scheduleTiming";if(r){const{extension:e}=Os({event:r,name:o});md({event:r,extension:{name:o,value:Jm(h(f({},(null==e?void 0:e.value)||{}),{matchUpFormat:t,averageTimes:n,recoveryTimes:i}))}})}else{const{extension:r}=xs({tournamentRecord:e,name:o});ld({tournamentRecord:e,extension:{name:o,value:Jm(h(f({},(null==r?void 0:r.value)||{}),{matchUpFormat:t,averageTimes:n,recoveryTimes:i}))}})}return ko}function Jm({matchUpAverageTimes:e=[],matchUpRecoveryTimes:t=[],averageTimes:n,recoveryTimes:i,matchUpFormat:r}){var o,a;const s=(null===(o=n=(n||[]).filter((e=>{var t,n;return(null==e||null===(t=e.categoryNames)||void 0===t?void 0:t.length)||(null==e||null===(n=e.categoryTypes)||void 0===n?void 0:n.length)})))||void 0===o?void 0:o.length)&&e.map((e=>{var t;return null!=e&&e.matchUpFormatCodes.includes(r)?h(f({},e),{matchUpFormatCodes:null===(t=e.matchUpFormatCodes)||void 0===t?void 0:t.filter((e=>e!==r))}):e})).filter((({matchUpFormatCodes:e})=>null==e?void 0:e.length)).concat({matchUpFormatCodes:[r],averageTimes:n}),c=(null===(a=i=(i||[]).filter((e=>{var t,n;return(null==e||null===(t=e.categoryNames)||void 0===t?void 0:t.length)||(null==e||null===(n=e.categoryTypes)||void 0===n?void 0:n.length)})))||void 0===a?void 0:a.length)&&t.map((e=>{var t;return null!=e&&e.matchUpFormatCodes.includes(r)?h(f({},e),{matchUpFormatCodes:null===(t=e.matchUpFormatCodes)||void 0===t?void 0:t.filter((e=>e!==r))}):e})).filter((({matchUpFormatCodes:e,averageTimes:t})=>(null==e?void 0:e.length)||t)).concat({matchUpFormatCodes:[r],recoveryTimes:i});return{matchUpAverageTimes:(null==s?void 0:s.length)&&s||e,matchUpRecoveryTimes:(null==c?void 0:c.length)&&c||t}}function Zm({tournamentRecord:e,event:t,categoryType:n,matchUpFormat:i,averageMinutes:r,recoveryMinutes:o}){if(!e)return{error:Lo};if(!$r(i))return{error:_o};if(!t)return{error:Vo};const{averageTimes:a=[],recoveryTimes:s=[]}=Km({tournamentRecord:e,matchUpFormat:i,event:t}),c=t.category,u=(null==c?void 0:c.categoryName)||(null==c?void 0:c.ageCategoryCode),d="DOUBLES"===t.eventType;let l={categoryNames:[u],minutes:{}},p={categoryNames:[u],minutes:{}};const m=e=>{var t,i;if(null!==(t=e.categoryTypes)&&void 0!==t&&t.includes(n)&&console.log("encountered:",{categoryType:n}),null===(i=e.categoryNames)||void 0===i||!i.includes(u)||(e.categoryNames=e.categoryNames.filter((e=>e!==u)),l={minutes:e.minutes,categoryNames:[u]},e.categoryNames.length))return e},f=!isNaN(parseInt(r)),h=!isNaN(parseInt(o)),v=a.map(m).filter((e=>{var t;return null==e||null===(t=e.categoryNames)||void 0===t?void 0:t.length})),g=s.map(m).filter((e=>{var t;return null==e||null===(t=e.categoryNames)||void 0===t?void 0:t.length}));return f&&(Object.assign(l.minutes,{[d?Zs:Ls]:r}),v.push(l)),h&&(Object.assign(p.minutes,{[d?Zs:Ls]:o}),g.push(p)),f||h?Ym({tournamentRecord:e,event:t,matchUpFormat:i,averageTimes:f&&v,recoveryTimes:h&&g}):{error:_o}}function Qm({tournamentRecords:e,extensionName:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const n=[];let i;for(const r of Object.values(e)){const{extension:e}=xs({tournamentRecord:r,name:t});e&&!i&&(n.push({method:"addExtension",params:{extension:e}}),i=!0);const o=r.events||[];for(const i of o){const{eventId:e}=i,{extension:r}=Os({event:i,name:t});r&&n.push({method:"addEventExtension",params:{eventId:e,extension:r}})}}return{methods:n}}function Xm({tournamentRecord:e,matchUpFormats:t,categoryType:n,event:i}){if(!e)return{error:Lo};if(!i)return{error:Vo};let r=[];if(null!=t&&t.length){const e=[];r=t.map((t=>{let n="string"==typeof t?{matchUpFormat:t}:t;if(!e.includes(null==n?void 0:n.matchUpFormat)&&$r(null==n?void 0:n.matchUpFormat))return e.push(n.matchUpFormat),n})).filter(Boolean)}else{const{policy:t}=Es({policyType:"scoring",tournamentRecord:e,event:i});if(null!=t&&t.matchUpFormats)r=null==t?void 0:t.matchUpFormats;else{const{extension:e}=Os({name:"scheduleTiming",event:i});if(null==e||!e.value)return{error:"Missing scoring policy / matchUpFormats"};r=bo([...(e.value.matchUpAverageTimes||[]).map((e=>e.matchUpFormatCodes)),...(e.value.matchUpRecoveryTimes||[]).map((e=>e.matchUpFormatCodes))].flat()).map((e=>({matchUpFormat:e})))}}const{eventType:o,eventId:a,category:s}=i,c=null==s?void 0:s.categoryName;return a?{eventMatchUpFormatTiming:r.map((({matchUpFormat:t,description:r})=>{const a=$s({tournamentRecord:e,matchUpFormat:t,categoryName:c,categoryType:n,eventType:o,event:i});return Object.assign({},h(f({},a),{description:r,matchUpFormat:t}))}))}:{error:Vo}}function ef({tournamentRecord:e,drawDefinition:t,structureId:n,matchUpId:i,drawId:r,event:o}){var a,s,c;if(!e)return{error:Lo};if(!(r||o||n||i))return{error:$o};const u=xl({tournamentRecord:e,drawDefinition:t,matchUpId:i,drawId:r,event:o});if(i&&null!=u&&u.error)return u;!t&&null!=u&&u.drawDefinition&&(t=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&n&&!i){if(!t)return{error:"Missing drawId"};const e=ad({drawDefinition:t,structureId:n});if(e.error)return e;d=e.structure}const l=null===(a=d)||void 0===a?void 0:a.matchUpFormat,p=null===(s=t)||void 0===s?void 0:s.matchUpFormat,m=null==o?void 0:o.matchUpFormat;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:m,drawDefaultMatchUpFormat:p,matchUpFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.matchUpFormat)||l||p||m}}function tf({defaultRecoveryMinutes:e=0,defaultAverageMinutes:t,tournamentRecords:n,tournamentId:i,matchUpFormat:r,categoryName:o,categoryType:a,eventType:s,eventId:c}){var u,d,l,p;if(!$r(r))return{error:"Unrecognized matchUpFormat"};let m;return Object.keys(n).filter((e=>!i||e===i)).find((e=>{var t,i,u;const d=n[e],l=c&&(null===(t=_s({tournamentRecord:d,eventId:c}))||void 0===t?void 0:t.event);return m=$s({tournamentRecord:d,event:l,matchUpFormat:r,categoryName:o,categoryType:a,eventType:s}),(null===(i=m)||void 0===i?void 0:i.averageMinutes)||(null===(u=m)||void 0===u?void 0:u.recoveryMinutes)})),{averageMinutes:(null===(u=m)||void 0===u?void 0:u.averageMinutes)||t,recoveryMinutes:(null===(d=m)||void 0===d?void 0:d.recoveryMinutes)||e,typeChangeRecoveryMinutes:(null===(l=m)||void 0===l?void 0:l.typeChangeRecoveryMinutes)||(null===(p=m)||void 0===p?void 0:p.recoveryMinutes)||e}}function nf({scheduleCompletedMatchUps:e,containedStructureIds:t,tournamentRecords:n,periodLength:i=30,matchUps:r,rounds:o}){if("object"!=typeof n)return{error:"Missing tournamentRecords"};if(!Array.isArray(o))return{error:$o};const a=[],s=o.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0)));t=t||Object.assign({},...Object.values(n).map((e=>Fp({tournamentRecord:e}).containedStructures))),r||({matchUps:r}=np({tournamentRecords:n,nextMatchUps:!0}));const c={},u={},d={};let l=0;const p=s.map((o=>{var s,p,m;const h=o.periodLength||i,v=t[o.structureId]||[o.structureId],g={tournamentIds:[o.tournamentId],roundNumbers:[o.roundNumber],matchUpIds:o.matchUpIds,eventIds:[o.eventId],drawIds:[o.drawId],structureIds:v};let I=Qd(f({matchUps:r,processContext:!0},g)).sort(op);const{segmentNumber:y,segmentsCount:w}=o.roundSegment||{};if(Io(y)&&mo(null===(s=I)||void 0===s?void 0:s.length)&&mo(w)&&y>0&&y<=w&&w<(null===(p=I)||void 0===p?void 0:p.length)&&(null===(m=o.matchUpIds)||void 0===m||!m.length)){const e=I.length/w,t=e*(y-1);I=I.slice(t,t+e)}const U=n[o.tournamentId],{drawDefinition:b,event:S}=_s({drawId:o.drawId,tournamentRecord:U}),{matchUpFormat:P}=ef({structureId:o.structureId,tournamentRecord:U,drawDefinition:b,event:S}),{eventType:D,category:N}=S||{},{categoryName:M,ageCategoryCode:T}=N||{},{typeChangeRecoveryMinutes:E,recoveryMinutes:A,averageMinutes:R,error:C}=tf({tournamentRecords:n,categoryName:M||T,tournamentId:o.tournamentId,eventId:o.eventId,matchUpFormat:P,eventType:D});if(C)return{error:C,round:o};const x=I.filter((({matchUpStatus:t})=>(e||!ao.includes(t))&&t!==qr)).map(ed);return x.forEach((e=>{c[e]={typeChangeRecoveryMinutes:E,recoveryMinutes:A,averageMinutes:R},u[e]=A,d[e]=R})),a.push(...x),l=Math.max(R||0,l),{roundPeriodLength:h,recoveryMinutes:A,averageMinutes:R,matchUpIds:x,hash:`${R}|${h}`}}));return f({scheduledRoundsDetails:p,greatestAverageMinutes:l,recoveryMinutesMap:u,averageMinutesMap:d,orderedMatchUpIds:a,minutesMap:c},ko)}function rf({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=60,averageMatchUpMinutes:n=90,remainingScheduleTimes:i,clearScheduleDates:r,periodLength:o=30,tournamentRecords:a,scheduleDate:s,startTime:c,venueIds:u,endTime:d}){if("object"!=typeof a||!Object.keys(a).length)return{error:"Missing tournamentRecords"};const{courts:l,venues:p}=ql({tournamentRecords:a}),m=l.filter((e=>!u||u.includes(e.venueId)));c||(c=m.reduce(((e,t)=>{var n;const i=null===(n=t.dateAvailability)||void 0===n?void 0:n.find((e=>!e.date||Ka(s,e.date))),r=(null==i?void 0:i.startTime)||t.startTime;return r&&(!e||La(r)<La(e))?r:e}),void 0)),d||(d=m.reduce(((e,t)=>{var n;const i=null===(n=t.dateAvailability)||void 0===n?void 0:n.find((e=>!e.date||Ka(s,e.date))),r=(null==i?void 0:i.endTime)||t.endTime;return r&&(!e||La(r)>La(e))?r:e}),void 0));const v=Object.assign({},...Object.values(a).map((e=>(e.events||[]).map((t=>{const{scheduleTiming:n}=Fs({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:n}}})))).flat()),g=ip({tournamentRecords:a,sortDateMatchUps:!1,matchUpFilters:{scheduledDate:s,venueIds:u}}),I=[].concat(...g.dateMatchUps||[],...g.completedMatchUps||[]),y={averageTimes:[{minutes:{default:n}}],recoveryTimes:[{minutes:{default:t}}]},w=null==I?void 0:I.map((({eventId:e,schedule:t,matchUpFormat:n})=>{const{event:i,scheduleTiming:r}=v[e],a=null==i?void 0:i.eventType,s=h(f({},r),{defaultTiming:y,matchUpFormat:n}),{averageMinutes:c,recoveryMinutes:u}=Gs({eventType:a,timingDetails:s}),{courtId:d,venueId:l}=t,p=Ba(t.scheduledTime),m=qa(p,c);return{averageMinutes:c,recoveryMinutes:u,periodLength:o,startTime:p,endTime:m,courtId:d,venueId:l}})),U={calculateStartTimeFromCourts:e,remainingScheduleTimes:i,averageMatchUpMinutes:n,date:s,clearScheduleDates:r,periodLength:o,startTime:c,endTime:d,bookings:w,courts:m},{scheduleTimes:b}=Ru(U);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==p?void 0:p.length)?p[0].venueId:void 0,scheduleTimes:b,dateScheduledMatchUpIds:I.map(ed)}}function of({individualParticipantProfiles:e,participantId:t}){e[t]||(e[t]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function af({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUp:n,value:i}){const{matchUpType:r}=n,{individualParticipantIds:o}=Vl(n),a=(e[n.matchUpId]||[]).filter((e=>!Co(e,o))).flat();[...o,...a].forEach((e=>{if(of({individualParticipantProfiles:t,participantId:e}),!t[e].potentialCounted[n.drawId]){const o=t[e].counters;o[r]?o[r]+=i:i>0&&(o[r]=i),o[Vs]?o[Vs]+=i:i>0&&(o[Vs]=i),a.includes(e)&&(t[e].potentialCounted[n.drawId]=!0)}}))}function sf({matchUpScheduleTimes:e,matchUpDependencies:t,allDateMatchUpIds:n,matchUp:i}){var r;const o=((null==t||null===(r=t[i.matchUpId])||void 0===r?void 0:r.matchUpIds)||[]).filter((e=>n.includes(e))).filter((t=>!e[t]));return{dependenciesScheduled:!(null!=o&&o.length),remainingDependencies:o}}function cf({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:t,timeAfterRecovery:n,matchUp:i}){var r,o,a,s;const{individualParticipantIds:c}=Vl(i);n=n||(null===(r=i.schedule)||void 0===r?void 0:r.timeAfterRecovery);const u=t=>{e[t]||(e[t]=[]),e[t]=bo(e[t].concat(...c))},d=e=>{(!t[e]||n>t[e])&&(t[e]=n)},l=(null===(o=i.winnerTo)||void 0===o?void 0:o.matchUpId)||i.winnerMatchUpId;l&&(n&&d(l),u(l));const p=(null===(a=i.loserTo)||void 0===a?void 0:a.matchUpId)||i.loserMatchUpId;p&&(n&&d(p),u(p)),null!==(s=i.sidesTo)&&void 0!==s&&s.length&&i.sidesTo.forEach((({matchUpId:e})=>{e&&(n&&d(e),u(e))}))}function uf({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUpDependencies:i,averageMatchUpMinutes:r=0,typeChangeRecoveryMinutes:o,recoveryMinutes:a=0,scheduleTime:s,matchUp:c}){var u,d;const l=Ba(null==c||null===(u=c.schedule)||void 0===u?void 0:u.endTime),p=l?qa(l,parseInt(a)):qa(s,parseInt(r)+parseInt(a)),m=o&&(l?qa(Ba(l),o):qa(s,parseInt(r)+parseInt(o))),f=(null==i||null===(d=i[c.matchUpId])||void 0===d?void 0:d.participantIds)||[],h=(c.roundPosition&&t[c.matchUpId]||[]).flat();f.forEach((t=>{of({individualParticipantProfiles:e,participantId:t});const n=e[t].priorMatchUpType!==c.matchUpType&&m||p;h.includes(t)?function({individualParticipantProfiles:e,recoveryValue:t,participantId:n,scheduleTime:i,drawId:r}){e[n].potentialRecovery[r]||(e[n].potentialRecovery[r]=[]),e[n].potentialRecovery[r].push(t),e[n].potentialBookings[r]||(e[n].potentialBookings[r]=[]),e[n].potentialBookings[r].push({timeAfterRecovery:t,scheduleTime:i})}({individualParticipantProfiles:e,drawId:c.drawId,recoveryValue:n,participantId:t,scheduleTime:s}):(e[t].timeAfterRecovery=n,e[t].bookings.push({scheduleTime:s,timeAfterRecovery:n}))})),cf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:p,matchUp:c})}function df({matchUpScheduleTimes:e,matchUpDependencies:t,scheduleTime:n,matchUpId:i,details:r}){var o,a,s,c,u;let d;const l=null===(o=r.minutesMap)||void 0===o||null===(a=o[i])||void 0===a?void 0:a.recoveryMinutes,p=qa(n,((null===(s=r.minutesMap)||void 0===s||null===(c=s[i])||void 0===c?void 0:c.averageMinutes)||0)+(l||0)),m=(null==t||null===(u=t[i])||void 0===u?void 0:u.dependentMatchUpIds)||[];if(m.length){const t=m.reduce(((t,n)=>{const i=e[n];if(!i)return t;const r={scheduleTime:i,matchUpId:n};return i&&!t.matchUpId||La(i)<La(t.scheduleTime)?r:t}),{});t.scheduleTime&&La(p)>La(t.scheduleTime)&&(d=t)}return{scheduledDependent:d}}function lf({averageMatchUpMinutes:e=90,requestConflicts:t={},potentials:n=!0,personRequests:i,scheduleTime:r,scheduleDate:o,matchUp:a}){const s=function(e){const{sides:t,matchUpType:n}=e||{};return(t||[]).map((e=>{var t;return n===js?(null==e||null===(t=e.participant)||void 0===t?void 0:t.individualParticipants)||[]:null!=e&&e.participant?[e.participant]:[]})).flat()}(a).map((({person:e})=>null==e?void 0:e.personId));if(n){const e=((null==a?void 0:a.potentialParticipants)||[]).flat().map((({person:e})=>null==e?void 0:e.personId));s.push(...e)}const c=s.map((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.map((t=>h(f({},t),{personId:e})))})).filter(Boolean).flat().filter((e=>"DO_NOT_SCHEDULE"===e.requestType&&Ka(o,e.date))),u=[],d=null==a?void 0:a.matchUpId,l=_a(Ba(r),Va(o)),p=Ba(za(l,e).toISOString());for(const m of c){const{requestId:e,startTime:n,endTime:i}=m;(r>n&&r<i||p>n&&p<i)&&(u.push({matchUpId:d,request:m,scheduleTime:r}),t[e]?(t[e].scheduleTimes.includes(r)||t[e].scheduleTimes.push(r),t[e].matchUpIds.includes(d)||t[e].matchUpIds.push(d)):t[e]={request:m,scheduleTimes:[r],matchUpIds:[d]})}return{conflicts:u}}function pf({individualParticipantProfiles:e,matchUpNotBeforeTimes:t,matchUpDependencies:n,scheduleTime:i,matchUp:r,details:o}){var a,s,c,u,d;const l=((null==n||null===(a=n[r.matchUpId])||void 0===a?void 0:a.participantIds)||[]).flat(),p=(null==o||null===(s=o.minutesMap)||void 0===s||null===(c=s[r.matchUpId])||void 0===c?void 0:c.averageMinutes)||0,m=(null==o||null===(u=o.minutesMap)||void 0===u||null===(d=u[r.matchUpId])||void 0===d?void 0:d.recoveryMinutes)||0,f=l.every((t=>{var n;of({individualParticipantProfiles:e,participantId:t});let o=e[t];if(!o.timeAfterRecovery)return!0;const a=Ba(null==r||null===(n=r.schedule)||void 0===n?void 0:n.endTime),s=a?qa(a,parseInt(m)):qa(i,parseInt(p)+parseInt(m));return![...Object.keys(o.potentialBookings).filter((e=>e!==r.drawId)).map((e=>o.potentialBookings[e])).flat(),...o.bookings].find((e=>function(e,t){const n=La(e.scheduleTime),i=La(e.timeAfterRecovery),r=La(t.scheduleTime),o=La(t.timeAfterRecovery),a=n>r&&n<o,s=r>n&&r<i,c=i>r&&i<o,u=o>n&&o<i;return Za({hasOverlap:n===r||i===o||a||c||s||u,startAisContained:a,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:i,timeAfterRecovery:s},e).hasOverlap))})),h=t[r.matchUpId],v=h?Wa(_a(h),_a(i),!1):0;return{enoughTime:f&&v>=0}}function mf({scheduledRoundsDetails:e,greatestAverageMinutes:t,garmanSinglePass:n}){let i,r,o,a,s=[],c=[];for(const u of e)i||(i=u.hash),(u.hash===i||n)&&(s=s.concat(u.matchUpIds)),u.hash===i||n||(i=u.hash,c.push({averageMinutes:r,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:s}),s=u.matchUpIds),r=n?t:u.averageMinutes,o=u.recoveryMinutes,a=u.roundPeriodLength;return s.length&&c.push({averageMinutes:r,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:s}),{groupedRounds:c}}function ff({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpDailyLimits:n={},matchUp:i}){const{matchUpId:r,matchUpType:o}=i,{enteredIndividualParticipantIds:a}=Vl(i),s=(i.roundPosition&&t[r]||[]).flat(),c=bo(a.concat(...s));return c.forEach((t=>{of({individualParticipantProfiles:e,participantId:t})})),{participantIdsAtLimit:c.filter((t=>{const i=e[t];if(i)return[o,Vs].find((e=>{const t=i.counters&&i.counters[e]||0,r=n[e]||0;return t&&r&&t>=r}))})),relevantParticipantIds:c}}function hf({tournamentRecords:e,requestType:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const n={};for(const i of Object.values(e)){const{extension:e}=xs({tournamentRecord:i,name:"personRequests"}),r=(null==e?void 0:e.value)||[];for(const i of r){const{personId:e,requests:r}=i||{};n[e]||(n[e]=[]);for(const i of r)t&&i.requestType!==t||n[e].push(i)}}return{personRequests:n}}function vf({tournamentRecords:e,personRequests:t}){if(!e)return{error:"Missing tournamentRecords"};for(const n of Object.values(e)){const{participants:e}=n,i=[];for(const n of Object.keys(t))if(As({tournamentParticipants:e,personId:n})){const e=t[n];e.length&&i.push({personId:n,requests:e})}Object.keys(i).length&&ld({tournamentRecord:n,extension:{name:"personRequests",value:i}})}return ko}function gf({personRequests:e,personId:t,requests:n}){e[t]||(e[t]=[]);const i=n.filter((({requestType:e})=>e)).map((e=>{let{date:t,requestType:n,startTime:i,endTime:r}=e;return"DO_NOT_SCHEDULE"===n&&(t=Va(t),i=Ba(i),r=Ba(r),t&&i&&r)?{date:t,startTime:i,endTime:r,requestType:n}:e})).filter(Boolean);for(const r of i)r.requestId=Uo(),e[t].push(r);return{mergeCount:i.length}}function If({scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:t=ao,tournamentRecord:n,scheduledDates:i,venueIds:r=[]}){if("object"!=typeof n)return{error:Lo};if(!Array.isArray(t)||!Array.isArray(r))return{error:_o};r.length&&e.push("venueId");const{matchUps:o}=Ml({matchUpFilters:{scheduledDates:i},tournamentRecord:n});return Ol({schedule:{venueId:"",scheduledDate:"",scheduledTime:""},matchUpIds:o.filter((n=>!t.includes(n.matchUpStatus)&&Pm({schedule:n.schedule,scheduleAttributes:e})&&(!(null!=r&&r.length)||r.includes(n.schedule.venueId)))).map(ed),tournamentRecord:n})}function yf({scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:t=ao,tournamentRecords:n,scheduledDates:i,venueIds:r}){const o="object"==typeof n&&Object.values(n).map((({tournamentId:e})=>e)).filter(Boolean);if(null==o||!o.length)return{error:"Missing tournamentRecords"};for(const a of o){const o=If({ignoreMatchUpStatuses:t,scheduleAttributes:e,tournamentRecord:n[a],scheduledDates:i,venueIds:r});if(o.error)return o}return f({},ko)}function wf({tournamentRecord:e}){var t;if(!e)return{error:Lo};const{policy:n}=Es({policyType:"scheduling",tournamentRecord:e}),{extension:i}=xs({tournamentRecord:e,name:"scheduleLimits"}),r=null==i||null===(t=i.value)||void 0===t?void 0:t.dailyLimits,o=null==n?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:r||o}}function Uf({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};let n;return Object.keys(e).filter((e=>!t||e===t)).find((t=>{const i=e[t],{matchUpDailyLimits:r}=wf({tournamentRecord:i});return n=r,!0})),{matchUpDailyLimits:n}}function bf({defaultRecoveryMinutes:e=0,averageMatchUpMinutes:t=90,periodLength:n=30,tournamentRecords:i,venueIds:r=[],scheduleDate:o,matchUps:a}){if("object"!=typeof i)return{error:"Missing tournamentRecords"};if(!Array.isArray(a))return{error:"Missing matchUps"};const s=Object.assign({},...Object.values(i).map((e=>(e.events||[]).map((t=>{const{scheduleTiming:n}=Fs({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:n}}})))).flat()),c={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},u=null==a?void 0:a.filter((e=>Pm(e)&&(!o||e.schedule.scheduledDate===o))),d=null==u?void 0:u.filter((e=>!r.length||r.includes(e.schedule.venueId)));return{bookings:null==u?void 0:u.map((({eventId:e,schedule:t,matchUpFormat:i})=>{const{event:r,scheduleTiming:o}=s[e],a=null==r?void 0:r.eventType,u=h(f({},o),{defaultTiming:c,matchUpFormat:i}),{averageMinutes:d,recoveryMinutes:l}=Gs({eventType:a,timingDetails:u}),{courtId:p,venueId:m}=t,v=Ba(t.scheduledTime),g=qa(v,d);return{averageMinutes:d,recoveryMinutes:l,periodLength:n,startTime:v,endTime:g,courtId:p,venueId:m}})).filter(Boolean),relevantMatchUps:d,dateScheduledMatchUps:u}}function Sf({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=60,averageMatchUpMinutes:n=90,remainingScheduleTimes:i,clearScheduleDates:r,periodLength:o=30,tournamentRecords:a,scheduleDate:s,startTime:c,venueIds:u,matchUps:d,endTime:l}){if("object"!=typeof a||!Object.keys(a).length)return{error:"Missing tournamentRecords"};const{courts:p,venues:m}=ql({tournamentRecords:a}),f=p.filter((e=>!u||u.includes(e.venueId)));c||(c=f.reduce(((e,t)=>{var n;const i=null===(n=t.dateAvailability)||void 0===n?void 0:n.find((e=>!e.date||Ka(s,e.date))),r=(null==i?void 0:i.startTime)||t.startTime;return r&&(!e||La(r)<La(e))?r:e}),void 0)),l||(l=f.reduce(((e,t)=>{var n;const i=null===(n=t.dateAvailability)||void 0===n?void 0:n.find((e=>!e.date||Ka(s,e.date))),r=(null==i?void 0:i.endTime)||t.endTime;return r&&(!e||La(r)>La(e))?r:e}),void 0));const{bookings:h,dateScheduledMatchUps:v}=bf({defaultRecoveryMinutes:t,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:s,periodLength:o,venueIds:u,matchUps:d}),g={calculateStartTimeFromCourts:e,remainingScheduleTimes:i,averageMatchUpMinutes:n,clearScheduleDates:r,date:s,periodLength:o,startTime:c,endTime:l,bookings:h,courts:f},{scheduleTimes:I}=Ru(g);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==m?void 0:m.length)?m[0].venueId:void 0,scheduleTimes:I,dateScheduledMatchUpIds:v.map(ed)}}function Pf({checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:t,clearScheduleDates:n,scheduleDates:i=[],tournamentRecords:r,periodLength:o,dryRun:a}){return function({checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:t,clearScheduleDates:n,scheduleDates:i=[],tournamentRecords:r,periodLength:o,dryRun:a}){if(!r)return{error:"Missing tournamentRecords"};if(!Array.isArray(i))return{error:_o};const{schedulingProfile:s=[],issues:c=[],modifications:u}=Jl({tournamentRecords:r}),d=Object.assign({},...Object.values(r).map((e=>Fp({tournamentRecord:e}).containedStructures))),l=i.map((e=>{if(Ta(e))return Va(e)})).filter(Boolean),p=s.map((e=>e.scheduleDate)).map((e=>Ta(e)&&Va(e))).filter((e=>e&&(!i.length||l.includes(e))));if(!p.length)return{error:"No valid dates"};if(n&&!a){const e=Array.isArray(n)?n:void 0;yf({tournamentRecords:r,scheduledDates:e})}const{courts:m}=ql({tournamentRecords:r}),{matchUps:v}=np({tournamentRecords:r,nextMatchUps:!0}),{matchUpDependencies:g}=ap({includeParticipantDependencies:!0,tournamentRecords:r,matchUps:v}),{matchUpDailyLimits:I}=Uf({tournamentRecords:r}),{personRequests:y}=hf({requestType:"DO_NOT_SCHEDULE",tournamentRecords:r}),w=s.filter((e=>{const t=Va(null==e?void 0:e.scheduleDate);return p.includes(t)})).sort(((e,t)=>{new Date(e.scheduleDate).getTime(),new Date(t.scheduleDate).getTime()})),U={},b={},S={},P={},D={},N={},M={},T={},E={},A={};for(const f of w){const i=Va(null==f?void 0:f.scheduleDate),s=(null==f?void 0:f.venues)||[],c={},u={},l={},p=(e,t)=>{e.forEach((e=>{const n=l[e].counters;n[t]?n[t]+=1:n[t]=1,n[Vs]?n[Vs]+=1:n[Vs]=1}))};S[i]={},P[i]={},U[i]={},b[i]={},M[i]=[],T[i]=[],E[i]=[],A[i]=[];const h={};v.forEach((e=>{var t;null!==(t=e.schedule)&&void 0!==t&&t.scheduledDate&&Ka(i,Va(e.schedule.scheduledDate))&&cf({matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:h,matchUp:e})}));const w=[];for(const e of s){var R;const{rounds:a=[],venueId:s}=e,{scheduledRoundsDetails:p,greatestAverageMinutes:f,orderedMatchUpIds:I,minutesMap:y}=nf({scheduleCompletedMatchUps:t,containedStructureIds:d,tournamentRecords:r,periodLength:o,matchUps:v,rounds:a});w.push(...I);const{groupedRounds:U}=mf({scheduledRoundsDetails:p,greatestAverageMinutes:f,garmanSinglePass:!0}),{scheduleTimes:b,dateScheduledMatchUpIds:S}=Sf({averageMatchUpMinutes:null===(R=U[0])||void 0===R?void 0:R.averageMinutes,scheduleDate:Va(i),venueIds:[e.venueId],clearScheduleDates:n,tournamentRecords:r,periodLength:o,matchUps:v}),P=Array.isArray(n)?n.includes(i):n,D=P?[]:v.filter((({matchUpId:e})=>S.includes(e)));for(const e of D){var C;af({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,scheduleDate:i,matchUp:e,value:1});const t=null===(C=e.schedule)||void 0===C?void 0:C.scheduledTime;if(t){var x;N[e.matchUpId]=t;const n=null==y||null===(x=y[e.matchUpId])||void 0===x?void 0:x.recoveryMinutes;uf({individualParticipantProfiles:l,matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:h,matchUpDependencies:g,recoveryMinutes:n,averageMatchUpMinutes:f,scheduleDate:i,scheduleTime:t,matchUp:e})}}let M=I.map((e=>v.find((t=>t.matchUpId===e)))).filter(Boolean).filter((e=>{const n=!P&&S.includes(e.matchUpId),i=[qr,Kr,Hr,Wr,Qr,to].includes(null==e?void 0:e.matchUpStatus);return t||!n&&!e.winningSide&&!i}));const{matchUpMap:T}=M.reduce(((e,t)=>{const{drawId:n,tournamentId:i}=t;return e.matchUpMap[i]||(e.matchUpMap[i]={}),e.matchUpMap[i][n]?e.matchUpMap[i][n].push(t):e.matchUpMap[i][n]=[t],cf({matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:h,matchUp:t}),e}),{matchUpMap:{}});u[s]={courtsCount:m.filter((e=>e.venueId===s)).length,previousRemainingScheduleTimes:[],greatestAverageMinutes:f,scheduledRoundsDetails:p,matchUpsToSchedule:M,scheduleTimes:b,groupedRounds:U,minutesMap:y,matchUpMap:T}}const V=10;let $,G=0,_=10;for(;!$;){for(const{venueId:t}of s){var O,k,F;let n=0;const r=u[t];for(;r.courtsCount&&null!==(L=r.scheduleTimes)&&void 0!==L&&L.length&&null!==(j=r.matchUpsToSchedule)&&void 0!==j&&j.length&&n<=r.courtsCount;){var L,j;const{scheduleTime:o,attempts:a=0}=r.scheduleTimes.shift(),s=r.matchUpsToSchedule.find((t=>{var n,a;const{matchUpId:s,matchUpType:u}=t,{participantIdsAtLimit:d,relevantParticipantIds:m}=ff({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,matchUpDailyLimits:I,matchUp:t});if(d.length)return T[i].includes(s)||T[i].push(s),!1;const{scheduledDependent:f}=df({matchUpScheduleTimes:N,matchUpDependencies:g,scheduleTime:o,matchUpId:s,details:r});if(f)return!1;const{dependenciesScheduled:U,remainingDependencies:b}=sf({matchUpScheduleTimes:N,matchUpDependencies:g,allDateMatchUpIds:w,matchUps:v,matchUp:t});if(!U)return P[i][s]||(P[i][s]=[]),P[i][s].push({scheduleTime:o,remainingDependencies:b}),!1;const{enoughTime:M}=pf({individualParticipantProfiles:l,matchUpNotBeforeTimes:h,matchUpDependencies:g,scheduleTime:o,details:r,matchUp:t});if(!M)return S[i][s]||(S[i][s]=[]),S[i][s].push({scheduleTime:o}),!1;const E=r.greatestAverageMinutes,{conflicts:R}=lf({potentials:e,averageMatchUpMinutes:E,requestConflicts:A,personRequests:y,scheduleTime:o,scheduleDate:i,matchUp:t});if(null!=R&&R.length)return D[i]||(D[i]=[]),D[i].push(...R),!1;p(m,u);const C=null===(n=r.minutesMap)||void 0===n||null===(a=n[s])||void 0===a?void 0:a.recoveryMinutes;return uf({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,matchUpNotBeforeTimes:h,averageMatchUpMinutes:E,matchUpDependencies:g,recoveryMinutes:C,scheduleDate:i,scheduleTime:o,matchUp:t}),N[s]=o,!0}));r.matchUpsToSchedule=r.matchUpsToSchedule.filter((({matchUpId:e})=>e!==(null==s?void 0:s.matchUpId))),s?n+=1:(b[i][t]||(b[i][t]=[]),b[i][t].push({scheduleTime:o,attempts:a+1}))}var B;null!==(O=r.matchUpsToSchedule)&&void 0!==O&&O.length&&(b[i][t]=null===(B=b[i][t])||void 0===B?void 0:B.filter((e=>{const t=e.attempts<_;return t&&r.scheduleTimes.push(e),!t}))),null!==(k=r.scheduleTimes)&&void 0!==k&&k.length&&null!==(F=r.matchUpsToSchedule)&&void 0!==F&&F.length||(r.complete=!0)}G+=1,$=s.every((({venueId:e})=>u[e].complete))||G===V}for(const{venueId:e}of s){const t=u[e].matchUpMap;Object.keys(t).forEach((n=>{const o=r[n];o&&Object.keys(t[n]).forEach((r=>{const{drawDefinition:s}=Ws({tournamentRecord:o,drawId:r});s&&t[n][r].forEach((({matchUpId:t})=>{const n=N[t];if(n){const r=n.split(":").map(Ha).join(":"),c=`${Va(i)}T${r}`;a?M[i].push(t):(cl({drawDefinition:s,scheduledTime:c,matchUpId:t}).success&&M[i].push(t),e&&nl({tournamentRecord:o,drawDefinition:s,matchUpId:t,venueId:e}))}}))}))})),E[i]=u[e].matchUpsToSchedule.map(ed),U[i][e]=u[e].scheduleTimes.sort(((e,t)=>La(e.scheduleTime)-La(t.scheduleTime)))}}const V=w.map((({scheduleDate:e})=>e)),$={timeStamp:Date.now(),schedulingProfile:s,scheduledDates:V,noTimeMatchUpIds:E,scheduledMatchUpIds:M,overLimitMatchUpIds:T,requestConflicts:A},{topics:G}=fa();if(G.includes("audit"))la({topic:"audit",payload:$});else{const e={itemType:"autoSchedulingAudit",itemValue:$};for(const t of Object.values(r))Bu({tournamentRecord:t,timeItem:e})}return h(f({},ko),{schedulingProfileModifications:u,schedulingProfileIssues:c,scheduleTimesRemaining:U,dateSchedulingProfiles:w,skippedScheduleTimes:b,recoveryTimeDeferredMatchUpIds:S,dependencyDeferredMatchUpIds:P,matchUpScheduleTimes:N,scheduledMatchUpIds:M,overLimitMatchUpIds:T,noTimeMatchUpIds:E,requestConflicts:A,scheduledDates:V})}({checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:t,clearScheduleDates:n,tournamentRecords:r,scheduleDates:i,periodLength:o,dryRun:a})}function Df({event:e}){return e?hd({event:e,name:"scheduleTiming"}):{error:Vo}}function Nf({tournamentParticipants:e,drawDefinition:t,participantId:n,matchUpId:i,event:r}){if(!n)return{error:"Missing participantId"};if(!i)return{error:"Missing matchUp"};if(e&&e.length){const{matchUp:o}=el({tournamentParticipants:e,inContext:!0,drawDefinition:t,matchUpId:i,event:r});if(!o)return{error:"matchUp not found"};const{error:a,checkedInParticipantIds:s,allRelevantParticipantIds:c}=Zd({matchUp:o});if(!c.includes(n))return{error:"Invalid participantId"};if(a)return{error:a};if(s.includes(n))return{error:"Participant already checked in"}}return tl({drawDefinition:t,matchUpId:i,timeItem:{itemType:ds,itemValue:n}})}function Mf({tournamentParticipants:e,drawDefinition:t,participantId:n,matchUpId:i,event:r}){if(!n)return{error:"Missing participantId"};if(!i)return{error:"Missing matchUpId"};if(e&&e.length){const{matchUp:o}=el({tournamentParticipants:e,inContext:!0,drawDefinition:t,matchUpId:i,event:r}),{checkedInParticipantIds:a,allRelevantParticipantIds:s}=Zd({matchUp:o});if(!s.includes(n))return{error:"Invalid participantId"};if(!a.includes(n))return{error:"Participant not checked in"};const{sideParticipantIds:c,nestedIndividualParticipantIds:u}=Jd({matchUp:o}),d=c.indexOf(n);[0,1].includes(d)&&(u[d]||[]).forEach((e=>{tl({drawDefinition:t,matchUpId:i,timeItem:{itemType:ls,itemValue:e}})}))}return tl({drawDefinition:t,matchUpId:i,timeItem:{itemType:ls,itemValue:n}})}function Tf(e){if(null==e||!e.tournamentRecord)return{error:Lo};const{tournamentRecord:t,participantId:n,matchUpId:i,drawDefinition:r}=e,o=t.participants||[],{matchUp:a}=xl({tournamentRecord:t,drawDefinition:r,matchUpId:i,inContext:!0});if(!a)return{error:"matchUp not found"};const{checkedInParticipantIds:s=[]}=Zd({matchUp:a});return s.includes(n)?Mf({drawDefinition:r,tournamentParticipants:o,matchUpId:i,participantId:n}):Nf({drawDefinition:r,tournamentParticipants:o,matchUpId:i,participantId:n})}function Ef(e){const{tournamentRecords:t}=e;if(!t)return{error:"Missing tournamentRecords"};const{tournamentId:n,drawId:i,matchUpId:r,courtDayDate:o}=e,a=t[n];if(!a)return{error:Lo};const{drawDefinition:s}=Ws({tournamentRecord:a,drawId:i});return il({tournamentRecord:a,drawDefinition:s,matchUpId:r,courtId:"",courtDayDate:o})}const Af="COMPETITOR",Rf={OTHER:"OTHER",COACH:"COACH",MEDIA:"MEDIA",CAPTAIN:"CAPTAIN",MEDICAL:"MEDICAL",OFFICIAL:"OFFICIAL",SECURITY:"SECURITY",COMPETITOR:Af,ADMINISTRATION:"ADMINISTRATION"};function Cf(e){return al(e)}function xf({drawDefinition:e,matchUpId:t,disableNotice:n,scheduledDate:i}){return sl({drawDefinition:e,matchUpId:t,disableNotice:n,scheduledDate:i})}function Of({drawDefinition:e,scheduledTime:t,matchUpId:n,disableNotice:i}){return cl({drawDefinition:e,matchUpId:n,scheduledTime:t,disableNotice:i})}function kf({drawDefinition:e,matchUpId:t,startTime:n,disableNotice:i}){return dl({drawDefinition:e,matchUpId:t,startTime:n,disableNotice:i})}function Ff({drawDefinition:e,matchUpId:t,endTime:n,disableNotice:i}){return ll({drawDefinition:e,matchUpId:t,endTime:n,disableNotice:i})}function Lf({drawDefinition:e,matchUpId:t,stopTime:n,disableNotice:i}){return pl({drawDefinition:e,matchUpId:t,stopTime:n,disableNotice:i})}function jf({drawDefinition:e,matchUpId:t,resumeTime:n,disableNotice:i}){return ml({drawDefinition:e,matchUpId:t,resumeTime:n,disableNotice:i})}function Bf({tournamentRecord:e,drawDefinition:t,participantId:n,officialType:i,matchUpId:r,disableNotice:o}){if(!n)return{error:"Missing participantId"};const{tournamentParticipants:a}=jm({tournamentRecord:e,participantFilters:{participantTypes:[dc],participantRoles:["OFFICIAL"]}});return As({tournamentParticipants:a,participantId:n})?ul({drawDefinition:t,participantId:n,officialType:i,matchUpId:r,disableNotice:o}):{error:"Participant Not Found"}}function Vf({tournamentRecord:e,scheduleChange:t,matchUpIds:n,dryRun:i}){if(!e)return{error:Lo};if(!n||!Array.isArray(n))return{error:"Missing matchUpIds"};if("object"!=typeof t)return{error:_o};const r=[],o=[],{minutesChange:a,daysChange:s}=t;if(!a&&!s)return f({},ko);if(a&&isNaN(a))return{error:_o};if(s&&isNaN(s))return{error:_o};const{matchUps:c}=Ml({tournamentRecord:e,matchUpFilters:{matchUpIds:n}}),u=null==c?void 0:c.filter(Pm).filter((({matchUpStatus:e})=>!ao.includes(e)));if(!u.length)return f({},ko);const{tournamentInfo:d}=_l({tournamentRecord:e}),{startDate:l,endDate:p}=d,m=u.reduce(((e,t)=>{const{matchUpId:n,drawId:i}=t;return e[i]?e[i].push(n):e[i]=[n],e}),{});for(const f of Object.keys(m)){const{drawDefinition:t,error:c}=Ws({tournamentRecord:e,drawId:f});if(c)return{error:c};const d=m[f].filter((e=>n.includes(e)));for(const e of d)if(e&&t){const n=u.find((t=>t.matchUpId===e)),c=n.schedule,{scheduledTime:d,scheduledDate:m}=c;let f,h,v;if(a&&d){const e=Va(d),t=La(Ba(d))+a;if(f=t<0||t>1440,!f){let t=qa(d,a);h=e?`${e}T${t}`:t}}if(!f&&s&&m&&(v=$a(Va(m),s),f=new Date(v)<new Date(l)||new Date(v)>new Date(p)),f)o.push(n);else{if(!i){if(h){const n=Of({drawDefinition:t,matchUpId:e,scheduledTime:h});if(n.error)return n}if(v){const n=xf({drawDefinition:t,matchUpId:e,scheduledDate:v});if(n.error)return n}}(h||v)&&r.push(n)}}}const v=r.length&&!o.length;return h(f({},ko),{rescheduled:r,notRescheduled:o,allRescheduled:v})}function $f({tournamentRecord:e,dailyLimits:t}){return e?"object"!=typeof t?{error:"Invalid object"}:ld({tournamentRecord:e,extension:{name:"scheduleLimits",value:{dailyLimits:t}}}):{error:Lo}}function Gf({tournamentRecords:e,tournamentId:t,drawId:n}){if(!e)return{error:"Missing tournamentRecords"};if("string"!=typeof t&&!(t=Fl({tournamentRecords:e,drawId:n})))return{error:"Missing tournamentId"};const i=e[t];if(!i)return{error:Lo};const{drawDefinition:r,error:o}=_s({tournamentRecord:i,drawId:n});return{drawDefinition:r,error:o,tournamentRecord:i}}const _f={scheduleMatchUps:function({tournamentRecords:e,competitionMatchUps:t,matchUpDependencies:n,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:o=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:c={},matchUpNotBeforeTimes:u={},matchUpDailyLimits:d={},checkPotentialRequestConflicts:l=!0,remainingScheduleTimes:p,clearScheduleDates:m,periodLength:v=30,scheduleDate:g,matchUpIds:I,venueIds:y,startTime:w,endTime:U,dryRun:b}){if(!e)return{error:"Missing tournamentRecords"};if(!I)return{error:"Missing matchUpIds"};if(!Ta(g))return{error:Go};if(isNaN(v)||isNaN(r)||isNaN(o))return{error:_o};t||({matchUps:t}=np({tournamentRecords:e,nextMatchUps:!0})),n||({matchUpDependencies:n}=ap({tournamentRecords:e,includeParticipantDependencies:!0,matchUps:t})),t.forEach((e=>{var t;null!==(t=e.schedule)&&void 0!==t&&t.scheduledDate&&Ka(g,Va(e.schedule.scheduledDate))&&cf({matchUp:e,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s})}));const S=I.map((e=>t.find((t=>t.matchUpId===e)))).filter(Boolean),{venueId:P,scheduleTimes:D,dateScheduledMatchUpIds:N}=rf({tournamentRecords:e,remainingScheduleTimes:p,startTime:Ba(w),endTime:Ba(U),scheduleDate:Va(g),averageMatchUpMinutes:r,clearScheduleDates:m,periodLength:v,venueIds:y}),M={},T=[],E={},A={},R={};t.filter((({matchUpId:e})=>N.includes(e))).forEach((e=>{var t;af({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,scheduleDate:g,matchUp:e,value:1});const i=null===(t=e.schedule)||void 0===t?void 0:t.scheduledTime;if(i){E[e.matchUpId]=i;const t=null==a?void 0:a[e.matchUpId];uf({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:u,matchUpDependencies:n,recoveryMinutes:t||o,averageMatchUpMinutes:r,scheduleDate:g,scheduleTime:i,matchUp:e})}}));let C=S.filter((e=>{const t=N.includes(e.matchUpId),n=[qr,Kr,Hr,Wr,Qr,to].includes(null==e?void 0:e.matchUpStatus);return!t&&!e.winningSide&&!n}));const{matchUpMap:x,overLimitMatchUpIds:O,participantIdsAtLimit:k}=C.reduce(((e,t)=>{const{drawId:n,tournamentId:i,matchUpType:r}=t,{participantIdsAtLimit:o,relevantParticipantIds:a}=ff({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpDailyLimits:d,matchUp:t});return null!=o&&o.length?(e.overLimitMatchUpIds.push(t.matchUpId),e.participantIdsAtLimit.push(...o),e):(a.forEach((e=>{of({individualParticipantProfiles:c,participantId:e});const t=c[e].counters;t[r]?t[r]+=1:t[r]=1,t[Vs]?t[Vs]+=1:t[Vs]=1})),e.matchUpMap[i]||(e.matchUpMap[i]={}),e.matchUpMap[i][n]?e.matchUpMap[i][n].push(t):e.matchUpMap[i][n]=[t],cf({matchUp:t,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s}),e)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter((({matchUpId:e})=>!O.includes(e)));let F=0;const L=(null==D?void 0:D.length)||0,{personRequests:j}=hf({tournamentRecords:e,requestType:"DO_NOT_SCHEDULE"});for(;null!=D&&D.length&&C.length&&F<=L;){F++;const{scheduleTime:e}=D.shift(),d=C.find((d=>{const{matchUpId:p}=d,{dependenciesScheduled:m,remainingDependencies:f}=sf({matchUps:t,matchUpScheduleTimes:E,matchUpDependencies:n,allDateMatchUpIds:i,matchUp:d});if(!m)return R[p]||(R[p]=[]),R[p].push({scheduleTime:e,remainingDependencies:f}),!1;const{enoughTime:h}=pf({individualParticipantProfiles:c,matchUpNotBeforeTimes:u,matchUpDependencies:n,scheduleTime:e,matchUp:d});if(!h)return A[p]||(A[p]=[]),A[p].push({scheduleTime:e}),!1;const{conflicts:v}=lf({potentials:l,averageMatchUpMinutes:r,requestConflicts:M,personRequests:j,scheduleTime:e,scheduleDate:g,matchUp:d});if(null!=v&&v.length)return!1;const I=null==a?void 0:a[d.matchUpId];return uf({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUpNotBeforeTimes:u,averageMatchUpMinutes:r,matchUpDependencies:n,recoveryMinutes:I||o,scheduleDate:g,scheduleTime:e,matchUp:d}),E[d.matchUpId]=e,!0}));C=C.filter((({matchUpId:e})=>e!==(null==d?void 0:d.matchUpId))),d||T.push(e)}C.forEach((e=>{af({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,scheduleDate:g,value:-1,matchUp:e})}));let B=[];Object.keys(x).forEach((t=>{const n=e[t];n?Object.keys(x[t]).forEach((e=>{const{drawDefinition:i}=Ws({tournamentRecord:n,drawId:e});i&&x[t][e].forEach((({matchUpId:e})=>{const t=E[e];if(t){const r=t.split(":").map(Ha).join(":"),o=`${Va(g)}T${r}`;b?B.push(e):(cl({drawDefinition:i,matchUpId:e,scheduledTime:o}).success&&B.push(e),P&&nl({tournamentRecord:n,drawDefinition:i,matchUpId:e,venueId:P}))}}))})):sa()&&console.log("Missing tournamentId")}));const V=Ju(C);return h(f({},ko),{requestConflicts:Object.values(M),remainingScheduleTimes:D.map((({scheduleTime:e})=>e)),individualParticipantProfiles:c,matchUpNotBeforeTimes:u,participantIdsAtLimit:k,skippedScheduleTimes:T,overLimitMatchUpIds:O,scheduledMatchUpIds:B,noTimeMatchUpIds:V,recoveryTimeDeferred:A,dependencyDeferred:R})},scheduleProfileRounds:Pf,clearScheduledMatchUps:yf,bulkRescheduleMatchUps:function({tournamentRecords:e,scheduleChange:t,matchUpIds:n,dryRun:i}){if(!n||!Array.isArray(n))return{error:"Missing matchUpIds"};if("object"!=typeof t)return{error:_o};const r=[];let o=[];for(const u of Object.values(e)){var a;const e=Vf({tournamentRecord:u,scheduleChange:t,matchUpIds:n,dryRun:i});if(e.error)return e;Array.isArray(e.notRescheduled)&&o.push(...e.notRescheduled);const c=Ju(e.notRescheduled),d=[];var s;null===(a=e.rescheduled)||void 0===a||a.forEach((e=>{const{matchUpId:t}=e;c.includes(t)&&d.push(t),r.push(e)})),d.length&&(o=(null==e||null===(s=e.notRescheduled)||void 0===s?void 0:s.filter((({matchUpId:e})=>!d.includes(e))))||[])}const c=r.length&&!o.length;return h(f({},ko),{rescheduled:r,notRescheduled:o,allRescheduled:c})},getScheduledRoundsDetails:nf,getMatchUpDependencies:ap,generateVirtualCourts:Eu,generateBookings:bf,matchUpScheduleChange:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const{sourceMatchUpContextIds:n,targetMatchUpContextIds:i,sourceCourtId:r,targetCourtId:o,courtDayDate:a}=e||{},{drawId:s,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:l,tournamentId:p}=i||{};if(!c&&!l)return{error:$o};let m=0;if(o&&c&&!l){const e=f({tournamentId:u,drawId:s,courtDayDate:a,matchUpId:c,courtId:o});if(null!=e&&e.success&&m++,e.error)return e}else if(r&&o&&c&&l){const e=f({tournamentId:u,drawId:s,courtDayDate:a,matchUpId:c,courtId:o});if(e.success&&m++,e.error)return e;const t=f({tournamentId:p,drawId:d,courtDayDate:a,matchUpId:l,courtId:r});if(t.success&&m++,t.error)return t}return m?ko:{error:"No modifications applied"};function f({tournamentId:e,drawId:n,matchUpId:i,courtDayDate:r,courtId:o}){const a=t[e],{drawDefinition:s}=Ws({tournamentRecord:a,drawId:n});return il({tournamentRecord:a,drawDefinition:s,matchUpId:i,courtId:o,courtDayDate:r})}},calculateScheduleTimes:rf,reorderUpcomingMatchUps:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const{matchUpsContextIds:n,firstToLast:i}=e;if(!n)return{error:$o};const r=null==n?void 0:n.length;if(!r)return ko;let o=0;return n.forEach(((e,a)=>{const{tournamentId:s,drawId:c,matchUpId:u}=e;let d=a+(i?-1:1);d<0&&(d=r-1),d===r&&(d=0);const l=function({tournamentId:e,drawId:n,matchUpId:i,scheduledTime:r}){const o=t[e],{drawDefinition:a}=Ws({tournamentRecord:o,drawId:n});return cl({drawDefinition:a,matchUpId:i,scheduledTime:r})}({tournamentId:s,drawId:c,matchUpId:u,scheduledTime:n[d].schedule.scheduledTime});if(!l.success)return l;o++})),o===r?ko:{error:"Modifications failed"}},bulkUpdateCourtAssignments:function({tournamentRecords:e,courtAssignments:t,courtDayDate:n}){if(!e)return{error:"Missing tournamentRecords"};if(!Array.isArray(t))return{error:$o};const i=t.reduce(((e,t)=>{const{tournamentId:n}=t;return e[n]||(e[n]=[]),e[n].push(t),e}),{});let r;return Object.keys(i).every((t=>{const o=e[t];if(!o)return r={error:Lo},!1;const a=i[t].reduce(((e,t)=>{const{drawId:n}=t;return e[n]||(e[n]=[]),e[n].push(t),e}),{});Object.keys(a).every((e=>{const{drawDefinition:t}=_s({tournamentRecord:o,drawId:e});return t?(a[e].every((e=>{const{matchUpId:i,courtId:a}=e,s=il({tournamentRecord:o,drawDefinition:t,courtDayDate:n,matchUpId:i,courtId:a});if(s.success)return null==s?void 0:s.success;r={error:"Unable to assign court"}})),!0):(r={error:jo},!1)}))})),r||ko},removeMatchUpCourtAssignment:Ef,toggleParticipantCheckInState:function(e){const{tournamentRecords:t}=e,{participantId:n,tournamentId:i,matchUpId:r,drawId:o}=e;if(!(t&&i&&n&&r))return{error:$o};const a=t[i],{drawDefinition:s}=Ws({tournamentRecord:a,drawId:o});return Object.assign(e,{drawDefinition:s,tournamentRecord:a}),Tf(e)},findMatchUpFormatTiming:tf,modifyMatchUpFormatTiming:function({tournamentRecords:e,matchUpFormat:t,recoveryTimes:n,averageTimes:i,tournamentId:r,eventId:o}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const a=Object.keys(e).filter((e=>!r||r===e));if(r&&!a.includes(r))return{error:_o};let s;for(const c of a){const r=e[c],{event:a}=_s({tournamentRecord:r,eventId:o});o&&a&&(s=!0);const u=Ym({tournamentRecord:r,event:a,matchUpFormat:t,averageTimes:i,recoveryTimes:n});if(u.error)return u}return!o||s?f({},ko):{error:"Event not found"}},modifyEventMatchUpFormatTiming:function({tournamentRecords:e,tournamentId:t,eventId:n,categoryType:i,matchUpFormat:r,averageMinutes:o,recoveryMinutes:a}){if(!n)return{error:Vo};const s=Object.keys(e).filter((e=>!t||t===e));if(t&&!s.includes(t))return{error:_o};for(const c of s){const t=e[c],{event:s}=_s({tournamentRecord:t,eventId:n});if(s)return Zm({tournamentRecord:t,event:s,categoryType:i,matchUpFormat:r,averageMinutes:o,recoveryMinutes:a})}return{error:"Event not found"}},getMatchUpFormatTimingUpdate:function({tournamentRecords:e}){return Qm({tournamentRecords:e,extensionName:"scheduleTiming"})},getEventMatchUpFormatTiming:function({tournamentRecords:e,matchUpFormats:t,categoryType:n,tournamentId:i,eventId:r}){if(!r)return{error:Vo};const o=Object.keys(e).filter((e=>!i||e===i));if(i&&!o.length)return{error:_o};let a,s,c;return o.find((i=>{const o=e[i],{event:u}=_s({tournamentRecord:o,eventId:r});if(!u)return!1;c=!0;const{eventMatchUpFormatTiming:d,error:l}=Xm({tournamentRecord:o,matchUpFormats:t,categoryType:n,event:u});return l&&(s=l),a=d,!0})),c?s?{error:s}:{eventMatchUpFormatTiming:a}:{error:"Event not found"}},removeEventMatchUpFormatTiming:function({tournamentRecords:e,eventId:t}){if(!e)return{error:"Missing tournamentRecords"};if("string"!=typeof t)return{error:$o};for(const n of Object.values(e)){const{event:e}=_s({tournamentRecord:n,eventId:t});if(e)return Df({event:e})}return{error:"Event not found"}},getMatchUpDailyLimits:Uf,setMatchUpDailyLimits:function({tournamentRecords:e,tournamentId:t,dailyLimits:n}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const i=Object.keys(e).filter((e=>!t||t===e));if(t&&!i.includes(t))return{error:_o};for(const r of i){const t=$f({tournamentRecord:e[r],dailyLimits:n});if(t.error)return t}return ko},getMatchUpDailyLimitsUpdate:function({tournamentRecords:e}){return Qm({tournamentRecords:e,extensionName:"scheduleLimits"})},assignMatchUpVenue:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{matchUpId:r,venueId:o,disableNotice:a}=e;return nl({tournamentRecord:t,drawDefinition:n,disableNotice:a,matchUpId:r,venueId:o})},assignMatchUpCourt:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{matchUpId:r,courtId:o,courtDayDate:a,disableNotice:s}=e;return il({tournamentRecord:t,disableNotice:s,drawDefinition:n,courtDayDate:a,matchUpId:r,courtId:o})},addMatchUpScheduleItems:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);return i?{error:i}:Cf(h(f({},e),{tournamentRecord:t,drawDefinition:n}))},addMatchUpScheduledDate:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{disableNotice:r,scheduledDate:o,matchUpId:a}=e;return xf({tournamentRecord:t,drawDefinition:n,disableNotice:r,scheduledDate:o,matchUpId:a})},addMatchUpScheduledTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{disableNotice:r,scheduledTime:o,matchUpId:a}=e;return Of({tournamentRecord:t,drawDefinition:n,disableNotice:r,scheduledTime:o,matchUpId:a})},addMatchUpStartTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{disableNotice:r,startTime:o,matchUpId:a}=e;return kf({tournamentRecord:t,drawDefinition:n,disableNotice:r,startTime:o,matchUpId:a})},addMatchUpStopTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{disableNotice:r,stopTime:o,matchUpId:a}=e;return Lf({tournamentRecord:t,drawDefinition:n,disableNotice:r,stopTime:o,matchUpId:a})},addMatchUpResumeTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{disableNotice:r,resumeTime:o,matchUpId:a}=e;return jf({tournamentRecord:t,drawDefinition:n,disableNotice:r,resumeTime:o,matchUpId:a})},addMatchUpEndTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{disableNotice:r,endTime:o,matchUpId:a}=e;return Ff({tournamentRecord:t,drawDefinition:n,disableNotice:r,endTime:o,matchUpId:a})},addMatchUpOfficial:function(e){const{tournamentRecord:t,drawDefinition:n,error:i}=Gf(e);if(i)return{error:i};const{disableNotice:r,participantId:o,officialType:a,matchUpId:s}=e;return Bf({tournamentRecord:t,drawDefinition:n,disableNotice:r,participantId:o,officialType:a,matchUpId:s})},getSchedulingProfile:Jl,setSchedulingProfile:Zl,addSchedulingProfileRound:Ql,validateSchedulingProfile:$l,addPersonRequests:function({tournamentRecords:e,personId:t,requests:n}){if(!e)return{error:"Missing tournamentRecords"};if("string"!=typeof t)return{error:_o};if(!Array.isArray(n))return{error:_o};const{personRequests:i}=hf({tournamentRecords:e}),{mergeCount:r}=gf({personRequests:i,personId:t,requests:n});return r?vf({tournamentRecords:e,personRequests:i}):{error:_o}},getPersonRequests:hf,modifyPersonRequests:function({tournamentRecords:e,requests:t,personId:n}){if(!e)return{error:"Missing tournamentRecords"};if(!Array.isArray(t))return{error:_o};const i=t.map((({requestId:e})=>e)).filter(Boolean),{personRequests:r}=hf({tournamentRecords:e}),o=e=>{r[e]=r[e].map((e=>{if(!i.includes(e.requestId))return e;const n=t.find((t=>t.requestId===e.requestId));return n.requestType?Object.assign(e,n):void 0})).filter(Boolean)};if(n&&r[n])o(n);else for(const s of Object.keys(r))o(s);const a=t.filter((e=>!e.requestId));return a.length&&gf({personRequests:r,personId:n,requests:a}),vf({tournamentRecords:e,personRequests:r})},removePersonRequests:function({tournamentRecords:e,requestType:t,requestId:n,personId:i,date:r}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const{personRequests:o}=hf({tournamentRecords:e}),a=e=>{o[e]=o[e].filter((e=>!(t&&e.requestType===t||n&&e.requestId===n||r&&e.date===r))),o[e].length||delete o[e]},s=!(t||n||i||r);if(!s)if(i&&o[i])a(i);else for(const c of Object.keys(o))a(c);return s||!Object.keys(o).length?Yl({tournamentRecords:e,name:"personRequests"}):vf({tournamentRecords:e,personRequests:o})}};function Wf({tournamentRecord:e,policyDefinitions:t,allowReplacement:n}){if(!e)return{error:Lo};if(!t||"object"!=typeof t)return{error:"Missing policyDefinitions"};e.extensions||(e.extensions=[]);const{appliedPolicies:i}=Ns({tournamentRecord:e}),r=Object.keys(t).map((e=>{if(!i[e]||n)return i[e]=t[e],e})).filter(Boolean);if(null!=r&&r.length){const t=ld({tournamentRecord:e,extension:{name:"appliedPolicies",value:i}});if(t.error)return t}return null!=r&&r.length?h(f({},ko),{applied:r}):{error:"existing policyType"}}function qf({policyDefinitions:e,allowReplacement:t,event:n}){if(!n)return{error:Vo};if(!e)return{error:"Missing policyDefinitions"};let i=0;n.extensions||(n.extensions=[]);const{appliedPolicies:r}=Ms({event:n});return Object.keys(e).forEach((n=>{r[n]&&!t||(r[n]=e[n],i++)})),i&&md({event:n,extension:{name:"appliedPolicies",value:r}}),i?ko:{error:"Policy not attached"}}const zf={attachPolicies:function({tournamentRecords:e,policyDefinitions:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};for(const n of Object.values(e)){const e=Wf({tournamentRecord:n,policyDefinitions:t,allowReplacement:!0});if(e.error)return e}return ko}};function Hf(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antoina, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and challenging me.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}function Kf({tournamentParticipants:e=[],inContextDrawMatchUps:t,drawDefinition:n,matchUpsMap:i,matchUpId:r,event:o}){var a,s,c;if(!n)return{error:jo};if(!r)return{error:"Missing matchUpId"};const{drawId:u}=n,{matchUp:d,structure:l}=el({drawDefinition:n,matchUpId:r,event:o}),{assignedPositions:p,allPositionsAssigned:m}=Kd({structure:l}),{drawPositions:f}=d||{},{structureId:h}=l||{},v=[];if(!h)return{validActions:v};if(Yd({drawDefinition:n,structure:l})){const t=(l.matchUps||[]).filter((({roundNumber:e})=>e===d.roundNumber)),i=(null==n?void 0:n.entries.filter((({entryStatus:e})=>[Sd,Nd,bd].includes(e))).map(Qu))||[],o=t.map((e=>(e.sides||[]).map((e=>e.participantId)))).flat().filter(Boolean),a=i.filter((e=>!o.includes(e))),s=null==e?void 0:e.filter((e=>null==a?void 0:a.includes(e.participantId)));null==s||s.forEach((e=>{const t=(n.entries||[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),a.length&&v.push({type:"ASSIGN",availableParticipantIds:a,participantsAvailable:s,method:"assignMatchUpSideParticipant",payload:{drawId:u,matchUpId:r,structureId:h}}),v.push({type:"ALTERNATE"})}const g=jp({drawDefinition:n,structure:l}),I=p.filter((e=>e.participantId)).map((e=>e.drawPosition)),y=p.filter((e=>e.bye)).map((e=>e.drawPosition)),w=d.collectionId,U=d.matchUpStatus===qr||!w&&(null===(a=d.drawPositions)||void 0===a?void 0:a.reduce(((e,t)=>y.includes(t)||e),!1));if(U)return{validActions:v,isByeMatchUp:U};const b=null==f?void 0:f.reduce(((e,t)=>I.includes(t)&&e),2===(null==f?void 0:f.length));v.push({type:"REFEREE"});const S=!sp({matchUpStatus:d.matchUpStatus}),{appliedPolicies:P}=td({drawDefinition:n}),D=null==P||null===(s=P.scoring)||void 0===s?void 0:s.structures,N=(null==D?void 0:D.stage)&&(null==D?void 0:D.stage[l.stage]),M=(null==N?void 0:N.stageSequence)&&N.stageSequence[l.stageSequence],T=!((null==P||null===(c=P.scoring)||void 0===c?void 0:c.requireAllPositionsAssigned)||(null==N?void 0:N.requireAllPositionsAssigned)||(null==M?void 0:M.requireAllPositionsAssigned))||m,E=d.sides&&2===d.sides.filter((e=>e&&e.participantId)).length;let A;const R=d.matchUpStatus===Yr;if(R){i=i||id({drawDefinition:n}),t||({matchUps:t}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:i}));const e=wl({inContextDrawMatchUps:t,drawDefinition:n,matchUpId:r});A=em({inContextDrawMatchUps:t,drawDefinition:n,targetData:e})}const C=(b||E)&&!(R&&A),x={type:"PENALTY",method:"addPenalty",payload:{drawId:u,matchUpId:r,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(S&&v.push({type:"SCHEDULE"}),C&&v.push(x),S&&C&&v.push({type:"STATUS"}),T&&C){const{matchUpId:e,matchUpFormat:t}=d,n={drawId:u,matchUpId:e,matchUpFormat:t,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};v.push({type:"SCORE",method:"setMatchUpStatus",message:"set outcome and winningSide",payload:n}),v.push({type:"START"}),v.push({type:"END"})}return{validActions:v,isDoubleWalkover:R,structureIsComplete:g}}function Yf({tournamentRecord:e,drawDefinition:t,matchUpId:n,drawId:i}){if(!e)return{error:Lo};if(!i){const{matchUps:r}=Ml({tournamentRecord:e});i=r.reduce(((e,t)=>t.matchUpId===n?t.drawId:e),void 0),t=(e.events||[]).map((e=>e.drawDefinitions||[])).flat().reduce(((e,t)=>t.drawId===i?t:e),void 0)}return i?Kf({drawDefinition:t,matchUpId:n}):{error:"drawDefinition not found"}}const Jf={getCompetitionDateRange:Wl,getTournamentIds:function({tournamentRecords:e}){const t=Object.keys(e);return h(f({},ko),{tournamentIds:t})},competitionScheduleMatchUps:ip,getSchedulingProfileIssues:function({tournamentRecords:e,scheduleDates:t=[]}={}){if("object"!=typeof e)return{error:"Invalid tournamentRecord"};if(!Array.isArray(t))return{error:_o};if(!t.every(Ta))return{error:Go};const n=[];let i=0;const r={},{schedulingProfile:o}=Jl({tournamentRecords:e});if(!o)return f({issues:n},ko);const{matchUps:a}=np({tournamentRecords:e,nextMatchUps:!0});for(const s of o){const{scheduleDate:o,venues:c=[]}=s;if(null==t||!t.length||t.includes(o))for(const t of c||[])if(t){const{rounds:s}=t,c=[];let{orderedMatchUpIds:u,scheduledRoundsDetails:d}=nf({tournamentRecords:e,periodLength:30,matchUps:a,rounds:s});const{matchUpDependencies:l}=ap({tournamentRecords:e,matchUps:a}),p=e=>{let t;return d.find(((n,i)=>{const r=n.matchUpIds.includes(e);return r&&(t=i),r})),t};if(u.forEach(((e,t)=>{var n;const i=Ro(u.slice(t+1),(null==l||null===(n=l[e])||void 0===n?void 0:n.matchUpIds)||[]);i.length&&c.push({matchUpId:e,shouldBeAfter:i})})),c.length){i+=c.length;const e=c.map((({matchUpId:e,shouldBeAfter:t})=>{const n=p(e),i=bo(t.map(p));return r[o]||(r[o]={}),r[o][n]||(r[o][n]=[]),i.forEach((e=>{r[o][n].includes(e)||r[o][n].push(e)})),{matchUpId:e,matchUpRoundIndex:n,earlierRoundIndices:i,shouldBeAfter:t}}));n.push(...e)}}}return f({issuesCount:i,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...n.map((e=>{const{matchUpId:t,shouldBeAfter:n,earlierRoundIndices:i}=e;return{[t]:{earlierRoundIndices:i,shouldBeAfter:n}}})))},roundIndexShouldBeAfter:r},ko)},allCompetitionMatchUps:np,competitionMatchUps:rp,matchUpActions:function({tournamentRecords:e,tournamentId:t,matchUpId:n,eventId:i,drawId:r}={}){if("object"!=typeof e||"string"!=typeof t||"string"!=typeof n||"string"!=typeof r)return{error:_o};const o=e[t];if(!o)return{error:Lo};const{drawDefinition:a,error:s}=_s({tournamentRecord:o,eventId:i,drawId:r});return s?{error:s}:Yf({tournamentRecord:o,drawDefinition:a,drawId:r,matchUpId:n})},getCompetitionVenues:zl,getVenuesAndCourts:ql,getVenuesReport:function({tournamentRecords:e,venueIds:t=[],dates:n=[]}){if(!Array.isArray(n))return{error:_o,dates:n};if(!Array.isArray(t))return{error:_o,venueIds:t};if(!n.every(Ta))return{error:Go};const i=ql({tournamentRecords:e});if(i.error)return i;const r=i.venues.filter((({venueId:e})=>!(null!=t&&t.length)||t.includes(e))),o=i.courts.reduce(((e,t)=>(t.dateAvailability.forEach((({date:t})=>{e.includes(t)||e.push(t)})),e)),[]).filter((e=>!n.length||n.includes(e))),a={venueIds:r.map((({venueId:e})=>e))},{matchUps:s}=np({tournamentRecords:e,matchUpFilters:a});return{venuesReport:r.map((e=>function(e,t,n){const{venueId:i,courts:r,venueName:o}=t,a={};return e.forEach((e=>{let t=0,o=0,s=0;for(const n of r){const i=n.dateAvailability.find((t=>t.date===e)),r=i&&Nu({courtDate:i}),o=null==r?void 0:r.reduce(((e,t)=>{const{startTime:n,endTime:i}=t;return e+(La(i)-La(n))}),0);o&&(s+=1),t+=o}const c=n.filter((({schedule:t})=>t.venueId===i&&Ka(e,t.scheduledDate)));c.forEach((({schedule:e})=>{const t=Ba(e.scheduledTime),n=La(qa(t,e.averageMinutes))-La(t);o+=n}));const u=t?(o/t*100).toFixed(2):"100";a[e]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:t,scheduledMinutes:o,percentUtilization:u}})),{venueId:i,venueName:o,venueReport:a}}(o,e,s)))}},credits:Hf};function Zf(e,t=!0){if("object"!=typeof e)return{error:"Invalid object"};if(Array.isArray(e)){if(e.filter((({tournamentId:e})=>e)).length!==e.length)return{error:Fo};e=Object.assign({},...e.map((e=>({[e.tournamentId]:e}))))}else if(e.tournamentId)e={[e.tournamentId]:e};else if(!Object.keys(e).every((t=>e[t].tournamentId===t)))return{error:Fo};return wa(t?Ja(e):e)}function Qf({policyAttributes:e,idCollections:t,participants:n,participant:i}){if(!Array.isArray(e))return{error:"Missing policy attributes"};if(!i)return{error:"Missing participant"};const r=[];return e.forEach((e=>{const{directive:a,groupings:s,key:c,significantCharacters:u}=e||{};if(c){const e=c.split(".");o({value:i,keys:e,significantCharacters:u})}else if(a){const o=null==e?void 0:e.includeIds,s=(t&&t[a]||[]).filter((e=>!o||o.includes(e)));null!=s&&s.length&&null!=n&&n.length&&s.forEach((e=>{var t;const o=n.find((t=>t.participantId===e));if(null!=o&&null!==(t=o.individualParticipantIds)&&void 0!==t&&t.includes(i.participantId)){const e=null==o?void 0:o.participantId;r.push(e)}}))}else s&&Object.keys(s).forEach((e=>{s[e].includes(i.participantId)&&r.push(e)}))})),{values:bo(r)};function o({value:e,keys:t=[],significantCharacters:n}){for(const[r,a]of t.entries())if(e&&e[a])if(Array.isArray(e[a])){const i=e[a],s=t.slice(r);i.forEach((e=>o({value:e,keys:s,significantCharacters:n})))}else i({value:e=e[a],index:r});function i({value:e,index:i}){if(e&&i===t.length-1&&["string","number"].includes(typeof e)){const t=n?e.slice(0,n):e;r.push(t)}}}}function Xf({candidatePositionAssignments:e,participantsWithGroupings:t,policyAttributes:n,idCollections:i}){const r=Object.assign({},...t.map((e=>({[e.participantId]:e}))));return e.map((e=>{const o=r[e.participantId],{values:a}=Qf({participants:t,policyAttributes:n,idCollections:i,participant:o});return h(f({},e),{values:a})}))}function eh({participantIdGroups:e,positionAssignments:t,groupsToAvoid:n}){return Object.assign({},...t.filter((e=>null==e?void 0:e.participantId)).map((t=>{const{drawPosition:i,participantId:r}=t,o=e&&e[r]||[],a=!!n.some((e=>o.includes(e)));return{[i]:{participantGroups:o,includesGroupsToAvoid:a}}})))}function th(e){const{unfilledPositions:t,chunkedDrawPositions:n}=e,i=eh(e);return n.map((e=>{const n=t.filter((t=>e.includes(t))),r=(a=n).filter((e=>!function(e){const t=nh(e);return!a.includes(t)}(e))),o=n.filter((e=>!r.includes(e))).filter((e=>{var t;const n=nh(e);return!(null!==(t=i[n])&&void 0!==t&&t.includesGroupsToAvoid)}));var a;return{unassigned:n,unpaired:r,pairedNoConflict:o}}))}function nh(e){return e%2?e+1:e-1}function ih({participantIds:e,positionAssignments:t}){const n=t.map((e=>e.participantId));return e.filter((e=>!n.includes(e)))}function rh({candidatePositionAssignments:e,unseededParticipantIds:t,participantIdGroups:n,drawPositionChunks:i,drawPositionGroups:r,pairedPriority:o,allGroups:a,groupKey:s}){const c=r.reduce(((e,t)=>t.length>e?t.length:e),0),u=!!(c>2),d=ih({participantIds:t,positionAssignments:e}),l=function({drawPositionGroups:e,positionAssignments:t}){const n=Object.assign({},...t.map((e=>({[e.drawPosition]:e}))));return e.map((e=>e.filter(Boolean).map((e=>n[e])).filter((e=>!e.participantId&&!e.bye)).map((e=>e.drawPosition)))).flat().filter(Boolean)}({drawPositionGroups:r,positionAssignments:e}),{participantId:p,groupKey:m}=function({groupKey:e,allGroups:t,largestFirst:n=!0,targetParticipantIds:i,useSpecifiedGroupKey:r=!1}){var o;const a=Object.assign({},...Object.keys(t).map((e=>[e,t[e].filter((e=>i.includes(e)))])).filter((e=>e[1].length)).map((([e,t])=>({[e]:t})))),s=Object.keys(a).reduce(((e,t)=>a[t].length>e?a[t].length:e),0),c=Object.keys(a).filter((e=>a[e].length===s)),u=To(n?c:Object.keys(a));return{participantId:(e=r&&null!==(o=a[e])&&void 0!==o&&o.length?e:u)&&a[e]?To(a[e]):To(i),groupKey:e}}({groupKey:s,allGroups:a,targetParticipantIds:d,useSpecifiedGroupKey:u}),f=function({selectedParticipantGroups:e,participantIdGroups:t,positionAssignments:n,drawPositionChunks:i,unfilledPositions:r,isRoundRobin:o}){const a=i.map((i=>o?function(e){const{unfilledPositions:t,chunkedDrawPositions:n}=e,i=eh(e);return n.map((e=>{const n=t.filter((t=>e.includes(t))),r=n.length===e.length?n:[],o=e.filter((e=>{var t;return null===(t=i[e])||void 0===t?void 0:t.includesGroupsToAvoid})).length;return{unassigned:n,unpaired:r,pairedNoConflict:o?[]:n,conflictsCount:o}}))}({groupsToAvoid:e,chunkedDrawPositions:i,participantIdGroups:t,positionAssignments:n,unfilledPositions:r}):th({groupsToAvoid:e,chunkedDrawPositions:i,participantIdGroups:t,positionAssignments:n,unfilledPositions:r})));return o?{unassigned:a.map((e=>e.map((e=>e.unassigned)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)).sort(((e,t)=>(t.length||0)-(e.length||0))),unpaired:a.map((e=>e.map((e=>e.unpaired)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),pairedNoConflict:a.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)).sort(((e,t)=>(t.length||0)-(e.length||0)))}:{unassigned:a.map((e=>e.map((e=>e.unassigned)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),unpaired:a.map((e=>e.map((e=>e.unpaired)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),pairedNoConflict:a.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length))}}({positionAssignments:e,isRoundRobin:u,selectedParticipantGroups:function({allGroups:e,participantId:t}){return Object.keys(e).filter((n=>e[n].includes(t)))}({allGroups:a,participantId:p}),participantIdGroups:n,drawPositionChunks:i,unfilledPositions:l,largestGroupSize:c,allGroups:a}),{unassigned:h,unpaired:v,pairedNoConflict:g}=f,I=(null==g?void 0:g.length)&&g[0],y=(null==v?void 0:v.length)&&v[0],w=o&&I?I:y,U=o?y:I,b=(null==w?void 0:w.length)&&w||(null==U?void 0:U.length)&&U;let S;if(null!=b&&b.length){const e=Mo(b);S=Mo(e)}else{const e=Mo(h[0]);S=Mo(e)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:S}}function oh({drawPositions:e}){const t=[].concat(...e.map((t=>e.filter((e=>e!==t)).map((e=>[t,e]))))),n=bo(t.map(ah)).map((e=>e.split("|").map((e=>+e))));return{groupMatchUps:t,uniqueMatchUpGroupings:n}}function ah(e){return e.sort(Xa).join("|")}function sh({isRoundRobin:e,groupedParticipants:t}){const n=[];return e?t.forEach((e=>{const t=e.map((e=>e.drawPosition)),{uniqueMatchUpGroupings:i}=oh({drawPositions:t}),r=Object.assign({},...e.map((e=>({[e.drawPosition]:e}))));i.forEach((t=>{Co(r[t[0]].values||[],r[t[1]].values||[])&&(n.push(t),e.conflict=!0)}))})):t.forEach((e=>{Co(e[0].values||[],e[1].values||[])&&(n.push(e),e.conflict=!0)})),n}function ch({isRoundRobin:e,avoidanceConflicts:t,drawPositionGroups:n,positionedParticipants:i,potentialDrawPositions:r}){return t.map((t=>{const o=t.map((e=>e.drawPosition));return t.filter((e=>r.includes(e.drawPosition))).map((t=>{const a=r.filter((e=>!o.includes(e))).filter((r=>{const o=n.find((e=>e.includes(r))).find((e=>e!==r)),a=i.find((e=>e.drawPosition===o)),s=sh({isRoundRobin:e,groupedParticipants:[[t,a]]}),c=i.find((e=>e.drawPosition===r)),u=sh({isRoundRobin:e,groupedParticipants:[[c,a]]});return!s.length&&!u.length}));if(a.length)return{drawPosition:t.drawPosition,possibleDrawPositions:a}})).filter(Boolean)})).flat(1)}function uh(e){const{initialPositionAssignments:t,participantsWithGroupings:n,opponentsToPlaceCount:i,drawPositionGroups:r,policyAttributes:o,idCollections:a,allGroups:s}=e,c=[];let u;const d=Math.min(...r.map((e=>e.length))),l=d>2,p=Ja(t,!1,!0),m=t.filter((e=>!e.participantId)).map((e=>e.drawPosition));Eo(0,i).forEach((()=>{const{newGroupKey:t,selectedParticipantId:n,targetDrawPosition:i}=rh(h(f({},e),{groupKey:u,allGroups:s,candidatePositionAssignments:p}));u=t,p.forEach((e=>{e.drawPosition===i&&(e.participantId=n)}))}));let v=Xf({candidatePositionAssignments:p,participantsWithGroupings:n,policyAttributes:o,idCollections:a}),g=xo(v,d),I=sh({groupedParticipants:g,isRoundRobin:l}),y=0;for(;y<20&&I.length;){const e=ch({positionedParticipants:v,potentialDrawPositions:m,avoidanceConflicts:I,drawPositionGroups:r,isRoundRobin:l});e.length?(dh({candidatePositionAssignments:p,swapOptions:e}),v=Xf({candidatePositionAssignments:p,participantsWithGroupings:n,policyAttributes:o,idCollections:a}),g=xo(v,d),I=sh({isRoundRobin:l,groupedParticipants:g}),y++):y=20}return p.forEach((e=>{e.bye&&e.participantId&&c.push({error:"Invalid Assignment",assignment:e})})),{positionAssignments:p,conflicts:I.length,groupedParticipants:g,errors:c}}function dh({candidatePositionAssignments:e,swapOptions:t}){const n=Mo(t);if(!n)return{error:"No swap options"};const i=n.drawPosition,r=Mo(n.possibleDrawPositions),o=e.find((e=>e.drawPosition===i)).participantId,a=e.find((e=>e.drawPosition===r)).participantId;return e.forEach((e=>{e.drawPosition===i&&(e.participantId=a),e.drawPosition===r&&(e.participantId=o)})),ko}function lh({inContextDrawMatchUps:e,drawDefinition:t,candidatesCount:n,participants:i,matchUpsMap:r,structureId:o,structure:a}){a||({structure:a}=ad({drawDefinition:t,structureId:o})),o||({structureId:o}=a);const{positionAssignments:s}=Kd({structure:a}),{seedAssignments:c}=Wd({drawDefinition:t,structure:a}),u=c.map((e=>e.participantId)).filter(Boolean),{stage:d,stageSequence:l}=a,p=Vd({drawDefinition:t,stageSequence:l,entryStatuses:[Sd,bd],structureId:o,stage:d}),m=p.filter((e=>!u.includes(e.participantId))).map((e=>e.participantId)),h=s.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));if(m.length>h.length)return{error:"Insufficient drawPositions to accommodate entries"};const{appliedPolicies:v}=td({drawDefinition:t});let{avoidance:g}=v||{};if(a.stage===iu){const e=p.reduce(((e,t)=>(e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e)),{});Object.keys(e).length&&(g||(g={policyName:"Playoff Avoidance"}),g.policyAttributes||(g.policyAttributes=[]),g.policyAttributes.push({groupings:e}))}if(g&&i)return function({unseededParticipantIds:e,inContextDrawMatchUps:t,drawDefinition:n,participants:i,matchUpsMap:r,structureId:o,avoidance:a,entries:s,event:c}){if(!a)return{error:"Missing avoidance policy"};const{policyAttributes:u,roundsToSeparate:d,candidatesCount:l=1}=a,{structure:p}=ad({drawDefinition:n,structureId:o}),{matchUps:m}=Xd({matchUpsMap:r,structure:p,event:c}),{positionAssignments:h}=Kd({structure:p}),v=vl({participants:i}),g=h.filter((e=>!e.participantId)),I=h.map((e=>e.drawPosition)),y=p.structureType===au,w=y?{structure:p,matchUps:m,allDrawPositions:I,roundsToSeparate:d}:{matchUps:m,allDrawPositions:I,roundsToSeparate:d},{drawPositionGroups:U,drawPositionChunks:b}=y?function(e){const{structure:{structures:t}}=e,n=t.map((e=>e.positionAssignments.map((e=>e.drawPosition))));return{drawPositionGroups:n,drawPositionChunks:[n]}}(w):function({matchUps:e,allDrawPositions:t,roundsToSeparate:n}){const i=e.filter((e=>1===e.roundNumber)).map((e=>e.drawPositions)),r=i.flat().sort(Xa),o=Math.max(...r),a=t.filter((e=>e>o)),s=Eo(2,r.length).filter((e=>e===fo(e))),c=s.slice(0,n||s.length).reverse().map((e=>xo(r,e)));return a.length&&console.log({fedDrawPositions:a}),{drawPositionGroups:i,drawPositionChunks:c}}(w),S={};S.groupParticipants=i.filter((e=>e.participantType===mc)).map((e=>e.participantId)),S.teamParticipants=i.filter((e=>e.participantType===lc)).map((e=>e.participantId)),S.pairParticipants=i.filter((e=>e.participantType===pc)).map((e=>e.participantId));const P=function({targetParticipantIds:e,policyAttributes:t,idCollections:n,participants:i}){if(!Array.isArray(t))return{error:"Missing policy attributes"};if(!Array.isArray(i))return{error:"Missing participants"};const r={};return e.forEach((e=>{const o=i.find((t=>t.participantId===e)),{values:a}=Qf({policyAttributes:t,idCollections:n,participants:i,participant:o});a&&a.forEach((t=>{r[t]||(r[t]=[]),r[t].includes(e)||r[t].push(e)}))})),r}({targetParticipantIds:e,policyAttributes:u,idCollections:S,participants:i}),D=Object.assign({},...e.map((e=>{const t=Object.keys(P).filter((t=>P[t].includes(e)));return{[e]:t}}))),N=ih({participantIds:e,positionAssignments:h});if(N.length>g.length)return{error:"More participantIds than unpaired positions"};let M;const T=[],E=N.length,A=Eo(0,l).map((()=>uh({initialPositionAssignments:h,participantsWithGroupings:v,unseededParticipantIds:e,opponentsToPlaceCount:E,pairedPriority:!1,participantIdGroups:D,drawPositionChunks:b,drawPositionGroups:U,policyAttributes:u,idCollections:S,allGroups:P})));if(M=A.reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0),!M||M.conflicts){const t=Eo(0,l).map((()=>uh({initialPositionAssignments:h,participantsWithGroupings:v,unseededParticipantIds:e,opponentsToPlaceCount:E,pairedPriority:!0,participantIdGroups:D,drawPositionChunks:b,drawPositionGroups:U,policyAttributes:u,idCollections:S,allGroups:P,entries:s})));M=A.concat(...t).filter((e=>{var t;return!(null!==(t=e.errors)&&void 0!==t&&t.length)})).reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0)}if(!M)return{error:"Could not produce candidate"};const R=(p.positionAssignments||[]).filter((e=>e.participantId)).map((e=>e.participantId));return M.positionAssignments.filter((e=>!R.includes(e.participantId))).forEach((e=>{if(e.participantId&&!e.bye){const i=Yp(f({automaticPlacement:!0,drawDefinition:n,structureId:o,matchUpsMap:r,inContextDrawMatchUps:t},e));null!=i&&i.success||T.push(i)}})),T.length?{error:T,conflicts:M.conflicts}:Object.assign({positionAssignments:M.positionAssignments,conflicts:M.conflicts},ko)}({unseededParticipantIds:m,inContextDrawMatchUps:e,candidatesCount:n,drawDefinition:t,participants:i,matchUpsMap:r,structureId:o,avoidance:g,entries:p});return function({unseededParticipantIds:e,inContextDrawMatchUps:t,unfilledDrawPositions:n,drawDefinition:i,matchUpsMap:r,structureId:o}){const a=So(n);for(const s of e){const e=Yp({automaticPlacement:!0,inContextDrawMatchUps:t,drawDefinition:i,participantId:s,drawPosition:a.pop(),matchUpsMap:r,structureId:o});if(e&&e.error)return e}return ko}({unseededParticipantIds:m,inContextDrawMatchUps:e,unfilledDrawPositions:h,drawDefinition:t,structureId:o,matchUpsMap:r})}function ph({orderedSeedDrawPositions:e,relevantMatchUps:t}){const n=t.map((e=>e.drawPositions)).map((e=>null==e?void 0:e.sort(((e,t)=>e-t)))).filter((e=>(null==e?void 0:e[0])+1===(null==e?void 0:e[1])));return e.map((e=>n.find((t=>null==t?void 0:t.includes(e))))).filter(Boolean).map((t=>null==t?void 0:t.reduce(((t,n)=>e.includes(n)?t:n),void 0))).filter(Boolean)}function mh({blockOrdered:e=!1,drawDefinition:t,matchUpsMap:n,structureId:i,structure:r,seedsOnly:o,event:a}){r||({structure:r}=ad({drawDefinition:t,structureId:i})),i||({structureId:i}=r);const{byesCount:s,placedByes:c,relevantMatchUps:u}=function({drawDefinition:e,event:t,matchUpsMap:n,structure:i}){var r;const{matchUps:o,roundMatchUps:a}=Xd({drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:i,event:t}),s=a&&a[1]||[],c=(null==i?void 0:i.structureType)===au,u=c?o:s,d=c?(null==i||null===(r=i.structures)||void 0===r?void 0:r.length)||0:o.length,{structureId:l,stage:p,stageSequence:m}=i,f=Vd({drawDefinition:e,stageSequence:m,entryStatuses:[Sd,bd],structureId:l,stage:p}),h=jd({drawDefinition:e,stage:p}),v=f.length+h,{positionAssignments:g,unassignedPositions:I}=Kd({structure:i}),y=I.map((e=>e.drawPosition)),w=g.filter((e=>e.bye)).length,U=g.filter((e=>e.bye)).map((e=>e.drawPosition)),b=u.map((e=>e.drawPositions)).filter((e=>e&&(null==e?void 0:e.reduce(((e,t)=>!U.includes(t)&&e),!0)))).flat(1/0).filter((e=>y.includes(e)));let S=g.length-v;return S>d&&1===i.stageSequence&&i.stage!==nu&&(S=d),{placedByes:w,byesCount:S,relevantMatchUps:u,placedByePositions:U,roundMatchUps:a,positionsToAvoidDoubleBye:b}}({drawDefinition:t,matchUpsMap:n,structure:r,event:a}),d=s-c;if(d<=0)return ko;const{appliedPolicies:l}=td({drawDefinition:t}),{strictSeedOrderByePositions:p,blockSeedOrderByePositions:m,isFeedIn:v,isLucky:g}=function({relevantMatchUps:e,appliedPolicies:t,drawDefinition:n,structure:i}){const{validSeedBlocks:r,isFeedIn:o,isLucky:a,isContainer:s}=Wp({appliedPolicies:t,drawDefinition:n,structure:i}),c=function({drawDefinition:e,structure:t}){const{positionAssignments:n}=Kd({structure:t}),{seedAssignments:i}=Wd({drawDefinition:e,structure:t}),r=Object.assign({},...i.filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))));return n.map((e=>r[e.participantId]?h(f({},e),{seedNumber:r[e.participantId].seedNumber,seedValue:r[e.participantId].seedValue}):"")).filter(Boolean)}({drawDefinition:n,structure:i}),u=bo([].concat(...e.map((e=>e.drawPositions)))),d=c.filter((e=>u.includes(e.drawPosition))),l=[].concat(...r.map((e=>So(e.drawPositions)))).filter((e=>u.includes(e))),p=(e,t)=>e.seedValue-t.seedValue;return{strictSeedOrderByePositions:ph({orderedSeedDrawPositions:r.reduce(((e,t)=>{const n=d.filter((e=>{var n;return null===(n=t.drawPositions)||void 0===n?void 0:n.includes(e.drawPosition)})).sort(p);return e.concat(...n)}),[]).map((e=>e.drawPosition)),relevantMatchUps:e}).slice(0,c.length),blockSeedOrderByePositions:ph({orderedSeedDrawPositions:l,relevantMatchUps:e}).slice(0,c.length),isContainer:s,isFeedIn:o,isLucky:a}}({relevantMatchUps:u,appliedPolicies:l,drawDefinition:t,structure:r}),I=e?m:p,{unseededByePositions:y}=function({appliedPolicies:e,structure:t,isFeedIn:n,isLucky:i}){var r;const o=null==e||null===(r=e.seeding)||void 0===r?void 0:r.seedingProfile,{positionAssignments:a}=Kd({structure:t}),s=a.filter((e=>e.participantId)).map((e=>e.drawPosition)),{matchUps:c,roundMatchUps:u}=Xd({matchUpFilters:{isCollectionMatchUp:!1},structure:t}),d=u&&u[1]||[],l=t.structureType===au?c:d,p=bo([].concat(...l.map((e=>e.drawPositions)))),m=Math.min(...p)-1,f=s.filter((e=>p.includes(e))),h=e=>{const t=Math.ceil(e.length/2),n=[e.slice(0,t),e.slice(t)],i=n.map((e=>[].concat(...e.flat(1/0)).length)),r=Math.min(...i.flat(1/0)),o=Math.max(...i.flat(1/0)),a=i.indexOf(o),s=r!==o,c=So(n),[u,d]=!r||s?[n[a],n[1-a]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:d}},v=e=>{const{greaterHalf:t,lesserHalf:n}=h(e),{greaterHalf:i,lesserHalf:r}=h(t),o=So(i.flat(1/0)).pop();return{newlyFilteredChunks:[...n,...r,i.flat().filter((e=>e!==o))],drawPosition:o}},g=e=>!f.includes(e),I=e=>{let t=xo(e.sort(Xa),Math.ceil(e.length/4)).map((e=>e.filter(g)));const n=[].concat(...t.flat(1/0)).length,i=[];for(let r=0;r<n;r++){const{newlyFilteredChunks:e,drawPosition:n}=v(t);i.push(n),t=e}return i},{validSeedBlocks:y}=Wp({allPositions:!0,appliedPolicies:e,structure:t});let w=y.map((e=>{var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.map((e=>e+m))})).map(I).filter((e=>e.length));if(n){const e=p.length,{seedBlocks:t}=_p({participantsCount:e,cluster:"CLUSTER"===o});w=t.map((e=>e.map((e=>e+m)))).map(I).filter((e=>e.length))}const U=l.map((e=>e.drawPositions)).map((e=>null==e?void 0:e.sort(((e,t)=>e-t)))).filter((e=>(null==e?void 0:e[0])+1===(null==e?void 0:e[1]))),b=e=>U.reduce(((t,n)=>n.includes(e)?n.reduce(((t,n)=>n!==e?n:t),void 0):t),void 0);return{unseededByePositions:w.map((e=>e.map(b))).flat(1/0).filter(Boolean)}}({appliedPolicies:l,structure:r,isFeedIn:v,isLucky:g}),w=[].concat(...I,...o?[]:y).slice(0,d);for(const f of w){const e=Mp({drawDefinition:t,drawPosition:f,matchUpsMap:n,structureId:i,structure:r});if(null!=e&&e.error)return e}return ko}function fh({drawDefinition:e,structure:t,structureId:n}){t||({structure:t}=ad({drawDefinition:e,structureId:n})),n||({structureId:n}=t);const{positionAssignments:i}=Kd({structure:t}),r=i.filter((e=>e.qualifier)).map((e=>e.drawPosition)),{stage:o,stageSequence:a}=t,s=jd({drawDefinition:e,stageSequence:a,stage:o});return{unplacedQualifiersCount:s-r.length,placedQualifiersCount:r.length,positionAssignments:i,qualifiersCount:s}}function hh({inContextDrawMatchUps:e,drawDefinition:t,participants:n,groupsCount:i,structureId:r,matchUpsMap:o,structure:a}){const s=[];let c=0;a||({structure:a}=ad({drawDefinition:t,structureId:r})),r||({structureId:r}=a);const{appliedPolicies:u}=td({drawDefinition:t}),{validSeedBlocks:d,error:l}=Wp({structure:a,drawDefinition:t,appliedPolicies:u});return l&&s.push(l),Eo(0,i=i||d.length).forEach((()=>{if(c<i){const i=function({drawDefinition:e,structureId:t,participants:n,matchUpsMap:i,inContextDrawMatchUps:r}){const{unplacedSeedParticipantIds:o,unfilledPositions:a}=Kp({drawDefinition:e,structureId:t,randomize:!0}),{appliedPolicies:s}=td({drawDefinition:e}),{avoidance:c}=s||{};c&&n&&(null==o||o.length);for(const u of o){const n=a.pop();if(!n)return{error:"Missing drawPosition"};const o=Yp({automaticPlacement:!0,inContextDrawMatchUps:r,drawDefinition:e,participantId:u,drawPosition:n,matchUpsMap:i,structureId:t});if(!o.success)return o}return ko}({inContextDrawMatchUps:e,drawDefinition:t,participants:n,structureId:r,matchUpsMap:o});i&&i.success&&c++,i.error&&s.push({seedPositionError:i.error})}})),{errors:s}}function vh({applyPositioning:e=!0,inContextDrawMatchUps:t,drawDefinition:n,candidatesCount:i,participants:r,structureId:o,matchUpsMap:a,seedsOnly:s,drawType:c,event:u}){e||(Jo(),n=Ja(n,!1,!0));const d=t=>(e||ua(),t),{structure:l,error:p}=ad({drawDefinition:n,structureId:o});if(p)return d({error:p});const m=[Sd,bd],h=Vd({stageSequence:l.stageSequence,stage:l.stage,drawDefinition:n,entryStatuses:m,structureId:o});if(null==h||!h.length)return v=f({},ko),e||ua(),v;var v;const{seedingProfile:g}=l;if(a=a||id({drawDefinition:n}),t||({matchUps:t}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:a})),"WATERFALL"===g){let e=mh({drawDefinition:n,matchUpsMap:a,structure:l,seedsOnly:s,event:u});if(e.error)return d(e);if(e=hh({inContextDrawMatchUps:t,drawDefinition:n,participants:r,matchUpsMap:a,structure:l}),e.error)return d(e)}else{if(c!==mu){let e=hh({inContextDrawMatchUps:t,drawDefinition:n,participants:r,matchUpsMap:a,structure:l});if(e.error)return d(e)}const e=mh({inContextDrawMatchUps:t,drawDefinition:n,matchUpsMap:a,structure:l,seedsOnly:s,event:u});if(e.error)return d(e)}const I={};if(!s){let e=lh({inContextDrawMatchUps:t,candidatesCount:i,drawDefinition:n,participants:r,matchUpsMap:a,structure:l});if(e.error)return d(e);if(e.conflicts&&(I.unseededConflicts=e.conflicts),e=function(e){let{structure:t,structureId:n}=e;if(t||({structure:t}=ad(e)),n||({structureId:n}=t),t.stage===nu)return console.log("Consolation Stage: No Qualifiers"),{error:"Consolation Stage: No Qualifiters"};const{positionAssignments:i,unplacedQualifiersCount:r}=fh(e),o=i.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));return r>o.length?{error:"Insufficient drawPositions to accommodate qualifiers"}:(Eo(0,r).forEach((()=>{const e=o.pop();i.forEach((t=>{t.drawPosition===e&&(t.qualifier=!0,delete t.participantId,delete t.bye)}))})),ko)}({inContextDrawMatchUps:t,drawDefinition:n,participants:r,matchUpsMap:a,structure:l}),e.error)return d(e);e.conflicts&&(I.qualifierConflicts=e.conflicts)}const{positionAssignments:y}=Hd({drawDefinition:n,structure:l});return zu({drawDefinition:n,structureIds:[o]}),e||ua(),f({positionAssignments:y,conflicts:I},ko)}!function(){const e={getState:({convertExtensions:e,removeExtensions:t}={})=>function({convertExtensions:e,removeExtensions:t}){const n=Ia();return{tournamentId:va(),tournamentRecords:Ja(n,e,!1,t)}}({convertExtensions:e,removeExtensions:t}),version:()=>"0.74.1",reset:()=>(wa({}),t())};return[zm,zf,Jf,_f].forEach((t=>{Object.keys(t).forEach((i=>{e[i]=e=>{if(sa())return n(t[i],e);try{return n(t[i],e)}catch(r){const t=r.toString();console.log("ERROR",{error:t,method:i,params:JSON.stringify(e)}),console.log(r)}}}))})),e.devContext=e=>(ca(e),t()),e.getDevContext=e=>sa(e),e.setState=(e,n,i)=>(da(n,i),t(Zf(e,n))),e.setTournamentRecord=(e,n,i)=>(da(n,i),t(function(e,t=!0){return"object"!=typeof e||Array.isArray(e)?{error:"Invalid object"}:e.tournamentId?ya(t?Ja(e):e):{error:_o}}(e,n))),e.removeTournamentRecord=e=>t(ba(e)),e.removeUnlinkedTournamentRecords=()=>t(function(){var e;const t=Ia(),{extension:n}=Kl({tournamentRecords:t,name:"linkedTournamentsIds"}),i=(null==n||null===(e=n.value)||void 0===e?void 0:e.tournamentIds)||[];return Object.keys(t).forEach((e=>{i.includes(e)||delete t[e]})),wa(t)}()),e.executionQueue=(t,n)=>function(t,n){if(!Array.isArray(t))return{error:_o};const i=Ia(),r=n&&Ja(i,!1,!0),o=[];for(const a of t){if("object"!=typeof a)return{error:_o};const{method:t,params:n}=a;if(!e[t])return{error:"Method not found"};const s=e[t](h(f({},n),{tournamentRecords:i}));if(null!=s&&s.error)return r&&Zf(r),h(f({},s),{rolledBack:!!r});o.push(s)}return Hm(),ma(),{results:o}}(t,n),e;function t(t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function n(t,n){delete e.success,delete e.error;const i=Ia(),r=(null==n?void 0:n.rollbackOnError)&&Ja(i,!1,!0),o=t(h(f({},n),{tournamentRecords:i}));null!=o&&o.error&&r&&Zf(r);const a=(null==o?void 0:o.success)&&!0!==(null==n?void 0:n.delayNotify)&&!0!==(null==n?void 0:n.doNotNotify);return a&&Hm(),(a||null==o||!o.success||null!=n&&n.doNotNotify)&&ma(),o}}();const gh=({finishingPosition:e="ROUND_OUTCOME",structureAbbreviation:t,seedAssignments:n=[],stageSequence:i=1,qualifyingRoundNumber:r,seedingProfile:o,matchUpFormat:a,structureType:s,structureName:c,matchUps:u=[],structureId:d,exitProfile:l,roundOffset:p,roundLimit:m,stageOrder:f,structures:h,stage:v})=>{const g={structureId:d||es(),structureAbbreviation:t,finishingPosition:e,seedAssignments:n,matchUpFormat:a,stageSequence:i,structureName:c};v&&(g.stage=v),f&&(g.stageOrder=f),m&&(g.roundLimit=m),p&&(g.roundOffset=p),s&&(g.structureType=s),o&&(g.seedingProfile=o),r&&(g.qualifyingRoundNumber=r),l&&(g.exitProfile=l);const I=[].concat(...u.map((e=>e.drawPositions))).filter(Boolean);return h?g.structures=h:(g.matchUps=u,g.positionAssignments=bo(I).sort(((e,t)=>e-t)).map((e=>({drawPosition:e})))),g};function Ih({finishingPositionOffset:e=0,positionsFed:t,roundsCount:n,roundLimit:i,matchUps:r,lucky:o,fmlc:a}){const{roundProfile:s,roundNumbers:c}=nd({matchUps:r}),u=Object.values(s).map((({matchUpsCount:e})=>e)),d=e=>[Math.min(...e),Math.max(...e)],l=i?n-i:0,p=Object.assign({},...c.map((i=>{const r=n+1-i-l,c=s[i].matchUpsCount,p={finishingRound:r},m=u.slice(i-1).reduce(((e,t)=>e+t),0),f=1+e+(a&&1!==i?t:0),h=Eo(f,o?f+2*c:m+f+1),v=m+1-c,g=d(h.slice(v)),I=d(h.slice(0,v));return p.finishingPositionRange={loser:g,winner:I},{[i]:p}})));return r.forEach((e=>{const t=p[e.roundNumber];e.finishingRound=t.finishingRound,e.finishingPositionRange=t.finishingPositionRange})),r}function yh({idPrefix:e,roundNumber:t,roundPosition:n,uuids:i}){return e?`${e}-${t}-${n}`:(null==i?void 0:i.pop())||es()}function wh({includeMatchUpType:e,matchUpType:t,roundNumber:n,matchUps:i,idPrefix:r,isMock:o,uuids:a,nodes:s}){let c=0;const u=[];let d=1;const l=n-1,p=s.length;for(;c<p;){const p=s[c],m=s[c+1];l&&(p.roundNumber=l),m&&l&&(m.roundNumber=l);const f={roundPosition:d,children:[p,m],matchUpId:yh({roundPosition:d,roundNumber:n,idPrefix:r,uuids:a})};u.push(f);const h={matchUpId:f.matchUpId,roundNumber:n,roundPosition:d,matchUpStatus:eo,drawPositions:f.children.map((e=>e.drawPosition))};e&&(h.matchUpType=t),o&&(h.isMock=!0),i.push(h),d++,c+=2}return{roundNodes:u,matchUps:i}}function Uh({qualifyingRoundNumber:e,finishingPositionOffset:t,qualifyingPositions:n,matchUpType:i,roundLimit:r,idPrefix:o,drawSize:a,isMock:s,uuids:c}){if(isNaN(a)||!mo(a)||a<2)return{matchUps:[],roundsCount:0};const u=Eo(1,parseInt(a)+1).map((e=>({drawPosition:e})));let d,l=[],p=1;for(({roundNodes:d,matchUps:l}=wh({roundNumber:p,matchUpType:i,idPrefix:o,matchUps:l,isMock:s,nodes:u,uuids:c})),p++,r=r||e;d.length>1;)n&&d.length===n&&(r=p-1),({roundNodes:d,matchUps:l}=wh({nodes:d,roundNumber:p,matchUpType:i,idPrefix:o,matchUps:l,isMock:s,uuids:c})),p++;const m=p-1;return l=Ih({finishingPositionOffset:t,roundsCount:m,roundLimit:r,matchUps:l}),r&&(l=l.filter((e=>e.roundNumber<=r))),{matchUps:l,roundsCount:m,roundLimit:r}}function bh({structureName:e="VOLUNTARY_CONSOLATION",structureAbbreviation:t,drawDefinition:n,participants:i,matchUpType:r,structureId:o,automated:a,drawSize:s,event:c}){if(!n)return{error:jo};r=r||n.matchUpType;const{matchUps:u}=Uh({matchUpType:r,drawSize:s}),d=gh({stage:"VOLUNTARY_CONSOLATION",matchUps:u,matchUpType:r,structureName:e,structureAbbreviation:t,structureId:o});return n.structures.push(d),a&&vh({structureId:o||d.structureId,drawDefinition:n,participants:i,event:c}),zu({drawDefinition:n,structureIds:[o]}),f({},ko)}function Sh({targetEntryRound:e=1,sourceRoundNumber:t,sourceStructureId:n,targetStructureId:i,drawDefinition:r}){if(!r)return{error:jo};const o={linkType:"WINNER",source:{roundNumber:t,structureId:n},target:{feedProfile:"DRAW",roundNumber:e,structureId:i}};r.links.push(o),zu({drawDefinition:r})}function Ph({participantIdPairings:e,matchUpIds:t=[],drawDefinition:n,matchUpsCount:i,roundNumber:r,structureId:o,newRound:a}){var s;if("object"!=typeof n)return{error:jo};if("string"!=typeof o)return{error:"Missing structureId"};if(e&&!Array.isArray(e)||i&&!Io(i)||t&&!Array.isArray(t)||!e&&!i)return{error:_o};const c=null==n||null===(s=n.structures)||void 0===s?void 0:s.find((e=>e.structureId===o));let u;const d=(null==c?void 0:c.matchUps).reduce(((e,t)=>(t.roundPosition&&(u=!0),t.roundNumber>e?t.roundNumber:e)),0);if(c.structures||u||"ROUND_OUTCOME"===c.finishingPosition)return{error:"Invalid structure"};if(r&&r-1>d)return{error:_o};const l=r||(a?d+1:d||1),p=(e=e||Eo(0,i).map((()=>({participantIds:[]})))).map((e=>{const n=((null==e?void 0:e.participantIds)||[]).concat([void 0,void 0]).slice(0,2).map(((e,t)=>Za({sideNumber:t+1,participantId:e})));return{matchUpId:t.pop()||es(),roundNumber:l,matchUpStatus:eo,sides:n}})),m=function({drawDefinition:e,structureId:t,matchUps:n}){var i;if("object"!=typeof e)return{error:jo};if("string"!=typeof t)return{error:"Missing structureId"};if(!Array.isArray(n))return{error:_o};const r=null===(i=e.structures)||void 0===i?void 0:i.find((e=>e.structureId===t));if(!r)return{error:"structure not found"};const o=(null==r?void 0:r.matchUps).find((e=>!!e.roundPosition));return r.structures||o||"ROUND_OUTCOME"===r.finishingPosition?{error:"Invalid structure"}:(r.matchUps.push(...n),Gu({drawDefinition:e,matchUps:n}),zu({drawDefinition:e,structureIds:[t]}),f({},ko))}({drawDefinition:n,structureId:o,matchUps:p});return m.error?m:f({matchUpsCount:p.length},ko)}function Dh({event:e,drawId:t,drawDefinition:n,drawName:i}){var r;if(!i||"string"!=typeof i)return{error:_o,drawName:i};const{flightProfile:o}=yp({event:e}),a=null==o||null===(r=o.flights)||void 0===r?void 0:r.find((e=>e.drawId===t));return a&&(a.drawName=i,md({event:e,extension:{name:"flightProfile",value:h(f({},o),{flights:o.flights})}})),n&&(n.drawName=i),a||n?ko:{error:jo}}function Nh({drawDefinition:e,stage:t,drawSize:n}){if(!e)return{error:jo};if(!Fd({drawDefinition:e,stage:t}))return{error:"Invalid stage"};if(n<$d({drawDefinition:e,stage:t})+jd({drawDefinition:e,stage:t}))return{error:"Cannot set drawSize to be less than existing entries"};const{entryProfile:i}=vd({attributes:[{[t]:{drawSize:n}}],drawDefinition:e});return zu({drawDefinition:e}),h(f({},ko),{entryProfile:i})}function Mh({qualifiersCount:e=0,drawDefinition:t,stage:n}){if(!t)return{error:jo};if(!Fd({drawDefinition:t,stage:n}))return{error:"Invalid stage"};if(n!==eu)return{error:"qualifiersCount can only be set for main stage"};const i=Ld({drawDefinition:t,stage:n}),r=Gd({drawDefinition:t,stage:n});return $d({drawDefinition:t,stage:n})+r+e>i?{error:"Total stage Entries cannot be greater than drawPositions"}:(vd({attributes:[{[n]:{qualifiersCount:e}}],drawDefinition:t}),zu({drawDefinition:t}),f({},ko))}function Th({drawDefinition:e,drawSize:t}){if(!e)return{error:jo};const n=Nh({drawDefinition:e,stage:"VOLUNTARY_CONSOLATION",drawSize:t});return n.error?n:(Dh({drawDefinition:e}),ko)}function Eh({drawDefinition:e,structureId:t}){const{structure:n,error:i}=ad({drawDefinition:e,structureId:t});if(i)return{error:i};const{matchUps:r}=Xd({structure:n});return nd({matchUps:r})}function Ah({drawDefinition:e,structureId:t,finishingPositions:n}){const{roundProfile:i}=Eh({drawDefinition:e,structureId:t});return Object.keys(i).reduce(((e,t)=>(Rh(i[t]).forEach((i=>{n.forEach((n=>{(function({position:e,rangeDefinition:t}){if(!Array.isArray(t))return!1;if(t.reduce(((e,t)=>e||isNaN(t)),!1))return!1;const[n,i]=t;return Eo(n,(i||n)+1).includes(e)})({position:n,rangeDefinition:i})&&(e[n]={roundNumber:t})}))})),e)),{})}function Rh(e){var t,n;return[bo((null==e||null===(t=e.finishingPositionRange)||void 0===t?void 0:t.loser)||[]),bo((null==e||null===(n=e.finishingPositionRange)||void 0===n?void 0:n.winner)||[])]}function Ch({drawDefinition:e}){if(!e)return{error:jo};const t=(e.structures||[]).filter((e=>e.structureType!==tu)).map((({structureId:t})=>{const{roundProfile:n}=Eh({drawDefinition:e,structureId:t});return Object.values(n).map(Rh).flat()})).flat(),n=t.filter((e=>1===e.length)).sort(Xa).flat(),i=t.flat();return{positionsNotPlayedOff:Eo(Math.min(...i),Math.max(...i)+1).filter((e=>!n.includes(e))),positionsPlayedOff:n}}function xh({excludeRoundNumbers:e=[],playoffPositions:t=[],drawDefinition:n,structureId:i}){if(!n)return{error:jo};if(!i)return{error:"Missing structureId"};if(!t)return{error:$o,message:"missing playoffPositions"};const{positionsPlayedOff:r,error:o}=Ch({drawDefinition:n});if(o)return{error:o};const a=Ah({finishingPositions:t.filter((e=>!r.includes(e))),drawDefinition:n,structureId:i}),s=Object.values(a).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>parseInt(e))).filter((t=>!e.includes(parseInt(t)))),c=Ah({drawDefinition:n,structureId:i,finishingPositions:r}),u=Object.values(c).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>parseInt(e))),d=s.filter((e=>!u.includes(e))).sort(Xa),{roundProfile:l}=Eh({drawDefinition:n,structureId:i}),p=d.map((e=>{const t=l[e].finishingPositionRange.loser,[n,i]=t;return Eo(n,(i||n)+1)})).flat().sort(Xa),m=d.map((e=>{const t=l[e].finishingPositionRange.loser,[n,i]=t;return{roundNumber:e,finishingPositions:Eo(n,(i||n)+1),finishingPositionRange:t.join("-")}}));return{sourceRounds:[...d,...u],playoffRoundsRanges:m,playoffSourceRounds:d,playedOffSourceRounds:u,playoffPositionsReturned:p}}function Oh({drawDefinition:e,structureId:t}){if(!e)return{error:jo};let{structures:n}=sd({stageSeqence:1,drawDefinition:e,stage:eu});const{positionsNotPlayedOff:i,positionsPlayedOff:r}=Ch({drawDefinition:e});({structures:n}=sd({drawDefinition:e}));const o=n.filter((e=>!t||e.structureId===t)),a={};for(const s of o){const t=null==s?void 0:s.structureId,{playoffSourceRounds:n,playoffRoundsRanges:r,error:o}=kh({playoffPositions:i,drawDefinition:e,structure:s});if(o)return{error:o};a[t]={playoffRoundsRanges:r,playoffRounds:n,structureId:t}}return t?f({positionsPlayedOff:r},a[t]):{positionsPlayedOff:r,availablePlayoffRounds:Object.values(a)}}function kh({playoffPositions:e,drawDefinition:t,structure:n}){var i;if(n.structureType===au)return{playoffSourceRounds:[],playoffRoundsRanges:[]};const r=null==n?void 0:n.structureId,{links:o}=yl({drawDefinition:t,structureId:r});return xh({excludeRoundNumbers:(null==o||null===(i=o.source)||void 0===i?void 0:i.filter((e=>"FIRST_MATCHUP"!==e.linkCondition)).map((e=>{var t;return null===(t=e.source)||void 0===t?void 0:t.roundNumber})))||[],playoffPositions:e,drawDefinition:t,structureId:r})}function Fh(e){return e.matchUpStatus===qr?e.sides.reduce(((e,t)=>t.participantId||e),void 0):e.winningSide?e.sides.reduce(((t,n)=>n.sideNumber===e.winningSide?n.participantId:t),void 0):void 0}function Lh({tieFormat:e,uuids:t,isMock:n}){const{collectionDefinitions:i}=e||{};return{tieMatchUps:(i||[]).map((e=>{const{matchUpCount:i,matchUpFormat:r,matchUpType:o,collectionId:a}=e||{};return Eo(0,i||0).map((e=>({isMock:n,collectionId:a,matchUpType:o,matchUpFormat:r,collectionPosition:e+1,matchUpId:(null==t?void 0:t.pop())||es(),sides:[{sideNumber:1},{sideNumber:2}]})))})).filter(Boolean).flat()}}function jh({includeMatchUpType:e,drawPosition:t,matchUpType:n,roundNumber:i,idPrefix:r,matchUps:o,uuids:a,nodes:s,fed:c}){const u=s.length,d=t?t-u:void 0,l=Eo(0,u).map((e=>d?d+e:void 0)),p=[];for(let m=0;m<u;m++){const t=l.shift(),u={feed:!0,fed:c+1,drawPosition:t},d=s[m];d.roundNumber=i-1;const f={roundNumber:i,matchUpId:yh({roundPosition:d.roundPosition,roundNumber:i,idPrefix:r,uuids:a}),roundPosition:d.roundPosition,drawPositions:[void 0,t]};e&&(f.matchUpType=n),o.push(f);const h={children:[d,u]};p.push(h)}return{roundNodes:p,matchUps:o,drawPosition:t?t-u:void 0}}function Bh({linkFedFinishingRoundNumbers:e=[],linkFedRoundNumbers:t=[],finishingPositionOffset:n,feedRoundsProfile:i=[],feedRounds:r=0,skipRounds:o=0,feedsFromFinal:a,isConsolation:s,baseDrawSize:c,matchUpType:u,idPrefix:d,drawSize:l,isMock:p,uuids:m,fmlc:f}){const h=function({drawSize:e}){return Eo(0,Math.ceil(Math.log(e)/Math.log(2))).reverse().map((e=>Math.pow(2,e)))}({drawSize:c=c||function(e){const t=fo(e);return t>e?t/2:t}(l)}),v=h.length;let g=0;if(i.length)g=i.reduce(((e,t)=>e+t),0);else if(l){let e=l-c;i=h.filter((t=>t<=e&&(e-=t,!0))),g=i.reduce(((e,t)=>e+t),0),r=i.length}else o>=v&&(r=0),a&&(r=v-a,o=0),i=h.filter(((e,t)=>a&&!r||r&&t>=o+r||t<o?0:e)),g=i.reduce(((e,t)=>e+t),0),l=c+g,r=i.length;const I=[...h,...i].sort(((e,t)=>t-e)),y=I.length,w=[...t.map((e=>e-1)),...e.map((e=>y-e))].map((e=>I[e])).reduce(((e,t)=>e+t),0);g-=w;let U,b=0,S=[],P=1,D=Eo(0,c).map(((e,t)=>({drawPosition:t+1+g}))),N=g+1;for(const T of h){if(({roundNodes:U,matchUps:S}=wh({roundNumber:P,matchUpType:u,idPrefix:d,matchUps:S,isMock:p,nodes:D,uuids:m})),P++,i.includes(T)){const n=Eo(0,Po(i)[T]),r=y+1-P,o=e.includes(r)||t.includes(P);for(const e of n){const t=!o&&N||void 0;({roundNodes:U,matchUps:S,drawPosition:N}=jh({drawPosition:t,nodes:U,roundIteration:e,roundNumber:P,matchUpType:u,idPrefix:d,matchUps:S,uuids:m,fed:b})),P++,b+=1}}D=U}y!==P-1&&console.log("ERROR"),S=Ih({finishingPositionOffset:s?c-g:n,positionsFed:g,roundsCount:y,matchUps:S,fmlc:f});const M=U&&U.length?U[0]:U;return M&&(M.roundNumber=P-1,M.matchUps=S),{draw:M,matchUps:S,roundsCount:y}}function Vh(e){const{structure:t,childStructures:n}=$h(e),i=[t.structureId,...n.map((({structureId:e})=>e))];return e.drawDefinition.structures.sort(od),zu({drawDefinition:e.drawDefinition,structureIds:i}),Object.assign({structure:t,childStructures:n},ko)}function $h({finishingPositionOffset:e=0,playoffStructureNameBase:t,finishingPositionNaming:n,finishingPositionLimit:i,playoffAttributes:r,stageSequence:o=1,exitProfile:a="0",exitProfileLimit:s,roundOffsetLimit:c,roundOffset:u=0,drawDefinition:d,staggeredEntry:l,sequenceLimit:p,stage:m=eu,matchUpType:f,idPrefix:h,drawSize:v,isMock:g,uuids:I}){if(r&&s&&(!r||!r[a])||v<2||p&&o>p)return{};f=f||(null==d?void 0:d.matchUpType);const y=e+1,w=`${y}-${e+v}`,U=r&&r[a],b=t&&`${t} `||"",S=n&&n[w],P=(null==S?void 0:S.name)||(null==U?void 0:U.name)||`${b}${w}`,D=(null==S?void 0:S.abbreviation)||(null==U?void 0:U.abbreviation),N={idPrefix:h&&`${h}-${P}-RP`,finishingPositionOffset:e,matchUpType:f,drawSize:v,isMock:g,uuids:I},{matchUps:M}=l?Bh(N):Uh(N),T=gh({structureId:null==I?void 0:I.pop(),structureAbbreviation:D,stageSequence:o,structureName:P,matchUpType:f,roundOffset:u,exitProfile:a,matchUps:M,stage:m});d.structures.push(T),Gu({drawDefinition:d,matchUps:M});const E=Math.ceil(Math.log(v)/Math.log(2)),A=Eo(1,(c?Math.min(c-u,E):!i||y<i?E:0)+1).map((function(l){const g=v/Math.pow(2,l);if(g<2)return;const y=v/Math.pow(2,l)+e;if(y+1>i)return;const{structure:w,structureName:U,childStructures:b}=$h({finishingPositionOffset:y,exitProfile:`${a}-${l}`,roundOffset:u+l,stageSequence:o+1,drawSize:g,playoffStructureNameBase:t,finishingPositionNaming:n,finishingPositionLimit:i,playoffAttributes:r,exitProfileLimit:s,roundOffsetLimit:c,drawDefinition:d,sequenceLimit:p,matchUpType:f,idPrefix:h,uuids:I,stage:m}),S={linkType:cu,source:{roundNumber:l,structureName:P,structureId:null==T?void 0:T.structureId},target:{roundNumber:1,feedProfile:su,structureName:U,structureId:null==w?void 0:w.structureId}};return T&&w&&d.links.push(S),{structure:w,childStructures:b}})).filter(Boolean);return{structure:T,structureName:P,childStructures:A}}function Gh(e){var t;const{playoffRoundsRanges:n,playoffRounds:i,error:r}=Oh(e);if(r)return{error:r};const{playoffSourceRounds:o,playoffRoundsRanges:a,playoffPositionsReturned:s,error:c}=xh(e);if(c)return{error:c};const{structureId:u,playoffStructureNameBase:d,playoffAttributes:l,playoffPositions:p,exitProfileLimit:m,drawDefinition:h,roundProfiles:v,roundNumbers:g,idPrefix:I,isMock:y,event:w,uuids:U}=e,b=(null==v?void 0:v.length)&&Object.assign({},...v),S=g||"object"==typeof v&&v.map((e=>Object.keys(e))).flat(),P=S&&S.map((e=>!isNaN(e)&&parseInt(e))).filter(Boolean);if(P){if(!Array.isArray(P))return{error:_o,validRoundNumbers:P};P.forEach((e=>{if(!i.includes(e))return{error:_o,roundNumber:e}}))}p&&p.forEach((e=>{if(!s.includes(e))return{error:_o,playoffPosition:e}}));const{structure:D}=ad({structureId:u,drawDefinition:h}),N=P||o,M=P?n:a,T=[],E=[];for(const f of N){const e=M.find((e=>e.roundNumber===f));if(!e)return{error:_o,message:{roundNumber:f}};const t=e.finishingPositions.length,n=Math.min(...e.finishingPositions)-1,i=2,r=b&&b[f]&&i+b[f]-1,o=Vh({exitProfile:`0-${f}`,playoffStructureNameBase:d,finishingPositionOffset:n,playoffAttributes:l,exitProfileLimit:m,stage:iu,drawDefinition:h,roundOffset:0,sequenceLimit:r,stageSequence:i,drawSize:t,idPrefix:I,isMock:y,uuids:U});if(o.error)return o;if(o.structure){E.push(o.structure.structureId);const e={linkType:cu,source:{structureId:u,roundNumber:f},target:{structureId:o.structure.structureId,feedProfile:su,roundNumber:1}};T.push(e)}}if(!E.length)return{error:_o};h.links=(h.links||[]).concat(...T);const{matchUps:A,matchUpsMap:R}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:h}),C=A.filter((({structureId:e})=>E.includes(e))).map(ed),x=null==R||null===(t=R.drawMatchUps)||void 0===t?void 0:t.filter((({matchUpId:e})=>C.includes(e)));if(x.length){const e=h.tieFormat||(null==w?void 0:w.tieFormat)||void 0;e&&x.forEach((t=>{const{tieMatchUps:n}=Lh({tieFormat:e,isMock:y});Object.assign(t,{tieMatchUps:n,matchUpType:Bs})}))}return A.filter((e=>is(e)&&e.structureId===u)).forEach((e=>{const{matchUpId:t,score:n,winningSide:i}=e,r=wl({inContextDrawMatchUps:A,drawDefinition:h,matchUpId:t,structure:D}),o=Jp({inContextDrawMatchUps:A,drawDefinition:h,matchUpsMap:R,winningSide:i,targetData:r,matchUpId:t,structure:D,matchUp:e,score:n});o.error&&console.log(o.error)})),e.goesTo&&Bl({inContextDrawMatchUps:A,drawDefinition:h,matchUpsMap:R}),zu({drawDefinition:h,structureIds:E}),f({},ko)}function _h({drawDefinition:e,structureId:t,matchUpIds:n=[]}){var i;if("object"!=typeof e)return{error:jo};if("string"!=typeof t)return{error:"Missing structureId"};if(!Array.isArray(n))return{error:_o};const r=null===(i=e.structures)||void 0===i?void 0:i.find((e=>e.structureId===t));if(!r)return{error:"structure not found"};const o=null==r?void 0:r.matchUps,a=o.find((e=>!!e.roundPosition));if(r.structures||a||"ROUND_OUTCOME"===r.finishingPosition)return{error:"Invalid structure"};const s=o.filter((({matchUpId:e})=>n.includes(e))),c=Ju(s),u=s.map((({drawPositions:e})=>e)).flat();if(u.length){r.positionAssignments=r.positionAssignments.filter((({drawPosition:e})=>!u.includes(e))).sort(((e,t)=>e.drawPosition-t.drawPosition)),r.matchUps=r.matchUps.filter((({matchUpId:e})=>!c.includes(e)));const n=Object.assign({},...r.positionAssignments.map((({drawPosition:e},t)=>({[e]:t+1}))));r.positionAssignments=r.positionAssignments.map((e=>h(f({},e),{drawPosition:n[e.drawPosition]})));const i=e=>{var t;return e.drawPositions=(null===(t=e.drawPositions)||void 0===t?void 0:t.map((e=>n[e])))||[]};r.matchUps.forEach(i),_u({drawDefinition:e,matchUpIds:c,action:"deleteAdHocMatchUps"}),zu({drawDefinition:e,structureIds:[t]})}return f({},ko)}function Wh({consolationStructure:e,roundOffset:t=0,mainStructure:n,roundsCount:i,feedPolicy:r,fmlc:o}){const a=e.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),s=(null==r?void 0:r.roundGroupedOrder)||[],c=null==r?void 0:r.roundFeedProfiles;return Eo(1+t,i+1+t).map((i=>{const r=c&&c[i-1]?c[i-1]:i%2?su:"BOTTOM_UP",u=i-t<=2?i-t:2*(i-t-2)+2,d={linkType:cu,source:{roundNumber:i,structureId:n.structureId},target:{feedProfile:r,roundNumber:u,structureId:e.structureId}},l=s[i-1];return l&&(d.target.groupedOrder=l),sa()&&(d.source.structureName=n.structureName,d.target.structureName=e.structureName),2===i&&o&&(d.linkCondition="FIRST_MATCHUP",d.target.feedProfile=su),a.includes(u)?d:void 0})).filter(Boolean)}function qh(e={}){const{finishingPositionOffset:t,stageSequence:n=1,feedsFromFinal:i,staggeredEntry:r,drawDefinition:o,structureName:a,matchUpType:s,feedPolicy:c,feedRounds:u,idPrefix:d,drawSize:l,isMock:p,uuids:m,fmlc:h}=e,v={finishingPositionOffset:t,matchUpType:s,drawSize:l,idPrefix:d,isMock:p,uuids:m},{matchUps:g}=r?Bh(v):Uh(v),I=gh({structureName:a||eu,structureId:null==m?void 0:m.pop(),stageSequence:n,stage:eu,matchUpType:s,matchUps:g});o.structures.push(I);const y=l/2,{matchUps:w,roundsCount:U}=Bh({finishingPositionOffset:y,idPrefix:d&&`${d}-c`,isConsolation:!0,feedsFromFinal:i,baseDrawSize:y,matchUpType:s,feedRounds:u,isMock:p,uuids:m,fmlc:h}),b=gh({matchUps:w,structureId:null==m?void 0:m.pop(),structureName:nu,stage:nu,stageSequence:1,matchUpType:s});o.structures.push(b);const S=Wh({consolationStructure:b,mainStructure:I,roundsCount:U,feedPolicy:c,fmlc:h});return o.links=o.links.concat(...S),Object.assign({structures:[I,b],links:o.links},f({},ko))}function zh({structureName:e=eu,stageSequence:t=1,structureOptions:n,seedingProfile:i,drawDefinition:r,stage:o=eu,matchUpType:a,drawSize:s,idPrefix:c,uuids:u}){const{groupCount:d,groupSize:l}=function({structureOptions:e,drawSize:t}){let n=null==e?void 0:e.groupSize;const i=function({drawSize:e,groupSizeLimit:t=10}){return Eo(3,t+1).filter((t=>Math.ceil(e/t)*t-e<t))}({drawSize:t,groupSizeLimit:(null==e?void 0:e.groupSizeLimit)||8}),r=Math.max(...i);n&&i.includes(n)||(n=n&&n>4||!i.includes(4)?r:4);return{groupSize:n,groupCount:Math.ceil(t/n)}}({structureOptions:n,drawSize:s}),p="WIN_RATIO",m=Eo(1,d+1).map((e=>gh({structureName:`Group ${e}`,matchUps:Kh({groupSize:l,structureOrder:e,matchUpType:a,drawSize:s,idPrefix:c}),structureId:null==u?void 0:u.pop(),structureType:"ITEM",finishingPosition:p,structureOrder:e,matchUpType:a}))),h=gh({structureId:null==u?void 0:u.pop(),structureType:au,finishingPosition:p,seedingProfile:i,structureName:e,stageSequence:t,matchUpType:a,structures:m,stage:o});return r.structures.push(h),Object.assign({structures:[h],groupCount:d,groupSize:l},f({},ko))}function Hh({finishingPositions:e,playoffStructure:t,mainStructure:n}){return{linkType:"POSITION",source:{finishingPositions:e,structureId:n.structureId},target:{roundNumber:1,feedProfile:"DRAW",structureId:t.structureId}}}function Kh({structureOrder:e,matchUpType:t,groupSize:n,idPrefix:i,drawSize:r,uuids:o}){const a=(e-1)*n,s=Eo(1+a,n+1+a),{uniqueMatchUpGroupings:c}=oh({drawPositions:s}),u=function({groupSize:e,drawPositionOffset:t}){const n=e=>[...Array(e)].map(((e,t)=>t)),i=n(2*Math.round(e/2)+1).slice(1),r=n(i.length-1).map((()=>[]));let o=i.slice(0,i.length/2),a=i.slice(i.length/2);i.slice(1).forEach(((e,t)=>{o.forEach(((e,n)=>{r[t].push([o[n],a[n]])}));const n=o.shift(),i=o.pop(),s=a.shift();o=[].concat(n,s,...o),a=[].concat(...a,i)}));const s=o.shift(),c=o.pop(),u=a.shift();o=[].concat(s,u,...o),a=[].concat(...a,c);const d=e=>e[0].reduce(((e,t)=>e+t));return r.reverse().sort(((e,t)=>d(e)-d(t))).map((n=>n.filter((t=>t.every((t=>t<=e)))).map((e=>ah(e.map((e=>e+t)))))))}({groupSize:n,drawPositionOffset:a});return c.map((function(n){const a=(d=ah(n),u.reduce(((e,t,n)=>t.includes(d)?n+1:e),void 0)),s=[1,r],c=function({structureOrder:e,drawPositions:t,roundNumber:n,idPrefix:i,uuids:r}){return i?`${i}-${e}-${n}-DP-${t.join("-")}`:(null==r?void 0:r.pop())||es()}({structureOrder:e,drawPositions:n,roundNumber:a,idPrefix:i,uuids:o});var d;return{matchUpStatus:a?eo:qr,matchUpType:t,finishingPositionRange:{winner:s,loser:s},drawPositions:n,roundNumber:a,matchUpId:c}})).sort(((e,t)=>(e.roundNumber||9999)-(t.roundNumber||9999)))}function Yh(e={}){var t,n;const{drawType:i=lu,stageSequence:r=1,drawDefinition:o,staggeredEntry:a,structureName:s,goesTo:c=!0,isMock:u,uuids:d}=e;if(!o)return{error:jo};let{tieFormat:l,matchUpType:p}=e;l=l||o.tieFormat||void 0,p=p||o.matchUpType||Ls;const m=Ld({drawDefinition:o,stage:eu});m||Nh({drawSize:e.drawSize,drawDefinition:o,stage:eu});const v=(null===(t=e.qualifyingProfiles)||void 0===t?void 0:t.length)&&function({qualifyingProfiles:e,drawDefinition:t,matchUpType:n,idPrefix:i,isMock:r,uuids:o}){const a=[],s=(e,t)=>e.stageSequence-t.stageSequence;let c,u,d=0,l=0,p=0;for(const f of e.sort(s)){var m;const{drawSize:s,qualifyingRoundNumber:h,qualifyingPositions:v,structureName:g}=f;if(!s||!Io(s))return{error:"Missing drawSize"};const{matchUps:I,roundLimit:y}=Uh({qualifyingPositions:v,qualifyingRoundNumber:h,idPrefix:i,drawSize:s,isMock:r,uuids:o});p+=1;const w=g||(e.length>1?`${tu} ${p}`:tu),U=gh({structureName:w,qualifyingRoundNumber:y,structureId:null==o?void 0:o.pop(),stage:tu,stageSequence:p,matchUpType:n,roundLimit:y,matchUps:I});p>1?(Sh({sourceStructureId:u,targetStructureId:U.structureId,sourceRoundNumber:c,drawDefinition:t}),d+=s-l):d+=s,l=null===(m=I.filter((e=>e.roundNumber===y)))||void 0===m?void 0:m.length,u=U.structureId,c=y,a.push(U)}return f({qualifyingDrawPositionsCount:d,finalQualifyingRoundNumber:c,finalQualifyingStructureId:u,qualifiersCount:l,structures:a},ko)}({qualifyingProfiles:e.qualifyingProfiles,idPrefix:e.idPrefix,drawDefinition:o,matchUpType:p,isMock:u,uuids:d});if(null!=v&&v.error)return v;const{qualifiersCount:g=0,qualifyingDrawPositionsCount:I}=v||{};if(I){if(o.structures.push(...v.structures),!Ld({stage:tu,drawDefinition:o})){const e=Nh({drawSize:I,stage:tu,drawDefinition:o});if(e.error)return e}const e=Mh({drawDefinition:o,qualifiersCount:g,stage:eu});if(e.error)return e}const y=e.drawSize||m;Object.assign(e,Za({drawSize:y,matchUpType:p,tieFormat:l}));const w=mo(2*y/3);if(y<2||!a&&![du,uu,mu].includes(i)&&(i===Iu&&y<3||i===pu&&!w||![Iu,pu,yu].includes(i)&&!mo(y)))return{error:"Invalid drawSize",drawSize:y};const U=bu.includes(i);if(parseInt(y)<4&&U)return{error:"Invalid drawSize"};const b=1===r?1:void 0,{structures:S}=sd({drawDefinition:o,stageSequence:r,stage:eu});if(S.length>=b)return{error:"stageSequence limit"};const P={[uu]:()=>{const e=gh({structureName:s||eu,finishingPosition:"WIN_RATIO",structureId:null==d?void 0:d.pop(),stageSequence:r,matchUps:[],matchUpType:p,stage:eu});return o.structures.push(e),Object.assign({structures:[e]},ko)},[mu]:()=>{const{matchUps:t}=function(e){const{qualifyingRoundNumber:t,finishingPositionOffset:n,qualifyingPositions:i,matchUpType:r,idPrefix:o,drawSize:a,isMock:s,uuids:c}=e;if(!Io(a)||a<2)return{matchUps:[],roundsCount:0};if(mo(a))return Uh(e);const u=function(e){const t=parseInt(e);let n=t%2?t+1:t;const i=[{participantsCount:n,preFeedRound:!!(Math.ceil(n/2)%2)}];for(;n>2;){const e=Math.ceil(n/2),t=1===e,r=!(t||!(e%2));n=!t&&r?e+1:e;const o=!!(2!==n&&Math.ceil(n/2)%2);i.push({participantsCount:n,preFeedRound:o,feedRound:r})}return i}(a),d=Eo(1,u.shift().participantsCount+1).map((e=>({drawPosition:e})));let l=[],p=1;({matchUps:l}=wh({roundNumber:p,matchUpType:r,idPrefix:o,matchUps:l,isMock:s,nodes:d,uuids:c})),p++;let m=e.roundLimit||t;for(const h of u){const e=h.participantsCount/2,t=Eo(1,e+1);i&&e===i&&(m=p-1);const n=t.map((e=>{const t=yh({roundPosition:e,roundNumber:p,idPrefix:o,uuids:c});return{roundPosition:e,roundNumber:p,matchUpId:t}}));l.push(...n),p++}const f=p-1;return l=Ih({finishingPositionOffset:n,lucky:!0,roundsCount:f,roundLimit:m,matchUps:l}),m&&(l=l.filter((e=>e.roundNumber<=m))),{matchUps:l,roundsCount:f,roundLimit:m}}(e),n=gh({structureName:s||eu,structureId:null==d?void 0:d.pop(),stageSequence:r,matchUpType:p,stage:eu,matchUps:t});return o.structures.push(n),Object.assign({structures:[n]},ko)},[lu]:()=>{const{matchUps:t}=Uh(e),n=gh({structureName:s||eu,structureId:null==d?void 0:d.pop(),stageSequence:r,matchUpType:p,stage:eu,matchUps:t});return o.structures.push(n),Object.assign({structures:[n]},ko)},[pu]:()=>function({drawDefinition:e,structureName:t,matchUpType:n,idPrefix:i,drawSize:r,isMock:o,uuids:a}){const{matchUps:s}=Bh({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:n,idPrefix:i,isMock:o}),c=gh({structureName:t||eu,structureId:null==a?void 0:a.pop(),stageSequence:1,stage:eu,matchUpType:n,matchUps:s});e.structures.push(c);const u=r/2,{matchUps:d}=Bh({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:n,isMock:o,uuids:a}),l=gh({matchUps:d,structureId:null==a?void 0:a.pop(),structureName:"BACKDRAW",stageSequence:2,matchUpType:n,stage:eu});e.structures.push(l);const{matchUps:p}=Uh({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:n,isMock:o}),m=gh({matchUps:p,structureId:null==a?void 0:a.pop(),structureName:"DECIDER",stageSequence:3,stage:eu,matchUpType:n});e.structures.push(m);const f=function({mainStructure:e,consolationStructure:t,deciderStructure:n}){const i=t.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),r=e.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0),o=t.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0);return[...[1,2].map((n=>{const i=n%2?su:"BOTTOM_UP";return{linkType:cu,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:i,roundNumber:1,positionInterleave:{offset:n-1,interleave:1},structureId:t.structureId}}})),...i.slice(1).map(((n,r)=>{const o=i.indexOf(n)%2?su:"BOTTOM_UP";return{linkType:cu,source:{roundNumber:3+r,structureId:e.structureId},target:{feedProfile:o,roundNumber:n,structureId:t.structureId}}})),{linkType:"WINNER",source:{roundNumber:o,structureId:t.structureId},target:{feedProfile:su,roundNumber:r,structureId:e.structureId}},{linkType:"WINNER",source:{roundNumber:r,structureId:e.structureId},target:{feedProfile:su,roundNumber:1,structureId:n.structureId}},{linkType:cu,source:{roundNumber:r,structureId:e.structureId},target:{feedProfile:su,roundNumber:1,structureId:n.structureId}}]}({mainStructure:c,consolationStructure:l,deciderStructure:m});return e.links=e.links.concat(...f),Object.assign({structures:e.structures,links:e.links},ko)}(e),COMPASS:()=>Vh(Object.assign(e,{roundOffsetLimit:3,playoffAttributes:wu})),OLYMPIC:()=>Vh(Object.assign(e,{roundOffsetLimit:2,playoffAttributes:Uu})),[iu]:()=>Vh(e),[du]:()=>{const{matchUps:e}=Bh({drawSize:y,uuids:d,matchUpType:p}),t=gh({structureName:s||eu,structureId:null==d?void 0:d.pop(),stageSequence:r,matchUpType:p,stage:eu,matchUps:e});return o.structures.push(t),Object.assign({structures:[t]},ko)},FIRST_ROUND_LOSER_CONSOLATION:()=>function(e){const{finishingPositionOffset:t=0,stageSequence:n=1,drawDefinition:i,staggeredEntry:r,structureName:o,stage:a=eu,matchUpType:s,idPrefix:c,drawSize:u,isMock:d,uuids:l}=e,p={finishingPositionOffset:t,matchUpType:s,drawSize:u,idPrefix:c,isMock:d,uuids:l},{matchUps:m}=r?Bh(p):Uh(p),f=gh({structureName:o||eu,structureId:null==l?void 0:l.pop(),stageSequence:n,matchUpType:s,matchUps:m,stage:a});i&&i.structures.push(f);const h=u/2,{matchUps:v}=Uh({finishingPositionOffset:t+h,idPrefix:c&&`${c}-c`,drawSize:h,matchUpType:s,isMock:d}),g=e.consolationStructureName||(o?`${o} ${nu}`:nu),I=gh({structureName:g,matchUps:v,structureId:null==l?void 0:l.pop(),stage:nu,stageSequence:1,matchUpType:s});i&&i.structures.push(I);const y={linkType:cu,source:{roundNumber:1,structureId:f.structureId},target:{roundNumber:1,feedProfile:su,structureId:I.structureId}};return i&&i.links.push(y),Object.assign({structures:[f,I],links:null==i?void 0:i.links},ko)}(e),FIRST_MATCH_LOSER_CONSOLATION:()=>qh(Object.assign(e,{feedRounds:1,fmlc:!0})),MODIFIED_FEED_IN_CHAMPIONSHIP:()=>qh(Object.assign(e,{feedRounds:1})),[vu]:()=>qh(Object.assign(e,{feedsFromFinal:2})),[hu]:()=>qh(Object.assign(e,{feedsFromFinal:1})),[gu]:()=>qh(Object.assign(e,{feedsFromFinal:3})),FEED_IN_CHAMPIONSHIP:()=>qh(e),[fu]:()=>function({finishingPositionOffset:e,structureName:t=eu,stageSequence:n=1,staggeredEntry:i,drawDefinition:r,matchUpType:o,idPrefix:a,drawSize:s,isMock:c,uuids:u}){const d={finishingPositionOffset:e,matchUpType:o,drawSize:s,idPrefix:a,isMock:c,uuids:u},{matchUps:l,roundsCount:p}=i?Bh(d):Uh(d),m=gh({matchUps:l,matchUpType:o,stage:eu,structureName:t,stageSequence:n,structureId:null==u?void 0:u.pop()});r.structures.push(m);const f=[0,2].slice(0,s/16).map(((e,t)=>{const n=t+1,{consolationStructure:i}=function({stageSequence:e=1,roundOffset:t=0,matchUpType:n,structureId:i,idPrefix:r,drawSize:o,isMock:a,index:s,uuids:c}){const u=o/(2*Math.pow(2,t)),{matchUps:d,roundsCount:l}=Bh({finishingPositionOffset:u,baseDrawSize:u,isConsolation:!0,feedRounds:1,matchUpType:n,idPrefix:r,isMock:a,uuids:c});return{consolationStructure:gh({matchUps:d,stage:nu,structureName:`${nu} ${s+1}`,stageSequence:e,matchUpType:n,structureId:i}),consolationRoundsCount:l}}({structureId:null==u?void 0:u.pop(),idPrefix:a&&`${a}-c${t}`,stageSequence:n,roundOffset:e,matchUpType:o,drawSize:s,isMock:c,index:t,uuids:u});return r.structures.push(i),{consolationStructure:i,links:Wh({mainStructure:m,consolationStructure:i,roundsCount:2,roundOffset:e})}})).map((e=>e.links));if(r.links=r.links.concat(...f),s>=4&&s<=16||s>32){const{matchUps:e}=Uh({finishingPositionOffset:2,idPrefix:a&&`${a}-p3t4`,drawSize:2,matchUpType:o,isMock:c}),t=gh({structureId:null==u?void 0:u.pop(),matchUps:e,structureName:iu,stageSequence:2,matchUpType:o,stage:eu}),n={linkType:cu,source:{roundNumber:p-1,structureId:m.structureId},target:{roundNumber:1,feedProfile:su,structureId:t.structureId}};r.structures.push(t),r.links.push(n)}return Object.assign({structures:r.structures,links:r.links},ko)}(e),[Iu]:()=>zh(e),[yu]:()=>function(e){const{playoffMatchUpFormat:t,stageSequence:n=1,structureOptions:i,drawDefinition:r,matchUpType:o,idPrefix:a,uuids:s}=e,c=Object.assign({structureName:eu},e,{stage:eu}),{structures:[u],groupCount:d,groupSize:l}=zh(c);d<1&&console.log("Invalid configuration");const p=i&&i.playoffGroups||[{finishingPositions:[1],structureName:iu}];let m=0;const h=p.map(((e,i)=>{const c=i+1,p=Eo(1,l+1),f=e.finishingPositions;if(!f.reduce(((e,t)=>p.includes(t)&&e),!0))return;const h=e.drawType||lu,v=d*f.length,g=vo(v);if(h===lu){const{matchUps:i}=Uh({idPrefix:a&&`${a}-po`,finishingPositionOffset:m,matchUpType:o,drawSize:g}),d=gh({matchUps:i,stageOrder:c,matchUpType:o,stageSequence:n,stage:iu,structureId:null==s?void 0:s.pop(),structureName:e.structureName,matchUpFormat:t});r.structures.push(d);const l=Hh({mainStructure:u,playoffStructure:d,finishingPositions:f});return r.links.push(l),m+=v,d}if("FIRST_MATCH_LOSER_CONSOLATION"===h){console.log("RRw/PO FIRST_MATCH_LOSER_CONSOLATION");const t=[null==s?void 0:s.pop(),null==s?void 0:s.pop()],{mainStructure:n,consolationStructure:i,link:c}=qh({structureName:e.structureName,idPrefix:a&&`${a}-po`,finishingPositionOffset:m,uuids:t,stage:iu,feedRounds:1,matchUpType:o,fmlc:!0,drawSize:g}),d=Hh({mainStructure:u,playoffStructure:n,finishingPositions:f});return r.links.push(d),r.structures.push(n),r.structures.push(i),r.links.push(c),m+=v,n}})).filter(Boolean);return Object.assign({structures:[u,...h],links:r.links},f({},ko))}(e)}[i],D=P&&P();if(null==D||!D.success)return{error:"Unrecognized drawType"};if(null!=v&&null!==(n=v.structures)&&void 0!==n&&n.length){const{finalQualifyingRoundNumber:e,finalQualifyingStructureId:t}=v;Sh({sourceStructureId:t,sourceRoundNumber:e,targetStructureId:D.structures.find((({stage:e,stageSequence:t})=>e===eu&&1===t)).structureId,drawDefinition:o})}const{matchUps:N,matchUpsMap:M}=Dl({drawDefinition:o});let T;return l&&N.forEach((e=>{const{tieMatchUps:t}=Lh({tieFormat:l,isMock:u});Object.assign(e,{tieMatchUps:t,matchUpType:p})})),c&&({inContextDrawMatchUps:T}=Bl({drawDefinition:o,matchUpsMap:M})),zu({drawDefinition:o}),h(f({structures:o.structures,links:o.links,inContextDrawMatchUps:T,matchUpsMap:M},ko),{matchUps:N})}function Jh({drawDefinition:e,structureId:t}){var n;if(!e)return{error:jo};if(!t)return{error:"Missing structureId"};const i=[],r=[t],o=(null===(n=e.structures)||void 0===n?void 0:n.map((({structureId:e})=>e)))||[],a=Object.assign({},...o.map((t=>{return{[t]:(n=t,null===(i=e.links)||void 0===i?void 0:i.map((e=>e.source.structureId===n&&e.target.structureId)).filter(Boolean))};var n,i})));for(;r.length;){var s;const t=r.pop(),{structure:n}=ad({drawDefinition:e,structureId:t}),{matchUps:o}=Xd({structure:n}),c=Ju(o);i.push(...c),e.links=(null===(s=e.links)||void 0===s?void 0:s.filter((e=>e.source.structureId!==t&&e.target.structureId!==t)))||[],e.structures=(e.structures||[]).filter((e=>e.structureId!==t));const u=a[t];null!=u&&u.length&&r.push(...u)}const{matchUps:c}=Dl({drawDefinition:e});return c.forEach((e=>{i.includes(e.winnerMatchUpId)&&delete e.winnerMatchUpId,i.includes(e.loserMatchUpId)&&delete e.loserMatchUpId})),_u({drawDefinition:e,matchUpIds:i,action:"removeStructure"}),zu({drawDefinition:e}),h(f({},ko),{removedMatchUpIds:i})}const Zh={getSourceRounds:xh,getDrawStructures:sd,getPositionsPlayedOff:Ch,getStructureQualifiersCount:function({drawDefinition:e,structureId:t,structure:n}){let i,r;if(n||({structure:n,error:i}=ad({drawDefinition:e,structureId:t})),!i)if(n.stage!==tu)i="Structure is not Qualifying";else{const{matchUps:t}=Xd({drawDefinition:e,structure:n});r=t.reduce(((e,t)=>e+(1===t.finishingRound?1:0)),0)}return{qualifiersCount:r,error:i}},getAvailablePlayoffRounds:Oh,addPlayoffStructures:Gh,removeStructure:Jh,generateQualifyingLink:Sh,generateAdHocMatchUps:Ph,deleteAdHocMatchUps:_h,structureSort:od,generateDrawType:Yh,addVoluntaryConsolationStage:Th,generateVoluntaryConsolationStructure:bh,buildDrawHierarchy:function({matchUps:e,matchUpType:t}){var n;if(!e)return{error:"Missing matchUps"};let i=0,r=[],o=[];t&&(e=e.filter((e=>e.matchUpType===t)));const a=bo(e.map((({matchUpType:e})=>e)));if(a.length>1)if(a.includes(Bs))e=e.filter((e=>e.matchUpType===Bs));else if(a.includes(Ls))e=e.filter((e=>e.matchUpType===Ls));else{if(!a.includes(js))return{};e=e.filter((e=>e.matchUpType===js))}if(!Array.isArray(e)||!e.length)return{};const s=(e,t)=>parseInt(e)-parseInt(t),c=bo(e.map((e=>e.drawPositions)).flat().filter(Boolean)).sort(s),u=Eo(1,Math.max(...c)+1).filter((e=>!c.includes(e))).sort(s),{roundMatchUps:d}=nd({matchUps:e}),l=d[1],p=d[2]||[],[m]=l||[{}],v=m.drawId,g=m.structureId,I=Math.max(...Object.keys(d)),y=(null===(n=d[I])||void 0===n?void 0:n.length)||0,w=Math.ceil(Math.log(y)/Math.log(2)),U=Eo(1,w+1).map((e=>{const t=Math.pow(2,e-1),n=I+w-e+1;return Eo(1,t+1).map((t=>({drawId:v,structureId:g,matchUpId:es(),drawPositions:[],sides:[],roundNumber:n,roundPosition:t,finishingRound:e})))}));w&&(e=e.concat(...U.flat()));const b=l.map((e=>e.drawPositions)).flat(1/0),S=p.map((e=>e.drawPositions)).flat(1/0).filter((e=>!b.includes(e))).sort(s),P=p.filter((e=>{var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.reduce(((e,t)=>S.includes(t)||e),void 0)})).map((e=>{var t,n;const i=null===(t=e.drawPositions)||void 0===t?void 0:t.reduce(((e,t)=>S.includes(t)?t:e),void 0),r=null===(n=e.drawPositions)||void 0===n?void 0:n.indexOf(i);return{[i]:e.sides[r]}}));if(null!=u&&u.length&&(null==S?void 0:S.length)===(null==u?void 0:u.length)){const t=S.map(((e,t)=>[e,u[t]].sort(s))),n=Object.assign({},...P),i=Ja(l[0].finishingRound,!1,!0),r=Ja(l[0].finishingPositionRange);o=t.map(((e,t)=>{const o=Math.max(...e||[])/2;return{sides:null==e?void 0:e.map((e=>n[e]||{bye:!0,drawPosition:e})),drawId:v,structureId:g,roundPosition:o,drawPositions:e,roundNumber:1,finishingRound:i,matchUpId:es(),matchUpStatus:"BYE",sideNumber:t+1,finishingPositionRange:r}})),e=e.concat(...o)}const D=I+w;return Eo(1,D+1).forEach((t=>{var n,o;const a=[],s=N({matchUps:e,roundNumber:t}),c=N({matchUps:e,roundNumber:t-1}).map(Fh).filter(Boolean),u=(null==s?void 0:s.length)===(null===(n=r)||void 0===n?void 0:n.length),d=(null==s?void 0:s.length)===(null===(o=r)||void 0===o?void 0:o.length)/2;1===t&&s.forEach((e=>{const t=e.drawPositions||[],{matchUpId:n,structureId:i}=e,r=[h(f({},e.sides[0]),{drawPosition:t[0],matchUpId:n,structureId:i}),h(f({},e.sides[1]),{drawPosition:t[1],matchUpId:n,structureId:i})],o=h(f({},e),{children:r});a.push(o)})),u?(i++,s.forEach(((e,t)=>{const n=e.drawPositions||[],{matchUpId:o,structureId:s}=e,u=n.filter(Boolean).reduce(((e,t)=>b.includes(t)?e:t),void 0),d=[h(f({},e.sides.filter(Boolean).reduce(((e,t)=>t.participantId&&!c.includes(t.participantId)?t:e),void 0)),{drawPosition:u,feedRoundNumber:i,sides:e.sides,matchUpId:o,structureId:s}),r[t]],l=h(f({},e),{children:d});a.push(l)}))):d&&s.forEach(((e,t)=>{const n=h(f({},e),{children:[r[2*t],r[2*t+1]]});a.push(n)})),r=a})),{hierarchy:r[0],missingMatchUps:o,maxRound:I,finalRound:D,matchUps:e};function N({matchUps:e,roundNumber:t}){return e.filter((e=>e.roundNumber===t)).sort(((e,t)=>e.roundPosition-t.roundPosition))}}};function Qh({participantCount:e}){return isNaN(e)?{error:_o}:{drawSize:[0,2,4,8,16,32,64,128,256,512,1024].find((t=>t>=e))||0}}function Xh({tournamentRecord:e,drawDefinition:t,event:n,requireParticipantCount:i=!0,drawSizeProgression:r=!1,policyDefinitions:o,participantCount:a,drawSize:s}={}){if(!o){const i=vp({tournamentRecord:e,drawDefinition:t,event:n});if(i.error)return i;o=i.policyDefinitions}if(a&&isNaN(a))return{error:_o};if(i&&isNaN(a))return{error:"Missing participantCount"};if(!s){if(!a)return{error:"Missing drawSize"};({drawSize:s}=Qh({participantCount:a}))}if((i&&a||s)>s)return{error:"participantCount exceeds drawSize"};const c=o.seeding;if(!c)return{error:"Invalid policyDefinitions"};const u=c.seedsCountThresholds;return u?(void 0!==c.drawSizeProgression&&(r=c.drawSizeProgression),{seedsCount:u.filter((e=>r?e.drawSize<=s:s===e.drawSize)).reduce(((e,t)=>a>=t.minimumParticipantCount?t.seedsCount:e),0)}):{error:"Missing seedCountThresholds"}}function ev({requireParticipantCount:e=!0,enforcePolicyLimits:t=!0,drawSizeProgression:n,tournamentRecord:i,participantCount:r,drawDefinition:o,structureId:a,seedsCount:s,event:c}){const{structure:u,error:d}=ad({drawDefinition:o,structureId:a});if(d)return{error:d};const{positionAssignments:l}=Kd({structure:u}),p=l.length;if(s>p)return{error:"seedsCount greater than drawSize"};const{policyDefinitions:m}=vp({policyTypes:["seeding"],tournamentRecord:i,drawDefinition:o,event:c}),{seedsCount:v}=Xh({requireParticipantCount:e,drawSizeProgression:n,policyDefinitions:m,participantCount:r,drawSize:p});return m&&v&&s>v&&t&&(s=v),u.seedLimit=s,u.seedAssignments=Eo(1,s+1).map((e=>({seedNumber:e,seedValue:e,participantId:void 0}))),zu({drawDefinition:o,structureIds:[a]}),h(f({},ko),{seedLimit:s})}function tv({participantPreferences:e,drawPositionResolutions:t={}}){const n=Object.keys(e).reduce(((t,n)=>{const i=e[n].preferences[0];return i&&(t[i]||(t[i]=[]),t[i].push(n)),t}),{}),i=Math.min(...Object.values(n).filter((e=>e.length)).map((e=>e.length))),r=Object.keys(n).filter((e=>n[e].length&&i&&n[e].length===i));let o;return r.forEach((i=>{const r=Mo(n[i]);t[i]=r,delete e[r]})),Object.values(e).forEach((e=>{e.preferences=e.preferences.filter((e=>{const t=!r.includes(e.toString());return t&&(o=!0),t}))})),{drawPositionResolutions:t,remainingPreferences:o,participantPreferences:e}}function nv(e){const{participantIdAttributeName:t="participantId",positionActionName:n,drawDefinition:i,participantId:r,drawPosition:o,structureId:a}=e;if(!i)return{error:jo};let{inContextDrawMatchUps:s,matchUpsMap:c}=e;c||(c=id({drawDefinition:i}),Object.assign(e,{matchUpsMap:c})),s||(({matchUps:s}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:c})),Object.assign(e,{inContextDrawMatchUps:s}));const{positionAssignments:u}=Hd({drawDefinition:i,structureId:a}),d=u.find((e=>e.drawPosition===o));if(null!=d&&d.participantId){let e=Yp({inContextDrawMatchUps:s,drawDefinition:i,participantId:r,drawPosition:o,structureId:a,matchUpsMap:c});return e.success||console.log({result:e}),m({removedParticipantId:d.participantId})}let l=fp({inContextDrawMatchUps:s,drawDefinition:i,drawPosition:o,structureId:a,matchUpsMap:c});if(l.error)return l;const p=l.participantId;return l=Yp({inContextDrawMatchUps:s,drawDefinition:i,participantId:r,drawPosition:o,structureId:a,matchUpsMap:c}),l.success?m({removedParticipantId:p}):l;function m({removedParticipantId:e}){const{structure:s}=ad({drawDefinition:i,structureId:a});return $p({drawPositions:[o],structure:s}),Gp({drawDefinition:i,positionAction:{[t]:r,name:n,drawPosition:o,structureId:a}}),h(f({},ko),{removedParticipantId:e})}}function iv({alternateParticipantId:e,drawDefinition:t,drawPosition:n,structureId:i}){return nv({participantId:e,drawDefinition:t,drawPosition:n,structureId:i,participantIdAttributeName:"alternateParticipantid",positionActionName:"alternateDrawPositionAssignment"})}function rv({structurePositionAssignments:e,drawDefinition:t}){if(!t)return{error:jo};if(!Array.isArray(e))return{error:_o};for(const i of e){var n;const{structureId:e,positionAssignments:r}=i,o=ad({drawDefinition:t,structureId:e});if(o.error)return o;const a=o.structure;if(!a)return{error:"structure not found"};if(a.structures)return{error:"Invalid structure",message:"cannot be Round Robin group container"};const s=null===(n=a.positionAssignments)||void 0===n?void 0:n.map((({drawPosition:e})=>e));if(Ro(s,r.map((({drawPosition:e})=>e))).length!==s.length)return{error:_o,message:"drawPositions do not match"};const c=id({drawDefinition:t}),{matchUps:u}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:c});for(const n of r){const{drawPosition:i,participantId:o,bye:s,qualifier:d}=n;if(s){const n=Mp({drawDefinition:t,drawPosition:i,matchUpsMap:c,structureId:e,structure:a});if(null!=n&&n.error)return n}else if(d)r.forEach((e=>{e.drawPosition===i&&(e.qualifier=!0,delete e.participantId,delete e.bye)}));else if(o){const n=Yp({automaticPlacement:!0,inContextDrawMatchUps:u,drawDefinition:t,participantId:o,drawPosition:i,matchUpsMap:c,structureId:e});if(null!=n&&n.error)return n}}}return zu({drawDefinition:t,structureIds:e.map((({structureId:e})=>e))}),f({},ko)}function ov({drawDefinition:e,stages:t}){return((null==e?void 0:e.structures)||[]).filter((e=>!(null!=t&&t.length)||t.includes(e.stage))).map((e=>{const{positionAssignments:t}=Hd({structure:e});return Zu(t)})).flat()}function av({entries:e=[]}={}){const t=e.filter(Boolean).reduce(((e,t)=>{const{entryStage:n,entryStatus:i}=t,r=`_${n||eu}${i||""}`;return e[r]||(e[r]=[]),e[r].push(t),e}),{}),n=e=>isNaN(e)?9999:e;return Object.keys(t).map((e=>t[e].sort(((e,t)=>n(e.entryPosition)-n(t.entryPosition))).map(((e,t)=>{const n=t;return Object.assign(e,{entryPosition:n})})))).flat()}function sv(e){return[Td,Ed].includes(e)}function cv({autoEntryPositions:e=!0,tournamentRecord:t,drawDefinition:n,participantIds:i,entryStatus:r,eventSync:o,drawId:a,stage:s,event:c}){var u,d,l,p,m,h,v,g,I,y;if(!i||!Array.isArray(i))return{error:"Invalid participantId",method:"modifyEntriesStatus",participantIds:i};if(!xd.includes(r))return{error:"Invalid entry status"};if(!n&&!c)return{error:Vo};const w=[];null===(u=c.drawDefinitions)||void 0===u||u.forEach((e=>{const t=ov({drawDefinition:e});w.push(...t)}));const U=(null==t?void 0:t.participants)||[];if(!i.every((e=>{const{participantType:t}=As({tournamentParticipants:U,participantId:e});return!(t===pc&&sv(r))})))return{error:"Invalid entry status"};const{flightProfile:b}=yp({event:c}),S=null==b||null===(d=b.flights)||void 0===d?void 0:d.find((e=>e.drawId===a)),P=(e=[])=>e.filter((e=>!s||!e.entryStage||s===e.entryStage)).filter((({participantId:e})=>i.includes(e))).every((e=>{return!(t=e,w.includes(t.participantId)&&(!Ad.includes(t.entryStatus)||!Ad.includes(r))||(e.entryStatus=r,delete e.entryPosition,0));var t}))?ko:{error:"Participant has assigned drawPosition"},D=({flight:e,drawDefinition:t})=>{c.entries=av({entries:c.entries||[]}),e&&(e.drawEntries=av({entries:e.drawEntries})),t&&(t.entries=av({entries:t.entries}))},N=({flight:e,drawDefinition:t})=>{if(e){const t=P(e.drawEntries);if(t.error)return t}if(t){const e=P(t.entries);if(e.error)return e}return f({},ko)},M=(null===(l=c.entries)||void 0===l?void 0:l.find((({entryPosition:e})=>!isNaN(e))))||(null==S||null===(p=S.drawEntries)||void 0===p?void 0:p.find((({entryPosition:e})=>!isNaN(e))))||(null==n||null===(m=n.entries)||void 0===m?void 0:m.find((({entryPosition:e})=>!isNaN(e))));if(e&&!M&&D({flight:S,drawDefinition:n}),S||n){const e=N({flight:S,drawDefinition:n});if(e.error)return e}const T=(null===(h=c.drawDefinitions)||void 0===h?void 0:h.map((({drawId:e})=>e)))||[],E=(null==b||null===(v=b.flights)||void 0===v?void 0:v.filter((e=>!T.includes(e.drawId))))||[];for(const f of E){const e=N({flight:f});if(e.error)return e}const A=1===(null==b||null===(g=b.flights)||void 0===g?void 0:g.length)&&(null===(I=c.drawDefinitions)||void 0===I?void 0:I.length)<=(null==b||null===(y=b.flights)||void 0===y?void 0:y.length);if(!S&&!n&&Rd.includes(r))return{error:"entryStatus not allowed for event"};if(!S&&!n||r===Md||o&&A){const e=P(c.entries);if(e.error)return e;let t;var R,C;if(r===Md&&(null==b||null===(R=b.flights)||void 0===R||R.every((e=>{const n=P(e.drawEntries);return n.error?(t=n.error,!1):(e.drawEntries=e.drawEntries.filter((({participantId:e})=>!i.includes(e))),!0)})),null===(C=c.drawDefinitions)||void 0===C||C.every((e=>{var n;const r=P(e.entries);return r.error?(t=r.error,!1):(e.entries=null===(n=e.entries)||void 0===n?void 0:n.filter((({participantId:e})=>!i.includes(e))),!0)}))),t)return{error:t}}return e&&D({flight:S,drawDefinition:n}),ko}function uv({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:n}){if(!e)return{error:Lo};if(!t||!n)return{error:$o};const i=(e.participants||[]).find((e=>e.participantId===t));if(!i)return{error:"Participant Not Found"};if(![lc,mc].includes(i.participantType))return{error:"Invalid participantType",participantType:i.participantType};const{removed:r,error:o}=dv({groupingParticipant:i,individualParticipantIds:n});return o?{error:o}:(r&&la({topic:"modifyParticipants",payload:{participants:[i]}}),h(f({},ko),{removed:r}))}function dv({groupingParticipant:e,individualParticipantIds:t=[]}){let n=0,i=[];return e?(e.individualParticipantIds||(e.individualParticipantIds=[]),e.individualParticipantIds=e.individualParticipantIds.filter((e=>{const i=null==t?void 0:t.includes(e);return i&&n++,!i})),i.length?{error:"Participants not removed",notRemoved:i}:{groupingParticipant:e,removed:n}):{removed:n}}function lv({groupingType:e=lc,participantRole:t=Af,tournamentRecord:n,individualParticipantIds:i=[]}){if(!n)return{error:Lo};const r=n.participants||[];let o=0;return r.filter((n=>(n.participantRole===t||!n.participantRole)&&n.participantType===e)).forEach((e=>{const{removed:t}=dv({groupingParticipant:e,individualParticipantIds:i});t&&o++})),o?ko:{error:"No participant removed"}}function pv({teamDrawIds:e=[],tournamentRecord:t,participantIds:n}){var i;if(!t)return{error:Lo};if(null==n||!n.length)return{error:"Missing participantIds"};const r=(null===(i=t.participants)||void 0===i?void 0:i.length)||0;if(!r)return ko;const{tournamentParticipants:o}=jm({participantFilters:{participantIds:n},withStatistics:!0,tournamentRecord:t}),a=e.length&&(()=>{const{matchUps:i}=Ml({tournamentRecord:t,matchUpFilters:{drawIds:e,matchUpTypes:[js]}});return Ro(i.map((({sides:e})=>e.map((({participantId:e})=>e)))).flat().filter(Boolean),n)})(),s=o.filter((t=>{var n;return null===(n=t.draws)||void 0===n?void 0:n.filter((({drawId:t})=>!e.length||!e.includes(t))).length}));if(a.length||s.length)return{error:"Participant has assigned drawPosition"};t.participants=t.participants.filter((e=>!n.includes(e.participantId)));const c=r-t.participants.length;return lv({tournamentRecord:t,individualParticipantIds:n}),c&&la({topic:"deleteParticipants",payload:{participantIds:n}}),c?ko:{error:"Cannot remove participants"}}function mv({selected:e=!0,drawDefinition:t,entryStatuses:n,drawId:i,event:r,stage:o}){let a=r.entries||[];if(i){var s;const{flightProfile:e}=yp({event:r}),n=null==e||null===(s=e.flights)||void 0===s?void 0:s.find((e=>e.drawId===i));a=n?n.drawEntries:null==t?void 0:t.entries}const c=a.filter((t=>(!(null!=n&&n.length)||!t.entryStatus||n.includes(t.entryStatus))&&(!o||!t.entryStage||t.entryStage===o)&&(!e||Cd.includes(t.entryStatus))));return{entries:a,stageEntries:c}}function fv({autoEntryPositions:e=!0,tournamentRecord:t,participantIds:n,event:i}){var r,o,a,s;if(null==i||!i.eventId)return{error:Vo};if(!Array.isArray(n))return{error:"Missing participantIds"};if(null===(o=n=null===(r=n)||void 0===r?void 0:r.filter(Boolean))||void 0===o||!o.length)return{error:"Missing participantIds"};const{eventId:c}=i,{tournamentParticipants:u}=jm({participantFilters:{participantIds:n},withStatistics:!0,tournamentRecord:t});if(null==u?void 0:u.every((e=>{var t;const n=e.events.find((e=>e.eventId===c));return null==n||null===(t=n.drawIds)||void 0===t?void 0:t.length})))return{error:"Existing participant drawPosition assignment"};i.entries=(i.entries||[]).filter((e=>!n.includes(null==e?void 0:e.participantId))),e&&(i.entries=av({entries:i.entries}));const{flightProfile:d}=yp({event:i});return null==d||null===(a=d.flights)||void 0===a||a.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!n.includes(e.participantId)))})),null===(s=i.drawDefinitions)||void 0===s||s.forEach((e=>{e.entries=(e.entries||[]).filter((e=>!n.includes(e.participantId)))})),ko}function hv({participantId:e,drawDefinition:t,entryStatus:n,entryStage:i}){var r;if(!t)return{error:jo};const o=null===(r=t.entries)||void 0===r?void 0:r.find((t=>!(t.participantId!==e||n&&n!==t.entryStatus||i&&i!==t.entryStage)));return e&&o}function vv({entryStatus:e=Sd,entryStage:t=eu,drawDefinition:n,entryPosition:i,participantId:r,participant:o}){if(!n)return{error:jo};if(!t)return{error:"Missing stage"};if(!kd({stage:t,drawDefinition:n}))return{error:"Invalid stage"};const a=_d({stage:t,drawDefinition:n,entryStatus:e});if(!a.success)return{error:a.error};if(!(r=r||(null==o?void 0:o.participantId)))return{error:"Missing participantId"};const s=e===Dd&&hv({participantId:r,drawDefinition:n,entryStatus:e}),c="VOLUNTARY_CONSOLATION"===t&&hv({participantId:r,drawDefinition:n,entryStage:t});if(e!==Dd&&"VOLUNTARY_CONSOLATION"!==t&&hv({drawDefinition:n,participantId:r})||s||c)return{error:"Existing participant"};const u=Za(h(f({},o),{participantId:r,entryStage:t,entryStatus:e,entryPosition:i}));return n.entries.push(u),zu({drawDefinition:n}),f({},ko)}function gv({entryStatus:e=Sd,autoEntryPositions:t=!0,drawDefinition:n,participantIds:i,stage:r=eu}){if(!r)return{error:"Missing stage"};if(!n)return{error:jo};if(!Array.isArray(i))return{error:"Invalid participantIds"};if(!kd({stage:r,drawDefinition:n}))return{error:"Invalid stage"};const o=_d({stage:r,drawDefinition:n,entryStatus:e});if(!o.success)return{error:o.error};if((o.positionsAvailable||0)<i.length)return{error:"More Participants than Draw Positions"};const a=i.reduce(((t,i)=>{const o=e===Dd&&hv({participantId:i,drawDefinition:n,entryStatus:e}),a="VOLUNTARY_CONSOLATION"===r&&hv({participantId:i,drawDefinition:n,entryStage:r});return e!==Dd&&"VOLUNTARY_CONSOLATION"!==r&&hv({drawDefinition:n,participantId:i})||o||a?t.concat({participantId:i,error:"Existing participant"}):t}),[]);return a.length?{error:"Invalid entries",invalidParticipantIds:a}:(i.filter(Boolean).forEach((t=>{const i=Object.assign({participantId:t},{entryStage:r,entryStatus:e});n.entries.push(i)})),t&&(n.entries=av({entries:n.entries})),zu({drawDefinition:n}),f({},ko))}function Iv({autoEntryPositions:e=!0,drawDefinition:t,participantIds:n,entryStatus:i,entryStage:r,drawId:o,event:a}){if(!o)return{error:"Missing drawId"};if(!a)return{error:"Event not found"};const s=(a.entries||[]).map(Qu);if(n.filter((e=>!s.includes(e))).length)return{error:"Missing entries"};if(t){const o=gv({drawDefinition:t,participantIds:n,entryStatus:i,stage:r,autoEntryPositions:e});if(o.error)return o}const{flightProfile:c}=yp({event:a}),u=null==c?void 0:c.flights.find((e=>e.drawId===o));return null!=u&&u.drawEntries&&(n.forEach((e=>{const t=i===Dd&&yv({participantId:e,entryStatus:i,flight:u}),n="VOLUNTARY_CONSOLATION"===r&&yv({participantId:e,entryStage:r,flight:u});i!==Dd&&"VOLUNTARY_CONSOLATION"!==r&&yv({flight:u,participantId:e})||t||n||u.drawEntries.push({participantId:e,entryStatus:i,entryStage:r})})),e&&(u.drawEntries=av({entries:u.drawEntries}))),ko}function yv({participantId:e,entryStatus:t,entryStage:n,flight:i}){var r;const o=null===(r=i.drawEntries)||void 0===r?void 0:r.find((i=>!(i.participantId!==e||t&&t!==i.entryStatus||n&&n!==i.entryStage)));return e&&o}function wv(e){var t;const{entryStatus:n=Sd,autoEntryPositions:i=!0,participantIds:r=[],entryStage:o=eu,tournamentRecord:a,drawDefinition:s,drawId:c,event:u}=e;if(!u)return{error:Vo};if(!r||!r.length)return{error:"Missing participantIds"};if(!u||!u.eventId)return{error:"Event not found"};const d=(null==a||null===(t=a.participants)||void 0===t?void 0:t.filter((e=>u.eventType===Ls&&e.participantType===dc||u.eventType===js&&e.participantType===pc||!(u.eventType!==js||e.participantType!==dc||!sv(n))||u.eventType===lc&&(e.participantType===lc||n===Ed&&e.participantType===dc))).map((e=>e.participantId)))||[],l=r.filter((e=>!d.length||d.includes(e)));u.entries||(u.entries=[]);const p=u.entries.map((e=>e.participantId||e.participant&&e.participant.participantId));let m;if(l.forEach((e=>{p.includes(e)||u.entries.push({participantId:e,entryStatus:n,entryStage:o})})),c&&!sv(o)){const e=Iv({participantIds:l,autoEntryPositions:i,drawDefinition:s,entryStatus:n,entryStage:o,drawId:c,event:u});e.error&&(m=e.error)}if(u.eventType===js){const e=(u.entries||[]).map((e=>e.participantId)),t=(u.entries||[]).filter((e=>sv(e.entryStatus))).map((e=>e.participantId)),n=((null==a?void 0:a.participants)||[]).filter((t=>e.includes(t.participantId)&&t.participantType===pc)).map((e=>e.individualParticipantIds)).flat(1/0),i=t.filter((e=>n.includes(e)));i.length&&fv({tournamentRecord:a,participantIds:i,autoEntryPositions:!1,event:u})}const f=!(l.length===r.length);return i&&(u.entries=av({entries:u.entries||[]})),f?{error:"Invalid participantIds"}:Object.assign({message:m},ko)}function Uv({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:n,participantId:i,entryStatus:r,drawId:o,event:a}){return function({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:n,participantId:i,entryStatus:r,drawId:o,stage:a,event:s}){if(!t)return{error:Lo};if(!i)return{error:"Missing participantId"};if(!s)return{error:Vo};if(![Zs,Qs].includes(s.eventType))return{error:"Invalie eventType"};const c=t.participants||[],u=c.find((e=>e.participantId===i));if(!u)return{error:"Participant Not Found"};if(![pc,Qs].includes(u.participantType)||u.participantType===Qs&&s.eventType!==Qs||u.participantType===pc&&s.eventType!==Zs)return{error:"Invalid participantType"};const d=Ed,l=(s.entries||[]).find((e=>e.participantId===i));if(!l)return{error:"Participant Entry Not Found"};const{stageEntries:p}=mv({entryStatusees:[Sd,yd,bd],selected:!1,drawDefinition:n,drawId:o,event:s,stage:a}),m=p.map(Qu),v=c.filter((({participantId:e})=>m.includes(e))).map((({individualParticipantIds:e})=>e)).flat().filter(Boolean),g=u.individualParticipantIds.filter((e=>1===Ao(e,v).length));let I,y=fv({event:s,drawId:o,drawDefinition:n,tournamentRecord:t,participantIds:[i]});return y.error||g.length&&(y=wv({event:s,drawId:o,drawDefinition:n,tournamentRecord:t,entryStage:l.entryStage,entryStatus:r||d,participantIds:g}),y.error)?y:(e&&pv({tournamentRecord:t,participantIds:[i]}).success&&(I=!0),h(f({},ko),{participantRemoved:I}))}({removeGroupParticipant:e,individualEntryStatus:Ed,tournamentRecord:t,drawDefinition:n,participantId:i,entryStatus:r,drawId:o,event:a})}function bv(e){const{drawId:t,replaceWithBye:n,destroyPair:i,entryStatus:r,drawDefinition:o,matchUpsMap:a}=e,s=fp(e);if(s.error)return s;const{participantId:c}=s,{drawPosition:u,event:d,structureId:l}=e;if([yd,Md].includes(r)&&c){const{tournamentRecord:n}=e,{participant:a}=Rs({tournamentRecord:n,participantId:c}),{participantType:s,individualParticipantIds:u}=a||{};if(i&&s===pc){const e=Uv({tournamentRecord:n,drawDefinition:o,participantId:c,event:d});if(e.error)return e;cv({tournamentRecord:n,participantIds:u,entryStatus:r,drawDefinition:o,drawId:t,event:d})}else cv({tournamentRecord:n,participantIds:[c],entryStatus:r,drawDefinition:o,drawId:t,event:d})}if(n){const e=Mp({drawDefinition:o,structureId:l,drawPosition:u,matchUpsMap:a});if(e.error)return e}const{structure:p}=ad({drawDefinition:o,structureId:l});return $p({structure:p,drawPositions:[u]}),Gp({drawDefinition:o,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:n,drawPosition:u,entryStatus:r,structureId:l}}),s}function Sv({drawDefinition:e,drawPositions:t,structureId:n}){if(!e)return{error:jo};if(!n)return{error:"Missing structureId"};if(2!==(null==t?void 0:t.length))return{error:_o,drawPositions:t};const i=id({drawDefinition:e}),{matchUps:r}=Dl({includeByeMatchUps:!0,inContext:!0,drawDefinition:e}),{structure:o}=ad({drawDefinition:e,structureId:n});if(!o)return{error:"structure not found"};let a;return a=o.structureType===au?function({drawDefinition:e,drawPositions:t,structure:n,matchUpsMap:i,inContextDrawMatchUps:r}){var o;const a=null===(o=n.structures)||void 0===o?void 0:o.reduce(((e,n)=>{const i=null==n?void 0:n.positionAssignments.filter((e=>t.includes(e.drawPosition)));return i&&e.push(...i),e}),[]);if(2===a.filter((({bye:e})=>e)).length)return f({},ko);if(a.some((({bye:e})=>e)))Pv({drawDefinition:e,assignments:a,structure:n,matchUpsMap:i,inContextDrawMatchUps:r});else{const e=a.map(Qu);a.forEach(((t,n)=>t.participantId=e[1-n]))}return f({},ko)}({drawDefinition:e,structure:o,drawPositions:t,matchUpsMap:i,inContextDrawMatchUps:r}):function({inContextDrawMatchUps:e,drawDefinition:t,drawPositions:n,matchUpsMap:i,structure:r}){const o=null==r?void 0:r.positionAssignments.filter((e=>null==n?void 0:n.includes(e.drawPosition)));return o?2===o.filter((({bye:e})=>e)).length?f({},ko):o.some((({bye:e})=>e))?Pv({drawDefinition:t,structure:r,assignments:o,matchUpsMap:i,inContextDrawMatchUps:e}):function({structure:e,assignments:t}){const n=Object.assign({},...t.map(((e,n)=>{const{drawPosition:i}=e;return{[i]:h(f({},t[1-n]),{drawPosition:i})}})));return e.positionAssignments=e.positionAssignments.map((e=>n[e.drawPosition]||e)),f({},ko)}({structure:r,assignments:o,matchUpsMap:i,inContextDrawMatchUps:e}):{error:_o,structure:r,message:"Missing positionAssignments"}}({drawDefinition:e,structure:o,drawPositions:t,matchUpsMap:i,inContextDrawMatchUps:r}),a.error?a:($p({structure:o,drawPositions:t}),Gp({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:t,structureId:n}}),zu({drawDefinition:e,structureIds:[n]}),f({},ko))}function Pv({drawDefinition:e,structure:t,assignments:n,matchUpsMap:i,inContextDrawMatchUps:r}){const o=n.find((({bye:e})=>e)),a=n.find((({participantId:e})=>e)),s=o.drawPosition,{participantId:c,drawPosition:u}=a,{structureId:d}=t;let l=bv({drawDefinition:e,structureId:d,drawPosition:s,matchUpsMap:i,inContextDrawMatchUps:r});return l.error?l:(l=bv({drawDefinition:e,structureId:d,drawPosition:u,matchUpsMap:i,inContextDrawMatchUps:r}),l.error?l:(l=Mp({drawDefinition:e,structureId:d,drawPosition:u,matchUpsMap:i,inContextDrawMatchUps:r}),l=Yp({drawDefinition:e,structureId:d,drawPosition:s,participantId:c,matchUpsMap:i,inContextDrawMatchUps:r}),l.error?l:f({},ko)))}function Dv({tournamentRecord:e,drawDefinition:t,drawPosition:n,structureId:i,subOrder:r,event:o}){if(!t)return{error:jo};if(!i)return{error:"Missing structureId"};if(!n)return{error:"Missing drawPosition"};const{structure:a}=ad({drawDefinition:t,structureId:i});let s=a;a.structureType===au&&(s=a.structures.find((e=>e.positionAssignments.find((e=>e.drawPosition===n)))));const c=s.positionAssignments,u=c.find((e=>e.drawPosition===n));u&&ud({element:u,extension:{name:"subOrder",value:r}});const{matchUps:d}=Xd({structure:s,inContext:!0});return Ip({positionAssignments:c,tournamentRecord:e,drawDefinition:t,matchUpFormat:(null==a?void 0:a.matchUpFormat)||t.matchUpFormat,matchUps:d,event:o}),zu({drawDefinition:t,structureIds:[i]}),f({},ko)}const Nv={setSubOrder:Dv,clearDrawPosition:fp,assignDrawPosition:Yp,setPositionAssignments:rv,automatedPositioning:vh,assignDrawPositionBye:Mp,swapDrawPositionAssignments:Sv,alternateDrawPositionAssignment:iv,resolveDrawPositions:function({participantFactors:e,positionAssignments:t}){if(!e||!t)return{error:$o};let n=Ja(e,!1,!0);const i=t.map((({drawPosition:e})=>e)),r=t.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map(Xu);let o,a=!0;for(;a;)({drawPositionResolutions:o,remainingPreferences:a,participantPreferences:n}=tv({participantPreferences:n,drawPositionResolutions:o}));const s=Object.keys(o).map((e=>parseInt(e)));let c=r.filter((e=>!s.includes(e))),u=Object.keys(n);const d=Eo(1,(2,l=(null==i?void 0:i.length)||0,Math.log(l)/Math.log(2)+1)).map((e=>Math.pow(2,e)));var l;const p={};for(const f of d){const t=xo(i,f).filter((e=>Co(e,c))),n={};if(u.forEach((i=>{t.forEach((t=>{const r=t.join("|");Co(t,e[i].preferences)&&(n[r]||(n[r]=[]),n[r].push(i))}))})),So(Object.keys(n)).forEach((e=>{const t=n[e].filter((e=>u.includes(e)));for(;t.length;){const n=Mo(t),i=e.split("|").map((e=>parseInt(e))).filter((e=>c.includes(parseInt(e))));if(i.length){const t=Mo(i);c=c.filter((e=>e!==t)),u=u.filter((e=>e!==n)),o[t]=n;const r=e.split("|").length;p[r]||(p[r]=0),p[r]+=1}}})),!c.length)break}const m={chunkResolution:p};return u.length&&(u.forEach((e=>{const t=Mo(c);t&&(o[t]=e)})),m.randomAssignment=u.length),{drawPositionResolutions:o,report:m}},initializeStructureSeedAssignments:ev,getNextSeedBlock:Kp};function Mv({drawDefinition:e,event:t,matchUpId:n}){if(!e)return{error:jo};if(!n)return{error:"Missing matchUpId"};const{matchUp:i}=el({drawDefinition:e,event:t,matchUpId:n});return i?dd({element:i,name:"delegatedOutcome"}):{error:"matchUp not found"}}function Tv({requireTimeStamp:e,scaleAttributes:t,participant:n}){if(!n)return{error:"Missing participant"};if("object"!=typeof t)return{error:_o};if(n.timeItems||(n.timeItems=[]),n&&Array.isArray(n.timeItems)){const{accessor:i,scaleType:r,eventType:o,scaleName:a}=t,s=[Cm,r,o,a].join("."),c=n.timeItems.filter((e=>(null==e?void 0:e.itemType)===s)).filter((t=>!e||(null==t?void 0:t.itemDate))).sort(((e,t)=>new Date(e.createdAt||void 0)-new Date(t.createdAt||void 0))).pop();if(c){const[e,t,n,r]=c.itemType.split(".");if(e!==Cm)return{error:"Invalid scaleItem"};const o=i&&km({element:c.itemValue,accessor:i}),a=i?o.value:c.itemValue;return{scaleItem:{scaleDate:c.itemDate,scaleName:r,scaleType:t,eventType:n,scaleValue:a}}}return{error:"No scaleItem found"}}return{error:"Missing participant"}}function Ev({rankedMatchUpValues:e,valueSortedPairings:t,stipulated:n=[],deltaObjects:i}){const r=[].concat(...n),o=[];let a=0;n.filter(Boolean).forEach((t=>{const n=Av(...t),i=e[n];o.push({participantIds:t,value:i}),a+=e[n]})),t.forEach((e=>{const t=e.pairing.split("|");if(!t.reduce(((e,t)=>r.includes(t)||e),!1)){r.push(...t);let n=e.value;a+=n,o.push({participantIds:t,value:n})}})),o.sort(((e,t)=>e.value-t.value));const s=o.reduce(((e,t)=>{const n=Av(...t.participantIds),r=i[n];return r>e?r:e}),0);return{value:a,participantIdPairings:o,maxDelta:s}}function Av(e,t){return[e,t].sort().join("|")}function Rv({participantIds:e}){const t={},n=[];e.forEach((i=>{t[i]=e.filter((e=>e!==i)),t[i].forEach((e=>{const t=Av(e,i);n.includes(t)||n.push(t)}))}));const i=Object.assign({},...n.map((e=>({[e]:0}))));return{uniquePairings:n,possiblePairings:t,deltaObjects:i}}function Cv({tournamentParticipants:e,restrictEntryStatus:t,generateMatchUps:n,drawDefinition:i,participantIds:r,maxIterations:o,structureId:a,matchUpIds:s,scaleName:c,event:u}){var d;if("object"!=typeof i||i.drawType&&i.drawType!==uu)return{error:"Invalid drawDefinition"};if(!Array.isArray(i.entries)||r&&!Array.isArray(r))return{error:_o};const{eventType:l}=u||{},p=i.entries.filter((({entryStatus:e})=>!t||[Sd,Nd,bd].includes(e))).map(Qu);if(r){const e=r.filter((e=>!p.includes(e)));if(null!=e&&e.length)return{error:"Invalid participantId",invalidParticipantIds:e}}else r=p;if(!a){var m,v;const e=null===(m=i.structures)||void 0===m||null===(v=m.filter((e=>1===e.stageSequence)))||void 0===v?void 0:v.reduce(((e,t)=>{const n=ou[t.stage];return Yd({drawDefinition:i,structure:t})&&n>(ou[null==e?void 0:e.stage]||1)?t:e}),void 0);a=null==e?void 0:e.structureId}const g=null===(d=i.structures)||void 0===d?void 0:d.find((e=>e.structureId===a));if(!g)return{error:"structure not found"};if(!Yd({drawDefinition:i,structure:g}))return{error:"Invalid drawDefinition"};const I={};for(const f of r){const t=null==e?void 0:e.find((e=>e.participantId===f));let n=xv({eventType:l,participant:t});!n&&c&&(n=xv({scaleValue:n,eventType:l,participant:t})),n&&(I[f]=n)}const{candidatesCount:y,iterations:w,participantIdPairings:U}=function({maxIterations:e=5e3,tournamentParticipants:t,generateMatchUps:n,drawDefinition:i,participantIds:r,adHocRatings:o,structureId:a,matchUpIds:s,eventType:c,structure:u}){const{encounters:d}=function({matchUps:e}){let t=[];for(const n of e){const e=n.sides.map(Qu);if(2===e.length){const n=Av(...e);t.includes(n)||t.push(n)}}return{encounters:t}}({matchUps:u.matchUps}),l={};for(const f of d)l[f]||(l[f]=0),l[f]+=50;const p=null==t?void 0:t.filter((({participantType:e})=>e===lc));if(p)for(const f of p){const e=f.individualParticipantIds||[],{uniquePairings:t}=Rv({participantIds:e});for(const n of t)l[n]||(l[n]=0),l[n]+=60}const{uniquePairings:m,possiblePairings:v,deltaObjects:g}=Rv({participantIds:r}),I={tournamentParticipants:t,possiblePairings:v,drawDefinition:i,participantIds:r,uniquePairings:m,maxIterations:e,adHocRatings:o,deltaObjects:g,valueObjects:l,eventType:c,structure:u},{candidatesCount:y,participantIdPairings:w,iterations:U}=function({tournamentParticipants:e,adHocRatings:t={},possiblePairings:n,uniquePairings:i,maxIterations:r,deltaObjects:o,valueObjects:a,eventType:s}){i.forEach((n=>{const i=function({tournamentParticipants:e,adHocRatings:t,eventType:n,pairing:i}){return i.split("|").map((i=>{if(n===Zs){var r;const n=null==e||null===(r=e.find((e=>e.participantId===i)))||void 0===r?void 0:r.individualParticipantIds;return n?n.map((e=>t[e||0])):0}return t[i]||0}))}({tournamentParticipants:e,adHocRatings:t,eventType:s,pairing:n}),r=Math.abs(i[0]-i[1])+1;o[n]=Math.abs(i[0]-i[1]),a[n]||(a[n]=0),a[n]+=Math.pow(r,2)}));const c=i.map((e=>({pairing:e,value:a[e]}))).sort(((e,t)=>e.value-t.value)),{pairingValues:u}=function({possiblePairings:e,valueObjects:t}){let n={};for(const r of Object.keys(e)){let t=e[r].map((e=>i(r,e)));n[r]=t.sort(((e,t)=>e.value-t.value))}function i(e,n){let i=Av(e,n);return{opponent:n,value:t[i]}}return{pairingValues:n}}({possiblePairings:n,valueObjects:a}),{candidate:d,candidatesCount:l,iterations:p}=function({maxIterations:e=5e3,valueSortedPairings:t,pairingValues:n,deltaObjects:i}){const r=Object.assign({},...t.map((e=>({[e.pairing]:e.value}))));let o=Ev({rankedMatchUpValues:r,valueSortedPairings:t,deltaObjects:i}),a=o;const s=Object.keys(n);let c,u=0,d=s.length;do{d-=1,c=s.length*d*t.length/2}while(c>e&&d>2);let l=[];return s.forEach((e=>{n[e].slice(0,d).forEach((n=>{const s=Av(e,n.opponent);if(!l.includes(s)){const c=Ev({stipulated:[[e,n.opponent]],rankedMatchUpValues:r,valueSortedPairings:t,deltaObjects:i});c.maxDelta<a.maxDelta&&(a=c),c.value<o.value&&(o=c),l.push(s),u+=1}}))})),{candidate:o,deltaCandidate:a,candidatesCount:u,iterations:c}}({valueSortedPairings:c,maxIterations:r,pairingValues:u,deltaObjects:o}),{participantIdPairings:m}=d;return{candidatesCount:l,participantIdPairings:m,iterations:p}}(I);if(!y)return{error:"No Candidates"};if(n){const e=Ph({participantIdPairings:w,drawDefinition:i,newRound:!0,structureId:a,matchUpIds:s});if(e.error)return e}return h(f({},ko),{participantIdPairings:w,candidatesCount:y,iterations:U})}({tournamentParticipants:e,generateMatchUps:n,drawDefinition:i,participantIds:r,maxIterations:o,adHocRatings:I,matchUpIds:s,structureId:a,structure:g,eventType:l});return h(f({},ko),{candidatesCount:y,iterations:w,participantIdPairings:U})}function xv({scaleName:e="dynamic",eventType:t,participant:n}){var i;const r=n&&Tv({scaleAttributes:{eventType:t||Js,scaleType:xm,scaleName:e},participant:n});return null==r||null===(i=r.scaleItem)||void 0===i?void 0:i.scaleValue}function Ov({drawDefinition:e,matchUpId:t,outcome:n,matchUp:i}){var r,o;if(!i&&!e)return{error:jo};if(!i&&!t)return{error:"Missing matchUp"};if(!n)return{error:$o};if(!i){const{error:n,matchUp:r}=el({drawDefinition:e,matchUpId:t});if(n)return{error:n};i=r}return"object"==typeof n&&null!==(r=n.score)&&void 0!==r&&r.scoreStringSide1&&null!==(o=n.score)&&void 0!==o&&o.scoreStringSide2?ud({element:i,extension:{name:"delegatedOutcome",value:n}}):{error:_o}}function kv(e){return null!==e&&(void 0===e||!isNaN(e))}function Fv({drawDefinition:e,finishingOrder:t}){if(!e)return{error:jo};if(!Array.isArray(t))return{error:_o,message:"finishingOrder must be an array"};const{completedMatchUps:n,matchUpsMap:i}=Nl({inContext:!0,drawDefinition:e}),r=n.map(ed),o=t.map(ed),{matchUpTypes:a,roundNumbers:s,structureIds:c,matchUpTieIds:u}=n.filter((({matchUpId:e})=>o.includes(e))).reduce(((e,t)=>{const{matchUpTieId:n,matchUpType:i,roundNumber:r,structureId:o}=t;return e.matchUpTypes.includes(i)||e.matchUpTypes.push(i),e.roundNumbers.includes(r)||e.roundNumbers.push(r),e.structureIds.includes(o)||e.structureIds.push(o),e.matchUpTieIds.includes(n)||e.matchUpTieIds.push(n),e}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(a.length>1||u.length>1||s.length>1||c.length>1)return{error:_o,message:"matchUpType, structureId and roundNumber must be equivalent"};let d,l;const p={},m=[],h=[];if(!t.every((({orderOfFinish:e,matchUpId:t})=>(m.push(t),e&&h.push(e),p[t]=e,d=r.includes(t),l=void 0===e||Io(e)&&Math.floor(e)>0,d&&l))))return{error:d?_o:"Invalid matchUpStatus",message:d?l?void 0:"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed"};const v=n.filter((e=>e.structureId===c[0]&&e.roundNumber===s[0]&&e.matchUpType===a[0]&&e.matchUpTieId===u[0]&&!m.includes(e.matchUpId)));for(const f of v){const{orderOfFinish:e}=f||{};if(e){if(!Io(e))return{error:_o,message:"Existing value",matchUp:f};h.push(e)}}if(No(h).length!==h.length||Math.max(...h)>h.length)return{error:_o,message:"Values not unique or greater than expected number of values"};if(c.length){var g;const t=Pl({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:e,matchUpsMap:i});if(t.error)return t;null===(g=t.completedMatchUps)||void 0===g||g.forEach((e=>e.orderOfFinish=p[e.matchUpId]))}return f({},ko)}const Lv={setMatchUpStatus:tm,setMatchUpFormat:im,isValidMatchUpFormat:$r,addMatchUpTimeItem:tl,resetMatchUpTimeItems:function({drawDefinition:e,event:t,matchUpId:n}){const{matchUp:i}=el({drawDefinition:e,event:t,matchUpId:n});return i?(i.timeItems=[],Wu({drawDefinition:e,matchUp:i}),f({},ko)):{error:"matchUp not found"}},checkInParticipant:Nf,checkOutParticipant:Mf,getCheckedInParticipantIds:Zd,addMatchUpScheduleItems:al,addMatchUpScheduledDate:sl,addMatchUpScheduledTime:cl,addMatchUpStartTime:dl,addMatchUpEndTime:ll,addMatchUpStopTime:pl,addMatchUpResumeTime:ml,setOrderOfFinish:Fv,setDelegatedOutcome:Ov,removeDelegatedOutcome:Mv,drawMatic:Cv,matchUpSort:op,addMatchUpOfficial:ul,findMatchUp:function(e){return Object.assign(e,{inContext:!0}),{matchUp:Ja(el(e).matchUp,!1,!0)}},getRoundMatchUps:nd,validDrawPositions:function({matchUps:e}){if(!e)return{error:"Missing matchUps"};const t=e.map((e=>e.drawPositions)).flat();sa()&&e.forEach((e=>{var t;Array.isArray(e.drawPositions)?null===(t=e.drawPositions)||void 0===t||t.forEach((t=>{kv(t)||console.log("invalid drawPosition",e)})):console.log("drawPositions not an array",e)}));const n=null==t?void 0:t.every(kv),i=e.find((e=>!Array.isArray(e.drawPositions)));return n&&!i}};function jv({drawDefinition:e,policyDefinitions:t}){if(!e)return{error:jo};if(!t||"object"!=typeof t)return{error:"Missing policyDefinitions"};e.extensions||(e.extensions=[]);const{appliedPolicies:n}=td({drawDefinition:e}),i=Object.keys(t).every((e=>!n[e]&&(n[e]=t[e],!0)));if(i){const t=ud({element:e,extension:{name:"appliedPolicies",value:n}});if(t.error)return t}return zu({drawDefinition:e}),i?f({},ko):{error:"existing policyType"}}const Bv={attachPolicies:jv};function Vv({tournamentParticipants:e,drawDefinition:t,event:n}){if(!t)return{error:jo};const i=Ja(Dl({tournamentParticipants:e,inContext:!0,drawDefinition:t,event:n}).matchUps,!1,!0),r=bo(i.reduce(((e,t)=>e.concat(...t.sides.map((e=>e.participantId)).filter(Boolean))),[])),o=Object.assign({},...r.map((e=>{const t=i.filter((t=>t.sides.map((e=>e.participantId)).filter(Boolean).includes(e)));return{[e]:t}})));return{participantIds:r,participantIdMatchUps:o}}function $v({byeAdvancements:e=!1,tournamentParticipants:t,drawDefinition:n}){if(!n)return{error:jo};const{participantIds:i,participantIdMatchUps:r}=Vv({tournamentParticipants:t,drawDefinition:n}),o=i.map((t=>{const n=r[t].filter((e=>[Hr,qr].includes(e.matchUpStatus)||e.winningSide)),i=n.map((n=>{const i=n.sides.find((e=>e.bye)),r=n.sides.find((e=>e.participantId===t)).sideNumber;return(n.winningSide||e&&i&&r)===r?n.finishingPositionRange.winner:n.finishingPositionRange.loser})),o=e=>Math.abs(e[0]-e[1]),a=i.reduce(((e,t)=>e&&o(e)<o(t)?e:t),void 0);return{[t]:{relevantMatchUps:n,finishingPositionRanges:i,finishingPositionRange:a}}}));return Object.assign({},...o)}function Gv(e,t){return e.bye||e.seedValue<t.seedValue||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function _v({action:e,policyActions:t}){var n;const i=!(null!=t&&t.enabledActions)||(null==t||null===(n=t.disabledActions)||void 0===n?void 0:n.length)&&t.disabledActions.includes(e);return!i&&!(0!==(null==t?void 0:t.enabledActions.length)&&!(null==t?void 0:t.enabledActions.includes(e))||i)}function Wv({policyDefinitions:e,tournamentParticipants:t=[],tournamentRecord:n,drawDefinition:i,drawPosition:r,structureId:o,event:a}){if(!a)return{error:Vo};if(!i)return{error:jo};if(void 0===r)return{error:"Missing drawPosition"};if(!o)return{error:"Missing structureId"};const{activeDrawPositions:s,byeDrawPositions:c,inactiveDrawPositions:u,structure:d,error:l}=dp({tournamentRecord:n,drawDefinition:i,structureId:o});if(l)return{error:l};const{policyDefinitions:p}=vp({policyTypes:["positionActions"],tournamentRecord:n,drawDefinition:i,event:a}),m=e||p,{enabledStructures:v,actionsDisabled:g}=function({policyDefinitions:e,tournamentRecord:t,drawDefinition:n,structure:i,event:r}){const{policyDefinitions:o}=vp({policyTypes:["positionActions"],tournamentRecord:t,drawDefinition:n,event:r}),a=(e=e||o||Su).positionActions,{enabledStructures:s,disabledStructures:c}=a||{};return{enabledStructures:s,actionsDisabled:null==c?void 0:c.find((e=>{var t,n;return(null===(t=e.stages)||void 0===t?void 0:t.includes(i.stage))&&(!(null!==(n=e.stageSequences)&&void 0!==n&&n.length)||e.stageSequences.includes(i.stageSequence))}))}}({policyDefinitions:m,tournamentRecord:n,drawDefinition:i,structure:d,event:a}),{sourceStructureIds:I}=function({drawDefinition:e,structureId:t,finishingPosition:n,linkType:i}){const{links:r}=yl({drawDefinition:e,structureId:t})||{};return{sourceStructureIds:((null==r?void 0:r.target)||[]).filter((({linkType:e})=>e===i)).map((({source:e})=>e.structureId)).map((t=>{const{structure:n}=ad({drawDefinition:e,structureId:t});return{sourceStructureId:t,sourceFinishingPosition:n.finishingPosition}})).filter((({sourceFinishingPosition:e})=>e===n)).map((({sourceStructureId:e})=>e))}}({drawDefinition:i,structureId:o,finishingPosition:"WIN_RATIO",linkType:"POSITION"})||{};let y;null!=I&&I.length&&(y=I.reduce(((e,t)=>jp({drawDefinition:i,structureId:t})&&e),!0));const w=I.length,U=I.length&&!y,{policyActions:b}=function({enabledStructures:e,structure:t}){if(!1===e)return{};if(null==e||!e.length)return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:n,stageSequence:i}=t||{};return{policyActions:e.find((e=>{var t,r;const o=!(null!==(t=e.stages)&&void 0!==t&&t.length)||e.stages.includes(n),a=!(null!==(r=e.stageSequences)&&void 0!==r&&r.length)||e.stageSequences.includes(i);if(e&&o&&a)return!0}))}}({enabledStructures:v,structure:d}),S=![tu,eu].includes(d.stage)||1!==d.stageSequence,P=[],{drawId:D}=i,{assignedPositions:N,positionAssignments:M}=Kd({structure:d}),T=N.find((e=>e.drawPosition===r)),E=M.map((e=>e.drawPosition));if(null==E||!E.includes(r))return{error:"Invlid drawPosition"};const{stage:A,stageSequence:R}=d,C=[Sd,bd],x=[A];A===nu&&x.push(eu),A===eu&&x.push(nu);const O=Vd({drawDefinition:i,stageSequence:R,entryStatuses:C,structureId:o,stages:x}),k=ov({drawDefinition:i,stages:x}),F=O.filter((e=>!k.includes(e.participantId))).map((e=>e.participantId)),L=c.includes(r),j=s.includes(r);if(g)return{message:"Actions Disabled for structure",isByePosition:L,isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:!!T,validActions:[]};if(_v({policyActions:b,action:"ASSIGN"})&&!j&&!U&&(!T||L)){const{validAssignmentActions:e}=function({positionSourceStructureIds:e,unassignedParticipantIds:t,possiblyDisablingAction:n,tournamentParticipants:i,isWinRatioFedStructure:r,positionAssignments:o,policyDefinitions:a,drawDefinition:s,isByePosition:c,drawPosition:u,structureId:d,structure:l}){var p,m,f;const{drawId:h}=s,v=[];let g,I,y=[];const w=null==a||null===(p=a.seeding)||void 0===p||null===(m=p.validSeedPositions)||void 0===m?void 0:m.ignore;if(!w){const e=Kp({randomize:!0,drawDefinition:s,structureId:d});({unplacedSeedParticipantIds:g,unplacedSeedAssignments:I,unfilledPositions:y}=e)}if(null!==(f=y)&&void 0!==f&&f.length||(y=o.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition))),c||v.push({type:"BYE",method:"assignDrawPositionBye",willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}}),r&&w){var U;const t=o.map((e=>e.participantId)).filter(Boolean),r={structureIds:e},{completedMatchUps:a}=Nl({inContext:!0,matchUpFilters:r,drawDefinition:s}),c=bo(null===(U=a||[])||void 0===U?void 0:U.map((({sides:e})=>e.map(Qu))).flat().filter((e=>!t.includes(e)))),l=null==i?void 0:i.filter((e=>null==c?void 0:c.includes(e.participantId)));return null==l||l.forEach((e=>{const t=(s.entries||[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null!=l&&l.length&&v.push({type:"ASSIGN",method:"assignDrawPosition",availableParticipantIds:c,participantsAvailable:l,willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}}),{validAssignmentActions:v}}if(y.includes(u)||c){var b;let e;if(null!==(b=I)&&void 0!==b&&b.length){const t=I.filter((e=>{var t;return null===(t=g)||void 0===t?void 0:t.includes(e.participantId)}));t.sort(Gv),e=t.map((e=>e.participantId))}else{e=t;const{unplacedQualifiersCount:n}=fh({drawDefinition:s,structureId:d,structure:l});n&&console.log({unplacedQualifiersCount:n})}const r=null==i?void 0:i.filter((t=>e.includes(t.participantId)));null!=r&&r.length&&v.push({type:"ASSIGN",method:"assignDrawPosition",availableParticipantIds:e,participantsAvailable:r,willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}})}return{validAssignmentActions:v}}({positionSourceStructureIds:I,unassignedParticipantIds:F,possiblyDisablingAction:S,isWinRatioFedStructure:w,tournamentParticipants:t,positionAssignments:M,activeDrawPositions:s,policyDefinitions:m,drawDefinition:i,isByePosition:L,drawPosition:r,structureId:o,structure:d});null==e||e.forEach((e=>P.push(e)))}const{participantId:B}=T||{},V=B&&t.find((e=>e.participantId===B));if(T){_v({policyActions:b,action:"REMOVE"})&&!j&&(P.push({type:"REMOVE",method:"removeDrawPositionAssignment",payload:{drawId:D,structureId:o,drawPosition:r},willDisableLinks:S}),L||P.push({type:"WITHDRAW",method:"withdrawParticipantAtDrawPosition",payload:{drawId:D,structureId:o,drawPosition:r},willDisableLinks:S}),_v({policyActions:b,action:"BYE"})&&!L&&P.push({type:"BYE",method:"removeDrawPositionAssignment",payload:{drawId:D,structureId:o,drawPosition:r,replaceWithBye:!0},willDisableLinks:S}));const e=d.stage===tu||d.stage===eu&&1===d.stageSequence;if(!L&&_v({policyActions:b,action:"SEED_VALUE"})&&Hp({drawDefinition:i,structureId:o,drawPosition:r})&&e){const{seedAssignments:e}=Wd({drawDefinition:i,structure:d}),{seedNumber:t,seedValue:n}=e.find((e=>e.participantId===B))||{};P.push({type:"SEED_VALUE",method:"modifySeedAssignment",participant:V,seedNumber:t,payload:{drawId:D,structureId:o,participantId:B,seedValue:n}})}if(!L&&B){if(_v({policyActions:b,action:"PENALTY"})){const e={type:"PENALTY",method:"addPenalty",participant:V,payload:{drawId:D,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};P.push(e)}if(_v({policyActions:b,action:"NICKNAME"})){const e={type:"NICKNAME",method:"modifyParticipantOtherName",participant:V,payload:{participantId:B,otherName:void 0}};P.push(e)}}if(_v({policyActions:b,action:"SWAP"})){const{validSwapAction:e}=function({drawDefinition:e,drawPosition:t,structureId:n,structure:i,drawId:r,event:o,isByePosition:a,byeDrawPositions:s,positionAssignments:c,tournamentParticipants:u,onlyAssignedPositions:d=!0,activeDrawPositions:l,inactiveDrawPositions:p,possiblyDisablingAction:m}){if(l.includes(t))return{};const v=null==p?void 0:p.filter((e=>e!==t&&!(a&&s.includes(e)))),g=(null==c?void 0:c.filter((e=>{return t=e,(!d||t.participantId||t.qualifier||t.bye)&&(null==v?void 0:v.includes(e.drawPosition));var t})))||[],I=g.map((({drawPosition:e})=>e)),{matchUps:y}=Xd({inContext:!0,drawDefinition:e,structure:i,event:o}),w=y.filter((({drawPositions:e})=>Co(e,I))),U=Object.assign({},...w.map((e=>{var t;return null===(t=e.sides)||void 0===t?void 0:t.filter((({sourceDrawPositionRange:e})=>e)).map((({drawPosition:e,sourceDrawPositionRange:t})=>({[e]:t})))})).flat()),b=g.map((e=>e.participantId)).filter(Boolean),S=(u||[]).filter((e=>b.includes(e.participantId))),P=Object.assign({},...S.map((e=>({[e.participantId]:e})))),D=g.map((e=>{const t=P&&P[e.participantId],n=U[e.drawPosition];return h(f({},e),{participant:Ja(t,!1,!0),sourceDrawPositionRange:n})}));return D.length?{validSwapAction:{type:"SWAP",method:"swapDrawPositionAssignments",availableAssignments:D,willDisableLinks:m,payload:{drawId:r,structureId:n,drawPositions:[t]}}}:{}}({drawId:D,structure:d,structureId:o,drawPosition:r,isByePosition:L,drawDefinition:i,byeDrawPositions:c,positionAssignments:M,activeDrawPositions:s,inactiveDrawPositions:u,tournamentParticipants:t,possiblyDisablingAction:S});e&&P.push(e)}}if(_v({policyActions:b,action:"ALTERNATE"})&&!U){const{validAlternatesAction:e}=function({tournamentParticipants:e=[],possiblyDisablingAction:t,activeDrawPositions:n,positionAssignments:i,policyDefinitions:r,drawDefinition:o,drawPosition:a,structureId:s,structure:c,drawId:u,event:d}){var l;if(n.includes(a))return{};const p=null==r||null===(l=r.positionActions)||void 0===l?void 0:l.otherFlightEntries,m=(o.entries||[]).map((({participantId:e})=>e)).filter(Boolean),f=i.map((e=>e.participantId)).filter(Boolean),h=(d.entries||[]).filter((e=>e.entryStatus===yd&&function({structure:e,entry:t}){const{stage:n}=e;if(!t.entryStage||t.entryStage===n||t.entryStage===eu&&n===nu)return!0}({structure:c,entry:e})&&!f.includes(e.participantId))).sort(((e,t)=>(e.entryPosition||9999)-(t.entryPosition||9999))).map((e=>e.participantId));if(p){var v;const{flightProfile:e}=yp({event:d}),t=null==e||null===(v=e.flights)||void 0===v?void 0:v.filter((e=>e.drawId!==u)).map((e=>e.drawEntries.filter((e=>e.participantId&&!m.includes(e.participantId))).map((({participantId:e})=>e)))).flat().filter(Boolean);null!=t&&t.length&&h.push(...t)}const g=null==e?void 0:e.filter((e=>h.includes(e.participantId)));return g.forEach((e=>{const t=(o.entries||[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),g.sort(((e,t)=>(e.entryPosition||9999)-(t.entryPosition||9999))),h.length?{validAlternatesAction:{type:"ALTERNATE",method:"alternateDrawPositionAssignment",availableAlternates:g,availableAlternatesParticipantIds:h,willDisableLinks:t,payload:{drawId:u,structureId:s,drawPosition:a}}}:{}}({possiblyDisablingAction:S,tournamentParticipants:t,positionAssignments:M,activeDrawPositions:s,policyDefinitions:m,drawDefinition:i,drawPosition:r,structureId:o,structure:d,drawId:D,event:a});e&&P.push(e)}if(_v({policyActions:b,action:"LUCKY"})&&!U){const{validLuckyLosersAction:e}=function({tournamentParticipants:e=[],possiblyDisablingAction:t,isWinRatioFedStructure:n,activeDrawPositions:i,positionAssignments:r,drawDefinition:o,drawPosition:a,structureId:s,structure:c,drawId:u,event:d}){var l,p,m,f;if(i.includes(a)||n)return{};const{sourceStructureIds:h,targetStructureIds:v}=(null===(l=o.links)||void 0===l?void 0:l.reduce(((e,t)=>{var n,i;const r=null===(n=t.source)||void 0===n?void 0:n.structureId,o=null===(i=t.target)||void 0===i?void 0:i.structureId;return e.sourceStructureIds.includes(r)||e.sourceStructureIds.push(r),e.targetStructureIds.includes(o)||e.targetStructureIds.push(o),e}),{sourceStructureIds:[],targetStructureIds:[]}))||{};let g=null===(p=o.links)||void 0===p?void 0:p.find((e=>{var t;return(null===(t=e.target)||void 0===t?void 0:t.structureId)===c.structureId}));const I=null===(m=g)||void 0===m||null===(f=m.source)||void 0===f?void 0:f.structureId,{structure:y}=ad({drawDefinition:o,structureId:I}),w={};if("ROUND_OUTCOME"===(null==y?void 0:y.finishingPosition)&&(1!==(null==h?void 0:h.length)||1!==(null==v?void 0:v.length))){var U,b,S;const{matchUps:e}=Xd({drawDefinition:o,structure:c,event:d}),{initialRoundNumber:t}=Ll({drawPosition:a,matchUps:e});g=null===(U=o.links)||void 0===U?void 0:U.find((e=>{var n;return(null===(n=e.target)||void 0===n?void 0:n.structureId)===(null==c?void 0:c.structureId)&&e.target.roundNumber===t}));const n=null===(b=g)||void 0===b||null===(S=b.source)||void 0===S?void 0:S.roundNumber;w.roundNumbers=[n]}const{completedMatchUps:P}=Pl({structureId:I,inContext:!0,matchUpFilters:w,drawDefinition:o}),D=r.map((e=>e.participantId)).filter(Boolean),N=null==P?void 0:P.map((({winningSide:e,sides:t})=>t[1-(e-1)])).map(Qu).filter((e=>!D.includes(e))),M=null==e?void 0:e.filter((e=>null==N?void 0:N.includes(e.participantId)));return null==M||M.forEach((e=>{const t=(o.entries||[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null!=N&&N.length?{validLuckyLosersAction:{type:"LUCKY",method:"luckyLoserDrawPositionAssignment",availableLuckyLosers:M,availableLuckyLoserParticipantIds:N,willDisableLinks:t,payload:{drawId:u,structureId:s,drawPosition:a}}}:{}}({drawId:D,structure:d,structureId:o,drawPosition:r,drawDefinition:i,activeDrawPositions:s,positionAssignments:M,isWinRatioFedStructure:w,tournamentParticipants:t,possiblyDisablingAction:S});e&&P.push(e)}return{isByePosition:L,isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:!!T,validActions:P}}const qv={allPlayoffPositionsFilled:Bp,isCompletedStructure:jp,getStructureMatchUps:Pl,allStructureMatchUps:function(e){const{structure:t}=ad(e);return Object.assign(e,{structure:t,inContext:!0}),Xd(e)},allDrawMatchUps:function(e){return Object.assign(e,{inContext:!0}),Dl(e)},drawMatchUps:function(e){return Object.assign(e,{inContext:!0}),Nl(e)},getEliminationDrawSize:Qh,getParticipantIdMatchUps:Vv,getParticipantIdFinishingPositions:$v,structureActions:function(e){return null!=e&&e.drawDefinition?{actions:[],state:{isComplete:jp(e),hasPlayoffPositionsFilled:Bp(e)}}:{error:jo}},matchUpActions:Kf,positionActions:Wv,getStructureSeedAssignments:Wd,getNextUnfilledDrawPositions:function({drawDefinition:e,structureId:t}){if(!e)return{error:jo,nextUnfilledDrawPositions:[]};if(!t)return{error:"Missing structureId",nextUnfilledDrawPositions:[]};const{structure:n,error:i}=ad({drawDefinition:e,structureId:t});if(i)return{error:i};const r=Kd({structure:n}),o=(null==r?void 0:r.positionAssignments)||[],{unfilledPositions:a}=Kp({drawDefinition:e,structureId:t,randomize:!0}),s=o.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));return null!=a&&a.length?{nextUnfilledDrawPositions:a}:{nextUnfilledDrawPositions:s}},getExitProfiles:function({drawDefinition:e}){if("object"!=typeof e)return{error:"Invalid drawDefinition"};const t={},{structures:n=[],links:i=[]}=e||{},r=n.reduce(((e,t)=>{const{stage:n}=t;return e[n]?e[n].push(t):e[n]=[t],e}),{});for(const a of Object.keys(r)){const e=r[a].find((({stageSequence:e})=>1===e)),{structureId:n}=e;o(t,"0",a,n,0)}return{exitProfiles:t};function o(e,t,r,a,s){e[a]||(e[a]=[]),"0"===t&&[nu,iu].includes(r)||e[a].push(t);const c=i.filter((e=>e.source.structureId===a&&e.source.roundNumber>=s));for(const i of c){const r=i.source.roundNumber,a=i.target.roundNumber,s=i.target.structureId;o(e,`${t}-${r}`,n.find((e=>e.structureId===s)).stage,s,a)}}},getMatchUpContextIds:function({matchUps:e,matchUpId:t}){if(!Array.isArray(e))return{error:_o};const n=e.find((e=>e.matchUpId===t)),{drawId:i,eventId:r,structureId:o,tournamentId:a}=n||{};return{matchUpId:t,drawId:i,eventId:r,structureId:o,tournamentId:a}},getMatchUpParticipantIds:Jd,getMatchUpScheduleDetails:oc,generateTieMatchUpScore:cc,matchUpDuration:ws,credits:Hf};function zv({validation:e=!0,drawDefinition:t,participantId:n,structureId:i,seedValue:r}){if(!t)return{error:jo};if(!i)return{error:"Missing structureId"};const{structure:o}=ad({drawDefinition:t,structureId:i});if(!o)return{error:"structure not found"};if(!(!e||ho(r)||[void 0,""].includes(r)||"string"==typeof r&&r.split("-").every((e=>ho(e)&&e>0))))return{error:_o};const{seedAssignments:a}=Wd({drawDefinition:t,structure:o}),s=a.map((e=>e.seedNumber)),c=a.find((e=>e.participantId===n));if(c){const e="string"==typeof r&&r.includes("-")?r.split("-").map((e=>parseInt(e))).join("-"):r>0?parseInt(r):"";c.seedValue=e}else{const e=Math.max(0,...s)+1;o.seedAssignments.push({seedNumber:e,seedValue:r,participantId:n})}return zu({drawDefinition:t,structureIds:[i]}),ko}function Hv({drawDefinition:e,participantId:t,structureId:n,seedNumber:i,seedValue:r}){const{structure:o}=ad({drawDefinition:e,structureId:n}),{positionAssignments:a}=Kd({structure:o}),{seedAssignments:s}=Wd({drawDefinition:e,structure:o}),c=s.map((e=>e.seedNumber)),u=hv({drawDefinition:e,participantId:t});if(t&&!u)return{error:"Invalid participantId",participantId:t,method:"assignSeed"};const d=a.find((e=>e.participantId===t)),l=null==d?void 0:d.drawPosition;if(l&&!Hp({seedNumber:i,drawDefinition:e,structureId:n,drawPosition:l}))return{error:"Invalid drawPosition for seedAssignment"};if(c.includes(i)){let o;if(s.forEach((e=>{e.participantId===t&&e.seedNumber!==i&&(e.participantId=void 0),e.seedNumber===i&&(e.participantId=t,e.seedValue=r||i,o=!0)})),o)return zu({drawDefinition:e,structureIds:[n]}),f({},ko)}return{error:"Invalid seedNumber"}}const Kv={addDrawEntry:vv,addDrawEntries:gv,assignSeed:Hv,removeEntry:function({participantId:e,drawDefinition:t,autoEntryPositions:n=!0}){return t?e?ov({drawDefinition:t}).includes(e)?{error:"Existing participant drawPosition assignment"}:(null!=t&&t.entries&&(t.entries=t.entries.filter((t=>t.participantId!==e))),n&&(t.entries=av({entries:t.entries})),zu({drawDefinition:t}),f({},ko)):{error:"Missing participantId"}:{error:jo}},setStageDrawSize:Nh,setStageAlternatesCount:function({drawDefinition:e,stage:t,alternatesCount:n}){return e?Fd({drawDefinition:e,stage:t})?(vd({attributes:[{[t]:{alternates:n}}],drawDefinition:e}),n||(e.entries=(null===(i=e.entries)||void 0===i?void 0:i.filter((e=>e.entryStatus!==yd)))||[]),zu({drawDefinition:e}),f({},ko)):{error:"Invalid stage"}:{error:jo};var i},setStageWildcardsCount:function({drawDefinition:e,stage:t,wildcardsCount:n=0}){if(!e)return{error:jo};if(!Fd({drawDefinition:e,stage:t}))return{error:"Invalid stage"};const i=Ld({drawDefinition:e,stage:t}),r=jd({drawDefinition:e,stage:t}),o=Gd({drawDefinition:e,stage:t}),a=$d({drawDefinition:e,stage:t});return n<o?{error:"Number of Wildcards cannot be less than number of Wildcards already entered"}:a+n+r>i?{error:"Total stage Entries cannot be greater than drawPositions"}:(vd({attributes:[{[t]:{wildcardsCount:n}}],drawDefinition:e}),zu({drawDefinition:e}),f({},ko))},setStageQualifiersCount:Mh,modifySeedAssignment:zv},Yv={generateQualifyingLink:function({qualifyingStructureId:e,mainStructureId:t,qualifyingRoundNumber:n,mainEntryRound:i=1,drawDefinition:r}){if(!r)return{error:jo};const o={linkType:"WINNER",source:{roundNumber:n,structureId:e},target:{feedProfile:"DRAW",roundNumber:i,structureId:t}};r.links.push(o),zu({drawDefinition:r})}},Jv=["drawId","structures"];function Zv(e,t=!0){return e?"object"!=typeof e?{error:"Invalid object"}:e.drawId?function(e){const t=Object.keys(e);return Jv.reduce(((e,n)=>!!t.includes(n)&&e),!0)}(e)?t?Ja(e):e:{error:"Invalid drawDefinition"}:{error:"Missing drawId",method:"setState"}:{error:jo}}function Qv({drawId:e=es(),matchUpType:t,drawType:n}={}){return Object.assign({drawId:void 0,drawName:void 0,matchUpType:void 0,entries:[],links:[],structures:[]},{drawId:e,drawType:n,matchUpType:t})}let Xv,eg=[];const tg=function(){const e={getState:({convertExtensions:e,removeExtensions:t}={})=>({drawDefinition:Ja(Xv,e,!1,t)}),version:()=>"0.74.1",reset:()=>(Xv=void 0,ko),newDrawDefinition:({drawId:e,drawType:t}={})=>(Xv=Qv({drawId:e,drawType:t}),Object.assign({drawId:Xv.drawId,drawDefinition:Ja(Xv)},ko)),setDrawDescription:({description:e}={})=>Xv?(Xv.description=e,zu({drawDefinition:Xv}),Object.assign({drawId:Xv.drawId},ko)):{error:jo}};return[Yv,qv,Kc,Kv,Bv,Lv,Nv,Zh].forEach((n=>{Object.keys(n).forEach((i=>{e[i]=e=>{if(sa())return t({params:e,governor:n,governorMethod:i});try{return t({params:e,governor:n,governorMethod:i})}catch(r){const t=r.toString();console.log("ERROR",{error:t,method:i,params:JSON.stringify(e)}),console.log(r)}}}))})),e.devContext=t=>(ca(t),e),e.setParticipants=(t=[])=>(eg=t,e),e.setState=(t,n,i)=>{return da(n,i),null!=(r=Zv(t))&&r.error?(e.error=r.error,e.success=!1):(e.error=void 0,e.success=!0,Xv=r,e.drawId=r.drawId),e;var r},e;function t({params:t,governor:n,governorMethod:i}){var r,o,a,s;delete e.success,delete e.error;const c=(null===(r=t)||void 0===r?void 0:r.rollbackOnError)&&Ja(Xv,!1,!0);t=h(f({},t),{tournamentParticipants:eg,drawDefinition:Xv});const u=n[i](t);if(null!=u&&u.error)return c&&Zv(c),h(f({},u),{rolledBack:!!c});const d=(null==u?void 0:u.success)&&!0!==(null===(o=t)||void 0===o?void 0:o.delayNotify)&&!0!==(null===(a=t)||void 0===a?void 0:a.doNotNotify);return d&&Hm(),(d||null==u||!u.success||null!==(s=t)&&void 0!==s&&s.doNotNotify)&&ma(),u}}();function ng(e,t){var n;if("object"!=typeof e)return{error:"Invalid object"};const i=(null===(n=e.unifiedTournamentId)||void 0===n?void 0:n.tournamentId)||e.tournamentId;if(!i)return{error:"Missing tournamentId"};const r=!1!==t?Ja(e):e;return wa({[i]:r}),Ua(i),r}const ig={getTournamentPoints:function({tournamentRecord:e,policyDefinition:t}){if(!e)return{error:Lo};const{policyDefinitions:n}=vp({policyTypes:["rankingPoints"],tournamentRecord:e}),i=(null==t?void 0:t.rankingPoints)||(null==n?void 0:n.rankingPoints);if(!i)return{error:"Missing policyDefinitions"};const{tournamentParticipants:r}=jm({tournamentRecord:e,withDraws:!0}),o=r.filter((e=>{var t;return null===(t=e.draws)||void 0===t?void 0:t.length})),a={};for(const s of o){const{events:e,draws:t,person:n,individualParticipants:r}=s,o=null==n?void 0:n.personId;r&&console.log("individualParticipants"),t.forEach((t=>{var n,r,s,c;const{drawSize:u,eventId:d,finishingPositionRange:l,drawName:p}=t,m=bo(l).join("-"),f=null==e?void 0:e.find((e=>e.eventId===d)),{category:h,eventType:v}=f||{},g=(null===(n=i.categories)||void 0===n||null===(r=n[h])||void 0===r?void 0:r.finishingPositionRanges)||i.finishingPositionRanges,I=null==g?void 0:g[m],y=(null==I?void 0:I.value)||(null==I||null===(s=I.drawSizes)||void 0===s||null===(c=s[u])||void 0===c?void 0:c.value)||I;o&&I&&(a[o]||(a[o]=[]),a[o].push({drawName:p,eventType:v,rangeAccessor:m,points:y}))}))}return f({personPoints:a},ko)}},rg="ELO",og={[rg]:{range:[0,3e3],decimalsCount:0,defaultInitialization:1500},NTRP:{range:[1,7],decimalsCount:1,defaultInitialization:3,accessor:"dntrpRatingHundredths",accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""}},UTR:{range:[1,16],decimalsCount:2,defaultInitialization:6},WTN:{range:[40,1],decimalsCount:2,defaultInitialization:23,accessor:"wtnRating",accessors:["wtnRating"],attributes:{confidence:90}}},ag={nSpread:400,diffThreshold:.125,kCalc:e=>250/Math.pow(e+5,.4),kMultiplier:function(e=3,t=2){let n=e/t;return isNaN(n)?ag.kDefault():n},kDefault:()=>1};function sg({ratings:e=og,winnerCountables:t=1,loserCountables:n=0,ratingType:i=rg,maxCountables:r,winnerRating:o,loserRating:a,ratingRange:s,countables:c}={}){const u=null==e?void 0:e[i];if(!u)return{error:$o};s=u.range||s,o=o||u.defaultInitialization,a=a||u.defaultInitialization;const d=s[0]>s[1],l=u.decimalsCount||0,p=d?s.slice().reverse():s,m=(e,t)=>parseFloat(t)>=Math.min(...e)&&parseFloat(t)<=Math.max(...e);m(s,o)&&m(s,a)||(m(s,o)||(o=u.defaultInitialization),m(s,a)||(a=u.defaultInitialization));const f=({value:e,sourceRange:t,targetRange:n})=>(e-t[0])*(n[1]-n[0])/(t[1]-t[0])+n[0],h=f({targetRange:og.ELO.range,sourceRange:p,value:d?s[0]-o:o}),v=f({targetRange:og.ELO.range,sourceRange:p,value:d?s[0]-a:a}),g=(e,t)=>1/(1+Math.pow(10,(t-e)/ag.nSpread));let I=g(h,v),y=g(v,h),w=ag.kCalc(t),U=ag.kCalc(n),b=ag.kMultiplier(r,c),S=h+b*w*(1-I),P=v+b*U*(0-y),D=f({sourceRange:og.ELO.range,value:S,targetRange:p}),N=f({sourceRange:og.ELO.range,value:P,targetRange:p});const M=d?s[0]-D:D;let T=parseFloat(M).toFixed(l);const E=d?s[0]-N:N;let A=parseFloat(E).toFixed(l);const R=Math.max(...s)?Math.abs(o-a)/Math.max(...s):0;return(D>N&&R>ag.diffThreshold||T<0||A<0)&&(T=o,A=a),{newWinnerRating:T,newLoserRating:A}}function cg({tournamentRecord:e,scaleAttributes:t,participantId:n}){if(!e)return{error:Lo};if(!n)return{error:"Missing participantId"};const{participant:i}=Rs({tournamentRecord:e,participantId:n});return i?Tv({participant:i,scaleAttributes:t}):{error:"Participant Not Found"}}function ug({tournamentRecord:e,participantId:t,scaleItem:n}){let i,r;const o=n&&Object.keys(n)||[],a=["scaleType","eventType","scaleName"],s=a.filter((e=>o.includes(e))).length===a.length;if(!s)return{error:"Invalid scaleItem"};if(t&&s&&Array.isArray(e.participants)&&(r=e.participants.find((e=>e.participantId===t)),r)){const{valueChanged:e,error:t}=lg({participant:r,scaleItem:n});if(t)return{error:t};i=!e;const{topics:o}=fa();o.includes("modifyParticipants")&&la({topic:"modifyParticipants",payload:{participants:[r]}})}return i?h(f({},ko),{message:"Value unchanged",existingValue:n.scaleValue}):r?h(f({},ko),{newValue:n.scaleValue}):{error:"Participant Not Found"}}function dg({scaleItem:e}){const t=e&&Object.keys(e),n=["scaleType","eventType","scaleName"];return!(n.filter((e=>t.includes(e))).length!==n.length)}function lg({participant:e,scaleItem:t}){if(!e)return{error:"Missing participant"};const n=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];if(i.filter((e=>n.includes(e))).length!==i.length)return{error:"Invalid scaleItem"};const r=(new Date).toISOString();e.timeItems||(e.timeItems=[]);const{scaleItem:o}=Tv({participant:e,scaleAttributes:t}),a=e=>[void 0,null,""].includes(e),s=!(a(null==o?void 0:o.scaleValue)&&a(t.scaleValue))&&(null==o?void 0:o.scaleValue)!==t.scaleValue;if(s){const{scaleType:n,eventType:i,scaleName:o}=t,a={itemType:[Cm,n,i,o].join("."),itemValue:t.scaleValue,itemDate:t.scaleDate,createdAt:r};t.scaleId&&(a.itemSubTypes=[t.scaleId]),e.timeItems.push(a)}return Object.assign({valueChanged:s,newValue:t.scaleValue},ko)}const pg={calculateNewRatings:sg,processMatchUps:function({tournamentRecord:e,ratingType:t=rg,considerGames:n,matchUpIds:i,asDynamic:r}){if(!e)return{error:Lo};if(!Array.isArray(i))return{error:"Missing matchUps"};if("string"!=typeof t)return{error:_o,ratingType:t};if(!og[t])return{error:_o};const o=og[t],{accessor:a}=o,s={},{matchUps:c}=Ml({matchUpFilters:{matchUpIds:i,matchUpStatuses:ao},tournamentRecord:e,inContext:!0});for(const m of c.sort(op)){const{endDate:i,matchUpFormat:o,matchUpType:c,score:p,sides:v,winningSide:g}=m,I={scaleType:xm,eventType:c,scaleName:t},y=`${t}.DYNAMIC`,w={scaleType:xm,eventType:c,scaleName:y},U=Object.assign({},...v.map((({sideNumber:e,participant:t})=>({[e]:[null==t?void 0:t.participantId,...(null==t?void 0:t.individualParticipantIds)||[]].filter(Boolean).flat()})))),b=r?y:t,S=Object.assign({},...Object.values(U).flat().map((t=>{const{scaleItem:n}=cg({scaleAttributes:w,tournamentRecord:e,participantId:t}),{scaleItem:r}=cg({tournamentRecord:e,scaleAttributes:I,participantId:t});return{[t]:n||r||{scaleName:b,scaleType:xm,eventType:c,scaleDate:i,scaleValue:a?{[a]:void 0}:void 0}}}))),P=kr(o)||{},D=(null==P?void 0:P.bestOf)||1,N=(null==P?void 0:P.setsTo)||1,M=n?D&N:D,T=null!=p&&p.sets?(null==(l=p.sets)?void 0:l.reduce(((e,t)=>(t.winningSide&&(e[t.winningSide-1]+=1),e)),[0,0]))||[0,0]:1===g?[1,0]:[0,1],E=U[g],A=U[3-g];for(const n of E){var u;const i=null===(u=S[n])||void 0===u?void 0:u.scaleValue,r="object"==typeof i?i[a]:i;for(const o of A){var d;const s=null===(d=S[o])||void 0===d?void 0:d.scaleValue,c="object"==typeof s?s[a]:s,u=T[g],l=T[3-g],{newWinnerRating:p,newLoserRating:m}=sg({winnerCountables:u,loserCountables:l,maxCountables:M,winnerRating:r,loserRating:c,ratingType:t}),v=a?h(f({},i),{[a]:p}):p,I=a?h(f({},s),{[a]:m}):m;S[n].scaleValue=v,S[o].scaleValue=I;let y=ug({scaleItem:h(f({},S[n]),{scaleName:b}),participantId:n,tournamentRecord:e});if(y.error)return y;if(y=ug({scaleItem:h(f({},S[o]),{scaleName:b}),participantId:o,tournamentRecord:e}),y.error)return y}}Object.assign(s,S)}var l;const p=c.map((({matchUpId:e})=>e));return h(f({},ko),{modifiedScaleValues:s,processedMatchUpIds:p})}};function mg(e={}){return e.tournamentId||Object.assign(e,{tournamentId:es()}),e.startDate&&!ka(e.startDate)&&!Sa.test(e.startDate)||e.endDate&&!ka(e.endDate)&&!Sa.test(e.endDate)?{error:Go}:(e.extensions&&(e.extensions=e.filter(cd)),f({},e))}function fg(e,t){var n;if("object"!=typeof e)return{error:"Invalid object"};const i=(null===(n=e.unifiedTournamentId)||void 0===n?void 0:n.tournamentId)||e.tournamentId;if(!i)return{error:"Missing tournamentId"};const r=!1!==t?Ja(e):e;return wa({[i]:r}),Ua(i),r}function hg({individualParticipantIds:e,groupingParticipantId:t,removeFromOtherTeams:n,tournamentRecord:i}){if(!i)return{error:Lo};if(!t||!e)return{error:$o};const r=i.participants||[],o=r.find((e=>e.participantId===t));if(!o)return{error:"Participant Not Found"};if(![lc,mc].includes(o.participantType))return{error:"Invalid participantType",participantType:o.participantType};const a=e.filter((e=>{const t=r.find((t=>t.participantId===e));return(null==t?void 0:t.participantType)!==dc}));if(a.length)return{error:"Invalid participantIds",invalidParticipantIds:a};o.individualParticipantIds||(o.individualParticipantIds=[]);const s=o.individualParticipantIds,c=e.filter((e=>!s.includes(e)));c.length&&(n&&lv({tournamentRecord:i,individualParticipantIds:c}),o.individualParticipantIds=o.individualParticipantIds.concat(...c));const{topics:u}=fa();return u.includes("modifyParticipants")&&la({topic:"modifyParticipants",payload:{participants:[r.find((({participantId:e})=>e===t))]}}),function({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:n}){const i=(n.events||[]).filter((e=>{var n;return(null==e?void 0:e.eventType)===Qs&&(null==e||null===(n=e.entries)||void 0===n?void 0:n.some((e=>e.participantId===t)))})),r=t=>!e.includes(t.participantId);for(const s of i){var o,a;s.entries=(s.entries||[]).filter(r);const{flightProfile:e}=yp({event:s});null==e||null===(o=e.flights)||void 0===o||o.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter(r)})),null==s||null===(a=s.drawDefinitions)||void 0===a||a.forEach((e=>{e.entries=(e.entries||[]).filter(r)}))}}({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}),f({groupingParticipant:Ja(o),added:c.length},ko)}function vg({participantAttribute:e,tournamentRecord:t,personAttribute:n,teamNames:i,accessor:r,uuids:o}){if(!t)return{error:Lo};const a={},s=(t.participants||[]).filter((({participantType:e,participantRole:t})=>e===dc&&t===Af));let c=0;for(const m of s){const{value:t}=km({element:m,accessor:r}),s=t||(n?m.person[n]:m[e]);if(s){if(!Object.keys(a).includes(s)){a[s]={participantName:(null==i?void 0:i[c])||s,participantId:(null==o?void 0:o.pop())||es(),participantType:lc,participantRole:Af,individualParticipantIds:[]};const t={name:"groupingAttribute",value:n||e};ud({element:a[s],extension:t}),c+=1}a[s].individualParticipantIds.push(m.participantId)}}const u=Object.keys(a),d=(t.participants||[]).map((e=>{if(e.participantType!==lc)return;if(e.participantRole!==Af)return;const{extension:t}=Cs({element:e,name:"groupingAttribute"}),n=null==t?void 0:t.value;return u.includes(n)?e.participantId:void 0})).filter(Boolean),l=[];let p=0;return Object.keys(a).forEach((e=>{const n=a[e],{participantId:i}=n;d.includes(i)||(t.participants.push(n),l.push(n),p++)})),p&&la({topic:"addParticipants",payload:{participants:l}}),p?h(f({},ko),{participantsAdded:p}):{error:"No matching participants found"}}!function(){const e={getState:({convertExtensions:e,removeExtensions:t}={})=>function({convertExtensions:e,removeExtensions:t,tournamentId:n}={}){return"string"!=typeof n?{}:{tournamentRecord:Ja(ga(n),e,!1,t)}}({convertExtensions:e,removeExtensions:t,tournamentId:va()}),setTournamentId:e=>Ua(e)};function t(t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}return e.version=()=>"0.74.1",e.reset=()=>t(ba(va())),e.setState=(e,n,i)=>(da(n,i),t(ng(e,n))),[ig,pg].forEach((t=>{Object.keys(t).forEach((i=>{e[i]=e=>{if(sa())return n(t[i],e);try{return n(t[i],e)}catch(r){const t=r.toString();console.log("ERROR",{error:t,method:i,params:JSON.stringify(e)}),console.log(r)}}}))})),e;function n(t,n){const i=(null==n?void 0:n.sandBoxRecord)||(null==n?void 0:n.sandboxRecord)||(null==n?void 0:n.sandboxTournament)||ga(va()),r=(null==n?void 0:n.rollbackOnError)&&Ja(i,!1,!0),o=(a=i,s=t,c=n,delete e.success,delete e.error,s(h(f({},function(e,t){return t&&t.someParam&&(t=f({},t)),t}(0,c)),{tournamentRecord:a})));var a,s,c;null!=o&&o.error&&r&&ng(r);const u=(null==o?void 0:o.success)&&!0!==(null==n?void 0:n.delayNotify)&&!0!==(null==n?void 0:n.doNotNotify);return u&&Hm(),(u||null==o||!o.success||null!=n&&n.doNotNotify)&&ma(),o}}();const gg="MALE",Ig="FEMALE",yg={ANY:"ANY",MALE:gg,FEMALE:Ig,MIXED:"MIXED",OTHER:"OTHER"};function wg({updateParticipantName:e=!0,groupingParticipantId:t,removeFromOtherTeams:n,tournamentRecord:i,pairOverride:r,participant:o}){if(!i)return{error:Lo};if(!o)return{error:"Missing participant"};if(!o.participantId)return bm({tournamentRecord:i,participant:o});const{participant:a}=Rs({tournamentRecord:i,participantId:o.participantId});if(!a)return bm({tournamentRecord:i,participant:o});const{participantRoleResponsibilties:s,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:l,participantType:p,onlineProfiles:m,contacts:v,person:g}=o,I={};if(v&&(I.contacts=v),m&&(I.onlineProfiles=m),d&&"string"==typeof d&&(I.participantName=d),u&&"string"==typeof u&&(I.participantOtherName=u),Array.isArray(c)){const{tournamentParticipants:t}=jm({tournamentRecord:i,participantFilters:{participantTypes:[fc.INDIVIDUAL]}}),n=null==t?void 0:t.map(Qu);if(n){const i=c.filter((e=>"string"==typeof e&&n.includes(e)));([mc,Bs].includes(p)||p===pc&&(2===i.length||r))&&(I.individualParticipantIds=i),a.participantType===fc.PAIR&&e&&(I.participantName=function({individualParticipants:e,newValues:t}){const n=t.individualParticipantIds;let i=e.filter((({participantId:e})=>n.includes(e))).map((({person:e})=>null==e?void 0:e.standardFamilyName)).filter(Boolean).sort().join("/");return 1===n.length&&(i+="/Unknown"),i}({individualParticipants:t,newValues:I}))}}return Object.keys(Rf).includes(l)&&(I.participantRole=l),Object.keys(fc).includes(p)&&(I.participantType=p),Array.isArray(s)&&(I.participantRoleResponsibilties=s),a.participantType===fc.INDIVIDUAL&&g&&function({updateParticipantName:e,existingParticipant:t,newValues:n,person:i}){const r={},{sex:o,personId:a,nationalityCode:s,standardFamilyName:c,standardGivenName:u}=i;let d;if(o&&Object.keys(yg).includes(o)&&(r.sex=o),a&&"string"==typeof a&&(r.personId=a),s&&"string"==typeof s&&s.length<4&&(r.nationalityCode=s),c&&"string"==typeof c&&c.length>1&&(r.standardFamilyName=c,d=!0),u&&"string"==typeof u&&u.length>1&&(r.standardGivenName=u,d=!0),d&&e){const e=`${r.standardGivenName} ${r.standardFamilyName}`;n.participantName=e}Object.assign(t.person,r)}({updateParticipantName:e,existingParticipant:a,newValues:I,person:g}),Object.assign(a,Za(I)),t&&hg({tournamentRecord:i,groupingParticipantId:t,individualParticipantIds:[a.participantId],removeFromOtherTeams:n}),la({topic:"modifyParticipants",payload:{participants:[a]}}),sa()?h(f({},ko),{participant:Ja(a)}):f({},ko)}const Ug={addPenalty:Gm,modifyPenalty:qm,removePenalty:_m,getTournamentPenalties:Wm,addPersons:function({participantRole:e=Af,tournamentRecord:t,persons:n}){var i;if(!t)return{error:Lo};if(!Array.isArray(n))return{error:_o};if(!Object.keys(Rf).includes(e))return{error:"Invalid participantRole"};const r=(t.participants||[]).map((({person:e})=>null==e?void 0:e.personId)).filter(Boolean),o=[];let a=0,s=0,c=Sm({participants:n.filter((e=>e&&(!e.personId||!r.includes(e.personId)))).map((e=>(e.personId||(e.personId=es()),o.push(e.personId),e))).map((t=>{return Za({extensions:t.participantExtensions,timeItems:t.participantTimeItems,participantType:dc,participantRole:e,person:(n=t,i=["participantExtensions","participantTimeItems","pairedPersons"],Object.assign({},...Object.keys(n).filter((e=>!i.includes(e))).map((e=>({[e]:n[e]})))))});var n,i})),tournamentRecord:t});if(c.error)return c;s=c.addedCount||0;const u=[],d=(null===(i=jm({participantFilters:{participantTypes:[dc]},tournamentRecord:t}))||void 0===i?void 0:i.tournamentParticipants)||[];if(e===Af&&n.filter((({pairedPersons:e})=>e)).forEach((({personId:e,pairedPersons:t})=>{Array.isArray(t)&&t.forEach((t=>{const n=[e,t.personId].map((e=>As({tournamentParticipants:d,personId:e}))).filter(Boolean);if(2===n.length){const e=n.map(Qu);u.push(Za({extensions:t.participantExtensions,timeItems:t.timeItems,participantRole:Af,individualParticipantIds:e,participantType:pc}))}}))})),u.length){if(c=Sm({participants:u,tournamentRecord:t}),c.error)return c;a=c.addedCount||0}const l=s+a;return h(f({},ko),{addedCount:l})},addParticipant:bm,addParticipants:Sm,deleteParticipants:pv,createGroupParticipant:function({tournamentRecord:e,participantId:t,individualParticipantIds:n=[],participantRoleResponsibilities:i,participantRole:r="OTHER",groupName:o}){if(!e)return{error:Lo};if(!o)return{error:$o,message:"Missing groupName"};if(!Array.isArray(n))return{error:_o,message:"Invalid individualParticipantIds"};const{tournamentParticipants:a}=jm({tournamentRecord:e,participantFilters:{participantTypes:[dc]}}),s=a.map((e=>e.participantId));for(const l of n)if(!s.includes(l))return{error:"Invalid participantType",participantId:l};const c=Za({participantId:t||es(),participantType:mc,participantRole:r,participantName:o,individualParticipantIds:n,participantRoleResponsibilities:i}),u=bm({tournamentRecord:e,participant:c});if(u.error)return u;const{topics:d}=fa();return d.includes("addParticipants")&&la({topic:"addParticipants",payload:{participants:[c]}}),h(f({},ko),{participant:Ja(c)})},addIndividualParticipantIds:hg,removeIndividualParticipantIds:uv,modifyIndividualParticipantIds:function({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:n}){if(!e)return{error:Lo};if(!t||!n)return{error:$o};const i=e.participants||[],r=i.find((e=>e.participantId===t));if(!r)return{error:"Participant Not Found"};if(![lc,mc].includes(r.participantType))return{error:"Invalid participantType",participantType:r.participantType};const o=n.filter((e=>{const t=i.find((t=>t.participantId===e));return(null==t?void 0:t.participantType)!==dc}));if(o.length)return{error:"Invalid participantIds",invalidParticipantIds:o};const a=r.individualParticipantIds||[],s=n.filter((e=>!a.includes(e))),c=a.filter((e=>!n.includes(e))),u=hg({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:s});if(u.error)return u;const d=uv({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:c});if(d.error)return d;const{topics:l}=fa();return l.includes("modifyParticipants")&&la({topic:"modifyParticipants",payload:{participants:[i.find((({participantId:e})=>e===t))]}}),f(f({},u),d)},removeParticipantIdsFromAllTeams:lv,getParticipantMembership:function({tournamentRecord:e,participantId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing participantId"};const{tournamentParticipants:n}=jm({tournamentRecord:e,participantFilters:{participantTypes:[lc,pc,mc]}});return(n||[]).filter((e=>{var n;return null===(n=e.individualParticipantIds)||void 0===n?void 0:n.includes(t)})).reduce(((e,t)=>{const{participantType:n}=t;return e[n]||(e[n]=[]),e[n].push(t),e}),{})},generateTeamsFromParticipantAttribute:vg,getParticipantIdFinishingPositions:function({tournamentRecord:e,drawDefinition:t,byeAdvancements:n=!1}){return e?$v({tournamentParticipants:e.participants,byeAdvancements:n,drawDefinition:t}):{error:Lo}},modifyParticipant:wg,modifyParticipantName:function({tournamentRecord:e,participantId:t,participantName:n}){if(!e)return{error:Lo};if(!t)return{error:"Missing participantId"};if(!n)return{error:$o,message:"Missing participantName"};const{participant:i}=Rs({tournamentRecord:e,participantId:t});if(!i)return{error:"Participant Not Found"};i.participantName=n;const{topics:r}=fa();return r.includes("modifyParticipants")&&la({topic:"modifyParticipants",payload:{participants:[i]}}),ko},modifyParticipantOtherName:function({tournamentRecord:e,participantId:t,participantOtherName:n}){if(!e)return{error:Lo};if(!t)return{error:"Missing participantId"};const{participant:i}=Rs({tournamentRecord:e,participantId:t});if(!i)return{error:"Participant Not Found"};i.participantOtherName=n;const{topics:r}=fa();return r.includes("modifyParticipants")&&la({topic:"modifyParticipants",payload:{participants:[i]}}),ko},mergeParticipants:function({tournamentRecord:e,participants:t=[],arraysToMerge:n}){if(!e)return{error:Lo};e.participants||(e.participants=[]);const i=Object.assign(...t.filter(gp).map((e=>({[e.participantId]:e})))),r=[];e.participants=e.participants.map((e=>{if(i[e.participantId]){const t=Bm(e,i[e.participantId],n);return r.push(t),t}return e}));const o=e.participants.map(Qu),a=t.filter((({participantId:e})=>!o.includes(e))),{topics:s}=fa();return a.length&&(e.participants=e.participants.concat(...a),s.includes("addParticipants")&&la({topic:"addParticipants",payload:{participants:a}})),r.length&&s.includes("modifyParticipants")&&la({topic:"modifyParticipants",payload:{participants:r}}),a.length||r.length?ko:void 0},getPairedParticipant:Hu,setParticipantScaleItem:ug,setParticipantScaleItems:function({scaleItemsWithParticipantIds:e=[],tournamentRecord:t}){if(!t)return{error:Lo};if(!t.participants)return{error:"Missing participants"};let n=0;const i={},r=[];for(const s of e){const e=null==s?void 0:s.participantId;Array.isArray(null==s?void 0:s.scaleItems)&&s.scaleItems.forEach((t=>{if(!dg({scaleItem:t}))return{error:"Invalid scaleItem"};Array.isArray(i[e])||(i[e]=[]),i[e].push(t)}))}t.participants.forEach((e=>{const{participantId:t}=e||{};Array.isArray(i[t])&&i[t].forEach((t=>{lg({participant:e,scaleItem:t}),r.push(e),n++}))}));const o=n?void 0:"No modifications applied",{topics:a}=fa();return a.includes("modifyParticipants")&&n&&la({topic:"modifyParticipants",payload:{participants:r}}),Za(h(f({},ko),{modificationsApplied:n,message:o}))},modifyParticipantsSignInStatus:function({tournamentRecord:e,participantIds:t,signInState:n}){if(!e)return{error:Lo};if(!Array.isArray(t))return{error:$o};if(![Am,Rm].includes(n))return{error:_o,signInState:n};const i=e.participants||[];if(!i.length)return{error:"Missing participants"};const r=[],o=(new Date).toISOString();for(const s of i){const{participantId:i}=s;if(t.includes(i)){const t=ju({tournamentRecord:e,duplicateValues:!1,participantId:i,timeItem:{itemType:"SIGN_IN_STATUS",itemValue:n,createdAt:o}});if(t.error)return t;r.push(s)}}const{topics:a}=fa();return r.length&&a.includes("modifyParticipants")&&la({topic:"modifyParticipants",payload:{participants:r}}),f({},ko)},getParticipantEventDetails:function({tournamentRecord:e,participantId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing participantId"};const n=[t].concat((e.participants||[]).filter((e=>{var n;return[lc,pc].includes(e.participantType)&&(null===(n=e.individualParticipantIds)||void 0===n?void 0:n.includes(t))})).map((e=>e.participantId)));return{eventDetails:(e.events||[]).filter((e=>Co(((null==e?void 0:e.entries)||[]).map((e=>e.participantId)),n))).map((e=>({eventName:e.eventName,eventId:e.eventId})))}},findParticipant:function({tournamentRecord:e,policyDefinitions:t,convertExtensions:n,participantId:i,inContext:r,personId:o}){return e?"string"!=typeof i&&"string"!=typeof o?{error:$o}:{participant:Ja(As({tournamentParticipants:e.participants||[],policyDefinitions:t,participantId:i,personId:o,inContext:r}),n,!0)}:{error:Lo}},getTournamentParticipants:jm,getTournamentPersons:function({tournamentRecord:e,participantFilters:t}){if(!e)return{error:Lo};let n=e.participants||[];t&&(n=Fm({tournamentRecord:e,participantFilters:t,participants:n}));const i={},r=e=>{if(e.person){const{personId:t}=e.person;i[t]?i[t].participantIds.push(e.participantId):i[t]=h(f({},e.person),{participantIds:[e.participantId]})}};return n.forEach((e=>{e.person&&r(e),e.individualParticipants&&e.individualParticipants.forEach(r)})),{tournamentPersons:Object.values(i)}}};function bg({tournamentParticipants:e=[],policyDefinitions:t,tournamentRecord:n,inContext:i=!0,drawDefinition:r,context:o,event:a}){if(!r)return{error:jo};const s=(({drawId:e,drawName:t,matchUpFormat:n,updatedAt:i})=>({matchUpFormat:n,updatedAt:i,drawName:t,drawId:e}))(r);let c,u;const{structureGroups:d}=function({drawDefinition:e}){let t=(e.links||[]).map((e=>[e.source.structureId,e.target.structureId]));const n=t.length;Eo(0,Math.ceil(n/2)).forEach((()=>{t=Eo(0,n).map((e=>{const n=t[e],i=t.reduce(((e,t)=>Co(n,t)?e.concat(...t):e),[])||[];return bo(n.concat(...i))}))}));const i=t[0],r=t.slice(1).reduce(((e,t)=>e&&((e,t)=>Ro(e,t).length===e.length)(t,i)),!0),o=[i].filter(Boolean);(e.structures||[]).forEach((e=>{const{structureId:t}=e;o.find((e=>e.includes(t)))||o.push([t])}));const a=r&&1===o.length;return{structureGroups:o,allStructuresLinked:a}}({drawDefinition:r});let l=!1,p=!1;const m=d.map((d=>{const m=d.map((e=>{const{structure:t}=ad({drawDefinition:r,structureId:e}),{seedAssignments:n}=Wd({drawDefinition:r,structure:t});return t.stage===eu&&1===t.stageSequence&&(c=n),t.stage===tu&&1===t.stageSequence&&(u=n),t})).sort(od).map((d=>{const{structureId:m}=d;let v=[];[eu,nu,iu].includes(d.stage)&&(v=c),d.stage===tu&&(v=u);const{matchUps:g,roundMatchUps:I}=Xd({context:f({drawId:s.drawId},o),tournamentParticipants:e,policyDefinitions:t,tournamentRecord:n,seedAssignments:v,drawDefinition:r,structure:d,inContext:i,event:a}),{positionAssignments:y}=Hd({structure:d}),w=y.filter(gp).map((e=>{p=!0;const{drawPosition:t,participantId:n}=e,{extension:i}=Cs({element:e,name:"tally"});return i&&{drawPosition:t,participantId:n,participantResult:i.value}})).filter((e=>null==e?void 0:e.participantResult)),U=(({stage:e,stageSequence:t,structureName:n,structureType:i,matchUpFormat:r,positionAssignments:o})=>({stage:e,stageSequence:t,structureName:n,structureType:i,matchUpFormat:r,positionAssignments:o}))(d);return U.structureActive=g.reduce(((e,t)=>{var n;const i=[Hr,zr,Kr,Qr,to,Jr,Yr].includes(t.matchUpStatus);return e||i||!!t.winningSide||!(null===(n=t.score)||void 0===n||!n.scoreStringSide1)}),!1),U.structureCompleted=g.reduce(((e,t)=>e&&[qr,Hr,Qr,to,Kr,Wr].includes(t.matchUpStatus)),!0),U.structureActive&&(l=!0),h(f({},U),{structureId:m,roundMatchUps:I,seedAssignments:v,participantResults:w})}));return m.forEach((e=>delete e.positionAssignments)),m}));if(m.length>1){const e={error:"drawDefinition contains unlinked structures"};return sa()&&console.log(e),e}const v=m.flat();return s.drawActive=l,s.participantPlacements=p,s.drawGenerated=null==v?void 0:v.reduce(((e,t)=>e||!(null==t||!t.roundMatchUps)),!1),s.drawCompleted=null==v?void 0:v.reduce(((e,t)=>e&&t.structureCompleted),!0),h(f({},ko),{drawInfo:Ja(s),structures:Ja(v)})}function Sg({participantsProfile:e,policyDefinitions:t,tournamentRecord:n,event:i}){if(!n)return{error:Lo};if(!i)return{error:Vo};const{eventId:r}=i,{tournamentId:o,endDate:a}=n,{tournamentParticipants:s}=jm(h(f({withGroupings:!0,withEvents:!1,withDraws:!1,withISO:!0},e),{tournamentRecord:n})),c=(i.drawDefinitions||[]).map((e=>(({drawInfo:e,structures:t})=>h(f({},e),{structures:t}))(bg({context:{eventId:r,tournamentId:o,endDate:a},tournamentParticipants:s,policyDefinitions:t,tournamentRecord:n,drawDefinition:e,event:i})))),{tournamentInfo:u}=_l({tournamentRecord:n}),d=(n.venues||[]).map((e=>(({venueData:e})=>f({},e))(rc({tournamentRecord:n,venueId:e.venueId})))),l={eventInfo:(({eventId:e,eventName:t,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:o,category:a,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:e,eventName:t,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:o,category:a,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(i),drawsData:c,venuesData:d,tournamentInfo:u},{timeItem:p}=Fu({event:i,itemType:"PUBLISH.STATUS"});return l.eventInfo.publish={state:null==p?void 0:p.itemValue,createdAt:null==p?void 0:p.createdAt},h(f({},ko),{eventData:Ja(l)})}function Pg({policyDefinitions:e,structureIds:t=[],tournamentRecord:n,drawIdsToRemove:i,status:r="PUBLIC",drawIdsToAdd:o,drawIds:a,event:s}){var c,u,d;if(!n)return{error:Lo};if(!s)return{error:Vo};const l="PUBLISH.STATUS",p=(null===(c=s.drawDefinitions)||void 0===c?void 0:c.map((({drawId:e})=>e)))||[];if(a||o||i){if(!a&&(null!=o&&o.length||null!=i&&i.length)){var m,v;const{timeItem:e}=Fu({itemType:l,event:s});a=(null==e||null===(m=e.itemValue)||void 0===m||null===(v=m.PUBLIC)||void 0===v?void 0:v.drawIds)||[]}}else a=p;a=(a||[]).filter((e=>!(null!=i&&i.length&&i.includes(e)))),null!=o&&o.length&&(a=bo(a.concat(...o.filter((e=>p.includes(e)))))),Vu({event:s,timeItem:{itemType:l,itemValue:{[r]:{drawIds:a,structureIds:t}}}});const{eventData:g}=Sg({policyDefinitions:e,tournamentRecord:n,event:s}),I=null==g||null===(u=g.eventInfo)||void 0===u||null===(d=u.publish)||void 0===d?void 0:d.state;return g.drawsData=g.drawsData.filter((({drawId:e})=>{var t;return null==I||null===(t=I.PUBLIC)||void 0===t?void 0:t.drawIds.includes(e)})),la({topic:"publishEvent",payload:{eventData:g}}),h(f({},ko),{eventData:g})}const Dg={getTournamentInfo:_l,getVenueData:rc,getCourtInfo:ic,getAllEventData:function({tournamentRecord:e,policyDefinitions:t}){if(!e)return{error:Lo};const n=e.events||[],i=(null==e?void 0:e.participants)||[],{tournamentInfo:r}=_l({tournamentRecord:e}),{venues:o}=Xs({tournamentRecord:e});return{allEventData:{tournamentInfo:r,venuesData:o,eventsData:n.map((n=>{const{eventId:r}=n,o=(({eventId:e,eventName:t,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:o,category:a,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:e,eventName:t,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:o,category:a,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(n),a=Fs({tournamentRecord:e,event:n}).scheduleTiming,s=(n.drawDefinitions||[]).map((o=>{const s=(({drawId:e,drawName:t,matchUpFormat:n,updatedAt:i})=>({drawId:e,drawName:t,matchUpFormat:n,updatedAt:i}))(o),{pendingMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,abandonedMatchUps:l}=Nl({includeByeMatchUps:!1,requireParticipants:!0,tournamentParticipants:i,context:{eventId:r},policyDefinitions:t,tournamentRecord:e,inContext:!0,drawDefinition:o,scheduleTiming:a,event:n});return{drawInfo:s,matchUps:{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}}})),{timeItem:c}=Fu({event:n,itemType:"PUBLISH.STATUS"});return Object.assign(o,{publish:null==c?void 0:c.itemValue,drawsData:s}),o}))}}},getEventData:Sg,getDrawData:bg,publishEvent:Pg,unPublishEvent:function({tournamentRecord:e,event:t}){return e?t?(Vu({event:t,timeItem:{itemType:"PUBLISH.STATUS",itemValue:"HIDDEN"}}),la({topic:"unPublishEvent",payload:{eventId:t.eventId}}),Object.assign({eventId:t.eventId},ko)):{error:Vo}:{error:Lo}}};function Ng(e){var t,n,i,r,o;const a=null===(t=e.participants)||void 0===t?void 0:t.filter((({participantType:e})=>e===lc)),s=2===(null==a?void 0:a.length),c=1===(null===(n=e.events)||void 0===n?void 0:n.length)&&e.events[0],u=1===(null==c||null===(i=c.drawDefinitions)||void 0===i?void 0:i.length)&&c.drawDefinitions[0],d=1===(null==u||null===(r=u.structures)||void 0===r?void 0:r.length)&&u.structures[0],l=2===(null==d||null===(o=d.positionAssignments)||void 0===o?void 0:o.length);return c.tieFormat&&s&&l}const Mg={addNotes:hp,removeNotes:function({element:e}={}){return"object"!=typeof e?{error:_o}:(e.notes&&delete e.notes,ko)},analyzeTournament:function({tournamentRecord:e}){if(!e)return{error:Lo};const{drawsAnalysis:t}=function(e){var t;const n={noPositionsAssigned:0,positionsNoOutcomes:0,matchPlayDraws:0,canBePruned:0,draws:[]};return(null===(t=e.events)||void 0===t?void 0:t.map((e=>null==e?void 0:e.drawDefinitions)).flat().filter(Boolean)).forEach((e=>{const t=((null==e?void 0:e.structures)||[]).map((t=>{const{stage:n,stageSequence:i,structureId:r}=t,o=ou[n],{inContextStructureMatchUps:a}=dp({drawDefinition:e,structure:t}),{positionAssignments:s}=Hd({structure:t}),c=null==s?void 0:s.filter((({participantId:e})=>e)),u=((null==s?void 0:s.length)||0)-((null==c?void 0:c.length)||0),{roundMatchUps:d,roundProfile:l,roundNumbers:p,maxMatchUpsCount:m}=nd({matchUps:a}),f=Object.keys(l).filter((e=>!l[e].inactiveRound)),h=Object.values(l).every((e=>e.inactiveRound));return{positionsAssignedCount:(null==c?void 0:c.length)||0,unassignedPositionsCount:u,inactiveStructure:h,maxMatchUpsCount:m,roundMatchUps:d,activeRounds:f,roundNumbers:p,roundProfile:l,structureId:r,stageSequence:i,orderNumber:o,stage:n}})),i=t.find((e=>2===e.orderNumber&&1===e.stageSequence)),r=1===i.activeRounds.length&&1===parseInt(i.activeRounds[0]),o=i.activeRounds.length&&i.roundProfile[1].inActiveCount;r&&(n.matchPlayDraws+=1),o&&(n.canBePruned+=1),n.draws.push({drawId:e.drawId,structureData:t,isMatchPlay:r})})),h(f({},ko),{drawsAnalysis:n})}(e),n={isDual:Ng(e),drawsAnalysis:t};return h(f({},ko),{analysis:n})},setTournamentName:function({tournamentRecord:e,tournamentName:t,promotionalName:n,formalName:i}){return e?(t&&(e.tournamentName=t),n&&(e.promotionalName=n),i&&(e.formalName=i),e.promotionalName===e.tournamentName&&delete e.promotionalName,e.formalName===e.tournamentName&&delete e.formalName,ko):{error:Lo}},setTournamentNotes:function({tournamentRecord:e,notes:t}){return e?hp({element:e,notes:t}):{error:Lo}},setTournamentEndDate:function({tournamentRecord:e,endDate:t}){return e?Da.test(t)?(e.endDate&&new Date(e.endDate),e.startDate&&new Date(t)<new Date(e.startDate)&&(e.startDate=t),e.endDate=t,ko):{error:Go}:{error:Lo}},setTournamentStartDate:function({tournamentRecord:e,startDate:t}){return e?Da.test(t)?(e.startDate&&new Date(e.startDate),e.endDate&&new Date(t)>new Date(e.endDate)&&(e.endDate=t),e.startDate=t,ko):{error:Go}:{error:Lo}},setTournamentCategories:function({tournamentRecord:e,categories:t}){return e?(t=(t||[]).filter((e=>e.categoryName&&e.type)),e.tournamentCategories=t,ko):{error:Lo}},addEventTimeItem:Vu,addTournamentTimeItem:Bu,addParticipantTimeItem:ju,addEventExtension:md,removeEventExtension:hd,addTournamentExtension:ld,removeTournamentExtension:fd,addParticipantExtension:function({tournamentRecord:e,participantId:t,extension:n}={}){if(!t)return{error:"Missing participantId"};const i=As({tournamentParticipants:(null==e?void 0:e.participants)||[],participantId:t});return i?ud({element:i,extension:n}):{error:"Participant Not Found"}},removeParticipantExtension:function({tournamentRecord:e,participantId:t,name:n}={}){if(!t)return{error:"Missing participantId"};const i=As({tournamentParticipants:(null==e?void 0:e.participants)||[],participantId:t});return i?dd({element:i,name:n}):{error:"Participant Not Found"}},addDrawDefinitionExtension:pd,removeDrawDefinitionExtension:function({drawDefinition:e,name:t}={}){return e?dd({element:e,name:t}):{error:"drawDefinition not found"}}},Tg={assignMatchUpCourt:il,assignMatchUpVenue:nl,addMatchUpScheduleItems:Cf,addMatchUpScheduledDate:xf,addMatchUpScheduledTime:Of,addMatchUpStartTime:kf,addMatchUpEndTime:Ff,addMatchUpStopTime:Lf,addMatchUpResumeTime:jf,addMatchUpOfficial:Bf,getMatchUpFormatTiming:$s,modifyMatchUpFormatTiming:Ym,getModifiedMatchUpFormatTiming:Km,getEventMatchUpFormatTiming:Xm,modifyEventMatchUpFormatTiming:Zm,removeEventMatchUpFormatTiming:Df,getMatchUpFormatTimingUpdate:function({tournamentRecord:e}){if(!e)return{error:Lo};const t=[],{extension:n}=xs({tournamentRecord:e,name:"scheduleTiming"});n&&t.push({method:"addTournamentExtension",params:{extension:n}});const i=e.events||[];for(const r of i){const{eventId:e}=r,{extension:n}=Os({event:r,name:"scheduleTiming"});n&&t.push({method:"addEventExtension",params:{eventId:e,extension:n}})}return{methods:t}},getMatchUpDailyLimits:wf,setMatchUpDailyLimits:$f,getMatchUpDailyLimitsUpdate:function({tournamentRecord:e}){if(!e)return{error:Lo};const t=[],{extension:n}=xs({tournamentRecord:e,name:"scheduleLimits"});n&&t.push({method:"addTournamentExtension",params:{extension:n}});const i=e.events||[];for(const r of i){const{eventId:e}=r,{extension:n}=Os({event:r,name:"scheduleLimits"});n&&t.push({method:"addEventExtension",params:{eventId:e,extension:n}})}return{methods:t}},validateSchedulingProfile:$l,setSchedulingProfile:function({tournamentRecord:e,schedulingProfile:t}){return e?Array.isArray(t)?cm({tournamentRecord:e,schedulingProfile:t}):{error:_o}:{error:Lo}},getSchedulingProfile:sm,removeMatchUpCourtAssignment:function({drawDefinition:e,matchUpId:t,courtDayDate:n}){return Ef({drawDefinition:e,matchUpId:t,courtDayDate:n})},clearScheduledMatchUps:If,bulkScheduleMatchUps:Ol,bulkRescheduleMatchUps:Vf};function Eg({tournamentRecord:e,categoryName:t,categoryType:n}){if(!e)return{error:Lo};const{appliedPolicies:i}=Ns({tournamentRecord:e}),r=null==i?void 0:i.draws;return((null==r?void 0:r.allowedDrawTypes)||[]).filter((({categoryNames:e,categoryTypes:i})=>!t&&!i||t&&(null==e?void 0:e.includes(t))||n&&(null==i?void 0:i.includes(n))))}function Ag({policyDefinitions:e,drawDefinition:t,drawSize:n,drawId:i,event:r,stage:o}){if(!r)return{error:Vo};const{entries:a,stageEntries:s}=mv({drawDefinition:t,drawId:i,stage:o,event:r}),c=s.length,{drawSize:u}=Qh({participantCount:c}),{seedsCount:d,error:l}=Xh({drawSize:n||u,policyDefinitions:e,participantCount:c});return l?{error:l}:{entries:a,seedsCount:d,stageEntries:s}}const Rg={attachPolicies:Wf,attachEventPolicies:qf,removeEventPolicy:function({event:e,policyType:t}){if(!t)return{error:$o};if(!e)return{error:Vo};let n;if(e.extensions){const{appliedPolicies:i}=Ms({event:e});i&&i[t]&&(delete i[t],n=!0,Object.keys(i).length?md({event:e,extension:{name:"appliedPolicies",value:i}}):hd({event:e,name:"appliedPolicies"}))}return n?ko:{error:"Policy not found"}},findPolicy:Es,getSeedsCount:Xh,getEntriesAndSeedsCount:Ag,getAllowedDrawTypes:Eg,getAllowedMatchUpFormats:function({tournamentRecord:e,categoryName:t,categoryType:n}){if(!e)return{error:Lo};const{appliedPolicies:i}=Ns({tournamentRecord:e}),r=null==i?void 0:i.scoring;return((null==r?void 0:r.matchUpFormats)||[]).filter((({categoryNames:e,categoryTypes:i})=>!t&&!i||t&&(null==e?void 0:e.includes(t))||n&&(null==i?void 0:i.includes(n))))},getEventAppliedPolicies:Ms};function Cg({event:e,participants:t,ignoreGender:n}){if(!t)return{error:"Missing participants"};if(!Array.isArray(t))return{error:_o};if(!e)return{error:Vo};const{eventType:i,gender:r}=e,o=i===Ls?dc:i===js?pc:Bs,a=Object.assign({},...(e.entries||[]).map((e=>({[e.participantId]:e.entryStatus})))),s=Object.keys(a),c=t.filter((e=>s.includes(e.participantId))).filter((e=>{const t=a[e.participantId],s=i===js&&e.participantType===dc&&(sv(t)||t===Md),c=e.participantType!==o&&!s,u=!n&&i===dc&&[gg,Ig].includes(r)&&e.sex!==r;return c||u}));return c.length?{error:"Invalid entries",invalidParticipantIds:c.map((e=>e.participantId))}:ko}function xg({element:e,participantId:t,stage:n,stageSequence:i}){const r=(e.entries||[]).filter((e=>e.entryStatus===yd)),o=(e.entries||[]).find((e=>e.participantId===t))||r.reduce(((e,t)=>{const{entryPosition:n}=t;return isNaN(n)?e:!e||n<e.entryPosition?t:e}),void 0);if(!o)return{error:"Participant Entry Not Found"};if(o.entryStatus!==yd)return{error:"Invalid entry status"};if(o.stage&&o.entryStage!==n)return{error:"Participant not entered in stage"};if(i&&o.stageSequence!==i)return{error:"Participant not found in stageSequence"};o.entryStatus=Sd;const a=null==o?void 0:o.entryPosition;isNaN(a)||e.entries.forEach((e=>{e.entryStatus===yd&&e.entryPosition>a&&(e.entryPosition=e.entryPosition-1)}));let s=Math.max(...e.entries.filter((e=>e.entryStatus===Sd&&!isNaN(e.entryPosition))).map((({entryPosition:e})=>parseInt(e||0))),0);return o.entryPosition=s||0,ko}const Og={STANDARD:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},COLLEGE_D3:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_D3",valueGoal:5},COLLEGE_DEFAULT:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:"SET1-S:6/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_DEFAULT",valueGoal:4},COLLEGE_JUCO:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_JUCO",valueGoal:5},LAVER_CUP:Zc,DOMINANT_DUO:Jc,TEAM_DOUBLES_3_AGGREGATION:Qc},kg=({namedFormat:e,uuids:t=[]}={})=>{var n,i;Object.keys(Og).includes(e)||(e="STANDARD"),Array.isArray(t)||(t=[]);const r=Og[e];if(!r.hydrate)return r.collectionDefinitions.forEach((e=>e.collectionId=es())),r;const o={winCriteria:{valueGoal:r.valueGoal},collectionDefinitions:[f({collectionId:(null===(n=t)||void 0===n?void 0:n.pop())||es(),collectionName:"Doubles",matchUpType:js,matchUpFormat:"SET3-S:6/TB7-F:TB10"},r.doubles),f({collectionId:(null===(i=t)||void 0===i?void 0:i.pop())||es(),collectionName:"Singles",matchUpType:Ls,matchUpFormat:"SET3-S:6/TB7"},r.singles)]};return r.tieFormatName&&(o.tieFormatName=r.tieFormatName),o};function Fg({tournamentRecord:e,event:t}){if(!e)return{error:Lo};e.events||(e.events=[]);const{startDate:n,endDate:i}=e,r=Object.assign({},{startDate:n,endDate:i,eventType:Js},t);t.eventType===Qs&&t.tieFormatName&&Xc[t.tieFormatName]&&(r.tieFormat=kg({namedFormat:t.tieFormatName})),r.eventId||(r.eventId=es());return e.events.reduce(((e,t)=>e||t.eventId===r.eventId),void 0)?{error:"Event exists"}:(e.events.push(r),h(f({},ko),{event:r}))}function Lg({applyPositioning:e=!0,candidatesCount:t=1,tournamentRecord:n,drawDefinition:i,structureId:r,seedsOnly:o,event:a}){if(!a)return{error:"Event not found"};if(!i)return{error:"drawDefinition not found"};if(!jp({drawDefinition:i,structureId:r}))return{error:"Incomplete source structure"};const{playoffStructures:s}=Lp({drawDefinition:i,structureId:r}),c=[],u=null==n?void 0:n.participants;if(s)for(const d of s){const{structureId:n}=d,r=vh({structureId:n,applyPositioning:e,candidatesCount:t,drawDefinition:i,participants:u,seedsOnly:o});if(r.error)return r;c.push({positionAssignments:r.positionAssignments,structureId:n})}return h(f({},ko),{structurePositionAssignments:c})}function jg({collectionPosition:e,teamParticipantId:t,dualMatchUpSide:n,drawDefinition:i,participantIds:r,collectionId:o}){var a;if(!o||!e||!Array.isArray(r))return{error:_o,modifiedLineUp:(null==n?void 0:n.lineUp)||[]};const s=(null==n?void 0:n.lineUp)||(null===(a=Ku({participantId:t,drawDefinition:i}))||void 0===a?void 0:a.lineUp);return{modifiedLineUp:(null==s?void 0:s.map((t=>{var n;if(!r.includes(t.participantId))return t;const i=null===(n=t.collectionAssignments)||void 0===n?void 0:n.filter((t=>!(t.collectionId===o&&t.collectionPosition===e)));return{participantId:t.participantId,collectionAssignments:i}})).filter(Boolean))||[]}}function Bg({lineUp:e,tieFormat:t}){var n;let i=[];if(!Array.isArray(e))return i.push("lineUp must be an array of objects"),{valid:!1,errors:i,error:_o};const r=(null==t||null===(n=t.collectionDefinitions)||void 0===n?void 0:n.map((({collectionId:e})=>e)))||[],o=e.every((e=>{if("object"!=typeof e)return i.push("lineUp entries must be objects"),!1;const{participantId:t,collectionAssignments:n}=e;return t?"string"!=typeof t?(i.push("participantIds must be strings"),!1):Array.isArray(n)?n.every((e=>{if("object"!=typeof e)return i.push("collectionAssignments must be objects"),!1;const{collectionPosition:t,collectionId:n}=e;return"number"!=typeof t?(i.push("collectionPosition must be a number"),!1):!!r.includes(n)||(i.push("Invalid collectionId"),!1)})):(i.push("collectionAssignments must be an array"),!1):(i.push("Missing participantId"),!1)})),a=bo(e.map(Qu)).length===e.length;return a||i.push("Duplicated participantId(s)"),{valid:o&&a,errors:i,error:i.length?_o:void 0}}function Vg({drawDefinition:e,participantId:t,tieFormat:n,lineUp:i}){if("object"!=typeof e)return{error:jo};if("string"!=typeof t)return{error:"Missing participantId"};const r=Bg({lineUp:i,tieFormat:n});if(!r.valid)return r;const{extension:o}=Cs({element:e,name:"lineUps"}),a=(null==o?void 0:o.value)||{},s=i.map(Qu);return Object.keys(a).filter((e=>e!==t)).find((e=>{const n=a[e],r=Ro(n.map(Qu),s);return r.length&&console.log({overlap:r,submittedParticipantId:t,submittedLineUp:i,storedParticipantId:e,storedLineUp:n}),r.length}))?{error:"lineUp conflict"}:(a[t]=i,ud({element:e,extension:{name:"lineUps",value:a}}),qu({drawDefinition:e}),f({},ko))}function $g({tournamentRecord:e,drawDefinition:t,tieMatchUpId:n,event:i}){if(!e)return{error:Lo};if(!t)return{error:"Missing drawId"};if(!i)return{error:"Event not found"};const r=id({drawDefinition:t}),{matchUp:o,structure:a}=el({tournamentParticipants:e.participants,matchUpId:n,inContext:!0,drawDefinition:t,matchUpsMap:r,event:i});if(!o)return{error:"matchUp not found"};const{collectionPosition:s,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:l}=o;if(![Ls,js].includes(l))return{error:"Invalid matchUp"};const{positionAssignments:p}=Hd({structure:a}),m=null==p?void 0:p.filter((e=>null==c?void 0:c.includes(e.drawPosition))),h=Zu(m),{tournamentParticipants:v}=jm({tournamentRecord:e,participantFilters:{participantTypes:[lc],participantIds:h}}),{matchUp:g}=el({matchUpId:d,drawDefinition:t,matchUpsMap:r});return f({relevantAssignments:m,collectionPosition:s,teamParticipants:v,collectionId:u,matchUpType:l,dualMatchUp:g,tieMatchUp:o,tieFormat:g.tieFormat||a.tieFormat||t.tieFormat||i.tieFormat||void 0,structure:a},ko)}function Gg({collectionPosition:e,teamParticipantId:t,drawDefinition:n,modifiedLineUp:i,participantId:r,collectionId:o,tieFormat:a}){var s,c;const u=null===(s=Ku({participantId:t,drawDefinition:n}))||void 0===s?void 0:s.lineUp,d=null===(c=i||u)||void 0===c?void 0:c.find((e=>(null==e?void 0:e.participantId)===r)),l={collectionId:o,collectionPosition:e};if(d)d.collectionAssignments.push(l);else{const e={collectionAssignments:[l],participantId:r};i.push(e)}t&&Vg({participantId:t,lineUp:i,drawDefinition:n,tieFormat:a})}function _g({drawDefinition:e,participantIds:t}){if("object"!=typeof e)return{error:jo};if(!Array.isArray(t))return{error:"Invalid participantIds"};const{extension:n}=Cs({element:e,name:"lineUps"}),i=(null==n?void 0:n.value)||{},r=Object.keys(i).find((e=>i[e].map(Qu).some((e=>t.includes(e)))));return{lineUp:i[r],teamParticipantId:r}}function Wg({tournamentRecord:e,drawIds:t=[],auditData:n,eventId:i}){var r;if(!e)return{error:Lo};const o=Array.isArray(t)&&t[0],{event:a,error:s}=_s({tournamentRecord:e,eventId:i,drawId:o});if(s)return{error:s};const c=[],u=[],d=[];if(!a.drawDefinitions)return{error:"drawDefinition not found"};const l=a.drawDefinitions.map((({drawId:e})=>e));t.length||(t=l);if(!(t.length&&t.every((e=>l.includes(e)))))return{error:"drawDefinition not found"};a.drawDefinitions=a.drawDefinitions.filter((e=>{if(t.includes(e.drawId)){const t={action:"deleteDrawDefinitions",payload:{drawDefinitions:[e],eventId:a.eventId,auditData:n}};c.push(t);const{drawId:i,drawType:r,drawName:o}=e;d.push({auditData:n,drawId:i,drawType:r,drawName:o,eventId:a.eventId});const{matchUps:s}=Tl({event:a,drawDefinition:e});s.forEach((({matchUpId:e})=>u.push(e)))}return!t.includes(e.drawId)})),cm({tournamentRecord:e});const{timeItem:p}=ku({element:a,itemType:"PUBLISH.STATUS"}),m=null==p||null===(r=p.itemValue)||void 0===r?void 0:r.PUBLIC;for(const v of t){var f;if(null==m||null===(f=m.drawIds)||void 0===f?void 0:f.includes(v)){var h;const e=(null===(h=m.drawIds)||void 0===h?void 0:h.filter((e=>e!==v)))||[],t=Vu({event:a,timeItem:{itemType:"PUBLISH.STATUS",itemValue:{PUBLIC:{drawIds:e}}}});if(t.error)return{error:t.error}}}if(c.length){la({topic:"audit",payload:c});const e=Vu({event:a,timeItem:{itemType:"deleteDrawDefinitions",itemValue:d}});if(e.error)return e}return u.length&&_u({matchUpIds:u}),function({drawId:e}){la({topic:"deletedDrawIds",payload:{drawId:e}})}({drawId:o}),ko}function qg({sortDescending:e=!1,tournamentRecord:t,scaleAttributes:n,scaleSortMethod:i,entries:r,event:o,stage:a}){return t?{scaledEntries:(r=r||(null==o?void 0:o.entries)||[]).filter((e=>(!a||!e.entryStage||e.entryStage===a)&&Cd.includes(e.entryStatus))).map((e=>{const{participantId:i}=e,{scaleItem:r}=cg({tournamentRecord:t,scaleAttributes:n,participantId:i});return f(f({},e),r)})).filter((e=>{const t=e.scaleValue;return!!(i||!isNaN(t)&&parseFloat(t))&&t})).sort(i||function(t,n){return e?s(n)-s(t):s(t)-s(n)})}:{error:Lo};function s(t){return parseFloat(t.scaleValue||(e?-1:1e5))}}function zg(e){const{drawType:t=lu,enforcePolicyLimits:n=!0,finishingPositionNaming:i,ignoreAllowedDrawTypes:r,seedAssignmentProfile:o,playoffMatchUpFormat:a,seedByRanking:s=!0,qualifyingProfiles:c,seededParticipants:u,policyDefinitions:d,seedingScaleName:l,assignSeedsCount:p,automated:m=!0,seedingProfile:v,tieFormatName:g,drawEntries:I,feedPolicy:y,idPrefix:w,drawId:U,isMock:b,uuids:S}=e,{tournamentRecord:P,event:D}=e;let{drawName:N,matchUpType:M,structureOptions:T}=e;const{tournamentParticipants:E}=jm({tournamentRecord:P,inContext:!0}),A=D&&E&&Cg({event:D,participants:E});if(null!=A&&A.error)return A;const R=!r&&P&&Eg({tournamentRecord:P,categoryType:null==D?void 0:D.categoryType,categoryName:null==D?void 0:D.categoryName});if(null!=R&&R.length&&!R.includes(t))return{error:"Invalid drawType"};let{seedsCount:C,drawSize:x=32,tieFormat:O,matchUpFormat:k}=e;"number"!=typeof x&&(x=parseInt(x)),"number"!=typeof C&&(C=parseInt(C||0));const F=null==D?void 0:D.eventType;M=M||F,M===Bs&&F===Bs?(O=O||null!=D&&D.tieFormat||g?"object"==typeof O?O:g?kg({namedFormat:g}):"object"==typeof(null==D?void 0:D.tieFormat)&&D.tieFormat:kg(),k=void 0):k||(O=void 0,k="SET3-S:6/TB7");const L=I||(null==D?void 0:D.entries)||[],j=L.filter((e=>(!e.entryStage||e.entryStage===eu)&&Cd.includes(e.entryStatus)));[Iu].includes(t)&&(x=j.length||x);const B=Qv({drawType:t,drawId:U});if((k||O)&&!(k&&(null==D?void 0:D.matchUpFormat)===k||(null==D?void 0:D.tieFormat)&&O&&JSON.stringify(D.tieFormat)===JSON.stringify(O))){let e=im({drawDefinition:B,matchUpFormat:k,tieFormat:O,event:D});if(e.error)return{error:e.error,message:"matchUpFormat or tieFormat error"};M&&(B.matchUpType=M),O&&(B.tieFormat=O),e.tieFormat&&(O=e.tieFormat)}O=O||(null==D?void 0:D.tieFormat);let V=Yh({finishingPositionNaming:i,goesTo:e.goesTo,playoffMatchUpFormat:a,qualifyingProfiles:c,structureOptions:T,drawDefinition:B,seedingProfile:v,matchUpFormat:k,matchUpType:M,feedPolicy:y,tieFormat:O,drawSize:x,drawType:t,idPrefix:w,isMock:b,uuids:S});if(V.error)return V;const{matchUpsMap:$,inContextDrawMatchUps:G}=V,{structures:_}=sd({drawDefinition:B,stageSequence:1,stage:eu}),[W]=_,{structureId:q}=W||{};if("object"==typeof d)for(const f of Object.keys(d))jv({policyDefinitions:{[f]:d[f]},drawDefinition:B});const{policyDefinitions:z}=vp({policyTypes:["seeding"],tournamentRecord:P,drawDefinition:B,event:D})||{};null!=d&&d.seeding||null!=z&&z.seeding||jv({drawDefinition:B,policyDefinitions:Du});const{policyDefinitions:H}=vp({policyTypes:["avoidance"],tournamentRecord:P,drawDefinition:B,event:D})||{};null!=d&&d.avoidance||null==H||!H.avoidance||jv({drawDefinition:B,policyDefinitions:H});for(const X of L){const e=vv(h(f({},X),{entryStage:X.entryStage||eu,drawDefinition:B}));if(I&&e.error)return e}const K=L.map(Qu);u&&(C=u.length),C>x&&(C=x),C>j.length&&(C=j.length);const{seedLimit:Y}=ev({participantCount:j.length,enforcePolicyLimits:n,tournamentRecord:P,drawDefinition:B,structureId:q,seedsCount:C,event:D});if(Y&&Y<C&&(C=Y),t===mu&&(C=0),u)u.filter((({participantId:e})=>K.includes(e))).filter((e=>!e.seedNumber||e.seedNumber<=u.length)).sort(((e,t)=>e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0)).forEach((e=>{const{participantId:t,seedNumber:n,seedValue:i}=e;Hv({drawDefinition:B,participantId:t,structureId:q,seedNumber:n,seedValue:i})}));else if(null!=D&&D.category||l){var J,Z;const{categoryName:e,ageCategoryCode:t}=(null==D?void 0:D.category)||{},n={scaleType:"SEEDING",scaleName:l||e||t,eventType:F};let{scaledEntries:i}=qg({scaleAttributes:n,tournamentRecord:P,stage:eu,entries:L});if((null===(J=i)||void 0===J||!J.length)&&s){const n={scaleType:Om,scaleName:e||t,eventType:F};({scaledEntries:i}=qg({scaleAttributes:n,tournamentRecord:P,stage:eu,entries:L}))}const r=(null===(Z=i)||void 0===Z?void 0:Z.length)||0;r<C&&(C=r),i&&i.filter((({participantId:e})=>K.includes(e))).slice(0,p||C).forEach(((e,t)=>{const n=t+1,i=(null==o?void 0:o[n])||n,{participantId:r}=e;Hv({drawDefinition:B,participantId:r,structureId:q,seedNumber:n,seedValue:i})}))}let Q=[];if(!1!==m){const e="object"==typeof m&&m.seedsOnly;({conflicts:Q}=vh({inContextDrawMatchUps:G,drawDefinition:B,participants:E,structureId:q,matchUpsMap:$,seedsOnly:e,drawType:t,event:D}))}return N=N||t,B&&Object.assign(B,{drawName:N}),la({topic:"audit",payload:{action:"generateDrawDefinition",payload:{drawId:B.drawId,category:null==D?void 0:D.category,eventId:null==D?void 0:D.eventId,seedingScaleName:l,matchUpType:M,seedsCount:C,automated:m,tieFormat:O,drawSize:x,drawType:t,drawName:N}}}),h(f({},ko),{structureId:q,drawDefinition:B,conflicts:Q})}function Hg({tournamentRecord:e,drawDefinition:t,participantId:n,entryPosition:i,event:r}){return e?n?void 0===i||Number.isSafeInteger(i)?(((null==r?void 0:r.entries)||[]).forEach((e=>{e.participantId===n&&(e.entryPosition=i)})),((null==t?void 0:t.entries)||[]).forEach((e=>{e.participantId===n&&(e.entryPosition=i)})),ko):{error:_o,entryPosition:i}:{error:"Missing participantId"}:{error:Lo}}function Kg({playoffStructureNameBase:e,playoffAttributes:t,playoffPositions:n,exitProfileLimit:i,tournamentRecord:r,drawDefinition:o,roundProfiles:a,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l}){if(!r)return{error:Lo};const p=Gh({playoffStructureNameBase:e,playoffAttributes:t,playoffPositions:n,exitProfileLimit:i,drawDefinition:o,roundProfiles:a,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l});return p.error||Bu({tournamentRecord:r,timeItem:{itemType:"addPlayoffStructures",itemValue:{playoffStructureNameBase:e,playoffPositions:n,roundNumbers:s,structureId:c}}}),p}function Yg({scaleAttributes:e,scaledEntries:t,stageEntries:n,seedsCount:i,scaleName:r}){if(!e)return{error:$o};const o=Object.assign({},...(t||[]).slice(0,i).map((({participantId:e},t)=>({[e]:t+1}))));r=r||e.scaleName;const a=(new Date).toISOString();return{scaleItemsWithParticipantIds:n.map((({participantId:t})=>({participantId:t,scaleItems:[{scaleValue:o[t],eventType:e.eventType,scaleType:"SEEDING",scaleName:r,scaleDate:a}]})))}}function Jg({tournamentRecord:e,drawDefinition:t,scaleAttributes:n,drawId:i,event:r,stage:o}){if(!r)return{error:Vo};let a=r.entries;if(i){var s;const{flightProfile:e}=yp({event:r}),n=null==e||null===(s=e.flights)||void 0===s?void 0:s.find((e=>e.drawId===i));a=n?n.drawEntries:null==t?void 0:t.entries}return function({tournamentRecord:e,participantIds:t,scaleAttributes:n}){var i;if(!e)return{error:Lo};if(!t)return{error:"Missing participantIds"};if(!n)return{error:$o,message:"scaleAttributes required"};const{scaleType:r,eventType:o,scaleName:a}=n,s=[Is,r,o,a].join(".");return null===(i=e.participants)||void 0===i||i.forEach((e=>{t.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter((e=>e&&(null==e?void 0:e.itemType)!==s)))})),ko}({tournamentRecord:e,participantIds:(a||[]).filter((e=>(!o||!e.entryStage||e.entryStage===o)&&Cd.includes(e.entryStatus))).map(Qu),scaleAttributes:n})}function Zg({deleteExisting:e,event:t,flightProfile:n}){var i;if(!n)return{error:$o};if(!t)return{error:Vo};const{flightProfile:r}=yp({event:t});return r&&Zg&&!e?{error:"Existing profile"}:null!==(i=t.drawDefinitions)&&void 0!==i&&i.length?{error:"Existing drawDefinition(s)"}:(md({event:t,extension:{name:"flightProfile",value:n}}),f({flightProfile:Ja(n,!1,!0)},ko))}function Qg(e){var t;const n=null===(t=e.tournamentRecord)||void 0===t?void 0:t.participants;return Object.assign(e,{tournamentParticipants:n}),Cv(e)}function Xg({qualifyingPositions:e,drawEntries:t=[],matchUpValue:n,drawName:i,drawId:r,event:o,stage:a}){var s,c;if(!o)return{error:Vo};if(!i)return{error:$o};if(null!=t&&t.length){const e=Zu(o.entries||[]),n=Zu(t);if(Ro(n,e).length!==n.length)return{error:_o}}const{flightProfile:u}=yp({event:o}),d=(null==u||null===(s=u.flights)||void 0===s||null===(c=s.map((({flightNumber:e})=>!isNaN(e)&&parseInt(e))))||void 0===c?void 0:c.filter(Boolean))||[],l=Math.max(0,...d)+1,p={drawId:r||es(),flightNumber:l,matchUpValue:n,drawEntries:t,drawName:i};a&&(p.stage=a),e&&(p.qualifyingPositions=e);return((null==u?void 0:u.flights)||[]).find((({drawId:e})=>e===p.drawId))?{error:"Existing flight"}:md({event:o,extension:{name:"flightProfile",value:h(f({},u||{}),{flights:((null==u?void 0:u.flights)||[]).concat(p)})}})}function eI({tournamentRecord:e,event:t,startDate:n}){if(!e)return{error:Lo};if(!t)return{error:Vo};if(!Da.test(n))return{error:Go};const{tournamentStartDate:i,tournamentEndDate:r,error:o}=nI(e);if(o)return{error:o};const a=new Date(Va(n));if(a<i||a>r)return{error:Go};const s=t.endDate&&new Date(Va(t.endDate));return s&&a>s&&(t.endDate=n),t.startDate=n,ko}function tI({tournamentRecord:e,event:t,endDate:n}){if(!e)return{error:Lo};if(!t)return{error:Vo};if(!Da.test(n))return{error:Go};const{tournamentStartDate:i,tournamentEndDate:r,error:o}=nI(e);if(o)return{error:o};const a=new Date(Va(n));if(a<i||a>r)return{error:Go};const s=t.startDate&&new Date(Va(t.startDate));return s&&a<s&&(t.startDate=n),t.endDate=n,ko}function nI(e){const{startDate:t,endDate:n}=e;return Da.test(t)&&Da.test(n)?{tournamentStartDate:new Date(Va(t)),tournamentEndDate:new Date(Va(n))}:{error:"Invalid tournament dates"}}const iI={addEvent:Fg,deleteEvents:function({tournamentRecord:e,eventIds:t}){if(!e)return{error:Lo};if(!e.events)return{error:"Event not found"};if(!Array.isArray(t))return{error:$o};const n=[],i=[];return e.events=(e.events||[]).filter((e=>{if(t.includes(e.eventId)){const t={action:"deleteEvents",payload:{events:[e]}};n.push(t),i.push({eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}return!t.includes(e.eventId)})),cm({tournamentRecord:e}),n.length&&(la({topic:"audit",payload:n}),Bu({tournamentRecord:e,timeItem:{itemType:"deleteEvents",itemValue:i}})),ko},setEventDates:function({tournamentRecord:e,event:t,startDate:n,endDate:i}){if(!e)return{error:Lo};if(!t)return{error:Vo};if(!n&&!i)return{error:$o};if(n&&!Da.test(n))return{error:Go};if(i&&!Da.test(i))return{error:Go};if(n&&i&&new Date(Va(n))>new Date(Va(i)))return{error:_o};if(n){const{error:i}=eI({tournamentRecord:e,event:t,startDate:n});if(i)return{error:i}}if(i){const{error:n}=tI({tournamentRecord:e,event:t,endDate:i});if(n)return{error:n}}return ko},setEventStartDate:eI,setEventEndDate:tI,autoSeeding:function({tournamentRecord:e,drawDefinition:t,policyDefinitions:n,scaleAttributes:i,scaleName:r,drawSize:o,drawId:a,event:s,stage:c,sortDescending:u,scaleSortMethod:d}){const{error:l,entries:p,seedsCount:m,stageEntries:f}=Ag({drawDefinition:t,drawId:a,event:s,policyDefinitions:n,drawSize:o,stage:c});if(l)return{error:l};const{scaledEntries:h}=qg({scaleAttributes:i,tournamentRecord:e,scaleSortMethod:d,sortDescending:u,entries:p,stage:c}),{scaleItemsWithParticipantIds:v}=Yg({scaledEntries:h,seedsCount:m,scaleAttributes:i,scaleName:r,stageEntries:f});return{scaleItemsWithParticipantIds:v}},removeSeeding:function({tournamentRecord:e,drawDefinition:t,scaleName:n,drawId:i,event:r,stage:o}){var a,s;return e?r?(n=n||(null===(a=r.category)||void 0===a?void 0:a.categoryName)||(null===(s=r.category)||void 0===s?void 0:s.ageCategoryCode),Jg({tournamentRecord:e,scaleAttributes:{eventType:r.eventType,scaleType:"SEEDING",scaleName:n},drawDefinition:t,drawId:i,event:r,stage:o})):{error:Vo}:{error:Lo}},removeScaleValues:Jg,addDrawEntries:Iv,checkValidEntries:Cg,modifyDrawName:Dh,addDrawDefinition:wm,addPlayoffStructures:Kg,deleteDrawDefinitions:Wg,getAvailablePlayoffRounds:function({drawDefinition:e,structureId:t}){return Oh({drawDefinition:e,structureId:t})},removeStructure:Jh,generateSeedingScaleItems:Yg,setSubOrder:Dv,addEventEntries:wv,promoteAlternate:function({tournamentRecord:e,drawDefinition:t,event:n,participantId:i,stage:r=eu,stageSequence:o}){if(!e)return{error:Lo};if(!n)return{error:Vo};if(n){const e=xg({element:n,participantId:i,stageSequence:o,stage:r});if(e.error)return e}if(t){const e=xg({element:t,participantId:i,stageSequence:o,stage:r});if(e.error)return e}return ko},destroyPairEntry:Uv,setEntryPosition:Hg,setEntryPositions:function({tournamentRecord:e,entryPositions:t,drawDefinition:n,event:i}){if(!e)return{error:Lo};if(!Array.isArray(t))return{error:_o};for(const r of t){const{participantId:t,entryPosition:o}=r,a=Hg({tournamentRecord:e,drawDefinition:n,participantId:t,entryPosition:o,event:i});if(a.error)return a}return f({},ko)},addEventEntryPairs:function({allowDuplicateParticipantIdPairs:e,entryStatus:t=yd,participantIdPairs:n=[],entryStage:i=eu,tournamentRecord:r,drawDefinition:o,event:a,uuids:s}){if(!r)return{error:Lo};if(!a)return{error:Vo};if(a.eventType!==js)return{error:"Invalie eventType"};const c=r.participants||[],u=c.filter((e=>e.participantType===dc)).map((e=>e.participantId)),d=u.filter((e=>!u.includes(e)));if(d.length)return{error:"Invalid participantIds",invalidParticipantIds:d};const l=n.filter((e=>2!==e.length));if(l.length)return{error:"Invalid participantIds",invalidParticipantIdPairs:l};const p=c.filter((e=>e.participantType===pc)).map((e=>e.individualParticipantIds)),m=n.map((e=>({participantId:(null==s?void 0:s.pop())||es(),participantType:pc,participantRole:Af,individualParticipantIds:e}))),v=e?m:m.filter((e=>!p.find((t=>2===Ro(t,e.individualParticipantIds).length))));let g,I=[];if(v){const t=Sm({allowDuplicateParticipantIdPairs:e,participants:v,returnParticipants:!0,tournamentRecord:r});if(t.error)return t;I=t.participants||[],g=t.message}const y=n.map((e=>{const t=I.find((t=>2===Ro(t.individualParticipantIds,e).length));if(t)return t;const{participant:n}=Hu({tournamentRecord:r,participantIds:e});return n})).map((e=>e.participantId)),w=wv({event:a,entryStage:i,entryStatus:t,drawDefinition:o,tournamentRecord:r,participantIds:y});return v.length&&la({topic:"addParticipants",participants:v}),h(f({},w),{message:g,newParticipantIds:v.map(Qu)})},removeEventEntries:fv,removeDrawEntries:function({participantIds:e,drawDefinition:t,drawId:n,event:i,autoEntryPositions:r=!0}){var o;if(!i)return{error:Vo};if(!n)return{error:"Missing drawId"};if(!e||!e.length)return{error:"Missing participantIds"};const a=ov({drawDefinition:t});if(Co(e,a))return{error:"Existing participant drawPosition assignment"};const s=t=>{const n=t.participantId;return!e.includes(n)},{flightProfile:c}=yp({event:i}),u=null==c||null===(o=c.flights)||void 0===o?void 0:o.find((e=>e.drawId===n));return null!=u&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),r&&(u.drawEntries=av({entries:u.drawEntries}))),null!=t&&t.entries&&(t.entries=t.entries.filter(s),r&&(t.entries=av({entries:t.entries}))),ko},modifyEventEntries:function({event:e,tournamentRecord:t,entryStage:n=eu,participantIdPairs:i=[],unpairedParticipantIds:r=[],entryStatus:o=Sd}){if(!t)return{error:Lo};if(!e)return{error:Vo};const a=t.participants||[],s=a.filter((e=>e.participantType===dc)).map((e=>e.participantId)),c=r.concat(...i).flat(1/0).filter((e=>!s.includes(e)));if(c.length)return{error:"Invalid participantIds",invalidParticipantIds:c};const u=i.filter((e=>2!==e.length));if(u.length)return{error:"Invalid participantIds",invalidParticipantIdPairs:u};const d=a.filter((e=>e.participantType===pc)).map((e=>e.individualParticipantIds)),l=i.filter((e=>!d.find((t=>2===Ro(t,e).length)))).map((e=>({participantType:pc,participantRole:Af,individualParticipantIds:e}))),p=Sm({tournamentRecord:t,participants:l});if(p.error)return p;const m=i.map((e=>{const{participant:n}=Hu({tournamentRecord:t,participantIds:e});return n})).map((e=>({participantId:e,entryStatus:o,entryStage:n}))),f=r.map((e=>({entryStatus:Ed,participantId:e,entryStage:n})));return e.entries=(e.entries||[]).filter((e=>e.entryStage===n)),e.entries=e.entries.concat(...m,...f),ko},modifyEntriesStatus:cv,modifySeedAssignment:function({tournamentRecord:e,drawDefinition:t,participantId:n,structureId:i,seedValue:r}){return e?(e.participants||[]).find((e=>e.participantId===n))?zv({drawDefinition:t,participantId:n,structureId:i,seedValue:r}):{error:"Invalid participantId"}:{error:Lo}},deleteFlightProfileAndFlightDraws:function({tournamentRecord:e,event:t}){if(!e)return{error:Lo};if(!t)return{error:Vo};const{flightProfile:n}=yp({event:t});if(n){var i;const r=null===(i=n.flights)||void 0===i?void 0:i.map((({drawId:e})=>e)).filter(Boolean),o=Wg({tournamentRecord:e,eventId:t.eventId,drawIds:r});return o.error?o:hd({event:t,name:"flightProfile"})}return ko},deleteFlightAndFlightDraw:function({tournamentRecord:e,event:t,drawId:n,auditData:i}){if(!e)return{error:Lo};if(!n)return{error:"Missing drawId"};if(!t)return{error:Vo};const{flightProfile:r}=yp({event:t});var o;if(r&&(null===(o=r.flights)||void 0===o?void 0:o.find((e=>e.drawId===n)))){const e=r.flights.filter((e=>e.drawId!==n));md({event:t,extension:{name:"flightProfile",value:h(f({},r),{flights:e})}})}return Wg({tournamentRecord:e,eventId:t.eventId,drawIds:[n],auditData:i}),ko},generateFlightProfile:function({drawNameRoot:e="Flight",attachFlightProfile:t,tournamentRecord:n,scaleAttributes:i,scaleSortMethod:r,deleteExisting:o,sortDescending:a,drawNames:s=[],flightsCount:c,flightValues:u,splitMethod:d,uuids:l=[],event:p,stage:m}){if(!p)return{error:Vo};const h=p.entries||[],{flightProfile:v}=yp({event:p});if(v&&t&&!o)return{error:"Existing profile"};const{scaledEntries:g}=qg({tournamentRecord:n,scaleAttributes:i,scaleSortMethod:r,sortDescending:a,event:p,stage:m}),I=g.map(Qu),y=h.filter((({participantId:e})=>!I.includes(e))).filter((e=>(!m||!e.entryStage||e.entryStage===m)&&Cd.includes(e.entryStatus))),w=g.concat(...y),U=w.length;let b=xo(w,Math.ceil(U/c));"splitWaterfall"===d?b=Oo(w,c):"splitShuttle"===d&&(b=Oo(w,c,!0));const S={scaleAttributes:i,splitMethod:d,flights:Eo(0,c).map((t=>{var n;const i=t+1,r={flightNumber:i,drawId:(null==l?void 0:l.pop())||es(),drawEntries:(o=b[t],(o||[]).map((({participantId:e})=>h.find((t=>t.participantId===e))))),drawName:(null==s?void 0:s.length)&&s[t]||`${e} ${i}`};var o;const a=null==u||null===(n=u.find((e=>e.flightNumber===i)))||void 0===n?void 0:n.matchUpValue;return a&&(r.matchUpValue=a),r}))};if(t){const e=Zg({flightProfile:S,deleteExisting:o,event:p});return f({splitEntries:sa()&&b||void 0},e)}return f({flightProfile:S},ko)},attachFlightProfile:Zg,updateDrawIdsOrder:function({event:e,orderedDrawIdsMap:t}){var n,i;if("object"!=typeof e)return{error:Vo};if(!t)return{error:$o,message:"Missing drawIdsOrderMap"};if("object"!=typeof t)return{error:_o,message:"orderedDrawIdsMap must be an object"};const r=Object.values(t);if(!r.every((e=>!isNaN(e))))return{error:_o,message:"drawOrder must be numeric"};if(bo(r).length!==r.length)return{error:_o,message:"drawOrder values must be unique"};if(null!==(n=e.drawDefinitions)&&void 0!==n&&n.length){const n=(e.drawDefinitions||[]).map((({drawId:e})=>e));if(Ro(n,Object.keys(t)).length!==n.length)return{error:_o,message:"Missing drawIds"};e.drawDefinitions.forEach((e=>{e.drawOrder=t[e.drawId]}))}const{flightProfile:o}=yp({event:e});return null==o||null===(i=o.flights)||void 0===i||i.forEach((e=>{e.flightNumber=t[e.drawId]})),ko},getFlightProfile:yp,getScaledEntries:qg,addFlight:Xg,generateAdHocMatchUps:function(e){return Ph(e)},deleteAdHocMatchUps:function(e){return _h(e)},drawMatic:Qg,setOrderOfFinish:function(e){return Fv(e)},setDelegatedOutcome:function(e){return Ov(e)},removeDelegatedOutcome:function(e){return Mv(e)},addVoluntaryConsolationStage:function({drawDefinition:e,drawSize:t}){return Th({drawDefinition:e,drawSize:t})},generateVoluntaryConsolationStructure:function(e){const{tournamentRecord:t}=e;return t?bh(f({participants:t.participants},e)):{error:Lo}},setMatchUpStatus:om,bulkMatchUpStatusUpdate:am,setDrawDefaultMatchUpFormat:function({tournamentRecord:e,drawDefinition:t,matchUpFormat:n}){return e?t?n?im({drawDefinition:t,matchUpFormat:n}):{error:"Missing matchUpFormat"}:{error:jo}:{error:Lo}},setEventDefaultMatchUpFormat:function({tournamentRecord:e,event:t,matchUpFormat:n}){return e?n?t?$r(n)?(t.matchUpFormat=n,ko):{error:"Unrecognized matchUpFormat"}:{error:Vo}:{error:"Missing matchUpFormat"}:{error:Lo}},setStructureDefaultMatchUpFormat:function({tournamentRecord:e,drawDefinition:t,matchUpFormat:n,structureId:i,event:r}){return e?t?n?i?im({drawDefinition:t,matchUpFormat:n,structureId:i,event:r}):{error:"Missing structureId"}:{error:"Missing matchUpFormat"}:{error:jo}:{error:Lo}},setCollectionDefaultMatchUpFormat:function({tournamentRecord:e,drawDefinition:t,matchUpFormat:n}){return e?t?n?$r(n)?{error:"Not implemented"}:{error:"Unrecognized matchUpFormat"}:{error:"Missing matchUpFormat"}:{error:jo}:{error:Lo}},assignDrawPosition:function({drawDefinition:e,drawPosition:t,structureId:n,participantId:i,qualifier:r,bye:o}){if(!e)return{error:jo};if(!t)return{error:"Missing drawPosition"};if(!n)return{error:"Missing structureId"};if(o){const i=Mp({drawDefinition:e,drawPosition:t,structureId:n});if(i.error)return i}else{if(r)return{error:"Not implemented"};{const r=Yp({drawDefinition:e,structureId:n,drawPosition:t,participantId:i});if(r.error)return r}}return f({},ko)},assignSeedPositions:function(e){const{useExistingSeedLimit:t,tournamentRecord:n,drawDefinition:i,structureId:r,assignments:o,drawId:a}=e;let s=0;if(null==o||!o.length)return{error:"Missing assignments"};if(!n)return{error:Lo};if(!a)return{error:"Missing drawId"};const{seedAssignments:c,seedLimit:u,error:d}=Wd({drawDefinition:i,structureId:r});if(d)return{error:d};const l=Object.assign({},...c.filter((e=>e.seedNumber)).map((e=>({[e.seedNumber]:e}))));o.forEach((e=>{const{seedNumber:n}=e;n<=u&&(!t||l[n])&&(l[n]=e)}));const p=Object.values(l),m=p.map((e=>null==e?void 0:e.participantId)).filter(Boolean);if(m.length!==No(m).length)return{error:"participantId cannot be assigned to multiple seedNumbers"};for(const v of p){const e=Hv(h(f({},v),{drawDefinition:i,structureId:r}));if(null!=e&&e.error)return e;null!=e&&e.success&&s++}return s?h(f({},ko),{modifications:s}):{error:"No modifications applied"}},assignDrawPositionBye:function({drawDefinition:e,structureId:t,drawPosition:n}){return Mp({drawDefinition:e,structureId:t,drawPosition:n})},assignMatchUpSideParticipant:function({drawDefinition:e,participantId:t,sideNumber:n,matchUpId:i,event:r}){var o;if(t&&"string"!=typeof t)return{error:"Invalid participantId"};if(!e)return{error:jo};if(!n)return{error:"Missing sideNumber"};if(!i)return{error:"Missing matchUpId"};if(![1,2].includes(n))return{error:_o,sideNumber:n};const{matchUp:a,structure:s}=el({drawDefinition:e,matchUpId:i,event:r});return null!=s&&s.structures||e.drawType&&e.drawType!==uu||null!=s&&s.matchUps.find((({roundPosition:e})=>!!e))?{error:"Invalid drawType"}:!t&&(null!==(o=a.score)&&void 0!==o&&o.scoreStringSide1||ao.includes(a.matchUpstatus)||a.matchUpStatus===Yr)?{error:"Cannot remove participants",message:"matchUp has completed status or score"}:(a.sides=[1,2].map((e=>{var i;const r=(null===(i=a.sides)||void 0===i?void 0:i.find((t=>t.sideNumber===e)))||{sideNumber:e};return n===e?h(f({},r),{participantId:t}):r})),Gu({drawDefinition:e,matchUps:[a]}),f({},ko))},swapDrawPositionAssignments:function(e){return Sv(e)},removeDrawPositionAssignment:bv,alternateDrawPositionAssignment:function(e){return iv(e)},withdrawParticipantAtDrawPosition:function(e){return Object.assign(e,{entryStatus:Md}),bv(e)},setDrawParticipantRepresentativeIds:function({representativeParticipantIds:e,drawDefinition:t}){if(!t)return{error:"drawDefinition not found"};if(!Array.isArray(e))return{error:_o};const n=Zu((null==t?void 0:t.entries)||[]);return e.length&&Ro(e,n).length<e.length?{error:_o}:pd({drawDefinition:t,extension:{name:"participantRepresentatives",value:e}})},getDrawParticipantRepresentativeIds:function({drawDefinition:e}){const{extension:t,error:n}=ks({drawDefinition:e,name:"participantRepresentatives"});return n?{error:n}:{representativeParticipantIds:(null==t?void 0:t.value)||[]}},luckyLoserDrawPositionAssignment:function(e){return function({luckyLoserParticipantId:e,drawDefinition:t,drawPosition:n,structureId:i}){return nv({participantId:e,drawDefinition:t,drawPosition:n,structureId:i,positionActionName:"luckyLoserDrawPositionAssignment"})}(e)},setPositionAssignments:function(e){return rv(e)},automatedPositioning:function({applyPositioning:e=!0,tournamentRecord:t,drawDefinition:n,structureId:i,seedsOnly:r,event:o}){return o?n?vh({applyPositioning:e,drawDefinition:n,participants:null==t?void 0:t.participants,structureId:i,seedsOnly:r}):{error:"drawDefinition not found"}:{error:"Event not found"}},automatedPlayoffPositioning:Lg,checkInParticipant:function({tournamentRecord:e,participantId:t,matchUpId:n,matchUp:i,drawId:r}){i&&!r&&({drawId:r}=i),i&&!n&&({matchUpId:n}=i);const{event:o,drawDefinition:a}=_s({tournamentRecord:e,drawId:r});if(!o)return{error:"Event not found"};{const i=Nf({tournamentParticipants:e.participants,drawDefinition:a,participantId:t,matchUpId:n});if(i.error&&"Participant already checked in"!==i.error)return i}return ko},checkOutParticipant:function({tournamentRecord:e,drawId:t,matchUpId:n,participantId:i,matchUp:r}){r&&!t&&({drawId:t}=r),r&&!n&&({matchUpId:n}=r);const{event:o,drawDefinition:a}=_s({tournamentRecord:e,drawId:t});if(!o)return{error:"Event not found"};{const t=Mf({drawDefinition:a,tournamentParticipants:e.participants,matchUpId:n,participantId:i});if(t.error)return t}return ko},toggleParticipantCheckInState:Tf,generateDrawDefinition:zg,addDrawDefinitionTimeItem:function({drawDefinition:e,timeItem:t}){if(!e)return{error:"drawDefinition not found"};if(!t)return{error:"Missing timeItem"};const n=t&&Object.keys(t),i=["itemType","itemValue"];if(i.filter((e=>n.includes(e))).length!==i.length)return{error:"Invalid timeItem"};e.timeItems||(e.timeItems=[]);const r=(new Date).toISOString();return Object.assign(t,{createdAt:r}),e.timeItems.push(t),qu({drawDefinition:e}),ko},assignTieMatchUpParticipantId:function(e){var t,n;const i=$g(e);if(i.error)return i;let r=e.teamParticipantId;const{tournamentRecord:o,drawDefinition:a,participantId:s}=e;if(!s)return{error:"Missing participantId"};const{relevantAssignments:c,collectionPosition:u,teamParticipants:d,collectionId:l,matchUpType:p,dualMatchUp:m,tieMatchUp:v,tieFormat:g}=i,{tournamentParticipants:[I]}=jm({tournamentRecord:o,participantFilters:{participantIds:[s]}});if(!I)return{error:"Participant Not Found"};const{individualParticipantIds:y,participantType:w}=I;if(p===Ls&&w!==dc)return{error:"Invalid participantType"};const U=w===dc?[s]:y,b=r?d.find((({participantId:e})=>e===r)):d.find((({individualParticipantIds:e})=>Co(U,e)));if(!b)return{error:"Team not found"};r||(r=b.participantId);const S=c.find((e=>e.participantId===(null==b?void 0:b.participantId))),P=null==S?void 0:S.drawPosition,D=v.sides.find((({drawPosition:e})=>e===P)),N=null==D?void 0:D.sideNumber;if(!g)return{error:"Missing tieFormat"};if(!(null===(t=g.collectionDefinitions)||void 0===t?void 0:t.find((e=>e.collectionId===l))))return{error:"Missing collectionDefinition"};if(null===(n=m.sides)||void 0===n||!n.length){const e=({displaySideNumber:e,drawPosition:t,sideNumber:n})=>({drawPosition:t,sideNumber:n,displaySideNumber:e});m.sides=[h(f({},e(v.sides[0])),{lineUp:[]}),h(f({},e(v.sides[1])),{lineUp:[]})]}const M=m.sides.find((e=>e.sideNumber===N)),T=v.sides.find((e=>e.sideNumber===N));let E;if(p===js&&w!==pc){const e=function({side:e}){let t;if(e.participant){const n=e.participant.individualParticipantIds||[];if(1===n.filter(Boolean).length){const{participant:e}=Hu({participantIds:n,tournamentRecord:o});n.push(s);const{participant:i}=Hu({participantIds:n,tournamentRecord:o});if(i)t=e.participantId;else{e.individualParticipantIds=n;const t=wg({individualParticipantIds:n,pairOverride:!0,tournamentRecord:o,participant:e});if(t.error)return t}}else console.log("###")}else{const e=bm({participant:{participantType:pc,participantRole:Af,individualParticipantIds:[s]},pairOverride:!0,tournamentRecord:o});if(e.error)return e}return h(f({},ko),{deleteParticipantId:t})}({side:T});if(e.error)return e;E=e.deleteParticipantId}else if(p===js&&w===pc){const e=I.individualParticipantIds||[],{modifiedLineUp:t}=jg({collectionPosition:u,teamParticipantId:r,dualMatchUpSide:M,drawDefinition:a,participantIds:e,collectionId:l});for(const n of e)Gg({collectionPosition:u,teamParticipantId:r,drawDefinition:a,modifiedLineUp:t,participantId:n,collectionId:l,tieFormat:g});return M.lineUp=t,Wu({drawDefinition:a,matchUp:m}),h(f({},ko),{modifiedLineUp:t})}const{modifiedLineUp:A}=jg({participantIds:[s],collectionPosition:u,teamParticipantId:r,dualMatchUpSide:M,drawDefinition:a,collectionId:l});if(Gg({collectionPosition:u,teamParticipantId:r,drawDefinition:a,modifiedLineUp:A,participantId:s,collectionId:l,tieFormat:g}),M.lineUp=A,Wu({drawDefinition:a,matchUp:m}),E){const e=pv({participantIds:[E],teamDrawIds:[a.drawId],tournamentRecord:o});e.error&&console.log("cleanup",{result:e})}return h(f({},ko),{modifiedLineUp:A})},removeTieMatchUpParticipantId:function(e){var t,n,i,r;const{tournamentRecord:o,drawDefinition:a,participantId:s}=e;if(!s)return{error:"Missing participantId"};const c=$g(e);if(c.error)return c;const{relevantAssignments:u,collectionPosition:d,teamParticipants:l,collectionId:p,matchUpType:m,dualMatchUp:v,tieMatchUp:g,tieFormat:I}=c;if(Qp({score:g.score})||g.winningSide)return{error:"Existing outcome"};const y=null===(t=g.sides)||void 0===t?void 0:t.find((e=>{var t,n,i;return(null===(t=e.participant)||void 0===t?void 0:t.participantId)===s||(null===(n=e.participant)||void 0===n||null===(i=n.individualParticipantIds)||void 0===i?void 0:i.includes(s))}));if(!y)return{error:"Participant Not Found"};const{tournamentParticipants:[w]}=jm({tournamentRecord:o,participantFilters:{participantIds:[s]}});if(!w)return{error:"Participant Not Found"};if(m===Ls&&w.participantType===pc)return{error:"Invalid participant"};const U=w.participantType===dc?[s]:w.individualParticipantIds;v.sides||(v.sides=[{sideNumber:1},{sideNumber:2}]);let b=null===(n=v.sides)||void 0===n?void 0:n.find((({sideNumber:e})=>e===y.sideNumber));const S=_g({drawDefinition:a,participantIds:U}),P=(null==S?void 0:S.teamParticipantId)||(null==l||null===(i=l.find((e=>Ro((null==e?void 0:e.individualParticipantIds)||[],U).length===U.length)))||void 0===i?void 0:i.participantId);if(!P)return{error:"Participant Not Found"};if(!b&&((null===(r=v.sides)||void 0===r?void 0:r.filter((({lineUp:e})=>!e)).length)||0)<2){var D;const e=l.map((({participantId:e})=>{var t;return{drawPosition:null===(t=u.find((t=>t.participantId===e)))||void 0===t?void 0:t.drawPosition,teamParticipantId:e}}));console.log({drawPositionMap:e}),b=null===(D=v.sides)||void 0===D?void 0:D.find((t=>{var n;return(null===(n=e.find((({drawPosition:e})=>e===t.drawPosition)))||void 0===n?void 0:n.teamParticipantId)===P}))}if(!b)return{error:Wo,participantId:s};const{modifiedLineUp:N}=jg({collectionPosition:d,teamParticipantId:P,dualMatchUpSide:b,participantIds:U,drawDefinition:a,collectionId:p});if(b.lineUp=N,P&&Vg({participantId:P,lineUp:N,drawDefinition:a,tieFormat:I}),m===js&&w.participantType===dc){var M;const e=null===(M=g.sides)||void 0===M?void 0:M.find((e=>e.sideNumber===b.sideNumber)),{participantId:t}=e||{},{tournamentParticipants:[n]}=jm({tournamentRecord:o,participantFilters:{participantIds:[t]},withEvents:!0});if(!n)return{error:"Participant Not Found"};{const e=null==n?void 0:n.individualParticipantIds.filter((e=>e!==s));if(n.draws.length){if(1===e.length){const{participant:t}=Hu({participantIds:e,tournamentRecord:o});if(!t){const t=bm({participant:{participantRole:Af,individualParticipantIds:e,participantType:pc},pairOverride:!0,tournamentRecord:o});if(t.error)return t}}}else if(e.length){n.individualParticipantIds=e;const t=wg({participant:n,pairOverride:!0,tournamentRecord:o});if(t.error)return t}else{const e=pv({participantIds:[t],tournamentRecord:o});e.error&&console.log("cleanup",{result:e})}}}return Wu({drawDefinition:a,matchUp:v}),h(f({},ko),{modifiedLineUp:N})},replaceTieMatchUpParticipantId:function(e){var t;const n=$g(e);if(n.error)return n;const{existingParticipantId:i,tournamentRecord:r,newParticipantId:o,drawDefinition:a}=e;if(!i||!o)return{error:"Missing participantId"};const{collectionPosition:s,teamParticipants:c,collectionId:u,dualMatchUp:d,tieMatchUp:l,tieFormat:p}=n,{matchUpType:m}=l,v=l.sides.find((e=>{var t,n,r;return(null===(t=e.participant)||void 0===t?void 0:t.participantId)===i||(null===(n=e.participant)||void 0===n||null===(r=n.individualParticipantIds)||void 0===r?void 0:r.includes(i))}));if(!v)return{error:"Participant Not Found"};const{tournamentParticipants:g}=jm({tournamentRecord:r,participantFilters:{participantIds:[i,o]}});if(2!==g.length)return{error:"Missing participantId"};if(g[0].participantType!==g[1].participantType)return{error:"Invalid participantType"};const I=d.sides.find((({sideNumber:e})=>e===v.sideNumber));if(!I)return{error:Wo,existingParticipantId:i};const y=g.find((({participantId:e})=>e===i)),w=(null==y?void 0:y.individualParticipantIds)||[y.participantId],U=_g({drawDefinition:a,participantIds:w}),b=(null==U?void 0:U.teamParticipantId)||(null===(t=c.find((e=>Ro((null==e?void 0:e.individualParticipantIds)||[],w).length===w.length)))||void 0===t?void 0:t.participantId),S=I.lineUp||U,P=S.find((({participantId:e})=>o===e)),D=(null==S?void 0:S.map((e=>{return[i,o].includes(e.participantId)?([i,o].includes(e.participantId)&&(e.collectionAssignments=null===(t=e.collectionAssignments)||void 0===t?void 0:t.filter((e=>!(e.collectionId===u&&e.collectionPosition===s)))),e.participantId===o&&(e.collectionAssignments||(e.collectionAssignments=[]),e.collectionAssignments.push({collectionId:u,collectionPosition:s})),e):e;var t})))||[];P||D.push({participantId:o,collectionAssignments:[{collectionId:u,collectionPosition:s}]});const N=m===js,M=N&&S.map((e=>{var t;return(null===(t=e.collectionAssignments)||void 0===t?void 0:t.find((e=>e.collectionId===u&&e.collectionPosition===s)))&&e.participantId})).filter(Boolean),T=N&&D.map((e=>{var t;return(null===(t=e.collectionAssignments)||void 0===t?void 0:t.find((e=>e.collectionId===u&&e.collectionPosition===s)))&&e.participantId})).filter(Boolean);let E,A;if(I.lineUp=D,b&&Vg({participantId:b,lineUp:D,drawDefinition:a,tieFormat:p}),N){var R;const{tournamentRecord:t}=e;let n=Hu({participantIds:T,tournamentRecord:t});if(!n.participant){var C;const e=bm({returnParticipant:!0,pairOverride:!0,tournamentRecord:t,participant:{individualParticipantIds:T,participantType:pc,participantRole:Af}});if(e.error)return e;E=null===(C=e.participant)||void 0===C?void 0:C.participantId}n=Hu({participantIds:M,tournamentRecord:t});const i=null===(R=n.participant)||void 0===R?void 0:R.participantId;i&&pv({participantIds:[i],tournamentRecord:t}).success&&(A=i)}return Wu({drawDefinition:a,matchUp:d}),h(f({},ko),{participantRemoved:A,participantAdded:E})},updateTeamLineUp:Vg,validateLineUp:Bg,getTeamLineUp:Ku},rI={allTournamentMatchUps:Ml,tournamentMatchUps:Al,allEventMatchUps:El,getRoundMatchUps:function(e){return nd(e)},allDrawMatchUps:Tl,eventMatchUps:Rl,drawMatchUps:function({tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,participantsProfile:n,policyDefinitions:i,tournamentRecord:r,matchUpFilters:o,contextFilters:a,contextProfile:s,drawDefinition:c,nextMatchUps:u,participants:d,tournamentId:l,inContext:p,context:m,event:h}){if(!h)return{error:Vo};const{eventId:v,eventName:g,endDate:I}=h||{};return Nl({context:f(f({},m),Za({eventId:v,eventName:g,endDate:I||(null==h?void 0:h.endDate)||(null==r?void 0:r.endDate),tournamentId:l||(null==r?void 0:r.tournamentId),indoorOutDoor:(null==h?void 0:h.indoorOutDoor)||(null==r?void 0:r.indoorOutDoor),surfaceCategory:(null==h?void 0:h.surfaceCategory)||(null==r?void 0:r.surfaceCategory)})),tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:d||r&&Cl({tournamentRecord:r,participantsProfile:n}),participantsProfile:n,policyDefinitions:i,tournamentRecord:r,drawDefinition:c,matchUpFilters:o,contextFilters:a,contextProfile:s,nextMatchUps:u,inContext:p,event:h})},credits:Hf,getEvent:function({tournamentRecord:e,drawDefinition:t,event:n,context:i}){var r;if(!e)return{error:Lo};if(!n)return{error:Vo};const o=Ja(n);return i&&Object.assign(o,i),{event:o,drawDefinition:t&&(null===(r=o.drawDefinitions)||void 0===r?void 0:r.find((({drawId:e})=>t.drawId===e)))}},getEvents:function({tournamentRecord:e,context:t,inContext:n}){if(!e)return{error:Lo};const{tournamentId:i}=e;return{events:(e.events||[]).map((e=>{const r=Ja(e);return t&&Object.assign(r,t),n&&Object.assign(r,{tournamentId:i}),r}))}},findEventExtension:Os,findTournamentExtension:xs,findParticipantExtension:function({tournamentRecord:e,participantId:t,name:n}){if(!e)return{error:Lo};if(!t)return{error:"Missing participantId"};const{participant:i}=Rs({tournamentRecord:e,participantId:t});return Cs({element:i,name:n})},findDrawDefinitionExtension:ks,getTieFormat:function({tournamentRecord:e,drawDefinition:t,structureId:n,matchUpId:i,drawId:r,event:o}){var a,s,c;if(!e)return{error:Lo};if(!(r||o||n||i))return{error:$o};const u=xl({tournamentRecord:e,drawDefinition:t,matchUpId:i,drawId:r,event:o});if(i&&null!=u&&u.error)return u;!t&&null!=u&&u.drawDefinition&&(t=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&n&&!i){if(!t)return{error:"Missing drawId"};const e=ad({drawDefinition:t,structureId:n});if(e.error)return e;d=e.structure}const l=null===(a=d)||void 0===a?void 0:a.tieFormat,p=null===(s=t)||void 0===s?void 0:s.tieFormat,m=null==o?void 0:o.tieFormat;return{structureDefaultTieFormat:l,eventDefaultTieFormat:m,drawDefaultTieFormat:p,tieFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.tieFormat)||l||p||m||void 0}},getMatchUpFormat:ef,getDrawDefinition:function({tournamentRecord:e,drawDefinition:t}){return e?{drawDefinition:Ja(t)}:{error:Lo}},getEventProperties:function({tournamentRecord:e,event:t}){var n,i;if(!e)return{error:Lo};if(!t)return{error:Vo};const r=t.entries||[],o=e.participants||[],a=(null===(n=t.category)||void 0===n?void 0:n.categoryName)||(null===(i=t.category)||void 0===i?void 0:i.ageCategoryCode),{eventType:s}=t,c=r.map((e=>e.participantId));let u,d,l;return{entryScaleAttributes:o.filter((e=>c.includes(e.participantId))).map((e=>{var t,n,i,r,o,c;const{participantId:p,participantName:m,name:f}=e;let h={scaleType:"SEEDING",eventType:s,scaleName:a};const v=null===(t=Tv({participant:e,scaleAttributes:h}))||void 0===t||null===(n=t.scaleItem)||void 0===n?void 0:n.scaleValue;h={scaleType:"RANKING",eventType:s,scaleName:a};const g=null===(i=Tv({participant:e,scaleAttributes:h}))||void 0===i||null===(r=i.scaleItem)||void 0===r?void 0:r.scaleValue;h={scaleType:"RATING",eventType:s,scaleName:a};const I=null===(o=Tv({participant:e,scaleAttributes:h}))||void 0===o||null===(c=o.scaleItem)||void 0===c?void 0:c.scaleValue;return u=!(!u&&!v),d=!(!d&&!g),l=!(!l&&!I),{participantId:p,participantName:m||f,seed:v,ranking:g,rating:I}})),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:l}},getPositionAssignments:function({tournamentRecord:e,drawDefinition:t,structureId:n}){return e?t?n?Hd({drawDefinition:t,structureId:n}):{error:"Missing structureId"}:{error:jo}:{error:Lo}},isValidMatchUpFormat:$r,getMaxEntryPosition:function({entries:e=[],entryStatus:t,stage:n}){return Math.max(...e.filter((e=>!(n&&n!==e.entryStage||t&&e.entryStatus!==t||isNaN(e.entryPosition)))).map((({entryPosition:e})=>parseInt(e||0))),0)},findVenue:ec,getCourts:nc,getVenuesAndCourts:Xs,findCourt:function(e){return Ja(tc(e),!1,!0)},getEventTimeItem:Fu,getTournamentTimeItem:function({tournamentRecord:e,itemType:t,itemSubTypes:n,returnPreviousValues:i}){if(!e)return{error:Lo};if(!e.timeItems)return{message:Wo};const{timeItem:r,previousItems:o,message:a}=ku({element:e,itemType:t,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:o}||{message:a}},getParticipantTimeItem:function({tournamentRecord:e,participantId:t,itemType:n,itemSubTypes:i,returnPreviousValues:r}){if(!e)return{error:Lo};if(!t)return{error:"Missing participantId"};const o=Rs({tournamentRecord:e,participantId:t});if(o.error)return o;const{participant:a}=o;if(null==a||!a.timeItems)return{message:Wo};const{timeItem:s,previousItems:c,message:u}=ku({element:o.participant,itemType:n,itemSubTypes:i,returnPreviousValues:r});return s&&{timeItem:s,previousItems:c}||{message:u}},getDrawDefinitionTimeItem:function({drawDefinition:e,itemType:t,itemSubTypes:n,returnPreviousValues:i}){if(!e)return{error:"Missing drawId"};if(!e.timeItems)return{message:Wo};const{timeItem:r,previousItems:o,message:a}=ku({element:e,itemType:t,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:o}||{message:a}},bulkUpdatePublishedEventIds:function({tournamentRecord:e,outcomes:t}){var n;if(!e)return{error:Lo};if(null==t||!t.length)return{error:$o,message:"Missing outcomes"};const i=t.reduce(((e,t)=>{const{drawId:n,eventId:i}=t;return i&&n&&(e[i]?e[i].includes(n)||e[i].push(n):e[i]=[n]),e}),{}),r=Object.keys(i);return{publishedEventIds:(null===(n=e.events)||void 0===n?void 0:n.filter((e=>r.includes(e.eventId)))).filter((e=>{const{timeItem:t}=Fu({event:e,itemType:"PUBLISH.STATUS"}),n=null==t?void 0:t.itemValue,{eventId:r}=e;return i[r].filter((e=>{var t;return n&&n.PUBLIC&&(null===(t=n.PUBLIC.drawIds)||void 0===t?void 0:t.includes(e))&&"HIDDEN"!==n})).length})).map((e=>e.eventId)),eventIdPublishedDrawIdsMap:i}},matchUpActions:Yf,positionActions:function({policyDefinitions:e,tournamentRecord:t,drawDefinition:n,drawPosition:i,structureId:r,drawId:o,event:a}){const{tournamentParticipants:s}=jm({tournamentRecord:t,inContext:!0});return Wv({tournamentParticipants:s,policyDefinitions:e,tournamentRecord:t,drawDefinition:n,drawPosition:i,structureId:r,drawId:o,event:a})},findMatchUp:function(e){Object.assign(e,{inContext:!0});const{matchUp:t,error:n}=xl(e);return{matchUp:Ja(t,!0,!0),error:n}},participantScheduledMatchUps:Dm,participantScaleItem:Tv,getParticipantScaleItem:cg,getParticipantSignInStatus:function({tournamentRecord:e,participantId:t}){if(!e)return{error:Lo};if(!t)return{error:"Missing participantId"};const{participant:n}=Rs({tournamentRecord:e,participantId:t});if(!n)return{error:"Participant Not Found"};const{timeItem:i}=ku({element:n,itemType:"SIGN_IN_STATUS"});return i&&i.itemValue===Am&&Am},getPolicyDefinitions:vp,getMatchUpScheduleDetails:oc},oI={addVenue:Um,deleteVenue:ym,deleteVenues:function({tournamentRecord:e,venueIds:t,force:n}){if(!e)return{error:Lo};if(!Array.isArray(t))return{error:_o};for(const i of e.venues||[]){const{venueId:r}=i;if(t.includes(r)){const{venueId:t}=i,r=ym({tournamentRecord:e,venueId:t,force:n});if(r.error)return r}}return ko},modifyVenue:gm,addCourt:hm,addCourts:vm,deleteCourt:function({tournamentRecord:e,drawDefinition:t,disableNotice:n,courtId:i,force:r}){const{venue:o,error:a}=tc({tournamentRecord:e,courtId:i});if(a)return{error:a};const{matchUps:s}=um({tournamentRecord:e,courtId:i});if(s.length&&!r)return dm({matchUpsCount:s.length});for(const c of s){const n=Im({tournamentRecord:e,drawDefinition:t,drawId:c.drawId,matchUpId:c.matchUpId});if(n.error)return n}return o.courts=(o.courts||[]).filter((e=>e.courtId!==i)),n||la({topic:"modifyVenue",payload:{venue:o},key:o.venueId}),f({},ko)},modifyCourt:fm,modifyCourtAvailability:mm,findVenue:function(e){return Ja(ec(e),!1,!0)}};!function(){const e={getState:({convertExtensions:e,removeExtensions:t}={})=>function({convertExtensions:e,removeExtensions:t,tournamentId:n}={}){return"string"!=typeof n?{}:{tournamentRecord:Ja(ga(n),e,!1,t)}}({convertExtensions:e,removeExtensions:t,tournamentId:va()}),newTournamentRecord:(e={})=>{const t=mg(e);return t.error?t:(ya(t),Ua(t.tournamentId),Object.assign({tournamentId:t.tournamentId},ko))},setTournamentId:e=>Ua(e)};function t(t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}return e.version=()=>"0.74.1",e.reset=()=>t(ba(va())),e.setState=(e,n,i)=>(da(n,i),t(fg(e,n))),e.devContext=t=>(ca(t),e),e.getDevContext=e=>sa(e),e.executionQueue=(t,i)=>function(t,i){if(!Array.isArray(t))return{error:_o};const r=ga(va()),o=i&&Ja(r,!1,!0),a=[];for(const s of t){if("object"!=typeof s)return{error:_o};const{method:t,params:i}=s;if(!e[t])return{error:"Method not found"};const c=n(r,e[t],i);if(null!=c&&c.error)return o&&fg(o),h(f({},c),{rolledBack:!!o});a.push(c)}return Hm(),ma(),{results:a}}(t,i),[rI,iI,oI,Rg,Tg,Dg,Mg,Ug].forEach((t=>{Object.keys(t).forEach((n=>{e[n]=e=>{if(sa())return i(t[n],e);try{return i(t[n],e)}catch(r){const t=r.toString();console.log("ERROR",{error:t,method:n,params:JSON.stringify(e)}),console.log(r)}}}))})),e;function n(t,n,i){return delete e.success,delete e.error,n(h(f({},function(e,t,n){if(t){const{drawId:i}=t||t.matchUp&&t.matchUp.drawId;if(i){const{event:r,drawDefinition:o}=_s({tournamentRecord:e,drawId:i});if(t=h(f({},t),{event:r,drawDefinition:o}),n){const e=id({drawDefinition:o}),{matchUps:n}=Dl({drawDefinition:o,inContext:!0,includeByeMatchUps:!0,matchUpsMap:e});t.matchUpsMap=e,t.inContextDrawMatchUps=n}}if(t.eventId&&!t.event){const{event:n}=_s({tournamentRecord:e,eventId:t.eventId});n&&(t=h(f({},t),{event:n}))}}return t}(t,i)),{tournamentRecord:t}))}function i(e,t){const i=(null==t?void 0:t.sandBoxRecord)||(null==t?void 0:t.sandboxRecord)||(null==t?void 0:t.sandboxTournament)||ga(va()),r=(null==t?void 0:t.rollbackOnError)&&Ja(i,!1,!0),o=n(i,e,t);null!=o&&o.error&&r&&fg(r);const a=(null==o?void 0:o.success)&&!0!==(null==t?void 0:t.delayNotify)&&!0!==(null==t?void 0:t.doNotNotify);return a&&Hm(),(a||null==o||!o.success||null!=t&&t.doNotNotify)&&ma(),o}}();var aI=[{firstName:"Novak",lastName:"Djokovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Rafael",lastName:"Nadal",sex:"MALE",nationalityCode:"ESP"},{firstName:"Dominic",lastName:"Thiem",sex:"MALE",nationalityCode:"AUT"},{firstName:"Roger",lastName:"Federer",sex:"MALE",nationalityCode:"SUI"},{firstName:"Stefanos",lastName:"Tsitsipas",sex:"MALE",nationalityCode:"GRE"},{firstName:"Daniil",lastName:"Medvedev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Alexander",lastName:"Zverev",sex:"MALE",nationalityCode:"GER"},{firstName:"Andrey",lastName:"Rublev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Diego",lastName:"Schwartzman",sex:"MALE",nationalityCode:"ARG"},{firstName:"Matteo",lastName:"Berrettini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Gael",lastName:"Monfils",sex:"MALE",nationalityCode:"FRA"},{firstName:"Denis",lastName:"Shapovalov",sex:"MALE",nationalityCode:"CAN"},{firstName:"Roberto",lastName:"Bautista Agut",sex:"MALE",nationalityCode:"ESP"},{firstName:"David",lastName:"Goffin",sex:"MALE",nationalityCode:"BEL"},{firstName:"Pablo",lastName:"Carreno Busta",sex:"MALE",nationalityCode:"ESP"},{firstName:"Fabio",lastName:"Fognini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Milos",lastName:"Raonic",sex:"MALE",nationalityCode:"CAN"},{firstName:"Karen",lastName:"Khachanov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Stan",lastName:"Wawrinka",sex:"MALE",nationalityCode:"SUI"},{firstName:"Grigor",lastName:"Dimitrov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Felix",lastName:"Auger-Aliassime",sex:"MALE",nationalityCode:"CAN"},{firstName:"Cristian",lastName:"Garin",sex:"MALE",nationalityCode:"CHI"},{firstName:"John",lastName:"Isner",sex:"MALE",nationalityCode:"USA"},{firstName:"Borna",lastName:"Coric",sex:"MALE",nationalityCode:"CRO"},{firstName:"Alex",lastName:"de Minaur",sex:"MALE",nationalityCode:"AUS"},{firstName:"Dusan",lastName:"Lajovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Casper",lastName:"Ruud",sex:"MALE",nationalityCode:"NOR"},{firstName:"Benoit",lastName:"Paire",sex:"MALE",nationalityCode:"FRA"},{firstName:"Taylor",lastName:"Fritz",sex:"MALE",nationalityCode:"USA"},{firstName:"Filip",lastName:"Krajinovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Hubert",lastName:"Hurkacz",sex:"MALE",nationalityCode:"POL"},{firstName:"Ugo",lastName:"Humbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Daniel",lastName:"Evans",sex:"MALE",nationalityCode:"GBR"},{firstName:"Jan-Lennard",lastName:"Struff",sex:"MALE",nationalityCode:"GER"},{firstName:"Reilly",lastName:"Opelka",sex:"MALE",nationalityCode:"USA"},{firstName:"Nikoloz",lastName:"Basilashvili",sex:"MALE",nationalityCode:"GEO"},{firstName:"Kei",lastName:"Nishikori",sex:"MALE",nationalityCode:"JPN"},{firstName:"Guido",lastName:"Pella",sex:"MALE",nationalityCode:"ARG"},{firstName:"Adrian",lastName:"Mannarino",sex:"MALE",nationalityCode:"FRA"},{firstName:"Miomir",lastName:"Kecmanovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Marin",lastName:"Cilic",sex:"MALE",nationalityCode:"CRO"},{firstName:"Lorenzo",lastName:"Sonego",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jannik",lastName:"Sinner",sex:"MALE",nationalityCode:"ITA"},{firstName:"Nick",lastName:"Kyrgios",sex:"MALE",nationalityCode:"AUS"},{firstName:"John",lastName:"Millman",sex:"MALE",nationalityCode:"AUS"},{firstName:"Albert",lastName:"Ramos-Vinolas",sex:"MALE",nationalityCode:"ESP"},{firstName:"Kyle",lastName:"Edmund",sex:"MALE",nationalityCode:"GBR"},{firstName:"Tennys",lastName:"Sandgren",sex:"MALE",nationalityCode:"USA"},{firstName:"Alexander",lastName:"Bublik",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Sam",lastName:"Querrey",sex:"MALE",nationalityCode:"USA"},{firstName:"Yoshihito",lastName:"Nishioka",sex:"MALE",nationalityCode:"JPN"},{firstName:"Marton",lastName:"Fucsovics",sex:"MALE",nationalityCode:"HUN"},{firstName:"Aljaz",lastName:"Bedene",sex:"MALE",nationalityCode:"SLO"},{firstName:"Laslo",lastName:"Djere",sex:"MALE",nationalityCode:"SRB"},{firstName:"Richard",lastName:"Gasquet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pablo",lastName:"Andujar",sex:"MALE",nationalityCode:"ESP"},{firstName:"Jo-Wilfried",lastName:"Tsonga",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gilles",lastName:"Simon",sex:"MALE",nationalityCode:"FRA"},{firstName:"Tommy",lastName:"Paul",sex:"MALE",nationalityCode:"USA"},{firstName:"Jordan",lastName:"Thompson",sex:"MALE",nationalityCode:"AUS"},{firstName:"Fernando",lastName:"Verdasco",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alejandro",lastName:"Davidovich Fokina",sex:"MALE",nationalityCode:"ESP"},{firstName:"Feliciano",lastName:"Lopez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Frances",lastName:"Tiafoe",sex:"MALE",nationalityCode:"USA"},{firstName:"Dominik",lastName:"Koepfer",sex:"MALE",nationalityCode:"GER"},{firstName:"Jiri",lastName:"Vesely",sex:"MALE",nationalityCode:"CZE"},{firstName:"Pablo",lastName:"Cuevas",sex:"MALE",nationalityCode:"URU"},{firstName:"Ricardas",lastName:"Berankis",sex:"MALE",nationalityCode:"LTU"},{firstName:"Lucas",lastName:"Pouille",sex:"MALE",nationalityCode:"FRA"},{firstName:"Cameron",lastName:"Norrie",sex:"MALE",nationalityCode:"GBR"},{firstName:"Steve",lastName:"Johnson",sex:"MALE",nationalityCode:"USA"},{firstName:"Jeremy",lastName:"Chardy",sex:"MALE",nationalityCode:"FRA"},{firstName:"Stefano",lastName:"Travaglia",sex:"MALE",nationalityCode:"ITA"},{firstName:"Corentin",lastName:"Moutet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Juan",lastName:"Ignacio Londero",sex:"MALE",nationalityCode:"ARG"},{firstName:"Federico",lastName:"Delbonis",sex:"MALE",nationalityCode:"ARG"},{firstName:"Marco",lastName:"Cecchinato",sex:"MALE",nationalityCode:"ITA"},{firstName:"Thiago",lastName:"Monteiro",sex:"MALE",nationalityCode:"BRA"},{firstName:"Salvatore",lastName:"Caruso",sex:"MALE",nationalityCode:"ITA"},{firstName:"Lloyd",lastName:"Harris",sex:"MALE",nationalityCode:"RSA"},{firstName:"Vasek",lastName:"Pospisil",sex:"MALE",nationalityCode:"CAN"},{firstName:"Pierre-Hugues",lastName:"Herbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Egor",lastName:"Gerasimov",sex:"MALE",nationalityCode:"BLR"},{firstName:"Joao",lastName:"Sousa",sex:"MALE",nationalityCode:"POR"},{firstName:"Radu",lastName:"Albot",sex:"MALE",nationalityCode:"MDA"},{firstName:"Marcos",lastName:"Giron",sex:"MALE",nationalityCode:"USA"},{firstName:"Mikael",lastName:"Ymer",sex:"MALE",nationalityCode:"SWE"},{firstName:"Attila",lastName:"Balazs",sex:"MALE",nationalityCode:"HUN"},{firstName:"Federico",lastName:"Coria",sex:"MALE",nationalityCode:"ARG"},{firstName:"Soonwoo",lastName:"Kwon",sex:"MALE",nationalityCode:"KOR"},{firstName:"Mikhail",lastName:"Kukushkin",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Dennis",lastName:"Novak",sex:"MALE",nationalityCode:"AUT"},{firstName:"Pedro",lastName:"Martinez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Philipp",lastName:"Kohlschreiber",sex:"MALE",nationalityCode:"GER"},{firstName:"Yannick",lastName:"Hanfmann",sex:"MALE",nationalityCode:"GER"},{firstName:"Gianluca",lastName:"Mager",sex:"MALE",nationalityCode:"ITA"},{firstName:"James",lastName:"Duckworth",sex:"MALE",nationalityCode:"AUS"},{firstName:"Emil",lastName:"Ruusuvuori",sex:"MALE",nationalityCode:"FIN"},{firstName:"Yasutaka",lastName:"Uchiyama",sex:"MALE",nationalityCode:"JPN"},{firstName:"Roberto",lastName:"Carballes Baena",sex:"MALE",nationalityCode:"ESP"},{firstName:"Ashleigh",lastName:"Barty",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Simona",lastName:"Halep",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Naomi",lastName:"Osaka",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Sofia",lastName:"Kenin",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Elina",lastName:"Svitolina",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Karolina",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Bianca",lastName:"Andreescu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Petra",lastName:"Kvitova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Kiki",lastName:"Bertens",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Serena",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aryna",lastName:"Sabalenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Belinda",lastName:"Bencic",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Victoria",lastName:"Azarenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Johanna",lastName:"Konta",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Garbine",lastName:"Muguruza",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Madison",lastName:"Keys",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Iga",lastName:"Swiatek",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Petra",lastName:"Martic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Elena",lastName:"Rybakina",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Marketa",lastName:"Vondrousova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Elise",lastName:"Mertens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Maria",lastName:"Sakkari",sex:"FEMALE",nationalityCode:"GRE"},{firstName:"Anett",lastName:"Kontaveit",sex:"FEMALE",nationalityCode:"EST"},{firstName:"Jennifer",lastName:"Brady",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelique",lastName:"Kerber",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Alison",lastName:"Riske",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Karolina",lastName:"Muchova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Yulia",lastName:"Putintseva",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Dayana",lastName:"Yastremska",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Amanda",lastName:"Anisimova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Ons",lastName:"Jabeur",sex:"FEMALE",nationalityCode:"TUN"},{firstName:"Donna",lastName:"Vekic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Ekaterina",lastName:"Alexandrova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qiang",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Shuai",lastName:"Zhang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Svetlana",lastName:"Kuznetsova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Barbora",lastName:"Strycova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Anastasia",lastName:"Pavlyuchenkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Sloane",lastName:"Stephens",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Magda",lastName:"Linette",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Saisai",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Fiona",lastName:"Ferro",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Caroline",lastName:"Garcia",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Jelena",lastName:"Ostapenko",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Danielle",lastName:"Collins",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Veronika",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Cori",lastName:"Gauff",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Nadia",lastName:"Podoroska",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Kristina",lastName:"Mladenovic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Laura",lastName:"Siegemund",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Marie",lastName:"Bouzkova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Polona",lastName:"Hercog",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Alize",lastName:"Cornet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Anastasija",lastName:"Sevastova",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Rebecca",lastName:"Peterson",sex:"FEMALE",nationalityCode:"SWE"},{firstName:"Patricia",lastName:"Maria Tig",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Jil",lastName:"Teichmann",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Shelby",lastName:"Rogers",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Heather",lastName:"Watson",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Anna",lastName:"Blinkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Bernarda",lastName:"Pera",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Jessica",lastName:"Pegula",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alison",lastName:"Van Uytvanck",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Katerina",lastName:"Siniakova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Sara",lastName:"Sorribes Tormo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Su-Wei",lastName:"Hsieh",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Ajla",lastName:"Tomljanovic",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Kristyna",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Paula",lastName:"Badosa",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Daria",lastName:"Kasatkina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nao",lastName:"Hibino",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Arantxa",lastName:"Rus",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lauren",lastName:"Davis",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Krejcikova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Camila",lastName:"Giorgi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Irina-Camelia",lastName:"Begu",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Danka",lastName:"Kovinic",sex:"FEMALE",nationalityCode:"MNE"},{firstName:"Venus",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Zarina",lastName:"Diyas",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Christina",lastName:"Mchale",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Madison",lastName:"Brengle",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Carla",lastName:"Suarez Navarro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Martina",lastName:"Trevisan",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Kirsten",lastName:"Flipkens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Misaki",lastName:"Doi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Tamara",lastName:"Zidansek",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Sorana",lastName:"Cirstea",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Leylah",lastName:"Fernandez",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Taylor",lastName:"Townsend",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Lin",lastName:"Zhu",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Ana",lastName:"Bogdan",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Aliaksandra",lastName:"Sasnovich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Yafan",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Jasmine",lastName:"Paolini",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Varvara",lastName:"Gracheva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Viktoria",lastName:"Kuzmova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Nina",lastName:"Stojanovic",sex:"FEMALE",nationalityCode:"SRB"},{firstName:"Anastasia",lastName:"Potapova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Andrea",lastName:"Petkovic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kaja",lastName:"Juvan",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Elsa",lastName:"Jacquemot",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Victoria",lastName:"Jimenez Kasintseva",sex:"FEMALE",nationalityCode:"AND"},{firstName:"Alexandra",lastName:"Eala",sex:"FEMALE",nationalityCode:"PHI"},{firstName:"Diane",lastName:"Parry",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Daria",lastName:"Snigur",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Polina",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Robin",lastName:"Montgomery",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alexandra",lastName:"Vecic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kristina",lastName:"Dmitruk",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Alexa",lastName:"Noel",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Kamilla",lastName:"Bartone",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Weronika",lastName:"Baszak",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Oksana",lastName:"Selekhmeteva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Alina",lastName:"Charaeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Maria",lastName:"Bondarenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Priska",lastName:"Madelyn Nugroho",sex:"FEMALE",nationalityCode:"INA"},{firstName:"Linda",lastName:"Fruhvirtova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Dana",lastName:"Guzman",sex:"FEMALE",nationalityCode:"PER"},{firstName:"Linda",lastName:"Noskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Hong",lastName:"Yi Cody Wong",sex:"FEMALE",nationalityCode:"HKG"},{firstName:"Zhuoxuan",lastName:"Bai",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Mell",lastName:"Reasco Gonzalez",sex:"FEMALE",nationalityCode:"ECU"},{firstName:"Matilda",lastName:"Mutavdzic",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Diana",lastName:"Shnaider",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qinwen",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Alexandra",lastName:"Yepifanova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Matilde",lastName:"Paoletti",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Melania",lastName:"Delai",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jana",lastName:"Kolodynska",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Guillermina",lastName:"Grant",sex:"FEMALE",nationalityCode:"URU"},{firstName:"Darja",lastName:"Vidmanova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Melodie",lastName:"Collard",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Elvina",lastName:"Kalieva",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Sofia",lastName:"Costoulas",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Aliona",lastName:"Falei",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Mai",lastName:"Nirundorn",sex:"FEMALE",nationalityCode:"THA"},{firstName:"Elizabeth",lastName:"Coleman",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aubane",lastName:"Droguet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Madison",lastName:"Sieg",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Natsumi",lastName:"Kawaguchi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Leyre",lastName:"Romero Gormaz",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Elina",lastName:"Avanesyan",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Oceane",lastName:"Babel",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ziva",lastName:"Falkner",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Julia",lastName:"Garcia",sex:"FEMALE",nationalityCode:"MEX"},{firstName:"Natalia",lastName:"Szabanin",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Erika",lastName:"Andreeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Celia",lastName:"Belle Mohr",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ane",lastName:"Mintegi Del Olmo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Sebastianna",lastName:"Scilipoti",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Ana",lastName:"Geller",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Dayeon",lastName:"Back",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Selena",lastName:"Janicijevic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Romana",lastName:"Cisovska",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Amarissa",lastName:"Kiara Toth",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Mara",lastName:"Guth",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Evialina",lastName:"Laskevich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Julia",lastName:"Avdeeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Beatrice",lastName:"Ricci",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Eleonora",lastName:"Alvisi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jessica",lastName:"Bouzas Maneiro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Julie",lastName:"Belgraver",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lisa",lastName:"Pigato",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Ya",lastName:"Yi Yang",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Eva",lastName:"Lys",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Talia",lastName:"Gibson",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Yeon",lastName:"Ku",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Katrina",lastName:"Scott",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Palicova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Alina",lastName:"Shcherbinina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Giulia",lastName:"Morlet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tina",lastName:"Nadine Smith",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Sohyun",lastName:"Park",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Tara",lastName:"Wurth",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Polina",lastName:"Iatcenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Lauren",lastName:"Anzalotta Kynoch",sex:"FEMALE",nationalityCode:"PUR"},{firstName:"Savannah",lastName:"Broadus",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelina",lastName:"Wirges",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Amarni",lastName:"Banks",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Hanne",lastName:"Vandewinkel",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Jada",lastName:"Bui",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Sabina",lastName:"Zeynalova",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Pia",lastName:"Lovric",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Erika",lastName:"Matsuda",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Lyubov",lastName:"Kostenko",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Anaelle",lastName:"Leclercq",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Alessandra",lastName:"Simone",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Darja",lastName:"Semenistaja",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Daria",lastName:"Frayman",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nastasja",lastName:"Schunk",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Olivia",lastName:"Gadecki",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"India",lastName:"Houghton",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Maria",lastName:"Sholokhova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Julia",lastName:"Middendorf",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Petra",lastName:"Marcinko",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Radka",lastName:"Zelnickova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Lucie",lastName:"Nguyen Tan",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tatiana",lastName:"Barkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Annabelle",lastName:"Xu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Harold",lastName:"Mayot",sex:"MALE",nationalityCode:"FRA"},{firstName:"Holger",lastName:"Vitus Nodskov Rune",sex:"MALE",nationalityCode:"DEN"},{firstName:"Dominic",lastName:"Stephan Stricker",sex:"MALE",nationalityCode:"SUI"},{firstName:"Shintaro",lastName:"Mochizuki",sex:"MALE",nationalityCode:"JPN"},{firstName:"Arthur",lastName:"Cazaux",sex:"MALE",nationalityCode:"FRA"},{firstName:"Leandro",lastName:"Riedi",sex:"MALE",nationalityCode:"SUI"},{firstName:"Martin",lastName:"Damm",sex:"MALE",nationalityCode:"USA"},{firstName:"Natan",lastName:"Rodrigues",sex:"MALE",nationalityCode:"BRA"},{firstName:"Karlis",lastName:"Ozolins",sex:"MALE",nationalityCode:"LAT"},{firstName:"Luciano",lastName:"Darderi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Hanwen",lastName:"Li",sex:"MALE",nationalityCode:"CHN"},{firstName:"Arthur",lastName:"Fery",sex:"MALE",nationalityCode:"GBR"},{firstName:"Juan",lastName:"Bautista Torres",sex:"MALE",nationalityCode:"ARG"},{firstName:"Khololwam",lastName:"Montsi",sex:"MALE",nationalityCode:"RSA"},{firstName:"Jeffrey",lastName:"Von Der Schulenburg",sex:"MALE",nationalityCode:"SUI"},{firstName:"Timo",lastName:"Legout",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gustavo",lastName:"Heide",sex:"MALE",nationalityCode:"BRA"},{firstName:"Flavio",lastName:"Cobolli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Guy",lastName:"Den Ouden",sex:"MALE",nationalityCode:"NED"},{firstName:"Martin",lastName:"Breysach",sex:"MALE",nationalityCode:"FRA"},{firstName:"Toby",lastName:"Kodat",sex:"MALE",nationalityCode:"USA"},{firstName:"Lilian",lastName:"Marmousez",sex:"MALE",nationalityCode:"FRA"},{firstName:"Roman",lastName:"Andres Burruchaga",sex:"MALE",nationalityCode:"ARG"},{firstName:"Alex",lastName:"Barrena",sex:"MALE",nationalityCode:"ARG"},{firstName:"Dalibor",lastName:"Svrcina",sex:"MALE",nationalityCode:"CZE"},{firstName:"Martin",lastName:"Krumich",sex:"MALE",nationalityCode:"CZE"},{firstName:"Peter",lastName:"Fajta",sex:"MALE",nationalityCode:"HUN"},{firstName:"Lukas",lastName:"Neumayer",sex:"MALE",nationalityCode:"AUT"},{firstName:"Raphael",lastName:"Collignon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Dali",lastName:"Blanch",sex:"MALE",nationalityCode:"USA"},{firstName:"Terence",lastName:"Atmane",sex:"MALE",nationalityCode:"FRA"},{firstName:"Felix",lastName:"Gill",sex:"MALE",nationalityCode:"GBR"},{firstName:"Eliakim",lastName:"Coulibaly",sex:"MALE",nationalityCode:"CIV"},{firstName:"Hamad",lastName:"Medjedovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Jerome",lastName:"Kym",sex:"MALE",nationalityCode:"SUI"},{firstName:"Nicholas",lastName:"David Ionel",sex:"MALE",nationalityCode:"ROU"},{firstName:"Shunsuke",lastName:"Mitsui",sex:"MALE",nationalityCode:"JPN"},{firstName:"Giovanni",lastName:"Mpetshi Perricard",sex:"MALE",nationalityCode:"FRA"},{firstName:"Bu",lastName:"Yunchaokete",sex:"MALE",nationalityCode:"CHN"},{firstName:"Jack",lastName:"Pinnington Jones",sex:"MALE",nationalityCode:"GBR"},{firstName:"Alexander",lastName:"Hoogmartens",sex:"MALE",nationalityCode:"BEL"},{firstName:"Bruno",lastName:"Oliveira",sex:"MALE",nationalityCode:"BRA"},{firstName:"Maks",lastName:"Kasnikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Mikolaj",lastName:"Lorens",sex:"MALE",nationalityCode:"POL"},{firstName:"Chak",lastName:"Lam Coleman Wong",sex:"MALE",nationalityCode:"HKG"},{firstName:"Egor",lastName:"Agafonov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Mans",lastName:"Dahlberg",sex:"MALE",nationalityCode:"SWE"},{firstName:"Marat",lastName:"Sharipov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Luca",lastName:"Nardi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Sean",lastName:"Cuenin",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pedro",lastName:"Boscardin Dias",sex:"MALE",nationalityCode:"BRA"},{firstName:"Samuel",lastName:"Vincent Ruggeri",sex:"MALE",nationalityCode:"ITA"},{firstName:"Bruno",lastName:"Kuzuhara",sex:"MALE",nationalityCode:"USA"},{firstName:"Romain",lastName:"Faucon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Elmer",lastName:"Moller",sex:"MALE",nationalityCode:"DEN"},{firstName:"Mario",lastName:"Mansilla Diez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Leonardo",lastName:"Malgaroli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Pierre",lastName:"Yves Bailly",sex:"MALE",nationalityCode:"BEL"},{firstName:"Sebastian",lastName:"Gima",sex:"MALE",nationalityCode:"ROU"},{firstName:"Ilya",lastName:"Snitari",sex:"MALE",nationalityCode:"MDA"},{firstName:"Diego",lastName:"Augusto Barreto Sanchez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alexander",lastName:"Bernard",sex:"MALE",nationalityCode:"USA"},{firstName:"Pengyu",lastName:"Lu",sex:"MALE",nationalityCode:"CHN"},{firstName:"Max",lastName:"Wiskandt",sex:"MALE",nationalityCode:"GER"},{firstName:"Max",lastName:"Westphal",sex:"MALE",nationalityCode:"FRA"},{firstName:"Lorenzo",lastName:"Claverie",sex:"MALE",nationalityCode:"VEN"},{firstName:"Axel",lastName:"Garcian",sex:"MALE",nationalityCode:"FRA"},{firstName:"Aleksander",lastName:"Orlikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Maxwell",lastName:"Mckennon",sex:"MALE",nationalityCode:"USA"},{firstName:"Rafael",lastName:"Alfonso De Alba Valdes",sex:"MALE",nationalityCode:"MEX"},{firstName:"Dev",lastName:"Javia",sex:"MALE",nationalityCode:"IND"},{firstName:"Kokoro",lastName:"Isomura",sex:"MALE",nationalityCode:"JPN"},{firstName:"Matteo",lastName:"Gigante",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jack",lastName:"Anthrop",sex:"MALE",nationalityCode:"USA"},{firstName:"Pablo",lastName:"Llamas Ruiz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Biagio",lastName:"Gramaticopolo",sex:"MALE",nationalityCode:"ITA"},{firstName:"Patorn",lastName:"Hanchaikul",sex:"MALE",nationalityCode:"THA"},{firstName:"Marko",lastName:"Topo",sex:"MALE",nationalityCode:"SRB"},{firstName:"Carlos",lastName:"Alcaraz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Juncheng",lastName:"Shang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Toby",lastName:"Samuel",sex:"MALE",nationalityCode:"GBR"},{firstName:"Petr",lastName:"Nesterov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Mehdi",lastName:"Sadaoui",sex:"MALE",nationalityCode:"FRA"},{firstName:"Max",lastName:"Alcala Gurri",sex:"MALE",nationalityCode:"ESP"},{firstName:"Nikita",lastName:"Kashirin",sex:"MALE",nationalityCode:"RUS"},{firstName:"Aidan",lastName:"Mayo",sex:"MALE",nationalityCode:"USA"},{firstName:"Yu",lastName:"Zhang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Philip",lastName:"Sekulic",sex:"MALE",nationalityCode:"AUS"},{firstName:"Lorenzo",lastName:"Rottoli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Michal",lastName:"Novansky",sex:"MALE",nationalityCode:"SVK"},{firstName:"Maikel",lastName:"De Boes",sex:"MALE",nationalityCode:"BEL"},{firstName:"Chen",lastName:"Dong",sex:"MALE",nationalityCode:"AUS"},{firstName:"Evgeny",lastName:"Philippov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Damien",lastName:"Salvestre",sex:"MALE",nationalityCode:"FRA"},{firstName:"Francesco",lastName:"Maestrelli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Viacheslav",lastName:"Bielinskyi",sex:"MALE",nationalityCode:"UKR"},{firstName:"Jean",lastName:"Marc Malkowski",sex:"MALE",nationalityCode:"SUI"},{firstName:"Santiago",lastName:"De La Fuente",sex:"MALE",nationalityCode:"ARG"},{firstName:"Simeon",lastName:"Terziev",sex:"MALE",nationalityCode:"BUL"},{firstName:"Benjamin",lastName:"Kittay",sex:"MALE",nationalityCode:"USA"}];function sI({personExtensions:e,consideredDate:t,isMock:n=!0,personData:i,count:r=1,category:o,sex:a}={}){if(isNaN(r))return{error:_o};let s=aI.filter((e=>!a||e.sex===a)),c=[];if(Array.isArray(i)){const e=i.filter((e=>!("string"!=typeof e.firstName||"string"!=typeof e.lastName||![gg,Ig].includes(e.sex)||e.nationalityCode&&("string"!=typeof e.nationalityCode||e.nationalityCode.length>3||!Yc.find((({iso:t,ioc:n})=>[t,n].includes(e.nationalityCode))))||(e.nationalityCode&&c.push(e.nationalityCode),0))));if(!e.length)return{error:_o};s=e}const u=So(s);if(u.length<r){const{maleFirstNames:e,maleLastNames:t,femaleFirstNames:n,femaleLastNames:i,nationalityCodes:o}=aI.reduce(((e,t)=>{const{firstName:n,lastName:i,nationalityCode:r}=t;return t.sex===gg?(e.maleFirstNames.includes(n)||e.maleFirstNames.push(n),e.maleLastNames.includes(i)||e.maleLastNames.push(i)):(e.femaleFirstNames.includes(n)||e.femaleFirstNames.push(n),e.femaleLastNames.includes(i)||e.femaleLastNames.push(i)),e.nationalityCodes.includes(r)||e.nationalityCodes.push(r),e}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Eo(0,r-u.length).forEach((()=>{const r=a||To([gg,Ig]),s=To(o),c={firstName:To(r===gg?e:n),lastName:To(r===gg?t:i),sex:r,nationalityCode:s};u.push(c)}))}const{ageMinDate:d,ageMaxDate:l}=xu({consideredDate:t,category:o}),p=parseInt((null==d?void 0:d.slice(0,4))||0)||parseInt((null==l?void 0:l.slice(0,4))||0)-3,m=parseInt((null==l?void 0:l.slice(0,4))||0)||parseInt((null==d?void 0:d.slice(0,4))||0)+3,f=(d||l)&&[p,m],h=u.slice(0,r).map(((t,i)=>{const r=f&&Mo(Eo(...f)),o=Mo(Eo(0,365)),a=r&&function(e,t,n){const i=new Date(e,0);return Aa(new Date(i.setDate(t)),void 0)}(r,o);return Object.assign(Za({extensions:e||[{name:"regionCode",value:i+1}],birthDate:a,isMock:n}),t)}));return{persons:h.length&&h||u[0],nationalityCodes:c}}function cI(e){const{cities:t,states:n,postalCodes:i,nationalityCode:r,participantIndex:o}=e;return{city:t&&t[o],state:n&&n[o],postalCode:i&&i[o],countryCode:r}}var uI=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function dI({count:e=1}={}){const t=So(uI).slice(0,e);return t.length<e&&Eo(0,e-t.length).forEach((e=>t.push(`Team ${e+1}`))),{teams:t}}var lI=[{AL:"Alabama"},{AK:"Alaska"},{AZ:"Arizona"},{AR:"Arkansas"},{CA:"California"},{CO:"Colorado"},{CT:"Connecticut"},{DE:"Delaware"},{DC:"District of Columbia"},{FL:"Florida"},{GA:"Georgia"},{HI:"Hawaii"},{ID:"Idaho"},{IL:"Illinois"},{IN:"Indiana"},{IA:"Iowa"},{KS:"Kansas"},{KY:"Kentucky"},{LA:"Louisiana"},{ME:"Maine"},{MD:"Maryland"},{MA:"Massachusetts"},{MI:"Michigan"},{MN:"Minnesota"},{MS:"Mississippi"},{MO:"Missouri"},{MT:"Montana"},{NE:"Nebraska"},{NV:"Nevada"},{NH:"New Hampshire"},{NJ:"New Jersey"},{NM:"New Mexico"},{NY:"New York"},{NC:"North Carolina"},{ND:"North Dakota"},{OH:"Ohio"},{OK:"Oklahoma"},{OR:"Oregon"},{PA:"Pennsylvania"},{RI:"Rhode Island"},{SC:"South Carolina"},{SD:"South Dakota"},{TN:"Tennessee"},{TX:"Texas"},{UT:"Utah"},{VT:"Vermont"},{VA:"Virginia"},{WA:"Washington"},{WV:"West Virginia"},{WI:"Wisconsin"},{WY:"Wyoming"},{PR:"Puerto Rico"}],pI=["Adairsville","Ashburn","Ashland","Audubon Park","Aurora","Bay Minette","Bayville","Bean Station","Becket","Belle Isle","Bellmead","Belville","Benld","Benton","Boaz","Bolivar","Bossier City","Bremen","Brent","Brentwood","Brownsville","Burns","Cairo","Caledonia","Cambridge","Canutillo","Central Garage","Centralia","Cherry Valley","Chester Center","Chesterfield","Cibecue","Cohoe","Collinsville","Columbus","Corcoran","Cuba","Dolgeville","Douglas","Druid Hills","Dyker Heights","Eagar","East Dubuque","East Valley","Edgefield","Eliot","Elizabeth","Elmsford","Emerald Isle","Emory","Estero","Fairmount","Falcon Heights","Falmouth","Fillmore","Flower Hill","Fobes Hill","Fort Valley","Franklin","Freeport","Gardnertown","Gates Mills","Glasgow Village","Goldsboro","Grant-Valkaria","Greenfield","Gretna","Guilford Siding","Hampton Falls","Harrisonville","Hart","Haskins","Hebron","Hennepin","Highgrove","Homerville","Homewood","Hooksett","Inwood","Island Lake","Issaquah","Jasper","Jefferson","Jewell","Kaukauna","Kings Grant","Kingston","Kirkland","Kokomo","Koloa","La Center","LaBelle","Lake Placid","Lake Waccamaw","Laughlin","LaVerkin","Leadville North","Leland","Long Creek","Longmeadow","Luttrell","Magnolia","Malvern","Mar-Mac","Marana","Marble Falls","Martin","Martindale","Martinsburg","Mazomanie","Mechanicsville","Mexico Beach","Middletown","Mobile","Moravian Falls","Morehead","Mount Hermon","Mulberry","Munhall","Nettleton","Newton","North Granby","North Highlands","Northern Cambria","Northwest Harwinton","Nurillo","Oasis","Orlando","Osceola","Otis","Pacolet","Palm Beach Gardens","Paoli","Patton Village","Paw Paw Lake","Pearl River","Pine Bluffs","Pine","Pioneer","Port Hadlock-Irondale","Porter","Potsdam","Price","Princess Anne","Princeville","Red Oak","Richfield","Ridge Wood Heights","Ringwood","Robinwood","Rochester","Rockland","Rockwell City","Roland","Rolling Hills","Ruskin","Saint Anthony","Saint Robert","Salisbury","Sauk Rapids","Sayreville Junction","Sedona","Shawnee","Shenandoah","Silver Lake","South Waverly","Southwest Ranches","Southwick","Spring Green","Spring Valley","Spry","Strawberry Point","Terryville","Texico","Thomson","Tonganoxie","Townsend","Trinity","Union City","Van Buren","Verona Walk","Villa Rica","Warrenton","Warroad","Washington, D.C.","Weaverville","Wescosville","West Clarkston-Highland","West Orange","Williamsport","Windsor","Winnsboro","Woodbridge","Woodmoor","Wyoming","Zeeland"];function mI({count:e=1,participantsCount:t=32}={}){const n=So(pI),i=n.slice(0,e);return{cities:Eo(0,t).map((t=>t<Math.min(e,n.length)?i[t]:To(i)))}}function fI({count:e=1,participantsCount:t=32}={}){const n=So(lI),i=n.slice(0,e).map((e=>Object.keys(e))).flat();return{states:Eo(0,t).map((t=>t<Math.min(e,n.length)?i[t]:To(i)))}}function hI({count:e=1,participantsCount:t=32}={}){const n=Eo(0,e).map((()=>Eo(0,5).map((()=>go(0,9))).join("")));return{postalCodes:Eo(0,t).map((t=>t<e?n[t]:To(n)))}}function vI({scoreString:e,tiebreakTo:t=7}){return e.split(" ").filter(Boolean).map(((e,n)=>function({set:e,setNumber:n}){const i=(null==e?void 0:e.startsWith("["))&&e.split("[")[1].split("]")[0].split("-").map((e=>parseInt(e))),r=e.includes("(")?e.split("(")[0]:e.includes("[")?e.split("[")[0]:e,o=!i&&r.split("-").map((e=>parseInt(e))),a=i?i[0]>i[1]?1:i[0]<i[1]?2:void 0:o[0]>o[1]?1:o[0]<o[1]?2:void 0,s=e.includes("(")&&e.split("(")[1].split(")")[0],c=![!1,void 0].includes(s)&&vc({isSide1:2===a,lowValue:s,tiebreakTo:t})||[],[u,d]=o||[],[l,p]=i||c||[];return{side1Score:u,side2Score:d,side1TiebreakScore:l,side2TiebreakScore:p,winningSide:a,setNumber:n}}({set:e,setNumber:n+1})))}function gI({scoreString:e,winningSide:t,matchUpStatus:n}){if(!e)return{outcome:h(f({},wp),{winningSide:t,matchUpStatus:n})};if(t&&![1,2,void 0].includes(t))return{error:_o,winningSide:t};const i=e&&vI({scoreString:e}),r={},o=Gc({sets:i}),a=Gc({sets:i,reversed:!0});return 2===t?(r.scoreStringSide1=a,r.scoreStringSide2=o):(r.scoreStringSide1=o,r.scoreStringSide2=a),r.sets=vI({scoreString:r.scoreStringSide1}),{outcome:{matchUpStatus:n,winningSide:t,score:r}}}const II={[to]:2,[Yr]:1,[Qr]:1,[Kr]:4};function yI({matchUpFormat:e="SET3-S:6/TB7",matchUpStatusProfile:t=II,pointsPerMinute:n=1,sideWeight:i=4,winningSide:r,defaultWithScorePercent:o=2}){if(!$r(e))return{error:"Invalid matchUpFormat"};if("object"!=typeof t)return{error:_o};if(o>100&&(o=100),isNaN(o)||isNaN(n)||isNaN(i))return{error:_o};const a=Object.keys(t).filter((e=>Object.keys(uo).includes(e)&&e!==Hr));if(Object.keys(a).reduce(((e,n)=>e+t[n]),0)>100)return{error:_o,matchUpStatusProfile:t};const s=a.reduce(((e,n)=>(e.pointer=e.pointer+t[n],e.valueMap.push([e.pointer,n]),e)),{pointer:0,valueMap:[]}),c=go(1,100),u=(s.valueMap.find((e=>c<=e[0]))||[100,Hr])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([to,Kr].includes(u)){const e={score:d,winningSide:r=r||go(1,2),matchUpStatus:u};if(!(u===Kr&&go(1,100)>100-o))return{outcome:e}}else if(u===Yr)return{outcome:{score:d,matchUpStatus:u}};const l=kr(e),{bestOf:p,setFormat:m,finalSetFormat:f}=l,h=[],v=go(0,1),g=r?[r-1]:[...Eo(0,i).map((()=>v)),1-v],I=[Qr,Kr,Zr,Xr].includes(u)&&(Mo(Eo(1,p))||1);let y;for(const S of Eo(1,p+1)){const t=S===p,{set:i,incomplete:r,winningSideNumber:o}=wI({incomplete:I===S,matchUpStatus:u,pointsPerMinute:n,setFormat:t&&f||m,setNumber:S,weightedRange:g});if(h.push(i),r){y=o;break}if(Hc({matchUp:{score:{sets:h},matchUpFormat:e}}).calculatedWinningSide)break}const w=Hc({matchUp:{score:{sets:h},matchUpFormat:e}}),U=y?r||y:w.calculatedWinningSide,{score:b}=rm({score:{sets:h},winningSide:U,matchUpStatus:u});return{outcome:{score:b,winningSide:U,matchUpStatus:u}}}function wI({weightedRange:e=[0,1],pointsPerMinute:t,matchUpStatus:n,incomplete:i,setFormat:r,setNumber:o}){const a={setNumber:o},{setTo:s,tiebreakFormat:c,tiebreakAt:u,tiebreakSet:d,timed:l,minutes:p}=r,m=go(0,e.length-1),f=e[m];let h;if(l){const r=p*t,o=Math.round(.2*r),s=r+Mo([1,-1])*o,c=function(e=1,t=3,n=!0){let i=0;for(let r=0;r<t;r++)i+=Math.random()*(e/t);return n&&e>1?Math.round(i):i}(s,2),u=[c,s-c];f&&u.reverse(),h=e[m]+1;let d=u[0]>u[1]?1:u[1]>u[0]?2:0;if(i){const[e,t]=u;return Object.assign(a,{side1Score:e,side2Score:t}),ao.includes(n)?{set:a,incomplete:i,winningSideNumber:h}:{set:a,incomplete:i}}d||(u[go(0,1)]+=1),d=u[0]>u[1]?1:2,d!==h&&u.reverse();const[l,v]=u;return Object.assign(a,{side1Score:l,side2Score:v,winningSide:h}),{set:a}}if(i)return a.side1Score=go(0,u),a.side2Score=go(0,u),ao.includes(n)&&(h=e[m]+1),{set:a,incomplete:i,winningSideNumber:h};{const t=Eo(1,s+1).map((e=>Eo(0,s+2-e).map((()=>e)))).flat(),n=t[go(0,t.length-1)],i=s&&hc({isSide1:!0,tiebreakAt:u,lowValue:n,setTo:s}),o=!i,l=1===e.length&&e[m]+1;if(!o){l?(i[0]>i[1]?1:2)!==l&&i.reverse():f&&i.reverse();const[e,t]=i;Object.assign(a,{side1Score:e,side2Score:t})}const p=zc({matchUpScoringFormat:{setFormat:r},setObject:a});let h;if(p.hasTiebreakCondition||o){const{NoAD:e,tiebreakTo:t}=c||d||{},n=Eo(1,t+1).map((e=>Eo(0,t+2-e).map((()=>e)))).flat(),i=n[go(0,n.length-1)];let r=vc({isSide1:!0,lowValue:i,tiebreakTo:t,tiebreakNoAd:e});if(o){const e=r[0]>r[1]?1:2;l?e!==l&&r.reverse():f&&r.reverse(),[a.side1TiebreakScore,a.side2TiebreakScore]=r,h=r[0]>r[1]?1:2}else 2===p.leadingSide?[a.side1TiebreakScore,a.side2TiebreakScore]=r:[a.side2TiebreakScore,a.side1TiebreakScore]=r}a.winningSide=p.winningSide||p.leadingSide||l||h}return{set:a}}function UI({matchUpStatusProfile:e,completeAllMatchUps:t,randomWinningSide:n,drawDefinition:i,completionGoal:r,matchUpFormat:o,event:a}){const s=i.structures.slice().sort(od);let c=0;const u="string"==typeof t&&t,d=u&&Hr;for(const l of s){const t=id({drawDefinition:i}),{matchUps:s}=Xd({inContext:!0,drawDefinition:i,matchUpsMap:t,structure:l,event:a}),p=s.filter((({winningSide:e})=>!e)).sort(op).map(ed);for(const m of p){if(!isNaN(r)&&c>=r)break;const{matchUps:s}=Xd({inContext:!0,drawDefinition:i,matchUpsMap:t,structure:l,event:a}),p=s.find((e=>e.matchUpId===m)),f=p.matchUpStatus===Yr;if(null!=p&&p.readyToScore&&!f){const t=SI({winningSide:!n&&1,matchUpStatusProfile:e,drawDefinition:i,targetMatchUp:p,matchUpFormat:o,matchUpStatus:d,scoreString:u});if(t.error)return t;c+=1}}}return h(f({},ko),{completedCount:c})}function bI({matchUpStatusCodes:e,drawDefinition:t,targetMatchUp:n,matchUpStatus:i,matchUpFormat:r,scoreString:o,winningSide:a}){if(!n||n.matchUpStatus===qr)return;const{matchUpId:s}=n||{},{outcome:c}=gI({matchUpStatus:i,scoreString:o,winningSide:a});return e&&(c.matchUpStatusCodes=e),om({drawDefinition:t,matchUpFormat:r,matchUpId:s,outcome:c})}function SI(e){const{matchUpStatusProfile:t={},drawDefinition:n,matchUpStatus:i,matchUpFormat:r,targetMatchUp:o,scoreString:a,winningSide:s}=e;if(a||i)return bI(e);const{matchUpId:c}=o||{},{outcome:u}=yI({matchUpStatusProfile:t,matchUpFormat:r,winningSide:s});return om({matchUpFormat:r,drawDefinition:n,matchUpId:c,outcome:u})}function PI({matchUpStatusProfile:e,completeAllMatchUps:t,randomWinningSide:n,tournamentRecord:i,drawProfiles:r,event:o}){const{flightProfile:a}=yp({event:o}),{eventName:s,eventType:c,category:u}=o,{startDate:d}=i,l=[],p=(null==u?void 0:u.categoryName)||(null==u?void 0:u.ageCategoryCode)||(null==u?void 0:u.ratingType);if(Array.isArray(null==a?void 0:a.flights))for(const[v,g]of a.flights.entries()){const{drawId:a,stage:u,drawName:I,drawEntries:y}=g;l.push(g.drawId);const w=r[v],{seedsCount:U,generate:b=!0}=w||{};if(b){var m;const l=y.filter(gp).map(Qu),g=p||s;i&&U&&U<=l.length&&Eo(1,U+1).forEach(((e,t)=>{let n={scaleValue:e,scaleName:g,scaleType:"SEEDING",eventType:c,scaleDate:d};const r=l[t];ug({tournamentRecord:i,participantId:r,scaleItem:n})}));let b=zg(h(f({},w),{matchUpType:c,seedingScaleName:g,tournamentRecord:i,isMock:!0,drawEntries:y,drawName:I,drawId:a,event:o,stage:u}));const{drawDefinition:S,error:P}=b;if(P)return{error:P};const D=null===(m=r[v])||void 0===m?void 0:m.drawExtensions;if(Array.isArray(D)&&D.filter(cd).forEach((e=>ud({element:S,extension:e}))),b=wm({drawDefinition:S,event:o}),"drawId exists"===b.error)break;if(b.error)return b;if(w.drawType===uu&&w.drawMatic){const e=w.roundsCount||1;for(const t of Eo(1,e+1)){const e=Qg({generateMatchUps:!0,tournamentRecord:i,drawDefinition:S,roundNumber:t});if(e.error)return e}}if(null!=w&&w.withPlayoffs){const e=S.structures[0].structureId,t=Kg(h(f({idPrefix:w.idPrefix},w.withPlayoffs),{tournamentRecord:i,drawDefinition:S,isMock:!0,structureId:e,event:o}));if(null!=t&&t.error)return t}const N=null==w?void 0:w.completionGoal;if(!1!==(null==w?void 0:w.automated)&&(t||N)){const r=null==w?void 0:w.matchUpFormat,a=UI({matchUpStatusProfile:e,completeAllMatchUps:!N&&t,randomWinningSide:n,completionGoal:N,drawDefinition:S,matchUpFormat:r});if(a.error)return a;const s=a.completedCount;if((null==w?void 0:w.drawType)===yu){let a=Lg({structureId:S.structures.find((e=>e.stage===eu)).structureId,tournamentRecord:i,drawDefinition:S,event:o});if(a.error)return a;const c=N?N-s:void 0;if(a=UI({completeAllMatchUps:!N&&t,completionGoal:N?c:void 0,matchUpStatusProfile:e,randomWinningSide:n,drawDefinition:S,matchUpFormat:r}),a.error)return a}}}}return h(f({},ko),{drawIds:l})}function DI({ratingsParameters:e=og,valuesInstanceLimit:t,consideredDate:n,category:i,nationalityCodesCount:r,nationalityCodeType:o,nationalityCodes:a,participantsCount:s=32,participantType:c,personIds:u,idPrefix:d,uuids:l,personExtensions:p,addressProps:m,matchUpType:v,personData:g,sex:I,inContext:y,withISO:w,rankingRange:U=[1,100],scaledParticipantsCount:b}){const S=c===pc||v===js,P=c===lc||v===lc,D=s*(S?2:P?8:1),{nationalityCodes:N,persons:M,error:T}=sI({count:D,personExtensions:p,consideredDate:n,personData:g,category:i,sex:I});if(T)return{error:T};let E=[],A=[],R=[],C=[];if("object"==typeof i){const{categoryName:t,ageCategoryCode:n,ratingType:r}=i;if(!t&&!n||r||(A=So(Eo(...U)).slice(0,b||go(20,30)),[pc,lc].includes(c)&&(E=So(Eo(...U)).slice(0,b||go(20,30)))),r&&e[r]){let{ratingMax:t,ratingMin:n,ratingAttributes:o}=i;const a=Object.assign({},e[r],o||{}),{attributes:s={},decimalsCount:u,accessors:d,range:l,step:p}=a,m=l[0]>l[1]?2:.5,[f,h]=l.slice().sort(),v=()=>Eo(0,1e3).map((()=>yo(f,h,m,u,p))).filter((e=>(!t||e<=t)&&(!n||e>=n))).slice(0,b||go(20,30)).map((e=>d?Object.assign({},...d.map((t=>({[t]:e}))),s):e));R=v(),[pc,lc].includes(c)&&(C=v())}}const x=Yc.filter((e=>"ISO"===o?e.iso:e.ioc)),{citiesCount:O,statesCount:k,postalCodesCount:F}=m||{},{cities:L}=mI({count:O||D,participantsCount:D}),{states:j}=fI({count:k||D,participantsCount:D}),{postalCodes:B}=hI({count:F||D,participantsCount:D}),V={cities:L,states:j,postalCodes:B},$=function(e){const n=Math.ceil(D/e);return t&&n>t?Math.ceil(D/t):e}(r),G=$?So(x).slice(0,r):a?x.filter((e=>a.includes(e.key))):x,_=So(Eo(0,Math.ceil(D/($||1))).map((()=>G)).flat(1/0)),W=dI({count:s}).teams;return{participants:Eo(0,s).map((e=>{const t=S?2:P?8:1,n=Eo(0,t).map((n=>function(e){const t=M[e],{nationalityCode:n,participantExtensions:r,participantTimeItems:a,extensions:s,firstName:c,birthDate:p,lastName:m,personId:v,sex:g}=t||{},I=c||"GivenName",y=m||"FamilyName",U=`${I} ${y}`,b=_[e],S=(null==N?void 0:N.length)&&n||b&&("ISO"===o?b.iso:b.ioc||b.iso)||n;null==_||!_.length||S||n||console.log("%c Invalid Nationality Code",{participantIndex:e,country:b});const P=cI(h(f({},V),{participantIndex:e,nationalityCode:S})),D=Za({participantId:MI({participantType:dc,index:e,idPrefix:d,uuids:l}),extensions:r,timeItems:a,participantRole:Af,participantType:dc,participantName:U,person:{addresses:[P],personId:v||(null==u?void 0:u.length)&&u[e]||es(),standardFamilyName:y,standardGivenName:I,nationalityCode:S,extensions:s,birthDate:Ta(p)?p:void 0,sex:g}});if(w&&S){const e=Yc.find((({ioc:e})=>e===S));null!=e&&e.iso&&(D.person.isoNationalityCode=e.iso),null!=e&&e.label&&(D.person.countryName=e.label)}if(i){const t=A[e],n=E[e];NI({scaleValue:t,eventType:Js,scaleType:Om,participant:D,category:i}),NI({scaleValue:n,eventType:js,scaleType:Om,participant:D,category:i});const r=R[e],o=C[e];NI({scaleValue:r,eventType:Js,scaleType:xm,participant:D,category:i}),NI({scaleValue:o,eventType:js,scaleType:xm,participant:D,category:i})}return D}(e*t+n))),r=n.map((e=>e.participantId)),a=n.map((e=>e.person.standardFamilyName)).join("/"),s=S?pc:lc,c={participantId:MI({participantType:s,idPrefix:d,index:e,uuids:l}),participantRole:Af,participantName:S?a:W[e],individualParticipantIds:r,participantType:s};return y&&(c.individualParticipants=n),S||P?[c,...n]:n})).flat()}}function NI({scaleValue:e,participant:t,eventType:n,scaleType:i,category:r}){const o=r.categoryName||r.ratingType||r.ageCategoryCode,a={itemValue:e,itemType:[Cm,i,n,o].join(".")};o&&e&&(t.timeItems||(t.timeItems=[]),t.timeItems.push(a))}function MI({idPrefix:e,participantType:t,index:n,uuids:i}){return e?`${e}-${t===dc?"I":"P"}-${n}`:(null==i?void 0:i.pop())||es()}function TI({tieFormat:e,tieFormatName:t,drawSize:n,alternatesCount:i=0}){var r,o;let a=0,s=0;null===(r=e="object"==typeof e?e:kg({namedFormat:t}))||void 0===r||null===(o=r.collectionDefinitions)||void 0===o||o.forEach((e=>{if(e.collectionId||(e.collectionId=es()),(null==e?void 0:e.matchUpType)===js){const t=e.matchUpCount;a=Math.max(a,t)}if((null==e?void 0:e.matchUpType)===Ls){const t=e.matchUpCount;s=Math.max(s,t)}}));const c=Math.max(s,2*a);return{maxDoublesDraw:a*(n+i),maxSinglesDraw:s*(n+i),teamSize:c}}function EI({participantsProfile:e={},tournamentRecord:t,eventProfiles:n,drawProfiles:i,startDate:r,uuids:o}){const{participantsCount:a,participantType:s,largestTeamDraw:c,largestTeamSize:u}=function({participantsProfile:e,eventProfiles:t,drawProfiles:n}){let{participantsCount:i,participantType:r=dc}=e||{};const o=i||0;let a=0,s=0,c=0,u=0,d=0;const l=({alternatesCount:e=0,uniqueParticipants:t,tieFormatName:n,drawSize:i=0,eventType:r,tieFormat:o,category:l,gender:p,stage:m})=>{const f=r===Zs,h=r===Qs;if(t||m===tu||l||p)d+=f?2*(i+e):i+e;else{if(h){u=Math.max(u,i+e),o="object"==typeof o?o:kg({namedFormat:n});const{teamSize:t,maxDoublesDraw:r,maxSinglesDraw:d}=TI({alternatesCount:e,tieFormatName:n,tieFormat:o,drawSize:i});c=Math.max(c,t),a=Math.max(a,r),s=Math.max(s,d)}f&&i+e&&i+e>a&&(a=i+e),!f&&!h&&i&&i>s&&(s=i+e)}};if(null==t||t.forEach((e=>{const{tieFormatName:t,tieFormat:n,drawProfiles:i,eventType:r,category:o,gender:a}=e;if(i)for(const s of i){const{tieFormatName:e,tieFormat:i}=s;l(h(f({},s),{tieFormatName:e||t,tieFormat:i||n,eventType:r,category:o,gender:a}))}})),Array.isArray(n))for(const m of n)l(m);const p=Math.max(u*c,2*a,s);return a&&(r=pc),(i||o)<p&&(i=p),i&&a&&[pc,Qs].includes(r)&&(s&&Math.floor(s/2)>a?i=Math.floor(s/2):(!s||2*a>=s)&&(i=Math.ceil(i/2))),void 0===i&&(i=null!=t&&t.length||null!=n&&n.length?0:32),i<o&&(i=o),{largestTeamDraw:u,largestTeamSize:c,participantsCount:i,participantType:r,uniqueParticipantsCount:d}}({participantsProfile:e,eventProfiles:n,drawProfiles:i}),{teamKey:d}=e||{},{participants:l}=DI(h(f({uuids:o},e),{consideredDate:r,participantsCount:a,participantType:s}));let p=Sm({tournamentRecord:t,participants:l});if(!p.success)return p;if(d){const e=vg(f({tournamentRecord:t},d));if(e.error)return e}const m=l.filter((({participantType:e})=>e===dc)).map(Qu);return Sm({tournamentRecord:t,participants:Eo(0,c).map((e=>{const t=m.slice(e*u,(e+1)*u);return{participantName:`Team ${e+1}`,participantRole:Af,participantType:lc,participantId:es(),individualParticipantIds:t}}))})}function AI({participantsProfile:e={},uniqueParticipantsCount:t,ratingsParameters:n,tournamentRecord:i,eventProfile:r,eventIndex:o,event:a,uuids:s}){const{category:c,gender:u,eventType:d}=a,l=d===Js?dc:d===Zs?pc:d,p=(t[eu]||0)+(t[tu]||0),m=[gg,Ig].includes(u)?u:void 0,v=null!=e&&e.idPrefix?`E-${o}-${null==e?void 0:e.idPrefix}`:void 0,{participants:g}=DI(h(f({uuids:r.uuids||s},e),{scaledParticipantsCount:r.scaledParticipantsCount,consideredDate:null==i?void 0:i.startDate,rankingRange:r.rankingRange,participantType:l,participantsCount:p,ratingsParameters:n,idPrefix:v,category:c,sex:m}));let I=Sm({participants:g,tournamentRecord:i});return I.error?I:{uniqueDrawParticipants:g.filter((({participantType:e})=>e===l)),uniqueParticipantIds:g.map(Qu)}}function RI({drawProfiles:e,category:t,gender:n}){const i={},r=null==e?void 0:e.reduce(((e,r)=>{const{qualifyingPositions:o=0,participantsCount:a=0,uniqueParticipants:s,stage:c=eu,drawSize:u=0}=r||{};Object.keys(e).includes(c)||(e[c]=0);const d=(a||u)-o;return s||n||t||c===tu?(Object.keys(i).includes(c)||(i[c]=0),i[c]+=d):e[c]=Math.max(d,e[c]),e}),{}),o=Object.keys(i);return o.forEach((e=>r[e]+=i[e])),{stageParticipantsCount:r,uniqueParticipantsCount:i,uniqueParticipantStages:o}}function CI({allUniqueParticipantIds:e,stageParticipantsCount:t,eventParticipantType:n,targetParticipants:i}){const r=t[eu]||0,o=t[tu]||0;return{stageParticipants:{QUALIFYING:i.filter((({participantType:e})=>e===n)).filter((({participantId:t})=>!e.includes(t))).slice(0,o),MAIN:i.filter((({participantType:e})=>e===n)).filter((({participantId:t})=>!e.includes(t))).slice(o,o+r)}}}function xI({autoEntryPositions:e,tournamentRecord:t,drawParticipants:n,drawProfile:i,event:r}){const{drawType:o=lu,qualifyingPositions:a=0,stage:s=eu,drawSize:c=0,drawName:u,drawId:d}=i,l=c-a,p=n.slice(0,l).map(Qu);if(p.length){const n=wv({participantIds:p,autoEntryPositions:e,tournamentRecord:t,stage:s,event:r});if(n.error)return n}const m=Xg({drawName:u||o,qualifyingPositions:a,drawEntries:p.map((e=>({entryStatus:Sd,entryStage:s,participantId:e}))),drawId:d,event:r,stage:s});return m.error?m:f({},ko)}function OI({uniqueDrawParticipants:e,autoEntryPositions:t,stageParticipants:n,tournamentRecord:i,drawProfiles:r,category:o,gender:a,event:s}){let c=0;for(const u of r){const{qualifyingPositions:r=0,uniqueParticipants:d,stage:l=eu,drawSize:p=0}=u,m=p-r,f=d||a||o||l===tu,h=f?e.slice(c,c+m):n[l||eu]||[];f&&(c+=m);const v=xI({autoEntryPositions:t,drawParticipants:h,tournamentRecord:i,drawProfile:u,event:s});if(v.error)return v}return f({},ko)}function kI({allUniqueParticipantIds:e,matchUpStatusProfile:t,participantsProfile:n,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:o,ratingsParameters:a,tournamentRecord:s,eventProfile:c,eventIndex:u,publish:d,uuids:l}){let p=c.gender,m=c.eventName;const{eventType:v=Js,policyDefinitions:g,drawProfiles:I=[],eventExtensions:y,surfaceCategory:w,tieFormatName:U,discipline:b,eventLevel:S,ballType:P,category:D}=c,N=c.tieFormat||(v===Qs?kg({namedFormat:U}):void 0);let M=s.participants;for(const f of I)!p&&f.gender&&(p=null==f?void 0:f.gender);const{stageParticipantsCount:T,uniqueParticipantsCount:E,uniqueParticipantStages:A}=RI({drawProfiles:I,category:D,gender:p}),R=v===Js?dc:v===Zs?pc:v,{uniqueDrawParticipants:C=[],uniqueParticipantIds:x=[]}=A?AI({event:{eventType:v,category:D,gender:p},uniqueParticipantsCount:E,participantsProfile:n,ratingsParameters:a,tournamentRecord:s,eventProfile:c,eventIndex:u,uuids:l}):{};let{eventAttributes:O}=c;"object"!=typeof O&&(O={});const k=(null==D?void 0:D.categoryName)||(null==D?void 0:D.ageCategoryCode)||(null==D?void 0:D.ratingType),F=c.eventId||es();m=m||k||"Generated Event";const L=h(f({},O),{surfaceCategory:w,discipline:b,eventLevel:S,eventName:m,eventType:v,tieFormat:N,ballType:P,category:D,eventId:F,gender:p});if(null!=y&&y.length&&Array.isArray(y)){const e=y.filter(cd);null!=e&&e.length&&Object.assign(L,{extensions:e})}if("object"==typeof g)for(const f of Object.keys(g))qf({policyDefinitions:{[f]:g[f]},event:L});let j=Fg({tournamentRecord:s,event:L});if(j.error)return j;const{event:B}=j,{stageParticipants:V}=CI({allUniqueParticipantIds:e,stageParticipantsCount:T,eventParticipantType:R,targetParticipants:M});if(j=OI({uniqueDrawParticipants:C,autoEntryPositions:r,stageParticipants:V,tournamentRecord:s,drawProfiles:I,category:D,gender:p,event:B}),j.error)return j;if(j=PI({completeAllMatchUps:i,matchUpStatusProfile:t,randomWinningSide:o,tournamentRecord:s,drawProfiles:I,event:B}),j.error)return j;const $=j.drawIds;return d&&Pg({tournamentRecord:s,event:B}),{drawIds:$,eventId:F,uniqueParticipantIds:x}}function FI({allUniqueParticipantIds:e=[],participantsProfile:t={},matchUpStatusProfile:n,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:o,ratingsParameters:a,tournamentRecord:s,drawProfile:c,startDate:u,drawIndex:d,goesTo:l,uuids:p}){var m;const{excessParticipantAlternates:v=!0,matchUpFormat:g=_r,drawType:I=lu,tournamentAlternates:y=0,alternatesCount:w=0,generate:U=!0,eventExtensions:b,drawExtensions:S,completionGoal:P,drawSize:D=32,tieFormatName:N,seedsCount:M,category:T,idPrefix:E,publish:A,gender:R,stage:C}=c,x=c.eventType||c.matchUpType||Js,O="object"==typeof c.tieFormat?c.tieFormat:x===lc?kg({namedFormat:N}):void 0,k=(null==T?void 0:T.categoryName)||(null==T?void 0:T.ageCategoryCode)||(null==T?void 0:T.ratingType);let F=c.eventName||k||`Generated ${x}`,L=(null==s?void 0:s.participants)||[];const j=!c.participantsCount||c.participantsCount>D?D:c.participantsCount,B=es();let V={eventName:F,eventType:x,tieFormat:O,category:T,eventId:B},{eventAttributes:$}=c;if("object"!=typeof $&&($={}),Object.assign(V,$),null!=b&&b.length&&Array.isArray(b)){const e=b.filter(cd);null!=e&&e.length&&Object.assign(V,{extensions:e})}const G=[];if(c.uniqueParticipants||!s||R||T){let e,n=j+w;x===lc&&(({teamSize:e}=TI({alternatesCount:w,tieFormatName:N,tieFormat:O,drawSize:D})),n=e*D);const i=null!=t&&t.idPrefix?`D-${d}-${null==t?void 0:t.idPrefix}`:void 0,r=x===Zs?pc:dc,{participants:o}=DI(h(f({},t),{scaledParticipantsCount:c.scaledParticipantsCount,participantsCount:n,consideredDate:null==s?void 0:s.startDate,sex:R||(null==t?void 0:t.sex),rankingRange:c.rankingRange,uuids:c.uuids||p,ratingsParameters:a,participantType:r,idPrefix:i,category:T}));if(s){const e=Sm({tournamentRecord:s,participants:o});if(e.error)return e}if(o.forEach((({participantId:e})=>G.push(e))),L=o,x===lc){const t=o.filter((({participantType:e})=>e===dc)).map(Qu),n=Eo(0,D).map((n=>{const i=t.slice(n*e,(n+1)*e);return{participantName:`Team ${n+1}`,participantRole:Af,participantType:lc,participantId:es(),individualParticipantIds:i}})),i=Sm({participants:n,tournamentRecord:s});if(!i.success)return i;L=n}}const _=e=>{const{participantType:t}=e;return x===Js&&t===dc||x===Zs&&t===pc||x===lc&&t===lc},W=e=>{var t,n;return!c.gender||(null===(t=e.person)||void 0===t?void 0:t.sex)===c.gender||!(null===(n=e.individualParticipantIds)||void 0===n||!n.some((e=>{const t=L.find((t=>t.participantId===e));return t&&W(t)})))||void 0},q=L.filter(_).filter(W).filter((({participantId:t})=>!e.includes(t))).slice(0,j).map((e=>e.participantId));if(null!=q&&q.length){const e=wv({autoEntryPositions:r,entryStage:C,tournamentRecord:s,participantIds:q,event:V});if(e.error)return e}const z=v&&(null==s||null===(m=s.participants)||void 0===m?void 0:m.filter((({participantId:e})=>!q.includes(e))).filter(_).filter(W).slice(0,w||D-j||y).map((e=>e.participantId)));if(null!=z&&z.length){const e=wv({participantIds:z,autoEntryPositions:!1,entryStatus:yd,tournamentRecord:s,event:V});if(e.error)return{error:e.error}}const H=k||F;s&&M&&M<=q.length&&Eo(1,M+1).forEach(((e,t)=>{let n={scaleValue:e,scaleName:H,scaleType:"SEEDING",eventType:x,scaleDate:u};const i=q[t];ug({tournamentRecord:s,participantId:i,scaleItem:n})}));const{drawDefinition:K,error:Y}=zg(h(f({},c),{tournamentRecord:s,seedingScaleName:H,matchUpFormat:g,isMock:!0,eventId:B,goesTo:l,event:V}));if(Y)return{error:Y};const J=U?K.drawId:void 0;if(Array.isArray(S)&&S.filter(cd).forEach((e=>ud({element:K,extension:e}))),U){if(wm({drawDefinition:K,event:V}),I===uu&&c.drawMatic){const e=c.roundsCount||1;for(const t of Eo(1,e+1)){const e=Qg({generateMatchUps:!0,tournamentRecord:s,drawDefinition:K,roundNumber:t});if(e.error)return e}}if(c.withPlayoffs){const e=K.structures[0].structureId,t=Kg(h(f({},c.withPlayoffs),{tournamentRecord:s,drawDefinition:K,isMock:!0,structureId:e,idPrefix:E,event:V}));if(null!=t&&t.error)return t}if(!1!==c.automated){if(c.outcomes){const{matchUps:e}=Tl({drawDefinition:K,inContext:!0,event:V});for(const t of c.outcomes){const{roundNumber:n,drawPositions:i,roundPosition:r,scoreString:o,winningSide:a,stage:s=eu,matchUpFormat:c,stageSequence:u=1,matchUpStatus:d=Hr,matchUpStatusCodes:l,matchUpIndex:p=0,structureOrder:m}=t,f=e.reduce(((e,t)=>{const{structureId:n,matchUpId:i}=t;return e[n]?e[n].push(i):e[n]=[i],e}),{}),h=Object.assign({},...Object.keys(f).map(((e,t)=>({[e]:t+1})))),v=e.filter((e=>!(s&&e.stage!==s||u&&e.stageSequence!==u||n&&e.roundNumber!==n||r&&e.roundPosition!==r||m&&h[e.structureId]!==m||i&&2!==Ro(i,e.drawPositions).length)))[p],g=bI({matchUpStatusCodes:l,drawDefinition:K,targetMatchUp:v,matchUpFormat:c,matchUpStatus:d,scoreString:o,winningSide:a,drawId:J});if(null!=g&&g.error)return g}}if(i||P){const e=UI({matchUpStatusProfile:n,completeAllMatchUps:i,randomWinningSide:o,completionGoal:P,drawDefinition:K,matchUpFormat:g});if(e.error)return e;const t=e.completedCount;if(I===yu){let e=Lg({structureId:K.structures.find((e=>e.stage===eu)).structureId,tournamentRecord:s,drawDefinition:K,event:V});const r=P?P-t:void 0;if(e=UI({completionGoal:P?r:void 0,matchUpStatusProfile:n,completeAllMatchUps:i,randomWinningSide:o,drawDefinition:K,matchUpFormat:g}),e.error)return e}}}A&&Pg({tournamentRecord:s,event:V})}return h(f({},ko),{event:Za(V),uniqueParticipantIds:G,targetParticipants:L,drawDefinition:K,eventId:B,drawId:J})}function LI({tournamentRecord:e,venueProfiles:t}){const{startDate:n,endDate:i}=e;let r=[];for(const[o,a]of t.entries()){let{venueAbbreviation:t,venueId:s=es(),dateAvailability:c,startTime:u="07:00",endTime:d="19:00",courtsCount:l,courtNames:p,venueName:m,courtIds:f}=a,h=Um({tournamentRecord:e,venue:{venueName:m||`Venue ${o+1}`,venueAbbreviation:t,venueId:s}});if(h.error)return h;r.push(s);const v=xa(n,i);if(c=!Array.isArray(c)&&v.map((e=>({date:Aa(e),startTime:u,endTime:d})))||c,h=vm({tournamentRecord:e,dateAvailability:c,courtsCount:l,courtNames:p,courtIds:f,venueId:s}),h.error)return h}return r}const jI={anonymizeTournamentRecord:function({tournamentRecord:e,tournamentName:t,personIds:n=[],tournamentId:i}){if(!e)return{error:Lo};e.tournamentId=i||es(),e.createdAt=(new Date).toISOString(),e.tournamentName=t||`Anonymized Tournament ${Aa(new Date)}`,delete e.parentOrganisation;const r=e.startDate||Aa(new Date),o=(e.participants||[]).filter((({participantType:e})=>e===dc)),a=o.reduce(((e,t)=>{var n;const i=null===(n=t.person)||void 0===n?void 0:n.sex;return[gg,Ig].includes(i)?e[i]+=1:e.OTHER+=1,e}),{[gg]:0,[Ig]:0,OTHER:0}),s=Object.assign({},...Object.keys(a).map((e=>{var t;return{[e]:(null===(t=sI({category:{ageCategoryCode:"O18"},count:a[e],addressProps:{citiesCount:10},personExtensions:[],consideredDate:r,sex:e}))||void 0===t?void 0:t.persons)||[]}}))),c={[gg]:0,[Ig]:0,OTHER:0},u=o.length,d=o.reduce(((e,t)=>{var n,i;const r=(null===(n=t.person)||void 0===n||null===(i=n.addresses)||void 0===i?void 0:i[0])||{},{city:o,state:a,postalCode:s}=r;return e.cities.includes(o)||e.cities.push(o),e.states.includes(a)||e.states.push(a),e.postalCodes.includes(s)||e.postalCodes.push(s),e}),{cities:[],postalCodes:[],states:[]}),l=d.postalCodes.length,p=d.cities.length,m=d.states.length,{cities:v}=mI({count:p||u,participantsCount:u}),{states:g}=fI({count:m||u,participantsCount:u}),{postalCodes:I}=hI({count:l||u,participantsCount:u}),y={cities:v,states:g,postalCodes:I};o.forEach(((e,t)=>{var i;const r=null==e?void 0:e.person,o=(null==r?void 0:r.sex)||"OTHER",a=null==r||null===(i=r.birthDate)||void 0===i?void 0:i.split("-").reverse()[0],u=c[o],d=s[o][u];if(c[o]+=1,a){var l;const[,e,t]=(null==d||null===(l=d.birthDate)||void 0===l?void 0:l.split("-"))||[],n=[a,e,t].join("-");d.birthDate=n}if(r.addresses){const e=cI(h(f({},y),{participantIndex:t,nationalityCode:d.nationalityCode}));d.addresses=[e]}d.personId=(null==n?void 0:n[t])||es(),d.standardFamilyName=d.lastName,d.standardGivenName=d.firstName,delete d.firstName,delete d.lastName,e.person=d,e.participantName=`${d.standardGivenName} ${d.standardFamilyName}`})),(e.participants||[]).filter((({participantType:e})=>e===pc)).forEach((e=>{const{individualParticipantIds:t}=e;e.participantName=function({individualParticipantIds:e,individualParticipants:t}){let n=t.filter((({participantId:t})=>e.includes(t))).map((({person:e})=>null==e?void 0:e.standardFamilyName)).filter(Boolean).sort().join("/");return 1===e.length&&(n+="/Unknown"),n}({individualParticipantIds:t,individualParticipants:o})}));const w=(e.participants||[]).filter((({participantType:e})=>e===lc)),U=dI({count:w.length}).teams;return w.forEach(((e,t)=>{e.participantName=U[t]})),f({},ko)},modifyTournamentRecord:function({ratingsParameters:e=og,participantsProfile:t={},matchUpStatusProfile:n,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:o,schedulingProfile:a,tournamentRecord:s,eventProfiles:c,venueProfiles:u,autoSchedule:d,drawProfiles:l,goesTo:p,uuids:m}){var v;if(!s)return{error:Lo};const g=[],I=[],y=[];null==c||c.forEach((e=>{const t=s.events.find(((t,n)=>void 0!==e.eventIndex&&n===e.eventIndex||e.eventName&&t.eventName===e.eventName||e.eventId&&t.eventId===e.eventId));null!=t&&t.gender&&(e.gender=t.gender)}));const w=(null===(v=s.participants)||void 0===v?void 0:v.length)||void 0;w&&null!=t&&t.idPrefix&&(t.idPrefix=`${t.idPrefix}-${w}`);const U=EI({startDate:s.startDate,participantsProfile:t,tournamentRecord:s,eventProfiles:c,drawProfiles:l,uuids:m});if(!U.success)return U;if(c){var b;let e=(null===(b=s.events)||void 0===b?void 0:b.length)||0;for(const a of c){let{ratingsParameters:c}=a;const u=s.events.find(((e,t)=>void 0!==a.eventIndex&&t===a.eventIndex||a.eventName&&e.eventName===a.eventName||a.eventId&&e.eventId===a.eventId));if(u){const{gender:e,category:d,eventType:l}=u,{drawProfiles:p,publish:f}=a,h=l===Js?Tm:l===Zs?Em:l;if(p){const{stageParticipantsCount:f,uniqueParticipantsCount:v,uniqueParticipantStages:I}=RI({drawProfiles:p,category:d,gender:e}),{uniqueDrawParticipants:w=[],uniqueParticipantIds:U=[]}=I?AI({event:{eventType:l,category:d,gender:e},uniqueParticipantsCount:v,participantsProfile:t,ratingsParameters:c,tournamentRecord:s,eventProfile:a,uuids:m}):{};g.push(...U);const{stageParticipants:b}=CI({targetParticipants:s.participants||[],allUniqueParticipantIds:g,stageParticipantsCount:f,eventParticipantType:h});let S=OI({uniqueDrawParticipants:w,autoEntryPositions:r,stageParticipants:b,tournamentRecord:s,drawProfiles:p,category:d,gender:e,event:u});if(S.error)return S;if(S=PI({matchUpStatusProfile:n,completeAllMatchUps:i,randomWinningSide:o,tournamentRecord:s,drawProfiles:p,event:u}),S.error)return S;y.push(...S.drawIds)}f&&Pg({tournamentRecord:s,event:u})}else{const{error:u,eventId:d,drawIds:l,uniqueParticipantIds:p}=kI({startDate:s.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:n,participantsProfile:t,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:o,ratingsParameters:c,tournamentRecord:s,eventProfile:a,eventIndex:e,uuids:m});if(u)return{error:u};l&&y.push(...l),I.push(d),null!=p&&p.length&&g.push(...p),e+=1}}}if(l){let a=(s.events||[]).map((e=>{var t;return(null===(t=e.drawDefinitions)||void 0===t?void 0:t.map((()=>1)))||[]})).flat().reduce(((e,t)=>e+t),0);for(const c of l){const{drawId:u,eventId:d,event:l,error:f,uniqueParticipantIds:h}=FI({startDate:s.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:n,participantsProfile:t,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:o,ratingsParameters:e,tournamentRecord:s,drawProfile:c,drawIndex:a,goesTo:p,uuids:m});if(f)return{error:f};const v=Fg({tournamentRecord:s,event:l});if(v.error)return v;u&&y.push(u),I.push(d),null!=h&&h.length&&g.push(...h),a+=1}}const S=null!=u&&u.length?LI({tournamentRecord:s,venueProfiles:u}):[];let P,D={};if(a){const e=Sf({schedulingProfile:a,tournamentRecord:s});if(e.error)return e;if(P=e.scheduledRounds,d){const{tournamentId:e}=s;D=Pf({tournamentRecords:{[e]:s}})}}return h(f({},ko),{drawIds:y,eventIds:I,venueIds:S,scheduledRounds:P,schedulerResult:D})}},BI={generateOutcomeFromScoreString:gI,generateTournamentRecord:function({scheduleCompletedMatchUps:e,ratingsParameters:t=og,tournamentName:n="Mock Tournament",tournamentExtensions:i,tournamentAttributes:r,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,policyDefinitions:d,schedulingProfile:l,eventProfiles:p,venueProfiles:m,drawProfiles:v,autoSchedule:g,startDate:I,endDate:y,goesTo:w,uuids:U}={}){if(I&&!Ta(I)||y&&!Ta(y))return{error:Go};if(p&&!Array.isArray(p))return{error:_o};if(!I){const e=new Date;I=Aa(y||e),y=Aa(e.setDate(e.getDate()+7))}if(!y){const e=new Date(I);y=Aa(e.setDate(e.getDate()+7))}"object"!=typeof r&&(r={});const b=mg(h(f({},r),{tournamentName:n,startDate:I,endDate:y}));if(null!=i&&i.length&&Array.isArray(i)){const e=i.filter(cd);null!=e&&e.length&&Object.assign(b,{extensions:e,isMock:!0})}if("object"==typeof d)for(const f of Object.keys(d))Wf({policyDefinitions:{[f]:d[f]},tournamentRecord:b});const S=EI({participantsProfile:a,tournamentRecord:b,eventProfiles:p,drawProfiles:v,startDate:I,uuids:U});if(!S.success)return S;const P=[],D=[],N=[];if(Array.isArray(v)){let e=0;for(const n of v){const{drawId:i,eventId:r,event:d,error:l,uniqueParticipantIds:p}=FI({allUniqueParticipantIds:N,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,ratingsParameters:t,tournamentRecord:b,drawProfile:n,startDate:I,drawIndex:e,goesTo:w,uuids:U});if(l)return{error:l};const m=Fg({tournamentRecord:b,event:d});if(m.error)return m;i&&P.push(i),D.push(r),null!=p&&p.length&&N.push(...p),e+=1}}if(p){let e=0;for(const n of p){const{error:i,eventId:r,drawIds:d,uniqueParticipantIds:l}=kI({allUniqueParticipantIds:N,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,ratingsParameters:t,tournamentRecord:b,eventProfile:n,eventIndex:e,startDate:I,uuids:U});if(i)return{error:i};d&&P.push(...d),D.push(r),null!=l&&l.length&&N.push(...l),e+=1}}const M=null!=m&&m.length?LI({tournamentRecord:b,venueProfiles:m,uuids:U}):[];let T,E={};if(l){const t=function({schedulingProfile:e,tournamentRecord:t}){if("object"!=typeof e)return{error:_o};const n=Fp({tournamentRecord:t}).containedStructures,{matchUps:i}=Ml({tournamentRecord:t}),{tournamentId:r}=t,o=[];for(const a of e){const{scheduleDate:e,venues:s=[]}=a;for(const a of s){const{rounds:s,venueId:c}=a;for(const a of s){const{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=a,l=i.filter((e=>{var t;const n=(null==u?void 0:u.indexOf("-"))>0&&u.split("-").map((e=>+e)),i=null===(t=e.finishingPositionRange)||void 0===t?void 0:t.winner;return!(e.drawId!==s||a.roundNumber&&e.roundNumber!==a.roundNumber||i&&n&&2!==Ro(i,n).length)}))[0];if(l){const{eventId:i,roundNumber:a,drawName:p,structureName:m,roundName:h}=l;let v=l.structureId;a&&!u&&(v=Object.keys(n).find((e=>n[e].includes(v)))||v);const g={tournamentId:r,structureId:v,roundNumber:a,roundSegment:d,eventId:i,drawId:s};let I=Ql({tournamentRecords:{[r]:t},round:g,scheduleDate:e,venueId:c});if(I.error)return I;o.push(f({structureName:m,roundName:h,drawName:p},g))}}}}return{scheduledRounds:o}}({schedulingProfile:l,tournamentRecord:b});if(t.error)return t;if(T=t.scheduledRounds,g){const{tournamentId:t}=b;E=Pf({scheduleCompletedMatchUps:e,tournamentRecords:{[t]:b}})}}return Za({tournamentRecord:b,scheduledRounds:T,schedulerResult:E,eventIds:D,venueIds:M,drawIds:P})},generateEventWithDraw:FI,generateParticipants:DI,parseScoreString:vI,generateOutcome:yI,credits:Hf};let VI=!1;!function(){const e={version:()=>"0.74.1",setDeepCopy:(t,n)=>(da(t,n),e),devContext:t=>(ca(t),VI=!0,e)};[jI,BI].forEach((t=>{Object.keys(t).forEach((n=>{e[n]=e=>{try{return function(e,t){const n=e(f({},t));return null!=n&&n.error||Hm(),ma(),VI&&(ca(!1),VI=!1),n}(t[n],e)}catch(i){const t=i.toString();console.log("ERROR",{error:t,method:n,params:JSON.stringify(e)}),console.log(i)}}}))}))}();var $I={chunkArray:xo,countValues:function(e){return t=Po(e),Object.keys(t).reduce(((e,n)=>{const i=t[n];return e[i]?e[i].push(n):e[i]=[n],e}),{});var t},dateRange:xa,dateTime:Ya,garman:Cu,generateHashCode:function(e){if(null===e||"object"!=typeof e)return;const t=JSON.stringify(e),n=Qa(e),i=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0);return[t.length,n,i].map((e=>e.toString(36))).join("")},generateRange:Eo,generateTimeCode:Uo,instanceCount:Po,intersection:Ro,isNumeric:ho,isPowerOf2:mo,JSON2CSV:function(e,t){if(t&&"object"!=typeof t)return _o;const{includeTransoformAccessors:n,columnAccessors:i=[],columnTransform:r={},columnMap:o={},valuesMap:a={},context:s={},delimiter:c='"',columnJoiner:u=",",rowJoiner:d="\r\n",keyJoiner:l="."}=t||{};if(!Array.isArray(e)||!Array.isArray(i)||"object"!=typeof s||"object"!=typeof o||"object"!=typeof r||"object"!=typeof a||"string"!=typeof u||"string"!=typeof d||"string"!=typeof l||"string"!=typeof c)return _o;const p=e.filter(Boolean).map((e=>Ou(e,l))),m=Object.values(r).flat();n&&i.push(...m);const f=p.reduce(((e,t)=>Object.keys(t).every((t=>!e.includes(t)&&e.push(t)||!0))&&e),[]).filter((e=>!(null!=i&&i.length)||i.includes(e))),h=Object.assign({},...Object.keys(r).map((e=>r[e].map((t=>({[t]:e}))).flat())).flat()),v=f.reduce(((e,t)=>{const n=h[t];return n?e.includes(n)||e.push(n):e.push(t),e}),[]);Object.keys(o).forEach((e=>!v.includes(e)&&v.unshift(e))),Object.keys(r).forEach((e=>!v.includes(e)&&v.unshift(e))),"object"==typeof s&&Object.keys(s).forEach((e=>!v.includes(e)&&v.unshift(e)));const g=v.map((e=>o[e]||e)),I=e=>`${c}${e}${c}`,y=p.map((e=>Object.values(v.reduce(((t,n)=>{var i;const o=r[n],c=(null!=o&&o.length?e[o.find((t=>e[t]))]:e[n])||(null==s?void 0:s[n])||"",u=(null===(i=a[n])||void 0===i?void 0:i[c])||c;return t[n]=I(u),t}),{})).join(u)));return[g.map(I).join(u),...y].join(d)},makeDeepCopy:Ja,nearestPowerOf2:fo,numericSort:Xa,overlap:Co,parseAgeCategoryCode:xu,randomMember:To,randomPop:Mo,shuffleArray:So,unique:bo,UUID:es,UUIDS:function(e=1){return Eo(0,e).map(es)}};function GI({height:e,sideNumber:t,entryStatus:n}){const i=pe({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",width:"100%",height:e,variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}}),r=pe({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",boxSizing:"inherit",display:"flex",marginInlineStart:"calc(20%)",WebkitBoxPack:"center",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",flexDirection:"row"}),o=pe({boxSizing:"inherit",fontFamily:"Lato",alignContent:"center",fontSize:9,fontWeight:900});return(0,a.jsx)("div",{className:i({variant:t}),children:(0,a.jsx)("div",{style:{display:"flex",flexDirection:"column",height:"100%",alignContent:"center",justifyContent:"center"},children:(0,a.jsxs)("div",{className:r(),children:[(0,a.jsx)("span",{className:o(),children:"Entry status:\xa0"}),(0,a.jsx)("span",{className:o(),children:n})]})})})}function _I(){return(_I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var WI=["cdnSuffix","cdnUrl","countryCode","style","svg"],qI=function(e){var t=e.cdnSuffix,n=void 0===t?"svg":t,i=e.cdnUrl,o=void 0===i?"https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/4.1.4/flags/4x3/":i,a=e.countryCode,s=e.style,c=e.svg,u=void 0!==c&&c,d=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,WI);if("string"!=typeof a)return null;if(u){var l=""+o+a.toLowerCase()+"."+n;return(0,r.createElement)("img",Object.assign({},d,{src:l,style:_I({display:"inline-block",width:"1em",height:"1em",verticalAlign:"middle"},s)}))}var p=a.toUpperCase().replace(/./g,(function(e){return String.fromCodePoint(e.charCodeAt(0)+127397)}));return(0,r.createElement)("span",Object.assign({role:"img"},d,{style:_I({display:"inline-block",fontSize:"1em",lineHeight:"1em",verticalAlign:"middle"},s)}),p)};const zI=({className:e,individualParticipant:t})=>{var n,i;const r=(null==(n=null==t?void 0:t.person)?void 0:n.nationalityCode)||"",o=(null==(i=null==t?void 0:t.person)?void 0:i.isoNationalityCode)||"";return(0,a.jsxs)("span",{className:e,children:[(0,a.jsx)(qI,{alt:r,countryCode:o,loading:"lazy",style:{height:"100%",width:"100%",verticalAlign:"initial"},svg:!0}),"  "]})},HI=({individualParticipant:e,matchUpType:t="SINGLES",type:n="flag",composition:i,className:r,side:o})=>{var s,c;const u=(null==i?void 0:i.configuration)||{},{bracketedSeeds:d}=u;null==(s=null==e?void 0:e.ratings)||s[t],null==(c=null==e?void 0:e.rankings)||c[t];const l="seed"===n&&((null==o?void 0:o.seedValue)||(null==o?void 0:o.seedNumber)),p="boolean"==typeof d?["(",")"]:"square"===d?["[","]"]:["",""],m=`${p[0]}${l}${p[1]}`;return e?"flag"===n&&u.flags?(0,a.jsx)(zI,{className:r,individualParticipant:e}):l?(0,a.jsx)("sup",{className:r,children:m}):null:null};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self&&self;var KI,YI={exports:{}};KI=YI,function(){var e={}.hasOwnProperty;function t(){for(var n=[],i=0;i<arguments.length;i++){var r=arguments[i];if(r){var o=typeof r;if("string"===o||"number"===o)n.push(r);else if(Array.isArray(r)){if(r.length){var a=t.apply(null,r);a&&n.push(a)}}else if("object"===o)if(r.toString===Object.prototype.toString)for(var s in r)e.call(r,s)&&r[s]&&n.push(s);else n.push(r.toString())}}return n.join(" ")}KI.exports?(t.default=t,KI.exports=t):window.classNames=t}();var JI=YI.exports;const ZI=pe({marginInlineStart:"$space$2",marginInlineEnd:"$space$2",fontSize:"smaller",color:"gray"}),QI=({individualParticipant:e,className:t,composition:n})=>{var i,r,o,s,c;const u=null==(i=null==n?void 0:n.configuration)?void 0:i.showAddress,d=(null==(o=null==(r=null==e?void 0:e.person)?void 0:r.addresses)?void 0:o.length)?Object.values((null==(c=null==(s=e.person)?void 0:s.addresses)?void 0:c[0])||{}).join(", "):" ";return u?(0,a.jsx)("div",{className:JI(ZI(),t),children:d}):null},XI=pe({margin:"2.5px 0"}),ey=pe({width:"1rem",minWidth:"1rem",borderRadius:2,marginInlineStart:2,marginInlinEnd:2,position:"relative",display:"inline-block",WebkitBoxSizing:"border-box",boxSizing:"border-box"}),ty=pe({display:"flex",fontWeight:500,whiteSpace:"nowrap",justifyContent:"flex-start",alignItems:"center"}),ny=pe({marginInlineStart:"$space$2",marginInlineEnd:"$space$2",textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),iy=pe({textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem",marginInlineStart:".5rem",color:"$participant$seed"});function ry(e){const{isWinningSide:t,onClickIndividual:n,side:i,individualParticipant:r}=e,o=t?"winner":void 0,s=null==r?void 0:r.participantName;return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:ty(),onClick:n,children:[(0,a.jsx)(HI,h(f({},e),{className:ey()})),(0,a.jsx)("div",{className:ny({variant:o}),children:(null==i?void 0:i.bye)||(null==i?void 0:i.qualifier)||!s?(0,a.jsx)("abbr",{className:XI(),children:(null==i?void 0:i.bye)?"BYE":(null==i?void 0:i.qualifier)?"Qualifier":"TBD"}):(0,a.jsx)("span",{children:s})}),(0,a.jsx)(HI,h(f({},e),{className:iy(),type:"seed"}))]}),(0,a.jsx)(QI,f({},e))]},`${e.index}`)}const oy=pe({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}}),ay=({matchUpStatus:e})=>{const t=null==e?void 0:e.toLowerCase(),n=["WALKOVER","DOUBLE_WALKOVER"].includes(e)?"WO":(null==e?void 0:e.slice(0,3))||"";return(0,a.jsx)("div",{className:oy({variant:t}),children:(0,a.jsx)("abbr",{title:e,style:{textDecoration:"none",borderBottom:"none"},children:n})})},sy=pe({position:"absolute",left:"1.1rem",top:".4rem",letterSpacing:"-0.2em",fontSize:"0.625rem",lineHeight:"0.75rem"}),cy=pe({fontWeight:500,position:"relative",margin:0,width:"$score$setWidth",display:"flex",justifyContent:"center",fontSize:"$1",lineHeight:"2.5rem",variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),uy=pe({display:"flex",alignItems:"center",justifyContent:"flex-end",marginInlineEnd:"$space$gameMarginInlineEnd"}),dy=({gameScoreOnly:e,scoreStripes:t,set:n,sideNumber:i})=>{const r=i===(null==n?void 0:n.winningSide)?"winner":(null==n?void 0:n.winningSide)?"loser":void 0,o=2===i?n.side2Score:n.side1Score,s=2===i?n.side2TiebreakScore:n.side1TiebreakScore,c=void 0===o&&s,u=c||o,d=t&&n.setNumber%2?"lightgray":"transparent";return(0,a.jsxs)("p",{className:cy({variant:r}),style:{backgroundColor:d},children:[isNaN(u)?"":u,e?null:(0,a.jsx)("span",{className:sy(),children:c?"":s})]})},ly=({composition:e,score:t,sideNumber:n,participantHeight:i})=>{var r,o,s;const c=null==(r=null==e?void 0:e.configuration)?void 0:r.winnerChevron,u=null==(o=null==e?void 0:e.configuration)?void 0:o.gameScoreOnly,d=(null==t?void 0:t.sets)||[],l=null==(s=null==e?void 0:e.configuration)?void 0:s.scoreBox,p=pe({display:"flex",alignItems:"center",height:i-1,justifyContent:"flex-end",borderBottom:"1px solid transparent",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}});return(0,a.jsx)("div",{className:p({sideNumber:!l&&n}),children:(0,a.jsx)("div",{className:uy(),children:null==d?void 0:d.map(((e,t)=>(0,a.jsx)(dy,{gameScoreOnly:u,scoreStripes:c,sideNumber:n,set:e},`Side${n}-Set-${t}`)))})})},py=e=>{var t=e,{dim:n="20px"}=t,i=v(t,["dim"]);return(0,a.jsx)("svg",h(f({height:n,style:{fill:"currentColor"},viewBox:"0 0 18 24",width:n,xmlns:"http://www.w3.org/2000/svg"},i),{children:(0,a.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}))};var my={exports:{}};!function(e,t){e.exports=function(){var e=1e3,t=6e4,n=36e5,i="millisecond",r="second",o="minute",a="hour",s="day",c="week",u="month",d="quarter",l="year",p="date",m="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},g=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},I={s:g,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+g(i,2,"0")+":"+g(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(i,u),o=n-r<0,a=t.clone().add(i+(o?-1:1),u);return+(-(i+(n-r)/(o?r-a:a-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:l,w:c,d:s,D:p,h:a,m:o,s:r,ms:i,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",w={};w[y]=v;var U=function(e){return e instanceof D},b=function(e,t,n){var i;if(!e)return y;if("string"==typeof e)w[e]&&(i=e),t&&(w[e]=t,i=e);else{var r=e.name;w[r]=e,i=r}return!n&&i&&(y=i),i||!n&&y},S=function(e,t){if(U(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new D(n)},P=I;P.l=b,P.i=U,P.w=function(e,t){return S(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var D=function(){function v(e){this.$L=b(e.locale,null,!0),this.parse(e)}var g=v.prototype;return g.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(P.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(f);if(i){var r=i[2]-1||0,o=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,o)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},g.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},g.$utils=function(){return P},g.isValid=function(){return!(this.$d.toString()===m)},g.isSame=function(e,t){var n=S(e);return this.startOf(t)<=n&&n<=this.endOf(t)},g.isAfter=function(e,t){return S(e)<this.startOf(t)},g.isBefore=function(e,t){return this.endOf(t)<S(e)},g.$g=function(e,t,n){return P.u(e)?this[t]:this.set(n,e)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(e,t){var n=this,i=!!P.u(t)||t,d=P.p(e),m=function(e,t){var r=P.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return i?r:r.endOf(s)},f=function(e,t){return P.w(n.toDate()[e].apply(n.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},h=this.$W,v=this.$M,g=this.$D,I="set"+(this.$u?"UTC":"");switch(d){case l:return i?m(1,0):m(31,11);case u:return i?m(1,v):m(0,v+1);case c:var y=this.$locale().weekStart||0,w=(h<y?h+7:h)-y;return m(i?g-w:g+(6-w),v);case s:case p:return f(I+"Hours",0);case a:return f(I+"Minutes",1);case o:return f(I+"Seconds",2);case r:return f(I+"Milliseconds",3);default:return this.clone()}},g.endOf=function(e){return this.startOf(e,!1)},g.$set=function(e,t){var n,c=P.p(e),d="set"+(this.$u?"UTC":""),m=(n={},n[s]=d+"Date",n[p]=d+"Date",n[u]=d+"Month",n[l]=d+"FullYear",n[a]=d+"Hours",n[o]=d+"Minutes",n[r]=d+"Seconds",n[i]=d+"Milliseconds",n)[c],f=c===s?this.$D+(t-this.$W):t;if(c===u||c===l){var h=this.clone().set(p,1);h.$d[m](f),h.init(),this.$d=h.set(p,Math.min(this.$D,h.daysInMonth())).$d}else m&&this.$d[m](f);return this.init(),this},g.set=function(e,t){return this.clone().$set(e,t)},g.get=function(e){return this[P.p(e)]()},g.add=function(i,d){var p,m=this;i=Number(i);var f=P.p(d),h=function(e){var t=S(m);return P.w(t.date(t.date()+Math.round(e*i)),m)};if(f===u)return this.set(u,this.$M+i);if(f===l)return this.set(l,this.$y+i);if(f===s)return h(1);if(f===c)return h(7);var v=(p={},p[o]=t,p[a]=n,p[r]=e,p)[f]||1,g=this.$d.getTime()+i*v;return P.w(g,this)},g.subtract=function(e,t){return this.add(-1*e,t)},g.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||m;var i=e||"YYYY-MM-DDTHH:mm:ssZ",r=P.z(this),o=this.$H,a=this.$m,s=this.$M,c=n.weekdays,u=n.months,d=function(e,n,r,o){return e&&(e[n]||e(t,i))||r[n].substr(0,o)},l=function(e){return P.s(o%12||12,e,"0")},p=n.meridiem||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i},f={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:P.s(s+1,2,"0"),MMM:d(n.monthsShort,s,u,3),MMMM:d(u,s),D:this.$D,DD:P.s(this.$D,2,"0"),d:String(this.$W),dd:d(n.weekdaysMin,this.$W,c,2),ddd:d(n.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(o),HH:P.s(o,2,"0"),h:l(1),hh:l(2),a:p(o,a,!0),A:p(o,a,!1),m:String(a),mm:P.s(a,2,"0"),s:String(this.$s),ss:P.s(this.$s,2,"0"),SSS:P.s(this.$ms,3,"0"),Z:r};return i.replace(h,(function(e,t){return t||f[e]||r.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(i,p,m){var f,h=P.p(p),v=S(i),g=(v.utcOffset()-this.utcOffset())*t,I=this-v,y=P.m(this,v);return y=(f={},f[l]=y/12,f[u]=y,f[d]=y/3,f[c]=(I-g)/6048e5,f[s]=(I-g)/864e5,f[a]=I/n,f[o]=I/t,f[r]=I/e,f)[h]||I,m?y:P.a(y)},g.daysInMonth=function(){return this.endOf(u).$D},g.$locale=function(){return w[this.$L]},g.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=b(e,t,!0);return i&&(n.$L=i),n},g.clone=function(){return P.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},v}(),N=D.prototype;return S.prototype=N,[["$ms",i],["$s",r],["$m",o],["$H",a],["$W",s],["$M",u],["$y",l],["$D",p]].forEach((function(e){N[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),S.extend=function(e,t){return e.$i||(e(t,D,S),e.$i=!0),S},S.locale=b,S.isDayjs=U,S.unix=function(e){return S(1e3*e)},S.en=w[y],S.Ls=w,S.p={},S}()}(my);var fy=my.exports;const hy=pe({display:"flex",flexDirection:"column"}),vy=pe({display:"flex",alignItems:"stretch"}),gy=pe({display:"flex",flexDirection:"column",justifyContent:"space-between",marginInlineEnd:"0rem",overflowX:"scroll",scrollbarWidth:"none",fontWeight:500,width:"100%","&::WebkitScrollbar":{display:"none"},variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}}),Iy=pe({marginInlineEnd:".25rem",color:"green"}),yy=({participantHeight:e,matchUpStatus:t,composition:n,matchUpType:i,roundNumber:r,winningSide:o,sideNumber:s,schedule:c,score:u,sides:d})=>{var l,p,m,f,h,v,g,I;const y=(null==n?void 0:n.configuration)||{},w=null==y?void 0:y.scheduleInfo,U=pe({display:"flex",width:"100%",boxSizing:"border-box",alignItems:"center",backgroundColor:"#F8F9F9",justifyContent:"space-between",padding:"0.5rem",color:"#7F8080",height:w-1,borderBottom:"1px solid darkgray"}),b=pe({display:"flex",position:"relative",flexGrow:1,height:e,boxSizing:"border-box",minWidth:"15rem",alignItems:"center",backgroundColor:"$matchUp",justifyContent:"space-between",paddingInlineStart:"0.75rem",paddingInlineEnd:"0rem",paddingTop:"0.5rem",paddingBottom:"0.5rem","& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}}),S="TEAM"===i,P="DOUBLES"===i,D=null==d?void 0:d.find((e=>e.sideNumber===s)),N=P?null==(p=null==(l=null==D?void 0:D.participant)?void 0:l.individualParticipants)?void 0:p[0]:null==D?void 0:D.participant,M=P&&(null==(f=null==(m=null==D?void 0:D.participant)?void 0:m.individualParticipants)?void 0:f[1]),T=s===o,E=(null==y?void 0:y.winnerChevron)&&T,A=null==y?void 0:y.teamLogo,R=null==(v=null==(h=null==D?void 0:D.participant)?void 0:h.entryStatus)?void 0:v.replace("_"," "),C=()=>(0,a.jsx)(GI,{height:30,sideNumber:s,entryStatus:R}),x=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(t)&&!T,O=null==(g=null==n?void 0:n.configuration)?void 0:g.gameScoreOnly,k=(P?.35:.3)*e,F=pe({variants:{variant:{winner:{"&:before":{content:"",position:"absolute",display:"block",borderTop:`${k}px solid transparent`,borderBottom:`${k}px solid transparent`,borderInlineStart:"8px solid #008f70",insetInlineStart:0}}}}}),L=null==y?void 0:y.centerInfo,j=y.drawPositions&&(null==D?void 0:D.drawPosition)&&(1===r||D.participantFed)?null==D?void 0:D.drawPosition:"",B=null==u?void 0:u.scoreStringSide1,V=(null==(I=null==n?void 0:n.configuration)?void 0:I.scoreBox)&&B,{scheduledTime:$,scheduledDate:G,venueAbbreviation:_,courtName:W}=c||{},{dateTime:{extractDate:q,extractTime:z}}=$I,H=z($);let K=q(G),Y="ddd D MMMM";H&&(Y+=", hh:mm",K+=`T${H}`);const J=G?fy(K).format(Y):"Not scheduled",Z=_&&W?`${_} ${W}`:"";return(0,a.jsxs)("div",{className:hy(),children:[w&&2!==s?(0,a.jsxs)("div",{className:U(),children:[(0,a.jsx)("div",{children:J}),(0,a.jsxs)("div",{children:[" ",Z]})]}):null,L&&1!==s?(0,a.jsx)(C,{}):null,(0,a.jsxs)("div",{className:vy(),children:[(0,a.jsxs)("div",{className:b({sideNumber:s,css:j&&{"&:before":{display:"flex",position:"absolute",insetInlineStart:-10,width:20,color:"#55AFFE",alignContent:"center",justifyContent:"center",backgroundColor:"$backgroundColor",content:`${j}`}}}),children:[A?(0,a.jsx)("div",{style:{height:40,width:40,backgroundColor:"pink",marginInlineEnd:".5rem",marginInlineStart:2}}):null,(0,a.jsx)("div",{className:gy({variant:P?"doubles":void 0}),children:S?null:(0,a.jsxs)("div",{className:F({variant:E?"winner":void 0}),children:[(0,a.jsx)(ry,{individualParticipant:N,isWinningSide:T,composition:n,side:D}),M?(0,a.jsx)(ry,{individualParticipant:M,isWinningSide:T,composition:n,side:D}):null]})}),(0,a.jsxs)("div",{style:{lineHeight:0},children:[!T||O?null:(0,a.jsx)(py,{className:Iy()}),x?(0,a.jsx)(ay,{matchUpStatus:t}):null]})]}),V?(0,a.jsx)("div",{style:{height:e-1,border:"1px solid lightgray"},children:" "}):null,B?(0,a.jsx)(ly,{participantHeight:e,matchUpStatus:t,composition:n,winningSide:o,sideNumber:s,score:u}):null]}),L&&2!==s?(0,a.jsx)(C,{}):null]})},wy=e=>{const{className:t,composition:n,isLucky:i,matchUp:r,moeity:o,selectedMatchUpId:s}=e,c=e.events||{},{roundFactor:u,roundNumber:d,finishingRound:l,matchUpType:p,preFeedRound:m,stage:v}=r,g="QUALIFUYING"!==v&&1===parseInt(l),I="QUALIFYING"===v&&1===parseInt(l),y=1===parseInt(d),w="DOUBLES"===p,U=!r.drawPositions||r.isRoundRobin||i?"mr":I||m?"m0":o?"m1":"m2",b=(null==n?void 0:n.configuration)||{},{resultsInfo:S,showAddress:P}=b||{},D=w?P?80:60:P?50:40,N=(({composition:e,roundFactor:t,roundNumber:n,participantHeight:i})=>{const r=(null==e?void 0:e.configuration)||{},o=(null==r?void 0:r.centerInfo)||0,a=(null==r?void 0:r.scheduleInfo)||0,s=(null==r?void 0:r.connectorWidth)||16,c=(i+s+a+o-2)*(t||Math.pow(2,n-1));let u=o?i+o:i-2;return pe({position:"relative",display:"grid",width:"100%",height:2*(i+o)+2+a,border:"solid $border",backgroundColor:"$matchUpBackgroundColor",borderBlockStartWidth:"$borderWidths$matchUp",borderBlockEndWidth:"$borderWidths$matchUp",borderInlineWidth:"$borderWidths$matchUpInline",boxShadow:"$matchUp$boxShadow",WebkitTransition:"all 0.30s linear",transition:"all 0.30s linear",marginTop:"$space$1",marginBottom:"$space$1","&::before":{borderRadius:2,position:"absolute",borderBlockStart:"$borderWidths$matchUp solid #999",height:1,width:s,insetInlineStart:-s,top:"calc(50% - $borderWidths$matchUp * $borderWidths$factor)"},"&::after":{position:"relative",insetInlineStart:"100%",width:`calc(${s} / 2}`},"&::after, &::before":{content:"",display:"block",borderWidth:"$borderWidths$matchUp",borderColor:"$connector"},"&:after":{width:s,height:c},variants:{isFirstRound:{true:{"&:before":{width:0,height:0,borderWidth:0}}},link:{m1:{"&:after":{borderWidth:"$borderWidths$matchUp",borderInlineEnd:"$borderWidths$matchUp solid",borderColor:"$connector",borderTopStyle:"solid",top:`calc(${-1*(i+o)-2-1}px + $borderWidths$matchUp * $borderWidths$factor)`}},m2:{"&:after":{top:`calc(-100% - ${u}px - $borderWidths$matchUp * $borderWidths$factor)`,borderInlineEnd:"$borderWidths$matchUp solid",borderWidth:"$borderWidths$matchUp",borderColor:"$connector",borderBottomStyle:"solid"}},m0:{"&:after":{top:`calc(-100% - ${u}px - $borderWidths$matchUp * $borderWidths$factor)`,borderWidth:"$borderWidths$matchUp",borderBottomStyle:"solid",borderColor:"$connector"}},mr:{"&:after":{width:0,height:0,borderWidth:0},"&:before":{width:0,height:0,borderWidth:0}}},noProgression:{true:{"&:after":{width:0,height:0,borderWidth:0}}}}})})({composition:n,roundFactor:u,roundNumber:d,participantHeight:D});return(0,a.jsx)("div",{className:t,onClick:()=>{"function"==typeof(null==c?void 0:c.matchUpClick)&&c.matchUpClick(null==r?void 0:r.matchUpId)},children:(0,a.jsxs)("div",{className:N({isFirstRound:y,noProgression:g,link:U}),children:[(0,a.jsx)(yy,h(f({sideNumber:1},r),{composition:n,participantHeight:D})),(0,a.jsx)(yy,h(f({sideNumber:2},r),{composition:n,participantHeight:D})),S?(0,a.jsx)(Sy,f({},r)):null,(0,a.jsx)("div",{className:"overlay",style:{display:s===r.matchUpId?"":"none",position:"absolute",top:0,height:"100%",width:"100%",opacity:"0.2",backgroundColor:"magenta"}})]})})},Uy=pe({width:"$score$setWidth",fontSize:9,display:"inline-block",variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),by=pe({fontSize:0,textTransform:"uppercase",color:"#bbb",position:"absolute",right:4,top:"calc(50% - 2px)",transform:"translateY(-50%)",backgroundColor:"#fff",textAlign:"center"});function Sy({score:e}){var t;const n=null==(t=null==e?void 0:e.sets)?void 0:t.filter(Boolean).sort(((e,t)=>(e.setNumber||0)-(t.setNumber||0))),i=null==n?void 0:n[n.length-1],r=(null==i?void 0:i.side1PointsScore)||(null==i?void 0:i.side2PointsScore);return(0,a.jsxs)("div",{className:by(),children:[r?(0,a.jsx)("div",{className:Uy({variant:"points"}),children:"PTS"}):null,(null==n?void 0:n.length)?n.map(((e,t)=>(0,a.jsx)("div",{className:Uy({variant:"set"}),children:t+1},`set-${t}`))):null]})}const Py=({composition:e,events:t,isLucky:n,matchUps:i,selectedMatchUpId:r,roundNumber:o})=>{const s=i.filter((e=>e.roundNumber===o)).sort(((e,t)=>(e.roundPosition||0)-(t.roundPosition||0)));return(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",width:"460px"},children:[s.map(((i,o)=>(0,a.jsx)(wy,{selectedMatchUpId:r,composition:e,moeity:o%2==0,matchUp:i,isLucky:n,events:t},`m-${o}`)))," "]})},Dy=({composition:e,events:t,matchUps:n,selectedMatchUpId:i})=>{const{roundNumbers:r,hasOddMatchUpsCount:o}=tg.getRoundMatchUps({matchUps:n}),s=o;return(0,a.jsx)("div",{style:{marginInlineStart:"1rem",display:"flex",overflowX:"auto"},children:r.map(((r,o)=>(0,a.jsx)(Py,{selectedMatchUpId:i,composition:e,roundNumber:r,matchUps:n,isLucky:s,events:t},`round-${o}`)))})},Ny=({composition:e,events:t,structures:n,structureId:i})=>{var o;const[s,c]=r.useState(i),[u,d]=r.useState();(0,r.useEffect)((()=>c(i)),[i]),t&&(t.matchUpClick=e=>{d(u===e?void 0:e)});const l=null==n?void 0:n.find((e=>e.structureId===s)),p=null==l?void 0:l.roundMatchUps,m=p?null==(o=Object.values(p))?void 0:o.flat():[],f=me("div",{display:"flex",width:"auto",height:60,alignContent:"center",justifyContent:"center",justifyItems:"center"});return(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(null==n?void 0:n.length)&&1!==n.length?(0,a.jsx)(Tr,{structures:n,structureId:s,onSelect:e=>c(e)}):null,(0,a.jsx)("div",{style:{height:"30px"},children:" "}),(null==n?void 0:n.length)?(0,a.jsx)(Dy,{selectedMatchUpId:u,composition:e,matchUps:m,events:t}):(0,a.jsx)(f,{children:"Nothing to show with current configuration"})]})},My=({compositionName:e,eventData:t,events:n})=>{var i,r,o;const s=(null==(r=null==(i=null==t?void 0:t.drawsData)?void 0:i[0])?void 0:r.structures)||[],c=null==(o=s[0])?void 0:o.structureId,u=(null==Ue?void 0:Ue[e])||Ue.Australian,d=u.theme;return(0,a.jsx)(Ny,{structureId:c,composition:u,structures:s,className:d,events:n})}}}]);