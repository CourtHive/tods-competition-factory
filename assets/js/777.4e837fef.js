(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[777],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return d},kt:function(){return f}});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=r.createContext({}),u=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return r.createElement(c.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=u(n),f=i,m=p["".concat(c,".").concat(f)]||p[f]||l[f]||a;return n?r.createElement(m,o(o({ref:t},d),{},{components:n})):r.createElement(m,o({ref:t},d))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var u=2;u<a;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3112:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"apathy",author:"jannik siebert (https://github.com/janniks)",base00:"#031A16",base01:"#0B342D",base02:"#184E45",base03:"#2B685E",base04:"#5F9C92",base05:"#81B5AC",base06:"#A7CEC8",base07:"#D2E7E4",base08:"#3E9688",base09:"#3E7996",base0A:"#3E4C96",base0B:"#883E96",base0C:"#963E4C",base0D:"#96883E",base0E:"#4C963E",base0F:"#3E965B"},e.exports=t.default},1236:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"ashes",author:"jannik siebert (https://github.com/janniks)",base00:"#1C2023",base01:"#393F45",base02:"#565E65",base03:"#747C84",base04:"#ADB3BA",base05:"#C7CCD1",base06:"#DFE2E5",base07:"#F3F4F5",base08:"#C7AE95",base09:"#C7C795",base0A:"#AEC795",base0B:"#95C7AE",base0C:"#95AEC7",base0D:"#AE95C7",base0E:"#C795AE",base0F:"#C79595"},e.exports=t.default},253:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"atelier dune",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/dune)",base00:"#20201d",base01:"#292824",base02:"#6e6b5e",base03:"#7d7a68",base04:"#999580",base05:"#a6a28c",base06:"#e8e4cf",base07:"#fefbec",base08:"#d73737",base09:"#b65611",base0A:"#cfb017",base0B:"#60ac39",base0C:"#1fad83",base0D:"#6684e1",base0E:"#b854d4",base0F:"#d43552"},e.exports=t.default},235:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"atelier forest",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/forest)",base00:"#1b1918",base01:"#2c2421",base02:"#68615e",base03:"#766e6b",base04:"#9c9491",base05:"#a8a19f",base06:"#e6e2e0",base07:"#f1efee",base08:"#f22c40",base09:"#df5320",base0A:"#d5911a",base0B:"#5ab738",base0C:"#00ad9c",base0D:"#407ee7",base0E:"#6666ea",base0F:"#c33ff3"},e.exports=t.default},8447:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"atelier heath",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/heath)",base00:"#1b181b",base01:"#292329",base02:"#695d69",base03:"#776977",base04:"#9e8f9e",base05:"#ab9bab",base06:"#d8cad8",base07:"#f7f3f7",base08:"#ca402b",base09:"#a65926",base0A:"#bb8a35",base0B:"#379a37",base0C:"#159393",base0D:"#516aec",base0E:"#7b59c0",base0F:"#cc33cc"},e.exports=t.default},8629:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"atelier lakeside",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/lakeside/)",base00:"#161b1d",base01:"#1f292e",base02:"#516d7b",base03:"#5a7b8c",base04:"#7195a8",base05:"#7ea2b4",base06:"#c1e4f6",base07:"#ebf8ff",base08:"#d22d72",base09:"#935c25",base0A:"#8a8a0f",base0B:"#568c3b",base0C:"#2d8f6f",base0D:"#257fad",base0E:"#5d5db1",base0F:"#b72dd2"},e.exports=t.default},1931:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"atelier seaside",author:"bram de haan (http://atelierbram.github.io/syntax-highlighting/atelier-schemes/seaside/)",base00:"#131513",base01:"#242924",base02:"#5e6e5e",base03:"#687d68",base04:"#809980",base05:"#8ca68c",base06:"#cfe8cf",base07:"#f0fff0",base08:"#e6193c",base09:"#87711d",base0A:"#c3c322",base0B:"#29a329",base0C:"#1999b3",base0D:"#3d62f5",base0E:"#ad2bee",base0F:"#e619c3"},e.exports=t.default},7113:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"bespin",author:"jan t. sott",base00:"#28211c",base01:"#36312e",base02:"#5e5d5c",base03:"#666666",base04:"#797977",base05:"#8a8986",base06:"#9d9b97",base07:"#baae9e",base08:"#cf6a4c",base09:"#cf7d34",base0A:"#f9ee98",base0B:"#54be0d",base0C:"#afc4db",base0D:"#5ea6ea",base0E:"#9b859d",base0F:"#937121"},e.exports=t.default},7757:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"brewer",author:"timoth\xe9e poisot (http://github.com/tpoisot)",base00:"#0c0d0e",base01:"#2e2f30",base02:"#515253",base03:"#737475",base04:"#959697",base05:"#b7b8b9",base06:"#dadbdc",base07:"#fcfdfe",base08:"#e31a1c",base09:"#e6550d",base0A:"#dca060",base0B:"#31a354",base0C:"#80b1d3",base0D:"#3182bd",base0E:"#756bb1",base0F:"#b15928"},e.exports=t.default},5328:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"bright",author:"chris kempson (http://chriskempson.com)",base00:"#000000",base01:"#303030",base02:"#505050",base03:"#b0b0b0",base04:"#d0d0d0",base05:"#e0e0e0",base06:"#f5f5f5",base07:"#ffffff",base08:"#fb0120",base09:"#fc6d24",base0A:"#fda331",base0B:"#a1c659",base0C:"#76c7b7",base0D:"#6fb3d2",base0E:"#d381c3",base0F:"#be643c"},e.exports=t.default},3906:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"chalk",author:"chris kempson (http://chriskempson.com)",base00:"#151515",base01:"#202020",base02:"#303030",base03:"#505050",base04:"#b0b0b0",base05:"#d0d0d0",base06:"#e0e0e0",base07:"#f5f5f5",base08:"#fb9fb1",base09:"#eda987",base0A:"#ddb26f",base0B:"#acc267",base0C:"#12cfc0",base0D:"#6fc2ef",base0E:"#e1a3ee",base0F:"#deaf8f"},e.exports=t.default},3236:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"codeschool",author:"brettof86",base00:"#232c31",base01:"#1c3657",base02:"#2a343a",base03:"#3f4944",base04:"#84898c",base05:"#9ea7a6",base06:"#a7cfa3",base07:"#b5d8f6",base08:"#2a5491",base09:"#43820d",base0A:"#a03b1e",base0B:"#237986",base0C:"#b02f30",base0D:"#484d79",base0E:"#c59820",base0F:"#c98344"},e.exports=t.default},5190:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"colors",author:"mrmrs (http://clrs.cc)",base00:"#111111",base01:"#333333",base02:"#555555",base03:"#777777",base04:"#999999",base05:"#bbbbbb",base06:"#dddddd",base07:"#ffffff",base08:"#ff4136",base09:"#ff851b",base0A:"#ffdc00",base0B:"#2ecc40",base0C:"#7fdbff",base0D:"#0074d9",base0E:"#b10dc9",base0F:"#85144b"},e.exports=t.default},7339:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"default",author:"chris kempson (http://chriskempson.com)",base00:"#181818",base01:"#282828",base02:"#383838",base03:"#585858",base04:"#b8b8b8",base05:"#d8d8d8",base06:"#e8e8e8",base07:"#f8f8f8",base08:"#ab4642",base09:"#dc9656",base0A:"#f7ca88",base0B:"#a1b56c",base0C:"#86c1b9",base0D:"#7cafc2",base0E:"#ba8baf",base0F:"#a16946"},e.exports=t.default},3517:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"eighties",author:"chris kempson (http://chriskempson.com)",base00:"#2d2d2d",base01:"#393939",base02:"#515151",base03:"#747369",base04:"#a09f93",base05:"#d3d0c8",base06:"#e8e6df",base07:"#f2f0ec",base08:"#f2777a",base09:"#f99157",base0A:"#ffcc66",base0B:"#99cc99",base0C:"#66cccc",base0D:"#6699cc",base0E:"#cc99cc",base0F:"#d27b53"},e.exports=t.default},5091:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"embers",author:"jannik siebert (https://github.com/janniks)",base00:"#16130F",base01:"#2C2620",base02:"#433B32",base03:"#5A5047",base04:"#8A8075",base05:"#A39A90",base06:"#BEB6AE",base07:"#DBD6D1",base08:"#826D57",base09:"#828257",base0A:"#6D8257",base0B:"#57826D",base0C:"#576D82",base0D:"#6D5782",base0E:"#82576D",base0F:"#825757"},e.exports=t.default},5021:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"flat",author:"chris kempson (http://chriskempson.com)",base00:"#2C3E50",base01:"#34495E",base02:"#7F8C8D",base03:"#95A5A6",base04:"#BDC3C7",base05:"#e0e0e0",base06:"#f5f5f5",base07:"#ECF0F1",base08:"#E74C3C",base09:"#E67E22",base0A:"#F1C40F",base0B:"#2ECC71",base0C:"#1ABC9C",base0D:"#3498DB",base0E:"#9B59B6",base0F:"#be643c"},e.exports=t.default},6664:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"google",author:"seth wright (http://sethawright.com)",base00:"#1d1f21",base01:"#282a2e",base02:"#373b41",base03:"#969896",base04:"#b4b7b4",base05:"#c5c8c6",base06:"#e0e0e0",base07:"#ffffff",base08:"#CC342B",base09:"#F96A38",base0A:"#FBA922",base0B:"#198844",base0C:"#3971ED",base0D:"#3971ED",base0E:"#A36AC7",base0F:"#3971ED"},e.exports=t.default},211:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"grayscale",author:"alexandre gavioli (https://github.com/alexx2/)",base00:"#101010",base01:"#252525",base02:"#464646",base03:"#525252",base04:"#ababab",base05:"#b9b9b9",base06:"#e3e3e3",base07:"#f7f7f7",base08:"#7c7c7c",base09:"#999999",base0A:"#a0a0a0",base0B:"#8e8e8e",base0C:"#868686",base0D:"#686868",base0E:"#747474",base0F:"#5e5e5e"},e.exports=t.default},1857:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"green screen",author:"chris kempson (http://chriskempson.com)",base00:"#001100",base01:"#003300",base02:"#005500",base03:"#007700",base04:"#009900",base05:"#00bb00",base06:"#00dd00",base07:"#00ff00",base08:"#007700",base09:"#009900",base0A:"#007700",base0B:"#00bb00",base0C:"#005500",base0D:"#009900",base0E:"#00bb00",base0F:"#005500"},e.exports=t.default},8960:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"harmonic16",author:"jannik siebert (https://github.com/janniks)",base00:"#0b1c2c",base01:"#223b54",base02:"#405c79",base03:"#627e99",base04:"#aabcce",base05:"#cbd6e2",base06:"#e5ebf1",base07:"#f7f9fb",base08:"#bf8b56",base09:"#bfbf56",base0A:"#8bbf56",base0B:"#56bf8b",base0C:"#568bbf",base0D:"#8b56bf",base0E:"#bf568b",base0F:"#bf5656"},e.exports=t.default},8038:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"hopscotch",author:"jan t. sott",base00:"#322931",base01:"#433b42",base02:"#5c545b",base03:"#797379",base04:"#989498",base05:"#b9b5b8",base06:"#d5d3d5",base07:"#ffffff",base08:"#dd464c",base09:"#fd8b19",base0A:"#fdcc59",base0B:"#8fc13e",base0C:"#149b93",base0D:"#1290bf",base0E:"#c85e7c",base0F:"#b33508"},e.exports=t.default},9194:function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e.default:e}t.__esModule=!0;var i=n(2633);t.threezerotwofour=r(i);var a=n(3112);t.apathy=r(a);var o=n(1236);t.ashes=r(o);var s=n(253);t.atelierDune=r(s);var c=n(235);t.atelierForest=r(c);var u=n(8447);t.atelierHeath=r(u);var d=n(8629);t.atelierLakeside=r(d);var l=n(1931);t.atelierSeaside=r(l);var p=n(7113);t.bespin=r(p);var f=n(7757);t.brewer=r(f);var m=n(5328);t.bright=r(m);var h=n(3906);t.chalk=r(h);var v=n(3236);t.codeschool=r(v);var g=n(5190);t.colors=r(g);var I=n(7339);t.default=r(I);var y=n(3517);t.eighties=r(y);var b=n(5091);t.embers=r(b);var w=n(5021);t.flat=r(w);var U=n(6664);t.google=r(U);var S=n(211);t.grayscale=r(S);var D=n(1857);t.greenscreen=r(D);var N=n(8960);t.harmonic=r(N);var P=n(8038);t.hopscotch=r(P);var A=n(971);t.isotope=r(A);var M=n(8764);t.marrakesh=r(M);var T=n(5364);t.mocha=r(T);var E=n(5610);t.monokai=r(E);var C=n(4646);t.ocean=r(C);var R=n(8466);t.paraiso=r(R);var O=n(5708);t.pop=r(O);var x=n(1834);t.railscasts=r(x);var L=n(5410);t.shapeshifter=r(L);var k=n(7427);t.solarized=r(k);var F=n(3013);t.summerfruit=r(F);var j=n(6706);t.tomorrow=r(j);var _=n(9028);t.tube=r(_);var B=n(1899);t.twilight=r(B)},971:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"isotope",author:"jan t. sott",base00:"#000000",base01:"#404040",base02:"#606060",base03:"#808080",base04:"#c0c0c0",base05:"#d0d0d0",base06:"#e0e0e0",base07:"#ffffff",base08:"#ff0000",base09:"#ff9900",base0A:"#ff0099",base0B:"#33ff00",base0C:"#00ffff",base0D:"#0066ff",base0E:"#cc00ff",base0F:"#3300ff"},e.exports=t.default},8764:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"marrakesh",author:"alexandre gavioli (http://github.com/alexx2/)",base00:"#201602",base01:"#302e00",base02:"#5f5b17",base03:"#6c6823",base04:"#86813b",base05:"#948e48",base06:"#ccc37a",base07:"#faf0a5",base08:"#c35359",base09:"#b36144",base0A:"#a88339",base0B:"#18974e",base0C:"#75a738",base0D:"#477ca1",base0E:"#8868b3",base0F:"#b3588e"},e.exports=t.default},5364:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"mocha",author:"chris kempson (http://chriskempson.com)",base00:"#3B3228",base01:"#534636",base02:"#645240",base03:"#7e705a",base04:"#b8afad",base05:"#d0c8c6",base06:"#e9e1dd",base07:"#f5eeeb",base08:"#cb6077",base09:"#d28b71",base0A:"#f4bc87",base0B:"#beb55b",base0C:"#7bbda4",base0D:"#8ab3b5",base0E:"#a89bb9",base0F:"#bb9584"},e.exports=t.default},5610:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"monokai",author:"wimer hazenberg (http://www.monokai.nl)",base00:"#272822",base01:"#383830",base02:"#49483e",base03:"#75715e",base04:"#a59f85",base05:"#f8f8f2",base06:"#f5f4f1",base07:"#f9f8f5",base08:"#f92672",base09:"#fd971f",base0A:"#f4bf75",base0B:"#a6e22e",base0C:"#a1efe4",base0D:"#66d9ef",base0E:"#ae81ff",base0F:"#cc6633"},e.exports=t.default},4646:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"ocean",author:"chris kempson (http://chriskempson.com)",base00:"#2b303b",base01:"#343d46",base02:"#4f5b66",base03:"#65737e",base04:"#a7adba",base05:"#c0c5ce",base06:"#dfe1e8",base07:"#eff1f5",base08:"#bf616a",base09:"#d08770",base0A:"#ebcb8b",base0B:"#a3be8c",base0C:"#96b5b4",base0D:"#8fa1b3",base0E:"#b48ead",base0F:"#ab7967"},e.exports=t.default},8466:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"paraiso",author:"jan t. sott",base00:"#2f1e2e",base01:"#41323f",base02:"#4f424c",base03:"#776e71",base04:"#8d8687",base05:"#a39e9b",base06:"#b9b6b0",base07:"#e7e9db",base08:"#ef6155",base09:"#f99b15",base0A:"#fec418",base0B:"#48b685",base0C:"#5bc4bf",base0D:"#06b6ef",base0E:"#815ba4",base0F:"#e96ba8"},e.exports=t.default},5708:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"pop",author:"chris kempson (http://chriskempson.com)",base00:"#000000",base01:"#202020",base02:"#303030",base03:"#505050",base04:"#b0b0b0",base05:"#d0d0d0",base06:"#e0e0e0",base07:"#ffffff",base08:"#eb008a",base09:"#f29333",base0A:"#f8ca12",base0B:"#37b349",base0C:"#00aabb",base0D:"#0e5a94",base0E:"#b31e8d",base0F:"#7a2d00"},e.exports=t.default},1834:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"railscasts",author:"ryan bates (http://railscasts.com)",base00:"#2b2b2b",base01:"#272935",base02:"#3a4055",base03:"#5a647e",base04:"#d4cfc9",base05:"#e6e1dc",base06:"#f4f1ed",base07:"#f9f7f3",base08:"#da4939",base09:"#cc7833",base0A:"#ffc66d",base0B:"#a5c261",base0C:"#519f50",base0D:"#6d9cbe",base0E:"#b6b3eb",base0F:"#bc9458"},e.exports=t.default},5410:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"shapeshifter",author:"tyler benziger (http://tybenz.com)",base00:"#000000",base01:"#040404",base02:"#102015",base03:"#343434",base04:"#555555",base05:"#ababab",base06:"#e0e0e0",base07:"#f9f9f9",base08:"#e92f2f",base09:"#e09448",base0A:"#dddd13",base0B:"#0ed839",base0C:"#23edda",base0D:"#3b48e3",base0E:"#f996e2",base0F:"#69542d"},e.exports=t.default},7427:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"solarized",author:"ethan schoonover (http://ethanschoonover.com/solarized)",base00:"#002b36",base01:"#073642",base02:"#586e75",base03:"#657b83",base04:"#839496",base05:"#93a1a1",base06:"#eee8d5",base07:"#fdf6e3",base08:"#dc322f",base09:"#cb4b16",base0A:"#b58900",base0B:"#859900",base0C:"#2aa198",base0D:"#268bd2",base0E:"#6c71c4",base0F:"#d33682"},e.exports=t.default},3013:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"summerfruit",author:"christopher corley (http://cscorley.github.io/)",base00:"#151515",base01:"#202020",base02:"#303030",base03:"#505050",base04:"#B0B0B0",base05:"#D0D0D0",base06:"#E0E0E0",base07:"#FFFFFF",base08:"#FF0086",base09:"#FD8900",base0A:"#ABA800",base0B:"#00C918",base0C:"#1faaaa",base0D:"#3777E6",base0E:"#AD00A1",base0F:"#cc6633"},e.exports=t.default},2633:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"threezerotwofour",author:"jan t. sott (http://github.com/idleberg)",base00:"#090300",base01:"#3a3432",base02:"#4a4543",base03:"#5c5855",base04:"#807d7c",base05:"#a5a2a2",base06:"#d6d5d4",base07:"#f7f7f7",base08:"#db2d20",base09:"#e8bbd0",base0A:"#fded02",base0B:"#01a252",base0C:"#b5e4f4",base0D:"#01a0e4",base0E:"#a16a94",base0F:"#cdab53"},e.exports=t.default},6706:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"tomorrow",author:"chris kempson (http://chriskempson.com)",base00:"#1d1f21",base01:"#282a2e",base02:"#373b41",base03:"#969896",base04:"#b4b7b4",base05:"#c5c8c6",base06:"#e0e0e0",base07:"#ffffff",base08:"#cc6666",base09:"#de935f",base0A:"#f0c674",base0B:"#b5bd68",base0C:"#8abeb7",base0D:"#81a2be",base0E:"#b294bb",base0F:"#a3685a"},e.exports=t.default},9028:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"london tube",author:"jan t. sott",base00:"#231f20",base01:"#1c3f95",base02:"#5a5758",base03:"#737171",base04:"#959ca1",base05:"#d9d8d8",base06:"#e7e7e8",base07:"#ffffff",base08:"#ee2e24",base09:"#f386a1",base0A:"#ffd204",base0B:"#00853e",base0C:"#85cebc",base0D:"#009ddc",base0E:"#98005d",base0F:"#b06110"},e.exports=t.default},1899:function(e,t){"use strict";t.__esModule=!0,t.default={scheme:"twilight",author:"david hart (http://hart-dev.com)",base00:"#1e1e1e",base01:"#323537",base02:"#464b50",base03:"#5f5a60",base04:"#838184",base05:"#a7a7a7",base06:"#c3c3c3",base07:"#ffffff",base08:"#cf6a4c",base09:"#cda869",base0A:"#f9ee98",base0B:"#8f9d6a",base0C:"#afc4db",base0D:"#7587a6",base0E:"#9b859d",base0F:"#9b703f"},e.exports=t.default},8168:function(e,t,n){var r=n(9092),i={};for(var a in r)r.hasOwnProperty(a)&&(i[r[a]]=a);var o=e.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var s in o)if(o.hasOwnProperty(s)){if(!("channels"in o[s]))throw new Error("missing channels property: "+s);if(!("labels"in o[s]))throw new Error("missing channel labels property: "+s);if(o[s].labels.length!==o[s].channels)throw new Error("channel and label counts mismatch: "+s);var c=o[s].channels,u=o[s].labels;delete o[s].channels,delete o[s].labels,Object.defineProperty(o[s],"channels",{value:c}),Object.defineProperty(o[s],"labels",{value:u})}o.rgb.hsl=function(e){var t,n,r=e[0]/255,i=e[1]/255,a=e[2]/255,o=Math.min(r,i,a),s=Math.max(r,i,a),c=s-o;return s===o?t=0:r===s?t=(i-a)/c:i===s?t=2+(a-r)/c:a===s&&(t=4+(r-i)/c),(t=Math.min(60*t,360))<0&&(t+=360),n=(o+s)/2,[t,100*(s===o?0:n<=.5?c/(s+o):c/(2-s-o)),100*n]},o.rgb.hsv=function(e){var t,n,r,i,a,o=e[0]/255,s=e[1]/255,c=e[2]/255,u=Math.max(o,s,c),d=u-Math.min(o,s,c),l=function(e){return(u-e)/6/d+.5};return 0===d?i=a=0:(a=d/u,t=l(o),n=l(s),r=l(c),o===u?i=r-n:s===u?i=1/3+t-r:c===u&&(i=2/3+n-t),i<0?i+=1:i>1&&(i-=1)),[360*i,100*a,100*u]},o.rgb.hwb=function(e){var t=e[0],n=e[1],r=e[2];return[o.rgb.hsl(e)[0],100*(1/255*Math.min(t,Math.min(n,r))),100*(r=1-1/255*Math.max(t,Math.max(n,r)))]},o.rgb.cmyk=function(e){var t,n=e[0]/255,r=e[1]/255,i=e[2]/255;return[100*((1-n-(t=Math.min(1-n,1-r,1-i)))/(1-t)||0),100*((1-r-t)/(1-t)||0),100*((1-i-t)/(1-t)||0),100*t]},o.rgb.keyword=function(e){var t=i[e];if(t)return t;var n,a,o,s=1/0;for(var c in r)if(r.hasOwnProperty(c)){var u=r[c],d=(a=e,o=u,Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)+Math.pow(a[2]-o[2],2));d<s&&(s=d,n=c)}return n},o.keyword.rgb=function(e){return r[e]},o.rgb.xyz=function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*t+.7152*n+.0722*r),100*(.0193*t+.1192*n+.9505*r)]},o.rgb.lab=function(e){var t=o.rgb.xyz(e),n=t[0],r=t[1],i=t[2];return r/=100,i/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},o.hsl.rgb=function(e){var t,n,r,i,a,o=e[0]/360,s=e[1]/100,c=e[2]/100;if(0===s)return[a=255*c,a,a];t=2*c-(n=c<.5?c*(1+s):c+s-c*s),i=[0,0,0];for(var u=0;u<3;u++)(r=o+1/3*-(u-1))<0&&r++,r>1&&r--,a=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t,i[u]=255*a;return i},o.hsl.hsv=function(e){var t=e[0],n=e[1]/100,r=e[2]/100,i=n,a=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,i*=a<=1?a:2-a,[t,100*(0===r?2*i/(a+i):2*n/(r+n)),100*((r+n)/2)]},o.hsv.rgb=function(e){var t=e[0]/60,n=e[1]/100,r=e[2]/100,i=Math.floor(t)%6,a=t-Math.floor(t),o=255*r*(1-n),s=255*r*(1-n*a),c=255*r*(1-n*(1-a));switch(r*=255,i){case 0:return[r,c,o];case 1:return[s,r,o];case 2:return[o,r,c];case 3:return[o,s,r];case 4:return[c,o,r];case 5:return[r,o,s]}},o.hsv.hsl=function(e){var t,n,r,i=e[0],a=e[1]/100,o=e[2]/100,s=Math.max(o,.01);return r=(2-a)*o,n=a*s,[i,100*(n=(n/=(t=(2-a)*s)<=1?t:2-t)||0),100*(r/=2)]},o.hwb.rgb=function(e){var t,n,r,i,a,o,s,c=e[0]/360,u=e[1]/100,d=e[2]/100,l=u+d;switch(l>1&&(u/=l,d/=l),r=6*c-(t=Math.floor(6*c)),0!=(1&t)&&(r=1-r),i=u+r*((n=1-d)-u),t){default:case 6:case 0:a=n,o=i,s=u;break;case 1:a=i,o=n,s=u;break;case 2:a=u,o=n,s=i;break;case 3:a=u,o=i,s=n;break;case 4:a=i,o=u,s=n;break;case 5:a=n,o=u,s=i}return[255*a,255*o,255*s]},o.cmyk.rgb=function(e){var t=e[0]/100,n=e[1]/100,r=e[2]/100,i=e[3]/100;return[255*(1-Math.min(1,t*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},o.xyz.rgb=function(e){var t,n,r,i=e[0]/100,a=e[1]/100,o=e[2]/100;return n=-.9689*i+1.8758*a+.0415*o,r=.0557*i+-.204*a+1.057*o,t=(t=3.2406*i+-1.5372*a+-.4986*o)>.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(t=Math.min(Math.max(0,t),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},o.xyz.lab=function(e){var t=e[0],n=e[1],r=e[2];return n/=100,r/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(t-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},o.lab.xyz=function(e){var t,n,r,i=e[0];t=e[1]/500+(n=(i+16)/116),r=n-e[2]/200;var a=Math.pow(n,3),o=Math.pow(t,3),s=Math.pow(r,3);return n=a>.008856?a:(n-16/116)/7.787,t=o>.008856?o:(t-16/116)/7.787,r=s>.008856?s:(r-16/116)/7.787,[t*=95.047,n*=100,r*=108.883]},o.lab.lch=function(e){var t,n=e[0],r=e[1],i=e[2];return(t=360*Math.atan2(i,r)/2/Math.PI)<0&&(t+=360),[n,Math.sqrt(r*r+i*i),t]},o.lch.lab=function(e){var t,n=e[0],r=e[1];return t=e[2]/360*2*Math.PI,[n,r*Math.cos(t),r*Math.sin(t)]},o.rgb.ansi16=function(e){var t=e[0],n=e[1],r=e[2],i=1 in arguments?arguments[1]:o.rgb.hsv(e)[2];if(0===(i=Math.round(i/50)))return 30;var a=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(t/255));return 2===i&&(a+=60),a},o.hsv.ansi16=function(e){return o.rgb.ansi16(o.hsv.rgb(e),e[2])},o.rgb.ansi256=function(e){var t=e[0],n=e[1],r=e[2];return t===n&&n===r?t<8?16:t>248?231:Math.round((t-8)/247*24)+232:16+36*Math.round(t/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},o.ansi16.rgb=function(e){var t=e%10;if(0===t||7===t)return e>50&&(t+=3.5),[t=t/10.5*255,t,t];var n=.5*(1+~~(e>50));return[(1&t)*n*255,(t>>1&1)*n*255,(t>>2&1)*n*255]},o.ansi256.rgb=function(e){if(e>=232){var t=10*(e-232)+8;return[t,t,t]}var n;return e-=16,[Math.floor(e/36)/5*255,Math.floor((n=e%36)/6)/5*255,n%6/5*255]},o.rgb.hex=function(e){var t=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},o.hex.rgb=function(e){var t=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];var n=t[0];3===t[0].length&&(n=n.split("").map((function(e){return e+e})).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},o.rgb.hcg=function(e){var t,n=e[0]/255,r=e[1]/255,i=e[2]/255,a=Math.max(Math.max(n,r),i),o=Math.min(Math.min(n,r),i),s=a-o;return t=s<=0?0:a===n?(r-i)/s%6:a===r?2+(i-n)/s:4+(n-r)/s+4,t/=6,[360*(t%=1),100*s,100*(s<1?o/(1-s):0)]},o.hsl.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=1,i=0;return(r=n<.5?2*t*n:2*t*(1-n))<1&&(i=(n-.5*r)/(1-r)),[e[0],100*r,100*i]},o.hsv.hcg=function(e){var t=e[1]/100,n=e[2]/100,r=t*n,i=0;return r<1&&(i=(n-r)/(1-r)),[e[0],100*r,100*i]},o.hcg.rgb=function(e){var t=e[0]/360,n=e[1]/100,r=e[2]/100;if(0===n)return[255*r,255*r,255*r];var i,a=[0,0,0],o=t%1*6,s=o%1,c=1-s;switch(Math.floor(o)){case 0:a[0]=1,a[1]=s,a[2]=0;break;case 1:a[0]=c,a[1]=1,a[2]=0;break;case 2:a[0]=0,a[1]=1,a[2]=s;break;case 3:a[0]=0,a[1]=c,a[2]=1;break;case 4:a[0]=s,a[1]=0,a[2]=1;break;default:a[0]=1,a[1]=0,a[2]=c}return i=(1-n)*r,[255*(n*a[0]+i),255*(n*a[1]+i),255*(n*a[2]+i)]},o.hcg.hsv=function(e){var t=e[1]/100,n=t+e[2]/100*(1-t),r=0;return n>0&&(r=t/n),[e[0],100*r,100*n]},o.hcg.hsl=function(e){var t=e[1]/100,n=e[2]/100*(1-t)+.5*t,r=0;return n>0&&n<.5?r=t/(2*n):n>=.5&&n<1&&(r=t/(2*(1-n))),[e[0],100*r,100*n]},o.hcg.hwb=function(e){var t=e[1]/100,n=t+e[2]/100*(1-t);return[e[0],100*(n-t),100*(1-n)]},o.hwb.hcg=function(e){var t=e[1]/100,n=1-e[2]/100,r=n-t,i=0;return r<1&&(i=(n-r)/(1-r)),[e[0],100*r,100*i]},o.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},o.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},o.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},o.gray.hsl=o.gray.hsv=function(e){return[0,0,e[0]]},o.gray.hwb=function(e){return[0,100,e[0]]},o.gray.cmyk=function(e){return[0,0,0,e[0]]},o.gray.lab=function(e){return[e[0],0,0]},o.gray.hex=function(e){var t=255&Math.round(e[0]/100*255),n=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(n.length)+n},o.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},2085:function(e,t,n){var r=n(8168),i=n(4111),a={};Object.keys(r).forEach((function(e){a[e]={},Object.defineProperty(a[e],"channels",{value:r[e].channels}),Object.defineProperty(a[e],"labels",{value:r[e].labels});var t=i(e);Object.keys(t).forEach((function(n){var r=t[n];a[e][n]=function(e){var t=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var n=e(t);if("object"==typeof n)for(var r=n.length,i=0;i<r;i++)n[i]=Math.round(n[i]);return n};return"conversion"in e&&(t.conversion=e.conversion),t}(r),a[e][n].raw=function(e){var t=function(t){return null==t?t:(arguments.length>1&&(t=Array.prototype.slice.call(arguments)),e(t))};return"conversion"in e&&(t.conversion=e.conversion),t}(r)}))})),e.exports=a},9092:function(e){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},4111:function(e,t,n){var r=n(8168);function i(e){var t=function(){for(var e={},t=Object.keys(r),n=t.length,i=0;i<n;i++)e[t[i]]={distance:-1,parent:null};return e}(),n=[e];for(t[e].distance=0;n.length;)for(var i=n.pop(),a=Object.keys(r[i]),o=a.length,s=0;s<o;s++){var c=a[s],u=t[c];-1===u.distance&&(u.distance=t[i].distance+1,u.parent=i,n.unshift(c))}return t}function a(e,t){return function(n){return t(e(n))}}function o(e,t){for(var n=[t[e].parent,e],i=r[t[e].parent][e],o=t[e].parent;t[o].parent;)n.unshift(t[o].parent),i=a(r[t[o].parent][o],i),o=t[o].parent;return i.conversion=n,i}e.exports=function(e){for(var t=i(e),n={},r=Object.keys(t),a=r.length,s=0;s<a;s++){var c=r[s];null!==t[c].parent&&(n[c]=o(c,t))}return n}},8874:function(e){"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},9818:function(e,t,n){var r=n(8874),i=n(6851),a={};for(var o in r)r.hasOwnProperty(o)&&(a[r[o]]=o);var s=e.exports={to:{},get:{}};function c(e,t,n){return Math.min(Math.max(t,e),n)}function u(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}s.get=function(e){var t,n;switch(e.substring(0,3).toLowerCase()){case"hsl":t=s.get.hsl(e),n="hsl";break;case"hwb":t=s.get.hwb(e),n="hwb";break;default:t=s.get.rgb(e),n="rgb"}return t?{model:n,value:t}:null},s.get.rgb=function(e){if(!e)return null;var t,n,i,a=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=t[2],t=t[1],n=0;n<3;n++){var o=2*n;a[n]=parseInt(t.slice(o,o+2),16)}i&&(a[3]=parseInt(i,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(i=(t=t[1])[3],n=0;n<3;n++)a[n]=parseInt(t[n]+t[n],16);i&&(a[3]=parseInt(i+i,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(n=0;n<3;n++)a[n]=parseInt(t[n+1],0);t[4]&&(a[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(a=r[t[1]])?(a[3]=1,a):null:null;for(n=0;n<3;n++)a[n]=Math.round(2.55*parseFloat(t[n+1]));t[4]&&(a[3]=parseFloat(t[4]))}for(n=0;n<3;n++)a[n]=c(a[n],0,255);return a[3]=c(a[3],0,1),a},s.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,c(parseFloat(t[2]),0,100),c(parseFloat(t[3]),0,100),c(isNaN(n)?1:n,0,1)]}return null},s.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,c(parseFloat(t[2]),0,100),c(parseFloat(t[3]),0,100),c(isNaN(n)?1:n,0,1)]}return null},s.to.hex=function(){var e=i(arguments);return"#"+u(e[0])+u(e[1])+u(e[2])+(e[3]<1?u(Math.round(255*e[3])):"")},s.to.rgb=function(){var e=i(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},s.to.rgb.percent=function(){var e=i(arguments),t=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+n+"%, "+r+"%)":"rgba("+t+"%, "+n+"%, "+r+"%, "+e[3]+")"},s.to.hsl=function(){var e=i(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},s.to.hwb=function(){var e=i(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},s.to.keyword=function(e){return a[e.slice(0,3)]}},6767:function(e,t,n){"use strict";var r=n(9818),i=n(2085),a=[].slice,o=["keyword","gray","hex"],s={};Object.keys(i).forEach((function(e){s[a.call(i[e].labels).sort().join("")]=e}));var c={};function u(e,t){if(!(this instanceof u))return new u(e,t);if(t&&t in o&&(t=null),t&&!(t in i))throw new Error("Unknown model: "+t);var n,d;if(null==e)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(e instanceof u)this.model=e.model,this.color=e.color.slice(),this.valpha=e.valpha;else if("string"==typeof e){var l=r.get(e);if(null===l)throw new Error("Unable to parse color from string: "+e);this.model=l.model,d=i[this.model].channels,this.color=l.value.slice(0,d),this.valpha="number"==typeof l.value[d]?l.value[d]:1}else if(e.length){this.model=t||"rgb",d=i[this.model].channels;var p=a.call(e,0,d);this.color=f(p,d),this.valpha="number"==typeof e[d]?e[d]:1}else if("number"==typeof e)e&=16777215,this.model="rgb",this.color=[e>>16&255,e>>8&255,255&e],this.valpha=1;else{this.valpha=1;var m=Object.keys(e);"alpha"in e&&(m.splice(m.indexOf("alpha"),1),this.valpha="number"==typeof e.alpha?e.alpha:0);var h=m.sort().join("");if(!(h in s))throw new Error("Unable to parse color from object: "+JSON.stringify(e));this.model=s[h];var v=i[this.model].labels,g=[];for(n=0;n<v.length;n++)g.push(e[v[n]]);this.color=f(g)}if(c[this.model])for(d=i[this.model].channels,n=0;n<d;n++){var I=c[this.model][n];I&&(this.color[n]=I(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function d(e,t,n){return(e=Array.isArray(e)?e:[e]).forEach((function(e){(c[e]||(c[e]=[]))[t]=n})),e=e[0],function(r){var i;return arguments.length?(n&&(r=n(r)),(i=this[e]()).color[t]=r,i):(i=this[e]().color[t],n&&(i=n(i)),i)}}function l(e){return function(t){return Math.max(0,Math.min(e,t))}}function p(e){return Array.isArray(e)?e:[e]}function f(e,t){for(var n=0;n<t;n++)"number"!=typeof e[n]&&(e[n]=0);return e}u.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(e){var t=this.model in r.to?this:this.rgb(),n=1===(t=t.round("number"==typeof e?e:1)).valpha?t.color:t.color.concat(this.valpha);return r.to[t.model](n)},percentString:function(e){var t=this.rgb().round("number"==typeof e?e:1),n=1===t.valpha?t.color:t.color.concat(this.valpha);return r.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var e={},t=i[this.model].channels,n=i[this.model].labels,r=0;r<t;r++)e[n[r]]=this.color[r];return 1!==this.valpha&&(e.alpha=this.valpha),e},unitArray:function(){var e=this.rgb().color;return e[0]/=255,e[1]/=255,e[2]/=255,1!==this.valpha&&e.push(this.valpha),e},unitObject:function(){var e=this.rgb().object();return e.r/=255,e.g/=255,e.b/=255,1!==this.valpha&&(e.alpha=this.valpha),e},round:function(e){return e=Math.max(e||0,0),new u(this.color.map(function(e){return function(t){return function(e,t){return Number(e.toFixed(t))}(t,e)}}(e)).concat(this.valpha),this.model)},alpha:function(e){return arguments.length?new u(this.color.concat(Math.max(0,Math.min(1,e))),this.model):this.valpha},red:d("rgb",0,l(255)),green:d("rgb",1,l(255)),blue:d("rgb",2,l(255)),hue:d(["hsl","hsv","hsl","hwb","hcg"],0,(function(e){return(e%360+360)%360})),saturationl:d("hsl",1,l(100)),lightness:d("hsl",2,l(100)),saturationv:d("hsv",1,l(100)),value:d("hsv",2,l(100)),chroma:d("hcg",1,l(100)),gray:d("hcg",2,l(100)),white:d("hwb",1,l(100)),wblack:d("hwb",2,l(100)),cyan:d("cmyk",0,l(100)),magenta:d("cmyk",1,l(100)),yellow:d("cmyk",2,l(100)),black:d("cmyk",3,l(100)),x:d("xyz",0,l(100)),y:d("xyz",1,l(100)),z:d("xyz",2,l(100)),l:d("lab",0,l(100)),a:d("lab",1),b:d("lab",2),keyword:function(e){return arguments.length?new u(e):i[this.model].keyword(this.color)},hex:function(e){return arguments.length?new u(e):r.to.hex(this.rgb().round().color)},rgbNumber:function(){var e=this.rgb().color;return(255&e[0])<<16|(255&e[1])<<8|255&e[2]},luminosity:function(){for(var e=this.rgb().color,t=[],n=0;n<e.length;n++){var r=e[n]/255;t[n]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast:function(e){var t=this.luminosity(),n=e.luminosity();return t>n?(t+.05)/(n+.05):(n+.05)/(t+.05)},level:function(e){var t=this.contrast(e);return t>=7.1?"AAA":t>=4.5?"AA":""},isDark:function(){var e=this.rgb().color;return(299*e[0]+587*e[1]+114*e[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var e=this.rgb(),t=0;t<3;t++)e.color[t]=255-e.color[t];return e},lighten:function(e){var t=this.hsl();return t.color[2]+=t.color[2]*e,t},darken:function(e){var t=this.hsl();return t.color[2]-=t.color[2]*e,t},saturate:function(e){var t=this.hsl();return t.color[1]+=t.color[1]*e,t},desaturate:function(e){var t=this.hsl();return t.color[1]-=t.color[1]*e,t},whiten:function(e){var t=this.hwb();return t.color[1]+=t.color[1]*e,t},blacken:function(e){var t=this.hwb();return t.color[2]+=t.color[2]*e,t},grayscale:function(){var e=this.rgb().color,t=.3*e[0]+.59*e[1]+.11*e[2];return u.rgb(t,t,t)},fade:function(e){return this.alpha(this.valpha-this.valpha*e)},opaquer:function(e){return this.alpha(this.valpha+this.valpha*e)},rotate:function(e){var t=this.hsl(),n=t.color[0];return n=(n=(n+e)%360)<0?360+n:n,t.color[0]=n,t},mix:function(e,t){if(!e||!e.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof e);var n=e.rgb(),r=this.rgb(),i=void 0===t?.5:t,a=2*i-1,o=n.alpha()-r.alpha(),s=((a*o==-1?a:(a+o)/(1+a*o))+1)/2,c=1-s;return u.rgb(s*n.red()+c*r.red(),s*n.green()+c*r.green(),s*n.blue()+c*r.blue(),n.alpha()*i+r.alpha()*(1-i))}},Object.keys(i).forEach((function(e){if(-1===o.indexOf(e)){var t=i[e].channels;u.prototype[e]=function(){if(this.model===e)return new u(this);if(arguments.length)return new u(arguments,e);var n="number"==typeof arguments[t]?t:this.valpha;return new u(p(i[this.model][e].raw(this.color)).concat(n),e)},u[e]=function(n){return"number"==typeof n&&(n=f(a.call(arguments),t)),new u(n,e)}}})),e.exports=u},8024:function(e,t,n){var r="__lodash_placeholder__",i=32,a=1/0,o=NaN,s=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",i],["partialRight",64],["rearg",256]],c="[object Function]",u="[object GeneratorFunction]",d=/^\s+|\s+$/g,l=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,p=/\{\n\/\* \[wrapped with (.+)\] \*/,f=/,? & /,m=/^[-+]0x[0-9a-f]+$/i,h=/^0b[01]+$/i,v=/^\[object .+?Constructor\]$/,g=/^0o[0-7]+$/i,I=/^(?:0|[1-9]\d*)$/,y=parseInt,b="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,w="object"==typeof self&&self&&self.Object===Object&&self,U=b||w||Function("return this")();function S(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function D(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,r){var i=e.length,a=n+(r?1:-1);for(;r?a--:++a<i;)if(t(e[a],a,e))return a;return-1}(e,N,n);var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,0)>-1}function N(e){return e!=e}function P(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&r++;return r}function A(e,t){for(var n=-1,i=e.length,a=0,o=[];++n<i;){var s=e[n];s!==t&&s!==r||(e[n]=r,o[a++]=n)}return o}var M,T,E,C=Function.prototype,R=Object.prototype,O=U["__core-js_shared__"],x=(M=/[^.]+$/.exec(O&&O.keys&&O.keys.IE_PROTO||""))?"Symbol(src)_1."+M:"",L=C.toString,k=R.hasOwnProperty,F=R.toString,j=RegExp("^"+L.call(k).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_=Object.create,B=Math.max,G=Math.min,V=(T=Q(Object,"defineProperty"),(E=Q.name)&&E.length>2?T:void 0);function q(e){return oe(e)?_(e):{}}function H(e){return!(!oe(e)||function(e){return!!x&&x in e}(e))&&(function(e){var t=oe(e)?F.call(e):"";return t==c||t==u}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}(e)?j:v).test(function(e){if(null!=e){try{return L.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e))}function W(e,t,n,r){for(var i=-1,a=e.length,o=n.length,s=-1,c=t.length,u=B(a-o,0),d=Array(c+u),l=!r;++s<c;)d[s]=t[s];for(;++i<o;)(l||i<a)&&(d[n[i]]=e[i]);for(;u--;)d[s++]=e[i++];return d}function z(e,t,n,r){for(var i=-1,a=e.length,o=-1,s=n.length,c=-1,u=t.length,d=B(a-s,0),l=Array(d+u),p=!r;++i<d;)l[i]=e[i];for(var f=i;++c<u;)l[f+c]=t[c];for(;++o<s;)(p||i<a)&&(l[f+n[o]]=e[i++]);return l}function K(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=q(e.prototype),r=e.apply(n,t);return oe(r)?r:n}}function Y(e,t,n,r,i,a,o,s,c,u){var d=128&t,l=1&t,p=2&t,f=24&t,m=512&t,h=p?void 0:K(e);return function v(){for(var g=arguments.length,I=Array(g),y=g;y--;)I[y]=arguments[y];if(f)var b=Z(v),w=P(I,b);if(r&&(I=W(I,r,i,f)),a&&(I=z(I,a,o,f)),g-=w,f&&g<u){var S=A(I,b);return $(e,t,Y,v.placeholder,n,I,S,s,c,u-g)}var D=l?n:this,N=p?D[e]:e;return g=I.length,s?I=ne(I,s):m&&g>1&&I.reverse(),d&&c<g&&(I.length=c),this&&this!==U&&this instanceof v&&(N=h||K(N)),N.apply(D,I)}}function $(e,t,n,r,a,o,s,c,u,d){var l=8&t;t|=l?i:64,4&(t&=~(l?64:i))||(t&=-4);var p=n(e,t,a,l?o:void 0,l?s:void 0,l?void 0:o,l?void 0:s,c,u,d);return p.placeholder=r,re(p,e,t)}function J(e,t,n,r,a,o,s,c){var u=2&t;if(!u&&"function"!=typeof e)throw new TypeError("Expected a function");var d=r?r.length:0;if(d||(t&=-97,r=a=void 0),s=void 0===s?s:B(ce(s),0),c=void 0===c?c:ce(c),d-=a?a.length:0,64&t){var l=r,p=a;r=a=void 0}var f=[e,t,n,r,a,l,p,o,s,c];if(e=f[0],t=f[1],n=f[2],r=f[3],a=f[4],!(c=f[9]=null==f[9]?u?0:e.length:B(f[9]-d,0))&&24&t&&(t&=-25),t&&1!=t)m=8==t||16==t?function(e,t,n){var r=K(e);return function i(){for(var a=arguments.length,o=Array(a),s=a,c=Z(i);s--;)o[s]=arguments[s];var u=a<3&&o[0]!==c&&o[a-1]!==c?[]:A(o,c);return(a-=u.length)<n?$(e,t,Y,i.placeholder,void 0,o,u,void 0,void 0,n-a):S(this&&this!==U&&this instanceof i?r:e,this,o)}}(e,t,c):t!=i&&33!=t||a.length?Y.apply(void 0,f):function(e,t,n,r){var i=1&t,a=K(e);return function t(){for(var o=-1,s=arguments.length,c=-1,u=r.length,d=Array(u+s),l=this&&this!==U&&this instanceof t?a:e;++c<u;)d[c]=r[c];for(;s--;)d[c++]=arguments[++o];return S(l,i?n:this,d)}}(e,t,n,r);else var m=function(e,t,n){var r=1&t,i=K(e);return function t(){return(this&&this!==U&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,n);return re(m,e,t)}function Z(e){return e.placeholder}function Q(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return H(n)?n:void 0}function X(e){var t=e.match(p);return t?t[1].split(f):[]}function ee(e,t){var n=t.length,r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(l,"{\n/* [wrapped with "+t+"] */\n")}function te(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||I.test(e))&&e>-1&&e%1==0&&e<t}function ne(e,t){for(var n=e.length,r=G(t.length,n),i=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}(e);r--;){var a=t[r];e[r]=te(a,n)?i[a]:void 0}return e}var re=V?function(e,t,n){var r,i=t+"";return V(e,"toString",{configurable:!0,enumerable:!1,value:(r=ee(i,ie(X(i),n)),function(){return r})})}:function(e){return e};function ie(e,t){return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n,e););}(s,(function(n){var r="_."+n[0];t&n[1]&&!D(e,r)&&e.push(r)})),e.sort()}function ae(e,t,n){var r=J(e,8,void 0,void 0,void 0,void 0,void 0,t=n?void 0:t);return r.placeholder=ae.placeholder,r}function oe(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function se(e){return e?(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==F.call(e)}(e))return o;if(oe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=oe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(d,"");var n=h.test(e);return n||g.test(e)?y(e.slice(2),n?2:8):m.test(e)?o:+e}(e))===a||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function ce(e){var t=se(e),n=t%1;return t==t?n?t-n:t:0}ae.placeholder={},e.exports=ae},4002:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.yuv2rgb=function(e){var t,n,r,i=e[0],a=e[1],o=e[2];return t=1*i+0*a+1.13983*o,n=1*i+-.39465*a+-.5806*o,r=1*i+2.02311*a+0*o,t=Math.min(Math.max(0,t),1),n=Math.min(Math.max(0,n),1),r=Math.min(Math.max(0,r),1),[255*t,255*n,255*r]},t.rgb2yuv=function(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255;return[.299*t+.587*n+.114*r,-.14713*t+-.28886*n+.436*r,.615*t+-.51499*n+-.10001*r]}},7274:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={invertBase16Theme:!0,createStyling:!0,getBase16Theme:!0,invertTheme:!0,Base16Theme:!0};Object.defineProperty(t,"Base16Theme",{enumerable:!0,get:function(){return i.Base16Theme}}),t.invertTheme=t.getBase16Theme=t.createStyling=t.invertBase16Theme=void 0;var i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==l(e)&&"function"!=typeof e)return{default:e};var t=d();if(t&&t.has(e))return t.get(e);var n={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var a=r?Object.getOwnPropertyDescriptor(e,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=e[i]}n.default=e,t&&t.set(e,n);return n}(n(9194)),a=u(n(6767)),o=u(n(8024)),s=n(4002),c=n(7212);function u(e){return e&&e.__esModule?e:{default:e}}function d(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}Object.keys(c).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}}))}));var g=i.default,I=Object.keys(g),y=function(e){return function(t){return{className:[t.className,e.className].filter(Boolean).join(" "),style:f(f({},t.style||{}),e.style||{})}}},b=function(e,t){var n=Object.keys(t);for(var r in e)-1===n.indexOf(r)&&n.push(r);return n.reduce((function(n,r){return n[r]=function(e,t){if(void 0===e)return t;if(void 0===t)return e;var n=l(e),r=l(t);switch(n){case"string":switch(r){case"string":return[t,e].filter(Boolean).join(" ");case"object":return y({className:e,style:t});case"function":return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return y({className:e})(t.apply(void 0,[n].concat(i)))}}break;case"object":switch(r){case"string":return y({className:t,style:e});case"object":return f(f({},t),e);case"function":return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return y({style:e})(t.apply(void 0,[n].concat(i)))}}break;case"function":switch(r){case"string":return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return e.apply(void 0,[y(n)({className:t})].concat(i))};case"object":return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return e.apply(void 0,[y(n)({style:t})].concat(i))};case"function":return function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return e.apply(void 0,[t.apply(void 0,[n].concat(i))].concat(i))}}}}(e[r],t[r]),n}),{})},w=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(null===t)return e;Array.isArray(t)||(t=[t]);var a=t.map((function(t){return e[t]})).filter(Boolean),o=a.reduce((function(e,t){return"string"==typeof t?e.className=[e.className,t].filter(Boolean).join(" "):"object"===l(t)?e.style=f(f({},e.style),t):"function"==typeof t&&(e=f(f({},e),t.apply(void 0,[e].concat(r)))),e}),{className:"",style:{}});return o.className||delete o.className,0===Object.keys(o.style).length&&delete o.style,o},U=function(e){return Object.keys(e).reduce((function(t,n){return t[n]=/^base/.test(n)?(r=e[n],o=(0,a.default)(r),c=h((0,s.rgb2yuv)(o.array()),3),u=c[0],d=c[1],l=c[2],p=[(i=u,i<.25?1:i<.5?.9-i:1.1-i),d,l],f=(0,s.yuv2rgb)(p),a.default.rgb(f).hex()):"scheme"===n?e[n]+":inverted":e[n],t;var r,i,o,c,u,d,l,p,f}),{})};t.invertBase16Theme=U;var S=(0,o.default)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.defaultBase16,i=void 0===r?g:r,a=t.base16Themes,s=void 0===a?null:a,c=N(n,s);c&&(n=f(f({},c),n));for(var u=I.reduce((function(e,t){return e[t]=n[t]||i[t],e}),{}),d=Object.keys(n).reduce((function(e,t){return-1===I.indexOf(t)?(e[t]=n[t],e):e}),{}),l=e(u),p=b(d,l),m=arguments.length,h=new Array(m>3?m-3:0),v=3;v<m;v++)h[v-3]=arguments[v];return(0,o.default)(w,2).apply(void 0,[p].concat(h))}),3);t.createStyling=S;var D=function(e){return!!e.extend},N=function(e,t){if(e&&D(e)&&e.extend&&(e=e.extend),"string"==typeof e){var n=h(e.split(":"),2),r=n[0],a=n[1];e=t?t[r]:i[r],"inverted"===a&&(e=U(e))}return e&&Object.prototype.hasOwnProperty.call(e,"base00")?e:void 0};t.getBase16Theme=N;t.invertTheme=function(e){return"string"==typeof e?"".concat(e,":inverted"):e&&D(e)&&e.extend?"string"==typeof e.extend?f(f({},e),{},{extend:"".concat(e.extend,":inverted")}):f(f({},e),{},{extend:U(e.extend)}):e?U(e):e}},7212:function(){},6884:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(7294)),i=o(n(5697)),a=o(n(4121));function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m(e);if(t){var i=m(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?f(e):t}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(s,e);var t,n,i,o=l(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),h(f(t=o.call(this,e)),"handleClick",(function(){t.setState({expanded:!t.state.expanded})})),t.state={expanded:!1},t}return t=s,(n=[{key:"render",value:function(){var e=this.props,t=e.styling,n=e.from,i=e.to,o=e.renderChildNodes,s=e.nodeType;return this.state.expanded?r.default.createElement("div",t("itemRange",this.state.expanded),o(this.props,n,i)):r.default.createElement("div",c({},t("itemRange",this.state.expanded),{onClick:this.handleClick}),r.default.createElement(a.default,{nodeType:s,styling:t,expanded:!1,onClick:this.handleClick,arrowStyle:"double"}),"".concat(n," ... ").concat(i))}}])&&u(t.prototype,n),i&&u(t,i),s}(r.default.Component);t.default=v,h(v,"propTypes",{styling:i.default.func.isRequired,from:i.default.number.isRequired,to:i.default.number.isRequired,renderChildNodes:i.default.func.isRequired,nodeType:i.default.string.isRequired})},9205:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(7294)),i=o(n(5697)),a=o(n(8207));function o(e){return e&&e.__esModule?e:{default:e}}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function u(e){return"".concat(e.length," ").concat(1!==e.length?"items":"item")}var d=function(e){var t=e.data,n=c(e,["data"]);return r.default.createElement(a.default,s({},n,{data:t,nodeType:"Array",nodeTypeIndicator:"[]",createItemString:u,expandable:t.length>0}))};d.propTypes={data:i.default.array};var l=d;t.default=l},4121:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(7294)),i=a(n(5697));function a(e){return e&&e.__esModule?e:{default:e}}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var s=function(e){var t=e.styling,n=e.arrowStyle,i=e.expanded,a=e.nodeType,s=e.onClick;return r.default.createElement("div",o({},t("arrowContainer",n),{onClick:s}),r.default.createElement("div",t(["arrow","arrowSign"],a,i,n),"\u25b6","double"===n&&r.default.createElement("div",t(["arrowSign","arrowSignInner"]),"\u25b6")))};s.propTypes={styling:i.default.func.isRequired,arrowStyle:i.default.oneOf(["single","double"]),expanded:i.default.bool.isRequired,nodeType:i.default.string.isRequired,onClick:i.default.func.isRequired},s.defaultProps={arrowStyle:"single"};var c=s;t.default=c},9364:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(7294)),i=a(n(8207));function a(e){return e&&e.__esModule?e:{default:e}}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function s(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){var n=0,r=!1;if(Number.isSafeInteger(e.size))n=e.size;else{var i,a=s(e);try{for(a.s();!(i=a.n()).done;){i.value;if(t&&n+1>t){r=!0;break}n+=1}}catch(o){a.e(o)}finally{a.f()}}return"".concat(r?">":"").concat(n," ").concat(1!==n?"entries":"entry")}var d=function(e){var t=o({},e);return r.default.createElement(i.default,o({},t,{nodeType:"Iterable",nodeTypeIndicator:"()",createItemString:u}))};t.default=d},8207:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n(7294)),i=u(n(5697)),a=u(n(4121)),o=u(n(1063)),s=u(n(5249)),c=u(n(6884));function u(e){return e&&e.__esModule?e:{default:e}}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var i=I(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v(this,n)}}function v(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?g(e):t}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function S(e,t,n){var i=e.nodeType,a=e.data,u=e.collectionLimit,d=e.circularCache,l=e.keyPath,p=e.postprocessValue,f=e.sortObjectKeys,m=[];return(0,o.default)(i,a,f,u,t,n).forEach((function(t){if(void 0!==t.to)m.push(r.default.createElement(c.default,U({},e,{key:"ItemRange--".concat(t.from,"-").concat(t.to),from:t.from,to:t.to,renderChildNodes:S})));else{var n=t.key,i=t.value,a=-1!==d.indexOf(i);m.push(r.default.createElement(s.default,U({},e,{postprocessValue:p,collectionLimit:u},{key:"Node--".concat(n),keyPath:[n].concat(b(l)),value:p(i),circularCache:[].concat(b(d),[i]),isCircular:a,hideRoot:!1})))}})),m}function D(e){return{expanded:!(!e.shouldExpandNode||e.isCircular)&&e.shouldExpandNode(e.keyPath,e.data,e.level)}}var N=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(s,e);var t,n,i,o=h(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),y(g(t=o.call(this,e)),"handleClick",(function(){t.props.expandable&&t.setState({expanded:!t.state.expanded})})),t.state=D(e),t}return t=s,(n=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=D(e);D(this.props).expanded!==t.expanded&&this.setState(t)}},{key:"shouldComponentUpdate",value:function(e,t){var n=this;return!!Object.keys(e).find((function(t){return"circularCache"!==t&&("keyPath"===t?e[t].join("/")!==n.props[t].join("/"):e[t]!==n.props[t])}))||t.expanded!==this.state.expanded}},{key:"render",value:function(){var e=this.props,t=e.getItemString,n=e.nodeTypeIndicator,i=e.nodeType,o=e.data,s=e.hideRoot,c=e.createItemString,u=e.styling,d=e.collectionLimit,l=e.keyPath,f=e.labelRenderer,m=e.expandable,h=this.state.expanded,v=h||s&&0===this.props.level?S(p(p({},this.props),{},{level:this.props.level+1})):null,g=t(i,o,r.default.createElement("span",u("nestedNodeItemType",h),n),c(o,d),l),I=[l,i,h,m];return s?r.default.createElement("li",u.apply(void 0,["rootNode"].concat(I)),r.default.createElement("ul",u.apply(void 0,["rootNodeChildren"].concat(I)),v)):r.default.createElement("li",u.apply(void 0,["nestedNode"].concat(I)),m&&r.default.createElement(a.default,{styling:u,nodeType:i,expanded:h,onClick:this.handleClick}),r.default.createElement("label",U({},u.apply(void 0,[["label","nestedNodeLabel"]].concat(I)),{onClick:this.handleClick}),f.apply(void 0,I)),r.default.createElement("span",U({},u.apply(void 0,["nestedNodeItemString"].concat(I)),{onClick:this.handleClick}),g),r.default.createElement("ul",u.apply(void 0,["nestedNodeChildren"].concat(I)),v))}}])&&f(t.prototype,n),i&&f(t,i),s}(r.default.Component);t.default=N,y(N,"propTypes",{getItemString:i.default.func.isRequired,nodeTypeIndicator:i.default.any,nodeType:i.default.string.isRequired,data:i.default.any,hideRoot:i.default.bool.isRequired,createItemString:i.default.func.isRequired,styling:i.default.func.isRequired,collectionLimit:i.default.number,keyPath:i.default.arrayOf(i.default.oneOfType([i.default.string,i.default.number])).isRequired,labelRenderer:i.default.func.isRequired,shouldExpandNode:i.default.func,level:i.default.number.isRequired,sortObjectKeys:i.default.oneOfType([i.default.func,i.default.bool]),isCircular:i.default.bool,expandable:i.default.bool}),y(N,"defaultProps",{data:[],circularCache:[],level:0,expandable:!0})},5249:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=d(n(7294)),i=d(n(5697)),a=d(n(9869)),o=d(n(9894)),s=d(n(9205)),c=d(n(9364)),u=d(n(6399));function d(e){return e&&e.__esModule?e:{default:e}}function l(){return(l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){m(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var v=function(e){var t=e.getItemString,n=e.keyPath,i=e.labelRenderer,d=e.styling,p=e.value,m=e.valueRenderer,v=e.isCustomNode,g=h(e,["getItemString","keyPath","labelRenderer","styling","value","valueRenderer","isCustomNode"]),I=v(p)?"Custom":(0,a.default)(p),y={getItemString:t,key:n[0],keyPath:n,labelRenderer:i,nodeType:I,styling:d,value:p,valueRenderer:m},b=f(f(f({},g),y),{},{data:p,isCustomNode:v});switch(I){case"Object":case"Error":case"WeakMap":case"WeakSet":return r.default.createElement(o.default,b);case"Array":return r.default.createElement(s.default,b);case"Iterable":case"Map":case"Set":return r.default.createElement(c.default,b);case"String":return r.default.createElement(u.default,l({},y,{valueGetter:function(e){return'"'.concat(e,'"')}}));case"Number":return r.default.createElement(u.default,y);case"Boolean":return r.default.createElement(u.default,l({},y,{valueGetter:function(e){return e?"true":"false"}}));case"Date":return r.default.createElement(u.default,l({},y,{valueGetter:function(e){return e.toISOString()}}));case"Null":return r.default.createElement(u.default,l({},y,{valueGetter:function(){return"null"}}));case"Undefined":return r.default.createElement(u.default,l({},y,{valueGetter:function(){return"undefined"}}));case"Function":case"Symbol":return r.default.createElement(u.default,l({},y,{valueGetter:function(e){return e.toString()}}));case"Custom":return r.default.createElement(u.default,y);default:return r.default.createElement(u.default,l({},y,{valueGetter:function(){return"<".concat(I,">")}}))}};v.propTypes={getItemString:i.default.func.isRequired,keyPath:i.default.arrayOf(i.default.oneOfType([i.default.string,i.default.number]).isRequired).isRequired,labelRenderer:i.default.func.isRequired,styling:i.default.func.isRequired,value:i.default.any,valueRenderer:i.default.func.isRequired,isCustomNode:i.default.func.isRequired};var g=v;t.default=g},9894:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(7294)),i=o(n(5697)),a=o(n(8207));function o(e){return e&&e.__esModule?e:{default:e}}function s(){return(s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function c(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function u(e){var t=Object.getOwnPropertyNames(e).length;return"".concat(t," ").concat(1!==t?"keys":"key")}var d=function(e){var t=e.data,n=c(e,["data"]);return r.default.createElement(a.default,s({},n,{data:t,nodeType:"Object",nodeTypeIndicator:"Error"===n.nodeType?"Error()":"{}",createItemString:u,expandable:Object.getOwnPropertyNames(t).length>0}))};d.propTypes={data:i.default.object,nodeType:i.default.string.isRequired};var l=d;t.default=l},6399:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n(7294)),i=a(n(5697));function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var c=function(e){var t=e.nodeType,n=e.styling,i=e.labelRenderer,a=e.keyPath,s=e.valueRenderer,c=e.value,u=e.valueGetter,d=void 0===u?function(e){return e}:u;return r.default.createElement("li",n("value",t,a),r.default.createElement("label",n(["label","valueLabel"],t,a),i(a,t,!1,!1)),r.default.createElement("span",n("valueText",t,a),s.apply(void 0,[d(c),c].concat(o(a)))))};c.propTypes={nodeType:i.default.string.isRequired,styling:i.default.func.isRequired,labelRenderer:i.default.func.isRequired,keyPath:i.default.arrayOf(i.default.oneOfType([i.default.string,i.default.number]).isRequired).isRequired,valueRenderer:i.default.func.isRequired,value:i.default.any,valueGetter:i.default.func};var u=c;t.default=u},170:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=n(7274),a=(r=n(9561))&&r.__esModule?r:{default:r};function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(e){return{String:e.STRING_COLOR,Date:e.DATE_COLOR,Number:e.NUMBER_COLOR,Boolean:e.BOOLEAN_COLOR,Null:e.NULL_COLOR,Undefined:e.UNDEFINED_COLOR,Function:e.FUNCTION_COLOR,Symbol:e.SYMBOL_COLOR}},d=(0,i.createStyling)((function(e){var t=function(e){return{BACKGROUND_COLOR:e.base00,TEXT_COLOR:e.base07,STRING_COLOR:e.base0B,DATE_COLOR:e.base0B,NUMBER_COLOR:e.base09,BOOLEAN_COLOR:e.base09,NULL_COLOR:e.base08,UNDEFINED_COLOR:e.base08,FUNCTION_COLOR:e.base08,SYMBOL_COLOR:e.base08,LABEL_COLOR:e.base0D,ARROW_COLOR:e.base0D,ITEM_STRING_COLOR:e.base0B,ITEM_STRING_EXPANDED_COLOR:e.base03}}(e);return{tree:{border:0,padding:0,marginTop:"0.5em",marginBottom:"0.5em",marginLeft:"0.125em",marginRight:0,listStyle:"none",MozUserSelect:"none",WebkitUserSelect:"none",backgroundColor:t.BACKGROUND_COLOR},value:function(e,t,n){return{style:s(s({},e.style),{},{paddingTop:"0.25em",paddingRight:0,marginLeft:"0.875em",WebkitUserSelect:"text",MozUserSelect:"text",wordWrap:"break-word",paddingLeft:n.length>1?"2.125em":"1.25em",textIndent:"-0.5em",wordBreak:"break-all"})}},label:{display:"inline-block",color:t.LABEL_COLOR},valueLabel:{margin:"0 0.5em 0 0"},valueText:function(e,n){return{style:s(s({},e.style),{},{color:u(t)[n]})}},itemRange:function(e,n){return{style:{paddingTop:n?0:"0.25em",cursor:"pointer",color:t.LABEL_COLOR}}},arrow:function(e,t,n){return{style:s(s({},e.style),{},{marginLeft:0,transition:"150ms",WebkitTransition:"150ms",MozTransition:"150ms",WebkitTransform:n?"rotateZ(90deg)":"rotateZ(0deg)",MozTransform:n?"rotateZ(90deg)":"rotateZ(0deg)",transform:n?"rotateZ(90deg)":"rotateZ(0deg)",transformOrigin:"45% 50%",WebkitTransformOrigin:"45% 50%",MozTransformOrigin:"45% 50%",position:"relative",lineHeight:"1.1em",fontSize:"0.75em"})}},arrowContainer:function(e,t){return{style:s(s({},e.style),{},{display:"inline-block",paddingRight:"0.5em",paddingLeft:"double"===t?"1em":0,cursor:"pointer"})}},arrowSign:{color:t.ARROW_COLOR},arrowSignInner:{position:"absolute",top:0,left:"-0.4em"},nestedNode:function(e,t,n,r,i){return{style:s(s({},e.style),{},{position:"relative",paddingTop:"0.25em",marginLeft:t.length>1?"0.875em":0,paddingLeft:i?0:"1.125em"})}},rootNode:{padding:0,margin:0},nestedNodeLabel:function(e,t,n,r,i){return{style:s(s({},e.style),{},{margin:0,padding:0,WebkitUserSelect:i?"inherit":"text",MozUserSelect:i?"inherit":"text",cursor:i?"pointer":"default"})}},nestedNodeItemString:function(e,n,r,i){return{style:s(s({},e.style),{},{paddingLeft:"0.5em",cursor:"default",color:i?t.ITEM_STRING_EXPANDED_COLOR:t.ITEM_STRING_COLOR})}},nestedNodeItemType:{marginLeft:"0.3em",marginRight:"0.3em"},nestedNodeChildren:function(e,t,n){return{style:s(s({},e.style),{},{padding:0,margin:0,listStyle:"none",display:n?"block":"none"})}},rootNodeChildren:{padding:0,margin:0,listStyle:"none"}}}),{defaultBase16:a.default});t.default=d},1063:function(e,t){"use strict";function n(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function i(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){return"Object"===e?Object.keys(t).length:"Array"===e?t.length:1/0}function s(e){return"function"==typeof e.set}function c(e,t,n){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;if("Object"===e){var c=Object.getOwnPropertyNames(t);n&&c.sort(!0===n?void 0:n),i={entries:(c=c.slice(a,o+1)).map((function(e){return{key:e,value:t[e]}}))}}else if("Array"===e)i={entries:t.slice(a,o+1).map((function(e,t){return{key:t+a,value:e}}))};else{var u,d=0,l=[],p=!0,f=s(t),m=r(t);try{for(m.s();!(u=m.n()).done;){var h=u.value;if(d>o){p=!1;break}a<=d&&(f&&Array.isArray(h)?"string"==typeof h[0]||"number"==typeof h[0]?l.push({key:h[0],value:h[1]}):l.push({key:"[entry ".concat(d,"]"),value:{"[key]":h[0],"[value]":h[1]}}):l.push({key:d,value:h})),d++}}catch(v){m.e(v)}finally{m.f()}i={hasMore:!p,entries:l}}return i}function u(e,t,n){for(var r=[];t-e>n*n;)n*=n;for(var i=e;i<=t;i+=n)r.push({from:i,to:Math.min(t,i+n-1)});return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,d=c.bind(null,e,t,r);if(!i)return d().entries;var l,p=s<1/0,f=Math.min(s-a,o(e,t));if("Iterable"!==e){if(f<=i||i<7)return d(a,s).entries}else if(f<=i&&!p)return d(a,s).entries;if("Iterable"===e){var m=d(a,a+i-1),h=m.hasMore,v=m.entries;l=h?[].concat(n(v),n(u(a+i,a+2*i-1,i))):v}else l=p?u(a,s,i):[].concat(n(d(0,i-5).entries),n(u(i-4,f-5,i)),n(d(f-4,f-1).entries));return l}},126:function(e,t,n){"use strict";t.ZP=void 0;var r=c(n(7294)),i=c(n(5697)),a=c(n(5249)),o=c(n(170)),s=n(7274);function c(e){return e&&e.__esModule?e:{default:e}}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var i=v(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var U=function(e){return e};function S(e){var t=function(e,t){var n={getArrowStyle:"arrow",getListStyle:"nestedNodeChildren",getItemStringStyle:"nestedNodeItemString",getLabelStyle:"label",getValueStyle:"valueText"},r=Object.keys(n).filter((function(e){return t[e]}));return r.length>0&&(e="string"==typeof e?{extend:e}:I({},e),r.forEach((function(r){console.error('Styling method "'.concat(r,'" is deprecated, use "theme" property instead')),e[n[r]]=function(e){for(var n=e.style,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];return{style:I(I({},n),t[r].apply(t,a))}}}))),e}(e.theme,e);return e.invertTheme&&(t=(0,s.invertTheme)(t)),{styling:(0,o.default)(t)}}var D=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(s,e);var t,n,i,o=m(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,e)).state=S(e),t}return t=s,(n=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;["theme","invertTheme"].find((function(n){return e[n]!==t.props[n]}))&&this.setState(S(e))}},{key:"shouldComponentUpdate",value:function(e){var t=this;return!!Object.keys(e).find((function(n){return"keyPath"===n?e[n].join("/")!==t.props[n].join("/"):e[n]!==t.props[n]}))}},{key:"render",value:function(){var e=this.props,t=e.data,n=e.keyPath,i=e.postprocessValue,o=e.hideRoot,s=(e.theme,e.invertTheme,l(e,["data","keyPath","postprocessValue","hideRoot","theme","invertTheme"])),c=this.state.styling;return r.default.createElement("ul",c("tree"),r.default.createElement(a.default,d({},I({postprocessValue:i,hideRoot:o,styling:c},s),{keyPath:o?[]:n,value:i(t)})))}}])&&p(t.prototype,n),i&&p(t,i),s}(r.default.Component);t.ZP=D,y(D,"propTypes",{data:i.default.any,hideRoot:i.default.bool,theme:i.default.oneOfType([i.default.object,i.default.string]),invertTheme:i.default.bool,keyPath:i.default.arrayOf(i.default.oneOfType([i.default.string,i.default.number])),postprocessValue:i.default.func,sortObjectKeys:i.default.oneOfType([i.default.func,i.default.bool])}),y(D,"defaultProps",{shouldExpandNode:function(e,t,n){return 0===n},hideRoot:!1,keyPath:["root"],getItemString:function(e,t,n,i){return r.default.createElement("span",null,n," ",i)},labelRenderer:function(e){var t=b(e,1)[0];return r.default.createElement("span",null,t,":")},valueRenderer:U,postprocessValue:U,isCustomNode:function(){return!1},collectionLimit:50,invertTheme:!0})},9869:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&"function"==typeof e[Symbol.iterator])return"Iterable";if("Custom"===t&&e.constructor!==Object&&e instanceof Object)return"Object";return t}},9561:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={scheme:"solarized",author:"ethan schoonover (http://ethanschoonover.com/solarized)",base00:"#002b36",base01:"#073642",base02:"#586e75",base03:"#657b83",base04:"#839496",base05:"#93a1a1",base06:"#eee8d5",base07:"#fdf6e3",base08:"#dc322f",base09:"#cb4b16",base0A:"#b58900",base0B:"#859900",base0C:"#2aa198",base0D:"#268bd2",base0E:"#6c71c4",base0F:"#d33682"}},6851:function(e,t,n){"use strict";var r=n(9594),i=Array.prototype.concat,a=Array.prototype.slice,o=e.exports=function(e){for(var t=[],n=0,o=e.length;n<o;n++){var s=e[n];r(s)?t=i.call(t,a.call(s)):t.push(s)}return t};o.wrap=function(e){return function(){return e(o(arguments))}}},9594:function(e){e.exports=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))}},5753:function(e,t,n){"use strict";n.d(t,{aX:function(){return Zf},y1:function(){return Ig},SX:function(){return Fg},QO:function(){return kg},_3:function(){return Oo},M6:function(){return ag},hC:function(){return jg}});const r="SET",i="NOAD",a={S:"normal",F:"final"};function o(e,t){if(e&&"object"==typeof e){if(e.timed&&!isNaN(e.minutes))return c(e);if(e.bestOf&&e.setFormat)return function(e,t){const n=s(e.bestOf),r=n&&`SET${n}`||"",i=u(e.setFormat,t),a=i&&`S:${i}`||"",o=u(e.finalSetFormat,t),c=n>1&&o&&!o.invalid&&i!==o&&`F:${o}`||"";if(r&&i&&!i.invalid&&(!o||!o.invalid))return[r,a,c].filter((e=>e)).join("-")}(e,t)}}function s(e){return!isNaN(Number(e))&&Number(e)}function c(e){return`T${e.minutes}`}function u(e,t){if(e&&"object"==typeof e){if(e.timed)return c(e);if(e.tiebreakSet)return d(e.tiebreakSet);const n=s(e.setTo);if(n){const r=e.NoAD?i:"",a=d(e.tiebreakFormat),o=a&&!a.invalid&&`/${a}`||"",c=s(e.tiebreakAt),u=c&&(c!==n||t)&&`@${c}`||"";return!a||!a.invalid?`${n}${r}${o}${u}`:{invalid:!0}}return{invalid:!0}}}function d(e){if(e)return"object"!=typeof e||e.tiebreakTo?"object"==typeof e&&s(e.tiebreakTo)?`TB${e.tiebreakTo}${e.NoAD?i:""}`:{invalid:!0}:""}function l(e){if(e&&"string"==typeof e){const t=0===e.indexOf("T")?"timed":0===e.indexOf(r)?r:"";if("timed"===t){const t={bestOf:1,setFormat:m(e)};if(t.setFormat)return t}if(t===r)return function(e){const t=e.split("-"),n=v(t[0].slice(3)),r=t&&p(t[1]),i=t&&p(t[2]),a=n&&n<6,o=!t[2]||i&&!i.invalid,s=r&&!r.invalid,c={bestOf:n,setFormat:r};i&&(c.finalSetFormat=i);if(a&&s&&o)return c}(e)}}function p(e){if(e&&":"===e[1]){const t=e.split(":"),n=a[t[0]],r=t[1];if(n&&r){if(0===r.indexOf("TB"))return{tiebreakSet:f(r)};if(0===r.indexOf("T")){return m(r)}const t=e.match(/^[FS]{1}:(\d+)([A-Za-z]*)/),n=t&&h(t[2])||!1,i=!t||!t[2]||n,a=t&&v(t[1]),o=function(e){const t=e&&e.indexOf("@")>0&&e.split("@");if(t){return v(t[1])||{invalid:!0}}}(r),s=!o||o&&!o.invalid,c=s&&o||a,u=f(r.split("/")[1]),d=!u||!u.invalid,l={setTo:a};return n&&(l.NoAD=!0),u?(l.tiebreakFormat=u,l.tiebreakAt=c):l.noTiebreak=!0,a&&i&&d&&s&&l||{invalid:!0}}}}function f(e){if(e){if(0===e.indexOf("TB")){const t=e.match(/^TB(\d+)([A-Za-z]*)/),n=t&&t[1],r=t&&h(t[2]),i=!t||!t[2]||r,a=v(n);if(a&&i){const e={tiebreakTo:a};return r&&(e.NoAD=!0),e}return{invalid:!0}}return{invalid:!0}}}function m(e){const t=v(e.slice(1));if(t)return{timed:!0,minutes:t}}function h(e){return e&&e.indexOf(i)>=0}function v(e){return!isNaN(Number(e))&&Number(e)}function g(e){var t;if("string"!=typeof e)return!1;const n=l(e);if(null!=n&&null!==(t=n.setFormat)&&void 0!==t&&t.timed&&1===(null==n?void 0:n.bestOf)&&e.indexOf("SET1-S:")<1&&0===e.indexOf("T"))return o(n).slice(7)===e;const r=e.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),i=null==r?void 0:r[0],a=null==r?void 0:r[2],s=e.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),c=null==s?void 0:s[0],u=null==s?void 0:s[2];return o(n,r&&i===a||s&&c===u)===e}const I="SET3-S:6/TB7",y="ABANDONED",b="AWAITING_RESULT",w="BYE",U="CANCELLED",S="COMPLETED",D="DEAD_RUBBER",N="DEFAULTED",P="DOUBLE_WALKOVER",A="IN_PROGRESS",M="INCOMPLETE",T="NOT_PLAYED",E="RETIRED",C="SUSPENDED",R="TO_BE_PLAYED",O="WALKOVER",x=[b,S,N,P,A,M,E,C,O],L=[y,b,w,U,S,D,N,P,A,M,T,E,C,R,O],k=[w,S,N,P,E,O],F=[y,b,U,D,A,M,T,C,R,void 0],j=[U,y,S,D,N,P,E,O],_=[y,S,N,P,A,E,O],B=[A,M,C,R],G={ABANDONED:y,AWAITING_RESULT:b,BYE:w,CANCELLED:U,COMPLETED:S,DEAD_RUBBER:D,DEFAULTED:N,DOUBLE_WALKOVER:P,IN_PROGRESS:A,INCOMPLETE:M,NOT_PLAYED:T,RETIRED:E,SUSPENDED:C,TO_BE_PLAYED:R,WALKOVER:O};function V({winningSide:e,matchUpFormat:t=I,matchUpStatus:n,tallyPolicy:r,score:i}){const a=[0,0],{sets:o}=i||{},s=e-1,c=l(t),u=q((null==c?void 0:c.bestOf)||1);return n===N&&null!=r&&r.setsCreditForDefaults||n===O&&null!=r&&r.setsCreditForWalkovers?a[s]=u:o&&o.forEach((e=>{const{winningSide:t}=e;t&&(a[t-1]+=1)})),n===E&&(+a[1-s]===u&&(a[1-s]-=1),a[s]=u),a}function q(e){return e&&Math.ceil(e/2)||1}function H(e){return!isNaN(e)&&(e&&0==(e&e-1))}function W(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function z(e){return!isNaN(parseFloat(e))}function K(e){if(isNaN(e))return!1;for(;!H(e);)e++;return e}function Y(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function $(e){return Number.isSafeInteger("string"==typeof e?+e:e)}function J(e){if(null===e)return{};const{source:t,template:n}=e||{},r={};return function e(t,n,r){if(!t||!n)return;const i=Object.keys(t),a=Object.keys(n);for(let o=0;o<i.length;o++)if(a.indexOf(i[o])>=0){const a=n[i[o]],s=t[i[o]];a&&"object"==typeof a&&"function"!=typeof s?Array.isArray(s)?r[i[o]]=s.map((t=>{const n={};return e(t,a,n),n})):s&&(r[i[o]]={},e(s,a,r[i[o]])):n[i[o]]&&(r[i[o]]=t[i[o]])}}(t,n,r),r}function Z(e=0){const t=new Date;t.setHours(t.getHours()+e);return t.getTime().toString(36).slice(-6).toUpperCase()}function Q(e){return e.filter(((e,t,n)=>n.lastIndexOf(e)===t))}function X(e){return e.map((e=>[Math.random(),e])).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]))}function ee(e){return e.reduce(((e,t)=>(e[t]||(e[t]=0),e[t]++,e)),{})}function te(e,t,n){return n.indexOf(e)===t}function ne(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function re(e){return e[Math.floor(Math.random()*e.length)]}function ie(e,t){return Array.from({length:t-e},((t,n)=>n+e))}function ae(e,t){return t.reduce(((t,n,r)=>(n===e&&t.push(r),t)),[])}function oe(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>-1!==t.indexOf(e))).filter(((e,t,n)=>n.indexOf(e)===t)):0}function se(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some((e=>t.includes(e)))}function ce(e,t){return e.reduce(((e,n,r)=>{const i=Math.floor(r/t);return e[i]=[].concat(e[i]||[],n),e}),[])}function ue(e,t,n){return e.reduce(((e,r,i)=>{const a=!!n&&!!(Math.floor(i/t)%2),o=i%t,s=a?t-1-o:o;return e[s]||(e[s]=[]),e[s].push(r),e}),[])}const de={success:!0},le={SUCCESS:de,ERROR:"error"},pe="records must be an object with tournamentId keys",fe="Missing tournamentRecords",me="Missing tournamentRecord",he="Invalid tournamentRecord",ve="Missing tournamentId",ge="Invalid drawDefinition",Ie="Missing drawDefinition",ye="Existing drawDefinition(s)",be="drawDefinition not found",we="Invalid structure",Ue="Invalid drawPosition for seedAssignment",Se="drawPosition already assigned",De="drawPosition not cleared",Ne="Unrecognized drawType",Pe="Missing drawPositions",Ae="drawPosition is active",Me="Invlid drawPosition",Te="Missing drawPosition",Ee="Invalid drawSize",Ce="Missing drawSize",Re="Missing drawId",Oe="drawId exists",xe="seedsCount greater than drawSize",Le="Missing seedCountThresholds",ke="Missing seedAssignments",Fe="Invalid seedNumber",je="Invalid seedPosition",_e="Missing targetLink",Be="Existing round",Ge="Missing structureId",Ve="structure not found",qe="Missing structures",He="Missing structure",We="Invalie eventType",ze="Missing event / eventId",Ke="Event not found",Ye="Event exists",$e="Missing entries",Je="Invalid entries",Ze="Missing assignments",Qe="Missing stage",Xe="Invalid stage",et="stageSequence limit",tt="Missing positionAssignments",nt="Unrecognized matchUpStatus",rt="Unrecognized matchUpFormat",it="Incompatible matchUpStatus",at="Invalid matchUpStatus",ot="Invalid tieFormat",st="Invalid matchUpFormat",ct="Missing matchUpFormat",ut="Missing collectionDefinition",dt="Missing tieFormat",lt="Missing matchUpId",pt="Missing matchUpIds",ft="matchUp not found",mt="Missing matchUps",ht="Missing matchUp",vt="Invalid matchUp",gt="Missing policyType",It="Missing policyDefinitions",yt="Missing avoidance policy",bt="Missing policy attributes",wt="Invalid policyDefinitions",Ut="existing policyType",St="Policy not attached",Dt="Policy not found",Nt="Missing scoring policy / matchUpFormats",Pt="Missing setObject",At="Missing courtId",Mt="Missing value",Tt="Missing date",Et="No valid dates",Ct="Invalid bookings",Rt="Invalid dateAvailability",Ot="Missing dateAvailability",xt="Invalid Date",Lt="Invalid time",kt="Invalid tournament dates",Ft="Invalid game scores",jt="Invalid winningSide",_t="Cannot remove participants",Bt="Cannot change winningSide",Gt="Invalid participant",Vt="Invalid participantId",qt="Invalid participantIds",Ht="Invalid participantType",Wt="Missing participantRole",zt="Missing participant",Kt="Missing participants",Yt="Missing participantId",$t="Participant Not Found",Jt="participantId exists",Zt="No participant removed",Qt="Missing participantIds",Xt="Missing participantCount",en="Participant not checked in",tn="Participant already checked in",nn="Participant has assigned drawPosition",rn="Missing person details",an="Existing participant drawPosition assignment",on="Existing participant",sn="participantCount exceeds drawSize",cn="More Participants than Draw Positions",un="Invalid entry status",dn="Participant Entry Not Found",ln="entryStatus not allowed in stage",pn="entryStatus not allowed for event",fn="No stage space available for entryStatus",mn="Missing penaltyType",hn="Missing penaltyId",vn="Penalty not found",gn="Missing courtsCount/courtNames",In="Court not found",yn="Court exists",bn="Venue exists",wn="Venue not found",Un="Missing venueId",Sn="Invalid endTime",Dn="Existing endTime",Nn="Invalid stopTime",Pn="Invalid startTime",An="Invalid timeItem",Mn="Missing timeItem",Tn="Missing timeItems",En="Missing context",Cn="Missing schedule",Rn="Invalid scaleItem",On="No scaleItem found",xn="Modifications failed",Ln="No modifications applied",kn="Invalid configuration",Fn="Invalid object",jn="Invalid values",_n="Team not found",Bn="No valid actions",Gn="No valid attributes",Vn="Value unchanged",qn="Not found",Hn="Not implemented",Wn="Existing flight",zn="Existing profile",Kn="Existing outcome",Yn="Method not found",$n={CANNOT_CHANGE_WINNINGSIDE:Bt,CANNOT_REMOVE_PARTICIPANTS:_t,COURT_EXISTS:yn,COURT_NOT_FOUND:In,DRAW_DEFINITION_NOT_FOUND:be,DRAW_ID_EXISTS:Oe,DRAW_POSITION_ACTIVE:Ae,DRAW_POSITION_ASSIGNED:Se,DRAW_POSITION_NOT_CLEARED:De,DRAW_POSITION_NOT_FOUND:"drawPosition not found",ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:pn,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:ln,EVENT_EXISTS:Ye,EVENT_NOT_FOUND:Ke,EXISTING_DRAW_DEFINITIONS:ye,EXISTING_END_TIME:Dn,EXISTING_FLIGHT:Wn,EXISTING_OUTCOME:Kn,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:an,EXISTING_PARTICIPANT:on,EXISTING_POLICY_TYPE:Ut,EXISTING_PROFILE:zn,EXISTING_ROUND:Be,INCOMPATIBLE_MATCHUP_STATUS:it,INVALID_BOOKINGS:Ct,INVALID_CONFIGURATION:kn,INVALID_DATE_AVAILABILITY:Rt,INVALID_DATE:xt,INVALID_DRAW_DEFINITION:ge,INVALID_DRAW_POSITION_FOR_SEEDING:Ue,INVALID_DRAW_POSITION:Me,INVALID_DRAW_SIZE:Ee,INVALID_END_TIME:Sn,INVALID_ENTRIES:Je,INVALID_EVENT_TYPE:We,INVALID_GAME_SCORES:Ft,INVALID_MATCHUP_FORMAT:st,INVALID_MATCHUP_STATUS:at,INVALID_MATCHUP:vt,INVALID_OBJECT:Fn,INVALID_PARTICIPANT_ID:Vt,INVALID_PARTICIPANT_IDS:qt,INVALID_PARTICIPANT_TYPE:Ht,INVALID_PARTICIPANT:Gt,INVALID_POLICY_DEFINITION:wt,INVALID_RECORDS:pe,INVALID_SCALE_ITEM:Rn,INVALID_SEED_NUMBER:Fe,INVALID_SEED_POSITION:je,INVALID_SET_NUMBER:"Invalid setNumber",INVALID_SIDE_NUMBER:"Invalid sideNumber",INVALID_STAGE:Xe,INVALID_START_TIME:Pn,INVALID_STRUCTURE:we,INVALID_STOP_TIME:Nn,INVALID_TIE_FORMAT:ot,INVALID_TIME:Lt,INVALID_TIME_ITEM:An,INVALID_TOURNAMENT_DATES:kt,INVALID_TOURNAMENT_RECORD:he,INVALID_VALUES:jn,INVALID_WINNING_SIDE:jt,MATCHUP_NOT_FOUND:ft,METHOD_NOT_FOUND:Yn,MISSING_ASSIGNMENTS:Ze,MISSING_AVOIDANCE_POLICY:yt,MISSING_COLLECTION_DEFINITION:ut,MISSING_COURT_ID:At,MISSING_COURTS_INFO:gn,MISSING_DATE_AVAILABILITY:Ot,MISSING_DATE:Tt,MISSING_DRAW_DEFINITION:Ie,MISSING_DRAW_ID:Re,MISSING_DRAW_POSITION:Te,MISSING_DRAW_POSITIONS:Pe,MISSING_DRAW_SIZE:Ce,MISSING_ENTRIES:$e,MISSING_EVENT:ze,MISSING_MATCHUP_FORMAT:ct,MISSING_MATCHUP_ID:lt,MISSING_MATCHUP_IDS:pt,MISSING_MATCHUP:ht,MISSING_MATCHUPS:mt,MISSING_PARTICIPANT_COUNT:Xt,MISSING_PARTICIPANT_ID:Yt,MISSING_PARTICIPANT_IDS:Qt,MISSING_PARTICIPANT_ROLE:Wt,MISSING_PARTICIPANT:zt,MISSING_PARTICIPANTS:Kt,MISSING_PENALTY_ID:hn,MISSING_PENALTY_TYPE:mn,MISSING_PERSON_DETAILS:rn,MISSING_POLICY_ATTRIBUTES:bt,MISSING_POLICY_DEFINITION:It,MISSING_POLICY_TYPE:gt,MISSING_POSITION_ASSIGNMENTS:tt,MISSING_ROUND_NUMBER:"Missing roundNumber",MISSING_SCHEDULE:Cn,MISSING_SCORING_POLICY:Nt,MISSING_SEED_ASSIGNMENTS:ke,MISSING_SEED_BLOCKS:"Missing seedBlocks",MISSING_SEEDCOUNT_THRESHOLDS:Le,MISSING_SEEDING_POLICY:"Missing seeding policy",MISSING_SET_NUMBER:"Missing setNumber",MISSING_SET_OBJECT:Pt,MISSING_SIDE_NUMBER:"Missing sideNumber",MISSING_STAGE:Qe,MISSING_STRUCTURE_ID:Ge,MISSING_STRUCTURE:He,MISSING_STRUCTURES:qe,MISSING_TARGET_LINK:_e,MISSING_TIE_FORMAT:dt,MISSING_TIME_ITEM:Mn,MISSING_TIME_ITEMS:Tn,MISSING_TOURNAMENT_ID:ve,MISSING_TOURNAMENT_RECORD:me,MISSING_TOURNAMENT_RECORDS:fe,MISSING_VALUE:Mt,MISSING_VENUE_ID:Un,MODIFICATIONS_FAILED:xn,MORE_PARTICIPANTS_THAN_DRAW_POSITIONS:cn,NO_MODIFICATIONS_APPLIED:Ln,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:fn,NO_PARTICIPANT_REMOVED:Zt,NO_VALID_ACTIONS:Bn,NO_VALID_ATTRIBUTES:Gn,NO_VALID_DATES:Et,NOT_FOUND:qn,NOT_IMPLEMENTED:Hn,PARTICIPANT_ASSIGNED_DRAW_POSITION:nn,PARTICIPANT_ALREADY_CHECKED_IN:tn,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:sn,PARTICIPANT_ID_EXISTS:Jt,PARTICIPANT_NOT_CHECKED_IN:en,PARTICIPANT_NOT_FOUND:$t,PARTICIPANT_PAIR_EXISTS:"participant pair exists",PENALTY_NOT_FOUND:vn,POLICY_NOT_ATTACHED:St,POLICY_NOT_FOUND:Dt,SCALE_ITEM_NOT_FOUND:On,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:xe,STAGE_SEQUENCE_LIMIT:et,STRUCTURE_NOT_FOUND:Ve,TEAM_NOT_FOUND:_n,UNRECOGNIZED_DRAW_TYPE:Ne,UNRECOGNIZED_MATCHUP_FORMAT:rt,UNRECOGNIZED_MATCHUP_STATUS:nt,VALUE_UNCHANGED:Vn,VENUE_EXISTS:bn},Jn={tournamentId:void 0,tournamentRecords:{},subscriptions:{},notices:[]};const Zn={devContext:void 0,timers:{default:{elapsedTime:0}},deepCopy:!0,deepCopyAttributes:{ignore:[],toJSON:[],stringify:[]}};let Qn={setSubscriptions:function({subscriptions:e={}}={}){return"object"!=typeof e?{error:jn}:(Object.keys(e).forEach((t=>{Jn.subscriptions[t]=e[t]})),{...de})},addNotice:function({topic:e,payload:t,key:n}){if("string"!=typeof e||"object"!=typeof t)return;if(!Jn.subscriptions[e])return;n&&(Jn.notices=Jn.notices.filter((t=>!(t.topic===e&&t.key===n))));Jn.notices.push({topic:e,payload:t,key:n})},getNotices:function({topic:e}){const t=Jn.notices.filter((t=>t.topic===e)).map((e=>e.payload));return t.length&&t},deleteNotices:function(){Jn.notices=[]},getTopics:function(){return{topics:Object.keys(Jn.subscriptions)}},callListener:function({topic:e,notices:t}){const n=Jn.subscriptions[e];n&&"function"==typeof n&&n(t)},getTournamentId:function(){return Jn.tournamentId},getTournamentRecord:function(e){return Jn.tournamentRecords[e]},getTournamentRecords:function(){return Jn.tournamentRecords},setTournamentId:function(e){return Jn.tournamentRecords[e]?(Jn.tournamentId=e,{success:!0}):{error:me}},setTournamentRecord:function(e){const t=null==e?void 0:e.tournamentId;return t?(Jn.tournamentRecords[t]=e,{success:!0}):{error:he}},setTournamentRecords:function(e){Jn.tournamentRecords=e;const t=Object.keys(e);1===t.length?Jn.tournamentId=t[0]:t.length||(Jn.tournamentId=void 0)},removeTournamentRecord:function(e){if("string"!=typeof e)return{error:jn};if(!Jn.tournamentRecords[e])return{error:qn};delete Jn.tournamentRecords[e];const t=Object.keys(Jn.tournamentRecords);1===t.length?Jn.tournamentId=t[0]:t.length||(Jn.tournamentId=void 0);return{success:!0}}};function Xn(e){return e&&"object"==typeof e?"object"==typeof Zn.devContext&&Object.keys(e).every((t=>Zn.devContext[t]===e[t])):Zn.devContext||!1}function er(e){Zn.devContext=e}function tr(e,t){"boolean"==typeof e&&(Zn.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(Zn.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(Zn.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(Zn.deepCopyAttributes.stringify=t.stringify))}function nr(e){return Qn.addNotice(e)}function rr(e){return Qn.getNotices(e)}function ir(){return Qn.deleteNotices()}function ar(){return Qn.getTopics()}async function or(e){return Qn.callListener(e)}function sr(){return Qn.getTournamentId()}function cr(e){return Qn.getTournamentRecord(e)}function ur(){return Qn.getTournamentRecords()}function dr(e){return Qn.setTournamentRecord(e)}function lr(e){return Qn.setTournamentRecords(e)}function pr(e){return Qn.setTournamentId(e)}function fr(e){return Qn.removeTournamentRecord(e)}const mr=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,hr=/^((0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)([.,][0-9]{3})?$/,vr=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))([ T](0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/,gr=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))?([ T]?(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/;function Ir(e){if("object"!=typeof e||Array.isArray(e))return!1;return"[object Date]"===Object.prototype.toString.call(e)}function yr(e){return Pr(e)||mr.test(e)}const br=e=>{const t=Sr(e)||Pr(e)?new Date(e):new Date,n=t.getUTCMonth()+1,r=n<10?`0${n}`:`${n}`;return`${t.getUTCFullYear()}-${jr(r)}-${jr(t.getUTCDate())}`};function wr(e,t="-",n="YMD"){if(!e)return"";"string"==typeof e&&e.indexOf("T")<0&&(e+="T00:00");const r=new Date(e);let i=""+(r.getMonth()+1),a=""+r.getDate();const o=r.getFullYear();return i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),"DMY"===n?[a,i,o].join(t):"MDY"===n?[i,a,o].join(t):"YDM"===n?[o,a,i].join(t):"DYM"===n?[a,o,i].join(t):"MYD"===n?[i,o,a].join(t):[o,i,a].join(t)}function Ur(e){const t=e?new Date(e):new Date,n=t.getTimezoneOffset();return new Date(t.getTime()-60*n*1e3)}function Sr(e){if("boolean"==typeof e)return!1;const t=e instanceof Date?e:!isNaN(e)&&new Date(e);return t&&!isNaN(t.valueOf())}function Dr(e,t){const n=new Date(e),r=new Date(t);var i,a;const o=[];let s=0;if(!!(Sr(r)&&Sr(n)&&(i=n,a=r,Ur(i)<=Ur(a)))){const e=Ur(n),t=Ur(r);for(;e<=t&&s<300;)s+=1,o.push(new Date(e)),e.setDate(e.getDate()+1)}return o}const Nr=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Pr(e){return"string"==typeof e&&Nr.test(e)}function Ar(e){if("string"!=typeof e)return!1;const t=e.split("Z")[0].split(":"),n=t.every((e=>!isNaN(e)));return!(t.length<2||!n)&&(!(parseInt(t[0])>23)&&!(parseInt(t[1])>60))}function Mr(e){const t=Er(e);if(!t)return 0;const[n,r]=t.split(":").map((e=>parseInt(e)));return 60*n+r}function Tr(e){return Ar(e)?e.split(":").slice(0,2).map(jr).join(":"):void 0}function Er(e){return Pr(e)&&e.indexOf("T")>0?Tr(e.split("T").reverse()[0]):Tr(e)}function Cr(e){return Pr(e)||vr.test(e)?e.split("T")[0]:void 0}function Rr(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),Cr(n.toISOString())}function Or(e){e="string"!=typeof e?"00:00":e;const t={},n={};return({0:t.time,1:t.ampm}=e.split(" ")||[]),({0:n.hours,1:n.minutes}=t.time.split(":")||[]),n.ampm=t.ampm,isNaN(n.hours)||isNaN(n.minutes)||n.ampm&&!["AM","PM"].includes(n.ampm.toUpperCase())?{}:n}function xr(e,t){const[n,r]=(e||"00:00").split(":").map(jr),i=Ur(t).setHours(n,r,0,0);return Ur(i)}function Lr(e,t,n=!0){const r=new Date(e),i=(new Date(t).getTime()-r.getTime())/1e3/60;return n?Math.abs(Math.round(i)):Math.round(i)}function kr(e,t){const n=Er(e);if(!n)return"00:00";const r=isNaN(t)?0:t;return Er(Fr(xr(n),r).toISOString())}function Fr(e,t){const n=new Date(e);return new Date(n.getTime()+6e4*t)}function jr(e){return e.toString()[1]?e:"0"+e}function _r(e,t){const n=new Date(e),r=new Date(t);return n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()&&n.getDate()===r.getDate()}const Br={addMinutesToTimeString:kr,convertTime:function(e,t){return t?function(e){const t=Or(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&parseInt(t.hours)<12&&(t.hours=(t.hours&&parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),`${t.hours||"12"}:${t.minutes||"00"}`.split(":").map(jr).join(":")}(e):function(e){const t=Or(e);return t.ampm?e:(t.hours>12?(t.hours-=12,t.ampm="PM"):"12"===t.hours?t.ampm="PM":"00"===t.hours?(t.hours="12",t.ampm="AM"):t.ampm="AM","0"===t.hours[0]&&(t.hours=t.hours.slice(1)),`${t.hours||"12"}:${t.minutes||"00"} ${t.ampm}`)}(e)},getUTCdateString:br,DateHHMM:function(e){const t=new Date(e);return function(e,t){const n=parseInt(e,10),r=Math.floor(n/3600),i=Math.floor((n-3600*r)/60),a=n-3600*r-60*i,o=!t||t&&t.displaySeconds;return(o?r+":"+i+":"+a:r+":"+i).split(":").map(jr).join(":")}(t.getSeconds()+60*t.getMinutes()+3600*t.getHours(),{displaySeconds:!1})},extractDate:Cr,extractTime:Er,formatDate:wr,getDateByWeek:function(e,t,n,r=!1){let i=new Date(t,0,1+7*(e-1));const a=r?0:1;return i.setDate(i.getDate()+(a-i.getDay())),wr(i,n)},isISODateString:Pr,isTimeString:Ar,offsetDate:Ur,offsetTime:function(e){return Ur(e).getTime()},sameDay:_r,timeStringMinutes:Mr,timeToDate:xr,timeUTC:function(e){const t=Sr(e)||Pr(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())}};function Gr(e,t,n,r){const i={enabled:Zn.deepCopy,...Zn.deepCopyAttributes};if((null==i||!i.enabled)&&!n||"object"!=typeof e||"function"==typeof e||null===e)return e;const a=Array.isArray(e)?[]:{},o=Object.keys(e).filter((e=>!n||!(null!=i&&i.ignore.includes(e))));for(const c of o){const o=e[c];if(t&&"extensions"===c&&Array.isArray(o)){const e=null==(s=o)?void 0:s.map((e=>{const{name:t,value:n}=e;return t&&n&&{[`_${t}`]:n}})).filter(Boolean);Object.assign(a,...e)}else r&&"extensions"===c?a[c]=[]:n&&null!=i&&i.stringify.includes(c)?a[c]="function"==typeof(null==o?void 0:o.toString)?o.toString():JSON.stringify(o):n&&null!=i&&i.toJSON.includes(c)&&"function"==typeof(null==o?void 0:o.toJSON)?a[c]=o.toJSON():null===o?a[c]=void 0:Ir(o)?a[c]=new Date(o).toISOString():a[c]=Gr(o,t,n,r)}var s;return a}function Vr(e,t){if("object"!=typeof e||null===e)return e;const n=["",void 0,null];t&&n.push(!1);const r=Object.keys(e).filter((t=>!n.includes(e[t])));return Object.assign({},...r.map((t=>Array.isArray(e[t])?{[t]:e[t].map((e=>Vr(e)))}:{[t]:Vr(e[t])})))}function qr(e){return Array.isArray(e)?e.length+e.map(qr).reduce(((e,t)=>e+t),0):"object"==typeof e&&null!==e?Object.keys(e).length+Object.keys(e).map((t=>qr(e[t]))).reduce(((e,t)=>e+t),0):0}function Hr(e,t){return e-t}function Wr(){const e=[];for(let a=0;a<256;a++)e[a]=(a<16?"0":"")+a.toString(16);const t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]}function zr({participantIds:e,matchUpFormat:t,tallyPolicy:n,perPlayer:r,matchUps:i}){const a={};function o(e){a[e]||(a[e]={allDefaults:0,defaults:0,retirements:0,walkovers:0,matchUpsWon:0,matchUpsLost:0,victories:[],defeats:[],matchUpsCancelled:0,setsWon:0,setsLost:0,gamesWon:0,gamesLost:0,pointsWon:0,pointsLost:0})}return i.filter((t=>!(null!=e&&e.length)||2===oe(e,[Kr(t,0),Kr(t,1)]).length)).forEach((e=>{const{matchUpStatus:r,score:i,winningSide:s}=e,c=s&&function(e){const t=e.winningSide-1;return Kr(e,t)}(e),u=s&&function(e){const t=1-(e.winningSide-1);return Kr(e,t)}(e);if(!c||!u){const t=Kr(e,0),n=Kr(e,1);return t&&(o(t),a[t].matchUpsCancelled+=1),void(n&&(o(n),a[n].matchUpsCancelled+=1))}const d=s&&s-1,p=1-d;o(c),o(u),r===O&&(a[u].walkovers+=1),r===N&&(a[u].defaults+=1),r===E&&(a[u].retirements+=1),[N,E,O].includes(r)&&(a[u].allDefaults+=1),a[c].matchUpsWon+=1,a[u].matchUpsLost+=1,a[u].defeats.push(c),a[c].victories.push(u);const f=V({score:i,matchUpStatus:r,matchUpFormat:t,tallyPolicy:n,winningSide:s});a[c].setsWon+=f[d],a[c].setsLost+=f[p],a[u].setsWon+=f[p],a[u].setsLost+=f[d];const m=function({winningSide:e,matchUpFormat:t=I,matchUpStatus:n,tallyPolicy:r,score:i}){var a,o;const{sets:s}=i||{},c=e-1,u=l(t);let d=0,p=0;const f=q((null==u?void 0:u.bestOf)||1),m=(null==u||null===(a=u.setFormat)||void 0===a?void 0:a.setTo)||0,h=(null==u||null===(o=u.setFormat)||void 0===o?void 0:o.tiebreakAt)||0;if(!s)return[d,p];const v=f*m,g=[[],[]];if(n===N&&null!=r&&r.gamesCreditForDefaults||n===O&&null!=r&&r.gamesCreditForWalkovers?g[c].push(v):s&&s.forEach((e=>{({side1Score:d,side2Score:p}=e),g[0].push(parseInt(d||0)),g[1].push(parseInt(p||0))})),n===E){const r=V({winningSide:e,matchUpStatus:n,matchUpFormat:t,sets:s}),i=r.reduce(((e,t)=>e+t),0);if(g.map((e=>e[c]<=e[1-c])).reduce(((e,t)=>e+t),0)>r[1-c]){const e=g[c].length,t=function(e){if(u&&""!==e)return+e==h-1||+e===h?parseInt(h||0)+1:+e<h?m:h}(g[1-c][e-1]);t&&(g[c][e-1]=t)}i>g[c].length&&g[c].push(m)}const y=[g[0].reduce(((e,t)=>e+t),0),g[1].reduce(((e,t)=>e+t),0)];return[E,O,N].includes(n)&&y[c]<v&&(y[c]=v),y}({score:i,matchUpStatus:r,matchUpFormat:t,tallyPolicy:n,winningSide:s});a[c].gamesWon+=m[d],a[c].gamesLost+=m[p],a[u].gamesWon+=m[p],a[u].gamesLost+=m[d];const h=function({score:e}){var t;const n=[0,0];return null==e||null===(t=e.sets)||void 0===t||t.forEach((e=>{e.side1TiebreakScore&&(n[0]+=parseInt(e.side1TiebreakScore)),e.side2TiebreakScore&&(n[1]+=parseInt(e.side2TiebreakScore))})),n}({score:i,tallyPolicy:n});a[c].pointsWon+=h[d],a[c].pointsLost+=h[p],a[u].pointsWon+=h[p],a[u].pointsLost+=h[d]})),function({participantResults:e,matchUpFormat:t,perPlayer:n}){var r;const i=t&&l(t)||{},a=i.bestOf,o=a&&Math.ceil(a/2)||1,s=null===(r=i.setFormat)||void 0===r?void 0:r.setTo;Object.keys(e).forEach((t=>{const r=e[t].setsWon,i=e[t].setsLost,a=n*(o||0)||r;let c=Math.round(r/i*1e3)/1e3;(c===1/0||isNaN(c))&&(c=a);const u=e[t].matchUpsWon,d=e[t].matchUpsLost;let l=Math.round(u/d*1e3)/1e3;(l===1/0||isNaN(l))&&(l=u);const p=e[t].gamesWon||0,f=e[t].gamesLost||0,m=(n||0)*(o||0)*(s||0),h=Math.max(m,p+f);let v=Math.round(p/h*1e3)/1e3;(v===1/0||isNaN(v))&&(v=0);let g=Math.round(e[t].pointsWon/e[t].pointsLost*1e3)/1e3;(g===1/0||isNaN(g))&&(g=0),e[t].setsRatio=c,e[t].matchUpsRatio=l,e[t].gamesRatio=v,e[t].pointsRatio=g,e[t].result=`${e[t].matchUpsWon}/${e[t].matchUpsLost}`,e[t].games=`${e[t].gamesWon}/${e[t].gamesLost}`}))}({participantResults:a,perPlayer:r,matchUpFormat:t}),{participantResults:a}}function Kr(e,t){if(!e||!e.sides)return console.log("no sides:",{matchUp:e}),"foo";const n=e.sides[t];return n?n.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function Yr(e){return j.includes(null==e?void 0:e.matchUpStatus)||(null==e?void 0:e.winningSide)}const $r=[{attribute:"matchUpsRatio",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsRatio",idsFilter:!1},{attribute:"gamesRatio",idsFilter:!1},{attribute:"pointsRatio",idsFilter:!1},{attribute:"matchUpsRatio",idsFilter:!0},{attribute:"setsRatio",idsFilter:!0},{attribute:"gamesRatio",idsFilter:!0},{attribute:"pointsRatio",idsFilter:!0}];function Jr(e){const{participantResults:t,subOrderMap:n}=e;if(!function({participantResults:e,participantsCount:t}){let n=Xr({participantResults:e}).filter((e=>t-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled));return t===n.length}(e))return;const r=Qr({attribute:"matchUpsWon",participantResults:t}),i=Object.keys(r).map((e=>parseFloat(e))).sort(((e,t)=>t-e)).map((e=>r[e])).map((t=>Zr({participantIds:t,...e}))).flat(1/0);let a,o=1;i.forEach(((e,t)=>{t&&(e.resolved||a&&!e.resolved)&&(o+=1),a=e.resolved,e.resolved?(e.position=t+1,o=e.position):e.position=o}));const s=ee(i.map((({position:e})=>e)));return i.forEach((e=>{const r=t[e.participantId],i=s[e.position];void 0!==e&&void 0!==e.position&&(i>1&&(r.ties=i,n&&(r.subOrder=n[e.participantId])),e.groupOrder=e.position+(r.subOrder||1)-1,r.rankOrder=e.position),r.GEMscore=function(e){return e.matchUpsRatio*Math.pow(10,16)+e.setsRatio*Math.pow(10,12)+e.gamesRatio*Math.pow(10,8)+e.pointsRatio*Math.pow(10,3)}(r)})),i}function Zr({participantResults:e,disableHeadToHead:t,participantIds:n,matchUpFormat:r,tallyPolicy:i,matchUps:a}){if(1===n.length)return{resolved:!0,participantId:n[0]};if(2===n.length&&(null==i||!i.headToHead||!i.headToHead.disabled&&!t)){const t=function({participantIds:e,participantResults:t}){if(t[e[0]].victories.includes(e[1]))return e.map((e=>({resolved:!0,participantId:e})));if(t[e[1]].victories.includes(e[0]))return e.reverse().map((e=>({resolved:!0,participantId:e})))}({participantIds:n,participantResults:e});if(t)return t}let o;return((null==i?void 0:i.tallyDirectives)||$r).every((({attribute:e,reversed:t,idsFilter:s,disableHeadToHead:c})=>(o=function({disableHeadToHead:e,participantIds:t,matchUpFormat:n,tallyPolicy:r,attribute:i,idsFilter:a,matchUps:o,reversed:s}){const{participantResults:c}=zr({participantIds:a&&t,matchUpFormat:n,tallyPolicy:r,matchUps:o}),u=Qr({participantResults:c,participantIds:t,attribute:i});if(Object.keys(u).length>1)return Object.keys(u).map((e=>parseFloat(e))).sort(((e,t)=>s?e-t:t-e)).map((e=>u[e])).map((t=>Zr({participantResults:c,disableHeadToHead:e,participantIds:t,matchUpFormat:n,tallyPolicy:r,matchUps:o}))).flat(1/0)}({disableHeadToHead:c,participantIds:n,matchUpFormat:r,tallyPolicy:i,attribute:e,idsFilter:s,matchUps:a,reversed:t}),!o))),o||n.map((e=>({participantId:e})))}function Qr({participantResults:e,participantIds:t,attribute:n}){return Xr({participantResults:e,participantIds:t}).reduce(((e,t)=>{const{participantId:r,results:i}=t,a=i[n];return e[a]?e[a].push(r):e[a]=[r],e}),{})}function Xr({participantResults:e,participantIds:t}){return(t=t||Object.keys(e)).reduce(((t,n,r)=>(t.push({participantId:n,i:r,results:e[n]}),t)),[])}const ei="roundRobinTally",ti="positionActions",ni="roundNaming",ri="participant",ii="scheduling",ai="avoidance",oi="seeding",si="scoring",ci="draws",ui={POLICY_TYPE_ROUND_ROBIN_TALLY:ei,POLICY_TYPE_POSITION_ACTIONS:ti,POLICY_TYPE_ROUND_NAMING:ni,POLICY_TYPE_PARTICIPANT:ri,POLICY_TYPE_SCHEDULING:ii,POLICY_TYPE_AVOIDANCE:ai,POLICY_TYPE_SEEDING:oi,POLICY_TYPE_SCORING:si,POLICY_TYPE_DRAWS:ci};function di({policyDefinitions:e,matchUpFormat:t,matchUps:n=[],subOrderMap:r,perPlayer:i}){if(!Array.isArray(n))return{error:mt};if(1!==n.reduce(((e,{structureId:t})=>e.includes(t)?e:e.concat(t)),[]).length)return{error:jn};const a=n.filter((e=>e&&e.matchUpStatus!==w)),o=a.length&&Q(a.map((({drawPositions:e})=>e)).flat()).length,s=a.filter(Yr).length===a.length;s||(i=0);const c=e&&e.roundRobinTally,u=n.filter(Yr),{participantResults:d}=zr({matchUps:u,matchUpFormat:t,tallyPolicy:c,perPlayer:i}),l=Jr({matchUps:u,participantResults:d,participantsCount:o,matchUpFormat:t,tallyPolicy:c,subOrderMap:r});return s&&l&&l.forEach((e=>{d[e.participantId].groupOrder=e.groupOrder})),{participantResults:d}}const li="CHECK_IN",pi="CHECK_OUT",fi="SCHEDULE.ASSIGNMENT.COURT",mi="SCHEDULE.ASSIGNMENT.VENUE",hi="SCHEDULE.DATE",vi="SCHEDULE.TIME.SCHEDULED",gi="SCHEDULE.TIME.START",Ii="SCHEDULE.TIME.STOP",yi="SCHEDULE.TIME.RESUME",bi="SCHEDULE.TIME.END",wi="SCALE",Ui="RATING",Si="RANKING",Di="SEEDING",Ni="PUBLISH",Pi="PUBLIC",Ai="HIDDEN",Mi="STATUS",Ti={ASSIGN_COURT:fi,ASSIGN_OFFICIAL:"SCHEDULE.ASSIGN.OFFICIAL",ASSIGN_VENUE:mi,CHECK_IN:li,CHECK_OUT:pi,END_TIME:bi,HIDDEN:Ai,MEDICAL:"MEDICAL",OTHER:"other",PENALTY:"PENALTY",PUBLIC:Pi,PUBLISH:Ni,RANKING:Si,RATING:Ui,RESUME_TIME:yi,RETRIEVAL:"RETRIEVAL",SCALE:wi,SCHEDULED_DATE:hi,SCHEDULED_TIME:vi,SEEDING:Di,START_TIME:gi,STATUS:Mi,STOP_TIME:Ii,SUSPENSION:"SUSPENSION"};function Ei(e){if(hr.test(e)){const t=br();return new Date(`${t}T${e}`)}return new Date(e)}function Ci({matchUp:e}){if(!e)return{error:ht};if(!e.timeItems)return{error:Tn};const t=e.timeItems.filter((e=>[gi,Ii,yi,bi].includes(null==e?void 0:e.itemType))).sort(((e,t)=>Ei(e.itemValue)-Ei(t.itemValue))),n=t.reduce(((e,t)=>{var n,r;let i;const a=null==t||null===(n=t.itemType)||void 0===n?void 0:n.split("."),o=`SCHEDULE.TIME.${(null==t||null===(r=t.itemType)||void 0===r?void 0:r.startsWith("SCHEDULE.TIME"))&&a[2]}`;switch(o){case gi:i=0;break;case bi:if(e.lastValue&&[gi,yi].includes(e.lastType)){const n=Ei(t.itemValue)-Ei(e.lastValue);i=e.milliseconds+n}else i=e.milliseconds;break;case Ii:if([gi,"SCHECULE.TIME.RESUME"].includes(e.lastType)){const n=Ei(t.itemValue)-Ei(e.lastValue);i=e.milliseconds+n}else i=e.milliseconds;break;default:i=e.milliseconds}return{milliseconds:i,lastType:o,lastValue:t.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([gi,yi].includes(n.lastType)){const e=new Date-Ei(n.lastValue);n.milliseconds+=e}return{milliseconds:n.milliseconds,time:Ri(n.milliseconds),relevantTimeItems:t}}function Ri(e){const t=(e,t=2)=>("00"+e).slice(-t);return t(e/36e5|0)+":"+t(e%36e5/6e4|0)+":"+t(e%6e4/1e3|0)}function Oi({categoryName:e,categoryType:t,timesBlockArray:n}){return n.filter((e=>Array.isArray(e))).map((n=>n.sort(((e,t)=>{var n,r;return((null===(n=t.categoryNames)||void 0===n?void 0:n.length)||0)-((null===(r=e.categoryNames)||void 0===r?void 0:r.length)||0)})).find((({categoryTypes:n,categoryNames:r})=>!(null!=r&&r.length)&&!(null!=n&&n.length)||(null==r?void 0:r.includes(e))||(null==n?void 0:n.includes(t)))))).find(Boolean)}function xi({matchUpAverageTimes:e,matchUpFormat:t}={}){const n=(null==e?void 0:e.map((({matchUpFormatCodes:e})=>null==e?void 0:e.filter((e=>e===t)))).flat().filter(Boolean).sort(((e,t)=>((null==e?void 0:e.length)||0)-((null==t?void 0:t.length)||0))))||[],r=n.includes(t)?t:n[0],i=null==e?void 0:e.find((({matchUpFormatCodes:e,averageTimes:t})=>(null==e?void 0:e.find((e=>r===e)))&&t));return null==i?void 0:i.averageTimes}function Li({matchUpRecoveryTimes:e,averageMinutes:t,matchUpFormat:n}={}){var r;return null==e||null===(r=e.find((({matchUpFormatCodes:e,averageTimes:r,recoveryTimes:i})=>{if(r&&t){const{greaterThan:e=0,lessThan:n=360}=r;if(t>e&&t<n)return!0}return(null==e?void 0:e.find((e=>e===n)))&&i})))||void 0===r?void 0:r.recoveryTimes}const ki="appliedPolicies",Fi="delegatedOutcome",ji="disableLinks",_i="entryProfile",Bi="flightProfile",Gi="groupingAttribute",Vi="lineUps",qi="linkedTournamentsIds",Hi="participantRepresentatives",Wi="personRequests",zi="scheduleLimits",Ki="scheduleTiming",Yi="schedulingProfile",$i="subOrder",Ji="tally",Zi={APPLIED_POLICIES:ki,DELEGATED_OUTCOME:Fi,DISABLE_LINKS:ji,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:_i,FLIGHT_PROFILE:Bi,GROUPING_ATTRIBUTE:Gi,LINEUPS:Vi,LINKED_TOURNAMENTS:qi,PARTICIPANT_REPRESENTATIVES:Hi,PERSON_REQUESTS:Wi,SCHEDULE_LIMITS:zi,SCHEDULE_TIMING:Ki,SCHEDULING_PROFILE:Yi,SUB_ORDER:$i,TALLY:Ji};function Qi({tournamentRecord:e}){return ea({extensions:(null==e?void 0:e.extensions)||[]})}function Xi({event:e}){if(!e)return{error:ze};return ea({extensions:e.extensions||[]})}function ea({extensions:e}){const t=e.find((e=>e.name===ki));return{appliedPolicies:(null==t?void 0:t.value)||{}}}function ta({tournamentRecord:e,event:t,policyType:n}){if(!e)return{error:me};if(t){const{appliedPolicies:e}=Xi({event:t});if(e&&e[n])return{policy:e[n]}}const{appliedPolicies:r}=Qi({tournamentRecord:e});return null!=r&&r[n]?{policy:r[n]}:{error:Dt}}function na({tournamentParticipants:e=[],policyDefinitions:t={},participantId:n,personId:r}){const i=e.find((e=>n&&e.participantId===n||r&&e.person&&e.person.personId===r)),a=null==t?void 0:t.participant;if(null!=a&&a.participant){return J({template:a.participant,source:i})}return Gr(i)}function ra({tournamentRecord:e,participantId:t}){return{participant:(e.participants||[]).reduce(((e,n)=>n.participantId===t?n:e),void 0)}}function ia({element:e,name:t}){if(!e||!t)return{error:Mt};if(!Array.isArray(e.extensions))return{message:qn};const n=e.extensions.find((e=>(null==e?void 0:e.name)===t));return{extension:n,message:n?void 0:qn}}function aa({tournamentRecord:e,name:t}){return ia({element:e,name:t})}function oa({event:e,name:t}){return e?ia({element:e,name:t}):{error:ze}}function sa({drawDefinition:e,name:t}){return e?ia({element:e,name:t}):{error:Ie}}function ca({tournamentRecord:e,categoryName:t,categoryType:n,event:r}){var i,a,o;t=t||(null==r||null===(i=r.category)||void 0===i?void 0:i.categoryName)||(null==r||null===(a=r.category)||void 0===a?void 0:a.ageCategoryCode),n=n||(null==r||null===(o=r.category)||void 0===o?void 0:o.categoryType);const{policy:s}=ta({policyType:ii,tournamentRecord:e,event:r}),{extension:c}=aa({tournamentRecord:e,name:Ki}),u=null==c?void 0:c.value,{extension:d}=oa({event:r,name:Ki});return{scheduleTiming:{categoryName:t,categoryType:n,eventScheduling:null==d?void 0:d.value,tournamentScheduling:u,policy:s}}}const ua="SINGLES",da="DOUBLES",la="TEAM",pa={SINGLES:ua,DOUBLES:da,TEAM:la},fa="total",ma="SINGLES_DOUBLES",ha="DOUBLES_SINGLES",va={TOTAL:fa,SINGLES_DOUBLES:ma,DOUBLES_SINGLES:ha};function ga({defaultAverageMinutes:e=90,defaultRecoveryMinutes:t=0,tournamentRecord:n,matchUpFormat:r,categoryName:i,categoryType:a,eventType:o,event:s}){if(!n)return{error:me};o=o||(null==s?void 0:s.eventType);const c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},{scheduleTiming:u}=ca({tournamentRecord:n,categoryName:i,categoryType:a,event:s});return Ia({eventType:o,timingDetails:{...u,matchUpFormat:r,categoryType:a,defaultTiming:c}})}function Ia({eventType:e,timingDetails:t}){const n=function({matchUpFormat:e,categoryName:t,categoryType:n,defaultTiming:r,tournamentScheduling:i,eventScheduling:a,policy:o}){var s;return Oi({categoryName:t,categoryType:n,timesBlockArray:[(null==a?void 0:a.matchUpAverageTimes)&&xi({...a,matchUpFormat:e}),(null==i?void 0:i.matchUpAverageTimes)&&xi({...i,matchUpFormat:e}),(null==o?void 0:o.matchUpAverageTimes)&&xi({...o,matchUpFormat:e}),null==o||null===(s=o.defaultTimes)||void 0===s?void 0:s.averageTimes,null==r?void 0:r.averageTimes]})}(t),r=Object.keys((null==n?void 0:n.minutes)||{}),i=(null==n?void 0:n.minutes)&&((null==r?void 0:r.includes(e))&&n.minutes[e]||n.minutes.default),a=function({matchUpFormat:e,categoryName:t,categoryType:n,averageMinutes:r,defaultTiming:i,tournamentScheduling:a,eventScheduling:o,policy:s}){var c;return Oi({categoryName:t,categoryType:n,timesBlockArray:[(null==o?void 0:o.matchUpRecoveryTimes)&&Li({...o,averageMinutes:r,matchUpFormat:e}),(null==a?void 0:a.matchUpRecoveryTimes)&&Li({...a,averageMinutes:r,matchUpFormat:e}),(null==s?void 0:s.matchUpRecoveryTimes)&&Li({...s,averageMinutes:r,matchUpFormat:e}),null==s||null===(c=s.defaultTimes)||void 0===c?void 0:c.recoveryTimes,null==i?void 0:i.recoveryTimes]})}({...t,averageMinutes:i}),o=Object.keys((null==a?void 0:a.minutes)||{}),s=(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),c=e===ua?ma:ha;return{averageMinutes:i,recoveryMinutes:s,typeChangeRecoveryMinutes:(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(c))&&a.minutes[c]||s)}}function ya({tournamentRecord:e,eventId:t,drawId:n}){if(!e)return{error:me};const r=(null==e?void 0:e.events)||[];if(n){let e;const t=r.find((t=>{const r=((null==t?void 0:t.drawDefinitions)||[]).find((e=>e.drawId===n));return r&&(e=r),r}));if(t)return{event:t,drawDefinition:e}}if(t){const e=r.find((e=>e.eventId===t));return e?{event:e}:{error:Ke}}return{error:Mt}}function ba({tournamentRecord:e,drawId:t}){if(!e)return{error:me};if(!t)return{error:Re};const n=(e.events||[]).reduce(((e,n)=>{const r=(n.drawDefinitions||[]).reduce(((e,n)=>n.drawId===t?n:e),void 0);return r&&r.drawId===t?{event:n,drawDefinition:r}:e}),void 0);return n?{...n,SUCCESS:de}:{error:be}}function wa(e,t,n){const r=e=>e.createdAt?new Date(e.createdAt).getTime():0,i=e.filter((e=>e&&e.itemType===t&&(!n||r(e)<n))).sort(((e,t)=>r(e)-r(t))).pop();return i&&i.itemValue}function Ua({matchUp:e,visibilityThreshold:t}){return{scheduledTime:wa((null==e?void 0:e.timeItems)||[],vi,t)}}function Sa({matchUp:e,visibilityThreshold:t}){return{scheduledDate:wa((null==e?void 0:e.timeItems)||[],hi,t)}}function Da({matchUp:e,visibilityThreshold:t}){return{courtId:wa((null==e?void 0:e.timeItems)||[],fi,t)}}function Na({matchUp:e,visibilityThreshold:t}){return{venueId:wa((null==e?void 0:e.timeItems)||[],mi,t)}}const Pa="SINGLES",Aa="DOUBLES",Ma="TEAM",Ta={SINGLES:Pa,DOUBLES:Aa,TEAM:Ma,AGE:"AGE",RATING:"RATING",BOTH:"BOTH"};function Ea({scheduleVisibilityFilters:e,afterRecoveryTimes:t=!0,tournamentRecord:n,scheduleTiming:r,matchUpFormat:i,matchUpType:a,matchUp:o,event:s}){if(!o)return{error:ht};if(!o.matchUpType&&!a&&(s||n)&&o.drawId){var c,u,d,l,p,f;let e=null===(c=s)||void 0===c?void 0:c.drawDefinitions.find((e=>e.drawId===o.drawId));!e&&n&&({drawDefinition:e,event:s}=ya({tournamentRecord:n,drawId:o.drawId}));const t=o.structureId&&(null===(u=e)||void 0===u||null===(d=u.structures)||void 0===d?void 0:d.find((({structureId:e})=>e===o.structureId)));a=(null==t?void 0:t.matchUpType)||(null===(l=e)||void 0===l?void 0:l.matchUpType)||(null===(p=s)||void 0===p?void 0:p.eventType)!==Ma&&(null===(f=s)||void 0===f?void 0:f.eventType)}const{milliseconds:m,time:h}=Ci({matchUp:o}),{startTime:v}=function({matchUp:e}){const t=(null==e?void 0:e.timeItems)||[],n=e=>e.createdAt?new Date(e.createdAt).getTime():0,r=t.reduce(((e,t)=>{const r=t.itemType===gi&&t;return r&&(!e||n(r)<n(e))?r:e}),void 0);return{startTime:r&&r.itemValue}}({matchUp:o}),{endTime:g}=function({matchUp:e}){const t=(null==e?void 0:e.timeItems)||[],n=e=>e.createdAt?new Date(e.createdAt).getTime():0,r=t.reduce(((e,t)=>{const r=t.itemType===bi&&t;return r&&(!e||n(r)>n(e))?r:e}),void 0);return{endTime:r&&r.itemValue}}({matchUp:o});let I;const{visibilityThreshold:y,eventIds:b,drawIds:w}=e||{};if(b&&!b.includes(o.eventId)||w&&!w.includes(o.drawId))I=Vr({time:h,startTime:v,endTime:g,milliseconds:m});else{const e={matchUp:o,visibilityThreshold:y};let{scheduledDate:n}=Sa(e);const{scheduledTime:s}=Ua(e),{courtId:c}=Da(e),{venueId:u}=Na(e);let d,l,p,f,b;if(null!=r&&r.policy&&s&&t){const e={matchUpFormat:o.matchUpFormat||i,...r};({averageMinutes:l=0,recoveryMinutes:p=0,typeChangeRecoveryMinutes:f=0}=Ia({eventType:o.matchUpType||a,timingDetails:e})),(l||p)&&(d=g?kr(Er(g),p):kr(s,l+p)),f&&(b=g?kr(Er(g),f):kr(s,l+f))}!n&&s&&(n=Cr(s)),I=Vr({venueId:u,courtId:c,typeChangeTimeAfterRecovery:b,timeAfterRecovery:d,scheduledDate:n,scheduledTime:s,typeChangeRecoveryMinutes:f,recoveryMinutes:p,averageMinutes:l,milliseconds:m,startTime:v,endTime:g,time:h})}const U=j.includes(o.matchUpStatus),{scheduledDate:S}=Sa({matchUp:o}),{scheduledTime:D}=Ua({matchUp:o});return{schedule:I,endDate:U&&(Cr(g)||Cr(S)||Cr(D))}}function Ca({matchUps:e,matchUpId:t}){return{matchUp:(e||[]).find((e=>e.matchUpId===t))}}function Ra({sideAdjustments:e=[0,0],separator:t="-",tieFormat:n,matchUp:r}){var i;if(!Array.isArray(e)||2!==e.length||isNaN(e.reduce(((e,t)=>e+t))))return{error:jn};if(!r)return{error:ht};n=r.tieFormat||n;const a=[0,0],o=(null==r?void 0:r.tieMatchUps)||[];((null===(i=n)||void 0===i?void 0:i.collectionDefinitions)||[]).forEach((e=>{const t=o.filter((t=>t.collectionId===e.collectionId));if(e.matchUpValue){const n=e.matchUpValue;t.forEach((e=>{e.winningSide&&(a[e.winningSide-1]+=n)}))}else if(e.collectionValue){const n=[0,0],r=Math.floor(e.matchUpCount/2).floor+1;t.forEach((e=>{e.winningSide&&(n[e.winningSide-1]+=1)}));const i=n.reduce(((e,t)=>t>=r?t+1:e),void 0);i&&(a[i]+=e.collectionValue)}else e.collectionValueProfile&&t.forEach((t=>{if(t.winningSide){const n=t.collectionPosition,r=function({collectionDefinition:e,collectionPosition:t}){const n=(e.collectionValueProfile||[]).find((e=>e.collectionPosition===t));return null==n?void 0:n.matchUpValue}({collectionDefinition:e,collectionPosition:n});a[t.winningSide-1]+=r}}))}));const s=a.map(((t,n)=>t+e[n])),c={side1Score:s[0],side2Score:s[1]},u=s.join(t),d=s.slice().reverse().join(t);let l;if(n){var p;const e=null===(p=n.winCriteria)||void 0===p?void 0:p.valueGoal;if(e){const t=s.map(((e,t)=>({sideNumber:t+1,points:e}))).find((({points:t})=>t>=e));l=null==t?void 0:t.sideNumber}}return{scoreStringSide1:u,scoreStringSide2:d,winningSide:l,set:c}}const Oa="INDIVIDUAL",xa="TEAM",La="PAIR",ka="GROUP",Fa={INDIVIDUAL:Oa,TEAM:xa,PAIR:La,GROUP:ka};const ja=e=>{var t;const{isSide1:n,lowValue:r,setTo:i,tiebreakAt:a,NoAD:o}=e;if(void 0===r)return{error:Mt};let s,c=parseInt(r);(null===(t=c)||void 0===t?void 0:t.toString().length)>2&&(c=parseInt(c.toString().slice(0,2))),a&&a<i&&c>a&&(c=a),s=o&&!a?c<i?i:i-1:c+1<i||a&&a<i&&c===a?i:a?i+1:c+2;return[n?c:s,n?s:c]},_a=e=>{var t;const{isSide1:n,lowValue:r,tiebreakTo:i,tiebreakNoAd:a}=e;if(void 0===r)return{error:Mt};let o=parseInt(r);(null===(t=o)||void 0===t?void 0:t.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),a&&o>i-1&&(o=i-1);const s=function(e){const{lowValue:t,NoAD:n,tiebreakTo:r}=e,i=n?1:2;if(t+1>=r)return t+i;return r}({lowValue:o,NoAD:a,tiebreakTo:i});return[n?o:s,n?s:o]};function Ba({checkCollectionIds:e=!0,tieFormat:t}={}){const n=[];if("object"!=typeof t)return n.push("tieformat must be an object"),{error:ot,errors:n};if("object"!=typeof t.winCriteria)return n.push("tieFormat.winCriteria must be an object"),{error:ot,errors:n};if(!Array.isArray(t.collectionDefinitions))return n.push("tieFormat.collectionDefinitiosn must be an array of objects"),{error:ot,errors:n};const r="number"==typeof t.winCriteria.valueGoal&&t.winCriteria.valueGoal>0;r||n.push("Non-zero valueGoal must be specified in winCriteria");const i=t.collectionDefinitions.every((t=>{if("object"!=typeof t)return n.push(`collectionDefinition must be an object: ${t}`),!1;const{collectionValueProfile:r,collectionGroupNumber:i,collectionValue:a,collectionId:o,matchUpCount:s,matchUpFormat:c,matchUpValue:u,matchUpType:d}=t;if(e&&"string"!=typeof o)return n.push(`collectionId is not type string: ${o}`),!1;if("number"!=typeof s)return n.push(`matchUpCount is not type number: ${s}`),!1;if(![ua,da].includes(d))return n.push(`matchUpType must be SINGLES or DOUBLES: ${d}`),!1;if(!u&&!a&&!r)return n.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfile"),!1;if(u&&"number"!=typeof u)return n.push(`matchUpValue is not type number: ${u}`),!1;if(a&&"number"!=typeof a)return n.push(`collectionValue is not type number: ${a}`),!1;if(r){if(!Array.isArray(r))return n.push(`collectionValueProfile is not an array: ${r}`),!1;if(r.length!==s)return n.push("collectionValueProfile does not align with matchUpsCount"),!1;for(const t of r){if("object"!=typeof t)return n.push(`valueProfile is not type object: ${t}`),!1;const{value:e,collectionPosition:r}=t;if("number"!=typeof e||"number"!=typeof r||r>s||r<1)return n.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),!1}const e=r.map((e=>e.collectionPosition));if(e.length!==Q(e).length)return n.push("collectionPositions are not unique"),!1}return i&&"number"!=typeof i?(n.push(`collectionValue is not type number: ${a}`),!1):!(c&&!Oo.isValidMatchUpFormat(c))||(n.push(`Invalid matchUpFormat: ${c}`),!1)})),a=t.collectionDefinitions.map((({collectionId:e})=>e)),o=!e||a.length===Q(a).length,s=i&&r&&o,c={valid:s,errors:n};return s||(c.error=ot),c}function Ga({analysis:e,set:t}){const n=qa({set:t}),{isDecidingSet:r,isTiebreakSet:i,matchUpScoringFormat:a}=e;return Va({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:i,set:t})&&n}function Va({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:n,isTiebreakSet:r,isDecidingSet:i,set:a}){var o;if(!a)return{error:Mt};t=t||n;const s=i&&t.finalSetFormat||(null===(o=t)||void 0===o?void 0:o.setFormat),{side1Score:c,side2Score:u}=a,{NoAD:d,setTo:l,tiebreakAt:p,tiebreakFormat:f}=s,m=null==f?void 0:f.NoAd,h=qa({set:a}),v=Math.abs(c-u),g=c>=l||u>=l,I=r||c>=l&&u>=l||p&&p<l&&(c===p||u===p),y=e||I&&(1===h&&a.side1TiebreakScore>a.side2TiebreakScore||2===h&&a.side2TiebreakScore>a.side1TiebreakScore);return(g&&(v>=(d||I&&(p&&!r||r&&m)?1:2)||I)||r)&&(!I||y)}function qa({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}const Ha=" ",Wa="DEF",za=["RET",Wa,"WO","WO/WO","ABN","SUS","INT"],Ka="DEFAULTED",Ya="WALKOVER",$a="ABANDONED",Ja="SUSPENDED",Za="RETIRED",Qa="INTERRUPTED",Xa=[Za,Ka,Ya],eo="()",to="[]",no=["up","left","shift+tab"],ro=["enter","down","tab","right"],io="backspace",ao=["r","d","w","a","s","i"],oo="space",so=["[","("],co=[...no,...ro,oo,"]"],uo="-",lo="-",po=["/"],fo=["0","1","2","3","4","5","6","7","8","9"].concat(ao),mo=fo.map((e=>`shift+${e}`)),ho=[uo,io].concat(co,po),vo=[fo,mo,ho].join(","),go=[vo,no,ro,["=","+","num_1","num_2","shift+=","shift+-"]].join(",");[].concat(...fo,...fo,...ho,...fo,...fo,...fo,...fo,...fo,...fo);const Io={SIDE1KEYS:fo,SIDE2KEYS:mo,MODIFIERS:ho,PROMPT:"Enter Score",MOVEUP:no,MOVEDOWN:ro,HOTKEYS:go};function yo({scoreString:e,lowSide:t,outcome:n}){if(({scoreString:e}=bo({scoreString:e})),2===t){return e+((e&&e[e.length-1])!==Ha?Ha:"")+n}return n+Ha+e}function bo({scoreString:e}){if(!e)return{scoreString:""};let t=!1;for(const r of za){var n;const i=null===(n=e)||void 0===n?void 0:n.indexOf(r);0===i?e=e.slice(r.length+1).trim()+Ha:i>0&&(e=e.slice(0,i)),i>=0&&(t=!0)}return e&&e.trim()||(e=""),{scoreString:e,removed:t}}function wo({analysis:e,scoreString:t,sets:n,lowSide:r}){let i,a;if(!t)return{scoreString:t,sets:n};const{scoreString:o,removed:s}=bo({scoreString:t});if(t=o,s)return{scoreString:t,sets:n,outcomeRemoved:!0};let c=n[n.length-1]||{};const u=Object.values(c).filter((e=>void 0!==e)).length;c.setNumber&&1===u&&(c=(n=n.slice(0,n.length-1))[n.length-1]||{});const{tiebreakSet:d}=e.setFormat,{tiebreakTo:l,NoAD:p}=d||{},{isTiebreakEntry:f}=Uo({scoreString:t,brackets:to}),m=function(e){const t=e.split("");return t.reduce(((e,t,n)=>(t.match(/\d+/g)&&e.push(n),e)),[]).pop()}(t);if(m>=0){i=t.slice(0,m);const{isTiebreakEntry:o}=Uo({scoreString:i,brackets:eo}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=Uo({scoreString:i,brackets:to}),d=i&&i[i.length-1].trim(),U=i&&!isNaN(d);let S=e.isIncompleteSetScore;if(f&&u){const e=i.slice(s+1).split(lo),n=(null==e?void 0:e.length)>0&&void 0!==e[0]&&!isNaN(parseInt(e[0]))&&parseInt(e[0])||void 0,a=(null==e?void 0:e.length)>1&&void 0!==e[1]&&parseInt(e[1])||void 0,o=[n,a];if(a){const e=1===r?1:0;o[e]=o[1-e]+(p?1:2),o[e]<l&&(o[e]=l),i=t.slice(0,s+1),i+=o.join(lo)}else void 0!==n?(i=t.slice(0,s+1),i+=n):(i=t.slice(0,s),S=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(i.length||(i=void 0),S){var h;const t=null===(h=c.side1Score)||void 0===h?void 0:h.toString();if(t){const e=null==t?void 0:t.slice(0,t.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}var v,g;if(e.isTimedSet)a=c.side1Score?n:(null===(v=n)||void 0===v?void 0:v.slice(0,n.length-1))||[],a[n.length-1]=c;else a=(null===(g=n)||void 0===g?void 0:g.slice(0,n.length-1))||[]}else if(U){var I,y;const t=null===(I=c.side2Score)||void 0===I?void 0:I.toString(),r=null===(y=c.side1Score)||void 0===y?void 0:y.toString();if(!e.isTiebreakEntry&&!e.isMatchTiebreak)if(c.side2Score){const e=null==t?void 0:t.slice(0,t.length-1);c.side2Score=!isNaN(e)&&parseInt(e)||void 0}else{const e=null==r?void 0:r.slice(0,r.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0}var b;if(e.isTimedSet)if(c.side1Score)a=n||[],a[n.length-1]=c;else a=(null===(b=n)||void 0===b?void 0:b.slice(0,n.length-1))||[];else a=n||[],a[n.length-1]=c;a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else if(o)a=n||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0});else{var w;if(f&&!u)a=(null===(w=n)||void 0===w?void 0:w.slice(0,n.length-1))||[];else a=n,a[n.length-1]=c;f||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0)}return{scoreString:i,sets:a}}return{scoreString:t,sets:n}}function Uo({scoreString:e,brackets:t="()"}){if(!e)return!1;const[n,r]=t.split(""),i=e.split(""),a=Math.max(...ae(n,i));return{isTiebreakEntry:a>Math.max(...ae(r,i)),lastOpenBracketIndex:a}}function So({lowValue:e=0,NoAD:t=!1,tiebreakTo:n}={}){if(e+1>=n)return e+(t?1:2);return parseInt(n)}function Do({matchUpFormat:e,matchUpStatus:t,winningSide:n,sets:r}){const i=l(e),{bestOf:a}=i,o=Math.ceil(a/2),s=r&&r.reduce(((e,t)=>{const{winningSide:n}=t;return n&&e[n-1]++,e}),[0,0]);let c=(null==s?void 0:s.indexOf(o))+1||void 0;return Xa.includes(t)&&n&&(c=n),{matchUpWinningSide:c}}function No({lowSide:e,value:t,sets:n,scoreString:r,winningSide:i,matchUpStatus:a}){let o;return"r"===t?r?(o=!0,r=yo({scoreString:r,lowSide:e,outcome:"RET"}),i=2===e?1:2,a=Za):(o=!0,r=yo({scoreString:r,lowSide:e,outcome:Wa}),i=2===e?1:2,a=Ka):"d"===t?(o=!0,r=yo({scoreString:r,lowSide:e,outcome:Wa}),i=2===e?1:2,a=Ka):"w"===t?(o=!0,n=[],r="WO",i=2===e?1:2,a=Ya):"s"===t&&r?(o=!0,r=yo({scoreString:r,lowSide:e,outcome:"SUS"}),a=Ja,i=void 0):"a"===t?(o=!0,r=yo({scoreString:r,lowSide:e,outcome:"ABN"}),a=$a,i=void 0):"i"===t&&r&&(o=!0,r=yo({scoreString:r,lowSide:e,outcome:"INT"}),a=Qa,i=void 0),{updated:o,sets:n,scoreString:r,matchUpStatus:a,winningSide:i}}function Po({sets:e,scoreString:t,winningSide:n,matchUpFormat:r,value:i}){var a,o;const s=((null==e||null===(a=e.filter((e=>null==e?void 0:e.winningSide)))||void 0===a?void 0:a.length)||0)+(n?0:1),c=l(r),u=s===(null==c?void 0:c.bestOf),d=u&&c.finalSetFormat||c.setFormat||{},p=(null==d?void 0:d.timed)||c.timed,f=u&&e[(null==c?void 0:c.bestOf)-1],m=f&&f.winningSide,{isTiebreakEntry:h}=Uo({scoreString:t,brackets:eo}),{isTiebreakEntry:v}=Uo({scoreString:t,brackets:to}),g=h||v,I=!!d.tiebreakSet,y=t&&t[t.length-1].trim(),b=t&&!isNaN(y),w=!g&&y===uo,U=h&&so.includes(y),S=v&&so.includes(y),D=v&&y===lo,N=t&&t.split(""),[P]=to.split(""),A=N&&Math.max(...ae(P,N)),M=N&&Math.max(...ae(lo,N)),T=N&&M>A,E=null===(o=e[e.length-1])||void 0===o?void 0:o.winningSide,C=(null==e?void 0:e.length)&&!E,R=za.find((e=>(null==t?void 0:t.indexOf(e))>=0)),O=!isNaN(i),x=i===oo,L=co.includes(i),k=null==t?void 0:t.split("").find((e=>so.includes(e)));return{isTiebreakSetValue:I&&O,matchUpScoringFormat:c,setNumber:s,setFormat:d,matchTiebreakHasJoiner:T,isGameScoreEntry:C,isSpace:x,isCloser:L,isTiebreakCloser:L&&k&&g&&b,isDecidingSet:u,isTiebreakSet:I,isTimedSet:p,isNumericEnding:b,isNumericValue:O,hasOpener:k,hasOutcome:R,finalSet:f,finalSetIsComplete:m,lastSetIsComplete:E,isInvalidSetTiebreakValue:x&&g&&U,isInvalidMatchTiebreakValue:L&&v&&!S&&(D||!function({scoreString:e}){if(!e)return!1;const t=e&&e[e.length-1].trim(),n=e&&!isNaN(t),[r,i]=to.split(""),a=e.split(""),o=Math.max(...ae(r,a)),s=Math.max(...ae(i,a)),c=Math.max(...ae(lo,a));return n&&o>s&&c>o}({scoreString:t})),isTiebreakEntry:g,isSetTiebreakEntry:h,isMatchTiebreakEntry:v,isIncompleteSetScore:w,isIncompleteSetTiebreak:U,isIncompleteMatchTiebreak:S,isPartialMatchTiebreakValue:D}}function Ao(e){const{sets:t,winningSide:n,autoComplete:r,matchUpStatus:i,reversed:a=!1,winnerFirst:o=!0,addOutcomeString:s}=e;if(!t)return{error:Mt};const c=a||!(!o||!n||1===n),u=s?function({matchUpStatus:e}){const t={[E]:"RET",[O]:"WO",[P]:"WO/WO",[C]:"SUS",[y]:"ABN",[N]:"DEF",[D]:"DR"};return e&&t[e]||""}({matchUpStatus:i}):"",d=(null==t?void 0:t.sort(Mo).map((function(e){const t=(d=e,!(z(null==d?void 0:d.side1Score)||z(null==d?void 0:d.side2Score))&&(e=>z(null==e?void 0:e.side1TiebreakScore)||z(null==e?void 0:e.side2TiebreakScore))(e)),{side1Score:n,side2Score:i,side1TiebreakScore:a,side2TiebreakScore:o}=e,s=a||(z(a)||r?0:""),u=o||(z(o)||r?0:"");var d;if(t){return`[${(c?[u,s]:[s,u]).join("-")}]`}const l=Math.min(s,u),p=l?`(${l})`:"",f=n||(z(n)||r?0:""),m=i||(z(i)||r?0:"");let h=c?`${[m,f].join("-")}${p}`:`${[f,m].join("-")}${p}`;["-"," "].includes(h)&&(h="");return h})).filter(Boolean).join(" "))||"";return u?2===n?`${u} ${d}`:`${d} ${u}`:d}function Mo(e,t){return e.setNumber-t.setNumber}function To({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:n,setObject:r}){if(!r)return;const i=Eo({set:r});return function({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:n,isTiebreakSet:r,isDecidingSet:i,set:a}){var o;if(!a)return{error:Mt};t=t||n;const s=i&&t.finalSetFormat||(null===(o=t)||void 0===o?void 0:o.setFormat)||{},{side1Score:c,side2Score:u}=a,{setTo:d,tiebreakAt:l,tiebreakFormat:p}=s,f=null==p?void 0:p.NoAd,m=Eo({set:a}),h=Math.abs(c-u),v=c>=d||u>=d,g=r||c>=d&&u>=d||l&&l<d&&(c===l||u===l),I=e||g&&(1===m&&a.side1TiebreakScore>a.side2TiebreakScore||2===m&&a.side2TiebreakScore>a.side1TiebreakScore),y=h>=(g&&(l&&!r||r&&f)?1:2);return(v&&(y||g)||r)&&(!g||I)}({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:n,set:r})&&i||void 0}function Eo({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}function Co(e){const{setObject:t,matchUpScoringFormat:n}=e;if(!t)return{error:Pt};const{setNumber:r}=t||{},{bestOf:i}=n||{},a=!(!r||r!==i),o=a&&(null==n?void 0:n.finalSetFormat)||(null==n?void 0:n.setFormat),s=!(null==o||!o.tiebreakSet),c=!(null==o||!o.timed),u=!s&&!c,d=!!(r&&i&&r<=i),l=[null==t?void 0:t.side1Score,null==t?void 0:t.side2Score],p=[null==t?void 0:t.side1PointScore,null==t?void 0:t.side2PointScore],f=[null==t?void 0:t.side1TiebreakScore,null==t?void 0:t.side2TiebreakScore],m=l.filter((e=>void 0!==e)).length,h=p.filter((e=>void 0!==e)).length,v=f.filter((e=>void 0!==e)).length,g=null==l?void 0:l.filter((e=>!isNaN(e))).length,I=null==f?void 0:f.filter((e=>!isNaN(e))).length,{tiebreakAt:y}=o||{},b=y&&2===l.filter((e=>e>=y)).length,w=b&&(l[0]>l[1]?1:l[1]>l[0]?2:void 0),U=!(!I||g),S=!(!t||null==t||!t.winningSide),{error:D,result:N}=function({setObject:e,setFormat:t,sideGameScores:n,sideTiebreakScores:r}){if(!e)return{result:!1,error:Pt};const i=!(null==t||!t.tiebreakSet),a=!(null==t||!t.timed);if(!t||i||a)return{result:!1,error:"not standard set"};if(2!==(null==n?void 0:n.filter((e=>!isNaN(e))).length))return{result:!1,error:Ft};const{setTo:o,tiebreakAt:s,tiebreakFormat:c,NoAD:u}=t||{};if(!o||null==n||!n.find((e=>e>=o)))return{result:!1,error:Ft};const d=[1,2].includes(null==e?void 0:e.winningSide);if(!e||!d)return{result:!1,error:jt};const l=(null==e?void 0:e.winningSide)-1,p=1-l,f=n[l],m=n[p],h=f-m;if(!(f>m))return{result:!1,error:"winningSide game scoreString is not high"};const v=s&&c,g=2===(null==r?void 0:r.filter((e=>!isNaN(e))).length),I=r&&r[l],y=r&&r[p],b=s&&2===n.filter((e=>e>=s)).length;if(v){const{NoAD:e,tiebreakTo:t}=c;if(b){if(h>1)return{result:!1,error:"invalid winning game scoreString (5)"};if(!g)return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(t))return{result:!1,error:"tiebreakTo error"};if(!!(!t||null==r||!r.find((e=>e>=t))))return{result:!1,error:"invalid tiebreak scores (2)"};if(f>(s<o?o:o+1))return{result:!1,error:"invalid winning game scoreString (1)"};if(!I||!y||I<y)return{result:!1,error:"winningSide tiebreak value is not high"};const n=e?1:2,i=I-y,a=y>=t-1;if(i&&a&&i<n)return{result:!1,error:"invalid tiebreak scores (3)"}}if(f>o&&(!v||!b))return{result:!1,error:"invalid winning game scoreString (2)"}}const w=u?1:2,U=m>=o-1;if(h&&U&&!b&&h<w)return{result:!1,error:"invalid winning game scoreString (3)"};if(h>w&&f>o)return{result:!1,error:"invalid winning game scoreString (4)"};return{result:!0}}({setObject:t,setFormat:o,sideGameScores:l,sideTiebreakScores:f}),{error:P,result:A}=function({setObject:e,setFormat:t,sideTiebreakScores:n}){if(!e)return{result:!1,error:Pt};const r=!(null==t||!t.tiebreakSet),i=!(null==t||!t.timed);if(!t||!r||i)return{result:!1,error:"not tiebreak set"};const a=[1,2].includes(null==e?void 0:e.winningSide);if(!e||!a)return{result:!1,error:jt};const{tiebreakSet:o}=t||{},{NoAD:s,tiebreakTo:c}=o||{};if(2!==(null==n?void 0:n.filter((e=>!isNaN(e))).length))return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(c))return{result:!1,error:"tiebreakTo error"};if(null==n||!n.find((e=>e>=c)))return{result:!1,error:"invalid tiebreak scores (2)"};const u=(null==e?void 0:e.winningSide)-1,d=1-u,l=n[u],p=n[d];if(!l||!p||l<p)return{result:!1,error:"winningSide tiebreak value is not high"};const f=s?1:2,m=l-p,h=p>=c-1;if(m&&h&&m<f)return{result:!1,error:"invalid tiebreak scores (3)"};return{result:!0}}({setObject:t,setFormat:o,sideTiebreakScores:f}),M=u&&!U&&N||s&&U&&A,T={expectTiebreakSet:s,expectTimedSet:c,hasTiebreakCondition:b,isCompletedSet:S,isDecidingSet:a,isTiebreakSet:U,isValidSet:d&&!(s&&!U)&&!(u&&U)&&(!S||M),isValidSetNumber:d,isValidSetOutcome:M,leadingSide:w,setFormat:o,sideGameScores:l,sideGameScoresCount:m,sidePointScores:p,sidePointScoresCount:h,sideTiebreakScores:f,sideTiebreakScoresCount:v,winningSide:To({isDecidingSet:a,isTiebreakSet:U,matchUpScoringFormat:n,setObject:t})};return void 0!==(null==t?void 0:t.winningSide)&&(U?(T.isValidTiebreakSetOutcome=A,A||(T.tiebreakSetError=P)):(T.isValidStandardSetOutcome=N,N||(T.standardSetError=D))),T}function Ro(e){var t;const{matchUp:n,sideNumber:r,setNumber:i,isTiebreakValue:a,isPointValue:o}=e||{};let{matchUpFormat:s}=e||{};if(!n)return{error:ht};s=s||(null==n?void 0:n.matchUpFormat);const c=l(s),u=!(null==n||!n.winningSide),d=null===(t=n.score)||void 0===t?void 0:t.sets,p=null==d?void 0:d.length,f=i&&i-1,m=!(null==d||!d.find(((e,t)=>e.setNumber===i&&t===f))),h=(null==d?void 0:d.filter((e=>null==e?void 0:e.winningSide)))||[],v=(null==h?void 0:h.length)||0,g=i&&(null==d?void 0:d.slice(i))||[],I=!!(p&&i&&null!=g&&g.reduce(((e,t)=>(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e),!0)),y=i<=p&&d.find((e=>e.setNumber===i)),b=y&&Co({setObject:y,matchUpScoringFormat:c}),{isCompletedSet:w,sideGameScores:U,sideTiebreakScores:S}=b||{},D=!!(y&&!w&&I||i&&i===p+1&&!u),N=[1,2].includes(r),P=N?r-1:0,A=y&&N&&(!a&&!o&&void 0!==U[P]&&U[P]||a&&void 0!==S[P]&&S[P]),M=!!A,T=h&&h.map((e=>Co({setObject:e,matchUpScoringFormat:c}).isValidSetOutcome)).reduce(((e,t)=>e&&t),!0),E=h.reduce(((e,t)=>{const{winningSide:n}=t;return e[n-1]++,e}),[0,0]),C=null==n?void 0:n.winningSide,R=C&&C-1,O=1-R,x=E[R],L=E[O],k=Math.max(...E),F=ee(E)[k],{bestOf:j}=c||{},_=k===(j&&Math.ceil(j/2)||1)&&1===F&&E.indexOf(k)+1||void 0,B=x>L&&C===_;return{isActiveSet:D,isExistingSet:m,existingValue:A,hasExistingValue:M,isValidSideNumber:N,completedSetsCount:v,isCompletedMatchUp:u,isLastSetWithValues:I,validMatchUpOutcome:_&&T&&B,matchUpScoringFormat:c,calculatedWinningSide:_,validMatchUpWinningSide:B,completedSetsHaveValidOutcomes:T,...b}}const Oo={stringifyMatchUpFormat:o,isValidMatchUpFormat:g,parseMatchUpFormat:l,generateTieMatchUpScore:Ra,tallyParticipantResults:di,getTiebreakComplement:_a,generateScoreString:Ao,checkSetIsComplete:Va,validateTieFormat:Ba,getSetComplement:ja,analyzeMatchUp:Ro,keyValueScore:function(e){let{lowSide:t=1,value:n}=e,{scoreString:r,sets:i,winningSide:a,matchUpStatus:o}=e;const{matchUpFormat:s,shiftFirst:c,auto:u=!0}=e;let d,l;const p=c&&2===t||!c&&1===t;if(!vo.includes(n))return{updated:!1,message:"invalid key"};c&&(t=3-t);const{matchUpWinningSide:f}=Do({sets:i,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=f;const m=Po({value:n,winningSide:a,scoreString:r,sets:i,matchUpFormat:s});if(po.includes(n)&&(n=uo),m.hasOpener&&m.isTiebreakEntry&&!m.isTiebreakSet&&p&&0===parseInt(n)&&(m.isTiebreakCloser=!0),co.includes(n)&&m.hasOpener&&(n=""),co.includes(n)&&(n=oo),m.lastSetIsComplete){var h;const e=(null===(h=r)||void 0===h?void 0:h.length)&&r[r.length-1];r&&" "!==e&&(r+=" ")}if(m.isTimedSet)({message:l,sets:i,scoreString:r,updated:d,matchUpStatus:o,winningSide:a}=function({analysis:e,lowSide:t,scoreString:n,sets:r,winningSide:i,matchUpStatus:a,message:o,value:s}){var c;let u,d;null!==(c=r)&&void 0!==c&&c.length||s===io||(r=[{setNumber:1}]);const l=r.length-1;if(ao.includes(s)){const c=r[r.length-1]||{},{side1Score:d,side2Score:l}=c;d&&!l?o="missing side2Score":e.finalSetIsComplete||i?o="final set is already complete":e.isIncompleteSetScore?o="incomplete set scoreString":e.isIncompleteSetScore||({sets:r,scoreString:n,winningSide:i,matchUpStatus:a,updated:u}=No({lowSide:t,value:s,sets:r,scoreString:n,matchUpStatus:a,winningSide:i}))}else if(s===io){var p;if(({scoreString:n,sets:r,outcomeRemoved:d}=wo({analysis:e,scoreString:n,sets:r})),""===(null===(p=n)||void 0===p?void 0:p.trim())&&(n=n.trim()),n||(r=[]),d){const e=r[r.length-1]||{},{side1Score:t,side2Score:n}=e;if(t&&n){const i=t>n?1:n>t?2:void 0;i&&(e.winningSide=i,r.push({setNumber:r.length+1}))}}a=void 0,i=void 0,u=!0}else if(e.hasOutcome)o="has outcome";else{if(i)return{sets:r,scoreString:n,winningSide:i,matchUpStatus:a,updated:!1,message:"matchUp is complete"};if(s===oo){const t=r[r.length-1]||{},{side1Score:a,side2Score:o}=t,s=a>o?1:o>a?2:void 0;!s||i||e.isIncompleteSetScore||(r[r.length-1].winningSide=s,r.push({setNumber:r.length+1}),n+=" ",u=!0)}else if(s===uo&&void 0!==r[l].side1Score&&void 0===r[l].side2Score&&n&&e.isNumericEnding)n+="-",r[l].side2Score=0,a=void 0,i=void 0,u=!0;else if(!isNaN(s)){let e;if(void 0===r[l].side2Score){const t=parseInt((r[l].side1Score||0).toString()+s).toString().slice(0,2);r[l].side1Score=parseInt(t),e=r[l].side1Score.toString(),u=!0}else{const t=parseInt((r[l].side2Score||0).toString()+s).toString().slice(0,2);r[l].side2Score=parseInt(t),e=[r[l].side1Score,r[l].side2Score].join("-"),u=!0}if(u){const t=(r.slice(0,l)||[]).filter((e=>e)).map((e=>{const{side1Score:t,side2Score:n}=e;return[t,n].join("-")})).join(" ");n=t?t+" "+e:e}}}return{sets:r,scoreString:n,winningSide:i,matchUpStatus:a,message:o,updated:u}}({analysis:m,lowSide:t,scoreString:r,sets:i,matchUpStatus:o,winningSide:a,value:n}));else if(ao.includes(n))m.finalSetIsComplete||a?l="final set is already complete":m.isTiebreakEntry||m.isIncompleteSetScore?m.isTiebreakEntry||m.isIncompleteSetScore?l="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:n}):({sets:i,scoreString:r,matchUpStatus:o,winningSide:a,updated:d}=No({lowSide:t,sets:i,scoreString:r,matchUpStatus:o,winningSide:a,value:n}));else if(n===io)d=!0,({scoreString:r,sets:i}=wo({analysis:m,scoreString:r,sets:i,lowSide:t,auto:u})),r||(i=[]),o=void 0,a=void 0;else if(m.hasOutcome)l="has outcome";else if(n!==uo||m.isMatchTiebreakEntry)if(n===lo&&m.isMatchTiebreakEntry&&!m.isSetTiebreakEntry)m.matchTiebreakHasJoiner?l="existing joiner":m.isNumericEnding&&(d=!0,r+=lo);else if([uo,lo].includes(n))l="invalid location for joiner";else{if(a)return{updated:!1,message:"matchUp is complete"};if(m.isIncompleteSetScore)m.isNumericValue&&({sets:i,scoreString:r,updated:d}=function({analysis:e,scoreString:t,sets:n,value:r}){let i;if(null==n||!n.length)return{sets:[]};const a=n[n.length-1];r=parseInt(r);const{validSide2Score:o,requiresTiebreak:s}=function({analysis:e,set:t={},value:n}){const r=e.isDecidingSet&&e.matchUpScoringFormat.finalSetFormat||e.matchUpScoringFormat.setFormat,{tiebreakAt:i,setTo:a,NoAD:o}=r,{side1Score:s}=t;let c,u;return c=i&&i<a?s===i?n<=a:n<=i:s===a?o?n<a:n<=a+1:s===a-1?o?n<=a:n<=a+1:s===a+1?n===a||n===a-1:n<=a,c&&(u=i&&i<a?s===a&&n===i||s===i&&n===a:s>=a&&n>=a&&s!==n),{validSide2Score:c,requiresTiebreak:u}}({analysis:e,set:a,value:r});if(o){i=!0,t=(t||"")+r,a.side2Score=r;const o=Ga({analysis:e,set:n[n.length-1]});a.winningSide=o||void 0,s?t+=eo.split("")[0]:e.isDecidingSet||(t+=Ha)}return{sets:n,scoreString:t,updated:i}}({analysis:m,scoreString:r,sets:i,value:n}));else if(m.isInvalidMatchTiebreakValue)l="invalid matchUp tiebreak character";else if(m.isInvalidSetTiebreakValue)l="invalid set tiebreak character";else if(m.isTiebreakCloser){const e=m.isSetTiebreakEntry?eo:to,t=e.split("").reverse()[0],n=e.split("")[0],a=i[i.length-1],{tiebreakFormat:o}=m.setFormat,{tiebreakTo:s,NoAD:c}=o||{},u=qa({set:a});if(!m.isTiebreakSet){const e=parseInt(r.split(n).reverse()[0]),t=So({lowValue:e,tiebreakTo:s,NoAD:c});1===u?(a.side1TiebreakScore=t,a.side2TiebreakScore=e):(a.side1TiebreakScore=e,a.side2TiebreakScore=t)}r=(r||"")+t,m.isDecidingSet||(r+=Ha);const l=Ga({analysis:m,set:a});a.winningSide=l||void 0,d=!0}else if(m.isTiebreakSetValue)({message:l,scoreString:r,sets:i,updated:d}=function({analysis:e,auto:t,lowSide:n,scoreString:r="",sets:i,value:a}){let o,s;const{tiebreakSet:{tiebreakTo:c,NoAD:u}}=e.setFormat,[d]=to.split("");if(e.isMatchTiebreakEntry||(r+=d),i[e.setNumber-1]){var l;const{lastOpenBracketIndex:e}=Uo({scoreString:r,brackets:to}),d=(r.slice(e+1)+(t?"":a)).split(lo);if(((null===(l=d[n-1])||void 0===l?void 0:l.length)||0)>=2)s="tiebreak digit limit";else if(t){1===n&&(d[0]=(d[0]||"")+a),2===n&&(d[1]=(d[1]||"")+a);const t=[d[0]||0,d[1]||0].map((e=>parseInt(e))),s=1===n?1:0;t[s]=t[1-s]+(u?1:2),t[s]<c&&(t[s]=c);const l=i[i.length-1];l.side1TiebreakScore=t[0],l.side2TiebreakScore=t[1],r=r.slice(0,e+1),r+=t.join(lo),o=!0}else{const e=[d[0]||0,d[1]||0].map((e=>parseInt(e))),t=i[i.length-1];t.side1TiebreakScore=e[0],t.side2TiebreakScore=e[1],r+=a,o=!0}}else{const e=So({lowValue:parseInt(a||0),tiebreakTo:c,NoAD:u}),t=[parseInt(a),e];2===n&&t.reverse();const s={side1TiebreakScore:t[0],side2TiebreakScore:t[1],setNumber:(null==i?void 0:i.length)+1||1};i.push(s),r+=t.join(lo),o=!0}return{message:s,scoreString:r,sets:i,updated:o}}({analysis:m,auto:u,lowSide:t,scoreString:r,sets:i,value:n}));else if(m.isSetTiebreakEntry){const[e]=eo.split(""),t=Math.max(...ae(e,r.split(""))),i=r.slice(t+1),a=i&&0===parseInt(i),o=parseInt(i?i+n:n),{tiebreakFormat:s}=m.setFormat,{tiebreakTo:c,NoAD:u}=s||{};!a&&i.length<2?u&&o>c-1?l="invalid low value for NoAD tiebreak":(d=!0,r=(r||"")+n):l=a?"tiebreak begins with zero":"tiebreak digit limit"}else if(m.isCloser)l=`invalid key: ${n}`;else if(m.isGameScoreEntry)l="game scoreString entry";else if(m.lastSetIsComplete||!i.length){var v,g;d=!0;const{scoreString:e,set:a}=function({analysis:e,lowSide:t,scoreString:n,value:r}){const{setTo:i,tiebreakAt:a,NoAD:o}=e.setFormat,s=r===parseInt(a||i);if(a&&a<i&&r>a)return{scoreString:n};if(o&&r===i||r>i)return{scoreString:n};const c=s?r+1:r+1===i?r+(o?1:2):i,u=[r,c];2===t&&u.reverse();const d=eo.split("")[0];n=(n||"")+(u.join(uo)+(s?d:Ha));const l={side1Score:u[0],side2Score:u[1]},p=Ga({analysis:e,set:l});return l.winningSide=p||void 0,{scoreString:n,set:l}}({analysis:m,lowSide:t,scoreString:r,value:parseInt(n)});a&&(a.setNumber=(null===(v=i)||void 0===v?void 0:v.length)+1||1),i=(null===(g=i)||void 0===g?void 0:g.concat(a).filter(Boolean))||[a],r=e||void 0}else console.log("error: unknown outcome")}else(!m.isSetTiebreakEntry||m.isSetTiebreakEntry&&!m.isNumericEnding)&&(d=!0,({scoreString:r,sets:i}=wo({analysis:m,scoreString:r,sets:i,lowSide:t,auto:u})),o=void 0);if(d){var I;i=null===(I=i)||void 0===I?void 0:I.filter(Boolean);const{matchUpWinningSide:e}=Do({sets:i,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=e,!e||o&&![R,M].includes(o)?!r||a||[Ja,$a,Qa].includes(o)||(o=void 0):(o="COMPLETED",i=i.filter((e=>{const{side1Score:t,side2Score:n,side1TiebreakScore:r,side2TiebreakScore:i}=e;return t||n||r||i}))),{updated:d,scoreString:r,sets:i,winningSide:a,matchUpStatus:o,message:l}}return{updated:d,scoreString:r,sets:i,winningSide:a,matchUpStatus:o,message:l}},analyzeSet:Co};const xo=[{ioc:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso:"AD",label:"Andorra",phone:"376"},{ioc:"UAE",iso:"AE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso:"AF",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso:"AG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso:"AI",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso:"AL",label:"Albania",phone:"355"},{ioc:"ARM",iso:"AM",label:"Armenia",phone:"374"},{ioc:"ANG",iso:"AO",label:"Angola",phone:"244"},{ioc:"",iso:"AQ",label:"Antarctica",phone:"672"},{ioc:"ARG",iso:"AR",label:"Argentina",phone:"54"},{ioc:"ASA",iso:"AS",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso:"AT",label:"Austria",phone:"43"},{ioc:"AUS",iso:"AU",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso:"AW",label:"Aruba",phone:"297"},{ioc:"",iso:"AX",label:"Alland Islands",phone:"358"},{ioc:"AZE",iso:"AZ",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso:"BA",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso:"BB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso:"BD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso:"BE",label:"Belgium",phone:"32"},{ioc:"BUR",iso:"BF",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso:"BG",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso:"BH",label:"Bahrain",phone:"973"},{ioc:"BDI",iso:"BI",label:"Burundi",phone:"257"},{ioc:"BEN",iso:"BJ",label:"Benin",phone:"229"},{ioc:"",iso:"BL",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso:"BM",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso:"BN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso:"BO",label:"Bolivia",phone:"591"},{ioc:"BRA",iso:"BR",label:"Brazil",phone:"55"},{ioc:"BAH",iso:"BS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso:"BT",label:"Bhutan",phone:"975"},{ioc:"",iso:"BV",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso:"BW",label:"Botswana",phone:"267"},{ioc:"BLR",iso:"BY",label:"Belarus",phone:"375"},{ioc:"BIZ",iso:"BZ",label:"Belize",phone:"501"},{ioc:"CAN",iso:"CA",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso:"CC",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso:"CD",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso:"CF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso:"CG",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso:"CH",label:"Switzerland",phone:"41"},{ioc:"CIV",iso:"CI",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso:"CK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso:"CL",label:"Chile",phone:"56"},{ioc:"CMR",iso:"CM",label:"Cameroon",phone:"237"},{ioc:"CHN",iso:"CN",label:"China",phone:"86"},{ioc:"COL",iso:"CO",label:"Colombia",phone:"57"},{ioc:"CRC",iso:"CR",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso:"CU",label:"Cuba",phone:"53"},{ioc:"CPV",iso:"CV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso:"CW",label:"Curacao",phone:"599"},{ioc:"CXR",iso:"CX",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso:"CY",label:"Cyprus",phone:"357"},{ioc:"CZE",iso:"CZ",label:"Czech Republic",phone:"420"},{ioc:"GER",iso:"DE",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso:"DJ",label:"Djibouti",phone:"253"},{ioc:"DEN",iso:"DK",label:"Denmark",phone:"45"},{ioc:"DMA",iso:"DM",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso:"DO",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso:"DZ",label:"Algeria",phone:"213"},{ioc:"ECU",iso:"EC",label:"Ecuador",phone:"593"},{ioc:"EST",iso:"EE",label:"Estonia",phone:"372"},{ioc:"EGY",iso:"EG",label:"Egypt",phone:"20"},{ioc:"",iso:"EH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso:"ER",label:"Eritrea",phone:"291"},{ioc:"ESP",iso:"ES",label:"Spain",phone:"34"},{ioc:"ETH",iso:"ET",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso:"FI",label:"Finland",phone:"358"},{ioc:"FIJ",iso:"FJ",label:"Fiji",phone:"679"},{ioc:"FLK",iso:"FK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso:"FM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso:"FO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso:"FR",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso:"GA",label:"Gabon",phone:"241"},{ioc:"GBR",iso:"GB",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso:"GD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso:"GE",label:"Georgia",phone:"995"},{ioc:"FGU",iso:"GF",label:"French Guiana",phone:"594"},{ioc:"",iso:"GG",label:"Guernsey",phone:"44"},{ioc:"",iso:"GH",label:"Ghana",phone:"233"},{ioc:"GIB",iso:"GI",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso:"GL",label:"Greenland",phone:"299"},{ioc:"GAM",iso:"GM",label:"Gambia",phone:"220"},{ioc:"GUI",iso:"GN",label:"Guinea",phone:"224"},{ioc:"GUD",iso:"GP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso:"GQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso:"GR",label:"Greece",phone:"30"},{ioc:"",iso:"GS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso:"GT",label:"Guatemala",phone:"502"},{ioc:"GUM",iso:"GU",label:"Guam",phone:"1-671"},{ioc:"GBS",iso:"GW",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso:"GY",label:"Guyana",phone:"592"},{ioc:"HKG",iso:"HK",label:"Hong Kong",phone:"852"},{ioc:"",iso:"HM",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso:"HN",label:"Honduras",phone:"504"},{ioc:"CRO",iso:"HR",label:"Croatia",phone:"385"},{ioc:"HAI",iso:"HT",label:"Haiti",phone:"509"},{ioc:"HUN",iso:"HU",label:"Hungary",phone:"36"},{ioc:"INA",iso:"ID",label:"Indonesia",phone:"62"},{ioc:"IRL",iso:"IE",label:"Ireland",phone:"353"},{ioc:"ISR",iso:"IL",label:"Israel",phone:"972"},{ioc:"",iso:"IM",label:"Isle of Man",phone:"44"},{ioc:"IND",iso:"IN",label:"India",phone:"91"},{ioc:"",iso:"IO",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso:"IQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso:"IR",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso:"IS",label:"Iceland",phone:"354"},{ioc:"ITA",iso:"IT",label:"Italy",phone:"39"},{ioc:"",iso:"JE",label:"Jersey",phone:"44"},{ioc:"JAM",iso:"JM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso:"JO",label:"Jordan",phone:"962"},{ioc:"JPN",iso:"JP",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso:"KE",label:"Kenya",phone:"254"},{ioc:"KGZ",iso:"KG",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso:"KH",label:"Cambodia",phone:"855"},{ioc:"KIR",iso:"KI",label:"Kiribati",phone:"686"},{ioc:"COM",iso:"KM",label:"Comoros",phone:"269"},{ioc:"SKN",iso:"KN",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso:"KP",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso:"KR",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso:"KW",label:"Kuwait",phone:"965"},{ioc:"CAY",iso:"KY",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso:"KZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso:"LA",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso:"LB",label:"Lebanon",phone:"961"},{ioc:"LCA",iso:"LC",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso:"LI",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso:"LK",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso:"LR",label:"Liberia",phone:"231"},{ioc:"LES",iso:"LS",label:"Lesotho",phone:"266"},{ioc:"LTU",iso:"LT",label:"Lithuania",phone:"370"},{ioc:"LUX",iso:"LU",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso:"LV",label:"Latvia",phone:"371"},{ioc:"LBA",iso:"LY",label:"Libya",phone:"218"},{ioc:"MAR",iso:"MA",label:"Morocco",phone:"212"},{ioc:"MON",iso:"MC",label:"Monaco",phone:"377"},{ioc:"MDA",iso:"MD",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso:"ME",label:"Montenegro",phone:"382"},{ioc:"",iso:"MF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso:"MG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso:"MH",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso:"MK",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso:"ML",label:"Mali",phone:"223"},{ioc:"MYA",iso:"MM",label:"Myanmar",phone:"95"},{ioc:"MGL",iso:"MN",label:"Mongolia",phone:"976"},{ioc:"MAC",iso:"MO",label:"Macao",phone:"853"},{ioc:"NMA",iso:"MP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso:"MQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso:"MR",label:"Mauritania",phone:"222"},{ioc:"MNT",iso:"MS",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso:"MT",label:"Malta",phone:"356"},{ioc:"MRI",iso:"MU",label:"Mauritius",phone:"230"},{ioc:"MDV",iso:"MV",label:"Maldives",phone:"960"},{ioc:"MAW",iso:"MW",label:"Malawi",phone:"265"},{ioc:"MEX",iso:"MX",label:"Mexico",phone:"52"},{ioc:"MAS",iso:"MY",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso:"MZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso:"NA",label:"Namibia",phone:"264"},{ioc:"NCL",iso:"NC",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso:"NE",label:"Niger",phone:"227"},{ioc:"NFI",iso:"NF",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso:"NG",label:"Nigeria",phone:"234"},{ioc:"NCA",iso:"NI",label:"Nicaragua",phone:"505"},{ioc:"NED",iso:"NL",label:"Netherlands",phone:"31"},{ioc:"NOR",iso:"NO",label:"Norway",phone:"47"},{ioc:"NEP",iso:"NP",label:"Nepal",phone:"977"},{ioc:"NRU",iso:"NR",label:"Nauru",phone:"674"},{ioc:"NIU",iso:"NU",label:"Niue",phone:"683"},{ioc:"NZL",iso:"NZ",label:"New Zealand",phone:"64"},{ioc:"OMA",iso:"OM",label:"Oman",phone:"968"},{ioc:"PAN",iso:"PA",label:"Panama",phone:"507"},{ioc:"PER",iso:"PE",label:"Peru",phone:"51"},{ioc:"FPO",iso:"PF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso:"PG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso:"PH",label:"Philippines",phone:"63"},{ioc:"PAK",iso:"PK",label:"Pakistan",phone:"92"},{ioc:"POL",iso:"PL",label:"Poland",phone:"48"},{ioc:"SPM",iso:"PM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso:"PN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso:"PR",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso:"PS",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso:"PT",label:"Portugal",phone:"351"},{ioc:"PlW",iso:"PW",label:"Palau",phone:"680"},{ioc:"PAR",iso:"PY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso:"QA",label:"Qatar",phone:"974"},{ioc:"REU",iso:"RE",label:"Reunion",phone:"262"},{ioc:"ROU",iso:"RO",label:"Romania",phone:"40"},{ioc:"SRB",iso:"RS",label:"Serbia",phone:"381"},{ioc:"RUS",iso:"RU",label:"Russia",phone:"7"},{ioc:"RWA",iso:"RW",label:"Rwanda",phone:"250"},{ioc:"KSA",iso:"SA",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso:"SB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso:"SC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso:"SD",label:"Sudan",phone:"249"},{ioc:"SWE",iso:"SE",label:"Sweden",phone:"46"},{ioc:"SIN",iso:"SG",label:"Singapore",phone:"65"},{ioc:"HEL",iso:"SH",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso:"SI",label:"Slovenia",phone:"386"},{ioc:"",iso:"SJ",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso:"SK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso:"SL",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso:"SM",label:"San Marino",phone:"378"},{ioc:"SEN",iso:"SN",label:"Senegal",phone:"221"},{ioc:"SOM",iso:"SO",label:"Somalia",phone:"252"},{ioc:"SUR",iso:"SR",label:"Suriname",phone:"597"},{ioc:"",iso:"SS",label:"South Sudan",phone:"211"},{ioc:"STP",iso:"ST",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso:"SV",label:"El Salvador",phone:"503"},{ioc:"",iso:"SX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso:"SY",label:"Syria",phone:"963"},{ioc:"",iso:"SZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso:"TC",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso:"TD",label:"Chad",phone:"235"},{ioc:"",iso:"TF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso:"TG",label:"Togo",phone:"228"},{ioc:"THA",iso:"TH",label:"Thailand",phone:"66"},{ioc:"TJK",iso:"TJ",label:"Tajikistan",phone:"992"},{ioc:"",iso:"TK",label:"Tokelau",phone:"690"},{ioc:"TLS",iso:"TL",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso:"TM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso:"TN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso:"TO",label:"Tonga",phone:"676"},{ioc:"TUR",iso:"TR",label:"Turkey",phone:"90"},{ioc:"TTO",iso:"TT",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso:"TV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso:"TW",label:"Taiwan",phone:"886"},{ioc:"TAN",iso:"TZ",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso:"UA",label:"Ukraine",phone:"380"},{ioc:"UGA",iso:"UG",label:"Uganda",phone:"256"},{ioc:"USA",iso:"US",label:"United States",phone:"1",suggested:!0},{ioc:"URU",iso:"UY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso:"UZ",label:"Uzbekistan",phone:"998"},{ioc:"",iso:"VA",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso:"VC",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso:"VE",label:"Venezuela",phone:"58"},{ioc:"IVB",iso:"VG",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso:"VI",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso:"VN",label:"Vietnam",phone:"84"},{ioc:"VAN",iso:"VU",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso:"WF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso:"WS",label:"Samoa",phone:"685"},{ioc:"KOS",iso:"XK",label:"Kosovo",phone:"383"},{ioc:"YEM",iso:"YE",label:"Yemen",phone:"967"},{ioc:"MAY",iso:"YT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso:"ZA",label:"South Africa",phone:"27"},{ioc:"ZAM",iso:"ZM",label:"Zambia",phone:"260"},{ioc:"ZIM",iso:"ZW",label:"Zimbabwe",phone:"263"}];const Lo="MAIN",ko="QUALIFYING",Fo="CONSOLATION",jo="VOLUNTARY_CONSOLATION",_o="PLAY_OFF",Bo=[Lo,ko,Fo,_o,jo],Go={[ko]:1,[Lo]:2,[_o]:3,[Fo]:3,[jo]:4},Vo="CLUSTER",qo="WATERFALL",Ho="ITEM",Wo="CONTAINER",zo="DRAW",Ko="RANDOM",Yo="TOP_DOWN",$o="BOTTOM_UP",Jo="POSITION",Zo="WINNER",Qo="LOSER",Xo="FIRST_MATCHUP",es="AD_HOC",ts="FEED IN",ns="COMPASS",rs="OLYMPIC",is="SINGLE_ELIMINATION",as="DOUBLE_ELIMINATION",os="FIRST_MATCH_LOSER_CONSOLATION",ss="FIRST_ROUND_LOSER_CONSOLATION",cs="CURTIS_CONSOLATION",us="FEED_IN_CHAMPIONSHIP_TO_SF",ds="FEED_IN_CHAMPIONSHIP_TO_SF",ls="FEED_IN_CHAMPIONSHIP_TO_QF",ps="FEED_IN_CHAMPIONSHIP_TO_QF",fs="FEED_IN_CHAMPIONSHIP_TO_R16",ms="FEED_IN_CHAMPIONSHIP_TO_R16",hs="MODIFIED_FEED_IN_CHAMPIONSHIP",vs="MODIFIED_FEED_IN_CHAMPIONSHIP",gs="FEED_IN_CHAMPIONSHIP",Is="ROUND_ROBIN",ys="ROUND_ROBIN_WITH_PLAYOFF",bs="DECIDER",ws="BACKDRAW",Us={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-3":{name:"NORTHEAST",abbreviation:"NE"},"0-1-1":{name:"SOUTH",abbreviation:"S"},"0-1-2":{name:"SOUTHWEST",abbreviation:"SW"},"0-2-1":{name:"NORTHWEST",abbreviation:"NW"},"0-1-1-1":{name:"SOUTHEAST",abbreviation:"SE"}},Ss={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-1-1":{name:"SOUTH",abbreviation:"S"}},Ds="WIN_RATIO",Ns="ROUND_OUTCOME",Ps=[ts,ns,_o,rs,cs,us,ls,fs,os,ss,vs,ms,ps,ds,gs,ys],As={MAIN:Lo,QUALIFYING:ko,CONSOLATION:Fo,ITEM:Ho,CONTAINER:Wo,FIRST_MATCHUP:Xo,WINNER:Zo,LOSER:Qo,AD_HOC:es,FEED_IN:ts,COMPASS:ns,PLAY_OFF:_o,OLYMPIC:rs,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:is,DOUBLE_ELIMINATION:as,CURTIS:cs,FICSF:us,FICQF:ls,FICR16:fs,MFIC:hs,FIRST_MATCH_LOSER_CONSOLATION:os,FIRST_ROUND_LOSER_CONSOLATION:ss,MODIFIED_FEED_IN_CHAMPIONSHIP:vs,FEED_IN_CHAMPIONSHIP_TO_R16:ms,FEED_IN_CHAMPIONSHIP_TO_QF:ps,FEED_IN_CHAMPIONSHIP_TO_SF:ds,FEED_IN_CHAMPIONSHIP:gs,ROUND_ROBIN_WITH_PLAYOFF:ys,ROUND_ROBIN:Is,DECIDER:bs,BACKDRAW:ws,COMPASS_ATTRIBUTES:Us,OLYMPIC_ATTRIBUTES:Ss,DRAW:zo,RANDOM:Ko,TOP_DOWN:Yo,BOTTOM_UP:$o,WATERFALL:qo,WIN_RATIO:Ds,ROUND_OUTCOME:Ns,MULTI_STRUCTURE_DRAWS:Ps,generatedDrawTypes:[es,ns,cs,as,ps,ms,ds,gs,ts,os,ss,vs,rs,_o,Is,ys,is]},Ms="removeDrawPositionAssignment",Ts="assignDrawPosition",Es="addPenalty",Cs="ALTERNATE",Rs="WITHDRAW",Os="ASSIGN",xs="REMOVE",Ls="LUCKY",ks="SWAP",Fs="NICKNAME",js="SEED_VALUE",_s="PENALTY",Bs="BYE",Gs={ALTERNATE_PARTICIPANT:Cs,WITHDRAW_PARTICIPANT:Rs,ASSIGN_PARTICIPANT:Os,LUCKY_PARTICIPANT:Ls,REMOVE_ASSIGNMENT:xs,SWAP_PARTICIPANTS:ks,ADD_NICKNAME:Fs,ADD_PENALTY:_s,ASSIGN_BYE:Bs,SEED_VALUE:js},Vs={[ti]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[ko,Lo],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[js,Fs,_s],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1}},qs={[ni]:{policyName:"Round Naming Default",roundNamingMap:{1:"F",2:"SF",4:"QF"},affixes:{roundNumber:"R",preFeedRound:"Q"},stageConstants:{[Lo]:"",[_o]:"P",[ko]:"Q",[Fo]:"C"}}},Hs={[oi]:{policyName:"USTA",seedingProfile:"SEPARATE",duplicateSeedNumbers:!0,drawSizeProgression:!0,validSeedPositions:{ignore:!0},seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function Ws({courtDate:e,includeBookingTypes:t=[]}){const n=[];let r=xr(e.startTime);(e.bookings||[]).filter((e=>!e.bookingType||!t.includes(e.bookingType))).sort(((e,t)=>Tr(e.startTime).localeCompare(Tr(t.startTime)))).forEach((e=>{const t={startTime:Er(r.toISOString()),endTime:e.startTime};xr(e.startTime)>r&&n.push(t),xr(e.endTime)>r&&(r=xr(e.endTime))}));const i={startTime:Er(r.toISOString()),endTime:e.endTime};return xr(e.endTime)>r&&n.push(i),n}function zs({includeBookingTypes:e,averageMatchUpMinutes:t,periodStartTime:n,periodEndTime:r,periodLength:i,date:a}){function o(e){const i=xr(e.startTime),a=xr(e.endTime);if(i>n)return!1;if(a<r)return!1;return Lr(n,a)>=t}return{sameDate:e=>!e.date||_r(e.date,a),enoughTime:t=>!!Ws({courtDate:t,periodLength:i,includeBookingTypes:e}).filter(o).length}}function Ks({includeBookingTypes:e,averageMatchUpMinutes:t,periodLength:n,periodStart:r,courts:i,date:a}){const o=xr(r),s=Fr(o,t),{sameDate:c,enoughTime:u}=zs({includeBookingTypes:e,averageMatchUpMinutes:t,periodStartTime:o,periodEndTime:s,periodLength:n,date:a});return{availableToScheduleCount:i.filter((e=>!!(Array.isArray(e.dateAvailability)&&e.dateAvailability.filter(c).filter(u)).length)).length}}function Ys({remainingScheduleTimes:e=[],clearScheduleDates:t,periodLength:n=30,bookings:r=[],scheduleDate:i,courts:a=[]}){if(!Array.isArray(a)||!a.length)return{error:jn,courts:a};if(!Array.isArray(r))return{error:Ct};if(!yr(i))return{error:xt};t&&(Array.isArray(t)?t.includes(i)&&(r=[]):r=[]);const{courtBookings:o,unassignedBookings:s}=r.reduce(((e,t)=>{const{courtId:n}=t;return n?e.courtBookings[n]?e.courtBookings[n].push(t):e.courtBookings[n]=[t]:e.unassignedBookings.push(t),e}),{courtBookings:{},unassignedBookings:[]}),{sameDate:c}=zs({date:i}),u=a.map((({courtId:t,dateAvailability:n},r)=>{const i=o[t]||[],a=n.find(c)||{},{date:s,startTime:u,endTime:d,bookings:l=[]}=a;return{courtId:t,dateAvailability:{date:s,startTime:u,endTime:d,bookings:[e[r]&&{startTime:u,endTime:e[r]},...Gr(l,!1,!0),...i].filter(Boolean)}}}));s.sort(((e,t)=>Mr(e.startTime)-Mr(t.startTime)));for(const d of s){const{startTime:e,endTime:t,averageMinutes:r,recoveryMinutes:i,matchUpId:a}=d,o=Mr(e),s=Mr(t),c=u.map((e=>{const t=Ws({courtDate:e.dateAvailability});return{courtId:e.courtId,timeSlots:t}})).flat().reduce(((e,{courtId:t,timeSlots:r})=>{let i;return r.find((({startTime:t,endTime:r})=>{i=Mr(t)-o;const a=o>=Mr(t);return s<=Mr(r)&&0!==e.startDifference&&((0===i||i+n>=0)&&(void 0===e.startDifference||i<e.startDifference)||a)}))?{courtId:t,startDifference:i}:e}),{courtId:void 0,startDifference:void 0});if(c.courtId){const n={averageMinutes:r,recoveryMinutes:i,matchUpId:a,startTime:e,endTime:t};u.find((({courtId:e})=>e===c.courtId)).dateAvailability.bookings.push(n)}else console.log({unassignedBooking:d})}return{virtualCourts:u.map((({courtId:e,dateAvailability:t})=>({courtId:e,dateAvailability:[t]})))}}function $s({startTime:e="8:00",endTime:t="20:30",count:n=10,date:r}={}){return ie(0,n).map((()=>({dateAvailability:[{date:r,startTime:e,endTime:t}]})))}function Js({calculateStartTimeFromCourts:e=!0,remainingScheduleTimes:t,averageMatchUpMinutes:n=90,date:r=br(),clearScheduleDates:i,periodLength:a=30,startTime:o="08:00",endTime:s="19:00",courtsCount:c,bookings:u,courts:d}={}){r=Cr(r),o=Er(o),s=Er(s);let l=0,p=0,f=0,m=0,h=0;!d&&c&&(d=$s({startTime:o,endTime:s,count:c,date:r}));const{virtualCourts:v}=Ys({remainingScheduleTimes:t,scheduleDate:r,clearScheduleDates:i,periodLength:a,bookings:u,courts:d}),{firstTimeSlotStartTime:g}=function({averageMinutes:e,startTime:t,endTime:n,courts:r,date:i}){const{sameDate:a}=zs({date:i});let o;if(t&&n){const i=xr(t),s=xr(n);r.every((t=>!!Array.isArray(t.dateAvailability)&&t.dateAvailability.filter(a).find((t=>Ws({courtDate:t}).find((t=>{const n=xr(t.startTime),r=xr(t.endTime);if(n>s||n<i)return!1;if(r<i)return!1;const a=Lr(n,r)>=e;if(a){const e=Er(n.toISOString());(!o||e<o)&&(o=e)}return a}))))))}return{firstTimeSlotStartTime:o}}({averageMinutes:n,courts:v,startTime:o,endTime:s,date:r});e&&g&&(o=g||o);const I=Mr(o),y=Mr(s)-I,b=ie(0,Math.floor(y/a)+1).map((e=>{const t=function(e){let t=Math.floor(e/60);const n=e-60*t;return t>23&&(t%=24),[jr(t),jr(n)].join(":")}(I+e*a),{availableToScheduleCount:i}=Ks({courts:v,averageMatchUpMinutes:n,periodLength:a,periodStart:t,period:e,date:r}),o=i>p?i-p:0;h+=e?i:0;const s=e?h/e:i,c=e?a*s/n*(e-1)+s:s,u=i?p?c-l:o:0;l=c,p=i,f+=u;const d=parseInt(f)-m;return m+=d,{periodStart:t,add:d,availableToScheduleCount:i,newCourts:o,totalMatchUps:m}}));return{scheduleTimes:b.reduce(((e,t)=>e.concat(...ie(0,t.add).map((()=>({scheduleTime:t.periodStart}))))),[]).flat(),timingProfile:b,totalMatchUps:m}}const Zs={getCourtsAvailableAtPeriodStart:Ks,generateTimeSlots:Ws,getScheduleTimes:Js,courtGenerator:$s};function Qs(e,t,n=[]){return"object"==typeof e&&Object.keys(e).reduce(((r,i)=>"object"!=typeof e[i]?(r[n.concat(i).join(t)]=e[i],r):Object.assign(r,Qs(e[i],t,n.concat(i)))),{})}function Xs({element:e,itemType:t,itemSubTypes:n,returnPreviousValues:r}){if(!e)return{error:Mt};if(!Array.isArray(e.timeItems))return{error:Tn};const i=e.timeItems.filter((e=>(null==e?void 0:e.itemType)===t)).filter((e=>{var t;return!(null!=n&&n.length)||(null==e||null===(t=e.itemSubTypes)||void 0===t?void 0:t.includes(n))})).sort(((e,t)=>new Date(e.createdAt||void 0)-new Date(t.createdAt||void 0))),a=i.pop();if(a){const e={timeItem:a,...de};return r&&Object.assign(e,{previousItems:i}),e}return{message:qn}}function ec({event:e,itemType:t,itemSubTypes:n,returnPreviousValues:r}){if(!e)return{error:ze};if(!e.timeItems)return{message:qn};const{timeItem:i,previousItems:a,message:o}=Xs({element:e,itemType:t,itemSubTypes:n,returnPreviousValues:r});return i&&{timeItem:i,previousItems:a}||{message:o}}function tc({element:e,timeItem:t,duplicateValues:n=!0}){if(!e)return{error:Mt};if(!t)return{error:Mn};const r=t&&Object.keys(t),i=["itemType","itemValue"];if(!(i.filter((e=>r.includes(e))).length===i.length))return{error:An};if(e.timeItems){const{itemType:r,itemSubTypes:i,itemValue:a}=t,{timeItem:o}=Xs({element:e,itemType:r,itemSubTypes:i});if(JSON.stringify(null==o?void 0:o.itemValue)===JSON.stringify(a)&&!n)return de}else e.timeItems=[];t.itemSubTypes&&!t.itemSubTypes.length&&delete t.itemSubTypes;const a=(new Date).toISOString();return Object.assign(t,{createdAt:a}),e.timeItems.push(t),de}function nc({tournamentRecord:e,duplicateValues:t,participantId:n,timeItem:r}){if(!e)return{error:me};if(!n)return{error:Yt};const i=ra({tournamentRecord:e,participantId:n});return i.error?i:tc({element:i.participant,duplicateValues:t,timeItem:r})}function rc({tournamentRecord:e,duplicateValues:t,timeItem:n}){return e?tc({element:e,timeItem:n,duplicateValues:t}):{error:me}}function ic({event:e,timeItem:t,duplicateValues:n}){return e?tc({element:e,timeItem:t,duplicateValues:n}):{error:Ke}}const ac="addDrawDefinition",oc="addMatchUps",sc="addParticipants",cc="addVenue",uc="audit",dc="deletedDrawIds",lc="deleteParticipants",pc="deleteVenue",fc="deletedMatchUpIds",mc="modifyDrawDefinition",hc="modifyMatchUp",vc="modifyParticipants",gc="modifyVenue",Ic="publishEvent",yc={ADD_DRAW_DEFINITION:ac,ADD_MATCHUPS:oc,ADD_PARTICIPANTS:sc,ADD_VENUE:cc,AUDIT:uc,DELETED_DRAW_IDS:dc,DELETE_PARTICIPANTS:lc,DELETE_VENUE:pc,DELETED_MATCHUP_IDS:fc,MODIFY_DRAW_DEFINITION:mc,MODIFY_MATCHUP:hc,MODIFY_PARTICIPANTS:vc,MODIFY_VENUE:gc,PUBLISH_EVENT:Ic};function bc(e,t){var n;if(!e)return;let r=Date.now();r===e.updatedAt&&(r+=1);const i=null==t?void 0:t.filter(Boolean);e.updatedAt=r,null===(n=e.structures)||void 0===n||n.forEach((e=>{(null==i||!i.length||null!=i&&i.includes(e.structureId))&&(e.updatedAt=r)}))}function wc({drawDefinition:e,matchUps:t}){bc(e),nr({topic:oc,payload:{matchUps:t}})}function Uc({drawDefinition:e,matchUpIds:t,action:n}){bc(e),nr({topic:fc,payload:{action:n,matchUpIds:t}})}function Sc({drawDefinition:e,matchUp:t}){Nc({drawDefinition:e,structureIds:[t.structureId]}),nr({topic:hc,payload:{matchUp:t},key:t.matchUpId})}function Dc({drawDefinition:e}){bc(e),nr({topic:ac,payload:{drawDefinition:e},key:e.drawId})}function Nc({drawDefinition:e,structureIds:t}){bc(e,t),nr({topic:mc,payload:{drawDefinition:e},key:e.drawId})}function Pc({tournamentParticipants:e,tournamentRecord:t,participantIds:n}){if(!e&&!t)return{error:me};if(!Array.isArray(n)||n.length>2)return{error:qt};if(!n.length)return{error:Qt};const r=(e=e||(null==t?void 0:t.participants)||[]).filter((e=>e.participantType===La&&oe(n,e.individualParticipantIds).length===n.length&&e.individualParticipantIds.length===n.length)),i=r[0];if(!i)return{error:$t};const a=Gr(r.slice(1));return{participant:Gr(i),duplicatedPairParticipants:a,...de}}function Ac({drawDefinition:e,participantId:t}){if("object"!=typeof e)return{error:Ie};if("string"!=typeof t)return{error:Yt};const{extension:n}=ia({element:e,name:Vi});return{lineUp:((null==n?void 0:n.value)||{})[t]}}const Mc=e=>t=>e[t],Tc=(e=[])=>e.map(Oc).filter(Boolean),Ec=(e=[])=>e.map(Cc).filter(Boolean),Cc=(e={})=>Mc(e)("participantId"),Rc=(e={})=>Mc(e)("drawPosition"),Oc=(e={})=>Mc(e)("matchUpId");function xc({drawDefinition:e}){if(!e)return{error:Ie};const t=(e.extensions||[]).find((e=>e.name===ki));return{appliedPolicies:(null==t?void 0:t.value)||{}}}function Lc({matchUps:e=[]}){const t=e.reduce(((e,t)=>!t.roundNumber||e.includes(t.roundNumber)?e:e.concat(parseInt(t.roundNumber))),[]).sort(Hr).map((t=>{const n=e.filter((e=>e.roundNumber===t)),r=n.find((({matchUpType:e})=>e===la))?n.filter((({matchUpType:e})=>e===la)):n;return{[t]:r.sort(((e,t)=>Hr(e.roundPosition,t.roundPosition)))}})),n=e.reduce(((e,t)=>(e[t.roundNumber]||(e[t.roundNumber]=t.finishingRound),e)),{}),r=Object.assign({},...t),i=Object.assign({},...Object.keys(r).map((e=>{var t;return{[e]:{matchUpsCount:null===(t=r[e])||void 0===t?void 0:t.length}}})));let a=0,o=0;return Object.keys(r).map((e=>parseInt(e))).filter((e=>!isNaN(e))).forEach((e=>{const t=r[e].sort(((e,t)=>e.roundPosition-t.roundPosition)),s=t.map((e=>(null==e?void 0:e.drawPositions)||[])).flat();if(1!==e&&i[e-1]){const n=i[e-1].drawPositions,r=n.length/s.length,a=ce(n,r),o=t.map((t=>{const{roundPosition:r,drawPositions:i}=t;if(!r)return i;const o=(null==i?void 0:i.filter(Boolean))||[];if(null==o||!o.length)return[void 0,void 0];if(e<3&&2===(null==o?void 0:o.length))return null==i?void 0:i.slice().sort(Hr);if(null!=o&&o.length&&oe(n,o).length!==(null==o?void 0:o.length))return 1===(null==o?void 0:o.length)?[o[0],void 0]:null==i?void 0:i.slice().sort(Hr);const s=2*(r-1);return a.slice(s,s+2).map((e=>null==i?void 0:i.find((t=>e.includes(t)))))}));i[e].drawPositions=null==o?void 0:o.flat(),i[e].pairedDrawPositions=o}else{const t=s.sort(Hr),n=ce(t,2);i[e].drawPositions=t,i[e].pairedDrawPositions=n}i[e].finishingRound=n[e],i[e].finishingPositionRange=r[e][0].finishingPositionRange,i[e+1]&&i[e+1].matchUpsCount===i[e].matchUpsCount&&(i[e+1].feedRound=!0,i[e+1].feedRoundIndex=o,i[e].preFeedRound=!0,o+=1),i[e]&&!i[e].feedRound&&(i[e].roundIndex=a,a+=1)})),{roundMatchUps:r,roundProfile:i}}function kc({drawDefinition:e,structure:t}){const n={},r=[];return((null==e?void 0:e.structures)||[t]).filter((e=>e&&"object"==typeof e)).forEach((e=>{const{structureId:t,matchUps:i,structures:a}=e,o=Array.isArray(a);if(o)o&&a.forEach((e=>{const{structureName:i}=e,a=e.matchUps;n[e.structureId]={matchUps:a,structureName:i},r.push(...a),a.forEach((e=>{r.push(e),e.tieMatchUps&&r.push(...e.tieMatchUps)})),n[t]||(n[t]={}),n[t].itemStructureIds||(n[t].itemStructureIds=[]),n[t].itemStructureIds.push(e.structureId)}));else{const e=i;n[t]={matchUps:e},e.forEach((e=>{r.push(e),e.tieMatchUps&&r.push(...e.tieMatchUps)}))}})),{mappedMatchUps:n,drawMatchUps:r}}function Fc({mappedMatchUps:e,matchUpsMap:t,structureId:n,inContext:r}){let i=(e=(null==t?void 0:t.mappedMatchUps)||e)[n];const a=((null==i?void 0:i.itemStructureIds)||[]).map((t=>{const{matchUps:n,structureName:i}=e[t];return r?n.map((e=>Object.assign(Gr(e,!0,!0),{structureId:t,structureName:i}))):n})).flat();return((null==i?void 0:i.matchUps)||[]).concat(...a)}function jc(e,t){var n,r;return(Go[null==e?void 0:e.stage]||0)-(Go[null==t?void 0:t.stage]||0)||((null==t||null===(n=t.positionAssignments)||void 0===n?void 0:n.length)||9999)-((null==e||null===(r=e.positionAssignments)||void 0===r?void 0:r.length)||9999)||((null==e?void 0:e.stageSequence)||0)-((null==t?void 0:t.stageSequence)||0)}function _c({drawDefinition:e,structureId:t}){if(!e)return{error:Ie};if(!t)return{error:Ge};const{structures:n}=Bc({drawDefinition:e}),r=n.map((e=>e.structures?[].concat(...e.structures,e):e)).flat().find((e=>e.structureId===t));return r?{structure:r}:{error:Ve}}function Bc({stage:e,stageSequence:t,drawDefinition:n}){var r;const i=n?n.structures?void 0:qe:Ie;if(i)return{error:i};return{structures:null===(r=n.structures)||void 0===r?void 0:r.filter((function(t){return!e||t.stage===e})).filter((function(e){return!t||e.stageSequence===t})).sort(jc)}}function Gc(e){if(!e||"object"!=typeof e)return!1;if("string"!=typeof e.name)return!1;const t=Object.keys(e),n=["name","value"];return n.filter((e=>t.includes(e))).length===n.length}function Vc({element:e,extension:t}={}){if(!e)return{error:Mt};if("object"!=typeof e)return{error:jn};if(!Gc(t))return{error:jn};e.extensions||(e.extensions=[]);const n=(new Date).toISOString();Object.assign(t,{createdAt:n});const r=e.extensions.find((({name:e})=>e===t.name));return r?r.value=t.value:t.value&&e.extensions.push(t),{...de}}function qc({element:e,name:t}={}){return e?"object"!=typeof e?{error:jn}:t?e.extensions?(e.extensions=e.extensions.filter((e=>(null==e?void 0:e.name)!==t)),{...de}):{...de,message:qn}:{error:Mt,message:"Missing name"}:{error:Mt}}function Hc({tournamentRecord:e,extension:t}={}){return e?Vc({element:e,extension:t}):{error:me}}function Wc({drawDefinition:e,extension:t}={}){return e?Vc({element:e,extension:t}):{error:be}}function zc({event:e,extension:t}={}){return e?Vc({element:e,extension:t}):{error:ze}}function Kc({tournamentRecord:e,name:t}={}){return e?qc({element:e,name:t}):{error:me}}function Yc({event:e,name:t}={}){return e?qc({element:e,name:t}):{error:Ke}}function $c({drawDefinition:e,attributes:t}){var n;let{extension:r}=sa({drawDefinition:e,name:_i});const i=(null===(n=r)||void 0===n?void 0:n.value)||e.entryProfile||{};return t.forEach((e=>{Object.keys(e).forEach((t=>{i[t]?Object.assign(i[t],e[t]):i[t]=e[t]}))})),r={name:_i,value:i},Wc({drawDefinition:e,extension:r}),{entryProfile:i}}var Jc;!function(e){e.CONFIRMED="CONFIRMED",e.DIRECT_ACCEPTANCE="DIRECT_ACCEPTANCE",e.ORGANISER_ACCEPTANCE="ORGANISER_ACCEPTANCE",e.ALTERNATE="ALTERNATE",e.WITHDRAWN="WITHDRAWN",e.UNPAIRED="UNPAIRED",e.UNGROUPED="UNGROUPED",e.LUCKY_LOSER="LUCKY_LOSER",e.FEED_IN="FEED_IN",e.QUALIFIER="QUALIFIER",e.WILDCARD="WILDCARD"}(Jc||(Jc={}));var Zc=Jc.ALTERNATE,Qc=Jc.FEED_IN,Xc=Jc.QUALIFIER,eu=Jc.WILDCARD,tu=Jc.DIRECT_ACCEPTANCE,nu=Jc.CONFIRMED,ru=Jc.LUCKY_LOSER,iu=Jc.ORGANISER_ACCEPTANCE,au=Jc.WITHDRAWN,ou=Jc.UNPAIRED,su=Jc.UNGROUPED,cu=[nu,tu,iu],uu=[ru,Qc,Xc,eu],du=[Qc,Xc,ru,eu,nu,tu,iu],lu=[Zc,au,Qc,ou,su,Xc,eu,tu,nu,ru,iu],pu={FEED_IN:Qc,WILDCARD:eu,UNPAIRED:ou,UNGROUPED:su,ALTERNATE:Zc,CONFIRMED:nu,QUALIFIER:Xc,WITHDRAWN:au,LUCKY_LOSER:ru,DIRECT_ACCEPTANCE:tu,ORGANISER_ACCEPTANCE:iu,DRAW_SPECIFIC_STATUSES:uu,EQUIVALENT_ACCEPTANCE_STATUSES:cu,VALID_ENTERED_TYPES:lu,VALID_ENTRY_STATUSES:lu,STRUCTURE_ENTERED_TYPES:du,STRUCTURE_SELECTED_STATUSES:du};function fu({drawDefinition:e}){let{extension:t}=sa({name:_i,drawDefinition:e});return{entryProfile:(null==t?void 0:t.value)||e.entryProfile||{}}}function mu({stage:e,drawDefinition:t}){return Boolean(hu({stage:e,drawDefinition:t})&&vu({stage:e,drawDefinition:t}))}function hu({stage:e,drawDefinition:t}){const{entryProfile:n}=fu({drawDefinition:t}),r=Object.keys(n).includes(e);if(!r&&Bo.includes(e)){return $c({drawDefinition:t,attributes:[{[e]:{drawSize:void 0,alternates:!0}}]}),!0}return r}function vu({stage:e,drawDefinition:t}){var n;const{entryProfile:r}=fu({drawDefinition:t});return r&&(null===(n=r[e])||void 0===n?void 0:n.drawSize)||0}function gu({stage:e,drawDefinition:t}){var n;const{entryProfile:r}=fu({drawDefinition:t});return r&&(null===(n=r[e])||void 0===n?void 0:n.qualifiersCount)||0}function Iu({stage:e,drawDefinition:t,entryStatus:n}){return t.entries.reduce(((t,r)=>r.entryStage===e&&r.entryStatus===n?t+1:t),0)}function yu({drawDefinition:e,stageSequence:t,entryStatuses:n,structureId:r,stages:i,stage:a}){var o;const s=(null===(o=e.entries)||void 0===o?void 0:o.reduce(((e,r)=>{const o=a&&r.entryStage===a||(null==i?void 0:i.length)&&i.includes(r.entryStage),s=!n||n.includes(r.entryStatus),c=r.stageSequence||1;return o&&(!t||c===t)&&s?e.concat(r):e}),[]))||[];return r&&!s.length?function({drawDefinition:e,structureId:t}){const n=[],r=(e.links||[]).find((e=>e.linkType===Jo&&e.target.structureId===t));if(r){const{finishingPositions:t,structureId:i}=r.source,{structure:a}=_c({drawDefinition:e,structureId:i});if(a.structureType===Wo){(a.structures||[]).forEach((e=>{const{positionAssignments:r}=e,{structureId:i}=e,a=i,o=Object.assign({},...r.map((e=>{var t;const{participantId:n}=e,r=null===(t=ia({element:e,name:Ji}).extension)||void 0===t?void 0:t.value;return r?{[n]:r}:void 0})).filter(Boolean));Object.keys(o).filter((e=>{const n=o[e];return t.includes(n.groupOrder)})).forEach((e=>{const r=o[e],{groupOrder:i,GEMscore:s}=r,c=t.sort().indexOf(i)+1;n.push({GEMscore:s,groupingValue:a,participantId:e,placementGroup:c,entryStage:_o,entryStatus:Qc})}))}))}}return n}({drawDefinition:e,structureId:r}):s}function bu({stage:e,drawDefinition:t}){return Iu({entryStatus:tu,drawDefinition:t,stage:e})}function wu({stage:e,drawDefinition:t}){return Iu({entryStatus:eu,drawDefinition:t,stage:e})}function Uu({entryStatus:e=tu,drawDefinition:t,stage:n}){if(e===Zc)return function({stage:e,drawDefinition:t}){var n;const{entryProfile:r}=fu({drawDefinition:t});return(null===(n=r[e])||void 0===n?void 0:n.alternates)||0}({stage:n,drawDefinition:t})?Object.assign({positionsAvailable:1/0},de):{error:ln};const r=function({stage:e,drawDefinition:t}){const n=vu({stage:e,drawDefinition:t}),r=gu({drawDefinition:t,stage:e});return n&&n-r}({drawDefinition:t,stage:n}),i=function({stage:e,drawDefinition:t}){const{entryProfile:n}=fu({drawDefinition:t});return n[e].wildcardsCount||0}({stage:n,drawDefinition:t}),a=Iu({entryStatus:eu,drawDefinition:t,stage:n}),o=a+Iu({entryStatus:tu,drawDefinition:t,stage:n}),s=r-o;return o>=r?{error:fn}:e===eu?a<i?de:{error:fn}:Object.assign({positionsAvailable:s},de)}function Su({drawDefinition:e,structureId:t,structure:n}){var r,i;let a,o=[];if(n||({structure:n,error:a}=_c({drawDefinition:e,structureId:t})),!n)return{seedAssignments:[],error:Ve};t||(t=n.structureId);const{stage:s,stageSequence:c}=n;if(!a){if(s===_o&&e){o=yu({drawDefinition:e,stageSequence:c,structureId:t,stage:s}).filter((e=>1===e.placementGroup)).sort(((e,t)=>e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore?-1:0)).map(((e,t)=>({participantId:e.participantId,seedNumber:t+1,seedValue:t+1,seedProxy:!0})))}else n.seedAssignments?o=n.seedAssignments:a=ke}return{seedAssignments:o,seedLimit:n.seedLimit||(null===(r=n)||void 0===r||null===(i=r.positionAssignments)||void 0===i?void 0:i.length),stage:s,stageSequence:c,error:a}}function Du({groupedOrder:e,roundPositionsCount:t}){if(!e||(null==e?void 0:e.length)<=t)return e;const n=ce(e,e.length/t).map((e=>e.reduce(((e,t)=>e+t)))),r=n.slice().sort(Hr);return n.map((e=>r.indexOf(e)+1))}function Nu(e){if(!Array.isArray(e))return"";const t=e.filter(z);if(!t.length)return"";return Q([Math.min(...t),Math.max(...t)]).join("-")}function Pu({structure:e,drawDefinition:t,structureId:n}){let r,i=[];if(!e){if(!t)return{positionAssignments:i,error:Ie};if(({structure:e,error:r}=_c({drawDefinition:t,structureId:n})),r)return{positionAssignments:i,error:r}}return e.structures?i=[].concat(...e.structures.map((e=>Pu({structure:e}).positionAssignments))):e.positionAssignments?i=e.positionAssignments:r=tt,{positionAssignments:i,error:r}}function Au({structure:e,drawDefinition:t,structureId:n}){const{positionAssignments:r}=Pu({structure:e,drawDefinition:t,structureId:n}),i=r.filter((e=>e.participantId||e.bye||e.qualifier)),a=r.length===i.length,o=r.filter((e=>!e.participantId&&!e.bye&&!e.qualifier));return{byePositions:r.filter((e=>!e.participantId&&e.bye)),assignedPositions:i,qualifierPositions:r.filter((e=>!e.participantId&&e.qualifier)),unassignedPositions:o,positionAssignments:r,allPositionsAssigned:a}}function Mu({drawPositions:e,roundProfile:t,roundNumber:n}){const r=[void 0,void 0];if(e.reduce(((e,t)=>isNaN(parseInt(t))&&e),!0))return{orderedDrawPositions:r,displayOrder:r};const i=t[n],a=(null==i?void 0:i.pairedDrawPositions.find((t=>se(t||[],e.filter(Boolean)))))||r,o=null==i?void 0:i.feedRound;if(function(e){return e.reduce(((e,t)=>!isNaN(parseInt(t))&&e),!0)}(e)){const t=e.sort(Hr);return{orderedDrawPositions:t,displayOrder:o?t:a}}if(o){const t=[e.find((e=>!isNaN(parseInt(e)))),void 0];return{orderedDrawPositions:t,displayOrder:t}}return{orderedDrawPositions:a,displayOrder:a}}function Tu({matchUp:e}){let t,n=[],r=[],i=[],a=[];if(e||(t=ht),e&&!e.sides&&(t=vt),e&&!e.hasContext&&(t=En),!t){n=e.sides.map((e=>e.participantId));const t=e.sides.filter((e=>e.participantType===Oa)).map((e=>e.participantId)).filter(Boolean);a=e.sides.map((e=>e.participant&&e.participant.individualParticipants)).filter(Boolean).map((e=>e.map((e=>null==e?void 0:e.participantId)).filter(Boolean))),r=[].concat(...t,...a.flat()).filter(Boolean),i=Q(r.concat(n)).filter(Boolean)}return{error:t,sideParticipantIds:n,individualParticipantIds:r,allRelevantParticipantIds:i,nestedIndividualParticipantIds:a}}function Eu({matchUp:e}){if(!e)return{error:ht};if(!e.hasContext)return{error:En};if(!e.sides||2!==e.sides.filter(Boolean).length)return{error:vt};const{sideParticipantIds:t,nestedIndividualParticipantIds:n,allRelevantParticipantIds:r}=Tu({matchUp:e}),i=(e.timeItems||[]).filter((e=>[li,pi].includes(null==e?void 0:e.itemType))).sort(((e,t)=>new Date(e.createdAt)-new Date(t.createdAt))),a=i.map((e=>e.itemValue)).filter((e=>i.filter((t=>(null==t?void 0:t.itemValue)===e)).reverse()[0].itemType===li));n.forEach(((e,n)=>{const r=t[n],i=(null==e?void 0:e.length)&&e.reduce(((e,t)=>e&&t&&a.includes(t)),!0);r&&i&&!a.includes(r)&&a.push(r)})),t.forEach(((e,t)=>{a.includes(e)&&(n[t]||[]).forEach((e=>{e&&!a.includes(e)&&a.push(e)}))}));return{allParticipantsCheckedIn:t.reduce(((e,t)=>a.includes(t)&&e),!0),checkedInParticipantIds:a,allRelevantParticipantIds:r}}function Cu(e){const{matchUps:t,isCollectionMatchUp:n,matchUpStatuses:r,matchUpFormats:i,matchUpFormat:a,collectionIds:o,isMatchUpTie:s,matchUpTypes:c,roundNumbers:u,matchUpIds:d,scheduledDates:l,scheduledDate:p,processContext:f,tournamentIds:m,structureIds:h,courtIds:v,eventIds:g,venueIds:I,drawIds:y,stages:b,filterMatchUpIds:w=!0,filterMatchUpTypes:U=!0}=e,S=Array.isArray(r)?r.filter(Boolean):[],D=Array.isArray(b)?b.filter(Boolean):[],N=Array.isArray(o)?o.filter(Boolean):[],P=Array.isArray(u)?u.filter(Boolean):[],A=Array.isArray(d)&&w?d.filter(Boolean):[],M=Array.isArray(c)&&U?c.filter(Boolean):[],T=Array.isArray(v)?v.filter(Boolean):[],E=Array.isArray(I)?I.filter(Boolean):[],C=Array.isArray(i)?i.filter(Boolean):"string"==typeof a?[a]:[],R=Array.isArray(l)?l.filter(Boolean):"string"==typeof p&&p.length?[p]:[],O=Array.isArray(m)?m.filter(Boolean):[],x=Array.isArray(g)?g.filter(Boolean):[],L=Array.isArray(y)?y.filter(Boolean):[],k=Array.isArray(h)?h.filter(Boolean):[];return t.filter((e=>{if(void 0!==s){if(s&&!e.tieMatchUps)return!1;if(!s&&e.tieMatchUps)return!1}if(void 0!==n){if(n&&!e.collectionId)return!1;if(!n&&e.collectionId)return!1}if(D.length&&!D.includes(e.stage))return!1;if(N.length&&!N.includes(e.collectionId))return!1;if(P.length&&!u.includes(e.roundNumber))return!1;if(S.length&&!S.includes(e.matchUpStatus))return!1;if(A.length&&!A.includes(e.matchUpId))return!1;if(M.length&&!M.includes(e.matchUpType))return!1;if(C.length&&!C.includes(e.matchUpFormat))return!1;if(null!=R&&R.length){const{scheduledTime:t}=Ua({matchUp:e}),{scheduledDate:n}=Sa({matchUp:e}),r=Cr(t)||n;if(!R.find((e=>_r(e,r))))return!1}if(T.length){const{courtId:t}=Da({matchUp:e});if(!v.filter(Boolean).includes(t))return!1}if(E.length){const{venueId:t}=Na({matchUp:e});if(!I.filter(Boolean).includes(t))return!1}if(f){if(O.length&&!O.includes(e.tournamentId))return!1;if(x.length&&!x.includes(e.eventId))return!1;if(L.length&&!L.includes(e.drawId))return!1;if(k.length&&!k.includes(e.structureId))return!1}return!0}))}function Ru({drawPositionCollectionAssignment:e,positionAssignments:t,displaySideNumber:n,seedAssignments:r,drawPosition:i,isFeedRound:a,sideNumber:o}){var s,c,u;const d=t.find((e=>e.drawPosition===i)),l=e?null===(s=e[i])||void 0===s?void 0:s.participantId:null==d?void 0:d.participantId,p=d?function({displaySideNumber:e,seedAssignments:t,participantId:n,assignment:r,sideNumber:i}){const a={drawPosition:r.drawPosition,displaySideNumber:e,sideNumber:i};if(n){const e=function({seedAssignments:e,participantId:t}){return e.find((e=>!e.seedProxy&&e.participantId===t))}({seedAssignments:t,participantId:n});Object.assign(a,e,{participantId:n})}else r.bye?Object.assign(a,{bye:!0}):r.qualifier&&Object.assign(a,{qualifier:!0});return a}({displaySideNumber:n,seedAssignments:r,participantId:l,assignment:d,sideNumber:o}):{};a&&(1===o?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0}));const f=null==e||null===(c=e[i])||void 0===c?void 0:c.teamParticipant,m=null==e||null===(u=e[i])||void 0===u?void 0:u.participant;return m&&Object.assign(p,{participant:m}),f&&Object.assign(p,{teamParticipant:f}),p}function Ou({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,tournamentParticipants:n,policyDefinitions:r,seedAssignments:i,drawDefinition:a,contextFilters:o,contextProfile:s,matchUpFilters:c,scheduleTiming:u,context:d={},matchUpsMap:l,roundFilter:p,structure:f,inContext:m,event:h}){var v,g,I,y,b;let U={},S={};if(!f)return{matchUps:[],collectionPositionMatchUps:U,roundMatchUps:S,error:He};const D=Array.isArray(null==c?void 0:c.eventIds)?c.eventIds.filter(Boolean):[],N=Array.isArray(null==c?void 0:c.structureIds)?c.structureIds.filter(Boolean):[],P=Array.isArray(null==c?void 0:c.drawIds)?c.drawIds.filter(Boolean):[],A=!(null!=d&&d.eventId)||!D.length&&!(null!=o&&null!==(v=o.eventIds)&&void 0!==v&&v.filter(Boolean).length)||D.includes(d.eventId)||(null==o||null===(g=o.eventIds)||void 0===g?void 0:g.includes(d.eventId)),M=!N.length||N.includes(f.structureId),T=!a||!P.length||P.includes(a.drawId);if(!A||!M||!T)return{matchUps:[],collectionPositionMatchUps:U,roundMatchUps:S};const{appliedPolicies:E}=xc({drawDefinition:a}),C=Object.assign({},t,E,r),R=null==C||null===(I=C.scoring)||void 0===I?void 0:I.structures,O=(null==R?void 0:R.stage)&&(null==R?void 0:R.stage[f.stage]),x=(null==O?void 0:O.stageSequence)&&O.stageSequence[f.stageSequence],L=(null==C||null===(y=C.scoring)||void 0===y?void 0:y.requireAllPositionsAssigned)||(null==O?void 0:O.requireAllPositionsAssigned)||(null==x?void 0:x.requireAllPositionsAssigned);l||(l=kc({drawDefinition:a,structure:f}));const{positionAssignments:k,allPositionsAssigned:F}=Au({structure:f}),j=!L||F,{seedAssignments:_}=Su({drawDefinition:a,matchUpsMap:l,structure:f});i=i||_;const{structureId:B,structureName:G,stage:V,stageSequence:q,exitProfile:H}=f,{drawId:W,drawName:z}=a||{},K=f.structures;let Y=Fc({matchUpsMap:l,structureId:B,inContext:m});const $=C&&C.roundNaming,{roundNamingProfile:J,roundProfile:Z}=function({roundNamingPolicy:e,structure:t,matchUps:n}){const r={},i=t.structures,{roundProfile:a}=Lc({matchUps:n}),{structureAbbreviation:o,stage:s}=t,c=qs.roundNaming,u=(null==e?void 0:e.roundNamingMap)||c.roundNamingMap,d=(null==e?void 0:e.affixes)||c.affixes,l=s&&s!==Lo&&s[0],p=null==e?void 0:e.stageConstants,f=p&&p[s]||l;return i?Object.assign(r,...Object.keys(a).map((e=>({[e]:`R${e}`})))):Object.assign(r,...Object.keys(a).map((e=>{const{matchUpsCount:t,preFeedRound:n}=a[e],r=2*t,i=u[t]||`${d.roundNumber}${r}`;i||console.log({roundNamingMap:u,matchUpsCount:t});const s=n?`-${d.preFeedRound}`:"";return{[e]:[f,o,`${i}${s}`].filter(Boolean).join("-")}}))),{roundNamingProfile:r,roundProfile:a}}({roundNamingPolicy:$,drawDefinition:a,structure:f,matchUps:Y});if(c&&(Y=Cu({matchUps:Y,...c,filterMatchUpTypes:!1,filterMatchUpIds:!1})),m){var X;const{sourceDrawPositionRanges:t}=function({drawDefinition:e,structureId:t,matchUpsMap:n}){if(!e)return{error:Ie};if(!t)return{error:Ge};const{structure:r}=_c({drawDefinition:e,structureId:t});if(r.stage!==Fo)return{message:"Structure is not CONSOLATION stage"};const{links:i}=e,a=(null==i?void 0:i.filter((e=>e.target.structureId===t)))||[],o=(null==a?void 0:a.reduce(((e,t)=>{const{structureId:n}=t.source;return e.includes(n)?e:e.concat(n)}),[]))||[],s=Object.assign({},...o.map((e=>{const t=Fc({matchUpsMap:n,structureId:e}),{roundProfile:r}=Lc({matchUps:t});return{[e]:r}}))),c=Fc({matchUpsMap:n,structureId:t}),{roundProfile:u}=Lc({matchUps:c}),d={};return null==a||a.forEach((e=>{const{structureId:t,roundNumber:n}=e.source,{feedProfile:r,groupedOrder:i,positionInterleave:a,roundNumber:o}=e.target,c=s[t],l=c[1]&&c[1].drawPositions,p=c[n],f=null==p?void 0:p.matchUpsCount;if(!f)return;const m=f?l.length/f:0,h=l.length/m;let v=l.slice();const g=Du({groupedOrder:i,roundPositionsCount:v.length}),I=(null==g?void 0:g.length)||1;if(I<=h){const e=ce(v,l.length/I);r===$o&&e.forEach((e=>e.reverse())),v=(null==g?void 0:g.length)&&(null==g?void 0:g.map((t=>e[t-1])).flat())||v}let y=ce(v,m);if(null!=g&&g.length||r===$o&&y.reverse(),a){const e=ie(0,a.interleave).map((()=>{})),t=ie(0,a.offset).map((()=>{}));y=y.map((t=>[t,...e])),y.unshift(t),y=y.flat(1);const n=y.length-a.offset;y=y.slice(0,n)}d[o]||(d[o]={});const b=u[o],w=null!=b&&b.feedRound?2:1;y.forEach(((e,t)=>{const n=1+t*w;d[o][n]||(d[o][n]=Nu(e))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:a,matchUpsMap:l,structureId:B}),{drawPositionsRanges:n}=function({drawDefinition:e,structureId:t,matchUpsMap:n}){var r;if(!e)return{error:Ie};if(!t)return{error:Ge};const i=Fc({matchUpsMap:n,structureId:t}),{roundProfile:a}=Lc({matchUps:i}),o=(Math.min(...(null===(r=a[1])||void 0===r?void 0:r.drawPositions)||[])||1)-1,s=Object.keys(a);return{drawPositionsRanges:Object.assign({},...(s||[]).map((e=>{var t;const{matchUpsCount:n}=a[e],r=(null===(t=a[1])||void 0===t?void 0:t.drawPositions)||[],i=ce(r,r.length/n),c=i.map(Nu),u=i.map((e=>e.map((e=>e-o)))).map(Nu),d=s.map((t=>{if(t>e)return;const{drawPositions:r}=a[t];return ce(r,r.length/n)})).filter(Boolean),l=ie(0,n).map((e=>d.map((t=>t[e])).flat().filter(Boolean).sort(Hr))).map((e=>Q(e))),p=l.map((e=>{return(t=e,t.reduce(((e,t)=>{const n=e[e.length-1];return n&&n[n.length-1]===t-1||e.push([]),e[e.length-1].push(t),e}),[])).map(Nu).join(", ");var t})),f=Object.assign({},...ie(0,n).map((e=>({[e+1]:{firstRoundDrawPositionsRange:c[e],firstRoundOffsetDrawPositionsRange:u[e],possibleDrawPositions:l[e],drawPositionsRange:p[e]}}))));return{[e]:f}})))}}({drawDefinition:a,matchUpsMap:l,structureId:B});Y=Y.map((r=>te({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,drawPositionsRanges:n,roundNamingProfile:J,appliedPolicies:C,isRoundRobin:K,roundProfile:Z,matchUp:r,event:h})));(null===(X=Y)||void 0===X?void 0:X.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{const t=e.tieMatchUps;Y=Y.concat(...t)})),o&&(Y=Cu({processContext:!0,...o,matchUps:Y}))}else{var ee;(null===(ee=Y)||void 0===ee?void 0:ee.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{const t=e.tieMatchUps;Y=Y.concat(...t)}))}return(null!=c&&c.matchUpTypes||null!=c&&c.matchUpIds)&&(Y=Cu({matchUpTypes:c.matchUpTypes,matchUpIds:c.matchUpIds,matchUps:Y})),({roundMatchUps:S}=Lc({matchUps:Y})),({collectionPositionMatchUps:U}=function({matchUps:e}){const t=e.reduce(((e,t)=>!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition)),[]).map((t=>({[t]:e.filter((e=>e.collectionPosition===t))})));return{collectionPositionMatchUps:Object.assign({},...t)}}({matchUps:Y})),p&&(Y=null===(b=Y)||void 0===b?void 0:b.filter((e=>e.roundNumber===p))),{matchUps:Y,roundMatchUps:S,collectionPositionMatchUps:U};function te({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,additionalContext:r={},drawPositionsRanges:o,roundNamingProfile:c,tieDrawPositions:l,appliedPolicies:p,isCollectionBye:m,matchUpTieId:h,isRoundRobin:v,roundProfile:g,sideLineUps:I,matchUp:y,event:b}){const U=y.tieFormat||f.tieFormat||(null==a?void 0:a.tieFormat)||(null==b?void 0:b.tieFormat),S=null==U?void 0:U.collectionDefinitions,D=y.collectionId&&(null==S?void 0:S.find((e=>e.collectionId===y.collectionId))),N=y.matchUpFormat||y.collectionId?D&&D.matchUpFormat:f.matchUpFormat||(null==a?void 0:a.matchUpFormat)||(null==b?void 0:b.matchUpFormat),P=y.matchUpType||(null==D?void 0:D.matchUpType)||f.matchUpType||(null==a?void 0:a.matchUpType)||(null==b?void 0:b.eventType)!==Ma&&(null==b?void 0:b.eventType),A=m?w:y.matchUpStatus,{schedule:M,endDate:T}=Ea({scheduleVisibilityFilters:e,scheduleTiming:u,matchUpFormat:N,matchUpType:P,matchUp:y,event:b}),E=y.drawPositions||l,{collectionPosition:C,collectionId:R,roundPosition:O}=y,x=y.roundNumber||r.roundNumber,L=function({tournamentParticipants:e,positionAssignments:t,collectionPosition:n,drawPositions:r=[],drawDefinition:i,collectionId:a,sideLineUps:o,matchUpType:s}){if(!a||!n)return;const c=(null==r?void 0:r.map((r=>{var c,u,d;const l=null===(c=t.find((e=>e.drawPosition===r)))||void 0===c?void 0:c.participantId,p=null==o?void 0:o.find((e=>(null==e?void 0:e.drawPosition)===r)),f=(null==p?void 0:p.teamParticipant)||(null==e?void 0:e.find((({participantId:e})=>e===l))),m=(null==p?void 0:p.lineUp)||(null===(u=Ac({participantId:l,drawDefinition:i}))||void 0===u?void 0:u.lineUp),h=null==m?void 0:m.filter((e=>e.collectionAssignments.find((e=>e.collectionId===a&&e.collectionPosition===n))));if(s===da||2===(null==h?void 0:h.length)){const t=null==h?void 0:h.map(Cc),{participant:n}=Pc({tournamentParticipants:e,participantIds:t}),i=null==n?void 0:n.participantId;return{[r]:{participantId:i,teamParticipant:f}}}const v=null==h||null===(d=h[0])||void 0===d?void 0:d.participantId;return v&&{[r]:{participantId:v,teamParticipant:f}}})).filter(Boolean))||{};return Object.assign({},...c)}({tournamentParticipants:n,positionAssignments:k,collectionPosition:C,drawDefinition:a,drawPositions:E,collectionId:R,sideLineUps:I,matchUpType:P}),F=c&&c[x]||r.roundName,_=g&&g[x]&&g[x].feedRound,K=o&&o[x],Y=K&&K[O],$=t&&t[x],J=Object.assign({},Vr(d),Vr({matchUpFormat:y.matchUpType!==Ma&&N,tieFormat:y.matchUpType===Ma&&U,endDate:y.endDate||T,drawPositionsRange:Y,structureName:G,stageSequence:q,drawPositions:E,matchUpStatus:A,matchUpTieId:h,matchUpType:P,exitProfile:H,structureId:B,roundNumber:x,feedRound:_,roundName:F,drawName:z,schedule:M,drawId:W,stage:V}),Gr(Vr(y),!0,!0));if(Array.isArray(E)){const{orderedDrawPositions:e,displayOrder:t}=Mu({drawPositions:E,roundProfile:g,roundPosition:O,roundNumber:x}),n=g[x]&&g[x].feedRound,r=t[0]!==e[0],a=e.map(((e,t)=>{var a;const o=t+1;return{...Ru({drawPositionCollectionAssignment:L,positionAssignments:k,displaySideNumber:r?3-o:o,seedAssignments:i,drawPosition:e,isFeedRound:n,sideNumber:o}),...null===(a=y.sides)||void 0===a?void 0:a.find((e=>e.sideNumber===o)),sourceDrawPositionRange:$&&$[2*(O-1)+t+1]}}));Object.assign(J,Gr({sides:a},!0,!0))}if(n&&J.sides&&(J.sides.filter(Boolean).forEach((e=>{if(e.participantId){const t=na({policyDefinitions:p,participantId:e.participantId,tournamentParticipants:n});t&&Object.assign(e,{participant:t})}if(e.participant&&e.participant.individualParticipantIds){const t=e.participant.individualParticipantIds.map((e=>na({policyDefinitions:p,tournamentParticipants:n,participantId:e})));Object.assign(e.participant,{individualParticipants:t})}})),!J.matchUpType)){const{matchUpType:e}=function({matchUp:e={}}={}){var t;let n=e.matchUpType;if(!n&&null!==(t=e.sides)&&void 0!==t&&t.length){const t=e.sides.find((({participant:e})=>e)),r=null==t?void 0:t.participant,i=null==r?void 0:r.participantType;n=i===Oa?ua:i===La?da:i===xa?xa:void 0}return{matchUpType:n}}({matchUp:J});e&&Object.assign(J,{matchUpType:e})}if(J.tieMatchUps){var Z;const n=J.matchUpStatus===w,r=null===(Z=J.sides)||void 0===Z?void 0:Z.map((({participant:e,drawPosition:t,sideNumber:n,lineUp:r})=>{const i=(null==e?void 0:e.participantType)===Ma&&e;return{teamParticipant:i&&Vr({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participanOthertName,participantName:i.participantName,participantId:i.participantId,teamId:i.teamId}),drawPosition:t,sideNumber:n,lineUp:r}}));J.tieMatchUps=J.tieMatchUps.map((i=>{const a=J.matchUpId;return te({tieDrawPositions:E,scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,sideLineUps:r,drawPositionsRanges:o,roundNamingProfile:c,additionalContext:{roundName:F,roundNumber:x},appliedPolicies:p,isCollectionBye:n,matchUpTieId:a,isRoundRobin:v,roundProfile:g,matchUp:i,event:b})}))}const Q=J.sides&&2===J.sides.filter((e=>e&&e.participantId)).length,X=!J.winningSide,ee=j&&Q&&X;if(Object.assign(J,{readyToScore:ee,hasContext:!0}),Q){const{allParticipantsCheckedIn:e,checkedInParticipantIds:t}=Eu({matchUp:J});Object.assign(J,{allParticipantsCheckedIn:e,checkedInParticipantIds:t})}return Array.isArray(null==s?void 0:s.exclude),J}}function xu({tournamentParticipants:e,drawDefinition:t,contextProfile:n,matchUpsMap:r,matchUpId:i,inContext:a,context:o,event:s}){if(!t)return{error:Ie};if(!i)return{error:lt};if("string"!=typeof i)return{error:jn};const{structures:c}=Bc({drawDefinition:t});for(const u of c){const{matchUps:c}=Ou({tournamentParticipants:e,drawDefinition:t,contextProfile:n,matchUpsMap:r,inContext:a,structure:u,context:o,event:s}),{matchUp:d}=Ca({matchUps:c,matchUpId:i});if(d)return{matchUp:d,structure:u}}return{error:ft}}function Lu({duplicateValues:e,drawDefinition:t,disableNotice:n,matchUpId:r,timeItem:i,event:a}){const{matchUp:o}=xu({drawDefinition:t,event:a,matchUpId:r});if(!o)return{error:ft};const s=tc({element:o,timeItem:i,duplicateValues:e});return n||Sc({drawDefinition:t,matchUp:o}),s}function ku({tournamentRecord:e}){if(!e)return{error:me};const t=Gr(e.venues||[]),n=t.reduce(((e,t)=>{var n;return null!=t&&null!==(n=t.courts)&&void 0!==n&&n.length?e.concat(t.courts):e}),[]);return{venues:t,courts:n}}function Fu({tournamentRecord:e,venueId:t}){if(!e)return{error:me};if(!t)return{error:Un};const n=(e.venues||[]).reduce(((e,n)=>n.venueId===t?n:e),void 0);return n&&{venue:n}||{error:wn}}function ju({tournamentRecord:e,drawDefinition:t,matchUpId:n,venueId:r,disableNotice:i}){if(!e)return{error:me};if(!n)return{error:lt};if(r){const{error:t}=Fu({tournamentRecord:e,venueId:r});if(t)return{error:t}}return Lu({drawDefinition:t,matchUpId:n,timeItem:{itemType:mi,itemValue:r},disableNotice:i,duplicateValues:!1})}function _u({tournamentRecord:e,courtId:t}){if(!e)return{error:me};if(!t)return{error:At};let n,r;return(e.venues||[]).forEach((e=>{(e.courts||[]).forEach((i=>{i.courtId===t&&(n=i,r=e)}))})),n&&{court:n,venue:r}||{error:In}}function Bu({tournamentRecord:e,venueId:t,venueIds:n}){if(!e)return{error:me};return{courts:(e.venues||[]).filter((e=>t?e.venueId===t:n?n.includes(e.venueId):!t&&!n)).map((e=>{const{venueId:t}=e,n=Gr(e.courts||[]);return n.forEach((e=>Object.assign(e,{venueId:t}))),n})).flat()}}function Gu({tournamentRecord:e,drawDefinition:t,courtDayDate:n,matchUpId:r,courtId:i,disableNotice:a}){if(!e)return{error:me};if(!r)return{error:lt};if(i){const{venue:n,error:o}=_u({tournamentRecord:e,courtId:i});if(o)return{error:o};ju({tournamentRecord:e,drawDefinition:t,matchUpId:r,venueId:null==n?void 0:n.venueId,disableNotice:a})}return Lu({drawDefinition:t,matchUpId:r,timeItem:{itemType:fi,itemDate:n,itemValue:i},disableNotice:a,duplicateValues:!1})}function Vu(e){if(hr.test(e)){const t=wr(new Date);return new Date(`${t}T${e}`)}return new Date(e)}function qu(e){return!(void 0!==e&&!gr.test(e))}function Hu({tournamentRecord:e,drawDefinition:t,disableNotice:n,matchUpId:r,schedule:i,event:a}){if(!t)return{error:Ie};if(!r)return{error:lt};if(!i)return{error:Mt};const{endTime:o,courtId:s,resumeTime:c,scheduledDate:u,scheduledTime:d,startTime:l,stopTime:p,venueId:f}=i;if(void 0!==u){const e=Wu({drawDefinition:t,matchUpId:r,scheduledDate:u,disableNotice:!0});if(null!=e&&e.error)return{error:e.error,scheduledDate:u}}if(void 0!==d){const e=zu({drawDefinition:t,matchUpId:r,scheduledTime:d,disableNotice:!0});if(null!=e&&e.error)return{error:e.error,scheduledTime:d}}if(void 0!==l){const e=Yu({disableNotice:!0,drawDefinition:t,matchUpId:r,startTime:l,event:a});if(null!=e&&e.error)return{error:e.error,startTime:l}}if(void 0!==p){const e=Ju({disableNotice:!0,drawDefinition:t,matchUpId:r,stopTime:p,event:a});if(null!=e&&e.error)return{error:e.error,stopTime:p}}if(void 0!==c){const e=Zu({disableNotice:!0,drawDefinition:t,resumeTime:c,matchUpId:r,event:a});if(null!=e&&e.error)return{error:e.error,resumeTime:c}}if(void 0!==o){const e=$u({disableNotice:!0,drawDefinition:t,matchUpId:r,endTime:o,event:a});if(null!=e&&e.error)return{error:e.error,endTime:o}}if(void 0!==s&&void 0!==u){const n=Gu({courtDayDate:u,disableNotice:!0,tournamentRecord:e,drawDefinition:t,matchUpId:r,courtId:s,event:a});if(null!=n&&n.error)return{error:n.error,courtId:s}}else if(void 0!==f){const n=ju({disableNotice:!0,tournamentRecord:e,drawDefinition:t,matchUpId:r,venueId:f,event:a});if(null!=n&&n.error)return{error:n.error,venueId:f}}if(!n){const{matchUp:e}=xu({drawDefinition:t,event:a,matchUpId:r});if(!e)return{error:ft};Sc({drawDefinition:t,matchUp:e})}return{...de}}function Wu({drawDefinition:e,matchUpId:t,disableNotice:n,scheduledDate:r}){if(!t)return{error:lt};const i=vr.test(r);if(r&&!i)return{error:xt};return Lu({drawDefinition:e,matchUpId:t,timeItem:{itemType:hi,itemValue:r},disableNotice:n,duplicateValues:!1})}function zu({drawDefinition:e,matchUpId:t,disableNotice:n,scheduledTime:r}){if(!t)return{error:lt};if(!qu(r))return{error:Lt};return Lu({drawDefinition:e,matchUpId:t,timeItem:{itemType:vi,itemValue:r},disableNotice:n,duplicateValues:!1})}function Ku({drawDefinition:e,matchUpId:t,disableNotice:n,participantId:r,officialType:i}){if(!t)return{error:lt};return Lu({drawDefinition:e,matchUpId:t,timeItem:{itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemSubTypes:[i],itemValue:r},disableNotice:n,duplicateValues:!1})}function Yu({drawDefinition:e,disableNotice:t,matchUpId:n,startTime:r,event:i}){if(!n)return{error:lt};if(!qu(r))return{error:Lt};const{matchUp:a}=xu({drawDefinition:e,event:i,matchUpId:n}),o=(a.timeItems||[]).filter((e=>[Ii,yi,bi].includes(null==e?void 0:e.itemType))).map((e=>Vu(e.itemValue))).reduce(((e,t)=>!e||t<e?t:e),void 0);if(!o||Vu(r)<o){a.timeItems&&(a.timeItems=a.timeItems.filter((e=>e.itemType!==gi)));return Lu({drawDefinition:e,matchUpId:n,timeItem:{itemType:gi,itemValue:r},disableNotice:t,duplicateValues:!1})}return{error:Pn}}function $u({drawDefinition:e,disableNotice:t,matchUpId:n,endTime:r,event:i}){if(!n)return{error:lt};if(!qu(r))return{error:Lt};const{matchUp:a}=xu({drawDefinition:e,event:i,matchUpId:n}),o=(a.timeItems||[]).filter((e=>[gi,yi,Ii].includes(null==e?void 0:e.itemType))).map((e=>Vu(e.itemValue))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(!o||Vu(r)>o){a.timeItems&&(a.timeItems=a.timeItems.filter((e=>e.itemType!==bi)));return Lu({drawDefinition:e,matchUpId:n,timeItem:{itemType:bi,itemValue:r},disableNotice:t,duplicateValues:!1})}return{error:Sn}}function Ju({drawDefinition:e,disableNotice:t,matchUpId:n,stopTime:r,event:i}){if(!n)return{error:lt};if(!qu(r))return{error:Lt};const{matchUp:a}=xu({drawDefinition:e,event:i,matchUpId:n}),o=a.timeItems||[];if(o.reduce(((e,t)=>t.itemType===bi||e),void 0))return{error:Dn};const s=o.filter((e=>[gi,yi,Ii].includes(null==e?void 0:e.itemType))).sort(((e,t)=>Vu(e.itemValue)-Vu(t.itemValue))),c=s[s.length-1],u=c&&c.itemType===Ii,d=s.filter((e=>!u||e.createdAt!==c.createdAt)).map((e=>Vu(e.itemValue))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(Vu(r)>d){if(a.timeItems&&u){const e=c.createdAt;a.timeItems=a.timeItems.filter((t=>t.createdAt!==e))}return Lu({drawDefinition:e,matchUpId:n,timeItem:{itemType:Ii,itemValue:r},disableNotice:t,duplicateValues:!0})}return{error:Nn}}function Zu({drawDefinition:e,disableNotice:t,resumeTime:n,matchUpId:r,event:i}){if(!r)return{error:lt};if(!qu(n))return{error:Lt};const{matchUp:a}=xu({drawDefinition:e,event:i,matchUpId:r}),o=a.timeItems||[];if(o.reduce(((e,t)=>t.itemType===bi||e),void 0))return{error:Dn};const s=o.filter((e=>[gi,yi,Ii].includes(null==e?void 0:e.itemType))).sort(((e,t)=>Vu(e.itemValue)-Vu(t.itemValue))),c=s[s.length-1],u=c&&c.itemType===yi,d=s.filter((e=>!u||e.createdAt!==c.createdAt)).map((e=>Vu(e.itemValue))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(Vu(n)>d){if(a.timeItems&&u){const e=c.createdAt;a.timeItems=a.timeItems.filter((t=>t.createdAt!==e))}return Lu({drawDefinition:e,matchUpId:r,timeItem:{itemType:yi,itemValue:n},disableNotice:t,duplicateValues:!0})}return{error:"Invalid resumeTime"}}function Qu({participants:e=[]}){const t=Gr(e,!0,!0),n=t.filter((e=>e.participantType===xa)),r=t.filter((e=>e.participantType===ka)),i=t.filter((e=>e.participantType===La));return t.forEach((e=>{if(e.participantType===Oa){const{participantId:t}=e;e.teams=[],e.teamParticipantIds=[],e.groups=[],e.groupParticipantIds=[],e.pairParticipantIds=[],n.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((r=>{r!==t||e.teamParticipantIds.includes(n.participantId)||(e.teamParticipantIds.push(n.participantId),e.teams.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId,teamId:n.teamId}))}))})),i.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((r=>{r!==t||e.pairParticipantIds.includes(n.participantId)||e.pairParticipantIds.push(n.participantId)}))})),r.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((r=>{r!==t||e.groupParticipantIds.includes(n.participantId)||(e.groupParticipantIds.push(n.participantId),e.groups.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId}))}))}))}})),t}function Xu({drawDefinition:e,inContextDrawMatchUps:t,targetLink:n,sourceRoundPosition:r,sourceRoundMatchUpCount:i}){if(!n)return{error:_e};const{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:u}}=n,{structure:d}=_c({drawDefinition:e,structureId:a}),{positionAssignments:l}=Pu({structure:d}),p=(null==t?void 0:t.filter((e=>e.structureId===d.structureId))).filter((e=>e.roundNumber===c)),f=p.length,m=ie(1,f+1),h=f/i;let v=Math.ceil(h*r),g=1-r%2;if(null!=u&&u.interleave&&.5!==h){const e=r+(u.offset+(r-1)*u.interleave);v=Math.ceil(e/2),g=1-e%2}let I=m,y=m[v-1];const b=Du({groupedOrder:s,roundPositionsCount:m.length}),w=(null==b?void 0:b.length)||1;if(w<=m.length){const e=ce(m,f/w);o===$o&&e.forEach((e=>e.reverse())),I=(null==b?void 0:b.length)&&(null==b?void 0:b.map((t=>e[t-1])).flat())||I}o===Yo?y=I[v-1]:o===$o?((null==b||!b.length||w>m.length)&&(v=p.length+1-v),y=I[v-1]):o===Ko?Xn()&&console.log("not implemented:",{feedProfile:o}):o===zo&&Xn()&&console.log("not implemented:",{feedProfile:o});const U=y&&p.reduce(((e,t)=>t.roundPosition===y?t:e),void 0);let S;var D;null!=U&&U.feedRound?(g=0,S=Math.min(...(U.drawPositions||[]).filter(Boolean))):S=2===(null==U||null===(D=U.drawPositions)||void 0===D?void 0:D.length)&&(null==U?void 0:U.drawPositions[g]);const N=l.find((({drawPosition:e})=>e===S));if(N){const{extension:e}=ia({element:N,name:ji});if(null!=e&&e.value)return{disabledDrawPosition:S}}return{matchUp:U,targetDrawPosition:S,matchUpDrawPositionIndex:g}}function ed({source:e,linkType:t,finishingPositions:n}){return e.reduce(((e,r)=>{var i,a;return(!(null!==(i=r.source)&&void 0!==i&&i.finishingPositions)||!n||se(n,null===(a=r.source)||void 0===a?void 0:a.finishingPositions))&&r.linkType===t?r:e}),void 0)}function td({drawDefinition:e,structureId:t,roundNumber:n}){if(!e)return{error:Ie};if(!t)return{error:Ge};return{links:(e.links||[]).filter(Boolean).reduce(((e,r)=>{var i,a;return(null===(i=r.source)||void 0===i?void 0:i.structureId)!==t||n&&r.source.roundNumber!==n||(e.source=e.source.concat(r)),(null===(a=r.target)||void 0===a?void 0:a.structureId)!==t||n&&r.target.roundNumber!==n||(e.target=e.target.concat(r)),e}),{source:[],target:[]})}}function nd({matchUpId:e,drawDefinition:t,inContextDrawMatchUps:n=[],inContextMatchUp:r,useTargetMatchUpIds:i=!1}){let a=r;n.length&&!a&&(a=n.find((t=>t.matchUpId===e)));const{structure:o}=_c({drawDefinition:t,structureId:a.structureId}),{finishingPosition:s}=o;return s===Ns?function({matchUp:e,structure:t,drawDefinition:n,inContextDrawMatchUps:r,useTargetMatchUpIds:i}){const{links:{source:a}}=function({drawDefinition:e,roundNumber:t,structureId:n}){if(!e)return{error:Ie};if(!n)return{error:Ge};const{links:r}=td({drawDefinition:e,structureId:n});return{links:{source:r.source.reduce(((e,n)=>n.source.roundNumber&&n.source.roundNumber!==t?e:e.concat(n)),[]),target:r.target.reduce(((e,n)=>n.target.roundNumber&&n.target.roundNumber!==t?e:e.concat(n)),[])}}}({drawDefinition:n,roundNumber:e.roundNumber,structureId:t.structureId}),o=ed({source:a,linkType:Zo}),s=ed({source:a,linkType:Qo}),{winnerMatchUpId:c,loserMatchUpId:u}=e;let d,l,p,f,m,h,v;i&&(f=c&&r.find((({matchUpId:e})=>e===c)),d=u&&r.find((({matchUpId:e})=>e===u)));if(o&&!f||s&&!d){const{roundPosition:i}=e;v=v||r.filter((e=>e.structureId===t.structureId));const a=v.reduce(((t,n)=>n.roundNumber===e.roundNumber?t+1:t),0);s&&({matchUp:d,matchUpDrawPositionIndex:p,targetDrawPosition:l}=Xu({drawDefinition:n,inContextDrawMatchUps:r,sourceRoundPosition:i,sourceRoundMatchUpCount:a,targetLink:s})),o&&({matchUp:f,matchUpDrawPositionIndex:h,targetDrawPosition:m}=Xu({drawDefinition:n,inContextDrawMatchUps:r,sourceRoundPosition:i,sourceRoundMatchUpCount:a,targetLink:o}))}f||(v=v||r.filter((e=>e.structureId===t.structureId)),({matchUp:f}=function({structureMatchUps:e,matchUp:t}){const{roundNumber:n,roundPosition:r}=t,i=e.filter((e=>e.roundNumber===n)),a=e.filter((e=>e.roundNumber===n+1));if(a.length){let e;return a.length===i.length?e=a.find((e=>e.roundPosition===r)):a.length===i.length/2&&(e=a.find((e=>e.roundPosition===Math.ceil(r/2)))),{matchUp:e}}return{error:"no progression found"}}({structureMatchUps:v,matchUp:e})));return{matchUp:e,targetLinks:{loserTargetLink:s,winnerTargetLink:o},targetMatchUps:{loserMatchUp:d,winnerMatchUp:f,loserTargetDrawPosition:l,winnerTargetDrawPosition:m,loserMatchUpDrawPositionIndex:p,winnerMatchUpDrawPositionIndex:h}}}({drawDefinition:t,inContextDrawMatchUps:n,structure:o,matchUp:a,useTargetMatchUpIds:i}):function({matchUp:e}){return{matchUp:e,targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0}}}({drawDefinition:t,matchUp:a,structure:o})}function rd({drawDefinition:e,inContextDrawMatchUps:t}){const n={};return t.forEach((r=>{const{matchUpId:i,structureId:a,drawPositions:o=[]}=r,{structure:s}=_c({drawDefinition:e,structureId:a});if((null==s?void 0:s.finishingPosition)===Ds){const{roundNumber:e}=r,t=e&&parseInt(e)+1,n=s.matchUps||[],{roundMatchUps:i}=Lc({matchUps:n});if(t&&i[t]){const e=o.sort().map(((e,n)=>{const r=i[t].find((t=>t.drawPositions.includes(e)));return{matchUpId:null==r?void 0:r.matchUpId,roundNumber:t,schedule:null==r?void 0:r.schedule,sideNumber:n+1,structureName:s.structureName}}));Object.assign(r,{sidesTo:e})}}else{var c;const a=nd({matchUpId:i,drawDefinition:e,inContextMatchUp:r,inContextDrawMatchUps:t,useTargetMatchUpIds:!0}),{winnerMatchUp:o,loserMatchUp:s}=a.targetMatchUps;!r.winnerMatchUpId&&o&&(r.winnerMatchUpId=o.matchUpId),!r.loserMatchUpId&&s&&(r.loserMatchUpId=s.matchUpId);const h=ad({upcomingMatchUp:o});let v=ad({upcomingMatchUp:s});if(r.matchUpStatus!==w&&(null==s?void 0:s.matchUpStatus)===w){const{matchUp:n}=id({matchUp:s,drawDefinition:e,inContextDrawMatchUps:t})||{};v=n&&ad({upcomingMatchUp:n})||v}const g=null===(c=r.schedule)||void 0===c?void 0:c.timeAfterRecovery;if(g){var u,d,l;if(null!=h&&null!==(u=h.schedule)&&void 0!==u&&u.scheduledTime){Mr(h.schedule.scheduledTime)<Mr(g)&&(n[h.matchUpId]=r.matchUpId,h.schedule.scheduleConflict=r.matchUpId)}if(null!==(d=v)&&void 0!==d&&null!==(l=d.schedule)&&void 0!==l&&l.scheduledTime){Mr(h.schedule.scheduledTime)<Mr(g)&&(n[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId)}}if(Object.assign(r,{winnerTo:h,loserTo:v}),r.drawPositions.filter(Boolean).length){var p;const e=null===(p=a.targetLinks)||void 0===p?void 0:p.loserTargetLink,t=(null==e?void 0:e.linkCondition)===Xo,n=(null==(f=r)||null===(m=f.sides)||void 0===m?void 0:m.map((({participant:e,participantId:t,qualifier:n})=>e||t&&{participantId:t}||n&&{qualifier:n})).filter(Boolean))||[];if(n.length){const e=Ec(null==o?void 0:o.sides),r=Ec(null==s?void 0:s.sides),i=n.find((({participantId:t})=>e.includes(t)))?[]:n,a=n.find((({participantId:e})=>r.includes(e)))?[]:n;s&&t&&a.length<2&&a.push({bye:!0,tbd:!0}),null!=i&&i.length&&o&&(o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(i)),null!=a&&a.length&&s&&(s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(a))}}}var f,m})),Object.keys(n).length&&t.forEach((e=>{Object.keys(n).includes(e.matchUpId)&&(e.schedule.scheduleConflict=n[e.matchUpId])})),{scheduleConflictMatchUpIds:n}}function id({matchUp:e,drawDefinition:t,inContextDrawMatchUps:n}){const{matchUpId:r,matchUpStatus:i,structureId:a}=e||{};if(!e||!a||(null==e?void 0:e.matchUpStatus)===R)return{matchUp:e};if(i===w){let i;if(e.winnerMatchUpId)i=n.find((({matchUpId:t})=>t===e.winnerMatchUpId));else{const e=nd({matchUpId:r,drawDefinition:t,inContextDrawMatchUps:n});({winnerMatchUp:i}=(null==e?void 0:e.targetMatchUps)||{})}return id({matchUp:i,drawDefinition:t,inContextDrawMatchUps:n})}return{matchUp:void 0}}function ad({upcomingMatchUp:e}={}){if(e)return(({matchUpId:e,structureId:t,schedule:n,roundNumber:r,roundPosition:i,structureName:a})=>({matchUpId:e,structureId:t,schedule:n,roundNumber:r,roundPosition:i,structureName:a}))(e)}function od({requireParticipants:e=!0,scheduleVisibilityFilters:t,tournamentAppliedPolicies:n,tournamentParticipants:r,policyDefinitions:i,drawDefinition:a,matchUpFilters:o,contextFilters:s,contextProfile:c,scheduleTiming:u,matchUpsMap:d,roundFilter:l,structureId:p,inContext:f,structure:m,context:h,event:v}){!m&&p&&({structure:m}=_c({drawDefinition:a,structureId:p}));const{matchUps:g,error:I}=Ou({tournamentAppliedPolicies:n,scheduleVisibilityFilters:t,tournamentParticipants:r,policyDefinitions:i,drawDefinition:a,matchUpFilters:o,contextFilters:s,contextProfile:c,scheduleTiming:u,matchUpsMap:d,structure:m,inContext:f,context:h,event:v});if(I)return{error:I};const{assignedPositions:b}=Au({structure:m}),w=b.filter((e=>e.participantId)).map((e=>e.drawPosition)),U=[],S=[],D=[],N=[],P=[];return g.filter((e=>{var t;const n=1===(null==o||null===(t=o.matchUpTypes)||void 0===t?void 0:t.length)&&o.matchUpTypes[0]===la;return e.matchUpType===la||!n})).forEach((t=>{var n,r,i;if(t.matchUpStatus===y)return void N.push(t);const a=t.collectionId,o=a&&t.sides.every((e=>e.participantId)),s=t.roundNumber===l,c=!a&&2===(null===(n=t.drawPositions)||void 0===n?void 0:n.filter(Boolean).length),u=!a&&(null===(r=t.drawPositions)||void 0===r?void 0:r.every((e=>w.includes(e)))),d=b.filter((e=>e.bye)).map((e=>e.drawPosition)),p=!a&&(null===(i=t.drawPositions)||void 0===i?void 0:i.find((e=>d.includes(e)))),f=B.includes(t.matchUpStatus)&&(o||c&&(!l||s)&&(!e||u));return p?U.push(t):Yr(t)?P.push(t):f?D.push(t):S.push(t)})),{completedMatchUps:P,upcomingMatchUps:D,pendingMatchUps:S,abandonedMatchUps:N,byeMatchUps:U,structure:m}}function sd(e){if(!e.drawDefinition)return{error:Ie};Object.assign(e,{requireParticipants:!1});const{abandonedMatchUps:t,completedMatchUps:n,upcomingMatchUps:r,pendingMatchUps:i,byeMatchUps:a,matchUpsMap:o}=cd(e);return{matchUps:[].concat(...t,...n,...r,...i,...a),matchUpsMap:o}}function cd({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,tournamentParticipants:n,requireParticipants:r,includeByeMatchUps:i,policyDefinitions:a,tournamentRecord:o,drawDefinition:s,matchUpFilters:c,contextFilters:u,contextProfile:d,scheduleTiming:l,nextMatchUps:p,roundFilter:f,matchUpsMap:m,inContext:h,context:v,event:g}){var I,y;if(!s)return{error:Ie};let b=[],w=[],U=[],S=[],D=[];n=(null===(I=n)||void 0===I?void 0:I.length)&&n||(null==o?void 0:o.participants),h&&null!==(y=n)&&void 0!==y&&y.length&&(n=Qu({participants:n}));const{structures:N}=Bc({drawDefinition:s});m||(m=kc({drawDefinition:s})),N.forEach((o=>{const{byeMatchUps:I=[],pendingMatchUps:y,upcomingMatchUps:N,completedMatchUps:P,abandonedMatchUps:A}=od({inContext:h||p,tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:n,requireParticipants:r,includeByeMatchUps:i,policyDefinitions:a,drawDefinition:s,matchUpFilters:c,contextFilters:u,contextProfile:d,scheduleTiming:l,matchUpsMap:m,roundFilter:f,structure:o,context:v,event:g});b=b.concat(...A),w=w.concat(...P),U=U.concat(...N),S=S.concat(...y),D=D.concat(...I)}));const P={matchUpsMap:m,byeMatchUps:D,pendingMatchUps:S,upcomingMatchUps:U,abandonedMatchUps:b,completedMatchUps:w,...de};if(p){const e="object"==typeof p&&p||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:t,completed:n,upcoming:r,pending:i,bye:a}=e,o=[].concat(...t&&P.abandonedMatchUps||[],...n&&P.completedMatchUps||[],...r&&P.upcomingMatchUps||[],...i&&P.pendingMatchUps||[],...a&&P.byeMatchUps||[]);rd({drawDefinition:s,inContextDrawMatchUps:o})}return P}function ud({scheduleVisibilityFilters:e,policyDefinitions:t,tournamentRecord:n,inContext:r=!0,contextProfile:i,matchUpFilters:a,contextFilters:o,nextMatchUps:s,context:c}){var u;if(!n)return{error:me};const d=(null===(u=n.unifiedTournamentId)||void 0===u?void 0:u.tournamentId)||n.tournamentId,l=(null==n?void 0:n.events)||[],p=md({tournamentRecord:n}),{appliedPolicies:f}=Qi({tournamentRecord:n}),m={...c,tournamentId:d,indoorOutDoor:n.indoorOutDoor,surfaceCategory:n.surfaceCategory,endDate:n.endDate};return{matchUps:l.map((c=>ld({scheduleVisibilityFilters:e,tournamentAppliedPolicies:f,context:m,policyDefinitions:t,tournamentRecord:n,matchUpFilters:a,contextFilters:o,contextProfile:i,nextMatchUps:s,participants:p,inContext:r,event:c}).matchUps)).flat(1/0)}}function dd({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,tournamentRecord:n,policyDefinitions:r,matchUpFilters:i,contextFilters:a,drawDefinition:o,contextProfile:s,participants:c,nextMatchUps:u,inContext:d,context:l,event:p}){const{eventId:f,eventName:m,category:h,gender:v,matchUpFormat:g}=p||{};return sd({context:{...l,eventId:f,eventName:m,category:h,gender:v,matchUpFormat:g,indoorOutDoor:(null==p?void 0:p.indoorOutDoor)||(null==n?void 0:n.indoorOutDoor),surfaceCategory:(null==p?void 0:p.surfaceCategory)||(null==n?void 0:n.surfaceCategory),endDate:null==p?void 0:p.endDate},tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:c||n&&md({tournamentRecord:n})||[],tournamentRecord:n,policyDefinitions:r,drawDefinition:o,matchUpFilters:i,contextFilters:a,contextProfile:s,nextMatchUps:u,inContext:d,event:p})}function ld({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,policyDefinitions:n,tournamentRecord:r,participants:i=[],matchUpFilters:a,contextFilters:o,contextProfile:s,nextMatchUps:c,inContext:u,context:d,event:l}){if(!l)return{error:ze};const{eventId:p,eventName:f,endDate:m,category:h,gender:v,matchUpFormat:g}=l,I={...d,...Vr({indoorOutDoor:l.indoorOutDoor||(null==r?void 0:r.indoorOutDoor),surfaceCategory:l.surfaceCategory||(null==r?void 0:r.surfaceCategory),endDate:l.endDate||(null==r?void 0:r.endDate),tournamentId:null==r?void 0:r.tournamentId,matchUpFormat:g,eventName:f,category:h,gender:v,eventId:p})};m&&(I.endDate=m),i=i||r&&md({tournamentRecord:r});const y=l.drawDefinitions||[],b=ca({tournamentRecord:r,event:l}).scheduleTiming;return{matchUps:y.map((d=>{const{matchUps:p}=sd({tournamentParticipants:i,tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,context:I,policyDefinitions:n,tournamentRecord:r,drawDefinition:d,matchUpFilters:a,contextFilters:o,contextProfile:s,scheduleTiming:b,nextMatchUps:c,inContext:u,event:l});return p})).flat(1/0)}}function pd({scheduleVisibilityFilters:e,policyDefinitions:t,tournamentRecord:n,inContext:r=!0,matchUpFilters:i,contextFilters:a,contextProfile:o,nextMatchUps:s,context:c}){var u;if(!n)return{error:me};const d=(null===(u=n.unifiedTournamentId)||void 0===u?void 0:u.tournamentId)||n.tournamentId,l=n&&n.events||[],p=md({tournamentRecord:n}),{appliedPolicies:f}=Qi({tournamentRecord:n}),m=a&&a.eventIds||[];return l.filter((e=>!m.includes(e.eventId))).map((u=>fd({tournamentAppliedPolicies:f,scheduleVisibilityFilters:e,policyDefinitions:t,tournamentRecord:n,matchUpFilters:i,contextFilters:a,contextProfile:o,participants:p,tournamentId:d,nextMatchUps:s,inContext:r,context:c,event:u}))).reduce(((e,t)=>{const n=t&&Object.keys(t).filter((e=>!["success","matchUpsMap"].includes(e)));return null==n||n.forEach((n=>{e[n]||(e[n]=[]),e[n]=e[n].concat(t[n]),e.matchUpsCount+=t[n].length})),e}),{matchUpsCount:0})}function fd({tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,policyDefinitions:n,tournamentRecord:r,matchUpFilters:i,contextFilters:a,contextProfile:o,nextMatchUps:s,participants:c,tournamentId:u,inContext:d,context:l,event:p}){if(!p)return{error:ze};const{eventId:f,eventName:m,endDate:h}=p,v={...l,...Vr({eventId:f,eventName:m,endDate:h||(null==r?void 0:r.endDate),tournamentId:u||(null==r?void 0:r.tournamentId),indoorOutDoor:p.indoorOutDoor||(null==r?void 0:r.indoorOutDoor),surfaceCategory:p.surfaceCategory||(null==r?void 0:r.surfaceCategory)})},g=c||r&&md({tournamentRecord:r});return(p.drawDefinitions||[]).reduce(((c,u)=>{const l=cd({context:v,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:g,policyDefinitions:n,tournamentRecord:r,drawDefinition:u,matchUpFilters:i,contextFilters:a,contextProfile:o,nextMatchUps:s,inContext:d,event:p}),f=Object.keys(l);return null==f||f.forEach((e=>{c[e]||(c[e]=[]),c[e]=c[e].concat(l[e])})),c}),{})}function md({tournamentRecord:e}){return e&&e.participants||[]}function hd({tournamentRecord:e,contextProfile:t,nextMatchUps:n,matchUpId:r,inContext:i}){if(!e)return{error:me};if("string"!=typeof r)return{error:lt};const{matchUps:a}=ud({tournamentRecord:e}),o=a.find((e=>e.matchUpId===r));if(!o)return{error:ft};const{eventId:s,drawId:c}=o,{event:u,drawDefinition:d}=ya({tournamentRecord:e,eventId:s,drawId:c}),l={surfaceCategory:u.surfaceCategory||e.surfaceCategory,indoorOutDoor:u.indoorOutDoor||e.indoorOutDoor,endDate:u.endDate||e.endDate,tournamentId:e.tournamentId,eventId:s,drawId:c},p=e.participants||[],{matchUp:f,structure:m}=xu({context:i&&l,tournamentParticipants:p,drawDefinition:d,contextProfile:t,nextMatchUps:n,matchUpId:r,inContext:i,event:u});return{matchUp:f,structure:m,drawDefinition:d}}function vd({tournamentRecord:e,matchUpIds:t,schedule:n}){if(!e)return{error:me};if(!t||!Array.isArray(t))return{error:pt};if(!n||"object"!=typeof n)return{error:Cn};const{matchUps:r}=ud({tournamentRecord:e}),i=r.reduce(((e,t)=>{const{matchUpId:n,drawId:r}=t;return e[r]?e[r].push(n):e[r]=[n],e}),{});for(const a of Object.keys(i)){const{drawDefinition:r}=ba({tournamentRecord:e,drawId:a}),o=i[a].filter((e=>t.includes(e)));for(const t of o){const i=Hu({tournamentRecord:e,drawDefinition:r,matchUpId:t,schedule:n});if(i.error)return i}}return{...de}}function gd({tournamentRecords:e}){if(!e)return{error:fe};return Object.keys(e).reduce(((t,n)=>{t.tournamentIdMap[n]=[];const r=e[n].events||[],i=r.map((({eventId:e})=>e)),a=r.map((e=>(e.drawDefinitions||[]).map((({drawId:e})=>e)))).flat();return t.tournamentIdMap[n].push(...i,...a),t.eventIds.push(...i),t.drawIds.push(...a),t}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Id({drawId:e,eventId:t,tournamentRecords:n}){const{tournamentIdMap:r}=gd({tournamentRecords:n});return Object.keys(r).find((n=>r[n].includes(t)||r[n].includes(e)))}function yd({drawPosition:e,matchUps:t=[]}){return{initialRoundNumber:t.filter((({drawPositions:t})=>e&&(null==t?void 0:t.includes(e)))).map((({roundNumber:e})=>parseInt(e))).sort(Hr)[0]}}function bd({inContextDrawMatchUps:e,positionAssignments:t,targetDrawPosition:n,drawDefinition:r,dualMatchUp:i,matchUp:a}){if(i){var o,s,c;const t=null===(o=e.find((({matchUpId:e})=>a.matchUpId===e)).sides)||void 0===o||null===(s=o.find((e=>e.drawPosition===n)))||void 0===s?void 0:s.sideNumber,r=null===(c=a.sides)||void 0===c?void 0:c.find((e=>e.sideNumber===t));r&&delete r.lineUp}a.drawPositions=(a.drawPositions||[]).map((e=>e===n?void 0:e));const u=t.filter((({drawPosition:e})=>a.drawPositions.includes(e))).filter((e=>e.bye)).length;return a.matchUpStatus=u?w:a.matchUpStatus===O?O:R,a.matchUpStatus===O&&(a.winningSide=void 0),Sc({drawDefinition:r,matchUp:a}),{...de}}function wd({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:n}){return e||({matchUps:e,matchUpsMap:n}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:n})),(e||[]).filter((({collectionId:e})=>!e)).forEach((r=>{const{matchUpId:i,structureId:a}=r,o=nd({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:i}),{winnerMatchUp:s,loserMatchUp:c}=o.targetMatchUps,u=null==s?void 0:s.matchUpId,d=null==c?void 0:c.matchUpId,l=Fc({matchUpsMap:n,structureId:a}).find((e=>e.matchUpId===i));l&&(u&&(Object.assign(l,{winnerMatchUpId:u}),Object.assign(r,{winnerMatchUpId:u})),d&&(Object.assign(l,{loserMatchUpId:d}),Object.assign(r,{loserMatchUpId:d})))})),{inContextDrawMatchUps:e}}function Ud(e){var t;const{sides:n,matchUpType:r}=e||{},i=null!==(t=e.potentialParticipants)&&void 0!==t&&t.length?e.potentialParticipants.flat().map((e=>r===da?(null==e?void 0:e.individualParticipantIds)||[]:e.participantId)).flat():[],a=(n||[]).map((e=>{var t;return r===da?(null==e||null===(t=e.participant)||void 0===t?void 0:t.individualParticipantIds)||[]:null!=e&&e.participantId?[e.participantId]:[]})).flat();return{individualParticipantIds:a.concat(i).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:i}}function Sd({tournamentRecords:e,schedulingProfile:t}){if(!t)return{valid:!0};if(!Array.isArray(t))return{valid:!1,error:jn};const{venueIds:n,tournamentsMap:r}=function({tournamentRecords:e={}}={}){const t=e&&Object.values(e)||[],n={},{venueIds:r,eventIds:i,drawIds:a,structureIds:o,tournamentIds:s}=t.reduce(((e,t)=>{const{venueIds:r,eventIds:i,drawIds:a,structureIds:o,tournamentIds:s,tournamentMap:c}=Dd({tournamentRecord:t});return r.forEach((t=>{e.venueIds.includes(t)||e.venueIds.push(t)})),e.tournamentIds.push(...s),e.structureIds.push(...o),e.eventIds.push(...i),e.drawIds.push(...a),Object.assign(n,c),e}),{venueIds:[],eventIds:[],drawIds:[],structureIds:[],tournamentIds:[]});return{venueIds:r,eventIds:i,drawIds:a,structureIds:o,tournamentIds:s,tournamentsMap:n}}({tournamentRecords:e});let i,a;const o=t.every((e=>{const{scheduleDate:t,venues:o}=e;if(!yr(t))return!1;return o.every((e=>{const{venueId:t,rounds:o}=e;if("string"!=typeof t)return a="venueId should be a string",!1;if(!Array.isArray(o))return a="rounds should be an array",!1;if(!n.includes(t))return i=wn,!1;return!!o.every((e=>{if(!e)return a="empty round",!1;const{tournamentId:t,eventId:n,drawId:i,structureId:o,roundNumber:s,roundSegment:c}=e,u=r[t]&&r[t][n]&&r[t][n][i]&&r[t][n][i][o],d=null==u?void 0:u.includes(s);d||(a="Invalid rounds");const{segmentNumber:l,segmentsCount:p}=c||{},f=!c||$(l)&&H(p)&&l<=p;return f||(a="Invalid segment"),d&&f}))}))}));return o||i||(i=jn),{valid:!!o,error:i,message:a}}function Dd({tournamentRecord:e={},tournamentMap:t={},requireCourts:n}={}){const r=[],i=[],a=[],o=[],s=((null==e?void 0:e.venues)||[]).map((({venueId:e,courts:t})=>(!n||(null==t?void 0:t.length))&&e)),c=null==e?void 0:e.tournamentId;if(c){o.push(c),t[c]={};((null==e?void 0:e.events)||[]).forEach((e=>{const n=e.eventId;i.push(n),t[c][n]={},(e.drawDefinitions||[]).forEach((e=>{const i=e.drawId;r.push(i),t[c][n][i]={};const{structures:o}=Bc({drawDefinition:e});(o||[]).forEach((e=>{const r=e.structureId;a.push(r);const{matchUps:o}=Ou({structure:e}),{roundMatchUps:s}=Lc({matchUps:o}),u=s&&Object.keys(s).map((e=>parseInt(e)));t[c][n][i][r]=u}))}))}))}return{tournamentIds:o,venueIds:s,eventIds:i,drawIds:r,structureIds:a,tournamentMap:t}}function Nd({tournamentRecord:e}){if(!e)return{error:me};const t=(({tournamentId:e,tournamentRank:t,formalName:n,tournamentName:r,promotionalName:i,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l})=>({tournamentId:e,tournamentRank:t,formalName:n,tournamentName:r,promotionalName:i,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l}))(e);return{...de,tournamentInfo:Gr(t)}}function Pd({tournamentRecords:e}){const t=Object.keys(e).reduce(((t,n)=>{const r=e[n],{tournamentInfo:{startDate:i,endDate:a}}=Nd({tournamentRecord:r}),o=i&&new Date(Cr(i));(!t.startDate||o&&o<t.startDate)&&(t.startDate=o);const s=a&&new Date(Cr(a));return(!t.endDate||s&&s>t.endDate)&&(t.endDate=s),t}),{startDate:void 0,endDate:void 0}),n=t.startDate&&Cr(t.startDate.toISOString()),r=t.endDate&&Cr(t.endDate.toISOString());return n&&r?{startDate:n,endDate:r}:{error:Tt}}function Ad({tournamentRecords:e,venueIds:t=[]}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const n=[],r=[],i=[],a=[];return Object.keys(e).forEach((o=>{var s;null===(s=e[o].venues)||void 0===s||s.filter((({venueId:e})=>!t.length||t.includes(e))).forEach((e=>{var t;i.includes(e.venueId)||(n.push(Gr(e)),i.push(e.venueId)),null===(t=e.courts)||void 0===t||t.forEach((t=>{if(!a.includes(t.courtId)){const n={...Gr(t,!1,!0),venueId:e.venueId};r.push(n),a.push(t.courtId)}}))}))})),{courts:r,venues:n}}function Md({tournamentRecords:e,requireCourts:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};return Object.keys(e).reduce(((n,r)=>{const i=e[r],{venues:a}=ku({tournamentRecord:i});return a.forEach((e=>{const{venueId:r,courts:i}=e;(!t||(null==i?void 0:i.length))&&!n.venueIds.includes(r)&&(n.venues.push(e),n.venueIds.push(r))})),n}),{venues:[],venueIds:[]})}function Td({tournamentRecords:e,extension:t}){if(!Gc(t))return{error:jn};for(const n of Object.values(e)){const e=Hc({tournamentRecord:n,extension:t});if(e.error)return e}return{...de}}function Ed({tournamentRecords:e,name:t}){if(!t)return{error:Mt,message:"Missing name"};let n;return Object.keys(e).find((r=>{const i=e[r],{extension:a}=aa({tournamentRecord:i,name:t});return n=a,!!a}))?{extension:n}:{error:qn}}function Cd({tournamentRecords:e,name:t}){if(!t)return{error:Mt,message:"Missing name"};let n=0;for(const r of Object.keys(e)){const i=Kc({tournamentRecord:e[r],name:t});if(i.error)return i;i.message!==qn&&n++}return{...de,removed:n}}function Rd({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const{extension:t}=Ed({tournamentRecords:e,name:Yi});let n=(null==t?void 0:t.value)||[];if(n.length){const{venueIds:t}=Md({tournamentRecords:e,requireCourts:!0}),{eventIds:r,drawIds:i}=gd({tournamentRecords:e}),{updatedSchedulingProfile:a,modifications:o,issues:s}=Ld({schedulingProfile:n,venueIds:t,eventIds:r,drawIds:i});if(o){n=a;const t=Od({tournamentRecords:e,schedulingProfile:n});return t.error?t:{schedulingProfile:n,modifications:o,issues:s}}}return{schedulingProfile:n,modifications:0}}function Od({tournamentRecords:e,schedulingProfile:t}){const n=Sd({tournamentRecords:e,schedulingProfile:t});if(n.error)return n;if(!t)return Cd({tournamentRecords:e,name:Yi});return Td({tournamentRecords:e,extension:{name:Yi,value:t}})}function xd({tournamentRecords:e,scheduleDate:t,venueId:n,round:r}){if(!yr(t))return{error:xt};const{extension:i}=Ed({tournamentRecords:e,name:Yi}),a=(null==i?void 0:i.value)||[];let o=a.find((e=>_r(t,e.scheduleDate)));if(!o){const{startDate:n,endDate:r}=Pd({tournamentRecords:e}),i=new Date(t);if(i<new Date(n)||i>new Date(r))return{error:xt};o={scheduleDate:t,venues:[]},a.push(o)}let s=o.venues.find((e=>e.venueId===n));s||(s={venueId:n,rounds:[]},o.venues.push(s));const c=["notBeforeTime"],u=e=>Object.keys(e).filter((e=>!c.includes(e))).sort().map((t=>e[t])).join("|");if(s.rounds.find((e=>u(e)===u(r))))return{error:Be};s.rounds.push(r);const d=Od({tournamentRecords:e,schedulingProfile:a});return d.error?d:de}function Ld({schedulingProfile:e,venueIds:t,eventIds:n,drawIds:r}){const i=[];return{updatedSchedulingProfile:null==e?void 0:e.map((e=>{const a=Cr(null==e?void 0:e.scheduleDate);if(!a)return void i.push(`Invalid date: ${null==e?void 0:e.scheduledDate}`);const o=((null==e?void 0:e.venues)||[]).map((e=>{const{rounds:a,venueId:o}=e;if(!t.includes(o))return void i.push(`Missing venueId: ${o}`);const s=a.filter((e=>{const t=n.includes(e.eventId)&&r.includes(e.drawId);return t||i.push(`Invalid eventId: ${e.eventId} or drawId: ${e.drawId}`),t}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...e,venues:o}})).filter(Boolean),modifications:i.length,issues:i}}function kd({tournamentRecords:e}){const{schedulingProfile:t}=Rd({tournamentRecords:e,requireCourts:!0});if(t){const{venueIds:n}=Md({tournamentRecords:e}),{eventIds:r,drawIds:i}=gd({tournamentRecords:e}),{updatedSchedulingProfile:a,modifications:o}=Ld({schedulingProfile:t,venueIds:n,eventIds:r,drawIds:i});if(o)return Od({tournamentRecords:e,schedulingProfile:a})}return de}function Fd({matchUps:e=[],schedulingProfile:t}){const n={},r=({eventId:e,drawId:t,structureId:n,roundNumber:r})=>`${e}|${t}|${n}${r}`;if(null!=t&&t.length){t.map((({venues:e})=>e.map((({rounds:e})=>e)))).flat().forEach((e=>{e.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))).forEach((({eventId:e,drawId:t,structureId:i,roundNumber:a},o)=>{const s=r({eventId:e,drawId:t,structureId:i,roundNumber:a});n[s]=o}))}))}const i=[],a={noScheduledDate:[]};for(const s of e){const e=s.schedule||{},t=e.scheduledDate&&Cr(e.scheduledDate)||e.scheduledTime&&Cr(e.scheduledTime)||"noScheduledDate";a[t]||(a[t]=[]),a[t].push(s)}const o=Object.keys(a).sort();for(const s of o){const e=a[s],t={noScheduledTime:[]};for(const n of e){const e=n.schedule||{},r=e.scheduledTime&&Er(e.scheduledTime)||"noScheduledTime";t[r]||(t[r]=[]),t[r].push(n)}const o=Object.keys(t).sort();for(const a of o){const e=t[a];e.sort(((e,t)=>(n[r(e)]||0)-(n[r(t)]||0))),i.push(...e)}}return i}function jd({scheduleVisibilityFilters:e,tournamentRecords:t,matchUpFilters:n,contextFilters:r,nextMatchUps:i}){if("object"!=typeof t||!Object.keys(t).length)return{error:fe};return{matchUps:Object.keys(t).map((a=>{const o=t[a],{matchUps:s}=ud({scheduleVisibilityFilters:e,tournamentRecord:o,matchUpFilters:n,contextFilters:r,nextMatchUps:i});return s})).flat()}}function _d(e){if("object"!=typeof(null==e?void 0:e.tournamentRecords)||!Object.keys(null==e?void 0:e.tournamentRecords).length)return{error:fe};const{courts:t,venues:n}=Ad(e),{sortCourtsData:r,sortDateMatchUps:i=!0}=e,a=Rd(e).schedulingProfile,{completedMatchUps:o,upcomingMatchUps:s,pendingMatchUps:c}=Bd(e),u=[...s||[],...c||[]],d=i?Fd({matchUps:u,schedulingProfile:a}):u;return{courtsData:t.map((e=>{const t=function({courtId:e}){const t=d.filter((t=>{var n;return(null===(n=t.schedule)||void 0===n?void 0:n.courtId)===e}));return r?Fd({matchUps:t,schedulingProfile:a}):t}(e);return{...e,matchUps:t,surfaceCategory:(null==e?void 0:e.surfaceCategory)||""}})),completedMatchUps:o,dateMatchUps:d,venues:n}}function Bd({scheduleVisibilityFilters:e,tournamentRecords:t,matchUpFilters:n,contextFilters:r}){if("object"!=typeof t||!Object.keys(t).length)return{error:fe};return Object.keys(t).map((i=>{const a=t[i];return pd({scheduleVisibilityFilters:e,tournamentRecord:a,matchUpFilters:n,contextFilters:r})})).reduce(((e,t)=>(Object.keys(t).forEach((n=>{e[n]||(e[n]=[]),e[n]=e[n].concat(t[n])})),e)),{})}function Gd(e,t){return function(e,t){return(Go[null==e?void 0:e.stage]||0)-(Go[null==t?void 0:t.stage]||0)}(e,t)||((null==e?void 0:e.stageSequence)||0)-((null==t?void 0:t.stageSequence)||0)||(null==e?void 0:e.roundNumber)-(null==t?void 0:t.roundNumber)||((null==e?void 0:e.roundPosition)||0)-((null==t?void 0:t.roundPosition)||0)}function Vd({includeParticipantDependencies:e,tournamentRecords:t={},drawDefinition:n,matchUps:r=[],drawIds:i=[]}){if(!Array.isArray(r))return{error:mt};if(!Array.isArray(i))return{error:Re};const a={},o=e=>{a[e]||(a[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[]})},s=(t,n)=>{a[t].matchUpIds.forEach((e=>a[n].matchUpIds.push(e))),a[n].matchUpIds.push(t),a[t].dependentMatchUpIds.push(n),e&&a[t].participantIds.forEach((e=>a[n].participantIds.push(e)))},c=t=>{for(const n of t){const{matchUpId:t,winnerMatchUpId:r,loserMatchUpId:i}=n;if(o(t),e){const{individualParticipantIds:e}=Ud(n);a[t].participantIds=e}r&&(o(r),s(t,r)),i&&(o(i),s(t,i))}};if(n)wd({drawDefinition:n}),r.length||({matchUps:r}=dd({drawDefinition:n})),c(r);else{r.length||({matchUps:r}=jd({tournamentRecords:t,nextMatchUps:!0})),i.length||(i=t?Object.values(t).map((({events:e=[]})=>e.map((({drawDefinitions:e=[]})=>e.map((({drawId:e})=>e)))))).flat(1/0):[]);for(const e of i){let n=r.filter((t=>t.drawId===e)).sort(Gd);if(!!!n.find((({winnerMatchUpId:e,loserMatchUpId:t})=>e||t))){if(!n.find((({roundPosition:e})=>e))){const r=n.find((({tournamentId:e})=>e)),{drawDefinition:i}=ya({tournamentRecord:t[r.tournamentId],drawId:e});wd({drawDefinition:i})}}c(n)}}return{matchUpDependencies:a,...de}}function qd({matchUpStatus:e}){return k.includes(e)}function Hd({matchUpStatus:e}){return F.includes(e)}function Wd({score:e,winningSide:t,matchUpStatus:n}){return(null==e?void 0:e.scoreStringSide1)||t||function({matchUpStatus:e}){return _.includes(e)}({matchUpStatus:n})}function zd({drawDefinition:e,structureId:t}){const{structure:n,error:r}=_c({drawDefinition:e,structureId:t});if(r)return{error:r};const{matchUps:i}=Ou({inContext:!0,drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},structure:n}),a=Q([].concat(...i.map((e=>e.drawPositions||[]))).filter(Boolean)).sort(Hr),{matchUpDependencies:o}=Vd({drawIds:[e.drawId],drawDefinition:e,matchUps:i}),s=Q(i.filter(Wd).map((e=>{var t;return[].concat(...(null===(t=o[e.matchUpId])||void 0===t?void 0:t.matchUpIds)||[],e.matchUpId)})).flat()),c=Q(i.map((({matchUpId:e,drawPositions:t})=>s.includes(e)?t:[])).flat().filter(Boolean)).sort(Hr),{positionAssignments:u}=Pu({drawDefinition:e,structure:n}),d=u.filter((e=>e.bye)).map((e=>e.drawPosition)),l=a.filter((e=>!c.includes(e)));return{allDrawPositions:a,inactiveDrawPositions:l,positionAssignments:u,activeDrawPositions:c,byeDrawPositions:d,structure:n}}function Kd({positionAssignments:e,drawDefinition:t,matchUpsMap:n,structure:r,event:i}){const{matchUps:a}=Ou({drawDefinition:t,matchUpsMap:n,structure:r,event:i});a.forEach((n=>{const r=e.filter((({drawPosition:e})=>{var t;return null===(t=n.drawPositions)||void 0===t?void 0:t.includes(e)})).filter((e=>e.bye)).length;if(!n.winningSide){const e=r?w:R;Object.assign(n,{matchUpStatus:e}),Sc({drawDefinition:t,matchUp:n})}}))}function Yd({inContextDrawMatchUps:e,drawDefinition:t,drawPosition:n,matchUpsMap:r,structureId:i,event:a}){const{structure:o}=_c({drawDefinition:t,structureId:i}),{positionAssignments:s}=Au({drawDefinition:t,structure:o}),c=s.some((e=>{if(e.drawPosition===n)return delete e.participantId,delete e.qualifier,delete e.bye,!0}));if(o.structureType===Wo)return Kd({positionAssignments:s,drawDefinition:t,structure:o,matchUpsMap:r}),{drawPositionCleared:c};const{matchUps:u}=Ou({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:o,event:a}),{roundProfile:d,roundMatchUps:l}=Lc({matchUps:u}),p=Object.keys(d).map((e=>parseInt(e)));let f=n;const m=p.map((e=>{const t=d[e].pairedDrawPositions.find((e=>e.includes(f))),n=null==t?void 0:t.find((e=>e!==f)),r=s.find((e=>e.drawPosition===n)),i=d[e+1],a=null==r?void 0:r.bye,o=i&&i.pairedDrawPositions.find((e=>e.includes(n))),c=a&&o&&i&&i.drawPositions.includes(n),u=t&&{roundNumber:e,relevantPair:t,pairedDrawPosition:n,pairedDrawPositionByeAdvancedPair:!c&&o,targetDrawPosition:f};return c&&(f=n),u})).filter((e=>null==e?void 0:e.targetDrawPosition)).reduce(((e,t)=>{const{roundNumber:n,relevantPair:r,targetDrawPosition:i,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=t,s=[{roundNumber:n,targetDrawPosition:i,relevantPair:r},o&&{roundNumber:n+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat(...s)}),[]);return m.forEach((({roundNumber:a,targetDrawPosition:c,relevantPair:u})=>{const d=l[a].find((e=>se(e.drawPositions.filter(Boolean),u.filter(Boolean))));d&&(!function({drawDefinition:e,structureId:t,roundNumber:n,targetDrawPosition:r,matchUpsMap:i,inContextDrawMatchUps:a}){var o;const{structure:s}=_c({drawDefinition:e,structureId:t});if(s.structureType===Wo)return;i=i||kc({drawDefinition:e});const c=((null===(o=i)||void 0===o?void 0:o.mappedMatchUps)||{})[t].matchUps,{initialRoundNumber:u}=yd({drawPosition:r,matchUps:c}),d=null==c?void 0:c.filter((e=>e.roundNumber>=n&&e.roundNumber!==u&&e.drawPositions.includes(r))),{positionAssignments:l}=Pu({drawDefinition:e,structureId:t});null==d||d.forEach((t=>$d({targetMatchUp:t,drawPosition:r,positionAssignments:l,drawDefinition:e,structure:s,matchUpsMap:i,inContextDrawMatchUps:a})))}({drawDefinition:t,structureId:i,roundNumber:a,targetDrawPosition:c,matchUpsMap:r,inContextDrawMatchUps:e}),$d({drawDefinition:t,structure:o,positionAssignments:s,targetMatchUp:d,drawPosition:n,matchUpsMap:r,inContextDrawMatchUps:e}))})),{tasks:m,drawPositionCleared:c}}function $d({positionAssignments:e,targetMatchUp:t,drawPosition:n,drawDefinition:r,structure:i,inContextDrawMatchUps:a,matchUpsMap:o}){const s=(o=o||kc({drawDefinition:r})).mappedMatchUps[i.structureId].matchUps,{initialRoundNumber:c}=yd({drawPosition:n,matchUps:s});t.roundNumber>c&&(t.drawPositions=(t.drawPositions||[]).map((e=>e===n?void 0:e)));const u=nd({matchUpId:t.matchUpId,structure:i,drawDefinition:r,inContextDrawMatchUps:a}),{targetLinks:{winnerTargetLink:d},targetMatchUps:{loserMatchUp:l,winnerMatchUp:p,loserMatchUpDrawPositionIndex:f,winnerMatchUpDrawPositionIndex:m}}=u,h=e.filter((({drawPosition:e})=>t.drawPositions.includes(e))).filter((e=>e.bye)).length;if(t.matchUpStatus=h?w:t.matchUpStatus===O?O:R,t.matchUpStatus===O&&(t.winningSide=void 0),Sc({drawDefinition:r,matchUp:t}),l&&l.structureId!==u.matchUp.structureId&&!h){const{drawPositions:e,roundNumber:t}=l;if(1===t){const t=e[f];Yd({drawDefinition:r,structureId:l.structureId,drawPosition:t,matchUpsMap:o,inContextDrawMatchUps:a})}else{var v;const n=Math.min(...e.filter(Boolean)),i=((null===(v=o)||void 0===v?void 0:v.mappedMatchUps)||{})[l.structureId].matchUps,{initialRoundNumber:s}=yd({drawPosition:n,matchUps:i});s===t&&Yd({drawDefinition:r,structureId:l.structureId,drawPosition:n,matchUpsMap:o,inContextDrawMatchUps:a})}}p&&p.structureId!==u.matchUp.structureId&&console.log("linked structure winnerMatchUp removal",{winnerTargetLink:d,winnerMatchUpDrawPositionIndex:m})}function Jd({drawDefinition:e,drawPosition:t,participantId:n,structureId:r,matchUpsMap:i,inContextDrawMatchUps:a}){const{structure:o}=_c({drawDefinition:e,structureId:r}),{positionAssignments:s}=Au({drawDefinition:e,structure:o}),c=s.find((e=>n&&e.participantId===n||t&&e.drawPosition===t));if(n&&!t&&(t=null==c?void 0:c.drawPosition),!t)return{error:Te};n||(n=null==c?void 0:c.participantId);const{activeDrawPositions:u}=zd({drawDefinition:e,structureId:r});if(u.includes(t))return{error:Ae};a||({matchUps:a}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:i}));const{drawPositionCleared:d,error:l}=Yd({drawDefinition:e,structureId:r,drawPosition:t,matchUpsMap:i,inContextDrawMatchUps:a});return l?{error:l}:d?(Nc({drawDefinition:e,structureIds:[r]}),{...de,participantId:n}):{error:De}}function Zd({element:e,notes:t}={}){return"object"!=typeof e?{error:jn}:t?"string"==typeof t||null!=t&&t.testing?(Object.assign(e,{notes:t}),de):{error:jn}:{error:Mt}}function Qd({tournamentRecord:e,drawDefinition:t,policyTypes:n=[],event:r}){if(!Array.isArray(n))return{error:gt};const i={},a=e=>{for(const t of n){const n=e[t];n&&!i[t]&&(i[t]=n)}};if(t){const{appliedPolicies:e}=xc({drawDefinition:t})||{};a(e)}if(r){const{appliedPolicies:e}=Xi({event:r})||{};a(e)}if(e){const{appliedPolicies:t}=Qi({tournamentRecord:e})||{};a(t)}return Object.keys(i).length?{policyDefinitions:i}:{error:Dt}}const Xd=e=>null==e?void 0:e.participantId;function el({positionAssignments:e,tournamentRecord:t,drawDefinition:n,matchUpFormat:r,matchUps:i,event:a}){if(!Array.isArray(i))return{error:jn};if(!e)return{error:jn};const{policyDefinitions:o}=Qd({tournamentRecord:t,drawDefinition:n,event:a,policyTypes:[ei]}),{subOrderMap:s}=function({positionAssignments:e}){const t=(e||[]).filter(Xd).map((e=>{const{extension:t}=ia({element:e,name:$i}),n=parseInt(null==t?void 0:t.value),r=!isNaN(n)&&n;return r&&{participantId:e.participantId,subOrder:r}})).filter(Boolean),n=ee(t.map((({subOrder:e})=>e)));return{subOrderMap:Object.assign({},...t.filter((({subOrder:e})=>1===n[e])).map((({participantId:e,subOrder:t})=>({[e]:t}))))}}({positionAssignments:e}),c=di({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:i});if(c.error)return c;const{participantResults:u}=c,d=Object.keys(u);return e.forEach((e=>{const{participantId:t}=e;if(d.includes(t)){Vc({element:e,extension:{name:Ji,value:u[t]}}),u[t].ties||qc({element:e,name:$i})}else qc({element:e,name:Ji}),qc({element:e,name:$i})})),Nc({drawDefinition:n}),{...de,participantResults:u}}function tl({event:e,eventId:t}){if(!e)return{error:ze};const{extension:n}=oa({event:e,name:Bi}),r=t?Gr(null==n?void 0:n.value,!1,!0):null==n?void 0:n.value;var i;t&&(null===(i=e.drawDefinitions)||void 0===i||i.forEach((e=>{var t;null==r||null===(t=r.flights)||void 0===t||t.forEach((t=>{t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})}))})));return{flightProfile:r}}const nl={matchUpStatus:R,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function rl({matchUpStatusCodes:e,removeWinningSide:t,tournamentRecord:n,drawDefinition:r,matchUpFormat:i,matchUpStatus:a,removeScore:o,winningSide:s,matchUpId:c,matchUp:u,event:d,notes:l,score:p}){var f;let m;const h=u.matchUpType===la;if(h?c&&u.matchUpId!==c&&({matchUp:u,structure:m}=xu({drawDefinition:r,matchUpId:c,event:d})):u.matchUpId!==c&&console.log("!!!!!"),o?Object.assign(u,nl):p&&(u.score=p),a&&(u.matchUpStatus=a),i&&(u.matchUpFormat=i),e&&(u.matchUpStatusCodes=e),s&&(u.winningSide=s),t&&(u.winningSide=void 0),m||({structure:m}=xu({drawDefinition:r,matchUpId:c,event:d})),(null===(f=m)||void 0===f?void 0:f.structureType)===Wo&&!u.collectionId){var v;i=h?"SET1-S:T100":i||u.matchUpFormat||(null===(v=m)||void 0===v?void 0:v.matchUpFormat)||r.matchUpFormat||(null==d?void 0:d.matchUpFormat);const e=m.structures.find((e=>null==e?void 0:e.matchUps.find((e=>e.matchUpId===c)))),t=h&&{matchUpTypes:[la]},{matchUps:a}=Ou({structure:e,inContext:!0,matchUpFilters:t,event:d}),o=el({positionAssignments:e.positionAssignments,tournamentRecord:n,drawDefinition:r,matchUpFormat:i,matchUps:a,event:d});if(o.error)return o}if(s!==u.winningSide){var g;const{flightProfile:e}=tl({event:d}),t=null==e||null===(g=e.flights)||void 0===g?void 0:g.find((e=>e.drawId===r.drawId));null!=t&&t.matchUpValue&&console.log("recalculate team point tallies")}if(l){const e=Zd({element:u,notes:l});if(e.error)return e}return Sc({drawDefinition:r,matchUp:u}),de}function il({drawDefinition:e,matchUpId:t,structure:n,event:r}){const i=xu({drawDefinition:e,event:r,matchUpId:t});if(i.error)return i;const a=i.matchUp,o=a.tieFormat||(null==n?void 0:n.tieFormat)||(null==e?void 0:e.tieFormat)||(null==r?void 0:r.tieFormat),{winningSide:s,set:c,scoreStringSide1:u,scoreStringSide2:d}=Ra({matchUp:a,tieFormat:o}),l=[1,2].includes(s),p=l?S:u?A:R,f=a.winningSide&&!l;return rl({score:{scoreStringSide1:u,scoreStringSide2:d,sets:[c]},removeWinningSide:f,drawDefinition:e,matchUpStatus:p,winningSide:s,matchUpId:t,matchUp:a,event:r}),{...de,removeWinningSide:f}}function al(e){const{dualWinningSideChange:t,inContextDrawMatchUps:n,drawDefinition:r,matchUpStatus:i,matchUpsMap:a,dualMatchUp:o,targetData:s,structure:c,event:u}=e,d=Boolean(e.matchUp.collectionId),{drawPositions:l,winningSide:p}=s.matchUp||{};if(!l)return{error:Pe};const{targetLinks:{loserTargetLink:f,winnerTargetLink:m},targetMatchUps:{loserMatchUp:h,winnerMatchUp:v}}=s,{positionAssignments:g}=Au({structure:c}),I=p-1,y=1-I,b=l[I],U=l[y],{winnerParticipantId:S,loserParticipantId:D}=g.reduce(((e,t)=>(t.drawPosition===U&&(e.loserParticipantId=t.participantId),t.drawPosition===b&&(e.winnerParticipantId=t.participantId),e)),{winnerParticipantId:void 0,loserParticipantId:void 0}),P=rl({...e,matchUpStatus:i||R,removeWinningSide:!0});if(P.error)return P;if(d){const{matchUpTieId:n}=e,{removeWinningSide:i}=il({matchUpId:n,drawDefinition:r,structure:c,event:u});if(!t&&!i)return{...de}}const{matchUps:A}=Ou({inContext:!0,drawDefinition:r,matchUpsMap:a,structure:c}),M=A.filter((e=>e.drawPositions.includes(U)));if(v){const e=ol({inContextDrawMatchUps:n,winningDrawPosition:b,winnerParticipantId:S,winnerTargetLink:m,drawDefinition:r,winnerMatchUp:v,dualMatchUp:o,matchUpsMap:a});if(e.error)return e}if(h){const{winnerHadMatchUpStatus:e}=function({sourceMatchUps:e,loserDrawPosition:t,drawPositionMatchUps:n,matchUpStatuses:r=[w,O,N]}){var i;const a=null==n?void 0:n.reduce(((e,t)=>!e||t.roundNumber>e.roundNumber?t:e),void 0),o=null==a||null===(i=a.drawPositions)||void 0===i?void 0:i.find((e=>e!==t)),s=e.filter((e=>{var t;return null==e||null===(t=e.drawPositions)||void 0===t?void 0:t.includes(o)})).map((e=>e.matchUpStatus)),c=e.filter((e=>{var n;return null==e||null===(n=e.drawPositions)||void 0===n?void 0:n.includes(t)})).map((e=>e.matchUpStatus));return{sourceMatchUp:a,winnerHadMatchUpStatus:se(s||[],r),winnerMatchUpStatuses:s,loserHadMatchUpStatus:se(c||[],r),loserMatchUpStatuses:c}}({drawPositionMatchUps:M,loserDrawPosition:U,sourceMatchUps:A}),t=f.linkCondition===Xo;if(e&&t){const e=sl({targetLink:f,inContextDrawMatchUps:n,drawDefinition:r,drawPosition:Math.min(...h.drawPositions),matchUpsMap:a});if(e.error)return e}const i=function({inContextDrawMatchUps:e,loserParticipantId:t,loserTargetLink:n,drawDefinition:r,loserMatchUp:i,dualMatchUp:a}){const o=n.target.structureId,{structure:s}=_c({drawDefinition:r,structureId:o}),{positionAssignments:c}=Au({structure:s});if(c.forEach((e=>{e.participantId===t&&delete e.participantId})),a){var u,d;const t=a.drawPositions,n=null==i||null===(u=i.sides)||void 0===u?void 0:u.find((e=>t.includes(e.drawPosition))),o=e.find((({matchUpId:e})=>e===i.matchUpId)),s=n&&(null==o||null===(d=o.sides)||void 0===d?void 0:d.find((e=>e.sideNumber===n)));s&&(delete s.lineUp,console.log("remove loser lineUp",{targetSide:s}),Sc({drawDefinition:r,matchUp:o}))}return{...de}}({inContextDrawMatchUps:n,loserParticipantId:D,loserTargetLink:f,drawDefinition:r,loserMatchUp:h,dualMatchUp:o,matchUpsMap:a});if(i)return i}return{...de}}function ol({inContextDrawMatchUps:e,winningDrawPosition:t,winnerParticipantId:n,winnerTargetLink:r,drawDefinition:i,winnerMatchUp:a,matchUpsMap:o,dualMatchUp:s,event:c}){const{structureId:u,roundNumber:d}=a;if(r){const e=r.target.structureId,{structure:t}=_c({drawDefinition:i,structureId:e}),{positionAssignments:a}=Au({structure:t}),o=a.find((e=>e.participantId===n)),s=null==o?void 0:o.drawPosition,{matchUps:u}=Ou({drawDefinition:i,structure:t,event:c});1===ee(u.map((e=>e.drawPositions)).flat(1/0).filter(Boolean))[s]?a.forEach((e=>{e.participantId===n&&delete e.participantId})):console.log("not removing from position assignments since instances > 1")}const l=function({inContextDrawMatchUps:e,targetDrawPosition:t,drawDefinition:n,structureId:r,dualMatchUp:i,roundNumber:a,matchUpsMap:o}){var s;const{structure:c}=_c({drawDefinition:n,structureId:r});if(c.structureType===Wo)return;const u=((null===(s=o=o||kc({drawDefinition:n}))||void 0===s?void 0:s.mappedMatchUps)||{})[r].matchUps,{initialRoundNumber:d}=yd({drawPosition:t,matchUps:u}),l=null==u?void 0:u.filter((e=>e.roundNumber>=a&&e.roundNumber!==d&&e.drawPositions.includes(t))),{positionAssignments:p}=Pu({drawDefinition:n,structureId:r});for(const f of l){const r=bd({inContextDrawMatchUps:e,positionAssignments:p,targetDrawPosition:t,drawDefinition:n,dualMatchUp:i,matchUpsMap:o,matchUp:f});if(r.error)return r}return{...de}}({targetDrawPosition:t,inContextDrawMatchUps:e,drawDefinition:i,dualMatchUp:s,matchUpsMap:o,roundNumber:d,structureId:u});return l.error?l:{...de}}function sl({inContextDrawMatchUps:e,drawDefinition:t,drawPosition:n,matchUpsMap:r,targetLink:i}){return Jd({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:r,drawPosition:n,structureId:i.target.structureId}),{...de}}function cl(e){var t;let{sourceMatchUp:n}=e;const{winnerMatchUp:r,structure:i,matchUpsMap:a,drawPosition:o}=e,s=r.roundNumber>1&&r.roundNumber-1,c=Fc({structureId:i.structureId,matchUpsMap:a});!n&&o&&(n=c.find((({drawPositions:e,roundNumber:t})=>t===s&&e.includes(o))));const u=null===(t=n)||void 0===t?void 0:t.roundPosition,d=u+(u%2?1:-1),l=s&&c.find((({roundNumber:e,roundPosition:t})=>e===s&&t===d)),p=null==l?void 0:l.matchUpStatus;return{pairedPreviousMatchUp:l,pairedPreviousMatchUpisWOWO:[P].includes(p)}}function ul({drawDefinition:e,drawPosition:t,matchUpsMap:n,structureId:r}){if(!e)return{error:Ie};const{structure:i}=_c({drawDefinition:e,structureId:r});if(!i)return{error:Ve};n||(n=kc({drawDefinition:e}));const{positionAssignments:a}=Pu({structure:i}),{activeDrawPositions:o}=zd({drawDefinition:e,structureId:r});if(a.find((e=>e.drawPosition===t)).bye)return{...de};if(o.includes(t))return{error:Ae};const s=a.find((e=>e.drawPosition===t));if(!s)return{error:Me};const{filled:c,containsBye:u}=function(e){const t=e.bye,n=e.qualifier,r=e.participantId;return{containsBye:t,containsQualifier:n,containsParticipant:r,filled:t||n||r}}(s);if(u)return{...de};if(c&&!u)return{error:Se};const{matchUps:d}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:n}),{matchUps:l}=Ou({drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:i});if(a.forEach((e=>{e.drawPosition===t&&(e.bye=!0)})),i.structureType===Wo)return function({drawDefinition:e,matchUps:t,drawPosition:n}){t.forEach((t=>{t.drawPositions.includes(n)&&dl({drawDefinition:e,matchUp:t})}))}({drawDefinition:e,matchUps:l,drawPosition:t}),{...de};const{roundProfile:p,roundMatchUps:f}=Lc({matchUps:l}),m=Object.keys(p).map((e=>parseInt(e))).reverse(),h=f[m.find((e=>p[e].drawPositions.includes(t)))].find((({drawPositions:e})=>e.includes(t)));dl({drawDefinition:e,matchUp:h});const v=h.drawPositions.find((e=>e!==t));if(v){const t=ll({sourceDrawPositions:h.drawPositions,matchUpId:h.matchUpId,inContextDrawMatchUps:d,drawPositionToAdvance:v,drawDefinition:e,matchUpsMap:n});if(t.error)return t}return Nc({drawDefinition:e,structureIds:[r]}),{...de}}function dl({drawDefinition:e,matchUp:t}){Object.assign(t,{matchUpStatus:w,score:void 0,winningSide:void 0}),Sc({drawDefinition:e,matchUp:t})}function ll({sourceDrawPositions:e,drawPositionToAdvance:t,inContextDrawMatchUps:n,drawDefinition:r,matchUpId:i,matchUpsMap:a}){const o=a.drawMatchUps.find((e=>e.matchUpId===i)),s=n.find((e=>e.matchUpId===i)),c=null==s?void 0:s.structureId,{structure:u}=_c({drawDefinition:r,structureId:c}),{positionAssignments:d}=Pu({structure:u}),l=d.filter((e=>e.bye)).map((e=>e.drawPosition)),p=o.drawPositions.find((e=>e!==t)),f=l.includes(p),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:h,winnerMatchUp:v,loserTargetDrawPosition:g}}=nd({matchUpId:i,structure:u,drawDefinition:r,inContextDrawMatchUps:n});if(v&&v.structureId===u.structureId&&function({drawDefinition:e,winnerMatchUp:t,drawPositionToAdvance:n,sourceDrawPositions:r,inContextDrawMatchUps:i,matchUpsMap:a}){var o,s;const c=a.drawMatchUps.find((e=>e.matchUpId===t.matchUpId)),u=i.find((e=>e.matchUpId===t.matchUpId)),d=null==u?void 0:u.structureId,{structure:l}=_c({drawDefinition:e,structureId:d}),{positionAssignments:p}=Pu({structure:l}),f=p.find((({drawPosition:e})=>e===n)).bye,m=c.drawPositions.filter((e=>e)),h=p.filter((e=>m.includes(e.drawPosition))),v=p.find((({drawPosition:e})=>e===n)),g=null==r?void 0:r.find((e=>e!==n)),I=g&&h.find((({drawPosition:e})=>e===g)),y=null==I?void 0:I.bye,b=f&&y;if(m.length>1&&f&&!y)return{error:Se};const U=m.find((e=>e!==n));let S=b;const D=[].concat(...(c.drawPositions||[]).filter(Boolean),void 0,void 0).slice(0,2).map((e=>e||S?e===n?(S=!0,n):e:(S=!0,n)));if(!S)return console.log("@@@@@@@",{advancingAssignmentIsBye:v,drawPositionToAdvance:n,existingAssignments:h}),{error:Se};const N=null===(o=p.find((({drawPosition:e})=>e===U)))||void 0===o?void 0:o.bye,P=null===(s=p.find((({drawPosition:e})=>e===n)))||void 0===s?void 0:s.bye,A=P||N?w:R;if(Object.assign(c,{matchUpStatus:A,score:void 0,winningSide:void 0,drawPositions:D}),Sc({drawDefinition:e,matchUp:c}),N||P){const r=N?n:U;if(r)ll({drawPositionToAdvance:r,matchUpId:t.matchUpId,inContextDrawMatchUps:i,drawDefinition:e,iterative:"brightmagenta",matchUpsMap:a});else if(P){const{targetLinks:{loserTargetLink:n},targetMatchUps:{loserMatchUp:r,loserTargetDrawPosition:o}}=nd({matchUpId:t.matchUpId,structure:l,drawDefinition:e,inContextDrawMatchUps:i});if(n&&r)if(r.feedRound)pl({drawDefinition:e,loserMatchUp:r,loserTargetLink:n,loserTargetDrawPosition:o,matchUpsMap:a});else{const i=1-t.roundPosition%2,a=r.drawPositions[i],s=ul({drawDefinition:e,structureId:n.target.structureId,drawPosition:a,loserTargetDrawPosition:o,iterative:"brightgreen"});if(s.error);}}}}({drawDefinition:r,winnerMatchUp:v,drawPositionToAdvance:t,sourceDrawPositions:e,inContextDrawMatchUps:n,matchUpsMap:a}),h&&f&&h.structureId!==u.structureId){const{roundNumber:e}=h;if(1===e){const e=ul({drawDefinition:r,structureId:m.target.structureId,drawPosition:g,iterative:"brightyellow"});if(e.error)return e}else pl({drawDefinition:r,loserMatchUp:h,loserTargetLink:m,loserTargetDrawPosition:g,matchUpsMap:a})}return{...de}}function pl({drawDefinition:e,loserMatchUp:t,loserTargetLink:n,loserTargetDrawPosition:r,matchUpsMap:i}){const{roundNumber:a}=t,o=((null==i?void 0:i.mappedMatchUps)||{})[t.structureId].matchUps,{initialRoundNumber:s}=yd({drawPosition:r,matchUps:o});if(s===a){const t=ul({drawDefinition:e,structureId:n.target.structureId,drawPosition:r,iterative:"red"});if(t.error)return t}}function fl({inContextDrawMatchUps:e,matchUpId:t,drawPosition:n}){const r=e.filter((({winnerMatchUpId:e,loserMatchUpId:n})=>n===t||e===t)).sort(((e,t)=>e.roundPosition-t.roundPosition));return r.find((({feedRound:e})=>e))?1:r.reduce(((e,t,r)=>t.drawPositions.includes(n)?r+1:e),void 0)}function ml({drawDefinition:e,matchUpId:t,matchUpStatus:n,drawPosition:r,matchUpsMap:i,inContextDrawMatchUps:a}){var o,s,c;i||(i=kc({drawDefinition:e})),a||({matchUps:a}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:i}));const u=a.find((e=>e.matchUpId===t)),d=null==u?void 0:u.structureId,l=null==e||null===(o=e.structures)||void 0===o?void 0:o.find((e=>e.structureId===d)),p=null===(s=i)||void 0===s||null===(c=s.drawMatchUps)||void 0===c?void 0:c.find((e=>e.matchUpId===t)),f=p.drawPositions||[],{positionAdded:m,positionAssigned:h,updatedDrawPositions:v}=function({drawPosition:e,drawPositions:t}){let n,r=t.includes(e);return{updatedDrawPositions:r?t:[].concat(...t,void 0,void 0).slice(0,2).map((t=>t||r?t:(r=!0,n=!0,e))).sort(Hr),positionAdded:n,positionAssigned:r}}({drawPosition:r,drawPositions:f}),{positionAssignments:g}=Pu({drawDefinition:e,structure:l}),I=g.filter((e=>v.includes(e.drawPosition))).find((({bye:e})=>e)),y=p.matchUpStatus===O&&v.filter(Boolean).length<2;if(n=I?w:n||(y?O:p.matchUpStatus===P?P:R),m){({matchUps:a}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:i}));const o=y&&fl({inContextDrawMatchUps:a,drawPosition:r,matchUpId:t})||void 0;Object.assign(p,{drawPositions:v,winningSide:o,matchUpStatus:n}),Sc({drawDefinition:e,matchUp:p})}const b=nd({matchUpId:t,drawDefinition:e,inContextDrawMatchUps:a,inContextMatchUp:u}),{targetMatchUps:{winnerMatchUp:U,loserMatchUp:D,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:A}}=b,M=Fc({structureId:l.structureId,matchUpsMap:i});if(h&&I){if(U)if([w,P].includes(n)){const t=ml({drawDefinition:e,drawPosition:r,matchUpId:U.matchUpId,iterative:"brightmagenta",matchUpsMap:i,inContextDrawMatchUps:a});if(t.error)return t}else{const{structureId:e}=U;e!==l.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else{const{pairedPreviousMatchUpisWOWO:t}=cl({winnerMatchUp:p,drawPosition:r,structure:l,matchUpsMap:i});if(t&&U){const t=ml({drawDefinition:e,drawPosition:r,matchUpId:U.matchUpId,iterative:"brightred",matchUpsMap:i,inContextDrawMatchUps:a});if(t.error)return t}}if((null==A?void 0:A.linkCondition)===Xo&&2===v.filter(Boolean).length&&!I){if(M.filter((({drawPositions:e,roundNumber:t})=>1===t&&se(e,v))).every((({matchUpStatus:e})=>[S,E].includes(e)))&&D){const{structureId:t}=D,n=ul({drawDefinition:e,structureId:t,drawPosition:N,matchUpsMap:i});if(n.error)return n}}return h?de:{error:Se,drawPosition:r}}function hl(e){const{drawDefinition:t,matchUpsMap:n,targetData:r,structure:i}=e;if(i.structureType===Wo)return de;const{matchUp:a,targetMatchUps:o,targetLinks:s}=r,{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}=o;if(c){const{loserTargetLink:e}=s,r=vl({drawDefinition:t,loserMatchUp:c,loserTargetLink:e,loserTargetDrawPosition:d,matchUpsMap:n});if(r.error)return r}if(u){const t=function(e){const{inContextDrawMatchUps:t,drawDefinition:n,sourceMatchUp:r,winnerMatchUp:i,matchUpsMap:a,structure:o,matchUpId:s}=e,c=a.drawMatchUps.find((e=>e.matchUpId===i.matchUpId));if(!c)return{error:ht};const u=(null==r?void 0:r.drawPositions)||[];let d=c.drawPositions.filter(Boolean);se(u,d)&&(d=d.filter((e=>!u.includes(e))));if(d.length>1)return{error:Se};const{pairedPreviousMatchUpisWOWO:l}=cl(e),p=nd({matchUpId:i.matchUpId,structure:o,drawDefinition:n,inContextDrawMatchUps:t}),{targetMatchUps:f,targetLinks:m}=p,{winnerMatchUp:h,loserMatchUp:v,loserTargetDrawPosition:g}=f;if(v){const{loserTargetLink:e}=m,t=vl({drawDefinition:n,loserMatchUp:v,loserTargetLink:e,loserTargetDrawPosition:g,matchUpsMap:a});if(t.error)return t}const I=c.drawPositions.filter(Boolean),y=1===I.length&&fl({drawPosition:I[0],inContextDrawMatchUps:t,matchUpId:s})||void 0,b=c.matchUpStatus===O&&!I.length,w=1===c.finishingRound,U=b&&!w?P:O,S=rl({...e,matchUp:c,winningSide:y,matchUpStatus:U});if(S.error)return S;if(b)return hl({...e,targetData:p});if(!h)return{...de};const D=d[0];if(D)return ml({drawDefinition:n,inContextDrawMatchUps:t,matchUpId:h.matchUpId,drawPosition:D});if(l){const r=a.drawMatchUps.find((e=>e.matchUpId===h.matchUpId));if(!r)return{error:ht};const i=r.drawPositions.filter(Boolean);if(1===i.length){const e=fl({matchUpId:s,drawPosition:i[0],inContextDrawMatchUps:t});console.log("existing drawPosition is winningSide",{walkoverWinningSide:e})}const o=r.matchUpStatus===O?O:P,c=rl({matchUpId:r.matchUpId,matchUp:r,removeScore:!0,drawDefinition:n,matchUpStatus:o});if(c.error)return c;if(o===P){const t=hl({...e,targetData:p,matchUpId:s});if(t.error)return t}}return de}({...e,matchUpId:u.matchUpId,sourceMatchUp:a,winnerMatchUp:u});if(t.error)return t}return de}function vl(e){var t;const{drawDefinition:n,loserTargetLink:r,loserTargetDrawPosition:i,matchUpsMap:a}=e,o=null==r||null===(t=r.target)||void 0===t?void 0:t.structureId,{structure:s}=_c({drawDefinition:n,structureId:o});return s?ul({drawDefinition:n,structureId:o,drawPosition:i,matchUpsMap:a}):{error:He}}function gl(e){const{drawDefinition:t,matchUp:n,structure:r,matchUpStatus:i}=e,a=i===w,o=n.winningSide,s=i===P,c=qd({matchUpStatus:i}),u=Hd({matchUpStatus:i}),d=o&&s;return!c&&!u&&{error:nt}||o&&c&&!s&&Il(e)||d&&function(e){let t=al(e);return t.error?t:hl(e)}(e)||o&&al(e)||u&&rl({...e,removeScore:[U,O].includes(i),matchUpStatus:i||R})||a&&function({drawDefinition:e,structure:t,matchUp:n}){var r;if(null!=n&&n.winningSide)return{error:at,matchUpStatus:w};const{positionAssignments:i}=Au({structure:t}),a=i.filter((e=>e.bye)).map((e=>e.drawPosition));return(null===(r=n.drawPositions)||void 0===r?void 0:r.some((e=>a.includes(e))))?(n.matchUpStatus=w,n.matchUpStatusCodes=[],Sc({drawDefinition:e,matchUp:n}),de):{error:"Cannot Assign BYE status if no assignment: { bye: true }"}}({drawDefinition:t,matchUp:n,structure:r})||!c&&{error:nt}||s&&function(e){const t=Il({...e,removeScore:!0});return t.error?t:hl(e)}(e)||{error:at}}function Il(e){var t;const n=e.isCollectionMatchUp&&(null===(t=e.dualMatchUp)||void 0===t?void 0:t.winningSide)&&e.projectedWinningSide,r=Boolean(e.matchUp.collectionId),i=rl(e);if(r){const{matchUpTieId:t,drawDefinition:r}=e,{removeWinningSide:i}=il({matchUpId:t,drawDefinition:r});console.log("atsms",{removeWinningSide:i,removeDirected:n})}return i}function yl({tournamentRecord:e,drawDefinition:t,event:n}){const r=(null==e?void 0:e.events)||n&&[n],i=(null==r?void 0:r.map((e=>null==e?void 0:e.drawDefinitions)).flat().filter(Boolean))||t&&[t]||[],a={},o={},s=i.map((({structures:e})=>null==e?void 0:e.filter((e=>null==e?void 0:e.structures)))).flat().filter(Boolean);for(const c of s){const{structures:e,structureId:t}=c||{};e&&(a[t]=null==e?void 0:e.map((e=>e.structureId)))&&e.forEach((e=>o[e.structureId]=c.structureId))}return{containedStructures:a,containerStructures:o}}function bl({drawDefinition:e,structureId:t}){if(!e)return{error:Ie};const{structure:n}=_c({drawDefinition:e,structureId:t}),r=((null==e?void 0:e.links)||[]).filter((e=>{var n;return(null===(n=e.source)||void 0===n?void 0:n.structureId)===t})).map((e=>{var t;return null===(t=e.target)||void 0===t?void 0:t.structureId}));return{playoffStructures:((null==e?void 0:e.structures)||[]).filter((e=>r.includes(e.structureId)&&e.stage===_o)),structure:n}}function wl(e){if(null==e||!e.drawDefinition)return{error:Ie};const t=od(e),{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:i}=t||{};return!!((null==n?void 0:n.length)&&!(null!=r&&r.length)&&!i.length)}function Ul(e){var t,n;const{drawDefinition:r,structureId:i}=e;if(!r)return{error:Ie};const{playoffStructures:a}=bl({drawDefinition:r,structureId:i});if(null==a||!a.length)return!1;const o=(null==r||null===(t=r.entries)||void 0===t||null===(n=t.filter((e=>du.includes(null==e?void 0:e.entryStatus))))||void 0===n?void 0:n.length)||0;let s=0;return(a||[]).reduce(((e,t)=>{var n;return!(null!=t&&null!==(n=t.positionAssignments)&&void 0!==n&&n.filter((e=>(e.participantId&&s++,!(null!=e&&e.bye||null!=e&&e.participantId)))).length)&&e}),!0)||s===o}function Sl({drawDefinition:e,structure:t,matchUp:n}){const r=[];if(t.finishingPosition===Ds){if(wl({drawDefinition:e,structure:t})){const{structureIds:i}=function({drawDefinition:e,structure:t,matchUp:n}){const{drawPositions:r}=n,{positionAssignments:i}=Pu({drawDefinition:e,structure:t}),a=i.filter((({drawPosition:e})=>r.includes(e))).map((e=>{var t;const{extension:n}=ia({element:e,name:Ji});return null==n||null===(t=n.value)||void 0===t?void 0:t.groupOrder})),{containerStructures:o}=yl({drawDefinition:e}),s=o[t.structureId],{links:{source:c}}=td({drawDefinition:e,structureId:s});return{structureIds:null==c?void 0:c.filter((e=>{var t;return se(a,(null===(t=e.source)||void 0===t?void 0:t.finishingPositions)||[])})).map((e=>e.source.structureId))}}({drawDefinition:e,structure:t,matchUp:n});null!=i&&i.length&&r.push(...i)}}return{connectedStructureIds:r}}function Dl({drawDefinition:e,drawPosition:t,structure:n}){var r,i,a;const o=null==n||null===(r=n.matchUps)||void 0===r?void 0:r.find((e=>{var n;return null===(n=e.drawPositions)||void 0===n?void 0:n.includes(t)})),s=null==o?void 0:o.roundNumber,c=null==n||null===(i=n.matchUps)||void 0===i?void 0:i.filter((e=>e.roundNumber===s)).map((({drawPositions:e})=>e)).flat(),u=null==n||null===(a=n.positionAssignments)||void 0===a?void 0:a.filter((({drawPosition:e,participantId:t})=>c.includes(e)&&t)).map(Cc);return e.entries.filter((({entryStatus:e})=>[tu,iu,eu].includes(e))).map(Cc).filter((e=>!u.includes(e)))}function Nl({drawPositions:e,structure:t}){if([ko,Lo].includes(t.stage)&&1===t.stageSequence)return;const{positionAssignments:n}=Pu({structure:t});n.filter((({drawPosition:t})=>e.includes(t))).forEach((e=>{Vc({element:e,extension:{name:ji,value:!0}})}))}function Pl({drawDefinition:e,positionAction:t}){const{extension:n}=ia({element:e,name:"positionActions"});Vc({element:e,extension:{name:"positionActions",value:Array.isArray(null==n?void 0:n.value)?n.value.concat(t):[t]}})}function Al({participantsCount:e,cluster:t}){const n=K(e),r=ie(1,n+1);let i=[],a=n/2;for(;a>1;){const e=ce(r,a),n=e.length;e.forEach(((e,r)=>{let a;const o=r<n/2,s=r%2==0,c=e[0],u=e[e.length-1];a=t&&n>4?8===n?o?u:c:s?c:u:o?c:u,se(e,i)||i.push(a)})),a/=2}const o=r.filter((e=>!i.includes(e)));for(;o.length;)o.length%2==0?i.push(o.pop()):i.push(o.shift());const s=ie(0,20).map((e=>Math.pow(2,e)));s.unshift(1);const c=s.indexOf(n);let u=0;const d=[];return ie(0,c).forEach((e=>{d.push(i.slice(u,u+s[e])),u+=s[e]})),{seedBlocks:d}}function Ml({drawDefinition:e,appliedPolicies:t,allPositions:n,structure:r}){var i;let a,o,s,c,u=0,d=[];if(!r)return{error:He};const{roundMatchUps:l}=Ou({roundFilter:1,structure:r}),{seedAssignments:p}=Su({drawDefinition:e,structure:r}),{positionAssignments:f}=Au({structure:r}),m=f.length,h=(null==p?void 0:p.length)||0;let v=[];const g=Object.keys(l).sort(((e,t)=>e-t)).map((e=>{const t=l[e].map((e=>e.drawPositions)).flat(1/0).filter(Boolean),n=t.filter((e=>!v.includes(e)));return v=v.concat(...t),n})).filter((e=>e.length)).reverse(),I=g.pop(),y=I&&Math.min(...I)-1||0,b=null==t||null===(i=t.seeding)||void 0===i?void 0:i.seedingProfile,w=(null==I?void 0:I.length)||0,U=g.filter((e=>e.filter((e=>e<=h)).length)),S=n?m:h;if(r.structureType===Wo){if(c=!0,({validSeedBlocks:d,error:o}=function({seedingProfile:e,structure:t,seedBlocks:n}){const r=t.structures||[],i=[];for(const l of r){const{positionAssignments:t}=Au({structure:l}),r=Math.min(...t.map((e=>e.drawPosition)))-1,a=t.length;let o,s;if(H(a)?({blocks:o,error:s}=Tl({seedBlocks:n,baseDrawSize:a,seedingProfile:e,drawPositionOffset:r,seedCountGoal:a})):({blocks:o,error:s}=El({baseDrawSize:a,drawPositionOffset:r,seedCountGoal:a})),s)return{error:s};i.push(o)}const a=i.map((e=>e.map((e=>e.seedNumbers.map(((t,n)=>({seedNumber:t,drawPosition:e.drawPositions[n]}))))))).flat(1/0).sort(((e,t)=>e.seedNumber-t.seedNumber)).reduce(((e,t)=>{const n=t.seedNumber;return e[n]||(e[n]=[]),e[n].push(t.drawPosition),e}),{});let o=1,s=[];a[1]&&a[1].forEach(((e,t)=>{s.push({seedNumbers:[t+1],drawPositions:[e]}),o++}));[[2],[3,4],[5,6,7,8],ie(9,17)].forEach((e=>{const t=[].concat(...e.map((e=>a[e]||[]))),n=t.map(((e,t)=>o+t)),r={seedNumbers:n,drawPositions:t};s.push(r),o+=n.length}));const c=(e,t)=>e-t,u=(e,t)=>t-e,d=Object.keys(a).map(((e,t)=>a[e].sort(t%2?u:c))).flat().map(((e,t)=>({seedNumbers:[t+1],drawPositions:[e]})));t.seedingProfile===qo&&(s=d);return{validSeedBlocks:s}}({seedingProfile:b,structure:r})),o)return{error:o}}else if(g.length){s=!0,d=U.map((e=>({seedNumbers:e,drawPositions:e})));const e=U.flat(1/0);a=e.length<S?S-e.length:0,u=e.length}else a=S;if(!c){const{blocks:e,error:t}=Tl({baseDrawSize:w,seedingProfile:b,seedCountGoal:a,seedNumberOffset:u,drawPositionOffset:y});if(t)return{error:t,validSeedBlocks:[],isContainer:c,isFeedIn:s};e.forEach((e=>d.push(e)))}const D=[].concat(...d.map((e=>e.drawPositions))).reduce(((e,t)=>(null==I?void 0:I.includes(t))&&e),!0);return s||c||D?{validSeedBlocks:d,isFeedIn:s,isContainer:c}:{error:je,validSeedBlocks:[],isContainer:c,isFeedIn:s}}function Tl({baseDrawSize:e,seedCountGoal:t,seedingProfile:n,drawPositionOffset:r=0,seedNumberOffset:i=0}){let a=1;const o=[],{seedBlocks:s}=Al({participantsCount:e,cluster:n===Vo});a=0;for(const u of s){if(a+1>t)break;const e=u.map((e=>e+r)),n=c(a+1,u.length).map((e=>+e+i));a+=u.length,o.push({drawPositions:e,seedNumbers:n})}return{blocks:o};function c(e,t){return Array.from(new Array(t),((t,n)=>n+e))}}function El({baseDrawSize:e,seedCountGoal:t,drawPositionOffset:n=0}){let r=1;const i=[],a=ie(n+1,n+e+1);return[[1],[2],[3,4],[5,6,7,8],ie(9,17),ie(17,33),ie(33,65)].forEach((e=>{const n=e.map((()=>a.reverse().pop())).filter(Boolean),o={seedNumbers:e=e.slice(0,n.length),drawPositions:n};r<=t&&i.push(o),r+=n.length})),{blocks:i}}function Cl({seedNumber:e,drawDefinition:t,structureId:n,drawPosition:r}){var i,a,o,s;const{structure:c}=_c({drawDefinition:t,structureId:n}),{appliedPolicies:u}=xc({drawDefinition:t}),{validSeedBlocks:d}=Ml({structure:c,drawDefinition:t,appliedPolicies:u});if(null!=u&&null!==(i=u.seeding)&&void 0!==i&&null!==(a=i.validSeedPositions)&&void 0!==a&&a.ignore)return!0;if(null!=u&&null!==(o=u.seeding)&&void 0!==o&&null!==(s=o.validSeedPositions)&&void 0!==s&&s.strict){const t=d.find((t=>t.seedNumbers.includes(e)));return((null==t?void 0:t.drawPositions)||[]).includes(r)}return[].concat(...d.map((e=>e.drawPositions))).includes(r)}function Rl({drawDefinition:e,structureId:t,randomize:n}){var r;const{structure:i}=_c({drawDefinition:e,structureId:t}),{seedAssignments:a}=Su({drawDefinition:e,structure:i}),{positionAssignments:o}=Au({structure:i}),s=o.filter((e=>e.participantId||e.bye||e.qualifier)).map((e=>e.drawPosition)).filter(Boolean),{appliedPolicies:c}=xc({drawDefinition:e}),{validSeedBlocks:u}=Ml({structure:i,drawDefinition:e,appliedPolicies:c}),d=(u||[]).filter((e=>e.drawPositions.filter((e=>!s.includes(e))).length))[0],l=a.map((e=>e.participantId)).filter(Boolean),p=o.map((e=>e.participantId)).filter(Boolean),f=l.filter((e=>p.includes(e))),m=l.filter((e=>!p.includes(e))),h=a.filter((e=>m.includes(e.participantId))),v=a.filter((e=>!e.participantId)),g=(h.length||v.length)&&(null==d?void 0:d.drawPositions.filter((e=>!s.includes(e))))||[],I=n?X(g):g,y=[],b=I.map((()=>{const e=function(e,t){const n=e.filter((e=>!t.includes(e.participantId))),r=Math.min(...n.map((e=>e.seedValue))),i=n.filter((e=>e.seedValue===r));return X(i).pop()}(h,y),t=e&&e.participantId;return t&&y.push(t),t})).filter(Boolean),w=a.filter((e=>f.includes(e.participantId))).map((e=>e.seedNumber)),U=(d&&d.seedNumbers||[]).filter((e=>!w.includes(e))),S=a.filter((e=>U.includes(e.seedNumber))).map((e=>e.participantId)),D=null==c||null===(r=c.seeding)||void 0===r?void 0:r.duplicateSeedNumbers;return{nextSeedBlock:d,unplacedSeedParticipantIds:void 0===D||D?b:S,unplacedSeedNumbers:U,unfilledPositions:I,unplacedSeedAssignments:h}}function Ol({inContextDrawMatchUps:e,automaticPlacement:t,drawDefinition:n,participantId:r,drawPosition:i,matchUpsMap:a,structureId:o,event:s}){a=a||kc({drawDefinition:n}),e||({matchUps:e}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:a}));const{structure:c,error:u}=_c({drawDefinition:n,structureId:o});if(u)return{error:u};const{positionAssignments:d}=Au({structure:c}),{seedAssignments:l}=Su({drawDefinition:n,structure:c}),p=l.find((e=>e.participantId===r)),f=null==p?void 0:p.seedNumber;if(f){if(!Cl({structureId:o,drawPosition:i,drawDefinition:n,seedNumber:f}))return{error:Ue}}const m=d.find((e=>e.drawPosition===i));if(!m)return{error:Me};if(!r)return{error:Yt};if(!(null!=c&&c.structures||null!=c&&c.matchUps.find((({roundPosition:e})=>!!e)))?!Dl({drawDefinition:n,drawPosition:i,structure:c}).includes(r):d.map(Cc).includes(r))return{error:an};const{containsParticipant:h,containsBye:v}=function(e){const t=e.bye,n=e.qualifier,r=e.participantId;return{containsBye:t,containsQualifier:n,containsParticipant:r,filled:t||n||r}}(m);if(h&&m.participantId!==r){const{activeDrawPositions:e}=zd({drawDefinition:n,structureId:o});if(e.includes(i))return{error:Ae}}if(v){let t=Jd({drawDefinition:n,drawPosition:i,structureId:o,matchUpsMap:a,inContextDrawMatchUps:e});if(t.error)return t}if(m.participantId=r,c.structureType!==Wo?function({inContextDrawMatchUps:e,automaticPlacement:t,drawDefinition:n,drawPosition:r,matchUpsMap:i,structure:a,event:o}){const s={isCollectionMatchUp:!1},{matchUps:c}=Ou({inContextDrawMatchUps:e,drawDefinition:n,matchUpFilters:s,matchUpsMap:i,structure:a,event:o}),{roundMatchUps:u}=Lc({matchUps:c}),{initialRoundNumber:d}=yd({drawPosition:r,matchUps:c}),l=u[d].find((e=>e.drawPositions.includes(r)));if(l){const a=ml({drawDefinition:n,drawPosition:r,automaticPlacement:t,matchUpId:l.matchUpId,matchUpsMap:i,inContextDrawMatchUps:e});if(a.error);}}({inContextDrawMatchUps:e,positionAssignments:d,automaticPlacement:t,drawDefinition:n,matchUpsMap:a,drawPosition:i,structure:c,event:s}):Kd({inContextDrawMatchUps:e,positionAssignments:d,drawDefinition:n,matchUpsMap:a,structure:c}),!t){Nl({structure:c,drawPositions:[i]});Pl({drawDefinition:n,positionAction:{name:"positionAssignment",drawPosition:i,structureId:o,participantId:r}})}return Nc({drawDefinition:n,structureIds:[o]}),Object.assign({positionAssignments:d},de)}function xl(e){const{loserMatchUpDrawPositionIndex:t,inContextDrawMatchUps:n,projectedWinningSide:r,loserDrawPosition:i,loserTargetLink:a,drawDefinition:o,loserMatchUp:s,dualMatchUp:c,matchUpsMap:u,event:d}=e,l=a.linkCondition,p=s.drawPositions||[],f=l===Xo&&2===s.roundNumber&&Math.min(...p.filter(Boolean)),m=f||p[t],h=f||p[1-t],v=a.source.structureId,{structure:g}=_c({drawDefinition:o,structureId:v}),{matchUps:I}=Ou({inContext:!0,drawDefinition:o,structure:g,event:d}),y=I.filter((e=>e.drawPositions.includes(i))).filter((e=>{var t;const n=e.sides.find((e=>e.drawPosition===i)),r=e.matchUpStatus===O||e.matchUpStatus===N&&!(null===(t=e.score)||void 0===t||!t.scoreStringSide1);return(null==n?void 0:n.sideNumber)===e.winningSide&&!r})),b=l===Xo&&0===y.length,{positionAssignments:w}=Au({drawDefinition:o,structureId:v}),U=w.find((e=>e.drawPosition===i)),S=null==U?void 0:U.participantId,D=a.target.structureId,{positionAssignments:P}=Au({drawDefinition:o,structureId:D}),A=P.filter((({drawPosition:e})=>p.includes(e)));if(A.some((e=>e.participantId===S)))return de;const M=A.filter((e=>{const t=p.includes(e.drawPosition),n=!e.participantId&&!e.bye&&!e.qualifier;return t&&n})).map((e=>e.drawPosition)),T=M.includes(m),E=a.target.roundNumber>1&&M.length,C=1===a.target.roundNumber&&T;if(f){const e=b?x():ul({drawDefinition:o,structureId:D,drawPosition:h});if(e.error)return e}else if(C){const e=x();if(e.error)return e}else{if(!E)return{error:Me};{const e=M.sort(Hr)[0],t=Ol({participantId:S,structureId:D,drawPosition:e,automaticPlacement:!0,inContextDrawMatchUps:n,drawDefinition:o,matchUpsMap:u});if(t.error)return t}}if(c&&r){var R;const e=null===(R=c.sides)||void 0===R?void 0:R.find((e=>e.sideNumber===3-r));if(null!=e&&e.lineUp){const{roundNumber:t}=s,{roundPosition:n}=c,r=1===t?n%2+1:1,{matchUp:i}=xu({matchUpId:s.matchUpId,drawDefinition:o,matchUpsMap:u,event:d}),a=[1,2].map((e=>{var t;return{...(null===(t=i.sides)||void 0===t?void 0:t.find((t=>t.sideNumber===e)))||{},sideNumber:e}}));i.sides=a;const l=i.sides.find((e=>e.sideNumber===r));l&&(l.lineUp=e.lineUp,Sc({drawDefinition:o,matchUp:i}))}}return{...de};function x(){return Ol({drawDefinition:o,participantId:S,structureId:D,drawPosition:m,automaticPlacement:!0,matchUpsMap:u,inContextDrawMatchUps:n})}}function Ll(e){const{dualWinningSideChange:t,projectedWinningSide:n,inContextDrawMatchUps:r,matchUpStatusCodes:i,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:l,targetData:p,matchUpId:f,structure:m,matchUp:h,event:v,score:g}=e,I=Boolean(h.collectionId);if(!(I||function({structure:e,matchUp:t}){const{drawPositions:n}=t,{positionAssignments:r}=Au({structure:e});return 2===r.filter((e=>n.includes(e.drawPosition)&&e.participantId)).length}({structure:m,matchUp:h})))return{error:Ze};const y=qd({matchUpStatus:c}),b=[O].includes(c),w=rl({matchUpStatusCodes:y&&i||[],matchUpStatus:y&&c||S,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,removeScore:b,winningSide:l,matchUpId:f,matchUp:h,event:v,score:g});if(w.error)return w;let U=h.drawPositions;if(I){const{matchUpTieId:n}=e;il({matchUpId:n,drawDefinition:o,structure:m,event:v});const i=r.find((({matchUpId:e})=>e===n));if(U=null==i?void 0:i.drawPositions,!t)return{...de}}if(!U)return{error:Pe};{const e=l-1,t=1-e,i=U[e],a=U[t],{targetLinks:{loserTargetLink:s,winnerTargetLink:f},targetMatchUps:{winnerMatchUpDrawPositionIndex:m,loserMatchUpDrawPositionIndex:h,winnerMatchUp:g,loserMatchUp:I}}=p;if(g){const e=function({winnerMatchUpDrawPositionIndex:e,inContextDrawMatchUps:t,projectedWinningSide:n,winningDrawPosition:r,winnerTargetLink:i,drawDefinition:a,winnerMatchUp:o,dualMatchUp:s,matchUpsMap:c,event:u}){if(i){const n=o.drawPositions||[],s=n[e],u=i.source.structureId,{positionAssignments:d}=Au({structureId:u,drawDefinition:a}),l=d.find((e=>e.drawPosition===r)),p=null==l?void 0:l.participantId,f=i.target.structureId,{positionAssignments:m}=Au({structureId:f,drawDefinition:a}),h=m.find((e=>e.participantId===p)),v=null==h?void 0:h.drawPosition,g=m.filter((e=>{const t=n.includes(e.drawPosition),r=!e.participantId&&!e.bye&&!e.qualifier;return t&&r})).map((e=>e.drawPosition)),I=g.includes(s);if(1===i.target.roundNumber&&I)Ol({drawPosition:s,participantId:p,structureId:f,inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:c});else if(g.length){const e=g.pop();Ol({participantId:p,structureId:f,inContextDrawMatchUps:t,drawDefinition:a,drawPosition:e,matchUpsMap:c})}else{if(!v){const e="winner target position unavaiallble";return console.log(e),{error:e}}{const e=ml({drawPosition:v,matchUpId:o.matchUpId,inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:c});if(e.error)return e}}}else{const e=ml({matchUpId:o.matchUpId,drawPosition:r,inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:c});if(e.error)return e}if(s&&n){var d;const e=null===(d=s.sides)||void 0===d?void 0:d.find((e=>e.sideNumber===n));if(null!=e&&e.lineUp){const t=s.roundPosition,n=o.roundPosition,r=t===n&&1!==t||Math.floor(t/2)===n?2:1,{matchUp:i}=xu({matchUpId:o.matchUpId,drawDefinition:a,matchUpsMap:c,event:u}),d=[1,2].map((e=>{var t;return{...(null===(t=i.sides)||void 0===t?void 0:t.find((t=>t.sideNumber===e)))||{},sideNumber:e}}));i.sides=d;const l=i.sides.find((e=>e.sideNumber===r));l&&(l.lineUp=e.lineUp,Sc({drawDefinition:a,matchUp:i}))}}return{...de}}({winnerMatchUpDrawPositionIndex:m,inContextDrawMatchUps:r,projectedWinningSide:n,winningDrawPosition:i,winnerTargetLink:f,drawDefinition:o,winnerMatchUp:g,dualMatchUp:u,matchUpsMap:d,event:v});if(e.error)return e}if(I){const e=xl({loserMatchUpDrawPositionIndex:h,inContextDrawMatchUps:r,projectedWinningSide:n,loserDrawPosition:a,loserTargetLink:s,drawDefinition:o,matchUpStatus:c,loserMatchUp:I,winningSide:l,matchUpsMap:d,dualMatchUp:u,event:v});if(e.error)return e}}return de}function kl(e){const{drawDefinition:t,targetData:n,structure:r,matchUp:i,matchUpsMap:a,inContextDrawMatchUps:o}=e,{targetLinks:{loserTargetLink:s},targetMatchUps:{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}}=n;if(c){const e=sl({targetLink:s,drawPosition:d,drawDefinition:t,inContextDrawMatchUps:o,matchUpsMap:a});if(e.error)return e}if(u){const n=null==a?void 0:a.drawMatchUps.find((e=>e.matchUpId===u.matchUpId)),{pairedPreviousMatchUp:s}=function({matchUp:e,structureId:t,matchUpsMap:n}){const r=null==e?void 0:e.roundPosition,i=r+(r%2?1:-1);return{pairedPreviousMatchUp:Fc({matchUpsMap:n,structureId:t}).find((({roundNumber:t,roundPosition:n})=>t===e.roundNumber&&n===i))}}({matchUp:i,structureId:r.structureId,matchUpsMap:a}),c=(null==s?void 0:s.matchUpStatus)===P,d=(null==s?void 0:s.drawPositions.filter(Boolean))||[],l=[...j,w].includes(null==s?void 0:s.matchUpStatus)||(null==s?void 0:s.winningSide),p=nd({matchUpId:u.matchUpId,drawDefinition:t,inContextDrawMatchUps:o}),{targetMatchUps:{winnerMatchUp:f}}=p;if(l){const e=i.drawPositions||[];let n=u.drawPositions.filter(Boolean);se(e,n)&&(n=n.filter((t=>!e.includes(t))));const r=e.concat(d).find((e=>n.includes(e)));if(f&&r){const e=ol({winnerMatchUp:f,drawDefinition:t,winningDrawPosition:r,matchUpsMap:a,inContextDrawMatchUps:o});if(e.error)return e}}kl({drawDefinition:t,targetData:p,structure:r,matchUp:u,matchUpsMap:a,inContextDrawMatchUps:o});let m=[O,P].includes(null==n?void 0:n.matchUpStatus)&&c?O:R;const h=!c;let v=rl({...e,matchUpStatus:m,removeScore:h,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:n,matchUpId:u.matchUpId});if(v.error)return v}return{...de}}function Fl({score:e}={}){const{sets:t,scoreStringSide1:n,scoreStringSide2:r}=e||{};return!!e&&(!(!n&&!r)||!(null==t||!t.length)&&Object.values(t[0]).some((e=>e)))}function jl(e){const{matchUp:t,matchUpStatus:n,score:r,winningSide:i}=e;if((null==t?void 0:t.matchUpStatus)===P&&n!==P){const t=kl(e);if(t.error)return t}const a=n===P,o=Fl({score:r})&&!a&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!i),s=![M,y].includes(n||M),c=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||t.winningSide&&!i&&!Fl({score:r}),u=n&&n!==R,d=({removeScore:n}={})=>{let r;const{structure:i,drawDefinition:a}=e,{connectedStructureIds:o}=Sl({drawDefinition:a,structure:i,matchUp:t});o.length&&(console.log({connectedStructureIds:o}),r=!0),Object.assign(e,{removeScore:n});const s=al(e);return s.error?s:{...de,connectedStructures:r}};return i&&function(e){const{drawDefinition:t,winningSide:n,structure:r,matchUp:i}=e;let a;if(i.winningSide&&i.winningSide!==n){const{connectedStructureIds:n}=Sl({drawDefinition:t,structure:r,matchUp:i});n.length&&(console.log({connectedStructureIds:n}),a=!0);const o=al(e);if(o.error)return o}const o=Ll(e);return o.error?o:{...de,connectedStructures:a}}(e)||o&&d({removeScore:s})||u&&gl(e)||c&&d()||t&&function(e){var t;const n=Boolean(e.matchUp.collectionId),r=e.isCollectionMatchUp&&(null===(t=e.dualMatchUp)||void 0===t?void 0:t.winningSide)&&e.projectedWinningSide,i=rl({...e,removeScore:!0});if(n){const{matchUpTieId:t,drawDefinition:n,structure:i,event:a}=e,{removeWinningSide:o}=il({matchUpId:t,drawDefinition:n,structure:i,event:a});console.log("ndd",{removeWinningSide:o,removeDirected:r})}return i}({...e,removeScore:!0})||console.log("unknown condition")&&{...de}}function _l(e){const{inContextDrawMatchUps:t,targetData:n,drawDefinition:r}=e,{targetMatchUps:{loserMatchUp:i,winnerMatchUp:a}}=n,o=(null==a?void 0:a.drawPositions.filter(Boolean).length)||0;if(null!=i&&i.winningSide||2===o&&null!=a&&a.winningSide)return!0;let s=i&&nd({matchUpId:i.matchUpId,drawDefinition:r,inContextDrawMatchUps:t}),c=a&&nd({matchUpId:a.matchUpId,drawDefinition:r,inContextDrawMatchUps:t});const u=s&&_l({inContextDrawMatchUps:t,drawDefinition:r,targetData:s});return!(!(c&&_l({inContextDrawMatchUps:t,drawDefinition:r,targetData:c}))&&!u)}function Bl(e){var t;const{allowChangePropagation:n,tournamentRecord:r,drawDefinition:i,matchUpStatus:a,winningSide:o,matchUpId:s,event:c}=e;if(!i)return{error:Ie};if([U,M,y,R].includes(a)&&o)return{error:jn,winningSide:o,matchUpStatus:a};if(![void 0,...L].includes(a))return{error:at};const u=kc({drawDefinition:i});let{matchUps:d}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:u});!!d.find((({winnerMatchUpId:e,loserMatchUpId:t})=>e||t))||({inContextDrawMatchUps:d}=wd({inContextDrawMatchUps:d,drawDefinition:i,matchUpsMap:u}));const l=u.drawMatchUps.find((e=>e.matchUpId===s)),p=d.find((e=>e.matchUpId===s));if(!l||!d)return{error:ft};if((l.winningSide||o)&&a===w)return{error:it,matchUpStatus:a};const f=null===(t=p.drawPositions)||void 0===t?void 0:t.filter(Boolean);if(a&&x.includes(a)&&(!f||(null==f?void 0:f.length)<2))return{error:at};if(l.matchUpType===la)return{error:"DIRECT SCORING of TEAM matchUp not implemented"};const m=p.matchUpTieId,h=nd({matchUpId:m||s,inContextDrawMatchUps:d,drawDefinition:i}),v=p.structureId,{structure:g}=_c({drawDefinition:i,structureId:v});let I;if(Object.assign(e,{inContextDrawMatchUps:d,inContextMatchUp:p,matchUpTieId:m,matchUpsMap:u,targetData:h,structure:g,matchUp:l}),m){const{matchUp:t}=xu({matchUpId:m,inContext:!0,drawDefinition:i,matchUpsMap:u,event:c}),n=t.tieFormat||i.tieFormat,{projectedWinningSide:r}=function({drawDefinition:e,winningSide:t,dualMatchUp:n,tieFormat:r,structure:i,matchUp:a,event:o}){const s=a.winningSide;let c=[0,0];1===t&&2===s?c=[1,-1]:2===t&&1===s?c=[-1,1]:t&&!s?c=1===t?[1,0]:[0,1]:s&&!t&&(c=1===s?[-1,0]:[0,-1]),r=r||(null==a?void 0:a.tieFormat)||(null==i?void 0:i.tieFormat)||(null==e?void 0:e.tieFormat)||(null==o?void 0:o.tieFormat);const{winningSide:u}=Ra({matchUp:n,sideAdjustments:c,tieFormat:r});return{projectedWinningSide:u}}({winningSide:o,dualMatchUp:t,tieFormat:n,structure:g,matchUp:l,event:c});I=r!==t.winningSide,Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:I,projectedWinningSide:r,matchUpTieId:m,dualMatchUp:t,tieFormat:n})}const b=_l(e),S=qd({matchUpStatus:a});if(!m){if(b&&!o&&Hd({matchUpStatus:a}))return{error:it,activeDownstream:b,winningSide:o};if(o&&o===l.winningSide&&a&&!S)return{error:it,directingMatchUpStatus:S,matchUpStatus:a}}const{schedule:D}=e;if(D){const e=Hu({tournamentRecord:r,disableNotice:!0,drawDefinition:i,matchUpId:s,schedule:D});if(e.error)return e}const N=l.matchUpType!==la&&!I&&o&&l.winningSide&&l.winningSide!==o;if(n&&N&&l.roundPosition)return function(e){var t;const{inContextMatchUp:n,structure:r,drawDefinition:i}=e,a=n.roundNumber,o=n.sides.find((e=>e.sideNumber===n.winningSide)),s=n.sides.find((e=>e.sideNumber!==n.winningSide)),{drawPosition:c,participantId:u}=o,{drawPosition:d,participantId:l}=s,{matchUps:p}=Ou(e),f=p.filter((({drawPositions:e,roundNumber:t})=>e.includes(c)&&t>a));Xn({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach((e=>{e.drawPositions=e.drawPositions.map((e=>e===c?d:e)),Sc({drawDefinition:i,matchUp:e})}));const{stage:m,stageSequence:h}=r,v=i.structures.filter((({stage:e,stageSequence:t})=>e===m&&t>h)).map((({structureId:e})=>e)),{targetLinks:{loserTargetLink:g,winnerTargetLink:I}}=e.targetData,y=[null==g?void 0:g.target.structureId,null==I||null===(t=I.target)||void 0===t?void 0:t.structureId].filter(Boolean);return i.structures.filter((({stage:e,structureId:t})=>e!==m&&y.includes(t))).forEach((({stage:e,stageSequence:t,structureId:n})=>{v.includes(n)||v.push(n),i.structures.filter((({stage:n,stageSequence:r})=>n===e&&r>t)).forEach((({structureId:e})=>{v.includes(e)||v.push(e)}))})),i.structures.filter((({structureId:e})=>v.includes(e))).forEach((e=>{const{positionAssignments:t}=Pu({structure:e}),n=t.find((({participantId:e})=>e===u)),r=t.find((({participantId:e})=>e===l));n&&(n.participantId=l),r&&(r.participantId=u)})),rl(e)}(e);const P=o&&!m||e.projectedWinningSide;return!b&&jl(e)||P&&function(e){const{matchUp:t,winningSide:n,matchUpTieId:r,dualWinningSideChange:i}=e;return n===t.winningSide||r&&!i?Gl(e):{error:Bt}}(e)||S&&Gl(e)||{error:Bn}}function Gl(e){const{matchUp:t,event:n}=e,r=e.isCollectionMatchUp&&t.winningSide&&!e.winningSide&&!Fl({score:e.score}),i=e.isCollectionMatchUp?e.machUpStatus||r&&R:e.matchUpStatus||S,a=[U,O].includes(i)&&![M,y].includes(i),o=rl({...e,matchUpStatus:i,removeWinningSide:r,removeScore:a});if(e.isCollectionMatchUp){const{matchUpTieId:t,drawDefinition:r,structure:i}=e,{removeWinningSide:a}=il({matchUpId:t,drawDefinition:r,structure:i,event:n});console.log("sms",{removeWinningSide:a})}return o}function Vl(e){const{drawDefinition:t,event:n,matchUpFormat:r,structureId:i,matchUpId:a}=e;let{tieFormat:o}=e;if(!t)return{error:Ie};if(!r&&!o)return{error:ct};if(r&&!g(r))return{error:rt};if(o){const e=function(e){const t=Ba({tieFormat:e,checkCollectionIds:!1});if(t.error)return t;for(const n of e.collectionDefinitions)n.collectionId||(n.collectionId=Wr());return{tieFormat:e}}(o);if(e.error)return e;o=e.tieFormat}if(a){const{matchUp:e,error:i}=xu({drawDefinition:t,matchUpId:a,event:n});if(i)return{error:i};if(r&&e.matchUpType!==xa)e.matchUpFormat=r;else{if(!o||e.matchUpType!==xa)return{error:jn};e.tieFormat=o}Sc({drawDefinition:t,matchUp:e})}else if(i){const{structure:e,error:n}=_c({drawDefinition:t,structureId:i});if(n)return{error:n};if(!e)return{error:Ve};r&&e.matchUpType!==xa?e.matchUpFormat=r:o&&(e.tieFormat=o)}else t&&(r?t.matchUpFormat=r:o&&(t.tieFormat=o));return Nc({drawDefinition:t,structureIds:i?[i]:void 0}),{...de,tieFormat:o}}function ql({score:e,winningSide:t,matchUpStatus:n}={}){if(!e)return{sets:[]};const r=e.sets||[];let i=Ao({winnerFirst:!1,matchUpStatus:n,sets:r}),a=Ao({winnerFirst:!1,matchUpStatus:n,reversed:!0,sets:r}),o=Ao({winningSide:t,matchUpStatus:n,sets:r}),s=i===o?a:i;return t&&(i=1===t?o:s,a=2===t?o:s),{score:{sets:r,scoreStringSide1:i,scoreStringSide2:a}}}function Hl(e){var t;const{tournamentRecord:n,drawDefinition:r,matchUpFormat:i,matchUpId:a,schedule:o,event:s,notes:c}=e;if(!r)return{error:Re};if(!a)return{error:lt};const{policy:u}=ta({policyType:si,tournamentRecord:n,event:s}),d=void 0!==e.allowChangePropagation?e.allowChangePropagation:void 0!==(null==u?void 0:u.allowChangePropagation)?u.allowChangePropagation:void 0;let{outcome:l}=e;if(i){const e=Vl({drawDefinition:r,matchUpFormat:i,matchUpId:a,event:s});if(e.error)return e}if(null!=l&&null!==(t=l.score)&&void 0!==t&&t.sets&&!l.score.scoreStringSide1){const{score:e}=ql(l);l.score=e,l.score.sets=l.score.sets.filter((e=>e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore))}return Bl({tournamentRecord:n,drawDefinition:r,event:s,matchUpStatusCodes:null==l?void 0:l.matchUpStatusCodes,matchUpStatus:null==l?void 0:l.matchUpStatus,matchUpFormat:i,matchUpId:a,winningSide:null==l?void 0:l.winningSide,allowChangePropagation:d,score:null==l?void 0:l.score,schedule:o,notes:c})}function Wl(e){if(!e.tournamentRecord)return{error:me};const{tournamentRecord:t,outcomes:n}=e,r={};n.forEach((e=>{const{eventId:t}=e;r[t]||(r[t]=[]),r[t].push(e)}));for(const i of Object.keys(r)){const{event:e}=ya({tournamentRecord:t,eventId:i});for(const n of r[i]){const{drawId:r}=n,i=e.drawDefinitions.find((e=>e.drawId===r));if(i){const{matchUpFormat:a,matchUpId:o}=n,s=Hl({tournamentRecord:t,drawDefinition:i,event:e,drawId:r,matchUpFormat:a,matchUpId:o,schedule:null==n?void 0:n.schedule,outcome:n});if(s.error)return s}}}return de}function zl({tournamentRecord:e}){if(!e)return{error:me};const t=e.tournamentId,{extension:n}=aa({tournamentRecord:e,name:Yi});let r=(null==n?void 0:n.value)||[];if(r.length){const n=e.venues.map((({venueId:e,courts:t})=>(null==t?void 0:t.length)&&e)),{eventIds:i,drawIds:a}=gd({tournamentRecords:{[t]:e}}),{updatedSchedulingProfile:o,modifications:s,issues:c}=Ld({schedulingProfile:r,venueIds:n,eventIds:i,drawIds:a});if(s){r=o;const t=function({tournamentRecord:e,schedulingProfile:t}){return Hc({tournamentRecord:e,extension:{name:Yi,value:t}})}({tournamentRecord:e,schedulingProfile:r});return t.error?t:{schedulingProfile:r,modifications:s,issues:c}}}return{schedulingProfile:r,modifications:0}}function Kl({tournamentRecord:e,schedulingProfile:t,requireCourts:n=!0}){if(!t){const{modifications:t,issues:n}=zl({tournamentRecord:e});return{success:!t,modifications:t,issues:n}}const{venueIds:r,eventIds:i,drawIds:a}=Dd({tournamentRecord:e,requireCourts:n}),{modifications:o,issues:s}=Ld({schedulingProfile:t,venueIds:r,eventIds:i,drawIds:a});return{success:!o,modifications:o,issues:s}}function Yl({tournamentRecord:e,courtId:t,scheduleVisibilityFilters:n,matchUpFilters:r}){if(!e)return{error:me};if(!t)return{error:At};const{schedulingProfile:i}=zl({tournamentRecord:e}),{matchUps:a}=ud({tournamentRecord:e,scheduleVisibilityFilters:n,matchUpFilters:r});return{matchUps:function({matchUps:e,courtId:t}){return Fd({matchUps:e.filter((e=>{var n;return(null===(n=e.schedule)||void 0===n?void 0:n.courtId)===t})),schedulingProfile:i})}({matchUps:a,courtId:t})}}function $l({matchUpsCount:e=0}){const t=`Schedule would be deleted from ${e} ${1===e?"matchUp":"matchUps"}; use { force: true }`;return{message:t,error:t}}function Jl({startTime:e,endTime:t}={}){if(!gr.test(e)||!gr.test(t))return!1;const[n,r]=e.split(":"),[i,a]=t.split(":");return!(i<n)&&!(n===i&&a<r)}function Zl({dateAvailability:e}){if(!e)return{error:Ot};if(!Array.isArray(e))return{error:Rt};const t="Times must be 24 hour => 00:00";for(const n of e){if("object"!=typeof n)return{error:Rt};const{date:e,startTime:r,endTime:i,bookings:a=[]}=n;if(!r||!i)return{error:Rt};if(e&&!vr.test(e))return{error:xt,dateAvailability:{date:e},message:"Dates must be formated => YYYY-MM-DD"};if(!gr.test(r))return{error:Lt,dateAvailability:{startTime:r},message:t};if(!gr.test(i))return{error:Lt,dateAvailability:{endTime:i},message:t};if(r===i)return{error:Lt,dateAvailability:{startTime:r,endTime:i},message:"startTime and endTime are equivalent"};if(!Jl({startTime:r,endTime:i}))return{error:Lt,dateAvailability:{startTime:r,endTime:i},message:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:Ct};for(const e of a){if("object"!=typeof e)return{error:Ct};const{startTime:n,endTime:r}=e;if(!gr.test(n))return{error:Lt,booking:{startTime:n},message:t};if(!gr.test(r))return{error:Lt,booking:{endTime:r},message:t};if(n===r)return{error:Lt,dateAvailability:{startTime:n,endTime:r},message:"startTime and endTime are equivalent"};if(!Jl({startTime:n,endTime:r}))return{error:Lt,dateAvailability:{startTime:n,endTime:r},message:"endTime must be after startTime"}}}}return{valid:!0}}function Ql({tournamentRecord:e,dateAvailability:t,disableNotice:n,courtId:r,force:i}){if(!e)return{error:me};if(!r)return{error:At};const a=Zl({dateAvailability:t});if(a.error)return a;const{court:o,venue:s,error:c}=_u({tournamentRecord:e,courtId:r});return c?{error:c}:(o.dateAvailability=t,n||nr({topic:gc,payload:{venue:s},key:s.venueId}),de)}function Xl({tournamentRecord:e,modifications:t,disableNotice:n,courtId:r,force:i}){if(!e)return{error:me};if(!r)return{error:At};if(!t||"object"!=typeof t)return{error:Fn};const{court:a,venue:o,error:s}=_u({tournamentRecord:e,courtId:r});if(s)return{error:s};const c=Object.keys({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}).filter((e=>"courtId"!==e));if(!Object.keys(t).filter((e=>c.includes(e))).length)return{error:Gn};const u=c.filter((e=>!["dateAvailability"].includes(e)));if(Object.keys(t).filter((e=>u.includes(e))).forEach((e=>Object.assign(a,{[e]:t[e]}))),t.dateAvailability){const a=Ql({tournamentRecord:e,dateAvailability:t.dateAvailability,disableNotice:n,courtId:r,force:i});if(a.error)return a}return n||nr({topic:gc,payload:{venue:o},key:o.venueId}),{...de,court:Gr(a)}}function ep({tournamentRecord:e,disableNotice:t,returnDetails:n,venueId:r,court:i}){const{venue:a}=Fu({tournamentRecord:e,venueId:r});if(!a)return{error:wn};a.courts||(a.courts=[]);const o={altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0,venueId:r};o.courtId||(o.courtId=Wr());if(a.courts.reduce(((e,t)=>e||t.courtId===o.courtId),void 0))return{error:yn};{const e=((null==i?void 0:i.dateAvailability)||[]).map((e=>{var t;return{...e,date:Cr(e.date),startTime:Er(e.startTime),endTime:Er(e.endTime),bookings:null===(t=e.bookings)||void 0===t?void 0:t.map((({startTime:e,endTime:t,bookingType:n})=>({startTime:Er(e),endTime:Er(t),bookingType:n})))}}));for(const t of Object.keys(o))if(i[t])if("dateAvailability"===t){const t=Zl({dateAvailability:e}),{valid:n,error:r}=t;if(n)o.dateAvailability=e;else if(r)return{error:r}}else o[t]=i[t];return a.courts.push(o),t||nr({topic:gc,payload:{venue:a},key:a.venueId}),Xn()||n?{...de,court:Gr(o),venueId:r}:{...de}}}function tp({dateAvailability:e=[],tournamentRecord:t,courtNames:n=[],courtsCount:r,venueId:i}){if(!i)return{error:Un};if(!z(r)||!n)return{error:gn};const a=ie(0,r=r||n.length).map((t=>({courtName:n[t]||`Court ${t+1}`,dateAvailability:e}))).map((e=>ep({tournamentRecord:t,venueId:i,court:e,disableNotice:!0,returnDetails:!0}))),o=a.map((e=>e.court)).filter(Boolean);if(o.length===r){const{venue:e}=Fu({tournamentRecord:t,venueId:i});return nr({topic:gc,payload:{venue:e},key:e.venueId}),{...de,courts:Gr(o)}}return Object.assign({},{courts:Gr(o)},{error:a})}function np({tournamentRecord:e,modifications:t,venueId:n,force:r}){var i,a;if(!e)return{error:me};if(!t||"object"!=typeof t)return{error:Fn};if(!n)return{error:Un};const{venue:o,error:s}=Fu({tournamentRecord:e,venueId:n});if(s)return{error:s};const c=Object.keys({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}).filter((e=>"venueId"!==e));if(!Object.keys(t).filter((e=>c.includes(e))).length)return{error:Gn};const u=c.filter((e=>!["courts"].includes(e)));Object.keys(t).filter((e=>u.includes(e))).forEach((e=>Object.assign(o,{[e]:t[e]})));const d=(null==o||null===(i=o.courts)||void 0===i?void 0:i.map((e=>e.courtId)))||[],l=(null===(a=t.courts)||void 0===a?void 0:a.map((e=>e.courtId)))||[],p=d.filter((e=>!l.includes(e)));if(p.length){const t=o.courts.filter((e=>p.includes(e.courtId))).map((t=>{const{matchUps:n}=Yl({tournamentRecord:e,courtId:t.courtId});return n.length})).reduce(((e,t)=>e+t));if(t&&!r){return{error:$l({matchUpsCount:t})}}o.courts=o.courts.filter((e=>l.includes(e.courtId)))}if(t.courts)for(const f of t.courts){const{courtId:t}=f||{};let i=Xl({tournamentRecord:e,modifications:f,disableNotice:!0,courtId:t,force:r});if(i.error===In&&(i=ep({tournamentRecord:e,venueId:n,court:f,disableNotice:!0})),i.error)return i}return Kl({tournamentRecord:e}),nr({topic:gc,payload:{venue:o},key:o.venueId}),{...de,venue:Gr(o)}}function rp({tournamentRecord:e,drawDefinition:t,drawId:n,matchUpId:r}){if(!r)return{error:lt};if(!t&&!n)return{error:Re};let i;if(!t){if(!e)return{error:me};({drawDefinition:t}=ya({tournamentRecord:e,drawId:n}))}if(t)({matchUp:i}=xu({drawDefinition:t,matchUpId:r}));else{if(!e)return{error:me};const{matchUps:t}=pd({tournamentRecord:e});({matchUp:i}=Ca({matchUps:t,matchUpId:r}))}if(!i)return{error:ft};if(i.timeItems){if(i.timeItems.reduce(((e,t)=>t.itemType===fi||e),void 0)){const e={itemType:fi,itemValue:"",itemDate:""};i.timeItems.push(e),Sc({drawDefinition:t,matchUp:i})}}return de}function ip({tournamentRecord:e,venueId:t,force:n}){if(!e)return{error:me};if("string"!=typeof t)return{error:Un};const{courts:r}=Bu({tournamentRecord:e,venueId:t}),i={courtIds:r.map((e=>e.courtId))},{matchUps:a}=ud({tournamentRecord:e,contextFilters:i});if(a.length&&!n)return $l({matchUpsCount:a.length});for(const s of a){const t=rp({tournamentRecord:e,drawId:s.drawId,matchUpId:s.matchUpId});if(t.error)return t}let o;return e.venues=(e.venues||[]).filter((e=>{if(e.venueId!==t)return!0;o=!0})),o&&nr({topic:pc,payload:{venueId:t}}),de}function ap({flight:e,checkEntryStatus:t=!0,modifyEventEntries:n,existingDrawCount:r,drawDefinition:i,event:a}){var o,s,c,u,d;if(!i)return{error:Re};if(!a)return{error:ze};a.drawDefinitions||(a.drawDefinitions=[]);const{drawId:l,drawName:p,entries:f}=i,{entries:m}=a;let h=0;if(void 0!==r&&r!==a.drawDefinitions.length)return{error:jn,message:"drawDefintions count mismatch"};if(!!a.drawDefinitions.find((e=>e.drawId===l)))return{error:Oe};const{flightProfile:v}=tl({event:a}),g=e&&(null==v||null===(o=v.flights)||void 0===o?void 0:o.find((t=>t.flightNumber===e.flightNumber)));if(g&&g.drawId!==i.drawId)return{error:ge,relevantFlight:g};const I=null==g?void 0:g.drawEntries.every((({participantId:e,entryStatus:t})=>{const n=f.find((t=>t&&t.participantId===e));return(null==n?void 0:n.entryStatus)===t})),y=!t||m&&(null==f?void 0:f.every((({participantId:e,entryStatus:t})=>{const n=m.find((t=>t.participantId===e));return(null==n?void 0:n.entryStatus)===t})));if(g&&!I)return{error:ge,relevantFlight:g,matchingEventEntries:y};if(n&&f.filter(Boolean).forEach((e=>{if(du.includes(null==e?void 0:e.entryStatus)){const t=m.filter(Boolean).find((t=>t.participantId===e.participantId));e.entryStatus&&t.entryStatus!==e.entryStatus&&(t.entryStatus=e.entryStatus,h+=1)}})),m&&!y)return{error:ge,eventEntries:m,matchingEventEntries:y};const b=(null==v||null===(s=v.flights)||void 0===s||null===(c=s.map((({flightNumber:e})=>!isNaN(e)&&parseInt(e))))||void 0===c?void 0:c.filter(Boolean))||[],w=(null===(u=a.drawDefinitions.map((({drawOrder:e})=>!isNaN(e)&&parseInt(e))))||void 0===u?void 0:u.filter(Boolean))||[];let U=Math.max(0,...w,...b)+1;const S=null==v||null===(d=v.flights)||void 0===d?void 0:d.find((e=>e.drawId===l));let D;if(S){S.drawName=i.drawName,D={name:Bi,value:{...v,flights:v.flights}};const e=S.flightNumber;e&&!w.includes(e)?U=e:S.flightNumber=U}else{const e=(null==v?void 0:v.flights)||[];e.push({manuallyAdded:!0,flightNumber:U,drawEntries:f,drawName:p,drawId:l}),D={name:Bi,value:{...v||{},flights:e}}}zc({event:a,extension:D}),Object.assign(i,{drawOrder:U}),a.drawDefinitions.push(i);const{topics:N}=ar();if(N.includes(oc)){const{matchUps:e}=dd({drawDefinition:i,event:a});wc({drawDefinition:i,matchUps:e})}return Dc({drawDefinition:i}),{...de,modifiedEventEntryStatusCount:h}}function op({tournamentRecord:e,returnDetails:t,disableNotice:n,venue:r}){if(!e)return{error:me};if(!r)return{error:Mt};e.venues||(e.venues=[]),r.venueId||(r.venueId=Wr());return e.venues.reduce(((e,t)=>e||t.venueId===r.venueId),void 0)?{error:bn}:(e.venues.push(r),n||nr({topic:cc,payload:{venue:r}}),Xn({addVenue:!0})?{...de,venue:Gr(r)}:t?r:{...de})}function sp({allowDuplicateParticipantIdPairs:e,tournamentRecord:t,disableNotice:n,pairOverride:r,participant:i}){if(!t)return{error:me};if(!i)return{error:zt};i.participantId||(i.participantId=Wr()),t.participants||(t.participants=[]);const{participantId:a}=i;if(t.participants.reduce(((e,t)=>t.participantId===a||e),!1))return{error:Jt};const{participantType:o,participantRole:s}=i;if(!Object.keys(Fa).includes(o))return{error:Ht,participantType:o};if(!s)return{error:Wt};const c=t.participants||[],u=c.filter((e=>e.participantType===Oa)).map((e=>e.participantId));if(o===La){if(i.person)return{error:jn,person:i.person};if(!i.individualParticipantIds)return{error:Qt};if(2!==i.individualParticipantIds.length&&!r)return{error:qt,message:"PAIR must be 2 individualParticipantIds"};{const e=c.filter((e=>e.participantType===Oa)).map((e=>e.participantId));if(!Array.isArray(i.individualParticipantIds))return{error:qt};if(!i.individualParticipantIds.reduce(((t,n)=>e.includes(n)&&t),!0))return{error:qt}}const t=c.filter((e=>e.participantType===La)).map((e=>({participant:e,individualParticipantIds:e.individualParticipantIds}))),n=i.participantType===La&&t.find((e=>2===oe(e.individualParticipantIds,i.individualParticipantIds).length));if(n&&!e)return{...de,participant:Gr(n.participant)};if(!i.participantName){const e=c.filter((e=>i.individualParticipantIds.includes(e.participantId)));let t=e.map((e=>{var t;return null===(t=e.person)||void 0===t?void 0:t.standardFamilyName})).filter(Boolean).join("/");1===e.length&&(t+="/Unknown"),i.participantName=t}}else if(o===Oa){if(!i.person||!i.person.standardFamilyName||!i.person.standardGivenName)return{error:rn};if(!i.participantName){const e=`${i.person.standardFamilyName.toUpperCase()}, ${i.person.standardGivenName}`;i.participantName=e,i.name=e}}else{if(i.person)return{error:jn,person:i.person};const{individualParticipantIds:e}=i;if(null!=e&&e.length)for(const t of e){if("string"!=typeof t)return{error:jn,participantId:t};if(!u.includes(t))return{error:$t,participantId:t}}}t.participants.push(i),n||nr({topic:sc,payload:{participants:[i]}});return{...de,participant:Gr(i)}}function cp({tournamentRecord:e,participants:t=[],allowDuplicateParticipantIdPairs:n}){if(!e)return{error:me};e.participants||(e.participants=[]);const r=e.participants.map((e=>e.participantId))||[];t.forEach((e=>{e.participantId||(e.participantId=Wr())}));const i=t.filter((e=>!r.includes(e.participantId))),a=t.filter((e=>r.includes(e.participantId))),o=i.filter((e=>e.participantType===Oa)),s=i.filter((e=>e.participantType!==Oa)),c=o.concat(...s);if(c.length){const t=[];for(const i of c){const r=sp({tournamentRecord:e,participant:i,disableNotice:!0,allowDuplicateParticipantIdPairs:n}),{success:a,error:o,participant:s}=r;if(a&&t.push(s),o)return{error:o}}nr({topic:sc,payload:{participants:t}});const r={...de,participants:Gr(t)};return a.length&&Object.assign(r,{notAdded:a,message:on}),r}return{...de,message:"No new participants to add"}}const up=({scheduleAttributes:e=["scheduledDate","scheduledTime"],schedule:t})=>!!Object.keys(t).filter((t=>e.includes(t))).filter((e=>t[e])).length;function dp({matchUps:e=[],scheduleAttributes:t=["scheduledDate","scheduledTime"]}){if(!Array.isArray(e))return{error:mt};if(!Array.isArray(t))return{error:jn};const n=e.filter((({schedule:e})=>up({schedule:e,scheduleAttributes:t}))).reduce(((e,t)=>{const{schedule:n}=t,r=Cr(null==n?void 0:n.scheduledDate),i=Er(null==n?void 0:n.scheduledTime);return r&&i&&(e[r]?e[r].push(t):e[r]=[t]),e}),{});return Object.keys(n).forEach((e=>{n[e].sort(((e,t)=>{var n,r;return function(e,t){const n=Or(e),r=Or(t);if(parseInt(n.hours)<parseInt(r.hours))return-1;if(parseInt(n.hours)>parseInt(r.hours))return 1;if(n.hours===r.hours){if(parseInt(n.minutes)<parseInt(r.minutes))return-1;if(parseInt(n.minutes)>parseInt(r.minutes))return 1}return 0}(Er(null===(n=e.schedule)||void 0===n?void 0:n.scheduledTime),Er(null===(r=t.schedule)||void 0===r?void 0:r.scheduledTime))}))})),{scheduledMatchUps:n}}var lp,pp="SIGN_IN_STATUS";!function(e){e.INDIVIDUAL="INDIVIDUAL",e.PAIR="PAIR",e.TEAM="TEAM"}(lp||(lp={}));var fp,mp=lp.INDIVIDUAL,hp=lp.PAIR,vp=lp.TEAM;!function(e){e.SIGNED_IN="SIGNED_IN",e.SIGNED_OUT="SIGNED_OUT"}(fp||(fp={}));var gp=fp.SIGNED_IN,Ip=fp.SIGNED_OUT,yp={INDIVIDUAL:mp,PAIR:hp,TEAM:vp,SIGNED_IN:gp,SIGNED_OUT:Ip,SIGN_IN_STATUS:pp};function bp(e){var t,n;const r=[],i={},{tournamentRecord:a,participantFilters:o}=e,s=(null==a?void 0:a.participants)||[],{relevantParticipantIdsMap:c}=function({tournamentRecord:e,tournamentRecords:t,processParticipantId:n}){if("object"!=typeof e&&"object"!=typeof t)return{error:me};const r=t?Object.values(t).map((({participants:e=[]})=>e)).flat():e.participants||[];return{relevantParticipantIdsMap:Object.assign({},...r.map((({participantId:e,participantType:t,individualParticipantIds:r})=>("function"==typeof n&&n(e),{[e]:(r||[]).map((e=>({relevantParticipantId:e,participantType:mp}))).concat({relevantParticipantId:e,participantType:t})}))))}}({processParticipantId:e=>{i[e]||(i[e]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},draws:{},losses:0,wins:0})},tournamentRecord:a}),u=null==o?void 0:o.participantIds,d=e=>{const t=e&&c[e]||[];return t.some((e=>!u||u.includes(e.relevantParticipantId)))?t:[]};return s.forEach((e=>{if(e.participantType===ka){const t=e.participantId;e.individualParticipantIds.forEach((e=>{i[e].groupParticipantIds.includes(t)||i[e].groupParticipantIds.push(t)}))}if(e.participantType===la){const t=e.participantId;e.individualParticipantIds.forEach((e=>{i[e].teamParticipantIds.includes(t)||i[e].teamParticipantIds.push(t)}))}if(e.participantType===La){const t=e.participantId;e.individualParticipantIds.forEach((e=>{i[e].pairParticipantIds.includes(t),i[e].pairParticipantIds.push(t)}))}})),null===(t=e.tournamentEvents)||void 0===t||t.forEach((e=>{var t,n,r;const o=Gr(e,!0,!0),{eventId:s,eventName:u,eventType:l,category:p}=o,f={eventId:s,eventName:u,eventType:l,category:p},m=o&&Object.keys(o).filter((e=>"_"===e[0]));null==m||m.forEach((e=>f[e]=o[e]));const h=o.entries||[],v=[].concat(...Object.values(Zi)).map((e=>`_${e}`)),g=f&&Object.keys(f).filter((e=>!v.includes(e))).reduce(((e,t)=>(e[t]=f[t],e)),{});null==h||h.filter((e=>null==e?void 0:e.participantId)).forEach((e=>{const{participantId:t,entryStage:n,entryStatus:r,entryPosition:a}=e,o=d(t);null==o||o.forEach((({relevantParticipantId:e})=>{i[e].events[s]={...g,partnerParticipantIds:[],entryPosition:a,entryStatus:r,entryStage:n,drawIds:[]}}))}));const I=(null===(t=o.drawDefinitions)||void 0===t?void 0:t.map((({drawId:e})=>e)))||[];null===(n=f._flightProfile)||void 0===n||null===(r=n.flights)||void 0===r||r.forEach((e=>{const{drawId:t,drawEntries:n}=e;I.includes(t)||null==n||n.forEach((e=>(({drawId:e,drawEntry:t,drawName:n,drawType:r})=>{const{participantId:a,entryStage:o,entryStatus:c,entryPosition:u}=t,p=d(a);l===la&&console.log({eventType:l},p),null==p||p.forEach((({relevantParticipantId:t})=>{i[t].events[s]||(i[t].events[s]={...g,partnerParticipantIds:[],entryPosition:u,entryStatus:c,entryStage:o,drawIds:[]}),i[t].draws[e]||(i[t].draws[e]={partnerParticipantIds:[],entryPosition:u,entryStatus:c,entryStage:o,drawName:n,drawType:r,eventId:s,drawId:e});const a=i[t].events[s].drawIds;!a||null!=a&&a.includes(e)||i[t].events[s].drawIds.push(e)}))})({drawId:t,drawEntry:e})))}));const{matchUps:y}=ld({tournamentRecord:a,nextMatchUps:!0,inContext:!0,event:o}),b=Object.assign({},...(o.drawDefinitions||[]).map((e=>{const t=Object.assign({},...h.filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))),...e.entries.filter((e=>e.participantId)).map((e=>({[e.participantId]:e})))),n=Object.values(t);return{[e.drawId]:{drawType:e.drawType,drawEntries:n}}})));null==y||y.forEach((e=>function({matchUp:e,drawDetails:t,eventType:n}){const{drawId:r,drawName:a,eventId:o,eventName:s,finishingPositionRange:u,loserTo:l,matchUpId:p,matchUpType:f,matchUpFormat:m,matchUpStatus:h,roundName:v,roundNumber:g,roundPosition:I,score:y,sides:b,schedule:w,structureName:U,structureId:S,tieFormat:D,tieMatchUps:N,tournamentId:P,winnerTo:A,winningSide:M}=e,{winner:T,loser:E}=u||{},C=(null==N?void 0:N.length)&&N.filter((({matchUpType:e})=>e===da)).map((({sides:e})=>e.map((({sideNumber:e,participantId:t})=>e&&t&&{sideNumber:e,participantId:t})))).flat().filter(Boolean);if(null==b||b.forEach((({participantId:u,sideNumber:N}={})=>{if(!u)return;const{drawType:R,drawEntries:O}=t[r],x=1===N?null==y?void 0:y.scoreStringSide1:null==y?void 0:y.scoreStringSide2,L=M&&N===M,k=e.sides.find((({sideNumber:e}={})=>e===3-N)),F=null==k?void 0:k.participantId,j=F&&c[F]||[],_=M&&(L?T:E),B=O.find((e=>e.participantId===u)),G=d(u).filter((e=>n!==la||n===la&&f===da||e.participantType!==La));null==C||C.filter((e=>e.sideNumber===N)).forEach((({participantId:e})=>{e&&!G.includes(e)&&G.push({relevantParticipantId:e,participantType:La})})),null==G||G.forEach((({relevantParticipantId:e,participantType:t})=>{const{entryStage:c,entryStatus:u,entryPosition:d}=B||{};i[e].draws[r]||(i[e].draws[r]={partnerParticipantIds:[],entryPosition:d,entryStatus:u,entryStage:c,drawName:a,drawType:R,eventId:o,drawId:r}),i[e].events[o]||(i[e].events[o]={partnerParticipantIds:[],drawIds:[],eventName:s,eventId:o});const N=i[e].events[o].drawIds;let T;if(!N||null!=N&&N.includes(r)||i[e].events[o].drawIds.push(r),t===Oa&&f===da){const t=G.find((t=>t.relevantParticipantId!==e&&t.participantType===Oa));T=null==t?void 0:t.relevantParticipantId}null==j||j.filter((e=>t===Oa||e.participantType===t)).forEach((({relevantParticipantId:t,participantType:n})=>{i[e].opponents[t]?i[e].opponents[t].push({eventId:o,drawId:r,matchUpId:p,participantType:n,participantId:t}):i[e].opponents[t]=[{eventId:o,drawId:r,matchUpId:p,participantType:n,participantId:t}]}));const E=j.map((({relevantParticipantId:e,participantType:t})=>({participantId:e,participantType:t})));i[e].matchUps[p]=Vr({drawId:r,eventId:o,eventType:n,finishingPositionRange:_,loserTo:l,matchUpId:p,matchUpType:f,matchUpFormat:m,matchUpStatus:h,opponentParticipantInfo:E,participantWon:L,partnerParticipantId:T,perspectiveScoreString:x,roundName:v,roundNumber:g,roundPosition:I,schedule:w,score:y,sides:b,structureName:U,structureId:S,tieFormat:D,tournamentId:P,winnerTo:A,winningSide:M}),T&&(i[e].events[o].partnerParticipantIds.push(T),i[e].draws[r].partnerParticipantIds.push(T),i[e].events[o].partnerParticipantId=T,i[e].draws[r].partnerParticipantId=T),M&&(L?i[e].wins++:i[e].losses++)}))})),Array.isArray(e.potentialParticipants)){const t=Ec(e.potentialParticipants.flat());null==t||t.forEach((e=>{const t=d(e);null==t||t.forEach((({relevantParticipantId:e})=>{i[e].potentialMatchUps[p]=Vr({drawId:r,eventId:o,eventType:n,matchUpId:p,matchUpType:f,matchUpFormat:m,roundName:v,roundNumber:g,roundPosition:I,schedule:w,tieFormat:D,structureName:U,potential:!0})}))}))}}({matchUp:e,drawDetails:b,eventType:l})))})),null===(n=e.tournamentParticipants)||void 0===n||n.forEach((t=>{const{scheduleConflicts:n,scheduleItems:a}=function({withDraws:e=!0,withEvents:t=!0,withOpponents:n,withMatchUps:r,withStatistics:i,scheduleAnalysis:a,participant:o,participantIdMap:s}){const c=[],u=[],d=null==o?void 0:o.participantId;if(!d||!s[d])return{};const{wins:l,losses:p,matchUps:f,potentialMatchUps:m,events:h,draws:v,opponents:g}=s[d],I=l,y=l+p,b={statCode:"winRatio",numerator:I,denominator:y,statValue:y&&I/y},U=Object.values(v),S=Object.values(h);e&&U&&(o.draws=U),t&&S&&(o.events=S);const D=Object.values(g).flat();n&&null!=D&&D.length&&(o.opponents=D,null==U||U.forEach((e=>{e.opponents=D.filter((t=>t.drawId===e.drawId))})));const N=Object.values(m),P=Object.values(f);r&&(o.potentialMatchUps=N,o.matchUps=P);const A=P.concat(N),{scheduledMatchUps:M}=dp({matchUps:A}),{scheduledMinutesDifference:T}=a||{};Object.keys(M).forEach((e=>{M[e].forEach(((t,n)=>{const{schedule:{scheduledTime:r,timeAfterRecovery:i,typeChangeTimeAfterRecovery:a},matchUpStatus:o,matchUpId:s,roundNumber:d,roundPosition:l,structureName:p,matchUpType:f,drawId:m}=t;if(c.push({drawId:m,matchUpType:f,matchUpId:s,structureName:p,roundNumber:d,roundPosition:l,...t.schedule,scheduledTime:Er(t.schedule.scheduledTime)}),r&&o!==w){const c=Mr(r),d=M[e].slice(n+1);for(const e of d){var h;if(o!==w&&null!==(h=e.schedule)&&void 0!==h&&h.scheduledTime){const n=t.matchUpType!==e.matchUpType&&a||i,r=t.drawId===e.drawId,o=t.potential&&e.potential,d=Mr(e.schedule.scheduledTime)-c;!(T&&!isNaN(T)?d<=T:Mr(n)>Mr(e.schedule.scheduledTime))||o&&r||u.push({priorScheduledMatchUpId:e.matchUpId,matchUpIdWithConflict:s})}}}}))})),null==U||U.forEach((e=>{const t=f&&P.filter((t=>t.drawId===e.drawId))||[],n=e=>Math.abs(e[0]-e[1]),r=t.reduce(((e,t)=>e?e&&t.finishingPositionRange&&n(e)>n(t.finishingPositionRange)?t.finishingPositionRange:e:t.finishingPositionRange),void 0);e.finishingPositionRange=r})),i&&(o.statistics=[b]);return{scheduleConflicts:u,scheduleItems:c}}({...e,participant:t,participantIdMap:i});e.withScheduleItems&&(t.scheduleItems=a),e.scheduleAnalysis&&(t.scheduleConflicts=n,null!=n&&n.length&&(r.includes(t.participantId)||r.push(t.participantId))),!1!==e.withGroupings&&(t.groupParticipantIds=i[t.participantId].groupParticipantIds,t.pairParticipantIds=i[t.participantId].pairParticipantIds,t.teamParticipantIds=i[t.participantId].teamParticipantIds)})),{participantIdsWithConflicts:r}}function wp({element:e,accessor:t}){if("string"!=typeof t)return{values:[]};const n=Gr(e),r=t.split(".");let i,a=[];!function e({targetElement:t,attributes:n=[],significantCharacters:r}){for(const[i,a]of n.entries())if(t&&t[a])if(Array.isArray(t[a])){const r=t[a],o=n.slice(i);r.forEach((t=>e({targetElement:t,attributes:o})))}else o({targetElement:t=t[a],index:i});function o({targetElement:e,index:t}){if(e&&t===n.length-1&&["string","number"].includes(typeof e)){const t=r?e.slice(0,r):e;i?a.includes(t)||a.push(t):(i=t,a.push(t))}}}({targetElement:n,attributes:r});const o={value:i};return a.length&&(o.values=a),o}function Up({tournamentRecord:e,participantFilters:t,participants:n}){var r,i;let{eventIds:a}=t;const{accessorValues:o,drawEntryStatuses:s,positionedParticipants:c,eventEntryStatuses:u,participantRoles:d,participantRoleResponsibilities:l,participantTypes:p,participantIds:f,signInStatus:m,enableOrFiltering:h}=t,v=Sp(a)&&(null===(r=e.events)||void 0===r?void 0:r.filter((e=>a.includes(e.eventId))))||e.events||[],g=s&&function({drawEntryStatuses:e,tournamentEvents:t}){const n=({entryStatus:t})=>!Array.isArray(e)||e.includes(t);return Q(t.reduce(((e,t)=>{var r,i;const{flightProfile:a}=tl({event:t}),o=(null==a||null===(r=a.flights)||void 0===r?void 0:r.map((({drawEntries:e})=>Array.isArray(e)?e.filter(n).map(Cc):[])).flat())||[],s=(null===(i=t.drawDefinitions)||void 0===i?void 0:i.map((({entries:e})=>e?e.filter(n).map(Cc):[])))||[];return e.concat(...o,...s)}),[]))}({drawEntryStatuses:s,tournamentEvents:v}),I=u&&function({eventEntryStatuses:e,tournamentEvents:t}){return Q(t.reduce(((t,n)=>{const r=(n.entries||[]).filter((({entryStatus:t})=>!Array.isArray(e)||e.includes(t))).map(Cc);return t.concat(...r)}),[]))}({eventEntryStatuses:u,tournamentEvents:v}),y=[!0,!1].includes(c)&&v.reduce(((e,t)=>e.concat(...(t.drawDefinitions||[]).map((e=>function({drawDefinition:e}){return e?(e.structures||[]).map((e=>{const{positionAssignments:t}=Pu({structure:e});return Ec(t)})).flat():{error:Ie}}({drawDefinition:e}))).filter(Boolean))),[]),b=e=>o.reduce(((t,n)=>{const{accessor:r,value:i}=n,{values:a}=wp({element:e,accessor:r});return t&&(null==a?void 0:a.includes(i))}),!0);if(n=null===(i=n)||void 0===i?void 0:i.filter((e=>{const t=Xs({element:e,itemType:pp}),{participantId:n,participantType:r,participantRole:i,participantRoleResponsibilities:a}=e;return h?c&&y.includes(n)||!1===c&&!y.includes(n)||g&&g.includes(n)||I&&I.includes(n)||f&&f.includes(n)||m&&t===m||p&&Sp(p)&&p.includes(r)||d&&Sp(d)&&d.includes(i)||l&&Sp(a)&&Sp(l)&&l.find((e=>a.includes(e)))||(null==o?void 0:o.length)&&Sp(o)&&b(e):(void 0===c||c&&y.includes(n)||!1===c&&!y.includes(n))&&(!g||g.includes(n))&&(!I||I.includes(n))&&(!f||f.includes(n))&&(!m||t===m)&&(!p||Sp(p)&&p.includes(r))&&(!d||Sp(d)&&d.includes(i))&&(!l||Sp(a)&&Sp(l)&&l.find((e=>a.includes(e))))&&(!(null!=o&&o.length)||Sp(o)&&b(e))})),v.length&&a){var w;const t=v.filter((e=>a.includes(e.eventId))).map((t=>{const n=(t.entries||[]).map((e=>e.participantId));if(t.eventType===Pa)return n;const r=(e.participants||[]).filter((e=>n.includes(e.participantId))).map((e=>e.individualParticipantIds)).flat(1);return n.concat(...r)})).flat(1);n=null===(w=n)||void 0===w?void 0:w.filter((e=>t.includes(e.participantId)))}return n}function Sp(e){return e&&Array.isArray(e)&&e.length}function Dp({participantFilters:e={},convertExtensions:t,policyDefinitions:n,withScheduleItems:r,tournamentRecord:i,scheduleAnalysis:a,withStatistics:o,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l,inContext:p}){if(!i)return{error:me};if(!i.participants)return{error:Kt};let f=i.participants.map((e=>Gr(e,t)));if("object"!=typeof e)return{error:Fn,participantFilters:e};var m;p&&(null===(m=f)||void 0===m||m.forEach((e=>{[La,xa,ka].includes(e.participantType)&&(e.individualParticipants=e.individualParticipantIds.map((e=>Gr(i.participants.find((t=>t.participantId===e)),t,!0))))})));e&&(f=Up({tournamentRecord:i,participantFilters:e,participants:f}));let h;if(d||l||u||s||c||o||a||r||p){const t=bp({tournamentEvents:i.events,tournamentParticipants:f,participantFilters:e,withScheduleItems:r,tournamentRecord:i,scheduleAnalysis:a,withStatistics:o,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l});h=null==t?void 0:t.participantIdsWithConflicts}const v=null==n?void 0:n.participant;return null!=v&&v.participant&&(f=f.map((e=>J({source:e,template:v.participant})))),{tournamentParticipants:f,participantIdsWithConflicts:h}}function Np(e,t,n){if(!e&&t)return t;if(e&&!t)return e;if("object"!=typeof e||"object"!=typeof t)return e;return Q(Object.keys(e).concat(Object.keys(t))).reduce(((r,i)=>{if(t[i])if(e[i])if(typeof e[i]!=typeof t[i])r[i]=t[i];else if(Array.isArray(e[i]))if(!0===n||Array.isArray(n)&&n.includes(i)){const n=Q(e[i].map((e=>JSON.stringify(e))).concat(t[i].map((e=>JSON.stringify(e))))).map((e=>JSON.parse(e)));r[i]=n}else r[i]=t[i];else"object"==typeof e[i]?r[i]=Np(e[i],t[i],n):r[i]=t[i];else r[i]=t[i];else r[i]=e[i];return r}),{})}function Pp(e){return{tournamentIds:Object.keys(e).filter(Boolean)}}const Ap=({penaltyId:e=Wr()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:e});function Mp({tournamentRecord:e,participantIds:t,penaltyCode:n,penaltyType:r,penaltyId:i,matchUpId:a,notes:o,extensions:s,issuedAt:c,refereeParticipantId:u}){if(!e)return{error:me};if(!t)return{error:Yt};if(!r)return{error:mn};const d=((null==e?void 0:e.participants)||[]).filter((e=>t.includes(e.participantId)));if(!d.length)return{error:$t};const l=(new Date).toISOString(),p=Object.assign(Ap({penaltyId:i}),{refereeParticipantId:u,penaltyCode:n,penaltyType:r,matchUpId:a,notes:o,issuedAt:c,createdAt:l});return Array.isArray(s)&&s.forEach((e=>Vc({element:p,extension:e}))),d.forEach((e=>{e.penalties||(e.penalties=[]),e.penalties.push(p)})),nr({topic:vc,payload:{participants:d}}),{...de,penaltyId:p.penaltyId}}function Tp({tournamentRecord:e,penaltyId:t}){if(!e)return{error:me};if(!t)return{error:hn};const n=(null==e?void 0:e.participants)||[],r=[];let i,a=!1;return n.forEach((e=>{let n=!1;e.penalties=(e.penalties||[]).filter((o=>(o.penaltyId===t&&(n=!0,a||(i=o,a=!0)),n&&r.push(e),o.penaltyId!==t)))})),i&&nr({topic:vc,payload:{participants:r}}),i?{...de,penalty:i}:{error:vn}}function Ep({tournamentRecord:e}){if(!e)return{error:me};const t=((null==e?void 0:e.participants)||[]).reduce(((e,t)=>{const{participantId:n}=t;return(t.penalties||[]).forEach((t=>{const{penaltyId:r}=t||{};e[r]?e[r].participants.push(n):e[r]={...t,participantIds:[n]}})),e}),{});return{penalties:Object.values(t)}}function Cp({tournamentRecord:e,penaltyId:t,modifications:n}){if(!e)return{error:me};if(!n)return{error:jn,modifications:n};if(!t)return{error:hn};const r=(null==e?void 0:e.participants)||[],i=Object.keys(Ap()).filter((e=>"penaltyId"!==e)),a=Object.keys(n).filter((e=>i.includes(e)));if(!a.length)return{error:Gn};let o;const s=[];return r.forEach((e=>{let r=!1;e.penalties=(e.penalties||[]).map((e=>(e.penaltyId===t&&(r=!0,a.forEach((t=>Object.assign(e,{[t]:n[t]}))),o||(o=e)),e))),r&&s.push(e)})),o&&nr({topic:vc,payload:{participants:s}}),o?{...de,penalty:o}:{error:vn}}const Rp={addExtension:Td,findExtension:Ed,removeExtension:Cd,addEventExtension:function({tournamentRecords:e,eventId:t,extension:n}){if("string"!=typeof t)return{error:ze};if(!Gc(n))return{error:jn};for(const r of Object.values(e)){const{event:e}=ya({tournamentRecord:r,eventId:t});if(e)return zc({event:e,extension:n})}return{error:Ke}},linkTournaments:function({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const{tournamentIds:t,error:n}=Pp(e);if(n)return{error:n};if((null==t?void 0:t.length)>1){return Td({tournamentRecords:e,extension:{name:qi,value:{tournamentIds:t}}})}return de},unlinkTournament:function({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e)return{error:jn};if(!t)return{error:ve};const{tournamentIds:n,error:r}=Pp(e);if(r)return{error:r};if(!n.includes(t))return{error:ve};let i;return n.every((n=>{var r;const a=e[n],{extension:o}=aa({tournamentRecord:a,name:qi});if(!o)return!0;let s=(null==o||null===(r=o.value)||void 0===r?void 0:r.tournamentIds)||[];if(null==s||!s.length||1===s.length&&s.includes(t)||n===t){const e=Kc({tournamentRecord:a,name:qi});return e.error&&(i=e.error),e.success}const c=s.filter((e=>e!==t));o.value={tournamentIds:c};const u=Hc({tournamentRecord:a,extension:o});return u.error&&(i=u.error),u.success})),i?{error:i}:{...de}},unlinkTournaments:function({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?Cd({tournamentRecords:e,name:qi}):{error:fe}},getLinkedTournamentIds:function({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?{linkedTournamentIds:Object.assign({},...Object.keys(e).map((t=>{var n;const r=e[t],i=null==r?void 0:r.tournamentId,{extension:a}=aa({tournamentRecord:r,name:qi});return{[t]:((null==a||null===(n=a.value)||void 0===n?void 0:n.tournamentIds)||[]).filter((e=>e!==i))}})))}:{error:fe}},addDrawDefinition:function({tournamentRecords:e,drawDefinition:t,tournamentId:n,eventId:r,flight:i,existingDrawCount:a}){if(!r)return{error:ze};if(!(n=n||Id({tournamentRecords:e,eventId:r})))return{error:ve};const o=e[n];if(!o)return{error:me};const{event:s,error:c}=ya({tournamentRecord:o,eventId:r});return c?{error:c}:ap({drawDefinition:t,event:s,flight:i,existingDrawCount:a})},getCompetitionParticipants:function(e){const{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:fe};let n=[];const r=[],i=[];for(const a of Object.values(t)){const{tournamentParticipants:t,participantIdsWithConflicts:o}=Dp({tournamentRecord:a,...e});for(const e of t){const{participantId:t}=e;r.includes(t)?n=n.map((n=>n.participantId!==t?n:Np(n,e,!0))):(r.push(t),n.push(e))}o&&o.forEach((e=>{i.includes(e)||i.push(e)}))}return{competitionParticipants:n,participantIdsWithConflicts:i}},addParticipant:function({tournamentRecords:e,pairOverride:t,tournamentId:n,participant:r}){if("string"!=typeof n)return{error:ve};const i=e[n];return i?sp({tournamentRecord:i,participant:r,pairOverride:t}):{error:me}},setMatchUpStatus:function(e){const t=e.tournamentRecords,n=e.tournamentId||Id(e);if("string"!=typeof n)return{error:ve};const r=t[n];if(!r)return{error:me};const{drawDefinition:i,event:a}=ya({eventId:e.eventId,drawId:e.drawId,tournamentRecord:r});return Hl({tournamentRecord:r,...e,drawDefinition:i,event:a})},bulkMatchUpStatusUpdate:function(e){const{tournamentRecords:t,outcomes:n}=e;if(!Array.isArray(n))return{error:Mt};const r=n.reduce(((e,t)=>e.includes(t.tournamentId)?e:e.concat(t.tournamentId)),[]);for(const i of r){const e=t[i];if(!e)return{error:me};const r=n.filter((e=>e.tournamentId===i));if(r.length){const t=Wl({tournamentRecord:e,outcomes:r});if(t.error)return t}}return{...de}},bulkScheduleMatchUps:function({tournamentRecords:e,matchUpContextIds:t,schedule:n}){if(!e)return{error:fe};if(!Array.isArray(t))return{error:jn};for(const r of Object.values(e)){const{tournamentId:e}=r,i=t.filter((t=>t.tournamentId===e)).map(Oc);if(null!=i&&i.length){const e=vd({tournamentRecord:r,matchUpIds:i,schedule:n});if(e.error)return e}}return de},addVenue:function({tournamentRecords:e,venue:t,disableNotice:n}){if("object"!=typeof t)return{error:jn};t.venueId||(t.venueId=Wr());for(const r of Object.values(e)){const e=op({tournamentRecord:r,returnDetails:!0,disableNotice:!0,venue:t});if(null!=e&&e.error)return e}return n||nr({topic:cc,payload:{venue:t}}),de},deleteVenue:function({tournamentRecords:e,venueId:t,force:n}){if(!e)return{error:fe};if("string"!=typeof t)return{error:Un};let r;for(const i of Object.values(e)){const e=ip({tournamentRecord:i,venueId:t,force:n});if(e.error&&e.error!==wn)return e;r=!0}return kd({tournamentRecords:e}),r?de:{error:wn}},modifyVenue:function({tournamentRecords:e,modifications:t,venueId:n,force:r}){if(!e)return{error:fe};if("string"!=typeof n)return{error:Un};let i,a;for(const o of Object.values(e)){const e=np({tournamentRecord:o,modifications:t,venueId:n,force:r});if(e.success&&(a=!0),e.error&&(i=e.error),e.error&&e.error!==wn)return e}return kd({tournamentRecords:e}),a?{...de}:{error:i}},addCourts:function(e){const{tournamentRecords:t,venueId:n}=e;if("string"!=typeof n||!n)return{error:Un};let r;for(const i of Object.values(t)){const{venue:t}=Fu({tournamentRecord:i,venueId:n});if(t){const t=tp({tournamentRecord:i,...e});if(t.error)return t;r=!0}}return r?de:{error:wn}},addPenalty:function(e){const{tournamentRecords:t,participantIds:n}=e;let r;for(const i of Object.values(t)){const{tournamentParticipants:t}=Dp({tournamentRecord:i}),a=Ec(t).filter((e=>n.includes(e)));if(a.length){r=Mp({...e,penaltyId:e.penaltyId||r,tournamentRecord:i,participantIds:a}).penaltyId}}return r?{...de,penaltyId:r}:{error:$t}},removePenalty:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:fe};for(const n of Object.values(t)){const t=Tp({tournamentRecord:n,...e});if(t.error&&t.error!==vn)return t}return{...de}},modifyPenalty:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:fe};for(const n of Object.values(t)){const t=Cp({tournamentRecord:n,...e});if(t.error&&t.error!==vn)return t}return{...de}},getCompetitionPenalties:function({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const t=[];for(const n of Object.values(e)){const{penalties:e}=Ep({tournamentRecord:n});t.push(...e)}return{penalties:t}},findParticipant:function({tournamentRecords:e,participantId:t,personId:n,policyDefinitions:r,inContext:i}){if(!e)return{error:fe};if("string"!=typeof t&&"string"!=typeof n)return{error:Mt};let a;for(const o of Object.values(e)){const{tournamentParticipants:e}=Dp({tournamentRecord:o,policyDefinitions:r,inContext:i});if(a=na({tournamentParticipants:e,participantId:t,personId:n,policyDefinitions:r}),a)break}return{participant:Gr(a,!1,!0)}}};function Op(){const{topics:e}=ar();for(const t of e){const e=rr({topic:t});e&&or({topic:t,notices:e})}}function xp({tournamentRecord:e,matchUpFormat:t,event:n}){if(!e)return{error:me};if(!g(t))return{error:rt};const{extension:r}=oa({event:n,name:Ki}),i=null==r?void 0:r.value,{extension:a}=aa({tournamentRecord:e,name:Ki}),o=null==a?void 0:a.value;return{matchUpFormat:t,averageTimes:[(null==i?void 0:i.matchUpAverageTimes)&&xi({...i,matchUpFormat:t}),(null==o?void 0:o.matchUpAverageTimes)&&xi({...o,matchUpFormat:t})].find((e=>e)),recoveryTimes:[(null==i?void 0:i.matchUpRecoveryTimes)&&Li({...i,matchUpFormat:t}),(null==o?void 0:o.matchUpRecoveryTimes)&&Li({...o,matchUpFormat:t})].find((e=>e))}}function Lp({tournamentRecord:e,matchUpFormat:t,averageTimes:n,recoveryTimes:r,event:i}){if(!e)return{error:me};if(n&&!Array.isArray(n))return{error:jn};if(r&&!Array.isArray(r))return{error:jn};const a=Ki;if(i){const{extension:e}=oa({event:i,name:a});zc({event:i,extension:{name:a,value:kp({...(null==e?void 0:e.value)||{},matchUpFormat:t,averageTimes:n,recoveryTimes:r})}})}else{const{extension:i}=aa({tournamentRecord:e,name:a});Hc({tournamentRecord:e,extension:{name:a,value:kp({...(null==i?void 0:i.value)||{},matchUpFormat:t,averageTimes:n,recoveryTimes:r})}})}return de}function kp({matchUpAverageTimes:e=[],matchUpRecoveryTimes:t=[],averageTimes:n,recoveryTimes:r,matchUpFormat:i}){var a,o;const s=(null===(a=n=(n||[]).filter((e=>{var t,n;return(null==e||null===(t=e.categoryNames)||void 0===t?void 0:t.length)||(null==e||null===(n=e.categoryTypes)||void 0===n?void 0:n.length)})))||void 0===a?void 0:a.length)&&e.map((e=>{var t;return null!=e&&e.matchUpFormatCodes.includes(i)?{...e,matchUpFormatCodes:null===(t=e.matchUpFormatCodes)||void 0===t?void 0:t.filter((e=>e!==i))}:e})).filter((({matchUpFormatCodes:e})=>null==e?void 0:e.length)).concat({matchUpFormatCodes:[i],averageTimes:n}),c=(null===(o=r=(r||[]).filter((e=>{var t,n;return(null==e||null===(t=e.categoryNames)||void 0===t?void 0:t.length)||(null==e||null===(n=e.categoryTypes)||void 0===n?void 0:n.length)})))||void 0===o?void 0:o.length)&&t.map((e=>{var t;return null!=e&&e.matchUpFormatCodes.includes(i)?{...e,matchUpFormatCodes:null===(t=e.matchUpFormatCodes)||void 0===t?void 0:t.filter((e=>e!==i))}:e})).filter((({matchUpFormatCodes:e,averageTimes:t})=>(null==e?void 0:e.length)||t)).concat({matchUpFormatCodes:[i],recoveryTimes:r});return{matchUpAverageTimes:(null==s?void 0:s.length)&&s||e,matchUpRecoveryTimes:(null==c?void 0:c.length)&&c||t}}function Fp({tournamentRecord:e,event:t,categoryType:n,matchUpFormat:r,averageMinutes:i,recoveryMinutes:a}){if(!e)return{error:me};if(!g(r))return{error:jn};if(!t)return{error:ze};const{averageTimes:o=[],recoveryTimes:s=[]}=xp({tournamentRecord:e,matchUpFormat:r,event:t}),c=t.category,u=(null==c?void 0:c.categoryName)||(null==c?void 0:c.ageCategoryCode),d="DOUBLES"===t.eventType;let l={categoryNames:[u],minutes:{}},p={categoryNames:[u],minutes:{}};const f=e=>{var t,r;if(null!==(t=e.categoryTypes)&&void 0!==t&&t.includes(n)&&console.log("encountered:",{categoryType:n}),null===(r=e.categoryNames)||void 0===r||!r.includes(u)||(e.categoryNames=e.categoryNames.filter((e=>e!==u)),l={minutes:e.minutes,categoryNames:[u]},e.categoryNames.length))return e},m=!isNaN(parseInt(i)),h=!isNaN(parseInt(a)),v=o.map(f).filter((e=>{var t;return null==e||null===(t=e.categoryNames)||void 0===t?void 0:t.length})),I=s.map(f).filter((e=>{var t;return null==e||null===(t=e.categoryNames)||void 0===t?void 0:t.length}));return m&&(Object.assign(l.minutes,{[d?Aa:ua]:i}),v.push(l)),h&&(Object.assign(p.minutes,{[d?Aa:ua]:a}),I.push(p)),m||h?Lp({tournamentRecord:e,event:t,matchUpFormat:r,averageTimes:m&&v,recoveryTimes:h&&I}):{error:jn}}function jp({tournamentRecords:e,extensionName:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const n=[];let r;for(const i of Object.values(e)){const{extension:e}=aa({tournamentRecord:i,name:t});e&&!r&&(n.push({method:"addExtension",params:{extension:e}}),r=!0);const a=i.events||[];for(const r of a){const{eventId:e}=r,{extension:i}=oa({event:r,name:t});i&&n.push({method:"addEventExtension",params:{eventId:e,extension:i}})}}return{methods:n}}function _p({tournamentRecord:e,matchUpFormats:t,categoryType:n,event:r}){if(!e)return{error:me};if(!r)return{error:ze};let i=[];if(null!=t&&t.length){const e=[];i=t.map((t=>{let n="string"==typeof t?{matchUpFormat:t}:t;if(!e.includes(null==n?void 0:n.matchUpFormat)&&g(null==n?void 0:n.matchUpFormat))return e.push(n.matchUpFormat),n})).filter(Boolean)}else{const{policy:t}=ta({policyType:si,tournamentRecord:e,event:r});if(null!=t&&t.matchUpFormats)i=null==t?void 0:t.matchUpFormats;else{const{extension:e}=oa({event:r,name:Ki});if(null==e||!e.value)return{error:Nt};i=Q([...(e.value.matchUpAverageTimes||[]).map((e=>e.matchUpFormatCodes)),...(e.value.matchUpRecoveryTimes||[]).map((e=>e.matchUpFormatCodes))].flat()).map((e=>({matchUpFormat:e})))}}const{eventType:a,eventId:o,category:s}=r,c=null==s?void 0:s.categoryName;if(!o)return{error:ze};return{eventMatchUpFormatTiming:i.map((({matchUpFormat:t,description:i})=>{const o=ga({tournamentRecord:e,matchUpFormat:t,categoryName:c,categoryType:n,eventType:a,event:r});return Object.assign({},{...o,description:i,matchUpFormat:t})}))}}function Bp({tournamentRecord:e,drawDefinition:t,structureId:n,matchUpId:r,drawId:i,event:a}){var o,s,c;if(!e)return{error:me};if(!(i||a||n||r))return{error:Mt};const u=hd({tournamentRecord:e,drawDefinition:t,matchUpId:r,drawId:i,event:a});if(r&&null!=u&&u.error)return u;!t&&null!=u&&u.drawDefinition&&(t=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&n&&!r){if(!t)return{error:Re};const e=_c({drawDefinition:t,structureId:n});if(e.error)return e;d=e.structure}const l=null===(o=d)||void 0===o?void 0:o.matchUpFormat,p=null===(s=t)||void 0===s?void 0:s.matchUpFormat,f=null==a?void 0:a.matchUpFormat;return{matchUpFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.matchUpFormat)||l||p||f,structureDefaultMatchUpFormat:l,drawDefaultMatchUpFormat:p,eventDefaultMatchUpFormat:f}}function Gp({defaultRecoveryMinutes:e=0,defaultAverageMinutes:t,tournamentRecords:n,tournamentId:r,matchUpFormat:i,categoryName:a,categoryType:o,eventType:s,eventId:c}){var u,d,l,p;if(!g(i))return{error:rt};let f;return Object.keys(n).filter((e=>!r||e===r)).find((e=>{var t,r,u;const d=n[e],l=c&&(null===(t=ya({tournamentRecord:d,eventId:c}))||void 0===t?void 0:t.event);f=ga({tournamentRecord:d,event:l,matchUpFormat:i,categoryName:a,categoryType:o,eventType:s});return(null===(r=f)||void 0===r?void 0:r.averageMinutes)||(null===(u=f)||void 0===u?void 0:u.recoveryMinutes)})),{averageMinutes:(null===(u=f)||void 0===u?void 0:u.averageMinutes)||t,recoveryMinutes:(null===(d=f)||void 0===d?void 0:d.recoveryMinutes)||e,typeChangeRecoveryMinutes:(null===(l=f)||void 0===l?void 0:l.typeChangeRecoveryMinutes)||(null===(p=f)||void 0===p?void 0:p.recoveryMinutes)||e}}function Vp({tournamentRecords:e,containedStructureIds:t,periodLength:n=30,matchUps:r,rounds:i}){if("object"!=typeof e)return{error:fe};if(!Array.isArray(i))return{error:Mt};const a=[],o=i.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0)));t=t||Object.assign({},...Object.values(e).map((e=>yl({tournamentRecord:e}).containedStructures))),r||({matchUps:r}=jd({tournamentRecords:e,nextMatchUps:!0}));const s={},c={},u={};let d=0;return{scheduledRoundsDetails:o.map((i=>{var o,l,p;const f=i.periodLength||n,m=t[i.structureId]||[i.structureId],h={tournamentIds:[i.tournamentId],roundNumbers:[i.roundNumber],matchUpIds:i.matchUpIds,eventIds:[i.eventId],drawIds:[i.drawId],structureIds:m};let v=Cu({matchUps:r,processContext:!0,...h}).sort(Gd);const{segmentNumber:g,segmentsCount:I}=i.roundSegment||{};if($(g)&&H(null===(o=v)||void 0===o?void 0:o.length)&&H(I)&&g>0&&g<=I&&I<(null===(l=v)||void 0===l?void 0:l.length)&&(null===(p=i.matchUpIds)||void 0===p||!p.length)){const e=v.length/I,t=e*(g-1);v=v.slice(t,t+e)}const y=e[i.tournamentId],{drawDefinition:b,event:U}=ya({drawId:i.drawId,tournamentRecord:y}),{matchUpFormat:S}=Bp({structureId:i.structureId,tournamentRecord:y,drawDefinition:b,event:U}),{eventType:D,category:N}=U||{},{categoryName:P,ageCategoryCode:A}=N||{},{typeChangeRecoveryMinutes:M,recoveryMinutes:T,averageMinutes:E,error:C}=Gp({tournamentRecords:e,categoryName:P||A,tournamentId:i.tournamentId,eventId:i.eventId,matchUpFormat:S,eventType:D});if(C)return{error:C,round:i};const R=v.filter((({matchUpStatus:e})=>!j.includes(e)&&e!==w)).map(Oc);R.forEach((e=>{s[e]={typeChangeRecoveryMinutes:M,recoveryMinutes:T,averageMinutes:E},c[e]=T,u[e]=E})),a.push(...R),d=Math.max(E||0,d);return{roundPeriodLength:f,recoveryMinutes:T,averageMinutes:E,matchUpIds:R,hash:`${E}|${f}`}})),greatestAverageMinutes:d,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:a,minutesMap:s,...de}}function qp({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=60,averageMatchUpMinutes:n=90,remainingScheduleTimes:r,clearScheduleDates:i,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,endTime:d}){if("object"!=typeof o||!Object.keys(o).length)return{error:fe};const{courts:l,venues:p}=Ad({tournamentRecords:o}),f=l.filter((e=>!u||u.includes(e.venueId)));c||(c=f.reduce(((e,t)=>{var n;const r=null===(n=t.dateAvailability)||void 0===n?void 0:n.find((e=>!e.date||_r(s,e.date))),i=(null==r?void 0:r.startTime)||t.startTime;return i&&(!e||Mr(i)<Mr(e))?i:e}),void 0)),d||(d=f.reduce(((e,t)=>{var n;const r=null===(n=t.dateAvailability)||void 0===n?void 0:n.find((e=>!e.date||_r(s,e.date))),i=(null==r?void 0:r.endTime)||t.endTime;return i&&(!e||Mr(i)>Mr(e))?i:e}),void 0));const m=Object.assign({},...Object.values(o).map((e=>(e.events||[]).map((t=>{const{scheduleTiming:n}=ca({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:n}}})))).flat()),h=_d({tournamentRecords:o,sortDateMatchUps:!1,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=[].concat(...h.dateMatchUps||[],...h.completedMatchUps||[]),g={averageTimes:[{minutes:{default:n}}],recoveryTimes:[{minutes:{default:t}}]},I=null==v?void 0:v.map((({eventId:e,schedule:t,matchUpFormat:n})=>{const{event:r,scheduleTiming:i}=m[e],o=null==r?void 0:r.eventType,s={...i,defaultTiming:g,matchUpFormat:n},{averageMinutes:c,recoveryMinutes:u}=Ia({eventType:o,timingDetails:s}),{courtId:d,venueId:l}=t,p=Er(t.scheduledTime),f=kr(p,c);return{averageMinutes:c,recoveryMinutes:u,periodLength:a,startTime:p,endTime:f,courtId:d,venueId:l}})),y={calculateStartTimeFromCourts:e,remainingScheduleTimes:r,averageMatchUpMinutes:n,date:s,clearScheduleDates:i,periodLength:a,startTime:c,endTime:d,bookings:I,courts:f},{scheduleTimes:b}=Js(y);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==p?void 0:p.length)?p[0].venueId:void 0,scheduleTimes:b,dateScheduledMatchUpIds:v.map(Oc)}}function Hp({individualParticipantProfiles:e,participantId:t}){e[t]||(e[t]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function Wp({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUp:n,value:r}){const{matchUpType:i}=n,{individualParticipantIds:a}=Ud(n),o=(e[n.matchUpId]||[]).filter((e=>!se(e,a))).flat();[...a,...o].forEach((e=>{if(Hp({individualParticipantProfiles:t,participantId:e}),!t[e].potentialCounted[n.drawId]){const a=t[e].counters;a[i]?a[i]+=r:r>0&&(a[i]=r),a[fa]?a[fa]+=r:r>0&&(a[fa]=r),o.includes(e)&&(t[e].potentialCounted[n.drawId]=!0)}}))}function zp({matchUpScheduleTimes:e,matchUpDependencies:t,allDateMatchUpIds:n,matchUp:r}){var i;const a=((null==t||null===(i=t[r.matchUpId])||void 0===i?void 0:i.matchUpIds)||[]).filter((e=>n.includes(e))).filter((t=>!e[t]));return{dependenciesScheduled:!(null!=a&&a.length),remainingDependencies:a}}function Kp({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:t,timeAfterRecovery:n,matchUp:r}){var i,a,o,s;const{individualParticipantIds:c}=Ud(r);n=n||(null===(i=r.schedule)||void 0===i?void 0:i.timeAfterRecovery);const u=t=>{e[t]||(e[t]=[]),e[t]=Q(e[t].concat(...c))},d=e=>{(!t[e]||n>t[e])&&(t[e]=n)},l=(null===(a=r.winnerTo)||void 0===a?void 0:a.matchUpId)||r.winnerMatchUpId;l&&(n&&d(l),u(l));const p=(null===(o=r.loserTo)||void 0===o?void 0:o.matchUpId)||r.loserMatchUpId;p&&(n&&d(p),u(p)),null!==(s=r.sidesTo)&&void 0!==s&&s.length&&r.sidesTo.forEach((({matchUpId:e})=>{e&&(n&&d(e),u(e))}))}function Yp({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUpDependencies:r,averageMatchUpMinutes:i=0,typeChangeRecoveryMinutes:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){var u,d;const l=Er(null==c||null===(u=c.schedule)||void 0===u?void 0:u.endTime),p=l?kr(l,parseInt(o)):kr(s,parseInt(i)+parseInt(o)),f=a&&(l?kr(Er(l),a):kr(s,parseInt(i)+parseInt(a))),m=(null==r||null===(d=r[c.matchUpId])||void 0===d?void 0:d.participantIds)||[],h=(c.roundPosition&&t[c.matchUpId]||[]).flat();m.forEach((t=>{Hp({individualParticipantProfiles:e,participantId:t});const n=e[t].priorMatchUpType!==c.matchUpType&&f||p;h.includes(t)?function({individualParticipantProfiles:e,recoveryValue:t,participantId:n,scheduleTime:r,drawId:i}){e[n].potentialRecovery[i]||(e[n].potentialRecovery[i]=[]),e[n].potentialRecovery[i].push(t),e[n].potentialBookings[i]||(e[n].potentialBookings[i]=[]),e[n].potentialBookings[i].push({timeAfterRecovery:t,scheduleTime:r})}({individualParticipantProfiles:e,drawId:c.drawId,recoveryValue:n,participantId:t,scheduleTime:s}):(e[t].timeAfterRecovery=n,e[t].bookings.push({scheduleTime:s,timeAfterRecovery:n}))})),Kp({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:p,matchUp:c})}function $p({matchUpScheduleTimes:e,matchUpDependencies:t,scheduleTime:n,matchUpId:r,details:i}){var a,o,s,c,u;let d;const l=null===(a=i.minutesMap)||void 0===a||null===(o=a[r])||void 0===o?void 0:o.recoveryMinutes,p=kr(n,((null===(s=i.minutesMap)||void 0===s||null===(c=s[r])||void 0===c?void 0:c.averageMinutes)||0)+(l||0)),f=(null==t||null===(u=t[r])||void 0===u?void 0:u.dependentMatchUpIds)||[];if(f.length){const t=f.reduce(((t,n)=>{const r=e[n];if(!r)return t;const i={scheduleTime:r,matchUpId:n};return r&&!t.matchUpId||Mr(r)<Mr(t.scheduleTime)?i:t}),{});t.scheduleTime&&Mr(p)>Mr(t.scheduleTime)&&(d=t)}return{scheduledDependent:d}}const Jp="DO_NOT_SCHEDULE",Zp={DO_NOT_SCHEDULE:Jp};function Qp({averageMatchUpMinutes:e=90,requestConflicts:t={},potentials:n=!0,personRequests:r,scheduleTime:i,scheduleDate:a,matchUp:o}){const s=function(e){const{sides:t,matchUpType:n}=e||{};return(t||[]).map((e=>{var t;return n===da?(null==e||null===(t=e.participant)||void 0===t?void 0:t.individualParticipants)||[]:null!=e&&e.participant?[e.participant]:[]})).flat()}(o).map((({person:e})=>null==e?void 0:e.personId));if(n){const e=((null==o?void 0:o.potentialParticipants)||[]).flat().map((({person:e})=>null==e?void 0:e.personId));s.push(...e)}const c=s.map((e=>{var t;return null===(t=r[e])||void 0===t?void 0:t.map((t=>({...t,personId:e})))})).filter(Boolean).flat().filter((e=>e.requestType===Jp&&_r(a,e.date))),u=[],d=null==o?void 0:o.matchUpId,l=xr(Er(i),Cr(a)),p=Er(Fr(l,e).toISOString());for(const f of c){const{requestId:e,startTime:n,endTime:r}=f;(i>n&&i<r||p>n&&p<r)&&(u.push({matchUpId:d,request:f,scheduleTime:i}),t[e]?(t[e].scheduleTimes.includes(i)||t[e].scheduleTimes.push(i),t[e].matchUpIds.includes(d)||t[e].matchUpIds.push(d)):t[e]={request:f,scheduleTimes:[i],matchUpIds:[d]})}return{conflicts:u}}function Xp({individualParticipantProfiles:e,matchUpNotBeforeTimes:t,matchUpDependencies:n,scheduleTime:r,matchUp:i,details:a}){var o,s,c,u,d;const l=((null==n||null===(o=n[i.matchUpId])||void 0===o?void 0:o.participantIds)||[]).flat(),p=(null==a||null===(s=a.minutesMap)||void 0===s||null===(c=s[i.matchUpId])||void 0===c?void 0:c.averageMinutes)||0,f=(null==a||null===(u=a.minutesMap)||void 0===u||null===(d=u[i.matchUpId])||void 0===d?void 0:d.recoveryMinutes)||0,m=l.every((t=>{var n;Hp({individualParticipantProfiles:e,participantId:t});let a=e[t];if(!a.timeAfterRecovery)return!0;const o=Er(null==i||null===(n=i.schedule)||void 0===n?void 0:n.endTime),s=o?kr(o,parseInt(f)):kr(r,parseInt(p)+parseInt(f));return!!![...Object.keys(a.potentialBookings).filter((e=>e!==i.drawId)).map((e=>a.potentialBookings[e])).flat(),...a.bookings].find((e=>function(e,t){const n=Mr(e.scheduleTime),r=Mr(e.timeAfterRecovery),i=Mr(t.scheduleTime),a=Mr(t.timeAfterRecovery),o=n>i&&n<a,s=i>n&&i<r,c=r>i&&r<a,u=a>n&&a<r;return Vr({hasOverlap:n===i||r===a||o||c||s||u,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:r,timeAfterRecovery:s},e).hasOverlap))})),h=t[i.matchUpId],v=h?Lr(xr(h),xr(r),!1):0;return{enoughTime:m&&v>=0}}function ef({scheduledRoundsDetails:e,greatestAverageMinutes:t,garmanSinglePass:n}){let r,i,a,o,s=[],c=[];for(const u of e)r||(r=u.hash),(u.hash===r||n)&&(s=s.concat(u.matchUpIds)),u.hash===r||n||(r=u.hash,c.push({averageMinutes:i,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),s=u.matchUpIds),i=n?t:u.averageMinutes,a=u.recoveryMinutes,o=u.roundPeriodLength;return s.length&&c.push({averageMinutes:i,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),{groupedRounds:c}}function tf({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpDailyLimits:n={},matchUp:r}){const{matchUpId:i,matchUpType:a}=r,{enteredIndividualParticipantIds:o}=Ud(r),s=(r.roundPosition&&t[i]||[]).flat(),c=Q(o.concat(...s));c.forEach((t=>{Hp({individualParticipantProfiles:e,participantId:t})}));return{participantIdsAtLimit:c.filter((t=>{const r=e[t];if(r){return[a,fa].find((e=>{const t=r.counters&&r.counters[e]||0,i=n[e]||0;return t&&i&&t>=i}))}})),relevantParticipantIds:c}}function nf({tournamentRecords:e,requestType:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const n={};for(const r of Object.values(e)){const{extension:e}=aa({tournamentRecord:r,name:Wi}),i=(null==e?void 0:e.value)||[];for(const r of i){const{personId:e,requests:i}=r||{};n[e]||(n[e]=[]);for(const r of i)t&&r.requestType!==t||n[e].push(r)}}return{personRequests:n}}function rf({tournamentRecords:e,personRequests:t}){if(!e)return{error:fe};for(const n of Object.values(e)){const{participants:e}=n,r=[];for(const n of Object.keys(t))if(na({tournamentParticipants:e,personId:n})){const e=t[n];e.length&&r.push({personId:n,requests:e})}if(Object.keys(r).length){Hc({tournamentRecord:n,extension:{name:Wi,value:r}})}}return de}function af({personRequests:e,personId:t,requests:n}){e[t]||(e[t]=[]);const r=n.filter((({requestType:e})=>e)).map((e=>{let{date:t,requestType:n,startTime:r,endTime:i}=e;return n===Jp&&(t=Cr(t),r=Er(r),i=Er(i),t&&r&&i)?{date:t,startTime:r,endTime:i,requestType:n}:e})).filter(Boolean);for(const i of r)i.requestId=Z(),e[t].push(i);return{mergeCount:r.length}}function of({scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:t=j,tournamentRecord:n,scheduledDates:r}){if("object"!=typeof n)return{error:me};if(!Array.isArray(t))return{error:jn};const{matchUps:i}=ud({matchUpFilters:{scheduledDates:r},tournamentRecord:n});return vd({schedule:{venueId:"",scheduledDate:"",scheduledTime:""},matchUpIds:i.filter((n=>!t.includes(n.matchUpStatus)&&up({schedule:n.schedule,scheduleAttributes:e}))).map(Oc),tournamentRecord:n})}function sf({scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:t=j,tournamentRecords:n,scheduledDates:r}){const i="object"==typeof n&&Object.values(n).map((({tournamentId:e})=>e)).filter(Boolean);if(null==i||!i.length)return{error:fe};for(const a of i){const i=of({ignoreMatchUpStatuses:t,scheduleAttributes:e,tournamentRecord:n[a],scheduledDates:r});if(i.error)return i}return{...de}}function cf({tournamentRecord:e}){var t;if(!e)return{error:me};const{policy:n}=ta({policyType:ii,tournamentRecord:e}),{extension:r}=aa({tournamentRecord:e,name:zi}),i=null==r||null===(t=r.value)||void 0===t?void 0:t.dailyLimits,a=null==n?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:i||a}}function uf({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};let n;return Object.keys(e).filter((e=>!t||e===t)).find((t=>{const r=e[t],{matchUpDailyLimits:i}=cf({tournamentRecord:r});return n=i,!0})),{matchUpDailyLimits:n}}function df({defaultRecoveryMinutes:e=0,averageMatchUpMinutes:t=90,periodLength:n=30,tournamentRecords:r,venueIds:i=[],scheduleDate:a,matchUps:o}){if("object"!=typeof r)return{error:fe};if(!Array.isArray(o))return{error:mt};const s=Object.assign({},...Object.values(r).map((e=>(e.events||[]).map((t=>{const{scheduleTiming:n}=ca({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:n}}})))).flat()),c={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},u=null==o?void 0:o.filter((e=>up(e)&&(!i.length||i.includes(e.schedule.venueId))&&(!a||e.schedule.scheduledDate===a)));return{bookings:null==u?void 0:u.map((({eventId:e,schedule:t,matchUpFormat:r})=>{const{event:i,scheduleTiming:a}=s[e],o=null==i?void 0:i.eventType,u={...a,defaultTiming:c,matchUpFormat:r},{averageMinutes:d,recoveryMinutes:l}=Ia({eventType:o,timingDetails:u}),{courtId:p,venueId:f}=t,m=Er(t.scheduledTime),h=kr(m,d);return{averageMinutes:d,recoveryMinutes:l,periodLength:n,startTime:m,endTime:h,courtId:p,venueId:f}})).filter(Boolean),relevantMatchUps:u}}function lf({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=60,averageMatchUpMinutes:n=90,remainingScheduleTimes:r,clearScheduleDates:i,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,matchUps:d,endTime:l}){if("object"!=typeof o||!Object.keys(o).length)return{error:fe};const{courts:p,venues:f}=Ad({tournamentRecords:o}),m=p.filter((e=>!u||u.includes(e.venueId)));c||(c=m.reduce(((e,t)=>{var n;const r=null===(n=t.dateAvailability)||void 0===n?void 0:n.find((e=>!e.date||_r(s,e.date))),i=(null==r?void 0:r.startTime)||t.startTime;return i&&(!e||Mr(i)<Mr(e))?i:e}),void 0)),l||(l=m.reduce(((e,t)=>{var n;const r=null===(n=t.dateAvailability)||void 0===n?void 0:n.find((e=>!e.date||_r(s,e.date))),i=(null==r?void 0:r.endTime)||t.endTime;return i&&(!e||Mr(i)>Mr(e))?i:e}),void 0));const{bookings:h,relevantMatchUps:v}=df({defaultRecoveryMinutes:t,averageMatchUpMinutes:n,tournamentRecords:o,scheduleDate:s,periodLength:a,venueIds:u,matchUps:d}),g={calculateStartTimeFromCourts:e,remainingScheduleTimes:r,averageMatchUpMinutes:n,clearScheduleDates:i,date:s,periodLength:a,startTime:c,endTime:l,bookings:h,courts:m},{scheduleTimes:I}=Js(g);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==f?void 0:f.length)?f[0].venueId:void 0,scheduleTimes:I,dateScheduledMatchUpIds:v.map(Oc)}}function pf({checkPotentialRequestConflicts:e=!0,clearScheduleDates:t,scheduleDates:n=[],tournamentRecords:r,periodLength:i,dryRun:a}){return function({checkPotentialRequestConflicts:e=!0,clearScheduleDates:t,scheduleDates:n=[],tournamentRecords:r,periodLength:i,dryRun:a}){if(!r)return{error:fe};if(!Array.isArray(n))return{error:jn};const{schedulingProfile:o=[],issues:s=[],modifications:c}=Rd({tournamentRecords:r}),u=Object.assign({},...Object.values(r).map((e=>yl({tournamentRecord:e}).containedStructures))),d=n.map((e=>{if(yr(e))return Cr(e)})).filter(Boolean),l=o.map((e=>e.scheduleDate)).map((e=>yr(e)&&Cr(e))).filter((e=>e&&(!n.length||d.includes(e))));if(!l.length)return{error:Et};if(t&&!a){const e=Array.isArray(t)?t:void 0;sf({tournamentRecords:r,scheduledDates:e})}const{courts:p}=Ad({tournamentRecords:r}),{matchUps:f}=jd({tournamentRecords:r,nextMatchUps:!0}),{matchUpDependencies:m}=Vd({includeParticipantDependencies:!0,tournamentRecords:r,matchUps:f}),{matchUpDailyLimits:h}=uf({tournamentRecords:r}),{personRequests:v}=nf({requestType:Jp,tournamentRecords:r}),g=o.filter((e=>{const t=Cr(null==e?void 0:e.scheduleDate);return l.includes(t)})).sort(((e,t)=>{new Date(e.scheduleDate).getTime(),new Date(t.scheduleDate).getTime()})),I={},b={},U={},D={},P={},A={},M={},T={},C={},R={};for(const z of g){const n=Cr(null==z?void 0:z.scheduleDate),o=(null==z?void 0:z.venues)||[],s={},c={},d={},l=(e,t)=>{e.forEach((e=>{const n=d[e].counters;n[t]?n[t]+=1:n[t]=1,n[fa]?n[fa]+=1:n[fa]=1}))};U[n]={},D[n]={},I[n]={},b[n]={},M[n]=[],T[n]=[],C[n]=[],R[n]=[];const g={};f.forEach((e=>{var t;null!==(t=e.schedule)&&void 0!==t&&t.scheduledDate&&_r(n,Cr(e.schedule.scheduledDate))&&Kp({matchUp:e,matchUpNotBeforeTimes:g,matchUpPotentialParticipantIds:s})}));const q=[];for(const e of o){var x;const{rounds:a=[],venueId:o}=e,{scheduledRoundsDetails:l,greatestAverageMinutes:h,orderedMatchUpIds:v,minutesMap:I}=Vp({tournamentRecords:r,containedStructureIds:u,periodLength:i,matchUps:f,rounds:a});q.push(...v);const{groupedRounds:b}=ef({scheduledRoundsDetails:l,greatestAverageMinutes:h,garmanSinglePass:!0}),{scheduleTimes:U,dateScheduledMatchUpIds:D}=lf({averageMatchUpMinutes:null===(x=b[0])||void 0===x?void 0:x.averageMinutes,scheduleDate:Cr(n),venueIds:[e.venueId],clearScheduleDates:t,tournamentRecords:r,periodLength:i,matchUps:f}),P=Array.isArray(t)?t.includes(n):t,M=P?[]:f.filter((({matchUpId:e})=>D.includes(e)));for(const e of M){var L;Wp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,scheduleDate:n,matchUp:e,value:1});const t=null===(L=e.schedule)||void 0===L?void 0:L.scheduledTime;if(t){var k;A[e.matchUpId]=t;const r=null==I||null===(k=I[e.matchUpId])||void 0===k?void 0:k.recoveryMinutes;Yp({individualParticipantProfiles:d,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:g,matchUpDependencies:m,recoveryMinutes:r,averageMatchUpMinutes:h,scheduleDate:n,scheduleTime:t,matchUp:e})}}let T=v.map((e=>f.find((t=>t.matchUpId===e)))).filter(Boolean).filter((e=>{const t=!P&&D.includes(e.matchUpId),n=[w,N,S,y,E,O].includes(null==e?void 0:e.matchUpStatus);return!t&&!e.winningSide&&!n}));const{matchUpMap:C}=T.reduce(((e,t)=>{const{drawId:n,tournamentId:r}=t;return e.matchUpMap[r]||(e.matchUpMap[r]={}),e.matchUpMap[r][n]?e.matchUpMap[r][n].push(t):e.matchUpMap[r][n]=[t],Kp({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:g,matchUp:t}),e}),{matchUpMap:{}});c[o]={courtsCount:p.filter((e=>e.venueId===o)).length,previousRemainingScheduleTimes:[],greatestAverageMinutes:h,scheduledRoundsDetails:l,matchUpsToSchedule:T,scheduleTimes:U,groupedRounds:b,minutesMap:I,matchUpMap:C}}const H=10;let W,K=0,Y=10;for(;!W;){for(const{venueId:t}of o){var F,j,_;let r=0;const i=c[t];for(;i.courtsCount&&null!==(B=i.scheduleTimes)&&void 0!==B&&B.length&&null!==(G=i.matchUpsToSchedule)&&void 0!==G&&G.length&&r<=i.courtsCount;){var B,G;const{scheduleTime:a,attempts:o=0}=i.scheduleTimes.shift(),c=i.matchUpsToSchedule.find((t=>{var r,o;const{matchUpId:c,matchUpType:u}=t,{participantIdsAtLimit:p,relevantParticipantIds:I}=tf({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,matchUpDailyLimits:h,matchUp:t});if(p.length)return T[n].includes(c)||T[n].push(c),!1;const{scheduledDependent:y}=$p({matchUpScheduleTimes:A,matchUpDependencies:m,scheduleTime:a,matchUpId:c,details:i});if(y)return!1;const{dependenciesScheduled:b,remainingDependencies:w}=zp({matchUpScheduleTimes:A,matchUpDependencies:m,allDateMatchUpIds:q,matchUps:f,matchUp:t});if(!b)return D[n][c]||(D[n][c]=[]),D[n][c].push({scheduleTime:a,remainingDependencies:w}),!1;const{enoughTime:S}=Xp({individualParticipantProfiles:d,matchUpNotBeforeTimes:g,matchUpDependencies:m,scheduleTime:a,details:i,matchUp:t});if(!S)return U[n][c]||(U[n][c]=[]),U[n][c].push({scheduleTime:a}),!1;const N=i.greatestAverageMinutes,{conflicts:M}=Qp({potentials:e,averageMatchUpMinutes:N,requestConflicts:R,personRequests:v,scheduleTime:a,scheduleDate:n,matchUp:t});if(null!=M&&M.length)return P[n]||(P[n]=[]),P[n].push(...M),!1;l(I,u);const E=null===(r=i.minutesMap)||void 0===r||null===(o=r[c])||void 0===o?void 0:o.recoveryMinutes;return Yp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,matchUpNotBeforeTimes:g,averageMatchUpMinutes:N,matchUpDependencies:m,recoveryMinutes:E,scheduleDate:n,scheduleTime:a,matchUp:t}),A[c]=a,!0}));i.matchUpsToSchedule=i.matchUpsToSchedule.filter((({matchUpId:e})=>e!==(null==c?void 0:c.matchUpId))),c?r+=1:(b[n][t]||(b[n][t]=[]),b[n][t].push({scheduleTime:a,attempts:o+1}))}var V;null!==(F=i.matchUpsToSchedule)&&void 0!==F&&F.length&&(b[n][t]=null===(V=b[n][t])||void 0===V?void 0:V.filter((e=>{const t=e.attempts<Y;return t&&i.scheduleTimes.push(e),!t}))),null!==(j=i.scheduleTimes)&&void 0!==j&&j.length&&null!==(_=i.matchUpsToSchedule)&&void 0!==_&&_.length||(i.complete=!0)}K+=1,W=o.every((({venueId:e})=>c[e].complete))||K===H}for(const{venueId:e}of o){const t=c[e].matchUpMap;Object.keys(t).forEach((i=>{const o=r[i];o&&Object.keys(t[i]).forEach((r=>{const{drawDefinition:s}=ba({tournamentRecord:o,drawId:r});s&&t[i][r].forEach((({matchUpId:t})=>{const r=A[t];if(r){const i=r.split(":").map(jr).join(":"),c=`${Cr(n)}T${i}`;a?M[n].push(t):(zu({drawDefinition:s,matchUpId:t,scheduledTime:c}).success&&M[n].push(t),e&&ju({tournamentRecord:o,drawDefinition:s,matchUpId:t,venueId:e}))}}))}))})),C[n]=c[e].matchUpsToSchedule.map(Oc),I[n][e]=c[e].scheduleTimes.sort(((e,t)=>Mr(e.scheduleTime)-Mr(t.scheduleTime)))}}const q=g.map((({scheduleDate:e})=>e)),H={timeStamp:Date.now(),schedulingProfile:o,scheduledDates:q,noTimeMatchUpIds:C,scheduledMatchUpIds:M,overLimitMatchUpIds:T,requestConflicts:R},{topics:W}=ar();if(W.includes(uc))nr({topic:uc,payload:H});else{const e={itemType:"autoSchedulingAudit",itemValue:H};for(const t of Object.values(r))rc({tournamentRecord:t,timeItem:e})}return{...de,schedulingProfileModifications:c,schedulingProfileIssues:s,scheduleTimesRemaining:I,skippedScheduleTimes:b,recoveryTimeDeferredMatchUpIds:U,dependencyDeferredMatchUpIds:D,matchUpScheduleTimes:A,scheduledMatchUpIds:M,overLimitMatchUpIds:T,noTimeMatchUpIds:C,requestConflicts:R,scheduledDates:q}}({checkPotentialRequestConflicts:e,clearScheduleDates:t,tournamentRecords:r,scheduleDates:n,periodLength:i,dryRun:a})}function ff({event:e}){return e?Yc({event:e,name:Ki}):{error:ze}}function mf({tournamentParticipants:e,drawDefinition:t,participantId:n,matchUpId:r,event:i}){if(!n)return{error:Yt};if(!r)return{error:ht};if(e&&e.length){const{matchUp:a}=xu({tournamentParticipants:e,inContext:!0,drawDefinition:t,matchUpId:r,event:i});if(!a)return{error:ft};const{error:o,checkedInParticipantIds:s,allRelevantParticipantIds:c}=Eu({matchUp:a});if(!c.includes(n))return{error:Vt};if(o)return{error:o};if(s.includes(n))return{error:tn}}return Lu({drawDefinition:t,matchUpId:r,timeItem:{itemType:li,itemValue:n}})}function hf({tournamentParticipants:e,drawDefinition:t,participantId:n,matchUpId:r,event:i}){if(!n)return{error:Yt};if(!r)return{error:lt};if(e&&e.length){const{matchUp:a}=xu({tournamentParticipants:e,inContext:!0,drawDefinition:t,matchUpId:r,event:i}),{checkedInParticipantIds:o,allRelevantParticipantIds:s}=Eu({matchUp:a});if(!s.includes(n))return{error:Vt};if(!o.includes(n))return{error:en};const{sideParticipantIds:c,nestedIndividualParticipantIds:u}=Tu({matchUp:a}),d=c.indexOf(n);[0,1].includes(d)&&(u[d]||[]).forEach((e=>{Lu({drawDefinition:t,matchUpId:r,timeItem:{itemType:pi,itemValue:e}})}))}return Lu({drawDefinition:t,matchUpId:r,timeItem:{itemType:pi,itemValue:n}})}function vf(e){if(null==e||!e.tournamentRecord)return{error:me};const{tournamentRecord:t,participantId:n,matchUpId:r,drawDefinition:i}=e,a=t.participants||[],{matchUp:o}=hd({tournamentRecord:t,drawDefinition:i,matchUpId:r,inContext:!0});if(!o)return{error:ft};const{checkedInParticipantIds:s=[]}=Eu({matchUp:o});return s.includes(n)?hf({drawDefinition:i,tournamentParticipants:a,matchUpId:r,participantId:n}):mf({drawDefinition:i,tournamentParticipants:a,matchUpId:r,participantId:n})}function gf(e){const{tournamentRecords:t}=e;if(!t)return{error:fe};const{tournamentId:n,drawId:r,matchUpId:i,courtDayDate:a}=e,o=t[n];if(!o)return{error:me};const{drawDefinition:s}=ba({tournamentRecord:o,drawId:r});return Gu({tournamentRecord:o,drawDefinition:s,matchUpId:i,courtId:"",courtDayDate:a})}const If="OTHER",yf="OFFICIAL",bf="COMPETITOR",wf={OTHER:If,COACH:"COACH",MEDIA:"MEDIA",CAPTAIN:"CAPTAIN",MEDICAL:"MEDICAL",OFFICIAL:yf,SECURITY:"SECURITY",COMPETITOR:bf,ADMINISTRATION:"ADMINISTRATION"};function Uf(e){return Hu(e)}function Sf({drawDefinition:e,matchUpId:t,disableNotice:n,scheduledDate:r}){return Wu({drawDefinition:e,matchUpId:t,disableNotice:n,scheduledDate:r})}function Df({drawDefinition:e,scheduledTime:t,matchUpId:n,disableNotice:r}){return zu({drawDefinition:e,matchUpId:n,scheduledTime:t,disableNotice:r})}function Nf({drawDefinition:e,matchUpId:t,startTime:n,disableNotice:r}){return Yu({drawDefinition:e,matchUpId:t,startTime:n,disableNotice:r})}function Pf({drawDefinition:e,matchUpId:t,endTime:n,disableNotice:r}){return $u({drawDefinition:e,matchUpId:t,endTime:n,disableNotice:r})}function Af({drawDefinition:e,matchUpId:t,stopTime:n,disableNotice:r}){return Ju({drawDefinition:e,matchUpId:t,stopTime:n,disableNotice:r})}function Mf({drawDefinition:e,matchUpId:t,resumeTime:n,disableNotice:r}){return Zu({drawDefinition:e,matchUpId:t,resumeTime:n,disableNotice:r})}function Tf({tournamentRecord:e,drawDefinition:t,participantId:n,officialType:r,matchUpId:i,disableNotice:a}){if(!n)return{error:Yt};const{tournamentParticipants:o}=Dp({tournamentRecord:e,participantFilters:{participantTypes:[Oa],participantRoles:[yf]}});if(!na({tournamentParticipants:o,participantId:n}))return{error:$t};return Ku({drawDefinition:t,participantId:n,officialType:r,matchUpId:i,disableNotice:a})}function Ef({tournamentRecord:e,scheduleChange:t,matchUpIds:n,dryRun:r}){if(!e)return{error:me};if(!n||!Array.isArray(n))return{error:pt};if("object"!=typeof t)return{error:jn};const i=[],a=[],{minutesChange:o,daysChange:s}=t;if(!o&&!s)return{...de};if(o&&isNaN(o))return{error:jn};if(s&&isNaN(s))return{error:jn};const{matchUps:c}=ud({tournamentRecord:e,matchUpFilters:{matchUpIds:n}}),u=null==c?void 0:c.filter(up).filter((({matchUpStatus:e})=>!j.includes(e)));if(!u.length)return{...de};const{tournamentInfo:d}=Nd({tournamentRecord:e}),{startDate:l,endDate:p}=d,f=u.reduce(((e,t)=>{const{matchUpId:n,drawId:r}=t;return e[r]?e[r].push(n):e[r]=[n],e}),{});for(const h of Object.keys(f)){const{drawDefinition:t,error:c}=ba({tournamentRecord:e,drawId:h});if(c)return{error:c};const d=f[h].filter((e=>n.includes(e)));for(const e of d)if(e&&t){const n=u.find((t=>t.matchUpId===e)),c=n.schedule,{scheduledTime:d,scheduledDate:f}=c;let m,h,v;if(o&&d){const e=Cr(d),t=Mr(Er(d))+o;if(m=t<0||t>1440,!m){let t=kr(d,o);h=e?`${e}T${t}`:t}}if(!m&&s&&f){v=Rr(Cr(f),s),m=new Date(v)<new Date(l)||new Date(v)>new Date(p)}if(m)a.push(n);else{if(!r){if(h){const n=Df({drawDefinition:t,matchUpId:e,scheduledTime:h});if(n.error)return n}if(v){const n=Sf({drawDefinition:t,matchUpId:e,scheduledDate:v});if(n.error)return n}}(h||v)&&i.push(n)}}}const m=i.length&&!a.length;return{...de,rescheduled:i,notRescheduled:a,allRescheduled:m}}function Cf({tournamentRecord:e,dailyLimits:t}){if(!e)return{error:me};if("object"!=typeof t)return{error:Fn};return Hc({tournamentRecord:e,extension:{name:zi,value:{dailyLimits:t}}})}function Rf({tournamentRecords:e,tournamentId:t,drawId:n}){if(!e)return{error:fe};if("string"!=typeof t&&!(t=Id({tournamentRecords:e,drawId:n})))return{error:ve};const r=e[t];if(!r)return{error:me};const{drawDefinition:i,error:a}=ya({tournamentRecord:r,drawId:n});return{drawDefinition:i,error:a,tournamentRecord:r}}const Of={scheduleMatchUps:function({tournamentRecords:e,competitionMatchUps:t,matchUpDependencies:n,allDateMatchUpIds:r=[],averageMatchUpMinutes:i=90,recoveryMinutes:a=0,recoveryMinutesMap:o,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:c={},matchUpNotBeforeTimes:u={},matchUpDailyLimits:d={},checkPotentialRequestConflicts:l=!0,remainingScheduleTimes:p,clearScheduleDates:f,periodLength:m=30,scheduleDate:h,matchUpIds:v,venueIds:g,startTime:I,endTime:b,dryRun:U}){if(!e)return{error:fe};if(!v)return{error:pt};if(!yr(h))return{error:xt};if(isNaN(m)||isNaN(i)||isNaN(a))return{error:jn};t||({matchUps:t}=jd({tournamentRecords:e,nextMatchUps:!0})),n||({matchUpDependencies:n}=Vd({tournamentRecords:e,includeParticipantDependencies:!0,matchUps:t})),t.forEach((e=>{var t;null!==(t=e.schedule)&&void 0!==t&&t.scheduledDate&&_r(h,Cr(e.schedule.scheduledDate))&&Kp({matchUp:e,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s})}));const D=v.map((e=>t.find((t=>t.matchUpId===e)))).filter(Boolean),{venueId:P,scheduleTimes:A,dateScheduledMatchUpIds:M}=qp({tournamentRecords:e,remainingScheduleTimes:p,startTime:Er(I),endTime:Er(b),scheduleDate:Cr(h),averageMatchUpMinutes:i,clearScheduleDates:f,periodLength:m,venueIds:g}),T={},C=[],R={},x={},L={};t.filter((({matchUpId:e})=>M.includes(e))).forEach((e=>{var t;Wp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,scheduleDate:h,matchUp:e,value:1});const r=null===(t=e.schedule)||void 0===t?void 0:t.scheduledTime;if(r){R[e.matchUpId]=r;const t=null==o?void 0:o[e.matchUpId];Yp({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:u,matchUpDependencies:n,recoveryMinutes:t||a,averageMatchUpMinutes:i,scheduleDate:h,scheduleTime:r,matchUp:e})}}));let k=D.filter((e=>{const t=M.includes(e.matchUpId),n=[w,N,S,y,E,O].includes(null==e?void 0:e.matchUpStatus);return!t&&!e.winningSide&&!n}));const{matchUpMap:F,overLimitMatchUpIds:j,participantIdsAtLimit:_}=k.reduce(((e,t)=>{const{drawId:n,tournamentId:r,matchUpType:i}=t,{participantIdsAtLimit:a,relevantParticipantIds:o}=tf({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpDailyLimits:d,matchUp:t});return null!=a&&a.length?(e.overLimitMatchUpIds.push(t.matchUpId),e.participantIdsAtLimit.push(...a),e):(o.forEach((e=>{Hp({individualParticipantProfiles:c,participantId:e});const t=c[e].counters;t[i]?t[i]+=1:t[i]=1,t[fa]?t[fa]+=1:t[fa]=1})),e.matchUpMap[r]||(e.matchUpMap[r]={}),e.matchUpMap[r][n]?e.matchUpMap[r][n].push(t):e.matchUpMap[r][n]=[t],Kp({matchUp:t,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s}),e)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});k=k.filter((({matchUpId:e})=>!j.includes(e)));let B=0;const G=(null==A?void 0:A.length)||0,{personRequests:V}=nf({tournamentRecords:e,requestType:Jp});for(;null!=A&&A.length&&k.length&&B<=G;){B++;const{scheduleTime:e}=A.shift(),d=k.find((d=>{const{matchUpId:p}=d,{dependenciesScheduled:f,remainingDependencies:m}=zp({matchUps:t,matchUpScheduleTimes:R,matchUpDependencies:n,allDateMatchUpIds:r,matchUp:d});if(!f)return L[p]||(L[p]=[]),L[p].push({scheduleTime:e,remainingDependencies:m}),!1;const{enoughTime:v}=Xp({individualParticipantProfiles:c,matchUpNotBeforeTimes:u,matchUpDependencies:n,scheduleTime:e,matchUp:d});if(!v)return x[p]||(x[p]=[]),x[p].push({scheduleTime:e}),!1;const{conflicts:g}=Qp({potentials:l,averageMatchUpMinutes:i,requestConflicts:T,personRequests:V,scheduleTime:e,scheduleDate:h,matchUp:d});if(null!=g&&g.length)return!1;const I=null==o?void 0:o[d.matchUpId];return Yp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUpNotBeforeTimes:u,averageMatchUpMinutes:i,matchUpDependencies:n,recoveryMinutes:I||a,scheduleDate:h,scheduleTime:e,matchUp:d}),R[d.matchUpId]=e,!0}));k=k.filter((({matchUpId:e})=>e!==(null==d?void 0:d.matchUpId))),d||C.push(e)}k.forEach((e=>{Wp({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,scheduleDate:h,value:-1,matchUp:e})}));let q=[];Object.keys(F).forEach((t=>{const n=e[t];n?Object.keys(F[t]).forEach((e=>{const{drawDefinition:r}=ba({tournamentRecord:n,drawId:e});if(r){F[t][e].forEach((({matchUpId:e})=>{const t=R[e];if(t){const i=t.split(":").map(jr).join(":"),a=`${Cr(h)}T${i}`;if(U)q.push(e);else{zu({drawDefinition:r,matchUpId:e,scheduledTime:a}).success&&q.push(e),P&&ju({tournamentRecord:n,drawDefinition:r,matchUpId:e,venueId:P})}}}))}})):Xn()&&console.log(ve)}));const H=Tc(k);return{...de,requestConflicts:Object.values(T),remainingScheduleTimes:A.map((({scheduleTime:e})=>e)),individualParticipantProfiles:c,matchUpNotBeforeTimes:u,participantIdsAtLimit:_,skippedScheduleTimes:C,overLimitMatchUpIds:j,scheduledMatchUpIds:q,noTimeMatchUpIds:H,recoveryTimeDeferred:x,dependencyDeferred:L}},scheduleProfileRounds:pf,clearScheduledMatchUps:sf,bulkRescheduleMatchUps:function({tournamentRecords:e,scheduleChange:t,matchUpIds:n,dryRun:r}){if(!e)return{error:fe};if(!n||!Array.isArray(n))return{error:pt};if("object"!=typeof t)return{error:jn};const i=[];let a=[];for(const u of Object.values(e)){var o;const e=Ef({tournamentRecord:u,scheduleChange:t,matchUpIds:n,dryRun:r});if(e.error)return e;Array.isArray(e.notRescheduled)&&a.push(...e.notRescheduled);const c=Tc(e.notRescheduled),d=[];var s;if(null===(o=e.rescheduled)||void 0===o||o.forEach((e=>{const{matchUpId:t}=e;c.includes(t)&&d.push(t),i.push(e)})),d.length)a=(null==e||null===(s=e.notRescheduled)||void 0===s?void 0:s.filter((({matchUpId:e})=>!d.includes(e))))||[]}const c=i.length&&!a.length;return{...de,rescheduled:i,notRescheduled:a,allRescheduled:c}},getScheduledRoundsDetails:Vp,getMatchUpDependencies:Vd,generateVirtualCourts:Ys,generateBookings:df,matchUpScheduleChange:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:fe};const{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:i,targetCourtId:a,courtDayDate:o}=e||{},{drawId:s,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:l,tournamentId:p}=r||{};if(!c&&!l)return{error:Mt};let f=0;if(a&&c&&!l){const e=m({tournamentId:u,drawId:s,courtDayDate:o,matchUpId:c,courtId:a});if(null!=e&&e.success&&f++,e.error)return e}else if(i&&a&&c&&l){const e=m({tournamentId:u,drawId:s,courtDayDate:o,matchUpId:c,courtId:a});if(e.success&&f++,e.error)return e;const t=m({tournamentId:p,drawId:d,courtDayDate:o,matchUpId:l,courtId:i});if(t.success&&f++,t.error)return t}return f?de:{error:Ln};function m({tournamentId:e,drawId:n,matchUpId:r,courtDayDate:i,courtId:a}){const o=t[e],{drawDefinition:s}=ba({tournamentRecord:o,drawId:n});return Gu({tournamentRecord:o,drawDefinition:s,matchUpId:r,courtId:a,courtDayDate:i})}},calculateScheduleTimes:qp,reorderUpcomingMatchUps:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:fe};const{matchUpsContextIds:n,firstToLast:r}=e;if(!n)return{error:Mt};const i=null==n?void 0:n.length;if(!i)return de;let a=0;return n.forEach(((e,o)=>{const{tournamentId:s,drawId:c,matchUpId:u}=e;let d=o+(r?-1:1);d<0&&(d=i-1),d===i&&(d=0);const l=function({tournamentId:e,drawId:n,matchUpId:r,scheduledTime:i}){const a=t[e],{drawDefinition:o}=ba({tournamentRecord:a,drawId:n});return zu({drawDefinition:o,matchUpId:r,scheduledTime:i})}({tournamentId:s,drawId:c,matchUpId:u,scheduledTime:n[d].schedule.scheduledTime});if(!l.success)return l;a++})),a===i?de:{error:xn}},bulkUpdateCourtAssignments:function({tournamentRecords:e,courtAssignments:t,courtDayDate:n}){if(!e)return{error:fe};if(!Array.isArray(t))return{error:Mt};const r=t.reduce(((e,t)=>{const{tournamentId:n}=t;return e[n]||(e[n]=[]),e[n].push(t),e}),{});let i;return Object.keys(r).every((t=>{const a=e[t];if(!a)return i={error:me},!1;const o=r[t].reduce(((e,t)=>{const{drawId:n}=t;return e[n]||(e[n]=[]),e[n].push(t),e}),{});Object.keys(o).every((e=>{const{drawDefinition:t}=ya({tournamentRecord:a,drawId:e});return t?(o[e].every((e=>{const{matchUpId:r,courtId:o}=e,s=Gu({tournamentRecord:a,drawDefinition:t,courtDayDate:n,matchUpId:r,courtId:o});if(s.success)return null==s?void 0:s.success;i={error:"Unable to assign court"}})),!0):(i={error:Ie},!1)}))})),i||de},removeMatchUpCourtAssignment:gf,toggleParticipantCheckInState:function(e){const{tournamentRecords:t}=e,{participantId:n,tournamentId:r,matchUpId:i,drawId:a}=e;if(!(t&&r&&n&&i))return{error:Mt};const o=t[r],{drawDefinition:s}=ba({tournamentRecord:o,drawId:a});return Object.assign(e,{drawDefinition:s,tournamentRecord:o}),vf(e)},findMatchUpFormatTiming:Gp,modifyMatchUpFormatTiming:function({tournamentRecords:e,matchUpFormat:t,recoveryTimes:n,averageTimes:r,tournamentId:i,eventId:a}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const o=Object.keys(e).filter((e=>!i||i===e));if(i&&!o.includes(i))return{error:jn};let s;for(const c of o){const i=e[c],{event:o}=ya({tournamentRecord:i,eventId:a});a&&o&&(s=!0);const u=Lp({tournamentRecord:i,event:o,matchUpFormat:t,averageTimes:r,recoveryTimes:n});if(u.error)return u}return!a||s?{...de}:{error:Ke}},modifyEventMatchUpFormatTiming:function({tournamentRecords:e,tournamentId:t,eventId:n,categoryType:r,matchUpFormat:i,averageMinutes:a,recoveryMinutes:o}){if(!n)return{error:ze};const s=Object.keys(e).filter((e=>!t||t===e));if(t&&!s.includes(t))return{error:jn};for(const c of s){const t=e[c],{event:s}=ya({tournamentRecord:t,eventId:n});if(s)return Fp({tournamentRecord:t,event:s,categoryType:r,matchUpFormat:i,averageMinutes:a,recoveryMinutes:o})}return{error:Ke}},getMatchUpFormatTimingUpdate:function({tournamentRecords:e}){return jp({tournamentRecords:e,extensionName:Ki})},getEventMatchUpFormatTiming:function({tournamentRecords:e,matchUpFormats:t,categoryType:n,tournamentId:r,eventId:i}){if(!i)return{error:ze};const a=Object.keys(e).filter((e=>!r||e===r));if(r&&!a.length)return{error:jn};let o,s,c;return a.find((r=>{const a=e[r],{event:u}=ya({tournamentRecord:a,eventId:i});if(!u)return!1;c=!0;const{eventMatchUpFormatTiming:d,error:l}=_p({tournamentRecord:a,matchUpFormats:t,categoryType:n,event:u});return l&&(s=l),o=d,!0})),c?s?{error:s}:{eventMatchUpFormatTiming:o}:{error:Ke}},removeEventMatchUpFormatTiming:function({tournamentRecords:e,eventId:t}){if(!e)return{error:fe};if("string"!=typeof t)return{error:Mt};for(const n of Object.values(e)){const{event:e}=ya({tournamentRecord:n,eventId:t});if(e)return ff({event:e})}return{error:Ke}},getMatchUpDailyLimits:uf,setMatchUpDailyLimits:function({tournamentRecords:e,tournamentId:t,dailyLimits:n}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const r=Object.keys(e).filter((e=>!t||t===e));if(t&&!r.includes(t))return{error:jn};for(const i of r){const t=Cf({tournamentRecord:e[i],dailyLimits:n});if(t.error)return t}return de},getMatchUpDailyLimitsUpdate:function({tournamentRecords:e}){return jp({tournamentRecords:e,extensionName:zi})},assignMatchUpVenue:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{matchUpId:i,venueId:a,disableNotice:o}=e;return ju({tournamentRecord:t,drawDefinition:n,disableNotice:o,matchUpId:i,venueId:a})},assignMatchUpCourt:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{matchUpId:i,courtId:a,courtDayDate:o,disableNotice:s}=e;return Gu({tournamentRecord:t,disableNotice:s,drawDefinition:n,courtDayDate:o,matchUpId:i,courtId:a})},addMatchUpScheduleItems:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);return r?{error:r}:Uf({...e,tournamentRecord:t,drawDefinition:n})},addMatchUpScheduledDate:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{disableNotice:i,scheduledDate:a,matchUpId:o}=e;return Sf({tournamentRecord:t,drawDefinition:n,disableNotice:i,scheduledDate:a,matchUpId:o})},addMatchUpScheduledTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{disableNotice:i,scheduledTime:a,matchUpId:o}=e;return Df({tournamentRecord:t,drawDefinition:n,disableNotice:i,scheduledTime:a,matchUpId:o})},addMatchUpStartTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{disableNotice:i,startTime:a,matchUpId:o}=e;return Nf({tournamentRecord:t,drawDefinition:n,disableNotice:i,startTime:a,matchUpId:o})},addMatchUpStopTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{disableNotice:i,stopTime:a,matchUpId:o}=e;return Af({tournamentRecord:t,drawDefinition:n,disableNotice:i,stopTime:a,matchUpId:o})},addMatchUpResumeTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{disableNotice:i,resumeTime:a,matchUpId:o}=e;return Mf({tournamentRecord:t,drawDefinition:n,disableNotice:i,resumeTime:a,matchUpId:o})},addMatchUpEndTime:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{disableNotice:i,endTime:a,matchUpId:o}=e;return Pf({tournamentRecord:t,drawDefinition:n,disableNotice:i,endTime:a,matchUpId:o})},addMatchUpOfficial:function(e){const{tournamentRecord:t,drawDefinition:n,error:r}=Rf(e);if(r)return{error:r};const{disableNotice:i,participantId:a,officialType:o,matchUpId:s}=e;return Tf({tournamentRecord:t,drawDefinition:n,disableNotice:i,participantId:a,officialType:o,matchUpId:s})},getSchedulingProfile:Rd,setSchedulingProfile:Od,addSchedulingProfileRound:xd,isValidSchedulingProfile:Sd,addPersonRequests:function({tournamentRecords:e,personId:t,requests:n}){if(!e)return{error:fe};if("string"!=typeof t)return{error:jn};if(!Array.isArray(n))return{error:jn};const{personRequests:r}=nf({tournamentRecords:e}),{mergeCount:i}=af({personRequests:r,personId:t,requests:n});return i?rf({tournamentRecords:e,personRequests:r}):{error:jn}},getPersonRequests:nf,modifyPersonRequests:function({tournamentRecords:e,requests:t,personId:n}){if(!e)return{error:fe};if(!Array.isArray(t))return{error:jn};const r=t.map((({requestId:e})=>e)).filter(Boolean),{personRequests:i}=nf({tournamentRecords:e}),a=e=>{i[e]=i[e].map((e=>{if(!r.includes(e.requestId))return e;const n=t.find((t=>t.requestId===e.requestId));return n.requestType?Object.assign(e,n):void 0})).filter(Boolean)};if(n&&i[n])a(n);else for(const s of Object.keys(i))a(s);const o=t.filter((e=>!e.requestId));return o.length&&af({personRequests:i,personId:n,requests:o}),rf({tournamentRecords:e,personRequests:i})},removePersonRequests:function({tournamentRecords:e,requestType:t,requestId:n,personId:r,date:i}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};const{personRequests:a}=nf({tournamentRecords:e}),o=e=>{a[e]=a[e].filter((e=>!(t&&e.requestType===t||n&&e.requestId===n||i&&e.date===i))),a[e].length||delete a[e]},s=!(t||n||r||i);if(!s)if(r&&a[r])o(r);else for(const c of Object.keys(a))o(c);return s||!Object.keys(a).length?Cd({tournamentRecords:e,name:Wi}):rf({tournamentRecords:e,personRequests:a})}};function xf({tournamentRecord:e,policyDefinitions:t,allowReplacement:n}){if(!e)return{error:me};if(!t||"object"!=typeof t)return{error:It};e.extensions||(e.extensions=[]);const{appliedPolicies:r}=Qi({tournamentRecord:e}),i=Object.keys(t).map((e=>{if(!r[e]||n)return r[e]=t[e],e})).filter(Boolean);if(null!=i&&i.length){const t=Hc({tournamentRecord:e,extension:{name:ki,value:r}});if(t.error)return t}return null!=i&&i.length?{...de,applied:i}:{error:Ut}}function Lf({policyDefinitions:e,allowReplacement:t,event:n}){if(!n)return{error:ze};if(!e)return{error:It};let r=0;n.extensions||(n.extensions=[]);const{appliedPolicies:i}=Xi({event:n});if(Object.keys(e).forEach((n=>{i[n]&&!t||(i[n]=e[n],r++)})),r){zc({event:n,extension:{name:ki,value:i}})}return r?de:{error:St}}const kf={attachPolicies:function({tournamentRecords:e,policyDefinitions:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:fe};for(const n of Object.values(e)){const e=xf({tournamentRecord:n,policyDefinitions:t,allowReplacement:!0});if(e.error)return e}return de}};function Ff(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antoina, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and challenging me.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}const jf="REFEREE",_f="SCHEDULE",Bf="SCORE",Gf="START",Vf="STATUS",qf={END:"END",NICKNAME:"NICKNAME",PENALTY:"PENALTY",REFEREE:jf,SCHEDULE:_f,SCORE:Bf,START:Gf,STATUS:Vf};function Hf({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:n,matchUpId:r,event:i}){var a,o,s;if(!t)return{error:Ie};if(!r)return{error:lt};const{matchUp:c,structure:u}=xu({drawDefinition:t,matchUpId:r,event:i}),{assignedPositions:d,allPositionsAssigned:l}=Au({structure:u}),{drawPositions:p}=c||{},{structureId:f}=u||{},m=[];if(!f)return{validActions:m};const h=wl({drawDefinition:t,structure:u}),v=d.filter((e=>e.participantId)).map((e=>e.drawPosition)),g=d.filter((e=>e.bye)).map((e=>e.drawPosition)),I=c.collectionId,y=c.matchUpStatus===w||!I&&(null===(a=c.drawPositions)||void 0===a?void 0:a.reduce(((e,t)=>g.includes(t)||e),!1));if(y)return{validActions:m,isByeMatchUp:y};const b=null==p?void 0:p.reduce(((e,t)=>v.includes(t)&&e),2===(null==p?void 0:p.length));m.push({type:jf});const U=!qd({matchUpStatus:c.matchUpStatus}),{appliedPolicies:S}=xc({drawDefinition:t}),D=null==S||null===(o=S.scoring)||void 0===o?void 0:o.structures,N=(null==D?void 0:D.stage)&&(null==D?void 0:D.stage[u.stage]),A=(null==N?void 0:N.stageSequence)&&N.stageSequence[u.stageSequence],M=!((null==S||null===(s=S.scoring)||void 0===s?void 0:s.requireAllPositionsAssigned)||(null==N?void 0:N.requireAllPositionsAssigned)||(null==A?void 0:A.requireAllPositionsAssigned))||l,T=c.sides&&2===c.sides.filter((e=>e&&e.participantId)).length;let E;const C=c.matchUpStatus===P;if(C){n=n||kc({drawDefinition:t}),e||({matchUps:e}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:n}));E=_l({inContextDrawMatchUps:e,drawDefinition:t,targetData:nd({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:r})})}const R=(b||T)&&!(C&&E),{drawId:O}=t,x={type:_s,method:Es,payload:{drawId:O,matchUpId:r,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(U&&m.push({type:_f}),R&&m.push(x),U&&R&&m.push({type:Vf}),M&&R){const{matchUpId:e,matchUpFormat:t}=c,n={drawId:O,matchUpId:e,matchUpFormat:t,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};m.push({type:Bf,method:"setMatchUpStatus",message:"set outcome and winningSide",payload:n}),m.push({type:Gf}),m.push({type:"END"})}return{validActions:m,isDoubleWalkover:C,structureIsComplete:h}}function Wf({tournamentRecord:e,drawDefinition:t,matchUpId:n,drawId:r}){if(!e)return{error:me};if(!r){const{matchUps:i}=ud({tournamentRecord:e});r=i.reduce(((e,t)=>t.matchUpId===n?t.drawId:e),void 0);t=(e.events||[]).map((e=>e.drawDefinitions||[])).flat().reduce(((e,t)=>t.drawId===r?t:e),void 0)}return r?Hf({drawDefinition:t,matchUpId:n}):{error:be}}const zf={getCompetitionDateRange:Pd,getTournamentIds:function({tournamentRecords:e}){const t=Object.keys(e);return{...de,tournamentIds:t}},competitionScheduleMatchUps:_d,getSchedulingProfileIssues:function({tournamentRecords:e,scheduleDates:t=[]}={}){if("object"!=typeof e)return{error:he};if(!Array.isArray(t))return{error:jn};if(!t.every(yr))return{error:xt};const n=[];let r=0;const i={},{schedulingProfile:a}=Rd({tournamentRecords:e});if(!a)return{issues:n,...de};const{matchUps:o}=jd({tournamentRecords:e,nextMatchUps:!0});for(const s of a){const{scheduleDate:a,venues:c=[]}=s;if(null==t||!t.length||t.includes(a))for(const t of c||[])if(t){const{rounds:s}=t,c=[];let{orderedMatchUpIds:u,scheduledRoundsDetails:d}=Vp({tournamentRecords:e,periodLength:30,matchUps:o,rounds:s});const{matchUpDependencies:l}=Vd({tournamentRecords:e,matchUps:o}),p=e=>{let t;return d.find(((n,r)=>{const i=n.matchUpIds.includes(e);return i&&(t=r),i})),t};if(u.forEach(((e,t)=>{var n;const r=oe(u.slice(t+1),(null==l||null===(n=l[e])||void 0===n?void 0:n.matchUpIds)||[]);r.length&&c.push({matchUpId:e,shouldBeAfter:r})})),c.length){r+=c.length;const e=c.map((({matchUpId:e,shouldBeAfter:t})=>{const n=p(e),r=Q(t.map(p));return i[a]||(i[a]={}),i[a][n]||(i[a][n]=[]),r.forEach((e=>{i[a][n].includes(e)||i[a][n].push(e)})),{matchUpId:e,matchUpRoundIndex:n,earlierRoundIndices:r,shouldBeAfter:t}}));n.push(...e)}}}return{issuesCount:r,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...n.map((e=>{const{matchUpId:t,shouldBeAfter:n,earlierRoundIndices:r}=e;return{[t]:{earlierRoundIndices:r,shouldBeAfter:n}}})))},roundIndexShouldBeAfter:i,...de}},allCompetitionMatchUps:jd,competitionMatchUps:Bd,matchUpActions:function({tournamentRecords:e,tournamentId:t,matchUpId:n,eventId:r,drawId:i}={}){if("object"!=typeof e||"string"!=typeof t||"string"!=typeof n||"string"!=typeof i)return{error:jn};const a=e[t];if(!a)return{error:me};const{drawDefinition:o,error:s}=ya({tournamentRecord:a,eventId:r,drawId:i});return s?{error:s}:Wf({tournamentRecord:a,drawDefinition:o,drawId:i,matchUpId:n})},getCompetitionVenues:Md,getVenuesAndCourts:Ad,getVenuesReport:function({tournamentRecords:e,venueIds:t=[],dates:n=[]}){if(!Array.isArray(n))return{error:jn,dates:n};if(!Array.isArray(t))return{error:jn,venueIds:t};if(!n.every(yr))return{error:xt};const r=Ad({tournamentRecords:e});if(r.error)return r;const i=r.venues.filter((({venueId:e})=>!(null!=t&&t.length)||t.includes(e))),a=r.courts.reduce(((e,t)=>(t.dateAvailability.forEach((({date:t})=>{e.includes(t)||e.push(t)})),e)),[]).filter((e=>!n.length||n.includes(e))),o={venueIds:i.map((({venueId:e})=>e))},{matchUps:s}=jd({tournamentRecords:e,matchUpFilters:o});return{venuesReport:i.map((e=>function(e,t,n){const{venueId:r,courts:i,venueName:a}=t,o={};return e.forEach((e=>{let t=0,a=0,s=0;for(const n of i){const r=n.dateAvailability.find((t=>t.date===e)),i=r&&Ws({courtDate:r}),a=null==i?void 0:i.reduce(((e,t)=>{const{startTime:n,endTime:r}=t;return e+(Mr(r)-Mr(n))}),0);a&&(s+=1),t+=a}const c=n.filter((({schedule:t})=>t.venueId===r&&_r(e,t.scheduledDate)));c.forEach((({schedule:e})=>{const t=Er(e.scheduledTime),n=Mr(kr(t,e.averageMinutes))-Mr(t);a+=n}));const u=t?(a/t*100).toFixed(2):"100";o[e]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:t,scheduledMinutes:a,percentUtilization:u}})),{venueId:r,venueName:a,venueReport:o}}(a,e,s)))}},credits:Ff};function Kf({convertExtensions:e,removeExtensions:t}){const n=ur();return{tournamentId:sr(),tournamentRecords:Gr(n,e,!1,t)}}function Yf(){var e;const t=ur(),{extension:n}=Ed({tournamentRecords:t,name:qi}),r=(null==n||null===(e=n.value)||void 0===e?void 0:e.tournamentIds)||[];return Object.keys(t).forEach((e=>{r.includes(e)||delete t[e]})),lr(t)}function $f(e,t=!0){return"object"!=typeof e||Array.isArray(e)?{error:Fn}:e.tournamentId?dr(t?Gr(e):e):{error:jn}}function Jf(e,t=!0){if("object"!=typeof e)return{error:Fn};if(Array.isArray(e)){if(!(e.filter((({tournamentId:e})=>e)).length===e.length))return{error:pe};e=Object.assign({},...e.map((e=>({[e.tournamentId]:e}))))}else if(e.tournamentId)e={[e.tournamentId]:e};else{if(!Object.keys(e).every((t=>e[t].tournamentId===t)))return{error:pe}}return lr(t?Gr(e):e)}const Zf=function(){const e={getState:({convertExtensions:e,removeExtensions:t}={})=>Kf({convertExtensions:e,removeExtensions:t}),version:()=>"0.51.1",reset:()=>(lr({}),t())};return[Rp,kf,zf,Of].forEach((t=>{Object.keys(t).forEach((r=>{e[r]=e=>{if(Xn())return n(t[r],e);try{return n(t[r],e)}catch(i){console.log("%c ERROR","color: orange",{err:i})}}}))})),e.devContext=e=>(er(e),t()),e.getDevContext=e=>Xn(e),e.setState=(e,n,r)=>{tr(n,r);return t(Jf(e,n))},e.setTournamentRecord=(e,n,r)=>{tr(n,r);return t($f(e,n))},e.removeTournamentRecord=e=>t(fr(e)),e.removeUnlinkedTournamentRecords=()=>t(Yf()),e.executionQueue=(t,n)=>function(t,n){if(!Array.isArray(t))return{error:jn};const r=ur(),i=n&&Gr(r,!1,!0),a=[];for(const o of t){if("object"!=typeof o)return{error:jn};const{method:t,params:n}=o;if(!e[t])return{error:Yn};const s=e[t]({...n,tournamentRecords:r});if(null!=s&&s.error)return i&&Jf(i),{...s,rolledBack:!!i};a.push(s)}return Op(),ir(),{results:a}}(t,n),e;function t(t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function n(t,n){delete e.success,delete e.error;const r=ur(),i=(null==n?void 0:n.rollbackOnError)&&Gr(r,!1,!0),a=t({...n,tournamentRecords:r});null!=a&&a.error&&i&&Jf(i);const o=(null==a?void 0:a.success)&&!0!==(null==n?void 0:n.delayNotify);return o&&Op(),!o&&null!=a&&a.success||ir(),a}}();function Qf(e={}){return e.tournamentId||Object.assign(e,{tournamentId:Wr()}),(!e.startDate||Pr(e.startDate)||mr.test(e.startDate))&&(!e.endDate||Pr(e.endDate)||mr.test(e.endDate))?(e.extensions&&(e.extensions=e.filter(Gc)),{...e}):{error:xt}}function Xf(e,t){var n;if("object"!=typeof e)return{error:Fn};const r=(null===(n=e.unifiedTournamentId)||void 0===n?void 0:n.tournamentId)||e.tournamentId;if(!r)return{error:ve};const i=!1!==t?Gr(e):e;return lr({[r]:i}),pr(r),i}function em({convertExtensions:e,removeExtensions:t,tournamentId:n}={}){if("string"!=typeof n)return{};return{tournamentRecord:Gr(cr(n),e,!1,t)}}function tm(e,t,n){if(t){const{drawId:r}=t||t.matchUp&&t.matchUp.drawId;if(r){const{event:i,drawDefinition:a}=ya({tournamentRecord:e,drawId:r});if(t={...t,event:i,drawDefinition:a},n){const e=kc({drawDefinition:a}),{matchUps:n}=sd({drawDefinition:a,inContext:!0,includeByeMatchUps:!0,matchUpsMap:e});t.matchUpsMap=e,t.inContextDrawMatchUps=n}}if(t.eventId&&!t.event){const{event:n}=ya({tournamentRecord:e,eventId:t.eventId});n&&(t={...t,event:n})}}return t}function nm({tournamentParticipants:e,drawDefinition:t,event:n}){if(!t)return{error:Ie};const r=Gr(sd({tournamentParticipants:e,inContext:!0,drawDefinition:t,event:n}).matchUps,!1,!0),i=Q(r.reduce(((e,t)=>e.concat(...t.sides.map((e=>e.participantId)).filter(Boolean))),[])),a=Object.assign({},...i.map((e=>{const t=r.filter((t=>t.sides.map((e=>e.participantId)).filter(Boolean).includes(e)));return{[e]:t}})));return{participantIds:i,participantIdMatchUps:a}}function rm({byeAdvancements:e=!1,tournamentParticipants:t,drawDefinition:n}){if(!n)return{error:Ie};const{participantIds:r,participantIdMatchUps:i}=nm({tournamentParticipants:t,drawDefinition:n}),a=r.map((t=>{const n=i[t].filter((e=>[S,w].includes(e.matchUpStatus)||e.winningSide)),r=n.map((n=>{const r=n.sides.find((e=>e.bye)),i=n.sides.find((e=>e.participantId===t)).sideNumber;return(n.winningSide||e&&r&&i)===i?n.finishingPositionRange.winner:n.finishingPositionRange.loser})),a=e=>Math.abs(e[0]-e[1]),o=r.reduce(((e,t)=>e&&a(e)<a(t)?e:t),void 0);return{[t]:{relevantMatchUps:n,finishingPositionRanges:r,finishingPositionRange:o}}}));return Object.assign({},...a)}function im({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:n}){if(!e)return{error:me};if(!t||!n)return{error:Mt};const r=(e.participants||[]).find((e=>e.participantId===t));if(!r)return{error:$t};if(![xa,ka].includes(r.participantType))return{error:Ht,participantType:r.participantType};const{removed:i,error:a}=am({groupingParticipant:r,individualParticipantIds:n});return a?{error:a}:(i&&nr({topic:vc,payload:{participants:[r]}}),{...de,removed:i})}function am({groupingParticipant:e,individualParticipantIds:t=[]}){let n=0,r=[];return e?(e.individualParticipantIds||(e.individualParticipantIds=[]),e.individualParticipantIds=e.individualParticipantIds.filter((e=>{const r=null==t?void 0:t.includes(e);return r&&n++,!r})),r.length?{error:"Participants not removed",notRemoved:r}:{groupingParticipant:e,removed:n}):{removed:n}}function om({groupingType:e=xa,participantRole:t=bf,tournamentRecord:n,individualParticipantIds:r=[]}){if(!n)return{error:me};const i=n.participants||[];let a=0;return i.filter((n=>(n.participantRole===t||!n.participantRole)&&n.participantType===e)).forEach((e=>{const{removed:t}=am({groupingParticipant:e,individualParticipantIds:r});t&&a++})),a?de:{error:Zt}}function sm({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:n,removeFromOtherTeams:r}){if(!e)return{error:me};if(!t||!n)return{error:Mt};const i=e.participants||[],a=i.find((e=>e.participantId===t));if(!a)return{error:$t};if(![xa,ka].includes(a.participantType))return{error:Ht,participantType:a.participantType};const o=n.filter((e=>{const t=i.find((t=>t.participantId===e));return(null==t?void 0:t.participantType)!==Oa}));if(o.length)return{error:qt,invalidParticipantIds:o};a.individualParticipantIds||(a.individualParticipantIds=[]);const s=a.individualParticipantIds,c=n.filter((e=>!s.includes(e)));c.length&&(r&&om({tournamentRecord:e,individualParticipantIds:c}),a.individualParticipantIds=a.individualParticipantIds.concat(...c));const{topics:u}=ar();if(u.includes(vc)){const e=i.find((({participantId:e})=>e===t));nr({topic:vc,payload:{participants:[e]}})}return{...de,groupingParticipant:Gr(a),added:c.length}}function cm({tournamentRecord:e,participantAttribute:t,personAttribute:n,accessor:r,uuids:i}){if(!e)return{error:me};const a={},o=(e.participants||[]).filter((({participantType:e,participantRole:t})=>e===Oa&&t===bf));for(const l of o){const{value:e}=wp({element:l,accessor:r}),o=e||(n?l.person[n]:l[t]);if(o){if(!Object.keys(a).includes(o)){a[o]={participantName:o,participantId:(null==i?void 0:i.pop())||Wr(),participantType:xa,participantRole:bf,individualParticipantIds:[]};const e={name:Gi,value:n||t};Vc({element:a[o],extension:e})}a[o].individualParticipantIds.push(l.participantId)}}const s=Object.keys(a),c=(e.participants||[]).map((e=>{if(e.participantType!==xa)return;if(e.participantRole!==bf)return;const{extension:t}=ia({element:e,name:Gi}),n=null==t?void 0:t.value;return s.includes(n)?e.participantId:void 0})).filter(Boolean),u=[];let d=0;return Object.keys(a).forEach((t=>{const n=a[t],{participantId:r}=n;c.includes(r)||(e.participants.push(n),u.push(n),d++)})),d&&nr({topic:sc,payload:{participants:u}}),d?{...de,participantsAdded:d}:{error:"No matching participants found"}}const um="SCALE",dm="RATING",lm="RANKING",pm="SEEDING",fm={SCALE:um,RATING:dm,RANKING:lm,SEEDING:pm};function mm({participant:e,scaleAttributes:t,requireTimeStamp:n}){if(!e)return{error:zt};if("object"!=typeof t)return{error:jn};if(e.timeItems||(e.timeItems=[]),e&&Array.isArray(e.timeItems)){const{accessor:r,scaleType:i,eventType:a,scaleName:o}=t,s=[um,i,a,o].join("."),c=e.timeItems.filter((e=>(null==e?void 0:e.itemType)===s)).filter((e=>!n||(null==e?void 0:e.itemDate))).sort(((e,t)=>new Date(e.createdAt||void 0)-new Date(t.createdAt||void 0))).pop();if(c){const[e,t,n,i]=c.itemType.split(".");if(e!==um)return{error:Rn};const a=r&&wp({element:c.itemValue,accessor:r}),o=r?a.value:c.itemValue;return{scaleItem:{scaleDate:c.itemDate,scaleName:i,scaleType:t,eventType:n,scaleValue:o}}}return{error:On}}return{error:zt}}function hm({tournamentRecord:e,participantId:t,scaleItem:n}){let r,i;const a=n&&Object.keys(n)||[],o=["scaleType","eventType","scaleName"],s=o.filter((e=>a.includes(e))).length===o.length;if(!s)return{error:Rn};if(t&&s&&Array.isArray(e.participants)&&(i=e.participants.find((e=>e.participantId===t)),i)){const{valueChanged:e,error:t}=gm({participant:i,scaleItem:n});if(t)return{error:t};r=!e;const{topics:a}=ar();a.includes(vc)&&nr({topic:vc,payload:{participants:[i]}})}return r?{...de,message:Vn,existingValue:n.scaleValue}:i?{...de,newValue:n.scaleValue}:{error:$t}}function vm({scaleItem:e}){const t=e&&Object.keys(e),n=["scaleType","eventType","scaleName"];return!!(n.filter((e=>t.includes(e))).length===n.length)}function gm({participant:e,scaleItem:t}){if(!e)return{error:zt};const n=t&&Object.keys(t),r=["scaleType","eventType","scaleName"];if(!(r.filter((e=>n.includes(e))).length===r.length))return{error:Rn};const i=(new Date).toISOString();e.timeItems||(e.timeItems=[]);const{scaleItem:a}=mm({participant:e,scaleAttributes:t}),o=e=>[void 0,null,""].includes(e),s=!(o(null==a?void 0:a.scaleValue)&&o(t.scaleValue))&&(null==a?void 0:a.scaleValue)!==t.scaleValue;if(s){const{scaleType:n,eventType:r,scaleName:a}=t,o={itemType:[um,n,r,a].join("."),itemValue:t.scaleValue,itemDate:t.scaleDate,createdAt:i};t.scaleId&&(o.itemSubTypes=[t.scaleId]),e.timeItems.push(o)}return Object.assign({valueChanged:s,newValue:t.scaleValue},de)}function Im({teamDrawIds:e=[],tournamentRecord:t,participantIds:n}){var r;if(!t)return{error:me};if(null==n||!n.length)return{error:Qt};const i=(null===(r=t.participants)||void 0===r?void 0:r.length)||0;if(!i)return de;const{tournamentParticipants:a}=Dp({participantFilters:{participantIds:n},withStatistics:!0,tournamentRecord:t}),o=e.length&&(()=>{const{matchUps:r}=ud({tournamentRecord:t,matchUpFilters:{drawIds:e,matchUpTypes:[da]}});return oe(r.map((({sides:e})=>e.map((({participantId:e})=>e)))).flat().filter(Boolean),n)})(),s=a.filter((t=>{var n;return null===(n=t.draws)||void 0===n?void 0:n.filter((({drawId:t})=>!e.length||!e.includes(t))).length}));if(o.length||s.length)return{error:nn};t.participants=t.participants.filter((e=>!n.includes(e.participantId)));const c=i-t.participants.length;return om({tournamentRecord:t,individualParticipantIds:n}),c&&nr({topic:lc,payload:{participantIds:n}}),c?de:{error:_t}}const ym="MALE",bm="FEMALE",wm={ANY:"ANY",MALE:ym,FEMALE:bm,MIXED:"MIXED",OTHER:"OTHER"};function Um({updateParticipantName:e=!0,groupingParticipantId:t,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:i,participant:a}){if(!r)return{error:me};if(!a)return{error:zt};if(!a.participantId)return sp({tournamentRecord:r,participant:a});const{participant:o}=ra({tournamentRecord:r,participantId:a.participantId});if(!o)return sp({tournamentRecord:r,participant:a});const{individualParticipantIds:s,participantName:c,participantRole:u,participantType:d,onlineProfiles:l,person:p}=a,f={};if(l&&(f.onlineProfiles=l),c&&"string"==typeof c&&(f.participantName=c),Array.isArray(s)){const{tournamentParticipants:t}=Dp({tournamentRecord:r,participantFilters:{participantTypes:[Fa.INDIVIDUAL]}}),n=null==t?void 0:t.map(Cc);if(n){const r=s.filter((e=>"string"==typeof e&&n.includes(e)));([ka,la].includes(d)||d===La&&(2===r.length||i))&&(f.individualParticipantIds=r),o.participantType===Fa.PAIR&&e&&(f.participantName=function({individualParticipants:e,newValues:t}){const n=t.individualParticipantIds;let r=e.filter((({participantId:e})=>n.includes(e))).map((({person:e})=>null==e?void 0:e.standardFamilyName)).filter(Boolean).sort().join("/");1===n.length&&(r+="/Unknown");return r}({individualParticipants:t,newValues:f}))}}return Object.keys(wf).includes(u)&&(f.participantRole=u),Object.keys(Fa).includes(d)&&(f.participantType=d),o.participantType===Fa.INDIVIDUAL&&p&&function({updateParticipantName:e,existingParticipant:t,newValues:n,person:r}){const i={},{sex:a,personId:o,nationalityCode:s,standardFamilyName:c,standardGivenName:u}=r;a&&Object.keys(wm).includes(a)&&(i.sex=a);let d;o&&"string"==typeof o&&(i.personId=o);s&&"string"==typeof s&&s.length<4&&(i.nationalityCode=s);c&&"string"==typeof c&&c.length>1&&(i.standardFamilyName=c,d=!0);u&&"string"==typeof u&&u.length>1&&(i.standardGivenName=u,d=!0);if(d&&e){const e=`${i.standardGivenName} ${i.standardFamilyName}`;n.participantName=e}Object.assign(t.person,i)}({updateParticipantName:e,existingParticipant:o,newValues:f,person:p}),Object.assign(o,f),t&&sm({tournamentRecord:r,groupingParticipantId:t,individualParticipantIds:[o.participantId],removeFromOtherTeams:n}),nr({topic:vc,payload:{participants:[o]}}),Xn()?{...de,participant:Gr(o)}:{...de}}const Sm={addPenalty:Mp,modifyPenalty:Cp,removePenalty:Tp,getTournamentPenalties:Ep,addParticipant:sp,addParticipants:cp,deleteParticipants:Im,createGroupParticipant:function({tournamentRecord:e,participantId:t,individualParticipantIds:n=[],participantRoleResponsibilities:r,participantRole:i="OTHER",groupName:a}){if(!e)return{error:me};if(!a)return{error:Mt,message:"Missing groupName"};if(!Array.isArray(n))return{error:jn,message:"Invalid individualParticipantIds"};const{tournamentParticipants:o}=Dp({tournamentRecord:e,participantFilters:{participantTypes:[Oa]}}),s=o.map((e=>e.participantId));for(const l of n)if(!s.includes(l))return{error:Ht,participantId:l};const c=Vr({participantId:t||Wr(),participantType:ka,participantRole:i,participantName:a,individualParticipantIds:n,participantRoleResponsibilities:r}),u=sp({tournamentRecord:e,participant:c});if(u.error)return u;const{topics:d}=ar();return d.includes(sc)&&nr({topic:sc,payload:{participants:[c]}}),{...de,participant:Gr(c)}},addIndividualParticipantIds:sm,removeIndividualParticipantIds:im,modifyIndividualParticipantIds:function({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:n}){if(!e)return{error:me};if(!t||!n)return{error:Mt};const r=e.participants||[],i=r.find((e=>e.participantId===t));if(!i)return{error:$t};if(![xa,ka].includes(i.participantType))return{error:Ht,participantType:i.participantType};const a=n.filter((e=>{const t=r.find((t=>t.participantId===e));return(null==t?void 0:t.participantType)!==Oa}));if(a.length)return{error:qt,invalidParticipantIds:a};const o=i.individualParticipantIds||[],s=n.filter((e=>!o.includes(e))),c=o.filter((e=>!n.includes(e))),u=sm({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:s});if(u.error)return u;const d=im({tournamentRecord:e,groupingParticipantId:t,individualParticipantIds:c});if(d.error)return d;const{topics:l}=ar();if(l.includes(vc)){const e=r.find((({participantId:e})=>e===t));nr({topic:vc,payload:{participants:[e]}})}return{...u,...d}},removeParticipantIdsFromAllTeams:om,getParticipantMembership:function({tournamentRecord:e,participantId:t}){if(!e)return{error:me};if(!t)return{error:Yt};const{tournamentParticipants:n}=Dp({tournamentRecord:e,participantFilters:{participantTypes:[xa,La,ka]}});return(n||[]).filter((e=>{var n;return null===(n=e.individualParticipantIds)||void 0===n?void 0:n.includes(t)})).reduce(((e,t)=>{const{participantType:n}=t;return e[n]||(e[n]=[]),e[n].push(t),e}),{})},generateTeamsFromParticipantAttribute:cm,getParticipantIdFinishingPositions:function({tournamentRecord:e,drawDefinition:t,byeAdvancements:n=!1}){return e?rm({tournamentParticipants:e.participants,byeAdvancements:n,drawDefinition:t}):{error:me}},modifyParticipant:Um,modifyParticipantName:function({tournamentRecord:e,participantId:t,participantName:n}){if(!e)return{error:me};if(!t)return{error:Yt};if(!n)return{error:Mt,message:"Missing participantName"};const{participant:r}=ra({tournamentRecord:e,participantId:t});if(!r)return{error:$t};r.participantName=n;const{topics:i}=ar();return i.includes(vc)&&nr({topic:vc,payload:{participants:[r]}}),de},modifyParticipantOtherName:function({tournamentRecord:e,participantId:t,participantOtherName:n}){if(!e)return{error:me};if(!t)return{error:Yt};const{participant:r}=ra({tournamentRecord:e,participantId:t});if(!r)return{error:$t};r.participantOtherName=n;const{topics:i}=ar();return i.includes(vc)&&nr({topic:vc,payload:{participants:[r]}}),de},mergeParticipants:function({tournamentRecord:e,participants:t=[],arraysToMerge:n}){if(!e)return{error:me};e.participants||(e.participants=[]);const r=Object.assign(...t.filter(Xd).map((e=>({[e.participantId]:e})))),i=[];e.participants=e.participants.map((e=>{if(r[e.participantId]){const t=Np(e,r[e.participantId],n);return i.push(t),t}return e}));const a=e.participants.map(Cc),o=t.filter((({participantId:e})=>!a.includes(e))),{topics:s}=ar();return o.length&&(e.participants=e.participants.concat(...o),s.includes(sc)&&nr({topic:sc,payload:{participants:o}})),i.length&&s.includes(vc)&&nr({topic:vc,payload:{participants:i}}),o.length||i.length?de:void 0},getPairedParticipant:Pc,setParticipantScaleItem:hm,setParticipantScaleItems:function({tournamentRecord:e,scaleItemsWithParticipantIds:t=[]}){if(!e)return{error:me};if(!e.participants)return{error:Kt};let n=0;const r={},i=[];for(const s of t){const e=null==s?void 0:s.participantId;Array.isArray(null==s?void 0:s.scaleItems)&&s.scaleItems.forEach((t=>{if(!vm({scaleItem:t}))return{error:Rn};Array.isArray(r[e])||(r[e]=[]),r[e].push(t)}))}e.participants.forEach((e=>{const{participantId:t}=e||{};Array.isArray(r[t])&&r[t].forEach((t=>{gm({participant:e,scaleItem:t}),i.push(e),n++}))}));const a=!n&&Ln,{topics:o}=ar();return o.includes(vc)&&n&&nr({topic:vc,payload:{participants:i}}),{...de,modificationsApplied:n,message:a}},modifyParticipantsSignInStatus:function({tournamentRecord:e,participantIds:t,signInState:n}){if(!e)return{error:me};if(!Array.isArray(t))return{error:Mt};if(![gp,Ip].includes(n))return{error:jn,signInState:n};const r=e.participants||[];if(!r.length)return{error:Kt};const i=[],a=(new Date).toISOString();for(const s of r){const{participantId:r}=s;if(t.includes(r)){const t=nc({tournamentRecord:e,duplicateValues:!1,participantId:r,timeItem:{itemType:pp,itemValue:n,createdAt:a}});if(t.error)return t;i.push(s)}}const{topics:o}=ar();return i.length&&o.includes(vc)&&nr({topic:vc,payload:{participants:i}}),{...de}},getParticipantEventDetails:function({tournamentRecord:e,participantId:t}){if(!e)return{error:me};if(!t)return{error:Yt};const n=[t].concat((e.participants||[]).filter((e=>{var n;return[xa,La].includes(e.participantType)&&(null===(n=e.individualParticipantIds)||void 0===n?void 0:n.includes(t))})).map((e=>e.participantId)));return{eventDetails:(e.events||[]).filter((e=>se(((null==e?void 0:e.entries)||[]).map((e=>e.participantId)),n))).map((e=>({eventName:e.eventName,eventId:e.eventId})))}},findParticipant:function({tournamentRecord:e,policyDefinitions:t,convertExtensions:n,participantId:r,inContext:i,personId:a}){return e?"string"!=typeof r&&"string"!=typeof a?{error:Mt}:{participant:Gr(na({tournamentParticipants:e.participants||[],policyDefinitions:t,participantId:r,personId:a,inContext:i}),n,!0)}:{error:me}},getTournamentParticipants:Dp,getTournamentPersons:function({tournamentRecord:e,participantFilters:t}){if(!e)return{error:me};let n=e.participants||[];t&&(n=Up({tournamentRecord:e,participantFilters:t,participants:n}));const r={},i=e=>{if(e.person){const{personId:t}=e.person;r[t]?r[t].participantIds.push(e.participantId):r[t]={...e.person,participantIds:[e.participantId]}}};return n.forEach((e=>{e.person&&i(e),e.individualParticipants&&e.individualParticipants.forEach(i)})),{tournamentPersons:Object.values(r)}}};function Dm({tournamentRecord:e,courtId:t}){if(!e)return{error:me};if(!t)return{error:At};const{court:n,error:r}=_u({tournamentRecord:e,courtId:t});if(r)return{error:r};const i=(({altitude:e,courtId:t,courtName:n,courtDimensions:r,latitude:i,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d})=>({altitude:e,courtId:t,courtName:n,courtDimensions:r,latitude:i,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d}))(n);return{...de,courtInfo:Gr(i)}}function Nm({tournamentParticipants:e=[],policyDefinitions:t,inContext:n=!0,drawDefinition:r,context:i,event:a}){if(!r)return{error:Ie};const o=(({drawId:e,drawName:t,matchUpFormat:n,updatedAt:r})=>({matchUpFormat:n,updatedAt:r,drawName:t,drawId:e}))(r);let s,c;const{structureGroups:u}=function({drawDefinition:e}){let t=(e.links||[]).map((e=>[e.source.structureId,e.target.structureId]));const n=t.length;ie(0,Math.ceil(n/2)).forEach((()=>{t=ie(0,n).map((e=>{const n=t[e],r=t.reduce(((e,t)=>se(n,t)?e.concat(...t):e),[])||[];return Q(n.concat(...r))}))}));const r=t[0],i=(e,t)=>oe(e,t).length===e.length,a=t.slice(1).reduce(((e,t)=>e&&i(t,r)),!0),o=[r].filter(Boolean);(e.structures||[]).forEach((e=>{const{structureId:t}=e;o.find((e=>e.includes(t)))||o.push([t])}));const s=a&&1===o.length;return{structureGroups:o,allStructuresLinked:s}}({drawDefinition:r});let d=!1,l=!1;const p=u.map((u=>{const p=u.map((e=>{const{structure:t}=_c({drawDefinition:r,structureId:e}),{seedAssignments:n}=Su({drawDefinition:r,structure:t});return t.stage===Lo&&1===t.stageSequence&&(s=n),t.stage===ko&&1===t.stageSequence&&(c=n),t})).sort(jc).map((u=>{const{structureId:p}=u;let f=[];[Lo,Fo,_o].includes(u.stage)&&(f=s),u.stage===ko&&(f=c);const{matchUps:m,roundMatchUps:h}=Ou({context:{drawId:o.drawId,...i},tournamentParticipants:e,policyDefinitions:t,seedAssignments:f,drawDefinition:r,structure:u,inContext:n,event:a}),{positionAssignments:v}=Pu({structure:u}),g=v.filter(Xd).map((e=>{l=!0;const{drawPosition:t,participantId:n}=e,{extension:r}=ia({element:e,name:Ji});return r&&{drawPosition:t,participantId:n,participantResult:r.value}})).filter((e=>null==e?void 0:e.participantResult)),I=(({stage:e,stageSequence:t,structureName:n,structureType:r,matchUpFormat:i,positionAssignments:a})=>({stage:e,stageSequence:t,structureName:n,structureType:r,matchUpFormat:i,positionAssignments:a}))(u);return I.structureActive=m.reduce(((e,t)=>{var n;const r=[S,U,N,E,O,A,P].includes(t.matchUpStatus);return e||r||!!t.winningSide||!(null===(n=t.score)||void 0===n||!n.scoreStringSide1)}),!1),I.structureCompleted=m.reduce(((e,t)=>e&&[w,S,E,O,N,y].includes(t.matchUpStatus)),!0),I.structureActive&&(d=!0),{...I,structureId:p,roundMatchUps:h,seedAssignments:f,participantResults:g}}));return p.forEach((e=>delete e.positionAssignments)),p}));if(p.length>1){const e={error:"drawDefinition contains unlinked structures"};return Xn()&&console.log(e),e}const f=p.flat();return o.drawActive=d,o.participantPlacements=l,o.drawGenerated=null==f?void 0:f.reduce(((e,t)=>e||!(null==t||!t.roundMatchUps)),!1),o.drawCompleted=null==f?void 0:f.reduce(((e,t)=>e&&t.structureCompleted),!0),{...de,drawInfo:Gr(o),structures:Gr(f)}}function Pm({tournamentRecord:e,venueId:t}){if(!e)return{error:me};if(!t)return{error:Un};const{venue:n,error:r}=Fu({tournamentRecord:e,venueId:t});if(r)return{error:r};const i=(n.courts||[]).map((t=>(({courtInfo:e})=>({...e}))(Dm({tournamentRecord:e,courtId:t.courtId})))),a={...(({venueId:e,venueName:t,venueAbbreviation:n})=>({venueId:e,venueName:t,venueAbbreviation:n}))(n),courtsInfo:i};return{...de,venueData:Gr(a)}}function Am({tournamentRecord:e,event:t,policyDefinitions:n}){if(!e)return{error:me};if(!t)return{error:ze};const{eventId:r}=t,{tournamentId:i,endDate:a,participants:o}=e,s=Qu({participants:o}),c=(t.drawDefinitions||[]).map((e=>(({drawInfo:e,structures:t})=>({...e,structures:t}))(Nm({tournamentParticipants:s,policyDefinitions:n,drawDefinition:e,context:{eventId:r,tournamentId:i,endDate:a},event:t})))),{tournamentInfo:u}=Nd({tournamentRecord:e}),d=(e.venues||[]).map((t=>(({venueData:e})=>({...e}))(Pm({tournamentRecord:e,venueId:t.venueId})))),l={eventInfo:(({eventId:e,eventName:t,eventType:n,eventLevel:r,surfaceCategory:i,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:e,eventName:t,eventType:n,eventLevel:r,surfaceCategory:i,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(t),drawsData:c,venuesData:d,tournamentInfo:u},{timeItem:p}=ec({event:t,itemType:"PUBLISH.STATUS"});return l.eventInfo.publish={state:null==p?void 0:p.itemValue,createdAt:null==p?void 0:p.createdAt},{...de,eventData:Gr(l)}}const Mm={getTournamentInfo:Nd,getVenueData:Pm,getCourtInfo:Dm,getAllEventData:function({tournamentRecord:e,policyDefinitions:t}){if(!e)return{error:me};const n=e.events||[],r=(null==e?void 0:e.participants)||[],{tournamentInfo:i}=Nd({tournamentRecord:e}),{venues:a}=ku({tournamentRecord:e});return{allEventData:{tournamentInfo:i,venuesData:a,eventsData:n.map((n=>{const{eventId:i}=n,a=(({eventId:e,eventName:t,eventType:n,eventLevel:r,surfaceCategory:i,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:e,eventName:t,eventType:n,eventLevel:r,surfaceCategory:i,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(n),o=ca({tournamentRecord:e,event:n}).scheduleTiming,s=(n.drawDefinitions||[]).map((a=>{const s=(({drawId:e,drawName:t,matchUpFormat:n,updatedAt:r})=>({drawId:e,drawName:t,matchUpFormat:n,updatedAt:r}))(a),{pendingMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,abandonedMatchUps:l}=cd({event:n,context:{eventId:i},inContext:!0,drawDefinition:a,scheduleTiming:o,policyDefinitions:t,tournamentRecord:e,includeByeMatchUps:!1,requireParticipants:!0,tournamentParticipants:r});return{drawInfo:s,matchUps:{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}}})),{timeItem:c}=ec({event:n,itemType:"PUBLISH.STATUS"});return Object.assign(a,{publish:null==c?void 0:c.itemValue,drawsData:s}),a}))}}},getEventData:Am,getDrawData:Nm,publishEvent:function({tournamentRecord:e,policyDefinitions:t,status:n=Pi,structureIds:r=[],drawIdsToRemove:i,drawIdsToAdd:a,drawIds:o,event:s}){var c,u,d;if(!e)return{error:me};if(!s)return{error:ze};const l="PUBLISH.STATUS",p=(null===(c=s.drawDefinitions)||void 0===c?void 0:c.map((({drawId:e})=>e)))||[];if(o||a||i){if(!o&&(null!=a&&a.length||null!=i&&i.length)){var f,m;const{timeItem:e}=ec({itemType:l,event:s});o=(null==e||null===(f=e.itemValue)||void 0===f||null===(m=f.PUBLIC)||void 0===m?void 0:m.drawIds)||[]}}else o=p;o=(o||[]).filter((e=>!(null!=i&&i.length&&i.includes(e)))),null!=a&&a.length&&(o=Q(o.concat(...a.filter((e=>p.includes(e)))))),ic({event:s,timeItem:{itemType:l,itemValue:{[n]:{drawIds:o,structureIds:r}}}});const{eventData:h}=Am({policyDefinitions:t,tournamentRecord:e,event:s}),v=null==h||null===(u=h.eventInfo)||void 0===u||null===(d=u.publish)||void 0===d?void 0:d.state;return h.drawsData=h.drawsData.filter((({drawId:e})=>{var t;return null==v||null===(t=v.PUBLIC)||void 0===t?void 0:t.drawIds.includes(e)})),nr({topic:Ic,payload:{eventData:h}}),{...de,eventData:h}},unPublishEvent:function({tournamentRecord:e,event:t}){return e?t?(ic({event:t,timeItem:{itemType:"PUBLISH.STATUS",itemValue:Ai}}),nr({topic:"unPublishEvent",payload:{eventId:t.eventId}}),Object.assign({eventId:t.eventId},de)):{error:ze}:{error:me}}};const Tm={addNotes:Zd,removeNotes:function({element:e}={}){return"object"!=typeof e?{error:jn}:(e.notes&&delete e.notes,de)},setTournamentName:function({tournamentRecord:e,tournamentName:t,promotionalName:n,formalName:r}){return e?(t&&(e.tournamentName=t),n&&(e.promotionalName=n),r&&(e.formalName=r),e.promotionalName===e.tournamentName&&delete e.promotionalName,e.formalName===e.tournamentName&&delete e.formalName,de):{error:me}},setTournamentNotes:function({tournamentRecord:e,notes:t}){return e?Zd({element:e,notes:t}):{error:me}},setTournamentEndDate:function({tournamentRecord:e,endDate:t}){return e?vr.test(t)?(e.endDate&&(new Date(t),new Date(e.endDate)),e.startDate&&new Date(t)<new Date(e.startDate)&&(e.startDate=t),e.endDate=t,de):{error:xt}:{error:me}},setTournamentStartDate:function({tournamentRecord:e,startDate:t}){return e?vr.test(t)?(e.startDate&&(new Date(t),new Date(e.startDate)),e.endDate&&new Date(t)>new Date(e.endDate)&&(e.endDate=t),e.startDate=t,de):{error:xt}:{error:me}},setTournamentCategories:function({tournamentRecord:e,categories:t}){return e?(t=(t||[]).filter((e=>e.categoryName&&e.type)),e.tournamentCategories=t,de):{error:me}},addEventTimeItem:ic,addTournamentTimeItem:rc,addParticipantTimeItem:nc,addEventExtension:zc,removeEventExtension:Yc,addTournamentExtension:Hc,removeTournamentExtension:Kc,addParticipantExtension:function({tournamentRecord:e,participantId:t,extension:n}={}){if(!t)return{error:Yt};const r=na({tournamentParticipants:(null==e?void 0:e.participants)||[],participantId:t});return r?Vc({element:r,extension:n}):{error:$t}},removeParticipantExtension:function({tournamentRecord:e,participantId:t,name:n}={}){if(!t)return{error:Yt};const r=na({tournamentParticipants:(null==e?void 0:e.participants)||[],participantId:t});return r?qc({element:r,name:n}):{error:$t}},addDrawDefinitionExtension:Wc,removeDrawDefinitionExtension:function({drawDefinition:e,name:t}={}){return e?qc({element:e,name:t}):{error:be}}};const Em={assignMatchUpCourt:Gu,assignMatchUpVenue:ju,addMatchUpScheduleItems:Uf,addMatchUpScheduledDate:Sf,addMatchUpScheduledTime:Df,addMatchUpStartTime:Nf,addMatchUpEndTime:Pf,addMatchUpStopTime:Af,addMatchUpResumeTime:Mf,addMatchUpOfficial:Tf,getMatchUpFormatTiming:ga,modifyMatchUpFormatTiming:Lp,getModifiedMatchUpFormatTiming:xp,getEventMatchUpFormatTiming:_p,modifyEventMatchUpFormatTiming:Fp,removeEventMatchUpFormatTiming:ff,getMatchUpFormatTimingUpdate:function({tournamentRecord:e}){if(!e)return{error:me};const t=[],{extension:n}=aa({tournamentRecord:e,name:Ki});n&&t.push({method:"addTournamentExtension",params:{extension:n}});const r=e.events||[];for(const i of r){const{eventId:e}=i,{extension:n}=oa({event:i,name:Ki});n&&t.push({method:"addEventExtension",params:{eventId:e,extension:n}})}return{methods:t}},getMatchUpDailyLimits:cf,setMatchUpDailyLimits:Cf,getMatchUpDailyLimitsUpdate:function({tournamentRecord:e}){if(!e)return{error:me};const t=[],{extension:n}=aa({tournamentRecord:e,name:zi});n&&t.push({method:"addTournamentExtension",params:{extension:n}});const r=e.events||[];for(const i of r){const{eventId:e}=i,{extension:n}=oa({event:i,name:zi});n&&t.push({method:"addEventExtension",params:{eventId:e,extension:n}})}return{methods:t}},isValidSchedulingProfile:Sd,setSchedulingProfile:function({tournamentRecord:e,schedulingProfile:t}){return e?Array.isArray(t)?Kl({tournamentRecord:e,schedulingProfile:t}):{error:jn}:{error:me}},getSchedulingProfile:zl,removeMatchUpCourtAssignment:function({drawDefinition:e,matchUpId:t,courtDayDate:n}){return gf({drawDefinition:e,matchUpId:t,courtDayDate:n})},clearScheduledMatchUps:of,bulkScheduleMatchUps:vd,bulkRescheduleMatchUps:Ef};function Cm({tournamentRecord:e,categoryName:t,categoryType:n}){if(!e)return{error:me};const{appliedPolicies:r}=Qi({tournamentRecord:e}),i=null==r?void 0:r.draws;return((null==i?void 0:i.allowedDrawTypes)||[]).filter((({categoryNames:e,categoryTypes:r})=>!t&&!r||t&&(null==e?void 0:e.includes(t))||n&&(null==r?void 0:r.includes(n))))}function Rm({participantCount:e}){if(isNaN(e))return{error:jn};return{drawSize:[0,2,4,8,16,32,64,128,256,512,1024].find((t=>t>=e))||0}}function Om({selected:e=!0,drawDefinition:t,entryStatuses:n,drawId:r,event:i,stage:a}){let o=i.entries||[];if(r){var s;const{flightProfile:e}=tl({event:i}),n=null==e||null===(s=e.flights)||void 0===s?void 0:s.find((e=>e.drawId===r));o=n?n.drawEntries:null==t?void 0:t.entries}const c=o.filter((t=>(!(null!=n&&n.length)||!t.entryStatus||n.includes(t.entryStatus))&&(!a||!t.entryStage||t.entryStage===a)&&(!e||du.includes(t.entryStatus))));return{entries:o,stageEntries:c}}function xm({tournamentRecord:e,drawDefinition:t,event:n,requireParticipantCount:r=!0,drawSizeProgression:i=!1,policyDefinitions:a,participantCount:o,drawSize:s}={}){if(!a){const r=Qd({tournamentRecord:e,drawDefinition:t,event:n});if(r.error)return r;a=r.policyDefinitions}if(o&&isNaN(o))return{error:jn};if(r&&isNaN(o))return{error:Xt};if(!s){if(!o)return{error:Ce};({drawSize:s}=Rm({participantCount:o}))}if((r&&o||s)>s)return{error:sn};const c=a.seeding;if(!c)return{error:wt};const u=c.seedsCountThresholds;if(!u)return{error:Le};void 0!==c.drawSizeProgression&&(i=c.drawSizeProgression);return{seedsCount:u.filter((e=>i?e.drawSize<=s:s===e.drawSize)).reduce(((e,t)=>o>=t.minimumParticipantCount?t.seedsCount:e),0)}}function Lm({policyDefinitions:e,drawDefinition:t,drawSize:n,drawId:r,event:i,stage:a}){if(!i)return{error:ze};const{entries:o,stageEntries:s}=Om({drawDefinition:t,drawId:r,stage:a,event:i}),c=s.length,{drawSize:u}=Rm({participantCount:c}),{seedsCount:d,error:l}=xm({drawSize:n||u,policyDefinitions:e,participantCount:c});return l?{error:l}:{entries:o,seedsCount:d,stageEntries:s}}const km={attachPolicies:xf,attachEventPolicies:Lf,removeEventPolicy:function({event:e,policyType:t}){if(!t)return{error:Mt};if(!e)return{error:ze};let n;if(e.extensions){const{appliedPolicies:r}=Xi({event:e});if(r&&r[t])if(delete r[t],n=!0,Object.keys(r).length){zc({event:e,extension:{name:ki,value:r}})}else Yc({event:e,name:ki})}return n?de:{error:Dt}},findPolicy:ta,getSeedsCount:xm,getEntriesAndSeedsCount:Lm,getAllowedDrawTypes:Cm,getAllowedMatchUpFormats:function({tournamentRecord:e,categoryName:t,categoryType:n}){if(!e)return{error:me};const{appliedPolicies:r}=Qi({tournamentRecord:e}),i=null==r?void 0:r.scoring;return((null==i?void 0:i.matchUpFormats)||[]).filter((({categoryNames:e,categoryTypes:r})=>!t&&!r||t&&(null==e?void 0:e.includes(t))||n&&(null==r?void 0:r.includes(n))))},getEventAppliedPolicies:Xi};function Fm({tournamentRecord:e,event:t}){if(!e)return{error:me};e.events||(e.events=[]);const{startDate:n,endDate:r}=e,i=Object.assign({},{startDate:n,endDate:r,eventType:Pa},t);i.eventId||(i.eventId=Wr());return e.events.reduce(((e,t)=>e||t.eventId===i.eventId),void 0)?{error:Ye}:(e.events.push(i),{...de,event:i})}const jm="deleteEvents",_m="deleteDrawDefinitions",Bm={DELETE_EVENTS:jm,DELETE_DRAW_DEFINITIONS:_m};function Gm({entries:e=[]}={}){const t=e.reduce(((e,t)=>{const{entryStage:n,entryStatus:r}=t,i=`_${n||Lo}${r||""}`;return e[i]||(e[i]=[]),e[i].push(t),e}),{}),n=e=>isNaN(e)?9999:e;return Object.keys(t).map((e=>t[e].sort(((e,t)=>n(e.entryPosition)-n(t.entryPosition))).map(((e,t)=>{const n=t;return Object.assign(e,{entryPosition:n})})))).flat()}function Vm({participantId:e,drawDefinition:t,entryStatus:n,entryStage:r}){var i;if(!t)return{error:Ie};const a=null===(i=t.entries)||void 0===i?void 0:i.find((t=>!(t.participantId!==e||n&&n!==t.entryStatus||r&&r!==t.entryStage)));return e&&a}function qm({entryStatus:e=tu,entryStage:t=Lo,entryPosition:n,drawDefinition:r,participantId:i,participant:a}){if(!r)return{error:Ie};if(!t)return{error:Qe};if(!mu({stage:t,drawDefinition:r}))return{error:Xe};const o=Uu({stage:t,drawDefinition:r,entryStatus:e});if(!o.success)return{error:o.error};if(!(i=i||a&&a.participantId))return{error:Yt};const s=e===ru&&Vm({participantId:i,drawDefinition:r,entryStatus:e}),c=t===jo&&Vm({participantId:i,drawDefinition:r,entryStage:t});if(e!==ru&&t!==jo&&Vm({drawDefinition:r,participantId:i})||s||c)return{error:on};const u=Vr({...a,participantId:i,entryStage:t,entryStatus:e,entryPosition:n});return r.entries.push(u),Nc({drawDefinition:r}),{...de}}function Hm({entryStatus:e=tu,autoEntryPositions:t=!0,drawDefinition:n,participantIds:r,stage:i=Lo}){if(!i)return{error:Qe};if(!n)return{error:Ie};if(!Array.isArray(r))return{error:qt};if(!mu({stage:i,drawDefinition:n}))return{error:Xe};const a=Uu({stage:i,drawDefinition:n,entryStatus:e});if(!a.success)return{error:a.error};if((a.positionsAvailable||0)<r.length)return{error:cn};const o=r.reduce(((t,r)=>{const a=e===ru&&Vm({participantId:r,drawDefinition:n,entryStatus:e}),o=i===jo&&Vm({participantId:r,drawDefinition:n,entryStage:i});return e!==ru&&i!==jo&&Vm({drawDefinition:n,participantId:r})||a||o?t.concat({participantId:r,error:on}):t}),[]);return o.length?{error:Je,invalidParticipantIds:o}:(r.forEach((t=>{const r=Object.assign({participantId:t},{entryStage:i,entryStatus:e});n.entries.push(r)})),t&&(n.entries=Gm({entries:n.entries})),Nc({drawDefinition:n}),{...de})}function Wm({autoEntryPositions:e=!0,drawDefinition:t,participantIds:n,entryStatus:r,entryStage:i,drawId:a,event:o}){if(!a)return{error:Re};if(!o)return{error:Ke};const s=(o.entries||[]).map(Cc);if(n.filter((e=>!s.includes(e))).length)return{error:$e};if(t){const a=Hm({drawDefinition:t,participantIds:n,entryStatus:r,stage:i,autoEntryPositions:e});if(a.error)return a}const{flightProfile:c}=tl({event:o}),u=null==c?void 0:c.flights.find((e=>e.drawId===a));return null!=u&&u.drawEntries&&(n.forEach((e=>{const t=r===ru&&zm({participantId:e,entryStatus:r,flight:u}),n=i===jo&&zm({participantId:e,entryStage:i,flight:u});r!==ru&&i!==jo&&zm({flight:u,participantId:e})||t||n||u.drawEntries.push({participantId:e,entryStatus:r,entryStage:i})})),e&&(u.drawEntries=Gm({entries:u.drawEntries}))),de}function zm({participantId:e,entryStatus:t,entryStage:n,flight:r}){var i;const a=null===(i=r.drawEntries)||void 0===i?void 0:i.find((r=>!(r.participantId!==e||t&&t!==r.entryStatus||n&&n!==r.entryStage)));return e&&a}function Km(e){return[ou,su].includes(e)}function Ym({autoEntryPositions:e=!0,tournamentRecord:t,participantIds:n,event:r}){var i,a,o,s;if(null==r||!r.eventId)return{error:ze};if(!Array.isArray(n))return{error:Qt};if(null===(a=n=null===(i=n)||void 0===i?void 0:i.filter(Boolean))||void 0===a||!a.length)return{error:Qt};const{eventId:c}=r,{tournamentParticipants:u}=Dp({participantFilters:{participantIds:n},withStatistics:!0,tournamentRecord:t});if(null==u?void 0:u.every((e=>{var t;const n=e.events.find((e=>e.eventId===c));return null==n||null===(t=n.drawIds)||void 0===t?void 0:t.length})))return{error:an};r.entries=(r.entries||[]).filter((e=>!n.includes(null==e?void 0:e.participantId))),e&&(r.entries=Gm({entries:r.entries}));const{flightProfile:d}=tl({event:r});return null==d||null===(o=d.flights)||void 0===o||o.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!n.includes(e.participantId)))})),null===(s=r.drawDefinitions)||void 0===s||s.forEach((e=>{e.entries=(e.entries||[]).filter((e=>!n.includes(e.participantId)))})),de}function $m(e){var t;const{tournamentRecord:n,drawDefinition:r,drawId:i,event:a,participantIds:o=[],entryStatus:s=tu,entryStage:c=Lo,autoEntryPositions:u=!0}=e;if(!a)return{error:ze};if(!o||!o.length)return{error:Qt};if(!a||!a.eventId)return{error:Ke};const d=(null==n||null===(t=n.participants)||void 0===t?void 0:t.filter((e=>a.eventType===ua&&e.participantType===Oa||(a.eventType===da&&e.participantType===La||(!(a.eventType!==da||e.participantType!==Oa||!Km(s))||a.eventType===xa&&e.participantType===xa)))).map((e=>e.participantId)))||[],l=o.filter((e=>!d.length||d.includes(e)));a.entries||(a.entries=[]);const p=a.entries.map((e=>e.participantId||e.participant&&e.participant.participantId));let f;if(l.forEach((e=>{p.includes(e)||a.entries.push({participantId:e,entryStatus:s,entryStage:c})})),i){const e=Wm({participantIds:l,autoEntryPositions:u,drawDefinition:r,entryStatus:s,entryStage:c,drawId:i,event:a});e.error&&(f=e.error)}if(a.eventType===da){const e=(a.entries||[]).map((e=>e.participantId)),t=(a.entries||[]).filter((e=>Km(e.entryStatus))).map((e=>e.participantId)),r=((null==n?void 0:n.participants)||[]).filter((t=>e.includes(t.participantId)&&t.participantType===La)).map((e=>e.individualParticipantIds)).flat(1/0),i=t.filter((e=>r.includes(e)));i.length&&Ym({tournamentRecord:n,participantIds:i,autoEntryPositions:!1,event:a})}const m=!(l.length===o.length);return u&&(a.entries=Gm({entries:a.entries||[]})),m?{error:qt}:Object.assign({message:f},de)}function Jm({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:n,participantId:r,entryStatus:i,drawId:a,event:o}){return function({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:n,participantId:r,entryStatus:i,drawId:a,stage:o,event:s}){if(!t)return{error:me};if(!r)return{error:Yt};if(!s)return{error:ze};if(![Aa,Ma].includes(s.eventType))return{error:We};const c=t.participants||[],u=c.find((e=>e.participantId===r));if(!u)return{error:$t};if(![La,Ma].includes(u.participantType)||u.participantType===Ma&&s.eventType!==Ma||u.participantType===La&&s.eventType!==Aa)return{error:Ht};const d=su,l=(s.entries||[]).find((e=>e.participantId===r));if(!l)return{error:dn};const{stageEntries:p}=Om({entryStatusees:[tu,Zc,eu],selected:!1,drawDefinition:n,drawId:a,event:s,stage:o}),f=p.map(Cc),m=c.filter((({participantId:e})=>f.includes(e))).map((({individualParticipantIds:e})=>e)).flat().filter(Boolean),h=u.individualParticipantIds.filter((e=>1===ae(e,m).length));let v,g=Ym({event:s,drawId:a,drawDefinition:n,tournamentRecord:t,participantIds:[r]});if(g.error)return g;if(h.length&&(g=$m({event:s,drawId:a,drawDefinition:n,tournamentRecord:t,entryStage:l.entryStage,entryStatus:i||d,participantIds:h}),g.error))return g;e&&Im({tournamentRecord:t,participantIds:[r]}).success&&(v=!0);return{...de,participantRemoved:v}}({removeGroupParticipant:e,individualEntryStatus:su,tournamentRecord:t,drawDefinition:n,participantId:r,entryStatus:i,drawId:a,event:o})}function Zm({element:e,participantId:t,stage:n,stageSequence:r}){const i=(e.entries||[]).filter((e=>e.entryStatus===Zc)),a=(e.entries||[]).find((e=>e.participantId===t))||i.reduce(((e,t)=>{const{entryPosition:n}=t;return isNaN(n)?e:!e||n<e.entryPosition?t:e}),void 0);if(!a)return{error:dn};if(a.entryStatus!==Zc)return{error:un};if(a.stage&&a.entryStage!==n)return{error:"Participant not entered in stage"};if(r&&a.stageSequence!==r)return{error:"Participant not found in stageSequence"};a.entryStatus=tu;const o=null==a?void 0:a.entryPosition;isNaN(o)||e.entries.forEach((e=>{e.entryStatus===Zc&&e.entryPosition>o&&(e.entryPosition=e.entryPosition-1)}));let s=Math.max(...e.entries.filter((e=>e.entryStatus===tu&&!isNaN(e.entryPosition))).map((({entryPosition:e})=>parseInt(e||0))),0);return a.entryPosition=s||0,de}function Qm({event:e,participants:t,ignoreGender:n}){if(!t)return{error:Kt};if(!e)return{error:ze};const{eventType:r,gender:i}=e,a=r===ua?Oa:r===da?La:la,o=Object.assign({},...(e.entries||[]).map((e=>({[e.participantId]:e.entryStatus})))),s=Object.keys(o),c=t.filter((e=>s.includes(e.participantId))).filter((e=>{const t=o[e.participantId],s=r===da&&e.participantType===Oa&&(Km(t)||t===au),c=e.participantType!==a&&!s,u=!n&&r===Oa&&[ym,bm].includes(i)&&e.sex!==i;return c||u}));if(c.length){const e=c.map((e=>e.participantId));return{error:Je,invalidParticipantIds:e}}return de}function Xm({drawDefinition:e,participantId:t,structureId:n,seedNumber:r,seedValue:i}){const{structure:a}=_c({drawDefinition:e,structureId:n}),{positionAssignments:o}=Au({structure:a}),{seedAssignments:s}=Su({drawDefinition:e,structure:a}),c=s.map((e=>e.seedNumber)),u=Vm({drawDefinition:e,participantId:t});if(t&&!u)return{error:Vt,participantId:t,method:"assignSeed"};const d=o.find((e=>e.participantId===t)),l=null==d?void 0:d.drawPosition;if(l){if(!Cl({seedNumber:r,drawDefinition:e,structureId:n,drawPosition:l}))return{error:Ue}}if(c.includes(r)){let a;if(s.forEach((e=>{e.participantId===t&&e.seedNumber!==r&&(e.participantId=void 0),e.seedNumber===r&&(e.participantId=t,e.seedValue=i||r,a=!0)})),a)return Nc({drawDefinition:e,structureIds:[n]}),{...de}}return{error:Fe}}function eh({policyAttributes:e,idCollections:t,participants:n,participant:r}){if(!Array.isArray(e))return{error:bt};if(!r)return{error:zt};const i=[];e.forEach((e=>{const o=r,{directive:s,groupings:c,key:u,significantCharacters:d}=e||{};if(u){a({value:o,keys:u.split("."),significantCharacters:d})}else if(s){const a=null==e?void 0:e.includeIds,o=(t&&t[s]||[]).filter((e=>!a||a.includes(e)));null!=o&&o.length&&null!=n&&n.length&&o.forEach((e=>{var t;const a=n.find((t=>t.participantId===e));if(null!=a&&null!==(t=a.individualParticipantIds)&&void 0!==t&&t.includes(r.participantId)){const e=null==a?void 0:a.participantId;i.push(e)}}))}else c&&Object.keys(c).forEach((e=>{c[e].includes(r.participantId)&&i.push(e)}))}));return{values:Q(i)};function a({value:e,keys:t=[],significantCharacters:n}){for(const[i,o]of t.entries())if(e&&e[o])if(Array.isArray(e[o])){const r=e[o],s=t.slice(i);r.forEach((e=>a({value:e,keys:s,significantCharacters:n})))}else r({value:e=e[o],index:i});function r({value:e,index:r}){if(e&&r===t.length-1&&["string","number"].includes(typeof e)){const t=n?e.slice(0,n):e;i.push(t)}}}}function th({candidatePositionAssignments:e,participantsWithGroupings:t,policyAttributes:n,idCollections:r}){const i=Object.assign({},...t.map((e=>({[e.participantId]:e}))));return e.map((e=>{const a=i[e.participantId],{values:o}=eh({participants:t,policyAttributes:n,idCollections:r,participant:a});return{...e,values:o}}))}function nh({participantIdGroups:e,positionAssignments:t,groupsToAvoid:n}){return Object.assign({},...t.filter((e=>null==e?void 0:e.participantId)).map((t=>{const{drawPosition:r,participantId:i}=t,a=e&&e[i]||[],o=!!n.some((e=>a.includes(e)));return{[r]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function rh(e){const{unfilledPositions:t,chunkedDrawPositions:n}=e,r=nh(e);return n.map((e=>{const n=t.filter((t=>e.includes(t))),i=function(e){return e.filter((e=>!t(e)));function t(t){const n=ih(t);return!e.includes(n)}}(n),a=n.filter((e=>!i.includes(e))).filter((e=>{var t;const n=ih(e);return!(null!==(t=r[n])&&void 0!==t&&t.includesGroupsToAvoid)}));return{unassigned:n,unpaired:i,pairedNoConflict:a}}))}function ih(e){return e%2?e+1:e-1}function ah({selectedParticipantGroups:e,participantIdGroups:t,positionAssignments:n,drawPositionChunks:r,unfilledPositions:i,isRoundRobin:a}){const o=r.map((r=>a?function(e){const{unfilledPositions:t,chunkedDrawPositions:n}=e,r=nh(e);return n.map((e=>{const n=t.filter((t=>e.includes(t))),i=n.length===e.length?n:[],a=e.filter((e=>{var t;return null===(t=r[e])||void 0===t?void 0:t.includesGroupsToAvoid})).length;return{unassigned:n,unpaired:i,pairedNoConflict:a?[]:n,conflictsCount:a}}))}({groupsToAvoid:e,chunkedDrawPositions:r,participantIdGroups:t,positionAssignments:n,unfilledPositions:i}):rh({groupsToAvoid:e,chunkedDrawPositions:r,participantIdGroups:t,positionAssignments:n,unfilledPositions:i})));if(a){return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)).sort(((e,t)=>(t.length||0)-(e.length||0))),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)).sort(((e,t)=>(t.length||0)-(e.length||0)))}}return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length))}}function oh({participantIds:e,positionAssignments:t}){const n=t.map((e=>e.participantId));return e.filter((e=>!n.includes(e)))}function sh({candidatePositionAssignments:e,unseededParticipantIds:t,participantIdGroups:n,drawPositionChunks:r,drawPositionGroups:i,pairedPriority:a,allGroups:o,groupKey:s}){const c=i.reduce(((e,t)=>t.length>e?t.length:e),0),u=!!(c>2),d=oh({participantIds:t,positionAssignments:e}),l=function({drawPositionGroups:e,positionAssignments:t}){const n=Object.assign({},...t.map((e=>({[e.drawPosition]:e}))));return e.map((e=>e.filter(Boolean).map((e=>n[e])).filter((e=>!e.participantId&&!e.bye)).map((e=>e.drawPosition)))).flat().filter(Boolean)}({drawPositionGroups:i,positionAssignments:e}),{participantId:p,groupKey:f}=function({groupKey:e,allGroups:t,largestFirst:n=!0,targetParticipantIds:r,useSpecifiedGroupKey:i=!1}){var a;const o=Object.assign({},...Object.keys(t).map((e=>[e,t[e].filter((e=>r.includes(e)))])).filter((e=>e[1].length)).map((([e,t])=>({[e]:t})))),s=Object.keys(o).reduce(((e,t)=>o[t].length>e?o[t].length:e),0),c=Object.keys(o).filter((e=>o[e].length===s)),u=re(n?c:Object.keys(o));return{participantId:(e=i&&null!==(a=o[e])&&void 0!==a&&a.length?e:u)&&o[e]?re(o[e]):re(r),groupKey:e}}({groupKey:s,allGroups:o,targetParticipantIds:d,useSpecifiedGroupKey:u}),m=ah({positionAssignments:e,isRoundRobin:u,selectedParticipantGroups:function({allGroups:e,participantId:t}){return Object.keys(e).filter((n=>e[n].includes(t)))}({allGroups:o,participantId:p}),participantIdGroups:n,drawPositionChunks:r,unfilledPositions:l,largestGroupSize:c,allGroups:o}),{unassigned:h,unpaired:v,pairedNoConflict:g}=m,I=(null==g?void 0:g.length)&&g[0],y=(null==v?void 0:v.length)&&v[0],b=a&&I?I:y,w=a?y:I,U=(null==b?void 0:b.length)&&b||(null==w?void 0:w.length)&&w;let S;if(null!=U&&U.length){const e=ne(U);S=ne(e)}else{const e=ne(h[0]);S=ne(e)}return{newGroupKey:f,selectedParticipantId:p,targetDrawPosition:S}}function ch({drawPositions:e}){const t=[].concat(...e.map((t=>e.filter((e=>e!==t)).map((e=>[t,e]))))),n=Q(t.map(uh)).map((e=>e.split("|").map((e=>+e))));return{groupMatchUps:t,uniqueMatchUpGroupings:n}}function uh(e){return e.sort(Hr).join("|")}function dh({isRoundRobin:e,groupedParticipants:t}){const n=[];return e?t.forEach((e=>{const t=e.map((e=>e.drawPosition)),{uniqueMatchUpGroupings:r}=ch({drawPositions:t}),i=Object.assign({},...e.map((e=>({[e.drawPosition]:e}))));r.forEach((t=>{se(i[t[0]].values||[],i[t[1]].values||[])&&(n.push(t),e.conflict=!0)}))})):t.forEach((e=>{se(e[0].values||[],e[1].values||[])&&(n.push(e),e.conflict=!0)})),n}function lh({isRoundRobin:e,avoidanceConflicts:t,drawPositionGroups:n,positionedParticipants:r,potentialDrawPositions:i}){return t.map((t=>{const a=t.map((e=>e.drawPosition));return t.filter((e=>i.includes(e.drawPosition))).map((t=>{const o=i.filter((e=>!a.includes(e))).filter((i=>{const a=n.find((e=>e.includes(i))).find((e=>e!==i)),o=r.find((e=>e.drawPosition===a)),s=dh({isRoundRobin:e,groupedParticipants:[[t,o]]}),c=r.find((e=>e.drawPosition===i)),u=dh({isRoundRobin:e,groupedParticipants:[[c,o]]});return!s.length&&!u.length}));if(o.length)return{drawPosition:t.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function ph(e){const{initialPositionAssignments:t,participantsWithGroupings:n,opponentsToPlaceCount:r,drawPositionGroups:i,policyAttributes:a,idCollections:o,allGroups:s}=e,c=[];let u;const d=Math.min(...i.map((e=>e.length))),l=d>2,p=Gr(t,!1,!0),f=t.filter((e=>!e.participantId)).map((e=>e.drawPosition));ie(0,r).forEach((()=>{const{newGroupKey:t,selectedParticipantId:n,targetDrawPosition:r}=sh({...e,groupKey:u,allGroups:s,candidatePositionAssignments:p});u=t,p.forEach((e=>{e.drawPosition===r&&(e.participantId=n)}))}));let m=th({candidatePositionAssignments:p,participantsWithGroupings:n,policyAttributes:a,idCollections:o}),h=ce(m,d),v=dh({isRoundRobin:l,groupedParticipants:h}),g=0;for(;g<20&&v.length;){const e=lh({isRoundRobin:l,avoidanceConflicts:v,drawPositionGroups:i,positionedParticipants:m,potentialDrawPositions:f});e.length?(fh({candidatePositionAssignments:p,swapOptions:e}),m=th({candidatePositionAssignments:p,participantsWithGroupings:n,policyAttributes:a,idCollections:o}),h=ce(m,d),v=dh({isRoundRobin:l,groupedParticipants:h}),g++):g=20}return p.forEach((e=>{e.bye&&e.participantId&&c.push({error:"Invalid Assignment",assignment:e})})),{positionAssignments:p,conflicts:v.length,groupedParticipants:h,errors:c}}function fh({candidatePositionAssignments:e,swapOptions:t}){const n=ne(t);if(!n)return{error:"No swap options"};const r=n.drawPosition,i=ne(n.possibleDrawPositions),a=e.find((e=>e.drawPosition===r)).participantId,o=e.find((e=>e.drawPosition===i)).participantId;return e.forEach((e=>{e.drawPosition===r&&(e.participantId=o),e.drawPosition===i&&(e.participantId=a)})),de}function mh({unseededParticipantIds:e,inContextDrawMatchUps:t,drawDefinition:n,participants:r,matchUpsMap:i,structureId:a,avoidance:o,entries:s,event:c}){if(!o)return{error:yt};const{policyAttributes:u,roundsToSeparate:d,candidatesCount:l=1}=o,{structure:p}=_c({drawDefinition:n,structureId:a}),{matchUps:f}=Ou({matchUpsMap:i,structure:p,event:c}),{positionAssignments:m}=Au({structure:p}),h=Qu({participants:r}),v=m.filter((e=>!e.participantId)),g=m.map((e=>e.drawPosition)),I=p.structureType===Wo,y=I?{structure:p,matchUps:f,allDrawPositions:g,roundsToSeparate:d}:{matchUps:f,allDrawPositions:g,roundsToSeparate:d},{drawPositionGroups:b,drawPositionChunks:w}=I?function(e){const{structure:{structures:t}}=e,n=t.map((e=>e.positionAssignments.map((e=>e.drawPosition))));return{drawPositionGroups:n,drawPositionChunks:[n]}}(y):function({matchUps:e,allDrawPositions:t,roundsToSeparate:n}){const r=e.filter((e=>1===e.roundNumber)).map((e=>e.drawPositions)),i=r.flat().sort(Hr),a=Math.max(...i),o=t.filter((e=>e>a)),s=ie(2,i.length).filter((e=>e===W(e))),c=s.slice(0,n||s.length).reverse().map((e=>ce(i,e)));o.length&&console.log({fedDrawPositions:o});return{drawPositionGroups:r,drawPositionChunks:c}}(y),U={};U.groupParticipants=r.filter((e=>e.participantType===ka)).map((e=>e.participantId)),U.teamParticipants=r.filter((e=>e.participantType===xa)).map((e=>e.participantId)),U.pairParticipants=r.filter((e=>e.participantType===La)).map((e=>e.participantId));const S=function({targetParticipantIds:e,policyAttributes:t,idCollections:n,participants:r}){if(!Array.isArray(t))return{error:bt};if(!Array.isArray(r))return{error:Kt};const i={};return e.forEach((e=>{const a=r.find((t=>t.participantId===e)),{values:o}=eh({policyAttributes:t,idCollections:n,participants:r,participant:a});o&&o.forEach((t=>{i[t]||(i[t]=[]),i[t].includes(e)||i[t].push(e)}))})),i}({targetParticipantIds:e,policyAttributes:u,idCollections:U,participants:r}),D=Object.assign({},...e.map((e=>{const t=Object.keys(S).filter((t=>S[t].includes(e)));return{[e]:t}}))),N=oh({participantIds:e,positionAssignments:m});if(N.length>v.length)return{error:"More participantIds than unpaired positions"};let P;const A=[],M=N.length,T=ie(0,l).map((()=>ph({initialPositionAssignments:m,participantsWithGroupings:h,unseededParticipantIds:e,opponentsToPlaceCount:M,drawPositionChunks:w,drawPositionGroups:b,participantIdGroups:D,idCollections:U,allGroups:S,policyAttributes:u,pairedPriority:!1})));if(P=T.reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0),!P||P.conflicts){const t=ie(0,l).map((()=>ph({initialPositionAssignments:m,participantsWithGroupings:h,unseededParticipantIds:e,opponentsToPlaceCount:M,drawPositionChunks:w,drawPositionGroups:b,participantIdGroups:D,idCollections:U,allGroups:S,entries:s,policyAttributes:u,pairedPriority:!0})));P=T.concat(...t).filter((e=>{var t;return!(null!==(t=e.errors)&&void 0!==t&&t.length)})).reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0)}if(!P)return{error:"Could not produce candidate"};const E=(p.positionAssignments||[]).filter((e=>e.participantId)).map((e=>e.participantId));return P.positionAssignments.filter((e=>!E.includes(e.participantId))).forEach((e=>{if(e.participantId&&!e.bye){const r=Ol({automaticPlacement:!0,drawDefinition:n,structureId:a,matchUpsMap:i,inContextDrawMatchUps:t,...e});null!=r&&r.success||A.push(r)}})),A.length?{error:A,conflicts:P.conflicts}:Object.assign({positionAssignments:P.positionAssignments,conflicts:P.conflicts},de)}function hh({drawDefinition:e,candidatesCount:t,participants:n,structureId:r,structure:i,matchUpsMap:a,inContextDrawMatchUps:o}){i||({structure:i}=_c({drawDefinition:e,structureId:r})),r||({structureId:r}=i);const{positionAssignments:s}=Au({structure:i}),{seedAssignments:c}=Su({drawDefinition:e,structure:i}),u=c.map((e=>e.participantId)).filter(Boolean),{stage:d,stageSequence:l}=i,p=yu({drawDefinition:e,stageSequence:l,entryStatuses:[tu,eu],structureId:r,stage:d}),f=p.filter((e=>!u.includes(e.participantId))).map((e=>e.participantId)),m=s.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));if(f.length>m.length)return{error:"Insufficient drawPositions to accommodate entries"};const{appliedPolicies:h}=xc({drawDefinition:e});let{avoidance:v}=h||{};if(i.stage===_o){const e=p.reduce(((e,t)=>(e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e)),{});Object.keys(e).length&&(v||(v={policyName:"Playoff Avoidance"}),v.policyAttributes||(v.policyAttributes=[]),v.policyAttributes.push({groupings:e}))}if(v&&n){return mh({unseededParticipantIds:f,candidatesCount:t,drawDefinition:e,participants:n,structureId:r,avoidance:v,entries:p,matchUpsMap:a,inContextDrawMatchUps:o})}return function({unseededParticipantIds:e,unfilledDrawPositions:t,drawDefinition:n,structureId:r,matchUpsMap:i,inContextDrawMatchUps:a}){const o=X(t);for(const s of e){const e=Ol({structureId:r,drawPosition:o.pop(),participantId:s,drawDefinition:n,automaticPlacement:!0,matchUpsMap:i,inContextDrawMatchUps:a});if(e&&e.error)return e}return de}({unseededParticipantIds:f,unfilledDrawPositions:m,drawDefinition:e,structureId:r,matchUpsMap:a,inContextDrawMatchUps:o})}function vh({structure:e,drawDefinition:t,appliedPolicies:n,relevantMatchUps:r}){const{validSeedBlocks:i,isFeedIn:a,isContainer:o}=Ml({appliedPolicies:n,drawDefinition:t,structure:e}),s=function({drawDefinition:e,structure:t}){const{positionAssignments:n}=Au({structure:t}),{seedAssignments:r}=Su({drawDefinition:e,structure:t}),i=Object.assign({},...r.filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))));return n.map((e=>i[e.participantId]?{...e,seedNumber:i[e.participantId].seedNumber,seedValue:i[e.participantId].seedValue}:"")).filter(Boolean)}({drawDefinition:t,structure:e}),c=Q([].concat(...r.map((e=>e.drawPositions)))),u=s.filter((e=>c.includes(e.drawPosition))),d=[].concat(...i.map((e=>X(e.drawPositions)))).filter((e=>c.includes(e))),l=(e,t)=>e.seedValue-t.seedValue;return{strictSeedOrderByePositions:gh({orderedSeedDrawPositions:i.reduce(((e,t)=>{const n=u.filter((e=>{var n;return null===(n=t.drawPositions)||void 0===n?void 0:n.includes(e.drawPosition)})).sort(l);return e.concat(...n)}),[]).map((e=>e.drawPosition)),relevantMatchUps:r}).slice(0,s.length),blockSeedOrderByePositions:gh({orderedSeedDrawPositions:d,relevantMatchUps:r}).slice(0,s.length),isFeedIn:a,isContainer:o}}function gh({orderedSeedDrawPositions:e,relevantMatchUps:t}){const n=t.map((e=>e.drawPositions)).map((e=>e.sort(((e,t)=>e-t)))).filter((e=>e[0]+1===e[1]));return e.map((e=>n.find((t=>null==t?void 0:t.includes(e))))).filter(Boolean).map((t=>null==t?void 0:t.reduce(((t,n)=>e.includes(n)?t:n),void 0))).filter(Boolean)}function Ih({blockOrdered:e=!1,drawDefinition:t,matchUpsMap:n,structureId:r,structure:i,seedsOnly:a,event:o}){i||({structure:i}=_c({drawDefinition:t,structureId:r})),r||({structureId:r}=i);const{byesCount:s,placedByes:c,relevantMatchUps:u}=function({drawDefinition:e,event:t,matchUpsMap:n,structure:r}){var i;const{matchUps:a,roundMatchUps:o}=Ou({drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:r,event:t}),s=o&&o[1]||[],c=(null==r?void 0:r.structureType)===Wo,u=c?a:s,d=c?(null==r||null===(i=r.structures)||void 0===i?void 0:i.length)||0:a.length,{structureId:l,stage:p,stageSequence:f}=r,m=yu({drawDefinition:e,stageSequence:f,entryStatuses:[tu,eu],structureId:l,stage:p}),h=gu({drawDefinition:e,stage:p}),v=m.length+h,{positionAssignments:g,unassignedPositions:I}=Au({structure:r}),y=I.map((e=>e.drawPosition)),b=g.filter((e=>e.bye)).length,w=g.filter((e=>e.bye)).map((e=>e.drawPosition)),U=u.map((e=>e.drawPositions)).filter((e=>e&&(null==e?void 0:e.reduce(((e,t)=>!w.includes(t)&&e),!0)))).flat(1/0).filter((e=>y.includes(e)));let S=g.length-v;return S>d&&1===r.stageSequence&&r.stage!==Fo&&(S=d),{placedByes:b,byesCount:S,relevantMatchUps:u,placedByePositions:w,roundMatchUps:o,positionsToAvoidDoubleBye:U}}({drawDefinition:t,matchUpsMap:n,structure:i,event:o}),d=s-c;if(d<=0)return de;const{appliedPolicies:l}=xc({drawDefinition:t}),{isFeedIn:p,strictSeedOrderByePositions:f,blockSeedOrderByePositions:m}=vh({structure:i,drawDefinition:t,appliedPolicies:l,relevantMatchUps:u}),h=e?m:f,{unseededByePositions:v}=function({structure:e,appliedPolicies:t,isFeedIn:n}){var r;const i=null==t||null===(r=t.seeding)||void 0===r?void 0:r.seedingProfile,{positionAssignments:a}=Au({structure:e}),o=a.filter((e=>e.participantId)).map((e=>e.drawPosition)),{matchUps:s,roundMatchUps:c}=Ou({matchUpFilters:{isCollectionMatchUp:!1},structure:e}),u=c&&c[1]||[],d=e.structureType===Wo?s:u,l=Q([].concat(...d.map((e=>e.drawPositions)))),p=Math.min(...l)-1,f=o.filter((e=>l.includes(e))),m=e=>{const t=Math.ceil(e.length/2),n=[e.slice(0,t),e.slice(t)],r=n.map((e=>[].concat(...e.flat(1/0)).length)),i=Math.min(...r.flat(1/0)),a=Math.max(...r.flat(1/0)),o=r.indexOf(a),s=i!==a,c=X(n),[u,d]=!i||s?[n[o],n[1-o]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:d}},h=e=>{const{greaterHalf:t,lesserHalf:n}=m(e),{greaterHalf:r,lesserHalf:i}=m(t),a=X(r.flat(1/0)).pop();return{newlyFilteredChunks:[...n,...i,r.flat().filter((e=>e!==a))],drawPosition:a}},v=e=>!f.includes(e),g=e=>{let t=ce(e.sort(Hr),Math.ceil(e.length/4)).map((e=>e.filter(v)));const n=[].concat(...t.flat(1/0)).length,r=[];for(let i=0;i<n;i++){const{newlyFilteredChunks:e,drawPosition:n}=h(t);r.push(n),t=e}return r},{validSeedBlocks:I}=Ml({structure:e,appliedPolicies:t,allPositions:!0});let y=I.map((e=>{var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.map((e=>e+p))})).map(g).filter((e=>e.length));if(n){const e=l.length,{seedBlocks:t}=Al({participantsCount:e,cluster:i===Vo});y=t.map((e=>e.map((e=>e+p)))).map(g).filter((e=>e.length))}const b=d.map((e=>e.drawPositions)).map((e=>e.sort(((e,t)=>e-t)))).filter((e=>e[0]+1===e[1])),w=e=>b.reduce(((t,n)=>n.includes(e)?n.reduce(((t,n)=>n!==e?n:t),void 0):t),void 0);return{unseededByePositions:y.map((e=>e.map(w))).flat(1/0).filter(Boolean)}}({appliedPolicies:l,structure:i,isFeedIn:p}),g=[].concat(...h,...a?[]:v).slice(0,d);for(const I of g){const e=ul({drawDefinition:t,structureId:r,drawPosition:I,matchUpsMap:n});if(null!=e&&e.error)return e}return de}function yh({drawDefinition:e,structure:t,structureId:n}){t||({structure:t}=_c({drawDefinition:e,structureId:n})),n||({structureId:n}=t);const{positionAssignments:r}=Au({structure:t}),i=r.filter((e=>e.qualifier)).map((e=>e.drawPosition)),{stage:a,stageSequence:o}=t,s=gu({drawDefinition:e,stage:a,stageSequence:o}),c=s-i.length;return{positionAssignments:r,qualifiersCount:s,placedQualifiersCount:i.length,unplacedQualifiersCount:c}}function bh({drawDefinition:e,participants:t,groupsCount:n,structureId:r,structure:i,matchUpsMap:a,inContextDrawMatchUps:o}){const s=[];let c=0;i||({structure:i}=_c({drawDefinition:e,structureId:r})),r||({structureId:r}=i);const{appliedPolicies:u}=xc({drawDefinition:e}),{validSeedBlocks:d,error:l}=Ml({structure:i,drawDefinition:e,appliedPolicies:u});return l&&s.push(l),ie(0,n=n||d.length).forEach((()=>{if(c<n){const n=function({drawDefinition:e,structureId:t,participants:n,matchUpsMap:r,inContextDrawMatchUps:i}){const{unplacedSeedParticipantIds:a,unfilledPositions:o}=Rl({drawDefinition:e,structureId:t,randomize:!0}),{appliedPolicies:s}=xc({drawDefinition:e}),{avoidance:c}=s||{};c&&n&&(null==a||a.length);for(const u of a){const n=o.pop();if(!n)return{error:Te};const a=Ol({drawDefinition:e,structureId:t,drawPosition:n,participantId:u,automaticPlacement:!0,matchUpsMap:r,inContextDrawMatchUps:i});if(!a.success)return a}return de}({drawDefinition:e,participants:t,structureId:r,matchUpsMap:a,inContextDrawMatchUps:o});n&&n.success&&c++,n.error&&s.push({seedPositionError:n.error})}})),{errors:s}}function wh({inContextDrawMatchUps:e,drawDefinition:t,candidatesCount:n,participants:r,structureId:i,matchUpsMap:a,seedsOnly:o,event:s}){const{structure:c,error:u}=_c({drawDefinition:t,structureId:i});if(u)return{error:u};const d=[tu,eu],l=yu({stageSequence:c.stageSequence,stage:c.stage,drawDefinition:t,entryStatuses:d,structureId:i});if(null==l||!l.length)return de;const{seedingProfile:p}=c;if(a=a||kc({drawDefinition:t}),e||({matchUps:e}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:a})),p===qo){let n=Ih({drawDefinition:t,matchUpsMap:a,structure:c,seedsOnly:o,event:s});if(n.error)return n;if(n=bh({drawDefinition:t,participants:r,structure:c,matchUpsMap:a,inContextDrawMatchUps:e}),n.error)return n}else{let n=bh({drawDefinition:t,participants:r,structure:c,matchUpsMap:a,inContextDrawMatchUps:e});if(n.error)return n;if(n=Ih({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:a,structure:c,seedsOnly:o,event:s}),n.error)return n}const f={};if(!o){let i=hh({candidatesCount:n,drawDefinition:t,participants:r,structure:c,matchUpsMap:a,inContextDrawMatchUps:e});if(i.error)return i;if(i.conflicts&&(f.unseededConflicts=i.conflicts),i=function(e){let{structure:t,structureId:n}=e;if(t||({structure:t}=_c(e)),n||({structureId:n}=t),t.stage===Fo)return console.log("Consolation Stage: No Qualifiers"),{error:"Consolation Stage: No Qualifiters"};const{positionAssignments:r,unplacedQualifiersCount:i}=yh(e),a=r.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));return i>a.length?{error:"Insufficient drawPositions to accommodate qualifiers"}:(ie(0,i).forEach((()=>{const e=a.pop();r.forEach((t=>{t.drawPosition===e&&(t.qualifier=!0)}))})),de)}({drawDefinition:t,participants:r,structure:c,matchUpsMap:a,inContextDrawMatchUps:e}),i.error)return i;i.conflicts&&(f.qualifierConflicts=i.conflicts)}return Nc({drawDefinition:t,structureIds:[i]}),{conflicts:f}}function Uh({candidatesCount:e=1,tournamentRecord:t,drawDefinition:n,structureId:r,seedsOnly:i,event:a}){if(!a)return{error:Ke};if(!n)return{error:be};const o=null==t?void 0:t.participants,{playoffStructures:s}=bl({drawDefinition:n,structureId:r});if(s)for(const c of s){const{structureId:t}=c,r=wh({structureId:t,candidatesCount:e,drawDefinition:n,participants:o,seedsOnly:i});if(r.error)return r}return{...de}}function Sh({collectionPosition:e,teamParticipantId:t,dualMatchUpSide:n,drawDefinition:r,participantIds:i,collectionId:a}){var o;if(!a||!e||!Array.isArray(i))return{error:jn,modifiedLineUp:(null==n?void 0:n.lineUp)||[]};const s=(null==n?void 0:n.lineUp)||(null===(o=Ac({participantId:t,drawDefinition:r}))||void 0===o?void 0:o.lineUp);return{modifiedLineUp:(null==s?void 0:s.map((t=>{var n;if(!i.includes(t.participantId))return t;const r=null===(n=t.collectionAssignments)||void 0===n?void 0:n.filter((t=>!(t.collectionId===a&&t.collectionPosition===e)));return{participantId:t.participantId,collectionAssignments:r}})).filter(Boolean))||[]}}function Dh({lineUp:e,tieFormat:t}){var n;let r=[];if(!Array.isArray(e))return r.push("lineUp must be an array of objects"),{valid:!1,errors:r,error:jn};const i=(null==t||null===(n=t.collectionDefinitions)||void 0===n?void 0:n.map((({collectionId:e})=>e)))||[],a=e.every((e=>{if("object"!=typeof e)return r.push("lineUp entries must be objects"),!1;const{participantId:t,collectionAssignments:n}=e;return t?"string"!=typeof t?(r.push("participantIds must be strings"),!1):Array.isArray(n)?n.every((e=>{if("object"!=typeof e)return r.push("collectionAssignments must be objects"),!1;const{collectionPosition:t,collectionId:n}=e;return"number"!=typeof t?(r.push("collectionPosition must be a number"),!1):!!i.includes(n)||(r.push("Invalid collectionId"),!1)})):(r.push("collectionAssignments must be an array"),!1):(r.push("Missing participantId"),!1)})),o=Q(e.map(Cc)).length===e.length;o||r.push("Duplicated participantId(s)");return{valid:a&&o,errors:r,error:r.length?jn:void 0}}function Nh({drawDefinition:e,participantId:t,tieFormat:n,lineUp:r}){if("object"!=typeof e)return{error:Ie};if("string"!=typeof t)return{error:Yt};const i=Dh({lineUp:r,tieFormat:n});if(!i.valid)return i;const{extension:a}=ia({element:e,name:Vi}),o=(null==a?void 0:a.value)||{},s=r.map(Cc);if(Object.keys(o).filter((e=>e!==t)).find((e=>{const n=o[e],i=oe(n.map(Cc),s);return i.length&&console.log({overlap:i,submittedParticipantId:t,submittedLineUp:r,storedParticipantId:e,storedLineUp:n}),i.length})))return{error:"lineUp conflict"};o[t]=r;return Vc({element:e,extension:{name:Vi,value:o}})}function Ph({tournamentRecord:e,drawDefinition:t,tieMatchUpId:n,event:r}){if(!e)return{error:me};if(!t)return{error:Re};if(!r)return{error:Ke};const i=kc({drawDefinition:t}),{matchUp:a,structure:o}=xu({tournamentParticipants:e.participants,matchUpId:n,inContext:!0,drawDefinition:t,matchUpsMap:i,event:r});if(!a)return{error:ft};const{collectionPosition:s,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:l}=a;if(![ua,da].includes(l))return{error:vt};const{positionAssignments:p}=Pu({structure:o}),f=null==p?void 0:p.filter((e=>c.includes(e.drawPosition))),m=Ec(f),{tournamentParticipants:h}=Dp({tournamentRecord:e,participantFilters:{participantTypes:[xa],participantIds:m}}),{matchUp:v}=xu({matchUpId:d,drawDefinition:t,matchUpsMap:i});return{relevantAssignments:f,collectionPosition:s,teamParticipants:h,collectionId:u,matchUpType:l,dualMatchUp:v,tieMatchUp:a,tieFormat:v.tieFormat||o.tieFormat||t.tieFormat||r.tieFormat,structure:o,...de}}function Ah({collectionPosition:e,teamParticipantId:t,drawDefinition:n,modifiedLineUp:r,participantId:i,collectionId:a,tieFormat:o}){var s,c;const u=null===(s=Ac({participantId:t,drawDefinition:n}))||void 0===s?void 0:s.lineUp,d=null===(c=r||u)||void 0===c?void 0:c.find((e=>(null==e?void 0:e.participantId)===i)),l={collectionId:a,collectionPosition:e};if(d)d.collectionAssignments.push(l);else{const e={collectionAssignments:[l],participantId:i};r.push(e)}t&&Nh({participantId:t,lineUp:r,drawDefinition:n,tieFormat:o})}function Mh({drawDefinition:e,participantIds:t}){if("object"!=typeof e)return{error:Ie};if(!Array.isArray(t))return{error:qt};const{extension:n}=ia({element:e,name:Vi}),r=(null==n?void 0:n.value)||{},i=Object.keys(r).find((e=>r[e].map(Cc).some((e=>t.includes(e)))));return{lineUp:r[i],teamParticipantId:i}}function Th({tournamentRecord:e,drawIds:t=[],auditData:n,eventId:r}){var i;if(!e)return{error:me};const a=Array.isArray(t)&&t[0],{event:o,error:s}=ya({tournamentRecord:e,eventId:r,drawId:a});if(s)return{error:s};const c=[],u=[],d=[];if(!o.drawDefinitions)return{error:be};const l=o.drawDefinitions.map((({drawId:e})=>e));t.length||(t=l);if(!(t.length&&t.every((e=>l.includes(e)))))return{error:be};o.drawDefinitions=o.drawDefinitions.filter((e=>{if(t.includes(e.drawId)){const t={action:_m,payload:{drawDefinitions:[e],eventId:o.eventId,auditData:n}};c.push(t);const{drawId:r,drawType:i,drawName:a}=e;d.push({auditData:n,drawId:r,drawType:i,drawName:a,eventId:o.eventId});const{matchUps:s}=dd({event:o,drawDefinition:e});s.forEach((({matchUpId:e})=>u.push(e)))}return!t.includes(e.drawId)})),Kl({tournamentRecord:e});const{timeItem:p}=Xs({element:o,itemType:"PUBLISH.STATUS"}),f=null==p||null===(i=p.itemValue)||void 0===i?void 0:i.PUBLIC;for(const v of t){var m;if(null==f||null===(m=f.drawIds)||void 0===m?void 0:m.includes(v)){var h;const e=(null===(h=f.drawIds)||void 0===h?void 0:h.filter((e=>e!==v)))||[],t=ic({event:o,timeItem:{itemType:"PUBLISH.STATUS",itemValue:{[Pi]:{drawIds:e}}}});if(t.error)return{error:t.error}}}if(c.length){nr({topic:uc,payload:c});const e=ic({event:o,timeItem:{itemType:_m,itemValue:d}});if(e.error)return e}return u.length&&Uc({matchUpIds:u}),function({drawId:e}){nr({topic:dc,payload:{drawId:e}})}({drawId:a}),de}function Eh({tournamentRecord:e,drawDefinition:t,event:n,requireParticipantCount:r=!0,enforcePolicyLimits:i=!0,drawSizeProgression:a,participantCount:o,structureId:s,seedsCount:c}){const{structure:u,error:d}=_c({drawDefinition:t,structureId:s});if(d)return{error:d};const{positionAssignments:l}=Au({structure:u}),p=l.length;if(c>p)return{error:xe};const{policyDefinitions:f}=Qd({policyTypes:[oi],tournamentRecord:e,drawDefinition:t,event:n}),{seedsCount:m}=xm({requireParticipantCount:r,drawSizeProgression:a,policyDefinitions:f,participantCount:o,drawSize:p});return f&&m&&c>m&&i&&(c=m),u.seedLimit=c,u.seedAssignments=ie(1,c+1).map((e=>({seedNumber:e,seedValue:e,participantId:void 0}))),Nc({drawDefinition:t,structureIds:[s]}),{...de,seedLimit:c}}function Ch({qualifyingRound:e,finishingPositionOffset:t,qualifyingPositions:n,matchUpType:r,roundLimit:i,idPrefix:a,drawSize:o,isMock:s,uuids:c}){if(isNaN(o)||!H(o)||o<2)return{matchUps:[],roundsCount:0};const u=ie(1,parseInt(o)+1).map((e=>({drawPosition:e})));let d,l=[],p=1;for(({roundNodes:d,matchUps:l}=Oh({roundNumber:p,matchUpType:r,idPrefix:a,matchUps:l,isMock:s,nodes:u,uuids:c})),p++,i=i||e;d.length>1;)n&&d.length===n&&(i=p-1),({roundNodes:d,matchUps:l}=Oh({nodes:d,roundNumber:p,matchUpType:r,idPrefix:a,matchUps:l,isMock:s,uuids:c})),p++;const f=p-1;return l=Rh({finishingPositionOffset:t,roundsCount:f,roundLimit:i,matchUps:l}),i&&(l=l.filter((e=>e.roundNumber<=i))),{matchUps:l,roundsCount:f,roundLimit:i}}function Rh({finishingPositionOffset:e=0,positionsFed:t,roundsCount:n,roundLimit:r,matchUps:i,fmlc:a}){const o=i.reduce(((e,t)=>(e[t.roundNumber]=(e[t.roundNumber]||0)+1,e)),{}),s=Object.values(o),c=e=>[Math.min(...e),Math.max(...e)],u=r?n-r:0;return i.forEach((r=>{r.finishingRound=n+1-r.roundNumber-u;const i=a&&1!==r.roundNumber,d=1+e+(i?t:0),l=o[r.roundNumber],p=s.slice(r.roundNumber-1).reduce(((e,t)=>e+t),0),f=ie(d,p+d+1),m=p+1-l,h=c(f.slice(m)),v=c(f.slice(0,m));r.finishingPositionRange={loser:h,winner:v}})),i}function Oh({includeMatchUpType:e,matchUpType:t,roundNumber:n,matchUps:r,idPrefix:i,isMock:a,uuids:o,nodes:s}){let c=0;const u=[];let d=1;const l=n-1,p=s.length;for(;c<p;){const p=s[c],f=s[c+1];l&&(p.roundNumber=l),f&&l&&(f.roundNumber=l);const m={roundPosition:d,children:[p,f],matchUpId:kh({roundPosition:d,roundNumber:n,idPrefix:i,uuids:o})};u.push(m);const h={matchUpId:m.matchUpId,roundNumber:n,roundPosition:d,matchUpStatus:R,drawPositions:m.children.map((e=>e.drawPosition))};e&&(h.matchUpType=t),a&&(h.isMock=!0),r.push(h),c+=2,d++}return{roundNodes:u,matchUps:r}}function xh({linkFedFinishingRoundNumbers:e=[],linkFedRoundNumbers:t=[],finishingPositionOffset:n,feedRoundsProfile:r=[],feedRounds:i=0,skipRounds:a=0,feedsFromFinal:o,isConsolation:s,baseDrawSize:c,matchUpType:u,idPrefix:d,drawSize:l,isMock:p,uuids:f,fmlc:m}){const h=function({drawSize:e}){return ie(0,Math.ceil(Math.log(e)/Math.log(2))).reverse().map((e=>Math.pow(2,e)))}({drawSize:c=c||function(e){const t=W(e);return t>e?t/2:t}(l)}),v=h.length;let g=0;if(r.length)g=r.reduce(((e,t)=>e+t),0);else if(l){let e=l-c;r=h.filter((t=>t<=e&&(e-=t,!0))),g=r.reduce(((e,t)=>e+t),0),i=r.length}else a>=v&&(i=0),o&&(i=v-o,a=0),r=h.filter(((e,t)=>o&&!i||i&&t>=a+i||t<a?0:e)),g=r.reduce(((e,t)=>e+t),0),l=c+g,i=r.length;const I=[...h,...r].sort(((e,t)=>t-e)),y=I.length,b=[...t.map((e=>e-1)),...e.map((e=>y-e))].map((e=>I[e])).reduce(((e,t)=>e+t),0);g-=b;let w,U=0,S=[],D=1;let N=ie(0,c).map(((e,t)=>({drawPosition:t+1+g}))),P=g+1;for(const M of h){if(({roundNodes:w,matchUps:S}=Oh({roundNumber:D,matchUpType:u,idPrefix:d,matchUps:S,isMock:p,nodes:N,uuids:f})),D++,r.includes(M)){const n=ie(0,ee(r)[M]),i=y+1-D,a=e.includes(i)||t.includes(D);for(const e of n){const t=!a&&P||void 0;({roundNodes:w,matchUps:S,drawPosition:P}=Lh({drawPosition:t,nodes:w,roundIteration:e,roundNumber:D,matchUpType:u,idPrefix:d,matchUps:S,uuids:f,fed:U})),D++,U+=1}}N=w}y!==D-1&&console.log("ERROR");S=Rh({finishingPositionOffset:s?c-g:n,positionsFed:g,roundsCount:y,matchUps:S,fmlc:m});const A=w&&w.length?w[0]:w;return A&&(A.roundNumber=D-1,A.matchUps=S),{draw:A,matchUps:S,roundsCount:y}}function Lh({includeMatchUpType:e,drawPosition:t,matchUpType:n,roundNumber:r,idPrefix:i,matchUps:a,uuids:o,nodes:s,fed:c}){const u=s.length,d=t?t-u:void 0,l=ie(0,u).map((e=>d?d+e:void 0)),p=[];for(let f=0;f<u;f++){const t=l.shift(),u={feed:!0,fed:c+1,drawPosition:t},d=s[f];d.roundNumber=r-1;const m={roundNumber:r,matchUpId:kh({roundPosition:d.roundPosition,roundNumber:r,idPrefix:i,uuids:o}),roundPosition:d.roundPosition,drawPositions:[void 0,t]};e&&(m.matchUpType=n),a.push(m);const h={children:[d,u]};p.push(h)}return{roundNodes:p,matchUps:a,drawPosition:t?t-u:void 0}}function kh({idPrefix:e,roundNumber:t,roundPosition:n,uuids:r}){return e?`${e}-${t}-${n}`:(null==r?void 0:r.pop())||Wr()}const Fh=({stage:e,structureId:t,matchUps:n=[],structures:r,stageOrder:i,roundLimit:a,roundOffset:o,exitProfile:s,matchUpFormat:c,structureType:u,structureAbbreviation:d,structureName:l,seedingProfile:p,qualifyingRound:f,stageSequence:m=1,seedAssignments:h=[],finishingPosition:v=Ns})=>{const g={structureAbbreviation:d,structureName:l,matchUpFormat:c,stageSequence:m,finishingPosition:v,seedAssignments:h,structureId:t||Wr()};e&&(g.stage=e),i&&(g.stageOrder=i),a&&(g.roundLimit=a),o&&(g.roundOffset=o),u&&(g.structureType=u),p&&(g.seedingProfile=p),f&&(g.qualifyingRound=f),s&&(g.exitProfile=s);const I=[].concat(...n.map((e=>e.drawPositions))).filter(Boolean);return r?g.structures=r:(g.matchUps=n,g.positionAssignments=Q(I).sort(((e,t)=>e-t)).map((e=>({drawPosition:e})))),g};function jh({drawDefinition:e,structureName:t,matchUpType:n,idPrefix:r,drawSize:i,isMock:a,uuids:o}){const{matchUps:s}=xh({linkFedFinishingRoundNumbers:[1],drawSize:i+1,matchUpType:n,idPrefix:r,isMock:a}),c=Fh({structureName:t||Lo,structureId:null==o?void 0:o.pop(),stageSequence:1,stage:Lo,matchUpType:n,matchUps:s});e.structures.push(c);const u=i/2,{matchUps:d}=xh({finishingPositionOffset:u,idPrefix:r&&`${r}-c`,drawSize:i-1,isConsolation:!0,matchUpType:n,isMock:a,uuids:o}),l=Fh({matchUps:d,structureId:null==o?void 0:o.pop(),structureName:ws,stageSequence:2,matchUpType:n,stage:Lo});e.structures.push(l);const{matchUps:p}=Ch({idPrefix:r&&`${r}-p1t2`,drawSize:2,matchUpType:n,isMock:a}),f=Fh({matchUps:p,structureId:null==o?void 0:o.pop(),structureName:bs,stageSequence:3,stage:Lo,matchUpType:n});e.structures.push(f);const m=function({mainStructure:e,consolationStructure:t,deciderStructure:n}){const r=t.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),i=e.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0),a=t.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0);return[...[1,2].map((n=>{const r=n%2?Yo:$o;return{linkType:Qo,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:r,roundNumber:1,positionInterleave:{offset:n-1,interleave:1},structureId:t.structureId}}})),...r.slice(1).map(((n,i)=>{const a=r.indexOf(n)%2?Yo:$o;return{linkType:Qo,source:{roundNumber:3+i,structureId:e.structureId},target:{feedProfile:a,roundNumber:n,structureId:t.structureId}}})),{linkType:Zo,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:Yo,roundNumber:i,structureId:e.structureId}},{linkType:Zo,source:{roundNumber:i,structureId:e.structureId},target:{feedProfile:Yo,roundNumber:1,structureId:n.structureId}},{linkType:Qo,source:{roundNumber:i,structureId:e.structureId},target:{feedProfile:Yo,roundNumber:1,structureId:n.structureId}}]}({mainStructure:c,consolationStructure:l,deciderStructure:f});return e.links=e.links.concat(...m),Object.assign({structures:e.structures,links:e.links},de)}function _h({mainStructure:e,consolationStructure:t,roundsCount:n,roundOffset:r=0,feedPolicy:i,fmlc:a}){const o=t.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),s=(null==i?void 0:i.roundGroupedOrder)||[],c=null==i?void 0:i.roundFeedProfiles;return ie(1+r,n+1+r).map((n=>{const i=c&&c[n-1]?c[n-1]:n%2?Yo:$o,u=n-r<=2?n-r:2*(n-r-2)+2,d={linkType:Qo,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:i,roundNumber:u,structureId:t.structureId}},l=s[n-1];return l&&(d.target.groupedOrder=l),Xn()&&(d.source.structureName=e.structureName,d.target.structureName=t.structureName),2===n&&a&&(d.linkCondition=Xo,d.target.feedProfile=Yo),o.includes(u)?d:void 0})).filter(Boolean)}function Bh({finishingPositionOffset:e,structureName:t=Lo,stageSequence:n=1,staggeredEntry:r,drawDefinition:i,matchUpType:a,idPrefix:o,isMock:s,uuids:c}){const u=vu({stage:Lo,drawDefinition:i}),d={finishingPositionOffset:e,matchUpType:a,drawSize:u,idPrefix:o,isMock:s,uuids:c},{matchUps:l,roundsCount:p}=r?xh(d):Ch(d),f=Fh({matchUps:l,matchUpType:a,stage:Lo,structureName:t,stageSequence:n,structureId:null==c?void 0:c.pop()});i.structures.push(f);const m=[0,2].slice(0,u/16).map(((e,t)=>{const n=t+1,{consolationStructure:r}=function({stageSequence:e=1,roundOffset:t=0,matchUpType:n,structureId:r,idPrefix:i,drawSize:a,isMock:o,index:s,uuids:c}){const u=a/(2*Math.pow(2,t)),{matchUps:d,roundsCount:l}=xh({finishingPositionOffset:u,baseDrawSize:u,isConsolation:!0,feedRounds:1,matchUpType:n,idPrefix:i,isMock:o,uuids:c});return{consolationStructure:Fh({matchUps:d,stage:Fo,structureName:`${Fo} ${s+1}`,stageSequence:e,matchUpType:n,structureId:r}),consolationRoundsCount:l}}({structureId:null==c?void 0:c.pop(),idPrefix:o&&`${o}-c${t}`,stageSequence:n,roundOffset:e,matchUpType:a,drawSize:u,isMock:s,index:t,uuids:c});i.structures.push(r);return{consolationStructure:r,links:_h({mainStructure:f,consolationStructure:r,roundsCount:2,roundOffset:e})}})).map((e=>e.links));if(i.links=i.links.concat(...m),u>=4&&u<=16||u>32){const{matchUps:e}=Ch({finishingPositionOffset:2,idPrefix:o&&`${o}-p3t4`,drawSize:2,matchUpType:a,isMock:s}),t=Fh({structureId:null==c?void 0:c.pop(),matchUps:e,structureName:_o,stageSequence:2,matchUpType:a,stage:Lo}),n={linkType:Qo,source:{roundNumber:p-1,structureId:f.structureId},target:{roundNumber:1,feedProfile:Yo,structureId:t.structureId}};i.structures.push(t),i.links.push(n)}return Object.assign({structures:i.structures,links:i.links},de)}function Gh(e={}){const{uuids:t,feedRounds:n,matchUpType:r,stage:i=Lo,structureName:a,drawDefinition:o,feedsFromFinal:s,stageSequence:c=1,finishingPositionOffset:u,staggeredEntry:d,feedPolicy:l,idPrefix:p,isMock:f,fmlc:m}=e,h=vu({stage:i,drawDefinition:o}),v={finishingPositionOffset:u,matchUpType:r,drawSize:h,idPrefix:p,isMock:f,uuids:t},{matchUps:g}=d?xh(v):Ch(v),I=Fh({structureName:a||Lo,structureId:null==t?void 0:t.pop(),stageSequence:c,stage:Lo,matchUpType:r,matchUps:g});o.structures.push(I);const y=h/2,{matchUps:b,roundsCount:w}=xh({finishingPositionOffset:y,isConsolation:!0,feedsFromFinal:s,baseDrawSize:y,matchUpType:r,feedRounds:n,idPrefix:p&&`${p}-c`,isMock:f,uuids:t,fmlc:m}),U=Fh({matchUpType:r,stageSequence:1,stage:Fo,structureId:null==t?void 0:t.pop(),structureName:Fo,matchUps:b});o.structures.push(U);const S=_h({mainStructure:I,consolationStructure:U,roundsCount:w,feedPolicy:l,fmlc:m});return o.links=o.links.concat(...S),Object.assign({mainStructure:I,consolationStructure:U,links:o.links},de)}function Vh({tieFormat:e,uuids:t}){const{collectionDefinitions:n}=e||{};return{tieMatchUps:(n||[]).map((e=>{const{matchUpCount:n,matchUpFormat:r,matchUpType:i,collectionId:a}=e||{};return ie(0,n||0).map((e=>({isMock:!0,collectionId:a,matchUpType:i,matchUpFormat:r,collectionPosition:e+1,matchUpId:(null==t?void 0:t.pop())||Wr(),sides:[{sideNumber:1},{sideNumber:2}]})))})).filter(Boolean).flat()}}function qh({stage:e,stageSequence:t,drawDefinition:n}={}){if(!n)return{error:Ie};return{structures:n.structures.filter((function(t){return t.stage===e})).filter((function(e){return!t||e.stageSequence===t}))}}function Hh(e){const{structure:t,childStructures:n}=Wh(e),r=[t.structureId,...n.map((({structureId:e})=>e))];return e.drawDefinition.structures.sort(jc),Nc({drawDefinition:e.drawDefinition,structureIds:r}),Object.assign({structure:t,childStructures:n},de)}function Wh({finishingPositionOffset:e=0,playoffStructureNameBase:t,finishingPositionNaming:n,finishingPositionLimit:r,playoffAttributes:i,stageSequence:a=1,exitProfile:o="0",exitProfileLimit:s,roundOffsetLimit:c,roundOffset:u=0,drawDefinition:d,staggeredEntry:l,sequenceLimit:p,stage:f=Lo,matchUpType:m,idPrefix:h,drawSize:v,isMock:g,uuids:I}){if(!(!i||!s||i&&i[o])||v<2||p&&a>p)return{};m=m||(null==d?void 0:d.matchUpType);const y=e+1,b=`${y}-${e+v}`,w=i&&i[o],U=t&&`${t} `||"",S=n&&n[b],D=(null==S?void 0:S.name)||(null==w?void 0:w.name)||`${U}${b}`,N=(null==S?void 0:S.abbreviation)||(null==w?void 0:w.abbreviation),P={idPrefix:h&&`${h}-${D}-RP`,finishingPositionOffset:e,matchUpType:m,drawSize:v,isMock:g,uuids:I},{matchUps:A}=l?xh(P):Ch(P),M=Fh({structureId:null==I?void 0:I.pop(),structureAbbreviation:N,stageSequence:a,structureName:D,matchUpType:m,roundOffset:u,exitProfile:o,matchUps:A,stage:f});d.structures.push(M),wc({drawDefinition:d,matchUps:A});const T=Math.ceil(Math.log(v)/Math.log(2)),E=ie(1,(c?Math.min(c-u,T):!r||y<r?T:0)+1).map((function(l){const g=v/Math.pow(2,l);if(g<2)return;const y=v/Math.pow(2,l)+e;if(y+1>r)return;const{structure:b,structureName:w,childStructures:U}=Wh({finishingPositionOffset:y,exitProfile:`${o}-${l}`,roundOffset:u+l,stageSequence:a+1,drawSize:g,playoffStructureNameBase:t,finishingPositionNaming:n,finishingPositionLimit:r,playoffAttributes:i,exitProfileLimit:s,roundOffsetLimit:c,drawDefinition:d,sequenceLimit:p,matchUpType:m,idPrefix:h,uuids:I,stage:f}),S={linkType:Qo,source:{roundNumber:l,structureName:D,structureId:null==M?void 0:M.structureId},target:{roundNumber:1,feedProfile:Yo,structureName:w,structureId:null==b?void 0:b.structureId}};M&&b&&d.links.push(S);return{structure:b,childStructures:U}})).filter(Boolean);return{structure:M,structureName:D,childStructures:E}}function zh({structureName:e=Lo,stageSequence:t=1,structureOptions:n,seedingProfile:r,drawDefinition:i,stage:a=Lo,matchUpType:o,idPrefix:s,uuids:c}){const u=Ds,d=vu({stage:a,drawDefinition:i}),{groupCount:l,groupSize:p}=function({structureOptions:e,drawSize:t}){let n=null==e?void 0:e.groupSize;const r=(null==e?void 0:e.groupSizeLimit)||8,i=function({drawSize:e,groupSizeLimit:t=10}){return ie(3,t+1).filter((t=>Math.ceil(e/t)*t-e<t))}({drawSize:t,groupSizeLimit:r}),a=Math.max(...i);n&&i.includes(n)||(n=n&&n>4||!i.includes(4)?a:4);const o=Math.ceil(t/n);return{groupSize:n,groupCount:o}}({structureOptions:n,drawSize:d}),f=ie(1,l+1).map((e=>Fh({structureName:`Group ${e}`,matchUps:Yh({groupSize:p,structureOrder:e,matchUpType:o,idPrefix:s}),structureId:null==c?void 0:c.pop(),structureType:Ho,finishingPosition:u,structureOrder:e,matchUpType:o}))),m=Fh({structureId:null==c?void 0:c.pop(),structureType:Wo,finishingPosition:u,seedingProfile:r,structureName:e,stageSequence:t,matchUpType:o,structures:f,stage:a});return i.structures.push(m),Object.assign({structure:m,groupCount:l,groupSize:p},de)}function Kh({finishingPositions:e,playoffStructure:t,mainStructure:n}){return{linkType:Jo,source:{finishingPositions:e,structureId:n.structureId},target:{roundNumber:1,feedProfile:zo,structureId:t.structureId}}}function Yh({structureOrder:e,matchUpType:t,groupSize:n,idPrefix:r,uuids:i}){const a=(e-1)*n,o=ie(1+a,n+1+a),{uniqueMatchUpGroupings:s}=ch({drawPositions:o}),c=function({groupSize:e,drawPositionOffset:t}){const n=e=>[...Array(e)].map(((e,t)=>t)),r=n(2*Math.round(e/2)+1).slice(1),i=n(r.length-1).map((()=>[]));let a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach(((e,t)=>{a.forEach(((e,n)=>{i[t].push([a[n],o[n]])}));const n=a.shift(),r=a.pop(),s=o.shift();a=[].concat(n,s,...a),o=[].concat(...o,r)}));const s=a.shift(),c=a.pop(),u=o.shift();a=[].concat(s,u,...a),o=[].concat(...o,c);const d=e=>e[0].reduce(((e,t)=>e+t));return i.reverse().sort(((e,t)=>d(e)-d(t))).map((n=>n.filter((t=>t.every((t=>t<=e)))).map((e=>uh(e.map((e=>e+t)))))))}({groupSize:n,drawPositionOffset:a});return s.map((function(n){const a=function(e){return c.reduce(((t,n,r)=>n.includes(e)?r+1:t),void 0)}(uh(n)),o=u(n.slice(1)),s=u(n.slice(0,n.length-1)),d=function({structureOrder:e,drawPositions:t,roundNumber:n,idPrefix:r,uuids:i}){return r?`${r}-${e}-${n}-DP-${t.join("-")}`:(null==i?void 0:i.pop())||Wr()}({structureOrder:e,drawPositions:n,roundNumber:a,idPrefix:r,uuids:i});return{matchUpStatus:a?R:w,matchUpType:t,finishingPositionRange:{winner:s,loser:o},drawPositions:n,roundNumber:a,matchUpId:d}})).sort(((e,t)=>(e.roundNumber||9999)-(t.roundNumber||9999)));function u(e){return[Math.min(...e),Math.max(...e)]}}function $h(e={}){const{drawType:t=is,stageSequence:n=1,drawDefinition:r,staggeredEntry:i,structureName:a,goesTo:o=!0,stage:s=Lo,uuids:c}=e;if(!r)return{error:Ie};let{tieFormat:u,matchUpType:d}=e;u=u||r.tieFormat,d=d||r.matchUpType||ua;const l=vu({stage:s,drawDefinition:r});Object.assign(e,{drawSize:l,matchUpType:d,tieFormat:u});const p=H(2*l/3);if(l<2||!i&&![ts,es].includes(t)&&(t===Is&&l<3||t===as&&!p||![Is,as,ys].includes(t)&&!H(l)))return{error:Ee,drawSize:l};const f=Ps.includes(t);if(parseInt(l)<4&&f)return{error:Ee};const m=1===n?1:void 0,{structures:h}=qh({stage:s,stageSequence:n,drawDefinition:r});if(h.length>=m)return{error:et};const v={[es]:()=>{const e=Fh({structureName:a||s,finishingPosition:Ds,structureId:null==c?void 0:c.pop(),stageSequence:n,matchUps:[],matchUpType:d,stage:s});return r.structures.push(e),Object.assign({structure:e},de)},[is]:()=>{const{matchUps:t,roundLimit:i}=Ch(e),o=Fh({stage:s,matchUps:t,matchUpType:d,stageSequence:n,qualifyingRound:s===ko&&i,structureId:null==c?void 0:c.pop(),roundLimit:i,structureName:a||s});return r.structures.push(o),Object.assign({structure:o},de)},[as]:()=>jh(e),[ns]:()=>Hh(Object.assign(e,{roundOffsetLimit:3,playoffAttributes:Us})),[rs]:()=>Hh(Object.assign(e,{roundOffsetLimit:2,playoffAttributes:Ss})),[_o]:()=>Hh(e),[ts]:()=>{const{matchUps:e}=xh({drawSize:l,uuids:c,matchUpType:d}),t=Fh({structureName:a||s,structureId:null==c?void 0:c.pop(),stageSequence:n,matchUpType:d,matchUps:e,stage:s});return r.structures.push(t),Object.assign({structure:t},de)},[ss]:()=>function(e){let{drawSize:t,consolationStructureName:n}=e;const{finishingPositionOffset:r=0,stageSequence:i=1,drawDefinition:a,staggeredEntry:o,structureName:s,stage:c=Lo,matchUpType:u,idPrefix:d,isMock:l,uuids:p}=e;t=t||vu({stage:c,drawDefinition:a});const f={finishingPositionOffset:r,matchUpType:u,drawSize:t,idPrefix:d,isMock:l,uuids:p},{matchUps:m}=o?xh(f):Ch(f),h=Fh({stage:c,matchUps:m,matchUpType:u,stageSequence:i,structureId:null==p?void 0:p.pop(),structureName:s||Lo});a&&a.structures.push(h);const v=t/2,{matchUps:g}=Ch({finishingPositionOffset:r+v,drawSize:v,idPrefix:d&&`${d}-c`,matchUpType:u,isMock:l});n=n||(s?`${s} ${Fo}`:Fo);const I=Fh({matchUpType:u,stageSequence:1,stage:Fo,structureId:null==p?void 0:p.pop(),matchUps:g,structureName:n});a&&a.structures.push(I);const y={linkType:Qo,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:Yo,structureId:I.structureId}};return a&&a.links.push(y),Object.assign({link:y,mainStructure:h,consolationStructure:I,links:null==a?void 0:a.links},de)}(e),[os]:()=>Gh(Object.assign(e,{feedRounds:1,fmlc:!0})),[hs]:()=>Gh(Object.assign(e,{feedRounds:1})),[ls]:()=>Gh(Object.assign(e,{feedsFromFinal:2})),[us]:()=>Gh(Object.assign(e,{feedsFromFinal:1})),[fs]:()=>Gh(Object.assign(e,{feedsFromFinal:3})),[gs]:()=>Gh(e),[cs]:()=>Bh(e),[Is]:()=>zh(e),[ys]:()=>function(e){const{playoffMatchUpFormat:t,stageSequence:n=1,structureOptions:r,drawDefinition:i,matchUpType:a,idPrefix:o,uuids:s}=e,c=Object.assign({structureName:Lo},e,{stage:Lo}),{structure:u,groupCount:d,groupSize:l}=zh(c);d<1&&console.log(kn);const p=r&&r.playoffGroups||[{finishingPositions:[1],structureName:_o}];let f=0;const m=p.map(((e,r)=>{const c=r+1,p=ie(1,l+1),m=e.finishingPositions;if(!m.reduce(((e,t)=>p.includes(t)&&e),!0))return;const h=e.drawType||is,v=d*m.length,g=K(v);if(h===is){const{matchUps:r}=Ch({idPrefix:o&&`${o}-po`,finishingPositionOffset:f,matchUpType:a,drawSize:g}),d=Fh({matchUps:r,stageOrder:c,matchUpType:a,stageSequence:n,stage:_o,structureId:null==s?void 0:s.pop(),structureName:e.structureName,matchUpFormat:t});i.structures.push(d);const l=Kh({mainStructure:u,playoffStructure:d,finishingPositions:m});return i.links.push(l),f+=v,d}if(h===os){console.log("RRw/PO FIRST_MATCH_LOSER_CONSOLATION");const t=[null==s?void 0:s.pop(),null==s?void 0:s.pop()],{mainStructure:n,consolationStructure:r,link:c}=Gh({structureName:e.structureName,idPrefix:o&&`${o}-po`,finishingPositionOffset:f,uuids:t,stage:_o,feedRounds:1,matchUpType:a,fmlc:!0,drawSize:g}),d=Kh({mainStructure:u,playoffStructure:n,finishingPositions:m});return i.links.push(d),i.structures.push(n),i.structures.push(r),i.links.push(c),f+=v,n}})).filter(Boolean);return Object.assign({mainStructure:u,playoffStructures:m,links:i.links},de)}(e)}[t],g=v&&v();if(null==g||!g.success)return{error:Ne};const{matchUps:I,matchUpsMap:y}=sd({drawDefinition:r});let b;u&&I.forEach((e=>{const{tieMatchUps:t}=Vh({tieFormat:u});Object.assign(e,{tieMatchUps:t,matchUpType:d})})),o&&({inContextDrawMatchUps:b}=wd({drawDefinition:r,matchUpsMap:y}));const w={...de,matchUps:I};return Object.assign(w,g,{matchUpsMap:y,inContextDrawMatchUps:b}),Nc({drawDefinition:r}),w}function Jh({drawDefinition:e,stage:t,drawSize:n}){if(!e)return{error:Ie};if(!hu({drawDefinition:e,stage:t}))return{error:Xe};if(n<bu({drawDefinition:e,stage:t})+gu({drawDefinition:e,stage:t}))return{error:"Cannot set drawSize to be less than existing entries"};const{entryProfile:r}=$c({drawDefinition:e,attributes:[{[t]:{drawSize:n}}]});return Nc({drawDefinition:e}),{...de,entryProfile:r}}function Zh({drawDefinition:e,policyDefinitions:t}){if(!e)return{error:Ie};if(!t||"object"!=typeof t)return{error:It};e.extensions||(e.extensions=[]);const{appliedPolicies:n}=xc({drawDefinition:e}),r=Object.keys(t).every((e=>!n[e]&&(n[e]=t[e],!0)));if(r){const t=Vc({element:e,extension:{name:ki,value:n}});if(t.error)return t}return Nc({drawDefinition:e}),r?{...de}:{error:Ut}}function Qh({tournamentRecord:e,participantId:t,scaleAttributes:n}){if(!e)return{error:me};if(!t)return{error:Yt};const{participant:r}=ra({tournamentRecord:e,participantId:t});return r?mm({participant:r,scaleAttributes:n}):{error:$t}}function Xh({tournamentRecord:e,event:t,stage:n,entries:r,scaleAttributes:i,scaleSortMethod:a,sortDescending:o=!1}){if(!e)return{error:me};return{scaledEntries:(r=r||(null==t?void 0:t.entries)||[]).filter((e=>(!n||!e.entryStage||e.entryStage===n)&&du.includes(e.entryStatus))).map((t=>{const{participantId:n}=t,{scaleItem:r}=Qh({tournamentRecord:e,participantId:n,scaleAttributes:i});return{...t,...r}})).filter((e=>{const t=e.scaleValue;return!!(a||!isNaN(t)&&parseFloat(t))&&t})).sort(a||function(e,t){return o?s(t)-s(e):s(e)-s(t)})};function s(e){return parseFloat(e.scaleValue||(o?-1:1e5))}}const ev=["drawId","structures"];function tv(e,t=!0){return e?"object"!=typeof e?{error:Fn}:e.drawId?function(e){const t=Object.keys(e);return ev.reduce(((e,n)=>!!t.includes(n)&&e),!0)}(e)?t?Gr(e):e:{error:ge}:{error:Re,method:"setState"}:{error:Ie}}function nv({drawId:e=Wr(),matchUpType:t,drawType:n}={}){const r={drawId:void 0,drawName:void 0,matchUpType:void 0,entries:[],links:[],structures:[]};return Object.assign(r,{drawId:e,drawType:n,matchUpType:t})}const rv={STANDARD:{doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},COLLEGE_D3:{doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_D3",valueGoal:5},COLLEGE_DEFAULT:{doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:"SET1-S:6NOAD/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6NOAD/TB7"},tieFormatName:"COLLEGE_DEFAULT",valueGoal:4},COLLEGE_JUCO:{doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6"},tieFormatName:"COLLEGE_JUCO",valueGoal:5}},iv=({namedFormat:e,uuids:t=[]}={})=>{var n,r;Object.keys(rv).includes(e)||(e="STANDARD"),Array.isArray(t)||(t=[]);const i=rv[e],a={winCriteria:{valueGoal:i.valueGoal},collectionDefinitions:[{collectionId:(null===(n=t)||void 0===n?void 0:n.pop())||Wr(),collectionName:"Doubles",matchUpType:da,matchUpFormat:"SET3-S:6/TB7-F:TB10",...i.doubles},{collectionId:(null===(r=t)||void 0===r?void 0:r.pop())||Wr(),collectionName:"Singles",matchUpType:ua,matchUpFormat:"SET3-S:6/TB7",...i.singles}]};return i.tieFormatName&&(a.tieFormatName=i.tieFormatName),a};function av(e){const{drawType:t=is,enforcePolicyLimits:n=!0,finishingPositionNaming:r,ignoreAllowedDrawTypes:i,seedAssignmentProfile:a,playoffMatchUpFormat:o,seedByRanking:s=!0,qualifyingPositions:c,seededParticipants:u,policyDefinitions:d,seedingScaleName:l,assignSeedsCount:p,automated:f=!0,qualifyingRound:m,seedingProfile:h,tieFormatName:v,stage:g=Lo,drawEntries:I,feedPolicy:y,idPrefix:b,drawId:w,isMock:U,uuids:S}=e,{tournamentRecord:D,event:N}=e;let{drawName:P,matchUpType:A,structureOptions:M}=e;const T=null==D?void 0:D.participants,E=N&&T&&Qm({event:N,participants:T});if(null!=E&&E.error)return E;const C=!i&&D&&Cm({tournamentRecord:D,categoryType:null==N?void 0:N.categoryType,categoryName:null==N?void 0:N.categoryName});if(null!=C&&C.length&&!C.includes(t))return{error:"Invalid drawType"};let{seedsCount:R,drawSize:O=32,tieFormat:x,matchUpFormat:L}=e;"number"!=typeof O&&(O=parseInt(O)),"number"!=typeof R&&(R=parseInt(R||0));const k=null==N?void 0:N.eventType;A=A||k,A===la&&k===la?(x=x&&v&&("object"==typeof x?x:iv({namedFormat:v})),L=void 0):L||(x=void 0,L="SET3-S:6/TB7");const F=I||(null==N?void 0:N.entries)||[],j=F.filter((e=>(!e.entryStage||e.entryStage===g)&&du.includes(e.entryStatus)));[Is].includes(t)&&(O=j.length||O);const _=nv({drawType:t,drawId:w});if(Jh({drawDefinition:_,stage:g,drawSize:O}),I){I.reduce(((e,t)=>e.includes(t.entryStage)?e:e.concat(t.entryStage)),[]).filter((e=>e!==g)).filter(Boolean).length&&console.log("drawEntryStages")}if(L||x){if(L&&(null==N?void 0:N.matchUpFormat)===L||(null==N?void 0:N.tieFormat)&&x&&JSON.stringify(N.tieFormat)===JSON.stringify(x))A&&(_.matchUpType=A);else{let e=Vl({drawDefinition:_,matchUpFormat:L,tieFormat:x,event:N});if(e.error)return{error:e.error,message:"matchUpFormat or tieFormat error"};A&&(_.matchUpType=A),x&&(_.tieFormat=x),e.tieFormat&&(x=e.tieFormat)}}x=x||(null==N?void 0:N.tieFormat);let B=$h({finishingPositionNaming:r,goesTo:e.goesTo,playoffMatchUpFormat:o,qualifyingPositions:c,structureOptions:M,qualifyingRound:m,drawDefinition:_,seedingProfile:h,matchUpFormat:L,matchUpType:A,feedPolicy:y,tieFormat:x,drawType:t,idPrefix:b,isMock:U,stage:g,uuids:S});if(B.error)return B;const{matchUpsMap:G,inContextDrawMatchUps:V}=B,{structures:q}=qh({drawDefinition:_,stageSequence:1,stage:g}),[H]=q,{structureId:W}=H||{};if("object"==typeof d)for(const ee of Object.keys(d))Zh({policyDefinitions:{[ee]:d[ee]},drawDefinition:_});const{policyDefinitions:z}=Qd({policyTypes:[oi],tournamentRecord:D,drawDefinition:_,event:N})||{};null!=d&&d.seeding||null!=z&&z.seeding||Zh({drawDefinition:_,policyDefinitions:Hs});const{policyDefinitions:K}=Qd({policyTypes:[ai],tournamentRecord:D,drawDefinition:_,event:N})||{};null!=d&&d.avoidance||null==K||!K.avoidance||Zh({drawDefinition:_,policyDefinitions:K});for(const ee of F){const e=qm({...ee,entryStage:ee.entryStage||Lo,drawDefinition:_});if(I&&e.error)return e}const Y=F.map(Cc);u&&(R=u.length),R>O&&(R=O),R>j.length&&(R=j.length);const{seedLimit:$}=Eh({participantCount:j.length,enforcePolicyLimits:n,tournamentRecord:D,drawDefinition:_,structureId:W,seedsCount:R,event:N});if($&&$<R&&(R=$),u)u.filter((({participantId:e})=>Y.includes(e))).filter((e=>!e.seedNumber||e.seedNumber<=u.length)).sort(((e,t)=>e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0)).forEach((e=>{const{participantId:t,seedNumber:n,seedValue:r}=e;Xm({drawDefinition:_,participantId:t,structureId:W,seedNumber:n,seedValue:r})}));else if(null!=N&&N.category||l){var J,Z;const{categoryName:e,ageCategoryCode:t}=(null==N?void 0:N.category)||{},n={scaleType:pm,scaleName:l||e||t,eventType:k};let{scaledEntries:r}=Xh({scaleAttributes:n,tournamentRecord:D,entries:F,stage:g});if((null===(J=r)||void 0===J||!J.length)&&s){const n={scaleType:lm,scaleName:e||t,eventType:k};({scaledEntries:r}=Xh({scaleAttributes:n,tournamentRecord:D,entries:F,stage:g}))}const i=(null===(Z=r)||void 0===Z?void 0:Z.length)||0;i<R&&(R=i),r&&r.filter((({participantId:e})=>Y.includes(e))).slice(0,p||R).forEach(((e,t)=>{const n=t+1,r=(null==a?void 0:a[n])||n,{participantId:i}=e;Xm({drawDefinition:_,participantId:i,structureId:W,seedNumber:n,seedValue:r})}))}let Q=[];if(!1!==f){const e="object"==typeof f&&f.seedsOnly;({conflicts:Q}=wh({drawDefinition:_,participants:T,structureId:W,seedsOnly:e,inContextDrawMatchUps:V,matchUpsMap:G}))}P=P||t,_&&Object.assign(_,{drawName:P});const X={drawId:_.drawId,category:null==N?void 0:N.category,eventId:null==N?void 0:N.eventId,seedingScaleName:l,matchUpType:A,seedsCount:R,automated:f,tieFormat:x,drawSize:O,drawType:t,drawName:P};return nr({topic:uc,payload:{action:"generateDrawDefinition",payload:X}}),{...de,structureId:W,drawDefinition:_,conflicts:Q}}function ov({tournamentRecord:e,drawDefinition:t,participantId:n,entryPosition:r,event:i}){return e?n?void 0===r||Number.isSafeInteger(r)?(((null==i?void 0:i.entries)||[]).forEach((e=>{e.participantId===n&&(e.entryPosition=r)})),((null==t?void 0:t.entries)||[]).forEach((e=>{e.participantId===n&&(e.entryPosition=r)})),de):{error:jn,entryPosition:r}:{error:Yt}:{error:me}}function sv({drawDefinition:e,stages:t}){return((null==e?void 0:e.structures)||[]).filter((e=>!(null!=t&&t.length)||t.includes(e.stage))).map((e=>{const{positionAssignments:t}=Pu({structure:e});return Ec(t)})).flat()}function cv({autoEntryPositions:e=!0,tournamentRecord:t,drawDefinition:n,participantIds:r,entryStatus:i,eventSync:a,drawId:o,stage:s,event:c}){var u,d,l,p,f,m,h,v,g,I;if(!r||!Array.isArray(r))return{error:Vt,method:"modifyEntriesStatus",participantIds:r};if(!lu.includes(i))return{error:un};if(!n&&!c)return{error:ze};const y=[];null===(u=c.drawDefinitions)||void 0===u||u.forEach((e=>{const t=sv({drawDefinition:e});y.push(...t)}));const b=(null==t?void 0:t.participants)||[];if(!r.every((e=>{const{participantType:t}=na({tournamentParticipants:b,participantId:e});return!(t===La&&Km(i))})))return{error:un};const{flightProfile:w}=tl({event:c}),U=null==w||null===(d=w.flights)||void 0===d?void 0:d.find((e=>e.drawId===o)),S=(e=[])=>{const t=e.filter((e=>!s||!e.entryStage||s===e.entryStage)).filter((({participantId:e})=>r.includes(e)));return t.every((e=>!(e=>y.includes(e.participantId)&&!(cu.includes(e.entryStatus)&&cu.includes(i)))(e)&&(e.entryStatus=i,delete e.entryPosition,!0)))?de:{error:nn}},D=({flight:e,drawDefinition:t})=>{c.entries=Gm({entries:c.entries||[]}),e&&(e.drawEntries=Gm({entries:e.drawEntries})),t&&(t.entries=Gm({entries:t.entries}))},N=({flight:e,drawDefinition:t})=>{if(e){const t=S(e.drawEntries);if(t.error)return t}if(t){const e=S(t.entries);if(e.error)return e}return{...de}},P=(null===(l=c.entries)||void 0===l?void 0:l.find((({entryPosition:e})=>!isNaN(e))))||(null==U||null===(p=U.drawEntries)||void 0===p?void 0:p.find((({entryPosition:e})=>!isNaN(e))))||(null==n||null===(f=n.entries)||void 0===f?void 0:f.find((({entryPosition:e})=>!isNaN(e))));if(e&&!P&&D({flight:U,drawDefinition:n}),U||n){const e=N({flight:U,drawDefinition:n});if(e.error)return e}const A=(null===(m=c.drawDefinitions)||void 0===m?void 0:m.map((({drawId:e})=>e)))||[],M=(null==w||null===(h=w.flights)||void 0===h?void 0:h.filter((e=>!A.includes(e.drawId))))||[];for(const R of M){const e=N({flight:R});if(e.error)return e}const T=1===(null==w||null===(v=w.flights)||void 0===v?void 0:v.length)&&(null===(g=c.drawDefinitions)||void 0===g?void 0:g.length)<=(null==w||null===(I=w.flights)||void 0===I?void 0:I.length);if(!U&&!n&&uu.includes(i))return{error:pn};if(!U&&!n||i===au||a&&T){const e=S(c.entries);if(e.error)return e;let t;var E,C;if(i===au)null==w||null===(E=w.flights)||void 0===E||E.every((e=>{const n=S(e.drawEntries);return n.error?(t=n.error,!1):(e.drawEntries=e.drawEntries.filter((({participantId:e})=>!r.includes(e))),!0)})),null===(C=c.drawDefinitions)||void 0===C||C.every((e=>{const n=S(e.entries);return n.error?(t=n.error,!1):(e.entries=e.entries.filter((({participantId:e})=>!r.includes(e))),!0)}));if(t)return{error:t}}return e&&D({flight:U,drawDefinition:n}),de}function uv(e){const{drawId:t,replaceWithBye:n,destroyPair:r,entryStatus:i,drawDefinition:a,matchUpsMap:o}=e,s=Jd(e);if(s.error)return s;const{participantId:c}=s,{drawPosition:u,event:d,structureId:l}=e;if([Zc,au].includes(i)&&c){const{tournamentRecord:n}=e,{participant:o}=ra({tournamentRecord:n,participantId:c}),{participantType:s,individualParticipantIds:u}=o||{};if(r&&s===La){const e=Jm({tournamentRecord:n,drawDefinition:a,participantId:c,event:d});if(e.error)return e;cv({tournamentRecord:n,participantIds:u,entryStatus:i,drawDefinition:a,drawId:t,event:d})}else cv({tournamentRecord:n,participantIds:[c],entryStatus:i,drawDefinition:a,drawId:t,event:d})}if(n){const e=ul({drawDefinition:a,structureId:l,drawPosition:u,matchUpsMap:o});if(e.error)return e}const{structure:p}=_c({drawDefinition:a,structureId:l});Nl({structure:p,drawPositions:[u]});return Pl({drawDefinition:a,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:n,drawPosition:u,entryStatus:i,structureId:l}}),s}function dv({drawDefinition:e,drawPositions:t,structureId:n}){if(!e)return{error:Ie};if(!n)return{error:Ge};if(2!==(null==t?void 0:t.length))return{error:jn,drawPositions:t};const r=kc({drawDefinition:e}),{matchUps:i}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e}),{structure:a}=_c({drawDefinition:e,structureId:n});if(!a)return{error:Ve};let o;if(o=a.structureType===Wo?function({drawDefinition:e,drawPositions:t,structure:n,matchUpsMap:r,inContextDrawMatchUps:i}){var a;const o=null===(a=n.structures)||void 0===a?void 0:a.reduce(((e,n)=>{const r=null==n?void 0:n.positionAssignments.filter((e=>t.includes(e.drawPosition)));return r&&e.push(...r),e}),[]);if(2===o.filter((({bye:e})=>e)).length)return{...de};if(o.some((({bye:e})=>e)))lv({drawDefinition:e,assignments:o,structure:n,matchUpsMap:r,inContextDrawMatchUps:i});else{const e=o.map(Cc);o.forEach(((t,n)=>t.participantId=e[1-n]))}return{...de}}({drawDefinition:e,structure:a,drawPositions:t,matchUpsMap:r,inContextDrawMatchUps:i}):function({drawDefinition:e,structure:t,drawPositions:n,matchUpsMap:r,inContextDrawMatchUps:i}){const a=null==t?void 0:t.positionAssignments.filter((e=>n.includes(e.drawPosition)));if(!a)return{error:jn,structure:t,message:"Missing positionAssignments"};if(2===a.filter((({bye:e})=>e)).length)return{...de};return a.some((({bye:e})=>e))?lv({drawDefinition:e,structure:t,assignments:a,matchUpsMap:r,inContextDrawMatchUps:i}):function({structure:e,assignments:t}){const n=Object.assign({},...t.map(((e,n)=>{const{drawPosition:r}=e;return{[r]:{...t[1-n],drawPosition:r}}})));return e.positionAssignments=e.positionAssignments.map((e=>n[e.drawPosition]||e)),{...de}}({structure:t,assignments:a,matchUpsMap:r,inContextDrawMatchUps:i})}({drawDefinition:e,structure:a,drawPositions:t,matchUpsMap:r,inContextDrawMatchUps:i}),o.error)return o;Nl({structure:a,drawPositions:t});return Pl({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:t,structureId:n}}),Nc({drawDefinition:e,structureIds:[n]}),{...de}}function lv({drawDefinition:e,structure:t,assignments:n,matchUpsMap:r,inContextDrawMatchUps:i}){const a=n.find((({bye:e})=>e)),o=n.find((({participantId:e})=>e)),s=a.drawPosition,{participantId:c,drawPosition:u}=o,{structureId:d}=t;let l=uv({drawDefinition:e,structureId:d,drawPosition:s,matchUpsMap:r,inContextDrawMatchUps:i});return l.error?l:(l=uv({drawDefinition:e,structureId:d,drawPosition:u,matchUpsMap:r,inContextDrawMatchUps:i}),l.error?l:(l=ul({drawDefinition:e,structureId:d,drawPosition:u,matchUpsMap:r,inContextDrawMatchUps:i}),l=Ol({drawDefinition:e,structureId:d,drawPosition:s,participantId:c,matchUpsMap:r,inContextDrawMatchUps:i}),l.error?l:{...de}))}function pv(e){const{participantIdAttributeName:t="participantId",positionActionName:n,drawDefinition:r,participantId:i,drawPosition:a,structureId:o}=e;if(!r)return{error:Ie};let{inContextDrawMatchUps:s,matchUpsMap:c}=e;c||(c=kc({drawDefinition:r}),Object.assign(e,{matchUpsMap:c})),s||(({matchUps:s}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:c})),Object.assign(e,{inContextDrawMatchUps:s}));const{positionAssignments:u}=Pu({drawDefinition:r,structureId:o}),d=u.find((e=>e.drawPosition===a));if(null!=d&&d.participantId){let e=Ol({inContextDrawMatchUps:s,drawDefinition:r,participantId:i,drawPosition:a,structureId:o,matchUpsMap:c});return e.success||console.log({result:e}),f({removedParticipantId:d.participantId})}let l=Jd({inContextDrawMatchUps:s,drawDefinition:r,drawPosition:a,structureId:o,matchUpsMap:c});if(l.error)return l;const p=l.participantId;return l=Ol({inContextDrawMatchUps:s,drawDefinition:r,participantId:i,drawPosition:a,structureId:o,matchUpsMap:c}),l.success?f({removedParticipantId:p}):l;function f({removedParticipantId:e}){const{structure:s}=_c({drawDefinition:r,structureId:o});Nl({drawPositions:[a],structure:s});return Pl({drawDefinition:r,positionAction:{[t]:i,name:n,drawPosition:a,structureId:o}}),{...de,removedParticipantId:e}}}function fv({alternateParticipantId:e,drawDefinition:t,drawPosition:n,structureId:r}){return pv({participantId:e,drawDefinition:t,drawPosition:n,structureId:r,participantIdAttributeName:"alternateParticipantid",positionActionName:"alternateDrawPositionAssignment"})}function mv({drawDefinition:e,structureId:t}){const{structure:n,error:r}=_c({drawDefinition:e,structureId:t});if(r)return{error:r};const{matchUps:i}=Ou({structure:n});return Lc({matchUps:i})}function hv({drawDefinition:e,structureId:t,finishingPositions:n}){const{roundProfile:r}=mv({drawDefinition:e,structureId:t});return Object.keys(r).reduce(((e,t)=>(vv(r[t]).forEach((r=>{n.forEach((n=>{(function({position:e,rangeDefinition:t}){if(!Array.isArray(t))return!1;if(t.reduce(((e,t)=>e||isNaN(t)),!1))return!1;const[n,r]=t;return ie(n,(r||n)+1).includes(e)})({position:n,rangeDefinition:r})&&(e[n]={roundNumber:t})}))})),e)),{})}function vv(e){var t,n;return[Q((null==e||null===(t=e.finishingPositionRange)||void 0===t?void 0:t.loser)||[]),Q((null==e||null===(n=e.finishingPositionRange)||void 0===n?void 0:n.winner)||[])]}function gv({drawDefinition:e}){if(!e)return{error:Ie};return{positionsPlayedOff:(e.structures||[]).filter((e=>e.structureType!==ko)).map((({structureId:t})=>{const{roundProfile:n}=mv({drawDefinition:e,structureId:t});return Object.values(n).map(vv).flat()})).flat().filter((e=>1===e.length)).sort(Hr).flat()}}function Iv({drawDefinition:e,structureId:t,playoffPositions:n=[],excludeRoundNumbers:r=[]}){if(!e)return{error:Ie};if(!t)return{error:Ge};if(!n)return{error:Mt,message:"missing playoffPositions"};const{positionsPlayedOff:i,error:a}=gv({drawDefinition:e});if(a)return{error:a};const o=hv({drawDefinition:e,structureId:t,finishingPositions:n.filter((e=>!i.includes(e)))}),s=Object.values(o).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>parseInt(e))).filter((e=>!r.includes(parseInt(e)))),c=hv({drawDefinition:e,structureId:t,finishingPositions:i}),u=Object.values(c).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>parseInt(e))),d=s.filter((e=>!u.includes(e))).sort(Hr),{roundProfile:l}=mv({drawDefinition:e,structureId:t}),p=d.map((e=>{const t=l[e].finishingPositionRange.loser,[n,r]=t;return ie(n,(r||n)+1)})).flat().sort(Hr),f=d.map((e=>{const t=l[e].finishingPositionRange.loser,[n,r]=t;return{roundNumber:e,finishingPositions:ie(n,(r||n)+1),finishingPositionRange:t.join("-")}}));return{sourceRounds:[...d,...u],playoffRoundsRanges:f,playoffSourceRounds:d,playedOffSourceRounds:u,playoffPositionsReturned:p}}function yv({drawDefinition:e,structureId:t}){if(!e)return{error:Ie};let{structures:n}=Bc({drawDefinition:e,stage:Lo,stageSeqence:1});const r=n&&n[0];if(!r)return{error:Ve};const i=r.positionAssignments||[],a=null==i?void 0:i.map((e=>e.drawPosition)),{positionsPlayedOff:o}=gv({drawDefinition:e}),s=a.filter((e=>!o.includes(e)));({structures:n}=Bc({drawDefinition:e}));const c=n.filter((e=>!t||e.structureId===t)),u={};for(const d of c){const t=null==d?void 0:d.structureId,{playoffSourceRounds:n,playoffRoundsRanges:r,error:i}=bv({drawDefinition:e,playoffPositions:s,structureId:t});if(i)return{error:i};u[t]={structureId:t,playoffRounds:n,playoffRoundsRanges:r}}return t?{positionsPlayedOff:o,...u[t]}:{positionsPlayedOff:o,availablePlayoffRounds:Object.values(u)}}function bv({drawDefinition:e,playoffPositions:t,structureId:n}){var r;const{structure:i}=_c({drawDefinition:e,structureId:n});if(!i)return{error:Ve};if(i.structureType===Wo)return{playoffSourceRounds:[],playoffRoundsRanges:[]};const{links:a}=td({drawDefinition:e,structureId:n});return Iv({drawDefinition:e,structureId:n,playoffPositions:t,excludeRoundNumbers:(null==a||null===(r=a.source)||void 0===r?void 0:r.filter((e=>e.linkCondition!==Xo)).map((e=>{var t;return null===(t=e.source)||void 0===t?void 0:t.roundNumber})))||[]})}function wv(e){var t;const{playoffRoundsRanges:n,playoffRounds:r,error:i}=yv(e);if(i)return{error:i};const{playoffSourceRounds:a,playoffRoundsRanges:o,playoffPositionsReturned:s,error:c}=Iv(e);if(c)return{error:c};const{structureId:u,playoffStructureNameBase:d,playoffAttributes:l,playoffPositions:p,exitProfileLimit:f,drawDefinition:m,roundProfiles:h,roundNumbers:v,idPrefix:g,event:I,uuids:y}=e,b=(null==h?void 0:h.length)&&Object.assign({},...h),w=v||"object"==typeof h&&h.map((e=>Object.keys(e))).flat(),U=w&&w.map((e=>!isNaN(e)&&parseInt(e))).filter(Boolean);if(U){if(!Array.isArray(U))return{error:jn,validRoundNumbers:U};U.forEach((e=>{if(!r.includes(e))return{error:jn,roundNumber:e}}))}p&&p.forEach((e=>{if(!s.includes(e))return{error:jn,playoffPosition:e}}));const{structure:S}=_c({structureId:u,drawDefinition:m}),D=U||a,N=U?n:o,P=[],A=[];for(const R of D){const e=N.find((e=>e.roundNumber===R));if(!e)return{error:jn,message:{roundNumber:R}};const t=e.finishingPositions.length,n=Math.min(...e.finishingPositions)-1,r=2,i=b&&b[R]&&r+b[R]-1,{structure:a}=Hh({exitProfile:`0-${R}`,playoffStructureNameBase:d,finishingPositionOffset:n,playoffAttributes:l,exitProfileLimit:f,stage:_o,drawDefinition:m,roundOffset:0,sequenceLimit:i,stageSequence:r,drawSize:t,idPrefix:g,uuids:y});if(a){A.push(a.structureId);const e={linkType:Qo,source:{structureId:u,roundNumber:R},target:{structureId:a.structureId,feedProfile:Yo,roundNumber:1}};P.push(e)}}m.links=(m.links||[]).concat(...P);const{matchUps:M,matchUpsMap:T}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:m}),E=M.filter((({structureId:e})=>A.includes(e))).map(Oc),C=null==T||null===(t=T.drawMatchUps)||void 0===t?void 0:t.filter((({matchUpId:e})=>E.includes(e)));if(C.length){const e=m.tieFormat||(null==I?void 0:I.tieFormat);e&&C.forEach((t=>{const{tieMatchUps:n}=Vh({tieFormat:e});Object.assign(t,{tieMatchUps:n,matchUpType:la})}))}return M.filter((e=>Yr(e)&&e.structureId===u)).forEach((e=>{const{matchUpId:t,score:n,winningSide:r}=e,i=nd({inContextDrawMatchUps:M,drawDefinition:m,matchUpId:t,structure:S}),a=Ll({inContextDrawMatchUps:M,drawDefinition:m,matchUpsMap:T,winningSide:r,targetData:i,matchUpId:t,structure:S,matchUp:e,score:n});a.error&&console.log(a.error)})),e.goesTo&&wd({inContextDrawMatchUps:M,drawDefinition:m,matchUpsMap:T}),Nc({drawDefinition:m,structureIds:A}),{...de}}function Uv({playoffStructureNameBase:e,playoffAttributes:t,playoffPositions:n,exitProfileLimit:r,tournamentRecord:i,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l}){if(!i)return{error:me};const p=wv({playoffStructureNameBase:e,playoffAttributes:t,playoffPositions:n,exitProfileLimit:r,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l});return rc({tournamentRecord:i,timeItem:{itemType:"addPlayoffStructures",itemValue:{playoffStructureNameBase:e,playoffPositions:n,roundNumbers:s,structureId:c}}}),p}function Sv({validation:e=!0,drawDefinition:t,participantId:n,structureId:r,seedValue:i}){if(!t)return{error:Ie};if(!r)return{error:Ge};const{structure:a}=_c({drawDefinition:t,structureId:r});if(!a)return{error:Ve};if(!(!e||z(i)||"string"==typeof i&&i.split("-").every(z)))return{error:jn};const{seedAssignments:o}=Su({drawDefinition:t,structure:a}),s=o.map((e=>e.seedNumber)),c=o.find((e=>e.participantId===n));if(c)c.seedValue=i;else{const e=Math.max(0,...s)+1;a.seedAssignments.push({seedNumber:e,seedValue:i,participantId:n})}return Nc({drawDefinition:t,structureIds:[r]}),de}function Dv({tournamentRecord:e,drawDefinition:t,event:n,structureId:r,drawPosition:i,subOrder:a}){if(!t)return{error:Ie};if(!r)return{error:Ge};if(!i)return{error:Te};const{structure:o}=_c({drawDefinition:t,structureId:r});let s=o;o.structureType===Wo&&(s=o.structures.find((e=>e.positionAssignments.find((e=>e.drawPosition===i)))));const c=s.positionAssignments;let u=Vc({element:c.find((e=>e.drawPosition===i)),extension:{name:$i,value:a}});if(u.error)return u;const{matchUps:d}=Ou({structure:s,inContext:!0});return u=el({positionAssignments:c,tournamentRecord:e,drawDefinition:t,matchUpFormat:(null==o?void 0:o.matchUpFormat)||t.matchUpFormat,matchUps:d,event:n}),u.error?u:(Nc({drawDefinition:t,structureIds:[r]}),{...de})}function Nv({drawDefinition:e,event:t,matchUpId:n}){if(!e)return{error:Ie};if(!n)return{error:lt};const{matchUp:r}=xu({drawDefinition:e,event:t,matchUpId:n});return r?qc({element:r,name:Fi}):{error:ft}}function Pv({scaledEntries:e,seedsCount:t,scaleAttributes:n,scaleName:r,stageEntries:i}){if(!n)return{error:Mt};const a=Object.assign({},...(e||[]).slice(0,t).map((({participantId:e},t)=>({[e]:t+1}))));r=r||n.scaleName;const o=(new Date).toISOString();return{scaleItemsWithParticipantIds:i.map((({participantId:e})=>({participantId:e,scaleItems:[{scaleValue:a[e],eventType:n.eventType,scaleType:pm,scaleName:r,scaleDate:o}]})))}}function Av({drawDefinition:e,matchUpId:t,outcome:n,matchUp:r}){var i,a;if(!r&&!e)return{error:Ie};if(!r&&!t)return{error:ht};if(!n)return{error:Mt};if(!r){const{error:n,matchUp:i}=xu({drawDefinition:e,matchUpId:t});if(n)return{error:n};r=i}if("object"!=typeof n||null===(i=n.score)||void 0===i||!i.scoreStringSide1||null===(a=n.score)||void 0===a||!a.scoreStringSide2)return{error:jn};return Vc({element:r,extension:{name:Fi,value:n}})}function Mv({tournamentRecord:e,drawDefinition:t,scaleAttributes:n,drawId:r,event:i,stage:a}){if(!i)return{error:ze};let o=i.entries;if(r){var s;const{flightProfile:e}=tl({event:i}),n=null==e||null===(s=e.flights)||void 0===s?void 0:s.find((e=>e.drawId===r));o=n?n.drawEntries:null==t?void 0:t.entries}return function({tournamentRecord:e,participantIds:t,scaleAttributes:n}){var r;if(!e)return{error:me};if(!t)return{error:Qt};if(!n)return{error:Mt,message:"scaleAttributes required"};const{scaleType:i,eventType:a,scaleName:o}=n,s=[wi,i,a,o].join(".");return null===(r=e.participants)||void 0===r||r.forEach((e=>{t.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter((e=>e&&(null==e?void 0:e.itemType)!==s)))})),de}({tournamentRecord:e,participantIds:(o||[]).filter((e=>(!a||!e.entryStage||e.entryStage===a)&&du.includes(e.entryStatus))).map(Cc),scaleAttributes:n})}function Tv({drawDefinition:e,structureId:t}){var n;if(!e)return{error:Ie};if(!t)return{error:Ge};const r=[],i=[t],a=t=>{var n;return null===(n=e.links)||void 0===n?void 0:n.map((e=>e.source.structureId===t&&e.target.structureId)).filter(Boolean)},o=(null===(n=e.structures)||void 0===n?void 0:n.map((({structureId:e})=>e)))||[],s=Object.assign({},...o.map((e=>({[e]:a(e)}))));for(;i.length;){var c;const t=i.pop(),{structure:n}=_c({drawDefinition:e,structureId:t}),{matchUps:a}=Ou({structure:n}),o=Tc(a);r.push(...o),e.links=(null===(c=e.links)||void 0===c?void 0:c.filter((e=>e.source.structureId!==t&&e.target.structureId!==t)))||[],e.structures=(e.structures||[]).filter((e=>e.structureId!==t));const u=s[t];null!=u&&u.length&&i.push(...u)}const{matchUps:u}=sd({drawDefinition:e});return u.forEach((e=>{r.includes(e.winnerMatchUpId)&&delete e.winnerMatchUpId,r.includes(e.loserMatchUpId)&&delete e.loserMatchUpId})),Uc({drawDefinition:e,matchUpIds:r,action:"removeStructure"}),Nc({drawDefinition:e}),{...de,removedMatchUpIds:r}}function Ev({drawDefinition:e,participants:t,matchUpType:n,event:r,structureName:i=jo,structureAbbreviation:a,structureId:o,automated:s}){const c=jo;if(!e)return{error:Ie};n=n||e.matchUpType;const u=vu({stage:c,drawDefinition:e}),{matchUps:d}=Ch({matchUpType:n,drawSize:u}),l=Fh({stage:c,matchUps:d,matchUpType:n,structureName:i,structureAbbreviation:a,structureId:o});return e.structures.push(l),s&&wh({structureId:o||l.structureId,drawDefinition:e,participants:t,event:r}),Nc({drawDefinition:e,structureIds:[o]}),{...de}}function Cv({drawDefinition:e,structureId:t,matchUps:n}){var r;if("object"!=typeof e)return{error:Ie};if("string"!=typeof t)return{error:Ge};if(!Array.isArray(n))return{error:jn};const i=null===(r=e.structures)||void 0===r?void 0:r.find((e=>e.structureId===t));if(!i)return{error:Ve};const a=(null==i?void 0:i.matchUps).find((e=>!!e.roundPosition));if(i.structures||a||i.finishingPosition===Ns)return{error:we};const o=(i.matchUps||[]).map((({drawPositions:e})=>e)).flat().sort(((e,t)=>e-t)),s=Math.max(...o,0)+1,c=ie(s,s+2*n.length),u=ce(c,2);n.forEach(((e,t)=>e.drawPositions=u[t])),i.matchUps.push(...n);const d=c.map((e=>({drawPosition:e})));return i.positionAssignments||(i.positionAssignments=[]),i.positionAssignments.push(...d),wc({drawDefinition:e,matchUps:n}),Nc({drawDefinition:e,structureIds:[t]}),{...de}}function Rv({drawDefinition:e,structureId:t,addMatchUps:n=!1,matchUpsCount:r=1,matchUpIds:i=[],roundNumber:a,newRound:o}){var s;if("object"!=typeof e)return{error:Ie};if("string"!=typeof t)return{error:Ge};if(!$(r)||!Array.isArray(i))return{error:jn};const c=null==e||null===(s=e.structures)||void 0===s?void 0:s.find((e=>e.structureId===t));let u;const d=(null==c?void 0:c.matchUps).reduce(((e,t)=>(t.roundPosition&&(u=!0),t.roundNumber>e?t.roundNumber:e)),0);if(c.structures||u||c.finishingPosition===Ns)return{error:we};if(a&&a-1>d)return{error:jn};const l=a||(o?d+1:d||1),p=ie(0,r).map((()=>({matchUpId:i.pop()||Wr(),roundNumber:l,matchUpStatus:R,drawPositions:[]})));if(n){const n=Cv({drawDefinition:e,structureId:t,matchUps:p});if(n.error)return n}return{matchUps:p,...de}}function Ov({deleteExisting:e,event:t,flightProfile:n}){var r;if(!n)return{error:Mt};if(!t)return{error:ze};const{flightProfile:i}=tl({event:t});if(i&&Ov&&!e)return{error:zn};if(null!==(r=t.drawDefinitions)&&void 0!==r&&r.length)return{error:ye};return zc({event:t,extension:{name:Bi,value:n}}),{flightProfile:Gr(n,!1,!0),...de}}const xv="splitWaterfall",Lv="splitShuttle",kv={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:xv,SPLIT_SHUTTLE:Lv};function Fv({event:e,drawId:t,drawDefinition:n,drawName:r}){var i;if(!r||"string"!=typeof r)return{error:jn,drawName:r};const{flightProfile:a}=tl({event:e}),o=null==a||null===(i=a.flights)||void 0===i?void 0:i.find((e=>e.drawId===t));if(o){o.drawName=r;zc({event:e,extension:{name:Bi,value:{...a,flights:a.flights}}})}return n&&(n.drawName=r),o||n?de:{error:Ie}}function jv({drawDefinition:e,drawSize:t}){if(!e)return{error:Ie};const n=Jh({drawDefinition:e,stage:jo,drawSize:t});return n.error?n:(Fv({drawDefinition:e}),de)}function _v({drawDefinition:e,structureId:t,matchUpIds:n=[]}){var r;if("object"!=typeof e)return{error:Ie};if("string"!=typeof t)return{error:Ge};if(!Array.isArray(n))return{error:jn};const i=null===(r=e.structures)||void 0===r?void 0:r.find((e=>e.structureId===t));if(!i)return{error:Ve};const a=null==i?void 0:i.matchUps,o=a.find((e=>!!e.roundPosition));if(i.structures||o||i.finishingPosition===Ns)return{error:we};const s=a.filter((({matchUpId:e})=>n.includes(e))),c=Tc(s),u=s.map((({drawPositions:e})=>e)).flat();if(u.length){i.positionAssignments=i.positionAssignments.filter((({drawPosition:e})=>!u.includes(e))).sort(((e,t)=>e.drawPosition-t.drawPosition)),i.matchUps=i.matchUps.filter((({matchUpId:e})=>!c.includes(e)));const n=Object.assign({},...i.positionAssignments.map((({drawPosition:e},t)=>({[e]:t+1}))));i.positionAssignments=i.positionAssignments.map((e=>({...e,drawPosition:n[e.drawPosition]})));const r=e=>e.drawPositions=e.drawPositions.map((e=>n[e]));i.matchUps.forEach(r),Uc({drawDefinition:e,matchUpIds:c,action:"deleteAdHocMatchUps"}),Nc({drawDefinition:e,structureIds:[t]})}return{...de}}function Bv({rankedPairings:e,rankedMatchUpValues:t,stipulated:n=[],deltaObjects:r}){let i=0,a=[],o=[].concat(...n);n.filter(Boolean).forEach((e=>{const n=Gv(...e),r=t[n];a.push({participantIds:e,value:r}),i+=t[n]})),e.forEach((e=>{const t=e.pairing.split("|");if(!t.reduce(((e,t)=>o.indexOf(t)>=0||e),!1)){o=o.concat(...t);let n=e.value;i+=n,a.push({participantIds:t,value:n})}})),a.sort(((e,t)=>e.value-t.value));const s=a.reduce(((e,t)=>{const n=Gv(...t.participantIds),i=r[n];return i>e?i:e}),0);return{value:i,participantIdPairings:a,maxDelta:s}}function Gv(e,t){return[e,t].sort().join("|")}function Vv({tournamentParticipants:e,drawDefinition:t,participantIds:n,adHocRatings:r,structureId:i,matchUpIds:a,eventType:o,structure:s}){const{positionAssignments:c}=Pu({structure:s}),{encounters:u}=function({matchUps:e,positionAssignments:t}){let n=[];for(const r of e){const e=t.filter((({drawPosition:e})=>r.drawPositions.includes(e))).map(Cc).filter(Boolean);if(2===e.length){const t=Hv(...e);n.includes(t)||n.push(t)}}return{encounters:n}}({matchUps:s.matchUps,positionAssignments:c}),d={};for(const y of u)d[y]||(d[y]=0),d[y]+=50;const l=null==e?void 0:e.filter((({participantType:e})=>e===xa));if(l)for(const y of l){const e=y.individualParticipantIds,{uniquePairings:t}=qv({participantIds:e});for(const n of t)d[n]||(d[n]=0),d[n]+=60}const{uniquePairings:p,possiblePairings:f,deltaObjects:m}=qv({participantIds:n}),h=Rv({newRound:!0,drawDefinition:t,matchUpsCount:Math.floor(n.length/2),structureId:i,matchUpIds:a,addMatchUps:!0});if(h.error)return h;const v=h.matchUps,g={drawDefinition:t,participantIds:n,possiblePairings:f,uniquePairings:p,adHocRatings:r,deltaObjects:m,valueObjects:d,structure:s},{participantIdPairings:I}=o===Aa?function({roundMatchUps:e}){return{matchUps:e}}(g):function({deltaObjects:e,valueObjects:t,adHocRatings:n={},uniquePairings:r,possiblePairings:i}){r.forEach((r=>{const i=r.split("|").map((e=>n[e]||0)),a=Math.abs(i[0]-i[1])+1;e[r]=Math.abs(i[0]-i[1]),t[r]||(t[r]=0),t[r]+=Math.pow(a,2)}));const a=r.map((e=>({pairing:e,value:t[e]}))).sort(((e,t)=>e.value-t.value)),{pairingValues:o}=function({possiblePairings:e,valueObjects:t}){let n={};for(const i of Object.keys(e)){let t=e[i].map((e=>r(i,e)));n[i]=t.sort(((e,t)=>e.value-t.value))}function r(e,n){let r=Hv(e,n);return{opponent:n,value:t[r]}}return{pairingValues:n}}({possiblePairings:i,valueObjects:t}),{participantIdPairings:s}=function({rankedPairings:e,pairingValues:t,deltaObjects:n,candidateGoal:r=2e3,actorDivisor:i=100}){const a=Object.assign({},...e.map((e=>({[e.matchUp]:e.value}))));let o=Bv({rankedPairings:e,rankedMatchUpValues:a,deltaObjects:n}),s=o;const c=Object.keys(t),u=r/(c.length/i);let d=Math.floor(u/c.length);return d>r&&(d=r),c.forEach((r=>{t[r].slice(0,d).forEach((t=>{const r=Bv({rankedPairings:e,rankedMatchUpValues:a,stipulated:[t.participantIds],deltaObjects:n});r.maxDelta<s.maxDelta&&(s=r),r.value<o.value&&(o=r)}))})),o}({rankedPairings:a,pairingValues:o,deltaObjects:e,candidateGoal:2e3,actorDivisor:100});return{participantIdPairings:s}}(g);for(const[y,b]of v.entries()){const e=b.drawPositions,{participantIds:n}=I[y];for(const r of e.keys()){const a=Ol({drawDefinition:t,structureId:i,participantId:n[r],drawPosition:e[r]});if(a.error)return a}}return{...de}}function qv({participantIds:e}){const t={},n=[];e.forEach((r=>{t[r]=e.filter((e=>e!==r)),t[r].forEach((e=>{const t=Hv(e,r);n.includes(t)||n.push(t)}))}));const r=Object.assign({},...n.map((e=>({[e]:0}))));return{uniquePairings:n,possiblePairings:t,deltaObjects:r}}function Hv(e,t){return[e,t].sort().join("|")}function Wv({tournamentParticipants:e,restrictEntryStatus:t,drawDefinition:n,participantIds:r,structureId:i,matchUpIds:a,scaleName:o,eventType:s}){var c;if("object"!=typeof n)return{error:ge};const u=n.entries.filter((({entryStatus:e})=>!t||[tu,iu,eu].includes(e))).map(Cc);if(r){const e=!!r.find((e=>u.includes(e)));if(e)return{error:Vt,participantId:e}}else r=u;const d=e=>!(null!=e&&e.structures||null!=e&&e.matchUps.find((({roundPosition:e})=>!!e)));if(!i){var l;const e=null===(l=n.structures)||void 0===l?void 0:l.find((e=>1===e.stageSequence)).recuce(((e,t)=>{const n=Go[t.stage];return d(t)&&n>Go[e.stage]?t:e}),void 0);i=null==e?void 0:e.structureId}const p=null===(c=n.structures)||void 0===c?void 0:c.find((e=>e.structureId===i));if(!p)return{error:Ve};if(!d(p))return{error:ge};const f={};for(const h of r){const t=null==e?void 0:e.find((e=>e.participantId===h));let n=zv({eventType:s,participant:t});!n&&o&&(n=zv({scaleValue:n,eventType:s,participant:t})),n&&(f[h]=n)}const{matchUps:m}=Vv({tournamentParticipants:e,drawDefinition:n,participantIds:r,adHocRatings:f,matchUpIds:a,structureId:i,structure:p,eventType:s});return{...de,matchUps:m}}function zv({scaleName:e="dynamic",eventType:t,participant:n}){var r;const i=n&&mm({participant:n,scaleAttributes:{scaleType:dm,eventType:t||Pa,scaleName:e}});return null==i||null===(r=i.scaleItem)||void 0===r?void 0:r.scaleValue}function Kv({qualifyingPositions:e,drawEntries:t=[],matchUpValue:n,drawName:r,drawId:i,event:a,stage:o}){var s,c;if(!a)return{error:ze};if(!r)return{error:Mt};if(null!=t&&t.length){const e=Ec(a.entries||[]),n=Ec(t);if(oe(n,e).length!==n.length)return{error:jn}}const{flightProfile:u}=tl({event:a}),d=(null==u||null===(s=u.flights)||void 0===s||null===(c=s.map((({flightNumber:e})=>!isNaN(e)&&parseInt(e))))||void 0===c?void 0:c.filter(Boolean))||[],l=Math.max(0,...d)+1,p={drawId:i||Wr(),flightNumber:l,matchUpValue:n,drawEntries:t,drawName:r};o&&(p.stage=o),e&&(p.qualifyingPositions=e);if(((null==u?void 0:u.flights)||[]).find((({drawId:e})=>e===p.drawId)))return{error:Wn};const f=((null==u?void 0:u.flights)||[]).concat(p);return zc({event:a,extension:{name:Bi,value:{...u||{},flights:f}}})}function Yv({tournamentRecord:e,event:t,startDate:n}){if(!e)return{error:me};if(!t)return{error:ze};if(!vr.test(n))return{error:xt};const{tournamentStartDate:r,tournamentEndDate:i,error:a}=Jv(e);if(a)return{error:a};const o=new Date(Cr(n));if(o<r||o>i)return{error:xt};const s=t.endDate&&new Date(Cr(t.endDate));return s&&o>s&&(t.endDate=n),t.startDate=n,de}function $v({tournamentRecord:e,event:t,endDate:n}){if(!e)return{error:me};if(!t)return{error:ze};if(!vr.test(n))return{error:xt};const{tournamentStartDate:r,tournamentEndDate:i,error:a}=Jv(e);if(a)return{error:a};const o=new Date(Cr(n));if(o<r||o>i)return{error:xt};const s=t.startDate&&new Date(Cr(t.startDate));return s&&o<s&&(t.startDate=n),t.endDate=n,de}function Jv(e){const{startDate:t,endDate:n}=e;return vr.test(t)&&vr.test(n)?{tournamentStartDate:new Date(Cr(t)),tournamentEndDate:new Date(Cr(n))}:{error:kt}}const Zv={addEvent:Fm,deleteEvents:function({tournamentRecord:e,eventIds:t}){if(!e)return{error:me};if(!e.events)return{error:Ke};if(!Array.isArray(t))return{error:Mt};const n=[],r=[];if(e.events=(e.events||[]).filter((e=>{if(t.includes(e.eventId)){const t={action:jm,payload:{events:[e]}};n.push(t),r.push({eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}return!t.includes(e.eventId)})),Kl({tournamentRecord:e}),n.length){nr({topic:uc,payload:n});rc({tournamentRecord:e,timeItem:{itemType:jm,itemValue:r}})}return de},setEventDates:function({tournamentRecord:e,event:t,startDate:n,endDate:r}){if(!e)return{error:me};if(!t)return{error:ze};if(!n&&!r)return{error:Mt};if(n&&!vr.test(n))return{error:xt};if(r&&!vr.test(r))return{error:xt};if(n&&r){if(new Date(Cr(n))>new Date(Cr(r)))return{error:jn}}if(n){const{error:r}=Yv({tournamentRecord:e,event:t,startDate:n});if(r)return{error:r}}if(r){const{error:n}=$v({tournamentRecord:e,event:t,endDate:r});if(n)return{error:n}}return de},setEventStartDate:Yv,setEventEndDate:$v,autoSeeding:function({tournamentRecord:e,drawDefinition:t,policyDefinitions:n,scaleAttributes:r,scaleName:i,drawSize:a,drawId:o,event:s,stage:c,sortDescending:u,scaleSortMethod:d}){const{error:l,entries:p,seedsCount:f,stageEntries:m}=Lm({drawDefinition:t,drawId:o,event:s,policyDefinitions:n,drawSize:a,stage:c});if(l)return{error:l};const{scaledEntries:h}=Xh({scaleAttributes:r,tournamentRecord:e,scaleSortMethod:d,sortDescending:u,entries:p,stage:c}),{scaleItemsWithParticipantIds:v}=Pv({scaledEntries:h,seedsCount:f,scaleAttributes:r,scaleName:i,stageEntries:m});return{scaleItemsWithParticipantIds:v}},removeSeeding:function({tournamentRecord:e,drawDefinition:t,scaleName:n,drawId:r,event:i,stage:a}){var o,s;return e?i?(n=n||(null===(o=i.category)||void 0===o?void 0:o.categoryName)||(null===(s=i.category)||void 0===s?void 0:s.ageCategoryCode),Mv({tournamentRecord:e,scaleAttributes:{eventType:i.eventType,scaleType:pm,scaleName:n},drawDefinition:t,drawId:r,event:i,stage:a})):{error:ze}:{error:me}},removeScaleValues:Mv,addDrawEntries:Wm,checkValidEntries:Qm,modifyDrawName:Fv,addDrawDefinition:ap,addPlayoffStructures:Uv,deleteDrawDefinitions:Th,getAvailablePlayoffRounds:function({drawDefinition:e,structureId:t}){return yv({drawDefinition:e,structureId:t})},removeStructure:Tv,generateSeedingScaleItems:Pv,setSubOrder:Dv,addEventEntries:$m,promoteAlternate:function({tournamentRecord:e,drawDefinition:t,event:n,participantId:r,stage:i=Lo,stageSequence:a}){if(!e)return{error:me};if(!n)return{error:ze};if(n){const e=Zm({element:n,participantId:r,stageSequence:a,stage:i});if(e.error)return e}if(t){const e=Zm({element:t,participantId:r,stageSequence:a,stage:i});if(e.error)return e}return de},destroyPairEntry:Jm,setEntryPosition:ov,setEntryPositions:function({tournamentRecord:e,entryPositions:t,drawDefinition:n,event:r}){if(!e)return{error:me};if(!Array.isArray(t))return{error:jn};for(const i of t){const{participantId:t,entryPosition:a}=i,o=ov({tournamentRecord:e,drawDefinition:n,participantId:t,entryPosition:a,event:r});if(o.error)return o}return{...de}},addEventEntryPairs:function({event:e,uuids:t,drawDefinition:n,tournamentRecord:r,entryStage:i=Lo,entryStatus:a=Zc,participantIdPairs:o=[],allowDuplicateParticipantIdPairs:s}){if(!r)return{error:me};if(!e)return{error:ze};if(e.eventType!==da)return{error:We};const c=r.participants||[],u=c.filter((e=>e.participantType===Oa)).map((e=>e.participantId)),d=u.filter((e=>!u.includes(e)));if(d.length)return{error:qt,invalidParticipantIds:d};const l=o.filter((e=>2!==e.length));if(l.length)return{error:qt,invalidParticipantIdPairs:l};const p=c.filter((e=>e.participantType===La)).map((e=>e.individualParticipantIds)),f=o.map((e=>({participantId:(null==t?void 0:t.pop())||Wr(),participantType:La,participantRole:bf,individualParticipantIds:e}))),m=s?f:f.filter((e=>!p.find((t=>2===oe(t,e.individualParticipantIds).length))));let h,v=[];if(m){const e=cp({tournamentRecord:r,participants:m,allowDuplicateParticipantIdPairs:s});if(e.error)return e;v=e.participants||[],h=e.message}const g=o.map((e=>{const t=v.find((t=>2===oe(t.individualParticipantIds,e).length));if(t)return t;const{participant:n}=Pc({tournamentRecord:r,participantIds:e});return n})).map((e=>e.participantId)),I=$m({event:e,entryStage:i,entryStatus:a,drawDefinition:n,tournamentRecord:r,participantIds:g});return m.length&&nr({topic:sc,participants:m}),{...I,message:h,newParticipantIds:m.map(Cc)}},removeEventEntries:Ym,removeDrawEntries:function({participantIds:e,drawDefinition:t,drawId:n,event:r,autoEntryPositions:i=!0}){var a;if(!r)return{error:ze};if(!n)return{error:Re};if(!e||!e.length)return{error:Qt};const o=sv({drawDefinition:t});if(se(e,o))return{error:an};const s=t=>{const n=t.participantId;return!e.includes(n)},{flightProfile:c}=tl({event:r}),u=null==c||null===(a=c.flights)||void 0===a?void 0:a.find((e=>e.drawId===n));return null!=u&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),i&&(u.drawEntries=Gm({entries:u.drawEntries}))),null!=t&&t.entries&&(t.entries=t.entries.filter(s),i&&(t.entries=Gm({entries:t.entries}))),de},modifyEventEntries:function({event:e,tournamentRecord:t,entryStage:n=Lo,participantIdPairs:r=[],unpairedParticipantIds:i=[],entryStatus:a=tu}){if(!t)return{error:me};if(!e)return{error:ze};const o=t.participants||[],s=o.filter((e=>e.participantType===Oa)).map((e=>e.participantId)),c=i.concat(...r).flat(1/0).filter((e=>!s.includes(e)));if(c.length)return{error:qt,invalidParticipantIds:c};const u=r.filter((e=>2!==e.length));if(u.length)return{error:qt,invalidParticipantIdPairs:u};const d=o.filter((e=>e.participantType===La)).map((e=>e.individualParticipantIds)),l=r.filter((e=>!d.find((t=>2===oe(t,e).length)))).map((e=>({participantType:La,participantRole:bf,individualParticipantIds:e}))),p=cp({tournamentRecord:t,participants:l});if(p.error)return p;const f=r.map((e=>{const{participant:n}=Pc({tournamentRecord:t,participantIds:e});return n})).map((e=>({participantId:e,entryStatus:a,entryStage:n}))),m=i.map((e=>({entryStatus:su,participantId:e,entryStage:n})));return e.entries=(e.entries||[]).filter((e=>e.entryStage===n)),e.entries=e.entries.concat(...f,...m),de},modifyEntriesStatus:cv,modifySeedAssignment:function({tournamentRecord:e,drawDefinition:t,participantId:n,structureId:r,seedValue:i}){return e?(e.participants||[]).find((e=>e.participantId===n))?Sv({drawDefinition:t,participantId:n,structureId:r,seedValue:i}):{error:Vt}:{error:me}},deleteFlightProfileAndFlightDraws:function({tournamentRecord:e,event:t}){if(!e)return{error:me};if(!t)return{error:ze};const{flightProfile:n}=tl({event:t});if(n){var r;const i=null===(r=n.flights)||void 0===r?void 0:r.map((({drawId:e})=>e)).filter(Boolean),a=Th({tournamentRecord:e,eventId:t.eventId,drawIds:i});return a.error?a:Yc({event:t,name:Bi})}return de},deleteFlightAndFlightDraw:function({tournamentRecord:e,event:t,drawId:n,auditData:r}){if(!e)return{error:me};if(!n)return{error:Re};if(!t)return{error:ze};const{flightProfile:i}=tl({event:t});var a;if(i&&(null===(a=i.flights)||void 0===a?void 0:a.find((e=>e.drawId===n)))){const e=i.flights.filter((e=>e.drawId!==n));zc({event:t,extension:{name:Bi,value:{...i,flights:e}}})}return Th({tournamentRecord:e,eventId:t.eventId,drawIds:[n],auditData:r}),de},generateFlightProfile:function({drawNameRoot:e="Flight",attachFlightProfile:t,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:i,deleteExisting:a,sortDescending:o,drawNames:s=[],flightsCount:c,flightValues:u,splitMethod:d,uuids:l=[],event:p,stage:f}){if(!p)return{error:ze};const m=p.entries||[],{flightProfile:h}=tl({event:p});if(h&&t&&!a)return{error:zn};const{scaledEntries:v}=Xh({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:i,sortDescending:o,event:p,stage:f}),g=v.map(Cc),I=m.filter((({participantId:e})=>!g.includes(e))).filter((e=>(!f||!e.entryStage||e.entryStage===f)&&du.includes(e.entryStatus))),y=v.concat(...I),b=y.length;let w=ce(y,Math.ceil(b/c));d===xv?w=ue(y,c):d===Lv&&(w=ue(y,c,!0));const U={scaleAttributes:r,splitMethod:d,flights:ie(0,c).map((t=>{var n;const r=t+1,i={flightNumber:r,drawId:(null==l?void 0:l.pop())||Wr(),drawEntries:(a=w[t],(a||[]).map((({participantId:e})=>m.find((t=>t.participantId===e))))),drawName:(null==s?void 0:s.length)&&s[t]||`${e} ${r}`};var a;const o=null==u||null===(n=u.find((e=>e.flightNumber===r)))||void 0===n?void 0:n.matchUpValue;return o&&(i.matchUpValue=o),i}))};if(t){const e=Ov({flightProfile:U,deleteExisting:a,event:p});return{splitEntries:Xn()&&w||void 0,...e}}return{flightProfile:U,...de}},attachFlightProfile:Ov,updateDrawIdsOrder:function({event:e,orderedDrawIdsMap:t}){var n,r;if("object"!=typeof e)return{error:ze};if(!t)return{error:Mt,message:"Missing drawIdsOrderMap"};if("object"!=typeof t)return{error:jn,message:"orderedDrawIdsMap must be an object"};const i=Object.values(t);if(!i.every((e=>!isNaN(e))))return{error:jn,message:"drawOrder must be numeric"};if(Q(i).length!==i.length)return{error:jn,message:"drawOrder values must be unique"};if(null!==(n=e.drawDefinitions)&&void 0!==n&&n.length){const n=(e.drawDefinitions||[]).map((({drawId:e})=>e));if(oe(n,Object.keys(t)).length!==n.length)return{error:jn,message:"Missing drawIds"};e.drawDefinitions.forEach((e=>{e.drawOrder=t[e.drawId]}))}const{flightProfile:a}=tl({event:e});return null==a||null===(r=a.flights)||void 0===r||r.forEach((e=>{e.flightNumber=t[e.drawId]})),de},getFlightProfile:tl,getScaledEntries:Xh,addFlight:Kv,addAdHocMatchUps:function(e){return Cv(e)},generateAdHocMatchUps:function(e){return Rv(e)},deleteAdHocMatchUps:function(e){return _v(e)},drawMatic:function(e){var t;const n=null===(t=e.tournamentRecord)||void 0===t?void 0:t.participants;return Object.assign(e,{tournamentParticipants:n}),Wv(e)},setDelegatedOutcome:function(e){return Av(e)},removeDelegatedOutcome:function(e){return Nv(e)},addVoluntaryConsolationStage:function({drawDefinition:e,drawSize:t}){return jv({drawDefinition:e,drawSize:t})},generateVoluntaryConsolationStructure:function(e){const{tournamentRecord:t}=e;return t?Ev({participants:t.participants,...e}):{error:me}},setMatchUpStatus:Hl,bulkMatchUpStatusUpdate:Wl,setDrawDefaultMatchUpFormat:function({tournamentRecord:e,drawDefinition:t,matchUpFormat:n}){return e?t?n?Vl({drawDefinition:t,matchUpFormat:n}):{error:ct}:{error:Ie}:{error:me}},setEventDefaultMatchUpFormat:function({tournamentRecord:e,event:t,matchUpFormat:n}){return e?n?t?g(n)?(t.matchUpFormat=n,de):{error:rt}:{error:ze}:{error:ct}:{error:me}},setStructureDefaultMatchUpFormat:function({tournamentRecord:e,drawDefinition:t,matchUpFormat:n,structureId:r,event:i}){return e?t?n?r?Vl({drawDefinition:t,matchUpFormat:n,structureId:r,event:i}):{error:Ge}:{error:ct}:{error:Ie}:{error:me}},setCollectionDefaultMatchUpFormat:function({tournamentRecord:e,drawDefinition:t,matchUpFormat:n}){return e?t?n?g(n)?{error:Hn}:{error:rt}:{error:ct}:{error:Ie}:{error:me}},assignDrawPosition:function({drawDefinition:e,drawPosition:t,structureId:n,participantId:r,qualifier:i,bye:a}){if(!e)return{error:Ie};if(!t)return{error:Te};if(!n)return{error:Ge};if(a){const r=ul({drawDefinition:e,drawPosition:t,structureId:n});if(r.error)return r}else{if(i)return{error:Hn};{const i=Ol({drawDefinition:e,structureId:n,drawPosition:t,participantId:r});if(i.error)return i}}return{...de}},assignSeedPositions:function(e){const{useExistingSeedLimit:t,tournamentRecord:n,drawDefinition:r,structureId:i,assignments:a,drawId:o}=e;let s=0;if(null==a||!a.length)return{error:Ze};if(!n)return{error:me};if(!o)return{error:Re};const{seedAssignments:c,seedLimit:u,error:d}=Su({drawDefinition:r,structureId:i});if(d)return{error:d};const l=Object.assign({},...c.filter((e=>e.seedNumber)).map((e=>({[e.seedNumber]:e}))));a.forEach((e=>{const{seedNumber:n}=e;n<=u&&(!t||l[n])&&(l[n]=e)}));const p=Object.values(l),f=p.map((e=>null==e?void 0:e.participantId)).filter(Boolean);if(f.length!==(m=f,m.filter(te)).length)return{error:"participantId cannot be assigned to multiple seedNumbers"};var m;for(const h of p){const e=Xm({...h,drawDefinition:r,structureId:i});if(null!=e&&e.error)return e;null!=e&&e.success&&s++}return s?{...de,modifications:s}:{error:Ln}},assignDrawPositionBye:function({drawDefinition:e,structureId:t,drawPosition:n}){return ul({drawDefinition:e,structureId:t,drawPosition:n})},swapDrawPositionAssignments:function(e){return dv(e)},removeDrawPositionAssignment:uv,alternateDrawPositionAssignment:function(e){return fv(e)},withdrawParticipantAtDrawPosition:function(e){return Object.assign(e,{entryStatus:au}),uv(e)},setDrawParticipantRepresentativeIds:function({representativeParticipantIds:e,drawDefinition:t}){if(!t)return{error:be};if(!Array.isArray(e))return{error:jn};const n=Ec((null==t?void 0:t.entries)||[]);return e.length&&oe(e,n).length<e.length?{error:jn}:Wc({drawDefinition:t,extension:{name:Hi,value:e}})},getDrawParticipantRepresentativeIds:function({drawDefinition:e}){const{extension:t,error:n}=sa({drawDefinition:e,name:"participantRepresentatives"});return n?{error:n}:{representativeParticipantIds:(null==t?void 0:t.value)||[]}},luckyLoserDrawPositionAssignment:function(e){return function({luckyLoserParticipantId:e,drawDefinition:t,drawPosition:n,structureId:r}){return pv({participantId:e,drawDefinition:t,drawPosition:n,structureId:r,positionActionName:"luckyLoserDrawPositionAssignment"})}(e)},automatedPositioning:function({tournamentRecord:e,drawDefinition:t,structureId:n,seedsOnly:r,event:i}){var a;if(!i)return{error:Ke};if(!t)return{error:be};const o=wh({drawDefinition:t,participants:null==e?void 0:e.participants,structureId:n,seedsOnly:r});return o.error?o:null!=o&&null!==(a=o.errors)&&void 0!==a&&a.length?{error:o.errors}:de},automatedPlayoffPositioning:Uh,checkInParticipant:function({tournamentRecord:e,participantId:t,matchUpId:n,matchUp:r,drawId:i}){r&&!i&&({drawId:i}=r),r&&!n&&({matchUpId:n}=r);const{event:a,drawDefinition:o}=ya({tournamentRecord:e,drawId:i});if(!a)return{error:Ke};{const r=mf({tournamentParticipants:e.participants,drawDefinition:o,participantId:t,matchUpId:n});if(r.error&&r.error!==tn)return r}return de},checkOutParticipant:function({tournamentRecord:e,drawId:t,matchUpId:n,participantId:r,matchUp:i}){i&&!t&&({drawId:t}=i),i&&!n&&({matchUpId:n}=i);const{event:a,drawDefinition:o}=ya({tournamentRecord:e,drawId:t});if(!a)return{error:Ke};{const t=hf({drawDefinition:o,tournamentParticipants:e.participants,matchUpId:n,participantId:r});if(t.error)return t}return de},toggleParticipantCheckInState:vf,generateDrawDefinition:av,addDrawDefinitionTimeItem:function({drawDefinition:e,timeItem:t}){if(!e)return{error:be};if(!t)return{error:Mn};const n=t&&Object.keys(t),r=["itemType","itemValue"];if(!(r.filter((e=>n.includes(e))).length===r.length))return{error:An};e.timeItems||(e.timeItems=[]);const i=(new Date).toISOString();return Object.assign(t,{createdAt:i}),e.timeItems.push(t),Dc({drawDefinition:e}),de},assignTieMatchUpParticipantId:function(e){var t;const n=Ph(e);if(n.error)return n;let r=e.teamParticipantId;const{tournamentRecord:i,drawDefinition:a,participantId:o}=e;if(!o)return{error:Yt};const{relevantAssignments:s,collectionPosition:c,teamParticipants:u,collectionId:d,matchUpType:l,dualMatchUp:p,tieMatchUp:f,tieFormat:m}=n,{tournamentParticipants:[h]}=Dp({tournamentRecord:i,participantFilters:{participantIds:[o]}});if(!h)return{error:$t};const{individualParticipantIds:v,participantType:g}=h;if(l===ua&&g!==Oa)return{error:Ht};const I=g===Oa?[o]:v,y=r?u.find((({participantId:e})=>e===r)):u.find((({individualParticipantIds:e})=>se(I,e)));if(!y)return{error:_n};r||(r=y.participantId);const b=s.find((e=>e.participantId===(null==y?void 0:y.participantId))),w=null==b?void 0:b.drawPosition,U=f.sides.find((({drawPosition:e})=>e===w)),S=null==U?void 0:U.sideNumber;if(!m)return{error:dt};if(!(null===(t=m.collectionDefinitions)||void 0===t?void 0:t.find((e=>e.collectionId===d))))return{error:ut};if(!p.sides){const e=({displaySideNumber:e,drawPosition:t,sideNumber:n})=>({drawPosition:t,sideNumber:n,displaySideNumber:e});p.sides=[{...e(f.sides[0]),lineUp:[]},{...e(f.sides[1]),lineUp:[]}]}const D=p.sides.find((e=>e.sideNumber===S)),N=f.sides.find((e=>e.sideNumber===S));let P;if(l===da&&g!==La){const e=function({side:e}){let t;if(e.participant){const n=e.participant.individualParticipantIds||[];if(1===n.filter(Boolean).length){const{participant:e}=Pc({participantIds:n,tournamentRecord:i});n.push(o);const{participant:r}=Pc({participantIds:n,tournamentRecord:i});if(r)t=e.participantId;else{e.individualParticipantIds=n;const t=Um({individualParticipantIds:n,pairOverride:!0,tournamentRecord:i,participant:e});if(t.error)return t}}else console.log("###")}else{const e=sp({participant:{participantType:La,participantRole:bf,individualParticipantIds:[o]},pairOverride:!0,tournamentRecord:i});if(e.error)return e}return{...de,deleteParticipantId:t}}({side:N});if(e.error)return e;P=e.deleteParticipantId}else if(l===da&&g===La){const e=h.individualParticipantIds||[],{modifiedLineUp:t}=Sh({collectionPosition:c,teamParticipantId:r,dualMatchUpSide:D,drawDefinition:a,participantIds:e,collectionId:d});for(const n of e)Ah({collectionPosition:c,teamParticipantId:r,drawDefinition:a,modifiedLineUp:t,participantId:n,collectionId:d,tieFormat:m});return D.lineUp=t,{...de,modifiedLineUp:t}}const{modifiedLineUp:A}=Sh({participantIds:[o],collectionPosition:c,teamParticipantId:r,dualMatchUpSide:D,drawDefinition:a,collectionId:d});if(Ah({collectionPosition:c,teamParticipantId:r,drawDefinition:a,modifiedLineUp:A,participantId:o,collectionId:d,tieFormat:m}),D.lineUp=A,P){const e=Im({participantIds:[P],teamDrawIds:[a.drawId],tournamentRecord:i});e.error&&console.log("cleanup",{result:e})}return{...de,modifiedLineUp:A}},removeTieMatchUpParticipantId:function(e){var t,n,r,i;const{tournamentRecord:a,drawDefinition:o,participantId:s}=e;if(!s)return{error:Yt};const c=Ph(e);if(c.error)return c;const{relevantAssignments:u,collectionPosition:d,teamParticipants:l,collectionId:p,matchUpType:f,dualMatchUp:m,tieMatchUp:h,tieFormat:v}=c;if(Fl({score:h.score})||h.winningSide)return{error:Kn};const g=null===(t=h.sides)||void 0===t?void 0:t.find((e=>{var t,n,r;return(null===(t=e.participant)||void 0===t?void 0:t.participantId)===s||(null===(n=e.participant)||void 0===n||null===(r=n.individualParticipantIds)||void 0===r?void 0:r.includes(s))}));if(!g)return{error:$t};const{tournamentParticipants:[I]}=Dp({tournamentRecord:a,participantFilters:{participantIds:[s]}});if(!I)return{error:$t};if(f===ua&&I.participantType===La)return{error:Gt};const y=I.participantType===Oa?[s]:I.individualParticipantIds;m.sides||(m.sides=[{sideNumber:1},{sideNumber:2}]);let b=null===(n=m.sides)||void 0===n?void 0:n.find((({sideNumber:e})=>e===g.sideNumber));const w=Mh({drawDefinition:o,participantIds:y}),U=(null==w?void 0:w.teamParticipantId)||(null==l||null===(r=l.find((e=>oe((null==e?void 0:e.individualParticipantIds)||[],y).length===y.length)))||void 0===r?void 0:r.participantId);if(!U)return{error:$t};if(!b&&((null===(i=m.sides)||void 0===i?void 0:i.filter((({lineUp:e})=>!e)).length)||0)<2){var S;const e=l.map((({participantId:e})=>{var t;return{drawPosition:null===(t=u.find((t=>t.participantId===e)))||void 0===t?void 0:t.drawPosition,teamParticipantId:e}}));console.log({drawPositionMap:e}),b=null===(S=m.sides)||void 0===S?void 0:S.find((t=>{var n;return(null===(n=e.find((({drawPosition:e})=>e===t.drawPosition)))||void 0===n?void 0:n.teamParticipantId)===U}))}if(!b)return{error:qn,participantId:s};const{modifiedLineUp:D}=Sh({collectionPosition:d,teamParticipantId:U,dualMatchUpSide:b,participantIds:y,drawDefinition:o,collectionId:p});if(b.lineUp=D,U&&Nh({participantId:U,lineUp:D,drawDefinition:o,tieFormat:v}),f===da&&I.participantType===Oa){var N;const e=null===(N=h.sides)||void 0===N?void 0:N.find((e=>e.sideNumber===b.sideNumber)),{participantId:t}=e||{},{tournamentParticipants:[n]}=Dp({tournamentRecord:a,participantFilters:{participantIds:[t]},withEvents:!0});if(!n)return{error:$t};{const e=null==n?void 0:n.individualParticipantIds.filter((e=>e!==s));if(n.draws.length){if(1===e.length){const{participant:t}=Pc({participantIds:e,tournamentRecord:a});if(!t){const t=sp({participant:{participantRole:bf,individualParticipantIds:e,participantType:La},pairOverride:!0,tournamentRecord:a});if(t.error)return t}}}else if(e.length){n.individualParticipantIds=e;const t=Um({participant:n,pairOverride:!0,tournamentRecord:a});if(t.error)return t}else{const e=Im({participantIds:[t],tournamentRecord:a});e.error&&console.log("cleanup",{result:e})}}}return{...de,modifiedLineUp:D}},replaceTieMatchUpParticipantId:function(e){var t;const n=Ph(e);if(n.error)return n;const{existingParticipantId:r,tournamentRecord:i,newParticipantId:a,drawDefinition:o}=e;if(!r||!a)return{error:Yt};const{collectionPosition:s,teamParticipants:c,collectionId:u,dualMatchUp:d,tieMatchUp:l,tieFormat:p}=n,{matchUpType:f}=l,m=l.sides.find((e=>{var t,n,i;return(null===(t=e.participant)||void 0===t?void 0:t.participantId)===r||(null===(n=e.participant)||void 0===n||null===(i=n.individualParticipantIds)||void 0===i?void 0:i.includes(r))}));if(!m)return{error:$t};const{tournamentParticipants:h}=Dp({tournamentRecord:i,participantFilters:{participantIds:[r,a]}});if(2!==h.length)return{error:Yt};if(h[0].participantType!==h[1].participantType)return{error:Ht};const v=d.sides.find((({sideNumber:e})=>e===m.sideNumber));if(!v)return{error:qn,existingParticipantId:r};const g=h.find((({participantId:e})=>e===r)),I=(null==g?void 0:g.individualParticipantIds)||[g.participantId],y=Mh({drawDefinition:o,participantIds:I}),b=(null==y?void 0:y.teamParticipantId)||(null===(t=c.find((e=>oe((null==e?void 0:e.individualParticipantIds)||[],I).length===I.length)))||void 0===t?void 0:t.participantId),w=v.lineUp||y,U=w.find((({participantId:e})=>a===e)),S=(null==w?void 0:w.map((e=>{if(![r,a].includes(e.participantId))return e;var t;[r,a].includes(e.participantId)&&(e.collectionAssignments=null===(t=e.collectionAssignments)||void 0===t?void 0:t.filter((e=>!(e.collectionId===u&&e.collectionPosition===s))));return e.participantId===a&&(e.collectionAssignments||(e.collectionAssignments=[]),e.collectionAssignments.push({collectionId:u,collectionPosition:s})),e})))||[];U||S.push({participantId:a,collectionAssignments:[{collectionId:u,collectionPosition:s}]});const D=f===da,N=D&&w.map((e=>{var t;return(null===(t=e.collectionAssignments)||void 0===t?void 0:t.find((e=>e.collectionId===u&&e.collectionPosition===s)))&&e.participantId})).filter(Boolean),P=D&&S.map((e=>{var t;return(null===(t=e.collectionAssignments)||void 0===t?void 0:t.find((e=>e.collectionId===u&&e.collectionPosition===s)))&&e.participantId})).filter(Boolean);let A,M;if(v.lineUp=S,b&&Nh({participantId:b,lineUp:S,drawDefinition:o,tieFormat:p}),D){var T;const{tournamentRecord:t}=e;let n=Pc({participantIds:P,tournamentRecord:t});if(!n.participant){var E;const e=sp({tournamentRecord:t,pairOverride:!0,participant:{individualParticipantIds:P,participantType:La,participantRole:bf}});if(e.error)return e;A=null===(E=e.participant)||void 0===E?void 0:E.participantId}n=Pc({participantIds:N,tournamentRecord:t});const r=null===(T=n.participant)||void 0===T?void 0:T.participantId;if(r){Im({participantIds:[r],tournamentRecord:t}).success&&(M=r)}}return{...de,participantRemoved:M,participantAdded:A}},updateTeamLineUp:Nh,validateLineUp:Dh,getTeamLineUp:Ac};function Qv({tournamentParticipants:e=[],possiblyDisablingAction:t,activeDrawPositions:n,positionAssignments:r,policyDefinitions:i,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l;if(n.includes(o))return{};const p=null==i||null===(l=i.positionActions)||void 0===l?void 0:l.otherFlightEntries,f=(a.entries||[]).map((({participantId:e})=>e)).filter(Boolean),m=r.map((e=>e.participantId)).filter(Boolean),h=(d.entries||[]).filter((e=>e.entryStatus===Zc&&function({structure:e,entry:t}){const{stage:n}=e;if(!t.entryStage||t.entryStage===n||t.entryStage===Lo&&n===Fo)return!0}({structure:c,entry:e})&&!m.includes(e.participantId))).sort(((e,t)=>(e.entryPosition||9999)-(t.entryPosition||9999))).map((e=>e.participantId));if(p){var v;const{flightProfile:e}=tl({event:d}),t=null==e||null===(v=e.flights)||void 0===v?void 0:v.filter((e=>e.drawId!==u)).map((e=>e.drawEntries.filter((e=>e.participantId&&!f.includes(e.participantId))).map((({participantId:e})=>e)))).flat().filter(Boolean);null!=t&&t.length&&h.push(...t)}const g=null==e?void 0:e.filter((e=>h.includes(e.participantId)));if(g.forEach((e=>{const t=(a.entries||[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),g.sort(((e,t)=>(e.entryPosition||9999)-(t.entryPosition||9999))),h.length){return{validAlternatesAction:{type:Cs,method:"alternateDrawPositionAssignment",availableAlternates:g,availableAlternatesParticipantIds:h,willDisableLinks:t,payload:{drawId:u,structureId:s,drawPosition:o}}}}return{}}function Xv(e,t){return e.bye||e.seedValue<t.seedValue||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function eg({drawDefinition:e,drawPosition:t,structureId:n,structure:r,drawId:i,event:a,isByePosition:o,byeDrawPositions:s,positionAssignments:c,tournamentParticipants:u,onlyAssignedPositions:d=!0,activeDrawPositions:l,inactiveDrawPositions:p,possiblyDisablingAction:f}){if(l.includes(t))return{};const m=null==p?void 0:p.filter((e=>e!==t&&!(o&&s.includes(e)))),h=(null==c?void 0:c.filter((e=>(e=>!d||e.participantId||e.qualifier||e.bye)(e)&&(null==m?void 0:m.includes(e.drawPosition)))))||[],v=h.map((({drawPosition:e})=>e)),{matchUps:g}=Ou({inContext:!0,drawDefinition:e,structure:r,event:a}),I=g.filter((({drawPositions:e})=>se(e,v))),y=Object.assign({},...I.map((e=>{var t;return null===(t=e.sides)||void 0===t?void 0:t.filter((({sourceDrawPositionRange:e})=>e)).map((({drawPosition:e,sourceDrawPositionRange:t})=>({[e]:t})))})).flat()),b=h.map((e=>e.participantId)).filter(Boolean),w=(u||[]).filter((e=>b.includes(e.participantId))),U=Object.assign({},...w.map((e=>({[e.participantId]:e})))),S=h.map((e=>{const t=U&&U[e.participantId],n=y[e.drawPosition];return{...e,participant:Gr(t,!1,!0),sourceDrawPositionRange:n}}));if(S.length){return{validSwapAction:{type:ks,method:"swapDrawPositionAssignments",availableAssignments:S,willDisableLinks:f,payload:{drawId:i,structureId:n,drawPositions:[t]}}}}return{}}function tg({action:e,policyActions:t}){var n;const r=!(null!=t&&t.enabledActions)||(null==t||null===(n=t.disabledActions)||void 0===n?void 0:n.length)&&t.disabledActions.includes(e);if(r)return!1;return!(!(0===(null==t?void 0:t.enabledActions.length)||(null==t?void 0:t.enabledActions.includes(e)))||r)}function ng({policyDefinitions:e,tournamentParticipants:t=[],tournamentRecord:n,drawDefinition:r,drawPosition:i,structureId:a,event:o}){if(!o)return{error:ze};if(!r)return{error:Ie};if(void 0===i)return{error:Te};if(!a)return{error:Ge};const{activeDrawPositions:s,byeDrawPositions:c,inactiveDrawPositions:u,structure:d,error:l}=zd({tournamentRecord:n,drawDefinition:r,structureId:a});if(l)return{error:l};const{policyDefinitions:p}=Qd({policyTypes:[ti],tournamentRecord:n,drawDefinition:r,event:o}),f=e||p,{enabledStructures:m,actionsDisabled:h}=function({policyDefinitions:e,tournamentRecord:t,drawDefinition:n,structure:r,event:i}){const{policyDefinitions:a}=Qd({policyTypes:[ti],tournamentRecord:t,drawDefinition:n,event:i}),o=(e=e||a||Vs).positionActions,{enabledStructures:s,disabledStructures:c}=o||{};return{enabledStructures:s,actionsDisabled:null==c?void 0:c.find((e=>{var t,n;return(null===(t=e.stages)||void 0===t?void 0:t.includes(r.stage))&&(!(null!==(n=e.stageSequences)&&void 0!==n&&n.length)||e.stageSequences.includes(r.stageSequence))}))}}({policyDefinitions:f,tournamentRecord:n,drawDefinition:r,structure:d,event:o}),{sourceStructureIds:v}=function({drawDefinition:e,structureId:t,finishingPosition:n,linkType:r}){const{links:i}=td({drawDefinition:e,structureId:t})||{};return{sourceStructureIds:((null==i?void 0:i.target)||[]).filter((({linkType:e})=>e===r)).map((({source:e})=>e.structureId)).map((t=>{const{structure:n}=_c({drawDefinition:e,structureId:t});return{sourceStructureId:t,sourceFinishingPosition:n.finishingPosition}})).filter((({sourceFinishingPosition:e})=>e===n)).map((({sourceStructureId:e})=>e))}}({drawDefinition:r,structureId:a,finishingPosition:Ds,linkType:Jo})||{};let g;null!=v&&v.length&&(g=v.reduce(((e,t)=>wl({drawDefinition:r,structureId:t})&&e),!0));const I=v.length,y=v.length&&!g,{policyActions:b}=function({enabledStructures:e,structure:t}){if(!1===e)return{};if(null==e||!e.length)return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:n,stageSequence:r}=t||{};return{policyActions:e.find((e=>{var t,i;const a=!(null!==(t=e.stages)&&void 0!==t&&t.length)||e.stages.includes(n),o=!(null!==(i=e.stageSequences)&&void 0!==i&&i.length)||e.stageSequences.includes(r);if(e&&a&&o)return!0}))}}({enabledStructures:m,structure:d}),w=![ko,Lo].includes(d.stage)||1!==d.stageSequence,U=[],{drawId:S}=r,{assignedPositions:D,positionAssignments:N}=Au({structure:d}),P=D.find((e=>e.drawPosition===i)),A=N.map((e=>e.drawPosition));if(null==A||!A.includes(i))return{error:Me};const{stage:M,stageSequence:T}=d,E=[tu,eu],C=[M];M===Fo&&C.push(Lo),M===Lo&&C.push(Fo);const R=yu({drawDefinition:r,stageSequence:T,entryStatuses:E,structureId:a,stages:C}),O=sv({drawDefinition:r,stages:C}),x=R.filter((e=>!O.includes(e.participantId))).map((e=>e.participantId)),L=c.includes(i),k=s.includes(i);if(h)return{message:"Actions Disabled for structure",isByePosition:L,isActiveDrawPosition:k,isDrawPosition:!0,hasPositionAssigned:!!P,validActions:[]};if(tg({policyActions:b,action:Os})&&!k&&!y&&(!P||L)){const{validAssignmentActions:e}=function({positionSourceStructureIds:e,unassignedParticipantIds:t,possiblyDisablingAction:n,tournamentParticipants:r,isWinRatioFedStructure:i,positionAssignments:a,policyDefinitions:o,drawDefinition:s,isByePosition:c,drawPosition:u,structureId:d,structure:l}){var p,f,m;const{drawId:h}=s,v=[];let g,I,y=[];const b=null==o||null===(p=o.seeding)||void 0===p||null===(f=p.validSeedPositions)||void 0===f?void 0:f.ignore;if(!b){const e=Rl({randomize:!0,drawDefinition:s,structureId:d});({unplacedSeedParticipantIds:g,unplacedSeedAssignments:I,unfilledPositions:y}=e)}if(null!==(m=y)&&void 0!==m&&m.length||(y=a.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition))),c||v.push({type:Bs,method:"assignDrawPositionBye",willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}}),i&&b){var w;const t=a.map((e=>e.participantId)).filter(Boolean),i={structureIds:e},{completedMatchUps:o}=cd({inContext:!0,matchUpFilters:i,drawDefinition:s}),c=Q(null===(w=o||[])||void 0===w?void 0:w.map((({sides:e})=>e.map(Cc))).flat().filter((e=>!t.includes(e)))),l=null==r?void 0:r.filter((e=>null==c?void 0:c.includes(e.participantId)));return null==l||l.forEach((e=>{const t=(s.entries||[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null!=l&&l.length&&v.push({type:Os,method:Ts,availableParticipantIds:c,participantsAvailable:l,willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}}),{validAssignmentActions:v}}const U=!(null!=l&&l.structures||null!=l&&l.matchUps.find((({roundPosition:e})=>!!e)));if(y.includes(u)||c){var S;let e;if(null!==(S=I)&&void 0!==S&&S.length){const t=I.filter((e=>{var t;return null===(t=g)||void 0===t?void 0:t.includes(e.participantId)}));t.sort(Xv),e=t.map((e=>e.participantId))}else if(U)e=Dl({drawDefinition:s,drawPosition:u,structure:l});else{e=t;const{unplacedQualifiersCount:n}=yh({drawDefinition:s,structureId:d,structure:l});n&&console.log({unplacedQualifiersCount:n})}const i=null==r?void 0:r.filter((t=>e.includes(t.participantId)));null!=i&&i.length&&v.push({type:Os,method:Ts,availableParticipantIds:e,participantsAvailable:i,willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}})}return{validAssignmentActions:v}}({positionSourceStructureIds:v,unassignedParticipantIds:x,possiblyDisablingAction:w,isWinRatioFedStructure:I,tournamentParticipants:t,positionAssignments:N,activeDrawPositions:s,policyDefinitions:f,drawDefinition:r,isByePosition:L,drawPosition:i,structureId:a,structure:d});null==e||e.forEach((e=>U.push(e)))}const{participantId:F}=P||{},j=F&&t.find((e=>e.participantId===F));if(P){tg({policyActions:b,action:xs})&&!k&&(U.push({type:xs,method:Ms,payload:{drawId:S,structureId:a,drawPosition:i},willDisableLinks:w}),L||U.push({type:Rs,method:"withdrawParticipantAtDrawPosition",payload:{drawId:S,structureId:a,drawPosition:i},willDisableLinks:w}),tg({policyActions:b,action:Bs})&&!L&&U.push({type:Bs,method:Ms,payload:{drawId:S,structureId:a,drawPosition:i,replaceWithBye:!0},willDisableLinks:w}));const e=d.stage===ko||d.stage===Lo&&1===d.stageSequence;if(!L&&tg({policyActions:b,action:js})&&Cl({drawDefinition:r,structureId:a,drawPosition:i})&&e){const{seedAssignments:e}=Su({drawDefinition:r,structure:d}),{seedNumber:t,seedValue:n}=e.find((e=>e.participantId===F))||{};U.push({type:js,method:"modifySeedAssignment",participant:j,seedNumber:t,payload:{drawId:S,structureId:a,participantId:F,seedValue:n}})}if(!L&&F){if(tg({policyActions:b,action:_s})){const e={type:_s,method:Es,participant:j,payload:{drawId:S,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};U.push(e)}if(tg({policyActions:b,action:Fs})){const e={type:Fs,method:"modifyParticipantOtherName",participant:j,payload:{participantId:F,otherName:void 0}};U.push(e)}}if(tg({policyActions:b,action:ks})){const{validSwapAction:e}=eg({drawId:S,structure:d,structureId:a,drawPosition:i,isByePosition:L,drawDefinition:r,byeDrawPositions:c,positionAssignments:N,activeDrawPositions:s,inactiveDrawPositions:u,tournamentParticipants:t,possiblyDisablingAction:w});e&&U.push(e)}}if(tg({policyActions:b,action:Cs})&&!y){const{validAlternatesAction:e}=Qv({possiblyDisablingAction:w,tournamentParticipants:t,positionAssignments:N,activeDrawPositions:s,policyDefinitions:f,drawDefinition:r,drawPosition:i,structureId:a,structure:d,drawId:S,event:o});e&&U.push(e)}if(tg({policyActions:b,action:Ls})&&!y){const{validLuckyLosersAction:e}=function({tournamentParticipants:e=[],possiblyDisablingAction:t,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:i,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l,p,f,m;if(r.includes(o)||n)return{};const{sourceStructureIds:h,targetStructureIds:v}=(null===(l=a.links)||void 0===l?void 0:l.reduce(((e,t)=>{var n,r;const i=null===(n=t.source)||void 0===n?void 0:n.structureId,a=null===(r=t.target)||void 0===r?void 0:r.structureId;return e.sourceStructureIds.includes(i)||e.sourceStructureIds.push(i),e.targetStructureIds.includes(a)||e.targetStructureIds.push(a),e}),{sourceStructureIds:[],targetStructureIds:[]}))||{};let g=null===(p=a.links)||void 0===p?void 0:p.find((e=>{var t;return(null===(t=e.target)||void 0===t?void 0:t.structureId)===c.structureId}));const I=null===(f=g)||void 0===f||null===(m=f.source)||void 0===m?void 0:m.structureId,{structure:y}=_c({drawDefinition:a,structureId:I}),b={};if((null==y?void 0:y.finishingPosition)===Ns&&(1!==(null==h?void 0:h.length)||1!==(null==v?void 0:v.length))){var w,U,S;const{matchUps:e}=Ou({drawDefinition:a,structure:c,event:d}),{initialRoundNumber:t}=yd({drawPosition:o,matchUps:e});g=null===(w=a.links)||void 0===w?void 0:w.find((e=>{var n;return(null===(n=e.target)||void 0===n?void 0:n.structureId)===(null==c?void 0:c.structureId)&&e.target.roundNumber===t}));const n=null===(U=g)||void 0===U||null===(S=U.source)||void 0===S?void 0:S.roundNumber;b.roundNumbers=[n]}const{completedMatchUps:D}=od({structureId:I,inContext:!0,matchUpFilters:b,drawDefinition:a}),N=i.map((e=>e.participantId)).filter(Boolean),P=null==D?void 0:D.map((({winningSide:e,sides:t})=>t[1-(e-1)])).map(Cc).filter((e=>!N.includes(e))),A=null==e?void 0:e.filter((e=>null==P?void 0:P.includes(e.participantId)));if(null==A||A.forEach((e=>{const t=(a.entries||[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null!=P&&P.length)return{validLuckyLosersAction:{type:Ls,method:"luckyLoserDrawPositionAssignment",availableLuckyLosers:A,availableLuckyLoserParticipantIds:P,willDisableLinks:t,payload:{drawId:u,structureId:s,drawPosition:o}}};return{}}({drawId:S,structure:d,structureId:a,drawPosition:i,drawDefinition:r,activeDrawPositions:s,positionAssignments:N,isWinRatioFedStructure:I,tournamentParticipants:t,possiblyDisablingAction:w});e&&U.push(e)}return{isByePosition:L,isActiveDrawPosition:k,isDrawPosition:!0,hasPositionAssigned:!!P,validActions:U}}const rg={allTournamentMatchUps:ud,tournamentMatchUps:pd,allEventMatchUps:ld,getRoundMatchUps:function(e){return Lc(e)},allDrawMatchUps:dd,eventMatchUps:fd,drawMatchUps:function({tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,policyDefinitions:n,tournamentRecord:r,matchUpFilters:i,contextFilters:a,contextProfile:o,drawDefinition:s,nextMatchUps:c,participants:u,tournamentId:d,inContext:l,context:p,event:f}){if(!f)return{error:ze};const{eventId:m,eventName:h,endDate:v}=f||{};return cd({context:{...p,...Vr({eventId:m,eventName:h,endDate:v||(null==f?void 0:f.endDate)||(null==r?void 0:r.endDate),tournamentId:d||(null==r?void 0:r.tournamentId),indoorOutDoor:(null==f?void 0:f.indoorOutDoor)||(null==r?void 0:r.indoorOutDoor),surfaceCategory:(null==f?void 0:f.surfaceCategory)||(null==r?void 0:r.surfaceCategory)})},tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:u||r&&md({tournamentRecord:r}),policyDefinitions:n,tournamentRecord:r,drawDefinition:s,matchUpFilters:i,contextFilters:a,contextProfile:o,nextMatchUps:c,inContext:l,event:f})},credits:Ff,getEvent:function({tournamentRecord:e,drawDefinition:t,event:n,context:r}){var i;if(!e)return{error:me};if(!n)return{error:ze};const a=Gr(n);return r&&Object.assign(a,r),{event:a,drawDefinition:t&&(null===(i=a.drawDefinitions)||void 0===i?void 0:i.find((({drawId:e})=>t.drawId===e)))}},getEvents:function({tournamentRecord:e,context:t,inContext:n}){if(!e)return{error:me};const{tournamentId:r}=e;return{events:(e.events||[]).map((e=>{const i=Gr(e);return t&&Object.assign(i,t),n&&Object.assign(i,{tournamentId:r}),i}))}},findEventExtension:oa,findTournamentExtension:aa,findParticipantExtension:function({tournamentRecord:e,participantId:t,name:n}){if(!e)return{error:me};if(!t)return{error:Yt};const{participant:r}=ra({tournamentRecord:e,participantId:t});return ia({element:r,name:n})},findDrawDefinitionExtension:sa,getMatchUpFormat:Bp,getDrawDefinition:function({tournamentRecord:e,drawDefinition:t}){return e?{drawDefinition:Gr(t)}:{error:me}},getEventProperties:function({tournamentRecord:e,event:t}){var n,r;if(!e)return{error:me};if(!t)return{error:ze};const i=t.entries||[],a=e.participants||[],o=(null===(n=t.category)||void 0===n?void 0:n.categoryName)||(null===(r=t.category)||void 0===r?void 0:r.ageCategoryCode),{eventType:s}=t,c=i.map((e=>e.participantId));let u,d,l;return{entryScaleAttributes:a.filter((e=>c.includes(e.participantId))).map((e=>{var t,n,r,i,a,c;const{participantId:p,participantName:f,name:m}=e;let h={scaleType:Di,eventType:s,scaleName:o};const v=null===(t=mm({participant:e,scaleAttributes:h}))||void 0===t||null===(n=t.scaleItem)||void 0===n?void 0:n.scaleValue;h={scaleType:Si,eventType:s,scaleName:o};const g=null===(r=mm({participant:e,scaleAttributes:h}))||void 0===r||null===(i=r.scaleItem)||void 0===i?void 0:i.scaleValue;h={scaleType:Ui,eventType:s,scaleName:o};const I=null===(a=mm({participant:e,scaleAttributes:h}))||void 0===a||null===(c=a.scaleItem)||void 0===c?void 0:c.scaleValue;return u=!(!u&&!v),d=!(!d&&!g),l=!(!l&&!I),{participantId:p,participantName:f||m,seed:v,ranking:g,rating:I}})),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:l}},getPositionAssignments:function({tournamentRecord:e,drawDefinition:t,structureId:n}){return e?t?n?Pu({drawDefinition:t,structureId:n}):{error:Ge}:{error:Ie}:{error:me}},isValidMatchUpFormat:g,getMaxEntryPosition:function({entries:e=[],entryStatus:t,stage:n}){return Math.max(...e.filter((e=>!(n&&n!==e.entryStage||t&&e.entryStatus!==t||isNaN(e.entryPosition)))).map((({entryPosition:e})=>parseInt(e||0))),0)},findVenue:Fu,getCourts:Bu,getVenuesAndCourts:ku,findCourt:function(e){return Gr(_u(e),!1,!0)},getEventTimeItem:ec,getTournamentTimeItem:function({tournamentRecord:e,itemType:t,itemSubTypes:n,returnPreviousValues:r}){if(!e)return{error:me};if(!e.timeItems)return{message:qn};const{timeItem:i,previousItems:a,message:o}=Xs({element:e,itemType:t,itemSubTypes:n,returnPreviousValues:r});return i&&{timeItem:i,previousItems:a}||{message:o}},getParticipantTimeItem:function({tournamentRecord:e,participantId:t,itemType:n,itemSubTypes:r,returnPreviousValues:i}){if(!e)return{error:me};if(!t)return{error:Yt};const a=ra({tournamentRecord:e,participantId:t});if(a.error)return a;const{participant:o}=a;if(null==o||!o.timeItems)return{message:qn};const{timeItem:s,previousItems:c,message:u}=Xs({element:a.participant,itemType:n,itemSubTypes:r,returnPreviousValues:i});return s&&{timeItem:s,previousItems:c}||{message:u}},getDrawDefinitionTimeItem:function({drawDefinition:e,itemType:t,itemSubTypes:n,returnPreviousValues:r}){if(!e)return{error:Re};if(!e.timeItems)return{message:qn};const{timeItem:i,previousItems:a,message:o}=Xs({element:e,itemType:t,itemSubTypes:n,returnPreviousValues:r});return i&&{timeItem:i,previousItems:a}||{message:o}},bulkUpdatePublishedEventIds:function({tournamentRecord:e,outcomes:t}){var n;if(!e)return{error:me};if(null==t||!t.length)return{error:Mt,message:"Missing outcomes"};const r=t.reduce(((e,t)=>{const{drawId:n,eventId:r}=t;return r&&n&&(e[r]?e[r].includes(n)||e[r].push(n):e[r]=[n]),e}),{}),i=Object.keys(r);return{publishedEventIds:(null===(n=e.events)||void 0===n?void 0:n.filter((e=>i.includes(e.eventId)))).filter((e=>{const{timeItem:t}=ec({event:e,itemType:"PUBLISH.STATUS"}),n=null==t?void 0:t.itemValue,{eventId:i}=e;return r[i].filter((e=>{var t;return n&&n.PUBLIC&&(null===(t=n.PUBLIC.drawIds)||void 0===t?void 0:t.includes(e))&&n!==Ai})).length})).map((e=>e.eventId)),eventIdPublishedDrawIdsMap:r}},matchUpActions:Wf,positionActions:function({policyDefinitions:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,structureId:i,drawId:a,event:o}){const{tournamentParticipants:s}=Dp({tournamentRecord:t,inContext:!0});return ng({tournamentParticipants:s,policyDefinitions:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,structureId:i,drawId:a,event:o})},findMatchUp:function(e){Object.assign(e,{inContext:!0});const{matchUp:t,error:n}=hd(e);return{matchUp:Gr(t,!0,!0),error:n}},participantScheduledMatchUps:dp,participantScaleItem:mm,getParticipantScaleItem:Qh,getParticipantSignInStatus:function({tournamentRecord:e,participantId:t}){if(!e)return{error:me};if(!t)return{error:Yt};const{participant:n}=ra({tournamentRecord:e,participantId:t});if(!n)return{error:$t};const{timeItem:r}=Xs({element:n,itemType:pp});return r&&r.itemValue===gp&&gp},getPolicyDefinitions:Qd,getMatchUpScheduleDetails:Ea};const ig={addVenue:op,deleteVenue:ip,deleteVenues:function({tournamentRecord:e,venueIds:t,force:n}){if(!e)return{error:me};if(!Array.isArray(t))return{error:jn};for(const r of e.venues||[]){const{venueId:i}=r;if(t.includes(i)){const{venueId:t}=r,i=ip({tournamentRecord:e,venueId:t,force:n});if(i.error)return i}}return de},modifyVenue:np,addCourt:ep,addCourts:tp,deleteCourt:function({tournamentRecord:e,drawDefinition:t,disableNotice:n,courtId:r,force:i}){const{venue:a,error:o}=_u({tournamentRecord:e,courtId:r});if(o)return{error:o};const{matchUps:s}=Yl({tournamentRecord:e,courtId:r});if(s.length&&!i)return $l({matchUpsCount:s.length});for(const c of s){const n=rp({tournamentRecord:e,drawDefinition:t,drawId:c.drawId,matchUpId:c.matchUpId});if(n.error)return n}return a.courts=(a.courts||[]).filter((e=>e.courtId!==r)),n||nr({topic:gc,payload:{venue:a},key:a.venueId}),{...de}},modifyCourt:Xl,modifyCourtAvailability:Ql,findVenue:function(e){return Gr(Fu(e),!1,!0)}},ag=function(){const e={getState:({convertExtensions:e,removeExtensions:t}={})=>em({convertExtensions:e,removeExtensions:t,tournamentId:sr()}),newTournamentRecord:(e={})=>{const t=Qf(e);return t.error?t:(dr(t),pr(t.tournamentId),Object.assign({tournamentId:t.tournamentId},de))},setTournamentId:e=>pr(e)};function t(t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}return e.version=()=>"0.51.1",e.reset=()=>t(fr(sr())),e.setState=(e,n,r)=>{tr(n,r);return t(Xf(e,n))},e.devContext=t=>(er(t),e),e.getDevContext=e=>Xn(e),e.executionQueue=(t,r)=>function(t,r){if(!Array.isArray(t))return{error:jn};const i=cr(sr()),a=r&&Gr(i,!1,!0),o=[];for(const s of t){if("object"!=typeof s)return{error:jn};const{method:t,params:r}=s;if(!e[t])return{error:Yn};const c=n(i,e[t],r);if(null!=c&&c.error)return a&&Xf(a),{...c,rolledBack:!!a};o.push(c)}return Op(),ir(),{results:o}}(t,r),[rg,Zv,ig,km,Em,Mm,Tm,Sm].forEach((t=>{Object.keys(t).forEach((n=>{e[n]=e=>{if(Xn())return r(t[n],e);try{return r(t[n],e)}catch(i){console.log("%c ERROR","color: orange",{err:i})}}}))})),e;function n(t,n,r){delete e.success,delete e.error;return n({...tm(t,r),tournamentRecord:t})}function r(e,t){const r=(null==t?void 0:t.sandBoxRecord)||(null==t?void 0:t.sandboxRecord)||(null==t?void 0:t.sandboxTournament)||cr(sr()),i=(null==t?void 0:t.rollbackOnError)&&Gr(r,!1,!0),a=n(r,e,t);null!=a&&a.error&&i&&Xf(i);const o=(null==a?void 0:a.success)&&!0!==(null==t?void 0:t.delayNotify);return o&&Op(),!o&&null!=a&&a.success||ir(),a}}();function og(e){if(e.matchUpStatus===w){return e.sides.reduce(((e,t)=>t.participantId||e),void 0)}if(!e.winningSide)return;return e.sides.reduce(((t,n)=>n.sideNumber===e.winningSide?n.participantId:t),void 0)}const sg={getSourceRounds:Iv,getDrawStructures:qh,getPositionsPlayedOff:gv,getStructureQualifiersCount:function({drawDefinition:e,structure:t,structureId:n}){let r,i;if(t||({structure:t,error:r}=_c({drawDefinition:e,structureId:n})),!r)if(t.stage!==ko)r="Structure is not Qualifying";else{const{matchUps:n}=Ou({drawDefinition:e,structure:t});i=n.reduce(((e,t)=>e+(1===t.finishingRound?1:0)),0)}return{qualifiersCount:i,error:r}},getAvailablePlayoffRounds:yv,addPlayoffStructures:wv,removeStructure:Tv,addAdHocMatchUps:Cv,generateAdHocMatchUps:Rv,deleteAdHocMatchUps:_v,structureSort:jc,generateDrawType:$h,addVoluntaryConsolationStage:jv,generateVoluntaryConsolationStructure:Ev,buildDrawHierarchy:function({matchUps:e,matchUpType:t}){var n;if(!e)return{error:mt};let r=0,i=[],a=[];t&&(e=e.filter((e=>e.matchUpType===t)));const o=Q(e.map((({matchUpType:e})=>e)));if(o.length>1)if(o.includes(la))e=e.filter((e=>e.matchUpType===la));else if(o.includes(ua))e=e.filter((e=>e.matchUpType===ua));else{if(!o.includes(da))return{};e=e.filter((e=>e.matchUpType===da))}if(!Array.isArray(e)||!e.length)return{};const s=(e,t)=>parseInt(e)-parseInt(t),c=Q(e.map((e=>e.drawPositions)).flat().filter(Boolean)).sort(s),u=ie(1,Math.max(...c)+1).filter((e=>!c.includes(e))).sort(s),{roundMatchUps:d}=Lc({matchUps:e}),l=d[1],p=d[2]||[],[f]=l||[{}],m=f.drawId,h=f.structureId,v=Math.max(...Object.keys(d)),g=(null===(n=d[v])||void 0===n?void 0:n.length)||0,I=Math.ceil(Math.log(g)/Math.log(2)),y=ie(1,I+1).map((e=>{const t=Math.pow(2,e-1),n=v+I-e+1;return ie(1,t+1).map((t=>({drawId:m,structureId:h,matchUpId:Wr(),drawPositions:[],sides:[],roundNumber:n,roundPosition:t,finishingRound:e})))}));I&&(e=e.concat(...y.flat()));const b=l.map((e=>e.drawPositions)).flat(1/0),w=p.map((e=>e.drawPositions)).flat(1/0).filter((e=>!b.includes(e))).sort(s),U=p.filter((e=>{var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.reduce(((e,t)=>w.includes(t)||e),void 0)})).map((e=>{var t,n;const r=null===(t=e.drawPositions)||void 0===t?void 0:t.reduce(((e,t)=>w.includes(t)?t:e),void 0),i=null===(n=e.drawPositions)||void 0===n?void 0:n.indexOf(r);return{[r]:e.sides[i]}}));if(null!=u&&u.length&&(null==w?void 0:w.length)===(null==u?void 0:u.length)){const t=w.map(((e,t)=>[e,u[t]].sort(s))),n=Object.assign({},...U),r=Gr(l[0].finishingRound,!1,!0),i=Gr(l[0].finishingPositionRange);a=t.map(((e,t)=>{const a=Math.max(...e)/2;return{sides:e.map((e=>n[e]||{bye:!0,drawPosition:e})),drawId:m,structureId:h,roundPosition:a,drawPositions:e,roundNumber:1,finishingRound:r,matchUpId:Wr(),matchUpStatus:"BYE",sideNumber:t+1,finishingPositionRange:i}})),e=e.concat(...a)}const S=v+I;return ie(1,S+1).forEach((t=>{var n,a;const o=[],s=D({matchUps:e,roundNumber:t}),c=D({matchUps:e,roundNumber:t-1}).map(og).filter(Boolean),u=(null==s?void 0:s.length)===(null===(n=i)||void 0===n?void 0:n.length),d=(null==s?void 0:s.length)===(null===(a=i)||void 0===a?void 0:a.length)/2;1===t&&s.forEach((e=>{const t=e.drawPositions||[],{matchUpId:n,structureId:r}=e,i=[{...e.sides[0],drawPosition:t[0],matchUpId:n,structureId:r},{...e.sides[1],drawPosition:t[1],matchUpId:n,structureId:r}],a={...e,children:i};o.push(a)})),u?(r++,s.forEach(((e,t)=>{const n=e.drawPositions||[],{matchUpId:a,structureId:s}=e,u=n.filter(Boolean).reduce(((e,t)=>b.includes(t)?e:t),void 0),d=[{...e.sides.filter(Boolean).reduce(((e,t)=>t.participantId&&!c.includes(t.participantId)?t:e),void 0),drawPosition:u,feedRoundNumber:r,sides:e.sides,matchUpId:a,structureId:s},i[t]],l={...e,children:d};o.push(l)}))):d&&s.forEach(((e,t)=>{const n={...e,children:[i[2*t],i[2*t+1]]};o.push(n)})),i=o})),{hierarchy:i[0],missingMatchUps:a,maxRound:v,finalRound:S,matchUps:e};function D({matchUps:e,roundNumber:t}){return e.filter((e=>e.roundNumber===t)).sort(((e,t)=>e.roundPosition-t.roundPosition))}}};function cg({participantPreferences:e,drawPositionResolutions:t={}}){const n=Object.keys(e).reduce(((t,n)=>{const r=e[n].preferences[0];return r&&(t[r]||(t[r]=[]),t[r].push(n)),t}),{}),r=Math.min(...Object.values(n).filter((e=>e.length)).map((e=>e.length))),i=Object.keys(n).filter((e=>n[e].length&&r&&n[e].length===r));let a;return i.forEach((r=>{const i=ne(n[r]);t[r]=i,delete e[i]})),Object.values(e).forEach((e=>{e.preferences=e.preferences.filter((e=>{const t=!i.includes(e.toString());return t&&(a=!0),t}))})),{drawPositionResolutions:t,remainingPreferences:a,participantPreferences:e}}const ug={setSubOrder:Dv,clearDrawPosition:Jd,assignDrawPosition:Ol,automatedPositioning:wh,assignDrawPositionBye:ul,swapDrawPositionAssignments:dv,alternateDrawPositionAssignment:fv,resolveDrawPositions:function({participantFactors:e,positionAssignments:t}){if(!e||!t)return{error:Mt};let n=Gr(e,!1,!0);const r=t.map((({drawPosition:e})=>e)),i=t.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map(Rc);let a,o=!0;for(;o;)({drawPositionResolutions:a,remainingPreferences:o,participantPreferences:n}=cg({participantPreferences:n,drawPositionResolutions:a}));const s=Object.keys(a).map((e=>parseInt(e)));let c=i.filter((e=>!s.includes(e))),u=Object.keys(n);const d=ie(1,(l=2,p=r.length,Math.log(p)/Math.log(l)+1)).map((e=>Math.pow(2,e)));var l,p;const f={};for(const h of d){const t=ce(r,h).filter((e=>se(e,c))),n={};u.forEach((r=>{t.forEach((t=>{const i=t.join("|");se(t,e[r].preferences)&&(n[i]||(n[i]=[]),n[i].push(r))}))}));if(X(Object.keys(n)).forEach((e=>{const t=n[e].filter((e=>u.includes(e)));for(;t.length;){const n=ne(t),r=e.split("|").map((e=>parseInt(e))).filter((e=>c.includes(parseInt(e))));if(r.length){const t=ne(r);c=c.filter((e=>e!==t)),u=u.filter((e=>e!==n)),a[t]=n;const i=e.split("|").length;f[i]||(f[i]=0),f[i]+=1}}})),!c.length)break}const m={chunkResolution:f};return u.length&&(u.forEach((e=>{const t=ne(c);t&&(a[t]=e)})),m.randomAssignment=u.length),{drawPositionResolutions:a,report:m}},initializeStructureSeedAssignments:Eh,getNextSeedBlock:Rl};function dg(e){return null!==e&&(void 0===e||!isNaN(e))}const lg={setMatchUpStatus:Bl,setMatchUpFormat:Vl,isValidMatchUpFormat:g,addMatchUpTimeItem:Lu,resetMatchUpTimeItems:function({drawDefinition:e,event:t,matchUpId:n}){const{matchUp:r}=xu({drawDefinition:e,event:t,matchUpId:n});return r?(r.timeItems=[],Sc({drawDefinition:e,matchUp:r}),{...de}):{error:ft}},checkInParticipant:mf,checkOutParticipant:hf,getCheckedInParticipantIds:Eu,addMatchUpScheduleItems:Hu,addMatchUpScheduledDate:Wu,addMatchUpScheduledTime:zu,addMatchUpStartTime:Yu,addMatchUpEndTime:$u,addMatchUpStopTime:Ju,addMatchUpResumeTime:Zu,setDelegatedOutcome:Av,removeDelegatedOutcome:Nv,drawMatic:Wv,matchUpSort:Gd,addMatchUpOfficial:Ku,findMatchUp:function(e){return Object.assign(e,{inContext:!0}),{matchUp:Gr(xu(e).matchUp,!1,!0)}},getRoundMatchUps:Lc,validDrawPositions:function({matchUps:e}){if(!e)return{error:mt};const t=e.map((e=>e.drawPositions)).flat();Xn()&&e.forEach((e=>{Array.isArray(e.drawPositions)?e.drawPositions.forEach((t=>{dg(t)||console.log("invalid drawPosition",e)})):console.log("drawPositions not an array",e)}));const n=t.every(dg),r=e.find((e=>!Array.isArray(e.drawPositions)));return n&&!r}},pg={attachPolicies:Zh};const fg={allPlayoffPositionsFilled:Ul,isCompletedStructure:wl,getStructureMatchUps:od,allStructureMatchUps:function(e){const{structure:t}=_c(e);return Object.assign(e,{structure:t,inContext:!0}),Ou(e)},allDrawMatchUps:function(e){return Object.assign(e,{inContext:!0}),sd(e)},drawMatchUps:function(e){return Object.assign(e,{inContext:!0}),cd(e)},getEliminationDrawSize:Rm,getParticipantIdMatchUps:nm,getParticipantIdFinishingPositions:rm,structureActions:function(e){return null!=e&&e.drawDefinition?{actions:[],state:{isComplete:wl(e),hasPlayoffPositionsFilled:Ul(e)}}:{error:Ie}},matchUpActions:Hf,positionActions:ng,getStructureSeedAssignments:Su,getNextUnfilledDrawPositions:function({drawDefinition:e,structureId:t}){if(!e){return{error:Ie,nextUnfilledDrawPositions:[]}}if(!t){return{error:Ge,nextUnfilledDrawPositions:[]}}const{structure:n,error:r}=_c({drawDefinition:e,structureId:t});if(r)return{error:r};const i=Au({structure:n}),a=(null==i?void 0:i.positionAssignments)||[],{unfilledPositions:o}=Rl({drawDefinition:e,structureId:t,randomize:!0}),s=a.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));return null!=o&&o.length?{nextUnfilledDrawPositions:o}:{nextUnfilledDrawPositions:s}},getExitProfiles:function({drawDefinition:e}){if("object"!=typeof e)return{error:ge};const t={},{structures:n=[],links:r=[]}=e||{},i=n.reduce(((e,t)=>{const{stage:n}=t;return e[n]?e[n].push(t):e[n]=[t],e}),{});for(const o of Object.keys(i)){const e=i[o].find((({stageSequence:e})=>1===e)),{structureId:n}=e;a(t,"0",o,n,0)}return{exitProfiles:t};function a(e,t,i,o,s){e[o]||(e[o]=[]),"0"===t&&[Fo,_o].includes(i)||e[o].push(t);const c=r.filter((e=>e.source.structureId===o&&e.source.roundNumber>=s));for(const r of c){const i=r.source.roundNumber,o=r.target.roundNumber,s=r.target.structureId;a(e,`${t}-${i}`,n.find((e=>e.structureId===s)).stage,s,o)}}},getMatchUpContextIds:function({matchUps:e,matchUpId:t}){if(!Array.isArray(e))return{error:jn};const n=e.find((e=>e.matchUpId===t)),{drawId:r,eventId:i,structureId:a,tournamentId:o}=n||{};return{matchUpId:t,drawId:r,eventId:i,structureId:a,tournamentId:o}},getMatchUpParticipantIds:Tu,getMatchUpScheduleDetails:Ea,generateTieMatchUpScore:Ra,matchUpDuration:Ci,credits:Ff};const mg={addDrawEntry:qm,addDrawEntries:Hm,assignSeed:Xm,removeEntry:function({participantId:e,drawDefinition:t,autoEntryPositions:n=!0}){return t?e?sv({drawDefinition:t}).includes(e)?{error:an}:(null!=t&&t.entries&&(t.entries=t.entries.filter((t=>t.participantId!==e))),n&&(t.entries=Gm({entries:t.entries})),Nc({drawDefinition:t}),{...de}):{error:Yt}:{error:Ie}},setStageDrawSize:Jh,setStageAlternatesCount:function({drawDefinition:e,stage:t,alternatesCount:n}){return e?hu({drawDefinition:e,stage:t})?($c({drawDefinition:e,attributes:[{[t]:{alternates:n}}]}),n||(e.entries=(null===(r=e.entries)||void 0===r?void 0:r.filter((e=>e.entryStatus!==Zc)))||[]),Nc({drawDefinition:e}),{...de}):{error:Xe}:{error:Ie};var r},setStageWildcardsCount:function({drawDefinition:e,stage:t,wildcardsCount:n=0}){if(!e)return{error:Ie};if(!hu({drawDefinition:e,stage:t}))return{error:Xe};const r=vu({drawDefinition:e,stage:t}),i=gu({drawDefinition:e,stage:t}),a=wu({drawDefinition:e,stage:t}),o=bu({drawDefinition:e,stage:t});return n<a?{error:"Number of Wildcards cannot be less than number of Wildcards already entered"}:o+n+i>r?{error:"Total stage Entries cannot be greater than drawPositions"}:($c({drawDefinition:e,attributes:[{[t]:{wildcardsCount:n}}]}),Nc({drawDefinition:e}),{...de})},setStageQualifiersCount:function({drawDefinition:e,stage:t,qualifiersCount:n=0}){if(!e)return{error:Ie};if(!hu({drawDefinition:e,stage:t}))return{error:Xe};if(t!==Lo)return{error:"qualifiersCount can only be set for main stage"};const r=vu({drawDefinition:e,stage:t}),i=wu({drawDefinition:e,stage:t});return bu({drawDefinition:e,stage:t})+i+n>r?{error:"Total stage Entries cannot be greater than drawPositions"}:($c({drawDefinition:e,attributes:[{[t]:{qualifiersCount:n}}]}),Nc({drawDefinition:e}),{...de})},modifySeedAssignment:Sv};const hg={generateQualifyingLink:function({qualifyingStructureId:e,mainStructureId:t,qualifyingRound:n,mainEntryRound:r=1,drawDefinition:i}){if(!i)return{error:Ie};const a={linkType:Zo,source:{roundNumber:n,structureId:e},target:{feedProfile:zo,roundNumber:r,structureId:t}};i.links.push(a),Nc({drawDefinition:i})}};let vg,gg=[];const Ig=function(){const e={getState:({convertExtensions:e,removeExtensions:t}={})=>({drawDefinition:Gr(vg,e,!1,t)}),version:()=>"0.51.1",reset:()=>(vg=void 0,de),newDrawDefinition:({drawId:e,drawType:t}={})=>(vg=nv({drawId:e,drawType:t}),Object.assign({drawId:vg.drawId,drawDefinition:Gr(vg)},de)),setDrawDescription:({description:e}={})=>vg?(vg.description=e,Nc({drawDefinition:vg}),Object.assign({drawId:vg.drawId},de)):{error:Ie}};return[hg,fg,Oo,mg,pg,lg,ug,sg].forEach((n=>{Object.keys(n).forEach((r=>{e[r]=e=>{if(Xn())return t({params:e,governor:n,governorMethod:r});try{return t({params:e,governor:n,governorMethod:r})}catch(i){console.log("%c ERROR","color: orange",{err:i})}}}))})),e.devContext=t=>(er(t),e),e.setParticipants=(t=[])=>(gg=t,e),e.setState=(t,n,r)=>{tr(n,r);return function(t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,vg=t,e.drawId=t.drawId),e}(tv(t))},e;function t({params:t,governor:n,governorMethod:r}){var i,a;delete e.success,delete e.error;const o=(null===(i=t)||void 0===i?void 0:i.rollbackOnError)&&Gr(vg,!1,!0);t={...t,tournamentParticipants:gg,drawDefinition:vg};const s=n[r](t);if(null!=s&&s.error)return o&&tv(o),{...s,rolledBack:!!o};const c=(null==s?void 0:s.success)&&!0!==(null===(a=t)||void 0===a?void 0:a.delayNotify);return c&&Op(),!c&&null!=s&&s.success||ir(),s}}();function yg({scoreString:e,tiebreakTo:t=7}){return e.split(" ").filter(Boolean).map(((e,n)=>function({set:e,setNumber:n}){const r=(null==e?void 0:e.startsWith("["))&&e.split("[")[1].split("]")[0].split("-").map((e=>parseInt(e))),i=e.includes("(")?e.split("(")[0]:e.includes("[")?e.split("[")[0]:e,a=!r&&i.split("-").map((e=>parseInt(e))),o=a[0]>a[1]?1:a[0]<a[1]?2:void 0,s=e.includes("(")&&e.split("(")[1].split(")")[0],c=![!1,void 0].includes(s)&&_a({isSide1:2===o,lowValue:s,tiebreakTo:t})||[],[u,d]=a||[],[l,p]=r||c||[];return{side1Score:u,side2Score:d,side1TiebreakScore:l,side2TiebreakScore:p,winningSide:o,setNumber:n}}({set:e,setNumber:n+1})))}function bg({scoreString:e,winningSide:t,matchUpStatus:n}){if(!e)return{outcome:{...nl,winningSide:t,matchUpStatus:n}};if(t&&![1,2,void 0].includes(t))return{error:jn,winningSide:t};const r=e&&yg({scoreString:e}),i={},a=Ao({sets:r}),o=Ao({sets:r,reversed:!0});return 2===t?(i.scoreStringSide1=o,i.scoreStringSide2=a):(i.scoreStringSide1=a,i.scoreStringSide2=o),i.sets=yg({scoreString:i.scoreStringSide1}),{outcome:{matchUpStatus:n,winningSide:t,score:i}}}var wg=[{AL:"Alabama"},{AK:"Alaska"},{AZ:"Arizona"},{AR:"Arkansas"},{CA:"California"},{CO:"Colorado"},{CT:"Connecticut"},{DE:"Delaware"},{DC:"District of Columbia"},{FL:"Florida"},{GA:"Georgia"},{HI:"Hawaii"},{ID:"Idaho"},{IL:"Illinois"},{IN:"Indiana"},{IA:"Iowa"},{KS:"Kansas"},{KY:"Kentucky"},{LA:"Louisiana"},{ME:"Maine"},{MD:"Maryland"},{MA:"Massachusetts"},{MI:"Michigan"},{MN:"Minnesota"},{MS:"Mississippi"},{MO:"Missouri"},{MT:"Montana"},{NE:"Nebraska"},{NV:"Nevada"},{NH:"New Hampshire"},{NJ:"New Jersey"},{NM:"New Mexico"},{NY:"New York"},{NC:"North Carolina"},{ND:"North Dakota"},{OH:"Ohio"},{OK:"Oklahoma"},{OR:"Oregon"},{PA:"Pennsylvania"},{RI:"Rhode Island"},{SC:"South Carolina"},{SD:"South Dakota"},{TN:"Tennessee"},{TX:"Texas"},{UT:"Utah"},{VT:"Vermont"},{VA:"Virginia"},{WA:"Washington"},{WV:"West Virginia"},{WI:"Wisconsin"},{WY:"Wyoming"},{PR:"Puerto Rico"}],Ug=["Adairsville","Ashburn","Ashland","Audubon Park","Aurora","Aurora","Bay Minette","Bayville","Bean Station","Becket","Belle Isle","Bellmead","Belville","Benld","Benton","Boaz","Bolivar","Bossier City","Bremen","Brent","Brentwood","Brownsville","Burns","Cairo","Caledonia","Cambridge","Canutillo","Central Garage","Centralia","Cherry Valley","Chester Center","Chesterfield","Cibecue","Cohoe","Collinsville","Columbus","Corcoran","Cuba","Dolgeville","Douglas","Druid Hills","Dyker Heights","Eagar","East Dubuque","East Valley","Edgefield","Eliot","Elizabeth","Elmsford","Emerald Isle","Emory","Estero","Fairmount","Falcon Heights","Falmouth","Fillmore","Flower Hill","Fobes Hill","Fort Valley","Franklin","Freeport","Gardnertown","Gates Mills","Glasgow Village","Goldsboro","Grant-Valkaria","Greenfield","Gretna","Guilford Siding","Hampton Falls","Harrisonville","Hart","Haskins","Hebron","Hennepin","Highgrove","Homerville","Homewood","Hooksett","Inwood","Island Lake","Issaquah","Jasper","Jefferson","Jewell","Kaukauna","Kings Grant","Kingston","Kirkland","Kokomo","Koloa","La Center","LaBelle","Lake Placid","Lake Waccamaw","Laughlin","LaVerkin","Leadville North","Leland","Long Creek","Longmeadow","Luttrell","Magnolia","Malvern","Mar-Mac","Marana","Marble Falls","Martin","Martindale","Martinsburg","Mazomanie","Mechanicsville","Mexico Beach","Middletown","Mobile","Moravian Falls","Morehead","Mount Hermon","Mulberry","Munhall","Nettleton","Newton","North Granby","North Highlands","Northern Cambria","Northwest Harwinton","Nurillo","Oasis","Orlando","Osceola","Otis","Pacolet","Palm Beach Gardens","Paoli","Patton Village","Paw Paw Lake","Pearl River","Pine Bluffs","Pine","Pioneer","Port Hadlock-Irondale","Porter","Potsdam","Price","Princess Anne","Princeville","Red Oak","Richfield","Ridge Wood Heights","Ringwood","Robinwood","Rochester","Rockland","Rockwell City","Roland","Rolling Hills","Ruskin","Saint Anthony","Saint Robert","Salisbury","Sauk Rapids","Sayreville Junction","Sedona","Shawnee","Shenandoah","Silver Lake","South Waverly","Southwest Ranches","Southwick","Spring Green","Spring Valley","Spry","Strawberry Point","Terryville","Texico","Thomson","Tonganoxie","Townsend","Trinity","Union City","Van Buren","Verona Walk","Villa Rica","Warrenton","Warroad","Washington, D.C.","Weaverville","Wescosville","West Clarkston-Highland","West Orange","Williamsport","Windsor","Winnsboro","Woodbridge","Woodmoor","Wyoming","Young America (historical)","Zeeland"];var Sg=[{firstName:"Novak",lastName:"Djokovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Rafael",lastName:"Nadal",sex:"MALE",nationalityCode:"ESP"},{firstName:"Dominic",lastName:"Thiem",sex:"MALE",nationalityCode:"AUT"},{firstName:"Roger",lastName:"Federer",sex:"MALE",nationalityCode:"SUI"},{firstName:"Stefanos",lastName:"Tsitsipas",sex:"MALE",nationalityCode:"GRE"},{firstName:"Daniil",lastName:"Medvedev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Alexander",lastName:"Zverev",sex:"MALE",nationalityCode:"GER"},{firstName:"Andrey",lastName:"Rublev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Diego",lastName:"Schwartzman",sex:"MALE",nationalityCode:"ARG"},{firstName:"Matteo",lastName:"Berrettini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Gael",lastName:"Monfils",sex:"MALE",nationalityCode:"FRA"},{firstName:"Denis",lastName:"Shapovalov",sex:"MALE",nationalityCode:"CAN"},{firstName:"Roberto",lastName:"Bautista Agut",sex:"MALE",nationalityCode:"ESP"},{firstName:"David",lastName:"Goffin",sex:"MALE",nationalityCode:"BEL"},{firstName:"Pablo",lastName:"Carreno Busta",sex:"MALE",nationalityCode:"ESP"},{firstName:"Fabio",lastName:"Fognini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Milos",lastName:"Raonic",sex:"MALE",nationalityCode:"CAN"},{firstName:"Karen",lastName:"Khachanov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Stan",lastName:"Wawrinka",sex:"MALE",nationalityCode:"SUI"},{firstName:"Grigor",lastName:"Dimitrov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Felix",lastName:"Auger-Aliassime",sex:"MALE",nationalityCode:"CAN"},{firstName:"Cristian",lastName:"Garin",sex:"MALE",nationalityCode:"CHI"},{firstName:"John",lastName:"Isner",sex:"MALE",nationalityCode:"USA"},{firstName:"Borna",lastName:"Coric",sex:"MALE",nationalityCode:"CRO"},{firstName:"Alex",lastName:"de Minaur",sex:"MALE",nationalityCode:"AUS"},{firstName:"Dusan",lastName:"Lajovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Casper",lastName:"Ruud",sex:"MALE",nationalityCode:"NOR"},{firstName:"Benoit",lastName:"Paire",sex:"MALE",nationalityCode:"FRA"},{firstName:"Taylor",lastName:"Fritz",sex:"MALE",nationalityCode:"USA"},{firstName:"Filip",lastName:"Krajinovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Hubert",lastName:"Hurkacz",sex:"MALE",nationalityCode:"POL"},{firstName:"Ugo",lastName:"Humbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Daniel",lastName:"Evans",sex:"MALE",nationalityCode:"GBR"},{firstName:"Jan-Lennard",lastName:"Struff",sex:"MALE",nationalityCode:"GER"},{firstName:"Reilly",lastName:"Opelka",sex:"MALE",nationalityCode:"USA"},{firstName:"Nikoloz",lastName:"Basilashvili",sex:"MALE",nationalityCode:"GEO"},{firstName:"Kei",lastName:"Nishikori",sex:"MALE",nationalityCode:"JPN"},{firstName:"Guido",lastName:"Pella",sex:"MALE",nationalityCode:"ARG"},{firstName:"Adrian",lastName:"Mannarino",sex:"MALE",nationalityCode:"FRA"},{firstName:"Miomir",lastName:"Kecmanovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Marin",lastName:"Cilic",sex:"MALE",nationalityCode:"CRO"},{firstName:"Lorenzo",lastName:"Sonego",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jannik",lastName:"Sinner",sex:"MALE",nationalityCode:"ITA"},{firstName:"Nick",lastName:"Kyrgios",sex:"MALE",nationalityCode:"AUS"},{firstName:"John",lastName:"Millman",sex:"MALE",nationalityCode:"AUS"},{firstName:"Albert",lastName:"Ramos-Vinolas",sex:"MALE",nationalityCode:"ESP"},{firstName:"Kyle",lastName:"Edmund",sex:"MALE",nationalityCode:"GBR"},{firstName:"Tennys",lastName:"Sandgren",sex:"MALE",nationalityCode:"USA"},{firstName:"Alexander",lastName:"Bublik",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Sam",lastName:"Querrey",sex:"MALE",nationalityCode:"USA"},{firstName:"Yoshihito",lastName:"Nishioka",sex:"MALE",nationalityCode:"JPN"},{firstName:"Marton",lastName:"Fucsovics",sex:"MALE",nationalityCode:"HUN"},{firstName:"Aljaz",lastName:"Bedene",sex:"MALE",nationalityCode:"SLO"},{firstName:"Laslo",lastName:"Djere",sex:"MALE",nationalityCode:"SRB"},{firstName:"Richard",lastName:"Gasquet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pablo",lastName:"Andujar",sex:"MALE",nationalityCode:"ESP"},{firstName:"Jo-Wilfried",lastName:"Tsonga",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gilles",lastName:"Simon",sex:"MALE",nationalityCode:"FRA"},{firstName:"Tommy",lastName:"Paul",sex:"MALE",nationalityCode:"USA"},{firstName:"Jordan",lastName:"Thompson",sex:"MALE",nationalityCode:"AUS"},{firstName:"Fernando",lastName:"Verdasco",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alejandro",lastName:"Davidovich Fokina",sex:"MALE",nationalityCode:"ESP"},{firstName:"Feliciano",lastName:"Lopez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Frances",lastName:"Tiafoe",sex:"MALE",nationalityCode:"USA"},{firstName:"Dominik",lastName:"Koepfer",sex:"MALE",nationalityCode:"GER"},{firstName:"Jiri",lastName:"Vesely",sex:"MALE",nationalityCode:"CZE"},{firstName:"Pablo",lastName:"Cuevas",sex:"MALE",nationalityCode:"URU"},{firstName:"Ricardas",lastName:"Berankis",sex:"MALE",nationalityCode:"LTU"},{firstName:"Lucas",lastName:"Pouille",sex:"MALE",nationalityCode:"FRA"},{firstName:"Cameron",lastName:"Norrie",sex:"MALE",nationalityCode:"GBR"},{firstName:"Steve",lastName:"Johnson",sex:"MALE",nationalityCode:"USA"},{firstName:"Jeremy",lastName:"Chardy",sex:"MALE",nationalityCode:"FRA"},{firstName:"Stefano",lastName:"Travaglia",sex:"MALE",nationalityCode:"ITA"},{firstName:"Corentin",lastName:"Moutet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Juan",lastName:"Ignacio Londero",sex:"MALE",nationalityCode:"ARG"},{firstName:"Federico",lastName:"Delbonis",sex:"MALE",nationalityCode:"ARG"},{firstName:"Marco",lastName:"Cecchinato",sex:"MALE",nationalityCode:"ITA"},{firstName:"Thiago",lastName:"Monteiro",sex:"MALE",nationalityCode:"BRA"},{firstName:"Salvatore",lastName:"Caruso",sex:"MALE",nationalityCode:"ITA"},{firstName:"Lloyd",lastName:"Harris",sex:"MALE",nationalityCode:"RSA"},{firstName:"Vasek",lastName:"Pospisil",sex:"MALE",nationalityCode:"CAN"},{firstName:"Pierre-Hugues",lastName:"Herbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Egor",lastName:"Gerasimov",sex:"MALE",nationalityCode:"BLR"},{firstName:"Joao",lastName:"Sousa",sex:"MALE",nationalityCode:"POR"},{firstName:"Radu",lastName:"Albot",sex:"MALE",nationalityCode:"MDA"},{firstName:"Marcos",lastName:"Giron",sex:"MALE",nationalityCode:"USA"},{firstName:"Mikael",lastName:"Ymer",sex:"MALE",nationalityCode:"SWE"},{firstName:"Attila",lastName:"Balazs",sex:"MALE",nationalityCode:"HUN"},{firstName:"Federico",lastName:"Coria",sex:"MALE",nationalityCode:"ARG"},{firstName:"Soonwoo",lastName:"Kwon",sex:"MALE",nationalityCode:"KOR"},{firstName:"Mikhail",lastName:"Kukushkin",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Dennis",lastName:"Novak",sex:"MALE",nationalityCode:"AUT"},{firstName:"Pedro",lastName:"Martinez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Philipp",lastName:"Kohlschreiber",sex:"MALE",nationalityCode:"GER"},{firstName:"Yannick",lastName:"Hanfmann",sex:"MALE",nationalityCode:"GER"},{firstName:"Gianluca",lastName:"Mager",sex:"MALE",nationalityCode:"ITA"},{firstName:"James",lastName:"Duckworth",sex:"MALE",nationalityCode:"AUS"},{firstName:"Emil",lastName:"Ruusuvuori",sex:"MALE",nationalityCode:"FIN"},{firstName:"Yasutaka",lastName:"Uchiyama",sex:"MALE",nationalityCode:"JPN"},{firstName:"Roberto",lastName:"Carballes Baena",sex:"MALE",nationalityCode:"ESP"},{firstName:"Ashleigh",lastName:"Barty",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Simona",lastName:"Halep",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Naomi",lastName:"Osaka",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Sofia",lastName:"Kenin",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Elina",lastName:"Svitolina",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Karolina",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Bianca",lastName:"Andreescu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Petra",lastName:"Kvitova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Kiki",lastName:"Bertens",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Serena",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aryna",lastName:"Sabalenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Belinda",lastName:"Bencic",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Victoria",lastName:"Azarenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Johanna",lastName:"Konta",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Garbine",lastName:"Muguruza",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Madison",lastName:"Keys",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Iga",lastName:"Swiatek",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Petra",lastName:"Martic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Elena",lastName:"Rybakina",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Marketa",lastName:"Vondrousova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Elise",lastName:"Mertens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Maria",lastName:"Sakkari",sex:"FEMALE",nationalityCode:"GRE"},{firstName:"Anett",lastName:"Kontaveit",sex:"FEMALE",nationalityCode:"EST"},{firstName:"Jennifer",lastName:"Brady",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelique",lastName:"Kerber",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Alison",lastName:"Riske",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Karolina",lastName:"Muchova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Yulia",lastName:"Putintseva",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Dayana",lastName:"Yastremska",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Amanda",lastName:"Anisimova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Ons",lastName:"Jabeur",sex:"FEMALE",nationalityCode:"TUN"},{firstName:"Donna",lastName:"Vekic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Ekaterina",lastName:"Alexandrova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qiang",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Shuai",lastName:"Zhang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Svetlana",lastName:"Kuznetsova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Barbora",lastName:"Strycova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Anastasia",lastName:"Pavlyuchenkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Sloane",lastName:"Stephens",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Magda",lastName:"Linette",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Saisai",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Fiona",lastName:"Ferro",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Caroline",lastName:"Garcia",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Jelena",lastName:"Ostapenko",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Danielle",lastName:"Collins",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Veronika",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Cori",lastName:"Gauff",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Nadia",lastName:"Podoroska",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Kristina",lastName:"Mladenovic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Laura",lastName:"Siegemund",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Marie",lastName:"Bouzkova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Polona",lastName:"Hercog",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Alize",lastName:"Cornet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Anastasija",lastName:"Sevastova",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Rebecca",lastName:"Peterson",sex:"FEMALE",nationalityCode:"SWE"},{firstName:"Patricia",lastName:"Maria Tig",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Jil",lastName:"Teichmann",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Shelby",lastName:"Rogers",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Heather",lastName:"Watson",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Anna",lastName:"Blinkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Bernarda",lastName:"Pera",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Jessica",lastName:"Pegula",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alison",lastName:"Van Uytvanck",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Katerina",lastName:"Siniakova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Sara",lastName:"Sorribes Tormo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Su-Wei",lastName:"Hsieh",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Ajla",lastName:"Tomljanovic",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Kristyna",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Paula",lastName:"Badosa",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Daria",lastName:"Kasatkina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nao",lastName:"Hibino",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Arantxa",lastName:"Rus",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lauren",lastName:"Davis",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Krejcikova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Camila",lastName:"Giorgi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Irina-Camelia",lastName:"Begu",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Danka",lastName:"Kovinic",sex:"FEMALE",nationalityCode:"MNE"},{firstName:"Venus",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Zarina",lastName:"Diyas",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Christina",lastName:"Mchale",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Madison",lastName:"Brengle",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Carla",lastName:"Suarez Navarro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Martina",lastName:"Trevisan",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Kirsten",lastName:"Flipkens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Misaki",lastName:"Doi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Tamara",lastName:"Zidansek",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Sorana",lastName:"Cirstea",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Leylah",lastName:"Fernandez",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Taylor",lastName:"Townsend",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Lin",lastName:"Zhu",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Ana",lastName:"Bogdan",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Aliaksandra",lastName:"Sasnovich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Yafan",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Jasmine",lastName:"Paolini",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Varvara",lastName:"Gracheva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Viktoria",lastName:"Kuzmova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Nina",lastName:"Stojanovic",sex:"FEMALE",nationalityCode:"SRB"},{firstName:"Anastasia",lastName:"Potapova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Andrea",lastName:"Petkovic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kaja",lastName:"Juvan",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Elsa",lastName:"Jacquemot",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Victoria",lastName:"Jimenez Kasintseva",sex:"FEMALE",nationalityCode:"AND"},{firstName:"Alexandra",lastName:"Eala",sex:"FEMALE",nationalityCode:"PHI"},{firstName:"Diane",lastName:"Parry",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Daria",lastName:"Snigur",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Polina",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Robin",lastName:"Montgomery",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alexandra",lastName:"Vecic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kristina",lastName:"Dmitruk",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Alexa",lastName:"Noel",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Kamilla",lastName:"Bartone",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Weronika",lastName:"Baszak",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Oksana",lastName:"Selekhmeteva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Alina",lastName:"Charaeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Maria",lastName:"Bondarenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Priska",lastName:"Madelyn Nugroho",sex:"FEMALE",nationalityCode:"INA"},{firstName:"Linda",lastName:"Fruhvirtova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Dana",lastName:"Guzman",sex:"FEMALE",nationalityCode:"PER"},{firstName:"Linda",lastName:"Noskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Hong",lastName:"Yi Cody Wong",sex:"FEMALE",nationalityCode:"HKG"},{firstName:"Zhuoxuan",lastName:"Bai",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Mell",lastName:"Reasco Gonzalez",sex:"FEMALE",nationalityCode:"ECU"},{firstName:"Matilda",lastName:"Mutavdzic",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Diana",lastName:"Shnaider",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qinwen",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Alexandra",lastName:"Yepifanova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Matilde",lastName:"Paoletti",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Melania",lastName:"Delai",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jana",lastName:"Kolodynska",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Guillermina",lastName:"Grant",sex:"FEMALE",nationalityCode:"URU"},{firstName:"Darja",lastName:"Vidmanova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Melodie",lastName:"Collard",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Elvina",lastName:"Kalieva",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Sofia",lastName:"Costoulas",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Aliona",lastName:"Falei",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Mai",lastName:"Nirundorn",sex:"FEMALE",nationalityCode:"THA"},{firstName:"Elizabeth",lastName:"Coleman",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aubane",lastName:"Droguet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Madison",lastName:"Sieg",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Natsumi",lastName:"Kawaguchi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Leyre",lastName:"Romero Gormaz",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Elina",lastName:"Avanesyan",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Oceane",lastName:"Babel",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ziva",lastName:"Falkner",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Julia",lastName:"Garcia",sex:"FEMALE",nationalityCode:"MEX"},{firstName:"Natalia",lastName:"Szabanin",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Erika",lastName:"Andreeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Celia",lastName:"Belle Mohr",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ane",lastName:"Mintegi Del Olmo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Sebastianna",lastName:"Scilipoti",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Ana",lastName:"Geller",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Dayeon",lastName:"Back",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Selena",lastName:"Janicijevic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Romana",lastName:"Cisovska",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Amarissa",lastName:"Kiara Toth",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Mara",lastName:"Guth",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Evialina",lastName:"Laskevich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Julia",lastName:"Avdeeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Beatrice",lastName:"Ricci",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Eleonora",lastName:"Alvisi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jessica",lastName:"Bouzas Maneiro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Julie",lastName:"Belgraver",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lisa",lastName:"Pigato",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Ya",lastName:"Yi Yang",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Eva",lastName:"Lys",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Talia",lastName:"Gibson",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Yeon",lastName:"Ku",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Katrina",lastName:"Scott",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Palicova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Alina",lastName:"Shcherbinina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Giulia",lastName:"Morlet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tina",lastName:"Nadine Smith",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Sohyun",lastName:"Park",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Tara",lastName:"Wurth",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Polina",lastName:"Iatcenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Lauren",lastName:"Anzalotta Kynoch",sex:"FEMALE",nationalityCode:"PUR"},{firstName:"Savannah",lastName:"Broadus",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelina",lastName:"Wirges",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Amarni",lastName:"Banks",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Hanne",lastName:"Vandewinkel",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Jada",lastName:"Bui",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Sabina",lastName:"Zeynalova",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Pia",lastName:"Lovric",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Erika",lastName:"Matsuda",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Lyubov",lastName:"Kostenko",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Anaelle",lastName:"Leclercq",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Alessandra",lastName:"Simone",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Darja",lastName:"Semenistaja",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Daria",lastName:"Frayman",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nastasja",lastName:"Schunk",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Olivia",lastName:"Gadecki",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"India",lastName:"Houghton",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Maria",lastName:"Sholokhova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Julia",lastName:"Middendorf",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Petra",lastName:"Marcinko",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Radka",lastName:"Zelnickova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Lucie",lastName:"Nguyen Tan",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tatiana",lastName:"Barkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Annabelle",lastName:"Xu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Harold",lastName:"Mayot",sex:"MALE",nationalityCode:"FRA"},{firstName:"Holger",lastName:"Vitus Nodskov Rune",sex:"MALE",nationalityCode:"DEN"},{firstName:"Dominic",lastName:"Stephan Stricker",sex:"MALE",nationalityCode:"SUI"},{firstName:"Shintaro",lastName:"Mochizuki",sex:"MALE",nationalityCode:"JPN"},{firstName:"Arthur",lastName:"Cazaux",sex:"MALE",nationalityCode:"FRA"},{firstName:"Leandro",lastName:"Riedi",sex:"MALE",nationalityCode:"SUI"},{firstName:"Martin",lastName:"Damm",sex:"MALE",nationalityCode:"USA"},{firstName:"Natan",lastName:"Rodrigues",sex:"MALE",nationalityCode:"BRA"},{firstName:"Karlis",lastName:"Ozolins",sex:"MALE",nationalityCode:"LAT"},{firstName:"Luciano",lastName:"Darderi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Hanwen",lastName:"Li",sex:"MALE",nationalityCode:"CHN"},{firstName:"Arthur",lastName:"Fery",sex:"MALE",nationalityCode:"GBR"},{firstName:"Juan",lastName:"Bautista Torres",sex:"MALE",nationalityCode:"ARG"},{firstName:"Khololwam",lastName:"Montsi",sex:"MALE",nationalityCode:"RSA"},{firstName:"Jeffrey",lastName:"Von Der Schulenburg",sex:"MALE",nationalityCode:"SUI"},{firstName:"Timo",lastName:"Legout",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gustavo",lastName:"Heide",sex:"MALE",nationalityCode:"BRA"},{firstName:"Flavio",lastName:"Cobolli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Guy",lastName:"Den Ouden",sex:"MALE",nationalityCode:"NED"},{firstName:"Martin",lastName:"Breysach",sex:"MALE",nationalityCode:"FRA"},{firstName:"Toby",lastName:"Kodat",sex:"MALE",nationalityCode:"USA"},{firstName:"Lilian",lastName:"Marmousez",sex:"MALE",nationalityCode:"FRA"},{firstName:"Roman",lastName:"Andres Burruchaga",sex:"MALE",nationalityCode:"ARG"},{firstName:"Alex",lastName:"Barrena",sex:"MALE",nationalityCode:"ARG"},{firstName:"Dalibor",lastName:"Svrcina",sex:"MALE",nationalityCode:"CZE"},{firstName:"Martin",lastName:"Krumich",sex:"MALE",nationalityCode:"CZE"},{firstName:"Peter",lastName:"Fajta",sex:"MALE",nationalityCode:"HUN"},{firstName:"Lukas",lastName:"Neumayer",sex:"MALE",nationalityCode:"AUT"},{firstName:"Raphael",lastName:"Collignon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Dali",lastName:"Blanch",sex:"MALE",nationalityCode:"USA"},{firstName:"Terence",lastName:"Atmane",sex:"MALE",nationalityCode:"FRA"},{firstName:"Felix",lastName:"Gill",sex:"MALE",nationalityCode:"GBR"},{firstName:"Eliakim",lastName:"Coulibaly",sex:"MALE",nationalityCode:"CIV"},{firstName:"Hamad",lastName:"Medjedovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Jerome",lastName:"Kym",sex:"MALE",nationalityCode:"SUI"},{firstName:"Nicholas",lastName:"David Ionel",sex:"MALE",nationalityCode:"ROU"},{firstName:"Shunsuke",lastName:"Mitsui",sex:"MALE",nationalityCode:"JPN"},{firstName:"Giovanni",lastName:"Mpetshi Perricard",sex:"MALE",nationalityCode:"FRA"},{firstName:"Bu",lastName:"Yunchaokete",sex:"MALE",nationalityCode:"CHN"},{firstName:"Jack",lastName:"Pinnington Jones",sex:"MALE",nationalityCode:"GBR"},{firstName:"Alexander",lastName:"Hoogmartens",sex:"MALE",nationalityCode:"BEL"},{firstName:"Bruno",lastName:"Oliveira",sex:"MALE",nationalityCode:"BRA"},{firstName:"Maks",lastName:"Kasnikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Mikolaj",lastName:"Lorens",sex:"MALE",nationalityCode:"POL"},{firstName:"Chak",lastName:"Lam Coleman Wong",sex:"MALE",nationalityCode:"HKG"},{firstName:"Egor",lastName:"Agafonov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Mans",lastName:"Dahlberg",sex:"MALE",nationalityCode:"SWE"},{firstName:"Marat",lastName:"Sharipov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Luca",lastName:"Nardi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Sean",lastName:"Cuenin",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pedro",lastName:"Boscardin Dias",sex:"MALE",nationalityCode:"BRA"},{firstName:"Samuel",lastName:"Vincent Ruggeri",sex:"MALE",nationalityCode:"ITA"},{firstName:"Bruno",lastName:"Kuzuhara",sex:"MALE",nationalityCode:"USA"},{firstName:"Romain",lastName:"Faucon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Elmer",lastName:"Moller",sex:"MALE",nationalityCode:"DEN"},{firstName:"Mario",lastName:"Mansilla Diez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Leonardo",lastName:"Malgaroli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Pierre",lastName:"Yves Bailly",sex:"MALE",nationalityCode:"BEL"},{firstName:"Sebastian",lastName:"Gima",sex:"MALE",nationalityCode:"ROU"},{firstName:"Ilya",lastName:"Snitari",sex:"MALE",nationalityCode:"MDA"},{firstName:"Diego",lastName:"Augusto Barreto Sanchez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alexander",lastName:"Bernard",sex:"MALE",nationalityCode:"USA"},{firstName:"Pengyu",lastName:"Lu",sex:"MALE",nationalityCode:"CHN"},{firstName:"Max",lastName:"Wiskandt",sex:"MALE",nationalityCode:"GER"},{firstName:"Max",lastName:"Westphal",sex:"MALE",nationalityCode:"FRA"},{firstName:"Lorenzo",lastName:"Claverie",sex:"MALE",nationalityCode:"VEN"},{firstName:"Axel",lastName:"Garcian",sex:"MALE",nationalityCode:"FRA"},{firstName:"Aleksander",lastName:"Orlikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Maxwell",lastName:"Mckennon",sex:"MALE",nationalityCode:"USA"},{firstName:"Rafael",lastName:"Alfonso De Alba Valdes",sex:"MALE",nationalityCode:"MEX"},{firstName:"Dev",lastName:"Javia",sex:"MALE",nationalityCode:"IND"},{firstName:"Kokoro",lastName:"Isomura",sex:"MALE",nationalityCode:"JPN"},{firstName:"Matteo",lastName:"Gigante",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jack",lastName:"Anthrop",sex:"MALE",nationalityCode:"USA"},{firstName:"Pablo",lastName:"Llamas Ruiz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Biagio",lastName:"Gramaticopolo",sex:"MALE",nationalityCode:"ITA"},{firstName:"Patorn",lastName:"Hanchaikul",sex:"MALE",nationalityCode:"THA"},{firstName:"Marko",lastName:"Topo",sex:"MALE",nationalityCode:"SRB"},{firstName:"Carlos",lastName:"Alcaraz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Juncheng",lastName:"Shang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Toby",lastName:"Samuel",sex:"MALE",nationalityCode:"GBR"},{firstName:"Petr",lastName:"Nesterov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Mehdi",lastName:"Sadaoui",sex:"MALE",nationalityCode:"FRA"},{firstName:"Max",lastName:"Alcala Gurri",sex:"MALE",nationalityCode:"ESP"},{firstName:"Nikita",lastName:"Kashirin",sex:"MALE",nationalityCode:"RUS"},{firstName:"Aidan",lastName:"Mayo",sex:"MALE",nationalityCode:"USA"},{firstName:"Yu",lastName:"Zhang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Philip",lastName:"Sekulic",sex:"MALE",nationalityCode:"AUS"},{firstName:"Lorenzo",lastName:"Rottoli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Michal",lastName:"Novansky",sex:"MALE",nationalityCode:"SVK"},{firstName:"Maikel",lastName:"De Boes",sex:"MALE",nationalityCode:"BEL"},{firstName:"Chen",lastName:"Dong",sex:"MALE",nationalityCode:"AUS"},{firstName:"Evgeny",lastName:"Philippov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Damien",lastName:"Salvestre",sex:"MALE",nationalityCode:"FRA"},{firstName:"Francesco",lastName:"Maestrelli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Viacheslav",lastName:"Bielinskyi",sex:"MALE",nationalityCode:"UKR"},{firstName:"Jean",lastName:"Marc Malkowski",sex:"MALE",nationalityCode:"SUI"},{firstName:"Santiago",lastName:"De La Fuente",sex:"MALE",nationalityCode:"ARG"},{firstName:"Simeon",lastName:"Terziev",sex:"MALE",nationalityCode:"BUL"},{firstName:"Benjamin",lastName:"Kittay",sex:"MALE",nationalityCode:"USA"}];var Dg=["Avengers","Predators","Dynamos","Warriors","Captivators","Dragons","Explosive Win Machine","Pirates","Hawk Eyes","Killer Instinct","Masters of Mayhem","Matter Catchers","Mindspace Invaders","Goal Gurus","Raiders","Seekers","Sparkle Soul Tribe","The Achievers","The Blazers","The Breezers","The Bruisers","The Civil Disobedients","The Eliminators","The Mavericks","The Mean Machines","The Punters","The Sandeaters","The Visual Spectacle","Total Demolition","Touch and Go","Vertically Challenged","Win Machines","Wind Chasers","Worker Bees","Razorbacks","Rebels","Fighting Crusaders","Comets","Commodores","Green Machine","Continentals"];function Ng({count:e=1}={}){return{teams:X(Dg).slice(0,e)}}function Pg({valuesInstanceLimit:e,nationalityCodesCount:t,nationalityCodeType:n,nationalityCodes:r,participantsCount:i=32,participantType:a,personIds:o,uuids:s,personExtensions:c,addressProps:u,matchUpType:d,personData:l,sex:p,inContext:f}){const m=a===La||d===da,h=a===xa||d===xa,v=i*(m?2:h?8:1),{persons:g,error:I}=function({personExtensions:e,personData:t,count:n=1,sex:r}={}){if(isNaN(n))return{error:jn};let i=Sg.filter((e=>!r||e.sex===r));if(Array.isArray(t)){const e=t.filter((e=>"string"==typeof e.firstName&&"string"==typeof e.lastName&&!![ym,bm].includes(e.sex)&&!("string"!=typeof e.nationalityCode||e.nationalityCode.length>3)));if(!e.length)return{error:jn};i=e}const a=X(i);if(a.length<n){const{maleFirstNames:e,maleLastNames:t,femaleFirstNames:i,femaleLastNames:o,nationalityCodes:s}=Sg.reduce(((e,t)=>{const{firstName:n,lastName:r,nationalityCode:i}=t;return t.sex===ym?(e.maleFirstNames.includes(n)||e.maleFirstNames.push(n),e.maleLastNames.includes(r)||e.maleLastNames.push(r)):(e.femaleFirstNames.includes(n)||e.femaleFirstNames.push(n),e.femaleLastNames.includes(r)||e.femaleLastNames.push(r)),e.nationalityCodes.includes(i)||e.nationalityCodes.push(i),e}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});ie(0,n-a.length).forEach((()=>{const n=r||re([ym,bm]),c=re(s),u={firstName:re(n===ym?e:i),lastName:re(n===ym?t:o),sex:n,nationalityCode:c};a.push(u)}))}const o=a.slice(0,n).map(((t,n)=>Object.assign(t,{extensions:e||[{name:"regionCode",value:n+1}],isMock:!0})));return{persons:o.length&&o||a[0]}}({count:v,personExtensions:c,personData:l,sex:p});if(I)return{error:I};const y=xo.filter((e=>"ISO"===n?e.iso:e.ioc)),{citiesCount:b,statesCount:w,postalCodesCount:U}=u||{};const{cities:S}=function({count:e=1,participantsCount:t=32}={}){const n=X(Ug),r=n.slice(0,e);return{cities:ie(0,t).map((t=>t<Math.min(e,n.length)?r[t]:re(r)))}}({count:b||v,participantsCount:v}),{states:D}=function({count:e=1,participantsCount:t=32}={}){const n=X(wg),r=n.slice(0,e).map((e=>Object.keys(e))).flat();return{states:ie(0,t).map((t=>t<Math.min(e,n.length)?r[t]:re(r)))}}({count:w||v,participantsCount:v}),{postalCodes:N}=function({count:e=1,participantsCount:t=32}={}){const n=ie(0,e).map((()=>ie(0,5).map((()=>Y(0,9))).join("")));return{postalCodes:ie(0,t).map((t=>t<e?n[t]:re(n)))}}({count:U||v,participantsCount:v}),P={cities:S,states:D,postalCodes:N},A=function(t){const n=Math.ceil(v/t);return e&&n>e?Math.ceil(v/e):t}(t),M=A?X(y).slice(0,t):r?y.filter((e=>r.includes(e.key))):y,T=X(ie(0,Math.ceil(v/(A||1))).map((()=>M)).flat(1/0));return{participants:ie(0,i).map((e=>{const t=m?2:h?8:1,n=ie(0,t).map((n=>function(e){const t=g[e],{sex:n,firstName:r,lastName:i,extensions:a,nationalityCode:c}=t||{},u=r||"GivenName",d=i||"FamilyName",l=`${u} ${d}`,p=T[e],f=p&&(p.ioc||p.iso)||c;null==T||!T.length||f||c||console.log("%c Invalid Nationality Code",{participantIndex:e,country:p});const m=function(e){const{cities:t,states:n,postalCodes:r,nationalityCode:i,participantIndex:a}=e;return{city:t&&t[a],state:n&&n[a],postalCode:r&&r[a],countryCode:i}}({...P,participantIndex:e,nationalityCode:f});return{participantId:(null==s?void 0:s.pop())||Wr(),participantType:Oa,participantRole:bf,participantName:l,person:{addresses:[m],personId:(null==o?void 0:o.length)&&o[e]||Wr(),standardFamilyName:d,standardGivenName:u,nationalityCode:f,extensions:a,sex:n}}}(e*t+n))),r=n.map((e=>e.participantId)),i=n.map((e=>e.person.standardFamilyName)).join("/"),a={participantId:(null==s?void 0:s.pop())||Wr(),participantType:m?La:xa,participantRole:bf,participantName:m?i:Ng().teams[0],individualParticipantIds:r};return f&&(a.individualParticipants=n),m||h?[a,...n]:n})).flat()}}const Ag={[O]:2,[P]:1,[E]:1,[N]:4};function Mg({matchUpFormat:e="SET3-S:6/TB7",matchUpStatusProfile:t=Ag,pointsPerMinute:n=1,sideWeight:r=4,winningSide:i,defaultWithScorePercent:a=2}){if(!g(e))return{error:st};if("object"!=typeof t)return{error:jn};if(a>100&&(a=100),isNaN(a)||isNaN(n)||isNaN(r))return{error:jn};const o=Object.keys(t).filter((e=>Object.keys(G).includes(e)&&e!==S));if(Object.keys(o).reduce(((e,n)=>e+t[n]),0)>100)return{error:jn,matchUpStatusProfile:t};const s=o.reduce(((e,n)=>(e.pointer=e.pointer+t[n],e.valueMap.push([e.pointer,n]),e)),{pointer:0,valueMap:[]}),c=Y(1,100),u=(s.valueMap.find((e=>c<=e[0]))||[100,S])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([O,N].includes(u)){const e={score:d,winningSide:i=i||Y(1,2),matchUpStatus:u};if(!(u===N&&Y(1,100)>100-a))return{outcome:e}}else if(u===P)return{outcome:{score:d,matchUpStatus:u}};const p=l(e),{bestOf:f,setFormat:m,finalSetFormat:h}=p,v=[],I=Y(0,1),y=i?[i-1]:[...ie(0,r).map((()=>I)),1-I],b=[E,N,M,C].includes(u)&&(ne(ie(1,f))||1);let w;for(const l of ie(1,f+1)){const t=l===f,{set:r,incomplete:i,winningSideNumber:a}=Tg({incomplete:b===l,matchUpStatus:u,pointsPerMinute:n,setFormat:t&&h||m,setNumber:l,weightedRange:y});if(v.push(r),i){w=a;break}if(Ro({matchUp:{score:{sets:v},matchUpFormat:e}}).calculatedWinningSide)break}const U=Ro({matchUp:{score:{sets:v},matchUpFormat:e}}),D=w?i||w:U.calculatedWinningSide,{score:A}=ql({score:{sets:v},winningSide:D,matchUpStatus:u});return{outcome:{score:A,winningSide:D,matchUpStatus:u}}}function Tg({weightedRange:e=[0,1],pointsPerMinute:t,matchUpStatus:n,incomplete:r,setFormat:i,setNumber:a}){const o={setNumber:a},{setTo:s,tiebreakFormat:c,tiebreakAt:u,tiebreakSet:d,timed:l,minutes:p}=i,f=Y(0,e.length-1),m=e[f];let h;if(l){const i=p*t,a=Math.round(.2*i),s=i+ne([1,-1])*a,c=function(e=1,t=3,n=!0){let r=0;for(let i=0;i<t;i++)r+=Math.random()*(e/t);return n&&e>1?Math.round(r):r}(s,2),u=[c,s-c];m&&u.reverse(),h=e[f]+1;let d=u[0]>u[1]?1:u[1]>u[0]?2:0;if(r){const[e,t]=u;return Object.assign(o,{side1Score:e,side2Score:t}),j.includes(n)?{set:o,incomplete:r,winningSideNumber:h}:{set:o,incomplete:r}}d||(u[Y(0,1)]+=1),d=u[0]>u[1]?1:2,d!==h&&u.reverse();const[l,v]=u;return Object.assign(o,{side1Score:l,side2Score:v,winningSide:h}),{set:o}}if(r)return o.side1Score=Y(0,u),o.side2Score=Y(0,u),j.includes(n)&&(h=e[f]+1),{set:o,incomplete:r,winningSideNumber:h};{const t=ie(1,s+1).map((e=>ie(0,s+2-e).map((()=>e)))).flat(),n=t[Y(0,t.length-1)],r=s&&ja({isSide1:!0,tiebreakAt:u,lowValue:n,setTo:s}),a=!r,l=1===e.length&&e[f]+1;if(!a){if(l){(r[0]>r[1]?1:2)!==l&&r.reverse()}else m&&r.reverse();const[e,t]=r;Object.assign(o,{side1Score:e,side2Score:t})}const p=Co({matchUpScoringFormat:{setFormat:i},setObject:o});let h;if(p.hasTiebreakCondition||a){const{NoAD:e,tiebreakTo:t}=c||d,n=ie(1,t+1).map((e=>ie(0,t+2-e).map((()=>e)))).flat(),r=n[Y(0,n.length-1)];let i=_a({isSide1:!0,lowValue:r,tiebreakTo:t,tiebreakNoAd:e});if(a){const e=i[0]>i[1]?1:2;l?e!==l&&i.reverse():m&&i.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=i,h=i[0]>i[1]?1:2}else 2===p.leadingSide?[o.side1TiebreakScore,o.side2TiebreakScore]=i:[o.side2TiebreakScore,o.side1TiebreakScore]=i}o.winningSide=p.winningSide||p.leadingSide||l||h}return{set:o}}function Eg({matchUpFormat:e,drawDefinition:t,randomWinningSide:n,completeAllMatchUps:r,matchUpStatusProfile:i,event:a}){const o=t.structures.slice().sort(jc),s="string"==typeof r&&r,c=s&&S;for(const u of o){const r=kc({drawDefinition:t}),{matchUps:o}=Ou({inContext:!0,drawDefinition:t,matchUpsMap:r,structure:u,event:a}),d=o.filter((({winningSide:e})=>!e)).sort(Gd).map(Oc);for(const l of d){const{matchUps:o}=Ou({inContext:!0,drawDefinition:t,matchUpsMap:r,structure:u,event:a}),d=o.find((e=>e.matchUpId===l)),p=d.matchUpStatus===P;if(null!=d&&d.readyToScore&&!p){const r=Rg({drawDefinition:t,targetMatchUp:d,matchUpFormat:e,winningSide:!n&&1,matchUpStatus:c,scoreString:s,matchUpStatusProfile:i});if(r.error)return r}}}return{...de}}function Cg({drawDefinition:e,targetMatchUp:t,matchUpStatus:n,matchUpFormat:r,scoreString:i,winningSide:a}){if(!t||t.matchUpStatus===w)return;const{matchUpId:o}=t||{},{outcome:s}=bg({scoreString:i,winningSide:a,matchUpStatus:n});return Hl({drawDefinition:e,matchUpFormat:r,matchUpId:o,outcome:s})}function Rg(e){const{targetMatchUp:t,scoreString:n,winningSide:r,matchUpStatus:i,matchUpFormat:a,drawDefinition:o,matchUpStatusProfile:s={}}=e;if(n||i)return Cg(e);const{matchUpId:c}=t||{},{outcome:u}=Mg({matchUpFormat:a,winningSide:r,matchUpStatusProfile:s});return Hl({drawDefinition:o,matchUpId:c,outcome:u,matchUpFormat:a})}function Og({allUniqueParticipantIds:e,matchUpStatusProfile:t,participantsProfile:n,completeAllMatchUps:r,autoEntryPositions:i,randomWinningSide:a,tournamentRecord:o,eventProfile:s,startDate:c,uuids:u}){let d=s.gender;const{eventName:l="Generated Event",eventType:p=Pa,policyDefinitions:f,drawProfiles:m=[],eventExtensions:h,surfaceCategory:v,discipline:g,eventLevel:I,ballType:y,category:b}=s,w=s.tieFormat||p===Ma&&iv();let U=o.participants,S=[];for(const q of m)!d&&q.gender&&(d=null==q?void 0:q.gender);let D={};const N=m.reduce(((e,t)=>{const{qualifyingPositions:n=0,participantsCount:r=0,uniqueParticipants:i,stage:a=Lo,drawSize:o=0}=t||{};Object.keys(e).includes(a)||(e[a]=0);const s=r||o-n;return i||d?(Object.keys(D).includes(a)||(D[a]=0),D[a]+=s):e[a]=Math.max(s,e[a]),e}),{}),P=Object.keys(D);P.forEach((e=>N[e]+=D[e]));const A=p===Pa?Oa:p===Aa?La:p,M=[];if(P){const{valuesInstanceLimit:e,nationalityCodesCount:t,nationalityCodeType:r,nationalityCodes:i,addressProps:a,personIds:s,inContext:c}=n||{},l=D[Lo]||0,p=D[ko]||0,{participants:f}=Pg({participantsCount:l+p,participantType:A,sex:d,uuids:u,valuesInstanceLimit:e,nationalityCodesCount:t,nationalityCodeType:r,nationalityCodes:i,addressProps:a,personIds:s,inContext:c});let m=cp({tournamentRecord:o,participants:f});if(m.error)return m;S=f.filter((({participantType:e})=>e===A)),f.forEach((({participantId:e})=>M.push(e)))}const T=N[Lo]||0,E=N[ko]||0,C={QUALIFYING:U.filter((({participantType:e})=>e===A)).filter((({participantId:t})=>!e.includes(t))).slice(0,E),MAIN:U.filter((({participantType:e})=>e===A)).filter((({participantId:t})=>!e.includes(t))).slice(E,E+T)};let{eventAttributes:R}=s;"object"!=typeof R&&(R={});const O=s.eventId||Wr(),x={...R,surfaceCategory:v,discipline:g,eventLevel:I,eventName:l,eventType:p,tieFormat:w,ballType:y,category:b,eventId:O,gender:d};if(null!=h&&h.length&&Array.isArray(h)){const e=h.filter(Gc);null!=e&&e.length&&Object.assign(x,{extensions:e})}if("object"==typeof f)for(const q of Object.keys(f))Lf({event:x,policyDefinitions:{[q]:f[q]}});let L=Fm({tournamentRecord:o,event:x});if(L.error)return L;const{event:k}=L;let F=0;for(const q of m){const{drawType:e=is,qualifyingPositions:t=0,uniqueParticipants:n,stage:r=Lo,drawSize:a=0,drawName:s,drawId:c}=q,u=a-t,l=n?S.slice(F,u):C[r||Lo]||[];(n||d)&&(F+=u);const p=l.slice(0,u).map(Cc);if(p.length){const e=$m({participantIds:p,autoEntryPositions:i,tournamentRecord:o,stage:r,event:k});if(e.error)return e}const f=Kv({drawName:s||e,qualifyingPositions:t,drawEntries:p.map((e=>({entryStatus:tu,entryStage:r,participantId:e}))),drawId:c,event:k,stage:r});if(f.error)return f}const j=[],{flightProfile:_}=tl({event:k});if(Array.isArray(null==_?void 0:_.flights))for(const[q,H]of _.flights.entries()){const{drawId:e,stage:n,drawName:i,drawEntries:s}=H;j.push(H.drawId);const u=m[q],{seedsCount:d,generate:f=!0}=u||{};if(f){var B,G,V;const f=s.filter(Xd).map(Cc),h=(null===(B=k.category)||void 0===B?void 0:B.ageCategoryCode)||(null===(G=k.category)||void 0===G?void 0:G.categoryName)||l;if(o&&d&&d<=f.length){ie(1,d+1).forEach(((e,t)=>{let n={scaleValue:e,scaleName:h,scaleType:pm,eventType:p,scaleDate:c};const r=f[t];hm({tournamentRecord:o,participantId:r,scaleItem:n})}))}let v=av({...u,matchUpType:p,seedingScaleName:h,tournamentRecord:o,isMock:!0,drawEntries:s,drawName:i,drawId:e,event:k,stage:n});const{drawDefinition:g,error:I}=v;if(I)return{error:I};const y=null===(V=m[q])||void 0===V?void 0:V.drawExtensions;if(Array.isArray(y)&&y.filter(Gc).forEach((e=>Vc({element:g,extension:e}))),v=ap({drawDefinition:g,event:k}),v.error)return v;if(null!=u&&u.withPlayoffs){const e=g.structures[0].structureId,t=Uv({idPrefix:u.idPrefix,...u.withPlayoffs,tournamentRecord:o,drawDefinition:g,structureId:e,event:k});if(null!=t&&t.error)return t}if(!(!1===(null==u?void 0:u.automated))&&r){const e=null==u?void 0:u.matchUpFormat,n=Eg({matchUpStatusProfile:t,completeAllMatchUps:r,randomWinningSide:a,drawDefinition:g,matchUpFormat:e});if(n.error)return n;if((null==u?void 0:u.drawType)===ys){let n=Uh({structureId:g.structures.find((e=>e.stage===Lo)).structureId,tournamentRecord:o,drawDefinition:g,event:k});if(n.error)return n;if(n=Eg({completeAllMatchUps:r,matchUpStatusProfile:t,randomWinningSide:a,matchUpFormat:e,drawDefinition:g}),n.error)return n}}}}return{drawIds:j,eventId:O,uniqueParticipantIds:M}}function xg({allUniqueParticipantIds:e=[],matchUpStatusProfile:t,participantsProfile:n,completeAllMatchUps:r,autoEntryPositions:i,randomWinningSide:a,tournamentRecord:o,drawProfile:s,startDate:c,goesTo:u,uuids:d}){var l,p,f;const{excessParticipantAlternates:m=!0,matchUpFormat:h=I,drawType:v=is,eventType:g=Pa,alternatesCount:y=0,eventExtensions:b,drawExtensions:w,drawSize:U=32,seedsCount:D,category:N,idPrefix:P,gender:A,stage:M}=s,T="object"==typeof s.tieFormat?s.tieFormat:g===xa&&iv({namedFormat:s.tieFormatName});let E=s.eventName||`Generated ${g}`,C=(null==o?void 0:o.participants)||[];const R=!s.participantsCount||s.participantsCount>U?U:s.participantsCount,O=Wr();let x={eventId:O,eventName:E,eventType:g,category:N,tieFormat:T},{eventAttributes:L}=s;if("object"!=typeof L&&(L={}),Object.assign(x,L),null!=b&&b.length&&Array.isArray(b)){const e=b.filter(Gc);null!=e&&e.length&&Object.assign(x,{extensions:e})}const k=[];if(s.uniqueParticipants||!o||A){const e=g===Aa?La:Oa,{valuesInstanceLimit:t,nationalityCodesCount:r,nationalityCodeType:i,nationalityCodes:a,addressProps:c,personIds:u,inContext:l}=n||{},{participants:p}=Pg({participantsCount:R+y,participantType:e,uuids:s.uuids||d,sex:A||(null==n?void 0:n.sex),valuesInstanceLimit:t,nationalityCodesCount:r,nationalityCodeType:i,nationalityCodes:a,addressProps:c,personIds:u,inContext:l});if(o){let e=cp({tournamentRecord:o,participants:p});if(e.error)return e}p.forEach((({participantId:e})=>k.push(e))),C=p}const F=e=>{const{participantType:t}=e;return g===Pa&&t===Oa||(g===Aa&&t===La||g===xa&&t===xa)},j=e=>{var t,n;return!s.gender||((null===(t=e.person)||void 0===t?void 0:t.sex)===s.gender||(!(null===(n=e.individualParticipantIds)||void 0===n||!n.some((e=>{const t=C.find((t=>t.participantId===e));return t&&j(t)})))||void 0))},_=C.filter(F).filter(j).filter((({participantId:t})=>!e.includes(t))).slice(0,R).map((e=>e.participantId));let B=$m({entryStage:M,autoEntryPositions:i,tournamentRecord:o,participantIds:_,event:x});if(B.error)return B;const G=m&&(null==o||null===(l=o.participants)||void 0===l?void 0:l.filter((({participantId:e})=>!_.includes(e))).filter(F).filter(j).slice(0,y||U-R).map((e=>e.participantId)));if(null!=G&&G.length&&(B=$m({participantIds:G,autoEntryPositions:!1,entryStatus:Zc,tournamentRecord:o,event:x}),B.error))return{error:B.error};const V=(null===(p=x.category)||void 0===p?void 0:p.ageCategoryCode)||(null===(f=x.category)||void 0===f?void 0:f.categoryName)||E;if(o&&D&&D<=_.length){ie(1,D+1).forEach(((e,t)=>{let n={scaleValue:e,scaleName:V,scaleType:Di,eventType:g,scaleDate:c};const r=_[t];hm({tournamentRecord:o,participantId:r,scaleItem:n})}))}const{drawDefinition:q,error:H}=av({...s,tournamentRecord:o,seedingScaleName:V,matchUpFormat:h,isMock:!0,eventId:O,goesTo:u,event:x});if(H)return{error:H};Array.isArray(w)&&w.filter(Gc).forEach((e=>Vc({element:q,extension:e}))),B=ap({drawDefinition:q,event:x});const{drawId:W}=q;if(s.withPlayoffs){const e=q.structures[0].structureId,t=Uv({...s.withPlayoffs,tournamentRecord:o,drawDefinition:q,structureId:e,idPrefix:P,event:x});if(null!=t&&t.error)return t}if(!(!1===s.automated)){if(s.outcomes){const{matchUps:e}=dd({drawDefinition:q,inContext:!0,event:x});for(const t of s.outcomes){const{roundNumber:n,drawPositions:r,roundPosition:i,scoreString:a,winningSide:o,stage:s=Lo,matchUpFormat:c,stageSequence:u=1,matchUpStatus:d=S,matchUpIndex:l=0,structureOrder:p}=t,f=e.reduce(((e,t)=>{const{structureId:n,matchUpId:r}=t;return e[n]?e[n].push(r):e[n]=[r],e}),{}),m=Object.assign({},...Object.keys(f).map(((e,t)=>({[e]:t+1})))),h=e.filter((e=>!(s&&e.stage!==s||u&&e.stageSequence!==u||n&&e.roundNumber!==n||i&&e.roundPosition!==i||p&&m[e.structureId]!==p||r&&2!==oe(r,e.drawPositions).length)))[l],v=Cg({drawDefinition:q,targetMatchUp:h,matchUpFormat:c,matchUpStatus:d,scoreString:a,winningSide:o,drawId:W});if(null!=v&&v.error)return v}}if(r){const e=Eg({drawDefinition:q,matchUpFormat:h,randomWinningSide:a,completeAllMatchUps:r,matchUpStatusProfile:t});if(e.error)return e;if(v===ys){let e=Uh({structureId:q.structures.find((e=>e.stage===Lo)).structureId,tournamentRecord:o,drawDefinition:q,event:x});if(e=Eg({drawDefinition:q,matchUpFormat:h,randomWinningSide:a,completeAllMatchUps:r,matchUpStatusProfile:t}),e.error)return e}}}return B.error?{error:B.error}:{...de,uniqueParticipantIds:k,targetParticipants:C,drawDefinition:q,eventId:O,drawId:W,event:x}}const Lg={generateTournamentRecord:function({tournamentName:e="Mock Tournament",tournamentExtensions:t,tournamentAttributes:n,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:a,autoEntryPositions:o,randomWinningSide:s,policyDefinitions:c,schedulingProfile:u,eventProfiles:d,venueProfiles:l,drawProfiles:p,autoSchedule:f,startDate:m,endDate:h,goesTo:v,uuids:g}={}){let{participantsCount:I,participantType:y=Oa}=i||{};const b=I||0;if(m&&!yr(m)||h&&!yr(h))return{error:xt};if(!m){const e=new Date;m=wr(h||e),h=wr(e.setDate(e.getDate()+7))}if(!h){const e=new Date(m);h=wr(e.setDate(e.getDate()+7))}"object"!=typeof n&&(n={});const w=Qf({...n,tournamentName:e,startDate:m,endDate:h});if(null!=t&&t.length&&Array.isArray(t)){const e=t.filter(Gc);null!=e&&e.length&&Object.assign(w,{extensions:e,isMock:!0})}if("object"==typeof c)for(const Y of Object.keys(c))xf({policyDefinitions:{[Y]:c[Y]},tournamentRecord:w});let U=0,S=0,D=0,N=0;const P=({alternatesCount:e=0,tieFormatName:t,drawSize:n=0,eventType:r,tieFormat:i})=>{const a=r===Aa,o=r===Ma;if(o){var s;let r=0,a=0;N=Math.max(N,n+e),"object"==typeof i||iv({namedFormat:t}),null==i||null===(s=i.collectionDefinitions)||void 0===s||s.forEach((t=>{if(t.collectionId||(t.collectionId=Wr()),(null==t?void 0:t.matchUpType)===Aa){const i=t.matchUpCount;r=Math.max(r,i),t.matchUpCount>U&&(U=i*(n+e||1))}if((null==t?void 0:t.matchUpType)===ua){const r=t.matchUpCount;a=Math.max(a,r),t.matchUpCount>S&&(S=r*(n+e||1))}}));const o=Math.max(a,2*r);D=Math.max(D,o)}a&&n+e&&n+e>U&&(U=n+e),!a&&!o&&n&&n>S&&(S=n+e)};if(null==d||d.forEach((({eventType:e,drawProfiles:t})=>{if(t)for(const n of t){const{drawSize:t,alternatesCount:r,tieFormat:i,tieFormatName:a}=n;P({alternatesCount:r,tieFormatName:a,eventType:e,tieFormat:i,drawSize:t})}})),p)for(const Y of p){const{drawSize:e,alternatesCount:t,eventType:n,tieFormat:r,tieFormatName:i}=Y;P({alternatesCount:t,tieFormatName:i,eventType:n,tieFormat:r,drawSize:e})}const A=Math.max(N*D,2*U,S);U&&(y=La),(I||b)<A&&(I=A),I&&U&&[La,Ma].includes(y)&&(S&&Math.floor(S/2)>U?I=Math.floor(S/2):(!S||2*U>=S)&&(I=Math.ceil(I/2))),I||(I=32),I<b&&(I=b);const{nationalityCodesCount:M,nationalityCodeType:T,valuesInstanceLimit:E,nationalityCodes:C,personExtensions:R,teamKey:O,addressProps:x,personData:L,personIds:k,inContext:F,sex:j}=i||{},{participants:_}=Pg({valuesInstanceLimit:E,nationalityCodesCount:M,nationalityCodeType:T,nationalityCodes:C,personExtensions:R,addressProps:x,personData:L,sex:j,participantsCount:I,participantType:y,personIds:k,uuids:g,inContext:F});let B=cp({tournamentRecord:w,participants:_});if(!B.success)return B;if(O){const e=cm({tournamentRecord:w,...O});if(e.error)return e}const G=_.filter((({participantType:e})=>e===Oa)).map(Cc);if(B=cp({tournamentRecord:w,participants:ie(0,N).map((e=>{const t=G.slice(e*D,(e+1)*D);return{participantName:`Team ${e+1}`,participantRole:bf,participantType:Ma,participantId:Wr(),individualParticipantIds:t}}))}),!B.success)return B;const V=[],q=[],H=[];if(p)for(const Y of p){const{drawId:e,eventId:t,event:n,error:c,uniqueParticipantIds:u}=xg({tournamentRecord:w,allUniqueParticipantIds:H,autoEntryPositions:o,participantsProfile:i,completeAllMatchUps:a,matchUpStatusProfile:r,randomWinningSide:s,drawProfile:Y,startDate:m,goesTo:v});if(c)return{error:c};const d=Fm({tournamentRecord:w,event:n});if(d.error)return d;V.push(e),q.push(t),null!=u&&u.length&&H.push(...u)}if(d)for(const Y of d){const{error:e,eventId:t,drawIds:n,uniqueParticipantIds:c}=Og({allUniqueParticipantIds:H,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:a,autoEntryPositions:o,randomWinningSide:s,tournamentRecord:w,eventProfile:Y,startDate:m});if(e)return{error:e};n&&V.push(...n),q.push(t),null!=c&&c.length&&H.push(...c)}const W=null!=l&&l.length?function({tournamentRecord:e,venueProfiles:t}){const{startDate:n,endDate:r}=e;let i=[];for(const[a,o]of t.entries()){let{venueId:t=Wr(),venueName:s,courtsCount:c,dateAvailability:u,startTime:d="07:00",endTime:l="19:00"}=o,p=op({tournamentRecord:e,venue:{venueId:t,venueName:s||`Venue ${a+1}`}});if(p.error)return p;i.push(t);const f=Dr(n,r);if(u=!Array.isArray(u)&&f.map((e=>({date:wr(e),startTime:d,endTime:l})))||u,p=tp({tournamentRecord:e,venueId:t,courtsCount:c,dateAvailability:u}),p.error)return p}return i}({tournamentRecord:w,venueProfiles:l}):[];let z,K={};if(u){const e=function({schedulingProfile:e,tournamentRecord:t}){if("object"!=typeof e)return{error:jn};const n=yl({tournamentRecord:t}).containedStructures,{matchUps:r}=ud({tournamentRecord:t}),{tournamentId:i}=t,a=[];for(const o of e){const{scheduleDate:e,venues:s=[]}=o;for(const o of s){const{rounds:s,venueId:c}=o;for(const o of s){const{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,l=r.filter((e=>{var t;const n=(null==u?void 0:u.indexOf("-"))>0&&u.split("-").map((e=>+e)),r=null===(t=e.finishingPositionRange)||void 0===t?void 0:t.winner;return!(e.drawId!==s||o.roundNumber&&e.roundNumber!==o.roundNumber||r&&n&&2!==oe(r,n).length)}))[0];if(l){const{eventId:r,roundNumber:o,drawName:p,structureName:f,roundName:m}=l;let h=l.structureId;o&&!u&&(h=Object.keys(n).find((e=>n[e].includes(h))));const v={tournamentId:i,eventId:r,drawId:s,structureId:h,roundNumber:o,roundSegment:d};let g=xd({tournamentRecords:{[i]:t},scheduleDate:e,venueId:c,round:v});if(g.error)return g;a.push({drawName:p,structureName:f,roundName:m,...v})}}}}return{scheduledRounds:a}}({schedulingProfile:u,tournamentRecord:w});if(e.error)return e;if(z=e.scheduledRounds,f){const{tournamentId:e}=w;K=pf({tournamentRecords:{[e]:w}})}}return Vr({tournamentRecord:w,scheduledRounds:z,schedulerResult:K,eventIds:q,venueIds:W,drawIds:V})},generateParticipants:Pg,generateEventWithDraw:xg,generateOutcomeFromScoreString:bg,generateOutcome:Mg,parseScoreString:yg,credits:Ff},kg=function(){const e={version:()=>"0.51.1",devContext:t=>(er(t),e)};return[Lg].forEach((t=>{Object.keys(t).forEach((n=>{e[n]=e=>{try{return function(e,t){const n=e({...t});return null!=n&&n.error||Op(),ir(),n}(t[n],e)}catch(r){console.log("%c ERROR","color: orange",{err:r})}}}))})),e}(),Fg={auditConstants:Bm,drawDefinitionConstants:As,entryStatusConstants:pu,errorConditionConstants:$n,eventConstants:Ta,extensionConstants:Zi,flightConstants:kv,genderConstants:wm,keyValueConstants:Io,matchUpActionConstants:qf,matchUpStatusConstants:G,matchUpTypes:pa,participantConstants:yp,participantRoles:wf,participantTypes:Fa,penaltyConstants:{COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},policyConstants:ui,positionActionConstants:Gs,requestConstants:Zp,resultConstants:le,scaleConstants:fm,scheduleConstants:va,surfaceConstants:{CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},timeItemConstants:Ti,topicConstants:yc,venueConstants:{INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"}};var jg={chunkArray:ce,countValues:function(e){return t=ee(e),Object.keys(t).reduce(((e,n)=>{const r=t[n];return e[r]?e[r].push(n):e[r]=[n],e}),{});var t},dateRange:Dr,dateTime:Br,garman:Zs,generateRange:ie,generateHashCode:function(e){if(null===e||"object"!=typeof e)return;const t=JSON.stringify(e),n=qr(e),r=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0);return[t.length,n,r].map((e=>e.toString(36))).join("")},generateTimeCode:Z,instanceCount:ee,intersection:oe,isNumeric:z,JSON2CSV:function(e,t){if(t&&"object"!=typeof t)return jn;const{includeTransoformAccessors:n,columnAccessors:r=[],columnTransform:i={},columnMap:a={},valuesMap:o={},context:s={},delimiter:c='"',columnJoiner:u=",",rowJoiner:d="\r\n",keyJoiner:l="."}=t||{};if(!Array.isArray(e)||!Array.isArray(r)||"object"!=typeof s||"object"!=typeof a||"object"!=typeof i||"object"!=typeof o||"string"!=typeof u||"string"!=typeof d||"string"!=typeof l||"string"!=typeof c)return jn;const p=e.filter(Boolean).map((e=>Qs(e,l))),f=Object.values(i).flat();n&&r.push(...f);const m=p.reduce(((e,t)=>Object.keys(t).every((t=>!e.includes(t)&&e.push(t)||!0))&&e),[]).filter((e=>!(null!=r&&r.length)||r.includes(e))),h=Object.assign({},...Object.keys(i).map((e=>i[e].map((t=>({[t]:e}))).flat())).flat()),v=m.reduce(((e,t)=>{const n=h[t];return n?e.includes(n)||e.push(n):e.push(t),e}),[]);Object.keys(a).forEach((e=>!v.includes(e)&&v.unshift(e))),Object.keys(i).forEach((e=>!v.includes(e)&&v.unshift(e))),"object"==typeof s&&Object.keys(s).forEach((e=>!v.includes(e)&&v.unshift(e)));const g=v.map((e=>a[e]||e)),I=e=>`${c}${e}${c}`,y=p.map((e=>Object.values(v.reduce(((t,n)=>{var r;const a=i[n],c=(null!=a&&a.length?e[a.find((t=>e[t]))]:e[n])||(null==s?void 0:s[n])||"",u=(null===(r=o[n])||void 0===r?void 0:r[c])||c;return t[n]=I(u),t}),{})).join(u)));return[g.map(I).join(u),...y].join(d)},makeDeepCopy:Gr,nearestPowerOf2:W,numericSort:Hr,overlap:se,isPowerOf2:H,randomMember:re,randomPop:ne,shuffleArray:X,unique:Q,UUID:Wr,UUIDS:function(e=1){return ie(0,e).map(Wr)}}}}]);