"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[1233],{3805:(e,n,t)=>{t.d(n,{xA:()=>u,yg:()=>p});var r=t(758);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=r.createContext({}),d=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=d(e.components);return r.createElement(s.Provider,{value:n},e.children)},g="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},c=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),g=d(t),c=i,p=g["".concat(s,".").concat(c)]||g[c]||m[c]||a;return t?r.createElement(p,o(o({ref:n},u),{},{components:t})):r.createElement(p,o({ref:n},u))}));function p(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,o=new Array(a);o[0]=c;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[g]="string"==typeof e?e:i,o[1]=l;for(var d=2;d<a;d++)o[d]=t[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}c.displayName="MDXCreateElement"},8426:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var r=t(2232),i=(t(758),t(3805));const a={title:"Engine Middleware"},o=void 0,l={unversionedId:"engines/engine-middleware",id:"engines/engine-middleware",title:"Engine Middleware",description:"Engine middleware automatically resolves tournament structures from identifiers, eliminating the need to manually pass event, drawDefinition, and tournamentRecord objects. This significantly simplifies API calls and reduces boilerplate code.",source:"@site/docs/engines/engine-middleware.md",sourceDirName:"engines",slug:"/engines/engine-middleware",permalink:"/tods-competition-factory/docs/engines/engine-middleware",draft:!1,tags:[],version:"current",frontMatter:{title:"Engine Middleware"},sidebar:"docs",previous:{title:"Engine Logging",permalink:"/tods-competition-factory/docs/engines/engine-logging"},next:{title:"Mutation Engines",permalink:"/tods-competition-factory/docs/engines/mutation-engines"}},s={},d=[{value:"Automatic Structure Resolution",id:"automatic-structure-resolution",level:2},{value:"Resolving Events from Draw IDs",id:"resolving-events-from-draw-ids",level:3},{value:"Resolving Draws from Structure IDs",id:"resolving-draws-from-structure-ids",level:3},{value:"Resolving Everything from Match ID",id:"resolving-everything-from-match-id",level:3},{value:"Multi-Tournament Management",id:"multi-tournament-management",level:2},{value:"Explicit Tournament ID",id:"explicit-tournament-id",level:3},{value:"Setting Active Tournament",id:"setting-active-tournament",level:3},{value:"Single Tournament (No ID Required)",id:"single-tournament-no-id-required",level:3},{value:"Resolution Examples",id:"resolution-examples",level:2},{value:"Event Operations",id:"event-operations",level:3},{value:"Draw Operations",id:"draw-operations",level:3},{value:"Structure Operations",id:"structure-operations",level:3},{value:"MatchUp Operations",id:"matchup-operations",level:3},{value:"Middleware Behavior",id:"middleware-behavior",level:2},{value:"Resolution Priority",id:"resolution-priority",level:3},{value:"Resolution Chain",id:"resolution-chain",level:3},{value:"Disabling Middleware",id:"disabling-middleware",level:2},{value:"Per-Call Disable",id:"per-call-disable",level:3},{value:"When to Disable",id:"when-to-disable",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Invalid IDs",id:"invalid-ids",level:3},{value:"Missing Tournament",id:"missing-tournament",level:3},{value:"Conflicting IDs",id:"conflicting-ids",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Middleware Overhead",id:"middleware-overhead",level:3},{value:"Optimization Tips",id:"optimization-tips",level:3},{value:"Best Practices",id:"best-practices",level:2}],u={toc:d},g="wrapper";function m({components:e,...n}){return(0,i.yg)(g,(0,r.A)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,i.yg)("p",null,"Engine middleware automatically resolves tournament structures from identifiers, eliminating the need to manually pass ",(0,i.yg)("inlineCode",{parentName:"p"},"event"),", ",(0,i.yg)("inlineCode",{parentName:"p"},"drawDefinition"),", and ",(0,i.yg)("inlineCode",{parentName:"p"},"tournamentRecord")," objects. This significantly simplifies API calls and reduces boilerplate code."),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"Benefits:")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Automatic resolution of tournament structures from IDs"),(0,i.yg)("li",{parentName:"ul"},"Cleaner, more concise method calls"),(0,i.yg)("li",{parentName:"ul"},"Reduced parameter verbosity"),(0,i.yg)("li",{parentName:"ul"},"Automatic tournament selection in multi-tournament scenarios"),(0,i.yg)("li",{parentName:"ul"},"Type-safe resolution with error handling")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"automatic-structure-resolution"},"Automatic Structure Resolution"),(0,i.yg)("p",null,"Middleware resolves complex objects from simple identifiers:"),(0,i.yg)("h3",{id:"resolving-events-from-draw-ids"},"Resolving Events from Draw IDs"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"import { tournamentEngine } from 'tods-competition-factory';\n\ntournamentEngine.setState(tournamentRecord);\n\n// Without middleware (manual resolution)\nconst { drawDefinition } = tournamentEngine.getDrawDefinition({ drawId });\nconst { event } = tournamentEngine.findEvent({ drawId: drawDefinition.drawId });\ntournamentEngine.deleteDrawDefinitions({ event, drawIds: [drawId] });\n\n// With middleware (automatic resolution)\ntournamentEngine.getEvent({ drawId }); // \u2705 Event automatically resolved\n")),(0,i.yg)("h3",{id:"resolving-draws-from-structure-ids"},"Resolving Draws from Structure IDs"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Middleware resolves drawDefinition from structureId\nconst result = tournamentEngine.getStructure({ structureId });\n// Equivalent to manually finding draw, then finding structure\n")),(0,i.yg)("h3",{id:"resolving-everything-from-match-id"},"Resolving Everything from Match ID"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Single ID resolves entire hierarchy\nconst { matchUp, event, drawDefinition, structure } = tournamentEngine.getMatchUp({ matchUpId });\n// All related objects automatically included\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"multi-tournament-management"},"Multi-Tournament Management"),(0,i.yg)("p",null,"When multiple tournaments are loaded, middleware requires tournament identification:"),(0,i.yg)("h3",{id:"explicit-tournament-id"},"Explicit Tournament ID"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"import { competitionEngine } from 'tods-competition-factory';\n\n// Load multiple tournaments\nawait competitionEngine.setState([tournament1, tournament2, tournament3]);\n\n// Specify which tournament for the operation\nconst { participants } = competitionEngine.getParticipants({\n  tournamentId: 'tournament-1',\n});\n")),(0,i.yg)("h3",{id:"setting-active-tournament"},"Setting Active Tournament"),(0,i.yg)("p",null,"Avoid repeating ",(0,i.yg)("inlineCode",{parentName:"p"},"tournamentId")," by setting an active tournament:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"import { tournamentEngine, globalState } from 'tods-competition-factory';\n\n// Method 1: Via globalState\nglobalState.setTournamentId('tournament-1');\n\n// Method 2: Via engine\ntournamentEngine.setTournamentId('tournament-1');\n\n// Now all operations use this tournament\nconst { participants } = tournamentEngine.getParticipants(); // Uses 'tournament-1'\nconst { events } = tournamentEngine.getEvents(); // Uses 'tournament-1'\n")),(0,i.yg)("h3",{id:"single-tournament-no-id-required"},"Single Tournament (No ID Required)"),(0,i.yg)("p",null,"When only one tournament is in state, middleware automatically uses it:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"import { tournamentEngine } from 'tods-competition-factory';\n\n// Load single tournament\ntournamentEngine.setState(singleTournament);\n\n// No tournamentId needed\nconst { participants } = tournamentEngine.getParticipants();\nconst { events } = tournamentEngine.getEvents();\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"resolution-examples"},"Resolution Examples"),(0,i.yg)("h3",{id:"event-operations"},"Event Operations"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Operation with eventId - middleware resolves event object\ntournamentEngine.addEventExtension({\n  eventId: 'event-1',\n  extension: { name: 'metadata', value: { key: 'value' } },\n});\n\n// Middleware handles:\n// 1. Find event from eventId\n// 2. Add extension to event\n// 3. Trigger notifications\n")),(0,i.yg)("h3",{id:"draw-operations"},"Draw Operations"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Operation with drawId - middleware resolves drawDefinition\ntournamentEngine.automatedPositioning({\n  drawId: 'draw-1',\n  seedingScaleNames: ['WTN', 'SEEDING'],\n});\n\n// Middleware handles:\n// 1. Find drawDefinition from drawId\n// 2. Find event containing this draw\n// 3. Perform automated positioning\n// 4. Trigger draw modification notices\n")),(0,i.yg)("h3",{id:"structure-operations"},"Structure Operations"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Operation with structureId - middleware resolves full hierarchy\ntournamentEngine.getPositionAssignments({\n  structureId: 'structure-1',\n});\n\n// Middleware handles:\n// 1. Find drawDefinition containing structure\n// 2. Find event containing draw\n// 3. Extract position assignments from structure\n")),(0,i.yg)("h3",{id:"matchup-operations"},"MatchUp Operations"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Operation with matchUpId - middleware resolves everything\ntournamentEngine.setMatchUpStatus({\n  matchUpId: 'match-1',\n  outcome: { winningSide: 1 },\n});\n\n// Middleware handles:\n// 1. Find structure containing matchUp\n// 2. Find drawDefinition containing structure\n// 3. Find event containing draw\n// 4. Update matchUp status\n// 5. Propagate changes through draw\n// 6. Trigger notifications\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"middleware-behavior"},"Middleware Behavior"),(0,i.yg)("h3",{id:"resolution-priority"},"Resolution Priority"),(0,i.yg)("p",null,"When multiple identifiers are provided, middleware uses the most specific:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Both drawId and eventId provided - drawId takes precedence\ntournamentEngine.getEvent({\n  drawId: 'draw-1', // More specific\n  eventId: 'event-1', // Ignored\n});\n// Returns event containing draw-1 (may not be event-1)\n")),(0,i.yg)("h3",{id:"resolution-chain"},"Resolution Chain"),(0,i.yg)("p",null,"Middleware traverses up the tournament hierarchy:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-text"},"matchUpId \u2192 structure \u2192 drawDefinition \u2192 event \u2192 tournamentRecord\n           \u2193           \u2193                 \u2193       \u2193\n      structureId    drawId           eventId  tournamentId\n")),(0,i.yg)("p",null,"Any identifier resolves all parent structures."),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"disabling-middleware"},"Disabling Middleware"),(0,i.yg)("p",null,"For debugging or special cases, middleware can be disabled:"),(0,i.yg)("h3",{id:"per-call-disable"},"Per-Call Disable"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Bypass middleware for this call only\ntournamentEngine.getEvent({\n  drawId: 'draw-1',\n  _middleware: false, // Middleware disabled\n});\n// Error: event not provided (middleware didn't resolve it)\n")),(0,i.yg)("h3",{id:"when-to-disable"},"When to Disable"),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"Debugging scenarios:")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Testing function behavior without middleware"),(0,i.yg)("li",{parentName:"ul"},"Verifying manual object passing"),(0,i.yg)("li",{parentName:"ul"},"Performance profiling middleware overhead")),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"Direct object passing:")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Manually provide resolved objects\nconst { event } = tournamentEngine.findEvent({ drawId });\nconst { drawDefinition } = tournamentEngine.getDrawDefinition({ drawId });\n\ntournamentEngine.someOperation({\n  event,\n  drawDefinition,\n  _middleware: false,\n});\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"error-handling"},"Error Handling"),(0,i.yg)("p",null,"Middleware provides clear error messages for resolution failures:"),(0,i.yg)("h3",{id:"invalid-ids"},"Invalid IDs"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"tournamentEngine.getEvent({ drawId: 'nonexistent-draw' });\n// Error: DRAW_DEFINITION_NOT_FOUND\n")),(0,i.yg)("h3",{id:"missing-tournament"},"Missing Tournament"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"competitionEngine.setState([tournament1, tournament2]);\n\n// No tournamentId specified with multiple tournaments\ncompetitionEngine.getParticipants();\n// Error: MISSING_TOURNAMENT_ID (ambiguous which tournament to use)\n")),(0,i.yg)("h3",{id:"conflicting-ids"},"Conflicting IDs"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Providing conflicting identifiers\ntournamentEngine.getEvent({\n  drawId: 'draw-from-event-1',\n  eventId: 'event-2', // Different event\n});\n// Uses drawId, ignores eventId\n// Returns event containing draw-1 (not event-2)\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"performance-considerations"},"Performance Considerations"),(0,i.yg)("h3",{id:"middleware-overhead"},"Middleware Overhead"),(0,i.yg)("p",null,"Middleware adds minimal overhead (~1ms per call):"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// Without middleware (direct object access)\nconst time1 = performance.now();\nsomeOperation({ event, drawDefinition });\nconst time2 = performance.now();\n// ~0.1ms\n\n// With middleware (ID resolution)\nconst time3 = performance.now();\nsomeOperation({ eventId, drawId });\nconst time4 = performance.now();\n// ~1.1ms (includes resolution time)\n")),(0,i.yg)("h3",{id:"optimization-tips"},"Optimization Tips"),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"Use specific IDs when available:")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-js"},"// \u274c Less efficient - more resolution steps\ntournamentEngine.getMatchUp({ matchUpId }); // Resolves full hierarchy\n\n// \u2705 More efficient - direct access\ntournamentEngine.getMatchUp({\n  matchUpId,\n  eventId,\n  drawId, // Helps narrow down search\n  structureId, // Even more specific\n});\n")),(0,i.yg)("hr",null),(0,i.yg)("h2",{id:"best-practices"},"Best Practices"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("strong",{parentName:"li"},"Use middleware by default")," - It handles complexity automatically"),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("strong",{parentName:"li"},"Set active tournament early")," - Avoid repeating tournamentId"),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("strong",{parentName:"li"},"Pass specific IDs")," - More specific = faster resolution"),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("strong",{parentName:"li"},"Cache for bulk ops")," - Resolve once, reuse objects"),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("strong",{parentName:"li"},"Handle errors")," - Middleware errors indicate data integrity issues"),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("strong",{parentName:"li"},"Disable only when needed")," - For debugging, not production")),(0,i.yg)("hr",null))}m.isMDXComponent=!0}}]);