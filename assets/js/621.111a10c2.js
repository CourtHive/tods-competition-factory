(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[621,608],{6591:function(t,e,i){"use strict";i.r(e),i.d(e,{features:function(){return yi},transform:function(){return wi}});var n={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},r="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",a={5:r,6:r+" const class extends export import super"},o=/^in(stanceof)?$/,s="\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0560-\u0588\u05d0-\u05ea\u05ef-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u0860-\u086a\u08a0-\u08b4\u08b6-\u08bd\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u09fc\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0af9\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58-\u0c5a\u0c60\u0c61\u0c80\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d54-\u0d56\u0d5f-\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f5\u13f8-\u13fd\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1878\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1c80-\u1c88\u1c90-\u1cba\u1cbd-\u1cbf\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2118-\u211d\u2124\u2126\u2128\u212a-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309b-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312f\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fef\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua7b9\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua8fd\ua8fe\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab65\uab70-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc",c="\u200c\u200d\xb7\u0300-\u036f\u0387\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u07fd\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08d3-\u08e1\u08e3-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u09fe\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0afa-\u0aff\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c00-\u0c04\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d00-\u0d03\u0d3b\u0d3c\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19d0-\u19da\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1ab0-\u1abd\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1cf7-\u1cf9\u1dc0-\u1df9\u1dfb-\u1dff\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69e\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c5\ua8d0-\ua8d9\ua8e0-\ua8f1\ua8ff-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\ua9e5\ua9f0-\ua9f9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b-\uaa7d\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe2f\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f",u=new RegExp("["+s+"]"),d=new RegExp("["+s+c+"]");s=c=null;var l=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,190,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,26,230,43,117,63,32,0,257,0,11,39,8,0,22,0,12,39,3,3,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,68,12,0,67,12,65,1,31,6129,15,754,9486,286,82,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],p=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,280,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239];function h(t,e){for(var i=65536,n=0;n<e.length;n+=2){if((i+=e[n])>t)return!1;if((i+=e[n+1])>=t)return!0}}function f(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&u.test(String.fromCharCode(t)):!1!==e&&h(t,l)))}function m(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&d.test(String.fromCharCode(t)):!1!==e&&(h(t,l)||h(t,p)))))}var g=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function v(t,e){return new g(t,{beforeExpr:!0,binop:e})}var y={beforeExpr:!0},I={startsExpr:!0},w={};function S(t,e){return void 0===e&&(e={}),e.keyword=t,w[t]=new g(t,e)}var b={num:new g("num",I),regexp:new g("regexp",I),string:new g("string",I),name:new g("name",I),eof:new g("eof"),bracketL:new g("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new g("]"),braceL:new g("{",{beforeExpr:!0,startsExpr:!0}),braceR:new g("}"),parenL:new g("(",{beforeExpr:!0,startsExpr:!0}),parenR:new g(")"),comma:new g(",",y),semi:new g(";",y),colon:new g(":",y),dot:new g("."),question:new g("?",y),arrow:new g("=>",y),template:new g("template"),invalidTemplate:new g("invalidTemplate"),ellipsis:new g("...",y),backQuote:new g("`",I),dollarBraceL:new g("${",{beforeExpr:!0,startsExpr:!0}),eq:new g("=",{beforeExpr:!0,isAssign:!0}),assign:new g("_=",{beforeExpr:!0,isAssign:!0}),incDec:new g("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new g("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:v("||",1),logicalAND:v("&&",2),bitwiseOR:v("|",3),bitwiseXOR:v("^",4),bitwiseAND:v("&",5),equality:v("==/!=/===/!==",6),relational:v("</>/<=/>=",7),bitShift:v("<</>>/>>>",8),plusMin:new g("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:v("%",10),star:v("*",10),slash:v("/",10),starstar:new g("**",{beforeExpr:!0}),_break:S("break"),_case:S("case",y),_catch:S("catch"),_continue:S("continue"),_debugger:S("debugger"),_default:S("default",y),_do:S("do",{isLoop:!0,beforeExpr:!0}),_else:S("else",y),_finally:S("finally"),_for:S("for",{isLoop:!0}),_function:S("function",I),_if:S("if"),_return:S("return",y),_switch:S("switch"),_throw:S("throw",y),_try:S("try"),_var:S("var"),_const:S("const"),_while:S("while",{isLoop:!0}),_with:S("with"),_new:S("new",{beforeExpr:!0,startsExpr:!0}),_this:S("this",I),_super:S("super",I),_class:S("class",I),_extends:S("extends",y),_export:S("export"),_import:S("import"),_null:S("null",I),_true:S("true",I),_false:S("false",I),_in:S("in",{beforeExpr:!0,binop:7}),_instanceof:S("instanceof",{beforeExpr:!0,binop:7}),_typeof:S("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:S("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:S("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},U=/\r\n?|\n|\u2028|\u2029/,N=new RegExp(U.source,"g");function P(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}var E=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,D=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,A=Object.prototype,T=A.hasOwnProperty,C=A.toString;function M(t,e){return T.call(t,e)}var x=Array.isArray||function(t){return"[object Array]"===C.call(t)};function R(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}var k=function(t,e){this.line=t,this.column=e};k.prototype.offset=function(t){return new k(this.line,this.column+t)};var O=function(t,e,i){this.start=e,this.end=i,null!==t.sourceFile&&(this.source=t.sourceFile)};function L(t,e){for(var i=1,n=0;;){N.lastIndex=n;var r=N.exec(t);if(!(r&&r.index<e))return new k(i,e-n);++i,n=r.index+r[0].length}}var _={ecmaVersion:9,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function F(t,e){return 2|(t?4:0)|(e?8:0)}var j=function(t,e,i){this.options=t=function(t){var e={};for(var i in _)e[i]=t&&M(t,i)?t[i]:_[i];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),x(e.onToken)){var n=e.onToken;e.onToken=function(t){return n.push(t)}}return x(e.onComment)&&(e.onComment=function(t,e){return function(i,n,r,a,o,s){var c={type:i?"Block":"Line",value:n,start:r,end:a};t.locations&&(c.loc=new O(this,o,s)),t.ranges&&(c.range=[r,a]),e.push(c)}}(e,e.onComment)),e}(t),this.sourceFile=t.sourceFile,this.keywords=R(a[t.ecmaVersion>=6?6:5]);var r="";if(!t.allowReserved){for(var o=t.ecmaVersion;!(r=n[o]);o--);"module"===t.sourceType&&(r+=" await")}this.reservedWords=R(r);var s=(r?r+" ":"")+n.strict;this.reservedWordsStrict=R(s),this.reservedWordsStrictBind=R(s+" "+n.strictBind),this.input=String(e),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf("\n",i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(U).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=b.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(1),this.regexpState=null},B={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};j.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},B.inFunction.get=function(){return(2&this.currentVarScope().flags)>0},B.inGenerator.get=function(){return(8&this.currentVarScope().flags)>0},B.inAsync.get=function(){return(4&this.currentVarScope().flags)>0},B.allowSuper.get=function(){return(64&this.currentThisScope().flags)>0},B.allowDirectSuper.get=function(){return(128&this.currentThisScope().flags)>0},B.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},j.prototype.inNonArrowFunction=function(){return(2&this.currentThisScope().flags)>0},j.extend=function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];for(var i=this,n=0;n<t.length;n++)i=t[n](i);return i},j.parse=function(t,e){return new this(e,t).parse()},j.parseExpressionAt=function(t,e,i){var n=new this(i,t,e);return n.nextToken(),n.parseExpression()},j.tokenizer=function(t,e){return new this(e,t)},Object.defineProperties(j.prototype,B);var V=j.prototype,G=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)")/;function H(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}V.strictDirective=function(t){for(;;){D.lastIndex=t,t+=D.exec(this.input)[0].length;var e=G.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2]))return!0;D.lastIndex=t+=e[0].length,t+=D.exec(this.input)[0].length,";"===this.input[t]&&t++}},V.eat=function(t){return this.type===t&&(this.next(),!0)},V.isContextual=function(t){return this.type===b.name&&this.value===t&&!this.containsEsc},V.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},V.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},V.canInsertSemicolon=function(){return this.type===b.eof||this.type===b.braceR||U.test(this.input.slice(this.lastTokEnd,this.start))},V.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},V.semicolon=function(){this.eat(b.semi)||this.insertSemicolon()||this.unexpected()},V.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},V.expect=function(t){this.eat(t)||this.unexpected()},V.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},V.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var i=e?t.parenthesizedAssign:t.parenthesizedBind;i>-1&&this.raiseRecoverable(i,"Parenthesized pattern")}},V.checkExpressionErrors=function(t,e){if(!t)return!1;var i=t.shorthandAssign,n=t.doubleProto;if(!e)return i>=0||n>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),n>=0&&this.raiseRecoverable(n,"Redefinition of __proto__ property")},V.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},V.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var W=j.prototype;W.parseTopLevel=function(t){var e={};for(t.body||(t.body=[]);this.type!==b.eof;){var i=this.parseStatement(null,!0,e);t.body.push(i)}if(this.inModule)for(var n=0,r=Object.keys(this.undefinedExports);n<r.length;n+=1){var a=r[n];this.raiseRecoverable(this.undefinedExports[a].start,"Export '"+a+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),this.options.ecmaVersion>=6&&(t.sourceType=this.options.sourceType),this.finishNode(t,"Program")};var q={kind:"loop"},z={kind:"switch"};W.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;D.lastIndex=this.pos;var e=D.exec(this.input),i=this.pos+e[0].length,n=this.input.charCodeAt(i);if(91===n)return!0;if(t)return!1;if(123===n)return!0;if(f(n,!0)){for(var r=i+1;m(this.input.charCodeAt(r),!0);)++r;var a=this.input.slice(i,r);if(!o.test(a))return!0}return!1},W.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;D.lastIndex=this.pos;var t=D.exec(this.input),e=this.pos+t[0].length;return!(U.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&m(this.input.charAt(e+8)))},W.parseStatement=function(t,e,i){var n,r=this.type,a=this.startNode();switch(this.isLet(t)&&(r=b._var,n="let"),r){case b._break:case b._continue:return this.parseBreakContinueStatement(a,r.keyword);case b._debugger:return this.parseDebuggerStatement(a);case b._do:return this.parseDoStatement(a);case b._for:return this.parseForStatement(a);case b._function:return t&&(this.strict||"if"!==t&&"label"!==t)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(a,!1,!t);case b._class:return t&&this.unexpected(),this.parseClass(a,!0);case b._if:return this.parseIfStatement(a);case b._return:return this.parseReturnStatement(a);case b._switch:return this.parseSwitchStatement(a);case b._throw:return this.parseThrowStatement(a);case b._try:return this.parseTryStatement(a);case b._const:case b._var:return n=n||this.value,t&&"var"!==n&&this.unexpected(),this.parseVarStatement(a,n);case b._while:return this.parseWhileStatement(a);case b._with:return this.parseWithStatement(a);case b.braceL:return this.parseBlock(!0,a);case b.semi:return this.parseEmptyStatement(a);case b._export:case b._import:return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),r===b._import?this.parseImport(a):this.parseExport(a,i);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(a,!0,!t);var o=this.value,s=this.parseExpression();return r===b.name&&"Identifier"===s.type&&this.eat(b.colon)?this.parseLabeledStatement(a,o,s,t):this.parseExpressionStatement(a,s)}},W.parseBreakContinueStatement=function(t,e){var i="break"===e;this.next(),this.eat(b.semi)||this.insertSemicolon()?t.label=null:this.type!==b.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var n=0;n<this.labels.length;++n){var r=this.labels[n];if(null==t.label||r.name===t.label.name){if(null!=r.kind&&(i||"loop"===r.kind))break;if(t.label&&i)break}}return n===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,i?"BreakStatement":"ContinueStatement")},W.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},W.parseDoStatement=function(t){return this.next(),this.labels.push(q),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(b._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(b.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},W.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(q),this.enterScope(0),this.expect(b.parenL),this.type===b.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var i=this.isLet();if(this.type===b._var||this.type===b._const||i){var n=this.startNode(),r=i?"let":this.value;return this.next(),this.parseVar(n,!0,r),this.finishNode(n,"VariableDeclaration"),!(this.type===b._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==n.declarations.length||"var"!==r&&n.declarations[0].init?(e>-1&&this.unexpected(e),this.parseFor(t,n)):(this.options.ecmaVersion>=9&&(this.type===b._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,n))}var a=new H,o=this.parseExpression(!0,a);return this.type===b._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===b._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(o,!1,a),this.checkLVal(o),this.parseForIn(t,o)):(this.checkExpressionErrors(a,!0),e>-1&&this.unexpected(e),this.parseFor(t,o))},W.parseFunctionStatement=function(t,e,i){return this.next(),this.parseFunction(t,Y|(i?0:J),!1,e)},W.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(b._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")},W.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(b.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},W.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(b.braceL),this.labels.push(z),this.enterScope(0);for(var i=!1;this.type!==b.braceR;)if(this.type===b._case||this.type===b._default){var n=this.type===b._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),n?e.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,e.test=null),this.expect(b.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},W.parseThrowStatement=function(t){return this.next(),U.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var K=[];W.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===b._catch){var e=this.startNode();if(this.next(),this.eat(b.parenL)){e.param=this.parseBindingAtom();var i="Identifier"===e.param.type;this.enterScope(i?32:0),this.checkLVal(e.param,i?4:2),this.expect(b.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(b._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},W.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},W.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(q),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")},W.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")},W.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},W.parseLabeledStatement=function(t,e,i,n){for(var r=0,a=this.labels;r<a.length;r+=1)a[r].name===e&&this.raise(i.start,"Label '"+e+"' is already declared");for(var o=this.type.isLoop?"loop":this.type===b._switch?"switch":null,s=this.labels.length-1;s>=0;s--){var c=this.labels[s];if(c.statementStart!==t.start)break;c.statementStart=this.start,c.kind=o}return this.labels.push({name:e,kind:o,statementStart:this.start}),t.body=this.parseStatement(n?-1===n.indexOf("label")?n+"label":n:"label"),this.labels.pop(),t.label=i,this.finishNode(t,"LabeledStatement")},W.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},W.parseBlock=function(t,e){for(void 0===t&&(t=!0),void 0===e&&(e=this.startNode()),e.body=[],this.expect(b.braceL),t&&this.enterScope(0);!this.eat(b.braceR);){var i=this.parseStatement(null);e.body.push(i)}return t&&this.exitScope(),this.finishNode(e,"BlockStatement")},W.parseFor=function(t,e){return t.init=e,this.expect(b.semi),t.test=this.type===b.semi?null:this.parseExpression(),this.expect(b.semi),t.update=this.type===b.parenR?null:this.parseExpression(),this.expect(b.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")},W.parseForIn=function(t,e){var i=this.type===b._in?"ForInStatement":"ForOfStatement";return this.next(),"ForInStatement"===i&&("AssignmentPattern"===e.type||"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(this.strict||"Identifier"!==e.declarations[0].id.type))&&this.raise(e.start,"Invalid assignment in for-in loop head"),t.left=e,t.right="ForInStatement"===i?this.parseExpression():this.parseMaybeAssign(),this.expect(b.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,i)},W.parseVar=function(t,e,i){for(t.declarations=[],t.kind=i;;){var n=this.startNode();if(this.parseVarId(n,i),this.eat(b.eq)?n.init=this.parseMaybeAssign(e):"const"!==i||this.type===b._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===n.id.type||e&&(this.type===b._in||this.isContextual("of"))?n.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(n,"VariableDeclarator")),!this.eat(b.comma))break}return t},W.parseVarId=function(t,e){"const"!==e&&"let"!==e||!this.isContextual("let")||this.raiseRecoverable(this.start,"let is disallowed as a lexically bound name"),t.id=this.parseBindingAtom(),this.checkLVal(t.id,"var"===e?1:2,!1)};var Y=1,J=2;W.parseFunction=function(t,e,i,n){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!n)&&(this.type===b.star&&e&J&&this.unexpected(),t.generator=this.eat(b.star)),this.options.ecmaVersion>=8&&(t.async=!!n),e&Y&&(t.id=4&e&&this.type!==b.name?null:this.parseIdent(),!t.id||e&J||this.checkLVal(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?1:2:3));var r=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(F(t.async,t.generator)),e&Y||(t.id=this.type===b.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,i,!1),this.yieldPos=r,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(t,e&Y?"FunctionDeclaration":"FunctionExpression")},W.parseFunctionParams=function(t){this.expect(b.parenL),t.params=this.parseBindingList(b.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},W.parseClass=function(t,e){this.next();var i=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);var n=this.startNode(),r=!1;for(n.body=[],this.expect(b.braceL);!this.eat(b.braceR);){var a=this.parseClassElement(null!==t.superClass);a&&(n.body.push(a),"MethodDefinition"===a.type&&"constructor"===a.kind&&(r&&this.raise(a.start,"Duplicate constructor in the same class"),r=!0))}return t.body=this.finishNode(n,"ClassBody"),this.strict=i,this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},W.parseClassElement=function(t){var e=this;if(this.eat(b.semi))return null;var i=this.startNode(),n=function(t,n){void 0===n&&(n=!1);var r=e.start,a=e.startLoc;return!(!e.eatContextual(t)||(e.type===b.parenL||n&&e.canInsertSemicolon())&&(i.key&&e.unexpected(),i.computed=!1,i.key=e.startNodeAt(r,a),i.key.name=t,e.finishNode(i.key,"Identifier"),1))};i.kind="method",i.static=n("static");var r=this.eat(b.star),a=!1;r||(this.options.ecmaVersion>=8&&n("async",!0)?(a=!0,r=this.options.ecmaVersion>=9&&this.eat(b.star)):n("get")?i.kind="get":n("set")&&(i.kind="set")),i.key||this.parsePropertyName(i);var o=i.key,s=!1;return i.computed||i.static||!("Identifier"===o.type&&"constructor"===o.name||"Literal"===o.type&&"constructor"===o.value)?i.static&&"Identifier"===o.type&&"prototype"===o.name&&this.raise(o.start,"Classes may not have a static property named prototype"):("method"!==i.kind&&this.raise(o.start,"Constructor can't have get/set modifier"),r&&this.raise(o.start,"Constructor can't be a generator"),a&&this.raise(o.start,"Constructor can't be an async method"),i.kind="constructor",s=t),this.parseClassMethod(i,r,a,s),"get"===i.kind&&0!==i.value.params.length&&this.raiseRecoverable(i.value.start,"getter should have no params"),"set"===i.kind&&1!==i.value.params.length&&this.raiseRecoverable(i.value.start,"setter should have exactly one param"),"set"===i.kind&&"RestElement"===i.value.params[0].type&&this.raiseRecoverable(i.value.params[0].start,"Setter cannot use rest params"),i},W.parseClassMethod=function(t,e,i,n){return t.value=this.parseMethod(e,i,n),this.finishNode(t,"MethodDefinition")},W.parseClassId=function(t,e){this.type===b.name?(t.id=this.parseIdent(),e&&this.checkLVal(t.id,2,!1)):(!0===e&&this.unexpected(),t.id=null)},W.parseClassSuper=function(t){t.superClass=this.eat(b._extends)?this.parseExprSubscripts():null},W.parseExport=function(t,e){if(this.next(),this.eat(b.star))return this.expectContextual("from"),this.type!==b.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(b._default)){var i;if(this.checkExport(e,"default",this.lastTokStart),this.type===b._function||(i=this.isAsyncFunction())){var n=this.startNode();this.next(),i&&this.next(),t.declaration=this.parseFunction(n,4|Y,!1,i)}else if(this.type===b._class){var r=this.startNode();t.declaration=this.parseClass(r,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(null),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==b.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var a=0,o=t.specifiers;a<o.length;a+=1){var s=o[a];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},W.checkExport=function(t,e,i){t&&(M(t,e)&&this.raiseRecoverable(i,"Duplicate export '"+e+"'"),t[e]=!0)},W.checkPatternExport=function(t,e){var i=e.type;if("Identifier"===i)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===i)for(var n=0,r=e.properties;n<r.length;n+=1)this.checkPatternExport(t,r[n]);else if("ArrayPattern"===i)for(var a=0,o=e.elements;a<o.length;a+=1){var s=o[a];s&&this.checkPatternExport(t,s)}else"Property"===i?this.checkPatternExport(t,e.value):"AssignmentPattern"===i?this.checkPatternExport(t,e.left):"RestElement"===i?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===i&&this.checkPatternExport(t,e.expression)},W.checkVariableExport=function(t,e){if(t)for(var i=0,n=e;i<n.length;i+=1)this.checkPatternExport(t,n[i].id)},W.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},W.parseExportSpecifiers=function(t){var e=[],i=!0;for(this.expect(b.braceL);!this.eat(b.braceR);){if(i)i=!1;else if(this.expect(b.comma),this.afterTrailingComma(b.braceR))break;var n=this.startNode();n.local=this.parseIdent(!0),n.exported=this.eatContextual("as")?this.parseIdent(!0):n.local,this.checkExport(t,n.exported.name,n.exported.start),e.push(this.finishNode(n,"ExportSpecifier"))}return e},W.parseImport=function(t){return this.next(),this.type===b.string?(t.specifiers=K,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===b.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},W.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===b.name){var i=this.startNode();if(i.local=this.parseIdent(),this.checkLVal(i.local,2),t.push(this.finishNode(i,"ImportDefaultSpecifier")),!this.eat(b.comma))return t}if(this.type===b.star){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLVal(n.local,2),t.push(this.finishNode(n,"ImportNamespaceSpecifier")),t}for(this.expect(b.braceL);!this.eat(b.braceR);){if(e)e=!1;else if(this.expect(b.comma),this.afterTrailingComma(b.braceR))break;var r=this.startNode();r.imported=this.parseIdent(!0),this.eatContextual("as")?r.local=this.parseIdent():(this.checkUnreserved(r.imported),r.local=r.imported),this.checkLVal(r.local,2),t.push(this.finishNode(r,"ImportSpecifier"))}return t},W.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},W.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var $=j.prototype;$.toAssignable=function(t,e,i){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var n=0,r=t.properties;n<r.length;n+=1){var a=r[n];this.toAssignable(a,e),"RestElement"!==a.type||"ArrayPattern"!==a.argument.type&&"ObjectPattern"!==a.argument.type||this.raise(a.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e,i);break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return t},$.toAssignableList=function(t,e){for(var i=t.length,n=0;n<i;n++){var r=t[n];r&&this.toAssignable(r,e)}if(i){var a=t[i-1];6===this.options.ecmaVersion&&e&&a&&"RestElement"===a.type&&"Identifier"!==a.argument.type&&this.unexpected(a.argument.start)}return t},$.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},$.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==b.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},$.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case b.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(b.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case b.braceL:return this.parseObj(!0)}return this.parseIdent()},$.parseBindingList=function(t,e,i){for(var n=[],r=!0;!this.eat(t);)if(r?r=!1:this.expect(b.comma),e&&this.type===b.comma)n.push(null);else{if(i&&this.afterTrailingComma(t))break;if(this.type===b.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),n.push(a),this.type===b.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var o=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(o),n.push(o)}return n},$.parseBindingListItem=function(t){return t},$.parseMaybeDefault=function(t,e,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(b.eq))return i;var n=this.startNodeAt(t,e);return n.left=i,n.right=this.parseMaybeAssign(),this.finishNode(n,"AssignmentPattern")},$.checkLVal=function(t,e,i){switch(void 0===e&&(e=0),t.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),i&&(M(i,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),i[t.name]=!0),0!==e&&5!==e&&this.declareName(t.name,e,t.start);break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var n=0,r=t.properties;n<r.length;n+=1)this.checkLVal(r[n],e,i);break;case"Property":this.checkLVal(t.value,e,i);break;case"ArrayPattern":for(var a=0,o=t.elements;a<o.length;a+=1){var s=o[a];s&&this.checkLVal(s,e,i)}break;case"AssignmentPattern":this.checkLVal(t.left,e,i);break;case"RestElement":this.checkLVal(t.argument,e,i);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,i);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var Z=j.prototype;Z.checkPropClash=function(t,e,i){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var n,r=t.key;switch(r.type){case"Identifier":n=r.name;break;case"Literal":n=String(r.value);break;default:return}var a=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===n&&"init"===a&&(e.proto&&(i&&i.doubleProto<0?i.doubleProto=r.start:this.raiseRecoverable(r.start,"Redefinition of __proto__ property")),e.proto=!0);else{var o=e[n="$"+n];o?("init"===a?this.strict&&o.init||o.get||o.set:o.init||o[a])&&this.raiseRecoverable(r.start,"Redefinition of property"):o=e[n]={init:!1,get:!1,set:!1},o[a]=!0}}},Z.parseExpression=function(t,e){var i=this.start,n=this.startLoc,r=this.parseMaybeAssign(t,e);if(this.type===b.comma){var a=this.startNodeAt(i,n);for(a.expressions=[r];this.eat(b.comma);)a.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(a,"SequenceExpression")}return r},Z.parseMaybeAssign=function(t,e,i){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var n=!1,r=-1,a=-1,o=-1;e?(r=e.parenthesizedAssign,a=e.trailingComma,o=e.shorthandAssign,e.parenthesizedAssign=e.trailingComma=e.shorthandAssign=-1):(e=new H,n=!0);var s=this.start,c=this.startLoc;this.type!==b.parenL&&this.type!==b.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(t,e);if(i&&(u=i.call(this,u,s,c)),this.type.isAssign){var d=this.startNodeAt(s,c);return d.operator=this.value,d.left=this.type===b.eq?this.toAssignable(u,!1,e):u,n||H.call(e),e.shorthandAssign=-1,this.checkLVal(u),this.next(),d.right=this.parseMaybeAssign(t),this.finishNode(d,"AssignmentExpression")}return n&&this.checkExpressionErrors(e,!0),r>-1&&(e.parenthesizedAssign=r),a>-1&&(e.trailingComma=a),o>-1&&(e.shorthandAssign=o),u},Z.parseMaybeConditional=function(t,e){var i=this.start,n=this.startLoc,r=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return r;if(this.eat(b.question)){var a=this.startNodeAt(i,n);return a.test=r,a.consequent=this.parseMaybeAssign(),this.expect(b.colon),a.alternate=this.parseMaybeAssign(t),this.finishNode(a,"ConditionalExpression")}return r},Z.parseExprOps=function(t,e){var i=this.start,n=this.startLoc,r=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)||r.start===i&&"ArrowFunctionExpression"===r.type?r:this.parseExprOp(r,i,n,-1,t)},Z.parseExprOp=function(t,e,i,n,r){var a=this.type.binop;if(null!=a&&(!r||this.type!==b._in)&&a>n){var o=this.type===b.logicalOR||this.type===b.logicalAND,s=this.value;this.next();var c=this.start,u=this.startLoc,d=this.parseExprOp(this.parseMaybeUnary(null,!1),c,u,a,r),l=this.buildBinary(e,i,t,d,s,o);return this.parseExprOp(l,e,i,n,r)}return t},Z.buildBinary=function(t,e,i,n,r,a){var o=this.startNodeAt(t,e);return o.left=i,o.operator=r,o.right=n,this.finishNode(o,a?"LogicalExpression":"BinaryExpression")},Z.parseMaybeUnary=function(t,e){var i,n=this.start,r=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))i=this.parseAwait(),e=!0;else if(this.type.prefix){var a=this.startNode(),o=this.type===b.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),o?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):e=!0,i=this.finishNode(a,o?"UpdateExpression":"UnaryExpression")}else{if(i=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return i;for(;this.type.postfix&&!this.canInsertSemicolon();){var s=this.startNodeAt(n,r);s.operator=this.value,s.prefix=!1,s.argument=i,this.checkLVal(i),this.next(),i=this.finishNode(s,"UpdateExpression")}}return!e&&this.eat(b.starstar)?this.buildBinary(n,r,i,this.parseMaybeUnary(null,!1),"**",!1):i},Z.parseExprSubscripts=function(t){var e=this.start,i=this.startLoc,n=this.parseExprAtom(t),r="ArrowFunctionExpression"===n.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(t)||r)return n;var a=this.parseSubscripts(n,e,i);return t&&"MemberExpression"===a.type&&(t.parenthesizedAssign>=a.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=a.start&&(t.parenthesizedBind=-1)),a},Z.parseSubscripts=function(t,e,i,n){for(var r=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&"async"===this.input.slice(t.start,t.end);;){var a=this.parseSubscript(t,e,i,n,r);if(a===t||"ArrowFunctionExpression"===a.type)return a;t=a}},Z.parseSubscript=function(t,e,i,n,r){var a=this.eat(b.bracketL);if(a||this.eat(b.dot)){var o=this.startNodeAt(e,i);o.object=t,o.property=a?this.parseExpression():this.parseIdent(!0),o.computed=!!a,a&&this.expect(b.bracketR),t=this.finishNode(o,"MemberExpression")}else if(!n&&this.eat(b.parenL)){var s=new H,c=this.yieldPos,u=this.awaitPos,d=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var l=this.parseExprList(b.parenR,this.options.ecmaVersion>=8,!1,s);if(r&&!this.canInsertSemicolon()&&this.eat(b.arrow))return this.checkPatternErrors(s,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=c,this.awaitPos=u,this.awaitIdentPos=d,this.parseArrowExpression(this.startNodeAt(e,i),l,!0);this.checkExpressionErrors(s,!0),this.yieldPos=c||this.yieldPos,this.awaitPos=u||this.awaitPos,this.awaitIdentPos=d||this.awaitIdentPos;var p=this.startNodeAt(e,i);p.callee=t,p.arguments=l,t=this.finishNode(p,"CallExpression")}else if(this.type===b.backQuote){var h=this.startNodeAt(e,i);h.tag=t,h.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(h,"TaggedTemplateExpression")}return t},Z.parseExprAtom=function(t){this.type===b.slash&&this.readRegexp();var e,i=this.potentialArrowAt===this.start;switch(this.type){case b._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),e=this.startNode(),this.next(),this.type!==b.parenL||this.allowDirectSuper||this.raise(e.start,"super() call outside constructor of a subclass"),this.type!==b.dot&&this.type!==b.bracketL&&this.type!==b.parenL&&this.unexpected(),this.finishNode(e,"Super");case b._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case b.name:var n=this.start,r=this.startLoc,a=this.containsEsc,o=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!a&&"async"===o.name&&!this.canInsertSemicolon()&&this.eat(b._function))return this.parseFunction(this.startNodeAt(n,r),0,!1,!0);if(i&&!this.canInsertSemicolon()){if(this.eat(b.arrow))return this.parseArrowExpression(this.startNodeAt(n,r),[o],!1);if(this.options.ecmaVersion>=8&&"async"===o.name&&this.type===b.name&&!a)return o=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(b.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(n,r),[o],!0)}return o;case b.regexp:var s=this.value;return(e=this.parseLiteral(s.value)).regex={pattern:s.pattern,flags:s.flags},e;case b.num:case b.string:return this.parseLiteral(this.value);case b._null:case b._true:case b._false:return(e=this.startNode()).value=this.type===b._null?null:this.type===b._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case b.parenL:var c=this.start,u=this.parseParenAndDistinguishExpression(i);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(u)&&(t.parenthesizedAssign=c),t.parenthesizedBind<0&&(t.parenthesizedBind=c)),u;case b.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(b.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case b.braceL:return this.parseObj(!1,t);case b._function:return e=this.startNode(),this.next(),this.parseFunction(e,0);case b._class:return this.parseClass(this.startNode(),!1);case b._new:return this.parseNew();case b.backQuote:return this.parseTemplate();default:this.unexpected()}},Z.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(e,"Literal")},Z.parseParenExpression=function(){this.expect(b.parenL);var t=this.parseExpression();return this.expect(b.parenR),t},Z.parseParenAndDistinguishExpression=function(t){var e,i=this.start,n=this.startLoc,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,o=this.start,s=this.startLoc,c=[],u=!0,d=!1,l=new H,p=this.yieldPos,h=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==b.parenR;){if(u?u=!1:this.expect(b.comma),r&&this.afterTrailingComma(b.parenR,!0)){d=!0;break}if(this.type===b.ellipsis){a=this.start,c.push(this.parseParenItem(this.parseRestBinding())),this.type===b.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}c.push(this.parseMaybeAssign(!1,l,this.parseParenItem))}var f=this.start,m=this.startLoc;if(this.expect(b.parenR),t&&!this.canInsertSemicolon()&&this.eat(b.arrow))return this.checkPatternErrors(l,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=p,this.awaitPos=h,this.parseParenArrowList(i,n,c);c.length&&!d||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(l,!0),this.yieldPos=p||this.yieldPos,this.awaitPos=h||this.awaitPos,c.length>1?((e=this.startNodeAt(o,s)).expressions=c,this.finishNodeAt(e,"SequenceExpression",f,m)):e=c[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var g=this.startNodeAt(i,n);return g.expression=e,this.finishNode(g,"ParenthesizedExpression")}return e},Z.parseParenItem=function(t){return t},Z.parseParenArrowList=function(t,e,i){return this.parseArrowExpression(this.startNodeAt(t,e),i)};var X=[];Z.parseNew=function(){var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(b.dot)){t.meta=e;var i=this.containsEsc;return t.property=this.parseIdent(!0),("target"!==t.property.name||i)&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is new.target"),this.inNonArrowFunction()||this.raiseRecoverable(t.start,"new.target can only be used in functions"),this.finishNode(t,"MetaProperty")}var n=this.start,r=this.startLoc;return t.callee=this.parseSubscripts(this.parseExprAtom(),n,r,!0),t.arguments=this.eat(b.parenL)?this.parseExprList(b.parenR,this.options.ecmaVersion>=8,!1):X,this.finishNode(t,"NewExpression")},Z.parseTemplateElement=function(t){var e=t.isTagged,i=this.startNode();return this.type===b.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value,cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),i.tail=this.type===b.backQuote,this.finishNode(i,"TemplateElement")},Z.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var i=this.startNode();this.next(),i.expressions=[];var n=this.parseTemplateElement({isTagged:e});for(i.quasis=[n];!n.tail;)this.type===b.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(b.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(b.braceR),i.quasis.push(n=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(i,"TemplateLiteral")},Z.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===b.name||this.type===b.num||this.type===b.string||this.type===b.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===b.star)&&!U.test(this.input.slice(this.lastTokEnd,this.start))},Z.parseObj=function(t,e){var i=this.startNode(),n=!0,r={};for(i.properties=[],this.next();!this.eat(b.braceR);){if(n)n=!1;else if(this.expect(b.comma),this.afterTrailingComma(b.braceR))break;var a=this.parseProperty(t,e);t||this.checkPropClash(a,r,e),i.properties.push(a)}return this.finishNode(i,t?"ObjectPattern":"ObjectExpression")},Z.parseProperty=function(t,e){var i,n,r,a,o=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(b.ellipsis))return t?(o.argument=this.parseIdent(!1),this.type===b.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(o,"RestElement")):(this.type===b.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),o.argument=this.parseMaybeAssign(!1,e),this.type===b.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(o,"SpreadElement"));this.options.ecmaVersion>=6&&(o.method=!1,o.shorthand=!1,(t||e)&&(r=this.start,a=this.startLoc),t||(i=this.eat(b.star)));var s=this.containsEsc;return this.parsePropertyName(o),!t&&!s&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(o)?(n=!0,i=this.options.ecmaVersion>=9&&this.eat(b.star),this.parsePropertyName(o,e)):n=!1,this.parsePropertyValue(o,t,i,n,r,a,e,s),this.finishNode(o,"Property")},Z.parsePropertyValue=function(t,e,i,n,r,a,o,s){(i||n)&&this.type===b.colon&&this.unexpected(),this.eat(b.colon)?(t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,o),t.kind="init"):this.options.ecmaVersion>=6&&this.type===b.parenL?(e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(i,n)):e||s||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===b.comma||this.type===b.braceR?this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?((i||n)&&this.unexpected(),this.checkUnreserved(t.key),"await"!==t.key.name||this.awaitIdentPos||(this.awaitIdentPos=r),t.kind="init",e?t.value=this.parseMaybeDefault(r,a,t.key):this.type===b.eq&&o?(o.shorthandAssign<0&&(o.shorthandAssign=this.start),t.value=this.parseMaybeDefault(r,a,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected():((i||n)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1),t.value.params.length!==("get"===t.kind?0:1)?this.raiseRecoverable(t.value.start,"get"===t.kind?"getter should have no params":"setter should have exactly one param"):"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params"))},Z.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(b.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(b.bracketR),t.key;t.computed=!1}return t.key=this.type===b.num||this.type===b.string?this.parseExprAtom():this.parseIdent(!0)},Z.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},Z.parseMethod=function(t,e,i){var n=this.startNode(),r=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.initFunction(n),this.options.ecmaVersion>=6&&(n.generator=t),this.options.ecmaVersion>=8&&(n.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(64|F(e,n.generator)|(i?128:0)),this.expect(b.parenL),n.params=this.parseBindingList(b.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(n,!1,!0),this.yieldPos=r,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(n,"FunctionExpression")},Z.parseArrowExpression=function(t,e,i){var n=this.yieldPos,r=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(16|F(i,!1)),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!i),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0,!1),this.yieldPos=n,this.awaitPos=r,this.awaitIdentPos=a,this.finishNode(t,"ArrowFunctionExpression")},Z.parseFunctionBody=function(t,e,i){var n=this.strict,r=!1;if(e&&this.type!==b.braceL)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);n&&!a||(r=this.strictDirective(this.end))&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var o=this.labels;this.labels=[],r&&(this.strict=!0),this.checkParams(t,!n&&!r&&!e&&!i&&this.isSimpleParamList(t.params)),t.body=this.parseBlock(!1),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=o}this.exitScope(),this.strict&&t.id&&this.checkLVal(t.id,5),this.strict=n},Z.isSimpleParamList=function(t){for(var e=0,i=t;e<i.length;e+=1)if("Identifier"!==i[e].type)return!1;return!0},Z.checkParams=function(t,e){for(var i={},n=0,r=t.params;n<r.length;n+=1)this.checkLVal(r[n],1,e?null:i)},Z.parseExprList=function(t,e,i,n){for(var r=[],a=!0;!this.eat(t);){if(a)a=!1;else if(this.expect(b.comma),e&&this.afterTrailingComma(t))break;var o=void 0;i&&this.type===b.comma?o=null:this.type===b.ellipsis?(o=this.parseSpread(n),n&&this.type===b.comma&&n.trailingComma<0&&(n.trailingComma=this.start)):o=this.parseMaybeAssign(!1,n),r.push(o)}return r},Z.checkUnreserved=function(t){var e=t.start,i=t.end,n=t.name;this.inGenerator&&"yield"===n&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===n&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(n)&&this.raise(e,"Unexpected keyword '"+n+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(e,i).indexOf("\\")||(this.strict?this.reservedWordsStrict:this.reservedWords).test(n)&&(this.inAsync||"await"!==n||this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+n+"' is reserved"))},Z.parseIdent=function(t,e){var i=this.startNode();return t&&"never"===this.options.allowReserved&&(t=!1),this.type===b.name?i.name=this.value:this.type.keyword?(i.name=this.type.keyword,"class"!==i.name&&"function"!==i.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(i,"Identifier"),t||(this.checkUnreserved(i),"await"!==i.name||this.awaitIdentPos||(this.awaitIdentPos=i.start)),i},Z.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===b.semi||this.canInsertSemicolon()||this.type!==b.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(b.star),e.argument=this.parseMaybeAssign(t)),this.finishNode(e,"YieldExpression")},Z.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0),this.finishNode(t,"AwaitExpression")};var Q=j.prototype;Q.raise=function(t,e){var i=L(this.input,t),n=new SyntaxError(e+=" ("+i.line+":"+i.column+")");throw n.pos=t,n.loc=i,n.raisedAt=this.pos,n},Q.raiseRecoverable=Q.raise,Q.curPosition=function(){if(this.options.locations)return new k(this.curLine,this.pos-this.lineStart)};var tt=j.prototype,et=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};tt.enterScope=function(t){this.scopeStack.push(new et(t))},tt.exitScope=function(){this.scopeStack.pop()},tt.treatFunctionsAsVarInScope=function(t){return 2&t.flags||!this.inModule&&1&t.flags},tt.declareName=function(t,e,i){var n=!1;if(2===e){var r=this.currentScope();n=r.lexical.indexOf(t)>-1||r.functions.indexOf(t)>-1||r.var.indexOf(t)>-1,r.lexical.push(t),this.inModule&&1&r.flags&&delete this.undefinedExports[t]}else if(4===e)this.currentScope().lexical.push(t);else if(3===e){var a=this.currentScope();n=this.treatFunctionsAsVar?a.lexical.indexOf(t)>-1:a.lexical.indexOf(t)>-1||a.var.indexOf(t)>-1,a.functions.push(t)}else for(var o=this.scopeStack.length-1;o>=0;--o){var s=this.scopeStack[o];if(s.lexical.indexOf(t)>-1&&!(32&s.flags&&s.lexical[0]===t)||!this.treatFunctionsAsVarInScope(s)&&s.functions.indexOf(t)>-1){n=!0;break}if(s.var.push(t),this.inModule&&1&s.flags&&delete this.undefinedExports[t],3&s.flags)break}n&&this.raiseRecoverable(i,"Identifier '"+t+"' has already been declared")},tt.checkLocalExport=function(t){-1===this.scopeStack[0].lexical.indexOf(t.name)&&-1===this.scopeStack[0].var.indexOf(t.name)&&(this.undefinedExports[t.name]=t)},tt.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},tt.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags)return e}},tt.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(3&e.flags&&!(16&e.flags))return e}};var it=function(t,e,i){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new O(t,i)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])},nt=j.prototype;function rt(t,e,i,n){return t.type=e,t.end=i,this.options.locations&&(t.loc.end=n),this.options.ranges&&(t.range[1]=i),t}nt.startNode=function(){return new it(this,this.start,this.startLoc)},nt.startNodeAt=function(t,e){return new it(this,t,e)},nt.finishNode=function(t,e){return rt.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},nt.finishNodeAt=function(t,e,i,n){return rt.call(this,t,e,i,n)};var at=function(t,e,i,n,r){this.token=t,this.isExpr=!!e,this.preserveSpace=!!i,this.override=n,this.generator=!!r},ot={b_stat:new at("{",!1),b_expr:new at("{",!0),b_tmpl:new at("${",!1),p_stat:new at("(",!1),p_expr:new at("(",!0),q_tmpl:new at("`",!0,!0,(function(t){return t.tryReadTemplateToken()})),f_stat:new at("function",!1),f_expr:new at("function",!0),f_expr_gen:new at("function",!0,!1,null,!0),f_gen:new at("function",!1,!1,null,!0)},st=j.prototype;st.initialContext=function(){return[ot.b_stat]},st.braceIsBlock=function(t){var e=this.curContext();return e===ot.f_expr||e===ot.f_stat||(t!==b.colon||e!==ot.b_stat&&e!==ot.b_expr?t===b._return||t===b.name&&this.exprAllowed?U.test(this.input.slice(this.lastTokEnd,this.start)):t===b._else||t===b.semi||t===b.eof||t===b.parenR||t===b.arrow||(t===b.braceL?e===ot.b_stat:t!==b._var&&t!==b._const&&t!==b.name&&!this.exprAllowed):!e.isExpr)},st.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},st.updateContext=function(t){var e,i=this.type;i.keyword&&t===b.dot?this.exprAllowed=!1:(e=i.updateContext)?e.call(this,t):this.exprAllowed=i.beforeExpr},b.parenR.updateContext=b.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===ot.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},b.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?ot.b_stat:ot.b_expr),this.exprAllowed=!0},b.dollarBraceL.updateContext=function(){this.context.push(ot.b_tmpl),this.exprAllowed=!0},b.parenL.updateContext=function(t){this.context.push(t===b._if||t===b._for||t===b._with||t===b._while?ot.p_stat:ot.p_expr),this.exprAllowed=!0},b.incDec.updateContext=function(){},b._function.updateContext=b._class.updateContext=function(t){!t.beforeExpr||t===b.semi||t===b._else||t===b._return&&U.test(this.input.slice(this.lastTokEnd,this.start))||(t===b.colon||t===b.braceL)&&this.curContext()===ot.b_stat?this.context.push(ot.f_stat):this.context.push(ot.f_expr),this.exprAllowed=!1},b.backQuote.updateContext=function(){this.curContext()===ot.q_tmpl?this.context.pop():this.context.push(ot.q_tmpl),this.exprAllowed=!1},b.star.updateContext=function(t){if(t===b._function){var e=this.context.length-1;this.context[e]=this.context[e]===ot.f_expr?ot.f_expr_gen:ot.f_gen}this.exprAllowed=!0},b.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==b.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var ct="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ut={9:ct,10:ct+" Extended_Pictographic"},dt="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",lt="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",pt={9:lt,10:lt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd"},ht={};function ft(t){var e=ht[t]={binary:R(ut[t]+" "+dt),nonBinary:{General_Category:R(dt),Script:R(pt[t])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}ft(9),ft(10);var mt=j.prototype,gt=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ht[t.options.ecmaVersion>=10?10:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function vt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function yt(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function It(t){return t>=65&&t<=90||t>=97&&t<=122}function wt(t){return It(t)||95===t}function St(t){return wt(t)||bt(t)}function bt(t){return t>=48&&t<=57}function Ut(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function Nt(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function Pt(t){return t>=48&&t<=55}gt.prototype.reset=function(t,e,i){var n=-1!==i.indexOf("u");this.start=0|t,this.source=e+"",this.flags=i,this.switchU=n&&this.parser.options.ecmaVersion>=6,this.switchN=n&&this.parser.options.ecmaVersion>=9},gt.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},gt.prototype.at=function(t){var e=this.source,i=e.length;if(t>=i)return-1;var n=e.charCodeAt(t);return!this.switchU||n<=55295||n>=57344||t+1>=i?n:(n<<10)+e.charCodeAt(t+1)-56613888},gt.prototype.nextIndex=function(t){var e=this.source,i=e.length;if(t>=i)return i;var n=e.charCodeAt(t);return!this.switchU||n<=55295||n>=57344||t+1>=i?t+1:t+2},gt.prototype.current=function(){return this.at(this.pos)},gt.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},gt.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},gt.prototype.eat=function(t){return this.current()===t&&(this.advance(),!0)},mt.validateRegExpFlags=function(t){for(var e=t.validFlags,i=t.flags,n=0;n<i.length;n++){var r=i.charAt(n);-1===e.indexOf(r)&&this.raise(t.start,"Invalid regular expression flag"),i.indexOf(r,n+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},mt.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},mt.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,i=t.backReferenceNames;e<i.length;e+=1)-1===t.groupNames.indexOf(i[e])&&t.raise("Invalid named capture referenced")},mt.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},mt.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},mt.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!(t.switchU?!this.regexp_eatAtom(t):!this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},mt.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!i,!0}return t.pos=e,!1},mt.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},mt.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},mt.regexp_eatBracedQuantifier=function(t,e){var i=t.pos;if(t.eat(123)){var n=0,r=-1;if(this.regexp_eatDecimalDigits(t)&&(n=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue),t.eat(125)))return-1!==r&&r<n&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=i}return!1},mt.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},mt.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},mt.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},mt.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},mt.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},mt.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},mt.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!yt(e)&&(t.lastIntValue=e,t.advance(),!0)},mt.regexp_eatPatternCharacters=function(t){for(var e=t.pos,i=0;-1!==(i=t.current())&&!yt(i);)t.advance();return t.pos!==e},mt.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e||(t.advance(),0))},mt.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},mt.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},mt.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=vt(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=vt(t.lastIntValue);return!0}return!1},mt.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,i=t.current();return t.advance(),92===i&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(i=t.lastIntValue),function(t){return f(t,!0)||36===t||95===t}(i)?(t.lastIntValue=i,!0):(t.pos=e,!1)},mt.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,i=t.current();return t.advance(),92===i&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(i=t.lastIntValue),function(t){return m(t,!0)||36===t||95===t||8204===t||8205===t}(i)?(t.lastIntValue=i,!0):(t.pos=e,!1)},mt.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},mt.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var i=t.lastIntValue;if(t.switchU)return i>t.maxBackReference&&(t.maxBackReference=i),!0;if(i<=t.numCapturingParens)return!0;t.pos=e}return!1},mt.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},mt.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},mt.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},mt.regexp_eatZero=function(t){return 48===t.current()&&!bt(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},mt.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},mt.regexp_eatControlLetter=function(t){var e=t.current();return!!It(e)&&(t.lastIntValue=e%32,t.advance(),!0)},mt.regexp_eatRegExpUnicodeEscapeSequence=function(t){var e,i=t.pos;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var n=t.lastIntValue;if(t.switchU&&n>=55296&&n<=56319){var r=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var a=t.lastIntValue;if(a>=56320&&a<=57343)return t.lastIntValue=1024*(n-55296)+(a-56320)+65536,!0}t.pos=r,t.lastIntValue=n}return!0}if(t.switchU&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&(e=t.lastIntValue)>=0&&e<=1114111)return!0;t.switchU&&t.raise("Invalid unicode escape"),t.pos=i}return!1},mt.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e||(t.lastIntValue=e,t.advance(),0))},mt.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},mt.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(function(t){return 100===t||68===t||115===t||83===t||119===t||87===t}(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},mt.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var i=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t))return this.regexp_validateUnicodePropertyNameAndValue(t,i,t.lastStringValue),!0}return t.pos=e,!!this.regexp_eatLoneUnicodePropertyNameOrValue(t)&&(this.regexp_validateUnicodePropertyNameOrValue(t,t.lastStringValue),!0)},mt.regexp_validateUnicodePropertyNameAndValue=function(t,e,i){M(t.unicodeProperties.nonBinary,e)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[e].test(i)||t.raise("Invalid property value")},mt.regexp_validateUnicodePropertyNameOrValue=function(t,e){t.unicodeProperties.binary.test(e)||t.raise("Invalid property name")},mt.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";wt(e=t.current());)t.lastStringValue+=vt(e),t.advance();return""!==t.lastStringValue},mt.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";St(e=t.current());)t.lastStringValue+=vt(e),t.advance();return""!==t.lastStringValue},mt.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},mt.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},mt.regexp_classRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var i=t.lastIntValue;!t.switchU||-1!==e&&-1!==i||t.raise("Invalid character class"),-1!==e&&-1!==i&&e>i&&t.raise("Range out of order in character class")}}},mt.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var i=t.current();(99===i||Pt(i))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var n=t.current();return 93!==n&&(t.lastIntValue=n,t.advance(),!0)},mt.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},mt.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!bt(e)&&95!==e||(t.lastIntValue=e%32,t.advance(),0))},mt.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},mt.regexp_eatDecimalDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;bt(i=t.current());)t.lastIntValue=10*t.lastIntValue+(i-48),t.advance();return t.pos!==e},mt.regexp_eatHexDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;Ut(i=t.current());)t.lastIntValue=16*t.lastIntValue+Nt(i),t.advance();return t.pos!==e},mt.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var i=t.lastIntValue;t.lastIntValue=e<=3&&this.regexp_eatOctalDigit(t)?64*e+8*i+t.lastIntValue:8*e+i}else t.lastIntValue=e;return!0}return!1},mt.regexp_eatOctalDigit=function(t){var e=t.current();return Pt(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},mt.regexp_eatFixedHexDigits=function(t,e){var i=t.pos;t.lastIntValue=0;for(var n=0;n<e;++n){var r=t.current();if(!Ut(r))return t.pos=i,!1;t.lastIntValue=16*t.lastIntValue+Nt(r),t.advance()}return!0};var Et=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new O(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},Dt=j.prototype;function At(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}Dt.next=function(){this.options.onToken&&this.options.onToken(new Et(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Dt.getToken=function(){return this.next(),new Et(this)},"undefined"!=typeof Symbol&&(Dt[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===b.eof,value:e}}}}),Dt.curContext=function(){return this.context[this.context.length-1]},Dt.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(b.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},Dt.readToken=function(t){return f(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},Dt.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);return t<=55295||t>=57344?t:(t<<10)+this.input.charCodeAt(this.pos+1)-56613888},Dt.skipBlockComment=function(){var t,e=this.options.onComment&&this.curPosition(),i=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(-1===n&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations)for(N.lastIndex=i;(t=N.exec(this.input))&&t.index<this.pos;)++this.curLine,this.lineStart=t.index+t[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(i+2,n),i,this.pos,e,this.curPosition())},Dt.skipLineComment=function(t){for(var e=this.pos,i=this.options.onComment&&this.curPosition(),n=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!P(n);)n=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,i,this.curPosition())},Dt.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&E.test(String.fromCharCode(t))))break t;++this.pos}}},Dt.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=t,this.value=e,this.updateContext(i)},Dt.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(b.ellipsis)):(++this.pos,this.finishToken(b.dot))},Dt.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(b.assign,2):this.finishOp(b.slash,1)},Dt.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),i=1,n=42===t?b.star:b.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++i,n=b.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(b.assign,i+1):this.finishOp(n,i)},Dt.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?this.finishOp(124===t?b.logicalOR:b.logicalAND,2):61===e?this.finishOp(b.assign,2):this.finishOp(124===t?b.bitwiseOR:b.bitwiseAND,1)},Dt.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(b.assign,2):this.finishOp(b.bitwiseXOR,1)},Dt.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!U.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(b.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(b.assign,2):this.finishOp(b.plusMin,1)},Dt.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),i=1;return e===t?(i=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+i)?this.finishOp(b.assign,i+1):this.finishOp(b.bitShift,i)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(i=2),this.finishOp(b.relational,i)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},Dt.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(b.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(b.arrow)):this.finishOp(61===t?b.eq:b.prefix,1)},Dt.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(b.parenL);case 41:return++this.pos,this.finishToken(b.parenR);case 59:return++this.pos,this.finishToken(b.semi);case 44:return++this.pos,this.finishToken(b.comma);case 91:return++this.pos,this.finishToken(b.bracketL);case 93:return++this.pos,this.finishToken(b.bracketR);case 123:return++this.pos,this.finishToken(b.braceL);case 125:return++this.pos,this.finishToken(b.braceR);case 58:return++this.pos,this.finishToken(b.colon);case 63:return++this.pos,this.finishToken(b.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(b.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 126:return this.finishOp(b.prefix,1)}this.raise(this.pos,"Unexpected character '"+At(t)+"'")},Dt.finishOp=function(t,e){var i=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,i)},Dt.readRegexp=function(){for(var t,e,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var n=this.input.charAt(this.pos);if(U.test(n)&&this.raise(i,"Unterminated regular expression"),t)t=!1;else{if("["===n)e=!0;else if("]"===n&&e)e=!1;else if("/"===n&&!e)break;t="\\"===n}++this.pos}var r=this.input.slice(i,this.pos);++this.pos;var a=this.pos,o=this.readWord1();this.containsEsc&&this.unexpected(a);var s=this.regexpState||(this.regexpState=new gt(this));s.reset(i,r,o),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var c=null;try{c=new RegExp(r,o)}catch(t){}return this.finishToken(b.regexp,{pattern:r,flags:o,value:c})},Dt.readInt=function(t,e){for(var i=this.pos,n=0,r=0,a=null==e?1/0:e;r<a;++r){var o,s=this.input.charCodeAt(this.pos);if((o=s>=97?s-97+10:s>=65?s-65+10:s>=48&&s<=57?s-48:1/0)>=t)break;++this.pos,n=n*t+o}return this.pos===i||null!=e&&this.pos-i!==e?null:n},Dt.readRadixNumber=function(t){this.pos+=2;var e=this.readInt(t);return null==e&&this.raise(this.start+2,"Expected number in radix "+t),f(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(b.num,e)},Dt.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10)||this.raise(e,"Invalid number");var i=this.pos-e>=2&&48===this.input.charCodeAt(e);i&&this.strict&&this.raise(e,"Invalid number"),i&&/[89]/.test(this.input.slice(e,this.pos))&&(i=!1);var n=this.input.charCodeAt(this.pos);46!==n||i||(++this.pos,this.readInt(10),n=this.input.charCodeAt(this.pos)),69!==n&&101!==n||i||(43!==(n=this.input.charCodeAt(++this.pos))&&45!==n||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),f(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=this.input.slice(e,this.pos),a=i?parseInt(r,8):parseFloat(r);return this.finishToken(b.num,a)},Dt.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var e=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(e,"Code point out of bounds")}else t=this.readHexChar(4);return t},Dt.readString=function(t){for(var e="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var n=this.input.charCodeAt(this.pos);if(n===t)break;92===n?(e+=this.input.slice(i,this.pos),e+=this.readEscapedChar(!1),i=this.pos):(P(n,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(i,this.pos++),this.finishToken(b.string,e)};var Tt={};Dt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n!==Tt)throw n;this.readInvalidTemplateToken()}this.inTemplateElement=!1},Dt.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Tt;this.raise(t,e)},Dt.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(96===i||36===i&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==b.template&&this.type!==b.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(b.template,t)):36===i?(this.pos+=2,this.finishToken(b.dollarBraceL)):(++this.pos,this.finishToken(b.backQuote));if(92===i)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(P(i)){switch(t+=this.input.slice(e,this.pos),++this.pos,i){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(i)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},Dt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(b.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Dt.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return At(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],n=parseInt(i,8);return n>255&&(i=i.slice(0,-1),n=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),"0"===i&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-i.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(n)}return P(e)?"":String.fromCharCode(e)}},Dt.readHexChar=function(t){var e=this.pos,i=this.readInt(16,t);return null===i&&this.invalidStringToken(e,"Bad character escape sequence"),i},Dt.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,i=this.pos,n=this.options.ecmaVersion>=6;this.pos<this.input.length;){var r=this.fullCharCodeAtPos();if(m(r,n))this.pos+=r<=65535?1:2;else{if(92!==r)break;this.containsEsc=!0,t+=this.input.slice(i,this.pos);var a=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var o=this.readCodePoint();(e?f:m)(o,n)||this.invalidStringToken(a,"Invalid Unicode escape"),t+=At(o),i=this.pos}e=!1}return t+this.input.slice(i,this.pos)},Dt.readWord=function(){var t=this.readWord1(),e=b.name;return this.keywords.test(t)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+t),e=w[t]),this.finishToken(e,t)};var Ct={quot:'"',amp:"&",apos:"'",lt:"<",gt:">",nbsp:"\xa0",iexcl:"\xa1",cent:"\xa2",pound:"\xa3",curren:"\xa4",yen:"\xa5",brvbar:"\xa6",sect:"\xa7",uml:"\xa8",copy:"\xa9",ordf:"\xaa",laquo:"\xab",not:"\xac",shy:"\xad",reg:"\xae",macr:"\xaf",deg:"\xb0",plusmn:"\xb1",sup2:"\xb2",sup3:"\xb3",acute:"\xb4",micro:"\xb5",para:"\xb6",middot:"\xb7",cedil:"\xb8",sup1:"\xb9",ordm:"\xba",raquo:"\xbb",frac14:"\xbc",frac12:"\xbd",frac34:"\xbe",iquest:"\xbf",Agrave:"\xc0",Aacute:"\xc1",Acirc:"\xc2",Atilde:"\xc3",Auml:"\xc4",Aring:"\xc5",AElig:"\xc6",Ccedil:"\xc7",Egrave:"\xc8",Eacute:"\xc9",Ecirc:"\xca",Euml:"\xcb",Igrave:"\xcc",Iacute:"\xcd",Icirc:"\xce",Iuml:"\xcf",ETH:"\xd0",Ntilde:"\xd1",Ograve:"\xd2",Oacute:"\xd3",Ocirc:"\xd4",Otilde:"\xd5",Ouml:"\xd6",times:"\xd7",Oslash:"\xd8",Ugrave:"\xd9",Uacute:"\xda",Ucirc:"\xdb",Uuml:"\xdc",Yacute:"\xdd",THORN:"\xde",szlig:"\xdf",agrave:"\xe0",aacute:"\xe1",acirc:"\xe2",atilde:"\xe3",auml:"\xe4",aring:"\xe5",aelig:"\xe6",ccedil:"\xe7",egrave:"\xe8",eacute:"\xe9",ecirc:"\xea",euml:"\xeb",igrave:"\xec",iacute:"\xed",icirc:"\xee",iuml:"\xef",eth:"\xf0",ntilde:"\xf1",ograve:"\xf2",oacute:"\xf3",ocirc:"\xf4",otilde:"\xf5",ouml:"\xf6",divide:"\xf7",oslash:"\xf8",ugrave:"\xf9",uacute:"\xfa",ucirc:"\xfb",uuml:"\xfc",yacute:"\xfd",thorn:"\xfe",yuml:"\xff",OElig:"\u0152",oelig:"\u0153",Scaron:"\u0160",scaron:"\u0161",Yuml:"\u0178",fnof:"\u0192",circ:"\u02c6",tilde:"\u02dc",Alpha:"\u0391",Beta:"\u0392",Gamma:"\u0393",Delta:"\u0394",Epsilon:"\u0395",Zeta:"\u0396",Eta:"\u0397",Theta:"\u0398",Iota:"\u0399",Kappa:"\u039a",Lambda:"\u039b",Mu:"\u039c",Nu:"\u039d",Xi:"\u039e",Omicron:"\u039f",Pi:"\u03a0",Rho:"\u03a1",Sigma:"\u03a3",Tau:"\u03a4",Upsilon:"\u03a5",Phi:"\u03a6",Chi:"\u03a7",Psi:"\u03a8",Omega:"\u03a9",alpha:"\u03b1",beta:"\u03b2",gamma:"\u03b3",delta:"\u03b4",epsilon:"\u03b5",zeta:"\u03b6",eta:"\u03b7",theta:"\u03b8",iota:"\u03b9",kappa:"\u03ba",lambda:"\u03bb",mu:"\u03bc",nu:"\u03bd",xi:"\u03be",omicron:"\u03bf",pi:"\u03c0",rho:"\u03c1",sigmaf:"\u03c2",sigma:"\u03c3",tau:"\u03c4",upsilon:"\u03c5",phi:"\u03c6",chi:"\u03c7",psi:"\u03c8",omega:"\u03c9",thetasym:"\u03d1",upsih:"\u03d2",piv:"\u03d6",ensp:"\u2002",emsp:"\u2003",thinsp:"\u2009",zwnj:"\u200c",zwj:"\u200d",lrm:"\u200e",rlm:"\u200f",ndash:"\u2013",mdash:"\u2014",lsquo:"\u2018",rsquo:"\u2019",sbquo:"\u201a",ldquo:"\u201c",rdquo:"\u201d",bdquo:"\u201e",dagger:"\u2020",Dagger:"\u2021",bull:"\u2022",hellip:"\u2026",permil:"\u2030",prime:"\u2032",Prime:"\u2033",lsaquo:"\u2039",rsaquo:"\u203a",oline:"\u203e",frasl:"\u2044",euro:"\u20ac",image:"\u2111",weierp:"\u2118",real:"\u211c",trade:"\u2122",alefsym:"\u2135",larr:"\u2190",uarr:"\u2191",rarr:"\u2192",darr:"\u2193",harr:"\u2194",crarr:"\u21b5",lArr:"\u21d0",uArr:"\u21d1",rArr:"\u21d2",dArr:"\u21d3",hArr:"\u21d4",forall:"\u2200",part:"\u2202",exist:"\u2203",empty:"\u2205",nabla:"\u2207",isin:"\u2208",notin:"\u2209",ni:"\u220b",prod:"\u220f",sum:"\u2211",minus:"\u2212",lowast:"\u2217",radic:"\u221a",prop:"\u221d",infin:"\u221e",ang:"\u2220",and:"\u2227",or:"\u2228",cap:"\u2229",cup:"\u222a",int:"\u222b",there4:"\u2234",sim:"\u223c",cong:"\u2245",asymp:"\u2248",ne:"\u2260",equiv:"\u2261",le:"\u2264",ge:"\u2265",sub:"\u2282",sup:"\u2283",nsub:"\u2284",sube:"\u2286",supe:"\u2287",oplus:"\u2295",otimes:"\u2297",perp:"\u22a5",sdot:"\u22c5",lceil:"\u2308",rceil:"\u2309",lfloor:"\u230a",rfloor:"\u230b",lang:"\u2329",rang:"\u232a",loz:"\u25ca",spades:"\u2660",clubs:"\u2663",hearts:"\u2665",diams:"\u2666"},Mt={version:"6.1.1",parse:function(t,e){return j.parse(t,e)},parseExpressionAt:function(t,e,i){return j.parseExpressionAt(t,e,i)},tokenizer:function(t,e){return j.tokenizer(t,e)},Parser:j,defaultOptions:_,Position:k,SourceLocation:O,getLineInfo:L,Node:it,TokenType:g,tokTypes:b,keywordTypes:w,TokContext:at,tokContexts:ot,isIdentifierChar:m,isIdentifierStart:f,Token:Et,isNewLine:P,lineBreak:U,lineBreakG:N,nonASCIIwhitespace:E};const xt=/^[\da-fA-F]+$/,Rt=/^\d+$/,kt=Mt.tokTypes,Ot=Mt.TokContext,Lt=Mt.tokContexts,_t=Mt.TokenType,Ft=Mt.isNewLine,jt=Mt.isIdentifierStart,Bt=Mt.isIdentifierChar,Vt=new Ot("<tag",!1),Gt=new Ot("</tag",!1),Ht=new Ot("<tag>...</tag>",!0,!0),Wt={jsxName:new _t("jsxName"),jsxText:new _t("jsxText",{beforeExpr:!0}),jsxTagStart:new _t("jsxTagStart"),jsxTagEnd:new _t("jsxTagEnd")};function qt(t){return t?"JSXIdentifier"===t.type?t.name:"JSXNamespacedName"===t.type?t.namespace.name+":"+t.name.name:"JSXMemberExpression"===t.type?qt(t.object)+"."+qt(t.property):void 0:t}Wt.jsxTagStart.updateContext=function(){this.context.push(Ht),this.context.push(Vt),this.exprAllowed=!1},Wt.jsxTagEnd.updateContext=function(t){let e=this.context.pop();e===Vt&&t===kt.slash||e===Gt?(this.context.pop(),this.exprAllowed=this.curContext()===Ht):this.exprAllowed=!0};var zt=function(t){return t=t||{},function(e){return function(t,e){return class extends e{jsx_readToken(){let t="",e=this.pos;for(;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated JSX contents");let i=this.input.charCodeAt(this.pos);switch(i){case 60:case 123:return this.pos===this.start?60===i&&this.exprAllowed?(++this.pos,this.finishToken(Wt.jsxTagStart)):this.getTokenFromCode(i):(t+=this.input.slice(e,this.pos),this.finishToken(Wt.jsxText,t));case 38:t+=this.input.slice(e,this.pos),t+=this.jsx_readEntity(),e=this.pos;break;default:Ft(i)?(t+=this.input.slice(e,this.pos),t+=this.jsx_readNewLine(!0),e=this.pos):++this.pos}}}jsx_readNewLine(t){let e,i=this.input.charCodeAt(this.pos);return++this.pos,13===i&&10===this.input.charCodeAt(this.pos)?(++this.pos,e=t?"\n":"\r\n"):e=String.fromCharCode(i),this.options.locations&&(++this.curLine,this.lineStart=this.pos),e}jsx_readString(t){let e="",i=++this.pos;for(;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");let n=this.input.charCodeAt(this.pos);if(n===t)break;38===n?(e+=this.input.slice(i,this.pos),e+=this.jsx_readEntity(),i=this.pos):Ft(n)?(e+=this.input.slice(i,this.pos),e+=this.jsx_readNewLine(!1),i=this.pos):++this.pos}return e+=this.input.slice(i,this.pos++),this.finishToken(kt.string,e)}jsx_readEntity(){let t,e="",i=0,n=this.input[this.pos];"&"!==n&&this.raise(this.pos,"Entity must start with an ampersand");let r=++this.pos;for(;this.pos<this.input.length&&i++<10;){if(";"===(n=this.input[this.pos++])){"#"===e[0]?"x"===e[1]?(e=e.substr(2),xt.test(e)&&(t=String.fromCharCode(parseInt(e,16)))):(e=e.substr(1),Rt.test(e)&&(t=String.fromCharCode(parseInt(e,10)))):t=Ct[e];break}e+=n}return t||(this.pos=r,"&")}jsx_readWord(){let t,e=this.pos;do{t=this.input.charCodeAt(++this.pos)}while(Bt(t)||45===t);return this.finishToken(Wt.jsxName,this.input.slice(e,this.pos))}jsx_parseIdentifier(){let t=this.startNode();return this.type===Wt.jsxName?t.name=this.value:this.type.keyword?t.name=this.type.keyword:this.unexpected(),this.next(),this.finishNode(t,"JSXIdentifier")}jsx_parseNamespacedName(){let e=this.start,i=this.startLoc,n=this.jsx_parseIdentifier();if(!t.allowNamespaces||!this.eat(kt.colon))return n;var r=this.startNodeAt(e,i);return r.namespace=n,r.name=this.jsx_parseIdentifier(),this.finishNode(r,"JSXNamespacedName")}jsx_parseElementName(){if(this.type===Wt.jsxTagEnd)return"";let e=this.start,i=this.startLoc,n=this.jsx_parseNamespacedName();for(this.type!==kt.dot||"JSXNamespacedName"!==n.type||t.allowNamespacedObjects||this.unexpected();this.eat(kt.dot);){let t=this.startNodeAt(e,i);t.object=n,t.property=this.jsx_parseIdentifier(),n=this.finishNode(t,"JSXMemberExpression")}return n}jsx_parseAttributeValue(){switch(this.type){case kt.braceL:let t=this.jsx_parseExpressionContainer();return"JSXEmptyExpression"===t.expression.type&&this.raise(t.start,"JSX attributes must only be assigned a non-empty expression"),t;case Wt.jsxTagStart:case kt.string:return this.parseExprAtom();default:this.raise(this.start,"JSX value should be either an expression or a quoted JSX text")}}jsx_parseEmptyExpression(){let t=this.startNodeAt(this.lastTokEnd,this.lastTokEndLoc);return this.finishNodeAt(t,"JSXEmptyExpression",this.start,this.startLoc)}jsx_parseExpressionContainer(){let t=this.startNode();return this.next(),t.expression=this.type===kt.braceR?this.jsx_parseEmptyExpression():this.parseExpression(),this.expect(kt.braceR),this.finishNode(t,"JSXExpressionContainer")}jsx_parseAttribute(){let t=this.startNode();return this.eat(kt.braceL)?(this.expect(kt.ellipsis),t.argument=this.parseMaybeAssign(),this.expect(kt.braceR),this.finishNode(t,"JSXSpreadAttribute")):(t.name=this.jsx_parseNamespacedName(),t.value=this.eat(kt.eq)?this.jsx_parseAttributeValue():null,this.finishNode(t,"JSXAttribute"))}jsx_parseOpeningElementAt(t,e){let i=this.startNodeAt(t,e);i.attributes=[];let n=this.jsx_parseElementName();for(n&&(i.name=n);this.type!==kt.slash&&this.type!==Wt.jsxTagEnd;)i.attributes.push(this.jsx_parseAttribute());return i.selfClosing=this.eat(kt.slash),this.expect(Wt.jsxTagEnd),this.finishNode(i,n?"JSXOpeningElement":"JSXOpeningFragment")}jsx_parseClosingElementAt(t,e){let i=this.startNodeAt(t,e),n=this.jsx_parseElementName();return n&&(i.name=n),this.expect(Wt.jsxTagEnd),this.finishNode(i,n?"JSXClosingElement":"JSXClosingFragment")}jsx_parseElementAt(t,e){let i=this.startNodeAt(t,e),n=[],r=this.jsx_parseOpeningElementAt(t,e),a=null;if(!r.selfClosing){t:for(;;)switch(this.type){case Wt.jsxTagStart:if(t=this.start,e=this.startLoc,this.next(),this.eat(kt.slash)){a=this.jsx_parseClosingElementAt(t,e);break t}n.push(this.jsx_parseElementAt(t,e));break;case Wt.jsxText:n.push(this.parseExprAtom());break;case kt.braceL:n.push(this.jsx_parseExpressionContainer());break;default:this.unexpected()}qt(a.name)!==qt(r.name)&&this.raise(a.start,"Expected corresponding JSX closing tag for <"+qt(r.name)+">")}let o=r.name?"Element":"Fragment";return i["opening"+o]=r,i["closing"+o]=a,i.children=n,this.type===kt.relational&&"<"===this.value&&this.raise(this.start,"Adjacent JSX elements must be wrapped in an enclosing tag"),this.finishNode(i,"JSX"+o)}jsx_parseText(t){let e=this.parseLiteral(t);return e.type="JSXText",e}jsx_parseElement(){let t=this.start,e=this.startLoc;return this.next(),this.jsx_parseElementAt(t,e)}parseExprAtom(t){return this.type===Wt.jsxText?this.jsx_parseText(this.value):this.type===Wt.jsxTagStart?this.jsx_parseElement():super.parseExprAtom(t)}readToken(t){let e=this.curContext();if(e===Ht)return this.jsx_readToken();if(e===Vt||e===Gt){if(jt(t))return this.jsx_readWord();if(62==t)return++this.pos,this.finishToken(Wt.jsxTagEnd);if((34===t||39===t)&&e==Vt)return this.jsx_readString(t)}return 60===t&&this.exprAllowed&&33!==this.input.charCodeAt(this.pos+1)?(++this.pos,this.finishToken(Wt.jsxTagStart)):super.readToken(t)}updateContext(t){if(this.type==kt.braceL){var e=this.curContext();e==Vt?this.context.push(Lt.b_expr):e==Ht?this.context.push(Lt.b_tmpl):super.updateContext(t),this.exprAllowed=!0}else{if(this.type!==kt.slash||t!==Wt.jsxTagStart)return super.updateContext(t);this.context.length-=2,this.context.push(Gt),this.exprAllowed=!1}}}}({allowNamespaces:!1!==t.allowNamespaces,allowNamespacedObjects:!!t.allowNamespacedObjects},e)}};zt.tokTypes=Wt;var Kt,Yt,Jt=(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.DynamicImportKey=void 0;var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,i,n)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(n):void 0};e.default=function(t){return function(e){function a(){return function(t,e){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}(this),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(a,t),i(a,[{key:"parseStatement",value:function(t,e,i){return this.type===Mt.tokTypes._import&&function(){return/^(\s|\/\/.*|\/\*[^]*?\*\/)*\(/.test(this.input.slice(this.pos))}.call(this)?this.parseExpressionStatement(this.startNode(),this.parseExpression()):n(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"parseStatement",this).call(this,t,e,i)}},{key:"parseExprAtom",value:function(t){return this.type===Mt.tokTypes._import?function(){var t=this.startNode();return this.next(),this.type!==Mt.tokTypes.parenL&&this.unexpected(),this.finishNode(t,r)}.call(this):n(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"parseExprAtom",this).call(this,t)}}]),a}()};var r=e.DynamicImportKey="Import";Mt.tokTypes._import.startsExpr=!0}(Kt={exports:{}},Kt.exports),(Yt=Kt.exports)&&Yt.__esModule&&Object.prototype.hasOwnProperty.call(Yt,"default")?Yt.default:Yt);const $t=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Zt=Mt.tokTypes;function Xt(t){if(this.eat(Zt.eq)){const e=this._inFieldValue;this._inFieldValue=!0,t.value=this.parseExpression(),this._inFieldValue=e}else t.value=null}function Qt(){const t=this.startNode();return t.name=this.value,this.next(),this.finishNode(t,"PrivateName"),"never"==this.options.allowReserved&&this.checkUnreserved(t),t}const te=new(0,Mt.TokenType)("privateName");function ee(t){var e="";t=t<0?-t<<1|1:t<<1;do{var i=31&t;(t>>=5)>0&&(i|=32),e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="[i]}while(t>0);return e}var ie=function(t,e,i){this.start=t,this.end=e,this.original=i,this.intro="",this.outro="",this.content=i,this.storeName=!1,this.edited=!1,Object.defineProperties(this,{previous:{writable:!0,value:null},next:{writable:!0,value:null}})};ie.prototype.appendLeft=function(t){this.outro+=t},ie.prototype.appendRight=function(t){this.intro=this.intro+t},ie.prototype.clone=function(){var t=new ie(this.start,this.end,this.original);return t.intro=this.intro,t.outro=this.outro,t.content=this.content,t.storeName=this.storeName,t.edited=this.edited,t},ie.prototype.contains=function(t){return this.start<t&&t<this.end},ie.prototype.eachNext=function(t){for(var e=this;e;)t(e),e=e.next},ie.prototype.eachPrevious=function(t){for(var e=this;e;)t(e),e=e.previous},ie.prototype.edit=function(t,e,i){return this.content=t,i||(this.intro="",this.outro=""),this.storeName=e,this.edited=!0,this},ie.prototype.prependLeft=function(t){this.outro=t+this.outro},ie.prototype.prependRight=function(t){this.intro=t+this.intro},ie.prototype.split=function(t){var e=t-this.start,i=this.original.slice(0,e),n=this.original.slice(e);this.original=i;var r=new ie(t,this.end,n);return r.outro=this.outro,this.outro="",this.end=t,this.edited?(r.edit("",!1),this.content=""):this.content=i,r.next=this.next,r.next&&(r.next.previous=r),r.previous=this,this.next=r,r},ie.prototype.toString=function(){return this.intro+this.content+this.outro},ie.prototype.trimEnd=function(t){if(this.outro=this.outro.replace(t,""),this.outro.length)return!0;var e=this.content.replace(t,"");return e.length?(e!==this.content&&this.split(this.start+e.length).edit("",void 0,!0),!0):(this.edit("",void 0,!0),this.intro=this.intro.replace(t,""),!!this.intro.length||void 0)},ie.prototype.trimStart=function(t){if(this.intro=this.intro.replace(t,""),this.intro.length)return!0;var e=this.content.replace(t,"");return e.length?(e!==this.content&&(this.split(this.end-e.length),this.edit("",void 0,!0)),!0):(this.edit("",void 0,!0),this.outro=this.outro.replace(t,""),!!this.outro.length||void 0)};var ne=function(){throw new Error("Unsupported environment: `window.btoa` or `Buffer` should be supported.")};"undefined"!=typeof window&&"function"==typeof window.btoa?ne=function(t){return window.btoa(unescape(encodeURIComponent(t)))}:"function"==typeof Buffer&&(ne=function(t){return Buffer.from(t,"utf-8").toString("base64")});var re=function(t){this.version=3,this.file=t.file,this.sources=t.sources,this.sourcesContent=t.sourcesContent,this.names=t.names,this.mappings=function(t){for(var e=0,i=0,n=0,r=0,a="",o=0;o<t.length;o++){var s=t[o];if(o>0&&(a+=";"),0!==s.length){for(var c=0,u=[],d=0,l=s;d<l.length;d++){var p=l[d],h=ee(p[0]-c);c=p[0],p.length>1&&(h+=ee(p[1]-e)+ee(p[2]-i)+ee(p[3]-n),e=p[1],i=p[2],n=p[3]),5===p.length&&(h+=ee(p[4]-r),r=p[4]),u.push(h)}a+=u.join(",")}}return a}(t.mappings)};function ae(t){var e=t.split("\n"),i=e.filter((function(t){return/^\t+/.test(t)})),n=e.filter((function(t){return/^ {2,}/.test(t)}));if(0===i.length&&0===n.length)return null;if(i.length>=n.length)return"\t";var r=n.reduce((function(t,e){var i=/^ +/.exec(e)[0].length;return Math.min(i,t)}),1/0);return new Array(r+1).join(" ")}function oe(t,e){var i=t.split(/[\/\\]/),n=e.split(/[\/\\]/);for(i.pop();i[0]===n[0];)i.shift(),n.shift();if(i.length)for(var r=i.length;r--;)i[r]="..";return i.concat(n).join("/")}re.prototype.toString=function(){return JSON.stringify(this)},re.prototype.toUrl=function(){return"data:application/json;charset=utf-8;base64,"+ne(this.toString())};var se=Object.prototype.toString;function ce(t){for(var e=t.split("\n"),i=[],n=0,r=0;n<e.length;n++)i.push(r),r+=e[n].length+1;return function(t){for(var e=0,n=i.length;e<n;){var r=e+n>>1;t<i[r]?n=r:e=r+1}var a=e-1;return{line:a,column:t-i[a]}}}var ue=function(t){this.hires=t,this.generatedCodeLine=0,this.generatedCodeColumn=0,this.raw=[],this.rawSegments=this.raw[this.generatedCodeLine]=[],this.pending=null};ue.prototype.addEdit=function(t,e,i,n){if(e.length){var r=[this.generatedCodeColumn,t,i.line,i.column];n>=0&&r.push(n),this.rawSegments.push(r)}else this.pending&&this.rawSegments.push(this.pending);this.advance(e),this.pending=null},ue.prototype.addUneditedChunk=function(t,e,i,n,r){for(var a=e.start,o=!0;a<e.end;)(this.hires||o||r[a])&&this.rawSegments.push([this.generatedCodeColumn,t,n.line,n.column]),"\n"===i[a]?(n.line+=1,n.column=0,this.generatedCodeLine+=1,this.raw[this.generatedCodeLine]=this.rawSegments=[],this.generatedCodeColumn=0):(n.column+=1,this.generatedCodeColumn+=1),a+=1,o=!1;this.pending=[this.generatedCodeColumn,t,n.line,n.column]},ue.prototype.advance=function(t){if(t){var e=t.split("\n");if(e.length>1){for(var i=0;i<e.length-1;i++)this.generatedCodeLine++,this.raw[this.generatedCodeLine]=this.rawSegments=[];this.generatedCodeColumn=0}this.generatedCodeColumn+=e[e.length-1].length}};var de="\n",le={insertLeft:!1,insertRight:!1,storeName:!1},pe=function(t,e){void 0===e&&(e={});var i=new ie(0,t.length,t);Object.defineProperties(this,{original:{writable:!0,value:t},outro:{writable:!0,value:""},intro:{writable:!0,value:""},firstChunk:{writable:!0,value:i},lastChunk:{writable:!0,value:i},lastSearchedChunk:{writable:!0,value:i},byStart:{writable:!0,value:{}},byEnd:{writable:!0,value:{}},filename:{writable:!0,value:e.filename},indentExclusionRanges:{writable:!0,value:e.indentExclusionRanges},sourcemapLocations:{writable:!0,value:{}},storedNames:{writable:!0,value:{}},indentStr:{writable:!0,value:ae(t)}}),this.byStart[0]=i,this.byEnd[t.length]=i};function he(t){var e={};return Object.keys(t).forEach((function(i){"parent"!==i&&"program"!==i&&"keys"!==i&&"__wrapped"!==i&&(e[i]=Array.isArray(t[i])?t[i].map(he):t[i]&&t[i].toJSON?t[i].toJSON():t[i])})),e}pe.prototype.addSourcemapLocation=function(t){this.sourcemapLocations[t]=!0},pe.prototype.append=function(t){if("string"!=typeof t)throw new TypeError("outro content must be a string");return this.outro+=t,this},pe.prototype.appendLeft=function(t,e){if("string"!=typeof e)throw new TypeError("inserted content must be a string");this._split(t);var i=this.byEnd[t];return i?i.appendLeft(e):this.intro+=e,this},pe.prototype.appendRight=function(t,e){if("string"!=typeof e)throw new TypeError("inserted content must be a string");this._split(t);var i=this.byStart[t];return i?i.appendRight(e):this.outro+=e,this},pe.prototype.clone=function(){for(var t=new pe(this.original,{filename:this.filename}),e=this.firstChunk,i=t.firstChunk=t.lastSearchedChunk=e.clone();e;){t.byStart[i.start]=i,t.byEnd[i.end]=i;var n=e.next,r=n&&n.clone();r&&(i.next=r,r.previous=i,i=r),e=n}return t.lastChunk=i,this.indentExclusionRanges&&(t.indentExclusionRanges=this.indentExclusionRanges.slice()),Object.keys(this.sourcemapLocations).forEach((function(e){t.sourcemapLocations[e]=!0})),t},pe.prototype.generateDecodedMap=function(t){var e=this;t=t||{};var i=Object.keys(this.storedNames),n=new ue(t.hires),r=ce(this.original);return this.intro&&n.advance(this.intro),this.firstChunk.eachNext((function(t){var a=r(t.start);t.intro.length&&n.advance(t.intro),t.edited?n.addEdit(0,t.content,a,t.storeName?i.indexOf(t.original):-1):n.addUneditedChunk(0,t,e.original,a,e.sourcemapLocations),t.outro.length&&n.advance(t.outro)})),{file:t.file?t.file.split(/[\/\\]/).pop():null,sources:[t.source?oe(t.file||"",t.source):null],sourcesContent:t.includeContent?[this.original]:[null],names:i,mappings:n.raw}},pe.prototype.generateMap=function(t){return new re(this.generateDecodedMap(t))},pe.prototype.getIndentString=function(){return null===this.indentStr?"\t":this.indentStr},pe.prototype.indent=function(t,e){var i=/^[^\r\n]/gm;if("[object Object]"===se.call(t)&&(e=t,t=void 0),""===(t=void 0!==t?t:this.indentStr||"\t"))return this;var n={};(e=e||{}).exclude&&("number"==typeof e.exclude[0]?[e.exclude]:e.exclude).forEach((function(t){for(var e=t[0];e<t[1];e+=1)n[e]=!0}));var r=!1!==e.indentStart,a=function(e){return r?""+t+e:(r=!0,e)};this.intro=this.intro.replace(i,a);for(var o=0,s=this.firstChunk;s;){var c=s.end;if(s.edited)n[o]||(s.content=s.content.replace(i,a),s.content.length&&(r="\n"===s.content[s.content.length-1]));else for(o=s.start;o<c;){if(!n[o]){var u=this.original[o];"\n"===u?r=!0:"\r"!==u&&r&&(r=!1,o===s.start?s.prependRight(t):(this._splitChunk(s,o),(s=s.next).prependRight(t)))}o+=1}o=s.end,s=s.next}return this.outro=this.outro.replace(i,a),this},pe.prototype.insert=function(){throw new Error("magicString.insert(...) is deprecated. Use prependRight(...) or appendLeft(...)")},pe.prototype.insertLeft=function(t,e){return le.insertLeft||(console.warn("magicString.insertLeft(...) is deprecated. Use magicString.appendLeft(...) instead"),le.insertLeft=!0),this.appendLeft(t,e)},pe.prototype.insertRight=function(t,e){return le.insertRight||(console.warn("magicString.insertRight(...) is deprecated. Use magicString.prependRight(...) instead"),le.insertRight=!0),this.prependRight(t,e)},pe.prototype.move=function(t,e,i){if(i>=t&&i<=e)throw new Error("Cannot move a selection inside itself");this._split(t),this._split(e),this._split(i);var n=this.byStart[t],r=this.byEnd[e],a=n.previous,o=r.next,s=this.byStart[i];if(!s&&r===this.lastChunk)return this;var c=s?s.previous:this.lastChunk;return a&&(a.next=o),o&&(o.previous=a),c&&(c.next=n),s&&(s.previous=r),n.previous||(this.firstChunk=r.next),r.next||(this.lastChunk=n.previous,this.lastChunk.next=null),n.previous=c,r.next=s||null,c||(this.firstChunk=n),s||(this.lastChunk=r),this},pe.prototype.overwrite=function(t,e,i,n){if("string"!=typeof i)throw new TypeError("replacement content must be a string");for(;t<0;)t+=this.original.length;for(;e<0;)e+=this.original.length;if(e>this.original.length)throw new Error("end is out of bounds");if(t===e)throw new Error("Cannot overwrite a zero-length range \u2013 use appendLeft or prependRight instead");this._split(t),this._split(e),!0===n&&(le.storeName||(console.warn("The final argument to magicString.overwrite(...) should be an options object. See https://github.com/rich-harris/magic-string"),le.storeName=!0),n={storeName:!0});var r=void 0!==n&&n.storeName,a=void 0!==n&&n.contentOnly;if(r){var o=this.original.slice(t,e);this.storedNames[o]=!0}var s=this.byStart[t],c=this.byEnd[e];if(s){if(e>s.end&&s.next!==this.byStart[s.end])throw new Error("Cannot overwrite across a split point");if(s.edit(i,r,a),s!==c){for(var u=s.next;u!==c;)u.edit("",!1),u=u.next;u.edit("",!1)}}else{var d=new ie(t,e,"").edit(i,r);c.next=d,d.previous=c}return this},pe.prototype.prepend=function(t){if("string"!=typeof t)throw new TypeError("outro content must be a string");return this.intro=t+this.intro,this},pe.prototype.prependLeft=function(t,e){if("string"!=typeof e)throw new TypeError("inserted content must be a string");this._split(t);var i=this.byEnd[t];return i?i.prependLeft(e):this.intro=e+this.intro,this},pe.prototype.prependRight=function(t,e){if("string"!=typeof e)throw new TypeError("inserted content must be a string");this._split(t);var i=this.byStart[t];return i?i.prependRight(e):this.outro=e+this.outro,this},pe.prototype.remove=function(t,e){for(;t<0;)t+=this.original.length;for(;e<0;)e+=this.original.length;if(t===e)return this;if(t<0||e>this.original.length)throw new Error("Character is out of bounds");if(t>e)throw new Error("end must be greater than start");this._split(t),this._split(e);for(var i=this.byStart[t];i;)i.intro="",i.outro="",i.edit(""),i=e>i.end?this.byStart[i.end]:null;return this},pe.prototype.lastChar=function(){if(this.outro.length)return this.outro[this.outro.length-1];var t=this.lastChunk;do{if(t.outro.length)return t.outro[t.outro.length-1];if(t.content.length)return t.content[t.content.length-1];if(t.intro.length)return t.intro[t.intro.length-1]}while(t=t.previous);return this.intro.length?this.intro[this.intro.length-1]:""},pe.prototype.lastLine=function(){var t=this.outro.lastIndexOf(de);if(-1!==t)return this.outro.substr(t+1);var e=this.outro,i=this.lastChunk;do{if(i.outro.length>0){if(-1!==(t=i.outro.lastIndexOf(de)))return i.outro.substr(t+1)+e;e=i.outro+e}if(i.content.length>0){if(-1!==(t=i.content.lastIndexOf(de)))return i.content.substr(t+1)+e;e=i.content+e}if(i.intro.length>0){if(-1!==(t=i.intro.lastIndexOf(de)))return i.intro.substr(t+1)+e;e=i.intro+e}}while(i=i.previous);return-1!==(t=this.intro.lastIndexOf(de))?this.intro.substr(t+1)+e:this.intro+e},pe.prototype.slice=function(t,e){for(void 0===t&&(t=0),void 0===e&&(e=this.original.length);t<0;)t+=this.original.length;for(;e<0;)e+=this.original.length;for(var i="",n=this.firstChunk;n&&(n.start>t||n.end<=t);){if(n.start<e&&n.end>=e)return i;n=n.next}if(n&&n.edited&&n.start!==t)throw new Error("Cannot use replaced character "+t+" as slice start anchor.");for(var r=n;n;){!n.intro||r===n&&n.start!==t||(i+=n.intro);var a=n.start<e&&n.end>=e;if(a&&n.edited&&n.end!==e)throw new Error("Cannot use replaced character "+e+" as slice end anchor.");if(i+=n.content.slice(r===n?t-n.start:0,a?n.content.length+e-n.end:n.content.length),!n.outro||a&&n.end!==e||(i+=n.outro),a)break;n=n.next}return i},pe.prototype.snip=function(t,e){var i=this.clone();return i.remove(0,t),i.remove(e,i.original.length),i},pe.prototype._split=function(t){if(!this.byStart[t]&&!this.byEnd[t])for(var e=this.lastSearchedChunk,i=t>e.end;e;){if(e.contains(t))return this._splitChunk(e,t);e=i?this.byStart[e.end]:this.byEnd[e.start]}},pe.prototype._splitChunk=function(t,e){if(t.edited&&t.content.length){var i=ce(this.original)(e);throw new Error("Cannot split a chunk that has already been edited ("+i.line+":"+i.column+' \u2013 "'+t.original+'")')}var n=t.split(e);return this.byEnd[e]=t,this.byStart[e]=n,this.byEnd[n.end]=n,t===this.lastChunk&&(this.lastChunk=n),this.lastSearchedChunk=t,!0},pe.prototype.toString=function(){for(var t=this.intro,e=this.firstChunk;e;)t+=e.toString(),e=e.next;return t+this.outro},pe.prototype.isEmpty=function(){var t=this.firstChunk;do{if(t.intro.length&&t.intro.trim()||t.content.length&&t.content.trim()||t.outro.length&&t.outro.trim())return!1}while(t=t.next);return!0},pe.prototype.length=function(){var t=this.firstChunk,e=0;do{e+=t.intro.length+t.content.length+t.outro.length}while(t=t.next);return e},pe.prototype.trimLines=function(){return this.trim("[\\r\\n]")},pe.prototype.trim=function(t){return this.trimStart(t).trimEnd(t)},pe.prototype.trimEndAborted=function(t){var e=new RegExp((t||"\\s")+"+$");if(this.outro=this.outro.replace(e,""),this.outro.length)return!0;var i=this.lastChunk;do{var n=i.end,r=i.trimEnd(e);if(i.end!==n&&(this.lastChunk===i&&(this.lastChunk=i.next),this.byEnd[i.end]=i,this.byStart[i.next.start]=i.next,this.byEnd[i.next.end]=i.next),r)return!0;i=i.previous}while(i);return!1},pe.prototype.trimEnd=function(t){return this.trimEndAborted(t),this},pe.prototype.trimStartAborted=function(t){var e=new RegExp("^"+(t||"\\s")+"+");if(this.intro=this.intro.replace(e,""),this.intro.length)return!0;var i=this.firstChunk;do{var n=i.end,r=i.trimStart(e);if(i.end!==n&&(i===this.lastChunk&&(this.lastChunk=i.next),this.byEnd[i.end]=i,this.byStart[i.next.start]=i.next,this.byEnd[i.next.end]=i.next),r)return!0;i=i.next}while(i);return!1},pe.prototype.trimStart=function(t){return this.trimStartAborted(t),this};var fe=function(){};function me(t){var e=[];return ge[t.type](e,t),e}fe.prototype.ancestor=function(t){for(var e=this;t--;)if(!(e=e.parent))return null;return e},fe.prototype.contains=function(t){for(;t;){if(t===this)return!0;t=t.parent}return!1},fe.prototype.findLexicalBoundary=function(){return this.parent.findLexicalBoundary()},fe.prototype.findNearest=function(t){return"string"==typeof t&&(t=new RegExp("^"+t+"$")),t.test(this.type)?this:this.parent.findNearest(t)},fe.prototype.unparenthesizedParent=function(){for(var t=this.parent;t&&"ParenthesizedExpression"===t.type;)t=t.parent;return t},fe.prototype.unparenthesize=function(){for(var t=this;"ParenthesizedExpression"===t.type;)t=t.expression;return t},fe.prototype.findScope=function(t){return this.parent.findScope(t)},fe.prototype.getIndentation=function(){return this.parent.getIndentation()},fe.prototype.initialise=function(t){for(var e=0,i=this.keys;e<i.length;e+=1){var n=this[i[e]];Array.isArray(n)?n.forEach((function(e){return e&&e.initialise(t)})):n&&"object"==typeof n&&n.initialise(t)}},fe.prototype.toJSON=function(){return he(this)},fe.prototype.toString=function(){return this.program.magicString.original.slice(this.start,this.end)},fe.prototype.transpile=function(t,e){for(var i=0,n=this.keys;i<n.length;i+=1){var r=this[n[i]];Array.isArray(r)?r.forEach((function(i){return i&&i.transpile(t,e)})):r&&"object"==typeof r&&r.transpile(t,e)}};var ge={Identifier:function(t,e){t.push(e)},ObjectPattern:function(t,e){for(var i=0,n=e.properties;i<n.length;i+=1){var r=n[i];ge[r.type](t,r)}},Property:function(t,e){ge[e.value.type](t,e.value)},ArrayPattern:function(t,e){for(var i=0,n=e.elements;i<n.length;i+=1){var r=n[i];r&&ge[r.type](t,r)}},RestElement:function(t,e){ge[e.argument.type](t,e.argument)},AssignmentPattern:function(t,e){ge[e.left.type](t,e.left)}},ve=Object.create(null);function ye(t){this.parent=(t=t||{}).parent,this.isBlockScope=!!t.block,this.createDeclarationCallback=t.declare;for(var e=this;e.isBlockScope;)e=e.parent;this.functionScope=e,this.identifiers=[],this.declarations=Object.create(null),this.references=Object.create(null),this.blockScopedDeclarations=this.isBlockScope?null:Object.create(null),this.aliases=Object.create(null)}function Ie(t,e){for(var i="";e--;)i+=t;return i}function we(t,e,i){void 0===i&&(i=1);var n=Math.max(e.line-5,0),r=e.line,a=String(r).length,o=t.split("\n").slice(n,r),s=o[o.length-1].slice(0,e.column).replace(/\t/g,"  ").length;return o.map((function(t,e){return i=a,(r=String(e+n+1))+Ie(" ",i-r.length)+" : "+t.replace(/\t/g,"  ");var i,r})).join("\n")+"\n"+Ie(" ",a+3+s)+Ie("^",i)}"do if in for let new try var case else enum eval null this true void with await break catch class const false super throw while yield delete export import public return static switch typeof default extends finally package private continue debugger function arguments interface protected implements instanceof".split(" ").forEach((function(t){return ve[t]=!0})),ye.prototype={addDeclaration:function(t,e){for(var i=0,n=me(t);i<n.length;i+=1){var r=n[i],a=r.name,o={name:a,node:r,kind:e,instances:[]};this.declarations[a]=o,this.isBlockScope&&(this.functionScope.blockScopedDeclarations[a]||(this.functionScope.blockScopedDeclarations[a]=[]),this.functionScope.blockScopedDeclarations[a].push(o))}},addReference:function(t){this.consolidated?this.consolidateReference(t):this.identifiers.push(t)},consolidate:function(){for(var t=0;t<this.identifiers.length;t+=1)this.consolidateReference(this.identifiers[t]);this.consolidated=!0},consolidateReference:function(t){var e=this.declarations[t.name];e?e.instances.push(t):(this.references[t.name]=!0,this.parent&&this.parent.addReference(t))},contains:function(t){return this.declarations[t]||!!this.parent&&this.parent.contains(t)},createIdentifier:function(t){"number"==typeof t&&(t=t.toString());for(var e=t=t.replace(/\s/g,"").replace(/\[([^\]]+)\]/g,"_$1").replace(/[^a-zA-Z0-9_$]/g,"_").replace(/_{2,}/,"_"),i=1;this.declarations[e]||this.references[e]||this.aliases[e]||e in ve;)e=t+"$"+i++;return this.aliases[e]=!0,e},createDeclaration:function(t){var e=this.createIdentifier(t);return this.createDeclarationCallback(e),e},findDeclaration:function(t){return this.declarations[t]||this.parent&&this.parent.findDeclaration(t)},resolveName:function(t){var e=this.findDeclaration(t);return e?e.name:t}};var Se=function(t){function e(e,i){if(t.call(this,e),this.name="CompileError",i){var n=i.program.magicString.original,r=function(t,e){var i,n=t.split("\n"),r=n.length,a=0;for(i=0;i<r;i+=1){var o=a+n[i].length+1;if(o>e)return{line:i+1,column:e-a,char:i};a=o}throw new Error("Could not determine location of character")}(n,i.start);this.message=e+" ("+r.line+":"+r.column+")",this.stack=(new t).stack.replace(new RegExp(".+new "+this.name+".+\\n","m"),""),this.loc=r,this.snippet=we(n,r,i.end-i.start)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+"\n"+this.snippet},e.missingTransform=function(t,i,n,r){throw void 0===r&&(r=null),new e("Transforming "+t+" is not "+(r?"fully supported":"implemented")+". Use `transforms: { "+i+": false }` to skip transformation and disable this error"+(r?", or `transforms: { "+r+": true }` if you know what you're doing":"")+".",n)},e}(Error);function be(t,e){for(var i=0;i<t.length;i+=1)if(e(t[i],i))return i;return-1}var Ue={Identifier:Pe,AssignmentPattern:function(t,e,i,n,r,a,o){var s="Identifier"===n.left.type,c=s?n.left.name:r;a||o.push((function(e,i,r){t.prependRight(n.left.end,i+"if ( "+c+" === void 0 ) "+c),t.move(n.left.end,n.right.end,e),t.appendLeft(n.right.end,r)})),s||Ne(t,e,i,n.left,r,a,o)},ArrayPattern:function(t,e,i,n,r,a,o){var s=n.start;n.elements.forEach((function(n,c){n&&("RestElement"===n.type?De(t,e,i,s,n.argument,r+".slice("+c+")",a,o):De(t,e,i,s,n,r+"["+c+"]",a,o),s=n.end)})),t.remove(s,n.end)},ObjectPattern:Ee};function Ne(t,e,i,n,r,a,o){Ue[n.type](t,e,i,n,r,a,o)}function Pe(t,e,i,n,r,a,o){o.push((function(e,o,s){t.overwrite(n.start,n.end,(a?o:o+"var ")+i(n)+" = "+r+s),t.move(n.start,n.end,e)}))}function Ee(t,e,i,n,r,a,o){var s=this,c=n.start,u=[];n.properties.forEach((function(n){var d,l;if("Property"===n.type)if(l=n.value,n.computed||"Identifier"!==n.key.type)if(n.computed||"Literal"!==n.key.type){var p=t.slice(n.key.start,n.key.end);d=r+"["+p+"]",u.push("String("+p+")")}else d=r+"["+n.key.raw+"]",u.push(JSON.stringify(String(n.key.value)));else d=r+"."+n.key.name,u.push('"'+n.key.name+'"');else{if("RestElement"!==n.type)throw new Se(s,"Unexpected node of type "+n.type+" in object pattern");l=n.argument,d=e("rest"),o.push((function(e,i,o){var s=n.program.getObjectWithoutPropertiesHelper(t);t.overwrite(n.start,c=n.argument.start,(a?i:i+"var ")+d+" = "+s+"( "+r+", ["+u.join(", ")+"] )"+o),t.move(n.start,c,e)}))}De(t,e,i,c,l,d,a,o),c=n.end})),t.remove(c,n.end)}function De(t,e,i,n,r,a,o,s){switch(r.type){case"Identifier":t.remove(n,r.start),Pe(t,0,i,r,a,o,s);break;case"MemberExpression":t.remove(n,r.start),function(t,e,i,n,r,a,o){o.push((function(e,i,a){t.prependRight(n.start,i),t.appendLeft(n.end," = "+r+a),t.move(n.start,n.end,e)}))}(t,0,0,r,a,0,s);break;case"AssignmentPattern":var c,u="Identifier"===r.left.type;c=u?i(r.left):e(a),s.push((function(e,i,n){o?(t.prependRight(r.right.start,c+" = "+a+", "+c+" = "+c+" === void 0 ? "),t.appendLeft(r.right.end," : "+c+n)):(t.prependRight(r.right.start,i+"var "+c+" = "+a+"; if ( "+c+" === void 0 ) "+c+" = "),t.appendLeft(r.right.end,n)),t.move(r.right.start,r.right.end,e)})),u?t.remove(n,r.right.start):(t.remove(n,r.left.start),t.remove(r.left.end,r.right.start),De(t,e,i,n,r.left,c,o,s));break;case"ObjectPattern":t.remove(n,n=r.start);var d=a;r.properties.length>1&&(d=e(a),s.push((function(e,i,s){t.prependRight(r.start,(o?"":i+"var ")+d+" = "),t.overwrite(r.start,n=r.start+1,a),t.appendLeft(n,s),t.overwrite(r.start,n=r.start+1,(o?"":i+"var ")+d+" = "+a+s),t.move(r.start,n,e)}))),Ee(t,e,i,r,d,o,s);break;case"ArrayPattern":if(t.remove(n,n=r.start),r.elements.filter(Boolean).length>1){var l=e(a);s.push((function(e,i,s){t.prependRight(r.start,(o?"":i+"var ")+l+" = "),t.overwrite(r.start,n=r.start+1,a,{contentOnly:!0}),t.appendLeft(n,s),t.move(r.start,n,e)})),r.elements.forEach((function(r,a){r&&("RestElement"===r.type?De(t,e,i,n,r.argument,l+".slice("+a+")",o,s):De(t,e,i,n,r,l+"["+a+"]",o,s),n=r.end)}))}else{var p=be(r.elements,Boolean),h=r.elements[p];"RestElement"===h.type?De(t,e,i,n,h.argument,a+".slice("+p+")",o,s):De(t,e,i,n,h,a+"["+p+"]",o,s),n=h.end}t.remove(n,r.end);break;default:throw new Error("Unexpected node type in destructuring ("+r.type+")")}}var Ae=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createScope=function(){var t=this;this.parentIsFunction=/Function/.test(this.parent.type),this.isFunctionBlock=this.parentIsFunction||"Root"===this.parent.type,this.scope=new ye({block:!this.isFunctionBlock,parent:this.parent.findScope(!1),declare:function(e){return t.createdDeclarations.push(e)}}),this.parentIsFunction&&this.parent.params.forEach((function(e){t.scope.addDeclaration(e,"param")}))},e.prototype.initialise=function(t){this.thisAlias=null,this.argumentsAlias=null,this.defaultParameters=[],this.createdDeclarations=[],this.scope||this.createScope(),this.body.forEach((function(e){return e.initialise(t)})),this.scope.consolidate()},e.prototype.findLexicalBoundary=function(){return"Program"===this.type||/^Function/.test(this.parent.type)?this:this.parent.findLexicalBoundary()},e.prototype.findScope=function(t){return t&&!this.isFunctionBlock?this.parent.findScope(t):this.scope},e.prototype.getArgumentsAlias=function(){return this.argumentsAlias||(this.argumentsAlias=this.scope.createIdentifier("arguments")),this.argumentsAlias},e.prototype.getArgumentsArrayAlias=function(){return this.argumentsArrayAlias||(this.argumentsArrayAlias=this.scope.createIdentifier("argsArray")),this.argumentsArrayAlias},e.prototype.getThisAlias=function(){return this.thisAlias||(this.thisAlias=this.scope.createIdentifier("this")),this.thisAlias},e.prototype.getIndentation=function(){if(void 0===this.indentation){for(var t=this.program.magicString.original,e=this.synthetic||!this.body.length,i=e?this.start:this.body[0].start;i&&"\n"!==t[i];)i-=1;for(this.indentation="";;){var n=t[i+=1];if(" "!==n&&"\t"!==n)break;this.indentation+=n}for(var r=this.program.magicString.getIndentString(),a=this.parent;a;)"constructor"!==a.kind||a.parent.parent.superClass||(this.indentation=this.indentation.replace(r,"")),a=a.parent;e&&(this.indentation+=r)}return this.indentation},e.prototype.transpile=function(e,i){var n,r,a=this,o=this.getIndentation(),s=[];if(this.argumentsAlias&&s.push((function(t,i,n){e.appendLeft(t,i+"var "+a.argumentsAlias+" = arguments"+n)})),this.thisAlias&&s.push((function(t,i,n){e.appendLeft(t,i+"var "+a.thisAlias+" = this"+n)})),this.argumentsArrayAlias&&s.push((function(t,i,n){var r=a.scope.createIdentifier("i");e.appendLeft(t,i+"var "+r+" = arguments.length, "+a.argumentsArrayAlias+" = Array("+r+");\n"+o+"while ( "+r+"-- ) "+a.argumentsArrayAlias+"["+r+"] = arguments["+r+"]"+n)})),/Function/.test(this.parent.type)?this.transpileParameters(this.parent.params,e,i,o,s):"CatchClause"===this.parent.type&&this.transpileParameters([this.parent.param],e,i,o,s),i.letConst&&this.isFunctionBlock&&this.transpileBlockScopedIdentifiers(e),t.prototype.transpile.call(this,e,i),this.createdDeclarations.length&&s.push((function(t,i,n){var r=i+"var "+a.createdDeclarations.join(", ")+n;e.appendLeft(t,r)})),this.synthetic)if("ArrowFunctionExpression"===this.parent.type){var c=this.body[0];s.length?(e.appendLeft(this.start,"{").prependRight(this.end,this.parent.getIndentation()+"}"),e.prependRight(c.start,"\n"+o+"return "),e.appendLeft(c.end,";\n")):i.arrow&&(e.prependRight(c.start,"{ return "),e.appendLeft(c.end,"; }"))}else s.length&&e.prependRight(this.start,"{").appendLeft(this.end,"}");n=(r=this.body[0])&&"ExpressionStatement"===r.type&&"Literal"===r.expression.type&&"use strict"===r.expression.value?this.body[0].end:this.synthetic||"Root"===this.parent.type?this.start:this.start+1;var u="\n"+o,d=";";s.forEach((function(t,e){e===s.length-1&&(d=";\n"),t(n,u,d)}))},e.prototype.transpileParameters=function(t,e,i,n,r){var a=this;t.forEach((function(o){if("AssignmentPattern"===o.type&&"Identifier"===o.left.type)i.defaultParameter&&r.push((function(t,i,n){e.prependRight(o.left.end,i+"if ( "+o.left.name+" === void 0 ) "+o.left.name).move(o.left.end,o.right.end,t).appendLeft(o.right.end,n)}));else if("RestElement"===o.type)i.spreadRest&&r.push((function(i,r,s){var c=t[t.length-2];if(c)e.remove(c?c.end:o.start,o.end);else{for(var u=o.start,d=o.end;/\s/.test(e.original[u-1]);)u-=1;for(;/\s/.test(e.original[d]);)d+=1;e.remove(u,d)}var l=o.argument.name,p=a.scope.createIdentifier("len"),h=t.length-1;e.prependRight(i,h?r+"var "+l+" = [], "+p+" = arguments.length - "+h+";\n"+n+"while ( "+p+"-- > 0 ) "+l+"[ "+p+" ] = arguments[ "+p+" + "+h+" ]"+s:r+"var "+l+" = [], "+p+" = arguments.length;\n"+n+"while ( "+p+"-- ) "+l+"[ "+p+" ] = arguments[ "+p+" ]"+s)}));else if("Identifier"!==o.type&&i.parameterDestructuring){var s=a.scope.createIdentifier("ref");Ne(e,(function(t){return a.scope.createIdentifier(t)}),(function(t){return a.scope.resolveName(t.name)}),o,s,!1,r),e.prependRight(o.start,s)}}))},e.prototype.transpileBlockScopedIdentifiers=function(t){var e=this;Object.keys(this.scope.blockScopedDeclarations).forEach((function(i){for(var n=0,r=e.scope.blockScopedDeclarations[i];n<r.length;n+=1){var a=r[n],o=!1;if("for.let"===a.kind){var s=a.node.findNearest("ForStatement");if(s.shouldRewriteAsFunction){var c=e.scope.createIdentifier(i),u=s.reassigned[i]?e.scope.createIdentifier(i):i;a.name=c,t.overwrite(a.node.start,a.node.end,c,{storeName:!0}),s.aliases[i]={outer:c,inner:u};for(var d=0,l=a.instances;d<l.length;d+=1){var p=l[d],h=s.body.contains(p)?u:c;i!==h&&t.overwrite(p.start,p.end,h,{storeName:!0})}o=!0}}if(!o){var f=e.scope.createIdentifier(i);if(i!==f){a.name=f,t.overwrite(a.node.start,a.node.end,f,{storeName:!0});for(var m=0,g=a.instances;m<g.length;m+=1){var v=g[m];v.rewritten=!0,t.overwrite(v.start,v.end,f,{storeName:!0})}}}}}))},e}(fe);function Te(t){return"Identifier"===t.type&&"arguments"===t.name}function Ce(t,e,i){for(var n=i.length;n--;){var r=i[n];if(r&&"SpreadElement"===r.type){var a=r.argument;if("ArrayExpression"===a.type){var o=a.elements;if(!o.some((function(t){return null===t}))){var s=n===i.length-1;0===o.length?t.remove(s&&0!==n?i[n-1].end:r.start,s?e.end-1:i[n+1].start):(t.remove(r.start,o[0].start),t.remove(o[o.length-1].end,s?e.end-1:r.end)),i.splice.apply(i,[n,1].concat(o)),n+=o.length}}}}}function Me(t){switch(t.type){case"ArrayExpression":case"CallExpression":case"Identifier":case"ParenthesizedExpression":case"ThisExpression":return!1;default:return!0}}function xe(t,e,i,n,r){for(var a=e.length,o=-1;a--;){var s=e[a];s&&"SpreadElement"===s.type&&(Te(s.argument)&&t.overwrite(s.argument.start,s.argument.end,n),o=a)}if(-1===o)return!1;if(r){for(a=0;a<e.length;a+=1){var c=e[a];"SpreadElement"===c.type?t.remove(c.start,c.argument.start):(t.prependRight(c.start,"["),t.prependRight(c.end,"]"))}return!0}var u=e[o],d=e[o-1];if(d)t.overwrite(d.end,u.start," ].concat( ");else{var l;if(i!==u.start)(l=Me(u.argument))?t.overwrite(i,u.start,"( "):t.remove(i,u.start);else{if("CallExpression"!==u.parent.type)throw new Se("Unsupported spread construct, please raise an issue at https://github.com/bublejs/buble/issues",u);l=Me(u.argument)}t.overwrite(u.end,e[1].start,l?" ).concat( ":".concat( ")}for(a=o;a<e.length;a+=1)(u=e[a])&&("SpreadElement"===u.type?t.remove(u.start,u.argument.start):(t.appendLeft(u.start,"["),t.appendLeft(u.end,"]")));return!0}var Re=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){if(e.spreadRest&&this.elements.length)for(var i=this.findLexicalBoundary(),n=this.elements.length;n--;){var r=this.elements[n];r&&"SpreadElement"===r.type&&Te(r.argument)&&(this.argumentsArrayAlias=i.getArgumentsArrayAlias())}t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){if(t.prototype.transpile.call(this,e,i),i.spreadRest){if(Ce(e,this,this.elements),this.elements.length){var n=this.elements[this.elements.length-1];n&&/\s*,/.test(e.original.slice(n.end,this.end))&&e.overwrite(n.end,this.end-1," ")}if(1===this.elements.length){var r=this.elements[0];r&&"SpreadElement"===r.type&&(Te(r.argument)?e.overwrite(this.start,this.end,"[].concat( "+this.argumentsArrayAlias+" )"):(e.overwrite(this.start,r.argument.start,"[].concat( "),e.overwrite(r.end,this.end," )")))}else xe(e,this.elements,this.start,this.argumentsArrayAlias)&&e.overwrite(this.end-1,this.end,")")}},e}(fe);function ke(t,e){for(;")"!==t.original[e];){if(","===t.original[e])return void t.remove(e,e+1);"/"===t.original[e]&&(e="/"===t.original[e+1]?t.original.indexOf("\n",e):t.original.indexOf("*/",e)+1),e+=1}}var Oe=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){this.async&&e.asyncAwait&&Se.missingTransform("async arrow functions","asyncAwait",this),this.body.createScope(),t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){for(var n=this.start,r=(this.body||this.params[0]).start-1;"("!==e.original[n]&&n<r;)++n;"("!==e.original[n]&&(n=-1);var a=-1===n;if(i.arrow||this.needsArguments(i)){for(var o=this.body.start;"="!==e.original[o];)o-=1;e.remove(o,this.body.start),t.prototype.transpile.call(this,e,i),a&&(e.prependRight(this.params[0].start,"("),e.appendLeft(this.params[0].end,")"));var s,c=this.parent&&"ExpressionStatement"===this.parent.type,u=c?"!":"";this.async&&(u+="async "),u+="function",c||(u+=" "),(s=a?this.params[0].start:n)>this.start?e.overwrite(this.start,s,u):e.prependRight(this.start,u)}else t.prototype.transpile.call(this,e,i);i.trailingFunctionCommas&&this.params.length&&!a&&ke(e,this.params[this.params.length-1].end)},e.prototype.needsArguments=function(t){return t.spreadRest&&this.params.filter((function(t){return"RestElement"===t.type})).length>0},e}(fe);function Le(t,e){var i=e.findDeclaration(t.name);if(i&&"const"===i.kind)throw new Se(t.name+" is read-only",t)}var _e=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){if("Identifier"===this.left.type){var i=this.findScope(!1).findDeclaration(this.left.name),n=i&&i.node.ancestor(3);n&&"ForStatement"===n.type&&n.body.contains(this)&&(n.reassigned[this.left.name]=!0)}t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){"Identifier"===this.left.type&&Le(this.left,this.findScope(!1)),"**="===this.operator&&i.exponentiation?this.transpileExponentiation(e,i):/Pattern/.test(this.left.type)&&i.destructuring&&this.transpileDestructuring(e),t.prototype.transpile.call(this,e,i)},e.prototype.transpileDestructuring=function(t){var e=this,i=this.findScope(!0),n=this.findScope(!1),r=i.createDeclaration("assign");t.appendRight(this.left.end,"("+r),t.appendLeft(this.right.end,", ");var a=[];Ne(t,(function(t){return i.createDeclaration(t)}),(function(t){var e=n.resolveName(t.name);return Le(t,n),e}),this.left,r,!0,a);var o=", ";a.forEach((function(t,i){i===a.length-1&&(o=""),t(e.end,"",o)})),"ExpressionStatement"===this.unparenthesizedParent().type?t.prependRight(this.end,")"):t.appendRight(this.end,", "+r+")")},e.prototype.transpileExponentiation=function(t){for(var e,i=this.findScope(!1),n=this.left.end;"*"!==t.original[n];)n+=1;t.remove(n,n+2);var r=this.left.unparenthesize();if("Identifier"===r.type)e=i.resolveName(r.name);else if("MemberExpression"===r.type){var a,o,s=!1,c=!1,u=this.findNearest(/(?:Statement|Declaration)$/),d=u.getIndentation();"Identifier"===r.property.type?o=r.computed?i.resolveName(r.property.name):r.property.name:(o=i.createDeclaration("property"),c=!0),"Identifier"===r.object.type?a=i.resolveName(r.object.name):(a=i.createDeclaration("object"),s=!0),r.start===u.start?s&&c?(t.prependRight(u.start,a+" = "),t.overwrite(r.object.end,r.property.start,";\n"+d+o+" = "),t.overwrite(r.property.end,r.end,";\n"+d+a+"["+o+"]")):s?(t.prependRight(u.start,a+" = "),t.appendLeft(r.object.end,";\n"+d),t.appendLeft(r.object.end,a)):c&&(t.prependRight(r.property.start,o+" = "),t.appendLeft(r.property.end,";\n"+d),t.move(r.property.start,r.property.end,this.start),t.appendLeft(r.object.end,"["+o+"]"),t.remove(r.object.end,r.property.start),t.remove(r.property.end,r.end)):(s&&c?(t.prependRight(r.start,"( "+a+" = "),t.overwrite(r.object.end,r.property.start,", "+o+" = "),t.overwrite(r.property.end,r.end,", "+a+"["+o+"]")):s?(t.prependRight(r.start,"( "+a+" = "),t.appendLeft(r.object.end,", "+a)):c&&(t.prependRight(r.property.start,"( "+o+" = "),t.appendLeft(r.property.end,", "),t.move(r.property.start,r.property.end,r.start),t.overwrite(r.object.end,r.property.start,"["+o+"]"),t.remove(r.property.end,r.end)),c&&t.appendLeft(this.end," )")),e=a+(r.computed||c?"["+o+"]":"."+o)}t.prependRight(this.right.start,"Math.pow( "+e+", "),t.appendLeft(this.right.end," )")},e}(fe),Fe=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){e.asyncAwait&&Se.missingTransform("await","asyncAwait",this),t.prototype.initialise.call(this,e)},e}(fe),je=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){"**"===this.operator&&i.exponentiation&&(e.prependRight(this.start,"Math.pow( "),e.overwrite(this.left.end,this.right.start,", "),e.appendLeft(this.end," )")),t.prototype.transpile.call(this,e,i)},e}(fe),Be=/(?:For(?:In|Of)?|While)Statement/,Ve=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(){var t=this.findNearest(Be),e=this.findNearest("SwitchCase");t&&(!e||t.depth>e.depth)&&(t.canBreak=!0,this.loop=t)},e.prototype.transpile=function(t){if(this.loop&&this.loop.shouldRewriteAsFunction){if(this.label)throw new Se("Labels are not currently supported in a loop with locally-scoped variables",this);t.overwrite(this.start,this.start+5,"return 'break'")}},e}(fe),Ge=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){if(e.spreadRest&&this.arguments.length>1)for(var i=this.findLexicalBoundary(),n=this.arguments.length;n--;){var r=this.arguments[n];"SpreadElement"===r.type&&Te(r.argument)&&(this.argumentsArrayAlias=i.getArgumentsArrayAlias())}t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){if(i.spreadRest&&this.arguments.length&&Ce(e,this,this.arguments),i.spreadRest&&this.arguments.length){var n,r=!1,a=this.arguments[0];if(1===this.arguments.length?"SpreadElement"===a.type&&(e.remove(a.start,a.argument.start),r=!0):r=xe(e,this.arguments,a.start,this.argumentsArrayAlias),r){var o=null;if("Super"===this.callee.type?o=this.callee:"MemberExpression"===this.callee.type&&"Super"===this.callee.object.type&&(o=this.callee.object),o||"MemberExpression"!==this.callee.type)n="void 0";else if("Identifier"===this.callee.object.type)n=this.callee.object.name;else{n=this.findScope(!0).createDeclaration("ref");var s=this.callee.object;e.prependRight(s.start,"("+n+" = "),e.appendLeft(s.end,")")}e.appendLeft(this.callee.end,".apply"),o?(o.noCall=!0,this.arguments.length>1&&("SpreadElement"===a.type?Me(a.argument)&&e.prependRight(a.start,"( "):e.prependRight(a.start,"[ "),e.appendLeft(this.arguments[this.arguments.length-1].end," )"))):1===this.arguments.length?e.prependRight(a.start,n+", "):("SpreadElement"===a.type?Me(a.argument)?e.appendLeft(a.start,n+", ( "):e.appendLeft(a.start,n+", "):e.appendLeft(a.start,n+", [ "),e.appendLeft(this.arguments[this.arguments.length-1].end," )"))}}i.trailingFunctionCommas&&this.arguments.length&&ke(e,this.arguments[this.arguments.length-1].end),t.prototype.transpile.call(this,e,i)},e}(fe),He=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i,n,r){var a=this;if(i.classes){var o=this.parent.name,s=e.getIndentString(),c=this.getIndentation()+(n?s:""),u=c+s,d=be(this.body,(function(t){return"constructor"===t.kind})),l=this.body[d],p="",h="";if(this.body.length?(e.remove(this.start,this.body[0].start),e.remove(this.body[this.body.length-1].end,this.end)):e.remove(this.start,this.end),l){l.value.body.isConstructorBody=!0;var f=this.body[d+1];d>0&&(e.remove(this.body[d-1].end,l.start),e.move(l.start,f?f.start:this.end-1,this.body[0].start)),n||e.appendLeft(l.end,";")}var m=[];this.body.forEach((function(t){if("FieldDefinition"===t.type&&(m.push(t.computed?"this"+e.slice(t.start,t.end)+";":"this."+e.slice(t.start,t.end)+";"),e.remove(t.start,t.end),""!==e.byStart[t.end].content)){for(var i=0;i<e.byStart[t.end].content.length&&-1===e.byStart[t.end].content.slice(0,i).indexOf(";");i++);i>0&&e.remove(t.end,t.end+i)}}));var g=!1!==this.program.options.namedFunctionExpressions,v=g||this.parent.superClass||"ClassDeclaration"!==this.parent.type;if(this.parent.superClass){var y="if ( "+r+" ) "+o+".__proto__ = "+r+";\n"+c+o+".prototype = Object.create( "+r+" && "+r+".prototype );\n"+c+o+".prototype.constructor = "+o+";";p+=l?"\n\n"+c+y:(y="function "+o+" () {"+(m.length?"\n"+u+m.join("\n"+u)+"\n"+u:"")+(r?"\n"+u+r+".apply(this, arguments);\n"+c+"}":"}")+(n?"":";")+(this.body.length?"\n\n"+c:"")+y)+"\n\n"+c}else if(!l){var I="function "+(v?o+" ":"")+"() {"+(m.length?"\n"+u+m.join("\n"+u)+"\n"+c:"")+"}";"ClassDeclaration"===this.parent.type&&(I+=";"),this.body.length&&(I+="\n\n"+c),p+=I}l&&m.length&&e.appendLeft(l.value.body.start+1,"\n"+u+m.join("\n"+u));var w,S,b=this.findScope(!1),U=[],N=[];if(this.body.forEach((function(t,n){if("get"!==t.kind&&"set"!==t.kind||!i.getterSetter||Se.missingTransform("getters and setters","getterSetter",t),"FieldDefinition"!==t.type)if("constructor"!==t.kind){t.static&&e.remove(t.start,t.start+(" "==e.original[t.start+6]?7:6));var r,s="method"!==t.kind,u=t.key.name;(ve[u]||t.value.body.scope.references[u])&&(u=b.createIdentifier(u));var l=!1;if(t.computed||"Literal"!==t.key.type||(l=!0,t.computed=!0),s){if(t.computed)throw new Error("Computed accessor properties are not currently supported");e.remove(t.start,t.key.start),t.static?(~N.indexOf(t.key.name)||N.push(t.key.name),S||(S=b.createIdentifier("staticAccessors")),r=""+S):(~U.indexOf(t.key.name)||U.push(t.key.name),w||(w=b.createIdentifier("prototypeAccessors")),r=""+w)}else r=t.static?""+o:o+".prototype";t.computed||(r+="."),(d>0&&n===d+1||0===n&&d===a.body.length-1)&&(r="\n\n"+c+r);var p=t.key.end;if(t.computed)if(l)e.prependRight(t.key.start,"["),e.appendLeft(t.key.end,"]");else{for(;"]"!==e.original[p];)p+=1;p+=1}var h=(s?"."+t.kind:"")+" = "+(t.value.async?"async ":"")+"function"+(t.value.generator?"* ":" ")+(t.computed||s||!g?"":u+" ");e.remove(p,t.value.start),e.prependRight(t.value.start,h),e.appendLeft(t.end,";"),t.value.generator&&e.remove(t.start,t.key.start);var f=t.key.start;if(t.computed&&!l)for(;"["!=e.original[f];)--f;t.start<f?e.overwrite(t.start,f,r):e.prependRight(t.start,r)}else e.overwrite(t.key.start,t.key.end,"function"+(v?" "+o:""))})),U.length||N.length){var P=[],E=[];U.length&&(P.push("var "+w+" = { "+U.map((function(t){return t+": { configurable: true }"})).join(",")+" };"),E.push("Object.defineProperties( "+o+".prototype, "+w+" );")),N.length&&(P.push("var "+S+" = { "+N.map((function(t){return t+": { configurable: true }"})).join(",")+" };"),E.push("Object.defineProperties( "+o+", "+S+" );")),l&&(p+="\n\n"+c),p+=P.join("\n"+c),l||(p+="\n\n"+c),h+="\n\n"+c+E.join("\n"+c)}l?e.appendLeft(l.end,p):e.prependRight(this.start,p),e.appendLeft(this.end,h)}t.prototype.transpile.call(this,e,i)},e}(fe),We=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){this.id?(this.name=this.id.name,this.findScope(!0).addDeclaration(this.id,"class")):this.name=this.findScope(!0).createIdentifier("defaultExport"),t.prototype.initialise.call(this,e)},e.prototype.transpile=function(t,e){if(e.classes){this.superClass||function(t,e){var i=t.start,n=t.end,r=e.getIndentString(),a=r.length,o=i-a;t.program.indentExclusions[o]||e.original.slice(o,i)!==r||e.remove(o,i);for(var s,c=new RegExp(r+"\\S","g"),u=e.original.slice(i,n);s=c.exec(u);){var d=i+s.index;t.program.indentExclusions[d]||e.remove(d,d+a)}}(this.body,t);var i=this.superClass&&(this.superClass.name||"superclass"),n=this.getIndentation(),r=n+t.getIndentString(),a="ExportDefaultDeclaration"===this.parent.type;a&&t.remove(this.parent.start,this.start);var o=this.start;this.id?(t.overwrite(o,this.id.start,"var "),o=this.id.end):t.prependLeft(o,"var "+this.name),this.superClass?this.superClass.end===this.body.start?(t.remove(o,this.superClass.start),t.appendLeft(o," = /*@__PURE__*/(function ("+i+") {\n"+r)):(t.overwrite(o,this.superClass.start," = "),t.overwrite(this.superClass.end,this.body.start,"/*@__PURE__*/(function ("+i+") {\n"+r)):o===this.body.start?t.appendLeft(o," = "):t.overwrite(o,this.body.start," = "),this.body.transpile(t,e,!!this.superClass,i);var s=a?"\n\n"+n+"export default "+this.name+";":"";this.superClass?(t.appendLeft(this.end,"\n\n"+r+"return "+this.name+";\n"+n+"}("),t.move(this.superClass.start,this.superClass.end,this.end),t.prependRight(this.end,"));"+s)):s&&t.prependRight(this.end,s)}else this.body.transpile(t,e,!1,null)},e}(fe),qe=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){this.name=(this.id?this.id.name:"VariableDeclarator"===this.parent.type?this.parent.id.name:"AssignmentExpression"!==this.parent.type?null:"Identifier"===this.parent.left.type?this.parent.left.name:"MemberExpression"===this.parent.left.type?this.parent.left.property.name:null)||this.findScope(!0).createIdentifier("anonymous"),t.prototype.initialise.call(this,e)},e.prototype.transpile=function(t,e){if(e.classes){var i=this.superClass&&(this.superClass.name||"superclass"),n=this.getIndentation(),r=n+t.getIndentString();this.superClass?(t.remove(this.start,this.superClass.start),t.remove(this.superClass.end,this.body.start),t.appendRight(this.start,"/*@__PURE__*/(function ("+i+") {\n"+r)):t.overwrite(this.start,this.body.start,"/*@__PURE__*/(function () {\n"+r),this.body.transpile(t,e,!0,i);var a="";this.superClass&&(a=t.slice(this.superClass.start,this.superClass.end),t.remove(this.superClass.start,this.superClass.end)),t.appendLeft(this.end,"\n\n"+r+"return "+this.name+";\n"+n+"}("+a+"))")}else this.body.transpile(t,e,!1)},e}(fe),ze=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(t){if(this.findNearest(Be).shouldRewriteAsFunction){if(this.label)throw new Se("Labels are not currently supported in a loop with locally-scoped variables",this);t.overwrite(this.start,this.start+8,"return")}},e}(fe),Ke=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){e.moduleExport&&Se.missingTransform("export","moduleExport",this),t.prototype.initialise.call(this,e)},e}(fe),Ye=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){e.moduleExport&&Se.missingTransform("export","moduleExport",this),t.prototype.initialise.call(this,e)},e}(fe),Je=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.findScope=function(t){return t||!this.createdScope?this.parent.findScope(t):this.body.scope},e.prototype.initialise=function(e){if(this.body.createScope(),this.createdScope=!0,this.reassigned=Object.create(null),this.aliases=Object.create(null),this.thisRefs=[],t.prototype.initialise.call(this,e),e.letConst)for(var i=Object.keys(this.body.scope.declarations),n=i.length;n--;){for(var r=this.body.scope.declarations[i[n]],a=r.instances.length;a--;){var o=r.instances[a].findNearest(/Function/);if(o&&o.depth>this.depth){this.shouldRewriteAsFunction=!0;for(var s=0,c=this.thisRefs;s<c.length;s+=1){var u=c[s];u.alias=u.alias||u.findLexicalBoundary().getThisAlias()}break}}if(this.shouldRewriteAsFunction)break}},e.prototype.transpile=function(e,i){var n="ForOfStatement"!=this.type&&("BlockStatement"!==this.body.type||"BlockStatement"===this.body.type&&this.body.synthetic);if(this.shouldRewriteAsFunction){var r=this.getIndentation(),a=r+e.getIndentString(),o=this.args?" "+this.args.join(", ")+" ":"",s=this.params?" "+this.params.join(", ")+" ":"",c=this.findScope(!0),u=c.createIdentifier("loop"),d="var "+u+" = function ("+s+") "+(this.body.synthetic?"{\n"+r+e.getIndentString():""),l=(this.body.synthetic?"\n"+r+"}":"")+";\n\n"+r;if(e.prependRight(this.body.start,d),e.appendLeft(this.body.end,l),e.move(this.start,this.body.start,this.body.end),this.canBreak||this.canReturn){var p=c.createIdentifier("returned"),h="{\n"+a+"var "+p+" = "+u+"("+o+");\n";this.canBreak&&(h+="\n"+a+"if ( "+p+" === 'break' ) break;"),this.canReturn&&(h+="\n"+a+"if ( "+p+" ) return "+p+".v;"),e.prependRight(this.body.end,h+="\n"+r+"}")}else{var f=u+"("+o+");";"DoWhileStatement"===this.type?e.overwrite(this.start,this.body.start,"do {\n"+a+f+"\n"+r+"}"):e.prependRight(this.body.end,f)}}else n&&(e.appendLeft(this.body.start,"{ "),e.prependRight(this.body.end," }"));t.prototype.transpile.call(this,e,i)},e}(fe),$e=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.findScope=function(t){return t||!this.createdScope?this.parent.findScope(t):this.body.scope},e.prototype.transpile=function(e,i){var n=this,r=this.getIndentation()+e.getIndentString();if(this.shouldRewriteAsFunction){var a="VariableDeclaration"===this.init.type?this.init.declarations.map((function(t){return me(t.id)})):[],o=this.aliases;this.args=a.map((function(t){return t in n.aliases?n.aliases[t].outer:t})),this.params=a.map((function(t){return t in n.aliases?n.aliases[t].inner:t}));var s=Object.keys(this.reassigned).map((function(t){return o[t].outer+" = "+o[t].inner+";"}));s.length&&(this.body.synthetic?e.appendLeft(this.body.body[0].end,"; "+s.join(" ")):e.appendLeft(this.body.body[this.body.body.length-1].end,"\n\n"+r+s.join("\n"+r)))}t.prototype.transpile.call(this,e,i)},e}(Je),Ze=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.findScope=function(t){return t||!this.createdScope?this.parent.findScope(t):this.body.scope},e.prototype.transpile=function(e,i){var n=this,r="VariableDeclaration"===this.left.type;if(this.shouldRewriteAsFunction){var a=r?this.left.declarations.map((function(t){return me(t.id)})):[];this.args=a.map((function(t){return t in n.aliases?n.aliases[t].outer:t})),this.params=a.map((function(t){return t in n.aliases?n.aliases[t].inner:t}))}t.prototype.transpile.call(this,e,i);var o=r?this.left.declarations[0].id:this.left;"Identifier"!==o.type&&this.destructurePattern(e,o,r)},e.prototype.destructurePattern=function(t,e,i){var n=this.findScope(!0),r=this.getIndentation()+t.getIndentString(),a=n.createIdentifier("ref"),o=this.body.body.length?this.body.body[0].start:this.body.start+1;t.move(e.start,e.end,o),t.prependRight(e.end,i?a:"var "+a);var s=[];Ne(t,(function(t){return n.createIdentifier(t)}),(function(t){return n.resolveName(t.name)}),e,a,!1,s);var c=";\n"+r;s.forEach((function(t,e){e===s.length-1&&(c=";\n\n"+r),t(o,"",c)}))},e}(Je),Xe=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){e.forOf&&!e.dangerousForOf&&Se.missingTransform("for-of statements","forOf",this,"dangerousForOf"),this.await&&e.asyncAwait&&Se.missingTransform("for-await-of statements","asyncAwait",this),t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){if(t.prototype.transpile.call(this,e,i),i.dangerousForOf)if(this.body.body[0]){var n=this.findScope(!0),r=this.getIndentation(),a=r+e.getIndentString(),o=n.createIdentifier("i"),s=n.createIdentifier("list");this.body.synthetic&&(e.prependRight(this.left.start,"{\n"+a),e.appendLeft(this.body.body[0].end,"\n"+r+"}"));var c=this.body.body[0].start;e.remove(this.left.end,this.right.start),e.move(this.left.start,this.left.end,c),e.prependRight(this.right.start,"var "+o+" = 0, "+s+" = "),e.appendLeft(this.right.end,"; "+o+" < "+s+".length; "+o+" += 1");var u="VariableDeclaration"===this.left.type,d=u?this.left.declarations[0].id:this.left;if("Identifier"!==d.type){var l=[],p=n.createIdentifier("ref");Ne(e,(function(t){return n.createIdentifier(t)}),(function(t){return n.resolveName(t.name)}),d,p,!u,l);var h=";\n"+a;l.forEach((function(t,e){e===l.length-1&&(h=";\n\n"+a),t(c,"",h)})),u?(e.appendLeft(this.left.start+this.left.kind.length+1,p),e.appendLeft(this.left.end," = "+s+"["+o+"];\n"+a)):e.appendLeft(this.left.end,"var "+p+" = "+s+"["+o+"];\n"+a)}else e.appendLeft(this.left.end," = "+s+"["+o+"];\n\n"+a)}else"VariableDeclaration"===this.left.type&&"var"===this.left.kind?(e.remove(this.start,this.left.start),e.appendLeft(this.left.end,";"),e.remove(this.left.end,this.end)):e.remove(this.start,this.end)},e}(Je),Qe=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){this.generator&&e.generator&&Se.missingTransform("generators","generator",this),this.async&&e.asyncAwait&&Se.missingTransform("async functions","asyncAwait",this),this.body.createScope(),this.id&&this.findScope(!0).addDeclaration(this.id,"function"),t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){t.prototype.transpile.call(this,e,i),i.trailingFunctionCommas&&this.params.length&&ke(e,this.params[this.params.length-1].end)},e}(fe),ti=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){this.generator&&e.generator&&Se.missingTransform("generators","generator",this),this.async&&e.asyncAwait&&Se.missingTransform("async functions","asyncAwait",this),this.body.createScope(),this.id&&this.body.scope.addDeclaration(this.id,"function"),t.prototype.initialise.call(this,e);var i,n=this.parent;if(e.conciseMethodProperty&&"Property"===n.type&&"init"===n.kind&&n.method&&"Identifier"===n.key.type||e.classes&&"MethodDefinition"===n.type&&"method"===n.kind&&"Identifier"===n.key.type?i=n.key.name:this.id&&"Identifier"===this.id.type&&(i=this.id.alias||this.id.name),i)for(var r=0,a=this.params;r<a.length;r+=1){var o=a[r];if("Identifier"===o.type&&i===o.name){var s=this.body.scope,c=s.declarations[i],u=s.createIdentifier(i);o.alias=u;for(var d=0,l=c.instances;d<l.length;d+=1)l[d].alias=u;break}}},e.prototype.transpile=function(e,i){t.prototype.transpile.call(this,e,i),i.trailingFunctionCommas&&this.params.length&&ke(e,this.params[this.params.length-1].end)},e}(fe),ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.findScope=function(t){return this.parent.params&&~this.parent.params.indexOf(this)||"FunctionExpression"===this.parent.type&&this===this.parent.id?this.parent.body.scope:this.parent.findScope(t)},e.prototype.initialise=function(t){if(function t(e,i){return"MemberExpression"===e.type?!e.computed&&t(e.object,e):"Identifier"===e.type?!i||!/(Function|Class)Expression/.test(i.type)&&("VariableDeclarator"===i.type?e===i.init:"MemberExpression"===i.type||"MethodDefinition"===i.type?i.computed||e===i.object:"ArrayPattern"!==i.type&&("Property"===i.type?"ObjectPattern"!==i.parent.type&&(i.computed||e===i.value):"MethodDefinition"!==i.type&&("ExportSpecifier"!==i.type||e===i.local))):void 0}(this,this.parent)){if(t.arrow&&"arguments"===this.name&&!this.findScope(!1).contains(this.name)){var e=this.findLexicalBoundary(),i=this.findNearest("ArrowFunctionExpression"),n=this.findNearest(Be);i&&i.depth>e.depth&&(this.alias=e.getArgumentsAlias()),n&&n.body.contains(this)&&n.depth>e.depth&&(this.alias=e.getArgumentsAlias())}this.findScope(!1).addReference(this)}},e.prototype.transpile=function(t){this.alias&&t.overwrite(this.start,this.end,this.alias,{storeName:!0,contentOnly:!0})},e}(fe),ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){("BlockStatement"!==this.consequent.type||"BlockStatement"===this.consequent.type&&this.consequent.synthetic)&&(e.appendLeft(this.consequent.start,"{ "),e.prependRight(this.consequent.end," }")),this.alternate&&"IfStatement"!==this.alternate.type&&("BlockStatement"!==this.alternate.type||"BlockStatement"===this.alternate.type&&this.alternate.synthetic)&&(e.appendLeft(this.alternate.start,"{ "),e.prependRight(this.alternate.end," }")),t.prototype.transpile.call(this,e,i)},e}(fe),ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){e.moduleImport&&Se.missingTransform("dynamic import expressions","moduleImport",this),t.prototype.initialise.call(this,e)},e}(fe),ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){e.moduleImport&&Se.missingTransform("import","moduleImport",this),t.prototype.initialise.call(this,e)},e}(fe),ai=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){this.findScope(!0).addDeclaration(this.local,"import"),t.prototype.initialise.call(this,e)},e}(fe),oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){this.findScope(!0).addDeclaration(this.local,"import"),t.prototype.initialise.call(this,e)},e}(fe),si=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){var n,r=this.name;e.overwrite(r.start,this.value?this.value.start:this.name.end,(/-/.test(n=r.name)?"'"+n+"'":n)+": "+(this.value?"":"true")),t.prototype.transpile.call(this,e,i)},e}(fe),ci=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(t){var e,i=!0,n=this.parent.children[this.parent.children.length-1];(n&&"JSXText"===(e=n).type&&!/\S/.test(e.value)&&/\n/.test(e.value)||this.parent.openingElement.attributes.length)&&(i=!1),t.overwrite(this.start,this.end,i?" )":")")},e}(fe),ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(t){var e,i=!0,n=this.parent.children[this.parent.children.length-1];n&&"JSXText"===(e=n).type&&!/\S/.test(e.value)&&/\n/.test(e.value)&&(i=!1),t.overwrite(this.start,this.end,i?" )":")")},e}(fe);function di(t,e){return t=t.replace(/\u00a0/g,"&nbsp;"),e&&/\n/.test(t)&&(t=t.replace(/\s+$/,"")),t=t.replace(/^\n\r?\s+/,"").replace(/\s*\n\r?\s*/gm," "),JSON.stringify(t)}var li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){t.prototype.transpile.call(this,e,i);var n=this.children.filter((function(t){return"JSXText"!==t.type||/\S/.test(t.raw)||!/\n/.test(t.raw)}));if(n.length){var r,a=(this.openingElement||this.openingFragment).end;for(r=0;r<n.length;r+=1){var o=n[r];if("JSXExpressionContainer"===o.type&&"JSXEmptyExpression"===o.expression.type||e.appendLeft(a,","+("\n"===e.original[a]&&"JSXText"!==o.type?"":" ")),"JSXText"===o.type){var s=di(o.value,r===n.length-1);e.overwrite(o.start,o.end,s)}a=o.end}}},e}(fe),pi=/[\u2028-\u2029]/g,hi={ArrayExpression:Re,ArrowFunctionExpression:Oe,AssignmentExpression:_e,AwaitExpression:Fe,BinaryExpression:je,BreakStatement:Ve,CallExpression:Ge,ClassBody:He,ClassDeclaration:We,ClassExpression:qe,ContinueStatement:ze,DoWhileStatement:Je,ExportNamedDeclaration:Ye,ExportDefaultDeclaration:Ke,ForStatement:$e,ForInStatement:Ze,ForOfStatement:Xe,FunctionDeclaration:Qe,FunctionExpression:ti,Identifier:ei,IfStatement:ii,Import:ni,ImportDeclaration:ri,ImportDefaultSpecifier:ai,ImportSpecifier:oi,JSXAttribute:si,JSXClosingElement:ci,JSXClosingFragment:ui,JSXElement:li,JSXExpressionContainer:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){e.remove(this.start,this.expression.start),e.remove(this.expression.end,this.end),t.prototype.transpile.call(this,e,i)},e}(fe),JSXFragment:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(li),JSXOpeningElement:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){t.prototype.transpile.call(this,e,i),e.overwrite(this.start,this.name.start,this.program.jsx+"( ");var n="JSXIdentifier"===this.name.type&&this.name.name[0]===this.name.name[0].toLowerCase();n&&e.prependRight(this.name.start,"'");var r=this.attributes.length,a=this.name.end;if(r){var o,s,c,u=!1;for(o=0;o<r;o+=1)if("JSXSpreadAttribute"===this.attributes[o].type){u=!0;break}for(a=this.attributes[0].end,o=0;o<r;o+=1){var d=this.attributes[o];if(o>0&&(d.start===a?e.prependRight(a,", "):e.overwrite(a,d.start,", ")),u&&"JSXSpreadAttribute"!==d.type){var l=this.attributes[o-1],p=this.attributes[o+1];l&&"JSXSpreadAttribute"!==l.type||e.prependRight(d.start,"{ "),p&&"JSXSpreadAttribute"!==p.type||e.appendLeft(d.end," }")}a=d.end}if(u)if(1===r)c=n?"',":",";else{if(!this.program.options.objectAssign)throw new Se("Mixed JSX attributes ending in spread requires specified objectAssign option with 'Object.assign' or polyfill helper.",this);c=n?"', "+this.program.options.objectAssign+"({},":", "+this.program.options.objectAssign+"({},",s=")"}else c=n?"', {":", {",s=" }";e.prependRight(this.name.end,c),s&&e.appendLeft(this.attributes[r-1].end,s)}else e.appendLeft(this.name.end,n?"', null":", null"),a=this.name.end;this.selfClosing?e.overwrite(a,this.end,this.attributes.length?")":" )"):e.remove(a,this.end)},e}(fe),JSXOpeningFragment:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(t){t.overwrite(this.start,this.end,this.program.jsx+"( React.Fragment, null")},e}(fe),JSXSpreadAttribute:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){e.remove(this.start,this.argument.start),e.remove(this.argument.end,this.end),t.prototype.transpile.call(this,e,i)},e}(fe),Literal:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(){"string"==typeof this.value&&this.program.indentExclusionElements.push(this)},e.prototype.transpile=function(t,e){e.numericLiteral&&this.raw.match(/^0[bo]/i)&&t.overwrite(this.start,this.end,String(this.value),{storeName:!0,contentOnly:!0}),"string"==typeof this.value&&this.value.match(pi)&&t.overwrite(this.start,this.end,this.raw.replace(pi,(function(t){return"\u2028"==t?"\\u2028":"\\u2029"})),{contentOnly:!0})},e}(fe),MemberExpression:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){i.reservedProperties&&ve[this.property.name]&&(e.overwrite(this.object.end,this.property.start,"['"),e.appendLeft(this.property.end,"']")),t.prototype.transpile.call(this,e,i)},e}(fe),NewExpression:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){if(e.spreadRest&&this.arguments.length)for(var i=this.findLexicalBoundary(),n=this.arguments.length;n--;){var r=this.arguments[n];if("SpreadElement"===r.type&&Te(r.argument)){this.argumentsArrayAlias=i.getArgumentsArrayAlias();break}}t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){if(t.prototype.transpile.call(this,e,i),i.spreadRest&&this.arguments.length&&Ce(e,this,this.arguments),i.spreadRest&&this.arguments.length){var n=this.arguments[0];xe(e,this.arguments,n.start,this.argumentsArrayAlias,!0)&&(e.prependRight(this.start+"new".length," (Function.prototype.bind.apply("),e.overwrite(this.callee.end,n.start,", [ null ].concat( "),e.appendLeft(this.end," ))"))}this.arguments.length&&ke(e,this.arguments[this.arguments.length-1].end)},e}(fe),ObjectExpression:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){var n;t.prototype.transpile.call(this,e,i);for(var r=this.start+1,a=0,o=0,s=null,c=null,u=0;u<this.properties.length;++u){var d=this.properties[u];if("SpreadElement"===d.type){var l=d.argument;"ObjectExpression"===l.type||"Literal"===l.type&&"string"!=typeof l.value?"ObjectExpression"===l.type&&l.properties.length>0?(e.remove(d.start,l.properties[0].start),e.remove(l.properties[l.properties.length-1].end,d.end),(n=this.properties).splice.apply(n,[u,1].concat(l.properties)),u--):(e.remove(d.start,u===this.properties.length-1?d.end:this.properties[u+1].start),this.properties.splice(u,1),u--):(a+=1,null===s&&(s=u))}else d.computed&&i.computedProperty&&(o+=1,null===c&&(c=u))}if(!a||i.objectRestSpread||o&&i.computedProperty){if(a){if(!this.program.options.objectAssign)throw new Se("Object spread operator requires specified objectAssign option with 'Object.assign' or polyfill helper.",this);for(var p=this.properties.length;p--;){var h=this.properties[p];if("Property"===h.type&&!o){var f=this.properties[p-1],m=this.properties[p+1];f&&"Property"===f.type||e.prependRight(h.start,"{"),m&&"Property"===m.type||e.appendLeft(h.end,"}")}"SpreadElement"===h.type&&(e.remove(h.start,h.argument.start),e.remove(h.argument.end,h.end))}r=this.properties[0].start,o?"SpreadElement"===this.properties[0].type?(e.overwrite(this.start,r,this.program.options.objectAssign+"({}, "),e.remove(this.end-1,this.end),e.appendRight(this.end,")")):(e.prependLeft(this.start,this.program.options.objectAssign+"("),e.appendRight(this.end,")")):(e.overwrite(this.start,r,this.program.options.objectAssign+"({}, "),e.overwrite(this.properties[this.properties.length-1].end,this.end,")"))}}else a=0,s=null;if(o&&i.computedProperty){var g,v,y=this.getIndentation();"VariableDeclarator"===this.parent.type&&1===this.parent.parent.declarations.length&&"Identifier"===this.parent.id.type?(g=!0,v=this.parent.id.alias||this.parent.id.name):("AssignmentExpression"===this.parent.type&&"ExpressionStatement"===this.parent.parent.type&&"Identifier"===this.parent.left.type||"AssignmentPattern"===this.parent.type&&"Identifier"===this.parent.left.type)&&(g=!0,v=this.parent.left.alias||this.parent.left.name),a&&(g=!1),v=this.findScope(!1).resolveName(v);var I=r,w=this.end;g||(null===s||c<s?(v=this.findScope(!0).createDeclaration("obj"),e.prependRight(this.start,"( "+v+" = ")):v=null);for(var S,b=this.properties.length,U=!1,N=!0,P=0;P<b;P+=1){var E=this.properties[P],D=P>0?this.properties[P-1].end:I;if("Property"===E.type&&(E.computed||S&&!a)){if(0===P&&(D=this.start+1),S=E,v){var A=(g?";\n"+y+v:", "+v)+("Literal"===E.key.type||E.computed?"":".");D<E.start?e.overwrite(D,E.start,A):e.prependRight(E.start,A)}else v=this.findScope(!0).createDeclaration("obj"),e.appendRight(E.start,"( "+v+" = {}, "+v+(E.computed?"":"."));var T=E.key.end;if(E.computed){for(;"]"!==e.original[T];)T+=1;T+=1}"Literal"!==E.key.type||E.computed?E.shorthand||E.method&&!E.computed&&i.conciseMethodProperty?e.overwrite(E.key.start,E.key.end,e.slice(E.key.start,E.key.end).replace(/:/," =")):(E.value.start>T&&e.remove(T,E.value.start),e.prependLeft(T," = ")):e.overwrite(E.start,E.key.end+1,"["+e.slice(E.start,E.key.end)+"] = "),!E.method||!E.computed&&i.conciseMethodProperty||(E.value.generator&&e.remove(E.start,E.key.start),e.prependRight(E.value.start,"function"+(E.value.generator?"*":"")+" "))}else"SpreadElement"===E.type?v&&P>0&&(S||(S=this.properties[P-1]),e.appendLeft(S.end,", "+v+" )"),S=null,v=null):(!N&&a&&(e.prependRight(E.start,"{"),e.appendLeft(E.end,"}")),U=!0);if(N&&("SpreadElement"===E.type||E.computed)){var C=U?this.properties[this.properties.length-1].end:this.end-1;","==e.original[C]&&++C;var M=e.slice(C,w);e.prependLeft(D,M),e.remove(C,w),N=!1}var x=E.end;if(P<b-1&&!U)for(;","!==e.original[x];)x+=1;else P==b-1&&(x=this.end);E.end!=x&&e.overwrite(E.end,x,"",{contentOnly:!0})}!g&&v&&e.appendLeft(S.end,", "+v+" )")}},e}(fe),Property:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){"get"!==this.kind&&"set"!==this.kind||!e.getterSetter||Se.missingTransform("getters and setters","getterSetter",this),t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){if(t.prototype.transpile.call(this,e,i),i.conciseMethodProperty&&!this.computed&&"ObjectPattern"!==this.parent.type)if(this.shorthand)e.prependRight(this.start,this.key.name+": ");else if(this.method){var n="";!1!==this.program.options.namedFunctionExpressions&&(n=" "+(n="Literal"===this.key.type&&"number"==typeof this.key.value?"":"Identifier"===this.key.type?ve[this.key.name]||!/^[a-z_$][a-z0-9_$]*$/i.test(this.key.name)||this.value.body.scope.references[this.key.name]?this.findScope(!0).createIdentifier(this.key.name):this.key.name:this.findScope(!0).createIdentifier(this.key.value))),this.start<this.key.start&&e.remove(this.start,this.key.start),e.appendLeft(this.key.end,": "+(this.value.async?"async ":"")+"function"+(this.value.generator?"*":"")+n)}i.reservedProperties&&ve[this.key.name]&&(e.prependRight(this.key.start,"'"),e.appendLeft(this.key.end,"'"))},e}(fe),ReturnStatement:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(t){this.loop=this.findNearest(Be),this.nearestFunction=this.findNearest(/Function/),this.loop&&(!this.nearestFunction||this.loop.depth>this.nearestFunction.depth)&&(this.loop.canReturn=!0,this.shouldWrap=!0),this.argument&&this.argument.initialise(t)},e.prototype.transpile=function(t,e){var i=this.shouldWrap&&this.loop&&this.loop.shouldRewriteAsFunction;this.argument?(i&&t.prependRight(this.argument.start,"{ v: "),this.argument.transpile(t,e),i&&t.appendLeft(this.argument.end," }")):i&&t.appendLeft(this.start+6," {}")},e}(fe),Super:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(t){if(t.classes){if(this.method=this.findNearest("MethodDefinition"),!this.method)throw new Se("use of super outside class method",this);var e=this.findNearest("ClassBody").parent;if(this.superClassName=e.superClass&&(e.superClass.name||"superclass"),!this.superClassName)throw new Se("super used in base class",this);if(this.isCalled="CallExpression"===this.parent.type&&this===this.parent.callee,"constructor"!==this.method.kind&&this.isCalled)throw new Se("super() not allowed outside class constructor",this);if(this.isMember="MemberExpression"===this.parent.type,!this.isCalled&&!this.isMember)throw new Se("Unexpected use of `super` (expected `super(...)` or `super.*`)",this)}if(t.arrow){var i=this.findLexicalBoundary(),n=this.findNearest("ArrowFunctionExpression"),r=this.findNearest(Be);n&&n.depth>i.depth&&(this.thisAlias=i.getThisAlias()),r&&r.body.contains(this)&&r.depth>i.depth&&(this.thisAlias=i.getThisAlias())}},e.prototype.transpile=function(t,e){if(e.classes){t.overwrite(this.start,this.end,this.isCalled||this.method.static?this.superClassName:this.superClassName+".prototype",{storeName:!0,contentOnly:!0});var i=this.isCalled?this.parent:this.parent.parent;if(i&&"CallExpression"===i.type){this.noCall||t.appendLeft(i.callee.end,".call");var n=this.thisAlias||"this";i.arguments.length?t.appendLeft(i.arguments[0].start,n+", "):t.appendLeft(i.end-1,""+n)}}},e}(fe),TaggedTemplateExpression:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){e.templateString&&!e.dangerousTaggedTemplateString&&Se.missingTransform("tagged template strings","templateString",this,"dangerousTaggedTemplateString"),t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){if(i.templateString&&i.dangerousTaggedTemplateString){var n=this.quasi.expressions.concat(this.quasi.quasis).sort((function(t,e){return t.start-e.start})),r=this.program.body.scope,a=this.quasi.quasis.map((function(t){return JSON.stringify(t.value.cooked)})).join(", "),o=this.program.templateLiteralQuasis[a];o||(o=r.createIdentifier("templateObject"),e.prependLeft(this.program.prependAt,"var "+o+" = Object.freeze(["+a+"]);\n"),this.program.templateLiteralQuasis[a]=o),e.overwrite(this.tag.end,n[0].start,"("+o);var s=n[0].start;n.forEach((function(t){"TemplateElement"===t.type?e.remove(s,t.end):e.overwrite(s,t.start,", "),s=t.end})),e.overwrite(s,this.end,")")}t.prototype.transpile.call(this,e,i)},e}(fe),TemplateElement:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(){this.program.indentExclusionElements.push(this)},e}(fe),TemplateLiteral:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.transpile=function(e,i){if(t.prototype.transpile.call(this,e,i),i.templateString&&"TaggedTemplateExpression"!==this.parent.type){var n=this.expressions.concat(this.quasis).sort((function(t,e){return t.start-e.start||t.end-e.end})).filter((function(t,e){return"TemplateElement"!==t.type||!!t.value.raw||!e}));if(n.length>=3){var r=n[0];"TemplateElement"===r.type&&""===r.value.raw&&"TemplateElement"===n[2].type&&n.shift()}var a=!(1===this.quasis.length&&0===this.expressions.length||"TemplateLiteral"===this.parent.type||"AssignmentExpression"===this.parent.type||"AssignmentPattern"===this.parent.type||"VariableDeclarator"===this.parent.type||"BinaryExpression"===this.parent.type&&"+"===this.parent.operator);a&&e.appendRight(this.start,"(");var o=this.start;n.forEach((function(t,i){var n=0===i?a?"(":"":" + ";if("TemplateElement"===t.type)e.overwrite(o,t.end,n+JSON.stringify(t.value.cooked));else{var r="Identifier"!==t.type;r&&(n+="("),e.remove(o,t.start),n&&e.prependRight(t.start,n),r&&e.appendLeft(t.end,")")}o=t.end})),a&&e.appendLeft(o,")"),e.overwrite(o,this.end,"",{contentOnly:!0})}},e}(fe),ThisExpression:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(t){var e=this.findLexicalBoundary();if(t.letConst)for(var i=this.findNearest(Be);i&&i.depth>e.depth;)i.thisRefs.push(this),i=i.parent.findNearest(Be);if(t.arrow){var n=this.findNearest("ArrowFunctionExpression");n&&n.depth>e.depth&&(this.alias=e.getThisAlias())}},e.prototype.transpile=function(t){this.alias&&t.overwrite(this.start,this.end,this.alias,{storeName:!0,contentOnly:!0})},e}(fe),UpdateExpression:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){if("Identifier"===this.argument.type){var i=this.findScope(!1).findDeclaration(this.argument.name),n=i&&i.node.ancestor(3);n&&"ForStatement"===n.type&&n.body.contains(this)&&(n.reassigned[this.argument.name]=!0)}t.prototype.initialise.call(this,e)},e.prototype.transpile=function(e,i){"Identifier"===this.argument.type&&Le(this.argument,this.findScope(!1)),t.prototype.transpile.call(this,e,i)},e}(fe),VariableDeclaration:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(t){this.scope=this.findScope("var"===this.kind),this.declarations.forEach((function(e){return e.initialise(t)}))},e.prototype.transpile=function(t,e){var i=this,n=this.getIndentation(),r=this.kind;if(e.letConst&&"var"!==r&&t.overwrite(this.start,this.start+this.kind.length,r="var",{contentOnly:!0,storeName:!0}),e.destructuring&&"ForOfStatement"!==this.parent.type&&"ForInStatement"!==this.parent.type){var a,o=this.start;this.declarations.forEach((function(r,s){if(r.transpile(t,e),"Identifier"===r.id.type)s>0&&"Identifier"!==i.declarations[s-1].id.type&&t.overwrite(o,r.id.start,"var ");else{var c=Be.test(i.parent.type);0===s?t.remove(o,r.id.start):t.overwrite(o,r.id.start,";\n"+n);var u="Identifier"===r.init.type&&!r.init.rewritten,d=u?r.init.alias||r.init.name:r.findScope(!0).createIdentifier("ref");o=r.start;var l=[];u?t.remove(r.id.end,r.end):l.push((function(e,i,n){t.prependRight(r.id.end,"var "+d),t.appendLeft(r.init.end,""+n),t.move(r.id.end,r.end,e)}));var p=r.findScope(!1);Ne(t,(function(t){return p.createIdentifier(t)}),(function(t){return p.resolveName(t.name)}),r.id,d,c,l);var h=c?"var ":"",f=c?", ":";\n"+n;l.forEach((function(t,e){s===i.declarations.length-1&&e===l.length-1&&(f=c?"":";"),t(r.start,0===e?h:"",f)}))}o=r.end,a="Identifier"!==r.id.type})),a&&this.end>o&&t.overwrite(o,this.end,"",{contentOnly:!0})}else this.declarations.forEach((function(i){i.transpile(t,e)}))},e}(fe),VariableDeclarator:function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.initialise=function(e){var i=this.parent.kind;"let"===i&&"ForStatement"===this.parent.parent.type&&(i="for.let"),this.parent.scope.addDeclaration(this.id,i),t.prototype.initialise.call(this,e)},e.prototype.transpile=function(t,e){if(!this.init&&e.letConst&&"var"!==this.parent.kind){var i=this.findNearest(/Function|^For(In|Of)?Statement|^(?:Do)?WhileStatement/);!i||/Function/.test(i.type)||this.isLeftDeclaratorOfLoop()||t.appendLeft(this.id.end," = (void 0)")}this.id&&this.id.transpile(t,e),this.init&&this.init.transpile(t,e)},e.prototype.isLeftDeclaratorOfLoop=function(){return this.parent&&"VariableDeclaration"===this.parent.type&&this.parent.parent&&("ForInStatement"===this.parent.parent.type||"ForOfStatement"===this.parent.parent.type)&&this.parent.parent.left&&this.parent.parent.left.declarations[0]===this},e}(fe),WhileStatement:Je},fi={Program:["body"],Literal:[]},mi={IfStatement:"consequent",ForStatement:"body",ForInStatement:"body",ForOfStatement:"body",WhileStatement:"body",DoWhileStatement:"body",ArrowFunctionExpression:"body"};function gi(t,e,i,n){this.type="Root",this.jsx=n.jsx||"React.createElement",this.options=n,this.source=t,this.magicString=new pe(t),this.ast=e,this.depth=0,function t(e,i){if(e)if("length"in e)for(var n=e.length;n--;)t(e[n],i);else if(!e.__wrapped){e.__wrapped=!0,fi[e.type]||(fi[e.type]=Object.keys(e).filter((function(t){return"object"==typeof e[t]})));var r=mi[e.type];if(r&&"BlockStatement"!==e[r].type){var a=e[r];e[r]={start:a.start,end:a.end,type:"BlockStatement",body:[a],synthetic:!0}}e.parent=i,e.program=i.program||i,e.depth=i.depth+1,e.keys=fi[e.type],e.indentation=void 0;for(var o=0,s=fi[e.type];o<s.length;o+=1)t(e[s[o]],e);e.program.magicString.addSourcemapLocation(e.start),e.program.magicString.addSourcemapLocation(e.end),e.__proto__=(("BlockStatement"===e.type?Ae:hi[e.type])||fe).prototype}}(this.body=e,this),this.body.__proto__=Ae.prototype,this.templateLiteralQuasis=Object.create(null);for(var r=0;r<this.body.body.length;++r)if(!this.body.body[r].directive){this.prependAt=this.body.body[r].start;break}this.objectWithoutPropertiesHelper=null,this.indentExclusionElements=[],this.body.initialise(i),this.indentExclusions=Object.create(null);for(var a=0,o=this.indentExclusionElements;a<o.length;a+=1)for(var s=o[a],c=s.start;c<s.end;c+=1)this.indentExclusions[c]=!0;this.body.transpile(this.magicString,i)}gi.prototype={export:function(t){return void 0===t&&(t={}),{code:this.magicString.toString(),map:this.magicString.generateMap({file:t.file,source:t.source,includeContent:!1!==t.includeContent})}},findNearest:function(){return null},findScope:function(){return null},getObjectWithoutPropertiesHelper:function(t){return this.objectWithoutPropertiesHelper||(this.objectWithoutPropertiesHelper=this.body.scope.createIdentifier("objectWithoutProperties"),t.prependLeft(this.prependAt,"function "+this.objectWithoutPropertiesHelper+" (obj, exclude) { var target = {}; for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k) && exclude.indexOf(k) === -1) target[k] = obj[k]; return target; }\n")),this.objectWithoutPropertiesHelper}};var vi=j.extend(Jt,zt(),(function(t){return class extends t{getTokenFromCode(t){if(35===t){++this.pos;const t=this.readWord1();return this.finishToken(te,t)}return super.getTokenFromCode(t)}parseClass(t,e){this._privateBoundNamesStack=this._privateBoundNamesStack||[];const i=Object.create(this._privateBoundNamesStack[this._privateBoundNamesStack.length-1]||null);this._privateBoundNamesStack.push(i),this._unresolvedPrivateNamesStack=this._unresolvedPrivateNamesStack||[];const n=Object.create(null);this._unresolvedPrivateNamesStack.push(n);const r=super.parseClass(t,e);if(this._privateBoundNamesStack.pop(),this._unresolvedPrivateNamesStack.pop(),this._unresolvedPrivateNamesStack.length)Object.assign(this._unresolvedPrivateNamesStack[this._unresolvedPrivateNamesStack.length-1],n);else{const t=Object.keys(n);t.length&&(t.sort(((t,e)=>n[t]-n[e])),this.raise(n[t[0]],"Usage of undeclared private name"))}return r}parseClassElement(t){if(this.eat(Zt.semi))return null;const e=this.startNode();if(!(this.options.ecmaVersion>=8)||this.type!=te){if(this.isContextual("async")){$t.lastIndex=this.pos;let t=$t.exec(this.input),i=this.input.charAt(this.pos+t[0].length);if(";"===i||"="===i)return e.key=this.parseIdent(!0),e.computed=!1,Xt.call(this,e),this.finishNode(e,"FieldDefinition"),this.semicolon(),e}return super.parseClassElement.apply(this,arguments)}return e.key=Qt.call(this),e.computed=!1,"constructor"==e.key.name&&this.raise(e.start,"Classes may not have a field named constructor"),Object.prototype.hasOwnProperty.call(this._privateBoundNamesStack[this._privateBoundNamesStack.length-1],e.key.name)&&this.raise(e.start,"Duplicate private element"),this._privateBoundNamesStack[this._privateBoundNamesStack.length-1][e.key.name]=!0,delete this._unresolvedPrivateNamesStack[this._unresolvedPrivateNamesStack.length-1][e.key.name],Xt.call(this,e),this.finishNode(e,"FieldDefinition"),this.semicolon(),e}parseClassMethod(t,e,i,n){return e||i||"method"!=t.kind||t.static||this.options.ecmaVersion<8||this.type==Zt.parenL?super.parseClassMethod.apply(this,arguments):(Xt.call(this,t),delete t.kind,delete t.static,t=this.finishNode(t,"FieldDefinition"),this.semicolon(),t)}parseSubscripts(t,e,i,n){for(let r;;){if(!(r=this.eat(Zt.bracketL))&&!this.eat(Zt.dot))return super.parseSubscripts(t,e,i,n);{let n=this.startNodeAt(e,i);n.object=t,r?n.property=this.parseExpression():this.type==te?(n.property=Qt.call(this),this._privateBoundNamesStack.length&&this._privateBoundNamesStack[this._privateBoundNamesStack.length-1][n.property.name]||(this._unresolvedPrivateNamesStack[this._unresolvedPrivateNamesStack.length-1][n.property.name]=n.property.start)):n.property=this.parseIdent(!0),n.computed=Boolean(r),r&&this.expect(Zt.bracketR),t=this.finishNode(n,"MemberExpression")}}}parseMaybeUnary(t,e){const i=super.parseMaybeUnary(t,e);return"delete"==i.operator&&"MemberExpression"==i.argument.type&&"PrivateName"==i.argument.property.type&&this.raise(i.start,"Private elements may not be deleted"),i}parseIdent(t,e){const i=super.parseIdent(t,e);return this._inFieldValue&&"arguments"==i.name&&this.raise(i.start,"A class field initializer may not contain arguments"),i}parseExprAtom(t){const e=super.parseExprAtom(t);return this._inFieldValue&&"Super"==e.type&&this.raise(e.start,"A class field initializer may not contain super"),e}}})),yi=["getterSetter","arrow","classes","computedProperty","conciseMethodProperty","defaultParameter","destructuring","forOf","generator","letConst","moduleExport","moduleImport","numericLiteral","parameterDestructuring","spreadRest","stickyRegExp","templateString","exponentiation","reservedProperties","trailingFunctionCommas","asyncAwait","objectRestSpread"],Ii=["dangerousTaggedTemplateString","dangerousForOf"];function wi(t,e){var i;void 0===e&&(e={});var n=null;try{i=vi.parse(t,{ecmaVersion:10,preserveParens:!0,sourceType:"module",allowAwaitOutsideFunction:!0,allowReturnOutsideFunction:!0,allowHashBang:!0,onComment:function(t,e){if(!n){var i=/@jsx\s+([^\s]+)/.exec(e);i&&(n=i[1])}}}),e.jsx=n||e.jsx}catch(e){throw e.snippet=we(t,e.loc),e.toString=function(){return e.name+": "+e.message+"\n"+e.snippet},e}var r=Object.create(null);return yi.forEach((function(t){r[t]=!0})),Ii.forEach((function(t){r[t]=!0})),Object.keys(e.transforms||{}).forEach((function(t){if("modules"===t)return"moduleImport"in e.transforms||(r.moduleImport=e.transforms.modules),void("moduleExport"in e.transforms||(r.moduleExport=e.transforms.modules));if(!(t in r))throw new Error("Unknown transform '"+t+"'");r[t]=e.transforms[t]})),!0===e.objectAssign&&(e.objectAssign="Object.assign"),new gi(t,i,r,e).export(e)}},8879:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return he}});var n=i(7294),r=i(3905),a=i(2263),o=i(6291),s=i(2611),c=i(2122),u=i(9756),d=i(6010),l=i(9732),p=i(944),h=i(1839),f=i(3783),m=i(7898),g=i(6742),v=i(3919),y=i(5537),I=function(t){return n.createElement("svg",(0,c.Z)({width:"20",height:"20",role:"img"},t),n.createElement("g",{fill:"#7a7a7a"},n.createElement("path",{d:"M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"}),n.createElement("path",{d:"M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"})))},w=i(4478),S=i(4973),b="sidebar_15mo",U="sidebarWithHideableNavbar_267A",N="sidebarHidden_2kNb",P="sidebarLogo_3h0W",E="menu_Bmed",D="menuLinkText_2aKo",A="menuWithAnnouncementBar_2WvA",T="collapseSidebarButton_1CGd",C="collapseSidebarButtonIcon_3E-R",M="sidebarMenuIcon_fgN0",x="sidebarMenuCloseIcon_1lpH",R="menuLinkExternal_1OhN",k=["items"],O=["item","onItemClick","collapsible","activePath"],L=["item","onItemClick","activePath","collapsible"];var _=function t(e,i){return"link"===e.type?(0,l.Mg)(e.href,i):"category"===e.type&&e.items.some((function(e){return t(e,i)}))},F=(0,n.memo)((function(t){var e=t.items,i=(0,u.Z)(t,k);return e.map((function(t,e){return n.createElement(j,(0,c.Z)({key:e,item:t},i))}))}));function j(t){switch(t.item.type){case"category":return n.createElement(B,t);case"link":default:return n.createElement(V,t)}}function B(t){var e,i,r,a=t.item,o=t.onItemClick,s=t.collapsible,l=t.activePath,p=(0,u.Z)(t,O),h=a.items,f=a.label,m=_(a,l),g=(i=m,r=(0,n.useRef)(i),(0,n.useEffect)((function(){r.current=i}),[i]),r.current),v=(0,n.useState)((function(){return!!s&&(!m&&a.collapsed)})),y=v[0],I=v[1],w=(0,n.useRef)(null),S=(0,n.useState)(void 0),b=S[0],U=S[1],N=function(t){var e;void 0===t&&(t=!0),U(t?(null==(e=w.current)?void 0:e.scrollHeight)+"px":void 0)};(0,n.useEffect)((function(){m&&!g&&y&&I(!1)}),[m,g,y]);var P=(0,n.useCallback)((function(t){t.preventDefault(),b||N(),setTimeout((function(){return I((function(t){return!t}))}),100)}),[b]);return 0===h.length?null:n.createElement("li",{className:(0,d.Z)("menu__list-item",{"menu__list-item--collapsed":y})},n.createElement("a",(0,c.Z)({className:(0,d.Z)("menu__link",(e={"menu__link--sublist":s,"menu__link--active":s&&m},e[D]=!s,e)),onClick:s?P:void 0,href:s?"#!":void 0},p),f),n.createElement("ul",{className:"menu__list",ref:w,style:{height:b},onTransitionEnd:function(){y||N(!1)}},n.createElement(F,{items:h,tabIndex:y?"-1":"0",onItemClick:o,collapsible:s,activePath:l})))}function V(t){var e,i=t.item,r=t.onItemClick,a=t.activePath,o=(t.collapsible,(0,u.Z)(t,L)),s=i.href,l=i.label,p=_(i,a);return n.createElement("li",{className:"menu__list-item",key:l},n.createElement(g.Z,(0,c.Z)({className:(0,d.Z)("menu__link",(e={"menu__link--active":p},e[R]=!(0,v.Z)(s),e)),to:s},(0,v.Z)(s)&&{isNavLink:!0,exact:!0,onClick:r},o),l))}function G(t){var e=t.onClick;return n.createElement("button",{type:"button",title:(0,S.I)({id:"theme.docs.sidebar.collapseButtonTitle",message:"Collapse sidebar",description:"The title attribute for collapse button of doc sidebar"}),"aria-label":(0,S.I)({id:"theme.docs.sidebar.collapseButtonAriaLabel",message:"Collapse sidebar",description:"The title attribute for collapse button of doc sidebar"}),className:(0,d.Z)("button button--secondary button--outline",T),onClick:e},n.createElement(I,{className:C}))}function H(t){var e=t.responsiveSidebarOpened,i=t.onClick;return n.createElement("button",{"aria-label":e?(0,S.I)({id:"theme.docs.sidebar.responsiveCloseButtonLabel",message:"Close menu",description:"The ARIA label for close button of mobile doc sidebar"}):(0,S.I)({id:"theme.docs.sidebar.responsiveOpenButtonLabel",message:"Open menu",description:"The ARIA label for open button of mobile doc sidebar"}),"aria-haspopup":"true",className:"button button--secondary button--sm menu__button",type:"button",onClick:i},e?n.createElement("span",{className:(0,d.Z)(M,x)},"\xd7"):n.createElement(w.Z,{className:M,height:24,width:24}))}var W=function(t){var e,i,r=t.path,a=t.sidebar,o=t.sidebarCollapsible,s=void 0===o||o,c=t.onCollapse,u=t.isHidden,g=function(){var t=(0,p.Z)().isAnnouncementBarClosed,e=(0,n.useState)(!t),i=e[0],r=e[1];return(0,m.Z)((function(e){var i=e.scrollY;t||r(0===i)})),i}(),v=(0,l.LU)(),I=v.navbar.hideOnScroll,w=v.hideableSidebar,S=(0,p.Z)().isAnnouncementBarClosed,D=function(){var t=(0,n.useState)(!1),e=t[0],i=t[1];(0,h.Z)(e);var r=(0,f.Z)();return(0,n.useEffect)((function(){r===f.D.desktop&&i(!1)}),[r]),{showResponsiveSidebar:e,closeResponsiveSidebar:(0,n.useCallback)((function(t){t.target.blur(),i(!1)}),[i]),toggleResponsiveSidebar:(0,n.useCallback)((function(){i((function(t){return!t}))}),[i])}}(),T=D.showResponsiveSidebar,C=D.closeResponsiveSidebar,M=D.toggleResponsiveSidebar;return n.createElement("div",{className:(0,d.Z)(b,(e={},e[U]=I,e[N]=u,e))},I&&n.createElement(y.Z,{tabIndex:-1,className:P}),n.createElement("div",{className:(0,d.Z)("menu","menu--responsive","thin-scrollbar",E,(i={"menu--show":T},i[A]=!S&&g,i))},n.createElement(H,{responsiveSidebarOpened:T,onClick:M}),n.createElement("ul",{className:"menu__list"},n.createElement(F,{items:a,onItemClick:C,collapsible:s,activePath:r}))),w&&n.createElement(G,{onClick:c}))},q=(i(5697),i(460)),z=i(7410),K={plain:{backgroundColor:"#2a2734",color:"#9a86fd"},styles:[{types:["comment","prolog","doctype","cdata","punctuation"],style:{color:"#6c6783"}},{types:["namespace"],style:{opacity:.7}},{types:["tag","operator","number"],style:{color:"#e09142"}},{types:["property","function"],style:{color:"#9a86fd"}},{types:["tag-id","selector","atrule-id"],style:{color:"#eeebff"}},{types:["attr-name"],style:{color:"#c4b9fe"}},{types:["boolean","string","entity","url","attr-value","keyword","control","directive","unit","statement","regex","at-rule","placeholder","variable"],style:{color:"#ffcc99"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"#c4b9fe"}}]},Y={Prism:z.Z,theme:K};function J(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function $(){return($=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}var Z=/\r\n|\r|\n/,X=function(t){0===t.length?t.push({types:["plain"],content:"\n",empty:!0}):1===t.length&&""===t[0].content&&(t[0].content="\n",t[0].empty=!0)},Q=function(t,e){var i=t.length;return i>0&&t[i-1]===e?t:t.concat(e)},tt=function(t,e){var i=t.plain,n=Object.create(null),r=t.styles.reduce((function(t,i){var n=i.languages,r=i.style;return n&&!n.includes(e)||i.types.forEach((function(e){var i=$({},t[e],r);t[e]=i})),t}),n);return r.root=i,r.plain=$({},i,{backgroundColor:null}),r};function et(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&-1===e.indexOf(n)&&(i[n]=t[n]);return i}var it=function(t){function e(){for(var e=this,i=[],n=arguments.length;n--;)i[n]=arguments[n];t.apply(this,i),J(this,"getThemeDict",(function(t){if(void 0!==e.themeDict&&t.theme===e.prevTheme&&t.language===e.prevLanguage)return e.themeDict;e.prevTheme=t.theme,e.prevLanguage=t.language;var i=t.theme?tt(t.theme,t.language):void 0;return e.themeDict=i})),J(this,"getLineProps",(function(t){var i=t.key,n=t.className,r=t.style,a=$({},et(t,["key","className","style","line"]),{className:"token-line",style:void 0,key:void 0}),o=e.getThemeDict(e.props);return void 0!==o&&(a.style=o.plain),void 0!==r&&(a.style=void 0!==a.style?$({},a.style,r):r),void 0!==i&&(a.key=i),n&&(a.className+=" "+n),a})),J(this,"getStyleForToken",(function(t){var i=t.types,n=t.empty,r=i.length,a=e.getThemeDict(e.props);if(void 0!==a){if(1===r&&"plain"===i[0])return n?{display:"inline-block"}:void 0;if(1===r&&!n)return a[i[0]];var o=n?{display:"inline-block"}:{},s=i.map((function(t){return a[t]}));return Object.assign.apply(Object,[o].concat(s))}})),J(this,"getTokenProps",(function(t){var i=t.key,n=t.className,r=t.style,a=t.token,o=$({},et(t,["key","className","style","token"]),{className:"token "+a.types.join(" "),children:a.content,style:e.getStyleForToken(a),key:void 0});return void 0!==r&&(o.style=void 0!==o.style?$({},o.style,r):r),void 0!==i&&(o.key=i),n&&(o.className+=" "+n),o})),J(this,"tokenize",(function(t,e,i,n){var r={code:e,grammar:i,language:n,tokens:[]};t.hooks.run("before-tokenize",r);var a=r.tokens=t.tokenize(r.code,r.grammar,r.language);return t.hooks.run("after-tokenize",r),a}))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.render=function(){var t=this.props,e=t.Prism,i=t.language,n=t.code,r=t.children,a=this.getThemeDict(this.props),o=e.languages[i];return r({tokens:function(t){for(var e=[[]],i=[t],n=[0],r=[t.length],a=0,o=0,s=[],c=[s];o>-1;){for(;(a=n[o]++)<r[o];){var u=void 0,d=e[o],l=i[o][a];if("string"==typeof l?(d=o>0?d:["plain"],u=l):(d=Q(d,l.type),l.alias&&(d=Q(d,l.alias)),u=l.content),"string"==typeof u){var p=u.split(Z),h=p.length;s.push({types:d,content:p[0]});for(var f=1;f<h;f++)X(s),c.push(s=[]),s.push({types:d,content:p[f]})}else o++,e.push(d),i.push(u),n.push(0),r.push(u.length)}o--,e.pop(),i.pop(),n.pop(),r.pop()}return X(s),c}(void 0!==o?this.tokenize(e,n,o,i):[n]),className:"prism-code language-"+i,style:void 0!==a?a.root:{},getLineProps:this.getLineProps,getTokenProps:this.getTokenProps})},e}(n.Component),nt=i(5420),rt=i(2817),at=i.n(rt),ot={plain:{color:"#C5C8C6",backgroundColor:"#1D1F21"},styles:[{types:["prolog","comment","doctype","cdata"],style:{color:"hsl(30, 20%, 50%)"}},{types:["property","tag","boolean","number","constant","symbol"],style:{color:"hsl(350, 40%, 70%)"}},{types:["attr-name","string","char","builtin","insterted"],style:{color:"hsl(75, 70%, 60%)"}},{types:["operator","entity","url","string","variable","language-css"],style:{color:"hsl(40, 90%, 60%)"}},{types:["deleted"],style:{color:"rgb(255, 85, 85)"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["regex","important"],style:{color:"#e90"}},{types:["atrule","attr-value","keyword"],style:{color:"hsl(350, 40%, 70%)"}},{types:["punctuation","symbol"],style:{opacity:"0.7"}}]},st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ct=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},ut=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},dt=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},lt=function(t,e){var i={};for(var n in t)e.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n]);return i},pt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},ht=function(t){function e(){var i,r;ct(this,e);for(var a=arguments.length,o=Array(a),s=0;s<a;s++)o[s]=arguments[s];return i=r=pt(this,t.call.apply(t,[this].concat(o))),r.state={code:""},r.updateContent=function(t){r.setState({code:t},(function(){r.props.onChange&&r.props.onChange(r.state.code)}))},r.highlightCode=function(t){return n.createElement(it,{Prism:z.Z,code:t,theme:r.props.theme||ot,language:r.props.language},(function(t){var e=t.tokens,i=t.getLineProps,r=t.getTokenProps;return n.createElement(n.Fragment,null,e.map((function(t,e){return n.createElement("div",i({line:t,key:e}),t.map((function(t,e){return n.createElement("span",r({token:t,key:e}))})))})))}))},pt(r,i)}return dt(e,t),e.getDerivedStateFromProps=function(t,e){return t.code!==e.prevCodeProp?{code:t.code,prevCodeProp:t.code}:null},e.prototype.render=function(){var t=this.props,e=t.style,i=(t.code,t.onChange,t.language,t.theme),r=lt(t,["style","code","onChange","language","theme"]),a=this.state.code,o=i&&"object"===st(i.plain)?i.plain:{};return n.createElement(q.Z,ut({value:a,padding:10,highlight:this.highlightCode,onValueChange:this.updateContent,style:ut({whiteSpace:"pre",fontFamily:"monospace"},o,e)},r))},e}(n.Component),ft=(0,n.createContext)({}),mt={assign:at()},gt={objectAssign:"_poly.assign",transforms:{dangerousForOf:!0,dangerousTaggedTemplateString:!0}},vt=function(t){return(0,nt.v)(t,gt).code},yt=function(t,e){return function(i){function r(){return ct(this,r),pt(this,i.apply(this,arguments))}return dt(r,i),r.prototype.componentDidCatch=function(t){e(t)},r.prototype.render=function(){return"function"==typeof t?n.createElement(t,null):t},r}(n.Component)},It=function(t,e){var i=Object.keys(e),r=i.map((function(t){return e[t]}));return(new(Function.prototype.bind.apply(Function,[null].concat(["_poly","React"],i,[t])))).apply(void 0,[mt,n].concat(r))},wt=function(t,e){var i=t.code,n=void 0===i?"":i,r=t.scope,a=void 0===r?{}:r,o=n.trim().replace(/;$/,""),s=vt("return ("+o+")").trim();return yt(It(s,a),e)},St=function(t,e,i){var n=t.code,r=void 0===n?"":n,a=t.scope,o=void 0===a?{}:a;if(!/render\s*\(/.test(r))return i(new SyntaxError("No-Inline evaluations must call `render`."));It(vt(r),ut({},o,{render:function(t){void 0===t?i(new SyntaxError("`render` must be called with valid JSX.")):e(yt(t,i))}}))},bt=function(t){function e(){var i,n;ct(this,e);for(var r=arguments.length,a=Array(r),o=0;o<r;o++)a[o]=arguments[o];return i=n=pt(this,t.call.apply(t,[this].concat(a))),n.onChange=function(t){var e=n.props,i=e.scope,r=e.transformCode,a=e.noInline;n.transpile({code:t,scope:i,transformCode:r,noInline:a})},n.onError=function(t){n.setState({error:t.toString()})},n.transpile=function(t){var e=t.code,i=t.scope,r=t.transformCode,a=t.noInline,o=void 0!==a&&a,s={code:r?r(e):e,scope:i},c=function(t){return n.setState({element:void 0,error:t.toString()})},u=function(t){return n.setState(ut({},d,{element:t}))},d={unsafeWrapperError:void 0,error:void 0};try{o?(n.setState(ut({},d,{element:null})),St(s,u,c)):u(wt(s,c))}catch(l){n.setState(ut({},d,{error:l.toString()}))}},pt(n,i)}return dt(e,t),e.prototype.UNSAFE_componentWillMount=function(){var t=this.props,e=t.code,i=t.scope,n=t.transformCode,r=t.noInline;this.transpile({code:e,scope:i,transformCode:n,noInline:r})},e.prototype.componentDidUpdate=function(t){var e=t.code,i=t.scope,n=t.noInline,r=t.transformCode,a=this.props,o=a.code,s=a.scope,c=a.noInline,u=a.transformCode;o===e&&s===i&&c===n&&u===r||this.transpile({code:o,scope:s,transformCode:u,noInline:c})},e.prototype.render=function(){var t=this.props,e=t.children,i=t.code,r=t.language,a=t.theme,o=t.disabled;return n.createElement(ft.Provider,{value:ut({},this.state,{code:i,language:r,theme:a,disabled:o,onError:this.onError,onChange:this.onChange})},e)},e}(n.Component);function Ut(t){return n.createElement(ft.Consumer,null,(function(e){var i=e.code,r=e.language,a=e.theme,o=e.disabled,s=e.onChange;return n.createElement(ht,ut({theme:a,code:i,language:r,disabled:o,onChange:s},t))}))}function Nt(t){return n.createElement(ft.Consumer,null,(function(e){var i=e.error;return i?n.createElement("pre",t,i):null}))}function Pt(t){var e=t.Component,i=lt(t,["Component"]);return n.createElement(e,i,n.createElement(ft.Consumer,null,(function(t){var e=t.element;return e&&n.createElement(e,null)})))}bt.defaultProps={code:"",noInline:!1,language:"jsx",disabled:!1},Pt.defaultProps={Component:"div"};var Et={plain:{color:"#bfc7d5",backgroundColor:"#292d3e"},styles:[{types:["comment"],style:{color:"rgb(105, 112, 152)",fontStyle:"italic"}},{types:["string","inserted"],style:{color:"rgb(195, 232, 141)"}},{types:["number"],style:{color:"rgb(247, 140, 108)"}},{types:["builtin","char","constant","function"],style:{color:"rgb(130, 170, 255)"}},{types:["punctuation","selector"],style:{color:"rgb(199, 146, 234)"}},{types:["variable"],style:{color:"rgb(191, 199, 213)"}},{types:["class-name","attr-name"],style:{color:"rgb(255, 203, 107)"}},{types:["tag","deleted"],style:{color:"rgb(255, 85, 114)"}},{types:["operator"],style:{color:"rgb(137, 221, 255)"}},{types:["boolean"],style:{color:"rgb(255, 88, 116)"}},{types:["keyword"],style:{fontStyle:"italic"}},{types:["doctype"],style:{color:"rgb(199, 146, 234)",fontStyle:"italic"}},{types:["namespace"],style:{color:"rgb(178, 204, 214)"}},{types:["url"],style:{color:"rgb(221, 221, 221)"}}]},Dt=i(5350),At=function(){var t=(0,l.LU)().prism,e=(0,Dt.Z)().isDarkTheme,i=t.theme||Et,n=t.darkTheme||i;return e?n:i},Tt="playgroundContainer_8J8b",Ct="playgroundHeader_1YWI",Mt="playgroundEditor_1LOQ",xt="playgroundPreview_3I2O",Rt=["children","transformCode"];function kt(t){var e=t.children;return n.createElement("div",{className:(0,d.Z)(Ct)},e)}function Ot(){return n.createElement(n.Fragment,null,n.createElement(kt,null,n.createElement(S.Z,{id:"theme.Playground.result",description:"The result label of the live codeblocks"},"Result")),n.createElement("div",{className:xt},n.createElement(Pt,null),n.createElement(Nt,null)))}function Lt(){return n.createElement(n.Fragment,null,n.createElement(kt,null,n.createElement(S.Z,{id:"theme.Playground.liveEditor",description:"The live editor label of the live codeblocks"},"Live Editor")),n.createElement(Ut,{className:Mt}))}function _t(t){var e=t.children,i=t.transformCode,r=(0,u.Z)(t,Rt),o=(0,a.Z)(),s=o.isClient,d=o.siteConfig.themeConfig.liveCodeBlock.playgroundPosition,l=At();return n.createElement("div",{className:Tt},n.createElement(bt,(0,c.Z)({key:s,code:s?e.replace(/\n$/,""):"",transformCode:i||function(t){return t+";"},theme:l},r),"top"===d?n.createElement(n.Fragment,null,n.createElement(Ot,null),n.createElement(Lt,null)):n.createElement(n.Fragment,null,n.createElement(Lt,null),n.createElement(Ot,null))))}var Ft=i(4982);var jt=i(7594),Bt=i.n(jt),Vt="codeBlockContainer_K1bP",Gt="codeBlockContent_hGly",Ht="codeBlockTitle_eoMF",Wt="codeBlock_23N8",qt="codeBlockWithTitle_2JqI",zt="copyButton_Ue-o",Kt="codeBlockLines_39YC",Yt=/{([\d,-]+)}/,Jt=function(t){void 0===t&&(t=["js","jsBlock","jsx","python","html"]);var e={js:{start:"\\/\\/",end:""},jsBlock:{start:"\\/\\*",end:"\\*\\/"},jsx:{start:"\\{\\s*\\/\\*",end:"\\*\\/\\s*\\}"},python:{start:"#",end:""},html:{start:"\x3c!--",end:"--\x3e"}},i=["highlight-next-line","highlight-start","highlight-end"].join("|"),n=t.map((function(t){return"(?:"+e[t].start+"\\s*("+i+")\\s*"+e[t].end+")"})).join("|");return new RegExp("^\\s*(?:"+n+")\\s*$")};var $t=function(t){return function(e){return e.live?n.createElement(_t,(0,c.Z)({scope:Ft.Z},e)):n.createElement(t,e)}}((function(t){var e=t.children,i=t.className,r=t.metastring,a=t.title,o=(0,l.LU)().prism,s=(0,n.useState)(!1),u=s[0],p=s[1],h=(0,n.useState)(!1),f=h[0],m=h[1];(0,n.useEffect)((function(){m(!0)}),[]);var g=(0,l.bc)(r)||a,v=(0,n.useRef)(null),y=[],I=At(),w=Array.isArray(e)?e.join(""):e;if(r&&Yt.test(r)){var b=r.match(Yt)[1];y=Bt()(b).filter((function(t){return t>0}))}var U=i&&i.replace(/language-/,"");!U&&o.defaultLanguage&&(U=o.defaultLanguage);var N=w.replace(/\n$/,"");if(0===y.length&&void 0!==U){for(var P,E="",D=function(t){switch(t){case"js":case"javascript":case"ts":case"typescript":return Jt(["js","jsBlock"]);case"jsx":case"tsx":return Jt(["js","jsBlock","jsx"]);case"html":return Jt(["js","jsBlock","html"]);case"python":case"py":return Jt(["python"]);default:return Jt()}}(U),A=w.replace(/\n$/,"").split("\n"),T=0;T<A.length;){var C=T+1,M=A[T].match(D);if(null!==M){switch(M.slice(1).reduce((function(t,e){return t||e}),void 0)){case"highlight-next-line":E+=C+",";break;case"highlight-start":P=C;break;case"highlight-end":E+=P+"-"+(C-1)+","}A.splice(T,1)}else T+=1}y=Bt()(E),N=A.join("\n")}var x=function(){!function(t,e){var i=(void 0===e?{}:e).target,n=void 0===i?document.body:i,r=document.createElement("textarea"),a=document.activeElement;r.value=t,r.setAttribute("readonly",""),r.style.contain="strict",r.style.position="absolute",r.style.left="-9999px",r.style.fontSize="12pt";var o=document.getSelection(),s=!1;o.rangeCount>0&&(s=o.getRangeAt(0)),n.append(r),r.select(),r.selectionStart=0,r.selectionEnd=t.length;var c=!1;try{c=document.execCommand("copy")}catch(u){}r.remove(),s&&(o.removeAllRanges(),o.addRange(s)),a&&a.focus()}(N),p(!0),setTimeout((function(){return p(!1)}),2e3)};return n.createElement(it,(0,c.Z)({},Y,{key:String(f),theme:I,code:N,language:U}),(function(t){var e,i=t.className,r=t.style,a=t.tokens,o=t.getLineProps,s=t.getTokenProps;return n.createElement("div",{className:Vt},g&&n.createElement("div",{style:r,className:Ht},g),n.createElement("div",{className:(0,d.Z)(Gt,U)},n.createElement("div",{tabIndex:0,className:(0,d.Z)(i,Wt,"thin-scrollbar",(e={},e[qt]=g,e))},n.createElement("div",{className:Kt,style:r},a.map((function(t,e){1===t.length&&""===t[0].content&&(t[0].content="\n");var i=o({line:t,key:e});return y.includes(e+1)&&(i.className=i.className+" docusaurus-highlight-code-line"),n.createElement("div",(0,c.Z)({key:e},i),t.map((function(t,e){return n.createElement("span",(0,c.Z)({key:e},s({token:t,key:e})))})))})))),n.createElement("button",{ref:v,type:"button","aria-label":(0,S.I)({id:"theme.CodeBlock.copyButtonAriaLabel",message:"Copy code to clipboard",description:"The ARIA label for copy code blocks button"}),className:(0,d.Z)(zt),onClick:x},u?n.createElement(S.Z,{id:"theme.CodeBlock.copied",description:"The copied button label on code blocks"},"Copied"):n.createElement(S.Z,{id:"theme.CodeBlock.copy",description:"The copy button label on code blocks"},"Copy"))))}))})),Zt="enhancedAnchor_2LWZ",Xt=["id"],Qt=function(t){return function(e){var i,r=e.id,a=(0,u.Z)(e,Xt),o=(0,l.LU)().navbar.hideOnScroll;return r?n.createElement(t,a,n.createElement("a",{"aria-hidden":"true",tabIndex:-1,className:(0,d.Z)("anchor",(i={},i[Zt]=!o,i)),id:r}),a.children,n.createElement("a",{className:"hash-link",href:"#"+r,title:(0,S.I)({id:"theme.common.headingLinkTitle",message:"Direct link to heading",description:"Title for link to heading"})},"#")):n.createElement(t,a)}},te={code:function(t){var e=t.children;return(0,n.isValidElement)(e)?e:e.includes("\n")?n.createElement($t,t):n.createElement("code",t)},a:function(t){return n.createElement(g.Z,t)},pre:function(t){var e,i=t.children;return(0,n.isValidElement)(null==i||null==(e=i.props)?void 0:e.children)?null==i?void 0:i.props.children:n.createElement($t,(0,n.isValidElement)(i)?null==i?void 0:i.props:{children:i})},h1:Qt("h1"),h2:Qt("h2"),h3:Qt("h3"),h4:Qt("h4"),h5:Qt("h5"),h6:Qt("h6")},ee=i(4608),ie=i(5977),ne="docPage_31aa",re="docMainContainer_3ufF",ae="docMainContainerEnhanced_3NYZ",oe="docSidebarContainer_3Kbt",se="docSidebarContainerHidden_3pA8",ce="collapsedDocSidebar_2JMH",ue="expandSidebarButtonIcon_1naQ",de="docItemWrapperEnhanced_2vyJ",le="docItemWrapper_3FMP";function pe(t){var e,i,o,c,u,p=t.currentDocRoute,h=t.versionMetadata,f=t.children,m=(0,a.Z)(),g=m.siteConfig,v=m.isClient,y=h.pluginId,w=h.permalinkToSidebar,b=h.docsSidebars,U=h.version,N=w[p.path],P=b[N],E=(0,n.useState)(!1),D=E[0],A=E[1],T=(0,n.useState)(!1),C=T[0],M=T[1],x=(0,n.useCallback)((function(){C&&M(!1),A(!D)}),[C]);return n.createElement(s.Z,{key:v,wrapperClassName:l.kM.wrapper.docPages,pageClassName:l.kM.page.docPage,searchMetadatas:{version:U,tag:(0,l.os)(y,U)}},n.createElement("div",{className:ne},P&&n.createElement("div",{className:(0,d.Z)(oe,(e={},e[se]=D,e)),onTransitionEnd:function(t){t.currentTarget.classList.contains(oe)&&D&&M(!0)},role:"complementary"},n.createElement(W,{key:N,sidebar:P,path:p.path,sidebarCollapsible:null==(i=null==(o=g.themeConfig)?void 0:o.sidebarCollapsible)||i,onCollapse:x,isHidden:C}),C&&n.createElement("div",{className:ce,title:(0,S.I)({id:"theme.docs.sidebar.expandButtonTitle",message:"Expand sidebar",description:"The ARIA label and title attribute for expand button of doc sidebar"}),"aria-label":(0,S.I)({id:"theme.docs.sidebar.expandButtonAriaLabel",message:"Expand sidebar",description:"The ARIA label and title attribute for expand button of doc sidebar"}),tabIndex:0,role:"button",onKeyDown:x,onClick:x},n.createElement(I,{className:ue}))),n.createElement("main",{className:(0,d.Z)(re,(c={},c[ae]=D||!P,c))},n.createElement("div",{className:(0,d.Z)("container padding-vert--lg",le,(u={},u[de]=D,u))},n.createElement(r.Zo,{components:te},f)))))}var he=function(t){var e=t.route.routes,i=t.versionMetadata,r=t.location,a=e.find((function(t){return(0,ie.LX)(r.pathname,t)}));return a?n.createElement(pe,{currentDocRoute:a,versionMetadata:i},(0,o.Z)(e)):n.createElement(ee.default,t)}},4608:function(t,e,i){"use strict";i.r(e);var n=i(7294),r=i(2611),a=i(4973);e.default=function(){return n.createElement(r.Z,{title:"Page Not Found"},n.createElement("main",{className:"container margin-vert--xl"},n.createElement("div",{className:"row"},n.createElement("div",{className:"col col--6 col--offset-3"},n.createElement("h1",{className:"hero__title"},n.createElement(a.Z,{id:"theme.NotFound.title",description:"The title of the 404 page"},"Page Not Found")),n.createElement("p",null,n.createElement(a.Z,{id:"theme.NotFound.p1",description:"The first paragraph of the 404 page"},"We could not find what you were looking for.")),n.createElement("p",null,n.createElement(a.Z,{id:"theme.NotFound.p2",description:"The 2nd paragraph of the 404 page"},"Please contact the owner of the site that linked you to the original URL and let them know their link is broken."))))))}},5420:function(t,e,i){var n=i(6591),r=n.transform;n.features,e.v=function(t,e){return r(t,Object.assign({},e,{transforms:{asyncAwait:!1}}))}},7594:function(t,e){function i(t){let e,i=[];for(let n of t.split(",").map((t=>t.trim())))if(/^-?\d+$/.test(n))i.push(parseInt(n,10));else if(e=n.match(/^(-?\d+)(-|\.\.\.?|\u2025|\u2026|\u22EF)(-?\d+)$/)){let[t,n,r,a]=e;if(n&&a){n=parseInt(n),a=parseInt(a);const t=n<a?1:-1;"-"!==r&&".."!==r&&"\u2025"!==r||(a+=t);for(let e=n;e!==a;e+=t)i.push(e)}}return i}e.default=i,t.exports=i},2817:function(t,e,i){i(9119),t.exports=i(8040).Object.assign},6773:function(t){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},5920:function(t,e,i){var n=i(3436);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},8652:function(t,e,i){var n=i(5721),r=i(1846),a=i(7584);t.exports=function(t){return function(e,i,o){var s,c=n(e),u=r(c.length),d=a(o,u);if(t&&i!=i){for(;u>d;)if((s=c[d++])!=s)return!0}else for(;u>d;d++)if((t||d in c)&&c[d]===i)return t||d||0;return!t&&-1}}},1813:function(t){var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},8040:function(t){var e=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=e)},2117:function(t,e,i){var n=i(6773);t.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}}},8299:function(t){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},7871:function(t,e,i){t.exports=!i(5287)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},6039:function(t,e,i){var n=i(3436),r=i(221).document,a=n(r)&&n(r.createElement);t.exports=function(t){return a?r.createElement(t):{}}},7305:function(t){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},3930:function(t,e,i){var n=i(221),r=i(8040),a=i(5235),o=i(4093),s=i(2117),c=function(t,e,i){var u,d,l,p,h=t&c.F,f=t&c.G,m=t&c.S,g=t&c.P,v=t&c.B,y=f?n:m?n[e]||(n[e]={}):(n[e]||{}).prototype,I=f?r:r[e]||(r[e]={}),w=I.prototype||(I.prototype={});for(u in f&&(i=e),i)l=((d=!h&&y&&void 0!==y[u])?y:i)[u],p=v&&d?s(l,n):g&&"function"==typeof l?s(Function.call,l):l,y&&o(y,u,l,t&c.U),I[u]!=l&&a(I,u,p),g&&w[u]!=l&&(w[u]=l)};n.core=r,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},5287:function(t){t.exports=function(t){try{return!!t()}catch(e){return!0}}},5118:function(t,e,i){t.exports=i(6695)("native-function-to-string",Function.toString)},221:function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},1014:function(t){var e={}.hasOwnProperty;t.exports=function(t,i){return e.call(t,i)}},5235:function(t,e,i){var n=i(2823),r=i(8613);t.exports=i(7871)?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},6804:function(t,e,i){t.exports=!i(7871)&&!i(5287)((function(){return 7!=Object.defineProperty(i(6039)("div"),"a",{get:function(){return 7}}).a}))},8618:function(t,e,i){var n=i(1813);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},3436:function(t){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},173:function(t){t.exports=!1},4254:function(t,e,i){"use strict";var n=i(7871),r=i(4453),a=i(5862),o=i(6466),s=i(572),c=i(8618),u=Object.assign;t.exports=!u||i(5287)((function(){var t={},e={},i=Symbol(),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach((function(t){e[t]=t})),7!=u({},t)[i]||Object.keys(u({},e)).join("")!=n}))?function(t,e){for(var i=s(t),u=arguments.length,d=1,l=a.f,p=o.f;u>d;)for(var h,f=c(arguments[d++]),m=l?r(f).concat(l(f)):r(f),g=m.length,v=0;g>v;)h=m[v++],n&&!p.call(f,h)||(i[h]=f[h]);return i}:u},2823:function(t,e,i){var n=i(5920),r=i(6804),a=i(8980),o=Object.defineProperty;e.f=i(7871)?Object.defineProperty:function(t,e,i){if(n(t),e=a(e,!0),n(i),r)try{return o(t,e,i)}catch(s){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},5862:function(t,e){e.f=Object.getOwnPropertySymbols},6528:function(t,e,i){var n=i(1014),r=i(5721),a=i(8652)(!1),o=i(7148)("IE_PROTO");t.exports=function(t,e){var i,s=r(t),c=0,u=[];for(i in s)i!=o&&n(s,i)&&u.push(i);for(;e.length>c;)n(s,i=e[c++])&&(~a(u,i)||u.push(i));return u}},4453:function(t,e,i){var n=i(6528),r=i(7305);t.exports=Object.keys||function(t){return n(t,r)}},6466:function(t,e){e.f={}.propertyIsEnumerable},8613:function(t){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},4093:function(t,e,i){var n=i(221),r=i(5235),a=i(1014),o=i(607)("src"),s=i(5118),c="toString",u=(""+s).split(c);i(8040).inspectSource=function(t){return s.call(t)},(t.exports=function(t,e,i,s){var c="function"==typeof i;c&&(a(i,"name")||r(i,"name",e)),t[e]!==i&&(c&&(a(i,o)||r(i,o,t[e]?""+t[e]:u.join(String(e)))),t===n?t[e]=i:s?t[e]?t[e]=i:r(t,e,i):(delete t[e],r(t,e,i)))})(Function.prototype,c,(function(){return"function"==typeof this&&this[o]||s.call(this)}))},7148:function(t,e,i){var n=i(6695)("keys"),r=i(607);t.exports=function(t){return n[t]||(n[t]=r(t))}},6695:function(t,e,i){var n=i(8040),r=i(221),a="__core-js_shared__",o=r[a]||(r[a]={});(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:n.version,mode:i(173)?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},7584:function(t,e,i){var n=i(7276),r=Math.max,a=Math.min;t.exports=function(t,e){return(t=n(t))<0?r(t+e,0):a(t,e)}},7276:function(t){var e=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:e)(t)}},5721:function(t,e,i){var n=i(8618),r=i(8299);t.exports=function(t){return n(r(t))}},1846:function(t,e,i){var n=i(7276),r=Math.min;t.exports=function(t){return t>0?r(n(t),9007199254740991):0}},572:function(t,e,i){var n=i(8299);t.exports=function(t){return Object(n(t))}},8980:function(t,e,i){var n=i(3436);t.exports=function(t,e){if(!n(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!n(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},607:function(t){var e=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+i).toString(36))}},9119:function(t,e,i){var n=i(3930);n(n.S+n.F,"Object",{assign:i(4254)})},460:function(t,e,i){"use strict";var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}(i(7294));function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var c=90,u=219,d=222,l=192,p=100,h=3e3,f="navigator"in i.g&&/Win/i.test(navigator.platform),m="navigator"in i.g&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),g="npm__react-simple-code-editor__textarea",v=function(t){function e(){var t,i,r;o(this,e);for(var a=arguments.length,g=Array(a),v=0;v<a;v++)g[v]=arguments[v];return i=r=s(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(g))),r.state={capture:!0},r._recordCurrentState=function(){var t=r._input;if(t){var e=t.value,i=t.selectionStart,n=t.selectionEnd;r._recordChange({value:e,selectionStart:i,selectionEnd:n})}},r._getLines=function(t,e){return t.substring(0,e).split("\n")},r._recordChange=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=r._history,a=i.stack,o=i.offset;if(a.length&&o>-1){r._history.stack=a.slice(0,o+1);var s=r._history.stack.length;if(s>p){var c=s-p;r._history.stack=a.slice(c,s),r._history.offset=Math.max(r._history.offset-c,0)}}var u=Date.now();if(e){var d=r._history.stack[r._history.offset];if(d&&u-d.timestamp<h){var l=/[^a-z0-9]([a-z0-9]+)$/i,f=r._getLines(d.value,d.selectionStart).pop().match(l),m=r._getLines(t.value,t.selectionStart).pop().match(l);if(f&&m&&m[1].startsWith(f[1]))return void(r._history.stack[r._history.offset]=n({},t,{timestamp:u}))}}r._history.stack.push(n({},t,{timestamp:u})),r._history.offset++},r._updateInput=function(t){var e=r._input;e&&(e.value=t.value,e.selectionStart=t.selectionStart,e.selectionEnd=t.selectionEnd,r.props.onValueChange(t.value))},r._applyEdits=function(t){var e=r._input,i=r._history.stack[r._history.offset];i&&e&&(r._history.stack[r._history.offset]=n({},i,{selectionStart:e.selectionStart,selectionEnd:e.selectionEnd})),r._recordChange(t),r._updateInput(t)},r._undoEdit=function(){var t=r._history,e=t.stack,i=t.offset,n=e[i-1];n&&(r._updateInput(n),r._history.offset=Math.max(i-1,0))},r._redoEdit=function(){var t=r._history,e=t.stack,i=t.offset,n=e[i+1];n&&(r._updateInput(n),r._history.offset=Math.min(i+1,e.length-1))},r._handleKeyDown=function(t){var e=r.props,i=e.tabSize,n=e.insertSpaces,a=e.ignoreTabKey,o=e.onKeyDown;if(!o||(o(t),!t.defaultPrevented)){27===t.keyCode&&t.target.blur();var s=t.target,p=s.value,h=s.selectionStart,g=s.selectionEnd,v=(n?" ":"\t").repeat(i);if(9===t.keyCode&&!a&&r.state.capture)if(t.preventDefault(),t.shiftKey){var y=r._getLines(p,h),I=y.length-1,w=r._getLines(p,g).length-1,S=p.split("\n").map((function(t,e){return e>=I&&e<=w&&t.startsWith(v)?t.substring(v.length):t})).join("\n");if(p!==S){var b=y[I];r._applyEdits({value:S,selectionStart:b.startsWith(v)?h-v.length:h,selectionEnd:g-(p.length-S.length)})}}else if(h!==g){var U=r._getLines(p,h),N=U.length-1,P=r._getLines(p,g).length-1,E=U[N];r._applyEdits({value:p.split("\n").map((function(t,e){return e>=N&&e<=P?v+t:t})).join("\n"),selectionStart:/\S/.test(E)?h+v.length:h,selectionEnd:g+v.length*(P-N+1)})}else{var D=h+v.length;r._applyEdits({value:p.substring(0,h)+v+p.substring(g),selectionStart:D,selectionEnd:D})}else if(8===t.keyCode){var A=h!==g;if(p.substring(0,h).endsWith(v)&&!A){t.preventDefault();var T=h-v.length;r._applyEdits({value:p.substring(0,h-v.length)+p.substring(g),selectionStart:T,selectionEnd:T})}}else if(13===t.keyCode){if(h===g){var C=r._getLines(p,h).pop().match(/^\s+/);if(C&&C[0]){t.preventDefault();var M="\n"+C[0],x=h+M.length;r._applyEdits({value:p.substring(0,h)+M+p.substring(g),selectionStart:x,selectionEnd:x})}}}else if(57===t.keyCode||t.keyCode===u||t.keyCode===d||t.keyCode===l){var R=void 0;57===t.keyCode&&t.shiftKey?R=["(",")"]:t.keyCode===u?R=t.shiftKey?["{","}"]:["[","]"]:t.keyCode===d?R=t.shiftKey?['"','"']:["'","'"]:t.keyCode!==l||t.shiftKey||(R=["`","`"]),h!==g&&R&&(t.preventDefault(),r._applyEdits({value:p.substring(0,h)+R[0]+p.substring(h,g)+R[1]+p.substring(g),selectionStart:h,selectionEnd:g+2}))}else!(m?t.metaKey&&t.keyCode===c:t.ctrlKey&&t.keyCode===c)||t.shiftKey||t.altKey?(m?t.metaKey&&t.keyCode===c&&t.shiftKey:f?t.ctrlKey&&89===t.keyCode:t.ctrlKey&&t.keyCode===c&&t.shiftKey)&&!t.altKey?(t.preventDefault(),r._redoEdit()):77!==t.keyCode||!t.ctrlKey||m&&!t.shiftKey||(t.preventDefault(),r.setState((function(t){return{capture:!t.capture}}))):(t.preventDefault(),r._undoEdit())}},r._handleChange=function(t){var e=t.target,i=e.value,n=e.selectionStart,a=e.selectionEnd;r._recordChange({value:i,selectionStart:n,selectionEnd:a},!0),r.props.onValueChange(i)},r._history={stack:[],offset:-1},s(r,i)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),r(e,[{key:"componentDidMount",value:function(){this._recordCurrentState()}},{key:"render",value:function(){var t=this,e=this.props,i=e.value,r=e.style,o=e.padding,s=e.highlight,c=e.textareaId,u=e.autoFocus,d=e.disabled,l=e.form,p=e.maxLength,h=e.minLength,f=e.name,m=e.placeholder,v=e.readOnly,I=e.required,w=e.onClick,S=e.onFocus,b=e.onBlur,U=e.onKeyUp,N=(e.onKeyDown,e.onValueChange,e.tabSize,e.insertSpaces,e.ignoreTabKey,function(t,e){var i={};for(var n in t)e.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n]);return i}(e,["value","style","padding","highlight","textareaId","autoFocus","disabled","form","maxLength","minLength","name","placeholder","readOnly","required","onClick","onFocus","onBlur","onKeyUp","onKeyDown","onValueChange","tabSize","insertSpaces","ignoreTabKey"])),P={paddingTop:o,paddingRight:o,paddingBottom:o,paddingLeft:o},E=s(i);return a.createElement("div",n({},N,{style:n({},y.container,r)}),a.createElement("textarea",{ref:function(e){return t._input=e},style:n({},y.editor,y.textarea,P),className:g,id:c,value:i,onChange:this._handleChange,onKeyDown:this._handleKeyDown,onClick:w,onKeyUp:U,onFocus:S,onBlur:b,disabled:d,form:l,maxLength:p,minLength:h,name:f,placeholder:m,readOnly:v,required:I,autoFocus:u,autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"data-gramm":!1}),a.createElement("pre",n({"aria-hidden":"true",style:n({},y.editor,y.highlight,P)},"string"==typeof E?{dangerouslySetInnerHTML:{__html:E+"<br />"}}:{children:E})),a.createElement("style",{type:"text/css",dangerouslySetInnerHTML:{__html:"\n/**\n * Reset the text fill color so that placeholder is visible\n */\n.npm__react-simple-code-editor__textarea:empty {\n  -webkit-text-fill-color: inherit !important;\n}\n\n/**\n * Hack to apply on some CSS on IE10 and IE11\n */\n@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {\n  /**\n    * IE doesn't support '-webkit-text-fill-color'\n    * So we use 'color: transparent' to make the text transparent on IE\n    * Unlike other browsers, it doesn't affect caret color in IE\n    */\n  .npm__react-simple-code-editor__textarea {\n    color: transparent !important;\n  }\n\n  .npm__react-simple-code-editor__textarea::selection {\n    background-color: #accef7 !important;\n    color: transparent !important;\n  }\n}\n"}}))}},{key:"session",get:function(){return{history:this._history}},set:function(t){this._history=t.history}}]),e}(a.Component);v.defaultProps={tabSize:2,insertSpaces:!0,ignoreTabKey:!1,padding:0},e.Z=v;var y={container:{position:"relative",textAlign:"left",boxSizing:"border-box",padding:0,overflow:"hidden"},textarea:{position:"absolute",top:0,left:0,height:"100%",width:"100%",resize:"none",color:"inherit",overflow:"hidden",MozOsxFontSmoothing:"grayscale",WebkitFontSmoothing:"antialiased",WebkitTextFillColor:"transparent"},highlight:{position:"relative",pointerEvents:"none"},editor:{margin:0,border:0,background:"none",boxSizing:"inherit",display:"inherit",fontFamily:"inherit",fontSize:"inherit",fontStyle:"inherit",fontVariantLigatures:"inherit",fontWeight:"inherit",letterSpacing:"inherit",lineHeight:"inherit",tabSize:"inherit",textIndent:"inherit",textRendering:"inherit",textTransform:"inherit",whiteSpace:"pre-wrap",wordBreak:"keep-all",overflowWrap:"break-word"}}},5753:function(t,e,i){"use strict";i.d(e,{aX:function(){return $h},y1:function(){return yv},SX:function(){return _v},QO:function(){return Lv},_3:function(){return Ro},M6:function(){return av},hC:function(){return Fv}});const n="SET",r="NOAD",a={S:"normal",F:"final"};function o(t,e){if(t&&"object"==typeof t){if(t.timed&&!isNaN(t.minutes))return c(t);if(t.bestOf&&t.setFormat)return function(t,e){const i=s(t.bestOf),n=i&&`SET${i}`||"",r=u(t.setFormat,e),a=r&&`S:${r}`||"",o=u(t.finalSetFormat,e),c=i>1&&o&&!o.invalid&&r!==o&&`F:${o}`||"";if(n&&r&&!r.invalid&&(!o||!o.invalid))return[n,a,c].filter((t=>t)).join("-")}(t,e)}}function s(t){return!isNaN(Number(t))&&Number(t)}function c(t){return`T${t.minutes}`}function u(t,e){if(t&&"object"==typeof t){if(t.timed)return c(t);if(t.tiebreakSet)return d(t.tiebreakSet);const i=s(t.setTo);if(i){const n=t.NoAD?r:"",a=d(t.tiebreakFormat),o=a&&!a.invalid&&`/${a}`||"",c=s(t.tiebreakAt),u=c&&(c!==i||e)&&`@${c}`||"";return!a||!a.invalid?`${i}${n}${o}${u}`:{invalid:!0}}return{invalid:!0}}}function d(t){if(t)return"object"!=typeof t||t.tiebreakTo?"object"==typeof t&&s(t.tiebreakTo)?`TB${t.tiebreakTo}${t.NoAD?r:""}`:{invalid:!0}:""}function l(t){if(t&&"string"==typeof t){const e=0===t.indexOf("T")?"timed":0===t.indexOf(n)?n:"";if("timed"===e){const e={bestOf:1,setFormat:f(t)};if(e.setFormat)return e}if(e===n)return function(t){const e=t.split("-"),i=g(e[0].slice(3)),n=e&&p(e[1]),r=e&&p(e[2]),a=i&&i<6,o=!e[2]||r&&!r.invalid,s=n&&!n.invalid,c={bestOf:i,setFormat:n};r&&(c.finalSetFormat=r);if(a&&s&&o)return c}(t)}}function p(t){if(t&&":"===t[1]){const e=t.split(":"),i=a[e[0]],n=e[1];if(i&&n){if(0===n.indexOf("TB"))return{tiebreakSet:h(n)};if(0===n.indexOf("T")){return f(n)}const e=t.match(/^[FS]{1}:(\d+)([A-Za-z]*)/),i=e&&m(e[2])||!1,r=!e||!e[2]||i,a=e&&g(e[1]),o=function(t){const e=t&&t.indexOf("@")>0&&t.split("@");if(e){return g(e[1])||{invalid:!0}}}(n),s=!o||o&&!o.invalid,c=s&&o||a,u=h(n.split("/")[1]),d=!u||!u.invalid,l={setTo:a};return i&&(l.NoAD=!0),u?(l.tiebreakFormat=u,l.tiebreakAt=c):l.noTiebreak=!0,a&&r&&d&&s&&l||{invalid:!0}}}}function h(t){if(t){if(0===t.indexOf("TB")){const e=t.match(/^TB(\d+)([A-Za-z]*)/),i=e&&e[1],n=e&&m(e[2]),r=!e||!e[2]||n,a=g(i);if(a&&r){const t={tiebreakTo:a};return n&&(t.NoAD=!0),t}return{invalid:!0}}return{invalid:!0}}}function f(t){const e=g(t.slice(1));if(e)return{timed:!0,minutes:e}}function m(t){return t&&t.indexOf(r)>=0}function g(t){return!isNaN(Number(t))&&Number(t)}function v(t){var e;if("string"!=typeof t)return!1;const i=l(t);if(null!=i&&null!==(e=i.setFormat)&&void 0!==e&&e.timed&&1===(null==i?void 0:i.bestOf)&&t.indexOf("SET1-S:")<1&&0===t.indexOf("T"))return o(i).slice(7)===t;const n=t.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),r=null==n?void 0:n[0],a=null==n?void 0:n[2],s=t.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),c=null==s?void 0:s[0],u=null==s?void 0:s[2];return o(i,n&&r===a||s&&c===u)===t}const y="SET3-S:6/TB7",I="ABANDONED",w="AWAITING_RESULT",S="BYE",b="CANCELLED",U="COMPLETED",N="DEAD_RUBBER",P="DEFAULTED",E="DOUBLE_WALKOVER",D="IN_PROGRESS",A="INCOMPLETE",T="NOT_PLAYED",C="RETIRED",M="SUSPENDED",x="TO_BE_PLAYED",R="WALKOVER",k=[w,U,P,E,D,A,C,M,R],O=[I,w,S,b,U,N,P,E,D,A,T,C,M,x,R],L=[S,U,P,E,C,R],_=[I,w,b,N,D,A,T,M,x,void 0],F=[b,I,U,N,P,E,C,R],j=[I,U,P,E,D,C,R],B=[D,A,M,x],V={ABANDONED:I,AWAITING_RESULT:w,BYE:S,CANCELLED:b,COMPLETED:U,DEAD_RUBBER:N,DEFAULTED:P,DOUBLE_WALKOVER:E,IN_PROGRESS:D,INCOMPLETE:A,NOT_PLAYED:T,RETIRED:C,SUSPENDED:M,TO_BE_PLAYED:x,WALKOVER:R};function G({winningSide:t,matchUpFormat:e=y,matchUpStatus:i,tallyPolicy:n,score:r}){const a=[0,0],{sets:o}=r||{},s=t-1,c=l(e),u=H((null==c?void 0:c.bestOf)||1);return i===P&&null!=n&&n.setsCreditForDefaults||i===R&&null!=n&&n.setsCreditForWalkovers?a[s]=u:o&&o.forEach((t=>{const{winningSide:e}=t;e&&(a[e-1]+=1)})),i===C&&(+a[1-s]===u&&(a[1-s]-=1),a[s]=u),a}function H(t){return t&&Math.ceil(t/2)||1}function W(t){return!isNaN(t)&&(t&&0==(t&t-1))}function q(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function z(t){return!isNaN(parseFloat(t))}function K(t){if(isNaN(t))return!1;for(;!W(t);)t++;return t}function Y(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function J(t){return Number.isSafeInteger("string"==typeof t?+t:t)}function $(t){if(null===t)return{};const{source:e,template:i}=t||{},n={};return function t(e,i,n){if(!e||!i)return;const r=Object.keys(e),a=Object.keys(i);for(let o=0;o<r.length;o++)if(a.indexOf(r[o])>=0){const a=i[r[o]],s=e[r[o]];a&&"object"==typeof a&&"function"!=typeof s?Array.isArray(s)?n[r[o]]=s.map((e=>{const i={};return t(e,a,i),i})):s&&(n[r[o]]={},t(s,a,n[r[o]])):i[r[o]]&&(n[r[o]]=e[r[o]])}}(e,i,n),n}function Z(t=0){const e=new Date;e.setHours(e.getHours()+t);return e.getTime().toString(36).slice(-6).toUpperCase()}function X(t){return t.filter(((t,e,i)=>i.lastIndexOf(t)===e))}function Q(t){return t.map((t=>[Math.random(),t])).sort(((t,e)=>t[0]-e[0])).map((t=>t[1]))}function tt(t){return t.reduce(((t,e)=>(t[e]||(t[e]=0),t[e]++,t)),{})}function et(t,e,i){return i.indexOf(t)===e}function it(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function nt(t){return t[Math.floor(Math.random()*t.length)]}function rt(t,e){return Array.from({length:e-t},((e,i)=>i+t))}function at(t,e){return e.reduce(((e,i,n)=>(i===t&&e.push(n),e)),[])}function ot(t,e){return Array.isArray(t)&&Array.isArray(e)?t.filter((t=>-1!==e.indexOf(t))).filter(((t,e,i)=>i.indexOf(t)===e)):0}function st(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.some((t=>e.includes(t)))}function ct(t,e){return t.reduce(((t,i,n)=>{const r=Math.floor(n/e);return t[r]=[].concat(t[r]||[],i),t}),[])}function ut(t,e,i){return t.reduce(((t,n,r)=>{const a=!!i&&!!(Math.floor(r/e)%2),o=r%e,s=a?e-1-o:o;return t[s]||(t[s]=[]),t[s].push(n),t}),[])}const dt={success:!0},lt={SUCCESS:dt,ERROR:"error"},pt="records must be an object with tournamentId keys",ht="Missing tournamentRecords",ft="Missing tournamentRecord",mt="Invalid tournamentRecord",gt="Missing tournamentId",vt="Invalid drawDefinition",yt="Missing drawDefinition",It="Existing drawDefinition(s)",wt="drawDefinition not found",St="Invalid structure",bt="Invalid drawPosition for seedAssignment",Ut="drawPosition already assigned",Nt="drawPosition not cleared",Pt="Unrecognized drawType",Et="Missing drawPositions",Dt="drawPosition is active",At="Invlid drawPosition",Tt="Missing drawPosition",Ct="Invalid drawSize",Mt="Missing drawSize",xt="Missing drawId",Rt="drawId exists",kt="seedsCount greater than drawSize",Ot="Missing seedCountThresholds",Lt="Missing seedAssignments",_t="Invalid seedNumber",Ft="Invalid seedPosition",jt="Missing targetLink",Bt="Existing round",Vt="Missing structureId",Gt="structure not found",Ht="Missing structures",Wt="Missing structure",qt="Invalie eventType",zt="Missing event / eventId",Kt="Event not found",Yt="Event exists",Jt="Missing entries",$t="Invalid entries",Zt="Missing assignments",Xt="Missing stage",Qt="Invalid stage",te="stageSequence limit",ee="Missing positionAssignments",ie="Unrecognized matchUpStatus",ne="Unrecognized matchUpFormat",re="Incompatible matchUpStatus",ae="Invalid matchUpStatus",oe="Invalid tieFormat",se="Invalid matchUpFormat",ce="Missing matchUpFormat",ue="Missing collectionDefinition",de="Missing tieFormat",le="Missing matchUpId",pe="Missing matchUpIds",he="matchUp not found",fe="Missing matchUps",me="Missing matchUp",ge="Invalid matchUp",ve="Missing policyType",ye="Missing policyDefinitions",Ie="Missing avoidance policy",we="Missing policy attributes",Se="Invalid policyDefinitions",be="existing policyType",Ue="Policy not attached",Ne="Policy not found",Pe="Missing scoring policy / matchUpFormats",Ee="Missing setObject",De="Missing courtId",Ae="Missing value",Te="Missing date",Ce="No valid dates",Me="Invalid bookings",xe="Invalid dateAvailability",Re="Missing dateAvailability",ke="Invalid Date",Oe="Invalid time",Le="Invalid tournament dates",_e="Invalid game scores",Fe="Invalid winningSide",je="Cannot remove participants",Be="Cannot change winningSide",Ve="Invalid participant",Ge="Invalid participantId",He="Invalid participantIds",We="Invalid participantType",qe="Missing participantRole",ze="Missing participant",Ke="Missing participants",Ye="Missing participantId",Je="Participant Not Found",$e="participantId exists",Ze="No participant removed",Xe="Missing participantIds",Qe="Missing participantCount",ti="Participant not checked in",ei="Participant already checked in",ii="Participant has assigned drawPosition",ni="Missing person details",ri="Existing participant drawPosition assignment",ai="Existing participant",oi="participantCount exceeds drawSize",si="More Participants than Draw Positions",ci="Invalid entry status",ui="Participant Entry Not Found",di="entryStatus not allowed in stage",li="entryStatus not allowed for event",pi="No stage space available for entryStatus",hi="Missing penaltyType",fi="Missing penaltyId",mi="Penalty not found",gi="Missing courtsCount/courtNames",vi="Court not found",yi="Court exists",Ii="Venue exists",wi="Venue not found",Si="Missing venueId",bi="Invalid endTime",Ui="Existing endTime",Ni="Invalid stopTime",Pi="Invalid startTime",Ei="Invalid timeItem",Di="Missing timeItem",Ai="Missing timeItems",Ti="Missing context",Ci="Missing schedule",Mi="Invalid scaleItem",xi="No scaleItem found",Ri="Modifications failed",ki="No modifications applied",Oi="Invalid configuration",Li="Invalid object",_i="Invalid values",Fi="Team not found",ji="No valid actions",Bi="No valid attributes",Vi="Value unchanged",Gi="Not found",Hi="Not implemented",Wi="Existing flight",qi="Existing profile",zi="Existing outcome",Ki="Method not found",Yi={CANNOT_CHANGE_WINNINGSIDE:Be,CANNOT_REMOVE_PARTICIPANTS:je,COURT_EXISTS:yi,COURT_NOT_FOUND:vi,DRAW_DEFINITION_NOT_FOUND:wt,DRAW_ID_EXISTS:Rt,DRAW_POSITION_ACTIVE:Dt,DRAW_POSITION_ASSIGNED:Ut,DRAW_POSITION_NOT_CLEARED:Nt,DRAW_POSITION_NOT_FOUND:"drawPosition not found",ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:li,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:di,EVENT_EXISTS:Yt,EVENT_NOT_FOUND:Kt,EXISTING_DRAW_DEFINITIONS:It,EXISTING_END_TIME:Ui,EXISTING_FLIGHT:Wi,EXISTING_OUTCOME:zi,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:ri,EXISTING_PARTICIPANT:ai,EXISTING_POLICY_TYPE:be,EXISTING_PROFILE:qi,EXISTING_ROUND:Bt,INCOMPATIBLE_MATCHUP_STATUS:re,INVALID_BOOKINGS:Me,INVALID_CONFIGURATION:Oi,INVALID_DATE_AVAILABILITY:xe,INVALID_DATE:ke,INVALID_DRAW_DEFINITION:vt,INVALID_DRAW_POSITION_FOR_SEEDING:bt,INVALID_DRAW_POSITION:At,INVALID_DRAW_SIZE:Ct,INVALID_END_TIME:bi,INVALID_ENTRIES:$t,INVALID_EVENT_TYPE:qt,INVALID_GAME_SCORES:_e,INVALID_MATCHUP_FORMAT:se,INVALID_MATCHUP_STATUS:ae,INVALID_MATCHUP:ge,INVALID_OBJECT:Li,INVALID_PARTICIPANT_ID:Ge,INVALID_PARTICIPANT_IDS:He,INVALID_PARTICIPANT_TYPE:We,INVALID_PARTICIPANT:Ve,INVALID_POLICY_DEFINITION:Se,INVALID_RECORDS:pt,INVALID_SCALE_ITEM:Mi,INVALID_SEED_NUMBER:_t,INVALID_SEED_POSITION:Ft,INVALID_SET_NUMBER:"Invalid setNumber",INVALID_SIDE_NUMBER:"Invalid sideNumber",INVALID_STAGE:Qt,INVALID_START_TIME:Pi,INVALID_STRUCTURE:St,INVALID_STOP_TIME:Ni,INVALID_TIE_FORMAT:oe,INVALID_TIME:Oe,INVALID_TIME_ITEM:Ei,INVALID_TOURNAMENT_DATES:Le,INVALID_TOURNAMENT_RECORD:mt,INVALID_VALUES:_i,INVALID_WINNING_SIDE:Fe,MATCHUP_NOT_FOUND:he,METHOD_NOT_FOUND:Ki,MISSING_ASSIGNMENTS:Zt,MISSING_AVOIDANCE_POLICY:Ie,MISSING_COLLECTION_DEFINITION:ue,MISSING_COURT_ID:De,MISSING_COURTS_INFO:gi,MISSING_DATE_AVAILABILITY:Re,MISSING_DATE:Te,MISSING_DRAW_DEFINITION:yt,MISSING_DRAW_ID:xt,MISSING_DRAW_POSITION:Tt,MISSING_DRAW_POSITIONS:Et,MISSING_DRAW_SIZE:Mt,MISSING_ENTRIES:Jt,MISSING_EVENT:zt,MISSING_MATCHUP_FORMAT:ce,MISSING_MATCHUP_ID:le,MISSING_MATCHUP_IDS:pe,MISSING_MATCHUP:me,MISSING_MATCHUPS:fe,MISSING_PARTICIPANT_COUNT:Qe,MISSING_PARTICIPANT_ID:Ye,MISSING_PARTICIPANT_IDS:Xe,MISSING_PARTICIPANT_ROLE:qe,MISSING_PARTICIPANT:ze,MISSING_PARTICIPANTS:Ke,MISSING_PENALTY_ID:fi,MISSING_PENALTY_TYPE:hi,MISSING_PERSON_DETAILS:ni,MISSING_POLICY_ATTRIBUTES:we,MISSING_POLICY_DEFINITION:ye,MISSING_POLICY_TYPE:ve,MISSING_POSITION_ASSIGNMENTS:ee,MISSING_ROUND_NUMBER:"Missing roundNumber",MISSING_SCHEDULE:Ci,MISSING_SCORING_POLICY:Pe,MISSING_SEED_ASSIGNMENTS:Lt,MISSING_SEED_BLOCKS:"Missing seedBlocks",MISSING_SEEDCOUNT_THRESHOLDS:Ot,MISSING_SEEDING_POLICY:"Missing seeding policy",MISSING_SET_NUMBER:"Missing setNumber",MISSING_SET_OBJECT:Ee,MISSING_SIDE_NUMBER:"Missing sideNumber",MISSING_STAGE:Xt,MISSING_STRUCTURE_ID:Vt,MISSING_STRUCTURE:Wt,MISSING_STRUCTURES:Ht,MISSING_TARGET_LINK:jt,MISSING_TIE_FORMAT:de,MISSING_TIME_ITEM:Di,MISSING_TIME_ITEMS:Ai,MISSING_TOURNAMENT_ID:gt,MISSING_TOURNAMENT_RECORD:ft,MISSING_TOURNAMENT_RECORDS:ht,MISSING_VALUE:Ae,MISSING_VENUE_ID:Si,MODIFICATIONS_FAILED:Ri,MORE_PARTICIPANTS_THAN_DRAW_POSITIONS:si,NO_MODIFICATIONS_APPLIED:ki,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:pi,NO_PARTICIPANT_REMOVED:Ze,NO_VALID_ACTIONS:ji,NO_VALID_ATTRIBUTES:Bi,NO_VALID_DATES:Ce,NOT_FOUND:Gi,NOT_IMPLEMENTED:Hi,PARTICIPANT_ASSIGNED_DRAW_POSITION:ii,PARTICIPANT_ALREADY_CHECKED_IN:ei,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:oi,PARTICIPANT_ID_EXISTS:$e,PARTICIPANT_NOT_CHECKED_IN:ti,PARTICIPANT_NOT_FOUND:Je,PARTICIPANT_PAIR_EXISTS:"participant pair exists",PENALTY_NOT_FOUND:mi,POLICY_NOT_ATTACHED:Ue,POLICY_NOT_FOUND:Ne,SCALE_ITEM_NOT_FOUND:xi,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:kt,STAGE_SEQUENCE_LIMIT:te,STRUCTURE_NOT_FOUND:Gt,TEAM_NOT_FOUND:Fi,UNRECOGNIZED_DRAW_TYPE:Pt,UNRECOGNIZED_MATCHUP_FORMAT:ne,UNRECOGNIZED_MATCHUP_STATUS:ie,VALUE_UNCHANGED:Vi,VENUE_EXISTS:Ii},Ji={tournamentId:void 0,tournamentRecords:{},subscriptions:{},notices:[]};const $i={devContext:void 0,timers:{default:{elapsedTime:0}},deepCopy:!0,deepCopyAttributes:{ignore:[],toJSON:[],stringify:[]}};let Zi={setSubscriptions:function({subscriptions:t={}}={}){return"object"!=typeof t?{error:_i}:(Object.keys(t).forEach((e=>{Ji.subscriptions[e]=t[e]})),{...dt})},addNotice:function({topic:t,payload:e,key:i}){if("string"!=typeof t||"object"!=typeof e)return;if(!Ji.subscriptions[t])return;i&&(Ji.notices=Ji.notices.filter((e=>!(e.topic===t&&e.key===i))));Ji.notices.push({topic:t,payload:e,key:i})},getNotices:function({topic:t}){const e=Ji.notices.filter((e=>e.topic===t)).map((t=>t.payload));return e.length&&e},deleteNotices:function(){Ji.notices=[]},getTopics:function(){return{topics:Object.keys(Ji.subscriptions)}},callListener:function({topic:t,notices:e}){const i=Ji.subscriptions[t];i&&"function"==typeof i&&i(e)},getTournamentId:function(){return Ji.tournamentId},getTournamentRecord:function(t){return Ji.tournamentRecords[t]},getTournamentRecords:function(){return Ji.tournamentRecords},setTournamentId:function(t){return Ji.tournamentRecords[t]?(Ji.tournamentId=t,{success:!0}):{error:ft}},setTournamentRecord:function(t){const e=null==t?void 0:t.tournamentId;return e?(Ji.tournamentRecords[e]=t,{success:!0}):{error:mt}},setTournamentRecords:function(t){Ji.tournamentRecords=t;const e=Object.keys(t);1===e.length?Ji.tournamentId=e[0]:e.length||(Ji.tournamentId=void 0)},removeTournamentRecord:function(t){if("string"!=typeof t)return{error:_i};if(!Ji.tournamentRecords[t])return{error:Gi};delete Ji.tournamentRecords[t];const e=Object.keys(Ji.tournamentRecords);1===e.length?Ji.tournamentId=e[0]:e.length||(Ji.tournamentId=void 0);return{success:!0}}};function Xi(t){return t&&"object"==typeof t?"object"==typeof $i.devContext&&Object.keys(t).every((e=>$i.devContext[e]===t[e])):$i.devContext||!1}function Qi(t){$i.devContext=t}function tn(t,e){"boolean"==typeof t&&($i.deepCopy=t),"object"==typeof e&&(Array.isArray(e.ignore)&&($i.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&($i.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&($i.deepCopyAttributes.stringify=e.stringify))}function en(t){return Zi.addNotice(t)}function nn(t){return Zi.getNotices(t)}function rn(){return Zi.deleteNotices()}function an(){return Zi.getTopics()}async function on(t){return Zi.callListener(t)}function sn(){return Zi.getTournamentId()}function cn(t){return Zi.getTournamentRecord(t)}function un(){return Zi.getTournamentRecords()}function dn(t){return Zi.setTournamentRecord(t)}function ln(t){return Zi.setTournamentRecords(t)}function pn(t){return Zi.setTournamentId(t)}function hn(t){return Zi.removeTournamentRecord(t)}const fn=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,mn=/^((0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)([.,][0-9]{3})?$/,gn=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))([ T](0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/,vn=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))?([ T]?(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/;function yn(t){if("object"!=typeof t||Array.isArray(t))return!1;return"[object Date]"===Object.prototype.toString.call(t)}function In(t){return En(t)||fn.test(t)}const wn=t=>{const e=Un(t)||En(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Fn(n)}-${Fn(e.getUTCDate())}`};function Sn(t,e="-",i="YMD"){if(!t)return"";"string"==typeof t&&t.indexOf("T")<0&&(t+="T00:00");const n=new Date(t);let r=""+(n.getMonth()+1),a=""+n.getDate();const o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),"DMY"===i?[a,r,o].join(e):"MDY"===i?[r,a,o].join(e):"YDM"===i?[o,a,r].join(e):"DYM"===i?[a,o,r].join(e):"MYD"===i?[r,o,a].join(e):[o,r,a].join(e)}function bn(t){const e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-60*i*1e3)}function Un(t){if("boolean"==typeof t)return!1;const e=t instanceof Date?t:!isNaN(t)&&new Date(t);return e&&!isNaN(e.valueOf())}function Nn(t,e){const i=new Date(t),n=new Date(e);var r,a;const o=[];let s=0;if(!!(Un(n)&&Un(i)&&(r=i,a=n,bn(r)<=bn(a)))){const t=bn(i),e=bn(n);for(;t<=e&&s<300;)s+=1,o.push(new Date(t)),t.setDate(t.getDate()+1)}return o}const Pn=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function En(t){return"string"==typeof t&&Pn.test(t)}function Dn(t){if("string"!=typeof t)return!1;const e=t.split("Z")[0].split(":"),i=e.every((t=>!isNaN(t)));return!(e.length<2||!i)&&(!(parseInt(e[0])>23)&&!(parseInt(e[1])>60))}function An(t){const e=Cn(t);if(!e)return 0;const[i,n]=e.split(":").map((t=>parseInt(t)));return 60*i+n}function Tn(t){return Dn(t)?t.split(":").slice(0,2).map(Fn).join(":"):void 0}function Cn(t){return En(t)&&t.indexOf("T")>0?Tn(t.split("T").reverse()[0]):Tn(t)}function Mn(t){return En(t)||gn.test(t)?t.split("T")[0]:void 0}function xn(t,e){const i=new Date(t);return i.setDate(i.getDate()+e),Mn(i.toISOString())}function Rn(t){t="string"!=typeof t?"00:00":t;const e={},i={};return({0:e.time,1:e.ampm}=t.split(" ")||[]),({0:i.hours,1:i.minutes}=e.time.split(":")||[]),i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function kn(t,e){const[i,n]=(t||"00:00").split(":").map(Fn),r=bn(e).setHours(i,n,0,0);return bn(r)}function On(t,e,i=!0){const n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function Ln(t,e){const i=Cn(t);if(!i)return"00:00";const n=isNaN(e)?0:e;return Cn(_n(kn(i),n).toISOString())}function _n(t,e){const i=new Date(t);return new Date(i.getTime()+6e4*e)}function Fn(t){return t.toString()[1]?t:"0"+t}function jn(t,e){const i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}const Bn={addMinutesToTimeString:Ln,convertTime:function(t,e){return e?function(t){const e=Rn(t);return e.ampm&&e.hours&&("pm"===e.ampm.toLowerCase()&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),"am"===e.ampm.toLowerCase()&&"12"===e.hours&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Fn).join(":")}(t):function(t){const e=Rn(t);return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):"12"===e.hours?e.ampm="PM":"00"===e.hours?(e.hours="12",e.ampm="AM"):e.ampm="AM","0"===e.hours[0]&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}(t)},getUTCdateString:wn,DateHHMM:function(t){const e=new Date(t);return function(t,e){const i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-3600*n)/60),a=i-3600*n-60*r,o=!e||e&&e.displaySeconds;return(o?n+":"+r+":"+a:n+":"+r).split(":").map(Fn).join(":")}(e.getSeconds()+60*e.getMinutes()+3600*e.getHours(),{displaySeconds:!1})},extractDate:Mn,extractTime:Cn,formatDate:Sn,getDateByWeek:function(t,e,i,n=!1){let r=new Date(e,0,1+7*(t-1));const a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Sn(r,i)},isISODateString:En,isTimeString:Dn,offsetDate:bn,offsetTime:function(t){return bn(t).getTime()},sameDay:jn,timeStringMinutes:An,timeToDate:kn,timeUTC:function(t){const e=Un(t)||En(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}};function Vn(t,e,i,n){const r={enabled:$i.deepCopy,...$i.deepCopyAttributes};if((null==r||!r.enabled)&&!i||"object"!=typeof t||"function"==typeof t||null===t)return t;const a=Array.isArray(t)?[]:{},o=Object.keys(t).filter((t=>!i||!(null!=r&&r.ignore.includes(t))));for(const c of o){const o=t[c];if(e&&"extensions"===c&&Array.isArray(o)){const t=null==(s=o)?void 0:s.map((t=>{const{name:e,value:i}=t;return e&&i&&{[`_${e}`]:i}})).filter(Boolean);Object.assign(a,...t)}else n&&"extensions"===c?a[c]=[]:i&&null!=r&&r.stringify.includes(c)?a[c]="function"==typeof(null==o?void 0:o.toString)?o.toString():JSON.stringify(o):i&&null!=r&&r.toJSON.includes(c)&&"function"==typeof(null==o?void 0:o.toJSON)?a[c]=o.toJSON():null===o?a[c]=void 0:yn(o)?a[c]=new Date(o).toISOString():a[c]=Vn(o,e,i,n)}var s;return a}function Gn(t,e){if("object"!=typeof t||null===t)return t;const i=["",void 0,null];e&&i.push(!1);const n=Object.keys(t).filter((e=>!i.includes(t[e])));return Object.assign({},...n.map((e=>Array.isArray(t[e])?{[e]:t[e].map((t=>Gn(t)))}:{[e]:Gn(t[e])})))}function Hn(t){return Array.isArray(t)?t.length+t.map(Hn).reduce(((t,e)=>t+e),0):"object"==typeof t&&null!==t?Object.keys(t).length+Object.keys(t).map((e=>Hn(t[e]))).reduce(((t,e)=>t+e),0):0}function Wn(t,e){return t-e}function qn(){const t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);const e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function zn({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,matchUps:r}){const a={};function o(t){a[t]||(a[t]={allDefaults:0,defaults:0,retirements:0,walkovers:0,matchUpsWon:0,matchUpsLost:0,victories:[],defeats:[],matchUpsCancelled:0,setsWon:0,setsLost:0,gamesWon:0,gamesLost:0,pointsWon:0,pointsLost:0})}return r.filter((e=>!(null!=t&&t.length)||2===ot(t,[Kn(e,0),Kn(e,1)]).length)).forEach((t=>{const{matchUpStatus:n,score:r,winningSide:s}=t,c=s&&function(t){const e=t.winningSide-1;return Kn(t,e)}(t),u=s&&function(t){const e=1-(t.winningSide-1);return Kn(t,e)}(t);if(!c||!u){const e=Kn(t,0),i=Kn(t,1);return e&&(o(e),a[e].matchUpsCancelled+=1),void(i&&(o(i),a[i].matchUpsCancelled+=1))}const d=s&&s-1,p=1-d;o(c),o(u),n===R&&(a[u].walkovers+=1),n===P&&(a[u].defaults+=1),n===C&&(a[u].retirements+=1),[P,C,R].includes(n)&&(a[u].allDefaults+=1),a[c].matchUpsWon+=1,a[u].matchUpsLost+=1,a[u].defeats.push(c),a[c].victories.push(u);const h=G({score:r,matchUpStatus:n,matchUpFormat:e,tallyPolicy:i,winningSide:s});a[c].setsWon+=h[d],a[c].setsLost+=h[p],a[u].setsWon+=h[p],a[u].setsLost+=h[d];const f=function({winningSide:t,matchUpFormat:e=y,matchUpStatus:i,tallyPolicy:n,score:r}){var a,o;const{sets:s}=r||{},c=t-1,u=l(e);let d=0,p=0;const h=H((null==u?void 0:u.bestOf)||1),f=(null==u||null===(a=u.setFormat)||void 0===a?void 0:a.setTo)||0,m=(null==u||null===(o=u.setFormat)||void 0===o?void 0:o.tiebreakAt)||0;if(!s)return[d,p];const g=h*f,v=[[],[]];if(i===P&&null!=n&&n.gamesCreditForDefaults||i===R&&null!=n&&n.gamesCreditForWalkovers?v[c].push(g):s&&s.forEach((t=>{({side1Score:d,side2Score:p}=t),v[0].push(parseInt(d||0)),v[1].push(parseInt(p||0))})),i===C){const n=G({winningSide:t,matchUpStatus:i,matchUpFormat:e,sets:s}),r=n.reduce(((t,e)=>t+e),0);if(v.map((t=>t[c]<=t[1-c])).reduce(((t,e)=>t+e),0)>n[1-c]){const t=v[c].length,e=function(t){if(u&&""!==t)return+t==m-1||+t===m?parseInt(m||0)+1:+t<m?f:m}(v[1-c][t-1]);e&&(v[c][t-1]=e)}r>v[c].length&&v[c].push(f)}const I=[v[0].reduce(((t,e)=>t+e),0),v[1].reduce(((t,e)=>t+e),0)];return[C,R,P].includes(i)&&I[c]<g&&(I[c]=g),I}({score:r,matchUpStatus:n,matchUpFormat:e,tallyPolicy:i,winningSide:s});a[c].gamesWon+=f[d],a[c].gamesLost+=f[p],a[u].gamesWon+=f[p],a[u].gamesLost+=f[d];const m=function({score:t}){var e;const i=[0,0];return null==t||null===(e=t.sets)||void 0===e||e.forEach((t=>{t.side1TiebreakScore&&(i[0]+=parseInt(t.side1TiebreakScore)),t.side2TiebreakScore&&(i[1]+=parseInt(t.side2TiebreakScore))})),i}({score:r,tallyPolicy:i});a[c].pointsWon+=m[d],a[c].pointsLost+=m[p],a[u].pointsWon+=m[p],a[u].pointsLost+=m[d]})),function({participantResults:t,matchUpFormat:e,perPlayer:i}){var n;const r=e&&l(e)||{},a=r.bestOf,o=a&&Math.ceil(a/2)||1,s=null===(n=r.setFormat)||void 0===n?void 0:n.setTo;Object.keys(t).forEach((e=>{const n=t[e].setsWon,r=t[e].setsLost,a=i*(o||0)||n;let c=Math.round(n/r*1e3)/1e3;(c===1/0||isNaN(c))&&(c=a);const u=t[e].matchUpsWon,d=t[e].matchUpsLost;let l=Math.round(u/d*1e3)/1e3;(l===1/0||isNaN(l))&&(l=u);const p=t[e].gamesWon||0,h=t[e].gamesLost||0,f=(i||0)*(o||0)*(s||0),m=Math.max(f,p+h);let g=Math.round(p/m*1e3)/1e3;(g===1/0||isNaN(g))&&(g=0);let v=Math.round(t[e].pointsWon/t[e].pointsLost*1e3)/1e3;(v===1/0||isNaN(v))&&(v=0),t[e].setsRatio=c,t[e].matchUpsRatio=l,t[e].gamesRatio=g,t[e].pointsRatio=v,t[e].result=`${t[e].matchUpsWon}/${t[e].matchUpsLost}`,t[e].games=`${t[e].gamesWon}/${t[e].gamesLost}`}))}({participantResults:a,perPlayer:n,matchUpFormat:e}),{participantResults:a}}function Kn(t,e){if(!t||!t.sides)return console.log("no sides:",{matchUp:t}),"foo";const i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Yn(t){return F.includes(null==t?void 0:t.matchUpStatus)||(null==t?void 0:t.winningSide)}const Jn=[{attribute:"matchUpsRatio",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsRatio",idsFilter:!1},{attribute:"gamesRatio",idsFilter:!1},{attribute:"pointsRatio",idsFilter:!1},{attribute:"matchUpsRatio",idsFilter:!0},{attribute:"setsRatio",idsFilter:!0},{attribute:"gamesRatio",idsFilter:!0},{attribute:"pointsRatio",idsFilter:!0}];function $n(t){const{participantResults:e,subOrderMap:i}=t;if(!function({participantResults:t,participantsCount:e}){let i=Qn({participantResults:t}).filter((t=>e-1===t.results.matchUpsWon+t.results.matchUpsLost+t.results.matchUpsCancelled));return e===i.length}(t))return;const n=Xn({attribute:"matchUpsWon",participantResults:e}),r=Object.keys(n).map((t=>parseFloat(t))).sort(((t,e)=>e-t)).map((t=>n[t])).map((e=>Zn({participantIds:e,...t}))).flat(1/0);let a,o=1;r.forEach(((t,e)=>{e&&(t.resolved||a&&!t.resolved)&&(o+=1),a=t.resolved,t.resolved?(t.position=e+1,o=t.position):t.position=o}));const s=tt(r.map((({position:t})=>t)));return r.forEach((t=>{const n=e[t.participantId],r=s[t.position];void 0!==t&&void 0!==t.position&&(r>1&&(n.ties=r,i&&(n.subOrder=i[t.participantId])),t.groupOrder=t.position+(n.subOrder||1)-1,n.rankOrder=t.position),n.GEMscore=function(t){return t.matchUpsRatio*Math.pow(10,16)+t.setsRatio*Math.pow(10,12)+t.gamesRatio*Math.pow(10,8)+t.pointsRatio*Math.pow(10,3)}(n)})),r}function Zn({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){if(1===i.length)return{resolved:!0,participantId:i[0]};if(2===i.length&&(null==r||!r.headToHead||!r.headToHead.disabled&&!e)){const e=function({participantIds:t,participantResults:e}){if(e[t[0]].victories.includes(t[1]))return t.map((t=>({resolved:!0,participantId:t})));if(e[t[1]].victories.includes(t[0]))return t.reverse().map((t=>({resolved:!0,participantId:t})))}({participantIds:i,participantResults:t});if(e)return e}let o;return((null==r?void 0:r.tallyDirectives)||Jn).every((({attribute:t,reversed:e,idsFilter:s,disableHeadToHead:c})=>(o=function({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){const{participantResults:c}=zn({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:o}),u=Xn({participantResults:c,participantIds:e,attribute:r});if(Object.keys(u).length>1)return Object.keys(u).map((t=>parseFloat(t))).sort(((t,e)=>s?t-e:e-t)).map((t=>u[t])).map((e=>Zn({participantResults:c,disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,matchUps:o}))).flat(1/0)}({disableHeadToHead:c,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:t,idsFilter:s,matchUps:a,reversed:e}),!o))),o||i.map((t=>({participantId:t})))}function Xn({participantResults:t,participantIds:e,attribute:i}){return Qn({participantResults:t,participantIds:e}).reduce(((t,e)=>{const{participantId:n,results:r}=e,a=r[i];return t[a]?t[a].push(n):t[a]=[n],t}),{})}function Qn({participantResults:t,participantIds:e}){return(e=e||Object.keys(t)).reduce(((e,i,n)=>(e.push({participantId:i,i:n,results:t[i]}),e)),[])}const tr="roundRobinTally",er="positionActions",ir="roundNaming",nr="participant",rr="scheduling",ar="avoidance",or="seeding",sr="scoring",cr="draws",ur={POLICY_TYPE_ROUND_ROBIN_TALLY:tr,POLICY_TYPE_POSITION_ACTIONS:er,POLICY_TYPE_ROUND_NAMING:ir,POLICY_TYPE_PARTICIPANT:nr,POLICY_TYPE_SCHEDULING:rr,POLICY_TYPE_AVOIDANCE:ar,POLICY_TYPE_SEEDING:or,POLICY_TYPE_SCORING:sr,POLICY_TYPE_DRAWS:cr};function dr({policyDefinitions:t,matchUpFormat:e,matchUps:i=[],subOrderMap:n,perPlayer:r}){if(!Array.isArray(i))return{error:fe};if(1!==i.reduce(((t,{structureId:e})=>t.includes(e)?t:t.concat(e)),[]).length)return{error:_i};const a=i.filter((t=>t&&t.matchUpStatus!==S)),o=a.length&&X(a.map((({drawPositions:t})=>t)).flat()).length,s=a.filter(Yn).length===a.length;s||(r=0);const c=t&&t.roundRobinTally,u=i.filter(Yn),{participantResults:d}=zn({matchUps:u,matchUpFormat:e,tallyPolicy:c,perPlayer:r}),l=$n({matchUps:u,participantResults:d,participantsCount:o,matchUpFormat:e,tallyPolicy:c,subOrderMap:n});return s&&l&&l.forEach((t=>{d[t.participantId].groupOrder=t.groupOrder})),{participantResults:d}}const lr="CHECK_IN",pr="CHECK_OUT",hr="SCHEDULE.ASSIGNMENT.COURT",fr="SCHEDULE.ASSIGNMENT.VENUE",mr="SCHEDULE.DATE",gr="SCHEDULE.TIME.SCHEDULED",vr="SCHEDULE.TIME.START",yr="SCHEDULE.TIME.STOP",Ir="SCHEDULE.TIME.RESUME",wr="SCHEDULE.TIME.END",Sr="SCALE",br="RATING",Ur="RANKING",Nr="SEEDING",Pr="PUBLISH",Er="PUBLIC",Dr="HIDDEN",Ar="STATUS",Tr={ASSIGN_COURT:hr,ASSIGN_OFFICIAL:"SCHEDULE.ASSIGN.OFFICIAL",ASSIGN_VENUE:fr,CHECK_IN:lr,CHECK_OUT:pr,END_TIME:wr,HIDDEN:Dr,MEDICAL:"MEDICAL",OTHER:"other",PENALTY:"PENALTY",PUBLIC:Er,PUBLISH:Pr,RANKING:Ur,RATING:br,RESUME_TIME:Ir,RETRIEVAL:"RETRIEVAL",SCALE:Sr,SCHEDULED_DATE:mr,SCHEDULED_TIME:gr,SEEDING:Nr,START_TIME:vr,STATUS:Ar,STOP_TIME:yr,SUSPENSION:"SUSPENSION"};function Cr(t){if(mn.test(t)){const e=wn();return new Date(`${e}T${t}`)}return new Date(t)}function Mr({matchUp:t}){if(!t)return{error:me};if(!t.timeItems)return{error:Ai};const e=t.timeItems.filter((t=>[vr,yr,Ir,wr].includes(null==t?void 0:t.itemType))).sort(((t,e)=>Cr(t.itemValue)-Cr(e.itemValue))),i=e.reduce(((t,e)=>{var i,n;let r;const a=null==e||null===(i=e.itemType)||void 0===i?void 0:i.split("."),o=`SCHEDULE.TIME.${(null==e||null===(n=e.itemType)||void 0===n?void 0:n.startsWith("SCHEDULE.TIME"))&&a[2]}`;switch(o){case vr:r=0;break;case wr:if(t.lastValue&&[vr,Ir].includes(t.lastType)){const i=Cr(e.itemValue)-Cr(t.lastValue);r=t.milliseconds+i}else r=t.milliseconds;break;case yr:if([vr,"SCHECULE.TIME.RESUME"].includes(t.lastType)){const i=Cr(e.itemValue)-Cr(t.lastValue);r=t.milliseconds+i}else r=t.milliseconds;break;default:r=t.milliseconds}return{milliseconds:r,lastType:o,lastValue:e.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([vr,Ir].includes(i.lastType)){const t=new Date-Cr(i.lastValue);i.milliseconds+=t}return{milliseconds:i.milliseconds,time:xr(i.milliseconds),relevantTimeItems:e}}function xr(t){const e=(t,e=2)=>("00"+t).slice(-e);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function Rr({categoryName:t,categoryType:e,timesBlockArray:i}){return i.filter((t=>Array.isArray(t))).map((i=>i.sort(((t,e)=>{var i,n;return((null===(i=e.categoryNames)||void 0===i?void 0:i.length)||0)-((null===(n=t.categoryNames)||void 0===n?void 0:n.length)||0)})).find((({categoryTypes:i,categoryNames:n})=>!(null!=n&&n.length)&&!(null!=i&&i.length)||(null==n?void 0:n.includes(t))||(null==i?void 0:i.includes(e)))))).find(Boolean)}function kr({matchUpAverageTimes:t,matchUpFormat:e}={}){const i=(null==t?void 0:t.map((({matchUpFormatCodes:t})=>null==t?void 0:t.filter((t=>t===e)))).flat().filter(Boolean).sort(((t,e)=>((null==t?void 0:t.length)||0)-((null==e?void 0:e.length)||0))))||[],n=i.includes(e)?e:i[0],r=null==t?void 0:t.find((({matchUpFormatCodes:t,averageTimes:e})=>(null==t?void 0:t.find((t=>n===t)))&&e));return null==r?void 0:r.averageTimes}function Or({matchUpRecoveryTimes:t,averageMinutes:e,matchUpFormat:i}={}){var n;return null==t||null===(n=t.find((({matchUpFormatCodes:t,averageTimes:n,recoveryTimes:r})=>{if(n&&e){const{greaterThan:t=0,lessThan:i=360}=n;if(e>t&&e<i)return!0}return(null==t?void 0:t.find((t=>t===i)))&&r})))||void 0===n?void 0:n.recoveryTimes}const Lr="appliedPolicies",_r="delegatedOutcome",Fr="disableLinks",jr="entryProfile",Br="flightProfile",Vr="groupingAttribute",Gr="lineUps",Hr="linkedTournamentsIds",Wr="participantRepresentatives",qr="personRequests",zr="scheduleLimits",Kr="scheduleTiming",Yr="schedulingProfile",Jr="subOrder",$r="tally",Zr={APPLIED_POLICIES:Lr,DELEGATED_OUTCOME:_r,DISABLE_LINKS:Fr,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:jr,FLIGHT_PROFILE:Br,GROUPING_ATTRIBUTE:Vr,LINEUPS:Gr,LINKED_TOURNAMENTS:Hr,PARTICIPANT_REPRESENTATIVES:Wr,PERSON_REQUESTS:qr,SCHEDULE_LIMITS:zr,SCHEDULE_TIMING:Kr,SCHEDULING_PROFILE:Yr,SUB_ORDER:Jr,TALLY:$r};function Xr({tournamentRecord:t}){return ta({extensions:(null==t?void 0:t.extensions)||[]})}function Qr({event:t}){if(!t)return{error:zt};return ta({extensions:t.extensions||[]})}function ta({extensions:t}){const e=t.find((t=>t.name===Lr));return{appliedPolicies:(null==e?void 0:e.value)||{}}}function ea({tournamentRecord:t,event:e,policyType:i}){if(!t)return{error:ft};if(e){const{appliedPolicies:t}=Qr({event:e});if(t&&t[i])return{policy:t[i]}}const{appliedPolicies:n}=Xr({tournamentRecord:t});return null!=n&&n[i]?{policy:n[i]}:{error:Ne}}function ia({tournamentParticipants:t=[],policyDefinitions:e={},participantId:i,personId:n}){const r=t.find((t=>i&&t.participantId===i||n&&t.person&&t.person.personId===n)),a=null==e?void 0:e.participant;if(null!=a&&a.participant){return $({template:a.participant,source:r})}return Vn(r)}function na({tournamentRecord:t,participantId:e}){return{participant:(t.participants||[]).reduce(((t,i)=>i.participantId===e?i:t),void 0)}}function ra({element:t,name:e}){if(!t||!e)return{error:Ae};if(!Array.isArray(t.extensions))return{message:Gi};const i=t.extensions.find((t=>(null==t?void 0:t.name)===e));return{extension:i,message:i?void 0:Gi}}function aa({tournamentRecord:t,name:e}){return ra({element:t,name:e})}function oa({event:t,name:e}){return t?ra({element:t,name:e}):{error:zt}}function sa({drawDefinition:t,name:e}){return t?ra({element:t,name:e}):{error:yt}}function ca({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var r,a,o;e=e||(null==n||null===(r=n.category)||void 0===r?void 0:r.categoryName)||(null==n||null===(a=n.category)||void 0===a?void 0:a.ageCategoryCode),i=i||(null==n||null===(o=n.category)||void 0===o?void 0:o.categoryType);const{policy:s}=ea({policyType:rr,tournamentRecord:t,event:n}),{extension:c}=aa({tournamentRecord:t,name:Kr}),u=null==c?void 0:c.value,{extension:d}=oa({event:n,name:Kr});return{scheduleTiming:{categoryName:e,categoryType:i,eventScheduling:null==d?void 0:d.value,tournamentScheduling:u,policy:s}}}const ua="SINGLES",da="DOUBLES",la="TEAM",pa={SINGLES:ua,DOUBLES:da,TEAM:la},ha="total",fa="SINGLES_DOUBLES",ma="DOUBLES_SINGLES",ga={TOTAL:ha,SINGLES_DOUBLES:fa,DOUBLES_SINGLES:ma};function va({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:ft};o=o||(null==s?void 0:s.eventType);const c={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=ca({tournamentRecord:i,categoryName:r,categoryType:a,event:s});return ya({eventType:o,timingDetails:{...u,matchUpFormat:n,categoryType:a,defaultTiming:c}})}function ya({eventType:t,timingDetails:e}){const i=function({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;return Rr({categoryName:e,categoryType:i,timesBlockArray:[(null==a?void 0:a.matchUpAverageTimes)&&kr({...a,matchUpFormat:t}),(null==r?void 0:r.matchUpAverageTimes)&&kr({...r,matchUpFormat:t}),(null==o?void 0:o.matchUpAverageTimes)&&kr({...o,matchUpFormat:t}),null==o||null===(s=o.defaultTimes)||void 0===s?void 0:s.averageTimes,null==n?void 0:n.averageTimes]})}(e),n=Object.keys((null==i?void 0:i.minutes)||{}),r=(null==i?void 0:i.minutes)&&((null==n?void 0:n.includes(t))&&i.minutes[t]||i.minutes.default),a=function({matchUpFormat:t,categoryName:e,categoryType:i,averageMinutes:n,defaultTiming:r,tournamentScheduling:a,eventScheduling:o,policy:s}){var c;return Rr({categoryName:e,categoryType:i,timesBlockArray:[(null==o?void 0:o.matchUpRecoveryTimes)&&Or({...o,averageMinutes:n,matchUpFormat:t}),(null==a?void 0:a.matchUpRecoveryTimes)&&Or({...a,averageMinutes:n,matchUpFormat:t}),(null==s?void 0:s.matchUpRecoveryTimes)&&Or({...s,averageMinutes:n,matchUpFormat:t}),null==s||null===(c=s.defaultTimes)||void 0===c?void 0:c.recoveryTimes,null==r?void 0:r.recoveryTimes]})}({...e,averageMinutes:r}),o=Object.keys((null==a?void 0:a.minutes)||{}),s=(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(t))&&a.minutes[t]||a.minutes.default),c=t===ua?fa:ma;return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(c))&&a.minutes[c]||s)}}function Ia({tournamentRecord:t,eventId:e,drawId:i}){if(!t)return{error:ft};const n=(null==t?void 0:t.events)||[];if(i){let t;const e=n.find((e=>{const n=((null==e?void 0:e.drawDefinitions)||[]).find((t=>t.drawId===i));return n&&(t=n),n}));if(e)return{event:e,drawDefinition:t}}if(e){const t=n.find((t=>t.eventId===e));return t?{event:t}:{error:Kt}}return{error:Ae}}function wa({tournamentRecord:t,drawId:e}){if(!t)return{error:ft};if(!e)return{error:xt};const i=(t.events||[]).reduce(((t,i)=>{const n=(i.drawDefinitions||[]).reduce(((t,i)=>i.drawId===e?i:t),void 0);return n&&n.drawId===e?{event:i,drawDefinition:n}:t}),void 0);return i?{...i,SUCCESS:dt}:{error:wt}}function Sa(t,e,i){const n=t=>t.createdAt?new Date(t.createdAt).getTime():0,r=t.filter((t=>t&&t.itemType===e&&(!i||n(t)<i))).sort(((t,e)=>n(t)-n(e))).pop();return r&&r.itemValue}function ba({matchUp:t,visibilityThreshold:e}){return{scheduledTime:Sa((null==t?void 0:t.timeItems)||[],gr,e)}}function Ua({matchUp:t,visibilityThreshold:e}){return{scheduledDate:Sa((null==t?void 0:t.timeItems)||[],mr,e)}}function Na({matchUp:t,visibilityThreshold:e}){return{courtId:Sa((null==t?void 0:t.timeItems)||[],hr,e)}}function Pa({matchUp:t,visibilityThreshold:e}){return{venueId:Sa((null==t?void 0:t.timeItems)||[],fr,e)}}const Ea="SINGLES",Da="DOUBLES",Aa="TEAM",Ta={SINGLES:Ea,DOUBLES:Da,TEAM:Aa,AGE:"AGE",RATING:"RATING",BOTH:"BOTH"};function Ca({scheduleVisibilityFilters:t,afterRecoveryTimes:e=!0,tournamentRecord:i,scheduleTiming:n,matchUpFormat:r,matchUpType:a,matchUp:o,event:s}){if(!o)return{error:me};if(!o.matchUpType&&!a&&(s||i)&&o.drawId){var c,u,d,l,p,h;let t=null===(c=s)||void 0===c?void 0:c.drawDefinitions.find((t=>t.drawId===o.drawId));!t&&i&&({drawDefinition:t,event:s}=Ia({tournamentRecord:i,drawId:o.drawId}));const e=o.structureId&&(null===(u=t)||void 0===u||null===(d=u.structures)||void 0===d?void 0:d.find((({structureId:t})=>t===o.structureId)));a=(null==e?void 0:e.matchUpType)||(null===(l=t)||void 0===l?void 0:l.matchUpType)||(null===(p=s)||void 0===p?void 0:p.eventType)!==Aa&&(null===(h=s)||void 0===h?void 0:h.eventType)}const{milliseconds:f,time:m}=Mr({matchUp:o}),{startTime:g}=function({matchUp:t}){const e=(null==t?void 0:t.timeItems)||[],i=t=>t.createdAt?new Date(t.createdAt).getTime():0,n=e.reduce(((t,e)=>{const n=e.itemType===vr&&e;return n&&(!t||i(n)<i(t))?n:t}),void 0);return{startTime:n&&n.itemValue}}({matchUp:o}),{endTime:v}=function({matchUp:t}){const e=(null==t?void 0:t.timeItems)||[],i=t=>t.createdAt?new Date(t.createdAt).getTime():0,n=e.reduce(((t,e)=>{const n=e.itemType===wr&&e;return n&&(!t||i(n)>i(t))?n:t}),void 0);return{endTime:n&&n.itemValue}}({matchUp:o});let y;const{visibilityThreshold:I,eventIds:w,drawIds:S}=t||{};if(w&&!w.includes(o.eventId)||S&&!S.includes(o.drawId))y=Gn({time:m,startTime:g,endTime:v,milliseconds:f});else{const t={matchUp:o,visibilityThreshold:I};let{scheduledDate:i}=Ua(t);const{scheduledTime:s}=ba(t),{courtId:c}=Na(t),{venueId:u}=Pa(t);let d,l,p,h,w;if(null!=n&&n.policy&&s&&e){const t={matchUpFormat:o.matchUpFormat||r,...n};({averageMinutes:l=0,recoveryMinutes:p=0,typeChangeRecoveryMinutes:h=0}=ya({eventType:o.matchUpType||a,timingDetails:t})),(l||p)&&(d=v?Ln(Cn(v),p):Ln(s,l+p)),h&&(w=v?Ln(Cn(v),h):Ln(s,l+h))}!i&&s&&(i=Mn(s)),y=Gn({venueId:u,courtId:c,typeChangeTimeAfterRecovery:w,timeAfterRecovery:d,scheduledDate:i,scheduledTime:s,typeChangeRecoveryMinutes:h,recoveryMinutes:p,averageMinutes:l,milliseconds:f,startTime:g,endTime:v,time:m})}const b=F.includes(o.matchUpStatus),{scheduledDate:U}=Ua({matchUp:o}),{scheduledTime:N}=ba({matchUp:o});return{schedule:y,endDate:b&&(Mn(v)||Mn(U)||Mn(N))}}function Ma({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find((t=>t.matchUpId===e))}}function xa({sideAdjustments:t=[0,0],separator:e="-",tieFormat:i,matchUp:n}){var r;if(!Array.isArray(t)||2!==t.length||isNaN(t.reduce(((t,e)=>t+e))))return{error:_i};if(!n)return{error:me};i=n.tieFormat||i;const a=[0,0],o=(null==n?void 0:n.tieMatchUps)||[];((null===(r=i)||void 0===r?void 0:r.collectionDefinitions)||[]).forEach((t=>{const e=o.filter((e=>e.collectionId===t.collectionId));if(t.matchUpValue){const i=t.matchUpValue;e.forEach((t=>{t.winningSide&&(a[t.winningSide-1]+=i)}))}else if(t.collectionValue){const i=[0,0],n=Math.floor(t.matchUpCount/2).floor+1;e.forEach((t=>{t.winningSide&&(i[t.winningSide-1]+=1)}));const r=i.reduce(((t,e)=>e>=n?e+1:t),void 0);r&&(a[r]+=t.collectionValue)}else t.collectionValueProfile&&e.forEach((e=>{if(e.winningSide){const i=e.collectionPosition,n=function({collectionDefinition:t,collectionPosition:e}){const i=(t.collectionValueProfile||[]).find((t=>t.collectionPosition===e));return null==i?void 0:i.matchUpValue}({collectionDefinition:t,collectionPosition:i});a[e.winningSide-1]+=n}}))}));const s=a.map(((e,i)=>e+t[i])),c={side1Score:s[0],side2Score:s[1]},u=s.join(e),d=s.slice().reverse().join(e);let l;if(i){var p;const t=null===(p=i.winCriteria)||void 0===p?void 0:p.valueGoal;if(t){const e=s.map(((t,e)=>({sideNumber:e+1,points:t}))).find((({points:e})=>e>=t));l=null==e?void 0:e.sideNumber}}return{scoreStringSide1:u,scoreStringSide2:d,winningSide:l,set:c}}const Ra="INDIVIDUAL",ka="TEAM",Oa="PAIR",La="GROUP",_a={INDIVIDUAL:Ra,TEAM:ka,PAIR:Oa,GROUP:La};const Fa=t=>{var e;const{isSide1:i,lowValue:n,setTo:r,tiebreakAt:a,NoAD:o}=t;if(void 0===n)return{error:Ae};let s,c=parseInt(n);(null===(e=c)||void 0===e?void 0:e.toString().length)>2&&(c=parseInt(c.toString().slice(0,2))),a&&a<r&&c>a&&(c=a),s=o&&!a?c<r?r:r-1:c+1<r||a&&a<r&&c===a?r:a?r+1:c+2;return[i?c:s,i?s:c]},ja=t=>{var e;const{isSide1:i,lowValue:n,tiebreakTo:r,tiebreakNoAd:a}=t;if(void 0===n)return{error:Ae};let o=parseInt(n);(null===(e=o)||void 0===e?void 0:e.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),a&&o>r-1&&(o=r-1);const s=function(t){const{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;if(e+1>=n)return e+r;return n}({lowValue:o,NoAD:a,tiebreakTo:r});return[i?o:s,i?s:o]};function Ba({checkCollectionIds:t=!0,tieFormat:e}={}){const i=[];if("object"!=typeof e)return i.push("tieformat must be an object"),{error:oe,errors:i};if("object"!=typeof e.winCriteria)return i.push("tieFormat.winCriteria must be an object"),{error:oe,errors:i};if(!Array.isArray(e.collectionDefinitions))return i.push("tieFormat.collectionDefinitiosn must be an array of objects"),{error:oe,errors:i};const n="number"==typeof e.winCriteria.valueGoal&&e.winCriteria.valueGoal>0;n||i.push("Non-zero valueGoal must be specified in winCriteria");const r=e.collectionDefinitions.every((e=>{if("object"!=typeof e)return i.push(`collectionDefinition must be an object: ${e}`),!1;const{collectionValueProfile:n,collectionGroupNumber:r,collectionValue:a,collectionId:o,matchUpCount:s,matchUpFormat:c,matchUpValue:u,matchUpType:d}=e;if(t&&"string"!=typeof o)return i.push(`collectionId is not type string: ${o}`),!1;if("number"!=typeof s)return i.push(`matchUpCount is not type number: ${s}`),!1;if(![ua,da].includes(d))return i.push(`matchUpType must be SINGLES or DOUBLES: ${d}`),!1;if(!u&&!a&&!n)return i.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfile"),!1;if(u&&"number"!=typeof u)return i.push(`matchUpValue is not type number: ${u}`),!1;if(a&&"number"!=typeof a)return i.push(`collectionValue is not type number: ${a}`),!1;if(n){if(!Array.isArray(n))return i.push(`collectionValueProfile is not an array: ${n}`),!1;if(n.length!==s)return i.push("collectionValueProfile does not align with matchUpsCount"),!1;for(const e of n){if("object"!=typeof e)return i.push(`valueProfile is not type object: ${e}`),!1;const{value:t,collectionPosition:n}=e;if("number"!=typeof t||"number"!=typeof n||n>s||n<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),!1}const t=n.map((t=>t.collectionPosition));if(t.length!==X(t).length)return i.push("collectionPositions are not unique"),!1}return r&&"number"!=typeof r?(i.push(`collectionValue is not type number: ${a}`),!1):!(c&&!Ro.isValidMatchUpFormat(c))||(i.push(`Invalid matchUpFormat: ${c}`),!1)})),a=e.collectionDefinitions.map((({collectionId:t})=>t)),o=!t||a.length===X(a).length,s=r&&n&&o,c={valid:s,errors:i};return s||(c.error=oe),c}function Va({analysis:t,set:e}){const i=Ha({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return Ga({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function Ga({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var o;if(!a)return{error:Ae};e=e||i;const s=r&&e.finalSetFormat||(null===(o=e)||void 0===o?void 0:o.setFormat),{side1Score:c,side2Score:u}=a,{NoAD:d,setTo:l,tiebreakAt:p,tiebreakFormat:h}=s,f=null==h?void 0:h.NoAd,m=Ha({set:a}),g=Math.abs(c-u),v=c>=l||u>=l,y=n||c>=l&&u>=l||p&&p<l&&(c===p||u===p),I=t||y&&(1===m&&a.side1TiebreakScore>a.side2TiebreakScore||2===m&&a.side2TiebreakScore>a.side1TiebreakScore);return(v&&(g>=(d||y&&(p&&!n||n&&f)?1:2)||y)||n)&&(!y||I)}function Ha({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}const Wa=" ",qa="DEF",za=["RET",qa,"WO","WO/WO","ABN","SUS","INT"],Ka="DEFAULTED",Ya="WALKOVER",Ja="ABANDONED",$a="SUSPENDED",Za="RETIRED",Xa="INTERRUPTED",Qa=[Za,Ka,Ya],to="()",eo="[]",io=["up","left","shift+tab"],no=["enter","down","tab","right"],ro="backspace",ao=["r","d","w","a","s","i"],oo="space",so=["[","("],co=[...io,...no,oo,"]"],uo="-",lo="-",po=["/"],ho=["0","1","2","3","4","5","6","7","8","9"].concat(ao),fo=ho.map((t=>`shift+${t}`)),mo=[uo,ro].concat(co,po),go=[ho,fo,mo].join(","),vo=[go,io,no,["=","+","num_1","num_2","shift+=","shift+-"]].join(",");[].concat(...ho,...ho,...mo,...ho,...ho,...ho,...ho,...ho,...ho);const yo={SIDE1KEYS:ho,SIDE2KEYS:fo,MODIFIERS:mo,PROMPT:"Enter Score",MOVEUP:io,MOVEDOWN:no,HOTKEYS:vo};function Io({scoreString:t,lowSide:e,outcome:i}){if(({scoreString:t}=wo({scoreString:t})),2===e){return t+((t&&t[t.length-1])!==Wa?Wa:"")+i}return i+Wa+t}function wo({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(const n of za){var i;const r=null===(i=t)||void 0===i?void 0:i.indexOf(n);0===r?t=t.slice(n.length+1).trim()+Wa:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t&&t.trim()||(t=""),{scoreString:t,removed:e}}function So({analysis:t,scoreString:e,sets:i,lowSide:n}){let r,a;if(!e)return{scoreString:e,sets:i};const{scoreString:o,removed:s}=wo({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let c=i[i.length-1]||{};const u=Object.values(c).filter((t=>void 0!==t)).length;c.setNumber&&1===u&&(c=(i=i.slice(0,i.length-1))[i.length-1]||{});const{tiebreakSet:d}=t.setFormat,{tiebreakTo:l,NoAD:p}=d||{},{isTiebreakEntry:h}=bo({scoreString:e,brackets:eo}),f=function(t){const e=t.split("");return e.reduce(((t,e,i)=>(e.match(/\d+/g)&&t.push(i),t)),[]).pop()}(e);if(f>=0){r=e.slice(0,f);const{isTiebreakEntry:o}=bo({scoreString:r,brackets:to}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=bo({scoreString:r,brackets:eo}),d=r&&r[r.length-1].trim(),b=r&&!isNaN(d);let U=t.isIncompleteSetScore;if(h&&u){const t=r.slice(s+1).split(lo),i=(null==t?void 0:t.length)>0&&void 0!==t[0]&&!isNaN(parseInt(t[0]))&&parseInt(t[0])||void 0,a=(null==t?void 0:t.length)>1&&void 0!==t[1]&&parseInt(t[1])||void 0,o=[i,a];if(a){const t=1===n?1:0;o[t]=o[1-t]+(p?1:2),o[t]<l&&(o[t]=l),r=e.slice(0,s+1),r+=o.join(lo)}else void 0!==i?(r=e.slice(0,s+1),r+=i):(r=e.slice(0,s),U=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(r.length||(r=void 0),U){var m;const e=null===(m=c.side1Score)||void 0===m?void 0:m.toString();if(e){const t=null==e?void 0:e.slice(0,e.length-1);c.side1Score=!isNaN(t)&&parseInt(t)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}var g,v;if(t.isTimedSet)a=c.side1Score?i:(null===(g=i)||void 0===g?void 0:g.slice(0,i.length-1))||[],a[i.length-1]=c;else a=(null===(v=i)||void 0===v?void 0:v.slice(0,i.length-1))||[]}else if(b){var y,I;const e=null===(y=c.side2Score)||void 0===y?void 0:y.toString(),n=null===(I=c.side1Score)||void 0===I?void 0:I.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(c.side2Score){const t=null==e?void 0:e.slice(0,e.length-1);c.side2Score=!isNaN(t)&&parseInt(t)||void 0}else{const t=null==n?void 0:n.slice(0,n.length-1);c.side1Score=!isNaN(t)&&parseInt(t)||void 0}var w;if(t.isTimedSet)if(c.side1Score)a=i||[],a[i.length-1]=c;else a=(null===(w=i)||void 0===w?void 0:w.slice(0,i.length-1))||[];else a=i||[],a[i.length-1]=c;a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else if(o)a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0});else{var S;if(h&&!u)a=(null===(S=i)||void 0===S?void 0:S.slice(0,i.length-1))||[];else a=i,a[i.length-1]=c;h||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0)}return{scoreString:r,sets:a}}return{scoreString:e,sets:i}}function bo({scoreString:t,brackets:e="()"}){if(!t)return!1;const[i,n]=e.split(""),r=t.split(""),a=Math.max(...at(i,r));return{isTiebreakEntry:a>Math.max(...at(n,r)),lastOpenBracketIndex:a}}function Uo({lowValue:t=0,NoAD:e=!1,tiebreakTo:i}={}){if(t+1>=i)return t+(e?1:2);return parseInt(i)}function No({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){const r=l(t),{bestOf:a}=r,o=Math.ceil(a/2),s=n&&n.reduce(((t,e)=>{const{winningSide:i}=e;return i&&t[i-1]++,t}),[0,0]);let c=(null==s?void 0:s.indexOf(o))+1||void 0;return Qa.includes(e)&&i&&(c=i),{matchUpWinningSide:c}}function Po({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return"r"===e?n?(o=!0,n=Io({scoreString:n,lowSide:t,outcome:"RET"}),r=2===t?1:2,a=Za):(o=!0,n=Io({scoreString:n,lowSide:t,outcome:qa}),r=2===t?1:2,a=Ka):"d"===e?(o=!0,n=Io({scoreString:n,lowSide:t,outcome:qa}),r=2===t?1:2,a=Ka):"w"===e?(o=!0,i=[],n="WO",r=2===t?1:2,a=Ya):"s"===e&&n?(o=!0,n=Io({scoreString:n,lowSide:t,outcome:"SUS"}),a=$a,r=void 0):"a"===e?(o=!0,n=Io({scoreString:n,lowSide:t,outcome:"ABN"}),a=Ja,r=void 0):"i"===e&&n&&(o=!0,n=Io({scoreString:n,lowSide:t,outcome:"INT"}),a=Xa,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function Eo({sets:t,scoreString:e,winningSide:i,matchUpFormat:n,value:r}){var a,o;const s=((null==t||null===(a=t.filter((t=>null==t?void 0:t.winningSide)))||void 0===a?void 0:a.length)||0)+(i?0:1),c=l(n),u=s===(null==c?void 0:c.bestOf),d=u&&c.finalSetFormat||c.setFormat||{},p=(null==d?void 0:d.timed)||c.timed,h=u&&t[(null==c?void 0:c.bestOf)-1],f=h&&h.winningSide,{isTiebreakEntry:m}=bo({scoreString:e,brackets:to}),{isTiebreakEntry:g}=bo({scoreString:e,brackets:eo}),v=m||g,y=!!d.tiebreakSet,I=e&&e[e.length-1].trim(),w=e&&!isNaN(I),S=!v&&I===uo,b=m&&so.includes(I),U=g&&so.includes(I),N=g&&I===lo,P=e&&e.split(""),[E]=eo.split(""),D=P&&Math.max(...at(E,P)),A=P&&Math.max(...at(lo,P)),T=P&&A>D,C=null===(o=t[t.length-1])||void 0===o?void 0:o.winningSide,M=(null==t?void 0:t.length)&&!C,x=za.find((t=>(null==e?void 0:e.indexOf(t))>=0)),R=!isNaN(r),k=r===oo,O=co.includes(r),L=null==e?void 0:e.split("").find((t=>so.includes(t)));return{isTiebreakSetValue:y&&R,matchUpScoringFormat:c,setNumber:s,setFormat:d,matchTiebreakHasJoiner:T,isGameScoreEntry:M,isSpace:k,isCloser:O,isTiebreakCloser:O&&L&&v&&w,isDecidingSet:u,isTiebreakSet:y,isTimedSet:p,isNumericEnding:w,isNumericValue:R,hasOpener:L,hasOutcome:x,finalSet:h,finalSetIsComplete:f,lastSetIsComplete:C,isInvalidSetTiebreakValue:k&&v&&b,isInvalidMatchTiebreakValue:O&&g&&!U&&(N||!function({scoreString:t}){if(!t)return!1;const e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=eo.split(""),a=t.split(""),o=Math.max(...at(n,a)),s=Math.max(...at(r,a)),c=Math.max(...at(lo,a));return i&&o>s&&c>o}({scoreString:e})),isTiebreakEntry:v,isSetTiebreakEntry:m,isMatchTiebreakEntry:g,isIncompleteSetScore:S,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:U,isPartialMatchTiebreakValue:N}}function Do(t){const{sets:e,winningSide:i,autoComplete:n,matchUpStatus:r,reversed:a=!1,winnerFirst:o=!0,addOutcomeString:s}=t;if(!e)return{error:Ae};const c=a||!(!o||!i||1===i),u=s?function({matchUpStatus:t}){const e={[C]:"RET",[R]:"WO",[E]:"WO/WO",[M]:"SUS",[I]:"ABN",[P]:"DEF",[N]:"DR"};return t&&e[t]||""}({matchUpStatus:r}):"",d=(null==e?void 0:e.sort(Ao).map((function(t){const e=(d=t,!(z(null==d?void 0:d.side1Score)||z(null==d?void 0:d.side2Score))&&(t=>z(null==t?void 0:t.side1TiebreakScore)||z(null==t?void 0:t.side2TiebreakScore))(t)),{side1Score:i,side2Score:r,side1TiebreakScore:a,side2TiebreakScore:o}=t,s=a||(z(a)||n?0:""),u=o||(z(o)||n?0:"");var d;if(e){return`[${(c?[u,s]:[s,u]).join("-")}]`}const l=Math.min(s,u),p=l?`(${l})`:"",h=i||(z(i)||n?0:""),f=r||(z(r)||n?0:"");let m=c?`${[f,h].join("-")}${p}`:`${[h,f].join("-")}${p}`;["-"," "].includes(m)&&(m="");return m})).filter(Boolean).join(" "))||"";return u?2===i?`${u} ${d}`:`${d} ${u}`:d}function Ao(t,e){return t.setNumber-e.setNumber}function To({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;const r=Co({set:n});return function({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var o;if(!a)return{error:Ae};e=e||i;const s=r&&e.finalSetFormat||(null===(o=e)||void 0===o?void 0:o.setFormat)||{},{side1Score:c,side2Score:u}=a,{setTo:d,tiebreakAt:l,tiebreakFormat:p}=s,h=null==p?void 0:p.NoAd,f=Co({set:a}),m=Math.abs(c-u),g=c>=d||u>=d,v=n||c>=d&&u>=d||l&&l<d&&(c===l||u===l),y=t||v&&(1===f&&a.side1TiebreakScore>a.side2TiebreakScore||2===f&&a.side2TiebreakScore>a.side1TiebreakScore),I=m>=(v&&(l&&!n||n&&h)?1:2);return(g&&(I||v)||n)&&(!v||y)}({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,set:n})&&r||void 0}function Co({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function Mo(t){const{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:Ee};const{setNumber:n}=e||{},{bestOf:r}=i||{},a=!(!n||n!==r),o=a&&(null==i?void 0:i.finalSetFormat)||(null==i?void 0:i.setFormat),s=!(null==o||!o.tiebreakSet),c=!(null==o||!o.timed),u=!s&&!c,d=!!(n&&r&&n<=r),l=[null==e?void 0:e.side1Score,null==e?void 0:e.side2Score],p=[null==e?void 0:e.side1PointScore,null==e?void 0:e.side2PointScore],h=[null==e?void 0:e.side1TiebreakScore,null==e?void 0:e.side2TiebreakScore],f=l.filter((t=>void 0!==t)).length,m=p.filter((t=>void 0!==t)).length,g=h.filter((t=>void 0!==t)).length,v=null==l?void 0:l.filter((t=>!isNaN(t))).length,y=null==h?void 0:h.filter((t=>!isNaN(t))).length,{tiebreakAt:I}=o||{},w=I&&2===l.filter((t=>t>=I)).length,S=w&&(l[0]>l[1]?1:l[1]>l[0]?2:void 0),b=!(!y||v),U=!(!e||null==e||!e.winningSide),{error:N,result:P}=function({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:Ee};const r=!(null==e||!e.tiebreakSet),a=!(null==e||!e.timed);if(!e||r||a)return{result:!1,error:"not standard set"};if(2!==(null==i?void 0:i.filter((t=>!isNaN(t))).length))return{result:!1,error:_e};const{setTo:o,tiebreakAt:s,tiebreakFormat:c,NoAD:u}=e||{};if(!o||null==i||!i.find((t=>t>=o)))return{result:!1,error:_e};const d=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!d)return{result:!1,error:Fe};const l=(null==t?void 0:t.winningSide)-1,p=1-l,h=i[l],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:"winningSide game scoreString is not high"};const g=s&&c,v=2===(null==n?void 0:n.filter((t=>!isNaN(t))).length),y=n&&n[l],I=n&&n[p],w=s&&2===i.filter((t=>t>=s)).length;if(g){const{NoAD:t,tiebreakTo:e}=c;if(w){if(m>1)return{result:!1,error:"invalid winning game scoreString (5)"};if(!v)return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(e))return{result:!1,error:"tiebreakTo error"};if(!!(!e||null==n||!n.find((t=>t>=e))))return{result:!1,error:"invalid tiebreak scores (2)"};if(h>(s<o?o:o+1))return{result:!1,error:"invalid winning game scoreString (1)"};if(!y||!I||y<I)return{result:!1,error:"winningSide tiebreak value is not high"};const i=t?1:2,r=y-I,a=I>=e-1;if(r&&a&&r<i)return{result:!1,error:"invalid tiebreak scores (3)"}}if(h>o&&(!g||!w))return{result:!1,error:"invalid winning game scoreString (2)"}}const S=u?1:2,b=f>=o-1;if(m&&b&&!w&&m<S)return{result:!1,error:"invalid winning game scoreString (3)"};if(m>S&&h>o)return{result:!1,error:"invalid winning game scoreString (4)"};return{result:!0}}({setObject:e,setFormat:o,sideGameScores:l,sideTiebreakScores:h}),{error:E,result:D}=function({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:Ee};const n=!(null==e||!e.tiebreakSet),r=!(null==e||!e.timed);if(!e||!n||r)return{result:!1,error:"not tiebreak set"};const a=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!a)return{result:!1,error:Fe};const{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:c}=o||{};if(2!==(null==i?void 0:i.filter((t=>!isNaN(t))).length))return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(c))return{result:!1,error:"tiebreakTo error"};if(null==i||!i.find((t=>t>=c)))return{result:!1,error:"invalid tiebreak scores (2)"};const u=(null==t?void 0:t.winningSide)-1,d=1-u,l=i[u],p=i[d];if(!l||!p||l<p)return{result:!1,error:"winningSide tiebreak value is not high"};const h=s?1:2,f=l-p,m=p>=c-1;if(f&&m&&f<h)return{result:!1,error:"invalid tiebreak scores (3)"};return{result:!0}}({setObject:e,setFormat:o,sideTiebreakScores:h}),A=u&&!b&&P||s&&b&&D,T={expectTiebreakSet:s,expectTimedSet:c,hasTiebreakCondition:w,isCompletedSet:U,isDecidingSet:a,isTiebreakSet:b,isValidSet:d&&!(s&&!b)&&!(u&&b)&&(!U||A),isValidSetNumber:d,isValidSetOutcome:A,leadingSide:S,setFormat:o,sideGameScores:l,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:h,sideTiebreakScoresCount:g,winningSide:To({isDecidingSet:a,isTiebreakSet:b,matchUpScoringFormat:i,setObject:e})};return void 0!==(null==e?void 0:e.winningSide)&&(b?(T.isValidTiebreakSetOutcome=D,D||(T.tiebreakSetError=E)):(T.isValidStandardSetOutcome=P,P||(T.standardSetError=N))),T}function xo(t){var e;const{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:o}=t||{};let{matchUpFormat:s}=t||{};if(!i)return{error:me};s=s||(null==i?void 0:i.matchUpFormat);const c=l(s),u=!(null==i||!i.winningSide),d=null===(e=i.score)||void 0===e?void 0:e.sets,p=null==d?void 0:d.length,h=r&&r-1,f=!(null==d||!d.find(((t,e)=>t.setNumber===r&&e===h))),m=(null==d?void 0:d.filter((t=>null==t?void 0:t.winningSide)))||[],g=(null==m?void 0:m.length)||0,v=r&&(null==d?void 0:d.slice(r))||[],y=!!(p&&r&&null!=v&&v.reduce(((t,e)=>(!e||!e.side1Score&&!e.side2Score&&!e.side1TiebreakScore&&!e.side2TiebreakScore&&!e.side1PointScore&&!e.side2PointScore)&&t),!0)),I=r<=p&&d.find((t=>t.setNumber===r)),w=I&&Mo({setObject:I,matchUpScoringFormat:c}),{isCompletedSet:S,sideGameScores:b,sideTiebreakScores:U}=w||{},N=!!(I&&!S&&y||r&&r===p+1&&!u),P=[1,2].includes(n),E=P?n-1:0,D=I&&P&&(!a&&!o&&void 0!==b[E]&&b[E]||a&&void 0!==U[E]&&U[E]),A=!!D,T=m&&m.map((t=>Mo({setObject:t,matchUpScoringFormat:c}).isValidSetOutcome)).reduce(((t,e)=>t&&e),!0),C=m.reduce(((t,e)=>{const{winningSide:i}=e;return t[i-1]++,t}),[0,0]),M=null==i?void 0:i.winningSide,x=M&&M-1,R=1-x,k=C[x],O=C[R],L=Math.max(...C),_=tt(C)[L],{bestOf:F}=c||{},j=L===(F&&Math.ceil(F/2)||1)&&1===_&&C.indexOf(L)+1||void 0,B=k>O&&M===j;return{isActiveSet:N,isExistingSet:f,existingValue:D,hasExistingValue:A,isValidSideNumber:P,completedSetsCount:g,isCompletedMatchUp:u,isLastSetWithValues:y,validMatchUpOutcome:j&&T&&B,matchUpScoringFormat:c,calculatedWinningSide:j,validMatchUpWinningSide:B,completedSetsHaveValidOutcomes:T,...w}}const Ro={stringifyMatchUpFormat:o,isValidMatchUpFormat:v,parseMatchUpFormat:l,generateTieMatchUpScore:xa,tallyParticipantResults:dr,getTiebreakComplement:ja,generateScoreString:Do,checkSetIsComplete:Ga,validateTieFormat:Ba,getSetComplement:Fa,analyzeMatchUp:xo,keyValueScore:function(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:o}=t;const{matchUpFormat:s,shiftFirst:c,auto:u=!0}=t;let d,l;const p=c&&2===e||!c&&1===e;if(!go.includes(i))return{updated:!1,message:"invalid key"};c&&(e=3-e);const{matchUpWinningSide:h}=No({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=h;const f=Eo({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:s});if(po.includes(i)&&(i=uo),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===parseInt(i)&&(f.isTiebreakCloser=!0),co.includes(i)&&f.hasOpener&&(i=""),co.includes(i)&&(i=oo),f.lastSetIsComplete){var m;const t=(null===(m=n)||void 0===m?void 0:m.length)&&n[n.length-1];n&&" "!==t&&(n+=" ")}if(f.isTimedSet)({message:l,sets:r,scoreString:n,updated:d,matchUpStatus:o,winningSide:a}=function({analysis:t,lowSide:e,scoreString:i,sets:n,winningSide:r,matchUpStatus:a,message:o,value:s}){var c;let u,d;null!==(c=n)&&void 0!==c&&c.length||s===ro||(n=[{setNumber:1}]);const l=n.length-1;if(ao.includes(s)){const c=n[n.length-1]||{},{side1Score:d,side2Score:l}=c;d&&!l?o="missing side2Score":t.finalSetIsComplete||r?o="final set is already complete":t.isIncompleteSetScore?o="incomplete set scoreString":t.isIncompleteSetScore||({sets:n,scoreString:i,winningSide:r,matchUpStatus:a,updated:u}=Po({lowSide:e,value:s,sets:n,scoreString:i,matchUpStatus:a,winningSide:r}))}else if(s===ro){var p;if(({scoreString:i,sets:n,outcomeRemoved:d}=So({analysis:t,scoreString:i,sets:n})),""===(null===(p=i)||void 0===p?void 0:p.trim())&&(i=i.trim()),i||(n=[]),d){const t=n[n.length-1]||{},{side1Score:e,side2Score:i}=t;if(e&&i){const r=e>i?1:i>e?2:void 0;r&&(t.winningSide=r,n.push({setNumber:n.length+1}))}}a=void 0,r=void 0,u=!0}else if(t.hasOutcome)o="has outcome";else{if(r)return{sets:n,scoreString:i,winningSide:r,matchUpStatus:a,updated:!1,message:"matchUp is complete"};if(s===oo){const e=n[n.length-1]||{},{side1Score:a,side2Score:o}=e,s=a>o?1:o>a?2:void 0;!s||r||t.isIncompleteSetScore||(n[n.length-1].winningSide=s,n.push({setNumber:n.length+1}),i+=" ",u=!0)}else if(s===uo&&void 0!==n[l].side1Score&&void 0===n[l].side2Score&&i&&t.isNumericEnding)i+="-",n[l].side2Score=0,a=void 0,r=void 0,u=!0;else if(!isNaN(s)){let t;if(void 0===n[l].side2Score){const e=parseInt((n[l].side1Score||0).toString()+s).toString().slice(0,2);n[l].side1Score=parseInt(e),t=n[l].side1Score.toString(),u=!0}else{const e=parseInt((n[l].side2Score||0).toString()+s).toString().slice(0,2);n[l].side2Score=parseInt(e),t=[n[l].side1Score,n[l].side2Score].join("-"),u=!0}if(u){const e=(n.slice(0,l)||[]).filter((t=>t)).map((t=>{const{side1Score:e,side2Score:i}=t;return[e,i].join("-")})).join(" ");i=e?e+" "+t:t}}}return{sets:n,scoreString:i,winningSide:r,matchUpStatus:a,message:o,updated:u}}({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:o,winningSide:a,value:i}));else if(ao.includes(i))f.finalSetIsComplete||a?l="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?l="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i}):({sets:r,scoreString:n,matchUpStatus:o,winningSide:a,updated:d}=Po({lowSide:e,sets:r,scoreString:n,matchUpStatus:o,winningSide:a,value:i}));else if(i===ro)d=!0,({scoreString:n,sets:r}=So({analysis:f,scoreString:n,sets:r,lowSide:e,auto:u})),n||(r=[]),o=void 0,a=void 0;else if(f.hasOutcome)l="has outcome";else if(i!==uo||f.isMatchTiebreakEntry)if(i===lo&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?l="existing joiner":f.isNumericEnding&&(d=!0,n+=lo);else if([uo,lo].includes(i))l="invalid location for joiner";else{if(a)return{updated:!1,message:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:d}=function({analysis:t,scoreString:e,sets:i,value:n}){let r;if(null==i||!i.length)return{sets:[]};const a=i[i.length-1];n=parseInt(n);const{validSide2Score:o,requiresTiebreak:s}=function({analysis:t,set:e={},value:i}){const n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=n,{side1Score:s}=e;let c,u;return c=r&&r<a?s===r?i<=a:i<=r:s===a?o?i<a:i<=a+1:s===a-1?o?i<=a:i<=a+1:s===a+1?i===a||i===a-1:i<=a,c&&(u=r&&r<a?s===a&&i===r||s===r&&i===a:s>=a&&i>=a&&s!==i),{validSide2Score:c,requiresTiebreak:u}}({analysis:t,set:a,value:n});if(o){r=!0,e=(e||"")+n,a.side2Score=n;const o=Va({analysis:t,set:i[i.length-1]});a.winningSide=o||void 0,s?e+=to.split("")[0]:t.isDecidingSet||(e+=Wa)}return{sets:i,scoreString:e,updated:r}}({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)l="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)l="invalid set tiebreak character";else if(f.isTiebreakCloser){const t=f.isSetTiebreakEntry?to:eo,e=t.split("").reverse()[0],i=t.split("")[0],a=r[r.length-1],{tiebreakFormat:o}=f.setFormat,{tiebreakTo:s,NoAD:c}=o||{},u=Ha({set:a});if(!f.isTiebreakSet){const t=parseInt(n.split(i).reverse()[0]),e=Uo({lowValue:t,tiebreakTo:s,NoAD:c});1===u?(a.side1TiebreakScore=e,a.side2TiebreakScore=t):(a.side1TiebreakScore=t,a.side2TiebreakScore=e)}n=(n||"")+e,f.isDecidingSet||(n+=Wa);const l=Va({analysis:f,set:a});a.winningSide=l||void 0,d=!0}else if(f.isTiebreakSetValue)({message:l,scoreString:n,sets:r,updated:d}=function({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){let o,s;const{tiebreakSet:{tiebreakTo:c,NoAD:u}}=t.setFormat,[d]=eo.split("");if(t.isMatchTiebreakEntry||(n+=d),r[t.setNumber-1]){var l;const{lastOpenBracketIndex:t}=bo({scoreString:n,brackets:eo}),d=(n.slice(t+1)+(e?"":a)).split(lo);if(((null===(l=d[i-1])||void 0===l?void 0:l.length)||0)>=2)s="tiebreak digit limit";else if(e){1===i&&(d[0]=(d[0]||"")+a),2===i&&(d[1]=(d[1]||"")+a);const e=[d[0]||0,d[1]||0].map((t=>parseInt(t))),s=1===i?1:0;e[s]=e[1-s]+(u?1:2),e[s]<c&&(e[s]=c);const l=r[r.length-1];l.side1TiebreakScore=e[0],l.side2TiebreakScore=e[1],n=n.slice(0,t+1),n+=e.join(lo),o=!0}else{const t=[d[0]||0,d[1]||0].map((t=>parseInt(t))),e=r[r.length-1];e.side1TiebreakScore=t[0],e.side2TiebreakScore=t[1],n+=a,o=!0}}else{const t=Uo({lowValue:parseInt(a||0),tiebreakTo:c,NoAD:u}),e=[parseInt(a),t];2===i&&e.reverse();const s={side1TiebreakScore:e[0],side2TiebreakScore:e[1],setNumber:(null==r?void 0:r.length)+1||1};r.push(s),n+=e.join(lo),o=!0}return{message:s,scoreString:n,sets:r,updated:o}}({analysis:f,auto:u,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){const[t]=to.split(""),e=Math.max(...at(t,n.split(""))),r=n.slice(e+1),a=r&&0===parseInt(r),o=parseInt(r?r+i:i),{tiebreakFormat:s}=f.setFormat,{tiebreakTo:c,NoAD:u}=s||{};!a&&r.length<2?u&&o>c-1?l="invalid low value for NoAD tiebreak":(d=!0,n=(n||"")+i):l=a?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)l=`invalid key: ${i}`;else if(f.isGameScoreEntry)l="game scoreString entry";else if(f.lastSetIsComplete||!r.length){var g,v;d=!0;const{scoreString:t,set:a}=function({analysis:t,lowSide:e,scoreString:i,value:n}){const{setTo:r,tiebreakAt:a,NoAD:o}=t.setFormat,s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};const c=s?n+1:n+1===r?n+(o?1:2):r,u=[n,c];2===e&&u.reverse();const d=to.split("")[0];i=(i||"")+(u.join(uo)+(s?d:Wa));const l={side1Score:u[0],side2Score:u[1]},p=Va({analysis:t,set:l});return l.winningSide=p||void 0,{scoreString:i,set:l}}({analysis:f,lowSide:e,scoreString:n,value:parseInt(i)});a&&(a.setNumber=(null===(g=r)||void 0===g?void 0:g.length)+1||1),r=(null===(v=r)||void 0===v?void 0:v.concat(a).filter(Boolean))||[a],n=t||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(d=!0,({scoreString:n,sets:r}=So({analysis:f,scoreString:n,sets:r,lowSide:e,auto:u})),o=void 0);if(d){var y;r=null===(y=r)||void 0===y?void 0:y.filter(Boolean);const{matchUpWinningSide:t}=No({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=t,!t||o&&![x,A].includes(o)?!n||a||[$a,Ja,Xa].includes(o)||(o=void 0):(o="COMPLETED",r=r.filter((t=>{const{side1Score:e,side2Score:i,side1TiebreakScore:n,side2TiebreakScore:r}=t;return e||i||n||r}))),{updated:d,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,message:l}}return{updated:d,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,message:l}},analyzeSet:Mo};const ko=[{ioc:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso:"AD",label:"Andorra",phone:"376"},{ioc:"UAE",iso:"AE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso:"AF",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso:"AG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso:"AI",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso:"AL",label:"Albania",phone:"355"},{ioc:"ARM",iso:"AM",label:"Armenia",phone:"374"},{ioc:"ANG",iso:"AO",label:"Angola",phone:"244"},{ioc:"",iso:"AQ",label:"Antarctica",phone:"672"},{ioc:"ARG",iso:"AR",label:"Argentina",phone:"54"},{ioc:"ASA",iso:"AS",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso:"AT",label:"Austria",phone:"43"},{ioc:"AUS",iso:"AU",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso:"AW",label:"Aruba",phone:"297"},{ioc:"",iso:"AX",label:"Alland Islands",phone:"358"},{ioc:"AZE",iso:"AZ",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso:"BA",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso:"BB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso:"BD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso:"BE",label:"Belgium",phone:"32"},{ioc:"BUR",iso:"BF",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso:"BG",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso:"BH",label:"Bahrain",phone:"973"},{ioc:"BDI",iso:"BI",label:"Burundi",phone:"257"},{ioc:"BEN",iso:"BJ",label:"Benin",phone:"229"},{ioc:"",iso:"BL",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso:"BM",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso:"BN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso:"BO",label:"Bolivia",phone:"591"},{ioc:"BRA",iso:"BR",label:"Brazil",phone:"55"},{ioc:"BAH",iso:"BS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso:"BT",label:"Bhutan",phone:"975"},{ioc:"",iso:"BV",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso:"BW",label:"Botswana",phone:"267"},{ioc:"BLR",iso:"BY",label:"Belarus",phone:"375"},{ioc:"BIZ",iso:"BZ",label:"Belize",phone:"501"},{ioc:"CAN",iso:"CA",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso:"CC",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso:"CD",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso:"CF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso:"CG",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso:"CH",label:"Switzerland",phone:"41"},{ioc:"CIV",iso:"CI",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso:"CK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso:"CL",label:"Chile",phone:"56"},{ioc:"CMR",iso:"CM",label:"Cameroon",phone:"237"},{ioc:"CHN",iso:"CN",label:"China",phone:"86"},{ioc:"COL",iso:"CO",label:"Colombia",phone:"57"},{ioc:"CRC",iso:"CR",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso:"CU",label:"Cuba",phone:"53"},{ioc:"CPV",iso:"CV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso:"CW",label:"Curacao",phone:"599"},{ioc:"CXR",iso:"CX",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso:"CY",label:"Cyprus",phone:"357"},{ioc:"CZE",iso:"CZ",label:"Czech Republic",phone:"420"},{ioc:"GER",iso:"DE",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso:"DJ",label:"Djibouti",phone:"253"},{ioc:"DEN",iso:"DK",label:"Denmark",phone:"45"},{ioc:"DMA",iso:"DM",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso:"DO",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso:"DZ",label:"Algeria",phone:"213"},{ioc:"ECU",iso:"EC",label:"Ecuador",phone:"593"},{ioc:"EST",iso:"EE",label:"Estonia",phone:"372"},{ioc:"EGY",iso:"EG",label:"Egypt",phone:"20"},{ioc:"",iso:"EH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso:"ER",label:"Eritrea",phone:"291"},{ioc:"ESP",iso:"ES",label:"Spain",phone:"34"},{ioc:"ETH",iso:"ET",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso:"FI",label:"Finland",phone:"358"},{ioc:"FIJ",iso:"FJ",label:"Fiji",phone:"679"},{ioc:"FLK",iso:"FK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso:"FM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso:"FO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso:"FR",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso:"GA",label:"Gabon",phone:"241"},{ioc:"GBR",iso:"GB",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso:"GD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso:"GE",label:"Georgia",phone:"995"},{ioc:"FGU",iso:"GF",label:"French Guiana",phone:"594"},{ioc:"",iso:"GG",label:"Guernsey",phone:"44"},{ioc:"",iso:"GH",label:"Ghana",phone:"233"},{ioc:"GIB",iso:"GI",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso:"GL",label:"Greenland",phone:"299"},{ioc:"GAM",iso:"GM",label:"Gambia",phone:"220"},{ioc:"GUI",iso:"GN",label:"Guinea",phone:"224"},{ioc:"GUD",iso:"GP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso:"GQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso:"GR",label:"Greece",phone:"30"},{ioc:"",iso:"GS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso:"GT",label:"Guatemala",phone:"502"},{ioc:"GUM",iso:"GU",label:"Guam",phone:"1-671"},{ioc:"GBS",iso:"GW",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso:"GY",label:"Guyana",phone:"592"},{ioc:"HKG",iso:"HK",label:"Hong Kong",phone:"852"},{ioc:"",iso:"HM",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso:"HN",label:"Honduras",phone:"504"},{ioc:"CRO",iso:"HR",label:"Croatia",phone:"385"},{ioc:"HAI",iso:"HT",label:"Haiti",phone:"509"},{ioc:"HUN",iso:"HU",label:"Hungary",phone:"36"},{ioc:"INA",iso:"ID",label:"Indonesia",phone:"62"},{ioc:"IRL",iso:"IE",label:"Ireland",phone:"353"},{ioc:"ISR",iso:"IL",label:"Israel",phone:"972"},{ioc:"",iso:"IM",label:"Isle of Man",phone:"44"},{ioc:"IND",iso:"IN",label:"India",phone:"91"},{ioc:"",iso:"IO",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso:"IQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso:"IR",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso:"IS",label:"Iceland",phone:"354"},{ioc:"ITA",iso:"IT",label:"Italy",phone:"39"},{ioc:"",iso:"JE",label:"Jersey",phone:"44"},{ioc:"JAM",iso:"JM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso:"JO",label:"Jordan",phone:"962"},{ioc:"JPN",iso:"JP",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso:"KE",label:"Kenya",phone:"254"},{ioc:"KGZ",iso:"KG",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso:"KH",label:"Cambodia",phone:"855"},{ioc:"KIR",iso:"KI",label:"Kiribati",phone:"686"},{ioc:"COM",iso:"KM",label:"Comoros",phone:"269"},{ioc:"SKN",iso:"KN",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso:"KP",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso:"KR",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso:"KW",label:"Kuwait",phone:"965"},{ioc:"CAY",iso:"KY",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso:"KZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso:"LA",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso:"LB",label:"Lebanon",phone:"961"},{ioc:"LCA",iso:"LC",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso:"LI",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso:"LK",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso:"LR",label:"Liberia",phone:"231"},{ioc:"LES",iso:"LS",label:"Lesotho",phone:"266"},{ioc:"LTU",iso:"LT",label:"Lithuania",phone:"370"},{ioc:"LUX",iso:"LU",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso:"LV",label:"Latvia",phone:"371"},{ioc:"LBA",iso:"LY",label:"Libya",phone:"218"},{ioc:"MAR",iso:"MA",label:"Morocco",phone:"212"},{ioc:"MON",iso:"MC",label:"Monaco",phone:"377"},{ioc:"MDA",iso:"MD",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso:"ME",label:"Montenegro",phone:"382"},{ioc:"",iso:"MF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso:"MG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso:"MH",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso:"MK",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso:"ML",label:"Mali",phone:"223"},{ioc:"MYA",iso:"MM",label:"Myanmar",phone:"95"},{ioc:"MGL",iso:"MN",label:"Mongolia",phone:"976"},{ioc:"MAC",iso:"MO",label:"Macao",phone:"853"},{ioc:"NMA",iso:"MP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso:"MQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso:"MR",label:"Mauritania",phone:"222"},{ioc:"MNT",iso:"MS",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso:"MT",label:"Malta",phone:"356"},{ioc:"MRI",iso:"MU",label:"Mauritius",phone:"230"},{ioc:"MDV",iso:"MV",label:"Maldives",phone:"960"},{ioc:"MAW",iso:"MW",label:"Malawi",phone:"265"},{ioc:"MEX",iso:"MX",label:"Mexico",phone:"52"},{ioc:"MAS",iso:"MY",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso:"MZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso:"NA",label:"Namibia",phone:"264"},{ioc:"NCL",iso:"NC",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso:"NE",label:"Niger",phone:"227"},{ioc:"NFI",iso:"NF",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso:"NG",label:"Nigeria",phone:"234"},{ioc:"NCA",iso:"NI",label:"Nicaragua",phone:"505"},{ioc:"NED",iso:"NL",label:"Netherlands",phone:"31"},{ioc:"NOR",iso:"NO",label:"Norway",phone:"47"},{ioc:"NEP",iso:"NP",label:"Nepal",phone:"977"},{ioc:"NRU",iso:"NR",label:"Nauru",phone:"674"},{ioc:"NIU",iso:"NU",label:"Niue",phone:"683"},{ioc:"NZL",iso:"NZ",label:"New Zealand",phone:"64"},{ioc:"OMA",iso:"OM",label:"Oman",phone:"968"},{ioc:"PAN",iso:"PA",label:"Panama",phone:"507"},{ioc:"PER",iso:"PE",label:"Peru",phone:"51"},{ioc:"FPO",iso:"PF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso:"PG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso:"PH",label:"Philippines",phone:"63"},{ioc:"PAK",iso:"PK",label:"Pakistan",phone:"92"},{ioc:"POL",iso:"PL",label:"Poland",phone:"48"},{ioc:"SPM",iso:"PM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso:"PN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso:"PR",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso:"PS",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso:"PT",label:"Portugal",phone:"351"},{ioc:"PlW",iso:"PW",label:"Palau",phone:"680"},{ioc:"PAR",iso:"PY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso:"QA",label:"Qatar",phone:"974"},{ioc:"REU",iso:"RE",label:"Reunion",phone:"262"},{ioc:"ROU",iso:"RO",label:"Romania",phone:"40"},{ioc:"SRB",iso:"RS",label:"Serbia",phone:"381"},{ioc:"RUS",iso:"RU",label:"Russia",phone:"7"},{ioc:"RWA",iso:"RW",label:"Rwanda",phone:"250"},{ioc:"KSA",iso:"SA",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso:"SB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso:"SC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso:"SD",label:"Sudan",phone:"249"},{ioc:"SWE",iso:"SE",label:"Sweden",phone:"46"},{ioc:"SIN",iso:"SG",label:"Singapore",phone:"65"},{ioc:"HEL",iso:"SH",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso:"SI",label:"Slovenia",phone:"386"},{ioc:"",iso:"SJ",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso:"SK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso:"SL",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso:"SM",label:"San Marino",phone:"378"},{ioc:"SEN",iso:"SN",label:"Senegal",phone:"221"},{ioc:"SOM",iso:"SO",label:"Somalia",phone:"252"},{ioc:"SUR",iso:"SR",label:"Suriname",phone:"597"},{ioc:"",iso:"SS",label:"South Sudan",phone:"211"},{ioc:"STP",iso:"ST",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso:"SV",label:"El Salvador",phone:"503"},{ioc:"",iso:"SX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso:"SY",label:"Syria",phone:"963"},{ioc:"",iso:"SZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso:"TC",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso:"TD",label:"Chad",phone:"235"},{ioc:"",iso:"TF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso:"TG",label:"Togo",phone:"228"},{ioc:"THA",iso:"TH",label:"Thailand",phone:"66"},{ioc:"TJK",iso:"TJ",label:"Tajikistan",phone:"992"},{ioc:"",iso:"TK",label:"Tokelau",phone:"690"},{ioc:"TLS",iso:"TL",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso:"TM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso:"TN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso:"TO",label:"Tonga",phone:"676"},{ioc:"TUR",iso:"TR",label:"Turkey",phone:"90"},{ioc:"TTO",iso:"TT",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso:"TV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso:"TW",label:"Taiwan",phone:"886"},{ioc:"TAN",iso:"TZ",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso:"UA",label:"Ukraine",phone:"380"},{ioc:"UGA",iso:"UG",label:"Uganda",phone:"256"},{ioc:"USA",iso:"US",label:"United States",phone:"1",suggested:!0},{ioc:"URU",iso:"UY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso:"UZ",label:"Uzbekistan",phone:"998"},{ioc:"",iso:"VA",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso:"VC",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso:"VE",label:"Venezuela",phone:"58"},{ioc:"IVB",iso:"VG",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso:"VI",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso:"VN",label:"Vietnam",phone:"84"},{ioc:"VAN",iso:"VU",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso:"WF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso:"WS",label:"Samoa",phone:"685"},{ioc:"KOS",iso:"XK",label:"Kosovo",phone:"383"},{ioc:"YEM",iso:"YE",label:"Yemen",phone:"967"},{ioc:"MAY",iso:"YT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso:"ZA",label:"South Africa",phone:"27"},{ioc:"ZAM",iso:"ZM",label:"Zambia",phone:"260"},{ioc:"ZIM",iso:"ZW",label:"Zimbabwe",phone:"263"}];const Oo="MAIN",Lo="QUALIFYING",_o="CONSOLATION",Fo="VOLUNTARY_CONSOLATION",jo="PLAY_OFF",Bo=[Oo,Lo,_o,jo,Fo],Vo={[Lo]:1,[Oo]:2,[jo]:3,[_o]:3,[Fo]:4},Go="CLUSTER",Ho="WATERFALL",Wo="ITEM",qo="CONTAINER",zo="DRAW",Ko="RANDOM",Yo="TOP_DOWN",Jo="BOTTOM_UP",$o="POSITION",Zo="WINNER",Xo="LOSER",Qo="FIRST_MATCHUP",ts="AD_HOC",es="FEED IN",is="COMPASS",ns="OLYMPIC",rs="SINGLE_ELIMINATION",as="DOUBLE_ELIMINATION",os="FIRST_MATCH_LOSER_CONSOLATION",ss="FIRST_ROUND_LOSER_CONSOLATION",cs="CURTIS_CONSOLATION",us="FEED_IN_CHAMPIONSHIP_TO_SF",ds="FEED_IN_CHAMPIONSHIP_TO_SF",ls="FEED_IN_CHAMPIONSHIP_TO_QF",ps="FEED_IN_CHAMPIONSHIP_TO_QF",hs="FEED_IN_CHAMPIONSHIP_TO_R16",fs="FEED_IN_CHAMPIONSHIP_TO_R16",ms="MODIFIED_FEED_IN_CHAMPIONSHIP",gs="MODIFIED_FEED_IN_CHAMPIONSHIP",vs="FEED_IN_CHAMPIONSHIP",ys="ROUND_ROBIN",Is="ROUND_ROBIN_WITH_PLAYOFF",ws="DECIDER",Ss="BACKDRAW",bs={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-3":{name:"NORTHEAST",abbreviation:"NE"},"0-1-1":{name:"SOUTH",abbreviation:"S"},"0-1-2":{name:"SOUTHWEST",abbreviation:"SW"},"0-2-1":{name:"NORTHWEST",abbreviation:"NW"},"0-1-1-1":{name:"SOUTHEAST",abbreviation:"SE"}},Us={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-1-1":{name:"SOUTH",abbreviation:"S"}},Ns="WIN_RATIO",Ps="ROUND_OUTCOME",Es=[es,is,jo,ns,cs,us,ls,hs,os,ss,gs,fs,ps,ds,vs,Is],Ds={MAIN:Oo,QUALIFYING:Lo,CONSOLATION:_o,ITEM:Wo,CONTAINER:qo,FIRST_MATCHUP:Qo,WINNER:Zo,LOSER:Xo,AD_HOC:ts,FEED_IN:es,COMPASS:is,PLAY_OFF:jo,OLYMPIC:ns,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:rs,DOUBLE_ELIMINATION:as,CURTIS:cs,FICSF:us,FICQF:ls,FICR16:hs,MFIC:ms,FIRST_MATCH_LOSER_CONSOLATION:os,FIRST_ROUND_LOSER_CONSOLATION:ss,MODIFIED_FEED_IN_CHAMPIONSHIP:gs,FEED_IN_CHAMPIONSHIP_TO_R16:fs,FEED_IN_CHAMPIONSHIP_TO_QF:ps,FEED_IN_CHAMPIONSHIP_TO_SF:ds,FEED_IN_CHAMPIONSHIP:vs,ROUND_ROBIN_WITH_PLAYOFF:Is,ROUND_ROBIN:ys,DECIDER:ws,BACKDRAW:Ss,COMPASS_ATTRIBUTES:bs,OLYMPIC_ATTRIBUTES:Us,DRAW:zo,RANDOM:Ko,TOP_DOWN:Yo,BOTTOM_UP:Jo,WATERFALL:Ho,WIN_RATIO:Ns,ROUND_OUTCOME:Ps,MULTI_STRUCTURE_DRAWS:Es,generatedDrawTypes:[ts,is,cs,as,ps,fs,ds,vs,es,os,ss,gs,ns,jo,ys,Is,rs]},As="removeDrawPositionAssignment",Ts="assignDrawPosition",Cs="addPenalty",Ms="ALTERNATE",xs="WITHDRAW",Rs="ASSIGN",ks="REMOVE",Os="LUCKY",Ls="SWAP",_s="NICKNAME",Fs="SEED_VALUE",js="PENALTY",Bs="BYE",Vs={ALTERNATE_PARTICIPANT:Ms,WITHDRAW_PARTICIPANT:xs,ASSIGN_PARTICIPANT:Rs,LUCKY_PARTICIPANT:Os,REMOVE_ASSIGNMENT:ks,SWAP_PARTICIPANTS:Ls,ADD_NICKNAME:_s,ADD_PENALTY:js,ASSIGN_BYE:Bs,SEED_VALUE:Fs},Gs={[er]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Lo,Oo],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[Fs,_s,js],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1}},Hs={[ir]:{policyName:"Round Naming Default",roundNamingMap:{1:"F",2:"SF",4:"QF"},affixes:{roundNumber:"R",preFeedRound:"Q"},stageConstants:{[Oo]:"",[jo]:"P",[Lo]:"Q",[_o]:"C"}}},Ws={[or]:{policyName:"USTA",seedingProfile:"SEPARATE",duplicateSeedNumbers:!0,drawSizeProgression:!0,validSeedPositions:{ignore:!0},seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function qs({courtDate:t,includeBookingTypes:e=[]}){const i=[];let n=kn(t.startTime);(t.bookings||[]).filter((t=>!t.bookingType||!e.includes(t.bookingType))).sort(((t,e)=>Tn(t.startTime).localeCompare(Tn(e.startTime)))).forEach((t=>{const e={startTime:Cn(n.toISOString()),endTime:t.startTime};kn(t.startTime)>n&&i.push(e),kn(t.endTime)>n&&(n=kn(t.endTime))}));const r={startTime:Cn(n.toISOString()),endTime:t.endTime};return kn(t.endTime)>n&&i.push(r),i}function zs({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:i,periodEndTime:n,periodLength:r,date:a}){function o(t){const r=kn(t.startTime),a=kn(t.endTime);if(r>i)return!1;if(a<n)return!1;return On(i,a)>=e}return{sameDate:t=>!t.date||jn(t.date,a),enoughTime:e=>!!qs({courtDate:e,periodLength:r,includeBookingTypes:t}).filter(o).length}}function Ks({includeBookingTypes:t,averageMatchUpMinutes:e,periodLength:i,periodStart:n,courts:r,date:a}){const o=kn(n),s=_n(o,e),{sameDate:c,enoughTime:u}=zs({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:o,periodEndTime:s,periodLength:i,date:a});return{availableToScheduleCount:r.filter((t=>!!(Array.isArray(t.dateAvailability)&&t.dateAvailability.filter(c).filter(u)).length)).length}}function Ys({remainingScheduleTimes:t=[],clearScheduleDates:e,periodLength:i=30,bookings:n=[],scheduleDate:r,courts:a=[]}){if(!Array.isArray(a)||!a.length)return{error:_i,courts:a};if(!Array.isArray(n))return{error:Me};if(!In(r))return{error:ke};e&&(Array.isArray(e)?e.includes(r)&&(n=[]):n=[]);const{courtBookings:o,unassignedBookings:s}=n.reduce(((t,e)=>{const{courtId:i}=e;return i?t.courtBookings[i]?t.courtBookings[i].push(e):t.courtBookings[i]=[e]:t.unassignedBookings.push(e),t}),{courtBookings:{},unassignedBookings:[]}),{sameDate:c}=zs({date:r}),u=a.map((({courtId:e,dateAvailability:i},n)=>{const r=o[e]||[],a=i.find(c)||{},{date:s,startTime:u,endTime:d,bookings:l=[]}=a;return{courtId:e,dateAvailability:{date:s,startTime:u,endTime:d,bookings:[t[n]&&{startTime:u,endTime:t[n]},...Vn(l,!1,!0),...r].filter(Boolean)}}}));s.sort(((t,e)=>An(t.startTime)-An(e.startTime)));for(const d of s){const{startTime:t,endTime:e,averageMinutes:n,recoveryMinutes:r,matchUpId:a}=d,o=An(t),s=An(e),c=u.map((t=>{const e=qs({courtDate:t.dateAvailability});return{courtId:t.courtId,timeSlots:e}})).flat().reduce(((t,{courtId:e,timeSlots:n})=>{let r;return n.find((({startTime:e,endTime:n})=>{r=An(e)-o;const a=o>=An(e);return s<=An(n)&&0!==t.startDifference&&((0===r||r+i>=0)&&(void 0===t.startDifference||r<t.startDifference)||a)}))?{courtId:e,startDifference:r}:t}),{courtId:void 0,startDifference:void 0});if(c.courtId){const i={averageMinutes:n,recoveryMinutes:r,matchUpId:a,startTime:t,endTime:e};u.find((({courtId:t})=>t===c.courtId)).dateAvailability.bookings.push(i)}else console.log({unassignedBooking:d})}return{virtualCourts:u.map((({courtId:t,dateAvailability:e})=>({courtId:t,dateAvailability:[e]})))}}function Js({startTime:t="8:00",endTime:e="20:30",count:i=10,date:n}={}){return rt(0,i).map((()=>({dateAvailability:[{date:n,startTime:t,endTime:e}]})))}function $s({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,averageMatchUpMinutes:i=90,date:n=wn(),clearScheduleDates:r,periodLength:a=30,startTime:o="08:00",endTime:s="19:00",courtsCount:c,bookings:u,courts:d}={}){n=Mn(n),o=Cn(o),s=Cn(s);let l=0,p=0,h=0,f=0,m=0;!d&&c&&(d=Js({startTime:o,endTime:s,count:c,date:n}));const{virtualCourts:g}=Ys({remainingScheduleTimes:e,scheduleDate:n,clearScheduleDates:r,periodLength:a,bookings:u,courts:d}),{firstTimeSlotStartTime:v}=function({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){const{sameDate:a}=zs({date:r});let o;if(e&&i){const r=kn(e),s=kn(i);n.every((e=>!!Array.isArray(e.dateAvailability)&&e.dateAvailability.filter(a).find((e=>qs({courtDate:e}).find((e=>{const i=kn(e.startTime),n=kn(e.endTime);if(i>s||i<r)return!1;if(n<r)return!1;const a=On(i,n)>=t;if(a){const t=Cn(i.toISOString());(!o||t<o)&&(o=t)}return a}))))))}return{firstTimeSlotStartTime:o}}({averageMinutes:i,courts:g,startTime:o,endTime:s,date:n});t&&v&&(o=v||o);const y=An(o),I=An(s)-y,w=rt(0,Math.floor(I/a)+1).map((t=>{const e=function(t){let e=Math.floor(t/60);const i=t-60*e;return e>23&&(e%=24),[Fn(e),Fn(i)].join(":")}(y+t*a),{availableToScheduleCount:r}=Ks({courts:g,averageMatchUpMinutes:i,periodLength:a,periodStart:e,period:t,date:n}),o=r>p?r-p:0;m+=t?r:0;const s=t?m/t:r,c=t?a*s/i*(t-1)+s:s,u=r?p?c-l:o:0;l=c,p=r,h+=u;const d=parseInt(h)-f;return f+=d,{periodStart:e,add:d,availableToScheduleCount:r,newCourts:o,totalMatchUps:f}}));return{scheduleTimes:w.reduce(((t,e)=>t.concat(...rt(0,e.add).map((()=>({scheduleTime:e.periodStart}))))),[]).flat(),timingProfile:w,totalMatchUps:f}}const Zs={getCourtsAvailableAtPeriodStart:Ks,generateTimeSlots:qs,getScheduleTimes:$s,courtGenerator:Js};function Xs(t,e,i=[]){return"object"==typeof t&&Object.keys(t).reduce(((n,r)=>"object"!=typeof t[r]?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,Xs(t[r],e,i.concat(r)))),{})}function Qs({element:t,itemType:e,itemSubTypes:i,returnPreviousValues:n}){if(!t)return{error:Ae};if(!Array.isArray(t.timeItems))return{error:Ai};const r=t.timeItems.filter((t=>(null==t?void 0:t.itemType)===e)).filter((t=>{var e;return!(null!=i&&i.length)||(null==t||null===(e=t.itemSubTypes)||void 0===e?void 0:e.includes(i))})).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))),a=r.pop();if(a){const t={timeItem:a,...dt};return n&&Object.assign(t,{previousItems:r}),t}return{message:Gi}}function tc({event:t,itemType:e,itemSubTypes:i,returnPreviousValues:n}){if(!t)return{error:zt};if(!t.timeItems)return{message:Gi};const{timeItem:r,previousItems:a,message:o}=Qs({element:t,itemType:e,itemSubTypes:i,returnPreviousValues:n});return r&&{timeItem:r,previousItems:a}||{message:o}}function ec({element:t,timeItem:e,duplicateValues:i=!0}){if(!t)return{error:Ae};if(!e)return{error:Di};const n=e&&Object.keys(e),r=["itemType","itemValue"];if(!(r.filter((t=>n.includes(t))).length===r.length))return{error:Ei};if(t.timeItems){const{itemType:n,itemSubTypes:r,itemValue:a}=e,{timeItem:o}=Qs({element:t,itemType:n,itemSubTypes:r});if(JSON.stringify(null==o?void 0:o.itemValue)===JSON.stringify(a)&&!i)return dt}else t.timeItems=[];e.itemSubTypes&&!e.itemSubTypes.length&&delete e.itemSubTypes;const a=(new Date).toISOString();return Object.assign(e,{createdAt:a}),t.timeItems.push(e),dt}function ic({tournamentRecord:t,duplicateValues:e,participantId:i,timeItem:n}){if(!t)return{error:ft};if(!i)return{error:Ye};const r=na({tournamentRecord:t,participantId:i});return r.error?r:ec({element:r.participant,duplicateValues:e,timeItem:n})}function nc({tournamentRecord:t,duplicateValues:e,timeItem:i}){return t?ec({element:t,timeItem:i,duplicateValues:e}):{error:ft}}function rc({event:t,timeItem:e,duplicateValues:i}){return t?ec({element:t,timeItem:e,duplicateValues:i}):{error:Kt}}const ac="addDrawDefinition",oc="addMatchUps",sc="addParticipants",cc="addVenue",uc="audit",dc="deletedDrawIds",lc="deleteParticipants",pc="deleteVenue",hc="deletedMatchUpIds",fc="modifyDrawDefinition",mc="modifyMatchUp",gc="modifyParticipants",vc="modifyVenue",yc="publishEvent",Ic={ADD_DRAW_DEFINITION:ac,ADD_MATCHUPS:oc,ADD_PARTICIPANTS:sc,ADD_VENUE:cc,AUDIT:uc,DELETED_DRAW_IDS:dc,DELETE_PARTICIPANTS:lc,DELETE_VENUE:pc,DELETED_MATCHUP_IDS:hc,MODIFY_DRAW_DEFINITION:fc,MODIFY_MATCHUP:mc,MODIFY_PARTICIPANTS:gc,MODIFY_VENUE:vc,PUBLISH_EVENT:yc};function wc(t,e){var i;if(!t)return;let n=Date.now();n===t.updatedAt&&(n+=1);const r=null==e?void 0:e.filter(Boolean);t.updatedAt=n,null===(i=t.structures)||void 0===i||i.forEach((t=>{(null==r||!r.length||null!=r&&r.includes(t.structureId))&&(t.updatedAt=n)}))}function Sc({drawDefinition:t,matchUps:e}){wc(t),en({topic:oc,payload:{matchUps:e}})}function bc({drawDefinition:t,matchUpIds:e,action:i}){wc(t),en({topic:hc,payload:{action:i,matchUpIds:e}})}function Uc({drawDefinition:t,matchUp:e}){Pc({drawDefinition:t,structureIds:[e.structureId]}),en({topic:mc,payload:{matchUp:e},key:e.matchUpId})}function Nc({drawDefinition:t}){wc(t),en({topic:ac,payload:{drawDefinition:t},key:t.drawId})}function Pc({drawDefinition:t,structureIds:e}){wc(t,e),en({topic:fc,payload:{drawDefinition:t},key:t.drawId})}function Ec({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){if(!t&&!e)return{error:ft};if(!Array.isArray(i)||i.length>2)return{error:He};if(!i.length)return{error:Xe};const n=(t=t||(null==e?void 0:e.participants)||[]).filter((t=>t.participantType===Oa&&ot(i,t.individualParticipantIds).length===i.length&&t.individualParticipantIds.length===i.length)),r=n[0];if(!r)return{error:Je};const a=Vn(n.slice(1));return{participant:Vn(r),duplicatedPairParticipants:a,...dt}}function Dc({drawDefinition:t,participantId:e}){if("object"!=typeof t)return{error:yt};if("string"!=typeof e)return{error:Ye};const{extension:i}=ra({element:t,name:Gr});return{lineUp:((null==i?void 0:i.value)||{})[e]}}const Ac=t=>e=>t[e],Tc=(t=[])=>t.map(Rc).filter(Boolean),Cc=(t=[])=>t.map(Mc).filter(Boolean),Mc=(t={})=>Ac(t)("participantId"),xc=(t={})=>Ac(t)("drawPosition"),Rc=(t={})=>Ac(t)("matchUpId");function kc({drawDefinition:t}){if(!t)return{error:yt};const e=(t.extensions||[]).find((t=>t.name===Lr));return{appliedPolicies:(null==e?void 0:e.value)||{}}}function Oc({matchUps:t=[]}){const e=t.reduce(((t,e)=>!e.roundNumber||t.includes(e.roundNumber)?t:t.concat(parseInt(e.roundNumber))),[]).sort(Wn).map((e=>{const i=t.filter((t=>t.roundNumber===e)),n=i.find((({matchUpType:t})=>t===la))?i.filter((({matchUpType:t})=>t===la)):i;return{[e]:n.sort(((t,e)=>Wn(t.roundPosition,e.roundPosition)))}})),i=t.reduce(((t,e)=>(t[e.roundNumber]||(t[e.roundNumber]=e.finishingRound),t)),{}),n=Object.assign({},...e),r=Object.assign({},...Object.keys(n).map((t=>{var e;return{[t]:{matchUpsCount:null===(e=n[t])||void 0===e?void 0:e.length}}})));let a=0,o=0;return Object.keys(n).map((t=>parseInt(t))).filter((t=>!isNaN(t))).forEach((t=>{const e=n[t].sort(((t,e)=>t.roundPosition-e.roundPosition)),s=e.map((t=>(null==t?void 0:t.drawPositions)||[])).flat();if(1!==t&&r[t-1]){const i=r[t-1].drawPositions,n=i.length/s.length,a=ct(i,n),o=e.map((e=>{const{roundPosition:n,drawPositions:r}=e;if(!n)return r;const o=(null==r?void 0:r.filter(Boolean))||[];if(null==o||!o.length)return[void 0,void 0];if(t<3&&2===(null==o?void 0:o.length))return null==r?void 0:r.slice().sort(Wn);if(null!=o&&o.length&&ot(i,o).length!==(null==o?void 0:o.length))return 1===(null==o?void 0:o.length)?[o[0],void 0]:null==r?void 0:r.slice().sort(Wn);const s=2*(n-1);return a.slice(s,s+2).map((t=>null==r?void 0:r.find((e=>t.includes(e)))))}));r[t].drawPositions=null==o?void 0:o.flat(),r[t].pairedDrawPositions=o}else{const e=s.sort(Wn),i=ct(e,2);r[t].drawPositions=e,r[t].pairedDrawPositions=i}r[t].finishingRound=i[t],r[t].finishingPositionRange=n[t][0].finishingPositionRange,r[t+1]&&r[t+1].matchUpsCount===r[t].matchUpsCount&&(r[t+1].feedRound=!0,r[t+1].feedRoundIndex=o,r[t].preFeedRound=!0,o+=1),r[t]&&!r[t].feedRound&&(r[t].roundIndex=a,a+=1)})),{roundMatchUps:n,roundProfile:r}}function Lc({drawDefinition:t,structure:e}){const i={},n=[];return((null==t?void 0:t.structures)||[e]).filter((t=>t&&"object"==typeof t)).forEach((t=>{const{structureId:e,matchUps:r,structures:a}=t,o=Array.isArray(a);if(o)o&&a.forEach((t=>{const{structureName:r}=t,a=t.matchUps;i[t.structureId]={matchUps:a,structureName:r},n.push(...a),a.forEach((t=>{n.push(t),t.tieMatchUps&&n.push(...t.tieMatchUps)})),i[e]||(i[e]={}),i[e].itemStructureIds||(i[e].itemStructureIds=[]),i[e].itemStructureIds.push(t.structureId)}));else{const t=r;i[e]={matchUps:t},t.forEach((t=>{n.push(t),t.tieMatchUps&&n.push(...t.tieMatchUps)}))}})),{mappedMatchUps:i,drawMatchUps:n}}function _c({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){let r=(t=(null==e?void 0:e.mappedMatchUps)||t)[i];const a=((null==r?void 0:r.itemStructureIds)||[]).map((e=>{const{matchUps:i,structureName:r}=t[e];return n?i.map((t=>Object.assign(Vn(t,!0,!0),{structureId:e,structureName:r}))):i})).flat();return((null==r?void 0:r.matchUps)||[]).concat(...a)}function Fc(t,e){var i,n;return(Vo[null==t?void 0:t.stage]||0)-(Vo[null==e?void 0:e.stage]||0)||((null==e||null===(i=e.positionAssignments)||void 0===i?void 0:i.length)||9999)-((null==t||null===(n=t.positionAssignments)||void 0===n?void 0:n.length)||9999)||((null==t?void 0:t.stageSequence)||0)-((null==e?void 0:e.stageSequence)||0)}function jc({drawDefinition:t,structureId:e}){if(!t)return{error:yt};if(!e)return{error:Vt};const{structures:i}=Bc({drawDefinition:t}),n=i.map((t=>t.structures?[].concat(...t.structures,t):t)).flat().find((t=>t.structureId===e));return n?{structure:n}:{error:Gt}}function Bc({stage:t,stageSequence:e,drawDefinition:i}){var n;const r=i?i.structures?void 0:Ht:yt;if(r)return{error:r};return{structures:null===(n=i.structures)||void 0===n?void 0:n.filter((function(e){return!t||e.stage===t})).filter((function(t){return!e||t.stageSequence===e})).sort(Fc)}}function Vc(t){if(!t||"object"!=typeof t)return!1;if("string"!=typeof t.name)return!1;const e=Object.keys(t),i=["name","value"];return i.filter((t=>e.includes(t))).length===i.length}function Gc({element:t,extension:e}={}){if(!t)return{error:Ae};if("object"!=typeof t)return{error:_i};if(!Vc(e))return{error:_i};t.extensions||(t.extensions=[]);const i=(new Date).toISOString();Object.assign(e,{createdAt:i});const n=t.extensions.find((({name:t})=>t===e.name));return n?n.value=e.value:e.value&&t.extensions.push(e),{...dt}}function Hc({element:t,name:e}={}){return t?"object"!=typeof t?{error:_i}:e?t.extensions?(t.extensions=t.extensions.filter((t=>(null==t?void 0:t.name)!==e)),{...dt}):{...dt,message:Gi}:{error:Ae,message:"Missing name"}:{error:Ae}}function Wc({tournamentRecord:t,extension:e}={}){return t?Gc({element:t,extension:e}):{error:ft}}function qc({drawDefinition:t,extension:e}={}){return t?Gc({element:t,extension:e}):{error:wt}}function zc({event:t,extension:e}={}){return t?Gc({element:t,extension:e}):{error:zt}}function Kc({tournamentRecord:t,name:e}={}){return t?Hc({element:t,name:e}):{error:ft}}function Yc({event:t,name:e}={}){return t?Hc({element:t,name:e}):{error:Kt}}function Jc({drawDefinition:t,attributes:e}){var i;let{extension:n}=sa({drawDefinition:t,name:jr});const r=(null===(i=n)||void 0===i?void 0:i.value)||t.entryProfile||{};return e.forEach((t=>{Object.keys(t).forEach((e=>{r[e]?Object.assign(r[e],t[e]):r[e]=t[e]}))})),n={name:jr,value:r},qc({drawDefinition:t,extension:n}),{entryProfile:r}}var $c;!function(t){t.CONFIRMED="CONFIRMED",t.DIRECT_ACCEPTANCE="DIRECT_ACCEPTANCE",t.ORGANISER_ACCEPTANCE="ORGANISER_ACCEPTANCE",t.ALTERNATE="ALTERNATE",t.WITHDRAWN="WITHDRAWN",t.UNPAIRED="UNPAIRED",t.UNGROUPED="UNGROUPED",t.LUCKY_LOSER="LUCKY_LOSER",t.FEED_IN="FEED_IN",t.QUALIFIER="QUALIFIER",t.WILDCARD="WILDCARD"}($c||($c={}));var Zc=$c.ALTERNATE,Xc=$c.FEED_IN,Qc=$c.QUALIFIER,tu=$c.WILDCARD,eu=$c.DIRECT_ACCEPTANCE,iu=$c.CONFIRMED,nu=$c.LUCKY_LOSER,ru=$c.ORGANISER_ACCEPTANCE,au=$c.WITHDRAWN,ou=$c.UNPAIRED,su=$c.UNGROUPED,cu=[iu,eu,ru],uu=[nu,Xc,Qc,tu],du=[Xc,Qc,nu,tu,iu,eu,ru],lu=[Zc,au,Xc,ou,su,Qc,tu,eu,iu,nu,ru],pu={FEED_IN:Xc,WILDCARD:tu,UNPAIRED:ou,UNGROUPED:su,ALTERNATE:Zc,CONFIRMED:iu,QUALIFIER:Qc,WITHDRAWN:au,LUCKY_LOSER:nu,DIRECT_ACCEPTANCE:eu,ORGANISER_ACCEPTANCE:ru,DRAW_SPECIFIC_STATUSES:uu,EQUIVALENT_ACCEPTANCE_STATUSES:cu,VALID_ENTERED_TYPES:lu,VALID_ENTRY_STATUSES:lu,STRUCTURE_ENTERED_TYPES:du,STRUCTURE_SELECTED_STATUSES:du};function hu({drawDefinition:t}){let{extension:e}=sa({name:jr,drawDefinition:t});return{entryProfile:(null==e?void 0:e.value)||t.entryProfile||{}}}function fu({stage:t,drawDefinition:e}){return Boolean(mu({stage:t,drawDefinition:e})&&gu({stage:t,drawDefinition:e}))}function mu({stage:t,drawDefinition:e}){const{entryProfile:i}=hu({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&Bo.includes(t)){return Jc({drawDefinition:e,attributes:[{[t]:{drawSize:void 0,alternates:!0}}]}),!0}return n}function gu({stage:t,drawDefinition:e}){var i;const{entryProfile:n}=hu({drawDefinition:e});return n&&(null===(i=n[t])||void 0===i?void 0:i.drawSize)||0}function vu({stage:t,drawDefinition:e}){var i;const{entryProfile:n}=hu({drawDefinition:e});return n&&(null===(i=n[t])||void 0===i?void 0:i.qualifiersCount)||0}function yu({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce(((e,n)=>n.entryStage===t&&n.entryStatus===i?e+1:e),0)}function Iu({drawDefinition:t,stageSequence:e,entryStatuses:i,structureId:n,stages:r,stage:a}){var o;const s=(null===(o=t.entries)||void 0===o?void 0:o.reduce(((t,n)=>{const o=a&&n.entryStage===a||(null==r?void 0:r.length)&&r.includes(n.entryStage),s=!i||i.includes(n.entryStatus),c=n.stageSequence||1;return o&&(!e||c===e)&&s?t.concat(n):t}),[]))||[];return n&&!s.length?function({drawDefinition:t,structureId:e}){const i=[],n=(t.links||[]).find((t=>t.linkType===$o&&t.target.structureId===e));if(n){const{finishingPositions:e,structureId:r}=n.source,{structure:a}=jc({drawDefinition:t,structureId:r});if(a.structureType===qo){(a.structures||[]).forEach((t=>{const{positionAssignments:n}=t,{structureId:r}=t,a=r,o=Object.assign({},...n.map((t=>{var e;const{participantId:i}=t,n=null===(e=ra({element:t,name:$r}).extension)||void 0===e?void 0:e.value;return n?{[i]:n}:void 0})).filter(Boolean));Object.keys(o).filter((t=>{const i=o[t];return e.includes(i.groupOrder)})).forEach((t=>{const n=o[t],{groupOrder:r,GEMscore:s}=n,c=e.sort().indexOf(r)+1;i.push({GEMscore:s,groupingValue:a,participantId:t,placementGroup:c,entryStage:jo,entryStatus:Xc})}))}))}}return i}({drawDefinition:t,structureId:n}):s}function wu({stage:t,drawDefinition:e}){return yu({entryStatus:eu,drawDefinition:e,stage:t})}function Su({stage:t,drawDefinition:e}){return yu({entryStatus:tu,drawDefinition:e,stage:t})}function bu({entryStatus:t=eu,drawDefinition:e,stage:i}){if(t===Zc)return function({stage:t,drawDefinition:e}){var i;const{entryProfile:n}=hu({drawDefinition:e});return(null===(i=n[t])||void 0===i?void 0:i.alternates)||0}({stage:i,drawDefinition:e})?Object.assign({positionsAvailable:1/0},dt):{error:di};const n=function({stage:t,drawDefinition:e}){const i=gu({stage:t,drawDefinition:e}),n=vu({drawDefinition:e,stage:t});return i&&i-n}({drawDefinition:e,stage:i}),r=function({stage:t,drawDefinition:e}){const{entryProfile:i}=hu({drawDefinition:e});return i[t].wildcardsCount||0}({stage:i,drawDefinition:e}),a=yu({entryStatus:tu,drawDefinition:e,stage:i}),o=a+yu({entryStatus:eu,drawDefinition:e,stage:i}),s=n-o;return o>=n?{error:pi}:t===tu?a<r?dt:{error:pi}:Object.assign({positionsAvailable:s},dt)}function Uu({drawDefinition:t,structureId:e,structure:i}){var n,r;let a,o=[];if(i||({structure:i,error:a}=jc({drawDefinition:t,structureId:e})),!i)return{seedAssignments:[],error:Gt};e||(e=i.structureId);const{stage:s,stageSequence:c}=i;if(!a){if(s===jo&&t){o=Iu({drawDefinition:t,stageSequence:c,structureId:e,stage:s}).filter((t=>1===t.placementGroup)).sort(((t,e)=>t.GEMscore<e.GEMscore?1:t.GEMscore>e.GEMscore?-1:0)).map(((t,e)=>({participantId:t.participantId,seedNumber:e+1,seedValue:e+1,seedProxy:!0})))}else i.seedAssignments?o=i.seedAssignments:a=Lt}return{seedAssignments:o,seedLimit:i.seedLimit||(null===(n=i)||void 0===n||null===(r=n.positionAssignments)||void 0===r?void 0:r.length),stage:s,stageSequence:c,error:a}}function Nu({groupedOrder:t,roundPositionsCount:e}){if(!t||(null==t?void 0:t.length)<=e)return t;const i=ct(t,t.length/e).map((t=>t.reduce(((t,e)=>t+e)))),n=i.slice().sort(Wn);return i.map((t=>n.indexOf(t)+1))}function Pu(t){if(!Array.isArray(t))return"";const e=t.filter(z);if(!e.length)return"";return X([Math.min(...e),Math.max(...e)]).join("-")}function Eu({structure:t,drawDefinition:e,structureId:i}){let n,r=[];if(!t){if(!e)return{positionAssignments:r,error:yt};if(({structure:t,error:n}=jc({drawDefinition:e,structureId:i})),n)return{positionAssignments:r,error:n}}return t.structures?r=[].concat(...t.structures.map((t=>Eu({structure:t}).positionAssignments))):t.positionAssignments?r=t.positionAssignments:n=ee,{positionAssignments:r,error:n}}function Du({structure:t,drawDefinition:e,structureId:i}){const{positionAssignments:n}=Eu({structure:t,drawDefinition:e,structureId:i}),r=n.filter((t=>t.participantId||t.bye||t.qualifier)),a=n.length===r.length,o=n.filter((t=>!t.participantId&&!t.bye&&!t.qualifier));return{byePositions:n.filter((t=>!t.participantId&&t.bye)),assignedPositions:r,qualifierPositions:n.filter((t=>!t.participantId&&t.qualifier)),unassignedPositions:o,positionAssignments:n,allPositionsAssigned:a}}function Au({drawPositions:t,roundProfile:e,roundNumber:i}){const n=[void 0,void 0];if(t.reduce(((t,e)=>isNaN(parseInt(e))&&t),!0))return{orderedDrawPositions:n,displayOrder:n};const r=e[i],a=(null==r?void 0:r.pairedDrawPositions.find((e=>st(e||[],t.filter(Boolean)))))||n,o=null==r?void 0:r.feedRound;if(function(t){return t.reduce(((t,e)=>!isNaN(parseInt(e))&&t),!0)}(t)){const e=t.sort(Wn);return{orderedDrawPositions:e,displayOrder:o?e:a}}if(o){const e=[t.find((t=>!isNaN(parseInt(t)))),void 0];return{orderedDrawPositions:e,displayOrder:e}}return{orderedDrawPositions:a,displayOrder:a}}function Tu({matchUp:t}){let e,i=[],n=[],r=[],a=[];if(t||(e=me),t&&!t.sides&&(e=ge),t&&!t.hasContext&&(e=Ti),!e){i=t.sides.map((t=>t.participantId));const e=t.sides.filter((t=>t.participantType===Ra)).map((t=>t.participantId)).filter(Boolean);a=t.sides.map((t=>t.participant&&t.participant.individualParticipants)).filter(Boolean).map((t=>t.map((t=>null==t?void 0:t.participantId)).filter(Boolean))),n=[].concat(...e,...a.flat()).filter(Boolean),r=X(n.concat(i)).filter(Boolean)}return{error:e,sideParticipantIds:i,individualParticipantIds:n,allRelevantParticipantIds:r,nestedIndividualParticipantIds:a}}function Cu({matchUp:t}){if(!t)return{error:me};if(!t.hasContext)return{error:Ti};if(!t.sides||2!==t.sides.filter(Boolean).length)return{error:ge};const{sideParticipantIds:e,nestedIndividualParticipantIds:i,allRelevantParticipantIds:n}=Tu({matchUp:t}),r=(t.timeItems||[]).filter((t=>[lr,pr].includes(null==t?void 0:t.itemType))).sort(((t,e)=>new Date(t.createdAt)-new Date(e.createdAt))),a=r.map((t=>t.itemValue)).filter((t=>r.filter((e=>(null==e?void 0:e.itemValue)===t)).reverse()[0].itemType===lr));i.forEach(((t,i)=>{const n=e[i],r=(null==t?void 0:t.length)&&t.reduce(((t,e)=>t&&e&&a.includes(e)),!0);n&&r&&!a.includes(n)&&a.push(n)})),e.forEach(((t,e)=>{a.includes(t)&&(i[e]||[]).forEach((t=>{t&&!a.includes(t)&&a.push(t)}))}));return{allParticipantsCheckedIn:e.reduce(((t,e)=>a.includes(e)&&t),!0),checkedInParticipantIds:a,allRelevantParticipantIds:n}}function Mu(t){const{matchUps:e,isCollectionMatchUp:i,matchUpStatuses:n,matchUpFormats:r,matchUpFormat:a,collectionIds:o,isMatchUpTie:s,matchUpTypes:c,roundNumbers:u,matchUpIds:d,scheduledDates:l,scheduledDate:p,processContext:h,tournamentIds:f,structureIds:m,courtIds:g,eventIds:v,venueIds:y,drawIds:I,stages:w,filterMatchUpIds:S=!0,filterMatchUpTypes:b=!0}=t,U=Array.isArray(n)?n.filter(Boolean):[],N=Array.isArray(w)?w.filter(Boolean):[],P=Array.isArray(o)?o.filter(Boolean):[],E=Array.isArray(u)?u.filter(Boolean):[],D=Array.isArray(d)&&S?d.filter(Boolean):[],A=Array.isArray(c)&&b?c.filter(Boolean):[],T=Array.isArray(g)?g.filter(Boolean):[],C=Array.isArray(y)?y.filter(Boolean):[],M=Array.isArray(r)?r.filter(Boolean):"string"==typeof a?[a]:[],x=Array.isArray(l)?l.filter(Boolean):"string"==typeof p&&p.length?[p]:[],R=Array.isArray(f)?f.filter(Boolean):[],k=Array.isArray(v)?v.filter(Boolean):[],O=Array.isArray(I)?I.filter(Boolean):[],L=Array.isArray(m)?m.filter(Boolean):[];return e.filter((t=>{if(void 0!==s){if(s&&!t.tieMatchUps)return!1;if(!s&&t.tieMatchUps)return!1}if(void 0!==i){if(i&&!t.collectionId)return!1;if(!i&&t.collectionId)return!1}if(N.length&&!N.includes(t.stage))return!1;if(P.length&&!P.includes(t.collectionId))return!1;if(E.length&&!u.includes(t.roundNumber))return!1;if(U.length&&!U.includes(t.matchUpStatus))return!1;if(D.length&&!D.includes(t.matchUpId))return!1;if(A.length&&!A.includes(t.matchUpType))return!1;if(M.length&&!M.includes(t.matchUpFormat))return!1;if(null!=x&&x.length){const{scheduledTime:e}=ba({matchUp:t}),{scheduledDate:i}=Ua({matchUp:t}),n=Mn(e)||i;if(!x.find((t=>jn(t,n))))return!1}if(T.length){const{courtId:e}=Na({matchUp:t});if(!g.filter(Boolean).includes(e))return!1}if(C.length){const{venueId:e}=Pa({matchUp:t});if(!y.filter(Boolean).includes(e))return!1}if(h){if(R.length&&!R.includes(t.tournamentId))return!1;if(k.length&&!k.includes(t.eventId))return!1;if(O.length&&!O.includes(t.drawId))return!1;if(L.length&&!L.includes(t.structureId))return!1}return!0}))}function xu({drawPositionCollectionAssignment:t,positionAssignments:e,displaySideNumber:i,seedAssignments:n,drawPosition:r,isFeedRound:a,sideNumber:o}){var s,c,u;const d=e.find((t=>t.drawPosition===r)),l=t?null===(s=t[r])||void 0===s?void 0:s.participantId:null==d?void 0:d.participantId,p=d?function({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){const a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){const t=function({seedAssignments:t,participantId:e}){return t.find((t=>!t.seedProxy&&t.participantId===e))}({seedAssignments:e,participantId:i});Object.assign(a,t,{participantId:i})}else n.bye?Object.assign(a,{bye:!0}):n.qualifier&&Object.assign(a,{qualifier:!0});return a}({displaySideNumber:i,seedAssignments:n,participantId:l,assignment:d,sideNumber:o}):{};a&&(1===o?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0}));const h=null==t||null===(c=t[r])||void 0===c?void 0:c.teamParticipant,f=null==t||null===(u=t[r])||void 0===u?void 0:u.participant;return f&&Object.assign(p,{participant:f}),h&&Object.assign(p,{teamParticipant:h}),p}function Ru({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:i,policyDefinitions:n,seedAssignments:r,drawDefinition:a,contextFilters:o,contextProfile:s,matchUpFilters:c,scheduleTiming:u,context:d={},matchUpsMap:l,roundFilter:p,structure:h,inContext:f,event:m}){var g,v,y,I,w;let b={},U={};if(!h)return{matchUps:[],collectionPositionMatchUps:b,roundMatchUps:U,error:Wt};const N=Array.isArray(null==c?void 0:c.eventIds)?c.eventIds.filter(Boolean):[],P=Array.isArray(null==c?void 0:c.structureIds)?c.structureIds.filter(Boolean):[],E=Array.isArray(null==c?void 0:c.drawIds)?c.drawIds.filter(Boolean):[],D=!(null!=d&&d.eventId)||!N.length&&!(null!=o&&null!==(g=o.eventIds)&&void 0!==g&&g.filter(Boolean).length)||N.includes(d.eventId)||(null==o||null===(v=o.eventIds)||void 0===v?void 0:v.includes(d.eventId)),A=!P.length||P.includes(h.structureId),T=!a||!E.length||E.includes(a.drawId);if(!D||!A||!T)return{matchUps:[],collectionPositionMatchUps:b,roundMatchUps:U};const{appliedPolicies:C}=kc({drawDefinition:a}),M=Object.assign({},e,C,n),x=null==M||null===(y=M.scoring)||void 0===y?void 0:y.structures,R=(null==x?void 0:x.stage)&&(null==x?void 0:x.stage[h.stage]),k=(null==R?void 0:R.stageSequence)&&R.stageSequence[h.stageSequence],O=(null==M||null===(I=M.scoring)||void 0===I?void 0:I.requireAllPositionsAssigned)||(null==R?void 0:R.requireAllPositionsAssigned)||(null==k?void 0:k.requireAllPositionsAssigned);l||(l=Lc({drawDefinition:a,structure:h}));const{positionAssignments:L,allPositionsAssigned:_}=Du({structure:h}),F=!O||_,{seedAssignments:j}=Uu({drawDefinition:a,matchUpsMap:l,structure:h});r=r||j;const{structureId:B,structureName:V,stage:G,stageSequence:H,exitProfile:W}=h,{drawId:q,drawName:z}=a||{},K=h.structures;let Y=_c({matchUpsMap:l,structureId:B,inContext:f});const J=M&&M.roundNaming,{roundNamingProfile:$,roundProfile:Z}=function({roundNamingPolicy:t,structure:e,matchUps:i}){const n={},r=e.structures,{roundProfile:a}=Oc({matchUps:i}),{structureAbbreviation:o,stage:s}=e,c=Hs.roundNaming,u=(null==t?void 0:t.roundNamingMap)||c.roundNamingMap,d=(null==t?void 0:t.affixes)||c.affixes,l=s&&s!==Oo&&s[0],p=null==t?void 0:t.stageConstants,h=p&&p[s]||l;return r?Object.assign(n,...Object.keys(a).map((t=>({[t]:`R${t}`})))):Object.assign(n,...Object.keys(a).map((t=>{const{matchUpsCount:e,preFeedRound:i}=a[t],n=2*e,r=u[e]||`${d.roundNumber}${n}`;r||console.log({roundNamingMap:u,matchUpsCount:e});const s=i?`-${d.preFeedRound}`:"";return{[t]:[h,o,`${r}${s}`].filter(Boolean).join("-")}}))),{roundNamingProfile:n,roundProfile:a}}({roundNamingPolicy:J,drawDefinition:a,structure:h,matchUps:Y});if(c&&(Y=Mu({matchUps:Y,...c,filterMatchUpTypes:!1,filterMatchUpIds:!1})),f){var Q;const{sourceDrawPositionRanges:e}=function({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:yt};if(!e)return{error:Vt};const{structure:n}=jc({drawDefinition:t,structureId:e});if(n.stage!==_o)return{message:"Structure is not CONSOLATION stage"};const{links:r}=t,a=(null==r?void 0:r.filter((t=>t.target.structureId===e)))||[],o=(null==a?void 0:a.reduce(((t,e)=>{const{structureId:i}=e.source;return t.includes(i)?t:t.concat(i)}),[]))||[],s=Object.assign({},...o.map((t=>{const e=_c({matchUpsMap:i,structureId:t}),{roundProfile:n}=Oc({matchUps:e});return{[t]:n}}))),c=_c({matchUpsMap:i,structureId:e}),{roundProfile:u}=Oc({matchUps:c}),d={};return null==a||a.forEach((t=>{const{structureId:e,roundNumber:i}=t.source,{feedProfile:n,groupedOrder:r,positionInterleave:a,roundNumber:o}=t.target,c=s[e],l=c[1]&&c[1].drawPositions,p=c[i],h=null==p?void 0:p.matchUpsCount;if(!h)return;const f=h?l.length/h:0,m=l.length/f;let g=l.slice();const v=Nu({groupedOrder:r,roundPositionsCount:g.length}),y=(null==v?void 0:v.length)||1;if(y<=m){const t=ct(g,l.length/y);n===Jo&&t.forEach((t=>t.reverse())),g=(null==v?void 0:v.length)&&(null==v?void 0:v.map((e=>t[e-1])).flat())||g}let I=ct(g,f);if(null!=v&&v.length||n===Jo&&I.reverse(),a){const t=rt(0,a.interleave).map((()=>{})),e=rt(0,a.offset).map((()=>{}));I=I.map((e=>[e,...t])),I.unshift(e),I=I.flat(1);const i=I.length-a.offset;I=I.slice(0,i)}d[o]||(d[o]={});const w=u[o],S=null!=w&&w.feedRound?2:1;I.forEach(((t,e)=>{const i=1+e*S;d[o][i]||(d[o][i]=Pu(t))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:a,matchUpsMap:l,structureId:B}),{drawPositionsRanges:i}=function({drawDefinition:t,structureId:e,matchUpsMap:i}){var n;if(!t)return{error:yt};if(!e)return{error:Vt};const r=_c({matchUpsMap:i,structureId:e}),{roundProfile:a}=Oc({matchUps:r}),o=(Math.min(...(null===(n=a[1])||void 0===n?void 0:n.drawPositions)||[])||1)-1,s=Object.keys(a);return{drawPositionsRanges:Object.assign({},...(s||[]).map((t=>{var e;const{matchUpsCount:i}=a[t],n=(null===(e=a[1])||void 0===e?void 0:e.drawPositions)||[],r=ct(n,n.length/i),c=r.map(Pu),u=r.map((t=>t.map((t=>t-o)))).map(Pu),d=s.map((e=>{if(e>t)return;const{drawPositions:n}=a[e];return ct(n,n.length/i)})).filter(Boolean),l=rt(0,i).map((t=>d.map((e=>e[t])).flat().filter(Boolean).sort(Wn))).map((t=>X(t))),p=l.map((t=>{return(e=t,e.reduce(((t,e)=>{const i=t[t.length-1];return i&&i[i.length-1]===e-1||t.push([]),t[t.length-1].push(e),t}),[])).map(Pu).join(", ");var e})),h=Object.assign({},...rt(0,i).map((t=>({[t+1]:{firstRoundDrawPositionsRange:c[t],firstRoundOffsetDrawPositionsRange:u[t],possibleDrawPositions:l[t],drawPositionsRange:p[t]}}))));return{[t]:h}})))}}({drawDefinition:a,matchUpsMap:l,structureId:B});Y=Y.map((n=>et({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,drawPositionsRanges:i,roundNamingProfile:$,appliedPolicies:M,isRoundRobin:K,roundProfile:Z,matchUp:n,event:m})));(null===(Q=Y)||void 0===Q?void 0:Q.filter((t=>Array.isArray(t.tieMatchUps)))).forEach((t=>{const e=t.tieMatchUps;Y=Y.concat(...e)})),o&&(Y=Mu({processContext:!0,...o,matchUps:Y}))}else{var tt;(null===(tt=Y)||void 0===tt?void 0:tt.filter((t=>Array.isArray(t.tieMatchUps)))).forEach((t=>{const e=t.tieMatchUps;Y=Y.concat(...e)}))}return(null!=c&&c.matchUpTypes||null!=c&&c.matchUpIds)&&(Y=Mu({matchUpTypes:c.matchUpTypes,matchUpIds:c.matchUpIds,matchUps:Y})),({roundMatchUps:U}=Oc({matchUps:Y})),({collectionPositionMatchUps:b}=function({matchUps:t}){const e=t.reduce(((t,e)=>!e.collectionPosition||t.includes(e.collectionPosition)?t:t.concat(e.collectionPosition)),[]).map((e=>({[e]:t.filter((t=>t.collectionPosition===e))})));return{collectionPositionMatchUps:Object.assign({},...e)}}({matchUps:Y})),p&&(Y=null===(w=Y)||void 0===w?void 0:w.filter((t=>t.roundNumber===p))),{matchUps:Y,roundMatchUps:U,collectionPositionMatchUps:b};function et({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,additionalContext:n={},drawPositionsRanges:o,roundNamingProfile:c,tieDrawPositions:l,appliedPolicies:p,isCollectionBye:f,matchUpTieId:m,isRoundRobin:g,roundProfile:v,sideLineUps:y,matchUp:I,event:w}){const b=I.tieFormat||h.tieFormat||(null==a?void 0:a.tieFormat)||(null==w?void 0:w.tieFormat),U=null==b?void 0:b.collectionDefinitions,N=I.collectionId&&(null==U?void 0:U.find((t=>t.collectionId===I.collectionId))),P=I.matchUpFormat||I.collectionId?N&&N.matchUpFormat:h.matchUpFormat||(null==a?void 0:a.matchUpFormat)||(null==w?void 0:w.matchUpFormat),E=I.matchUpType||(null==N?void 0:N.matchUpType)||h.matchUpType||(null==a?void 0:a.matchUpType)||(null==w?void 0:w.eventType)!==Aa&&(null==w?void 0:w.eventType),D=f?S:I.matchUpStatus,{schedule:A,endDate:T}=Ca({scheduleVisibilityFilters:t,scheduleTiming:u,matchUpFormat:P,matchUpType:E,matchUp:I,event:w}),C=I.drawPositions||l,{collectionPosition:M,collectionId:x,roundPosition:R}=I,k=I.roundNumber||n.roundNumber,O=function({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],drawDefinition:r,collectionId:a,sideLineUps:o,matchUpType:s}){if(!a||!i)return;const c=(null==n?void 0:n.map((n=>{var c,u,d;const l=null===(c=e.find((t=>t.drawPosition===n)))||void 0===c?void 0:c.participantId,p=null==o?void 0:o.find((t=>(null==t?void 0:t.drawPosition)===n)),h=(null==p?void 0:p.teamParticipant)||(null==t?void 0:t.find((({participantId:t})=>t===l))),f=(null==p?void 0:p.lineUp)||(null===(u=Dc({participantId:l,drawDefinition:r}))||void 0===u?void 0:u.lineUp),m=null==f?void 0:f.filter((t=>t.collectionAssignments.find((t=>t.collectionId===a&&t.collectionPosition===i))));if(s===da||2===(null==m?void 0:m.length)){const e=null==m?void 0:m.map(Mc),{participant:i}=Ec({tournamentParticipants:t,participantIds:e}),r=null==i?void 0:i.participantId;return{[n]:{participantId:r,teamParticipant:h}}}const g=null==m||null===(d=m[0])||void 0===d?void 0:d.participantId;return g&&{[n]:{participantId:g,teamParticipant:h}}})).filter(Boolean))||{};return Object.assign({},...c)}({tournamentParticipants:i,positionAssignments:L,collectionPosition:M,drawDefinition:a,drawPositions:C,collectionId:x,sideLineUps:y,matchUpType:E}),_=c&&c[k]||n.roundName,j=v&&v[k]&&v[k].feedRound,K=o&&o[k],Y=K&&K[R],J=e&&e[k],$=Object.assign({},Gn(d),Gn({matchUpFormat:I.matchUpType!==Aa&&P,tieFormat:I.matchUpType===Aa&&b,endDate:I.endDate||T,drawPositionsRange:Y,structureName:V,stageSequence:H,drawPositions:C,matchUpStatus:D,matchUpTieId:m,matchUpType:E,exitProfile:W,structureId:B,roundNumber:k,feedRound:j,roundName:_,drawName:z,schedule:A,drawId:q,stage:G}),Vn(Gn(I),!0,!0));if(Array.isArray(C)){const{orderedDrawPositions:t,displayOrder:e}=Au({drawPositions:C,roundProfile:v,roundPosition:R,roundNumber:k}),i=v[k]&&v[k].feedRound,n=e[0]!==t[0],a=t.map(((t,e)=>{var a;const o=e+1;return{...xu({drawPositionCollectionAssignment:O,positionAssignments:L,displaySideNumber:n?3-o:o,seedAssignments:r,drawPosition:t,isFeedRound:i,sideNumber:o}),...null===(a=I.sides)||void 0===a?void 0:a.find((t=>t.sideNumber===o)),sourceDrawPositionRange:J&&J[2*(R-1)+e+1]}}));Object.assign($,Vn({sides:a},!0,!0))}if(i&&$.sides&&($.sides.filter(Boolean).forEach((t=>{if(t.participantId){const e=ia({policyDefinitions:p,participantId:t.participantId,tournamentParticipants:i});e&&Object.assign(t,{participant:e})}if(t.participant&&t.participant.individualParticipantIds){const e=t.participant.individualParticipantIds.map((t=>ia({policyDefinitions:p,tournamentParticipants:i,participantId:t})));Object.assign(t.participant,{individualParticipants:e})}})),!$.matchUpType)){const{matchUpType:t}=function({matchUp:t={}}={}){var e;let i=t.matchUpType;if(!i&&null!==(e=t.sides)&&void 0!==e&&e.length){const e=t.sides.find((({participant:t})=>t)),n=null==e?void 0:e.participant,r=null==n?void 0:n.participantType;i=r===Ra?ua:r===Oa?da:r===ka?ka:void 0}return{matchUpType:i}}({matchUp:$});t&&Object.assign($,{matchUpType:t})}if($.tieMatchUps){var Z;const i=$.matchUpStatus===S,n=null===(Z=$.sides)||void 0===Z?void 0:Z.map((({participant:t,drawPosition:e,sideNumber:i,lineUp:n})=>{const r=(null==t?void 0:t.participantType)===Aa&&t;return{teamParticipant:r&&Gn({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participanOthertName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}),drawPosition:e,sideNumber:i,lineUp:n}}));$.tieMatchUps=$.tieMatchUps.map((r=>{const a=$.matchUpId;return et({tieDrawPositions:C,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:n,drawPositionsRanges:o,roundNamingProfile:c,additionalContext:{roundName:_,roundNumber:k},appliedPolicies:p,isCollectionBye:i,matchUpTieId:a,isRoundRobin:g,roundProfile:v,matchUp:r,event:w})}))}const X=$.sides&&2===$.sides.filter((t=>t&&t.participantId)).length,Q=!$.winningSide,tt=F&&X&&Q;if(Object.assign($,{readyToScore:tt,hasContext:!0}),X){const{allParticipantsCheckedIn:t,checkedInParticipantIds:e}=Cu({matchUp:$});Object.assign($,{allParticipantsCheckedIn:t,checkedInParticipantIds:e})}return Array.isArray(null==s?void 0:s.exclude),$}}function ku({tournamentParticipants:t,drawDefinition:e,contextProfile:i,matchUpsMap:n,matchUpId:r,inContext:a,context:o,event:s}){if(!e)return{error:yt};if(!r)return{error:le};if("string"!=typeof r)return{error:_i};const{structures:c}=Bc({drawDefinition:e});for(const u of c){const{matchUps:c}=Ru({tournamentParticipants:t,drawDefinition:e,contextProfile:i,matchUpsMap:n,inContext:a,structure:u,context:o,event:s}),{matchUp:d}=Ma({matchUps:c,matchUpId:r});if(d)return{matchUp:d,structure:u}}return{error:he}}function Ou({duplicateValues:t,drawDefinition:e,disableNotice:i,matchUpId:n,timeItem:r,event:a}){const{matchUp:o}=ku({drawDefinition:e,event:a,matchUpId:n});if(!o)return{error:he};const s=ec({element:o,timeItem:r,duplicateValues:t});return i||Uc({drawDefinition:e,matchUp:o}),s}function Lu({tournamentRecord:t}){if(!t)return{error:ft};const e=Vn(t.venues||[]),i=e.reduce(((t,e)=>{var i;return null!=e&&null!==(i=e.courts)&&void 0!==i&&i.length?t.concat(e.courts):t}),[]);return{venues:e,courts:i}}function _u({tournamentRecord:t,venueId:e}){if(!t)return{error:ft};if(!e)return{error:Si};const i=(t.venues||[]).reduce(((t,i)=>i.venueId===e?i:t),void 0);return i&&{venue:i}||{error:wi}}function Fu({tournamentRecord:t,drawDefinition:e,matchUpId:i,venueId:n,disableNotice:r}){if(!t)return{error:ft};if(!i)return{error:le};if(n){const{error:e}=_u({tournamentRecord:t,venueId:n});if(e)return{error:e}}return Ou({drawDefinition:e,matchUpId:i,timeItem:{itemType:fr,itemValue:n},disableNotice:r,duplicateValues:!1})}function ju({tournamentRecord:t,courtId:e}){if(!t)return{error:ft};if(!e)return{error:De};let i,n;return(t.venues||[]).forEach((t=>{(t.courts||[]).forEach((r=>{r.courtId===e&&(i=r,n=t)}))})),i&&{court:i,venue:n}||{error:vi}}function Bu({tournamentRecord:t,venueId:e,venueIds:i}){if(!t)return{error:ft};return{courts:(t.venues||[]).filter((t=>e?t.venueId===e:i?i.includes(t.venueId):!e&&!i)).map((t=>{const{venueId:e}=t,i=Vn(t.courts||[]);return i.forEach((t=>Object.assign(t,{venueId:e}))),i})).flat()}}function Vu({tournamentRecord:t,drawDefinition:e,courtDayDate:i,matchUpId:n,courtId:r,disableNotice:a}){if(!t)return{error:ft};if(!n)return{error:le};if(r){const{venue:i,error:o}=ju({tournamentRecord:t,courtId:r});if(o)return{error:o};Fu({tournamentRecord:t,drawDefinition:e,matchUpId:n,venueId:null==i?void 0:i.venueId,disableNotice:a})}return Ou({drawDefinition:e,matchUpId:n,timeItem:{itemType:hr,itemDate:i,itemValue:r},disableNotice:a,duplicateValues:!1})}function Gu(t){if(mn.test(t)){const e=Sn(new Date);return new Date(`${e}T${t}`)}return new Date(t)}function Hu(t){return!(void 0!==t&&!vn.test(t))}function Wu({tournamentRecord:t,drawDefinition:e,disableNotice:i,matchUpId:n,schedule:r,event:a}){if(!e)return{error:yt};if(!n)return{error:le};if(!r)return{error:Ae};const{endTime:o,courtId:s,resumeTime:c,scheduledDate:u,scheduledTime:d,startTime:l,stopTime:p,venueId:h}=r;if(void 0!==u){const t=qu({drawDefinition:e,matchUpId:n,scheduledDate:u,disableNotice:!0});if(null!=t&&t.error)return{error:t.error,scheduledDate:u}}if(void 0!==d){const t=zu({drawDefinition:e,matchUpId:n,scheduledTime:d,disableNotice:!0});if(null!=t&&t.error)return{error:t.error,scheduledTime:d}}if(void 0!==l){const t=Yu({disableNotice:!0,drawDefinition:e,matchUpId:n,startTime:l,event:a});if(null!=t&&t.error)return{error:t.error,startTime:l}}if(void 0!==p){const t=$u({disableNotice:!0,drawDefinition:e,matchUpId:n,stopTime:p,event:a});if(null!=t&&t.error)return{error:t.error,stopTime:p}}if(void 0!==c){const t=Zu({disableNotice:!0,drawDefinition:e,resumeTime:c,matchUpId:n,event:a});if(null!=t&&t.error)return{error:t.error,resumeTime:c}}if(void 0!==o){const t=Ju({disableNotice:!0,drawDefinition:e,matchUpId:n,endTime:o,event:a});if(null!=t&&t.error)return{error:t.error,endTime:o}}if(void 0!==s&&void 0!==u){const i=Vu({courtDayDate:u,disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:n,courtId:s,event:a});if(null!=i&&i.error)return{error:i.error,courtId:s}}else if(void 0!==h){const i=Fu({disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:n,venueId:h,event:a});if(null!=i&&i.error)return{error:i.error,venueId:h}}if(!i){const{matchUp:t}=ku({drawDefinition:e,event:a,matchUpId:n});if(!t)return{error:he};Uc({drawDefinition:e,matchUp:t})}return{...dt}}function qu({drawDefinition:t,matchUpId:e,disableNotice:i,scheduledDate:n}){if(!e)return{error:le};const r=gn.test(n);if(n&&!r)return{error:ke};return Ou({drawDefinition:t,matchUpId:e,timeItem:{itemType:mr,itemValue:n},disableNotice:i,duplicateValues:!1})}function zu({drawDefinition:t,matchUpId:e,disableNotice:i,scheduledTime:n}){if(!e)return{error:le};if(!Hu(n))return{error:Oe};return Ou({drawDefinition:t,matchUpId:e,timeItem:{itemType:gr,itemValue:n},disableNotice:i,duplicateValues:!1})}function Ku({drawDefinition:t,matchUpId:e,disableNotice:i,participantId:n,officialType:r}){if(!e)return{error:le};return Ou({drawDefinition:t,matchUpId:e,timeItem:{itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemSubTypes:[r],itemValue:n},disableNotice:i,duplicateValues:!1})}function Yu({drawDefinition:t,disableNotice:e,matchUpId:i,startTime:n,event:r}){if(!i)return{error:le};if(!Hu(n))return{error:Oe};const{matchUp:a}=ku({drawDefinition:t,event:r,matchUpId:i}),o=(a.timeItems||[]).filter((t=>[yr,Ir,wr].includes(null==t?void 0:t.itemType))).map((t=>Gu(t.itemValue))).reduce(((t,e)=>!t||e<t?e:t),void 0);if(!o||Gu(n)<o){a.timeItems&&(a.timeItems=a.timeItems.filter((t=>t.itemType!==vr)));return Ou({drawDefinition:t,matchUpId:i,timeItem:{itemType:vr,itemValue:n},disableNotice:e,duplicateValues:!1})}return{error:Pi}}function Ju({drawDefinition:t,disableNotice:e,matchUpId:i,endTime:n,event:r}){if(!i)return{error:le};if(!Hu(n))return{error:Oe};const{matchUp:a}=ku({drawDefinition:t,event:r,matchUpId:i}),o=(a.timeItems||[]).filter((t=>[vr,Ir,yr].includes(null==t?void 0:t.itemType))).map((t=>Gu(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(!o||Gu(n)>o){a.timeItems&&(a.timeItems=a.timeItems.filter((t=>t.itemType!==wr)));return Ou({drawDefinition:t,matchUpId:i,timeItem:{itemType:wr,itemValue:n},disableNotice:e,duplicateValues:!1})}return{error:bi}}function $u({drawDefinition:t,disableNotice:e,matchUpId:i,stopTime:n,event:r}){if(!i)return{error:le};if(!Hu(n))return{error:Oe};const{matchUp:a}=ku({drawDefinition:t,event:r,matchUpId:i}),o=a.timeItems||[];if(o.reduce(((t,e)=>e.itemType===wr||t),void 0))return{error:Ui};const s=o.filter((t=>[vr,Ir,yr].includes(null==t?void 0:t.itemType))).sort(((t,e)=>Gu(t.itemValue)-Gu(e.itemValue))),c=s[s.length-1],u=c&&c.itemType===yr,d=s.filter((t=>!u||t.createdAt!==c.createdAt)).map((t=>Gu(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(Gu(n)>d){if(a.timeItems&&u){const t=c.createdAt;a.timeItems=a.timeItems.filter((e=>e.createdAt!==t))}return Ou({drawDefinition:t,matchUpId:i,timeItem:{itemType:yr,itemValue:n},disableNotice:e,duplicateValues:!0})}return{error:Ni}}function Zu({drawDefinition:t,disableNotice:e,resumeTime:i,matchUpId:n,event:r}){if(!n)return{error:le};if(!Hu(i))return{error:Oe};const{matchUp:a}=ku({drawDefinition:t,event:r,matchUpId:n}),o=a.timeItems||[];if(o.reduce(((t,e)=>e.itemType===wr||t),void 0))return{error:Ui};const s=o.filter((t=>[vr,Ir,yr].includes(null==t?void 0:t.itemType))).sort(((t,e)=>Gu(t.itemValue)-Gu(e.itemValue))),c=s[s.length-1],u=c&&c.itemType===Ir,d=s.filter((t=>!u||t.createdAt!==c.createdAt)).map((t=>Gu(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(Gu(i)>d){if(a.timeItems&&u){const t=c.createdAt;a.timeItems=a.timeItems.filter((e=>e.createdAt!==t))}return Ou({drawDefinition:t,matchUpId:n,timeItem:{itemType:Ir,itemValue:i},disableNotice:e,duplicateValues:!0})}return{error:"Invalid resumeTime"}}function Xu({participants:t=[]}){const e=Vn(t,!0,!0),i=e.filter((t=>t.participantType===ka)),n=e.filter((t=>t.participantType===La)),r=e.filter((t=>t.participantType===Oa));return e.forEach((t=>{if(t.participantType===Ra){const{participantId:e}=t;t.teams=[],t.teamParticipantIds=[],t.groups=[],t.groupParticipantIds=[],t.pairParticipantIds=[],i.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n!==e||t.teamParticipantIds.includes(i.participantId)||(t.teamParticipantIds.push(i.participantId),t.teams.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId,teamId:i.teamId}))}))})),r.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n!==e||t.pairParticipantIds.includes(i.participantId)||t.pairParticipantIds.push(i.participantId)}))})),n.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n!==e||t.groupParticipantIds.includes(i.participantId)||(t.groupParticipantIds.push(i.participantId),t.groups.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId}))}))}))}})),e}function Qu({drawDefinition:t,inContextDrawMatchUps:e,targetLink:i,sourceRoundPosition:n,sourceRoundMatchUpCount:r}){if(!i)return{error:jt};const{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:u}}=i,{structure:d}=jc({drawDefinition:t,structureId:a}),{positionAssignments:l}=Eu({structure:d}),p=(null==e?void 0:e.filter((t=>t.structureId===d.structureId))).filter((t=>t.roundNumber===c)),h=p.length,f=rt(1,h+1),m=h/r;let g=Math.ceil(m*n),v=1-n%2;if(null!=u&&u.interleave&&.5!==m){const t=n+(u.offset+(n-1)*u.interleave);g=Math.ceil(t/2),v=1-t%2}let y=f,I=f[g-1];const w=Nu({groupedOrder:s,roundPositionsCount:f.length}),S=(null==w?void 0:w.length)||1;if(S<=f.length){const t=ct(f,h/S);o===Jo&&t.forEach((t=>t.reverse())),y=(null==w?void 0:w.length)&&(null==w?void 0:w.map((e=>t[e-1])).flat())||y}o===Yo?I=y[g-1]:o===Jo?((null==w||!w.length||S>f.length)&&(g=p.length+1-g),I=y[g-1]):o===Ko?Xi()&&console.log("not implemented:",{feedProfile:o}):o===zo&&Xi()&&console.log("not implemented:",{feedProfile:o});const b=I&&p.reduce(((t,e)=>e.roundPosition===I?e:t),void 0);let U;var N;null!=b&&b.feedRound?(v=0,U=Math.min(...(b.drawPositions||[]).filter(Boolean))):U=2===(null==b||null===(N=b.drawPositions)||void 0===N?void 0:N.length)&&(null==b?void 0:b.drawPositions[v]);const P=l.find((({drawPosition:t})=>t===U));if(P){const{extension:t}=ra({element:P,name:Fr});if(null!=t&&t.value)return{disabledDrawPosition:U}}return{matchUp:b,targetDrawPosition:U,matchUpDrawPositionIndex:v}}function td({source:t,linkType:e,finishingPositions:i}){return t.reduce(((t,n)=>{var r,a;return(!(null!==(r=n.source)&&void 0!==r&&r.finishingPositions)||!i||st(i,null===(a=n.source)||void 0===a?void 0:a.finishingPositions))&&n.linkType===e?n:t}),void 0)}function ed({drawDefinition:t,structureId:e,roundNumber:i}){if(!t)return{error:yt};if(!e)return{error:Vt};return{links:(t.links||[]).filter(Boolean).reduce(((t,n)=>{var r,a;return(null===(r=n.source)||void 0===r?void 0:r.structureId)!==e||i&&n.source.roundNumber!==i||(t.source=t.source.concat(n)),(null===(a=n.target)||void 0===a?void 0:a.structureId)!==e||i&&n.target.roundNumber!==i||(t.target=t.target.concat(n)),t}),{source:[],target:[]})}}function id({matchUpId:t,drawDefinition:e,inContextDrawMatchUps:i=[],inContextMatchUp:n,useTargetMatchUpIds:r=!1}){let a=n;i.length&&!a&&(a=i.find((e=>e.matchUpId===t)));const{structure:o}=jc({drawDefinition:e,structureId:a.structureId}),{finishingPosition:s}=o;return s===Ps?function({matchUp:t,structure:e,drawDefinition:i,inContextDrawMatchUps:n,useTargetMatchUpIds:r}){const{links:{source:a}}=function({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:yt};if(!i)return{error:Vt};const{links:n}=ed({drawDefinition:t,structureId:i});return{links:{source:n.source.reduce(((t,i)=>i.source.roundNumber&&i.source.roundNumber!==e?t:t.concat(i)),[]),target:n.target.reduce(((t,i)=>i.target.roundNumber&&i.target.roundNumber!==e?t:t.concat(i)),[])}}}({drawDefinition:i,roundNumber:t.roundNumber,structureId:e.structureId}),o=td({source:a,linkType:Zo}),s=td({source:a,linkType:Xo}),{winnerMatchUpId:c,loserMatchUpId:u}=t;let d,l,p,h,f,m,g;r&&(h=c&&n.find((({matchUpId:t})=>t===c)),d=u&&n.find((({matchUpId:t})=>t===u)));if(o&&!h||s&&!d){const{roundPosition:r}=t;g=g||n.filter((t=>t.structureId===e.structureId));const a=g.reduce(((e,i)=>i.roundNumber===t.roundNumber?e+1:e),0);s&&({matchUp:d,matchUpDrawPositionIndex:p,targetDrawPosition:l}=Qu({drawDefinition:i,inContextDrawMatchUps:n,sourceRoundPosition:r,sourceRoundMatchUpCount:a,targetLink:s})),o&&({matchUp:h,matchUpDrawPositionIndex:m,targetDrawPosition:f}=Qu({drawDefinition:i,inContextDrawMatchUps:n,sourceRoundPosition:r,sourceRoundMatchUpCount:a,targetLink:o}))}h||(g=g||n.filter((t=>t.structureId===e.structureId)),({matchUp:h}=function({structureMatchUps:t,matchUp:e}){const{roundNumber:i,roundPosition:n}=e,r=t.filter((t=>t.roundNumber===i)),a=t.filter((t=>t.roundNumber===i+1));if(a.length){let t;return a.length===r.length?t=a.find((t=>t.roundPosition===n)):a.length===r.length/2&&(t=a.find((t=>t.roundPosition===Math.ceil(n/2)))),{matchUp:t}}return{error:"no progression found"}}({structureMatchUps:g,matchUp:t})));return{matchUp:t,targetLinks:{loserTargetLink:s,winnerTargetLink:o},targetMatchUps:{loserMatchUp:d,winnerMatchUp:h,loserTargetDrawPosition:l,winnerTargetDrawPosition:f,loserMatchUpDrawPositionIndex:p,winnerMatchUpDrawPositionIndex:m}}}({drawDefinition:e,inContextDrawMatchUps:i,structure:o,matchUp:a,useTargetMatchUpIds:r}):function({matchUp:t}){return{matchUp:t,targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0}}}({drawDefinition:e,matchUp:a,structure:o})}function nd({drawDefinition:t,inContextDrawMatchUps:e}){const i={};return e.forEach((n=>{const{matchUpId:r,structureId:a,drawPositions:o=[]}=n,{structure:s}=jc({drawDefinition:t,structureId:a});if((null==s?void 0:s.finishingPosition)===Ns){const{roundNumber:t}=n,e=t&&parseInt(t)+1,i=s.matchUps||[],{roundMatchUps:r}=Oc({matchUps:i});if(e&&r[e]){const t=o.sort().map(((t,i)=>{const n=r[e].find((e=>e.drawPositions.includes(t)));return{matchUpId:null==n?void 0:n.matchUpId,roundNumber:e,schedule:null==n?void 0:n.schedule,sideNumber:i+1,structureName:s.structureName}}));Object.assign(n,{sidesTo:t})}}else{var c;const a=id({matchUpId:r,drawDefinition:t,inContextMatchUp:n,inContextDrawMatchUps:e,useTargetMatchUpIds:!0}),{winnerMatchUp:o,loserMatchUp:s}=a.targetMatchUps;!n.winnerMatchUpId&&o&&(n.winnerMatchUpId=o.matchUpId),!n.loserMatchUpId&&s&&(n.loserMatchUpId=s.matchUpId);const m=ad({upcomingMatchUp:o});let g=ad({upcomingMatchUp:s});if(n.matchUpStatus!==S&&(null==s?void 0:s.matchUpStatus)===S){const{matchUp:i}=rd({matchUp:s,drawDefinition:t,inContextDrawMatchUps:e})||{};g=i&&ad({upcomingMatchUp:i})||g}const v=null===(c=n.schedule)||void 0===c?void 0:c.timeAfterRecovery;if(v){var u,d,l;if(null!=m&&null!==(u=m.schedule)&&void 0!==u&&u.scheduledTime){An(m.schedule.scheduledTime)<An(v)&&(i[m.matchUpId]=n.matchUpId,m.schedule.scheduleConflict=n.matchUpId)}if(null!==(d=g)&&void 0!==d&&null!==(l=d.schedule)&&void 0!==l&&l.scheduledTime){An(m.schedule.scheduledTime)<An(v)&&(i[g.matchUpId]=n.matchUpId,g.schedule.scheduleConflict=n.matchUpId)}}if(Object.assign(n,{winnerTo:m,loserTo:g}),n.drawPositions.filter(Boolean).length){var p;const t=null===(p=a.targetLinks)||void 0===p?void 0:p.loserTargetLink,e=(null==t?void 0:t.linkCondition)===Qo,i=(null==(h=n)||null===(f=h.sides)||void 0===f?void 0:f.map((({participant:t,participantId:e,qualifier:i})=>t||e&&{participantId:e}||i&&{qualifier:i})).filter(Boolean))||[];if(i.length){const t=Cc(null==o?void 0:o.sides),n=Cc(null==s?void 0:s.sides),r=i.find((({participantId:e})=>t.includes(e)))?[]:i,a=i.find((({participantId:t})=>n.includes(t)))?[]:i;s&&e&&a.length<2&&a.push({bye:!0,tbd:!0}),null!=r&&r.length&&o&&(o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(r)),null!=a&&a.length&&s&&(s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(a))}}}var h,f})),Object.keys(i).length&&e.forEach((t=>{Object.keys(i).includes(t.matchUpId)&&(t.schedule.scheduleConflict=i[t.matchUpId])})),{scheduleConflictMatchUpIds:i}}function rd({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){const{matchUpId:n,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||(null==t?void 0:t.matchUpStatus)===x)return{matchUp:t};if(r===S){let r;if(t.winnerMatchUpId)r=i.find((({matchUpId:e})=>e===t.winnerMatchUpId));else{const t=id({matchUpId:n,drawDefinition:e,inContextDrawMatchUps:i});({winnerMatchUp:r}=(null==t?void 0:t.targetMatchUps)||{})}return rd({matchUp:r,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function ad({upcomingMatchUp:t}={}){if(t)return(({matchUpId:t,structureId:e,schedule:i,roundNumber:n,roundPosition:r,structureName:a})=>({matchUpId:t,structureId:e,schedule:i,roundNumber:n,roundPosition:r,structureName:a}))(t)}function od({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,policyDefinitions:r,drawDefinition:a,matchUpFilters:o,contextFilters:s,contextProfile:c,scheduleTiming:u,matchUpsMap:d,roundFilter:l,structureId:p,inContext:h,structure:f,context:m,event:g}){!f&&p&&({structure:f}=jc({drawDefinition:a,structureId:p}));const{matchUps:v,error:y}=Ru({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,policyDefinitions:r,drawDefinition:a,matchUpFilters:o,contextFilters:s,contextProfile:c,scheduleTiming:u,matchUpsMap:d,structure:f,inContext:h,context:m,event:g});if(y)return{error:y};const{assignedPositions:w}=Du({structure:f}),S=w.filter((t=>t.participantId)).map((t=>t.drawPosition)),b=[],U=[],N=[],P=[],E=[];return v.filter((t=>{var e;const i=1===(null==o||null===(e=o.matchUpTypes)||void 0===e?void 0:e.length)&&o.matchUpTypes[0]===la;return t.matchUpType===la||!i})).forEach((e=>{var i,n,r;if(e.matchUpStatus===I)return void P.push(e);const a=e.collectionId,o=a&&e.sides.every((t=>t.participantId)),s=e.roundNumber===l,c=!a&&2===(null===(i=e.drawPositions)||void 0===i?void 0:i.filter(Boolean).length),u=!a&&(null===(n=e.drawPositions)||void 0===n?void 0:n.every((t=>S.includes(t)))),d=w.filter((t=>t.bye)).map((t=>t.drawPosition)),p=!a&&(null===(r=e.drawPositions)||void 0===r?void 0:r.find((t=>d.includes(t)))),h=B.includes(e.matchUpStatus)&&(o||c&&(!l||s)&&(!t||u));return p?b.push(e):Yn(e)?E.push(e):h?N.push(e):U.push(e)})),{completedMatchUps:E,upcomingMatchUps:N,pendingMatchUps:U,abandonedMatchUps:P,byeMatchUps:b,structure:f}}function sd(t){if(!t.drawDefinition)return{error:yt};Object.assign(t,{requireParticipants:!1});const{abandonedMatchUps:e,completedMatchUps:i,upcomingMatchUps:n,pendingMatchUps:r,byeMatchUps:a,matchUpsMap:o}=cd(t);return{matchUps:[].concat(...e,...i,...n,...r,...a),matchUpsMap:o}}function cd({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:i,requireParticipants:n,includeByeMatchUps:r,policyDefinitions:a,tournamentRecord:o,drawDefinition:s,matchUpFilters:c,contextFilters:u,contextProfile:d,scheduleTiming:l,nextMatchUps:p,roundFilter:h,matchUpsMap:f,inContext:m,context:g,event:v}){var y,I;if(!s)return{error:yt};let w=[],S=[],b=[],U=[],N=[];i=(null===(y=i)||void 0===y?void 0:y.length)&&i||(null==o?void 0:o.participants),m&&null!==(I=i)&&void 0!==I&&I.length&&(i=Xu({participants:i}));const{structures:P}=Bc({drawDefinition:s});f||(f=Lc({drawDefinition:s})),P.forEach((o=>{const{byeMatchUps:y=[],pendingMatchUps:I,upcomingMatchUps:P,completedMatchUps:E,abandonedMatchUps:D}=od({inContext:m||p,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:i,requireParticipants:n,includeByeMatchUps:r,policyDefinitions:a,drawDefinition:s,matchUpFilters:c,contextFilters:u,contextProfile:d,scheduleTiming:l,matchUpsMap:f,roundFilter:h,structure:o,context:g,event:v});w=w.concat(...D),S=S.concat(...E),b=b.concat(...P),U=U.concat(...I),N=N.concat(...y)}));const E={matchUpsMap:f,byeMatchUps:N,pendingMatchUps:U,upcomingMatchUps:b,abandonedMatchUps:w,completedMatchUps:S,...dt};if(p){const t="object"==typeof p&&p||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:e,completed:i,upcoming:n,pending:r,bye:a}=t,o=[].concat(...e&&E.abandonedMatchUps||[],...i&&E.completedMatchUps||[],...n&&E.upcomingMatchUps||[],...r&&E.pendingMatchUps||[],...a&&E.byeMatchUps||[]);nd({drawDefinition:s,inContextDrawMatchUps:o})}return E}function ud({scheduleVisibilityFilters:t,policyDefinitions:e,tournamentRecord:i,inContext:n=!0,contextProfile:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,context:c}){var u;if(!i)return{error:ft};const d=(null===(u=i.unifiedTournamentId)||void 0===u?void 0:u.tournamentId)||i.tournamentId,l=(null==i?void 0:i.events)||[],p=fd({tournamentRecord:i}),{appliedPolicies:h}=Xr({tournamentRecord:i}),f={...c,tournamentId:d,indoorOutDoor:i.indoorOutDoor,surfaceCategory:i.surfaceCategory,endDate:i.endDate};return{matchUps:l.map((c=>ld({scheduleVisibilityFilters:t,tournamentAppliedPolicies:h,context:f,policyDefinitions:e,tournamentRecord:i,matchUpFilters:a,contextFilters:o,contextProfile:r,nextMatchUps:s,participants:p,inContext:n,event:c}).matchUps)).flat(1/0)}}function dd({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentRecord:i,policyDefinitions:n,matchUpFilters:r,contextFilters:a,drawDefinition:o,contextProfile:s,participants:c,nextMatchUps:u,inContext:d,context:l,event:p}){const{eventId:h,eventName:f,category:m,gender:g,matchUpFormat:v}=p||{};return sd({context:{...l,eventId:h,eventName:f,category:m,gender:g,matchUpFormat:v,indoorOutDoor:(null==p?void 0:p.indoorOutDoor)||(null==i?void 0:i.indoorOutDoor),surfaceCategory:(null==p?void 0:p.surfaceCategory)||(null==i?void 0:i.surfaceCategory),endDate:null==p?void 0:p.endDate},tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:c||i&&fd({tournamentRecord:i})||[],tournamentRecord:i,policyDefinitions:n,drawDefinition:o,matchUpFilters:r,contextFilters:a,contextProfile:s,nextMatchUps:u,inContext:d,event:p})}function ld({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,policyDefinitions:i,tournamentRecord:n,participants:r=[],matchUpFilters:a,contextFilters:o,contextProfile:s,nextMatchUps:c,inContext:u,context:d,event:l}){if(!l)return{error:zt};const{eventId:p,eventName:h,endDate:f,category:m,gender:g,matchUpFormat:v}=l,y={...d,...Gn({indoorOutDoor:l.indoorOutDoor||(null==n?void 0:n.indoorOutDoor),surfaceCategory:l.surfaceCategory||(null==n?void 0:n.surfaceCategory),endDate:l.endDate||(null==n?void 0:n.endDate),tournamentId:null==n?void 0:n.tournamentId,matchUpFormat:v,eventName:h,category:m,gender:g,eventId:p})};f&&(y.endDate=f),r=r||n&&fd({tournamentRecord:n});const I=l.drawDefinitions||[],w=ca({tournamentRecord:n,event:l}).scheduleTiming;return{matchUps:I.map((d=>{const{matchUps:p}=sd({tournamentParticipants:r,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,context:y,policyDefinitions:i,tournamentRecord:n,drawDefinition:d,matchUpFilters:a,contextFilters:o,contextProfile:s,scheduleTiming:w,nextMatchUps:c,inContext:u,event:l});return p})).flat(1/0)}}function pd({scheduleVisibilityFilters:t,policyDefinitions:e,tournamentRecord:i,inContext:n=!0,matchUpFilters:r,contextFilters:a,contextProfile:o,nextMatchUps:s,context:c}){var u;if(!i)return{error:ft};const d=(null===(u=i.unifiedTournamentId)||void 0===u?void 0:u.tournamentId)||i.tournamentId,l=i&&i.events||[],p=fd({tournamentRecord:i}),{appliedPolicies:h}=Xr({tournamentRecord:i}),f=a&&a.eventIds||[];return l.filter((t=>!f.includes(t.eventId))).map((u=>hd({tournamentAppliedPolicies:h,scheduleVisibilityFilters:t,policyDefinitions:e,tournamentRecord:i,matchUpFilters:r,contextFilters:a,contextProfile:o,participants:p,tournamentId:d,nextMatchUps:s,inContext:n,context:c,event:u}))).reduce(((t,e)=>{const i=e&&Object.keys(e).filter((t=>!["success","matchUpsMap"].includes(t)));return null==i||i.forEach((i=>{t[i]||(t[i]=[]),t[i]=t[i].concat(e[i]),t.matchUpsCount+=e[i].length})),t}),{matchUpsCount:0})}function hd({tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,policyDefinitions:i,tournamentRecord:n,matchUpFilters:r,contextFilters:a,contextProfile:o,nextMatchUps:s,participants:c,tournamentId:u,inContext:d,context:l,event:p}){if(!p)return{error:zt};const{eventId:h,eventName:f,endDate:m}=p,g={...l,...Gn({eventId:h,eventName:f,endDate:m||(null==n?void 0:n.endDate),tournamentId:u||(null==n?void 0:n.tournamentId),indoorOutDoor:p.indoorOutDoor||(null==n?void 0:n.indoorOutDoor),surfaceCategory:p.surfaceCategory||(null==n?void 0:n.surfaceCategory)})},v=c||n&&fd({tournamentRecord:n});return(p.drawDefinitions||[]).reduce(((c,u)=>{const l=cd({context:g,tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:v,policyDefinitions:i,tournamentRecord:n,drawDefinition:u,matchUpFilters:r,contextFilters:a,contextProfile:o,nextMatchUps:s,inContext:d,event:p}),h=Object.keys(l);return null==h||h.forEach((t=>{c[t]||(c[t]=[]),c[t]=c[t].concat(l[t])})),c}),{})}function fd({tournamentRecord:t}){return t&&t.participants||[]}function md({tournamentRecord:t,contextProfile:e,nextMatchUps:i,matchUpId:n,inContext:r}){if(!t)return{error:ft};if("string"!=typeof n)return{error:le};const{matchUps:a}=ud({tournamentRecord:t}),o=a.find((t=>t.matchUpId===n));if(!o)return{error:he};const{eventId:s,drawId:c}=o,{event:u,drawDefinition:d}=Ia({tournamentRecord:t,eventId:s,drawId:c}),l={surfaceCategory:u.surfaceCategory||t.surfaceCategory,indoorOutDoor:u.indoorOutDoor||t.indoorOutDoor,endDate:u.endDate||t.endDate,tournamentId:t.tournamentId,eventId:s,drawId:c},p=t.participants||[],{matchUp:h,structure:f}=ku({context:r&&l,tournamentParticipants:p,drawDefinition:d,contextProfile:e,nextMatchUps:i,matchUpId:n,inContext:r,event:u});return{matchUp:h,structure:f,drawDefinition:d}}function gd({tournamentRecord:t,matchUpIds:e,schedule:i}){if(!t)return{error:ft};if(!e||!Array.isArray(e))return{error:pe};if(!i||"object"!=typeof i)return{error:Ci};const{matchUps:n}=ud({tournamentRecord:t}),r=n.reduce(((t,e)=>{const{matchUpId:i,drawId:n}=e;return t[n]?t[n].push(i):t[n]=[i],t}),{});for(const a of Object.keys(r)){const{drawDefinition:n}=wa({tournamentRecord:t,drawId:a}),o=r[a].filter((t=>e.includes(t)));for(const e of o){const r=Wu({tournamentRecord:t,drawDefinition:n,matchUpId:e,schedule:i});if(r.error)return r}}return{...dt}}function vd({tournamentRecords:t}){if(!t)return{error:ht};return Object.keys(t).reduce(((e,i)=>{e.tournamentIdMap[i]=[];const n=t[i].events||[],r=n.map((({eventId:t})=>t)),a=n.map((t=>(t.drawDefinitions||[]).map((({drawId:t})=>t)))).flat();return e.tournamentIdMap[i].push(...r,...a),e.eventIds.push(...r),e.drawIds.push(...a),e}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function yd({drawId:t,eventId:e,tournamentRecords:i}){const{tournamentIdMap:n}=vd({tournamentRecords:i});return Object.keys(n).find((i=>n[i].includes(e)||n[i].includes(t)))}function Id({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter((({drawPositions:e})=>t&&(null==e?void 0:e.includes(t)))).map((({roundNumber:t})=>parseInt(t))).sort(Wn)[0]}}function wd({inContextDrawMatchUps:t,positionAssignments:e,targetDrawPosition:i,drawDefinition:n,dualMatchUp:r,matchUp:a}){if(r){var o,s,c;const e=null===(o=t.find((({matchUpId:t})=>a.matchUpId===t)).sides)||void 0===o||null===(s=o.find((t=>t.drawPosition===i)))||void 0===s?void 0:s.sideNumber,n=null===(c=a.sides)||void 0===c?void 0:c.find((t=>t.sideNumber===e));n&&delete n.lineUp}a.drawPositions=(a.drawPositions||[]).map((t=>t===i?void 0:t));const u=e.filter((({drawPosition:t})=>a.drawPositions.includes(t))).filter((t=>t.bye)).length;return a.matchUpStatus=u?S:a.matchUpStatus===R?R:x,a.matchUpStatus===R&&(a.winningSide=void 0),Uc({drawDefinition:n,matchUp:a}),{...dt}}function Sd({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){return t||({matchUps:t,matchUpsMap:i}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:i})),(t||[]).filter((({collectionId:t})=>!t)).forEach((n=>{const{matchUpId:r,structureId:a}=n,o=id({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:r}),{winnerMatchUp:s,loserMatchUp:c}=o.targetMatchUps,u=null==s?void 0:s.matchUpId,d=null==c?void 0:c.matchUpId,l=_c({matchUpsMap:i,structureId:a}).find((t=>t.matchUpId===r));l&&(u&&(Object.assign(l,{winnerMatchUpId:u}),Object.assign(n,{winnerMatchUpId:u})),d&&(Object.assign(l,{loserMatchUpId:d}),Object.assign(n,{loserMatchUpId:d})))})),{inContextDrawMatchUps:t}}function bd(t){var e;const{sides:i,matchUpType:n}=t||{},r=null!==(e=t.potentialParticipants)&&void 0!==e&&e.length?t.potentialParticipants.flat().map((t=>n===da?(null==t?void 0:t.individualParticipantIds)||[]:t.participantId)).flat():[],a=(i||[]).map((t=>{var e;return n===da?(null==t||null===(e=t.participant)||void 0===e?void 0:e.individualParticipantIds)||[]:null!=t&&t.participantId?[t.participantId]:[]})).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function Ud({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:_i};const{venueIds:i,tournamentsMap:n}=function({tournamentRecords:t={}}={}){const e=t&&Object.values(t)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce(((t,e)=>{const{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s,tournamentMap:c}=Nd({tournamentRecord:e});return n.forEach((e=>{t.venueIds.includes(e)||t.venueIds.push(e)})),t.tournamentIds.push(...s),t.structureIds.push(...o),t.eventIds.push(...r),t.drawIds.push(...a),Object.assign(i,c),t}),{venueIds:[],eventIds:[],drawIds:[],structureIds:[],tournamentIds:[]});return{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s,tournamentsMap:i}}({tournamentRecords:t});let r,a;const o=e.every((t=>{const{scheduleDate:e,venues:o}=t;if(!In(e))return!1;return o.every((t=>{const{venueId:e,rounds:o}=t;if("string"!=typeof e)return a="venueId should be a string",!1;if(!Array.isArray(o))return a="rounds should be an array",!1;if(!i.includes(e))return r=wi,!1;return!!o.every((t=>{if(!t)return a="empty round",!1;const{tournamentId:e,eventId:i,drawId:r,structureId:o,roundNumber:s,roundSegment:c}=t,u=n[e]&&n[e][i]&&n[e][i][r]&&n[e][i][r][o],d=null==u?void 0:u.includes(s);d||(a="Invalid rounds");const{segmentNumber:l,segmentsCount:p}=c||{},h=!c||J(l)&&W(p)&&l<=p;return h||(a="Invalid segment"),d&&h}))}))}));return o||r||(r=_i),{valid:!!o,error:r,message:a}}function Nd({tournamentRecord:t={},tournamentMap:e={},requireCourts:i}={}){const n=[],r=[],a=[],o=[],s=((null==t?void 0:t.venues)||[]).map((({venueId:t,courts:e})=>(!i||(null==e?void 0:e.length))&&t)),c=null==t?void 0:t.tournamentId;if(c){o.push(c),e[c]={};((null==t?void 0:t.events)||[]).forEach((t=>{const i=t.eventId;r.push(i),e[c][i]={},(t.drawDefinitions||[]).forEach((t=>{const r=t.drawId;n.push(r),e[c][i][r]={};const{structures:o}=Bc({drawDefinition:t});(o||[]).forEach((t=>{const n=t.structureId;a.push(n);const{matchUps:o}=Ru({structure:t}),{roundMatchUps:s}=Oc({matchUps:o}),u=s&&Object.keys(s).map((t=>parseInt(t)));e[c][i][r][n]=u}))}))}))}return{tournamentIds:o,venueIds:s,eventIds:r,drawIds:n,structureIds:a,tournamentMap:e}}function Pd({tournamentRecord:t}){if(!t)return{error:ft};const e=(({tournamentId:t,tournamentRank:e,formalName:i,tournamentName:n,promotionalName:r,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l})=>({tournamentId:t,tournamentRank:e,formalName:i,tournamentName:n,promotionalName:r,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l}))(t);return{...dt,tournamentInfo:Vn(e)}}function Ed({tournamentRecords:t}){const e=Object.keys(t).reduce(((e,i)=>{const n=t[i],{tournamentInfo:{startDate:r,endDate:a}}=Pd({tournamentRecord:n}),o=r&&new Date(Mn(r));(!e.startDate||o&&o<e.startDate)&&(e.startDate=o);const s=a&&new Date(Mn(a));return(!e.endDate||s&&s>e.endDate)&&(e.endDate=s),e}),{startDate:void 0,endDate:void 0}),i=e.startDate&&Mn(e.startDate.toISOString()),n=e.endDate&&Mn(e.endDate.toISOString());return i&&n?{startDate:i,endDate:n}:{error:Te}}function Dd({tournamentRecords:t,venueIds:e=[]}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const i=[],n=[],r=[],a=[];return Object.keys(t).forEach((o=>{var s;null===(s=t[o].venues)||void 0===s||s.filter((({venueId:t})=>!e.length||e.includes(t))).forEach((t=>{var e;r.includes(t.venueId)||(i.push(Vn(t)),r.push(t.venueId)),null===(e=t.courts)||void 0===e||e.forEach((e=>{if(!a.includes(e.courtId)){const i={...Vn(e,!1,!0),venueId:t.venueId};n.push(i),a.push(e.courtId)}}))}))})),{courts:n,venues:i}}function Ad({tournamentRecords:t,requireCourts:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};return Object.keys(t).reduce(((i,n)=>{const r=t[n],{venues:a}=Lu({tournamentRecord:r});return a.forEach((t=>{const{venueId:n,courts:r}=t;(!e||(null==r?void 0:r.length))&&!i.venueIds.includes(n)&&(i.venues.push(t),i.venueIds.push(n))})),i}),{venues:[],venueIds:[]})}function Td({tournamentRecords:t,extension:e}){if(!Vc(e))return{error:_i};for(const i of Object.values(t)){const t=Wc({tournamentRecord:i,extension:e});if(t.error)return t}return{...dt}}function Cd({tournamentRecords:t,name:e}){if(!e)return{error:Ae,message:"Missing name"};let i;return Object.keys(t).find((n=>{const r=t[n],{extension:a}=aa({tournamentRecord:r,name:e});return i=a,!!a}))?{extension:i}:{error:Gi}}function Md({tournamentRecords:t,name:e}){if(!e)return{error:Ae,message:"Missing name"};let i=0;for(const n of Object.keys(t)){const r=Kc({tournamentRecord:t[n],name:e});if(r.error)return r;r.message!==Gi&&i++}return{...dt,removed:i}}function xd({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const{extension:e}=Cd({tournamentRecords:t,name:Yr});let i=(null==e?void 0:e.value)||[];if(i.length){const{venueIds:e}=Ad({tournamentRecords:t,requireCourts:!0}),{eventIds:n,drawIds:r}=vd({tournamentRecords:t}),{updatedSchedulingProfile:a,modifications:o,issues:s}=Od({schedulingProfile:i,venueIds:e,eventIds:n,drawIds:r});if(o){i=a;const e=Rd({tournamentRecords:t,schedulingProfile:i});return e.error?e:{schedulingProfile:i,modifications:o,issues:s}}}return{schedulingProfile:i,modifications:0}}function Rd({tournamentRecords:t,schedulingProfile:e}){const i=Ud({tournamentRecords:t,schedulingProfile:e});if(i.error)return i;if(!e)return Md({tournamentRecords:t,name:Yr});return Td({tournamentRecords:t,extension:{name:Yr,value:e}})}function kd({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!In(e))return{error:ke};const{extension:r}=Cd({tournamentRecords:t,name:Yr}),a=(null==r?void 0:r.value)||[];let o=a.find((t=>jn(e,t.scheduleDate)));if(!o){const{startDate:i,endDate:n}=Ed({tournamentRecords:t}),r=new Date(e);if(r<new Date(i)||r>new Date(n))return{error:ke};o={scheduleDate:e,venues:[]},a.push(o)}let s=o.venues.find((t=>t.venueId===i));s||(s={venueId:i,rounds:[]},o.venues.push(s));const c=["notBeforeTime"],u=t=>Object.keys(t).filter((t=>!c.includes(t))).sort().map((e=>t[e])).join("|");if(s.rounds.find((t=>u(t)===u(n))))return{error:Bt};s.rounds.push(n);const d=Rd({tournamentRecords:t,schedulingProfile:a});return d.error?d:dt}function Od({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){const r=[];return{updatedSchedulingProfile:null==t?void 0:t.map((t=>{const a=Mn(null==t?void 0:t.scheduleDate);if(!a)return void r.push(`Invalid date: ${null==t?void 0:t.scheduledDate}`);const o=((null==t?void 0:t.venues)||[]).map((t=>{const{rounds:a,venueId:o}=t;if(!e.includes(o))return void r.push(`Missing venueId: ${o}`);const s=a.filter((t=>{const e=i.includes(t.eventId)&&n.includes(t.drawId);return e||r.push(`Invalid eventId: ${t.eventId} or drawId: ${t.drawId}`),e}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...t,venues:o}})).filter(Boolean),modifications:r.length,issues:r}}function Ld({tournamentRecords:t}){const{schedulingProfile:e}=xd({tournamentRecords:t,requireCourts:!0});if(e){const{venueIds:i}=Ad({tournamentRecords:t}),{eventIds:n,drawIds:r}=vd({tournamentRecords:t}),{updatedSchedulingProfile:a,modifications:o}=Od({schedulingProfile:e,venueIds:i,eventIds:n,drawIds:r});if(o)return Rd({tournamentRecords:t,schedulingProfile:a})}return dt}function _d({matchUps:t=[],schedulingProfile:e}){const i={},n=({eventId:t,drawId:e,structureId:i,roundNumber:n})=>`${t}|${e}|${i}${n}`;if(null!=e&&e.length){e.map((({venues:t})=>t.map((({rounds:t})=>t)))).flat().forEach((t=>{t.sort(((t,e)=>(t.sortOrder||0)-(e.sortOrder||0))).forEach((({eventId:t,drawId:e,structureId:r,roundNumber:a},o)=>{const s=n({eventId:t,drawId:e,structureId:r,roundNumber:a});i[s]=o}))}))}const r=[],a={noScheduledDate:[]};for(const s of t){const t=s.schedule||{},e=t.scheduledDate&&Mn(t.scheduledDate)||t.scheduledTime&&Mn(t.scheduledTime)||"noScheduledDate";a[e]||(a[e]=[]),a[e].push(s)}const o=Object.keys(a).sort();for(const s of o){const t=a[s],e={noScheduledTime:[]};for(const i of t){const t=i.schedule||{},n=t.scheduledTime&&Cn(t.scheduledTime)||"noScheduledTime";e[n]||(e[n]=[]),e[n].push(i)}const o=Object.keys(e).sort();for(const a of o){const t=e[a];t.sort(((t,e)=>(i[n(t)]||0)-(i[n(e)]||0))),r.push(...t)}}return r}function Fd({scheduleVisibilityFilters:t,tournamentRecords:e,matchUpFilters:i,contextFilters:n,nextMatchUps:r}){if("object"!=typeof e||!Object.keys(e).length)return{error:ht};return{matchUps:Object.keys(e).map((a=>{const o=e[a],{matchUps:s}=ud({scheduleVisibilityFilters:t,tournamentRecord:o,matchUpFilters:i,contextFilters:n,nextMatchUps:r});return s})).flat()}}function jd(t){if("object"!=typeof(null==t?void 0:t.tournamentRecords)||!Object.keys(null==t?void 0:t.tournamentRecords).length)return{error:ht};const{courts:e,venues:i}=Dd(t),{sortCourtsData:n,sortDateMatchUps:r=!0}=t,a=xd(t).schedulingProfile,{completedMatchUps:o,upcomingMatchUps:s,pendingMatchUps:c}=Bd(t),u=[...s||[],...c||[]],d=r?_d({matchUps:u,schedulingProfile:a}):u;return{courtsData:e.map((t=>{const e=function({courtId:t}){const e=d.filter((e=>{var i;return(null===(i=e.schedule)||void 0===i?void 0:i.courtId)===t}));return n?_d({matchUps:e,schedulingProfile:a}):e}(t);return{...t,matchUps:e,surfaceCategory:(null==t?void 0:t.surfaceCategory)||""}})),completedMatchUps:o,dateMatchUps:d,venues:i}}function Bd({scheduleVisibilityFilters:t,tournamentRecords:e,matchUpFilters:i,contextFilters:n}){if("object"!=typeof e||!Object.keys(e).length)return{error:ht};return Object.keys(e).map((r=>{const a=e[r];return pd({scheduleVisibilityFilters:t,tournamentRecord:a,matchUpFilters:i,contextFilters:n})})).reduce(((t,e)=>(Object.keys(e).forEach((i=>{t[i]||(t[i]=[]),t[i]=t[i].concat(e[i])})),t)),{})}function Vd(t,e){return function(t,e){return(Vo[null==t?void 0:t.stage]||0)-(Vo[null==e?void 0:e.stage]||0)}(t,e)||((null==t?void 0:t.stageSequence)||0)-((null==e?void 0:e.stageSequence)||0)||(null==t?void 0:t.roundNumber)-(null==e?void 0:e.roundNumber)||((null==t?void 0:t.roundPosition)||0)-((null==e?void 0:e.roundPosition)||0)}function Gd({includeParticipantDependencies:t,tournamentRecords:e={},drawDefinition:i,matchUps:n=[],drawIds:r=[]}){if(!Array.isArray(n))return{error:fe};if(!Array.isArray(r))return{error:xt};const a={},o=t=>{a[t]||(a[t]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[]})},s=(e,i)=>{a[e].matchUpIds.forEach((t=>a[i].matchUpIds.push(t))),a[i].matchUpIds.push(e),a[e].dependentMatchUpIds.push(i),t&&a[e].participantIds.forEach((t=>a[i].participantIds.push(t)))},c=e=>{for(const i of e){const{matchUpId:e,winnerMatchUpId:n,loserMatchUpId:r}=i;if(o(e),t){const{individualParticipantIds:t}=bd(i);a[e].participantIds=t}n&&(o(n),s(e,n)),r&&(o(r),s(e,r))}};if(i)Sd({drawDefinition:i}),n.length||({matchUps:n}=dd({drawDefinition:i})),c(n);else{n.length||({matchUps:n}=Fd({tournamentRecords:e,nextMatchUps:!0})),r.length||(r=e?Object.values(e).map((({events:t=[]})=>t.map((({drawDefinitions:t=[]})=>t.map((({drawId:t})=>t)))))).flat(1/0):[]);for(const t of r){let i=n.filter((e=>e.drawId===t)).sort(Vd);if(!!!i.find((({winnerMatchUpId:t,loserMatchUpId:e})=>t||e))){if(!i.find((({roundPosition:t})=>t))){const n=i.find((({tournamentId:t})=>t)),{drawDefinition:r}=Ia({tournamentRecord:e[n.tournamentId],drawId:t});Sd({drawDefinition:r})}}c(i)}}return{matchUpDependencies:a,...dt}}function Hd({matchUpStatus:t}){return L.includes(t)}function Wd({matchUpStatus:t}){return _.includes(t)}function qd({score:t,winningSide:e,matchUpStatus:i}){return(null==t?void 0:t.scoreStringSide1)||e||function({matchUpStatus:t}){return j.includes(t)}({matchUpStatus:i})}function zd({drawDefinition:t,structureId:e}){const{structure:i,error:n}=jc({drawDefinition:t,structureId:e});if(n)return{error:n};const{matchUps:r}=Ru({inContext:!0,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},structure:i}),a=X([].concat(...r.map((t=>t.drawPositions||[]))).filter(Boolean)).sort(Wn),{matchUpDependencies:o}=Gd({drawIds:[t.drawId],drawDefinition:t,matchUps:r}),s=X(r.filter(qd).map((t=>{var e;return[].concat(...(null===(e=o[t.matchUpId])||void 0===e?void 0:e.matchUpIds)||[],t.matchUpId)})).flat()),c=X(r.map((({matchUpId:t,drawPositions:e})=>s.includes(t)?e:[])).flat().filter(Boolean)).sort(Wn),{positionAssignments:u}=Eu({drawDefinition:t,structure:i}),d=u.filter((t=>t.bye)).map((t=>t.drawPosition)),l=a.filter((t=>!c.includes(t)));return{allDrawPositions:a,inactiveDrawPositions:l,positionAssignments:u,activeDrawPositions:c,byeDrawPositions:d,structure:i}}function Kd({positionAssignments:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){const{matchUps:a}=Ru({drawDefinition:e,matchUpsMap:i,structure:n,event:r});a.forEach((i=>{const n=t.filter((({drawPosition:t})=>{var e;return null===(e=i.drawPositions)||void 0===e?void 0:e.includes(t)})).filter((t=>t.bye)).length;if(!i.winningSide){const t=n?S:x;Object.assign(i,{matchUpStatus:t}),Uc({drawDefinition:e,matchUp:i})}}))}function Yd({inContextDrawMatchUps:t,drawDefinition:e,drawPosition:i,matchUpsMap:n,structureId:r,event:a}){const{structure:o}=jc({drawDefinition:e,structureId:r}),{positionAssignments:s}=Du({drawDefinition:e,structure:o}),c=s.some((t=>{if(t.drawPosition===i)return delete t.participantId,delete t.qualifier,delete t.bye,!0}));if(o.structureType===qo)return Kd({positionAssignments:s,drawDefinition:e,structure:o,matchUpsMap:n}),{drawPositionCleared:c};const{matchUps:u}=Ru({drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:o,event:a}),{roundProfile:d,roundMatchUps:l}=Oc({matchUps:u}),p=Object.keys(d).map((t=>parseInt(t)));let h=i;const f=p.map((t=>{const e=d[t].pairedDrawPositions.find((t=>t.includes(h))),i=null==e?void 0:e.find((t=>t!==h)),n=s.find((t=>t.drawPosition===i)),r=d[t+1],a=null==n?void 0:n.bye,o=r&&r.pairedDrawPositions.find((t=>t.includes(i))),c=a&&o&&r&&r.drawPositions.includes(i),u=e&&{roundNumber:t,relevantPair:e,pairedDrawPosition:i,pairedDrawPositionByeAdvancedPair:!c&&o,targetDrawPosition:h};return c&&(h=i),u})).filter((t=>null==t?void 0:t.targetDrawPosition)).reduce(((t,e)=>{const{roundNumber:i,relevantPair:n,targetDrawPosition:r,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=e,s=[{roundNumber:i,targetDrawPosition:r,relevantPair:n},o&&{roundNumber:i+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return t.concat(...s)}),[]);return f.forEach((({roundNumber:a,targetDrawPosition:c,relevantPair:u})=>{const d=l[a].find((t=>st(t.drawPositions.filter(Boolean),u.filter(Boolean))));d&&(!function({drawDefinition:t,structureId:e,roundNumber:i,targetDrawPosition:n,matchUpsMap:r,inContextDrawMatchUps:a}){var o;const{structure:s}=jc({drawDefinition:t,structureId:e});if(s.structureType===qo)return;r=r||Lc({drawDefinition:t});const c=((null===(o=r)||void 0===o?void 0:o.mappedMatchUps)||{})[e].matchUps,{initialRoundNumber:u}=Id({drawPosition:n,matchUps:c}),d=null==c?void 0:c.filter((t=>t.roundNumber>=i&&t.roundNumber!==u&&t.drawPositions.includes(n))),{positionAssignments:l}=Eu({drawDefinition:t,structureId:e});null==d||d.forEach((e=>Jd({targetMatchUp:e,drawPosition:n,positionAssignments:l,drawDefinition:t,structure:s,matchUpsMap:r,inContextDrawMatchUps:a})))}({drawDefinition:e,structureId:r,roundNumber:a,targetDrawPosition:c,matchUpsMap:n,inContextDrawMatchUps:t}),Jd({drawDefinition:e,structure:o,positionAssignments:s,targetMatchUp:d,drawPosition:i,matchUpsMap:n,inContextDrawMatchUps:t}))})),{tasks:f,drawPositionCleared:c}}function Jd({positionAssignments:t,targetMatchUp:e,drawPosition:i,drawDefinition:n,structure:r,inContextDrawMatchUps:a,matchUpsMap:o}){const s=(o=o||Lc({drawDefinition:n})).mappedMatchUps[r.structureId].matchUps,{initialRoundNumber:c}=Id({drawPosition:i,matchUps:s});e.roundNumber>c&&(e.drawPositions=(e.drawPositions||[]).map((t=>t===i?void 0:t)));const u=id({matchUpId:e.matchUpId,structure:r,drawDefinition:n,inContextDrawMatchUps:a}),{targetLinks:{winnerTargetLink:d},targetMatchUps:{loserMatchUp:l,winnerMatchUp:p,loserMatchUpDrawPositionIndex:h,winnerMatchUpDrawPositionIndex:f}}=u,m=t.filter((({drawPosition:t})=>e.drawPositions.includes(t))).filter((t=>t.bye)).length;if(e.matchUpStatus=m?S:e.matchUpStatus===R?R:x,e.matchUpStatus===R&&(e.winningSide=void 0),Uc({drawDefinition:n,matchUp:e}),l&&l.structureId!==u.matchUp.structureId&&!m){const{drawPositions:t,roundNumber:e}=l;if(1===e){const e=t[h];Yd({drawDefinition:n,structureId:l.structureId,drawPosition:e,matchUpsMap:o,inContextDrawMatchUps:a})}else{var g;const i=Math.min(...t.filter(Boolean)),r=((null===(g=o)||void 0===g?void 0:g.mappedMatchUps)||{})[l.structureId].matchUps,{initialRoundNumber:s}=Id({drawPosition:i,matchUps:r});s===e&&Yd({drawDefinition:n,structureId:l.structureId,drawPosition:i,matchUpsMap:o,inContextDrawMatchUps:a})}}p&&p.structureId!==u.matchUp.structureId&&console.log("linked structure winnerMatchUp removal",{winnerTargetLink:d,winnerMatchUpDrawPositionIndex:f})}function $d({drawDefinition:t,drawPosition:e,participantId:i,structureId:n,matchUpsMap:r,inContextDrawMatchUps:a}){const{structure:o}=jc({drawDefinition:t,structureId:n}),{positionAssignments:s}=Du({drawDefinition:t,structure:o}),c=s.find((t=>i&&t.participantId===i||e&&t.drawPosition===e));if(i&&!e&&(e=null==c?void 0:c.drawPosition),!e)return{error:Tt};i||(i=null==c?void 0:c.participantId);const{activeDrawPositions:u}=zd({drawDefinition:t,structureId:n});if(u.includes(e))return{error:Dt};a||({matchUps:a}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const{drawPositionCleared:d,error:l}=Yd({drawDefinition:t,structureId:n,drawPosition:e,matchUpsMap:r,inContextDrawMatchUps:a});return l?{error:l}:d?(Pc({drawDefinition:t,structureIds:[n]}),{...dt,participantId:i}):{error:Nt}}function Zd({element:t,notes:e}={}){return"object"!=typeof t?{error:_i}:e?"string"==typeof e||null!=e&&e.testing?(Object.assign(t,{notes:e}),dt):{error:_i}:{error:Ae}}function Xd({tournamentRecord:t,drawDefinition:e,policyTypes:i=[],event:n}){if(!Array.isArray(i))return{error:ve};const r={},a=t=>{for(const e of i){const i=t[e];i&&!r[e]&&(r[e]=i)}};if(e){const{appliedPolicies:t}=kc({drawDefinition:e})||{};a(t)}if(n){const{appliedPolicies:t}=Qr({event:n})||{};a(t)}if(t){const{appliedPolicies:e}=Xr({tournamentRecord:t})||{};a(e)}return Object.keys(r).length?{policyDefinitions:r}:{error:Ne}}const Qd=t=>null==t?void 0:t.participantId;function tl({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!Array.isArray(r))return{error:_i};if(!t)return{error:_i};const{policyDefinitions:o}=Xd({tournamentRecord:e,drawDefinition:i,event:a,policyTypes:[tr]}),{subOrderMap:s}=function({positionAssignments:t}){const e=(t||[]).filter(Qd).map((t=>{const{extension:e}=ra({element:t,name:Jr}),i=parseInt(null==e?void 0:e.value),n=!isNaN(i)&&i;return n&&{participantId:t.participantId,subOrder:n}})).filter(Boolean),i=tt(e.map((({subOrder:t})=>t)));return{subOrderMap:Object.assign({},...e.filter((({subOrder:t})=>1===i[t])).map((({participantId:t,subOrder:e})=>({[t]:e}))))}}({positionAssignments:t}),c=dr({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r});if(c.error)return c;const{participantResults:u}=c,d=Object.keys(u);return t.forEach((t=>{const{participantId:e}=t;if(d.includes(e)){Gc({element:t,extension:{name:$r,value:u[e]}}),u[e].ties||Hc({element:t,name:Jr})}else Hc({element:t,name:$r}),Hc({element:t,name:Jr})})),Pc({drawDefinition:i}),{...dt,participantResults:u}}function el({event:t,eventId:e}){if(!t)return{error:zt};const{extension:i}=oa({event:t,name:Br}),n=e?Vn(null==i?void 0:i.value,!1,!0):null==i?void 0:i.value;var r;e&&(null===(r=t.drawDefinitions)||void 0===r||r.forEach((t=>{var e;null==n||null===(e=n.flights)||void 0===e||e.forEach((e=>{e.drawId===t.drawId&&Object.assign(e,{drawDefinition:t})}))})));return{flightProfile:n}}const il={matchUpStatus:x,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function nl({matchUpStatusCodes:t,removeWinningSide:e,tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUpStatus:a,removeScore:o,winningSide:s,matchUpId:c,matchUp:u,event:d,notes:l,score:p}){var h;let f;const m=u.matchUpType===la;if(m?c&&u.matchUpId!==c&&({matchUp:u,structure:f}=ku({drawDefinition:n,matchUpId:c,event:d})):u.matchUpId!==c&&console.log("!!!!!"),o?Object.assign(u,il):p&&(u.score=p),a&&(u.matchUpStatus=a),r&&(u.matchUpFormat=r),t&&(u.matchUpStatusCodes=t),s&&(u.winningSide=s),e&&(u.winningSide=void 0),f||({structure:f}=ku({drawDefinition:n,matchUpId:c,event:d})),(null===(h=f)||void 0===h?void 0:h.structureType)===qo&&!u.collectionId){var g;r=m?"SET1-S:T100":r||u.matchUpFormat||(null===(g=f)||void 0===g?void 0:g.matchUpFormat)||n.matchUpFormat||(null==d?void 0:d.matchUpFormat);const t=f.structures.find((t=>null==t?void 0:t.matchUps.find((t=>t.matchUpId===c)))),e=m&&{matchUpTypes:[la]},{matchUps:a}=Ru({structure:t,inContext:!0,matchUpFilters:e,event:d}),o=tl({positionAssignments:t.positionAssignments,tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUps:a,event:d});if(o.error)return o}if(s!==u.winningSide){var v;const{flightProfile:t}=el({event:d}),e=null==t||null===(v=t.flights)||void 0===v?void 0:v.find((t=>t.drawId===n.drawId));null!=e&&e.matchUpValue&&console.log("recalculate team point tallies")}if(l){const t=Zd({element:u,notes:l});if(t.error)return t}return Uc({drawDefinition:n,matchUp:u}),dt}function rl({drawDefinition:t,matchUpId:e,structure:i,event:n}){const r=ku({drawDefinition:t,event:n,matchUpId:e});if(r.error)return r;const a=r.matchUp,o=a.tieFormat||(null==i?void 0:i.tieFormat)||(null==t?void 0:t.tieFormat)||(null==n?void 0:n.tieFormat),{winningSide:s,set:c,scoreStringSide1:u,scoreStringSide2:d}=xa({matchUp:a,tieFormat:o}),l=[1,2].includes(s),p=l?U:u?D:x,h=a.winningSide&&!l;return nl({score:{scoreStringSide1:u,scoreStringSide2:d,sets:[c]},removeWinningSide:h,drawDefinition:t,matchUpStatus:p,winningSide:s,matchUpId:e,matchUp:a,event:n}),{...dt,removeWinningSide:h}}function al(t){const{dualWinningSideChange:e,inContextDrawMatchUps:i,drawDefinition:n,matchUpStatus:r,matchUpsMap:a,dualMatchUp:o,targetData:s,structure:c,event:u}=t,d=Boolean(t.matchUp.collectionId),{drawPositions:l,winningSide:p}=s.matchUp||{};if(!l)return{error:Et};const{targetLinks:{loserTargetLink:h,winnerTargetLink:f},targetMatchUps:{loserMatchUp:m,winnerMatchUp:g}}=s,{positionAssignments:v}=Du({structure:c}),y=p-1,I=1-y,w=l[y],b=l[I],{winnerParticipantId:U,loserParticipantId:N}=v.reduce(((t,e)=>(e.drawPosition===b&&(t.loserParticipantId=e.participantId),e.drawPosition===w&&(t.winnerParticipantId=e.participantId),t)),{winnerParticipantId:void 0,loserParticipantId:void 0}),E=nl({...t,matchUpStatus:r||x,removeWinningSide:!0});if(E.error)return E;if(d){const{matchUpTieId:i}=t,{removeWinningSide:r}=rl({matchUpId:i,drawDefinition:n,structure:c,event:u});if(!e&&!r)return{...dt}}const{matchUps:D}=Ru({inContext:!0,drawDefinition:n,matchUpsMap:a,structure:c}),A=D.filter((t=>t.drawPositions.includes(b)));if(g){const t=ol({inContextDrawMatchUps:i,winningDrawPosition:w,winnerParticipantId:U,winnerTargetLink:f,drawDefinition:n,winnerMatchUp:g,dualMatchUp:o,matchUpsMap:a});if(t.error)return t}if(m){const{winnerHadMatchUpStatus:t}=function({sourceMatchUps:t,loserDrawPosition:e,drawPositionMatchUps:i,matchUpStatuses:n=[S,R,P]}){var r;const a=null==i?void 0:i.reduce(((t,e)=>!t||e.roundNumber>t.roundNumber?e:t),void 0),o=null==a||null===(r=a.drawPositions)||void 0===r?void 0:r.find((t=>t!==e)),s=t.filter((t=>{var e;return null==t||null===(e=t.drawPositions)||void 0===e?void 0:e.includes(o)})).map((t=>t.matchUpStatus)),c=t.filter((t=>{var i;return null==t||null===(i=t.drawPositions)||void 0===i?void 0:i.includes(e)})).map((t=>t.matchUpStatus));return{sourceMatchUp:a,winnerHadMatchUpStatus:st(s||[],n),winnerMatchUpStatuses:s,loserHadMatchUpStatus:st(c||[],n),loserMatchUpStatuses:c}}({drawPositionMatchUps:A,loserDrawPosition:b,sourceMatchUps:D}),e=h.linkCondition===Qo;if(t&&e){const t=sl({targetLink:h,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:Math.min(...m.drawPositions),matchUpsMap:a});if(t.error)return t}const r=function({inContextDrawMatchUps:t,loserParticipantId:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,dualMatchUp:a}){const o=i.target.structureId,{structure:s}=jc({drawDefinition:n,structureId:o}),{positionAssignments:c}=Du({structure:s});if(c.forEach((t=>{t.participantId===e&&delete t.participantId})),a){var u,d;const e=a.drawPositions,i=null==r||null===(u=r.sides)||void 0===u?void 0:u.find((t=>e.includes(t.drawPosition))),o=t.find((({matchUpId:t})=>t===r.matchUpId)),s=i&&(null==o||null===(d=o.sides)||void 0===d?void 0:d.find((t=>t.sideNumber===i)));s&&(delete s.lineUp,console.log("remove loser lineUp",{targetSide:s}),Uc({drawDefinition:n,matchUp:o}))}return{...dt}}({inContextDrawMatchUps:i,loserParticipantId:N,loserTargetLink:h,drawDefinition:n,loserMatchUp:m,dualMatchUp:o,matchUpsMap:a});if(r)return r}return{...dt}}function ol({inContextDrawMatchUps:t,winningDrawPosition:e,winnerParticipantId:i,winnerTargetLink:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,dualMatchUp:s,event:c}){const{structureId:u,roundNumber:d}=a;if(n){const t=n.target.structureId,{structure:e}=jc({drawDefinition:r,structureId:t}),{positionAssignments:a}=Du({structure:e}),o=a.find((t=>t.participantId===i)),s=null==o?void 0:o.drawPosition,{matchUps:u}=Ru({drawDefinition:r,structure:e,event:c});1===tt(u.map((t=>t.drawPositions)).flat(1/0).filter(Boolean))[s]?a.forEach((t=>{t.participantId===i&&delete t.participantId})):console.log("not removing from position assignments since instances > 1")}const l=function({inContextDrawMatchUps:t,targetDrawPosition:e,drawDefinition:i,structureId:n,dualMatchUp:r,roundNumber:a,matchUpsMap:o}){var s;const{structure:c}=jc({drawDefinition:i,structureId:n});if(c.structureType===qo)return;const u=((null===(s=o=o||Lc({drawDefinition:i}))||void 0===s?void 0:s.mappedMatchUps)||{})[n].matchUps,{initialRoundNumber:d}=Id({drawPosition:e,matchUps:u}),l=null==u?void 0:u.filter((t=>t.roundNumber>=a&&t.roundNumber!==d&&t.drawPositions.includes(e))),{positionAssignments:p}=Eu({drawDefinition:i,structureId:n});for(const h of l){const n=wd({inContextDrawMatchUps:t,positionAssignments:p,targetDrawPosition:e,drawDefinition:i,dualMatchUp:r,matchUpsMap:o,matchUp:h});if(n.error)return n}return{...dt}}({targetDrawPosition:e,inContextDrawMatchUps:t,drawDefinition:r,dualMatchUp:s,matchUpsMap:o,roundNumber:d,structureId:u});return l.error?l:{...dt}}function sl({inContextDrawMatchUps:t,drawDefinition:e,drawPosition:i,matchUpsMap:n,targetLink:r}){return $d({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:n,drawPosition:i,structureId:r.target.structureId}),{...dt}}function cl(t){var e;let{sourceMatchUp:i}=t;const{winnerMatchUp:n,structure:r,matchUpsMap:a,drawPosition:o}=t,s=n.roundNumber>1&&n.roundNumber-1,c=_c({structureId:r.structureId,matchUpsMap:a});!i&&o&&(i=c.find((({drawPositions:t,roundNumber:e})=>e===s&&t.includes(o))));const u=null===(e=i)||void 0===e?void 0:e.roundPosition,d=u+(u%2?1:-1),l=s&&c.find((({roundNumber:t,roundPosition:e})=>t===s&&e===d)),p=null==l?void 0:l.matchUpStatus;return{pairedPreviousMatchUp:l,pairedPreviousMatchUpisWOWO:[E].includes(p)}}function ul({drawDefinition:t,drawPosition:e,matchUpsMap:i,structureId:n}){if(!t)return{error:yt};const{structure:r}=jc({drawDefinition:t,structureId:n});if(!r)return{error:Gt};i||(i=Lc({drawDefinition:t}));const{positionAssignments:a}=Eu({structure:r}),{activeDrawPositions:o}=zd({drawDefinition:t,structureId:n});if(a.find((t=>t.drawPosition===e)).bye)return{...dt};if(o.includes(e))return{error:Dt};const s=a.find((t=>t.drawPosition===e));if(!s)return{error:At};const{filled:c,containsBye:u}=function(t){const e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:n,filled:e||i||n}}(s);if(u)return{...dt};if(c&&!u)return{error:Ut};const{matchUps:d}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:i}),{matchUps:l}=Ru({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:r});if(a.forEach((t=>{t.drawPosition===e&&(t.bye=!0)})),r.structureType===qo)return function({drawDefinition:t,matchUps:e,drawPosition:i}){e.forEach((e=>{e.drawPositions.includes(i)&&dl({drawDefinition:t,matchUp:e})}))}({drawDefinition:t,matchUps:l,drawPosition:e}),{...dt};const{roundProfile:p,roundMatchUps:h}=Oc({matchUps:l}),f=Object.keys(p).map((t=>parseInt(t))).reverse(),m=h[f.find((t=>p[t].drawPositions.includes(e)))].find((({drawPositions:t})=>t.includes(e)));dl({drawDefinition:t,matchUp:m});const g=m.drawPositions.find((t=>t!==e));if(g){const e=ll({sourceDrawPositions:m.drawPositions,matchUpId:m.matchUpId,inContextDrawMatchUps:d,drawPositionToAdvance:g,drawDefinition:t,matchUpsMap:i});if(e.error)return e}return Pc({drawDefinition:t,structureIds:[n]}),{...dt}}function dl({drawDefinition:t,matchUp:e}){Object.assign(e,{matchUpStatus:S,score:void 0,winningSide:void 0}),Uc({drawDefinition:t,matchUp:e})}function ll({sourceDrawPositions:t,drawPositionToAdvance:e,inContextDrawMatchUps:i,drawDefinition:n,matchUpId:r,matchUpsMap:a}){const o=a.drawMatchUps.find((t=>t.matchUpId===r)),s=i.find((t=>t.matchUpId===r)),c=null==s?void 0:s.structureId,{structure:u}=jc({drawDefinition:n,structureId:c}),{positionAssignments:d}=Eu({structure:u}),l=d.filter((t=>t.bye)).map((t=>t.drawPosition)),p=o.drawPositions.find((t=>t!==e)),h=l.includes(p),{targetLinks:{loserTargetLink:f},targetMatchUps:{loserMatchUp:m,winnerMatchUp:g,loserTargetDrawPosition:v}}=id({matchUpId:r,structure:u,drawDefinition:n,inContextDrawMatchUps:i});if(g&&g.structureId===u.structureId&&function({drawDefinition:t,winnerMatchUp:e,drawPositionToAdvance:i,sourceDrawPositions:n,inContextDrawMatchUps:r,matchUpsMap:a}){var o,s;const c=a.drawMatchUps.find((t=>t.matchUpId===e.matchUpId)),u=r.find((t=>t.matchUpId===e.matchUpId)),d=null==u?void 0:u.structureId,{structure:l}=jc({drawDefinition:t,structureId:d}),{positionAssignments:p}=Eu({structure:l}),h=p.find((({drawPosition:t})=>t===i)).bye,f=c.drawPositions.filter((t=>t)),m=p.filter((t=>f.includes(t.drawPosition))),g=p.find((({drawPosition:t})=>t===i)),v=null==n?void 0:n.find((t=>t!==i)),y=v&&m.find((({drawPosition:t})=>t===v)),I=null==y?void 0:y.bye,w=h&&I;if(f.length>1&&h&&!I)return{error:Ut};const b=f.find((t=>t!==i));let U=w;const N=[].concat(...(c.drawPositions||[]).filter(Boolean),void 0,void 0).slice(0,2).map((t=>t||U?t===i?(U=!0,i):t:(U=!0,i)));if(!U)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:i,existingAssignments:m}),{error:Ut};const P=null===(o=p.find((({drawPosition:t})=>t===b)))||void 0===o?void 0:o.bye,E=null===(s=p.find((({drawPosition:t})=>t===i)))||void 0===s?void 0:s.bye,D=E||P?S:x;if(Object.assign(c,{matchUpStatus:D,score:void 0,winningSide:void 0,drawPositions:N}),Uc({drawDefinition:t,matchUp:c}),P||E){const n=P?i:b;if(n)ll({drawPositionToAdvance:n,matchUpId:e.matchUpId,inContextDrawMatchUps:r,drawDefinition:t,iterative:"brightmagenta",matchUpsMap:a});else if(E){const{targetLinks:{loserTargetLink:i},targetMatchUps:{loserMatchUp:n,loserTargetDrawPosition:o}}=id({matchUpId:e.matchUpId,structure:l,drawDefinition:t,inContextDrawMatchUps:r});if(i&&n)if(n.feedRound)pl({drawDefinition:t,loserMatchUp:n,loserTargetLink:i,loserTargetDrawPosition:o,matchUpsMap:a});else{const r=1-e.roundPosition%2,a=n.drawPositions[r],s=ul({drawDefinition:t,structureId:i.target.structureId,drawPosition:a,loserTargetDrawPosition:o,iterative:"brightgreen"});if(s.error);}}}}({drawDefinition:n,winnerMatchUp:g,drawPositionToAdvance:e,sourceDrawPositions:t,inContextDrawMatchUps:i,matchUpsMap:a}),m&&h&&m.structureId!==u.structureId){const{roundNumber:t}=m;if(1===t){const t=ul({drawDefinition:n,structureId:f.target.structureId,drawPosition:v,iterative:"brightyellow"});if(t.error)return t}else pl({drawDefinition:n,loserMatchUp:m,loserTargetLink:f,loserTargetDrawPosition:v,matchUpsMap:a})}return{...dt}}function pl({drawDefinition:t,loserMatchUp:e,loserTargetLink:i,loserTargetDrawPosition:n,matchUpsMap:r}){const{roundNumber:a}=e,o=((null==r?void 0:r.mappedMatchUps)||{})[e.structureId].matchUps,{initialRoundNumber:s}=Id({drawPosition:n,matchUps:o});if(s===a){const e=ul({drawDefinition:t,structureId:i.target.structureId,drawPosition:n,iterative:"red"});if(e.error)return e}}function hl({inContextDrawMatchUps:t,matchUpId:e,drawPosition:i}){const n=t.filter((({winnerMatchUpId:t,loserMatchUpId:i})=>i===e||t===e)).sort(((t,e)=>t.roundPosition-e.roundPosition));return n.find((({feedRound:t})=>t))?1:n.reduce(((t,e,n)=>e.drawPositions.includes(i)?n+1:t),void 0)}function fl({drawDefinition:t,matchUpId:e,matchUpStatus:i,drawPosition:n,matchUpsMap:r,inContextDrawMatchUps:a}){var o,s,c;r||(r=Lc({drawDefinition:t})),a||({matchUps:a}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const u=a.find((t=>t.matchUpId===e)),d=null==u?void 0:u.structureId,l=null==t||null===(o=t.structures)||void 0===o?void 0:o.find((t=>t.structureId===d)),p=null===(s=r)||void 0===s||null===(c=s.drawMatchUps)||void 0===c?void 0:c.find((t=>t.matchUpId===e)),h=p.drawPositions||[],{positionAdded:f,positionAssigned:m,updatedDrawPositions:g}=function({drawPosition:t,drawPositions:e}){let i,n=e.includes(t);return{updatedDrawPositions:n?e:[].concat(...e,void 0,void 0).slice(0,2).map((e=>e||n?e:(n=!0,i=!0,t))).sort(Wn),positionAdded:i,positionAssigned:n}}({drawPosition:n,drawPositions:h}),{positionAssignments:v}=Eu({drawDefinition:t,structure:l}),y=v.filter((t=>g.includes(t.drawPosition))).find((({bye:t})=>t)),I=p.matchUpStatus===R&&g.filter(Boolean).length<2;if(i=y?S:i||(I?R:p.matchUpStatus===E?E:x),f){({matchUps:a}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const o=I&&hl({inContextDrawMatchUps:a,drawPosition:n,matchUpId:e})||void 0;Object.assign(p,{drawPositions:g,winningSide:o,matchUpStatus:i}),Uc({drawDefinition:t,matchUp:p})}const w=id({matchUpId:e,drawDefinition:t,inContextDrawMatchUps:a,inContextMatchUp:u}),{targetMatchUps:{winnerMatchUp:b,loserMatchUp:N,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:D}}=w,A=_c({structureId:l.structureId,matchUpsMap:r});if(m&&y){if(b)if([S,E].includes(i)){const e=fl({drawDefinition:t,drawPosition:n,matchUpId:b.matchUpId,iterative:"brightmagenta",matchUpsMap:r,inContextDrawMatchUps:a});if(e.error)return e}else{const{structureId:t}=b;t!==l.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else{const{pairedPreviousMatchUpisWOWO:e}=cl({winnerMatchUp:p,drawPosition:n,structure:l,matchUpsMap:r});if(e&&b){const e=fl({drawDefinition:t,drawPosition:n,matchUpId:b.matchUpId,iterative:"brightred",matchUpsMap:r,inContextDrawMatchUps:a});if(e.error)return e}}if((null==D?void 0:D.linkCondition)===Qo&&2===g.filter(Boolean).length&&!y){if(A.filter((({drawPositions:t,roundNumber:e})=>1===e&&st(t,g))).every((({matchUpStatus:t})=>[U,C].includes(t)))&&N){const{structureId:e}=N,i=ul({drawDefinition:t,structureId:e,drawPosition:P,matchUpsMap:r});if(i.error)return i}}return m?dt:{error:Ut,drawPosition:n}}function ml(t){const{drawDefinition:e,matchUpsMap:i,targetData:n,structure:r}=t;if(r.structureType===qo)return dt;const{matchUp:a,targetMatchUps:o,targetLinks:s}=n,{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}=o;if(c){const{loserTargetLink:t}=s,n=gl({drawDefinition:e,loserMatchUp:c,loserTargetLink:t,loserTargetDrawPosition:d,matchUpsMap:i});if(n.error)return n}if(u){const e=function(t){const{inContextDrawMatchUps:e,drawDefinition:i,sourceMatchUp:n,winnerMatchUp:r,matchUpsMap:a,structure:o,matchUpId:s}=t,c=a.drawMatchUps.find((t=>t.matchUpId===r.matchUpId));if(!c)return{error:me};const u=(null==n?void 0:n.drawPositions)||[];let d=c.drawPositions.filter(Boolean);st(u,d)&&(d=d.filter((t=>!u.includes(t))));if(d.length>1)return{error:Ut};const{pairedPreviousMatchUpisWOWO:l}=cl(t),p=id({matchUpId:r.matchUpId,structure:o,drawDefinition:i,inContextDrawMatchUps:e}),{targetMatchUps:h,targetLinks:f}=p,{winnerMatchUp:m,loserMatchUp:g,loserTargetDrawPosition:v}=h;if(g){const{loserTargetLink:t}=f,e=gl({drawDefinition:i,loserMatchUp:g,loserTargetLink:t,loserTargetDrawPosition:v,matchUpsMap:a});if(e.error)return e}const y=c.drawPositions.filter(Boolean),I=1===y.length&&hl({drawPosition:y[0],inContextDrawMatchUps:e,matchUpId:s})||void 0,w=c.matchUpStatus===R&&!y.length,S=1===c.finishingRound,b=w&&!S?E:R,U=nl({...t,matchUp:c,winningSide:I,matchUpStatus:b});if(U.error)return U;if(w)return ml({...t,targetData:p});if(!m)return{...dt};const N=d[0];if(N)return fl({drawDefinition:i,inContextDrawMatchUps:e,matchUpId:m.matchUpId,drawPosition:N});if(l){const n=a.drawMatchUps.find((t=>t.matchUpId===m.matchUpId));if(!n)return{error:me};const r=n.drawPositions.filter(Boolean);if(1===r.length){const t=hl({matchUpId:s,drawPosition:r[0],inContextDrawMatchUps:e});console.log("existing drawPosition is winningSide",{walkoverWinningSide:t})}const o=n.matchUpStatus===R?R:E,c=nl({matchUpId:n.matchUpId,matchUp:n,removeScore:!0,drawDefinition:i,matchUpStatus:o});if(c.error)return c;if(o===E){const e=ml({...t,targetData:p,matchUpId:s});if(e.error)return e}}return dt}({...t,matchUpId:u.matchUpId,sourceMatchUp:a,winnerMatchUp:u});if(e.error)return e}return dt}function gl(t){var e;const{drawDefinition:i,loserTargetLink:n,loserTargetDrawPosition:r,matchUpsMap:a}=t,o=null==n||null===(e=n.target)||void 0===e?void 0:e.structureId,{structure:s}=jc({drawDefinition:i,structureId:o});return s?ul({drawDefinition:i,structureId:o,drawPosition:r,matchUpsMap:a}):{error:Wt}}function vl(t){const{drawDefinition:e,matchUp:i,structure:n,matchUpStatus:r}=t,a=r===S,o=i.winningSide,s=r===E,c=Hd({matchUpStatus:r}),u=Wd({matchUpStatus:r}),d=o&&s;return!c&&!u&&{error:ie}||o&&c&&!s&&yl(t)||d&&function(t){let e=al(t);return e.error?e:ml(t)}(t)||o&&al(t)||u&&nl({...t,removeScore:[b,R].includes(r),matchUpStatus:r||x})||a&&function({drawDefinition:t,structure:e,matchUp:i}){var n;if(null!=i&&i.winningSide)return{error:ae,matchUpStatus:S};const{positionAssignments:r}=Du({structure:e}),a=r.filter((t=>t.bye)).map((t=>t.drawPosition));return(null===(n=i.drawPositions)||void 0===n?void 0:n.some((t=>a.includes(t))))?(i.matchUpStatus=S,i.matchUpStatusCodes=[],Uc({drawDefinition:t,matchUp:i}),dt):{error:"Cannot Assign BYE status if no assignment: { bye: true }"}}({drawDefinition:e,matchUp:i,structure:n})||!c&&{error:ie}||s&&function(t){const e=yl({...t,removeScore:!0});return e.error?e:ml(t)}(t)||{error:ae}}function yl(t){var e;const i=t.isCollectionMatchUp&&(null===(e=t.dualMatchUp)||void 0===e?void 0:e.winningSide)&&t.projectedWinningSide,n=Boolean(t.matchUp.collectionId),r=nl(t);if(n){const{matchUpTieId:e,drawDefinition:n}=t,{removeWinningSide:r}=rl({matchUpId:e,drawDefinition:n});console.log("atsms",{removeWinningSide:r,removeDirected:i})}return r}function Il({tournamentRecord:t,drawDefinition:e,event:i}){const n=(null==t?void 0:t.events)||i&&[i],r=(null==n?void 0:n.map((t=>null==t?void 0:t.drawDefinitions)).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=r.map((({structures:t})=>null==t?void 0:t.filter((t=>null==t?void 0:t.structures)))).flat().filter(Boolean);for(const c of s){const{structures:t,structureId:e}=c||{};t&&(a[e]=null==t?void 0:t.map((t=>t.structureId)))&&t.forEach((t=>o[t.structureId]=c.structureId))}return{containedStructures:a,containerStructures:o}}function wl({drawDefinition:t,structureId:e}){if(!t)return{error:yt};const{structure:i}=jc({drawDefinition:t,structureId:e}),n=((null==t?void 0:t.links)||[]).filter((t=>{var i;return(null===(i=t.source)||void 0===i?void 0:i.structureId)===e})).map((t=>{var e;return null===(e=t.target)||void 0===e?void 0:e.structureId}));return{playoffStructures:((null==t?void 0:t.structures)||[]).filter((t=>n.includes(t.structureId)&&t.stage===jo)),structure:i}}function Sl(t){if(null==t||!t.drawDefinition)return{error:yt};const e=od(t),{completedMatchUps:i,pendingMatchUps:n,upcomingMatchUps:r}=e||{};return!!((null==i?void 0:i.length)&&!(null!=n&&n.length)&&!r.length)}function bl(t){var e,i;const{drawDefinition:n,structureId:r}=t;if(!n)return{error:yt};const{playoffStructures:a}=wl({drawDefinition:n,structureId:r});if(null==a||!a.length)return!1;const o=(null==n||null===(e=n.entries)||void 0===e||null===(i=e.filter((t=>du.includes(null==t?void 0:t.entryStatus))))||void 0===i?void 0:i.length)||0;let s=0;return(a||[]).reduce(((t,e)=>{var i;return!(null!=e&&null!==(i=e.positionAssignments)&&void 0!==i&&i.filter((t=>(t.participantId&&s++,!(null!=t&&t.bye||null!=t&&t.participantId)))).length)&&t}),!0)||s===o}function Ul({drawDefinition:t,structure:e,matchUp:i}){const n=[];if(e.finishingPosition===Ns){if(Sl({drawDefinition:t,structure:e})){const{structureIds:r}=function({drawDefinition:t,structure:e,matchUp:i}){const{drawPositions:n}=i,{positionAssignments:r}=Eu({drawDefinition:t,structure:e}),a=r.filter((({drawPosition:t})=>n.includes(t))).map((t=>{var e;const{extension:i}=ra({element:t,name:$r});return null==i||null===(e=i.value)||void 0===e?void 0:e.groupOrder})),{containerStructures:o}=Il({drawDefinition:t}),s=o[e.structureId],{links:{source:c}}=ed({drawDefinition:t,structureId:s});return{structureIds:null==c?void 0:c.filter((t=>{var e;return st(a,(null===(e=t.source)||void 0===e?void 0:e.finishingPositions)||[])})).map((t=>t.source.structureId))}}({drawDefinition:t,structure:e,matchUp:i});null!=r&&r.length&&n.push(...r)}}return{connectedStructureIds:n}}function Nl({drawDefinition:t,drawPosition:e,structure:i}){var n,r,a;const o=null==i||null===(n=i.matchUps)||void 0===n?void 0:n.find((t=>{var i;return null===(i=t.drawPositions)||void 0===i?void 0:i.includes(e)})),s=null==o?void 0:o.roundNumber,c=null==i||null===(r=i.matchUps)||void 0===r?void 0:r.filter((t=>t.roundNumber===s)).map((({drawPositions:t})=>t)).flat(),u=null==i||null===(a=i.positionAssignments)||void 0===a?void 0:a.filter((({drawPosition:t,participantId:e})=>c.includes(t)&&e)).map(Mc);return t.entries.filter((({entryStatus:t})=>[eu,ru,tu].includes(t))).map(Mc).filter((t=>!u.includes(t)))}function Pl({drawPositions:t,structure:e}){if([Lo,Oo].includes(e.stage)&&1===e.stageSequence)return;const{positionAssignments:i}=Eu({structure:e});i.filter((({drawPosition:e})=>t.includes(e))).forEach((t=>{Gc({element:t,extension:{name:Fr,value:!0}})}))}function El({drawDefinition:t,positionAction:e}){const{extension:i}=ra({element:t,name:"positionActions"});Gc({element:t,extension:{name:"positionActions",value:Array.isArray(null==i?void 0:i.value)?i.value.concat(e):[e]}})}function Dl({participantsCount:t,cluster:e}){const i=K(t),n=rt(1,i+1);let r=[],a=i/2;for(;a>1;){const t=ct(n,a),i=t.length;t.forEach(((t,n)=>{let a;const o=n<i/2,s=n%2==0,c=t[0],u=t[t.length-1];a=e&&i>4?8===i?o?u:c:s?c:u:o?c:u,st(t,r)||r.push(a)})),a/=2}const o=n.filter((t=>!r.includes(t)));for(;o.length;)o.length%2==0?r.push(o.pop()):r.push(o.shift());const s=rt(0,20).map((t=>Math.pow(2,t)));s.unshift(1);const c=s.indexOf(i);let u=0;const d=[];return rt(0,c).forEach((t=>{d.push(r.slice(u,u+s[t])),u+=s[t]})),{seedBlocks:d}}function Al({drawDefinition:t,appliedPolicies:e,allPositions:i,structure:n}){var r;let a,o,s,c,u=0,d=[];if(!n)return{error:Wt};const{roundMatchUps:l}=Ru({roundFilter:1,structure:n}),{seedAssignments:p}=Uu({drawDefinition:t,structure:n}),{positionAssignments:h}=Du({structure:n}),f=h.length,m=(null==p?void 0:p.length)||0;let g=[];const v=Object.keys(l).sort(((t,e)=>t-e)).map((t=>{const e=l[t].map((t=>t.drawPositions)).flat(1/0).filter(Boolean),i=e.filter((t=>!g.includes(t)));return g=g.concat(...e),i})).filter((t=>t.length)).reverse(),y=v.pop(),I=y&&Math.min(...y)-1||0,w=null==e||null===(r=e.seeding)||void 0===r?void 0:r.seedingProfile,S=(null==y?void 0:y.length)||0,b=v.filter((t=>t.filter((t=>t<=m)).length)),U=i?f:m;if(n.structureType===qo){if(c=!0,({validSeedBlocks:d,error:o}=function({seedingProfile:t,structure:e,seedBlocks:i}){const n=e.structures||[],r=[];for(const l of n){const{positionAssignments:e}=Du({structure:l}),n=Math.min(...e.map((t=>t.drawPosition)))-1,a=e.length;let o,s;if(W(a)?({blocks:o,error:s}=Tl({seedBlocks:i,baseDrawSize:a,seedingProfile:t,drawPositionOffset:n,seedCountGoal:a})):({blocks:o,error:s}=Cl({baseDrawSize:a,drawPositionOffset:n,seedCountGoal:a})),s)return{error:s};r.push(o)}const a=r.map((t=>t.map((t=>t.seedNumbers.map(((e,i)=>({seedNumber:e,drawPosition:t.drawPositions[i]}))))))).flat(1/0).sort(((t,e)=>t.seedNumber-e.seedNumber)).reduce(((t,e)=>{const i=e.seedNumber;return t[i]||(t[i]=[]),t[i].push(e.drawPosition),t}),{});let o=1,s=[];a[1]&&a[1].forEach(((t,e)=>{s.push({seedNumbers:[e+1],drawPositions:[t]}),o++}));[[2],[3,4],[5,6,7,8],rt(9,17)].forEach((t=>{const e=[].concat(...t.map((t=>a[t]||[]))),i=e.map(((t,e)=>o+e)),n={seedNumbers:i,drawPositions:e};s.push(n),o+=i.length}));const c=(t,e)=>t-e,u=(t,e)=>e-t,d=Object.keys(a).map(((t,e)=>a[t].sort(e%2?u:c))).flat().map(((t,e)=>({seedNumbers:[e+1],drawPositions:[t]})));e.seedingProfile===Ho&&(s=d);return{validSeedBlocks:s}}({seedingProfile:w,structure:n})),o)return{error:o}}else if(v.length){s=!0,d=b.map((t=>({seedNumbers:t,drawPositions:t})));const t=b.flat(1/0);a=t.length<U?U-t.length:0,u=t.length}else a=U;if(!c){const{blocks:t,error:e}=Tl({baseDrawSize:S,seedingProfile:w,seedCountGoal:a,seedNumberOffset:u,drawPositionOffset:I});if(e)return{error:e,validSeedBlocks:[],isContainer:c,isFeedIn:s};t.forEach((t=>d.push(t)))}const N=[].concat(...d.map((t=>t.drawPositions))).reduce(((t,e)=>(null==y?void 0:y.includes(e))&&t),!0);return s||c||N?{validSeedBlocks:d,isFeedIn:s,isContainer:c}:{error:Ft,validSeedBlocks:[],isContainer:c,isFeedIn:s}}function Tl({baseDrawSize:t,seedCountGoal:e,seedingProfile:i,drawPositionOffset:n=0,seedNumberOffset:r=0}){let a=1;const o=[],{seedBlocks:s}=Dl({participantsCount:t,cluster:i===Go});a=0;for(const u of s){if(a+1>e)break;const t=u.map((t=>t+n)),i=c(a+1,u.length).map((t=>+t+r));a+=u.length,o.push({drawPositions:t,seedNumbers:i})}return{blocks:o};function c(t,e){return Array.from(new Array(e),((e,i)=>i+t))}}function Cl({baseDrawSize:t,seedCountGoal:e,drawPositionOffset:i=0}){let n=1;const r=[],a=rt(i+1,i+t+1);return[[1],[2],[3,4],[5,6,7,8],rt(9,17),rt(17,33),rt(33,65)].forEach((t=>{const i=t.map((()=>a.reverse().pop())).filter(Boolean),o={seedNumbers:t=t.slice(0,i.length),drawPositions:i};n<=e&&r.push(o),n+=i.length})),{blocks:r}}function Ml({seedNumber:t,drawDefinition:e,structureId:i,drawPosition:n}){var r,a,o,s;const{structure:c}=jc({drawDefinition:e,structureId:i}),{appliedPolicies:u}=kc({drawDefinition:e}),{validSeedBlocks:d}=Al({structure:c,drawDefinition:e,appliedPolicies:u});if(null!=u&&null!==(r=u.seeding)&&void 0!==r&&null!==(a=r.validSeedPositions)&&void 0!==a&&a.ignore)return!0;if(null!=u&&null!==(o=u.seeding)&&void 0!==o&&null!==(s=o.validSeedPositions)&&void 0!==s&&s.strict){const e=d.find((e=>e.seedNumbers.includes(t)));return((null==e?void 0:e.drawPositions)||[]).includes(n)}return[].concat(...d.map((t=>t.drawPositions))).includes(n)}function xl({drawDefinition:t,structureId:e,randomize:i}){var n;const{structure:r}=jc({drawDefinition:t,structureId:e}),{seedAssignments:a}=Uu({drawDefinition:t,structure:r}),{positionAssignments:o}=Du({structure:r}),s=o.filter((t=>t.participantId||t.bye||t.qualifier)).map((t=>t.drawPosition)).filter(Boolean),{appliedPolicies:c}=kc({drawDefinition:t}),{validSeedBlocks:u}=Al({structure:r,drawDefinition:t,appliedPolicies:c}),d=(u||[]).filter((t=>t.drawPositions.filter((t=>!s.includes(t))).length))[0],l=a.map((t=>t.participantId)).filter(Boolean),p=o.map((t=>t.participantId)).filter(Boolean),h=l.filter((t=>p.includes(t))),f=l.filter((t=>!p.includes(t))),m=a.filter((t=>f.includes(t.participantId))),g=a.filter((t=>!t.participantId)),v=(m.length||g.length)&&(null==d?void 0:d.drawPositions.filter((t=>!s.includes(t))))||[],y=i?Q(v):v,I=[],w=y.map((()=>{const t=function(t,e){const i=t.filter((t=>!e.includes(t.participantId))),n=Math.min(...i.map((t=>t.seedValue))),r=i.filter((t=>t.seedValue===n));return Q(r).pop()}(m,I),e=t&&t.participantId;return e&&I.push(e),e})).filter(Boolean),S=a.filter((t=>h.includes(t.participantId))).map((t=>t.seedNumber)),b=(d&&d.seedNumbers||[]).filter((t=>!S.includes(t))),U=a.filter((t=>b.includes(t.seedNumber))).map((t=>t.participantId)),N=null==c||null===(n=c.seeding)||void 0===n?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:d,unplacedSeedParticipantIds:void 0===N||N?w:U,unplacedSeedNumbers:b,unfilledPositions:y,unplacedSeedAssignments:m}}function Rl({inContextDrawMatchUps:t,automaticPlacement:e,drawDefinition:i,participantId:n,drawPosition:r,matchUpsMap:a,structureId:o,event:s}){a=a||Lc({drawDefinition:i}),t||({matchUps:t}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:a}));const{structure:c,error:u}=jc({drawDefinition:i,structureId:o});if(u)return{error:u};const{positionAssignments:d}=Du({structure:c}),{seedAssignments:l}=Uu({drawDefinition:i,structure:c}),p=l.find((t=>t.participantId===n)),h=null==p?void 0:p.seedNumber;if(h){if(!Ml({structureId:o,drawPosition:r,drawDefinition:i,seedNumber:h}))return{error:bt}}const f=d.find((t=>t.drawPosition===r));if(!f)return{error:At};if(!n)return{error:Ye};if(!(null!=c&&c.structures||null!=c&&c.matchUps.find((({roundPosition:t})=>!!t)))?!Nl({drawDefinition:i,drawPosition:r,structure:c}).includes(n):d.map(Mc).includes(n))return{error:ri};const{containsParticipant:m,containsBye:g}=function(t){const e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,containsParticipant:n,filled:e||i||n}}(f);if(m&&f.participantId!==n){const{activeDrawPositions:t}=zd({drawDefinition:i,structureId:o});if(t.includes(r))return{error:Dt}}if(g){let e=$d({drawDefinition:i,drawPosition:r,structureId:o,matchUpsMap:a,inContextDrawMatchUps:t});if(e.error)return e}if(f.participantId=n,c.structureType!==qo?function({inContextDrawMatchUps:t,automaticPlacement:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structure:a,event:o}){const s={isCollectionMatchUp:!1},{matchUps:c}=Ru({inContextDrawMatchUps:t,drawDefinition:i,matchUpFilters:s,matchUpsMap:r,structure:a,event:o}),{roundMatchUps:u}=Oc({matchUps:c}),{initialRoundNumber:d}=Id({drawPosition:n,matchUps:c}),l=u[d].find((t=>t.drawPositions.includes(n)));if(l){const a=fl({drawDefinition:i,drawPosition:n,automaticPlacement:e,matchUpId:l.matchUpId,matchUpsMap:r,inContextDrawMatchUps:t});if(a.error);}}({inContextDrawMatchUps:t,positionAssignments:d,automaticPlacement:e,drawDefinition:i,matchUpsMap:a,drawPosition:r,structure:c,event:s}):Kd({inContextDrawMatchUps:t,positionAssignments:d,drawDefinition:i,matchUpsMap:a,structure:c}),!e){Pl({structure:c,drawPositions:[r]});El({drawDefinition:i,positionAction:{name:"positionAssignment",drawPosition:r,structureId:o,participantId:n}})}return Pc({drawDefinition:i,structureIds:[o]}),Object.assign({positionAssignments:d},dt)}function kl(t){const{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:n,loserDrawPosition:r,loserTargetLink:a,drawDefinition:o,loserMatchUp:s,dualMatchUp:c,matchUpsMap:u,event:d}=t,l=a.linkCondition,p=s.drawPositions||[],h=l===Qo&&2===s.roundNumber&&Math.min(...p.filter(Boolean)),f=h||p[e],m=h||p[1-e],g=a.source.structureId,{structure:v}=jc({drawDefinition:o,structureId:g}),{matchUps:y}=Ru({inContext:!0,drawDefinition:o,structure:v,event:d}),I=y.filter((t=>t.drawPositions.includes(r))).filter((t=>{var e;const i=t.sides.find((t=>t.drawPosition===r)),n=t.matchUpStatus===R||t.matchUpStatus===P&&!(null===(e=t.score)||void 0===e||!e.scoreStringSide1);return(null==i?void 0:i.sideNumber)===t.winningSide&&!n})),w=l===Qo&&0===I.length,{positionAssignments:S}=Du({drawDefinition:o,structureId:g}),b=S.find((t=>t.drawPosition===r)),U=null==b?void 0:b.participantId,N=a.target.structureId,{positionAssignments:E}=Du({drawDefinition:o,structureId:N}),D=E.filter((({drawPosition:t})=>p.includes(t)));if(D.some((t=>t.participantId===U)))return dt;const A=D.filter((t=>{const e=p.includes(t.drawPosition),i=!t.participantId&&!t.bye&&!t.qualifier;return e&&i})).map((t=>t.drawPosition)),T=A.includes(f),C=a.target.roundNumber>1&&A.length,M=1===a.target.roundNumber&&T;if(h){const t=w?k():ul({drawDefinition:o,structureId:N,drawPosition:m});if(t.error)return t}else if(M){const t=k();if(t.error)return t}else{if(!C)return{error:At};{const t=A.sort(Wn)[0],e=Rl({participantId:U,structureId:N,drawPosition:t,automaticPlacement:!0,inContextDrawMatchUps:i,drawDefinition:o,matchUpsMap:u});if(e.error)return e}}if(c&&n){var x;const t=null===(x=c.sides)||void 0===x?void 0:x.find((t=>t.sideNumber===3-n));if(null!=t&&t.lineUp){const{roundNumber:e}=s,{roundPosition:i}=c,n=1===e?i%2+1:1,{matchUp:r}=ku({matchUpId:s.matchUpId,drawDefinition:o,matchUpsMap:u,event:d}),a=[1,2].map((t=>{var e;return{...(null===(e=r.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));r.sides=a;const l=r.sides.find((t=>t.sideNumber===n));l&&(l.lineUp=t.lineUp,Uc({drawDefinition:o,matchUp:r}))}}return{...dt};function k(){return Rl({drawDefinition:o,participantId:U,structureId:N,drawPosition:f,automaticPlacement:!0,matchUpsMap:u,inContextDrawMatchUps:i})}}function Ol(t){const{dualWinningSideChange:e,projectedWinningSide:i,inContextDrawMatchUps:n,matchUpStatusCodes:r,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:l,targetData:p,matchUpId:h,structure:f,matchUp:m,event:g,score:v}=t,y=Boolean(m.collectionId);if(!(y||function({structure:t,matchUp:e}){const{drawPositions:i}=e,{positionAssignments:n}=Du({structure:t});return 2===n.filter((t=>i.includes(t.drawPosition)&&t.participantId)).length}({structure:f,matchUp:m})))return{error:Zt};const I=Hd({matchUpStatus:c}),w=[R].includes(c),S=nl({matchUpStatusCodes:I&&r||[],matchUpStatus:I&&c||U,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,removeScore:w,winningSide:l,matchUpId:h,matchUp:m,event:g,score:v});if(S.error)return S;let b=m.drawPositions;if(y){const{matchUpTieId:i}=t;rl({matchUpId:i,drawDefinition:o,structure:f,event:g});const r=n.find((({matchUpId:t})=>t===i));if(b=null==r?void 0:r.drawPositions,!e)return{...dt}}if(!b)return{error:Et};{const t=l-1,e=1-t,r=b[t],a=b[e],{targetLinks:{loserTargetLink:s,winnerTargetLink:h},targetMatchUps:{winnerMatchUpDrawPositionIndex:f,loserMatchUpDrawPositionIndex:m,winnerMatchUp:v,loserMatchUp:y}}=p;if(v){const t=function({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,winningDrawPosition:n,winnerTargetLink:r,drawDefinition:a,winnerMatchUp:o,dualMatchUp:s,matchUpsMap:c,event:u}){if(r){const i=o.drawPositions||[],s=i[t],u=r.source.structureId,{positionAssignments:d}=Du({structureId:u,drawDefinition:a}),l=d.find((t=>t.drawPosition===n)),p=null==l?void 0:l.participantId,h=r.target.structureId,{positionAssignments:f}=Du({structureId:h,drawDefinition:a}),m=f.find((t=>t.participantId===p)),g=null==m?void 0:m.drawPosition,v=f.filter((t=>{const e=i.includes(t.drawPosition),n=!t.participantId&&!t.bye&&!t.qualifier;return e&&n})).map((t=>t.drawPosition)),y=v.includes(s);if(1===r.target.roundNumber&&y)Rl({drawPosition:s,participantId:p,structureId:h,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});else if(v.length){const t=v.pop();Rl({participantId:p,structureId:h,inContextDrawMatchUps:e,drawDefinition:a,drawPosition:t,matchUpsMap:c})}else{if(!g){const t="winner target position unavaiallble";return console.log(t),{error:t}}{const t=fl({drawPosition:g,matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});if(t.error)return t}}}else{const t=fl({matchUpId:o.matchUpId,drawPosition:n,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});if(t.error)return t}if(s&&i){var d;const t=null===(d=s.sides)||void 0===d?void 0:d.find((t=>t.sideNumber===i));if(null!=t&&t.lineUp){const e=s.roundPosition,i=o.roundPosition,n=e===i&&1!==e||Math.floor(e/2)===i?2:1,{matchUp:r}=ku({matchUpId:o.matchUpId,drawDefinition:a,matchUpsMap:c,event:u}),d=[1,2].map((t=>{var e;return{...(null===(e=r.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));r.sides=d;const l=r.sides.find((t=>t.sideNumber===n));l&&(l.lineUp=t.lineUp,Uc({drawDefinition:a,matchUp:r}))}}return{...dt}}({winnerMatchUpDrawPositionIndex:f,inContextDrawMatchUps:n,projectedWinningSide:i,winningDrawPosition:r,winnerTargetLink:h,drawDefinition:o,winnerMatchUp:v,dualMatchUp:u,matchUpsMap:d,event:g});if(t.error)return t}if(y){const t=kl({loserMatchUpDrawPositionIndex:m,inContextDrawMatchUps:n,projectedWinningSide:i,loserDrawPosition:a,loserTargetLink:s,drawDefinition:o,matchUpStatus:c,loserMatchUp:y,winningSide:l,matchUpsMap:d,dualMatchUp:u,event:g});if(t.error)return t}}return dt}function Ll(t){const{drawDefinition:e,targetData:i,structure:n,matchUp:r,matchUpsMap:a,inContextDrawMatchUps:o}=t,{targetLinks:{loserTargetLink:s},targetMatchUps:{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}}=i;if(c){const t=sl({targetLink:s,drawPosition:d,drawDefinition:e,inContextDrawMatchUps:o,matchUpsMap:a});if(t.error)return t}if(u){const i=null==a?void 0:a.drawMatchUps.find((t=>t.matchUpId===u.matchUpId)),{pairedPreviousMatchUp:s}=function({matchUp:t,structureId:e,matchUpsMap:i}){const n=null==t?void 0:t.roundPosition,r=n+(n%2?1:-1);return{pairedPreviousMatchUp:_c({matchUpsMap:i,structureId:e}).find((({roundNumber:e,roundPosition:i})=>e===t.roundNumber&&i===r))}}({matchUp:r,structureId:n.structureId,matchUpsMap:a}),c=(null==s?void 0:s.matchUpStatus)===E,d=(null==s?void 0:s.drawPositions.filter(Boolean))||[],l=[...F,S].includes(null==s?void 0:s.matchUpStatus)||(null==s?void 0:s.winningSide),p=id({matchUpId:u.matchUpId,drawDefinition:e,inContextDrawMatchUps:o}),{targetMatchUps:{winnerMatchUp:h}}=p;if(l){const t=r.drawPositions||[];let i=u.drawPositions.filter(Boolean);st(t,i)&&(i=i.filter((e=>!t.includes(e))));const n=t.concat(d).find((t=>i.includes(t)));if(h&&n){const t=ol({winnerMatchUp:h,drawDefinition:e,winningDrawPosition:n,matchUpsMap:a,inContextDrawMatchUps:o});if(t.error)return t}}Ll({drawDefinition:e,targetData:p,structure:n,matchUp:u,matchUpsMap:a,inContextDrawMatchUps:o});let f=[R,E].includes(null==i?void 0:i.matchUpStatus)&&c?R:x;const m=!c;let g=nl({...t,matchUpStatus:f,removeScore:m,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:i,matchUpId:u.matchUpId});if(g.error)return g}return{...dt}}function _l({score:t}={}){const{sets:e,scoreStringSide1:i,scoreStringSide2:n}=t||{};return!!t&&(!(!i&&!n)||!(null==e||!e.length)&&Object.values(e[0]).some((t=>t)))}function Fl(t){const{matchUp:e,matchUpStatus:i,score:n,winningSide:r}=t;if((null==e?void 0:e.matchUpStatus)===E&&i!==E){const e=Ll(t);if(e.error)return e}const a=i===E,o=_l({score:n})&&!a&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),s=![A,I].includes(i||A),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!_l({score:n}),u=i&&i!==x,d=({removeScore:i}={})=>{let n;const{structure:r,drawDefinition:a}=t,{connectedStructureIds:o}=Ul({drawDefinition:a,structure:r,matchUp:e});o.length&&(console.log({connectedStructureIds:o}),n=!0),Object.assign(t,{removeScore:i});const s=al(t);return s.error?s:{...dt,connectedStructures:n}};return r&&function(t){const{drawDefinition:e,winningSide:i,structure:n,matchUp:r}=t;let a;if(r.winningSide&&r.winningSide!==i){const{connectedStructureIds:i}=Ul({drawDefinition:e,structure:n,matchUp:r});i.length&&(console.log({connectedStructureIds:i}),a=!0);const o=al(t);if(o.error)return o}const o=Ol(t);return o.error?o:{...dt,connectedStructures:a}}(t)||o&&d({removeScore:s})||u&&vl(t)||c&&d()||e&&function(t){var e;const i=Boolean(t.matchUp.collectionId),n=t.isCollectionMatchUp&&(null===(e=t.dualMatchUp)||void 0===e?void 0:e.winningSide)&&t.projectedWinningSide,r=nl({...t,removeScore:!0});if(i){const{matchUpTieId:e,drawDefinition:i,structure:r,event:a}=t,{removeWinningSide:o}=rl({matchUpId:e,drawDefinition:i,structure:r,event:a});console.log("ndd",{removeWinningSide:o,removeDirected:n})}return r}({...t,removeScore:!0})||console.log("unknown condition")&&{...dt}}function jl(t){const{inContextDrawMatchUps:e,targetData:i,drawDefinition:n}=t,{targetMatchUps:{loserMatchUp:r,winnerMatchUp:a}}=i,o=(null==a?void 0:a.drawPositions.filter(Boolean).length)||0;if(null!=r&&r.winningSide||2===o&&null!=a&&a.winningSide)return!0;let s=r&&id({matchUpId:r.matchUpId,drawDefinition:n,inContextDrawMatchUps:e}),c=a&&id({matchUpId:a.matchUpId,drawDefinition:n,inContextDrawMatchUps:e});const u=s&&jl({inContextDrawMatchUps:e,drawDefinition:n,targetData:s});return!(!(c&&jl({inContextDrawMatchUps:e,drawDefinition:n,targetData:c}))&&!u)}function Bl(t){var e;const{allowChangePropagation:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,winningSide:o,matchUpId:s,event:c}=t;if(!r)return{error:yt};if([b,A,I,x].includes(a)&&o)return{error:_i,winningSide:o,matchUpStatus:a};if(![void 0,...O].includes(a))return{error:ae};const u=Lc({drawDefinition:r});let{matchUps:d}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:u});!!d.find((({winnerMatchUpId:t,loserMatchUpId:e})=>t||e))||({inContextDrawMatchUps:d}=Sd({inContextDrawMatchUps:d,drawDefinition:r,matchUpsMap:u}));const l=u.drawMatchUps.find((t=>t.matchUpId===s)),p=d.find((t=>t.matchUpId===s));if(!l||!d)return{error:he};if((l.winningSide||o)&&a===S)return{error:re,matchUpStatus:a};const h=null===(e=p.drawPositions)||void 0===e?void 0:e.filter(Boolean);if(a&&k.includes(a)&&(!h||(null==h?void 0:h.length)<2))return{error:ae};if(l.matchUpType===la)return{error:"DIRECT SCORING of TEAM matchUp not implemented"};const f=p.matchUpTieId,m=id({matchUpId:f||s,inContextDrawMatchUps:d,drawDefinition:r}),g=p.structureId,{structure:v}=jc({drawDefinition:r,structureId:g});let y;if(Object.assign(t,{inContextDrawMatchUps:d,inContextMatchUp:p,matchUpTieId:f,matchUpsMap:u,targetData:m,structure:v,matchUp:l}),f){const{matchUp:e}=ku({matchUpId:f,inContext:!0,drawDefinition:r,matchUpsMap:u,event:c}),i=e.tieFormat||r.tieFormat,{projectedWinningSide:n}=function({drawDefinition:t,winningSide:e,dualMatchUp:i,tieFormat:n,structure:r,matchUp:a,event:o}){const s=a.winningSide;let c=[0,0];1===e&&2===s?c=[1,-1]:2===e&&1===s?c=[-1,1]:e&&!s?c=1===e?[1,0]:[0,1]:s&&!e&&(c=1===s?[-1,0]:[0,-1]),n=n||(null==a?void 0:a.tieFormat)||(null==r?void 0:r.tieFormat)||(null==t?void 0:t.tieFormat)||(null==o?void 0:o.tieFormat);const{winningSide:u}=xa({matchUp:i,sideAdjustments:c,tieFormat:n});return{projectedWinningSide:u}}({winningSide:o,dualMatchUp:e,tieFormat:i,structure:v,matchUp:l,event:c});y=n!==e.winningSide,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:y,projectedWinningSide:n,matchUpTieId:f,dualMatchUp:e,tieFormat:i})}const w=jl(t),U=Hd({matchUpStatus:a});if(!f){if(w&&!o&&Wd({matchUpStatus:a}))return{error:re,activeDownstream:w,winningSide:o};if(o&&o===l.winningSide&&a&&!U)return{error:re,directingMatchUpStatus:U,matchUpStatus:a}}const{schedule:N}=t;if(N){const t=Wu({tournamentRecord:n,disableNotice:!0,drawDefinition:r,matchUpId:s,schedule:N});if(t.error)return t}const P=l.matchUpType!==la&&!y&&o&&l.winningSide&&l.winningSide!==o;if(i&&P&&l.roundPosition)return function(t){var e;const{inContextMatchUp:i,structure:n,drawDefinition:r}=t,a=i.roundNumber,o=i.sides.find((t=>t.sideNumber===i.winningSide)),s=i.sides.find((t=>t.sideNumber!==i.winningSide)),{drawPosition:c,participantId:u}=o,{drawPosition:d,participantId:l}=s,{matchUps:p}=Ru(t),h=p.filter((({drawPositions:t,roundNumber:e})=>t.includes(c)&&e>a));Xi({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach((t=>{t.drawPositions=t.drawPositions.map((t=>t===c?d:t)),Uc({drawDefinition:r,matchUp:t})}));const{stage:f,stageSequence:m}=n,g=r.structures.filter((({stage:t,stageSequence:e})=>t===f&&e>m)).map((({structureId:t})=>t)),{targetLinks:{loserTargetLink:v,winnerTargetLink:y}}=t.targetData,I=[null==v?void 0:v.target.structureId,null==y||null===(e=y.target)||void 0===e?void 0:e.structureId].filter(Boolean);return r.structures.filter((({stage:t,structureId:e})=>t!==f&&I.includes(e))).forEach((({stage:t,stageSequence:e,structureId:i})=>{g.includes(i)||g.push(i),r.structures.filter((({stage:i,stageSequence:n})=>i===t&&n>e)).forEach((({structureId:t})=>{g.includes(t)||g.push(t)}))})),r.structures.filter((({structureId:t})=>g.includes(t))).forEach((t=>{const{positionAssignments:e}=Eu({structure:t}),i=e.find((({participantId:t})=>t===u)),n=e.find((({participantId:t})=>t===l));i&&(i.participantId=l),n&&(n.participantId=u)})),nl(t)}(t);const E=o&&!f||t.projectedWinningSide;return!w&&Fl(t)||E&&function(t){const{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?Vl(t):{error:Be}}(t)||U&&Vl(t)||{error:ji}}function Vl(t){const{matchUp:e,event:i}=t,n=t.isCollectionMatchUp&&e.winningSide&&!t.winningSide&&!_l({score:t.score}),r=t.isCollectionMatchUp?t.machUpStatus||n&&x:t.matchUpStatus||U,a=[b,R].includes(r)&&![A,I].includes(r),o=nl({...t,matchUpStatus:r,removeWinningSide:n,removeScore:a});if(t.isCollectionMatchUp){const{matchUpTieId:e,drawDefinition:n,structure:r}=t,{removeWinningSide:a}=rl({matchUpId:e,drawDefinition:n,structure:r,event:i});console.log("sms",{removeWinningSide:a})}return o}function Gl(t){const{drawDefinition:e,event:i,matchUpFormat:n,structureId:r,matchUpId:a}=t;let{tieFormat:o}=t;if(!e)return{error:yt};if(!n&&!o)return{error:ce};if(n&&!v(n))return{error:ne};if(o){const t=function(t){const e=Ba({tieFormat:t,checkCollectionIds:!1});if(e.error)return e;for(const i of t.collectionDefinitions)i.collectionId||(i.collectionId=qn());return{tieFormat:t}}(o);if(t.error)return t;o=t.tieFormat}if(a){const{matchUp:t,error:r}=ku({drawDefinition:e,matchUpId:a,event:i});if(r)return{error:r};if(n&&t.matchUpType!==ka)t.matchUpFormat=n;else{if(!o||t.matchUpType!==ka)return{error:_i};t.tieFormat=o}Uc({drawDefinition:e,matchUp:t})}else if(r){const{structure:t,error:i}=jc({drawDefinition:e,structureId:r});if(i)return{error:i};if(!t)return{error:Gt};n&&t.matchUpType!==ka?t.matchUpFormat=n:o&&(t.tieFormat=o)}else e&&(n?e.matchUpFormat=n:o&&(e.tieFormat=o));return Pc({drawDefinition:e,structureIds:r?[r]:void 0}),{...dt,tieFormat:o}}function Hl({score:t,winningSide:e,matchUpStatus:i}={}){if(!t)return{sets:[]};const n=t.sets||[];let r=Do({winnerFirst:!1,matchUpStatus:i,sets:n}),a=Do({winnerFirst:!1,matchUpStatus:i,reversed:!0,sets:n}),o=Do({winningSide:e,matchUpStatus:i,sets:n}),s=r===o?a:r;return e&&(r=1===e?o:s,a=2===e?o:s),{score:{sets:n,scoreStringSide1:r,scoreStringSide2:a}}}function Wl(t){var e;const{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUpId:a,schedule:o,event:s,notes:c}=t;if(!n)return{error:xt};if(!a)return{error:le};const{policy:u}=ea({policyType:sr,tournamentRecord:i,event:s}),d=void 0!==t.allowChangePropagation?t.allowChangePropagation:void 0!==(null==u?void 0:u.allowChangePropagation)?u.allowChangePropagation:void 0;let{outcome:l}=t;if(r){const t=Gl({drawDefinition:n,matchUpFormat:r,matchUpId:a,event:s});if(t.error)return t}if(null!=l&&null!==(e=l.score)&&void 0!==e&&e.sets&&!l.score.scoreStringSide1){const{score:t}=Hl(l);l.score=t,l.score.sets=l.score.sets.filter((t=>t.side1Score||t.side2Score||t.side1TiebreakScore||t.side2TiebreakScore))}return Bl({tournamentRecord:i,drawDefinition:n,event:s,matchUpStatusCodes:null==l?void 0:l.matchUpStatusCodes,matchUpStatus:null==l?void 0:l.matchUpStatus,matchUpFormat:r,matchUpId:a,winningSide:null==l?void 0:l.winningSide,allowChangePropagation:d,score:null==l?void 0:l.score,schedule:o,notes:c})}function ql(t){if(!t.tournamentRecord)return{error:ft};const{tournamentRecord:e,outcomes:i}=t,n={};i.forEach((t=>{const{eventId:e}=t;n[e]||(n[e]=[]),n[e].push(t)}));for(const r of Object.keys(n)){const{event:t}=Ia({tournamentRecord:e,eventId:r});for(const i of n[r]){const{drawId:n}=i,r=t.drawDefinitions.find((t=>t.drawId===n));if(r){const{matchUpFormat:a,matchUpId:o}=i,s=Wl({tournamentRecord:e,drawDefinition:r,event:t,drawId:n,matchUpFormat:a,matchUpId:o,schedule:null==i?void 0:i.schedule,outcome:i});if(s.error)return s}}}return dt}function zl({tournamentRecord:t}){if(!t)return{error:ft};const e=t.tournamentId,{extension:i}=aa({tournamentRecord:t,name:Yr});let n=(null==i?void 0:i.value)||[];if(n.length){const i=t.venues.map((({venueId:t,courts:e})=>(null==e?void 0:e.length)&&t)),{eventIds:r,drawIds:a}=vd({tournamentRecords:{[e]:t}}),{updatedSchedulingProfile:o,modifications:s,issues:c}=Od({schedulingProfile:n,venueIds:i,eventIds:r,drawIds:a});if(s){n=o;const e=function({tournamentRecord:t,schedulingProfile:e}){return Wc({tournamentRecord:t,extension:{name:Yr,value:e}})}({tournamentRecord:t,schedulingProfile:n});return e.error?e:{schedulingProfile:n,modifications:s,issues:c}}}return{schedulingProfile:n,modifications:0}}function Kl({tournamentRecord:t,schedulingProfile:e,requireCourts:i=!0}){if(!e){const{modifications:e,issues:i}=zl({tournamentRecord:t});return{success:!e,modifications:e,issues:i}}const{venueIds:n,eventIds:r,drawIds:a}=Nd({tournamentRecord:t,requireCourts:i}),{modifications:o,issues:s}=Od({schedulingProfile:e,venueIds:n,eventIds:r,drawIds:a});return{success:!o,modifications:o,issues:s}}function Yl({tournamentRecord:t,courtId:e,scheduleVisibilityFilters:i,matchUpFilters:n}){if(!t)return{error:ft};if(!e)return{error:De};const{schedulingProfile:r}=zl({tournamentRecord:t}),{matchUps:a}=ud({tournamentRecord:t,scheduleVisibilityFilters:i,matchUpFilters:n});return{matchUps:function({matchUps:t,courtId:e}){return _d({matchUps:t.filter((t=>{var i;return(null===(i=t.schedule)||void 0===i?void 0:i.courtId)===e})),schedulingProfile:r})}({matchUps:a,courtId:e})}}function Jl({matchUpsCount:t=0}){const e=`Schedule would be deleted from ${t} ${1===t?"matchUp":"matchUps"}; use { force: true }`;return{message:e,error:e}}function $l({startTime:t,endTime:e}={}){if(!vn.test(t)||!vn.test(e))return!1;const[i,n]=t.split(":"),[r,a]=e.split(":");return!(r<i)&&!(i===r&&a<n)}function Zl({dateAvailability:t}){if(!t)return{error:Re};if(!Array.isArray(t))return{error:xe};const e="Times must be 24 hour => 00:00";for(const i of t){if("object"!=typeof i)return{error:xe};const{date:t,startTime:n,endTime:r,bookings:a=[]}=i;if(!n||!r)return{error:xe};if(t&&!gn.test(t))return{error:ke,dateAvailability:{date:t},message:"Dates must be formated => YYYY-MM-DD"};if(!vn.test(n))return{error:Oe,dateAvailability:{startTime:n},message:e};if(!vn.test(r))return{error:Oe,dateAvailability:{endTime:r},message:e};if(n===r)return{error:Oe,dateAvailability:{startTime:n,endTime:r},message:"startTime and endTime are equivalent"};if(!$l({startTime:n,endTime:r}))return{error:Oe,dateAvailability:{startTime:n,endTime:r},message:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:Me};for(const t of a){if("object"!=typeof t)return{error:Me};const{startTime:i,endTime:n}=t;if(!vn.test(i))return{error:Oe,booking:{startTime:i},message:e};if(!vn.test(n))return{error:Oe,booking:{endTime:n},message:e};if(i===n)return{error:Oe,dateAvailability:{startTime:i,endTime:n},message:"startTime and endTime are equivalent"};if(!$l({startTime:i,endTime:n}))return{error:Oe,dateAvailability:{startTime:i,endTime:n},message:"endTime must be after startTime"}}}}return{valid:!0}}function Xl({tournamentRecord:t,dateAvailability:e,disableNotice:i,courtId:n,force:r}){if(!t)return{error:ft};if(!n)return{error:De};const a=Zl({dateAvailability:e});if(a.error)return a;const{court:o,venue:s,error:c}=ju({tournamentRecord:t,courtId:n});return c?{error:c}:(o.dateAvailability=e,i||en({topic:vc,payload:{venue:s},key:s.venueId}),dt)}function Ql({tournamentRecord:t,modifications:e,disableNotice:i,courtId:n,force:r}){if(!t)return{error:ft};if(!n)return{error:De};if(!e||"object"!=typeof e)return{error:Li};const{court:a,venue:o,error:s}=ju({tournamentRecord:t,courtId:n});if(s)return{error:s};const c=Object.keys({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}).filter((t=>"courtId"!==t));if(!Object.keys(e).filter((t=>c.includes(t))).length)return{error:Bi};const u=c.filter((t=>!["dateAvailability"].includes(t)));if(Object.keys(e).filter((t=>u.includes(t))).forEach((t=>Object.assign(a,{[t]:e[t]}))),e.dateAvailability){const a=Xl({tournamentRecord:t,dateAvailability:e.dateAvailability,disableNotice:i,courtId:n,force:r});if(a.error)return a}return i||en({topic:vc,payload:{venue:o},key:o.venueId}),{...dt,court:Vn(a)}}function tp({tournamentRecord:t,disableNotice:e,returnDetails:i,venueId:n,court:r}){const{venue:a}=_u({tournamentRecord:t,venueId:n});if(!a)return{error:wi};a.courts||(a.courts=[]);const o={altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0,venueId:n};o.courtId||(o.courtId=qn());if(a.courts.reduce(((t,e)=>t||e.courtId===o.courtId),void 0))return{error:yi};{const t=((null==r?void 0:r.dateAvailability)||[]).map((t=>{var e;return{...t,date:Mn(t.date),startTime:Cn(t.startTime),endTime:Cn(t.endTime),bookings:null===(e=t.bookings)||void 0===e?void 0:e.map((({startTime:t,endTime:e,bookingType:i})=>({startTime:Cn(t),endTime:Cn(e),bookingType:i})))}}));for(const e of Object.keys(o))if(r[e])if("dateAvailability"===e){const e=Zl({dateAvailability:t}),{valid:i,error:n}=e;if(i)o.dateAvailability=t;else if(n)return{error:n}}else o[e]=r[e];return a.courts.push(o),e||en({topic:vc,payload:{venue:a},key:a.venueId}),Xi()||i?{...dt,court:Vn(o),venueId:n}:{...dt}}}function ep({dateAvailability:t=[],tournamentRecord:e,courtNames:i=[],courtsCount:n,venueId:r}){if(!r)return{error:Si};if(!z(n)||!i)return{error:gi};const a=rt(0,n=n||i.length).map((e=>({courtName:i[e]||`Court ${e+1}`,dateAvailability:t}))).map((t=>tp({tournamentRecord:e,venueId:r,court:t,disableNotice:!0,returnDetails:!0}))),o=a.map((t=>t.court)).filter(Boolean);if(o.length===n){const{venue:t}=_u({tournamentRecord:e,venueId:r});return en({topic:vc,payload:{venue:t},key:t.venueId}),{...dt,courts:Vn(o)}}return Object.assign({},{courts:Vn(o)},{error:a})}function ip({tournamentRecord:t,modifications:e,venueId:i,force:n}){var r,a;if(!t)return{error:ft};if(!e||"object"!=typeof e)return{error:Li};if(!i)return{error:Si};const{venue:o,error:s}=_u({tournamentRecord:t,venueId:i});if(s)return{error:s};const c=Object.keys({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}).filter((t=>"venueId"!==t));if(!Object.keys(e).filter((t=>c.includes(t))).length)return{error:Bi};const u=c.filter((t=>!["courts"].includes(t)));Object.keys(e).filter((t=>u.includes(t))).forEach((t=>Object.assign(o,{[t]:e[t]})));const d=(null==o||null===(r=o.courts)||void 0===r?void 0:r.map((t=>t.courtId)))||[],l=(null===(a=e.courts)||void 0===a?void 0:a.map((t=>t.courtId)))||[],p=d.filter((t=>!l.includes(t)));if(p.length){const e=o.courts.filter((t=>p.includes(t.courtId))).map((e=>{const{matchUps:i}=Yl({tournamentRecord:t,courtId:e.courtId});return i.length})).reduce(((t,e)=>t+e));if(e&&!n){return{error:Jl({matchUpsCount:e})}}o.courts=o.courts.filter((t=>l.includes(t.courtId)))}if(e.courts)for(const h of e.courts){const{courtId:e}=h||{};let r=Ql({tournamentRecord:t,modifications:h,disableNotice:!0,courtId:e,force:n});if(r.error===vi&&(r=tp({tournamentRecord:t,venueId:i,court:h,disableNotice:!0})),r.error)return r}return Kl({tournamentRecord:t}),en({topic:vc,payload:{venue:o},key:o.venueId}),{...dt,venue:Vn(o)}}function np({tournamentRecord:t,drawDefinition:e,drawId:i,matchUpId:n}){if(!n)return{error:le};if(!e&&!i)return{error:xt};let r;if(!e){if(!t)return{error:ft};({drawDefinition:e}=Ia({tournamentRecord:t,drawId:i}))}if(e)({matchUp:r}=ku({drawDefinition:e,matchUpId:n}));else{if(!t)return{error:ft};const{matchUps:e}=pd({tournamentRecord:t});({matchUp:r}=Ma({matchUps:e,matchUpId:n}))}if(!r)return{error:he};if(r.timeItems){if(r.timeItems.reduce(((t,e)=>e.itemType===hr||t),void 0)){const t={itemType:hr,itemValue:"",itemDate:""};r.timeItems.push(t),Uc({drawDefinition:e,matchUp:r})}}return dt}function rp({tournamentRecord:t,venueId:e,force:i}){if(!t)return{error:ft};if("string"!=typeof e)return{error:Si};const{courts:n}=Bu({tournamentRecord:t,venueId:e}),r={courtIds:n.map((t=>t.courtId))},{matchUps:a}=ud({tournamentRecord:t,contextFilters:r});if(a.length&&!i)return Jl({matchUpsCount:a.length});for(const s of a){const e=np({tournamentRecord:t,drawId:s.drawId,matchUpId:s.matchUpId});if(e.error)return e}let o;return t.venues=(t.venues||[]).filter((t=>{if(t.venueId!==e)return!0;o=!0})),o&&en({topic:pc,payload:{venueId:e}}),dt}function ap({flight:t,checkEntryStatus:e=!0,modifyEventEntries:i,existingDrawCount:n,drawDefinition:r,event:a}){var o,s,c,u,d;if(!r)return{error:xt};if(!a)return{error:zt};a.drawDefinitions||(a.drawDefinitions=[]);const{drawId:l,drawName:p,entries:h}=r,{entries:f}=a;let m=0;if(void 0!==n&&n!==a.drawDefinitions.length)return{error:_i,message:"drawDefintions count mismatch"};if(!!a.drawDefinitions.find((t=>t.drawId===l)))return{error:Rt};const{flightProfile:g}=el({event:a}),v=t&&(null==g||null===(o=g.flights)||void 0===o?void 0:o.find((e=>e.flightNumber===t.flightNumber)));if(v&&v.drawId!==r.drawId)return{error:vt,relevantFlight:v};const y=null==v?void 0:v.drawEntries.every((({participantId:t,entryStatus:e})=>{const i=h.find((e=>e&&e.participantId===t));return(null==i?void 0:i.entryStatus)===e})),I=!e||f&&(null==h?void 0:h.every((({participantId:t,entryStatus:e})=>{const i=f.find((e=>e.participantId===t));return(null==i?void 0:i.entryStatus)===e})));if(v&&!y)return{error:vt,relevantFlight:v,matchingEventEntries:I};if(i&&h.filter(Boolean).forEach((t=>{if(du.includes(null==t?void 0:t.entryStatus)){const e=f.filter(Boolean).find((e=>e.participantId===t.participantId));t.entryStatus&&e.entryStatus!==t.entryStatus&&(e.entryStatus=t.entryStatus,m+=1)}})),f&&!I)return{error:vt,eventEntries:f,matchingEventEntries:I};const w=(null==g||null===(s=g.flights)||void 0===s||null===(c=s.map((({flightNumber:t})=>!isNaN(t)&&parseInt(t))))||void 0===c?void 0:c.filter(Boolean))||[],S=(null===(u=a.drawDefinitions.map((({drawOrder:t})=>!isNaN(t)&&parseInt(t))))||void 0===u?void 0:u.filter(Boolean))||[];let b=Math.max(0,...S,...w)+1;const U=null==g||null===(d=g.flights)||void 0===d?void 0:d.find((t=>t.drawId===l));let N;if(U){U.drawName=r.drawName,N={name:Br,value:{...g,flights:g.flights}};const t=U.flightNumber;t&&!S.includes(t)?b=t:U.flightNumber=b}else{const t=(null==g?void 0:g.flights)||[];t.push({manuallyAdded:!0,flightNumber:b,drawEntries:h,drawName:p,drawId:l}),N={name:Br,value:{...g||{},flights:t}}}zc({event:a,extension:N}),Object.assign(r,{drawOrder:b}),a.drawDefinitions.push(r);const{topics:P}=an();if(P.includes(oc)){const{matchUps:t}=dd({drawDefinition:r,event:a});Sc({drawDefinition:r,matchUps:t})}return Nc({drawDefinition:r}),{...dt,modifiedEventEntryStatusCount:m}}function op({tournamentRecord:t,returnDetails:e,disableNotice:i,venue:n}){if(!t)return{error:ft};if(!n)return{error:Ae};t.venues||(t.venues=[]),n.venueId||(n.venueId=qn());return t.venues.reduce(((t,e)=>t||e.venueId===n.venueId),void 0)?{error:Ii}:(t.venues.push(n),i||en({topic:cc,payload:{venue:n}}),Xi({addVenue:!0})?{...dt,venue:Vn(n)}:e?n:{...dt})}function sp({allowDuplicateParticipantIdPairs:t,tournamentRecord:e,disableNotice:i,pairOverride:n,participant:r}){if(!e)return{error:ft};if(!r)return{error:ze};r.participantId||(r.participantId=qn()),e.participants||(e.participants=[]);const{participantId:a}=r;if(e.participants.reduce(((t,e)=>e.participantId===a||t),!1))return{error:$e};const{participantType:o,participantRole:s}=r;if(!Object.keys(_a).includes(o))return{error:We,participantType:o};if(!s)return{error:qe};const c=e.participants||[],u=c.filter((t=>t.participantType===Ra)).map((t=>t.participantId));if(o===Oa){if(r.person)return{error:_i,person:r.person};if(!r.individualParticipantIds)return{error:Xe};if(2!==r.individualParticipantIds.length&&!n)return{error:He,message:"PAIR must be 2 individualParticipantIds"};{const t=c.filter((t=>t.participantType===Ra)).map((t=>t.participantId));if(!Array.isArray(r.individualParticipantIds))return{error:He};if(!r.individualParticipantIds.reduce(((e,i)=>t.includes(i)&&e),!0))return{error:He}}const e=c.filter((t=>t.participantType===Oa)).map((t=>({participant:t,individualParticipantIds:t.individualParticipantIds}))),i=r.participantType===Oa&&e.find((t=>2===ot(t.individualParticipantIds,r.individualParticipantIds).length));if(i&&!t)return{...dt,participant:Vn(i.participant)};if(!r.participantName){const t=c.filter((t=>r.individualParticipantIds.includes(t.participantId)));let e=t.map((t=>{var e;return null===(e=t.person)||void 0===e?void 0:e.standardFamilyName})).filter(Boolean).join("/");1===t.length&&(e+="/Unknown"),r.participantName=e}}else if(o===Ra){if(!r.person||!r.person.standardFamilyName||!r.person.standardGivenName)return{error:ni};if(!r.participantName){const t=`${r.person.standardFamilyName.toUpperCase()}, ${r.person.standardGivenName}`;r.participantName=t,r.name=t}}else{if(r.person)return{error:_i,person:r.person};const{individualParticipantIds:t}=r;if(null!=t&&t.length)for(const e of t){if("string"!=typeof e)return{error:_i,participantId:e};if(!u.includes(e))return{error:Je,participantId:e}}}e.participants.push(r),i||en({topic:sc,payload:{participants:[r]}});return{...dt,participant:Vn(r)}}function cp({tournamentRecord:t,participants:e=[],allowDuplicateParticipantIdPairs:i}){if(!t)return{error:ft};t.participants||(t.participants=[]);const n=t.participants.map((t=>t.participantId))||[];e.forEach((t=>{t.participantId||(t.participantId=qn())}));const r=e.filter((t=>!n.includes(t.participantId))),a=e.filter((t=>n.includes(t.participantId))),o=r.filter((t=>t.participantType===Ra)),s=r.filter((t=>t.participantType!==Ra)),c=o.concat(...s);if(c.length){const e=[];for(const r of c){const n=sp({tournamentRecord:t,participant:r,disableNotice:!0,allowDuplicateParticipantIdPairs:i}),{success:a,error:o,participant:s}=n;if(a&&e.push(s),o)return{error:o}}en({topic:sc,payload:{participants:e}});const n={...dt,participants:Vn(e)};return a.length&&Object.assign(n,{notAdded:a,message:ai}),n}return{...dt,message:"No new participants to add"}}const up=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e})=>!!Object.keys(e).filter((e=>t.includes(e))).filter((t=>e[t])).length;function dp({matchUps:t=[],scheduleAttributes:e=["scheduledDate","scheduledTime"]}){if(!Array.isArray(t))return{error:fe};if(!Array.isArray(e))return{error:_i};const i=t.filter((({schedule:t})=>up({schedule:t,scheduleAttributes:e}))).reduce(((t,e)=>{const{schedule:i}=e,n=Mn(null==i?void 0:i.scheduledDate),r=Cn(null==i?void 0:i.scheduledTime);return n&&r&&(t[n]?t[n].push(e):t[n]=[e]),t}),{});return Object.keys(i).forEach((t=>{i[t].sort(((t,e)=>{var i,n;return function(t,e){const i=Rn(t),n=Rn(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}(Cn(null===(i=t.schedule)||void 0===i?void 0:i.scheduledTime),Cn(null===(n=e.schedule)||void 0===n?void 0:n.scheduledTime))}))})),{scheduledMatchUps:i}}var lp,pp="SIGN_IN_STATUS";!function(t){t.INDIVIDUAL="INDIVIDUAL",t.PAIR="PAIR",t.TEAM="TEAM"}(lp||(lp={}));var hp,fp=lp.INDIVIDUAL,mp=lp.PAIR,gp=lp.TEAM;!function(t){t.SIGNED_IN="SIGNED_IN",t.SIGNED_OUT="SIGNED_OUT"}(hp||(hp={}));var vp=hp.SIGNED_IN,yp=hp.SIGNED_OUT,Ip={INDIVIDUAL:fp,PAIR:mp,TEAM:gp,SIGNED_IN:vp,SIGNED_OUT:yp,SIGN_IN_STATUS:pp};function wp(t){var e,i;const n=[],r={},{tournamentRecord:a,participantFilters:o}=t,s=(null==a?void 0:a.participants)||[],{relevantParticipantIdsMap:c}=function({tournamentRecord:t,tournamentRecords:e,processParticipantId:i}){if("object"!=typeof t&&"object"!=typeof e)return{error:ft};const n=e?Object.values(e).map((({participants:t=[]})=>t)).flat():t.participants||[];return{relevantParticipantIdsMap:Object.assign({},...n.map((({participantId:t,participantType:e,individualParticipantIds:n})=>("function"==typeof i&&i(t),{[t]:(n||[]).map((t=>({relevantParticipantId:t,participantType:fp}))).concat({relevantParticipantId:t,participantType:e})}))))}}({processParticipantId:t=>{r[t]||(r[t]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},draws:{},losses:0,wins:0})},tournamentRecord:a}),u=null==o?void 0:o.participantIds,d=t=>{const e=t&&c[t]||[];return e.some((t=>!u||u.includes(t.relevantParticipantId)))?e:[]};return s.forEach((t=>{if(t.participantType===La){const e=t.participantId;t.individualParticipantIds.forEach((t=>{r[t].groupParticipantIds.includes(e)||r[t].groupParticipantIds.push(e)}))}if(t.participantType===la){const e=t.participantId;t.individualParticipantIds.forEach((t=>{r[t].teamParticipantIds.includes(e)||r[t].teamParticipantIds.push(e)}))}if(t.participantType===Oa){const e=t.participantId;t.individualParticipantIds.forEach((t=>{r[t].pairParticipantIds.includes(e),r[t].pairParticipantIds.push(e)}))}})),null===(e=t.tournamentEvents)||void 0===e||e.forEach((t=>{var e,i,n;const o=Vn(t,!0,!0),{eventId:s,eventName:u,eventType:l,category:p}=o,h={eventId:s,eventName:u,eventType:l,category:p},f=o&&Object.keys(o).filter((t=>"_"===t[0]));null==f||f.forEach((t=>h[t]=o[t]));const m=o.entries||[],g=[].concat(...Object.values(Zr)).map((t=>`_${t}`)),v=h&&Object.keys(h).filter((t=>!g.includes(t))).reduce(((t,e)=>(t[e]=h[e],t)),{});null==m||m.filter((t=>null==t?void 0:t.participantId)).forEach((t=>{const{participantId:e,entryStage:i,entryStatus:n,entryPosition:a}=t,o=d(e);null==o||o.forEach((({relevantParticipantId:t})=>{r[t].events[s]={...v,partnerParticipantIds:[],entryPosition:a,entryStatus:n,entryStage:i,drawIds:[]}}))}));const y=(null===(e=o.drawDefinitions)||void 0===e?void 0:e.map((({drawId:t})=>t)))||[];null===(i=h._flightProfile)||void 0===i||null===(n=i.flights)||void 0===n||n.forEach((t=>{const{drawId:e,drawEntries:i}=t;y.includes(e)||null==i||i.forEach((t=>(({drawId:t,drawEntry:e,drawName:i,drawType:n})=>{const{participantId:a,entryStage:o,entryStatus:c,entryPosition:u}=e,p=d(a);l===la&&console.log({eventType:l},p),null==p||p.forEach((({relevantParticipantId:e})=>{r[e].events[s]||(r[e].events[s]={...v,partnerParticipantIds:[],entryPosition:u,entryStatus:c,entryStage:o,drawIds:[]}),r[e].draws[t]||(r[e].draws[t]={partnerParticipantIds:[],entryPosition:u,entryStatus:c,entryStage:o,drawName:i,drawType:n,eventId:s,drawId:t});const a=r[e].events[s].drawIds;!a||null!=a&&a.includes(t)||r[e].events[s].drawIds.push(t)}))})({drawId:e,drawEntry:t})))}));const{matchUps:I}=ld({tournamentRecord:a,nextMatchUps:!0,inContext:!0,event:o}),w=Object.assign({},...(o.drawDefinitions||[]).map((t=>{const e=Object.assign({},...m.filter((t=>t.participantId)).map((t=>({[t.participantId]:t}))),...t.entries.filter((t=>t.participantId)).map((t=>({[t.participantId]:t})))),i=Object.values(e);return{[t.drawId]:{drawType:t.drawType,drawEntries:i}}})));null==I||I.forEach((t=>function({matchUp:t,drawDetails:e,eventType:i}){const{drawId:n,drawName:a,eventId:o,eventName:s,finishingPositionRange:u,loserTo:l,matchUpId:p,matchUpType:h,matchUpFormat:f,matchUpStatus:m,roundName:g,roundNumber:v,roundPosition:y,score:I,sides:w,schedule:S,structureName:b,structureId:U,tieFormat:N,tieMatchUps:P,tournamentId:E,winnerTo:D,winningSide:A}=t,{winner:T,loser:C}=u||{},M=(null==P?void 0:P.length)&&P.filter((({matchUpType:t})=>t===da)).map((({sides:t})=>t.map((({sideNumber:t,participantId:e})=>t&&e&&{sideNumber:t,participantId:e})))).flat().filter(Boolean);if(null==w||w.forEach((({participantId:u,sideNumber:P}={})=>{if(!u)return;const{drawType:x,drawEntries:R}=e[n],k=1===P?null==I?void 0:I.scoreStringSide1:null==I?void 0:I.scoreStringSide2,O=A&&P===A,L=t.sides.find((({sideNumber:t}={})=>t===3-P)),_=null==L?void 0:L.participantId,F=_&&c[_]||[],j=A&&(O?T:C),B=R.find((t=>t.participantId===u)),V=d(u).filter((t=>i!==la||i===la&&h===da||t.participantType!==Oa));null==M||M.filter((t=>t.sideNumber===P)).forEach((({participantId:t})=>{t&&!V.includes(t)&&V.push({relevantParticipantId:t,participantType:Oa})})),null==V||V.forEach((({relevantParticipantId:t,participantType:e})=>{const{entryStage:c,entryStatus:u,entryPosition:d}=B||{};r[t].draws[n]||(r[t].draws[n]={partnerParticipantIds:[],entryPosition:d,entryStatus:u,entryStage:c,drawName:a,drawType:x,eventId:o,drawId:n}),r[t].events[o]||(r[t].events[o]={partnerParticipantIds:[],drawIds:[],eventName:s,eventId:o});const P=r[t].events[o].drawIds;let T;if(!P||null!=P&&P.includes(n)||r[t].events[o].drawIds.push(n),e===Ra&&h===da){const e=V.find((e=>e.relevantParticipantId!==t&&e.participantType===Ra));T=null==e?void 0:e.relevantParticipantId}null==F||F.filter((t=>e===Ra||t.participantType===e)).forEach((({relevantParticipantId:e,participantType:i})=>{r[t].opponents[e]?r[t].opponents[e].push({eventId:o,drawId:n,matchUpId:p,participantType:i,participantId:e}):r[t].opponents[e]=[{eventId:o,drawId:n,matchUpId:p,participantType:i,participantId:e}]}));const C=F.map((({relevantParticipantId:t,participantType:e})=>({participantId:t,participantType:e})));r[t].matchUps[p]=Gn({drawId:n,eventId:o,eventType:i,finishingPositionRange:j,loserTo:l,matchUpId:p,matchUpType:h,matchUpFormat:f,matchUpStatus:m,opponentParticipantInfo:C,participantWon:O,partnerParticipantId:T,perspectiveScoreString:k,roundName:g,roundNumber:v,roundPosition:y,schedule:S,score:I,sides:w,structureName:b,structureId:U,tieFormat:N,tournamentId:E,winnerTo:D,winningSide:A}),T&&(r[t].events[o].partnerParticipantIds.push(T),r[t].draws[n].partnerParticipantIds.push(T),r[t].events[o].partnerParticipantId=T,r[t].draws[n].partnerParticipantId=T),A&&(O?r[t].wins++:r[t].losses++)}))})),Array.isArray(t.potentialParticipants)){const e=Cc(t.potentialParticipants.flat());null==e||e.forEach((t=>{const e=d(t);null==e||e.forEach((({relevantParticipantId:t})=>{r[t].potentialMatchUps[p]=Gn({drawId:n,eventId:o,eventType:i,matchUpId:p,matchUpType:h,matchUpFormat:f,roundName:g,roundNumber:v,roundPosition:y,schedule:S,tieFormat:N,structureName:b,potential:!0})}))}))}}({matchUp:t,drawDetails:w,eventType:l})))})),null===(i=t.tournamentParticipants)||void 0===i||i.forEach((e=>{const{scheduleConflicts:i,scheduleItems:a}=function({withDraws:t=!0,withEvents:e=!0,withOpponents:i,withMatchUps:n,withStatistics:r,scheduleAnalysis:a,participant:o,participantIdMap:s}){const c=[],u=[],d=null==o?void 0:o.participantId;if(!d||!s[d])return{};const{wins:l,losses:p,matchUps:h,potentialMatchUps:f,events:m,draws:g,opponents:v}=s[d],y=l,I=l+p,w={statCode:"winRatio",numerator:y,denominator:I,statValue:I&&y/I},b=Object.values(g),U=Object.values(m);t&&b&&(o.draws=b),e&&U&&(o.events=U);const N=Object.values(v).flat();i&&null!=N&&N.length&&(o.opponents=N,null==b||b.forEach((t=>{t.opponents=N.filter((e=>e.drawId===t.drawId))})));const P=Object.values(f),E=Object.values(h);n&&(o.potentialMatchUps=P,o.matchUps=E);const D=E.concat(P),{scheduledMatchUps:A}=dp({matchUps:D}),{scheduledMinutesDifference:T}=a||{};Object.keys(A).forEach((t=>{A[t].forEach(((e,i)=>{const{schedule:{scheduledTime:n,timeAfterRecovery:r,typeChangeTimeAfterRecovery:a},matchUpStatus:o,matchUpId:s,roundNumber:d,roundPosition:l,structureName:p,matchUpType:h,drawId:f}=e;if(c.push({drawId:f,matchUpType:h,matchUpId:s,structureName:p,roundNumber:d,roundPosition:l,...e.schedule,scheduledTime:Cn(e.schedule.scheduledTime)}),n&&o!==S){const c=An(n),d=A[t].slice(i+1);for(const t of d){var m;if(o!==S&&null!==(m=t.schedule)&&void 0!==m&&m.scheduledTime){const i=e.matchUpType!==t.matchUpType&&a||r,n=e.drawId===t.drawId,o=e.potential&&t.potential,d=An(t.schedule.scheduledTime)-c;!(T&&!isNaN(T)?d<=T:An(i)>An(t.schedule.scheduledTime))||o&&n||u.push({priorScheduledMatchUpId:t.matchUpId,matchUpIdWithConflict:s})}}}}))})),null==b||b.forEach((t=>{const e=h&&E.filter((e=>e.drawId===t.drawId))||[],i=t=>Math.abs(t[0]-t[1]),n=e.reduce(((t,e)=>t?t&&e.finishingPositionRange&&i(t)>i(e.finishingPositionRange)?e.finishingPositionRange:t:e.finishingPositionRange),void 0);t.finishingPositionRange=n})),r&&(o.statistics=[w]);return{scheduleConflicts:u,scheduleItems:c}}({...t,participant:e,participantIdMap:r});t.withScheduleItems&&(e.scheduleItems=a),t.scheduleAnalysis&&(e.scheduleConflicts=i,null!=i&&i.length&&(n.includes(e.participantId)||n.push(e.participantId))),!1!==t.withGroupings&&(e.groupParticipantIds=r[e.participantId].groupParticipantIds,e.pairParticipantIds=r[e.participantId].pairParticipantIds,e.teamParticipantIds=r[e.participantId].teamParticipantIds)})),{participantIdsWithConflicts:n}}function Sp({element:t,accessor:e}){if("string"!=typeof e)return{values:[]};const i=Vn(t),n=e.split(".");let r,a=[];!function t({targetElement:e,attributes:i=[],significantCharacters:n}){for(const[r,a]of i.entries())if(e&&e[a])if(Array.isArray(e[a])){const n=e[a],o=i.slice(r);n.forEach((e=>t({targetElement:e,attributes:o})))}else o({targetElement:e=e[a],index:r});function o({targetElement:t,index:e}){if(t&&e===i.length-1&&["string","number"].includes(typeof t)){const e=n?t.slice(0,n):t;r?a.includes(e)||a.push(e):(r=e,a.push(e))}}}({targetElement:i,attributes:n});const o={value:r};return a.length&&(o.values=a),o}function bp({tournamentRecord:t,participantFilters:e,participants:i}){var n,r;let{eventIds:a}=e;const{accessorValues:o,drawEntryStatuses:s,positionedParticipants:c,eventEntryStatuses:u,participantRoles:d,participantRoleResponsibilities:l,participantTypes:p,participantIds:h,signInStatus:f,enableOrFiltering:m}=e,g=Up(a)&&(null===(n=t.events)||void 0===n?void 0:n.filter((t=>a.includes(t.eventId))))||t.events||[],v=s&&function({drawEntryStatuses:t,tournamentEvents:e}){const i=({entryStatus:e})=>!Array.isArray(t)||t.includes(e);return X(e.reduce(((t,e)=>{var n,r;const{flightProfile:a}=el({event:e}),o=(null==a||null===(n=a.flights)||void 0===n?void 0:n.map((({drawEntries:t})=>Array.isArray(t)?t.filter(i).map(Mc):[])).flat())||[],s=(null===(r=e.drawDefinitions)||void 0===r?void 0:r.map((({entries:t})=>t?t.filter(i).map(Mc):[])))||[];return t.concat(...o,...s)}),[]))}({drawEntryStatuses:s,tournamentEvents:g}),y=u&&function({eventEntryStatuses:t,tournamentEvents:e}){return X(e.reduce(((e,i)=>{const n=(i.entries||[]).filter((({entryStatus:e})=>!Array.isArray(t)||t.includes(e))).map(Mc);return e.concat(...n)}),[]))}({eventEntryStatuses:u,tournamentEvents:g}),I=[!0,!1].includes(c)&&g.reduce(((t,e)=>t.concat(...(e.drawDefinitions||[]).map((t=>function({drawDefinition:t}){return t?(t.structures||[]).map((t=>{const{positionAssignments:e}=Eu({structure:t});return Cc(e)})).flat():{error:yt}}({drawDefinition:t}))).filter(Boolean))),[]),w=t=>o.reduce(((e,i)=>{const{accessor:n,value:r}=i,{values:a}=Sp({element:t,accessor:n});return e&&(null==a?void 0:a.includes(r))}),!0);if(i=null===(r=i)||void 0===r?void 0:r.filter((t=>{const e=Qs({element:t,itemType:pp}),{participantId:i,participantType:n,participantRole:r,participantRoleResponsibilities:a}=t;return m?c&&I.includes(i)||!1===c&&!I.includes(i)||v&&v.includes(i)||y&&y.includes(i)||h&&h.includes(i)||f&&e===f||p&&Up(p)&&p.includes(n)||d&&Up(d)&&d.includes(r)||l&&Up(a)&&Up(l)&&l.find((t=>a.includes(t)))||(null==o?void 0:o.length)&&Up(o)&&w(t):(void 0===c||c&&I.includes(i)||!1===c&&!I.includes(i))&&(!v||v.includes(i))&&(!y||y.includes(i))&&(!h||h.includes(i))&&(!f||e===f)&&(!p||Up(p)&&p.includes(n))&&(!d||Up(d)&&d.includes(r))&&(!l||Up(a)&&Up(l)&&l.find((t=>a.includes(t))))&&(!(null!=o&&o.length)||Up(o)&&w(t))})),g.length&&a){var S;const e=g.filter((t=>a.includes(t.eventId))).map((e=>{const i=(e.entries||[]).map((t=>t.participantId));if(e.eventType===Ea)return i;const n=(t.participants||[]).filter((t=>i.includes(t.participantId))).map((t=>t.individualParticipantIds)).flat(1);return i.concat(...n)})).flat(1);i=null===(S=i)||void 0===S?void 0:S.filter((t=>e.includes(t.participantId)))}return i}function Up(t){return t&&Array.isArray(t)&&t.length}function Np({participantFilters:t={},convertExtensions:e,policyDefinitions:i,withScheduleItems:n,tournamentRecord:r,scheduleAnalysis:a,withStatistics:o,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l,inContext:p}){if(!r)return{error:ft};if(!r.participants)return{error:Ke};let h=r.participants.map((t=>Vn(t,e)));if("object"!=typeof t)return{error:Li,participantFilters:t};var f;p&&(null===(f=h)||void 0===f||f.forEach((t=>{[Oa,ka,La].includes(t.participantType)&&(t.individualParticipants=t.individualParticipantIds.map((t=>Vn(r.participants.find((e=>e.participantId===t)),e,!0))))})));t&&(h=bp({tournamentRecord:r,participantFilters:t,participants:h}));let m;if(d||l||u||s||c||o||a||n||p){const e=wp({tournamentEvents:r.events,tournamentParticipants:h,participantFilters:t,withScheduleItems:n,tournamentRecord:r,scheduleAnalysis:a,withStatistics:o,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l});m=null==e?void 0:e.participantIdsWithConflicts}const g=null==i?void 0:i.participant;return null!=g&&g.participant&&(h=h.map((t=>$({source:t,template:g.participant})))),{tournamentParticipants:h,participantIdsWithConflicts:m}}function Pp(t,e,i){if(!t&&e)return e;if(t&&!e)return t;if("object"!=typeof t||"object"!=typeof e)return t;return X(Object.keys(t).concat(Object.keys(e))).reduce(((n,r)=>{if(e[r])if(t[r])if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(!0===i||Array.isArray(i)&&i.includes(r)){const i=X(t[r].map((t=>JSON.stringify(t))).concat(e[r].map((t=>JSON.stringify(t))))).map((t=>JSON.parse(t)));n[r]=i}else n[r]=e[r];else"object"==typeof t[r]?n[r]=Pp(t[r],e[r],i):n[r]=e[r];else n[r]=e[r];else n[r]=t[r];return n}),{})}function Ep(t){return{tournamentIds:Object.keys(t).filter(Boolean)}}const Dp=({penaltyId:t=qn()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t});function Ap({tournamentRecord:t,participantIds:e,penaltyCode:i,penaltyType:n,penaltyId:r,matchUpId:a,notes:o,extensions:s,issuedAt:c,refereeParticipantId:u}){if(!t)return{error:ft};if(!e)return{error:Ye};if(!n)return{error:hi};const d=((null==t?void 0:t.participants)||[]).filter((t=>e.includes(t.participantId)));if(!d.length)return{error:Je};const l=(new Date).toISOString(),p=Object.assign(Dp({penaltyId:r}),{refereeParticipantId:u,penaltyCode:i,penaltyType:n,matchUpId:a,notes:o,issuedAt:c,createdAt:l});return Array.isArray(s)&&s.forEach((t=>Gc({element:p,extension:t}))),d.forEach((t=>{t.penalties||(t.penalties=[]),t.penalties.push(p)})),en({topic:gc,payload:{participants:d}}),{...dt,penaltyId:p.penaltyId}}function Tp({tournamentRecord:t,penaltyId:e}){if(!t)return{error:ft};if(!e)return{error:fi};const i=(null==t?void 0:t.participants)||[],n=[];let r,a=!1;return i.forEach((t=>{let i=!1;t.penalties=(t.penalties||[]).filter((o=>(o.penaltyId===e&&(i=!0,a||(r=o,a=!0)),i&&n.push(t),o.penaltyId!==e)))})),r&&en({topic:gc,payload:{participants:n}}),r?{...dt,penalty:r}:{error:mi}}function Cp({tournamentRecord:t}){if(!t)return{error:ft};const e=((null==t?void 0:t.participants)||[]).reduce(((t,e)=>{const{participantId:i}=e;return(e.penalties||[]).forEach((e=>{const{penaltyId:n}=e||{};t[n]?t[n].participants.push(i):t[n]={...e,participantIds:[i]}})),t}),{});return{penalties:Object.values(e)}}function Mp({tournamentRecord:t,penaltyId:e,modifications:i}){if(!t)return{error:ft};if(!i)return{error:_i,modifications:i};if(!e)return{error:fi};const n=(null==t?void 0:t.participants)||[],r=Object.keys(Dp()).filter((t=>"penaltyId"!==t)),a=Object.keys(i).filter((t=>r.includes(t)));if(!a.length)return{error:Bi};let o;const s=[];return n.forEach((t=>{let n=!1;t.penalties=(t.penalties||[]).map((t=>(t.penaltyId===e&&(n=!0,a.forEach((e=>Object.assign(t,{[e]:i[e]}))),o||(o=t)),t))),n&&s.push(t)})),o&&en({topic:gc,payload:{participants:s}}),o?{...dt,penalty:o}:{error:mi}}const xp={addExtension:Td,findExtension:Cd,removeExtension:Md,addEventExtension:function({tournamentRecords:t,eventId:e,extension:i}){if("string"!=typeof e)return{error:zt};if(!Vc(i))return{error:_i};for(const n of Object.values(t)){const{event:t}=Ia({tournamentRecord:n,eventId:e});if(t)return zc({event:t,extension:i})}return{error:Kt}},linkTournaments:function({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const{tournamentIds:e,error:i}=Ep(t);if(i)return{error:i};if((null==e?void 0:e.length)>1){return Td({tournamentRecords:t,extension:{name:Hr,value:{tournamentIds:e}}})}return dt},unlinkTournament:function({tournamentRecords:t,tournamentId:e}){if("object"!=typeof t)return{error:_i};if(!e)return{error:gt};const{tournamentIds:i,error:n}=Ep(t);if(n)return{error:n};if(!i.includes(e))return{error:gt};let r;return i.every((i=>{var n;const a=t[i],{extension:o}=aa({tournamentRecord:a,name:Hr});if(!o)return!0;let s=(null==o||null===(n=o.value)||void 0===n?void 0:n.tournamentIds)||[];if(null==s||!s.length||1===s.length&&s.includes(e)||i===e){const t=Kc({tournamentRecord:a,name:Hr});return t.error&&(r=t.error),t.success}const c=s.filter((t=>t!==e));o.value={tournamentIds:c};const u=Wc({tournamentRecord:a,extension:o});return u.error&&(r=u.error),u.success})),r?{error:r}:{...dt}},unlinkTournaments:function({tournamentRecords:t}){return"object"==typeof t&&Object.keys(t).length?Md({tournamentRecords:t,name:Hr}):{error:ht}},getLinkedTournamentIds:function({tournamentRecords:t}){return"object"==typeof t&&Object.keys(t).length?{linkedTournamentIds:Object.assign({},...Object.keys(t).map((e=>{var i;const n=t[e],r=null==n?void 0:n.tournamentId,{extension:a}=aa({tournamentRecord:n,name:Hr});return{[e]:((null==a||null===(i=a.value)||void 0===i?void 0:i.tournamentIds)||[]).filter((t=>t!==r))}})))}:{error:ht}},addDrawDefinition:function({tournamentRecords:t,drawDefinition:e,tournamentId:i,eventId:n,flight:r,existingDrawCount:a}){if(!n)return{error:zt};if(!(i=i||yd({tournamentRecords:t,eventId:n})))return{error:gt};const o=t[i];if(!o)return{error:ft};const{event:s,error:c}=Ia({tournamentRecord:o,eventId:n});return c?{error:c}:ap({drawDefinition:e,event:s,flight:r,existingDrawCount:a})},getCompetitionParticipants:function(t){const{tournamentRecords:e}=t||{};if("object"!=typeof e||!Object.keys(e).length)return{error:ht};let i=[];const n=[],r=[];for(const a of Object.values(e)){const{tournamentParticipants:e,participantIdsWithConflicts:o}=Np({tournamentRecord:a,...t});for(const t of e){const{participantId:e}=t;n.includes(e)?i=i.map((i=>i.participantId!==e?i:Pp(i,t,!0))):(n.push(e),i.push(t))}o&&o.forEach((t=>{r.includes(t)||r.push(t)}))}return{competitionParticipants:i,participantIdsWithConflicts:r}},addParticipant:function({tournamentRecords:t,pairOverride:e,tournamentId:i,participant:n}){if("string"!=typeof i)return{error:gt};const r=t[i];return r?sp({tournamentRecord:r,participant:n,pairOverride:e}):{error:ft}},setMatchUpStatus:function(t){const e=t.tournamentRecords,i=t.tournamentId||yd(t);if("string"!=typeof i)return{error:gt};const n=e[i];if(!n)return{error:ft};const{drawDefinition:r,event:a}=Ia({eventId:t.eventId,drawId:t.drawId,tournamentRecord:n});return Wl({tournamentRecord:n,...t,drawDefinition:r,event:a})},bulkMatchUpStatusUpdate:function(t){const{tournamentRecords:e,outcomes:i}=t;if(!Array.isArray(i))return{error:Ae};const n=i.reduce(((t,e)=>t.includes(e.tournamentId)?t:t.concat(e.tournamentId)),[]);for(const r of n){const t=e[r];if(!t)return{error:ft};const n=i.filter((t=>t.tournamentId===r));if(n.length){const e=ql({tournamentRecord:t,outcomes:n});if(e.error)return e}}return{...dt}},bulkScheduleMatchUps:function({tournamentRecords:t,matchUpContextIds:e,schedule:i}){if(!t)return{error:ht};if(!Array.isArray(e))return{error:_i};for(const n of Object.values(t)){const{tournamentId:t}=n,r=e.filter((e=>e.tournamentId===t)).map(Rc);if(null!=r&&r.length){const t=gd({tournamentRecord:n,matchUpIds:r,schedule:i});if(t.error)return t}}return dt},addVenue:function({tournamentRecords:t,venue:e,disableNotice:i}){if("object"!=typeof e)return{error:_i};e.venueId||(e.venueId=qn());for(const n of Object.values(t)){const t=op({tournamentRecord:n,returnDetails:!0,disableNotice:!0,venue:e});if(null!=t&&t.error)return t}return i||en({topic:cc,payload:{venue:e}}),dt},deleteVenue:function({tournamentRecords:t,venueId:e,force:i}){if(!t)return{error:ht};if("string"!=typeof e)return{error:Si};let n;for(const r of Object.values(t)){const t=rp({tournamentRecord:r,venueId:e,force:i});if(t.error&&t.error!==wi)return t;n=!0}return Ld({tournamentRecords:t}),n?dt:{error:wi}},modifyVenue:function({tournamentRecords:t,modifications:e,venueId:i,force:n}){if(!t)return{error:ht};if("string"!=typeof i)return{error:Si};let r,a;for(const o of Object.values(t)){const t=ip({tournamentRecord:o,modifications:e,venueId:i,force:n});if(t.success&&(a=!0),t.error&&(r=t.error),t.error&&t.error!==wi)return t}return Ld({tournamentRecords:t}),a?{...dt}:{error:r}},addCourts:function(t){const{tournamentRecords:e,venueId:i}=t;if("string"!=typeof i||!i)return{error:Si};let n;for(const r of Object.values(e)){const{venue:e}=_u({tournamentRecord:r,venueId:i});if(e){const e=ep({tournamentRecord:r,...t});if(e.error)return e;n=!0}}return n?dt:{error:wi}},addPenalty:function(t){const{tournamentRecords:e,participantIds:i}=t;let n;for(const r of Object.values(e)){const{tournamentParticipants:e}=Np({tournamentRecord:r}),a=Cc(e).filter((t=>i.includes(t)));if(a.length){n=Ap({...t,penaltyId:t.penaltyId||n,tournamentRecord:r,participantIds:a}).penaltyId}}return n?{...dt,penaltyId:n}:{error:Je}},removePenalty:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:ht};for(const i of Object.values(e)){const e=Tp({tournamentRecord:i,...t});if(e.error&&e.error!==mi)return e}return{...dt}},modifyPenalty:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:ht};for(const i of Object.values(e)){const e=Mp({tournamentRecord:i,...t});if(e.error&&e.error!==mi)return e}return{...dt}},getCompetitionPenalties:function({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const e=[];for(const i of Object.values(t)){const{penalties:t}=Cp({tournamentRecord:i});e.push(...t)}return{penalties:e}},findParticipant:function({tournamentRecords:t,participantId:e,personId:i,policyDefinitions:n,inContext:r}){if(!t)return{error:ht};if("string"!=typeof e&&"string"!=typeof i)return{error:Ae};let a;for(const o of Object.values(t)){const{tournamentParticipants:t}=Np({tournamentRecord:o,policyDefinitions:n,inContext:r});if(a=ia({tournamentParticipants:t,participantId:e,personId:i,policyDefinitions:n}),a)break}return{participant:Vn(a,!1,!0)}}};function Rp(){const{topics:t}=an();for(const e of t){const t=nn({topic:e});t&&on({topic:e,notices:t})}}function kp({tournamentRecord:t,matchUpFormat:e,event:i}){if(!t)return{error:ft};if(!v(e))return{error:ne};const{extension:n}=oa({event:i,name:Kr}),r=null==n?void 0:n.value,{extension:a}=aa({tournamentRecord:t,name:Kr}),o=null==a?void 0:a.value;return{matchUpFormat:e,averageTimes:[(null==r?void 0:r.matchUpAverageTimes)&&kr({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpAverageTimes)&&kr({...o,matchUpFormat:e})].find((t=>t)),recoveryTimes:[(null==r?void 0:r.matchUpRecoveryTimes)&&Or({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpRecoveryTimes)&&Or({...o,matchUpFormat:e})].find((t=>t))}}function Op({tournamentRecord:t,matchUpFormat:e,averageTimes:i,recoveryTimes:n,event:r}){if(!t)return{error:ft};if(i&&!Array.isArray(i))return{error:_i};if(n&&!Array.isArray(n))return{error:_i};const a=Kr;if(r){const{extension:t}=oa({event:r,name:a});zc({event:r,extension:{name:a,value:Lp({...(null==t?void 0:t.value)||{},matchUpFormat:e,averageTimes:i,recoveryTimes:n})}})}else{const{extension:r}=aa({tournamentRecord:t,name:a});Wc({tournamentRecord:t,extension:{name:a,value:Lp({...(null==r?void 0:r.value)||{},matchUpFormat:e,averageTimes:i,recoveryTimes:n})}})}return dt}function Lp({matchUpAverageTimes:t=[],matchUpRecoveryTimes:e=[],averageTimes:i,recoveryTimes:n,matchUpFormat:r}){var a,o;const s=(null===(a=i=(i||[]).filter((t=>{var e,i;return(null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length)||(null==t||null===(i=t.categoryTypes)||void 0===i?void 0:i.length)})))||void 0===a?void 0:a.length)&&t.map((t=>{var e;return null!=t&&t.matchUpFormatCodes.includes(r)?{...t,matchUpFormatCodes:null===(e=t.matchUpFormatCodes)||void 0===e?void 0:e.filter((t=>t!==r))}:t})).filter((({matchUpFormatCodes:t})=>null==t?void 0:t.length)).concat({matchUpFormatCodes:[r],averageTimes:i}),c=(null===(o=n=(n||[]).filter((t=>{var e,i;return(null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length)||(null==t||null===(i=t.categoryTypes)||void 0===i?void 0:i.length)})))||void 0===o?void 0:o.length)&&e.map((t=>{var e;return null!=t&&t.matchUpFormatCodes.includes(r)?{...t,matchUpFormatCodes:null===(e=t.matchUpFormatCodes)||void 0===e?void 0:e.filter((t=>t!==r))}:t})).filter((({matchUpFormatCodes:t,averageTimes:e})=>(null==t?void 0:t.length)||e)).concat({matchUpFormatCodes:[r],recoveryTimes:n});return{matchUpAverageTimes:(null==s?void 0:s.length)&&s||t,matchUpRecoveryTimes:(null==c?void 0:c.length)&&c||e}}function _p({tournamentRecord:t,event:e,categoryType:i,matchUpFormat:n,averageMinutes:r,recoveryMinutes:a}){if(!t)return{error:ft};if(!v(n))return{error:_i};if(!e)return{error:zt};const{averageTimes:o=[],recoveryTimes:s=[]}=kp({tournamentRecord:t,matchUpFormat:n,event:e}),c=e.category,u=(null==c?void 0:c.categoryName)||(null==c?void 0:c.ageCategoryCode),d="DOUBLES"===e.eventType;let l={categoryNames:[u],minutes:{}},p={categoryNames:[u],minutes:{}};const h=t=>{var e,n;if(null!==(e=t.categoryTypes)&&void 0!==e&&e.includes(i)&&console.log("encountered:",{categoryType:i}),null===(n=t.categoryNames)||void 0===n||!n.includes(u)||(t.categoryNames=t.categoryNames.filter((t=>t!==u)),l={minutes:t.minutes,categoryNames:[u]},t.categoryNames.length))return t},f=!isNaN(parseInt(r)),m=!isNaN(parseInt(a)),g=o.map(h).filter((t=>{var e;return null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length})),y=s.map(h).filter((t=>{var e;return null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length}));return f&&(Object.assign(l.minutes,{[d?Da:ua]:r}),g.push(l)),m&&(Object.assign(p.minutes,{[d?Da:ua]:a}),y.push(p)),f||m?Op({tournamentRecord:t,event:e,matchUpFormat:n,averageTimes:f&&g,recoveryTimes:m&&y}):{error:_i}}function Fp({tournamentRecords:t,extensionName:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const i=[];let n;for(const r of Object.values(t)){const{extension:t}=aa({tournamentRecord:r,name:e});t&&!n&&(i.push({method:"addExtension",params:{extension:t}}),n=!0);const a=r.events||[];for(const n of a){const{eventId:t}=n,{extension:r}=oa({event:n,name:e});r&&i.push({method:"addEventExtension",params:{eventId:t,extension:r}})}}return{methods:i}}function jp({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!t)return{error:ft};if(!n)return{error:zt};let r=[];if(null!=e&&e.length){const t=[];r=e.map((e=>{let i="string"==typeof e?{matchUpFormat:e}:e;if(!t.includes(null==i?void 0:i.matchUpFormat)&&v(null==i?void 0:i.matchUpFormat))return t.push(i.matchUpFormat),i})).filter(Boolean)}else{const{policy:e}=ea({policyType:sr,tournamentRecord:t,event:n});if(null!=e&&e.matchUpFormats)r=null==e?void 0:e.matchUpFormats;else{const{extension:t}=oa({event:n,name:Kr});if(null==t||!t.value)return{error:Pe};r=X([...(t.value.matchUpAverageTimes||[]).map((t=>t.matchUpFormatCodes)),...(t.value.matchUpRecoveryTimes||[]).map((t=>t.matchUpFormatCodes))].flat()).map((t=>({matchUpFormat:t})))}}const{eventType:a,eventId:o,category:s}=n,c=null==s?void 0:s.categoryName;if(!o)return{error:zt};return{eventMatchUpFormatTiming:r.map((({matchUpFormat:e,description:r})=>{const o=va({tournamentRecord:t,matchUpFormat:e,categoryName:c,categoryType:i,eventType:a,event:n});return Object.assign({},{...o,description:r,matchUpFormat:e})}))}}function Bp({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,drawId:r,event:a}){var o,s,c;if(!t)return{error:ft};if(!(r||a||i||n))return{error:Ae};const u=md({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:r,event:a});if(n&&null!=u&&u.error)return u;!e&&null!=u&&u.drawDefinition&&(e=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&i&&!n){if(!e)return{error:xt};const t=jc({drawDefinition:e,structureId:i});if(t.error)return t;d=t.structure}const l=null===(o=d)||void 0===o?void 0:o.matchUpFormat,p=null===(s=e)||void 0===s?void 0:s.matchUpFormat,h=null==a?void 0:a.matchUpFormat;return{matchUpFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.matchUpFormat)||l||p||h,structureDefaultMatchUpFormat:l,drawDefaultMatchUpFormat:p,eventDefaultMatchUpFormat:h}}function Vp({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,tournamentId:n,matchUpFormat:r,categoryName:a,categoryType:o,eventType:s,eventId:c}){var u,d,l,p;if(!v(r))return{error:ne};let h;return Object.keys(i).filter((t=>!n||t===n)).find((t=>{var e,n,u;const d=i[t],l=c&&(null===(e=Ia({tournamentRecord:d,eventId:c}))||void 0===e?void 0:e.event);h=va({tournamentRecord:d,event:l,matchUpFormat:r,categoryName:a,categoryType:o,eventType:s});return(null===(n=h)||void 0===n?void 0:n.averageMinutes)||(null===(u=h)||void 0===u?void 0:u.recoveryMinutes)})),{averageMinutes:(null===(u=h)||void 0===u?void 0:u.averageMinutes)||e,recoveryMinutes:(null===(d=h)||void 0===d?void 0:d.recoveryMinutes)||t,typeChangeRecoveryMinutes:(null===(l=h)||void 0===l?void 0:l.typeChangeRecoveryMinutes)||(null===(p=h)||void 0===p?void 0:p.recoveryMinutes)||t}}function Gp({tournamentRecords:t,containedStructureIds:e,periodLength:i=30,matchUps:n,rounds:r}){if("object"!=typeof t)return{error:ht};if(!Array.isArray(r))return{error:Ae};const a=[],o=r.sort(((t,e)=>(t.sortOrder||0)-(e.sortOrder||0)));e=e||Object.assign({},...Object.values(t).map((t=>Il({tournamentRecord:t}).containedStructures))),n||({matchUps:n}=Fd({tournamentRecords:t,nextMatchUps:!0}));const s={},c={},u={};let d=0;return{scheduledRoundsDetails:o.map((r=>{var o,l,p;const h=r.periodLength||i,f=e[r.structureId]||[r.structureId],m={tournamentIds:[r.tournamentId],roundNumbers:[r.roundNumber],matchUpIds:r.matchUpIds,eventIds:[r.eventId],drawIds:[r.drawId],structureIds:f};let g=Mu({matchUps:n,processContext:!0,...m}).sort(Vd);const{segmentNumber:v,segmentsCount:y}=r.roundSegment||{};if(J(v)&&W(null===(o=g)||void 0===o?void 0:o.length)&&W(y)&&v>0&&v<=y&&y<(null===(l=g)||void 0===l?void 0:l.length)&&(null===(p=r.matchUpIds)||void 0===p||!p.length)){const t=g.length/y,e=t*(v-1);g=g.slice(e,e+t)}const I=t[r.tournamentId],{drawDefinition:w,event:b}=Ia({drawId:r.drawId,tournamentRecord:I}),{matchUpFormat:U}=Bp({structureId:r.structureId,tournamentRecord:I,drawDefinition:w,event:b}),{eventType:N,category:P}=b||{},{categoryName:E,ageCategoryCode:D}=P||{},{typeChangeRecoveryMinutes:A,recoveryMinutes:T,averageMinutes:C,error:M}=Vp({tournamentRecords:t,categoryName:E||D,tournamentId:r.tournamentId,eventId:r.eventId,matchUpFormat:U,eventType:N});if(M)return{error:M,round:r};const x=g.filter((({matchUpStatus:t})=>!F.includes(t)&&t!==S)).map(Rc);x.forEach((t=>{s[t]={typeChangeRecoveryMinutes:A,recoveryMinutes:T,averageMinutes:C},c[t]=T,u[t]=C})),a.push(...x),d=Math.max(C||0,d);return{roundPeriodLength:h,recoveryMinutes:T,averageMinutes:C,matchUpIds:x,hash:`${C}|${h}`}})),greatestAverageMinutes:d,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:a,minutesMap:s,...dt}}function Hp({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=60,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,endTime:d}){if("object"!=typeof o||!Object.keys(o).length)return{error:ht};const{courts:l,venues:p}=Dd({tournamentRecords:o}),h=l.filter((t=>!u||u.includes(t.venueId)));c||(c=h.reduce(((t,e)=>{var i;const n=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((t=>!t.date||jn(s,t.date))),r=(null==n?void 0:n.startTime)||e.startTime;return r&&(!t||An(r)<An(t))?r:t}),void 0)),d||(d=h.reduce(((t,e)=>{var i;const n=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((t=>!t.date||jn(s,t.date))),r=(null==n?void 0:n.endTime)||e.endTime;return r&&(!t||An(r)>An(t))?r:t}),void 0));const f=Object.assign({},...Object.values(o).map((t=>(t.events||[]).map((e=>{const{scheduleTiming:i}=ca({tournamentRecord:t,event:e});return{[e.eventId]:{event:e,scheduleTiming:i}}})))).flat()),m=jd({tournamentRecords:o,sortDateMatchUps:!1,matchUpFilters:{scheduledDate:s,venueIds:u}}),g=[].concat(...m.dateMatchUps||[],...m.completedMatchUps||[]),v={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},y=null==g?void 0:g.map((({eventId:t,schedule:e,matchUpFormat:i})=>{const{event:n,scheduleTiming:r}=f[t],o=null==n?void 0:n.eventType,s={...r,defaultTiming:v,matchUpFormat:i},{averageMinutes:c,recoveryMinutes:u}=ya({eventType:o,timingDetails:s}),{courtId:d,venueId:l}=e,p=Cn(e.scheduledTime),h=Ln(p,c);return{averageMinutes:c,recoveryMinutes:u,periodLength:a,startTime:p,endTime:h,courtId:d,venueId:l}})),I={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:a,startTime:c,endTime:d,bookings:y,courts:h},{scheduleTimes:w}=$s(I);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==p?void 0:p.length)?p[0].venueId:void 0,scheduleTimes:w,dateScheduledMatchUpIds:g.map(Rc)}}function Wp({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function qp({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){const{matchUpType:r}=i,{individualParticipantIds:a}=bd(i),o=(t[i.matchUpId]||[]).filter((t=>!st(t,a))).flat();[...a,...o].forEach((t=>{if(Wp({individualParticipantProfiles:e,participantId:t}),!e[t].potentialCounted[i.drawId]){const a=e[t].counters;a[r]?a[r]+=n:n>0&&(a[r]=n),a[ha]?a[ha]+=n:n>0&&(a[ha]=n),o.includes(t)&&(e[t].potentialCounted[i.drawId]=!0)}}))}function zp({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var r;const a=((null==e||null===(r=e[n.matchUpId])||void 0===r?void 0:r.matchUpIds)||[]).filter((t=>i.includes(t))).filter((e=>!t[e]));return{dependenciesScheduled:!(null!=a&&a.length),remainingDependencies:a}}function Kp({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var r,a,o,s;const{individualParticipantIds:c}=bd(n);i=i||(null===(r=n.schedule)||void 0===r?void 0:r.timeAfterRecovery);const u=e=>{t[e]||(t[e]=[]),t[e]=X(t[e].concat(...c))},d=t=>{(!e[t]||i>e[t])&&(e[t]=i)},l=(null===(a=n.winnerTo)||void 0===a?void 0:a.matchUpId)||n.winnerMatchUpId;l&&(i&&d(l),u(l));const p=(null===(o=n.loserTo)||void 0===o?void 0:o.matchUpId)||n.loserMatchUpId;p&&(i&&d(p),u(p)),null!==(s=n.sidesTo)&&void 0!==s&&s.length&&n.sidesTo.forEach((({matchUpId:t})=>{t&&(i&&d(t),u(t))}))}function Yp({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:i,matchUpDependencies:n,averageMatchUpMinutes:r=0,typeChangeRecoveryMinutes:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){var u,d;const l=Cn(null==c||null===(u=c.schedule)||void 0===u?void 0:u.endTime),p=l?Ln(l,parseInt(o)):Ln(s,parseInt(r)+parseInt(o)),h=a&&(l?Ln(Cn(l),a):Ln(s,parseInt(r)+parseInt(a))),f=(null==n||null===(d=n[c.matchUpId])||void 0===d?void 0:d.participantIds)||[],m=(c.roundPosition&&e[c.matchUpId]||[]).flat();f.forEach((e=>{Wp({individualParticipantProfiles:t,participantId:e});const i=t[e].priorMatchUpType!==c.matchUpType&&h||p;m.includes(e)?function({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:i,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=i,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:i}))})),Kp({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:i,timeAfterRecovery:p,matchUp:c})}function Jp({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var a,o,s,c,u;let d;const l=null===(a=r.minutesMap)||void 0===a||null===(o=a[n])||void 0===o?void 0:o.recoveryMinutes,p=Ln(i,((null===(s=r.minutesMap)||void 0===s||null===(c=s[n])||void 0===c?void 0:c.averageMinutes)||0)+(l||0)),h=(null==e||null===(u=e[n])||void 0===u?void 0:u.dependentMatchUpIds)||[];if(h.length){const e=h.reduce(((e,i)=>{const n=t[i];if(!n)return e;const r={scheduleTime:n,matchUpId:i};return n&&!e.matchUpId||An(n)<An(e.scheduleTime)?r:e}),{});e.scheduleTime&&An(p)>An(e.scheduleTime)&&(d=e)}return{scheduledDependent:d}}const $p="DO_NOT_SCHEDULE",Zp={DO_NOT_SCHEDULE:$p};function Xp({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){const s=function(t){const{sides:e,matchUpType:i}=t||{};return(e||[]).map((t=>{var e;return i===da?(null==t||null===(e=t.participant)||void 0===e?void 0:e.individualParticipants)||[]:null!=t&&t.participant?[t.participant]:[]})).flat()}(o).map((({person:t})=>null==t?void 0:t.personId));if(i){const t=((null==o?void 0:o.potentialParticipants)||[]).flat().map((({person:t})=>null==t?void 0:t.personId));s.push(...t)}const c=s.map((t=>{var e;return null===(e=n[t])||void 0===e?void 0:e.map((e=>({...e,personId:t})))})).filter(Boolean).flat().filter((t=>t.requestType===$p&&jn(a,t.date))),u=[],d=null==o?void 0:o.matchUpId,l=kn(Cn(r),Mn(a)),p=Cn(_n(l,t).toISOString());for(const h of c){const{requestId:t,startTime:i,endTime:n}=h;(r>i&&r<n||p>i&&p<n)&&(u.push({matchUpId:d,request:h,scheduleTime:r}),e[t]?(e[t].scheduleTimes.includes(r)||e[t].scheduleTimes.push(r),e[t].matchUpIds.includes(d)||e[t].matchUpIds.push(d)):e[t]={request:h,scheduleTimes:[r],matchUpIds:[d]})}return{conflicts:u}}function Qp({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var o,s,c,u,d;const l=((null==i||null===(o=i[r.matchUpId])||void 0===o?void 0:o.participantIds)||[]).flat(),p=(null==a||null===(s=a.minutesMap)||void 0===s||null===(c=s[r.matchUpId])||void 0===c?void 0:c.averageMinutes)||0,h=(null==a||null===(u=a.minutesMap)||void 0===u||null===(d=u[r.matchUpId])||void 0===d?void 0:d.recoveryMinutes)||0,f=l.every((e=>{var i;Wp({individualParticipantProfiles:t,participantId:e});let a=t[e];if(!a.timeAfterRecovery)return!0;const o=Cn(null==r||null===(i=r.schedule)||void 0===i?void 0:i.endTime),s=o?Ln(o,parseInt(h)):Ln(n,parseInt(p)+parseInt(h));return!!![...Object.keys(a.potentialBookings).filter((t=>t!==r.drawId)).map((t=>a.potentialBookings[t])).flat(),...a.bookings].find((t=>function(t,e){const i=An(t.scheduleTime),n=An(t.timeAfterRecovery),r=An(e.scheduleTime),a=An(e.timeAfterRecovery),o=i>r&&i<a,s=r>i&&r<n,c=n>r&&n<a,u=a>i&&a<n;return Gn({hasOverlap:i===r||n===a||o||c||s||u,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:n,timeAfterRecovery:s},t).hasOverlap))})),m=e[r.matchUpId],g=m?On(kn(m),kn(n),!1):0;return{enoughTime:f&&g>=0}}function th({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n,r,a,o,s=[],c=[];for(const u of t)n||(n=u.hash),(u.hash===n||i)&&(s=s.concat(u.matchUpIds)),u.hash===n||i||(n=u.hash,c.push({averageMinutes:r,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),s=u.matchUpIds),r=i?e:u.averageMinutes,a=u.recoveryMinutes,o=u.roundPeriodLength;return s.length&&c.push({averageMinutes:r,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),{groupedRounds:c}}function eh({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){const{matchUpId:r,matchUpType:a}=n,{enteredIndividualParticipantIds:o}=bd(n),s=(n.roundPosition&&e[r]||[]).flat(),c=X(o.concat(...s));c.forEach((e=>{Wp({individualParticipantProfiles:t,participantId:e})}));return{participantIdsAtLimit:c.filter((e=>{const n=t[e];if(n){return[a,ha].find((t=>{const e=n.counters&&n.counters[t]||0,r=i[t]||0;return e&&r&&e>=r}))}})),relevantParticipantIds:c}}function ih({tournamentRecords:t,requestType:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const i={};for(const n of Object.values(t)){const{extension:t}=aa({tournamentRecord:n,name:qr}),r=(null==t?void 0:t.value)||[];for(const n of r){const{personId:t,requests:r}=n||{};i[t]||(i[t]=[]);for(const n of r)e&&n.requestType!==e||i[t].push(n)}}return{personRequests:i}}function nh({tournamentRecords:t,personRequests:e}){if(!t)return{error:ht};for(const i of Object.values(t)){const{participants:t}=i,n=[];for(const i of Object.keys(e))if(ia({tournamentParticipants:t,personId:i})){const t=e[i];t.length&&n.push({personId:i,requests:t})}if(Object.keys(n).length){Wc({tournamentRecord:i,extension:{name:qr,value:n}})}}return dt}function rh({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);const n=i.filter((({requestType:t})=>t)).map((t=>{let{date:e,requestType:i,startTime:n,endTime:r}=t;return i===$p&&(e=Mn(e),n=Cn(n),r=Cn(r),e&&n&&r)?{date:e,startTime:n,endTime:r,requestType:i}:t})).filter(Boolean);for(const r of n)r.requestId=Z(),t[e].push(r);return{mergeCount:n.length}}function ah({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=F,tournamentRecord:i,scheduledDates:n}){if("object"!=typeof i)return{error:ft};if(!Array.isArray(e))return{error:_i};const{matchUps:r}=ud({matchUpFilters:{scheduledDates:n},tournamentRecord:i});return gd({schedule:{venueId:"",scheduledDate:"",scheduledTime:""},matchUpIds:r.filter((i=>!e.includes(i.matchUpStatus)&&up({schedule:i.schedule,scheduleAttributes:t}))).map(Rc),tournamentRecord:i})}function oh({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=F,tournamentRecords:i,scheduledDates:n}){const r="object"==typeof i&&Object.values(i).map((({tournamentId:t})=>t)).filter(Boolean);if(null==r||!r.length)return{error:ht};for(const a of r){const r=ah({ignoreMatchUpStatuses:e,scheduleAttributes:t,tournamentRecord:i[a],scheduledDates:n});if(r.error)return r}return{...dt}}function sh({tournamentRecord:t}){var e;if(!t)return{error:ft};const{policy:i}=ea({policyType:rr,tournamentRecord:t}),{extension:n}=aa({tournamentRecord:t,name:zr}),r=null==n||null===(e=n.value)||void 0===e?void 0:e.dailyLimits,a=null==i?void 0:i.defaultDailyLimits;return{matchUpDailyLimits:r||a}}function ch({tournamentRecords:t,tournamentId:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};let i;return Object.keys(t).filter((t=>!e||t===e)).find((e=>{const n=t[e],{matchUpDailyLimits:r}=sh({tournamentRecord:n});return i=r,!0})),{matchUpDailyLimits:i}}function uh({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,periodLength:i=30,tournamentRecords:n,venueIds:r=[],scheduleDate:a,matchUps:o}){if("object"!=typeof n)return{error:ht};if(!Array.isArray(o))return{error:fe};const s=Object.assign({},...Object.values(n).map((t=>(t.events||[]).map((e=>{const{scheduleTiming:i}=ca({tournamentRecord:t,event:e});return{[e.eventId]:{event:e,scheduleTiming:i}}})))).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},u=null==o?void 0:o.filter((t=>up(t)&&(!r.length||r.includes(t.schedule.venueId))&&(!a||t.schedule.scheduledDate===a)));return{bookings:null==u?void 0:u.map((({eventId:t,schedule:e,matchUpFormat:n})=>{const{event:r,scheduleTiming:a}=s[t],o=null==r?void 0:r.eventType,u={...a,defaultTiming:c,matchUpFormat:n},{averageMinutes:d,recoveryMinutes:l}=ya({eventType:o,timingDetails:u}),{courtId:p,venueId:h}=e,f=Cn(e.scheduledTime),m=Ln(f,d);return{averageMinutes:d,recoveryMinutes:l,periodLength:i,startTime:f,endTime:m,courtId:p,venueId:h}})).filter(Boolean),relevantMatchUps:u}}function dh({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=60,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,matchUps:d,endTime:l}){if("object"!=typeof o||!Object.keys(o).length)return{error:ht};const{courts:p,venues:h}=Dd({tournamentRecords:o}),f=p.filter((t=>!u||u.includes(t.venueId)));c||(c=f.reduce(((t,e)=>{var i;const n=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((t=>!t.date||jn(s,t.date))),r=(null==n?void 0:n.startTime)||e.startTime;return r&&(!t||An(r)<An(t))?r:t}),void 0)),l||(l=f.reduce(((t,e)=>{var i;const n=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((t=>!t.date||jn(s,t.date))),r=(null==n?void 0:n.endTime)||e.endTime;return r&&(!t||An(r)>An(t))?r:t}),void 0));const{bookings:m,relevantMatchUps:g}=uh({defaultRecoveryMinutes:e,averageMatchUpMinutes:i,tournamentRecords:o,scheduleDate:s,periodLength:a,venueIds:u,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,clearScheduleDates:r,date:s,periodLength:a,startTime:c,endTime:l,bookings:m,courts:f},{scheduleTimes:y}=$s(v);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==h?void 0:h.length)?h[0].venueId:void 0,scheduleTimes:y,dateScheduledMatchUpIds:g.map(Rc)}}function lh({checkPotentialRequestConflicts:t=!0,clearScheduleDates:e,scheduleDates:i=[],tournamentRecords:n,periodLength:r,dryRun:a}){return function({checkPotentialRequestConflicts:t=!0,clearScheduleDates:e,scheduleDates:i=[],tournamentRecords:n,periodLength:r,dryRun:a}){if(!n)return{error:ht};if(!Array.isArray(i))return{error:_i};const{schedulingProfile:o=[],issues:s=[],modifications:c}=xd({tournamentRecords:n}),u=Object.assign({},...Object.values(n).map((t=>Il({tournamentRecord:t}).containedStructures))),d=i.map((t=>{if(In(t))return Mn(t)})).filter(Boolean),l=o.map((t=>t.scheduleDate)).map((t=>In(t)&&Mn(t))).filter((t=>t&&(!i.length||d.includes(t))));if(!l.length)return{error:Ce};if(e&&!a){const t=Array.isArray(e)?e:void 0;oh({tournamentRecords:n,scheduledDates:t})}const{courts:p}=Dd({tournamentRecords:n}),{matchUps:h}=Fd({tournamentRecords:n,nextMatchUps:!0}),{matchUpDependencies:f}=Gd({includeParticipantDependencies:!0,tournamentRecords:n,matchUps:h}),{matchUpDailyLimits:m}=ch({tournamentRecords:n}),{personRequests:g}=ih({requestType:$p,tournamentRecords:n}),v=o.filter((t=>{const e=Mn(null==t?void 0:t.scheduleDate);return l.includes(e)})).sort(((t,e)=>{new Date(t.scheduleDate).getTime(),new Date(e.scheduleDate).getTime()})),y={},w={},b={},N={},E={},D={},A={},T={},M={},x={};for(const z of v){const i=Mn(null==z?void 0:z.scheduleDate),o=(null==z?void 0:z.venues)||[],s={},c={},d={},l=(t,e)=>{t.forEach((t=>{const i=d[t].counters;i[e]?i[e]+=1:i[e]=1,i[ha]?i[ha]+=1:i[ha]=1}))};b[i]={},N[i]={},y[i]={},w[i]={},A[i]=[],T[i]=[],M[i]=[],x[i]=[];const v={};h.forEach((t=>{var e;null!==(e=t.schedule)&&void 0!==e&&e.scheduledDate&&jn(i,Mn(t.schedule.scheduledDate))&&Kp({matchUp:t,matchUpNotBeforeTimes:v,matchUpPotentialParticipantIds:s})}));const H=[];for(const t of o){var k;const{rounds:a=[],venueId:o}=t,{scheduledRoundsDetails:l,greatestAverageMinutes:m,orderedMatchUpIds:g,minutesMap:y}=Gp({tournamentRecords:n,containedStructureIds:u,periodLength:r,matchUps:h,rounds:a});H.push(...g);const{groupedRounds:w}=th({scheduledRoundsDetails:l,greatestAverageMinutes:m,garmanSinglePass:!0}),{scheduleTimes:b,dateScheduledMatchUpIds:N}=dh({averageMatchUpMinutes:null===(k=w[0])||void 0===k?void 0:k.averageMinutes,scheduleDate:Mn(i),venueIds:[t.venueId],clearScheduleDates:e,tournamentRecords:n,periodLength:r,matchUps:h}),E=Array.isArray(e)?e.includes(i):e,A=E?[]:h.filter((({matchUpId:t})=>N.includes(t)));for(const t of A){var O;qp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,scheduleDate:i,matchUp:t,value:1});const e=null===(O=t.schedule)||void 0===O?void 0:O.scheduledTime;if(e){var L;D[t.matchUpId]=e;const n=null==y||null===(L=y[t.matchUpId])||void 0===L?void 0:L.recoveryMinutes;Yp({individualParticipantProfiles:d,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:v,matchUpDependencies:f,recoveryMinutes:n,averageMatchUpMinutes:m,scheduleDate:i,scheduleTime:e,matchUp:t})}}let T=g.map((t=>h.find((e=>e.matchUpId===t)))).filter(Boolean).filter((t=>{const e=!E&&N.includes(t.matchUpId),i=[S,P,U,I,C,R].includes(null==t?void 0:t.matchUpStatus);return!e&&!t.winningSide&&!i}));const{matchUpMap:M}=T.reduce(((t,e)=>{const{drawId:i,tournamentId:n}=e;return t.matchUpMap[n]||(t.matchUpMap[n]={}),t.matchUpMap[n][i]?t.matchUpMap[n][i].push(e):t.matchUpMap[n][i]=[e],Kp({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:v,matchUp:e}),t}),{matchUpMap:{}});c[o]={courtsCount:p.filter((t=>t.venueId===o)).length,previousRemainingScheduleTimes:[],greatestAverageMinutes:m,scheduledRoundsDetails:l,matchUpsToSchedule:T,scheduleTimes:b,groupedRounds:w,minutesMap:y,matchUpMap:M}}const W=10;let q,K=0,Y=10;for(;!q;){for(const{venueId:e}of o){var _,F,j;let n=0;const r=c[e];for(;r.courtsCount&&null!==(B=r.scheduleTimes)&&void 0!==B&&B.length&&null!==(V=r.matchUpsToSchedule)&&void 0!==V&&V.length&&n<=r.courtsCount;){var B,V;const{scheduleTime:a,attempts:o=0}=r.scheduleTimes.shift(),c=r.matchUpsToSchedule.find((e=>{var n,o;const{matchUpId:c,matchUpType:u}=e,{participantIdsAtLimit:p,relevantParticipantIds:y}=eh({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,matchUpDailyLimits:m,matchUp:e});if(p.length)return T[i].includes(c)||T[i].push(c),!1;const{scheduledDependent:I}=Jp({matchUpScheduleTimes:D,matchUpDependencies:f,scheduleTime:a,matchUpId:c,details:r});if(I)return!1;const{dependenciesScheduled:w,remainingDependencies:S}=zp({matchUpScheduleTimes:D,matchUpDependencies:f,allDateMatchUpIds:H,matchUps:h,matchUp:e});if(!w)return N[i][c]||(N[i][c]=[]),N[i][c].push({scheduleTime:a,remainingDependencies:S}),!1;const{enoughTime:U}=Qp({individualParticipantProfiles:d,matchUpNotBeforeTimes:v,matchUpDependencies:f,scheduleTime:a,details:r,matchUp:e});if(!U)return b[i][c]||(b[i][c]=[]),b[i][c].push({scheduleTime:a}),!1;const P=r.greatestAverageMinutes,{conflicts:A}=Xp({potentials:t,averageMatchUpMinutes:P,requestConflicts:x,personRequests:g,scheduleTime:a,scheduleDate:i,matchUp:e});if(null!=A&&A.length)return E[i]||(E[i]=[]),E[i].push(...A),!1;l(y,u);const C=null===(n=r.minutesMap)||void 0===n||null===(o=n[c])||void 0===o?void 0:o.recoveryMinutes;return Yp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,matchUpNotBeforeTimes:v,averageMatchUpMinutes:P,matchUpDependencies:f,recoveryMinutes:C,scheduleDate:i,scheduleTime:a,matchUp:e}),D[c]=a,!0}));r.matchUpsToSchedule=r.matchUpsToSchedule.filter((({matchUpId:t})=>t!==(null==c?void 0:c.matchUpId))),c?n+=1:(w[i][e]||(w[i][e]=[]),w[i][e].push({scheduleTime:a,attempts:o+1}))}var G;null!==(_=r.matchUpsToSchedule)&&void 0!==_&&_.length&&(w[i][e]=null===(G=w[i][e])||void 0===G?void 0:G.filter((t=>{const e=t.attempts<Y;return e&&r.scheduleTimes.push(t),!e}))),null!==(F=r.scheduleTimes)&&void 0!==F&&F.length&&null!==(j=r.matchUpsToSchedule)&&void 0!==j&&j.length||(r.complete=!0)}K+=1,q=o.every((({venueId:t})=>c[t].complete))||K===W}for(const{venueId:t}of o){const e=c[t].matchUpMap;Object.keys(e).forEach((r=>{const o=n[r];o&&Object.keys(e[r]).forEach((n=>{const{drawDefinition:s}=wa({tournamentRecord:o,drawId:n});s&&e[r][n].forEach((({matchUpId:e})=>{const n=D[e];if(n){const r=n.split(":").map(Fn).join(":"),c=`${Mn(i)}T${r}`;a?A[i].push(e):(zu({drawDefinition:s,matchUpId:e,scheduledTime:c}).success&&A[i].push(e),t&&Fu({tournamentRecord:o,drawDefinition:s,matchUpId:e,venueId:t}))}}))}))})),M[i]=c[t].matchUpsToSchedule.map(Rc),y[i][t]=c[t].scheduleTimes.sort(((t,e)=>An(t.scheduleTime)-An(e.scheduleTime)))}}const H=v.map((({scheduleDate:t})=>t)),W={timeStamp:Date.now(),schedulingProfile:o,scheduledDates:H,noTimeMatchUpIds:M,scheduledMatchUpIds:A,overLimitMatchUpIds:T,requestConflicts:x},{topics:q}=an();if(q.includes(uc))en({topic:uc,payload:W});else{const t={itemType:"autoSchedulingAudit",itemValue:W};for(const e of Object.values(n))nc({tournamentRecord:e,timeItem:t})}return{...dt,schedulingProfileModifications:c,schedulingProfileIssues:s,scheduleTimesRemaining:y,skippedScheduleTimes:w,recoveryTimeDeferredMatchUpIds:b,dependencyDeferredMatchUpIds:N,matchUpScheduleTimes:D,scheduledMatchUpIds:A,overLimitMatchUpIds:T,noTimeMatchUpIds:M,requestConflicts:x,scheduledDates:H}}({checkPotentialRequestConflicts:t,clearScheduleDates:e,tournamentRecords:n,scheduleDates:i,periodLength:r,dryRun:a})}function ph({event:t}){return t?Yc({event:t,name:Kr}):{error:zt}}function hh({tournamentParticipants:t,drawDefinition:e,participantId:i,matchUpId:n,event:r}){if(!i)return{error:Ye};if(!n)return{error:me};if(t&&t.length){const{matchUp:a}=ku({tournamentParticipants:t,inContext:!0,drawDefinition:e,matchUpId:n,event:r});if(!a)return{error:he};const{error:o,checkedInParticipantIds:s,allRelevantParticipantIds:c}=Cu({matchUp:a});if(!c.includes(i))return{error:Ge};if(o)return{error:o};if(s.includes(i))return{error:ei}}return Ou({drawDefinition:e,matchUpId:n,timeItem:{itemType:lr,itemValue:i}})}function fh({tournamentParticipants:t,drawDefinition:e,participantId:i,matchUpId:n,event:r}){if(!i)return{error:Ye};if(!n)return{error:le};if(t&&t.length){const{matchUp:a}=ku({tournamentParticipants:t,inContext:!0,drawDefinition:e,matchUpId:n,event:r}),{checkedInParticipantIds:o,allRelevantParticipantIds:s}=Cu({matchUp:a});if(!s.includes(i))return{error:Ge};if(!o.includes(i))return{error:ti};const{sideParticipantIds:c,nestedIndividualParticipantIds:u}=Tu({matchUp:a}),d=c.indexOf(i);[0,1].includes(d)&&(u[d]||[]).forEach((t=>{Ou({drawDefinition:e,matchUpId:n,timeItem:{itemType:pr,itemValue:t}})}))}return Ou({drawDefinition:e,matchUpId:n,timeItem:{itemType:pr,itemValue:i}})}function mh(t){if(null==t||!t.tournamentRecord)return{error:ft};const{tournamentRecord:e,participantId:i,matchUpId:n,drawDefinition:r}=t,a=e.participants||[],{matchUp:o}=md({tournamentRecord:e,drawDefinition:r,matchUpId:n,inContext:!0});if(!o)return{error:he};const{checkedInParticipantIds:s=[]}=Cu({matchUp:o});return s.includes(i)?fh({drawDefinition:r,tournamentParticipants:a,matchUpId:n,participantId:i}):hh({drawDefinition:r,tournamentParticipants:a,matchUpId:n,participantId:i})}function gh(t){const{tournamentRecords:e}=t;if(!e)return{error:ht};const{tournamentId:i,drawId:n,matchUpId:r,courtDayDate:a}=t,o=e[i];if(!o)return{error:ft};const{drawDefinition:s}=wa({tournamentRecord:o,drawId:n});return Vu({tournamentRecord:o,drawDefinition:s,matchUpId:r,courtId:"",courtDayDate:a})}const vh="OTHER",yh="OFFICIAL",Ih="COMPETITOR",wh={OTHER:vh,COACH:"COACH",MEDIA:"MEDIA",CAPTAIN:"CAPTAIN",MEDICAL:"MEDICAL",OFFICIAL:yh,SECURITY:"SECURITY",COMPETITOR:Ih,ADMINISTRATION:"ADMINISTRATION"};function Sh(t){return Wu(t)}function bh({drawDefinition:t,matchUpId:e,disableNotice:i,scheduledDate:n}){return qu({drawDefinition:t,matchUpId:e,disableNotice:i,scheduledDate:n})}function Uh({drawDefinition:t,scheduledTime:e,matchUpId:i,disableNotice:n}){return zu({drawDefinition:t,matchUpId:i,scheduledTime:e,disableNotice:n})}function Nh({drawDefinition:t,matchUpId:e,startTime:i,disableNotice:n}){return Yu({drawDefinition:t,matchUpId:e,startTime:i,disableNotice:n})}function Ph({drawDefinition:t,matchUpId:e,endTime:i,disableNotice:n}){return Ju({drawDefinition:t,matchUpId:e,endTime:i,disableNotice:n})}function Eh({drawDefinition:t,matchUpId:e,stopTime:i,disableNotice:n}){return $u({drawDefinition:t,matchUpId:e,stopTime:i,disableNotice:n})}function Dh({drawDefinition:t,matchUpId:e,resumeTime:i,disableNotice:n}){return Zu({drawDefinition:t,matchUpId:e,resumeTime:i,disableNotice:n})}function Ah({tournamentRecord:t,drawDefinition:e,participantId:i,officialType:n,matchUpId:r,disableNotice:a}){if(!i)return{error:Ye};const{tournamentParticipants:o}=Np({tournamentRecord:t,participantFilters:{participantTypes:[Ra],participantRoles:[yh]}});if(!ia({tournamentParticipants:o,participantId:i}))return{error:Je};return Ku({drawDefinition:e,participantId:i,officialType:n,matchUpId:r,disableNotice:a})}function Th({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){if(!t)return{error:ft};if(!i||!Array.isArray(i))return{error:pe};if("object"!=typeof e)return{error:_i};const r=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...dt};if(o&&isNaN(o))return{error:_i};if(s&&isNaN(s))return{error:_i};const{matchUps:c}=ud({tournamentRecord:t,matchUpFilters:{matchUpIds:i}}),u=null==c?void 0:c.filter(up).filter((({matchUpStatus:t})=>!F.includes(t)));if(!u.length)return{...dt};const{tournamentInfo:d}=Pd({tournamentRecord:t}),{startDate:l,endDate:p}=d,h=u.reduce(((t,e)=>{const{matchUpId:i,drawId:n}=e;return t[n]?t[n].push(i):t[n]=[i],t}),{});for(const m of Object.keys(h)){const{drawDefinition:e,error:c}=wa({tournamentRecord:t,drawId:m});if(c)return{error:c};const d=h[m].filter((t=>i.includes(t)));for(const t of d)if(t&&e){const i=u.find((e=>e.matchUpId===t)),c=i.schedule,{scheduledTime:d,scheduledDate:h}=c;let f,m,g;if(o&&d){const t=Mn(d),e=An(Cn(d))+o;if(f=e<0||e>1440,!f){let e=Ln(d,o);m=t?`${t}T${e}`:e}}if(!f&&s&&h){g=xn(Mn(h),s),f=new Date(g)<new Date(l)||new Date(g)>new Date(p)}if(f)a.push(i);else{if(!n){if(m){const i=Uh({drawDefinition:e,matchUpId:t,scheduledTime:m});if(i.error)return i}if(g){const i=bh({drawDefinition:e,matchUpId:t,scheduledDate:g});if(i.error)return i}}(m||g)&&r.push(i)}}}const f=r.length&&!a.length;return{...dt,rescheduled:r,notRescheduled:a,allRescheduled:f}}function Ch({tournamentRecord:t,dailyLimits:e}){if(!t)return{error:ft};if("object"!=typeof e)return{error:Li};return Wc({tournamentRecord:t,extension:{name:zr,value:{dailyLimits:e}}})}function Mh({tournamentRecords:t,tournamentId:e,drawId:i}){if(!t)return{error:ht};if("string"!=typeof e&&!(e=yd({tournamentRecords:t,drawId:i})))return{error:gt};const n=t[e];if(!n)return{error:ft};const{drawDefinition:r,error:a}=Ia({tournamentRecord:n,drawId:i});return{drawDefinition:r,error:a,tournamentRecord:n}}const xh={scheduleMatchUps:function({tournamentRecords:t,competitionMatchUps:e,matchUpDependencies:i,allDateMatchUpIds:n=[],averageMatchUpMinutes:r=90,recoveryMinutes:a=0,recoveryMinutesMap:o,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:c={},matchUpNotBeforeTimes:u={},matchUpDailyLimits:d={},checkPotentialRequestConflicts:l=!0,remainingScheduleTimes:p,clearScheduleDates:h,periodLength:f=30,scheduleDate:m,matchUpIds:g,venueIds:v,startTime:y,endTime:w,dryRun:b}){if(!t)return{error:ht};if(!g)return{error:pe};if(!In(m))return{error:ke};if(isNaN(f)||isNaN(r)||isNaN(a))return{error:_i};e||({matchUps:e}=Fd({tournamentRecords:t,nextMatchUps:!0})),i||({matchUpDependencies:i}=Gd({tournamentRecords:t,includeParticipantDependencies:!0,matchUps:e})),e.forEach((t=>{var e;null!==(e=t.schedule)&&void 0!==e&&e.scheduledDate&&jn(m,Mn(t.schedule.scheduledDate))&&Kp({matchUp:t,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s})}));const N=g.map((t=>e.find((e=>e.matchUpId===t)))).filter(Boolean),{venueId:E,scheduleTimes:D,dateScheduledMatchUpIds:A}=Hp({tournamentRecords:t,remainingScheduleTimes:p,startTime:Cn(y),endTime:Cn(w),scheduleDate:Mn(m),averageMatchUpMinutes:r,clearScheduleDates:h,periodLength:f,venueIds:v}),T={},M=[],x={},k={},O={};e.filter((({matchUpId:t})=>A.includes(t))).forEach((t=>{var e;qp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,scheduleDate:m,matchUp:t,value:1});const n=null===(e=t.schedule)||void 0===e?void 0:e.scheduledTime;if(n){x[t.matchUpId]=n;const e=null==o?void 0:o[t.matchUpId];Yp({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:u,matchUpDependencies:i,recoveryMinutes:e||a,averageMatchUpMinutes:r,scheduleDate:m,scheduleTime:n,matchUp:t})}}));let L=N.filter((t=>{const e=A.includes(t.matchUpId),i=[S,P,U,I,C,R].includes(null==t?void 0:t.matchUpStatus);return!e&&!t.winningSide&&!i}));const{matchUpMap:_,overLimitMatchUpIds:F,participantIdsAtLimit:j}=L.reduce(((t,e)=>{const{drawId:i,tournamentId:n,matchUpType:r}=e,{participantIdsAtLimit:a,relevantParticipantIds:o}=eh({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpDailyLimits:d,matchUp:e});return null!=a&&a.length?(t.overLimitMatchUpIds.push(e.matchUpId),t.participantIdsAtLimit.push(...a),t):(o.forEach((t=>{Wp({individualParticipantProfiles:c,participantId:t});const e=c[t].counters;e[r]?e[r]+=1:e[r]=1,e[ha]?e[ha]+=1:e[ha]=1})),t.matchUpMap[n]||(t.matchUpMap[n]={}),t.matchUpMap[n][i]?t.matchUpMap[n][i].push(e):t.matchUpMap[n][i]=[e],Kp({matchUp:e,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s}),t)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});L=L.filter((({matchUpId:t})=>!F.includes(t)));let B=0;const V=(null==D?void 0:D.length)||0,{personRequests:G}=ih({tournamentRecords:t,requestType:$p});for(;null!=D&&D.length&&L.length&&B<=V;){B++;const{scheduleTime:t}=D.shift(),d=L.find((d=>{const{matchUpId:p}=d,{dependenciesScheduled:h,remainingDependencies:f}=zp({matchUps:e,matchUpScheduleTimes:x,matchUpDependencies:i,allDateMatchUpIds:n,matchUp:d});if(!h)return O[p]||(O[p]=[]),O[p].push({scheduleTime:t,remainingDependencies:f}),!1;const{enoughTime:g}=Qp({individualParticipantProfiles:c,matchUpNotBeforeTimes:u,matchUpDependencies:i,scheduleTime:t,matchUp:d});if(!g)return k[p]||(k[p]=[]),k[p].push({scheduleTime:t}),!1;const{conflicts:v}=Xp({potentials:l,averageMatchUpMinutes:r,requestConflicts:T,personRequests:G,scheduleTime:t,scheduleDate:m,matchUp:d});if(null!=v&&v.length)return!1;const y=null==o?void 0:o[d.matchUpId];return Yp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUpNotBeforeTimes:u,averageMatchUpMinutes:r,matchUpDependencies:i,recoveryMinutes:y||a,scheduleDate:m,scheduleTime:t,matchUp:d}),x[d.matchUpId]=t,!0}));L=L.filter((({matchUpId:t})=>t!==(null==d?void 0:d.matchUpId))),d||M.push(t)}L.forEach((t=>{qp({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,scheduleDate:m,value:-1,matchUp:t})}));let H=[];Object.keys(_).forEach((e=>{const i=t[e];i?Object.keys(_[e]).forEach((t=>{const{drawDefinition:n}=wa({tournamentRecord:i,drawId:t});if(n){_[e][t].forEach((({matchUpId:t})=>{const e=x[t];if(e){const r=e.split(":").map(Fn).join(":"),a=`${Mn(m)}T${r}`;if(b)H.push(t);else{zu({drawDefinition:n,matchUpId:t,scheduledTime:a}).success&&H.push(t),E&&Fu({tournamentRecord:i,drawDefinition:n,matchUpId:t,venueId:E})}}}))}})):Xi()&&console.log(gt)}));const W=Tc(L);return{...dt,requestConflicts:Object.values(T),remainingScheduleTimes:D.map((({scheduleTime:t})=>t)),individualParticipantProfiles:c,matchUpNotBeforeTimes:u,participantIdsAtLimit:j,skippedScheduleTimes:M,overLimitMatchUpIds:F,scheduledMatchUpIds:H,noTimeMatchUpIds:W,recoveryTimeDeferred:k,dependencyDeferred:O}},scheduleProfileRounds:lh,clearScheduledMatchUps:oh,bulkRescheduleMatchUps:function({tournamentRecords:t,scheduleChange:e,matchUpIds:i,dryRun:n}){if(!t)return{error:ht};if(!i||!Array.isArray(i))return{error:pe};if("object"!=typeof e)return{error:_i};const r=[];let a=[];for(const u of Object.values(t)){var o;const t=Th({tournamentRecord:u,scheduleChange:e,matchUpIds:i,dryRun:n});if(t.error)return t;Array.isArray(t.notRescheduled)&&a.push(...t.notRescheduled);const c=Tc(t.notRescheduled),d=[];var s;if(null===(o=t.rescheduled)||void 0===o||o.forEach((t=>{const{matchUpId:e}=t;c.includes(e)&&d.push(e),r.push(t)})),d.length)a=(null==t||null===(s=t.notRescheduled)||void 0===s?void 0:s.filter((({matchUpId:t})=>!d.includes(t))))||[]}const c=r.length&&!a.length;return{...dt,rescheduled:r,notRescheduled:a,allRescheduled:c}},getScheduledRoundsDetails:Gp,getMatchUpDependencies:Gd,generateVirtualCourts:Ys,generateBookings:uh,matchUpScheduleChange:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:ht};const{sourceMatchUpContextIds:i,targetMatchUpContextIds:n,sourceCourtId:r,targetCourtId:a,courtDayDate:o}=t||{},{drawId:s,matchUpId:c,tournamentId:u}=i||{},{drawId:d,matchUpId:l,tournamentId:p}=n||{};if(!c&&!l)return{error:Ae};let h=0;if(a&&c&&!l){const t=f({tournamentId:u,drawId:s,courtDayDate:o,matchUpId:c,courtId:a});if(null!=t&&t.success&&h++,t.error)return t}else if(r&&a&&c&&l){const t=f({tournamentId:u,drawId:s,courtDayDate:o,matchUpId:c,courtId:a});if(t.success&&h++,t.error)return t;const e=f({tournamentId:p,drawId:d,courtDayDate:o,matchUpId:l,courtId:r});if(e.success&&h++,e.error)return e}return h?dt:{error:ki};function f({tournamentId:t,drawId:i,matchUpId:n,courtDayDate:r,courtId:a}){const o=e[t],{drawDefinition:s}=wa({tournamentRecord:o,drawId:i});return Vu({tournamentRecord:o,drawDefinition:s,matchUpId:n,courtId:a,courtDayDate:r})}},calculateScheduleTimes:Hp,reorderUpcomingMatchUps:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:ht};const{matchUpsContextIds:i,firstToLast:n}=t;if(!i)return{error:Ae};const r=null==i?void 0:i.length;if(!r)return dt;let a=0;return i.forEach(((t,o)=>{const{tournamentId:s,drawId:c,matchUpId:u}=t;let d=o+(n?-1:1);d<0&&(d=r-1),d===r&&(d=0);const l=function({tournamentId:t,drawId:i,matchUpId:n,scheduledTime:r}){const a=e[t],{drawDefinition:o}=wa({tournamentRecord:a,drawId:i});return zu({drawDefinition:o,matchUpId:n,scheduledTime:r})}({tournamentId:s,drawId:c,matchUpId:u,scheduledTime:i[d].schedule.scheduledTime});if(!l.success)return l;a++})),a===r?dt:{error:Ri}},bulkUpdateCourtAssignments:function({tournamentRecords:t,courtAssignments:e,courtDayDate:i}){if(!t)return{error:ht};if(!Array.isArray(e))return{error:Ae};const n=e.reduce(((t,e)=>{const{tournamentId:i}=e;return t[i]||(t[i]=[]),t[i].push(e),t}),{});let r;return Object.keys(n).every((e=>{const a=t[e];if(!a)return r={error:ft},!1;const o=n[e].reduce(((t,e)=>{const{drawId:i}=e;return t[i]||(t[i]=[]),t[i].push(e),t}),{});Object.keys(o).every((t=>{const{drawDefinition:e}=Ia({tournamentRecord:a,drawId:t});return e?(o[t].every((t=>{const{matchUpId:n,courtId:o}=t,s=Vu({tournamentRecord:a,drawDefinition:e,courtDayDate:i,matchUpId:n,courtId:o});if(s.success)return null==s?void 0:s.success;r={error:"Unable to assign court"}})),!0):(r={error:yt},!1)}))})),r||dt},removeMatchUpCourtAssignment:gh,toggleParticipantCheckInState:function(t){const{tournamentRecords:e}=t,{participantId:i,tournamentId:n,matchUpId:r,drawId:a}=t;if(!(e&&n&&i&&r))return{error:Ae};const o=e[n],{drawDefinition:s}=wa({tournamentRecord:o,drawId:a});return Object.assign(t,{drawDefinition:s,tournamentRecord:o}),mh(t)},findMatchUpFormatTiming:Vp,modifyMatchUpFormatTiming:function({tournamentRecords:t,matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const o=Object.keys(t).filter((t=>!r||r===t));if(r&&!o.includes(r))return{error:_i};let s;for(const c of o){const r=t[c],{event:o}=Ia({tournamentRecord:r,eventId:a});a&&o&&(s=!0);const u=Op({tournamentRecord:r,event:o,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(u.error)return u}return!a||s?{...dt}:{error:Kt}},modifyEventMatchUpFormatTiming:function({tournamentRecords:t,tournamentId:e,eventId:i,categoryType:n,matchUpFormat:r,averageMinutes:a,recoveryMinutes:o}){if(!i)return{error:zt};const s=Object.keys(t).filter((t=>!e||e===t));if(e&&!s.includes(e))return{error:_i};for(const c of s){const e=t[c],{event:s}=Ia({tournamentRecord:e,eventId:i});if(s)return _p({tournamentRecord:e,event:s,categoryType:n,matchUpFormat:r,averageMinutes:a,recoveryMinutes:o})}return{error:Kt}},getMatchUpFormatTimingUpdate:function({tournamentRecords:t}){return Fp({tournamentRecords:t,extensionName:Kr})},getEventMatchUpFormatTiming:function({tournamentRecords:t,matchUpFormats:e,categoryType:i,tournamentId:n,eventId:r}){if(!r)return{error:zt};const a=Object.keys(t).filter((t=>!n||t===n));if(n&&!a.length)return{error:_i};let o,s,c;return a.find((n=>{const a=t[n],{event:u}=Ia({tournamentRecord:a,eventId:r});if(!u)return!1;c=!0;const{eventMatchUpFormatTiming:d,error:l}=jp({tournamentRecord:a,matchUpFormats:e,categoryType:i,event:u});return l&&(s=l),o=d,!0})),c?s?{error:s}:{eventMatchUpFormatTiming:o}:{error:Kt}},removeEventMatchUpFormatTiming:function({tournamentRecords:t,eventId:e}){if(!t)return{error:ht};if("string"!=typeof e)return{error:Ae};for(const i of Object.values(t)){const{event:t}=Ia({tournamentRecord:i,eventId:e});if(t)return ph({event:t})}return{error:Kt}},getMatchUpDailyLimits:ch,setMatchUpDailyLimits:function({tournamentRecords:t,tournamentId:e,dailyLimits:i}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const n=Object.keys(t).filter((t=>!e||e===t));if(e&&!n.includes(e))return{error:_i};for(const r of n){const e=Ch({tournamentRecord:t[r],dailyLimits:i});if(e.error)return e}return dt},getMatchUpDailyLimitsUpdate:function({tournamentRecords:t}){return Fp({tournamentRecords:t,extensionName:zr})},assignMatchUpVenue:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{matchUpId:r,venueId:a,disableNotice:o}=t;return Fu({tournamentRecord:e,drawDefinition:i,disableNotice:o,matchUpId:r,venueId:a})},assignMatchUpCourt:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{matchUpId:r,courtId:a,courtDayDate:o,disableNotice:s}=t;return Vu({tournamentRecord:e,disableNotice:s,drawDefinition:i,courtDayDate:o,matchUpId:r,courtId:a})},addMatchUpScheduleItems:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);return n?{error:n}:Sh({...t,tournamentRecord:e,drawDefinition:i})},addMatchUpScheduledDate:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{disableNotice:r,scheduledDate:a,matchUpId:o}=t;return bh({tournamentRecord:e,drawDefinition:i,disableNotice:r,scheduledDate:a,matchUpId:o})},addMatchUpScheduledTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{disableNotice:r,scheduledTime:a,matchUpId:o}=t;return Uh({tournamentRecord:e,drawDefinition:i,disableNotice:r,scheduledTime:a,matchUpId:o})},addMatchUpStartTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{disableNotice:r,startTime:a,matchUpId:o}=t;return Nh({tournamentRecord:e,drawDefinition:i,disableNotice:r,startTime:a,matchUpId:o})},addMatchUpStopTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{disableNotice:r,stopTime:a,matchUpId:o}=t;return Eh({tournamentRecord:e,drawDefinition:i,disableNotice:r,stopTime:a,matchUpId:o})},addMatchUpResumeTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{disableNotice:r,resumeTime:a,matchUpId:o}=t;return Dh({tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:a,matchUpId:o})},addMatchUpEndTime:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{disableNotice:r,endTime:a,matchUpId:o}=t;return Ph({tournamentRecord:e,drawDefinition:i,disableNotice:r,endTime:a,matchUpId:o})},addMatchUpOfficial:function(t){const{tournamentRecord:e,drawDefinition:i,error:n}=Mh(t);if(n)return{error:n};const{disableNotice:r,participantId:a,officialType:o,matchUpId:s}=t;return Ah({tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:a,officialType:o,matchUpId:s})},getSchedulingProfile:xd,setSchedulingProfile:Rd,addSchedulingProfileRound:kd,isValidSchedulingProfile:Ud,addPersonRequests:function({tournamentRecords:t,personId:e,requests:i}){if(!t)return{error:ht};if("string"!=typeof e)return{error:_i};if(!Array.isArray(i))return{error:_i};const{personRequests:n}=ih({tournamentRecords:t}),{mergeCount:r}=rh({personRequests:n,personId:e,requests:i});return r?nh({tournamentRecords:t,personRequests:n}):{error:_i}},getPersonRequests:ih,modifyPersonRequests:function({tournamentRecords:t,requests:e,personId:i}){if(!t)return{error:ht};if(!Array.isArray(e))return{error:_i};const n=e.map((({requestId:t})=>t)).filter(Boolean),{personRequests:r}=ih({tournamentRecords:t}),a=t=>{r[t]=r[t].map((t=>{if(!n.includes(t.requestId))return t;const i=e.find((e=>e.requestId===t.requestId));return i.requestType?Object.assign(t,i):void 0})).filter(Boolean)};if(i&&r[i])a(i);else for(const s of Object.keys(r))a(s);const o=e.filter((t=>!t.requestId));return o.length&&rh({personRequests:r,personId:i,requests:o}),nh({tournamentRecords:t,personRequests:r})},removePersonRequests:function({tournamentRecords:t,requestType:e,requestId:i,personId:n,date:r}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const{personRequests:a}=ih({tournamentRecords:t}),o=t=>{a[t]=a[t].filter((t=>!(e&&t.requestType===e||i&&t.requestId===i||r&&t.date===r))),a[t].length||delete a[t]},s=!(e||i||n||r);if(!s)if(n&&a[n])o(n);else for(const c of Object.keys(a))o(c);return s||!Object.keys(a).length?Md({tournamentRecords:t,name:qr}):nh({tournamentRecords:t,personRequests:a})}};function Rh({tournamentRecord:t,policyDefinitions:e,allowReplacement:i}){if(!t)return{error:ft};if(!e||"object"!=typeof e)return{error:ye};t.extensions||(t.extensions=[]);const{appliedPolicies:n}=Xr({tournamentRecord:t}),r=Object.keys(e).map((t=>{if(!n[t]||i)return n[t]=e[t],t})).filter(Boolean);if(null!=r&&r.length){const e=Wc({tournamentRecord:t,extension:{name:Lr,value:n}});if(e.error)return e}return null!=r&&r.length?{...dt,applied:r}:{error:be}}function kh({policyDefinitions:t,allowReplacement:e,event:i}){if(!i)return{error:zt};if(!t)return{error:ye};let n=0;i.extensions||(i.extensions=[]);const{appliedPolicies:r}=Qr({event:i});if(Object.keys(t).forEach((i=>{r[i]&&!e||(r[i]=t[i],n++)})),n){zc({event:i,extension:{name:Lr,value:r}})}return n?dt:{error:Ue}}const Oh={attachPolicies:function({tournamentRecords:t,policyDefinitions:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};for(const i of Object.values(t)){const t=Rh({tournamentRecord:i,policyDefinitions:e,allowReplacement:!0});if(t.error)return t}return dt}};function Lh(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antoina, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and challenging me.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}const _h="REFEREE",Fh="SCHEDULE",jh="SCORE",Bh="START",Vh="STATUS",Gh={END:"END",NICKNAME:"NICKNAME",PENALTY:"PENALTY",REFEREE:_h,SCHEDULE:Fh,SCORE:jh,START:Bh,STATUS:Vh};function Hh({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i,matchUpId:n,event:r}){var a,o,s;if(!e)return{error:yt};if(!n)return{error:le};const{matchUp:c,structure:u}=ku({drawDefinition:e,matchUpId:n,event:r}),{assignedPositions:d,allPositionsAssigned:l}=Du({structure:u}),{drawPositions:p}=c||{},{structureId:h}=u||{},f=[];if(!h)return{validActions:f};const m=Sl({drawDefinition:e,structure:u}),g=d.filter((t=>t.participantId)).map((t=>t.drawPosition)),v=d.filter((t=>t.bye)).map((t=>t.drawPosition)),y=c.collectionId,I=c.matchUpStatus===S||!y&&(null===(a=c.drawPositions)||void 0===a?void 0:a.reduce(((t,e)=>v.includes(e)||t),!1));if(I)return{validActions:f,isByeMatchUp:I};const w=null==p?void 0:p.reduce(((t,e)=>g.includes(e)&&t),2===(null==p?void 0:p.length));f.push({type:_h});const b=!Hd({matchUpStatus:c.matchUpStatus}),{appliedPolicies:U}=kc({drawDefinition:e}),N=null==U||null===(o=U.scoring)||void 0===o?void 0:o.structures,P=(null==N?void 0:N.stage)&&(null==N?void 0:N.stage[u.stage]),D=(null==P?void 0:P.stageSequence)&&P.stageSequence[u.stageSequence],A=!((null==U||null===(s=U.scoring)||void 0===s?void 0:s.requireAllPositionsAssigned)||(null==P?void 0:P.requireAllPositionsAssigned)||(null==D?void 0:D.requireAllPositionsAssigned))||l,T=c.sides&&2===c.sides.filter((t=>t&&t.participantId)).length;let C;const M=c.matchUpStatus===E;if(M){i=i||Lc({drawDefinition:e}),t||({matchUps:t}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:i}));C=jl({inContextDrawMatchUps:t,drawDefinition:e,targetData:id({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:n})})}const x=(w||T)&&!(M&&C),{drawId:R}=e,k={type:js,method:Cs,payload:{drawId:R,matchUpId:n,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(b&&f.push({type:Fh}),x&&f.push(k),b&&x&&f.push({type:Vh}),A&&x){const{matchUpId:t,matchUpFormat:e}=c,i={drawId:R,matchUpId:t,matchUpFormat:e,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};f.push({type:jh,method:"setMatchUpStatus",message:"set outcome and winningSide",payload:i}),f.push({type:Bh}),f.push({type:"END"})}return{validActions:f,isDoubleWalkover:M,structureIsComplete:m}}function Wh({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){if(!t)return{error:ft};if(!n){const{matchUps:r}=ud({tournamentRecord:t});n=r.reduce(((t,e)=>e.matchUpId===i?e.drawId:t),void 0);e=(t.events||[]).map((t=>t.drawDefinitions||[])).flat().reduce(((t,e)=>e.drawId===n?e:t),void 0)}return n?Hh({drawDefinition:e,matchUpId:i}):{error:wt}}const qh={getCompetitionDateRange:Ed,getTournamentIds:function({tournamentRecords:t}){const e=Object.keys(t);return{...dt,tournamentIds:e}},competitionScheduleMatchUps:jd,getSchedulingProfileIssues:function({tournamentRecords:t,scheduleDates:e=[]}={}){if("object"!=typeof t)return{error:mt};if(!Array.isArray(e))return{error:_i};if(!e.every(In))return{error:ke};const i=[];let n=0;const r={},{schedulingProfile:a}=xd({tournamentRecords:t});if(!a)return{issues:i,...dt};const{matchUps:o}=Fd({tournamentRecords:t,nextMatchUps:!0});for(const s of a){const{scheduleDate:a,venues:c=[]}=s;if(null==e||!e.length||e.includes(a))for(const e of c||[])if(e){const{rounds:s}=e,c=[];let{orderedMatchUpIds:u,scheduledRoundsDetails:d}=Gp({tournamentRecords:t,periodLength:30,matchUps:o,rounds:s});const{matchUpDependencies:l}=Gd({tournamentRecords:t,matchUps:o}),p=t=>{let e;return d.find(((i,n)=>{const r=i.matchUpIds.includes(t);return r&&(e=n),r})),e};if(u.forEach(((t,e)=>{var i;const n=ot(u.slice(e+1),(null==l||null===(i=l[t])||void 0===i?void 0:i.matchUpIds)||[]);n.length&&c.push({matchUpId:t,shouldBeAfter:n})})),c.length){n+=c.length;const t=c.map((({matchUpId:t,shouldBeAfter:e})=>{const i=p(t),n=X(e.map(p));return r[a]||(r[a]={}),r[a][i]||(r[a][i]=[]),n.forEach((t=>{r[a][i].includes(t)||r[a][i].push(t)})),{matchUpId:t,matchUpRoundIndex:i,earlierRoundIndices:n,shouldBeAfter:e}}));i.push(...t)}}}return{issuesCount:n,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...i.map((t=>{const{matchUpId:e,shouldBeAfter:i,earlierRoundIndices:n}=t;return{[e]:{earlierRoundIndices:n,shouldBeAfter:i}}})))},roundIndexShouldBeAfter:r,...dt}},allCompetitionMatchUps:Fd,competitionMatchUps:Bd,matchUpActions:function({tournamentRecords:t,tournamentId:e,matchUpId:i,eventId:n,drawId:r}={}){if("object"!=typeof t||"string"!=typeof e||"string"!=typeof i||"string"!=typeof r)return{error:_i};const a=t[e];if(!a)return{error:ft};const{drawDefinition:o,error:s}=Ia({tournamentRecord:a,eventId:n,drawId:r});return s?{error:s}:Wh({tournamentRecord:a,drawDefinition:o,drawId:r,matchUpId:i})},getCompetitionVenues:Ad,getVenuesAndCourts:Dd,getVenuesReport:function({tournamentRecords:t,venueIds:e=[],dates:i=[]}){if(!Array.isArray(i))return{error:_i,dates:i};if(!Array.isArray(e))return{error:_i,venueIds:e};if(!i.every(In))return{error:ke};const n=Dd({tournamentRecords:t});if(n.error)return n;const r=n.venues.filter((({venueId:t})=>!(null!=e&&e.length)||e.includes(t))),a=n.courts.reduce(((t,e)=>(e.dateAvailability.forEach((({date:e})=>{t.includes(e)||t.push(e)})),t)),[]).filter((t=>!i.length||i.includes(t))),o={venueIds:r.map((({venueId:t})=>t))},{matchUps:s}=Fd({tournamentRecords:t,matchUpFilters:o});return{venuesReport:r.map((t=>function(t,e,i){const{venueId:n,courts:r,venueName:a}=e,o={};return t.forEach((t=>{let e=0,a=0,s=0;for(const i of r){const n=i.dateAvailability.find((e=>e.date===t)),r=n&&qs({courtDate:n}),a=null==r?void 0:r.reduce(((t,e)=>{const{startTime:i,endTime:n}=e;return t+(An(n)-An(i))}),0);a&&(s+=1),e+=a}const c=i.filter((({schedule:e})=>e.venueId===n&&jn(t,e.scheduledDate)));c.forEach((({schedule:t})=>{const e=Cn(t.scheduledTime),i=An(Ln(e,t.averageMinutes))-An(e);a+=i}));const u=e?(a/e*100).toFixed(2):"100";o[t]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:e,scheduledMinutes:a,percentUtilization:u}})),{venueId:n,venueName:a,venueReport:o}}(a,t,s)))}},credits:Lh};function zh({convertExtensions:t,removeExtensions:e}){const i=un();return{tournamentId:sn(),tournamentRecords:Vn(i,t,!1,e)}}function Kh(){var t;const e=un(),{extension:i}=Cd({tournamentRecords:e,name:Hr}),n=(null==i||null===(t=i.value)||void 0===t?void 0:t.tournamentIds)||[];return Object.keys(e).forEach((t=>{n.includes(t)||delete e[t]})),ln(e)}function Yh(t,e=!0){return"object"!=typeof t||Array.isArray(t)?{error:Li}:t.tournamentId?dn(e?Vn(t):t):{error:_i}}function Jh(t,e=!0){if("object"!=typeof t)return{error:Li};if(Array.isArray(t)){if(!(t.filter((({tournamentId:t})=>t)).length===t.length))return{error:pt};t=Object.assign({},...t.map((t=>({[t.tournamentId]:t}))))}else if(t.tournamentId)t={[t.tournamentId]:t};else{if(!Object.keys(t).every((e=>t[e].tournamentId===e)))return{error:pt}}return ln(e?Vn(t):t)}const $h=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>zh({convertExtensions:t,removeExtensions:e}),version:()=>"0.51.1",reset:()=>(ln({}),e())};return[xp,Oh,qh,xh].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{if(Xi())return i(e[n],t);try{return i(e[n],t)}catch(r){console.log("%c ERROR","color: orange",{err:r})}}}))})),t.devContext=t=>(Qi(t),e()),t.getDevContext=t=>Xi(t),t.setState=(t,i,n)=>{tn(i,n);return e(Jh(t,i))},t.setTournamentRecord=(t,i,n)=>{tn(i,n);return e(Yh(t,i))},t.removeTournamentRecord=t=>e(hn(t)),t.removeUnlinkedTournamentRecords=()=>e(Kh()),t.executionQueue=(e,i)=>function(e,i){if(!Array.isArray(e))return{error:_i};const n=un(),r=i&&Vn(n,!1,!0),a=[];for(const o of e){if("object"!=typeof o)return{error:_i};const{method:e,params:i}=o;if(!t[e])return{error:Ki};const s=t[e]({...i,tournamentRecords:n});if(null!=s&&s.error)return r&&Jh(r),{...s,rolledBack:!!r};a.push(s)}return Rp(),rn(),{results:a}}(e,i),t;function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function i(e,i){delete t.success,delete t.error;const n=un(),r=(null==i?void 0:i.rollbackOnError)&&Vn(n,!1,!0),a=e({...i,tournamentRecords:n});null!=a&&a.error&&r&&Jh(r);const o=(null==a?void 0:a.success)&&!0!==(null==i?void 0:i.delayNotify);return o&&Rp(),!o&&null!=a&&a.success||rn(),a}}();function Zh(t={}){return t.tournamentId||Object.assign(t,{tournamentId:qn()}),(!t.startDate||En(t.startDate)||fn.test(t.startDate))&&(!t.endDate||En(t.endDate)||fn.test(t.endDate))?(t.extensions&&(t.extensions=t.filter(Vc)),{...t}):{error:ke}}function Xh(t,e){var i;if("object"!=typeof t)return{error:Li};const n=(null===(i=t.unifiedTournamentId)||void 0===i?void 0:i.tournamentId)||t.tournamentId;if(!n)return{error:gt};const r=!1!==e?Vn(t):t;return ln({[n]:r}),pn(n),r}function Qh({convertExtensions:t,removeExtensions:e,tournamentId:i}={}){if("string"!=typeof i)return{};return{tournamentRecord:Vn(cn(i),t,!1,e)}}function tf(t,e,i){if(e){const{drawId:n}=e||e.matchUp&&e.matchUp.drawId;if(n){const{event:r,drawDefinition:a}=Ia({tournamentRecord:t,drawId:n});if(e={...e,event:r,drawDefinition:a},i){const t=Lc({drawDefinition:a}),{matchUps:i}=sd({drawDefinition:a,inContext:!0,includeByeMatchUps:!0,matchUpsMap:t});e.matchUpsMap=t,e.inContextDrawMatchUps=i}}if(e.eventId&&!e.event){const{event:i}=Ia({tournamentRecord:t,eventId:e.eventId});i&&(e={...e,event:i})}}return e}function ef({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:yt};const n=Vn(sd({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}).matchUps,!1,!0),r=X(n.reduce(((t,e)=>t.concat(...e.sides.map((t=>t.participantId)).filter(Boolean))),[])),a=Object.assign({},...r.map((t=>{const e=n.filter((e=>e.sides.map((t=>t.participantId)).filter(Boolean).includes(t)));return{[t]:e}})));return{participantIds:r,participantIdMatchUps:a}}function nf({byeAdvancements:t=!1,tournamentParticipants:e,drawDefinition:i}){if(!i)return{error:yt};const{participantIds:n,participantIdMatchUps:r}=ef({tournamentParticipants:e,drawDefinition:i}),a=n.map((e=>{const i=r[e].filter((t=>[U,S].includes(t.matchUpStatus)||t.winningSide)),n=i.map((i=>{const n=i.sides.find((t=>t.bye)),r=i.sides.find((t=>t.participantId===e)).sideNumber;return(i.winningSide||t&&n&&r)===r?i.finishingPositionRange.winner:i.finishingPositionRange.loser})),a=t=>Math.abs(t[0]-t[1]),o=n.reduce(((t,e)=>t&&a(t)<a(e)?t:e),void 0);return{[e]:{relevantMatchUps:i,finishingPositionRanges:n,finishingPositionRange:o}}}));return Object.assign({},...a)}function rf({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:i}){if(!t)return{error:ft};if(!e||!i)return{error:Ae};const n=(t.participants||[]).find((t=>t.participantId===e));if(!n)return{error:Je};if(![ka,La].includes(n.participantType))return{error:We,participantType:n.participantType};const{removed:r,error:a}=af({groupingParticipant:n,individualParticipantIds:i});return a?{error:a}:(r&&en({topic:gc,payload:{participants:[n]}}),{...dt,removed:r})}function af({groupingParticipant:t,individualParticipantIds:e=[]}){let i=0,n=[];return t?(t.individualParticipantIds||(t.individualParticipantIds=[]),t.individualParticipantIds=t.individualParticipantIds.filter((t=>{const n=null==e?void 0:e.includes(t);return n&&i++,!n})),n.length?{error:"Participants not removed",notRemoved:n}:{groupingParticipant:t,removed:i}):{removed:i}}function of({groupingType:t=ka,participantRole:e=Ih,tournamentRecord:i,individualParticipantIds:n=[]}){if(!i)return{error:ft};const r=i.participants||[];let a=0;return r.filter((i=>(i.participantRole===e||!i.participantRole)&&i.participantType===t)).forEach((t=>{const{removed:e}=af({groupingParticipant:t,individualParticipantIds:n});e&&a++})),a?dt:{error:Ze}}function sf({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:i,removeFromOtherTeams:n}){if(!t)return{error:ft};if(!e||!i)return{error:Ae};const r=t.participants||[],a=r.find((t=>t.participantId===e));if(!a)return{error:Je};if(![ka,La].includes(a.participantType))return{error:We,participantType:a.participantType};const o=i.filter((t=>{const e=r.find((e=>e.participantId===t));return(null==e?void 0:e.participantType)!==Ra}));if(o.length)return{error:He,invalidParticipantIds:o};a.individualParticipantIds||(a.individualParticipantIds=[]);const s=a.individualParticipantIds,c=i.filter((t=>!s.includes(t)));c.length&&(n&&of({tournamentRecord:t,individualParticipantIds:c}),a.individualParticipantIds=a.individualParticipantIds.concat(...c));const{topics:u}=an();if(u.includes(gc)){const t=r.find((({participantId:t})=>t===e));en({topic:gc,payload:{participants:[t]}})}return{...dt,groupingParticipant:Vn(a),added:c.length}}function cf({tournamentRecord:t,participantAttribute:e,personAttribute:i,accessor:n,uuids:r}){if(!t)return{error:ft};const a={},o=(t.participants||[]).filter((({participantType:t,participantRole:e})=>t===Ra&&e===Ih));for(const l of o){const{value:t}=Sp({element:l,accessor:n}),o=t||(i?l.person[i]:l[e]);if(o){if(!Object.keys(a).includes(o)){a[o]={participantName:o,participantId:(null==r?void 0:r.pop())||qn(),participantType:ka,participantRole:Ih,individualParticipantIds:[]};const t={name:Vr,value:i||e};Gc({element:a[o],extension:t})}a[o].individualParticipantIds.push(l.participantId)}}const s=Object.keys(a),c=(t.participants||[]).map((t=>{if(t.participantType!==ka)return;if(t.participantRole!==Ih)return;const{extension:e}=ra({element:t,name:Vr}),i=null==e?void 0:e.value;return s.includes(i)?t.participantId:void 0})).filter(Boolean),u=[];let d=0;return Object.keys(a).forEach((e=>{const i=a[e],{participantId:n}=i;c.includes(n)||(t.participants.push(i),u.push(i),d++)})),d&&en({topic:sc,payload:{participants:u}}),d?{...dt,participantsAdded:d}:{error:"No matching participants found"}}const uf="SCALE",df="RATING",lf="RANKING",pf="SEEDING",hf={SCALE:uf,RATING:df,RANKING:lf,SEEDING:pf};function ff({participant:t,scaleAttributes:e,requireTimeStamp:i}){if(!t)return{error:ze};if("object"!=typeof e)return{error:_i};if(t.timeItems||(t.timeItems=[]),t&&Array.isArray(t.timeItems)){const{accessor:n,scaleType:r,eventType:a,scaleName:o}=e,s=[uf,r,a,o].join("."),c=t.timeItems.filter((t=>(null==t?void 0:t.itemType)===s)).filter((t=>!i||(null==t?void 0:t.itemDate))).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))).pop();if(c){const[t,e,i,r]=c.itemType.split(".");if(t!==uf)return{error:Mi};const a=n&&Sp({element:c.itemValue,accessor:n}),o=n?a.value:c.itemValue;return{scaleItem:{scaleDate:c.itemDate,scaleName:r,scaleType:e,eventType:i,scaleValue:o}}}return{error:xi}}return{error:ze}}function mf({tournamentRecord:t,participantId:e,scaleItem:i}){let n,r;const a=i&&Object.keys(i)||[],o=["scaleType","eventType","scaleName"],s=o.filter((t=>a.includes(t))).length===o.length;if(!s)return{error:Mi};if(e&&s&&Array.isArray(t.participants)&&(r=t.participants.find((t=>t.participantId===e)),r)){const{valueChanged:t,error:e}=vf({participant:r,scaleItem:i});if(e)return{error:e};n=!t;const{topics:a}=an();a.includes(gc)&&en({topic:gc,payload:{participants:[r]}})}return n?{...dt,message:Vi,existingValue:i.scaleValue}:r?{...dt,newValue:i.scaleValue}:{error:Je}}function gf({scaleItem:t}){const e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return!!(i.filter((t=>e.includes(t))).length===i.length)}function vf({participant:t,scaleItem:e}){if(!t)return{error:ze};const i=e&&Object.keys(e),n=["scaleType","eventType","scaleName"];if(!(n.filter((t=>i.includes(t))).length===n.length))return{error:Mi};const r=(new Date).toISOString();t.timeItems||(t.timeItems=[]);const{scaleItem:a}=ff({participant:t,scaleAttributes:e}),o=t=>[void 0,null,""].includes(t),s=!(o(null==a?void 0:a.scaleValue)&&o(e.scaleValue))&&(null==a?void 0:a.scaleValue)!==e.scaleValue;if(s){const{scaleType:i,eventType:n,scaleName:a}=e,o={itemType:[uf,i,n,a].join("."),itemValue:e.scaleValue,itemDate:e.scaleDate,createdAt:r};e.scaleId&&(o.itemSubTypes=[e.scaleId]),t.timeItems.push(o)}return Object.assign({valueChanged:s,newValue:e.scaleValue},dt)}function yf({teamDrawIds:t=[],tournamentRecord:e,participantIds:i}){var n;if(!e)return{error:ft};if(null==i||!i.length)return{error:Xe};const r=(null===(n=e.participants)||void 0===n?void 0:n.length)||0;if(!r)return dt;const{tournamentParticipants:a}=Np({participantFilters:{participantIds:i},withStatistics:!0,tournamentRecord:e}),o=t.length&&(()=>{const{matchUps:n}=ud({tournamentRecord:e,matchUpFilters:{drawIds:t,matchUpTypes:[da]}});return ot(n.map((({sides:t})=>t.map((({participantId:t})=>t)))).flat().filter(Boolean),i)})(),s=a.filter((e=>{var i;return null===(i=e.draws)||void 0===i?void 0:i.filter((({drawId:e})=>!t.length||!t.includes(e))).length}));if(o.length||s.length)return{error:ii};e.participants=e.participants.filter((t=>!i.includes(t.participantId)));const c=r-e.participants.length;return of({tournamentRecord:e,individualParticipantIds:i}),c&&en({topic:lc,payload:{participantIds:i}}),c?dt:{error:je}}const If="MALE",wf="FEMALE",Sf={ANY:"ANY",MALE:If,FEMALE:wf,MIXED:"MIXED",OTHER:"OTHER"};function bf({updateParticipantName:t=!0,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n,pairOverride:r,participant:a}){if(!n)return{error:ft};if(!a)return{error:ze};if(!a.participantId)return sp({tournamentRecord:n,participant:a});const{participant:o}=na({tournamentRecord:n,participantId:a.participantId});if(!o)return sp({tournamentRecord:n,participant:a});const{individualParticipantIds:s,participantName:c,participantRole:u,participantType:d,onlineProfiles:l,person:p}=a,h={};if(l&&(h.onlineProfiles=l),c&&"string"==typeof c&&(h.participantName=c),Array.isArray(s)){const{tournamentParticipants:e}=Np({tournamentRecord:n,participantFilters:{participantTypes:[_a.INDIVIDUAL]}}),i=null==e?void 0:e.map(Mc);if(i){const n=s.filter((t=>"string"==typeof t&&i.includes(t)));([La,la].includes(d)||d===Oa&&(2===n.length||r))&&(h.individualParticipantIds=n),o.participantType===_a.PAIR&&t&&(h.participantName=function({individualParticipants:t,newValues:e}){const i=e.individualParticipantIds;let n=t.filter((({participantId:t})=>i.includes(t))).map((({person:t})=>null==t?void 0:t.standardFamilyName)).filter(Boolean).sort().join("/");1===i.length&&(n+="/Unknown");return n}({individualParticipants:e,newValues:h}))}}return Object.keys(wh).includes(u)&&(h.participantRole=u),Object.keys(_a).includes(d)&&(h.participantType=d),o.participantType===_a.INDIVIDUAL&&p&&function({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){const r={},{sex:a,personId:o,nationalityCode:s,standardFamilyName:c,standardGivenName:u}=n;a&&Object.keys(Sf).includes(a)&&(r.sex=a);let d;o&&"string"==typeof o&&(r.personId=o);s&&"string"==typeof s&&s.length<4&&(r.nationalityCode=s);c&&"string"==typeof c&&c.length>1&&(r.standardFamilyName=c,d=!0);u&&"string"==typeof u&&u.length>1&&(r.standardGivenName=u,d=!0);if(d&&t){const t=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=t}Object.assign(e.person,r)}({updateParticipantName:t,existingParticipant:o,newValues:h,person:p}),Object.assign(o,h),e&&sf({tournamentRecord:n,groupingParticipantId:e,individualParticipantIds:[o.participantId],removeFromOtherTeams:i}),en({topic:gc,payload:{participants:[o]}}),Xi()?{...dt,participant:Vn(o)}:{...dt}}const Uf={addPenalty:Ap,modifyPenalty:Mp,removePenalty:Tp,getTournamentPenalties:Cp,addParticipant:sp,addParticipants:cp,deleteParticipants:yf,createGroupParticipant:function({tournamentRecord:t,participantId:e,individualParticipantIds:i=[],participantRoleResponsibilities:n,participantRole:r="OTHER",groupName:a}){if(!t)return{error:ft};if(!a)return{error:Ae,message:"Missing groupName"};if(!Array.isArray(i))return{error:_i,message:"Invalid individualParticipantIds"};const{tournamentParticipants:o}=Np({tournamentRecord:t,participantFilters:{participantTypes:[Ra]}}),s=o.map((t=>t.participantId));for(const l of i)if(!s.includes(l))return{error:We,participantId:l};const c=Gn({participantId:e||qn(),participantType:La,participantRole:r,participantName:a,individualParticipantIds:i,participantRoleResponsibilities:n}),u=sp({tournamentRecord:t,participant:c});if(u.error)return u;const{topics:d}=an();return d.includes(sc)&&en({topic:sc,payload:{participants:[c]}}),{...dt,participant:Vn(c)}},addIndividualParticipantIds:sf,removeIndividualParticipantIds:rf,modifyIndividualParticipantIds:function({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:i}){if(!t)return{error:ft};if(!e||!i)return{error:Ae};const n=t.participants||[],r=n.find((t=>t.participantId===e));if(!r)return{error:Je};if(![ka,La].includes(r.participantType))return{error:We,participantType:r.participantType};const a=i.filter((t=>{const e=n.find((e=>e.participantId===t));return(null==e?void 0:e.participantType)!==Ra}));if(a.length)return{error:He,invalidParticipantIds:a};const o=r.individualParticipantIds||[],s=i.filter((t=>!o.includes(t))),c=o.filter((t=>!i.includes(t))),u=sf({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:s});if(u.error)return u;const d=rf({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:c});if(d.error)return d;const{topics:l}=an();if(l.includes(gc)){const t=n.find((({participantId:t})=>t===e));en({topic:gc,payload:{participants:[t]}})}return{...u,...d}},removeParticipantIdsFromAllTeams:of,getParticipantMembership:function({tournamentRecord:t,participantId:e}){if(!t)return{error:ft};if(!e)return{error:Ye};const{tournamentParticipants:i}=Np({tournamentRecord:t,participantFilters:{participantTypes:[ka,Oa,La]}});return(i||[]).filter((t=>{var i;return null===(i=t.individualParticipantIds)||void 0===i?void 0:i.includes(e)})).reduce(((t,e)=>{const{participantType:i}=e;return t[i]||(t[i]=[]),t[i].push(e),t}),{})},generateTeamsFromParticipantAttribute:cf,getParticipantIdFinishingPositions:function({tournamentRecord:t,drawDefinition:e,byeAdvancements:i=!1}){return t?nf({tournamentParticipants:t.participants,byeAdvancements:i,drawDefinition:e}):{error:ft}},modifyParticipant:bf,modifyParticipantName:function({tournamentRecord:t,participantId:e,participantName:i}){if(!t)return{error:ft};if(!e)return{error:Ye};if(!i)return{error:Ae,message:"Missing participantName"};const{participant:n}=na({tournamentRecord:t,participantId:e});if(!n)return{error:Je};n.participantName=i;const{topics:r}=an();return r.includes(gc)&&en({topic:gc,payload:{participants:[n]}}),dt},modifyParticipantOtherName:function({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:ft};if(!e)return{error:Ye};const{participant:n}=na({tournamentRecord:t,participantId:e});if(!n)return{error:Je};n.participantOtherName=i;const{topics:r}=an();return r.includes(gc)&&en({topic:gc,payload:{participants:[n]}}),dt},mergeParticipants:function({tournamentRecord:t,participants:e=[],arraysToMerge:i}){if(!t)return{error:ft};t.participants||(t.participants=[]);const n=Object.assign(...e.filter(Qd).map((t=>({[t.participantId]:t})))),r=[];t.participants=t.participants.map((t=>{if(n[t.participantId]){const e=Pp(t,n[t.participantId],i);return r.push(e),e}return t}));const a=t.participants.map(Mc),o=e.filter((({participantId:t})=>!a.includes(t))),{topics:s}=an();return o.length&&(t.participants=t.participants.concat(...o),s.includes(sc)&&en({topic:sc,payload:{participants:o}})),r.length&&s.includes(gc)&&en({topic:gc,payload:{participants:r}}),o.length||r.length?dt:void 0},getPairedParticipant:Ec,setParticipantScaleItem:mf,setParticipantScaleItems:function({tournamentRecord:t,scaleItemsWithParticipantIds:e=[]}){if(!t)return{error:ft};if(!t.participants)return{error:Ke};let i=0;const n={},r=[];for(const s of e){const t=null==s?void 0:s.participantId;Array.isArray(null==s?void 0:s.scaleItems)&&s.scaleItems.forEach((e=>{if(!gf({scaleItem:e}))return{error:Mi};Array.isArray(n[t])||(n[t]=[]),n[t].push(e)}))}t.participants.forEach((t=>{const{participantId:e}=t||{};Array.isArray(n[e])&&n[e].forEach((e=>{vf({participant:t,scaleItem:e}),r.push(t),i++}))}));const a=!i&&ki,{topics:o}=an();return o.includes(gc)&&i&&en({topic:gc,payload:{participants:r}}),{...dt,modificationsApplied:i,message:a}},modifyParticipantsSignInStatus:function({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:ft};if(!Array.isArray(e))return{error:Ae};if(![vp,yp].includes(i))return{error:_i,signInState:i};const n=t.participants||[];if(!n.length)return{error:Ke};const r=[],a=(new Date).toISOString();for(const s of n){const{participantId:n}=s;if(e.includes(n)){const e=ic({tournamentRecord:t,duplicateValues:!1,participantId:n,timeItem:{itemType:pp,itemValue:i,createdAt:a}});if(e.error)return e;r.push(s)}}const{topics:o}=an();return r.length&&o.includes(gc)&&en({topic:gc,payload:{participants:r}}),{...dt}},getParticipantEventDetails:function({tournamentRecord:t,participantId:e}){if(!t)return{error:ft};if(!e)return{error:Ye};const i=[e].concat((t.participants||[]).filter((t=>{var i;return[ka,Oa].includes(t.participantType)&&(null===(i=t.individualParticipantIds)||void 0===i?void 0:i.includes(e))})).map((t=>t.participantId)));return{eventDetails:(t.events||[]).filter((t=>st(((null==t?void 0:t.entries)||[]).map((t=>t.participantId)),i))).map((t=>({eventName:t.eventName,eventId:t.eventId})))}},findParticipant:function({tournamentRecord:t,policyDefinitions:e,convertExtensions:i,participantId:n,inContext:r,personId:a}){return t?"string"!=typeof n&&"string"!=typeof a?{error:Ae}:{participant:Vn(ia({tournamentParticipants:t.participants||[],policyDefinitions:e,participantId:n,personId:a,inContext:r}),i,!0)}:{error:ft}},getTournamentParticipants:Np,getTournamentPersons:function({tournamentRecord:t,participantFilters:e}){if(!t)return{error:ft};let i=t.participants||[];e&&(i=bp({tournamentRecord:t,participantFilters:e,participants:i}));const n={},r=t=>{if(t.person){const{personId:e}=t.person;n[e]?n[e].participantIds.push(t.participantId):n[e]={...t.person,participantIds:[t.participantId]}}};return i.forEach((t=>{t.person&&r(t),t.individualParticipants&&t.individualParticipants.forEach(r)})),{tournamentPersons:Object.values(n)}}};function Nf({tournamentRecord:t,courtId:e}){if(!t)return{error:ft};if(!e)return{error:De};const{court:i,error:n}=ju({tournamentRecord:t,courtId:e});if(n)return{error:n};const r=(({altitude:t,courtId:e,courtName:i,courtDimensions:n,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d})=>({altitude:t,courtId:e,courtName:i,courtDimensions:n,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d}))(i);return{...dt,courtInfo:Vn(r)}}function Pf({tournamentParticipants:t=[],policyDefinitions:e,inContext:i=!0,drawDefinition:n,context:r,event:a}){if(!n)return{error:yt};const o=(({drawId:t,drawName:e,matchUpFormat:i,updatedAt:n})=>({matchUpFormat:i,updatedAt:n,drawName:e,drawId:t}))(n);let s,c;const{structureGroups:u}=function({drawDefinition:t}){let e=(t.links||[]).map((t=>[t.source.structureId,t.target.structureId]));const i=e.length;rt(0,Math.ceil(i/2)).forEach((()=>{e=rt(0,i).map((t=>{const i=e[t],n=e.reduce(((t,e)=>st(i,e)?t.concat(...e):t),[])||[];return X(i.concat(...n))}))}));const n=e[0],r=(t,e)=>ot(t,e).length===t.length,a=e.slice(1).reduce(((t,e)=>t&&r(e,n)),!0),o=[n].filter(Boolean);(t.structures||[]).forEach((t=>{const{structureId:e}=t;o.find((t=>t.includes(e)))||o.push([e])}));const s=a&&1===o.length;return{structureGroups:o,allStructuresLinked:s}}({drawDefinition:n});let d=!1,l=!1;const p=u.map((u=>{const p=u.map((t=>{const{structure:e}=jc({drawDefinition:n,structureId:t}),{seedAssignments:i}=Uu({drawDefinition:n,structure:e});return e.stage===Oo&&1===e.stageSequence&&(s=i),e.stage===Lo&&1===e.stageSequence&&(c=i),e})).sort(Fc).map((u=>{const{structureId:p}=u;let h=[];[Oo,_o,jo].includes(u.stage)&&(h=s),u.stage===Lo&&(h=c);const{matchUps:f,roundMatchUps:m}=Ru({context:{drawId:o.drawId,...r},tournamentParticipants:t,policyDefinitions:e,seedAssignments:h,drawDefinition:n,structure:u,inContext:i,event:a}),{positionAssignments:g}=Eu({structure:u}),v=g.filter(Qd).map((t=>{l=!0;const{drawPosition:e,participantId:i}=t,{extension:n}=ra({element:t,name:$r});return n&&{drawPosition:e,participantId:i,participantResult:n.value}})).filter((t=>null==t?void 0:t.participantResult)),y=(({stage:t,stageSequence:e,structureName:i,structureType:n,matchUpFormat:r,positionAssignments:a})=>({stage:t,stageSequence:e,structureName:i,structureType:n,matchUpFormat:r,positionAssignments:a}))(u);return y.structureActive=f.reduce(((t,e)=>{var i;const n=[U,b,P,C,R,D,E].includes(e.matchUpStatus);return t||n||!!e.winningSide||!(null===(i=e.score)||void 0===i||!i.scoreStringSide1)}),!1),y.structureCompleted=f.reduce(((t,e)=>t&&[S,U,C,R,P,I].includes(e.matchUpStatus)),!0),y.structureActive&&(d=!0),{...y,structureId:p,roundMatchUps:m,seedAssignments:h,participantResults:v}}));return p.forEach((t=>delete t.positionAssignments)),p}));if(p.length>1){const t={error:"drawDefinition contains unlinked structures"};return Xi()&&console.log(t),t}const h=p.flat();return o.drawActive=d,o.participantPlacements=l,o.drawGenerated=null==h?void 0:h.reduce(((t,e)=>t||!(null==e||!e.roundMatchUps)),!1),o.drawCompleted=null==h?void 0:h.reduce(((t,e)=>t&&e.structureCompleted),!0),{...dt,drawInfo:Vn(o),structures:Vn(h)}}function Ef({tournamentRecord:t,venueId:e}){if(!t)return{error:ft};if(!e)return{error:Si};const{venue:i,error:n}=_u({tournamentRecord:t,venueId:e});if(n)return{error:n};const r=(i.courts||[]).map((e=>(({courtInfo:t})=>({...t}))(Nf({tournamentRecord:t,courtId:e.courtId})))),a={...(({venueId:t,venueName:e,venueAbbreviation:i})=>({venueId:t,venueName:e,venueAbbreviation:i}))(i),courtsInfo:r};return{...dt,venueData:Vn(a)}}function Df({tournamentRecord:t,event:e,policyDefinitions:i}){if(!t)return{error:ft};if(!e)return{error:zt};const{eventId:n}=e,{tournamentId:r,endDate:a,participants:o}=t,s=Xu({participants:o}),c=(e.drawDefinitions||[]).map((t=>(({drawInfo:t,structures:e})=>({...t,structures:e}))(Pf({tournamentParticipants:s,policyDefinitions:i,drawDefinition:t,context:{eventId:n,tournamentId:r,endDate:a},event:e})))),{tournamentInfo:u}=Pd({tournamentRecord:t}),d=(t.venues||[]).map((e=>(({venueData:t})=>({...t}))(Ef({tournamentRecord:t,venueId:e.venueId})))),l={eventInfo:(({eventId:t,eventName:e,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:t,eventName:e,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(e),drawsData:c,venuesData:d,tournamentInfo:u},{timeItem:p}=tc({event:e,itemType:"PUBLISH.STATUS"});return l.eventInfo.publish={state:null==p?void 0:p.itemValue,createdAt:null==p?void 0:p.createdAt},{...dt,eventData:Vn(l)}}const Af={getTournamentInfo:Pd,getVenueData:Ef,getCourtInfo:Nf,getAllEventData:function({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:ft};const i=t.events||[],n=(null==t?void 0:t.participants)||[],{tournamentInfo:r}=Pd({tournamentRecord:t}),{venues:a}=Lu({tournamentRecord:t});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:i.map((i=>{const{eventId:r}=i,a=(({eventId:t,eventName:e,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:t,eventName:e,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(i),o=ca({tournamentRecord:t,event:i}).scheduleTiming,s=(i.drawDefinitions||[]).map((a=>{const s=(({drawId:t,drawName:e,matchUpFormat:i,updatedAt:n})=>({drawId:t,drawName:e,matchUpFormat:i,updatedAt:n}))(a),{pendingMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,abandonedMatchUps:l}=cd({event:i,context:{eventId:r},inContext:!0,drawDefinition:a,scheduleTiming:o,policyDefinitions:e,tournamentRecord:t,includeByeMatchUps:!1,requireParticipants:!0,tournamentParticipants:n});return{drawInfo:s,matchUps:{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}}})),{timeItem:c}=tc({event:i,itemType:"PUBLISH.STATUS"});return Object.assign(a,{publish:null==c?void 0:c.itemValue,drawsData:s}),a}))}}},getEventData:Df,getDrawData:Pf,publishEvent:function({tournamentRecord:t,policyDefinitions:e,status:i=Er,structureIds:n=[],drawIdsToRemove:r,drawIdsToAdd:a,drawIds:o,event:s}){var c,u,d;if(!t)return{error:ft};if(!s)return{error:zt};const l="PUBLISH.STATUS",p=(null===(c=s.drawDefinitions)||void 0===c?void 0:c.map((({drawId:t})=>t)))||[];if(o||a||r){if(!o&&(null!=a&&a.length||null!=r&&r.length)){var h,f;const{timeItem:t}=tc({itemType:l,event:s});o=(null==t||null===(h=t.itemValue)||void 0===h||null===(f=h.PUBLIC)||void 0===f?void 0:f.drawIds)||[]}}else o=p;o=(o||[]).filter((t=>!(null!=r&&r.length&&r.includes(t)))),null!=a&&a.length&&(o=X(o.concat(...a.filter((t=>p.includes(t)))))),rc({event:s,timeItem:{itemType:l,itemValue:{[i]:{drawIds:o,structureIds:n}}}});const{eventData:m}=Df({policyDefinitions:e,tournamentRecord:t,event:s}),g=null==m||null===(u=m.eventInfo)||void 0===u||null===(d=u.publish)||void 0===d?void 0:d.state;return m.drawsData=m.drawsData.filter((({drawId:t})=>{var e;return null==g||null===(e=g.PUBLIC)||void 0===e?void 0:e.drawIds.includes(t)})),en({topic:yc,payload:{eventData:m}}),{...dt,eventData:m}},unPublishEvent:function({tournamentRecord:t,event:e}){return t?e?(rc({event:e,timeItem:{itemType:"PUBLISH.STATUS",itemValue:Dr}}),en({topic:"unPublishEvent",payload:{eventId:e.eventId}}),Object.assign({eventId:e.eventId},dt)):{error:zt}:{error:ft}}};const Tf={addNotes:Zd,removeNotes:function({element:t}={}){return"object"!=typeof t?{error:_i}:(t.notes&&delete t.notes,dt)},setTournamentName:function({tournamentRecord:t,tournamentName:e,promotionalName:i,formalName:n}){return t?(e&&(t.tournamentName=e),i&&(t.promotionalName=i),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,dt):{error:ft}},setTournamentNotes:function({tournamentRecord:t,notes:e}){return t?Zd({element:t,notes:e}):{error:ft}},setTournamentEndDate:function({tournamentRecord:t,endDate:e}){return t?gn.test(e)?(t.endDate&&(new Date(e),new Date(t.endDate)),t.startDate&&new Date(e)<new Date(t.startDate)&&(t.startDate=e),t.endDate=e,dt):{error:ke}:{error:ft}},setTournamentStartDate:function({tournamentRecord:t,startDate:e}){return t?gn.test(e)?(t.startDate&&(new Date(e),new Date(t.startDate)),t.endDate&&new Date(e)>new Date(t.endDate)&&(t.endDate=e),t.startDate=e,dt):{error:ke}:{error:ft}},setTournamentCategories:function({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter((t=>t.categoryName&&t.type)),t.tournamentCategories=e,dt):{error:ft}},addEventTimeItem:rc,addTournamentTimeItem:nc,addParticipantTimeItem:ic,addEventExtension:zc,removeEventExtension:Yc,addTournamentExtension:Wc,removeTournamentExtension:Kc,addParticipantExtension:function({tournamentRecord:t,participantId:e,extension:i}={}){if(!e)return{error:Ye};const n=ia({tournamentParticipants:(null==t?void 0:t.participants)||[],participantId:e});return n?Gc({element:n,extension:i}):{error:Je}},removeParticipantExtension:function({tournamentRecord:t,participantId:e,name:i}={}){if(!e)return{error:Ye};const n=ia({tournamentParticipants:(null==t?void 0:t.participants)||[],participantId:e});return n?Hc({element:n,name:i}):{error:Je}},addDrawDefinitionExtension:qc,removeDrawDefinitionExtension:function({drawDefinition:t,name:e}={}){return t?Hc({element:t,name:e}):{error:wt}}};const Cf={assignMatchUpCourt:Vu,assignMatchUpVenue:Fu,addMatchUpScheduleItems:Sh,addMatchUpScheduledDate:bh,addMatchUpScheduledTime:Uh,addMatchUpStartTime:Nh,addMatchUpEndTime:Ph,addMatchUpStopTime:Eh,addMatchUpResumeTime:Dh,addMatchUpOfficial:Ah,getMatchUpFormatTiming:va,modifyMatchUpFormatTiming:Op,getModifiedMatchUpFormatTiming:kp,getEventMatchUpFormatTiming:jp,modifyEventMatchUpFormatTiming:_p,removeEventMatchUpFormatTiming:ph,getMatchUpFormatTimingUpdate:function({tournamentRecord:t}){if(!t)return{error:ft};const e=[],{extension:i}=aa({tournamentRecord:t,name:Kr});i&&e.push({method:"addTournamentExtension",params:{extension:i}});const n=t.events||[];for(const r of n){const{eventId:t}=r,{extension:i}=oa({event:r,name:Kr});i&&e.push({method:"addEventExtension",params:{eventId:t,extension:i}})}return{methods:e}},getMatchUpDailyLimits:sh,setMatchUpDailyLimits:Ch,getMatchUpDailyLimitsUpdate:function({tournamentRecord:t}){if(!t)return{error:ft};const e=[],{extension:i}=aa({tournamentRecord:t,name:zr});i&&e.push({method:"addTournamentExtension",params:{extension:i}});const n=t.events||[];for(const r of n){const{eventId:t}=r,{extension:i}=oa({event:r,name:zr});i&&e.push({method:"addEventExtension",params:{eventId:t,extension:i}})}return{methods:e}},isValidSchedulingProfile:Ud,setSchedulingProfile:function({tournamentRecord:t,schedulingProfile:e}){return t?Array.isArray(e)?Kl({tournamentRecord:t,schedulingProfile:e}):{error:_i}:{error:ft}},getSchedulingProfile:zl,removeMatchUpCourtAssignment:function({drawDefinition:t,matchUpId:e,courtDayDate:i}){return gh({drawDefinition:t,matchUpId:e,courtDayDate:i})},clearScheduledMatchUps:ah,bulkScheduleMatchUps:gd,bulkRescheduleMatchUps:Th};function Mf({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ft};const{appliedPolicies:n}=Xr({tournamentRecord:t}),r=null==n?void 0:n.draws;return((null==r?void 0:r.allowedDrawTypes)||[]).filter((({categoryNames:t,categoryTypes:n})=>!e&&!n||e&&(null==t?void 0:t.includes(e))||i&&(null==n?void 0:n.includes(i))))}function xf({participantCount:t}){if(isNaN(t))return{error:_i};return{drawSize:[0,2,4,8,16,32,64,128,256,512,1024].find((e=>e>=t))||0}}function Rf({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){let o=r.entries||[];if(n){var s;const{flightProfile:t}=el({event:r}),i=null==t||null===(s=t.flights)||void 0===s?void 0:s.find((t=>t.drawId===n));o=i?i.drawEntries:null==e?void 0:e.entries}const c=o.filter((e=>(!(null!=i&&i.length)||!e.entryStatus||i.includes(e.entryStatus))&&(!a||!e.entryStage||e.entryStage===a)&&(!t||du.includes(e.entryStatus))));return{entries:o,stageEntries:c}}function kf({tournamentRecord:t,drawDefinition:e,event:i,requireParticipantCount:n=!0,drawSizeProgression:r=!1,policyDefinitions:a,participantCount:o,drawSize:s}={}){if(!a){const n=Xd({tournamentRecord:t,drawDefinition:e,event:i});if(n.error)return n;a=n.policyDefinitions}if(o&&isNaN(o))return{error:_i};if(n&&isNaN(o))return{error:Qe};if(!s){if(!o)return{error:Mt};({drawSize:s}=xf({participantCount:o}))}if((n&&o||s)>s)return{error:oi};const c=a.seeding;if(!c)return{error:Se};const u=c.seedsCountThresholds;if(!u)return{error:Ot};void 0!==c.drawSizeProgression&&(r=c.drawSizeProgression);return{seedsCount:u.filter((t=>r?t.drawSize<=s:s===t.drawSize)).reduce(((t,e)=>o>=e.minimumParticipantCount?e.seedsCount:t),0)}}function Of({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:zt};const{entries:o,stageEntries:s}=Rf({drawDefinition:e,drawId:n,stage:a,event:r}),c=s.length,{drawSize:u}=xf({participantCount:c}),{seedsCount:d,error:l}=kf({drawSize:i||u,policyDefinitions:t,participantCount:c});return l?{error:l}:{entries:o,seedsCount:d,stageEntries:s}}const Lf={attachPolicies:Rh,attachEventPolicies:kh,removeEventPolicy:function({event:t,policyType:e}){if(!e)return{error:Ae};if(!t)return{error:zt};let i;if(t.extensions){const{appliedPolicies:n}=Qr({event:t});if(n&&n[e])if(delete n[e],i=!0,Object.keys(n).length){zc({event:t,extension:{name:Lr,value:n}})}else Yc({event:t,name:Lr})}return i?dt:{error:Ne}},findPolicy:ea,getSeedsCount:kf,getEntriesAndSeedsCount:Of,getAllowedDrawTypes:Mf,getAllowedMatchUpFormats:function({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:ft};const{appliedPolicies:n}=Xr({tournamentRecord:t}),r=null==n?void 0:n.scoring;return((null==r?void 0:r.matchUpFormats)||[]).filter((({categoryNames:t,categoryTypes:n})=>!e&&!n||e&&(null==t?void 0:t.includes(e))||i&&(null==n?void 0:n.includes(i))))},getEventAppliedPolicies:Qr};function _f({tournamentRecord:t,event:e}){if(!t)return{error:ft};t.events||(t.events=[]);const{startDate:i,endDate:n}=t,r=Object.assign({},{startDate:i,endDate:n,eventType:Ea},e);r.eventId||(r.eventId=qn());return t.events.reduce(((t,e)=>t||e.eventId===r.eventId),void 0)?{error:Yt}:(t.events.push(r),{...dt,event:r})}const Ff="deleteEvents",jf="deleteDrawDefinitions",Bf={DELETE_EVENTS:Ff,DELETE_DRAW_DEFINITIONS:jf};function Vf({entries:t=[]}={}){const e=t.reduce(((t,e)=>{const{entryStage:i,entryStatus:n}=e,r=`_${i||Oo}${n||""}`;return t[r]||(t[r]=[]),t[r].push(e),t}),{}),i=t=>isNaN(t)?9999:t;return Object.keys(e).map((t=>e[t].sort(((t,e)=>i(t.entryPosition)-i(e.entryPosition))).map(((t,e)=>{const i=e;return Object.assign(t,{entryPosition:i})})))).flat()}function Gf({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var r;if(!e)return{error:yt};const a=null===(r=e.entries)||void 0===r?void 0:r.find((e=>!(e.participantId!==t||i&&i!==e.entryStatus||n&&n!==e.entryStage)));return t&&a}function Hf({entryStatus:t=eu,entryStage:e=Oo,entryPosition:i,drawDefinition:n,participantId:r,participant:a}){if(!n)return{error:yt};if(!e)return{error:Xt};if(!fu({stage:e,drawDefinition:n}))return{error:Qt};const o=bu({stage:e,drawDefinition:n,entryStatus:t});if(!o.success)return{error:o.error};if(!(r=r||a&&a.participantId))return{error:Ye};const s=t===nu&&Gf({participantId:r,drawDefinition:n,entryStatus:t}),c=e===Fo&&Gf({participantId:r,drawDefinition:n,entryStage:e});if(t!==nu&&e!==Fo&&Gf({drawDefinition:n,participantId:r})||s||c)return{error:ai};const u=Gn({...a,participantId:r,entryStage:e,entryStatus:t,entryPosition:i});return n.entries.push(u),Pc({drawDefinition:n}),{...dt}}function Wf({entryStatus:t=eu,autoEntryPositions:e=!0,drawDefinition:i,participantIds:n,stage:r=Oo}){if(!r)return{error:Xt};if(!i)return{error:yt};if(!Array.isArray(n))return{error:He};if(!fu({stage:r,drawDefinition:i}))return{error:Qt};const a=bu({stage:r,drawDefinition:i,entryStatus:t});if(!a.success)return{error:a.error};if((a.positionsAvailable||0)<n.length)return{error:si};const o=n.reduce(((e,n)=>{const a=t===nu&&Gf({participantId:n,drawDefinition:i,entryStatus:t}),o=r===Fo&&Gf({participantId:n,drawDefinition:i,entryStage:r});return t!==nu&&r!==Fo&&Gf({drawDefinition:i,participantId:n})||a||o?e.concat({participantId:n,error:ai}):e}),[]);return o.length?{error:$t,invalidParticipantIds:o}:(n.forEach((e=>{const n=Object.assign({participantId:e},{entryStage:r,entryStatus:t});i.entries.push(n)})),e&&(i.entries=Vf({entries:i.entries})),Pc({drawDefinition:i}),{...dt})}function qf({autoEntryPositions:t=!0,drawDefinition:e,participantIds:i,entryStatus:n,entryStage:r,drawId:a,event:o}){if(!a)return{error:xt};if(!o)return{error:Kt};const s=(o.entries||[]).map(Mc);if(i.filter((t=>!s.includes(t))).length)return{error:Jt};if(e){const a=Wf({drawDefinition:e,participantIds:i,entryStatus:n,stage:r,autoEntryPositions:t});if(a.error)return a}const{flightProfile:c}=el({event:o}),u=null==c?void 0:c.flights.find((t=>t.drawId===a));return null!=u&&u.drawEntries&&(i.forEach((t=>{const e=n===nu&&zf({participantId:t,entryStatus:n,flight:u}),i=r===Fo&&zf({participantId:t,entryStage:r,flight:u});n!==nu&&r!==Fo&&zf({flight:u,participantId:t})||e||i||u.drawEntries.push({participantId:t,entryStatus:n,entryStage:r})})),t&&(u.drawEntries=Vf({entries:u.drawEntries}))),dt}function zf({participantId:t,entryStatus:e,entryStage:i,flight:n}){var r;const a=null===(r=n.drawEntries)||void 0===r?void 0:r.find((n=>!(n.participantId!==t||e&&e!==n.entryStatus||i&&i!==n.entryStage)));return t&&a}function Kf(t){return[ou,su].includes(t)}function Yf({autoEntryPositions:t=!0,tournamentRecord:e,participantIds:i,event:n}){var r,a,o,s;if(null==n||!n.eventId)return{error:zt};if(!Array.isArray(i))return{error:Xe};if(null===(a=i=null===(r=i)||void 0===r?void 0:r.filter(Boolean))||void 0===a||!a.length)return{error:Xe};const{eventId:c}=n,{tournamentParticipants:u}=Np({participantFilters:{participantIds:i},withStatistics:!0,tournamentRecord:e});if(null==u?void 0:u.every((t=>{var e;const i=t.events.find((t=>t.eventId===c));return null==i||null===(e=i.drawIds)||void 0===e?void 0:e.length})))return{error:ri};n.entries=(n.entries||[]).filter((t=>!i.includes(null==t?void 0:t.participantId))),t&&(n.entries=Vf({entries:n.entries}));const{flightProfile:d}=el({event:n});return null==d||null===(o=d.flights)||void 0===o||o.forEach((t=>{t.drawEntries=(t.drawEntries||[]).filter((t=>!i.includes(t.participantId)))})),null===(s=n.drawDefinitions)||void 0===s||s.forEach((t=>{t.entries=(t.entries||[]).filter((t=>!i.includes(t.participantId)))})),dt}function Jf(t){var e;const{tournamentRecord:i,drawDefinition:n,drawId:r,event:a,participantIds:o=[],entryStatus:s=eu,entryStage:c=Oo,autoEntryPositions:u=!0}=t;if(!a)return{error:zt};if(!o||!o.length)return{error:Xe};if(!a||!a.eventId)return{error:Kt};const d=(null==i||null===(e=i.participants)||void 0===e?void 0:e.filter((t=>a.eventType===ua&&t.participantType===Ra||(a.eventType===da&&t.participantType===Oa||(!(a.eventType!==da||t.participantType!==Ra||!Kf(s))||a.eventType===ka&&t.participantType===ka)))).map((t=>t.participantId)))||[],l=o.filter((t=>!d.length||d.includes(t)));a.entries||(a.entries=[]);const p=a.entries.map((t=>t.participantId||t.participant&&t.participant.participantId));let h;if(l.forEach((t=>{p.includes(t)||a.entries.push({participantId:t,entryStatus:s,entryStage:c})})),r){const t=qf({participantIds:l,autoEntryPositions:u,drawDefinition:n,entryStatus:s,entryStage:c,drawId:r,event:a});t.error&&(h=t.error)}if(a.eventType===da){const t=(a.entries||[]).map((t=>t.participantId)),e=(a.entries||[]).filter((t=>Kf(t.entryStatus))).map((t=>t.participantId)),n=((null==i?void 0:i.participants)||[]).filter((e=>t.includes(e.participantId)&&e.participantType===Oa)).map((t=>t.individualParticipantIds)).flat(1/0),r=e.filter((t=>n.includes(t)));r.length&&Yf({tournamentRecord:i,participantIds:r,autoEntryPositions:!1,event:a})}const f=!(l.length===o.length);return u&&(a.entries=Vf({entries:a.entries||[]})),f?{error:He}:Object.assign({message:h},dt)}function $f({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,entryStatus:r,drawId:a,event:o}){return function({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,entryStatus:r,drawId:a,stage:o,event:s}){if(!e)return{error:ft};if(!n)return{error:Ye};if(!s)return{error:zt};if(![Da,Aa].includes(s.eventType))return{error:qt};const c=e.participants||[],u=c.find((t=>t.participantId===n));if(!u)return{error:Je};if(![Oa,Aa].includes(u.participantType)||u.participantType===Aa&&s.eventType!==Aa||u.participantType===Oa&&s.eventType!==Da)return{error:We};const d=su,l=(s.entries||[]).find((t=>t.participantId===n));if(!l)return{error:ui};const{stageEntries:p}=Rf({entryStatusees:[eu,Zc,tu],selected:!1,drawDefinition:i,drawId:a,event:s,stage:o}),h=p.map(Mc),f=c.filter((({participantId:t})=>h.includes(t))).map((({individualParticipantIds:t})=>t)).flat().filter(Boolean),m=u.individualParticipantIds.filter((t=>1===at(t,f).length));let g,v=Yf({event:s,drawId:a,drawDefinition:i,tournamentRecord:e,participantIds:[n]});if(v.error)return v;if(m.length&&(v=Jf({event:s,drawId:a,drawDefinition:i,tournamentRecord:e,entryStage:l.entryStage,entryStatus:r||d,participantIds:m}),v.error))return v;t&&yf({tournamentRecord:e,participantIds:[n]}).success&&(g=!0);return{...dt,participantRemoved:g}}({removeGroupParticipant:t,individualEntryStatus:su,tournamentRecord:e,drawDefinition:i,participantId:n,entryStatus:r,drawId:a,event:o})}function Zf({element:t,participantId:e,stage:i,stageSequence:n}){const r=(t.entries||[]).filter((t=>t.entryStatus===Zc)),a=(t.entries||[]).find((t=>t.participantId===e))||r.reduce(((t,e)=>{const{entryPosition:i}=e;return isNaN(i)?t:!t||i<t.entryPosition?e:t}),void 0);if(!a)return{error:ui};if(a.entryStatus!==Zc)return{error:ci};if(a.stage&&a.entryStage!==i)return{error:"Participant not entered in stage"};if(n&&a.stageSequence!==n)return{error:"Participant not found in stageSequence"};a.entryStatus=eu;const o=null==a?void 0:a.entryPosition;isNaN(o)||t.entries.forEach((t=>{t.entryStatus===Zc&&t.entryPosition>o&&(t.entryPosition=t.entryPosition-1)}));let s=Math.max(...t.entries.filter((t=>t.entryStatus===eu&&!isNaN(t.entryPosition))).map((({entryPosition:t})=>parseInt(t||0))),0);return a.entryPosition=s||0,dt}function Xf({event:t,participants:e,ignoreGender:i}){if(!e)return{error:Ke};if(!t)return{error:zt};const{eventType:n,gender:r}=t,a=n===ua?Ra:n===da?Oa:la,o=Object.assign({},...(t.entries||[]).map((t=>({[t.participantId]:t.entryStatus})))),s=Object.keys(o),c=e.filter((t=>s.includes(t.participantId))).filter((t=>{const e=o[t.participantId],s=n===da&&t.participantType===Ra&&(Kf(e)||e===au),c=t.participantType!==a&&!s,u=!i&&n===Ra&&[If,wf].includes(r)&&t.sex!==r;return c||u}));if(c.length){const t=c.map((t=>t.participantId));return{error:$t,invalidParticipantIds:t}}return dt}function Qf({drawDefinition:t,participantId:e,structureId:i,seedNumber:n,seedValue:r}){const{structure:a}=jc({drawDefinition:t,structureId:i}),{positionAssignments:o}=Du({structure:a}),{seedAssignments:s}=Uu({drawDefinition:t,structure:a}),c=s.map((t=>t.seedNumber)),u=Gf({drawDefinition:t,participantId:e});if(e&&!u)return{error:Ge,participantId:e,method:"assignSeed"};const d=o.find((t=>t.participantId===e)),l=null==d?void 0:d.drawPosition;if(l){if(!Ml({seedNumber:n,drawDefinition:t,structureId:i,drawPosition:l}))return{error:bt}}if(c.includes(n)){let a;if(s.forEach((t=>{t.participantId===e&&t.seedNumber!==n&&(t.participantId=void 0),t.seedNumber===n&&(t.participantId=e,t.seedValue=r||n,a=!0)})),a)return Pc({drawDefinition:t,structureIds:[i]}),{...dt}}return{error:_t}}function tm({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:we};if(!n)return{error:ze};const r=[];t.forEach((t=>{const o=n,{directive:s,groupings:c,key:u,significantCharacters:d}=t||{};if(u){a({value:o,keys:u.split("."),significantCharacters:d})}else if(s){const a=null==t?void 0:t.includeIds,o=(e&&e[s]||[]).filter((t=>!a||a.includes(t)));null!=o&&o.length&&null!=i&&i.length&&o.forEach((t=>{var e;const a=i.find((e=>e.participantId===t));if(null!=a&&null!==(e=a.individualParticipantIds)&&void 0!==e&&e.includes(n.participantId)){const t=null==a?void 0:a.participantId;r.push(t)}}))}else c&&Object.keys(c).forEach((t=>{c[t].includes(n.participantId)&&r.push(t)}))}));return{values:X(r)};function a({value:t,keys:e=[],significantCharacters:i}){for(const[r,o]of e.entries())if(t&&t[o])if(Array.isArray(t[o])){const n=t[o],s=e.slice(r);n.forEach((t=>a({value:t,keys:s,significantCharacters:i})))}else n({value:t=t[o],index:r});function n({value:t,index:n}){if(t&&n===e.length-1&&["string","number"].includes(typeof t)){const e=i?t.slice(0,i):t;r.push(e)}}}}function em({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){const r=Object.assign({},...e.map((t=>({[t.participantId]:t}))));return t.map((t=>{const a=r[t.participantId],{values:o}=tm({participants:e,policyAttributes:i,idCollections:n,participant:a});return{...t,values:o}}))}function im({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter((t=>null==t?void 0:t.participantId)).map((e=>{const{drawPosition:n,participantId:r}=e,a=t&&t[r]||[],o=!!i.some((t=>a.includes(t)));return{[n]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function nm(t){const{unfilledPositions:e,chunkedDrawPositions:i}=t,n=im(t);return i.map((t=>{const i=e.filter((e=>t.includes(e))),r=function(t){return t.filter((t=>!e(t)));function e(e){const i=rm(e);return!t.includes(i)}}(i),a=i.filter((t=>!r.includes(t))).filter((t=>{var e;const i=rm(t);return!(null!==(e=n[i])&&void 0!==e&&e.includesGroupsToAvoid)}));return{unassigned:i,unpaired:r,pairedNoConflict:a}}))}function rm(t){return t%2?t+1:t-1}function am({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){const o=n.map((n=>a?function(t){const{unfilledPositions:e,chunkedDrawPositions:i}=t,n=im(t);return i.map((t=>{const i=e.filter((e=>t.includes(e))),r=i.length===t.length?i:[],a=t.filter((t=>{var e;return null===(e=n[t])||void 0===e?void 0:e.includesGroupsToAvoid})).length;return{unassigned:i,unpaired:r,pairedNoConflict:a?[]:i,conflictsCount:a}}))}({groupsToAvoid:t,chunkedDrawPositions:n,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):nm({groupsToAvoid:t,chunkedDrawPositions:n,participantIdGroups:e,positionAssignments:i,unfilledPositions:r})));if(a){return{unassigned:o.map((t=>t.map((t=>t.unassigned)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)).sort(((t,e)=>(e.length||0)-(t.length||0))),unpaired:o.map((t=>t.map((t=>t.unpaired)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),pairedNoConflict:o.map((t=>t.map((t=>t.pairedNoConflict)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)).sort(((t,e)=>(e.length||0)-(t.length||0)))}}return{unassigned:o.map((t=>t.map((t=>t.unassigned)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),unpaired:o.map((t=>t.map((t=>t.unpaired)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),pairedNoConflict:o.map((t=>t.map((t=>t.pairedNoConflict)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length))}}function om({participantIds:t,positionAssignments:e}){const i=e.map((t=>t.participantId));return t.filter((t=>!i.includes(t)))}function sm({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){const c=r.reduce(((t,e)=>e.length>t?e.length:t),0),u=!!(c>2),d=om({participantIds:e,positionAssignments:t}),l=function({drawPositionGroups:t,positionAssignments:e}){const i=Object.assign({},...e.map((t=>({[t.drawPosition]:t}))));return t.map((t=>t.filter(Boolean).map((t=>i[t])).filter((t=>!t.participantId&&!t.bye)).map((t=>t.drawPosition)))).flat().filter(Boolean)}({drawPositionGroups:r,positionAssignments:t}),{participantId:p,groupKey:h}=function({groupKey:t,allGroups:e,largestFirst:i=!0,targetParticipantIds:n,useSpecifiedGroupKey:r=!1}){var a;const o=Object.assign({},...Object.keys(e).map((t=>[t,e[t].filter((t=>n.includes(t)))])).filter((t=>t[1].length)).map((([t,e])=>({[t]:e})))),s=Object.keys(o).reduce(((t,e)=>o[e].length>t?o[e].length:t),0),c=Object.keys(o).filter((t=>o[t].length===s)),u=nt(i?c:Object.keys(o));return{participantId:(t=r&&null!==(a=o[t])&&void 0!==a&&a.length?t:u)&&o[t]?nt(o[t]):nt(n),groupKey:t}}({groupKey:s,allGroups:o,targetParticipantIds:d,useSpecifiedGroupKey:u}),f=am({positionAssignments:t,isRoundRobin:u,selectedParticipantGroups:function({allGroups:t,participantId:e}){return Object.keys(t).filter((i=>t[i].includes(e)))}({allGroups:o,participantId:p}),participantIdGroups:i,drawPositionChunks:n,unfilledPositions:l,largestGroupSize:c,allGroups:o}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(null==v?void 0:v.length)&&v[0],I=(null==g?void 0:g.length)&&g[0],w=a&&y?y:I,S=a?I:y,b=(null==w?void 0:w.length)&&w||(null==S?void 0:S.length)&&S;let U;if(null!=b&&b.length){const t=it(b);U=it(t)}else{const t=it(m[0]);U=it(t)}return{newGroupKey:h,selectedParticipantId:p,targetDrawPosition:U}}function cm({drawPositions:t}){const e=[].concat(...t.map((e=>t.filter((t=>t!==e)).map((t=>[e,t]))))),i=X(e.map(um)).map((t=>t.split("|").map((t=>+t))));return{groupMatchUps:e,uniqueMatchUpGroupings:i}}function um(t){return t.sort(Wn).join("|")}function dm({isRoundRobin:t,groupedParticipants:e}){const i=[];return t?e.forEach((t=>{const e=t.map((t=>t.drawPosition)),{uniqueMatchUpGroupings:n}=cm({drawPositions:e}),r=Object.assign({},...t.map((t=>({[t.drawPosition]:t}))));n.forEach((e=>{st(r[e[0]].values||[],r[e[1]].values||[])&&(i.push(e),t.conflict=!0)}))})):e.forEach((t=>{st(t[0].values||[],t[1].values||[])&&(i.push(t),t.conflict=!0)})),i}function lm({isRoundRobin:t,avoidanceConflicts:e,drawPositionGroups:i,positionedParticipants:n,potentialDrawPositions:r}){return e.map((e=>{const a=e.map((t=>t.drawPosition));return e.filter((t=>r.includes(t.drawPosition))).map((e=>{const o=r.filter((t=>!a.includes(t))).filter((r=>{const a=i.find((t=>t.includes(r))).find((t=>t!==r)),o=n.find((t=>t.drawPosition===a)),s=dm({isRoundRobin:t,groupedParticipants:[[e,o]]}),c=n.find((t=>t.drawPosition===r)),u=dm({isRoundRobin:t,groupedParticipants:[[c,o]]});return!s.length&&!u.length}));if(o.length)return{drawPosition:e.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function pm(t){const{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,drawPositionGroups:r,policyAttributes:a,idCollections:o,allGroups:s}=t,c=[];let u;const d=Math.min(...r.map((t=>t.length))),l=d>2,p=Vn(e,!1,!0),h=e.filter((t=>!t.participantId)).map((t=>t.drawPosition));rt(0,n).forEach((()=>{const{newGroupKey:e,selectedParticipantId:i,targetDrawPosition:n}=sm({...t,groupKey:u,allGroups:s,candidatePositionAssignments:p});u=e,p.forEach((t=>{t.drawPosition===n&&(t.participantId=i)}))}));let f=em({candidatePositionAssignments:p,participantsWithGroupings:i,policyAttributes:a,idCollections:o}),m=ct(f,d),g=dm({isRoundRobin:l,groupedParticipants:m}),v=0;for(;v<20&&g.length;){const t=lm({isRoundRobin:l,avoidanceConflicts:g,drawPositionGroups:r,positionedParticipants:f,potentialDrawPositions:h});t.length?(hm({candidatePositionAssignments:p,swapOptions:t}),f=em({candidatePositionAssignments:p,participantsWithGroupings:i,policyAttributes:a,idCollections:o}),m=ct(f,d),g=dm({isRoundRobin:l,groupedParticipants:m}),v++):v=20}return p.forEach((t=>{t.bye&&t.participantId&&c.push({error:"Invalid Assignment",assignment:t})})),{positionAssignments:p,conflicts:g.length,groupedParticipants:m,errors:c}}function hm({candidatePositionAssignments:t,swapOptions:e}){const i=it(e);if(!i)return{error:"No swap options"};const n=i.drawPosition,r=it(i.possibleDrawPositions),a=t.find((t=>t.drawPosition===n)).participantId,o=t.find((t=>t.drawPosition===r)).participantId;return t.forEach((t=>{t.drawPosition===n&&(t.participantId=o),t.drawPosition===r&&(t.participantId=a)})),dt}function fm({unseededParticipantIds:t,inContextDrawMatchUps:e,drawDefinition:i,participants:n,matchUpsMap:r,structureId:a,avoidance:o,entries:s,event:c}){if(!o)return{error:Ie};const{policyAttributes:u,roundsToSeparate:d,candidatesCount:l=1}=o,{structure:p}=jc({drawDefinition:i,structureId:a}),{matchUps:h}=Ru({matchUpsMap:r,structure:p,event:c}),{positionAssignments:f}=Du({structure:p}),m=Xu({participants:n}),g=f.filter((t=>!t.participantId)),v=f.map((t=>t.drawPosition)),y=p.structureType===qo,I=y?{structure:p,matchUps:h,allDrawPositions:v,roundsToSeparate:d}:{matchUps:h,allDrawPositions:v,roundsToSeparate:d},{drawPositionGroups:w,drawPositionChunks:S}=y?function(t){const{structure:{structures:e}}=t,i=e.map((t=>t.positionAssignments.map((t=>t.drawPosition))));return{drawPositionGroups:i,drawPositionChunks:[i]}}(I):function({matchUps:t,allDrawPositions:e,roundsToSeparate:i}){const n=t.filter((t=>1===t.roundNumber)).map((t=>t.drawPositions)),r=n.flat().sort(Wn),a=Math.max(...r),o=e.filter((t=>t>a)),s=rt(2,r.length).filter((t=>t===q(t))),c=s.slice(0,i||s.length).reverse().map((t=>ct(r,t)));o.length&&console.log({fedDrawPositions:o});return{drawPositionGroups:n,drawPositionChunks:c}}(I),b={};b.groupParticipants=n.filter((t=>t.participantType===La)).map((t=>t.participantId)),b.teamParticipants=n.filter((t=>t.participantType===ka)).map((t=>t.participantId)),b.pairParticipants=n.filter((t=>t.participantType===Oa)).map((t=>t.participantId));const U=function({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:we};if(!Array.isArray(n))return{error:Ke};const r={};return t.forEach((t=>{const a=n.find((e=>e.participantId===t)),{values:o}=tm({policyAttributes:e,idCollections:i,participants:n,participant:a});o&&o.forEach((e=>{r[e]||(r[e]=[]),r[e].includes(t)||r[e].push(t)}))})),r}({targetParticipantIds:t,policyAttributes:u,idCollections:b,participants:n}),N=Object.assign({},...t.map((t=>{const e=Object.keys(U).filter((e=>U[e].includes(t)));return{[t]:e}}))),P=om({participantIds:t,positionAssignments:f});if(P.length>g.length)return{error:"More participantIds than unpaired positions"};let E;const D=[],A=P.length,T=rt(0,l).map((()=>pm({initialPositionAssignments:f,participantsWithGroupings:m,unseededParticipantIds:t,opponentsToPlaceCount:A,drawPositionChunks:S,drawPositionGroups:w,participantIdGroups:N,idCollections:b,allGroups:U,policyAttributes:u,pairedPriority:!1})));if(E=T.reduce(((t,e)=>!t||(e.conflicts||0)<(t.conflicts||0)?e:t),void 0),!E||E.conflicts){const e=rt(0,l).map((()=>pm({initialPositionAssignments:f,participantsWithGroupings:m,unseededParticipantIds:t,opponentsToPlaceCount:A,drawPositionChunks:S,drawPositionGroups:w,participantIdGroups:N,idCollections:b,allGroups:U,entries:s,policyAttributes:u,pairedPriority:!0})));E=T.concat(...e).filter((t=>{var e;return!(null!==(e=t.errors)&&void 0!==e&&e.length)})).reduce(((t,e)=>!t||(e.conflicts||0)<(t.conflicts||0)?e:t),void 0)}if(!E)return{error:"Could not produce candidate"};const C=(p.positionAssignments||[]).filter((t=>t.participantId)).map((t=>t.participantId));return E.positionAssignments.filter((t=>!C.includes(t.participantId))).forEach((t=>{if(t.participantId&&!t.bye){const n=Rl({automaticPlacement:!0,drawDefinition:i,structureId:a,matchUpsMap:r,inContextDrawMatchUps:e,...t});null!=n&&n.success||D.push(n)}})),D.length?{error:D,conflicts:E.conflicts}:Object.assign({positionAssignments:E.positionAssignments,conflicts:E.conflicts},dt)}function mm({drawDefinition:t,candidatesCount:e,participants:i,structureId:n,structure:r,matchUpsMap:a,inContextDrawMatchUps:o}){r||({structure:r}=jc({drawDefinition:t,structureId:n})),n||({structureId:n}=r);const{positionAssignments:s}=Du({structure:r}),{seedAssignments:c}=Uu({drawDefinition:t,structure:r}),u=c.map((t=>t.participantId)).filter(Boolean),{stage:d,stageSequence:l}=r,p=Iu({drawDefinition:t,stageSequence:l,entryStatuses:[eu,tu],structureId:n,stage:d}),h=p.filter((t=>!u.includes(t.participantId))).map((t=>t.participantId)),f=s.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));if(h.length>f.length)return{error:"Insufficient drawPositions to accommodate entries"};const{appliedPolicies:m}=kc({drawDefinition:t});let{avoidance:g}=m||{};if(r.stage===jo){const t=p.reduce(((t,e)=>(t[e.groupingValue]||(t[e.groupingValue]=[]),t[e.groupingValue].push(e.participantId),t)),{});Object.keys(t).length&&(g||(g={policyName:"Playoff Avoidance"}),g.policyAttributes||(g.policyAttributes=[]),g.policyAttributes.push({groupings:t}))}if(g&&i){return fm({unseededParticipantIds:h,candidatesCount:e,drawDefinition:t,participants:i,structureId:n,avoidance:g,entries:p,matchUpsMap:a,inContextDrawMatchUps:o})}return function({unseededParticipantIds:t,unfilledDrawPositions:e,drawDefinition:i,structureId:n,matchUpsMap:r,inContextDrawMatchUps:a}){const o=Q(e);for(const s of t){const t=Rl({structureId:n,drawPosition:o.pop(),participantId:s,drawDefinition:i,automaticPlacement:!0,matchUpsMap:r,inContextDrawMatchUps:a});if(t&&t.error)return t}return dt}({unseededParticipantIds:h,unfilledDrawPositions:f,drawDefinition:t,structureId:n,matchUpsMap:a,inContextDrawMatchUps:o})}function gm({structure:t,drawDefinition:e,appliedPolicies:i,relevantMatchUps:n}){const{validSeedBlocks:r,isFeedIn:a,isContainer:o}=Al({appliedPolicies:i,drawDefinition:e,structure:t}),s=function({drawDefinition:t,structure:e}){const{positionAssignments:i}=Du({structure:e}),{seedAssignments:n}=Uu({drawDefinition:t,structure:e}),r=Object.assign({},...n.filter((t=>t.participantId)).map((t=>({[t.participantId]:t}))));return i.map((t=>r[t.participantId]?{...t,seedNumber:r[t.participantId].seedNumber,seedValue:r[t.participantId].seedValue}:"")).filter(Boolean)}({drawDefinition:e,structure:t}),c=X([].concat(...n.map((t=>t.drawPositions)))),u=s.filter((t=>c.includes(t.drawPosition))),d=[].concat(...r.map((t=>Q(t.drawPositions)))).filter((t=>c.includes(t))),l=(t,e)=>t.seedValue-e.seedValue;return{strictSeedOrderByePositions:vm({orderedSeedDrawPositions:r.reduce(((t,e)=>{const i=u.filter((t=>{var i;return null===(i=e.drawPositions)||void 0===i?void 0:i.includes(t.drawPosition)})).sort(l);return t.concat(...i)}),[]).map((t=>t.drawPosition)),relevantMatchUps:n}).slice(0,s.length),blockSeedOrderByePositions:vm({orderedSeedDrawPositions:d,relevantMatchUps:n}).slice(0,s.length),isFeedIn:a,isContainer:o}}function vm({orderedSeedDrawPositions:t,relevantMatchUps:e}){const i=e.map((t=>t.drawPositions)).map((t=>t.sort(((t,e)=>t-e)))).filter((t=>t[0]+1===t[1]));return t.map((t=>i.find((e=>null==e?void 0:e.includes(t))))).filter(Boolean).map((e=>null==e?void 0:e.reduce(((e,i)=>t.includes(i)?e:i),void 0))).filter(Boolean)}function ym({blockOrdered:t=!1,drawDefinition:e,matchUpsMap:i,structureId:n,structure:r,seedsOnly:a,event:o}){r||({structure:r}=jc({drawDefinition:e,structureId:n})),n||({structureId:n}=r);const{byesCount:s,placedByes:c,relevantMatchUps:u}=function({drawDefinition:t,event:e,matchUpsMap:i,structure:n}){var r;const{matchUps:a,roundMatchUps:o}=Ru({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:n,event:e}),s=o&&o[1]||[],c=(null==n?void 0:n.structureType)===qo,u=c?a:s,d=c?(null==n||null===(r=n.structures)||void 0===r?void 0:r.length)||0:a.length,{structureId:l,stage:p,stageSequence:h}=n,f=Iu({drawDefinition:t,stageSequence:h,entryStatuses:[eu,tu],structureId:l,stage:p}),m=vu({drawDefinition:t,stage:p}),g=f.length+m,{positionAssignments:v,unassignedPositions:y}=Du({structure:n}),I=y.map((t=>t.drawPosition)),w=v.filter((t=>t.bye)).length,S=v.filter((t=>t.bye)).map((t=>t.drawPosition)),b=u.map((t=>t.drawPositions)).filter((t=>t&&(null==t?void 0:t.reduce(((t,e)=>!S.includes(e)&&t),!0)))).flat(1/0).filter((t=>I.includes(t)));let U=v.length-g;return U>d&&1===n.stageSequence&&n.stage!==_o&&(U=d),{placedByes:w,byesCount:U,relevantMatchUps:u,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:b}}({drawDefinition:e,matchUpsMap:i,structure:r,event:o}),d=s-c;if(d<=0)return dt;const{appliedPolicies:l}=kc({drawDefinition:e}),{isFeedIn:p,strictSeedOrderByePositions:h,blockSeedOrderByePositions:f}=gm({structure:r,drawDefinition:e,appliedPolicies:l,relevantMatchUps:u}),m=t?f:h,{unseededByePositions:g}=function({structure:t,appliedPolicies:e,isFeedIn:i}){var n;const r=null==e||null===(n=e.seeding)||void 0===n?void 0:n.seedingProfile,{positionAssignments:a}=Du({structure:t}),o=a.filter((t=>t.participantId)).map((t=>t.drawPosition)),{matchUps:s,roundMatchUps:c}=Ru({matchUpFilters:{isCollectionMatchUp:!1},structure:t}),u=c&&c[1]||[],d=t.structureType===qo?s:u,l=X([].concat(...d.map((t=>t.drawPositions)))),p=Math.min(...l)-1,h=o.filter((t=>l.includes(t))),f=t=>{const e=Math.ceil(t.length/2),i=[t.slice(0,e),t.slice(e)],n=i.map((t=>[].concat(...t.flat(1/0)).length)),r=Math.min(...n.flat(1/0)),a=Math.max(...n.flat(1/0)),o=n.indexOf(a),s=r!==a,c=Q(i),[u,d]=!r||s?[i[o],i[1-o]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:d}},m=t=>{const{greaterHalf:e,lesserHalf:i}=f(t),{greaterHalf:n,lesserHalf:r}=f(e),a=Q(n.flat(1/0)).pop();return{newlyFilteredChunks:[...i,...r,n.flat().filter((t=>t!==a))],drawPosition:a}},g=t=>!h.includes(t),v=t=>{let e=ct(t.sort(Wn),Math.ceil(t.length/4)).map((t=>t.filter(g)));const i=[].concat(...e.flat(1/0)).length,n=[];for(let r=0;r<i;r++){const{newlyFilteredChunks:t,drawPosition:i}=m(e);n.push(i),e=t}return n},{validSeedBlocks:y}=Al({structure:t,appliedPolicies:e,allPositions:!0});let I=y.map((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>t+p))})).map(v).filter((t=>t.length));if(i){const t=l.length,{seedBlocks:e}=Dl({participantsCount:t,cluster:r===Go});I=e.map((t=>t.map((t=>t+p)))).map(v).filter((t=>t.length))}const w=d.map((t=>t.drawPositions)).map((t=>t.sort(((t,e)=>t-e)))).filter((t=>t[0]+1===t[1])),S=t=>w.reduce(((e,i)=>i.includes(t)?i.reduce(((e,i)=>i!==t?i:e),void 0):e),void 0);return{unseededByePositions:I.map((t=>t.map(S))).flat(1/0).filter(Boolean)}}({appliedPolicies:l,structure:r,isFeedIn:p}),v=[].concat(...m,...a?[]:g).slice(0,d);for(const y of v){const t=ul({drawDefinition:e,structureId:n,drawPosition:y,matchUpsMap:i});if(null!=t&&t.error)return t}return dt}function Im({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=jc({drawDefinition:t,structureId:i})),i||({structureId:i}=e);const{positionAssignments:n}=Du({structure:e}),r=n.filter((t=>t.qualifier)).map((t=>t.drawPosition)),{stage:a,stageSequence:o}=e,s=vu({drawDefinition:t,stage:a,stageSequence:o}),c=s-r.length;return{positionAssignments:n,qualifiersCount:s,placedQualifiersCount:r.length,unplacedQualifiersCount:c}}function wm({drawDefinition:t,participants:e,groupsCount:i,structureId:n,structure:r,matchUpsMap:a,inContextDrawMatchUps:o}){const s=[];let c=0;r||({structure:r}=jc({drawDefinition:t,structureId:n})),n||({structureId:n}=r);const{appliedPolicies:u}=kc({drawDefinition:t}),{validSeedBlocks:d,error:l}=Al({structure:r,drawDefinition:t,appliedPolicies:u});return l&&s.push(l),rt(0,i=i||d.length).forEach((()=>{if(c<i){const i=function({drawDefinition:t,structureId:e,participants:i,matchUpsMap:n,inContextDrawMatchUps:r}){const{unplacedSeedParticipantIds:a,unfilledPositions:o}=xl({drawDefinition:t,structureId:e,randomize:!0}),{appliedPolicies:s}=kc({drawDefinition:t}),{avoidance:c}=s||{};c&&i&&(null==a||a.length);for(const u of a){const i=o.pop();if(!i)return{error:Tt};const a=Rl({drawDefinition:t,structureId:e,drawPosition:i,participantId:u,automaticPlacement:!0,matchUpsMap:n,inContextDrawMatchUps:r});if(!a.success)return a}return dt}({drawDefinition:t,participants:e,structureId:n,matchUpsMap:a,inContextDrawMatchUps:o});i&&i.success&&c++,i.error&&s.push({seedPositionError:i.error})}})),{errors:s}}function Sm({inContextDrawMatchUps:t,drawDefinition:e,candidatesCount:i,participants:n,structureId:r,matchUpsMap:a,seedsOnly:o,event:s}){const{structure:c,error:u}=jc({drawDefinition:e,structureId:r});if(u)return{error:u};const d=[eu,tu],l=Iu({stageSequence:c.stageSequence,stage:c.stage,drawDefinition:e,entryStatuses:d,structureId:r});if(null==l||!l.length)return dt;const{seedingProfile:p}=c;if(a=a||Lc({drawDefinition:e}),t||({matchUps:t}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:a})),p===Ho){let i=ym({drawDefinition:e,matchUpsMap:a,structure:c,seedsOnly:o,event:s});if(i.error)return i;if(i=wm({drawDefinition:e,participants:n,structure:c,matchUpsMap:a,inContextDrawMatchUps:t}),i.error)return i}else{let i=wm({drawDefinition:e,participants:n,structure:c,matchUpsMap:a,inContextDrawMatchUps:t});if(i.error)return i;if(i=ym({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:a,structure:c,seedsOnly:o,event:s}),i.error)return i}const h={};if(!o){let r=mm({candidatesCount:i,drawDefinition:e,participants:n,structure:c,matchUpsMap:a,inContextDrawMatchUps:t});if(r.error)return r;if(r.conflicts&&(h.unseededConflicts=r.conflicts),r=function(t){let{structure:e,structureId:i}=t;if(e||({structure:e}=jc(t)),i||({structureId:i}=e),e.stage===_o)return console.log("Consolation Stage: No Qualifiers"),{error:"Consolation Stage: No Qualifiters"};const{positionAssignments:n,unplacedQualifiersCount:r}=Im(t),a=n.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));return r>a.length?{error:"Insufficient drawPositions to accommodate qualifiers"}:(rt(0,r).forEach((()=>{const t=a.pop();n.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0)}))})),dt)}({drawDefinition:e,participants:n,structure:c,matchUpsMap:a,inContextDrawMatchUps:t}),r.error)return r;r.conflicts&&(h.qualifierConflicts=r.conflicts)}return Pc({drawDefinition:e,structureIds:[r]}),{conflicts:h}}function bm({candidatesCount:t=1,tournamentRecord:e,drawDefinition:i,structureId:n,seedsOnly:r,event:a}){if(!a)return{error:Kt};if(!i)return{error:wt};const o=null==e?void 0:e.participants,{playoffStructures:s}=wl({drawDefinition:i,structureId:n});if(s)for(const c of s){const{structureId:e}=c,n=Sm({structureId:e,candidatesCount:t,drawDefinition:i,participants:o,seedsOnly:r});if(n.error)return n}return{...dt}}function Um({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var o;if(!a||!t||!Array.isArray(r))return{error:_i,modifiedLineUp:(null==i?void 0:i.lineUp)||[]};const s=(null==i?void 0:i.lineUp)||(null===(o=Dc({participantId:e,drawDefinition:n}))||void 0===o?void 0:o.lineUp);return{modifiedLineUp:(null==s?void 0:s.map((e=>{var i;if(!r.includes(e.participantId))return e;const n=null===(i=e.collectionAssignments)||void 0===i?void 0:i.filter((e=>!(e.collectionId===a&&e.collectionPosition===t)));return{participantId:e.participantId,collectionAssignments:n}})).filter(Boolean))||[]}}function Nm({lineUp:t,tieFormat:e}){var i;let n=[];if(!Array.isArray(t))return n.push("lineUp must be an array of objects"),{valid:!1,errors:n,error:_i};const r=(null==e||null===(i=e.collectionDefinitions)||void 0===i?void 0:i.map((({collectionId:t})=>t)))||[],a=t.every((t=>{if("object"!=typeof t)return n.push("lineUp entries must be objects"),!1;const{participantId:e,collectionAssignments:i}=t;return e?"string"!=typeof e?(n.push("participantIds must be strings"),!1):Array.isArray(i)?i.every((t=>{if("object"!=typeof t)return n.push("collectionAssignments must be objects"),!1;const{collectionPosition:e,collectionId:i}=t;return"number"!=typeof e?(n.push("collectionPosition must be a number"),!1):!!r.includes(i)||(n.push("Invalid collectionId"),!1)})):(n.push("collectionAssignments must be an array"),!1):(n.push("Missing participantId"),!1)})),o=X(t.map(Mc)).length===t.length;o||n.push("Duplicated participantId(s)");return{valid:a&&o,errors:n,error:n.length?_i:void 0}}function Pm({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if("object"!=typeof t)return{error:yt};if("string"!=typeof e)return{error:Ye};const r=Nm({lineUp:n,tieFormat:i});if(!r.valid)return r;const{extension:a}=ra({element:t,name:Gr}),o=(null==a?void 0:a.value)||{},s=n.map(Mc);if(Object.keys(o).filter((t=>t!==e)).find((t=>{const i=o[t],r=ot(i.map(Mc),s);return r.length&&console.log({overlap:r,submittedParticipantId:e,submittedLineUp:n,storedParticipantId:t,storedLineUp:i}),r.length})))return{error:"lineUp conflict"};o[e]=n;return Gc({element:t,extension:{name:Gr,value:o}})}function Em({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){if(!t)return{error:ft};if(!e)return{error:xt};if(!n)return{error:Kt};const r=Lc({drawDefinition:e}),{matchUp:a,structure:o}=ku({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:r,event:n});if(!a)return{error:he};const{collectionPosition:s,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:l}=a;if(![ua,da].includes(l))return{error:ge};const{positionAssignments:p}=Eu({structure:o}),h=null==p?void 0:p.filter((t=>c.includes(t.drawPosition))),f=Cc(h),{tournamentParticipants:m}=Np({tournamentRecord:t,participantFilters:{participantTypes:[ka],participantIds:f}}),{matchUp:g}=ku({matchUpId:d,drawDefinition:e,matchUpsMap:r});return{relevantAssignments:h,collectionPosition:s,teamParticipants:m,collectionId:u,matchUpType:l,dualMatchUp:g,tieMatchUp:a,tieFormat:g.tieFormat||o.tieFormat||e.tieFormat||n.tieFormat,structure:o,...dt}}function Dm({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var s,c;const u=null===(s=Dc({participantId:e,drawDefinition:i}))||void 0===s?void 0:s.lineUp,d=null===(c=n||u)||void 0===c?void 0:c.find((t=>(null==t?void 0:t.participantId)===r)),l={collectionId:a,collectionPosition:t};if(d)d.collectionAssignments.push(l);else{const t={collectionAssignments:[l],participantId:r};n.push(t)}e&&Pm({participantId:e,lineUp:n,drawDefinition:i,tieFormat:o})}function Am({drawDefinition:t,participantIds:e}){if("object"!=typeof t)return{error:yt};if(!Array.isArray(e))return{error:He};const{extension:i}=ra({element:t,name:Gr}),n=(null==i?void 0:i.value)||{},r=Object.keys(n).find((t=>n[t].map(Mc).some((t=>e.includes(t)))));return{lineUp:n[r],teamParticipantId:r}}function Tm({tournamentRecord:t,drawIds:e=[],auditData:i,eventId:n}){var r;if(!t)return{error:ft};const a=Array.isArray(e)&&e[0],{event:o,error:s}=Ia({tournamentRecord:t,eventId:n,drawId:a});if(s)return{error:s};const c=[],u=[],d=[];if(!o.drawDefinitions)return{error:wt};const l=o.drawDefinitions.map((({drawId:t})=>t));e.length||(e=l);if(!(e.length&&e.every((t=>l.includes(t)))))return{error:wt};o.drawDefinitions=o.drawDefinitions.filter((t=>{if(e.includes(t.drawId)){const e={action:jf,payload:{drawDefinitions:[t],eventId:o.eventId,auditData:i}};c.push(e);const{drawId:n,drawType:r,drawName:a}=t;d.push({auditData:i,drawId:n,drawType:r,drawName:a,eventId:o.eventId});const{matchUps:s}=dd({event:o,drawDefinition:t});s.forEach((({matchUpId:t})=>u.push(t)))}return!e.includes(t.drawId)})),Kl({tournamentRecord:t});const{timeItem:p}=Qs({element:o,itemType:"PUBLISH.STATUS"}),h=null==p||null===(r=p.itemValue)||void 0===r?void 0:r.PUBLIC;for(const g of e){var f;if(null==h||null===(f=h.drawIds)||void 0===f?void 0:f.includes(g)){var m;const t=(null===(m=h.drawIds)||void 0===m?void 0:m.filter((t=>t!==g)))||[],e=rc({event:o,timeItem:{itemType:"PUBLISH.STATUS",itemValue:{[Er]:{drawIds:t}}}});if(e.error)return{error:e.error}}}if(c.length){en({topic:uc,payload:c});const t=rc({event:o,timeItem:{itemType:jf,itemValue:d}});if(t.error)return t}return u.length&&bc({matchUpIds:u}),function({drawId:t}){en({topic:dc,payload:{drawId:t}})}({drawId:a}),dt}function Cm({tournamentRecord:t,drawDefinition:e,event:i,requireParticipantCount:n=!0,enforcePolicyLimits:r=!0,drawSizeProgression:a,participantCount:o,structureId:s,seedsCount:c}){const{structure:u,error:d}=jc({drawDefinition:e,structureId:s});if(d)return{error:d};const{positionAssignments:l}=Du({structure:u}),p=l.length;if(c>p)return{error:kt};const{policyDefinitions:h}=Xd({policyTypes:[or],tournamentRecord:t,drawDefinition:e,event:i}),{seedsCount:f}=kf({requireParticipantCount:n,drawSizeProgression:a,policyDefinitions:h,participantCount:o,drawSize:p});return h&&f&&c>f&&r&&(c=f),u.seedLimit=c,u.seedAssignments=rt(1,c+1).map((t=>({seedNumber:t,seedValue:t,participantId:void 0}))),Pc({drawDefinition:e,structureIds:[s]}),{...dt,seedLimit:c}}function Mm({qualifyingRound:t,finishingPositionOffset:e,qualifyingPositions:i,matchUpType:n,roundLimit:r,idPrefix:a,drawSize:o,isMock:s,uuids:c}){if(isNaN(o)||!W(o)||o<2)return{matchUps:[],roundsCount:0};const u=rt(1,parseInt(o)+1).map((t=>({drawPosition:t})));let d,l=[],p=1;for(({roundNodes:d,matchUps:l}=Rm({roundNumber:p,matchUpType:n,idPrefix:a,matchUps:l,isMock:s,nodes:u,uuids:c})),p++,r=r||t;d.length>1;)i&&d.length===i&&(r=p-1),({roundNodes:d,matchUps:l}=Rm({nodes:d,roundNumber:p,matchUpType:n,idPrefix:a,matchUps:l,isMock:s,uuids:c})),p++;const h=p-1;return l=xm({finishingPositionOffset:e,roundsCount:h,roundLimit:r,matchUps:l}),r&&(l=l.filter((t=>t.roundNumber<=r))),{matchUps:l,roundsCount:h,roundLimit:r}}function xm({finishingPositionOffset:t=0,positionsFed:e,roundsCount:i,roundLimit:n,matchUps:r,fmlc:a}){const o=r.reduce(((t,e)=>(t[e.roundNumber]=(t[e.roundNumber]||0)+1,t)),{}),s=Object.values(o),c=t=>[Math.min(...t),Math.max(...t)],u=n?i-n:0;return r.forEach((n=>{n.finishingRound=i+1-n.roundNumber-u;const r=a&&1!==n.roundNumber,d=1+t+(r?e:0),l=o[n.roundNumber],p=s.slice(n.roundNumber-1).reduce(((t,e)=>t+e),0),h=rt(d,p+d+1),f=p+1-l,m=c(h.slice(f)),g=c(h.slice(0,f));n.finishingPositionRange={loser:m,winner:g}})),r}function Rm({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let c=0;const u=[];let d=1;const l=i-1,p=s.length;for(;c<p;){const p=s[c],h=s[c+1];l&&(p.roundNumber=l),h&&l&&(h.roundNumber=l);const f={roundPosition:d,children:[p,h],matchUpId:Lm({roundPosition:d,roundNumber:i,idPrefix:r,uuids:o})};u.push(f);const m={matchUpId:f.matchUpId,roundNumber:i,roundPosition:d,matchUpStatus:x,drawPositions:f.children.map((t=>t.drawPosition))};t&&(m.matchUpType=e),a&&(m.isMock=!0),n.push(m),c+=2,d++}return{roundNodes:u,matchUps:n}}function km({linkFedFinishingRoundNumbers:t=[],linkFedRoundNumbers:e=[],finishingPositionOffset:i,feedRoundsProfile:n=[],feedRounds:r=0,skipRounds:a=0,feedsFromFinal:o,isConsolation:s,baseDrawSize:c,matchUpType:u,idPrefix:d,drawSize:l,isMock:p,uuids:h,fmlc:f}){const m=function({drawSize:t}){return rt(0,Math.ceil(Math.log(t)/Math.log(2))).reverse().map((t=>Math.pow(2,t)))}({drawSize:c=c||function(t){const e=q(t);return e>t?e/2:e}(l)}),g=m.length;let v=0;if(n.length)v=n.reduce(((t,e)=>t+e),0);else if(l){let t=l-c;n=m.filter((e=>e<=t&&(t-=e,!0))),v=n.reduce(((t,e)=>t+e),0),r=n.length}else a>=g&&(r=0),o&&(r=g-o,a=0),n=m.filter(((t,e)=>o&&!r||r&&e>=a+r||e<a?0:t)),v=n.reduce(((t,e)=>t+e),0),l=c+v,r=n.length;const y=[...m,...n].sort(((t,e)=>e-t)),I=y.length,w=[...e.map((t=>t-1)),...t.map((t=>I-t))].map((t=>y[t])).reduce(((t,e)=>t+e),0);v-=w;let S,b=0,U=[],N=1;let P=rt(0,c).map(((t,e)=>({drawPosition:e+1+v}))),E=v+1;for(const A of m){if(({roundNodes:S,matchUps:U}=Rm({roundNumber:N,matchUpType:u,idPrefix:d,matchUps:U,isMock:p,nodes:P,uuids:h})),N++,n.includes(A)){const i=rt(0,tt(n)[A]),r=I+1-N,a=t.includes(r)||e.includes(N);for(const t of i){const e=!a&&E||void 0;({roundNodes:S,matchUps:U,drawPosition:E}=Om({drawPosition:e,nodes:S,roundIteration:t,roundNumber:N,matchUpType:u,idPrefix:d,matchUps:U,uuids:h,fed:b})),N++,b+=1}}P=S}I!==N-1&&console.log("ERROR");U=xm({finishingPositionOffset:s?c-v:i,positionsFed:v,roundsCount:I,matchUps:U,fmlc:f});const D=S&&S.length?S[0]:S;return D&&(D.roundNumber=N-1,D.matchUps=U),{draw:D,matchUps:U,roundsCount:I}}function Om({includeMatchUpType:t,drawPosition:e,matchUpType:i,roundNumber:n,idPrefix:r,matchUps:a,uuids:o,nodes:s,fed:c}){const u=s.length,d=e?e-u:void 0,l=rt(0,u).map((t=>d?d+t:void 0)),p=[];for(let h=0;h<u;h++){const e=l.shift(),u={feed:!0,fed:c+1,drawPosition:e},d=s[h];d.roundNumber=n-1;const f={roundNumber:n,matchUpId:Lm({roundPosition:d.roundPosition,roundNumber:n,idPrefix:r,uuids:o}),roundPosition:d.roundPosition,drawPositions:[void 0,e]};t&&(f.matchUpType=i),a.push(f);const m={children:[d,u]};p.push(m)}return{roundNodes:p,matchUps:a,drawPosition:e?e-u:void 0}}function Lm({idPrefix:t,roundNumber:e,roundPosition:i,uuids:n}){return t?`${t}-${e}-${i}`:(null==n?void 0:n.pop())||qn()}const _m=({stage:t,structureId:e,matchUps:i=[],structures:n,stageOrder:r,roundLimit:a,roundOffset:o,exitProfile:s,matchUpFormat:c,structureType:u,structureAbbreviation:d,structureName:l,seedingProfile:p,qualifyingRound:h,stageSequence:f=1,seedAssignments:m=[],finishingPosition:g=Ps})=>{const v={structureAbbreviation:d,structureName:l,matchUpFormat:c,stageSequence:f,finishingPosition:g,seedAssignments:m,structureId:e||qn()};t&&(v.stage=t),r&&(v.stageOrder=r),a&&(v.roundLimit=a),o&&(v.roundOffset=o),u&&(v.structureType=u),p&&(v.seedingProfile=p),h&&(v.qualifyingRound=h),s&&(v.exitProfile=s);const y=[].concat(...i.map((t=>t.drawPositions))).filter(Boolean);return n?v.structures=n:(v.matchUps=i,v.positionAssignments=X(y).sort(((t,e)=>t-e)).map((t=>({drawPosition:t})))),v};function Fm({drawDefinition:t,structureName:e,matchUpType:i,idPrefix:n,drawSize:r,isMock:a,uuids:o}){const{matchUps:s}=km({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:i,idPrefix:n,isMock:a}),c=_m({structureName:e||Oo,structureId:null==o?void 0:o.pop(),stageSequence:1,stage:Oo,matchUpType:i,matchUps:s});t.structures.push(c);const u=r/2,{matchUps:d}=km({finishingPositionOffset:u,idPrefix:n&&`${n}-c`,drawSize:r-1,isConsolation:!0,matchUpType:i,isMock:a,uuids:o}),l=_m({matchUps:d,structureId:null==o?void 0:o.pop(),structureName:Ss,stageSequence:2,matchUpType:i,stage:Oo});t.structures.push(l);const{matchUps:p}=Mm({idPrefix:n&&`${n}-p1t2`,drawSize:2,matchUpType:i,isMock:a}),h=_m({matchUps:p,structureId:null==o?void 0:o.pop(),structureName:ws,stageSequence:3,stage:Oo,matchUpType:i});t.structures.push(h);const f=function({mainStructure:t,consolationStructure:e,deciderStructure:i}){const n=e.matchUps.reduce(((t,e)=>(e.drawPositions||[]).filter(Boolean).length&&!t.includes(e.roundNumber)?t.concat(e.roundNumber):t),[]),r=t.matchUps.reduce(((t,e)=>!t||e.roundNumber>t?e.roundNumber:t),void 0),a=e.matchUps.reduce(((t,e)=>!t||e.roundNumber>t?e.roundNumber:t),void 0);return[...[1,2].map((i=>{const n=i%2?Yo:Jo;return{linkType:Xo,source:{roundNumber:i,structureId:t.structureId},target:{feedProfile:n,roundNumber:1,positionInterleave:{offset:i-1,interleave:1},structureId:e.structureId}}})),...n.slice(1).map(((i,r)=>{const a=n.indexOf(i)%2?Yo:Jo;return{linkType:Xo,source:{roundNumber:3+r,structureId:t.structureId},target:{feedProfile:a,roundNumber:i,structureId:e.structureId}}})),{linkType:Zo,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Yo,roundNumber:r,structureId:t.structureId}},{linkType:Zo,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Yo,roundNumber:1,structureId:i.structureId}},{linkType:Xo,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Yo,roundNumber:1,structureId:i.structureId}}]}({mainStructure:c,consolationStructure:l,deciderStructure:h});return t.links=t.links.concat(...f),Object.assign({structures:t.structures,links:t.links},dt)}function jm({mainStructure:t,consolationStructure:e,roundsCount:i,roundOffset:n=0,feedPolicy:r,fmlc:a}){const o=e.matchUps.reduce(((t,e)=>(e.drawPositions||[]).filter(Boolean).length&&!t.includes(e.roundNumber)?t.concat(e.roundNumber):t),[]),s=(null==r?void 0:r.roundGroupedOrder)||[],c=null==r?void 0:r.roundFeedProfiles;return rt(1+n,i+1+n).map((i=>{const r=c&&c[i-1]?c[i-1]:i%2?Yo:Jo,u=i-n<=2?i-n:2*(i-n-2)+2,d={linkType:Xo,source:{roundNumber:i,structureId:t.structureId},target:{feedProfile:r,roundNumber:u,structureId:e.structureId}},l=s[i-1];return l&&(d.target.groupedOrder=l),Xi()&&(d.source.structureName=t.structureName,d.target.structureName=e.structureName),2===i&&a&&(d.linkCondition=Qo,d.target.feedProfile=Yo),o.includes(u)?d:void 0})).filter(Boolean)}function Bm({finishingPositionOffset:t,structureName:e=Oo,stageSequence:i=1,staggeredEntry:n,drawDefinition:r,matchUpType:a,idPrefix:o,isMock:s,uuids:c}){const u=gu({stage:Oo,drawDefinition:r}),d={finishingPositionOffset:t,matchUpType:a,drawSize:u,idPrefix:o,isMock:s,uuids:c},{matchUps:l,roundsCount:p}=n?km(d):Mm(d),h=_m({matchUps:l,matchUpType:a,stage:Oo,structureName:e,stageSequence:i,structureId:null==c?void 0:c.pop()});r.structures.push(h);const f=[0,2].slice(0,u/16).map(((t,e)=>{const i=e+1,{consolationStructure:n}=function({stageSequence:t=1,roundOffset:e=0,matchUpType:i,structureId:n,idPrefix:r,drawSize:a,isMock:o,index:s,uuids:c}){const u=a/(2*Math.pow(2,e)),{matchUps:d,roundsCount:l}=km({finishingPositionOffset:u,baseDrawSize:u,isConsolation:!0,feedRounds:1,matchUpType:i,idPrefix:r,isMock:o,uuids:c});return{consolationStructure:_m({matchUps:d,stage:_o,structureName:`${_o} ${s+1}`,stageSequence:t,matchUpType:i,structureId:n}),consolationRoundsCount:l}}({structureId:null==c?void 0:c.pop(),idPrefix:o&&`${o}-c${e}`,stageSequence:i,roundOffset:t,matchUpType:a,drawSize:u,isMock:s,index:e,uuids:c});r.structures.push(n);return{consolationStructure:n,links:jm({mainStructure:h,consolationStructure:n,roundsCount:2,roundOffset:t})}})).map((t=>t.links));if(r.links=r.links.concat(...f),u>=4&&u<=16||u>32){const{matchUps:t}=Mm({finishingPositionOffset:2,idPrefix:o&&`${o}-p3t4`,drawSize:2,matchUpType:a,isMock:s}),e=_m({structureId:null==c?void 0:c.pop(),matchUps:t,structureName:jo,stageSequence:2,matchUpType:a,stage:Oo}),i={linkType:Xo,source:{roundNumber:p-1,structureId:h.structureId},target:{roundNumber:1,feedProfile:Yo,structureId:e.structureId}};r.structures.push(e),r.links.push(i)}return Object.assign({structures:r.structures,links:r.links},dt)}function Vm(t={}){const{uuids:e,feedRounds:i,matchUpType:n,stage:r=Oo,structureName:a,drawDefinition:o,feedsFromFinal:s,stageSequence:c=1,finishingPositionOffset:u,staggeredEntry:d,feedPolicy:l,idPrefix:p,isMock:h,fmlc:f}=t,m=gu({stage:r,drawDefinition:o}),g={finishingPositionOffset:u,matchUpType:n,drawSize:m,idPrefix:p,isMock:h,uuids:e},{matchUps:v}=d?km(g):Mm(g),y=_m({structureName:a||Oo,structureId:null==e?void 0:e.pop(),stageSequence:c,stage:Oo,matchUpType:n,matchUps:v});o.structures.push(y);const I=m/2,{matchUps:w,roundsCount:S}=km({finishingPositionOffset:I,isConsolation:!0,feedsFromFinal:s,baseDrawSize:I,matchUpType:n,feedRounds:i,idPrefix:p&&`${p}-c`,isMock:h,uuids:e,fmlc:f}),b=_m({matchUpType:n,stageSequence:1,stage:_o,structureId:null==e?void 0:e.pop(),structureName:_o,matchUps:w});o.structures.push(b);const U=jm({mainStructure:y,consolationStructure:b,roundsCount:S,feedPolicy:l,fmlc:f});return o.links=o.links.concat(...U),Object.assign({mainStructure:y,consolationStructure:b,links:o.links},dt)}function Gm({tieFormat:t,uuids:e}){const{collectionDefinitions:i}=t||{};return{tieMatchUps:(i||[]).map((t=>{const{matchUpCount:i,matchUpFormat:n,matchUpType:r,collectionId:a}=t||{};return rt(0,i||0).map((t=>({isMock:!0,collectionId:a,matchUpType:r,matchUpFormat:n,collectionPosition:t+1,matchUpId:(null==e?void 0:e.pop())||qn(),sides:[{sideNumber:1},{sideNumber:2}]})))})).filter(Boolean).flat()}}function Hm({stage:t,stageSequence:e,drawDefinition:i}={}){if(!i)return{error:yt};return{structures:i.structures.filter((function(e){return e.stage===t})).filter((function(t){return!e||t.stageSequence===e}))}}function Wm(t){const{structure:e,childStructures:i}=qm(t),n=[e.structureId,...i.map((({structureId:t})=>t))];return t.drawDefinition.structures.sort(Fc),Pc({drawDefinition:t.drawDefinition,structureIds:n}),Object.assign({structure:e,childStructures:i},dt)}function qm({finishingPositionOffset:t=0,playoffStructureNameBase:e,finishingPositionNaming:i,finishingPositionLimit:n,playoffAttributes:r,stageSequence:a=1,exitProfile:o="0",exitProfileLimit:s,roundOffsetLimit:c,roundOffset:u=0,drawDefinition:d,staggeredEntry:l,sequenceLimit:p,stage:h=Oo,matchUpType:f,idPrefix:m,drawSize:g,isMock:v,uuids:y}){if(!(!r||!s||r&&r[o])||g<2||p&&a>p)return{};f=f||(null==d?void 0:d.matchUpType);const I=t+1,w=`${I}-${t+g}`,S=r&&r[o],b=e&&`${e} `||"",U=i&&i[w],N=(null==U?void 0:U.name)||(null==S?void 0:S.name)||`${b}${w}`,P=(null==U?void 0:U.abbreviation)||(null==S?void 0:S.abbreviation),E={idPrefix:m&&`${m}-${N}-RP`,finishingPositionOffset:t,matchUpType:f,drawSize:g,isMock:v,uuids:y},{matchUps:D}=l?km(E):Mm(E),A=_m({structureId:null==y?void 0:y.pop(),structureAbbreviation:P,stageSequence:a,structureName:N,matchUpType:f,roundOffset:u,exitProfile:o,matchUps:D,stage:h});d.structures.push(A),Sc({drawDefinition:d,matchUps:D});const T=Math.ceil(Math.log(g)/Math.log(2)),C=rt(1,(c?Math.min(c-u,T):!n||I<n?T:0)+1).map((function(l){const v=g/Math.pow(2,l);if(v<2)return;const I=g/Math.pow(2,l)+t;if(I+1>n)return;const{structure:w,structureName:S,childStructures:b}=qm({finishingPositionOffset:I,exitProfile:`${o}-${l}`,roundOffset:u+l,stageSequence:a+1,drawSize:v,playoffStructureNameBase:e,finishingPositionNaming:i,finishingPositionLimit:n,playoffAttributes:r,exitProfileLimit:s,roundOffsetLimit:c,drawDefinition:d,sequenceLimit:p,matchUpType:f,idPrefix:m,uuids:y,stage:h}),U={linkType:Xo,source:{roundNumber:l,structureName:N,structureId:null==A?void 0:A.structureId},target:{roundNumber:1,feedProfile:Yo,structureName:S,structureId:null==w?void 0:w.structureId}};A&&w&&d.links.push(U);return{structure:w,childStructures:b}})).filter(Boolean);return{structure:A,structureName:N,childStructures:C}}function zm({structureName:t=Oo,stageSequence:e=1,structureOptions:i,seedingProfile:n,drawDefinition:r,stage:a=Oo,matchUpType:o,idPrefix:s,uuids:c}){const u=Ns,d=gu({stage:a,drawDefinition:r}),{groupCount:l,groupSize:p}=function({structureOptions:t,drawSize:e}){let i=null==t?void 0:t.groupSize;const n=(null==t?void 0:t.groupSizeLimit)||8,r=function({drawSize:t,groupSizeLimit:e=10}){return rt(3,e+1).filter((e=>Math.ceil(t/e)*e-t<e))}({drawSize:e,groupSizeLimit:n}),a=Math.max(...r);i&&r.includes(i)||(i=i&&i>4||!r.includes(4)?a:4);const o=Math.ceil(e/i);return{groupSize:i,groupCount:o}}({structureOptions:i,drawSize:d}),h=rt(1,l+1).map((t=>_m({structureName:`Group ${t}`,matchUps:Ym({groupSize:p,structureOrder:t,matchUpType:o,idPrefix:s}),structureId:null==c?void 0:c.pop(),structureType:Wo,finishingPosition:u,structureOrder:t,matchUpType:o}))),f=_m({structureId:null==c?void 0:c.pop(),structureType:qo,finishingPosition:u,seedingProfile:n,structureName:t,stageSequence:e,matchUpType:o,structures:h,stage:a});return r.structures.push(f),Object.assign({structure:f,groupCount:l,groupSize:p},dt)}function Km({finishingPositions:t,playoffStructure:e,mainStructure:i}){return{linkType:$o,source:{finishingPositions:t,structureId:i.structureId},target:{roundNumber:1,feedProfile:zo,structureId:e.structureId}}}function Ym({structureOrder:t,matchUpType:e,groupSize:i,idPrefix:n,uuids:r}){const a=(t-1)*i,o=rt(1+a,i+1+a),{uniqueMatchUpGroupings:s}=cm({drawPositions:o}),c=function({groupSize:t,drawPositionOffset:e}){const i=t=>[...Array(t)].map(((t,e)=>e)),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map((()=>[]));let a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach(((t,e)=>{a.forEach(((t,i)=>{r[e].push([a[i],o[i]])}));const i=a.shift(),n=a.pop(),s=o.shift();a=[].concat(i,s,...a),o=[].concat(...o,n)}));const s=a.shift(),c=a.pop(),u=o.shift();a=[].concat(s,u,...a),o=[].concat(...o,c);const d=t=>t[0].reduce(((t,e)=>t+e));return r.reverse().sort(((t,e)=>d(t)-d(e))).map((i=>i.filter((e=>e.every((e=>e<=t)))).map((t=>um(t.map((t=>t+e)))))))}({groupSize:i,drawPositionOffset:a});return s.map((function(i){const a=function(t){return c.reduce(((e,i,n)=>i.includes(t)?n+1:e),void 0)}(um(i)),o=u(i.slice(1)),s=u(i.slice(0,i.length-1)),d=function({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(null==r?void 0:r.pop())||qn()}({structureOrder:t,drawPositions:i,roundNumber:a,idPrefix:n,uuids:r});return{matchUpStatus:a?x:S,matchUpType:e,finishingPositionRange:{winner:s,loser:o},drawPositions:i,roundNumber:a,matchUpId:d}})).sort(((t,e)=>(t.roundNumber||9999)-(e.roundNumber||9999)));function u(t){return[Math.min(...t),Math.max(...t)]}}function Jm(t={}){const{drawType:e=rs,stageSequence:i=1,drawDefinition:n,staggeredEntry:r,structureName:a,goesTo:o=!0,stage:s=Oo,uuids:c}=t;if(!n)return{error:yt};let{tieFormat:u,matchUpType:d}=t;u=u||n.tieFormat,d=d||n.matchUpType||ua;const l=gu({stage:s,drawDefinition:n});Object.assign(t,{drawSize:l,matchUpType:d,tieFormat:u});const p=W(2*l/3);if(l<2||!r&&![es,ts].includes(e)&&(e===ys&&l<3||e===as&&!p||![ys,as,Is].includes(e)&&!W(l)))return{error:Ct,drawSize:l};const h=Es.includes(e);if(parseInt(l)<4&&h)return{error:Ct};const f=1===i?1:void 0,{structures:m}=Hm({stage:s,stageSequence:i,drawDefinition:n});if(m.length>=f)return{error:te};const g={[ts]:()=>{const t=_m({structureName:a||s,finishingPosition:Ns,structureId:null==c?void 0:c.pop(),stageSequence:i,matchUps:[],matchUpType:d,stage:s});return n.structures.push(t),Object.assign({structure:t},dt)},[rs]:()=>{const{matchUps:e,roundLimit:r}=Mm(t),o=_m({stage:s,matchUps:e,matchUpType:d,stageSequence:i,qualifyingRound:s===Lo&&r,structureId:null==c?void 0:c.pop(),roundLimit:r,structureName:a||s});return n.structures.push(o),Object.assign({structure:o},dt)},[as]:()=>Fm(t),[is]:()=>Wm(Object.assign(t,{roundOffsetLimit:3,playoffAttributes:bs})),[ns]:()=>Wm(Object.assign(t,{roundOffsetLimit:2,playoffAttributes:Us})),[jo]:()=>Wm(t),[es]:()=>{const{matchUps:t}=km({drawSize:l,uuids:c,matchUpType:d}),e=_m({structureName:a||s,structureId:null==c?void 0:c.pop(),stageSequence:i,matchUpType:d,matchUps:t,stage:s});return n.structures.push(e),Object.assign({structure:e},dt)},[ss]:()=>function(t){let{drawSize:e,consolationStructureName:i}=t;const{finishingPositionOffset:n=0,stageSequence:r=1,drawDefinition:a,staggeredEntry:o,structureName:s,stage:c=Oo,matchUpType:u,idPrefix:d,isMock:l,uuids:p}=t;e=e||gu({stage:c,drawDefinition:a});const h={finishingPositionOffset:n,matchUpType:u,drawSize:e,idPrefix:d,isMock:l,uuids:p},{matchUps:f}=o?km(h):Mm(h),m=_m({stage:c,matchUps:f,matchUpType:u,stageSequence:r,structureId:null==p?void 0:p.pop(),structureName:s||Oo});a&&a.structures.push(m);const g=e/2,{matchUps:v}=Mm({finishingPositionOffset:n+g,drawSize:g,idPrefix:d&&`${d}-c`,matchUpType:u,isMock:l});i=i||(s?`${s} ${_o}`:_o);const y=_m({matchUpType:u,stageSequence:1,stage:_o,structureId:null==p?void 0:p.pop(),matchUps:v,structureName:i});a&&a.structures.push(y);const I={linkType:Xo,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Yo,structureId:y.structureId}};return a&&a.links.push(I),Object.assign({link:I,mainStructure:m,consolationStructure:y,links:null==a?void 0:a.links},dt)}(t),[os]:()=>Vm(Object.assign(t,{feedRounds:1,fmlc:!0})),[ms]:()=>Vm(Object.assign(t,{feedRounds:1})),[ls]:()=>Vm(Object.assign(t,{feedsFromFinal:2})),[us]:()=>Vm(Object.assign(t,{feedsFromFinal:1})),[hs]:()=>Vm(Object.assign(t,{feedsFromFinal:3})),[vs]:()=>Vm(t),[cs]:()=>Bm(t),[ys]:()=>zm(t),[Is]:()=>function(t){const{playoffMatchUpFormat:e,stageSequence:i=1,structureOptions:n,drawDefinition:r,matchUpType:a,idPrefix:o,uuids:s}=t,c=Object.assign({structureName:Oo},t,{stage:Oo}),{structure:u,groupCount:d,groupSize:l}=zm(c);d<1&&console.log(Oi);const p=n&&n.playoffGroups||[{finishingPositions:[1],structureName:jo}];let h=0;const f=p.map(((t,n)=>{const c=n+1,p=rt(1,l+1),f=t.finishingPositions;if(!f.reduce(((t,e)=>p.includes(e)&&t),!0))return;const m=t.drawType||rs,g=d*f.length,v=K(g);if(m===rs){const{matchUps:n}=Mm({idPrefix:o&&`${o}-po`,finishingPositionOffset:h,matchUpType:a,drawSize:v}),d=_m({matchUps:n,stageOrder:c,matchUpType:a,stageSequence:i,stage:jo,structureId:null==s?void 0:s.pop(),structureName:t.structureName,matchUpFormat:e});r.structures.push(d);const l=Km({mainStructure:u,playoffStructure:d,finishingPositions:f});return r.links.push(l),h+=g,d}if(m===os){console.log("RRw/PO FIRST_MATCH_LOSER_CONSOLATION");const e=[null==s?void 0:s.pop(),null==s?void 0:s.pop()],{mainStructure:i,consolationStructure:n,link:c}=Vm({structureName:t.structureName,idPrefix:o&&`${o}-po`,finishingPositionOffset:h,uuids:e,stage:jo,feedRounds:1,matchUpType:a,fmlc:!0,drawSize:v}),d=Km({mainStructure:u,playoffStructure:i,finishingPositions:f});return r.links.push(d),r.structures.push(i),r.structures.push(n),r.links.push(c),h+=g,i}})).filter(Boolean);return Object.assign({mainStructure:u,playoffStructures:f,links:r.links},dt)}(t)}[e],v=g&&g();if(null==v||!v.success)return{error:Pt};const{matchUps:y,matchUpsMap:I}=sd({drawDefinition:n});let w;u&&y.forEach((t=>{const{tieMatchUps:e}=Gm({tieFormat:u});Object.assign(t,{tieMatchUps:e,matchUpType:d})})),o&&({inContextDrawMatchUps:w}=Sd({drawDefinition:n,matchUpsMap:I}));const S={...dt,matchUps:y};return Object.assign(S,v,{matchUpsMap:I,inContextDrawMatchUps:w}),Pc({drawDefinition:n}),S}function $m({drawDefinition:t,stage:e,drawSize:i}){if(!t)return{error:yt};if(!mu({drawDefinition:t,stage:e}))return{error:Qt};if(i<wu({drawDefinition:t,stage:e})+vu({drawDefinition:t,stage:e}))return{error:"Cannot set drawSize to be less than existing entries"};const{entryProfile:n}=Jc({drawDefinition:t,attributes:[{[e]:{drawSize:i}}]});return Pc({drawDefinition:t}),{...dt,entryProfile:n}}function Zm({drawDefinition:t,policyDefinitions:e}){if(!t)return{error:yt};if(!e||"object"!=typeof e)return{error:ye};t.extensions||(t.extensions=[]);const{appliedPolicies:i}=kc({drawDefinition:t}),n=Object.keys(e).every((t=>!i[t]&&(i[t]=e[t],!0)));if(n){const e=Gc({element:t,extension:{name:Lr,value:i}});if(e.error)return e}return Pc({drawDefinition:t}),n?{...dt}:{error:be}}function Xm({tournamentRecord:t,participantId:e,scaleAttributes:i}){if(!t)return{error:ft};if(!e)return{error:Ye};const{participant:n}=na({tournamentRecord:t,participantId:e});return n?ff({participant:n,scaleAttributes:i}):{error:Je}}function Qm({tournamentRecord:t,event:e,stage:i,entries:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:o=!1}){if(!t)return{error:ft};return{scaledEntries:(n=n||(null==e?void 0:e.entries)||[]).filter((t=>(!i||!t.entryStage||t.entryStage===i)&&du.includes(t.entryStatus))).map((e=>{const{participantId:i}=e,{scaleItem:n}=Xm({tournamentRecord:t,participantId:i,scaleAttributes:r});return{...e,...n}})).filter((t=>{const e=t.scaleValue;return!!(a||!isNaN(e)&&parseFloat(e))&&e})).sort(a||function(t,e){return o?s(e)-s(t):s(t)-s(e)})};function s(t){return parseFloat(t.scaleValue||(o?-1:1e5))}}const tg=["drawId","structures"];function eg(t,e=!0){return t?"object"!=typeof t?{error:Li}:t.drawId?function(t){const e=Object.keys(t);return tg.reduce(((t,i)=>!!e.includes(i)&&t),!0)}(t)?e?Vn(t):t:{error:vt}:{error:xt,method:"setState"}:{error:yt}}function ig({drawId:t=qn(),matchUpType:e,drawType:i}={}){const n={drawId:void 0,drawName:void 0,matchUpType:void 0,entries:[],links:[],structures:[]};return Object.assign(n,{drawId:t,drawType:i,matchUpType:e})}const ng={STANDARD:{doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},COLLEGE_D3:{doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_D3",valueGoal:5},COLLEGE_DEFAULT:{doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:"SET1-S:6NOAD/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6NOAD/TB7"},tieFormatName:"COLLEGE_DEFAULT",valueGoal:4},COLLEGE_JUCO:{doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6"},tieFormatName:"COLLEGE_JUCO",valueGoal:5}},rg=({namedFormat:t,uuids:e=[]}={})=>{var i,n;Object.keys(ng).includes(t)||(t="STANDARD"),Array.isArray(e)||(e=[]);const r=ng[t],a={winCriteria:{valueGoal:r.valueGoal},collectionDefinitions:[{collectionId:(null===(i=e)||void 0===i?void 0:i.pop())||qn(),collectionName:"Doubles",matchUpType:da,matchUpFormat:"SET3-S:6/TB7-F:TB10",...r.doubles},{collectionId:(null===(n=e)||void 0===n?void 0:n.pop())||qn(),collectionName:"Singles",matchUpType:ua,matchUpFormat:"SET3-S:6/TB7",...r.singles}]};return r.tieFormatName&&(a.tieFormatName=r.tieFormatName),a};function ag(t){const{drawType:e=rs,enforcePolicyLimits:i=!0,finishingPositionNaming:n,ignoreAllowedDrawTypes:r,seedAssignmentProfile:a,playoffMatchUpFormat:o,seedByRanking:s=!0,qualifyingPositions:c,seededParticipants:u,policyDefinitions:d,seedingScaleName:l,assignSeedsCount:p,automated:h=!0,qualifyingRound:f,seedingProfile:m,tieFormatName:g,stage:v=Oo,drawEntries:y,feedPolicy:I,idPrefix:w,drawId:S,isMock:b,uuids:U}=t,{tournamentRecord:N,event:P}=t;let{drawName:E,matchUpType:D,structureOptions:A}=t;const T=null==N?void 0:N.participants,C=P&&T&&Xf({event:P,participants:T});if(null!=C&&C.error)return C;const M=!r&&N&&Mf({tournamentRecord:N,categoryType:null==P?void 0:P.categoryType,categoryName:null==P?void 0:P.categoryName});if(null!=M&&M.length&&!M.includes(e))return{error:"Invalid drawType"};let{seedsCount:x,drawSize:R=32,tieFormat:k,matchUpFormat:O}=t;"number"!=typeof R&&(R=parseInt(R)),"number"!=typeof x&&(x=parseInt(x||0));const L=null==P?void 0:P.eventType;D=D||L,D===la&&L===la?(k=k&&g&&("object"==typeof k?k:rg({namedFormat:g})),O=void 0):O||(k=void 0,O="SET3-S:6/TB7");const _=y||(null==P?void 0:P.entries)||[],F=_.filter((t=>(!t.entryStage||t.entryStage===v)&&du.includes(t.entryStatus)));[ys].includes(e)&&(R=F.length||R);const j=ig({drawType:e,drawId:S});if($m({drawDefinition:j,stage:v,drawSize:R}),y){y.reduce(((t,e)=>t.includes(e.entryStage)?t:t.concat(e.entryStage)),[]).filter((t=>t!==v)).filter(Boolean).length&&console.log("drawEntryStages")}if(O||k){if(O&&(null==P?void 0:P.matchUpFormat)===O||(null==P?void 0:P.tieFormat)&&k&&JSON.stringify(P.tieFormat)===JSON.stringify(k))D&&(j.matchUpType=D);else{let t=Gl({drawDefinition:j,matchUpFormat:O,tieFormat:k,event:P});if(t.error)return{error:t.error,message:"matchUpFormat or tieFormat error"};D&&(j.matchUpType=D),k&&(j.tieFormat=k),t.tieFormat&&(k=t.tieFormat)}}k=k||(null==P?void 0:P.tieFormat);let B=Jm({finishingPositionNaming:n,goesTo:t.goesTo,playoffMatchUpFormat:o,qualifyingPositions:c,structureOptions:A,qualifyingRound:f,drawDefinition:j,seedingProfile:m,matchUpFormat:O,matchUpType:D,feedPolicy:I,tieFormat:k,drawType:e,idPrefix:w,isMock:b,stage:v,uuids:U});if(B.error)return B;const{matchUpsMap:V,inContextDrawMatchUps:G}=B,{structures:H}=Hm({drawDefinition:j,stageSequence:1,stage:v}),[W]=H,{structureId:q}=W||{};if("object"==typeof d)for(const tt of Object.keys(d))Zm({policyDefinitions:{[tt]:d[tt]},drawDefinition:j});const{policyDefinitions:z}=Xd({policyTypes:[or],tournamentRecord:N,drawDefinition:j,event:P})||{};null!=d&&d.seeding||null!=z&&z.seeding||Zm({drawDefinition:j,policyDefinitions:Ws});const{policyDefinitions:K}=Xd({policyTypes:[ar],tournamentRecord:N,drawDefinition:j,event:P})||{};null!=d&&d.avoidance||null==K||!K.avoidance||Zm({drawDefinition:j,policyDefinitions:K});for(const tt of _){const t=Hf({...tt,entryStage:tt.entryStage||Oo,drawDefinition:j});if(y&&t.error)return t}const Y=_.map(Mc);u&&(x=u.length),x>R&&(x=R),x>F.length&&(x=F.length);const{seedLimit:J}=Cm({participantCount:F.length,enforcePolicyLimits:i,tournamentRecord:N,drawDefinition:j,structureId:q,seedsCount:x,event:P});if(J&&J<x&&(x=J),u)u.filter((({participantId:t})=>Y.includes(t))).filter((t=>!t.seedNumber||t.seedNumber<=u.length)).sort(((t,e)=>t.seedNumber<e.seedNumber?-1:t.seedNumber<e.seedNumber?1:0)).forEach((t=>{const{participantId:e,seedNumber:i,seedValue:n}=t;Qf({drawDefinition:j,participantId:e,structureId:q,seedNumber:i,seedValue:n})}));else if(null!=P&&P.category||l){var $,Z;const{categoryName:t,ageCategoryCode:e}=(null==P?void 0:P.category)||{},i={scaleType:pf,scaleName:l||t||e,eventType:L};let{scaledEntries:n}=Qm({scaleAttributes:i,tournamentRecord:N,entries:_,stage:v});if((null===($=n)||void 0===$||!$.length)&&s){const i={scaleType:lf,scaleName:t||e,eventType:L};({scaledEntries:n}=Qm({scaleAttributes:i,tournamentRecord:N,entries:_,stage:v}))}const r=(null===(Z=n)||void 0===Z?void 0:Z.length)||0;r<x&&(x=r),n&&n.filter((({participantId:t})=>Y.includes(t))).slice(0,p||x).forEach(((t,e)=>{const i=e+1,n=(null==a?void 0:a[i])||i,{participantId:r}=t;Qf({drawDefinition:j,participantId:r,structureId:q,seedNumber:i,seedValue:n})}))}let X=[];if(!1!==h){const t="object"==typeof h&&h.seedsOnly;({conflicts:X}=Sm({drawDefinition:j,participants:T,structureId:q,seedsOnly:t,inContextDrawMatchUps:G,matchUpsMap:V}))}E=E||e,j&&Object.assign(j,{drawName:E});const Q={drawId:j.drawId,category:null==P?void 0:P.category,eventId:null==P?void 0:P.eventId,seedingScaleName:l,matchUpType:D,seedsCount:x,automated:h,tieFormat:k,drawSize:R,drawType:e,drawName:E};return en({topic:uc,payload:{action:"generateDrawDefinition",payload:Q}}),{...dt,structureId:q,drawDefinition:j,conflicts:X}}function og({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,event:r}){return t?i?void 0===n||Number.isSafeInteger(n)?(((null==r?void 0:r.entries)||[]).forEach((t=>{t.participantId===i&&(t.entryPosition=n)})),((null==e?void 0:e.entries)||[]).forEach((t=>{t.participantId===i&&(t.entryPosition=n)})),dt):{error:_i,entryPosition:n}:{error:Ye}:{error:ft}}function sg({drawDefinition:t,stages:e}){return((null==t?void 0:t.structures)||[]).filter((t=>!(null!=e&&e.length)||e.includes(t.stage))).map((t=>{const{positionAssignments:e}=Eu({structure:t});return Cc(e)})).flat()}function cg({autoEntryPositions:t=!0,tournamentRecord:e,drawDefinition:i,participantIds:n,entryStatus:r,eventSync:a,drawId:o,stage:s,event:c}){var u,d,l,p,h,f,m,g,v,y;if(!n||!Array.isArray(n))return{error:Ge,method:"modifyEntriesStatus",participantIds:n};if(!lu.includes(r))return{error:ci};if(!i&&!c)return{error:zt};const I=[];null===(u=c.drawDefinitions)||void 0===u||u.forEach((t=>{const e=sg({drawDefinition:t});I.push(...e)}));const w=(null==e?void 0:e.participants)||[];if(!n.every((t=>{const{participantType:e}=ia({tournamentParticipants:w,participantId:t});return!(e===Oa&&Kf(r))})))return{error:ci};const{flightProfile:S}=el({event:c}),b=null==S||null===(d=S.flights)||void 0===d?void 0:d.find((t=>t.drawId===o)),U=(t=[])=>{const e=t.filter((t=>!s||!t.entryStage||s===t.entryStage)).filter((({participantId:t})=>n.includes(t)));return e.every((t=>!(t=>I.includes(t.participantId)&&!(cu.includes(t.entryStatus)&&cu.includes(r)))(t)&&(t.entryStatus=r,delete t.entryPosition,!0)))?dt:{error:ii}},N=({flight:t,drawDefinition:e})=>{c.entries=Vf({entries:c.entries||[]}),t&&(t.drawEntries=Vf({entries:t.drawEntries})),e&&(e.entries=Vf({entries:e.entries}))},P=({flight:t,drawDefinition:e})=>{if(t){const e=U(t.drawEntries);if(e.error)return e}if(e){const t=U(e.entries);if(t.error)return t}return{...dt}},E=(null===(l=c.entries)||void 0===l?void 0:l.find((({entryPosition:t})=>!isNaN(t))))||(null==b||null===(p=b.drawEntries)||void 0===p?void 0:p.find((({entryPosition:t})=>!isNaN(t))))||(null==i||null===(h=i.entries)||void 0===h?void 0:h.find((({entryPosition:t})=>!isNaN(t))));if(t&&!E&&N({flight:b,drawDefinition:i}),b||i){const t=P({flight:b,drawDefinition:i});if(t.error)return t}const D=(null===(f=c.drawDefinitions)||void 0===f?void 0:f.map((({drawId:t})=>t)))||[],A=(null==S||null===(m=S.flights)||void 0===m?void 0:m.filter((t=>!D.includes(t.drawId))))||[];for(const x of A){const t=P({flight:x});if(t.error)return t}const T=1===(null==S||null===(g=S.flights)||void 0===g?void 0:g.length)&&(null===(v=c.drawDefinitions)||void 0===v?void 0:v.length)<=(null==S||null===(y=S.flights)||void 0===y?void 0:y.length);if(!b&&!i&&uu.includes(r))return{error:li};if(!b&&!i||r===au||a&&T){const t=U(c.entries);if(t.error)return t;let e;var C,M;if(r===au)null==S||null===(C=S.flights)||void 0===C||C.every((t=>{const i=U(t.drawEntries);return i.error?(e=i.error,!1):(t.drawEntries=t.drawEntries.filter((({participantId:t})=>!n.includes(t))),!0)})),null===(M=c.drawDefinitions)||void 0===M||M.every((t=>{const i=U(t.entries);return i.error?(e=i.error,!1):(t.entries=t.entries.filter((({participantId:t})=>!n.includes(t))),!0)}));if(e)return{error:e}}return t&&N({flight:b,drawDefinition:i}),dt}function ug(t){const{drawId:e,replaceWithBye:i,destroyPair:n,entryStatus:r,drawDefinition:a,matchUpsMap:o}=t,s=$d(t);if(s.error)return s;const{participantId:c}=s,{drawPosition:u,event:d,structureId:l}=t;if([Zc,au].includes(r)&&c){const{tournamentRecord:i}=t,{participant:o}=na({tournamentRecord:i,participantId:c}),{participantType:s,individualParticipantIds:u}=o||{};if(n&&s===Oa){const t=$f({tournamentRecord:i,drawDefinition:a,participantId:c,event:d});if(t.error)return t;cg({tournamentRecord:i,participantIds:u,entryStatus:r,drawDefinition:a,drawId:e,event:d})}else cg({tournamentRecord:i,participantIds:[c],entryStatus:r,drawDefinition:a,drawId:e,event:d})}if(i){const t=ul({drawDefinition:a,structureId:l,drawPosition:u,matchUpsMap:o});if(t.error)return t}const{structure:p}=jc({drawDefinition:a,structureId:l});Pl({structure:p,drawPositions:[u]});return El({drawDefinition:a,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:u,entryStatus:r,structureId:l}}),s}function dg({drawDefinition:t,drawPositions:e,structureId:i}){if(!t)return{error:yt};if(!i)return{error:Vt};if(2!==(null==e?void 0:e.length))return{error:_i,drawPositions:e};const n=Lc({drawDefinition:t}),{matchUps:r}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t}),{structure:a}=jc({drawDefinition:t,structureId:i});if(!a)return{error:Gt};let o;if(o=a.structureType===qo?function({drawDefinition:t,drawPositions:e,structure:i,matchUpsMap:n,inContextDrawMatchUps:r}){var a;const o=null===(a=i.structures)||void 0===a?void 0:a.reduce(((t,i)=>{const n=null==i?void 0:i.positionAssignments.filter((t=>e.includes(t.drawPosition)));return n&&t.push(...n),t}),[]);if(2===o.filter((({bye:t})=>t)).length)return{...dt};if(o.some((({bye:t})=>t)))lg({drawDefinition:t,assignments:o,structure:i,matchUpsMap:n,inContextDrawMatchUps:r});else{const t=o.map(Mc);o.forEach(((e,i)=>e.participantId=t[1-i]))}return{...dt}}({drawDefinition:t,structure:a,drawPositions:e,matchUpsMap:n,inContextDrawMatchUps:r}):function({drawDefinition:t,structure:e,drawPositions:i,matchUpsMap:n,inContextDrawMatchUps:r}){const a=null==e?void 0:e.positionAssignments.filter((t=>i.includes(t.drawPosition)));if(!a)return{error:_i,structure:e,message:"Missing positionAssignments"};if(2===a.filter((({bye:t})=>t)).length)return{...dt};return a.some((({bye:t})=>t))?lg({drawDefinition:t,structure:e,assignments:a,matchUpsMap:n,inContextDrawMatchUps:r}):function({structure:t,assignments:e}){const i=Object.assign({},...e.map(((t,i)=>{const{drawPosition:n}=t;return{[n]:{...e[1-i],drawPosition:n}}})));return t.positionAssignments=t.positionAssignments.map((t=>i[t.drawPosition]||t)),{...dt}}({structure:e,assignments:a,matchUpsMap:n,inContextDrawMatchUps:r})}({drawDefinition:t,structure:a,drawPositions:e,matchUpsMap:n,inContextDrawMatchUps:r}),o.error)return o;Pl({structure:a,drawPositions:e});return El({drawDefinition:t,positionAction:{name:"swapDrawPositionAssignments",drawPositions:e,structureId:i}}),Pc({drawDefinition:t,structureIds:[i]}),{...dt}}function lg({drawDefinition:t,structure:e,assignments:i,matchUpsMap:n,inContextDrawMatchUps:r}){const a=i.find((({bye:t})=>t)),o=i.find((({participantId:t})=>t)),s=a.drawPosition,{participantId:c,drawPosition:u}=o,{structureId:d}=e;let l=ug({drawDefinition:t,structureId:d,drawPosition:s,matchUpsMap:n,inContextDrawMatchUps:r});return l.error?l:(l=ug({drawDefinition:t,structureId:d,drawPosition:u,matchUpsMap:n,inContextDrawMatchUps:r}),l.error?l:(l=ul({drawDefinition:t,structureId:d,drawPosition:u,matchUpsMap:n,inContextDrawMatchUps:r}),l=Rl({drawDefinition:t,structureId:d,drawPosition:s,participantId:c,matchUpsMap:n,inContextDrawMatchUps:r}),l.error?l:{...dt}))}function pg(t){const{participantIdAttributeName:e="participantId",positionActionName:i,drawDefinition:n,participantId:r,drawPosition:a,structureId:o}=t;if(!n)return{error:yt};let{inContextDrawMatchUps:s,matchUpsMap:c}=t;c||(c=Lc({drawDefinition:n}),Object.assign(t,{matchUpsMap:c})),s||(({matchUps:s}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:c})),Object.assign(t,{inContextDrawMatchUps:s}));const{positionAssignments:u}=Eu({drawDefinition:n,structureId:o}),d=u.find((t=>t.drawPosition===a));if(null!=d&&d.participantId){let t=Rl({inContextDrawMatchUps:s,drawDefinition:n,participantId:r,drawPosition:a,structureId:o,matchUpsMap:c});return t.success||console.log({result:t}),h({removedParticipantId:d.participantId})}let l=$d({inContextDrawMatchUps:s,drawDefinition:n,drawPosition:a,structureId:o,matchUpsMap:c});if(l.error)return l;const p=l.participantId;return l=Rl({inContextDrawMatchUps:s,drawDefinition:n,participantId:r,drawPosition:a,structureId:o,matchUpsMap:c}),l.success?h({removedParticipantId:p}):l;function h({removedParticipantId:t}){const{structure:s}=jc({drawDefinition:n,structureId:o});Pl({drawPositions:[a],structure:s});return El({drawDefinition:n,positionAction:{[e]:r,name:i,drawPosition:a,structureId:o}}),{...dt,removedParticipantId:t}}}function hg({alternateParticipantId:t,drawDefinition:e,drawPosition:i,structureId:n}){return pg({participantId:t,drawDefinition:e,drawPosition:i,structureId:n,participantIdAttributeName:"alternateParticipantid",positionActionName:"alternateDrawPositionAssignment"})}function fg({drawDefinition:t,structureId:e}){const{structure:i,error:n}=jc({drawDefinition:t,structureId:e});if(n)return{error:n};const{matchUps:r}=Ru({structure:i});return Oc({matchUps:r})}function mg({drawDefinition:t,structureId:e,finishingPositions:i}){const{roundProfile:n}=fg({drawDefinition:t,structureId:e});return Object.keys(n).reduce(((t,e)=>(gg(n[e]).forEach((n=>{i.forEach((i=>{(function({position:t,rangeDefinition:e}){if(!Array.isArray(e))return!1;if(e.reduce(((t,e)=>t||isNaN(e)),!1))return!1;const[i,n]=e;return rt(i,(n||i)+1).includes(t)})({position:i,rangeDefinition:n})&&(t[i]={roundNumber:e})}))})),t)),{})}function gg(t){var e,i;return[X((null==t||null===(e=t.finishingPositionRange)||void 0===e?void 0:e.loser)||[]),X((null==t||null===(i=t.finishingPositionRange)||void 0===i?void 0:i.winner)||[])]}function vg({drawDefinition:t}){if(!t)return{error:yt};return{positionsPlayedOff:(t.structures||[]).filter((t=>t.structureType!==Lo)).map((({structureId:e})=>{const{roundProfile:i}=fg({drawDefinition:t,structureId:e});return Object.values(i).map(gg).flat()})).flat().filter((t=>1===t.length)).sort(Wn).flat()}}function yg({drawDefinition:t,structureId:e,playoffPositions:i=[],excludeRoundNumbers:n=[]}){if(!t)return{error:yt};if(!e)return{error:Vt};if(!i)return{error:Ae,message:"missing playoffPositions"};const{positionsPlayedOff:r,error:a}=vg({drawDefinition:t});if(a)return{error:a};const o=mg({drawDefinition:t,structureId:e,finishingPositions:i.filter((t=>!r.includes(t)))}),s=Object.values(o).reduce(((t,e)=>t.includes(e.roundNumber)?t:t.concat(e.roundNumber)),[]).map((t=>parseInt(t))).filter((t=>!n.includes(parseInt(t)))),c=mg({drawDefinition:t,structureId:e,finishingPositions:r}),u=Object.values(c).reduce(((t,e)=>t.includes(e.roundNumber)?t:t.concat(e.roundNumber)),[]).map((t=>parseInt(t))),d=s.filter((t=>!u.includes(t))).sort(Wn),{roundProfile:l}=fg({drawDefinition:t,structureId:e}),p=d.map((t=>{const e=l[t].finishingPositionRange.loser,[i,n]=e;return rt(i,(n||i)+1)})).flat().sort(Wn),h=d.map((t=>{const e=l[t].finishingPositionRange.loser,[i,n]=e;return{roundNumber:t,finishingPositions:rt(i,(n||i)+1),finishingPositionRange:e.join("-")}}));return{sourceRounds:[...d,...u],playoffRoundsRanges:h,playoffSourceRounds:d,playedOffSourceRounds:u,playoffPositionsReturned:p}}function Ig({drawDefinition:t,structureId:e}){if(!t)return{error:yt};let{structures:i}=Bc({drawDefinition:t,stage:Oo,stageSeqence:1});const n=i&&i[0];if(!n)return{error:Gt};const r=n.positionAssignments||[],a=null==r?void 0:r.map((t=>t.drawPosition)),{positionsPlayedOff:o}=vg({drawDefinition:t}),s=a.filter((t=>!o.includes(t)));({structures:i}=Bc({drawDefinition:t}));const c=i.filter((t=>!e||t.structureId===e)),u={};for(const d of c){const e=null==d?void 0:d.structureId,{playoffSourceRounds:i,playoffRoundsRanges:n,error:r}=wg({drawDefinition:t,playoffPositions:s,structureId:e});if(r)return{error:r};u[e]={structureId:e,playoffRounds:i,playoffRoundsRanges:n}}return e?{positionsPlayedOff:o,...u[e]}:{positionsPlayedOff:o,availablePlayoffRounds:Object.values(u)}}function wg({drawDefinition:t,playoffPositions:e,structureId:i}){var n;const{structure:r}=jc({drawDefinition:t,structureId:i});if(!r)return{error:Gt};if(r.structureType===qo)return{playoffSourceRounds:[],playoffRoundsRanges:[]};const{links:a}=ed({drawDefinition:t,structureId:i});return yg({drawDefinition:t,structureId:i,playoffPositions:e,excludeRoundNumbers:(null==a||null===(n=a.source)||void 0===n?void 0:n.filter((t=>t.linkCondition!==Qo)).map((t=>{var e;return null===(e=t.source)||void 0===e?void 0:e.roundNumber})))||[]})}function Sg(t){var e;const{playoffRoundsRanges:i,playoffRounds:n,error:r}=Ig(t);if(r)return{error:r};const{playoffSourceRounds:a,playoffRoundsRanges:o,playoffPositionsReturned:s,error:c}=yg(t);if(c)return{error:c};const{structureId:u,playoffStructureNameBase:d,playoffAttributes:l,playoffPositions:p,exitProfileLimit:h,drawDefinition:f,roundProfiles:m,roundNumbers:g,idPrefix:v,event:y,uuids:I}=t,w=(null==m?void 0:m.length)&&Object.assign({},...m),S=g||"object"==typeof m&&m.map((t=>Object.keys(t))).flat(),b=S&&S.map((t=>!isNaN(t)&&parseInt(t))).filter(Boolean);if(b){if(!Array.isArray(b))return{error:_i,validRoundNumbers:b};b.forEach((t=>{if(!n.includes(t))return{error:_i,roundNumber:t}}))}p&&p.forEach((t=>{if(!s.includes(t))return{error:_i,playoffPosition:t}}));const{structure:U}=jc({structureId:u,drawDefinition:f}),N=b||a,P=b?i:o,E=[],D=[];for(const x of N){const t=P.find((t=>t.roundNumber===x));if(!t)return{error:_i,message:{roundNumber:x}};const e=t.finishingPositions.length,i=Math.min(...t.finishingPositions)-1,n=2,r=w&&w[x]&&n+w[x]-1,{structure:a}=Wm({exitProfile:`0-${x}`,playoffStructureNameBase:d,finishingPositionOffset:i,playoffAttributes:l,exitProfileLimit:h,stage:jo,drawDefinition:f,roundOffset:0,sequenceLimit:r,stageSequence:n,drawSize:e,idPrefix:v,uuids:I});if(a){D.push(a.structureId);const t={linkType:Xo,source:{structureId:u,roundNumber:x},target:{structureId:a.structureId,feedProfile:Yo,roundNumber:1}};E.push(t)}}f.links=(f.links||[]).concat(...E);const{matchUps:A,matchUpsMap:T}=sd({includeByeMatchUps:!0,inContext:!0,drawDefinition:f}),C=A.filter((({structureId:t})=>D.includes(t))).map(Rc),M=null==T||null===(e=T.drawMatchUps)||void 0===e?void 0:e.filter((({matchUpId:t})=>C.includes(t)));if(M.length){const t=f.tieFormat||(null==y?void 0:y.tieFormat);t&&M.forEach((e=>{const{tieMatchUps:i}=Gm({tieFormat:t});Object.assign(e,{tieMatchUps:i,matchUpType:la})}))}return A.filter((t=>Yn(t)&&t.structureId===u)).forEach((t=>{const{matchUpId:e,score:i,winningSide:n}=t,r=id({inContextDrawMatchUps:A,drawDefinition:f,matchUpId:e,structure:U}),a=Ol({inContextDrawMatchUps:A,drawDefinition:f,matchUpsMap:T,winningSide:n,targetData:r,matchUpId:e,structure:U,matchUp:t,score:i});a.error&&console.log(a.error)})),t.goesTo&&Sd({inContextDrawMatchUps:A,drawDefinition:f,matchUpsMap:T}),Pc({drawDefinition:f,structureIds:D}),{...dt}}function bg({playoffStructureNameBase:t,playoffAttributes:e,playoffPositions:i,exitProfileLimit:n,tournamentRecord:r,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l}){if(!r)return{error:ft};const p=Sg({playoffStructureNameBase:t,playoffAttributes:e,playoffPositions:i,exitProfileLimit:n,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l});return nc({tournamentRecord:r,timeItem:{itemType:"addPlayoffStructures",itemValue:{playoffStructureNameBase:t,playoffPositions:i,roundNumbers:s,structureId:c}}}),p}function Ug({validation:t=!0,drawDefinition:e,participantId:i,structureId:n,seedValue:r}){if(!e)return{error:yt};if(!n)return{error:Vt};const{structure:a}=jc({drawDefinition:e,structureId:n});if(!a)return{error:Gt};if(!(!t||z(r)||"string"==typeof r&&r.split("-").every(z)))return{error:_i};const{seedAssignments:o}=Uu({drawDefinition:e,structure:a}),s=o.map((t=>t.seedNumber)),c=o.find((t=>t.participantId===i));if(c)c.seedValue=r;else{const t=Math.max(0,...s)+1;a.seedAssignments.push({seedNumber:t,seedValue:r,participantId:i})}return Pc({drawDefinition:e,structureIds:[n]}),dt}function Ng({tournamentRecord:t,drawDefinition:e,event:i,structureId:n,drawPosition:r,subOrder:a}){if(!e)return{error:yt};if(!n)return{error:Vt};if(!r)return{error:Tt};const{structure:o}=jc({drawDefinition:e,structureId:n});let s=o;o.structureType===qo&&(s=o.structures.find((t=>t.positionAssignments.find((t=>t.drawPosition===r)))));const c=s.positionAssignments;let u=Gc({element:c.find((t=>t.drawPosition===r)),extension:{name:Jr,value:a}});if(u.error)return u;const{matchUps:d}=Ru({structure:s,inContext:!0});return u=tl({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:(null==o?void 0:o.matchUpFormat)||e.matchUpFormat,matchUps:d,event:i}),u.error?u:(Pc({drawDefinition:e,structureIds:[n]}),{...dt})}function Pg({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:yt};if(!i)return{error:le};const{matchUp:n}=ku({drawDefinition:t,event:e,matchUpId:i});return n?Hc({element:n,name:_r}):{error:he}}function Eg({scaledEntries:t,seedsCount:e,scaleAttributes:i,scaleName:n,stageEntries:r}){if(!i)return{error:Ae};const a=Object.assign({},...(t||[]).slice(0,e).map((({participantId:t},e)=>({[t]:e+1}))));n=n||i.scaleName;const o=(new Date).toISOString();return{scaleItemsWithParticipantIds:r.map((({participantId:t})=>({participantId:t,scaleItems:[{scaleValue:a[t],eventType:i.eventType,scaleType:pf,scaleName:n,scaleDate:o}]})))}}function Dg({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:yt};if(!n&&!e)return{error:me};if(!i)return{error:Ae};if(!n){const{error:i,matchUp:r}=ku({drawDefinition:t,matchUpId:e});if(i)return{error:i};n=r}if("object"!=typeof i||null===(r=i.score)||void 0===r||!r.scoreStringSide1||null===(a=i.score)||void 0===a||!a.scoreStringSide2)return{error:_i};return Gc({element:n,extension:{name:_r,value:i}})}function Ag({tournamentRecord:t,drawDefinition:e,scaleAttributes:i,drawId:n,event:r,stage:a}){if(!r)return{error:zt};let o=r.entries;if(n){var s;const{flightProfile:t}=el({event:r}),i=null==t||null===(s=t.flights)||void 0===s?void 0:s.find((t=>t.drawId===n));o=i?i.drawEntries:null==e?void 0:e.entries}return function({tournamentRecord:t,participantIds:e,scaleAttributes:i}){var n;if(!t)return{error:ft};if(!e)return{error:Xe};if(!i)return{error:Ae,message:"scaleAttributes required"};const{scaleType:r,eventType:a,scaleName:o}=i,s=[Sr,r,a,o].join(".");return null===(n=t.participants)||void 0===n||n.forEach((t=>{e.includes(t.participantId)&&t.timeItems&&(t.timeItems=t.timeItems.filter((t=>t&&(null==t?void 0:t.itemType)!==s)))})),dt}({tournamentRecord:t,participantIds:(o||[]).filter((t=>(!a||!t.entryStage||t.entryStage===a)&&du.includes(t.entryStatus))).map(Mc),scaleAttributes:i})}function Tg({drawDefinition:t,structureId:e}){var i;if(!t)return{error:yt};if(!e)return{error:Vt};const n=[],r=[e],a=e=>{var i;return null===(i=t.links)||void 0===i?void 0:i.map((t=>t.source.structureId===e&&t.target.structureId)).filter(Boolean)},o=(null===(i=t.structures)||void 0===i?void 0:i.map((({structureId:t})=>t)))||[],s=Object.assign({},...o.map((t=>({[t]:a(t)}))));for(;r.length;){var c;const e=r.pop(),{structure:i}=jc({drawDefinition:t,structureId:e}),{matchUps:a}=Ru({structure:i}),o=Tc(a);n.push(...o),t.links=(null===(c=t.links)||void 0===c?void 0:c.filter((t=>t.source.structureId!==e&&t.target.structureId!==e)))||[],t.structures=(t.structures||[]).filter((t=>t.structureId!==e));const u=s[e];null!=u&&u.length&&r.push(...u)}const{matchUps:u}=sd({drawDefinition:t});return u.forEach((t=>{n.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,n.includes(t.loserMatchUpId)&&delete t.loserMatchUpId})),bc({drawDefinition:t,matchUpIds:n,action:"removeStructure"}),Pc({drawDefinition:t}),{...dt,removedMatchUpIds:n}}function Cg({drawDefinition:t,participants:e,matchUpType:i,event:n,structureName:r=Fo,structureAbbreviation:a,structureId:o,automated:s}){const c=Fo;if(!t)return{error:yt};i=i||t.matchUpType;const u=gu({stage:c,drawDefinition:t}),{matchUps:d}=Mm({matchUpType:i,drawSize:u}),l=_m({stage:c,matchUps:d,matchUpType:i,structureName:r,structureAbbreviation:a,structureId:o});return t.structures.push(l),s&&Sm({structureId:o||l.structureId,drawDefinition:t,participants:e,event:n}),Pc({drawDefinition:t,structureIds:[o]}),{...dt}}function Mg({drawDefinition:t,structureId:e,matchUps:i}){var n;if("object"!=typeof t)return{error:yt};if("string"!=typeof e)return{error:Vt};if(!Array.isArray(i))return{error:_i};const r=null===(n=t.structures)||void 0===n?void 0:n.find((t=>t.structureId===e));if(!r)return{error:Gt};const a=(null==r?void 0:r.matchUps).find((t=>!!t.roundPosition));if(r.structures||a||r.finishingPosition===Ps)return{error:St};const o=(r.matchUps||[]).map((({drawPositions:t})=>t)).flat().sort(((t,e)=>t-e)),s=Math.max(...o,0)+1,c=rt(s,s+2*i.length),u=ct(c,2);i.forEach(((t,e)=>t.drawPositions=u[e])),r.matchUps.push(...i);const d=c.map((t=>({drawPosition:t})));return r.positionAssignments||(r.positionAssignments=[]),r.positionAssignments.push(...d),Sc({drawDefinition:t,matchUps:i}),Pc({drawDefinition:t,structureIds:[e]}),{...dt}}function xg({drawDefinition:t,structureId:e,addMatchUps:i=!1,matchUpsCount:n=1,matchUpIds:r=[],roundNumber:a,newRound:o}){var s;if("object"!=typeof t)return{error:yt};if("string"!=typeof e)return{error:Vt};if(!J(n)||!Array.isArray(r))return{error:_i};const c=null==t||null===(s=t.structures)||void 0===s?void 0:s.find((t=>t.structureId===e));let u;const d=(null==c?void 0:c.matchUps).reduce(((t,e)=>(e.roundPosition&&(u=!0),e.roundNumber>t?e.roundNumber:t)),0);if(c.structures||u||c.finishingPosition===Ps)return{error:St};if(a&&a-1>d)return{error:_i};const l=a||(o?d+1:d||1),p=rt(0,n).map((()=>({matchUpId:r.pop()||qn(),roundNumber:l,matchUpStatus:x,drawPositions:[]})));if(i){const i=Mg({drawDefinition:t,structureId:e,matchUps:p});if(i.error)return i}return{matchUps:p,...dt}}function Rg({deleteExisting:t,event:e,flightProfile:i}){var n;if(!i)return{error:Ae};if(!e)return{error:zt};const{flightProfile:r}=el({event:e});if(r&&Rg&&!t)return{error:qi};if(null!==(n=e.drawDefinitions)&&void 0!==n&&n.length)return{error:It};return zc({event:e,extension:{name:Br,value:i}}),{flightProfile:Vn(i,!1,!0),...dt}}const kg="splitWaterfall",Og="splitShuttle",Lg={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:kg,SPLIT_SHUTTLE:Og};function _g({event:t,drawId:e,drawDefinition:i,drawName:n}){var r;if(!n||"string"!=typeof n)return{error:_i,drawName:n};const{flightProfile:a}=el({event:t}),o=null==a||null===(r=a.flights)||void 0===r?void 0:r.find((t=>t.drawId===e));if(o){o.drawName=n;zc({event:t,extension:{name:Br,value:{...a,flights:a.flights}}})}return i&&(i.drawName=n),o||i?dt:{error:yt}}function Fg({drawDefinition:t,drawSize:e}){if(!t)return{error:yt};const i=$m({drawDefinition:t,stage:Fo,drawSize:e});return i.error?i:(_g({drawDefinition:t}),dt)}function jg({drawDefinition:t,structureId:e,matchUpIds:i=[]}){var n;if("object"!=typeof t)return{error:yt};if("string"!=typeof e)return{error:Vt};if(!Array.isArray(i))return{error:_i};const r=null===(n=t.structures)||void 0===n?void 0:n.find((t=>t.structureId===e));if(!r)return{error:Gt};const a=null==r?void 0:r.matchUps,o=a.find((t=>!!t.roundPosition));if(r.structures||o||r.finishingPosition===Ps)return{error:St};const s=a.filter((({matchUpId:t})=>i.includes(t))),c=Tc(s),u=s.map((({drawPositions:t})=>t)).flat();if(u.length){r.positionAssignments=r.positionAssignments.filter((({drawPosition:t})=>!u.includes(t))).sort(((t,e)=>t.drawPosition-e.drawPosition)),r.matchUps=r.matchUps.filter((({matchUpId:t})=>!c.includes(t)));const i=Object.assign({},...r.positionAssignments.map((({drawPosition:t},e)=>({[t]:e+1}))));r.positionAssignments=r.positionAssignments.map((t=>({...t,drawPosition:i[t.drawPosition]})));const n=t=>t.drawPositions=t.drawPositions.map((t=>i[t]));r.matchUps.forEach(n),bc({drawDefinition:t,matchUpIds:c,action:"deleteAdHocMatchUps"}),Pc({drawDefinition:t,structureIds:[e]})}return{...dt}}function Bg({rankedPairings:t,rankedMatchUpValues:e,stipulated:i=[],deltaObjects:n}){let r=0,a=[],o=[].concat(...i);i.filter(Boolean).forEach((t=>{const i=Vg(...t),n=e[i];a.push({participantIds:t,value:n}),r+=e[i]})),t.forEach((t=>{const e=t.pairing.split("|");if(!e.reduce(((t,e)=>o.indexOf(e)>=0||t),!1)){o=o.concat(...e);let i=t.value;r+=i,a.push({participantIds:e,value:i})}})),a.sort(((t,e)=>t.value-e.value));const s=a.reduce(((t,e)=>{const i=Vg(...e.participantIds),r=n[i];return r>t?r:t}),0);return{value:r,participantIdPairings:a,maxDelta:s}}function Vg(t,e){return[t,e].sort().join("|")}function Gg({tournamentParticipants:t,drawDefinition:e,participantIds:i,adHocRatings:n,structureId:r,matchUpIds:a,eventType:o,structure:s}){const{positionAssignments:c}=Eu({structure:s}),{encounters:u}=function({matchUps:t,positionAssignments:e}){let i=[];for(const n of t){const t=e.filter((({drawPosition:t})=>n.drawPositions.includes(t))).map(Mc).filter(Boolean);if(2===t.length){const e=Wg(...t);i.includes(e)||i.push(e)}}return{encounters:i}}({matchUps:s.matchUps,positionAssignments:c}),d={};for(const I of u)d[I]||(d[I]=0),d[I]+=50;const l=null==t?void 0:t.filter((({participantType:t})=>t===ka));if(l)for(const I of l){const t=I.individualParticipantIds,{uniquePairings:e}=Hg({participantIds:t});for(const i of e)d[i]||(d[i]=0),d[i]+=60}const{uniquePairings:p,possiblePairings:h,deltaObjects:f}=Hg({participantIds:i}),m=xg({newRound:!0,drawDefinition:e,matchUpsCount:Math.floor(i.length/2),structureId:r,matchUpIds:a,addMatchUps:!0});if(m.error)return m;const g=m.matchUps,v={drawDefinition:e,participantIds:i,possiblePairings:h,uniquePairings:p,adHocRatings:n,deltaObjects:f,valueObjects:d,structure:s},{participantIdPairings:y}=o===Da?function({roundMatchUps:t}){return{matchUps:t}}(v):function({deltaObjects:t,valueObjects:e,adHocRatings:i={},uniquePairings:n,possiblePairings:r}){n.forEach((n=>{const r=n.split("|").map((t=>i[t]||0)),a=Math.abs(r[0]-r[1])+1;t[n]=Math.abs(r[0]-r[1]),e[n]||(e[n]=0),e[n]+=Math.pow(a,2)}));const a=n.map((t=>({pairing:t,value:e[t]}))).sort(((t,e)=>t.value-e.value)),{pairingValues:o}=function({possiblePairings:t,valueObjects:e}){let i={};for(const r of Object.keys(t)){let e=t[r].map((t=>n(r,t)));i[r]=e.sort(((t,e)=>t.value-e.value))}function n(t,i){let n=Wg(t,i);return{opponent:i,value:e[n]}}return{pairingValues:i}}({possiblePairings:r,valueObjects:e}),{participantIdPairings:s}=function({rankedPairings:t,pairingValues:e,deltaObjects:i,candidateGoal:n=2e3,actorDivisor:r=100}){const a=Object.assign({},...t.map((t=>({[t.matchUp]:t.value}))));let o=Bg({rankedPairings:t,rankedMatchUpValues:a,deltaObjects:i}),s=o;const c=Object.keys(e),u=n/(c.length/r);let d=Math.floor(u/c.length);return d>n&&(d=n),c.forEach((n=>{e[n].slice(0,d).forEach((e=>{const n=Bg({rankedPairings:t,rankedMatchUpValues:a,stipulated:[e.participantIds],deltaObjects:i});n.maxDelta<s.maxDelta&&(s=n),n.value<o.value&&(o=n)}))})),o}({rankedPairings:a,pairingValues:o,deltaObjects:t,candidateGoal:2e3,actorDivisor:100});return{participantIdPairings:s}}(v);for(const[I,w]of g.entries()){const t=w.drawPositions,{participantIds:i}=y[I];for(const n of t.keys()){const a=Rl({drawDefinition:e,structureId:r,participantId:i[n],drawPosition:t[n]});if(a.error)return a}}return{...dt}}function Hg({participantIds:t}){const e={},i=[];t.forEach((n=>{e[n]=t.filter((t=>t!==n)),e[n].forEach((t=>{const e=Wg(t,n);i.includes(e)||i.push(e)}))}));const n=Object.assign({},...i.map((t=>({[t]:0}))));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function Wg(t,e){return[t,e].sort().join("|")}function qg({tournamentParticipants:t,restrictEntryStatus:e,drawDefinition:i,participantIds:n,structureId:r,matchUpIds:a,scaleName:o,eventType:s}){var c;if("object"!=typeof i)return{error:vt};const u=i.entries.filter((({entryStatus:t})=>!e||[eu,ru,tu].includes(t))).map(Mc);if(n){const t=!!n.find((t=>u.includes(t)));if(t)return{error:Ge,participantId:t}}else n=u;const d=t=>!(null!=t&&t.structures||null!=t&&t.matchUps.find((({roundPosition:t})=>!!t)));if(!r){var l;const t=null===(l=i.structures)||void 0===l?void 0:l.find((t=>1===t.stageSequence)).recuce(((t,e)=>{const i=Vo[e.stage];return d(e)&&i>Vo[t.stage]?e:t}),void 0);r=null==t?void 0:t.structureId}const p=null===(c=i.structures)||void 0===c?void 0:c.find((t=>t.structureId===r));if(!p)return{error:Gt};if(!d(p))return{error:vt};const h={};for(const m of n){const e=null==t?void 0:t.find((t=>t.participantId===m));let i=zg({eventType:s,participant:e});!i&&o&&(i=zg({scaleValue:i,eventType:s,participant:e})),i&&(h[m]=i)}const{matchUps:f}=Gg({tournamentParticipants:t,drawDefinition:i,participantIds:n,adHocRatings:h,matchUpIds:a,structureId:r,structure:p,eventType:s});return{...dt,matchUps:f}}function zg({scaleName:t="dynamic",eventType:e,participant:i}){var n;const r=i&&ff({participant:i,scaleAttributes:{scaleType:df,eventType:e||Ea,scaleName:t}});return null==r||null===(n=r.scaleItem)||void 0===n?void 0:n.scaleValue}function Kg({qualifyingPositions:t,drawEntries:e=[],matchUpValue:i,drawName:n,drawId:r,event:a,stage:o}){var s,c;if(!a)return{error:zt};if(!n)return{error:Ae};if(null!=e&&e.length){const t=Cc(a.entries||[]),i=Cc(e);if(ot(i,t).length!==i.length)return{error:_i}}const{flightProfile:u}=el({event:a}),d=(null==u||null===(s=u.flights)||void 0===s||null===(c=s.map((({flightNumber:t})=>!isNaN(t)&&parseInt(t))))||void 0===c?void 0:c.filter(Boolean))||[],l=Math.max(0,...d)+1,p={drawId:r||qn(),flightNumber:l,matchUpValue:i,drawEntries:e,drawName:n};o&&(p.stage=o),t&&(p.qualifyingPositions=t);if(((null==u?void 0:u.flights)||[]).find((({drawId:t})=>t===p.drawId)))return{error:Wi};const h=((null==u?void 0:u.flights)||[]).concat(p);return zc({event:a,extension:{name:Br,value:{...u||{},flights:h}}})}function Yg({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:ft};if(!e)return{error:zt};if(!gn.test(i))return{error:ke};const{tournamentStartDate:n,tournamentEndDate:r,error:a}=$g(t);if(a)return{error:a};const o=new Date(Mn(i));if(o<n||o>r)return{error:ke};const s=e.endDate&&new Date(Mn(e.endDate));return s&&o>s&&(e.endDate=i),e.startDate=i,dt}function Jg({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:ft};if(!e)return{error:zt};if(!gn.test(i))return{error:ke};const{tournamentStartDate:n,tournamentEndDate:r,error:a}=$g(t);if(a)return{error:a};const o=new Date(Mn(i));if(o<n||o>r)return{error:ke};const s=e.startDate&&new Date(Mn(e.startDate));return s&&o<s&&(e.startDate=i),e.endDate=i,dt}function $g(t){const{startDate:e,endDate:i}=t;return gn.test(e)&&gn.test(i)?{tournamentStartDate:new Date(Mn(e)),tournamentEndDate:new Date(Mn(i))}:{error:Le}}const Zg={addEvent:_f,deleteEvents:function({tournamentRecord:t,eventIds:e}){if(!t)return{error:ft};if(!t.events)return{error:Kt};if(!Array.isArray(e))return{error:Ae};const i=[],n=[];if(t.events=(t.events||[]).filter((t=>{if(e.includes(t.eventId)){const e={action:Ff,payload:{events:[t]}};i.push(e),n.push({eventName:t.eventName,eventType:t.eventType,category:t.category,eventId:t.eventId,gender:t.gender})}return!e.includes(t.eventId)})),Kl({tournamentRecord:t}),i.length){en({topic:uc,payload:i});nc({tournamentRecord:t,timeItem:{itemType:Ff,itemValue:n}})}return dt},setEventDates:function({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:ft};if(!e)return{error:zt};if(!i&&!n)return{error:Ae};if(i&&!gn.test(i))return{error:ke};if(n&&!gn.test(n))return{error:ke};if(i&&n){if(new Date(Mn(i))>new Date(Mn(n)))return{error:_i}}if(i){const{error:n}=Yg({tournamentRecord:t,event:e,startDate:i});if(n)return{error:n}}if(n){const{error:i}=Jg({tournamentRecord:t,event:e,endDate:n});if(i)return{error:i}}return dt},setEventStartDate:Yg,setEventEndDate:Jg,autoSeeding:function({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:c,sortDescending:u,scaleSortMethod:d}){const{error:l,entries:p,seedsCount:h,stageEntries:f}=Of({drawDefinition:e,drawId:o,event:s,policyDefinitions:i,drawSize:a,stage:c});if(l)return{error:l};const{scaledEntries:m}=Qm({scaleAttributes:n,tournamentRecord:t,scaleSortMethod:d,sortDescending:u,entries:p,stage:c}),{scaleItemsWithParticipantIds:g}=Eg({scaledEntries:m,seedsCount:h,scaleAttributes:n,scaleName:r,stageEntries:f});return{scaleItemsWithParticipantIds:g}},removeSeeding:function({tournamentRecord:t,drawDefinition:e,scaleName:i,drawId:n,event:r,stage:a}){var o,s;return t?r?(i=i||(null===(o=r.category)||void 0===o?void 0:o.categoryName)||(null===(s=r.category)||void 0===s?void 0:s.ageCategoryCode),Ag({tournamentRecord:t,scaleAttributes:{eventType:r.eventType,scaleType:pf,scaleName:i},drawDefinition:e,drawId:n,event:r,stage:a})):{error:zt}:{error:ft}},removeScaleValues:Ag,addDrawEntries:qf,checkValidEntries:Xf,modifyDrawName:_g,addDrawDefinition:ap,addPlayoffStructures:bg,deleteDrawDefinitions:Tm,getAvailablePlayoffRounds:function({drawDefinition:t,structureId:e}){return Ig({drawDefinition:t,structureId:e})},removeStructure:Tg,generateSeedingScaleItems:Eg,setSubOrder:Ng,addEventEntries:Jf,promoteAlternate:function({tournamentRecord:t,drawDefinition:e,event:i,participantId:n,stage:r=Oo,stageSequence:a}){if(!t)return{error:ft};if(!i)return{error:zt};if(i){const t=Zf({element:i,participantId:n,stageSequence:a,stage:r});if(t.error)return t}if(e){const t=Zf({element:e,participantId:n,stageSequence:a,stage:r});if(t.error)return t}return dt},destroyPairEntry:$f,setEntryPosition:og,setEntryPositions:function({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:ft};if(!Array.isArray(e))return{error:_i};for(const r of e){const{participantId:e,entryPosition:a}=r,o=og({tournamentRecord:t,drawDefinition:i,participantId:e,entryPosition:a,event:n});if(o.error)return o}return{...dt}},addEventEntryPairs:function({event:t,uuids:e,drawDefinition:i,tournamentRecord:n,entryStage:r=Oo,entryStatus:a=Zc,participantIdPairs:o=[],allowDuplicateParticipantIdPairs:s}){if(!n)return{error:ft};if(!t)return{error:zt};if(t.eventType!==da)return{error:qt};const c=n.participants||[],u=c.filter((t=>t.participantType===Ra)).map((t=>t.participantId)),d=u.filter((t=>!u.includes(t)));if(d.length)return{error:He,invalidParticipantIds:d};const l=o.filter((t=>2!==t.length));if(l.length)return{error:He,invalidParticipantIdPairs:l};const p=c.filter((t=>t.participantType===Oa)).map((t=>t.individualParticipantIds)),h=o.map((t=>({participantId:(null==e?void 0:e.pop())||qn(),participantType:Oa,participantRole:Ih,individualParticipantIds:t}))),f=s?h:h.filter((t=>!p.find((e=>2===ot(e,t.individualParticipantIds).length))));let m,g=[];if(f){const t=cp({tournamentRecord:n,participants:f,allowDuplicateParticipantIdPairs:s});if(t.error)return t;g=t.participants||[],m=t.message}const v=o.map((t=>{const e=g.find((e=>2===ot(e.individualParticipantIds,t).length));if(e)return e;const{participant:i}=Ec({tournamentRecord:n,participantIds:t});return i})).map((t=>t.participantId)),y=Jf({event:t,entryStage:r,entryStatus:a,drawDefinition:i,tournamentRecord:n,participantIds:v});return f.length&&en({topic:sc,participants:f}),{...y,message:m,newParticipantIds:f.map(Mc)}},removeEventEntries:Yf,removeDrawEntries:function({participantIds:t,drawDefinition:e,drawId:i,event:n,autoEntryPositions:r=!0}){var a;if(!n)return{error:zt};if(!i)return{error:xt};if(!t||!t.length)return{error:Xe};const o=sg({drawDefinition:e});if(st(t,o))return{error:ri};const s=e=>{const i=e.participantId;return!t.includes(i)},{flightProfile:c}=el({event:n}),u=null==c||null===(a=c.flights)||void 0===a?void 0:a.find((t=>t.drawId===i));return null!=u&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),r&&(u.drawEntries=Vf({entries:u.drawEntries}))),null!=e&&e.entries&&(e.entries=e.entries.filter(s),r&&(e.entries=Vf({entries:e.entries}))),dt},modifyEventEntries:function({event:t,tournamentRecord:e,entryStage:i=Oo,participantIdPairs:n=[],unpairedParticipantIds:r=[],entryStatus:a=eu}){if(!e)return{error:ft};if(!t)return{error:zt};const o=e.participants||[],s=o.filter((t=>t.participantType===Ra)).map((t=>t.participantId)),c=r.concat(...n).flat(1/0).filter((t=>!s.includes(t)));if(c.length)return{error:He,invalidParticipantIds:c};const u=n.filter((t=>2!==t.length));if(u.length)return{error:He,invalidParticipantIdPairs:u};const d=o.filter((t=>t.participantType===Oa)).map((t=>t.individualParticipantIds)),l=n.filter((t=>!d.find((e=>2===ot(e,t).length)))).map((t=>({participantType:Oa,participantRole:Ih,individualParticipantIds:t}))),p=cp({tournamentRecord:e,participants:l});if(p.error)return p;const h=n.map((t=>{const{participant:i}=Ec({tournamentRecord:e,participantIds:t});return i})).map((t=>({participantId:t,entryStatus:a,entryStage:i}))),f=r.map((t=>({entryStatus:su,participantId:t,entryStage:i})));return t.entries=(t.entries||[]).filter((t=>t.entryStage===i)),t.entries=t.entries.concat(...h,...f),dt},modifyEntriesStatus:cg,modifySeedAssignment:function({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n,seedValue:r}){return t?(t.participants||[]).find((t=>t.participantId===i))?Ug({drawDefinition:e,participantId:i,structureId:n,seedValue:r}):{error:Ge}:{error:ft}},deleteFlightProfileAndFlightDraws:function({tournamentRecord:t,event:e}){if(!t)return{error:ft};if(!e)return{error:zt};const{flightProfile:i}=el({event:e});if(i){var n;const r=null===(n=i.flights)||void 0===n?void 0:n.map((({drawId:t})=>t)).filter(Boolean),a=Tm({tournamentRecord:t,eventId:e.eventId,drawIds:r});return a.error?a:Yc({event:e,name:Br})}return dt},deleteFlightAndFlightDraw:function({tournamentRecord:t,event:e,drawId:i,auditData:n}){if(!t)return{error:ft};if(!i)return{error:xt};if(!e)return{error:zt};const{flightProfile:r}=el({event:e});var a;if(r&&(null===(a=r.flights)||void 0===a?void 0:a.find((t=>t.drawId===i)))){const t=r.flights.filter((t=>t.drawId!==i));zc({event:e,extension:{name:Br,value:{...r,flights:t}}})}return Tm({tournamentRecord:t,eventId:e.eventId,drawIds:[i],auditData:n}),dt},generateFlightProfile:function({drawNameRoot:t="Flight",attachFlightProfile:e,tournamentRecord:i,scaleAttributes:n,scaleSortMethod:r,deleteExisting:a,sortDescending:o,drawNames:s=[],flightsCount:c,flightValues:u,splitMethod:d,uuids:l=[],event:p,stage:h}){if(!p)return{error:zt};const f=p.entries||[],{flightProfile:m}=el({event:p});if(m&&e&&!a)return{error:qi};const{scaledEntries:g}=Qm({tournamentRecord:i,scaleAttributes:n,scaleSortMethod:r,sortDescending:o,event:p,stage:h}),v=g.map(Mc),y=f.filter((({participantId:t})=>!v.includes(t))).filter((t=>(!h||!t.entryStage||t.entryStage===h)&&du.includes(t.entryStatus))),I=g.concat(...y),w=I.length;let S=ct(I,Math.ceil(w/c));d===kg?S=ut(I,c):d===Og&&(S=ut(I,c,!0));const b={scaleAttributes:n,splitMethod:d,flights:rt(0,c).map((e=>{var i;const n=e+1,r={flightNumber:n,drawId:(null==l?void 0:l.pop())||qn(),drawEntries:(a=S[e],(a||[]).map((({participantId:t})=>f.find((e=>e.participantId===t))))),drawName:(null==s?void 0:s.length)&&s[e]||`${t} ${n}`};var a;const o=null==u||null===(i=u.find((t=>t.flightNumber===n)))||void 0===i?void 0:i.matchUpValue;return o&&(r.matchUpValue=o),r}))};if(e){const t=Rg({flightProfile:b,deleteExisting:a,event:p});return{splitEntries:Xi()&&S||void 0,...t}}return{flightProfile:b,...dt}},attachFlightProfile:Rg,updateDrawIdsOrder:function({event:t,orderedDrawIdsMap:e}){var i,n;if("object"!=typeof t)return{error:zt};if(!e)return{error:Ae,message:"Missing drawIdsOrderMap"};if("object"!=typeof e)return{error:_i,message:"orderedDrawIdsMap must be an object"};const r=Object.values(e);if(!r.every((t=>!isNaN(t))))return{error:_i,message:"drawOrder must be numeric"};if(X(r).length!==r.length)return{error:_i,message:"drawOrder values must be unique"};if(null!==(i=t.drawDefinitions)&&void 0!==i&&i.length){const i=(t.drawDefinitions||[]).map((({drawId:t})=>t));if(ot(i,Object.keys(e)).length!==i.length)return{error:_i,message:"Missing drawIds"};t.drawDefinitions.forEach((t=>{t.drawOrder=e[t.drawId]}))}const{flightProfile:a}=el({event:t});return null==a||null===(n=a.flights)||void 0===n||n.forEach((t=>{t.flightNumber=e[t.drawId]})),dt},getFlightProfile:el,getScaledEntries:Qm,addFlight:Kg,addAdHocMatchUps:function(t){return Mg(t)},generateAdHocMatchUps:function(t){return xg(t)},deleteAdHocMatchUps:function(t){return jg(t)},drawMatic:function(t){var e;const i=null===(e=t.tournamentRecord)||void 0===e?void 0:e.participants;return Object.assign(t,{tournamentParticipants:i}),qg(t)},setDelegatedOutcome:function(t){return Dg(t)},removeDelegatedOutcome:function(t){return Pg(t)},addVoluntaryConsolationStage:function({drawDefinition:t,drawSize:e}){return Fg({drawDefinition:t,drawSize:e})},generateVoluntaryConsolationStructure:function(t){const{tournamentRecord:e}=t;return e?Cg({participants:e.participants,...t}):{error:ft}},setMatchUpStatus:Wl,bulkMatchUpStatusUpdate:ql,setDrawDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:i}){return t?e?i?Gl({drawDefinition:e,matchUpFormat:i}):{error:ce}:{error:yt}:{error:ft}},setEventDefaultMatchUpFormat:function({tournamentRecord:t,event:e,matchUpFormat:i}){return t?i?e?v(i)?(e.matchUpFormat=i,dt):{error:ne}:{error:zt}:{error:ce}:{error:ft}},setStructureDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,structureId:n,event:r}){return t?e?i?n?Gl({drawDefinition:e,matchUpFormat:i,structureId:n,event:r}):{error:Vt}:{error:ce}:{error:yt}:{error:ft}},setCollectionDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:i}){return t?e?i?v(i)?{error:Hi}:{error:ne}:{error:ce}:{error:yt}:{error:ft}},assignDrawPosition:function({drawDefinition:t,drawPosition:e,structureId:i,participantId:n,qualifier:r,bye:a}){if(!t)return{error:yt};if(!e)return{error:Tt};if(!i)return{error:Vt};if(a){const n=ul({drawDefinition:t,drawPosition:e,structureId:i});if(n.error)return n}else{if(r)return{error:Hi};{const r=Rl({drawDefinition:t,structureId:i,drawPosition:e,participantId:n});if(r.error)return r}}return{...dt}},assignSeedPositions:function(t){const{useExistingSeedLimit:e,tournamentRecord:i,drawDefinition:n,structureId:r,assignments:a,drawId:o}=t;let s=0;if(null==a||!a.length)return{error:Zt};if(!i)return{error:ft};if(!o)return{error:xt};const{seedAssignments:c,seedLimit:u,error:d}=Uu({drawDefinition:n,structureId:r});if(d)return{error:d};const l=Object.assign({},...c.filter((t=>t.seedNumber)).map((t=>({[t.seedNumber]:t}))));a.forEach((t=>{const{seedNumber:i}=t;i<=u&&(!e||l[i])&&(l[i]=t)}));const p=Object.values(l),h=p.map((t=>null==t?void 0:t.participantId)).filter(Boolean);if(h.length!==(f=h,f.filter(et)).length)return{error:"participantId cannot be assigned to multiple seedNumbers"};var f;for(const m of p){const t=Qf({...m,drawDefinition:n,structureId:r});if(null!=t&&t.error)return t;null!=t&&t.success&&s++}return s?{...dt,modifications:s}:{error:ki}},assignDrawPositionBye:function({drawDefinition:t,structureId:e,drawPosition:i}){return ul({drawDefinition:t,structureId:e,drawPosition:i})},swapDrawPositionAssignments:function(t){return dg(t)},removeDrawPositionAssignment:ug,alternateDrawPositionAssignment:function(t){return hg(t)},withdrawParticipantAtDrawPosition:function(t){return Object.assign(t,{entryStatus:au}),ug(t)},setDrawParticipantRepresentativeIds:function({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:wt};if(!Array.isArray(t))return{error:_i};const i=Cc((null==e?void 0:e.entries)||[]);return t.length&&ot(t,i).length<t.length?{error:_i}:qc({drawDefinition:e,extension:{name:Wr,value:t}})},getDrawParticipantRepresentativeIds:function({drawDefinition:t}){const{extension:e,error:i}=sa({drawDefinition:t,name:"participantRepresentatives"});return i?{error:i}:{representativeParticipantIds:(null==e?void 0:e.value)||[]}},luckyLoserDrawPositionAssignment:function(t){return function({luckyLoserParticipantId:t,drawDefinition:e,drawPosition:i,structureId:n}){return pg({participantId:t,drawDefinition:e,drawPosition:i,structureId:n,positionActionName:"luckyLoserDrawPositionAssignment"})}(t)},automatedPositioning:function({tournamentRecord:t,drawDefinition:e,structureId:i,seedsOnly:n,event:r}){var a;if(!r)return{error:Kt};if(!e)return{error:wt};const o=Sm({drawDefinition:e,participants:null==t?void 0:t.participants,structureId:i,seedsOnly:n});return o.error?o:null!=o&&null!==(a=o.errors)&&void 0!==a&&a.length?{error:o.errors}:dt},automatedPlayoffPositioning:bm,checkInParticipant:function({tournamentRecord:t,participantId:e,matchUpId:i,matchUp:n,drawId:r}){n&&!r&&({drawId:r}=n),n&&!i&&({matchUpId:i}=n);const{event:a,drawDefinition:o}=Ia({tournamentRecord:t,drawId:r});if(!a)return{error:Kt};{const n=hh({tournamentParticipants:t.participants,drawDefinition:o,participantId:e,matchUpId:i});if(n.error&&n.error!==ei)return n}return dt},checkOutParticipant:function({tournamentRecord:t,drawId:e,matchUpId:i,participantId:n,matchUp:r}){r&&!e&&({drawId:e}=r),r&&!i&&({matchUpId:i}=r);const{event:a,drawDefinition:o}=Ia({tournamentRecord:t,drawId:e});if(!a)return{error:Kt};{const e=fh({drawDefinition:o,tournamentParticipants:t.participants,matchUpId:i,participantId:n});if(e.error)return e}return dt},toggleParticipantCheckInState:mh,generateDrawDefinition:ag,addDrawDefinitionTimeItem:function({drawDefinition:t,timeItem:e}){if(!t)return{error:wt};if(!e)return{error:Di};const i=e&&Object.keys(e),n=["itemType","itemValue"];if(!(n.filter((t=>i.includes(t))).length===n.length))return{error:Ei};t.timeItems||(t.timeItems=[]);const r=(new Date).toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),Nc({drawDefinition:t}),dt},assignTieMatchUpParticipantId:function(t){var e;const i=Em(t);if(i.error)return i;let n=t.teamParticipantId;const{tournamentRecord:r,drawDefinition:a,participantId:o}=t;if(!o)return{error:Ye};const{relevantAssignments:s,collectionPosition:c,teamParticipants:u,collectionId:d,matchUpType:l,dualMatchUp:p,tieMatchUp:h,tieFormat:f}=i,{tournamentParticipants:[m]}=Np({tournamentRecord:r,participantFilters:{participantIds:[o]}});if(!m)return{error:Je};const{individualParticipantIds:g,participantType:v}=m;if(l===ua&&v!==Ra)return{error:We};const y=v===Ra?[o]:g,I=n?u.find((({participantId:t})=>t===n)):u.find((({individualParticipantIds:t})=>st(y,t)));if(!I)return{error:Fi};n||(n=I.participantId);const w=s.find((t=>t.participantId===(null==I?void 0:I.participantId))),S=null==w?void 0:w.drawPosition,b=h.sides.find((({drawPosition:t})=>t===S)),U=null==b?void 0:b.sideNumber;if(!f)return{error:de};if(!(null===(e=f.collectionDefinitions)||void 0===e?void 0:e.find((t=>t.collectionId===d))))return{error:ue};if(!p.sides){const t=({displaySideNumber:t,drawPosition:e,sideNumber:i})=>({drawPosition:e,sideNumber:i,displaySideNumber:t});p.sides=[{...t(h.sides[0]),lineUp:[]},{...t(h.sides[1]),lineUp:[]}]}const N=p.sides.find((t=>t.sideNumber===U)),P=h.sides.find((t=>t.sideNumber===U));let E;if(l===da&&v!==Oa){const t=function({side:t}){let e;if(t.participant){const i=t.participant.individualParticipantIds||[];if(1===i.filter(Boolean).length){const{participant:t}=Ec({participantIds:i,tournamentRecord:r});i.push(o);const{participant:n}=Ec({participantIds:i,tournamentRecord:r});if(n)e=t.participantId;else{t.individualParticipantIds=i;const e=bf({individualParticipantIds:i,pairOverride:!0,tournamentRecord:r,participant:t});if(e.error)return e}}else console.log("###")}else{const t=sp({participant:{participantType:Oa,participantRole:Ih,individualParticipantIds:[o]},pairOverride:!0,tournamentRecord:r});if(t.error)return t}return{...dt,deleteParticipantId:e}}({side:P});if(t.error)return t;E=t.deleteParticipantId}else if(l===da&&v===Oa){const t=m.individualParticipantIds||[],{modifiedLineUp:e}=Um({collectionPosition:c,teamParticipantId:n,dualMatchUpSide:N,drawDefinition:a,participantIds:t,collectionId:d});for(const i of t)Dm({collectionPosition:c,teamParticipantId:n,drawDefinition:a,modifiedLineUp:e,participantId:i,collectionId:d,tieFormat:f});return N.lineUp=e,{...dt,modifiedLineUp:e}}const{modifiedLineUp:D}=Um({participantIds:[o],collectionPosition:c,teamParticipantId:n,dualMatchUpSide:N,drawDefinition:a,collectionId:d});if(Dm({collectionPosition:c,teamParticipantId:n,drawDefinition:a,modifiedLineUp:D,participantId:o,collectionId:d,tieFormat:f}),N.lineUp=D,E){const t=yf({participantIds:[E],teamDrawIds:[a.drawId],tournamentRecord:r});t.error&&console.log("cleanup",{result:t})}return{...dt,modifiedLineUp:D}},removeTieMatchUpParticipantId:function(t){var e,i,n,r;const{tournamentRecord:a,drawDefinition:o,participantId:s}=t;if(!s)return{error:Ye};const c=Em(t);if(c.error)return c;const{relevantAssignments:u,collectionPosition:d,teamParticipants:l,collectionId:p,matchUpType:h,dualMatchUp:f,tieMatchUp:m,tieFormat:g}=c;if(_l({score:m.score})||m.winningSide)return{error:zi};const v=null===(e=m.sides)||void 0===e?void 0:e.find((t=>{var e,i,n;return(null===(e=t.participant)||void 0===e?void 0:e.participantId)===s||(null===(i=t.participant)||void 0===i||null===(n=i.individualParticipantIds)||void 0===n?void 0:n.includes(s))}));if(!v)return{error:Je};const{tournamentParticipants:[y]}=Np({tournamentRecord:a,participantFilters:{participantIds:[s]}});if(!y)return{error:Je};if(h===ua&&y.participantType===Oa)return{error:Ve};const I=y.participantType===Ra?[s]:y.individualParticipantIds;f.sides||(f.sides=[{sideNumber:1},{sideNumber:2}]);let w=null===(i=f.sides)||void 0===i?void 0:i.find((({sideNumber:t})=>t===v.sideNumber));const S=Am({drawDefinition:o,participantIds:I}),b=(null==S?void 0:S.teamParticipantId)||(null==l||null===(n=l.find((t=>ot((null==t?void 0:t.individualParticipantIds)||[],I).length===I.length)))||void 0===n?void 0:n.participantId);if(!b)return{error:Je};if(!w&&((null===(r=f.sides)||void 0===r?void 0:r.filter((({lineUp:t})=>!t)).length)||0)<2){var U;const t=l.map((({participantId:t})=>{var e;return{drawPosition:null===(e=u.find((e=>e.participantId===t)))||void 0===e?void 0:e.drawPosition,teamParticipantId:t}}));console.log({drawPositionMap:t}),w=null===(U=f.sides)||void 0===U?void 0:U.find((e=>{var i;return(null===(i=t.find((({drawPosition:t})=>t===e.drawPosition)))||void 0===i?void 0:i.teamParticipantId)===b}))}if(!w)return{error:Gi,participantId:s};const{modifiedLineUp:N}=Um({collectionPosition:d,teamParticipantId:b,dualMatchUpSide:w,participantIds:I,drawDefinition:o,collectionId:p});if(w.lineUp=N,b&&Pm({participantId:b,lineUp:N,drawDefinition:o,tieFormat:g}),h===da&&y.participantType===Ra){var P;const t=null===(P=m.sides)||void 0===P?void 0:P.find((t=>t.sideNumber===w.sideNumber)),{participantId:e}=t||{},{tournamentParticipants:[i]}=Np({tournamentRecord:a,participantFilters:{participantIds:[e]},withEvents:!0});if(!i)return{error:Je};{const t=null==i?void 0:i.individualParticipantIds.filter((t=>t!==s));if(i.draws.length){if(1===t.length){const{participant:e}=Ec({participantIds:t,tournamentRecord:a});if(!e){const e=sp({participant:{participantRole:Ih,individualParticipantIds:t,participantType:Oa},pairOverride:!0,tournamentRecord:a});if(e.error)return e}}}else if(t.length){i.individualParticipantIds=t;const e=bf({participant:i,pairOverride:!0,tournamentRecord:a});if(e.error)return e}else{const t=yf({participantIds:[e],tournamentRecord:a});t.error&&console.log("cleanup",{result:t})}}}return{...dt,modifiedLineUp:N}},replaceTieMatchUpParticipantId:function(t){var e;const i=Em(t);if(i.error)return i;const{existingParticipantId:n,tournamentRecord:r,newParticipantId:a,drawDefinition:o}=t;if(!n||!a)return{error:Ye};const{collectionPosition:s,teamParticipants:c,collectionId:u,dualMatchUp:d,tieMatchUp:l,tieFormat:p}=i,{matchUpType:h}=l,f=l.sides.find((t=>{var e,i,r;return(null===(e=t.participant)||void 0===e?void 0:e.participantId)===n||(null===(i=t.participant)||void 0===i||null===(r=i.individualParticipantIds)||void 0===r?void 0:r.includes(n))}));if(!f)return{error:Je};const{tournamentParticipants:m}=Np({tournamentRecord:r,participantFilters:{participantIds:[n,a]}});if(2!==m.length)return{error:Ye};if(m[0].participantType!==m[1].participantType)return{error:We};const g=d.sides.find((({sideNumber:t})=>t===f.sideNumber));if(!g)return{error:Gi,existingParticipantId:n};const v=m.find((({participantId:t})=>t===n)),y=(null==v?void 0:v.individualParticipantIds)||[v.participantId],I=Am({drawDefinition:o,participantIds:y}),w=(null==I?void 0:I.teamParticipantId)||(null===(e=c.find((t=>ot((null==t?void 0:t.individualParticipantIds)||[],y).length===y.length)))||void 0===e?void 0:e.participantId),S=g.lineUp||I,b=S.find((({participantId:t})=>a===t)),U=(null==S?void 0:S.map((t=>{if(![n,a].includes(t.participantId))return t;var e;[n,a].includes(t.participantId)&&(t.collectionAssignments=null===(e=t.collectionAssignments)||void 0===e?void 0:e.filter((t=>!(t.collectionId===u&&t.collectionPosition===s))));return t.participantId===a&&(t.collectionAssignments||(t.collectionAssignments=[]),t.collectionAssignments.push({collectionId:u,collectionPosition:s})),t})))||[];b||U.push({participantId:a,collectionAssignments:[{collectionId:u,collectionPosition:s}]});const N=h===da,P=N&&S.map((t=>{var e;return(null===(e=t.collectionAssignments)||void 0===e?void 0:e.find((t=>t.collectionId===u&&t.collectionPosition===s)))&&t.participantId})).filter(Boolean),E=N&&U.map((t=>{var e;return(null===(e=t.collectionAssignments)||void 0===e?void 0:e.find((t=>t.collectionId===u&&t.collectionPosition===s)))&&t.participantId})).filter(Boolean);let D,A;if(g.lineUp=U,w&&Pm({participantId:w,lineUp:U,drawDefinition:o,tieFormat:p}),N){var T;const{tournamentRecord:e}=t;let i=Ec({participantIds:E,tournamentRecord:e});if(!i.participant){var C;const t=sp({tournamentRecord:e,pairOverride:!0,participant:{individualParticipantIds:E,participantType:Oa,participantRole:Ih}});if(t.error)return t;D=null===(C=t.participant)||void 0===C?void 0:C.participantId}i=Ec({participantIds:P,tournamentRecord:e});const n=null===(T=i.participant)||void 0===T?void 0:T.participantId;if(n){yf({participantIds:[n],tournamentRecord:e}).success&&(A=n)}}return{...dt,participantRemoved:A,participantAdded:D}},updateTeamLineUp:Pm,validateLineUp:Nm,getTeamLineUp:Dc};function Xg({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,policyDefinitions:r,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l;if(i.includes(o))return{};const p=null==r||null===(l=r.positionActions)||void 0===l?void 0:l.otherFlightEntries,h=(a.entries||[]).map((({participantId:t})=>t)).filter(Boolean),f=n.map((t=>t.participantId)).filter(Boolean),m=(d.entries||[]).filter((t=>t.entryStatus===Zc&&function({structure:t,entry:e}){const{stage:i}=t;if(!e.entryStage||e.entryStage===i||e.entryStage===Oo&&i===_o)return!0}({structure:c,entry:t})&&!f.includes(t.participantId))).sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))).map((t=>t.participantId));if(p){var g;const{flightProfile:t}=el({event:d}),e=null==t||null===(g=t.flights)||void 0===g?void 0:g.filter((t=>t.drawId!==u)).map((t=>t.drawEntries.filter((t=>t.participantId&&!h.includes(t.participantId))).map((({participantId:t})=>t)))).flat().filter(Boolean);null!=e&&e.length&&m.push(...e)}const v=null==t?void 0:t.filter((t=>m.includes(t.participantId)));if(v.forEach((t=>{const e=(a.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),v.sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))),m.length){return{validAlternatesAction:{type:Ms,method:"alternateDrawPositionAssignment",availableAlternates:v,availableAlternatesParticipantIds:m,willDisableLinks:e,payload:{drawId:u,structureId:s,drawPosition:o}}}}return{}}function Qg(t,e){return t.bye||t.seedValue<e.seedValue||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function tv({drawDefinition:t,drawPosition:e,structureId:i,structure:n,drawId:r,event:a,isByePosition:o,byeDrawPositions:s,positionAssignments:c,tournamentParticipants:u,onlyAssignedPositions:d=!0,activeDrawPositions:l,inactiveDrawPositions:p,possiblyDisablingAction:h}){if(l.includes(e))return{};const f=null==p?void 0:p.filter((t=>t!==e&&!(o&&s.includes(t)))),m=(null==c?void 0:c.filter((t=>(t=>!d||t.participantId||t.qualifier||t.bye)(t)&&(null==f?void 0:f.includes(t.drawPosition)))))||[],g=m.map((({drawPosition:t})=>t)),{matchUps:v}=Ru({inContext:!0,drawDefinition:t,structure:n,event:a}),y=v.filter((({drawPositions:t})=>st(t,g))),I=Object.assign({},...y.map((t=>{var e;return null===(e=t.sides)||void 0===e?void 0:e.filter((({sourceDrawPositionRange:t})=>t)).map((({drawPosition:t,sourceDrawPositionRange:e})=>({[t]:e})))})).flat()),w=m.map((t=>t.participantId)).filter(Boolean),S=(u||[]).filter((t=>w.includes(t.participantId))),b=Object.assign({},...S.map((t=>({[t.participantId]:t})))),U=m.map((t=>{const e=b&&b[t.participantId],i=I[t.drawPosition];return{...t,participant:Vn(e,!1,!0),sourceDrawPositionRange:i}}));if(U.length){return{validSwapAction:{type:Ls,method:"swapDrawPositionAssignments",availableAssignments:U,willDisableLinks:h,payload:{drawId:r,structureId:i,drawPositions:[e]}}}}return{}}function ev({action:t,policyActions:e}){var i;const n=!(null!=e&&e.enabledActions)||(null==e||null===(i=e.disabledActions)||void 0===i?void 0:i.length)&&e.disabledActions.includes(t);if(n)return!1;return!(!(0===(null==e?void 0:e.enabledActions.length)||(null==e?void 0:e.enabledActions.includes(t)))||n)}function iv({policyDefinitions:t,tournamentParticipants:e=[],tournamentRecord:i,drawDefinition:n,drawPosition:r,structureId:a,event:o}){if(!o)return{error:zt};if(!n)return{error:yt};if(void 0===r)return{error:Tt};if(!a)return{error:Vt};const{activeDrawPositions:s,byeDrawPositions:c,inactiveDrawPositions:u,structure:d,error:l}=zd({tournamentRecord:i,drawDefinition:n,structureId:a});if(l)return{error:l};const{policyDefinitions:p}=Xd({policyTypes:[er],tournamentRecord:i,drawDefinition:n,event:o}),h=t||p,{enabledStructures:f,actionsDisabled:m}=function({policyDefinitions:t,tournamentRecord:e,drawDefinition:i,structure:n,event:r}){const{policyDefinitions:a}=Xd({policyTypes:[er],tournamentRecord:e,drawDefinition:i,event:r}),o=(t=t||a||Gs).positionActions,{enabledStructures:s,disabledStructures:c}=o||{};return{enabledStructures:s,actionsDisabled:null==c?void 0:c.find((t=>{var e,i;return(null===(e=t.stages)||void 0===e?void 0:e.includes(n.stage))&&(!(null!==(i=t.stageSequences)&&void 0!==i&&i.length)||t.stageSequences.includes(n.stageSequence))}))}}({policyDefinitions:h,tournamentRecord:i,drawDefinition:n,structure:d,event:o}),{sourceStructureIds:g}=function({drawDefinition:t,structureId:e,finishingPosition:i,linkType:n}){const{links:r}=ed({drawDefinition:t,structureId:e})||{};return{sourceStructureIds:((null==r?void 0:r.target)||[]).filter((({linkType:t})=>t===n)).map((({source:t})=>t.structureId)).map((e=>{const{structure:i}=jc({drawDefinition:t,structureId:e});return{sourceStructureId:e,sourceFinishingPosition:i.finishingPosition}})).filter((({sourceFinishingPosition:t})=>t===i)).map((({sourceStructureId:t})=>t))}}({drawDefinition:n,structureId:a,finishingPosition:Ns,linkType:$o})||{};let v;null!=g&&g.length&&(v=g.reduce(((t,e)=>Sl({drawDefinition:n,structureId:e})&&t),!0));const y=g.length,I=g.length&&!v,{policyActions:w}=function({enabledStructures:t,structure:e}){if(!1===t)return{};if(null==t||!t.length)return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:i,stageSequence:n}=e||{};return{policyActions:t.find((t=>{var e,r;const a=!(null!==(e=t.stages)&&void 0!==e&&e.length)||t.stages.includes(i),o=!(null!==(r=t.stageSequences)&&void 0!==r&&r.length)||t.stageSequences.includes(n);if(t&&a&&o)return!0}))}}({enabledStructures:f,structure:d}),S=![Lo,Oo].includes(d.stage)||1!==d.stageSequence,b=[],{drawId:U}=n,{assignedPositions:N,positionAssignments:P}=Du({structure:d}),E=N.find((t=>t.drawPosition===r)),D=P.map((t=>t.drawPosition));if(null==D||!D.includes(r))return{error:At};const{stage:A,stageSequence:T}=d,C=[eu,tu],M=[A];A===_o&&M.push(Oo),A===Oo&&M.push(_o);const x=Iu({drawDefinition:n,stageSequence:T,entryStatuses:C,structureId:a,stages:M}),R=sg({drawDefinition:n,stages:M}),k=x.filter((t=>!R.includes(t.participantId))).map((t=>t.participantId)),O=c.includes(r),L=s.includes(r);if(m)return{message:"Actions Disabled for structure",isByePosition:O,isActiveDrawPosition:L,isDrawPosition:!0,hasPositionAssigned:!!E,validActions:[]};if(ev({policyActions:w,action:Rs})&&!L&&!I&&(!E||O)){const{validAssignmentActions:t}=function({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,tournamentParticipants:n,isWinRatioFedStructure:r,positionAssignments:a,policyDefinitions:o,drawDefinition:s,isByePosition:c,drawPosition:u,structureId:d,structure:l}){var p,h,f;const{drawId:m}=s,g=[];let v,y,I=[];const w=null==o||null===(p=o.seeding)||void 0===p||null===(h=p.validSeedPositions)||void 0===h?void 0:h.ignore;if(!w){const t=xl({randomize:!0,drawDefinition:s,structureId:d});({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:I}=t)}if(null!==(f=I)&&void 0!==f&&f.length||(I=a.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition))),c||g.push({type:Bs,method:"assignDrawPositionBye",willDisableLinks:i,payload:{drawId:m,structureId:d,drawPosition:u}}),r&&w){var S;const e=a.map((t=>t.participantId)).filter(Boolean),r={structureIds:t},{completedMatchUps:o}=cd({inContext:!0,matchUpFilters:r,drawDefinition:s}),c=X(null===(S=o||[])||void 0===S?void 0:S.map((({sides:t})=>t.map(Mc))).flat().filter((t=>!e.includes(t)))),l=null==n?void 0:n.filter((t=>null==c?void 0:c.includes(t.participantId)));return null==l||l.forEach((t=>{const e=(s.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),null!=l&&l.length&&g.push({type:Rs,method:Ts,availableParticipantIds:c,participantsAvailable:l,willDisableLinks:i,payload:{drawId:m,structureId:d,drawPosition:u}}),{validAssignmentActions:g}}const b=!(null!=l&&l.structures||null!=l&&l.matchUps.find((({roundPosition:t})=>!!t)));if(I.includes(u)||c){var U;let t;if(null!==(U=y)&&void 0!==U&&U.length){const e=y.filter((t=>{var e;return null===(e=v)||void 0===e?void 0:e.includes(t.participantId)}));e.sort(Qg),t=e.map((t=>t.participantId))}else if(b)t=Nl({drawDefinition:s,drawPosition:u,structure:l});else{t=e;const{unplacedQualifiersCount:i}=Im({drawDefinition:s,structureId:d,structure:l});i&&console.log({unplacedQualifiersCount:i})}const r=null==n?void 0:n.filter((e=>t.includes(e.participantId)));null!=r&&r.length&&g.push({type:Rs,method:Ts,availableParticipantIds:t,participantsAvailable:r,willDisableLinks:i,payload:{drawId:m,structureId:d,drawPosition:u}})}return{validAssignmentActions:g}}({positionSourceStructureIds:g,unassignedParticipantIds:k,possiblyDisablingAction:S,isWinRatioFedStructure:y,tournamentParticipants:e,positionAssignments:P,activeDrawPositions:s,policyDefinitions:h,drawDefinition:n,isByePosition:O,drawPosition:r,structureId:a,structure:d});null==t||t.forEach((t=>b.push(t)))}const{participantId:_}=E||{},F=_&&e.find((t=>t.participantId===_));if(E){ev({policyActions:w,action:ks})&&!L&&(b.push({type:ks,method:As,payload:{drawId:U,structureId:a,drawPosition:r},willDisableLinks:S}),O||b.push({type:xs,method:"withdrawParticipantAtDrawPosition",payload:{drawId:U,structureId:a,drawPosition:r},willDisableLinks:S}),ev({policyActions:w,action:Bs})&&!O&&b.push({type:Bs,method:As,payload:{drawId:U,structureId:a,drawPosition:r,replaceWithBye:!0},willDisableLinks:S}));const t=d.stage===Lo||d.stage===Oo&&1===d.stageSequence;if(!O&&ev({policyActions:w,action:Fs})&&Ml({drawDefinition:n,structureId:a,drawPosition:r})&&t){const{seedAssignments:t}=Uu({drawDefinition:n,structure:d}),{seedNumber:e,seedValue:i}=t.find((t=>t.participantId===_))||{};b.push({type:Fs,method:"modifySeedAssignment",participant:F,seedNumber:e,payload:{drawId:U,structureId:a,participantId:_,seedValue:i}})}if(!O&&_){if(ev({policyActions:w,action:js})){const t={type:js,method:Cs,participant:F,payload:{drawId:U,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};b.push(t)}if(ev({policyActions:w,action:_s})){const t={type:_s,method:"modifyParticipantOtherName",participant:F,payload:{participantId:_,otherName:void 0}};b.push(t)}}if(ev({policyActions:w,action:Ls})){const{validSwapAction:t}=tv({drawId:U,structure:d,structureId:a,drawPosition:r,isByePosition:O,drawDefinition:n,byeDrawPositions:c,positionAssignments:P,activeDrawPositions:s,inactiveDrawPositions:u,tournamentParticipants:e,possiblyDisablingAction:S});t&&b.push(t)}}if(ev({policyActions:w,action:Ms})&&!I){const{validAlternatesAction:t}=Xg({possiblyDisablingAction:S,tournamentParticipants:e,positionAssignments:P,activeDrawPositions:s,policyDefinitions:h,drawDefinition:n,drawPosition:r,structureId:a,structure:d,drawId:U,event:o});t&&b.push(t)}if(ev({policyActions:w,action:Os})&&!I){const{validLuckyLosersAction:t}=function({tournamentParticipants:t=[],possiblyDisablingAction:e,isWinRatioFedStructure:i,activeDrawPositions:n,positionAssignments:r,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l,p,h,f;if(n.includes(o)||i)return{};const{sourceStructureIds:m,targetStructureIds:g}=(null===(l=a.links)||void 0===l?void 0:l.reduce(((t,e)=>{var i,n;const r=null===(i=e.source)||void 0===i?void 0:i.structureId,a=null===(n=e.target)||void 0===n?void 0:n.structureId;return t.sourceStructureIds.includes(r)||t.sourceStructureIds.push(r),t.targetStructureIds.includes(a)||t.targetStructureIds.push(a),t}),{sourceStructureIds:[],targetStructureIds:[]}))||{};let v=null===(p=a.links)||void 0===p?void 0:p.find((t=>{var e;return(null===(e=t.target)||void 0===e?void 0:e.structureId)===c.structureId}));const y=null===(h=v)||void 0===h||null===(f=h.source)||void 0===f?void 0:f.structureId,{structure:I}=jc({drawDefinition:a,structureId:y}),w={};if((null==I?void 0:I.finishingPosition)===Ps&&(1!==(null==m?void 0:m.length)||1!==(null==g?void 0:g.length))){var S,b,U;const{matchUps:t}=Ru({drawDefinition:a,structure:c,event:d}),{initialRoundNumber:e}=Id({drawPosition:o,matchUps:t});v=null===(S=a.links)||void 0===S?void 0:S.find((t=>{var i;return(null===(i=t.target)||void 0===i?void 0:i.structureId)===(null==c?void 0:c.structureId)&&t.target.roundNumber===e}));const i=null===(b=v)||void 0===b||null===(U=b.source)||void 0===U?void 0:U.roundNumber;w.roundNumbers=[i]}const{completedMatchUps:N}=od({structureId:y,inContext:!0,matchUpFilters:w,drawDefinition:a}),P=r.map((t=>t.participantId)).filter(Boolean),E=null==N?void 0:N.map((({winningSide:t,sides:e})=>e[1-(t-1)])).map(Mc).filter((t=>!P.includes(t))),D=null==t?void 0:t.filter((t=>null==E?void 0:E.includes(t.participantId)));if(null==D||D.forEach((t=>{const e=(a.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),null!=E&&E.length)return{validLuckyLosersAction:{type:Os,method:"luckyLoserDrawPositionAssignment",availableLuckyLosers:D,availableLuckyLoserParticipantIds:E,willDisableLinks:e,payload:{drawId:u,structureId:s,drawPosition:o}}};return{}}({drawId:U,structure:d,structureId:a,drawPosition:r,drawDefinition:n,activeDrawPositions:s,positionAssignments:P,isWinRatioFedStructure:y,tournamentParticipants:e,possiblyDisablingAction:S});t&&b.push(t)}return{isByePosition:O,isActiveDrawPosition:L,isDrawPosition:!0,hasPositionAssigned:!!E,validActions:b}}const nv={allTournamentMatchUps:ud,tournamentMatchUps:pd,allEventMatchUps:ld,getRoundMatchUps:function(t){return Oc(t)},allDrawMatchUps:dd,eventMatchUps:hd,drawMatchUps:function({tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,policyDefinitions:i,tournamentRecord:n,matchUpFilters:r,contextFilters:a,contextProfile:o,drawDefinition:s,nextMatchUps:c,participants:u,tournamentId:d,inContext:l,context:p,event:h}){if(!h)return{error:zt};const{eventId:f,eventName:m,endDate:g}=h||{};return cd({context:{...p,...Gn({eventId:f,eventName:m,endDate:g||(null==h?void 0:h.endDate)||(null==n?void 0:n.endDate),tournamentId:d||(null==n?void 0:n.tournamentId),indoorOutDoor:(null==h?void 0:h.indoorOutDoor)||(null==n?void 0:n.indoorOutDoor),surfaceCategory:(null==h?void 0:h.surfaceCategory)||(null==n?void 0:n.surfaceCategory)})},tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:u||n&&fd({tournamentRecord:n}),policyDefinitions:i,tournamentRecord:n,drawDefinition:s,matchUpFilters:r,contextFilters:a,contextProfile:o,nextMatchUps:c,inContext:l,event:h})},credits:Lh,getEvent:function({tournamentRecord:t,drawDefinition:e,event:i,context:n}){var r;if(!t)return{error:ft};if(!i)return{error:zt};const a=Vn(i);return n&&Object.assign(a,n),{event:a,drawDefinition:e&&(null===(r=a.drawDefinitions)||void 0===r?void 0:r.find((({drawId:t})=>e.drawId===t)))}},getEvents:function({tournamentRecord:t,context:e,inContext:i}){if(!t)return{error:ft};const{tournamentId:n}=t;return{events:(t.events||[]).map((t=>{const r=Vn(t);return e&&Object.assign(r,e),i&&Object.assign(r,{tournamentId:n}),r}))}},findEventExtension:oa,findTournamentExtension:aa,findParticipantExtension:function({tournamentRecord:t,participantId:e,name:i}){if(!t)return{error:ft};if(!e)return{error:Ye};const{participant:n}=na({tournamentRecord:t,participantId:e});return ra({element:n,name:i})},findDrawDefinitionExtension:sa,getMatchUpFormat:Bp,getDrawDefinition:function({tournamentRecord:t,drawDefinition:e}){return t?{drawDefinition:Vn(e)}:{error:ft}},getEventProperties:function({tournamentRecord:t,event:e}){var i,n;if(!t)return{error:ft};if(!e)return{error:zt};const r=e.entries||[],a=t.participants||[],o=(null===(i=e.category)||void 0===i?void 0:i.categoryName)||(null===(n=e.category)||void 0===n?void 0:n.ageCategoryCode),{eventType:s}=e,c=r.map((t=>t.participantId));let u,d,l;return{entryScaleAttributes:a.filter((t=>c.includes(t.participantId))).map((t=>{var e,i,n,r,a,c;const{participantId:p,participantName:h,name:f}=t;let m={scaleType:Nr,eventType:s,scaleName:o};const g=null===(e=ff({participant:t,scaleAttributes:m}))||void 0===e||null===(i=e.scaleItem)||void 0===i?void 0:i.scaleValue;m={scaleType:Ur,eventType:s,scaleName:o};const v=null===(n=ff({participant:t,scaleAttributes:m}))||void 0===n||null===(r=n.scaleItem)||void 0===r?void 0:r.scaleValue;m={scaleType:br,eventType:s,scaleName:o};const y=null===(a=ff({participant:t,scaleAttributes:m}))||void 0===a||null===(c=a.scaleItem)||void 0===c?void 0:c.scaleValue;return u=!(!u&&!g),d=!(!d&&!v),l=!(!l&&!y),{participantId:p,participantName:h||f,seed:g,ranking:v,rating:y}})),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:l}},getPositionAssignments:function({tournamentRecord:t,drawDefinition:e,structureId:i}){return t?e?i?Eu({drawDefinition:e,structureId:i}):{error:Vt}:{error:yt}:{error:ft}},isValidMatchUpFormat:v,getMaxEntryPosition:function({entries:t=[],entryStatus:e,stage:i}){return Math.max(...t.filter((t=>!(i&&i!==t.entryStage||e&&t.entryStatus!==e||isNaN(t.entryPosition)))).map((({entryPosition:t})=>parseInt(t||0))),0)},findVenue:_u,getCourts:Bu,getVenuesAndCourts:Lu,findCourt:function(t){return Vn(ju(t),!1,!0)},getEventTimeItem:tc,getTournamentTimeItem:function({tournamentRecord:t,itemType:e,itemSubTypes:i,returnPreviousValues:n}){if(!t)return{error:ft};if(!t.timeItems)return{message:Gi};const{timeItem:r,previousItems:a,message:o}=Qs({element:t,itemType:e,itemSubTypes:i,returnPreviousValues:n});return r&&{timeItem:r,previousItems:a}||{message:o}},getParticipantTimeItem:function({tournamentRecord:t,participantId:e,itemType:i,itemSubTypes:n,returnPreviousValues:r}){if(!t)return{error:ft};if(!e)return{error:Ye};const a=na({tournamentRecord:t,participantId:e});if(a.error)return a;const{participant:o}=a;if(null==o||!o.timeItems)return{message:Gi};const{timeItem:s,previousItems:c,message:u}=Qs({element:a.participant,itemType:i,itemSubTypes:n,returnPreviousValues:r});return s&&{timeItem:s,previousItems:c}||{message:u}},getDrawDefinitionTimeItem:function({drawDefinition:t,itemType:e,itemSubTypes:i,returnPreviousValues:n}){if(!t)return{error:xt};if(!t.timeItems)return{message:Gi};const{timeItem:r,previousItems:a,message:o}=Qs({element:t,itemType:e,itemSubTypes:i,returnPreviousValues:n});return r&&{timeItem:r,previousItems:a}||{message:o}},bulkUpdatePublishedEventIds:function({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:ft};if(null==e||!e.length)return{error:Ae,message:"Missing outcomes"};const n=e.reduce(((t,e)=>{const{drawId:i,eventId:n}=e;return n&&i&&(t[n]?t[n].includes(i)||t[n].push(i):t[n]=[i]),t}),{}),r=Object.keys(n);return{publishedEventIds:(null===(i=t.events)||void 0===i?void 0:i.filter((t=>r.includes(t.eventId)))).filter((t=>{const{timeItem:e}=tc({event:t,itemType:"PUBLISH.STATUS"}),i=null==e?void 0:e.itemValue,{eventId:r}=t;return n[r].filter((t=>{var e;return i&&i.PUBLIC&&(null===(e=i.PUBLIC.drawIds)||void 0===e?void 0:e.includes(t))&&i!==Dr})).length})).map((t=>t.eventId)),eventIdPublishedDrawIdsMap:n}},matchUpActions:Wh,positionActions:function({policyDefinitions:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,drawId:a,event:o}){const{tournamentParticipants:s}=Np({tournamentRecord:e,inContext:!0});return iv({tournamentParticipants:s,policyDefinitions:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r,drawId:a,event:o})},findMatchUp:function(t){Object.assign(t,{inContext:!0});const{matchUp:e,error:i}=md(t);return{matchUp:Vn(e,!0,!0),error:i}},participantScheduledMatchUps:dp,participantScaleItem:ff,getParticipantScaleItem:Xm,getParticipantSignInStatus:function({tournamentRecord:t,participantId:e}){if(!t)return{error:ft};if(!e)return{error:Ye};const{participant:i}=na({tournamentRecord:t,participantId:e});if(!i)return{error:Je};const{timeItem:n}=Qs({element:i,itemType:pp});return n&&n.itemValue===vp&&vp},getPolicyDefinitions:Xd,getMatchUpScheduleDetails:Ca};const rv={addVenue:op,deleteVenue:rp,deleteVenues:function({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:ft};if(!Array.isArray(e))return{error:_i};for(const n of t.venues||[]){const{venueId:r}=n;if(e.includes(r)){const{venueId:e}=n,r=rp({tournamentRecord:t,venueId:e,force:i});if(r.error)return r}}return dt},modifyVenue:ip,addCourt:tp,addCourts:ep,deleteCourt:function({tournamentRecord:t,drawDefinition:e,disableNotice:i,courtId:n,force:r}){const{venue:a,error:o}=ju({tournamentRecord:t,courtId:n});if(o)return{error:o};const{matchUps:s}=Yl({tournamentRecord:t,courtId:n});if(s.length&&!r)return Jl({matchUpsCount:s.length});for(const c of s){const i=np({tournamentRecord:t,drawDefinition:e,drawId:c.drawId,matchUpId:c.matchUpId});if(i.error)return i}return a.courts=(a.courts||[]).filter((t=>t.courtId!==n)),i||en({topic:vc,payload:{venue:a},key:a.venueId}),{...dt}},modifyCourt:Ql,modifyCourtAvailability:Xl,findVenue:function(t){return Vn(_u(t),!1,!0)}},av=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>Qh({convertExtensions:t,removeExtensions:e,tournamentId:sn()}),newTournamentRecord:(t={})=>{const e=Zh(t);return e.error?e:(dn(e),pn(e.tournamentId),Object.assign({tournamentId:e.tournamentId},dt))},setTournamentId:t=>pn(t)};function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}return t.version=()=>"0.51.1",t.reset=()=>e(hn(sn())),t.setState=(t,i,n)=>{tn(i,n);return e(Xh(t,i))},t.devContext=e=>(Qi(e),t),t.getDevContext=t=>Xi(t),t.executionQueue=(e,n)=>function(e,n){if(!Array.isArray(e))return{error:_i};const r=cn(sn()),a=n&&Vn(r,!1,!0),o=[];for(const s of e){if("object"!=typeof s)return{error:_i};const{method:e,params:n}=s;if(!t[e])return{error:Ki};const c=i(r,t[e],n);if(null!=c&&c.error)return a&&Xh(a),{...c,rolledBack:!!a};o.push(c)}return Rp(),rn(),{results:o}}(e,n),[nv,Zg,rv,Lf,Cf,Af,Tf,Uf].forEach((e=>{Object.keys(e).forEach((i=>{t[i]=t=>{if(Xi())return n(e[i],t);try{return n(e[i],t)}catch(r){console.log("%c ERROR","color: orange",{err:r})}}}))})),t;function i(e,i,n){delete t.success,delete t.error;return i({...tf(e,n),tournamentRecord:e})}function n(t,e){const n=(null==e?void 0:e.sandBoxRecord)||(null==e?void 0:e.sandboxRecord)||(null==e?void 0:e.sandboxTournament)||cn(sn()),r=(null==e?void 0:e.rollbackOnError)&&Vn(n,!1,!0),a=i(n,t,e);null!=a&&a.error&&r&&Xh(r);const o=(null==a?void 0:a.success)&&!0!==(null==e?void 0:e.delayNotify);return o&&Rp(),!o&&null!=a&&a.success||rn(),a}}();function ov(t){if(t.matchUpStatus===S){return t.sides.reduce(((t,e)=>e.participantId||t),void 0)}if(!t.winningSide)return;return t.sides.reduce(((e,i)=>i.sideNumber===t.winningSide?i.participantId:e),void 0)}const sv={getSourceRounds:yg,getDrawStructures:Hm,getPositionsPlayedOff:vg,getStructureQualifiersCount:function({drawDefinition:t,structure:e,structureId:i}){let n,r;if(e||({structure:e,error:n}=jc({drawDefinition:t,structureId:i})),!n)if(e.stage!==Lo)n="Structure is not Qualifying";else{const{matchUps:i}=Ru({drawDefinition:t,structure:e});r=i.reduce(((t,e)=>t+(1===e.finishingRound?1:0)),0)}return{qualifiersCount:r,error:n}},getAvailablePlayoffRounds:Ig,addPlayoffStructures:Sg,removeStructure:Tg,addAdHocMatchUps:Mg,generateAdHocMatchUps:xg,deleteAdHocMatchUps:jg,structureSort:Fc,generateDrawType:Jm,addVoluntaryConsolationStage:Fg,generateVoluntaryConsolationStructure:Cg,buildDrawHierarchy:function({matchUps:t,matchUpType:e}){var i;if(!t)return{error:fe};let n=0,r=[],a=[];e&&(t=t.filter((t=>t.matchUpType===e)));const o=X(t.map((({matchUpType:t})=>t)));if(o.length>1)if(o.includes(la))t=t.filter((t=>t.matchUpType===la));else if(o.includes(ua))t=t.filter((t=>t.matchUpType===ua));else{if(!o.includes(da))return{};t=t.filter((t=>t.matchUpType===da))}if(!Array.isArray(t)||!t.length)return{};const s=(t,e)=>parseInt(t)-parseInt(e),c=X(t.map((t=>t.drawPositions)).flat().filter(Boolean)).sort(s),u=rt(1,Math.max(...c)+1).filter((t=>!c.includes(t))).sort(s),{roundMatchUps:d}=Oc({matchUps:t}),l=d[1],p=d[2]||[],[h]=l||[{}],f=h.drawId,m=h.structureId,g=Math.max(...Object.keys(d)),v=(null===(i=d[g])||void 0===i?void 0:i.length)||0,y=Math.ceil(Math.log(v)/Math.log(2)),I=rt(1,y+1).map((t=>{const e=Math.pow(2,t-1),i=g+y-t+1;return rt(1,e+1).map((e=>({drawId:f,structureId:m,matchUpId:qn(),drawPositions:[],sides:[],roundNumber:i,roundPosition:e,finishingRound:t})))}));y&&(t=t.concat(...I.flat()));const w=l.map((t=>t.drawPositions)).flat(1/0),S=p.map((t=>t.drawPositions)).flat(1/0).filter((t=>!w.includes(t))).sort(s),b=p.filter((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.reduce(((t,e)=>S.includes(e)||t),void 0)})).map((t=>{var e,i;const n=null===(e=t.drawPositions)||void 0===e?void 0:e.reduce(((t,e)=>S.includes(e)?e:t),void 0),r=null===(i=t.drawPositions)||void 0===i?void 0:i.indexOf(n);return{[n]:t.sides[r]}}));if(null!=u&&u.length&&(null==S?void 0:S.length)===(null==u?void 0:u.length)){const e=S.map(((t,e)=>[t,u[e]].sort(s))),i=Object.assign({},...b),n=Vn(l[0].finishingRound,!1,!0),r=Vn(l[0].finishingPositionRange);a=e.map(((t,e)=>{const a=Math.max(...t)/2;return{sides:t.map((t=>i[t]||{bye:!0,drawPosition:t})),drawId:f,structureId:m,roundPosition:a,drawPositions:t,roundNumber:1,finishingRound:n,matchUpId:qn(),matchUpStatus:"BYE",sideNumber:e+1,finishingPositionRange:r}})),t=t.concat(...a)}const U=g+y;return rt(1,U+1).forEach((e=>{var i,a;const o=[],s=N({matchUps:t,roundNumber:e}),c=N({matchUps:t,roundNumber:e-1}).map(ov).filter(Boolean),u=(null==s?void 0:s.length)===(null===(i=r)||void 0===i?void 0:i.length),d=(null==s?void 0:s.length)===(null===(a=r)||void 0===a?void 0:a.length)/2;1===e&&s.forEach((t=>{const e=t.drawPositions||[],{matchUpId:i,structureId:n}=t,r=[{...t.sides[0],drawPosition:e[0],matchUpId:i,structureId:n},{...t.sides[1],drawPosition:e[1],matchUpId:i,structureId:n}],a={...t,children:r};o.push(a)})),u?(n++,s.forEach(((t,e)=>{const i=t.drawPositions||[],{matchUpId:a,structureId:s}=t,u=i.filter(Boolean).reduce(((t,e)=>w.includes(e)?t:e),void 0),d=[{...t.sides.filter(Boolean).reduce(((t,e)=>e.participantId&&!c.includes(e.participantId)?e:t),void 0),drawPosition:u,feedRoundNumber:n,sides:t.sides,matchUpId:a,structureId:s},r[e]],l={...t,children:d};o.push(l)}))):d&&s.forEach(((t,e)=>{const i={...t,children:[r[2*e],r[2*e+1]]};o.push(i)})),r=o})),{hierarchy:r[0],missingMatchUps:a,maxRound:g,finalRound:U,matchUps:t};function N({matchUps:t,roundNumber:e}){return t.filter((t=>t.roundNumber===e)).sort(((t,e)=>t.roundPosition-e.roundPosition))}}};function cv({participantPreferences:t,drawPositionResolutions:e={}}){const i=Object.keys(t).reduce(((e,i)=>{const n=t[i].preferences[0];return n&&(e[n]||(e[n]=[]),e[n].push(i)),e}),{}),n=Math.min(...Object.values(i).filter((t=>t.length)).map((t=>t.length))),r=Object.keys(i).filter((t=>i[t].length&&n&&i[t].length===n));let a;return r.forEach((n=>{const r=it(i[n]);e[n]=r,delete t[r]})),Object.values(t).forEach((t=>{t.preferences=t.preferences.filter((t=>{const e=!r.includes(t.toString());return e&&(a=!0),e}))})),{drawPositionResolutions:e,remainingPreferences:a,participantPreferences:t}}const uv={setSubOrder:Ng,clearDrawPosition:$d,assignDrawPosition:Rl,automatedPositioning:Sm,assignDrawPositionBye:ul,swapDrawPositionAssignments:dg,alternateDrawPositionAssignment:hg,resolveDrawPositions:function({participantFactors:t,positionAssignments:e}){if(!t||!e)return{error:Ae};let i=Vn(t,!1,!0);const n=e.map((({drawPosition:t})=>t)),r=e.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map(xc);let a,o=!0;for(;o;)({drawPositionResolutions:a,remainingPreferences:o,participantPreferences:i}=cv({participantPreferences:i,drawPositionResolutions:a}));const s=Object.keys(a).map((t=>parseInt(t)));let c=r.filter((t=>!s.includes(t))),u=Object.keys(i);const d=rt(1,(l=2,p=n.length,Math.log(p)/Math.log(l)+1)).map((t=>Math.pow(2,t)));var l,p;const h={};for(const m of d){const e=ct(n,m).filter((t=>st(t,c))),i={};u.forEach((n=>{e.forEach((e=>{const r=e.join("|");st(e,t[n].preferences)&&(i[r]||(i[r]=[]),i[r].push(n))}))}));if(Q(Object.keys(i)).forEach((t=>{const e=i[t].filter((t=>u.includes(t)));for(;e.length;){const i=it(e),n=t.split("|").map((t=>parseInt(t))).filter((t=>c.includes(parseInt(t))));if(n.length){const e=it(n);c=c.filter((t=>t!==e)),u=u.filter((t=>t!==i)),a[e]=i;const r=t.split("|").length;h[r]||(h[r]=0),h[r]+=1}}})),!c.length)break}const f={chunkResolution:h};return u.length&&(u.forEach((t=>{const e=it(c);e&&(a[e]=t)})),f.randomAssignment=u.length),{drawPositionResolutions:a,report:f}},initializeStructureSeedAssignments:Cm,getNextSeedBlock:xl};function dv(t){return null!==t&&(void 0===t||!isNaN(t))}const lv={setMatchUpStatus:Bl,setMatchUpFormat:Gl,isValidMatchUpFormat:v,addMatchUpTimeItem:Ou,resetMatchUpTimeItems:function({drawDefinition:t,event:e,matchUpId:i}){const{matchUp:n}=ku({drawDefinition:t,event:e,matchUpId:i});return n?(n.timeItems=[],Uc({drawDefinition:t,matchUp:n}),{...dt}):{error:he}},checkInParticipant:hh,checkOutParticipant:fh,getCheckedInParticipantIds:Cu,addMatchUpScheduleItems:Wu,addMatchUpScheduledDate:qu,addMatchUpScheduledTime:zu,addMatchUpStartTime:Yu,addMatchUpEndTime:Ju,addMatchUpStopTime:$u,addMatchUpResumeTime:Zu,setDelegatedOutcome:Dg,removeDelegatedOutcome:Pg,drawMatic:qg,matchUpSort:Vd,addMatchUpOfficial:Ku,findMatchUp:function(t){return Object.assign(t,{inContext:!0}),{matchUp:Vn(ku(t).matchUp,!1,!0)}},getRoundMatchUps:Oc,validDrawPositions:function({matchUps:t}){if(!t)return{error:fe};const e=t.map((t=>t.drawPositions)).flat();Xi()&&t.forEach((t=>{Array.isArray(t.drawPositions)?t.drawPositions.forEach((e=>{dv(e)||console.log("invalid drawPosition",t)})):console.log("drawPositions not an array",t)}));const i=e.every(dv),n=t.find((t=>!Array.isArray(t.drawPositions)));return i&&!n}},pv={attachPolicies:Zm};const hv={allPlayoffPositionsFilled:bl,isCompletedStructure:Sl,getStructureMatchUps:od,allStructureMatchUps:function(t){const{structure:e}=jc(t);return Object.assign(t,{structure:e,inContext:!0}),Ru(t)},allDrawMatchUps:function(t){return Object.assign(t,{inContext:!0}),sd(t)},drawMatchUps:function(t){return Object.assign(t,{inContext:!0}),cd(t)},getEliminationDrawSize:xf,getParticipantIdMatchUps:ef,getParticipantIdFinishingPositions:nf,structureActions:function(t){return null!=t&&t.drawDefinition?{actions:[],state:{isComplete:Sl(t),hasPlayoffPositionsFilled:bl(t)}}:{error:yt}},matchUpActions:Hh,positionActions:iv,getStructureSeedAssignments:Uu,getNextUnfilledDrawPositions:function({drawDefinition:t,structureId:e}){if(!t){return{error:yt,nextUnfilledDrawPositions:[]}}if(!e){return{error:Vt,nextUnfilledDrawPositions:[]}}const{structure:i,error:n}=jc({drawDefinition:t,structureId:e});if(n)return{error:n};const r=Du({structure:i}),a=(null==r?void 0:r.positionAssignments)||[],{unfilledPositions:o}=xl({drawDefinition:t,structureId:e,randomize:!0}),s=a.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));return null!=o&&o.length?{nextUnfilledDrawPositions:o}:{nextUnfilledDrawPositions:s}},getExitProfiles:function({drawDefinition:t}){if("object"!=typeof t)return{error:vt};const e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce(((t,e)=>{const{stage:i}=e;return t[i]?t[i].push(e):t[i]=[e],t}),{});for(const o of Object.keys(r)){const t=r[o].find((({stageSequence:t})=>1===t)),{structureId:i}=t;a(e,"0",o,i,0)}return{exitProfiles:e};function a(t,e,r,o,s){t[o]||(t[o]=[]),"0"===e&&[_o,jo].includes(r)||t[o].push(e);const c=n.filter((t=>t.source.structureId===o&&t.source.roundNumber>=s));for(const n of c){const r=n.source.roundNumber,o=n.target.roundNumber,s=n.target.structureId;a(t,`${e}-${r}`,i.find((t=>t.structureId===s)).stage,s,o)}}},getMatchUpContextIds:function({matchUps:t,matchUpId:e}){if(!Array.isArray(t))return{error:_i};const i=t.find((t=>t.matchUpId===e)),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:o}},getMatchUpParticipantIds:Tu,getMatchUpScheduleDetails:Ca,generateTieMatchUpScore:xa,matchUpDuration:Mr,credits:Lh};const fv={addDrawEntry:Hf,addDrawEntries:Wf,assignSeed:Qf,removeEntry:function({participantId:t,drawDefinition:e,autoEntryPositions:i=!0}){return e?t?sg({drawDefinition:e}).includes(t)?{error:ri}:(null!=e&&e.entries&&(e.entries=e.entries.filter((e=>e.participantId!==t))),i&&(e.entries=Vf({entries:e.entries})),Pc({drawDefinition:e}),{...dt}):{error:Ye}:{error:yt}},setStageDrawSize:$m,setStageAlternatesCount:function({drawDefinition:t,stage:e,alternatesCount:i}){return t?mu({drawDefinition:t,stage:e})?(Jc({drawDefinition:t,attributes:[{[e]:{alternates:i}}]}),i||(t.entries=(null===(n=t.entries)||void 0===n?void 0:n.filter((t=>t.entryStatus!==Zc)))||[]),Pc({drawDefinition:t}),{...dt}):{error:Qt}:{error:yt};var n},setStageWildcardsCount:function({drawDefinition:t,stage:e,wildcardsCount:i=0}){if(!t)return{error:yt};if(!mu({drawDefinition:t,stage:e}))return{error:Qt};const n=gu({drawDefinition:t,stage:e}),r=vu({drawDefinition:t,stage:e}),a=Su({drawDefinition:t,stage:e}),o=wu({drawDefinition:t,stage:e});return i<a?{error:"Number of Wildcards cannot be less than number of Wildcards already entered"}:o+i+r>n?{error:"Total stage Entries cannot be greater than drawPositions"}:(Jc({drawDefinition:t,attributes:[{[e]:{wildcardsCount:i}}]}),Pc({drawDefinition:t}),{...dt})},setStageQualifiersCount:function({drawDefinition:t,stage:e,qualifiersCount:i=0}){if(!t)return{error:yt};if(!mu({drawDefinition:t,stage:e}))return{error:Qt};if(e!==Oo)return{error:"qualifiersCount can only be set for main stage"};const n=gu({drawDefinition:t,stage:e}),r=Su({drawDefinition:t,stage:e});return wu({drawDefinition:t,stage:e})+r+i>n?{error:"Total stage Entries cannot be greater than drawPositions"}:(Jc({drawDefinition:t,attributes:[{[e]:{qualifiersCount:i}}]}),Pc({drawDefinition:t}),{...dt})},modifySeedAssignment:Ug};const mv={generateQualifyingLink:function({qualifyingStructureId:t,mainStructureId:e,qualifyingRound:i,mainEntryRound:n=1,drawDefinition:r}){if(!r)return{error:yt};const a={linkType:Zo,source:{roundNumber:i,structureId:t},target:{feedProfile:zo,roundNumber:n,structureId:e}};r.links.push(a),Pc({drawDefinition:r})}};let gv,vv=[];const yv=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>({drawDefinition:Vn(gv,t,!1,e)}),version:()=>"0.51.1",reset:()=>(gv=void 0,dt),newDrawDefinition:({drawId:t,drawType:e}={})=>(gv=ig({drawId:t,drawType:e}),Object.assign({drawId:gv.drawId,drawDefinition:Vn(gv)},dt)),setDrawDescription:({description:t}={})=>gv?(gv.description=t,Pc({drawDefinition:gv}),Object.assign({drawId:gv.drawId},dt)):{error:yt}};return[mv,hv,Ro,fv,pv,lv,uv,sv].forEach((i=>{Object.keys(i).forEach((n=>{t[n]=t=>{if(Xi())return e({params:t,governor:i,governorMethod:n});try{return e({params:t,governor:i,governorMethod:n})}catch(r){console.log("%c ERROR","color: orange",{err:r})}}}))})),t.devContext=e=>(Qi(e),t),t.setParticipants=(e=[])=>(vv=e,t),t.setState=(e,i,n)=>{tn(i,n);return function(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0,gv=e,t.drawId=e.drawId),t}(eg(e))},t;function e({params:e,governor:i,governorMethod:n}){var r,a;delete t.success,delete t.error;const o=(null===(r=e)||void 0===r?void 0:r.rollbackOnError)&&Vn(gv,!1,!0);e={...e,tournamentParticipants:vv,drawDefinition:gv};const s=i[n](e);if(null!=s&&s.error)return o&&eg(o),{...s,rolledBack:!!o};const c=(null==s?void 0:s.success)&&!0!==(null===(a=e)||void 0===a?void 0:a.delayNotify);return c&&Rp(),!c&&null!=s&&s.success||rn(),s}}();function Iv({scoreString:t,tiebreakTo:e=7}){return t.split(" ").filter(Boolean).map(((t,i)=>function({set:t,setNumber:i}){const n=(null==t?void 0:t.startsWith("["))&&t.split("[")[1].split("]")[0].split("-").map((t=>parseInt(t))),r=t.includes("(")?t.split("(")[0]:t.includes("[")?t.split("[")[0]:t,a=!n&&r.split("-").map((t=>parseInt(t))),o=a[0]>a[1]?1:a[0]<a[1]?2:void 0,s=t.includes("(")&&t.split("(")[1].split(")")[0],c=![!1,void 0].includes(s)&&ja({isSide1:2===o,lowValue:s,tiebreakTo:e})||[],[u,d]=a||[],[l,p]=n||c||[];return{side1Score:u,side2Score:d,side1TiebreakScore:l,side2TiebreakScore:p,winningSide:o,setNumber:i}}({set:t,setNumber:i+1})))}function wv({scoreString:t,winningSide:e,matchUpStatus:i}){if(!t)return{outcome:{...il,winningSide:e,matchUpStatus:i}};if(e&&![1,2,void 0].includes(e))return{error:_i,winningSide:e};const n=t&&Iv({scoreString:t}),r={},a=Do({sets:n}),o=Do({sets:n,reversed:!0});return 2===e?(r.scoreStringSide1=o,r.scoreStringSide2=a):(r.scoreStringSide1=a,r.scoreStringSide2=o),r.sets=Iv({scoreString:r.scoreStringSide1}),{outcome:{matchUpStatus:i,winningSide:e,score:r}}}var Sv=[{AL:"Alabama"},{AK:"Alaska"},{AZ:"Arizona"},{AR:"Arkansas"},{CA:"California"},{CO:"Colorado"},{CT:"Connecticut"},{DE:"Delaware"},{DC:"District of Columbia"},{FL:"Florida"},{GA:"Georgia"},{HI:"Hawaii"},{ID:"Idaho"},{IL:"Illinois"},{IN:"Indiana"},{IA:"Iowa"},{KS:"Kansas"},{KY:"Kentucky"},{LA:"Louisiana"},{ME:"Maine"},{MD:"Maryland"},{MA:"Massachusetts"},{MI:"Michigan"},{MN:"Minnesota"},{MS:"Mississippi"},{MO:"Missouri"},{MT:"Montana"},{NE:"Nebraska"},{NV:"Nevada"},{NH:"New Hampshire"},{NJ:"New Jersey"},{NM:"New Mexico"},{NY:"New York"},{NC:"North Carolina"},{ND:"North Dakota"},{OH:"Ohio"},{OK:"Oklahoma"},{OR:"Oregon"},{PA:"Pennsylvania"},{RI:"Rhode Island"},{SC:"South Carolina"},{SD:"South Dakota"},{TN:"Tennessee"},{TX:"Texas"},{UT:"Utah"},{VT:"Vermont"},{VA:"Virginia"},{WA:"Washington"},{WV:"West Virginia"},{WI:"Wisconsin"},{WY:"Wyoming"},{PR:"Puerto Rico"}],bv=["Adairsville","Ashburn","Ashland","Audubon Park","Aurora","Aurora","Bay Minette","Bayville","Bean Station","Becket","Belle Isle","Bellmead","Belville","Benld","Benton","Boaz","Bolivar","Bossier City","Bremen","Brent","Brentwood","Brownsville","Burns","Cairo","Caledonia","Cambridge","Canutillo","Central Garage","Centralia","Cherry Valley","Chester Center","Chesterfield","Cibecue","Cohoe","Collinsville","Columbus","Corcoran","Cuba","Dolgeville","Douglas","Druid Hills","Dyker Heights","Eagar","East Dubuque","East Valley","Edgefield","Eliot","Elizabeth","Elmsford","Emerald Isle","Emory","Estero","Fairmount","Falcon Heights","Falmouth","Fillmore","Flower Hill","Fobes Hill","Fort Valley","Franklin","Freeport","Gardnertown","Gates Mills","Glasgow Village","Goldsboro","Grant-Valkaria","Greenfield","Gretna","Guilford Siding","Hampton Falls","Harrisonville","Hart","Haskins","Hebron","Hennepin","Highgrove","Homerville","Homewood","Hooksett","Inwood","Island Lake","Issaquah","Jasper","Jefferson","Jewell","Kaukauna","Kings Grant","Kingston","Kirkland","Kokomo","Koloa","La Center","LaBelle","Lake Placid","Lake Waccamaw","Laughlin","LaVerkin","Leadville North","Leland","Long Creek","Longmeadow","Luttrell","Magnolia","Malvern","Mar-Mac","Marana","Marble Falls","Martin","Martindale","Martinsburg","Mazomanie","Mechanicsville","Mexico Beach","Middletown","Mobile","Moravian Falls","Morehead","Mount Hermon","Mulberry","Munhall","Nettleton","Newton","North Granby","North Highlands","Northern Cambria","Northwest Harwinton","Nurillo","Oasis","Orlando","Osceola","Otis","Pacolet","Palm Beach Gardens","Paoli","Patton Village","Paw Paw Lake","Pearl River","Pine Bluffs","Pine","Pioneer","Port Hadlock-Irondale","Porter","Potsdam","Price","Princess Anne","Princeville","Red Oak","Richfield","Ridge Wood Heights","Ringwood","Robinwood","Rochester","Rockland","Rockwell City","Roland","Rolling Hills","Ruskin","Saint Anthony","Saint Robert","Salisbury","Sauk Rapids","Sayreville Junction","Sedona","Shawnee","Shenandoah","Silver Lake","South Waverly","Southwest Ranches","Southwick","Spring Green","Spring Valley","Spry","Strawberry Point","Terryville","Texico","Thomson","Tonganoxie","Townsend","Trinity","Union City","Van Buren","Verona Walk","Villa Rica","Warrenton","Warroad","Washington, D.C.","Weaverville","Wescosville","West Clarkston-Highland","West Orange","Williamsport","Windsor","Winnsboro","Woodbridge","Woodmoor","Wyoming","Young America (historical)","Zeeland"];var Uv=[{firstName:"Novak",lastName:"Djokovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Rafael",lastName:"Nadal",sex:"MALE",nationalityCode:"ESP"},{firstName:"Dominic",lastName:"Thiem",sex:"MALE",nationalityCode:"AUT"},{firstName:"Roger",lastName:"Federer",sex:"MALE",nationalityCode:"SUI"},{firstName:"Stefanos",lastName:"Tsitsipas",sex:"MALE",nationalityCode:"GRE"},{firstName:"Daniil",lastName:"Medvedev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Alexander",lastName:"Zverev",sex:"MALE",nationalityCode:"GER"},{firstName:"Andrey",lastName:"Rublev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Diego",lastName:"Schwartzman",sex:"MALE",nationalityCode:"ARG"},{firstName:"Matteo",lastName:"Berrettini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Gael",lastName:"Monfils",sex:"MALE",nationalityCode:"FRA"},{firstName:"Denis",lastName:"Shapovalov",sex:"MALE",nationalityCode:"CAN"},{firstName:"Roberto",lastName:"Bautista Agut",sex:"MALE",nationalityCode:"ESP"},{firstName:"David",lastName:"Goffin",sex:"MALE",nationalityCode:"BEL"},{firstName:"Pablo",lastName:"Carreno Busta",sex:"MALE",nationalityCode:"ESP"},{firstName:"Fabio",lastName:"Fognini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Milos",lastName:"Raonic",sex:"MALE",nationalityCode:"CAN"},{firstName:"Karen",lastName:"Khachanov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Stan",lastName:"Wawrinka",sex:"MALE",nationalityCode:"SUI"},{firstName:"Grigor",lastName:"Dimitrov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Felix",lastName:"Auger-Aliassime",sex:"MALE",nationalityCode:"CAN"},{firstName:"Cristian",lastName:"Garin",sex:"MALE",nationalityCode:"CHI"},{firstName:"John",lastName:"Isner",sex:"MALE",nationalityCode:"USA"},{firstName:"Borna",lastName:"Coric",sex:"MALE",nationalityCode:"CRO"},{firstName:"Alex",lastName:"de Minaur",sex:"MALE",nationalityCode:"AUS"},{firstName:"Dusan",lastName:"Lajovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Casper",lastName:"Ruud",sex:"MALE",nationalityCode:"NOR"},{firstName:"Benoit",lastName:"Paire",sex:"MALE",nationalityCode:"FRA"},{firstName:"Taylor",lastName:"Fritz",sex:"MALE",nationalityCode:"USA"},{firstName:"Filip",lastName:"Krajinovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Hubert",lastName:"Hurkacz",sex:"MALE",nationalityCode:"POL"},{firstName:"Ugo",lastName:"Humbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Daniel",lastName:"Evans",sex:"MALE",nationalityCode:"GBR"},{firstName:"Jan-Lennard",lastName:"Struff",sex:"MALE",nationalityCode:"GER"},{firstName:"Reilly",lastName:"Opelka",sex:"MALE",nationalityCode:"USA"},{firstName:"Nikoloz",lastName:"Basilashvili",sex:"MALE",nationalityCode:"GEO"},{firstName:"Kei",lastName:"Nishikori",sex:"MALE",nationalityCode:"JPN"},{firstName:"Guido",lastName:"Pella",sex:"MALE",nationalityCode:"ARG"},{firstName:"Adrian",lastName:"Mannarino",sex:"MALE",nationalityCode:"FRA"},{firstName:"Miomir",lastName:"Kecmanovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Marin",lastName:"Cilic",sex:"MALE",nationalityCode:"CRO"},{firstName:"Lorenzo",lastName:"Sonego",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jannik",lastName:"Sinner",sex:"MALE",nationalityCode:"ITA"},{firstName:"Nick",lastName:"Kyrgios",sex:"MALE",nationalityCode:"AUS"},{firstName:"John",lastName:"Millman",sex:"MALE",nationalityCode:"AUS"},{firstName:"Albert",lastName:"Ramos-Vinolas",sex:"MALE",nationalityCode:"ESP"},{firstName:"Kyle",lastName:"Edmund",sex:"MALE",nationalityCode:"GBR"},{firstName:"Tennys",lastName:"Sandgren",sex:"MALE",nationalityCode:"USA"},{firstName:"Alexander",lastName:"Bublik",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Sam",lastName:"Querrey",sex:"MALE",nationalityCode:"USA"},{firstName:"Yoshihito",lastName:"Nishioka",sex:"MALE",nationalityCode:"JPN"},{firstName:"Marton",lastName:"Fucsovics",sex:"MALE",nationalityCode:"HUN"},{firstName:"Aljaz",lastName:"Bedene",sex:"MALE",nationalityCode:"SLO"},{firstName:"Laslo",lastName:"Djere",sex:"MALE",nationalityCode:"SRB"},{firstName:"Richard",lastName:"Gasquet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pablo",lastName:"Andujar",sex:"MALE",nationalityCode:"ESP"},{firstName:"Jo-Wilfried",lastName:"Tsonga",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gilles",lastName:"Simon",sex:"MALE",nationalityCode:"FRA"},{firstName:"Tommy",lastName:"Paul",sex:"MALE",nationalityCode:"USA"},{firstName:"Jordan",lastName:"Thompson",sex:"MALE",nationalityCode:"AUS"},{firstName:"Fernando",lastName:"Verdasco",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alejandro",lastName:"Davidovich Fokina",sex:"MALE",nationalityCode:"ESP"},{firstName:"Feliciano",lastName:"Lopez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Frances",lastName:"Tiafoe",sex:"MALE",nationalityCode:"USA"},{firstName:"Dominik",lastName:"Koepfer",sex:"MALE",nationalityCode:"GER"},{firstName:"Jiri",lastName:"Vesely",sex:"MALE",nationalityCode:"CZE"},{firstName:"Pablo",lastName:"Cuevas",sex:"MALE",nationalityCode:"URU"},{firstName:"Ricardas",lastName:"Berankis",sex:"MALE",nationalityCode:"LTU"},{firstName:"Lucas",lastName:"Pouille",sex:"MALE",nationalityCode:"FRA"},{firstName:"Cameron",lastName:"Norrie",sex:"MALE",nationalityCode:"GBR"},{firstName:"Steve",lastName:"Johnson",sex:"MALE",nationalityCode:"USA"},{firstName:"Jeremy",lastName:"Chardy",sex:"MALE",nationalityCode:"FRA"},{firstName:"Stefano",lastName:"Travaglia",sex:"MALE",nationalityCode:"ITA"},{firstName:"Corentin",lastName:"Moutet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Juan",lastName:"Ignacio Londero",sex:"MALE",nationalityCode:"ARG"},{firstName:"Federico",lastName:"Delbonis",sex:"MALE",nationalityCode:"ARG"},{firstName:"Marco",lastName:"Cecchinato",sex:"MALE",nationalityCode:"ITA"},{firstName:"Thiago",lastName:"Monteiro",sex:"MALE",nationalityCode:"BRA"},{firstName:"Salvatore",lastName:"Caruso",sex:"MALE",nationalityCode:"ITA"},{firstName:"Lloyd",lastName:"Harris",sex:"MALE",nationalityCode:"RSA"},{firstName:"Vasek",lastName:"Pospisil",sex:"MALE",nationalityCode:"CAN"},{firstName:"Pierre-Hugues",lastName:"Herbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Egor",lastName:"Gerasimov",sex:"MALE",nationalityCode:"BLR"},{firstName:"Joao",lastName:"Sousa",sex:"MALE",nationalityCode:"POR"},{firstName:"Radu",lastName:"Albot",sex:"MALE",nationalityCode:"MDA"},{firstName:"Marcos",lastName:"Giron",sex:"MALE",nationalityCode:"USA"},{firstName:"Mikael",lastName:"Ymer",sex:"MALE",nationalityCode:"SWE"},{firstName:"Attila",lastName:"Balazs",sex:"MALE",nationalityCode:"HUN"},{firstName:"Federico",lastName:"Coria",sex:"MALE",nationalityCode:"ARG"},{firstName:"Soonwoo",lastName:"Kwon",sex:"MALE",nationalityCode:"KOR"},{firstName:"Mikhail",lastName:"Kukushkin",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Dennis",lastName:"Novak",sex:"MALE",nationalityCode:"AUT"},{firstName:"Pedro",lastName:"Martinez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Philipp",lastName:"Kohlschreiber",sex:"MALE",nationalityCode:"GER"},{firstName:"Yannick",lastName:"Hanfmann",sex:"MALE",nationalityCode:"GER"},{firstName:"Gianluca",lastName:"Mager",sex:"MALE",nationalityCode:"ITA"},{firstName:"James",lastName:"Duckworth",sex:"MALE",nationalityCode:"AUS"},{firstName:"Emil",lastName:"Ruusuvuori",sex:"MALE",nationalityCode:"FIN"},{firstName:"Yasutaka",lastName:"Uchiyama",sex:"MALE",nationalityCode:"JPN"},{firstName:"Roberto",lastName:"Carballes Baena",sex:"MALE",nationalityCode:"ESP"},{firstName:"Ashleigh",lastName:"Barty",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Simona",lastName:"Halep",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Naomi",lastName:"Osaka",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Sofia",lastName:"Kenin",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Elina",lastName:"Svitolina",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Karolina",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Bianca",lastName:"Andreescu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Petra",lastName:"Kvitova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Kiki",lastName:"Bertens",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Serena",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aryna",lastName:"Sabalenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Belinda",lastName:"Bencic",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Victoria",lastName:"Azarenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Johanna",lastName:"Konta",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Garbine",lastName:"Muguruza",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Madison",lastName:"Keys",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Iga",lastName:"Swiatek",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Petra",lastName:"Martic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Elena",lastName:"Rybakina",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Marketa",lastName:"Vondrousova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Elise",lastName:"Mertens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Maria",lastName:"Sakkari",sex:"FEMALE",nationalityCode:"GRE"},{firstName:"Anett",lastName:"Kontaveit",sex:"FEMALE",nationalityCode:"EST"},{firstName:"Jennifer",lastName:"Brady",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelique",lastName:"Kerber",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Alison",lastName:"Riske",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Karolina",lastName:"Muchova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Yulia",lastName:"Putintseva",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Dayana",lastName:"Yastremska",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Amanda",lastName:"Anisimova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Ons",lastName:"Jabeur",sex:"FEMALE",nationalityCode:"TUN"},{firstName:"Donna",lastName:"Vekic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Ekaterina",lastName:"Alexandrova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qiang",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Shuai",lastName:"Zhang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Svetlana",lastName:"Kuznetsova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Barbora",lastName:"Strycova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Anastasia",lastName:"Pavlyuchenkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Sloane",lastName:"Stephens",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Magda",lastName:"Linette",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Saisai",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Fiona",lastName:"Ferro",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Caroline",lastName:"Garcia",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Jelena",lastName:"Ostapenko",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Danielle",lastName:"Collins",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Veronika",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Cori",lastName:"Gauff",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Nadia",lastName:"Podoroska",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Kristina",lastName:"Mladenovic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Laura",lastName:"Siegemund",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Marie",lastName:"Bouzkova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Polona",lastName:"Hercog",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Alize",lastName:"Cornet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Anastasija",lastName:"Sevastova",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Rebecca",lastName:"Peterson",sex:"FEMALE",nationalityCode:"SWE"},{firstName:"Patricia",lastName:"Maria Tig",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Jil",lastName:"Teichmann",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Shelby",lastName:"Rogers",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Heather",lastName:"Watson",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Anna",lastName:"Blinkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Bernarda",lastName:"Pera",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Jessica",lastName:"Pegula",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alison",lastName:"Van Uytvanck",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Katerina",lastName:"Siniakova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Sara",lastName:"Sorribes Tormo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Su-Wei",lastName:"Hsieh",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Ajla",lastName:"Tomljanovic",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Kristyna",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Paula",lastName:"Badosa",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Daria",lastName:"Kasatkina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nao",lastName:"Hibino",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Arantxa",lastName:"Rus",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lauren",lastName:"Davis",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Krejcikova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Camila",lastName:"Giorgi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Irina-Camelia",lastName:"Begu",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Danka",lastName:"Kovinic",sex:"FEMALE",nationalityCode:"MNE"},{firstName:"Venus",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Zarina",lastName:"Diyas",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Christina",lastName:"Mchale",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Madison",lastName:"Brengle",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Carla",lastName:"Suarez Navarro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Martina",lastName:"Trevisan",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Kirsten",lastName:"Flipkens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Misaki",lastName:"Doi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Tamara",lastName:"Zidansek",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Sorana",lastName:"Cirstea",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Leylah",lastName:"Fernandez",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Taylor",lastName:"Townsend",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Lin",lastName:"Zhu",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Ana",lastName:"Bogdan",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Aliaksandra",lastName:"Sasnovich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Yafan",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Jasmine",lastName:"Paolini",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Varvara",lastName:"Gracheva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Viktoria",lastName:"Kuzmova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Nina",lastName:"Stojanovic",sex:"FEMALE",nationalityCode:"SRB"},{firstName:"Anastasia",lastName:"Potapova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Andrea",lastName:"Petkovic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kaja",lastName:"Juvan",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Elsa",lastName:"Jacquemot",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Victoria",lastName:"Jimenez Kasintseva",sex:"FEMALE",nationalityCode:"AND"},{firstName:"Alexandra",lastName:"Eala",sex:"FEMALE",nationalityCode:"PHI"},{firstName:"Diane",lastName:"Parry",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Daria",lastName:"Snigur",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Polina",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Robin",lastName:"Montgomery",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alexandra",lastName:"Vecic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kristina",lastName:"Dmitruk",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Alexa",lastName:"Noel",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Kamilla",lastName:"Bartone",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Weronika",lastName:"Baszak",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Oksana",lastName:"Selekhmeteva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Alina",lastName:"Charaeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Maria",lastName:"Bondarenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Priska",lastName:"Madelyn Nugroho",sex:"FEMALE",nationalityCode:"INA"},{firstName:"Linda",lastName:"Fruhvirtova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Dana",lastName:"Guzman",sex:"FEMALE",nationalityCode:"PER"},{firstName:"Linda",lastName:"Noskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Hong",lastName:"Yi Cody Wong",sex:"FEMALE",nationalityCode:"HKG"},{firstName:"Zhuoxuan",lastName:"Bai",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Mell",lastName:"Reasco Gonzalez",sex:"FEMALE",nationalityCode:"ECU"},{firstName:"Matilda",lastName:"Mutavdzic",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Diana",lastName:"Shnaider",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qinwen",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Alexandra",lastName:"Yepifanova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Matilde",lastName:"Paoletti",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Melania",lastName:"Delai",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jana",lastName:"Kolodynska",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Guillermina",lastName:"Grant",sex:"FEMALE",nationalityCode:"URU"},{firstName:"Darja",lastName:"Vidmanova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Melodie",lastName:"Collard",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Elvina",lastName:"Kalieva",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Sofia",lastName:"Costoulas",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Aliona",lastName:"Falei",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Mai",lastName:"Nirundorn",sex:"FEMALE",nationalityCode:"THA"},{firstName:"Elizabeth",lastName:"Coleman",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aubane",lastName:"Droguet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Madison",lastName:"Sieg",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Natsumi",lastName:"Kawaguchi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Leyre",lastName:"Romero Gormaz",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Elina",lastName:"Avanesyan",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Oceane",lastName:"Babel",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ziva",lastName:"Falkner",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Julia",lastName:"Garcia",sex:"FEMALE",nationalityCode:"MEX"},{firstName:"Natalia",lastName:"Szabanin",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Erika",lastName:"Andreeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Celia",lastName:"Belle Mohr",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ane",lastName:"Mintegi Del Olmo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Sebastianna",lastName:"Scilipoti",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Ana",lastName:"Geller",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Dayeon",lastName:"Back",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Selena",lastName:"Janicijevic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Romana",lastName:"Cisovska",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Amarissa",lastName:"Kiara Toth",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Mara",lastName:"Guth",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Evialina",lastName:"Laskevich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Julia",lastName:"Avdeeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Beatrice",lastName:"Ricci",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Eleonora",lastName:"Alvisi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jessica",lastName:"Bouzas Maneiro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Julie",lastName:"Belgraver",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lisa",lastName:"Pigato",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Ya",lastName:"Yi Yang",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Eva",lastName:"Lys",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Talia",lastName:"Gibson",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Yeon",lastName:"Ku",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Katrina",lastName:"Scott",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Palicova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Alina",lastName:"Shcherbinina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Giulia",lastName:"Morlet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tina",lastName:"Nadine Smith",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Sohyun",lastName:"Park",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Tara",lastName:"Wurth",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Polina",lastName:"Iatcenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Lauren",lastName:"Anzalotta Kynoch",sex:"FEMALE",nationalityCode:"PUR"},{firstName:"Savannah",lastName:"Broadus",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelina",lastName:"Wirges",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Amarni",lastName:"Banks",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Hanne",lastName:"Vandewinkel",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Jada",lastName:"Bui",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Sabina",lastName:"Zeynalova",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Pia",lastName:"Lovric",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Erika",lastName:"Matsuda",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Lyubov",lastName:"Kostenko",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Anaelle",lastName:"Leclercq",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Alessandra",lastName:"Simone",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Darja",lastName:"Semenistaja",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Daria",lastName:"Frayman",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nastasja",lastName:"Schunk",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Olivia",lastName:"Gadecki",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"India",lastName:"Houghton",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Maria",lastName:"Sholokhova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Julia",lastName:"Middendorf",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Petra",lastName:"Marcinko",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Radka",lastName:"Zelnickova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Lucie",lastName:"Nguyen Tan",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tatiana",lastName:"Barkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Annabelle",lastName:"Xu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Harold",lastName:"Mayot",sex:"MALE",nationalityCode:"FRA"},{firstName:"Holger",lastName:"Vitus Nodskov Rune",sex:"MALE",nationalityCode:"DEN"},{firstName:"Dominic",lastName:"Stephan Stricker",sex:"MALE",nationalityCode:"SUI"},{firstName:"Shintaro",lastName:"Mochizuki",sex:"MALE",nationalityCode:"JPN"},{firstName:"Arthur",lastName:"Cazaux",sex:"MALE",nationalityCode:"FRA"},{firstName:"Leandro",lastName:"Riedi",sex:"MALE",nationalityCode:"SUI"},{firstName:"Martin",lastName:"Damm",sex:"MALE",nationalityCode:"USA"},{firstName:"Natan",lastName:"Rodrigues",sex:"MALE",nationalityCode:"BRA"},{firstName:"Karlis",lastName:"Ozolins",sex:"MALE",nationalityCode:"LAT"},{firstName:"Luciano",lastName:"Darderi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Hanwen",lastName:"Li",sex:"MALE",nationalityCode:"CHN"},{firstName:"Arthur",lastName:"Fery",sex:"MALE",nationalityCode:"GBR"},{firstName:"Juan",lastName:"Bautista Torres",sex:"MALE",nationalityCode:"ARG"},{firstName:"Khololwam",lastName:"Montsi",sex:"MALE",nationalityCode:"RSA"},{firstName:"Jeffrey",lastName:"Von Der Schulenburg",sex:"MALE",nationalityCode:"SUI"},{firstName:"Timo",lastName:"Legout",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gustavo",lastName:"Heide",sex:"MALE",nationalityCode:"BRA"},{firstName:"Flavio",lastName:"Cobolli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Guy",lastName:"Den Ouden",sex:"MALE",nationalityCode:"NED"},{firstName:"Martin",lastName:"Breysach",sex:"MALE",nationalityCode:"FRA"},{firstName:"Toby",lastName:"Kodat",sex:"MALE",nationalityCode:"USA"},{firstName:"Lilian",lastName:"Marmousez",sex:"MALE",nationalityCode:"FRA"},{firstName:"Roman",lastName:"Andres Burruchaga",sex:"MALE",nationalityCode:"ARG"},{firstName:"Alex",lastName:"Barrena",sex:"MALE",nationalityCode:"ARG"},{firstName:"Dalibor",lastName:"Svrcina",sex:"MALE",nationalityCode:"CZE"},{firstName:"Martin",lastName:"Krumich",sex:"MALE",nationalityCode:"CZE"},{firstName:"Peter",lastName:"Fajta",sex:"MALE",nationalityCode:"HUN"},{firstName:"Lukas",lastName:"Neumayer",sex:"MALE",nationalityCode:"AUT"},{firstName:"Raphael",lastName:"Collignon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Dali",lastName:"Blanch",sex:"MALE",nationalityCode:"USA"},{firstName:"Terence",lastName:"Atmane",sex:"MALE",nationalityCode:"FRA"},{firstName:"Felix",lastName:"Gill",sex:"MALE",nationalityCode:"GBR"},{firstName:"Eliakim",lastName:"Coulibaly",sex:"MALE",nationalityCode:"CIV"},{firstName:"Hamad",lastName:"Medjedovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Jerome",lastName:"Kym",sex:"MALE",nationalityCode:"SUI"},{firstName:"Nicholas",lastName:"David Ionel",sex:"MALE",nationalityCode:"ROU"},{firstName:"Shunsuke",lastName:"Mitsui",sex:"MALE",nationalityCode:"JPN"},{firstName:"Giovanni",lastName:"Mpetshi Perricard",sex:"MALE",nationalityCode:"FRA"},{firstName:"Bu",lastName:"Yunchaokete",sex:"MALE",nationalityCode:"CHN"},{firstName:"Jack",lastName:"Pinnington Jones",sex:"MALE",nationalityCode:"GBR"},{firstName:"Alexander",lastName:"Hoogmartens",sex:"MALE",nationalityCode:"BEL"},{firstName:"Bruno",lastName:"Oliveira",sex:"MALE",nationalityCode:"BRA"},{firstName:"Maks",lastName:"Kasnikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Mikolaj",lastName:"Lorens",sex:"MALE",nationalityCode:"POL"},{firstName:"Chak",lastName:"Lam Coleman Wong",sex:"MALE",nationalityCode:"HKG"},{firstName:"Egor",lastName:"Agafonov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Mans",lastName:"Dahlberg",sex:"MALE",nationalityCode:"SWE"},{firstName:"Marat",lastName:"Sharipov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Luca",lastName:"Nardi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Sean",lastName:"Cuenin",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pedro",lastName:"Boscardin Dias",sex:"MALE",nationalityCode:"BRA"},{firstName:"Samuel",lastName:"Vincent Ruggeri",sex:"MALE",nationalityCode:"ITA"},{firstName:"Bruno",lastName:"Kuzuhara",sex:"MALE",nationalityCode:"USA"},{firstName:"Romain",lastName:"Faucon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Elmer",lastName:"Moller",sex:"MALE",nationalityCode:"DEN"},{firstName:"Mario",lastName:"Mansilla Diez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Leonardo",lastName:"Malgaroli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Pierre",lastName:"Yves Bailly",sex:"MALE",nationalityCode:"BEL"},{firstName:"Sebastian",lastName:"Gima",sex:"MALE",nationalityCode:"ROU"},{firstName:"Ilya",lastName:"Snitari",sex:"MALE",nationalityCode:"MDA"},{firstName:"Diego",lastName:"Augusto Barreto Sanchez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alexander",lastName:"Bernard",sex:"MALE",nationalityCode:"USA"},{firstName:"Pengyu",lastName:"Lu",sex:"MALE",nationalityCode:"CHN"},{firstName:"Max",lastName:"Wiskandt",sex:"MALE",nationalityCode:"GER"},{firstName:"Max",lastName:"Westphal",sex:"MALE",nationalityCode:"FRA"},{firstName:"Lorenzo",lastName:"Claverie",sex:"MALE",nationalityCode:"VEN"},{firstName:"Axel",lastName:"Garcian",sex:"MALE",nationalityCode:"FRA"},{firstName:"Aleksander",lastName:"Orlikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Maxwell",lastName:"Mckennon",sex:"MALE",nationalityCode:"USA"},{firstName:"Rafael",lastName:"Alfonso De Alba Valdes",sex:"MALE",nationalityCode:"MEX"},{firstName:"Dev",lastName:"Javia",sex:"MALE",nationalityCode:"IND"},{firstName:"Kokoro",lastName:"Isomura",sex:"MALE",nationalityCode:"JPN"},{firstName:"Matteo",lastName:"Gigante",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jack",lastName:"Anthrop",sex:"MALE",nationalityCode:"USA"},{firstName:"Pablo",lastName:"Llamas Ruiz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Biagio",lastName:"Gramaticopolo",sex:"MALE",nationalityCode:"ITA"},{firstName:"Patorn",lastName:"Hanchaikul",sex:"MALE",nationalityCode:"THA"},{firstName:"Marko",lastName:"Topo",sex:"MALE",nationalityCode:"SRB"},{firstName:"Carlos",lastName:"Alcaraz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Juncheng",lastName:"Shang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Toby",lastName:"Samuel",sex:"MALE",nationalityCode:"GBR"},{firstName:"Petr",lastName:"Nesterov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Mehdi",lastName:"Sadaoui",sex:"MALE",nationalityCode:"FRA"},{firstName:"Max",lastName:"Alcala Gurri",sex:"MALE",nationalityCode:"ESP"},{firstName:"Nikita",lastName:"Kashirin",sex:"MALE",nationalityCode:"RUS"},{firstName:"Aidan",lastName:"Mayo",sex:"MALE",nationalityCode:"USA"},{firstName:"Yu",lastName:"Zhang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Philip",lastName:"Sekulic",sex:"MALE",nationalityCode:"AUS"},{firstName:"Lorenzo",lastName:"Rottoli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Michal",lastName:"Novansky",sex:"MALE",nationalityCode:"SVK"},{firstName:"Maikel",lastName:"De Boes",sex:"MALE",nationalityCode:"BEL"},{firstName:"Chen",lastName:"Dong",sex:"MALE",nationalityCode:"AUS"},{firstName:"Evgeny",lastName:"Philippov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Damien",lastName:"Salvestre",sex:"MALE",nationalityCode:"FRA"},{firstName:"Francesco",lastName:"Maestrelli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Viacheslav",lastName:"Bielinskyi",sex:"MALE",nationalityCode:"UKR"},{firstName:"Jean",lastName:"Marc Malkowski",sex:"MALE",nationalityCode:"SUI"},{firstName:"Santiago",lastName:"De La Fuente",sex:"MALE",nationalityCode:"ARG"},{firstName:"Simeon",lastName:"Terziev",sex:"MALE",nationalityCode:"BUL"},{firstName:"Benjamin",lastName:"Kittay",sex:"MALE",nationalityCode:"USA"}];var Nv=["Avengers","Predators","Dynamos","Warriors","Captivators","Dragons","Explosive Win Machine","Pirates","Hawk Eyes","Killer Instinct","Masters of Mayhem","Matter Catchers","Mindspace Invaders","Goal Gurus","Raiders","Seekers","Sparkle Soul Tribe","The Achievers","The Blazers","The Breezers","The Bruisers","The Civil Disobedients","The Eliminators","The Mavericks","The Mean Machines","The Punters","The Sandeaters","The Visual Spectacle","Total Demolition","Touch and Go","Vertically Challenged","Win Machines","Wind Chasers","Worker Bees","Razorbacks","Rebels","Fighting Crusaders","Comets","Commodores","Green Machine","Continentals"];function Pv({count:t=1}={}){return{teams:Q(Nv).slice(0,t)}}function Ev({valuesInstanceLimit:t,nationalityCodesCount:e,nationalityCodeType:i,nationalityCodes:n,participantsCount:r=32,participantType:a,personIds:o,uuids:s,personExtensions:c,addressProps:u,matchUpType:d,personData:l,sex:p,inContext:h}){const f=a===Oa||d===da,m=a===ka||d===ka,g=r*(f?2:m?8:1),{persons:v,error:y}=function({personExtensions:t,personData:e,count:i=1,sex:n}={}){if(isNaN(i))return{error:_i};let r=Uv.filter((t=>!n||t.sex===n));if(Array.isArray(e)){const t=e.filter((t=>"string"==typeof t.firstName&&"string"==typeof t.lastName&&!![If,wf].includes(t.sex)&&!("string"!=typeof t.nationalityCode||t.nationalityCode.length>3)));if(!t.length)return{error:_i};r=t}const a=Q(r);if(a.length<i){const{maleFirstNames:t,maleLastNames:e,femaleFirstNames:r,femaleLastNames:o,nationalityCodes:s}=Uv.reduce(((t,e)=>{const{firstName:i,lastName:n,nationalityCode:r}=e;return e.sex===If?(t.maleFirstNames.includes(i)||t.maleFirstNames.push(i),t.maleLastNames.includes(n)||t.maleLastNames.push(n)):(t.femaleFirstNames.includes(i)||t.femaleFirstNames.push(i),t.femaleLastNames.includes(n)||t.femaleLastNames.push(n)),t.nationalityCodes.includes(r)||t.nationalityCodes.push(r),t}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});rt(0,i-a.length).forEach((()=>{const i=n||nt([If,wf]),c=nt(s),u={firstName:nt(i===If?t:r),lastName:nt(i===If?e:o),sex:i,nationalityCode:c};a.push(u)}))}const o=a.slice(0,i).map(((e,i)=>Object.assign(e,{extensions:t||[{name:"regionCode",value:i+1}],isMock:!0})));return{persons:o.length&&o||a[0]}}({count:g,personExtensions:c,personData:l,sex:p});if(y)return{error:y};const I=ko.filter((t=>"ISO"===i?t.iso:t.ioc)),{citiesCount:w,statesCount:S,postalCodesCount:b}=u||{};const{cities:U}=function({count:t=1,participantsCount:e=32}={}){const i=Q(bv),n=i.slice(0,t);return{cities:rt(0,e).map((e=>e<Math.min(t,i.length)?n[e]:nt(n)))}}({count:w||g,participantsCount:g}),{states:N}=function({count:t=1,participantsCount:e=32}={}){const i=Q(Sv),n=i.slice(0,t).map((t=>Object.keys(t))).flat();return{states:rt(0,e).map((e=>e<Math.min(t,i.length)?n[e]:nt(n)))}}({count:S||g,participantsCount:g}),{postalCodes:P}=function({count:t=1,participantsCount:e=32}={}){const i=rt(0,t).map((()=>rt(0,5).map((()=>Y(0,9))).join("")));return{postalCodes:rt(0,e).map((e=>e<t?i[e]:nt(i)))}}({count:b||g,participantsCount:g}),E={cities:U,states:N,postalCodes:P},D=function(e){const i=Math.ceil(g/e);return t&&i>t?Math.ceil(g/t):e}(e),A=D?Q(I).slice(0,e):n?I.filter((t=>n.includes(t.key))):I,T=Q(rt(0,Math.ceil(g/(D||1))).map((()=>A)).flat(1/0));return{participants:rt(0,r).map((t=>{const e=f?2:m?8:1,i=rt(0,e).map((i=>function(t){const e=v[t],{sex:i,firstName:n,lastName:r,extensions:a,nationalityCode:c}=e||{},u=n||"GivenName",d=r||"FamilyName",l=`${u} ${d}`,p=T[t],h=p&&(p.ioc||p.iso)||c;null==T||!T.length||h||c||console.log("%c Invalid Nationality Code",{participantIndex:t,country:p});const f=function(t){const{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{city:e&&e[a],state:i&&i[a],postalCode:n&&n[a],countryCode:r}}({...E,participantIndex:t,nationalityCode:h});return{participantId:(null==s?void 0:s.pop())||qn(),participantType:Ra,participantRole:Ih,participantName:l,person:{addresses:[f],personId:(null==o?void 0:o.length)&&o[t]||qn(),standardFamilyName:d,standardGivenName:u,nationalityCode:h,extensions:a,sex:i}}}(t*e+i))),n=i.map((t=>t.participantId)),r=i.map((t=>t.person.standardFamilyName)).join("/"),a={participantId:(null==s?void 0:s.pop())||qn(),participantType:f?Oa:ka,participantRole:Ih,participantName:f?r:Pv().teams[0],individualParticipantIds:n};return h&&(a.individualParticipants=i),f||m?[a,...i]:i})).flat()}}const Dv={[R]:2,[E]:1,[C]:1,[P]:4};function Av({matchUpFormat:t="SET3-S:6/TB7",matchUpStatusProfile:e=Dv,pointsPerMinute:i=1,sideWeight:n=4,winningSide:r,defaultWithScorePercent:a=2}){if(!v(t))return{error:se};if("object"!=typeof e)return{error:_i};if(a>100&&(a=100),isNaN(a)||isNaN(i)||isNaN(n))return{error:_i};const o=Object.keys(e).filter((t=>Object.keys(V).includes(t)&&t!==U));if(Object.keys(o).reduce(((t,i)=>t+e[i]),0)>100)return{error:_i,matchUpStatusProfile:e};const s=o.reduce(((t,i)=>(t.pointer=t.pointer+e[i],t.valueMap.push([t.pointer,i]),t)),{pointer:0,valueMap:[]}),c=Y(1,100),u=(s.valueMap.find((t=>c<=t[0]))||[100,U])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([R,P].includes(u)){const t={score:d,winningSide:r=r||Y(1,2),matchUpStatus:u};if(!(u===P&&Y(1,100)>100-a))return{outcome:t}}else if(u===E)return{outcome:{score:d,matchUpStatus:u}};const p=l(t),{bestOf:h,setFormat:f,finalSetFormat:m}=p,g=[],y=Y(0,1),I=r?[r-1]:[...rt(0,n).map((()=>y)),1-y],w=[C,P,A,M].includes(u)&&(it(rt(1,h))||1);let S;for(const l of rt(1,h+1)){const e=l===h,{set:n,incomplete:r,winningSideNumber:a}=Tv({incomplete:w===l,matchUpStatus:u,pointsPerMinute:i,setFormat:e&&m||f,setNumber:l,weightedRange:I});if(g.push(n),r){S=a;break}if(xo({matchUp:{score:{sets:g},matchUpFormat:t}}).calculatedWinningSide)break}const b=xo({matchUp:{score:{sets:g},matchUpFormat:t}}),N=S?r||S:b.calculatedWinningSide,{score:D}=Hl({score:{sets:g},winningSide:N,matchUpStatus:u});return{outcome:{score:D,winningSide:N,matchUpStatus:u}}}function Tv({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){const o={setNumber:a},{setTo:s,tiebreakFormat:c,tiebreakAt:u,tiebreakSet:d,timed:l,minutes:p}=r,h=Y(0,t.length-1),f=t[h];let m;if(l){const r=p*e,a=Math.round(.2*r),s=r+it([1,-1])*a,c=function(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}(s,2),u=[c,s-c];f&&u.reverse(),m=t[h]+1;let d=u[0]>u[1]?1:u[1]>u[0]?2:0;if(n){const[t,e]=u;return Object.assign(o,{side1Score:t,side2Score:e}),F.includes(i)?{set:o,incomplete:n,winningSideNumber:m}:{set:o,incomplete:n}}d||(u[Y(0,1)]+=1),d=u[0]>u[1]?1:2,d!==m&&u.reverse();const[l,g]=u;return Object.assign(o,{side1Score:l,side2Score:g,winningSide:m}),{set:o}}if(n)return o.side1Score=Y(0,u),o.side2Score=Y(0,u),F.includes(i)&&(m=t[h]+1),{set:o,incomplete:n,winningSideNumber:m};{const e=rt(1,s+1).map((t=>rt(0,s+2-t).map((()=>t)))).flat(),i=e[Y(0,e.length-1)],n=s&&Fa({isSide1:!0,tiebreakAt:u,lowValue:i,setTo:s}),a=!n,l=1===t.length&&t[h]+1;if(!a){if(l){(n[0]>n[1]?1:2)!==l&&n.reverse()}else f&&n.reverse();const[t,e]=n;Object.assign(o,{side1Score:t,side2Score:e})}const p=Mo({matchUpScoringFormat:{setFormat:r},setObject:o});let m;if(p.hasTiebreakCondition||a){const{NoAD:t,tiebreakTo:e}=c||d,i=rt(1,e+1).map((t=>rt(0,e+2-t).map((()=>t)))).flat(),n=i[Y(0,i.length-1)];let r=ja({isSide1:!0,lowValue:n,tiebreakTo:e,tiebreakNoAd:t});if(a){const t=r[0]>r[1]?1:2;l?t!==l&&r.reverse():f&&r.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=r,m=r[0]>r[1]?1:2}else 2===p.leadingSide?[o.side1TiebreakScore,o.side2TiebreakScore]=r:[o.side2TiebreakScore,o.side1TiebreakScore]=r}o.winningSide=p.winningSide||p.leadingSide||l||m}return{set:o}}function Cv({matchUpFormat:t,drawDefinition:e,randomWinningSide:i,completeAllMatchUps:n,matchUpStatusProfile:r,event:a}){const o=e.structures.slice().sort(Fc),s="string"==typeof n&&n,c=s&&U;for(const u of o){const n=Lc({drawDefinition:e}),{matchUps:o}=Ru({inContext:!0,drawDefinition:e,matchUpsMap:n,structure:u,event:a}),d=o.filter((({winningSide:t})=>!t)).sort(Vd).map(Rc);for(const l of d){const{matchUps:o}=Ru({inContext:!0,drawDefinition:e,matchUpsMap:n,structure:u,event:a}),d=o.find((t=>t.matchUpId===l)),p=d.matchUpStatus===E;if(null!=d&&d.readyToScore&&!p){const n=xv({drawDefinition:e,targetMatchUp:d,matchUpFormat:t,winningSide:!i&&1,matchUpStatus:c,scoreString:s,matchUpStatusProfile:r});if(n.error)return n}}}return{...dt}}function Mv({drawDefinition:t,targetMatchUp:e,matchUpStatus:i,matchUpFormat:n,scoreString:r,winningSide:a}){if(!e||e.matchUpStatus===S)return;const{matchUpId:o}=e||{},{outcome:s}=wv({scoreString:r,winningSide:a,matchUpStatus:i});return Wl({drawDefinition:t,matchUpFormat:n,matchUpId:o,outcome:s})}function xv(t){const{targetMatchUp:e,scoreString:i,winningSide:n,matchUpStatus:r,matchUpFormat:a,drawDefinition:o,matchUpStatusProfile:s={}}=t;if(i||r)return Mv(t);const{matchUpId:c}=e||{},{outcome:u}=Av({matchUpFormat:a,winningSide:n,matchUpStatusProfile:s});return Wl({drawDefinition:o,matchUpId:c,outcome:u,matchUpFormat:a})}function Rv({allUniqueParticipantIds:t,matchUpStatusProfile:e,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:r,randomWinningSide:a,tournamentRecord:o,eventProfile:s,startDate:c,uuids:u}){let d=s.gender;const{eventName:l="Generated Event",eventType:p=Ea,policyDefinitions:h,drawProfiles:f=[],eventExtensions:m,surfaceCategory:g,discipline:v,eventLevel:y,ballType:I,category:w}=s,S=s.tieFormat||p===Aa&&rg();let b=o.participants,U=[];for(const H of f)!d&&H.gender&&(d=null==H?void 0:H.gender);let N={};const P=f.reduce(((t,e)=>{const{qualifyingPositions:i=0,participantsCount:n=0,uniqueParticipants:r,stage:a=Oo,drawSize:o=0}=e||{};Object.keys(t).includes(a)||(t[a]=0);const s=n||o-i;return r||d?(Object.keys(N).includes(a)||(N[a]=0),N[a]+=s):t[a]=Math.max(s,t[a]),t}),{}),E=Object.keys(N);E.forEach((t=>P[t]+=N[t]));const D=p===Ea?Ra:p===Da?Oa:p,A=[];if(E){const{valuesInstanceLimit:t,nationalityCodesCount:e,nationalityCodeType:n,nationalityCodes:r,addressProps:a,personIds:s,inContext:c}=i||{},l=N[Oo]||0,p=N[Lo]||0,{participants:h}=Ev({participantsCount:l+p,participantType:D,sex:d,uuids:u,valuesInstanceLimit:t,nationalityCodesCount:e,nationalityCodeType:n,nationalityCodes:r,addressProps:a,personIds:s,inContext:c});let f=cp({tournamentRecord:o,participants:h});if(f.error)return f;U=h.filter((({participantType:t})=>t===D)),h.forEach((({participantId:t})=>A.push(t)))}const T=P[Oo]||0,C=P[Lo]||0,M={QUALIFYING:b.filter((({participantType:t})=>t===D)).filter((({participantId:e})=>!t.includes(e))).slice(0,C),MAIN:b.filter((({participantType:t})=>t===D)).filter((({participantId:e})=>!t.includes(e))).slice(C,C+T)};let{eventAttributes:x}=s;"object"!=typeof x&&(x={});const R=s.eventId||qn(),k={...x,surfaceCategory:g,discipline:v,eventLevel:y,eventName:l,eventType:p,tieFormat:S,ballType:I,category:w,eventId:R,gender:d};if(null!=m&&m.length&&Array.isArray(m)){const t=m.filter(Vc);null!=t&&t.length&&Object.assign(k,{extensions:t})}if("object"==typeof h)for(const H of Object.keys(h))kh({event:k,policyDefinitions:{[H]:h[H]}});let O=_f({tournamentRecord:o,event:k});if(O.error)return O;const{event:L}=O;let _=0;for(const H of f){const{drawType:t=rs,qualifyingPositions:e=0,uniqueParticipants:i,stage:n=Oo,drawSize:a=0,drawName:s,drawId:c}=H,u=a-e,l=i?U.slice(_,u):M[n||Oo]||[];(i||d)&&(_+=u);const p=l.slice(0,u).map(Mc);if(p.length){const t=Jf({participantIds:p,autoEntryPositions:r,tournamentRecord:o,stage:n,event:L});if(t.error)return t}const h=Kg({drawName:s||t,qualifyingPositions:e,drawEntries:p.map((t=>({entryStatus:eu,entryStage:n,participantId:t}))),drawId:c,event:L,stage:n});if(h.error)return h}const F=[],{flightProfile:j}=el({event:L});if(Array.isArray(null==j?void 0:j.flights))for(const[H,W]of j.flights.entries()){const{drawId:t,stage:i,drawName:r,drawEntries:s}=W;F.push(W.drawId);const u=f[H],{seedsCount:d,generate:h=!0}=u||{};if(h){var B,V,G;const h=s.filter(Qd).map(Mc),m=(null===(B=L.category)||void 0===B?void 0:B.ageCategoryCode)||(null===(V=L.category)||void 0===V?void 0:V.categoryName)||l;if(o&&d&&d<=h.length){rt(1,d+1).forEach(((t,e)=>{let i={scaleValue:t,scaleName:m,scaleType:pf,eventType:p,scaleDate:c};const n=h[e];mf({tournamentRecord:o,participantId:n,scaleItem:i})}))}let g=ag({...u,matchUpType:p,seedingScaleName:m,tournamentRecord:o,isMock:!0,drawEntries:s,drawName:r,drawId:t,event:L,stage:i});const{drawDefinition:v,error:y}=g;if(y)return{error:y};const I=null===(G=f[H])||void 0===G?void 0:G.drawExtensions;if(Array.isArray(I)&&I.filter(Vc).forEach((t=>Gc({element:v,extension:t}))),g=ap({drawDefinition:v,event:L}),g.error)return g;if(null!=u&&u.withPlayoffs){const t=v.structures[0].structureId,e=bg({idPrefix:u.idPrefix,...u.withPlayoffs,tournamentRecord:o,drawDefinition:v,structureId:t,event:L});if(null!=e&&e.error)return e}if(!(!1===(null==u?void 0:u.automated))&&n){const t=null==u?void 0:u.matchUpFormat,i=Cv({matchUpStatusProfile:e,completeAllMatchUps:n,randomWinningSide:a,drawDefinition:v,matchUpFormat:t});if(i.error)return i;if((null==u?void 0:u.drawType)===Is){let i=bm({structureId:v.structures.find((t=>t.stage===Oo)).structureId,tournamentRecord:o,drawDefinition:v,event:L});if(i.error)return i;if(i=Cv({completeAllMatchUps:n,matchUpStatusProfile:e,randomWinningSide:a,matchUpFormat:t,drawDefinition:v}),i.error)return i}}}}return{drawIds:F,eventId:R,uniqueParticipantIds:A}}function kv({allUniqueParticipantIds:t=[],matchUpStatusProfile:e,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:r,randomWinningSide:a,tournamentRecord:o,drawProfile:s,startDate:c,goesTo:u,uuids:d}){var l,p,h;const{excessParticipantAlternates:f=!0,matchUpFormat:m=y,drawType:g=rs,eventType:v=Ea,alternatesCount:I=0,eventExtensions:w,drawExtensions:S,drawSize:b=32,seedsCount:N,category:P,idPrefix:E,gender:D,stage:A}=s,T="object"==typeof s.tieFormat?s.tieFormat:v===ka&&rg({namedFormat:s.tieFormatName});let C=s.eventName||`Generated ${v}`,M=(null==o?void 0:o.participants)||[];const x=!s.participantsCount||s.participantsCount>b?b:s.participantsCount,R=qn();let k={eventId:R,eventName:C,eventType:v,category:P,tieFormat:T},{eventAttributes:O}=s;if("object"!=typeof O&&(O={}),Object.assign(k,O),null!=w&&w.length&&Array.isArray(w)){const t=w.filter(Vc);null!=t&&t.length&&Object.assign(k,{extensions:t})}const L=[];if(s.uniqueParticipants||!o||D){const t=v===Da?Oa:Ra,{valuesInstanceLimit:e,nationalityCodesCount:n,nationalityCodeType:r,nationalityCodes:a,addressProps:c,personIds:u,inContext:l}=i||{},{participants:p}=Ev({participantsCount:x+I,participantType:t,uuids:s.uuids||d,sex:D||(null==i?void 0:i.sex),valuesInstanceLimit:e,nationalityCodesCount:n,nationalityCodeType:r,nationalityCodes:a,addressProps:c,personIds:u,inContext:l});if(o){let t=cp({tournamentRecord:o,participants:p});if(t.error)return t}p.forEach((({participantId:t})=>L.push(t))),M=p}const _=t=>{const{participantType:e}=t;return v===Ea&&e===Ra||(v===Da&&e===Oa||v===ka&&e===ka)},F=t=>{var e,i;return!s.gender||((null===(e=t.person)||void 0===e?void 0:e.sex)===s.gender||(!(null===(i=t.individualParticipantIds)||void 0===i||!i.some((t=>{const e=M.find((e=>e.participantId===t));return e&&F(e)})))||void 0))},j=M.filter(_).filter(F).filter((({participantId:e})=>!t.includes(e))).slice(0,x).map((t=>t.participantId));let B=Jf({entryStage:A,autoEntryPositions:r,tournamentRecord:o,participantIds:j,event:k});if(B.error)return B;const V=f&&(null==o||null===(l=o.participants)||void 0===l?void 0:l.filter((({participantId:t})=>!j.includes(t))).filter(_).filter(F).slice(0,I||b-x).map((t=>t.participantId)));if(null!=V&&V.length&&(B=Jf({participantIds:V,autoEntryPositions:!1,entryStatus:Zc,tournamentRecord:o,event:k}),B.error))return{error:B.error};const G=(null===(p=k.category)||void 0===p?void 0:p.ageCategoryCode)||(null===(h=k.category)||void 0===h?void 0:h.categoryName)||C;if(o&&N&&N<=j.length){rt(1,N+1).forEach(((t,e)=>{let i={scaleValue:t,scaleName:G,scaleType:Nr,eventType:v,scaleDate:c};const n=j[e];mf({tournamentRecord:o,participantId:n,scaleItem:i})}))}const{drawDefinition:H,error:W}=ag({...s,tournamentRecord:o,seedingScaleName:G,matchUpFormat:m,isMock:!0,eventId:R,goesTo:u,event:k});if(W)return{error:W};Array.isArray(S)&&S.filter(Vc).forEach((t=>Gc({element:H,extension:t}))),B=ap({drawDefinition:H,event:k});const{drawId:q}=H;if(s.withPlayoffs){const t=H.structures[0].structureId,e=bg({...s.withPlayoffs,tournamentRecord:o,drawDefinition:H,structureId:t,idPrefix:E,event:k});if(null!=e&&e.error)return e}if(!(!1===s.automated)){if(s.outcomes){const{matchUps:t}=dd({drawDefinition:H,inContext:!0,event:k});for(const e of s.outcomes){const{roundNumber:i,drawPositions:n,roundPosition:r,scoreString:a,winningSide:o,stage:s=Oo,matchUpFormat:c,stageSequence:u=1,matchUpStatus:d=U,matchUpIndex:l=0,structureOrder:p}=e,h=t.reduce(((t,e)=>{const{structureId:i,matchUpId:n}=e;return t[i]?t[i].push(n):t[i]=[n],t}),{}),f=Object.assign({},...Object.keys(h).map(((t,e)=>({[t]:e+1})))),m=t.filter((t=>!(s&&t.stage!==s||u&&t.stageSequence!==u||i&&t.roundNumber!==i||r&&t.roundPosition!==r||p&&f[t.structureId]!==p||n&&2!==ot(n,t.drawPositions).length)))[l],g=Mv({drawDefinition:H,targetMatchUp:m,matchUpFormat:c,matchUpStatus:d,scoreString:a,winningSide:o,drawId:q});if(null!=g&&g.error)return g}}if(n){const t=Cv({drawDefinition:H,matchUpFormat:m,randomWinningSide:a,completeAllMatchUps:n,matchUpStatusProfile:e});if(t.error)return t;if(g===Is){let t=bm({structureId:H.structures.find((t=>t.stage===Oo)).structureId,tournamentRecord:o,drawDefinition:H,event:k});if(t=Cv({drawDefinition:H,matchUpFormat:m,randomWinningSide:a,completeAllMatchUps:n,matchUpStatusProfile:e}),t.error)return t}}}return B.error?{error:B.error}:{...dt,uniqueParticipantIds:L,targetParticipants:M,drawDefinition:H,eventId:R,drawId:q,event:k}}const Ov={generateTournamentRecord:function({tournamentName:t="Mock Tournament",tournamentExtensions:e,tournamentAttributes:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,randomWinningSide:s,policyDefinitions:c,schedulingProfile:u,eventProfiles:d,venueProfiles:l,drawProfiles:p,autoSchedule:h,startDate:f,endDate:m,goesTo:g,uuids:v}={}){let{participantsCount:y,participantType:I=Ra}=r||{};const w=y||0;if(f&&!In(f)||m&&!In(m))return{error:ke};if(!f){const t=new Date;f=Sn(m||t),m=Sn(t.setDate(t.getDate()+7))}if(!m){const t=new Date(f);m=Sn(t.setDate(t.getDate()+7))}"object"!=typeof i&&(i={});const S=Zh({...i,tournamentName:t,startDate:f,endDate:m});if(null!=e&&e.length&&Array.isArray(e)){const t=e.filter(Vc);null!=t&&t.length&&Object.assign(S,{extensions:t,isMock:!0})}if("object"==typeof c)for(const Y of Object.keys(c))Rh({policyDefinitions:{[Y]:c[Y]},tournamentRecord:S});let b=0,U=0,N=0,P=0;const E=({alternatesCount:t=0,tieFormatName:e,drawSize:i=0,eventType:n,tieFormat:r})=>{const a=n===Da,o=n===Aa;if(o){var s;let n=0,a=0;P=Math.max(P,i+t),"object"==typeof r||rg({namedFormat:e}),null==r||null===(s=r.collectionDefinitions)||void 0===s||s.forEach((e=>{if(e.collectionId||(e.collectionId=qn()),(null==e?void 0:e.matchUpType)===Da){const r=e.matchUpCount;n=Math.max(n,r),e.matchUpCount>b&&(b=r*(i+t||1))}if((null==e?void 0:e.matchUpType)===ua){const n=e.matchUpCount;a=Math.max(a,n),e.matchUpCount>U&&(U=n*(i+t||1))}}));const o=Math.max(a,2*n);N=Math.max(N,o)}a&&i+t&&i+t>b&&(b=i+t),!a&&!o&&i&&i>U&&(U=i+t)};if(null==d||d.forEach((({eventType:t,drawProfiles:e})=>{if(e)for(const i of e){const{drawSize:e,alternatesCount:n,tieFormat:r,tieFormatName:a}=i;E({alternatesCount:n,tieFormatName:a,eventType:t,tieFormat:r,drawSize:e})}})),p)for(const Y of p){const{drawSize:t,alternatesCount:e,eventType:i,tieFormat:n,tieFormatName:r}=Y;E({alternatesCount:e,tieFormatName:r,eventType:i,tieFormat:n,drawSize:t})}const D=Math.max(P*N,2*b,U);b&&(I=Oa),(y||w)<D&&(y=D),y&&b&&[Oa,Aa].includes(I)&&(U&&Math.floor(U/2)>b?y=Math.floor(U/2):(!U||2*b>=U)&&(y=Math.ceil(y/2))),y||(y=32),y<w&&(y=w);const{nationalityCodesCount:A,nationalityCodeType:T,valuesInstanceLimit:C,nationalityCodes:M,personExtensions:x,teamKey:R,addressProps:k,personData:O,personIds:L,inContext:_,sex:F}=r||{},{participants:j}=Ev({valuesInstanceLimit:C,nationalityCodesCount:A,nationalityCodeType:T,nationalityCodes:M,personExtensions:x,addressProps:k,personData:O,sex:F,participantsCount:y,participantType:I,personIds:L,uuids:v,inContext:_});let B=cp({tournamentRecord:S,participants:j});if(!B.success)return B;if(R){const t=cf({tournamentRecord:S,...R});if(t.error)return t}const V=j.filter((({participantType:t})=>t===Ra)).map(Mc);if(B=cp({tournamentRecord:S,participants:rt(0,P).map((t=>{const e=V.slice(t*N,(t+1)*N);return{participantName:`Team ${t+1}`,participantRole:Ih,participantType:Aa,participantId:qn(),individualParticipantIds:e}}))}),!B.success)return B;const G=[],H=[],W=[];if(p)for(const Y of p){const{drawId:t,eventId:e,event:i,error:c,uniqueParticipantIds:u}=kv({tournamentRecord:S,allUniqueParticipantIds:W,autoEntryPositions:o,participantsProfile:r,completeAllMatchUps:a,matchUpStatusProfile:n,randomWinningSide:s,drawProfile:Y,startDate:f,goesTo:g});if(c)return{error:c};const d=_f({tournamentRecord:S,event:i});if(d.error)return d;G.push(t),H.push(e),null!=u&&u.length&&W.push(...u)}if(d)for(const Y of d){const{error:t,eventId:e,drawIds:i,uniqueParticipantIds:c}=Rv({allUniqueParticipantIds:W,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,randomWinningSide:s,tournamentRecord:S,eventProfile:Y,startDate:f});if(t)return{error:t};i&&G.push(...i),H.push(e),null!=c&&c.length&&W.push(...c)}const q=null!=l&&l.length?function({tournamentRecord:t,venueProfiles:e}){const{startDate:i,endDate:n}=t;let r=[];for(const[a,o]of e.entries()){let{venueId:e=qn(),venueName:s,courtsCount:c,dateAvailability:u,startTime:d="07:00",endTime:l="19:00"}=o,p=op({tournamentRecord:t,venue:{venueId:e,venueName:s||`Venue ${a+1}`}});if(p.error)return p;r.push(e);const h=Nn(i,n);if(u=!Array.isArray(u)&&h.map((t=>({date:Sn(t),startTime:d,endTime:l})))||u,p=ep({tournamentRecord:t,venueId:e,courtsCount:c,dateAvailability:u}),p.error)return p}return r}({tournamentRecord:S,venueProfiles:l}):[];let z,K={};if(u){const t=function({schedulingProfile:t,tournamentRecord:e}){if("object"!=typeof t)return{error:_i};const i=Il({tournamentRecord:e}).containedStructures,{matchUps:n}=ud({tournamentRecord:e}),{tournamentId:r}=e,a=[];for(const o of t){const{scheduleDate:t,venues:s=[]}=o;for(const o of s){const{rounds:s,venueId:c}=o;for(const o of s){const{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,l=n.filter((t=>{var e;const i=(null==u?void 0:u.indexOf("-"))>0&&u.split("-").map((t=>+t)),n=null===(e=t.finishingPositionRange)||void 0===e?void 0:e.winner;return!(t.drawId!==s||o.roundNumber&&t.roundNumber!==o.roundNumber||n&&i&&2!==ot(n,i).length)}))[0];if(l){const{eventId:n,roundNumber:o,drawName:p,structureName:h,roundName:f}=l;let m=l.structureId;o&&!u&&(m=Object.keys(i).find((t=>i[t].includes(m))));const g={tournamentId:r,eventId:n,drawId:s,structureId:m,roundNumber:o,roundSegment:d};let v=kd({tournamentRecords:{[r]:e},scheduleDate:t,venueId:c,round:g});if(v.error)return v;a.push({drawName:p,structureName:h,roundName:f,...g})}}}}return{scheduledRounds:a}}({schedulingProfile:u,tournamentRecord:S});if(t.error)return t;if(z=t.scheduledRounds,h){const{tournamentId:t}=S;K=lh({tournamentRecords:{[t]:S}})}}return Gn({tournamentRecord:S,scheduledRounds:z,schedulerResult:K,eventIds:H,venueIds:q,drawIds:G})},generateParticipants:Ev,generateEventWithDraw:kv,generateOutcomeFromScoreString:wv,generateOutcome:Av,parseScoreString:Iv,credits:Lh},Lv=function(){const t={version:()=>"0.51.1",devContext:e=>(Qi(e),t)};return[Ov].forEach((e=>{Object.keys(e).forEach((i=>{t[i]=t=>{try{return function(t,e){const i=t({...e});return null!=i&&i.error||Rp(),rn(),i}(e[i],t)}catch(n){console.log("%c ERROR","color: orange",{err:n})}}}))})),t}(),_v={auditConstants:Bf,drawDefinitionConstants:Ds,entryStatusConstants:pu,errorConditionConstants:Yi,eventConstants:Ta,extensionConstants:Zr,flightConstants:Lg,genderConstants:Sf,keyValueConstants:yo,matchUpActionConstants:Gh,matchUpStatusConstants:V,matchUpTypes:pa,participantConstants:Ip,participantRoles:wh,participantTypes:_a,penaltyConstants:{COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},policyConstants:ur,positionActionConstants:Vs,requestConstants:Zp,resultConstants:lt,scaleConstants:hf,scheduleConstants:ga,surfaceConstants:{CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},timeItemConstants:Tr,topicConstants:Ic,venueConstants:{INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"}};var Fv={chunkArray:ct,countValues:function(t){return e=tt(t),Object.keys(e).reduce(((t,i)=>{const n=e[i];return t[n]?t[n].push(i):t[n]=[i],t}),{});var e},dateRange:Nn,dateTime:Bn,garman:Zs,generateRange:rt,generateHashCode:function(t){if(null===t||"object"!=typeof t)return;const e=JSON.stringify(t),i=Hn(t),n=e.split("").reduce(((t,e)=>t+e.charCodeAt(0)),0);return[e.length,i,n].map((t=>t.toString(36))).join("")},generateTimeCode:Z,instanceCount:tt,intersection:ot,isNumeric:z,JSON2CSV:function(t,e){if(e&&"object"!=typeof e)return _i;const{includeTransoformAccessors:i,columnAccessors:n=[],columnTransform:r={},columnMap:a={},valuesMap:o={},context:s={},delimiter:c='"',columnJoiner:u=",",rowJoiner:d="\r\n",keyJoiner:l="."}=e||{};if(!Array.isArray(t)||!Array.isArray(n)||"object"!=typeof s||"object"!=typeof a||"object"!=typeof r||"object"!=typeof o||"string"!=typeof u||"string"!=typeof d||"string"!=typeof l||"string"!=typeof c)return _i;const p=t.filter(Boolean).map((t=>Xs(t,l))),h=Object.values(r).flat();i&&n.push(...h);const f=p.reduce(((t,e)=>Object.keys(e).every((e=>!t.includes(e)&&t.push(e)||!0))&&t),[]).filter((t=>!(null!=n&&n.length)||n.includes(t))),m=Object.assign({},...Object.keys(r).map((t=>r[t].map((e=>({[e]:t}))).flat())).flat()),g=f.reduce(((t,e)=>{const i=m[e];return i?t.includes(i)||t.push(i):t.push(e),t}),[]);Object.keys(a).forEach((t=>!g.includes(t)&&g.unshift(t))),Object.keys(r).forEach((t=>!g.includes(t)&&g.unshift(t))),"object"==typeof s&&Object.keys(s).forEach((t=>!g.includes(t)&&g.unshift(t)));const v=g.map((t=>a[t]||t)),y=t=>`${c}${t}${c}`,I=p.map((t=>Object.values(g.reduce(((e,i)=>{var n;const a=r[i],c=(null!=a&&a.length?t[a.find((e=>t[e]))]:t[i])||(null==s?void 0:s[i])||"",u=(null===(n=o[i])||void 0===n?void 0:n[c])||c;return e[i]=y(u),e}),{})).join(u)));return[v.map(y).join(u),...I].join(d)},makeDeepCopy:Vn,nearestPowerOf2:q,numericSort:Wn,overlap:st,isPowerOf2:W,randomMember:nt,randomPop:it,shuffleArray:Q,unique:X,UUID:qn,UUIDS:function(t=1){return rt(0,t).map(qn)}}}}]);