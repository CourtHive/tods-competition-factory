"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[1428],{1428:(e,t,i)=>{i.r(t),i.d(t,{MATCH_FORMATS:()=>jG,buildSetScore:()=>IV,cModal:()=>Se,calculateComplement:()=>mV,compositions:()=>GL,courthiveComponentsVersion:()=>VG,destroyTipster:()=>_G,drawer:()=>wj,getAgeCategoryModal:()=>z_,getCategoryModal:()=>K_,getFlightProfileModal:()=>uB,getMatchUpFormatModal:()=>T_,getMatchWinner:()=>pV,getMaxAllowedScore:()=>cV,getMockParticipantsModal:()=>XL,getScoringConfig:()=>HB,getSetFormatForIndex:()=>aV,getSetWinner:()=>uV,initDrawer:()=>Tj,isMatchComplete:()=>lV,isSetComplete:()=>dV,isSetTiebreakOnly:()=>oV,isSetTimed:()=>sV,renderButtons:()=>$G,renderContainer:()=>xL,renderField:()=>Mi,renderForm:()=>WL,renderMatchUp:()=>CL,renderMenu:()=>Dj,renderOptions:()=>Ei,renderParticipant:()=>nL,renderParticipantInput:()=>Ri,renderRound:()=>AL,renderRoundHeader:()=>oL,renderStructure:()=>kL,resetScoringConfig:()=>YB,scoringModal:()=>MV,setScoringConfig:()=>zB,shouldApplySmartComplement:()=>fV,shouldCreateNextSet:()=>gV,shouldShowTiebreak:()=>hV,tipster:()=>BG,validator:()=>Pi});var r,n="colors",a="sizes",o="space",s={gap:o,gridGap:o,columnGap:o,gridColumnGap:o,rowGap:o,gridRowGap:o,inset:o,insetBlock:o,insetBlockEnd:o,insetBlockStart:o,insetInline:o,insetInlineEnd:o,insetInlineStart:o,margin:o,marginTop:o,marginRight:o,marginBottom:o,marginLeft:o,marginBlock:o,marginBlockEnd:o,marginBlockStart:o,marginInline:o,marginInlineEnd:o,marginInlineStart:o,padding:o,paddingTop:o,paddingRight:o,paddingBottom:o,paddingLeft:o,paddingBlock:o,paddingBlockEnd:o,paddingBlockStart:o,paddingInline:o,paddingInlineEnd:o,paddingInlineStart:o,top:o,right:o,bottom:o,left:o,scrollMargin:o,scrollMarginTop:o,scrollMarginRight:o,scrollMarginBottom:o,scrollMarginLeft:o,scrollMarginX:o,scrollMarginY:o,scrollMarginBlock:o,scrollMarginBlockEnd:o,scrollMarginBlockStart:o,scrollMarginInline:o,scrollMarginInlineEnd:o,scrollMarginInlineStart:o,scrollPadding:o,scrollPaddingTop:o,scrollPaddingRight:o,scrollPaddingBottom:o,scrollPaddingLeft:o,scrollPaddingX:o,scrollPaddingY:o,scrollPaddingBlock:o,scrollPaddingBlockEnd:o,scrollPaddingBlockStart:o,scrollPaddingInline:o,scrollPaddingInlineEnd:o,scrollPaddingInlineStart:o,fontSize:"fontSizes",background:n,backgroundColor:n,backgroundImage:n,borderImage:n,border:n,borderBlock:n,borderBlockEnd:n,borderBlockStart:n,borderBottom:n,borderBottomColor:n,borderColor:n,borderInline:n,borderInlineEnd:n,borderInlineStart:n,borderLeft:n,borderLeftColor:n,borderRight:n,borderRightColor:n,borderTop:n,borderTopColor:n,caretColor:n,color:n,columnRuleColor:n,fill:n,outline:n,outlineColor:n,stroke:n,textDecorationColor:n,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:a,minBlockSize:a,maxBlockSize:a,inlineSize:a,minInlineSize:a,maxInlineSize:a,width:a,minWidth:a,maxWidth:a,height:a,minHeight:a,maxHeight:a,flexBasis:a,gridTemplateColumns:a,gridTemplateRows:a,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},c=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,d=()=>{const e=Object.create(null);return(t,i,...r)=>{const n=(a=t,JSON.stringify(a,c));var a;return n in e?e[n]:e[n]=i(t,...r)}},u=Symbol.for("sxs.internal"),l=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),p=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:m}=Object.prototype,f=e=>e.includes("-")?e:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),h=/\s+(?![^()]*\))/,g=e=>t=>e(..."string"==typeof t?String(t).split(h):[t]),I={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:g(((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e}))),marginInline:g(((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e}))),maxSize:g(((e,t)=>({maxBlockSize:e,maxInlineSize:t||e}))),minSize:g(((e,t)=>({minBlockSize:e,minInlineSize:t||e}))),paddingBlock:g(((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e}))),paddingInline:g(((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e})))},y=/([\d.]+)([^]*)/,v=(e,t)=>e.length?e.reduce(((e,i)=>(e.push(...t.map((e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(e)?`:is(${i})`:i):i+" "+e))),e)),[]):t,S=(e,t)=>e in U&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,i,r,n)=>i+("stretch"===r?`-moz-available${n};${f(e)}:${i}-webkit-fill-available`:`-moz-fit-content${n};${f(e)}:${i}fit-content`)+n)):String(t),U={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},b=e=>e?e+"-":"",w=(e,t,i)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((e,r,n,a,o)=>"$"==a==!!n?e:(r||"--"==a?"calc(":"")+"var(--"+("$"===a?b(t)+(o.includes("$")?"":b(i))+o.replace(/\$/g,"-"):o)+")"+(r||"--"==a?"*"+(r||"")+(n||"1")+")":""))),T=/\s*,\s*(?![^()]*\))/,D=Object.prototype.toString,P=(e,t,i,r,n)=>{let a,o,s;const c=(e,t,i)=>{let d,u;const l=e=>{for(d in e){const h=64===d.charCodeAt(0),g=h&&Array.isArray(e[d])?e[d]:[e[d]];for(u of g){const e=/[A-Z]/.test(m=d)?m:m.replace(/-[^]/g,(e=>e[1].toUpperCase())),g="object"==typeof u&&u&&u.toString===D&&(!r.utils[e]||!t.length);if(e in r.utils&&!g){const t=r.utils[e];if(t!==o){o=t,l(t(u)),o=null;continue}}else if(e in I){const t=I[e];if(t!==s){s=t,l(t(u)),s=null;continue}}if(h&&(p=d.slice(1)in r.media?"@media "+r.media[d.slice(1)]:d,d=p.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((e,t,i,r,n,a)=>{const o=y.test(t),s=.0625*(o?-1:1),[c,d]=o?[r,t]:[t,r];return"("+("="===i[0]?"":">"===i[0]===o?"max-":"min-")+c+":"+("="!==i[0]&&1===i.length?d.replace(y,((e,t,r)=>Number(t)+s*(">"===i?1:-1)+r)):d)+(n?") and ("+(">"===n[0]?"min-":"max-")+c+":"+(1===n.length?a.replace(y,((e,t,i)=>Number(t)+s*(">"===n?-1:1)+i)):a):"")+")"}))),g){const e=h?i.concat(d):[...i],r=h?[...t]:v(t,d.split(T));void 0!==a&&n(N(...a)),a=void 0,c(u,r,e)}else void 0===a&&(a=[[],t,i]),d=h||36!==d.charCodeAt(0)?d:`--${b(r.prefix)}${d.slice(1).replace(/\$/g,"-")}`,u=g?u:"number"==typeof u?u&&e in E?String(u)+"px":String(u):w(S(e,u??""),r.prefix,r.themeMap[e]),a[0].push(`${h?`${d} `:`${f(d)}:`}${u}`)}}var p,m};l(e),void 0!==a&&n(N(...a)),a=void 0};c(e,t,i)},N=(e,t,i)=>`${i.map((e=>`${e}{`)).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,E={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},M=e=>String.fromCharCode(e+(e>25?39:97)),R=e=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=M(t%52)+i;return M(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(e))>>>0),C=["themed","global","styled","onevar","resonevar","allvar","inline"],A=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch{return!1}},k=e=>{let t;const i=()=>{const{cssRules:e}=t.sheet;return[].map.call(e,((i,r)=>{const{cssText:n}=i;let a="";if(n.startsWith("--sxs"))return"";if(e[r-1]&&(a=e[r-1].cssText).startsWith("--sxs")){if(!i.cssRules.length)return"";for(const e in t.rules)if(t.rules[e].group===i)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${n}`;return i.cssRules.length?`${a}${n}`:""}return n})).join("")},r=()=>{if(t){const{rules:e,sheet:i}=t;if(!i.deleteRule){for(;3===Object(Object(i.cssRules)[0]).type;)i.cssRules.splice(0,1);i.cssRules=[]}for(const t in e)delete e[t]}const n=Object(e).styleSheets||[];for(const e of n)if(A(e)){for(let n=0,a=e.cssRules;a[n];++n){const o=Object(a[n]);if(1!==o.type)continue;const s=Object(a[n+1]);if(4!==s.type)continue;++n;const{cssText:c}=o;if(!c.startsWith("--sxs"))continue;const d=c.slice(14,-3).trim().split(/\s+/),u=C[d[0]];u&&(t||(t={sheet:e,reset:r,rules:{},toString:i}),t.rules[u]={group:s,index:n,cache:new Set(d)})}if(t)break}if(!t){const n=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,n(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,(e=>e.cssText)).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:n("","text/css"),rules:{},reset:r,toString:i}}const{sheet:a,rules:o}=t;for(let e=C.length-1;e>=0;--e){const t=C[e];if(!o[t]){const i=C[e+1],r=o[i]?o[i].index:a.cssRules.length;a.insertRule("@media{}",r),a.insertRule(`--sxs{--sxs:${e}}`,r),o[t]={group:a.cssRules[r+1],index:r,cache:new Set([e])}}O(o[t])}};return r(),t},O=e=>{const t=e.group;let i=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,i),++i}catch{}}},x=Symbol(),F=d(),L=(e,t)=>F(e,(()=>(...i)=>{let r={type:null,composers:new Set};for(const t of i)if(null!=t)if(t[u]){null==r.type&&(r.type=t[u].type);for(const e of t[u].composers)r.composers.add(e)}else t.constructor!==Object||t.$$typeof?null==r.type&&(r.type=t):r.composers.add(_(t,e));return null==r.type&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),B(e,r,t)})),_=({variants:e,compoundVariants:t,defaultVariants:i,...r},n)=>{const a=`${b(n.prefix)}c-${R(r)}`,o=[],s=[],c=Object.create(null),d=[];for(const p in i)c[p]=String(i[p]);if("object"==typeof e&&e)for(const f in e){u=c,l=f,m.call(u,l)||(c[f]="undefined");const t=e[f];for(const e in t){const i={[f]:String(e)};"undefined"===String(e)&&d.push(f);const r=t[e],n=[i,r,!p(r)];o.push(n)}}var u,l;if("object"==typeof t&&t)for(const m of t){let{css:e,...t}=m;e="object"==typeof e&&e||{};for(const r in t)t[r]=String(t[r]);const i=[t,e,!p(e)];s.push(i)}return[a,r,o,s,c,d]},B=(e,t,i)=>{const[r,n,a,o]=V(t.composers),s="function"==typeof t.type||t.type.$$typeof?(e=>{function t(){for(let i=0;i<t[x].length;i++){const[r,n]=t[x][i];e.rules[r].apply(n)}return t[x]=[],null}return t[x]=[],t.rules={},C.forEach((e=>t.rules[e]={apply:i=>t[x].push([e,i])})),t})(i):null,c=(s||i).rules,d=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,p=u=>{u="object"==typeof u&&u||$;const{css:l,...p}=u,m={};for(const e in a)if(delete p[e],e in u){let t=u[e];"object"==typeof t&&t?m[e]={"@initial":a[e],...t}:(t=String(t),m[e]="undefined"!==t||o.has(e)?t:a[e])}else m[e]=a[e];const f=new Set([...n]);for(const[r,n,a,o]of t.composers){i.rules.styled.cache.has(r)||(i.rules.styled.cache.add(r),P(n,[`.${r}`],[],e,(e=>{c.styled.apply(e)})));const t=j(a,m,e.media),s=j(o,m,e.media,!0);for(const n of t)if(void 0!==n)for(const[t,a,o]of n){const n=`${r}-${R(a)}-${t}`;f.add(n);const s=(o?i.rules.resonevar:i.rules.onevar).cache,d=o?c.resonevar:c.onevar;s.has(n)||(s.add(n),P(a,[`.${n}`],[],e,(e=>{d.apply(e)})))}for(const n of s)if(void 0!==n)for(const[t,a]of n){const n=`${r}-${R(a)}-${t}`;f.add(n),i.rules.allvar.cache.has(n)||(i.rules.allvar.cache.add(n),P(a,[`.${n}`],[],e,(e=>{c.allvar.apply(e)})))}}if("object"==typeof l&&l){const t=`${r}-i${R(l)}-css`;f.add(t),i.rules.inline.cache.has(t)||(i.rules.inline.cache.add(t),P(l,[`.${t}`],[],e,(e=>{c.inline.apply(e)})))}for(const e of String(u.className||"").trim().split(/\s+/))e&&f.add(e);const h=p.className=[...f].join(" ");return{type:t.type,className:h,selector:d,props:p,toString:()=>h,deferredInjector:s}};return l(p,{className:r,selector:d,[u]:t,toString:()=>(i.rules.styled.cache.has(r)||p(),r)})},V=e=>{let t="";const i=[],r={},n=[];for(const[a,,,,o,s]of e){""===t&&(t=a),i.push(a),n.push(...s);for(const e in o){const t=o[e];(void 0===r[e]||"undefined"!==t||s.includes(t))&&(r[e]=t)}}return[t,i,r,new Set(n)]},j=(e,t,i,r)=>{const n=[];e:for(let[a,o,s]of e){if(s)continue;let e,c=0,d=!1;for(e in a){const r=a[e];let n=t[e];if(n!==r){if("object"!=typeof n||!n)continue e;{let e,t,a=0;for(const o in n){if(r===String(n[o])){if("@initial"!==o){const e=o.slice(1);(t=t||[]).push(e in i?i[e]:o.replace(/^@media ?/,"")),d=!0}c+=a,e=!0}++a}if(t&&t.length&&(o={["@media "+t.join(", ")]:o}),!e)continue e}}}(n[c]=n[c]||[]).push([r?"cv":`${e}-${a[e]}`,o,d])}return n},$={},G=d(),W=(e,t)=>G(e,(()=>(...i)=>{const r=()=>{for(let r of i){r="object"==typeof r&&r||{};let i=R(r);if(!t.rules.global.cache.has(i)){if(t.rules.global.cache.add(i),"@import"in r){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let i of[].concat(r["@import"]))i=i.includes('"')||i.includes("'")?i:`"${i}"`,t.sheet.insertRule(`@import ${i};`,e++);delete r["@import"]}P(r,[],[],e,(e=>{t.rules.global.apply(e)}))}}return""};return l(r,{toString:r})})),q=d(),H=(e,t)=>q(e,(()=>i=>{const r=`${b(e.prefix)}k-${R(i)}`,n=()=>{if(!t.rules.global.cache.has(r)){t.rules.global.cache.add(r);const n=[];P(i,[],[],e,(e=>n.push(e)));const a=`@keyframes ${r}{${n.join("")}}`;t.rules.global.apply(a)}return r};return l(n,{get name(){return n()},toString:n})})),z=class{constructor(e,t,i,r){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==i?"":String(i),this.prefix=null==r?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+b(this.prefix)+b(this.scale)+this.token}toString(){return this.computedValue}},Y=d(),K=(e,t)=>Y(e,(()=>(i,r)=>{r="object"==typeof i&&i||Object(r);const n=`.${i=(i="string"==typeof i?i:"")||`${b(e.prefix)}t-${R(r)}`}`,a={},o=[];for(const t in r){a[t]={};for(const i in r[t]){const n=`--${b(e.prefix)}${t}-${i}`,s=w(String(r[t][i]),e.prefix,t);a[t][i]=new z(i,s,t,e.prefix),o.push(`${n}:${s}`)}}const s=()=>{if(o.length&&!t.rules.themed.cache.has(i)){t.rules.themed.cache.add(i);const n=`${r===e.theme?":root,":""}.${i}{${o.join(";")}}`;t.rules.themed.apply(n)}return i};return{...a,get className(){return s()},selector:n,toString:s}})),X=d(),J=e=>{let t=!1;const i=X(e,(e=>{t=!0;const i="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",r="object"==typeof e.media&&e.media||{},n="object"==typeof e.root?e.root||null:globalThis.document||null,a="object"==typeof e.theme&&e.theme||{},o={prefix:i,media:r,theme:a,themeMap:"object"==typeof e.themeMap&&e.themeMap||{...s},utils:"object"==typeof e.utils&&e.utils||{}},c=k(n),d={css:L(o,c),globalCss:W(o,c),keyframes:H(o,c),createTheme:K(o,c),reset(){c.reset(),d.theme.toString()},theme:{},sheet:c,config:o,prefix:i,getCssText:c.toString,toString:c.toString};return String(d.theme=d.createTheme(a)),d}));return t||i.reset(),i},Q=(...e)=>(r||(r=J())).css(...e);const Z=Q({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),ee=Q({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),te=Q({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});const ie=Q({fontSize:"smaller",color:"gray"});function re(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ne,ae,oe={exports:{}};const se=re((ne||(ne=1,ae=oe,function(){var e={}.hasOwnProperty;function t(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=r(e,i(n)))}return e}function i(i){if("string"==typeof i||"number"==typeof i)return i;if("object"!=typeof i)return"";if(Array.isArray(i))return t.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var n="";for(var a in i)e.call(i,a)&&i[a]&&(n=r(n,a));return n}function r(e,t){return t?e?e+" "+t:e+t:e}ae.exports?(t.default=t,ae.exports=t):window.classNames=t}()),oe.exports));const ce=Q({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),de=Q({display:"block"}),ue=Q({position:"fixed",right:0,left:0}),le=Q({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),pe=Q({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),me=Q({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),fe=Q({fontWeight:"600",fontSize:"20px"}),he=Q({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),ge="Nothing to see here";function Ie(e){return"function"==typeof e}function ye(e){return"string"==typeof e}function ve(e){return Array.isArray(e)}const Se=(()=>{const e=ue(),t={},i=".5",r=[];let n;const a=[];let o,s=[];const c=i=>{const c=s.length;if(i&&!1===t[c])return;const d=a.pop(),u=r.pop();Ie(d)&&d({content:u}),document.querySelectorAll("[data-modal-popover]").forEach((e=>e.remove())),document.body.classList.remove(e),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),o&&(o.style.opacity="0",o.style.display="none"),(e=>{{const e=s.pop();e&&e.remove()}})()},d=({config:t})=>{n=window.scrollY,document.body.classList.add(e),document.body.style.top=`-${n}px`,o||(o=document.createElement("div"),o.className=ce(),o.id="cmdl-backdrop",o.onclick=()=>c(!0),document.body.appendChild(o)),o.style.display="",!1!==t?.backdrop&&(o.style.backgroundColor="rgba(0, 0, 0, 0.2)",o.style.transition="opacity 0.15s linear",o.style.opacity="1")},u=({config:e,attr:t,attrs:i,unit:r="em",value:n})=>{let a;return ye(t)?a=Ue({element:e,attr:t}):ve(i)&&(a=i.map((t=>Ue({element:e,attr:t}))).find(Boolean)),void 0!==a&&(n=a),Number.isNaN(n)?n:`${n}${r}`},l=({buttons:e,config:t,modalNumber:n})=>{const a=document.createElement("div");a.className=he(),a.style.padding=u({config:t,attrs:["footer.padding","padding"],value:i});const o={label:t?.dictionary?.close||"Close",onClick:()=>Se.close(),intent:"is-info"};for(const i of e){if(i.hide)continue;const e={...o,...i},t=document.createElement("button");void 0!==e.disabled&&(t.disabled=e.disabled),e.id&&(t.id=e.id),t.className=e?.footer?.className||"button font-medium",e.intent&&"none"!==e.intent&&t.classList.add(e.intent);const s="margin-right: .5em;",c=e?.footer?.style||"";t.style.cssText=s+(c?" "+c:""),t.innerHTML=e.label||e.text||"",t.onclick=t=>{t.stopPropagation(),Ie(e.onClick)&&e.onClick({e:t,content:r[n]}),!1!==e.close&&(Ie(e.close)&&e.close(),Se.close())},a.appendChild(t)}return a};return{close:c,open:({title:e="",content:n,buttons:o,footer:p,config:m,onClose:f}={})=>{d({config:m}),a.push(f);const h=s.length+1;t[h]=m?.clickAway;const g=document.createElement("section"),I=`cmdl-${h}`;g.className=de(),g.role="dialog",g.tabIndex=-1,g.id=I;const y=document.createElement("div");y.className=le(),y.style.maxWidth=`${m?.maxWidth||450}px`,y.onclick=()=>c(!0);const v=document.createElement("div");v.className=pe(),m?.className&&v.classList.add(m.className),m?.style&&Object.assign(v.style,m.style),v.onclick=e=>e.stopPropagation();const S=document.createElement("div"),U=document.createElement("div");let b,w;S.appendChild(U),m?.info&&(b=document.createElement("span"),b.innerHTML="?",b.style.cssText="\n        cursor: pointer;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        width: 20px;\n        height: 20px;\n        border-radius: 50%;\n        background-color: #3273dc;\n        color: white;\n        font-size: 14px;\n        font-weight: bold;\n        flex-shrink: 0;\n        user-select: none;\n      ",b.onclick=e=>{if(e.stopPropagation(),w&&document.body.contains(w))return w.remove(),void(w=void 0);w=document.createElement("div"),w.setAttribute("data-modal-popover","true"),w.style.cssText="\n          position: absolute;\n          z-index: 10000;\n          background-color: white;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n          padding: 1em;\n          max-width: 300px;\n          font-size: 14px;\n          font-weight: normal;\n          line-height: 1.5;\n          color: #363636;\n        ";const t=document.createElement("style");t.textContent="\n          [data-modal-popover] strong {\n            color: #000 !important;\n            font-weight: 600;\n          }\n        ",document.querySelector("[data-modal-popover-styles]")||(t.setAttribute("data-modal-popover-styles","true"),document.head.appendChild(t)),ye(m.info)?w.innerHTML=m.info:w.textContent=String(m.info),document.body.appendChild(w);const i=b.getBoundingClientRect();w.offsetWidth,w.style.right=window.innerWidth-i.left+5+"px",w.style.top=`${i.bottom+5}px`,w.style.left="auto",setTimeout((()=>{const e=t=>{w&&!w.contains(t.target)&&t.target!==b&&(w.remove(),w=void 0,document.removeEventListener("click",e))};document.addEventListener("click",e)}),100)},S.appendChild(b)),v.appendChild(S);const T=({title:e,config:t})=>{S.className=e?me():"",S.style.padding=u({config:t,attrs:["title.padding","padding"],value:i}),S.style.display=e||t?.info?"flex":"",S.style.alignItems="center",S.style.justifyContent=e?"space-between":"flex-end",U.className=e?fe():"",U.innerHTML=e,b&&(b.style.marginLeft=e?"auto":"0")};(e||m?.info)&&T({title:e,config:m});const D=document.createElement("div");v.appendChild(D);const P=({content:e,config:t})=>{D.style.fontSize=u({config:t,attr:"fontSize",value:"15px"}),D.style.position="relative",D.style.padding=u({config:t,attrs:["content.padding","padding"],value:i}),Ie(e)?r[h]=e(D):e instanceof HTMLElement?D.appendChild(e):ye(e)?D.innerHTML=e:D.innerHTML=ge};let N;if(P({content:n,config:m}),ve(o))N=l({buttons:o,config:m,modalNumber:h}),v.appendChild(N);else if(p){const e=document.createElement("div");e.className=he(),e.style.padding=u({config:m,attrs:["footer.padding","padding"]}),p instanceof HTMLElement?e.appendChild(p):ye(p)?e.innerHTML=p:e.innerHTML=ge,N=e,v.appendChild(e)}y.appendChild(v),g.appendChild(y),document.body.appendChild(g),s.push(g);const E=({content:e,config:t})=>{r[h]=void 0,function(e){if(e)for(;e.firstChild;)e.firstChild.remove()}(D),P({content:e,config:t})},M=({buttons:e,config:t})=>{N&&N.remove(),N=l({buttons:e,config:t,modalNumber:h}),v.appendChild(N)};return{setContent:E,setButtons:M,update:({content:e,buttons:t,title:i,config:r,onClose:n})=>{m=r||m,e&&E({content:e,config:m}),t&&M({buttons:t,config:m}),n&&(({onClose:e})=>{a.length=0,a.push(e)})({onClose:n}),i&&T({title:i,config:m})}}}}})();function Ue({element:e,attr:t}){if(!ye(t))return;const i=t.split(".");for(const r of i)if(e=e?.[r],!e)return;return e}function be(e){const t=e?.composition?.configuration?.participantDetail;if("TEAM"===t)return function({individualParticipant:e,className:t}){const i=e?.teams?.[0],r=i?.participantName||" ",n=document.createElement("div");return n.className=se(ie(),t),n.classList.add("tmx-tm"),n.setAttribute("id",i?.participantId||""),n.innerHTML=r,n}(e);if(e?.composition?.configuration?.showAddress??"ADDRESS"===t)return function({individualParticipant:e,className:t}){const{city:i,state:r,countryCode:n}=e?.person?.addresses?.[0]||{},a=[i,r,n].filter(Boolean).join(", ")||" ",o=document.createElement("div");return o.className=se(ie(),t),o.innerHTML=a,o}(e);if(t){const i=function({individualParticipant:e,attribute:t,className:i}){const r=e?.person,n=Ue({element:r,attr:t});if(!n)return"";const a=document.createElement("div");return a.className=se(ie(),i),a.innerHTML=n,a}({...e,attribute:t});if(i&&"string"!=typeof i)return i}return document.createElement("div")}function we(e){return"function"==typeof e}var Te,De={exports:{}};var Pe=(Te||(Te=1,function(e){!function(){var t=function(e,i){var r=this;t.count=(t.count||0)+1,this.count=t.count,this.isOpened=!1,this.input=n(e),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=i=i||{},function(e,t,i){for(var r in t){var n=t[r],a=e.input.getAttribute("data-"+r.toLowerCase());e[r]="number"==typeof n?parseInt(a):!1===n?null!==a:n instanceof Function?null:a,!e[r]&&0!==e[r]&&(e[r]=r in i?i[r]:n)}}(this,{minChars:2,maxItems:10,autoFirst:!1,data:t.DATA,filter:t.FILTER_CONTAINS,sort:!1!==i.sort&&t.SORT_BYLENGTH,container:t.CONTAINER,item:t.ITEM,replace:t.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},i),this.index=-1,this.container=this.container(e),this.ul=n.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=n.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(e){var t=e.keyCode;r.opened&&(13===t&&r.selected||9===t&&r.selected&&r.tabSelect?(e.preventDefault(),r.select(void 0,void 0,e)):27===t?r.close({reason:"esc"}):(38===t||40===t)&&(e.preventDefault(),r[38===t?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(e){e.preventDefault()},click:function(e){var t=e.target;if(t!==this){for(;t&&!/li/i.test(t.nodeName);)t=t.parentNode;t&&0===e.button&&(e.preventDefault(),r.select(t,e.target,e))}}}},n.bind(this.input,this._events.input),n.bind(this.input.form,this._events.form),n.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||i.list||[],t.all.push(this)};function i(e){var t=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=t.label||t.value,this.value=t.value}t.prototype={set list(e){if(Array.isArray(e))this._list=e;else if("string"==typeof e&&e.indexOf(",")>-1)this._list=e.split(/\s*,\s*/);else if((e=n(e))&&e.children){var t=[];r.apply(e.children).forEach((function(e){if(!e.disabled){var i=e.textContent.trim(),r=e.value||i,n=e.label||i;""!==r&&t.push({label:n,value:r})}})),this._list=t}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(e){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),n.fire(this.input,"awesomplete-close",e||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&-1===this.index&&this.goto(0),n.fire(this.input,"awesomplete-open")},destroy:function(){if(n.unbind(this.input,this._events.input),n.unbind(this.input.form,this._events.form),!this.options.container){var e=this.container.parentNode;e.insertBefore(this.input,this.container),e.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var i=t.all.indexOf(this);-1!==i&&t.all.splice(i,1)},next:function(){var e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)},previous:function(){var e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)},goto:function(e){var t=this.ul.children;this.selected&&t[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&t.length>0&&(t[e].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=t[e].offsetTop-this.ul.clientHeight+t[e].clientHeight,n.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(e,t,i){if(e?this.index=n.siblingIndex(e):e=this.ul.children[this.index],e){var r=this.suggestions[this.index];n.fire(this.input,"awesomplete-select",{text:r,origin:t||e,originalEvent:i})&&(this.replace(r),this.close({reason:"select"}),n.fire(this.input,"awesomplete-selectcomplete",{text:r,originalEvent:i}))}},evaluate:function(){var e=this,t=this.input.value;t.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map((function(r){return new i(e.data(r,t))})).filter((function(i){return e.filter(i,t)})),!1!==this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach((function(i,r){e.ul.appendChild(e.item(i,t,r))})),0===this.ul.children.length?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||t.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},t.all=[],t.FILTER_CONTAINS=function(e,t){return RegExp(n.regExpEscape(t.trim()),"i").test(e)},t.FILTER_STARTSWITH=function(e,t){return RegExp("^"+n.regExpEscape(t.trim()),"i").test(e)},t.SORT_BYLENGTH=function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1},t.CONTAINER=function(e){return n.create("div",{className:"awesomplete",around:e})},t.ITEM=function(e,t,i){var r=""===t.trim()?e:e.replace(RegExp(n.regExpEscape(t.trim()),"gi"),"<mark>$&</mark>");return n.create("li",{innerHTML:r,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+i})},t.REPLACE=function(e){this.input.value=e.value},t.DATA=function(e){return e},Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};var r=Array.prototype.slice;function n(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function a(e,t){return r.call((t||document).querySelectorAll(e))}function o(){a("input.awesomplete").forEach((function(e){new t(e)}))}n.create=function(e,t){var i=document.createElement(e);for(var r in t){var a=t[r];if("inside"===r)n(a).appendChild(i);else if("around"===r){var o=n(a);o.parentNode.insertBefore(i,o),i.appendChild(o),null!=o.getAttribute("autofocus")&&o.focus()}else r in i?i[r]=a:i.setAttribute(r,a)}return i},n.bind=function(e,t){if(e)for(var i in t){var r=t[i];i.split(/\s+/).forEach((function(t){e.addEventListener(t,r)}))}},n.unbind=function(e,t){if(e)for(var i in t){var r=t[i];i.split(/\s+/).forEach((function(t){e.removeEventListener(t,r)}))}},n.fire=function(e,t,i){var r=document.createEvent("HTMLEvents");for(var n in r.initEvent(t,!0,!0),i)r[n]=i[n];return e.dispatchEvent(r)},n.regExpEscape=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},n.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},typeof self<"u"&&(self.Awesomplete=t),typeof Document<"u"&&("loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o)),t.$=n,t.$$=a,e.exports&&(e.exports=t)}()}(De)),De.exports);const Ne=re(Pe);function Ee({list:e,element:t,callback:i,currentValue:r,withCatchTab:n,onChange:a}){const o=new Ne(t,{list:e});t.parentElement&&(t.parentElement.style.width="100%");let s=!1;if(n){const e=e=>"Tab"===e.key&&e.preventDefault();t.addEventListener("keydown",e,!1),t.addEventListener("keyup",e,!1)}if("function"==typeof a&&t.addEventListener("change",a),t.setAttribute("autocomplete","off"),t.addEventListener("awesomplete-selectcomplete",(e=>(e=>{s=!0,we(i)&&i(e.text.value),t.value=e.text.label,o.suggestions=[]})(e)),!1),t.addEventListener("keyup",(function(e){("Enter"===e.key||"Tab"===e.key)&&!s&&o.suggestions?.length&&(o.next(),o.select(0)),s=!1})),r){const i=e.find((e=>e.value===r))?.label;i&&(t.value=i)}return{typeAhead:o}}function Me(e){return e[e.length-1]}function Re(e,...t){return t.forEach((t=>{e.includes(t)||e.push(t)})),e}function Ce(e,t){return e?e.split(t):[]}function Ae(e,t,i){return(void 0===t||e>=t)&&(void 0===i||e<=i)}function ke(e,t,i){return e<t?t:e>i?i:e}function Oe(e,t,i={},r=0,n=""){n+=`<${Object.keys(i).reduce(((e,t)=>{let n=i[t];return"function"==typeof n&&(n=n(r)),`${e} ${t}="${n}"`}),e)}></${e}>`;const a=r+1;return a<t?Oe(e,t,i,a,n):n}function xe(e){return e.replace(/>\s+/g,">").replace(/\s+</,"<")}function Fe(e){return new Date(e).setHours(0,0,0,0)}function Le(){return(new Date).setHours(0,0,0,0)}function _e(...e){switch(e.length){case 0:return Le();case 1:return Fe(e[0])}const t=new Date(0);return t.setFullYear(...e),t.setHours(0,0,0,0)}function Be(e,t){const i=new Date(e);return i.setDate(i.getDate()+t)}function Ve(e,t){const i=new Date(e),r=i.getMonth()+t;let n=r%12;n<0&&(n+=12);const a=i.setMonth(r);return i.getMonth()!==n?i.setDate(0):a}function je(e,t){const i=new Date(e),r=i.getMonth(),n=i.setFullYear(i.getFullYear()+t);return 1===r&&2===i.getMonth()?i.setDate(0):n}function $e(e,t){return(e-t+7)%7}function Ge(e,t,i=0){const r=new Date(e).getDay();return Be(e,$e(t,i)-$e(r,i))}function We(e,t){return Math.round((e-t)/6048e5)+1}function qe(e){const t=Ge(e,4,1);return We(t,Ge(new Date(t).setMonth(0,4),4,1))}function He(e,t){const i=Ge(new Date(e).setMonth(0,1),t,t),r=Ge(e,t,t),n=We(r,i);if(n<53)return n;return r===Ge(new Date(e).setDate(32),t,t)?1:n}function ze(e){return He(e,0)}function Ye(e){return He(e,6)}function Ke(e,t){const i=new Date(e).getFullYear();return Math.floor(i/t)*t}function Xe(e,t,i){if(1!==t&&2!==t)return e;const r=new Date(e);return 1===t?i?r.setMonth(r.getMonth()+1,0):r.setDate(1):i?r.setFullYear(r.getFullYear()+1,0,0):r.setMonth(0,1),r.setHours(0,0,0,0)}const Je=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,Qe=/[\s!-/:-@[-`{-~\u5e74\u6708\u65e5]+/;let Ze={};const et={y:(e,t)=>new Date(e).setFullYear(parseInt(t,10)),m(e,t,i){const r=new Date(e);let n=parseInt(t,10)-1;if(isNaN(n)){if(!t)return NaN;const e=t.toLowerCase(),r=t=>t.toLowerCase().startsWith(e);if(n=i.monthsShort.findIndex(r),n<0&&(n=i.months.findIndex(r)),n<0)return NaN}return r.setMonth(n),r.getMonth()!==it(n)?r.setDate(0):r.getTime()},d:(e,t)=>new Date(e).setDate(parseInt(t,10))},tt={d:e=>e.getDate(),dd:e=>rt(e.getDate(),2),D:(e,t)=>t.daysShort[e.getDay()],DD:(e,t)=>t.days[e.getDay()],m:e=>e.getMonth()+1,mm:e=>rt(e.getMonth()+1,2),M:(e,t)=>t.monthsShort[e.getMonth()],MM:(e,t)=>t.months[e.getMonth()],y:e=>e.getFullYear(),yy:e=>rt(e.getFullYear(),2).slice(-2),yyyy:e=>rt(e.getFullYear(),4)};function it(e){return e>-1?e%12:it(e+12)}function rt(e,t){return e.toString().padStart(t,"0")}function nt(e){if("string"!=typeof e)throw new Error("Invalid date format.");if(e in Ze)return Ze[e];const t=e.split(Je),i=e.match(new RegExp(Je,"g"));if(0===t.length||!i)throw new Error("Invalid date format.");const r=i.map((e=>tt[e])),n=Object.keys(et).reduce(((e,t)=>(i.find((e=>"D"!==e[0]&&e[0].toLowerCase()===t))&&e.push(t),e)),[]);return Ze[e]={parser(e,t){const r=e.split(Qe).reduce(((e,t,r)=>{if(t.length>0&&i[r]){const n=i[r][0];"M"===n?e.m=t:"D"!==n&&(e[n]=t)}return e}),{});return n.reduce(((e,i)=>{const n=et[i](e,r[i],t);return isNaN(n)?e:n}),Le())},formatter:(e,i)=>r.reduce(((r,n,a)=>r+`${t[a]}${n(e,i)}`),"")+Me(t)}}function at(e,t,i){if(e instanceof Date||"number"==typeof e){const t=Fe(e);return isNaN(t)?void 0:t}if(e){if("today"===e)return Le();if(t&&t.toValue){const r=t.toValue(e,t,i);return isNaN(r)?void 0:Fe(r)}return nt(t).parser(e,i)}}function ot(e,t,i){if(isNaN(e)||!e&&0!==e)return"";const r="number"==typeof e?new Date(e):e;return t.toDisplay?t.toDisplay(r,t,i):nt(t).formatter(r,i)}const st=document.createRange();function ct(e){return st.createContextualFragment(e)}function dt(e){return e.parentElement||(e.parentNode instanceof ShadowRoot?e.parentNode.host:void 0)}function ut(e){return e.getRootNode().activeElement===e}function lt(e){"none"!==e.style.display&&(e.style.display&&(e.dataset.styleDisplay=e.style.display),e.style.display="none")}function pt(e){"none"===e.style.display&&(e.dataset.styleDisplay?(e.style.display=e.dataset.styleDisplay,delete e.dataset.styleDisplay):e.style.display="")}function mt(e){e.firstChild&&(e.removeChild(e.firstChild),mt(e))}const ft=new WeakMap,{addEventListener:ht,removeEventListener:gt}=EventTarget.prototype;function It(e,t){let i=ft.get(e);i||(i=[],ft.set(e,i)),t.forEach((e=>{ht.call(...e),i.push(e)}))}function yt(e){let t=ft.get(e);t&&(t.forEach((e=>{gt.call(...e)})),ft.delete(e))}if(!Event.prototype.composedPath){const e=(t,i=[])=>{let r;return i.push(t),t.parentNode?r=t.parentNode:t.host?r=t.host:t.defaultView&&(r=t.defaultView),r?e(r,i):i};Event.prototype.composedPath=function(){return e(this.target)}}function vt(e,t,i){const[r,...n]=e;return t(r)?r:r!==i&&"HTML"!==r.tagName&&0!==n.length?vt(n,t,i):void 0}function St(e,t){const i="function"==typeof t?t:e=>e instanceof Element&&e.matches(t);return vt(e.composedPath(),i,e.currentTarget)}const Ut={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},bt={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"\xbb",orientation:"auto",pickLevel:0,prevArrow:"\xab",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:wt,format:Tt,weekStart:Dt}=bt;function Pt(e,t){return e.length<6&&t>=0&&t<7?Re(e,t):e}function Nt(e,t){switch(4===e?6===t?3:!t+1:e){case 1:return qe;case 2:return ze;case 3:return Ye}}function Et(e,t,i){return t.weekStart=e,t.weekEnd=(e+6)%7,4===i&&(t.getWeekNumber=Nt(4,e)),e}function Mt(e,t,i,r){const n=at(e,t,i);return void 0!==n?n:r}function Rt(e,t,i=3){const r=parseInt(e,10);return r>=0&&r<=i?r:t}function Ct(e,t,i,r=void 0){t in e&&(i in e||(e[i]=r?r(e[t]):e[t]),delete e[t])}function At(e,t){const i=Object.assign({},e),r={},n=t.constructor.locales,a=!!t.rangeSideIndex;let{datesDisabled:o,format:s,language:c,locale:d,maxDate:u,maxView:l,minDate:p,pickLevel:m,startView:f,weekNumbers:h,weekStart:g}=t.config||{};if(Ct(i,"calendarWeeks","weekNumbers",(e=>e?1:0)),Ct(i,"clearBtn","clearButton"),Ct(i,"todayBtn","todayButton"),Ct(i,"todayBtnMode","todayButtonMode"),i.language){let e;if(i.language!==c&&(n[i.language]?e=i.language:(e=i.language.split("-")[0],n[e]||(e=!1))),delete i.language,e){c=r.language=e;const t=d||n[wt];d=Object.assign({format:Tt,weekStart:Dt},n[wt]),c!==wt&&Object.assign(d,n[c]),r.locale=d,s===t.format&&(s=r.format=d.format),g===t.weekStart&&(g=Et(d.weekStart,r,h))}}if(i.format){const e="function"==typeof i.format.toDisplay,t="function"==typeof i.format.toValue,n=Je.test(i.format);(e&&t||n)&&(s=r.format=i.format),delete i.format}let I=m;"pickLevel"in i&&(I=Rt(i.pickLevel,m,2),delete i.pickLevel),I!==m&&(I>m&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=u)),o&&!i.datesDisabled&&(i.datesDisabled=[]),m=r.pickLevel=I);let y=p,v=u;if("minDate"in i){const e=_e(0,0,1);y=null===i.minDate?e:Mt(i.minDate,s,d,y),y!==e&&(y=Xe(y,m,!1)),delete i.minDate}if("maxDate"in i&&(v=null===i.maxDate?void 0:Mt(i.maxDate,s,d,v),void 0!==v&&(v=Xe(v,m,!0)),delete i.maxDate),v<y?(p=r.minDate=v,u=r.maxDate=y):(p!==y&&(p=r.minDate=y),u!==v&&(u=r.maxDate=v)),i.datesDisabled){const e=i.datesDisabled;if("function"==typeof e)r.datesDisabled=null,r.checkDisabled=(t,i)=>e(new Date(t),i,a);else{const t=r.datesDisabled=e.reduce(((e,t)=>{const i=at(t,s,d);return void 0!==i?Re(e,Xe(i,m,a)):e}),[]);r.checkDisabled=e=>t.includes(e)}delete i.datesDisabled}if("defaultViewDate"in i){const e=at(i.defaultViewDate,s,d);void 0!==e&&(r.defaultViewDate=e),delete i.defaultViewDate}if("weekStart"in i){const e=Number(i.weekStart)%7;isNaN(e)||(g=Et(e,r,h)),delete i.weekStart}if(i.daysOfWeekDisabled&&(r.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(Pt,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(r.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(Pt,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let e=i.weekNumbers;if(e){const t="function"==typeof e?(t,i)=>e(new Date(t),i):Nt(e=parseInt(e,10),g);t&&(h=r.weekNumbers=e,r.getWeekNumber=t)}else h=r.weekNumbers=0,r.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const e=parseInt(i.maxNumberOfDates,10);e>=0&&(r.maxNumberOfDates=e,r.multidate=1!==e),delete i.maxNumberOfDates}i.dateDelimiter&&(r.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let S=l;"maxView"in i&&(S=Rt(i.maxView,l),delete i.maxView),S=m>S?m:S,S!==l&&(l=r.maxView=S);let U=f;if("startView"in i&&(U=Rt(i.startView,U),delete i.startView),U<m?U=m:U>l&&(U=l),U!==f&&(r.startView=U),i.prevArrow){const e=ct(i.prevArrow);e.childNodes.length>0&&(r.prevArrow=e.childNodes),delete i.prevArrow}if(i.nextArrow){const e=ct(i.nextArrow);e.childNodes.length>0&&(r.nextArrow=e.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(r.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const e=i.orientation.toLowerCase().split(/\s+/g);r.orientation={x:e.find((e=>"left"===e||"right"===e))||"auto",y:e.find((e=>"top"===e||"bottom"===e))||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:r.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach((([e,t])=>{void 0!==t&&e in bt&&(r[e]=t)})),r}const kt={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};const Ot=e=>e.map((e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`)).join(""),xt=xe(`<div class="datepicker">\n  <div class="datepicker-picker">\n    <div class="datepicker-header">\n      <div class="datepicker-title"></div>\n      <div class="datepicker-controls">\n        ${Ot(["prev-button prev-btn","view-switch","next-button next-btn"])}\n      </div>\n    </div>\n    <div class="datepicker-main"></div>\n    <div class="datepicker-footer">\n      <div class="datepicker-controls">\n        ${Ot(["today-button today-btn","clear-button clear-btn"])}\n      </div>\n    </div>\n  </div>\n</div>`),Ft=xe(`<div class="days">\n  <div class="days-of-week">${Oe("span",7,{class:"dow"})}</div>\n  <div class="datepicker-grid">${Oe("span",42)}</div>\n</div>`),Lt=xe(`<div class="week-numbers calendar-weeks">\n  <div class="days-of-week"><span class="dow"></span></div>\n  <div class="weeks">${Oe("span",6,{class:"week"})}</div>\n</div>`);class _t{constructor(e,t){Object.assign(this,t,{picker:e,element:ct('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,t,i){this.disabled=[];const r=this.picker;r.setViewSwitchLabel(e),r.setPrevButtonDisabled(t),r.setNextButtonDisabled(i)}setDisabled(e,t){t.add("disabled"),Re(this.disabled,e)}performBeforeHook(e,t){let i=this.beforeShow(new Date(t));switch(typeof i){case"boolean":i={enabled:i};break;case"string":i={classes:i}}if(i){const r=e.classList;if(!1===i.enabled&&this.setDisabled(t,r),i.classes){const e=i.classes.split(/\s+/);r.add(...e),e.includes("disabled")&&this.setDisabled(t,r)}i.content&&function(e,t){mt(e),t instanceof DocumentFragment?e.appendChild(t):"string"==typeof t?e.appendChild(ct(t)):"function"==typeof t.forEach&&t.forEach((t=>{e.appendChild(t)}))}(e,i.content)}}renderCell(e,t,i,r,{selected:n,range:a},o,s=[]){e.textContent=t,this.isMinView&&(e.dataset.date=r);const c=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,i<this.first?c.add("prev"):i>this.last&&c.add("next"),c.add(...s),(o||this.checkDisabled(r,this.id))&&this.setDisabled(r,c),a){const[e,t]=a;i>e&&i<t&&c.add("range"),i===e&&c.add("range-start"),i===t&&c.add("range-end")}n.includes(i)&&c.add("selected"),i===this.focused&&c.add("focused"),this.beforeShow&&this.performBeforeHook(e,r)}refreshCell(e,t,i,[r,n]){const a=e.classList;a.remove("range","range-start","range-end","selected","focused"),t>r&&t<n&&a.add("range"),t===r&&a.add("range-start"),t===n&&a.add("range-end"),i.includes(t)&&a.add("selected"),t===this.focused&&a.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach((e=>{e.classList.remove("focused")})),this.grid.children[e].classList.add("focused")}}class Bt extends _t{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,t=!0){if(t){const e=ct(Ft).firstChild;this.dow=e.firstChild,this.grid=e.lastChild,this.element.appendChild(e)}super.init(e)}setOptions(e){let t;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,t=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,t=!0),e.locale){const i=this.locale=e.locale;this.dayNames=i.daysMin,this.switchLabelFormat=i.titleFormat,t=!0}if("beforeShowDay"in e&&(this.beforeShow="function"==typeof e.beforeShowDay?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const e=ct(Lt).firstChild;this.weekNumbers={element:e,dow:e.firstChild,weeks:e.lastChild},this.element.insertBefore(e,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(pt(this.dow),this.weekNumbers&&pt(this.weekNumbers.dow)):(lt(this.dow),this.weekNumbers&&lt(this.weekNumbers.dow))),t&&Array.from(this.dow.children).forEach(((e,t)=>{const i=(this.weekStart+t)%7;e.textContent=this.dayNames[i],e.className=this.daysOfWeekDisabled.includes(i)?"dow disabled":"dow"}))}updateFocus(){const e=new Date(this.picker.viewDate),t=e.getFullYear(),i=e.getMonth(),r=_e(t,i,1),n=Ge(r,this.weekStart,this.weekStart);this.first=r,this.last=_e(t,i+1,0),this.start=n,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e,t&&(this.range=t.dates)}render(){if(this.today=this.todayHighlight?Le():void 0,this.prepareForRender(ot(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,t=Ge(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach(((i,r)=>{const n=function(e,t){return Be(e,7*t)}(t,r);i.textContent=this.getWeekNumber(n,e),r>3&&i.classList[n>this.last?"add":"remove"]("next")}))}Array.from(this.grid.children).forEach(((e,t)=>{const i=Be(this.start,t),r=new Date(i),n=r.getDay(),a=[];this.today===i&&a.push("today"),this.daysOfWeekHighlighted.includes(n)&&a.push("highlighted"),this.renderCell(e,r.getDate(),i,i,this,i<this.minDate||i>this.maxDate||this.daysOfWeekDisabled.includes(n),a)}))}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach((t=>{this.refreshCell(t,Number(t.dataset.date),this.selected,e)}))}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function Vt(e,t){if(!e||!e[0]||!e[1])return;const[[i,r],[n,a]]=e;return i>t||n<t?void 0:[i===t?r:-1,n===t?a:12]}class jt extends _t{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,t=!0){t&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(ct(Oe("span",12,{"data-month":e=>e}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(void 0===e.minDate)this.minYear=this.minMonth=this.minDate=void 0;else{const t=new Date(e.minDate);this.minYear=t.getFullYear(),this.minMonth=t.getMonth(),this.minDate=t.setDate(1)}if("maxDate"in e)if(void 0===e.maxDate)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const t=new Date(e.maxDate);this.maxYear=t.getFullYear(),this.maxMonth=t.getMonth(),this.maxDate=_e(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||null===e.datesDisabled?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow="function"==typeof e.beforeShowMonth?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e.reduce(((e,t)=>{const i=new Date(t),r=i.getFullYear(),n=i.getMonth();return void 0===e[r]?e[r]=[n]:Re(e[r],n),e}),{}),t&&t.dates&&(this.range=t.dates.map((e=>{const t=new Date(e);return isNaN(t)?void 0:[t.getFullYear(),t.getMonth()]})))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],t=this.year<this.minYear||this.year>this.maxYear,i=this.year===this.minYear,r=this.year===this.maxYear,n=Vt(this.range,this.year);Array.from(this.grid.children).forEach(((a,o)=>{const s=Xe(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(a,this.monthNames[o],o,s,{selected:e,range:n},t||i&&o<this.minMonth||r&&o>this.maxMonth)}))}refresh(){const e=this.selected[this.year]||[],t=Vt(this.range,this.year)||[];Array.from(this.grid.children).forEach(((i,r)=>{this.refreshCell(i,r,e,t)}))}refreshFocus(){this.changeFocusedCell(this.focused)}}class $t extends _t{constructor(e,t){super(e,t)}init(e,t=!0){t&&(this.navStep=10*this.step,this.beforeShowOption=`beforeShow${function(e){return[...e].reduce(((e,t,i)=>e+(i?t:t.toUpperCase())),"")}(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(ct(Oe("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(void 0===e.minDate?this.minYear=this.minDate=void 0:(this.minYear=Ke(e.minDate,this.step),this.minDate=_e(this.minYear,0,1))),"maxDate"in e&&(void 0===e.maxDate?this.maxYear=this.maxDate=void 0:(this.maxYear=Ke(e.maxDate,this.step),this.maxDate=_e(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||null===e.datesDisabled?e.checkDisabled:()=>!1),this.beforeShowOption in e){const t=e[this.beforeShowOption];this.beforeShow="function"==typeof t?t:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),t=Ke(e,this.navStep),i=t+9*this.step;this.first=t,this.last=i,this.start=t-this.step,this.focused=Ke(e,this.step)}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e.reduce(((e,t)=>Re(e,Ke(t,this.step))),[]),t&&t.dates&&(this.range=t.dates.map((e=>{if(void 0!==e)return Ke(e,this.step)})))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach(((e,t)=>{const i=this.start+t*this.step,r=Xe(new Date(i,0,1),2,this.isRangeEnd);e.dataset.year=i,this.renderCell(e,i,i,r,this,i<this.minYear||i>this.maxYear)}))}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach((t=>{this.refreshCell(t,Number(t.textContent),this.selected,e)}))}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function Gt(e,t){const i={bubbles:!0,cancelable:!0,detail:{date:e.getDate(),viewDate:new Date(e.picker.viewDate),viewId:e.picker.currentView.id,datepicker:e}};e.element.dispatchEvent(new CustomEvent(t,i))}function Wt(e,t){const{config:i,picker:r}=e,{currentView:n,viewDate:a}=r;let o;switch(n.id){case 0:o=Ve(a,t);break;case 1:o=je(a,t);break;default:o=je(a,t*n.navStep)}o=ke(o,i.minDate,i.maxDate),r.changeFocus(o).render()}function qt(e){const t=e.picker.currentView.id;t!==e.config.maxView&&e.picker.changeView(t+1).render()}function Ht(e){e.setDate({clear:!0})}function zt(e){const t=Le();1===e.config.todayButtonMode?e.setDate(t,{forceRefresh:!0,viewDate:t}):e.setFocusedDate(t,!0)}function Yt(e){const t=()=>{e.config.updateOnBlur?e.update({revert:!0}):e.refresh("input"),e.hide()},i=e.element;ut(i)?i.addEventListener("blur",t,{once:!0}):t()}function Kt(e,t){const i=e.picker,r=new Date(i.viewDate),n=i.currentView.id,a=1===n?Ve(r,t-r.getMonth()):je(r,t-r.getFullYear());i.changeFocus(a).changeView(n-1).render()}function Xt(e){qt(e)}function Jt(e){Wt(e,-1)}function Qt(e){Wt(e,1)}function Zt(e,t){const i=St(t,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:r,isMinView:n}=e.picker.currentView,a=i.dataset;n?e.setDate(Number(a.date)):Kt(e,Number(1===r?a.month:a.year))}function ei(e){e.preventDefault()}const ti=["left","top","right","bottom"].reduce(((e,t)=>(e[t]=`datepicker-orient-${t}`,e)),{}),ii=e=>e&&`${e}px`;function ri(e,t){if("title"in t&&(t.title?(e.controls.title.textContent=t.title,pt(e.controls.title)):(e.controls.title.textContent="",lt(e.controls.title))),t.prevArrow){const i=e.controls.prevButton;mt(i),t.prevArrow.forEach((e=>{i.appendChild(e.cloneNode(!0))}))}if(t.nextArrow){const i=e.controls.nextButton;mt(i),t.nextArrow.forEach((e=>{i.appendChild(e.cloneNode(!0))}))}if(t.locale&&(e.controls.todayButton.textContent=t.locale.today,e.controls.clearButton.textContent=t.locale.clear),"todayButton"in t&&(t.todayButton?pt(e.controls.todayButton):lt(e.controls.todayButton)),"minDate"in t||"maxDate"in t){const{minDate:t,maxDate:i}=e.datepicker.config;e.controls.todayButton.disabled=!Ae(Le(),t,i)}"clearButton"in t&&(t.clearButton?pt(e.controls.clearButton):lt(e.controls.clearButton))}function ni(e){const{dates:t,config:i,rangeSideIndex:r}=e;return ke(t.length>0?Me(t):Xe(i.defaultViewDate,i.pickLevel,r),i.minDate,i.maxDate)}function ai(e,t){!("_oldViewDate"in e)&&t!==e.viewDate&&(e._oldViewDate=e.viewDate),e.viewDate=t;const{id:i,year:r,first:n,last:a}=e.currentView,o=new Date(t).getFullYear();switch(i){case 0:return t<n||t>a;case 1:return o!==r;default:return o<n||o>a}}function oi(e){return window.getComputedStyle(e).direction}function si(e){const t=dt(e);if(t!==document.body&&t)return"visible"!==window.getComputedStyle(t).overflow?t:si(t)}class ci{constructor(e){const{config:t,inputField:i}=this.datepicker=e,r=xt.replace(/%buttonClass%/g,t.buttonClass),n=this.element=ct(r).firstChild,[a,o,s]=n.firstChild.children,c=a.firstElementChild,[d,u,l]=a.lastElementChild.children,[p,m]=s.firstChild.children,f={title:c,prevButton:d,viewSwitch:u,nextButton:l,todayButton:p,clearButton:m};this.main=o,this.controls=f;const h=i?"dropdown":"inline";n.classList.add(`datepicker-${h}`),ri(this,t),this.viewDate=ni(e),It(e,[[n,"mousedown",ei],[o,"click",Zt.bind(null,e)],[f.viewSwitch,"click",Xt.bind(null,e)],[f.prevButton,"click",Jt.bind(null,e)],[f.nextButton,"click",Qt.bind(null,e)],[f.todayButton,"click",zt.bind(null,e)],[f.clearButton,"click",Ht.bind(null,e)]]),this.views=[new Bt(this),new jt(this),new $t(this,{id:2,name:"years",cellClass:"year",step:1}),new $t(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[t.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),t.container?t.container.appendChild(this.element):i.after(this.element)}setOptions(e){ri(this,e),this.views.forEach((t=>{t.init(e,!1)})),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:t}=this,i=e.inputField;if(i){const r=oi(i);r!==oi(dt(t))?t.dir=r:t.dir&&t.removeAttribute("dir"),this.place(),t.classList.add("active"),e.config.disableTouchKeyboard&&i.blur()}else t.classList.add("active");this.active=!0,Gt(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,Gt(this.datepicker,"hide"))}place(){const{classList:e,style:t}=this.element;t.display="block";const{width:i,height:r}=this.element.getBoundingClientRect(),n=this.element.offsetParent;t.display="";const{config:a,inputField:o}=this.datepicker,{left:s,top:c,right:d,bottom:u,width:l,height:p}=o.getBoundingClientRect();let{x:m,y:f}=a.orientation,h=s,g=c;if(n!==document.body&&n){const e=n.getBoundingClientRect();h-=e.left-n.scrollLeft,g-=e.top-n.scrollTop}else h+=window.scrollX,g+=window.scrollY;const I=si(o);let y=0,v=0,{clientWidth:S,clientHeight:U}=document.documentElement;if(I){const e=I.getBoundingClientRect();e.top>0&&(v=e.top),e.left>0&&(y=e.left),e.right<S&&(S=e.right),e.bottom<U&&(U=e.bottom)}let b=0;"auto"===m&&(s<y?(m="left",b=y-s):s+i>S?(m="right",S<d&&(b=S-d)):m="rtl"===oi(o)?d-i<y?"left":"right":"left"),"right"===m&&(h+=l-i),h+=b,"auto"===f&&(f=c-r>v&&u+r>U?"top":"bottom"),"top"===f?g-=r:g+=p,e.remove(...Object.values(ti)),e.add(ti[m],ti[f]),t.left=ii(h),t.top=ii(g)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const t=this.currentView;return e!==t.id&&(this._oldView||(this._oldView=t),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=ai(this,e)?"render":"refreshFocus",this.views.forEach((e=>{e.updateFocus()})),this}update(e=void 0){const t=void 0===e?ni(this.datepicker):e;return this._renderMethod=ai(this,t)?"render":"refresh",this.views.forEach((e=>{e.updateFocus(),e.updateSelection()})),this}render(e=!0){const{currentView:t,datepicker:i,_oldView:r}=this,n=new Date(this._oldViewDate),a=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,t[a](),r&&(this.main.replaceChild(t.element,r.element),Gt(i,"changeView")),!isNaN(n)){const e=new Date(this.viewDate);e.getFullYear()!==n.getFullYear()&&Gt(i,"changeYear"),e.getMonth()!==n.getMonth()&&Gt(i,"changeMonth")}}}function di(e,t,i,r,n,a){if(Ae(e,n,a)){if(r(e)){return di(t(e,i),t,i,r,n,a)}return e}}function ui(e,t,i){const r=e.picker,n=r.currentView,a=n.step||1;let o,s=r.viewDate;switch(n.id){case 0:s=Be(s,i?7*t:t),o=Be;break;case 1:s=Ve(s,i?4*t:t),o=Ve;break;default:s=je(s,t*(i?4:1)*a),o=je}s=di(s,o,t<0?-a:a,(e=>n.disabled.includes(e)),n.minDate,n.maxDate),void 0!==s&&r.changeFocus(s).render()}function li(e,t){const{config:i,picker:r,editMode:n}=e,a=r.active,{key:o,altKey:s,shiftKey:c}=t,d=t.ctrlKey||t.metaKey,u=()=>{t.preventDefault(),t.stopPropagation()};if("Tab"===o)return void Yt(e);if("Enter"===o){if(a)if(n)e.exitEditMode({update:!0,autohide:i.autohide});else{const t=r.currentView;t.isMinView?e.setDate(r.viewDate):(r.changeView(t.id-1).render(),u())}else e.update();return}const l=i.shortcutKeys,p={key:o,ctrlOrMetaKey:d,altKey:s,shiftKey:c},m=Object.keys(l).find((e=>{const t=l[e];return!Object.keys(t).find((e=>t[e]!==p[e]))}));if(m){let t;if("toggle"===m?t=m:n?"exitEditMode"===m&&(t=m):a?"hide"===m?t=m:"prevButton"===m?t=[Wt,[e,-1]]:"nextButton"===m?t=[Wt,[e,1]]:"viewSwitch"===m?t=[qt,[e]]:i.clearButton&&"clearButton"===m?t=[Ht,[e]]:i.todayButton&&"todayButton"===m&&(t=[zt,[e]]):"show"===m&&(t=m),t)return Array.isArray(t)?t[0].apply(null,t[1]):e[t](),void u()}if(!a||n)return;const f=(i,r)=>{c||d||s?e.enterEditMode():(ui(e,i,r),t.preventDefault())};"ArrowLeft"===o?f(-1,!1):"ArrowRight"===o?f(1,!1):"ArrowUp"===o?f(-1,!0):"ArrowDown"===o?f(1,!0):("Backspace"===o||"Delete"===o||o&&1===o.length&&!d)&&e.enterEditMode()}function pi(e){e.config.showOnFocus&&!e._showing&&e.show()}function mi(e,t){const i=t.target;(e.picker.active||e.config.showOnClick)&&(i._active=ut(i),i._clicking=setTimeout((()=>{delete i._active,delete i._clicking}),2e3))}function fi(e,t){const i=t.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&e.enterEditMode(),delete i._active,e.config.showOnClick&&e.show())}function hi(e,t){t.clipboardData.types.includes("text/plain")&&e.enterEditMode()}function gi(e,t){const{element:i,picker:r}=e;if(!r.active&&!ut(i))return;const n=r.element;St(t,(e=>e===i||e===n))||Yt(e)}function Ii(e,t){return e.map((e=>ot(e,t.format,t.locale))).join(t.dateDelimiter)}function yi(e,t,i=!1){if(0===t.length)return i?[]:void 0;const{config:r,dates:n,rangeSideIndex:a}=e,{pickLevel:o,maxNumberOfDates:s}=r;let c=t.reduce(((e,t)=>{let i=at(t,r.format,r.locale);return void 0===i||(i=Xe(i,o,a),Ae(i,r.minDate,r.maxDate)&&!e.includes(i)&&!r.checkDisabled(i,o)&&(o>0||!r.daysOfWeekDisabled.includes(new Date(i).getDay()))&&e.push(i)),e}),[]);return 0!==c.length?(r.multidate&&!i&&(c=c.reduce(((e,t)=>(n.includes(t)||e.push(t),e)),n.filter((e=>!c.includes(e))))),s&&c.length>s?c.slice(-1*s):c):void 0}function vi(e,t=3,i=!0,r=void 0){const{config:n,picker:a,inputField:o}=e;if(2&t){const e=a.active?n.pickLevel:n.startView;a.update(r).changeView(e).render(i)}1&t&&o&&(o.value=Ii(e.dates,n))}function Si(e,t,i){const r=e.config;let{clear:n,render:a,autohide:o,revert:s,forceRefresh:c,viewDate:d}=i;void 0===a&&(a=!0),a?void 0===o&&(o=r.autohide):o=c=!1,d=at(d,r.format,r.locale);const u=yi(e,t,n);!u&&!s||(u&&u.toString()!==e.dates.toString()?(e.dates=u,vi(e,a?3:1,!0,d),Gt(e,"changeDate")):vi(e,c?3:1,!0,d),o&&e.hide())}function Ui(e,t){return t?i=>ot(i,t,e.config.locale):e=>new Date(e)}class bi{constructor(e,t={},i=void 0){e.datepicker=this,this.element=e,this.dates=[];const r=this.config=Object.assign({buttonClass:t.buttonClass&&String(t.buttonClass)||"button",container:null,defaultViewDate:Le(),maxDate:void 0,minDate:void 0},At(bt,this));let n;if("INPUT"===e.tagName?(n=this.inputField=e,n.classList.add("datepicker-input"),t.container&&(r.container=t.container instanceof HTMLElement?t.container:document.querySelector(t.container))):r.container=e,i){const e=i.inputs.indexOf(n),t=i.datepickers;if(e<0||e>1||!Array.isArray(t))throw Error("Invalid rangepicker object.");t[e]=this,this.rangepicker=i,this.rangeSideIndex=e}this._options=t,Object.assign(r,At(t,this)),r.shortcutKeys=function(e){return Object.keys(kt).reduce(((t,i)=>{const r=void 0===e[i]?kt[i]:e[i],n=r&&r.key;if(!n||"string"!=typeof n)return t;const a={key:n,ctrlOrMetaKey:!!(r.ctrlOrMetaKey||r.ctrlKey||r.metaKey)};return n.length>1&&(a.altKey=!!r.altKey,a.shiftKey=!!r.shiftKey),t[i]=a,t}),{})}(t.shortcutKeys||{});const a=Ce(e.value||e.dataset.date,r.dateDelimiter);delete e.dataset.date;const o=yi(this,a);o&&o.length>0&&(this.dates=o),n&&(n.value=Ii(this.dates,r));const s=this.picker=new ci(this),c=[e,"keydown",li.bind(null,this)];n?It(this,[c,[n,"focus",pi.bind(null,this)],[n,"mousedown",mi.bind(null,this)],[n,"click",fi.bind(null,this)],[n,"paste",hi.bind(null,this)],[document,"mousedown",gi.bind(null,this)],[window,"resize",s.place.bind(s)]]):(It(this,[c]),this.show())}static formatDate(e,t,i){return ot(e,t,i&&Ut[i]||Ut.en)}static parseDate(e,t,i){return at(e,t,i&&Ut[i]||Ut.en)}static get locales(){return Ut}get active(){return!(!this.picker||!this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const t=At(e,this);Object.assign(this._options,e),Object.assign(this.config,t),this.picker.setOptions(t),vi(this,3)}show(){if(this.inputField){const{config:e,inputField:t}=this;if(t.disabled||t.readOnly&&!e.enableOnReadonly)return;!ut(t)&&!e.disableTouchKeyboard&&(this._showing=!0,t.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),yt(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const t=Ui(this,e);return this.config.multidate?this.dates.map(t):this.dates.length>0?t(this.dates[0]):void 0}setDate(...e){const t=[...e],i={},r=Me(e);r&&"object"==typeof r&&!Array.isArray(r)&&!(r instanceof Date)&&Object.assign(i,t.pop());Si(this,Array.isArray(t[0])?t[0]:t,i)}update(e=void 0){if(!this.inputField)return;const t=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0});Si(this,Ce(this.inputField.value,this.config.dateDelimiter),t)}getFocusedDate(e=void 0){return Ui(this,e)(this.picker.viewDate)}setFocusedDate(e,t=!1){const{config:i,picker:r,active:n,rangeSideIndex:a}=this,o=i.pickLevel,s=at(e,i.format,i.locale);void 0!==s&&(r.changeFocus(Xe(s,o,a)),n&&t&&r.changeView(o),r.render())}refresh(e=void 0,t=!1){let i;e&&"string"!=typeof e&&(t=e,e=void 0),i="picker"===e?2:"input"===e?1:3,vi(this,i,!t)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const t=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),t.update&&this.update(t)}}function wi(e){const t=Object.assign({},e);return delete t.inputs,delete t.allowOneSidedRange,delete t.maxNumberOfDates,t}function Ti(e,t){if(e._updating)return;e._updating=!0;const i=t.target;if(void 0===i.datepicker)return;const r=e.datepickers,[n,a]=r,o={render:!1},s=e.inputs.indexOf(i),c=0===s?1:0,d=r[s].dates[0],u=r[c].dates[0];void 0!==d&&void 0!==u?0===s&&d>u?(n.setDate(u,o),a.setDate(d,o)):1===s&&d<u&&(n.setDate(d,o),a.setDate(u,o)):e.allowOneSidedRange||(void 0!==d||void 0!==u)&&(o.clear=!0,r[c].setDate(r[s].dates,o)),r.forEach((e=>{e.picker.update().render()})),delete e._updating}class Di{constructor(e,t={}){let i=Array.isArray(t.inputs)?t.inputs:Array.from(e.querySelectorAll("input"));if(i.length<2)return;e.rangepicker=this,this.element=e,this.inputs=i=i.slice(0,2),Object.freeze(i),this.allowOneSidedRange=!!t.allowOneSidedRange;const r=Ti.bind(null,this),n=wi(t),a=this.datepickers=[];i.forEach((e=>{!function(e,t,i,r){It(e,[[i,"changeDate",t]]),new bi(i,r,e)}(this,r,e,n)})),Object.freeze(a),Object.defineProperty(this,"dates",{get:()=>a.map((e=>e.dates[0]))}),a[0].dates.length>0?Ti(this,{target:i[0]}):a[1].dates.length>0&&Ti(this,{target:i[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const t=wi(e);this.datepickers.forEach((e=>{e.setOptions(t)}))}destroy(){this.datepickers.forEach((e=>{e.destroy()})),yt(this),delete this.element.rangepicker}getDates(e=void 0){const t=e?t=>ot(t,e,this.datepickers[0].config.locale):e=>new Date(e);return this.dates.map((e=>void 0===e?e:t(e)))}setDates(e,t){const{datepickers:[i,r],inputs:[n,a],dates:[o,s]}=this;this._updating=!0,i.setDate(e),r.setDate(t),delete this._updating,r.dates[0]!==s?Ti(this,{target:a}):i.dates[0]!==o&&Ti(this,{target:n})}}function Pi(e,t,i,r,n){if(n){n(t.target.value)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=e.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}const Ni="none";function Ei(e,t){for(const i of t.options){if(i.hide)continue;const r=document.createElement("option");r.className="font-medium",i.value&&r.setAttribute("value",i.value),(i.selected||t.value===i.value)&&r.setAttribute("selected","true"),i.disabled&&r.setAttribute("disabled","true"),r.innerHTML=i.label,e.appendChild(r)}}function Mi(e){const t=document.createElement("div");if(t.className="field font-medium",e.class&&t.classList.add(e.class),e.width?t.style.cssText=`width: ${e.width}`:t.style.cssText="flex-grow: 1",e.label&&!e.checkbox){const i=document.createElement("label");i.style.cssText=e.labelStyle||"font-weight: bold; font-size: larger;",i.innerHTML=e.label,t.appendChild(i)}let i,r,n=[];const a=document.createElement("div");if(a.className="control font-medium",!1===e.controlVisible&&(a.style.display=Ni),e.controlId&&(a.id=e.controlId),e.text){const t=document.createElement("div");e.id&&(t.id=e.id),t.className="content",t.innerHTML=e.text,a.appendChild(t)}else if(e.radio){const t=document.createElement("div");t.id=e.id,t.className="control";for(const i of e.options??[]){const r=document.createElement("label");r.className="radio";const a=document.createElement("input");i.field&&n.push({input:a,field:i.field}),i.id&&(a.id=i.id),a.name=e.id,a.type="radio",a.value=i.text,i.checked&&(a.checked=!0),r.appendChild(a),t.appendChild(r);const o=document.createElement("span");o.style.marginLeft=".25em",o.style.marginRight="1em",o.style.color="#000",o.innerHTML=i.text,t.appendChild(o)}a.appendChild(t),i=t}else if(e.options){const t=document.createElement("div");t.className="select font-medium",t.style.cssText="width: 100%",e.zIndex&&(t.style.zIndex=e.zIndex);const r=document.createElement("select");if(e.dataPlaceholder&&r.setAttribute("data-placeholder",e.dataPlaceholder),e.dataType&&r.setAttribute("data-type",e.dataType),e.multiple&&r.setAttribute("multiple","true"),e.disabled&&(r.disabled=!0),e.id&&(t.id=e.id),r.style.cssText="width: 100%",Ei(r,e),t.appendChild(r),a.appendChild(t),e.help){const t=document.createElement("p");t.className="help font-medium is-info",t.innerHTML=e.help?.text,t.style.display=e.help?.visible?"":Ni,a.appendChild(t)}i=r,we(e.onChange)&&r.addEventListener("change",(t=>e.onChange(t,e)))}else if(e.checkbox){const t=document.createElement("div");t.className="flexrow nowrap",t.style.display="inline-block";const r=document.createElement("input");we(e.onChange)&&r.addEventListener("change",(t=>e.onChange(t,e))),i=r;const n=e.intent??"is-success";r.className=`is-checkradio ${n}`,r.type="checkbox",r.id=e.id,e.checked&&(r.checked=!0),t.appendChild(r);const o=document.createElement("label");o.setAttribute("for",e.id),e.color&&(o.style.color=e.color),o.innerHTML=e.label,t.appendChild(o),a.appendChild(t)}else{const t=document.createElement("input");if(t.className="input font-medium",e.class&&t.classList.add(e.class),t.setAttribute("type",e.type||"text"),t.setAttribute("autocomplete",e.autocomplete||"off"),t.setAttribute("placeholder",e.placeholder||""),e.disabled&&t.setAttribute("disabled","true"),e.id&&t.setAttribute("id",e.id),a.appendChild(t),e.iconLeft){a.classList.add("has-icons-left");const t=document.createElement("span");t.className="icon is-small is-left font-medium";const i=document.createElement("i");i.className=e.iconLeft,t.appendChild(i),a.appendChild(t)}if("password"===e.type){a.classList.add("has-icons-right");const t=document.createElement("span");t.className="icon is-small is-right font-medium";const i=document.createElement("i");i.className=e.iconRight,t.appendChild(i),a.appendChild(t)}i=t;const n=document.createElement("p");if(n.className="help font-medium",a.appendChild(n),e.validator&&t.addEventListener("input",(i=>Pi(e,i,t,n,e.validator))),e.date){const i=e.maxNumberOfDates||1,n=!e.maxNumberOfDates||1===i;r=new bi(t,{maxDate:e.maxDate,minDate:e.minDate,format:"yyyy-mm-dd",maxNumberOfDates:i,autohide:n})}else e.typeAhead&&Ee({...e.typeAhead,element:t});we(e.onKeyDown)&&t.addEventListener("keydown",(t=>e.onKeyDown(t,e))),we(e.onChange)&&t.addEventListener("change",(t=>e.onChange(t,e))),we(e.onInput)&&t.addEventListener("input",(t=>e.onInput(t,e))),we(e.onKeyUp)&&t.addEventListener("keyup",(t=>e.onKeyUp(t,e))),void 0!==e.value&&(t.value=e.value),e.selectOnFocus&&t.addEventListener("focus",(()=>t.select()))}return t.appendChild(a),!1===e.visible&&(t.style.display=Ni),{field:t,inputElement:i,datepicker:r,subFields:n}}function Ri({matchUp:e,side:t,sideNumber:i,eventHandlers:r,composition:n,position:a}){const o=n?.configuration,s=Ie(o?.participantProvider)?o.participantProvider():[],c=s.map((e=>({label:e.participantName||e.participantId,value:e.participantId}))),d=`assign-${e.matchUpId}-side${i}${a?`-p${a}`:""}`,{field:u}=Mi({typeAhead:{list:c,callback:n=>{const a=s.find((e=>e.participantId===n));a&&Ie(r?.assignParticipant)&&t&&r.assignParticipant({matchUp:e,side:t,sideNumber:i||1,participant:a})}},placeholder:a?`Partner ${a}`:"Type participant name...",field:d,id:d,class:"participant-assignment-input"});u.style.width="100%",u.style.margin="0";const l=o?.assignmentInputFontSize;return l&&(u.style.fontSize=l),setTimeout((()=>{const e=u.querySelector("input");if(e){let t=e.parentElement,i=0;for(;t&&i<15;){const e=window.getComputedStyle(t);("visible"!==e.overflow||"visible"!==e.overflowX||"visible"!==e.overflowY)&&(t.style.setProperty("overflow","visible","important"),t.style.setProperty("overflow-x","visible","important"),t.style.setProperty("overflow-y","visible","important")),t=t.parentElement,i++}}}),100),u}const Ci=Q({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});const Ai=Q({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});var ki=Object.defineProperty,Oi=(e,t)=>{for(var i in t)ki(e,i,{get:t[i],enumerable:!0})};var xi={};Oi(xi,{competitionGovernor:()=>Fi,drawsGovernor:()=>Mm,entriesGovernor:()=>MM,eventGovernor:()=>jM,generationGovernor:()=>PR,matchUpFormatGovernor:()=>QR,matchUpGovernor:()=>ZR,mocksGovernor:()=>mA,participantGovernor:()=>xk,policyGovernor:()=>IN,publishingGovernor:()=>uO,queryGovernor:()=>PN,reportGovernor:()=>wO,scheduleGovernor:()=>RO,scoreGovernor:()=>mD,tieFormatGovernor:()=>HO,tournamentGovernor:()=>fx,venueGovernor:()=>Cx});var Fi={};Oi(Fi,{getLinkedTournamentIds:()=>Em,getTournamentIds:()=>Kp,linkTournaments:()=>Tm,mutate:()=>Li,query:()=>Nm,unlinkTournament:()=>Pm,unlinkTournaments:()=>Dm});var Li={};Oi(Li,{linkTournaments:()=>Tm,unlinkTournament:()=>Pm,unlinkTournaments:()=>Dm});var _i="SINGLES",Bi="SINGLES",Vi="DOUBLES",ji="DOUBLES",$i="TEAM",Gi="TEAM",Wi={SINGLES_MATCHUP:_i,SINGLES:Bi,DOUBLES_MATCHUP:Vi,DOUBLES:ji,TEAM_MATCHUP:$i,TEAM:Gi},qi={[Bi]:[Bi,"S"],[ji]:[ji,"D"],[Gi]:[Gi,"T"],S:[Bi,"S"],D:[ji,"D"],T:[Gi,"T"]};function Hi(e,t){return(e??0)-(t??0)}function zi(e){return"number"==typeof e?parseInt(e.toString()):"string"==typeof e?parseInt(e):0}function Yi(e){return!isNaN(e)&&(e&&0==(e&e-1))}function Ki(e){if(!e.length)return;let t=[...e].sort(Hi),i=Math.floor(t.length/2);return t.length%2?t[i]:(t[i-1]+t[i])/2}function Xi(e){return isNaN(e)?0:e%2&&e+1||e}function Ji(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function Qi(e){return!isNaN(parseFloat(e))}function Zi(e){let t=zi(e);if(!isNaN(t))return 0!==t&&1==(t&-t)}function er(e){if(isNaN(e))return!1;for(;!Yi(e);)e++;return e}function tr(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function ir(e){return Number.isSafeInteger("string"==typeof e?+e:e)}function rr(e,t,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=rr(e,t,i):(s=Math.pow(s,i),s*=t-e,s+=e),r&&(s=function(e,t){t||(t=1);let i=1/t;return Math.round(e*i)/i}(s,r)),parseFloat(s.toFixed(n))}function nr(e,t=2){return parseFloat(Number(Math.round(1e3*e)/1e3).toFixed(t))}function ar(e){return Array.isArray(e)?e?.filter(((e,t,i)=>i.lastIndexOf(e)===t)):[]}function or(e){return Array.isArray(e)?e?.map((e=>null===e?void 0:e)):e}function sr(e){return Array.isArray(e)?e.map((e=>[Math.random(),e])).sort(((e,t)=>e[0]-t[0])).map((e=>e[1])):[]}function cr(e){return ir(e)?e:1/0}function dr(e){return Array.isArray(e)?e.reduce(((e,t)=>(e[t]||(e[t]=0),e[t]++,e)),{}):{}}function ur(e){return lr(dr(e))}function lr(e){return Object.keys(e).reduce(((t,i)=>{let r=e[i];return t[r]?t[r].push(i):t[r]=[i],t}),{})}function pr(e,t,i){return i.indexOf(e)===t}function mr(e){return e.filter(pr)}function fr(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function hr(e){return e[Math.floor(Math.random()*e.length)]}function gr(e,t){return Array.from({length:t-e},((t,i)=>i+e))}function Ir(e,t){return t.reduce(((t,i,r)=>(i===e&&t.push(r),t)),[])}function yr(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>-1!==t.indexOf(e))).filter(((e,t,i)=>i.indexOf(e)===t)):[]}function vr(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>!t.includes(e))):[]}function Sr(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some((e=>t.includes(e)))}function Ur(e,t){return Array.isArray(t)&&t.reduce(((e,t)=>(e[t]=1+e[t]||1,e)),{})[e]||0}function br(e,t,i,r){return Array.isArray(e)?[].concat(...e.slice(0,t),...e.slice(t,t+i).sort(r),...e.slice(t+i,e.length)):[]}function wr(e,t){return Array.isArray(e)?e.reduce(((e,i,r)=>{let n=Math.floor(r/t);return e[n]=[].concat(e[n]||[],i),e}),[]):[]}function Tr(e,[t,...i]){return e.length?[e.slice(0,t),...Tr(e.slice(t),[...i,t])]:[]}function Dr(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>!isNaN(parseInt(t))&&e),!0)}function Pr(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>isNaN(parseInt(t))&&e),!0)}function Nr(e,t,i){return Array.isArray(e)?e.reduce(((e,r,n)=>{let a=!!i&&!!(Math.floor(n/t)%2),o=n%t,s=a?t-1-o:o;return e[s]||(e[s]=[]),e[s].push(r),e}),[]):[]}function Er(e){return"function"==typeof e}function Mr(e){return"string"==typeof e}function Rr(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function Cr(e,t){if(!Rr(e)||!Rr(t))return!1;let i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(let n of i)if(e[n]!==t[n])return!1;return!0}function Ar(e,t){return Array.isArray(e)?Object.assign({},...(e??[]).filter(Rr).map((e=>e[t]&&{[e[t]]:e})).filter(Boolean)):{}}var kr=e=>t=>Object.keys(e).every((i=>t[i]===e[i]));function Or(e,t){if(void 0===e)return null;if(!Rr(e)||null===e)return e;let i=Object.keys(e),r=e=>void 0===e?null:e;return Object.assign({},...i.map((i=>Array.isArray(e[i])?{[i]:t?e[i]:e[i].map((e=>Or(e)))}:{[i]:t?r(e[i]):Or(e[i])})))}function xr(e){return Array.isArray(e)?e.length+e.map(xr).reduce(((e,t)=>e+t),0):Rr(e)&&null!==e?Object.keys(e).length+Object.keys(e).map((t=>xr(e[t]))).reduce(((e,t)=>e+t),0):0}function Fr(e){if(null===e||"object"!=typeof e)return;let t=JSON.stringify(e),i=xr(e),r=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0);return[t.length,i,r].map((e=>e.toString(36))).join("")}function Lr(e,t){return!(!Array.isArray(e)||!Mr(t))&&yr(e,qi[t]).length}var _r={success:!0},Br="error",Vr={SUCCESS:_r,ERROR:Br};function jr({collectionValueProfiles:e,matchUpCount:t}){let i=[];if(!Array.isArray(e))return i.push(`collectionValueProfiles is not an array: ${e}`),{errors:i};if(e.length&&e.length!==t)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of e){if("object"!=typeof n)return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:e,collectionPosition:r}=n;if("number"!=typeof e||"number"!=typeof r||r>t||r<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=e.map((e=>e.collectionPosition));return r.length!==ar(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{..._r}}Oi({},{addNotice:()=>As,callListener:()=>Bs,createInstanceState:()=>ys,cycleMutationStatus:()=>Cs,deepCopyEnabled:()=>Ps,deleteNotice:()=>xs,deleteNotices:()=>Fs,disableNotifications:()=>ws,enableNotifications:()=>Ts,getDevContext:()=>vs,getMethods:()=>ks,getNotices:()=>Os,getProvider:()=>zs,getTopics:()=>Ls,getTournamentId:()=>Vs,getTournamentRecord:()=>js,getTournamentRecords:()=>$s,globalLog:()=>Ks,handleCaughtError:()=>Ys,hasTopic:()=>_s,removeTournamentRecord:()=>Hs,setDeepCopy:()=>Ds,setDevContext:()=>bs,setGlobalLog:()=>Us,setGlobalMethods:()=>Ms,setGlobalSubscriptions:()=>Ns,setMethods:()=>Rs,setStateMethods:()=>Xs,setStateProvider:()=>Is,setSubscriptions:()=>Es,setTournamentId:()=>qs,setTournamentRecord:()=>Gs,setTournamentRecords:()=>Ws,timeKeeper:()=>Ss});var $r={message:"Chronological error; time violation.",code:"ANACHRONISM"},Gr={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Wr={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},qr={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Hr={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},zr={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Yr={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Kr={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Xr={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Jr={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Qr={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Zr={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},en={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},tn={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},rn={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},nn={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},an={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},on={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},sn={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},cn={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},dn={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},un={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},ln={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},pn={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},mn={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},fn={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},hn={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},gn={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},In={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},yn={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},vn={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Sn={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Un={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},bn={message:"Invalid action",code:"ERR_INVALID_ACTION"},wn={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Tn={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},Dn={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Pn={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},Nn={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},En={message:"Existing round",code:"ERR_EXISTING_ROUND"},Mn={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Rn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Cn={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},An={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},kn={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},On={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},xn={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Fn={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Ln={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},_n={message:"Event exists",code:"ERR_EXISTING_EVENT"},Bn={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Vn={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},jn={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},$n={message:"Missing stage",code:"ERR_MISSING_STAGE"},Gn={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Wn={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},qn={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Hn={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},zn={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Yn={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},Kn={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Xn={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},Jn={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Qn={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Zn={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},ea={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},ta={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},ia={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},ra={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},na={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},aa={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},oa={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},sa={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},ca={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},da={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},ua={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},la={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},pa={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},ma={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},fa={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},ha={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},ga={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Ia={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},ya={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},va={message:"Missing value",code:"ERR_MISSING_VALUE"},Sa={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Ua={message:"Missing date",code:"ERR_MISSING_DATE"},ba={message:"No valid dates",code:"ERR_NO_VALID_DATES"},wa={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},Ta={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Da={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Pa={message:"Invalid Date",code:"ERR_INVALID_DATE"},Na={message:"Invalid time",code:"ERR_INVALID_TIME"},Ea={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},Ma={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Ra={message:"Invalid score",code:"ERR_INVALID_SCORE"},Ca={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Aa={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},ka={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Oa={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},xa={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Fa={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},La={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},_a={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ba={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Va={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},ja={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},$a={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Ga={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Wa={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},qa={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},Ha={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},za={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},Ya={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Ka={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Xa={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Ja={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Qa={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},Za={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},eo={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},to={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},io={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},ro={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},no={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},ao={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},oo={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},so={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},co={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},uo={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},lo={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},po={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},mo={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},fo={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},ho={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},go={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},Io={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},yo={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},vo={message:"Court exists",code:"ERR_EXISTING_COURT"},So={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},Uo={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},bo={message:"Venue exists",code:"ERR_EXISTING_VENUE"},wo={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},To={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Do={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},Po={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},No={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Eo={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Mo={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},Ro={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Co={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},Ao={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},ko={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Oo={message:"Missing context",code:"ERR_MISSING_CONTEXT"},xo={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Fo={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Lo={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},_o={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Bo={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},Vo={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},jo={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},$o={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Go={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Wo={message:"Invalid gender",code:"ERR_INVALID_GENDER"},qo={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Ho={message:"Invalid values",code:"ERR_INVALID_VALUES"},zo={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},Yo={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Ko={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},Xo={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},Jo={message:"Value unchanged",code:"ABORT_UNCHANGED"},Qo={message:"Not found",code:"ERR_NOT_FOUND"},Zo={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},es={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},ts={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},is={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},rs={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},ns={message:"Existing stage",code:"ERR_EXISTING_STAGE"},as={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},os={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},ss={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},cs={message:"Scores present",code:"ERR_SCORES_PRESENT"},ds={ANACHRONISM:$r,BOOKING_NOT_FOUND:So,CANNOT_CHANGE_WINNING_SIDE:La,CANNOT_MODIFY_TIEFORMAT:ka,CANNOT_MODIFY_PARTICIPANT_TYPE:Oa,CANNOT_REMOVE_MAIN_STRUCTURE:Wr,CANNOT_REMOVE_PARTICIPANTS:xa,CATEGORY_MISMATCH:Fa,COURT_EXISTS:vo,COURT_NOT_FOUND:yo,EXISTING_MATCHUPS:Uo,DRAW_DEFINITION_NOT_FOUND:Zr,DRAW_ID_EXISTS:yn,DRAW_POSITION_ACTIVE:dn,DRAW_POSITION_ASSIGNED:nn,DRAW_POSITION_NOT_CLEARED:on,DRAW_POSITION_NOT_FOUND:{message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},DRAW_SIZE_MISMATCH:hn,DUPLICATE_ENTRY:Gr,DUPLICATE_VALUE:zo,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:uo,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:co,EVENT_EXISTS:_n,EVENT_NOT_FOUND:Ln,EXISTING_DRAW_DEFINITIONS:Qr,EXISTING_END_TIME:Po,EXISTING_FLIGHT:es,EXISTING_MATCHUP_ID:rs,EXISTING_OUTCOME:is,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:to,EXISTING_PARTICIPANT:io,EXISTING_POLICY_TYPE:fa,EXISTING_PROFILE:ts,EXISTING_ROUND:En,EXISTING_STAGE:ns,EXISTING_STRUCTURE:as,INCOMPATIBLE_MATCHUP_STATUS:Kn,INCOMPLETE_SOURCE_STRUCTURE:tn,INSUFFICIENT_DRAW_POSITIONS:mo,INVALID_ACTION:bn,INVALID_ASSIGNMENT:wn,INVALID_BOOKINGS:wa,INVALID_CATEGORY:qo,INVALID_COLLECTION_DEFINITION:$o,INVALID_CONFIGURATION:jo,INVALID_DATE_AVAILABILITY:Ta,INVALID_DATE:Pa,INVALID_DRAW_DEFINITION:Xr,INVALID_DRAW_POSITION_FOR_SEEDING:rn,INVALID_DRAW_POSITION:ln,INVALID_DRAW_SIZE:fn,INVALID_END_TIME:Do,INVALID_ENTRIES:Vn,INVALID_EVENT_TYPE:xn,INVALID_GAME_SCORES:Ma,INVALID_GENDER:Wo,INVALID_MATCHUP_FORMAT:Zn,INVALID_MATCHUP_STATUS:Jn,INVALID_MATCHUP_STATUS_BYE:Hn,INVALID_MATCHUP:ca,INVALID_OBJECT:Go,INVALID_PARTICIPANT_ID:Ba,INVALID_PARTICIPANT_IDS:Va,INVALID_PARTICIPANT_ROLE:ja,INVALID_PARTICIPANT_SEEDING:vn,INVALID_PARTICIPANT_TYPE:$a,INVALID_PARTICIPANT:_a,INVALID_POLICY_DEFINITION:ma,INVALID_RECORDS:qr,INVALID_SCALE_ITEM:Fo,INVALID_SEED_NUMBER:Dn,INVALID_SEED_POSITION:Pn,INVALID_SET_NUMBER:{message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},INVALID_SIDE_NUMBER:ga,INVALID_SCORE:Ra,INVALID_STAGE:Gn,INVALID_START_TIME:Eo,INVALID_STRUCTURE:en,INVALID_STOP_TIME:No,INVALID_TIE_FORMAT:Qn,INVALID_TIME:Na,INVALID_TIME_ITEM:Ro,INVALID_TOURNAMENT_DATES:Ea,INVALID_TOURNAMENT_RECORD:Yr,INVALID_VALUES:Ho,INVALID_WINNING_SIDE:Ca,MATCHUP_NOT_FOUND:aa,METHOD_NOT_FOUND:os,MISSING_ASSIGNMENTS:jn,MISSING_ASYNC_STATE_PROVIDER:Co,MISSING_AVOIDANCE_POLICY:la,MISSING_BIRTH_DATE:Sa,MISSING_COLLECTION_DEFINITION:ta,MISSING_COURT_ID:ya,MISSING_COURTS_INFO:Io,MISSING_DATE_AVAILABILITY:Da,MISSING_DATE:Ua,MISSING_DRAW_DEFINITION:Jr,MISSING_DRAW_ID:In,MISSING_DRAW_POSITION:pn,MISSING_DRAW_POSITIONS:cn,MISSING_DRAW_SIZE:gn,MISSING_ENTRIES:Bn,MISSING_EVENT:Fn,MISSING_QUALIFIED_PARTICIPANTS:za,MISSING_MATCHUP_FORMAT:ea,MISSING_MATCHUP_ID:ra,MISSING_MATCHUP_IDS:na,MISSING_MATCHUP:sa,MISSING_MATCHUPS:oa,MISSING_PARTICIPANT_COUNT:Qa,MISSING_PARTICIPANT_ID:Ha,MISSING_PARTICIPANT_IDS:Ja,MISSING_PARTICIPANT_ROLE:Ga,MISSING_PARTICIPANT:Wa,MISSING_PARTICIPANTS:qa,MISSING_PENALTY_ID:ho,MISSING_PENALTY_TYPE:fo,MISSING_PERSON_DETAILS:eo,MISSING_POLICY_ATTRIBUTES:pa,MISSING_POLICY_DEFINITION:ua,MISSING_POLICY_TYPE:da,MISSING_POSITION_ASSIGNMENTS:qn,MISSING_ROUND_NUMBER:{message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},MISSING_SCHEDULE:xo,MISSING_SCORING_POLICY:{message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},MISSING_SEED_ASSIGNMENTS:Tn,MISSING_SEEDCOUNT_THRESHOLDS:Un,MISSING_SEEDING_POLICY:{message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},MISSING_SET_NUMBER:{message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},MISSING_SET_OBJECT:Ia,MISSING_SIDE_NUMBER:{message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},MISSING_STAGE:$n,MISSING_STRUCTURE_ID:Mn,MISSING_STRUCTURE:An,MISSING_MAIN_STRUCTURE:kn,MISSING_STRUCTURES:Cn,MISSING_TARGET_LINK:Nn,MISSING_TIE_FORMAT:ia,MISSING_TIME_ITEM:Ao,MISSING_TIME_ITEMS:ko,MISSING_TOURNAMENT_ID:Kr,MISSING_TOURNAMENT_RECORD:zr,MISSING_TOURNAMENT_RECORDS:Hr,MISSING_VALUE:va,MISSING_VENUE_ID:To,MODIFICATIONS_FAILED:Lo,NO_CANDIDATES:Vo,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:po,NO_MODIFICATIONS_APPLIED:_o,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:lo,NO_PARTICIPANT_REMOVED:Xa,NO_VALID_ACTIONS:Ko,NO_VALID_ATTRIBUTES:Xo,NO_VALID_DATES:ba,NOT_FOUND:Qo,NOT_IMPLEMENTED:Zo,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:ro,PARTICIPANT_ID_EXISTS:Ka,PARTICIPANT_NOT_CHECKED_IN:Za,PARTICIPANT_NOT_FOUND:Ya,PARTICIPANT_PAIR_EXISTS:{message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},PENALTY_NOT_FOUND:go,POLICY_NOT_ATTACHED:{message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},POLICY_NOT_FOUND:ha,SCHEDULE_NOT_CLEARED:an,SCHEDULED_MATCHUPS:ss,SCORES_PRESENT:cs,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Sn,STAGE_SEQUENCE_LIMIT:Wn,STRUCTURE_NOT_FOUND:Rn,TEAM_NOT_FOUND:Yo,UNABLE_TO_ASSIGN_COURT:Bo,UNLINKED_STRUCTURES:On,UNRECOGNIZED_DRAW_TYPE:sn,UNRECOGNIZED_MATCHUP_FORMAT:Yn,UNRECOGNIZED_MATCHUP_STATUS:zn,VALUE_UNCHANGED:Jo,VENUE_EXISTS:bo},us={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},ls={addNotice:function({topic:e,payload:t,key:i},r){if("string"==typeof e&&"object"==typeof t&&(us.disableNotifications||(us.modified=!0),!us.disableNotifications&&(us.subscriptions[e]||r)))return i&&(us.notices=us.notices.filter((t=>!(t.topic===e&&t.key===i)))),us.notices.push({topic:e,payload:t,key:i}),{..._r}},callListener:function({topic:e,notices:t},i){let r=us.subscriptions[e];r&&"function"==typeof r&&r(t);let n=i?.[e];n&&"function"==typeof n&&n(t)},cycleMutationStatus:function(){let e=us.modified;return us.modified=!1,e},deleteNotice:function({topic:e,key:t}){us.notices=us.notices.filter((i=>(!e||i.topic===e)&&i.key!==t))},deleteNotices:function(){us.notices=[]},disableNotifications:function(){us.disableNotifications=!0},enableNotifications:function(){us.disableNotifications=!1},getMethods:ms,getNotices:function({topic:e}){return us.notices.filter((t=>t.topic===e)).map((e=>e.payload))},getTopics:function(){return{topics:Object.keys(us.subscriptions)}},getTournamentId:ps,getTournamentRecord:function(e){return us.tournamentRecords[e]},getTournamentRecords:function(){return us.tournamentRecords},removeTournamentRecord:function(e){if("string"!=typeof e)return{error:Ho};if(!us.tournamentRecords[e])return{error:Qo};delete us.tournamentRecords[e];let t=Object.keys(us.tournamentRecords);return 1===t.length?us.tournamentId=t[0]:t.length||(us.tournamentId=void 0),{success:!0}},setMethods:function(e){return"object"!=typeof e?{error:Ho}:(Object.keys(e).forEach((t=>{"function"==typeof e[t]&&(us.methods[t]=e[t])})),{..._r})},setSubscriptions:function(e){return"object"!=typeof e.subscriptions?{error:Ho}:(Object.keys(e.subscriptions).forEach((t=>{"function"==typeof e.subscriptions[t]?us.subscriptions[t]=e.subscriptions[t]:delete us.subscriptions[t]})),{..._r})},setTournamentId:function(e){return e?us.tournamentRecords[e]?(us.tournamentId=e,{success:!0}):{error:zr}:(us.tournamentId=void 0,{success:!0})},setTournamentRecord:function(e){let t=e?.tournamentId;return t?(us.tournamentRecords[t]=e,{success:!0}):{error:Yr}},setTournamentRecords:function(e){us.tournamentRecords=e;let t=Object.keys(e);1===t.length?us.tournamentId=t[0]:t.length||(us.tournamentId=void 0)},handleCaughtError:function({engineName:e,methodName:t,params:i,err:r}){let n;return"string"==typeof r?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:ps(),params:JSON.stringify(i),engine:e,methodName:t,error:n}),{error:n}}};function ps(){return us.tournamentId}function ms(){return us.methods??{}}var fs={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},hs=ls,gs=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function Is(e){if("object"!=typeof e)throw new Error("Global state provider can not be undefined or null");if(yr(Object.keys(e),gs).length!==gs.length)throw new Error("Global state provider is missing required methods");return hs=e,{success:!0}}function ys(){if(hs.createInstanceState){try{hs.createInstanceState()}catch(ae){return{error:ae}}return{success:!0}}return{error:Co}}function vs(e){return e&&"object"==typeof e?"object"==typeof fs.devContext&&(Object.keys(e).every((t=>fs.devContext?.[t]===e[t]))&&fs.devContext):fs.devContext??!1}function Ss(e="reset",t="default"){let i=Date.now();if("report"===e){if("allTimers"===t)return Object.keys(fs.timers).filter((e=>"default"!==e||fs.timers[e].startTime)).map((e=>{let t=fs.timers[e],r="stopped"===t.state?0:(i-(t?.startTime??0))/1e3,n=t.elapsedTime+r;return{state:fs.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}));{let e="stopped"===fs.timers[t].state?0:(i-(fs.timers[t]?.startTime??0))/1e3,r=fs.timers[t].elapsedTime+e;return{state:fs.timers[t].state,elapsedTime:r.toFixed(2),timer:t}}}if(!fs.timers[t]||"reset"===e){if("allTimers"===t)return fs.timers={default:{elapsedTime:0}},!0;fs.timers[t]={startTime:i,state:"active",elapsedTime:0}}return fs.timers[t].elapsedTime||(fs.timers[t].elapsedTime=0),"stop"===e&&"stopped"!==fs.timers[t].state&&(fs.timers[t].state="stopped")&&(fs.timers[t].elapsedTime+=(i-(fs.timers[t]?.startTime??0))/1e3),"start"===e&&(fs.timers[t].startTime=i)&&(fs.timers[t].state="active"),fs.timers[t]}function Us(e){Er(e)?fs.globalLog=e:delete fs.globalLog}function bs(e){fs.devContext=e}function ws(){hs.disableNotifications()}function Ts(){hs.enableNotifications()}function Ds(e,t){"boolean"==typeof e&&(fs.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(fs.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(fs.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(fs.deepCopyAttributes.stringify=t.stringify),t.threshold&&(fs.deepCopyAttributes.threshold=t.threshold))}function Ps(){return{enabled:fs.deepCopy,...fs.deepCopyAttributes}}function Ns(e){return e?.subscriptions?(Object.keys(e.subscriptions).forEach((t=>{fs.globalSubscriptions[t]=e.subscriptions[t]})),{..._r}):{error:va,info:"missing subscriptions"}}function Es(e){return e?.subscriptions?hs.setSubscriptions({subscriptions:e.subscriptions}):{error:va,info:"missing subscriptions"}}function Ms(e){return e?"object"!=typeof e?{error:Ho}:(Object.keys(e).forEach((t=>{Er(e[t])&&(fs.globalMethods[t]=e[t])})),{..._r}):{error:va,info:"missing method declarations"}}function Rs(e){return e?"object"!=typeof e?{error:Ho}:hs.setMethods(e):{error:va,info:"missing method declarations"}}function Cs(){return hs.cycleMutationStatus()}function As(e){if("string"!=typeof e?.topic)return;let t=fs.globalSubscriptions[e.topic];return hs.addNotice(e,t)}function ks(){return{...fs.globalMethods,...hs.getMethods()}}function Os(e){return hs.getNotices(e)}function xs({key:e,topic:t}){return hs.deleteNotice({key:e,topic:t})}function Fs(){return hs.deleteNotices()}function Ls(){return hs.getTopics()}function _s(e){return Ls()?.topics?.includes(e)}async function Bs(e){return hs.callListener(e,fs.globalSubscriptions)}function Vs(){return hs.getTournamentId()}function js(e){return hs.getTournamentRecord(e)}function $s(){return hs.getTournamentRecords()}function Gs(e){return hs.setTournamentRecord(e)}function Ws(e){return hs.setTournamentRecords(e)}function qs(e){return hs.setTournamentId(e)}function Hs(e){return hs.removeTournamentRecord(e)}function zs(){return hs}function Ys({engineName:e,methodName:t,params:i,err:r}){let n=Er(hs.handleCaughtError)&&hs.handleCaughtError||ls.handleCaughtError,{tournamentRecord:a,...o}=i;return n({params:o,engineName:e,methodName:t,err:r})}function Ks(e,t){if(fs.globalLog)try{fs.globalLog({log:e,engine:t})}catch(i){console.log("globalLog error",i),console.log(t,e),Us()}else console.log(t,e)}function Xs(e,t,i,r){if(!Rr(e))return{error:Ho};Qi||(i=1);let n=Array.isArray(t)?t:[],a={},o=(e,r=0)=>{Object.keys(e).forEach((s=>{Er(e[s])?a[s]=e[s]:Rr(e[s])&&(!0===t||n?.includes(s))&&(void 0===i||r<i)&&o(e[s],r+1)}))};return o(e),r?Ms(a):Rs(a),{methods:a}}function Js(e,t,i,r){if("object"!=typeof e||null===e)return e;Ps()?.enabled||(r=!0);let n=["",void 0,null];t&&n.push(!1);let a=function(e,t,i){return Object.keys(e).filter((r=>!t.includes(e[r])&&(!i||!Array.isArray(e[r])||e[r].length)))}(e,n,i);return Object.assign({},...a.map((t=>Array.isArray(e[t])?{[t]:r?e[t]:e[t].map((e=>Js(e)))}:{[t]:r?e[t]:Js(e[t])})))}function Qs({context:e,result:t,stack:i,info:r}){return t&&!Array.isArray(t?.stack)&&(t.stack=[]),t&&Array.isArray(t?.stack)&&"string"==typeof i&&t.stack.push(i),t&&r&&(t.info=r),t&&"object"==typeof e&&Object.keys(e).length&&(t.context||(t.context={}),Object.assign(t.context,Js(e))),t&&!t?.error&&!t?.success&&Object.assign(t,{..._r}),t??{success:!0}}var Zs="FEMALE",ec="OTHER",tc="MIXED",ic="MALE",rc={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:Zs,MIXED:tc,OTHER:ec,MALE:ic,ANY:"ANY"};function nc(e){return[Zs,"F"].includes(e)}function ac(e){return[ic,"M"].includes(e)}function oc(e){return[tc,"X"].includes(e)}function sc(e){return["ANY","A"].includes(e)}function cc(e){if(e){if(nc(e))return Zs;if(oc(e))return tc;if(ac(e))return ic;if(sc(e))return"ANY"}return ec}function dc(e){return nc(e)||ac(e)}var uc="MIXED events can not contain mixed singles or { gender: ANY } collections",lc="events with { gender: ANY } can not contain MIXED singles collections";function pc(e){let t="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=e;return i&&n&&dc(i)&&cc(i)!==cc(n)?Qs({result:{valid:!1,error:Wo},context:{gender:n},stack:t}):oc(i)&&(sc(n)||oc(n)&&r!==ji)?Qs({result:{error:Wo,valid:!1},info:uc,stack:t}):sc(i)&&oc(n)&&r!==ji?Qs({result:{error:Wo,valid:!1},info:lc,stack:t}):{valid:!0}}var mc="timed",fc="NOAD",hc={S:"normal",F:"final"};function gc(e,t){if(Rr(e)&&(e?.bestOf||e?.exactly)&&e?.setFormat)return function(e,t){let i=Ic(e.bestOf)||void 0,r=Ic(e.exactly)||void 0,n=i||r;if(e.setFormat?.timed&&e.simplified&&1===n)return yc(e.setFormat);let a=n&&`SET${n}${r&&1!==r?"X":""}`||"",o=vc(e.setFormat,t),s=o&&`S:${o}`||"",c=vc(e.finalSetFormat,t),d=n&&n>1&&c&&o!==c&&`F:${c}`||"";if(a&&o)return[a,s,d].filter(Boolean).join("-")}(e,t)}function Ic(e){return!Number.isNaN(Number(e))&&Number(e)}function yc(e){let t=`T${e.minutes}`;return"A"===e.based?t+="A":"P"===e.based&&(t+="P"),e.tiebreakFormat?.tiebreakTo&&(t+=`/TB${e.tiebreakFormat.tiebreakTo}`),e.modifier&&(t+=`@${e.modifier}`),t}function vc(e,t){if("object"==typeof e&&Object.keys(e).length){if(e.timed)return yc(e);if(e.tiebreakSet)return Sc(e.tiebreakSet);let i=Ic(e.setTo);if(i){let r=e.NoAD&&fc||"",n=Sc(e.tiebreakFormat),a=n&&`/${n}`||"",o=Ic(e.tiebreakAt);if(!1!==n)return`${i}${r}${a}${o&&(o!==i||t)&&`@${o}`||""}`}}}function Sc(e){if(e){if("object"==typeof e&&!e.tiebreakTo)return"";if("object"==typeof e&&Ic(e.tiebreakTo)){let t=`TB${e.tiebreakTo}${e.NoAD?fc:""}`;return e.modifier&&(t+=`@${e.modifier}`),t}return!1}}function Uc(e){if(Mr(e)){let t=e.startsWith("T")&&mc||e.startsWith("SET")&&"SET"||"";if(t===mc){let t=Dc(e);if(t)return{simplified:!0,setFormat:t,bestOf:1}}if("SET"===t)return function(e){let t=e.split("-"),i=t[0].slice(3),r=i.endsWith("X"),n=Nc(r?i.slice(0,-1):i),a=r&&1!==n?void 0:n,o=r&&1!==n?n:void 0,s=t&&bc(t[1]),c=t&&bc(t[2]),d=s&&s.timed||c&&c.timed,u=a&&a<6||d&&o,l=!t[2]||c,p=s,m=Js({setFormat:s,exactly:o,bestOf:a});if(c&&(m.finalSetFormat=c),u&&p&&l)return m}(e)}}function bc(e){if(":"!==e?.[1])return;let t=e.split(":"),i=hc[t[0]],r=t[1];return i&&r?function(e,t){return t.startsWith("TB")?function(e){let t=Tc(e);return!1!==t&&("object"==typeof t?{tiebreakSet:t}:void 0)}(t):t.startsWith("T")?Dc(t):function(e,t){let i=/^[FS]:(\d+)([A-Za-z]*)/.exec(e),r=i&&Pc(i[2])||!1,n=!i?.[2]||r,a=i?Nc(i[1]):void 0,o=wc(t),s=!1!==o,c=s&&o||a,d=Tc(t.split("/")[1]);return!!(a&&n&&!1!==d&&s)&&function(e,t,i,r){let n={setTo:e};return t&&(n.NoAD=!0),i?(n.tiebreakFormat=i,n.tiebreakAt=r):n.noTiebreak=!0,n}(a,r,d,c)}(e,t)}(e,r):void 0}function wc(e,t=!0){let i=e?.indexOf("@")>0&&e.split("@");if(i)return(t?Nc(i[1]):i[1])||!1}function Tc(e){if(e)return!!e.startsWith("TB")&&function(e){let t=wc(e,!1),i=/^TB(\d+)([A-Za-z]*)/.exec(e),r=i?.[1],n=i&&Pc(i[2]),a=!i?.[2]||n,o=Nc(r);if(!o||!a)return!1;let s={tiebreakTo:o};return t&&"string"==typeof t&&!ir(t)&&(s.modifier=t),n&&(s.NoAD=!0),s}(e)}function Dc(e){let t=e.slice(1),i=/^(\d+)([PGA])?(?:\/TB(\d+))?(@?[A-Za-z]*)?/.exec(t),r=Nc(i?.[1]);if(!r)return;let n={timed:!0,minutes:r},a=i?.[2];"A"===a?n.based="A":"P"===a?n.based="P":"G"===a&&(n.based="G");let o=i?.[3];if(o){let e=Nc(o);e&&(n.tiebreakFormat={tiebreakTo:e})}let s=i?.[4],c=[void 0,"P","G",""].includes(s);if(s&&!c){let e=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(t)?.[4];return e?(n.modifier=e,n):void 0}return s&&(n.based=s),n}function Pc(e){return e?.includes(fc)}function Nc(e){let t=Number(e);return Number.isNaN(t)?0:t}function Ec({matchUpFormat:e}){if(!Mr(e)||""===e)return!1;let t=Uc(e),i=/-S:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(e),r=i?.[1],n=i?.[2],a=i?.[3],o=/-F:([1-9])+\/TB(\d{1,2})@?([1-9]?)/.exec(e),s=o?.[1],c=o?.[2],d=o?.[3];return gc(t,!!(i&&n&&r===a||o&&c&&s===d))===e.replace(/G/,"")}var Mc=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,Rc=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Cc=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Ac=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function kc(e){let{scheduledDate:t}=e;if(!t&&e.scheduledTime&&(t=Yc(e.scheduledTime)),!t)return;let i=zc(e.scheduledTime),r=Yc(t);return r&&i&&(r+=`T${i}`),r}function Oc(e){return"object"==typeof e&&!Array.isArray(e)&&"[object Date]"===Object.prototype.toString.call(e)}function xc(e){let t="string"==typeof e?e?.split(" "):[];if(e&&t?.length>1&&!["AM","PM"].includes(t[1].toUpperCase()))return!1;let i=Jc(e,!0,!0);return!!(!e||i&&Ac.test(i))}function Fc(e){return Gc(e)||Mc.test(e)}var Lc=e=>{let t=Vc(e)||Gc(e)?new Date(e):new Date,i=t.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${t.getUTCFullYear()}-${nd(r)}-${nd(t.getUTCDate())}`};function _c(e,t="-",i="YMD"){if(!e)return"";"string"==typeof e&&!e.includes("T")&&(e+="T00:00");let r=new Date(e),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),"DMY"===i?[a,n,o].join(t):"MDY"===i?[n,a,o].join(t):"YDM"===i?[o,a,n].join(t):"DYM"===i?[a,o,n].join(t):"MYD"===i?[n,o,a].join(t):[o,n,a].join(t)}function Bc(e){let t=e?new Date(e):new Date,i=t.getTimezoneOffset();return new Date(t.getTime()-60*i*1e3)}function Vc(e){if("boolean"==typeof e)return!1;let t=e instanceof Date&&e||!Number.isNaN(Number(e))&&new Date(e)||!1;return t&&!Number.isNaN(Number(t.valueOf()))}function jc(e,t){if(!Fc(e)||!Fc(t))return[];let i=Yc(e)+"T00:00",r=Yc(t)+"T00:00",n=new Date(i),a=new Date(r),o=Vc(a)&&Vc(n)&&function(e,t){return e<=t}(n,a),s=[],c=0;if(o){let e=n,t=e.getTime();for(;t<=a.getTime()&&c<300;)c+=1,s.push(new Date(e)),t=e.setDate(e.getDate()+1)}return s.map((e=>_c(e)))}var $c=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Gc(e){return"string"==typeof e&&$c.test(e)}function Wc(e){if("string"!=typeof e)return!1;let t=e.split("Z")[0].split(":"),i=t.every((e=>!Number.isNaN(Number.parseInt(e))));return!(t.length<2||!i||Number.parseInt(t[0])>23||Number.parseInt(t[1])>60)}function qc(e){let t=zc(e);if(!t)return 0;let[i,r]=t.split(":").map((e=>Number.parseInt(e)));return 60*i+r}function Hc(e){return Wc(e)?e.split(":").slice(0,2).map(nd).join(":"):void 0}function zc(e){return Gc(e)&&e.indexOf("T")>0?Hc(e.split("T").reverse()[0]):Hc(e)}function Yc(e){return Gc(e)||Cc.test(e)?e.split("T")[0]:""}function Kc(e,t){let i=new Date(e);return i.setDate(i.getDate()+t),Yc(i.toISOString())}function Xc(e){e="string"==typeof e?e:"00:00";let t={},i={};return({0:t.time,1:t.ampm}=e.split(" ")||[]),({0:i.hours,1:i.minutes}=t.time.split(":")||[]),i.ampm=t.ampm,Number.isNaN(Number.parseInt(i.hours))||Number.isNaN(Number.parseInt(i.minutes))||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Jc(e,t,i){let r=Yc(e),n=zc(e),a=r?n:e;return e?t&&(r&&i&&e||function(e){let t=Xc(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&Number.parseInt(t.hours)<12&&(t.hours=(t.hours&&Number.parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),`${t.hours||"12"}:${t.minutes||"00"}`.split(":").map(nd).join(":")}(a))||function(e){let t=Xc(e);if("object"!=typeof t||Object.keys(t).length)return t.ampm?e:(t.hours>12?(t.hours-=12,t.ampm="PM"):"12"===t.hours?t.ampm="PM":("00"===t.hours&&(t.hours="12"),t.ampm="AM"),"0"===t.hours?.[0]&&(t.hours=t.hours.slice(1)),`${t.hours||"12"}:${t.minutes||"00"} ${t.ampm}`)}(a):void 0}function Qc(e,t){let i=Xc(e),r=Xc(t);if(Number.parseInt(i.hours)<Number.parseInt(r.hours))return-1;if(Number.parseInt(i.hours)>Number.parseInt(r.hours))return 1;if(i.hours===r.hours){if(Number.parseInt(i.minutes)<Number.parseInt(r.minutes))return-1;if(Number.parseInt(i.minutes)>Number.parseInt(r.minutes))return 1}return 0}function Zc(e,t=7){let i=Yc(e)+"T00:00",r=new Date(i);return _c(new Date(r.setDate(r.getDate()+t)))}function ed(e,t=void 0){let[i,r]=(e||"00:00").split(":").map(nd),n=Bc(t).setHours(i,r,0,0);return Bc(n)}function td(e,t,i=!0){let r=new Date(e),n=(new Date(t).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function id(e,t){let i=zc(e);if(!i)return"00:00";let r=Number.isNaN(t)?0:t;return zc(rd(ed(i),r).toISOString())||"00:00"}function rd(e,t){let i=new Date(e);return new Date(i.getTime()+6e4*t)}function nd(e){return e.toString()[1]?e:"0"+e}function ad(e,t){let i=new Date(e),r=new Date(t);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var od={addDays:Zc,addWeek:function(e){return Zc(e)},addMinutesToTimeString:id,convertTime:Jc,getIsoDateString:kc,getUTCdateString:Lc,DateHHMM:function(e){let t=new Date(e);return function(e,t){let i=Number.parseInt(e,10),r=Math.floor(i/3600),n=Math.floor((i-3600*r)/60),a=i-3600*r-60*n;return(!t||t?.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(nd).join(":")}(t.getSeconds()+60*t.getMinutes()+3600*t.getHours(),{displaySeconds:!1})},extractDate:Yc,extractTime:zc,formatDate:_c,getDateByWeek:function(e,t,i,r=!1){let n=new Date(t,0,1+7*(e-1)),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),_c(n,i)},isISODateString:Gc,isDate:Vc,isTimeString:Wc,offsetDate:Bc,offsetTime:function(e){return Bc(e).getTime()},sameDay:ad,timeStringMinutes:qc,timeToDate:ed,timeUTC:function(e){let t=Vc(e)||Gc(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},validTimeValue:xc,validDateString:Mc,timeValidation:Ac,dateValidation:Cc},sd=(e,t)=>e.filter(Boolean).every((e=>typeof e===t)),cd=e=>e.filter(Boolean).every(Qi);function dd(e){let t=e.category;if("object"!=typeof t)return{error:qo};let i,{ageCategoryCode:r,ageMaxDate:n,ageMinDate:a,ageMax:o,ageMin:s}=t,c=t.categoryName;if(!(sd([r,n,a,c],"string")&&cd([o,s])&&[n,a].filter(Boolean).every(Fc)))return{error:qo};let d=e.consideredDate??Yc((new Date).toLocaleDateString("sv"));if(!d||!Fc(d))return{error:Pa};let[u]=d.split("-").slice(0,3).map((e=>Number.parseInt(e))),l=Kc(d,-1);if(!l)return{error:Pa};let[p,m]=l.split("-").slice(1,3).map((e=>Number.parseInt(e))),f=`${nd(p)}-${nd(m)}`,h=Kc(d,1);if(!h)return{error:Pa};let[g,I]=h.split("-").slice(1,3).map((e=>Number.parseInt(e))),y=`${nd(g)}-${nd(I)}`,v=s&&Kc(d,-365*s),S=o&&Kc(d,-365*o),U=[],b=e=>!U.includes(e)&&U.push(e);r=r??c;let w=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=r?.includes("-"),P=D&&r?.match(T),N=r?.match(w),E=(e,t)=>`${e}-${t}`,M=e=>{let i=E(u-e-1,y);t.ageMin&&t.ageMin>e&&b(`Invalid submitted ageMin: ${s}`),t.ageMax&&t.ageMax>e&&b(`Invalid submitted ageMax: ${o}`),t.ageMinDate&&t.ageMinDate!==i&&b(`Invalid submitted ageMinDate: ${a}`),a=i,r&&(t.ageMax&&t.ageMax!==e&&(b(`Invalid submitted ageMax: ${o}`),v=void 0),o=e)},R=e=>{let i=E(u-e,f);t.ageMaxDate&&t.ageMaxDate!==i&&b(`Invalid submitted ageMaxDate: ${n}`),n=i,r&&(t.ageMin&&t.ageMin!==e+1&&(b(`Invalid submitted ageMin: ${s}`),v=void 0),s=e+1)},C=e=>{let[i,c,d]=(e.match(w)||[]).slice(1),l=Number.parseInt(c);"U"===i?(t.ageMaxDate&&t.ageMaxDate!==n&&b(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),(e=>{let i=E(u-e,y);t.ageMinDate&&t.ageMinDate!==i&&b(`Invalid submitted ageMinDate: ${a}`),a=i,r&&(t.ageMax&&t.ageMax!==e-1&&(b(`Invalid submitted ageMax: ${o}`),S=void 0),o=e-1)})(l)):"O"===i&&R(l),"U"===d?(t.ageMaxDate&&t.ageMaxDate!==n&&b(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),M(l)):"O"===d&&(e=>{let i=E(u-e-1,f);t.ageMaxDate&&t.ageMaxDate!==i&&b(`Invalid submitted ageMaxDate: ${n}`),n=i,r&&(t.ageMin&&t.ageMin!==e&&(b(`Invalid submitted ageMin: ${s}`),v=void 0),s=e)})(l),n=(n??v)||void 0,a=(a??S)||void 0};if(P){if(n=void 0,a=void 0,o=void 0,s=void 0,t.ageMin){let e=u-t.ageMin;n=E(e,f)}if(t.ageMax){let e=u-t.ageMax-1;a=E(e,y)}let[e,c]=(r?.match(T)??[]).slice(1).map((e=>Number.parseInt(e)));e<=c?(s=e,o=c,i=!0):b(`Invalid combined age range ${r}`)}else D?r?.split("-").forEach(C):N?C(r):(s&&R(s),o&&M(o));o&&t.ageMin&&t.ageMin>o&&(b(`Invalid submitted ageMin: ${t.ageMin}`),s=void 0);let A=Js({consideredDate:d,combinedAge:i,ageMaxDate:n,ageMinDate:a,ageMax:o,ageMin:s});return U.length&&(A.errors=U),A}function ud({category:e}){if(!Rr(e))return{error:Ho};let t=dd({category:e});if(t.error)return{error:t};let{ratingMax:i,ratingMin:r}=e;return i&&!Qi(i)?Qs({result:{error:Ho},context:{ratingMax:i}}):r&&!Qi(r)?Qs({result:{error:Ho},context:{ratingMin:r}}):{...t}}function ld({childCategory:e,withDetails:t,category:i}){let r=ud({category:i}),n=ud({category:e}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),c=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),d=i?.ratingType&&e?.ratingType&&i.ratingType===e.ratingType&&(i.ratingMin&&e.ratingMin&&e.ratingMin<i.ratingMin||i.ratingMax&&e.ratingMax&&e.ratingMax>i.ratingMax||i.ratingMin&&e.ratingMax&&e.ratingMax<i.ratingMin||i.ratingMax&&e.ratingMin&&e.ratingMin>i.ratingMax),u=i?.ballType&&e?.ballType&&i.ballType!==e.ballType,l=Js({invalidRatingRange:d,invalidAgeMinDate:s,invalidAgeMaxDate:c,invalidBallType:u,invalidAgeMax:o,invalidAgeMin:a,valid:!(d||s||c||u||o||a)},!0);return t&&Object.assign(l,{categoryDetails:r,childCategoryDetails:n}),l}function pd({checkCategory:e=!0,collectionDefinition:t,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??o?.gender;let s="validateCollectionDefinition",c=[];if("object"!=typeof t)return c.push(`collectionDefinition must be an object: ${t}`),Qs({result:{errors:c,error:Go},stack:s});let{collectionValueProfiles:d,collectionGroupNumber:u,collectionValue:l,collectionId:p,matchUpCount:m,matchUpFormat:f,matchUpValue:h,matchUpType:g,scoreValue:I,setValue:y,category:v,gender:S}=t;if(i&&"string"!=typeof p&&c.push(`collectionId is not type string: ${p}`),"number"!=typeof m&&c.push(`matchUpCount is not type number: ${m}`),g&&!Lr([Bi,ji],g)&&c.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),1!==[!!d?.length].concat([h,l,I,y].map(ir)).filter(Boolean).length&&c.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&"number"!=typeof h&&c.push(`matchUpValue is not type number: ${h}`),l&&"number"!=typeof l&&c.push(`collectionValue is not type number: ${l}`),d&&m){let e=jr({collectionValueProfiles:d,matchUpCount:m});e.errors&&c.push(...e.errors)}if(u&&"number"!=typeof u&&c.push(`collectionGroupNumber is not type number: ${l}`),f&&!Ec({matchUpFormat:f})&&c.push(`Invalid matchUpFormat: ${f}`),r){let e=pc({referenceGender:a,matchUpType:g,gender:S});if(e.error)return Qs({context:{referenceGender:a,gender:S},result:e,stack:s})}if(e&&n&&v){let e=ld({category:n,childCategory:v});if(!e.valid)return Qs({result:{error:qo},context:e,stack:s})}return c.length?Qs({result:{errors:c,error:$o},stack:s}):{valid:!0}}function md(e){let t=!(!1===e?.enforceCategory||!e?.category),i=!(!1===e?.enforceGender||!e?.gender),r=e?.checkCollectionIds,n=e?.tieFormat,a=e?.event,o="validateTieFormat",s=[],c=function(e){let{tieFormat:t,stack:i}=e;return e&&t&&Rr(t)?Rr(t.winCriteria)?Array.isArray(t.collectionDefinitions)?{..._r}:Qs({result:{error:Qn},context:{tieFormat:t,message:"collectionDefinitions must be an array"},stack:i}):Qs({result:{error:Qn},context:{tieFormat:t,message:"tieformat.winCritiera must be an object"},stack:i}):Qs({result:{error:Qn},context:{tieFormat:t,message:"tieformat must be an object"},stack:i})}({...e,stack:o});if(c?.error)return c;let d,u=n.collectionDefinitions.every((n=>{let{setValue:o,scoreValue:c,collectionValue:u}=n;(o||c)&&!u&&(d=!0);let{valid:l,errors:p}=pd({referenceCategory:e.category,referenceGender:e.gender,collectionDefinition:n,checkCollectionIds:r,checkCategory:t,checkGender:i,event:a});return!!l||(Array.isArray(p)&&s.push(...p),!1)})),l="number"==typeof n.winCriteria?.valueGoal&&n.winCriteria?.valueGoal>0&&!d||n.winCriteria?.aggregateValue;if(!l&&!n.winCriteria?.aggregateValue)return d?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),Qs({context:{tieFormat:n,errors:s,aggregateValueImperative:d},result:{error:Qn},stack:o});let p=n.collectionDefinitions.map((({collectionId:e})=>e)),m=!r||p.length===ar(p).length,f=u&&l&&m;return f?{valid:f,errors:s}:Qs({result:{error:Qn},context:{tieFormat:n,errors:s},stack:o})}var fd="resourceSubType",hd="resourceType",gd="identifier",Id={RESOURCE_SUB_TYPE:fd,RESOURCE_TYPE:hd,IDENTIFIER:gd};function yd(e,t,i,r,n=0){if(zs().makeDeepCopy)return zs().makeDeepCopy(e,t,i,r);let a=Ps(),{stringify:o,toJSON:s,ignore:c,modulate:d}=a||{};if(!a?.enabled&&!i||"object"!=typeof e||Er(e)||null===e||"number"==typeof a?.threshold&&n>=a.threshold)return e;let u=Array.isArray(e)?[]:{},l=Object.keys(e).filter((e=>!i||!c||Array.isArray(c)&&!c.includes(e)||Er(c)&&!c(e))),p=(e,t)=>{u[e]=Er(t?.toString)?t.toString():JSON.stringify(t)};for(let m of l){let a=e[m],c=Er(d)?d(a):void 0;if(void 0!==c)u[m]=c;else if(t&&"extensions"===m&&Array.isArray(a)){let e=vd(a);Object.assign(u,...e)}else r&&"extensions"===m?u[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,a):Array.isArray(s)&&s.includes(m)&&Er(a?.toJSON)?u[m]=a.toJSON():null===a?u[m]=void 0:Oc(a)?u[m]=new Date(a).toISOString():u[m]=yd(a,t,i,r,n+1)}return u}function vd(e){return e?.map((e=>{let{name:t,value:i}=e;return t&&i&&{[`_${t}`]:i}})).filter(Boolean)}function Sd(e=1,t){return gr(0,e).map((()=>Ud(t)))}function Ud(e){let t=[];for(let s=0;s<256;s++)t[s]=(s<16?"0":"")+s.toString(16);let i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,a=4294967295*Math.random()|0,o=t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&r]+t[r>>8&255]+"-"+t[r>>16&15|64]+t[r>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&a]+t[a>>8&255]+t[a>>16&255]+t[a>>24&255];return"string"==typeof e?`${e}_${o.replace(/-/g,"")}`:o}var bd={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},wd={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Td={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Dd={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Pd={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Nd={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Ed={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Md={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},Rd={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},Cd={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Ad="SET3-S:6/TB7",kd="SET3-S:6/TB7-F:TB10",Od={FORMAT_STANDARD:Ad,FORMAT_STANDARD_NOAD:"SET3-S:6NOAD",FORMAT_ATP_DOUBLES:kd,FORMAT_SHORT_SETS:"SET3-S:4/TB7",FORMAT_FAST4:"SET3-S:4/TB5@3",FORMAT_PRO_SET:"SET1-S:8/TB7",FORMAT_COLLEGE_PRO_SET:"SET1-S:8/TB7@7",TIMED20:"SET1-S:T20"},xd={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Fd={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Ld={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},_d={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Bd={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Vd={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},jd={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},$d="COLLEGE_DEFAULT",Gd="COLLEGE_JUCO",Wd="COLLEGE_D3",qd="DOMINANT_DUO",Hd="DOMINANT_DUO_MIXED",zd="LAVER_CUP",Yd="TEAM_DOUBLES_3_AGGREGATION",Kd="TIME_TENNIS_DUAL",Xd="TIME_TENNIS_PRO_CIRCUIT",Jd="USTA_BREWER_CUP",Qd="USTA_OZAKI_CUP",Zd="USTA_COLLEGE",eu="USTA_GOLD_TEAM_CHALLENGE",tu="USTA_LEVEL_1",iu="USTA_INTERSECTIONAL",ru="USTA_SECTION_BATTLE",nu="USTA_SOUTHERN_LEVEL_5",au="USTA_TOC",ou="USTA_WTT_ITT",su="USTA_ZONAL",cu={COLLEGE_D3:Wd,COLLEGE_DEFAULT:$d,COLLEGE_JUCO:Gd,DOMINANT_DUO:qd,DOMINANT_DUO_MIXED:Hd,LAVER_CUP:zd,TEAM_DOUBLES_3_AGGREGATION:Yd,TIME_TENNIS_DUAL:Kd,TIME_TENNIS_PRO_CIRCUIT:Xd,USTA_BREWER_CUP:Jd,USTA_OZAKI_CUP:Qd,USTA_COLLEGE:Zd,USTA_GOLD_TEAM_CHALLENGE:eu,USTA_INTERSECTIONAL:iu,USTA_LEVEL_1:tu,USTA_SECTION_BATTLE:ru,USTA_SOUTHERN_LEVEL_5:nu,USTA_TOC:au,USTA_WTT_ITT:ou,USTA_ZONAL:su},du="STANDARD",uu={[du]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[Wd]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Ad,matchUpCount:6,matchUpValue:1},tieFormatName:Wd,valueGoal:5},[$d]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Ad,matchUpCount:6,matchUpValue:1},tieFormatName:$d,valueGoal:4},[Gd]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Ad,matchUpCount:6,matchUpValue:1},tieFormatName:Gd,valueGoal:5},[zd]:Vd,[qd]:xd,[Hd]:Ed,[Yd]:wd,[Kd]:Md,[Xd]:Nd,[Jd]:Rd,[Qd]:Cd,[Zd]:Fd,[eu]:bd,[iu]:Pd,[tu]:Ld,[ru]:Dd,[nu]:Td,[ou]:_d,[au]:jd,[su]:Bd},lu=e=>{let t,i=e?.namedFormat&&Object.keys(uu).includes(e.namedFormat)?e.namedFormat:du,r=Array.isArray(e?.uuids)?e?.uuids:[],{category:n,gender:a}=e?.event??{},o=yd(uu[i],!1,!0),s=t=>{if(!e?.isMock&&!e?.event?.isMock||!e.event)return r?.pop()??Ud();let i=e?.event?.eventId;return r.pop()??`${i}-COL-${t+1}`};return o.hydrate?(t={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:kd,collectionName:"Doubles",matchUpType:ji,...o.doubles},{collectionId:s(1),matchUpFormat:Ad,collectionName:"Singles",matchUpType:Bi,...o.singles}]},o.tieFormatName&&(t.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach(((e,t)=>e.collectionId=s(t))),t=o),e?.hydrateCollections&&t.collectionDefinitions.forEach((e=>{n&&!e.category&&(e.category=n),a&&!e.gender&&(e.gender=a)})),t},pu="SINGLES",mu="SINGLES",fu="DOUBLES",hu="DOUBLES",gu="TEAM",Iu="TEAM",yu={AGE:"AGE",BOTH:"BOTH",DOUBLES:fu,DOUBLES_EVENT:hu,RATING:"RATING",SINGLES:pu,SINGLES_EVENT:mu,TEAM_EVENT:Iu,TEAM:gu},vu="MAIN",Su="QUALIFYING",Uu="CONSOLATION",bu="VOLUNTARY_CONSOLATION",wu="PLAY_OFF",Tu=[vu,Su,Uu,wu,bu],Du={[Su]:1,[vu]:2,[wu]:3,[Uu]:3,[bu]:4},Pu="finishingPositions",Nu="aggregateEventStructures",Eu={[vu]:1,[wu]:2,[Uu]:3,[Su]:4,[bu]:5},Mu={[wu]:1,[vu]:2,[Uu]:3,[Su]:4,[bu]:5},Ru="CLUSTER",Cu="ADJACENT",Au="SEPARATE",ku="WATERFALL",Ou="ITEM",xu="CONTAINER",Fu="DRAW",Lu="RANDOM",_u="TOP_DOWN",Bu="BOTTOM_UP",Vu="POSITION",ju="WINNER",$u="LOSER",Gu="FIRST_MATCHUP",Wu="AD_HOC",qu="FEED_IN",Hu="COMPASS",zu="OLYMPIC",Yu="SINGLE_ELIMINATION",Ku="DOUBLE_ELIMINATION",Xu="FIRST_MATCH_LOSER_CONSOLATION",Ju="FIRST_ROUND_LOSER_CONSOLATION",Qu="LUCKY_DRAW",Zu="CURTIS_CONSOLATION",el="CURTIS_CONSOLATION",tl="FEED_IN_CHAMPIONSHIP_TO_SF",il="FEED_IN_CHAMPIONSHIP_TO_SF",rl="FEED_IN_CHAMPIONSHIP_TO_QF",nl="FEED_IN_CHAMPIONSHIP_TO_QF",al="FEED_IN_CHAMPIONSHIP_TO_R16",ol="FEED_IN_CHAMPIONSHIP_TO_R16",sl="MODIFIED_FEED_IN_CHAMPIONSHIP",cl="MODIFIED_FEED_IN_CHAMPIONSHIP",dl="FEED_IN_CHAMPIONSHIP",ul="DOUBLE_ROUND_ROBIN",ll="ROUND_ROBIN",pl="ROUND_ROBIN_WITH_PLAYOFF",ml="DECIDER",fl="BACKDRAW",hl={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},gl={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Il="WIN_RATIO",yl="ROUND_OUTCOME",vl=[Hu,Zu,nl,ol,il,dl,rl,al,tl,Xu,Ju,Qu,cl,zu,wu,pl],Sl={MAIN:vu,QUALIFYING:Su,CONSOLATION:Uu,ITEM:Ou,CONTAINER:xu,FIRST_MATCHUP:Gu,WINNER:ju,LOSER:$u,AD_HOC:Wu,FEED_IN:qu,FLEX_ROUNDS:"AD_HOC",COMPASS:Hu,PLAY_OFF:wu,OLYMPIC:zu,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:Yu,DOUBLE_ELIMINATION:Ku,CURTIS:Zu,FICSF:tl,FICQF:rl,FICR16:al,MFIC:sl,VOLUNTARY_CONSOLATION:bu,FIRST_MATCH_LOSER_CONSOLATION:Xu,FIRST_ROUND_LOSER_CONSOLATION:Ju,MODIFIED_FEED_IN_CHAMPIONSHIP:cl,FEED_IN_CHAMPIONSHIP_TO_R16:ol,FEED_IN_CHAMPIONSHIP_TO_QF:nl,FEED_IN_CHAMPIONSHIP_TO_SF:il,FEED_IN_CHAMPIONSHIP:dl,LUCKY_DRAW:Qu,ROUND_ROBIN_WITH_PLAYOFF:pl,ROUND_ROBIN:ll,DECIDER:ml,BACKDRAW:fl,COMPASS_ATTRIBUTES:hl,OLYMPIC_ATTRIBUTES:gl,DRAW:Fu,RANDOM:Lu,TOP_DOWN:_u,BOTTOM_UP:Bu,CLUSTER:Ru,ADJACENT:Cu,SEPARATE:Au,WATERFALL:ku,WIN_RATIO:Il,ROUND_OUTCOME:yl,MULTI_STRUCTURE_DRAWS:vl,generatedDrawTypes:[Wu,Hu,Zu,Ku,nl,ol,il,dl,qu,Xu,Ju,Qu,cl,zu,wu,ll,pl,Yu],stageOrder:Du,finishOrder:Eu,AGGREGATE_EVENT_STRUCTURES:Nu,FINISHING_POSITIONS:Pu},Ul=Sl,bl="tournamentRecords",wl="policyDefinitions",Tl="tournamentRecord",Dl="onlineResource",Pl="drawDefinition",Nl="tieFormatName",El="matchUpFormat",Ml="participantId",Rl="scheduleDates",Cl="structureId",Al="participant",kl="matchUpIds",Ol="entryStage",xl="structures",Fl="eventType",Ll="matchUpId",_l="tieFormat",Bl="inContext",Vl="structure",jl="courtIds",$l="venueIds",Gl="matchUps",Wl="courtId",ql="eventId",Hl="matchUp",zl="drawId",Yl="error",Kl="event",Xl="param",Jl="uuids",Ql="object",Zl="array",ep="_validate",tp="_message",ip="_invalid",rp="_ofType",np="_anyOf",ap="_oneOf",op={[Dl]:e=>3===yr(Object.keys(e),[fd,hd,gd]).length,[Nl]:e=>e&&lu({namedFormat:e}),[Jl]:e=>!e||Array.isArray(e)&&e.every(Mr),[_l]:e=>!md({tieFormat:e}).error,[Fl]:e=>[pu,fu,gu].includes(e),[Ol]:e=>Tu.includes(e)},sp={[bl]:Hr,[Tl]:zr,[wl]:ua,[Pl]:Jr,[Ml]:Ha,[El]:ea,tournamentId:Kr,[Cl]:Mn,[kl]:na,[Al]:Wa,[Dl]:Go,[Fl]:xn,[xl]:Cn,[Ll]:ra,[_l]:Qn,[Vl]:An,[Wl]:ya,[Gl]:oa,[ql]:Ln,[Hl]:sa,[jl]:va,[$l]:va,[zl]:In,[Kl]:Fn},cp={[bl]:Ql,[wl]:Ql,[Tl]:Ql,[Pl]:Ql,[Dl]:Ql,[Rl]:Zl,[Al]:Ql,[kl]:Zl,[xl]:Zl,[_l]:Ql,[Vl]:Ql,[jl]:Zl,[$l]:Zl,[Gl]:Zl,[Hl]:Ql,[Kl]:Ql,[Jl]:Zl};function dp(e,t,i){if(!e&&!Rr(e))return{error:Ho};if(!t?.length||e?._bypassParamCheck)return{valid:!0};if(!Array.isArray(t))return{error:Ho};let{paramError:r,errorParam:n}=function(e,t){let i,r;return{paramError:t.find((({_ofType:t,_oneOf:n,_anyOf:a,_validate:o,_info:s,...c})=>{let d=n&&function(e,t){if(!t)return;let i=up(e,t);return 1!==i.length?{error:Ho}:i.reduce(((e,t)=>({...e,[t]:!0})),{})}(e,n);if(d?.error)return d.error;d&&Object.assign(c,d);let u=a&&function(e,t){if(!t)return;let i=up(e,t).filter((t=>e[t]));return i.length<1?{error:Ho}:i.reduce(((e,t)=>({...e,[t]:!0})),{})}(e,a);if(u?.error)return u.error;u&&Object.assign(c,u);let l=Object.keys(c).filter((e=>"boolean"==typeof c[e])),p=l.find((n=>{let a=o&&!Er(o),d=void 0!==e[n]&&!o&&function(e,t,i){return i=i||cp[t]||"string","array"===i?!Array.isArray(e[t]):typeof e[t]!==i}(e,n,t),u=c[n]&&[void 0,null].includes(e[n]),l=a||d||u||o&&void 0!==e[n]&&!function(e,t){return!Er(t)||t(e)}(e[n],o)||op[n]&&!op[n](e[n]);return l&&(i=n,r=s),l}));return!l.length||p})),errorParam:i,paramInfo:r}}(e,t);if(!r)return{valid:!0};let a=r[ep]&&(r[Yl]||r[ip])||void 0===e?.[n]&&(r[Yl]||r[ip]||sp[n]||Ho)||Ho;return Qs({info:{param:n??(r[ap]&&Object.keys(r[ap]).join(", ")),message:r[tp]},result:{error:a},stack:i})}function up(e,t){return yr(Object.keys(e),Object.keys(t))}var lp="DYNAMIC",pp="RANKING",mp="RATING",fp="SCALE",hp="SEEDING",gp={RANKING:pp,RATING:mp,SCALE:fp,SEEDING:hp};function Ip(e){let t=dp(e,[{[Al]:!0}]);if(t.error)return t;let i=e.participant.timeItems?.filter((({itemType:e})=>e?.startsWith(fp)&&[pp,mp,hp].includes(e.split(".")[1]))),r={ratings:{},rankings:{},seedings:{}};if(i?.length){let e=e=>i.filter((t=>t?.itemType===e)).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())).pop(),t=ar(i.map((({itemType:e})=>e)));for(let i of t){let t=e(i);if(t){let[,e,i,n,a]=t.itemType.split("."),o=a?`${n}.${a}`:n,s=(e===hp?"seedings":e===pp&&"rankings")||"ratings";r[s][i]||(r[s][i]=[]),r[s][i].push({scaleValue:t.itemValue,scaleDate:t.itemDate,scaleName:o})}}}return{..._r,...r}}function yp(e){if(null===e)return{};let{source:t,template:i}=e||{};if(!i)return t;let r={};return function e(t,i,r){if(!t||!i)return;let n=Object.keys(t),a=Object.keys(i),o=Object.assign({},...a.filter((e=>e.indexOf("||"))).map((e=>e.split("||").map((t=>({[t]:e}))))).flat()),s=a.concat(...Object.keys(o)),c=s.includes("*");for(let d of n)if(s.indexOf(d)>=0||c){let n=i[o[d]||d]||c,a=t[d];if("object"!=typeof n||"function"==typeof a||Array.isArray(n)){let e=t[d];if(Array.isArray(n)&&!n.includes(e))return!1;(i[d]||c&&!1!==i[d])&&(r[d]=e)}else if(Array.isArray(a)){let t=a.map((t=>{let i={};return!1!==e(t,n,i)?i:void 0})).filter(Boolean);r[d]=t}else a&&(r[d]={},e(a,n,r[d]))}}(t,i,r),r}var vp="voluntaryConsolation",Sp="competitiveBands",Up="roundRobinTally",bp="positionActions",wp="matchUpActions",Tp="rankingPoints",Dp="roundNaming",Pp="participant",Np="progression",Ep="scheduling",Mp="avoidance",Rp="scoring",Cp="seeding",Ap="feedIn",kp="draws",Op={POLICY_TYPE_VOLUNTARY_CONSOLATION:vp,POLICY_TYPE_COMPETITIVE_BANDS:Sp,POLICY_TYPE_ROUND_ROBIN_TALLY:Up,POLICY_TYPE_POSITION_ACTIONS:bp,POLICY_TYPE_MATCHUP_ACTIONS:wp,POLICY_TYPE_RANKING_POINTS:Tp,POLICY_TYPE_ROUND_NAMING:Dp,POLICY_TYPE_PARTICIPANT:Pp,POLICY_TYPE_PROGRESSION:Np,POLICY_TYPE_SCHEDULING:Ep,POLICY_TYPE_AVOIDANCE:Mp,POLICY_TYPE_DISPLAY:"display",POLICY_TYPE_PRIVACY:"participant",POLICY_TYPE_FEED_IN:Ap,POLICY_TYPE_SCORING:Rp,POLICY_TYPE_SEEDING:Cp,POLICY_TYPE_AUDIT:"audit",POLICY_TYPE_DRAWS:kp};function xp({tournamentParticipants:e=[],policyDefinitions:t={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=yd(e.find((e=>r&&e.participantId===r||a&&e.person&&e.person.personId===a)),!1,n);if(o){let e=t?.[Pp];if(i?.withScaleValues){let{ratings:e,rankings:t}=Ip({participant:o});o.rankings=t,o.ratings=e}if(e?.participant)return yp({template:e.participant,source:o})}return o}var Fp="element required",Lp="missing name";function _p(e){if(!e||"object"!=typeof e)return{error:va};if(e.element&&"object"!=typeof e?.element)return{error:Ho};if(!e?.name)return{error:va,info:Lp};if(!e?.element){if(e.discover&&e.tournamentRecords){for(let t of Object.keys(e.tournamentRecords)){let i=_p({element:e.tournamentRecords[t],name:e.name});if(i.error)return Qs({result:i,stack:"removeExtension"})}return{..._r}}return{error:va,info:Fp}}return e?.element.extensions?(e.element.extensions=e.element.extensions.filter((t=>t?.name!==e.name)),{..._r}):{..._r,info:Qo}}function Bp({requiredAttributes:e=["name","value"],extension:t}){if(!t||"object"!=typeof t||"string"!=typeof t.name)return!1;let i=Object.keys(t);return e.filter((e=>i.includes(e))).length===e.length}function Vp(e){if("object"!=typeof e)return{error:va};let t="addExtension";if(e?.element&&"object"!=typeof e.element)return Qs({result:{error:Ho},stack:t});if(!Bp({extension:e.extension}))return Qs({result:{error:Ho,info:"invalid extension"},stack:t});if(!e.element){if(e.discover&&!e.tournamentId&&e.tournamentRecords){for(let i of Object.values(e.tournamentRecords)){let r=Vp({extension:e.extension,element:i});if(r.error)return Qs({result:r,stack:t})}return{..._r}}return Qs({result:{error:va},stack:t})}if(e.element.extensions||(e.element.extensions=[]),e?.creationTime??1){let t=(new Date).toISOString();Object.assign(e.extension,{createdAt:t})}let i=e.element.extensions.find((({name:t})=>t===e.extension.name));return i?i.value=e.extension.value:e.extension.value&&e.element.extensions.push(e.extension),{..._r}}function jp(e){return e&&"object"==typeof e?e.tournamentRecord?Vp({creationTime:e.creationTime,element:e.tournamentRecord,extension:e.extension}):{error:zr}:{error:va}}function $p(e){return e&&"object"==typeof e?e.drawDefinition?Vp({creationTime:e.creationTime,element:e.drawDefinition,extension:e.extension}):{error:Zr}:{error:va}}function Gp(e){return e&&"object"==typeof e?e.event?Vp({creationTime:e.creationTime,extension:e.extension,element:e.event}):{error:Ln}:{error:va}}function Wp(e){if(!e||"object"!=typeof e)return{error:va};if(!e.participantId)return{error:Ha};let t=e.tournamentRecord?.participants||[],i=xp({participantId:e.participantId,tournamentParticipants:t});return i?Vp({creationTime:e.creationTime,extension:e.extension,element:i}):{error:Ya}}function qp(e){return e&&"object"==typeof e?e.tournamentRecord?_p({element:e.tournamentRecord,name:e.name}):{error:zr}:{error:va}}function Hp(e){return e&&"object"==typeof e?e.drawDefinition?_p({element:e.drawDefinition,name:e.name}):{error:Zr}:{error:va}}function zp(e){return e&&"object"==typeof e?e?.event?_p({element:e.event,name:e.name}):{error:Ln}:{error:va}}function Yp(e){if(!e||"object"!=typeof e)return{error:va};if(!e.participantId)return{error:Ha};let t=e.tournamentRecord?.participants||[],i=xp({participantId:e.participantId,tournamentParticipants:t});return i?_p({element:i,name:e.name}):{error:Ya}}function Kp({tournamentRecords:e}){return{tournamentIds:Rr(e)?Object.keys(e):[],..._r}}var Xp="extensionQueries";function Jp({discover:e,element:t,name:i,...r}){if(!t||!i){if(e&&r){let t=Object.keys(r).filter((t=>"boolean"==typeof e||Array.isArray(e)&&e.includes(t))).find((e=>!!Array.isArray(r[e]?.extensions)&&r[e].extensions.find((e=>e?.name===i)))),n=t&&r[t];!n&&r.tournamentRecords&&(n=Object.values(r.tournamentRecords).find((e=>e.extensions?.length)));let a=n?.extensions?.find((e=>e?.name===i));return{extension:a,info:a?void 0:Qo}}return Qs({result:{error:va},stack:Xp})}if(!Array.isArray(t.extensions))return{info:"no extensions"};let n=t.extensions.find((e=>e?.name===i));return{extension:n,info:n?void 0:Qo}}var Qp="appliedPolicies",Zp="context",em="delegatedOutcome",tm="disabled",im="disableAutoCalc",rm="disableLinks",nm="display",am="drawDeletions",om="entryProfile",sm="flightProfile",cm="groupingAttribute",dm="lineUps",um="linkedTournamentsIds",lm="matchUpHistory",pm="participantRepresentatives",mm="personRequests",fm="positionActions",hm="roundTarget",gm="scheduleLimits",Im="scheduleTiming",ym="schedulingProfile",vm="subOrder",Sm="tally",Um="tieFormatModification",bm={ACTIVE_SUSPENSION:"activeSuspension",APPLIED_POLICIES:Qp,CONTEXT:Zp,DELEGATED_OUTCOME:em,DISABLED:tm,DISABLE_LINKS:rm,DISABLE_AUTO_CALC:im,DISPLAY:nm,DRAW_DELETIONS:am,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:om,EVENT_PROFILE:"eventProfile",EVENT_WITHDRAWAL_REQUESTS:"eventWithdrawalRequests",FLIGHT_PROFILE:sm,GROUPING_ATTRIBUTE:cm,LINEUPS:dm,LINKED_TOURNAMENTS:um,MATCHUP_HISTORY:lm,PARTICIPANT_REPRESENTATIVES:pm,PERSON_REQUESTS:mm,POSITION_ACTIONS:fm,RANKING_POINTS:"rankingPoints",REGISTRATION:"registration",ROUND_TARGET:hm,SCHEDULE_LIMITS:gm,SCHEDULE_TIMING:Im,SCHEDULING_PROFILE:ym,STATUS_DETAIL:"statusDetail",SUB_ORDER:vm,TALLY:Sm,TIE_FORMAT_MODIFICATIONS:Um,FACTORY:"factory"},wm=[em,tm,im,rm,sm,dm,um,lm,pm,mm,hm,gm,Im,ym,vm,Sm,Um];function Tm({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Hr};let t=Kp({tournamentRecords:e}),{tournamentIds:i}=t;return i?.length>1?Vp({tournamentRecords:e,discover:!0,extension:{name:um,value:{tournamentIds:i}}}):{..._r}}function Dm({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Hr};return Qs({result:_p({name:um,tournamentRecords:e,discover:!0}),stack:"unlinkTournaments"})}function Pm({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e)return{error:Ho};if(!t)return{error:Kr};let i,r=Kp({tournamentRecords:e}),{tournamentIds:n}=r;return n.includes(t)?(n.every((r=>{let n=e[r],{extension:a}=Jp({element:n,name:um});if(!a)return!0;let o=a?.value?.tournamentIds||[];if(!o?.length||1===o.length&&o.includes(t)||r===t){let e=qp({name:um,tournamentRecord:n});return e.error&&(i=e.error),e.success}let s=o.filter((e=>e!==t));a.value={tournamentIds:s};let c=jp({tournamentRecord:n,extension:a});return c.error&&(i=c.error),c.success})),i?{error:i}:{..._r}):{error:Kr}}var Nm={};function Em({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?{linkedTournamentIds:Object.assign({},...Object.keys(e).map((t=>{let i=e[t],r=i?.tournamentId,{extension:n}=Jp({element:i,name:um});return{[t]:(n?.value?.tournamentIds||[]).filter((e=>e!==r))}})))}:{error:Hr}}Oi(Nm,{getLinkedTournamentIds:()=>Em,getTournamentIds:()=>Kp});var Mm={};Oi(Mm,{adHocPositionSwap:()=>pb,addAdHocMatchUps:()=>Ww,addDrawDefinitionTimeItem:()=>vU,addFinishingRounds:()=>Py,addGoesTo:()=>Ny,addPlayoffStructures:()=>Aw,addQualifyingStructure:()=>lb,addVoluntaryConsolationStage:()=>PU,addVoluntaryConsolationStructure:()=>Yv,allPlayoffPositionsFilled:()=>LS,alternateDrawPositionAssignment:()=>AS,assignDrawPosition:()=>Vw,assignDrawPositionBye:()=>Vy,attachConsolationStructures:()=>Mw,attachPlayoffStructures:()=>Rw,attachQualifyingStructure:()=>IU,attachStructures:()=>Cw,autoSeeding:()=>EM,automatedPlayoffPositioning:()=>cU,automatedPositioning:()=>sU,checkValidEntries:()=>FT,deleteAdHocMatchUps:()=>$w,drawMatic:()=>dN,findDrawDefinition:()=>Qw,generateAdHocMatchUps:()=>tD,generateAdHocRounds:()=>sN,generateAndPopulatePlayoffStructures:()=>ww,generateDrawDefinition:()=>PM,generateDrawMaticRound:()=>lD,generateDrawStructuresAndLinks:()=>GT,generateDrawTypeAndModifyDrawDefinition:()=>WT,generateQualifyingStructure:()=>ub,generateVoluntaryConsolation:()=>pD,getAssignedParticipantIds:()=>Ky,getAvailableMatchUpsCount:()=>Yw,getAvailablePlayoffProfiles:()=>bb,getDrawDefinitionTimeItem:()=>Dh,getDrawParticipantRepresentativeIds:()=>Kw,getDrawStructures:()=>pf,getDrawTypeCoercion:()=>RT,getEligibleVoluntaryConsolationParticipants:()=>zw,getMatchUpsMap:()=>bg,getParticipantIdFinishingPositions:()=>Xw,getPositionAssignments:()=>kT,getPositionsPlayedOff:()=>Sb,getRandomQualifierList:()=>CT,getSeedingThresholds:()=>nS,getSeedsCount:()=>xT,getStructureSeedAssignments:()=>yg,getTeamLineUp:()=>ty,getValidGroupSizes:()=>tS,isAdHoc:()=>Cg,isCompletedStructure:()=>FS,isValidForQualifying:()=>AT,luckyLoserDrawPositionAssignment:()=>PS,modifyDrawDefinition:()=>Fw,modifyDrawName:()=>xw,modifySeedAssignment:()=>dU,mutate:()=>Rm,positionActions:()=>MT,pruneDrawDefinition:()=>Bw,qualifierDrawPositionAssignment:()=>uU,qualifierProgression:()=>mU,query:()=>Hw,removeDrawPositionAssignment:()=>$v,removeRoundMatchUps:()=>Gw,removeSeededParticipant:()=>rb,removeStructure:()=>SU,renameStructures:()=>yU,resetDrawDefinition:()=>Lw,resetQualifyingStructure:()=>NU,resetVoluntaryConsolationStructure:()=>ih,setDrawParticipantRepresentativeIds:()=>Lm,setPositionAssignments:()=>RS,setStructureOrder:()=>fU,setSubOrder:()=>qw,shiftAdHocRounds:()=>MS,swapAdHocRounds:()=>CS,swapDrawPositionAssignments:()=>tb,updateTeamLineUp:()=>bS,withdrawParticipantAtDrawPosition:()=>Gv});var Rm={};Oi(Rm,{adHocPositionSwap:()=>pb,addAdHocMatchUps:()=>Ww,addDrawDefinitionTimeItem:()=>vU,addPlayoffStructures:()=>Aw,addQualifyingStructure:()=>lb,addVoluntaryConsolationStage:()=>PU,addVoluntaryConsolationStructure:()=>Yv,alternateDrawPositionAssignment:()=>AS,assignDrawPosition:()=>Vw,assignDrawPositionBye:()=>Vy,attachConsolationStructures:()=>Mw,attachPlayoffStructures:()=>Rw,attachQualifyingStructure:()=>IU,attachStructures:()=>Cw,automatedPlayoffPositioning:()=>cU,automatedPositioning:()=>sU,deleteAdHocMatchUps:()=>$w,luckyLoserDrawPositionAssignment:()=>PS,modifyDrawDefinition:()=>Fw,modifyDrawName:()=>xw,modifySeedAssignment:()=>dU,pruneDrawDefinition:()=>Bw,qualifierDrawPositionAssignment:()=>uU,qualifierProgression:()=>mU,removeDrawPositionAssignment:()=>$v,removeRoundMatchUps:()=>Gw,removeSeededParticipant:()=>rb,removeStructure:()=>SU,renameStructures:()=>yU,resetDrawDefinition:()=>Lw,resetQualifyingStructure:()=>NU,resetVoluntaryConsolationStructure:()=>ih,setDrawParticipantRepresentativeIds:()=>Lm,setPositionAssignments:()=>RS,setStructureOrder:()=>fU,setSubOrder:()=>qw,shiftAdHocRounds:()=>MS,swapAdHocRounds:()=>CS,swapDrawPositionAssignments:()=>tb,updateTeamLineUp:()=>bS,withdrawParticipantAtDrawPosition:()=>Gv});var Cm=e=>t=>e[t],Am=(e=[])=>e.map(xm).filter(Boolean),km=(e=[])=>e.map(Om).filter(Boolean),Om=(e={})=>Cm(e)("participantId"),xm=(e={})=>Cm(e)("matchUpId"),Fm=(e={})=>Cm(e)("drawId");function Lm({representativeParticipantIds:e,drawDefinition:t}){if(!t)return{error:Zr};if(!Array.isArray(e))return{error:Ho};let i=km(t?.entries||[]);return e.length&&yr(e,i).length<e.length?{error:Ho}:$p({drawDefinition:t,extension:{name:pm,value:e}})}var _m="ABANDONED",Bm="AWAITING_RESULT",Vm="CANCELLED",jm="COMPLETED",$m="DEAD_RUBBER",Gm="DEFAULTED",Wm="DOUBLE_DEFAULT",qm="DOUBLE_WALKOVER",Hm="IN_PROGRESS",zm="INCOMPLETE",Ym="NOT_PLAYED",Km="RETIRED",Xm="SUSPENDED",Jm="TO_BE_PLAYED",Qm="WALKOVER",Zm=[Bm,jm,Gm,Hm,zm,Km,Xm],ef=[Bm,jm,Gm,qm,Wm,Hm,zm,Km,Xm,Qm],tf=[_m,Bm,"BYE",Vm,jm,$m,Gm,qm,Wm,Hm,zm,Ym,Km,Xm,Jm,Qm],rf=["BYE",qm,Wm,jm,Gm,Km,Qm],nf=[_m,Bm,Vm,$m,Hm,zm,Ym,Xm,Jm,void 0],af=[Vm,_m,jm,$m,Gm,qm,Wm,Km,Qm],of=[_m,jm,Gm,qm,Wm,Hm,Km,Qm],sf=[Hm,zm,Xm,Jm],cf={ABANDONED:_m,AWAITING_RESULT:Bm,BYE:"BYE",CANCELLED:Vm,COMPLETED:jm,DEAD_RUBBER:$m,DEFAULTED:Gm,DOUBLE_WALKOVER:qm,DOUBLE_DEFAULT:Wm,IN_PROGRESS:Hm,INCOMPLETE:zm,NOT_PLAYED:Ym,RETIRED:Km,SUSPENDED:Xm,TO_BE_PLAYED:Jm,WALKOVER:Qm};function df(e,t,i){let r=e=>Jp({element:e,name:hm})?.extension?.value,n=i?.deprioritizeCompleted,a=i?.mode===Nu&&Mu,o=i?.mode===Pu&&Eu,s=o||a||Du,c=e=>(e=>e?.stage===vu&&1===e?.stageSequence)(e)?-1:s[e?.stage],d=e=>e?.matchUps.every((({matchUpStatus:e})=>af.includes(e)?1:-1));return n&&d(e)-d(t)||a&&c(e)-c(t)||(e?.stage&&s[e.stage]||0)-(t?.stage&&s[t.stage]||0)||(r(e)||0)-(r(t)||0)||!o&&!a&&(t?.positionAssignments?.length??1/0)-(e?.positionAssignments?.length??1/0)||(e?.stageSequence??0)-(t?.stageSequence??0)||(uf(e)||0)-(uf(t)||0)}function uf(e){return(e?.matchUps||[]).reduce(((e,t)=>{let i=(t.finishingPositionRange?.winner||[]).reduce(((e,t)=>e+t),0);return!e||i<e?i:e}),void 0)}function lf(e){let t=dp(e,[{[Pl]:!0,[Cl]:!0}]);if(t.error)return t;let{drawDefinition:i,structureId:r}=e,{structures:n}=pf({drawDefinition:i}),a=n?.map((e=>e.structures?[...e.structures].concat(e):e)).flat(),o=a?.find((e=>e.structureId===r));return o?{structure:o,containingStructure:o.structureType===Ou?a?.find((e=>e.structures?.some((e=>e.structureId===r)))):void 0}:{error:Rn}}function pf({withStageGrouping:e,drawDefinition:t,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){let c=!t&&Jr||!t?.structures&&Cn||void 0;if(c)return{error:c,structures:[],stageStructures:{}};let d=t?.structures?.filter((function(e){return!s&&!Array.isArray(o)||s&&e.stage===s||Array.isArray(o)&&o.includes(e.stage)})).filter((function(e){return!r&&!Array.isArray(i)||r&&e.stageSequence===r||Array.isArray(i)&&i.includes(e.stageSequence)})).filter((e=>{let t=Jp({element:e,name:hm})?.extension?.value;return!n||n===t})).sort(((e,t)=>df(e,t,a)))??[],u=e?Object.assign({},...Tu.map((e=>{let t=d?.filter((t=>t.stage===e));return t?.length&&{[e]:t}})).filter(Boolean)):{};return{structures:d,stageStructures:u}}function mf({drawDefinition:e}){if(!e)return{error:Jr};let t={};return{allPositionedParticipantIds:(e.structures||[]).map((e=>{let i=e.stage;t[i]||(t[i]=[]);let{positionAssignments:r}=ff({structure:e}),n=r?.map(Om).filter(Boolean)??[];return t[i].push(...n),n})).flat(),stagePositionedParticipantIds:t}}function ff({drawDefinition:e,structureId:t,structure:i}){let r,n=[];if(!i){if(!e)return{positionAssignments:n,error:Jr};if(({structure:i,error:r}=lf({drawDefinition:e,structureId:t})),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map((e=>ff({structure:e}).positionAssignments))):i.positionAssignments?n=i.positionAssignments:r=qn,{positionAssignments:n,error:r}}function hf({drawDefinition:e,structureId:t,structure:i}){let r=ff({drawDefinition:e,structureId:t,structure:i})?.positionAssignments||[],n=r?.filter((e=>e.participantId??e.bye??e.qualifier)),a=r&&r?.length===n?.length,o=r?.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)),s=r?.filter((e=>!e.participantId&&e.bye)),c=r?.filter((e=>!e.participantId&&e.qualifier));return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:o,assignedPositions:n,qualifierPositions:c,byePositions:s}}var gf="addDrawDefinition",If="addMatchUps",yf="addParticipants",vf="addScaleItems",Sf="addEvent",Uf="addVenue",bf="audit",wf="dataIssue",Tf="deleteParticipants",Df="deleteVenue",Pf="deletedDrawIds",Nf="deletedMatchUpIds",Ef="modifyDrawDefinition",Mf="modifyDrawEntries",Rf="modifyEventEntries",Cf="modifyMatchUp",Af="modifyParticipants",kf="modifyPositionAssignments",Of="modifySeedAssignments",xf="modifyTournamentDetail",Ff="modifyVenue",Lf="mutations",_f="publishEvent",Bf="publishEventSeeding",Vf="publishOrderOfPlay",jf="publishParticipants",$f="unPublishEvent",Gf="unPublishEventSeeding",Wf="unPublishOrderOfPlay",qf="unPublishParticipants",Hf="updateInContextMatchUp",zf={ADD_DRAW_DEFINITION:gf,ADD_MATCHUPS:If,ADD_PARTICIPANTS:yf,ADD_SCALE_ITEMS:vf,ADD_EVENT:Sf,ADD_VENUE:Uf,AUDIT:bf,DATA_ISSUE:wf,DELETE_PARTICIPANTS:Tf,DELETE_VENUE:Df,DELETED_DRAW_IDS:Pf,DELETED_MATCHUP_IDS:Nf,MODIFY_DRAW_DEFINITION:Ef,MODIFY_DRAW_ENTRIES:Mf,MODIFY_EVENT_ENTRIES:Rf,MODIFY_MATCHUP:Cf,MODIFY_PARTICIPANTS:Af,MODIFY_POSITION_ASSIGNMENTS:kf,MODIFY_SEED_ASSIGNMENTS:Of,MODIFY_TOURNAMENT_DETAIL:xf,MODIFY_VENUE:Ff,MUTATIONS:Lf,PUBLISH_EVENT_SEEDING:Bf,PUBLISH_EVENT:_f,PUBLISH_ORDER_OF_PLAY:Vf,PUBLISH_PARTICIPANTS:jf,UNPUBLISH_EVENT_SEEDING:Gf,UNPUBLISH_EVENT:$f,UNPUBLISH_ORDER_OF_PLAY:Wf,UPDATE_INCONTEXT_MATCHUP:Hf};function Yf(e,t){if(!e)return{error:Jr};let i=Date.now();e.updatedAt&&i===new Date(e.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=t?.filter(Boolean);return e.updatedAt=r,e.structures?.filter(Boolean).forEach((e=>{(!n?.length||n?.includes(e.structureId))&&(e.updatedAt=r)})),{..._r}}function Kf({drawDefinition:e,tournamentId:t,matchUps:i,eventId:r}){return e&&Yf(e),As({payload:{matchUps:i,tournamentId:t,eventId:r},topic:If}),{..._r}}function Xf({drawDefinition:e,tournamentId:t,matchUpIds:i,eventId:r,action:n}){e&&Yf(e),As({topic:Nf,payload:{tournamentId:t,matchUpIds:i,eventId:r,action:n}});for(let a of i)xs({key:a});return{..._r}}function Jf({drawDefinition:e,tournamentId:t,structureId:i,context:r,eventId:n,matchUp:a}){return a?(e&&Zf({drawDefinition:e,structureIds:i?[i]:void 0,tournamentId:t,eventId:n}),As({topic:Cf,payload:{matchUp:a,tournamentId:t,context:r},key:a.matchUpId}),{..._r}):(console.log(sa),{error:sa})}function Qf({tournamentId:e,eventId:t,drawDefinition:i}){return i?(Yf(i),As({payload:{drawDefinition:i,tournamentId:e,eventId:t},topic:gf,key:i.drawId}),{..._r}):(console.log(Jr),{error:Jr})}function Zf({drawDefinition:e,tournamentId:t,structureIds:i,eventId:r}){return e?(Yf(e,i),As({payload:{tournamentId:t,eventId:r,drawDefinition:e},topic:Ef,key:e.drawId}),{..._r}):{error:Jr}}function eh({drawDefinition:e,tournamentId:t,structure:i,eventId:r}){if(!e)return{error:Jr};if(!i)return{error:An};let n=i.seedAssignments,a=i.structureId;return As({payload:{tournamentId:t,eventId:r,drawId:e.drawId,structureId:a,seedAssignments:n},topic:Of,key:e.drawId}),Zf({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:r}),{..._r}}function th({drawDefinition:e,tournamentId:t,structure:i,event:r}){if(!e)return{error:Jr};if(!i)return{error:An};let n=ff({structure:i}),a=i.structureId,o=e.drawId,s=r?.eventId;return As({topic:kf,payload:{positionAssignments:n,tournamentId:t,structureId:a,eventId:s,drawId:o},key:a}),Zf({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:s}),{..._r}}function ih({tournamentRecord:e,drawDefinition:t,resetEntries:i,event:r}){if(!t)return{error:Jr};let n=t.structures?.find((e=>e.stage===bu));if(!n)return{error:Rn};let a=n.matchUps?.map((({matchUpId:e})=>e))||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Xf({tournamentId:e?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:t}),i&&(t.entries=t.entries.filter((e=>e.entryStage!==bu))),Zf({tournamentId:e?.tournamentId,eventId:r?.eventId,drawDefinition:t,structureIds:[n.structureId]}),{..._r}}function rh({drawPositions:e,structure:t}){if([Su,vu].includes(t.stage)&&1===t.stageSequence)return;let{positionAssignments:i}=ff({structure:t});i?.filter((({drawPosition:t})=>e?.includes(t)))?.forEach((e=>{Vp({element:e,extension:{name:rm,value:!0}})}))}function nh(e){let{appliedPolicies:t,positionAction:i,drawDefinition:r}=e;if(!1===t?.audit?.[fm])return;let{extension:n}=Jp({name:fm,element:r}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let e=r.structures.find((e=>e.stage===vu));if(e){let t=ff({structure:e}).positionAssignments?.map((({drawPosition:e,participantId:t,bye:i,qualifier:r})=>({drawPosition:e,participantId:t,qualifier:r,bye:i})));a.push({name:"initialMainAssignments",initialAssignments:t})}}Vp({element:r,extension:{value:a.concat(i),name:fm}})}function ah({tournamentRecord:e,drawDefinition:t,event:i}){let r=(e?.events||i&&[i])?.map((e=>e?.drawDefinitions)).flat().filter(Boolean)||t&&[t]||[],n={},a={},o=r.map((e=>e?.structures?.filter((e=>e?.structures)))).flat().filter(Boolean);for(let s of o){let{structures:e,structureId:t}=s??{};e&&t&&(n[t]=e?.map((e=>e.structureId)))&&e.forEach((e=>a[e.structureId]=s?.structureId))}return{containedStructures:n,containerStructures:a}}function oh(e){let{sides:t,matchUpType:i}=e||{},r=e.potentialParticipants?.length?e.potentialParticipants.flat().map((e=>i===ji?e?.individualParticipantIds||[]:e.participantId)).flat():[],n=(t||[]).map((e=>i===ji&&(e?.participant?.individualParticipantIds||[])||e?.participantId&&[e.participantId]||[])).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function sh(e){return e?.tournamentRecords??(e?.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{}}var ch="SIGN_IN_STATUS",dh="SIGNED_OUT",uh="SIGNED_IN",lh="TEAM",ph="INDIVIDUAL",mh="GROUP",fh="PAIR",hh="TEAM",gh={TEAM_PARTICIPANT:lh,INDIVIDUAL:ph,GROUP:mh,TEAM:hh,PAIR:fh},Ih={INDIVIDUAL:ph,GROUP:mh,PAIR:fh,TEAM:hh,SIGN_IN_STATUS:ch,SIGNED_OUT:dh,SIGNED_IN:uh};function yh({participantsProfile:e,participants:t=[],deepCopy:i}){let r=new Map,n=!1!==i?yd(t,e?.convertExtensions,!0):t,a=n.filter((e=>e.participantType===hh)),o=n.filter((e=>e.participantType===mh)),s=n.filter((e=>e.participantType===fh));return n.forEach((e=>{if(e.participantType===ph){let{participantId:t}=e;e.groupParticipantIds=[],e.teamParticipantIds=[],e.pairParticipantIds=[],e.groups=[],e.teams=[],a.forEach((i=>{(i?.individualParticipantIds||[]).forEach((n=>{n===t&&!e.teamParticipantIds?.includes(i.participantId)&&(e.teamParticipantIds.push(i.participantId),r.get(i.participantId)||r.set(i.participantId,{participantName:i.participantName,participantId:i.participantId}),e.teams.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId,teamId:i.teamId}))}))})),s.forEach((i=>{(i?.individualParticipantIds||[]).forEach((r=>{r===t&&!e.pairParticipantIds.includes(i.participantId)&&e.pairParticipantIds.push(i.participantId)}))})),o.forEach((i=>{(i?.individualParticipantIds||[]).forEach((r=>{r===t&&!e.groupParticipantIds.includes(i.participantId)&&(e.groupParticipantIds.push(i.participantId),e.groups.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId}))}))}))}})),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function vh(e){return e&&typeof String.fromCodePoint<"u"?e.toUpperCase().replace(/./g,(e=>String.fromCodePoint(e.charCodeAt(0)+127397))):e}var Sh=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Uh({participant:e,withISO2:t,withIOC:i}){let{person:r,individualParticipants:n}=e;[r,n?.map((({person:e})=>e))].flat().filter(Boolean).forEach((function(e){let{nationalityCode:r}=e||{};if(r){let n=Sh.find((({iso:e})=>e===r));i&&n?.ioc&&!e.iocNationalityCode&&(e.iocNationalityCode=n.ioc),t&&n?.iso2&&!e.iso2NationalityCode&&(e.iso2NationalityCode=n.iso2),n?.label&&!e.countryName&&(e.countryName=n.label)}}))}function bh(e){let{tournamentRecord:t,participantId:i}=e,r=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};for(let n of Object.values(r)){let e=n.participants?.find((e=>e.participantId===i));if(e)return{participant:e,tournamentId:n.tournamentId}}return{error:Ya}}function wh(e){let{tournamentRecord:t,participantId:i}=e;if(i){let e=bh({tournamentRecord:t,participantId:i});return e.participant??e}return e.element||e.drawDefinition||e.event||e.tournamentRecord||{error:va}}function Th(e){let{returnPreviousValues:t,itemSubTypes:i,itemType:r}=e,n=wh(e);if(n.error)return n;if(i&&!Array.isArray(i))return{error:Ho,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:ko};let a=n.timeItems.filter((e=>e?.itemType===r)).filter((e=>!i?.length||i.some((t=>e?.itemSubTypes?.includes(t))))).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())),o=yd(a.pop(),!1,!0);if(o){let e={timeItem:o,..._r};return t&&Object.assign(e,{previousItems:a}),e}return{info:Qo}}function Dh({returnPreviousValues:e,drawDefinition:t,itemSubTypes:i,itemType:r}){if(!t)return{error:In};if(!t.timeItems)return{info:Qo};let{timeItem:n,previousItems:a,info:o}=Th({element:t,returnPreviousValues:e,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Ph({returnPreviousValues:e,itemSubTypes:t,itemType:i,event:r}){if(!r)return{error:Fn};if(!r.timeItems)return{info:Qo};let{timeItem:n,previousItems:a,info:o}=Th({returnPreviousValues:e,element:r,itemSubTypes:t,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function Nh({returnPreviousValues:e,tournamentRecord:t,itemSubTypes:i,itemType:r}){if(!t)return{error:zr};if(!t.timeItems)return{info:Qo};let{timeItem:n,previousItems:a,info:o}=Th({element:t,returnPreviousValues:e,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Eh({returnPreviousValues:e,tournamentRecord:t,participantId:i,itemSubTypes:r,itemType:n}){if(!t)return{error:zr};if(!i)return{error:Ha};let a=bh({tournamentRecord:t,participantId:i});if(a.error)return a;let{participant:o}=a;if(!o?.timeItems)return{info:Qo};let{timeItem:s,previousItems:c,info:d}=Th({element:a.participant,returnPreviousValues:e,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:c}||{info:d}}var Mh={[mh]:"groupParticipantIds",[fh]:"pairParticipantIds",[hh]:"teamParticipantIds"},Rh={[mh]:"groups",[hh]:"teams"};function Ch({withIndividualParticipants:e,convertExtensions:t,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,withGroupings:a,internalUse:o,withISO2:s,withIOC:c}){let d,u=[],l={};for(let p of i.participants??[]){let e=p?.participantId;e&&Oh({participantMap:l,participantId:e})}for(let p of i.participants??[]){let e=yd(p,t,o),{participantId:i,individualParticipantIds:a,participantType:d}=e;if(l[i]){if(Object.assign(l[i].participant,e),a){let t=kh({individualParticipantIds:a,participantCopy:e,participantMap:l,participantType:d,participantId:i});t.missingParticipantIds.length&&u.push(...t.missingParticipantIds)}if(r&&(l[i].participant.signedIn=Ah(e)),n){let{ratings:t,rankings:r,seedings:n}=Ip({participant:e});l[i].participant.seedings=n,l[i].participant.rankings=r,l[i].participant.ratings=t}(c||s)&&Uh({participant:l[i].participant,withISO2:s,withIOC:c})}else u.push(i)}if(e){!function({participantMap:e,template:t}){let i=Object.values(e);for(let r of i){let i=r.participant;if(i.individualParticipantIds?.length){i.individualParticipants=[];for(let r of i.individualParticipantIds){let n=e[r].participant;i.individualParticipants.push(t?yp({template:t,source:n}):n)}}}}({participantMap:l,template:Rr(e)?e:void 0})}return a&&(d=yh({participants:Object.values(l).map((({participant:e})=>e)),participantsProfile:{convertExtensions:t},deepCopy:!1}).groupInfo),{missingParticipantIds:u,participantMap:l,groupInfo:d}}function Ah(e){let{timeItem:t}=Th({itemType:ch,element:e});return t?.itemValue===uh}function kh({individualParticipantIds:e,participantCopy:t,participantMap:i,participantType:r,participantId:n}){let a=[];for(let o of e){let s=i[o]?.participant;if(s){if(s[Mh[r]].push(n),[hh,mh].includes(r)){let{participantRoleResponsibilities:e,participantOtherName:i,participantName:n,participantId:a,teamId:o}=t;s[Rh[r]].push({participantRoleResponsibilities:e,participantOtherName:i,participantName:n,participantId:a,teamId:o})}if(r===fh){let t=e.find((e=>e!==o));i[o].pairIdMap[n]=t,i[o].pairIdMap[t]=n}}else a.push(o)}return{missingParticipantIds:a}}function Oh({participantMap:e,participantId:t}){if(e[t])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};e[t]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Bi]:{...i},[ji]:{...i},[hh]:{...i},...i}}}function xh({participantsProfile:e,useParticipantMap:t,tournamentRecord:i,contextProfile:r,inContext:n}){if(t)return Ch({...e,...r,tournamentRecord:i});let a,o=yd(i.participants,!1,!0)||[];if((e?.withIOC||e?.withISO2)&&o.forEach((t=>Uh({participant:t,...e}))),(n||e?.withGroupings)&&o?.length&&({participantsWithGroupings:o,groupInfo:a}=yh({participantsProfile:e,deepCopy:!1,participants:o})),e?.withScaleValues&&o?.length)for(let s of o){let{ratings:e,rankings:t}=Ip({participant:s});s.rankings=t,s.ratings=e}return{participants:o,groupInfo:a}}function Fh({onlySpecifiedPolicyTypes:e=!1,policyTypes:t=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(t))return{error:da};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,..._r};function s(i){let r=i?.extensions?.find((e=>e.name===Qp))?.value;if(r)for(let n of Object.keys(r))(e?t.includes(n):!t.length||t.includes(n))&&(o[n]=yd(r[n],!1,!0))}}function Lh({policyTypes:e=[],tournamentRecord:t,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(e))return{error:da};let{appliedPolicies:a}=Fh({tournamentRecord:t,drawDefinition:i,structure:r,event:n}),o={};for(let s of e){let e=a?.[s];e&&(o[s]=e)}return Object.keys(o).length?{policyDefinitions:o}:{info:ha.message}}var _h="WALKOVER",Bh="RETIRED",Vh="COMPETITIVE",jh="ROUTINE",$h="DECISIVE",Gh="winRatio",Wh={[Sp]:{policyName:"Competitive Bands Default",profileBands:{[$h]:20,[jh]:50}}};function qh({policyDefinitions:e,tournamentRecord:t,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=Lh({tournamentRecord:t,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let t=e?.[Sp]??o?.[Sp]??Wh[Sp];a.policies[Sp]=t}return a}function Hh({tournamentRecord:e,drawDefinition:t,policyType:i,structure:r,event:n}){if(!e)return{error:zr};let{appliedPolicies:a}=Fh({tournamentRecord:e,drawDefinition:t,structure:r,event:n});return a?.[i]?{policy:a[i]}:{info:ha?.message}}function zh({tournamentRecord:e,categoryName:t,categoryType:i,event:r}){t=t??r?.category?.categoryName??r?.category?.ageCategoryCode,i=i??r?.category?.categoryType??r?.category?.subType;let{policy:n}=Hh({policyType:Ep,tournamentRecord:e,event:r}),a=(e?Jp({element:e,name:Im}).extension:void 0)?.value,o=(r&&Jp({name:Im,element:r}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:t,categoryType:i,policy:n}}}function Yh({drawDefinition:e,attributes:t}){let{extension:i}=Jp({element:e,name:om}),r=i?.value||{};return t.forEach((e=>{Object.keys(e).forEach((t=>{r[t]?Object.assign(r[t],e[t]):r[t]=e[t]}))})),i={name:om,value:r},$p({drawDefinition:e,extension:i}),{entryProfile:r}}function Kh({drawDefinition:e}){let{extension:t}=Jp({element:e,name:om});return{entryProfile:t?.value||{}}}var Xh="ALTERNATE",Jh="CONFIRMED",Qh="DIRECT_ACCEPTANCE",Zh="FEED_IN",eg="JUNIOR_EXEMPT",tg="LUCKY_LOSER",ig="ORGANISER_ACCEPTANCE",rg="QUALIFIER",ng="SPECIAL_EXEMPT",ag="UNGROUPED",og="UNPAIRED",sg="WILDCARD",cg="WITHDRAWN",dg=[Jh,Qh,eg,ig,ng],ug=[Zh,tg,rg],lg=[Jh,Qh,Zh,eg,ig,ng,sg],pg=[Jh,Qh,eg,tg,rg,ig,ng,sg],mg=[Xh,Jh,Qh,Zh,eg,tg,ig,rg,"REGISTERED",ng,ag,og,sg,cg],fg={ALTERNATE:Xh,CONFIRMED:Jh,DIRECT_ACCEPTANCE:Qh,DIRECT_ENTRY_STATUSES:lg,DRAW_SPECIFIC_STATUSES:ug,EQUIVALENT_ACCEPTANCE_STATUSES:dg,FEED_IN:Zh,JUNIOR_EXEMPT:eg,LUCKY_LOSER:tg,ORGANISER_ACCEPTANCE:ig,QUALIFIER:rg,SPECIAL_EXEMPT:ng,STRUCTURE_SELECTED_STATUSES:pg,UNGROUPED:ag,UNPAIRED:og,VALID_ENTRY_STATUSES:mg,WILDCARD:sg,WITHDRAWN:cg};function hg({stage:e,drawDefinition:t}){let{entryProfile:i}=Kh({drawDefinition:t}),r=Object.keys(i).includes(e);if(!r&&Tu.includes(e)){return Yh({drawDefinition:t,attributes:[{[e]:{drawSize:void 0,alternates:!0}}]}),!0}return r}function gg({stage:e,drawDefinition:t,entryStatus:i}){return t.entries.reduce(((t,r)=>r.entryStage===e&&r.entryStatus===i?t+1:t),0)}function Ig({provisionalPositioning:e,placementGroup:t,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:c}){let d=i.entries?.reduce(((e,t)=>{let i=Jp({name:hm,element:t})?.extension?.value,a=c&&t.entryStage===c||s?.length&&t.entryStage&&s.includes(t.entryStage),d=!n||t.entryStatus&&n.includes(t.entryStatus),u=t.entryStageSequence??1;return!a||r&&u!==r||!d||o&&i&&o!==i?e:e.concat(t)}),[])??[];if(a&&c===wu){let{playoffEntries:r,error:n}=function({provisionalPositioning:e,drawDefinition:t,structureId:i}){let r=[],n=(t.links??[]).find((e=>e.linkType===Vu&&e.target.structureId===i));if(n){let{finishingPositions:i,structureId:a}=n.source,{structure:o}=lf({drawDefinition:t,structureId:a});o?.structureType===xu&&(o.structures??[]).forEach((t=>{let n=t.positionAssignments??[],{structureId:a}=t,o=a,s=Object.assign({},...n.map((e=>{let{participantId:t}=e,i=Jp({element:e,name:Sm}).extension?.value;return i&&t?{[t]:i}:void 0})).filter(Boolean)),c=Object.keys(s).reduce(((t,i)=>{let r=s[i],n=r.groupOrder||e&&r.provisionalOrder;return t.includes(n)||t.push(n),t}),[]).length===Object.keys(s).length,d=Object.keys(s).filter((t=>{let r=s[t],n=r.groupOrder||e&&r.provisionalOrder;return i?.includes(n)}));(!e||c)&&d.forEach((t=>{let n=s[t],{groupOrder:a,provisionalOrder:c,GEMscore:d}=n,u=a||e&&c,l=[...i??[]].sort(Hi).indexOf(u)+1;r.push({entryStage:wu,entryStatus:Zh,placementGroup:l,groupingValue:o,participantId:t,GEMscore:d})}))}))}return{playoffEntries:r}}({provisionalPositioning:e,drawDefinition:i,structureId:a});return n&&console.log("playoff entries error"),(r?.length?r:d).filter((e=>!t||e.placementGroup===t))}return d}function yg({provisionalPositioning:e,returnAllProxies:t,drawDefinition:i,structureId:r,structure:n}){let a,o=[];n||({structure:n,error:a}=lf({drawDefinition:i,structureId:r}));let s=ff({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Rn};r||(r=n.structureId);let{stage:c,stageSequence:d}=n,u=c===wu&&i&&Ig({provisionalPositioning:e,drawDefinition:i,stageSequence:d,structureId:r,stage:c}),l=u?u.filter((e=>1===e.placementGroup)).sort(((e,t)=>(e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore&&-1)||0)).map(((e,t)=>{let i=t+1;return{participantId:e.participantId,seedValue:i,seedProxy:!0,seedNumber:i}})):[],p=l?.slice(0,t?l.length:s.length/2);return p.length?o=p:n.seedAssignments?o=n.seedAssignments:a=Tn,{seedAssignments:o,stageSequence:d,seedLimit:n.seedLimit??n?.positionAssignments?.length,stage:c,error:a}}function vg(e){if(!e)return;let{tieFormatId:t,tieFormats:i}=e;return e.tieFormat?e.tieFormat:t&&Array.isArray(i)?i.find((e=>e.tieFormatId===t)):void 0}function Sg({item:e,drawDefinition:t,structure:i,event:r}){if(e){if(e.tieFormat)return e.tieFormat;if(e.tieFormatId)return t.tieFormat?t.tieFormat:t.tieFormats?.find((t=>e.tieFormatId===t.tieFormatId))||(r.tieFormat?r.tieFormat:r.tieFormats?.find((t=>e.tieFormatId===t.tieFormatId)));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let e=t.tieFormats?.find((e=>i.tieFormatId===e.tieFormatId));if(e)return e}}}function Ug({drawDefinition:e,structure:t,matchUp:i,event:r}){return{tieFormat:Sg({item:i,drawDefinition:e,structure:t,event:r})||Sg({item:t,drawDefinition:e,structure:t,event:r})||vg(e)||vg(r)}}function bg({drawDefinition:e,structure:t}){let i={},r=[];return(e?.structures??[t]).filter((e=>e&&"object"==typeof e)).forEach((e=>{if(!e)return;let{structureId:t,matchUps:n,structures:a}=e,o=Array.isArray(a);if(o)o&&a.forEach((e=>{let{structureName:n}=e,a=e.matchUps;i[e.structureId]={matchUps:a,itemStructureIds:[],structureName:n},a&&(r.push(...a),a.forEach((e=>{e.tieMatchUps&&r.push(...e.tieMatchUps)}))),i[t]||(i[t]={itemStructureIds:[],matchUps:[]}),i[t].itemStructureIds||(i[t].itemStructureIds=[]),i[t].itemStructureIds.push(e.structureId)}));else{let e=n;i[t]={matchUps:e,itemStructureIds:[]},e?.forEach((e=>{r.push(e),e.tieMatchUps&&r.push(...e.tieMatchUps)}))}})),{mappedMatchUps:i,drawMatchUps:r}}function wg({mappedMatchUps:e,matchUpsMap:t,structureId:i,inContext:r}){let n=(e=t?.mappedMatchUps??e)[i],a=(n?.itemStructureIds||[]).map((t=>{let{matchUps:n,structureName:a}=e[t];return r?n.map((e=>Object.assign(yd(e,!0,!0),{containerStructureId:i,structureId:t,structureName:a}))):n})).flat();return(n?.matchUps||[]).concat(...a)}function Tg({groupedOrder:e,roundPositionsCount:t}){if(!e||e?.length<=t)return e;let i=wr(e,e.length/t).map((e=>e.reduce(((e,t)=>e+t)))),r=i.slice().sort(Hi);return i.map((e=>r.indexOf(e)+1))}function Dg(e){if(!Rr(e))return!1;let{matchUpId:t,drawPositions:i}=e,r="string"==typeof t,n=!i||Array.isArray(i)&&i.length<=2&&i.every((e=>ir(e)||null==e));return r&&n}function Pg(e){return!!Array.isArray(e)&&e.every(Dg)}function Ng({matchUps:e=[],interpolate:t}){if(!Pg(e))return{roundMatchUps:[],error:Ho};let i=e.reduce(((e,t)=>{let i="string"==typeof t.roundNumber?zi(t.roundNumber):t.roundNumber;return!t.roundNumber||e.includes(i)?e:e.concat(i)}),[]).sort(Hi).map((t=>{let i=e.filter((e=>e.roundNumber===t)),r=i.find((({matchUpType:e})=>e===Gi))?i.filter((({matchUpType:e})=>e===Gi)):i;return{[t]:(n=r,n.sort(((e,t)=>Hi(e.roundPosition,t.roundPosition))))};var n})),r=e.reduce(((e,t)=>{let i="string"==typeof t.roundNumber?zi(t.roundNumber):t.roundNumber;return e[i]||(e[i]=Js({abbreviatedRoundName:t.abbreviatedRoundName,finishingRound:t.finishingRound,roundName:t.roundName})),e}),{}),n=Object.assign({},...i);if(t){let e=Math.max(...Object.keys(n).map((e=>zi(e))).filter((e=>!Number.isNaN(e)))),t=n[e]?.length;if(t>1&&Yi(t)){let i=e+1;gr(i,i+t/2).forEach(((e,i)=>{n[e]=gr(0,t/(2+2*i)).map((()=>({})))}))}}let a=0,o=Object.assign({},...Object.keys(n).map((e=>{let t=n[e]?.length,i=n[e]?.filter((e=>!af.includes(e.matchUpStatus)&&!e.score?.scoreStringSide1))?.length,r=t&&t===i;return a=Math.max(a,t),{[e]:{matchUpsCount:t,inactiveCount:i,inactiveRound:r}}}))),s=0,c=0,d=Object.keys(n).map((e=>zi(e))).filter((e=>!Number.isNaN(e)));d.forEach((e=>{let t=n[e].sort(((e,t)=>e.roundPosition-t.roundPosition)),i=t.flatMap((e=>e?.drawPositions||[]));if(o[e].roundNumber=e,o[e].roundFactor=o[e].matchUpsCount?a/o[e].matchUpsCount:1,o[e].finishingRound=r[e]?.finishingRound,o[e].roundName=r[e]?.roundName,o[e].abbreviatedRoundName=r[e]?.abbreviatedRoundName,o[e].finishingPositionRange=n[e]?.[0]?.finishingPositionRange,1!==e&&o[e-1]){let i=o[e-1],r=i.drawPositions,n=i.matchUpsCount/o[e].matchUpsCount,a=wr(r,n),s=t.map((t=>{let{roundPosition:i}=t,n=[...t.drawPositions||[],void 0,void 0].slice(0,2);if(!i)return n;let o=n?.filter(Boolean)||[];if(!o?.length)return[void 0,void 0];if(e<3&&2===o?.length)return n?.slice().sort(Hi);let s=yr(r,o).length!==o?.length;if(o?.length&&s)return 1===o?.length?[o[0],void 0]:n?.slice().sort(Hi);let c=2*(i-1);return a.slice(c,c+2).map((e=>o?.find((t=>e.includes(t)))))}));o[e].drawPositions=s?.flat(),o[e].pairedDrawPositions=s}else{let t=i.sort(Hi),r=wr(t,2);o[e].drawPositions=t,o[e].pairedDrawPositions=r}o[e+1]&&o[e+1].matchUpsCount===o[e].matchUpsCount&&(o[e+1].feedRound=!0,o[e+1].feedRoundIndex=c,o[e].preFeedRound=!0,c+=1),o[e]&&!o[e].feedRound&&(o[e].roundIndex=s,s+=1)}));let u=!!Object.values(o).some((({matchUpsCount:e})=>!Yi(e)));return{hasNoRoundPositions:e.some((e=>!e.roundPosition)),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:d,roundProfile:o,..._r}}function Eg(e){if(!Array.isArray(e))return"";let t=e.filter(Qi);return t.length?ar([Math.min(...t),Math.max(...t)]).join("-"):""}function Mg({drawDefinition:e}){if("object"!=typeof e)return{error:Xr};let t={},{structures:i=[],links:r=[]}=e||{},n=i.reduce(((e,t)=>{let{stage:i}=t;return e[i]?e[i].push(t):e[i]=[t],e}),{});for(let o of Object.keys(n)){let e=n[o].find((({stageSequence:e})=>1===e));if(!e)continue;let{structureId:i}=e;a({aggregator:{},targetRound:0,exitProfiles:t,exitProfile:"0",structureId:i,stage:o})}return{exitProfiles:t};function a({exitProfiles:e,exitProfile:t,structureId:n,targetRound:o,aggregator:s,stage:c}){e[n]||(e[n]=[]),"0"===t&&[Uu,wu].includes(c)||e[n].push(t);let d=r.filter((e=>e.source.structureId===n&&e.source.roundNumber>=o));for(let r of d){let n=r.source.roundNumber,o=r.target.roundNumber,c=r.target.structureId,d=i.find((e=>e.structureId===c)).stage,u=[d,c,o,n].join("|");if(s[u])return;s[u]=!0,a({exitProfile:`${t}-${n}`,structureId:c,exitProfiles:e,targetRound:o,aggregator:s,stage:d})}}}function Rg({roundsNotPowerOf2:e,drawDefinition:t,structure:i,matchUps:r}){if(!i)return!1;r=r??i.matchUps??[],e=e??Ng({matchUps:r}).roundsNotPowerOf2;let n=!!i.positionAssignments?.find((({drawPosition:e})=>e))||!!r?.find((({drawPositions:e})=>e?.length));return(!t?.drawType||t.drawType!==Qu)&&!i?.structures&&e&&n}function Cg({structure:e}){if(!e)return!1;let t=e.matchUps||e.roundMatchUps&&Object.values(e.roundMatchUps).flat(),i=!!t?.find((e=>e?.roundPosition)),r=!!t?.find((e=>e?.drawPositions?.length));return!(e?.structures||e?.stage===bu||t.length&&(i||r))}var Ag={[Dp]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[vu]:"",[wu]:"P",[Su]:"Q",[Uu]:"C"}}},kg=Ag;function Og({roundNamingPolicy:e,drawDefinition:t,structure:i,matchUps:r}){let{roundProfile:n,roundMatchUps:a}=Ng({matchUps:r}),{structureAbbreviation:o,stage:s}=i,c=Cg({structure:i}),d=Rg({structure:i}),u=i.structures,l={},p=Ag[Dp],m=i.stage===Su,f=m?Math.max(...(t?.structures??[]).filter((e=>e.stage===Su)).map((({stageSequence:e})=>e??1)),0):0,h=(i.stageSequence??1)<f?i.stageSequence??1:"",g=h&&(e?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=e?.roundNamingMap||p.roundNamingMap||{},y=e?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},v=e?.affixes?.preFeedRound||p.affixes.preFeedRound,S=e?.affixes?.roundNumber||p.affixes.roundNumber,U=(e?.namingConventions||p.namingConventions).round,b=s&&s!==vu?s[0]:"",w=e?.stageConstants||p.stageConstants,T=`${g}${s&&w?.[s]||b}${h}`,D=n?Object.keys(n):[],P=m&&w?.[Su]?`${w?.[Su]}-`:"";if(u||c||d)Object.assign(l,...D.map((e=>({[e]:{roundName:`${P}${U} ${e}`,abbreviatedRoundName:`${S}${e}`}}))));else{let t=m&&(e?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(l,...D.map((e=>{if(!n?.[e])return;let{matchUpsCount:i,preFeedRound:r}=n[e],a=2*i,s=t?.[n?.[e].finishingRound]||t&&`${S}${a}`||I[i]||`${S}${a}`,c=r?`-${v}`:"",d=[T,o,`${s}${c}`].filter(Boolean).join("-"),u=`${y[i]||`${S}${a}`}${c}`;return{[e]:{abbreviatedRoundName:[T,o,u].filter(Boolean).join("-"),roundName:d}}})))}return{roundNamingProfile:l,roundProfile:n,roundMatchUps:a}}var xg=(e,t)=>(e||0)+(t||0);function Fg(e,t){let i=Array.isArray(e)?e[0]:e;return Number.isNaN(i)&&_h||i<=t[$h]&&$h||i<=t[jh]&&jh||Vh}function Lg({score:e}){let t=e?.sets||[],i=t.reduce(((e,t)=>(e[0]+=t.side1Score||0,e[1]+=t.side2Score||0,e)),[0,0]),r=t.reduce(((e,t)=>(e[0]+=t.side1TiebreakScore||0,e[1]+=t.side2TiebreakScore||0,e)),[0,0]);return r.reduce(xg)&&(i[r[0]>r[1]?0:1]+=1),{sets:t,games:i,score:e}}function _g(e){let t=Math.min(...e.games),i=Math.max(...e.games);return Math.round(t/i*100)}function Bg(e){return e.map(_g).sort().map((e=>parseFloat(e.toFixed(2))))}function Vg({tournamentRecord:e,profileBands:t,matchUp:i}){if(!i)return{error:sa};let{score:r,winningSide:n}=i;if(!n)return{error:Ho};let a=!t&&e&&Hh({policyType:Sp,tournamentRecord:e}).policy,o=t||a?.profileBands||Wh[Sp].profileBands,s=Bg([Lg({score:r})]),c=Fg(s,o),d=Array.isArray(s)?s[0]:s;return{..._r,competitiveness:c,pctSpread:d}}function jg({matchUp:e}){if(!e)return{error:sa};if(e&&!e.sides)return{error:ca};if(e&&!e.hasContext)return{error:Oo};let t=(e.sides??[])?.map((e=>e?.participantId)).filter(Boolean),i=e.sides?.filter((e=>e.participant?.participantType===ph)).map((e=>e.participantId)).filter(Boolean)??[],r=((e.sides??[])?.map((e=>e.participant?.individualParticipants)).filter(Boolean)??[]).map((e=>(e??[]).map((e=>e?.participantId)).filter(Boolean))),n=[...i,...r.flat()].filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:ar(n.concat(t)).filter(Boolean)??[],individualParticipantIds:n,sideParticipantIds:t,..._r}}var $g="CHECK_IN",Gg="CHECK_OUT",Wg="SCHEDULE.ASSIGNMENT.VENUE",qg="SCHEDULE.ALLOCATION.COURTS",Hg="SCHEDULE.ASSIGNMENT.COURT",zg="SCHEDULE.COURT.ORDER",Yg="SCHEDULE.DATE",Kg="HOME_PARTICIPANT_ID",Xg="SCHEDULE.ASSIGN.OFFICIAL",Jg="SCHEDULE.TIME.SCHEDULED",Qg="SCHEDULE.TIME.START",Zg="SCHEDULE.TIME.STOP",eI="SCHEDULE.TIME.RESUME",tI="SCHEDULE.TIME.END",iI="SCHEDULE.TIME.MODIFIERS",rI="TO_BE_ANNOUNCED",nI="NEXT_AVAILABLE",aI="FOLLOWED_BY",oI="AFTER_REST",sI="RAIN_DELAY",cI=[rI,nI,aI,oI,sI],dI="SCALE",uI="RATING",lI="RANKING",pI="SEEDING",mI="PUBLISH",fI="PUBLIC",hI="STATUS",gI={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:cI,AFTER_REST:oI,ALLOCATE_COURTS:qg,ASSIGN_COURT:Hg,ASSIGN_OFFICIAL:Xg,ASSIGN_VENUE:Wg,CHECK_IN:$g,CHECK_OUT:Gg,COMPLETED_DATE:"COMPLETED.DATE",COURT_ORDER:zg,ELIGIBILITY:"ELIGIBILITY",END_TIME:tI,FOLLOWED_BY:aI,MEDICAL:"MEDICAL",MODIFICATION:"MODIFICATION",NEXT_AVAILABLE:nI,NOT_BEFORE:"NOT_BEFORE",OTHER:"other",PENALTY:"PENALTY",PUBLIC:fI,PUBLISH:mI,RANKING:lI,RATING:uI,RAIN_DELAY:sI,REGISTRATION:"REGISTRATION",RESUME_TIME:eI,RETRIEVAL:"RETRIEVAL",SCALE:dI,SCHEDULE:"SCHEDULE",SCHEDULED_DATE:Yg,SCHEDULED_TIME:Jg,SEEDING:pI,START_TIME:Qg,STATUS:hI,STOP_TIME:Zg,SUSPENSION:"SUSPENSION",TIME_MODIFIERS:iI,TO_BE_ANNOUNCED:rI};function II({matchUp:e}){if(!e)return{error:sa};if(!e.hasContext)return{error:Oo};if(!e.sides||2!==e?.sides.filter(Boolean).length)return{error:ca};let{nestedIndividualParticipantIds:t,allRelevantParticipantIds:i,sideParticipantIds:r}=jg({matchUp:e}),n=(e.timeItems??[]).filter((e=>e?.itemType&&[$g,Gg].includes(e.itemType))).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))),a=n.map((e=>e.itemValue)).filter((e=>n.filter((t=>t?.itemValue===e)).reverse()[0].itemType===$g));t?.forEach(((e,t)=>{let i=r?.[t],n=e?.length&&e.every((e=>a.includes(e)));i&&n&&!a.includes(i)&&a.push(i)})),r?.forEach(((e,i)=>{a.includes(e)&&(t?.[i]??[]).forEach((e=>{e&&!a.includes(e)&&a.push(e)}))}));let o=r?.reduce(((e,t)=>a.includes(t)&&e),!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,..._r}}var yI=e=>t=>{let i=Rr(t)&&t?.matchUpType||Mr(t)&&t;return i&&qi[e].includes(i)};function vI(e){let{matchUpAverageTimes:t,matchUpFormat:i}=e||{},r=t?.map((({matchUpFormatCodes:e})=>e?.filter((e=>e===i)))).flat().filter(Boolean).sort(((e,t)=>(e?.length||0)-(t?.length||0)))||[],n=r.includes(i)?i:r[0];return t?.find((({matchUpFormatCodes:e,averageTimes:t})=>e?.find((e=>n===e))&&t))?.averageTimes}function SI(e){let{matchUpRecoveryTimes:t,averageMinutes:i,matchUpFormat:r}=e||{};return t?.find((({matchUpFormatCodes:e,averageTimes:t,recoveryTimes:n})=>{if(t&&i){let{greaterThan:e=0,lessThan:r=360}=t;if(i>e&&i<r)return!0}return e?.find((e=>e===r))&&n}))?.recoveryTimes}function UI({timesBlockArray:e,categoryName:t,categoryType:i}){return e.filter((e=>Array.isArray(e))).map((e=>e.sort(((e,t)=>(t.categoryNames?.length||0)-(e.categoryNames?.length||0))).find((({categoryTypes:e,categoryNames:r})=>!r?.length&&!e?.length||r?.includes(t)||e?.includes(i))))).find(Boolean)}var bI="DOUBLES_SINGLES",wI="SINGLES_DOUBLES",TI="total",DI="participantConflict",PI="matchUpConflict",NI="ISSUE_IDS",EI="CONFLICT",MI="WARNING",RI="ERROR",CI="ISSUE",AI="STATE",kI={SINGLES_DOUBLES:wI,DOUBLES_SINGLES:bI,TOTAL:TI,CONFLICT_MATCHUP_ORDER:PI,CONFLICT_PARTICIPANTS:DI,SCHEDULE_ISSUE_IDS:NI,SCHEDULE_CONFLICT:EI,SCHEDULE_WARNING:MI,SCHEDULE_ERROR:RI,SCHEDULE_ISSUE:CI,SCHEDULE_STATE:AI,BLOCKED:"BLOCKED",PRACTICE:"PRACTICE",MAINTENANCE:"MAINTENANCE"};function OI({defaultAverageMinutes:e=90,defaultRecoveryMinutes:t=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:zr};o=o??s?.eventType??mu;let c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},{scheduleTiming:d}=zh({tournamentRecord:i,categoryName:n,categoryType:a,event:s});return xI({eventType:o,timingDetails:{...d,matchUpFormat:r,categoryType:a,defaultTiming:c}})}function xI({timingDetails:e,eventType:t}){let i=function({matchUpFormat:e,categoryName:t,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){return UI({categoryName:t,categoryType:i,timesBlockArray:[a?.matchUpAverageTimes&&vI({...a,matchUpFormat:e}),n?.matchUpAverageTimes&&vI({...n,matchUpFormat:e}),o?.matchUpAverageTimes&&vI({...o,matchUpFormat:e}),o?.defaultTimes?.averageTimes,r?.averageTimes]})}(e),r=Object.keys(i?.minutes||{}),n=i?.minutes&&(r?.includes(t)&&i.minutes[t]||i.minutes.default),a=function({tournamentScheduling:e,eventScheduling:t,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){return UI({categoryName:a,categoryType:o,timesBlockArray:[t?.matchUpRecoveryTimes&&SI({...t,averageMinutes:i,matchUpFormat:n}),e?.matchUpRecoveryTimes&&SI({...e,averageMinutes:i,matchUpFormat:n}),s?.matchUpRecoveryTimes&&SI({...s,averageMinutes:i,matchUpFormat:n}),s?.defaultTimes?.recoveryTimes,r?.recoveryTimes]})}({...e,averageMinutes:n}),o=Object.keys(a?.minutes||{}),s=a?.minutes&&(o?.includes(t)&&a.minutes[t]||a.minutes.default),c=yI(mu)(t)?wI:bI;return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:a?.minutes&&(o?.includes(c)&&a.minutes[c]||s)}}function FI(e){return e.createdAt?new Date(e.createdAt).getTime():0}function LI({timeItems:e,itemType:t}){let i=e.filter((e=>e&&e.itemType===t)).sort(((e,t)=>FI(e)-FI(t))).pop(),r=i&&FI(i);return{itemValue:i?.itemValue,timeStamp:r}}function _I({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:r,timeStamp:n}=LI({timeItems:i?.timeItems||[],itemType:Jg});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{scheduledTime:r}:t}function BI({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:r,timeStamp:n}=LI({timeItems:i?.timeItems||[],itemType:Yg});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{scheduledDate:r}:t}function VI(e){if(Rc.test(e)){let t=Lc();return new Date(`${t}T${e}`)}return new Date(e)}function jI(e){let t=(e,t=2)=>("00"+e).slice(-t);return t(e/36e5|0)+":"+t(e%36e5/6e4|0)+":"+t(e%6e4/1e3|0)}function $I(e){let{disableNotice:t,venue:i,context:r}=e;if("object"!=typeof i)return{error:Ho};let n,a=sh(e);i.venueId||(i.venueId=Ud());for(let o of Object.values(a)){let e=GI({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(e?.error)return e;n=e.venue}return t||As({topic:Uf,payload:{venue:i}}),Js({..._r,venue:n})}function GI({tournamentRecord:e,disableNotice:t,context:i,venue:r}){return e?r?(e.venues||(e.venues=[]),r.venueId||(r.venueId=Ud()),e.venues.reduce(((e,t)=>e||t.venueId===r.venueId),void 0)?{error:bo}:(i&&Vp({element:r,extension:{value:i,name:Zp}}),e.venues.push(r),{..._r,venue:yd(r)})):{error:va,info:"missing venue"}:{error:zr}}function WI({tournamentRecords:e,tournamentRecord:t,venueId:i}){if(!t)return{error:zr};if(!i)return{error:To};let r=(t.venues??[]).reduce(((e,t)=>t.venueId===i?t:e),void 0);if(!r&&e){let n=(Em({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let a of n){let n=WI({tournamentRecord:e[a],venueId:i});if(n.success&&n.venue)return $I({tournamentRecord:t,venue:n.venue}),{..._r,venue:r}}}return r?{..._r,venue:r}:{error:wo}}function qI({convertExtensions:e,...t}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=t;return yd(WI({tournamentRecords:i,tournamentRecord:r,venueId:n}),e,!0)}function HI({tournamentRecords:e,tournamentRecord:t,courtId:i}){if(!t)return{error:zr};if(!i)return{error:ya};let r,n;if((t.venues??[]).forEach((e=>{(e.courts??[]).forEach((t=>{t.courtId===i&&(r=t,n=e)}))})),r)return{..._r,court:r,venue:n};if(e){let a=(Em({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let o of a){let a=HI({tournamentRecord:e[o],courtId:i});if(a.success)return a.venue&&$I({tournamentRecord:t,venue:a.venue}),{..._r,court:r,venue:n}}}return Qs({result:{error:yo},stack:"findCourt"})}function zI(e){return yd(HI(e),!1,!0)}function YI({tournamentRecord:e,internalUse:t,courtId:i}){if(!e)return{error:zr};if(!i)return{error:ya};let r=HI({tournamentRecord:e,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:e,courtId:t,courtName:i,courtDimensions:r,latitude:n,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:c,pace:d,notes:u})=>({altitude:e,courtId:t,courtName:i,courtDimensions:r,latitude:n,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:c,pace:d,notes:u}))(r.court);return{..._r,courtInfo:yd(n,!1,t)}}function KI(e){let t=dp(e,[{[Tl]:!0},{venueId:!0,[Yl]:To}]);if(t.error)return t;let{tournamentRecord:i,venueId:r}=e,n=WI({tournamentRecord:i,venueId:r});if(n.error)return n;let a=(n.venue?.courts??[]).map((e=>(({courtInfo:e})=>({...e}))(YI({courtId:e.courtId,internalUse:!0,tournamentRecord:i})))),o=n.venue&&(({venueId:e,venueName:t,venueAbbreviation:i})=>({venueAbbreviation:i,venueName:t,venueId:e}))(n.venue),s=o&&{...o,courtsInfo:a};return{..._r,venueData:yd(s,!1,!0)}}function XI({event:e,eventId:t}){if(!e)return{error:Fn};let i=Jp({name:sm,element:e})?.extension,r=t?yd(i?.value,!1,!0):i?.value;return t&&e.drawDefinitions?.forEach((e=>{r?.flights?.forEach((t=>{t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})}))})),{flightProfile:r}}function JI(e){let t,{tournamentRecord:i,eventId:r,drawId:n}=e,a="findEvent",o={},s=e.tournamentRecords??(i&&{[i.tournamentId]:i})??{},c=Object.values(s).map((({events:e,tournamentId:t})=>(e&&e.forEach((e=>{o[e.eventId]={tournamentId:t}})),e??[]))).flat();if(n){let e,i=c.find((i=>{let r=(i?.drawDefinitions??[]).find((e=>e.drawId===n));if(r)e=r,t=o[i.eventId].tournamentId;else{let e=(i&&XI({event:i})?.flightProfile)?.flights?.find((e=>e.drawId===n));if(e)return t=o[i.eventId].tournamentId,{entries:e.drawEntries,drawName:e.drawName,tournamentId:t,drawId:n}}return r}));if(i)return{event:i,drawDefinition:e,tournamentId:t}}if(r){let e=c.find((e=>e?.eventId===r));return e?(t=o[e.eventId].tournamentId,{event:e,drawDefinition:void 0,tournamentId:t}):{event:void 0,drawDefinition:void 0,...Qs({result:{error:Ln},stack:a})}}return{event:void 0,drawDefinition:void 0,...Qs({result:{error:Zr},context:{drawId:n,eventId:r},stack:a})}}function QI(e){let t=e.event,i=e.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:c,publishStatus:d,matchUp:u}=e;if(!u)return{error:sa};if(n&&!u.matchUpType&&!e.matchUpType&&(t||a)&&u.drawId){let r=e.drawDefinition||t?.drawDefinitions?.find((e=>e.drawId===u.drawId));!r&&a&&({drawDefinition:r,event:t}=JI({drawId:u.drawId,tournamentRecord:a}));let n=u.structureId&&r?.structures?.find((({structureId:e})=>e===u.structureId));i=e.matchUpType||n?.matchUpType||r?.matchUpType||t?.eventType!==gu&&t?.eventType}let l,{milliseconds:p,time:m}=function({matchUp:e}){if(!e)return{error:sa};if(!e.timeItems)return{error:ko};let t=e.timeItems.filter((e=>[Qg,Zg,eI,tI].includes(e?.itemType))).sort(((e,t)=>VI(e.itemValue).getTime()-VI(t.itemValue).getTime())),i=t.reduce(((e,t)=>{let i,r=t?.itemType?.split("."),n=`SCHEDULE.TIME.${t?.itemType?.startsWith("SCHEDULE.TIME")&&r[2]}`;switch(n){case Qg:i=0;break;case tI:if(e.lastValue&&[Qg,eI].includes(e.lastType)){let r=VI(t.itemValue).getTime()-VI(e.lastValue).getTime();i=e.milliseconds+r}else i=e.milliseconds;break;case Zg:if([Qg,"SCHECULE.TIME.RESUME"].includes(e.lastType)){let r=VI(t.itemValue).getTime()-VI(e.lastValue).getTime();i=e.milliseconds+r}else i=e.milliseconds;break;default:i=e.milliseconds}return{milliseconds:i,lastType:n,lastValue:t.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([Qg,eI].includes(i.lastType)){let e=(new Date).getTime()-VI(i.lastValue).getTime();i.milliseconds+=e}return{milliseconds:i.milliseconds,time:jI(i.milliseconds),relevantTimeItems:t}}({matchUp:u}),{startTime:f}=function({matchUp:e}){let t=e?.timeItems||[],i=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{startTime:t.reduce(((e,t)=>{let r=t.itemType===Qg&&t;return r&&(!e||i(r)<i(e))?r:e}),void 0)?.itemValue}}({matchUp:u}),{endTime:h}=function({matchUp:e}){let t=e?.timeItems||[],i=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{endTime:t.reduce(((e,t)=>{let r=t.itemType===tI&&t;return r&&(!e||i(r)>i(e))?r:e}),void 0)?.itemValue}}({matchUp:u}),{eventIds:g,drawIds:I}=r??{};if(g&&!g.includes(u.eventId)||I&&!I.includes(u.drawId))l=Js({milliseconds:p,startTime:f,endTime:h,time:m});else{let e=e=>e.createdAt?new Date(e.createdAt).getTime():0,t=new Map,r=u.timeItems?.toSorted(((t,i)=>e(t)-e(i)))??[];for(let i of r)t.set(i.itemType,i.itemValue);let o,d,g,I,y,v=t.get(Kg),S=t.get(qg),U=t.get(Jg),b=t.get(iI),w=t.get(Yg),T=t.get(Xg),D=t.get(zg),P=t.get(Wg),N=t.get(Hg),E=u.matchUpType??i;if(s&&U&&n&&E){let e={matchUpFormat:u.matchUpFormat??c,...s};({averageMinutes:d=0,recoveryMinutes:g=0,typeChangeRecoveryMinutes:I=0}=xI({timingDetails:e,eventType:E})),(d||g)&&(o=h?id(zc(h),g):id(U,d+g)),I&&(y=h?id(zc(h),I):id(U,d+I))}!w&&U&&(w=Yc(U));let M=kc({scheduledDate:w,scheduledTime:U}),R={},C=(a&&P&&KI({tournamentRecord:a,venueId:P}))?.venueData||{};P&&(R[P]=C);let{venueName:A,venueAbbreviation:k,courtsInfo:O}=C,x=(N&&O?.find((e=>e.courtId===N)))?.courtName;for(let i of S||[]){if(!a)break;i.venueId&&!R[i.venueid]&&(R[i.venueId]=KI({venueId:i.venueId,tournamentRecord:a})?.venueData);let e=R[i.venueId];i.venueName=e?.venueName;let t=e?.courtsInfo?.find((e=>e.courtId===i.courtId));i.courtName=t?.courtName}l=Js({typeChangeTimeAfterRecovery:y,timeAfterRecovery:o,scheduledDate:w,scheduledTime:U,isoDateString:M,homeParticipantId:v,venueAbbreviation:k,allocatedCourts:S,timeModifiers:b,venueName:A,venueId:P,courtOrder:D,courtName:x,courtId:N,official:T,typeChangeRecoveryMinutes:I,recoveryMinutes:g,averageMinutes:d,milliseconds:p,startTime:f,endTime:h,time:m})}let{scheduledDate:y}=BI({matchUp:u}),{scheduledTime:v}=_I({matchUp:u});if(o&&d?.displaySettings?.draws){let e=d.displaySettings.draws,t=(e?.[u.drawId]??e?.default)?.scheduleDetails;if(t){let e=(t.find((e=>y&&e.dates?.includes(y)))??t.find((e=>!e.dates?.length)))?.attributes;if(e){l=yp({source:l,template:Object.assign({},...Object.keys(l).map((e=>({[e]:!0}))),e)})}}}return{schedule:l,endDate:u.matchUpStatus&&af.includes(u.matchUpStatus)&&(Yc(h)||Yc(y)||Yc(v))||void 0}}function ZI({collectionPosition:e,collectionId:t,lineUp:i}){let r=[],n=[];if(i){let a=e=>void 0===e?-1:e,o=i.map((i=>{let{collectionAssignments:r,participantId:n}=i,a=r?.find((i=>i.collectionPosition===e&&i.collectionId===t));return a&&{participantId:n,...a}})).filter(Boolean).sort(((e,t)=>a(e.substitutionOrder)-a(t.substitutionOrder)));for(let e of o){let{participantId:t,previousParticipantId:i,substitutionOrder:a}=e;r.includes(t)||(i&&n.push({previousParticipantId:i,substitutionOrder:a,participantId:t}),r=r.filter((e=>e!==i)),r.push(t))}}return{assignedParticipantIds:r,substitutions:n}}function ey({tournamentParticipants:e,tournamentRecord:t,participantIds:i}){let r="getPairedParticipant";if(!e&&!t)return{error:zr};if(!Array.isArray(i)||i.length>2)return{error:Va};if(!i.length)return Qs({result:{error:Ja},stack:r});let n=(e=e??t?.participants??[]).filter((e=>e.participantType===fh&&yr(i,e.individualParticipantIds).length===i.length&&e.individualParticipantIds.length===i.length)),a=n[0];if(!a)return Qs({result:{error:Ya},stack:r});let o=yd(n.slice(1),!1,!0);return{participant:yd(a),duplicatedPairParticipants:o,..._r}}function ty({drawDefinition:e,participantId:t}){if("object"!=typeof e)return{error:Jr};if("string"!=typeof t)return{error:Ha};let{extension:i}=Jp({element:e,name:dm});return{lineUp:(i?.value||{})[t]}}function iy(e){let t=dp(e,[{[Hl]:!0}]);if(t.error)return t;let i=e?.matchUp,r=i?.matchUpType;if(!r&&i?.sides?.length){let e=i.sides.find((({participant:e})=>e))?.participant?.participantType;r=e===ph&&Bi||e===fh&&ji||e===hh&&hh||void 0}return{matchUpType:r}}function ry({drawPositionCollectionAssignment:e,sideNumberCollectionAssignment:t,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){let c=i.find((e=>e.drawPosition&&e.drawPosition===a)),d=a&&e,u=s&&t,l=d?d[a]?.participantId:c?.participantId,p=c?function({displaySideNumber:e,seedAssignments:t,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:e,sideNumber:n};if(i){let e=function({seedAssignments:e,participantId:t}){return e?.find((e=>!e.seedProxy&&e.participantId===t))}({seedAssignments:t,participantId:i});Object.assign(a,e,{participantId:i}),e?.seedNumber&&""===e?.seedValue&&(a.seedValue="~")}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}({displaySideNumber:r,seedAssignments:n,participantId:l,assignment:c,sideNumber:s}):{...u?.[s]};if(o&&(1===s?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&d){let e=d[a]?.teamParticipant,t=d[a]?.participant,i=d[a]?.substitutions;t&&(p.participant=t),i&&(p.substitutions=i),e&&(p.teamParticipant=e)}return p}function ny({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,tournamentParticipants:i,positionAssignments:r,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:c,roundNamingProfile:d,tournamentRecord:u,tieDrawPositions:l,appliedPolicies:p,isCollectionBye:m,seedAssignments:f,usePublishState:h,participantMap:g,contextContent:I,scheduleTiming:y,contextProfile:v,drawDefinition:S,publishStatus:U,scoringActive:b,matchUpTieId:w,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:N,context:E,matchUp:M,event:R}){c=c??{};let C=Ug({drawDefinition:S,structure:N,matchUp:M,event:R})?.tieFormat,{roundOffset:A,structureId:k,structureName:O,stage:x,stageSequence:F}=N,{drawId:L,drawName:_,drawType:B}=S??{},V=C?.collectionDefinitions,j=M.collectionId&&V?.find((e=>e.collectionId===M.collectionId)),$=M.collectionId?j?.matchUpFormat:M.matchUpFormat??N?.matchUpFormat??S?.matchUpFormat??R?.matchUpFormat,G=M.matchUpType||j?.matchUpType||N?.matchUpType||S?.matchUpType||!yI(gu)(R?.eventType)&&R?.eventType,W=m?"BYE":M.matchUpStatus,{schedule:q,endDate:H}=QI({scheduleVisibilityFilters:e,afterRecoveryTimes:o,tournamentRecord:u,usePublishState:h,scheduleTiming:y,drawDefinition:S,matchUpFormat:$,publishStatus:U,matchUpType:G,matchUp:M,event:R}),z=l??M.drawPositions??[],{collectionPosition:Y,collectionId:K,roundPosition:X}=M,J=M.roundNumber??c.roundNumber,Q=K?function({tournamentParticipants:e,positionAssignments:t,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:c}){if(!o||!i)return{};let d=({attribute:t,lineUp:r,teamParticipant:a})=>{let{assignedParticipantIds:s,substitutions:d}=ZI({collectionPosition:i,collectionId:o,lineUp:r});if(c!==ji){let e=s?.[0];return e&&{[t]:{participantId:e,teamParticipant:a,substitutions:d}}}if(s?.length<=2){let i=n?.[s[0]]?.pairIdMap?.[s[1]],r=(i&&n[i]?.participant||ey({participantIds:s,tournamentParticipants:e}).participant)?.participantId;return{[t]:{participantId:r,teamParticipant:a,substitutions:d}}}if(s?.length>2)return{[t]:{teamParticipant:a,substitutions:d}}};if(!r?.length){let e=s?.map((e=>{let{teamParticipant:t,sideNumber:i}=e,r=e.lineUp||ty({participantId:t.teamParticipantId,drawDefinition:a})?.lineUp;return d({attribute:i,lineUp:r,teamParticipant:t})})).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...e)}}let u=r?.map((i=>{let r=t.find((e=>e.drawPosition===i))?.participantId,o=s?.find((e=>e?.drawPosition===i)),c=o?.teamParticipant||r&&n?.[r]?.participant||e?.find((({participantId:e})=>e===r)),u=o?.lineUp||ty({participantId:r,drawDefinition:a})?.lineUp;return d({attribute:i,lineUp:u,teamParticipant:c})})).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}({tournamentParticipants:i,positionAssignments:r,collectionPosition:Y,participantMap:g,drawDefinition:S,drawPositions:z,collectionId:K,sideLineUps:P,matchUpType:G}):void 0,Z=d?.[J]?.roundName||c.roundName,ee=d?.[J]?.abbreviatedRoundName||c.abbreviatedRoundName,te=D?.[J]?.feedRound,ie=D?.[J]?.preFeedRound,re=D?.[J]?.roundFactor,ne=n?.[J],ae=X?ne?.[X]:void 0,oe=t?.[J],se=j?.category?{...E?.category,...j.category}:E?.category??R?.category,ce=M.processCodes?.length&&M.processCodes||j?.processCodes?.length&&j?.processCodes||N?.processCodes?.length&&N?.processCodes||S?.processCodes?.length&&S?.processCodes||R?.processCodes?.length&&R?.processCodes||u?.processCodes,de=v?.withCompetitiveness&&Vg({...I,matchUp:M}),ue=M.finishingPositionRange??c.finishingPositionRange,le=x!==Su&&ir(s)&&s+(J||0),pe=e=>Js(e,void 0,!0),me={...pe(E),...pe({matchUpFormat:G===gu?void 0:$,tieFormat:G===gu?C:void 0,gender:j?.gender??R?.gender,endDate:M.endDate??H,discipline:R?.discipline,category:se,finishingPositionRange:ue,abbreviatedRoundName:ee,drawPositionsRange:ae,competitiveProfile:de,structureName:O,stageSequence:F,drawPositions:z,matchUpStatus:W,processCodes:ce,isRoundRobin:T,matchUpTieId:w,preFeedRound:ie,matchUpType:G,roundFactor:re,roundOffset:A,structureId:k,roundNumber:J,roundOfPlay:le,feedRound:te,roundName:Z,drawName:_,drawType:B,schedule:q,drawId:L,stage:x}),...yd(pe(M),!0,!0)};if($&&M.score?.scoreStringSide1){let e=Uc($),{bestOf:t,finalSetFormat:i,setFormat:r}=e??{};(i?.tiebreakSet||r?.tiebreakSet||r?.timed)&&(me.score.sets=me.score.sets.sort(((e,t)=>e.setNumber-t.setNumber)).map(((e,n)=>{let a=n+1===t&&i?i:r,o=a?.tiebreakSet&&!a?.timed,s=a?.timed;return o?(e.tiebreakSet=!0,[1,2].includes(e.winningSide)&&(e.side1Score=1===e.winningSide?1:0,e.side2Score=2===e.winningSide?1:0)):s&&(e.timed=!0),e})))}if(Array.isArray(z)){let{orderedDrawPositions:e,displayOrder:t}=function({drawPositions:e,roundProfile:t,roundNumber:i}){let r=[void 0,void 0];if(Pr(e))return{orderedDrawPositions:r,displayOrder:r};let n=t?.[i],a=n?.pairedDrawPositions?.find((t=>Sr(t||[],e.filter(Boolean))))??r,o=n?.feedRound;if(Dr(e)){let t=[...e].sort(Hi);return{orderedDrawPositions:2===t.length?t:a,displayOrder:o?t:a}}if(o){let t=[e.find((e=>!isNaN(zi(e)))),void 0];return{orderedDrawPositions:t,displayOrder:t}}return{orderedDrawPositions:a,displayOrder:a}}({drawPositions:z,roundProfile:D,roundNumber:J}),i=D?.[J]?.feedRound,n=t[0]!==e[0],a=e.concat(void 0,void 0).slice(0,2).map(((e,t)=>{let a=t+1,o=ry({...Q,positionAssignments:r,displaySideNumber:n?3-a:a,seedAssignments:f,drawPosition:e,isFeedRound:i,sideNumber:a}),s=M.sides?.find((e=>e.sideNumber===a)),c=X?2*(X-1)+t+1:void 0;return pe({sourceDrawPositionRange:c?oe?.[c]:void 0,...s,...o})}));Object.assign(me,yd({sides:a},!0,!0))}if(i&&me.sides){let e=p?.[Pp],t=t=>{let i=g?.[t]?.participant;return i&&yp({template:e?.participant,source:i})};if(me.sides.filter(Boolean).forEach((e=>{if(e.participantId){let r=yd(t(e.participantId)||(i?xp({policyDefinitions:p,participantId:e.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:v}):void 0),void 0,!0);if(r){let t,i;if(S?.entries){let n=S.entries.find((t=>t.participantId===e.participantId)),a=R?.entries?.find((t=>t.participantId===e.participantId));t=n?.entryStatus||a?.entryStatus,r.entryStatus=t,n?.entryStage&&(i=n.entryStage,r.entryStage=i)}!1===a?Object.assign(e,{participant:{entryStage:i,entryStatus:t}}):Object.assign(e,{participant:r})}}if(e?.participant?.individualParticipantIds?.length&&!e.participant.individualParticipants?.length){let r=e.participant.individualParticipantIds.map((e=>t(e)||(i?xp({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:v,participantId:e}):void 0)));!1!==a&&Object.assign(e.participant,{individualParticipants:r})}})),!me.matchUpType){let{matchUpType:e}=iy({matchUp:me});e&&Object.assign(me,{matchUpType:e})}if(v?.inferGender&&(!me.gender||me.gender===tc)&&2===me.sides?.length&&me.matchUpType!==gu){let e=me.sides.map((e=>{if(yI(Bi)(me.matchUpType))return e.participant?.person?.sex;if(2===e.participant?.individualParticipants?.length){let t=ar(e.participant.individualParticipants.map((e=>e.person?.sex))).filter(Boolean);if(1===t.length)return t[0]}}));if(2===e.filter(Boolean).length&&1===ar(e).length){let t=e[0];me.inferredGender=t}}}if(me.tieMatchUps){let a="BYE"===me.matchUpStatus,o=me.sides?.map((({participant:e,drawPosition:t,sideNumber:i,lineUp:r})=>{let n=e?.participantType===gu&&e;return{teamParticipant:n&&Js({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participanOthertName,participantName:n.participantName,participantId:n.participantId,teamId:n.teamId}),drawPosition:t,sideNumber:i,lineUp:r}}));me.tieMatchUps=me.tieMatchUps.map((c=>{let l=me.matchUpId,m={finishingPositionRange:me.finishingPositionRange,abbreviatedRoundName:ee,roundNumber:J,roundName:Z};return ny({tieDrawPositions:z,scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,sideLineUps:o,drawPositionsRanges:n,initialRoundOfPlay:s,roundNamingProfile:d,additionalContext:m,appliedPolicies:p,isCollectionBye:a,usePublishState:h,publishStatus:U,matchUpTieId:l,isRoundRobin:T,roundProfile:D,matchUp:c,event:R,tournamentParticipants:i,positionAssignments:r,tournamentRecord:u,seedAssignments:f,participantMap:g,contextContent:I,scheduleTiming:y,contextProfile:v,drawDefinition:S,scoringActive:b,structure:N,context:E})}))}let fe=2===me.sides?.filter((e=>e?.participantId)).length,he=!me.winningSide;if(Object.assign(me,{readyToScore:b&&fe&&he,hasContext:!0}),fe){let{allParticipantsCheckedIn:e,checkedInParticipantIds:t}=II({matchUp:me});Object.assign(me,{allParticipantsCheckedIn:e,checkedInParticipantIds:t})}return Array.isArray(v?.exclude)&&v?.exclude.forEach((e=>delete me[e])),me}function ay(e){if(!Array.isArray(e.matchUps))return[];let{matchUps:t,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:c,matchUpFormat:d,collectionIds:u,isMatchUpTie:l,roundNumbers:p,matchUpIds:m,roundNames:f,filterMatchUpTypes:h=!0,filterMatchUpIds:g=!0,stageSequences:I,scheduledDates:y,scheduledDate:v,participantIds:S,processContext:U,tournamentIds:b,matchUpTypes:w,structureIds:T,readyToScore:D,courtIds:P,eventIds:N,venueIds:E,drawIds:M,stages:R}=e,C=Array.isArray(S)?S.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],k=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(R)?R.filter(Boolean):[],x=Array.isArray(I)?I.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],L=Array.isArray(f)?f.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],B=Array.isArray(c)?c.filter(Boolean):[],V=Array.isArray(m)&&g?m.filter(Boolean):[],j=Array.isArray(w)&&h?w.filter(Boolean):[],$=Array.isArray(P)?P.filter(Boolean):[],G=Array.isArray(E)?E.filter(Boolean):[],W=Array.isArray(s)&&s.filter(Boolean)||"string"==typeof d&&[d]||[],q=Array.isArray(y)&&y.filter(Boolean)||"string"==typeof v&&v.length&&[v]||[],H=Array.isArray(b)?b.filter(Boolean):[],z=Array.isArray(N)?N.filter(Boolean):[],Y=Array.isArray(M)?M.filter(Boolean):[],K=Array.isArray(T)?T.filter(Boolean):[];return t.filter((e=>{if(D&&!yI($i)(e)&&!e.readyToScore||e.winningSide&&o&&![1,2].includes(e.winningSide)||void 0!==l&&(l&&!e.tieMatchUps||!l&&e.tieMatchUps)||void 0!==n&&(n&&!e.collectionId||!n&&e.collectionId)||O.length&&!O.includes(e.stage)||x.length&&!x.includes(e.stageSequence)||F.length&&(!e.collectionId||!F.includes(e.collectionId))||L.length&&(!e.roundName||!L.includes(e.roundName))||_.length&&(!e.roundNumber||!_.includes(e.roundNumber))||B.length&&(!e.roundPosition||!B.includes(e.roundPosition))||A.length&&(!e.matchUpStatus||!A.includes(e.matchUpStatus))||k.length&&e.matchUpStatus&&k.includes(e.matchUpStatus)||V.length&&!V.includes(e.matchUpId)||j.length&&(!e.matchUpType||!Lr(j,e.matchUpType))||W.length&&(!e.matchUpFormat||!W.includes(e.matchUpFormat)))return!1;if(q?.length){let{scheduledTime:t}=_I({matchUp:e}),{scheduledDate:i}=BI({matchUp:e}),r=Yc(t)||i;if(!q.find((e=>ad(e,r))))return!1}if($.length){let{courtId:t}=function({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:r,timeStamp:n}=LI({timeItems:i?.timeItems||[],itemType:Hg});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{courtId:r}:t}({matchUp:e}),{allocatedCourts:i}=function({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:r,timeStamp:n}=LI({timeItems:i?.timeItems||[],itemType:qg});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{allocatedCourts:yd(r,!1,!0)}:t}({matchUp:e}),r=i?.map((({courtId:e})=>e));if(!$.filter(Boolean).includes(t)||r?.includes(t))return!1}if(G.length){let{venueId:t}=function({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:r,timeStamp:n}=LI({timeItems:i?.timeItems||[],itemType:Wg});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{venueId:r}:t}({matchUp:e});if(!G.filter(Boolean).includes(t))return!1}if(U){if(H.length&&!H.includes(e.tournamentId)||z.length&&!z.includes(e.eventId)||Y.length&&!Y.includes(e.drawId)||K.length&&!K.includes(e.structureId))return!1;let t=e.sides?.map((({participantId:e})=>e)).filter(Boolean)??[];if(r&&t.length<r||C.length&&!C.some((e=>t.includes(e))))return!1}return!0}))}function oy(e){let{provisionalPositioning:t,tournamentRecord:i,contextFilters:r,matchUpFilters:n,contextProfile:a,drawDefinition:o,context:s={},structure:c,inContext:d,event:u}=e,{seedAssignments:l,contextContent:p,exitProfiles:m,matchUpsMap:f}=e,h={},g={};if(!c)return{collectionPositionMatchUps:h,error:An,roundMatchUps:g,matchUps:[]};let I=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],y=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],v=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],S=!s?.eventId||!I?.length&&!r?.eventIds?.filter(Boolean).length||I?.includes(s.eventId)||r?.eventIds?.includes(s.eventId),U=!y?.length||y.includes(c.structureId),b=!o||!v?.length||v.includes(o.drawId);if(!S||!U||!b)return{collectionPositionMatchUps:h,roundMatchUps:g,matchUps:[]};a&&!p&&(p=qh({tournamentRecord:i,contextProfile:a,drawDefinition:o}));let{appliedPolicies:w}=Fh({drawDefinition:o}),T={...e.tournamentAppliedPolicies,...w,...e.policyDefinitions},D=T?.scoring?.structures,P=c.stage&&D?.stage?.[c.stage],N=c.stageSequence&&P?.stageSequence?.[c.stageSequence],E=T?.scoring?.requireAllPositionsAssigned||P?.requireAllPositionsAssigned||N?.requireAllPositionsAssigned;f||(f=bg({drawDefinition:o,structure:c}));let{positionAssignments:M,allPositionsAssigned:R}=hf({structure:c}),C=!E||R,{seedAssignments:A}=yg({provisionalPositioning:t,drawDefinition:o,structure:c});l=l??A;let{structureId:k}=c;m=m||o&&Mg({drawDefinition:o}).exitProfiles;let O=m?.[k],x=O?.length&&(O[0].split("-").map((e=>parseInt(e))).reduce(((e,t)=>e+t))||0),F=!!c.structures,L=wg({matchUpsMap:f,structureId:k,inContext:d}),_=T?.[Dp],B=Og({roundNamingPolicy:_,drawDefinition:o,structure:c,matchUps:L}),{roundNamingProfile:V,roundProfile:j}=B;if(g=B?.roundMatchUps??[],n&&(L=ay({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),d){let{sourceDrawPositionRanges:t}=function({drawDefinition:e,structureId:t,matchUpsMap:i}){if(!e)return{error:Jr};if(!t)return{error:Mn};let{structure:r}=lf({drawDefinition:e,structureId:t});if(r?.stage!==Uu)return{error:Gn,info:"Structure is not CONSOLATION stage"};let{links:n}=e,a=n?.filter((e=>e.target.structureId===t))||[],o=a?.reduce(((e,t)=>{let{structureId:i}=t.source;return e.includes(i)?e:e.concat(i)}),[])||[],s=Object.assign({},...o.map((e=>({[e]:Ng({matchUps:wg({structureId:e,matchUpsMap:i})}).roundProfile})))),c=wg({matchUpsMap:i,structureId:t}),{roundProfile:d}=Ng({matchUps:c}),u={};return a?.forEach((e=>{let{structureId:t,roundNumber:i}=e.source,{feedProfile:r,groupedOrder:n,positionInterleave:a,roundNumber:o}=e.target,c=s[t],l=c[1]?.drawPositions,p=c[i]?.matchUpsCount;if(!p)return;let m=p?l.length/p:0,f=l.length/m,h=l.slice(),g=Tg({roundPositionsCount:f,groupedOrder:n}),I=g?.length||1;if(I<=f){let e=wr(h,l.length/I);r===Bu&&e.forEach((e=>e.reverse())),h=g?.length&&g?.map((t=>e[t-1])).flat()||e.flat()}let y=wr(h,m);if(a){let e=gr(0,a.interleave).map((()=>{})),t=gr(0,a.offset).map((()=>{}));y=y.map((t=>[t,...e])),y.unshift(t),y=y.flat(1);let i=y.length-a.offset;y=y.slice(0,i)}u[o]||(u[o]={});let v=d?.[o]?.feedRound?2:1;y.forEach(((e,t)=>{let i=1+t*v;u[o][i]||(u[o][i]=Eg(e))}))})),{sourceDrawPositionRanges:u}}({drawDefinition:o,matchUpsMap:f,structureId:k}),n=o?function({drawDefinition:e,roundProfile:t,structureId:i,matchUpsMap:r}){if(!e)return{error:Jr};if(!i)return{error:Mn};if(!t){let e=wg({matchUpsMap:r,structureId:i});if(({roundProfile:t}=Ng({matchUps:e})),!t)return{error:va}}let n=(Math.min(...t?.[1]?.drawPositions??[])||1)-1,a=Object.keys(t);return{drawPositionsRanges:Object.assign({},...(a||[]).map((e=>{let i=t?.[e]?.matchUpsCount,r=t?.[1]?.drawPositions??[],o=wr(r,r.length/i),s=o.map(Eg),c=o.map((e=>e.map((e=>e-n)))).map(Eg),d=a.map((r=>{if(r>e)return;let n=t?.[r]?.drawPositions??[];return wr(n,n.length/i)})).filter(Boolean),u=gr(0,i).map((e=>d.map((t=>t[e])).flat().filter(Boolean).sort(Hi))).map((e=>ar(e))),l=u.map((e=>function(e){return e.reduce(((e,t)=>{let i=e[e.length-1];return(!i||i[i.length-1]!==t-1)&&e.push([]),e[e.length-1].push(t),e}),[])}(e).map(Eg).join(", "))),p=Object.assign({},...gr(0,i).map((e=>({[e+1]:{firstRoundDrawPositionsRange:s[e],firstRoundOffsetDrawPositionsRange:c[e],possibleDrawPositions:u[e],drawPositionsRange:l[e]}}))));return{[e]:p}})))}}({drawDefinition:o,roundProfile:j,matchUpsMap:f,structureId:k}).drawPositionsRanges:void 0,m=e.tournamentParticipants,h=e.participantMap;!m?.length&&!h&&i&&({participants:m=[],participantMap:h}=xh({participantsProfile:e.participantsProfile,useParticipantMap:e.useParticipantMap,policyDefinitions:e.policyDefinitions,tournamentRecord:i,contextProfile:a,inContext:d})),L=L.map((r=>ny({scheduleVisibilityFilters:e.scheduleVisibilityFilters,hydrateParticipants:e.hydrateParticipants,afterRecoveryTimes:e.afterRecoveryTimes,usePublishState:e.usePublishState,scheduleTiming:e.scheduleTiming,publishStatus:e.publishStatus,sourceDrawPositionRanges:t,tournamentParticipants:m,positionAssignments:M,drawPositionsRanges:n,initialRoundOfPlay:x,roundNamingProfile:V,tournamentRecord:i,appliedPolicies:T,seedAssignments:l,contextContent:p,participantMap:h,contextProfile:a,drawDefinition:o,scoringActive:C,isRoundRobin:F,roundProfile:j,structure:c,context:s,matchUp:r,event:u}))),(L?.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{let t=e.tieMatchUps;L=L.concat(...t)})),r&&(L=ay({processContext:!0,...r,matchUps:L}))}else(L?.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{let t=e.tieMatchUps;L=L.concat(...t)}));return n&&(L=ay({matchUps:L,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(L=ay({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:L})),(n?.matchUpTypes||n?.matchUpIds||d)&&(g=Ng({matchUps:L}).roundMatchUps??[]),Ug({drawDefinition:o,structure:c,event:u})?.tieFormat&&({collectionPositionMatchUps:h}=function({matchUps:e}){let t=e.reduce(((e,t)=>!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition)),[]).map((t=>({[t]:e.filter((e=>e.collectionPosition===t))})));return{collectionPositionMatchUps:Object.assign({},...t)}}({matchUps:L})),{collectionPositionMatchUps:h,roundMatchUps:g,isRoundRobin:F,roundProfile:j,matchUpsMap:f,matchUps:L}}function sy({matchUp:e}){return!!e&&(af.includes(e?.matchUpStatus)||e?.winningSide)}function cy({requireParticipants:e=!0,scheduleVisibilityFilters:t,tournamentAppliedPolicies:i,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:c,matchUpFilters:d,contextFilters:u,contextContent:l,participantMap:p,scheduleTiming:m,publishStatus:f,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:y,structureId:v,inContext:S,structure:U,context:b,event:w}){!U&&v&&({structure:U}=lf({drawDefinition:g,structureId:v}));let T=oy({tournamentAppliedPolicies:i,scheduleVisibilityFilters:t,tournamentParticipants:r,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:c,matchUpFilters:d,contextFilters:u,contextContent:l,participantMap:p,scheduleTiming:m,publishStatus:f,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:y,structure:U,inContext:S,context:b,event:w}),D=[],P=[],N=[],E=[],M=[];if(T.error)return T;let R,{matchUps:C}=T,{assignedPositions:A}=hf({structure:U}),k=A?.filter((e=>e.participantId)).map((e=>e.drawPosition));return C.filter((e=>{let t=1===d?.matchUpTypes?.length&&d.matchUpTypes[0]===Gi;return!(e.matchUpType!==Gi&&t)})).forEach((t=>{if(t.matchUpStatus===_m)return void D.push(t);t.matchUpType===Gi&&(R=!0);let i=!!t.collectionId,r=i&&t.sides?.every((e=>e.participantId)),n=!i&&2===t.drawPositions?.filter(Boolean).length,a=!i&&t.drawPositions?.every((e=>k?.includes(e))),o=A?.filter((e=>e.bye)).map((e=>e.drawPosition)),s=!i&&t.drawPositions?.find((e=>o?.includes(e))),c=sf.includes(t.matchUpStatus)&&(r||n&&(!e||a));return s?M.push(t):sy({matchUp:t})?P.push(t):c?N.push(t):E.push(t)})),{includesTeamMatchUps:R,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:N,pendingMatchUps:E,byeMatchUps:M,structure:U}}function dy({finishingPositions:e,linkCondition:t,linkType:i,source:r}){let n=r.find((r=>{let n=!r.source?.finishingPositions||!e||Sr(e,r.source?.finishingPositions);return t===r.linkCondition&&n&&r.linkType===i}));return[ju,$u].includes(n?.linkType)&&!n?.source?.roundNumber?Qs({result:{error:Ho},stack:"getTargetLink",context:n}):n}function uy({drawDefinition:e,structureId:t,roundNumber:i}){return e?t?{links:(e.links||[]).filter(Boolean).reduce(((e,r)=>(r.source?.structureId===t&&(!i||r.source.roundNumber===i)&&(e.source=e.source.concat(r)),r.target?.structureId===t&&(!i||r.target.roundNumber===i)&&(e.target=e.target.concat(r)),e)),{source:[],target:[]})}:{error:Mn}:{error:Jr}}function ly({sourceRoundMatchUpCount:e,inContextDrawMatchUps:t,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){if(!n)return{error:Nn};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:d}}=n,{structure:u}=lf({drawDefinition:r,structureId:a}),{positionAssignments:l}=ff({structure:u}),p=(t?.filter((e=>e.structureId===u?.structureId))).filter((e=>e.roundNumber===c&&!e.matchUpTieId)),m=p.length,f=gr(1,m+1),h=m/e,g=Math.ceil(h*i),I=1-i%2;if(d?.interleave&&.5!==h){let e=i+(d.offset+(i-1)*d.interleave);g=Math.ceil(e/2),I=1-e%2}let y=f,v=f[g-1],S=Tg({roundPositionsCount:f.length,groupedOrder:s}),U=S?.length||1;if(U<=f.length){let e=wr(f,m/U);o===Bu&&e.forEach((e=>e.reverse())),y=S?.length&&S?.map((t=>e[t-1])).flat()||y}o===_u?v=y[g-1]:o===Bu?((!S?.length||U>f.length)&&(g=p.length+1-g),v=y[g-1]):o===Lu&&vs()&&console.log(Zo,{feedProfile:o});let b,w=v&&p.reduce(((e,t)=>t.roundPosition===v?t:e),void 0);w?.feedRound?(I=0,b=Math.min(...(w.drawPositions||[]).filter(Boolean))):b=2===w?.drawPositions?.length&&w?.drawPositions[I];let T=l?.find((({drawPosition:e})=>e===b));if(T){let{extension:e}=Jp({element:T,name:rm});if(e?.value)return{disabledDrawPosition:b}}return{matchUp:w,targetDrawPosition:b,matchUpDrawPositionIndex:I}}function py({inContextDrawMatchUps:e=[],useTargetMatchUpIds:t,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;e.length&&!a&&(a=e.find((e=>e.matchUpId===n)));let{structure:o}=lf({structureId:a?.structureId,drawDefinition:r});return o?.finishingPosition===yl?function({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:i,structure:r,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:o}=n,{links:s}=function({drawDefinition:e,roundNumber:t,structureId:i}){if(!e)return{error:Jr};if(!i)return{error:Mn};let{links:r}=uy({drawDefinition:e,structureId:i});return{links:{source:r.source.reduce(((e,i)=>i.source.roundNumber&&i.source.roundNumber!==t?e:e.concat(i)),[]),target:r.target.reduce(((e,i)=>i.target.roundNumber&&i.target.roundNumber!==t?e:e.concat(i)),[])}}}({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),c=s?.source,d=dy({source:c,linkType:ju}),u=dy({linkCondition:Gu,linkType:$u,source:c}),l=dy({source:c,linkType:$u}),p=u&&l;l||(l=u);let m,f,h,g,I,y,v,S,U,b,w=d?.target?.feedProfile,T=l?.target?.feedProfile,D=u?.target?.feedProfile;if(t&&(a||o)&&(v=a&&w!==Fu&&e.find((({matchUpId:e})=>e===a)),g=o&&T!==Fu&&e.find((({matchUpId:e})=>e===o)),v||g))return{matchUp:n,targetLinks:{loserTargetLink:l,winnerTargetLink:d},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v}};let{roundPosition:P}=n;b=b||e.filter((e=>e.structureId===r.structureId));let N=b.reduce(((e,t)=>t.roundNumber!==n.roundNumber||t.matchUpTieId?e:e+1),0);return l&&!g&&T!==Fu&&({matchUpDrawPositionIndex:y,targetDrawPosition:I,matchUp:g}=ly({targetLink:l,sourceRoundMatchUpCount:N,inContextDrawMatchUps:e,sourceRoundPosition:P,drawDefinition:i})),p&&D!==Fu&&({matchUpDrawPositionIndex:h,targetDrawPosition:f,matchUp:m}=ly({targetLink:u,sourceRoundMatchUpCount:N,inContextDrawMatchUps:e,sourceRoundPosition:P,drawDefinition:i})),d&&!v&&w!==Fu&&({matchUpDrawPositionIndex:U,targetDrawPosition:S,matchUp:v}=ly({targetLink:d,sourceRoundMatchUpCount:N,inContextDrawMatchUps:e,sourceRoundPosition:P,drawDefinition:i})),v||(b=b||e.filter((e=>e.structureId===r.structureId)),({matchUp:v}=function({structureMatchUps:e,matchUp:t}){let{roundNumber:i,roundPosition:r}=t,n=e.filter((e=>e.roundNumber===i&&!e.matchUpTieId)),a=e.filter((e=>e.roundNumber===i+1&&!e.matchUpTieId));if(a.length){let e;return a.length===n.length?e=a.find((e=>e.roundPosition===r)):a.length===n.length/2&&(e=a.find((e=>e.roundPosition===Math.ceil(r/2)))),{matchUp:e}}return{message:"no progression found"}}({structureMatchUps:b,matchUp:n}))),Js({matchUp:n,targetLinks:{loserTargetLink:l,winnerTargetLink:d,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:U,loserMatchUpDrawPositionIndex:y,byeMatchUpDrawPositionIndex:h,winnerTargetDrawPosition:S,loserTargetDrawPosition:I,byeTargetDrawPosition:f,winnerMatchUp:v,loserMatchUp:g,byeMatchUp:m},targetMatchUpIds:!(!a&&!o)})}({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:r,structure:o,matchUp:a}):function({matchUp:e}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:e}}({matchUp:a})}function my({drawDefinition:e,inContextDrawMatchUps:t}){let i={};return t.forEach((r=>{let{matchUpId:n,structureId:a,drawPositions:o=[]}=r,{structure:s}=lf({drawDefinition:e,structureId:a});if(s?.finishingPosition===Il){let{roundNumber:e}=r,t=e&&zi(e)+1,i=s.matchUps??[],{roundMatchUps:n}=Ng({matchUps:i});if(t&&n?.[t]){let e=[...o].sort(Hi).map(((e,i)=>{let r=n[t].find((t=>t.drawPositions?.includes(e)));return{matchUpId:r?.matchUpId,roundNumber:t,schedule:r?.schedule,sideNumber:i+1,structureName:s.structureName}}));Object.assign(r,{sidesTo:e})}}else{let a=py({useTargetMatchUpIds:!0,inContextDrawMatchUps:t,inContextMatchUp:r,drawDefinition:e,matchUpId:n}),{winnerMatchUp:o}=a.targetMatchUps,{loserMatchUp:s}=a.targetMatchUps;!r.winnerMatchUpId&&o&&(r.winnerMatchUpId=o.matchUpId),!r.loserMatchUpId&&s&&(r.loserMatchUpId=s.matchUpId);let c=hy({upcomingMatchUp:o}),d=hy({upcomingMatchUp:s});if("BYE"!==r.matchUpStatus&&"BYE"===s?.matchUpStatus){let{matchUp:i}=fy({matchUp:s,drawDefinition:e,inContextDrawMatchUps:t})||{};d=i&&hy({upcomingMatchUp:i})||d}let u=r.schedule?.timeAfterRecovery;if(u&&(c?.schedule?.scheduledTime&&qc(c.schedule.scheduledTime)<qc(u)&&(i[c.matchUpId]=r.matchUpId,c.schedule.scheduleConflict=r.matchUpId),d?.schedule?.scheduledTime&&qc(d.schedule.scheduledTime)<qc(u)&&(i[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:c,loserTo:d}),r.drawPositions?.filter(Boolean).length){let e=a.targetLinks?.loserTargetLink?.linkCondition===Gu,i=function(e){return e?.sides?.map((({participant:e,participantId:t,qualifier:i})=>e||t&&{participantId:t}||i&&{qualifier:i})).filter(Boolean)||[]}(r);if(i.length){let r=km(o?.sides),n=km(s?.sides),c=i.find((({participantId:e})=>r.includes(e)))?[]:i,d=i.find((({participantId:e})=>n.includes(e)))?[]:i;s&&e&&d.length<2&&d.push({bye:!0,tbd:!0}),c?.length&&o&&(!a.targetMatchUpIds&&o&&(o=t.find((({matchUpId:e})=>e===o.matchUpId))),o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(c)),d?.length&&s&&(a.targetMatchUpIds||(o=t.find((({matchUpId:e})=>e===s.matchUpId))),s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(d))}}}})),Object.keys(i).length&&t.forEach((e=>{Object.keys(i).includes(e.matchUpId)&&(e.schedule.scheduleConflict=i[e.matchUpId])})),{scheduleConflictMatchUpIds:i}}function fy({matchUp:e,drawDefinition:t,inContextDrawMatchUps:i}){let{matchUpId:r,matchUpStatus:n,structureId:a}=e||{};if(!e||!a||e?.matchUpStatus===Jm)return{matchUp:e};if("BYE"===n){let n;return e.winnerMatchUpId?n=i.find((({matchUpId:t})=>t===e.winnerMatchUpId)):({winnerMatchUp:n}=py({inContextDrawMatchUps:i,drawDefinition:t,matchUpId:r})?.targetMatchUps||{}),fy({matchUp:n,drawDefinition:t,inContextDrawMatchUps:i})}return{matchUp:void 0}}function hy(e){if(e?.upcomingMatchUp)return(({matchUpId:e,structureId:t,schedule:i,roundNumber:r,roundPosition:n,structureName:a})=>({matchUpId:e,structureId:t,schedule:i,roundNumber:r,roundPosition:n,structureName:a}))(e.upcomingMatchUp)}function gy(e){Object.assign(e,{requireParticipants:!1});let t=Iy(e);if(t.error)return Qs({result:t,stack:"getAllDrawMatchUps"});let{abandonedMatchUps:i,completedMatchUps:r,upcomingMatchUps:n,pendingMatchUps:a,byeMatchUps:o,matchUpsMap:s}=t;return{matchUps:(i??[]).concat(...r??[],...n??[],...a??[],...o??[]),matchUpsMap:s}}function Iy(e){if(!e?.drawDefinition)return{error:Jr};let t,{tournamentParticipants:i,contextContent:r,matchUpsMap:n}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,requireParticipants:s,participantsProfile:c,afterRecoveryTimes:d,policyDefinitions:u,tournamentRecord:l,usePublishState:p,contextFilters:m,matchUpFilters:f,scheduleTiming:h,participantMap:g,publishStatus:I,contextProfile:y,drawDefinition:v,nextMatchUps:S,inContext:U,context:b,event:w}=e,T=[],D=[],P=[],N=[],E=[];y&&!r&&(r=qh({policyDefinitions:u,tournamentRecord:l,contextProfile:y,event:w})),!i?.length&&l&&(i=l?.participants,(U||c?.withGroupings)&&i?.length&&({participantsWithGroupings:i,groupInfo:t}=yh({participants:i,participantsProfile:c})));let{structures:M}=pf({drawDefinition:v});if(!M)return{error:Rn};n||(n=bg({drawDefinition:v}));let R=v&&Mg({drawDefinition:v}).exitProfiles;M.forEach((t=>{let{byeMatchUps:c=[],pendingMatchUps:M=[],upcomingMatchUps:C=[],completedMatchUps:A=[],abandonedMatchUps:k=[]}=cy({matchUpFilters:S?void 0:f,contextFilters:S?void 0:m,inContext:U||S||m,hydrateParticipants:e.hydrateParticipants,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:i,requireParticipants:s,afterRecoveryTimes:d,policyDefinitions:u,tournamentRecord:l,usePublishState:p,contextContent:r,participantMap:g,scheduleTiming:h,publishStatus:I,contextProfile:y,drawDefinition:v,exitProfiles:R,matchUpsMap:n,structure:t,context:b,event:w});T=T.concat(...k),D=D.concat(...A),P=P.concat(...C),N=N.concat(...M),E=E.concat(...c)}));let C=e=>(!f&&!S&&!m||(f&&(e=ay({matchUps:e,...f})),m&&(e=ay({matchUps:e,...m,processContext:!0}))),e),A={abandonedMatchUps:C(T),completedMatchUps:C(D),upcomingMatchUps:C(P),pendingMatchUps:C(N),byeMatchUps:C(E),matchUpsMap:n,..._r,groupInfo:t};if(S){let e="object"==typeof S||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:t,completed:i,upcoming:r,pending:n,bye:a}=e;my({inContextDrawMatchUps:[].concat(...t&&T||[],...i&&D||[],...r&&P||[],...n&&N||[],...a&&E||[]),drawDefinition:v})}return A}function yy(e){let{participants:t=[],contextContent:i,participantMap:r}=e,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:d,tournamentRecord:u,usePublishState:l,contextFilters:p,matchUpFilters:m,contextProfile:f,nextMatchUps:h,inContext:g,context:I,event:y}=e;if(!y)return{error:Fn};let v,{eventId:S,eventName:U,endDate:b,eventType:w,category:T,gender:D,matchUpFormat:P}=y??{},N={...I,...Js({indoorOutDoor:y.indoorOutdoor??u?.indoorOutdoor,surfaceCategory:y.surfaceCategory??u?.surfaceCategory,endDate:y.endDate??u?.endDate,tournamentId:u?.tournamentId,matchUpFormat:P,eventName:U,eventType:w,category:T,eventId:S,gender:D})};if(b&&(N.endDate=b),f&&!i&&(i=qh({policyDefinitions:c,tournamentRecord:u,contextProfile:f,event:y})),!t?.length&&!r&&u){let e=xh({participantsProfile:o,useParticipantMap:d,tournamentRecord:u,contextProfile:f,inContext:g});r=e.participantMap,t=e.participants??[],v=e.groupInfo}let E=y.drawDefinitions??[],M=zh({tournamentRecord:u,event:y}).scheduleTiming;return{matchUps:E.flatMap((e=>{let{matchUps:d}=gy({tournamentParticipants:t,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:N,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:u,usePublishState:l,contextFilters:p,contextProfile:f,drawDefinition:e,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:M,nextMatchUps:h,inContext:g,event:y});return d??[]})),groupInfo:v}}function vy(e){let t=dp(e,[{tournamentRecord:!0}]);if(t.error)return t;if(!e?.tournamentRecord)return{error:zr};let{participantMap:i,participants:r}=e,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:c,tournamentRecord:d,inContext:u=!0,usePublishState:l,contextProfile:p,matchUpFilters:m,contextFilters:f,nextMatchUps:h,context:g}=e,I=e.tournamentId??d.tournamentId,y=d?.events??[];r||({participants:r,participantMap:i}=xh({participantsProfile:a,useParticipantMap:s,tournamentRecord:d,contextProfile:p,inContext:u}));let{appliedPolicies:v}=Fh({tournamentRecord:d}),S={...g,tournamentId:I,indoorOutDoor:d.indoorOutdoor,surfaceCategory:d.surfaceCategory,endDate:d.endDate},U=qh({policyDefinitions:c,tournamentRecord:d,contextProfile:p});return{matchUps:y.flatMap((e=>(S.eventDrawsCount=e.drawDefinitions?.length??0,yy({context:S,scheduleVisibilityFilters:n,tournamentAppliedPolicies:v,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:c,tournamentRecord:d,usePublishState:l,contextContent:U,contextFilters:f,contextProfile:p,matchUpFilters:m,participantMap:i,nextMatchUps:h,participants:r,inContext:u,event:e}).matchUps??[]))).concat(...d.matchUps??[])}}function Sy({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:c,inContext:d}){if("object"!=typeof r||!Object.keys(r).length)return{error:Hr};let u=Object.keys(r).map((u=>{let l=r[u];return vy({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:i,policyDefinitions:n,tournamentRecord:l,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:c,inContext:d}).matchUps??[]})).flat();return{..._r,matchUps:u}}function Uy(e,t){return function(e,t){return(Du[e?.stage]||0)-(Du[t?.stage]||0)}(e,t)||(e?.stageSequence||0)-(t?.stageSequence||0)||e?.roundNumber&&t.roundNumber&&e?.roundNumber-t?.roundNumber||(e?.roundPosition??0)-(t?.roundPosition??0)}function by(e){let t,{participants:i,participantMap:r,contextContent:n}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,participantsProfile:s,afterRecoveryTimes:c,policyDefinitions:d,useParticipantMap:u,tournamentRecord:l,matchUpFilters:p,contextFilters:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,inContext:I,context:y,event:v}=e,{eventId:S,eventName:U,endDate:b,eventType:w,category:T,gender:D,matchUpFormat:P}=v??{},N={...y,surfaceCategory:v?.surfaceCategory??l?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??l?.indoorOutdoor,matchUpFormat:P,eventType:w,eventName:U,category:T,eventId:S,endDate:b,gender:D};return!i?.length&&!r&&l&&({participants:i=[],participantMap:r,groupInfo:t}=xh({participantsProfile:s,useParticipantMap:u,tournamentRecord:l,contextProfile:f,inContext:I})),f&&!n&&(n=qh({policyDefinitions:d,tournamentRecord:l,contextProfile:f,drawDefinition:h,event:v})),{...gy({context:N,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:i,participantsProfile:s,afterRecoveryTimes:c,policyDefinitions:d,tournamentRecord:l,drawDefinition:h,contextContent:n,contextFilters:m,contextProfile:f,matchUpFilters:p,participantMap:r,nextMatchUps:g,inContext:I,event:v}),groupInfo:t}}function wy({element:e,accessor:t}){if("string"!=typeof t)return{values:[]};let i,r=yd(e),n=t.split("."),a=[];!function e({targetElement:t,attributes:r=[],significantCharacters:n}){for(let[s,c]of r.entries())if(t?.[c]){let n=r.slice(s+1);n.length?Array.isArray(t[c])?t[c].forEach((t=>e({targetElement:t,attributes:n}))):o({targetElement:t=t[c],index:s}):(i||(i=t[c]),a.includes(t[c])||a.push(t[c]))}function o({targetElement:e,index:t}){if(e&&t===r.length-1&&["string","number"].includes(typeof e)){let t=n?e.slice(0,n):e;i?a.includes(t)||a.push(t):(i=t,a.push(t))}}}({targetElement:r,attributes:n});let o={value:i};return a.length&&(o.values=a),o}var Ty=e=>t=>e&&"object"==typeof t?Array.isArray(e)&&e.map((e=>({[e]:wy({element:t,accessor:e})?.value})))||"object"==typeof e&&Object.keys(e).map((e=>({[e]:wy({element:t,accessor:e})?.value})))||("string"==typeof e&&wy({element:t,accessor:e}))?.value:void 0,Dy=Ty;function Py({finishingPositionOffset:e=0,finishingPositionLimit:t,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){if(!Pg(a))return[];let{roundProfile:c,roundNumbers:d=[]}=Ng({interpolate:!0,matchUps:a});r=r??Math.max(...d,0);let u=n?r-n:0,l=u&&c?.[r-u]?.matchUpsCount,p=c&&Object.values(c).map(Dy("matchUpsCount")),m=(e,i)=>{let r=Math.min(...e);l&&i&&1===r&&(r=l);let n=Math.max(...e);return t&&n>t&&(n=t),[r,n]},f=c&&Object.assign({},...d.map((t=>{let n=(r??0)+1-t-u,a=c[t].matchUpsCount,d={finishingPositionRange:{},finishingRound:n},l=p?.slice(t-1).reduce(((e,t)=>e+(t||0)),0),f=1+e+(s&&1!==t?i??0:0),h=gr(f,o?f+2*a:l+f+1),g=l+1-a,I=m(h.slice(g)),y=m(h.slice(0,g),!0);return d.finishingPositionRange={loser:I,winner:y},{[t]:d}}))),h=vs({finishingRound:!0});return a.filter(Boolean).forEach((e=>{let t=e.roundNumber&&f[e.roundNumber];h&&!t&&console.log({roundFinishingData:f,matchUp:e}),e.finishingRound=t?.finishingRound,e.finishingPositionRange=t?.finishingPositionRange})),a}function Ny({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:i}){if(!t)return{error:Jr};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(e||({matchUps:e,matchUpsMap:i}=gy({inContext:!0,drawDefinition:t,matchUpsMap:i})),!i?.drawMatchUps.some((e=>e.finishingPositionRange))&&1===t?.structures?.length&&!t?.structures[0].structures){Py({matchUps:i?.drawMatchUps??[]})}return(e??[]).filter((({collectionId:e})=>!e)).forEach((n=>{let{matchUpId:a,structureId:o}=n,s=py({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:a}),{winnerMatchUp:c,loserMatchUp:d}=s.targetMatchUps,u=c?.matchUpId,l=d?.matchUpId,p=wg({matchUpsMap:i,structureId:o}).find((e=>e.matchUpId===a));if(p&&(u&&(r.winnerMatchUpIds[p.matchUpId]=u,Object.assign(p,{winnerMatchUpId:u}),Object.assign(n,{winnerMatchUpId:u})),l&&(r.loserMatchUpIds[p.matchUpId]=l,n.loserMatchUpId=l,p.loserMatchUpId=l,n.finishingPositionRange))){let e=d.finishingPositionRange&&[...n.finishingPositionRange.loser,...d.finishingPositionRange.loser],t=e&&[Math.min(...e),Math.max(...e)];n.finishingPositionRange.loser=t,p.finishingPositionRange.loser=t}})),{inContextDrawMatchUps:e,goesToMap:r}}function Ey(e){let t=sh(e),i=e.matchUps??[],r=e.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:o}=e;if(!Array.isArray(i))return{error:oa};if(!Array.isArray(r))return{error:In};let s=e.matchUpIds?.length?e.matchUpIds:i.map((e=>e.matchUpId));if(!Array.isArray(s))return{error:na};let c={},d={},u={},l={};a&&!Object.keys(t).length&&(t={[a.tournamentId]:a});let p=Object.values(t),m=p.reduce(((e,t)=>e.concat(t.events??[]).map((e=>(e.drawDefinitions||[]).map((e=>e.links||[])))).flat(1/0)),[]).filter((({linkType:e})=>e===Vu)),f=i;if(m.length){f=Sy({nextMatchUps:!0,tournamentRecords:t}).matchUps;let e=m.reduce(((e,t)=>{let i=t.source?.structureId,r=t.target?.structureId;return i&&r&&(u[r]=i),i&&!e.includes(i)&&e.push(i),e}),[]);for(let t of e)c[t]=[];for(let t of f??[]){let i=t.containerStructureId||t.structureId;e.includes(i)&&c[i].push(t.matchUpId)}}let h=e=>{d[e]||(d[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},l[e]=[])},g=(e,t)=>{d[e].matchUpIds.forEach((e=>{d[t].matchUpIds.push(e)})),d[t].matchUpIds.push(e),d[e].dependentMatchUpIds.push(t),n&&d[e].participantIds.forEach((e=>d[t].participantIds.push(e)))},I=e=>{let t=Object.keys(c).length;for(let i of e||[]){let{matchUpId:e,winnerMatchUpId:r,loserMatchUpId:a}=i;if(!s.length||s.includes(e)){if(h(e),n){let{individualParticipantIds:t}=oh(i);d[e].participantIds=t}r&&(h(r),g(e,r),l[r].push(e)),a&&(h(a),g(e,a),l[a].push(e)),d[e].sources.push(l[e]);let o=l[e].map((e=>d[e].sources[0])).flat(),s=l[e].map((e=>d[e].sources[1])).flat();if(d[e].sources.push(o,s),t){let t=i.containerStructureId||i.structureId,r=u[t];if(c[r])for(let i of c[r])h(i),g(i,e),l[i].push(e)}}}};if(o)Ny({drawDefinition:o}),f?.length||(f=by({drawDefinition:o}).matchUps),I(f);else{if(f?.length||(f=Sy({nextMatchUps:!0,tournamentRecords:t}).matchUps),!r.length){let e=p?.length?p.map((({events:e=[]})=>e.map((({drawDefinitions:e=[]})=>e.map((({drawId:e})=>e)))))).flat(1/0):[];e&&(r=e)}for(let e of r){let i=f?.filter((t=>t.drawId===e)).sort(Uy);if(!i?.find((({roundPosition:e})=>!e))){let r=i?.find((({tournamentId:e})=>e)),{drawDefinition:n}=JI({tournamentRecord:t[r?.tournamentId],drawId:e});n&&Ny({drawDefinition:n})}I(i)}}return{positionDependencies:c,matchUpDependencies:d,sourceMatchUpIds:l,matchUps:f,..._r}}function My(e){let t=e?.matchUp,i=e?.score||t?.score,r=i?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:c,side2PointScore:d}=r||{},u=n||a||o||s||c||d;return!!(i?.sets?.length>1||u)}function Ry({matchUpStatus:e}){return rf.includes(e)}function Cy({matchUpStatus:e}){return nf.includes(e)}function Ay({matchUpStatus:e,winningSide:t,tieMatchUps:i,sides:r,score:n}){let a=r?.find((({participantId:e})=>e)),o=i?.filter(Ay)?.length;return My({score:n})||o||t&&a||e&&function({matchUpStatus:e}){return of.includes(e)}({matchUpStatus:e})&&![Gm,Qm,Hm].includes(e)}function ky(e){let{drawDefinition:t,findContainer:i,structureId:r,event:n}=e,a=e.structure,{containedStructures:o}=ah({drawDefinition:t}),s=r&&o[r]||[];if(!a){let e=lf({drawDefinition:t,structureId:r});if(e.error)return e;a=i?e.containingStructure??e.structure:e.structure}if(Cg({structure:a}))return{structure:a,isAdHoc:!0,error:ln};let{matchUps:c}=gy({inContext:!0,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:t,event:n}),d=c?.filter((e=>e.structureId===r||s.includes(e.structureId))),{matchUpDependencies:u}=Ey({drawIds:[t.drawId],matchUps:c,drawDefinition:t}),l=[],p=[],m={},f=[];for(let b of c??[]){if(b.structureId===r||s.includes(b.structureId)){p.push(...b.drawPositions??[]);let e=b.roundNumber;for(let t of(b.drawPositions??[]).filter(Boolean))(!m[t]||e&&m[t]>e)&&(m[t]=e)}Ay(b)&&(f.push(b),l.push(b.matchUpId,...u?.[b?.matchUpId]?.matchUpIds||[]))}let h=ar(p.filter(Boolean)).sort(Hi),g=ar(l),I=ar(d?.map((({matchUpId:e,drawPositions:t})=>g.includes(e)?t:[])).flat().filter(Boolean)).sort(Hi),{positionAssignments:y}=ff({drawDefinition:t,structure:a}),v=y?.filter((e=>e.bye)).map((e=>e.drawPosition)),S=y?.filter((e=>e.qualifier)).map((e=>e.drawPosition)),U=h?.filter((e=>!I.includes(e)))||[];return{allDrawPositions:h,inContextStructureMatchUps:d,drawPositionInitialRounds:m,activeDependentMatchUpIds:g,qualifyingDrawPositions:S,inactiveDrawPositions:U,positionAssignments:y,activeDrawPositions:I,byeDrawPositions:v,activeMatchUps:f,structure:a}}function Oy({drawPosition:e,matchUps:t=[]}){return{initialRoundNumber:t.filter((({drawPositions:t})=>e&&t?.includes(e))).map((({roundNumber:e})=>e)).sort(Hi)[0]}}var xy={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",red:"\x1b[31m",brightred:"\x1b[91m",green:"\x1b[32m",brightgreen:"\x1b[92m",yellow:"\x1b[33m",brightyellow:"\x1b[93m",blue:"\x1b[34m",brightblue:"\x1b[94m",lightblue:"\x1b[105m",magenta:"\x1b[35m",brightmagenta:"\x1b[95m",cyan:"\x1b[36m",brightcyan:"\x1b[96m",white:"\x1b[37m",brightwhite:"\x1b[97m"},Fy=[];function Ly(e,t){Mr(e)&&(e={method:e}),(t||vs())&&Fy.push(e)}function _y(e){let t=Fy.slice().map((e=>{let{color:t,keyColors:i,method:r,newline:n}=e,a=Object.keys(xy).includes(t)?xy[t]:xy.cyan,o=Object.keys(e).filter((e=>!["color","keyColors","method","newline"].includes(e))).map((t=>{let r=i&&Object.keys(i).includes(t)&&xy[i[t]]?xy[i[t]]:xy.brightwhite;return`${xy.white}${t}: ${r}${e[t]}`})).join(", ");return[n?"\n":"",a,r,r?.length<15?"\t\t":"\t",xy.white,o,xy.reset,"\n"].join("")}));t?.length&&console.log(...t)}function By(e){return[Gm,Qm,Km].includes(e)}function Vy({provisionalPositioning:e,isPositionAction:t,tournamentRecord:i,drawDefinition:r,drawPosition:n,loserMatchUp:a,matchUpsMap:o,structureId:s,structure:c,event:d}){if(!r)return{error:Jr};if(c||({structure:c}=lf({drawDefinition:r,structureId:s})),!c)return{error:Rn};s||({structureId:s}=c);let u="assignDrawPositionBye";Ly({method:u,color:"cyan",drawPosition:n}),o??=bg({drawDefinition:r});let{positionAssignments:l}=ff({structure:c}),{activeDrawPositions:p}=ky({drawDefinition:r,structureId:s});if(l?.find((e=>e.drawPosition===n))?.bye)return{..._r};let m=!(!a||!o.drawMatchUps.find((e=>e.loserMatchUpId===a?.matchUpId&&By(e.matchUpStatus))));if(p?.includes(n)&&!m)return{error:dn};let f=l?.find((e=>e.drawPosition===n));if(!f)return{error:ln};let{filled:h,containsBye:g,assignedParticipantId:I}=function(e){let t=e.bye,i=e.qualifier,r=e.participantId;return{containsBye:t,containsQualifier:i,assignedParticipantId:r,filled:t||i||r}}(f);if(g)return{..._r};if(h&&!g&&!m)return Qs({result:{error:nn},stack:u});let y=Fh({tournamentRecord:i,drawDefinition:r,event:d}).appliedPolicies??{},v=gy({inContext:!0,drawDefinition:r,matchUpsMap:o}).matchUps??[],{matchUps:S}=oy({provisionalPositioning:e,drawDefinition:r,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:o,structure:c});if(l?.forEach((e=>{e.drawPosition===n&&(e.bye=!0,m&&(e.participantId=void 0))})),c.structureType===xu)return function({tournamentRecord:e,drawDefinition:t,drawPosition:i,matchUps:r,event:n}){r.forEach((r=>{r.drawPositions?.includes(i)&&$y({eventId:n?.eventId,tournamentRecord:e,drawDefinition:t,matchUp:r})}))}({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:S}),th({tournamentId:i?.tournamentId,drawDefinition:r,structure:c,event:d}),jy({assignedParticipantId:I,isPositionAction:t,appliedPolicies:y,drawDefinition:r,drawPosition:n,structureId:s,stack:u});let{roundProfile:U,roundMatchUps:b}=Ng({matchUps:S}),w=(U&&Object.keys(U).map((e=>parseInt(e))).reverse())?.find((e=>U?.[e].drawPositions?.includes(n))),T=w?b?.[w].find((({drawPositions:e})=>e?.includes(n))):void 0;T&&$y({tournamentRecord:i,drawDefinition:r,matchUp:T,event:d});let D=T?.drawPositions?.find((e=>e!==n));if(T&&D){let e=Gy({sourceDrawPositions:T.drawPositions,matchUpId:T.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:D,tournamentRecord:i,drawDefinition:r,matchUpsMap:o});if(e.error)return e}return th({tournamentId:i?.tournamentId,drawDefinition:r,structure:c,event:d}),jy({assignedParticipantId:I,isPositionAction:t,appliedPolicies:y,drawDefinition:r,drawPosition:n,structureId:s,stack:u})}function jy({assignedParticipantId:e,isPositionAction:t,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:o}){return t&&nh({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:e,drawPosition:n,structureId:a,name:o}}),Qs({result:{..._r},stack:o})}function $y({tournamentRecord:e,drawDefinition:t,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),Jf({tournamentId:e?.tournamentId,eventId:i??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:t,matchUp:r})}function Gy({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){Ly({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:e});let c=a.drawMatchUps.find((e=>e.matchUpId===o)),d=t.find((e=>e.matchUpId===o))?.structureId,{structure:u}=lf({drawDefinition:n,structureId:d}),{positionAssignments:l}=ff({structure:u}),p=l?.filter((e=>e.bye)).map((e=>e.drawPosition)),m=c?.drawPositions?.find((t=>t!==e)),f=m&&p?.includes(m),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:g,winnerMatchUp:I,loserTargetDrawPosition:y}}=py({inContextDrawMatchUps:t,drawDefinition:n,matchUpId:o});if(I&&I.structureId===u?.structureId&&function({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){let c="advanceWinner",d=o.drawMatchUps.find((e=>e.matchUpId===a.matchUpId)),u=t.find((e=>e.matchUpId===a.matchUpId))?.structureId,{structure:l}=lf({drawDefinition:n,structureId:u}),{positionAssignments:p}=ff({structure:l}),m=p?.find((({drawPosition:t})=>t===e))?.bye,f=d.drawPositions?.filter(Boolean),h=p?.filter((e=>f?.includes(e.drawPosition))),g=p?.find((({drawPosition:t})=>t===e)),I=i?.find((t=>t!==e)),y=(I&&h?.find((({drawPosition:e})=>e===I)))?.bye,v=m&&y;if(v&&console.log({isByeAdvancedBye:v}),f?.length>1&&m&&!y)return Qs({result:{error:nn},stack:c});let S=f?.find((t=>t!==e)),U=v,b=[...(d.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),w=b.map((t=>!t&&!U||t===e?(U=!0,e):t)).sort(Hi);if(!U)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:e,existingAssignments:h}),Qs({result:{error:nn},stack:c});let T=p?.find((({drawPosition:e})=>e===S))?.bye,D=p?.find((({drawPosition:t})=>t===e))?.bye;Object.assign(d,{matchUpStatus:D||T?"BYE":Jm,score:void 0,winningSide:void 0,drawPositions:w});let P=d.drawPositions.find((e=>!b.includes(e)));Ly({method:c,color:"brightyellow",changedDrawPosition:P,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),Jf({tournamentId:r?.tournamentId,matchUp:d,eventId:s?.eventId,context:c,drawDefinition:n});let{targetLinks:{loserTargetLink:N},targetMatchUps:{loserMatchUp:E,loserTargetDrawPosition:M}}=py({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:n});if(T||D){let i=T?e:S;if(i)Gy({drawPositionToAdvance:i,matchUpId:a.matchUpId,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(D&&N&&E)if(E.feedRound)Wy({loserTargetDrawPosition:M,tournamentRecord:r,loserTargetLink:N,drawDefinition:n,loserMatchUp:E,matchUpsMap:o});else{let e=1-a.roundPosition%2,t=E.drawPositions[e],i=Vy({structureId:N.target.structureId,drawPosition:t,tournamentRecord:r,drawDefinition:n,event:s});if(i.error);}}}({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:s}),g&&f&&g.structureId!==u?.structureId){let{roundNumber:e}=g;if(1===e){let e=Vy({structureId:h.target.structureId,drawPosition:y,tournamentRecord:r,drawDefinition:n,event:s});if(e.error)return e}else Wy({loserTargetDrawPosition:y,tournamentRecord:r,loserTargetLink:h,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:s})}return{..._r}}function Wy({loserTargetDrawPosition:e,tournamentRecord:t,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Ly({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:e});let c=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:d}=Oy({drawPosition:e,matchUps:c});if(d===s){let n=Vy({structureId:i.target.structureId,drawPosition:e,tournamentRecord:t,drawDefinition:r,event:o});if(n.error)return n}}function qy({positionAssignments:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=oy({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach((r=>{let n=e.filter((({drawPosition:e})=>r.drawPositions?.includes(e))).filter((e=>e.bye)).length;r.winningSide||(Object.assign(r,{matchUpStatus:n?"BYE":Jm}),Jf({tournamentId:t?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:i,matchUp:r}))}))}function Hy(e){let{inContextDrawMatchUps:t,participantId:i,drawPosition:r}=e,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:c}=e,{structure:d}=lf({drawDefinition:a,structureId:o}),u=(hf({drawDefinition:a,structure:d}).positionAssignments||[]).find((e=>i&&e.participantId===i||r&&e.drawPosition===r));if(u&&i&&!r&&(r=u?.drawPosition),!r)return{error:pn};i||(i=u?.participantId);let{activeDrawPositions:l}=ky({drawDefinition:a,structureId:o});return l.includes(r)?{error:dn}:(t||({matchUps:t}=gy({inContext:!0,drawDefinition:a,matchUpsMap:s})),zy({inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:c}).drawPositionCleared?(th({tournamentId:n?.tournamentId,drawDefinition:a,structure:d,event:c}),{..._r,participantId:i}):{error:on})}function zy({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){let{structure:s}=lf({drawDefinition:i,structureId:a});if(!s)return{error:Rn};let c=hf({drawDefinition:i,structure:s}).positionAssignments||[],d=c.some((e=>{if(e.drawPosition===r)return delete e.participantId,delete e.qualifier,delete e.bye,!0}));if(s.structureType===xu)return qy({positionAssignments:c,tournamentRecord:t,drawDefinition:i,matchUpsMap:n,structure:s}),{drawPositionCleared:d,..._r};let{matchUps:u}=oy({drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:s,event:o}),{roundProfile:l,roundMatchUps:p}=Ng({matchUps:u}),m=(l&&Object.keys(l))?.map((e=>zi(e))),f=r,h=m?.map((e=>{let t=l?.[e]?.pairedDrawPositions?.find((e=>e.includes(f))),i=t?.find((e=>e!==f)),r=c.find((e=>e.drawPosition===i)),n=l?.[e+1],a=r?.bye,o=n?.pairedDrawPositions?.find((e=>e.includes(i))),s=a&&o&&n&&n.drawPositions?.includes(i),d=t&&{pairedDrawPositionByeAdvancedPair:!s&&o,pairedDrawPosition:i,targetDrawPosition:f,relevantPair:t,roundNumber:e};return s&&(f=i),d})).filter((e=>e?.targetDrawPosition))?.reduce(((e,t)=>{let{roundNumber:i,relevantPair:r,targetDrawPosition:n,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=t,s=[{roundNumber:i,targetDrawPosition:n,relevantPair:r},o&&{roundNumber:i+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat(...s)}),[]);return h?.forEach((({roundNumber:d,targetDrawPosition:u,relevantPair:l})=>{let m=p?.[d].find((e=>Sr(e.drawPositions?.filter(Boolean),l.filter(Boolean))));m&&(function({inContextDrawMatchUps:e,targetDrawPosition:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=lf({drawDefinition:r,structureId:o});if(!s)return{error:Rn};if(s.structureType===xu)return;n=n||bg({drawDefinition:r});let c=(n?.mappedMatchUps||{})[o].matchUps,{initialRoundNumber:d}=Oy({drawPosition:t,matchUps:c}),u=c?.filter((e=>e.roundNumber>=a&&e.roundNumber!==d&&e.drawPositions?.includes(t))),l=ff({drawDefinition:r,structureId:o}).positionAssignments??[];u?.forEach((a=>Yy({drawPosition:t,targetMatchUp:a,inContextDrawMatchUps:e,positionAssignments:l,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})))}({inContextDrawMatchUps:e,targetDrawPosition:u,tournamentRecord:t,drawDefinition:i,structureId:a,roundNumber:d,matchUpsMap:n}),Yy({inContextDrawMatchUps:e,positionAssignments:c,tournamentRecord:t,drawDefinition:i,targetMatchUp:m,drawPosition:r,matchUpsMap:n,structure:s,event:o}))})),{tasks:h,drawPositionCleared:d,positionAssignments:c}}function Yy({inContextDrawMatchUps:e,positionAssignments:t,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:c}){let d="removeDrawPosition",u=n.drawPositions?.slice(),l=n.matchUpStatus,p=n.winningSide,m=(o=o??bg({drawDefinition:r})).mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:f}=Oy({drawPosition:a,matchUps:m});if(n.roundNumber&&f&&n.roundNumber>f){let e=(n.drawPositions??[]).map((e=>e===a?void 0:e));n.drawPositions=e}if(n.matchUpType===Gi){let t=(e?.find((e=>e.matchUpId===n.matchUpId))?.sides??[]).reduce(((e,t,i)=>t.drawPosition===a?i:e),void 0);void 0!==t&&n.sides?.[t]?.lineUp&&(delete n.sides?.[t].lineUp,Jf({tournamentId:i?.tournamentId,context:`${d}-TEAM`,eventId:c?.eventId,matchUp:n,drawDefinition:r}))}let h=py({matchUpId:n.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:y,loserMatchUpDrawPositionIndex:v}}=h,S=t.filter((({drawPosition:e})=>n.drawPositions?.includes(e))).filter((e=>e.bye)).length,U=(S?"BYE":n.matchUpStatus&&By(n.matchUpStatus)&&n.matcHUpStatus)||Jm;n.matchUpStatus=U,n.matchUpStatus&&By(n.matchUpStatus)&&(n.winningSide=void 0);let b=u?.find((e=>!n.drawPositions?.includes(e)));if(u?.includes(a)&&l===n.matchUpStatus&&p===n.winningSide||(b&&Ly({method:d,color:"brightyellow",removedDrawPosition:b}),Jf({tournamentId:i?.tournamentId,context:`${d}-${a}`,eventId:c?.eventId,matchUp:n,drawDefinition:r})),I&&I.structureId!==h.matchUp.structureId&&!S){let{drawPositions:t,roundNumber:n}=I;if(1===n){let n=t[v];zy({structureId:I.structureId,drawPosition:n,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let n=Math.min(...t.filter(Boolean)),a=function({loserMatchUpDrawPosition:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{structure:s}=lf({structureId:n.structureId,drawDefinition:r}),{positionAssignments:c}=ff({structure:s});if(c?.find((t=>t.drawPosition===e))?.bye){let s=Hy({drawPosition:e,structureId:n.structureId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(s.error)return s}return{..._r}}({loserMatchUpDrawPosition:n,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:I,matchUpsMap:o,event:c});if(a.error)return Qs({result:a,stack:d});let s=(o?.mappedMatchUps||{})[I.structureId].matchUps,{initialRoundNumber:u}=Oy({drawPosition:n,matchUps:s});1===u&&(Ly({method:d,color:"brightyellow",loserMatchUpDrawPosition:n}),zy({structureId:I.structureId,drawPosition:n,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return y&&y.structureId!==h.matchUp.structureId&&g.target.feedProfile,{..._r}}function Ky({drawDefinition:e,stages:t}){if(!e)return{error:Jr};let i=ar((e?.structures??[]).filter((e=>!t?.length||e.stage&&t.includes(e.stage))).map((e=>{let{positionAssignments:t}=ff({structure:e});return t?t.map(Om):[]})).flat().filter(Boolean));return{..._r,assignedParticipantIds:i}}function Xy(e){let t=(e?.entries??[]).filter(Boolean).reduce(((e,t)=>{let{entryStage:i,entryStatus:r}=t,n=`_${i||vu}${r||""}`;return e[n]||(e[n]=[]),e[n].push(t),e}),{}),i=e=>isNaN(e)?1/0:e;return Object.keys(t).map((e=>t[e].sort(((e,t)=>i(e.entryPosition)-i(t.entryPosition))).map(((e,t)=>({...e,entryPosition:t+1}))))).flat()}function Jy(e){return[og,ag].includes(e)}function Qy({autoEntryPositions:e=!0,ignoreAssignment:t,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:c,drawId:d,stage:u,event:l}){if(!n||!Array.isArray(n))return{error:Ba,method:"modifyEntriesStatus",participantIds:n};if(!r&&!l)return{error:Fn};if(a&&!mg.includes(a))return{error:no};if(o&&!Tu.includes(o))return{error:Gn};let p="modifyEntriesStatus",m=[];if(!a&&!s)return Qs({result:{error:va},info:"Missing entryStatus",stack:p});if(s&&!Bp({extension:s,requiredAttributes:["name"]}))return Qs({result:{error:Ho},info:"Invalid extension",context:{extension:s},stack:p});let f=[];l?.drawDefinitions?.forEach((e=>{let t=Ky({stages:u&&[u],drawDefinition:e}).assignedParticipantIds??[];f.push(...t)}));let h=i?.participants??[];if(!n.every((e=>{let t=xp({tournamentParticipants:h,participantId:e})?.participantType;return!(t&&[fh,lh].includes(t)&&Jy(a)||a&&l?.eventType&&t===ph&&[fu,Iu].includes(l.eventType)&&[Xh,...dg].includes(a))})))return{error:no};let g=l&&XI({event:l}).flightProfile,I=g?.flights?.find((e=>e.drawId===d)),y=e=>{let i=(e||[]).filter((e=>!u||!e.entryStage||u===e.entryStage)).filter((({participantId:e})=>n.includes(e)));return i.every((e=>!((e=>a&&f.includes(e.participantId)&&!(dg.includes(e.entryStatus)&&dg.includes(a)))(e)&&!t)&&(a&&(e.entryStatus=a,delete e.entryPosition),o&&(e.entryStage=o,delete e.entryPosition),s&&(s.value?Vp({element:e,extension:s}):_p({element:e,name:s.name})),!0)))?{..._r}:{error:to}},v=({flight:e,drawDefinition:t})=>{l&&(l.entries=Xy({entries:l.entries??[]})),e&&(e.drawEntries=Xy({entries:e.drawEntries})),t&&(t.entries=Xy({entries:t.entries}))},S=e=>{let{flight:t,drawDefinition:i}=e,r="updateDrawEntries";if(t){let e=y(t.drawEntries);if(e.error)return Qs({result:e,stack:r})}if(i){let e=y(i.entries);if(e.error)return Qs({result:e,stack:r});m.includes(i.drawId)||m.push(i.drawId)}return{..._r}},U=l?.entries?.find((({entryPosition:e})=>e))??(I?.drawEntries?.find((({entryPosition:e})=>e))||r?.entries?.find((({entryPosition:e})=>e)));if(e&&!U&&v({flight:I,drawDefinition:r}),I||r){let e=S({flight:I,drawDefinition:r});if(e.error)return Qs({result:e,stack:p})}let b=l?.drawDefinitions?.map((({drawId:e})=>e))??[],w=g?.flights?.filter((e=>!b.includes(e.drawId)))||[];for(let D of w){let e=D&&S({flight:D});if(e?.error)return Qs({result:e,stack:p})}let T=1===g?.flights?.length&&(l?.drawDefinitions?.length??0)<=g?.flights?.length;if(!I&&!r&&a&&ug.includes(a))return{error:uo};if(!I&&!r||a===cg||c&&T){let e,t=y(l?.entries);if(t?.error)return Qs({result:t,stack:p});if(a===cg&&(g?.flights?.every((t=>{let i=y(t.drawEntries);return i.error?(e=i.error,!1):(t.drawEntries=t.drawEntries.filter((({participantId:e})=>!n.includes(e))),!0)})),l?.drawDefinitions?.every((t=>{let i=y(t.entries);return i.error?(e=i.error,!1):(t.entries=t.entries?.filter((({participantId:e})=>!n.includes(e))),!0)}))),e)return Qs({result:{error:e},stack:p})}e&&v({flight:I,drawDefinition:r});for(let D of l?.drawDefinitions??[])m.length&&!m.includes(D.drawId)||Zf({tournamentId:i.tournamentId,eventId:l?.eventId,drawDefinition:D});return{..._r}}function Zy({requireTimeStamp:e,scaleAttributes:t,participant:i}){if(!i)return{error:Wa};if(!Rr(t))return{error:Ho};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:r,scaleType:n,eventType:a,scaleName:o}=t,s=[fp,n,a,o].join("."),c=i.timeItems.filter((e=>e?.itemType===s)).filter((t=>!e||t?.itemDate)).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))).pop();if(c){let[e,t,i,n]=c.itemType?.split(".")??[];if(e!==fp)return{error:Fo};let a=(r&&wy({element:c.itemValue,accessor:r}))?.value||c.itemValue,o={eventType:i,scaleDate:c.itemDate,scaleValue:a,scaleName:n,scaleType:t};return{..._r,scaleItem:o}}}return{..._r,scaleItem:void 0}}function ev({publishedSeeding:e,usePublishState:t,withSeeding:i,participant:r,event:n}){let a={},o=e=>[fp,hp,n.eventType,e].join("."),s=Object.assign({},...(r.timeItems||[]).filter((({itemType:e})=>e.split(".")[1]===hp)).map((({itemType:e,itemValue:t})=>({[e]:t})))),c=(e?.stageSeedingScaleNames&&Object.values(e?.stageSeedingScaleNames)||Array.isArray(e?.seedingScaleNames)&&e.seedingScaleNames||[]).map(o),d=yr(Object.keys(s),c);if(t&&(Object.keys(s).length||e?.drawIds?.length)&&!d.length||!d.length)if(t||"object"!=typeof i){let i,{categoryName:o,ageCategoryCode:s}=n.category||{},c=[s,n.eventId,o].filter(Boolean);for(let e of c){let t=Zy({scaleAttributes:{eventType:n.eventType,scaleType:hp,scaleName:e},participant:r});if(t.scaleItem){i=t.scaleItem;break}}if(i&&(!t||e?.published&&!e?.published?.drawIds?.length)){let e=i.scaleValue;a.seedValue=e}}else{let e=Object.keys(i).map((e=>{let t=o(i[e]);return[e,s[t]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),t=Object.assign({},...e);a.seedAssignments=t}else if(e?.stageSeedingScaleNames){let t=Object.keys(e.stageSeedingScaleNames).map((t=>{let i=o(e.stageSeedingScaleNames[t]);return[t,s[i]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),i=Object.assign({},...t);a.seedAssignments=i}else if(d){let e=d.map((e=>s[e]));a.seedValue=e.pop()}return a}function tv({convertExtensions:e,seedAssignments:t,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:c,entryStage:d,entryPosition:u,extensions:l}=s,p=l?.length&&e?Object.assign({},...vd(l??[])):{},m=Object.assign(p,{entryPosition:u,entryStatus:c,entryStage:d,ranking:o,eventId:a});i.events[a]=Js(m,!1,!1,!0),r&&(t&&(i.events[a].seedAssignments=t),n&&(i.events[a].seedValue=n))}function iv(e){let t=dp(e,[{[Tl]:!0}]);if(t.error)return t;let{tournamentRecord:i,status:r=fI}=e,n=`${mI}.${hI}`;return yd(Nh({tournamentRecord:i,itemType:n})?.timeItem?.itemValue?.[r],!1,!0)}function rv({event:e,status:t=fI}){let i=`${mI}.${hI}`;return Ph({itemType:i,event:e})?.timeItem?.itemValue?.[t]}function nv({drawDetails:e,drawId:t}){return e?.[t]?.publishingDetail?.published}function av(e){let{tournamentRecord:t,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:o,event:s}=e??{};if(t&&!function(e){let{tournamentId:t}=e??{};return!!t}(t))return{error:Ho};if(n&&!s)return{error:Ln};if(Array.isArray(r)&&r?.length){let e={};for(let i of r){if(!Mr(i))return{error:Ho};let r=JI({tournamentRecord:t,eventId:i})?.event;if(!r)return{error:Ln};let n=ov({event:r});e[i]=n}return{..._r,publishState:e}}if(s){let e=ov({event:s}),t={};if(o)return i?{publishState:{status:{published:!!e.status.publishedDrawIds?.includes(o),drawDetail:e.status.drawDetails?.[o]},..._r}}:{error:Zr};if(Array.isArray(a)&&a?.length){let i=s.drawDefinitions?.map(Fm)??[];for(let r of a){if(!Mr(r))return{error:Ho};if(!i.includes(r))return{error:Zr};t[r]={status:{published:!!e.status.publishedDrawIds.includes(r),drawDetail:e.status.drawDetails?.[r]}}}}else t=e;return{..._r,publishState:t}}let c=[],d=!1,u={};for(let l of t?.events??[]){let e=ov({event:l});u[l.eventId]=e,e.status.published&&(c.push(l.eventId),d=!0);for(let{drawId:t}of l.drawDefinitions??[]){let i=e.status?.publishedDrawIds?.includes(t);i&&(u[t]={status:{published:i}})}}if(t){let e=iv({tournamentRecord:t});u.tournament=e??{},(e?.orderOfPlay?.published||e?.participants?.published)&&(d=!0),u.tournament.status={published:d,publishedEventIds:c}}return{..._r,publishState:u}}function ov({event:e}){let t=rv({event:e});if(!t)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};t.seeding&&Object.assign(i,t.seeding);let r=t.drawDetails??{};for(let o of e.drawDefinitions?.map(Fm)||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter((e=>nv({drawDetails:r,drawId:e}))),a=n?.length?n:t.drawIds??[];if(a?.length&&!n?.length)for(let o of a)r[o]={publishingDetail:{published:!0}};return{status:{publishedDrawIds:a,publishedSeeding:i,drawDetails:r,published:a?.length>0}}}function sv(e){let{participantMap:t,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:c,potential:d,schedule:u,drawId:l,score:p}=e;!u||!Object.keys(u).length||"BYE"===r||t[i].scheduleItems.push({...u,scheduledDate:Yc(u?.scheduledDate),scheduledTime:zc(u?.scheduledTime),checkScoreHasValue:My({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:c,potential:d,drawId:l})}function cv({finishingPositionRange:e={},participantMap:t,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:c,matchUpId:d,drawId:u,stage:l}){let p=t[a],m=e=>Math.abs(e[0]-e[1]);p.structureParticipation[c]||(p.structureParticipation[c]={rankingStage:l,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:c,drawId:u});let f=p.structureParticipation[c],{winner:h,loser:g}=e,I=r?h:g;r&&(f.winCount+=1,n===Qm&&(f.walkoverWinCount+=1),n===Gm&&(f.defaultWinCount+=1)),I&&(!f.finishingPositionRange||m(I)<m(f.finishingPositionRange))&&(f.finishingPositionRange=I),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=d,f.finishingRound=i,f.roundNumber=s),1===i&&(f.participantWon=r))}function dv(e){let{withScheduleItems:t,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:c,finishingPositionRange:d,finishingRound:u,matchUpStatus:l,stageSequence:p,roundNumber:m,structureId:f,score:h,stage:g,withRankingProfile:I,tieWinningSide:y,roundPosition:v,matchUpTieId:S,matchUpSides:U,collectionId:b,matchUpType:w,winningSide:T,matchUpId:D,schedule:P,eventId:N,drawId:E,sides:M}=e,R=a&&2===M?.length&&Object.assign({},...M.map((({sideNumber:e},t)=>{let i=M[1-t].participantId;return e&&{[e]:i}})).filter(Boolean));for(let C of M){let{participantId:e,sideNumber:M,bye:A}=C;if(A)continue;let k=T===M,O=e=>{let t=n[e]?.participant,i=t?.participantType,r=[{participantId:e,participantType:i}];if(i!==lh)for(let a of t?.individualParticipantIds||[]){let e=n[a]?.participant;r.push({participantType:e?.participantType,participantId:a})}return r},x=(e,r)=>{if(o){if(n[e].matchUps[D]={participantWon:k,matchUpType:w,structureId:f,sideNumber:M,matchUpId:D,eventId:N,drawId:E,stage:g},a){let t=O(r);n[e].matchUps[D].opponentParticipantInfo=t}b&&(n[e].matchUps[D].collectionId=b)}a&&r&&(n[e].opponents[r]={participantId:r,matchUpId:D,eventId:N,drawId:E}),I&&cv({finishingPositionRange:d,participantMap:n,participantWon:k,finishingRound:u,matchUpStatus:l,participantId:e,stageSequence:p,roundNumber:m,structureId:f,matchUpId:D,drawId:E,stage:g}),(i||t)&&sv({participantMap:n,participantId:e,matchUpStatus:l,roundPosition:v,matchUpType:w,roundNumber:m,structureId:f,matchUpId:D,schedule:P,drawId:E,score:h})},F=({participant:e,partnerParticipantId:t})=>{let i=(e,t)=>{e&&(e.partnerParticipantIds||(e.partnerParticipantIds=[]),e.partnerParticipantIds.includes(t)||e.partnerParticipantIds.push(t))};c&&i(e?.draws?.[E],t),s&&i(e?.events?.[N],t),o&&i(e?.matchUps?.[D],t)};if(e&&n[e]){let t=R?.[M];x(e,t);let i=n[e]?.participant.participantType===fh,a=n[e]?.participant.individualParticipantIds||[];if(S){if(r){let t=e=>n[e].matchUps[S]={participantWon:y===M,matchUpId:S,matchUpType:Gi,sideNumber:M};t(e),a.forEach(t)}if(c&&!n[e].draws[E]){let t=U.find((e=>e.sideNumber===M))?.participant?.participantId,i=n[t]?.draws?.[E]?.entryStatus,r=e=>n[e].draws[E]={entryStatus:i,eventId:N,drawId:E};r(e),a.forEach(r)}}if(i&&(a.forEach((e=>n[e]&&x(e,t))),a.forEach(((e,t)=>{let i=a[1-t],r=n[e];r&&F({participant:r,partnerParticipantId:i})})),s&&U)){let t=U.find((e=>e.sideNumber===M))?.participant?.participantId;if(t){let i=n[t]?.events[N];i?(n[e].events[N]={...i},a.forEach((e=>n[e].events[N]={...i}))):console.log("Missing teamEntry",{eventId:N,teamParticipantId:t})}}if(T){let t=e=>{k?(n[e].counters[w].wins+=1,n[e].counters.wins+=1,l===Qm&&(n[e].counters[w].walkoverWins+=1,n[e].counters.walkoverWins+=1),l===Gm&&(n[e].counters[w].defaultWins+=1,n[e].counters.defaultWins+=1)):(n[e].counters[w].losses+=1,n[e].counters.losses+=1,l===Qm&&(n[e].counters[w].walkovers+=1,n[e].counters.walkovers+=1),l===Gm&&(n[e].counters[w].defaults+=1,n[e].counters.defaults+=1))};t(e),a.forEach(t)}}}}function uv(e,t){return(e||"").localeCompare(t||"")}function lv({participantFilters:e={},tournamentRecord:t,participants:i=[]}){if(!Object.keys(e).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:c,participantTypes:d,participantIds:u,signInStatus:l,enableOrFiltering:p,eventIds:m,genders:f}=e,h=pv(m)&&t?.events?.filter((e=>m?.includes(e.eventId)))||t?.events||[],g=n&&function({drawEntryStatuses:e,tournamentEvents:t}){let i=({entryStatus:t})=>!Array.isArray(e)||e.includes(t);return ar(t.reduce(((e,t)=>{let{flightProfile:r}=XI({event:t}),n=r?.flights?.map((({drawEntries:e})=>Array.isArray(e)?e.filter(i).map(Om):[])).flat()||[],a=t.drawDefinitions?.map((({entries:e})=>e?e.filter(i).map(Om):[]))||[];return e.concat(...n,...a)}),[]))}({drawEntryStatuses:n,tournamentEvents:h}),I=o&&function({eventEntryStatuses:e,tournamentEvents:t}){return ar(t.reduce(((t,i)=>{let r=(i.entries||[]).filter((({entryStatus:t})=>!Array.isArray(e)||e.includes(t))).map(Om);return t.concat(...r)}),[]))}({eventEntryStatuses:o,tournamentEvents:h}),y=void 0!==a&&[!0,!1].includes(a)&&h.reduce(((e,t)=>e.concat(...(t.drawDefinitions||[]).map((e=>mf({drawDefinition:e}).allPositionedParticipantIds)).filter(Boolean))),[]),v=e=>r?.reduce(((t,i)=>{let{accessor:r,value:n}=i,{values:a}=wy({element:e,accessor:r});return t&&a?.includes(n)}),!0);if(i=i?.filter((e=>{let t=Th({element:e,itemType:ch})?.timeItem?.itemValue,{participantRoleResponsibilities:i,participantType:n,participantRole:o,participantId:m,person:h}=e,S=Array.isArray(f)&&f?.length&&h?.sex&&f.includes(h.sex);return p?f&&S||a&&y.includes(m)||!1===a&&!y.includes(m)||g?.includes(m)||I?.includes(m)||u?.includes(m)||l&&t===l||d&&n&&pv(d)&&d.includes(n)||s&&o&&pv(s)&&s.includes(o)||c&&pv(i)&&pv(c)&&c.find((e=>i?.includes(e)))||r?.length&&pv(r)&&v(e):(!f||S)&&(void 0===a||a&&y.includes(m)||!1===a&&!y.includes(m))&&(!g||g.includes(m))&&(!I||I.includes(m))&&(!u||u.includes(m))&&(!l||t===l)&&(!d||n&&pv(d)&&d.includes(n))&&(!s||o&&pv(s)&&s.includes(o))&&(!c||pv(i)&&pv(c)&&c.find((e=>i?.includes(e))))&&(!r?.length||pv(r)&&v(e))})),h.length&&m){let e=h.filter((e=>m.includes(e.eventId))).map((e=>{let i=(e.entries||[]).map((e=>e.participantId));if(yI(pu)(e.eventType))return i;let r=(t?.participants??[]).filter((e=>i.includes(e.participantId))).map((e=>e.individualParticipantIds)).flat(1);return i.concat(...r)})).flat(1);i=i?.filter((t=>e.includes(t.participantId)))}return i}function pv(e){return e&&Array.isArray(e)&&e.length}function mv(e){let{withIndividualParticipants:t,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:c,scheduleAnalysis:d,withSignInStatus:u,withTeamMatchUps:l,withScaleValues:p,usePublishState:m,withStatistics:f,contextFilters:h,matchUpFilters:g,contextProfile:I,withOpponents:y,withMatchUps:v,internalUse:S,withSeeding:U,withEvents:b,withDraws:w,withISO2:T,withIOC:D}=e;if(!c)return{error:zr};(v||n)&&Ey({tournamentRecord:c});let P=Ch({convertExtensions:a,tournamentRecord:c,withSignInStatus:u,withScaleValues:p,internalUse:S,withISO2:T,withIOC:D}),{participantMap:N}=P,E=function(e){let{participantFilters:t,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextFilters:o,matchUpFilters:s,participantMap:c,contextProfile:d,withPotentialMatchUps:u,withRankingProfile:l,withScheduleItems:p,scheduleAnalysis:m,withTeamMatchUps:f,withStatistics:h,withOpponents:g,withMatchUps:I,withSeeding:y,withEvents:v,withDraws:S}=e,U=t?.participantIds,b=e=>{let t=[e];return c[e]?.participant.individualParticipantIds?.forEach((e=>t.push(e))),t.some((e=>!U?.length||U.includes(e)))?t:[]},w={withMatchUps:I||l,withEvents:v||l,withDraws:S||l,withPotentialMatchUps:u,withRankingProfile:l,withScheduleItems:p,scheduleAnalysis:m,withTeamMatchUps:f,withStatistics:h,participantMap:c,withOpponents:g,withSeeding:y},T=[],D={},P=[],N={},E={},M={},R=({eventType:e,scaleNames:t,participantId:i})=>c[i]?.participant?.rankings?.[e]?.find((e=>t.includes(e.scaleName)))?.scaleValue;for(let C of n?.events||[]){if(t?.eventIds&&!t.eventIds.includes(C.eventId))continue;let{drawDefinitions:e=[],extensions:U=[],eventType:T,eventName:A,category:k,entries:O,eventId:x,gender:F}=C,{flightProfile:L}=XI({event:C}),_=L?.flights??[],B=av({event:C}).publishState;B&&(N[x]=B);let V=B?.status?.publishedSeeding;if(v||y||l){let e=i?Object.assign({},...vd(U??[])):{};E[x]={...e,eventName:A,eventType:T,category:k,eventId:x,gender:F};let t=[k?.categoryName,k?.ageCategoryCode].filter(Boolean);for(let r of O){let{participantId:e}=r;if(!e||!c[e])continue;let n,o,s=R({eventType:T,scaleNames:t,participantId:e});if(y){let t=c[e].participant;({seedAssignments:n,seedValue:o}=ev({publishedSeeding:V,usePublishState:a,withSeeding:y,participant:t,event:C}))}let d=e=>{if(c[e]?.events?.[x])return;let t=c[e];tv({convertExtensions:i,seedAssignments:n,participant:t,withSeeding:y,seedValue:o,eventId:x,ranking:s,entry:r})};d(e),(c[e].participant.individualParticipantIds||[]).forEach(d)}}let j=N?.[x]?.publishedSeeding;if(S||l||y){let t=e=>e?Object.assign({},...e.map((({participantId:e,seedValue:t,seedNumber:i})=>({[e]:{seedValue:t,seedNumber:i}})))):void 0,i=ar([...e.map(Fm),..._.map(Fm)]);for(let r of i){let i,n,o,s,d=e.find((e=>e.drawId===r)),u=[k?.categoryName,k?.ageCategoryCode].filter(Boolean),{structures:p=[],drawOrder:m,drawName:f,drawType:h}=d??{},g=_?.find((e=>e.drawId===r)),I=d?.entries||g?.drawEntries,v=g?.flightNumber,U=(d?.structures||[]).sort(((e,t)=>df(e,t))).map((({structureId:e,structures:t})=>[e,...(t||[]).map((({structureId:e})=>e))])).flat(1/0),b=0,w=p.filter((({stage:e,stageSequence:t})=>e===vu&&1===t||e===Su)).flatMap((e=>{let{positionAssignments:t}=ff({structure:e}),{seedAssignments:r,stageSequence:a,stage:c}=e;return c===vu?(b=t?.length??0,o=t,s=r):1===a&&(i=t,n=r),t})).map((({participantId:e})=>e)).filter(Boolean),D=t(s),P=t(n),N=d?I.filter((({participantId:e})=>w.includes(e))):I,E=!a||j?.published&&(0===j?.drawIds?.length||j?.drawIds?.includes(r));for(let e of N){if(!c[e.participantId])continue;let{entryStatus:t,entryStage:i,entryPosition:n,participantId:a}=e,o=R({participantId:a,scaleNames:u,eventType:T}),s=e=>{if(!c[e]||c[e].draws?.[r])return;let s=y&&E,d=s?{}:void 0,u=s?D?.[a]?.seedValue||D?.[a]?.seedNumber:void 0,p=u?D?.[a]:void 0,m=s?P?.[a]?.seedValue||P?.[a]?.seedNumber:void 0,f=m?P?.[a]:void 0;d&&u&&(d[vu]=p),d&&m&&(d[Su]=f);let h=u||m;h&&(c[e].participant.seedings[T]||(c[e].participant.seedings[T]=[]),p&&c[e].participant.seedings[T].push({...p,scaleName:r}),f&&c[e].participant.seedings[T].push({...f,scaleName:r}),d&&(c[e].events[x].seedAssignments||(c[e].events[x].seedAssignments={}),Object.keys(d).forEach((t=>c[e].events[x].seedAssignments[t]=d[t])))),(S||l)&&(c[e].draws[r]=Js({seedAssignments:d,entryPosition:n,entryStatus:t,entryStage:i,seedValue:h,eventId:x,ranking:o,drawId:r},!1,!1,!0))};[ag,og].includes(t)||(s(a),(c[a].participant.individualParticipantIds||[])?.forEach(s))}let C=(d?.structures??[]).reduce(((e,t)=>(e.includes(t.stage)||e.push(t.stage),e)),[]),A=(d?.links??[]).length;M[r]={qualifyingPositionAssignments:i,qualifyingSeedAssignments:n,mainPositionAssignments:o,qualifyingSeedingMap:P,mainSeedAssignments:s,orderedStructureIds:U,mainSeedingMap:D,flightNumber:v,linksCount:A,drawOrder:m,drawName:f,drawType:h,drawSize:b,drawId:r,stages:C}}}if(l||m||f||h||g||I||S){let e=!!m||u,t=yy({afterRecoveryTimes:!!m,policyDefinitions:r,tournamentRecord:n,inContext:!0,participantMap:c,contextFilters:o,matchUpFilters:s,contextProfile:d,nextMatchUps:e,event:C})?.matchUps??[];for(let i of t){let{finishingPositionRange:t,potentialParticipants:r,tieMatchUps:a=[],sides:o=[],winningSide:s,matchUpType:d,matchUpId:u,eventId:l,drawId:f,collectionId:h,stageSequence:g,finishingRound:I,matchUpStatus:y,roundPosition:v,roundNumber:S,structureId:U,schedule:T,score:P,stage:N}=i;D[u]=i;let E={finishingPositionRange:t,finishingRound:I,stageSequence:g,roundPosition:v,collectionId:h,roundNumber:S,structureId:U,schedule:T,eventId:l,drawId:f,score:P,stage:N};dv({...E,...w,matchUpStatus:y,winningSide:s,matchUpType:d,matchUpId:u,sides:o});for(let e of a){let{winningSide:t,sides:i=[],matchUpId:r,matchUpStatus:n,matchUpType:a}=e;dv({...E,...w,winningSide:t,tieWinningSide:s,matchUpTieId:u,matchUpId:r,sides:i,matchUpSides:o,matchUpStatus:n,matchUpType:a})}Array.isArray(r)&&(e||m||p)&&r.flat().map(Om).filter(Boolean)?.forEach((e=>{b(e)?.forEach((e=>{c[e]&&(c[e].potentialMatchUps[u]=Js({tournamentId:n?.tournamentId,matchUpId:u,eventId:l,drawId:f}))})),(m||p)&&sv({potential:!0,participantMap:c,participantId:e,matchUpStatus:y,roundPosition:v,structureId:U,matchUpType:d,roundNumber:S,matchUpId:u,schedule:T,drawId:f,score:P})}))}P.push(...t)}}if(h||l||m){let e=Object.values(c);for(let t of e){let{wins:e,losses:i,[Bi]:{wins:r,losses:n},[ji]:{wins:a,losses:o}}=t.counters,s=(e,i,r)=>{let n=i+r,a=i,o=n&&a/n;t.statistics[e]={denominator:n,numerator:a,statValue:o,statCode:e}};if(h&&(s(Gh,e,i),s(`${Gh}.${Bi}`,r,n),s(`${Gh}.${ji}`,a,o)),l){let e=(e=[])=>Math.abs(e[0]-e[1]);for(let i of Object.keys(t.draws)){let{orderedStructureIds:r=[],flightNumber:n}=M[i]||{};if(t.structureParticipation&&r.length){let a,o=0,s=r.map((i=>{let r=t.structureParticipation[i];if(!r)return;a||(a=r?.finishingPositionRange),e(a)>e(r?.finishingPositionRange)&&(a=r?.finishingPositionRange);let s=r.stage!==Su;return s&&(o+=1),Js({...r,participationOrder:s?o:void 0,flightNumber:n})})).filter(Boolean);t.draws[i]&&(t.draws[i].finishingPositionRange=a,t.draws[i].structureParticipation=s)}}}if(m){let e=Rr(m)?m.scheduledMinutesDifference:0,i=t.scheduleItems||[],r=t.potentialMatchUps||{},n=i.reduce(((e,t)=>{let{scheduledDate:i,scheduledTime:r}=t;return e[i]||(e[i]=[]),r&&e[i].push(t),e}),{});Object.values(n).forEach((e=>e.sort(Qc)));for(let o of i){let{typeChangeTimeAfterRecovery:i,timeAfterRecovery:a,scheduledDate:s,scheduledTime:c}=o,d=n[s],u=qc(c);for(let n of d){if(n.matchUpId===o.matchUpId||By(n.matchUpStatus)&&!n.checkScoreHasValue)continue;let s=o.matchUpType!==n.matchUpType&&i||a,c=o.drawId===n.drawId,d=r[o.matchUpId]&&r[n.matchUpId],l=qc(n.scheduledTime),p=Math.abs(l-u),m=l>=u;if((e&&!isNaN(e)?p<=e:m&&qc(n.scheduledTime)<qc(s))&&(!d||!c)&&m){let e=[o.matchUpId,n.matchUpId].sort(uv).join("|");t.scheduleConflicts[e]={priorScheduledMatchUpId:o.matchUpId,matchUpIdWithConflict:n.matchUpId}}}}let a=t.participant.participantId;Object.keys(t.scheduleConflicts).length&&T.push(a),c[a].scheduleConflicts=t.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:N,derivedEventInfo:E,derivedDrawInfo:M,mappedMatchUps:D,participantMap:c,matchUps:P}}({withMatchUps:v??n,withEvents:b??n,withDraws:w??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:c,scheduleAnalysis:d,withTeamMatchUps:l,usePublishState:m,withStatistics:f,contextFilters:h,matchUpFilters:g,participantMap:N,withOpponents:y,contextProfile:I,withSeeding:U}),{participantIdsWithConflicts:M,eventsPublishStatuses:R,derivedEventInfo:C,derivedDrawInfo:A,mappedMatchUps:k}=E,O=E.matchUps;N=E.participantMap;let x=d??r,F=({potentialMatchUps:e,scheduleConflicts:t,scheduleItems:i,participant:r,statistics:a,opponents:o,matchUps:c,events:u,draws:l})=>{let p=Object.values(l),m=Object.values(o);return y&&p?.forEach((e=>{e.opponents=m.filter((t=>t.drawId===e.drawId))})),Js({...r,scheduleConflicts:d?Object.values(t):void 0,draws:w||n?p:void 0,events:b||n?Object.values(u):void 0,matchUps:v||n?Object.values(c):void 0,opponents:y?m:void 0,potentialMatchUps:x?Object.values(e):void 0,statistics:f?Object.values(a):void 0,scheduleItems:s?i:void 0},!1,!1,!0)},L=new Map;for(let $ of Object.keys(N))L.set($,F(N[$]));let _=[...L.values()],B=o?.[Pp]?.participant,V=lv({participants:_,participantFilters:i,tournamentRecord:c});if(t){let e=Rr(t)?t:void 0;for(let t of V)for(let i of t.individualParticipantIds??[]){t.individualParticipants||(t.individualParticipants=[]);let r=L.get(i),n=e?yp({template:e,source:r}):r;t.individualParticipants.push(n)}}let j=B?V.map((e=>yp({source:e,template:B}))):V;return{participantMap:!1!==e.returnParticipantMap?N:void 0,mappedMatchUps:!1!==e.returnMatchUps?k:void 0,matchUps:!1!==e.returnMatchUps?O:void 0,missingParticipantIds:P.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:R,derivedEventInfo:C,derivedDrawInfo:A,participants:j,..._r}}function fv({participantId:e,drawDefinition:t,entryStatus:i,entryStage:r}){if(!t)return{error:Jr};let n=t.entries?.find((t=>!(t.participantId!==e||i&&i!==t.entryStatus||r&&r!==t.entryStage)));return e&&n}function hv(e){let{provisionalPositioning:t,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=e;if(!i)return{error:Jr};let{entryProfile:o}=Kh({drawDefinition:i}),s=a&&r&&o?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&o?.[a]?.qualifiersCount||0,c={};if(!n)return{qualifiersCount:s,roundQualifiersCounts:c};let{structure:d}=lf({drawDefinition:i,structureId:n}),u=i.links?.filter((e=>e?.target?.structureId===d?.structureId)),l=0;if(u?.length)for(let m of u){let e=lf({structureId:m.source.structureId,drawDefinition:i})?.structure;if(e?.stage===Su){let i=m.source.roundNumber,r=m.target.roundNumber,n=0;if(e.structureType===xu){n=(e.structures?.length??0)*(m.source.finishingPositions?.length??0)}else n=oy({matchUpFilters:{roundNumbers:[i]},structure:e,afterRecoveryTimes:!1,provisionalPositioning:t,inContext:!1}).matchUps?.length||0;c[r]||(c[r]=0),c[r]+=n,l+=n}}let p=Object.keys(c);if(p.length<=1){let e=p[0]||1;c[e]=Math.max(c[e]||0,s)}return l=Math.max(l,s),{qualifiersCount:l,roundQualifiersCounts:c}}function gv({stage:e,drawDefinition:t}){let{entryProfile:i}=Kh({drawDefinition:t});return i?.[e]?.drawSize||0}function Iv({stage:e,drawDefinition:t}){return!!(e===bu||hg({stage:e,drawDefinition:t})&&gv({stage:e,drawDefinition:t}))}function yv({entryStatus:e=Qh,drawDefinition:t,stageSequence:i,stage:r}){if(e===Xh)return function({stage:e,drawDefinition:t}){let{entryProfile:i}=Kh({drawDefinition:t});return i[e]?.alternates||0}({stage:r,drawDefinition:t})?{positionsAvailable:1/0,..._r}:{error:co};let n=function(e){let{provisionalPositioning:t,drawDefinition:i,stageSequence:r,stage:n}=e,a=gv({stage:n,drawDefinition:i}),{qualifiersCount:o}=hv({provisionalPositioning:t,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}({drawDefinition:t,stageSequence:i,stage:r}),a=function({stage:e,drawDefinition:t}){let{entryProfile:i}=Kh({drawDefinition:t});return i[e]?.wildcardsCount||0}({drawDefinition:t,stage:r}),o=gg({entryStatus:sg,drawDefinition:t,stage:r}),s=o+gg({entryStatus:Qh,drawDefinition:t,stage:r}),c=n-s;return r!==bu&&s>=n?{error:lo}:e===sg?o<a?{..._r}:{error:lo}:{positionsAvailable:c,..._r}}function vv(e){let t=dp(e,[{[Pl]:!0,[Ol]:!0}]);if(t.error)return t;let{suppressDuplicateEntries:i=!0,entryStatus:r=Qh,entryStageSequence:n,entryStage:a=vu,ignoreStageSpace:o,drawDefinition:s,entryPosition:c,participant:d,roundTarget:u,extensions:l,extension:p,drawType:m,event:f}=e,h="addDrawEntry";if(m!==Wu&&!Iv({stage:a,drawDefinition:s}))return Qs({result:{error:Gn},stack:h});let g=yv({stageSequence:n,stage:a,drawDefinition:s,entryStatus:r});if(!(o||g.success||m&&m===Wu))return{error:g.error};if(p&&!Bp({extension:p}))return Qs({result:{error:Ho},info:"Invalid extension",context:{extension:p},stack:h});let I=e.participantId||d?.participantId;if(!I)return Qs({result:{error:Ha},stack:h});let y=r===tg&&fv({participantId:I,drawDefinition:s,entryStatus:r}),v=a===bu&&fv({participantId:I,drawDefinition:s,entryStage:a}),S=fv({participantId:I,drawDefinition:s}),U=r!==tg&&a!==bu&&S;if(U)return i?(As({payload:{drawId:s.drawId,eventId:f?.eventId,error:Gr,participantId:I},topic:wf}),{..._r}):Qs({result:{error:Gr},context:{participantId:I},stack:h});if(y||v)return Qs({context:{invalidEntry:U,invalidLuckyLoser:y,invalidVoluntaryConsolation:v},result:{error:io},stack:h});let b=Js({entryStageSequence:n,participantId:I,entryPosition:c,entryStatus:r,entryStage:a,extensions:l});return p&&Vp({element:b,extension:p}),u&&Vp({extension:{name:"roundEntry",value:u},element:b}),s.entries||(s.entries=[]),s.entries.push(b),Zf({drawDefinition:s}),{..._r}}function Sv({suppressDuplicateEntries:e=!0,autoEntryPositions:t=!0,entryStageSequence:i,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:c,extension:d,drawId:u,event:l}){if(!n?.length)return{error:Ja};if(!l)return{error:Ln};if(!u)return{error:In};let p=(l.entries||[]).map(Om);if(n.filter((e=>!p.includes(e))).length)return{error:Bn};if(a){let u=function(e){let t="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=Qh,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:c,stage:d=vu,roundTarget:u,extension:l,event:p}=e,m=s.drawType===Wu;if(!d)return{error:$n};if(!s)return{error:Jr};if(!Array.isArray(o))return{error:Va};if(!m&&!Iv({stage:d,drawDefinition:s}))return{error:Gn};if(l&&!Bp({extension:l}))return Qs({result:{error:Ho},info:"Invalid extension",context:{extension:l},stack:t});let f=yv({drawDefinition:s,stageSequence:c,entryStatus:r,stage:d});if(!a&&!f.success&&!m)return{error:f.error};let h=f.positionsAvailable??0;if(!a&&!m&&d!==bu&&h<o.length)return{error:ro};let g=[],I=s.drawId,y=p?.eventId,v=o.reduce(((e,t)=>{let n=r===tg&&fv({participantId:t,drawDefinition:s,entryStatus:r}),a=d===bu&&fv({entryStage:d,drawDefinition:s,participantId:t}),o=fv({participantId:t,drawDefinition:s});return r!==tg&&d!==bu&&o&&(g.push(t),i&&As({payload:{error:Gr,participantId:t,eventId:y,drawId:I},topic:wf})),n||a?e.concat(t):e}),[]);return g.length&&!i?Qs({context:{eventId:y,drawId:I,duplicateEntries:g},result:{error:Gr},stack:t}):(o.filter((e=>e&&!v.includes(e))).forEach((e=>{let t={entryStageSequence:c,entryStage:d,participantId:e,entryStatus:r};l&&Vp({element:t,extension:l}),u&&Vp({extension:{name:hm,value:u},element:t}),s.entries||(s.entries=[]),s.entries.push(t)})),n&&(s.entries=Xy({entries:s.entries})),Zf({drawDefinition:s}),v?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:v,duplicateEntries:g,..._r}:{..._r})}({stageSequence:i,suppressDuplicateEntries:e,autoEntryPositions:t,stage:c,ignoreStageSpace:r,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,extension:d});if(u.error)return u}let{flightProfile:m}=XI({event:l}),f=m?.flights.find((e=>e.drawId===u));return f?.drawEntries&&(n.forEach((e=>{let t=o===tg&&Uv({participantId:e,entryStatus:o,flight:f}),i=c===bu&&Uv({participantId:e,entryStage:c,flight:f});(o===tg||c===bu||!Uv({flight:f,participantId:e}))&&!t&&!i&&f.drawEntries.push({participantId:e,entryStatus:o,entryStage:c})})),t&&(f.drawEntries=Xy({entries:f.drawEntries}))),{..._r}}function Uv({participantId:e,entryStatus:t,entryStage:i,flight:r}){let n=r.drawEntries?.find((r=>!(r.participantId!==e||t&&t!==r.entryStatus||i&&i!==r.entryStage)));return e&&n}function bv({autoEntryPositions:e=!0,participantIds:t=[],entryStatuses:i,stage:r,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:Fn};if(!Array.isArray(t)||t.some((e=>!Mr(e))))return Qs({result:{error:Ba},stack:a});let o=(n.drawDefinitions??[]).flatMap((e=>Ky({drawDefinition:e}).assignedParticipantIds??[])),s=(i?.length&&n.entries?.filter((e=>e.entryStatus&&i.includes(e.entryStatus)))||[]).map(Om).filter((e=>!o.includes(e))),c=(r&&n.entries?.filter((e=>e.entryStage&&e.entryStage===r))||[]).map(Om).filter((e=>!o.includes(e)));if(t.length?t=t.filter((e=>(!i?.length||s.includes(e))&&(!r||c.includes(e)))):s.length&&c.length?t=yr(s,c):s.length?t=s:c.length&&(t=c),t?.length&&o.some((e=>t.includes(e))))return Qs({result:{error:to},stack:a});if(!t?.length)return{..._r,participantIdsRemoved:[]};let d=[];n.entries=(n.entries??[]).filter((e=>{let i=!t.includes(e?.participantId);return i||d.push(e.participantId),i})),e&&(n.entries=Xy({entries:n.entries}));let{flightProfile:u}=XI({event:n});return u?.flights?.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!t.includes(e.participantId)))})),n.drawDefinitions?.forEach((e=>{e.entries=(e.entries??[]).filter((e=>!t.includes(e.participantId)))})),{..._r,participantIdsRemoved:d}}var wv={[wp]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Tv=wv;function Dv(e){let{suppressDuplicateEntries:t=!0,entryStatus:i=Qh,autoEntryPositions:r=!0,enforceGender:n=!0,entryStageSequence:a,policyDefinitions:o,entryStage:s=vu,tournamentRecord:c,ignoreStageSpace:d,drawDefinition:u,roundTarget:l,extensions:p,extension:m,drawId:f,event:h}=e,g="addEventEntries";if(!Array.isArray(e.participantIds))return Qs({result:{error:Va},stack:g});let I=ar(e.participantIds??[]);if(!h)return{error:Fn};if(!I?.length)return Qs({result:{error:Ja},stack:g});if(!h?.eventId)return{error:Ln};let y=Fh({tournamentRecord:c,event:h}).appliedPolicies??{},v=o?.[wp]??y?.[wp]??Tv[wp],S=!1!==(n??v?.participants?.enforceGender),U=[],b=[];if(p&&(!Array.isArray(p)||!p.every((e=>Bp({extension:e}))))||m&&!Bp({extension:m}))return Qs({context:Js({extension:m,extensions:p}),result:{error:Ho},info:"Invalid extension(s)",stack:g});let w,T=!!c,D=[],P=c?.participants?.filter((e=>{if(!I.includes(e.participantId))return!1;let t=yI(Bi)(h.eventType)&&e.participantType===ph&&!Jy(i),r=h.eventType===ji&&e.participantType===fh;return!!(t&&(!h.gender||!S||oc(h.gender)||sc(h.gender)||cc(h.gender)===cc(e.person?.sex))||r&&!Jy(i))||(h.eventType===ji&&e.participantType===ph&&Jy(i)?!(h.gender&&S&&!oc(h.gender)&&!sc(h.gender)&&cc(h.gender)!==cc(e.person?.sex))||(D.push({participantId:e.participantId,sex:e.person?.sex}),!1):t&&h.gender&&S&&!oc(h.gender)&&!sc(h.gender)&&cc(h.gender)!==cc(e.person?.sex)?(D.push({participantId:e.participantId,sex:e.person?.sex}),!1):h.eventType===hh&&(e.participantType===hh||Jy(i)&&e.participantType===ph))})).map((e=>e.participantId))??[],N=I.filter((e=>!T||P.includes(e)));h.entries||(h.entries=[]);let E=h.entries.map((e=>e.participantId||e.participant?.participantId));if(N.forEach((e=>{if(!E.includes(e)){let t=Js({participantId:e,entryStatus:i,entryStage:s,extensions:p});m&&Vp({element:t,extension:m}),l&&Vp({extension:{name:hm,value:l},element:t}),a&&(t.entryStageSequence=a),U.push(t.participantId),h.entries?.push(t)}})),f&&!Jy(s)){let e=Sv({participantIds:N,suppressDuplicateEntries:t,autoEntryPositions:r,entryStageSequence:a,ignoreStageSpace:d,drawDefinition:u,entryStatus:i,roundTarget:l,entryStage:s,extension:m,drawId:f,event:h});e.error&&(w=e.error)}if(h.eventType&&[hu,Iu].includes(h.eventType)){let e=(h.entries||[]).map((e=>e.participantId)),t=(h.entries||[]).filter((e=>Jy(e.entryStatus))).map((e=>e.participantId)),i=(c?.participants??[]).filter((t=>e.includes(t.participantId)&&t.participantType&&[fh,hh].includes(t.participantType))).map((e=>e.individualParticipantIds)).flat(1/0),r=t.filter((e=>i.includes(e)));r.length&&(b.push(...r),bv({participantIds:r,autoEntryPositions:!1,event:h}))}if(N.length!==I.length)return Qs({context:{mismatchedGender:D,gender:h.gender},result:{error:Va},stack:g});r&&(h.entries=Xy({entries:h.entries||[]}));let M=U.length,R=b.length;return Qs({result:{..._r,addedEntriesCount:M,removedEntriesCount:R},stack:g,info:w})}var Pv="ADMINISTRATION",Nv="COMPETITOR",Ev="MEDIA",Mv="MEDICAL",Rv="OFFICIAL",Cv="OTHER",Av="SECURITY",kv={ADMINISTRATION:Pv,CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR:Nv,MEDIA:Ev,MEDICAL:Mv,OFFICIAL:Rv,OTHER:Cv,SECURITY:Av};function Ov({addIndividualParticipantsToEvents:e,individualParticipantIds:t,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return Qs({result:{error:zr},stack:a});if(!i||!t)return Qs({result:{error:va},stack:a});let o=(r.participants??[]).find((e=>e.participantId===i));if(!o)return Qs({result:{error:Ya},stack:a});if(![hh,mh].includes(o.participantType))return Qs({result:{participantType:o.participantType,error:$a},stack:a});let s=xv({individualParticipantIds:t,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:c,error:d}=s;if(d)return Qs({result:s,stack:a});if(e)for(let u of r.events??[]){let e=(u.entries??[]).map((({participantId:e})=>e)).filter(Boolean);if(e.includes(i)){let t=c?.filter((t=>!e.includes(t)));Dv({participantIds:t,entryStatus:ag,tournamentRecord:r,event:u})}}return c&&As({topic:Af,payload:{tournamentId:r.tournamentId,participants:[o]}}),{..._r,...s}}function xv({individualParticipantIds:e=[],groupingParticipant:t,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){let o=[];if(!t)return{removed:o};let s=[],c=[];a||({participants:a,mappedMatchUps:n}=mv({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=a?.find((({participantId:e})=>e===t.participantId))?.events?.map((({eventId:e})=>e)),u=(t.individualParticipantIds??[]).filter((r=>{let u=e?.includes(r),l=u&&a?.find((e=>e.participantId===r))?.matchUps.filter((({eventId:e})=>d.includes(e))).map((({matchUpId:e})=>n?.[e])).filter((({winningSide:e,score:t})=>e||My({score:t}))),p=u&&!l?.length;if(u&&!p&&c.push(r),p){o.push(r);for(let e of i.events??[])for(let n of e.drawDefinitions??[]){let{extension:e}=Jp({element:n,name:dm}),a=e?.value[t.participantId];e&&a&&(e.value[t.participantId]=a.filter((e=>e.participantId!==r)),Vp({element:n,extension:e}),Qf({drawDefinition:n}));let o=by({drawDefinition:n,inContext:!1}).matchUps??[];for(let t of o){let e=t.sides??[];for(let a of e){let e=a.lineUp??[];e.find((e=>e.participantId===r))&&(a.lineUp=e.filter((e=>e.participantId!==r)),Jf({tournamentId:i?.tournamentId,drawDefinition:n,matchUp:t}))}}}}else s.push(r);return!p}));t.individualParticipantIds=u;let l={groupingParticipantId:t.participantId,cannotRemove:c,notRemoved:s,removed:o};return c.length&&!r&&{...l,cannotRemove:c,error:xa}||l}function Fv({participantRole:e=Nv,individualParticipantIds:t=[],groupingTypes:i=[lh,mh],tournamentRecord:r}){if(!r)return{error:zr};let n=r.participants??[],{participants:a,mappedMatchUps:o}=mv({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter((t=>(t.participantRole===e||!t.participantRole)&&t.participantType&&i.includes(t.participantType))).forEach((e=>{let{removed:i}=xv({groupingParticipant:e,individualParticipantIds:t,tournamentRecord:r,mappedMatchUps:o,participants:a});i&&s++})),s?_r:{error:Xa}}function Lv(e){let t=dp(e,[{[Tl]:!0},{participantIds:!0,[rp]:Zl,[Yl]:Ja}]);if(t.error)return t;let{addIndividualParticipantsToEvents:i,tournamentRecord:r,participantIds:n}=e,a=r.participants?.length||0;if(!a)return{..._r};let o=(r.events||[])?.filter((({eventType:e})=>e===gu)).map((e=>e?.drawDefinitions?.map((({drawId:e})=>e)))).flat(1/0),s=mv({participantFilters:{participantIds:n},tournamentRecord:r,withDraws:!0}).participants??[],c=o?.length?yr((vy({matchUpFilters:{drawIds:o,matchUpTypes:[ji]},tournamentRecord:r}).matchUps??[]).flatMap((({sides:e})=>e?.map((({participantId:e})=>e||[])))).filter(Boolean),n):[],d=s.filter((e=>e.draws?.filter((e=>(!o?.length||!o?.includes(e.drawId))&&e.positionAssignments)).length));if(c?.length||d.length)return{error:to};let u={},l={};for(let m of r.events||[]){let e=bv({participantIds:n,event:m});if(e.error)return e;u[m.eventId]=e.participantIdsRemoved}r.participants=(r.participants??[]).filter((e=>{let t=n.includes(e.participantId)||e.participantType===fh&&e.individualParticipantIds?.some((e=>n.includes(e)));if(!t&&e.participantType===gu&&e.individualParticipantIds?.some((e=>n.includes(e)))&&(e.individualParticipantIds=e.individualParticipantIds.filter((e=>!n.includes(e)))),t&&i&&e.participantType&&[fh,hh].includes(e.participantType))for(let i of e.individualParticipantIds||[])n.includes(i)||(l[e.participantId]||(l[e.participantId]=[]),l[e.participantId].push(i));return!t}));let p=a-r.participants.length;if(Fv({individualParticipantIds:n,tournamentRecord:r}),i)for(let m of r.events||[]){Dv({participantIds:u[m.eventId].map((e=>l[e]||[])).flat(),entryStatus:ag,tournamentRecord:r,event:m})}return p&&As({payload:{participantIds:n,tournamentId:r.tournamentId},topic:Tf}),p?{..._r,participantsRemovedCount:p}:{error:xa}}function _v({selected:e=!0,drawDefinition:t,entryStatuses:i,drawId:r,event:n,stage:a}){let o=n.entries??[];if(r){let{flightProfile:e}=XI({event:n}),i=e?.flights?.find((e=>e.drawId===r));i?o=i.drawEntries:t.entries&&(o=t?.entries)}let s=o.filter((t=>(!i?.length||!t.entryStatus||i.includes(t.entryStatus))&&(!a||!t.entryStage||t.entryStage===a)&&(!e||t.entryStatus&&pg.includes(t.entryStatus))));return{entries:o,stageEntries:s}}function Bv({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){let s="destroyGroupEntry";if(!t)return{error:zr};if(!r)return Qs({result:{error:Ha},stack:s});if(!o)return{error:Fn};if(!o.eventType||![hu,Iu].includes(o.eventType))return Qs({result:{error:xn},stack:s});let c=t.participants??[],d=c.find((e=>e.participantId===r));if(!d)return Qs({result:{error:Ya},stack:s});if(!d.participantType||![fh,lh].includes(d.participantType)||d.participantType===lh&&o.eventType!==Iu||d.participantType===fh&&o.eventType!==hu)return{error:$a};let u=(o.entries??[]).find((e=>e.participantId===r));if(!u)return{error:ao};let l,{stageEntries:p}=_v({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),m=p.map(Om),f=c.filter((({participantId:e})=>m.includes(e))).map((({individualParticipantIds:e})=>e)).flat().filter(Boolean),h=d.individualParticipantIds?.filter((e=>1===Ir(e,f).length)),g=bv({participantIds:[r],event:o});return g.error||h?.length&&(g=Dv({participantIds:h,entryStatus:ag,entryStage:u.entryStage,tournamentRecord:t,drawDefinition:i,drawId:n,event:o}),g.error)?g:(e&&Lv({participantIds:[r],tournamentRecord:t}).success&&(l=!0),{..._r,participantRemoved:l})}function Vv({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:r,drawId:n,event:a}){return Bv({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:r,drawId:n,event:a})}function jv(e){if(!e.tournamentRecord)return{error:zr};let{participantIds:t,...i}=e,r=0,n=[];for(let a of t){let e=Bv({participantId:a,...i});e.success&&(r+=1),e.error&&n.push(e.error)}return r?{destroyedCount:r,..._r}:{error:n}}function $v(e){let{tournamentRecord:t,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=e,c="removeDrawPositionAssignment",d=Hy(e);if(d.error)return Qs({result:d,stack:c});let{participantId:u}=d,{drawPosition:l,event:p,structureId:m}=e,f=Fh({tournamentRecord:t,drawDefinition:r,event:p}).appliedPolicies??{};if([Xh,cg].includes(a)&&u){let{tournamentRecord:t}=e,{participant:i}=bh({tournamentRecord:t,participantId:u}),{participantType:o,individualParticipantIds:d}=i??{};if(n&&o===fh){let e=Vv({tournamentRecord:t,drawDefinition:r,participantId:u,event:p});if(e.error)return Qs({result:e,stack:c});d&&Qy({participantIds:d,tournamentRecord:t,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else Qy({participantIds:[u],tournamentRecord:t,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let e=Vy({tournamentRecord:t,drawDefinition:r,drawPosition:l,structureId:m,matchUpsMap:o,event:p});if(e.error)return Qs({result:e,stack:c})}let{structure:h}=lf({drawDefinition:r,structureId:m});return rh({structure:h,drawPositions:[l]}),nh({appliedPolicies:f,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:l,entryStatus:a,structureId:m}}),d}function Gv(e){return Object.assign(e,{entryStatus:cg}),$v(e)}var Wv=({finishingPosition:e=yl,hasExistingDrawDefinition:t,qualifyingRoundNumber:i,structureAbbreviation:r,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:o,structureOrder:s,seedingProfile:c,matchUpFormat:d,structureType:u,structureName:l,matchUps:p=[],matchUpType:m,structureId:f,roundOffset:h,roundLimit:g,stageOrder:I,structures:y,tieFormat:v,stage:S})=>{let U={structureId:f??Ud(),structureAbbreviation:r,finishingPosition:e,seedAssignments:n,matchUpFormat:d,stageSequence:a,structureName:l};(o||t&&v)&&(U.tieFormat=v),s&&(U.structureOrder=s),u&&(U.structureType=u),c&&("string"==typeof c?U.seedingProfile=c:"object"==typeof c&&"string"==typeof c.positioning&&(U.seedingProfile=c.positioning)),m&&(U.matchUpType=m),h&&(U.roundOffset=h),I&&(U.stageOrder=I),g&&(U.roundLimit=g),S&&(U.stage=S),i&&(U.qualifyingRoundNumber=i);let b=p.flatMap((({drawPositions:e})=>e)).filter(Boolean);return y?U.structures=y:(U.matchUps=p,U.positionAssignments=ar(b).sort(((e,t)=>e-t)).map((e=>({drawPosition:e})))),U},qv=Wv;function Hv(e){return Mr(e)?e.split(" ").map((e=>e.split("").map(((e,t)=>t?e.toLowerCase():e.toUpperCase())).join(""))).join(" "):e}function zv(e){return Mr(e)?Hv(e.replace(/_/g," ")):""}function Yv({structureName:e=zv(bu),structureAbbreviation:t,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:Jr};let a=qv({stage:bu,structureAbbreviation:t,structureName:e,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),Zf({drawDefinition:i,structureIds:[a.structureId]}),{..._r}}function Kv({positioning:e,size:t}){let i=function({size:e}){let t=[e],i=e;for(;i/2===Math.floor(i/2);)i/=2,t.push(i);return t.includes(1)||t.push(1),t.sort(Hi),t.reverse(),t}({size:t}),r=[],n=[],a=e=>e[0],o=(t,i)=>(e&&[Ru,Cu,ku].includes(e)&&i%2?(e=>e[e.length-1])(t):a(t))||a(t),s=(e,t)=>{if(e.every((e=>!n.includes(e)))){let i=o(e,t);return n.push(i),i}},c=e=>{let t=e.filter((e=>!n.includes(e)));if(t.length)return n.push(...t),t},d=(e,t)=>{let i=o(e,t);if(!n.includes(i))return n.push(i),i},u=gr(1,t+1);for(let l of i)if(1===l){let e=wr(u,2),t=e.map(s).filter(Boolean);t.length&&r.push(t);let i=e.flatMap(c).filter(Boolean);i.length&&r.push(i)}else{let e=wr(u,l).map(d).filter(Boolean);e.length&&r.push(e)}return{divisions:i,divisionGroupings:r}}function Xv({drawPositions:e}){if(!e?.length)return{error:cn};let t=[].concat(...(e??[]).map((t=>e.filter((e=>e!==t)).map((e=>[t,e]))))),i=ar(t.map(Jv)).map((e=>e.split("|").map((e=>+e))));return{groupMatchUps:t,uniqueMatchUpGroupings:i}}function Jv(e=[]){return Array.isArray(e)&&e.length?[...e].sort(Hi).join("|"):""}function Qv({groupSize:e,drawPositionOffset:t}){if(!e)return[];let i=e=>[...Array(e)].map(((e,t)=>t)),r=i(2*Math.round(e/2)+1).slice(1),n=i(r.length-1).map((()=>[])),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach(((e,t)=>{a.forEach(((e,i)=>{n[t].push([a[i],o[i]])}));let i=a.shift(),r=a.pop(),s=o.shift();a=[i,s,...a].filter(Boolean),o=[...o,r].filter(Boolean)}));let s=a.shift(),c=a.pop(),d=o.shift();a=[s,d,...a].filter(Boolean),o=[...o,c].filter(Boolean);let u=e=>e[0].reduce(((e,t)=>e+t));return[...n].reverse().sort(((e,t)=>u(e)-u(t))).map((i=>i.filter((t=>t.every((t=>t<=e)))).map((e=>Jv(e.map((e=>e+t)))))))}var Zv={getRoundRobinGroupMatchUps:Xv,determineRoundNumber:function({rounds:e,hash:t}){return e?.length?e?.reduce(((e,i,r)=>i.includes(t)?r+1:e),void 0):{error:va}},drawPositionsHash:Jv,groupRounds:Qv};function eS(e){let t,{hasExistingDrawDefinition:i,groupNameBase:r="Group",playoffAttributes:n,stageSequence:a=1,structureOptions:o,appliedPolicies:s,qualifyingOnly:c,seedingProfile:d,stage:u=vu,matchUpType:l,roundTarget:p,structureId:m,groupNames:f,tieFormat:h,drawSize:g,idPrefix:I,isMock:y,uuids:v}=e,S=e.structureName??n?.[0]?.name??zv(vu),{groupCount:U,groupSize:b}=function({appliedPolicies:e,structureOptions:t,drawSize:i}){let r=t?.groupSize,n=t?.groupSizeLimit||8,{validGroupSizes:a}=tS({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&a?.includes(r)||(r=r&&r>4||!a?.includes(4)?o:4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}({structureOptions:o,appliedPolicies:s,drawSize:g}),w=Il,T=gr(1,U+1).map((e=>{let n=function({structureOrder:e,matchUpType:t,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(e-1)*i,c=gr(1+s,i+1+s),d=Xv({drawPositions:c}).uniqueMatchUpGroupings??[],u=Qv({groupSize:i,drawPositionOffset:s});return d.map(p).sort(((e,t)=>(e.roundNumber??1/0)-(t.roundNumber??1/0)));function l(e){return u.reduce(((t,i,r)=>i.includes(e)?r+1:t),void 0)}function p(i){let s=l(Jv(i)),c=[1,r],d=function({structureOrder:e,drawPositions:t,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${e}-${i}-DP-${t.join("-")}`:n?.pop()||Ud()}({structureOrder:e,drawPositions:i,roundNumber:s,idPrefix:n,uuids:o}),u={matchUpStatus:s?Jm:"BYE",matchUpType:t,finishingPositionRange:{winner:c,loser:c},drawPositions:i,roundNumber:s,matchUpId:d};return a&&(u.isMock=!0),u}}({groupSize:b,structureOrder:e,matchUpType:l,drawSize:g,idPrefix:I,isMock:y});t=Array.isArray(n)?Math.max(...n.map((({roundNumber:e})=>e??0))):0;let a=f?.[e-1]??`${r} ${e}`;return Wv({structureId:v?.pop(),hasExistingDrawDefinition:i,structureType:Ou,finishingPosition:w,qualifyingOnly:c,structureOrder:e,structureName:a,tieFormat:h,matchUps:n})})),D=Wv({structureId:m??v?.pop(),hasExistingDrawDefinition:i,structureType:xu,finishingPosition:w,seedingProfile:d,structureName:S,stageSequence:a,structures:T,tieFormat:h,stage:u});return p&&Vp({extension:{name:hm,value:p},element:D}),{structures:[D],maxRoundNumber:t,groupCount:U,links:[],groupSize:b,..._r}}function tS(e){let{groupSizeLimit:t=10,drawSize:i=0}=e??{},r=gr(3,t+1).filter((e=>{let t=Math.ceil(i/e),r=t*e-i,n=Math.ceil(i/t),a=Math.ceil(r/t);return(!r||r<e)&&n===e&&n>=3&&a<2}));return{..._r,validGroupSizes:r}}function iS(e){let{roundRobinGroupsCount:t,participantsCount:i,cluster:r}=e;if(!ir(i))return{seedBlocks:void 0,...Qs({result:{error:Ho},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=er(i);if(t){let e=Math.min(t,n),i=[],r=1;for(gr(0,e).forEach((()=>{i.push([r]),r++}));r<n;){let t=gr(r,r+e);r+=e,i.push(t)}return{..._r,seedBlocks:i}}let a=gr(1,n+1),o=[],s=n/2;for(;s>1;){let e=wr(a,s),t=e.length;e.forEach(((e,i)=>{let n,a=i<t/2,s=i%2==0,c=e[0],d=e[e.length-1];n=r&&t>4?8===t?a?d:c:s?c:d:a?c:d,Sr(e,o)||o.push(n)})),s/=2}let c=a.filter((e=>!o.includes(e)));for(;c.length;)c.length%2==0?o.push(c.pop()):o.push(c.shift());let d=gr(0,20).map((e=>Math.pow(2,e)));d.unshift(1);let u=d.indexOf(n),l=0,p=[];return gr(0,u).forEach((e=>{p.push(o.slice(l,l+d[e])),l+=d[e]})),{..._r,seedBlocks:p}}function rS({roundRobinGroupsCount:e,drawSize:t}){let i="getSeedGroups";if(!ir(t))return{seedGroups:void 0,...Qs({result:{error:Ho},context:{drawSize:t},stack:i})};if(e){if(!ir(e))return{seedGroups:void 0,...Qs({context:{roundRobinGroupsCount:e},result:{error:Ho},stack:i})};let r=1;return{seedGroups:gr(0,Math.floor(t/e)).map((()=>{let t=gr(r,r+e);return r+=e,t}))}}{let{seedBlocks:i}=iS({participantsCount:t,roundRobinGroupsCount:e}),r=0;return{seedGroups:(i||[]).map((e=>(e||[]).map((()=>(r+=1,r)))))}}}function nS({roundRobinGroupsCount:e,participantsCount:t}){if(e){let{validGroupSizes:i}=tS({drawSize:t});if(!i?.map((e=>Math.ceil(t/e)))?.includes(e))return Qs({context:{roundRobinGroupsCount:e},result:{error:Ho}})}let{seedGroups:i}=rS({drawSize:t,roundRobinGroupsCount:e}),r=i?.map((e=>Math.min(...e)))||[];return{..._r,seedingThresholds:r}}function aS(e){if(!e)return 1/0;if(ir(e))return zi(e);let t=e.split("-")[0];return ir(t)?zi(t):1/0}function oS({provisionalPositioning:e,returnAllProxies:t,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){let s=[];if(!o)return{error:An};let{matchUps:c,roundMatchUps:d}=oy({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:e,structure:o}),{seedAssignments:u}=yg({provisionalPositioning:e,returnAllProxies:t,drawDefinition:n,structure:o}),{positionAssignments:l}=hf({structure:o}),p=l?.length,m=u?.length??0,f=[],h=Object.keys(d).map((e=>parseInt(e))).sort(((e,t)=>e-t)).map((e=>{let t=d[e].map((e=>e.drawPositions)).flat(1/0).filter(Boolean),i=t.filter((e=>!f.includes(e)));return f=f.concat(...t),i})).filter((e=>e.length)).reverse(),g=h.pop()??[],I=g&&Math.min(...g)-1||0;r=r??i?.seeding?.seedingProfile;let y=g?.length||0,v=h.filter((e=>e.filter((e=>e<=m)).length)),{stage:S,structureType:U,roundLimit:b}=o,w=U===xu,T=!w&&h?.length,D=!w&&S===Su&&b,P=v.flat(1/0),N=T?P?.length:0,E=a?p:m,M=Rg({drawDefinition:n,structure:o,matchUps:c}),R=M?0:!T&&E||E&&P.length<E&&E-P.length||0;if(D){let e=o?.matchUps?o.matchUps.filter((({roundNumber:e})=>e===o.roundLimit)).length:0,t=g.length/e;if(!T){let e=uS(r),i=wr(g,t),n=1,a=gr(0,i[0].length).map((()=>{let e=gr(n,n+i.length);return n+=i.length,e}));({validSeedBlocks:s}=sS({drawPositionBlocks:i,nonRandom:r?.nonRandom,positioning:e,seedGroups:a}))}}else w?({validSeedBlocks:s}=function({seedingProfile:e,structure:t,nonRandom:i}){let r=t.structures||[],n=r.length,a=ff({structure:t})?.positionAssignments,o=uS(e),s=a?.length??0,{seedGroups:c}=rS({roundRobinGroupsCount:n,drawSize:s}),d=r.map((e=>ff({structure:e}).positionAssignments?.map((e=>e.drawPosition))));return sS({drawPositionBlocks:d,positioning:o,seedGroups:c,nonRandom:i})}({nonRandom:r?.nonRandom,seedingProfile:r,structure:o})):T?s=v.map((e=>({seedNumbers:e,drawPositions:e}))):M&&wr(g,2).map(((e,t)=>({drawPositions:[e[0]],seedNumbers:[t+1]}))).forEach((e=>s.push(e)));if(!w&&!M&&!D){let{blocks:e}=function(e){let{drawPositionOffset:t=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=e,s=1,c=[],{seedBlocks:d}=iS({cluster:[Ru,Cu].includes(uS(n)),participantsCount:o,roundRobinGroupsCount:i});s=0;for(let l of d){if(s+1>a)break;let e=l.map((e=>e+t)),i=u(s+1,l.length).map((e=>+e+r));s+=l.length,c.push({drawPositions:e,seedNumbers:i})}return{blocks:c};function u(e,t){return Array.from(new Array(t),((t,i)=>i+e))}}({drawPositionOffset:I,seedNumberOffset:N,seedCountGoal:R,seedingProfile:r,baseDrawSize:y});e.forEach((e=>s.push(e)))}let C=s.flatMap((e=>e.drawPositions)).reduce(((e,t)=>g?.includes(t)&&e),!0);return M||T||w||C?{isLuckyStructure:M,validSeedBlocks:s,isContainer:w,isFeedIn:T}:{error:Pn,validSeedBlocks:[],isContainer:w,isFeedIn:T}}function sS({drawPositionBlocks:e,positioning:t,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=Kv({size:i.length,positioning:t}),o=[];return i.forEach(((i,s)=>{let c=function({blockPattern:e,index:t}){let i=0;for(let r of e){if(i===t)return r;let e=0;for(;e<r.length;){if(i===t)return r;i+=1,e++}}}({blockPattern:a,index:s});i.forEach(((i,a)=>{let d=s%2?e.length-a-1:a,u=e[d].slice().filter(((e,t)=>c.includes(t+1)&&e));t!==ku?u=r?u:sr(u):s%2&&u.reverse();let l=u.find((e=>!o.includes(e)));l&&(o.push(l),n.push({drawPositions:[l],seedNumbers:[i]}))}))})),{validSeedBlocks:n}}function cS({appliedPolicies:e,drawDefinition:t,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){let{structure:o}=lf({drawDefinition:t,structureId:n});e||(e=Fh({drawDefinition:t}).appliedPolicies);let s=i?.validSeedBlocks;return!s&&o&&(s=oS({appliedPolicies:e,drawDefinition:t,structure:o})?.validSeedBlocks),!!e?.seeding?.validSeedPositions?.ignore||(e?.seeding?.validSeedPositions?.strict?(s.find((e=>e.seedNumbers.includes(a)))?.drawPositions||[]).includes(r):[].concat(...s.map((e=>e.drawPositions))).includes(r))}function dS(e){let{provisionalPositioning:t,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:o}=e,{structure:s}=lf({drawDefinition:i,structureId:a}),{seedAssignments:c}=yg({returnAllProxies:e.returnAllProxies,provisionalPositioning:t,drawDefinition:i,structure:s}),{positionAssignments:d}=hf({structure:s}),u=d?.filter((e=>e.participantId??e.bye??e.qualifier))?.map((e=>e.drawPosition)).filter(Boolean),{appliedPolicies:l}=Fh({drawDefinition:i}),p=(n?.validSeedBlocks||s&&oS({returnAllProxies:e.returnAllProxies,provisionalPositioning:t,appliedPolicies:l,drawDefinition:i,seedingProfile:r,structure:s})?.validSeedBlocks||[]).filter((e=>e.drawPositions.filter((e=>!u?.includes(e))).length))[0],m=c?.map((e=>e.participantId)).filter(Boolean),f=d?.map((e=>e.participantId)).filter(Boolean),h=m?.filter((e=>f?.includes(e))),g=m?.filter((e=>!f?.includes(e))),I=c?.filter((e=>g?.includes(e.participantId))),y=c?.filter((e=>!e.participantId)),v=(I?.length&&I.length>0?I.length:y?.length??0)&&p?.drawPositions.filter((e=>!u?.includes(e)))||[],S=o?sr(v):v,U=[],b=S.map((()=>{let e=function(e,t){let i=e.filter((e=>!t.includes(e.participantId))),r=Math.min(...i.map((e=>aS(e.seedValue))));return sr(i.filter((e=>aS(e.seedValue)===r))).pop()}(I,U)?.participantId;return e&&U.push(e),e})).filter(Boolean),w=c?.filter((e=>h?.includes(e.participantId))).map((e=>e.seedNumber)),T=(p?.seedNumbers||[]).filter((e=>!w?.includes(e))),D=c?.filter((e=>T.includes(e.seedNumber))).map((e=>e.participantId)),P=l?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:void 0===P||P?b:D,unplacedSeedNumbers:T,unfilledPositions:S,unplacedSeedAssignments:I}}function uS(e){return"string"==typeof e?e:"object"==typeof e?e.positioning:void 0}function lS({provisionalPositioning:e,tournamentRecord:t,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:c,eventId:d,event:u}){let l="assignSeed",{structure:p}=lf({drawDefinition:i,structureId:o}),{positionAssignments:m}=hf({structure:p}),f=yg({provisionalPositioning:e,drawDefinition:i,structure:p}).seedAssignments,h=f.map((e=>e.seedNumber)),g=fv({drawDefinition:i,participantId:n});if(n&&!g)return Qs({result:{error:Ba},context:{participantId:n},stack:l});let I,y=u?XI({event:u}).flightProfile?.flights?.length:0,v=y&&y>1,S=m?.find((e=>e.participantId===n))?.drawPosition;return S&&!cS({drawPosition:S,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s})?Qs({result:{error:rn},context:{assignedDrawPosition:S},info:"invalid seed position",stack:l}):(h.includes(s)||f.push({seedNumber:s,seedValue:c}),f.forEach((e=>{e.participantId===n&&e.seedNumber!==s&&(e.participantId=void 0),e.seedNumber===s&&(e.participantId=n,!r?.groupSeedingThreshold&&!v&&(e.seedValue=c??s),I=!0)})),I?(eh({tournamentId:t?.tournamentId,drawDefinition:i,structure:p,eventId:d}),{..._r}):Qs({result:{error:Dn},stack:l}))}function pS({inContextTargetMatchUp:e,drawPositionSideIndex:t,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){let s=e?.sides?.[t]?.sideNumber,c=s&&a.sides?.find((e=>e.sideNumber===s)),{extension:d}=Jp({element:n,name:dm}),u=yd((d?.value||{})[i],!1,!0);if(c)a?.sides?.forEach((e=>{e.sideNumber===s&&(e.lineUp=u)}));else{a.sides=[1,2].map((e=>({...a.sides?.find((t=>t.sideNumber===e))??{},sideNumber:e})));let e=a.sides.find((e=>e.sideNumber===s));e&&(e.lineUp=u)}Jf({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:o?.eventId,drawDefinition:n,matchUp:a})}function mS(e){let{sourceMatchUp:t}=e,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=e,o=i.roundNumber>1&&i.roundNumber-1,s=wg({structureId:r.structureId,matchUpsMap:n});!t&&a&&(t=s.find((({drawPositions:e,roundNumber:t})=>t===o&&e?.includes(a))));let c=t?.roundPosition,d=c+(c%2?1:-1),u=o&&s.find((({roundNumber:e,roundPosition:t})=>e===o&&t===d)),l=u?.matchUpStatus;return{pairedPreviousMatchUp:u,pairedPreviousMatchUpIsDoubleExit:[qm,Wm].includes(l)}}function fS({structureId:e,matchUpsMap:t,matchUp:i}){let r=i?.roundPosition,n=r+(r%2?1:-1);return{pairedPreviousMatchUp:wg({matchUpsMap:t,structureId:e}).find((({roundNumber:e,roundPosition:t})=>e===i?.roundNumber&&t===n))}}function hS({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=e.find((e=>e.matchUpId===i)),{pairedPreviousMatchUp:o}=fS({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let i=o?.matchUpId,r=e.find((e=>e.matchUpId===i)),s=a?.structureId===r?.structureId?a?.roundPosition<r?.roundPosition?1:2:a.structureId===r?.structureId?2:1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map((e=>{let i=Mr(e)||!isNaN(e)?{code:e}:e;return i.sideNumber===s?{...i,previousMatchUpStatus:t}:i}))}}function gS({inContextDrawMatchUps:e,drawPosition:t,matchUpId:i}){let r=e.filter((({winnerMatchUpId:e,loserMatchUpId:t})=>t===i||e===i)).sort(((e,t)=>e.roundPosition-t.roundPosition));return e.find((e=>e.matchUpId===i)).feedRound?1:r.reduce(((e,i,r)=>i.drawPositions?.includes(t)?r+1:e),void 0)}function IS({inContextDrawMatchUps:e,sourceMatchUpStatus:t,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:c,event:d}){let u="assignMatchUpDrawPosition";s||(s=bg({drawDefinition:n})),e||(e=gy({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let l=e.find((e=>e.matchUpId===c)),p=l?.structureId,m=n?.structures?.find((e=>e.structureId===p));if(!m)return{error:Rn};let f=s?.drawMatchUps?.find((e=>e.matchUpId===c)),h=f?.drawPositions??[],{positionAdded:g,positionAssigned:I,updatedDrawPositions:y}=function({drawPosition:e,drawPositions:t}){let i=!1,r=!!t?.includes(e);return{updatedDrawPositions:r?t||[]:[...t,void 0,void 0].slice(0,2).map((t=>t||r?t:(r=!0,i=!0,e))).sort(Hi).filter(Boolean),positionAdded:i,positionAssigned:r}}({drawPositions:h,drawPosition:o}),{positionAssignments:v}=ff({drawDefinition:n,structure:m}),S=v?.filter((e=>y.includes(e.drawPosition)))?.find((({bye:e})=>e)),U=f?.matchUpStatus&&By(f.matchUpStatus)&&y.filter(Boolean).length<2;a=(S?"BYE":a)||U&&f.matchUpStatus||f?.matchUpStatus&&[qm,Wm].includes(f.matchUpStatus)&&f.matchUpStatus||Jm;let b=!(!By(f?.matchUpStatus)||!f?.winningSide);if(f&&g){e=gy({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let d=U&&gS({inContextDrawMatchUps:e,drawPosition:o,matchUpId:c})||b&&f.winningSide||void 0;f?.matchUpStatusCodes&&hS({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:r,matchUpsMap:s,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:d,matchUpStatus:b?f?.matchUpStatus:a}),Jf({tournamentId:i?.tournamentId,eventId:l?.eventId,context:u,drawDefinition:n,matchUp:f})}let w=py({inContextDrawMatchUps:e,inContextMatchUp:l,drawDefinition:n,matchUpId:c}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:D,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:N}}=w,E=wg({structureId:m.structureId,matchUpsMap:s});if(I&&S){if(T)if(["BYE",qm,Wm].includes(a)){let t=IS({matchUpId:T.matchUpId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(t.error)return t}else{let{structureId:e}=T;e!==m.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(I&&b){if(T){let t=IS({matchUpId:T.matchUpId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(t.error)return t}}else if(T&&l&&!l.feedRound){let{pairedPreviousMatchUpIsDoubleExit:t}=mS({targetMatchUp:f,drawPosition:o,matchUpsMap:s,structure:m});if(t){let t=IS({matchUpId:T.matchUpId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(t.error)return t}}if(f?.matchUpType===Gi){let t=e?.find((({matchUpId:e})=>e===f.matchUpId)),r=(t?.sides??[]).reduce(((e,t,i)=>t.drawPosition===o?i:e),void 0),a=v?.find((e=>e.drawPosition===o))?.participantId;a&&void 0!==r&&pS({inContextTargetMatchUp:t,drawPositionSideIndex:r,teamParticipantId:a,tournamentRecord:i,drawDefinition:n,matchUp:f})}if(N?.linkCondition===Gu&&2===y.filter(Boolean).length&&!S&&E.filter((({drawPositions:e,roundNumber:t})=>1===t&&Sr(e,y))).every((({matchUpStatus:e})=>[jm,Km].includes(e)))&&D){let{structureId:e}=D,t=Vy({drawPosition:P,tournamentRecord:i,drawDefinition:n,structureId:e,matchUpsMap:s,event:d});if(t.error)return t}return I?{..._r}:Qs({result:{error:nn},context:{drawPosition:o},stack:u})}function yS({inContextDrawMatchUps:e,drawDefinition:t,assignments:i,matchUpsMap:r,structure:n}){let a=ah({drawDefinition:t})?.containedStructures?.[n.structureId]?.map((({structureId:e})=>e))||[];a.push(n?.structureId);let o=i?.map((({drawPosition:e})=>e))||[],s=e?.filter((e=>a.includes(e.structureId)&&yr(e.drawPositions??[],o).length))??[],c=s.map((({matchUpId:e})=>e)),d=r?.drawMatchUps?.filter((e=>c.includes(e.matchUpId)))??[];return{drawPositions:o,matchUps:d,targetMatchUps:s}}function vS({lineUp:e}){if(!Array.isArray(e))return;let t={};return ar(e.flatMap((({collectionAssignments:e})=>e?.map((({collectionId:e,collectionPosition:t})=>[e,t].join("|"))))).filter(Boolean)).forEach((i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=ZI({collectionPosition:a,collectionId:r,lineUp:e});o.forEach((e=>{t[e]||(t[e]=[]),t[e].push({collectionId:r,collectionPosition:a})}))})),Object.keys(t).map((e=>({participantId:e,collectionAssignments:t[e]})))}function SS(e){return`${e} must be an array`}function US({lineUp:e,tieFormat:t}){let i=[];if(!Array.isArray(e))return i.push(SS("lineUp")),{valid:!1,errors:i,error:Ho};let r=e.every((e=>{if("object"!=typeof e)return i.push("lineUp entries must be objects"),!1;let{participantId:t,collectionAssignments:r}=e;return t?"string"!=typeof t?(i.push("participantIds must be strings"),!1):Array.isArray(r)?r.every((e=>{if("object"!=typeof e)return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:t}=e;return"number"==typeof t||(i.push("collectionPosition must be a number"),!1)})):(i.push(SS("collectionAssignments")),!1):(i.push("Missing participantId"),!1)})),n=ar(e.map(Om)).length===e.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?Ho:void 0}}function bS({drawDefinition:e,participantId:t,tieFormat:i,lineUp:r}){if("object"!=typeof e)return{error:Jr};if("string"!=typeof t)return{error:Ha};let n=US({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=Jp({element:e,name:dm}),o=a?.value||{};return o[t]=vS({lineUp:r}),Vp({element:e,extension:{name:dm,value:o}}),Qf({drawDefinition:e}),{..._r}}function wS({inContextDrawMatchUps:e,inheritance:t=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:Jr};let{drawPositions:c,matchUps:d,targetMatchUps:u}=yS({inContextDrawMatchUps:e,matchUpsMap:n,assignments:a,structure:o});for(let l of u)l.matchUpType===$i&&(l.sides??[]).forEach(((e,n)=>{if(e?.drawPosition&&c?.includes(e.drawPosition)){let a=d.find((({matchUpId:e})=>e===l.matchUpId));if(a?.sides?.[n]){if(delete a.sides[n].lineUp,!1===t){let t=l.tieFormat,i=e.participantId;t&&i&&bS({drawDefinition:r,participantId:i,lineUp:[],tieFormat:t})}Jf({tournamentId:i?.tournamentId,context:"resetLineUps",eventId:s?.eventId,drawDefinition:r,matchUp:a})}}}));return{..._r}}function TS({provisionalPositioning:e,inContextDrawMatchUps:t,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:c,drawPosition:d,matchUpsMap:u,structureId:l,event:p}){let m="assignDrawPosition";if(!s&&!i)return Qs({result:{error:Ha},stack:m});u=u??bg({drawDefinition:a}),t||({matchUps:t}=gy({inContext:!0,drawDefinition:a,matchUpsMap:u}));let f=lf({drawDefinition:a,structureId:l});if(f.error)return Qs({result:f,stack:m});let{structure:h}=f;if(!h)return{error:Rn};if(Cg({structure:h}))return Qs({result:{error:ca},stack:m});let{seedAssignments:g}=yg({provisionalPositioning:e,drawDefinition:a,structure:h}),I=g?.find((e=>e.participantId===s))?.seedNumber,{appliedPolicies:y}=Fh({tournamentRecord:n,drawDefinition:a,structure:h,event:p});if(I&&!cS({seedNumber:I,appliedPolicies:y,drawDefinition:a,seedBlockInfo:c,drawPosition:d,structureId:l}))return Qs({result:{error:rn},context:{drawPosition:d},stack:m});let v=hf({structure:h}).positionAssignments||[],S=v?.find((e=>e.drawPosition===d));if(!S)return Qs({result:{error:ln},context:{drawPosition:d},stack:m});if(v?.map(Om).includes(s))return Qs({result:{error:to},context:{drawPosition:d},stack:m});let{containsParticipant:U,containsBye:b}=function(e){let t=e.bye,i=e.qualifier,r=e.participantId;return{containsBye:t,containsQualifier:i,containsParticipant:r,filled:t||i||r}}(S);if(b){let e=Hy({inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,drawPosition:d,structureId:l,matchUpsMap:u,event:p});if(e.error)return Qs({result:e,stack:m})}if(U&&S.participantId!==s){let{activeDrawPositions:e}=ky({drawDefinition:a,structureId:l});if(e.includes(d))return Qs({result:{error:dn},stack:m});wS({assignments:[S],inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:h})}if(S.participantId=s,i&&(S.qualifier=!0),h.stage===vu&&(!h.stageSequence||h.stageSequence>1)||h.stage&&[Uu,wu].includes(h.stage)){let t=h.stage===Su?Su:vu,i=(a.structures?.find((e=>e?.stage===t&&1===e?.stageSequence))?.seedAssignments??[]).find((e=>e.participantId===s));if(i?.participantId){let{participantId:t,seedNumber:r,seedValue:s}=i;lS({eventId:p?.eventId,provisionalPositioning:e,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:t,seedNumber:r,seedValue:s,structureId:l,event:p})}}if(h.structureType!==xu)!function({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:c}){let d={isCollectionMatchUp:!1},{matchUps:u}=oy({provisionalPositioning:e,matchUpFilters:d,drawDefinition:n,matchUpsMap:o,structure:s,event:c}),{roundMatchUps:l}=Ng({matchUps:u}),{initialRoundNumber:p}=Oy({drawPosition:a,matchUps:u}),m=p&&l?.[p].find((e=>e.drawPositions?.includes(a)));if(m){let e=IS({matchUpId:m.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(e.error)return Qs({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:e})}}({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:d,matchUpsMap:u,structure:h,event:p});else{qy({positionAssignments:v,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:h});let{drawPositions:e,matchUps:i,targetMatchUps:r}=yS({assignments:[S],inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:u,structure:h});if(e&&1===i?.length&&i[0].matchUpType===Gi){let t=(r?.[0].sides??[]).reduce(((t,i,r)=>e?.includes(i.drawPosition)?r:t),void 0);pS({inContextTargetMatchUp:r[0],teamParticipantId:s,matchUp:i[0],drawPositionSideIndex:t,tournamentRecord:n,drawDefinition:a})}}let w=a.entries?.find((e=>e.participantId===s)),T=p?.entries?.find((e=>e.participantId===s));return!w&&T&&vv({entryStatus:T.entryStatus,entryStage:h.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),th({tournamentId:n?.tournamentId,drawDefinition:a,structure:h,event:p}),{positionAssignments:v,..._r}}function DS(e){let{participantIdAttributeName:t="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,event:d}=e,u="positionParticipantAction";if(!a)return{error:Jr};let l=Fh({tournamentRecord:n,drawDefinition:a,event:d}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=e;m||(m=bg({drawDefinition:a}),Object.assign(e,{matchUpsMap:m})),p||(({matchUps:p}=gy({inContext:!0,drawDefinition:a,matchUpsMap:m})),Object.assign(e,{inContextDrawMatchUps:p}));let{positionAssignments:f}=ff({drawDefinition:a,structureId:c}),h=f?.find((e=>e.drawPosition===s));if(h?.participantId){let e=h.participantId,t=TS({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,matchUpsMap:m,event:d});return t.success?v({appliedPolicies:l,removedParticipantId:e}):Qs({result:t,stack:u})}let g=Hy({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:c,matchUpsMap:m,event:d});if(g.error)return Qs({result:g,stack:u});let I=g.participantId,y=TS({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,matchUpsMap:m,event:d});return y.success?v({appliedPolicies:l,removedParticipantId:I}):Qs({result:y,stack:u});function v({appliedPolicies:e,removedParticipantId:i}){let{structure:n}=lf({drawDefinition:a,structureId:c});return rh({drawPositions:[s],structure:n}),nh({appliedPolicies:e,drawDefinition:a,positionAction:{[t]:o,name:r,drawPosition:s,structureId:c}}),Qs({context:{removedParticipantId:i},result:{..._r},stack:u})}}function PS(e){return function({luckyLoserParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:r,structureId:n}){return DS({positionActionName:"luckyLoserDrawPositionAssignment",participantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:r,structureId:n})}(e)}function NS({params:e,modMap:t,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=e;for(let o of i.matchUps)t[o.matchUpId]&&(o.roundNumber=t[o.matchUpId],Jf({tournamentId:r?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:o}))}function ES(e,t){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(t)&&i.push(...t);let r=dp(e,i);if(r.error)return r;let n=lf(e);if(n.error)return n;let a=n.structure;if(!Cg({structure:a}))return Qs({result:{error:en,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Ng({matchUps:a?.matchUps});return s?.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:oa}}function MS(e){let t=ES(e,[{targetRoundNumber:!0,roundNumber:!0,[rp]:"number"}]);if(t.error)return t;let{structure:i,roundMatchUps:r,roundNumbers:n}=t,{targetRoundNumber:a,roundNumber:o}=e;if(!n?.includes(o)||!n?.includes(a))return Qs({result:{error:Ho},info:"roundNumbers must be valid rounds"});let s=a>o,c=s?gr(o+1,a+1):gr(a,o),d={};return c.forEach((e=>(r?.[e]??[]).forEach((({matchUpId:t})=>{d[t]=e-(s?1:-1)})))),r?.[o]?.forEach((({matchUpId:e})=>d[e]=a)),NS({params:e,modMap:d,structure:i}),{..._r}}function RS({structurePositionAssignments:e,provisionalPositioning:t,tournamentRecord:i,drawDefinition:r,event:n}){if(!r)return{error:Jr};if(!Array.isArray(e))return{error:Ho};for(let o of e){let{structureId:e,positionAssignments:a}=o;if(!a)continue;let s=lf({drawDefinition:r,structureId:e});if(s.error)return s;let c=s.structure;if(!c)return{error:Rn};let d=ff({structure:c}).positionAssignments?.map((({drawPosition:e})=>e)),u=a?.map((({drawPosition:e})=>e));if(yr(d,u).length!==d?.length)return Qs({result:{error:Ho},info:"drawPositions do not match",stack:"setPositionAssignments"});let l=bg({drawDefinition:r}),{matchUps:p}=gy({inContext:!0,drawDefinition:r,matchUpsMap:l});for(let o of a||[]){let{drawPosition:s,participantId:d,bye:u,qualifier:m}=o;if(u){let t=Vy({tournamentRecord:i,drawDefinition:r,drawPosition:s,matchUpsMap:l,structureId:e,structure:c,event:n});if(t?.error)return t}else if(m)a.forEach((e=>{e.drawPosition===s&&(e.qualifier=!0,delete e.participantId,delete e.bye)}));else if(d){let a=TS({provisionalPositioning:t,inContextDrawMatchUps:p,tournamentRecord:i,drawDefinition:r,participantId:d,drawPosition:s,matchUpsMap:l,structureId:e,event:n});if(a?.error)return a}}th({tournamentId:i?.tournamentId,drawDefinition:r,structure:c,event:n})}let a=e.map((({structureId:e})=>e));return Zf({tournamentId:i?.tournamentId,eventId:n?.eventId,drawDefinition:r,structureIds:a}),{..._r}}function CS(e){let t=ES(e,[{roundNumbers:!0,[rp]:Zl,[ep]:e=>2===e.length&&e.every(Qi)}]);if(t.error)return t;let{structure:i,roundMatchUps:r,roundNumbers:n}=t;if(!e.roundNumbers.every((e=>n?.includes(e))))return Qs({result:{error:Ho,message:"roundNumbers must be valid rounds"}});let a={};return e.roundNumbers.forEach(((t,i)=>(r?.[t]??[]).forEach((({matchUpId:t})=>{a[t]=e.roundNumbers[1-i]})))),NS({params:e,modMap:a,structure:i}),{..._r}}function AS({alternateParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:r,structureId:n,event:a}){return DS({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:r,structureId:n,event:a})}function kS({drawDefinition:e,structureId:t}){if(!e)return{error:Jr};let{structure:i}=lf({drawDefinition:e,structureId:t}),r=(e?.links||[]).filter((e=>e.source?.structureId===t)).map((e=>e.target?.structureId));return{playoffStructures:(e?.structures||[]).filter((e=>r.includes(e.structureId))),structure:i}}function OS({withStageGrouping:e,stageSequences:t,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:Fn};let s={},c=[];for(let d of a.drawDefinitions||[]){let{structures:a,stageStructures:u}=pf({withStageGrouping:e,stageSequences:t,drawDefinition:d,stageSequence:i,roundTarget:r,stages:n,stage:o});if(c.push(...a),u)for(let e of Object.keys(u))s[e]||(s[e]=[]),s[e].push(...u[e])}return{structures:c,stageStructures:s}}function xS({withStageGrouping:e,tournamentRecord:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!t)return{error:zr};let s={},c=[];for(let d of t.events||[]){let{structures:t,stageStructures:u}=OS({withStageGrouping:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:d,stage:o});if(t&&c.push(...t),u)for(let e of Object.keys(u))s[e]||(s[e]=[]),s[e].push(...u[e])}return{structures:c,stageStructures:s}}function FS(e){if(!e?.drawDefinition)return!1;let t=cy(e),i=t?.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=t||{};return i&&(r=r?.filter((({matchUpType:e})=>e===Gi)),n=n?.filter((({matchUpType:e})=>e===Gi)),a=a?.filter((({matchUpType:e})=>e===Gi))),!(!r?.length||n?.length||a?.length)}function LS(e){let{drawDefinition:t,structureId:i}=e;if(!t)return{error:Jr};let{playoffStructures:r}=kS({drawDefinition:t,structureId:i});if(!r?.length)return!1;let n=t?.entries?.filter((e=>e?.entryStatus&&pg.includes(e.entryStatus)))?.length??0,a=0;return(r||[]).reduce(((e,t)=>!(!(ff({structure:t}).positionAssignments??[])?.filter((e=>(e.participantId&&a++,e?.bye??e?.participantId))).length||!e)),!!r.length)||a===n}function _S({significantCharacters:e,accessors:t=[],value:i}){let r=[],n=t[0];if(i?.[n]){let a=t.slice(1);if(Array.isArray(i[n]))i[n].forEach((t=>{let i=_S({accessors:a,significantCharacters:e,value:t});r.push(...i)}));else if(i=i[n],a.length){let t=_S({accessors:a,significantCharacters:e,value:i});r.push(...t)}else!function({value:t}){if(t&&["string","number"].includes(typeof t)){let i=e?t.slice(0,e):t;r.push(i)}}({value:i})}return r}function BS({policyAttributes:e,idCollections:t,participants:i,participant:r}){if(!Array.isArray(e))return{error:pa};if(!r)return{error:Wa};let n=[];return e.forEach((e=>{let{directive:a,groupings:o,key:s,significantCharacters:c}=e||{};if(s){let e=s.split(".");n.push(..._S({significantCharacters:c,value:r,accessors:e}))}else if(a){let o=e?.includeIds,s=(t?.[a]||[]).filter((e=>!o||o.includes(e)));s?.length&&i?.length&&s.forEach((e=>{let t=i.find((t=>t.participantId===e));if(t?.individualParticipantIds?.includes(r.participantId)){let e=t?.participantId;n.push(e)}}))}else o&&Object.keys(o).forEach((e=>{o[e].includes(r.participantId)&&n.push(e)}))})),{values:ar(n)}}function VS({candidatePositionAssignments:e,participantsWithGroupings:t,policyAttributes:i,idCollections:r}){let n=Object.assign({},...t.map((e=>({[e.participantId]:e}))));return e.map((e=>{let a=n[e.participantId],{values:o}=BS({participants:t,policyAttributes:i,idCollections:r,participant:a});return{...e,values:o}}))}function jS({participantIdGroups:e,positionAssignments:t,groupsToAvoid:i}){return Object.assign({},...t.filter((e=>e?.participantId)).map((t=>{let{drawPosition:r,participantId:n}=t,a=e&&e[n]||[],o=!!i.some((e=>a.includes(e)));return{[r]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function $S(e){let{unfilledPositions:t,chunkedDrawPositions:i}=e,r=jS(e);return i.map((e=>{let i=t.filter((t=>e.includes(t))),n=function(e){return e.filter((e=>!t(e)));function t(t){let i=GS(t);return!e.includes(i)}}(i),a=i.filter((e=>!n.includes(e))).filter((e=>{let t=GS(e);return!r[t]?.includesGroupsToAvoid}));return{unassigned:i,unpaired:n,pairedNoConflict:a}}))}function GS(e){return Number(e%2?e+1:e-1)}function WS({selectedParticipantGroups:e,participantIdGroups:t,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map((r=>a?function(e){let{unfilledPositions:t,chunkedDrawPositions:i}=e,r=jS(e);return i.map((e=>{let i=t.filter((t=>e.includes(t))),n=i.length===e.length?i:[],a=e.filter((e=>r[e]?.includesGroupsToAvoid)).length;return{unassigned:i,unpaired:n,pairedNoConflict:a?[]:i,conflictsCount:a}}))}({groupsToAvoid:e,chunkedDrawPositions:r,participantIdGroups:t,positionAssignments:i,unfilledPositions:n}):$S({groupsToAvoid:e,chunkedDrawPositions:r,participantIdGroups:t,positionAssignments:i,unfilledPositions:n})));if(a){return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>e?.length)))).filter((e=>e?.length)).sort(((e,t)=>(t.length||0)-(e.length||0))),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>e?.length)))).filter((e=>e?.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>e?.length)))).filter((e=>e?.length)).sort(((e,t)=>(t.length||0)-(e.length||0)))}}return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>e?.length)))).filter((e=>e?.length)),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>e?.length)))).filter((e=>e?.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>e?.length)))).filter((e=>e?.length))}}function qS({positionAssignments:e,participantIds:t}){let i=e.map((e=>e.participantId));return t.filter((e=>!i.includes(e)))}function HS({candidatePositionAssignments:e,unseededParticipantIds:t,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let c,d=n.reduce(((e,t)=>t.length>e?t.length:e),0)<=2,u=qS({positionAssignments:e,participantIds:t}),l=function({drawPositionGroups:e,positionAssignments:t}){let i=Object.assign({},...t.map((e=>({[e.drawPosition]:e}))));return e.map((e=>e.filter(Boolean).map((e=>i[e])).filter(Boolean).filter((e=>!e.participantId&&!e.bye)).map((e=>e.drawPosition)))).flat().filter(Boolean)}({positionAssignments:e,drawPositionGroups:n}),{participantId:p,groupKey:m}=function({useSpecifiedGroupKey:e=!1,targetParticipantIds:t,largestFirst:i=!0,allGroups:r,groupKey:n}){let a=Object.assign({},...Object.keys(r).map((e=>[e,r[e].filter((e=>t.includes(e)))])).filter((e=>e[1].length)).map((([e,t])=>({[e]:t})))),o=Object.keys(a).reduce(((e,t)=>a[t].length>e?a[t].length:e),0),s=Object.keys(a).filter((e=>a[e].length===o)),c=hr(i?s:Object.keys(a));return{participantId:(n=e&&a[n]?.length?n:c)&&a[n]?hr(a[n]):hr(t),groupKey:n}}({targetParticipantIds:u,useSpecifiedGroupKey:d,allGroups:o,groupKey:s}),f=function({allGroups:e,participantId:t}){return Object.keys(e).filter((i=>e[i].includes(t)))}({participantId:p,allGroups:o}),h=WS({positionAssignments:e,isRoundRobin:d,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:l}),{unassigned:g,unpaired:I,pairedNoConflict:y}=h,v=y?.length&&y[0],S=I?.length&&I[0],U=a&&v?v:S,b=a?S:v,w=U?.length&&U||b?.length&&b;if(w?.length){let e=fr(w);c=fr(e)}else{let e=fr(g[0]);c=fr(e)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:c}}function zS({isRoundRobin:e,groupedParticipants:t}){let i=[];return e?t.forEach((e=>{let t=Xv({drawPositions:e.map((e=>e.drawPosition))}).uniqueMatchUpGroupings??[],r=Object.assign({},...e.map((e=>({[e.drawPosition]:e}))));t.forEach((t=>{Sr(r[t[0]].values||[],r[t[1]].values||[])&&(i.push(t),e.conflict=!0)}))})):t.forEach((e=>{Sr(e[0]?.values||[],e[1]?.values||[])&&(i.push(e),e.conflict=!0)})),i}function YS({positionedParticipants:e,potentialDrawPositions:t,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map((r=>{let a=r.map((e=>e.drawPosition));return r.filter((e=>t.includes(e.drawPosition))).map((r=>{let o=t.filter((e=>!a?.includes(e))).filter((t=>{let a=i.find((e=>e.includes(t))).find((e=>e!==t)),o=e.find((e=>e.drawPosition===a)),s=zS({isRoundRobin:n,groupedParticipants:[[r,o]]}),c=[e.find((e=>e.drawPosition===t)),o],d=zS({isRoundRobin:n,groupedParticipants:[c]});return!s.length&&!d.length}));if(o.length)return{drawPosition:r.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function KS(e){let t,{initialPositionAssignments:i,participantsWithGroupings:r,opponentsToPlaceCount:n,unseededByePositions:a,drawPositionGroups:o,policyAttributes:s,idCollections:c,allGroups:d}=e,u=[],l=Math.min(...(o||[]).map((e=>e?.length)).filter(Boolean)),p=l>2,m=yd(i,!1,!0).filter((e=>!e.qualifier)),f=i.filter((e=>!e.participantId&&(!e.bye||a?.includes(e.drawPosition)))).map((e=>e.drawPosition));gr(0,n).forEach((()=>{let{newGroupKey:i,selectedParticipantId:r,targetDrawPosition:n}=HS({...e,candidatePositionAssignments:m,allGroups:d,groupKey:t});t=i,m.forEach((e=>{e.drawPosition===n&&(e.participantId=r)}))}));let h=VS({candidatePositionAssignments:m,participantsWithGroupings:r,policyAttributes:s,idCollections:c}),g=wr(h,l),I=zS({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&I.length;){let e=YS({positionedParticipants:h,potentialDrawPositions:f,avoidanceConflicts:I,drawPositionGroups:o,isRoundRobin:p});if(e.length){let t=XS({candidatePositionAssignments:m,swapOptions:e});t.error&&console.log({result:t}),h=VS({candidatePositionAssignments:m,participantsWithGroupings:r,policyAttributes:s,idCollections:c}),g=wr(h,l),I=zS({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return m.forEach((e=>{if(e.bye&&e.participantId){let e=wn;u.push(e)}if(e.qualifier&&e.participantId){let e=wn;u.push(e)}})),{positionAssignments:m,conflicts:I.length,groupedParticipants:g,errors:u}}function XS({candidatePositionAssignments:e,swapOptions:t}){let i=fr(t);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=fr(i.possibleDrawPositions),a=e.find((e=>e.drawPosition===r)),o=e.find((e=>e.drawPosition===n))??{},s={participantId:o?.participantId,qualifier:o?.qualifier,bye:o?.bye},c={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,c),{..._r}}function JS({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:d,avoidance:u,drawSize:l,event:p}){if(!u)return{error:la};let{candidatesCount:m=1,policyAttributes:f,targetDivisions:h}=u,{roundsToSeparate:g}=u,I="randomUnseededSeparation",{structure:y}=lf({drawDefinition:a,structureId:d}),{matchUps:v}=oy({provisionalPositioning:e,matchUpsMap:c,structure:y,event:p});if(h&&Yi(h)&&!g){let e=function(e){if(!Yi(e))return!1;let t=e,i=1;for(;2!==t;)i+=1,t/=2;return i}(h)||0,t=v.reduce(((e,t)=>t.roundNumber>e?t.roundNumber:e),0);g=t<e?1:t-e+1}let{positionAssignments:S}=hf({structure:y}),U=yh({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,b=S?.filter((e=>!e.participantId)),w=S?.map((e=>e.drawPosition)),T=y?.structureType===xu,D=T?{structure:y,matchUps:v,allDrawPositions:w,roundsToSeparate:g}:{matchUps:v,allDrawPositions:w,roundsToSeparate:g},{drawPositionGroups:P,drawPositionChunks:N}=T?function(e){let{structure:{structures:t}}=e,i=t.map((e=>e.positionAssignments.map((e=>e.drawPosition))));return{drawPositionGroups:i,drawPositionChunks:[i]}}(D):function({allDrawPositions:e,roundsToSeparate:t,matchUps:i}){let r=i.filter((e=>1===e.roundNumber)).map((e=>e.drawPositions)),n=r.flat().sort(Hi),a=Math.max(...n),o=e.filter((e=>e>a)),s=n.length,c=gr(2===s?1:2,s).filter((e=>e===Ji(e))),d=c.slice(0,t||c.length).reverse().map((e=>wr(n,e)));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:d}}(D),E={groupParticipants:s.filter((e=>e.participantType===mh)).map((e=>e.participantId)),teamParticipants:s.filter((e=>e.participantType===hh)).map((e=>e.participantId)),pairParticipants:s.filter((e=>e.participantType===fh)).map((e=>e.participantId))},M=function({targetParticipantIds:e,policyAttributes:t,idCollections:i,participants:r}){if(!Array.isArray(t))return{error:pa};if(!Array.isArray(r))return{error:qa};let n={};return e.forEach((e=>{let a=r.find((t=>t.participantId===e)),{values:o}=BS({policyAttributes:t,idCollections:i,participants:r,participant:a});o&&o.forEach((t=>{n[t]||(n[t]=[]),n[t].includes(e)||n[t].push(e)}))})),n}({targetParticipantIds:t,policyAttributes:f,idCollections:E,participants:s});if(M.error)return Qs({result:M,stack:I});let R=Object.assign({},...t.map((e=>{let t=Object.keys(M).filter((t=>(M[t]??[]).includes(e)));return{[e]:t}}))),C=qS({participantIds:t,positionAssignments:S});if(C.length>(b?.length||0))return{error:mo};let A,k=C.length,O=gr(0,m).map((()=>KS({initialPositionAssignments:S,participantsWithGroupings:U,unseededParticipantIds:t,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:r,participantIdGroups:R,drawPositionChunks:N,drawPositionGroups:P,policyAttributes:f,idCollections:E,allGroups:M,drawSize:l})));if(A=O.reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0),!A||A.conflicts){let e=gr(0,m).map((()=>KS({initialPositionAssignments:S,participantsWithGroupings:U,unseededParticipantIds:t,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:r,participantIdGroups:R,drawPositionChunks:N,drawPositionGroups:P,policyAttributes:f,idCollections:E,allGroups:M,drawSize:l})));A=O.concat(...e).filter((e=>!e.errors?.length)).reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0)}if(!A)return{error:Vo};let x=(ff({structure:y})?.positionAssignments??[]).filter((e=>e.participantId)).map((e=>e.participantId)),F=A.positionAssignments.filter((e=>!x.includes(e.participantId)));for(let L of F)if(L.bye){let e=Vy({tournamentRecord:n,drawDefinition:a,structureId:d,matchUpsMap:c,event:p,...L});if(e.error)return Qs({result:e,stack:I})}else if(L.participantId){let e=TS({inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:d,matchUpsMap:c,event:p,...L});if(e.error)return Qs({result:e,stack:I,context:{assignment:L}})}return{..._r}}function QS({provisionalPositioning:e,inContextDrawMatchUps:t,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:d,structure:u,drawSize:l,event:p}){u||({structure:u}=lf({drawDefinition:a,structureId:d})),d||({structureId:d}=u);let{positionAssignments:m}=hf({structure:u}),{seedAssignments:f}=yg({provisionalPositioning:e,drawDefinition:a,structure:u}),h=f?.map((e=>e.participantId)).filter(Boolean),{stage:g,stageSequence:I}=u,y=g===Su?Jp({element:u,name:hm})?.extension?.value:void 0,v=Ig({provisionalPositioning:e,drawDefinition:a,stageSequence:I,entryStatuses:lg,structureId:d,roundTarget:y,stage:g}),S=v.filter((e=>!h?.includes(e.participantId))).map((e=>e.participantId)),U=m?.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));if(!r&&S.length>(U?.length||0))return Qs({result:{error:mo},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:U?.length},stack:"positionUnseededParticipants"});let{appliedPolicies:b}=Fh({tournamentRecord:n,drawDefinition:a,event:p}),w=b?.[Mp];if(u.stage===wu){let e=v.reduce(((e,t)=>(e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e)),{});Object.keys(e).length&&(w||(w={policyName:"Playoff Avoidance"}),w.policyAttributes||(w.policyAttributes=[]),w.policyAttributes.push({groupings:e}))}return w&&s?JS({provisionalPositioning:e,unseededParticipantIds:S,inContextDrawMatchUps:t,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:d,avoidance:w,drawSize:l}):function({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:c,structureId:d,drawSize:u,event:l}){let p=u>2?sr(r):r.reverse();for(let m of t){let t=p.pop();if(!n||t){let r=TS({provisionalPositioning:e,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:t,matchUpsMap:c,structureId:d,event:l});if(r?.error&&console.log("!!!!!",{result:r}),r?.error)return Qs({result:r,stack:"randomUnseededDistribution"})}}return{..._r}}({provisionalPositioning:e,unseededParticipantIds:S,inContextDrawMatchUps:t,unfilledDrawPositions:U,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:d,matchUpsMap:c,drawSize:l,event:p})}function ZS(e){let t=e.structure??lf(e).structure,i="positionQualifiers",r=[];if(t.stage===Uu)return Qs({result:{error:Gn},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=function({drawDefinition:e,structure:t,structureId:i}){t||({structure:t}=lf({drawDefinition:e,structureId:i})),i||({structureId:i}=t);let{positionAssignments:r}=hf({structure:t}),{stage:n,stageSequence:a}=t,{qualifiersCount:o,roundQualifiersCounts:s}=hv({drawDefinition:e,stageSequence:a,structureId:i,stage:n}),c=(s?Object.keys(s):[]).map((e=>zi(e))),{matchUps:d}=oy({structure:t}),{roundProfile:u}=Ng({matchUps:d}),l=Object.assign({},...c.filter((e=>u?.[e])).map((e=>({[e]:u?.[e]?.drawPositions?.filter(Boolean)??[]})))),p=r?.filter((e=>e.qualifier)).map((e=>e.drawPosition)),m=o-(p?.length??0),f=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...c.map((e=>{let t=r?.filter((t=>t.qualifier&&l[e]?.drawPositions?.includes(t.drawPosition))).map((e=>e.drawPosition));return{[e]:(s?.[e]??0)-(t?.length??0)}}))),unplacedQualifiersCount:m,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:l,qualifiersCount:o}}(e);for(let s of Object.keys(n)){let e=a?.filter((e=>o[s].includes(e.drawPosition)&&!e.participantId&&!e.qualifier&&!e.bye)).map((e=>e.drawPosition));if(n[s]>(e||0))return Qs({result:{error:po},context:{unfilledDrawPositions:e},stack:i});gr(0,n[s]).forEach((()=>{let t=fr(e);r.push(t),a?.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)}))}))}return{..._r,qualifierDrawPositions:r}}function eU({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:c,groupsCount:d,structureId:u,matchUpsMap:l,structure:p,event:m}){let f=[],h=[],g=0;if(p||({structure:p}=lf({drawDefinition:a,structureId:u})),u||(u=p?.structureId),r||(r=Fh({drawDefinition:a}).appliedPolicies),!n){let t=p&&oS({provisionalPositioning:e,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});t?.error&&h.push(t.error),n=t?.validSeedBlocks}return gr(0,d=d??n?.length??0).forEach((()=>{if(g<(d||0)){let r=function({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:c,event:d}){let{unplacedSeedParticipantIds:u,unfilledPositions:l}=dS({provisionalPositioning:e,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s}),{appliedPolicies:p}=Fh({drawDefinition:r}),{avoidance:m}=p??{};let f=[];for(let h of u){let o=l.pop();if(!o)return{error:pn};f.push(o);let u=TS({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:h,seedBlockInfo:a,drawPosition:o,matchUpsMap:c,structureId:s,event:d});if(!u.success)return u}return{..._r,seedPositions:f}}({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:c,structureId:u,matchUpsMap:l,event:m});r?.success&&(g++,f.push(...r.seedPositions??[])),r.error&&h.push({seedPositionError:r.error})}})),h.length?{error:h}:{..._r,seedPositions:f}}function tU({orderedSortedFirstRoundSeededDrawPositions:e,validSeedBlocks:t,byesToPlace:i}){let r=[];t.forEach((t=>function(e,t,i,r){if(t-i.length>e.drawPositions.length)i.push(...e.drawPositions);else{!function(e,t,i){let r,n=i[t.length];for(;r=iU(e,n);)t.push(r),n=i[t.length]}(rU(wr(e.drawPositions,2)),i,r)}}(t,i,r,e)));let n=r.map((e=>Array.isArray(e)?sr(e):e)).flat(1/0);return Zi(i)&&t.map((e=>e.seedNumbers[0])).includes(i)?e:n}function iU(e,t){return Array.isArray(e)&&2!==e.length?e.pop():Array.isArray(e[0])?function(e,t){let i=e[0].flat(1/0).length,r=e[1].flat(1/0).length;if(i===r){let i=e[0].flat(1/0).includes(t)?e[0]:e[1];return iU(t?i:e[Math.round(Math.random())],t)}return iU(i<r?e[1]:e[0],t)}(e,t):function(e,t){return e.includes(t)?e.indexOf(t)?e.pop():e.shift():Math.round(Math.random())?e.pop():e.shift()}(e,t)}function rU(e){let t=Math.floor(e.length/2);return e.length>2?[rU(e.slice(0,t)),rU(e.slice(t))]:e}function nU({provisionalPositioning:e,relevantMatchUps:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){a||(a=oS({provisionalPositioning:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:c,isLuckyStructure:d,isContainer:u}=a,{validSeedBlocks:l}=a;i?.seeding?.containerByesIgnoreSeeding&&(l=[]);let p=function({provisionalPositioning:e,drawDefinition:t,structure:i}){let{positionAssignments:r}=hf({structure:i}),{seedAssignments:n}=yg({provisionalPositioning:e,drawDefinition:t,structure:i}),a=Object.assign({},...(n||[]).filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))));return r?.map((e=>a[e.participantId]?{...e,seedNumber:a[e.participantId].seedNumber,seedValue:a[e.participantId].seedValue}:"")).filter(Boolean)}({provisionalPositioning:e,drawDefinition:r,structure:s})??[],m=ar([].concat(...t.map((e=>e.drawPositions)))),f=p.filter((e=>m.includes(e.drawPosition))),h=(e,t)=>aS(e.seedValue)-aS(t.seedValue),g=l.reduce(((e,t)=>{let i=f.filter((e=>t.drawPositions?.includes(e.drawPosition))).sort(h);return e.concat(...i)}),[]).map((e=>e.drawPosition)),I=tU({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:l,byesToPlace:o});return{strictSeedOrderByePositions:aU({orderedSeedDrawPositions:g,relevantMatchUps:t}).slice(0,o),blockSeedOrderByePositions:aU({orderedSeedDrawPositions:I,relevantMatchUps:t}).slice(0,o),isLuckyStructure:d,positionedSeeds:p,isContainer:u,isFeedIn:c}}function aU({orderedSeedDrawPositions:e,relevantMatchUps:t}){let i=t.map((e=>e.drawPositions)).map((e=>e?.sort(((e,t)=>e-t)))).filter((e=>e?.[0]+1===e?.[1]));return e.map((e=>i.find((t=>t?.includes(e))))).filter(Boolean).map((t=>t?.reduce(((t,i)=>e.includes(i)?t:i),void 0))).filter(Boolean)}function oU({provisionalPositioning:e,tournamentRecord:t,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:c,seedLimit:d,seedsOnly:u,event:l}){c||({structure:c}=lf({drawDefinition:r,structureId:s})),s||(s=c?.structureId);let p=!(c?.structures??c?.stage===Su),{byesCount:m,placedByes:f,relevantMatchUps:h}=function({provisionalPositioning:e,drawDefinition:t,matchUpsMap:i,structure:r,event:n}){let{matchUps:a,roundMatchUps:o}=oy({afterRecoveryTimes:!1,provisionalPositioning:e,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:r,event:n}),s=o?.[1]||[],c=r?.structureType===xu,d=c?a:s,u=c?r?.structures?.length||0:a.length,{structureId:l,stage:p,stageSequence:m}=r,f=Ig({entryStatuses:pg,provisionalPositioning:e,drawDefinition:t,stageSequence:m,structureId:l,stage:p}),{qualifiersCount:h}=hv({provisionalPositioning:e,drawDefinition:t,stageSequence:m,structureId:l,stage:p}),g=f.length+h,{positionAssignments:I,unassignedPositions:y}=hf({structure:r}),v=y?.map((e=>e.drawPosition)),S=I?.filter((e=>e.bye)).length,U=I?.filter((e=>e.bye)).map((e=>e.drawPosition)),b=d.map((e=>e.drawPositions)).filter((e=>e?.reduce(((e,t)=>!U?.includes(t)&&e),!0))).flat(1/0).filter((e=>v?.includes(e))),w=I?.length,T=w?w-g:0;return T>u&&1===r.stageSequence&&r.stage!==Uu&&(T=u),{placedByes:S,byesCount:T,relevantMatchUps:d,placedByePositions:U,roundMatchUps:o,positionsToAvoidDoubleBye:b}}({provisionalPositioning:e,drawDefinition:r,matchUpsMap:o,structure:c,event:l}),g=m-(f||0);if(g<=0)return{..._r};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:y,isLuckyStructure:v,isFeedIn:S}=nU({provisionalPositioning:e,relevantMatchUps:h,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:c}),U=c?.structureType&&[xu,Ou].includes(c.structureType)&&i?.seeding?.containerByesIgnoreSeeding,b=p&&y?.length?y:I,{unseededByePositions:w}=function({provisionalPositioning:e,seedOrderByePositions:t,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){let c,d=r?.seeding?.seedingProfile,u=o.stage===Su,{positionAssignments:l}=hf({structure:o}),p=l?.filter((e=>e.participantId)).map((e=>e.drawPosition)),{matchUps:m,roundMatchUps:f}=oy({provisionalPositioning:e,matchUpFilters:{isCollectionMatchUp:!1},structure:o}),h=f?.[1]||[],g=o.structureType===xu?m:h,I=ar([].concat(...g.map((e=>e.drawPositions)))),y=Math.min(...I)-1,v=p?.filter((e=>I.includes(e))),S=e=>{let t=Math.ceil(e.length/2),i=[e.slice(0,t),e.slice(t)],r=i.map((e=>[].concat(...e.flat(1/0)).length)),n=Math.min(...r.flat(1/0)),a=Math.max(...r.flat(1/0)),o=r.indexOf(a),s=n!==a,c=sr(i),[d,u]=!n||s?[i[o],i[1-o]]:[c[0],c[1]];return{greaterHalf:d,lesserHalf:u}},U=e=>{let{greaterHalf:t,lesserHalf:i}=S(e),{greaterHalf:r,lesserHalf:n}=S(t),a=sr(r.flat(1/0)).pop();return{newlyFilteredChunks:[...i,...n,r.flat().filter((e=>e!==a))],drawPosition:a}},b=e=>!v?.includes(e),w=e=>{let t=wr(e.sort(Hi),Math.ceil(e.length/4)).map((e=>e.filter(b))),i=[].concat(...t.flat(1/0)).length,r=[];for(let n=0;n<i;n++){let{newlyFilteredChunks:e,drawPosition:i}=U(t);r.push(i),t=e}return r},{validSeedBlocks:T}=oS({provisionalPositioning:e,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),D=T?.map((e=>e.drawPositions?.map((e=>e+y))));if(s){let e=I.length,{seedBlocks:t}=iS({cluster:[Ru,Cu].includes(uS(d)),participantsCount:e});c=t.map((e=>e.map((e=>e+y)))).map(w).filter((e=>e.length))}else c=u?D?.map((e=>e.filter(b))):D?.map(w).filter((e=>e.length));let P=g.map((e=>e.drawPositions)).map((e=>e?.sort(((e,t)=>e-t)))).filter((e=>e?.[0]+1===e?.[1])),N=e=>P.reduce(((t,i)=>i.includes(e)?i.reduce(((t,i)=>i!==e?i:t),void 0):t),void 0),E=c.map((e=>e.map(N))).flat(1/0).filter(b).filter((e=>!t.includes(e))).filter(Boolean);if(u&&!o.structures){let e=a%4,t=E.slice(0,e),i=f[o.roundLimit]?.length,r=wr(E.slice(e),i).map(sr).flat();E=t.concat(r)}return{unseededByePositions:E}}({provisionalPositioning:e,seedOrderByePositions:b,isLuckyStructure:v,appliedPolicies:i,drawDefinition:r,seedLimit:d,structure:c,isFeedIn:S}),T=(e,t)=>(e||[]).every((e=>(e=>e%2)(e)?t!==e+1:t!==e-1)),D=[].concat(...b);if(!u)for(;w.length;){let e=w.find((e=>T(D,e)));e?(D.push(e),w=w.filter((t=>t!==e))):(D.push(...w),w=[])}U&&(D=sr(D),vs({ignoreSeededByes:U})&&console.log({byePositions:D}));let P=D.slice(0,g);for(let N of P){let i=Vy({provisionalPositioning:e,tournamentRecord:t,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:c,event:l});if(i?.error)return i}return{..._r,unseededByePositions:w,byeDrawPositions:P}}function sU(e){let{drawDefinition:t}=e,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:c,structureId:d,seedLimit:u,seedsOnly:l,drawType:p,drawSize:m,event:f}=e,h=[];i||(ws(),t=yd(t,!1,!0));let g=e=>(i||Ts(),Qs({result:e,stack:"automatedPositioning"})),I=lf({drawDefinition:t,structureId:d});if(I.error)return g(I);let y=I.structure;if(!y)return{error:Rn};let v=e.appliedPolicies||Fh({drawDefinition:t,structure:y,event:f})?.appliedPolicies,{qualifiersCount:S}=hv({stageSequence:y.stageSequence,provisionalPositioning:r,stage:y.stage,drawDefinition:t,structureId:d}),U=lg;if(!Ig({stageSequence:y.stageSequence,provisionalPositioning:r,stage:y.stage,placementGroup:s,drawDefinition:t,entryStatuses:U,structureId:d})?.length&&!S)return b={..._r},i||Ts(),b;var b;let w=e.matchUpsMap??bg({drawDefinition:t}),T=e.inContextDrawMatchUps??gy({inContext:!0,drawDefinition:t,matchUpsMap:w})?.matchUps,D=[],P=oS({provisionalPositioning:r,appliedPolicies:v,drawDefinition:t,seedingProfile:c,structure:y});if(P.error)return P;let{validSeedBlocks:N}=P;h.push({validSeedBlocks:N});let E=e.participants||(o?mv({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o})?.participants:[]);if(uS(y.seedingProfile||c)===ku){let e=a?oU({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:v,drawDefinition:t,seedBlockInfo:P,matchUpsMap:w,structure:y,seedLimit:u,seedsOnly:l,event:f}):void 0;if(e?.error)return g(e);if(D=e.unseededByePositions,h.push({action:"positionByes",unseededByePositions:D}),e=eU({seedingProfile:y.seedingProfile?{positioning:y.seedingProfile}:c,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:v,validSeedBlocks:N,drawDefinition:t,seedBlockInfo:P,participants:E,matchUpsMap:w,structure:y,event:f}),e.error)return g(e);h.push({seedPositions:e.seedPositions,action:"positionSeedBlocks"})}else{if(p!==Qu){let e=eU({seedingProfile:y.seedingProfile?{positioning:y.seedingProfile}:c,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:v,validSeedBlocks:N,drawDefinition:t,seedBlockInfo:P,participants:E,matchUpsMap:w,structure:y,event:f});if(e.error)return g(e);h.push({action:"positionSeedBlocks",seedPositions:e.seedPositions})}let e=a?oU({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:v,drawDefinition:t,seedBlockInfo:P,matchUpsMap:w,structure:y,seedLimit:u,seedsOnly:l,event:f}):void 0;if(e?.error)return g(e);D=e?.unseededByePositions,h.push({action:"positionByes",byeDrawPositions:e?.byeDrawPositions,unseededByePositions:D})}let M={};if(!l){let e=ZS({inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:v,validSeedBlocks:N,drawDefinition:t,seedBlockInfo:P,participants:E,matchUpsMap:w,structure:y});if(e.error||(e.conflicts&&(M.qualifierConflicts=e.conflicts),h.push({action:"positionQualifiers",qualifierDrawPositions:e.qualifierDrawPositions}),e=QS({provisionalPositioning:r,inContextDrawMatchUps:T,unseededByePositions:D,multipleStructures:n,tournamentRecord:o,drawDefinition:t,seedBlockInfo:P,participants:E,matchUpsMap:w,structureId:d,structure:y,drawSize:m,event:f}),e.error))return g(e);e.conflicts&&(M.unseededConflicts=e.conflicts),h.push({action:"positionUnseededParticipants"})}let{positionAssignments:R}=ff({drawDefinition:t,structure:y});return Zf({drawDefinition:t,structureIds:[d]}),i||Ts(),{positionAssignments:R,conflicts:M,..._r,positioningReport:h}}function cU(e){let{applyPositioning:t=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:c}=e;if(!n)return{error:Zr};if(!FS({drawDefinition:n,structureId:o})&&!i)return{error:tn};let d=kS({drawDefinition:n,structureId:o}).playoffStructures?.sort(((e,t)=>uf(e)-uf(t))),u=[],l=[];if(d)for(let p of d){let{structureId:e}=p,o=sU({structureId:e,provisionalPositioning:i,applyPositioning:t,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:s,seedsOnly:c});if(o.error)return o;o.positionAssignments&&u.push({positionAssignments:o.positionAssignments,structureId:e}),o.positioningReport&&l.push(o.positioningReport)}return{..._r,structurePositionAssignments:u,positioningReports:l}}function dU({validation:e=!0,tournamentRecord:t,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:Jr};if(!n)return{error:Mn};let s=(t?.participants??[]).find((e=>e.participantId===r));if(t&&!s)return{error:Ba};let{structure:c}=lf({drawDefinition:i,structureId:n});if(!c)return{error:Rn};if(!(!e||Qi(a)||void 0===a||""===a||"string"==typeof a&&a.split("-").every((e=>Qi(e)&&zi(e)>0))))return{error:Ho};let{seedAssignments:d}=yg({drawDefinition:i,structure:c}),u=d?.map((e=>e.seedNumber)),l=d?.find((e=>e.participantId===r));if(l){let e="string"==typeof a?a.includes("-")&&a.split("-").map((e=>parseInt(e))).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";l.seedValue=e}else{let e={seedNumber:Math.max(0,...u||[])+1,participantId:r};a&&(e.seedValue=a),c.seedAssignments||(c.seedAssignments=[]),c.seedAssignments.push(e)}return eh({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:i,structure:c}),{..._r}}function uU({qualifyingParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:r,structureId:n}){return DS({positionActionName:"qualifierDrawPositionAssignment",participantId:e,isQualifierPosition:!0,tournamentRecord:t,drawDefinition:i,drawPosition:r,structureId:n})}function lU({targetRoundNumber:e,finishingPosition:t,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=uy({drawDefinition:i,structureId:r})||{},o=(a?.target||[]).filter((({linkType:e})=>e===n)).filter((({target:t})=>!e||e===t.roundNumber)).map((e=>{let r=e.source.structureId,{structure:n}=lf({structureId:r,drawDefinition:i});if(!t||n?.finishingPosition===t)return e})).filter(Boolean);return{sourceStructureIds:o.map((({source:e})=>e.structureId)),relevantLinks:o}}var pU=(e,t)=>{let i=[...new Set(t.slice(0,e.length))],r=[...i].sort(((e,t)=>e-t)),n=new Set,a=[];i.forEach((t=>{let i=e.indexOf(t);if(-1===i||n.has(i)){let i=r.indexOf(t),o=e.findIndex(((e,t)=>!n.has(t)));for(;n.has(o)&&-1===o&&n.size<e.length;)o=e.findIndex(((e,t)=>!n.has(t)&&t>o));a.push(i),n.add(i)}else a.push(i),n.add(i)}));let o=e.filter(((e,t)=>!n.has(t)));return[...a,...o]};function mU({targetRoundNumber:e=1,tournamentRecord:t,drawDefinition:i,event:r,randomList:n}){let a=dp({drawDefinition:i,event:r,tournamentRecord:t},[{[Pl]:!0,[Kl]:!0,[Tl]:!0}]);if(a.error)return a;let o=[],s=[],c=i.structures?.find((e=>e.stage===vu&&1===e.stageSequence));if(!c)return Qs({result:{error:kn}});let d=(Fh({tournamentRecord:t,drawDefinition:i,structure:c,event:r}).appliedPolicies??{})[bp]?.requireCompletedStructures,{qualifierPositions:u,positionAssignments:l}=hf({structure:c});if(!u.length)return Qs({result:{error:po}});let p=gr(0,u.length);n&&(p=pU(p,n));let m=l.map((e=>e.participantId)).filter(Boolean),{relevantLinks:f}=lU({structureId:c.structureId,targetRoundNumber:e,linkType:ju,drawDefinition:i})||{},{relevantLinks:h}=lU({structureId:c.structureId,targetRoundNumber:e,linkType:Vu,drawDefinition:i})||{};for(let g of f){let e=i.structures?.find((e=>e.structureId===g.source.structureId));if(e?.stage!==Su)continue;let t=FS({structureId:g.source.structureId,drawDefinition:i});if(!d||t){let t=e.qualifyingRoundNumber,{matchUps:i}=oy({matchUpFilters:{...t&&{roundNumbers:[t]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:e});for(let e of i){let t="BYE"===e.matchUpStatus&&e.sides?.find((({participantId:e})=>e)),i=e.sides.find((t=>t?.sideNumber===e.winningSide));if(i||t){let{participantId:e}=i||t||{};e&&!m.includes(e)&&s.push(e)}}}}for(let g of h){let e=i?.structures?.find((e=>e.structureId===g.source.structureId));if(e?.stage===Su&&FS({structureId:g.source.structureId,drawDefinition:i})){let{positionAssignments:t}=ff({structure:e}),i=t?.map((e=>{let t=e.participantId,i=Jp({element:e,name:Sm}).extension?.value;return i?{participantId:t,groupOrder:i?.groupOrder}:{}})).filter((({groupOrder:e,participantId:t})=>1===e&&!m.includes(t))).map((({participantId:e})=>e))??[];i&&s.push(...i)}}return s.length?(p.forEach(((e,r)=>{let n=s[r],a=u[e].drawPosition;n&&uU({qualifyingParticipantId:n,structureId:c.structureId,drawPosition:a,tournamentRecord:t,drawDefinition:i})?.success&&o.push({participantId:n,drawPosition:a})})),Qs({result:Js({..._r,assignedParticipants:o})})):Qs({result:{error:za}})}function fU({drawDefinition:e,orderMap:t}){return e?(("object"!=typeof t||!Object.values(t).every((e=>ir(e))))&&Qs({result:{error:Ho},context:{orderMap:t}}),e.structures||(e.structures=[]),e.structures.forEach((e=>{let i=t[e.structureId];i&&(e.structureOrder=i)})),e.structures.sort(((e,t)=>cr(e.structureOrder)-cr(t.structureOrder))),{..._r}):{error:Jr}}function hU({drawDefinition:e}){let t=e.structures??[],i=e.links??[],r=new Map,n=e=>{let i=r.get(e)||r.set(e,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(e);if(i&&!i?.stage){let r=t.find((t=>t.structureId===e));i.stage=r?.stage}return i},a={},o={},s=i.map((e=>{let t=e.source.structureId,i=e.target.structureId,r=n(t),s=n(i);return[Bu,_u,Lu,ku].includes(e.target.feedProfile)?(r?.targets.push(i),s?.sources.push(t)):e.target.feedProfile===Fu&&(s?.drawSources.push(t),r?.drawTargets.push(i)),o[i]=o[i]||e.target.feedProfile===Fu,a[i]=ar([...a[i]||[],t]).filter(Boolean),[e.source.structureId,e.target.structureId]}));for(let h of r.keys()){let e=r.get(h);if(e){let t=e.targets??[];for(;t.length;){let i=t.pop(),n=i&&r[i];n?.targets?.length?t.push(...n.targets):n&&(e.rootStage=n.stage)}if(e.rootStage||(e.rootStage=e.stage),!e.targets?.length){let t=e.sources??[];for(;t.length;){let i=t.pop(),n=i&&r[i];if(n?.sources?.length){for(let t of n.sources)e.progeny?.includes(t)||e.progeny?.push(t);t.push(...n.sources)}}}}}let c=0;for(let h of r.keys()){let e=r.get(h);if(e&&e.rootStage===Su){let t=[e.drawTargets?.[0]],i=0;for(;t.length;){i+=1;let e=t.pop(),n=e?r.get(e):void 0;n?.drawTargets?.length&&t.push(n.drawTargets[0])}e.distanceFromMain=i,i>c&&(c=i)}}let d=s.length;gr(0,Math.ceil(d/2)).forEach((()=>{s=gr(0,d).map((e=>{let t=s[e],i=s.reduce(((e,i)=>Sr(t,i)?e.concat(...i):e),[])||[];return ar(t.concat(...i))}))}));let u=s[0],l=s.slice(1).reduce(((e,t)=>e&&((e,t)=>yr(e,t).length===e.length)(t,u)),!0),p=[u].filter(Boolean),m=[u].filter(Boolean);t.forEach((e=>{let{structureId:t,stage:i}=e;p.find((e=>e.includes(t)))||(p.push([t]),i!==bu&&m.push([t]))}));let f=l&&1===m.length;return!i?.length&&1===t.length&&n(t[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:f,maxQualifyingDepth:c,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:p}}function gU({drawDefinition:e}){let{maxQualifyingDepth:t,structureProfiles:i}=hU({drawDefinition:e});for(let r of e.structures){let e=i[r.structureId];e.distanceFromMain&&(r.stageSequence=t+1-e.distanceFromMain)}return{..._r}}function IU(e){let t=dp(e,[{[Tl]:!0,[Pl]:!0}]);if(t.error)return t;let{tournamentRecord:i,drawDefinition:r,structure:n,link:a}=e;return function(e){let t=dp(e,[{[Pl]:!0,[Vl]:!0},{link:!0,[rp]:Ql,[Br]:Nn}]);if(t.error)return t;let{drawDefinition:i,tournamentId:r,structure:n,eventId:a,link:o}=e,s=o.target.structureId,c=lf({drawDefinition:i,structureId:s});if(c.error)return Qs({stack:"attachQualifyingStructure",context:{targetStructureId:s},result:c});i.structures||(i.structures=[]),i.links||(i.links=[]),i.structures.push(n),i.links.push(o),gU({drawDefinition:i});let d=oy({structure:n})?.matchUps||[];return Kf({drawDefinition:i,tournamentId:r,matchUps:d,eventId:a}),Zf({drawDefinition:i,structureIds:[n.structureId]}),{..._r}}({tournamentId:i.tournamentId,drawDefinition:r,structure:n,link:a})}function yU({drawDefinition:e,structureDetails:t}){if(!Array.isArray(t))return{error:Ho};if(!e)return{error:Jr};let i=Object.assign({},...t.map((e=>{if(!Rr(e))return;let{structureId:t,structureName:i}=e||{};return t&&i?{[t]:i}:void 0})).filter(Boolean));if(!Object.values(i).length)return{error:va};for(let r of e.structures||[]){let e=i[r.structureId];if(e&&(r.structureName=e),r.structures)for(let t of r.structures){let e=i[t.structureId];e&&(t.structureName=e)}}return{..._r}}function vU({drawDefinition:e,timeItem:t}){if(!e)return{error:Zr};if(!t)return{error:Ao};let i=t&&Object.keys(t),r=["itemType","itemValue"];if(r.filter((e=>i.includes(e))).length!==r.length)return{error:Ro};e.timeItems||(e.timeItems=[]);let n=(new Date).toISOString();return Object.assign(t,{createdAt:n}),e.timeItems.push(t),Qf({drawDefinition:e}),{..._r}}function SU(e){let{tournamentRecord:t,drawDefinition:i,structureId:r,event:n}=e,a=dp(e,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=i.structures??[],s=o.find((e=>e.structureId===r));if(!s)return{error:Rn};let c=o.find((({stage:e,stageSequence:t})=>e===vu&&1===t)),d=r===c?.structureId,u=o.filter((({stage:e})=>e===Su)).map(Dy("structureId"));if(d&&!u.length)return{error:Wr};let l=u.includes(r),p=function({isQualifyingStructure:e,tournamentRecord:t,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){let s=[r];if(e){let e=e=>i.links?.find((t=>t.target.structureId===e)),t=e(r)?.source.structureId;for(;t;)s.push(t),t=e(t)?.source.structureId}if(gy({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps?.some((({score:e})=>My({score:e})))){let e=Fh({tournamentRecord:t,drawDefinition:i,structure:n,event:a})?.appliedPolicies;if(!(o??e?.[Rp]?.allowDeletionWithScoresPresent?.structures))return{error:cs}}return{..._r}}({isQualifyingStructure:l,structure:s,...e});if(p?.error)return p;let{structureIdsToRemove:m,relatedStructureIdsMap:f}=function({qualifyingStructureIds:e,isQualifyingStructure:t,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(Dy("structureId")),s=e=>n.links?.map((t=>t.source.structureId===e&&t.target.structureId!==r?.structureId&&t.target.structureId)).filter(Boolean)??[],c=t=>n.links?.map((i=>e.includes(i.source.structureId)&&i.target.structureId===t&&i.source.structureId)).filter(Boolean)??[],d=new Map;return o.forEach((e=>d.set(e,t?c(e):s(e)))),{structureIdsToRemove:i?d.get(a):[a],relatedStructureIdsMap:d}}({qualifyingStructureIds:u,isQualifyingStructure:l,isMainStageSequence1:d,mainStageSequence1:c,drawDefinition:i,structureId:r}),{removedMatchUpIds:h,removedStructureIds:g}=function({relatedStructureIdsMap:e,qualifyingStructureIds:t,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],c=[];for(;a?.length;){let d=a.pop();c.push(...wU({idBeingRemoved:d,drawDefinition:n}));let u=bU({qualifyingStructureIds:t,isMainStageSequence1:i,idBeingRemoved:d,drawDefinition:n,structureId:o});s.push(...u.removedStructureIds);let l=UU({relatedStructureIdsMap:e,mainStageSequence1:r,idBeingRemoved:d,structureId:o});l?.length&&a.push(...l)}return{removedMatchUpIds:c,removedStructureIds:s}}({relatedStructureIdsMap:f,qualifyingStructureIds:u,isMainStageSequence1:d,mainStageSequence1:c,drawDefinition:i,structureIdsToRemove:m,structureId:r});if(function({removedMatchUpIds:e,drawDefinition:t}){let{matchUps:i}=gy({drawDefinition:t});i?.forEach((t=>{t.winnerMatchUpId&&e.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,t.loserMatchUpId&&e.includes(t.loserMatchUpId)&&delete t.loserMatchUpId}))}({removedMatchUpIds:h,drawDefinition:i}),d){let e=(c.matchUps??[])?.map(Dy("matchUpId"));h.push(...e),c.positionAssignments=[],c.seedAssignments=[],c.matchUps=[],c.extensions&&(c.extensions=[])}return l&&gU({drawDefinition:i}),Xf({tournamentId:t?.tournamentId,matchUpIds:h,action:"removeStructure",eventId:n?.eventId,drawDefinition:i}),Zf({drawDefinition:i,eventId:n?.eventId}),{..._r,removedMatchUpIds:h,removedStructureIds:g}}function UU({idBeingRemoved:e,relatedStructureIdsMap:t,mainStageSequence1:i,structureId:r}){return e&&t.get(e)?.filter((e=>e!==i?.structureId||r===i.structureId))}function bU({qualifyingStructureIds:e,isMainStageSequence1:t,idBeingRemoved:i,drawDefinition:r,structureId:n}){let a=[];return r.links=r.links?.filter((e=>e.source.structureId!==i&&e.target.structureId!==i))??[],(!t||t&&e.length||i!==n)&&(r.structures=(r.structures??[]).filter((e=>(i&&i===e.structureId&&a.push(i),e.structureId!==i)))),{removedStructureIds:a}}function wU({idBeingRemoved:e,drawDefinition:t}){let{structure:i}=lf({structureId:e,drawDefinition:t}),r=oy({structure:i}).matchUps;return Am(r)}function TU({stageSequence:e=1,drawDefinition:t,drawSize:i,stage:r}){if(!t)return{error:Jr};if(!hg({drawDefinition:t,stage:r}))return{error:Gn};let n=function({stage:e,drawDefinition:t}){return lg.reduce(((i,r)=>(gg({drawDefinition:t,entryStatus:r,stage:e})||0)+i),0)}({drawDefinition:t,stage:r}),{qualifiersCount:a}=hv({drawDefinition:t,stageSequence:e,stage:r});if(i<n+a)return{error:hn};let{entryProfile:o}=Yh({attributes:[{[r]:{drawSize:i}}],drawDefinition:t});return Zf({drawDefinition:t}),{..._r,entryProfile:o}}function DU({qualifiersCount:e=0,drawDefinition:t,stage:i}){return t?hg({drawDefinition:t,stage:i})?(Yh({attributes:[{[i]:{qualifiersCount:e}}],drawDefinition:t}),Zf({drawDefinition:t}),{..._r}):{error:Gn}:{error:Jr}}function PU(e){return function({drawDefinition:e,drawSize:t}){if(!e)return{error:Jr};let i=TU({stage:bu,stageSequence:1,drawDefinition:e,drawSize:t});return i.error?i:(Zf({drawDefinition:e}),{..._r})}(e)}function NU({tournamentRecord:e,drawDefinition:t,event:i,structureId:r}){if(!t)return{error:Jr};let n=t.structures?.find((e=>e.stage===Su&&e.structureId===r));if(!n)return{error:Rn};if(n.matchUps?.some((({matchUpStatus:e,score:t})=>My({score:t})??af.includes(e))))return{error:cs};let a=n.matchUps?.map((({matchUpId:e})=>e))||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],Xf({tournamentId:e?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:t}),Zf({tournamentId:e?.tournamentId,eventId:i?.eventId,drawDefinition:t,structureIds:[n.structureId]}),{..._r}}var EU="qualifierDrawPositionAssignment",MU="withdrawParticipantAtDrawPosition",RU="alternateDrawPositionAssignment",CU="luckyLoserDrawPositionAssignment",AU="removeDrawPositionAssignment",kU="swapDrawPositionAssignments",OU="modifyPairAssignment",xU="adHocPositionSwap",FU="modifyParticipantOtherName",LU="assignDrawPosition",_U="removeSeededParticipant",BU="assignDrawPositionBye",VU="modifySeedAssignment",jU="addPenalty",$U="MODIFY_PAIR",GU="QUALIFIER",WU="ALTERNATE",qU="WITHDRAW",HU="ASSIGN",zU="REMOVE",YU="LUCKY",KU="REMOVE_SEED",XU="SWAP",JU="NICKNAME",QU="SEED_VALUE",ZU="PENALTY",eb={MODIFY_PAIR_ASSIGNMENT:$U,QUALIFYING_PARTICIPANT:GU,ALTERNATE_PARTICIPANT:WU,WITHDRAW_PARTICIPANT:qU,ASSIGN_PARTICIPANT:HU,LUCKY_PARTICIPANT:YU,REMOVE_ASSIGNMENT:zU,SWAP_PARTICIPANTS:XU,ADD_NICKNAME:JU,REMOVE_SEED:KU,ADD_PENALTY:ZU,ASSIGN_BYE:"BYE",SEED_VALUE:QU};function tb({tournamentRecord:e,drawDefinition:t,drawPositions:i,structureId:r,event:n}){if(!t)return{error:Jr};if(!r)return{error:Mn};if(2!==i?.length)return{error:Ho,drawPositions:i};let a=bg({drawDefinition:t}),{matchUps:o}=gy({inContext:!0,drawDefinition:t,matchUpsMap:a}),{structure:s}=lf({drawDefinition:t,structureId:r});if(!s)return{error:Rn};let c,d=Fh({tournamentRecord:e,drawDefinition:t,event:n}).appliedPolicies??{};if(c=s.structureType===xu?function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a.structures?.reduce(((e,t)=>{let i=t?.positionAssignments.filter((e=>r?.includes(e.drawPosition)));return i&&e.push(...i),e}),[]);if(2===s.filter((({bye:e})=>e)).length)return{..._r};if(2===s.filter((({qualifier:e})=>e)).length)return{..._r};wS({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:n,assignments:s,structure:a,event:o});let c=s.some((({qualifier:e})=>e));if(s.some((({bye:e})=>e))&&!c)ib({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o});else{let e=yd(s,!1,!0);s.forEach(((t,i)=>{let r=e[1-i].participantId;t.qualifier=e[1-i].qualifier,t.participantId=r}))}return{..._r}}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:i,matchUpsMap:a,structure:s,event:n}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a?.positionAssignments.filter((e=>r?.includes(e.drawPosition)));if(!s)return{error:Ho,structure:a,info:"Missing positionAssignments"};if(2===s.filter((({bye:e})=>e)).length)return{..._r};if(2===s.filter((({qualifier:e})=>e)).length)return{..._r};let c=s.some((({qualifier:e})=>e));return s.some((({bye:e})=>e))&&!c?ib({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map(((e,t)=>{let{drawPosition:i}=e;return{[i]:{...r[1-t],drawPosition:i}}})));return a.positionAssignments=a.positionAssignments.map((e=>s[e.drawPosition]||e)),wS({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{..._r}}({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:i,matchUpsMap:a,structure:s,event:n}),c.error)return c;if(rh({structure:s,drawPositions:i}),nh({appliedPolicies:d,drawDefinition:t,positionAction:{name:kU,drawPositions:i,structureId:r}}),th({tournamentId:e?.tournamentId,drawDefinition:t,structure:s,event:n}),n.eventType===Iu){let r=oy({matchUpFilters:{matchUpTypes:[$i]},inContext:!0,structure:s}).matchUps.filter((e=>e.drawPositions?.some((e=>i.includes(e))))),a=oy({matchUpFilters:{matchUpTypes:[$i]},structure:s}).matchUps;r.forEach((r=>{(r.sides||[]).forEach((o=>{let s=o?.drawPosition;if(i.includes(s)){let i=o.participantId,c=a.find((({matchUpId:e})=>e===r.matchUpId)),d=r?.sides?.reduce(((e,t,i)=>t.drawPosition===s?i:e),void 0);pS({inContextTargetMatchUp:r,drawPositionSideIndex:d,teamParticipantId:i,tournamentRecord:e,drawDefinition:t,matchUp:c,event:n})}}))}))}return Zf({drawDefinition:t,structureIds:[r]}),{..._r}}function ib({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find((({bye:e})=>e)),c=r.find((({participantId:e})=>e)),d=s.drawPosition,{participantId:u,drawPosition:l}=c,{structureId:p}=a,m=$v({drawPosition:d,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=$v({drawPosition:l,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||(Vy({drawPosition:l,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=TS({drawPosition:d,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:n,event:o}),m.error)?m:{..._r}}function rb({tournamentRecord:e,drawDefinition:t,participantId:i,structureId:r}){let n="removeSeededParticipant";if(!e)return{error:zr};if(!t)return{error:Jr};let a=(t.structures??[]).find((e=>e.structureId===r));return a?!a.stage||![vu,Su].includes(a.stage)||a.stage===vu&&1!==a.stageSequence?Qs({result:{error:en},stack:n}):a.seedAssignments?.find((e=>e.participantId===i))?{..._r}:Qs({info:"participant not seeded",result:{error:Qo},context:{participantId:i}}):Qs({result:{error:Rn},stack:n})}function nb({targetEntryRound:e=1,finishingPositions:t,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=ju}){return r&&n?{link:Js({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:t},target:{feedProfile:Fu,roundNumber:e,structureId:n}})}:{error:Mn}}function ab({matchUp:e,tieFormat:t,isMock:i,uuids:r}){let{collectionDefinitions:n}=t??{};return{tieMatchUps:(n??[]).map((t=>ob({matchUp:e,collectionDefinition:t,uuids:r,isMock:i}))).filter(Boolean).flat()}}function ob({collectionPositionOffset:e=0,collectionDefinition:t,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:c,processCodes:d}=t||{},u=e=>{if(!n&&!r?.isMock)return a?.pop()??Ud();let i=t?.collectionId;return a?.pop()??`${r?.matchUpId}-${i}-TMU-${e+1}`};return gr(0,i??o??0).map((t=>{let i=e+t+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:u(t),matchUpStatus:Jm,collectionPosition:i,collectionId:c,processCodes:d,matchUpType:s,isMock:n}}))}function sb({roundPosition:e,roundNumber:t,idPrefix:i,uuids:r}){return i?`${i}-${t}-${e}`:r?.pop()||Ud()}function cb({includeMatchUpType:e,matchUpType:t,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let c=0,d=[],u=1,l=i-1,p=s?.length;for(;c<(p||0);){let p=s?.[c],m=s?.[c+1];l&&(p.roundNumber=l),m&&l&&(m.roundNumber=l);let f={roundPosition:u,children:[p,m],matchUpId:sb({roundPosition:u,roundNumber:i,idPrefix:n,uuids:o})};d.push(f);let h={drawPositions:f.children.map((e=>e?.drawPosition)).filter(Boolean),matchUpStatus:Jm,matchUpId:f.matchUpId,roundPosition:u,roundNumber:i};e&&t&&(h.matchUpType=t),a&&(h.isMock=!0),r.push(h),u++,c+=2}return{roundNodes:d,matchUps:r}}function db({finishingPositionOffset:e,finishingPositionLimit:t,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:c,uuids:d}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!Yi(s)||s%r)){let e=r;for(;e<s;)e*=2;s=e}let u=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!Yi(s)&&!u)return{matchUps:[],roundsCount:0};let l,p=gr(1,s+1).map((e=>({drawPosition:e}))),m=[],f=1;for(({roundNodes:l,matchUps:m}=cb({matchUpType:n,roundNumber:f,idPrefix:o,matchUps:m,isMock:c,nodes:p,uuids:d})),f++,a=a??i;l.length>1;)r&&l.length===r&&(a=f-1),({roundNodes:l,matchUps:m}=cb({nodes:l,matchUpType:n,roundNumber:f,idPrefix:o,matchUps:m,isMock:c,uuids:d})),f++;let h=f-1;return m=Py({finishingPositionOffset:e,finishingPositionLimit:t,roundsCount:h,roundLimit:a,matchUps:m}),a?m=m.filter((e=>a&&(e.roundNumber??0)<=a)):a=f-1,{drawSize:s,matchUps:m,roundsCount:h,roundLimit:a}}function ub(e){let t="generateQualifyingStructure";if(!e.drawDefinition)return Qs({result:{error:Jr},stack:t});if(e.drawSize&&!ir(e.drawSize)||e.participantsCount&&!ir(e.participantsCount)||e.qualifyingPositions&&!ir(e.qualifyingPositions))return Qs({result:{error:Ho},stack:t});let i=e.drawSize??Xi(e.participantsCount),{hasExistingDrawDefinition:r,qualifyingRoundNumber:n,qualifyingPositions:a,targetStructureId:o,structureOptions:s,appliedPolicies:c,qualifyingOnly:d,drawDefinition:u,matchUpFormat:l,structureName:p,structureId:m,roundTarget:f,tieFormat:h,drawType:g,idPrefix:I,isMock:y,uuids:v}=e;if(!e.drawSize)return Qs({result:{error:gn},context:{drawSize:i},stack:t});if(a&&a>=e.drawSize)return Qs({result:{error:Ho},context:{drawSize:i,qualifyingPositions:a},stack:t});let S,U,b,w,T,D=0,{structureProfiles:P}=hU({drawDefinition:u}),N=P[o];if(!N)return Qs({result:{error:Rn},context:{targetStructureId:o},stack:t});let E=u.matchUpType,M=f?`${f}-`:"",R=N.stage===Su,C=c?.[Dp]?.namingConventions?.pre??kg[Dp]?.namingConventions?.pre,A=R&&C?`${C}-`:"",k=p??(M?`${A}${zv(Su)} ${M}`:`${A}${zv(Su)}`);if(g===ll){let{maxRoundNumber:e,structures:t,groupCount:n}=eS({structureName:p??k,structureId:m??v?.pop(),hasExistingDrawDefinition:r,stage:Su,structureOptions:s,appliedPolicies:c,qualifyingOnly:d,stageSequence:1,matchUpType:E,roundTarget:f,tieFormat:h,idPrefix:I,drawSize:i,isMock:y,uuids:v});D=n,S=e,b=t[0],T=[1]}else({drawSize:i,matchUps:w,roundLimit:S,roundsCount:U}=db({qualifyingRoundNumber:n,qualifyingPositions:a,matchUpType:E,idPrefix:I,drawSize:i,isMock:y,uuids:v})),S||(S=U),b=qv({structureName:p??k,structureId:m??v?.pop(),qualifyingRoundNumber:S,stage:Su,matchUpFormat:l,stageSequence:1,matchUpType:E,roundLimit:S,matchUps:w}),f&&Vp({extension:{name:hm,value:f},element:b}),D=w?.filter((e=>e.roundNumber===S))?.length;let O=g===ll?Vu:ju,x=b&&S&&nb({sourceStructureId:b.structureId,sourceRoundNumber:S,targetStructureId:o,finishingPositions:T,linkType:O})?.link;return h&&(w=oy({structure:b})?.matchUps||[],w?.forEach((e=>{let{tieMatchUps:t}=ab({tieFormat:h,matchUp:e,isMock:y});Object.assign(e,{tieMatchUps:t,matchUpType:E})}))),{qualifyingDrawPositionsCount:i,qualifiersCount:D,..._r,structure:b,link:x}}function lb(e){if(!e.tournamentRecord)return{error:zr};let t=function(e){if(!e.drawDefinition)return{error:Jr};if(!e.targetStructureId)return{error:Mn};let t=ub(e);if(t.error)return t;let{structure:i,link:r}=t;return i&&r?IU({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,structure:i,link:r}):{error:Ho}}(e);return t.error,t}function pb(e){let t=dp(e,[{[Pl]:!0,[Cl]:!0,[Ll]:!0},{roundNumber:!0,[ep]:e=>Number.isInteger(e)&&e>0},{[ep]:e=>Array.isArray(e)&&2===e.length&&e.every(Mr),[ip]:Va,participantIds:!0}]);if(t.error)return t;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=e,{structure:o}=lf({drawDefinition:i,structureId:r});if(!o)return{error:Rn};if(!Cg({structure:o}))return{error:en};let s=(o?.matchUps??[]).filter((t=>t.roundNumber===e.roundNumber)).filter((e=>!My(e))).filter((t=>t.sides?.map((e=>e.participantId)).some((t=>e.participantIds.includes(t)))));if(2!==s.length)return{error:Va};for(let c of s){let t=c?.sides?.find((t=>e.participantIds.includes(t?.participantId)));if(t){let r=e.participantIds.find((e=>e!==t?.participantId));t.participantId=r,Jf({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:i,matchUp:c})}}return Zf({drawDefinition:i,structureIds:[r]}),{..._r}}function mb({includeMatchUpType:e,drawPosition:t,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:c,fed:d}){let u=c.length,l=t?t-u:void 0,p=gr(0,u).map((e=>l?l+e:void 0)),m=[];for(let f=0;f<u;f++){let t=p.shift(),u={drawPosition:t,fed:d+1,feed:!0},l=c[f];l.roundNumber=i-1;let h=sb({roundPosition:l.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),g={roundPosition:l.roundPosition,drawPositions:[t],matchUpStatus:Jm,roundNumber:i,matchUpId:h};e&&(g.matchUpType=r),o&&(g.isMock=!0),a.push(g);let I={children:[l,u]};m.push(I)}return{roundNodes:m,matchUps:a,drawPosition:t?t-u:void 0}}function fb(e){let t=e.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=e,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:c,feedsFromFinal:d,isConsolation:u,matchUpType:l,idPrefix:p,isMock:m,uuids:f,fmlc:h}=e;a=a??function(e){let t=Ji(e);return t>e?t/2:t}(t);let g=function({drawSize:e}){let t=Math.ceil(Math.log(e)/Math.log(2));return gr(0,t).reverse().map((e=>Math.pow(2,e)))}({drawSize:a}),I=g.length,y=0;if(i?.length)y=i.reduce(((e,t)=>e+t),0);else if(t){let e=t-a;i=g.filter((t=>t<=e&&(e-=t,!0))),y=i.reduce(((e,t)=>e+t),0),r=i.length}else n>=I?r=0:d&&(r=I-d,n=0),i=g.filter(((e,t)=>d&&!r||r&&t>=n+r||t<n?0:e)),y=i.reduce(((e,t)=>e+t),0),r=i.length;let v=[...g,...i].sort(((e,t)=>t-e)),S=v.length,U=[...(c??[]).map((e=>e-1)),...(o??[]).map((e=>S-e))].map((e=>v[e])).reduce(((e,t)=>e+t),0);y-=U;let b,w=0,T=[],D=1,P=gr(0,a).map(((e,t)=>({drawPosition:t+1+y}))),N=y+1;for(let M of g){if(({roundNodes:b,matchUps:T}=cb({matchUpType:l,roundNumber:D,idPrefix:p,matchUps:T,isMock:m,nodes:P,uuids:f})),D++,i.includes(M)){let e=gr(0,dr(i)[M]),t=S+1-D,r=o?.includes(t)??c?.includes(D);e.forEach((()=>{({roundNodes:b,matchUps:T,drawPosition:N}=mb({drawPosition:!r&&N||void 0,nodes:b,matchUpType:l,roundNumber:D,idPrefix:p,matchUps:T,isMock:m,uuids:f,fed:w})),D++,w+=1}))}P=b}S!==D-1&&console.log("ERROR"),T=Py({finishingPositionOffset:u?a-y:s,positionsFed:y,roundsCount:S,matchUps:T,fmlc:h});let E=b?.length?b[0]:b;return E&&(E.roundNumber=D-1,E.matchUps=T),{draw:E,matchUps:T,roundsCount:S}}function hb(e){let{finishingPositionOffset:t=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:c="0",exitProfileLimit:d,roundOffsetLimit:u,roundOffset:l=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:f,stage:h=vu,drawSize:g,idPrefix:I,isMock:y,uuids:v}=e;if(o&&d&&!o?.[c]||g<2||f&&s>f)return{};let S=[],U=[],b=[],w=e.matchUpType??p?.matchUpType,T=t+1,D=`${T}-${t+g}`,P=o?.[c],N=r&&`${r} `||"",E=o?.[D]??n?.[D],M=e.structureName||E?.name||P?.name&&(i?`${N}${P?.name}`:P.name)||`${N}${D}`,R=E?.abbreviation??P?.abbreviation,C=e.structureId??P?.structureId??v?.pop(),A={idPrefix:I&&`${I}-${M}-RP`,finishingPositionOffset:t,matchUpType:w,drawSize:g,isMock:y,uuids:v},{matchUps:k}=m?fb(A):db(A),O=qv({structureAbbreviation:R,stageSequence:s,structureName:M,matchUpType:w,roundOffset:l,structureId:C,matchUps:k,stage:h});S.push(...k),U.push(O);let x=Math.ceil(Math.log(g)/Math.log(2)),F=u?Math.min(u-l,x):(!a||T<a)&&x||0;return g>2&&gr(1,F+1).forEach((e=>function(e){let m=g/Math.pow(2,e);if(m<2)return;let y=g/Math.pow(2,e)+t;if(a&&y+1>a)return;let{structures:T,structureId:D,matchUps:P,links:N}=hb({finishingPositionOffset:y,exitProfile:`${c}-${e}`,roundOffset:l+e,stageSequence:s+1,drawSize:m,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:d,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:w,idPrefix:I,uuids:v,stage:h});if(O.structureId&&D){let t={linkType:$u,source:{roundNumber:e,structureId:O.structureId},target:{roundNumber:1,feedProfile:_u,structureId:D}};N&&O&&N.push(t),N?.length&&b.push(...N)}return T?.length&&U.push(...T),P?.length&&S.push(...P),{structureId:D,childLinks:N,structures:U}}(e))),{structureId:O.structureId,matchUps:S,structureName:M,structures:U,links:b,..._r}}function gb({drawDefinition:e,matchUpsMap:t,structureId:i}){let r=lf({drawDefinition:e,structureId:i});if(r.error)return Qs({result:r});let{matchUps:n}=oy({structure:r.structure,matchUpsMap:t});return{...Ng({matchUps:n}),matchUps:n,matchUpsMap:t}}function Ib({finishingPositions:e,drawDefinition:t,structureId:i}){let{roundProfile:r}=gb({drawDefinition:t,structureId:i});return(r&&Object.keys(r))?.reduce(((t,i)=>(yb(r?.[i]).forEach((r=>{e.forEach((e=>{(function({position:e,rangeDefinition:t}){if(!Array.isArray(t)||t.reduce(((e,t)=>e||isNaN(t)),!1))return!1;let[i,r]=t;return gr(i,(r||i)+1).includes(e)})({position:e,rangeDefinition:r})&&(t[e]={roundNumber:i})}))})),t)),{})}function yb(e){return[ar(e?.finishingPositionRange?.loser||[]),ar(e?.finishingPositionRange?.winner||[])]}function vb(e){return yb(e).map((e=>gr(e[0],e[1]&&e[1]+1||e[0]+1)))}function Sb({drawDefinition:e,structureIds:t,matchUpsMap:i}){if(t&&!Array.isArray(t))return{error:Ho,context:{structureIds:t}};if(!e)return{error:Jr};let r=(t=t??(e.structures??[]).filter((e=>e.stage!==Su)).map((({structureId:e})=>e))).map((t=>{let{roundProfile:r}=gb({drawDefinition:e,matchUpsMap:i,structureId:t});return(r&&Object.values(r))?.map(vb).flat()})).flat(),n=r.filter((e=>1===e?.length)).sort(Hi).flat();return{positionsNotPlayedOff:ar(r.flat()).filter((e=>!n.includes(e))),positionsPlayedOff:n}}function Ub({excludeRoundNumbers:e=[],playoffPositions:t=[],drawDefinition:i,structureId:r}){if(!i)return{error:Jr};if(!r)return{error:Mn};if(!t)return{error:va,info:"missing playoffPositions"};let n=Sb({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=Ib({finishingPositions:t.filter((e=>!a.includes(e))),drawDefinition:i,structureId:r}),s=Object.values(o).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>zi(e))).filter((t=>!e.includes(t))),c=Ib({finishingPositions:a,drawDefinition:i,structureId:r}),d=c?Object.values(c):[],u=c?d.reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>zi(e))):[],l=s.filter((e=>!u.includes(e))).sort(Hi),{roundProfile:p}=gb({drawDefinition:i,structureId:r}),m=l.map((e=>{let t=p?.[e].finishingPositionRange.loser,[i,r]=t??[0,0];return gr(i,(r||i)+1)})).flat().sort(Hi),{playoffRoundsRanges:f}=function({playoffSourceRounds:e,roundProfile:t}){return{playoffRoundsRanges:e.map((e=>{let i=t[e].finishingPositionRange.loser,[r,n]=i,a=gr(r,(n||r)+1);return{finishingPositionRange:i.join("-"),finishingPositions:a,roundNumber:e}}))}}({playoffSourceRounds:l,roundProfile:p}),h=[...l,...u];return{playoffPositionsReturned:m,playedOffSourceRounds:u,playoffRoundsRanges:f,playoffSourceRounds:l,sourceRounds:h,roundProfile:p}}function bb({drawDefinition:e,structureId:t}){if(!e)return{error:Jr};let{matchUps:i,matchUpsMap:r}=by({inContext:!0,drawDefinition:e}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Sb({drawDefinition:e,matchUpsMap:r}),{structures:o}=pf({drawDefinition:e}),s=o.filter((e=>!t&&e.stage!==bu||e.structureId===t)),c={};for(let d of s){let t=d?.structureId,r=wb({playoffPositions:n,drawDefinition:e,structure:d,matchUps:i}),{error:a,...o}=r;if(a)return r;c[t]={structureId:t,...o}}return t?{positionsPlayedOff:a,...c[t]}:{availablePlayoffProfiles:Object.values(c),availablePlayoffRounds:Object.values(c),positionsPlayedOff:a}}function wb({playoffPositions:e,drawDefinition:t,structure:i,matchUps:r}){let n=i?.structureId,{links:a}=uy({drawDefinition:t,structureId:n});if(i.structureType===xu||i.structures){let e=ff({structure:i})?.positionAssignments?.length,o=i.structures.length,s=(e??0)/o,c=a.source?.flatMap((({source:e})=>e?.finishingPositions||[]))||[],d=gr(1,s+1).filter((e=>!c.includes(e))),u=r.find((e=>e.containerStructureId===n&&e.finishingPositionRange))?.finishingPositionRange?.winner||[0,1],l=a?.source.map((({target:e})=>e.structureId)),{positionsPlayedOff:p=[],positionsNotPlayedOff:m=[]}=Sb({structureIds:l,drawDefinition:t}),f=[...p,...m],h=gr(u[0],u[1]+1).filter((e=>!f.includes(e))),g=wr(h,h.length/d.length);return{positionsNotPlayedOff:h,playoffFinishingPositionRanges:d.map(((e,t)=>{let i=g[t];return{finishingPosition:e,finishingPositions:i,finishingPositionRange:[Math.min(...i||[]),Math.max(...i||[])].join("-")}})),finishingPositionsAvailable:d,finishingPositionsPlayedOff:c,positionsPlayedOff:p,groupCount:o,groupSize:s}}let o=a?.source?.filter((e=>e.linkCondition!==Gu)).map((e=>e.source?.roundNumber))||[],s=a?.source?.filter((e=>e.linkCondition===Gu)).map((e=>e.source?.roundNumber))||[],c=Ub({excludeRoundNumbers:o,playoffPositions:e,drawDefinition:t,structureId:n}),d=c?.playoffSourceRounds?[...c?.playoffSourceRounds||[]]:void 0,u=[...c?.playoffRoundsRanges||[]],{roundProfile:l,error:p}=c;for(let m of s){let e=a?.source.find((e=>e.source.roundNumber===m)),t=e?.target.roundNumber,i=e?.target.structureId,n=r.filter((({roundNumber:e,structureId:r})=>r===i&&e===t)),o=n.filter((({sides:e})=>e.find((e=>e.participantFed&&!e.participantId)))).length;if(d&&o===n.length){d.push(m);let e=l?.[m]?.finishingPositionRange?.loser;if(e){let t=Math.min(...e),i=t+o,r=gr(t,i),n={finishingPositionRange:[t,i-1].join("-"),finishingPositions:r,roundNumber:m};u.push(n)}}}return d&&d.sort(Hi),u.sort(((e,t)=>e.roundNumber-t.roundNumber)),{playoffRounds:d,playoffRoundsRanges:u,error:p}}function Tb(e){let{finishingPositionOffset:t=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:o=vu,matchUpType:s,structureId:c,idPrefix:d,drawSize:u,isMock:l,uuids:p}=e,m={finishingPositionOffset:t,matchUpType:s,drawSize:u,idPrefix:d,isMock:l,uuids:p},{matchUps:f}=n?fb(m):db(m),h=qv({structureName:a||i?.[0]?.name||zv(vu),structureId:c||p?.pop(),stageSequence:r,matchUpType:s,matchUps:f,stage:o}),g=[h],I=[];if(u>2){let r=u/2,{matchUps:n}=db({finishingPositionOffset:t+r,idPrefix:d&&`${d}-c`,drawSize:r,matchUpType:s,isMock:l}),o=zv(Uu),c=i?.["0-1"]?.name??e.consolationStructureName??(a?`${a} ${o}`:o),m=qv({structureName:c,matchUps:n,structureId:p?.pop(),stage:Uu,stageSequence:1,matchUpType:s});g.push(m);let f={linkType:$u,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:_u,structureId:m.structureId}};I.push(f)}return{..._r,structures:g,links:I}}function Db({consolationStructure:e,roundOffset:t=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=e.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),s=n?.roundGroupedOrder||[],c=n?.roundFeedProfiles;return gr(1+t,r+1+t).map((r=>{let n=c?.[r-1]?c[r-1]:r%2&&_u||Bu,d=r-t<=2?r-t:2*(r-t-2)+2,u={linkType:$u,source:{roundNumber:r,structureId:i.structureId},target:{feedProfile:n,roundNumber:d,structureId:e.structureId}},l=s[r-1];return l&&(u.target.groupedOrder=l),vs()&&(u.source.structureName=i.structureName,u.target.structureName=e.structureName),2===r&&a&&(u.linkCondition=Gu,u.target.feedProfile=_u),o.includes(d)?u:void 0})).filter(Boolean)}function Pb(e){let{playoffStructureNameBase:t,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:o,stage:s=vu,matchUpType:c,structureId:d,drawSize:u,idPrefix:l,isMock:p,uuids:m}=e,f={finishingPositionOffset:i,matchUpType:c,drawSize:u,idPrefix:l,isMock:p,uuids:m},{matchUps:h,roundsCount:g}=o?fb(f):db(f),I=e.structureName??n?.[0]?.name??zv(vu),y=Wv({structureId:d||m?.pop(),structureName:I,stageSequence:r,matchUpType:c,matchUps:h,stage:s}),v=[y],S=[];if(u>2){let e=[0,2].slice(0,u/16).map(((e,i)=>{let r=i+1,{consolationStructure:o}=function({playoffStructureNameBase:e,stageSequence:t=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:c,isMock:d,index:u,uuids:l}){let p=c/(2*Math.pow(2,n)),{matchUps:m,roundsCount:f}=fb({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:d,uuids:l}),h=0===u&&i?.["0-1"]?.name||1===u&&i?.["0-3"]?.name||`${zv(Uu)} ${u+1}`,g=r?.[h]||h,I=e?`${e} ${g}`:g;return{consolationStructure:Wv({matchUps:m,stage:Uu,structureName:I,stageSequence:t,matchUpType:a,structureId:o}),consolationRoundsCount:f}}({idPrefix:l&&`${l}-c${i}`,structureId:m?.pop(),playoffStructureNameBase:t,playoffAttributes:n,structureNameMap:a,stageSequence:r,roundOffset:e,matchUpType:c,drawSize:u,isMock:p,index:i,uuids:m});return v.push(o),{consolationStructure:o,links:Db({consolationStructure:o,roundsCount:2,mainStructure:y,roundOffset:e})}})).map((e=>e.links)).flat();if(S.push(...e),u>=4&&u<=16||u>32){let{matchUps:e}=db({idPrefix:l&&`${l}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:p}),i=n?.["3-4"]?.name??zv(wu),r=a?.[i]||i,o=t?`${t} ${r}`:r,s=Wv({structureId:m?.pop(),matchUps:e,stageSequence:2,stage:wu,structureName:o,matchUpType:c}),d={linkType:$u,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:s.structureId,feedProfile:_u,roundNumber:1}};v.push(s),S.push(d)}}return{structures:v,links:S,..._r}}function Nb(e){let{finishingPositionOffset:t,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:o,stage:s=vu,structureId:c,matchUpType:d,skipRounds:u,feedRounds:l,idPrefix:p,drawSize:m,isMock:f,uuids:h,fmlc:g}=e,I=e.feedPolicy||e.policyDefinitions?.[Ap]||e.appliedPolicies?.[Ap],y={finishingPositionOffset:t,matchUpType:d,skipRounds:u,drawSize:m,idPrefix:p,isMock:f,uuids:h},{matchUps:v}=a?fb(y):db(y),S=qv({structureName:o||r?.[0]?.name||zv(vu),structureId:c||h?.pop(),stageSequence:i,matchUpType:d,matchUps:v,stage:s}),U=[S],b=[],w=m/2,{matchUps:T,roundsCount:D}=fb({finishingPositionOffset:w,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:w,matchUpType:d,feedRounds:l,skipRounds:u,isMock:f,uuids:h,fmlc:g});if(m>2){let t=r?.["0-1"]?.name??zv(Uu),i=e.playoffStructureNameBase?`${e.playoffStructureNameBase} ${t}`:t,n=qv({matchUps:T,structureId:h?.pop(),stage:Uu,stageSequence:1,structureName:i,matchUpType:d});U.push(n);let a=Db({consolationStructure:n,mainStructure:S,roundsCount:D,feedPolicy:I,fmlc:g});b.push(...a)}return{..._r,structures:U,links:b}}function Eb({requireSequential:e=!0,playoffMatchUpFormat:t,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:c,feedPolicy:d,groupCount:u,idPrefix:l,isMock:p,uuids:m}){d=d||n?.[Ap];let f="processPlayoffGroups",h=0,g=[],I=[],y=[],{error:v,positionRangeMap:S}=function({playoffGroups:e,drawDefinition:t,structureId:i}){if(!t)return{error:Jr};if(!Mr(i)||!Array.isArray(e))return{error:Ho};let r=e.map((({finishingPositions:e})=>e)).flat();return{positionRangeMap:bb({drawDefinition:t,structureId:i}).playoffFinishingPositionRanges?.filter((e=>r.includes(e.finishingPosition)))?.reduce(((e,t)=>(e[t.finishingPosition]=t,e)),{})}}({structureId:r,drawDefinition:o,playoffGroups:s});if(v)return Qs({result:{error:v},stack:f});if(S&&!s?.every((t=>{let{finishingPositions:i=[]}=t;if(!i.length)return!1;let r=[...i].sort(Hi).map(((e,t)=>(i[t+1]||e)-e)).every((e=>e<2));return(!e||r)&&i.every((e=>S[e]))})))return Qs({context:{validFinishingPositions:Object.values(S)},result:{error:Ho},stack:f});for(let U of s){let e=U.finishingPositions,o=S&&e.flatMap((e=>S[e]?.finishingPositions??[])),s=u*e.length,f=er(s),v=2===f&&Yu||U.drawType||Yu;o&&(h=Math.min(...o)-1);let b=o&&`${Math.min(...o)}-${Math.max(...o)}`,w=U.structureName||b&&U.playoffAttributes?.[b]?.name||U.playoffAttributes?.[0]?.name,T={addNameBaseToAttributeName:U.addNameBaseToAttributeName,playoffStructureNameBase:U.playoffStructureNameBase,finishingPositionNaming:U.finishingPositionNaming,finishingPositionLimit:U.finishingPositionLimit,structureId:U.structureId??m?.pop(),playoffAttributes:U.playoffAttributes,structureNameMap:U.structureNameMap,sequenceLimit:U.sequenceLimit,structureName:w,idPrefix:l&&`${l}-po`,appliedPolicies:n,finishingPositionOffset:h,stage:wu,stageSequence:a,matchUpType:c,drawSize:f,isMock:p,uuids:m},D=({playoffStructures:t,playoffLinks:i})=>{let[n]=t,a=Mb({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:r});y.push(a,...i),I.push(...t),g.push({structureId:n.structureId,finishingPositions:e}),h+=s};if(v===Yu){let{matchUps:i}=db({finishingPositionLimit:h+s,idPrefix:l&&`${l}-po`,finishingPositionOffset:h,matchUpType:c,drawSize:f,isMock:p,uuids:m}),n=qv({structureId:U.structureId??m?.pop(),matchUpFormat:t,stage:wu,structureName:w,stageSequence:a,matchUps:i});I.push(n);let o=Mb({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:r});y.push(o),h+=s,g.push({structureId:n.structureId,finishingPositions:e})}else if([Hu,zu,wu].includes(v)){let t={playoffAttributes:U.playoffAttributes??i,playoffStructureNameBase:U.playoffStructureNameBase,structureId:U.structureId??m?.pop(),structureName:U.structureName,idPrefix:l&&`${l}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:h,stage:wu,roundOffset:0,stageSequence:a,drawSize:f,isMock:p,uuids:m};v===Hu?Object.assign(t,{playoffAttributes:U?.playoffAttributes??i??hl,roundOffsetLimit:3}):v===zu&&Object.assign(t,{playoffAttributes:U?.playoffAttributes??i??gl,roundOffsetLimit:2});let n=hb(t);if(n.error)return n;if(n.links?.length&&y.push(...n.links),n.structures?.length&&I.push(...n.structures),I.sort(df),n.structureId){let t=Mb({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:r});y.push(t),g.push({structureId:n.structureId,finishingPositions:e})}h+=s}else if([Xu,dl,ol,nl,il,cl].includes(v)){let t=[m?.pop(),m?.pop()],i={playoffStructureNameBase:U.playoffStructureNameBase,structureId:U.structureId??m?.pop(),playoffAttributes:U.playoffAttributes,idPrefix:l&&`${l}-po`,finishingPositionOffset:h,uuids:t,stage:wu,structureName:w,matchUpType:c,feedPolicy:d,drawSize:f,isMock:p},n={[Xu]:{fmlc:!0,feedRounds:1},[cl]:{feedRounds:1},[ol]:{feedsFromFinal:3},[nl]:{feedsFromFinal:2},[il]:{feedsFromFinal:1}};Object.assign(i,n[v]||{});let{structures:a,links:o}=Nb(i),[u]=a,S=Mb({playoffStructureId:u.structureId,finishingPositions:e,sourceStructureId:r});y.push(S,...o),I.push(...a),g.push({structureId:u.structureId,finishingPositions:e}),h+=s}else if([ll].includes(v)){let{structures:e,links:t}=eS({...T,structureOptions:U.structureOptions||{groupSize:4}});D({playoffStructures:e,playoffLinks:t})}else if([Ju].includes(v)){let{structures:e,links:t}=Tb(T);D({playoffStructures:e,playoffLinks:t})}else if([el].includes(v)){let{structures:e,links:t}=Pb(T);D({playoffStructures:e,playoffLinks:t})}else if([Wu].includes(v)){D({playoffStructures:[qv({structureId:U.structureId??m?.pop(),structureName:U.structureName,finishingPosition:Gh,stage:wu,stageSequence:a,matchUps:[]})],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:S,structures:I,links:y}}function Mb({playoffStructureId:e,finishingPositions:t,sourceStructureId:i}){return{linkType:Vu,source:{structureId:i,finishingPositions:t},target:{structureId:e,feedProfile:Fu,roundNumber:1}}}function Rb({value:e,sourceRange:t,targetRange:i}){let r=Math.min(...t),n=Math.max(...t),a=Math.min(...i);return(e-r)*(Math.max(...i)-a)/(n-r)+a}var Cb="NTRP",Ab={ELO:"ELO",NTRP:Cb,TRN:"TRN",UTR:"UTR",WTN:"WTN"},kb={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[Cb]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}};function Ob({targetRatingType:e,sourceRating:t}){let i=kb[e].decimalsCount||0,r=kb[e].range,n=r[0]>r[1],a=Math.max(...r),o=Rb({targetRange:r,sourceRange:kb.ELO.range,value:t}),s=Number.parseFloat(o.toFixed(i));return n?a-s:s}function xb(e){let t=dp(e,[{ratings:!0,[rp]:Ql}]);if(t.error)return t;let i=e.matchUpType&&[Bi,ji].includes(e.matchUpType)?e.matchUpType:Bi,r=Object.keys(kb),n=e.targetRatingType&&r.includes(e.targetRatingType)?e.targetRatingType:"ELO",a=e.ratings[i]?e.ratings[i].reduce(((e,t)=>e.includes(t.scaleName)?e:e.concat(t.scaleName)),[]):[];if(!a)return{error:Qo};let o=e.ratings[i]?.find((e=>e.scaleName===n))??e.ratings[i][0];if(a[0]===n)return o;let s=o.scaleName,c=kb[o.scaleName].accessor,d=c?o.scaleValue[c]:o.scaleValue,u=function({sourceRatingType:e,sourceRating:t}){let i=kb[e].range,r=i[0]>i[1],n=kb.ELO.range;return Rb({value:r?i[0]-t:t,sourceRange:i,targetRange:n})}({sourceRatingType:s,sourceRating:d});return{convertedRating:Ob({targetRatingType:n,sourceRating:u}),sourceRating:d}}function Fb({participantResults:e,sides:t,score:i}){let r=t.find((({sideNumber:e})=>1===e)),n=t.find((({sideNumber:e})=>2===e)),a=r?.participant?.ratings,o=n?.participant?.ratings;if(a?.[Bi]&&o?.[Bi]){let t="ELO",{convertedRating:s}=xb({ratings:a,targetRatingType:t}),{convertedRating:c}=xb({ratings:o,targetRatingType:t}),{side1pressure:d,side2pressure:u}=function({side1ConvertedRating:e,side2ConvertedRating:t,score:i}){let r=Math.max(e,t),n=Math.min(e,t),a=Math.abs(e-t),o=kb.ELO.range,s=Math.max(...o),c=0*(s-r),d=(r+c)/s*a,u=i?.sets?.reduce(((e,t)=>e+(t?.side1Score??0)),0),l=i?.sets?.reduce(((e,t)=>e+(t.side2Score??0)),0),p=e>t?2:1,m=(u||0)*(n+(1===p?d:0)),f=(l||0)*(n+(2===p?d:0)),h=m+f,g=h?nr(m/h):0,I=h?nr(f/h):0;return{side1pressure:g,side2pressure:I}}({side1ConvertedRating:s,side2ConvertedRating:c,score:i});d&&e[r?.participantId].pressureScores.push(d),u&&e[n?.participantId].pressureScores.push(u);let l=Math.max(...kb.ELO.range),p=nr((c-s)/l),m=nr((s-c)/l);e[r?.participantId].ratingVariation.push(p),e[n?.participantId].ratingVariation.push(m)}}function Lb({winningSide:e,matchUpFormat:t=Ad,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n?.sets,s="number"==typeof e&&e-1,c=Uc(t),d=Vb(c?.bestOf??1);if("number"==typeof s&&(i===Gm&&r?.setsCreditForDefaults||i===Qm&&r?.setsCreditForWalkovers))a[s]=d;else for(let u of o||[]){let{winningSide:e}=u;e&&(a[e-1]+=1)}return"number"==typeof s&&i===Km&&(+a[1-s]===d&&(a[1-s]-=1),r?.setsCreditForRetirements&&(a[s]=d)),a}function _b({matchUpFormat:e=Ad,winningSide:t,matchUpStatus:i,tallyPolicy:r,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let o="number"==typeof t&&t-1,s=Uc(e),c=Vb(s?.bestOf??1),d=s?.setFormat?.tiebreakAt||0,u=[[],[]];if("number"==typeof o&&(i===Gm&&r?.gamesCreditForDefaults||i===Qm&&r?.gamesCreditForWalkovers)){let e=c*(s?.setFormat?.setTo||0);u[o].push(e)}else a.forEach(((e,t)=>{let i=(e.setNumber||t+1)>c&&s?.finalSetFormat?"finalSetFormat":"setFormat",n=s?.[i]?.based,a=s?.[i].tiebreakSet,{side1Score:o,side2Score:d}=e;$b(n)&&!a&&(u[0].push(zi(o||0)),u[1].push(zi(d||0))),a&&e.winningSide&&!1!==r?.gamesCreditForTiebreakSets&&u[e.winningSide-1].push(1)}));if(i===Km&&"number"==typeof o){let n=a.length>c&&s?.finalSetFormat?"finalSetFormat":"setFormat",l=s?.[n];if($b(l.based)){let n=l?.setTo||0,p=e=>{if(s&&""!==e)return+e==d-1||+e===d?zi(d||0)+1:+e<d?n:d},m=Lb({winningSide:t,score:{sets:a},matchUpStatus:i,matchUpFormat:e,tallyPolicy:r});if(u.map((e=>e[o]<=e[1-o])).reduce(((e,t)=>e+(t?1:0)),0)>m[1-o]){let e=u[o].length,t=p(u[1-o][e-1]);t&&(u[o][e-1]=t)}c>u[o].length&&r?.gamesCreditForRetirements&&u[o].push(n)}}return[u[0].reduce(((e,t)=>e+t),0),u[1].reduce(((e,t)=>e+t),0)]}function Bb({matchUpFormat:e,score:t}){let i=e?Uc(e):void 0,r=Vb(i?.bestOf??1),n=[0,0],a=[0,0];return t?.sets?.forEach(((e,t)=>{let o=(e.setNumber||t+1)>r&&i?.finalSetFormat?"finalSetFormat":"setFormat",s=i?.[o]?.based;if(jb(s)){let{side1Score:t,side2Score:i}=e;t&&(a[0]+=zi(t||0)),i&&(a[1]+=zi(i||0))}else e.side1TiebreakScore&&(a[0]+=zi(e.side1TiebreakScore||0)),e.side2TiebreakScore&&(a[1]+=zi(e.side2TiebreakScore||0)),(e.side1TiebreakScore||e.side2TiebreakScore)&&e.winningSide&&(n[e.winningSide-1]+=1)})),{pointsTally:a,tiebreaksTally:n}}function Vb(e){return e&&Math.ceil(e/2)||1}function jb(e){return"P"===e}function $b(e){return!jb(e)}function Gb({participantIds:e,pressureRating:t,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,perPlayer:a,matchUps:o}){let s={},c=n?.excludeMatchUpStatuses||[],d=o?.filter((t=>(t.tieMatchUps||!c.includes(t.matchUpStatus))&&(!e?.length||2===yr(e,[Hb(t,0),Hb(t,1)]).length))),u=d?.flatMap((({score:e,tieMatchUps:t})=>t?t.filter((({matchUpStatus:e})=>!c.includes(e))).flatMap((({score:e})=>e?.sets?.length??0)):e?.sets?.length??0))?.reduce(((e,t)=>e+t),0),l=e=>e?.sets?.reduce(((e,t)=>e+(t?.side1Score??0)+(t?.side2Score??0)),0)??0,p=d?.flatMap((({score:e,tieMatchUps:t})=>t?t.filter((({matchUpStatus:e})=>!c.includes(e))).flatMap((({score:e})=>l(e))):l(e)))?.reduce(((e,t)=>e+t),0);for(let m of d??[]){let{matchUpStatus:e,tieMatchUps:i,tieFormat:o,score:c,winningSide:d,sides:u}=m,l=o&&m._disableAutoCalc&&o.collectionDefinitions.every((({scoreValue:e})=>e)),p=d&&Wb(m),f=d&&qb(m);if(p||f)if(zb(s,p),zb(s,f),i?.length){a=0;for(let e of i){let{matchUpType:i}=e,r=yI(ji)(i),a=yI(Bi)(i);e.winningSide&&(e.winningSide===d?(p&&(s[p].tieMatchUpsWon+=1,a&&(s[p].tieSinglesWon+=1),r&&(s[p].tieDoublesWon+=1)),f&&(s[f].tieMatchUpsLost+=1,a&&(s[f].tieSinglesLost+=1),r&&(s[f].tieDoublesLost+=1))):e.winningSide!==d&&(f&&(s[f].tieMatchUpsWon+=1,a&&(s[f].tieSinglesWon+=1),r&&(s[f].tieDoublesWon+=1)),p&&(s[p].tieMatchUpsLost+=1,a&&(s[p].tieSinglesLost+=1),r&&(s[p].tieDoublesLost+=1)))),Kb({matchUpFormat:e.matchUpFormat,matchUpStatus:e.matchUpStatus,matchUpType:e.matchUpType,score:e.score,sides:e.sides,winningParticipantId:p,losingParticipantId:f,manualGamesOverride:l,participantResults:s,isTieMatchUp:!0,pressureRating:t,tallyPolicy:n,winningSide:d})}Xb({winningParticipantId:p,losingParticipantId:f,participantResults:s,matchUpStatus:e})}else Kb({matchUpFormat:m.matchUpFormat??r,matchUpType:m.matchUpType,isTieMatchUp:void 0,winningParticipantId:p,manualGamesOverride:l,losingParticipantId:f,participantResults:s,pressureRating:t,matchUpStatus:e,tallyPolicy:n,winningSide:d,score:c,sides:u});else if(e&&af.includes(e)){let e=Hb(m,0),t=Hb(m,1);e&&(zb(s,e),s[e].matchUpsCancelled+=1),t&&(zb(s,t),s[t].matchUpsCancelled+=1)}else if(i?.length){a=0;for(let e of i){if(e.winningSide){let t=u?.find((({sideNumber:t})=>t===e.winningSide))?.participantId,i=u?.find((({sideNumber:t})=>t===e.winningSide))?.participantId;t&&i&&(zb(s,t),zb(s,i),s[t].tieMatchUpsWon+=1,s[i].tieMatchUpsLost+=1,yI(Bi)(e.matchUpType)?(s[t].tieSinglesWon+=1,s[i].tieSinglesLost+=1):yI(ji)(e.matchUpType)&&(s[t].tieDoublesWon+=1,s[i].tieDoublesLost+=1))}Yb({score:e.score,manualGamesOverride:l,participantResults:s,sides:u})}}else Yb({manualGamesOverride:l,participantResults:s,score:c,sides:u});if(l){let e=c?.sets?.reduce(((e,t)=>e+(t?.side1Score??0)),0),t=c?.sets?.reduce(((e,t)=>e+(t.side2Score??0)),0),i=u?.find((({sideNumber:e})=>1===e))?.participantId,r=u?.find((({sideNumber:e})=>2===e))?.participantId;zb(s,i),zb(s,r),i&&(s[i].gamesWon+=e,s[i].gamesLost+=t),r&&(s[r].gamesWon+=t,s[r].gamesLost+=e)}}return function({participantResults:e,groupingTotal:t,matchUpFormat:i,tallyPolicy:r,totalGames:n,perPlayer:a,totalSets:o}){let s=i&&Uc(i)||{},c=s.bestOf,d=c&&Math.ceil(c/2)||1,u=s.setFormat?.setTo,l=Math.pow(10,r?.precision||3);Object.keys(e).forEach((i=>{let s=e[i].setsWon,c=e[i].setsLost,p=r?.groupTotalSetsPlayed||"setsPct"===t?o:a*d||s+c,m=Math.round(s/p*l)/l;(m===1/0||Number.isNaN(m))&&(m=p);let f=e[i].tieMatchUpsWon,h=f+e[i].tieMatchUpsLost,g=Math.round(f/h*l)/l;(g===1/0||Number.isNaN(g))&&(g=f);let I=e[i].matchUpsWon,y=I+e[i].matchUpsLost,v=Math.round(I/y*l)/l;(v===1/0||Number.isNaN(v))&&(v=I);let S=e[i].gamesWon||0,U=e[i].gamesLost||0,b=(a||0)*d*(u||0),w=r?.groupTotalGamesPlayed||"gamesPct"===t?n:Math.max(b,S+U),T=Math.round(S/w*l)/l;(T===1/0||Number.isNaN(T))&&(T=0);let D=e[i].pointsWon+e[i].pointsLost,P=Math.round(e[i].pointsWon/D*l)/l;(P===1/0||Number.isNaN(P))&&(P=0),e[i].setsWon=s,e[i].setsLost=c,e[i].setsPct=m,e[i].tieMatchUpsWon=f,e[i].tieMatchUpsPct=g,e[i].matchUpsPct=v,e[i].gamesWon=S,e[i].gamesLost=U,e[i].gamesPct=T,e[i].pointsPct=P,e[i].result=`${e[i].matchUpsWon}/${e[i].matchUpsLost}`}))}({participantResults:s,groupingTotal:i,matchUpFormat:r,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:u}),{participantResults:s}}function Wb(e){return Hb(e,e.winningSide-1)}function qb(e){return Hb(e,1-(e.winningSide-1))}function Hb(e,t){if(!e?.sides)return console.log("no sides:",{matchUp:e}),"foo";let i=e.sides[t];return i?i.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function zb(e,t){t&&!e[t]&&(e[t]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function Yb({manualGamesOverride:e,participantResults:t,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let c of n||[]){let{winningSide:e,side1Score:t,side2Score:i}=c;e&&(o[e-1]+=1),a[0].push(zi(t||0)),a[1].push(zi(i||0))}let s=[a[0].reduce(((e,t)=>e+t),0),a[1].reduce(((e,t)=>e+t),0)];r.forEach(((i,r)=>{let{participantId:n}=i;n&&(zb(t,n),t[n].setsWon+=o[r],t[n].setsLost+=o[1-r],e||(t[n].gamesWon+=s[r],t[n].gamesLost+=s[1-r]))}))}function Kb({winningParticipantId:e,manualGamesOverride:t,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:c,tallyPolicy:d,winningSide:u,score:l,sides:p}){let m=u&&u-1,f=1-m;n&&c===Bi&&Fb({participantResults:r,sides:p,score:l}),s||Xb({winningParticipantId:e,losingParticipantId:i,participantResults:r,matchUpStatus:o});let h=Lb({matchUpStatus:o,matchUpFormat:a,tallyPolicy:d,winningSide:u,score:l}),g=_b({matchUpStatus:o,matchUpFormat:a,tallyPolicy:d,winningSide:u,score:l}),{pointsTally:I}=Bb({score:l,matchUpFormat:a});e&&(r[e].setsWon+=h[m],r[e].setsLost+=h[f],t||(r[e].gamesWon+=g[m],r[e].gamesLost+=g[f]),r[e].pointsWon+=I[m],r[e].pointsLost+=I[f]),i&&(r[i].setsWon+=h[f],r[i].setsLost+=h[m],t||(r[i].gamesWon+=g[f],r[i].gamesLost+=g[m]),r[i].pointsWon+=I[f],r[i].pointsLost+=I[m])}function Xb({winningParticipantId:e,losingParticipantId:t,participantResults:i,matchUpStatus:r}){t&&(r===Qm&&(i[t].walkovers+=1),r===Gm&&(i[t].defaults+=1),r===Km&&(i[t].retirements+=1),By(r)&&(i[t].allDefaults+=1),i[t].matchUpsLost+=1),e&&(i[e].matchUpsWon+=1),t&&e&&(i[t].defeats.push(e),i[e].victories.push(t))}function Jb(e,t,i,r){if(e.excludedDirectives?.length){let t=e.excludedDirectives.map((({attribute:e})=>e)).join(", "),i=`${t.length} directives were excluded due to participants limit}`;r.push(i);let n=`Excluded: ${t}`;r.push(n)}else{let n=(t,i)=>Number.parseFloat(e.reversed?t:i)-Number.parseFloat(e.reversed?i:t),a=e.groups?Object.values(e.groups).flat(1/0).length:e.participantIds?.length??0,o=e.reversed?" in reverse order":"",s=`Step ${t+1}: ${a} particiants were ${e.groups?"grouped":"separated"}${o} by ${e.attribute}`;if(r.push(s),e.idsFilter){let t=`${e.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(t)}!function(e,t,i,r){e.groups&&Object.keys(e.groups).sort(r).forEach((r=>{let n=e.groups[r].map((e=>t[e])).join(", "),a=`${r} ${e.attribute}: ${n}`;i.push(a)}))}(e,i,r,n)}r.push("----------------------")}function Qb({participantResults:e,participantIds:t,attribute:i}){return Zb({participantResults:e,participantIds:t}).reduce(((e,t)=>{let{participantId:r,results:n}=t,a=n?.[i];return!isNaN(a)&&r&&(e[a]?e[a].push(r):e[a]=[r]),e}),{})}function Zb(e){return(e.participantIds||Object.keys(e.participantResults)).reduce(((t,i,r)=>(t.push({participantId:i,i:r,results:e.participantResults[i]}),t)),[])}var ew=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],tw={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function iw(e){let{requireCompletion:t=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=e,a=[];if(t&&!function({participantResults:e,participantsCount:t}){let i=Zb({participantResults:e}).filter((e=>t-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled));return t===i.length}(e))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=Qb({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let c,d,u=Object.keys(s).map((e=>parseFloat(e))).sort(((e,t)=>t-e)).map((e=>s[e])).map((t=>{let i=rw({participantIds:t,...e});return a.push(...i.report??[]),i.order})).map(((e,t)=>e.map((e=>e.resolved?e:{...e,subGroup:[t].concat(...e.subGroup??[])})))).flat(),l=0,p=1;u.forEach(((e,t)=>{t&&(e.resolved||d&&!e.resolved)&&(p+=1),d=e.resolved;let i=parseInt(e.subGroup?.join("")||0);e.resolved?(e.position=t+1,p=e.position):(c&&i>c&&(p+=l,l=0),e.position=p,l+=1),c=i}));let m=dr(u.map((({position:e})=>e)));return u.forEach((e=>{let{participantId:t,position:a}=e||{},o=i[t];e.GEMscore=function(e){return(Array.isArray(n?.GEMscore)?Object.keys(tw).filter((e=>n.GEMscore.includes(e))):Object.keys(tw)).map((t=>(e[t]||0)*Math.pow(10,tw[t].toFixed(3)))).reduce(((e,t)=>e+t),0)}(o);let s=m[a];void 0!==e?.position&&(s>1&&(e.ties=s,r&&(e.subOrder=r[t])),e.rankOrder=a,e.groupOrder=a+(e.subOrder||1)-1)})),{groupOrder:u,report:a.flat(1/0).filter(Boolean)}}function rw({participantResults:e,disableHeadToHead:t,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o,s=[],c=[];if(1===i?.length)return{order:[{resolved:!0,participantId:i[0]}]};if(2===i?.length&&(!n?.headToHead||!n.headToHead.disabled&&!t)){let t=function({participantIds:e,participantResults:t}){if(e){if(t[e[0]].victories.includes(e[1]))return e.map((e=>({resolved:!0,participantId:e})));if(t[e[1]].victories.includes(e[0]))return e.reverse().map((e=>({resolved:!0,participantId:e})))}}({participantIds:i,participantResults:e});if(t){let e=t[0].participantId;return c.push({attribute:"head2Head",participantIds:i,headToHeadWinner:e}),{order:t,headToHeadWinner:e,report:c}}}let d=(n?.tallyDirectives||ew).filter((e=>{let t=!(Qi(e.maxParticipants)&&i?.length>e.maxParticipants);return t||s.push(e),t}));return s.length&&c.push({excludedDirectives:s,participantIds:i}),d.every((({attribute:e,reversed:t,idsFilter:s,groupTotals:d,disableHeadToHead:u})=>(o=function({disableHeadToHead:e,participantIds:t,matchUpFormat:i,groupTotals:r,tallyPolicy:n,attribute:a,idsFilter:o,matchUps:s,reversed:c}){let d,{participantResults:u}=Gb({participantIds:o&&t,groupingTotal:r&&a,matchUpFormat:i,tallyPolicy:n,matchUps:s}),l=Qb({participantResults:u,participantIds:t,attribute:a}),p=[{attribute:a,reversed:c,groups:l,idsFilter:o,groupTotals:r}];return Object.keys(l).length>1&&t.length&&(d=Object.keys(l).map((e=>parseFloat(e))).sort(((e,t)=>c?e-t:t-e)).map((e=>l[e])).map((t=>{let r=rw({participantResults:u,disableHeadToHead:e,participantIds:t,matchUpFormat:i,tallyPolicy:n,matchUps:s});return p.push(...r.report??[]),r.order})).map(((e,t)=>e.map((e=>e.resolved?e:{...e,subGroup:[t].concat(...e.subGroup??[])})))).flat()),{order:d,report:p}}({disableHeadToHead:u,participantIds:i,matchUpFormat:r,groupTotals:d,tallyPolicy:n,attribute:e,idsFilter:s,matchUps:a,reversed:t}),c.push(o.report),!o.order))),o.order?{order:o.order,report:c}:{order:i?.map((e=>({participantId:e}))),report:c}}function nw({policyDefinitions:e,generateReport:t,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!n?.length||!Pg(n))return{error:oa};let s=ar(n.map((({structureId:e})=>e)));if(1!==s.length)return Qs({result:{error:Ho,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let c=n.filter((e=>e&&"BYE"!==e.matchUpStatus)),d=c.length&&ar(c.map((({drawPositions:e})=>e)).flat()).length,u=c.filter((e=>sy({matchUp:e}))).length===c.length;u||(o=0);let l,p,m=n.every((({matchUpType:e,tieMatchUps:t})=>e===Gi&&t?.every((e=>sy({matchUp:e}))))),f=e?.[Up],h=n.filter((e=>sy({matchUp:e})??e.matchUpType===Gi)),{participantResults:g}=Gb({matchUps:h,pressureRating:i,matchUpFormat:r,tallyPolicy:f,perPlayer:o}),{groupOrder:I,report:y}=iw({matchUps:h,participantResults:g,participantsCount:d,matchUpFormat:r,subOrderMap:a,tallyPolicy:f});if(i&&function({participantResults:e}){let t=e=>e.reduce(((e,t)=>e+parseFloat(t)),0),i=e=>parseFloat((t(e)/e.length).toFixed(2)),r=Object.keys(e).map((t=>{let r=e[t],{pressureScores:n}=r;return{participantId:t,averagePressure:n?.length?i(n):0}})).sort(((e,t)=>(t.averagePressure||0)-(e.averagePressure||0))).map(((e,t)=>({...e,order:t+1})));for(let n of r)e[n.participantId].pressureOrder=n.order}({participantResults:g}),u&&I)l=y,p=I,I.forEach((e=>{let{participantId:t,groupOrder:i,rankOrder:r,subOrder:n,ties:a,GEMscore:o}=e,s=g[t];Object.assign(s,{groupOrder:i,rankOrder:r,GEMscore:o,subOrder:n,ties:a})}));else{let{groupOrder:e,report:t}=iw({requireCompletion:!1,participantResults:g,participantsCount:d,matchUpFormat:r,tallyPolicy:f,subOrderMap:a,matchUps:n});l=t,p=e,e&&e.forEach((e=>{let{participantId:t,groupOrder:i,GEMscore:r}=e,n=g[t];Object.assign(n,{provisionalOrder:i,GEMscore:r})}))}let v={completedTieMatchUps:m,readableReport:"",participantResults:g,bracketComplete:u,order:[],report:l};if((u||m)&&(v.order=p),t||vs({tally:!0})){let e=function({matchUps:e,order:t,report:i}){let r={};e.forEach((({sides:e})=>{e.forEach((e=>{e.participantId&&e.participant&&(r[e.participantId]=e.participant.participantName)}))}));let n=[];return Array.isArray(i)&&i.forEach(((e,t)=>{Jb(e,t,r,n)})),n.push("Final Order:"),t.forEach((e=>{let{participantId:t,resolved:i}=e,a=e.groupOrder||e.provisionalOrder;n.push(`${a}: ${r[t]} => resolved: ${!!i}`)})),n.join("\r\n")}({matchUps:n,report:l,order:p});vs({tally:!0})&&console.log(e),v.readableReport=e}return v}function aw({positionAssignments:e}){let t=(e||[]).filter(Dy(Ml)).map((e=>{let{extension:t}=Jp({element:e,name:vm}),i=zi(t?.value),r=!isNaN(i)&&i;return r&&{participantId:e.participantId,subOrder:r}})).filter(Boolean),i=dr(t.map((({subOrder:e})=>e)));return{subOrderMap:Object.assign({},...t.filter((({subOrder:e})=>1===i[e])).map((({participantId:e,subOrder:t})=>({[e]:t}))))}}function ow({positionAssignments:e,tournamentRecord:t,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!Pg(n))return{error:Ho};if(!e)return{error:Ho};let{policyDefinitions:o}=Lh({policyTypes:[Up],tournamentRecord:t,drawDefinition:i,event:a}),{subOrderMap:s}=aw({positionAssignments:e}),c=n.length?nw({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(c?.error)return c;let{participantResults:d={},bracketComplete:u,report:l}=c??{},p=Object.keys(d);return e.forEach((e=>{let{participantId:t}=e;if(p.includes(t)){Vp({element:e,extension:{value:d[t],name:Sm}}),d[t].ties||_p({element:e,name:vm})}else _p({element:e,name:Sm}),_p({element:e,name:vm})})),Zf({drawDefinition:i}),{..._r,participantResults:d,bracketComplete:u,report:l}}function sw({matchUps:e,matchUpId:t}){return{matchUp:(e||[]).find((e=>e.matchUpId===t))}}function cw(e){let t=dp(e,[{[Pl]:!0,[Ll]:!0}]);if(t.error)return t;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:c,context:d,event:u}=e,{structures:l=[]}=pf({drawDefinition:a}),p=e.contextContent||n&&qh({contextProfile:n,drawDefinition:a});for(let m of l){let{matchUps:e}=oy({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:c,structure:m,context:d,event:u}),{matchUp:t}=sw({matchUps:e,matchUpId:s});if(t)return{matchUp:t,structure:m}}return{error:aa}}function dw(e){return Rr(e)&&e.notes?Rr(e.element)&&(Mr(e.notes)||e.notes?.testing)?(Object.assign(e.element,{notes:e.notes}),{..._r}):{error:Ho}:{error:va}}function uw(e){return Rr(e)?Rr(e.element)?(e.element.notes&&delete e.element.notes,{..._r}):{error:Ho}:{error:va}}var lw={matchUpStatus:Jm,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function pw(e){let t,i="modifyMatchUpScore",r=e.matchUpFormat,n=e.matchUp,{matchUpStatusCodes:a,tournamentRecord:o,drawDefinition:s,matchUpStatus:c,removeScore:d,winningSide:u,matchUpId:l,event:p,notes:m,score:f}=e,h=e.appliedPolicies&&Object.keys(e.appliedPolicies).length?e.appliedPolicies:Fh({policyTypes:[Rp],tournamentRecord:o,drawDefinition:s,structure:t,event:p})?.appliedPolicies,g=n.matchUpType===Gi;if(g&&s){if(l&&n.matchUpId!==l){let e=cw({drawDefinition:s,matchUpId:l,event:p});if(!e.matchUp)return{error:aa};({matchUp:n,structure:t}=e)}}else n.matchUpId!==l&&console.log("!!!!!");c&&[Qm,qm].includes(c)||d?Object.assign(n,{...lw}):f&&(n.score=f);let I,y=c&&n?.matchUpStatus===Gm&&c!==Gm;if(c&&(n.matchUpStatus=c),r&&(n.matchUpFormat=r),a&&(n.matchUpStatusCodes=a),u&&(n.winningSide=u),e.removeWinningSide&&(n.winningSide=void 0),!t&&s&&({structure:t}=cw({drawDefinition:s,matchUpId:l,event:p})),c&&!n.winningSide&&My(n)&&!af.includes(c)&&![Bm,Xm,zm].includes(c)&&(n.matchUpStatus=Hm),(y&&n?.processCodes?.length||c===Gm)&&(I=h?.[Rp]?.processCodes?.incompleteAssignmentsOnDefault),!n.collectionId){let e=t?.structureType===xu,a=Cg({structure:t});if(Rg({drawDefinition:s,structure:t})||a||e){let c=(e=>{r=g?"SET1-S:T100":r??n.matchUpFormat??e?.matchUpFormat??s?.matchUpFormat??p?.matchUpFormat;let t=g?{matchUpTypes:[Gi]}:void 0,{matchUps:i}=oy({afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,matchUpFilters:t,drawDefinition:s,structure:e,event:p});return a&&(e.positionAssignments=ar(i.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})))),ow({positionAssignments:e.positionAssignments,tournamentRecord:o,drawDefinition:s,matchUpFormat:r,matchUps:i,event:p})})(e&&t.structures.find((e=>e?.matchUps.find((e=>e.matchUpId===l))))||t);if(c.error)return Qs({result:c,stack:i})}}if(m){let e=dw({element:n,notes:m});if(e.error)return Qs({result:e,stack:i})}let v=o?.tournamentId,S=Ls().topics.includes(Hf),U=(S||I)&&bg({drawDefinition:s}),b=U&&gy({matchUpFilters:{matchUpIds:[l]},nextMatchUps:!0,tournamentRecord:o,inContext:!0,drawDefinition:s,matchUpsMap:U}).matchUps?.[0];if(S&&b&&function({tournamentId:e,inContextMatchUp:t}){t&&As({payload:{inContextMatchUp:t,tournamentId:e},topic:Hf,key:t.matchUpId})}({tournamentId:v,inContextMatchUp:b}),Array.isArray(I)&&b&&!b.sides?.every((({participantId:e})=>e)))if(c===Gm)n.processCodes=ar([...n.processCodes??[],...I]);else for(let w of I||[]){let e=w&&n?.processCodes?.lastIndexOf(w);n?.processCodes?.splice(e,1)}return Jf({eventId:p?.eventId,context:i,drawDefinition:s,tournamentId:v,matchUp:n}),{..._r}}function mw(e){let{propagateExitStatus:t,matchUpStatusCodes:i,autoCalcDisabled:r,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:o,structure:s,matchUp:c}=e,d=Ry({matchUpStatus:a})||[Vm,_m].includes(a)&&o||r,u=c?.sides?.map((e=>e.participantId)).filter(Boolean).length||n?.sides?.map((e=>e.participantId)).filter(Boolean).length,l="attemptToModifyScore";if(!(Cg({structure:s})&&1===u||a===Gm&&u||function({structure:e,matchUp:t,inContextMatchUp:i}){let{drawPositions:r}=t,{positionAssignments:n}=hf({structure:e}),a=n?.filter((e=>r?.includes(e.drawPosition)&&e.participantId)),o=i?.sides?.every((e=>e.participantId));return 2===a?.length||o}({structure:s,matchUp:c,inContextMatchUp:n})||!1===e.appliedPolicies?.[Rp]?.requireParticipantsForScoring||By(a)&&1===u&&t))return Qs({result:{error:jn},stack:l});let p=[Qm].includes(a),m=d?a:e.winningSide&&jm||zm;return Qs({result:pw({...e,winningSide:e.winningSide,matchUpStatusCodes:d&&i||[],matchUpStatus:m,removeScore:p}),stack:l})}function fw({collectionGroups:e=[]}){let t=Object.assign({},...e.filter((e=>ir(e?.groupValue)&&e?.groupNumber)).map((e=>({[e.groupNumber]:{...e,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))));return{groupValueGroups:t,groupValueNumbers:Object.keys(t).map((e=>zi(e)))}}function hw({collectionDefinition:e,groupValueNumbers:t,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter((t=>t.collectionId===e.collectionId)),o=[0,0],s=[0,0],c=a.every((e=>af.includes(e.matchUpStatus))),{collectionValueProfiles:d,collectionGroupNumber:u,collectionValue:l,matchUpValue:p,winCriteria:m,scoreValue:f,setValue:h}=e,g=u&&t.includes(u),I=[0,0];if(a.forEach((e=>{e.winningSide&&(I[e.winningSide-1]+=1)})),ir(p)?a.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=p)})):ir(h)?a.forEach((e=>{e.score?.sets?.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=h)}))})):ir(f)?a.forEach((e=>{e.score?.sets?.forEach((t=>{let{side1TiebreakScore:i=0,side2TiebreakScore:r=0,side1Score:n=0,side2Score:a=0}=t;(e.matchUpStatus===jm||e.winningSide||t.winningSide)&&(n||a?(o[0]+=n,o[1]+=a):(i||r)&&t.winningSide&&(o[t.winningSide-1]+=1))}))})):Array.isArray(d)&&a.forEach((t=>{if(t.winningSide){let i=t.collectionPosition,r=function({collectionDefinition:e,collectionPosition:t}){return(e.collectionValueProfiles||[])?.find((e=>e.collectionPosition===t))?.matchUpValue}({collectionDefinition:e,collectionPosition:i});ir(r)&&(o[t.winningSide-1]+=r)}})),ir(l)){let t;if(m?.aggregateValue)c&&(ir(p||h||f)&&o[0]!==o[1]?t=o[0]>o[1]?1:2:I[0]!==I[1]&&(t=I[0]>I[1]?1:2));else if(m?.valueGoal)t=o.reduce(((e,t,i)=>t>=m.valueGoal?i+1:e),0);else{let i=Math.floor(e.matchUpCount/2)+1;t=I.reduce(((e,t,r)=>t>=i?r+1:e),0)}t&&(g?i[u].values[t-1]+=l:s[t-1]+=l)}else g?(i[u].values[0]+=o[0]||0,i[u].values[1]+=o[1]||0):s=o;g?(i[u].sideWins[0]+=I[0]||0,i[u].sideWins[1]+=I[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&c,i[u].matchUpsCount+=a.length):s.forEach(((e,t)=>r[t]+=e||0))}function gw(e){let{sideAdjustments:t=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:o,event:s}=e;if(!Array.isArray(t)||2!==t.length||Number.isNaN(t.reduce(((e,t)=>e+t))))return{error:Ho};if(!o)return{error:sa};let c=Ug({matchUp:o,drawDefinition:r,structure:a,event:s})?.tieFormat||e?.tieFormat;if(!c)return{error:ia};let d=md({tieFormat:c});if(d.error)return d;let u=c?.collectionDefinitions||[],l=o?.tieMatchUps??[],p=[0,0],{groupValueGroups:m,groupValueNumbers:f}=fw(c);for(let S of u)hw({collectionDefinition:S,groupValueNumbers:f,groupValueGroups:m,sideTieValues:p,tieMatchUps:l});for(let S of f){let e,t=m[S],{allGroupMatchUpsCompleted:i,matchUpCount:r,winCriteria:n,groupValue:a,sideWins:o,values:s}=t;if(n?.aggregateValue)i&&s[0]!==s[1]&&(e=s[0]>s[1]?1:2);else if(n?.valueGoal)e=s.reduce(((e,t,i)=>t>=n.valueGoal?i+1:e),void 0);else{let t=Math.floor(r/2)+1;e=o.reduce(((e,i,r)=>i>=t?r+1:e),void 0)}e&&(p[e-1]+=a||0)}let h,g=p.map(((e,i)=>(e||0)+t[i])),I={side1Score:g[0],side2Score:g[1],winningSide:void 0},y=g.join(i),v=g.slice().reverse().join(i);if(c?.winCriteria){let{valueGoal:e,aggregateValue:t,tallyDirectives:i}=c.winCriteria;if(e?h=g.map(((e,t)=>({sideNumber:t+1,points:e}))).find((({points:t})=>t>=e))?.sideNumber:t&&l.every((e=>e.matchUpStatus&&af.includes(e.matchUpStatus)||e.winningSide))&&g[0]!==g[1]&&(h=g[0]>g[1]?1:2),!h&&i){let e=o.matchUpId,t=o.hasContext?o:n?.drawMatchUps?.[e]||r&&cw({inContext:!0,drawDefinition:r,matchUpId:e})?.matchUp;if(t){let{completedTieMatchUps:e,order:i}=nw({matchUps:[t]});if(e&&i?.length){let e=i[0].participantId;h=t.sides.find((({participantId:t})=>t===e))?.sideNumber}}}}return h&&(I.winningSide=h),{scoreStringSide1:y,scoreStringSide2:v,winningSide:h,set:I}}function Iw({inContextDualMatchUp:e,drawDefinition:t,tournamentId:i,dualMatchUp:r,eventId:n}){if(r){e||(e=cw({matchUpId:r.matchUpId,inContext:!0,drawDefinition:t})?.matchUp);let{extension:a}=Jp({element:t,name:dm}),o=yd(a?.value||{},!1,!0),s=({displaySideNumber:e,drawPosition:t,sideNumber:i})=>({drawPosition:t,sideNumber:i,displaySideNumber:e});r.sides=e?.sides?.map((e=>{let t=e.participantId,i=t&&o[t]||void 0,{lineUp:n,...a}=r.sides?.find((({sideNumber:t})=>t===e.sideNumber))??{},c=n?.length?n:i;return{...s(e),...a,lineUp:c}})),Jf({context:"ensureSidLineUps",matchUp:r,drawDefinition:t,tournamentId:i,eventId:n})}}function yw(e){if(e)return yd(e,!1,!0)}function vw(e){let t=dp(e,[{[bl]:!0}]);return t.error?t:Object.keys(e.tournamentRecords).reduce(((t,i)=>{t.tournamentIdMap[i]=[];let r=e.tournamentRecords[i].events??[],n=r.map((({eventId:e})=>e)),a=r.map((e=>(e.drawDefinitions??[]).map((({drawId:e})=>e)))).flat();return t.tournamentIdMap[i].push(...n,...a),t.eventIds.push(...n),t.drawIds.push(...a),t}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Sw({tournamentRecords:e,eventId:t,drawId:i}){let{tournamentIdMap:r}=vw({tournamentRecords:e});return(r?Object.keys(r):[]).find((e=>t&&r?.[e].includes(t)||i&&r?.[e].includes(i)))}function Uw(e){let{exitWhenNoValues:t,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:o,event:s}=e,c=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord?.tournamentId]:e.tournamentRecord}||{},d=e.tournamentId||e.tournamentRecord?.tournamentId;c&&Sw({tournamentRecords:c,...e});let u=d&&c[d];if(!u)return{error:zr};let l=cw({drawDefinition:i,event:s,matchUpId:o});if(l.error)return l;if(!l.matchUp)return{error:aa};let{matchUp:p,structure:m}=l;if(!p.tieMatchUps)return{error:ca};Iw({tournamentId:u?.tournamentId,eventId:s?.eventId,dualMatchUp:p,drawDefinition:i});let{extension:f}=Jp({name:im,element:p});if(f?.value){if(!n)return{..._r,score:p.score};_p({element:p,name:im})}let h=Ug({drawDefinition:i,structure:m,matchUp:p,event:s})?.tieFormat;p.tieFormat=yw(h);let g=gw({drawDefinition:i,matchUpsMap:a,structure:m,matchUp:p,event:s}),{winningSide:I,set:y,scoreStringSide1:v,scoreStringSide2:S}=g,U=y?.side1Score||y?.side2Score;if(t&&!p.score&&!U)return{..._r};let b,w={scoreStringSide1:v,scoreStringSide2:S,sets:y?[y]:[]},T=I&&[1,2].includes(I),D=T&&jm||Ay({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&Hm||Jm,P=!(!p.winningSide||T),N=p.tieMatchUps.find((({score:e,winningSide:t,matchUpStatus:i})=>e?.sets?.length&&(e.sets[0].side1Score||e.sets[0].side2Score)||i&&af.includes(i)||t));if(p.tieFormat&&!T&&!N){let e=Ug({drawDefinition:i,structure:m,event:s})?.tieFormat;e&&JSON.stringify(h)===JSON.stringify(e)&&(p.tieFormatId=void 0,p.tieFormat=void 0,b=!0)}return pw({appliedPolicies:e.appliedPolicies,matchUpStatus:D,score:w,removeWinningSide:P,tournamentRecord:u,drawDefinition:i,removeScore:n,winningSide:I,matchUpId:o,matchUp:p,event:s}),{..._r,score:w,removeWinningSide:P,tieFormatRemoved:b,winningSide:I}}function bw(e){let t="directParticipants",i=mw(e);if(i.error)return Qs({result:i,stack:t});let r,n=Ry({matchUpStatus:e.matchUpStatus}),{dualWinningSideChange:a,inContextDrawMatchUps:o,projectedWinningSide:s,propagateExitStatus:c,matchUpStatusCodes:d,tournamentRecord:u,drawDefinition:l,matchUpStatus:p,dualMatchUp:m,matchUpsMap:f,winningSide:h,targetData:g,matchUpId:I,structure:y,matchUp:v,event:S}=e,U=!!v.collectionId,b=Cg({structure:y}),w=v.drawPositions;if(U){let{matchUpTieId:i,matchUpsMap:n}=e,s=Uw({appliedPolicies:e.appliedPolicies,matchUpId:i,tournamentRecord:u,drawDefinition:l,matchUpsMap:n,event:S});if(r=s&&{tieMatchUpResult:s},w=o.find((({matchUpId:e})=>e===i))?.drawPositions,!a)return Qs({result:{..._r,...r},stack:t})}if(b)return Qs({result:{..._r,...r},stack:t});if(w){let e=s?s-1:h-1,i=1-e,a=w[e],y=w[i],v={},{targetLinks:{loserTargetLink:U,winnerTargetLink:b,byeTargetLink:T},targetMatchUps:{winnerMatchUpDrawPositionIndex:D,loserMatchUpDrawPositionIndex:P,winnerMatchUp:N,loserMatchUp:E,byeMatchUp:M}}=g;if(N){let e=function({winnerMatchUpDrawPositionIndex:e,inContextDrawMatchUps:t,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:c,winnerMatchUp:d,dualMatchUp:u,matchUpsMap:l,event:p}){let m="directWinner";if(o){let i=d.drawPositions||[],u=i[e],f=o.source.structureId,h=lf({structureId:f,drawDefinition:c});if(h.error)return h;let{structure:g}=h,{positionAssignments:I}=hf({structureId:f,drawDefinition:c}),y=I?.find((e=>e.drawPosition===n))?.participantId,v=o.target.structureId,{positionAssignments:S}=hf({structureId:v,drawDefinition:c}),U=S?.find((e=>e.participantId===y))?.drawPosition,b=S?.filter((e=>{let t=i.includes(e.drawPosition),r=!e.participantId&&!e.bye&&!e.qualifier;return t&&r})).map((e=>e.drawPosition)),w=b?.includes(u);if(y&&1===o.target.roundNumber&&w)TS({drawPosition:u,participantId:y,structureId:v,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:c,matchUpsMap:l,event:p});else if(y&&b?.length){let e=b.pop();e&&TS({participantId:y,structureId:v,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:c,drawPosition:e,matchUpsMap:l,event:p})}else if(U){let e=IS({drawPosition:U,matchUpId:d.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:c,matchUpsMap:l});if(e.error)return Qs({result:e,stack:m})}else if(g?.stage!==Su){let e="winner target position unavaiallble";console.log(e),Qs({stack:m,result:{error:e}})}if(g?.seedAssignments&&g.structureId!==v){let e=g.seedAssignments.find((({participantId:e})=>e===y)),t=e?.participantId;e&&t&&lS({eventId:d?.eventId,structureId:v,...e,tournamentRecord:a,drawDefinition:c,participantId:t})}}else{let e=IS({matchUpId:d.matchUpId,drawPosition:n,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:c,matchUpsMap:l});if(e.error)return e}if(u&&i){let e=u.sides?.find((e=>e.sideNumber===i));if(e?.lineUp){let t=u.roundPosition,i=d.roundPosition,r=t===i&&1!==t||Math.floor(t/2)===i?2:1,n=l?.drawMatchUps?.find((({matchUpId:e})=>e===d.matchUpId)),o=[1,2].map((e=>({...n.sides?.find((t=>t.sideNumber===e))||{},sideNumber:e})));n.sides=o;let s=n.sides.find((e=>e.sideNumber===r));if(s){let t=e.lineUp?.filter((e=>e?.participantId));s.lineUp=vS({lineUp:t}),Jf({tournamentId:a?.tournamentId,eventId:d?.eventId,matchUp:n,context:m,drawDefinition:c})}}}return{..._r}}({sourceMatchUpStatus:n&&p||jm,winnerMatchUpDrawPositionIndex:D,sourceMatchUpId:I,inContextDrawMatchUps:o,projectedWinningSide:s,winningDrawPosition:a,tournamentRecord:u,winnerTargetLink:b,drawDefinition:l,winnerMatchUp:N,dualMatchUp:m,matchUpsMap:f,event:S});if(e.error)return Qs({result:e,stack:t})}if(E){let e=function(e){let{loserMatchUpDrawPositionIndex:t,inContextDrawMatchUps:i,projectedWinningSide:r,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:o,tournamentRecord:s,loserTargetLink:c,drawDefinition:d,loserMatchUp:u,dualMatchUp:l,matchUpsMap:p,event:m}=e,f="directLoser",h=c.linkCondition,g=u.drawPositions||[],I=h===Gu&&2===u.roundNumber&&Math.min(...g.filter(Boolean)),y=I||g[t],v=I||g[1-t],S=c.source.structureId,{structure:U}=lf({structureId:S,drawDefinition:d}),{matchUps:b}=oy({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:U,event:m}),w=b.filter((e=>e.drawPositions?.includes(o))).filter((e=>{let t=e.sides.find((e=>e.drawPosition===o)),i=e.matchUpStatus===Qm||e.matchUpStatus===Gm&&!My(e);return t?.sideNumber===e.winningSide&&!i})),T=h===Gu&&0===w.length,{positionAssignments:D}=hf({structureId:S,drawDefinition:d}),P=D?.find((e=>e.drawPosition===o))?.participantId,N={loserParticipantId:P},E=c.target.structureId,{positionAssignments:M}=hf({structureId:E,drawDefinition:d}),R=M?.filter((({drawPosition:e})=>g.includes(e))),C=R?.some((e=>e.participantId&&P&&e.participantId===P)),A=n&&[Km,Qm,Gm].includes(a||"");if(C)return{..._r,stack:f};let k=R?.filter((e=>{let t=g.includes(e.drawPosition),i=!e.participantId&&!e.bye&&!e.qualifier;return t&&i})).map((e=>e.drawPosition)),O=k?.includes(y),x=c.target.roundNumber>1&&k?.length,F=1===c.target.roundNumber&&O;if(I){let e=function(){let e="loserLinkFedFMLC";return Qs(T?{result:_(),stack:e}:{result:L(),stack:e})}();if(e.context&&Object.assign(N,e.context),e.error)return Qs({result:e,stack:f})}else if(F){let e=_();if(e.context&&Object.assign(N,e.context),e.error)return Qs({result:e,stack:f})}else{if(!P||!x)return Qs({context:{loserDrawPosition:o,loserTargetLink:c,targetDrawPositionIsUnfilled:O},result:{error:O?ln:un},stack:f});{k.sort(Hi);let e=k[0],t=TS({participantId:P,structureId:E,drawPosition:e,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:s,drawDefinition:d,matchUpsMap:p,event:m});if(t.error)return Qs({result:t,stack:f});if(!t.error&&A&&n)return{stack:f,context:{progressExitStatus:!0,loserParticipantId:P}}}}if(U?.seedAssignments&&U.structureId!==E){let e=U.seedAssignments.find((({participantId:e})=>e===P)),t=e?.participantId;e&&t&&lS({eventId:u?.eventId,structureId:E,...e,tournamentRecord:s,drawDefinition:d,participantId:t})}if(l&&r){let e=l.sides?.find((e=>e.sideNumber===3-r));if(e?.lineUp){let{roundNumber:t,eventId:i}=u,{roundPosition:r}=l,n=1===t?2-r%2:1,a=p?.drawMatchUps?.find((({matchUpId:e})=>e===u.matchUpId)),o=[1,2].map((e=>({...a.sides?.find((t=>t.sideNumber===e))||{},sideNumber:e})));a.sides=o;let c=a.sides.find((e=>e.sideNumber===n));c&&(c.lineUp=vS({lineUp:e.lineUp}),Jf({tournamentId:s?.tournamentId,matchUp:a,context:f,drawDefinition:d,eventId:i}))}}return Qs({result:{..._r},stack:f,context:N});function L(){return Qs({result:Vy({drawPosition:v,structureId:E,tournamentRecord:s,drawDefinition:d,event:m}),stack:"assignLoserPositionBye"})}function _(){let e=P?TS({drawPosition:y,participantId:P,structureId:E,inContextDrawMatchUps:i,sourceMatchUpStatus:a,tournamentRecord:s,drawDefinition:d,matchUpsMap:p,event:m}):{error:Ha};return!e.error&&A&&n?{stack:f,context:{progressExitStatus:!0}}:Qs({result:e,stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:n&&p||jm,loserMatchUpDrawPositionIndex:P,inContextDrawMatchUps:o,projectedWinningSide:s,propagateExitStatus:c,loserDrawPosition:y,tournamentRecord:u,loserTargetLink:U,drawDefinition:l,loserMatchUp:E,matchUpsMap:f,dualMatchUp:m,event:S});if(e.context?.progressExitStatus&&Object.assign(v,e.context,{sourceMatchUpStatus:n&&p||jm,sourceMatchUpStatusCodes:d||[],loserMatchUp:E,matchUpsMap:f}),e.error)return Qs({result:e,stack:t})}if(M){let e=M.drawPositions||[],i=Vy({drawPosition:Math.min(...e.filter(Boolean)),structureId:T.target.structureId,tournamentRecord:u,drawDefinition:l,event:S});if(i.error)return Qs({result:i,stack:t})}return Qs({result:{..._r,...r},stack:t,context:v})}return Qs({result:{error:cn},stack:t})}function ww(e){let t="genPlayoffStructure";if(!e.drawDefinition)return Qs({result:{error:Jr},stack:t});let i=bb(e);if(i.error)return Qs({result:i,stack:t});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:c,playoffPositions:d,roundOffsetLimit:u,tournamentRecord:l,exitProfileLimit:p,roundProfiles:m,roundNumbers:f,idPrefix:h,isMock:g,event:I,uuids:y}=e,v=yd(e.drawDefinition,!1,!0),{structure:S}=lf({structureId:r,drawDefinition:v});if(!S)return Qs({result:{error:Rn},stack:t});if(S.structureType===xu||S.structures)return function(e){let t="generateAndPopulateRRplayoffStructures";if(!e.playoffGroups)return Qs({result:{error:va},info:"playoffGroups required",stack:t});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:c,event:d}=e,u=Eb({requireSequential:r,sourceStructureId:i,playoffGroups:o,groupCount:s,...e});if(u.error)return Qs({result:u,stack:t});let{structures:l=[],links:p=[],finishingPositionTargets:m,positionRangeMap:f}=u,h=m?.map((({finishingPositions:e})=>e)).flat().map((e=>f[e].finishingPositions)).flat();a.structures.push(...l),a.links.push(...p);let{matchUps:g,matchUpsMap:I}=gy({inContext:!0,drawDefinition:a}),y=l.map((({structureId:e})=>e)),v=g?.filter((({structureId:e})=>y.includes(e))).map(xm),S=I?.drawMatchUps?.filter((({matchUpId:e})=>v?.includes(e)));if(S?.length){let t=Ug({drawDefinition:a,event:d})?.tieFormat;t&&S.forEach((i=>{let{tieMatchUps:r}=ab({isMock:e.isMock,tieFormat:t,matchUp:i});Object.assign(i,{tieMatchUps:r,matchUpType:$i})}))}let{positionAssignments:U}=ff({structureId:i,drawDefinition:a}),b={};U?.forEach((e=>{let t=Jp({element:e,name:Sm})?.extension?.value?.groupOrder;t&&(b[t]||(b[t]=[]),b[t].push(e.participantId))}));let w=cU({provisionalPositioning:e.provisionalPositioning,structureId:i,applyPositioning:!0,event:e.event,tournamentRecord:n,drawDefinition:a});return w.error&&w.error?.code!==tn.code?Qs({result:w,stack:t}):{structures:l,links:p,positionsPlayedOff:h,drawDefinition:a,..._r}}({sourceStructureId:S.structureId,...e,...i,drawDefinition:v});let{playoffRoundsRanges:U,playoffRounds:b}=i,{playoffPositionsReturned:w,error:T,playoffSourceRounds:D,playoffRoundsRanges:P}=Ub(e);if(T)return Qs({result:{error:T},stack:t});let N=m?.length&&Object.assign({},...m),E=f||"object"==typeof m&&m.map((e=>Object.keys(e))).flat(),M=Array.isArray(E)&&E.map((e=>!isNaN(e)&&zi(e))).filter(Boolean);if(M){if(!Array.isArray(M))return Qs({result:{error:Ho},context:{validRoundNumbers:M},stack:t});M.forEach((e=>{if(!b?.includes(e))return Qs({result:{error:Ho},context:{roundNumber:e},stack:t})}))}d&&d.forEach((e=>{if(!w?.includes(e))return Qs({result:{error:Ho},context:{playoffPosition:e},stack:t})}));let R=M||D,C=M?U:P,A=[],k=[];for(let G of R??[]){let e=C?.find((e=>e.roundNumber===G));if(!e)return Qs({result:{error:Ho},context:{roundNumber:G},stack:t});let i=e.finishingPositions.length,d=Math.min(...e.finishingPositions)-1,l=2,m=G&&N?.[G]&&l+N[G]-1,f=hb({exitProfile:`0-${G}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:d,playoffAttributes:c,exitProfileLimit:p,stage:wu,roundOffset:0,drawDefinition:v,sequenceLimit:m,stageSequence:l,drawSize:i,idPrefix:h,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:u});if(f.error)return Qs({result:f,stack:t});let{structures:I,links:S}=f;if(I?.length&&A.push(...I),S?.length&&k.push(...S),f.structureId&&G){let e={linkType:$u,source:{structureId:r,roundNumber:G},target:{structureId:f.structureId,feedProfile:_u,roundNumber:1}};k.push(e)}}if(!A.length)return Qs({result:{error:Ho},info:"No structures generated",stack:t});v.structures.push(...A),v.links.push(...k);let{matchUps:O,matchUpsMap:x}=gy({inContext:!0,drawDefinition:v}),F=A.map((({structureId:e})=>e)),L=O?.filter((({structureId:e})=>F.includes(e))).map(xm),_=x?.drawMatchUps?.filter((({matchUpId:e})=>L?.includes(e)));if(_?.length){let e=Ug({drawDefinition:v,event:I})?.tieFormat;e&&_.forEach((t=>{let{tieMatchUps:i}=ab({matchUp:t,tieFormat:e,isMock:g});Object.assign(t,{tieMatchUps:i,matchUpType:Gi})}))}O?.filter((e=>sy({matchUp:e})&&e.structureId===r))?.forEach((e=>{let{matchUpId:t,score:i,winningSide:r}=e,n=py({inContextDrawMatchUps:O,drawDefinition:v,matchUpId:t}),a=bw({inContextDrawMatchUps:O,tournamentRecord:l,drawDefinition:v,matchUpsMap:x,winningSide:r,targetData:n,matchUpId:t,structure:S,matchUp:e,score:i,event:I});a.error&&console.log(a.error)})),O?.filter((e=>"BYE"===e.matchUpStatus&&e.structureId===r))?.forEach((e=>{let{matchUpId:t}=e,i=py({inContextDrawMatchUps:O,drawDefinition:v,matchUpId:t}),{targetLinks:{loserTargetLink:r},targetMatchUps:{loserMatchUpDrawPositionIndex:n,loserMatchUp:a}}=i;if(r&&a){let e=r.target.structureId,t=Vy({drawPosition:a.drawPositions[n],structureId:e,tournamentRecord:l,drawDefinition:v,event:I});t.error&&console.log(t.error)}}));let B=[],V=Ny({inContextDrawMatchUps:O,drawDefinition:v,matchUpsMap:x}).goesToMap,{structure:j}=lf({drawDefinition:e.drawDefinition,structureId:r}),{matchUps:$}=oy({structure:j});return $.forEach((i=>{let r=V?.loserMatchUpIds[i.matchUpId];if(r&&i.loserMatchUpId!==r){i.loserMatchUpId=r;let n={tournamentId:l?.tournamentId,eventId:e.event?.eventId,context:t,matchUp:i};B.push(n)}let n=V?.winnerMatchUpIds[i.matchUpId];if(n&&i.winnerMatchUpId!==n){i.winnerMatchUpId=n;let r={tournamentId:l?.tournamentId,eventId:e.event?.eventId,context:t,matchUp:i};B.push(r)}})),{structures:A,matchUpModifications:B,links:k,drawDefinition:v,..._r}}function Tw({element:e}){if(!e)return{error:Ho};if(!e.timeItems)return{};if(!Array.isArray(e.timeItems))return{error:Ho};return e.timeItems.reduce((t="itemType",i="itemValue",(e,r)=>(r[t]&&(e[r[t]]=r[i]),e)),{});var t,i}function Dw(e){let{duplicateValues:t=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=e;if(!n)return{error:Ao};let a=wh(e);if(a.error)return a;if(!(Rr(n)&&Mr(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:Ro};if(a.timeItems){if(function({element:e,duplicateValues:t,timeItem:i}){let{itemType:r,itemSubTypes:n,itemValue:a}=i,o=r&&Th({itemSubTypes:n,itemType:r,element:e})?.timeItem;return o&&JSON.stringify(o?.itemValue)===JSON.stringify(a)&&!t}({element:a,duplicateValues:t,timeItem:n}))return{..._r}}else a.timeItems=[];if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let e=(new Date).toISOString();Object.assign(n,{createdAt:e})}return r&&(a.timeItems=a.timeItems.filter((({itemType:e})=>n.itemType!==e))),r&&!n.itemValue||a.timeItems.push(n),{..._r}}function Pw({creationTime:e=!0,removePriorValues:t,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:zr};if(!n)return{error:Ha};let o=bh({tournamentRecord:i,participantId:n});return o.error?o:Dw({element:o.participant,removePriorValues:t,duplicateValues:r,creationTime:e,timeItem:a})}function Nw(e){let{removePriorValues:t,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=e;if(!i)return{error:zr};let o=Dw({element:i,removePriorValues:t,duplicateValues:r,creationTime:n,timeItem:a});if(o.error)return o;let s=Tw({element:i});return As({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:xf}),o}function Ew(e){let{removePriorValues:t,duplicateValues:i,creationTime:r,timeItem:n,event:a}=e;return a?Dw({removePriorValues:t,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:Ln}}function Mw(e){return Cw({...e,itemType:"attachConsolationStructures"})}function Rw(e){return Cw({...e,itemType:"attachPlayoffStructures"})}function Cw({itemType:e="attachStructures",matchUpModifications:t,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){let s="attachStructures";if(!r)return{error:Jr};if(!Array.isArray(n)||!Array.isArray(a))return Qs({result:{error:Ho},stack:s});let c=e=>[e.source.structureId,e.source.roundNumber||e.source.finishingPositions?.join("|"),e.target.roundNumber].join("|"),d=r.links?.map(c);if(a.some((e=>{let t=c(e);return d?.includes(t)})))return Qs({result:{error:as},info:"playoff structure exists",stack:s});a.length&&r.links?.push(...a);let u=n.map((({structureId:e})=>e)),l=r.structures?.map((({structureId:e})=>e));r.structures=(r.structures??[]).map((e=>u.includes(e.structureId)?n.find((({structureId:t})=>t===e.structureId)):e));let p=n?.filter((({structureId:e})=>!l?.includes(e)));p.length&&r.structures.push(...p),Ny({drawDefinition:r});let m=n.map((e=>oy({structure:e})?.matchUps||[])).flat();Kf({tournamentId:i?.tournamentId,eventId:o?.eventId,drawDefinition:r,matchUps:m});let f=n.map((({structureId:e})=>e));if(Zf({drawDefinition:r,structureIds:f}),t?.length){let e={};t.forEach((t=>{let i=t.matchUp?.matchUpId;i&&(e[i]=t)}));let i=t=>{t.matchUps.forEach((t=>{if(e[t.matchUpId]){let{tieMatchUps:i,...r}=e[t.matchUpId].matchUp;if(Object.assign(t,r),i?.length){let r={};i.forEach((t=>e[t.matchUpId]=t)),t.tieMatchUps.forEach((e=>Object.assign(e,r[e.matchUpId])))}e[t.matchUpId].matchUp=t,Jf(e[t.matchUpId])}}))};r.structures.forEach((e=>{if(l?.includes(e.structureId))if(e.structures)for(let t of e.structures)i(t);else i(e)}))}let h=p.map(Dy("structureId"));if(i){Dw({element:i,timeItem:{itemValue:{structureIds:f,drawId:r.drawId},itemType:e}})}return{..._r,addedStructureIds:h}}function Aw(e){let{structures:t,links:i,matchUpModifications:r,error:n}=ww(e);if(n)return{error:n};let a=e.drawDefinition;return Rw({tournamentId:e.tournamentRecord?.tournamentId,eventId:e.event?.eventId||e.eventId,matchUpModifications:r,drawDefinition:a,structures:t,links:i})}function kw(e){let t=dp(e,[{_anyOf:{[bl]:!1,[Tl]:!1,[Pl]:!1,[Kl]:!1},[wl]:!0}]);if(t.error)return t;let i=[],r=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(r){let t=Ow(e,r);if(t.error)return t;i.push(...t?.applied??[]),e.drawDefinition&&Zf({drawDefinition:e.drawDefinition,tournamentId:e.tournamentId})}else{if(!e.tournamentRecords)return{error:zr};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:zr};for(let r of t){let t=Ow(e,e.tournamentRecords[r]);if(t.error)return t;i.push(...t?.applied??[])}}}return i.length?{..._r,applied:i}:{error:fa}}function Ow(e,t){let i=Fh(e).appliedPolicies??{};t.extensions||(t.extensions=[]);let r=[],n=Object.keys(e.policyDefinitions);if(!n.length)return{error:ua};for(let a of n)if(!i[a]||e.allowReplacement){let t=e.policyDefinitions[a];if(!t)continue;if(!Rr(t))return{error:Ho};let{policyName:n,...o}=t;if(!o||!Object.keys(o).length||n&&!Mr(n))return{error:Ho};i[a]=e.policyDefinitions[a],r.push(a)}return r?.length?{...Vp({element:t,extension:{name:Qp,value:i}}),applied:r}:{applied:r,error:fa}}function xw({tournamentRecord:e,drawDefinition:t,flightProfile:i,drawName:r,drawId:n,event:a}){if(!r||"string"!=typeof r)return Qs({result:{error:Ho},context:{drawName:r}});i||(i=XI({event:a}).flightProfile);let o=i?.flights?.find((e=>e.drawId===n));if(o){o.drawName=r,Gp({event:a,extension:{name:sm,value:{...i,flights:i.flights}}})}return t&&(t.drawName=r,Zf({tournamentId:e?.tournamentId,drawDefinition:t})),o||t?{..._r,flight:o}:{error:Jr}}function Fw({tournamentRecord:e,drawDefinition:t,drawUpdates:i,drawId:r,event:n}){if(!Rr(i))return{error:Ho};let a=XI({event:n}).flightProfile,o=i.drawName&&xw({drawName:i.drawName,tournamentRecord:e,drawDefinition:t,flightProfile:a,drawId:r,event:n});if(o?.error)return o?.error;let s=o?.flight||a?.flights?.find((e=>e.drawId===r));if(!s&&!t)return{error:Jr};if(s){Gp({event:n,extension:{name:sm,value:{...a,flights:a.flights}}})}return t&&(i.policyDefinitions&&kw({policyDefinitions:i.policyDefinitions,drawDefinition:t}),Zf({tournamentId:e?.tournamentId,drawDefinition:t})),{..._r}}function Lw({tournamentRecord:e,removeScheduling:t,drawDefinition:i}){if(!i)return{error:Jr};let r=bg({drawDefinition:i}),n=e=>r?.drawMatchUps?.find((t=>t.matchUpId===e));for(let a of i.structures||[]){let{positionAssignments:o,stage:s,stageSequence:c}=a;o&&(1!==c||![Su,vu].includes(s))&&(a.positionAssignments=o.map((e=>(delete e.participantId,e))),a.seedAssignments=[]);let{matchUps:d,isRoundRobin:u}=oy({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:a});for(let r of d){let{matchUpId:a,roundNumber:o}=r,s=r.sides||[],c=n(a);if(c){if(delete c.extensions,delete c.notes,"BYE"!==c.matchUpStatus&&Object.assign(c,lw),o&&o>1&&c.drawPositions?.length&&!u){let e=s?.map((({drawPosition:e,participantFed:t})=>!t&&e)).filter(Boolean),t=c.drawPositions.map((t=>e.includes(t)?void 0:t));c.drawPositions=t}t?delete c.timeItems:c.timeItems?.length&&(c.timeItems=c.timeItems.filter((e=>e.itemType&&![qg,Hg,Wg,Xg,Yg,Jg].includes(e.itemType)))),Jf({tournamentId:e?.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:c})}}}return i.extensions=i.extensions.filter((e=>e.name!==fm)),Zf({drawDefinition:i,structureIds:(i.structures||[]).map((({structureId:e})=>e))}),{..._r}}function _w({tournamentRecord:e}){if(!e)return{error:zr};let t={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return(e.events?.flatMap((e=>{let t=e.eventId;return i[t]=e,(e?.drawDefinitions||[]).map((e=>({drawDefinition:e,eventId:t})))})).filter(Boolean)).forEach((({drawDefinition:e,eventId:r})=>{let n=0,a=0,o=0,{allStructuresLinked:s}=hU({drawDefinition:e}),c=i[r],d=(e?.structures||[]).map((t=>{let{stage:i,stageSequence:r,structureId:s}=t,d=Du[i],{inContextStructureMatchUps:u}=ky({drawDefinition:e,structure:t,event:c}),l=u?.filter((({winningSide:e})=>e)),p=l.filter(Boolean).length||0;a+=p,o+=u.length-a;let m=Math.max(l.filter((({roundNumber:e})=>1===e)).map((({roundPosition:e})=>e))),{positionAssignments:f}=ff({structure:t}),h=f?.filter((({participantId:e})=>e));n+=h?.length??0;let g=(f?.length??0)-(h?.length??0),{roundMatchUps:I,roundProfile:y,roundNumbers:v,maxMatchUpsCount:S}=Ng({matchUps:u}),U=y&&Object.keys(y).filter((e=>!y[e].inactiveRound)).map((e=>Number.parseInt(e))),b=y&&Object.keys(y).filter((e=>y[e].inactiveRound)).map((e=>Number.parseInt(e))),w=y&&Object.values(y).every((e=>e.inactiveRound));return{positionsAssignedCount:h?.length??0,maxWinningSideFirstRoundPosition:m,unassignedPositionsCount:g,inactiveStructure:w,maxMatchUpsCount:S,inactiveRounds:b,roundMatchUps:I,activeRounds:U,roundNumbers:v,roundProfile:y,structureId:s,stageSequence:r,orderNumber:d,stage:i}})),u=d.find((e=>2===e.orderNumber&&1===e.stageSequence)),l=d.filter((({inactiveStructure:e})=>!e)).length,{links:p}=uy({structureId:u.structureId,drawDefinition:e}),m=1===zi(u.activeRounds[0])&&1===u.activeRounds.length&&1===l,f=d?.every((({inactiveStructure:e})=>e)),h=!p.length&&u.activeRounds.length&&(u.roundProfile[1].inactiveCount||u.inactiveRounds.length),g=e.drawId;n&&!a&&t.positionsNoOutcomes.push(g),f&&t.inactive.push(g),m&&t.matchPlay.push(g),h&&t.canBePruned.push(g);let I={matchUpsWithWinningSideCount:a,matchUpsNoOutcomeCount:o,positionsAssignedCount:n,allStructuresLinked:s,structuresData:d,inactiveDraw:f,isMatchPlay:m,drawId:g};t.drawAnalysis[g]=I})),{..._r,drawsAnalysis:t}}function Bw({matchPlayDrawPositions:e=!0,tournamentRecord:t,drawDefinition:i,drawId:r}){if(!t)return{error:zr};if(!i)return{error:Jr};let n=[],{drawsAnalysis:a}=_w({tournamentRecord:t});if(a.canBePruned.includes(r)){let o=a.matchPlay.includes(r),s=a.drawAnalysis[r],{structures:[c]}=pf({stageSequence:1,drawDefinition:i,stage:vu}),d=s.structuresData.find((({structureId:e})=>c.structureId===e)),u=(c.matchUps??[]).sort(((e,t)=>e.roundPosition-t.roundPosition));n=u.filter((({roundNumber:e})=>!d.inactiveRounds.includes(e)));let l=n.map(xm),p=u.map(xm).filter((e=>!l.includes(e)));if(o){let t=n.filter((({roundNumber:e})=>!d.inactiveRounds.includes(e))).filter((({winningSide:e})=>e)),i=t.map(xm),r=l.filter((e=>!i.includes(e)));p.push(...r);let a=t.flatMap((e=>e.drawPositions??[])).filter(Boolean).flat(),o=Object.assign({},...a.map(((e,t)=>({[e]:t+1}))));if(t.forEach((t=>{e?t.drawPositions=t.drawPositions.map((e=>o[e])):delete t.drawPositions})),e){let e=c?.positionAssignments?.filter((e=>a.includes(e.drawPosition))).map((e=>(e.drawPosition=o[e.drawPosition],e)));c.positionAssignments=e}else c.positionAssignments=[];c.matchUps=t,n=t}Xf({tournamentId:t?.tournamentId,matchUpIds:p,drawDefinition:i}),Zf({drawDefinition:i})}return{..._r,matchUps:n}}function Vw({tournamentRecord:e,drawDefinition:t,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!t)return{error:Jr};if(!r)return{error:pn};if(!n)return{error:Mn};if(s){let i=Vy({tournamentRecord:e,drawDefinition:t,drawPosition:r,structureId:n,event:o});if(i.error)return i}else{if(a)return{error:Zo};{let a=TS({tournamentRecord:e,drawDefinition:t,participantId:i,drawPosition:r,structureId:n,event:o});if(a.error)return a}}return{..._r}}function jw(e){let t=e.matchUpIds??[],{drawDefinition:i}=e,r=e.structureId??i?.structures?.find((e=>e.matchUps?.some((({matchUpId:e})=>t.includes(e)))))?.structureId??i?.structures?.[0]?.structureId;if(!r)return{error:Rn};let n=i.structures?.find((e=>e.structureId===r));if(!n)return{error:Rn};let a=n?.matchUps,o=a?.find((e=>!!e.roundPosition));if(n.structures||o||n.finishingPosition===yl)return{error:en};let s=a.filter((({roundNumber:t})=>e.roundNumbers?.includes(t))).map(xm);return t=t.filter((e=>!s.includes(e))),e.roundNumbers&&!t.length&&(t=s),{existingMatchUps:a,matchUpIds:t,structureId:r,structure:n}}function $w(e){let t=dp(e,[{[Pl]:!0},{[ap]:{[kl]:!1,roundNumbers:!1},[ip]:Ho,[rp]:Zl}]);if(t.error)return t;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=e,c=jw(e);if(c.error)return c;let{structure:d,structureId:u,existingMatchUps:l,matchUpIds:p}=c,m=[],f=l?.filter((({matchUpId:e,score:t,winningSide:a})=>{if(a&&!n)return!1;if(a||My({score:t})){if(!a&&!i)return!1;m.push(e)}else if(!r)return!1;return p?.includes(e)}))??[],h=f.map(xm),g=f.map((({tieMatchUps:e})=>e?.map(xm))).filter(Boolean).flat();if(h.length){d.matchUps=(d.matchUps??[]).filter((({matchUpId:e})=>!h.includes(e))),Xf({tournamentId:a?.tournamentId,matchUpIds:[...g,...h],action:"deleteAdHocMatchUps",eventId:s?.eventId,drawDefinition:o});let e=function(e,t=1){return Array.isArray(e)&&e.every(ir)?gr(Math.min(...e,t),Math.max(...e)+1).filter((t=>!e.includes(t))):[]}(ar(d.matchUps.map(Dy("roundNumber"))));if(e.length){e.reverse();for(let t of e)d.matchUps.forEach((e=>{e.roundNumber&&e.roundNumber>t&&(e.roundNumber-=1,Jf({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:s?.eventId,drawDefinition:o,matchUp:e}))}))}if(m.length){d.positionAssignments=ar(d.matchUps.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})));let e=d?.matchUpFormat??o?.matchUpFormat??s?.matchUpFormat,t=c.existingMatchUps.some((e=>e.matchUpType===$i))?{matchUpTypes:[$i]}:void 0,{matchUps:i}=oy({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:t,structure:d,event:s});Cg({structure:d})&&(d.positionAssignments=ar(i.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e}))));let r=ow({positionAssignments:d.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:e,matchUps:i,event:s});r.error&&console.log(r)}Zf({structureIds:[u],eventId:s?.eventId,drawDefinition:o})}return!h.length&&p.length?{error:cs}:{..._r,deletedMatchUpsCount:[...h,...g].length}}function Gw({removeCompletedMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!t)return{error:zr};if(!i)return{error:Jr};if(!n)return Qs({result:{error:va},info:"roundNumber required"});let o=lf({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s?.structures?{error:en}:Cg({structure:s})?function({removeCompletedMatchUps:e,drawDefinition:t,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=n?.matchUps??[],s=[],c=[],d=!1;if(o.reduce(((e,t)=>{let i=t?.roundNumber;return i?e.includes(i)?e:e.concat(i):e}),[]).sort(Hi).includes(r)){let u=o.filter((t=>{let i=t.roundNumber===r&&(!af.includes(t.matchUpStatus)||e);return i&&(c.push(t.matchUpId),t.tieMatchUps&&s.push(...t.tieMatchUps.map(xm))),!i}));c.length&&(Xf({matchUpIds:[...s,...c],drawDefinition:t,tournamentId:i,eventId:a}),u.some((e=>e.roundNumber===r))||(u.forEach((e=>{e.roundNumber>r&&(e.roundNumber-=1,Jf({drawDefinition:t,tournamentId:i,eventId:a,matchUp:e}))})),d=!0),n.matchUps=u)}return{deletedMatchUpsCount:c.length,roundRemoved:d,..._r}}({tournamentId:t.tournamentId,removeCompletedMatchUps:e,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{..._r})}function Ww(e){let{suppressNotifications:t,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=e;if("object"!=typeof r)return{error:Jr};let o=e?.structureId;if(!o&&1===r.structures?.length&&(o=r.structures?.[0]?.structureId),"string"!=typeof o)return{error:Mn};if(!Pg(n))return{error:Ho,info:SS("matchUps")};let s=r.structures?.find((e=>e.structureId===o));if(!s)return{error:Rn};let c=(s?.matchUps).find((e=>!!e.roundPosition));if(s.structures||c||s.finishingPosition===yl)return{error:en};if(Sr(vy({tournamentRecord:i,inContext:!1})?.matchUps?.map(xm)??[],n.map(xm)))return{error:rs,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...n);let d=n.map((({tieMatchUps:e})=>e)).filter(Boolean).flat();return t||(Kf({tournamentId:i?.tournamentId,matchUps:[...d,...n],eventId:a?.eventId,drawDefinition:r}),Zf({drawDefinition:r,structureIds:[o]})),{..._r}}function qw({tournamentRecord:e,drawDefinition:t,drawPosition:i,structureId:r,subOrder:n,event:a}){if(!t)return{error:Jr};if(!r)return{error:Mn};if(!i)return{error:pn};let{structure:o}=lf({drawDefinition:t,structureId:r});if(!o)return{error:Rn};let s=o;o.structures&&o.structureType===xu&&(s=o.structures?.find((e=>e.positionAssignments?.find((e=>e.drawPosition===i)))));let c=s?.positionAssignments,d=c?.find((e=>e.drawPosition===i));d&&Vp({element:d,extension:{name:vm,value:n}});let u=(a?.eventType===Gi||t.matchUpType===Gi||(a?.tieFormat??t?.tieFormat??o?.tieFormat))&&{matchUpTypes:[Gi]},{matchUps:l}=oy({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a});return ow({positionAssignments:c,tournamentRecord:e,drawDefinition:t,matchUpFormat:o?.matchUpFormat??t.matchUpFormat,matchUps:l,event:a}),Zf({drawDefinition:t,structureIds:[r]}),{..._r}}var Hw={};function zw({excludedMatchUpStatuses:e=[],includeEventParticipants:t,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:c,requirePlay:d,requireLoss:u,allEntries:l,winsLimit:p,event:m}){if(!s)return{error:Jr};let f=[vu,wu];i&&f.push(Su);let h=m?.eventType?{matchUpTypes:[m.eventType]}:void 0,g=s?.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,I=t&&m?yy({contextFilters:{stages:f},matchUpFilters:h,tournamentRecord:o,inContext:!0,event:m})?.matchUps??[]:by({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s})?.matchUps??[],y=Ig({stage:bu,drawDefinition:s}).map((({participantId:e})=>e)),v={},S={},U={},b={};n||(n=Lh({policyTypes:[vp],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let w=n?.[vp];e=e.length&&e||w?.excludedMatchUpStatuses||[],t=t??w?.includeEventParticipants,l=l??w?.allEntries,r=r??w?.finishingRoundLimit,a=a??w?.roundNumberLimit,c=c??w?.matchUpsLimit,void 0===d&&(d=void 0===w?.requirePlay||w.requirePlay),void 0===u&&(u=void 0===w?.requireLoss||w.requireLoss),p=p??w?.winsLimit;for(let E of I){if(d&&E.winningSide&&![1,2].includes(E.winningSide)&&E.matchUpStatus!==qm||E.finishingRound&&r&&E.finishingRound>=r||E.finishingRound&&a&&E.finishingRound<=a)continue;let t=E.sides?.find((({sideNumber:e})=>E.winningSide&&e===3-E.winningSide)),i=E.sides?.find((({sideNumber:e})=>E.winningSide&&e===E.winningSide));if(E.sides?.forEach((t=>{let i=t?.participant?.participantId;i&&(U[i]=t.participant,E.matchUpStatus===qm&&!d&&(S[i]=t.participant,v[i]||(v[i]=0),(!E.matchUpStatus||!e.includes(E.matchUpStatus))&&(v[i]+=1)))})),t?.participant){let i=t.participant.participantId;S[i]=t.participant,v[i]||(v[i]=0),E.matchUpStatus&&!e.includes(E.matchUpStatus)&&(v[i]+=1)}if(i?.participant){let t=i.participant.participantId;b[t]||(b[t]=0),b[t]+=1,v[t]||(v[t]=0),E.matchUpStatus&&!e.includes(E.matchUpStatus)&&(v[t]+=1)}}let T=o?.participants&&!d&&!u&&l,D=T?((t&&m?m.entries:s.entries)??[]).filter((e=>![cg,ag].includes(e.entryStatus))).map((({participantId:e})=>e)):[],P=Object.keys(S),N=T?(o?.participants??[]).filter((({participantId:e})=>D.includes(e))):u&&Object.values(S)||Object.values(U);return{eligibleParticipants:N.filter((e=>(e=>!u||P.includes(e))(e.participantId)&&(e=>!d||(v[e]||0)>=0)(e.participantId)&&(e=>!p||(b[e]||0)<=p)(e.participantId)&&(e=>!c||v[e]<=c)(e.participantId)&&(e=>!y.includes(e))(e.participantId))).map((e=>({...e,individualParticipants:e.individualParticipantIds?.map((e=>o?.participants?.find((t=>t.participantId===e))))}))),losingParticipantIds:P,..._r}}function Yw(e){let t=dp(e,[{drawDefinition:!0}]);if(t.error)return t;let{drawDefinition:i,roundNumber:r}=e,n=e.structureId??(1===i.structures?.length&&i.structures?.[0]?.structureId);if("string"!=typeof n)return{error:Mn};let a=i.structures?.find((e=>e.structureId===n));if(!a)return{error:Rn};let o,s=(a.matchUps??[])?.reduce(((e,t)=>(t.roundPosition&&(o=!0),(t?.roundNumber||0)>e?t.roundNumber:e)),0);if(a.structures||o||a.finishingPosition===yl)return{error:en};let c=i?.entries?.filter((e=>{let t=e.entryStatus;return pg.includes(t)}))??[],d=Math.floor(c?.length/2)||1,u=r??s??1,l=d-(a.matchUps?.filter((e=>e.roundNumber===u))?.length??0),p=l>0?l:0;return{..._r,availableMatchUpsCount:p,lastRoundNumber:s,roundMatchUpsCount:d}}function Kw({drawDefinition:e}){let t=Jp({name:"participantRepresentatives",element:e});return t.error?t:{representativeParticipantIds:t.extension?.value||[]}}function Xw({byeAdvancements:e=!1,tournamentRecord:t,drawDefinition:i}){if(!i)return{error:Jr};let{participantIds:r,participantIdMatchUps:n}=function({tournamentParticipants:e,drawDefinition:t,event:i}){if(!t)return{error:Jr};let r=yd(gy({tournamentParticipants:e,inContext:!0,drawDefinition:t,event:i}).matchUps,!1,!0),n=ar(r.reduce(((e,t)=>e.concat(...t.sides.map((e=>e.participantId)).filter(Boolean))),[])),a=Object.assign({},...n.map((e=>{let t=r.filter((t=>t.sides.map((e=>e.participantId)).filter(Boolean).includes(e)));return{[e]:t}})));return{participantIds:n,participantIdMatchUps:a}}({tournamentParticipants:t?.participants,drawDefinition:i}),a=r?.map((t=>{let i=n[t].filter((e=>[jm,"BYE"].includes(e.matchUpStatus)||e.winningSide)),r=i.map((i=>{let r=i.sides.find((e=>e.bye)),n=i.sides.find((e=>e.participantId===t)).sideNumber;return(i.winningSide||e&&r&&n)===n?i.finishingPositionRange.winner:i.finishingPositionRange.loser})),a=e=>Math.abs(e[0]-e[1]),o=r.reduce(((e,t)=>e&&a(e)<a(t)?e:t),void 0);return{[t]:{relevantMatchUps:i,finishingPositionRanges:r,finishingPositionRange:o}}}))||[];return Object.assign({},...a)}function Jw({tournamentRecords:e,tournamentRecord:t,tournamentId:i,drawId:r}){if(!t&&!e)return{error:zr};if(!r)return{error:In};if(!t&&e){if("string"!=typeof i&&!(i=Sw({tournamentRecords:e,drawId:r})))return{error:Kr};if(!(t=e[i]))return{error:zr}}let n=t&&JI({tournamentRecord:t,drawId:r});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:t,..._r}:Qs({result:{error:Zr},stack:"findDrawDefinition"})}function Qw(e){let{drawDefinition:t,error:i}=Jw(e);return i?{error:i}:{drawDefinition:yd(t)}}function Zw(e){let{inContextDrawMatchUps:t,targetData:i,drawDefinition:r,relevantLink:n}=e;if(n?.linkCondition===Gu&&"BYE"===i?.matchUp?.matchUpStatus)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=i,c=a&&py({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),d=c?.targetMatchUps?.loserMatchUp,u=c?.targetMatchUps?.loserMatchUpDrawPositionIndex,l=d?.sides[u]?.participant,p=By(a?.matchUpStatus),m=p&&!l,f=a?.sides?.reduce(((e,t)=>t?.participant?++e:e),0)??0,h=a?.winningSide&&p&&1===f,g=o?.drawPositions?.filter(Boolean).length||0;if(!h&&(a?.winningSide&&!m||o?.winningSide&&2===g&&(!o.feedRound||!By(o?.matchUpStatus))))return!0;let I=o&&py({matchUpId:o.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),y=c&&Zw({relevantLink:s?.loserTargetLink,targetData:c,inContextDrawMatchUps:t,drawDefinition:r});return!!(I&&Zw({targetData:I,inContextDrawMatchUps:t,drawDefinition:r})||y)}Oi(Hw,{addGoesTo:()=>Ny,allPlayoffPositionsFilled:()=>LS,checkValidEntries:()=>FT,findDrawDefinition:()=>Qw,getAssignedParticipantIds:()=>Ky,getAvailableMatchUpsCount:()=>Yw,getAvailablePlayoffProfiles:()=>bb,getDrawDefinitionTimeItem:()=>Dh,getDrawParticipantRepresentativeIds:()=>Kw,getDrawStructures:()=>pf,getDrawTypeCoercion:()=>RT,getEligibleVoluntaryConsolationParticipants:()=>zw,getMatchUpsMap:()=>bg,getParticipantIdFinishingPositions:()=>Xw,getPositionAssignments:()=>kT,getPositionsPlayedOff:()=>Sb,getRandomQualifierList:()=>CT,getSeedingThresholds:()=>nS,getSeedsCount:()=>xT,getStructureSeedAssignments:()=>yg,getTeamLineUp:()=>ty,getValidGroupSizes:()=>tS,isAdHoc:()=>Cg,isCompletedStructure:()=>FS,isValidForQualifying:()=>AT,positionActions:()=>MT});var eT={[bp]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Su,vu],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[JU,ZU,GU,QU],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},tT="positionAction",iT="matchUpAction";function rT({actionType:e=tT,appliedPolicies:t,drawDefinition:i,structure:r}){let n=e===tT&&bp||e===iT&&wp,a=e===tT&&eT||e===iT&&wv,o=n&&(t?.[n]||a?.[n]),s=i.links?.filter((e=>e?.target?.structureId===r?.structureId))?.map((({target:e})=>e.feedProfile))??[],{enabledStructures:c,disabledStructures:d}=o||{},u=d?.find((e=>{let{stages:t,stageSequences:i,structureTypes:n,feedProfiles:a}=e;return(!a?.length||Array.isArray(a)&&a.some((e=>s.includes(e))))&&(!t?.length||Array.isArray(t)&&t?.includes(r?.stage))&&(!n?.length||Array.isArray(n)&&n?.includes(r?.structureType))&&(!i?.length||Array.isArray(i)&&i.includes(r?.stageSequence))}));return{enabledStructures:c,actionsDisabled:u,actionsPolicy:o}}function nT({activePositionOverrides:e,activeDrawPositions:t,action:i}){return!(!i||!e.includes(i))||!t.length}function aT({enabledStructures:e,drawDefinition:t,structure:i}){if(!1===e)return{};if(!e?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},o=t.links?.filter((e=>e?.target?.structureId===i?.structureId))?.map((({target:e})=>e.feedProfile))||[];return{policyActions:e.find((e=>{let{stages:t,stageSequences:i,structureTypes:s,feedProfiles:c}=e||{},d=!t?.length||Array.isArray(t)&&t.includes(r),u=!i?.length||Array.isArray(i)&&i.includes(n),l=!s?.length||Array.isArray(s)&&s.includes(a),p=!c?.length||Array.isArray(c)&&c.some((e=>o.includes(e)));return u&&l&&p&&e&&d}))}}function oT({action:e,policyActions:t}){let i=!t?.enabledActions||t?.disabledActions?.length&&t.disabledActions.includes(e);return!i&&((0===t?.enabledActions.length||t?.enabledActions.includes(e))&&!i)}var sT="replaceTieMatchUpParticipantId",cT="assignTieMatchUpParticipantId",dT="removeTieMatchUpParticipantId",uT="assignMatchUpSideParticipant",lT="removeMatchUpSideParticipant",pT="substituteParticipant",mT="REMOVE_SUBSTITUTION",fT="REPLACE_PARTICIPANT",hT="REMOVE_PARTICIPANT",gT="setMatchUpStatus",IT="SUBSTITUTION",yT="SCHEDULE",vT="REFEREE",ST="STATUS",UT="START",bT="SCORE",wT={REPLACE_TEAM_POSITION_METHOD:sT,ASSIGN_TEAM_POSITION_METHOD:cT,REMOVE_TEAM_POSITION_METHOD:dT,REPLACE_PARTICIPANT:fT,SUBSTITUTION_METHOD:pT,REMOVE_SUBSTITUTION:mT,REMOVE_PARTICIPANT:hT,SCHEDULE_METHOD:gT,SUBSTITUTION:IT,SCHEDULE:yT,PENALTY:"PENALTY",REFEREE:vT,STATUS:ST,SCORE:bT,START:UT,END:"END"};function TT({restrictQualifyingAlternates:e,structure:t,entry:i}){let{stage:r}=t;if(!i.entryStage||i.entryStage===r||r===Su&&!e||i.entryStage===vu&&r===Uu)return!0}function DT({restrictAdHocRoundParticipants:e,tournamentParticipants:t,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:c,matchUp:d,drawId:u,event:l}){let p=[],m=c?.matchUps??[],f=d.sides?.find((e=>e.sideNumber===o))?.participantId,h=m.filter((({roundNumber:e})=>e===d.roundNumber)),g=n?.entries?.filter((({entryStatus:e})=>e&&lg.includes(e))).map(Om)??[],I=h.map((e=>(e.sides??[]).flatMap(Om))).flat().filter(Boolean),y=g.filter((t=>!(i.includes(t)||e&&I.includes(t)))),v=t?.filter((e=>y?.includes(e.participantId))).map((e=>yd(e,void 0,!0)));v?.forEach((e=>{let t=(n.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),y.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:uT,type:HU,availableParticipantIds:y,participantsAvailable:v});let S=function({eventEntries:e,structure:t}){return e.filter((e=>e.entryStatus===Xh&&TT({structure:t,entry:e}))).sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))).map(Om)}({eventEntries:l?.entries??[],structure:c}),U=ar(g.concat(S));if(r){let e=(l?XI({event:l}):void 0)?.flights?.filter((e=>e.drawId!==u)).flatMap((e=>e.drawEntries.filter((e=>e.participantId&&![cg,ag,og].includes(e.entryStatus))).map((({participantId:e})=>e)))).filter(Boolean);e?.length&&U.push(...e)}U=U.filter((t=>!(i.includes(t)||y.includes(t)||e&&I.includes(t))));let b=t?.filter((e=>U.includes(e.participantId))).map((e=>yd(e,void 0,!0)));if(b?.forEach((e=>{let t=(n.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),b?.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),U.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:U,participantsAvailable:b,method:uT,type:Xh}),!My(d)&&o&&f){p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:lT,type:hT});let e=e=>e.sides.map(Om),i=({matchUpId:e})=>e!==d.matchUpId,r=e=>!My(e),n=d.sides?.find((e=>e.sideNumber!==o))?.participantId,c=[n,...m.filter((({roundNumber:e})=>e!==d.roundNumber)).filter(i).map(e).filter((e=>e.includes(f))).flat()].filter(Boolean),l=e=>!c.flat().includes(e),g=h.filter(r).filter(i).map(e).flat().filter(l);if(g.length){let e=t?.filter((e=>g.includes(e.participantId))).map((e=>yd(e,void 0,!0)));p.push({payload:{participantIds:[f],roundNumber:d.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:u},swappableParticipantIds:g,method:xU,type:XU,swappableParticipants:e})}}return p}function PT(e){if(!e)return{error:Ho};let{drawDefinition:t,event:i}=e,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:o,sideNumber:s,matchUpId:c}=e,d=e.tournamentRecord??(e.tournamentId&&Mr(e.tournamentId)&&e.tournamentRecords?.[e.tournamentId]);if(!d)return{error:zr};if(!c||!Mr(c))return{error:ra};if(s&&![1,2].includes(s))return Qs({result:{error:Ho},context:{sideNumber:s}});if(!t){let e=(vy({tournamentRecord:d}).matchUps??[]).find((e=>e.matchUpId===c));i=(d?.events??[]).find((t=>t.eventId===e?.eventId));let r=(i?.drawDefinitions??[]).find((t=>t.drawId===e?.drawId));r&&(t=r)}if(!t)return{error:Jr};let u=mv({withIndividualParticipants:!0,tournamentRecord:d}).participants,{drawId:l}=t,{matchUp:p,structure:m}=cw({drawDefinition:t,matchUpId:c,event:i});if(!p)return{error:aa};let f=Fh({tournamentRecord:d,drawDefinition:t,structure:m,event:i}).appliedPolicies??{};Object.assign(f,n??{});let h=f?.[bp]?.otherFlightEntries,g=f?.[wp]??Tv[wp],{enabledStructures:I}=rT({actionType:iT,appliedPolicies:f,drawDefinition:t,structure:m}),{policyActions:y}=aT({enabledStructures:I,drawDefinition:t,structure:m}),v=e.matchUpsMap??bg({drawDefinition:t}),S=e.inContextDrawMatchUps??gy({tournamentParticipants:u,inContext:!0,drawDefinition:t,matchUpsMap:v,event:i}).matchUps,U=S?.find((e=>e.matchUpId===c)),b=s&&U?.sides?.find((e=>e.sideNumber===s)),w=U?.sides?.map((e=>e.participantId||e.participant?.participantid)).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:D}=hf({structure:m}),{structureId:P}=m??{},N=[];if(!P)return{validActions:N};let E=Cg({structure:m}),M=!!p.collectionId;if(E&&!M){let e=DT({restrictAdHocRoundParticipants:r,tournamentParticipants:u,matchUpParticipantIds:w,otherFlightEntries:h,drawDefinition:t,structureId:P,sideNumber:s,matchUpId:c,structure:m,matchUp:p,drawId:l,event:i});N.push(...e)}let R=FS({drawDefinition:t,structure:m}),C=T?.filter((e=>e.participantId)).map((e=>e.drawPosition)),A=T?.filter((e=>e.bye)).map((e=>e.drawPosition)),k="BYE"===p.matchUpStatus||!M&&p.drawPositions?.reduce(((e,t)=>A?.includes(t)||e),!1);if(k)return{validActions:N,isByeMatchUp:k};oT({policyActions:y,action:vT})&&N.push({type:vT,payload:{matchUpId:c}});let O=!Ry({matchUpStatus:p.matchUpStatus}),x=f?.scoring?.structures,F=m?.stage&&x?.stage&&x?.stage[m.stage],L=m?.stageSequence&&F?.stageSequence&&F.stageSequence[m.stageSequence],_=!(f?.scoring?.requireAllPositionsAssigned||F?.requireAllPositionsAssigned||L?.requireAllPositionsAssigned)||D,B=p.sides&&2===p.sides.filter((e=>e?.participantId)).length,V=p.matchUpStatus&&[qm,Wm].includes(p.matchUpStatus),j=Zw({inContextDrawMatchUps:S,drawDefinition:t,targetData:py({inContextDrawMatchUps:S,drawDefinition:t,matchUpId:c})}),$=(2===U?.drawPositions?.length&&U.drawPositions.every((e=>C?.includes(e)))&&2===U?.sides?.length&&U.sides.every((({participantId:e})=>e))||B)&&!(V&&j),G={method:jU,type:ZU,payload:{drawId:l,matchUpId:c,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(O&&N.push({payload:{drawId:l,matchUpId:c,schedule:{}},method:gT,type:yT}),oT({policyActions:y,action:ZU})&&(b?.participant||!s&&w?.length)&&N.push(G),O&&$&&N.push({type:ST}),_&&$){let{matchUpId:e,matchUpFormat:t}=p,i={drawId:l,matchUpId:e,matchUpFormat:t,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};N.push({info:"set outcome and winningSide",method:gT,type:bT,payload:i}),oT({policyActions:y,action:UT})&&N.push({type:UT}),oT({policyActions:y,action:"END"})&&N.push({type:"END"})}if(M&&U){let e=function({specifiedPolicyDefinitions:e,inContextDrawMatchUps:t,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:c,matchUpId:d,matchUp:u,drawId:l,side:p}){let m=[],f=n.sides?.find((e=>e.participant)),h=oc(n.gender)&&n.sideNumber&&1===n.sides?.filter((e=>e.particiapntId)).length&&f?.participant?.person?.sex,g=n.matchUpType,I=!1!==(o??r?.participants?.enforceGender)?n.gender:void 0,y=n.sides?.flatMap((e=>e.participant?.individualParticipants||e.participant)).filter(Boolean)?.map(Om),v=n.sides?.filter((e=>!c||e.sideNumber===c)).flatMap((e=>e.participant?.individualParticipants||e.participant)).filter(Boolean),S=v?.map(Om),U=t?.find((e=>e.matchUpId===n.matchUpTieId))?.sides?.map((e=>e?.participant?.individualParticipants?.filter((({participantId:e,person:t})=>!S?.includes(e)&&(!I||sc(I)||t.sex===I||oc(I)&&!h||h&&t.sex!==h))))),b=c?U?.[c-1]:U?.map(((e,t)=>({participants:e,sideNumber:t+1}))),w=c?U?.[c-1]?.map(Om):U?.map(((e,t)=>({participants:e?.map(Om),sideNumber:t+1}))),T=c&&(yI(_i)(g)&&!S?.length||yI(Vi)(g)&&(S?.length??0)<2)||!c&&(yI(_i)(g)&&(S?.length??0)<2||yI(Vi)(g)&&(S?.length??0)<4),D=w?.filter((e=>!y?.includes(e))),P=b?.filter((({participantId:e})=>D.includes(e)));if(T&&D?.length&&m.push({availableParticipantIds:D,method:cT,availableParticipants:P,type:HU,payload:{participantId:void 0,tieMatchUpId:d,sideNumber:c,drawId:l}}),S?.length&&(!My(u)||p?.substitutions?.length)&&m.push({method:dT,type:hT,existingParticipantIds:S,payload:{participantId:void 0,tieMatchUpId:d,drawId:l}}),P?.length&&(!c&&S?.length||c&&p?.participant)&&m.push({availableParticipantIds:D,method:sT,availableParticipants:P,type:fT,existingParticipantIds:S,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:d,drawId:l}}),oT({policyActions:a,action:mT})&&p?.substitutions?.length){let e=p.participant?.participantType===ph&&[p.participantId]||p.participant?.participantType===fh&&p.participant.individualParticipantIds||[],t=p.substitutions.map((e=>e.participantId)).filter((t=>e.includes(t)));(!s||t.includes(s))&&m.push({method:dT,type:mT,substitutedParticipantIds:t,payload:{participantId:void 0,tieMatchUpId:d,drawId:l}})}let N=e?.[wp],E=N?.substituteWithoutScore,M=N?.substituteAfterCompleted;if(oT({policyActions:a,action:IT})&&2===i.length&&(!c&&S?.length||c&&p?.participant)&&(E||My(u))&&(M||u.matchUpStatus&&!af.includes(u.matchUpStatus))&&v?.length&&b.length){let e=v.map(Om);m.push({info:"list of team players available for substitution",method:pT,availableParticipantIds:w,existingParticipantIds:e,availableParticipants:b,existingParticipants:v,type:IT,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:c,matchUpId:d,drawId:l}})}return m}({specifiedPolicyDefinitions:n,inContextDrawMatchUps:S,matchUpParticipantIds:w,matchUpActionsPolicy:g,inContextMatchUp:U,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:c,matchUp:p,drawId:l,side:b});N.push(...e)}return{structureIsComplete:R,validActions:N,isDoubleExit:V,..._r}}function NT(e,t){return e.bye||aS(e.seedValue)<aS(t.seedValue)||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function ET({onlyAssignedPositions:e=!0,possiblyDisablingAction:t,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:c,isByePosition:d,drawPosition:u,structureId:l,structure:p,drawId:m,event:f}){if(n.includes(u))return{};let h=r?.filter((e=>e!==u&&!(d&&s.includes(e)))),g=a?.filter((t=>(t=>!e||t.participantId||t.qualifier||t.bye)(t)&&h?.includes(t.drawPosition)))??[],I=g.map((({drawPosition:e})=>e)),{matchUps:y}=oy({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:p,event:f}),v=y.filter((({drawPositions:e})=>Sr(e,I))),S=Object.assign({},...v.map((e=>e.sides?.filter((({sourceDrawPositionRange:e})=>e)).map((({drawPosition:e,sourceDrawPositionRange:t})=>({[e]:t}))))).flat()),U=g.map((e=>e.participantId)).filter(Boolean),b=(i??[]).filter((e=>U.includes(e.participantId))),w=Object.assign({},...b.map((e=>({[e.participantId]:e})))),T=g.map((e=>{let t=w?.[e.participantId],i=S[e.drawPosition];return Js({...e,participant:o?yd(t,!1,!0):void 0,sourceDrawPositionRange:i})}));return T.length?{validSwapAction:{payload:{drawId:m,structureId:l,drawPositions:[u]},willDisableLinks:t,method:kU,type:XU,availableAssignments:T}}:{}}function MT(e){let t=dp(e,[{event:!0,drawDefinition:!0,structureId:!0}]);if(t.error)return t;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:c}=e,d=e.tournamentParticipants??(a&&mv({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=lf({structureId:e.structureId,drawDefinition:o});if(u.error)return u;let l=u.containingStructure||u.structure;if(!l)return{error:Rn};let p=l.structureId;if(u=ky({drawDefinition:o,structureId:p}),void 0===s&&!u.isAdHoc)return{error:pn};if(u.isAdHoc)return PT(e);if(u.error)return u;let{drawPositionInitialRounds:m,inactiveDrawPositions:f,activeDrawPositions:h,byeDrawPositions:g}=u,I=Fh({tournamentRecord:a,drawDefinition:o,structure:l,event:c}).appliedPolicies??{};Object.assign(I,i??{});let y,{actionsPolicy:v,enabledStructures:S,actionsDisabled:U}=rT({actionType:tT,appliedPolicies:I,drawDefinition:o,structure:l}),b=v?.activePositionOverrides||[],{sourceStructureIds:w}=lU({finishingPosition:Il,targetRoundNumber:1,linkType:Vu,drawDefinition:o,structureId:p})||{};w?.length&&(y=w.every((e=>FS({structureId:e,drawDefinition:o}))));let T=w.length,D=w.length&&!y,{policyActions:P}=aT({enabledStructures:S,drawDefinition:o,structure:l}),N=![Su,vu].includes(l.stage)||1!==l.stageSequence,{drawId:E}=o,M=[],{assignedPositions:R,positionAssignments:C}=hf({structure:l}),A=R?.find((e=>e.drawPosition===s)),k=!!A;if(!C?.map((e=>e.drawPosition))?.includes(s))return{error:ln};let{stage:O,stageSequence:x}=l,F=[O];O===Uu&&F.push(vu),O===vu&&F.push(Uu);let L=Ig({entryStatuses:lg,provisionalPositioning:n,drawDefinition:o,stageSequence:x,structureId:p,stages:F}),_=Ky({drawDefinition:o,stages:F}).assignedParticipantIds??[],B=L.filter((e=>!_.includes(e.participantId))).map((e=>e.participantId)),V=g.includes(s),j=h.includes(s);if(U)return{info:"Actions Disabled for structure",isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:k,validActions:[],isByePosition:V};if(oT({policyActions:P,action:HU})&&!j&&C&&!D&&(!A||V)){let{validAssignmentActions:e}=function({positionSourceStructureIds:e,unassignedParticipantIds:t,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:c,drawDefinition:d,seedingProfile:u,isByePosition:l,drawPosition:p,structureId:m,event:f}){let h,g,{drawId:I}=d,y=[],v=[],S=c?.[Cp]?.validSeedPositions?.ignore;if(S||({unplacedSeedParticipantIds:h,unplacedSeedAssignments:g,unfilledPositions:v}=dS({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:d,seedingProfile:u,structureId:m})),v?.length||(v=o.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition))),l||y.push({payload:{drawId:I,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:BU,type:"BYE"}),a&&S){let t=o.map((e=>e.participantId)).filter(Boolean),r={structureIds:e},{completedMatchUps:a}=Iy({inContext:!0,matchUpFilters:r,drawDefinition:d}),c=ar((a??[]).filter((({matchUpType:e})=>f?.eventType!==gu||e===gu))?.map((({sides:e})=>e?.map(Om))).flat().filter((e=>e&&!t.includes(e)))),u=s?n?.filter((e=>c?.includes(e.participantId))).map((e=>yd(e,void 0,!0))):void 0;return u?.forEach((e=>{let t=(d.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),u?.length&&y.push(Js({payload:{drawId:I,structureId:m,drawPosition:p},willDisableLinks:i,method:LU,type:HU,availableParticipantIds:c,participantsAvailable:u})),{validAssignmentActions:y}}if(v.includes(p)||l){let e;if(g?.length){let t=g.filter((e=>h?.includes(e.participantId)));t.sort(NT),e=t.map((e=>e.participantId))}else e=t;let r=s?n?.filter((t=>e.includes(t.participantId))).map((e=>yd(e,void 0,!0))):void 0;r?.length&&y.push(Js({payload:{drawId:I,structureId:m,drawPosition:p},willDisableLinks:i,method:LU,type:HU,availableParticipantIds:e,participantsAvailable:r}))}return{validAssignmentActions:y}}({positionSourceStructureIds:w,unassignedParticipantIds:B,possiblyDisablingAction:N,isWinRatioFedStructure:T,tournamentParticipants:d,positionAssignments:C,returnParticipants:r,appliedPolicies:I,drawDefinition:o,isByePosition:V,drawPosition:s,structureId:p,event:c});e?.forEach((e=>M.push(e)))}if(oT({policyActions:P,action:GU})&&!j){let{validAssignmentActions:e}=function({drawPositionInitialRounds:e,tournamentParticipants:t,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:c}){let d=[],u=[],l=[],p=[],m=i.map((e=>e.participantId)).filter(Boolean),f=n?.[bp],h=!f?.disableRoundRestrictions&&e[o],g=f?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:y}=lU({targetRoundNumber:h,linkType:ju,drawDefinition:a,structureId:s})||{};I?.length&&p.push(...I);let{sourceStructureIds:v,relevantLinks:S}=lU({targetRoundNumber:h,linkType:Vu,drawDefinition:a,structureId:s})||{};v?.length&&p.push(...v);for(let U of y){let e=a.structures?.find((e=>e.structureId===U.source.structureId));if(e?.stage!==Su)continue;let i=FS({structureId:U.source.structureId,drawDefinition:a});if(!g||i){let i=e.qualifyingRoundNumber,{matchUps:n}=oy({matchUpFilters:{roundNumbers:[i],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:t,inContext:!0,structure:e});for(let e of n){let t=e.sides.find((t=>t?.sideNumber===e.winningSide)),i="BYE"===e.matchUpStatus&&e.sides?.find((({participantId:e})=>e));if(t||i){let{participantId:e,participant:n}=t||i||{};e&&!m.includes(e)&&(n&&r&&d.push(n),u.push(e))}}}}for(let U of S){let e=a.structures?.find((e=>e.structureId===U.source.structureId));if(e?.stage!==Su)continue;let i=FS({structureId:U.source.structureId,drawDefinition:a});if(!g||i){let{positionAssignments:i}=ff({structure:e}),n=i?.map((e=>{let t=e.participantId,i=Jp({element:e,name:Sm}).extension?.value;return i?{participantId:t,groupOrder:i?.groupOrder}:{}})).filter((({groupOrder:e,participantId:t})=>1===e&&!m.includes(t))).map((({participantId:e})=>e))??[];if(n&&u.push(...n),r){let e=t.filter((({participantId:e})=>n.includes(e)));d.push(...e)}}}return u.length&&l.push(Js({qualifyingParticipants:r?d:void 0,method:EU,type:GU,qualifyingParticipantIds:u,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:c}})),{validAssignmentActions:l,sourceStructureIds:p}}({drawPositionInitialRounds:m,tournamentParticipants:d,positionAssignments:C,returnParticipants:r,appliedPolicies:I,drawDefinition:o,drawPosition:s,structureId:p,drawId:E});e?.forEach((e=>M.push(e)))}let{participantId:$}=A||{},G=$&&d.find((e=>e.participantId===$));if(A){oT({policyActions:P,action:zU})&&!j&&(M.push({type:zU,method:AU,payload:{drawId:E,structureId:p,drawPosition:s},willDisableLinks:N}),V||M.push({type:qU,method:MU,payload:{drawId:E,structureId:p,drawPosition:s},willDisableLinks:N}),oT({policyActions:P,action:"BYE"})&&!V&&M.push({type:"BYE",method:AU,payload:{drawId:E,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:N}));let e=l.stage===Su||l.stage===vu&&1===l.stageSequence;if(!V&&nT({activePositionOverrides:b,activeDrawPositions:h,action:QU})&&oT({policyActions:P,action:QU})&&cS({drawDefinition:o,structureId:p,drawPosition:s})&&e){let{seedAssignments:e}=yg({returnAllProxies:!0,drawDefinition:o,structure:l}),{seedNumber:t,seedValue:i}=e?.find((e=>e.participantId===$))??{};M.push({type:QU,method:VU,participant:G,seedNumber:t,payload:{drawId:E,structureId:p,participantId:$,seedValue:i}})}if(!V&&nT({activePositionOverrides:b,activeDrawPositions:h,action:KU})&&oT({policyActions:P,action:KU})&&cS({drawDefinition:o,structureId:p,drawPosition:s})&&e){let{seedAssignments:e}=yg({returnAllProxies:!0,drawDefinition:o,structure:l}),{seedNumber:t}=e?.find((e=>e.participantId===$))??{};M.push({method:_U,type:KU,participant:G,seedNumber:t,payload:{participantId:$,structureId:p,drawId:E}})}if(!V&&$){if(oT({policyActions:P,action:ZU})){let e={type:ZU,method:jU,participant:G,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:E}};M.push(e)}if(oT({policyActions:P,action:JU})){let e={type:JU,method:FU,participant:G,payload:{participantId:$,otherName:void 0}};M.push(e)}}if(oT({policyActions:P,action:XU})){let{validSwapAction:e}=ET({possiblyDisablingAction:N,tournamentParticipants:d,inactiveDrawPositions:f,activeDrawPositions:h,positionAssignments:C,returnParticipants:r,byeDrawPositions:g,drawDefinition:o,isByePosition:V,drawPosition:s,structureId:p,structure:l,drawId:E});e&&M.push(e)}}if(oT({policyActions:P,action:WU})&&!D){let{validAlternatesAction:e}=function({tournamentParticipants:e=[],possiblyDisablingAction:t,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:c,structureId:d,structure:u,drawId:l,event:p}){if(i.includes(s))return{};let m=c.find((e=>e.type===HU))?.availableParticipantIds,f=a?.[bp]?.otherFlightEntries,h=a?.[bp]?.restrictQualifyingAlternates,g=(o.entries??[]).filter((({entryStage:e})=>!h||(u.stage===Su?e===Su:e!==Su))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((({participantId:e})=>e)).filter(Boolean),{allPositionedParticipantIds:I}=mf({drawDefinition:o}),y=r.map((e=>e.participantId)).filter(Boolean),v=g.filter((e=>u.stage&&[Su,vu,wu].includes(u.stage)?!I?.includes(e):!y.includes(e))),S=(p?.entries??[]).filter((e=>e.entryStatus===Xh&&TT({restrictQualifyingAlternates:h,structure:u,entry:e})&&(u.stage&&[Su,vu,wu].includes(u.stage)?!I?.includes(e.participantId):!y.includes(e.participantId)))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((e=>e.participantId)),U=ar(v.concat(S));if(f){let e=(p?XI({event:p}).flightProfile:void 0)?.flights?.filter((e=>e.drawId!==l)).map((e=>e.drawEntries.filter((e=>e.participantId&&![cg,ag,og].includes(e.entryStatus)&&!g.includes(e.participantId))).map((({participantId:e})=>e)))).flat().filter(Boolean);e?.length&&U.push(...e)}m?.length&&(U=U.filter((e=>!m.includes(e))));let b=n?e?.filter((e=>U.includes(e.participantId))):void 0;return b?.forEach((e=>{let t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),b?.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),U.length?{validAlternatesAction:Js({payload:{drawId:l,structureId:d,drawPosition:s},willDisableLinks:t,method:RU,availableAlternatesParticipantIds:U,type:WU,availableAlternates:b})}:{}}({possiblyDisablingAction:N,tournamentParticipants:d,positionAssignments:C,activeDrawPositions:h,returnParticipants:r,appliedPolicies:I,drawDefinition:o,drawPosition:s,validActions:M,structureId:p,structure:l,drawId:E,event:c});e&&M.push(e)}if(oT({policyActions:P,action:YU})&&!D&&!j&&C){let{validLuckyLosersAction:e}=function({tournamentParticipants:e=[],sourceStructuresComplete:t,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:c,structure:d,drawId:u,event:l}){if(n.includes(s)||r&&!t)return{};let{sourceStructureIds:p,targetStructureIds:m}=o.links?.reduce(((e,t)=>{let i=t.source?.structureId,r=t.target?.structureId;return e.sourceStructureIds.includes(i)||e.sourceStructureIds.push(i),e.targetStructureIds.includes(r)||e.targetStructureIds.push(r),e}),{sourceStructureIds:[],targetStructureIds:[]})||{},f=[],h=o.links?.filter((e=>e.target?.structureId===d.structureId))??[];for(let I of h){let e=I?.source?.structureId,{structure:t}=lf({structureId:e,drawDefinition:o}),i={};if(t?.finishingPosition===yl&&(1!==p?.length||1!==m?.length)){let{matchUps:e}=oy({drawDefinition:o,structure:d,event:l}),{initialRoundNumber:t}=Oy({drawPosition:s,matchUps:e}),r=o.links?.find((e=>e.target?.structureId===d?.structureId&&e.target.roundNumber===t))?.source?.roundNumber;i.roundNumbers=[r]}let{completedMatchUps:r}=cy({structureId:e,inContext:!0,matchUpFilters:i,drawDefinition:o}),n=a.map((e=>e.participantId)).filter(Boolean);r?.filter((({matchUpType:e,winningSide:t})=>t&&(l?.eventType!==gu||e===gu))).map((({winningSide:e,sides:t})=>e&&t?.[1-(e-1)])).map(Om).filter((e=>e&&!n.includes(e)))?.forEach((e=>{f.includes(e)||f.push(e)}))}let g=e?.filter((e=>f?.includes(e.participantId)));return g?.forEach((e=>{let t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),f?.length?{validLuckyLosersAction:{type:YU,method:CU,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:i,payload:{drawId:u,structureId:c,drawPosition:s}}}:{}}({sourceStructuresComplete:y,possiblyDisablingAction:N,isWinRatioFedStructure:T,tournamentParticipants:d,activeDrawPositions:h,positionAssignments:C,drawDefinition:o,drawPosition:s,structureId:p,structure:l,drawId:E});e&&M.push(e)}if(G?.participantType===fh&&oT({policyActions:P,action:$U})){let{validModifyAssignedPairAction:e}=function({tournamentParticipants:e,returnParticipants:t,drawPosition:i,participant:r,drawId:n,event:a}){let o=a?.entries?.filter((({entryStatus:e})=>[ag,og].includes(e))).map((({participantId:e})=>e))||[];if(o.length){let a=r.individualParticipantIds,s=t?e.filter((({participantId:e})=>o.includes(e))):void 0,c=t?e.filter((({participantId:e})=>a.includes(e))):void 0;return{validModifyAssignedPairAction:Js({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:OU,availableIndividualParticipantIds:o,availableIndividualParticipants:s,existingIndividualParticipantIds:a,existingIndividualParticipants:c,type:$U},!1,!1,!0)}}return{}}({tournamentParticipants:d,returnParticipants:r,drawPosition:s,participant:G,drawId:E,event:c});e&&M.push(e)}return{isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:k,isByePosition:V,validActions:M,..._r}}function RT({policyDefinitions:e,appliedPolicies:t,drawType:i}){let r=e?.[kp]?.drawTypeCoercion,n=t?.[kp]?.drawTypeCoercion;return("boolean"==typeof r?r:void 0)??(i&&r?.[i])??("boolean"==typeof n?n:void 0)??(i&&n?.[i])??!0}var CT=({drawDefinition:e})=>{let t=dp({drawDefinition:e},[{[Pl]:!0}]);if(t.error)return t;let i=e.structures?.find((e=>e.stage===vu&&1===e.stageSequence));if(!i)return Qs({result:{error:kn}});let{qualifierPositions:r}=hf({structure:i});return gr(0,r.length).sort((()=>Math.random()-.5))};function AT({structureId:e,drawDefinition:t}){if(!t)return{error:Jr};if(!Mr(e))return{error:Ho};let i=uy({drawDefinition:t,structureId:e});if(i.error)return i;let r=i.links.target.flatMap((e=>e.target.feedProfile)).filter(Boolean),n=!yr([Bu,_u,Lu,ku],r).length;return{..._r,valid:n}}function kT({tournamentRecord:e,drawDefinition:t,stage:i=vu,structureId:r,structure:n}){if(!e)return{error:zr};if(!n&&!t)return{error:Jr};if(!n&&!r&&1===t?.structures?.filter((e=>e.stage===i)).length&&(n=t.structures.find((e=>e.stage===i))),!n&&!r)return{error:Mn};let{error:a,positionAssignments:o}=ff({drawDefinition:t,structureId:r,structure:n});return{positionAssignments:o??[],structureId:n?.structureId,error:a}}function OT({participantsCount:e,participantCount:t}){if(!(e=e??t))return{error:Ho};let i=er(e);return i?{drawSize:i}:Qs({result:{error:Ho},stack:"getEliminationDrawSize",context:{participantsCount:e}})}function xT(e){let{drawSizeProgression:t=!1,policyDefinitions:i,drawSize:r}=e||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=e||{},c="getSeedsCount",d=e?.participantsCount??e?.participantCount;if(!i){let e=Lh({tournamentRecord:a,drawDefinition:o,event:s});if(e.error)return Qs({result:e,stack:c});i=e.policyDefinitions}let u=ir(d);if(d&&!u)return Qs({result:{error:Ho},context:{participantsCount:d},stack:c});if(n&&!u)return Qs({result:{error:Qa},stack:c});if(isNaN(r)){if(!d)return Qs({result:{error:gn},stack:c});({drawSize:r}=OT({participantsCount:d}))}let l=n&&d||r;if(l&&l>r)return{error:ro};let p=i?.[Cp];if(!p)return{error:ma};let m=p.seedsCountThresholds;return m?(void 0!==p.drawSizeProgression&&(t=p.drawSizeProgression),{seedsCount:m.filter((e=>t?e.drawSize<=r:r===e.drawSize)).reduce(((e,t)=>d&&d>=t.minimumParticipantCount?t.seedsCount:e),0)}):{error:Un}}function FT({consideredEntries:e,policyDefinitions:t,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){if((!o||!n)&&i&&({participants:o,participantMap:n}=mv({tournamentRecord:i})),!o)return{error:qa};if(!Array.isArray(o))return{error:Ho};if(!s)return{error:Fn};let c=t?.[wp]??r?.[wp]??Tv[wp],d=!1!==(a??c?.participants?.enforceGender),{eventType:u,gender:l}=s,p=u===hu,m=u===Iu&&hh||p&&fh||ph,f=Object.assign({},...(e??s.entries??[]).map((e=>({[e.participantId]:e.entryStatus})))),h=Object.keys(f),g=o.filter((e=>h.includes(e.participantId))).filter((e=>{let t=function({participant:e,participantType:t,eventType:i,entryStatusMap:r}){let n=r[e.participantId],a=i&&[hu,Iu].includes(i)&&e.participantType===ph&&(Jy(n)||n===cg);return e.participantType!==t&&!a}({participant:e,participantType:m,eventType:u,entryStatusMap:f}),i=function(e){let{participant:t,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:o}=e,s=!n&&a&&ar(t?.individualParticipantIds?.map((e=>i?.[e]?.participant?.person?.sex)).filter(Boolean)??[])||[],c=!r||!s?.length||sc(r)||dc(r)&&cc(s[0])===cc(r)||oc(r)&&(1===s.length&&1===t.individualParticipantIds?.length||2===s.length),d=t?.person?.sex,u=!t?.person||!r||oc(r)||sc(r)||dc(r)&&cc(d)===cc(r);return!o||c&&u}({genderEnforced:d,participantMap:n,eventGender:l,participant:e,isDoubles:p,mismatch:t});return t||!i}));if(g.length){let e=g.map((e=>e.participantId));return{error:Vn,invalidParticipantIds:e}}return{..._r,valid:!0}}function LT({hasExistingDrawDefinition:e,qualifyingProfiles:t,appliedPolicies:i,qualifyingOnly:r,tieFormat:n,idPrefix:a,isMock:o,uuids:s}){let c,d=[],u=[],l=[],p=(e,t)=>e.stageSequence-t.stageSequence,m=(e,t)=>e.roundTarget-t.roundTarget,f=0,h=0,g=1;for(let I of t.sort(m)){let m=I.structureProfiles||[];g=I.roundTarget||g;let y,v,S,U=1,b=0;for(let d of(m||[]).sort(p)){let p,h,I,w=Xi(d.drawSize||d.participantsCount),{qualifyingRoundNumber:T,structureOptions:D,matchUpFormat:P,structureName:N,structureId:E,drawType:M}=d,R=d.matchUpType,C=d.qualifyingPositions||_T({drawSize:w,qualifyingRoundNumber:T});if(!ir(w))return Qs({result:{error:gn},stack:"generateQualifyingSTructures"});let A=t.length>1?`${g}-`:"",k=m.length>1||A?U:"",O=N||(A||k?`${zv(Su)} ${A}${k}`:zv(Su));if(M===ll){let{structures:t,groupCount:u,maxRoundNumber:l}=eS({structureName:d.structureName||O,structureId:E||s?.pop(),hasExistingDrawDefinition:e,stage:Su,structureOptions:D,appliedPolicies:i,qualifyingOnly:r,stageSequence:U,matchUpType:R,roundTarget:g,tieFormat:n,drawSize:w,idPrefix:a,isMock:o,uuids:s});b=u,p=l,h=t[0],c=[1]}else({drawSize:w,matchUps:I,roundLimit:p}=db({qualifyingRoundNumber:T,qualifyingPositions:C,matchUpType:R,drawSize:w,idPrefix:a,isMock:o,uuids:s})),h=qv({structureName:d.structureName||O,structureId:E||s?.pop(),qualifyingRoundNumber:p,hasExistingDrawDefinition:e,stage:Su,qualifyingOnly:r,matchUpFormat:P,stageSequence:U,matchUpType:R,roundLimit:p,tieFormat:n,matchUps:I}),g&&Vp({extension:{name:hm,value:g},element:h}),b=I?.filter((e=>e.roundNumber===p))?.length||0;if(U>1){let{link:e}=nb({sourceStructureId:v,sourceRoundNumber:y,targetStructureId:h.structureId,finishingPositions:S===Vu?[1]:void 0,linkType:S});l.push(e),f+=(w||0)-b}else f+=w||0;S=M===ll?Vu:ju,v=h.structureId,y=p,n&&(I=oy({structure:h})?.matchUps||[],I?.forEach((e=>{let{tieMatchUps:t}=ab({tieFormat:n,matchUp:e,isMock:o});Object.assign(e,{tieMatchUps:t,matchUpType:R})}))),u.push(h),U+=1}h+=b,d.push({qualifiersCount:b,finalQualifyingRoundNumber:y,finalQualifyingStructureId:v,finishingPositions:c,roundTarget:g,linkType:S}),g+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:f,qualifyingDetails:d,structures:u,..._r,links:l}}function _T({drawSize:e,qualifyingRoundNumber:t}){let i=e,r=0;for(;r<t;)i=Math.floor(i/2),r+=1;return i}function BT(e){let{drawTypeCoercion:t,enforceMinimumDrawSize:i}=e,r=zi(e.drawSize),n=t&&e.drawType!==Wu&&("boolean"==typeof t||t<=2)&&2===r&&Yu||e.drawType||Yu,a=vl.includes(n);if(r&&a)if(t&&("boolean"==typeof t&&r<4||r<=t))n=Yu;else if(r<4&&i)return{...Qs({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:fn},stack:"getCoercedDrawType"}),drawType:n};return{drawType:n}}function VT({structureName:e,matchUpType:t,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=fb({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:t,idPrefix:i,isMock:n}),c=Wv({structureName:e||zv(vu),structureId:a?.pop(),stageSequence:1,stage:vu,matchUpType:t,matchUps:s});o.push(c);let d=r/2,{matchUps:u}=fb({finishingPositionOffset:d,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:t,isMock:n,uuids:a}),l=Wv({structureName:zv(fl),matchUps:u,structureId:a?.pop(),stage:Uu,stageSequence:2,matchUpType:t});o.push(l);let{matchUps:p}=db({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:t,isMock:n}),m=Wv({structureName:zv(ml),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:wu,matchUpType:t});o.push(m);let f=function({mainStructure:e,consolationStructure:t,deciderStructure:i}){let r=t.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),n=e.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0),a=t.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0);return[...r.map(((i,n)=>{let a=r.indexOf(i)%2?_u:Bu;return{linkType:$u,source:{roundNumber:1+n,structureId:e.structureId},target:{feedProfile:a,roundNumber:i,structureId:t.structureId}}})),{linkType:ju,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:_u,roundNumber:n,structureId:e.structureId}},{linkType:ju,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:_u,roundNumber:1,structureId:i.structureId}},{linkType:$u,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:_u,roundNumber:1,structureId:i.structureId}}]}({mainStructure:c,consolationStructure:l,deciderStructure:m});return{structures:o,links:f,..._r}}function jT(e){let{qualifyingRoundNumber:t,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:c}=e;if(!ir(o)||o<2)return{matchUps:[],roundsCount:0};if(Yi(o))return db(e);let d=function(e){let t=zi(e),i=t%2?t+1:t,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let e=Math.ceil(i/2),t=1===e,r=!(t||!(e%2));i=!t&&r?e+1:e;let a=!!(2!==i&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:a,feedRound:r})}return n}(o),u=d.shift(),l=gr(1,(u?.participantsCount||0)+1).map((e=>({drawPosition:e}))),p=[],m=1;({matchUps:p}=cb({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:l,uuids:c})),m++;let f=e.roundLimit||t;for(let g of d){let e=g.participantsCount/2,t=gr(1,e+1);r&&e===r&&(f=m-1);let i=t.map((e=>{let t=sb({roundPosition:e,roundNumber:m,idPrefix:a,uuids:c});return{roundPosition:e,roundNumber:m,matchUpId:t}}));p.push(...i),m++}let h=m-1;return p=Py({finishingPositionOffset:i,lucky:!0,roundsCount:h,roundLimit:f,matchUps:p}),f&&(p=p.filter((e=>e.roundNumber<=f))),{matchUps:p,roundsCount:h,roundLimit:f}}function $T(e){let{playoffAttributes:t,stageSequence:i=1,stage:r=vu,tieFormat:n,matchUpType:a,drawSize:o,uuids:s}=e,c=e.structureId||(e.isMock||e.idPrefix?`${e.drawDefinition.drawId}-s-0`:void 0)||s?.pop(),d=e.appliedPolicies??Fh(e),u=e.policyDefinitions?.[Ap]||d?.[Ap];e.skipRounds=e.skipRounds||o<=4&&(u?.feedFromMainFinal?0:1)||0;let l=e.structureName??t?.[0]?.name??zv(vu);return{generators:{[Wu]:()=>({structures:[qv({finishingPosition:Il,stageSequence:i,structureName:l,matchUps:[],matchUpType:a,structureId:c,stage:r})],links:[],..._r}),[Qu]:()=>{let{matchUps:t}=jT(e);return{structures:[qv({stageSequence:i,structureName:l,matchUpType:a,structureId:c,matchUps:t,stage:r})],links:[],..._r}},[Yu]:()=>(()=>{let{matchUps:t}=db(e);return{structures:[qv({stageSequence:i,structureName:l,matchUpType:a,structureId:c,tieFormat:n,matchUps:t,stage:r})],links:[],..._r}})(),[Ku]:()=>VT(e),[Hu]:()=>hb({...e,roundOffsetLimit:3,playoffAttributes:t??hl}),[zu]:()=>hb({...e,roundOffsetLimit:2,playoffAttributes:t??gl}),[wu]:()=>hb(e),[qu]:()=>{let{matchUps:e}=fb({drawSize:o,uuids:s,matchUpType:a});return{structures:[qv({stageSequence:i,structureName:l,matchUpType:a,structureId:c,stage:vu,tieFormat:n,matchUps:e})],links:[],..._r}},[Ju]:()=>Tb(e),[Xu]:()=>Nb({...e,feedRounds:1,fmlc:!0}),[sl]:()=>Nb({...e,feedRounds:1}),[tl]:()=>Nb({...e,feedsFromFinal:1}),[rl]:()=>Nb({...e,feedsFromFinal:2}),[al]:()=>Nb({...e,feedsFromFinal:3}),[dl]:()=>Nb(e),[Zu]:()=>Pb(e),[ll]:()=>eS(e),[pl]:()=>function(e){let{drawDefinition:t,structureOptions:i,requireSequential:r}=e,n={structureName:zv(vu),...e,stage:vu},{structures:a,groupCount:o}=eS(n);if(o<1)return{error:jo};let s=i?.playoffGroups||[{finishingPositions:[1],structureName:zv(wu)}],[c]=a,{structures:d,links:u}=Eb({sourceStructureId:c.structureId,requireSequential:r,drawDefinition:t,playoffGroups:s,groupCount:o,...e});return d&&a.push(...d),{..._r,structures:a,links:u}}(e)}}}function GT(e){let{enforceMinimumDrawSize:t=!0,overwriteExisting:i,appliedPolicies:r,qualifyingOnly:n,staggeredEntry:a,drawDefinition:o,tieFormat:s,isMock:c,uuids:d}=e||{},u=zi(e.drawSize),l=e.drawTypeCoercion??RT({appliedPolicies:r,drawType:e.drawType}),p=BT({drawType:e.drawType,enforceMinimumDrawSize:t,drawTypeCoercion:l,drawSize:u});if(p.error)return p;let m=p.drawType,f=[],h=[],g=e?.matchUpType??Bi,I=o?.structures?.filter((({stage:e})=>e===Su));I&&f.push(...I);let y=I?.map((({structureId:e})=>e)),v=o?.structures?.find((({stage:e,stageSequence:t})=>e===vu&&1===t)),S=o?.links?.filter((e=>e.target.structureId===v?.structureId&&y?.includes(e.source.structureId))),U=(e,t)=>{if(e.linkType===Vu&&t?.structures){let i=e.source.finishingPositions||[];return t.structures.length*i.length}if(e.linkType===ju&&t?.matchUps?.length){let i=e.source.roundNumber;return t.matchUps.filter((({roundNumber:e})=>e===i)).length}},b=I?.map((e=>{let t=S?.find((t=>t.target.structureId===e.structureId)),i=ff({structure:e})?.positionAssignments?.length??0;if(!t)return i;let r=t?.source.structureId,n=o.structures?.find((e=>e.structureId===r));return i-(U(t,n)||0)})).filter(Boolean).reduce(((e,t)=>e+t),0),w=S?.map((e=>{let t=e.source.structureId,i=I?.find((e=>e.structureId===t));return U(e,i)})).filter(Boolean).reduce(((e,t)=>e+t),0),T=!(!v||v?.matchUps?.length);if(I?.length&&!T)return{error:ns};let D=!I?.length&&e.qualifyingProfiles,P=D?.length&&LT({idPrefix:e.idPrefix,qualifyingProfiles:D,appliedPolicies:r,qualifyingOnly:n,tieFormat:s,isMock:c,uuids:d});if(P?.error)return P;let{qualifyingDrawPositionsCount:N,qualifyingDetails:E,qualifiersCount:M}=P||{qualifyingDrawPositionsCount:b,qualifiersCount:w};N&&(P?.structures&&f.push(...P.structures),P?.links&&h.push(...P.links)),Object.assign(e,Js({drawSize:u,matchUpType:g,tieFormat:s}));let R=m!==Wu&&(!u||u<2||!a&&![qu,Qu].includes(m)&&([pl,ll].includes(m)&&u<3||![ll,pl].includes(m)&&!Yi(u)));if(R&&!N)return Qs({context:{drawSize:u,invalidDrawSize:R},result:{error:fn},stack:"generateDrawStructuresAndLinks"});let{generators:C,error:A}=$T(e);if(A)return{error:A};let k=C[m];if(!k)return{error:sn};let O=k?.();if(O.error)return O;let{structures:x,links:F}=O;if(x?.length){let e=x.find((({stage:e,stageSequence:t})=>e===vu&&1===t));if(v&&e)if(T){let t=e.structureId;if(e.structureId=v.structureId,F?.length)for(let e of F)e.source.structureId===t&&(e.source.structureId=v.structureId),e.target.structureId===t&&(e.target.structureId=v.structureId)}else if(!i)return{error:ns};f.push(...x)}f.sort(df),F?.length&&h.push(...F);let L=O.structures.find((({stage:e,stageSequence:t})=>e===vu&&1===t));for(let _ of E||[]){let{finalQualifyingRoundNumber:e,finalQualifyingStructureId:t,roundTarget:i,finishingPositions:r,linkType:n}=_,a=L&&nb({targetStructureId:L.structureId,sourceStructureId:t,sourceRoundNumber:e,finishingPositions:r,targetEntryRound:i,linkType:n})?.link;if(a?.error)return a;a&&h.push(a)}return S&&h.push(...S),{..._r,qualifyingResult:{qualifyingDrawPositionsCount:N,qualifiersCount:M},structures:f,links:h}}function WT(e){let{modifyOriginal:t=!0,stageSequence:i=1,isMock:r}=e||{},n="generateDrawTypeAndModifyDrawDefinition";if(!e.drawDefinition)return Qs({result:{error:Jr},stack:n});let a=t?e.drawDefinition:yd(e.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=e;if(o){let e=md({tieFormat:o});if(e.error)return e}o=yw(o??Ug({drawDefinition:a})?.tieFormat),s=s??(a.matchUpType||Bi),e.tieFormat=o,e.matchUpType=s;let c=gv({drawDefinition:a,stage:vu});e.drawSize=e.drawSize??c,!c&&e.drawSize&&TU({drawSize:e.drawSize,drawDefinition:a,stageSequence:i,stage:vu});let d=bg({drawDefinition:a}).drawMatchUps.map(xm),u=GT(e);if(u.error)return Qs({result:u,stack:n});let{structures:l,links:p,qualifyingResult:m}=u;a.structures=l,a.links=p;let f=Math.max(e.qualifiersCount??0,m?.qualifiersCount||0);if(m?.qualifyingDrawPositionsCount&&!gv({stage:Su,drawDefinition:a})){let e=TU({drawSize:m.qualifyingDrawPositionsCount,stage:Su,drawDefinition:a});if(e.error)return e}if(f){let e=DU({qualifiersCount:f,drawDefinition:a,stage:vu});if(e.error)return e}let h=e.drawSize??c;Object.assign(e,Js({drawSize:h,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:I}=gy({drawDefinition:a});o&&g?.forEach((e=>{if(!d.includes(e.matchUpId)){let{tieMatchUps:t}=ab({tieFormat:o,matchUp:e,isMock:r});Object.assign(e,{tieMatchUps:t,matchUpType:s})}}));let{inContextDrawMatchUps:y}=Ny({drawDefinition:a,matchUpsMap:I});return Zf({tournamentId:e.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:I,..._r,structures:l,matchUps:g,links:p}}function qT(e){let t,i,{removePriorValues:r,tournamentRecord:n,participantId:a,scaleItem:o}=e;if(!zT({scaleItem:o}))return{error:Fo};if(a&&Array.isArray(n.participants)&&(i=n.participants.find((e=>e.participantId===a)),i)){if(i.participantType===lh&&o?.eventType!==Iu)return{error:Fo};let e=YT({removePriorValues:r,participant:i,scaleItem:o});if(e.error)return e;t=!e.valueChanged;let{topics:a}=Ls();a.includes(Af)&&As({topic:Af,payload:{tournamentId:n.tournamentId,participants:[i]}})}return t&&{..._r,info:Jo,existingValue:o?.scaleValue}||i&&{..._r,newValue:o?.scaleValue}||{error:Ya}}function HT(e){let{scaleItemsWithParticipantIds:t=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=e;if(!r)return{error:zr};if(!r.participants)return{error:qa};let o=0,s={},c=[];for(let l of t){let e=l?.participantId;if(Array.isArray(l?.scaleItems))for(let t of l.scaleItems){if(!zT({scaleItem:t}))return{error:Fo};Array.isArray(s[e])||(s[e]=[]),s[e].push(t)}}for(let l of r.participants){let{participantId:e}=l||{};if(Array.isArray(s[e]))for(let t of s[e]){if(l.participantType===lh&&t?.eventType!==Iu)return Qs({context:{participantId:e,scaleItem:t,participantType:l.participantType},info:"Invalid participantType for eventType",result:{error:Fo}});YT({participant:l,scaleItem:t,removePriorValues:i}),c.push(l),o++}}let d=o?void 0:_o,{topics:u}=Ls();if(u.includes(Af)&&o&&As({topic:Af,payload:{tournamentId:r.tournamentId,participants:c}}),a){let{eventId:e,drawId:t,...i}=a,n=i.scaleAttributes?.scaleType&&[i.scaleAttributes.scaleType];if(Object.keys(i).length){let a={itemType:vf,itemValue:i};if(n&&(a.itemSubTypes=n),t||e){let{drawDefinition:i,event:n}=JI({tournamentRecord:r,eventId:e,drawId:t});t&&vU({drawDefinition:i,timeItem:a}),e&&Ew({event:n,timeItem:a})}else Nw({tournamentRecord:r,timeItem:a})}}return n&&u.includes(bf)&&As({topic:bf,payload:n}),Js({..._r,modificationsApplied:o,info:d})}function zT({scaleItem:e}){let t=e&&Object.keys(e),i=["scaleType","eventType","scaleName"];return i.filter((e=>t?.includes(e))).length===i.length}function YT({removePriorValues:e,participant:t,scaleItem:i}){if(!t)return{error:Wa};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter((e=>r.includes(e)&&i[e])).length!==n.length)return{error:Fo};let a=(new Date).toISOString();t.timeItems||(t.timeItems=[]);let{scaleItem:o}=Zy({scaleAttributes:i,participant:t}),s=e=>[void 0,null,""].includes(e),c=!(s(o?.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o?.scaleValue)!==JSON.stringify(i.scaleValue);if(c){let{scaleType:r,eventType:n,scaleName:o}=i,s=[fp,r,n,o].join("."),c=Js({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:s});i.scaleId&&(c.itemSubTypes=[i.scaleId]),e&&(t.timeItems=t.timeItems.filter((e=>e.itemType!==s))),t.timeItems.push(c)}return{..._r,valueChanged:c,newValue:i.scaleValue}}function KT(e){let{tournamentRecord:t,modifiedScaleValues:i,removePriorValues:r}=e,n=dp(e,[{[Tl]:!0},{modifiedScaleValues:!0,[rp]:Ql}]);if(n.error)return n;for(let a in i){let e=qT({scaleItem:i[a],removePriorValues:r,tournamentRecord:t,participantId:a});if(e.error)return e}return{..._r}}function XT(e){let{tournamentRecord:t,scaleAttributes:i,participantId:r}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!r)return{error:Ha};let{participant:a,tournamentId:o}=bh({tournamentRecords:n,tournamentRecord:t,participantId:r});return a?{...Zy({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Ya}}var JT={nSpread:400,diffThreshold:.125,kCalc:(e=0)=>250/Math.pow(e+5,.4),kMultiplier:function(e=3,t=2){let i=e/t;return Number.isNaN(i)?JT.kDefault():i},kDefault:()=>1};function QT(e){let{winnerRating:t,loserRating:i}=e,{ratings:r=kb,winnerCountables:n=1,loserCountables:a=0,ratingType:o="ELO",maxCountables:s,countables:c}=e||{},d=r?.[o];if(!d)return{error:va};let u=d.range||e.ratingRange;t=t||d.defaultInitialization,i=i||d.defaultInitialization;let l=u[0]>u[1],p=d.decimalsCount||0,m=l?u.slice().reverse():u,f=(e,t)=>Number.parseFloat(t)>=Math.min(...e)&&Number.parseFloat(t)<=Math.max(...e);(!f(u,t)||!f(u,i))&&(f(u,t)||(t=d.defaultInitialization),f(u,i)||(i=d.defaultInitialization));let h=Rb({targetRange:kb.ELO.range,sourceRange:m,value:l?u[0]-t:t}),g=Rb({targetRange:kb.ELO.range,sourceRange:m,value:l?u[0]-i:i}),I=(e,t)=>1/(1+Math.pow(10,(t-e)/JT.nSpread)),y=I(h,g),v=I(g,h),S=JT.kCalc(n),U=JT.kCalc(a),b=JT.kMultiplier(s,c),w=h+b*S*(1-y),T=g+b*U*(0-v),D=Rb({sourceRange:kb.ELO.range,value:w,targetRange:m}),P=Rb({sourceRange:kb.ELO.range,value:T,targetRange:m}),N=l?u[0]-D:D,E=Number.parseFloat(N.toFixed(p)),M=l?u[0]-P:P,R=Number.parseFloat(M.toFixed(p)),C=Math.max(...u)?Math.abs(t-i)/Math.max(...u):0;return(D>P&&C>JT.diffThreshold||E<0||R<0)&&(E=t,R=i),{newWinnerRating:E,newLoserRating:R}}var ZT=e=>e?.reduce(((e,t)=>(t.winningSide&&(e[t.winningSide-1]+=1),e)),[0,0])||[0,0];function eD(e){let t=dp(e,[{[Tl]:!0},{matchUpIds:!0,[rp]:Zl,[Yl]:na},{ratingType:!1,[ep]:e=>kb[e]}]);if(t.error)return t;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:o,considerGames:s,drawDefinition:c,matchUpIds:d,asDynamic:u}=e,l=kb[a],{accessor:p}=l,m={},f=(e.matchUps||o&&by({drawDefinition:c,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:af}}).matchUps||vy({matchUpFilters:{matchUpIds:d,matchUpStatuses:af},tournamentRecord:n,inContext:!0}).matchUps)??[],h=`${a}.${lp}`,g=u?h:a;f.sort(Uy);for(let y of f){let{endDate:e,matchUpFormat:t,score:c,sides:d,winningSide:u}=y,l=y.matchUpType,f={eventType:l,scaleName:a,scaleType:mp},I={scaleName:h,eventType:l,scaleType:mp},v=Object.assign({},...(d??[]).map((e=>{let{sideNumber:t,participant:i}=e;return t&&{[t]:[i?.participantId,...i?.individualParticipantIds??[]].filter(Boolean).flat()}}))),S=Object.assign({},...Object.values(v).flat().map((t=>{let i=!o||m[t]?XT({scaleAttributes:I,tournamentRecord:n,participantId:t}).scaleItem:void 0,r=XT({tournamentRecord:n,scaleAttributes:f,participantId:t}).scaleItem;return t&&{[t]:i??r??{scaleName:g,eventType:l,scaleDate:e,scaleType:mp,scaleValue:p?{[p]:void 0}:void 0}}}))),U=t?Uc(t):{},b=U?.bestOf||1,w=s?b&(U?.setsTo||1):b,T=c?.sets&&ZT(c.sets)||1===u&&[1,0]||[0,1],D=u?v[u]:[],P=u?v[3-u]:[];for(let i of D){let e=S[i]?.scaleValue,t="object"==typeof e?e[p]:e;for(let r of P){let n=S[r]?.scaleValue,o="object"==typeof n?n[p]:n,s=u?T[u]:[0,0],c=u?T[3-u]:[0,0],{newWinnerRating:d,newLoserRating:l}=QT({winnerCountables:s,loserCountables:c,maxCountables:w,winnerRating:t,loserRating:o,ratingType:a}),m=p?{...e,[p]:d}:d,f=p?{...n,[p]:l}:l;S[i].scaleValue=m,S[r].scaleValue=f,S[i].scaleName=g,S[r].scaleName=g}}Object.assign(m,S),i&&KT({tournamentRecord:n,modifiedScaleValues:m,removePriorValues:r})}let I=f.map((({matchUpId:e})=>e));return{..._r,modifiedScaleValues:m,outputScaleName:g,processedMatchUpIds:I}}function tD(e){let{matchUpIds:t=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:o}=e;if("object"!=typeof i)return{error:Jr};let{participantIdPairings:s,matchUpsCount:c}=e,d=Yw(e);if(d.error)return Qs({result:d});let{lastRoundNumber:u,availableMatchUpsCount:l=0,roundMatchUpsCount:p=0}=d;if(c){if(c>p&&!1!==e.restrictMatchUpsCount)return Qs({result:{error:Ho,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}})}else n?c=p:l>0&&(c=l);if(s&&!Array.isArray(s)||c&&!ir(c)||t&&!Array.isArray(t)||!s&&!c)return{error:Ho,info:"matchUpsCount or pairings error"};if(c&&!1!==e.restrictMatchUpsCount&&c>32)return{error:Ho,info:"matchUpsCount must be less than 33"};if(r&&!e.ignoreLastRoundNumber&&r-1>(u||0))return{error:Ho,info:"roundNumber error"};let m=r??(n&&(u??0)+1||u||1);s=s??gr(0,c).map((()=>({participantIds:[void 0,void 0]})));let f=s?.map(((r,n)=>{let a=r?.participantIds??[void 0,void 0];a.push(void 0,void 0);let o=a.slice(0,2).map(((e,t)=>Js({sideNumber:t+1,participantId:e}))),s=t[n]??(t=>{if(!e.idPrefix)return;return`${i.drawId}-${e.idPrefix??"ah"}-${m}-${t}`})(n)??Ud();return{roundNumber:m,matchUpStatus:Jm,matchUpId:s,sides:o}}));if(f?.length){let e=Ug({drawDefinition:i,event:o})?.tieFormat;e&&f.forEach((t=>{let{tieMatchUps:i}=ab({tieFormat:e,matchUp:t,isMock:a});Object.assign(t,{tieMatchUps:i,matchUpType:Gi})}))}return{roundNumber:m,matchUpsCount:f?.length??0,matchUps:f,..._r}}function iD(e){return e.participantIdPairings.map((({participantIds:e})=>e.sort().join("|"))).sort().join("/")}function rD({valueSortedPairings:e,stipulated:t=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...t),s=[],c=0;t.filter(Boolean).forEach((e=>{let[t,r]=e,n=nD(t,r),a=i[n];s.push({participantIds:e,value:a}),c+=i[n]})),wr(e,a).map((e=>sr(e).map((e=>({...e,value:e.value+Math.random()*Math.round(Math.random())}))))).flat().forEach((e=>{let t=e.pairing.split("|");if(!t.reduce(((e,t)=>o.includes(t)||e),!1)){o.push(...t);let i=e.value;c+=i,s.push({participantIds:t,value:i})}})),s.sort(((e,t)=>e.value-t.value));let d=s.reduce(((e,t)=>{let[i,n]=t.participantIds,a=nD(i,n),o=r[a];return o>e?o:e}),0),u=s.reduce(((e,t)=>{let[i,r]=t.participantIds,a=nD(i,r),o=n[a];return o>e?o:e}),0);return{value:c,participantIdPairings:s,maxDelta:d,maxDiff:u}}function nD(e,t){return[e,t].sort(uv).join("|")}function aD({participantIds:e}){let t={},i=[];e.forEach((r=>{t[r]=e.filter((e=>e!==r)),t[r].forEach((e=>{let t=nD(e,r);i.includes(t)||i.push(t)}))}));let r=Object.assign({},...i.map((e=>({[e]:0}))));return{uniquePairings:i,possiblePairings:t,deltaObjects:r}}var oD=0;function sD(e){let{tournamentParticipants:t,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:c,eventType:d,scaleName:u,salted:l}=e;n.forEach((e=>{let r=function({tournamentParticipants:e,adHocRatings:t,eventType:i,scaleName:r,pairing:n}){let a=kb[r]?.defaultInitialization??oD;return n.split("|").map((r=>{if(i===fu){let i=e?.find((e=>e.participantId===r))?.individualParticipantIds;return i?i?.map((e=>t[e]||a)):2*a}return t[r]||a}))}({tournamentParticipants:t,adHocRatings:i,scaleName:u,eventType:d,pairing:e}),n="number"==typeof l&&l||.5,a=l&&(Math.round(Math.random())?n:-1*n)||0,o=Math.abs(r[0]-r[1])+a,p=Math.abs(r[0]-r[1]);s[e]=p,c[e]||(c[e]=0),c[e]+=o?Math.pow(o,2):0}));let p=n.map((e=>({pairing:e,value:c[e]}))).sort(((e,t)=>e.value-t.value)),{pairingValues:m}=function({possiblePairings:e,valueObjects:t}){let i={};for(let n of Object.keys(e)){let t=e[n].map((e=>r(n,e)));i[n]=t.sort(((e,t)=>e.value-t.value))}function r(e,i){let r=nD(e,i);return{opponent:i,value:t[r]}}return{pairingValues:i}}({possiblePairings:r,valueObjects:c}),{candidate:f,candidatesCount:h,deltaCandidate:g,iterations:I}=function({maxIterations:e=4e3,valueSortedPairings:t,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...t.map((e=>({[e.pairing]:e.value})))),o=Object.keys(i),s=[],c=rD({actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:n,valueObjects:r}),d=[iD(c)];s.push(c);let u,l=c.value,p=c,m=1,f=0,h=o.length;do{h-=1,u=o.length*i[o[0]].length}while(u>e&&h>5);let g=[];o.forEach((e=>{i[e].slice(0,h).forEach((i=>{f+=1;let c=nD(e,i.opponent);if(!g.includes(c)){let u=rD({stipulated:[[e,i.opponent]],actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!d.includes(iD(u))){d.push(iD(u)),s.push(u);let{maxDelta:e,value:t}=u;e<p.maxDelta&&(p=u),(t<l||t===l&&Math.round(Math.random()))&&(l=t),g.push(c),m+=1}}})),s=s.filter((e=>Math.abs(e.value-l)<5))})),s.sort(((e,t)=>e.maxDiff-t.maxDiff));let I=fr(s);return{candidatesCount:m,deltaCandidate:p,maxIterations:e,iterations:f,candidate:I}}({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:c}),{participantIdPairings:y}=o?g:f;return{participantIdPairings:y,candidatesCount:h,deltaCandidate:g,iterations:I,candidate:f}}var cD=100,dD=100,uD=4e3;function lD(e){let{encounterValue:t=cD,sameTeamValue:i=dD,maxIterations:r=uD,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:o,iterationMatchUps:s,tournamentRecord:c,dynamicRatings:d,refreshDynamic:u,participantIds:l,drawDefinition:p,roundNumber:m,structureId:f,matchUpIds:h,eventType:g,scaleName:I,idPrefix:y,isMock:v,salted:S,event:U}=e;if(!p)return{error:Jr};if(!e.structure&&!f)return{error:Rn};let b=e.structure||lf({drawDefinition:p,structureId:f}).structure;if(!Rr(b))return{error:An};if(!l?.length)return{error:Ja};let w=[...s??[],...b?.matchUps??[]],{encounters:T}=function({matchUps:e}){let t=[];for(let i of e){let e=i.sides.map(Om);if(2===e.length){let[i,r]=e,n=nD(i,r);t.includes(n)||t.push(n)}}return{encounters:t}}({matchUps:w}),D=c?.participants??[],P={};if(d){let e=ar(b?.matchUps?b.matchUps.map((({roundNumber:e})=>e)):[]),t=Math.max(...e,0);if(t){let e=b?.matchUps?.filter((({roundNumber:e})=>e===t)).map((({matchUpId:e})=>e)),i=eD({ratingType:I??U?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:c,asDynamic:!0,refreshDynamic:u,drawDefinition:p,matchUpIds:e});if(i.error)return i;i.modifiedScaleValues&&(P=i.modifiedScaleValues)}}let N,E,{valueObjects:M}=function({encounters:e,tournamentParticipants:t,encounterValue:i,sameTeamValue:r}){let n={};for(let o of e)n[o]||(n[o]=0),n[o]+=i;let a=t?.filter((({participantType:e})=>e===hh));if(a)for(let o of a){let e=o.individualParticipantIds??[],{uniquePairings:t}=aD({participantIds:e});for(let i of t)n[i]||(n[i]=0),n[i]+=r}return{valueObjects:n}}({tournamentParticipants:D,encounterValue:t,sameTeamValue:i,encounters:T}),{uniquePairings:R,possiblePairings:C,deltaObjects:A}=aD({participantIds:l}),k={tournamentParticipants:D,possiblePairings:C,uniquePairings:R,maxIterations:r,adHocRatings:Object.values(P).length?P:e.adHocRatings,deltaObjects:A,valueObjects:M,eventType:g,scaleName:I,salted:S},{candidatesCount:O,participantIdPairings:x,deltaCandidate:F,iterations:L,candidate:_}=sD(k);if(!O)return{error:Vo};if(a){let e=tD({structureId:b?.structureId,ignoreLastRoundNumber:o,participantIdPairings:x,newRound:!0,drawDefinition:p,roundNumber:m,matchUpIds:h,idPrefix:y,isMock:v,event:U});if(e.error)return e;N=e.roundNumber,E=e.matchUps}let{maxDelta:B,maxDiff:V}=_;return{roundNumber:N,participantIdPairings:x,modifiedScaleValues:P,candidatesCount:O,deltaCandidate:F,..._r,iterations:L,matchUps:E,maxDelta:B,maxDiff:V}}function pD(e){let{drawType:t=Yu,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:o,placeByes:s,isMock:c,event:d}=e,u=e?.drawDefinition;if(!u)return{error:Jr};let l=bu,p=Ig({stageSequence:1,drawDefinition:u,stage:l}),m=[ll,Ku,pl].includes(t)?p.length:er(p.length);if(!a&&t===qu&&p.length<2||t===ll&&p.length<3)return{error:fn};let{tieFormat:f,matchUpType:h}=e;if(f){let e=md({tieFormat:f});if(e.error)return e}f=yw(f??Ug({drawDefinition:u})?.tieFormat),h=h??u.matchUpType;let{structures:g}=pf({stageSequence:1,drawDefinition:u,stage:l});if(g.length>1)return{error:Wn};if(g?.[0]?.matchUps?.length)return{error:as};let I=g?.[0]?.structureId;Object.assign(e,Js({structureName:e.structureName??zv(bu),structureId:I,matchUpType:h,tieFormat:f,drawSize:m,stage:l}));let y=$T(e);if(y.error)return y;let v=y.generators[t];if(!v)return{error:sn};let S=v?.();if(S.error)return S;let{structures:U,links:b}=S,w=U.map((e=>oy({structure:e}).matchUps)).flat();f&&w.forEach((e=>{let{tieMatchUps:t}=ab({matchUp:e,tieFormat:f,isMock:c});Object.assign(e,{tieMatchUps:t,matchUpType:h})})),(!r||!i)&&(u=yd(u,!1,!0)),u.links||(u.links=[]),b.length&&u.links.push(...b);let T=U.map((({structureId:e})=>e));u.structures||(u.structures=[]);let D=u.structures.map((({structureId:e})=>e));u.structures=u.structures.map((e=>T.includes(e.structureId)?U.find((({structureId:t})=>t===e.structureId)):e));let P=U.filter((({structureId:e})=>!D.includes(e)));return P.length&&u.structures.push(...P),o&&sU({seedingProfile:e.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:u,structureId:I,placeByes:s,drawSize:m,event:d}),i&&Zf({drawDefinition:u}),{links:b,structures:U,..._r}}var mD={};Oi(mD,{addGame:()=>DD,addPoint:()=>TD,addSet:()=>ND,addShot:()=>PD,analyzeScore:()=>QP,analyzeSet:()=>nN,calculateHistoryScore:()=>SD,checkScoreHasValue:()=>My,checkSetIsComplete:()=>yP,clearHistory:()=>wD,generate:()=>fD,generateScoreString:()=>hD,generateTieMatchUpScore:()=>gw,getSetComplement:()=>eN,getTiebreakComplement:()=>tN,helpers:()=>CD,isValidMatchUpFormat:()=>Ec,keyValueScore:()=>wP,mutate:()=>yD,parseMatchUpFormat:()=>Uc,parseScoreString:()=>rN,query:()=>zP,redo:()=>ED,reverseScore:()=>ID,setServingSide:()=>bD,stringifyMatchUpFormat:()=>gc,tidyScore:()=>HP,umo:()=>RD,undo:()=>MD,validateMatchUpScore:()=>XP,validateScore:()=>ZP,validateSetScore:()=>KP,validateTieFormat:()=>md});var fD={};function hD(e){let{winnerFirst:t=!0,setTBlast:i=!0,addOutcomeString:r,reversed:n=!1,matchUpStatus:a,matchUpFormat:o,autoComplete:s,winningSide:c,sets:d}=e;if(!d)return{error:va,info:"missing sets"};let u=o&&Uc(o),{bestOf:l,finalSetFormat:p,setFormat:m}=u??{},f=n||!(!t||!c||1===c),h=r?function({matchUpStatus:e}){let t={[Km]:"RET",[Qm]:"WO",[Wm]:"DF/DF",[qm]:"WO/WO",[Xm]:"SUS",[_m]:"ABN",[Gm]:"DEF",[$m]:"DR"};return e&&t[e]||""}({matchUpStatus:a}):"",g=d?.sort(gD).map((function(e){let t=l&&e.setNumber===l&&p?p:m,r=e=>Qi(e?.side1Score)||Qi(e?.side2Score),n=(I=e,Qi(I?.side1TiebreakScore)||Qi(I?.side2TiebreakScore)),a=t?.tiebreakSet||!r(e)&&n,{side1Score:o,side2Score:c,side1TiebreakScore:d,side2TiebreakScore:u}=e,h=d||(Qi(d)||n&&s?0:""),g=u||(Qi(u)||n&&s?0:"");var I;if(a){let t=r(e)&&!n,i=t?o:h,a=t?c:g;return`[${(f?[a,i]:[i,a]).join("-")}]`}let y=n?Math.min(h,g):"",v=y===h?1:2,S=Qi(y)?`(${y})`:"",U=o||(Qi(o)||s?0:""),b=c||(Qi(c)||s?0:""),w=e=>i||v!==e?"":S,T=`${U}${w(1)}`,D=`${b}${w(2)}`,P=i&&n?`(${y})`:"",N=f?`${[D,T].join("-")}${P}`:`${[T,D].join("-")}${P}`;return["-"," "].includes(N)&&(N=""),N})).filter(Boolean).join(" ")||"";return h?2===c?`${h} ${g}`:`${g} ${h}`:g}function gD(e,t){return e.setNumber-t.setNumber}function ID(e){if(!e?.score)return{error:va};let{sets:t}=e.score,i=t.map((e=>{let{side1TiebreakScore:t,side2TiebreakScore:i,winningSide:r,side1Score:n,side2Score:a,setNumber:o}=e;return Js({winningSide:r?3-r:void 0,side1TiebreakScore:i,side2TiebreakScore:t,side1Score:a,side2Score:n,setNumber:o})})),r=e?.setTBlast;return{reversedScore:{sets:i,scoreStringSide1:hD({setTBlast:r,sets:i}),scoreStringSide2:hD({sets:i,reversed:!0,setTBlast:r})},..._r}}Oi(fD,{generateScoreString:()=>hD,generateTieMatchUpScore:()=>gw,reverseScore:()=>ID});var yD={};function vD({matchUp:e}){let{extension:t}=Jp({name:lm,element:e});if(!t)return{error:Qo};let{history:i=[],undoHistory:r=[]}=t.value;return{history:i,undoHistory:r,..._r}}function SD(e){if(!e)return{error:va};let{matchUp:t,updateScore:i}=e;if(!t)return{error:sa};let r=vD({matchUp:t})?.history||[];if(!Array.isArray(r))return{error:Ho,info:"history is not an array"};let{matchUpFormat:n}=t;if(!n)return{error:ea};if(!Ec({matchUpFormat:n}))return{error:Zn};let a,o,s=Uc(n),{bestOf:c,finalSetFormat:d,setFormat:u}=s,l=["0","15","30","40","A","G"],p={sets:[]},m=[],f=[0,0],h=1,g=0,I=0,y=e=>[1,2].includes(e),v=()=>(g+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:g,games:[]}),S={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},U={winningSide:void 0,points:[]},b=v(),w=0;for(let T of r){w+=1,o=p.sets.length+1===c;let e=o&&d?d:u,{tiebreakAt:t,setTo:i,NoAD:r,tiebbreakFormat:n}=e,s=b.side1Score===t&&b.side1Score===b.side2Score,g=!!e.tiebreakSet,D=g?e.tiebreakSet:n,{tiebreakTo:P,NoAD:N}=D||{},E=()=>{a=void 0,f=[0,0],h=3-h,b.side1TiebreakScore="",b.side2TiebreakScore="",b.side1PointScore="",b.side2PointScore="",I=0},M=e=>{b.winningSide=e;let{s:t,...i}=b;p.sets.push(i),S={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},U={winningSide:void 0,points:[]},b=v(),E()},R=e=>{U.winningSide=e;let{g:t,...i}=U;b.games.push(i),S={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},U={winningSide:void 0,points:[]},E(),b[`side${e}Score`]+=1},C=e=>{S.winningSide=e;let{p:t,...i}=S;U.points.push(i),S={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},I=0;let n=e-1;if(s||g){f[n]+=1,a=f.reduce(((e,t)=>e+t))%4/4>.5?h:3-h,b[`side${e}TiebreakScore`]=f[n],b[`side${3-e}TiebreakScore`]=f[1-n];let t=N?1:2;if(f[n]>=P&&f[n]>=f[1-n]+t)return R(e),{gameCompleted:!0}}else if(4===f[1-n]&&3===f[n]?f[1-n]-=1:f[n]+=1,b.side1PointScore=l[f[0]],b.side2PointScore=l[f[1]],5===f[n]||4===f[n]&&f[1-n]<3||r&&4===f[n])return R(e),{gameCompleted:!0}};if(y(T.srv)&&(h=T.srv),["p","s","g","o"].includes(T.u)&&m.push(T.u),T.shotOutcome&&(S.shots.push(T),"SERVE"===T.shotType&&["OUT","NET"].includes(T.shotOutcome)&&(I+=1),2===I)){C(3-h)}if(y(T.p)||ir(T.pointNumber)){let e=T.winningSide||T.p;if(C(e)?.gameCompleted)continue}if(y(T.g)||ir(T.gameNumber)){let e=T.winningSide||T.g;U.winningSide=e;let t=`side${e}Score`,n=`side${3-e}Score`;if(m.length&&(m.includes("p"),m=[]),R(e),b[t]===i&&b[t]-b[n]>=(r?1:2)&&(M(e),o))break}if(y(T.s)||ir(T.setNumber)){if(M(T.winningSide||T.s),m.length&&(m.includes("p"),m.includes("g"),m=[]),o)break}}return w!==r.length&&console.log({error:"Match completed with excess history"}),(b.side1Score||b.side2Score||b.games.length||b.side1TiebreakScore||b.side2TiebreakScore)&&p.sets.push(b),p.scoreStringSide1=hD({...p,matchUpFormat:n}),p.scoreStringSide2=hD({...p,matchUpFormat:n,reversed:!0}),h=a||h,i&&(t.score=p),{..._r,servingSide:h,score:p}}function UD({undoHistory:e,history:t,matchUp:i}){return Vp({element:i,extension:{value:{history:t,undoHistory:e},name:lm}})}function bD({matchUp:e,sideNumber:t}){if(![1,2].includes(t))return{error:ga};let{history:i=[]}=vD({matchUp:e});return i.push({srv:t}),UD({matchUp:e,history:i})}function wD({matchUp:e}){return UD({matchUp:e})}function TD({matchUp:e,point:t}){if(!t||!e)return{error:va};if("object"!=typeof t)return{error:Ho,context:{point:t}};let{history:i=[]}=vD({matchUp:e});return i.push(t),UD({matchUp:e,history:i})}function DD({matchUp:e,game:t}){if("object"!=typeof t)return{error:Ho,context:{game:t}};let{history:i=[]}=vD({matchUp:e});return i.push(t),UD({matchUp:e,history:i})}function PD({matchUp:e,shot:t}){if("object"!=typeof t)return{error:va};let{history:i=[]}=vD({matchUp:e});return i.push(t),UD({matchUp:e,history:i})}function ND({matchUp:e,set:t}){if("object"!=typeof t)return{error:va};let{history:i=[]}=vD({matchUp:e});return i.push(t),UD({matchUp:e,history:i})}function ED({matchUp:e}){let{history:t=[],undoHistory:i=[]}=vD({matchUp:e});return i.length&&t.push(i.pop()),UD({matchUp:e,history:t,undoHistory:i})}function MD({matchUp:e}){let{history:t=[],undoHistory:i=[]}=vD({matchUp:e});return i.push(t.pop()),UD({matchUp:e,history:t,undoHistory:i})}Oi(yD,{addGame:()=>DD,addPoint:()=>TD,addSet:()=>ND,addShot:()=>PD,calculateHistoryScore:()=>SD,clearHistory:()=>wD,redo:()=>ED,setServingSide:()=>bD,umo:()=>RD,undo:()=>MD});var RD={},CD={};Oi(CD,{keyValueScore:()=>wP,parseMatchUpFormat:()=>Uc,stringifyMatchUpFormat:()=>gc,tidyScore:()=>HP});var AD="COMPLETED",kD=["RET","DEF","WO","WO/WO","ABN","SUS","INT"],OD="DEFAULTED",xD="WALKOVER",FD="ABANDONED",LD="SUSPENDED",_D="RETIRED",BD="INTERRUPTED",VD=[_D,OD,xD],jD="()",$D="[]",GD=["up","left","shift+tab"],WD=["enter","down","tab","right"],qD="backspace",HD="r",zD="s",YD="a",KD="d",XD="w",JD="i",QD=[HD,KD,XD,YD,zD,JD],ZD="space",eP=["[","("],tP=[...GD,...WD,ZD,"]"],iP="-",rP="-",nP=["/"],aP=0,oP=["0","1","2","3","4","5","6","7","8","9"].concat(QD),sP=oP.map((e=>`shift+${e}`)),cP=[iP,qD].concat(tP,nP),dP=[oP,sP,cP].join(","),uP=[dP,GD,WD,["=","+","num_1","num_2","shift+=","shift+-"]].join(","),lP={OUTCOMEKEYS:QD,SIDE1KEYS:oP,SIDE2KEYS:sP,MODIFIERS:cP,PROMPT:"Enter Score",MOVEUP:GD,MOVEDOWN:WD,HOTKEYS:uP};function pP({scoreString:e,lowSide:t,outcome:i}){if(({scoreString:e}=mP({scoreString:e})),2===t){return e+(" "!==(e&&e[e.length-1])?" ":"")+i}return i+" "+e}function mP({scoreString:e}){if(!e)return{scoreString:""};let t=!1;for(let i of kD){let r=e?.indexOf(i);0===r?e=e.slice(i.length+1).trim()+" ":r>0&&(e=e.slice(0,r)),r>=0&&(t=!0)}return e?.trim()||(e=""),{scoreString:e,removed:t}}function fP({analysis:e,scoreString:t,sets:i,lowSide:r}){let n,a;if(!t)return{scoreString:t,sets:i};let{scoreString:o,removed:s}=mP({scoreString:t});if(t=o,s)return{scoreString:t,sets:i,outcomeRemoved:!0};let c=i[i.length-1]||{},d=Object.values(c).filter((e=>void 0!==e)).length;c.setNumber&&1===d&&(c=(i=i.slice(0,i.length-1))[i.length-1]||{});let{tiebreakSet:u}=e.setFormat,{tiebreakTo:l,NoAD:p}=u||{},{isTiebreakEntry:m}=hP({brackets:$D,scoreString:t}),f=function(e){return e.split("").reduce(((e,t,i)=>(t.match(/\d+/g)&&e.push(i),e)),[]).pop()}(t);if(f>=0){n=t.slice(0,f);let{isTiebreakEntry:o}=hP({brackets:jD,scoreString:n}),{lastOpenBracketIndex:s,isTiebreakEntry:d}=hP({brackets:$D,scoreString:n}),u=n&&n[n.length-1].trim(),h=n&&!isNaN(u),g=e.isIncompleteSetScore;if(m&&d){let e=n.slice(s+1).split(rP),i=e?.length>0&&void 0!==e[0]&&!isNaN(parseInt(e[0]))&&parseInt(e[0])||void 0,a=e?.length>1&&void 0!==e[1]&&parseInt(e[1])||void 0,o=[i,a];if(a){let e=1===r?1:0;o[e]=(o?.[1-e]||0)+(p?1:2),(o[e]||0)<l&&(o[e]=l),n=t.slice(0,s+1),n+=o.join(rP)}else void 0!==i?(n=t.slice(0,s+1),n+=i):(n=t.slice(0,s),g=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(n.length||(n=void 0),g){let t=c.side1Score?.toString();if(t){let e=t?.slice(0,t.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}e.isTimedSet?(a=c.side1Score?i:i?.slice(0,i.length-1)||[],a[i.length-1]=c):a=i?.slice(0,i.length-1)||[]}else if(h){let t=c.side2Score?.toString(),r=c.side1Score?.toString();if(!e.isTiebreakEntry&&!e.isMatchTiebreak)if(c.side2Score){let e=t?.slice(0,t.length-1);c.side2Score=!isNaN(e)&&parseInt(e)||void 0}else{let e=r?.slice(0,r.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0}e.isTimedSet?c.side1Score?(a=i||[],a[i.length-1]=c):a=i?.slice(0,i.length-1)||[]:(a=i||[],a[i.length-1]=c),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else o?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(m&&!d?a=i?.slice(0,i.length-1)||[]:(a=i,a[i.length-1]=c),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:t,sets:i}}function hP({brackets:e=jD,scoreString:t}){if(!t)return{};let[i,r]=e.split(""),n=t.split(""),a=Math.max(...Ir(i,n));return{isTiebreakEntry:a>Math.max(...Ir(r,n)),lastOpenBracketIndex:a}}function gP(e){let{lowValue:t=0,NoAD:i=!1,tiebreakTo:r}=e||{};return t+1>=r?t+(i?1:2):parseInt(r)}function IP({matchUpFormat:e,matchUpStatus:t,winningSide:i,sets:r}){let n=Uc(e),{bestOf:a}=n,o=Math.ceil(a/2),s=r?.reduce(((e,t)=>{let{winningSide:i}=t;return i&&e[i-1]++,e}),[0,0])?.indexOf(o)+1||void 0;return VD.includes(t)&&i&&(s=i),{matchUpWinningSide:s}}function yP({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,isTimedSet:a,set:o}){if(!o)return{error:va,info:"missing set"};t=t||i&&Uc(i);let s=n&&t.finalSetFormat||t?.setFormat||{},{side1Score:c,side2Score:d}=o,{setTo:u,tiebreakAt:l}=s,p=c||d,m=vP({set:o}),f=Math.abs(c-d),h=c>=u||d>=u,g=r||c>=u&&d>=u||l&&l<u&&(c===l||d===l),I=e||g&&(1===m&&o.side1TiebreakScore>o.side2TiebreakScore||2===m&&o.side2TiebreakScore>o.side1TiebreakScore),y=!g&&s.NoAD||g||r&&s.tiebreakFormat?.NoAD?1:2;return!(!(a&&p||h&&(f>=y||g)||r)||g&&!I)}function vP({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}function SP({analysis:e,set:t}){let i=vP({set:t}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=e;return yP({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:t})&&i}function UP({lowSide:e,value:t,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return t===HD?r?(o=!0,r=pP({scoreString:r,lowSide:e,outcome:"RET"}),n=2===e?1:2,a=_D):(o=!0,r=pP({scoreString:r,lowSide:e,outcome:"DEF"}),n=2===e?1:2,a=OD):t===KD?(o=!0,r=pP({scoreString:r,lowSide:e,outcome:"DEF"}),n=2===e?1:2,a=OD):t===XD?(o=!0,i=[],r="WO",n=2===e?1:2,a=xD):t===zD&&r?(o=!0,r=pP({scoreString:r,lowSide:e,outcome:"SUS"}),a=LD,n=void 0):t===YD?(o=!0,r=pP({scoreString:r,lowSide:e,outcome:"ABN"}),a=FD,n=void 0):t===JD&&r&&(o=!0,r=pP({scoreString:r,lowSide:e,outcome:"INT"}),a=BD,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function bP({matchUpFormat:e,scoreString:t,winningSide:i,value:r,sets:n}){let a=(n?.filter((e=>e?.winningSide))?.length||0)+(i?0:1),o=Uc(e),s=a===o?.bestOf,c=s&&o?.finalSetFormat||o?.setFormat||{},d=c?.timed,u=s&&n[o?.bestOf-1],l=u?.winningSide,{isTiebreakEntry:p}=hP({brackets:jD,scoreString:t}),{isTiebreakEntry:m}=hP({brackets:$D,scoreString:t}),f=p||m,h=!!c.tiebreakSet,g=t?.[t.length-1]?.trim(),I=t&&!isNaN(g),y=!f&&g===iP,v=p&&eP.includes(g),S=m&&eP.includes(g),U=m&&g===rP,b=t?.split(""),[w]=$D.split(""),T=b&&Math.max(...Ir(w,b)),D=b&&Math.max(...Ir(rP,b)),P=b&&D>T,N=n[n.length-1]?.winningSide,E=n?.length&&!N,M=kD.find((e=>t?.indexOf(e)>=0)),R=!isNaN(r),C=r===ZD,A=tP.includes(r),k=t?.split("").find((e=>eP.includes(e))),O=A&&m&&!S&&(U||!function({scoreString:e}){if(!e)return!1;let t=e&&e[e.length-1].trim(),i=e&&!isNaN(t),[r,n]=$D.split(""),a=e.split(""),o=Math.max(...Ir(r,a)),s=Math.max(...Ir(n,a)),c=Math.max(...Ir(rP,a));return i&&o>s&&c>o}({scoreString:t}));return{isTiebreakSetValue:h&&R,matchUpScoringFormat:o,setNumber:a,setFormat:c,matchTiebreakHasJoiner:P,isGameScoreEntry:E,isSpace:C,isCloser:A,isTiebreakCloser:A&&k&&f&&I,isDecidingSet:s,isTiebreakSet:h,isTimedSet:d,isNumericEnding:I,isNumericValue:R,hasOpener:k,hasOutcome:M,finalSet:u,finalSetIsComplete:l,lastSetIsComplete:N,isInvalidSetTiebreakValue:C&&f&&v,isInvalidMatchTiebreakValue:O,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:m,isIncompleteSetScore:y,isIncompleteSetTiebreak:v,isIncompleteMatchTiebreak:S,isPartialMatchTiebreakValue:U}}function wP(e){let t,i,{lowSide:r=1,value:n}=e,{scoreString:a,sets:o,winningSide:s,matchUpStatus:c}=e,{matchUpFormat:d,shiftFirst:u,auto:l=!0}=e,p=u&&2===r||!u&&1===r;if(!dP.includes(n))return{updated:!1,info:"invalid key"};u&&(r=3-r);let{matchUpWinningSide:m}=IP({sets:o,winningSide:s,matchUpStatus:c,matchUpFormat:d});s=m;let f=bP({value:n,winningSide:s,scoreString:a,sets:o,matchUpFormat:d});if(nP.includes(n)&&(n=iP),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===zi(n)&&(f.isTiebreakCloser=!0),tP.includes(n)&&f.hasOpener&&(n=""),tP.includes(n)&&(n=ZD),f.lastSetIsComplete){let e=a?.length&&a[a.length-1];a&&" "!==e&&(a+=" ")}if(f.isTimedSet)({info:i,sets:o,scoreString:a,updated:t,matchUpStatus:c,winningSide:s}=function(e){let t,i,{sets:r,info:n,scoreString:a,winningSide:o,matchUpStatus:s}=e,{analysis:c,lowSide:d,value:u}=e;!r?.length&&u!==qD&&(r=[{setNumber:1}]);let l=r.length-1;if(QD.includes(u)){let e=r[r.length-1]||{},{side1Score:i,side2Score:l}=e;i&&!l?n="missing side2Score":c.finalSetIsComplete||o?n="final set is already complete":c.isIncompleteSetScore?n="incomplete set scoreString":c.isIncompleteSetScore||({sets:r,scoreString:a,winningSide:o,matchUpStatus:s,updated:t}=UP({lowSide:d,value:u,sets:r,scoreString:a,matchUpStatus:s,winningSide:o}))}else if(u===qD){if(({scoreString:a,sets:r,outcomeRemoved:i}=fP({analysis:c,scoreString:a,sets:r})),""===a?.trim()&&(a=a.trim()),a||(r=[]),i){let e=r[r.length-1]||{},{side1Score:t,side2Score:i}=e;if(t&&i){let n=(t>i?1:i>t&&2)||void 0;n&&(e.winningSide=n,r.push({setNumber:r.length+1}))}}s=void 0,o=void 0,t=!0}else if(c.hasOutcome)n="has outcome";else{if(o)return{sets:r,scoreString:a,winningSide:o,matchUpStatus:s,updated:!1,info:"matchUp is complete"};if(u===ZD){let e=r[r.length-1]||{},{side1Score:i,side2Score:n}=e,s=(i>n?1:n>i&&2)||void 0;s&&!o&&!c.isIncompleteSetScore&&(r[r.length-1].winningSide=s,r.push({setNumber:r.length+1}),a+=" ",t=!0)}else if(u===iP&&void 0!==r[l].side1Score&&void 0===r[l].side2Score&&a&&c.isNumericEnding)a+="-",r[l].side2Score=0,s=void 0,o=void 0,t=!0;else if(!isNaN(u)){let e;if(void 0===r[l].side2Score){let i=zi((r[l].side1Score||0).toString()+u).toString().slice(0,2);r[l].side1Score=zi(i),e=r[l].side1Score.toString(),t=!0}else{let i=zi((r[l].side2Score||0).toString()+u).toString().slice(0,2);r[l].side2Score=zi(i),e=[r[l].side1Score,r[l].side2Score].join("-"),t=!0}if(t){let t=(r.slice(0,l)||[]).filter((e=>e)).map((e=>{let{side1Score:t,side2Score:i}=e;return[t,i].join("-")})).join(" ");a=t?t+" "+e:e}}}return{sets:r,scoreString:a,winningSide:o,matchUpStatus:s,info:n,updated:t}}({analysis:f,lowSide:r,scoreString:a,sets:o,matchUpStatus:c,winningSide:s,value:n}));else if(QD.includes(n))f.finalSetIsComplete||s?i="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?i="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:n}):({sets:o,scoreString:a,matchUpStatus:c,winningSide:s,updated:t}=UP({lowSide:r,sets:o,scoreString:a,matchUpStatus:c,winningSide:s,value:n}));else if(n===qD)t=!0,({scoreString:a,sets:o}=fP({analysis:f,scoreString:a,sets:o,lowSide:r})),a||(o=[]),c=void 0,s=void 0;else if(f.hasOutcome)i="has outcome";else if(n!==iP||f.isMatchTiebreakEntry)if(n===rP&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?i="existing joiner":f.isNumericEnding&&(t=!0,a+=rP);else if([iP,rP].includes(n))i="invalid location for joiner";else{if(s)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:o,scoreString:a,updated:t}=function({analysis:e,scoreString:t,sets:i,value:r}){let n;if(!i?.length)return{sets:[]};let a=i[i.length-1];r=zi(r);let{validSide2Score:o,requiresTiebreak:s}=function({analysis:e,set:t={},value:i}){let r,n,a=e.isDecidingSet&&e.matchUpScoringFormat.finalSetFormat||e.matchUpScoringFormat.setFormat,{tiebreakAt:o,setTo:s,NoAD:c}=a,{side1Score:d}=t;return r=o&&o<s?d===o?i<=s:i<=o:d===s?c?i<s:i<=s+1:d===s-1?c?i<=s:i<=s+1:d===s+1?i===s||i===s-1:i<=s,r&&(n=o&&o<s?d===s&&i===o||d===o&&i===s:d>=s&&i>=s&&d!==i),{validSide2Score:r,requiresTiebreak:n}}({analysis:e,set:a,value:r});if(o){n=!0,t=(t||"")+r,a.side2Score=r;let o=SP({analysis:e,set:i[i.length-1]});a.winningSide=o||void 0,s?t+=jD.split("")[0]:e.isDecidingSet||(t+=" ")}return{sets:i,scoreString:t,updated:n}}({analysis:f,scoreString:a,sets:o,value:n}));else if(f.isInvalidMatchTiebreakValue)i="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)i="invalid set tiebreak character";else if(f.isTiebreakCloser){let e=f.isSetTiebreakEntry?jD:$D,i=e.split("").reverse()[0],r=e.split("")[0],n=o[o.length-1],{tiebreakFormat:s}=f.setFormat,{tiebreakTo:c,NoAD:d}=s||{},u=vP({set:n});if(!f.isTiebreakSet){let e=Number.parseInt(a.split(r).reverse()[0]),t=gP({lowValue:e,tiebreakTo:c,NoAD:d});1===u?(n.side1TiebreakScore=t,n.side2TiebreakScore=e):(n.side1TiebreakScore=e,n.side2TiebreakScore=t)}a=(a||"")+i,f.isDecidingSet||(a+=" ");let l=SP({analysis:f,set:n});n.winningSide=l||void 0,t=!0}else if(f.isTiebreakSetValue)({info:i,scoreString:a,sets:o,updated:t}=function({analysis:e,auto:t,lowSide:i,scoreString:r="",sets:n,value:a}){let o,s,{tiebreakSet:{tiebreakTo:c,NoAD:d}}=e.setFormat,[u]=$D.split("");if(e.isMatchTiebreakEntry||(r+=u),n[e.setNumber-1]){let{lastOpenBracketIndex:e}=hP({brackets:$D,scoreString:r}),u=(r.slice((e??0)+1)+(t?"":a)).split(rP);if((u[i-1]?.length||0)>=2)s="tiebreak digit limit";else if(t){1===i&&(u[0]=(u[0]||"")+a),2===i&&(u[1]=(u[1]||"")+a);let t=[u[0]||0,u[1]||0].map((e=>zi(e))),s=1===i?1:0;t[s]=t[1-s]+(d?1:2),t[s]<c&&(t[s]=c);let l=n[n.length-1];l.side1TiebreakScore=t[0],l.side2TiebreakScore=t[1],r=r.slice(0,(e??0)+1),r+=t.join(rP),o=!0}else{let e=[u[0]||0,u[1]||0].map((e=>zi(e))),t=n[n.length-1];t.side1TiebreakScore=e[0],t.side2TiebreakScore=e[1],r+=a,o=!0}}else{let e=gP({lowValue:zi(a||0),tiebreakTo:c,NoAD:d}),t=[zi(a),e];2===i&&t.reverse();let s={side1TiebreakScore:t[0],side2TiebreakScore:t[1],setNumber:n?.length+1||1};n.push(s),r+=t.join(rP),o=!0}return{info:s,scoreString:r,sets:n,updated:o}}({analysis:f,auto:l,lowSide:r,scoreString:a,sets:o,value:n}));else if(f.isSetTiebreakEntry){let[e]=jD.split(""),r=Math.max(...Ir(e,a.split(""))),o=a.slice(r+1),s=o&&zi(o)===aP,c=zi(o?o+n:n),{tiebreakFormat:d}=f.setFormat,{tiebreakTo:u,NoAD:l}=d||{};!s&&o.length<2?l&&c>u-1?i="invalid low value for NoAD tiebreak":(t=!0,a=(a||"")+n):i=s?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)i=`invalid key: ${n}`;else if(f.isGameScoreEntry)i="game scoreString entry";else if(f.lastSetIsComplete||!o.length){t=!0;let{scoreString:e,set:i}=function({analysis:e,lowSide:t,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=e?.setFormat||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let c=[r,s?r+1:r+1===n?r+(o?1:2):n];2===t&&c.reverse();let d=jD.split("")[0];i=(i||"")+(c.join(iP)+(s?d:" "));let u={side1Score:c[0],side2Score:c[1]},l=SP({analysis:e,set:u});return u.winningSide=l||void 0,{scoreString:i,set:u}}({analysis:f,lowSide:r,scoreString:a,value:zi(n)});i&&(i.setNumber=o?.length+1||1),o=o?.concat(i).filter(Boolean)||[i],a=e||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(t=!0,({scoreString:a,sets:o}=fP({analysis:f,scoreString:a,sets:o,lowSide:r})),c=void 0);if(t){o=o?.filter(Boolean);let{matchUpWinningSide:e}=IP({sets:o,winningSide:s,matchUpStatus:c,matchUpFormat:d});return s=e,!e||c&&![Jm,zm].includes(c)?a&&!s&&![LD,FD,BD].includes(c)&&(c=void 0):(c=AD,o=o.filter((e=>{let{side1Score:t,side2Score:i,side1TiebreakScore:r,side2TiebreakScore:n}=e;return t||i||r||n}))),{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:c,info:i}}return{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:c,info:i}}var TP="\\d+-\\d+",DP="\\d+-\\d+\\(\\d+\\)",PP="\\[\\d+-\\d+\\]",NP=new RegExp(`(${TP}),`,"g"),EP=new RegExp(`(${DP}),`,"g"),MP=[TP,DP,PP,"\\d+-\\d+\\(\\d+-\\d+\\)"],RP=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map((e=>{let t=e.split("").map((e=>MP[e])).join(" ");return new RegExp(`^${t}$`)}));function CP(e){return!e||RP.some((t=>t.test(e)))}function AP(e){return/^\(\d+\)$/.test(e)||/^\(\d+$/.test(e)}function kP(e){let t=(i=e,i?.split("-").join("").split("/").join(""));var i;if(/^\d+$/.test(t)&&2===t.length){let e=t.split("");return 1===Math.abs(e.reduce(((e,t)=>+e-+t)))}return!1}function OP(e,t){let i=[e.slice(t,t+2),t?e.slice(0,1):e.slice(2)].map((e=>parseInt(e.join(""))));t&&i.reverse();let r=i;if(Math.abs(r.reduce(((e,t)=>+e-+t)))>=2)return r.join("-")}function xP(e){return 2===e.length?e.split("").join("-"):([", ",",","/"," "].forEach((t=>e=e.split(t).join("-"))),e=e.replace(/-{2,}/,"-"))}function FP(e){return e.startsWith("(")&&e.endsWith(")")}function LP(e){if(!/^[\d-]+(\(\d\))*$/.test(e))return e;let t=Ir("-",e.split(""));if(!t.length)return e;let i=e.split("-"),r=!(i.length%2),n=!!(t.length%2);return r&&n&&t.length>i.length/2&&t.filter(((e,t)=>t%2)).forEach((t=>{e=e.substring(0,t)+" "+e.substring(t+1)})),e}function _P({score:e}){let t,i=e.split(""),r=[],n=()=>t=[void 0,void 0,void 0],a=()=>{let e=`${t[0]}-${t[1]}`;return t[2]&&(e+=` (${t[2]})`),n(),t.push(t),e};n();let o=()=>void 0!==t[0]&&void 0!==t[1]&&Math.abs(parseInt(t[0])-parseInt(t[1]));for(;i.length;){let e=i.shift(),n=Qi(e)&&parseInt(e),s=void 0!==t[0]&&void 0!==t[1];if(Qi(n)){if(void 0===t[0]){t[0]=n;continue}if(void 0===t[1]&&(t[1]=n,o())){r.push(a()),t=[void 0,void 0];continue}if(s&&1===i.length&&Qi(i[0])){let e=i.pop();t[0]=t[0].toString()+t[1].toString(),t[1]=e,r.push(a()),t=[void 0,void 0]}s&&o()}}return{sets:r}}function BP(e){let t=e.indexOf("1"),i=e.split(""),r=i.every((e=>!isNaN(e)));if(r&&3===e.length&&0===t){let e=OP(i,t);if(e)return e}if(r&&7===e.length&&t>3){let e=OP(i.slice(4),t-4);if(e)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${e}`}}function VP(e){let{score:t}=e,{applied:i,matchUpStatus:r}=e,n=t?.toString().split(""),a=n?.every((e=>Qi(e))),o=e=>Math.abs(e[0]-e[1]);if("number"==typeof t||a){t=t.toString().toLowerCase(),a&&(t=n.join(""));let e=a?n.map((e=>parseInt(e))):t.split("").map((e=>parseInt(e))),{sets:r}=_P({score:t});if(e.length,3===t.length&&1===o(e.slice(0,2))){let[r,n,a]=e;t=`${r}-${n}(${a})`,i.push("numericTiebreakPattern1")}else if(3===t.length&&1===e[0]){let[r,n,a]=e;t=`[${r}${n}-${a}]`,i.push("numericTiebreakPattern2")}else if(4===t.length&&1===o(e.slice(0,2))&&"987654".split("").includes(e[0].toString())){let[r,n,a,o]=e;t=`${r}-${n}(${Math.min(a,o)})`,i.push("numericTiebreakPattern3")}else if(4===t.length&&1===e[0]&&1===e[2]){let[r,n,a,o]=e;t=`[${r}${n}-${a}${o}]`,i.push("bigSuper")}else if(4===t.length){let[r,n,a,o]=e;t=`${r}${n} ${a}${o}`,i.push("split4")}else if(5===t.length&&1===o(e.slice(0,2))){let[r,n,a,o,s]=e;t=`${r}-${n}(${a}) ${o}-${s}`,i.push("numericTiebreakPattern4")}else if(5===t.length&&1===o(e.slice(3))){let[r,n,a,o,s]=e;t=`${r}-${n} ${a}-${o}(${s})`,i.push("numericTiebreakPattern5")}else if(7===e.length)if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===e[4]){let[r,n,a,o,s,c,d]=e;t=`${r}-${n} ${a}-${o} [${s}${c}-${d}]`,i.push("numericTiebreakPattern6")}else if(1===o(e.slice(0,2))&&o(e.slice(3,5))>1&&o(e.slice(5,7))>1){let[r,n,a,o,s,c,d]=e;t=`${r}-${n}(${a}) ${o}-${s} ${c}-${d}`,i.push("numericTiebreakPattern7")}else if(o(e.slice(0,2))>1&&1===o(e.slice(2,4))&&o(e.slice(5,7))>1){let[r,n,a,o,s,c,d]=e;t=`${r}-${n} ${a}-${o}(${s}) ${c}-${d}`,i.push("numericTiebreakPattern8")}else if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===o(e.slice(4,6))){let[r,n,a,o,s,c,d]=e;t=`${r}-${n} ${a}-${o} ${s}-${c}(${d})`,i.push("numericTiebreakPattern9")}else t=t.slice(0,2)+" "+t.slice(2,4)+" "+t.slice(4),i.push("numericMatchTiebreakPattern");else if(t.length%2){let e=BP(t);e&&t!==e&&i.push("parsedSuperPattern"),t=e??t}else{let r=wr(t.split(""),2).map((e=>e.join(""))),n=r.map((e=>{let[t,i]=e.split("").map((e=>parseInt(e))),r=t>i?1:2;return Math.abs(t-i)>1&&r||-1*r})),a=n.reduce(((e,t)=>e>0&&t>0),1),o=dr(n),s=dr(n.map((e=>Math.abs(e)))),c=n[0]<0,d=!c&&n[1]<0;if(n[0]>0&&n[1]>0&&n[0]!==n[1])t=[r.slice(0,2).join(" "),r.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(a)t=r.join(" "),i.push("chunkSplit");else if(6===e.length){if(2===o[1]||2===o[2])if(Object.values(s).includes(3)){let[r,a,o,s,c,d]=e,u=n.reduce(((e,t,i)=>t<0?i:e),void 0);if(0===u){t=`${r}-${a}(${Math.min(o,s)}) ${c}-${d}`,i.push("chunkSplitTiebreak1")}else if(1===u){t=`${r}-${a} ${o}-${s}(${Math.min(c,d)})`,i.push("chunkSplitTiebreak2")}else t=`${r}-${a} ${o}-${s}`,i.push("chunkSplitTrimExtraneous")}else t=r.join(" "),i.push("chunkSplit")}else if(8===e.length){let[i,r,a,o,s,u,l,p]=e;c||d?1===e[5]&&(t=c?`${i}-${r}(${a}) ${o}-${s} [${u}${l}-${p}]`:`${i}-${r} ${a}-${o}(${s}) [${u}${l}-${p}]`):(n[0],n[1])}}}return{score:t,applied:i,matchUpStatus:r}}function jP(e){let t=[0,0],i=[],r=e.split(" "),n=/(\d+)-(\d+)/;r.forEach((e=>{if(n.test(e)){let r=e.match(n).slice(1).map((e=>parseInt(e))),a=r[0]>r[1]?1:r[1]>r[0]&&2;a&&(t[a-1]+=1,i.push(a))}}));let a=t[0]>t[1]?1:t[1]>t[0]&&2,o=t[0]>0&&t[0]===t[1],s=t.reduce(((e,t)=>e+t),0);return{setsWon:t,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}var $P={handleTiebreakSlashSeparation:function({score:e}){let t=new RegExp(/\(\d+\/\d+\)/g),i=e.match(t);for(let r of i||[]){let t=r.replace("/","-");e=e.replace(r,t)}return{score:e}},handleSetSlashSeparation:function({score:e}){return new RegExp(/-\d+\/\d+-/).test(e)&&(e=e.split("/").join(" ")),{score:e}},punctuationAdjustments:function({score:e,applied:t}){e=function(e){let t="[];()",i=["[","("],r=Object.assign({},...t.split("").map((e=>({[e]:0})))),n="",a=e.split("").map((e=>{let a=t.includes(e)&&e,o=i.includes(a);if(o&&a)return r[a]+=1,n=a,e;if(!o&&a&&n&&a!==n){r[n]-=1;let e=("[];".includes(n)?"[];":"()".includes(n)&&"()")||"",t=e.split("").find((e=>e!==n));if(!e.includes(a))return r[a]||(n=""),t;r[n]||(n="")}return e})).join("");return e!==a?a:e}(e);let i=/\)(\d+)/g;if(i.test(e))for(let S of e.match(i)){let t=S.replace(")",") ");e=e.replace(S,t)}let r=/\(([\d- ]+)\)/,n=(e=(e=e.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);for(let S of n||[]){let[t]=S.match(r).slice(1),i=t.replace(/ /g,"");e=e.replace(S,`(${i})`)}let a=/\(\(\d-\d\)\)/g;if(a.test(e)){let t=e.match(a);t.length&&t.forEach((t=>{let i=t.match(/\((\(\d-\d\))\)/).slice(1)[0];e=e.replace(t,i)}))}if(a=/\(\((\d)\)\)/g,a.test(e)){let t=e.match(a);t.length&&t.forEach((t=>{let i=t.match(/\((\(\d\))\)/).slice(1)[0];e=e.replace(t,i)}))}/(^|\s)6-,/.test(e)&&(e=e.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);e=e.replace(o,"-"),["- "," -"].forEach((t=>{let i=new RegExp(`(\\d+)${t}(\\d+)`,"g"),r=e.match(i);r&&r.forEach((i=>e=e.replace(i,i.split(t).join("-"))))})),/^[(-/,]+$/.test(e)&&(e=""),/\)[-/,]+$/.test(e)&&(e=e.slice(0,e.length-1)),/\d \/\d/.test(e)&&(e=e.replace(/ \//g,"/")),e.includes(" /")&&(e=e.replace(/ \//g," "));let s=/\(\d+, \)/g;s.test(e)&&e.match(s).forEach((t=>{let[i]=t.match(/\((\d+), \)/).slice(1);2===i.length?e=e.replace(t,`(${i})`):1===i.length&&"6"===i&&(e=e.replace(t,"(6-0)"))}));let c=/\((\d+)\/\)/g;c.test(e)&&e.match(c).forEach((t=>{let[i]=t.match(/\((\d+)\/\)/).slice(1);e=2===i.length?e.replace(t,`(${i})`):1===i.length&&"6"===i?e.replace(t,"(6-0)"):e.replace(t,`(${i})`)}));let d=/\d\/\d\/,/g;d.test(e)&&e.match(d).forEach((i=>{let[r]=i.match(/(\d\/\d)\/,/).slice(1);e=e.replace(i,`${r},`),t.push("slashComma")}));let u=/\(\/(\d+)\)/g;u.test(e)&&e.match(u).forEach((t=>{let[i]=t.match(/\(\/(\d+)\)/).slice(1);e=2===i.length?e.replace(t,`(${i})`):1===i.length&&parseInt(i)<6?e.replace(t,`(6-${i})`):e.replace(t,`(${i})`)}));let l,p,m,f,h,g=()=>{h=dr(e.split("")),p=h["("]===(h[")"]||0)+1,l=(h["("]||0)+1===h[")"],m=h["["]===h["]"]+1,f=p&&!m};g();let I=/(\d+-\d+\(\d+)0,/;if(I.test(e)){let[t]=e.match(I).slice(1);e=e.replace(I,t+")")}if(h["("]===h[")"]&&h["("]>1){let t=e.split(")(").join(") (").split(" ");e=t.every(FP)?t.map((e=>{let t=e.slice(1,e.length-1);return t.length>2?t:e})).join(" "):t.join(" ")}g();let y=/[A-Za-z]+/.test(e),v=/\d+/.test(e);if(!y&&!v)return{score:""};if(/^\[.+\]$/.test(e)&&"()/,- ".split("").some((e=>h[e]))&&(e=e.slice(1,e.length-1)),/^\(.+\)$/.test(e)&&1===h["("]&&1===h[")"]&&"[]/,".split("").some((e=>h[e]>1))&&(e=e.slice(1,e.length-1)),e.startsWith("(")&&e.endsWith("))")&&(e=e.slice(1,e.length-1)),h["("]>(h[")"]||0)&&"("===e[e.length-1]&&(e=e.slice(0,e.length-1)+")",g()),1===h["("]&&!h[")"]&&"("===e[0]&&(e+=")",g()),h["("]>(h[")"]||0)&&"(("===e.slice(0,2)&&(e=e.slice(1)),l){if(/^9\d/.test(e))e="("+e.slice(1);else if("("!==e[0])e="("+e;else{let t=[],i=0;for(let r of e.split("").reverse())")"===r&&(i?t.push("("):i+=1),"("===r&&(i-=1),t.push(r);t.reverse(),e=t.join("")}g()}if(h[")"]>(h["("]||0)&&")"===e[0]&&(e="("+e.slice(1),g()),f&&(e.endsWith(9)||/\d+0$/.test(e))&&(e=e.slice(0,e.length-1)+")",g()),f&&(!e.endsWith(")")||e.startsWith("(("))&&(e+=")",g()),f){let t="",i=0;for(let r of e.split(""))"("===r&&(i?t+=")":i+=1),")"===r&&(i-=1),t+=r;e=t}if(g(),m&&!p&&(e+="]"),e.includes("([")&&e.includes("])")&&(e=e.split("([").join("[").split("])").join("]"),g()),/\(\d+0$/.test(e)&&(e=e.slice(0,e.length-1)+")"),g(),1===h[")"]&&!h["("]&&e.endsWith(")")&&(e=e.slice(0,e.length-1)),e.startsWith("(")&&e.endsWith(")")&&1===h["("]&&1===h[")"]&&(e=e.slice(1,e.length-1),g()),/^\([\d ]+.*[\d ]+\)$/.test(e)&&h["("]===h[")"]){let t=e.slice(1,e.length-1);(e=>{let t=e.indexOf("("),i=e.indexOf(")");return t>=0&&i>=0&&t<i})(t)&&(e=t,g())}return{score:e,applied:t}},handleGameSeparation:function({score:e}){let t=new RegExp(/^\d+\/\d+/),i=e.split(" ");i.some((e=>t.test(e)))&&(e=i.map((e=>t.test(e)?e.replace("/","-"):e)).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(e)){let[t,i]=e.match(r).slice(1);e=[t,i].join("-")}return{score:e}},joinFloatingTiebreak:function({score:e}){if("string"!=typeof e)return{score:e};let t=e=>e?.split("-").join("").split("/").join(""),i=e=>e.split("[").join("(").split("]").join(")"),r=(e=e.split(", ").join(" ")).split(" ");e=r.map((e=>{let t=/^-(\d+)$/;if(t.test(e)){let[i]=e.match(t).slice(1);if(2===i.length)return i.split("").join("-")}return e})).join(" "),r=e.split(" ");let n=r.filter(AP),a=0,o="";for(let p of n){let e=Ir(p,r).filter((e=>!a||e>a))[0],i=r.slice(a,e-1),n=r[e-1],s=t(n);if(/^\d+$/.test(s)&&2===s.length){let t=s.split(""),r=Math.abs(t.reduce(((e,t)=>+e-+t)));if(1===r){o+=[i.join(" "),[n,p].join("")].join(" "),a=e+1}else if(0===r){let r=Math.max(...t);if([4,5,6,7,8,9].includes(r)){let t=[r,[6,4].includes(r)?r+1:r-1].sort().reverse().join("-");o+=[i.join(" "),[t,p].join("")].join(" "),a=e+1}}}}if(n.length&&o.length){return o=[o,r.slice(a).join(" ")].join(" "),{score:o.trim()}}if(2===r.length&&["(","["].some((e=>r[1].includes(e)))){let e=t(r[0]).split("");if(1===Math.abs(e.reduce(((e,t)=>+e-+t),0)))return r[1]=i(r[1]),{score:r.join("")}}let s=r.map((e=>function(e){return/^\(\d+-\d+\)$/.test(e)||/^\[\d+-\d+\]$/.test(e)}(e)?"bracket":kP(e)&&"set"));if(s.includes("set")&&s.includes("bracket")){let e,t="";return r.forEach(((r,n)=>{"bracket"===s[n]&&"set"===e?(r=i(r),t+=r):t+=` ${r}`,e=s[n]})),{score:t.trim()}}r=e.split(" ");let c,d=r.map((e=>{let t=new RegExp(/^(\d+)-(\d+)$/);if(t.test(e)){let[i,r]=e.match(t).slice(1),n=Math.abs([i,r].reduce(((e,t)=>+e-+t))),a=Math.max(i,r);if(1===n)return c="tiebreakSet",c;if(n>=2&&a>=7&&"tiebreakSet"===c)return c="tiebreak",c}})),u=Ir("tiebreak",d);if(u.length){let t="";r.forEach(((e,i)=>{u.includes(i)?t+=`(${e}) `:u.includes(i+1)?t+=`${e}`:t+=`${e} `})),e=t.trim()}let l=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(l.test(e)){let[t,i,r]=e.match(l).slice(1),n=Math.max(i,r)>=10;!kP(t)&&n&&(e=e.replace(l,`${t} [${i}-${r}]`))}return d=[],{score:e=e.split(" ").map((e=>{let t=/^\((.*)\)$/,i=t.test(e),r=(new RegExp(PP).test(e)?"super":new RegExp(DP).test(e)&&"tiebreak")||new RegExp(TP).test(e)&&"standard"||"unknown";return d.push(r),"standard"===r&&i?e.match(t)[1]:e})).join(" ")}},handleBracketSpacing:function({score:e,applied:t}){return e.includes("( ")&&(t.push("removeParenSpacingAfterOpen"),e=e.split("( ").map((e=>e.trim())).join("(")),e.includes(" )")&&(t.push("removeParenSpacingBeforeClose"),e=e.split(" )").map((e=>e.trim())).join(")")),[NP,EP].forEach((i=>{let r=e.match(i);r?.length&&(r.forEach((t=>{e=e.replace(t,t.slice(0,t.length-1)+" ")})),t.push("setsEndComma"))})),{score:e=e.split(" ").filter(Boolean).map(LP).join(" "),applied:t}},handleSpaceSeparator:function({score:e}){if(e.includes(",")){let t=e.split(",").map((e=>e.trim())),i=e=>/\d \d/.test(e);t.every(i)&&(e=t.map((e=>{let t=/\d+ \d+/g;for(let i of e.match(t)){let[t,r]=i.match(/(\d+) (\d+)/).slice(1);e=e.replace(i,`${t}-${r}`)}return e})).join(" "))}if(e.includes(" ")){let t=e.replace(/[ ,]/g,"");t.split("").every((e=>Qi(e)))&&4===t.length&&(e=t)}return{score:e}},separateScoreBlocks:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:{score:e=e.toLowerCase().split(" ").map((e=>{if(/^\d+$/.test(e)&&e.length>2){let i=e.indexOf("1");if(e.length%2){if(3===e.length&&0===i){let r=OP(e.split(""),i);return t.push("getSuper"),r}}else{let{score:i,applied:r}=VP({score:e,applied:[]});i!==e&&(e=i,t.push(...r))}}return e})).join(" "),applied:t}},matchKnownPatterns:function({score:e,applied:t}){for(let w of[".",","," ","/"]){let i=new RegExp(`^(\\d+)\\${w}(\\d+)$`);if(i.test(e)){let r=e.match(i).slice(1).map((e=>parseInt(e))),n=Math.abs(r[0]-r[1]);n<=10&&n>=2&&(e=e.split(w).join("-"),t.push("variedJoinerPattern"))}}e.includes(";")&&(e=e.split(";").join(" "),t.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(e)){let[r,n,a,o,s,c]=e.match(i).slice(1);e=e.replace(i,`${r}${n}-${a} ${o}-${s}${c}`),t.push("smashSlashPattern")}/.*\s6[/-]+$/.test(e)&&(e+="0",t.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(e)&&(e=e.replace(r,"(6, 0)"),t.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach((()=>{e=e.split(" ").map((e=>(n.test(e)&&(e=e.replace("("," (")),a.test(e)&&(e=e.replace(")",") ")),e))).join(" "),t.push("spaceConsiderationPatterns")}));let o=LP(e);o!==e&&(e=o,t.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(e)){let[i,r,n]=e.match(s).slice(1),[a,o]=r.split("");e=`${i}-${a} ${o}-${n}`,t.push("smashSetPattern")}let c=/^(\d+)[ -](\d+)$/,d=/^([\d -]+)\/([\d -]+)$/;if(d.test(e)){let[i,r]=e.match(d).slice(1),n=i.trim(),a=r.trim();if(c.test(n)&&c.test(a)){let i=n.match(c).slice(1,3).join("-"),r=a.match(c).slice(1,3).join("-");e=`${i} ${r}`,t.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(e)){let[i,r]=e.match(u).slice(1),n=i.trim(),a=r.trim();if(c.test(n)&&c.test(a)){let i=n.match(c).slice(1,3).join("-"),r=a.match(c).slice(1,3).join("-");e=`${i} ${r}`,t.push("commaSeparationPattern")}}let l=/^\d \d,/;if(l.test(e)){let i=e.match(l)[0],r=i.slice(0,i.length-1).split(" ").join("-");e=e.replace(i,r),t.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(e)&&p<3;){let[i,r,n]=e.match(m).slice(1),a=r.split(""),o=`${i}-${a[0]} ${a[1]}-${n}`;e=e.replace(m,o),t.push("noSetSeparationPattern"),p+=1}let f=e.match(/(^|\s)7-6\s(\d+)\s/g);if(f?.length){let i=/(^|\s)7-6\s(\d+)\s/;f.forEach((r=>{let n=r.match(i).slice(2)[0];e=e.replace(r,`7-6(${n}) `),t.push("floatingTiebreakPattern1")}))}let h=e.match(/\d \d /);h?.forEach((i=>{let r=i.slice(0,i.length-1).split(" ").join("-");e=e.replace(i,r),t.push("spaceSeparatedSetPattern1")})),h=e.match(/ \d \d$/),h?.forEach((i=>{let r=" "+i.slice(1).split(" ").join("-");e=e.replace(i,r),t.push("spaceSeparatedSetPattern2")}));let g=/^\d, *\d\/\d, *\d/;if(g.test(e)){let i=e.match(g)[0],r=i.split("/").map((e=>`(${e})`)).join(" ")+" ";e=e.replace(i,r),t.push("slashCommaSetPattern")}let I=/\(6-\)/g;I.test(e)&&(e=e.replace(I,"(6-0)"),t.push("missingZeroPattern2"));let y=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(y.test(e)){let i=e.match(y),r=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),n=e;i.forEach((e=>{let[t,i]=e.match(r).slice(1),a=`${t}-${i}`;n=n.replace(e,a)})),e=n,t.push("slashSetPattern")}let v=/(.*)\s(1\d)\s(\d+)$/;if(v.test(e)){let[i,r,n]=e.match(v).slice(1);i.replace(/\D/g,"").length>=4&&(e=i+` ${r}${n}`,t.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let w of e.match(S)||[]){let[i,r,n,a]=w.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[o,s]=r.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(w,`${i}${r}(${n})${a}`),t.push("spaceSeparatedSetPattern"))}let U=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let w of e.match(U)||[]){let i=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[r,n,a]=w.match(i).slice(1),[o,s]=r.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(w,`${r}(${n})${a}`),t.push("floatingTiebreakPattern2"))}let b=/(^|\s)(\d \d)\(/g;for(let w of e.match(b)||[]){let i=/(^|\s)(\d \d)\(/,[r,n]=w.match(i).slice(1);e=e.replace(w,`${r}${n.split(" ").join("-")}(`),t.push("spacedTiebreakPattern")}return{score:e,applied:t}},removeDanglingBits:function({score:e,attributes:t}){(e.endsWith(" am")||e.endsWith(" pm"))&&(e=""),e=e.replace(/[A-Za-z]+/g,"").trim(),[".",","].some((t=>e.endsWith(t)))&&(e=e.slice(0,e.length-1));let i="()/-".split("").some((t=>e.includes(t)));/ \d$/.test(e)&&i&&(t={removed:e.slice(e.length-2).trim()},e=e.slice(0,e.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(e)&&(e=e.match(r).slice(1)[0].trim()),{score:e,attributes:t}},removeErroneous:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:[3,4].includes(e.length)&&BP(e)?{score:BP(e)}:{score:e=e.toLowerCase().split(" ").map((e=>{if(!/^\d+$/.test(e)||1!==e.length)return e;t.push("removeErroneous1")})).filter(Boolean).join(" "),applied:t}},handleDefaulted:function({score:e,profile:t,applied:i}){e=e?.toString().toLowerCase();let r=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(r.test(e)){let[t]=e.match(r).slice(1);return i.push("handleDefaulted"),{score:t.trim(),matchUpStatus:"defaulted",applied:i}}let n=t?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find((t=>e?.endsWith(t)));return a?(i.push("handleDefaulted"),{matchUpStatus:"defaulted",score:e?.replace(a,"").trim(),applied:i}):{score:e}},handleWalkover:function({score:e,applied:t}){return["walkover","wo","w/o","w-o"].includes(e?.toString().toLowerCase())?(t.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:t}):{score:e}},properTiebreak:function({score:e,matchUpStatus:t}){let i=e?.split(" ");e=i.map((e=>{if(e.endsWith("]")){let t=e.split("[");if(kP(t[0]))return t[0]+`(${t[1].slice(0,t[1].length-1)})`}return e})).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(e))for(let s of e.match(r)){let t=s.replace(" ","-").match(/\((.*)\)/)?.[1];if(Qi(t)&&t?.[0]>2)if([2,4].includes(t.length))t=t.split("").join("-");else if(3===t.length){let e=t.indexOf("1");t=OP(t.split(""),e)}e=e.replace(s,`(${t})`)}i=e?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;e=i.map(((e,i)=>{let r=[void 0,"","COMPLETED"].includes(t)||i!==a;if(n.test(e)&&r){let[t,i,r]=Array.from(e.match(n)).slice(1);return`${t}(${Math.min(i,r)})`}return e})).join(" "),i=e?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),e=i.map((e=>{if(n.test(e)){let[t,i]=Array.from(e.match(n)).slice(1),r=t.split("");return`${r[0]}-${r[1]}(${i})`}return e})).join(" "),i=e?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),e=i.map((e=>{if(n.test(e)){let[t,i]=Array.from(e.match(n)).slice(1);return kP(t)?`${t}(${i})`:t}return e})).join(" "),i=e?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),e=i.map((e=>{if(n.test(e)){let[t]=e.match(n).slice(1);return`[${t<9?10:parseInt(t)+2}-${t}]`}return e})).join(" ");let o=/\((\d)+0 /;if(o.test(e)){let t=e.match(o)[1];e=e.replace(o,`(${t}) `)}return{score:e}},handleNumeric:VP,handleRetired:function({score:e,profile:t,applied:i}){e=e?.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(e)){let[t]=e.match(r).slice(1);return i.push("handleRetired"),{score:t.trim(),matchUpStatus:"retired",applied:i}}let n=t?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find((t=>e?.endsWith(t)));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:e?.replace(a,"").trim(),applied:i}):{score:e}},containedSets:function({score:e,attributes:t,identifier:i}){if("string"!=typeof e)return{score:e,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=e.match(r);for(let c of n||[]){let t=c.match(/^\((.*)\)$/)?.slice(1)?.[0],i=e.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(2===t?.length&&i?.length>=2){let e=i.slice(i.length-2).split("").map((e=>parseInt(e)));if(1===Math.abs(e[0]-e[1]))continue}let r=LP(xP(t));e=e.replace(c,`(${r})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);if(e.match(a)?.forEach((t=>{let i=xP(t.match(/^\[(.*)\]$/)[1]);e=e.replace(t,`(${i}) `).trim()})),e.startsWith("(")&&[")","]"].some((t=>e.endsWith(t)))&&[")(","), (",") (",")[",") [","](","] ("].some((t=>e.includes(t)))){let t="",i=e.split(/[)\]]/).filter(Boolean).map((e=>(e.startsWith(",")&&(e=e.slice(1)),e.trim()))),r=i.every((e=>e.includes(",")||AP(e))),n=i.every((e=>e.includes("/")||AP(e))),a=i.every((e=>e.includes("-")||AP(e))),o=(r?",":a&&"-")||n&&"/";if(o){let r;i.forEach((e=>{if(e.startsWith("("))if("set"===r&&(t+=" "),e.includes(o))t+=e.slice(1).split(o).map((e=>e.trim())).join("-"),r="set";else{let i=e.slice(1);t+=`(${i}) `,r="tiebreak"}else if(e.startsWith("[")){let i=e.slice(1).split(o).map((e=>parseInt(e.trim()))),n=Math.min(...i);t+="set"===r?`(${n}) `:`[${i.join("-")}] `,r="tiebreak"}})),e=t.trim()}}let o=dr(e.split(""));1===o["("]&&1===o[")"]&&e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,e.length-1),1===o["-"]&&kP(e)&&Qi(t?.removed)&&(e+=`(${t.removed})`,t.removed=void 0));let s=/\(\)/g;return s.test(e)&&(e=e.replace(s,"").trim()),{score:e}},sensibleSets:function({score:e,matchUpStatus:t,attributes:i}){let r,n=[],a=e.split(" "),o=a.length;e=a.map(((e,i)=>{if(new RegExp(DP).test(e)){let i=e.slice(3),r=e.slice(0,3),n=r.split("-");if(!kP(r)&&!t){let e=Math.max(...n),t=[e,e-1];return r.indexOf(e)&&t.reverse(),t.join("-")+i}}else if(2===e.length&&Qi(e))return e.split("").join("-");e=LP(e);let a=(new RegExp(`^${PP}$`).test(e)?"super":new RegExp(`^${DP}$`).test(e)&&"tiebreak")||new RegExp(`^${TP}$`).test(e)&&"standard"||"unknown";if(n.push(a),o>1&&"standard"===a&&i<2){let[t,n]=e.split("-"),a=Math.abs(parseInt(t)-parseInt(n)),o=Math.max(t,n),s=Math.min(t,n),c=[parseInt(t),parseInt(n)].indexOf(s);if(o>9&&a>2){let t=o.toString().split(""),n=t.find((e=>parseInt(e)>s||i&&parseInt(e)<=r))??t[0];n&&(e=c?[n,s].join("-"):[s,n].join("-"))}o>(r||0)&&(r=o)}if("standard"===a){let[i,r]=e.split("-");if(!Math.abs(parseInt(i)-parseInt(r))&&"RETIRED"!==t)return""}return e})).filter(Boolean).join(" ");let{setsWon:s,setWinners:c,totalSets:d}=jP(e);if(1===d&&"6"===i?.removed&&(e+=" 6-0"),e.split(" ").length>2&&Math.max(...s)>=2&&c[0]===c[1]&&(e=e.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let t=[0,0];e=e.split(" ").map(((e,i)=>(t[c[i]]+=1,Math.max(...t)>2?void 0:e))).filter(Boolean).join(" ")}return{score:e,profile:n}},stringScore:function({score:e}){return{score:e=e?.toString().toLowerCase()||""}},superSquare:function({score:e}){let{setsTied:t,winningSide:i}=jP(e),r=/\s\((\d+)\)$/;if(!i&&t&&r.test(e)){let t=e.match(r).slice(1)[0],i=t<=8?10:t+2;e=e.replace(r,` [${i}-${t}]`)}let n=e.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:e};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every((e=>Qi(e))))return{score:e};if("76"===o[0]){let t=2===o[1].length?Math.min(...o[1].split("").map((e=>parseInt(e)))):o[1];e=[...n.slice(0,n.length-1),`7-6(${t})`].join(" ")}else{o=o.map((e=>parseInt(e)));let t=Math.max(...o),i=Math.abs(o[0]-o[1]);if(t>=10){if(i>2&&o.every((e=>+e>=10))){let e=o.map((e=>e===t?e-10:10)).sort();i=Math.abs(e[0]-e[1]),i>2&&(o=e)}e=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else 3===n.length&&t>=7&&i>2&&(e=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:e}},setBuilder:_P,excisions:function({score:e}){let t=new RegExp(/^\[\d+\](.*)$/);t.test(e)&&(e=e.match(t).slice(1)[0].trim());let i=/\(,/g;return i.test(e)&&(e=e.replace(i,"(")),{score:e}},replaceOh:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:(e.toLowerCase().includes("o")&&(e=e.toLowerCase().split(" ").map((e=>e.split("o").join("0"))).join(" "),t.push("replaceOh")),{score:e,applied:t})}},GP={},WP=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],qP=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function HP(e){if(!e.score)return{error:Ho};let t,i,r,{score:n,sheetName:a,identifier:o,fileName:s,stepLog:c,fullLog:d,profile:u}=e,l=[],p=[],m=n,f=e=>{e.forEach((e=>{r=$P[e]({profile:u,identifier:o,matchUpStatus:t,attributes:i,applied:p,score:m});let n=r.score!==m;n&&l.push({method:e,score:r.score}),c&&(d||n||r.matchUpStatus!==t)&&console.log(t?{score:r.score,matchUpStatus:t}:{score:r.score},e),r.matchUpStatus&&(t=r.matchUpStatus),r.attributes&&(i=r.attributes),r.applied&&(p=r.applied),m=r.score}))};f(WP);let h=CP(m);return h||(m=n.toString().replaceAll(/\D/g,""),i?.removed&&(i.removed=void 0),f(qP),h=CP(m),h||(m="")),p.forEach((e=>{GP[e]||(GP[e]=0),GP[e]+=1})),{matchUpStatus:t?.toUpperCase(),modifications:l,attributes:i,isValid:h,score:m}}var zP={};function YP(e,t,i,r,n,a,o){if(i&&r){let n=function(e,t,i,r){let n=r===i?i+1:i;return e!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${e}`}:t!==r?{isValid:!1,error:`Tiebreak set loser must have ${r} games, got ${t}`}:{isValid:!0}}(e,t,i,r);if(!n.isValid)return n}return void 0===n&&void 0===a||!o?{isValid:!0}:function(e,t,i){let r=Math.max(e||0,t||0),n=Math.min(e||0,t||0),a=r-n,o=i.tiebreakTo||7;return r<o?{isValid:!1,error:`Tiebreak winner must reach ${o} points, got ${r}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${r}-${n}`}:n>=o-1&&a>2?{isValid:!1,error:`Tiebreak score ${r}-${n} is invalid`}:{isValid:!0}}(n,a,o)}function KP(e,t,i,r){if(!t)return{isValid:!0};let n=Uc(t);if(!n)return{isValid:!0};let a=i&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!r){let t=e.side1Score??0,i=e.side2Score??0;if(0===t&&0===i)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if("P"===a.based&&t===i&&t>0&&a.tiebreakFormat&&void 0===e.side1TiebreakScore&&void 0===e.side2TiebreakScore)return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:o,tiebreakAt:s,tiebreakFormat:c,tiebreakSet:d}=a,u=d?.tiebreakTo,l=!!u&&!o,p=void 0!==e.side1TiebreakScore&&void 0!==e.side2TiebreakScore,{side1Score:m,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:g}=function(e,t,i){let r=e.side1TiebreakScore,n=e.side2TiebreakScore;return{side1Score:t&&i?r:e.side1Score||e.side1||0,side2Score:t&&i?n:e.side2Score||e.side2||0,side1TiebreakScore:r,side2TiebreakScore:n}}(e,l,p),I=Math.max(m,f),y=Math.min(m,f),v=I-y;if(l){return function(e,t,i,r,n,a=!1){return n?{isValid:!0}:0===e&&0===t?{isValid:!1,error:"Tiebreak-only set requires both scores"}:e<r?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${r}, got ${e}`}:i<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${e}-${t}`:`Tiebreak-only set must be won by at least 2 points, got ${e}-${t}`}:a?{isValid:!0}:e===r&&t>r-2?{isValid:!1,error:`Tiebreak-only set at ${r}-${t} requires playing past ${r}`}:e>r&&2!==i?{isValid:!1,error:`Tiebreak-only set past ${r} must be won by exactly 2 points, got ${e}-${t}`}:{isValid:!0}}(I,y,v,u,r??!1,e.NoAD??a.tiebreakSet?.NoAD??!1)}return void 0!==h||void 0!==g||o&&I===o+1&&y===o?YP(I,y,o,s,h,g,c):function(e,t,i){let{side1:r,side2:n,winner:a,loser:o,diff:s}=e,{setTo:c,tiebreakAt:d}=t;if(c&&d){let e=function(e,t,i,r){return r?e===i+1&&t<i-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${i+1} games, side 2 must be at least ${i-1}, got ${t}`}:t===i+1&&e<i-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${i+1} games, side 1 must be at least ${i-1}, got ${e}`}:{isValid:!0}:{isValid:!0}}(r,n,c,d);if(!e.isValid)return e}return i?function(e,t,i){return i&&(e>i+10||t>i+10)?{isValid:!1,error:`Set score ${e}-${t} exceeds expected range for ${i}-game sets`}:{isValid:!0}}(a,o,c):c?function(e,t,i,r,n){if(e<r)return{isValid:!1,error:`Set winner must reach ${r} games, got ${e}`};let a=n&&e===r&&t===n&&1===i;if(i<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${e}-${t}`};if(n){if(t>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let i=n===r?r+1:r;if(e>i)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${i}-${n}. Got ${e}-${t}`}}else if(e>r+10)return{isValid:!1,error:`Set score ${e}-${t} exceeds reasonable limits`};return{isValid:!0}}(a,o,s,c,d):{isValid:!0}}({side1:m,side2:f,winner:I,loser:y,diff:v},{setTo:o,tiebreakAt:s},r)}function XP(e,t,i){if(!e||0===e.length)return{isValid:!0};let r=t?.match(/SET(\d+)/)?.[1],n=r?Number.parseInt(r):3,a=[Km,Qm,Gm].includes(i||"");for(let o=0;o<e.length;o++){let r=e[o],s=o+1===n,c=void 0!==r.winningSide,d=KP(r,t,s,a||void 0===i&&!c);if(!d.isValid)return{isValid:!1,error:`Set ${o+1}: ${d.error}`}}return{isValid:!0}}function JP(e,t,i,r,n,a){let o=t+1===r,{side1Score:s,side2Score:c,side1TiebreakScore:d,side2TiebreakScore:u,winningSide:l}=e,p=Math.max(s??0,c??0),m=d??u,{finalSetFormat:f,setFormat:h}=i,g=o&&f||h;return!(m&&!function(e,t,i,r,n,a){let{tiebreakTo:o,NoAD:s}=e||{},c=Math.max(t??0,i??0);return!(s&&c>o||c<o&&r&&(n&&!a||!n))}(g?.tiebreakFormat,d,u,l,n,a))&&(!g.setTo||!(!g.noTiebreak&&p>g.setTo+1))}function QP({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:i,winningSide:r,score:n}){let a=n?.sets??[],o=(a?.filter((e=>e?.winningSide))||[]).reduce(((e,t)=>{let{winningSide:i}=t;return i?(e[i-1]++,e):e}),[0,0]),s=r?r-1:void 0,c=void 0!==s&&[0,1].includes(s)?1-s:void 0,d=void 0!==s&&o[s],u=void 0!==c&&o[c],l=t?Uc(t):void 0,p=Math.max(...o),m=dr(o)[p],f=l?.setFormat?.timed||l?.finalSetFormat?.timed,h=l?.bestOf||l?.exactly,g=h&&Math.ceil(h/2)||1,I=i??e,y=!(!I||![Gm,Km,Qm].includes(I)),v=!l||!a.length||a.every(((e,t)=>JP(e,t,l,h??0,t===a.length-1,y))),S="A"===l?.setFormat?.based||"A"===l?.finalSetFormat?.based,U=S&&a.length>0?function(e){let t=e.reduce(((e,t)=>((void 0!==t.side1Score||void 0!==t.side2Score)&&(e[0]+=t.side1Score??0,e[1]+=t.side2Score??0),e)),[0,0]);return t[0]>t[1]?1:t[1]>t[0]?2:e.find((e=>void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore))?.winningSide}(a):function(e,t,i,r,n){return(!n||e===t)&&1===i&&r.indexOf(e)+1||void 0}(p,g,m,o,t);return{valid:!(!v||!(r&&S&&r===U||r&&!S&&d>u&&r===U||r&&y||!r&&!U&&(![jm,Gm,Km,Qm].includes(I)||f&&I===jm)))}}function ZP({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:i,winningSide:r,score:n}){if("object"!=typeof n)return{error:Ho};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,c="scoreString must be a string!";if(void 0!==o&&"string"!=typeof o)return{error:Ho,info:c};if(void 0!==s&&"string"!=typeof s)return{error:Ho,info:c};if(void 0!==a&&!Array.isArray(a))return{error:Ho,info:SS("sets")};if(a?.length){let o=a.map((e=>e?.setNumber)).filter(Boolean);if(o.length!==ar(o).length)return{error:Ho,info:"setNumbers not unique"};for(let e of a){let{side1Score:t,side2Score:i,side1TiebreakScore:r,side2TiebreakScore:n,side1PointScore:a,side2PointScore:o,winningSide:s,setNumber:c}=e;if(![[t,i],[r,n],[a,o]].filter((e=>e.some((e=>![void 0,null].includes(e))))).every((e=>e.every((e=>ir(e))))))return{error:Ho,info:"non-numeric values"};if(![c,s].filter((e=>![void 0,null].includes(e))).every((e=>ir(e))))return{error:Ho,info:"non-numeric values"};if(s&&![1,2].includes(s))return{error:Ho,info:"winningSide must be 1 or 2"}}let{valid:s}=QP({existingMatchUpStatus:e,matchUpStatus:i,matchUpFormat:t,winningSide:r,score:n});if(!s)return{error:Ra,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}Oi(zP,{analyzeScore:()=>QP,analyzeSet:()=>nN,checkScoreHasValue:()=>My,checkSetIsComplete:()=>yP,getSetComplement:()=>eN,getTiebreakComplement:()=>tN,isValidMatchUpFormat:()=>Ec,parseScoreString:()=>rN,validateMatchUpScore:()=>XP,validateScore:()=>ZP,validateSetScore:()=>KP,validateTieFormat:()=>md});var eN=e=>{let{isSide1:t,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=e;if(void 0===i)return!1;let o,s=zi(i);return s?.toString().length>2&&(s=parseInt(s.toString().slice(0,2))),n&&n<r&&s>n&&(s=n),a&&!n?(s>r&&(o=r),o=s<r?r:r-1):o=s+1<r&&r||n&&n<r&&s===n&&r||!n&&s+2||r+1,[t?s:o,t?o:s]},tN=e=>{let{isSide1:t,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=e;if(void 0===i)return!1;let a="string"==typeof i?parseInt(i):i;a?.toString().length>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=function(e){let{lowValue:t,NoAD:i,tiebreakTo:r}=e,n=i?1:2;return t+1>=r?t+n:r}({lowValue:a,NoAD:n,tiebreakTo:r});return[t?a:o,t?o:a]};function iN(e,t){return(e>t?1:e<t&&2)||void 0}function rN({tiebreakTo:e=7,scoreString:t="",matchUpFormat:i}){let r,n=3;if(i)try{r=Uc(i);let e=/SET(\d+)/.exec(i)?.[1];n=e?Number.parseInt(e):3}catch{}return t?.split(" ").filter(Boolean).map(((e,t)=>function({set:e,setNumber:t}){let i,o=/\[([^\]]+)\]/,s=/\(([^)]+)\)/.exec(e),c=o.exec(e),d=e?.startsWith("[")&&c,u=function(e,t){if(!r||!t)return!1;let i=e===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!i)return!1;let a=i.tiebreakSet?.tiebreakTo,o=i.setTo;return!!a&&!o}(t,!!d),l=a(t),p=u&&1===l;if(d){i=function(e,t){return t?{side1Score:e[0],side2Score:e[1],winningSide:iN(e[0],e[1])}:{side1TiebreakScore:e[0],side2TiebreakScore:e[1],winningSide:iN(e[0],e[1])}}(c[1].split("-").map((e=>Number.parseInt(e))),u)}else i=function(e,t,i,r){let n,o,s=(t&&e.replace(t[0],"")||i&&e.replace(i[0],"")||e).split("-").map((e=>Number.parseInt(e))),c=s[0],d=s[1],u=iN(c,d);if(t&&([n,o]=function(e,t,i){let r=e[1],n=a(i),o=tN({lowValue:r,isSide1:2===t,tiebreakTo:n});return Array.isArray(o)?[o[0],o[1]]:[void 0,void 0]}(t,u,r)),i){let e=i[1].split("-").map((e=>Number.parseInt(e)));n=e[0],o=e[1]}return{side1Score:c,side2Score:d,side1TiebreakScore:n,side2TiebreakScore:o,winningSide:u}}(e,s,c,t);return{side1Score:i.side1Score,side2Score:i.side2Score,side1TiebreakScore:i.side1TiebreakScore,side2TiebreakScore:i.side2TiebreakScore,winningSide:i.winningSide,setNumber:t,...p&&{NoAD:!0},...u&&{tiebreakSet:!0}}}({set:e,setNumber:t+1})));function a(t){if(!r)return e;let i=t===n&&r.finalSetFormat?r.finalSetFormat:r.setFormat;return i?.tiebreakSet?.tiebreakTo??i?.tiebreakFormat?.tiebreakTo??e}}function nN(e){let{setObject:t,matchUpScoringFormat:i}=e;if(!t)return{error:Ia};let{setNumber:r}=t||{},{bestOf:n,exactly:a}=i||{},o=n||a,s=!(!r||!o||r!==o),c=s&&i?.finalSetFormat||i?.setFormat,d=!!c?.tiebreakSet,u=!!c?.timed,l=!d&&!u,p=!!(r&&o&&r<=o),m=[t?.side1Score,t?.side2Score],f=[t?.side1PointScore,t?.side2PointScore],h=[t?.side1TiebreakScore,t?.side2TiebreakScore],g=m.filter((e=>void 0!==e)).length,I=f.filter((e=>void 0!==e)).length,y=h.filter((e=>void 0!==e)).length,v=m?.filter((e=>!isNaN(e))).length,S=h?.filter((e=>!isNaN(e))).length,{tiebreakAt:U}=c||{},b=U&&2===m.filter((e=>e>=U)).length,w=b&&((m[0]>m[1]?1:m[1]>m[0]&&2)||void 0),T=!(!S||v),D=!!t?.winningSide,{error:P,result:N}=function({setObject:e,setFormat:t,sideGameScores:i,sideTiebreakScores:r}){if(!e)return{result:!1,error:Ia};let n=!!t?.tiebreakSet,a=!!t?.timed;if(!t||n||a)return{result:!1,error:Ho};if(2!==i?.filter((e=>!isNaN(e))).length)return{result:!1,error:Ma};let{setTo:o,tiebreakAt:s,tiebreakFormat:c,NoAD:d}=t||{};if(!o||!i?.find((e=>e>=o)))return{result:!1,error:Ma};let u=[1,2].includes(e?.winningSide);if(!e||!u)return{result:!1,error:Ca};let l=e?.winningSide-1,p=1-l,m=i[l],f=i[p],h=m-f;if(!(m>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&c,I=2===r?.filter((e=>!isNaN(e))).length,y=r?.[l],v=r?.[p],S=s&&2===i.filter((e=>e>=s)).length;if(g){let{NoAD:e,tiebreakTo:t}=c;if(S){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(t))return{result:!1,error:{message:"tiebreakTo error"}};if(!t||!r?.find((e=>e>=t)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(m>(s<o?o:o+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!v||y<v)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let i=y-v;if(i&&v>=t-1&&i<(e?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!S)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let U=d?1:2,b=f>=o-1;return h&&b&&!S&&h<U?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>U&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}({sideTiebreakScores:h,sideGameScores:m,setFormat:c,setObject:t}),{error:E,result:M}=function({setObject:e,setFormat:t,sideTiebreakScores:i}){if(!e)return{result:!1,error:Ia};let r=!!t?.tiebreakSet,n=!!t?.timed;if(!t||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(e?.winningSide);if(!e||!a)return{result:!1,error:Ca};let{tiebreakSet:o}=t||{},{NoAD:s,tiebreakTo:c}=o||{};if(2!==i?.filter((e=>!isNaN(e))).length)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(c))return{result:!1,error:{message:"tiebreakTo error"}};if(!i?.find((e=>e>=c)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let d=e?.winningSide-1,u=1-d,l=i[d],p=i[u];if(!l||!p||l<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,f=l-p,h=p>=c-1;return f&&h&&f<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}({sideTiebreakScores:h,setObject:t,setFormat:c}),R=l&&!T&&N||d&&T&&M||u,C=p&&!(d&&!T)&&!(l&&T)&&(!D||R),A=function({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:i,isTimedSet:r,setObject:n}){if(!n)return;let a=vP({set:n});return yP({matchUpScoringFormat:e,set:n,isDecidingSet:t,isTiebreakSet:i,isTimedSet:r})&&a||void 0}({isTimedSet:u,matchUpScoringFormat:i,isDecidingSet:s,isTiebreakSet:T,setObject:t}),k={expectTiebreakSet:d,expectTimedSet:u,hasTiebreakCondition:b,isCompletedSet:D,isDecidingSet:s,isTiebreakSet:T,isValidSet:C,isValidSetNumber:p,isValidSetOutcome:R,leadingSide:w,setFormat:c,sideGameScores:m,sideGameScoresCount:g,sidePointScores:f,sidePointScoresCount:I,sideTiebreakScores:h,sideTiebreakScoresCount:y,winningSide:A};return void 0!==t?.winningSide&&(T?(k.isValidTiebreakSetOutcome=M,M||(k.tiebreakSetError=E)):(k.isValidStandardSetOutcome=N,N||(k.standardSetError=P))),k}function aN(e){let t=e.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,qualifyingOnly:n,drawEntries:a,structureId:o,tieFormat:s,idPrefix:c,isMock:d,event:u}=e,l=e.qualifyingProfiles,p=l?.length?LT({hasExistingDrawDefinition:!0,uuids:e.uuids,qualifyingProfiles:l,appliedPolicies:r,qualifyingOnly:n,tieFormat:s,idPrefix:c,isMock:d}):void 0;if(p?.error)return p;t.structures=t.structures?.filter((({structureId:e})=>e!==i)),t.links=t.links?.filter((({source:e})=>e.structureId!==i));let{qualifiersCount:m,qualifyingDrawPositionsCount:f,qualifyingDetails:h}=p??{};f&&(p?.structures&&t.structures?.push(...p.structures),p?.links&&t.links?.push(...p.links));let g=t.structures?.find((({stage:e,stageSequence:t})=>e===vu&&1===t)),{qualifiersCount:I}=hv({stageSequence:1,drawDefinition:t,structureId:o,stage:vu}),y=DU({qualifiersCount:Math.max(m??0,I??0),drawDefinition:t,stage:vu});if(y.error||(y=TU({drawSize:f,stage:Su,drawDefinition:t}),y.error))return y;!function({drawDefinition:e,drawEntries:t,event:i}){for(let r of(t??[]).filter((({entryStage:e})=>e===Su))){vv({...r,entryStage:r.entryStage??vu,drawDefinition:e,event:i})}}({drawDefinition:t,drawEntries:a,event:u});let v=function({mainStructure:e,qualifyingDetails:t,drawDefinition:i}){for(let r of t||[]){let{finalQualifyingRoundNumber:t,finalQualifyingStructureId:n,roundTarget:a,finishingPositions:o,linkType:s}=r,c=e&&nb({targetStructureId:e.structureId,sourceStructureId:n,sourceRoundNumber:t,finishingPositions:o,targetEntryRound:a,linkType:s})?.link;if(c?.error)return c;c&&(i.links||(i.links=[]),i.links.push(c))}return{error:void 0}}({mainStructure:g,qualifyingDetails:h,drawDefinition:t});return v.error?v:{drawDefinition:t,structureId:o}}function oN(e){let{participantIds:t}=e,i=e.drawDefinition?.entries?.filter((t=>{let i=t.entryStatus;return!e.restrictEntryStatus||pg.includes(i)})).map(Om)??[];if(t){let e=t.filter((e=>!i?.includes(e)));if(e?.length)return Qs({result:{error:Ba},info:{invalidParticipantIds:e}})}else t=i;return e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>t.length-1&&(!e.enableDoubleRobin||e.roundsCount>2*(t.length-1))?{error:Ho,info:"Not enough participants for roundsCount"}:e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>31?{error:Ho,info:"roundsCount must be less than 32"}:{participantIds:t}}function sN(e){let t,i=[],{roundsCount:r=1,drawDefinition:n,matchUpsCount:a,structureId:o,idPrefix:s,isMock:c,event:d}=e,u=oN(e);if(u.error)return u;for(let l of gr(1,r+1)){let r=tD({restrictMatchUpsCount:e.restrictMatchUpsCount,ignoreLastRoundNumber:!!t,newRound:!t,drawDefinition:n,matchUpsCount:a,structureId:o,roundNumber:t,idPrefix:s,isMock:c,event:d});if(r.error)return Qs({result:r,info:{iteration:l}});r.matchUps?.length&&i.push(...r.matchUps),t=(r?.roundNumber??1)+1}return{matchUps:i}}function cN({scaleType:e=mp,scaleAccessor:t,participant:i,scaleName:r,eventType:n}){let a=(i&&Zy({scaleAttributes:{eventType:n??mu,scaleType:e,scaleName:r},participant:i}))?.scaleItem?.scaleValue;return t&&Rr(a)?a[t]:a}function dN(e){let t=function(e){return e.roundsCount&&"number"!=typeof e.roundsCount?{error:Ho,info:"roundsCount must be a number"}:"object"!=typeof e.drawDefinition||e.drawDefinition.drawType&&e.drawDefinition.drawType!==Wu?{error:Xr}:Array.isArray(e.drawDefinition?.entries)||!e.participantIds||Array.isArray(e.participantIds)?{error:void 0}:{error:Ho,info:"Missing Entries"}}(e);if(t?.error)return t;let i=oN(e);if(i.error)return i;let r=function(e){if(e.structureId)return e.structureId;let t=e.drawDefinition,i=t?.structures?.filter((e=>1===e.stageSequence))?.reduce(((e,t)=>{let i=t.stage&&Du[t.stage];return Cg({structure:t})&&i>(Du[e?.stage]||1)?t:e}),void 0),r=t?.structures?.find((e=>e.structureId===i?.structureId));return r?Cg({structure:r})?{structure:r}:{error:Xr}:{error:Rn}}(e);if(r.error)return r;let n,a=function(e){let{tournamentRecord:t,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=e,o=e.scaleAccessor??kb[r]?.accessor,s=t.participants??[];for(let c of i??[]){let e=s?.find((e=>e.participantId===c)),t=cN({scaleName:`${r}.${lp}`,participant:e,eventType:n});!t&&r&&(t=cN({scaleAccessor:o,participant:e,scaleName:r,eventType:n})),t&&!a[c]&&(a[c]=t)}return a}(e),o=e.tournamentRecord?.isMock??e.isMock,s=e.eventType??e.event?.eventType,c=[],d=[];for(let u of gr(1,(e.roundsCount??1)+1)){let t=lD({...e,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:c,adHocRatings:a,roundNumber:n,eventType:s,isMock:o});if(t.error)return t;let{matchUps:l,...p}=t;p.modifiedScaleValues&&(a=p.modifiedScaleValues),d.push({...p,iteration:u,matchUpsCount:l?.length}),n=(p?.roundNumber??1)+1,l?.length&&c.push(...l)}return{..._r,matchUps:c,roundResults:d}}function uN(e){let{tournamentRecord:t,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:o}=e,s=o?.entries?.filter((({entryStage:e,entryStatus:t})=>(!e||e===vu)&&t&&pg.includes(t))),c=s?.map(Om),d=s?Math.floor(s.length/2):0;if(e.automated)return function(e){let{restrictEntryStatus:t,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:o}=e.drawMatic??{},s=dN({...e,eventType:e.drawMatic?.eventType??e.matchUpType,generateMatchUps:i??!0,scaleAccessor:o??e.scaleAccessor,scaleName:a??e.scaleName,participantIds:e.participantIds,roundsCount:e.roundsCount,restrictEntryStatus:t,structureId:r,matchUpIds:n});return s.error?s:(s?.matchUps?.length&&Ww({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:e.event,structureId:r}),{..._r})}({...e,participantIds:c});{let s=sN({roundsCount:e.roundsCount,drawDefinition:i,matchUpsCount:d,idPrefix:n,isMock:a,event:o});if(s.error)return s;s.matchUps?.length&&Ww({matchUps:s.matchUps,suppressNotifications:!0,tournamentRecord:t,drawDefinition:i,structureId:r,event:o})}return{..._r}}function lN({sortDescending:e=!1,tournamentRecord:t,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){return t?{scaledEntries:(a=a??o?.entries??[]).filter((e=>(!s||!e.entryStage||e.entryStage===s)&&(!n||!e.entryStageSequence||e.entryStageSequence===n)&&pg.includes(e.entryStatus))).map((e=>{let{participantId:r}=e,{scaleItem:n}=XT({tournamentRecord:t,scaleAttributes:i,participantId:r});return{...e,...n}})).filter((e=>{let t=e.scaleValue;return!!(r||!isNaN(t)&&parseFloat(t))&&t})).sort(r||function(t,i){return e?c(i)-c(t):c(t)-c(i)})}:{error:zr};function c(t){return parseFloat(t.scaleValue||(e?-1:1e5))}}function pN(e){let t="prepareStage",{drawDefinition:i}=e,{structures:r}=pf({stageSequence:e.stageSequence||1,roundTarget:e.roundTarget,stage:e.stage,drawDefinition:i}),n=e.preparedStructureIds||[],a=r?.find((({structureId:e})=>!n.includes(e)));if(!a)return Qs({result:{error:Rn},stack:t});let o=a?.structureId,{seedsCount:s,stageEntries:c,seedLimit:d}=function(e){let{seedsCount:t}=e;e.seededParticipants&&(t=e.seededParticipants.length),t>e.drawSize&&(t=e.drawSize);let i=function({entries:e,stage:t,stageSequence:i,roundTarget:r}){return e.filter((e=>{let n=Jp({name:hm,element:e})?.extension?.value;return(!e.entryStage||e.entryStage===t)&&(!i||!e.entryStageSequence||e.entryStageSequence===i)&&(!r||!n||n===r)&&lg.includes(e.entryStatus)}))}(e);t>i.length&&(t=i.length);let{seedLimit:r}=function({requireParticipantCount:e=!0,enforcePolicyLimits:t=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:c,seedsCount:d}){r=r??n;let u=lf({drawDefinition:o,structureId:c});if(u.error)return u;let l=u.structure;if(!l)return{error:Rn};let{positionAssignments:p}=hf({structure:l}),m=p?.length||0;if(d>m)return{error:Sn};let f=l.structures?.length,h=ir(s?.groupSeedingThreshold)&&s?.groupSeedingThreshold,g=rS({roundRobinGroupsCount:f,drawSize:m})?.seedGroups,{seedsCount:I}=xT({policyDefinitions:a,requireParticipantCount:e,drawSizeProgression:i,participantsCount:r,drawSize:m});return I&&a?.[Cp]&&d>I&&t&&(d=I),l.seedLimit=d,l.seedAssignments=gr(1,d+1).map((e=>{let t=g?.find((t=>t.includes(e))),i=t&&Math.min(...t);return{participantId:void 0,seedNumber:e,seedValue:h&&e>=h?i:e}})),Zf({drawDefinition:o,structureIds:[c]}),{..._r,seedLimit:d}}({enforcePolicyLimits:e.enforcePolicyLimits??!0,appliedPolicies:e.appliedPolicies,participantsCount:i.length,seedingProfile:e.seedingProfile,drawDefinition:e.drawDefinition,structureId:e.structureId,seedsCount:t});return r&&r<t&&(t=r),{seedsCount:t,stageEntries:i,seedLimit:r}}({...e,structureId:o});(e.seededParticipants||e.event||e.seedingScaleName)&&function(e){let{seededParticipants:t,seedingScaleName:i,entries:r,event:n}=e,a=r.map(Om);t?function(e){let{provisionalPositioning:t,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:c,structure:d,event:u}=e,l=d?oS({provisionalPositioning:t,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:d}):void 0;r.filter((({participantId:e})=>i.includes(e))).filter((e=>!e.seedNumber||e.seedNumber<=r.length)).sort(((e,t)=>e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0)).forEach((e=>{let{participantId:i,seedNumber:r,seedValue:a}=e;lS({provisionalPositioning:t,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:i,seedBlockInfo:l,structureId:c,seedNumber:r,seedValue:a,event:u})}))}({...e,enteredParticipantIds:a}):(n||i)&&function(e){let t=e.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:c,seedingProfile:d,structureId:u,event:l}=e,{categoryName:p,ageCategoryCode:m}=l?.category||{};let f=function(e){let{tournamentRecord:t,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=e,{categoryName:s,ageCategoryCode:c}=o?.category||{},d=o?.eventType,u={scaleName:i||s||c||o.eventId,scaleType:hp,eventType:d};return lN({scaleAttributes:u,tournamentRecord:t,stageSequence:r,entries:n,stage:a}).scaledEntries}({...e})||c&&function(e){let{tournamentRecord:t,stageSequence:i,event:r,entries:n,stage:a}=e,{categoryName:o,ageCategoryCode:s}=r?.category||{},c=r?.eventType;return lN({scaleAttributes:{scaleName:o||s,scaleType:pp,eventType:c},tournamentRecord:t,stageSequence:i,entries:n,stage:a}).scaledEntries}({...e}),h=f?.length??0;h<t&&(t=h),f?.filter((({participantId:e})=>r.includes(e))).slice(0,a||t).forEach(((e,t)=>{let r=t+1,{participantId:a,scaleValue:c}=e;lS({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:d,participantId:a,structureId:u,seedNumber:r,seedValue:n?.[r]||c||r,event:l})}))}({...e,enteredParticipantIds:a})}({...e,seedsCount:s,structure:a,structureId:o});let u=!1!==e.automated&&e.drawType!==Wu&&!(e.qualifyingOnly&&e.stage!==Su),l=(r?.length||0)>1,p=u?function(e){let t="object"==typeof e.automated&&e.automated.seedsOnly,i=sU({...e,seedsOnly:t});if(i.error)return i;let r=i?.positionAssignments,n=i?.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}({...e,multipleStructures:l,seedLimit:d,structureId:o}):{};return p?.error?Qs({result:p,stack:t}):{...p,stageEntries:c,structureId:o,seedsCount:s}}function mN(e){let t=WT({...e,modifyOriginal:!1});if(t.error)return t;let i=t.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:c,drawEntries:d,placeByes:u,drawSize:l,drawType:p,entries:m}=e,f=[],h=[],g=function(e){let{ignoreStageSpace:t,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=e;for(let o of a){if(r&&o.entryStage&&o.entryStage!==vu)continue;let a=vv({...o,ignoreStageSpace:t??n===Wu,entryStage:o.entryStage??vu,event:e.event,drawDefinition:i,drawType:n});if(r&&a.error)return a}return{error:void 0}}({ignoreStageSpace:n,drawDefinition:i,drawEntries:d,drawType:p,entries:m});if(g.error)return g;let I=p===Qu?0:zi(e.seedsCount??0),y=pN({...e,qualifyingOnly:!l||o,appliedPolicies:a,drawDefinition:i,seedingProfile:s,participants:c,stage:vu,seedsCount:I,placeByes:u,drawSize:l,entries:m});if(y.error&&!y.conflicts)return y;y.positioningReport?.length&&f.push({[vu]:y.positioningReport});let v=y.structureId;return y.conflicts&&(h=y.conflicts),p===Wu&&e.roundsCount&&uN({...e,drawDefinition:i,structureId:v}),{drawDefinition:i,positioningReports:f,conflicts:h,structureId:v}}var fN=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]});function hN(e){let t=e.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=e,c=dp(e,[{[Pl]:!0,[El]:!0}]);if(c.error)return c;if(!Ec({matchUpFormat:n}))return{error:Yn};if(o){let e=cw({drawDefinition:r,matchUpId:o,event:s});if(e.error)return e;let t=e.matchUp;if(t?.matchUpType===gu)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:ca};t&&(t.matchUpFormat=n,Jf({tournamentId:i?.tournamentId,eventId:s?.eventId,context:"setMatchUpFormat",drawDefinition:r,matchUp:t}))}else if(Array.isArray(t)){if(s?.eventType===gu)return{error:xn};for(let e of t){let t=lf({drawDefinition:r,structureId:e});if(t.error)return t;t.structure&&(t.structure.matchUpFormat=n)}}else if(a){if(s?.eventType===gu)return{error:xn};let e=lf({drawDefinition:r,structureId:a});if(e.error)return e;e.structure&&(e.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return t=t??(a?[a]:void 0),Zf({drawDefinition:r,structureIds:t}),{..._r}}function gN({existingQualifyingStructures:e,tournamentRecord:t,drawDefinition:i,matchUpFormat:r,matchUpType:n,tieFormat:a,event:o}){if((r||a)&&!(r&&o?.matchUpFormat===r||o?.tieFormat&&a&&JSON.stringify(o.tieFormat)===JSON.stringify(a))){if(a){let t=function({tieFormat:e}){let t=md({checkCollectionIds:!1,tieFormat:e});if(t.error)return t;for(let i of e.collectionDefinitions)i.collectionId||(i.collectionId=Ud());return{tieFormat:e}}({tieFormat:a});if(t.error)return t;let r=e?.every((e=>e.tieFormat));(!e?.length||r)&&(i.tieFormat=t.tieFormat??a)}else if(r){let e=hN({tournamentRecord:t,drawDefinition:i,matchUpFormat:r,event:o});if(e.error)return{info:"matchUpFormat or tieFormat error",error:e.error}}n&&(i.matchUpType=n)}return{error:void 0}}var IN={};Oi(IN,{attachPolicies:()=>kw,findPolicy:()=>Hh,getAppliedPolicies:()=>Fh,getPolicyDefinitions:()=>Lh,mutate:()=>yN,query:()=>UN,removePolicy:()=>vN});var yN={};function vN(e){let t=dp(e,[{policyType:!0,_anyOf:{[bl]:!1,[Tl]:!1,[Pl]:!1,[Kl]:!1}}]);if(t.error)return t;let i,r=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(r)return SN(e,r);if(!e.tournamentRecords)return{error:zr};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:zr};for(let r of t){let t=SN(e,e.tournamentRecords[r]);if(t.error)return t;i=!0}}return i?{..._r}:{error:ha}}function SN(e,t){let i=Fh(e).appliedPolicies??{};return i[e.policyType]?(delete i[e.policyType],Object.keys(i).length?Vp({element:t,extension:{name:Qp,value:i}}):_p({element:t,name:Qp}),{..._r}):{error:ha}}Oi(yN,{attachPolicies:()=>kw,removePolicy:()=>vN});var UN={};Oi(UN,{findPolicy:()=>Hh,getAppliedPolicies:()=>Fh,getPolicyDefinitions:()=>Lh});var bN={[Cp]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[pl]:{positioning:ku},[ll]:{positioning:ku}},positioning:Au},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},wN=bN;function TN({appliedPolicies:e,policyDefinitions:t,drawDefinition:i,stack:r}){if(t&&"object"!=typeof t)return Qs({info:"policyDefinitions must be an object",result:{error:Ho},stack:r});let n={[Mp]:e?.[Mp]};return t?function({policyDefinitions:e,appliedPolicies:t,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(e))JSON.stringify(t?.[n])!==JSON.stringify(e[n])&&(i[n]=e[n]);Object.keys(i).length&&(kw({policyDefinitions:i,drawDefinition:r}),t&&Object.assign(t,i))}({policyDefinitions:t,appliedPolicies:e,policiesToAttach:n,drawDefinition:i}):n.avoidance&&kw({drawDefinition:i,policyDefinitions:n}),!e?.[Cp]&&!t?.[Cp]&&(kw({policyDefinitions:wN,drawDefinition:i}),e&&Object.assign(e,wN)),{error:void 0}}function DN(e){let{tournamentRecord:t,policyDefinitions:i,appliedPolicies:r,matchUpFormat:n,matchUpType:a,tieFormat:o,drawType:s,stack:c,event:d}=e,u=e.drawId?d?.drawDefinitions?.find((t=>t.drawId===e.drawId)):void 0,l=u?.structures?.find((e=>e.stage===vu&&1===e.stageSequence))?.structureId,p=u?u.structures?.filter((e=>e.stage===Su)):[],m=1===p?.length&&!p[0].matchUps?.length&&p[0].structureId;u&&s!==u.drawType&&(u.drawType=s);let f=u??function(e){let{drawId:t=Ud(),processCodes:i,matchUpType:r,drawType:n}=e??{},a=fN();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:t})}({processCodes:e.processCodes,drawId:e.drawId,drawType:s}),h=gN({existingQualifyingStructures:p,tournamentRecord:t,drawDefinition:f,matchUpFormat:n,matchUpType:a,tieFormat:o,event:d});if(h.error)return Qs({result:h,stack:c});let g=TN({appliedPolicies:r,policyDefinitions:i,drawDefinition:f,stack:c});return g.error?g:{drawDefinition:f,structureId:l,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:m}}var PN={};function NN(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}Oi(PN,{addGoesTo:()=>Ny,allCompetitionMatchUps:()=>Sy,allDrawMatchUps:()=>by,allEventMatchUps:()=>yy,allPlayoffPositionsFilled:()=>LS,allTournamentMatchUps:()=>vy,analyzeDraws:()=>_w,analyzeMatchUp:()=>hM,analyzeTournament:()=>HN,bulkUpdatePublishedEventIds:()=>aE,calculateWinCriteria:()=>aM,categoryCanContain:()=>ld,checkMatchUpIsComplete:()=>sy,checkValidEntries:()=>FT,compareTieFormats:()=>ZN,competitionScheduleMatchUps:()=>eM,courtGridRows:()=>kE,credits:()=>NN,drawMatchUps:()=>gM,eventMatchUps:()=>JE,filterMatchUps:()=>ay,filterParticipants:()=>lv,findDrawDefinition:()=>Qw,findExtension:()=>Jp,findVenue:()=>WI,getAggregateTeamResults:()=>WN,getAllDrawMatchUps:()=>gy,getAllEventData:()=>uE,getAllStructureMatchUps:()=>oy,getAllowedDrawTypes:()=>FN,getAllowedMatchUpFormats:()=>xN,getAppliedPolicies:()=>Fh,getAssignedParticipantIds:()=>Ky,getAvailableMatchUpsCount:()=>Yw,getAvailablePlayoffProfiles:()=>bb,getCategoryAgeDetails:()=>dd,getCheckedInParticipantIds:()=>II,getCompetitionDateRange:()=>$N,getCompetitionMatchUps:()=>ZE,getCompetitionParticipants:()=>MN,getCompetitionPenalties:()=>_N,getCompetitionVenues:()=>dE,getCourtInfo:()=>YI,getCourts:()=>yM,getDrawData:()=>fE,getDrawDefinitionTimeItem:()=>Dh,getDrawParticipantRepresentativeIds:()=>Kw,getDrawStructures:()=>pf,getDrawTypeCoercion:()=>RT,getEligibleVoluntaryConsolationParticipants:()=>zw,getEntriesAndSeedsCount:()=>xE,getEvent:()=>bM,getEventData:()=>hE,getEventMatchUpFormatTiming:()=>qE,getEventProperties:()=>SM,getEventPublishStatus:()=>rv,getEventStructures:()=>OS,getEventTimeItem:()=>Ph,getEvents:()=>UM,getFlightProfile:()=>XI,getHomeParticipantId:()=>oM,getLinkedTournamentIds:()=>Em,getMatchUpCompetitiveProfile:()=>Vg,getMatchUpContextIds:()=>sM,getMatchUpDailyLimits:()=>tM,getMatchUpDailyLimitsUpdate:()=>zE,getMatchUpDependencies:()=>Ey,getMatchUpFormat:()=>uM,getMatchUpFormatTiming:()=>OI,getMatchUpFormatTimingUpdate:()=>BE,getMatchUpScheduleDetails:()=>QI,getMatchUpType:()=>iy,getMatchUpsMap:()=>bg,getMatchUpsStats:()=>lM,getMatchUpsToSchedule:()=>yE,getMaxEntryPosition:()=>FE,getModifiedMatchUpFormatTiming:()=>HE,getPairedParticipant:()=>ey,getParticipantEventDetails:()=>RN,getParticipantIdFinishingPositions:()=>Xw,getParticipantMembership:()=>CN,getParticipantResults:()=>Gb,getParticipantScaleItem:()=>XT,getParticipantSchedules:()=>AN,getParticipantSignInStatus:()=>kN,getParticipantTimeItem:()=>Eh,getParticipants:()=>mv,getPersonRequests:()=>NE,getPolicyDefinitions:()=>Lh,getPositionAssignments:()=>kT,getPositionsPlayedOff:()=>Sb,getPredictiveAccuracy:()=>iM,getProfileRounds:()=>CE,getPublishState:()=>av,getRandomQualifierList:()=>CT,getRoundMatchUps:()=>Ng,getRounds:()=>fM,getScaleValues:()=>Ip,getScaledEntries:()=>lN,getScheduledRoundsDetails:()=>SE,getSchedulingProfile:()=>wE,getSchedulingProfileIssues:()=>PE,getSeedingThresholds:()=>nS,getSeedsCount:()=>xT,getStructureSeedAssignments:()=>yg,getTeamLineUp:()=>ty,getTieFormat:()=>rE,getTimeItem:()=>Th,getTournamentIds:()=>Kp,getTournamentInfo:()=>jN,getTournamentPenalties:()=>LN,getTournamentPersons:()=>GN,getTournamentPoints:()=>XN,getTournamentPublishStatus:()=>iv,getTournamentStructures:()=>xS,getTournamentTimeItem:()=>Nh,getValidGroupSizes:()=>tS,getVenueData:()=>KI,getVenuesAndCourts:()=>cE,isAdHoc:()=>Cg,isCompletedStructure:()=>FS,isValidForQualifying:()=>AT,isValidMatchUpFormat:()=>Ec,matchUpActions:()=>PT,participantScaleItem:()=>Zy,participantScheduledMatchUps:()=>KE,positionActions:()=>MT,publicFindCourt:()=>zI,publicFindVenue:()=>qI,tallyParticipantResults:()=>nw,tieFormatGenderValidityCheck:()=>pc,tournamentMatchUps:()=>QE,validMatchUp:()=>Dg,validMatchUps:()=>Pg,validateCollectionDefinition:()=>pd,validateLineUp:()=>US});var EN={};function MN(e){let{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:Hr};let i=[],r={},n={},a={},o=[],s={},c=[];for(let d of Object.values(t)){let{participantIdsWithConflicts:t,mappedMatchUps:u,participantMap:l,participants:p,matchUps:m,derivedEventInfo:f,derivedDrawInfo:h}=mv({...e,tournamentRecord:d});Object.assign(s,u),Object.assign(r,l),Object.assign(n,f),Object.assign(a,h),i.push(...p??[]),o.push(...m??[]),t?.forEach((e=>{c.includes(e)||c.push(e)}))}return{participantIdsWithConflicts:c,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,..._r,matchUps:o}}function RN({tournamentRecord:e,participantId:t}){if(!e)return{error:zr};if(!t)return{error:Ha};let i=[t].concat((e.participants??[]).filter((e=>e?.participantType&&[hh,fh].includes(e.participantType)&&e.individualParticipantIds?.includes(t))).map((e=>e.participantId)));return{eventDetails:(e.events??[]).filter((e=>Sr((e?.entries??[]).map((e=>e.participantId)),i))).map((e=>({eventName:e.eventName,eventId:e.eventId})))}}function CN({tournamentRecord:e,participantId:t}){if(!e)return{error:zr};if(!t)return{error:Ha};let{participants:i}=mv({participantFilters:{participantTypes:[hh,fh,mh]},tournamentRecord:e});return(i??[]).filter((e=>e.individualParticipantIds?.includes(t))).reduce(((e,t)=>{let i=t.participantType;return i&&(e[i]||(e[i]=[]),e[i].push(t)),e}),{})}function AN({participantFilters:e={},tournamentRecord:t}){if(!t)return{error:zr};if("object"!=typeof e)return{error:Go,context:{participantFilters:e}};let i=vy({tournamentRecord:t,contextFilters:{eventIds:e.eventIds}}).matchUps??[],r=Object.assign({},...i.map((e=>({[e.matchUpId]:e})))),n=i.filter((({schedule:e})=>e&&Object.keys(e).length)),a=Ey({tournamentRecord:t,matchUps:i}).sourceMatchUpIds??[],o={};for(let s of n){let e,{sides:t}=s,i=t?.map((t=>{if(t.participant)return[t.participant].concat(...t.participant.individualParticipants||[]);a[s.matchUpId]&&!e&&(e=(a[s.matchUpId]||[]).map((e=>r[e])).filter((({winningSide:e,bye:t})=>!e&&!t)))})).filter(Boolean).flat()??[];for(let r of i){let{participantId:e}=r;o[e]||(o[e]={potentialMatchUps:[],participant:r,matchUps:[]}),o[e].matchUps.push(s)}let n=e?.map((({sides:e})=>e)).flat().map((({participant:e})=>e&&[e].concat(...e.individualParticipants||[]))).filter(Boolean).flat()||[];for(let r of n){let{participantId:e}=r;o[e]||(o[e]={potentialMatchUps:[],participant:r,matchUps:[]}),o[e].potentialMatchUps.push(s)}}return{participantSchedules:Object.values(o).filter((({participant:t})=>!(e.participantIds&&!e.participantIds.includes(t.participantId)||e.participantTypes&&!e.participantTypes.includes(t.participantType)))),..._r}}function kN({tournamentRecord:e,participantId:t}){if(!e)return{error:zr};if(!t)return{error:Ha};let{participant:i}=bh({tournamentRecord:e,participantId:t});if(!i)return{error:Ya};let{timeItem:r}=Th({itemType:ch,element:i});return r&&r.itemValue===uh&&uh}Oi(EN,{filterParticipants:()=>lv,getCompetitionParticipants:()=>MN,getPairedParticipant:()=>ey,getParticipantEventDetails:()=>RN,getParticipantMembership:()=>CN,getParticipantScaleItem:()=>XT,getParticipantSchedules:()=>AN,getParticipantSignInStatus:()=>kN,getParticipantTimeItem:()=>Eh,getParticipants:()=>mv,getScaleValues:()=>Ip,participantScaleItem:()=>Zy,validateLineUp:()=>US});var ON={};function xN({tournamentRecord:e,categoryName:t,categoryType:i}){if(!e)return{error:zr};let{appliedPolicies:r}=Fh({tournamentRecord:e});return(r?.[Rp]?.matchUpFormats||[]).filter((({categoryNames:e,categoryTypes:r})=>!t&&!r||t&&e?.includes(t)||i&&r?.includes(i)))}function FN({tournamentRecord:e,categoryName:t,categoryType:i}){if(!e)return{error:zr};let{appliedPolicies:r}=Fh({tournamentRecord:e});return(r?.[kp]?.allowedDrawTypes||[]).filter((({categoryNames:e,categoryTypes:r})=>!t&&!r||t&&e?.includes(t)||i&&r?.includes(i)))}function LN({tournamentRecord:e}){if(!e)return{error:zr};let t=(e?.participants??[]).reduce(((e,t)=>{let{participantId:i}=t;return(t.penalties??[]).forEach((t=>{let{penaltyId:r}=t||{};e[r]?e[r].participants.push(i):e[r]={...t,participantIds:[i]}})),e}),{});return{penalties:Object.values(t)}}function _N({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Hr};let t=[];for(let i of Object.values(e)){let{penalties:e}=LN({tournamentRecord:i});t.push(...e??[])}return{penalties:t}}function BN({event:e}){return{eventInfo:(({eventId:e,eventName:t,eventType:i,eventLevel:r,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:d,ballType:u,discipline:l,onlineResources:p,notes:m})=>({eventId:e,eventName:t,eventType:i,eventLevel:r,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:d,ballType:u,discipline:l,onlineResources:p,notes:m}))(e)}}Oi(ON,{analyzeDraws:()=>_w,analyzeTournament:()=>HN,getAggregateTeamResults:()=>WN,getAllowedDrawTypes:()=>FN,getAllowedMatchUpFormats:()=>xN,getAppliedPolicies:()=>Fh,getCompetitionDateRange:()=>$N,getCompetitionPenalties:()=>_N,getPolicyDefinitions:()=>Lh,getTournamentInfo:()=>jN,getTournamentPenalties:()=>LN,getTournamentPersons:()=>GN,getTournamentPoints:()=>XN,getTournamentStructures:()=>xS,getTournamentTimeItem:()=>Nh});var VN={[Pp]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}};function jN(e){let{tournamentRecord:t}=e??{};if(!t)return{error:zr};let i=(({tournamentId:e,tournamentRank:t,tournamentStatus:i,formalName:r,tournamentName:n,promotionalName:a,onlineResources:o,localTimeZone:s,activeDates:c,startDate:d,endDate:u,hostCountryCode:l,venues:p,notes:m,updatedAt:f})=>({tournamentId:e,tournamentRank:t,tournamentStatus:i,formalName:r,tournamentName:n,promotionalName:a,onlineResources:o,localTimeZone:s,activeDates:c,startDate:d,endDate:u,hostCountryCode:l,venues:p,notes:m,updatedAt:f}))(t),r=mv({participantFilters:{participantRoles:[Pv,Rv,Ev,Mv,Av]},policyDefinitions:VN,tournamentRecord:t})?.participants??[];r&&(i.tournamentContacts=r);let n=av({tournamentRecord:t})?.publishState,a=n?.tournament?.status?.publishedEventIds||[],o=[];for(let s of t.events??[])if(!e?.usePublishState||a.includes(s.eventId)){let e=BN({event:s}).eventInfo;e&&o.push(e)}return i.timeItemValues=Tw({element:t}),i.publishState=n?.tournament,i.eventInfo=o,{tournamentInfo:yd(Js(i),!1,!0),..._r}}function $N({tournamentRecords:e}){if(!Rr(e))return{error:Hr};let t=Object.keys(e??{}).reduce(((t,i)=>{let r=e[i],{tournamentInfo:{startDate:n,endDate:a}}=jN({tournamentRecord:r}),o=n&&Yc(n),s=o&&new Date(o);(!t.startDate||s&&s<t.startDate)&&(t.startDate=s);let c=a&&Yc(a),d=c&&new Date(c);return(!t.endDate||d&&d>t.endDate)&&(t.endDate=d),t}),{startDate:void 0,endDate:void 0}),i=t.startDate&&Yc(t.startDate.toISOString()),r=t.endDate&&Yc(t.endDate.toISOString());return i&&r?{startDate:i,endDate:r}:{error:Ua}}function GN({tournamentRecord:e,participantFilters:t}){if(!e)return{error:zr};let i=e.participants||[];t&&(i=lv({participants:i,participantFilters:t,tournamentRecord:e}));let r={};return i.forEach((e=>{e.person&&(e=>{if(e.person){let{personId:t}=e.person;r[t]?r[t].participantIds.push(e.participantId):r[t]={...e.person,participantIds:[e.participantId]}}})(e)})),{tournamentPersons:Object.values(r)}}function WN(e){let t=dp(e,[{[Tl]:!0}]);if(t.error)return t;let i=e.finishingPositionRangeBounsPoints||{},r={},n=e=>{let t=e?.individualParticipants?.map((e=>1===e.teams?.length&&e.teams[0]));return 1===e?.teams?.length&&e?.teams?.[0]||t?.[0].participantId===t?.[1].participantId&&t?.[0]},{matchUps:a,participants:o}=mv({participantFilters:{participantTypes:[ph]},withRankingProfile:!0,withStatistics:!0,...e});for(let l of o??[]){if(l.participantType===lh)continue;"draw-0-3"===l.draws?.[0]?.drawId&&console.log(l.participantType,l.draws[0].finishingPositionRange);let e=n(l);if(e)for(let t of l?.draws??[]){let n=t?.finishingPositionRange?.join("-");if(n&&i?.[n]){let a=e?.participantId,o=t?.drawId;r[`${a}|${o}|${n}`]=i[n]}}}let s=e=>({teamName:e,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),c=(e,t,i)=>{void 0===e[t]&&(e[t]=0),e[t]+=i},d={},u={};for(let l of a??[]){let{sides:e,matchUpFormat:t}=l,i=t&&Uc(t);if(2===e?.length&&i.setFormat?.timed&&(!i.finalSetFormat||i.finalSetFormat?.timed))for(let r of e){let e=n(r.participant),t=e?.participantId,i=r.participant?.participantId,a=e?.participantName,o=r.sideNumber,p=r.participant?.individualParticipantIds||i&&[i]||[];if(p.forEach((e=>{e&&!d[e]&&(d[e]=s(a))})),t&&o){u[t]||(u[t]=s(a));let e=[...p.map((e=>d[e])),u[t]];l.winningSide&&(o===l.winningSide?e.forEach((e=>c(e,"win",1))):e.forEach((e=>c(e,"loss",1))));let i=l.score?.sets||[];for(let t of i){let i=t?.[`side${3-o}Score`]||0,r=t?.[`side${o}Score`]||0,n=r-i;e.forEach((e=>c(e,"pointsPlayed",r+i))),e.forEach((e=>c(e,"points",r))),e.forEach((e=>c(e,"diff",n)))}}}}for(let l of Object.keys(r)){let[e]=l.split("|");u[e]&&(u[e].bonus+=r[l],u[e].pointsPct=parseFloat((u[e].points/u[e].pointsPlayed).toFixed(2)),u[e].standingPoints=u[e].win+u[e].bonus)}for(let l of Object.keys(d))d[l].pointsPct=parseFloat((d[l].points/d[l].pointsPlayed).toFixed(2));return{..._r,individualResults:d,teamResults:u}}function qN(e){let t=2===e.participants?.filter((({participantType:e})=>e===hh))?.length,i=1===e.events?.length&&e.events[0],r=1===i?.drawDefinitions?.length&&i.drawDefinitions[0],n=2===(1===r?.structures?.length&&r.structures[0])?.positionAssignments?.length;return!!(i.tieFormat&&t&&n)}function HN({tournamentRecord:e}){if(!e)return{error:zr};let{drawsAnalysis:t}=_w({tournamentRecord:e}),i={isDual:qN(e),drawsAnalysis:t},r=mv({tournamentRecord:e});return r.missingParticipantIds?.length&&(i.missingParticipantIds=r.missingParticipantIds),{..._r,analysis:i}}function zN(e,t){return e&&t&&Array.isArray(t)&&t[e-1]||"object"==typeof t&&t[e]}function YN(e){let{participation:t={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:c,level:d}=e,{participationOrder:u,flightNumber:l,rankingStage:p}=t;return{awardProfile:i.find((e=>(e=>!r&&!c||!e.dateRanges||e.dateRanges.some((e=>{let t=!r||!e.startDate||new Date(r)>new Date(e.startDate),i=!c||!e.endDate||new Date(c)<=new Date(e.endDate);return t&&i})))(e)&&(!e.maxFlightNumber||l<=e.maxFlightNumber)&&(!e.drawTypes?.length||e.drawTypes?.includes(o))&&(!e.drawSizes?.length||e.drawSizes.includes(a))&&(!e.stages?.length||e.stages.includes(p))&&(!e.levels?.length||e.levels.includes(d))&&(!e.maxDrawSize||a<=e.maxDrawSize)&&(!e.drawSize||e.drawSize===a)&&(!e.maxLevel||d<=e.maxLevel)&&(!l||!e.flights?.flightNumbers?.length||e.flights.flightNumbers.includes(l))&&(!e.participationOrder||e.participationOrder===u)&&(!e.category?.ageCategoryCodes||e.category.ageCategoryCodes.includes(s?.ageCategoryCode))&&(!e.eventTypes?.length||e.eventTypes?.includes(n))))}}function KN({participantWon:e,flightNumber:t,valueObj:i,drawSize:r,flights:n,level:a}){let o,s,c,d,u=(e,t)=>{if(e){if(Array.isArray(t)){let i=t.find((t=>t.flight===e||t.f===e));return i.value||i.v}if("object"==typeof t){let i=t.flights||t.f;if(Array.isArray(i))return i[e-1]}}},l=(e,t)=>{let i=e?.value||e?.v||(ir(e)?e:0),r=zN(a,e?.level);return{value:u(t,r)||ir(r)&&r||i}},p=0,m=(e?"won":!1===e&&"lost")||void 0;if(Array.isArray(i)){let e=i.find((e=>e.drawSize===r||e.drawSizes?.includes(r))),n=i.find((e=>e.drawSize&&e.threshold&&r>e.drawSize)),a=i.find((e=>!e.drawSize&&!e.drawSizes?.length));void 0!==m&&(e=e?.[m],n=n?.[m],a=a?.[m]),s=l(e,t).value,c=l(n,t).value,d=l(a,t).value,p=s||c||d,o=s&&e.requireWin||c&&n.requireWin||a?.requireWin}else if("object"==typeof i){let e=i?.drawSizes?.[r],n=i;void 0!==m&&(e=e?.[m],n=n?.[m]),s=l(e,t).value,d=l(n,t).value,p=s||d,o=s?e.requireWin:n?.requireWin}else ir(i)&&void 0===m&&(p=i);return t&&n?.pct?.[t]&&(p=Math.round(p*n.pct[t])),{awardPoints:p,requireWin:o}}function XN({participantFilters:e,policyDefinitions:t,tournamentRecord:i,level:r}){if(!i)return{error:zr};let{policyDefinitions:n}=Lh({policyTypes:[Tp],tournamentRecord:i}),a=t?.[Tp]??n?.[Tp];if(!a)return{error:ua};let o=a.awardProfiles,s=a.requireWinFirstRound,c=a.requireWinForPoints,{participants:d,derivedEventInfo:u,derivedDrawInfo:l,mappedMatchUps:p}=mv({withRankingProfile:!0,participantFilters:e,tournamentRecord:i}),m=d?.filter((e=>e.draws?.length)),f={},h={},g={};for(let I of m??[]){let{participantType:e,participantId:t,person:n,draws:a}=I;for(let d of a){let a,{drawId:m,structureParticipation:y,eventId:v}=d,S=u[v],U=l[m],b=U?.drawType,{category:w,eventType:T}=S||{},D=d.startDate||S.startDate||i.startDate,P=d.endDate||S.endDate||i.endDate;if((T!==Iu||t===lh)&&o){let i,d=c,u=0,l=0,v=0;for(let n of y){let{finishingPositionRange:c,participationOrder:m,participantWon:f,flightNumber:h,rankingStage:g,winCount:y}=n;u+=y||0;let S=U?.drawSize,{awardProfile:N}=YN({awardProfiles:o,participation:n,eventType:T,startDate:D,category:w,drawSize:S,drawType:b,endDate:P,level:r});if(N){if(!S)continue;let e=Array.isArray(c)&&Math.max(...c),t=ar(c||[]).join("-"),n=e&&g!==Su&&c?.includes(S);void 0!==N.requireWinForPoints&&(d=N.requireWinForPoints),void 0!==N.requireWinFirstRound&&(s=N.requireWinFirstRound);let a,{finishingPositionPoints:o={},finishingPositionRanges:u,finishingRound:p,pointsPerWin:I,flights:U}=N,b=Array.isArray(N.perWinPoints)?N.perWinPoints?.find((e=>e.participationOrders?.includes(m))):N.perWinPoints,w=o.participationOrders,T=0;if((!w||w.includes(m))&&u&&e){let t=u[e];t&&({awardPoints:T,requireWin:a}=KN({flightNumber:h,valueObj:t,drawSize:S,flights:U,level:r}))}if(!T&&p&&1===m&&e){let t=p[e];t&&({awardPoints:T,requireWin:a}=KN({participantWon:f,flightNumber:h,valueObj:t,drawSize:S,flights:U,level:r}))}if(n&&void 0!==s&&(d=s),void 0!==a&&(d=a),T>l&&(!d||y)&&(l=T,i=e),!T&&I&&y&&(v+=y*I,i=t),!T&&y&&b){let e=zN(r,b?.level);e?v+=y*e:b.value&&(v+=y*b.value)}}if(a=l+v,e===lh){let e=(I.matchUps||[]).filter((({structureId:e})=>e===n.structureId));for(let{matchUpId:i}of e){let e=p[i],r=e.sides.find((e=>e.participantId===t)).sideNumber;if(e.winningSice===r)for(let t of e.tieMatchUps)t.winningSide}}}if(v||l){let r={winCount:u,positionPoints:l,rangeAccessor:i,perWinPoints:v,eventType:T,drawId:m,points:a},o=n?.personId;o?(f[o]||(f[o]=[]),f[o].push(r)):e===fh?(g[t]||(g[t]=[]),g[t].push(r)):e===lh&&(h[t]||(h[t]=[]),h[t].push(r))}}}}return{participantsWithOutcomes:m,personPoints:f,pairPoints:g,teamPoints:h,..._r}}var JN={};function QN(e){if(!e)return{};let t=[],i=e.tieFormatName,r=e.collectionDefinitions?.map((e=>{let{matchUpType:i,matchUpFormat:r,matchUpCount:n,category:a,gender:o}=e;t.includes(r)||t.push(r);let s=a?.ageCategoryCode;return[n,i===Vi?"D":"S",s,r,o].join(";")})).join("|");return{tieFormatName:e&&i||"UNNAMED",matchUpFormats:t,tieFormatDesc:r}}function ZN({considerations:e={},descendant:t,ancestor:i}){let r={},n={},{matchUpFormats:a,tieFormatDesc:o}=QN(t),{matchUpFormats:s,tieFormatDesc:c}=QN(i),d=ar((a??[]).filter((e=>!(s??[]).includes(e))).concat((s??[]).filter((e=>!(a??[]).includes(e))))),u=!(!e?.collectionName||t.collectionDefinitions.map((({collectionName:e})=>e)).join("|")===i.collectionDefinitions.map((({collectionName:e})=>e)).join("|")),l=!(!e?.collectionOrder||t.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")===i.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")),p=Object.assign({},...(t?.collectionDefinitions||[]).map((e=>({[e.collectionId]:e})))),m=Object.assign({},...(i?.collectionDefinitions||[]).map((e=>({[e.collectionId]:e}))));r.collectionIds=vr(Object.keys(p),Object.keys(m)),n.collectionIds=vr(Object.keys(m),Object.keys(p)),r.collectionsValue=eE(p),n.collectionsValue=eE(m),r.groupsCount=i?.collectionGroups?.length??(0-(t?.collectionGroups?.length??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let f=r.collectionsValue.totalValue-n.collectionsValue.totalValue,h=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,I=n.collectionsValue.assignmentValues.some(((e,t)=>{let i=r.collectionsValue.assignmentValues[t];return!i||e.valueKey!==i.valueKey||e.value!==i.value||!!Array.isArray(e.value)&&e.value.every(((e,t)=>i.value[t]===e))})),y=u||l||c!==o||g||I||0!==f,v=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],S=v.length&&v;return{matchUpFormatDifferences:d,matchUpCountDifference:h,descendantDifferences:r,ancestorDifferences:n,orderDifference:l,valueDifference:f,nameDifference:u,descendantDesc:o,ancestorDesc:c,..._r,different:y,invalid:S}}function eE(e){let t=[],i=[],r=0;return{totalValue:Object.keys(e).sort(uv).reduce(((n,a)=>{let o=e[a],{collectionValueProfiles:s,collectionValue:c,matchUpCount:d,matchUpValue:u,scoreValue:l,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:c,matchUpValue:u,scoreValue:l,setValue:p},f=Object.keys(m).filter((e=>![void 0,null].includes(m[e])&&(!Array.isArray(m[e])||m[e].length>0)));1!==f.length&&t.push({collectionId:a});let h=f[0];if(h){let e="collectionValueProfiles"===h?Object.values(s):m[h];i.push({valueKey:h,value:e})}return r+=d,s?.length?n+s.reduce(((e,t)=>e+t.value),0):d?ir(u)?n+u*d:ir(l)?n+l*d:ir(p)?n+p*d:n+c:n}),0),totalMatchUps:r,invalidValues:t,assignmentValues:i}}function tE(e){Object.assign(e,{inContext:!0});let{matchUp:t,error:i}=iE(e);return{matchUp:yd(t,!0,!0),error:i}}function iE({participantsProfile:e,afterRecoveryTimes:t,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:c,eventId:d,drawId:u,event:l}){if(!i)return{error:zr};if("string"!=typeof s)return{error:ra};if(!a||!l){let e=(vy({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find((e=>e.matchUpId===s));if(!e)return{error:aa};({eventId:d,drawId:u}=e),({event:l,drawDefinition:a}=JI({tournamentRecord:i,eventId:d,drawId:u}))}if(!a)return{error:Zr};n&&!r&&(r=qh({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:l?.surfaceCategory??i.surfaceCategory,indoorOutDoor:l?.indoorOutdoor??i.indoorOutdoor,endDate:l?.endDate??i.endDate,tournamentId:i.tournamentId,eventId:d??l?.eventId,drawId:u},{participants:m=[]}=xh({participantsProfile:e,tournamentRecord:i,contextProfile:n,inContext:c});if(o){let e=(by({context:c?p:void 0,participants:m,afterRecoveryTimes:t,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:c,event:l}).matchUps??[]).find((e=>e.matchUpId===s));if(!e)return{error:aa};let i=a?.structures?.find((t=>t.structureId===e.structureId));return{drawDefinition:a,structure:i,matchUp:e}}{let{matchUp:e,structure:i}=cw({context:c?p:void 0,tournamentParticipants:m,afterRecoveryTimes:t,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:c,event:l});return{matchUp:e,structure:i,drawDefinition:a}}}function rE({tournamentRecord:e,drawDefinition:t,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){if(!e)return{error:zr};if(!(o||s||i||r))return Qs({result:{error:va},stack:"getTieFormat"});a&&!s&&(s=e.events?.find((e=>e.eventId===a)));let c=tE({tournamentRecord:e,drawDefinition:t,matchUpId:r,drawId:o,event:s});if(r&&c?.error)return c;if(!t&&c?.drawDefinition&&(t=c?.drawDefinition),!(n=n??c?.structure)&&i&&!r){if(!t)return{error:In};let e=lf({drawDefinition:t,structureId:i});if(e.error)return e;n=e.structure}let d=(n?.tieFormat||n?.tieFormatId)&&Ug({structure:n,drawDefinition:t,event:s})?.tieFormat,u=(t?.tieFormat||t?.tieFormatId)&&Ug({drawDefinition:t,event:s})?.tieFormat,l=Ug({event:s})?.tieFormat,p=Ug({matchUp:c?.matchUp,drawDefinition:t,structure:n,event:s})?.tieFormat;return{..._r,matchUp:c?.matchUp,structureDefaultTieFormat:yw(d),eventDefaultTieFormat:yw(l),drawDefaultTieFormat:yw(u),tieFormat:yw(p),structure:n}}Oi(JN,{compareTieFormats:()=>ZN,getTieFormat:()=>rE,tieFormatGenderValidityCheck:()=>pc,validateCollectionDefinition:()=>pd});var nE={};function aE({tournamentRecord:e,outcomes:t}){if(!e)return{error:zr};if(!t?.length)return{error:va,info:"Missing outcomes"};let i=t.reduce(((e,t)=>{let{drawId:i,eventId:r}=t;return r&&i&&(e[r]?e[r].includes(i)||e[r].push(i):e[r]=[i]),e}),{}),r=Object.keys(i);return{publishedEventIds:(e.events?.filter((e=>r.includes(e.eventId)))).filter((e=>{let t=rv({event:e}),{drawDetails:r,drawIds:n}=t??{},{eventId:a}=e;return i[a].filter((e=>{let i=r?Object.keys(t.drawDetails).filter((e=>nv({drawId:e,drawDetails:r}))):[];return n?.includes(e)||i.includes(e)})).length})).map((e=>e.eventId)),eventIdPublishedDrawIdsMap:i}}function oE({dates:e=[],extension:t}){if(!t)return!1;if("boolean"==typeof t.value&&t.value)return!0;if(!e.length)return!1;let i=Rr(t.value)?t.value?.dates:void 0;return Array.isArray(i)?!!i?.length&&!!i.filter((t=>!e.length||e.includes(t))).length:void 0}function sE({convertExtensions:e,ignoreDisabled:t,venue:i,court:r}){let n={...yd(r,e,!0),venueId:i.venueId},{extension:a}=Jp({name:tm,element:r});if(t&&a){let e=Rr(a.value)?a.value?.dates:void 0,t=!0===a?.value?[]:n.dateAvailability.map((t=>{let i=t.date;if(i&&!e.includes(i))return t})).filter(Boolean);n.dateAvailability=t}return{inContextCourt:n}}function cE(e){let{convertExtensions:t,ignoreDisabled:i,venueIds:r=[],dates:n}=e,a=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},o=[],s=[],c=[],d=[];return Object.keys(a).filter((t=>!e.tournamentId||t===e.tournamentId)).forEach((e=>{let u=a[e];for(let a of u.venues??[])if(!r.length||r.includes(a.venueId)){if(i){let{extension:e}=Jp({name:tm,element:a});if(e?.value)continue}o.includes(a.venueId)||(d.push(yd(a,t,!0)),o.push(a.venueId));for(let e of a.courts??[])if(!s.includes(e.courtId)){if(i){let{extension:t}=Jp({name:tm,element:e});if(oE({extension:t,dates:n}))continue}let{inContextCourt:r}=sE({convertExtensions:t,ignoreDisabled:i,venue:a,court:e});c.push(r),s.push(e.courtId)}}})),{courts:c,venues:d,..._r}}function dE({tournamentRecords:e,requireCourts:t,dates:i}){return"object"==typeof e&&Object.keys(e).length?Object.keys(e).reduce(((r,n)=>{let a=e[n],{venues:o}=function({convertExtensions:e,tournamentRecord:t,ignoreDisabled:i,dates:r}){if(!t)return{error:Hr};let n=yd(t.venues??[],e).filter((e=>{if(!i)return e;let{extension:t}=Jp({name:tm,element:e});return!t?.value&&e})).filter(Boolean),a=n.reduce(((t,n)=>{let a=(n?.courts||[]).filter((e=>{if(!i&&!r?.length)return e;let{extension:t}=Jp({name:tm,element:e});return oE({extension:t,dates:r})})).filter(Boolean).map((t=>{let{inContextCourt:r}=sE({convertExtensions:e,ignoreDisabled:i,venue:n,court:t});return r}));return a.length?t.concat(a):t}),[]);return{venues:n,courts:a}}({tournamentRecord:a,dates:i});return o?.forEach((e=>{let{venueId:i,courts:n}=e;(!t||n?.length)&&!r.venueIds.includes(i)&&(r.venues.push(e),r.venueIds.push(i))})),r}),{venues:[],venueIds:[]}):{error:Hr}}function uE({tournamentRecord:e,policyDefinitions:t}){if(!e)return{error:zr};let i=e.events||[],r=e?.participants||[],{tournamentInfo:n}=jN({tournamentRecord:e}),{venues:a}=cE({tournamentRecord:e});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:i.map((i=>{let{eventId:n}=i,a=BN({event:i}).eventInfo,o=zh({tournamentRecord:e,event:i}).scheduleTiming,s=(i.drawDefinitions||[]).map((a=>{let s=(({drawId:e,drawName:t,matchUpFormat:i,updatedAt:r})=>({matchUpFormat:i,updatedAt:r,drawName:t,drawId:e}))(a),{abandonedMatchUps:c,completedMatchUps:d,upcomingMatchUps:u,pendingMatchUps:l}=Iy({requireParticipants:!0,tournamentParticipants:r,context:{eventId:n},policyDefinitions:t,tournamentRecord:e,inContext:!0,scheduleTiming:o,drawDefinition:a,event:i});return{drawInfo:s,matchUps:{abandonedMatchUps:c,completedMatchUps:d,upcomingMatchUps:u,pendingMatchUps:l}}})),c=rv({event:i});return Object.assign(a,{drawsData:s,publish:c}),a}))}}}function lE({publishStatus:e,drawId:t}){return e?.drawDetails?e.drawDetails?.[t]?.publishingDetail?.published:!e?.drawIds||e.drawIds.includes(t)}Oi(nE,{bulkUpdatePublishedEventIds:()=>aE,getAllEventData:()=>uE,getCourtInfo:()=>YI,getDrawData:()=>fE,getEventData:()=>hE,getEventPublishStatus:()=>rv,getPublishState:()=>av,getTournamentPublishStatus:()=>iv,getVenueData:()=>KI});var pE="PUBLIC",mE={PUBLIC_DISPLAY:pE,ADMIN_DISPLAY:"ADMIN"};function fE(e){let{tournamentParticipants:t=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:o,status:s=fI,pressureRating:c,refreshResults:d,contextProfile:u,drawDefinition:l,noDeepCopy:p,sortConfig:m,context:f,event:h}=e;if(!l)return{error:Jr};let g=(({matchUpFormat:e,updatedAt:t,drawType:i,drawName:r,drawId:n})=>({matchUpFormat:e,updatedAt:t,drawName:r,drawType:i,drawId:n}))(l);g.display=Jp({element:l,name:nm}).extension?.value;let I,y,v={},{allStructuresLinked:S,sourceStructureIds:U,hasDrawFeedProfile:b,structureGroups:w}=hU({drawDefinition:l});if(!S)return{error:On};let T=e?.eventPublishState??av({event:h}).publishState,D=e?.publishStatus??rv({event:h,status:s}),P=T?.status?.drawDetails?.[l.drawId],N=!!T?.status?.published,E=P?.structureDetails,M=!1,R=!1,C=w.map((s=>{let p={},S=s.map((e=>{let{structure:t}=lf({drawDefinition:l,structureId:e}),{seedAssignments:i}=yg({drawDefinition:l,structure:t});return t?.stage===vu&&1===t.stageSequence&&(I=i),t?.stage===Su&&(v[t.stageSequence??0]=i),t})).sort(((e,t)=>df(e,t,m))).map((i=>{if(!i)return;let s=i?.structureId,m=[];i.stage&&[vu,Uu,wu].includes(i.stage)&&(m=I),i?.stage===Su&&(m=v[i.stageSequence??0]);let{matchUps:S,roundMatchUps:w,roundProfile:T}=oy({seedAssignments:i?.seedAssignments?.length?void 0:m,context:{drawId:g.drawId,...f},hydrateParticipants:e.hydrateParticipants,participantsProfile:e.participantsProfile,tournamentParticipants:t,policyDefinitions:r,tournamentRecord:n,usePublishState:o,publishStatus:D,contextProfile:u,drawDefinition:l,inContext:a,structure:i,event:h}),{positionAssignments:P}=ff({structure:i}),N=P?.filter(Dy(Ml)).map((e=>{let t=Jp({element:e,name:Sm})?.extension?.value,{drawPosition:i,participantId:r}=e;return R=!0,{participantResult:t,participantId:r,drawPosition:i}}));if(S.length&&(!N?.length&&e.allParticipantResults||d&&!i.structures)){let{subOrderMap:e}=aw({positionAssignments:P}),t=S.some((e=>e.matchUpType===$i))?S.filter((e=>e.matchUpType===$i)):S,n=nw({matchUpFormat:i.matchUpFormat,matchUps:t,policyDefinitions:r,pressureRating:c,subOrderMap:e});y=n?.report,N=P?.filter(Dy(Ml)).map((e=>{let{drawPosition:t,participantId:i}=e;return R=!0,{participantResult:i&&n?.participantResults?.[i],participantId:i,drawPosition:t}}))}let E=i?(({stageSequence:e,structureName:t,structureType:i,matchUpFormat:r,stage:n})=>({stageSequence:e,structureName:t,structureType:i,matchUpFormat:r,stage:n}))(i):{},C=Jp({element:i,name:nm}).extension?.value;E.display=C?.[pE]??C,E.sourceStructureIds=U[s],E.hasDrawFeedProfile=b[s],E.positionAssignments=P,E.structureActive=S.reduce(((e,t)=>{let i=[qm,Wm,Hm,jm,Vm,Gm,Km,Qm].includes(t.matchUpStatus);return e||i||!!t.winningSide||!!t.score?.scoreStringSide1}),!1);let A=S.reduce(((e,t)=>e&&["BYE",jm,Km,Qm,Gm,_m].includes(t.matchUpStatus)),!!S.length);return E.structureCompleted=A,p[s]=A,E.structureActive&&(M=!0),{...E,participantResults:N,seedAssignments:m,roundMatchUps:w,roundProfile:T,structureId:s,report:y}}));return S.forEach((e=>{i||delete e.positionAssignments,e.sourceStructuresComplete=e.sourceStructureIds?.every((e=>p[e]))})),S})).flat().filter((e=>!o||E?.[e?.structureId]?.published||!0));return g.drawActive=M,g.participantPlacements=R,g.drawGenerated=C?.reduce(((e,t)=>e||!!t?.roundMatchUps),!1),g.drawCompleted=C?.reduce(((e,t)=>e&&t.structureCompleted),!0),g.drawPublished=o?N&&lE({publishStatus:D,drawId:g.drawId}):void 0,{structures:!o||g.drawPublished?p&&C||yd(C,!1,!0):void 0,drawInfo:p?g:yd(g,!1,!0),..._r}}function hE(e){let{includePositionAssignments:t,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=fI,contextProfile:o,sortConfig:s}=e,c=dp(e,[{tournamentRecord:!0},{[np]:{event:!1,eventId:!1}}]);if(c.error)return c;let d=yd(e.tournamentRecord,!1,!0),u=e.event?void 0:JI({tournamentRecord:d,eventId:e.eventId}).event,l=e.event?yd(e.event,!1,!0):u&&yd(u,!1,!0)||void 0;if(!l)return{error:Ln};let{eventId:p}=l,{tournamentId:m,endDate:f}=d,h=rv({event:l,status:a}),g=av({event:l}).publishState??{},I=!!g?.status?.published,{participants:y}=mv({withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:d}),v=l.drawDefinitions||[],S=!n||I?v.filter((({drawId:e})=>!n||lE({publishStatus:h,drawId:e}))).map((i=>(({drawInfo:e,structures:t})=>({...e,structures:t}))(fE({allParticipantResults:e.allParticipantResults,hydrateParticipants:e.hydrateParticipants,context:{eventId:p,tournamentId:m,endDate:f},pressureRating:e.pressureRating,refreshResults:e.refreshResults,includePositionAssignments:t,tournamentParticipants:y,eventPublishState:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:d,usePublishState:n,contextProfile:o,drawDefinition:i,publishStatus:h,sortConfig:s,event:l})))).map((({structures:e,...t})=>{let i=e?.filter((({stage:e,structureId:i})=>(({structureId:e,drawId:t})=>{if(!n)return!0;let i=h?.drawDetails?.[t]?.structureDetails;return!i||!Object.keys(i).length||i[e]?.published})({structureId:i,drawId:t.drawId})&&(({stage:e,drawId:t})=>{if(!n)return!0;let i=h?.drawDetails?.[t]?.stageDetails;return!i||!Object.keys(i).length||i[e]?.published})({stage:e,drawId:t.drawId}))).map((e=>(({drawId:e,structure:t})=>{if(!n)return t;let i=h?.drawDetails?.[e]?.structureDetails?.[t.structureId]?.roundLimit;if(ir(i)){let e=gr(1,i+1),r={},n={};for(let i of e)t.roundMatchUps[i]&&(r[i]=t.roundMatchUps[i],n[i]=t.roundProfile[i]);t.roundMatchUps=r,t.roundProfile=n}return t})({drawId:t.drawId,structure:e})));return{...t,structures:i}})).filter((e=>e.structures?.length)):void 0,U=(Array.isArray(d.venues)?d.venues:[]).map((e=>(({venueData:e})=>({...e}))(KI({venueId:e.venueId,tournamentRecord:d})))),b=(({eventId:e,eventName:t,eventType:i,eventLevel:r,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:d,ballType:u,discipline:l})=>({eventId:e,eventName:t,eventType:i,eventLevel:r,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:d,ballType:u,discipline:l}))(l);b.display=Jp({element:l,name:nm}).extension?.value;let{tournamentInfo:w}=jN({tournamentRecord:d}),T={tournamentInfo:w,venuesData:U,eventInfo:b,drawsData:S};return T.eventInfo.publishState=g,T.eventInfo.published=g?.status?.published,{..._r,eventData:T,participants:y}}var gE={};function IE({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:t,timeAfterRecovery:i,matchUp:r}){let{individualParticipantIds:n}=oh(r);i=i??r.schedule?.timeAfterRecovery;let a=t=>{e[t]||(e[t]=[]),e[t]=ar(e[t].concat(...n))},o=e=>{i&&(!t[e]||i>t[e])&&(t[e]=i)},s=r.winnerTo?.matchUpId||r.winnerMatchUpId;s&&(i&&o(s),a(s));let c=r.loserTo?.matchUpId||r.loserMatchUpId;c&&(i&&o(c),a(c)),r.sidesTo?.length&&r.sidesTo.forEach((({matchUpId:e})=>{e&&(i&&o(e),a(e))}))}function yE(e){let t=dp(e,[{[Gl]:!0}]);if(t.error)return t;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:r=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:c,matchUps:d}=e,u=o?Object.keys(o):[],l=(s??[]).map((e=>d.find((t=>t.matchUpId===e)))).filter(Boolean).filter((e=>{let t=!c&&(r.includes(e.matchUpId)||u.includes(e.matchUpId)),i=["BYE",Gm,jm,_m,Km,Qm,qm,Wm].includes(e?.matchUpStatus);return n||!t&&!e.winningSide&&!i})),p=i&&a?l.reduce(((e,t)=>{let{drawId:r,tournamentId:n}=t;return e.matchUpMap[n]||(e.matchUpMap[n]={}),e.matchUpMap[n][r]?e.matchUpMap[n][r].push(t):e.matchUpMap[n][r]=[t],IE({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:t}),e}),{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:l,matchUpMap:p}}function vE({defaultRecoveryMinutes:e=0,defaultAverageMinutes:t,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:c}){if(!Ec({matchUpFormat:r}))return{error:Yn};let d;return Object.keys(i).filter((e=>!o||e===o)).forEach((e=>{if(d)return;let t=i[e],o=c?JI({tournamentRecord:t,eventId:c})?.event:void 0;return d=OI({tournamentRecord:t,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:o}),d?.averageMinutes||d?.recoveryMinutes})),{recoveryMinutes:d?.recoveryMinutes||e,averageMinutes:d?.averageMinutes||t,typeChangeRecoveryMinutes:d?.typeChangeRecoveryMinutes||d?.recoveryMinutes||e}}function SE(e){let t=dp(e,[{[np]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[rp]:Zl}]);if(t.error)return t;let{scheduleCompletedMatchUps:i,periodLength:r=30}=e,n=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{};if("object"!=typeof n)return{error:Hr};let a={},o=[],s=e.rounds.toSorted(((e,t)=>(e.sortOrder??0)-(t.sortOrder??0))),c=e.containedStructureIds??Object.assign({},...Object.values(n).map((e=>ah({tournamentRecord:e}).containedStructures))),d=e.matchUps??Sy({nextMatchUps:!0,tournamentRecords:n}).matchUps,u=0,l={},p={},m={};return{scheduledRoundsDetails:s.flatMap((e=>{let t=e.periodLength||r,s=[];c?.[e.structureId]?s.push(...c[e.structureId]):s.push(e.structureId);let f=d?ay({tournamentIds:[e.tournamentId],roundNumbers:[e.roundNumber],matchUpIds:e.matchUpIds,eventIds:[e.eventId],drawIds:[e.drawId],processContext:!0,structureIds:s,matchUps:d}).sort(Uy):[],{segmentNumber:h,segmentsCount:g}=e.roundSegment||{};if(ir(h)&&Yi(f?.length)&&Yi(g)&&h>0&&h<=g&&g<f?.length&&!e.matchUpIds?.length){let e=f.length/g,t=e*(h-1);f=f.slice(t,t+e)}let I=n[e.tournamentId],y=JI({drawId:e.drawId,tournamentRecord:I}).event,v=[];for(let i of f){let e=i.matchUpFormat;e&&(a[e]||(a[e]=[],a[e].push(i)),v.push(e))}for(let r of v){let{eventType:a,category:s}=y??{},{categoryName:c,ageCategoryCode:d}=s??{},{typeChangeRecoveryMinutes:h,recoveryMinutes:g,averageMinutes:I,error:v}=vE({categoryName:c??d,categoryType:s?.categoryType,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:n,matchUpFormat:r,eventType:a});if(v)return{error:v,round:e};let S=f.filter((e=>(i||!af.includes(e.matchUpStatus))&&"BYE"!==e.matchUpStatus)).map(xm);return S.forEach((e=>{m[e]={typeChangeRecoveryMinutes:h,recoveryMinutes:g,averageMinutes:I},l[e]=g,p[e]=I})),o.push(...S),u=Math.max(I||0,u),{roundPeriodLength:t,recoveryMinutes:g,averageMinutes:I,matchUpIds:S,hash:`${I}|${t}`}}})),greatestAverageMinutes:u,matchUpFormatCohorts:a,recoveryMinutesMap:l,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,..._r}}function UE({schedulingProfile:e,venueIds:t,eventIds:i,drawIds:r}){let n=[],a=e?.map((e=>{let a=Yc(e?.scheduleDate);if(!a)return void n.push(`Invalid date: ${e?.scheduledDate}`);let o=(e?.venues||[]).map((e=>{let{rounds:a,venueId:o}=e;if(!t?.includes(o))return void n.push(`Missing venueId: ${o}`);let s=a.filter((e=>{let t=i.includes(e.eventId)&&r.includes(e.drawId);return t||n.push(`Invalid eventId: ${e.eventId} or drawId: ${e.drawId}`),t}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...e,venues:o}})).filter(Boolean);return{updatedSchedulingProfile:a,modifications:n.length,issues:n}}function bE({tournamentRecords:e,schedulingProfile:t}){if(!t)return{valid:!0};if(!Array.isArray(t))return{valid:!1,error:Ho};let i,r,{venueIds:n,tournamentsMap:a}=function(e){let t=e?.tournamentRecords&&Object.values(e?.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=t.reduce(((e,t)=>{let{tournamentIds:r,tournamentMap:n,structureIds:a,venueIds:o,eventIds:s,drawIds:c}=function(e){let{tournamentRecord:t={},tournamentMap:i={},requireCourts:r}=e,n=[],a=[],o=[],s=[],c=(t?.venues||[]).map((({venueId:e,courts:t})=>(!r||t?.length)&&e)),d=t?.tournamentId;if(d){n.push(d),i[d]={};let e=t?.events||[];for(let t of e){let e=t.eventId;o.push(e),i[d][e]={};let r=e=>parseInt(e);for(let n of t.drawDefinitions||[]){let t=n.drawId;s.push(t),i[d][e][t]={};let{structures:o}=pf({drawDefinition:n});for(let n of o||[]){let o=n.structureId,{matchUps:s}=oy({structure:n}),{roundMatchUps:c}=Ng({matchUps:s}),u=c&&Object.keys(c).map(r);if(i[d][e][t][o]=u,a.push(o),n.structures?.length)for(let r of n.structures)a.push(r.structureId),i[d][e][t][r.structureId]=u}}}}return{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:c,eventIds:o,drawIds:s}}({tournamentRecord:t});return o.forEach((t=>{e.venueIds.includes(t)||e.venueIds.push(t)})),e.tournamentIds.push(...r),e.structureIds.push(...a),e.eventIds.push(...s),e.drawIds.push(...c),Object.assign(i,n),e}),{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}({tournamentRecords:e}),o=t.every((e=>{let{scheduleDate:t,venues:o}=e;return!!Fc(t)&&o.every((e=>{let{venueId:t,rounds:o}=e;return"string"!=typeof t?(r="venueId should be a string",!1):Array.isArray(o)?n.includes(t)?!!o.every((e=>{if(!e)return r="empty round",!1;let{roundSegment:t,tournamentId:i,structureId:n,roundNumber:o,eventId:s,drawId:c}=e,d=a?.[i]?.[s]?.[c]?.[n]?.includes(o);d||(r="Invalid rounds");let{segmentNumber:u,segmentsCount:l}=t||{},p=!t||ir(u)&&Yi(l)&&u<=l;return p||(r="Invalid segment"),d&&p})):(i=wo,!1):(r="rounds should be an array",!1)}))}));return!o&&!i&&(i=Ho),{valid:!!o,error:i,info:r}}function wE({tournamentRecords:e,tournamentRecord:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Hr};let{extension:i}=Jp({element:t,name:ym,tournamentRecords:e,discover:!0}),r=i?.value||[];if(r.length){let{venueIds:i}=dE({requireCourts:!0,tournamentRecords:e}),{eventIds:n,drawIds:a}=vw({tournamentRecords:e}),{updatedSchedulingProfile:o,modifications:s,issues:c}=UE({schedulingProfile:r,venueIds:i,eventIds:n,drawIds:a});if(s){r=o;let i=TE({tournamentRecords:e,tournamentRecord:t,schedulingProfile:r});return i.error?i:{schedulingProfile:r,modifications:s,issues:c}}}return{schedulingProfile:r,modifications:0}}function TE({tournamentRecords:e,tournamentRecord:t,schedulingProfile:i}){let r=bE({tournamentRecords:e,schedulingProfile:i});return r.error?r:i?Vp({tournamentRecords:e,discover:!0,extension:{name:ym,value:i}}):_p({element:t,name:ym,tournamentRecords:e,discover:!0})}function DE(e){let{tournamentRecord:t}=e,i=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!e.schedulingProfile){let{modifications:e,issues:r}=wE({tournamentRecords:i,tournamentRecord:t});return{success:!e,modifications:e,issues:r}}let{venueIds:r}=dE({tournamentRecords:i}),{eventIds:n,drawIds:a}=vw({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:c}=UE({schedulingProfile:e.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...TE({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:c}:{..._r,modifications:s,issues:c}}function PE(e){let{scheduleDates:t=[],tournamentRecords:i,periodLength:r=30}=e??{};if("object"!=typeof i)return{error:Yr};if(!Array.isArray(t))return{error:Ho};if(!t.every(Fc))return{error:Pa};let n=[],a=0,o={},{schedulingProfile:s}=wE({tournamentRecords:i});if(!s)return{issues:n,..._r};let{matchUps:c}=Sy({nextMatchUps:!0,tournamentRecords:i});for(let d of s){let{scheduleDate:e,venues:s=[]}=d;if(!t?.length||t.includes(e))for(let t of s||[])if(t){let{rounds:s}=t,d=[],{orderedMatchUpIds:u,scheduledRoundsDetails:l}=SE({tournamentRecords:i,periodLength:r,matchUps:c,rounds:s}),{matchUpDependencies:p}=Ey({tournamentRecords:i,matchUps:c}),m=e=>{let t;return l?.find(((i,r)=>{let n=i.matchUpIds.includes(e);return n&&(t=r),n})),t};if(u?.forEach(((e,t)=>{let i=yr(u.slice(t+1),p?.[e]?.matchUpIds||[]);i.length&&d.push({matchUpId:e,shouldBeAfter:i})})),d.length){a+=d.length;let t=d.map((({matchUpId:t,shouldBeAfter:i})=>{let r=m(t),n=ar(i.map(m));return o[e]||(o[e]={}),o[e][r]||(o[e][r]=[]),n.forEach((t=>{o[e][r].includes(t)||o[e][r].push(t)})),{matchUpId:t,matchUpRoundIndex:r,earlierRoundIndices:n,shouldBeAfter:i}}));n.push(...t)}}}return{issuesCount:a,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...n.map((e=>{let{matchUpId:t,shouldBeAfter:i,earlierRoundIndices:r}=e;return{[t]:{earlierRoundIndices:r,shouldBeAfter:i}}})))},roundIndexShouldBeAfter:o,..._r}}function NE(e){let{tournamentRecords:t,requestType:i}=e,r=dp(e,[{[bl]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(t)){let{extension:e}=Jp({element:a,name:mm}),t=e?.value||[];for(let r of t){let{personId:e,requests:t}=r||{};n[e]||(n[e]=[]);for(let r of t)i&&r.requestType!==i||n[e].push(r)}}return{personRequests:n,..._r}}function EE(e){let{containerStructureId:t,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:c}=e,d=r?t:o,u=[n,s,c,d,a].join("|");return Js({structureId:d,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:c,id:u})}function ME({round:e,matchUps:t,events:i,tournamentRecords:r}){let n=i.find((t=>t.eventId===e.eventId)),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:c,ageCategoryCode:d}=o||{},u=dr(t.map((({matchUpFormat:e})=>e))),l=0;return Object.keys(u).forEach((t=>{let i=u[t],n=vE({categoryName:c||d,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:r,matchUpFormat:t,categoryType:s,eventType:a});if(n.error)return n;let o=n.averageMinutes*i;isNaN(l)||(l+=o)})),{roundMinutes:l}}function RE(e){let t=e.length,i=e.filter((({sides:e})=>e?.some((({bye:e})=>e)))).length||0,r=e.filter((({winningSide:e,matchUpStatus:t})=>e||af.includes(t))).length||0,n=e.filter((({schedule:e,matchUpStatus:t})=>e?.scheduledDate&&e?.scheduledTime&&"BYE"!==t)).length||0,a=t-i;return{unscheduledCount:a-n,incompleteCount:a-n,scheduledCount:n,completedCount:r,matchUpsCount:t,isScheduled:a===n,isComplete:a===r,byeCount:i}}function CE({tournamentRecords:e,schedulingProfile:t,tournamentRecord:i,withRoundId:r}){if(i&&!e){if("object"!=typeof i)return{error:Yr};e={[i.tournamentId]:i}}if(t){let i=bE({tournamentRecords:e,schedulingProfile:t});if(i.error)return i}if(!t&&e){let i=wE({tournamentRecords:e});if(i.error)return i;t=i.schedulingProfile}if(!t)return{error:Qo};let n={};return{profileRounds:t.map((({venues:e,scheduleDate:t})=>e.map((({rounds:e})=>e.map((e=>{let i=EE(e);return i.roundSegment?.segmentsCount&&(n[i.id]=i.roundSegment.segmentsCount),Js({id:r?i.id:void 0,scheduleDate:t,...i})})))))).flat(1/0),segmentedRounds:n}}function AE({court:e,date:t}){let i=t&&e.dateAvailability.find((e=>ad(e.date,t))),r=e.dateAvailability.find((e=>!e.date));return i||r}function kE({courtPrefix:e="C|",minRowsCount:t,courtsData:i,scheduledDate:r}){if(!Array.isArray(i))return{error:Ho};let n=i?.reduce(((e,t)=>{let i=t.matchUps||[],r=Math.max(0,...i.map((e=>e.schedule.courtOrder||0)));return Math.max(r,e)}),1),a=gr(0,Math.max(t||0,n)).map((e=>({matchUps:gr(0,i.length).map((t=>{let n=i[t],{courtId:a,venueId:o}=n;if(r){let{gridBookings:t}=function({court:e,date:t}){let i=AE({court:e,date:t}),r=new Map,n=[];return(i?.bookings||[]).forEach((e=>{if("number"==typeof e.courtOrder){let t=e.rowCount||1;for(let i=0;i<t;i++)r.set(e.courtOrder+i,e)}else n.push(e)})),{gridBookings:r,timeBookings:n}}({court:n,date:r});if(t.has(e+1)){let i=t.get(e+1);return{schedule:{courtOrder:e+1,venueId:o,courtId:a},isBlocked:!0,booking:i}}}return{schedule:{courtOrder:e+1,venueId:o,courtId:a}}}))})));return i.forEach(((e,t)=>{for(let i of e.matchUps){let e=i.schedule?.courtOrder;e&&(a[e-1].matchUps[t]=i)}})),{courtPrefix:e,rows:a.map(((t,i)=>Object.assign({rowId:`rowId-${i+1}`},...t.matchUps.map(((t,i)=>({[`${e}${i}`]:t}))))))}}Oi(gE,{courtGridRows:()=>kE,findVenue:()=>WI,getMatchUpsToSchedule:()=>yE,getPersonRequests:()=>NE,getProfileRounds:()=>CE,getScheduledRoundsDetails:()=>SE,getSchedulingProfile:()=>wE,getSchedulingProfileIssues:()=>PE,publicFindCourt:()=>zI});var OE={};function xE({policyDefinitions:e,drawDefinition:t,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:Fn};let{entries:o,stageEntries:s}=_v({drawDefinition:t,drawId:r,stage:a,event:n}),c=s.length,{drawSize:d}=OT({participantsCount:c}),u=xT({drawSize:i??d,participantsCount:c,policyDefinitions:e});if(u.error)return Qs({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:l}=u;return{entries:o,seedsCount:l,stageEntries:s}}function FE(e){let{entries:t=[],entryStatus:i,stage:r}=e;return Math.max(...t.filter((e=>!(r&&r!==e.entryStage||i&&e.entryStatus!==i||isNaN(e.entryPosition)))).map((({entryPosition:e})=>zi(e||0))),0)}Oi(OE,{getEntriesAndSeedsCount:()=>xE,getMaxEntryPosition:()=>FE});var LE={};function _E({tournamentRecords:e,extensionName:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Hr};let i,r=[];for(let n of Object.values(e)){let{extension:e}=Jp({element:n,name:t});e&&!i&&(r.push({params:{extension:e,discover:!0},method:"addExtension"}),i=!0);let a=n.events??[];for(let i of a){let{eventId:e}=i,{extension:n}=Jp({name:t,element:i});n&&r.push({params:{eventId:e,extension:n},method:"addEventExtension"})}}return{methods:r}}function BE({tournamentRecords:e}){return _E({extensionName:Im,tournamentRecords:e})}Oi(LE,{allCompetitionMatchUps:()=>Sy,allDrawMatchUps:()=>by,allEventMatchUps:()=>yy,allTournamentMatchUps:()=>vy,analyzeMatchUp:()=>hM,calculateWinCriteria:()=>aM,checkMatchUpIsComplete:()=>sy,competitionScheduleMatchUps:()=>eM,drawMatchUps:()=>gM,eventMatchUps:()=>JE,filterMatchUps:()=>ay,getAllDrawMatchUps:()=>gy,getAllStructureMatchUps:()=>oy,getCheckedInParticipantIds:()=>II,getCompetitionMatchUps:()=>ZE,getEventMatchUpFormatTiming:()=>qE,getHomeParticipantId:()=>oM,getMatchUpCompetitiveProfile:()=>Vg,getMatchUpContextIds:()=>sM,getMatchUpDailyLimits:()=>tM,getMatchUpDailyLimitsUpdate:()=>zE,getMatchUpDependencies:()=>Ey,getMatchUpFormat:()=>uM,getMatchUpFormatTiming:()=>OI,getMatchUpFormatTimingUpdate:()=>BE,getMatchUpScheduleDetails:()=>QI,getMatchUpType:()=>iy,getMatchUpsStats:()=>lM,getModifiedMatchUpFormatTiming:()=>HE,getParticipantResults:()=>Gb,getPredictiveAccuracy:()=>iM,getRoundMatchUps:()=>Ng,getRounds:()=>fM,isValidMatchUpFormat:()=>Ec,matchUpActions:()=>PT,participantScheduledMatchUps:()=>KE,tallyParticipantResults:()=>nw,tournamentMatchUps:()=>QE,validMatchUp:()=>Dg,validMatchUps:()=>Pg});var VE="ADULT",jE="JUNIOR",$E="WHEELCHAIR",GE={[Ep]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[ji]:30,default:60}}]},defaultDailyLimits:{[Bi]:2,[ji]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Ad],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[$E],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[VE,$E],minutes:{default:60,[ji]:30}},{categoryTypes:[jE],minutes:{default:60,[ji]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[VE,$E],minutes:{default:30}},{categoryTypes:[jE],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[VE,jE],minutes:{default:30}},{categoryTypes:[$E],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},WE=GE;function qE({tournamentRecord:e,matchUpFormats:t,categoryType:i,event:r}){if(!r)return{error:Fn};let n,a=[];if(t?.length){let e=[];a=t.map((t=>{let i="string"==typeof t?{matchUpFormat:t}:t;if(!e.includes(i?.matchUpFormat)&&Ec({matchUpFormat:i?.matchUpFormat}))return e.push(i.matchUpFormat),i})).filter(Boolean)}else{let{policy:t}=Hh({policyType:Rp,tournamentRecord:e,event:r});if(t?.matchUpFormats)a=t?.matchUpFormats;else{let e,t,{extension:i}=Jp({name:Im,element:r});({matchUpAverageTimes:e,matchUpRecoveryTimes:t}=i?.value?i.value:WE[Ep]),a=ar([...(e||[]).map((e=>e.matchUpFormatCodes)),...(t||[]).map((e=>e.matchUpFormatCodes))].flat()).map((e=>({matchUpFormat:e}))),n="default scheduling policy in use"}}let{eventType:o,eventId:s,category:c}=r,d=c?.categoryName??c?.ageCategoryCode??s;return s?Js({eventMatchUpFormatTiming:a.map((({matchUpFormat:t,description:n})=>({matchUpFormat:t,description:n,...OI({tournamentRecord:e,matchUpFormat:t,categoryName:d,categoryType:i,eventType:o,event:r})}))),info:n}):{error:Fn}}function HE(e){let t=dp(e,[{[Tl]:!0},{[ep]:e=>Ec({matchUpFormat:e}),[ip]:Yn,[El]:!0}]);if(t.error)return t;let{tournamentRecord:i,matchUpFormat:r,event:n}=e,{extension:a}=Jp({name:Im,element:n}),o=a?.value,{extension:s}=Jp({element:i,name:Im}),c=s?.value,d=[o?.matchUpAverageTimes&&vI({...o,matchUpFormat:r}),c?.matchUpAverageTimes&&vI({...c,matchUpFormat:r})].find((e=>e));return{matchUpFormat:r,recoveryTimes:[o?.matchUpRecoveryTimes&&SI({...o,matchUpFormat:r}),c?.matchUpRecoveryTimes&&SI({...c,matchUpFormat:r})].find((e=>e)),averageTimes:d}}function zE({tournamentRecords:e}){return _E({extensionName:gm,tournamentRecords:e})}var YE=({scheduleAttributes:e=["scheduledDate","scheduledTime"],schedule:t={}})=>!!Object.keys(t).filter((t=>e.includes(t))).filter((e=>t[e])).length;function KE({scheduleAttributes:e=["scheduledDate","scheduledTime"],matchUps:t=[]}){if(!Pg(t))return{error:oa};if(!Array.isArray(e))return{error:Ho};let i=t.filter(Boolean).filter((({schedule:t})=>YE({schedule:t,scheduleAttributes:e}))).reduce(((e,t)=>{let{schedule:i}=t,r=Yc(i?.scheduledDate),n=zc(i?.scheduledTime);return r&&n&&(e[r]?e[r].push(t):e[r]=[t]),e}),{});return Object.keys(i).forEach((e=>{i[e].sort(((e,t)=>Qc(zc(e.schedule?.scheduledTime),zc(t.schedule?.scheduledTime))))})),{..._r,scheduledMatchUps:i}}function XE({schedulingProfile:e,matchUps:t=[]}){let i={},r=({eventId:e,drawId:t,structureId:i,roundNumber:r})=>`${e}|${t}|${i}${r}`;e?.length&&e.map((({venues:e})=>e.map((({rounds:e})=>e)))).flat().forEach((e=>{e.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))).forEach((({eventId:e,drawId:t,structureId:n,roundNumber:a},o)=>{let s=r({eventId:e,drawId:t,structureId:n,roundNumber:a});i[s]=o}))}));let n=[],a={noScheduledDate:[]};for(let s of t){let e=s.schedule||{},t=e.scheduledDate&&Yc(e.scheduledDate)||e.scheduledTime&&Yc(e.scheduledTime)||"noScheduledDate";a[t]||(a[t]=[]),a[t].push(s)}let o=Object.keys(a).sort();for(let s of o){let e=a[s],t={noScheduledTime:[]};for(let i of e){let e=i.schedule||{},r=e.scheduledTime&&zc(e.scheduledTime)||"noScheduledTime";t[r]||(t[r]=[]),t[r].push(i)}for(let i of Object.keys(t)){let e=t[i].sort(((e,t)=>(e.roundNumber||0)-(t.roundNumber||0)));t[i]=e}let o=Object.keys(t).sort();for(let a of o){let e=t[a];e.sort(((e,t)=>(i[r(e)]||0)-(i[r(t)]||0))),n.push(...e)}}return n}function JE(e){let{participants:t,contextContent:i,participantMap:r}=e,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:d,tournamentRecord:u,usePublishState:l,contextFilters:p,matchUpFilters:m,contextProfile:f,nextMatchUps:h,tournamentId:g,inContext:I,context:y,event:v}=e;if(!v)return{error:Fn};let S,{eventId:U,eventName:b,endDate:w,eventType:T,category:D,gender:P}=v??{},N={...y,...Js({surfaceCategory:v.surfaceCategory??u?.surfaceCategory,indoorOutDoor:v.indoorOutdoor??u?.indoorOutdoor,tournamentId:g??u?.tournamentId,endDate:w??u?.endDate,eventName:b,eventType:T,category:D,eventId:U,gender:P})};!t&&u&&({participants:t,participantMap:r,groupInfo:S}=xh({participantsProfile:o,useParticipantMap:d,tournamentRecord:u,contextProfile:f,inContext:I})),f&&!i&&(i=qh({policyDefinitions:c,tournamentRecord:u,contextProfile:f,event:v}));let E=rv({event:v});return{...(v.drawDefinitions??[]).reduce(((d,g)=>{let y=Iy({hydrateParticipants:e.hydrateParticipants,context:N,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:t,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:u,usePublishState:l,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:E,contextProfile:f,drawDefinition:g,nextMatchUps:h,inContext:I,event:v});return Object.keys(y)?.forEach((e=>{Array.isArray(y[e])&&(d[e]||(d[e]=[]),d[e]=d[e].concat(y[e]))})),d}),{}),..._r,groupInfo:S}}function QE(e){if(!e?.tournamentRecord)return{error:zr};let t=e.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:c,contextFilters:d,matchUpFilters:u,contextProfile:l,nextMatchUps:p,context:m}=e,f=e.tournamentId??o.tournamentId,h=o?.events??[],{participants:g,participantMap:I,groupInfo:y}=xh({participantsProfile:r,tournamentRecord:o,contextProfile:l,inContext:s});l&&!t&&(t=qh({policyDefinitions:a,tournamentRecord:o,contextProfile:l}));let{appliedPolicies:v}=Fh({tournamentRecord:o}),S=d?.eventIds??[];return{...h.filter((e=>!S.includes(e.eventId))).map((h=>{let y={eventDrawsCount:XI({event:h}).flightProfile?.flights?.length||h.drawDefinitions?.length||0,...m};return JE({hydrateParticipants:e.hydrateParticipants,context:y,tournamentAppliedPolicies:v,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:c,contextFilters:d,contextProfile:l,contextContent:t,matchUpFilters:u,participantMap:I,participants:g,tournamentId:f,nextMatchUps:p,inContext:s,event:h})})).reduce(((e,t)=>((t&&Object.keys(t).filter((e=>!["success","matchUpsMap"].includes(e))))?.forEach((i=>{Array.isArray(t[i])&&(e[i]||(e[i]=[]),e[i]=e[i].concat(t[i]),void 0!==e.matchUpsCount?e.matchUpsCount+=t[i].length:e.matchUpsCount=t[i].length)})),e)),{matchUpsCount:0}),groupInfo:y,participants:g}}function ZE({scheduleVisibilityFilters:e,hydrateParticipants:t,participantsProfile:i,tournamentRecords:r,useParticipantMap:n,policyDefinitions:a,usePublishState:o,matchUpFilters:s,contextFilters:c,nextMatchUps:d,inContext:u}){if("object"!=typeof r||!Object.keys(r).length)return{error:Hr};let l=Object.keys(r).map((n=>{let l=r[n];return QE({scheduleVisibilityFilters:e,hydrateParticipants:t,participantsProfile:i,policyDefinitions:a,tournamentRecord:l,usePublishState:o,matchUpFilters:s,contextFilters:c,nextMatchUps:d,inContext:u})})),p={},m={};return{...l.reduce(((e,t)=>(Object.keys(t).forEach((i=>{if("groupInfo"===i)Object.assign(m,t[i]);else if("participants"===i)for(let e of t[i]??[])p[e.participantId]=e;else Array.isArray(t[i])&&(e[i]||(e[i]=[]),e[i]=e[i].concat(t[i]))})),e)),{}),groupInfo:m,mappedParticipants:p}}function eM(e){if("object"!=typeof e?.tournamentRecords||!Object.keys(e?.tournamentRecords).length)return{error:Hr};let t,i,{courts:r,venues:n}=cE(e),a=wE(e).schedulingProfile,{sortDateMatchUps:o=!0,courtCompletedMatchUps:s,alwaysReturnCompleted:c,activeTournamentId:d,tournamentRecords:u,withCourtGridRows:l,minCourtGridRows:p,usePublishState:m,status:f=fI,sortCourtsData:h}=e,g=d??Vs()??Object.keys(u)[0],I=m?iv({tournamentRecord:u[g],status:f}):void 0,y=c?ZE({...e,matchUpFilters:{...e.matchUpFilters,matchUpStatuses:[jm]},contextFilters:e.contextFilters}).completedMatchUps:[];if(m&&!I?.orderOfPlay?.published)return{completedMatchUps:y,dateMatchUps:[],courtsData:[],venues:n};m&&({drawIds:t,detailsMap:i}=function({tournamentRecords:e}){let t={},i=[];for(let r of Object.values(e))for(let e of r.events??[]){let r=rv({event:e}),n=r?.drawDetails;Rr(n)?(Object.assign(t,n),i.push(...Object.keys(n).filter((e=>nv({drawId:e,drawDetails:n}))))):r?.drawIds?.length&&i.push(...r.drawIds)}return{drawIds:i,detailsMap:t}}({tournamentRecords:u})),t?.length&&(e.contextFilters??={},e.contextFilters.drawIds?e.contextFilters.drawIds=e.contextFilters.drawIds.filter((e=>t.includes(e))):e.contextFilters.drawIds=t),I?.eventIds?.length&&(e.matchUpFilters??={},e.matchUpFilters?.eventIds&&e.matchUpFilters.eventIds.length?e.matchUpFilters.eventIds=e.matchUpFilters.eventIds.filter((e=>I.eventIds.includes(e))):e.matchUpFilters.eventIds=I.eventIds),I?.scheduledDates?.length&&(e.matchUpFilters??={},e.matchUpFilters.scheduledDates&&e.matchUpFilters.scheduledDates.length?e.matchUpFilters.scheduledDates=e.matchUpFilters.scheduledDates.filter((e=>I.scheduledDates.includes(e))):e.matchUpFilters.scheduledDates=I.scheduledDates),c&&(e.matchUpFilters??={},e.matchUpFilters?.excludeMatchUpStatuses?.length?e.matchUpFilters.excludeMatchUpStatuses.includes(jm)||e.matchUpFilters.excludeMatchUpStatuses.push(jm):e.matchUpFilters.excludeMatchUpStatuses=[jm]);let{completedMatchUps:v,upcomingMatchUps:S,pendingMatchUps:U,groupInfo:b,mappedParticipants:w}=ZE({...e,matchUpFilters:e.matchUpFilters,contextFilters:e.contextFilters}),T=[...S??[],...U??[]];i&&(!t?.length||Object.keys(i).length)&&(T=T.filter((e=>{let{drawId:t,structureId:r,stage:n}=e;if(!i?.[t]?.publishingDetail?.published)return!1;let a=Object.keys(i[t].stageDetails??{});if(a.length){let e=a.filter((e=>!i[t].stageDetails[e].published)),r=a.filter((e=>i[t].stageDetails[e].published));return(!e.length||!e.includes(n))&&(!(!r.length||!r.includes(n))||e.length&&!e.includes(n)&&!r.length)}let o=Object.keys(i[t].structureDetails??{});if(o.length){let e=o.filter((e=>!i[t].structureDetails[e].published)),n=o.filter((e=>i[t].structureDetails[e].published));return(!e.length||!e.includes(r))&&(!(!n.length||!n.includes(r))||e.length&&!e.includes(r)&&!n.length)}return!0})));let D=o?XE({matchUps:T,schedulingProfile:a}):T,P=r?.map((e=>{let t=function({courtId:e}){let t=(s?D.concat(v??[]):D).filter((t=>t.schedule?.courtId===e||t.schedule?.allocatedCourts?.map((({courtId:e})=>e)).includes(e)));return h?XE({matchUps:t,schedulingProfile:a}):t}(e);return{surfaceCategory:e?.surfaceCategory??"",matchUps:t,...e}})),N={completedMatchUps:c?y:v,mappedParticipants:e.hydrateParticipants?void 0:w,dateMatchUps:D,courtsData:P,groupInfo:b,venues:n};if(l){let t=e.matchUpFilters?.scheduledDate,{rows:i,courtPrefix:r}=kE({minRowsCount:Math.max(p||0,D.length||0),scheduledDate:t,courtsData:P});N.courtPrefix=r,N.rows=i}return{...N,..._r}}function tM({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Hr};let i;return Object.keys(e).filter((e=>!t||e===t)).forEach((t=>{let r=e[t],{matchUpDailyLimits:n}=function(e){let t=dp(e,[{[Tl]:!0}]);if(t.error)return t;let{tournamentRecord:i}=e,{policy:r}=Hh({policyType:Ep,tournamentRecord:i}),{extension:n}=Jp({element:i,name:gm}),a=n?.value?.dailyLimits,o=r?.defaultDailyLimits;return{matchUpDailyLimits:a||o}}({tournamentRecord:r});i=n})),{matchUpDailyLimits:i}}function iM(e){let{matchUps:t}=e,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:c,scaleName:d,eventId:u,zonePct:l,drawId:p,event:m}=e;if(!r&&!t)return{error:zr};if(c&&![Bi,ji].includes(c))return{error:Ho,info:{matchUpType:c}};if(t&&!Pg(t))return{error:Ho,context:{matchUps:t}};let f=kb[d],h=f?.ascending??e.ascending??!1,g=f?.accessor??e.valueAccessor,I=Array.isArray(f?.range)?Math.abs(f.range[0]-f.range[1]):0,y=ir(l)&&I?(l??0)*I:e.zoneMargin??I,v={withScaleValues:!0,withCompetitiveness:!0},S={matchUpTypes:c?[c]:[Bi,ji]},U=r?.participants;t?.[0]?.hasContext?p?t=t.filter((e=>e.drawId===p)):u&&(t=t.filter((e=>e.eventId===u))):void 0===t&&(t=p&&!n&&[]||!p&&u&&!m&&[]||p&&by({inContext:!0,drawDefinition:n,contextFilters:S,contextProfile:v,participants:U})?.matchUps||!p&&u&&yy({inContext:!0,contextFilters:S,contextProfile:v,participants:U,event:m})?.matchUps||vy({tournamentRecord:r,contextFilters:S,contextProfile:v})?.matchUps||[]),c&&(t=t.filter((e=>e.matchUpType===c)));let b=t.filter((({winningSide:e,score:t,sides:i,matchUpStatus:r})=>![Km,Gm,Qm,$m,_m].includes(r??"")&&My({score:t})&&2===i?.length&&e)),w=function({excludeMargin:e,exclusionRule:t,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let d of a){let{matchUpType:a,sides:s,score:c,winningSide:u}=d;if(!u)continue;if(t&&(!t.valueAccessor||!t.range))return{info:"exclusionRule requires valueAccessor and range",error:va};let l=u-1,p=rM({exclusionRule:t,valueAccessor:i,matchUpType:a,scaleName:n,sides:s});if(t){let e=p.map((({exclusionValues:e})=>e)).flat();if(e.length){o.excluded.push({scoreString:c?.scoreStringSide1,exclusionValues:e,winningSide:u,sideValues:p});continue}}if(p.filter((e=>![void 0,"",null].includes(e.value))).length<2){o.excluded.push({scoreString:c?.scoreStringSide1,missingValues:!0,winningSide:u,sideValues:p});continue}let m=p[l].value-p[1-l].value,f=parseFloat(e||0),h=f&&Math.abs(m)<f;if(h){o.excluded.push({scoreString:c?.scoreStringSide1,excludeMargin:e,winningSide:u,excludeGap:h,sideValues:p,valuesGap:m});continue}let g=r?m:-1*m,I=1===u?c?.scoreStringSide1:c?.scoreStringSide2;g>0?o.affirmative.push({winningScoreString:I,winningSide:u,sideValues:p,valuesGap:m,score:c}):o.negative.push({winningScoreString:I,winningSide:u,sideValues:p,valuesGap:m,score:c})}let s=o.affirmative.length+o.negative.length,c=s&&o.affirmative.length/s*100;return o.percent=c?Math.round(100*c)/100:0,o}({matchUps:b,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:h,scaleName:d}),T=!s||yI(Bi)(c)?y:2*(y||0),D=y?b.map((({competitiveProfile:e,matchUpType:t,score:r,sides:n})=>{let a=rM({singlesForDoubles:i,valueAccessor:g,matchUpType:t,scaleName:d,sides:n}),o=Math.abs(a[0].value-a[1].value);return{competitiveness:e?.competitiveness,valuesGap:o,score:r}})).filter((({valuesGap:e})=>e<=T)):[],P=function({zoneData:e}){let t={[Vh]:[],[jh]:[],[$h]:[]};for(let i of e){let{competitiveness:e,score:r,valuesGap:n}=i;t[e]&&t[e].push({score:r,valuesGap:n})}return t}({zoneData:D}),N=P&&[].concat(Object.values(P)).flat().length,E=N&&Object.assign({},...Object.keys(P).map((e=>({[e]:Math.round(1e4*P[e].length/N)/100})))),M=b.length-(D?.length||0);return{..._r,relevantMatchUps:b,zoneDistribution:E,zoneData:D,accuracy:w,nonZone:M}}function rM({singlesForDoubles:e,exclusionRule:t,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=t?.range.sort(),s=e=>{let i=e?.[t?.valueAccessor];return{exclude:t&&i>=o[0]&&i<=o[1],exclusionValue:i}};return a.sort(((e,t)=>e.sideNumber-t.sideNumber)).map((({participant:t})=>{let a=[],o=t?.individualParticipants;if(o?.length){let c=[],d=0;for(let t of o){let{scaleValue:o,value:u}=nM({singlesForDoubles:e,valueAccessor:i,participant:t,matchUpType:r,scaleName:n}),{exclude:l,exclusionValue:p}=s(o);l&&a.push(p),c.push(o),u&&!isNaN(d)?d+=u:d=void 0}return{participantName:t.participantName,exclusionValues:a,scaleValues:c,value:d}}if(t){let{scaleValue:o,value:c}=nM({singlesForDoubles:e,valueAccessor:i,matchUpType:r,participant:t,scaleName:n}),{exclude:d,exclusionValue:u}=s(o);return d&&a.push(u),{participantName:t.participantName,exclusionValues:a,scaleValue:o,value:c}}return{}}))}function nM({singlesForDoubles:e,valueAccessor:t,matchUpType:i,participant:r,scaleName:n}){let a=e?Bi:i,o=r?.rankings?.[a]?.find((e=>e.scaleName===n)),s=(r?.ratings?.[a]?.find((e=>e.scaleName===n))||o)?.scaleValue;return{scaleValue:s,value:t?s?.[t]:s}}function aM({collectionDefinitions:e=[],collectionGroups:t=[]}){let i,r=0,{groupValueNumbers:n}=fw({collectionGroups:t});for(let a of e||[]){let{collectionValueProfiles:e,collectionGroupNumber:t,collectionValue:o,matchUpCount:s,matchUpValue:c,scoreValue:d,setValue:u}=a,l=t&&n.includes(t);if(ir(u||d))i=!0;else{if(l)continue;if("number"==typeof o&&ir(o))r+=o;else if(Array.isArray(e)&&e?.length)for(let t of e)r+=t.matchUpValue;else"number"==typeof c&&ir(c)&&(r+=(s??0)*c)}}for(let a of t)r+=a.groupValue??0;return i||!r?{aggregateValue:!0,..._r}:{valueGoal:Math.floor(r/2)+1,..._r}}function oM(e){let{timeStamp:t,schedule:i,matchUp:r}=e,n=dp(e,[{[Hl]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:o}=LI({timeItems:r?.timeItems||[],itemType:Kg});return!i||o&&t&&new Date(o).getTime()>new Date(t).getTime()?{homeParticipantId:a}:i}function sM({matchUps:e,matchUpId:t}){if(!Pg(e))return{error:Ho};let i=e.find((e=>e.matchUpId===t)),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:t,drawId:r,eventId:n,structureId:a,tournamentId:o}}function cM(e,t){if(!Rr(e))return{error:Ho};if(!Array.isArray(t))return{error:Ho};let i={};for(let{param:r,error:n,attr:a}of t){let t=dM({params:e,param:r,attr:a,error:n});if(t?.error)return t;i[r]=t}return i}function dM({params:e,param:t,attr:i,error:r}){if(t===Vl&&Rr(e.drawDefinition)&&Mr(e.structureId)){let t=(e.drawDefinition.structures??[]).find((({structureId:t})=>t===e.structureId));return!t.length&&r?{error:r}:{structure:t}}if(t===Hl){let t=iE({...e,...i});return t.error&&r?{...t,error:r}:t}return{error:Qo,info:{param:t}}}function uM(e){let{structureId:t,matchUpId:i,event:r}=e,n=e.drawDefinition,a=dp(e,[{[Tl]:!0},{[np]:{[Cl]:!1,[Ll]:!1,[zl]:!1,[Kl]:!1}}]);if(a[Yl])return a;let o=cM(e,[{[Xl]:Hl,[Yl]:va}])?.matchUp;if(i&&o?.error)return o;!n&&o?.drawDefinition&&(n=o?.drawDefinition);let s=o?.structure;if(!s&&t&&!i){if(!n)return{error:In};let e=lf({drawDefinition:n,structureId:t});if(e.error)return e;s=e.structure}let c=s?.matchUpFormat,d=n?.matchUpFormat,u=r?.matchUpFormat;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:d,matchUpFormat:o?.matchUp?.matchUpFormat||c||d||u}}function lM({profileBands:e,tournamentRecord:t,matchUps:i}){if(!Pg(i))return{error:oa};let r=!e&&Hh({policyType:Sp,tournamentRecord:t}).policy,n=e||r?.profileBands||Wh[Sp].profileBands,a=i.filter((({winningSide:e})=>e)),o=a.map(Lg),s=Bg(o).reduce(((e,t)=>((e,t)=>(e[Fg(t,n)]+=1,e))(e,t)),{[Vh]:0,[jh]:0,[$h]:0,[_h]:0}),c=Object.keys(s).reduce(((e,t)=>(s[t]||0)+e),0),d=Object.keys(s).map((e=>({[e]:100*parseFloat((s[e]/c).toFixed(4))}))),u=a.filter((({matchUpStatus:e})=>e===Bh)).length;return d.push({[Bh]:100*parseFloat((u/c).toFixed(4))}),{competitiveBands:Object.assign({},...d),..._r}}var{stageOrder:pM}=Ul;function mM(e,t){return e.eventName.localeCompare(t.eventName)||e.eventId.localeCompare(t.eventId)||(pM[e?.stage]||0)-(pM[t?.stage]||0)||t.matchUpsCount-e.matchUpsCount||`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`.localeCompare(`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`)}function fM({excludeScheduleDateProfileRounds:e,excludeScheduledRounds:t,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:c,scheduleDate:d,withRoundId:u,venueId:l,context:p}){if(r&&!Array.isArray(r||"object"!=typeof r[0]))return{error:Ho,inContextMatchUps:r};if(o&&!n){if("object"!=typeof o)return{error:Yr};n={[o.tournamentId]:o}}let m="object"!=typeof n||!Object.keys(n).length;if((l||d||!r||!a&&(e||i||a||s))&&m)return{error:Hr};let f=Object.assign({},...Object.values(n??{}).map((({venues:e=[],tournamentId:t})=>({[t]:e?.map((({venueId:e})=>e))})))),h=Object.values(n??{}).map((({events:e=[],tournamentId:t,startDate:i,endDate:r})=>e.map((e=>({...e,validVenueIds:f[t],startDate:e.startDate??i,endDate:e.endDate??r}))))).flat(),{segmentedRounds:g,profileRounds:I}=n&&(e||i||a||s)&&CE({tournamentRecords:n,schedulingProfile:a})||{},y=e&&Object.assign({},...I.map((e=>({[e.id]:e})))),v=r||n&&Sy({tournamentRecords:n,matchUpFilters:c})?.matchUps||[],S=[],U=v&&Object.values(v.reduce(((e,t)=>{let i=EE(t).id,r=g?.[i],n=[...e[i]?.matchUps??[],t],{containerStructureId:a,stageSequence:o,structureName:s,tournamentId:c,isRoundRobin:d,matchUpType:l,roundNumber:p,roundOffset:m,structureId:f,eventName:h,roundName:I,drawName:y,eventId:v,drawId:S}=t,U=d?a:f;return{...e,[i]:{id:u?i:void 0,structureId:U,stageSequence:o,segmentsCount:r,structureName:s,tournamentId:c,matchUpType:l,roundNumber:p,roundOffset:m,eventName:h,roundName:I,drawName:y,matchUps:n,eventId:v,drawId:S}}}),{})).map((e=>{let{minFinishingSum:t,winnerFinishingPositionRange:i}=function(e){return(e||[]).reduce(((e,t)=>{let i=(t.finishingPositionRange?.winner||[]).reduce(((e,t)=>e+t),0),r=(t.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||i<e.minFinishingSum?{minFinishingSum:i,winnerFinishingPositionRange:r}:e}),{minFinishingSum:0,winnerFinishingPositionRange:""})}(e.matchUps),r=e.segmentsCount;if(r){let a=e.matchUps.length/r;return wr(e.matchUps.sort(((e,t)=>e.roundPosition-t.roundPosition)),a).map(((a,o)=>{let{unscheduledCount:s,incompleteCount:c,matchUpsCount:d,isScheduled:u,isComplete:l,byeCount:m}=RE(a),f=ME({matchUps:e.matchUps,tournamentRecords:n,events:h,round:e});return Js({...e,...p,roundSegment:{segmentsCount:r,segmentNumber:o+1},winnerFinishingPositionRange:i,unscheduledCount:s,incompleteCount:c,minFinishingSum:t,matchUpsCount:d,isScheduled:u,roundTiming:f,isComplete:l,byeCount:m,matchUps:a})}))}let{unscheduledCount:a,incompleteCount:o,matchUpsCount:s,isScheduled:c,isComplete:d,byeCount:u}=RE(e.matchUps),l=ME({matchUps:e.matchUps,tournamentRecords:n,events:h,round:e});return Js({...e,...p,winnerFinishingPositionRange:i,unscheduledCount:a,incompleteCount:o,minFinishingSum:t,matchUpsCount:s,isScheduled:c,roundTiming:l,isComplete:d,byeCount:u})})).flat().filter((r=>{if(e){let t=Yc(e),i=u?r.id:EE(r).id;if(t&&y[i]&&Yc(y[i].scheduleDate)===t)return!1}let{isComplete:n,isScheduled:a}=r,s=!i||!n,c=!t||!a,p=l||d?h?.find((({eventId:e})=>e===r.eventId)):void 0,m=p?.startDate??o?.startDate,f=p?.endDate??o?.endDate,g=!d||!m||new Date(d)>=new Date(m),I=!d||!f||new Date(d)<=new Date(f),v=g&&I,U=!l||p?.validVenueIds.includes(l),b=s&&c&&U&&v;return b||S.push(r),b})).sort(mM)||[];return{..._r,rounds:U,excludedRounds:S}}function hM(e){let{matchUp:t,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=e||{},{matchUpFormat:o}=e||{};if(!t)return{error:sa};o=o||t?.matchUpFormat;let s=Uc(o),c=!!t?.winningSide,d=t.score?.sets,u=d?.length,l=r&&r-1,p=!!d?.find(((e,t)=>e.setNumber===r&&t===l)),m=d?.filter((e=>e?.winningSide))||[],f=m?.length||0,h=r&&d?.slice(r)||[],g=!!(u&&r&&h?.reduce(((e,t)=>(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e),!0)),I=r<=u&&d.find((e=>e.setNumber===r)),y=I&&nN({setObject:I,matchUpScoringFormat:s}),{isCompletedSet:v,sideGameScores:S,sideTiebreakScores:U}=y||{},b=!!(I&&!v&&g||r&&r===u+1&&!c),w=[1,2].includes(i),T=w?i-1:0,D=I&&w&&(!n&&!a&&void 0!==S[T]&&S[T]||n&&void 0!==U[T]&&U[T]),P=!!D,N=m?.map((e=>nN({setObject:e,matchUpScoringFormat:s}).isValidSetOutcome)).reduce(((e,t)=>e&&t),!0),E=m.reduce(((e,t)=>{let{winningSide:i}=t;return e[i-1]++,e}),[0,0]),M=t?.winningSide,R=M&&M-1,C=1-R,A=E[R],k=E[C],O=Math.max(...E),x=dr(E)[O],{bestOf:F,exactly:L}=s??{},_=O===(F&&Math.ceil(F/2)||L||1)&&1===x&&E.indexOf(O)+1||void 0,B=A>k&&M===_;return{completedSetsHaveValidOutcomes:N,validMatchUpWinningSide:B,calculatedWinningSide:_,matchUpScoringFormat:s,validMatchUpOutcome:_&&N&&B,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:c,isValidSideNumber:w,hasExistingValue:P,existingValue:D,isExistingSet:p,isActiveSet:b,...y}}function gM({participants:e,tournamentAppliedPolicies:t,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:c,contextFilters:d,contextContent:u,matchUpFilters:l,participantMap:p,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,tournamentId:I,inContext:y,context:v,event:S}){let U,{eventId:b,eventName:w,endDate:T,eventType:D,category:P,gender:N}=S??{},E={...v,...Js({surfaceCategory:S?.surfaceCategory??s?.surfaceCategory,indoorOutDoor:S?.indoorOutdoor??s?.indoorOutdoor,endDate:T??S?.endDate??s?.endDate,tournamentId:I??s?.tournamentId,eventName:w,eventType:D,category:P,eventId:b,gender:N})};return!e?.length&&s&&({participants:e,participantMap:p,groupInfo:U}=xh({participantsProfile:r,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:y})),S&&f&&!u&&(u=qh({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:h,event:S})),{...Iy({context:E,tournamentAppliedPolicies:t,scheduleVisibilityFilters:i,tournamentParticipants:e,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:c,participantMap:p,contextContent:u,contextFilters:d,matchUpFilters:l,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,inContext:y,event:S}),groupInfo:U}}var IM={};function yM({tournamentRecord:e,venueId:t,venueIds:i}){return e?{courts:(e.venues||[]).filter((e=>t?e.venueId===t:!i||i.includes(e.venueId))).map((e=>{let{venueId:t}=e,i=yd(e.courts||[]);return i.forEach((e=>Object.assign(e,{venueId:t}))),i})).flat()}:{error:zr}}Oi(IM,{getCompetitionVenues:()=>dE,getCourts:()=>yM,getVenuesAndCourts:()=>cE,publicFindVenue:()=>qI});var vM={};function SM({tournamentRecord:e,event:t}){if(!e)return{error:zr};if(!t)return{error:Fn};let i,r,n,a=t.entries||[],o=e.participants||[],s=t.category?.categoryName||t.category?.ageCategoryCode,{eventType:c}=t,d=a.map((e=>e.participantId));return{entryScaleAttributes:o.filter((e=>d.includes(e.participantId))).map((e=>{let{participantId:t,participantName:a,name:o}=e,d={scaleType:pI,eventType:c,scaleName:s},u=Zy({participant:e,scaleAttributes:d})?.scaleItem?.scaleValue;d={scaleType:lI,eventType:c,scaleName:s};let l=Zy({participant:e,scaleAttributes:d})?.scaleItem?.scaleValue;d={scaleType:uI,eventType:c,scaleName:s};let p=Zy({participant:e,scaleAttributes:d})?.scaleItem?.scaleValue;return i=!(!i&&!u),r=!(!r&&!l),n=!(!n&&!p),{participantId:t,participantName:a||o,seed:u,ranking:l,rating:p}})),hasSeededParticipants:i,hasRankedParticipants:r,hasRatedParticipants:n}}function UM({tournamentRecord:e,withScaleValues:t,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){if(!e)return{error:zr};let{tournamentId:s}=e,c=(e.events??[]).filter((({eventId:e})=>!n||Array.isArray(n)&&n.includes(e))).map((e=>{let t=e.drawDefinitions?.map(Fm);if(a?.length&&!yr(a,t).length)return;let i=yd(e);return r&&Object.assign(i,{tournamentId:s}),o&&Object.assign(i,o),i})).filter(Boolean),d={};if(t){let t=mv({withScaleValues:!0,tournamentRecord:e}).participantMap,r=e=>e.reduce(((e,t)=>e+Number.parseFloat(t)),0);for(let e of c){let n=i??e.eventType,o=e.eventId;d[o]||(d[o]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let s=(e.entries??[]).filter((({entryStatus:e})=>pg.includes(e))).map(Om),c=e=>{if(e?.ratings?.[n])for(let t of e?.ratings?.[n]??[]){let e=t.scaleName;d[o].ratings[e]||(d[o].ratings[e]=[]);let i=kb[e]?.accessor;if(i){let r=Number.parseFloat(t.scaleValue?.[i]);r&&d[o].ratings[e].push(r)}}if(e?.rankings?.[n])for(let t of e?.rankings?.[n]??[]){let e=t.scaleName;d[o].ranking[e]||(d[o].ranking[e]=[]),t.scaleValue&&d[o].ranking[e].push(t.scaleValue)}};for(let e of s){let i=t?.[e]?.participant;if(i?.participantType===ph)c(i);else for(let e of i?.individualParticipantIds??[]){let i=t?.[e]?.participant;c(i)}}let u=d[o].ratings;for(let e of Object.keys(u)){let t=u[e];if(!t.length)continue;let i=Ki(t)?.toFixed(2);d[o].ratingsStats[e]={avg:Number.parseFloat((r(t)/t.length).toFixed(2)),median:i?Number.parseFloat(i):void 0,max:Math.max(...t),min:Math.min(...t)}}let l=(e,i)=>{let r=t=>{if(d[o].draws?.[e]&&t?.ratings?.[n])for(let i of t?.ratings?.[n]??[]){let t=i.scaleName;d[o].draws[e]?.ratings[t]||(d[o].draws[e].ratings[t]=[]);let r=kb[t]?.accessor;if(r){let n=Number.parseFloat(i.scaleValue?.[r]);n&&d[o].draws[e].ratings[t].push(n)}}if(d[o].draws?.[e]&&t?.rankings?.[n])for(let i of t?.rankings?.[n]??[]){let t=i.scaleName;d[o].draws[e]?.ranking[t]||(d[o].draws[e].ranking[t]=[]);let r=i.scaleValue;r&&d[o].draws[e].ranking[t].push(r)}};for(let n of i.filter(Boolean)){let e=t?.[n]?.participant;if(e?.participantType===ph)r(e);else for(let i of e?.individualParticipantIds??[]){let e=t?.[i]?.participant;r(e)}}},p=[],m=e=>a?.length&&a.includes(e)||p.includes(e);for(let t of e.drawDefinitions??[]){let e=t.drawId;if(m(e))continue;let i=Ky({drawDefinition:t}).assignedParticipantIds??[];d[o].draws[e]||(d[o].draws[e]={ratingsStats:{},ratings:{},ranking:{}}),p.push(e),l(e,i)}let f=XI({event:e}).flightProfile;for(let e of f?.flights??[]){let t=e.drawId;m(t)||l(t,e.drawEntries.map(Om))}for(let e of p){let t=d[o].draws[e].ratings;for(let i of Object.keys(t)){let n=t[i];if(!n.length)continue;let a=Ki(n)?.toFixed(2);d[o].draws[e].ratingsStats[i]={avg:Number.parseFloat((r(n)/n.length).toFixed(2)),median:a?Number.parseFloat(a):void 0,max:Math.max(...n),min:Math.min(...n)}}}}}return Js({eventScaleValues:d,events:c,..._r})}function bM({tournamentRecord:e,drawDefinition:t,context:i,event:r}){if(!e)return{error:zr};if(!r)return{error:Fn};let n=yd(r);return i&&Object.assign(n,i),Js({drawDefinition:t&&n.drawDefinitions?.find((({drawId:e})=>t.drawId===e)),event:n})}function wM(e){let t="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=function(e){let{tournamentRecord:t,event:i}=e,r={...e?.appliedPolicies,...Fh({tournamentRecord:t,event:i}).appliedPolicies??{}},n=yd(e.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}(e),n=function({enforceGender:e,policyDefinitions:t,appliedPolicies:i}){return e??t?.[wp]?.participants?.enforceGender??i?.[wp]?.participants?.enforceGender}({...e,policyDefinitions:r,appliedPolicies:i}),a=function({considerEventEntries:e=!0,drawEntries:t,eventEntries:i,qualifyingOnly:r}){return(r&&[]||TM(t)||(e?i:[])).filter((({entryStage:e})=>!e||e===vu))}(e),o=function(e){let{consideredEntries:t,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=e;return s&&o&&FT({consideredEntries:t,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}({...e,consideredEntries:a,appliedPolicies:i});if(o?.error)return Qs({result:o,stack:t});let s=function(e){return!e.drawSize&&e.consideredEntries.length&&![Wu,Ku,qu,ll,pl].includes(e.drawType??"")&&er(e.consideredEntries.length)||e.drawSize&&zi(e.drawSize)||!1}({...e,consideredEntries:a}),c=function(e){let{policyDefinitions:t,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=e,a=e.drawTypeCoercion??RT({drawType:e.drawType,policyDefinitions:t,appliedPolicies:i}),o=BT({drawType:e.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}({...e,appliedPolicies:i,policyDefinitions:r,drawSize:s});if(c.error)return Qs({result:c,stack:t});let d=c.drawType;if(isNaN(s)&&d!==Wu)return Qs({result:{error:gn},stack:t});let u=r?.[Cp]??i?.[Cp],l=e.seedingProfile??u?.seedingProfile?.drawTypes?.[d??""]??u?.seedingProfile;e.seedingProfile&&(r[Cp]||(r[Cp]={...wN[Cp]}),r[Cp].seedingProfile=l);let p=function(e){let{tournamentRecord:t,event:i,ignoreAllowedDrawTypes:r,drawType:n}=e,a=!r&&t&&FN({tournamentRecord:t,categoryType:i?.category?.categoryType,categoryName:i?.category?.categoryName});return a?.length&&!a.includes(n)?{error:mn}:{..._r}}({...e,drawType:d});return p?.error?Qs({result:p,stack:t}):{drawSize:s,drawType:d,enforceGender:n,seedingProfile:l,appliedPolicies:i,policyDefinitions:r}}function TM(e){return e?.filter((e=>e.entryStatus&&[...pg,rg].includes(e.entryStatus)))}function DM(e){let{drawDefinition:t,appliedPolicies:i}=e,r=i?.[Dp],n=bg({drawDefinition:t});return t.structures?.forEach((e=>{let i=wg({structureId:e.structureId,matchUpsMap:n}),a=Og({roundNamingPolicy:r,drawDefinition:t,structure:e,matchUps:i}),{roundNamingProfile:o,roundProfile:s}=a;(e.structures||[e]).forEach((e=>{(e.matchUps??[]).forEach((e=>{let t=e?.roundNumber?.toString();if(t){let i=o?.[t]?.roundName,r=o?.[t]?.abbreviatedRoundName,n=s?.[t]?.feedRound;Object.assign(e,{abbreviatedRoundName:r,feedRound:n,roundName:i})}}))}))})),{drawDefinition:t}}function PM(e){let{voluntaryConsolation:t,tournamentRecord:i,event:r}=e,n="generateDrawDefinition",{participants:a,participantMap:o}=mv({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=TM(r?.entries)??[],c=wM({...e,participantMap:o,participants:a,eventEntries:s});if(c.error)return Qs({result:c,stack:n});let{appliedPolicies:d,policyDefinitions:u,drawSize:l,drawType:p,enforceGender:m,seedingProfile:f}=c,h=r?.eventType,g=e.matchUpType??h,I=function(e){let{existingDrawDefinition:t,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:o,isMock:s,event:c}=e,{tieFormat:d,matchUpFormat:u}=e;if(a===gu&&o===gu){let e=t?.structures?.find((({stage:e})=>e===vu))?.tieFormat;d=d||e||n&&c?.tieFormat?.tieFormatName===n&&c.tieFormat||n&&lu({namedFormat:n,hydrateCollections:i,isMock:s,event:c})||c?.tieFormat||lu({event:c,isMock:s,hydrateCollections:i}),u=void 0}else u||(d=void 0,c?.matchUpFormat||(u=Ad));if(d){let e=md({gender:c?.gender,enforceGender:r,tieFormat:d});if(e.error)return e}return{tieFormat:d,matchUpFormat:u}}({...e,enforceGender:m,eventType:h,matchUpType:g});if(I.error)return Qs({result:I,stack:n});let{matchUpFormat:y,tieFormat:v}=I;if(e.drawId&&"string"!=typeof e.drawId)return Qs({result:{error:Ho},stack:n});let S=function(e){let t="generateOrGetExisting",i=[],r=[],n=DN(e);if(n.error)return Qs({result:n,stack:t});let a=n.existingDrawDefinition,o=n.drawDefinition??{},s=n.structureId,c=e.drawEntries??e.eventEntries??[],d=n.existingQualifyingPlaceholderStructureId&&aN({...e,...n})||mN({...e,...n,entries:c});return d.error?Qs({result:d,stack:t}):(d.positioningReports?.length&&i.push(...d.positioningReports??[]),d.conflicts?.length&&r.push(...d.conflicts??[]),o=d.drawDefinition,s=d.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:o,structureId:s,conflicts:r,entries:c})}({...e,policyDefinitions:u,tournamentRecord:i,appliedPolicies:d,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:s,matchUpType:g,tieFormat:v,drawSize:l,drawType:p,event:r});if(S.error)return Qs({result:S,stack:n});let{existingDrawDefinition:U,positioningReports:b,drawDefinition:w,structureId:T,conflicts:D,entries:P}=S;if(!w)return Qs({result:{error:Ho},stack:n});let N=function(e){let{qualifyingPlaceholder:t,existingDrawDefinition:i,positioningReports:r,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:c,participants:d,structureId:u,tieFormat:l,entries:p,stack:m}=e,f=t&&!n?.length&&!i,h=[];if(n){let t=(e,t)=>e.stageSequence-t.stageSequence,i=(e,t)=>e.roundTarget-t.roundTarget,u=[],l=1;n.sort(i);for(let f of n){if(!Array.isArray(f.structureProfiles))return Qs({info:SS("structureProfiles"),result:{error:va},stack:m});l=f.roundTarget||l;let i=f.structureProfiles?.sort(t)||[],n=1;for(let t of i){let{qualifyingRoundNumber:i,qualifyingPositions:m,seededParticipants:f,seedingScaleName:g,seedsCount:I=0,seedByRanking:y,placeByes:v,drawSize:S}=t,U=pN({...e,seedingProfile:t.seedingProfile??c,stageSequence:n,qualifyingRoundNumber:i,preparedStructureIds:u,qualifyingPositions:m,seededParticipants:f,stage:Su,seedingScaleName:g,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:y,participants:d,roundTarget:l,seedsCount:I,placeByes:v,drawSize:S,entries:p});if(U.error)return U;U.structureId&&u.push(U.structureId),n+=1,U.conflicts?.length&&h.push(...U.conflicts),U.positioningReport?.length&&r.push({[Su]:U.positioningReport})}l+=1}}else if(u&&f){let e=qv({structureName:zv(Su),stage:Su,qualifyingOnly:o,tieFormat:l}),{link:t}=nb({sourceStructureId:e.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:Vu});s.structures||(s.structures=[]),s.structures.push(e),s.links||(s.links=[]),s.links.push(t)}return{qualifyingConflicts:h,error:void 0}}({...e,existingDrawDefinition:U,positioningReports:b,appliedPolicies:d,drawDefinition:w,seedingProfile:f,participants:a,structureId:T,entries:P,params:e,stack:n});if(N.error)return N;let{qualifyingConflicts:E}=N;return w.drawName=e.drawName??(p&&zv(p)),l&&"object"==typeof t&&l>=4&&Yv({...t,drawDefinition:w,matchUpType:g}),e.hydrateRoundNames&&d?.[Dp]&&DM({drawDefinition:w,appliedPolicies:d}),{existingDrawDefinition:!!U,qualifyingConflicts:E,positioningReports:b,drawDefinition:w,structureId:T,..._r,conflicts:D}}function NM({scaleAttributes:e,scaledEntries:t,stageEntries:i,seedsCount:r,scaleName:n}){if(!e)return{error:va,info:"missing scaleAttributes"};let a=Object.assign({},...(t||[]).slice(0,r).map((({participantId:e},t)=>({[e]:t+1}))));n=n||e.scaleName;let o=(new Date).toISOString();return{scaleItemsWithParticipantIds:i.map((({participantId:t})=>({scaleItems:[{scaleValue:a[t],eventType:e.eventType,scaleType:hp,scaleName:n,scaleDate:o}],participantId:t})))}}function EM({tournamentRecord:e,drawDefinition:t,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:c,sortDescending:d,scaleSortMethod:u}){let l=xE({policyDefinitions:i,drawDefinition:t,drawSize:a,drawId:o,event:s,stage:c});if(l.error)return l;let{entries:p,seedsCount:m,stageEntries:f}=l;if(!f||!m)return{error:Ho};let h=lN({tournamentRecord:e,scaleAttributes:r,scaleSortMethod:u,sortDescending:d,entries:p,stage:c}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=NM({scaleAttributes:r,scaledEntries:h,stageEntries:f,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}Oi(vM,{categoryCanContain:()=>ld,getCategoryAgeDetails:()=>dd,getEvent:()=>bM,getEventProperties:()=>SM,getEventStructures:()=>OS,getEventTimeItem:()=>Ph,getEvents:()=>UM,getFlightProfile:()=>XI,getScaledEntries:()=>lN});var MM={};Oi(MM,{addDrawEntries:()=>Sv,addEventEntries:()=>Dv,addEventEntryPairs:()=>BM,destroyPairEntries:()=>jv,destroyPairEntry:()=>Vv,getEntriesAndSeedsCount:()=>xE,getMaxEntryPosition:()=>FE,modifyEntriesStatus:()=>Qy,modifyEventEntries:()=>VM,mutate:()=>RM,promoteAlternate:()=>kM,promoteAlternates:()=>OM,query:()=>OE,removeDrawEntries:()=>FM,removeEventEntries:()=>bv,setEntryPosition:()=>CM,setEntryPositions:()=>AM});var RM={};function CM({tournamentRecord:e,drawDefinition:t,participantId:i,entryPosition:r,skipRefresh:n,event:a}){if(!e)return{error:zr};if(!i)return Qs({result:{error:Ha},stack:"setEntryPositions"});if(void 0!==r&&!Number.isSafeInteger(r))return{error:Ho,entryPosition:r};(a?.entries||[]).forEach((e=>{e.participantId===i&&(e.entryPosition=r)})),(t?.entries||[]).forEach((e=>{e.participantId===i&&(e.entryPosition=r)}));let o=e=>{e.entries.forEach((e=>{e.entryPosition===r&&e.participantId!==i&&(e.entryPosition+=.1)}))};return n||(a?.entries&&(o(a),a.entries=Xy({entries:a.entries})),t?.entries&&(o(t),t.entries=Xy({entries:t.entries}))),{..._r}}function AM({tournamentRecord:e,entryPositions:t,drawDefinition:i,event:r}){if(!e)return{error:zr};if(!Array.isArray(t))return{error:Ho};for(let n of t){let{participantId:t,entryPosition:a}=n,o=CM({skipRefresh:!0,tournamentRecord:e,drawDefinition:i,participantId:t,entryPosition:a,event:r});if(o.error)return o}return r?.entries&&(r.entries=Xy({entries:r.entries})),i?.entries&&(i.entries=Xy({entries:i.entries})),{..._r}}function kM(e){let{participantId:t}=e;return t&&"string"!=typeof t?{error:Ho,participantId:t}:OM({...e,participantIds:[t].filter(Boolean)})}function OM({tournamentRecord:e,drawDefinition:t,participantIds:i,stageSequence:r,stage:n=vu,eventId:a,event:o}){if(!e)return{error:zr};if(!Array.isArray(i))return{error:Ho,participantIds:i};if(!o)return{error:Fn};if(o){let e=xM({element:o,participantIds:i,stageSequence:r,stage:n});if(e.error)return e}if(t){let e=xM({element:t,participantIds:i,stageSequence:r,stage:n});if(e.error)return a?Qs({context:{drawPromotionError:e.error,drawId:t.drawId},result:{..._r},stack:"promoteAlternates"}):e}return{..._r}}function xM({participantIds:e,stageSequence:t,element:i,stage:r}){let n=(i.entries||[]).filter((e=>e.entryStatus===Xh)),a=(i.entries||[]).filter((t=>e.includes(t.participantId))),o=n.reduce(((e,t)=>{let{entryPosition:i}=t;return isNaN(i)&&e||(!e||i<e.entryPosition)&&t||e}),void 0),s=a.length?a:[o].filter(Boolean);if(!s?.length)return{error:ao};let c=s.filter((({entryStatus:e})=>e!==Xh));if(c.length)return{error:no,invalidEntryStatus:c};let d=s.filter((({entryStage:e})=>e&&e!==r));if(d.length)return{error:oo,invalidStage:d};let u=t&&s.filter((e=>e.stageSequence!==t));if(u?.length)return{error:so,invalidStageSequence:u};for(let l of s){l.entryStatus=Qh;let e=l?.entryPosition;isNaN(e)||i.entries.forEach((t=>{t.entryStatus===Xh&&t.entryPosition>e&&(t.entryPosition=t.entryPosition-1)}));let t=Math.max(...i.entries.filter((e=>e.entryStatus===Qh&&!isNaN(e.entryPosition))).map((({entryPosition:e})=>zi(e||0))),0);l.entryPosition=t||0}return{..._r}}function FM({autoEntryPositions:e=!0,participantIds:t,drawDefinition:i,drawId:r,stages:n,event:a}){if(!a)return{error:Fn};if(!r)return{error:In};if(!t?.length)return{error:Ja};if(Sr(Ky({drawDefinition:i,stages:n}).assignedParticipantIds??[],t))return{error:to};let o=e=>{let i=e.participantId;return!t.includes(i)},{flightProfile:s}=XI({event:a}),c=s?.flights?.find((e=>e.drawId===r));return c?.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),e&&(c.drawEntries=Xy({entries:c.drawEntries}))),i?.entries&&(i.entries=i.entries.filter(o),e&&(i.entries=Xy({entries:i.entries}))),{..._r}}function LM(e){let t="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:o}=e,s=e.tournamentId?e.tournamentRecords?.[e.tournamentId]:e.tournamentRecord??(e.activeTournamentId&&e.tournamentRecords?.[e.activeTournamentId]);if(!s)return{error:zr};if(!o)return Qs({result:{error:Wa},stack:t});o.participantId||(o.participantId=Ud()),s.participants||(s.participants=[]);let{participantId:c,individualParticipantIds:d}=o;if(s.participants.reduce(((e,t)=>t.participantId===c||e),!1))return{error:Ka};let{participantType:u,participantRole:l}=o;if(!u||!Object.keys(gh).includes(u))return{error:$a,participantType:u};if(!l)return{error:Ga};let p=s.participants||[],m=p.filter((e=>e.participantType===ph)).map((e=>e.participantId));if(u!==ph&&o.person)return{error:Ho,person:o.person};if(d&&!Array.isArray(d))return{error:Ho,individualParticipantIds:d};if(u===fh){if(o.person)return{error:Ho,person:o.person};if(!o.individualParticipantIds)return Qs({result:{error:Ja},stack:t});if(2!==o.individualParticipantIds.length&&!a)return Qs({info:"PAIR must be 2 individualParticipantIds",result:{error:Va},stack:t});{let e=p.filter((e=>e.participantType===ph)).map((e=>e.participantId));if(!Array.isArray(o.individualParticipantIds))return Qs({result:{error:Va},stack:t});if(!o.individualParticipantIds.reduce(((t,i)=>e.includes(i)&&t),!0))return Qs({result:{error:Va},stack:t})}let e=p.filter((e=>e.participantType===fh)).map((e=>({individualParticipantIds:e.individualParticipantIds,participant:e}))),n=o.participantType===fh&&e.find((e=>2===yr(e.individualParticipantIds,o.individualParticipantIds).length));if(n&&!i)return{..._r,existingParticipant:!0,participant:r&&yd(n.participant)};if(!o.participantName){let e=p.filter((e=>o.individualParticipantIds?.includes(e.participantId))),t=e.map((e=>e.person?.standardFamilyName)).filter(Boolean).join("/");1===e.length&&(t+="/Unknown"),o.participantName=t}}else if(u===ph){if(!o.person?.standardFamilyName||!o.person?.standardGivenName)return{error:eo};if(!o.participantName){let e=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=e}}else{if(!u||![hh,mh].includes(u))return{error:$a};if(d||(o.individualParticipantIds=[]),o.individualParticipantIds?.length)for(let e of o.individualParticipantIds){if("string"!=typeof e)return Qs({result:{participantId:e,error:Ho},stack:t});if(!m.includes(e))return Qs({result:{participantId:e,error:Ya},stack:t})}}return s.participants.push(o),n||As({payload:{tournamentId:s.tournamentId,participants:[o]},topic:yf}),Js({participant:r&&yd(o),..._r})}function _M({allowDuplicateParticipantIdPairs:e,returnParticipants:t,tournamentRecord:i,participants:r=[]}){if(!i)return{error:zr};i.participants||(i.participants=[]);let n=i.participants.map((e=>e.participantId))||[];r.forEach((e=>{e.participantId||(e.participantId=Ud())}));let a=r.filter((e=>!n.includes(e.participantId))),o=r.filter((e=>n.includes(e.participantId))),s=a.filter((e=>e.participantType===ph)),c=a.filter((e=>e.participantType!==ph)),d=s.concat(...c),u=[];if(d.length){for(let t of d){let r=LM({allowDuplicateParticipantIdPairs:e,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:t});if(r.error)return r;r.success&&!r.existingParticipant&&u.push(r.participant)}u.length&&As({topic:yf,payload:{tournamentId:i.tournamentId,participants:u}});let r={participants:t&&yd(u),addedCount:u.length,..._r};return o.length&&Object.assign(r,{notAdded:o,info:io}),Js(r)}return{info:"No new participants to add",addedCount:0,..._r}}function BM(e){let t=dp(e,[{[Tl]:!0,[Kl]:!0}]);if(t.error)return t;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=Xh,participantIdPairs:n=[],entryStage:a=vu,tournamentRecord:o,drawDefinition:s,event:c,uuids:d}=e;if(c.eventType!==ji)return{error:xn};let u=[],l=new Map;for(let y of o.participants??[]){let{participantType:e,participantId:t,person:i,individualParticipantIds:r}=y;e===ph&&i?.sex?l.set(t,i.sex):e===fh&&r&&u.push(r)}let p=n.filter((e=>{if(2!==e.length)return!0;if(!c.gender||sc(c.gender))return!1;if(!l.has(e[0])||!l.has(e[1]))return!0;let t=e.map((e=>l.get(e))),i=ac(c.gender)&&(!ac(t[0])||!ac(t[1]))||nc(c.gender)&&(!nc(t[0])||!nc(t[1]));return oc(c.gender)&&(t.sort(uv),(!nc(t[0])||!ac(t[1]))&&(i=!0)),i}));if(p.length)return{error:Va,invalidParticipantIdPairs:p};let m,f=n.map((e=>({participantId:d?.pop()??Ud(),participantRole:Nv,individualParticipantIds:e,participantType:fh}))),h=i?f:f.filter((e=>!u.find((t=>2===yr(t,e.individualParticipantIds).length)))),g=[];if(h){let e=_M({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(e.error)return e;g=e.participants||[],m=e.info}let I=Dv({participantIds:n.map((e=>{let t=g.find((t=>2===yr(t.individualParticipantIds,e).length));if(t)return t;let{participant:i}=ey({tournamentRecord:o,participantIds:e});return i})).map((e=>e.participantId)),tournamentRecord:o,drawDefinition:s,entryStatus:r,entryStage:a,event:c});return h.length&&As({payload:{participants:h},topic:yf}),{...I,info:m,newParticipantIds:h.map(Om)}}function VM({entryStatus:e=Qh,unpairedParticipantIds:t=[],participantIdPairs:i=[],entryStage:r=vu,tournamentRecord:n,event:a}){if(!n)return{error:zr};if(!a)return{error:Fn};let o=n.participants??[],s=o.filter((e=>e.participantType===ph)).map((e=>e.participantId)),c=t.concat(...i).flat(1/0).filter((e=>!s.includes(e)));if(c.length)return{error:Va,invalidParticipantIds:c};let d=i.filter((e=>2!==e.length));if(d.length)return{error:Va,invalidParticipantIdPairs:d};let u=o.filter((e=>e.participantType===fh)).map((e=>e.individualParticipantIds)),l=_M({participants:i.filter((e=>!u.find((t=>2===yr(t,e).length)))).map((e=>({participantType:fh,participantRole:Nv,individualParticipantIds:e}))),tournamentRecord:n});if(l.error)return l;let p=i.map((e=>{let{participant:t}=ey({tournamentRecord:n,participantIds:e});return t})).map((t=>({participantId:t,entryStatus:e,entryStage:r}))),m=t.map((e=>({entryStatus:ag,participantId:e,entryStage:r})));return a.entries=(a.entries??[]).filter((e=>e.entryStage===r)),a.entries=a.entries.concat(...p,...m),{..._r}}Oi(RM,{addDrawEntries:()=>Sv,addEventEntries:()=>Dv,addEventEntryPairs:()=>BM,destroyPairEntries:()=>jv,destroyPairEntry:()=>Vv,modifyEntriesStatus:()=>Qy,modifyEventEntries:()=>VM,promoteAlternate:()=>kM,promoteAlternates:()=>OM,removeDrawEntries:()=>FM,removeEventEntries:()=>bv,setEntryPosition:()=>CM,setEntryPositions:()=>AM});var jM={};Oi(jM,{addDrawDefinition:()=>IR,addEvent:()=>WM,addFlight:()=>DR,assignSeedPositions:()=>yR,attachFlightProfile:()=>vR,categoryCanContain:()=>ld,deleteDrawDefinitions:()=>ZM,deleteEvents:()=>wR,deleteFlightAndFlightDraw:()=>hR,deleteFlightProfileAndFlightDraws:()=>eR,generate:()=>$M,generateEventsFromTieFormat:()=>qM,getCategoryAgeDetails:()=>dd,getEvent:()=>bM,getEventProperties:()=>SM,getEventStructures:()=>OS,getEventTimeItem:()=>Ph,getEvents:()=>UM,getFlightProfile:()=>XI,getScaledEntries:()=>lN,modifyEvent:()=>TR,modifyEventMatchUpFormatTiming:()=>nR,modifyPairAssignment:()=>gR,mutate:()=>HM,query:()=>vM,refreshEventDrawOrder:()=>fR,removeEventMatchUpFormatTiming:()=>aR,removeScaleValues:()=>SR,removeSeeding:()=>bR,setEventDates:()=>lR,setEventDisplay:()=>UR,setEventEndDate:()=>uR,setEventStartDate:()=>dR,updateDrawIdsOrder:()=>mR,validateCategory:()=>ud});var $M={};Oi($M,{generateEventsFromTieFormat:()=>qM});var GM={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:xd,DOMINANT_DUO_MIXED:Ed,LAVER_CUP:Vd,TEAM_DOUBLES_3_AGGREGATION:wd,TIME_TENNIS_DUAL:Md,TIME_TENNIS_PRO_CIRCUIT:Nd,USTA_BREWER_CUP:Rd,USTA_OZAKI_CUP:Cd,USTA_COLLEGE:Fd,USTA_GOLD_TEAM_CHALLENGE:bd,USTA_INTERSECTIONAL:Pd,USTA_LEVEL_1:Ld,USTA_SECTION_BATTLE:Dd,USTA_SOUTHERN_LEVEL_5:Td,USTA_TOC:jd,USTA_WTT_ITT:_d,USTA_ZONAL:Bd};function WM({suppressNotifications:e,tournamentRecord:t,internalUse:i,event:r}){if(!t)return{error:zr};if(t.events||(t.events=[]),!r)return{error:Fn};let{startDate:n,endDate:a}=t;if(!i&&(r.entries?.length||r.drawDefinitions?.length)){let e=Js({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:Ho,context:e}}let o={eventType:mu,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===Iu)if(r.tieFormat){let e=md({tieFormat:r.tieFormat});if(e.error)return e}else if(r.tieFormatName){if(!GM[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:Ho};let e=lu({isMock:t?.isMock,namedFormat:r.tieFormatName,event:r});o.tieFormat=e}if(o.eventId||(o.eventId=Ud()),t.events.reduce(((e,t)=>e||t.eventId===o.eventId),void 0))return{error:_n};{let i=o;if(t.events.push(i),!e){let{topics:e}=Ls();if(e.includes(If)){let e=yy({event:r}).matchUps??[];Kf({tournamentId:t?.tournamentId,eventId:r.eventId,matchUps:e})}let{drawDefinitions:i,...n}=r;for(let t of i||[])Qf({drawDefinition:t});!function({tournamentId:e,event:t}){t&&As({payload:{tournamentId:e,event:t},key:t.eventId,topic:Sf})}({tournamentId:t?.tournamentId,event:n})}return{..._r,event:o}}}function qM(e){let t=dp(e,[{[ap]:{[_l]:!0,[Nl]:!0}},{[Tl]:!0}]);if(t.error)return t;let i=e.tieFormat||lu({namedFormat:e.tieFormatName}),r=e.uuids||[Sd(i.collectionDefinitions.length)],n={[ic]:[],[Zs]:[]};if(e.addEntriesFromTeams){let t=e.tournamentRecord.participants?.filter((e=>e.participantType===lh))?.flatMap((e=>e.individualParticipantIds??[]));for(let i of e.tournamentRecord.participants??[])if(t?.includes(i.participantId)){let e=i.person?.sex;if(e&&dc(e)){let t=cc(e);t&&n[t].push(i.participantId)}}}let a=[];for(let o of i.collectionDefinitions??[]){let t=r?.pop()?.toString()||Ud(),i=o.matchUpType,s=o.gender,c={matchUpFormat:o.matchUpFormat,eventName:o.collectionName,category:o.category,gender:s,eventType:i,eventId:t};if(e.addEntriesFromTeams){let t=i===hu?ag:e.entryStatus||Qh,r=oc(s)?[...n[ic],...n[Zs]]:n[cc(s)||ec]??[];if(r.length){let e=Dv({participantIds:r,entryStatus:t,event:c});if(e.error)return e}}if(a.push(c),!1!==e.addEvents){let t=WM({internalUse:!0,tournamentRecord:e.tournamentRecord,event:c});if(t.error)return t}}return{..._r,events:a}}var HM={};function zM({removePriorValues:e=!0,status:t=fI,statusObject:i,event:r}){if(!Rr(i))return{error:Ho};let n=rv({event:r,status:t}),a=`${mI}.${hI}`;return Ew({timeItem:{itemValue:{[t]:{...n,...i}},itemType:a},removePriorValues:e,event:r})}function YM(e){let t=dp(e,[{[Tl]:!0,[Kl]:!0},{eventDataParams:!1,[rp]:Ql}]);if(t.error)return t;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=fI,event:o,drawIdsToRemove:s,drawIdsToAdd:c}=e,{appliedPolicies:d}=Fh({tournamentRecord:n,event:o}),u={...d,...e.policyDefinitions},l=o?.drawDefinitions?.map((({drawId:e})=>e))??[],p=e.drawDetails?Object.keys(e.drawDetails):[],m=p.length?[]:e.drawIds,f=(c??[]).concat(...s??[],...m??[],...p),h=f.filter((e=>!l.includes(e)));if(h.length)return Qs({result:{error:Zr},context:{invalidDrawIds:h}});let g=rv({event:o,status:a}),I=Object.keys(g?.drawDetails||{}).filter((e=>l.includes(e))).reduce(((e,t)=>(e[t]=g.drawDetails[t],e)),{});for(let U of l)if((!f.length||f.includes(U))&&(s?.includes(U)||m?.length&&!m.includes(U)?I[U]={...I[U],publishingDetail:{published:!1}}:(c?.includes(U)||m?.includes(U)||!m?.length)&&(I[U]={...I[U],publishingDetail:{published:!0}})),e.drawDetails?.[U]){let t=e.drawDetails[U],i=t.structureDetails??I[U].structureDetails,r=t.stageDetails??I[U].stageDetails??{},{structureIdsToRemove:n=[],structureIdsToAdd:a=[],publishingDetail:s={},stagesToRemove:c=[],stagesToAdd:d=[]}=t;if((a||d)&&(s.published=!0),I[U]={publishingDetail:s,structureDetails:i,stageDetails:r},a.length||n.length){let e=(o?.drawDefinitions?.find((e=>e.drawId===U))?.structures??[]).map((({structureId:e})=>e)),t=(a??[]).concat(n??[]).filter((t=>!e.includes(t)));if(t.length)return Qs({result:{error:Rn},context:{invalidStructureIds:t}});i=i??{};for(let r of e)n.includes(r)?i[r]={published:!1}:i[r]={published:!0};I[U].structureDetails=i}let u=(o?.drawDefinitions?.find((e=>e.drawId===U))?.structures??[]).map((({stage:e})=>e));if(d.length){for(let e of d)r[e]={published:!0};for(let e of u)r[e]||(r[e]={published:!1})}if(d.length||c.length){for(let e of c)r[e]={published:!1};for(let e of u)r[e]||(r[e]={published:!0})}(d.length||c.length)&&(I[U].stageDetails=r)}zM({statusObject:{drawDetails:I},removePriorValues:r,status:a,event:o});let{topics:y}=Ls(),v=y.includes(_f),S=v||e.returnEventData?hE({includePositionAssignments:i,...e.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:u,event:o})?.eventData:void 0;return v&&As({payload:{eventData:S,tournamentId:n.tournamentId},topic:_f}),{..._r,eventData:S}}Oi(HM,{addDrawDefinition:()=>IR,addEvent:()=>WM,addFlight:()=>DR,assignSeedPositions:()=>yR,attachFlightProfile:()=>vR,deleteDrawDefinitions:()=>ZM,deleteEvents:()=>wR,deleteFlightAndFlightDraw:()=>hR,deleteFlightProfileAndFlightDraws:()=>eR,modifyEvent:()=>TR,modifyEventMatchUpFormatTiming:()=>nR,modifyPairAssignment:()=>gR,refreshEventDrawOrder:()=>fR,removeEventMatchUpFormatTiming:()=>aR,removeScaleValues:()=>SR,removeSeeding:()=>bR,setEventDates:()=>lR,setEventDisplay:()=>UR,setEventEndDate:()=>uR,setEventStartDate:()=>dR,updateDrawIdsOrder:()=>mR,validateCategory:()=>ud});var KM="deleteDrawDefinitions",XM="autoSchedulingAudit",JM="deleteEvents",QM={AUTO_SCHEDULING_AUDIT:XM,DELETE_EVENTS:JM,DELETE_DRAW_DEFINITIONS:KM};function ZM(e){if(!e.tournamentRecord)return{error:zr};let t="deleteDrawDefinitions",i=e.drawIds??[],r=e.event,{autoPublish:n=!0,tournamentRecord:a,auditData:o,eventId:s,force:c}=e,{appliedPolicies:d}=Fh({tournamentRecord:a,event:r}),u={...d,...e.policyDefinitions},l=Array.isArray(i)?i[0]:void 0;if(!r){let e=JI({tournamentRecord:a,eventId:s,drawId:l});if(e.error)return e;r=e.event}let p=[],m=[],f=[];if(!r?.drawDefinitions)return Qs({info:"event has no drawDefinition",result:{..._r},stack:t});let h=r.drawDefinitions.map((({drawId:e})=>e));if(i.length||(i=h),i=i.filter((e=>h.includes(e))),!i.length)return Qs({info:"nothing to do; no matching drawIds in event.",result:{..._r},stack:t});let g,I=yd(XI({event:r}).flightProfile,!1,!0),y=({participantId:e,drawPosition:t,qualifier:i,bye:r})=>({bye:r,qualifier:i,drawPosition:t,participantId:e}),v=c??d?.[Rp]?.allowDeletionWithScoresPresent?.drawDefinitions,S=rv({event:r})??{},U=S.drawIds??(S.drawDetails&&Object.keys(S.drawDetails))??[],b=[],w=r.drawDefinitions.filter((e=>{if(i.includes(e.drawId)){let t=by({event:r,drawDefinition:e})?.matchUps??[];if(t.some((({score:e})=>My({score:e})))&&!v)return b.push(e.drawId),!0;let{drawId:i,drawType:n,drawName:c}=e,d=I?.flights?.find((t=>t.drawId===e.drawId));d&&(d.drawEntries=d.drawEntries?.filter((e=>pg.includes(e.entryStatus)))),U.includes(i)&&(U=U.filter((e=>e!==i)),g=!0);let u=pf({stageSequence:1,drawDefinition:e,stage:vu})?.structures?.[0],l=(u?kT({structureId:u.structureId,tournamentRecord:a,drawDefinition:e}):void 0)?.positionAssignments?.map(y),h=pf({stage:Su,drawDefinition:e})?.structures,S=h?.length?h.map((t=>{let i=t.stageSequence;return{positionAssignments:kT({structureId:t.structureId,tournamentRecord:a,drawDefinition:e})?.positionAssignments.map(y),stageSequence:i}})):void 0,w={action:KM,payload:{drawDefinitions:[e],eventId:s??r?.eventId,auditData:o}};f.push(w),p.push(Js({tournamentId:a.tournamentId,eventId:s??r?.eventId,qualifyingPositionAssignments:S,positionAssignments:l,auditData:o,drawType:n,drawName:c,drawId:i})),t?.forEach((({matchUpId:e})=>m.push(e)))}return!i.includes(e.drawId)}));if(b.length&&!c)return Qs({context:{drawIdsWithScoresPresent:b},result:{error:cs},stack:t});if(r.drawDefinitions=w,I&&Gp({event:r,extension:{name:sm,value:I}}),DE({tournamentRecord:a}),g){let e={};for(let i of U)e[i]=S.drawDetails?.[i]??{published:!0};let t=zM({statusObject:{drawDetails:e},event:r});if(t.error)return{error:t.error}}if(f.length)if(_s(bf)){let e=a.tournamentId;As({topic:bf,payload:{tournamentId:e,detail:f}});let t=(Th({element:r,itemType:am})?.timeItem?.itemValue||0)+1;Dw({element:r,timeItem:{itemType:am,itemValue:t},removePriorValues:!0})}else!function({appliedPolicies:e,event:t,deletedDrawsDetail:i,auditData:r}){if(!1===e?.audit?.[am])return;let{extension:n}=Jp({name:am,element:t}),a={...r,deletedDrawsDetail:i},o={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:am};Vp({element:t,extension:o})}({appliedPolicies:d,event:r,deletedDrawsDetail:p,auditData:o});if(m.length&&Xf({tournamentId:a?.tournamentId,matchUpIds:m}),i.forEach((e=>function({tournamentId:e,eventId:t,drawId:i}){return As({payload:{drawId:i,tournamentId:e,eventId:t},topic:Pf,key:i}),xs({key:i}),{..._r}}({drawId:e}))),n&&g){let t=YM({...e.eventDataParams,drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:r});if(t.error)return{..._r,info:t.error}}return{..._r}}function eR({autoPublish:e=!0,tournamentRecord:t,auditData:i,event:r,force:n}){if(!t)return{error:zr};if(!r)return{error:Fn};let{flightProfile:a}=XI({event:r});if(a){let o=a.flights?.map((({drawId:e})=>e)).filter(Boolean),s=ZM({eventId:r.eventId,tournamentRecord:t,autoPublish:e,auditData:i,drawIds:o,event:r,force:n});return s.error?s:zp({event:r,name:sm})}return{..._r}}function tR(e){let{matchUpFormat:t,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=e,o=e?.tournamentRecords??(e?.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Hr};let s,c=Object.keys(o).filter((e=>!n||n===e));if(n&&!c.includes(n))return{error:Ho};for(let d of c){let e=o[d],{event:n}=JI({tournamentRecord:e,eventId:a});a&&n&&(s=!0);let c=iR({tournamentRecord:e,event:n,matchUpFormat:t,averageTimes:r,recoveryTimes:i});if(c.error)return c}return!a||s?{..._r}:{error:Ln}}function iR({tournamentRecord:e,recoveryTimes:t,matchUpFormat:i,averageTimes:r,event:n}){if(!e)return{error:zr};if(r&&!Array.isArray(r))return{error:Ho};if(t&&!Array.isArray(t))return{error:Ho};let a=Im;if(n){let{extension:e}=Jp({element:n,name:a});Vp({element:n,extension:{name:a,value:rR({...e?.value||{},matchUpFormat:i,averageTimes:r,recoveryTimes:t})}})}else{let{extension:n}=Jp({element:e,name:a});Vp({extension:{name:a,value:rR({...n?.value||{},matchUpFormat:i,averageTimes:r,recoveryTimes:t})},element:e})}return{..._r}}function rR(e){let{matchUpRecoveryTimes:t=[],matchUpAverageTimes:i=[],matchUpFormat:r}=e,{averageTimes:n,recoveryTimes:a}=e;n=(n||[]).filter((e=>e?.categoryNames?.length||e?.categoryTypes?.length));let o=n?.length&&i.map((e=>e?.matchUpFormatCodes.includes(r)?{...e,matchUpFormatCodes:e.matchUpFormatCodes?.filter((e=>e!==r))}:e)).filter((({matchUpFormatCodes:e})=>e?.length)).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter((e=>e?.categoryNames?.length||e?.categoryTypes?.length));let s=a?.length&&t.map((e=>e?.matchUpFormatCodes.includes(r)?{...e,matchUpFormatCodes:e.matchUpFormatCodes?.filter((e=>e!==r))}:e)).filter((({matchUpFormatCodes:e,averageTimes:t})=>e?.length||t)).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:o?.length&&o||i,matchUpRecoveryTimes:s?.length&&s||t}}function nR(e){let{tournamentRecord:t,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=e;if(!t)return{error:zr};if(!Ec({matchUpFormat:n}))return{error:Ho};if(!s)return{error:Fn};let{averageTimes:c=[],recoveryTimes:d=[]}=HE({tournamentRecord:t,matchUpFormat:n,event:s}),u=s.category,l=u?.categoryName||u?.ageCategoryCode||s?.eventId,p={categoryNames:[l],minutes:{}},m={categoryNames:[l],minutes:{}},f=e=>{if(e.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!e.categoryNames?.includes(l)||(e.categoryNames=e.categoryNames.filter((e=>e!==l)),p={minutes:e.minutes,categoryNames:[l]},e.categoryNames.length))return e},h=r&&!isNaN(zi(r)),g=i&&!isNaN(zi(i)),I=c.map(f).filter((e=>e?.categoryNames?.length)),y=d.map(f).filter((e=>e?.categoryNames?.length));return h&&(Object.assign(p.minutes,{[s?.eventType||Bi]:r}),I.push(p)),g&&(Object.assign(m.minutes,{[s?.eventType||Bi]:i}),y.push(m)),h||g?tR({averageTimes:h&&I,recoveryTimes:g&&y,tournamentRecord:t,matchUpFormat:n,eventId:o}):{error:Ho}}function aR(e){if(e.event)return oR({event:e.event});{e.tournamentRecord&&!e.tournamentRecords&&(e.tournamentRecords={[e.tournamentRecord.tournamentId]:e.tournamentRecord});let t=dp(e,[{[bl]:!0,[ql]:!0}]);if(t.error)return t;let{tournamentRecords:i,eventId:r}=e;for(let e of Object.values(i??{})){let{event:t}=JI({tournamentRecord:e,eventId:r});if(t)return oR({event:t})}}return{error:Ln}}function oR({event:e}){return zp({event:e,name:Im})}var sR={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function cR(e){return!(!Array.isArray(e)||ar(e).length!==e.length)&&e.every((e=>Object.keys(sR).includes(e)))}function dR({tournamentRecord:e,event:t,startDate:i}){if(!e)return{error:zr};if(!t)return{error:Fn};if(!Cc.test(i))return{error:Pa};let r=pR(e);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(Yc(i)).getTime();if(!n||!a||o<n||o>a)return{error:Pa};let s=t.endDate&&new Date(Yc(t.endDate)).getTime();return s&&o>s&&(t.endDate=i),t.startDate=i,{..._r}}function uR(e){let{tournamentRecord:t,event:i,endDate:r}=e;if(!t)return{error:zr};if(!i)return{error:Fn};if(!Cc.test(r))return{error:Pa};let n=pR(t);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:o}=n,s=new Date(Yc(r)).getTime();if(!a||!o||s<a||s>o)return{error:Pa};let c=i.startDate&&new Date(Yc(i.startDate)).getTime();return c&&s<c&&(i.startDate=r),i.endDate=r,{..._r}}function lR(e){let t=dp(e,[{tournamentRecord:!0,event:!0},{[ep]:e=>Cc.test(e),[ip]:Pa,startDate:!1,endDate:!1},{[ep]:e=>e.filter(Boolean).every((e=>Cc.test(e))),[ip]:Pa,activeDates:!1},{[ep]:cR,weekdays:!1}]);if(t.error)return t;let{tournamentRecord:i,weekdays:r,event:n,startDate:a,endDate:o}=e,s=e.activeDates?.filter(Boolean);if(a&&o){if(new Date(Yc(a)).getTime()>new Date(Yc(o)).getTime())return{error:Ho}}if(s){let e=a||i.startDate,t=o||i.endDate,r=!e||s.every((t=>new Date(t)>=new Date(e))),n=!t||s.every((e=>new Date(e)<=new Date(t)));if(!r||!n)return{error:Pa}}if(a){let e=dR({tournamentRecord:i,event:n,startDate:a});if(e.error)return e}if(o){let e=uR({tournamentRecord:i,event:n,endDate:o});if(e.error)return e}return s&&(n.activeDates=s),r&&(n.weekdays=r),{..._r}}function pR(e){let{startDate:t,endDate:i}=e;return Cc.test(t)&&Cc.test(i)?{tournamentStartDate:new Date(Yc(t)).getTime(),tournamentEndDate:new Date(Yc(i)).getTime()}:Qs({result:{error:Ea},context:{startDate:t,endDate:i}})}function mR({event:e,orderedDrawIdsMap:t}){if("object"!=typeof e)return{error:Fn};if(!t)return{error:va,info:"Missing drawIdsOrderMap"};if("object"!=typeof t)return{error:Ho,info:"orderedDrawIdsMap must be an object"};let i=Object.values(t);if(!i.every((e=>!isNaN(e))))return{error:Ho,info:"drawOrder must be numeric"};if(ar(i).length!==i.length)return{error:Ho,info:"drawOrder values must be unique"};if(e.drawDefinitions?.length){let i=(e.drawDefinitions||[]).map((({drawId:e})=>e)),r=Object.keys(t);if(r?.length&&yr(i,r).length!==i.length)return{error:Ho,info:"Missing drawIds"};e.drawDefinitions.forEach((e=>{e.drawOrder=t[e.drawId]}))}let{flightProfile:r}=XI({event:e});return r?.flights?.forEach((e=>{e.flightNumber=t[e.drawId]})),{..._r}}function fR({tournamentRecord:e,event:t}){if(!e)return{error:zr};if(!t)return{error:Fn};let{flightProfile:i}=XI({event:t}),r=i?.flights&&Object.assign({},...i.flights.sort(((e,t)=>e.flightNumber-t.flightNumber)).map(((e,t)=>({[e.drawId]:t+1}))))||t.drawDefinitions?.length&&Object.assign({},...t.drawDefinitions.sort(((e,t)=>e.drawOrder-t.drawOrder)).map(((e,t)=>({[e.drawId]:t+1}))))||void 0;return r?mR({event:t,orderedDrawIdsMap:r}):{..._r}}function hR({autoPublish:e=!0,tournamentRecord:t,auditData:i,drawId:r,event:n,force:a}){if(!t)return{error:zr};if(!r)return{error:In};if(!n)return{error:Fn};let{flightProfile:o}=XI({event:n});if(o&&o.flights?.find((e=>e.drawId===r))){let e=o.flights.filter((e=>e.drawId!==r));Gp({event:n,extension:{name:sm,value:{...o,flights:e}}})}if(n.drawDefinitions?.find((e=>e.drawId===r))){let o=ZM({drawIds:[r],eventId:n.eventId,tournamentRecord:t,autoPublish:e,auditData:i,event:n,force:a});if(o.error)return o}return fR({tournamentRecord:t,event:n})}function gR(e){let t=dp(e,[{[Kl]:!0,[Tl]:!0,[Jl]:!1},{replacementIndividualParticipantId:!0,[ep]:e=>Mr(e),existingIndividualParticipantId:!0,[Yl]:Ha,participantId:!0}]),{replacementIndividualParticipantId:i,existingIndividualParticipantId:r,tournamentRecord:n,drawDefinition:a,participantId:o,event:s,uuids:c}=e;if(t.error)return t;if(s?.eventType!==fu)return{error:xn};if(!(s?.entries?.filter((({entryStatus:e})=>[ag,og].includes(e))).map((({participantId:e})=>e))||[]).includes(i))return{error:Ba};let d=(n.participants||[]).find((e=>e.participantId===o));if(d?.participantType!==fh)return{error:_a,participant:d};let u,l=d.individualParticipantIds,p=[i,...l.filter((e=>e!==r))],{participant:m}=ey({participantIds:p,tournamentRecord:n});if(m)u=m.participantId;else{let e=LM({participant:{participantId:c?.pop(),participantRole:Nv,individualParticipantIds:p,participantType:fh},returnParticipant:!0,tournamentRecord:n});if(e.error)return e;u=e.participant.participantId}let{flightProfile:f}=XI({event:s});if(a){let e=f?.flights?.find((({drawId:e})=>e===a.drawId));e&&(e.drawEntries=e.drawEntries.map((e=>e.participantId===o?{...e,participantId:u}:e))),a.entries=a.entries.map((e=>e.participantId===o?{...e,participantId:u}:e));for(let t of a.structures||[])if(t.structures){t.positionAssignments=void 0;for(let e of t.structures)e.positionAssignments=e.positionAssignments.map((e=>e.participantId===o?{...e,participantId:u}:e))}else t.positionAssignments&&(t.positionAssignments=t.positionAssignments.map((e=>e.participantId===o?{...e,participantId:u}:e)))}s.entries=s.entries.map((e=>e.participantId===o&&{...e,participantId:u}||e.participantId===i&&{...e,participantId:r}||e));let h=n.events.some((({entries:e,eventId:t,drawDefinitions:i})=>s.eventId===t?i.some((({drawId:e,entries:t})=>e!==a?.drawId&&t?.find((e=>e.participantId===o)))):e?.find((e=>e.participantId===o))));if(!h){let e=Lv({addIndividualParticipantsToEvents:!1,participantIds:[o],tournamentRecord:n});if(e.error)return e}return{..._r,participantOtherEntries:h,newPairParticipantId:u}}function IR(e){let{flight:t,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:c,event:d}=e;if(!c)return{error:Jr};if(!d)return{error:Fn};d.drawDefinitions||(d.drawDefinitions=[]);let{drawId:u,drawName:l,entries:p}=c,{entries:m}=d,f=0;if(void 0!==n&&n!==d.drawDefinitions.length)return{error:Ho,info:"drawDefintions count mismatch"};let{flightProfile:h}=XI({event:d}),g=t&&h?.flights?.find((e=>e.flightNumber===t.flightNumber)),I=h?.links?.find((e=>e?.target?.drawId===u))?.source?.drawId;if(I&&!d.drawDefinitions.find((e=>e.drawId===I)))return Qs({result:{error:Jr},info:{sourceDrawId:I}});if(g&&g.drawId!==c.drawId)return Qs({result:{error:Xr},info:{relevantFlight:g}});let y=p?.every((({participantId:e,entryStatus:t})=>{let i=g?.drawEntries.find((t=>t.participantId===e));return!t||i?.entryStatus===t})),v=!o||m&&p?.every((({participantId:e,entryStatus:t,entryStage:i})=>m.find((t=>t.participantId===e&&(!t.entryStage||t.entryStage===i)))?.entryStatus===t));if(g&&!y)return Qs({result:{error:Xr},context:{drawEntriesPresentInFlight:y,matchingEventEntries:v,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&p?.filter(Boolean).forEach((e=>{if(e?.entryStatus&&pg.includes(e?.entryStatus)){let t=m?.filter(Boolean).find((t=>t.participantId===e.participantId));t&&e.entryStatus&&t?.entryStatus!==e.entryStatus&&(t.entryStatus=e.entryStatus,f+=1)}})),m&&!v)return Qs({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:v,eventEntries:m},error:Xr}});let S,U=h?.flights?.map((({flightNumber:e})=>!isNaN(e)&&zi(e)))?.filter(Boolean)||[],b=d.drawDefinitions.map((({drawOrder:e})=>e&&zi(e)))?.filter(Boolean)||[],w=Math.max(0,...b,...U)+1,T=h?.flights?.find((e=>e.drawId===u));if(T){T.drawName=c.drawName,S={name:sm,value:{...h,flights:h.flights}};let e=T.flightNumber;e&&!b.includes(e)?w=e:T.flightNumber=w}else{let e=h?.flights||[];e.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:l,drawId:u}),S={name:sm,value:{...h||{},flights:e}}}Gp({event:d,extension:S}),Object.assign(c,{drawOrder:w});let D=d.drawDefinitions.find((e=>e.drawId===u)),P=s?.tournamentId,N=d.eventId;if(D){if(!a)return{error:yn};let e=by({drawDefinition:D})?.matchUps?.map(xm)??[],t=by({drawDefinition:c})?.matchUps;if(!i){e?.length&&Xf({matchUpIds:e,action:"modifyDrawDefinition",tournamentId:P,eventId:N}),t?.length&&Kf({matchUps:t,tournamentId:P,eventId:N}),d.drawDefinitions=d.drawDefinitions.map((e=>e.drawId===u?c:e));let i=c.structures?.map((({structureId:e})=>e));Zf({drawDefinition:c,tournamentId:P,structureIds:i,eventId:N})}}else if(d.drawDefinitions.push(c),!i){let{matchUps:e}=by({drawDefinition:c,event:d});e&&Kf({tournamentId:s?.tournamentId,matchUps:e}),Qf({drawDefinition:c,tournamentId:P,eventId:N})}return{..._r,modifiedEventEntryStatusCount:f}}function yR(e){let{provisionalPositioning:t,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:c,event:d}=e,u=0;if(!s?.length)return{error:jn};if(!r)return{error:zr};if(!c)return{error:In};let l=yg({provisionalPositioning:t,drawDefinition:n,structureId:o});if(l.error)return l;let{seedAssignments:p,seedLimit:m}=l,f=Object.assign({},...(p??[]).filter((e=>e.seedNumber)).map((e=>({[e.seedNumber]:e}))));s.forEach((e=>{let{seedNumber:t}=e;m&&t<=m&&(!i||f[t])&&(f[t]=e)}));let h=Object.values(f),g=h.map((e=>e?.participantId)).filter(Boolean);if(g.length!==mr(g).length)return{error:vn};for(let I of h){let e=lS({...I,provisionalPositioning:t,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:d});if(e?.error)return e;e?.success&&u++}return u?{..._r,modifications:u}:{error:_o}}function vR({deleteExisting:e,event:t,flightProfile:i}){let r="attachFlightProfile";if(!i)return Qs({result:{error:va},stack:r});if(!t)return Qs({result:{error:Fn},stack:r});let{flightProfile:n}=XI({event:t});return n&&!e?Qs({result:{error:ts},stack:r}):t.drawDefinitions?.length?Qs({result:{error:Qr},stack:r}):(Gp({event:t,extension:{name:sm,value:i}}),{flightProfile:yd(i,!1,!0),..._r})}function SR({tournamentRecord:e,scaleAttributes:t,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){if(!a)return{error:Fn};if(r&&!Array.isArray(r))return Qs({result:{error:Ho},info:SS("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(n){let{flightProfile:e}=XI({event:a}),t=e?.flights?.find((e=>e.drawId===n));s=t?t.drawEntries:i?.entries}return function({tournamentRecord:e,scaleAttributes:t,participantIds:i}){if(!e)return{error:zr};if(!i)return{error:Ja};if(!t)return{error:va,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=t,o=[dI,r,n,a].join(".");return e.participants?.forEach((e=>{i.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter((e=>e&&e?.itemType!==o)))})),{..._r}}({tournamentRecord:e,scaleAttributes:t,participantIds:(s||[]).filter((e=>(!o||!e.entryStage||e.entryStage===o)&&(!r||r.includes(e.entryStatus)))).map(Om)})}function UR({removePriorValues:e,tournamentRecord:t,displaySettings:i,status:r=fI,event:n}){if(!t)return Qs({result:{error:zr}});if(!n)return Qs({result:{error:Fn}});if(!Rr(i))return Qs({result:{error:va}});if(Rr(i.draws))for(let o of Object.keys(i.draws)){let e=i.draws[o].scheduleDetails??[];if(e.length){let t=[];for(let i of e){let e=t.find((e=>Cr(e.attributes,i.attributes)));e?.dates&&i.dates?e.dates.push(...i.dates):t.push(i)}i.draws[o].scheduleDetails=t}}let a=zM({statusObject:{displaySettings:i},removePriorValues:e,status:r,event:n});return a.error?a:{..._r}}function bR({tournamentRecord:e,drawDefinition:t,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){if(!e)return{error:zr};if(!a)return{error:Fn};return r=r||a.category?.categoryName||a.category?.ageCategoryCode,SR({tournamentRecord:e,scaleAttributes:{eventType:a.eventType,scaleType:hp,scaleName:r},drawDefinition:t,entryStatuses:i,drawId:n,event:a,stage:o})}function wR(e){let t=dp(e,[{[Tl]:!0},{eventIds:!0,[rp]:Zl}]);if(t.error)return t;let{removePairParticipants:i,tournamentRecord:r,eventIds:n}=e,a=[],o=[],s=[],c=[];if(r.events=(r.events||[]).filter((e=>{if(n.includes(e.eventId)){let t={action:JM,payload:{events:[e]}};a.push(t),o.push({tournamentId:r.tournamentId,eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}let t=e.eventType===fu?(e.entries||[]).map((({entryStatus:e,participantId:t})=>e!==ag&&t)).filter(Boolean):[],i=n.includes(e.eventId);return i?c.push(...t):s.push(...t),!i})),i){let e=c.filter((e=>!s.includes(e)));r.participants=r.participants.filter((({participantId:t})=>!e.includes(t)))}if(DE({tournamentRecord:r}),a.length)if(_s(bf)){let e=r.tournamentId;As({topic:bf,payload:{type:JM,tournamentId:e,detail:a}})}else Nw({tournamentRecord:r,timeItem:{itemValue:o,itemType:JM}});return{..._r}}function TR(e){let t=dp(e,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Ql}]);if(t.error)return t;let{eventUpdates:i,event:r}=e,n="modifyEvent",a=function(e){let{tournamentRecord:t,event:i}=e,r=i?.entries?.filter((({entryStatus:e})=>{let t=e;return[...pg,Xh].includes(t)})).map((({participantId:e})=>e))??[];return r?mv({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[]}(e),o=function({enteredParticipants:e}){let t=[],i=e.reduce(((e,i)=>{let r=i.person?.sex?[i.person.sex]:i.individualParticpants?.map((e=>e.person?.sex))||[];return t.push(...r),e.includes(i.participantType)?e:e.concat(i.participantType)}),[]),r=ar(t);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}({enteredParticipants:a}),{enteredParticipantGenders:s,enteredParticipantTypes:c}=o,d=XI({event:r})?.flightProfile?.flights,u=function({noFlightsNoDraws:e,enteredParticipantGenders:t,eventUpdates:i,stack:r}){let n=!t.length||!i.gender||sc(i.gender)||1===t.length&&t[0]===i.gender||e&&oc(i.gender);return i.gender&&!n?Qs({context:{gender:i.gender,validGender:n},result:{error:Wo},stack:r}):{..._r}}({noFlightsNoDraws:!r.drawDefinitions?.length&&!d?.length,enteredParticipantGenders:s,eventUpdates:i,stack:n});if(u.error)return u;let l=function({enteredParticipantTypes:e,eventUpdates:t,stack:i}){let r=(e.includes(gu)&&[gu]||e.includes(ph)&&[pu]||e.includes(fh)&&[fu]||[fu,pu,gu]).includes(t.eventType??"");return t.eventType&&!r?Qs({context:{participantType:t.eventType,validEventType:r},result:{error:xn},stack:i}):{..._r}}({enteredParticipantTypes:c,eventUpdates:i,stack:n});if(l.error)return l;let p=function(e){let t=e.eventUpdates?.category;if(!t)return{..._r};let i=ud({category:t});if(i.error)return i;if(e.event.eventType===gu){let t=e.event?.drawDefinitions?.map((e=>vg(e)))??[],i=vg(e.event),r=(yy(e)?.matchUps??[]).map((e=>vg(e)))??[];if(![i,...t,...r].filter(Boolean).every((t=>t.collectionDefinitions.every((t=>!t.category||ld({category:e.eventUpdates.category,childCategory:t.category}))))))return Qs({result:{error:qo},stack:e.stack})}if(e.enteredParticipants?.length){let i=e.eventUpdates.startDate||e.event.startDate||e.tournamentRecord.startDate,r=e.eventUpdates.endDate||e.event.endDate||e.tournamentRecord.endDate,n=e.enteredParticipants.map((e=>e.participantType===ph?e:e.individualParticpants??[])).flat(),a=dd({category:t,consideredDate:i}),o=dd({category:t,consideredDate:r});if(a?.ageMinDate||a?.ageMaxDate||o?.ageMinDate||o?.ageMaxDate)for(let t of n){let i=t.person?.birthDate;if(!i)return Qs({result:{error:Sa},stack:e.stack});let r=new Date(i).getTime();if(a.ageMinDate||a.ageMaxDate){let t=new Date(a.ageMinDate).getTime(),i=new Date(a.ageMaxDate).getTime();if(r<t||r>i)return Qs({result:{error:Fa},stack:e.stack})}if(o.ageMin||o.ageMax){let t=new Date(o.ageMinDate).getTime(),i=new Date(o.ageMaxDate).getTime();if(r<t||r>i)return Qs({result:{error:Fa},stack:e.stack})}}}return{..._r}}({...e,...o,enteredParticipants:a,stack:n});if(p.error)return p;let m=function(e){let{tournamentRecord:t,eventUpdates:i,event:r,stack:n}=e;if(i.startDate||i.endDate){let e=lR({startDate:i.startDate,endDate:i.endDate,tournamentRecord:t,event:r});if(e.error)return Qs({result:e,stack:n})}return{..._r}}({...e,stack:n});return m.error?m:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{..._r})}function DR({qualifyingPositions:e,drawEntries:t=[],drawName:i,drawId:r,event:n,stage:a}){let o="addFlight";if(!n)return Qs({result:{error:Fn},stack:o});if(!i)return Qs({result:{error:va},stack:o});if(t?.length){let e=(n.entries??[]).map(Om),i=t.map(Om);if(yr(i,e).length!==i.length)return Qs({result:{error:Ho},stack:o})}let s=XI({event:n})?.flightProfile,c=s?.flights?.map((({flightNumber:e})=>!isNaN(e)&&zi(e)))?.filter(Boolean)||[],d=Math.max(0,...c)+1,u={drawId:r||Ud(),flightNumber:d,drawEntries:t,drawName:i};if(a&&(u.stage=a),e&&(u.qualifyingPositions=e),(s?.flights||[]).find((({drawId:e})=>e===u.drawId)))return Qs({result:{error:es},stack:o});let l=(s?.flights||[]).concat(u);return Gp({event:n,extension:{name:sm,value:{...s||{},flights:l}}})}var PR={};Oi(PR,{drawMatic:()=>dN,garman:()=>$R,generateAdHocMatchUps:()=>tD,generateAdHocRounds:()=>sN,generateAndPopulatePlayoffStructures:()=>ww,generateCourts:()=>jR,generateDrawDefinition:()=>PM,generateDrawMaticRound:()=>lD,generateDrawStructuresAndLinks:()=>GT,generateDrawTypeAndModifyDrawDefinition:()=>WT,generateFlightProfile:()=>RR,generateLineUps:()=>VR,generateQualifyingStructure:()=>ub,generateSeedingScaleItems:()=>NM,generateStatCrew:()=>kR,generateVoluntaryConsolation:()=>pD,roundRobinGroups:()=>Zv});var NR="splitWaterfall",ER="splitShuttle",MR={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:NR,SPLIT_SHUTTLE:ER};function RR(e){let{drawNameRoot:t="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:c=[],flightsCount:d,splitMethod:u,uuids:l=[],event:p,stage:m}=e;if(!p)return{error:Fn};let f=p.entries??[],{flightProfile:h}=XI({event:p});if(h&&i&&!o)return{error:ts};let g=e.scaledEntries??lN({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,I=g.map(Om),y=sr(f.filter((({participantId:e})=>!I.includes(e))).filter((e=>(!m||!e.entryStage||e.entryStage===m)&&(!e.entryStatus||lg.includes(e.entryStatus))))),v=g.concat(...y),S=v.length,U=wr(v,Math.ceil(S/d));function b(e){return(e||[]).map((({participantId:e,scaleValue:t})=>{let i=f.find((t=>t.participantId===e));return i?.scaleValue&&t&&(i.scaleValue=t),i})).sort(((e,t)=>e.scaleValue-t.scaleValue)).map(((e,t)=>(e.scaleValue&&(e.seedNumber=t+1),e)))}u===NR?U=Nr(v,d):u===ER&&(U=Nr(v,d,!0));let w={scaleAttributes:n,splitMethod:u,flights:gr(0,d).map((e=>{let i=e+1;return{flightNumber:i,drawId:l?.pop()??Ud(),drawEntries:b(U[e]),drawName:c?.length&&c[e]||`${t} ${i}`}}))};if(i){let e=vR({flightProfile:w,deleteExisting:o,event:p});return{splitEntries:vs()&&U||void 0,...e}}return{flightProfile:w,..._r}}function CR({json:e,tagName:t}){let i=Object.keys(e).filter((t=>Array.isArray(e[t]))).map((t=>({key:t,value:e[t].filter((e=>"object"==typeof e&&1===Object.keys(e).length))}))),r=Object.keys(e).filter((t=>"object"==typeof e[t]&&!Array.isArray(e[t]))).map((t=>({key:t,value:e[t]})));return AR({tagName:t,attributes:Object.keys(e).filter((t=>["string","number"].includes(typeof e[t]))).map((t=>({key:t,value:e[t]}))),childArrays:i,childObjects:r})}function AR(e){let{tagName:t,attributes:i=[],childArrays:r=[],childObjects:n}=e,a="\r\n",o=e=>{let t=Object.keys(e)[0];return{key:t,value:e[t]}},s=r?.map((({key:e,value:t})=>AR({tagName:e,childObjects:t.map(o)}))).join("\r\n"),c=n?.map((({key:e,value:t})=>CR({tagName:e,json:t??[]}))).join("\r\n"),d=i?.map((({key:e,value:t})=>`${e}="${t}"`)).join(" ");return"childArray"===t?c:`<${t}${d?` ${d}`:""}>${c?.length?`${a}${c}${a}`:""}${s?.length?`${a}${s}${a}`:""}</${t}>`}function kR(e){let t=dp(e,[{[Tl]:!0}]);if(t.error)return t;let{tournamentRecord:i}=e,{startDate:r,tournamentId:n,tournamentName:a}=i,{participantMap:o,matchUps:s,mappedMatchUps:c}=mv({withMatchUps:!0,withEvents:!0,tournamentRecord:i}),d=i.participants.filter((e=>e.participantType===hh)),u=s?.filter((e=>e.matchUpType===hh))??[],l=u?.reduce(((e,t)=>{let i=t?.tieMatchUps??[];return i&&[...e,...i]}),[])??[],p=s?.filter((e=>e.matchUpType===Bi))??[],m=s?.filter((e=>e.matchUpType===ji))??[],f=l.length===p.length+m.length,h=1===u.length&&f,g={mappedMatchUps:c,participantMap:o,tournamentName:a,tournamentId:n,tournament:f?"N":"Y",startDate:r},I=[],y=[];if(h){let e=u[0],{json:t,xml:i}=OR({teamParticipants:d,teamMatchUp:e,...g,doubles:m,singles:p});y.push(t),I.push(i)}else for(let v of u){let e=v?.sides?.map((({participant:e})=>e?.participantId)).filter(Boolean);if(2!==e?.length)continue;let t=e.map((e=>e&&o?.[e]?.participant)),{xml:i,json:r}=OR({doubles:v.tieMatchUps?.filter((e=>e.matchUpType===ji)),singles:v.tieMatchUps?.filter((e=>e.matchUpType===Bi)),teamParticipants:t,teamMatchUp:v,...g});y.push(r),I.push(i)}return{json:y,xml:I,..._r}}function OR({teamParticipants:e,mappedMatchUps:t,participantMap:i,tournamentName:r,tournamentId:n,teamMatchUp:a,tournament:o,startDate:s,doubles:c,singles:d}){let u=e?.find((e=>e.participantRoleResponsibilities?.includes("Home"))),l=e?.filter((e=>e.participantId!==u?.participantId)),p=_c(s,"/","MDY"),m=u?.participantName||l?.[1]?.participantName,f=u?.participantId||l?.[1]?.participantId,h=l?.[0]?.participantName,g=l?.[0]?.participantId,I={},y=e.map((e=>({team:{...FR({teamParticipant:e,teamMatchUp:a,uniValues:I,participantMap:i,mappedMatchUps:t,homeid:f})}}))),v=Js({venue:{tournamentname:o?r:void 0,neutralgame:u?"N":"Y",gameid:n,officials:{},tournament:o,rules:{},homename:m,visname:h,homeid:f,visid:g,date:p},childArray:y,singles_matches:d?.map((e=>LR({matchUp:e,homeid:f,uniValues:I}))),doubles_matches:c?.map((e=>LR({matchUp:e,homeid:f,uniValues:I})))});return{json:v,xml:CR({json:v,tagName:"tngame"})}}function xR({homeid:e,uniValues:t,participant:i}){if(!i)return{};let r=2===i.individualParticipants?.length,n=r?ar(i.individualParticipants?.map((e=>e.teams?.[0]?.participantId))):[],a=r?ar(i.individualParticipants?.map((e=>e.teams?.[0]?.teamId))):[],o=!r&&i.teams?.[0]?.participantId||1===n?.length&&n[0]||void 0,s=!r&&i.teams?.[0]?.teamId||1===a?.length&&a[0]||o,c=r?void 0:i.participantName,d=i.individualParticipants?.[0]?.participantName,u=i.individualParticipants?.[1]?.participantName;return Js({vh:e&&(o===e?"H":"V")||"",uni:r?void 0:t[o][i.participantId],uni_1:t[o][i.individualParticipants?.[0]?.participantId],uni_2:t[o][i.individualParticipants?.[1]?.participantId],team:s,name:c,name_1:d,name_2:u})}function FR({teamParticipant:e,teamMatchUp:t,participantMap:i,mappedMatchUps:r,homeid:n,uniValues:a}){let{participantId:o,participantName:s}=e,c=n&&(o===n?"H":"V")||"",d=i?.[o]?.matchUps,u=d&&Object.keys(d),l=t?.sides?.find((({participant:e})=>e.participantId===o))?.sideNumber,p=t?.score?.sets?.[0]?.[`side${l}Score`]??0;a[o]={};let m={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},f=[],h=[],g=0;for(let S of u??[]){let e=r?.[S],t=e.sides.find((({participant:e})=>e.participantId===o))?.sideNumber;g+=e.score?.sets?.[0]?.[`side${t}Score`]??0;for(let i of e.tieMatchUps??[]){let{matchUpType:e,winningSide:r}=i,n=r&&(r===t?"w":"l")||"";n&&(m[e][n]+=1);let a="w"===n?"1":"0",o="l"===n?"1":"0";if(e===Bi){let e=h.length+1;h.push({singles_pair:{pair:e,won:a,lost:o,tied:"0"}})}else if(e===ji){let e=f.length+1;f.push({doubles_pair:{pair:e,won:a,lost:o,tied:"0"}})}}}let I=[{singles:{childArray:h,won:m.SINGLES.w,lost:m.SINGLES.l}},{doubles:{childArray:f,won:m.DOUBLES.w,lost:m.DOUBLES.l}}],y=[],v=1;for(let S of e.individualParticipantIds){let e=i?.[S];if(e){let{participant:t,counters:i}=e,r={won:i?.DOUBLES?.wins||0,lost:i?.DOUBLES?.losses||0},n={won:i?.SINGLES?.wins||0,lost:i?.SINGLES?.losses||0},{participantName:s,participantId:c}=t;a[o][c]=v,y.push({player:{name:s,uni:v,singles:n,doubles:r}})}v+=1}return{vh:c,id:o,name:s,score:p||g,totals:I,childArray:y}}function LR({matchUp:e,homeid:t,uniValues:i}){let{collectionPosition:r,orderOfFinish:n,matchUpType:a,sides:o}=e??{},s=o?.map((r=>{let{sideNumber:n,participant:o}=r,s=function({sets:e,sideNumber:t}){return Object.assign({},...e?.map((e=>{let{setNumber:i,side1Score:r,side2Score:n,side1TiebreakScore:a,side2TiebreakScore:o}=e;return{[`set_${i}`]:1===t?r:n,[`tie_${i}`]:1===t?a:o}}))??[])}({sets:e.score?.sets,sideNumber:n});return{[a===Bi?"singles_score":"doubles_score"]:{...xR({homeid:t,uniValues:i,participant:o}),...s}}}));return{[a===Bi?"singles_match":"doubles_match"]:{match:r,order:n,childArray:s}}}var _R="DESC",BR={ASC:"ASC",ASCENDING:"ASC",DESC:"DESC",DESCENDING:_R};function VR(e){let{tieFormat:t}=e,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:o,attach:s,event:c}=e;if(c?.eventType!==Iu)return{error:xn};if(!r)return{error:zr};if(!t&&!n)return{error:Zr};if(t=t??Ug({drawDefinition:n,event:c})?.tieFormat,md({tieFormat:t}).error)return{error:Qn};if("object"!=typeof a&&!i)return{error:Ho,context:{scaleAccessor:a}};let d={},u=(n?.entries??c?.entries??[]).filter((e=>e?.entryStatus===Qh)).map(Om),{participants:l=[]}=mv({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=l.filter((({participantId:e})=>u.includes(e))),m=c?.category?.categoryName??c?.category?.ageCategoryCode,{scaleName:f=m,scaleType:h=pp,sortOrder:g,accessor:I}=a||{},y=h===pp?"rankings":"ratings",v=(e,t)=>{let r=e[y]?.[t];if(!r&&i&&(r=e[y]?.[_i]),Array.isArray(r)){let e=r.find((e=>e.scaleName===f))?.scaleValue;if(Qi(e))return e;if(I&&"object"==typeof e)return e[I]}return 0},S=(e,t,i)=>{let r=g===_R?e:t;return v(g===_R?t:e,i)-v(r,i)},U=(e,t)=>S(e,t,_i),b=(e,t)=>S(e,t,Vi),w=[],T=t?.collectionDefinitions??[];for(let P of p){let e=P.individualParticipants?.sort(U)??[],t=o?e:P.individualParticipants?.sort(b)??[],i={};for(let n of T){let r=[],{collectionId:a,matchUpCount:o,matchUpType:s,gender:c}=n,d=yI(_i)(s);gr(0,o).forEach((n=>{let o=d?e:t??[],s=n+1,u=[];gr(0,d?1:2).forEach((e=>{let t=o?.find((t=>{let i=cc(c),n=i&&(dc(c)&&i||oc(c)&&[ic,Zs][e]);return!(n&&n!==t.person?.sex||r.includes(t.participantId))}))?.participantId;t&&(u.push(t),r.push(t),i[t]||(i[t]=[]),i[t].push({collectionPosition:s,collectionId:a}))})),d||w.push(u)}))}let r=Object.keys(i).map((e=>({collectionAssignments:i[e],participantId:e})));d[P.participantId]=r}let D=[];for(let P of w){let{participant:e}=ey({tournamentParticipants:l,participantIds:P});if(!e){let e={individualParticipantIds:P,participantRole:Nv,participantType:fh};D.push(e)}}if(s){for(;D.length;)LM({participant:D.pop(),tournamentRecord:r});Vp({element:n,extension:{name:dm,value:d}})}return{..._r,lineUps:d,participantsToAdd:D}}function jR(e){if(!e)return{error:va};let t=dp(e,[{dates:!1,[ep]:e=>Array.isArray(e)&&e.every(Fc)},{uuids:!1,[ep]:e=>Array.isArray(e)&&e.every(Mr)},{startTime:!1,endTime:!1,[ep]:Wc},{idPrefix:!1,namePrefix:!1,[ep]:Mr},{count:!0,[ep]:Qi}]);if(t.error)return t;let{startDate:i,endDate:r}=e.tournamentRecord??{},n=e.dates||i&&r&&jc(i,r)||[],a=gr(1,e.count+1).map((t=>Js({courtId:e.uuids?.pop()??(e.idPrefix&&`${e.idPrefix}-${t}`)??Ud(),courtName:e.courtNames?.pop()??(e.namePrefix&&`${e.namePrefix} ${t}`),dateAvailability:n.map((t=>({startTime:e.startTime??"08:00",endTime:e.endTime??"20:00",date:t})))})));return{..._r,courts:a}}var $R={};function GR(e){let t=dp(e,[{courtDate:!0,_ofType:Ql}]);if(t.error)return t;let{includeBookingTypes:i=[],courtDate:r}=e,n=[],a=ed(r.startTime);(r.bookings||[]).filter((e=>!e.bookingType||!i.includes(e.bookingType))).sort(((e,t)=>(Hc(e.startTime)||"").localeCompare(Hc(t.startTime)||""))).forEach((e=>{let t={startTime:zc(a.toISOString()),endTime:e.startTime};ed(e.startTime)>a&&n.push(t),ed(e.endTime)>a&&(a=ed(e.endTime))}));let o={startTime:zc(a.toISOString()),endTime:r.endTime};return ed(r.endTime)>a&&n.push(o),{timeSlots:n}}function WR(e){let t=dp(e,[{periodStart:!0,date:!0},{courts:!0,_ofType:Zl}]);if(t.error)return t;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=e,o=e.courts,s=ed(n),c=rd(s,i),{enoughTime:d}=function({averageMatchUpMinutes:e,includeBookingTypes:t,periodStartTime:i,periodEndTime:r}){function n(t){let n=ed(t.startTime),a=ed(t.endTime);return!(n>i||a<r)&&td(i,a)>=e}return{enoughTime:e=>{let{timeSlots:i}=GR({includeBookingTypes:t,courtDate:e});return!!i?.filter(n)?.length}}}({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:c});return{availableToScheduleCount:(o?.filter((e=>{if(!Array.isArray(e.dateAvailability))return!1;let t=AE({date:a,court:e});return!(!t||!d(t))}))||[]).length,..._r}}function qR(e){let{remainingScheduleTimes:t=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=e,{bookings:o=[]}=e;if(!Array.isArray(a)||!a.length)return{error:Ho,courts:a};if(!Array.isArray(o))return{error:wa};if(!Fc(n))return{error:Pa};i&&(Array.isArray(i)?i.includes(n)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:c}=o.reduce(((e,t)=>{let{courtId:i}=t;return i?e.courtBookings[i]?e.courtBookings[i].push(t):e.courtBookings[i]=[t]:e.unassignedBookings.push(t),e}),{courtBookings:{},unassignedBookings:[]}),d=a.map(((e,i)=>{let{courtId:r,courtName:a}=e,o=s[r]||[],c=AE({date:n,court:e})||{},{bookings:d=[],startTime:u,endTime:l,date:p}=c;return{courtId:r,courtName:a,dateAvailability:{bookings:[t[i]&&{startTime:u,endTime:t[i]},...yd(d,!1,!0),...o].filter(Boolean),startTime:u,endTime:l,date:p}}}));c.sort(((e,t)=>qc(e.startTime)-qc(t.startTime)));let u=[];for(let l of c){let{startTime:e,endTime:t,averageMinutes:i,recoveryMinutes:n,matchUpId:a}=l,o=qc(e),s=qc(t),c=d.flatMap((e=>{let t=e.dateAvailability,{timeSlots:i=[]}=GR({courtDate:t});return{courtName:e.courtName,courtId:e.courtId,timeSlots:i}})).reduce(((e,{courtId:t,courtName:i,timeSlots:n})=>{let a;return n.find((({startTime:t,endTime:i})=>{a=qc(t)-o;let n=o>=qc(t);return s<=qc(i)&&0!==e.startDifference&&((0===a||a+r>=0)&&(void 0===e.startDifference||a<e.startDifference)||n)}))?{courtName:i,courtId:t,startDifference:a}:e}),{});if(c.courtId){let r={averageMinutes:i,recoveryMinutes:n,matchUpId:a,startTime:e,endTime:t};u.push(r),d.find((({courtId:e})=>e===c.courtId))?.dateAvailability.bookings.push(r)}else console.log({unassignedBooking:l})}return{virtualCourts:d.map((({courtId:e,courtName:t,dateAvailability:i})=>({dateAvailability:[i],courtName:t,courtId:e}))),assignedBookings:u}}function HR({averageMatchUpMinutes:e,periodLength:t=30,recoveryMinutes:i}){let r=(e||90)+(i||0);return t>r?r:t||30}function zR(e){let{startTime:t="8:00",endTime:i="20:30",count:r=10,date:n}=e??{};return gr(0,r).map((()=>({dateAvailability:[{date:n,startTime:t,endTime:i}]})))}function YR({scheduleDate:e,startTime:t,endTime:i,courts:r}){let n=(t?"startTime":i&&"endTime")||void 0;return r.reduce(((r,a)=>{let o=AE({date:e,court:a}),s=n&&(o?.[n]||a[n]);return s&&(!r||t&&qc(s)<qc(r)||i&&qc(s)>qc(r))?s:r}),void 0)}function KR(e){let t=dp(e,[{courts:!0,_ofType:Zl}]);if(t.error)return t;let{date:i=Lc(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=e,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:c,averageMatchUpMinutes:d,clearScheduleDates:u,courtsCount:l,bookings:p}=e;a=a||HR({averageMatchUpMinutes:d}),i=Yc(i),r=zc(r),n=zc(n);let m=0,f=0,h=0,g=0,I=0;!o&&l&&(o=zR({startTime:r,endTime:n,count:l,date:i}));let{virtualCourts:y}=qR({remainingScheduleTimes:c,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:v}=function({averageMinutes:e,startTime:t,endTime:i,courts:r,date:n}){let a;if(t=t||YR({courts:r,scheduleDate:n,startTime:!0}),i=i||YR({courts:r,scheduleDate:n,endTime:!0}),t&&i){let o=ed(t),s=ed(i);for(let t of r||[]){if(!Array.isArray(t.dateAvailability))continue;let i=AE({court:t,date:n}),{timeSlots:r}=GR({courtDate:i});r?.forEach((t=>{let i=ed(t.startTime),r=ed(t.endTime);if(i>s||i<o||r<o)return!1;if(td(i,r)>=e){let e=zc(i.toISOString());e&&(!a||e<a)&&(a=e)}}))}}return{firstTimeSlotStartTime:a}}({averageMinutes:d,courts:y,startTime:r,endTime:n,date:i});s&&v&&(r=v??r);let S=qc(r),U=qc(n)-S,b=gr(0,Math.floor(U/a)+1).map((e=>{let t=function(e){let t=Math.floor(e/60),i=e-60*t;return t>23&&(t%=24),[nd(t),nd(i)].join(":")}(S+e*a),r=WR({courts:y??[],averageMatchUpMinutes:d,periodStart:t,date:i});if(r.error)return{error:r.error};let{availableToScheduleCount:n=0}=r,o=n>f?n-f:0;I+=e?n:0;let s=e?I/e:n,c=e?a*s/d*(e-1)+s:s,u=n?f&&c-m||o:0;m=c,f=n,h+=u;let l=zi(h)-g;return g+=l,{periodStart:t,add:l,availableToScheduleCount:n,newCourts:o,totalMatchUps:g}}));return{scheduleTimes:b.reduce(((e,t)=>{let i=gr(0,t.add).map((()=>({scheduleTime:t.periodStart})));return e.concat(...i)}),[]).flat(),timingProfile:b,totalMatchUps:g}}Oi($R,{default:()=>JR,garman:()=>XR});var XR={getCourtsAvailableAtPeriodStart:WR,generateTimeSlots:GR,getScheduleTimes:KR,courtGenerator:zR},JR=XR,QR={};Oi(QR,{isValid:()=>Ec,isValidMatchUpFormat:()=>Ec,parse:()=>Uc,stringify:()=>gc});var ZR={};Oi(ZR,{allCompetitionMatchUps:()=>Sy,allDrawMatchUps:()=>by,allEventMatchUps:()=>yy,allTournamentMatchUps:()=>vy,analyzeMatchUp:()=>hM,applyLineUps:()=>pA,assignMatchUpSideParticipant:()=>tC,assignTieMatchUpParticipantId:()=>lC,bulkMatchUpStatusUpdate:()=>aA,calculateWinCriteria:()=>aM,checkInParticipant:()=>nC,checkMatchUpIsComplete:()=>sy,checkOutParticipant:()=>rC,competitionScheduleMatchUps:()=>eM,disableTieAutoCalc:()=>ZC,drawMatchUps:()=>gM,enableTieAutoCalc:()=>XC,eventMatchUps:()=>JE,filterMatchUps:()=>ay,findMatchUp:()=>tE,getAllDrawMatchUps:()=>gy,getAllStructureMatchUps:()=>oy,getCheckedInParticipantIds:()=>II,getCompetitionMatchUps:()=>ZE,getEventMatchUpFormatTiming:()=>qE,getHomeParticipantId:()=>oM,getMatchUpCompetitiveProfile:()=>Vg,getMatchUpContextIds:()=>sM,getMatchUpDailyLimits:()=>tM,getMatchUpDailyLimitsUpdate:()=>zE,getMatchUpDependencies:()=>Ey,getMatchUpFormat:()=>uM,getMatchUpFormatTiming:()=>OI,getMatchUpFormatTimingUpdate:()=>BE,getMatchUpScheduleDetails:()=>QI,getMatchUpType:()=>iy,getMatchUpsStats:()=>lM,getModifiedMatchUpFormatTiming:()=>HE,getParticipantResults:()=>Gb,getPredictiveAccuracy:()=>iM,getRoundMatchUps:()=>Ng,getRounds:()=>fM,isValidMatchUpFormat:()=>Ec,matchUpActions:()=>PT,mutate:()=>eC,participantScheduledMatchUps:()=>KE,query:()=>LE,removeDelegatedOutcome:()=>JC,removeMatchUpSideParticipant:()=>fC,removeTieMatchUpParticipantId:()=>mC,replaceTieMatchUpParticipantId:()=>sC,resetAdHocMatchUps:()=>uA,resetMatchUpLineUps:()=>tA,resetScorecard:()=>dA,resetTieFormat:()=>cA,setDelegatedOutcome:()=>sA,setMatchUpFormat:()=>eA,setMatchUpState:()=>YC,setMatchUpStatus:()=>nA,setOrderOfFinish:()=>lA,substituteParticipant:()=>QC,tallyParticipantResults:()=>nw,toggleParticipantCheckInState:()=>aC,tournamentMatchUps:()=>QE,updateTieMatchUpScore:()=>Uw,validMatchUp:()=>Dg,validMatchUps:()=>Pg});var eC={};function tC({tournamentRecord:e,drawDefinition:t,participantId:i,sideNumber:r,matchUpId:n,event:a}){if(i&&"string"!=typeof i)return{error:Ba};if(!t)return{error:Jr};if(!n)return{error:ra};let o=void 0===r;if(o&&(r=1),![1,2].includes(r))return Qs({result:{error:Ho,context:{sideNumber:r}}});let{matchUp:s,structure:c}=cw({drawDefinition:t,matchUpId:n,event:a});if(!s)return{error:aa};if(c?.structures||t.drawType&&t.drawType!==Wu||c?.matchUps?.find((({roundPosition:e})=>!!e)))return{error:mn};if(!i&&(s?.score?.scoreStringSide1||af.includes(s?.matchUpstatus)||s?.matchUpStatus&&[qm,Wm].includes(s.matchUpStatus)))return{error:xa,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map((e=>{let t=s.sides?.find((t=>t.sideNumber===e))??{sideNumber:e};return r===e?{...t,participantId:i}:t})),o)for(let e of s.sides)e.sideNumber&&(e.sideNumber=3-e.sideNumber);Jf({tournamentId:e?.tournamentId,context:"assignSideParticipant",drawDefinition:t,matchUp:s})}return{..._r,sidesSwapped:o}}function iC({removePriorValues:e,tournamentRecord:t,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:c}=cw({drawDefinition:r,event:s,matchUpId:a});if(!c)return{error:aa};let d=Dw({removePriorValues:e,element:c,duplicateValues:i,timeItem:o});return n||Jf({tournamentId:t?.tournamentId,eventId:s?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:c}),d}function rC(e){let t=dp(e,[{[Tl]:!0},{[Pl]:!0},{[Ml]:!0},{[Ll]:!0}]);if(t.error)return t;let i=cM(e,[{[Xl]:Hl,attr:{[Bl]:!0}}]);if(i.error)return i;let{tournamentRecord:r,drawDefinition:n,participantId:a,matchUpId:o}=e,s=i?.matchUp?.matchUp,{matchUpStatus:c,score:d}=s??{};if(c&&of.includes(c)||c&&af.includes(c)||My({score:d}))return{error:bn};let u=II({matchUp:s});if(u?.error)return u;let{checkedInParticipantIds:l,allRelevantParticipantIds:p}=u??{};if(!p?.includes(a))return{error:Ba};if(!l?.includes(a))return{error:Za};let m=jg({matchUp:s});if(m?.error)return m;let{sideParticipantIds:f,nestedIndividualParticipantIds:h}=m??{},g=f?.indexOf(a);return void 0!==g&&[0,1].includes(g)&&(h?.[g]??[]).forEach((e=>{iC({drawDefinition:n,matchUpId:o,timeItem:{itemType:Gg,itemValue:e}})})),iC({tournamentRecord:r,drawDefinition:n,matchUpId:o,timeItem:{itemValue:a,itemType:Gg}}),{..._r,checkedOut:!0}}function nC(e){let t=dp(e,[{[Tl]:!0},{[Pl]:!0},{[Ml]:!0},{[Ll]:!0}]);if(t[Yl])return t;let i=cM(e,[{[Xl]:Hl,attr:{[Bl]:!0}}]);if(i[Yl])return i;let{tournamentRecord:r,drawDefinition:n,participantId:a,matchUpId:o}=e,s=II({matchUp:i?.matchUp?.matchUp});if(s?.error)return s;let{checkedInParticipantIds:c,allRelevantParticipantIds:d}=s??{};if(!d?.includes(a))return{[Yl]:Ba};let u={..._r,checkedIn:!0};return c?.includes(a)||iC({tournamentRecord:r,drawDefinition:n,matchUpId:o,timeItem:{itemValue:a,itemType:$g}}),u}function aC(e){let t=dp(e,[{[Ml]:!0,[Pl]:!0,[Ll]:!0}]);if(t.error)return t;let i=e.tournamentId??e.activeTournamentId,r=e.tournamentRecord??(i&&e.tournamentRecords?.[i]);if(!r)return{error:zr};let n=cM(e,[{[Xl]:Hl,attr:{[Bl]:!0},[Yl]:aa}]).matchUp?.matchUp;if(!n)return{error:aa};let{checkedInParticipantIds:a=[]}=II({matchUp:n}),{participantId:o,matchUpId:s,drawDefinition:c}=e;return o&&a.includes(o)?rC({tournamentRecord:r,drawDefinition:c,participantId:o,matchUpId:s,matchUp:n}):nC({tournamentRecord:r,drawDefinition:c,participantId:o,matchUpId:s,matchUp:n})}function oC({tournamentRecord:e,drawDefinition:t,tieMatchUpId:i,event:r}){if(!e)return{error:zr};if(!t)return{error:In};if(!r)return{error:Ln};let n=bg({drawDefinition:t}),{matchUp:a}=cw({matchUpId:i,drawDefinition:t,matchUpsMap:n});if(!a)return{error:aa};let{matchUp:o,structure:s}=cw({tournamentParticipants:e.participants,matchUpId:i,inContext:!0,drawDefinition:t,matchUpsMap:n,event:r});if(!o)return{error:aa};let{collectionPosition:c,drawPositions:d,collectionId:u,matchUpTieId:l,matchUpType:p}=o;if(p&&!Lr([Bi,ji],p))return{error:ca};let{positionAssignments:m}=ff({structure:s}),f=m?.filter((e=>d?.includes(e.drawPosition))),{matchUp:h}=cw({matchUpId:l,drawDefinition:t,matchUpsMap:n}),g=[...h?.sides?.map(Om)??[],...f?.map(Om)??[]],{participants:I}=mv({tournamentRecord:e,participantFilters:{participantTypes:[hh],participantIds:g}}),{matchUp:y}=cw({matchUpId:l,inContext:!0,drawDefinition:t,matchUpsMap:n}),v=Ug({matchUp:h,drawDefinition:t,structure:s,event:r})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:o,relevantAssignments:f,collectionPosition:c,teamParticipants:I,collectionId:u,matchUpType:p,dualMatchUp:h,tieMatchUp:a,tieFormat:v,structure:s,..._r}}function sC(e){let t=oC(e);if(t.error)return t;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:o,substitution:s,event:c}=e;if(!r||!a)return Qs({result:{error:Ha},stack:i});if(r===a)return{..._r};let{inContextDualMatchUp:d,inContextTieMatchUp:u,collectionPosition:l,collectionId:p,dualMatchUp:m,tieMatchUp:f,tieFormat:h}=t,g=u?.matchUpType,I=u?.sides?.find((e=>e.participant?.participantId===r||e.participant?.individualParticipantIds?.includes(r)));if(!I)return{error:Ya};let y=mv({tournamentRecord:n,participantFilters:{participantIds:[r,a]}})?.participants??[];if(2!==y.length)return Qs({result:{error:Ha},stack:i});if(y[0].participantType!==y[1].participantType)return Qs({result:{error:$a},stack:i});let{appliedPolicies:v}=Fh({tournamentRecord:n,drawDefinition:o,event:c}),S=e.policyDefinitions?.[wp]??v?.[wp]??Tv[wp],U=y.find((({participantId:e})=>e===a));if(!1!==(e.enforceGender??S?.participants?.enforceGender)&&dc(u?.gender)&&cc(u?.gender)!==cc(U?.person?.sex))return{error:_a,info:"Gender mismatch"};let b=S?.processCodes?.substitution;Iw({tournamentId:n.tournamentId,eventId:c.eventId,inContextDualMatchUp:d,drawDefinition:o,dualMatchUp:m});let w=m?.sides?.find((({sideNumber:e})=>e===I.sideNumber));if(!w)return Qs({result:{sideNumber:I.sideNumber,existingParticipantId:r,error:Qo},stack:i});if(u?.sides?.flatMap((e=>e.participant?.individualParticipantIds||e.participant?.participantId||[]))?.includes(a))return Qs({result:{error:io},stack:i});let T=d?.sides?.find((({sideNumber:e})=>e===I.sideNumber))?.participantId,D=w.lineUp,P=D?.find((({participantId:e})=>a===e)),N=D?.reduce(((e,t)=>t.substitutionOrder>e?t.substitutionOrder:e),0),E=D?.map((e=>{let t=yd(e,!1,!0);if(![r,a].includes(t.participantId))return t;if(!s&&[r,a].includes(t.participantId)&&(t.collectionAssignments=t.collectionAssignments?.filter((e=>!(e.collectionPosition===l&&e.collectionId===p)))),s&&r===t.participantId&&(t.collectionAssignments=t.collectionAssignments.map((e=>e.collectionPosition===l&&e.collectionId===p&&void 0===e.substitutionOrder?{...e,substitutionOrder:N}:e))),t.participantId===a){t.collectionAssignments||(t.collectionAssignments=[]);let e={collectionId:p,collectionPosition:l};s&&(e.previousParticipantId=r,e.substitutionOrder=(N??0)+1),t.collectionAssignments.push(e)}return t}))??[];if(!P){let e={collectionId:p,collectionPosition:l};s&&(e.substitutionOrder=(N??0)+1,e.previousParticipantId=r);let t={collectionAssignments:[e],participantId:a};E.push(t)}let M,R,C=g===ji,{assignedParticipantIds:A}=ZI({lineUp:D,collectionPosition:l,collectionId:p}),{assignedParticipantIds:k}=ZI({lineUp:E,collectionPosition:l,collectionId:p});if(w.lineUp=E,T&&h){let e=bS({participantId:T,lineUp:E,drawDefinition:o,tieFormat:h});if(e.error)return Qs({result:e,stack:i})}else console.log("team participantId not found");if(C){let{tournamentRecord:t}=e,r=ey({participantIds:k,tournamentRecord:t});if(!r.participant){let e=LM({returnParticipant:!0,pairOverride:!0,tournamentRecord:t,participant:{participantRole:Nv,individualParticipantIds:k,participantType:fh}});if(e.error)return Qs({result:e,stack:i});M=e.participant?.participantId}r=ey({participantIds:A,tournamentRecord:t});let n=r.participant?.participantId;n&&Lv({participantIds:[n],tournamentRecord:t}).success&&(R=n)}if(s||1===I.substitutions?.length){if(s)b&&f&&(f.processCodes=ar([...f?.processCodes??[],...b]));else for(let e of b||[]){let t=f?.processCodes?.lastIndexOf(e);void 0!==t&&f?.processCodes?.splice(t,1)}f&&Jf({tournamentId:n?.tournamentId,matchUp:f,context:i,drawDefinition:o})}return m&&Jf({tournamentId:n?.tournamentId,matchUp:m,context:i,drawDefinition:o}),{..._r,modifiedLineUp:E,participantRemoved:R,participantAdded:M}}function cC({collectionPosition:e,teamParticipantId:t,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){if(!a||!e||!Array.isArray(n))return{modifiedLineUp:i?.lineUp||[],error:Ho};let o=i?.lineUp||ty({participantId:t,drawDefinition:r})?.lineUp,s=[],c=[];return{modifiedLineUp:o?.map((t=>{if(!n.includes(t.participantId))return t;let i=t.collectionAssignments?.filter((i=>{let r=i.collectionId===a&&i.collectionPosition===e;return r&&(i.previousParticipantId&&s.push(i.previousParticipantId),c.push({participantId:t.participantId,...i})),!r}));return{participantId:t.participantId,collectionAssignments:i}})).filter(Boolean)||[],assignmentsRemoved:c,previousParticipantIds:s}}function dC({individualParticipantIds:e,groupingParticipantId:t,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return Qs({result:{error:zr},stack:n});if(!t||!e)return Qs({result:{error:va},stack:n});let a=r.participants??[],o=a.find((e=>e.participantId===t));if(!o)return Qs({result:{error:Ya},stack:n});if(o?.participantType&&![hh,mh].includes(o.participantType))return Qs({context:{participantType:o.participantType},result:{error:$a},stack:n});let s=e.filter((e=>a.find((t=>t.participantId===e))?.participantType!==ph));if(s.length)return Qs({result:{error:Va,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let c=o.individualParticipantIds,d=e.filter((e=>!c.includes(e)));d.length&&(i&&Fv({individualParticipantIds:d,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...d));let{topics:u}=Ls();if(u.includes(Af)){let e=a.find((({participantId:e})=>e===t));As({topic:Af,payload:{participants:[e]}})}return function({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}){let r=(i.events||[]).filter((e=>e?.eventType===gu&&e?.entries?.some((e=>e.participantId===t)))),n=t=>!e.includes(t.participantId);for(let a of r){a.entries=(a.entries||[]).filter(n);let{flightProfile:e}=XI({event:a});e?.flights?.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter(n)})),a?.drawDefinitions?.forEach((e=>{e.entries=(e.entries||[]).filter(n)}))}}({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:r}),{groupingParticipant:yd(o,!1,!0),added:d.length,..._r}}function uC(e){let{updateParticipantName:t=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=e;if(!n)return{error:zr};if(!o)return{error:Wa};if(!o.participantId)return LM({tournamentRecord:n,participant:o});let{participant:s}=bh({participantId:o.participantId,tournamentRecord:n});if(!s)return LM({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:c,individualParticipantIds:d,participantOtherName:u,participantName:l,participantRole:p,participantType:m,onlineResources:f,contacts:h,person:g}=o;if(m&&s.participantType!==m)return{error:Oa};let I={};if(h&&(I.contacts=h),f&&(I.onlineResources=f),u&&Mr(u)&&(I.participantOtherName=u),l&&Mr(l)&&(I.participantName=l),Array.isArray(d)){let{participants:e}=mv({participantFilters:{participantTypes:[ph]},tournamentRecord:n}),i=e?.map(Om);if(i){let r=d.filter((e=>Mr(e)&&i.includes(e)));([mh,Gi].includes(m||s.participantType)||m===fh&&(2===r.length||a))&&(I.individualParticipantIds=r),s.participantType===gh.PAIR&&t&&(I.participantName=function({individualParticipants:e,newValues:t}){let i=t.individualParticipantIds,r=e.filter((({participantId:e})=>i.includes(e))).map((({person:e})=>e?.standardFamilyName)).filter(Boolean).sort().join("/");return 1===i.length&&(r+="/Unknown"),r}({individualParticipants:e,newValues:I}))}}return Object.keys(kv).includes(p)&&(I.participantRole=p),Object.keys(gh).includes(m)&&(I.participantType=m),Array.isArray(c)&&(I.participantRoleResponsibilties=c),s.participantType===gh.INDIVIDUAL&&g&&function({updateParticipantName:e,existingParticipant:t,newValues:i,person:r}){let n,a={},{standardFamilyName:o,standardGivenName:s,nationalityCode:c,personId:d,birthdate:u,tennisId:l,sex:p}=r;if(p&&Object.keys(rc).includes(p)&&(a.sex=p),Mr(d)&&(a.personId=d),c&&Mr(c)&&(function(e){return Sh.flatMap((({iso:e,ioc:t})=>[e,t])).filter(Boolean).includes(e)}(c)||""===c)&&(a.nationalityCode=c),o&&typeof Mr(o)&&o.length>1&&(a.standardFamilyName=o,n=!0),s&&typeof Mr(s)&&s.length>1&&(a.standardGivenName=s,n=!0),n&&e){let e=`${a.standardGivenName} ${a.standardFamilyName}`;i.participantName=e}u&&Fc(u)&&(a.birthdate=u),l&&Mr(l)&&(a.tennisId=l),Object.assign(t.person,a)}({updateParticipantName:t,existingParticipant:s,newValues:I,person:g}),Object.assign(s,Js(I)),i&&dC({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),As({topic:Af,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:yd(s),..._r}}function lC(e){let t=oC(e);if(t.error)return t;let i="assignTieMatchUpParticipantId",r=e.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:o,event:s}=e;if(!o)return Qs({result:{error:Ha},stack:i});if(e.sideNumber&&![1,2].includes(e.sideNumber))return Qs({result:{error:ga},stack:i});let{inContextDualMatchUp:c,inContextTieMatchUp:d,relevantAssignments:u,collectionPosition:l,teamParticipants:p,collectionId:m,matchUpType:f,dualMatchUp:h,tieFormat:g}=t;if(d?.sides?.flatMap((e=>e.participant?.individualParticipantIds||e.participant?.participantId||[]))?.includes(o))return Qs({result:{..._r},stack:i});r=r??(e.sideNumber?c?.sides?.find((t=>t.sideNumber===e.sideNumber))?.participantId:void 0);let I=mv({participantFilters:{participantIds:[o]},tournamentRecord:n})?.participants?.[0];if(!I)return Qs({result:{error:Ya},stack:i});let{appliedPolicies:y}=Fh({tournamentRecord:n,drawDefinition:a,event:s}),v=e.policyDefinitions?.[wp]??y?.[wp]??Tv[wp];if(!1!==(e.enforceGender??v?.participants?.enforceGender)&&dc(d?.gender)&&cc(d?.gender)!==cc(I.person?.sex))return{error:_a,info:"Gender mismatch"};let{individualParticipantIds:S,participantType:U}=I;if(yI(Bi)(f)&&U!==ph)return{error:$a};let b=U===ph?[o]:S,w=r&&p?.find((({participantId:e})=>e===r))||p?.find((({individualParticipantIds:e})=>Sr(b,e)));if(!w)return{error:Yo};if(r||(r=w.participantId),!r)return{error:Ya};let T=u?.find((e=>e.participantId===w?.participantId))?.drawPosition,D=h?.sides?.find((e=>e.participantId===r))?.sideNumber,P=d?.sides?.find((e=>T&&e.drawPosition===T))?.sideNumber,N=D??P??e.sideNumber;if(!g)return{error:ia};if(!g.collectionDefinitions?.find((e=>e.collectionId===m)))return{error:ta};Iw({tournamentId:n.tournamentId,eventId:s.eventId,inContextDualMatchUp:c,drawDefinition:a,dualMatchUp:h});let E=h?.sides?.find((e=>e.sideNumber===N)),M=d?.sides?.find((e=>e.sideNumber===N)),R=(E?.lineUp??ty({participantId:r,drawDefinition:a})?.lineUp)?.filter((e=>e.collectionAssignments?.find((e=>e.collectionPosition===l&&e.collectionId===m&&!e.previousParticipantId))))?.map((e=>e?.participantId)),C=R?.length>1&&R||(U===fh?I.individualParticipantIds:[o]),A=cC({collectionPosition:l,teamParticipantId:r,dualMatchUpSide:E,drawDefinition:a,participantIds:C,collectionId:m});if(A.error)return Qs({result:A,stack:i});let k,{modifiedLineUp:O}=A;if(f===ji){if(U!==fh){let e=pC({collectionPosition:l,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(e?.error)return Qs({result:e,stack:i});if(e=function({side:e}){let t;if(e.participant){let i=e.participant.individualParticipantIds||[];if(1===i.filter(Boolean).length){let{participant:e}=ey({participantIds:i,tournamentRecord:n});i.push(o);let{participant:r}=ey({participantIds:i,tournamentRecord:n});if(!r&&e){e.individualParticipantIds=i;let t=uC({pairOverride:!0,tournamentRecord:n,participant:e});if(t.error)return t}else t=e?.participantId}}else{let e=LM({participant:{individualParticipantIds:[o],participantRole:Nv,participantType:fh},pairOverride:!0,tournamentRecord:n});if(e.error)return e}return{..._r,deletedParticipantId:t}}({side:M}),e.error)return e;k=e.deletedParticipantId,E&&(E.lineUp=O),h&&Jf({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a})}else if(U===fh)for(let x of C)pC({collectionPosition:l,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:x,collectionId:m,tieFormat:g})}else{let e=pC({collectionPosition:l,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(e?.error)return e}if(E&&(E.lineUp=O),h&&Jf({tournamentId:n?.tournamentId,matchUp:h,context:i,drawDefinition:a}),k){let{error:e}=Lv({participantIds:[k],tournamentRecord:n});e&&console.log("cleanup")}return{..._r,modifiedLineUp:O}}function pC({collectionPosition:e,teamParticipantId:t,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){let s=ty({participantId:t,drawDefinition:i})?.lineUp,c=(r||s)?.find((e=>e?.participantId===n)),d={collectionId:a,collectionPosition:e};if(c)c.collectionAssignments.push(d);else{let e={collectionAssignments:[d],participantId:n};r.push(e)}return bS({participantId:t,lineUp:r,drawDefinition:i,tieFormat:o})}function mC(e){let{tournamentRecord:t,drawDefinition:i,participantId:r,event:n}=e,a="removeTieMatchUpParticiapantId";if(!r)return Qs({result:{error:Ha},stack:a});let o=oC(e);if(o.error)return o;let{appliedPolicies:s}=Fh({tournamentRecord:t,drawDefinition:i,event:n}),c=(e.policyDefinitions?.[wp]??s?.[wp]??Tv[wp])?.processCodes?.substitution,{inContextDualMatchUp:d,inContextTieMatchUp:u,relevantAssignments:l,collectionPosition:p,teamParticipants:m,collectionId:f,matchUpType:h,dualMatchUp:g,tieMatchUp:I,tieFormat:y}=o;if(!g)return Qs({result:{error:sa},stack:a});let v=u?.sides?.find((e=>e.participant?.participantId===r||e.participant?.individualParticipantIds?.includes(r)));if(!v)return Qs({result:{error:Ya},stack:a});let S=e.policyDefinitions?.[Rp]??s?.[Rp];if(!v.substitutions?.length&&(My({score:u?.score})||u?.winningSide)&&!1!==S?.requireParticipantsForScoring)return Qs({result:{error:is},stack:a});let U=d?.sides?.find((({sideNumber:e})=>e===v.sideNumber))?.participantId;if(!U)return Qs({result:{error:Ya},stack:a});let b=mv({participantFilters:{participantIds:[r]},tournamentRecord:t})?.participants?.[0];if(!b)return Qs({result:{error:Ya},stack:a});if(h===Bi&&b.participantType===fh)return Qs({result:{error:_a},stack:a});let w=b.participantType===ph?[r]:b.individualParticipantIds;Iw({tournamentId:t.tournamentId,eventId:n.eventId,inContextDualMatchUp:d,drawDefinition:i,dualMatchUp:g});let T=g.sides?.find((({sideNumber:e})=>e===v.sideNumber));if(!T&&(g.sides?.filter((({lineUp:e})=>!e)).length||0)<2){let e=m?.map((({participantId:e})=>({drawPosition:l?.find((t=>t.participantId===e))?.drawPosition,teamParticipantId:e})));T=g.sides?.find((t=>e?.find((({drawPosition:e})=>e===t.drawPosition))?.teamParticipantId===U))}if(!T)return Qs({result:{error:Ya,context:{participantId:r}}});let{modifiedLineUp:D,previousParticipantIds:P}=cC({collectionPosition:p,teamParticipantId:U,dualMatchUpSide:T,participantIds:w,drawDefinition:i,collectionId:f});if(T.lineUp=D,U&&y&&bS({participantId:U,lineUp:D,drawDefinition:i,tieFormat:y}),h===ji&&b.participantType===ph){let e=u?.sides?.find((e=>e.sideNumber===T?.sideNumber)),{participantId:i}=e??{},n=i&&mv({participantFilters:{participantIds:[i]},tournamentRecord:t,withDraws:!0})?.participants?.[0];if(!n)return Qs({result:{error:Ya},stack:a});{let e=n?.individualParticipantIds?.filter((e=>e!==r))??[];if(P&&e.push(...P),e.length>2)return Qs({result:{error:Va},stack:a});if(n.draws?.length){if(1===e.length){let{participant:i}=ey({participantIds:e,tournamentRecord:t});if(!i){let i=LM({participant:{participantRole:Nv,individualParticipantIds:e,participantType:fh},pairOverride:!0,tournamentRecord:t});if(i.error)return Qs({result:i,stack:a})}}}else if(e.length){n.individualParticipantIds=e;let i=uC({participant:n,pairOverride:!0,tournamentRecord:t});if(i.error)return Qs({result:i,stack:a})}else{let e=Lv({participantIds:[i],tournamentRecord:t});e.error&&console.log("cleanup",{result:e})}}}if(1===v.substitutions?.length&&!u?.sides?.find((e=>e.sideNumber!==v.sideNumber))?.substitutions?.length&&I?.processCodes?.length){for(let e of c||[]){let t=I.processCodes.lastIndexOf(e);I.processCodes.splice(t,1)}Jf({tournamentId:t?.tournamentId,matchUp:I,context:a,drawDefinition:i})}return Jf({tournamentId:t?.tournamentId,matchUp:g,context:a,drawDefinition:i}),{..._r,modifiedLineUp:D}}function fC(e){let t=dp(e,[{[Tl]:!0,[Pl]:!0,[Ll]:!0}]);if(t.error)return t;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=e;if(r&&![1,2].includes(r))return{error:Ho,sideNumber:r};let{matchUp:o,structure:s}=cw({drawDefinition:i,matchUpId:n,event:a});return o?Cg({structure:s})?(o.sides?.forEach((e=>{(!r||e.sideNumber===r)&&delete e.participantId})),Jf({tournamentId:e.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:o}),{..._r}):{error:mn}:{error:aa}}function hC({inContextDrawMatchUps:e,positionAssignments:t,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:c,matchUp:d,event:u}){if(s){let t=e.find((({matchUpId:e})=>d.matchUpId===e)).sides?.find((e=>e.drawPosition===r))?.sideNumber,i=d.sides?.find((e=>e.sideNumber===t));i&&delete i.lineUp}d.drawPositions=(d.drawPositions||[]).map((e=>e===r?void 0:e)).filter(Boolean);let l=t.filter((({drawPosition:e})=>d.drawPositions?.includes(e))).filter((e=>e.bye)).length;return d.matchUpStatus=(l?"BYE":By(d.matchUpStatus)&&d.matchUpStatus)||Jm,By(d.matchUpStatus)&&(d.winningSide=void 0),d.matchUpStatusCodes&&hS({inContextDrawMatchUps:e,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:c,matchUp:d}),Jf({tournamentId:n?.tournamentId,eventId:u?.eventId,context:`removeSubsequentDrawPosition-${r}`,drawDefinition:o,matchUp:d}),{..._r}}function gC(e){let{dualWinningSideChange:t,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:c,matchUpId:d,structure:u,event:l}=e,p=!!e.matchUp.collectionId,m=Cg({structure:u}),{drawPositions:f,winningSide:h}=c.matchUp||{};if(!m&&!f)return{error:cn};let g,{targetLinks:{loserTargetLink:I,winnerTargetLink:y,byeTargetLink:v},targetMatchUps:{loserMatchUp:S,winnerMatchUp:U,byeMatchUp:b}}=c,w=pw({...e,matchUpStatus:a||Jm,removeWinningSide:!0});if(w.error)return w;if(p){let{matchUpTieId:i,matchUpsMap:a}=e;if(g=Uw({appliedPolicies:e.appliedPolicies,matchUpId:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,event:l}),!t&&!g.removeWinningSide)return{..._r}}if(m)return{..._r};let{matchUps:T}=oy({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:u}),{positionAssignments:D}=hf({structure:u}),P=h-1,N=1-P,E=f[P],M=f[N],{winnerParticipantId:R,loserParticipantId:C}=D?.reduce(((e,t)=>(t.drawPosition===M&&(e.loserParticipantId=t.participantId),t.drawPosition===E&&(e.winnerParticipantId=t.participantId),e)),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},A=T.filter((e=>e.drawPositions?.includes(M)));if(U&&IC({sourceMatchUpStatus:a,sourceMatchUpId:d,inContextDrawMatchUps:i,winningDrawPosition:E,winnerParticipantId:R,tournamentRecord:r,winnerTargetLink:y,drawDefinition:n,winnerMatchUp:U,dualMatchUp:s,matchUpsMap:o}),S){let{winnerHadMatchUpStatus:e}=function({matchUpStatuses:e=["BYE",Qm,Gm],drawPositionMatchUps:t,loserDrawPosition:i,sourceMatchUps:r}){let n=t?.reduce(((e,t)=>!e||t.roundNumber>e.roundNumber?t:e),void 0),a=n?.drawPositions?.find((e=>e!==i)),o=r.filter((e=>e?.drawPositions?.includes(a))).map((e=>e.matchUpStatus)),s=r.filter((e=>e?.drawPositions?.includes(i))).map((e=>e.matchUpStatus));return{sourceMatchUp:n,winnerHadMatchUpStatus:Sr(o||[],e),winnerMatchUpStatuses:o,loserHadMatchUpStatus:Sr(s||[],e),loserMatchUpStatuses:s}}({drawPositionMatchUps:A,loserDrawPosition:M,sourceMatchUps:T}),t=I.linkCondition===Gu;if(e&&t){yC({targetLink:I,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:Math.min(...S.drawPositions),matchUpsMap:o,event:l})}let c=function({sourceMatchUpStatus:e,loserParticipantId:t,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:c,event:d}){let u="removeDirectedLoser",l=r.target.structureId,{structure:p}=lf({drawDefinition:a,structureId:l});if(!p)return{error:Rn};let{positionAssignments:m}=hf({structure:p}),f=m?.find((e=>e.participantId===t))?.drawPosition;if(m?.forEach((e=>{e.participantId===t&&delete e.participantId})),n&&e){let t=s?.drawMatchUps?.find((({matchUpId:e})=>e===o.matchUpId));t.matchUpStatusCodes=e===qm?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter((e=>e.participantId!==t)),c){let e=o?.sides.reduce(((e,t,i)=>t.drawPosition===f?i:e),void 0),t=s?.drawMatchUps?.find((({matchUpId:e})=>e===o.matchUpId)),r=t?.sides?.[e];r&&(delete r.lineUp,Jf({tournamentId:i?.tournamentId,eventId:d?.eventId,matchUp:t,context:u,drawDefinition:a}))}return{..._r}}({sourceMatchUpStatus:a,sourceMatchUpId:d,loserParticipantId:C,tournamentRecord:r,loserTargetLink:I,drawDefinition:n,loserMatchUp:S,dualMatchUp:s,matchUpsMap:o,event:l});if(c.error)return c}if(b){yC({targetLink:v,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:Math.min(...b.drawPositions),matchUpsMap:o,event:l})}return{..._r,...g&&{tieMatchUpResult:g}}}function IC({inContextDrawMatchUps:e,winningDrawPosition:t,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:c,matchUpsMap:d,dualMatchUp:u,event:l}){let{structureId:p,roundNumber:m}=c;if(a){let e=a.target.structureId,{structure:t}=lf({drawDefinition:s,structureId:e});if(!t)return{error:Rn};let{positionAssignments:i}=hf({structure:t});t.seedAssignments=(t.seedAssignments??[]).filter((e=>e.participantId!==r));let o=i?.find((e=>e.participantId===r))?.drawPosition,{matchUps:u}=oy({drawDefinition:s,structure:t,event:l}),p=dr(u.map((e=>e.drawPositions)).flat(1/0).filter(Boolean));if(1===(o?p[o]:void 0))i?.forEach((e=>{e.participantId===r&&delete e.participantId}));else{let e=u.filter((({drawPositions:e})=>e.includes(o)));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:e,winnerTargetLink:a})}let m=d?.drawMatchUps?.find((({matchUpId:e})=>e===c.matchUpId));m&&Jf({tournamentId:n?.tournamentId,eventId:l?.eventId,matchUp:m,context:"removeDirectedWinner",drawDefinition:s})}return m&&function({inContextDrawMatchUps:e,sourceMatchUpStatus:t,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:c,matchUpsMap:d,event:u}){let{structure:l}=lf({drawDefinition:a,structureId:o});if(l?.structureType===xu)return{..._r};d=d??bg({drawDefinition:a});let p=(d?.mappedMatchUps||{})[o].matchUps,{initialRoundNumber:m}=Oy({drawPosition:i,matchUps:p}),f=p?.filter((e=>e.roundNumber>=c&&e.roundNumber!==m&&e.drawPositions?.includes(i))),{positionAssignments:h}=ff({drawDefinition:a,structureId:o});for(let g of f??[])hC({inContextDrawMatchUps:e,sourceMatchUpStatus:t,positionAssignments:h,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:d,matchUp:g,event:u})}({targetDrawPosition:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:u,matchUpsMap:d,roundNumber:m,structureId:p}),{..._r}}function yC({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId,c="removeDirectedBye";return Ly({color:"brightyellow",method:c,drawPosition:r}),Qs({result:Hy({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:s,event:o}),stack:c})}function vC(e){let{tournamentRecord:t,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:o,event:s}=e,c="doubleExitAdvancement";if(o.structureType===xu)return Qs({result:{..._r},stack:c});let{matchUp:d,targetMatchUps:u,targetLinks:l}=a,{loserMatchUp:p,winnerMatchUp:m,loserTargetDrawPosition:f}=u,h=By(p?.matchUpStatus)&&!p.sides?.map((e=>e.participantId??e.participant)).filter(Boolean).length,g=p?.matchUpStatus===qm;if(p&&"BYE"!==p.matchUpStatus){let{loserTargetLink:a}=l;if(i?.progression?.doubleExitPropagateBye||p.feedRound&&p.sides?.[0]?.participantFed){let e=UC({loserTargetDrawPosition:f,tournamentRecord:t,loserTargetLink:a,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:s});if(e.error)return Qs({result:e,stack:c})}else if(!g){let{feedRound:i,drawPositions:r,matchUpId:n}=p,a=i?2:2-r.indexOf(f);a=h?p.winningSide:a;let o=SC({...e,targetMatchUp:p,walkoverWinningSide:a,tournamentRecord:t,sourceMatchUp:d,matchUpId:n});if(o.error)return Qs({result:o,stack:c})}}if(m){let i=SC({...e,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:t,sourceMatchUp:d});if(i.error)return Qs({result:i,stack:c})}return Qs({result:{..._r},stack:c})}function SC(e){let{inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o}=e,s=r.structures.find((({structureId:e})=>e===a.structureId)),c=e.matchUpStatus===Wm?Wm:qm,d=e.matchUpStatus===Wm?Gm:Qm,u="conditionallyAdvanceDrawPosition",l=o.drawMatchUps.find((e=>e.matchUpId===a.matchUpId));if(!l)return{error:sa};let p=n?.drawPositions||[],m=l.drawPositions?.filter(Boolean),f=n?.structureId===a.structureId;if(f&&Sr(p,m)&&(m=m.filter((e=>!p.includes(e)))),f&&m.length>1)return Qs({result:{error:nn},stack:u});let{pairedPreviousMatchUpIsDoubleExit:h,pairedPreviousMatchUp:g}=mS(e),I=py({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetMatchUps:y,targetLinks:v}=I,{loserTargetDrawPosition:S,winnerMatchUp:U,loserMatchUp:b}=y;if(b){let{loserTargetLink:e}=v,t=UC({loserTargetDrawPosition:S,loserMatchUp:b,tournamentRecord:i,loserTargetLink:e,drawDefinition:r,matchUpsMap:o});if(t.error)return Qs({result:t,stack:u})}let w,T=l.drawPositions?.filter(Boolean)||[],D=1===T.length,P=e.walkoverWinningSide||D&&gS({drawPosition:T[0],matchUpId:a.matchUpId,inContextDrawMatchUps:t})||void 0,N=By(l.matchUpStatus)&&!T.length,E=1===l.finishingRound,M=N&&!E?c:d,R=t.find((e=>e.matchUpId===g.matchUpId)),C=[];n&&(n?.structureId===R?.structureId?w=n.roundPosition<g?.roundPosition?1:2:a.feedRound?w=n.structureId===a.structureId?2:1:P&&(w=3-P));let A=e.matchUpStatus,k=g?.matchUpStatus;1===w?C=[{matchUpStatus:bC(A),previousMatchUpStatus:A,sideNumber:1},{matchUpStatus:bC(k),previousMatchUpStatus:k,sideNumber:2}]:2===w&&(C=[{matchUpStatus:bC(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:bC(A),previousMatchUpStatus:A,sideNumber:2}]),C.length&&(C=C.map((e=>Js(e))));let O=pw({...e,winningSide:P,matchUp:l,matchUpStatusCodes:C,matchUpStatus:M});if(O.error)return Qs({result:O,stack:u});if(N)return vC({...e,matchUpStatus:M,targetData:I});if(!U)return Qs({result:{..._r},stack:u});let x=2===m.length?m[P-1]:m[0],{positionAssignments:F}=ff({structure:s}),L=F?.find((e=>e.drawPosition===x)),_=o.drawMatchUps.find((e=>e.matchUpId===U.matchUpId)),B=_?.drawPositions?.filter(Boolean),V=1===B.length;if(x){if(L?.bye){let i=py({matchUpId:_.matchUpId,inContextDrawMatchUps:t,drawDefinition:r});if(V){let i=B.filter(Boolean)[0],n=gS({drawPosition:i,matchUpId:_.matchUpId,inContextDrawMatchUps:t}),a=pw({appliedPolicies:e.appliedPolicies,matchUpId:_.matchUpId,matchUp:_,matchUpStatus:d,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:n});return a.error?Qs({result:a,stack:u}):Gy({drawPositionToAdvance:i,matchUpId:_.matchUpId,inContextDrawMatchUps:t,drawDefinition:r,matchUpsMap:o})}if(By(U.matchUpStatus)){let t=vC({...e,matchUpId:_.matchUpId,matchUpStatus:M,targetData:i});if(t.error)return Qs({result:t,stack:u})}return Qs({result:{..._r},stack:u})}return IS({matchUpId:U.matchUpId,drawPosition:x,inContextDrawMatchUps:t,drawDefinition:r})}if(h){if(!_)return{error:sa};if(V){let e=B[0],i=gS({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawPosition:e});console.log("existing drawPosition is winningSide",{walkoverWinningSide:i})}let i=By(_.matchUpStatus)?d:c,n=pw({matchUpId:_.matchUpId,appliedPolicies:e.appliedPolicies,matchUp:_,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:i});if(n.error)return Qs({result:n,stack:u});if(i===c){let t=vC({...e,matchUpId:a.matchUpId,matchUpStatus:i,targetData:I});if(t.error)return t}}return Qs({result:{..._r},stack:u})}function UC(e){let{loserTargetDrawPosition:t,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:o,loserMatchUp:s}=e,c=r?.target?.structureId,{structure:d}=lf({drawDefinition:n,structureId:c});return d?Vy({drawPosition:t,tournamentRecord:i,drawDefinition:n,structureId:c,matchUpsMap:a,loserMatchUp:s,event:o}):{error:An}}function bC(e){return e===qm?Qm:e===Wm?Gm:e}function wC(e){let{tournamentRecord:t,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=e,o=!(!a.tieMatchUps||a.rondPosition||!e.inContextDrawMatchUps.find((e=>e.matchUpId===a.matchUpId)).containerStructureId),s="BYE"===r,c=a.winningSide,d=[qm,Wm].includes(r),u=Ry({matchUpStatus:r}),l=Cy({matchUpStatus:r}),p=!u&&!l,m=e.matchUpTieId||c&&u&&!d,f=c&&d;return p&&{error:zn}||m&&TC(e)||f&&function(e){let t=gC(e);return t.error?t:vC(e)}(e)||c&&gC(e)||l&&pw({...e,removeScore:[Vm,Qm].includes(r),matchUpStatus:r||Jm})||s&&function({tournamentRecord:e,drawDefinition:t,structure:i,matchUp:r}){let n="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return Qs({result:{error:Jn},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=hf({structure:i}),o=a?.filter((e=>e.bye)).map((e=>e.drawPosition));return r.drawPositions?.some((e=>o?.includes(e)))?(r.matchUpStatus="BYE",r.matchUpStatusCodes=[],Jf({tournamentId:e?.tournamentId,context:n,drawDefinition:t,matchUp:r}),{..._r}):Qs({result:{error:Hn},info:"matchUp does not include BYE",stack:n})}({tournamentRecord:t,drawDefinition:i,structure:n,matchUp:a})||!u&&{error:zn}||d&&function(e){let t=TC({...e,removeScore:!0});return t.error?t:vC(e)}(e)||o&&TC(e)||e.propagateExitStatus&&TC(e)||Qs({result:{error:Jn,info:"matchUpStatus: "+r},stack:"attemptToSetMatchUpStatus"})}function TC(e){let t="scoreModification";if(e.isCollectionMatchUp&&e.dualMatchUp?.winningSide&&!e.projectedWinningSide){let i=gC(e);if(i.error)return Qs({result:i,stack:t})}let i=!!e.matchUp.collectionId,r=pw({...e});if(i){let{matchUpTieId:i,drawDefinition:n,matchUpsMap:a}=e,o=Uw({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:i,event:e.event,drawDefinition:n,matchUpsMap:a});if(o.error)return Qs({result:o,stack:t});Object.assign(r,{tieMatchUpResult:o})}return Qs({result:r,stack:t})}function DC({drawDefinition:e,structure:t,matchUp:i}){let r=[];if(t.finishingPosition===Il&&FS({drawDefinition:e,structure:t})){let{structureIds:n}=function({drawDefinition:e,structure:t,matchUp:i}){let{drawPositions:r}=i,{positionAssignments:n}=ff({drawDefinition:e,structure:t}),a=n?.filter((({drawPosition:e})=>r?.includes(e)))?.map((e=>{let{extension:t}=Jp({element:e,name:Sm});return t?.value?.groupOrder})),{containerStructures:o}=ah({drawDefinition:e}),s=o[t.structureId];return{structureIds:uy({drawDefinition:e,structureId:s})?.links?.source?.filter((e=>Sr(a,e.source?.finishingPositions||[]))).map((e=>e.source.structureId))}}({drawDefinition:e,structure:t,matchUp:i});n?.length&&r.push(...n)}return{connectedStructureIds:r}}function PC(e){let t,i="attemptToSetWinningSide",r={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:o,dualMatchUp:s,winningSide:c,structure:d,matchUp:u}=e;if(s?._disableAutoCalc&&!1!==a)return mw(e);if(u.winningSide&&u.winningSide!==c){let{connectedStructureIds:i}=DC({drawDefinition:o,structure:d,matchUp:u});i.length&&(console.log({connectedStructureIds:i}),t=!0);let r=gC(e);if(r.error)return r}let l,p,m=bw(e);return m.context?.progressExitStatus&&Object.assign(r,m.context),m.error?Qs({result:m,stack:i}):(e.qualifierChanging&&n?.[Np]?.autoReplaceQualifiers&&(l=function(e){let t,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=e,o=e.targetData.targetLinks?.winnerTargetLink;if(o.target.feedProfile===Fu){let s=r.sides.find((({sideNumber:e})=>e!==a)).participantId,c=i.find((e=>e.structureId===o.target.structureId&&e.roundNumber===o.target.roundNumber&&e.sides.some((({participantId:e})=>e===s))));if(c?.matchUpStatus===Jm&&!Zw({inContextDrawMatchUps:i,drawDefinition:n,targetData:py({matchUpId:c.matchUpId,inContextDrawMatchUps:i,drawDefinition:n})})){let{structure:i}=lf({structureId:c.structureId,drawDefinition:n}),o=ff({structure:i}).positionAssignments;for(let c of o||[])if(c.participantId===s){let s=r.sides.find((({sideNumber:e})=>e===a)).participantId;if(c.participantId=s,i?.positionAssignments)i.positionAssignments=o;else if(i?.structures){let e=Object.assign({},...(o||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of i.structures)t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}th({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:i}),t=!0}}}return{..._r,qualifierReplaced:t}}(e).qualifierReplaced),e.qualifierAdvancing&&n?.[Np]?.autoPlaceQualifiers&&(p=function(e){let t,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=e,o=e.targetData.targetLinks?.winnerTargetLink;if(o.target.feedProfile===Fu){let s=r.sides.find((({sideNumber:e})=>e===a))?.participantId,c=hr(i.filter((e=>e.structureId===o.target.structureId&&e.roundNumber===o.target.roundNumber&&e.sides.some((({participantId:e,qualifier:t})=>t&&!e)))));if(c?.matchUpStatus===Jm&&!Zw({inContextDrawMatchUps:i,drawDefinition:n,targetData:py({matchUpId:c.matchUpId,inContextDrawMatchUps:i,drawDefinition:n})})){let i=c.sides.find((e=>e.qualifier&&!e.participantId))?.drawPosition,{structure:r}=lf({structureId:c.structureId,drawDefinition:n});if(!r)return{error:Rn};let a=ff({structure:r}).positionAssignments;for(let o of a||[])if(o.drawPosition===i&&!o.participantId){if(o.participantId=s,r.positionAssignments)r.positionAssignments=a;else if(r.structures){let e=Object.assign({},...(a||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of r.structures)t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}th({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:r}),t=!0}}}return{..._r,qualifierPlaced:t}}(e).qualifierPlaced),Qs({result:Js({..._r,...m,connectedStructures:t,qualifierReplaced:l,qualifierPlaced:p,context:r}),stack:i}))}Oi(eC,{applyLineUps:()=>pA,assignMatchUpSideParticipant:()=>tC,assignTieMatchUpParticipantId:()=>lC,bulkMatchUpStatusUpdate:()=>aA,checkInParticipant:()=>nC,checkOutParticipant:()=>rC,disableTieAutoCalc:()=>ZC,enableTieAutoCalc:()=>XC,findMatchUp:()=>tE,removeDelegatedOutcome:()=>JC,removeMatchUpSideParticipant:()=>fC,removeTieMatchUpParticipantId:()=>mC,replaceTieMatchUpParticipantId:()=>sC,resetAdHocMatchUps:()=>uA,resetMatchUpLineUps:()=>tA,resetScorecard:()=>dA,resetTieFormat:()=>cA,setDelegatedOutcome:()=>sA,setMatchUpFormat:()=>eA,setMatchUpState:()=>YC,setMatchUpStatus:()=>nA,setOrderOfFinish:()=>lA,substituteParticipant:()=>QC,toggleParticipantCheckInState:()=>aC,updateTieMatchUpScore:()=>Uw});var NC={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function EC(e){let{inContextDrawMatchUps:t,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:o}=e,{matchUpId:s}=o,{iteration:c=0}=e;c+=1;let d="removeDoubleExit";Ly({color:"brightyellow",method:d,matchUpId:s,iteration:c,keyColors:NC});let{targetMatchUps:{loserMatchUp:u,winnerMatchUp:l,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:m}}=a;if(l&&"BYE"!==l.matchUpStatus){let{stage:t,roundNumber:i,roundPosition:r,structureName:n}=l;Ly({winner:"winner",roundPosition:r,structureName:n,roundNumber:i,keyColors:NC,stage:t}),MC({...e,targetMatchUp:l,sourceMatchUp:o,iteration:c})}let f="BYE"===u?.matchUpStatus&&(u?.feedRound||1===u?.roundNumber);if(f&&a?.targetLinks?.loserTargetLink?.linkCondition===Gu){let e=t.filter((({roundNumber:e,structureId:t})=>t===o.structureId&&1===e)),i=wr(e.map((({roundPosition:e})=>e)).sort(),2).find((e=>e.includes(o.roundPosition)));if((e.filter((({roundPosition:e})=>i.includes(e)))?.map((({matchUpStatus:e})=>e))).every((e=>[Wm,qm].includes(e))))return Qs({result:{..._r},stack:d})}if(u&&("BYE"!==u.matchUpStatus||f)){let a=t.find((({matchUpId:e})=>e===u.matchUpId)),{structure:o}=lf({drawDefinition:r,structureId:a.structureId}),{stage:s,roundNumber:l,roundPosition:h,feedRound:g,structureName:I}=u;if(Ly({loser:"loser",roundPosition:h,structureName:I,roundNumber:l,keyColors:NC,feedRound:g,stage:s}),i?.progression?.doubleExitPropagateBye||f)yC({drawPosition:p,targetLink:m,inContextDrawMatchUps:t,drawDefinition:r,matchUpsMap:n});else{let t=MC({...e,targetMatchUp:u,structure:o,iteration:c});if(t.error)return Qs({result:t,stack:d})}}return Qs({result:{..._r},stack:d})}function MC(e){let{inContextDrawMatchUps:t,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:c}=e,d="conditionallyRemoveDrawPosition";Ly({method:d,structureName:s?.structureName,iteration:c});let u,l,p,m=py({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:f}}=m,h=o?.drawMatchUps.find((e=>e.matchUpId===a.matchUpId)),g=[];if(a.feedRound)p=f?.drawPositions?.filter(Boolean)?.find((e=>a.drawPositions.includes(e)));else if(n){if(l=fS({structureId:s.structureId,matchUp:n,matchUpsMap:o})?.pairedPreviousMatchUp,u=[qm,Wm].includes(l?.matchUpStatus),g=l?.drawPositions?.filter(Boolean)||[],[...af,"BYE"].includes(l?.matchUpStatus)||l?.winningSide){let e=n.drawPositions||[],t=a.drawPositions?.filter(Boolean);Sr(e,t)&&(t=t?.filter((t=>!e.includes(t)))),p=e.concat(g).find((e=>t?.includes(e)))}}else p=yr(a?.drawPositions||[],f?.drawPositions||[])?.[0];if(f&&p){let{stage:e,roundNumber:i,roundPosition:n,structureName:a}=f;Ly({method:"removeDirectedWinner",drawPositionToRemove:p,color:"brightgreen",roundPosition:n,structureName:a,roundNumber:i,keyColors:NC,stage:e}),IC({winningDrawPosition:p,winnerMatchUp:f,inContextDrawMatchUps:t,drawDefinition:r,matchUpsMap:o})}let I=EC({targetData:m,matchUp:a,inContextDrawMatchUps:t,appliedPolicies:i,drawDefinition:r,matchUpsMap:o,structure:s,iteration:c});if(I.error)return Qs({result:I,stack:d});let y=function({pairedPreviousDoubleExit:e,noContextTargetMatchUp:t}){return"BYE"===t.matchUpStatus?"BYE":e?[Wm,Gm].includes(t?.matchUpStatus)?Gm:Qm:Jm}({pairedPreviousDoubleExit:u,noContextTargetMatchUp:h}),v=!u;return I=pw({...e,matchUpId:a.matchUpId,matchUp:h,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:y,removeScore:v,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),I.error?Qs({result:I,stack:d}):{..._r}}function RC(e){let{matchUp:t,matchUpStatus:i,score:r,winningSide:n}=e,a="noDownStreamDependencies";if([qm,Wm].includes(t?.matchUpStatus)&&![qm,Wm].includes(i)){let t=EC(e);if(t.error)return Qs({result:t,stack:a})}let o=i===qm,s=My({score:r})&&!o&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!n),c=e?.inContextMatchUp?.collectionId&&function(e){let{matchUpFormat:t,score:i}=e,r=i?.sets?.length,n=t&&Uc(t),{setFormat:a,finalSetFormat:o,bestOf:s}=n??{};return(s&&r===s&&o||a)?.timed||!1}(e.inContextMatchUp),d=e.removeScore||!c&&![zm,_m].includes(i||zm),u=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||t.winningSide&&!n&&!My({score:r}),l=i=>{let r,{structure:n,drawDefinition:a,dualMatchUp:o,disableAutoCalc:s}=e;if(o?._disableAutoCalc&&!1!==s)return mw({...e,removeWinningSide:u});let{connectedStructureIds:c}=DC({drawDefinition:a,structure:n,matchUp:t});c.length&&(console.log({connectedStructureIds:c}),r=!0),Object.assign(e,{removeScore:i});let d=gC(e);if(d.error)return d;if(e.removingQualifier&&e.appliedPolicies?.[Np]?.autoRemoveQualifiers){let t=function(e){let t,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=e,a=e.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===Fu){let o=r.sides?.find((({sideNumber:e})=>e===r.winningSide))?.participantId,s=i.find((e=>e.structureId===a.target.structureId&&e.roundNumber===a.target.roundNumber&&e.sides?.some((({participantId:e})=>e===o))));if(s&&s.matchUpStatus===Jm&&!Zw({inContextDrawMatchUps:i,drawDefinition:n,targetData:py({matchUpId:s.matchUpId,inContextDrawMatchUps:i,drawDefinition:n})})){let{structure:i}=lf({structureId:s.structureId,drawDefinition:n}),r=ff({structure:i}).positionAssignments;for(let a of r||[])if(a.participantId===o){if(a.participantId=void 0,i?.positionAssignments)i.positionAssignments=r;else if(i?.structures){let e=Object.assign({},...(r||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of i?.structures||[])t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}th({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:i}),t=!0}}}return{qualifierRemoved:t}}(e);return{..._r,connectedStructures:r,...t}}return{..._r,connectedStructures:r}};if(u&&n&&e.isCollectionMatchUp)return CC(e);let p=[Vm,_m].includes(i)&&e.dualWinningSideChange,m=i&&i!==Jm,f=e.propagateExitStatus&&By(i);return Qs({result:(n||p||f)&&PC(e)||s&&l(d)||m&&wC(e)||u&&l(d)||t&&CC({...e,removeScore:!0})||{..._r},stack:a})}function CC(e){if(e.isCollectionMatchUp&&e.dualMatchUp?.winningSide&&!e.projectedWinningSide&&!e.autoCalcDisabled){let t=gC(e);if(t.error)return t}let t=pw({...e});if(e.isCollectionMatchUp){let{matchUpTieId:t,drawDefinition:i,event:r,matchUpsMap:n}=e,{removeWinningSide:a}=Uw({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:t,drawDefinition:i,matchUpsMap:n,event:r});a&&console.log("REMOVE WINNING SIDE")}return Qs({result:t,stack:"ndd:scoreModification"})}function AC(e){let t=dp(e,[{[Tl]:!0,[Pl]:!0,[Ll]:!0},{homeParticipantId:!0,[Yl]:Ha}]);if(t.error)return t;let i=cM(e,[{[Xl]:Hl,attr:{[Bl]:!0}}]);if(i.error)return i;let r=i?.matchUp?.matchUp?.sides?.map((e=>e?.participantId));if(e.homeParticipantId&&!r?.includes(e.homeParticipantId))return{error:Ba};let{disableNotice:n,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:c,matchUpId:d}=e;return iC({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:c,disableNotice:n,matchUpId:d,timeItem:{itemType:Kg,itemValue:a}})}function kC({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:r,timeStamp:n}=LI({timeItems:i?.timeItems||[],itemType:iI});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{timeModifiers:r}:t}function OC(e){let t="addMatchUpScheduledTime",i=e.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:c}=e;if(!c)return Qs({result:{error:ra},stack:t});if(!xc(s))return Qs({result:{error:Na},stack:t});if(!i){let e=cw({drawDefinition:a,matchUpId:c});if(e.error)return Qs({result:e,stack:t});i=e.matchUp}let d=Yc(s),u=BI({matchUp:i}).scheduledDate,l=d&&!u;if((kC({matchUp:i}).timeModifiers||[])?.length){let e=xC({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:c,matchUp:i});if(e?.error)return Qs({result:e,stack:t})}let p=Jc(s,!0,l);return iC({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,matchUpId:c,timeItem:{itemType:Jg,itemValue:p}})}function xC({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return Qs({result:{error:ra},stack:s});if(void 0!==n&&!Array.isArray(n))return Qs({info:SS("timeModifiers"),result:{error:Ho},stack:s});if(!o){let e=cw({drawDefinition:i,matchUpId:a});if(e.error)return Qs({result:e,stack:s});o=e.matchUp}let c=kC({matchUp:o}).timeModifiers||[],d=n.filter((e=>!c.includes(e)));if(n.length&&!d.length)return{..._r};if(d.some((e=>cI.includes(e)))){c=c.filter((e=>!cI.includes(e)));let r=OC({disableNotice:!0,removePriorValues:e,scheduledTime:"",tournamentRecord:t,drawDefinition:i,matchUpId:a});if(r.error)return Qs({result:r,stack:s})}let u=n?.length?[...d,...c]:void 0;return iC({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:iI,itemValue:u}})}function FC({scheduledDate:e,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:ra};let o=e&&Cc.test(e);return e&&!o?{error:Pa}:iC({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemValue:Yc(e),itemType:Yg}})}function LC({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){if(!i&&!t)return{error:zr};if(!o)return{error:ra};let c,d=cw({drawDefinition:r,matchUpId:o});if(d.error)return d;if(d?.matchUp?.matchUpType!==$i)return{error:ca};if(!(void 0===s||Array.isArray(s)&&s.length&&s.every((e=>"string"==typeof e))))return{error:Ho,context:{courtIds:s}};if(s){let e=cE({tournamentRecords:t||i&&{[i.tournamentId]:i}});if(e.error)return e;let r=e.courts?.filter((e=>s.includes(e.courtId)));if(r?.length!==s.length)return{error:Ho,context:{courtIds:s}};c=r?.map((e=>({venueId:e.venueId,courtId:e.courtId})))}return iC({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:qg,itemDate:a,itemValue:c}})}function _C({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:zr};if(!a)return{error:ra};if(o){let e=WI({tournamentRecords:t,tournamentRecord:i,venueId:o});if(e.error)return e}return iC({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Wg,itemValue:o}})}function BC({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){if(!i&&!t)return{error:zr};if(!o)return{error:ra};if(s){let e=HI({tournamentRecords:t,tournamentRecord:i,courtId:s});if(e.error)return e;let a=e.venue?.venueId;_C({tournamentRecords:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:a})}return iC({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Hg,itemDate:a,itemValue:s}})}function VC(e,t){let i=Rc.test(e)?e:zc(e),r=Yc(e)||Yc(t)||_c(new Date);return new Date(`${r}T${i}`).getTime()}function jC(e){let t="addMatchUpScheduleItems",i=dp(e,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[rp]:Ql}],t);if(i.error)return i;let r,n,{matchUpDependencies:a,inContextMatchUps:o}=e,{errorOnAnachronism:s=!1,checkChronology:c=!0,removePriorValues:d,tournamentRecords:u,tournamentRecord:l,drawDefinition:p,disableNotice:m,drawMatchUps:f,matchUpId:h,schedule:g,event:I}=e;if(f)r=f.find((e=>e.matchUpId===h));else{let e=cw({drawDefinition:p,event:I,matchUpId:h});if(e.error)return e;r=e.matchUp}let{endTime:y,courtId:v,courtIds:S,courtOrder:U,resumeTime:b,homeParticipantId:w,scheduledDate:T,scheduledTime:D,startTime:P,stopTime:N,timeModifiers:E,venueId:M}=g;c&&(!a||!o)&&({matchUpDependencies:a,matchUps:o}=Ey({drawDefinition:p}));let R=a?.[h]?.matchUpIds;if(g.scheduledDate&&c&&R){let e=o?.filter((e=>(e.schedule?.scheduledDate||Yc(e.schedule?.scheduledTime))&&R.includes(e.matchUpId))).map((({schedule:e})=>{let t=kc(e);return new Date(t??"").getTime()}));if(e?.length){let i=kc(g),r=new Date(i??"").getTime();if(Math.max(...e)>=r){if(s)return Qs({result:{error:$r},stack:t});n=$r}}}if(void 0!==T){let e=FC({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,scheduledDate:T,matchUpId:h});if(e?.error)return Qs({result:e,stack:t,context:{scheduledDate:T}})}if(void 0!==D){let e=OC({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,scheduledTime:D,matchUpId:h,matchUp:r});if(e?.error)return Qs({result:e,stack:t,context:{scheduledTime:D}})}if(void 0!==P){let e=WC({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,matchUpId:h,startTime:P,event:I});if(e?.error)return Qs({result:e,stack:t,context:{startTime:P}})}if(void 0!==N){let e=HC({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,matchUpId:h,stopTime:N,event:I});if(e?.error)return Qs({result:e,stack:t,context:{stopTime:N}})}if(void 0!==b){let e=zC({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,resumeTime:b,matchUpId:h,event:I});if(e?.error)return Qs({result:e,stack:t,context:{resumeTime:b}})}if(void 0!==y){let e=qC({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,matchUpId:h,endTime:y,event:I});if(e?.error)return Qs({result:e,stack:t,context:{endTime:y}})}if(void 0!==S){let e=LC({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,matchUpId:h,courtIds:S});if(e?.error)return Qs({result:e,stack:t,context:{courtIds:S}})}if(void 0!==v&&void 0!==T){let e=BC({courtDayDate:T,disableNotice:!0,removePriorValues:d,tournamentRecords:u,tournamentRecord:l,drawDefinition:p,matchUpId:h,courtId:v});if(e?.error)return Qs({result:e,stack:t,context:{courtId:v}})}if(void 0!==M){let e=_C({disableNotice:!0,removePriorValues:d,tournamentRecords:u,tournamentRecord:l,drawDefinition:p,matchUpId:h,venueId:M});if(e?.error)return Qs({result:e,stack:t,context:{venueId:M}})}if(void 0!==U&&ir(U)){let e=$C({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,courtOrder:U,matchUpId:h});if(e?.error)return Qs({result:e,stack:t,context:{courtOrder:U}})}if(void 0!==E){let e=xC({disableNotice:!0,removePriorValues:d,tournamentRecord:l,drawDefinition:p,timeModifiers:E,matchUpId:h,matchUp:r});if(e?.error)return Qs({result:e,stack:t,context:{timeModifiers:E}})}return Mr(w)&&AC({disableNotice:!0,homeParticipantId:w,removePriorValues:d,tournamentRecord:l,drawDefinition:p,matchUpId:h}),m||Jf({tournamentId:l?.tournamentId,eventId:I?.eventId,context:t,drawDefinition:p,matchUp:r}),n?{..._r,warnings:[n]}:{..._r}}function $C({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:ra};if(n&&!ir(n))return{error:Ho,info:"courtOrder must be numeric"};let o=n&&zi(n);return iC({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:zg,itemValue:o}})}function GC({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:ra};if(!n)return{error:Ha};if(t){if(!xp({tournamentParticipants:mv({tournamentRecord:t,participantFilters:{participantTypes:[ph],participantRoles:[Rv]}}).participants??[],participantId:n}))return{error:Ya}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),iC({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function WC({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:ra};if(!xc(a))return{error:Na};let{matchUp:s}=cw({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:c}=BI({matchUp:s}),d=(s?.timeItems??[]).filter((e=>[Zg,eI,tI].includes(e?.itemType))).map((e=>VC(e.itemValue,c))).reduce(((e,t)=>!e||t<e?t:e),void 0);if(!d||VC(a,c)<d){s?.timeItems&&(s.timeItems=s.timeItems.filter((e=>e.itemType!==Qg)));let o=Jc(a,!0,!0);return iC({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:Qg,itemValue:o}})}return{error:Eo}}function qC({validateTimeSeries:e=!0,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:ra};if(!xc(o))return{error:Na};let{matchUp:c}=cw({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:d}=BI({matchUp:c}),u=(c?.timeItems??[]).filter((e=>[Qg,eI,Zg].includes(e?.itemType))).map((e=>VC(e.itemValue,d))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(!e||!u||VC(o,d)>u){c?.timeItems&&(c.timeItems=c.timeItems.filter((e=>e.itemType!==tI)));let e=Jc(o,!0,!0);return iC({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:tI,itemValue:e}})}return{error:Do}}function HC({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:ra};if(!xc(a))return{error:Na};let{matchUp:s}=cw({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:c}=BI({matchUp:s}),d=s?.timeItems??[];if(d.reduce(((e,t)=>t.itemType===tI||e),void 0))return{error:Po};let u=d.filter((e=>[Qg,eI,Zg].includes(e?.itemType))).sort(((e,t)=>VC(e.itemValue,c)-VC(t.itemValue,c))),l=u.at(-1),p=l?.itemType===Zg,m=u.filter((e=>!p||e.createdAt!==l.createdAt)).map((e=>VC(e.itemValue,c))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(VC(a,c)>m){if(s?.timeItems&&p){let e=l.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return iC({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemValue:Jc(a,!0,!0),itemType:Zg}})}return{error:No}}function zC({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:ra};if(!xc(n))return{error:Na};let{matchUp:s}=cw({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:c}=BI({matchUp:s}),d=s?.timeItems??[];if(d.reduce(((e,t)=>t.itemType===tI||e),void 0))return{error:Po};let u=d.filter((e=>[Qg,eI,Zg].includes(e?.itemType))).sort(((e,t)=>VC(e.itemValue,c)-VC(t.itemValue,c))),l=u.at(-1),p=l?.itemType===eI,m=u.filter((e=>!p||e.createdAt!==l.createdAt)).map((e=>VC(e.itemValue,c))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(VC(n,c)>m){if(s?.timeItems&&p){let e=l.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return iC({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemValue:Jc(n,!0,!0),itemType:eI}})}return{error:Mo}}function YC(e){let t="setMatchUpStatus";e.matchUpStatus&&[Qm,qm].includes(e.matchUpStatus)&&(e.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:c,drawDefinition:d,matchUpStatus:u,winningSide:l,matchUpId:p,event:m,score:f}=e;if(!d)return{error:Jr};if(u&&[Vm,zm,_m,Jm].includes(u)&&l)return{error:Ho,winningSide:l,matchUpStatus:u};if(![void 0,...tf].includes(u))return Qs({result:{error:Jn},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=bg({drawDefinition:d}),{matchUps:g}=gy({nextMatchUps:!0,tournamentRecord:o,inContext:!0,drawDefinition:d,matchUpsMap:h,event:m}),I=h.drawMatchUps.find((e=>e.matchUpId===p)),y=g?.find((e=>e.matchUpId===p));if(!I||!g)return{error:aa};if((I.winningSide||l)&&"BYE"===u)return{context:"Cannot have Bye with winningSide",error:Kn,matchUpStatus:u};let v=y?.structureId,{structure:S}=lf({drawDefinition:d,structureId:v}),U=yI(Gi)(I.matchUpType),b=y?.drawPositions?.filter(Boolean),w=y?.matchUpTieId,T=py({matchUpId:w||p,inContextDrawMatchUps:g,drawDefinition:d});Object.assign(e,{inContextDrawMatchUps:g,inContextMatchUp:y,matchUpTieId:w,matchUpsMap:h,targetData:T,structure:S,matchUp:I});let D=u===Jm&&""===f?.scoreStringSide1&&""===f?.scoreStringSide2&&!l;if(function(e){let{targetData:t,matchUpsMap:i}=e,{targetMatchUps:{loserMatchUp:r}}=t,n=By(r?.matchUpStatus),a=!!i?.drawMatchUps.find((e=>e.loserMatchUpId===r?.matchUpId&&By(e.matchUpStatus)));return a&&r?.matchUpStatus===qm||a&&n}(e)&&D)return{error:Xn};let P,N=Zw(e);if(U){if(s)Vp({extension:{name:im,value:!0},element:I});else if(c){let t=I.winningSide,{winningSide:i,scoreStringSide1:r,scoreStringSide2:n,set:a}=gw({drawDefinition:d,matchUpsMap:h,structure:S,matchUp:I,event:m}),o={scoreStringSide1:r,scoreStringSide2:n,sets:a?[a]:[]};if(P=i!==t,N&&P)return Qs({stack:"winningSideWithDownstreamDependencies",result:{error:La},context:{winningSide:l,matchUp:I}});_p({name:im,element:I}),Object.assign(e,{winningSide:i,dualWinningSideChange:P,projectedWinningSide:i,score:o})}Iw({tournamentId:o?.tournamentId,inContextDualMatchUp:y,eventId:m?.eventId,dualMatchUp:I,drawDefinition:d})}if(U&&u&&[Bm].includes(u))return{info:"Not supported for matchUpType: TEAM",error:Ho};if(f&&!U&&!r){let e=I.matchUpFormat??S?.matchUpFormat??d?.matchUpFormat??m?.matchUpFormat,t=ZP({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:e,matchUpStatus:u,winningSide:l,score:f});if(t.error)return t}let E=Fh({policyTypes:[Np,Rp],tournamentRecord:o,drawDefinition:d,event:m})?.appliedPolicies??{};Rr(e.policyDefinitions)&&Object.assign(E,e.policyDefinitions);let M=function({assignedDrawPositions:e,propagateExitStatus:t,inContextMatchUp:i,appliedPolicies:r,drawDefinition:n,matchUpStatus:a,structure:o,matchUp:s}){if(!1===r?.[Rp]?.requireParticipantsForScoring)return{..._r};let c=i?.sides?.map((e=>e.participantId)).filter(Boolean).length,d=s?.sides?[]:ff({structureId:o?.structureId,drawDefinition:n}).positionAssignments,u=c&&2===c||s.collectionId&&Cg({structure:o})&&c&&c>=1||2===e?.length&&d?.filter((t=>e.includes(t.drawPosition))).every((e=>e.participantId));return a&&[Qm,Gm,qm].includes(a)&&1===c&&t?{..._r}:a&&ef.includes(a)&&!u?Qs({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:u},result:{error:Jn}}):{..._r}}({assignedDrawPositions:b,propagateExitStatus:n,inContextMatchUp:y,appliedPolicies:E,drawDefinition:d,matchUpStatus:u,structure:S,matchUp:I});if(M?.error)return M;let R=y?.stage===Su&&1===y.finishingRound,C=R&&l,A=R&&I.winningSide&&!l&&(!e.matchUpStatus||e.matchUpStatus&&Cy({matchUpStatus:e.matchUpStatus}))&&(!e.outcome||!My({outcome:e.outcome})),k=C&&l!==I.winningSide&&I.winningSide;if(Object.assign(e,{qualifierAdvancing:C,qualifierChanging:k,removingQualifier:A,appliedPolicies:E}),w){let{matchUp:t}=cw({matchUpId:w,inContext:!0,drawDefinition:d,matchUpsMap:h,event:m});if(t){let i=Ug({matchUp:t,drawDefinition:d,structure:S,event:m})?.tieFormat,{projectedWinningSide:r}=function({drawDefinition:e,matchUpStatus:t,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:c,score:d}){let u=yd(n,void 0,!0);for(let p of u?.tieMatchUps||[])p.matchUpId===s.matchUpId&&(p.winningSide=r,p.score=d,My({score:d})||t?t&&(p.matchUpStatus=t):Object.assign(p,{...lw}));a=a??Ug({matchUp:s,structure:o,drawDefinition:e,event:c})?.tieFormat;let{winningSide:l}=gw({matchUp:u,drawDefinition:e,matchUpsMap:i,structure:o,tieFormat:a,event:c});return{projectedWinningSide:l}}({drawDefinition:d,matchUpStatus:u,dualMatchUp:t,matchUpsMap:h,winningSide:l,tieFormat:i,structure:S,matchUp:I,event:m,score:f});P=r!==t.winningSide;let n=t._disableAutoCalc;Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:P,projectedWinningSide:r,autoCalcDisabled:n,matchUpTieId:w,dualMatchUp:t,tieFormat:i})}}let O=Ry({matchUpStatus:u});if(!w){if(N&&!l&&(u&&Cy({matchUpStatus:u})||u&&[qm,Wm].includes(u)))return{error:Kn,activeDownstream:N,winningSide:l};if(l&&l===I.winningSide&&u&&!O)return{context:"winningSide must include directing matchUpStatus",error:Kn,directingMatchUpStatus:O,matchUpStatus:u}}let{schedule:x}=e;if(x){let e=jC({disableNotice:!0,tournamentRecords:a,tournamentRecord:o,drawDefinition:d,matchUpId:p,schedule:x});if(e.error)return e}let F=!U&&!P&&l&&I.winningSide&&I.winningSide!==l;if(i&&F&&I.roundPosition)return function(e){let{tournamentRecord:t,inContextMatchUp:i,structure:r,drawDefinition:n}=e,a=i.roundNumber,o=i.sides.find((e=>e.sideNumber===i.winningSide)),s=i.sides.find((e=>e.sideNumber!==i.winningSide)),{drawPosition:c,participantId:d}=o,{drawPosition:u,participantId:l}=s,{matchUps:p}=oy(e),m=p.filter((({drawPositions:e,roundNumber:t})=>e?.includes(c)&&t>a));vs({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach((i=>{i.drawPositions=i.drawPositions?.map((e=>e===c?u:e))||[],Jf({tournamentId:t?.tournamentId,eventId:e.event?.eventId,context:"swapWinnerLoser",drawDefinition:n,matchUp:i})}));let{stage:f,stageSequence:h}=r,g=n.structures.filter((({stage:e,stageSequence:t})=>e===f&&t>h)).map((({structureId:e})=>e)),{targetLinks:{loserTargetLink:I,winnerTargetLink:y}}=e.targetData,v=[I?.target.structureId,y?.target?.structureId].filter(Boolean);return n.structures.filter((({stage:e,structureId:t})=>e!==f&&v.includes(t))).forEach((({stage:e,stageSequence:t,structureId:i})=>{g.includes(i)||g.push(i),n.structures.filter((({stage:i,stageSequence:r})=>i===e&&r>t)).forEach((({structureId:e})=>{g.includes(e)||g.push(e)}))})),n.structures.filter((({structureId:e})=>g.includes(e))).forEach((e=>{let{positionAssignments:t}=ff({structure:e}),i=t?.find((({participantId:e})=>e===d)),r=t?.find((({participantId:e})=>e===l));i&&(i.participantId=l),r&&(r.participantId=d)})),pw({...e})}(e);let L=l&&!w||e.projectedWinningSide;Ly({activeDownstream:N,matchUpWinner:L,method:t,winningSide:l});let _=!N&&RC(e)||L&&function(e){let{matchUp:t,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=e;return i===t.winningSide||r&&!n?KC(e):Qs({stack:"winningSideWithDownstreamDependencies",result:{error:La},context:{winningSide:i,matchUp:t}})}(e)||(O||e.autoCalcDisabled)&&KC(e)||{error:Ko};return Qs({result:_,stack:t})}function KC(e){let{tournamentRecord:t,matchUp:i,event:r}=e,n=e.isCollectionMatchUp&&i.winningSide&&!e.winningSide&&!My({score:e.score}),a=e.isCollectionMatchUp?e.matchUpStatus||n&&Jm||e.winningSide&&jm||zm:e.matchUpStatus||jm,o=e.removeScore||[Vm,Qm].includes(a)&&![zm,_m].includes(a),s=pw({...e,matchUpStatus:a,removeWinningSide:n,removeScore:o});if(s.error)return s;if(e.isCollectionMatchUp){let{matchUpTieId:i,drawDefinition:n,matchUpsMap:a}=e,o=Uw({appliedPolicies:e.appliedPolicies,matchUpId:i,tournamentRecord:t,drawDefinition:n,matchUpsMap:a,event:r});if(o.error)return o;Object.assign(s,{tieMatchUpResult:o})}return s}function XC({tournamentRecord:e,drawDefinition:t,matchUpId:i,event:r}){if(!t)return{error:Jr};let{matchUp:n}=cw({drawDefinition:t,matchUpId:i,event:r});return n?.matchUpType!==$i?{error:ca}:YC({enableAutoCalc:!0,tournamentRecord:e,drawDefinition:t,matchUpId:i,event:r})}function JC({drawDefinition:e,event:t,matchUpId:i}){if(!e)return{error:Jr};if(!i)return{error:ra};let{matchUp:r}=cw({drawDefinition:e,event:t,matchUpId:i});return r?_p({name:em,element:r}):{error:aa}}function QC(e){return function({substituteParticipantId:e,existingParticipantId:t,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){let s="substituteParticipant";if(!r)return{error:Jr};if(!a)return{error:ra};if(!t||!e)return Qs({result:{error:Ha},stack:s});let{matchUp:c}=cw({drawDefinition:r,matchUpId:a,event:o});if(!c)return{error:aa};if(!c.collectionId)return Qs({result:{error:ca},stack:s});let d=bg({drawDefinition:r}),{matchUps:u}=gy({tournamentParticipants:i?.participants,inContext:!0,drawDefinition:r,matchUpsMap:d}),l=u?.find((e=>e.matchUpId===a)),p=u?.find((e=>e.matchUpId===l?.matchUpTieId))?.sides?.find((e=>e.participant.individualParticipants.some((({participantId:e})=>e===t))));return!p||n&&p.sideNumber!==n?{error:Ba}:p.participant?.individualParticipants?.map(Om).filter((e=>e!==t))?.includes(e)?sC({newParticipantId:e,tieMatchUpId:a,existingParticipantId:t,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):Qs({result:{error:Ba},stack:s})}(e)}function ZC({drawDefinition:e,matchUpId:t,event:i}){if(!e)return{error:Jr};let{matchUp:r}=cw({drawDefinition:e,matchUpId:t,event:i});return Vp({extension:{name:im,value:!0},element:r})}function eA(e){let t="setMatchUpFormat",i=dp(e,[{tournamentRecord:!0},{[ep]:e=>Ec({matchUpFormat:e}),[ip]:Yn,matchUpFormat:!0}]);if(i.error)return Qs({result:i,stack:t});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:c,eventType:d,matchUpId:u,eventId:l,stages:p,drawId:m,event:f,force:h}=e;if(a&&!Array.isArray(a))return Qs({result:{error:Ho,scheduledDates:a},stack:t});if(d&&!Lr([pu,fu],d))return Qs({result:{error:xn},stack:t});let g=0,I=e.structureIds||c&&[c].filter(Boolean)||[],y=e.eventIds||l&&[l].filter(Boolean)||[],v=e.drawIds||m&&[m].filter(Boolean)||[];if((c||I?.length)&&!n)return Qs({result:{error:Jr},stack:t});if(m&&u&&n){let e=hN({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:I,structureId:c,matchUpId:u});if(e.error)return e;g+=1}let S=e=>{let i=[];for(let n of e.structures||[]){if(Array.isArray(p)&&!p.includes(n.stage)||Array.isArray(o)&&!o.includes(n.stageSequence)||I?.length&&!I.includes(n.structureId))continue;I?.length&&n.matchUpFormat!==s&&(n.matchUpFormat=s,i.push(n.structureId),g+=1);let c=((h||a)&&oy({matchUpFilters:{matchUpStatuses:[Jm]},structure:n}).matchUps)??[],d=(a&&oy({matchUpFilters:{matchUpStatuses:[Jm]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:n}).matchUps)??[];if(c?.length){let i=d?d.map(xm):c.map(xm);for(let n of c)i.includes(n.matchUpId)&&(n.matchUpFormat=a?.length?s:void 0,Jf({tournamentId:r?.tournamentId,eventId:f?.eventId,context:t,drawDefinition:e,matchUp:n}))}}return!i.length&&e.matchUpFormat!==s&&(e.matchUpFormat=s,g+=1),i};for(let U of r?.events||[])if(!(y?.length&&!y.includes(U.eventId)||d&&d!==U.eventType||d===gu))if(Array.isArray(o)||Array.isArray(p)||I?.length||v?.length)for(let e of U.drawDefinitions||[]){if(Array.isArray(v)&&!v.includes(e.drawId))continue;Zf({structureIds:S(e),drawDefinition:e})}else U.matchUpFormat!==s&&(U.matchUpFormat=s,g+=1);return g?{..._r,modificationsCount:g}:{..._r,info:_o}}function tA({inheritance:e=!0,tournamentRecord:t,drawDefinition:i,matchUpId:r,event:n}){if(!i)return{error:Jr};let a=cw({drawDefinition:i,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:ca};let o=cw({inContext:!0,drawDefinition:i,matchUpId:r,event:n})?.matchUp,s=0;return(a?.sides||[]).forEach((e=>{e.lineUp&&delete e.lineUp})),(o?.sides||[]).forEach((r=>{if(s+=1,!1===e){let e=o?.tieFormat,t=r.participantId;e&&t&&bS({drawDefinition:i,participantId:t,lineUp:[],tieFormat:e})}Jf({tournamentId:t?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:i,matchUp:a})})),{..._r,modificationsCount:s}}function iA(e){let{matchUpFormat:t,matchUpStatus:i,winningSide:r,score:n,setTBlast:a}=e;if(!n)return{sets:[]};let o=n.sets||[],s=hD({winnerFirst:!1,matchUpFormat:t,matchUpStatus:i,setTBlast:a,sets:o}),c=hD({winnerFirst:!1,reversed:!0,matchUpFormat:t,matchUpStatus:i,setTBlast:a,sets:o}),d=hD({matchUpFormat:t,matchUpStatus:i,winningSide:r,setTBlast:a,sets:o}),u=s===d?c:s;return r&&(s=1===r?d:u,c=2===r?d:u),{score:{sets:o,scoreStringSide1:s,scoreStringSide2:c}}}function rA({sourceMatchUpStatusCodes:e,propagateExitStatus:t,sourceMatchUpStatus:i,loserParticipantId:r,tournamentRecord:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,event:c}){let d="progressExitStatus";Ly({matchUpId:o?.matchUpId,matchUpStatus:i,color:"magenta",method:d});let u=By(i)&&i!==Km&&i||Qm,l=gy({inContext:!0,drawDefinition:a,matchUpsMap:s})?.matchUps,p=u,m=l?.find((e=>e.matchUpId===o?.matchUpId));if(m?.matchUpId&&p){let i,s=m.matchUpStatusCodes?.map((e=>"string"==typeof e?e:"WO"))??[],u=m.sides?.find((e=>e.participantId===r));if(u?.sideNumber)if(1===m?.sides?.reduce(((e,t)=>t?.participantId?e+1:e),0)&&0===s.length)i=1===u.sideNumber?2:1,s[0]=e[0];else if(By(o.matchUpStatus)){let t=s[0];s[u.sideNumber-1]=e[0],s[(1===u.sideNumber?2:1)-1]=t,p=qm,i=void 0}else i=1===u.sideNumber?2:1,s[0]=e[0];return Qs({result:YC({matchUpStatus:p,matchUpId:o.matchUpId,matchUpStatusCodes:s,allowChangePropagation:!0,propagateExitStatus:t,tournamentRecord:n,drawDefinition:a,winningSide:i,event:c}),stack:d,context:{progressExitStatus:!0}})}return Qs({result:{error:sa},stack:d})}function nA(e){let t=dp(e,[{[Ll]:!0,[Pl]:!0}]);if(t.error)return t;let i=sh(e);if(!e.drawDefinition){let t=e.tournamentRecord??(e.tournamentId&&i[e.tournamentId]);e.tournamentRecord||(e.tournamentRecord=t);let r=JI({eventId:e.eventId,drawId:e.drawId,tournamentRecord:t});if(r.error)return r;r.drawDefinition&&(e.drawDefinition=r.drawDefinition),e.event=r.event}let{disableScoreValidation:r,propagateExitStatus:n,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:c,drawDefinition:d,matchUpId:u,schedule:l,event:p,notes:m}=e,f=e.matchUpFormat||e.outcome?.matchUpFormat,{policy:h}=Hh({policyType:Rp,tournamentRecord:o,event:p}),g=void 0!==e.allowChangePropagation&&e.allowChangePropagation||void 0!==h?.allowChangePropagation&&h.allowChangePropagation||void 0,{outcome:I,setTBlast:y}=e;if(I?.winningSide&&![1,2].includes(I.winningSide))return{error:Ca};if(f){let e=hN({tournamentRecord:o,drawDefinition:d,matchUpFormat:f,matchUpId:u,event:p});if(e.error)return e}if(I?.score?.sets&&!I.score.scoreStringSide1){let{score:e}=iA({...I,setTBlast:y});I.score=e,I.score.sets=I.score.sets.filter((e=>e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore))}let v=YC({matchUpStatusCodes:I?.matchUpStatusCodes,matchUpStatus:I?.matchUpStatus,winningSide:I?.winningSide,allowChangePropagation:g,disableScoreValidation:r,score:I?.score,propagateExitStatus:n,tournamentRecords:i,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:c,drawDefinition:d,matchUpFormat:f,matchUpId:u,schedule:l,event:p,notes:m});if(v.context?.progressExitStatus){let t=!0,i=0;for(;t&&i<10;){t=!1,i+=1;let r=rA({sourceMatchUpStatusCodes:v.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:v.context.sourceMatchUpStatus,loserParticipantId:v.context.loserParticipantId,propagateExitStatus:e.propagateExitStatus,tournamentRecord:e.tournamentRecord,loserMatchUp:v.context.loserMatchUp,matchUpsMap:v.context.matchUpsMap,drawDefinition:e.drawDefinition,event:e.event});r.context?.loserMatchUp&&(Object.assign(v.context,r.context),t=!0)}}return Qs({result:v,stack:"setMatchUpStatus"})}function aA(e){if(!e?.outcomes)return{error:va};if(!Array.isArray(e.outcomes))return{error:va,info:{outcomes:e.outcomes}};let t=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},i=e.outcomes??[],r=i.reduce(((e,t)=>e.includes(t.tournamentId)?e:e.concat(t.tournamentId)),[]);for(let n of r){let e=t[n];if(!e)return{error:zr};let r=i.filter((e=>e.tournamentId===n));if(r.length){let t=oA({outcomes:r,tournamentRecord:e});if(t.error)return t}}return{..._r}}function oA(e){let{tournamentRecords:t,tournamentRecord:i,outcomes:r,policyDefinitions:n}=e,a={};r.forEach((e=>{let{eventId:t}=e;a[t]||(a[t]=[]),a[t].push(e)}));for(let o of Object.keys(a)){let{event:e}=JI({tournamentRecord:i,eventId:o});for(let r of a[o]){let{drawId:a}=r,o=e?.drawDefinitions?.find((e=>e.drawId===a));if(o&&a){let{matchUpFormat:s,matchUpId:c}=r,d=nA({schedule:r?.schedule,tournamentRecords:t,policyDefinitions:n,tournamentRecord:i,drawDefinition:o,matchUpFormat:s,matchUpId:c,outcome:r,drawId:a,event:e});if(d.error)return d}}}return{..._r}}function sA(e){return function({drawDefinition:e,matchUpId:t,outcome:i,matchUp:r}){if(!r&&!e)return{error:Jr};if(!i)return{error:va,info:"missing outcome"};if(!r&&!t)return{error:sa};if(!r){let i=cw({drawDefinition:e,matchUpId:t});if(i.error)return i;r=i.matchUp}return"object"==typeof i&&i.score?.scoreStringSide1&&i.score?.scoreStringSide2?Vp({element:r,extension:{name:em,value:i}}):{error:Ho}}(e)}function cA(e){let t="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=e,a=dp(e,[{[Tl]:!0,[Ll]:!0}],t);if(a.error)return a;let o=cM(e,[{[Xl]:Hl}]);if(o[Yl])return o;let s=e.tournamentRecord?.tournamentId,{matchUp:c,structure:d}=o?.matchUp??{};if(!c?.tieMatchUps)return Qs({result:{error:ca},info:"Must be a TEAM matchUp",stack:t});if(!c.tieFormat)return{..._r};let u=Ug({structure:d,drawDefinition:i,event:r})?.tieFormat;if(!u)return Qs({result:{error:Qo},info:"No inherited tieFormat",stack:t});let l=[],p=[],m=[],f=[];for(let h of u.collectionDefinitions){let{matchUpCount:e,collectionId:t}=h;p.push(t);let i=(c.tieMatchUps||[]).filter((e=>e.collectionId===t));if(i.length>e)i.sort(((e,t)=>(e.matchUpStatus===Jm?1:0)-(t.matchUpStatus===Jm?1:0))),m.push(...i.slice(0,e)),l.push(...i.slice(3).map(xm));else if(m.push(...i),i.length<e){let t=ob({collectionDefinition:h,matchUpsLimit:e-i.length,matchUp:c,uuids:n});f.push(...t)}}for(let h of c?.tieMatchUps||[])h.collectionId&&!p.includes(h.collectionId)&&l.push(h.matchUpId);return f.length&&(m.push(...f),Kf({eventId:r?.eventId,matchUps:f,drawDefinition:i,tournamentId:s})),l.length&&Xf({matchUpIds:l,eventId:r?.eventId,drawDefinition:i,tournamentId:s}),c&&(c.tieMatchUps=m,c.tieFormatId=void 0,c.tieFormat=void 0,Jf({structureId:d?.structureId,eventId:r?.eventId,context:t,drawDefinition:i,tournamentId:s,matchUp:c})),{..._r,newMatchUps:f,deletedMatchUpIds:l}}function dA(e){let{tournamentRecord:t,drawDefinition:i,matchUpId:r,event:n}=e,a="resetScorecard";if(!i)return Qs({result:{error:Jr},stack:a});if(!r)return Qs({result:{error:ra},stack:a});if(!Mr(r))return Qs({result:{error:Ho,matchUpId:r},stack:a});let o=bg({drawDefinition:i}),{matchUps:s}=gy({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}),c=o.drawMatchUps.find((e=>e.matchUpId===r)),d=s?.find((e=>e.matchUpId===r));if(!c||!s)return{error:aa};if(c.matchUpType!==Iu)return{error:ca};let u=py({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:r}),l=d?.structureId,{structure:p}=lf({drawDefinition:i,structureId:l});if(Object.assign(e,{inContextDrawMatchUps:s,inContextMatchUp:d,matchUpsMap:o,targetData:u,structure:p,matchUp:c}),Zw(e))return{error:La};if(c.tieMatchUps?.length)for(let h of c.tieMatchUps){let e=YC({matchUpId:h.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:t,drawDefinition:i,event:n});if(e.error)return Qs({result:e,stack:a})}let m=Fh({tournamentRecord:t,drawDefinition:i,event:n})?.appliedPolicies,f=Uw({event:e.event,removeScore:!0,tournamentRecord:t,appliedPolicies:m,drawDefinition:i,matchUpsMap:o,matchUpId:r});if(f.error)return Qs({result:f,stack:a});if(e.tiebreakReset&&!f.tieFormatRemoved){let e=Ug({drawDefinition:i,structure:p,event:n})?.tieFormat;if(c.tieFormat&&e){let{matchUpCountDifference:a,descendantDifferences:o,ancestorDifferences:s,valueDifference:d}=ZN({descendant:c.tieFormat,ancestor:e});if(1===o.collectionIds.length&&!s.collectionIds.length&&!s.groupsCount&&1===a&&1===d){let e=cA({tournamentRecord:t,drawDefinition:i,matchUpId:r,event:n});if(e.error)return e}}}return{..._r}}function uA(e){let t=dp(e,[{[Pl]:!0,[Kl]:!0},{[ap]:{[kl]:!1,roundNumbers:!1},[tp]:"At least one must be provided",[rp]:Zl}]);if(t.error)return t;let i=jw(e);if(i.error)return i;let{matchUpIds:r}=i,n=yI(Iu)(e.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=e;for(let c of r){if(n){let t=dA({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:c,event:s});if(t.error||e.removeAssignments&&tA({inheritance:!1,drawDefinition:o,matchUpId:c}).error)return t}let t=YC({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:c,event:s});if(t.error)return t;if(e.removeAssignments){let t=fC({...e,matchUpId:c});if(t.error)return t}}return{..._r}}function lA(e){return function({tournamentRecord:e,drawDefinition:t,finishingOrder:i}){if(!t)return{error:Jr};let r="setOrderOfFinish";if(!Array.isArray(i))return Qs({info:SS("finishingOrder"),result:{error:Ho},stack:r});let{completedMatchUps:n,matchUpsMap:a}=Iy({inContext:!0,drawDefinition:t}),o=n?.map(xm)??[],s=i.map(xm),{matchUpTypes:c,roundNumbers:d,structureIds:u,matchUpTieIds:l}=(n??[]).filter((({matchUpId:e})=>s.includes(e))).reduce(((e,t)=>{let{matchUpTieId:i,matchUpType:r,roundNumber:n,structureId:a}=t;return e.matchUpTypes.includes(r)||e.matchUpTypes.push(r),e.roundNumbers.includes(n)||e.roundNumbers.push(n),e.structureIds.includes(a)||e.structureIds.push(a),e.matchUpTieIds.includes(i)||e.matchUpTieIds.push(i),e}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(c.length>1||l.length>1||d.length>1||u.length>1)return Qs({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Ho},stack:r});let p,m,f={},h=[],g=[];if(!i.every((({orderOfFinish:e,matchUpId:t})=>(h.push(t),e&&g.push(e),f[t]=e,p=o.includes(t),m=void 0===e||ir(e)&&Math.floor(e)>0,p&&m))))return Qs({result:{error:p?Ho:Jn},info:(p?!m&&"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed")||void 0,stack:r});let I=n?.filter((e=>e.structureId===u[0]&&e.roundNumber===d[0]&&e.matchUpType===c[0]&&e.matchUpTieId===l[0]&&!h.includes(e.matchUpId)));for(let y of I??[]){let{orderOfFinish:e}=y||{};if(e){if(!ir(e))return Qs({context:{orderOfFinish:e,matchUp:y},result:{error:Ho},stack:r});g.push(e)}}if(mr(g).length!==g.length||Math.max(...g)>g.length)return Qs({info:"Values not unique or greater than expected number of values",result:{error:Ho},stack:r});if(u.length){let i=cy({matchUpFilters:{matchUpIds:s},structureId:u[0],drawDefinition:t,matchUpsMap:a});if(i.error)return Qs({result:i,stack:r});i.completedMatchUps?.forEach((i=>{i.orderOfFinish=f[i.matchUpId],Jf({tournamentId:e.tournamentId,context:"setOrderOfFinish",drawDefinition:t,matchUp:i})}))}return{..._r}}(e)}function pA(e){let{tournamentRecord:t,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=e,o="applyLineUps",s=dp(e,[{[Tl]:!0,[Pl]:!0,[Ll]:!0},{lineUps:!0,[rp]:Zl}],o);if(s.error)return s;let c=t.participants||[],d=cw({tournamentParticipants:c,inContext:!0,drawDefinition:i,matchUpId:r});if(d.error)return d;if(!d.matchUp)return{error:aa};let{matchUp:u,structure:l}=d,{drawPositions:p,matchUpType:m}=u;if(m!==Gi)return{error:ca};if(!p?.length)return{error:cn};let f=Ug({matchUp:u,drawDefinition:i,structure:l,event:a})?.tieFormat,h={};for(let I of n){if(!Array.isArray(I))return{error:Ho,lineUp:I};let e={},i=[];for(let t of I){if("object"!=typeof t)return{error:Ho,lineUpAssignment:t};let{participantId:r,collectionAssignments:n=[]}=t;if(!Array.isArray(n))return{error:Ho,collectionAssignments:n};let a=c.find((e=>e.participantId===r));if(!a)return{error:Ya};if(a.participantType!==ph)return{error:$a};let o=u.sides?.find((e=>e.participant?.individualParticipantIds?.includes(r)))?.sideNumber;o&&i.push(o);for(let t of n){if("object"!=typeof t)return{error:Ho,collectionAssignment:t};let{collectionId:i,collectionPosition:n}=t,a=f?.collectionDefinitions?.find((e=>e.collectionId===i));if(!a)return{error:Ho,collectionId:i};let o=`${i}-${n}`;e[o]||(e[o]=[]);let s=e[o].length;if(yI(Bi)(a.matchUpType)&&s||a.matchUpType===ji&&s>1)return{info:"Excessive collectionPosition assignments",error:Ho};e[o].push(r)}}let r=Object.values(e);for(let s of r)if(2===s.length){let{participant:e}=ey({tournamentParticipants:c,participantIds:s});if(!e){let e=LM({participant:{participantType:fh,participantRole:Nv,individualParticipantIds:s},pairOverride:!0,tournamentRecord:t});if(e.error)return e}}let n=dr(i),a=((n[1]||0)>(n[2]||0)?1:(n[2]||0)>(n[1]||0)&&2)||void 0,o=Object.keys(h).map((e=>parseInt(e)));a&&!o.includes(a)&&(h[a]=I)}if(!Object.keys(h).length)return{error:Jo};if(d=cw({drawDefinition:i,matchUpId:r}),d.error)return d;if(!d.matchUp)return{error:aa};let{matchUp:g}=d;g.sides||(g.sides=[]);for(let I of[1,2]){let e=g.sides.find((e=>e.sideNumber===I)),t=h[I];t&&(e?e.lineUp=t:g.sides.push({lineUp:t,sideNumber:I}))}return Jf({tournamentId:t?.tournamentId,context:o,drawDefinition:i,matchUp:g}),{..._r}}var mA={};Oi(mA,{anonymizeTournamentRecord:()=>Ck,generate:()=>fA,generateEventWithDraw:()=>Ik,generateOutcome:()=>ok,generateOutcomeFromScoreString:()=>hA,generateParticipants:()=>QA,generateTournamentRecord:()=>Mk,modifyTournamentRecord:()=>Ok,mutate:()=>Rk});var fA={};function hA(e){let{matchUpFormat:t,matchUpStatus:i,winningSide:r,scoreString:n,setTBlast:a,preserveSideOrder:o=!1}=e;if(!n)return{outcome:{...lw,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:Ho,winningSide:r};let s=n&&rN({scoreString:n,matchUpFormat:t}),c=n?.trim().startsWith("["),d=function(e,t,i){if(e||!t||!i)return e;let r=Uc(t);return"A"===r?.setFormat?.based||"A"===r?.finalSetFormat?.based?function(e){let t=e.reduce(((e,t)=>((void 0!==t.side1Score||void 0!==t.side2Score)&&(e.side1+=t.side1Score??0,e.side2+=t.side2Score??0),e)),{side1:0,side2:0});return t.side1>t.side2?1:t.side2>t.side1?2:e.find((e=>void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore))?.winningSide}(i):function(e){let t={side1:0,side2:0};return e.forEach((e=>{1===e.winningSide?t.side1++:2===e.winningSide&&t.side2++})),t.side1>t.side2?1:t.side2>t.side1?2:void 0}(i)}(r,t,s),u=Uc(t),l=o||c||("A"===u?.setFormat?.based||"A"===u?.finalSetFormat?.based)?function(e,t,i){let r=rN({scoreString:e,matchUpFormat:t});return{sets:r,scoreStringSide1:hD({sets:r,matchUpFormat:t,setTBlast:i}),scoreStringSide2:hD({sets:r,reversed:!0,matchUpFormat:t,setTBlast:i})}}(n,t,a):function(e,t,i,r){let n=hD({sets:e,matchUpFormat:i,setTBlast:r}),a=hD({sets:e,reversed:!0,matchUpFormat:i,setTBlast:r});if("string"!=typeof n)return n;if("string"!=typeof a)return a;let o=2===t?a:n,s=2===t?n:a;return{sets:rN({scoreString:o,matchUpFormat:i}),scoreStringSide1:o,scoreStringSide2:s}}(s,d,t,a);return Js({outcome:{matchUpStatus:i,winningSide:d,score:l}})}function gA({matchUpScheduleTimes:e,matchUpDependencies:t,allDateMatchUpIds:i,matchUp:r}){let n=(t?.[r.matchUpId]?.matchUpIds||[]).filter((e=>i.includes(e))).filter((t=>!e[t]));return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function IA({individualParticipantProfiles:e,participantId:t}){e[t]||(e[t]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function yA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){let d=zc(c?.schedule?.endTime),u=d?id(d,zi(o)):id(s,zi(r)+zi(o)),l=i&&(d?id(zc(d),i):id(s,zi(r)+zi(i))),p=a?.[c.matchUpId]?.participantIds||[],m=(c.roundPosition&&e[c.matchUpId]||[]).flat();p.forEach((e=>{IA({individualParticipantProfiles:t,participantId:e});let i=t[e].priorMatchUpType!==c.matchUpType&&l||u;m.includes(e)?function({individualParticipantProfiles:e,recoveryValue:t,participantId:i,scheduleTime:r,drawId:n}){e[i].potentialRecovery[n]||(e[i].potentialRecovery[n]=[]),e[i].potentialRecovery[n].push(t),e[i].potentialBookings[n]||(e[i].potentialBookings[n]=[]),e[i].potentialBookings[n].push({timeAfterRecovery:t,scheduleTime:r})}({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:i,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=i,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:i}))})),IE({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:n,timeAfterRecovery:u,matchUp:c})}function vA({matchUpScheduleTimes:e,matchUpDependencies:t,scheduleTime:i,matchUpId:r,details:n}){let a,o=n.minutesMap?.[r]?.recoveryMinutes,s=id(i,(n.minutesMap?.[r]?.averageMinutes||0)+(o||0)),c=t?.[r]?.dependentMatchUpIds||[];if(c.length){let t=c.reduce(((t,i)=>{let r=e[i];if(!r)return t;let n={scheduleTime:r,matchUpId:i};return r&&!t.matchUpId||qc(r)<qc(t.scheduleTime)?n:t}),{});t.scheduleTime&&qc(s)>qc(t.scheduleTime)&&(a=t)}return{scheduledDependent:a}}Oi(fA,{generateEventWithDraw:()=>Ik,generateOutcome:()=>ok,generateOutcomeFromScoreString:()=>hA,generateParticipants:()=>QA,generateTournamentRecord:()=>Mk});var SA="DO_NOT_SCHEDULE",UA={DO_NOT_SCHEDULE:SA};function bA({averageMatchUpMinutes:e=90,requestConflicts:t={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=function(e){let{sides:t,matchUpType:i}=e||{};return(t||[]).map((e=>i===ji&&(e?.participant?.individualParticipants||[])||e?.participant&&[e.participant]||[])).flat()}(o).map((({person:e})=>e?.personId));if(i){let e=(o?.potentialParticipants||[]).flat().map((({person:e})=>e?.personId));s.push(...e)}let c=s.map((e=>r[e]?.map((t=>({...t,personId:e}))))).filter(Boolean).flat().filter((e=>e.requestType===SA&&ad(a,e.date))),d=[],u=o?.matchUpId,l=ed(zc(n),Yc(a)),p=zc(rd(l,e).toISOString());for(let m of c){let{requestId:e,startTime:i,endTime:r}=m;(n>i&&n<r||p&&p>i&&p<r)&&(d.push({matchUpId:u,request:m,scheduleTime:n}),t[e]?(t[e].scheduleTimes.includes(n)||t[e].scheduleTimes.push(n),t[e].matchUpIds.includes(u)||t[e].matchUpIds.push(u)):t[e]={request:m,scheduleTimes:[n],matchUpIds:[u]})}return{conflicts:d}}function wA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=oh(i),o=(e[i.matchUpId]||[]).filter((e=>!Sr(e,a))).flat();[...a,...o].forEach((e=>{if(IA({individualParticipantProfiles:t,participantId:e}),!t[e].potentialCounted[i.drawId]){let a=t[e].counters;a[n]?a[n]+=r:r>0&&(a[n]=r),a[TI]?a[TI]+=r:r>0&&(a[TI]=r),o.includes(e)&&(t[e].potentialCounted[i.drawId]=!0)}}))}function TA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:c,scheduleDate:d,minutesMap:u,matchUps:l}){let p=[];i||(n=l?.filter((e=>{let t=e.schedule||{},i="BYE"===e.matchUpStatus;return i&&p.push({tournamentId:e.tournamentId,matchUpId:e.matchUpId}),!i&&YE({schedule:t})&&(!d||e.schedule.scheduledDate===d)})),i=n.map(xm));let m=Array.isArray(c)?c.includes(d):c,f=m?[]:l.filter((({matchUpId:e})=>i.includes(e)));for(let h of f){wA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,value:1,matchUp:h});let i=h.schedule?.scheduledTime;if(i){o[h.matchUpId]=i;let n=u?.[h.matchUpId]?.recoveryMinutes;yA({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:n,scheduleTime:i,matchUp:h})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:m}}function DA({defaultRecoveryMinutes:e=0,averageMatchUpMinutes:t=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if("object"!=typeof r)return{error:Hr};if(!Pg(s)&&!Array.isArray(i))return{error:oa};a=a??HR({recoveryMinutes:e,averageMatchUpMinutes:t});let c=Object.assign({},...Object.values(r).map((e=>(e.events??[]).map((t=>{let{scheduleTiming:i}=zh({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:i}}})))).flat()),d={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]};i||(i=s?.filter((e=>{let t=e.schedule;return YE({schedule:t})&&(!o||e.schedule.scheduledDate===o)})));let u=i?.filter((e=>(!n.length||n.includes(e.schedule.venueId))&&"BYE"!==e.matchUpStatus));return{bookings:u?.map((({eventId:e,schedule:t,matchUpFormat:i})=>{let{event:r,scheduleTiming:n}=c[e],o=r?.eventType,s={...n,defaultTiming:d,matchUpFormat:i},{averageMinutes:u,recoveryMinutes:l}=xI({timingDetails:s,eventType:o}),{courtId:p,venueId:m}=t,f=zc(t.scheduledTime),h=id(f,u);return{recoveryMinutes:l,averageMinutes:u,periodLength:a,startTime:f,courtId:p,endTime:h,venueId:m}})).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function PA({calculateStartTimeFromCourts:e=!0,remainingScheduleTimes:t,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:c,startTime:d,venueIds:u,matchUps:l,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),"object"!=typeof a||!Object.keys(a).length)return{error:Hr};s=s??HR({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:f}=cE({dates:[c],ignoreDisabled:!0,tournamentRecords:a}),h=m?.filter((e=>!u||u.includes(e.venueId)))??[];d=d??YR({courts:h,scheduleDate:c,startTime:!0}),p=p??YR({courts:h,scheduleDate:c,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=DA({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:c,periodLength:s,venueIds:u,matchUps:l}),y={calculateStartTimeFromCourts:e,remainingScheduleTimes:t,averageMatchUpMinutes:r,clearScheduleDates:n,date:c,periodLength:s,startTime:d,bookings:g,endTime:p,courts:h},{scheduleTimes:v}=KR(y),S=1===u?.length&&u[0]||1===f?.length&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(Dy("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:v,venueId:S}}function NA({scheduledRoundsDetails:e,greatestAverageMinutes:t,garmanSinglePass:i}){let r,n,a,o,s=[],c=[];for(let d of e.filter(Boolean))o||(o=d.hash),(d.hash===o||i)&&(c=c.concat(d.matchUpIds)),d.hash,a=t,n=d.recoveryMinutes,r=d.roundPeriodLength;return c.length&&s.push({matchUpIds:c,roundPeriodLength:r,recoveryMinutes:n,averageMinutes:a}),{groupedRounds:s}}function EA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:c,periodLength:d,scheduleDate:u,useGarman:l,matchUps:p,courts:m,venues:f}){let h={},g=[],I=[],y=[];for(let v of f){let{rounds:f=[],venueId:S}=v,{scheduledRoundsDetails:U,greatestAverageMinutes:b,orderedMatchUpIds:w,minutesMap:T}=SE({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:c,periodLength:d,matchUps:p,rounds:f});y.push(...w??[]);let D,{groupedRounds:P}=NA({scheduledRoundsDetails:U,greatestAverageMinutes:b,garmanSinglePass:!0}),N=[];l&&({scheduleTimes:N,dateScheduledMatchUpIds:D}=PA({averageMatchUpMinutes:P[0]?.averageMinutes,scheduleDate:Yc(u),venueIds:[v.venueId],clearScheduleDates:s,tournamentRecords:c,periodLength:d,matchUps:p}));let E=TA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:D,greatestAverageMinutes:b,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:u,minutesMap:T,matchUps:p});({dateScheduledMatchUpIds:D}=E);let M=E,{byeScheduledMatchUpDetails:R,clearDate:C}=E;R?.length&&I.push(...R);let{matchUpsToSchedule:A,matchUpMap:k}=yE({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:D,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:w,clearDate:C,matchUps:p}),O=m.filter((e=>e.venueId===S));h[S]={previousRemainingScheduleTimes:[],courtsCount:O.length,greatestAverageMinutes:b,scheduledRoundsDetails:U,dateScheduledMatchUps:M,matchUpsToSchedule:A,scheduleTimes:N,groupedRounds:P,venueCourts:O,minutesMap:T,matchUpMap:k},s||g.push(...D)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:h,allDateMatchUpIds:y}}function MA({individualParticipantProfiles:e,matchUpNotBeforeTimes:t,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){let o=(i?.[n.matchUpId]?.participantIds||[]).flat(),s=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,c=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,d=o.every((t=>{IA({individualParticipantProfiles:e,participantId:t});let i=e[t];if(!i.timeAfterRecovery)return!0;let a=zc(n?.schedule?.endTime),o=a?id(a,zi(c)):id(r,zi(s)+zi(c));return![...Object.keys(i.potentialBookings).filter((e=>e!==n.drawId)).map((e=>i.potentialBookings[e])).flat(),...i.bookings].find((e=>function(e,t){let i=qc(e.scheduleTime),r=qc(e.timeAfterRecovery),n=qc(t.scheduleTime),a=qc(t.timeAfterRecovery),o=i>n&&i<a,s=n>i&&n<r,c=r>n&&r<a,d=a>i&&a<r;return Js({hasOverlap:i===n||r===a||o||c||s||d,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:d},!0)}({scheduleTime:r,timeAfterRecovery:o},e).hasOverlap))})),u=t[n.matchUpId],l=(u?td(ed(u),ed(r),!1):0)>=0;return{enoughTime:d&&l}}function RA({autoSchedulingAudit:e,tournamentRecords:t}){As({topic:bf,payload:e});let i=e=>e?Object.values(e).reduce(((e,t)=>e+t.length||0),0):0,r=(e?.schedulingProfile||[]).reduce(((e,t)=>e+t.venues.reduce(((e,t)=>e+t.rounds.length),0)),0),n={scheduledDatesCount:e.scheduledDates?.length,noTimeMatchUpIdsCount:i(e?.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(e?.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(e?.overLimitMatchUpIds),requestConflictsCount:i(e?.requestConflicts),profileRoundsCount:r},a={itemType:XM,itemValue:n};for(let o of Object.values(t)){let e=o.tournamentId;_s(bf)?As({payload:{type:XM,tournamentId:e,detail:n},topic:bf}):Nw({tournamentRecord:o,timeItem:a})}}function CA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=oh(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&e[a]||[]).flat(),c=ar(n.concat(...s));return c.forEach((e=>{IA({individualParticipantProfiles:t,participantId:e})})),{participantIdsAtLimit:c.filter((e=>{let r=t[e];if(r)return[o,TI].find((e=>{let t=r.counters?.[e]||0,n=i[e]||0;return t&&n&&t>=n}))})),relevantParticipantIds:c}}function AA({scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:t=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:c,matchUpIds:d,schedule:u}){if(!s)return{error:zr};if(!(c||d&&Array.isArray(d)))return{error:na};if(!(c||u&&"object"==typeof u))return{error:xo};let l,p=[],m=0;if(r&&!n){let e=Ey({tournamentRecords:o,tournamentRecord:s});n=e.matchUpDependencies,l=e.matchUps}l||(l=vy({tournamentRecord:s})?.matchUps??[]);let f=l.reduce(((i,r)=>{let{matchUpId:n,drawId:a,matchUpStatus:o}=r;return(t||"BYE"!==o)&&(e||!af.includes(o))&&(i[a]?i[a].push(n):i[a]=[n]),i}),{}),h=c?.map((e=>e.matchUpId));for(let g of Object.keys(f)){let{drawDefinition:e}=Jw({tournamentRecord:s,drawId:g});if(!e)continue;let t=f[g].filter((e=>d?.includes(e)??h?.includes(e))),I=by({inContext:!1,drawDefinition:e}).matchUps;for(let d of t){let t=jC({schedule:c?.find((e=>e.matchUpId===d))?.schedule||u,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:l,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:e,drawMatchUps:I,matchUpId:d});if(t?.warnings?.length&&p.push(...t.warnings),t?.success&&(m+=1),t.error)return t}}return p.length?{..._r,scheduled:m,warnings:p}:{..._r,scheduled:m}}function kA(e){let{scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:c,schedule:d}=e;if(e.matchUpIds&&!n)return AA(e);let u=dp(e,[{[bl]:!0},{[ap]:{matchUpContextIds:!1,matchUpDetails:!1},[ip]:Ho,[rp]:Zl}]);if(u.error)return u;if((!c||n)&&!d)return{error:va,info:"schedule is required"};let l=[],p=0,{matchUpDependencies:m}=Ey({tournamentRecords:o});for(let f of Object.values(o)){let{tournamentId:e}=f,u=n?.filter((t=>t.tournamentId===e)).map(xm),h=c?.filter((t=>t?.tournamentId===e));if(u?.length||h?.length){let e=AA({matchUpDetails:h,scheduleCompletedMatchUps:t,scheduleByeMatchUps:i,matchUpDependencies:m,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:f,checkChronology:s,matchUpIds:u,schedule:d});if(e.warnings?.length&&l.push(...e.warnings),e.scheduled&&(p+=e.scheduled),e.error)return e}}return l.length?{..._r,scheduled:p,warnings:l}:{..._r,scheduled:p}}function OA({averageMinutes:e,startTime:t,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:va,stack:"getEarliestCourtTime"};let a=YR({scheduleDate:n,courts:[r],startTime:!0}),o=YR({scheduleDate:n,courts:[r],endTime:!0});t=t||a,i=i||o;let s=AE({court:r,date:n}),{timeSlots:c}=GR({courtDate:s}),d=ed(t),u=ed(i);return{earliestCourtTime:c?.reduce(((t,i)=>{let r=ed(i.startTime),n=ed(i.endTime);if(r>u||n<d)return t;let a=d>r?d:r;if(td(a,n)>=e){let e=zc(a.toISOString());e&&(!t||e<t)&&(t=e)}return t}),void 0),courtStartTime:a,courtEndTime:o}}function xA(e){let{scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=af,scheduledDates:r,venueIds:n}=e,a=sh(e),o=Rr(a)?Object.values(a).map((({tournamentId:e})=>e)).filter(Boolean):[];if(!o?.length)return{error:Hr};let s=0;for(let c of o){let e=FA({ignoreMatchUpStatuses:i,scheduleAttributes:t,tournamentRecord:a[c],scheduledDates:r,venueIds:n});if(e.error)return e;s+=e.clearedScheduleCount??0}return{..._r,clearedScheduleCount:s}}function FA({scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:t=af,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if("object"!=typeof i)return{error:zr};if(!Array.isArray(t)||!Array.isArray(n))return{error:Ho};n.length&&e.push("venueId");let a=vy({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach((({matchUpStatus:i,schedule:r,drawId:a,matchUpId:s})=>{(!i||!t.includes(i))&&YE({schedule:r,scheduleAttributes:e})&&(!n?.length||n.includes(r.venueId))&&(o[a]||(o[a]=[]),o[a].push(s))}));let s=i.tournamentId,c=0;for(let d in o){let{event:e,drawDefinition:t}=JI({tournamentRecord:i,drawId:d}),r=by({drawDefinition:t,matchUpFilters:{matchUpIds:o[d]}}).matchUps??[];for(let i of r){let r=!1;i.timeItems=(i.timeItems??[]).filter((e=>{let t=e?.itemType&&![qg,Hg,Wg,zg,Yg,Jg].includes(e?.itemType);return t||(r=!0),t})),r&&(Jf({context:"clear schedules",eventId:e?.eventId,drawDefinition:t,tournamentId:s,matchUp:i}),c+=1)}}return{..._r,clearedScheduleCount:c}}function LA(e){let{checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:c,pro:d}=e,u=dp(e,[{[bl]:!0},{[ep]:e=>!e||Array.isArray(e)&&e.every(Fc),[Rl]:!1,[rp]:Zl}]);if(u.error)return u;let l=wE({tournamentRecords:a});if(l.error)return l;if(!l.schedulingProfile.length)return{..._r};let{modifications:p,issues:m=[],schedulingProfile:f=[]}=l,h=Object.assign({},...Object.values(a).map((e=>ah({tournamentRecord:e}).containedStructures))),g=n.map((e=>{if(Fc(e))return Yc(e)})).filter(Boolean),I=f.map((e=>e.scheduleDate)).map((e=>Fc(e)&&Yc(e))).filter((e=>e&&(!n.length||g.includes(e))));if(!I.length)return{error:ba};if(r&&!c){xA({tournamentRecords:a,scheduledDates:Array.isArray(r)?r:[]})}let y=cE({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:v}=Sy({matchUpFilters:{matchUpTypes:[Bi,ji]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:S}=Ey({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:v}),{matchUpDailyLimits:U}=tM({tournamentRecords:a}),{personRequests:b}=NE({requestType:SA,tournamentRecords:a}),w={schedulingProfileModifications:p,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:f.filter((e=>{let t=Yc(e?.scheduleDate);return I.includes(t)})).sort(((e,t)=>new Date(e.scheduleDate).getTime()-new Date(t.scheduleDate).getTime())),containedStructureIds:h,matchUpDependencies:S,matchUpDailyLimits:U,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:f,personRequests:b,periodLength:o,matchUps:v,dryRun:c,courts:y};return d?function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:c,tournamentRecords:d,periodLength:u=30,schedulingProfile:l,personRequests:p,matchUps:m=[],courts:f,dryRun:h}){let g={},I={},y={},v={},S={},U={},b={},w={},T={};for(let N of n??[]){let e=Yc(N?.scheduleDate),r=N?.venues||[],n={},l={},D=(e,t)=>{e.forEach((e=>{let i=l[e].counters;i[t]?i[t]+=1:i[t]=1,i[TI]?i[TI]+=1:i[TI]=1}))};g[e]={},I[e]={},U[e]=[],b[e]=[],w[e]=[],T[e]=[];let P={};m?.forEach((t=>{t.schedule?.scheduledDate&&ad(e,Yc(t.schedule.scheduledDate))&&IE({matchUpPotentialParticipantIds:n,matchUpNotBeforeTimes:P,matchUp:t})}));let E,{allDateScheduledByeMatchUpDetails:M,allDateScheduledMatchUpIds:R,venueScheduledRoundDetails:C,allDateMatchUpIds:A}=EA({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:P,matchUpScheduleTimes:S,matchUpDependencies:o,clearScheduleDates:c,tournamentRecords:d,periodLength:u,scheduleDate:e,matchUps:m,courts:f,venues:r}),k=m?.filter((({matchUpId:e})=>R.includes(e))),{bookings:O}=DA({dateScheduledMatchUps:k,tournamentRecords:d,scheduleDate:e,periodLength:u}),{virtualCourts:x}=qR({scheduleDate:e,periodLength:u,bookings:O,courts:f}),F=x?.reduce(((t,i)=>{let{earliestCourtTime:r,courtEndTime:n}=OA({date:e,averageMinutes:0,court:i});return(!t.startTime||ed(r)<ed(t.startTime))&&(t.startTime=r),(!t.endTime||ed(n)>ed(t.endTime))&&(t.endTime=n),t}),{}),L=F.startTime,_=({courtId:e,booking:t})=>x?.find((t=>t.courtId===e))?.dateAvailability[0].bookings.push(t),B=10,V=0;for(;!E;){for(let{venueId:i}of r){let r,a=C[i],c=a.matchUpsToSchedule.length,d=[],m=[],f=0;for(;!r;){for(let c of a.matchUpsToSchedule){if(m.length===a.courtsCount||d.length===a.courtsCount){r=!0;break}let{matchUpId:f,matchUpType:h}=c,{participantIdsAtLimit:U,relevantParticipantIds:w}=CA({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,matchUpDailyLimits:s,matchUp:c});if(U.length){b[e].includes(f)||b[e].push(f);continue}let{dependenciesScheduled:N,remainingDependencies:E}=gA({matchUpScheduleTimes:S,matchUpDependencies:o,allDateMatchUpIds:A,matchUp:c});if(!N){I[e][f]||(I[e][f]=[]),I[e][f].push({remainingDependencies:E});continue}let M=[],R=x?.reduce(((i,r)=>{if(m.includes(r.courtId))return i;let{earliestCourtTime:s}=OA({averageMinutes:a.greatestAverageMinutes,startTime:L,date:e,court:r});if(i.scheduleTime&&qc(s)>=qc(i.scheduleTime))return i;let{scheduledDependent:d}=vA({matchUpScheduleTimes:S,matchUpDependencies:o,scheduleTime:s,matchUpId:f,details:a});if(d)return i;let{enoughTime:u}=MA({individualParticipantProfiles:l,matchUpNotBeforeTimes:P,matchUpDependencies:o,scheduleTime:s,details:a,matchUp:c});if(!u)return g[e][f]||(g[e][f]=[]),g[e][f].includes(s)||g[e][f].push(s),i;let I=a.minutesMap?.[f]?.averageMinutes||a.greatestAverageMinutes,{conflicts:y}=bA({potentials:t,averageMatchUpMinutes:I,requestConflicts:T,personRequests:p,scheduleTime:s,scheduleDate:e,matchUp:c});if(y?.length)return M.push(...y),!1;D(w,h);let v=a.minutesMap?.[f]?.recoveryMinutes;return yA({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,matchUpNotBeforeTimes:P,averageMatchUpMinutes:I,matchUpDependencies:o,recoveryMinutes:v,scheduleTime:s,matchUp:c}),(!i.scheduleTime||qc(s)<qc(i.scheduleTime))&&(i.averageMatchUpMinutes=I,i.recoveryMinutes=v,i.scheduleTime=s,i.courtName=r.courtName,i.courtId=r.courtId),i}),{});if(R.scheduleTime){let{averageMatchUpMinutes:e,recoveryMinutes:t,scheduleTime:r,courtId:n}=R;S[f]=r,v[f]=n,d.push(f),m.push(n);let o=r,s=id(o,e);_({courtId:n,booking:{averageMatchUpMinutes:e,recoveryMinutes:t,periodLength:u,matchUpId:f,startTime:o,courtId:n,endTime:s,venueId:i}}),a.matchUpsToSchedule=a.matchUpsToSchedule.filter((e=>e.matchUpId!==f))}else M?.length&&(y[e]||(y[e]=[]),y[e].push(...M))}(m.length===a.courtsCount||d.length===a.courtsCount||!a.matchUpsToSchedule.length)&&(r=!0),a.matchUpsToSchedule.length&&d<a.courtsCount&&(ed(L)<ed(F.endTime)?L=id(L,u):(r=!0,a.complete=!0)),f+=1,!r&&f>=c&&(r=!0)}a.matchUpsToSchedule?.length||(a.complete=!0)}V+=1,E=r.every((({venueId:e})=>C[e].complete))||V===B}for(let{venueId:t}of r){let i=C[t].matchUpMap;Object.keys(i).forEach((t=>{let r=d[t];r&&Object.keys(i[t]).forEach((n=>{let{drawDefinition:a}=Jw({tournamentRecord:r,drawId:n});a&&i[t][n].forEach((({matchUpId:t})=>{let i=S[t],n=v[t];if(i){let o=i.split(":").map(nd).join(":"),s=`${Yc(e)}T${o}`;h||(OC({drawDefinition:a,scheduledTime:s,matchUpId:t}),BC({courtDayDate:e,tournamentRecords:d,tournamentRecord:r,drawDefinition:a,matchUpId:t,courtId:n})),U[e].push(t)}}))}))})),w[e]=C[t].matchUpsToSchedule.map(xm)}!h&&M?.length&&kA({matchUpDetails:M,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:d,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of N.venues)for(let i of t.rounds){let t=(i.matchUps??[]).map((({matchUpId:e})=>e))?.filter((t=>U[e].includes(t)));i.canScheduledMatchUpIds=t;let r=Math.round((t?.length||0)/i.matchUpsCount*1e4)/100;(r===1/0||isNaN(r))&&(r=void 0),i.possibleToSchedulePct=r,i.matchUpsCount===t?.length&&(i.possibleToSchedule=!0)}}let D=(n??[]).map((({scheduleDate:e})=>e)),P={timeStamp:Date.now(),overLimitMatchUpIds:b,scheduledMatchUpIds:U,schedulingProfile:l,noTimeMatchUpIds:w,requestConflicts:T,scheduledDates:D};return RA({tournamentRecords:d,autoSchedulingAudit:P}),{..._r,schedulingProfileModifications:e,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:S,overLimitMatchUpIds:b,scheduledMatchUpIds:U,noTimeMatchUpIds:w,requestConflicts:T,scheduledDates:D}}(w):function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:c,tournamentRecords:d,schedulingProfile:u,personRequests:l,periodLength:p,matchUps:m,courts:f,dryRun:h}){let g={},I={},y={},v={},S={},U={},b={},w={},T={},D={};for(let E of n){let e=Yc(E?.scheduleDate),r=E?.venues||[],n={},u={},P=(e,t)=>{e.forEach((e=>{let i=u[e].counters;i[t]?i[t]+=1:i[t]=1,i[TI]?i[TI]+=1:i[TI]=1}))};y[e]={},v[e]={},g[e]={},I[e]={},b[e]=[],w[e]=[],T[e]=[],D[e]=[];let N={};m.forEach((t=>{t.schedule?.scheduledDate&&ad(e,Yc(t.schedule.scheduledDate))&&IE({matchUpPotentialParticipantIds:n,matchUpNotBeforeTimes:N,matchUp:t})}));let M,{allDateScheduledByeMatchUpDetails:R,venueScheduledRoundDetails:C,allDateMatchUpIds:A}=EA({matchUpPotentialParticipantIds:n,individualParticipantProfiles:u,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:N,matchUpScheduleTimes:U,matchUpDependencies:o,clearScheduleDates:c,tournamentRecords:d,useGarman:!0,periodLength:p,scheduleDate:e,matchUps:m,courts:f,venues:r}),k=10,O=0,x=10;for(;!M;){for(let{venueId:i}of r){let r=0,a=C[i];for(;a.courtsCount&&a.scheduleTimes?.length&&a.matchUpsToSchedule?.length&&r<=a.courtsCount;){let{scheduleTime:c,attempts:d=0}=a.scheduleTimes.shift(),p=a.matchUpsToSchedule.find((i=>{let{matchUpId:r,matchUpType:d}=i,{participantIdsAtLimit:p,relevantParticipantIds:m}=CA({matchUpPotentialParticipantIds:n,individualParticipantProfiles:u,matchUpDailyLimits:s,matchUp:i});if(p.length)return w[e].includes(r)||w[e].push(r),!1;let{scheduledDependent:f}=vA({matchUpScheduleTimes:U,matchUpDependencies:o,scheduleTime:c,matchUpId:r,details:a});if(f)return!1;let{dependenciesScheduled:h,remainingDependencies:g}=gA({matchUpScheduleTimes:U,matchUpDependencies:o,allDateMatchUpIds:A,matchUp:i});if(!h)return v[e][r]||(v[e][r]=[]),v[e][r].push({scheduleTime:c,remainingDependencies:g}),!1;let{enoughTime:I}=MA({individualParticipantProfiles:u,matchUpNotBeforeTimes:N,matchUpDependencies:o,scheduleTime:c,details:a,matchUp:i});if(!I)return y[e][r]||(y[e][r]=[]),y[e][r].push({scheduleTime:c}),!1;let b=a.greatestAverageMinutes,{conflicts:T}=bA({potentials:t,averageMatchUpMinutes:b,requestConflicts:D,personRequests:l,scheduleTime:c,scheduleDate:e,matchUp:i});if(T?.length)return S[e]||(S[e]=[]),S[e].push(...T),!1;P(m,d);let E=a.minutesMap?.[r]?.recoveryMinutes;return yA({matchUpPotentialParticipantIds:n,individualParticipantProfiles:u,matchUpNotBeforeTimes:N,averageMatchUpMinutes:b,matchUpDependencies:o,recoveryMinutes:E,scheduleTime:c,matchUp:i}),U[r]=c,!0}));a.matchUpsToSchedule=a.matchUpsToSchedule.filter((({matchUpId:e})=>e!==p?.matchUpId)),p?r+=1:(I[e][i]||(I[e][i]=[]),I[e][i].push({scheduleTime:c,attempts:d+1}))}a.matchUpsToSchedule?.length&&(I[e][i]=I[e][i]?.filter((e=>{let t=e.attempts<k;return t&&a.scheduleTimes.push(e),!t}))),(!a.scheduleTimes?.length||!a.matchUpsToSchedule?.length)&&(a.complete=!0)}O+=1,M=r.every((({venueId:e})=>C[e].complete))||O===x}for(let{venueId:t}of r){let i=C[t].matchUpMap;Object.keys(i).forEach((r=>{let n=d[r];n&&Object.keys(i[r]).forEach((a=>{let{drawDefinition:o}=Jw({tournamentRecord:n,drawId:a});o&&i[r][a].forEach((({matchUpId:i})=>{let r=U[i];if(r){let a=r.split(":").map(nd).join(":"),s=`${Yc(e)}T${a}`;h?b[e].push(i):(OC({drawDefinition:o,scheduledTime:s,matchUpId:i}).success&&b[e].push(i),t&&_C({tournamentRecord:n,drawDefinition:o,matchUpId:i,venueId:t}))}}))}))})),T[e]=C[t].matchUpsToSchedule.map(xm),g[e][t]=C[t].scheduleTimes.sort(((e,t)=>qc(e.scheduleTime)-qc(t.scheduleTime)))}!h&&R?.length&&kA({matchUpDetails:R,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:d,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of E.venues)for(let i of t.rounds){let t=(i.matchUps?.map((({matchUpId:e})=>e))||[]).filter((t=>b[e].includes(t)));i.canScheduledMatchUpIds=t;let r=Math.round(t.length/i.matchUpsCount*1e4)/100;(r===1/0||isNaN(r))&&(r=0),i.possibleToSchedulePct=r,i.matchUpsCount===t.length&&(i.possibleToSchedule=!0)}}let P=n.map((({scheduleDate:e})=>e)),N={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:b,schedulingProfile:u,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P};return RA({tournamentRecords:d,autoSchedulingAudit:N}),{..._r,schedulingProfileModifications:e,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:I,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:U,overLimitMatchUpIds:w,scheduledMatchUpIds:b,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P}}(w)}function _A(e){let{tournamentRecord:t,tournamentRecords:i,activeTournamentId:r,...n}=e||{};return n.tournamentId||(n.tournamentId=Ud()),(!n.startDate||Gc(n.startDate)||Mc.test(n.startDate))&&(!n.endDate||Gc(n.endDate)||Mc.test(n.endDate))?(n.extensions&&(n.extensions=n.extensions.filter(Bp)),{...n}):{error:Pa}}function BA({addParticipants:e=!0,participantAttribute:t,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){if(!i)return{error:zr};let s={},c=(i.participants??[]).filter((({participantType:e,participantRole:t})=>e===ph&&t===Nv)),d=0;for(let f of c){let e=a&&wy({element:f,accessor:a})?.value||r&&f.person?.[r]||t&&f[t];if(e){if(!Object.keys(s).includes(e)){s[e]={participantName:n?.[d]??e,participantId:o?.pop()??Ud(),individualParticipantIds:[],participantRole:Nv,participantType:hh};let i={value:r??t,name:cm};Vp({element:s[e],extension:i}),d+=1}s[e].individualParticipantIds.push(f.participantId)}}let u=Object.keys(s),l=(i.participants??[]).map((e=>{if(e.participantType!==hh||e.participantRole!==Nv)return;let{extension:t}=Jp({name:cm,element:e}),i=t?.value;return u.includes(i)?e.participantId:void 0})).filter(Boolean),p=0,m=[];return Object.keys(s).forEach((t=>{let r=s[t],{participantId:n}=r;l.includes(n)||(i.participants||(i.participants=[]),e&&i.participants.push(r),m.push(r),p++)})),e&&p?(As({payload:{tournamentId:i.tournamentId,participants:m},topic:yf}),{..._r,participantsAdded:p}):m.length?{..._r,newParticipants:m}:{error:Aa}}var VA=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],jA=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function $A({count:e=1,participantsCount:t=32}={}){let i=sr(jA),r=i.slice(0,e);return{cities:gr(0,t).map((t=>t<Math.min(e,i.length)?r[t]:hr(r)))}}function GA({count:e=1,participantsCount:t=32}={}){let i=sr(VA),r=i.slice(0,e).map((e=>Object.keys(e))).flat();return{states:gr(0,t).map((t=>t<Math.min(e,i.length)?r[t]:hr(r)))}}function WA({count:e=1,participantsCount:t=32}={}){let i=gr(0,e).map((()=>gr(0,5).map((()=>tr(0,9))).join("")));return{postalCodes:gr(0,t).map((t=>t<e?i[t]:hr(i)))}}function qA({idPrefix:e,participantType:t,index:i,uuids:r}){let n=Mr(t)?t[0]:"X";return e?`${e}-${n}-${i}`:r?.pop()||Ud()}function HA(e){let{cities:t,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=e;return{postalCode:r?.[a],state:i?.[a],city:t?.[a],countryCode:n}}var zA={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function YA(e){let{count:t=100,sex:i}=e||{};if(!t||i&&!dc(i))return{personData:[],error:Ho};let r=Math.ceil(1.3*t),{lastNames:n,firstFemale:a,firstMale:o}=zA,s=Sh.map((({iso:e})=>e)).filter(Boolean),c=Math.ceil(r/n.length),d=Math.ceil(r/a.length),u=Math.ceil(r/o.length),l=gr(0,c).flatMap((()=>{let e=yd(n,!1,!0);return gr(0,n.length).map((()=>fr(e)))})),p=gr(0,d).flatMap((()=>{let e=yd(a,!1,!0);return gr(0,a.length).map((()=>fr(e)))})),m=gr(0,u).flatMap((()=>{let e=yd(o,!1,!0);return gr(0,o.length).map((()=>fr(e)))})),f={};for(let h=0;h<r;h++){let e=l.pop(),t=i||hr([ic,Zs]),r=t===ic?m.pop():p.pop(),n=hr(s);f[`${r}${e}`]={nationalityCode:n,sex:t,firstName:r,lastName:e}}return{personData:Object.values(f).slice(0,t)}}function KA(e){let t=e?.count||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:c}=e||{};if(Number.isNaN(Number(t)))return{error:Ho};let d=a?.[ic]||ac(c)&&t||0,u=a?.[Zs]||nc(c)&&t||0;t=Math.max(t,d+u);let l=t-(d+u),p=[...d&&YA({count:d,sex:ic}).personData||[],...u&&YA({count:u,sex:Zs}).personData||[],...l&&YA({count:l}).personData||[]],m=p.filter((e=>!c||d&&u||e.sex===c)),f=[];if(Array.isArray(o)){let e=o.filter((e=>!("string"!=typeof e.firstName||"string"!=typeof e.lastName||e.sex&&![ic,Zs].includes(e.sex)||e.nationalityCode&&("string"!=typeof e.nationalityCode||e.nationalityCode.length>3||!Sh.some((({iso:t,ioc:i})=>[t,i].includes(e.nationalityCode)))))&&(e.nationalityCode&&f.push(e.nationalityCode),!0)));if(!e.length)return{error:Ho};m=e}let h=o?m:sr(m);if(h.length<t){let{maleFirstNames:e,maleLastNames:i,femaleFirstNames:r,femaleLastNames:n,nationalityCodes:a}=p.reduce(((e,t)=>{let{firstName:i,lastName:r,nationalityCode:n}=t;return t.sex===ic?(e.maleFirstNames.includes(i)||e.maleFirstNames.push(i),e.maleLastNames.includes(r)||e.maleLastNames.push(r)):(e.femaleFirstNames.includes(i)||e.femaleFirstNames.push(i),e.femaleLastNames.includes(r)||e.femaleLastNames.push(r)),e.nationalityCodes.includes(n)||e.nationalityCodes.push(n),e}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});gr(0,t-h.length).forEach((()=>{let t=c||hr([ic,Zs]),o=hr(a),s={firstName:hr(t===ic?e:r),lastName:hr(t===ic?i:n),sex:t,nationalityCode:o};h.push(s)}))}let{ageMinDate:g,ageMaxDate:I}=dd({consideredDate:r,category:s}),y=zi(g?.slice(0,4)||0)||zi(I?.slice(0,4)||0)-3,v=zi(I?.slice(0,4)||0)||zi(g?.slice(0,4)||0)+3,S=(g||I)&&[y,v],U=h.slice(0,t).map(((e,t)=>{let[r,a]=S||[],o=S&&fr(gr(r,a)),s=fr(gr(0,365)),c=o&&function(e,t,i){let r=new Date(e,0);return _c(new Date(r.setDate(t)),i)}(o,s);return Object.assign(Js({extensions:i||[{name:"regionCode",value:t+1}],birthDate:c,isMock:n}),e)}));return{persons:U.length&&U||h[0],nationalityCodes:f}}var XA=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function JA({nameRoot:e="TEAM",count:t=1}={}){let i=sr(XA).slice(0,t);return i.length<t&&gr(0,t-i.length).forEach((t=>i.push(`${e} ${t+1}`))),{names:i}}function QA(e){let{scaledParticipantsCount:t,rankingRange:i}=e,{ratingsParameters:r=kb,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:c,nationalityCodesCount:d,nationalityCodeType:u,nationalityCodes:l,participantsCount:p=32,participantType:m,teamSize:f=8,personIds:h,idPrefix:g,uuids:I,personExtensions:y,addressProps:v,gendersCount:S,matchUpType:U,personData:b,sex:w,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:N}=e,E=m===fh||U===Vi,M=m===hh||U===hh;i&&(!Array.isArray(i)||!i.every((e=>Qi(e)))||2!==i.length)&&(i=void 0),t=N?p:t;i=i||[1,t&&t>1e3?t:1e3],i[1]+=1;let R=p*((E?2:M&&(f??8))||1),C=KA({count:R,personExtensions:y,consideredDate:o,gendersCount:S,personData:b,category:c,sex:w});if(C.error)return C;let{nationalityCodes:A,persons:k}=C,O={},x={},F={},L={},_=e=>{Object.assign(O,e.doublesRankings),Object.assign(x,e.singlesRankings),Object.assign(L,e.doublesRatings),Object.assign(F,e.singlesRatings)};if(Rr(c)){let e=ek({scaledParticipantsCount:t,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:c});_(e)}Array.isArray(s)&&s.forEach((e=>{let n=ek({scaledParticipantsCount:t,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:e});_(n)}));let B=Sh.filter((e=>"IOC"===u&&e.ioc||e.iso));let{postalCodesProfile:V,postalCodesCount:j,statesProfile:$,citiesProfile:G,citiesCount:W,statesCount:q}=v||{},H=e=>Object.keys(e).map((e=>gr(0,$[e]).map((()=>e)))).flat(),z={cities:G&&H(G)||v?.cities||$A({count:W||R,participantsCount:R}).cities,states:$&&H($)||v?.states||GA({count:q||R,participantsCount:R}).states,postalCodes:V&&H(V)||v?.postalCodes||WA({count:j||R,participantsCount:R}).postalCodes},Y=function(e){let t=Math.ceil(R/e);return n&&t>n?Math.ceil(R/n):e}(d),K=Y?sr(B).slice(0,d):l&&B.filter((e=>l.includes(e.iso)))||B,X=sr(gr(0,Math.ceil(R/(Y||1))).map((()=>K)).flat(1/0)),J=JA({count:p}).names;return{participants:gr(0,p).map((e=>{let t=(E?2:M&&(f??8))||1,i=gr(0,t).map((i=>function(e){let t=k[e],{nationalityCode:i,participantExtensions:r,participantTimeItems:n,extensions:a,firstName:o,birthDate:d,lastName:l,personId:p,sex:m}=t||{},f=o||"GivenName",y=l||"FamilyName",v=`${f} ${y}`,S=X[e],U=A?.length&&i||S&&("IOC"===u?S.ioc||S.iso:S.iso||S.ioc)||i;X?.length&&!U&&!i&&console.log("%c Invalid Nationality Code",{participantIndex:e,country:S});let b=HA({...z,participantIndex:e,nationalityCode:U}),w=Js({participantId:qA({participantType:ph,index:e,idPrefix:g,uuids:I}),extensions:r,timeItems:n,participantRole:Nv,participantType:ph,participantName:v,person:{personId:p||h?.length&&h[e]||Ud(),birthDate:Fc(d)?d:void 0,addresses:[b],standardFamilyName:y,standardGivenName:f,nationalityCode:U,extensions:a,sex:m}});if(P&&U){let e=Sh.find((({iso:e})=>e===U));e?.ioc&&(w.person.iocNationalityCode=e.ioc),e?.label&&(w.person.countryName=e.label)}if(D&&U){let e=Sh.find((({iso:e})=>e===U));e?.iso2&&(w.person.iso2NationalityCode=e.iso2),e?.label&&(w.person.countryName=e.label)}let T=t=>{let i=t.categoryName||t.ratingType||t.ageCategoryCode,r=x[i]?.[e],n=O[i]?.[e];ZA({scaleValue:r,eventType:mu,scaleType:pp,participant:w,category:t}),ZA({scaleValue:n,eventType:hu,scaleType:pp,participant:w,category:t});let a=F[i]?.[e],o=L[i]?.[e];ZA({scaleValue:a,eventType:mu,scaleType:mp,participant:w,category:t}),ZA({scaleValue:o,eventType:hu,scaleType:mp,participant:w,category:t})};return Array.isArray(s)?s.forEach((e=>T(e))):c&&T(c),w}(e*t+i))),r=i.map((e=>e.participantId)),n=i.map((e=>e.person.standardFamilyName)).join("/"),a=E?fh:hh,o={participantId:qA({participantType:a,index:e,idPrefix:g,uuids:I}),participantName:E?n:J[e],participantRole:Nv,individualParticipantIds:r,participantType:a};return T&&(o.individualParticipants=i),E||M?[o,...i]:i})).flat(),..._r}}function ZA({scaleValue:e,participant:t,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o={itemValue:e,itemType:[fp,r,i,a].join(".")};a&&e&&(t.timeItems||(t.timeItems=[]),t.timeItems.push(o))}function ek(e){let{category:t,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=e,o=t.rankingRange||e.rankingRange||[1,1e3],s={},c={},d={},u={},{categoryName:l,ageCategoryCode:p,ratingType:m}=t,f=t.categoryName||t.ratingType||t.ageCategoryCode;if((l||p)&&!m){let[e,t]=o||[];if(c[f]=sr(gr(e,t)).slice(0,i||tr(20,30)),[fh,hh].includes(n)){let[e,t]=o||[];s[f]=sr(gr(e,t)).slice(0,i||tr(20,30))}}if(m&&r[m]){let{ratingMax:e,ratingMin:o,ratingAttributes:s}=t,c={...r[m],...s||{}},{attributes:l={},decimalsCount:p,accessors:h,range:g,step:I}=c,y=e=>{let t={},i=Object.keys(e||{});for(let r of i){let i=e[r];if("object"==typeof i&&i.generator){let{range:e}=i,[n,a]=e.slice().sort();t[r]=tr(n,a)}else t[r]=i}return t},v=g[0]>g[1]?2:.7,[S,U]=g.slice().sort(),b=gr(0,2e3).map((()=>rr(S,U,v,I,p))).filter((t=>(!e||t<=e)&&(!o||t>=o))).slice(0,i||tr(20,30)).map((e=>h?Object.assign({},...h.map((t=>({[t]:e}))),y(l)):e));d[f]=[...a,...b],[fh,hh].includes(n)&&(u[f]=[...a,...b])}return{singlesRankings:c,doublesRankings:s,singlesRatings:d,doublesRatings:u}}function tk(e){let{alternatesCount:t=0,tieFormatName:i,drawSize:r}=e,n=0,a=0,o=0,s=0,c={},d={[ic]:0,[Zs]:0,[tc]:0,[ec]:0,ANY:0};(Rr(e.tieFormat)?e.tieFormat:lu({namedFormat:i}))?.collectionDefinitions?.filter(Boolean).forEach((e=>{let{category:t,collectionId:i,matchUpType:r,matchUpCount:u,gender:l}=e;if(dc(l)){let e=cc(l),t=u*(r===ji?2:1);e&&d[e]<t&&(d[e]=t)}else oc(l)&&(d[ic]<u&&(d[ic]=u),d[Zs]<u&&(d[Zs]=u));if(t){let e=JSON.stringify(t);c[e]=t}if(i||(e.collectionId=Ud()),yI(ji)(r)){let e=u;s+=u,n=Math.max(n,e)}if(yI(Bi)(r)){let e=u;o+=u,a=Math.max(a,e)}}));let u=Object.keys(c).length?Math.max(o,2*s):Math.max(a,2*n);return{maxDoublesDraw:n*(r+t),maxSinglesDraw:a*(r+t),teamSize:u,genders:d}}function ik({participantsProfile:e,tournamentRecord:t,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){if(0===e?.participantsCount)return{addedCount:0,..._r};let{participantsCount:o,participantType:s,largestTeamDraw:c,largestTeamSize:d,gendersCount:u}=function({participantsProfile:e,eventProfiles:t,drawProfiles:i}){let{participantsCount:r,participantType:n=ph}=e||{},a=r||0,o={[Zs]:0,[tc]:0,[ec]:0,[ic]:0,ANY:0},s=0,c=0,d=0,u=0,l=0,p=({alternatesCount:e=0,uniqueParticipants:t,tieFormatName:i,drawSize:r=0,eventType:n,tieFormat:a,category:p,gender:m,stage:f})=>{let h=n===fu,g=!!(t||f===Su||p||m);if(n===gu){u=Math.max(u,r+e),a="object"==typeof a?a:lu({namedFormat:i});let{teamSize:t,maxDoublesDraw:n,maxSinglesDraw:l,genders:p}=tk({alternatesCount:e,tieFormatName:i,tieFormat:a,drawSize:r});d=Math.max(d,t),c=Math.max(c,l),g||(s=Math.max(s,n)),Object.keys(p).forEach((e=>o[e]+=p[e]))}else if(h)if(g){let t=2*(r+e);l+=t,m&&(o[m]+=t)}else r+e&&r+e>s&&(s=r+e);else if(g){let t=r+e;m&&(o[m]+=t),l+=t}else r&&r>c&&(c=r+e)};if(t?.forEach((e=>{let{tieFormatName:t,tieFormat:i,drawProfiles:r,eventType:n,category:a,gender:o}=e;if(r)for(let s of r){let{tieFormatName:e,tieFormat:r}=s;p({...s,tieFormatName:e||t,tieFormat:r||i,eventType:n,category:a,gender:o})}})),Array.isArray(i))for(let f of i)p(f);let m=Math.max(u*d,2*s,c);return s&&(n=fh),(r||a)<m&&(r=m),r&&s&&[fh,gu].includes(n)&&(c&&Math.floor(c/2)>s?r=Math.floor(c/2):(!c||2*s>=c)&&(r=Math.ceil(r/2))),void 0===r&&(r=t?.length||i?.length?0:32),r<a&&(r=a),{uniqueParticipantsCount:l,participantsCount:r,largestTeamDraw:u,largestTeamSize:d,participantType:n,gendersCount:o}}({participantsProfile:e,eventProfiles:i,drawProfiles:r}),l=e?.teamKey,p=QA({consideredDate:n,...e,participantsCount:o,participantType:s,gendersCount:u,uuids:a}).participants,m=0,f=_M({tournamentRecord:t,participants:p});if(f.error)return f;if(m+=f.addedCount,l){let e=BA({tournamentRecord:t,...l});if(e.error)return e}let h=p.filter((({participantType:e})=>e===ph)).map(Om),g=e?.idPrefix?`${hh}-${e.idPrefix}`:void 0;return f=_M({participants:gr(0,c).map((e=>{let t=h.slice(e*d,(e+1)*d),i=qA({index:e,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${e+1}`,participantRole:Nv,individualParticipantIds:t,participantType:hh,participantId:i}})),tournamentRecord:t}),f.error?f:(m+=f.addedCount,{addedCount:m,..._r})}function rk({drawProfiles:e,category:t,gender:i}){let r={},n=e?.reduce(((e,n)=>{let{qualifyingPositions:a=0,participantsCount:o=0,uniqueParticipants:s,stage:c=vu,drawSize:d=0}=n||{};Object.keys(e).includes(c)||(e[c]=0);let u=(o||d)-a;return s||i||t||c===Su?(Object.keys(r).includes(c)||(r[c]=0),r[c]+=u):e[c]=Math.max(e[c],u),e}),{}),a=Object.keys(r);return a.forEach((e=>n[e]+=r[e])),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function nk({allUniqueParticipantIds:e,stageParticipantsCount:t,eventParticipantType:i,targetParticipants:r}){let n=t[vu]||0,a=t[Su]||0;return{stageParticipants:{QUALIFYING:r?.filter((({participantType:e})=>e===i)).filter((({participantId:t})=>!e.includes(t))).slice(0,a),MAIN:r?.filter((({participantType:e})=>e===i)).filter((({participantId:t})=>!e.includes(t))).slice(a,a+n)}}}var ak={[Qm]:2,[qm]:1,[Wm]:1,[Km]:1,[Gm]:4};function ok(e){let{defaultWithScorePercent:t=2,winningSide:i}=e,{matchUpStatusProfile:r=ak,matchUpFormat:n=Ad,pointsPerMinute:a=1,sideWeight:o=4}=e;if(!Ec({matchUpFormat:n}))return{error:Zn};if("object"!=typeof r)return{error:Ho};if(t>100&&(t=100),Number.isNaN(Number(t))||Number.isNaN(Number(a))||Number.isNaN(Number(o)))return{error:Ho};let s=Object.keys(r).filter((e=>Object.keys(cf).includes(e)&&e!==jm));if(Object.keys(s).reduce(((e,t)=>e+r[t]),0)>100)return{error:Ho,matchUpStatusProfile:r};let c=s.reduce(((e,t)=>(e.pointer=e.pointer+r[t],e.valueMap.push([e.pointer,t]),e)),{pointer:0,valueMap:[]}),d=tr(1,100),u=(c.valueMap.find((e=>d<=e[0]))??[100,jm])[1],l={sets:[],scoreStringSide1:"",side2ScoreString:""};if(By(u)){i=i||tr(1,2);let e={score:l,matchUpStatus:u,winningSide:i};if(!(u===Gm&&tr(1,100)>100-t))return{outcome:e}}else if([qm,Wm].includes(u))return{outcome:{score:l,matchUpStatus:u}};let p,m=Uc(n),{bestOf:f=1,exactly:h,setFormat:g,finalSetFormat:I}=m??{},y=[],v=tr(0,1),S=i?[i-1]:[...gr(0,o).map((()=>v)),1-v],U=[Km,Gm,zm,Xm].includes(u)&&(fr(gr(1,h||f))||1),b=gr(1,(h??f)+1);for(let P of b){let e=P===(h??f),{set:t,incomplete:i,winningSideNumber:r}=sk({setFormat:e&&I||g,incomplete:U===P,pointsPerMinute:a,matchUpStatus:u,weightedRange:S,setNumber:P});if(y.push(t),i){p=r;break}if(hM({matchUp:{score:{sets:y},matchUpFormat:n}}).calculatedWinningSide)break}let w=hM({matchUp:{score:{sets:y},matchUpFormat:n,winningSide:i}}),T=p?i||p:w.calculatedWinningSide,{score:D}=iA({winningSide:T,score:{sets:y},matchUpStatus:u});return{outcome:{winningSide:T,matchUpStatus:u,score:D}}}function sk({weightedRange:e=[0,1],pointsPerMinute:t,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o,s={setNumber:a},{setTo:c,tiebreakFormat:d,tiebreakAt:u,tiebreakSet:l,timed:p,minutes:m}=n,f=tr(0,e.length-1),h=e[f];if(p){let n=m*t,a=Math.round(.2*n),c=n+fr([1,-1])*a,d=function(e=1,t=3,i=!0){let r=0;for(let n=0;n<t;n++)r+=Math.random()*(e/t);return i&&e>1?Math.round(r):r}(c,2),u=[d,c-d];h&&u.reverse(),o=e[f]+1;let l=(u[0]>u[1]?1:u[1]>u[0]&&2)||0;if(r){let[e,t]=u;return Object.assign(s,{side1Score:e,side2Score:t}),af.includes(i)?{set:s,incomplete:r,winningSideNumber:o}:{set:s,incomplete:r}}l||(u[tr(0,1)]+=1),l=u[0]>u[1]?1:2,l!==o&&u.reverse();let[p,g]=u;return Object.assign(s,{side1Score:p,side2Score:g,winningSide:o}),{set:s}}if(r)return s.side1Score=tr(0,u),s.side2Score=tr(0,u),af.includes(i)&&(o=e[f]+1),{set:s,incomplete:r,winningSideNumber:o};{let t=gr(1,c+1).flatMap((e=>gr(0,c+2-e).map((()=>e)))),i=t[tr(0,t.length-1)],r=c&&eN({isSide1:!0,tiebreakAt:u,lowValue:i,setTo:c}),a=!r,o=1===e.length&&e[f]+1;if(!a){o?(r[0]>r[1]?1:2)!==o&&r.reverse():h&&r.reverse();let[e,t]=r;Object.assign(s,{side1Score:e,side2Score:t})}let p,m=nN({matchUpScoringFormat:{setFormat:n},setObject:s});if(m.hasTiebreakCondition||a){let{NoAD:e,tiebreakTo:t}=d||l||{},i=gr(1,t+1).flatMap((e=>gr(0,t+2-e).map((()=>e)))),r=i[tr(0,i.length-1)],n=tN({isSide1:!0,tiebreakNoAd:e,tiebreakTo:t,lowValue:r});if(n)if(a){let e=n[0]>n[1]?1:2;o?e!==o&&n.reverse():h&&n.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=n,p=(n[0]>n[1]?1:n[1]>n[0]&&2)||void 0}else 2===m.leadingSide?[s.side1TiebreakScore,s.side2TiebreakScore]=n:[s.side2TiebreakScore,s.side1TiebreakScore]=n}s.winningSide=m.winningSide||m.leadingSide||o||p}return{set:s}}function ck(e){let{matchUpStatusProfile:t,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:o,event:s}=e;if(!o)return{error:Jr};let c=e.matchUpFormat||o.matchUpFormat||s?.matchUpFormat,d=o.structures.slice().sort(df),u=0,{matchUps:l,matchUpsMap:p}=gy({matchUpFilters:{matchUpTypes:[Gi],roundNumbers:[1]},contextFilters:{stages:[vu,Su]},inContext:!0,drawDefinition:o});if(l?.length){let e=s?.category?.ageCategoryCode||s?.category?.categoryName;if(e){let t=VR({singlesOnly:!0,tournamentRecord:n,drawDefinition:o,scaleAccessor:{scaleName:e,sortOrder:"ASC",scaleType:pp},event:s});if(t.error)return t;let{lineUps:i,participantsToAdd:r}=t;_M({tournamentRecord:n,participants:r}),Vp({element:o,extension:{name:dm,value:i}})}else{let e=l[0]?.structureId,{positionAssignments:t}=ff({drawDefinition:o,structureId:e});if(t?.length){let{participants:e}=mv({participantFilters:{participantTypes:[Gi]},tournamentRecord:n}),i=i=>{let r=i.tieMatchUps.filter(yI(Bi)),a=i.tieMatchUps.filter(yI(ji));r.forEach(((i,r)=>{let a=i.matchUpId;i.sides.forEach((i=>{let{drawPosition:c}=i,d=e?.find((e=>{let{participantId:i}=e;return t.find((e=>e.participantId===i))?.drawPosition===c}));if(d){let e=d.individualParticipantIds?.[r];e&&lC({teamParticipantId:d.participantId,participantId:e,tournamentRecord:n,drawDefinition:o,tieMatchUpId:a,event:s})}}))})),a.forEach(((i,r)=>{let a=i.matchUpId;i.sides.forEach((i=>{let{drawPosition:c}=i,d=e?.find((e=>{let{participantId:i}=e;return t.find((e=>e.participantId===i))?.drawPosition===c}));d&&d.individualParticipantIds?.slice(2*r,2*r+2)?.forEach((e=>{lC({teamParticipantId:d.participantId,participantId:e,tournamentRecord:n,drawDefinition:o,tieMatchUpId:a,event:s})}))}))}))};l.forEach(i)}}}let m="string"==typeof i&&i,f=m&&jm,h=2===d.length&&d[0].finishingPosition===Il&&2===yr(d.map((({stage:e})=>e)),[vu,wu]).length,g=d.map((({structureId:e})=>e));for(let I of g){if(u>=a)break;let i=o.structures.find((e=>e.structureId===I)),d=oy({contextFilters:{matchUpTypes:[ji,Bi]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:i,event:s}).matchUps;d.length;let l=d.filter((({winningSide:e})=>!e)).sort(Uy).map(xm);for(let e of l){if(!isNaN(a)&&u>=a)break;let{matchUps:d}=oy({matchUpFilters:{matchUpTypes:[ji,Bi]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:i,event:s}),l=d.find((t=>t.matchUpId===e)),h=[qm,Wm].includes(l.matchUpStatus);if(l?.readyToScore&&!h){let e=uk({matchUpStatusProfile:t,tournamentRecord:n,drawDefinition:o,targetMatchUp:l,matchUpFormat:c,matchUpStatus:f,scoreString:m,winningSide:!r&&1,event:s});if(e?.error)return e;u+=1}}h&&i.finishingPosition===Il&&e.completeRoundRobinPlayoffs&&cU({structureId:i.structureId,applyPositioning:!0,drawDefinition:o})}return{..._r,completedCount:u}}function dk(e){let{matchUpStatusCodes:t,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:c,winningSide:d,event:u}=e;if(!a||"BYE"===a.matchUpStatus)return;let{matchUpId:l}=a||{},{outcome:p}=hA({matchUpFormat:s,matchUpStatus:o,scoreString:c,winningSide:d});return t&&(p.matchUpStatusCodes=t),nA({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:l,outcome:p,event:u})}function uk(e){let{matchUpStatusProfile:t={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:c,winningSide:d,event:u}=e;if(c||a)return dk(e);let{matchUpId:l}=s||{},{outcome:p}=ok({matchUpStatusProfile:t,matchUpFormat:o,winningSide:d});return nA({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:l,outcome:p,event:u})}function lk({matchUpStatusProfile:e,completeAllMatchUps:t,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:o}){let s=XI({event:o}).flightProfile,{eventName:c,eventType:d,category:u}=o,{startDate:l}=r,p=[],m=u?.categoryName||u?.ageCategoryCode||u?.ratingType,f=o.drawDefinitions?.map((({drawId:e})=>e));if(Array.isArray(s?.flights))for(let[h,g]of s.flights.entries()){let{drawId:s,stage:u,drawName:I,drawEntries:y}=g;p.push(g.drawId);let v=n[h],{seedsCount:S,generate:U=!0}=v||{};if(U){let p=y.filter(Dy(Ml)).map(Dy(Ml)),g=m||c;if(r&&S&&S<=p.length&&gr(1,S+1).forEach(((e,t)=>{let i={scaleValue:e,scaleName:g,scaleType:hp,eventType:d,scaleDate:l},n=p[t];qT({tournamentRecord:r,participantId:n,scaleItem:i})})),f?.includes(s))break;let U=PM({...v,matchUpType:d,seedingScaleName:g,tournamentRecord:r,drawEntries:y,drawName:I,drawId:s,isMock:a,event:o,stage:u});if(U.error)return{error:U.error,drawIds:[]};let{drawDefinition:b}=U;if(!b)return{error:Zr};let w=n[h]?.drawExtensions;if(Array.isArray(w)&&w.filter(Bp).forEach((e=>Vp({element:b,extension:e}))),U=IR({suppressNotifications:!0,tournamentRecord:r,drawDefinition:b,event:o}),U.error)return{error:U.error,drawIds:[]};if(v?.withPlayoffs){let e=b.structures?.[0].structureId,t=Aw({idPrefix:v.idPrefix,...v.withPlayoffs,tournamentRecord:r,drawDefinition:b,structureId:e,isMock:a,event:o});if(t?.error)return t}let T=v?.completionGoal;if(!1!==v?.automated&&(t||T)){let n=v?.matchUpFormat,a=ck({completeAllMatchUps:!T&&t,matchUpStatusProfile:e,randomWinningSide:i,tournamentRecord:r,completionGoal:T,drawDefinition:b,matchUpFormat:n,event:o});if(a.error)return{error:a.error,drawIds:[]};let s=a.completedCount;if(v?.drawType===pl){let a=b.structures?.find((e=>e.stage===vu));if(!a)return{error:Rn};let c=cU({structureId:a.structureId,tournamentRecord:r,drawDefinition:b});if(c.error)return{error:c.error,drawIds:[]};if(c=ck({completeAllMatchUps:!T&&t,completionGoal:T?T?T-(s??0):void 0:void 0,matchUpStatusProfile:e,randomWinningSide:i,tournamentRecord:r,drawDefinition:b,matchUpFormat:n,event:o}),c.error)return{error:c.error,drawIds:[]}}}}}return{..._r,drawIds:p}}function pk(e){let{participantsProfile:t={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:o,event:s,uuids:c}=e,{category:d,gender:u,eventType:l}=s,p=yI(pu)(l)&&ph||yI(fu)(l)&&fh||l,m=i[vu]||0,f=i[Su]||0,h=a.drawProfiles?.length?m+f:a.participantsProfile?.participantsCount??0,g=dc(u)?u:void 0,I=t?.idPrefix?`E-${o}-${t?.idPrefix}`:void 0,{participants:y}=QA({uuids:a.uuids||c,...t,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:h,ratingsParameters:r,category:d,idPrefix:I,sex:g}),v=_M({tournamentRecord:n,participants:y});if(v.error)return v;let S=y?.filter((({participantType:e})=>e===p)),U=y?.map(Om);return{uniqueDrawParticipants:S,uniqueParticipantIds:U}}function mk({autoEntryPositions:e,tournamentRecord:t,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Yu,qualifyingPositions:o=0,stage:s=vu,drawSize:c=0,drawName:d,drawId:u}=r,l=c-o,p=i.slice(0,l).map(Om);if(p.length){let i=Dv({participantIds:p,autoEntryPositions:e,entryStage:s,tournamentRecord:t,event:n});if(i.error)return i}let m=DR({drawName:d||a,qualifyingPositions:o,drawEntries:p.map((e=>({entryStatus:Qh,entryStage:s,participantId:e}))),drawId:u,event:n,stage:s});return m.error?m:{..._r}}function fk({uniqueDrawParticipants:e,autoEntryPositions:t,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let c=0;for(let d of n){let{qualifyingPositions:n=0,uniqueParticipants:u,stage:l=vu,drawSize:p=0}=d,m=p-n,f=u||o||a||l===Su,h=f?e.slice(c,c+m):i[l||vu]||[];f&&(c+=m);let g=mk({autoEntryPositions:t,drawParticipants:h,tournamentRecord:r,drawProfile:d,event:s});if(g.error)return g}return{..._r}}function hk(e){let{allUniqueParticipantIds:t,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:c,tournamentRecord:d,eventProfile:u,eventIndex:l,publish:p,isMock:m,uuids:f}=e,h=u.gender,g=u.eventName,{eventType:I=pu,policyDefinitions:y,drawProfiles:v=[],eventExtensions:S,surfaceCategory:U,tieFormatName:b,processCodes:w,discipline:T,eventLevel:D,timeItems:P,ballType:N,category:E}=u,M=u.eventId||Ud(),R=u.tieFormat||(I===gu?lu({namedFormat:b,event:{eventId:M,category:E,gender:h},hydrateCollections:o,isMock:m}):void 0),C=d.participants;for(let q of v)!h&&q.gender&&(h=q?.gender);let{stageParticipantsCount:A,uniqueParticipantsCount:k,uniqueParticipantStages:O}=rk({drawProfiles:v,category:E,gender:h}),x=yI(pu)(I)&&ph||yI(fu)(I)&&fh||I,{uniqueDrawParticipants:F=[],uniqueParticipantIds:L=[]}=O?pk({event:{eventType:I,category:E,gender:h},uniqueParticipantsCount:k,participantsProfile:r,ratingsParameters:c,tournamentRecord:d,eventProfile:u,eventIndex:l,uuids:f}):{},{eventAttributes:_}=u;"object"!=typeof _&&(_={});let B=E?.categoryName||E?.ageCategoryCode||E?.ratingType;g=g||B||"Generated Event";let V={..._,surfaceCategory:U,processCodes:w,discipline:T,eventLevel:D,eventName:g,eventType:I,tieFormat:R,ballType:N,category:E,eventId:M,gender:h};if(S?.length&&Array.isArray(S)){let e=S.filter(Bp);e?.length&&Object.assign(V,{extensions:e})}if(Array.isArray(P)&&P.forEach((e=>Ew({event:G,timeItem:e}))),"object"==typeof y)for(let q of Object.keys(y))kw({policyDefinitions:{[q]:y[q]},event:V});V.category&&(V.category.categoryName=B);let j,$=WM({suppressNotifications:!1,internalUse:!0,tournamentRecord:d,event:V});if($.error)return $;let G=$?.event,{stageParticipants:W}=nk({allUniqueParticipantIds:t,stageParticipantsCount:A,eventParticipantType:x,targetParticipants:C});if(v?.length){let e=fk({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:W,tournamentRecord:d,drawProfiles:v,category:E,gender:h,event:G});if(e.error)return e;let t=lk({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:d,drawProfiles:v,isMock:m,event:G});if(t.error)return t;j=t.drawIds}else if(u?.participantsProfile?.participantsCount){let e=F.map(Om);if(e.length){let t=Dv({participantIds:e,autoEntryPositions:a,tournamentRecord:d,entryStage:vu,event:G});if(t.error)return t}}return p&&YM({tournamentRecord:d,event:G}),{drawIds:j,eventId:M,uniqueParticipantIds:L}}function gk({tournamentRecords:e,scheduleDate:t,venueId:i,round:r}){if(!Fc(t))return{error:Pa};let{extension:n}=Jp({name:ym,tournamentRecords:e,discover:!0}),a=n?.value||[],o=a.find((e=>ad(t,e.scheduleDate)));if(!o){let{startDate:i,endDate:r}=$N({tournamentRecords:e}),n=new Date(t);if(i&&n<new Date(i)||r&&n>new Date(r))return{error:Pa};o={scheduleDate:t,venues:[]},a.push(o)}let s=o.venues.find((e=>e.venueId===i));s||(s={venueId:i,rounds:[]},o.venues.push(s));let c=["notBeforeTime"],d=e=>Object.keys(e).filter((e=>!c.includes(e))).sort().map((t=>Rr(e[t])?d(e[t]):e[t])).flat().join("|");if(s.rounds.find((e=>d(e)===d(r))))return Qs({result:{error:En},stack:"addSchedulingProfileRound"});s.rounds.push(r);let u=TE({tournamentRecords:e,schedulingProfile:a});return u.error?u:{..._r}}function Ik(e){let t=dp(e,[{drawProfile:!0,_ofType:Ql}]);if(t.error)return t;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:c,ratingsParameters:d,tournamentRecord:u,isMock:l=!0,drawProfile:p,startDate:m,drawIndex:f,uuids:h}=e,g=yd(p,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:y=Ad,drawType:v=Yu,tournamentAlternates:S=0,alternatesCount:U=0,qualifyingPositions:b,qualifyingProfiles:w,generate:T=!0,eventExtensions:D,drawExtensions:P,completionGoal:N,tieFormatName:E,buildTeams:M,seedsCount:R,timeItems:C,drawName:A,category:k,idPrefix:O,publish:x,gender:F,stage:L}=g,_=g.drawSize||(g.ignoreDefaults?void 0:32),B=g.eventId||Ud(),V=p.eventType||p.matchUpType||pu,j=V===fu?fh:ph,$=Rr(p.tieFormat)&&p.tieFormat||V===hh&&lu({event:{eventId:B,category:k,gender:F},namedFormat:E,hydrateCollections:s,isMock:l})||void 0,G=k?.categoryName||k?.ageCategoryCode||k?.ratingType,W=p.eventName||G||`Generated ${V}`,q=u?.participants||[],H=(w?.map((e=>e.structureProfiles||[])).flat().reduce(((e,t)=>e+(!t.participantsCount||t.participantsCount>t.drawSize?t.drawSize:t.participantsCount||0)),0)||0)*(j===fh?2:1),z=(!p.participantsCount||p.participantsCount>_?_:p.participantsCount)||0,Y={eventName:W,eventType:V,tieFormat:$,category:k,eventId:B,gender:F};Array.isArray(C)&&C.forEach((e=>Ew({event:Y,timeItem:e})));let{eventAttributes:K}=p;if("object"!=typeof K&&(K={}),Object.assign(Y,K),D?.length&&Array.isArray(D)){let e=D.filter(Bp);e?.length&&Object.assign(Y,{extensions:e})}let X=[];if(0===r?.participantsCount||p.uniqueParticipants||H||!u||F||k){let e,t,i=(z||0)+U+H,n=i,a={[ic]:0,[Zs]:0};V===hh&&(({teamSize:e,genders:t}=tk({alternatesCount:U,tieFormatName:E,tieFormat:$,drawSize:_})),Object.keys(t).forEach((e=>{let i=cc(e);i&&dc(e)&&t[i]&&(a[i]=_*t[i])})),n=e*((_||0)+H));let o=r?.idPrefix?`D-${f}-${r?.idPrefix}`:void 0,s=QA({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:n,consideredDate:u?.startDate,sex:F||r?.sex,rankingRange:p.rankingRange,uuids:p.uuids||h,ratingsParameters:d,participantType:j,gendersCount:a,idPrefix:o,category:k}).participants;if(Y.category&&(Y.category.categoryName=G),u){let e=_M({participants:s,tournamentRecord:u});if(e.error)return e}if(s.forEach((({participantId:e})=>X.push(e))),q=s,V===hh){let r=t[ic]?s.filter((({participantType:e,person:t})=>e===ph&&t?.sex===ic)).map(Om):[],n=t[Zs]?s.filter((({participantType:e,person:t})=>e===ph&&nc(t?.sex))).map(Om):[],a=s.filter((({participantType:e})=>e===ph)).map(Om).filter((e=>!r.includes(e)&&!n.includes(e))),o=[...g.teamNames??[],...JA({count:i}).names],c=e-(t[ic]+t[Zs]),d=0,l=0,p=0,m=gr(0,i).map((e=>{let i=n.slice(d,d+t[Zs]),s=r.slice(l,l+t[ic]),u=a.slice(p,p+c);d+=t[Zs],l+=t[ic],p+=c;let m=!1!==M?[...i,...s,...u]:[];return{participantName:o[e]||`Team ${e+1}`,participantOtherName:`TM${e+1}`,participantRole:Nv,individualParticipantIds:m,participantType:hh,participantId:Ud()}})),f=_M({participants:m,tournamentRecord:u});if(!f.success)return f;q=m}}let J=e=>{let{participantType:t}=e;return!!(yI(pu)(V)&&t===ph||yI(fu)(V)&&t===fh)||V===hh&&t===hh},Q=e=>!p.gender||e.person?.sex===p.gender||e.individualParticipantIds?.some((e=>{let t=q.find((t=>t.participantId===e));return t&&Q(t)})),Z=q.filter(J).filter(Q).filter((({participantId:e})=>!i.includes(e))),ee=Z.slice(0,z).map((e=>e.participantId));if(l&&ee?.length){let e=Dv({autoEntryPositions:o,entryStage:L,tournamentRecord:u,participantIds:ee,event:Y});if(e.error)return e}let te=H?Z.slice(z,z+H).map((e=>e.participantId)):0;if(l&&te?.length){let e=0,t=1,i=(e,t)=>e.stageSequence-t.stageSequence,r=(e,t)=>e.roundTarget-t.roundTarget;for(let n of w.sort(r)){t=n.roundTarget||t;let r,a=1;for(let s of n.structureProfiles.sort(i)){let i=(s.drawSize||Xi(s.participantsCount))-(r||0),n=te.slice(e,e+i),c=Dv({entryStage:Su,entryStageSequence:a,autoEntryPositions:o,tournamentRecord:u,participantIds:n,roundTarget:t,event:Y});if(c.error)return c;r=s.qualifyingPositions,e+=i,a+=1}t+=1}}let ie=I&&u?.participants?.filter((({participantId:e})=>!ee.includes(e))).filter(J).filter(Q).slice(0,U||_-z||S).map((e=>e.participantId));if(l&&ie?.length){let e=Dv({participantIds:ie,autoEntryPositions:!1,entryStatus:Xh,tournamentRecord:u,event:Y});if(e.error)return e.error}let re=G||W;u&&R&&R<=ee.length&&gr(1,R+1).forEach(((e,t)=>{let i={scaleName:re,scaleDate:m,scaleType:pI,scaleValue:e,eventType:V},r=ee[t];qT({tournamentRecord:u,participantId:r,scaleItem:i})}));let ne=PM({...yd(p,!1,!0),tournamentRecord:u,seedingScaleName:re,matchUpFormat:y,eventId:B,isMock:l,event:Y});if(ne.error)return ne;if(!ne.drawDefinition)return{error:Zr};let{drawDefinition:ae}=ne,oe=ae.drawId;if(Array.isArray(P)&&P.filter(Bp).forEach((e=>Vp({element:ae,extension:e}))),T){if(IR({drawDefinition:ae,event:Y,suppressNotifications:!0}),p.withPlayoffs){let e=ae.structures?.[0].structureId,t=Aw({...p.withPlayoffs,tournamentRecord:u,drawDefinition:ae,structureId:e,idPrefix:O,isMock:l,event:Y});if(t?.error)return t}let e=!1===p.automated;if(l&&!e){let e=e=>{let t=ck({completeAllMatchUps:e.completeAllMatchUps,completionGoal:e.completionGoal,matchUpStatusProfile:n,randomWinningSide:c,tournamentRecord:u,drawDefinition:ae,matchUpFormat:y,event:Y});if(t.error)return t;let i=t.completedCount;if(v===pl){let e=ae.structures?.find((e=>e.stage===vu));if(!e)return{error:Rn};cU({structureId:e.structureId,tournamentRecord:u,drawDefinition:ae});let t=ck({completionGoal:N?N?N-(i??0):void 0:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:c,tournamentRecord:u,drawDefinition:ae,matchUpFormat:y,event:Y});if(t.error)return t}};if(N&&e({completionGoal:N}),p.outcomes){let{matchUps:e}=by({inContext:!0,drawDefinition:ae,event:Y});for(let t of p.outcomes){let{matchUpStatus:i=jm,matchUpStatusCodes:r,stageSequence:n=1,matchUpIndex:a=0,structureOrder:o,matchUpFormat:s,drawPositions:c,roundPosition:d,stage:l=vu,roundNumber:p,winningSide:m,scoreString:f}=t,h=e?.reduce(((e,t)=>{let{structureId:i,matchUpId:r}=t;return e[i]?e[i].push(r):e[i]=[r],e}),{})??[],g=Object.assign({},...Object.keys(h).map(((e,t)=>({[e]:t+1})))),I=e?.filter((e=>!(l&&e.stage!==l||n&&e.stageSequence!==n||p&&e.roundNumber!==p||d&&e.roundPosition!==d||o&&g[e.structureId]!==o||c&&2!==yr(c,e.drawPositions).length)))?.[a],y=dk({matchUpStatusCodes:r,tournamentRecord:u,drawDefinition:ae,targetMatchUp:I,matchUpFormat:s,matchUpStatus:i,scoreString:f,winningSide:m});if(y?.error)return y}}a&&e({completeAllMatchUps:a})}x&&YM({tournamentRecord:u,event:Y})}else{let e=DR({drawEntries:ae.entries,drawName:A||v,qualifyingPositions:b,drawId:oe,event:Y,stage:L});if(e.error)return e}return{..._r,event:Js(Y),uniqueParticipantIds:X,targetParticipants:q,drawDefinition:ae,eventId:B,drawId:oe}}var yk=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),vk=yk;function Sk(e){return parseInt(e)}function Uk({startTime:e="",endTime:t=""}={}){if(!(e&&t&&Ac.test(e)&&Ac.test(t)))return!1;let[i,r]=e.split(":").map(Sk),[n,a]=t.split(":").map(Sk);return!(n<i)&&!(i===n&&a<r)}function bk(e,t){let[i,r]=e.startTime.split(":").map(Sk),[n,a]=t.startTime.split(":").map(Sk);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function wk({dateAvailability:e}){if(!e)return{error:Da};if(!Array.isArray(e))return{error:Ta};let t="Times must be 24 hour => 00:00";for(let i of e){if("object"!=typeof i)return{error:Ta};let{date:e,startTime:r,endTime:n,bookings:a=[]}=i;if(!r||!n)return{error:Ta};if(e&&!Cc.test(e))return{error:Pa,dateAvailability:{date:e},info:"Dates must be formated => YYYY-MM-DD"};if(!Ac.test(r))return{error:Na,dateAvailability:{startTime:r},info:t};if(!Ac.test(n))return{error:Na,dateAvailability:{endTime:n},info:t};if(r===n)return{error:Na,dateAvailability:{startTime:r,endTime:n},info:"startTime and endTime are equivalent"};if(!Uk({startTime:r,endTime:n}))return{error:Na,dateAvailability:{startTime:r,endTime:n},info:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:wa};for(let e of a){if("object"!=typeof e)return{error:wa};let{startTime:i,endTime:r}=e;if(!Ac.test(i))return{error:Na,booking:{startTime:i},info:t};if(!Ac.test(r))return{error:Na,booking:{endTime:r},info:t};if(i===r)return{error:Na,dateAvailability:{startTime:i,endTime:r},info:"startTime and endTime are equivalent"};if(!Uk({startTime:i,endTime:r}))return{error:Na,dateAvailability:{startTime:i,endTime:r},info:"endTime must be after startTime"}}}}return{valid:!0}}function Tk({tournamentRecord:e,disableNotice:t,venueId:i,courtId:r,court:n}){let{venue:a}=WI({tournamentRecord:e,venueId:i});if(!a)return{error:wo};a.courts||(a.courts=[]);let o={...yk(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Ud()),a.courts.some((e=>e.courtId===o.courtId)))return{error:vo};{let r=(n?.dateAvailability||[]).map((e=>({...e,date:Yc(e.date),startTime:zc(e.startTime),endTime:zc(e.endTime),bookings:e.bookings?.map((({startTime:e,endTime:t,bookingType:i})=>({startTime:zc(e),endTime:zc(t),bookingType:i})))}))),s=Object.keys(o);for(let e of s)if(n?.[e])if("dateAvailability"===e){let e=wk({dateAvailability:r});if(!e.valid&&e.error)return e;o.dateAvailability=r}else o[e]=n[e];let c=o;return a.courts.push(c),t||As({payload:{venue:a,tournamentId:e.tournamentId},topic:Ff,key:a.venueId}),{..._r,court:yd(o),venueId:i}}}function Dk(e){let{tournamentRecord:t,venueId:i}=e;if("string"!=typeof i||!i)return{error:To};let r,n=e.tournamentRecords??(t&&{[t.tournamentId]:t})??{},a=[];for(let o of Object.values(n)){let{venue:t}=WI({tournamentRecord:o,venueId:i});if(t){let t=Pk({...e,tournamentRecord:o});for(let e of t?.courts??[])a.push(e?.courtId);if(t.error)return t;r=!0}}return r?{..._r,courtIds:a}:{error:wo}}function Pk({courtNameRoot:e="Court",dateAvailability:t=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:c,endTime:d,idPrefix:u,venueId:l,dates:p}){if(!l)return{error:To};let m=WI({tournamentRecord:r,venueId:l});if(m.error)return m;let{venue:f}=m;if(!Qi(o)||!n)return{error:Io};let h=gr(0,o=o??n.length).map((r=>{let o=a?.[r],c=o?p.map((e=>({date:_c(e),startTime:s,endTime:d,...o}))):t;return o&&s&&d&&c.push({startTime:s,endTime:d}),{courtName:n[r]||i&&f?.venueAbbreviation&&`${f?.venueAbbreviation} ${r+1}`||`${e} ${r+1}`,dateAvailability:c}})).map(((e,t)=>{let i=c?.pop()||u&&`${u}-${t+1}`;return Tk({disableNotice:!0,tournamentRecord:r,courtId:i,venueId:l,court:e})})).map((e=>e.court)).filter(Boolean);return h.length!==o?Qs({info:"not all courts could be generated",result:{error:Ho}}):(f&&As({payload:{venue:f,tournamentId:r.tournamentId},topic:Ff,key:f.venueId}),{..._r,courts:yd(h)})}function Nk({tournamentRecord:e,ignoreExistingVenues:t,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=e,o=[];for(let[s,c]of i.entries()){let{venueAbbreviation:i,venueId:d=r?.pop()??Ud(),dateAvailability:u,startTime:l="07:00",endTime:p="19:00",courtTimings:m,courtsCount:f,courtNames:h,venueName:g,idPrefix:I,courtIds:y}=c,v=$I({tournamentRecord:e,venue:{venueName:g||`Venue ${s+1}`,venueAbbreviation:i,venueId:d}});if(v.error){if(t)continue;return v}o.push(d);let S=jc(n,a),U=!Array.isArray(u)&&[{startTime:l,endTime:p}].concat(S.map((e=>({date:_c(e),startTime:l,endTime:p}))));if(f||h){let t=Dk({dateAvailability:u||U,tournamentRecord:e,courtTimings:m,courtsCount:f,courtNames:h,startTime:l,idPrefix:I,courtIds:y,endTime:p,venueId:d,dates:S});if(t.error)return t}}return o}var Ek=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function Mk(e){let{startDate:t,endDate:i}=e??{},{tournamentName:r=fr(Ek),ratingsParameters:n=kb,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:c,uuids:d}=e??{},u=!1!==e?.isMock||void 0;if(t&&!Fc(t)||i&&!Fc(i))return{error:Pa};if(e.leagueProfiles&&!Array.isArray(e.leagueProfiles)||e.eventProfiles&&!Array.isArray(e.eventProfiles)||e.drawProfiles&&!Array.isArray(e.drawProfiles))return{error:Ho};if(!t){let e=new Date;t=_c(i??e),i=_c(e.setDate(e.getDate()+7))}if(!i){let e=new Date(t);i=_c(e.setDate(e.getDate()+7))}let l=_A({...e.tournamentAttributes??{},tournamentName:r,startDate:t,endDate:i,isMock:u}),p=c?.length?Nk({tournamentRecord:l,venueProfiles:c,uuids:d}):[];if(a?.length&&Array.isArray(a)){let e=a.filter((e=>Bp({extension:e})));e?.length&&Object.assign(l,{extensions:e,isMock:u})}if("object"==typeof o)for(let y of Object.keys(o))kw({policyDefinitions:{[y]:o[y]},tournamentRecord:l});if(!e?.leagueProfiles?.length||e.eventProfiles?.length||e.drawProfiles?.length||e.participantsProfile){let t=ik({tournamentRecord:l,...e});if(!t.success)return t}let m=[],f=[],h=[];if(e.leagueProfiles){let t=function(e){let{tournamentRecord:t,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:o,uuids:s}=e,c=0;for(let d of i){let i=[],{tieFormatName:u=$d,teamProfiles:l=[],teamsCount:p=0,category:m,idPrefix:f,gender:h}=d,g=d.leagueName??d.eventName??`League ${c+1}`,I=d.leagueId??d.eventId??s?.pop()??Ud();r.push(I);let y=Rr(d.tieFormat)&&d.tieFormat||lu({event:{eventId:I,category:m,gender:h},namedFormat:u,isMock:e.isMock})||void 0;if(!y)return{error:ia};let v=Math.max(p,l.length),S=gr(0,v),{genders:U,teamSize:b}=tk({tieFormat:y,drawSize:v}),w={[Zs]:0,[tc]:0,[ec]:0,[ic]:0,ANY:0};Object.keys(U).forEach((e=>w[e]+=U[e]));for(let r of S){let a=l?.[r]?.teamName??`Team ${r+1}`,c=l?.[r]?.teamId||s?.pop()||Ud(),u=d.startDate??e.startDate,p=QA({...d?.participantsProfile,participantsCount:b,consideredDate:u,gendersCount:w,category:m,uuids:s}).participants,h=p.map((e=>e.participantId)),g=hh,I=c??qA({participantType:g,idPrefix:f,index:r,uuids:s});i.push({participantId:I,entryStatus:Qh,entryStage:vu});let y=l?.[r]?.venueIds??[],v={participantId:I,participantRole:Nv,participantName:a,individualParticipantIds:h,participantType:g,homeVenueIds:y};y.forEach((e=>!n.includes(e)&&n.push(e))),o.push(...h,I);let S=_M({participants:[v,...p],tournamentRecord:t});if(S.error)return S}let T={eventName:g,entries:i,eventType:hh,tieFormat:y,category:m,eventId:I,gender:h};if(t.events||(t.events=[]),t.events.push(T),i.length){let e=(Qi(d.roundsCount)&&d.roundsCount)??d.roundsCount===ul?2*(v-1):v-1,i=PM({automated:d.automated,tournamentRecord:t,drawType:Wu,roundsCount:e,drawSize:v,event:T});if(i.error)return i;let{drawDefinition:r}=i;if(r){let e=r?.drawId;IR({drawDefinition:r,event:T,suppressNotifications:!0}),a.push(e)}}c++}Nk({tournamentRecord:t,ignoreExistingVenues:!0,venueProfiles:n.map((e=>({venueId:e}))),uuids:s})}({allUniqueParticipantIds:m,tournamentRecord:l,...e,eventIds:f,venueIds:p,drawIds:h});if(t?.error)return t}if(e.drawProfiles){let t=function(e){let{tournamentRecord:t,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=e,o=0;for(let s of i){let i=Ik({allUniqueParticipantIds:r,tournamentRecord:t,drawProfile:s,drawIndex:o,...e});if(i.error)return i;let{drawId:c,eventId:d,event:u,uniqueParticipantIds:l}=i;if(!1!==s?.addEvent){if(i=WM({suppressNotifications:!1,internalUse:!0,tournamentRecord:t,event:u}),i.error)return i;c&&a.push(c),n.push(d)}l?.length&&r.push(...l),o+=1}}({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:l,...e,eventIds:f,drawIds:h});if(t?.error)return t}if(e.eventProfiles){let t=function(e){let{eventProfiles:t,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=e,a=0;for(let o of t){let t=hk({...e,eventIndex:a,eventProfile:o});if(t.error)return t;let{eventId:s,drawIds:c,uniqueParticipantIds:d}=t;c&&n.push(...c),r.push(s),d?.length&&i.push(...d),a+=1}}({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:l,...e,eventIds:f,drawIds:h});if(t?.error)return t}let{scheduledRounds:g,schedulerResult:I={}}=s?function(e){let{schedulingProfile:t,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=e,o=function({schedulingProfile:e,tournamentRecord:t}){if("object"!=typeof e)return{error:Ho};let i=ah({tournamentRecord:t}).containedStructures,r=vy({tournamentRecord:t}).matchUps??[],{tournamentId:n}=t,a=[];for(let o of e){let{scheduleDate:e,venues:s=[]}=o;for(let o of s){let{rounds:s,venueId:c}=o;for(let o of s){let{drawId:s,winnerFinishingPositionRange:d,roundSegment:u}=o,l=r.filter((e=>{let t=d?.indexOf("-")>0&&d.split("-").map((e=>+e)),i=e.finishingPositionRange?.winner;return!(e.drawId!==s||o.roundNumber&&e.roundNumber!==o.roundNumber||i&&t&&2!==yr(i,t).length&&(ar(i).length!==ar(t).length||yr(i,t).length!==ar(i).length))}))[0];if(l){let{eventId:r,roundNumber:o,drawName:p,structureName:m,roundName:f}=l,h=l.structureId;o&&!d&&(h=Object.keys(i).find((e=>i[e].includes(h)))??h);let g={tournamentId:n,structureId:h,roundNumber:o,roundSegment:u,eventId:r,drawId:s},I=gk({tournamentRecords:{[n]:t},round:g,scheduleDate:e,venueId:c});if(I.error)return I;a.push({structureName:m,roundName:f,drawName:p,...g})}}}}return{scheduledRounds:a}}({schedulingProfile:t,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(r){let{tournamentId:e}=i;return{schedulerResult:LA({scheduleCompletedMatchUps:a,tournamentRecords:{[e]:i},periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}({...e,tournamentRecord:l}):{};return Cs(),Js({..._r,tournamentRecord:l,scheduledRounds:g,schedulerResult:I,eventIds:f,venueIds:p,drawIds:h})}var Rk={};function Ck({keepExtensions:e=[],anonymizeParticipantNames:t=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){if(!i)return{error:zr};let o=Array.isArray(e)?wm.concat(...e):wm,s=t=>Array.isArray(e)?t?.extensions?.filter((e=>o.includes(e.name))):t?.extensions,c={};i.extensions=s(i);let d=a||Ud();c[i.tournamentId]=d,i.tournamentId=d,i.createdAt=(new Date).toISOString(),i.tournamentName=r||`Anonymized: ${_c(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let A of i.participants||[]){A.extensions=s(A),A.onlineResources=[];let e=Ud();c[A.participantId]=e,A.participantId=e}for(let A of i.participants||[])Array.isArray(A.individualParticipantIds)&&(A.individualParticipantIds=A.individualParticipantIds.map((e=>c[e])));let u=0;for(let A of i.venues||[]){A.venueAbbreviation=`V${u}`,A.extensions=s(A),A.venueName=`Venue #${u}`,A.onlineResources=[],A.addresses=[];let e=Ud();c[A.venueId]=e,A.isMock=!0,u+=1;let t=0;for(let i of A.courts||[])i.courtName=`V${u}C${t}`,i.extensions=s(i),i.onlineResources=[],i.isMock=!0,t+=1}let l=1;for(let A of i.events||[]){A.extensions=s(A),A.onlineResources=[],A.isMock=!0;let e=Ud();c[A.eventId]=e,A.eventId=e;let t=A.category?.categoryName||A.category?.ageCategoryCode||A.category?.ratingType||A.gender;if(A.eventName=`Event ${l} ${t}`,Array.isArray(A.entries))for(let r of A.entries)r.participantId=c[r.participantId];for(let r of A.drawDefinitions||[]){r.extensions=s(r);let e=Ud();if(c[r.drawId]=e,r.drawId=e,r.isMock=!0,Array.isArray(r.entries))for(let i of r.entries)i.participantId=c[i.participantId];let t=e=>{e.extensions=s(e);let t=Ud();c[e.structureId]=t,e.structureId=t;for(let i of e.positionAssignments||[])i.participantId&&(i.participantId=c[i.participantId]);for(let i of e.seedAssignments||[])i.participantId&&(i.participantId=c[i.participantId]);for(let i of e.matchUps||[]){i.isMock=!0;for(let e of i.sides||[])e.lineUp&&(e.lineUp=e.lineUp.map((({participantId:e,collectionAssignments:t})=>({participantId:c[e],collectionAssignments:t}))))}};for(let i of r.structures||[])if(t(i),Array.isArray(i.structures))for(let e of i.structures)t(e);for(let i of r.links||[])i.source.structureId=c[i.source.structureId],i.target.structureId=c[i.target.structureId]}let{extension:i}=Jp({name:sm,element:A});Array.isArray(i?.value?.flights)&&i?.value.flights?.forEach((e=>{if(e.drawId=c[e.drawId],Array.isArray(e.drawEntries))for(let t of e.drawEntries)t.participantId=c[t.participantId]})),l+=1}let p=i.startDate||_c(new Date),m=(i.participants||[]).filter((({participantType:e})=>e===ph)),f=m.reduce(((e,t)=>{let i=t.person?.sex,r=cc(i);return r&&dc(i)?e[r]+=1:e[ec]+=1,e}),{[ic]:0,[Zs]:0,[ec]:0}),h=Object.assign({},...Object.keys(f).map((e=>({[e]:KA({category:{ageCategoryCode:"O18"},count:f[e],personExtensions:[],consideredDate:p,sex:e})?.persons||[]})))),g={[ic]:0,[Zs]:0,[ec]:0},I=m.length,y=m.reduce(((e,t)=>{let i=t.person?.addresses?.[0]||{},{city:r,state:n,postalCode:a}=i;return e.cities.includes(r)||e.cities.push(r),e.states.includes(n)||e.states.push(n),e.postalCodes.includes(a)||e.postalCodes.push(a),e}),{cities:[],postalCodes:[],states:[]}),v=y.postalCodes.length,S=y.cities.length,U=y.states.length,{cities:b}=$A({count:S||I,participantsCount:I}),{states:w}=GA({count:U||I,participantsCount:I}),{postalCodes:T}=WA({count:v||I,participantsCount:I}),D={cities:b,states:w,postalCodes:T};m.forEach(((e,i)=>{let r=e?.person,a=r?.sex||ec,o=Yc(r?.birthDate)?.split("-")[0],d=g[a],u=h[a][d];if(g[a]+=1,o){let[,e,t]=u?.birthDate?.split("-")||[],i=[o,e,t].join("-");u.birthDate=i}if(r?.addresses){let e=HA({...D,participantIndex:i,nationalityCode:u.nationalityCode});u.addresses=[e]}u.personId=n?.[i]||Ud(),t?(u.standardFamilyName=u.lastName,u.standardGivenName=u.firstName,e.participantName=`${u.standardGivenName} ${u.standardFamilyName}`):(u.standardFamilyName=r?.standardFamilyName,u.standardGivenName=r?.standardGivenName),delete u.firstName,delete u.lastName,u.extensions=s(r),e.person=u,c[r?.personId]=u.personId})),(i.participants||[]).filter((({participantType:e})=>e===fh)).forEach((e=>{let{individualParticipantIds:t}=e;e.participantName=function({individualParticipantIds:e,individualParticipants:t}){let i=t.filter((({participantId:t})=>e.includes(t))).map((({person:e})=>e?.standardFamilyName)).filter(Boolean).sort().join("/");return 1===e.length&&(i+="/Unknown"),i}({individualParticipantIds:t,individualParticipants:m})}));let P=(i.participants||[]).filter((({participantType:e})=>e===hh)),N=JA({count:P.length}).names;P.forEach(((e,t)=>{e.participantName=N[t]}));let E=(i.participants||[]).filter((({participantType:e})=>e===mh)),M=JA({count:E.length,nameRoot:"Group"}).names;E.forEach(((e,t)=>{e.participantName=M[t]}));let{extension:R}=Jp({element:i,name:ym});Array.isArray(R?.value)&&R?.value.forEach((e=>{e.tournamentId=c[e.tournamentId],e.structureId=c[e.structureId],e.eventId=c[e.eventId],e.drawId=c[e.drawId]}));let{extension:C}=Jp({element:i,name:mm});return Array.isArray(C?.value)&&C?.value.forEach((e=>{e.personId=c[e.personId]})),{..._r}}function Ak({event:e,eventProfile:t,tournamentRecord:i,allUniqueParticipantIds:r,drawIds:n}){let{gender:a,category:o,eventType:s}=e,{drawProfiles:c,publish:d}=t,u=yI(pu)(s)&&ph||yI(fu)(s)&&fh||s;if(c){let{stageParticipantsCount:d,uniqueParticipantsCount:l,uniqueParticipantStages:p}=rk({drawProfiles:c,category:o,gender:a}),{uniqueDrawParticipants:m=[],uniqueParticipantIds:f=[]}=p?pk({event:{eventType:s,category:o,gender:a},uniqueParticipantsCount:l,participantsProfile:t.participantsProfile,ratingsParameters:t.ratingsParameters,tournamentRecord:i,eventProfile:t,uuids:t.uuids}):{};r.push(...f);let{stageParticipants:h}=nk({targetParticipants:i.participants||[],allUniqueParticipantIds:r,stageParticipantsCount:d,eventParticipantType:u}),g=fk({uniqueDrawParticipants:m,autoEntryPositions:t.autoEntryPositions,stageParticipants:h,tournamentRecord:i,drawProfiles:c,category:o,gender:a,event:e});if(g.error||(g=lk({matchUpStatusProfile:t.matchUpStatusProfile,completeAllMatchUps:t.completeAllMatchUps,randomWinningSide:t.randomWinningSide,tournamentRecord:i,drawProfiles:c,isMock:t.isMock,event:e}),g.error))return g;n.push(...g.drawIds)}return d&&YM({tournamentRecord:i,event:e}),_r}function kk(e,t){return e?.find(((e,i)=>void 0!==t.eventIndex&&i===t.eventIndex||t.eventName&&e.eventName===t.eventName||t.eventId&&e.eventId===t.eventId))}function Ok(e){let{participantsProfile:t={},schedulingProfile:i,tournamentRecord:r,autoSchedule:n,eventProfiles:a,periodLength:o,venueProfiles:s,drawProfiles:c,uuids:d}=e;if(!r)return{error:zr};let u=[],l=[],p=[];a?.forEach((e=>{let t=kk(r.events,e);t?.gender&&(e.gender=t.gender)}));let m=r.participants?.length||void 0;m&&t?.idPrefix&&(t.idPrefix=`${t.idPrefix}-${m}`);let f=ik({startDate:r.startDate,participantsProfile:t,tournamentRecord:r,eventProfiles:a,drawProfiles:c,uuids:d});if(!f.success)return f;if(a){let t=function({eventProfiles:e,tournamentRecord:t,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let o=t.events?.length||0;for(let s of e){let e=kk(t.events,s);if(e){let r=Ak({event:e,eventProfile:{...s,...a},tournamentRecord:t,allUniqueParticipantIds:i,drawIds:n});if(r.error)return r}else{let e=hk({startDate:t.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:s.ratingsParameters,tournamentRecord:t,eventProfile:s,eventIndex:o,uuids:a.uuids});if(e.error)return e;let{eventId:c,drawIds:d,uniqueParticipantIds:u}=e;d&&n.push(...d),r.push(c),u?.length&&i.push(...u),o+=1}}return _r}({eventProfiles:a,tournamentRecord:r,allUniqueParticipantIds:u,eventIds:l,drawIds:p,params:e});if(t.error)return t}if(c){let t=function({drawProfiles:e,tournamentRecord:t,allUniqueParticipantIds:i,eventIds:r,drawIds:n,params:a}){let o=(t.events||[]).flatMap((e=>e.drawDefinitions?.map((()=>1))||[])).reduce(((e,t)=>e+t),0);for(let s of e){let e=Ik({startDate:t.startDate,allUniqueParticipantIds:i,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:t,drawProfile:s,drawIndex:o,uuids:a.uuids});if(e.error)return e;let{drawId:c,eventId:d,event:u,uniqueParticipantIds:l}=e;if(e=WM({tournamentRecord:t,event:u,internalUse:!0}),e.error)return e;c&&n.push(c),r.push(d),l?.length&&i.push(...l),o+=1}return _r}({drawProfiles:c,tournamentRecord:r,allUniqueParticipantIds:u,eventIds:l,drawIds:p,params:e});if(t.error)return t}let h=s?.length?Nk({tournamentRecord:r,venueProfiles:s}):[],g=function({schedulingProfile:e,autoSchedule:t,periodLength:i,tournamentRecord:r}){let n={};if(e?.length){let a=TE({tournamentRecords:{[r.tournamentId]:r},schedulingProfile:e});if(a.error)return a;if(t){let{tournamentId:e}=r;n=LA({tournamentRecords:{[e]:r},periodLength:i})}}return{scheduledRounds:void 0,schedulerResult:n}}({schedulingProfile:i,autoSchedule:n,periodLength:o,tournamentRecord:r});if(g.error)return g;let{scheduledRounds:I,schedulerResult:y}=g;return{totalParticipantsCount:r.participants.length,scheduledRounds:I,schedulerResult:y,..._r,eventIds:l,venueIds:h,drawIds:p}}Oi(Rk,{anonymizeTournamentRecord:()=>Ck,modifyTournamentRecord:()=>Ok});var xk={};Oi(xk,{addDynamicRatings:()=>KT,addIndividualParticipantIds:()=>dC,addParticipant:()=>LM,addParticipants:()=>_M,addPenalty:()=>sO,addPersonRequests:()=>$k,addPersons:()=>dO,createGroupParticipant:()=>Xk,createTeamsFromParticipantAttributes:()=>BA,deleteParticipants:()=>Lv,filterParticipants:()=>lv,findParticipant:()=>Kk,getCompetitionParticipants:()=>MN,getPairedParticipant:()=>ey,getParticipantEventDetails:()=>RN,getParticipantMembership:()=>CN,getParticipantScaleItem:()=>XT,getParticipantSchedules:()=>AN,getParticipantSignInStatus:()=>kN,getParticipantTimeItem:()=>Eh,getParticipants:()=>mv,getScaleValues:()=>Ip,mergeParticipants:()=>oO,modifyIndividualParticipantIds:()=>Gk,modifyParticipant:()=>uC,modifyParticipantName:()=>Jk,modifyParticipantOtherName:()=>qk,modifyParticipantsSignInStatus:()=>Wk,modifyPenalty:()=>rO,modifyPersonRequests:()=>Vk,mutate:()=>Fk,participantScaleItem:()=>Zy,query:()=>EN,regenerateParticipantNames:()=>Yk,removeIndividualParticipantIds:()=>Ov,removeParticipantIdsFromAllTeams:()=>Fv,removePenalty:()=>eO,removePersonRequests:()=>jk,removeRatings:()=>Zk,scaledTeamAssignment:()=>Qk,setParticipantScaleItem:()=>qT,setParticipantScaleItems:()=>HT,validateLineUp:()=>US});var Fk={};function Lk(e=0){("number"!=typeof e||isNaN(e))&&(e=0);let t=new Date;return t.setHours(t.getHours()+e),t.getTime().toString(36).slice(-6).toUpperCase()}function _k({personRequests:e,personId:t,requests:i}){e[t]||(e[t]=[]);let r=i.filter((({requestType:e})=>e)).map((e=>{let{date:t,startTime:i,endTime:r}=e;return e.requestType===SA&&(t=Yc(t),i=zc(i),r=zc(r),t&&i&&r)?{date:t,startTime:i,endTime:r,requestType:e.requestType}:e})).filter(Boolean);for(let n of r)n.requestId=Lk(),e[t].push(n);return{mergeCount:r.length}}function Bk(e){let{tournamentRecords:t,personRequests:i}=e,r=dp(e,[{[bl]:!0}]);if(r.error)return r;if(!i)return{..._r};let n=Object.values(t);for(let a of n){let e=a.participants??[],t=[];for(let r of Object.keys(i))if(xp({tournamentParticipants:e,personId:r})){let e=i[r];e.length&&t.push({personId:r,requests:e})}Object.keys(t).length&&Vp({element:a,extension:{value:t,name:mm}})}return{..._r}}function Vk(e){let{tournamentRecords:t,requests:i,personId:r}=e,n=dp(e,[{[bl]:!0},{requests:!0,[rp]:Zl,[ip]:Ho}]);if(n.error)return n;let a=i.map((({requestId:e})=>e)).filter(Boolean),{personRequests:o}=NE({tournamentRecords:t}),s=e=>{o&&(o[e]=o[e].map((e=>{if(!a.includes(e.requestId))return e;let t=i.find((t=>t.requestId===e.requestId));return t.requestType?Object.assign(e,t):void 0})).filter(Boolean))};if(r&&o?.[r])s(r);else if(o)for(let d of Object.keys(o))s(d);let c=i.filter((e=>!e.requestId));return c.length&&_k({personRequests:o,personId:r,requests:c}),Bk({tournamentRecords:t,personRequests:o})}function jk(e){let{tournamentRecords:t,requestType:i,requestId:r,personId:n,date:a}=e,o=dp(e,[{[bl]:!0}]);if(o.error)return o;let{personRequests:s}=NE({tournamentRecords:t}),c=e=>{s&&(s[e]=s[e].filter((e=>!(i&&e.requestType===i||r&&e.requestId===r||a&&e.date===a))),s?.[e]?.length||delete s[e])},d=!(i||r||n||a);if(!d)if(n&&s?.[n])c(n);else if(s)for(let u of Object.keys(s))c(u);return!d&&s&&Object.keys(s).length?Bk({tournamentRecords:t,personRequests:s}):_p({name:mm,tournamentRecords:t,discover:!0})}function $k(e){let{tournamentRecords:t,personId:i,requests:r}=e,n=dp(e,[{[bl]:!0,personId:!0},{requests:!0,[rp]:Zl,[ip]:Ho}]);if(n.error)return n;let{personRequests:a}=NE({tournamentRecords:t}),{mergeCount:o}=_k({personRequests:a,personId:i,requests:r});return o&&a?Bk({tournamentRecords:t,personRequests:a}):{error:Ho}}function Gk({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return Qs({result:{error:zr},stack:r});if(!t||!e)return Qs({result:{error:va},stack:r});let n=i.participants||[],a=n.find((e=>e.participantId===t));if(!a)return Qs({result:{error:Ya},stack:r});if(![hh,mh].includes(a.participantType))return Qs({result:{error:$a},context:{participantType:a.participantType},stack:r});let o=e.filter((e=>n.find((t=>t.participantId===e))?.participantType!==ph));if(o.length)return Qs({result:{error:Va,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],c=e.filter((e=>!s.includes(e))),d=s.filter((t=>!e.includes(t))),u=dC({individualParticipantIds:c,groupingParticipantId:t,tournamentRecord:i});if(u.error)return Qs({result:u,stack:r});let l=Ov({individualParticipantIds:d,groupingParticipantId:t,tournamentRecord:i});if(l.error)return Qs({result:l,stack:r});let{topics:p}=Ls();if(p.includes(Af)){let e=n.find((({participantId:e})=>e===t));As({topic:Af,payload:{tournamentId:i.tournamentId,participants:[e]}})}return{...u,...l}}function Wk({tournamentRecord:e,participantIds:t,signInState:i}){if(!e)return{error:zr};if(!Array.isArray(t))return{error:va};if(![uh,dh].includes(i))return{error:Ho,signInState:i};let r=e.participants||[];if(!r.length)return{error:qa};let n=r.map(Om),a=t.filter((e=>!n.includes(e)));if(a.length)return{error:Ho,context:{invalidParticipantIds:a}};let o=[],s=(new Date).toISOString();for(let d of r){let{participantId:r}=d;if(t.includes(r)){let t=Pw({duplicateValues:!1,tournamentRecord:e,participantId:r,timeItem:{itemType:ch,itemValue:i,createdAt:s}});if(t.error)return t;o.push(d)}}let{topics:c}=Ls();return o.length&&c.includes(Af)&&As({topic:Af,payload:{tournamentId:e.tournamentId,participants:o}}),{..._r}}function qk({tournamentRecord:e,participantId:t,participantOtherName:i}){if(!e)return{error:zr};if(!t)return{error:Ha};let{participant:r}=bh({tournamentRecord:e,participantId:t});if(!r)return{error:Ya};r.participantOtherName=i;let{topics:n}=Ls();return n.includes(Af)&&As({topic:Af,payload:{tournamentId:e.tournamentId,participants:[r]}}),{..._r}}function Hk({personFormat:e,person:t}){let i=e=>e.replace(/\W/g,""),r=e=>e.toLowerCase().indexOf("l")<e.toLowerCase().indexOf("f"),n=e=>e.indexOf(",")>=0;if(!t)return;let a=e.indexOf(" ")>0?" ":"",o=Hv(t?.standardGivenName??""),s=Hv(t?.standardFamilyName??"");if(!e)return`${o}${a}${s}`;(e=>e.toLowerCase().indexOf("f.")>=0)(e)&&!n(e)&&!r(e)&&(o=`${o[0]}.`),(e=>/^[a-z]*$/.test(i(e)))(e)?(o=o.toLowerCase(),s=s.toLowerCase()):(e=>/^[A-Z]*$/.test(i(e)))(e)?(o=o.toUpperCase(),s=s.toUpperCase()):(e=>/^[LAST]{4}/.test(i(e)))(e)&&(s=s.toUpperCase());let c=`${o}${a}${s}`;return(e=>e.toLowerCase().indexOf("f")<0)(e)?c=s:r(e)&&(c=n(e)?`${s},${a}${o}`:`${s}${a}${o}`),c}function zk({participantMap:e,participant:t,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=t,o=r&&i[r];if(r!==lh&&o){let{personFormat:i,doublesJoiner:s}=o;r===ph&&(t.participantName=Hk({person:a,personFormat:i})),r===fh&&(t.participantName=n?.map((t=>{let r=e[t]?.person;return Hk({person:r,personFormat:i})})).filter(Boolean).join(s??"/"))}}function Yk({tournamentRecord:e,formats:t}){if(!e)return{error:zr};if(!Rr(t))return{error:va};let i=e.participants??[],r=Ar(i,"participantId");for(let n of i)zk({participant:n,participantMap:r,formats:t});return{..._r}}function Kk(e){let t,i,{tournamentRecord:r,policyDefinitions:n,contextProfile:a,participantId:o,personId:s}=e,c=e.tournamentRecords||r&&{[r.tournamentId]:r}||{};if("string"!=typeof o&&"string"!=typeof s)return{error:va,stack:"publicFindParticipant"};for(let d of Object.values(c)){if(i=d.tournamentId,t=xp({tournamentParticipants:d.participants||[],internalUse:!0,policyDefinitions:n,contextProfile:a,participantId:o,personId:s}),t)break}return{participant:t,tournamentId:i,..._r}}function Xk({individualParticipantIds:e=[],participantRoleResponsibilities:t,participantRole:i=Cv,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:zr};if(!a)return{error:va,info:"Missing groupName"};if(!Array.isArray(e))return{info:"Invalid individualParticipantIds",error:Ho};let o=(mv({participantFilters:{participantTypes:[ph]},tournamentRecord:r}).participants??[]).map((e=>e.participantId));for(let u of e)if(!o.includes(u))return{error:$a,participantId:u};let s=Js({participantId:n||Ud(),participantRoleResponsibilities:t,participantName:a,individualParticipantIds:e,participantType:mh,participantRole:i}),c=LM({participant:s,tournamentRecord:r});if(c.error)return c;let{topics:d}=Ls();return d.includes(yf)&&As({topic:yf,payload:{tournamentId:r.tournamentId,participants:[s]}}),{..._r,participant:yd(s)}}function Jk({tournamentRecord:e,participantName:t,participantId:i}){if(!e)return{error:zr};if(!i)return{error:Ha};if(!t)return{error:va,info:"Missing participantName"};let{participant:r}=bh({tournamentRecord:e,participantId:i});if(!r)return{error:Ya};r.participantName=t;let{topics:n}=Ls();return n.includes(Af)&&As({topic:Af,payload:{tournamentId:e.tournamentId,participants:[r]}}),{..._r}}function Qk({clearExistingAssignments:e=!0,individualParticipantIds:t,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:c,teamsCount:d,eventId:u,event:l}){if(!o)return{error:zr};if(!Array.isArray(a)&&!ir(d)&&!u||!ir(r)||n&&!Array.isArray(n)||s&&("object"!=typeof s||!Object.keys(s).length))return{error:Ho};if(!s&&!n.length||!n&&(!t||!s))return{error:va,info:"Missing scaling details"};if(u&&!a){if(l?.eventType!==Iu)return{error:xn};a=l?.entries?.filter((({entryStatus:e})=>e===Qh)).map(Om)}if(!a?.length&&!d)return{info:"Missing teamParticipantIds or teamsCount",error:va};let p=t??n.map((({participantId:e})=>e));i&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);let m=a?.slice(r).concat(...a.slice(0,r))??[],f=[];for(let I of o.participants??[]){let{participantId:e,participantType:t}=I;if(m.includes(e)){if(t!==lh)return{error:$a,participant:I};f.push(I)}}if(d&&f.length<d){let e=c??"Team",t=gr(0,d-(f?.length||0)).map((t=>({participantName:`${e} ${t+1}`,participantType:lh,participantRole:Nv}))),{participants:i=[]}=_M({participants:t,returnParticipants:!0,tournamentRecord:o}),r=i.map(Om),n=o.participants?.filter((({participantId:e})=>r.includes(e)))??[];f.push(...n)}if(!f.length)return{error:Yo};if(e)for(let I of f)I.individualParticipantIds=[];else{let e=f.map((e=>e)).flat();t?.length?p=p.filter((t=>!e.includes(t))):n=n?.filter((({participantId:t})=>!e.includes(t)))}if(!t?.length&&!n?.length)return{error:Vo,info:"Nothing to be done"};if(!n.length){for(let e of o.participants??[]){let{participantId:t,participantType:i}=e;if(!p.includes(t))continue;if(i!==ph)return{error:$a,participant:e};let r=Zy({scaleAttributes:s,participant:e})?.scaleItem,a={participantId:t,scaleValue:s?.accessor?r?.scaleValue?.[s?.accessor]:r?.scaleValue};n.push(a)}if(!n.length)return{error:Ya}}n.sort(((e,t)=>s?.sortOrder?(t?.scaleValue||0)-(e?.scaleValue||0):(e?.scaleValue||1/0)-(t?.scaleValue||1/0)));for(let I of n)if(!I.participantId)return{error:Ho,scaledParticipant:I};let h=0;for(;h<n.length;){for(let e of f){if(h+1>n.length)break;let t=n[h];e.individualParticipantIds.push(t.participantId),h++}f.reverse()}let g=f.map(Om);for(let I of o.events??[]){if(I.eventType!==Iu)continue;let e=(I.entries??[]).filter((e=>g.includes(e.participantId)));for(let t of e){let e=t.participantId,i=f.find((t=>t.participantId===e))?.individualParticipantIds;I.entries=(I.entries??[]).filter((e=>!i.includes(e.participantId))),(I.drawDefinitions??[]).forEach((e=>{e.entries=(e.entries??[]).filter((e=>!i.includes(e.participantId)))}));let{flightProfile:r}=XI({event:I});(r?.flights||[]).forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!i.includes(e.participantId)))}))}}return{..._r,scaledParticipants:n}}function Zk(e){let t=dp(e,[{[Tl]:!0,[Fl]:!0},{ratingType:!1,[ep]:e=>kb[e]}]);if(t.error)return t;let i=`${e.ratingType}.${lp}`,r=e.asDynamic?i:e.ratingType,n=[fp,mp,e.eventType,r].join("."),a=e.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter((e=>e.itemType!==n)));return{..._r}}function eO(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:Hr};for(let i of Object.values(t)){let t=tO({...e,tournamentRecord:i});if(t.error&&t.error!==go)return t}return{..._r}}function tO({tournamentRecord:e,penaltyId:t}){if(!e)return{error:zr};if(!t)return{error:ho};let i,r=[],n=!1;return(e?.participants??[]).forEach((e=>{let a=!1;e.penalties=(e.penalties??[]).filter((o=>(o.penaltyId===t&&(a=!0,n||(i=o,n=!0)),a&&r.push(e),o.penaltyId!==t)))})),i&&As({topic:Af,payload:{tournamentId:e.tournamentId,participants:r}}),i?{..._r,penalty:i}:{error:go}}Oi(Fk,{addDynamicRatings:()=>KT,addIndividualParticipantIds:()=>dC,addParticipant:()=>LM,addParticipants:()=>_M,addPenalty:()=>sO,addPersonRequests:()=>$k,addPersons:()=>dO,createGroupParticipant:()=>Xk,createTeamsFromParticipantAttributes:()=>BA,deleteParticipants:()=>Lv,findParticipant:()=>Kk,mergeParticipants:()=>oO,modifyIndividualParticipantIds:()=>Gk,modifyParticipant:()=>uC,modifyParticipantName:()=>Jk,modifyParticipantOtherName:()=>qk,modifyParticipantsSignInStatus:()=>Wk,modifyPenalty:()=>rO,modifyPersonRequests:()=>Vk,regenerateParticipantNames:()=>Yk,removeIndividualParticipantIds:()=>Ov,removeParticipantIdsFromAllTeams:()=>Fv,removePenalty:()=>eO,removePersonRequests:()=>jk,removeRatings:()=>Zk,scaledTeamAssignment:()=>Qk,setParticipantScaleItem:()=>qT,setParticipantScaleItems:()=>HT});var iO=({penaltyId:e=Ud()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:e});function rO(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:Hr};for(let i of Object.values(t)){let t=nO({...e,tournamentRecord:i});if(t.error&&t.error!==go||t.success)return t}return{error:go}}function nO({tournamentRecord:e,modifications:t,penaltyId:i}){if(!e)return{error:zr};if(!t)return{error:Ho,modifications:t};if(!i)return{error:ho};let r=e?.participants??[],n=Object.keys(iO()).filter((e=>"penaltyId"!==e)),a=Object.keys(t).filter((e=>n.includes(e)));if(!a.length)return{error:Xo};let o,s=[];return r.forEach((e=>{let r=!1;e.penalties=(e.penalties??[]).map((e=>(e.penaltyId===i&&(r=!0,a.forEach((i=>Object.assign(e,{[i]:t[i]}))),o||(o=e)),e))),r&&s.push(e)})),o&&As({topic:Af,payload:{tournamentId:e.tournamentId,participants:s}}),o?{..._r,penalty:o}:{error:go}}function aO(e,t,i){return!e&&t?t:e&&!t||"object"!=typeof e||"object"!=typeof t?e:ar(Object.keys(e).concat(Object.keys(t))).reduce(((r,n)=>{if(t[n])if(e[n])if(typeof e[n]!=typeof t[n])r[n]=t[n];else if(Array.isArray(e[n]))if(!0===i||Array.isArray(i)&&i.includes(n)){let i=ar(e[n].map((e=>JSON.stringify(e))).concat(t[n].map((e=>JSON.stringify(e))))).map((e=>JSON.parse(e)));r[n]=i}else r[n]=t[n];else"object"==typeof e[n]?r[n]=aO(e[n],t[n],i):r[n]=t[n];else r[n]=t[n];else r[n]=e[n];return r}),{})}function oO({participants:e=[],tournamentRecord:t,arraysToMerge:i}){if(!t)return{error:zr};t.participants||(t.participants=[]);let r=e.filter(Dy(Ml)).map((e=>({[e.participantId]:e}))),n=Object.assign({},...r),a=[];t.participants=t.participants.map((e=>{if(n[e.participantId]){let t=aO(e,n[e.participantId],i);return a.push(t),t}return e}));let o=t.participants.map(Dy(Ml))||[],s=e.filter((({participantId:e})=>!o.includes(e))),{topics:c}=Ls();return s.length&&(t.participants=t.participants.concat(...s),c.includes(yf)&&As({topic:yf,payload:{participants:s}})),a.length&&c.includes(Af)&&As({topic:Af,payload:{tournamentId:t.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,..._r}}function sO(e){let t,{tournamentRecord:i,participantIds:r}=e,n=e.tournamentRecords??(i&&{[i.tournamentId]:i})??{};for(let a of Object.values(n)){let i=(mv({tournamentRecord:a}).participants??[])?.map(Om).filter((e=>r.includes(e)));i.length&&(t=cO({...e,penaltyId:e.penaltyId??t,tournamentRecord:a,participantIds:i}).penaltyId)}return t?{..._r,penaltyId:t}:{error:Ya}}function cO({refereeParticipantId:e,tournamentRecord:t,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:c,notes:d}){if(!t)return{error:zr};if(!i)return{error:Ha};if(!n)return{error:fo};let u=(t?.participants??[]).filter((e=>i.includes(e.participantId)));if(!u.length)return{error:Ya};let l=(new Date).toISOString(),p=Object.assign(iO({penaltyId:o}),{refereeParticipantId:e,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:l,issuedAt:c,notes:d});return Array.isArray(a)&&a.forEach((e=>Vp({element:p,extension:e}))),u.forEach((e=>{e.penalties||(e.penalties=[]),e.penalties.push(p)})),As({topic:Af,payload:{tournamentId:t.tournamentId,participants:u}}),{..._r,penaltyId:p.penaltyId}}function dO({participantRole:e=Nv,tournamentRecord:t,persons:i}){if(!t)return{error:zr};if(!Array.isArray(i))return{error:Ho};if(!Object.keys(kv).includes(e))return{error:ja};let r=(t.participants||[]).map((({person:e})=>e?.personId)).filter(Boolean),n=[],a=i.filter((e=>e&&(!e.personId||!r.includes(e.personId)))).map((e=>(e.personId||(e.personId=Ud()),n.push(e.personId),e))),o=(e,t)=>Object.assign({},...Object.keys(e).filter((e=>!t.includes(e))).map((t=>({[t]:e[t]})))),s=0,c=0,d=_M({participants:a.map((t=>Js({extensions:t.participantExtensions,timeItems:t.participantTimeItems,participantType:ph,participantRole:e,person:o(t,["participantExtensions","participantTimeItems","pairedPersons"])}))),tournamentRecord:t});if(d.error)return d;c=d.addedCount||0;let u=[],l=mv({participantFilters:{participantTypes:[ph]},tournamentRecord:t})?.participants??[];if(e===Nv&&i.filter((({pairedPersons:e})=>e)).forEach((({personId:e,pairedPersons:t})=>{Array.isArray(t)&&t.forEach((t=>{let i=[e,t.personId].map((e=>xp({tournamentParticipants:l,personId:e}))).filter(Boolean);if(2===i.length){let e=i.map(Om);u.push(Js({extensions:t.participantExtensions,timeItems:t.timeItems,participantRole:Nv,individualParticipantIds:e,participantType:fh}))}}))})),u.length){if(d=_M({participants:u,tournamentRecord:t}),d.error)return d;s=d.addedCount||0}let p=c+s;return{..._r,addedCount:p,newPersonIds:n}}var uO={};Oi(uO,{bulkUpdatePublishedEventIds:()=>aE,getAllEventData:()=>uE,getCourtInfo:()=>YI,getDrawData:()=>fE,getEventData:()=>hE,getEventPublishStatus:()=>rv,getPublishState:()=>av,getTournamentPublishStatus:()=>iv,getVenueData:()=>KI,mutate:()=>lO,publishEvent:()=>YM,publishEventSeeding:()=>pO,publishOrderOfPlay:()=>SO,publishParticipants:()=>yO,query:()=>nE,setEventDisplay:()=>UR,unPublishEvent:()=>bO,unPublishEventSeeding:()=>mO,unPublishOrderOfPlay:()=>gO,unPublishParticipants:()=>fO});var lO={};function pO({removePriorValues:e=!0,stageSeedingScaleNames:t,seedingScaleNames:i,tournamentRecord:r,status:n=fI,drawIds:a=[],event:o}){if(!r)return{error:zr};if(!o)return{error:Fn};let s=rv({event:o,status:n}),c=(s?.seeding?.seedingScaleNames||i)&&{...s?.seeding?.seedingScaleNames,...i};return zM({statusObject:{seeding:Js({stageSeedingScaleNames:(s?.seeding?.stageSeedingScaleNames||t)&&{...s?.seeding?.stageSeedingScaleNames,...t},seedingScaleNames:c,published:!0,drawIds:a})},removePriorValues:e,status:n,event:o}),As({topic:Bf,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{..._r}}function mO({removePriorValues:e=!0,seedingScaleNames:t,tournamentRecord:i,status:r=fI,drawIds:n,stages:a,event:o}){if(!i)return{error:zr};if(!o)return{error:Fn};let s=rv({event:o});if(s){let i=s.seeding;if(Array.isArray(a)&&i.stageSeedingScaleNames)for(let e of a)i.stageSeedingScaleNames[e]&&delete i.stageSeedingScaleNames[e];Array.isArray(t)&&i?.seedingScaleNames&&(i.seedingScaleNames=i.seedingScaleNames.filter((e=>!t.includes(e)))),Array.isArray(n)&&i?.drawIds&&(i.drawIds=i.drawIds.filter((e=>!n.includes(e)))),(!Object.values(i.stageSeedingScaleNames??{}).length&&!i.seedingScaleNames?.length&&!i.drawIds?.length||!a&&!t&&!n?.length)&&(delete i.stageSeedingScaleNames,delete i.seedingScaleNames,delete i.drawIds,i.published=!1),zM({statusObject:{seeding:i},removePriorValues:e,status:r,event:o})}return As({topic:Gf,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{..._r}}function fO(e){let t=sh(e);if(!Object.keys(t).length)return{error:Hr};for(let i of Object.values(t)){let t=hO({tournamentRecord:i,...e});if(t.error)return t}return{..._r}}function hO({removePriorValues:e=!0,tournamentRecord:t,status:i=fI}){if(!t)return{error:zr};let r=`${mI}.${hI}`,{timeItem:n}=Th({element:t,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].participants,Dw({timeItem:{itemValue:a,itemType:r},element:t,removePriorValues:e}),As({payload:{tournamentId:t.tournamentId},topic:qf}),{..._r}}function gO(e){let t=sh(e);if(!Object.keys(t).length)return{error:Hr};for(let i of Object.values(t)){let t=IO({tournamentRecord:i,...e});if(t.error)return t}return{..._r}}function IO({removePriorValues:e=!0,tournamentRecord:t,status:i=fI}){if(!t)return{error:zr};let r=`${mI}.${hI}`,{timeItem:n}=Th({element:t,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Dw({timeItem:{itemValue:a,itemType:r},element:t,removePriorValues:e}),As({topic:Wf,payload:{tournamentId:t.tournamentId}}),{..._r}}function yO(e){let t=sh(e);if(!Object.keys(t).length)return{error:Hr};for(let i of Object.values(t)){let t=vO({tournamentRecord:i,...e});if(t.error)return t}return{..._r}}function vO({removePriorValues:e,tournamentRecord:t,status:i=fI}){if(!t)return{error:zr};let r=`${mI}.${hI}`,{timeItem:n}=Th({element:t,itemType:r}),a=n?.itemValue||{[i]:{}};return a[i].participants={published:!0},Dw({timeItem:{itemValue:a,itemType:r},element:t,removePriorValues:e}),As({payload:{tournamentId:t.tournamentId},topic:jf}),{..._r}}function SO(e){let t=sh(e);if(!Object.keys(t).length)return{error:Hr};for(let i of Object.values(t)){let t=UO({tournamentRecord:i,...e});if(t.error)return t}return{..._r}}function UO({scheduledDates:e=[],removePriorValues:t,tournamentRecord:i,status:r=fI,eventIds:n=[]}){if(!i)return{error:zr};let a=`${mI}.${hI}`,{timeItem:o}=Th({element:i,itemType:a}),s=o?.itemValue||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:e,eventIds:n},Dw({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:t}),As({topic:Vf,payload:{tournamentId:i.tournamentId,scheduledDates:e,eventIds:n}}),{..._r}}function bO({removePriorValues:e=!0,tournamentRecord:t,status:i=fI,event:r}){if(!t)return{error:zr};if(!r)return{error:Fn};let n=`${mI}.${hI}`,{timeItem:a}=Ph({itemType:n,event:r}),o=a?.itemValue||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,Ew({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:e}),zM({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:e,status:i,event:r}),As({topic:$f,payload:{tournamentId:t.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,..._r}}Oi(lO,{publishEvent:()=>YM,publishEventSeeding:()=>pO,publishOrderOfPlay:()=>SO,publishParticipants:()=>yO,setEventDisplay:()=>UR,unPublishEvent:()=>bO,unPublishEventSeeding:()=>mO,unPublishOrderOfPlay:()=>gO,unPublishParticipants:()=>fO});var wO={};function TO({withCompetitiveProfiles:e,opponentParticipantId:t,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){if(!n)return{error:zr};if(s&&!Array.isArray(s))return{error:ca};if(s=s??vy({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!s?.length)return{error:oa};let c=[];t&&c.push(t),r&&c.push(r);let d=mv({participantFilters:c.length?{participantIds:c}:{participantTypes:[lh]},tournamentRecord:n}).participants??[];if(!d.every((({participantType:e})=>e===lh)))return{error:Va};c.length||c.push(...d.map(Om));let u=new Map,l=new Map,p=new Map,m=new Map,f=(e,t="")=>l.get(e)||l.set(e,{participantName:t,participantId:e,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&l.get(e);for(let b of d){let{participantId:e,individualParticipantIds:t}=b;m.set(e,t??[]),f(e,b.participantName)}if(r&&!m.get(r))return Qs({result:{error:Ya},context:{teamParticipantId:r}});if(t&&!m.get(t))return Qs({result:{error:Ya},context:{opponentParticipantId:t}});let h=[],g=e=>{let n=[[],[]];for(let t of e){let e=t.participant;if(e?.participantName){u.set(e.participantId,{participantName:e.participantName,ratings:e.ratings});let t=l.get(e.participantId);t&&(t.participantName=e.participantName)}}let a=({side:e,individualParticipantIds:t})=>e.participantId&&(!t?.length||t.includes(e.participantId))&&[e.participantId]||e.participant?.individualParticipantIds?.length&&(!t?.length||yr(t,e.participant?.individualParticipantIds).length===e.participant?.individualParticipantIds?.length)&&e.participant.individualParticipantIds;if(m.size){let o=(t,r)=>{for(let o of e){if(!o.participant)continue;let e=a({individualParticipantIds:r,side:o});if(e?.length){let r=o.sideNumber;if(!r)continue;let a=[t];i&&a.push(...e),n[r-1]=a;let s=l.get(t);for(let t of e.filter(Boolean))s&&!s.competitorIds.includes(t)&&s.competitorIds.push(t)}}};if(r)(!t||e.every((e=>e.participant&&(a({individualParticipantIds:m.get(r),side:e})||a({individualParticipantIds:m.get(t),side:e})))))&&o(r,m.get(r));else for(let[e,t]of m)o(e,t)}else if(i)for(let t of e){if(!t.participant)continue;let e=a({individualParticipantIds:[],side:t}),i=t.sideNumber;i&&(n[i-1]=e)}return n};for(let b of s){if(!Rr(b))return{error:ca};let{matchUpStatus:t,matchUpFormat:i,matchUpType:r,winningSide:n,score:a,sides:s}=b;if(!s||!a||r===$i||"BYE"===t)continue;let c=g(s);if(!c.filter(Boolean).length)continue;let d=e&&n&&Vg({matchUp:b})?.competitiveness;h.push(b);let l=Lb({matchUpStatus:t,matchUpFormat:i,tallyPolicy:o,winningSide:n,score:a}),p=_b({matchUpStatus:t,matchUpFormat:i,tallyPolicy:o,winningSide:n,score:a}),{pointsTally:m,tiebreaksTally:I}=Bb({matchUpFormat:i,score:a});c.forEach(((e,i)=>{for(let r of e){let e=u.get(r)?.participantName,a=f(r,e);if(a){let e=(e,t)=>t.forEach(((t,i)=>a[e][i]+=t)),r=i?[...I].reverse():I,o=i?[...m].reverse():m,s=i?[...p].reverse():p,c=i?[...l].reverse():l;if(e("tiebreaks",r),e("points",o),e("games",s),e("sets",c),n){let e=n-1===i?0:1;a.matchUps[e]+=1}if(d){let e=d.toLowerCase();a.competitiveness[e]||(a.competitiveness[e]=[0,0]),a.competitiveness[e][i]+=1}if(t){let e=t.toLowerCase();a.matchUpStatuses[e]||(a.matchUpStatuses[e]=0),a.matchUpStatuses[e]+=1}}}}))}let I=["tiebreaks","matchUps","points","games","sets"],y=["competitive","routine","decisive"],v=new Map,S=(e,t)=>(e??0)+(t??0);for(let[b,w]of l.entries()){for(let e of I){let t=w[e].reduce(S);if(t){let i=w[e][0]/t,r=`${e}Ratio`,n=parseFloat(i.toFixed(2));w[r]=n,p.set(b,!0),v.has(r)||v.set(r,[]),v.get(r)?.push(n)}}for(let e of y){let t=w.competitiveness?.[e]?.reduce(S);if(t){let i=w.competitiveness[e][0]/t,r=`${e}Ratio`,n=parseFloat(i.toFixed(2));w[r]=n}}}if(!r){let e=(e,t)=>t-e;for(let t of l.values())for(let i of I){let r=`${i}Ratio`;if("number"==typeof t[r]){let n=v.get(r)?.sort(e).indexOf(t[r]);if("number"==typeof n&&n>=0){t[`${i}Rank`]=n+1}}}}let U={relevantMatchUps:h,..._r};return r?(U.teamStats=l.get(r),t&&(U.opponentStats=l.get(t))):U.participatingTeamsCount=p.size,U.allParticipantStats=[...l.values()],U}function DO({participant:e,eventType:t}){let i=e?.person?.personId,r=e?.person?.personOtherIds?.[0],n=e?.person?.tennisId,a=e?.ratings?.[t]?.find((({scaleName:e})=>"WTN"===e)),o=a?.scaleValue,{wtnRating:s,confidence:c}=o||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:c,wtnRating:s,personId:i,tennisId:n}}function PO({tournamentRecord:e}){if(!e)return{error:zr};let t=e.tournamentId,{participantMap:i}=mv({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:e,withDraws:!0}),r=(vy({matchUpFilters:{matchUpTypes:[_i,Vi]},tournamentRecord:e}).matchUps??[]).flatMap((({sides:e,matchUpType:t})=>e?.flatMap((e=>t===Vi?e?.participant?.individualParticipantIds:e?.participant?.participantId||e.participantId)).filter(Boolean))).filter(Boolean),n=[],a={},o={},s={},c=0,d=({id:e,entry:r,eventId:o,eventType:s})=>{let{qualifyingSeeding:c,mainSeeding:d,entryStatus:u,entryStage:l,drawId:p}=r;a[e]||(a[e]=[]);let{participant:m,events:f}=i?.[e]??{},h=DO({participant:m,eventType:s}),g=f?.[o]?.ranking;u===qU&&n.push(e),a[e].push({participantType:m?.participantType,participantId:e,tournamentId:t,eventType:s,eventId:o,drawId:p,entryStatus:u,entryStage:l,...h,ranking:g,mainSeeding:d,qualifyingSeeding:c})};for(let m of e.events??[]){let e={},n=t=>{e[t]||(e[t]={count:0}),e[t].count+=1},{drawDefinitions:a=[],eventType:u,eventId:l}=m,p=a.flatMap((e=>{let{drawId:t,entries:r}=e;c+=1;let a=(e.structures??[]).filter((({stage:e,stageSequence:t})=>e===vu&&1===t||e===Su)).flatMap((({positionAssignments:e})=>e)).filter(Boolean).map((({participantId:e})=>e));return r?.filter((({participantId:e})=>a.includes(e))).map((e=>{let{participantId:r,entryStatus:a,entryStage:o}=e;n(a);let s=i?.[r]?.draws?.[t]?.seedAssignments?.[vu];return{qualifyingSeeding:i?.[r]?.draws?.[t]?.seedAssignments?.[Su],participantId:r,mainSeeding:s,entryStatus:a,entryStage:o,drawId:t}}))})),f=e=>{let t=e.participantId,n=i?.[t].participant.individualParticipantIds?.filter((e=>r.includes(e)));return t&&{[t]:{individualParticipantIds:n}}};u===hu?(()=>{let e=Object.assign({},...p.map(f).filter(Boolean));p.forEach((t=>{e[t.participantId].individualParticipantIds.forEach((e=>{d({id:e,eventType:u,eventId:l,entry:t})}))}))})():p.forEach((e=>{d({id:e?.participantId,eventType:u,eventId:l,entry:e})}));let h=Object.values(e).reduce(((e,t)=>e+t.count),0);Object.keys(e).forEach((t=>{e[t].pct=e[t].count/h*100})),s[l]={tournamentId:t,eventId:l,entries:p,entryStatuses:e};let g=Object.assign({},...pg.flatMap((t=>[{[t+"_count"]:e[t]?.count},{[t+"_pct"]:e[t]?.pct}])));o[l]={tournamentId:t,eventId:l,...g}}let u=Object.values(i??{}).filter((({participant:{participantType:e,participantRole:t}})=>e===ph&&t===Nv)),l=u.filter((({participant:e})=>!r.includes(e.participantId))).map((({participant:e})=>e.participantId)),p={nonParticipatingEntriesCount:l.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:l,drawDefinitionsCount:c,tournamentId:t};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function NO({eventType:e,matchUps:t,eventId:i,drawId:r}){let n={},a=t.filter((e=>i?e.eventId===i:e.drawId===r)).reduce(((e,t)=>((e=>{let t=e?.matchUpFormat;t&&(n[t]||(n[t]=0),n[t]+=1)})(t),(t.sides??[]).flatMap((e=>(e?.participant?.individualParticipants||[e?.participant]).filter(Boolean))).forEach((t=>e[t.participantId]=t)),e)),{}),o=Object.values(a),s=o.map((t=>DO({participant:t,eventType:e}))).filter((({wtnRating:e})=>e)),c=(o.length-s.length)/o.length*100,d=s.reduce(((e,t)=>{let{wtnRating:i,confidence:r}=t;return e.totalWTN+=i,e.totalConfidence+=r,e}),{totalWTN:0,totalConfidence:0}),u=s?.length?d.totalWTN/s.length:0,l=s?.length?d.totalConfidence/s.length:0,p=Object.values(n).reduce(((e,t)=>e+(t||0)),0);return{matchUpFormatCounts:n,matchUpsCount:p,avgConfidence:l,pctNoRating:c,avgWTN:u}}function EO(e){let{tournamentRecord:t,extensionProfiles:i,firstFlightOnly:r,firstStageSequenceOnly:n=!0}=e;if(!t)return{error:Kr};let a=[],o={},s={},c=[],d=Object.assign({},...(i??[]).map((({name:e,label:i,accessor:r})=>{let n=Jp({element:t,name:e})?.extension?.value;return{[i??e]:r?wy({element:n,accessor:r})?.value:n}}))),u=t?.tournamentId,l=vy({participantsProfile:{withScaleValues:!0},tournamentRecord:t}).matchUps??[],p=e=>Th({itemType:vf,itemSubTypes:[hp],element:{timeItems:e}})?.timeItem?.itemValue?.scaleBasis,m=t?.events?.flatMap((({timeItems:e,drawDefinitions:t=[],extensions:i,eventType:c,eventName:m,eventId:f,category:h})=>{let g=i?.find((e=>e.name===sm))?.value?.flights?.map((e=>({[e.drawId]:e.flightNumber}))),I=g&&Object.assign({},...g),y=i?.find((e=>e.name===am)),v=e?.find((e=>e.itemType===am)),S=y?.value?.length??v?.itemValue??0,U=Object.values(I??{}),b=I&&Math.min(...U),w=p(e);return s[f]={seedingBasis:w?JSON.stringify(w):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:S,tournamentId:u,eventId:f},t.filter((e=>!r||!g||I[e.drawId]===b)).flatMap((e=>{let{matchUpFormat:t,tieFormat:i,timeItems:r,extensions:g,structures:y,drawName:v,drawType:S,drawId:U}=e,{matchUpFormatCounts:b,matchUpsCount:T,avgConfidence:D,pctNoRating:P,avgWTN:N}=NO({eventType:c,matchUps:l,drawId:U}),E=p(r)??w,M=function({extensions:e}){return e?.find((({name:e})=>e===fm))?.value?.slice(1)}({extensions:g}),R=M?.length??0;return(({positionManipulations:e})=>{e?.forEach((e=>{let{structureId:t,name:i}=e,r=e.drawPositions??[e.drawPosition];o[t]??=[],o[t].push(`${i}: ${r.join("/")}`)}))})({positionManipulations:M}),s[f].totalPositionManipulations+=R,s[f].generatedDrawsCount+=1,R>s[f].maxPositionManipulations&&(s[f].maxPositionManipulations=R),y?.filter((e=>(1===e.stageSequence||!n)&&[Su,vu,Uu,wu].includes(e.stage))).map((e=>{let r=[vu,wu].includes(e.stage)?l.find((t=>t.structureId===e.structureId&&1===t.finishingRound&&t.winningSide)):void 0;e.stage===vu&&a.push({eventName:m,drawName:v,structureId:e.structureId});let n=r?.sides?.find((e=>e.sideNumber===r.winningSide))?.participant,o=n?.participantType===lh&&n.participantId,s=n?.participantType===fh?n.individualParticipants:[],p=DO({participant:s?.[0]??n,eventType:c}),{personId:g,personOtherId:y,tennisId:w,confidence:R,wtnRating:C}=p||{},A=DO({participant:s?.[1],eventType:c}),{personId:k,personOtherId:O,tennisId:x,confidence:F,wtnRating:L}=A||{},{ageCategoryCode:_,categoryName:B,subType:V}=h??{},j=e.matchUpFormat??t,$=(b[j]??0)/T*100,{tieFormatName:G,tieFormatDesc:W}=QN(i),{tieFormatName:q,tieFormatDesc:H}=QN(e.tieFormat),z=W===H,Y=!z&&q,K=e.tieFormat&&!z&&H,X=M?.filter((t=>t.structureId===e.structureId))?.length??0;return{...d,tournamentId:u,eventId:f,structureId:e.structureId,drawId:U,eventType:c,category:V,categoryName:B,ageCategoryCode:_,flightNumber:I?.[U],drawType:S,stage:e.stage,seedingBasis:E?JSON.stringify(E):void 0,winningPersonId:g,winningPersonOtherId:y,winningPersonTennisId:w,winningPersonWTNrating:C,winningPersonWTNconfidence:R,winningPerson2Id:k,winningPerson2OtherId:O,winningPerson2TennisId:x,winningPerson2WTNrating:L,winningPerson2WTNconfidence:F,winningTeamId:o,positionManipulations:X,pctNoRating:P,matchUpFormat:j,pctInitialMatchUpFormat:$,matchUpsCount:T,drawTieFormatName:G,drawTieFormatDesc:W,tieFormatName:Y,tieFormatDesc:K,avgConfidence:D,avgWTN:N}}))}))}));return a.forEach((({eventName:e,drawName:t,structureId:i})=>{o[i]?.length&&c.push({eventName:e,drawName:t,actions:o[i]})})),{eventStructureReports:Object.values(s),structureReports:m,flightReports:c}}function MO({ignoreDisabled:e=!0,tournamentRecords:t,tournamentId:i,venueIds:r=[],dates:n=[]}){if(!Array.isArray(n))return{error:Ho,dates:n};if(!Array.isArray(r))return{error:Ho,venueIds:r};if(!(t&&Object.keys(t).filter((e=>!i||e===i))||[]).length)return{error:Hr};if(!n.every(Fc))return{error:Pa};let a=cE({tournamentRecords:t,ignoreDisabled:e,dates:n});if(a.error)return a;let o=a?.venues?.filter((({venueId:e})=>!r?.length||r.includes(e))),s=a.courts?.reduce(((e,t)=>(t.dateAvailability?.forEach((t=>{let i=t.date;e.includes(i)||e.push(i)})),e)),[]).filter((e=>!n.length||n.includes(e))),c={venueIds:o?.map((({venueId:e})=>e))},{matchUps:d}=Sy({afterRecoveryTimes:!0,tournamentRecords:t,matchUpFilters:c});return{venuesReport:o?.map((e=>function(e,t,i){let{venueId:r,courts:n,venueName:a}=t,o={};return e.forEach((e=>{let t=0,a=0,s=0;for(let i of n){let r=i.dateAvailability.find((t=>t.date===e)),n=(r&&GR({courtDate:r}).timeSlots)?.reduce(((e,t)=>{let{startTime:i,endTime:r}=t;return e+(qc(r)-qc(i))}),0);n&&(s+=1),t+=n}let c=i.filter((({schedule:t})=>t.venueId===r&&ad(e,t.scheduledDate)));c.forEach((({schedule:e})=>{let t=zc(e.scheduledTime),i=qc(id(t,e.averageMinutes))-qc(t);a+=i}));let d=t?(a/t*100).toFixed(2):"100";o[e]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:t,scheduledMinutes:a,percentUtilization:d}})),{venueId:r,venueName:a,venueReport:o}}(s,e,d)))}}Oi(wO,{getEntryStatusReports:()=>PO,getParticipantStats:()=>TO,getStructureReports:()=>EO,getVenuesReport:()=>MO});var RO={};Oi(RO,{addCourtGridBooking:()=>WO,addMatchUpCourtOrder:()=>$C,addMatchUpEndTime:()=>qC,addMatchUpOfficial:()=>GC,addMatchUpResumeTime:()=>zC,addMatchUpScheduleItems:()=>jC,addMatchUpScheduledDate:()=>FC,addMatchUpScheduledTime:()=>OC,addMatchUpStartTime:()=>WC,addMatchUpStopTime:()=>HC,addSchedulingProfileRound:()=>gk,allocateTeamMatchUpCourts:()=>LC,assignMatchUpCourt:()=>BC,assignMatchUpVenue:()=>_C,bulkRescheduleMatchUps:()=>BO,bulkScheduleMatchUps:()=>kA,bulkScheduleTournamentMatchUps:()=>AA,bulkUpdateCourtAssignments:()=>xO,calculateScheduleTimes:()=>AO,clearMatchUpSchedule:()=>$O,clearScheduledMatchUps:()=>xA,courtGridRows:()=>kE,findMatchUpFormatTiming:()=>vE,findVenue:()=>WI,generateBookings:()=>DA,generateVirtualCourts:()=>qR,getMatchUpsToSchedule:()=>yE,getPersonRequests:()=>NE,getProfileRounds:()=>CE,getScheduledRoundsDetails:()=>SE,getSchedulingProfile:()=>wE,getSchedulingProfileIssues:()=>PE,matchUpScheduleChange:()=>jO,modifyMatchUpFormatTiming:()=>tR,mutate:()=>CO,proAutoSchedule:()=>OO,proConflicts:()=>LO,publicFindCourt:()=>zI,query:()=>gE,removeCourtGridBooking:()=>qO,removeEventMatchUpFormatTiming:()=>aR,removeMatchUpCourtAssignment:()=>kO,reorderUpcomingMatchUps:()=>_O,scheduleMatchUps:()=>FO,scheduleProfileRounds:()=>LA,setMatchUpDailyLimits:()=>GO,setMatchUpHomeParticipantId:()=>AC,setSchedulingProfile:()=>TE,toggleParticipantCheckInState:()=>aC,validateSchedulingProfile:()=>bE});var CO={};function AO({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:c,venueIds:d,endTime:u}){if("object"!=typeof a||!Object.keys(a).length)return{error:Hr};o=o??HR({recoveryMinutes:t,averageMatchUpMinutes:i});let{courts:l,venues:p}=cE({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=l?.filter((e=>!d||d.includes(e.venueId)));c||(c=m?.reduce(((e,t)=>{let i=t.dateAvailability?.find((e=>!e.date||ad(s,e.date)))?.startTime??t.startTime;return i&&(!e||qc(i)<qc(e))?i:e}),void 0)),u||(u=m?.reduce(((e,t)=>{let i=t.dateAvailability?.find((e=>!e.date||ad(s,e.date)))?.endTime??t.endTime;return i&&(!e||qc(i)>qc(e))?i:e}),void 0));let f=Object.values(a),h=Object.assign({},...f.map((e=>(e.events??[]).map((t=>{let{scheduleTiming:i}=zh({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:i}}})))).flat()),g=eM({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:d}}),I=g?.dateMatchUps??[],y=g?.completedMatchUps??[],v=[];v.push(...I),v.push(...y);let S={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:t}}]},U=v?.map((({eventId:e,schedule:t,matchUpFormat:i})=>{let{event:r,scheduleTiming:n}=h[e],a=r?.eventType,s={...n,defaultTiming:S,matchUpFormat:i},{averageMinutes:c,recoveryMinutes:d}=xI({eventType:a,timingDetails:s}),{courtId:u,venueId:l}=t,p=zc(t.scheduledTime),m=id(p,c);return{recoveryMinutes:d,averageMinutes:c,periodLength:o,startTime:p,endTime:m,courtId:u,venueId:l}})),b={calculateStartTimeFromCourts:e,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:c,endTime:u,bookings:U,courts:m},{scheduleTimes:w}=KR(b);return{venueId:1===d?.length&&d[0]||1===p?.length&&p[0].venueId||void 0,scheduleTimes:w,dateScheduledMatchUpIds:v.map(xm)}}function kO(e){let t=dp(e,[{[bl]:!0}]);if(t.error)return t;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:o,courtId:s,drawId:c}=e,d=r[n];if(!d)return{error:zr};let{drawDefinition:u,event:l}=Jw({tournamentRecord:d,drawId:c});if(!u)return{error:Jr};let p=cw({drawDefinition:u,event:l,matchUpId:o});if(p.error)return p;if(p?.matchUp?.matchUpType===$i){let{itemValue:e}=LI({timeItems:p.matchUp.timeItems??[],itemType:qg}),t=s&&e.filter((e=>e.courtId!==s));return iC({duplicateValues:!1,removePriorValues:i,tournamentRecord:d,drawDefinition:u,matchUpId:o,timeItem:{itemType:qg,itemValue:t}})}return BC({tournamentRecord:d,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:o})}function OO({scheduleCompletedMatchUps:e,tournamentRecords:t,scheduledDate:i,matchUps:r}){if(!Pg(r))return{error:Ho};if(r.some((({hasContext:e})=>!e)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Oo};let n=eM({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:t,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=e=>[(e.sides||[]).map((e=>[e.participantId,e.participant?.individualParticipantIds])),(e.potentialParticipants||[]).flat().map((e=>[e.participantId,e.individualParticipantIds]))].flat(1/0).filter(Boolean),c=a?.reduce(((e,t)=>{let i=[],r=[];Object.values(t).forEach((e=>{if(Rr(e)&&(e.matchUpId&&(i.push(e.matchUpId),o.push(e)),e.sides)){let t=s(e);r.push(...t)}}));let n=Object.values(t).filter((e=>Rr(e)&&!e.matchUpId&&!e.isBlocked));return e.concat({matchUpIds:i,availableCourts:n,rowId:t.rowId,participantIds:r})}),[]);r.filter((({matchUpStatus:t})=>t&&"BYE"!==t&&(e||!af.includes(t)))).sort(Uy);let d=Ey({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:t}).matchUpDependencies,u=[],l=[];for(;r.length&&c.length;){let e=c.shift(),t=[];for(;r.length&&e.availableCourts.length;){let i=r.concat(t).map((e=>e.matchUpId)),n=r.shift(),a=n?.matchUpId,o=a&&d[a].matchUpIds.concat(d[a].dependentMatchUpIds),c=a&&i.some((e=>d[a].matchUpIds.includes(e))),p=a&&l.some((e=>d[a].dependentMatchUpIds.includes(e))),m=e.matchUpIds.some((e=>o.includes(e))),f=s(n),h=e.participantIds.some((e=>f.includes(e)));if(!n||m||c||h||p)n&&t.push(n);else{let t=e.availableCourts.shift();Object.assign(n.schedule,t.schedule),Object.assign(t,n),u.push(n),e.participantIds.push(...f),e.matchUpIds.push(a)}}r.push(...t),l.push(...e.matchUpIds)}return n=kA({tournamentRecords:t,matchUpDetails:u.map((({matchUpId:e,tournamentId:t,schedule:r,drawId:n})=>({tournamentId:t,matchUpId:e,drawId:n,schedule:{...r,scheduledDate:i}})))}),{...n,scheduled:u,notScheduled:r}}function xO(e){let{courtDayDate:t}=e,i=dp(e,[{courtAssignments:!0,[rp]:Zl,[ip]:va},{[bl]:!0}]);if(i.error)return i;let r,n=e.courtAssignments.reduce(((e,t)=>{let{tournamentId:i}=t;return e[i]||(e[i]=[]),e[i].push(t),e}),{});return Object.keys(n).every((i=>{let a=e[bl][i];if(!a)return r={error:zr},!1;let o=n[i].reduce(((e,t)=>{let{drawId:i}=t;return e[i]||(e[i]=[]),e[i].push(t),e}),{});Object.keys(o).every((e=>{let{drawDefinition:i}=JI({tournamentRecord:a,drawId:e});return i?(o[e].every((e=>{let{matchUpId:n,courtId:o}=e,s=BC({tournamentRecord:a,drawDefinition:i,courtDayDate:t,matchUpId:n,courtId:o});if(s.success)return s?.success;r={error:Bo}})),!0):(r={error:Jr},!1)}))})),r||_r}function FO(e){let{tournamentRecords:t,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:c={},matchUpDailyLimits:d={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:l,clearScheduleDates:p,periodLength:m=30,scheduleDate:f,matchUpIds:h,venueIds:g,startTime:I,endTime:y,dryRun:v}=e,S=dp(e,[{[bl]:!0,[kl]:!0},{[ep]:Fc,[ip]:Pa,scheduleDate:!0},{[ep]:e=>!e||!isNaN(e),averageMatchUpMinutes:!1,[ip]:Ho,recoveryMinutes:!1,periodLength:!1}]);if(S.error)return S;let U=e.competitionMatchUps??Sy({nextMatchUps:!0,tournamentRecords:t}).matchUps??[],b=e.matchUpDependencies??Ey({includeParticipantDependencies:!0,matchUps:U,tournamentRecords:t}).matchUpDependencies;U.forEach((e=>{e.schedule?.scheduledDate&&ad(f,Yc(e.schedule.scheduledDate))&&IE({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:c,matchUp:e})}));let w=h.map((e=>U.find((t=>t.matchUpId===e)))).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=AO({tournamentRecords:t,remainingScheduleTimes:l,startTime:zc(I),endTime:zc(y),scheduleDate:Yc(f),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),N={},E=[],M={},R={},C={};U.filter((({matchUpId:e})=>P?.includes(e))).forEach((e=>{wA({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:e,value:1});let t=e.schedule?.scheduledTime;if(t){M[e.matchUpId]=t;let i=a?.[e.matchUpId];yA({recoveryMinutes:i||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:c,averageMatchUpMinutes:r,matchUpDependencies:b,scheduleTime:t,matchUp:e})}}));let A=w.filter((e=>{let t=P?.includes(e.matchUpId),i=["BYE",Gm,jm,_m,Km,Qm].includes(e?.matchUpStatus);return!t&&!e.winningSide&&!i})),{matchUpMap:k,overLimitMatchUpIds:O,participantIdsAtLimit:x}=A.reduce(((e,t)=>{let{drawId:i,tournamentId:r,matchUpType:n}=t,{participantIdsAtLimit:a,relevantParticipantIds:u}=CA({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:d,matchUp:t});return a?.length?(e.overLimitMatchUpIds.push(t.matchUpId),e.participantIdsAtLimit.push(...a),e):(u.forEach((e=>{IA({individualParticipantProfiles:s,participantId:e});let t=s[e].counters;t[n]?t[n]+=1:t[n]=1,t[TI]?t[TI]+=1:t[TI]=1})),e.matchUpMap[r]||(e.matchUpMap[r]={}),e.matchUpMap[r][i]?e.matchUpMap[r][i].push(t):e.matchUpMap[r][i]=[t],IE({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:c,matchUp:t}),e)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});A=A.filter((({matchUpId:e})=>!O.includes(e)));let F=0,L=D?.length??0,{personRequests:_}=NE({tournamentRecords:t,requestType:SA});for(;D?.length&&A.length&&F<=L;){F++;let{scheduleTime:e}=D.shift(),t=A.find((t=>{let{matchUpId:d}=t,{dependenciesScheduled:l,remainingDependencies:p}=gA({matchUpScheduleTimes:M,matchUpDependencies:b,allDateMatchUpIds:i,matchUp:t});if(!l)return C[d]||(C[d]=[]),C[d].push({scheduleTime:e,remainingDependencies:p}),!1;let{enoughTime:m}=MA({individualParticipantProfiles:s,matchUpNotBeforeTimes:c,matchUpDependencies:b,scheduleTime:e,matchUp:t});if(!m)return R[d]||(R[d]=[]),R[d].push({scheduleTime:e}),!1;let{conflicts:h}=bA({potentials:u,averageMatchUpMinutes:r,requestConflicts:N,personRequests:_,scheduleTime:e,scheduleDate:f,matchUp:t});if(h?.length)return!1;let g=a?.[t.matchUpId];return yA({recoveryMinutes:g||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:c,averageMatchUpMinutes:r,matchUpDependencies:b,scheduleTime:e,matchUp:t}),M[t.matchUpId]=e,!0}));A=A.filter((({matchUpId:e})=>e!==t?.matchUpId)),t||E.push(e)}A.forEach((e=>{wA({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:e})}));let B=[];Object.keys(k).forEach((e=>{let i=t[e];i&&Object.keys(k[e]).forEach((r=>{let{drawDefinition:n}=Jw({tournamentRecord:i,drawId:r});n&&k[e][r].forEach((({matchUpId:e})=>{let r=M[e];if(r){let a=r.split(":").map(nd).join(":"),o=`${Yc(f)}T${a}`;v?B.push(e):(OC({drawDefinition:n,matchUpId:e,scheduledTime:o}).success&&B.push(e),T&&_C({tournamentRecords:t,tournamentRecord:i,drawDefinition:n,matchUpId:e,venueId:T}))}}))}))}));let V=Am(A);return{..._r,requestConflicts:Object.values(N),remainingScheduleTimes:D?.map((({scheduleTime:e})=>e)),individualParticipantProfiles:s,matchUpNotBeforeTimes:c,participantIdsAtLimit:x,skippedScheduleTimes:E,overLimitMatchUpIds:O,scheduledMatchUpIds:B,noTimeMatchUpIds:V,recoveryTimeDeferred:R,dependencyDeferred:C}}function LO({tournamentRecords:e,matchUps:t}){if(!Pg(t))return{error:oa};if(t.some((({matchUpId:e,hasContext:t})=>e&&!t)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Oo};let i=gr(1,Math.max(...t.map((({schedule:e})=>e?.courtOrder||1)).map((e=>zi(e))))+1).map((e=>t.filter((t=>zi(t.schedule?.courtOrder)===e)))),r={},n={},a={};i.flat().filter(Boolean).sort(Uy).forEach((({schedule:e})=>delete e[AI]));let o=Ey({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:ar(t.map((({drawId:e})=>e)))}).matchUpDependencies,s=i.map(((e,t)=>e.reduce(((e,i)=>{if(!i.matchUpId)return e;let{matchUpId:s,winnerMatchUpId:c,loserMatchUpId:d,schedule:u,sides:l,potentialParticipants:p}=i,m=u?.courtId;r[s]=t,n[m]=[],e.matchUpIds.push(s),a[s]=i;let f=o[s].matchUpIds;f.length&&e.sourceMatchUpIds.push(...f);let h=l?.flatMap((e=>[e.participant?.individualParticipantIds,e.participantId])).flat().filter(Boolean)??[],g=p?.flat().flatMap((({individualParticipantIds:e,participantId:t})=>[e,t])).flat().filter(Boolean)||[];return e.participantIds.push(...g,...h),c&&e.targetMatchUpIds.push(c),d&&e.targetMatchUpIds.push(d),e}),{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]}))),c=s.map((()=>[])),d=(e,t,i)=>{t.participantIds.filter((t=>e.participantIds.includes(t))).forEach((r=>{let n=t.matchUpIds.concat(e.matchUpIds).filter((e=>o[e].participantIds.includes(r)));n.forEach((e=>{((e,t,i)=>{i[e]||(i[e]={}),i[e][MI]||(i[e][MI]=t.filter((t=>t!==e)))})(e,n,i)}))}))},u=e=>{let t={},i=dr(e.participantIds),r=new Set(Object.keys(i).filter((e=>i[e]>1))),n=e.matchUpIds.filter((e=>o[e].participantIds.some((e=>r.has(e)))));return n.forEach((e=>{((e,t,i)=>{i[e]||(i[e]={}),i[e][EI]||(i[e][EI]=t.filter((t=>t!==e)))})(e,n,t)})),t},l=(e,t,i,o)=>{if(!a[e].schedule[AI]){a[e].schedule[AI]=t,a[e].schedule[NI]=o,c[r[e]].push({matchUpId:e,issueType:i,issueIds:o,issue:t});let s=a[e].schedule.courtId;n[s]||(n[s]=[]),n[s].push({matchUpId:e,issue:t,issueType:i,issueIds:o})}};return s.forEach(((e,t)=>{let i=t?s[t-1]:void 0,r=s.slice(t+1),n=u(e);i&&d(i,e,n),e.matchUpIds.forEach((t=>{let s=o[t].matchUpIds;for(let e of r){let i=e.matchUpIds.filter((e=>s.includes(e)));i?.length&&(i.forEach((e=>l(e,RI,PI,[t]))),l(t,RI,PI,i))}if(n[t]?.[EI]&&l(t,EI,DI,n[t][EI]),e.sourceMatchUpIds.includes(t)){let i=e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t)));l(t,EI,PI,i),e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t))).forEach((e=>l(e,EI,PI,[t])))}let c=i?.matchUpIds?.filter((e=>((e,t)=>o[e].sources.reduce(((e,i,r)=>i.includes(t)&&r+1||e),0))(t,e)>1));if(c?.length&&(l(t,CI,PI,c),c.forEach((e=>l(e,CI,PI,[t])))),n[t]?.[MI]&&l(t,MI,DI,n[t][MI]),i?.targetMatchUpIds?.includes(t)){let e=a[t].schedule.courtId,r=s.filter((e=>i.matchUpIds.includes(e)));r.some((t=>a[t].schedule.courtId===e))||(r.forEach((e=>l(e,MI,PI,[t]))),l(t,MI,PI,r))}}))})),{courtIssues:n,rowIssues:c}}function _O(e){let t="reorderUpcomingMatchUps",{tournamentRecords:i}=e;if("object"!=typeof i||!Object.keys(i).length)return Qs({result:{error:Hr},stack:t});let{matchUpsContextIds:r,firstToLast:n}=e;if(!r)return Qs({result:{error:va},stack:t});let a=r?.length;if(!a)return{..._r};let o=0;return r.forEach(((e,t)=>{let{tournamentId:s,drawId:c,matchUpId:d}=e,u=t+(n?-1:1);u<0&&(u=a-1),u===a&&(u=0);let l=function({tournamentId:e,scheduledTime:t,matchUpId:r,drawId:n}){let a=i[e],{drawDefinition:o}=Jw({tournamentRecord:a,drawId:n});return o?OC({drawDefinition:o,scheduledTime:t,matchUpId:r}):{error:Zr}}({tournamentId:s,scheduledTime:r[u].schedule.scheduledTime,matchUpId:d,drawId:c});if(!l.success)return l;o++})),o===a?_r:Qs({result:{error:Lo},stack:t})}function BO(e){let{scheduleChange:t,matchUpIds:i,dryRun:r}=e;if(!i||!Array.isArray(i))return{error:na};if("object"!=typeof t)return{error:Ho};let n=sh(e),a=[],o=[];for(let c of Object.values(n)){let e=VO({tournamentRecord:c,scheduleChange:t,matchUpIds:i,dryRun:r});if(e.error)return e;Array.isArray(e.notRescheduled)&&o.push(...e.notRescheduled);let n=Am(e.notRescheduled),s=[];e.rescheduled?.forEach((e=>{let{matchUpId:t}=e;n.includes(t)&&s.push(t),a.push(e)})),s.length&&(o=e?.notRescheduled?.filter((({matchUpId:e})=>!s.includes(e)))||[])}let s=!(!a.length||o.length);return{..._r,rescheduled:a,notRescheduled:o,allRescheduled:s}}function VO({tournamentRecord:e,scheduleChange:t,matchUpIds:i,dryRun:r}){if(!e)return{error:zr};if(!i||!Array.isArray(i))return{error:na};if("object"!=typeof t)return{error:Ho};let n=[],a=[],{minutesChange:o,daysChange:s}=t;if(!o&&!s)return{..._r};if(o&&isNaN(o))return{error:Ho};if(s&&isNaN(s))return{error:Ho};let{matchUps:c}=vy({matchUpFilters:{matchUpIds:i},tournamentRecord:e}),d=c?.filter((e=>YE({schedule:e.schedule}))).filter((e=>(({matchUpStatus:e})=>!af.includes(e))({matchUpStatus:e.matchUpStatus})));if(!d?.length)return{..._r};let{tournamentInfo:u}=jN({tournamentRecord:e}),{startDate:l,endDate:p}=u,m=d?.reduce(((e,t)=>{let{matchUpId:i,drawId:r}=t;return e[r]?e[r].push(i):e[r]=[i],e}),{});for(let y of Object.keys(m)){let t=Jw({tournamentRecord:e,drawId:y});if(t.error)return t;let c=t.drawDefinition,u=m[y].filter((e=>i.includes(e)));for(let e of u)if(e&&c){let t,i,u,m=d.find((t=>t.matchUpId===e))?.schedule,{scheduledTime:f,scheduledDate:h}=m;if(!t&&s&&h){u=Kc(Yc(h),s),t=new Date(u)<new Date(l)||new Date(u)>new Date(p)}if(o&&f){let e=Yc(f),r=qc(zc(f))+o;if(t=r<0||r>1440,!t){let t=id(f,o),r=e&&u||h===e&&e;i=r?`${r}T${t}`:t}}if(t)a.push(e);else{if(!r){if(i){let t=OC({scheduledTime:i,drawDefinition:c,matchUpId:e});if(t.error)return t}if(u){let t=FC({scheduledDate:u,drawDefinition:c,matchUpId:e});if(t.error)return t}}(i||u)&&n.push(e)}}}let f=vy({matchUpFilters:{matchUpIds:i},tournamentRecord:e}).matchUps??[],h=f.filter((({matchUpId:e})=>n.includes(e))),g=f.filter((({matchUpId:e})=>a.includes(e))),I=h.length&&!g.length;return{..._r,rescheduled:h,notRescheduled:g,allRescheduled:I}}function jO(e){let t="matchUpScheduleChange",{tournamentRecords:i}=e;if("object"!=typeof i||!Object.keys(i).length)return{error:Hr};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=e||{},{drawId:c,matchUpId:d,tournamentId:u}=r||{},{drawId:l,matchUpId:p,tournamentId:m}=n||{};if(!d&&!p)return Qs({result:{error:va},stack:t});let{matchUps:f}=Sy({matchUpFilters:{matchUpIds:[d,p].filter(Boolean),drawIds:[c,l].filter(Boolean)},tournamentRecords:e.tournamentRecords}),h=f?.find((({matchUpId:e})=>e===d)),g=f?.find((({matchUpId:e})=>e===p)),I=0;if(o&&d&&!p){let e=y({tournamentId:u,matchUpId:d,courtId:o,matchUp:h,drawId:c,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(e?.success&&I++,e.error)return Qs({result:e,stack:t})}else{if(!(a&&o&&d&&p))return{error:va};{let e=y({tournamentId:u,matchUpId:d,courtId:o,matchUp:h,drawId:c,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(e.success&&I++,e.error)return Qs({result:e,stack:t,info:"source"});let r=y({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:l,tournamentRecords:i,courtDayDate:s});if(r.success&&I++,r.error)return Qs({result:r,stack:t,info:"target"})}}return I?_r:Qs({result:{error:_o},stack:t});function y(e){let{tournamentRecords:t,tournamentId:i,matchUp:r,drawId:n}=e,a=t[i],{drawDefinition:o}=Jw({tournamentRecord:a,drawId:n});return r.matchUpType===Gi?function({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:r,sourceCourtId:n,courtDayDate:a,matchUpId:o,matchUp:s,courtId:c}){let d=[c].concat(s.schedule.allocatedCourts.map((({courtId:e})=>e)).filter((e=>e!==n)));return LC({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:r,courtDayDate:a,matchUpId:o,courtIds:d})}({...e,tournamentRecord:a,drawDefinition:o}):BC({...e,tournamentRecord:a,drawDefinition:o})}}function $O({scheduleAttributes:e=[qg,Hg,Wg,Yg,Jg,Qg,tI,eI,Zg],tournamentRecord:t,drawDefinition:i,matchUpId:r}){let n=i?by({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps?.[0]:vy({matchUpFilters:{matchUpIds:[r]},tournamentRecord:t,inContext:!1}).matchUps?.[0];if(!n)return{error:aa};let a=(n.timeItems??[]).filter((t=>t?.itemType&&!e.includes(t?.itemType)));return n.timeItems=a,Jf({tournamentId:t.tournamentId,context:"clearMatchUpSchedule",drawDefinition:i,matchUp:n}),{..._r}}function GO(e){let{tournamentRecord:t,tournamentId:i,dailyLimits:r}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if("object"!=typeof n||!Object.keys(n).length)return{error:Hr};if("object"!=typeof r)return{error:Go};let a=Object.keys(n).filter((e=>!i||i===e));if(i&&!a.includes(i))return{error:Ho};for(let o of a){let e=n[o],t=Vp({extension:{name:gm,value:{dailyLimits:r}},element:e});if(t.error)return t}return{..._r}}function WO(e){let{tournamentRecord:t,disableNotice:i,scheduledDate:r,bookingType:n,courtOrder:a,rowCount:o=1,courtId:s,notes:c}=e;if(!t)return Qs({result:{error:Ho},info:"tournamentRecord is required"});if(!s)return{error:yo};if(!r)return Qs({result:{error:Ho},info:"scheduledDate is required"});if(!n)return Qs({result:{error:Ho},info:"bookingType is required"});if(null==a)return Qs({result:{error:Ho},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return Qs({result:{error:Ho},info:"courtOrder must be a positive integer"});if(!Number.isInteger(o)||o<1)return Qs({result:{error:Ho},info:"rowCount must be a positive integer"});let{court:d,venue:u}=HI({tournamentRecord:t,courtId:s});if(!d)return{error:yo};if(!AE({court:d,date:r})){d.dateAvailability||(d.dateAvailability=[]);let e={date:r,bookings:[]};d.dateAvailability.push(e)}let l=AE({court:d,date:r});if(l.bookings)for(let m of l.bookings)if("number"==typeof m.courtOrder){let e=m.courtOrder,t=e+(m.rowCount||1)-1;if(a<=t&&a+o-1>=e)return Qs({result:{error:Uo},info:`Booking conflicts with existing booking at rows ${e}-${t}`})}let p={courtOrder:a,rowCount:o,bookingType:n,notes:c,createdAt:(new Date).toISOString()};return l.bookings||(l.bookings=[]),l.bookings.push(p),!i&&u&&As({payload:{venue:u,tournamentId:t.tournamentId},topic:Ff,key:u.venueId}),{..._r,booking:p}}function qO(e){let{tournamentRecord:t,disableNotice:i,scheduledDate:r,courtOrder:n,courtId:a}=e;if(!t)return Qs({result:{error:Ho},info:"tournamentRecord is required"});if(!a)return{error:yo};if(!r)return Qs({result:{error:Ho},info:"scheduledDate is required"});if(null==n)return Qs({result:{error:Ho},info:"courtOrder is required"});let{court:o,venue:s}=HI({tournamentRecord:t,courtId:a});if(!o)return{error:yo};let c=AE({court:o,date:r});if(!c?.bookings)return Qs({result:{error:So},info:"No bookings found for this date"});let d=c.bookings.findIndex((e=>e.courtOrder===n));if(-1===d)return Qs({result:{error:So},info:`No booking found at row ${n}`});let u=c.bookings.splice(d,1)[0];return!i&&s&&As({payload:{venue:s,tournamentId:t.tournamentId},topic:Ff,key:s.venueId}),{..._r,booking:u}}Oi(CO,{addCourtGridBooking:()=>WO,addMatchUpCourtOrder:()=>$C,addMatchUpEndTime:()=>qC,addMatchUpOfficial:()=>GC,addMatchUpResumeTime:()=>zC,addMatchUpScheduleItems:()=>jC,addMatchUpScheduledDate:()=>FC,addMatchUpScheduledTime:()=>OC,addMatchUpStartTime:()=>WC,addMatchUpStopTime:()=>HC,addSchedulingProfileRound:()=>gk,allocateTeamMatchUpCourts:()=>LC,assignMatchUpCourt:()=>BC,assignMatchUpVenue:()=>_C,bulkRescheduleMatchUps:()=>BO,bulkScheduleMatchUps:()=>kA,bulkScheduleTournamentMatchUps:()=>AA,bulkUpdateCourtAssignments:()=>xO,calculateScheduleTimes:()=>AO,clearMatchUpSchedule:()=>$O,clearScheduledMatchUps:()=>xA,findMatchUpFormatTiming:()=>vE,generateBookings:()=>DA,generateVirtualCourts:()=>qR,matchUpScheduleChange:()=>jO,modifyMatchUpFormatTiming:()=>tR,proAutoSchedule:()=>OO,proConflicts:()=>LO,removeCourtGridBooking:()=>qO,removeEventMatchUpFormatTiming:()=>aR,removeMatchUpCourtAssignment:()=>kO,reorderUpcomingMatchUps:()=>_O,scheduleMatchUps:()=>FO,scheduleProfileRounds:()=>LA,setMatchUpDailyLimits:()=>GO,setMatchUpHomeParticipantId:()=>AC,setSchedulingProfile:()=>TE,toggleParticipantCheckInState:()=>aC,validateSchedulingProfile:()=>bE});var HO={};Oi(HO,{addCollectionDefinition:()=>dx,addCollectionGroup:()=>cx,aggregateTieFormats:()=>mx,compareTieFormats:()=>ZN,getTieFormat:()=>rE,modifyCollectionDefinition:()=>ZO,modifyTieFormat:()=>px,mutate:()=>zO,orderCollectionDefinitions:()=>rx,query:()=>JN,removeCollectionDefinition:()=>sx,removeCollectionGroup:()=>tx,tieFormatGenderValidityCheck:()=>pc,validateCollectionDefinition:()=>pd});var zO={};function YO({drawDefinition:e,structureId:t,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){let s,c="getTieFormat";if(t=r?.structureId??t,((i=n?.matchUpId??i)||t)&&!e)return{error:Jr};if(a&&o)s=vg(o);else if(i){if(e&&(!n||!r)){let t=cw({drawDefinition:e,matchUpId:i});if(t.error)return t;if(t.matchUp?.matchUpType!==$i)return Qs({result:{error:ca},stack:c});r||(r=t.structure),n||(n=t.matchUp)}s=Sg({item:n,drawDefinition:e,structure:r,event:o})||Sg({item:r,drawDefinition:e,structure:r,event:o})||vg(e)||vg(o)}else if(e&&t){if(!r){let i=lf({drawDefinition:e,structureId:t});if(i.error)return i;r=i?.structure}s=Sg({item:r,drawDefinition:e,structure:r,event:o})||vg(e)||vg(o)}else s=vg(e)||vg(o);return s?{..._r,structure:r,tieFormat:s,matchUp:n}:Qs({result:{error:ia},stack:c})}function KO({matchUp:e,updateInProgressMatchUps:t}){return!e.winningSide&&![af].includes(e.matchUpStatus)&&(t||e.matchUpStatus!==Hm&&!My(e))}function XO({from:e,to:t}){let i=Object.keys(e),r=yr(i,Object.keys(t)).length===i.length,n=i.filter((i=>e[i]!==t[i])).map((i=>({countChange:t[i]-e[i],collectionId:i}))),a=i.every((i=>e[i]===t[i]));return{equivalent:r&&a,matchUpsCountChanges:n}}function JO({check:e,matchUp:t}){let i="",r=[];return{changesArePossible:e.matchUpsCountChanges.every((({collectionId:e,countChange:n})=>{let a=t.tieMatchUps.filter((t=>t.collectionId===e&&t.matchUpStatus===Jm)).map(Dy("matchUpId")),o=a.length+n>=0||n>0;return!o&&n<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:a,collectionId:e,countChange:n}),o})),changes:r,cannotChangeReaon:i}}function QO({appliedPolicies:e,drawDefinition:t,auditData:i}){if(!e?.audit?.[Um])return;let{extension:r}=Jp({name:Um,element:t});Vp({element:t,extension:{value:Array.isArray(r?.value)?r?.value.concat(i):[i],name:Um}})}function ZO({updateInProgressMatchUps:e=!1,tournamentRecord:t,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:c,matchUpType:d,structureId:u,matchUpId:l,category:p,eventId:m,gender:f,event:h,collectionValueProfiles:g,collectionValue:I,matchUpValue:y,scoreValue:v,setValue:S}){let U="modifyCollectionDefinition";if(o&&!Ec({matchUpFormat:o}))return Qs({result:{error:Ho},context:{matchUpFormat:o},stack:U});if(r&&"string"!=typeof r)return Qs({result:{error:Ho},context:{collectionName:r},stack:U});if(f&&!Object.values(rc).includes(f))return Qs({result:{error:Ho},context:{gender:f},stack:U});if(p&&"object"!=typeof p)return Qs({result:{error:Ho},context:{category:p},stack:U});let b={collectionValueProfiles:g,collectionValue:I,matchUpValue:y,scoreValue:v,setValue:S};if(!(Object.values(b).filter(Boolean).length||i||r||o||s||d))return Qs({result:{error:va},stack:U});if(Object.values(b).filter(Boolean).length>1)return Qs({info:"Only one value assignment allowed per collectionDefinition",result:{error:Ho},stack:U});let w=YO({drawDefinition:a,structureId:u,matchUpId:l,eventId:m,event:h});if(w.error)return Qs({result:w,stack:U});let{matchUp:T,structure:D,tieFormat:P}=w,N=yw(P),E=P?.collectionDefinitions.find((e=>e.collectionId===c)),M=N?.collectionDefinitions.find((e=>e.collectionId===c));if(!E)return Qs({info:"source collectionDefinition",result:{error:Qo},context:{collectionId:c},stack:U});let R=I??y??v??S;if(g?.length){let e=jr({matchUpCount:s??E?.matchUpCount??0,collectionValueProfiles:g});if(e.errors)return Qs({result:{error:Ho},info:e.errors,stack:U})}else if(R&&!ir(R))return Qs({result:{error:Ho},info:"value is not an integer",context:{value:R},stack:U});let C=g&&(!E.collectionValueProfiles||(k=E.collectionValueProfiles,O=g,!(yr(Object.keys(k),Object.keys(O)).length===Object.keys(k).length&&yr(Object.values(k),Object.values(O)).length===Object.values(k).length))),A=[];var k,O;if((ir(I)&&E.collectionValue!==I||ir(y)&&E.matchUpValue!==y||ir(v)&&E.scoreValue!==v||ir(S)&&E.setValue!==S||C)&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,b),A.push({collectionId:c,...Js(b)})),(ir(v)||ir(S))&&M.collectionGroupNumber){let e=M.collectionGroupNumber;N.collectionDefinitions=N.collectionDefinitions.map((t=>{let{collectionGroupNumber:i,...r}=t;return i===e?r:t})),N.collectionGroups=N.collectionGroups.filter((({groupNumber:t})=>t!==e)),A.push({collectionId:c,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:F}=aM(N),L=Js({aggregateValue:x,valueGoal:F});if((L.aggregateValue!==P?.winCriteria.aggregateValue||L.valueGoal!==P?.winCriteria.valueGoal)&&(N.winCriteria=L,A.push({collectionId:c,winCriteria:L})),ir(i)&&E.collectionOrder!==i&&(M.collectionOrder=i,A.push({collectionId:c,collectionOrder:i})),r&&E.collectionName!==r&&(M.collectionName=r,A.push({collectionId:c,collectionName:r})),o&&E.matchUpFormat!==o&&(M.matchUpFormat=o,A.push({collectionId:c,matchUpFormat:o})),ir(s)&&E.matchUpCount!==s&&(M.matchUpCount=s,A.push({collectionId:c,matchUpCount:s})),d&&E.matchUpType!==d)return Qs({result:{error:Zo},context:{matchUpType:d},stack:U});p&&E.category!==p&&(M.category=p,A.push({collectionId:c,category:p})),f&&E.gender!==f&&(M.gender=f,A.push({collectionId:c,gender:f}));let _=Js(N);if(w=md({tieFormat:_}),w.error)return Qs({result:w,stack:U});if(!A.length)return Qs({result:{..._r,modifications:A}});if(P?.tieFormatName!==n?(_.tieFormatName=n,A.push({tieFormatName:n})):A.length&&(delete _.tieFormatName,A.push("tieFormatName removed: modifications without new tieFormatName")),w=function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:c}){let d="updateTieFormat",u=t?.tournamentId,l=0,p=0,m=0,f=0,h=n?.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{}),g=({tieFormat:e})=>{let t=e?.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{});return XO({from:t,to:h}).equivalent},I=YO({drawDefinition:i})?.tieFormat,y=YO({event:s})?.tieFormat;if(s&&a){for(let e of s.drawDefinitions??[])v({drawDefinition:e});s.tieFormat=yw(n),f+=1}else if(o){if(!o.tieMatchUps)return Qs({result:{error:ca},stack:d});let t=dr(o.tieMatchUps?.map((({collectionId:e})=>e))),r=XO({to:h,from:t}),{changes:a,changesArePossible:l,cannotChangeReaon:m}=JO({matchUp:o,check:r});if(r.equivalent){if(!KO({matchUp:o,updateInProgressMatchUps:e}))return Qs({result:{error:ka},info:"matchUp is IN_PROGRESS or COMPLETE",stack:d});o.tieFormat=yw(n),f+=1}else{if(!l)return Qs({context:{collectionMap:h,matchUpMap:t},result:{error:Qn},info:m||"specified changes not possible",stack:d});U({tieFormat:n,matchUp:o,changes:a,uuids:c})}p+=1,Jf({eventId:s?.eventId,context:d,drawDefinition:i,tournamentId:u,matchUp:o})}else if(r){let e=S({inheritedTieFormat:I??y,structure:r})?.modifiedMatchUpsCount;e&&(p+=e,l+=1,f+=1);let t=!r.tieFormat||ZN({ancestor:r.tieFormat,descendant:n}).different;t&&(r.tieFormat=yw(n),l+=1,f+=1),(e||t)&&i&&Zf({structureIds:[r.structureId],eventId:s?.eventId,drawDefinition:i})}else{if(!i)return{error:Jr};v({drawDefinition:i}),i.tieFormat=yw(n),f+=1}return{modifiedStructuresCount:l,modifiedMatchUpsCount:p,addedMatchUpsCount:m,modifiedCount:f,..._r,tieFormat:n};function v({drawDefinition:e}){let t=e.structures||[],i=[];for(let r of t){if(r.tieFormat)continue;let e=S({inheritedTieFormat:y,structure:r})?.modifiedMatchUpsCount;if(e){l+=1,p+=e;let t=r.structureId;i.push(t)}}return Zf({structureIds:i,eventId:s?.eventId,drawDefinition:e}),i.length}function S({inheritedTieFormat:r,structure:o}){let s=0,u=oy({matchUpFilters:{matchUpTypes:[Gi]},structure:o})?.matchUps||[];for(let l of u){let o=KO({matchUp:l,updateInProgressMatchUps:e}),u=!1,p=XO({from:dr(l.tieMatchUps?.map((({collectionId:e})=>e))),to:h});if(p.equivalent)l.tieFormat&&g(l)&&o&&(l.tieFormat=yw(n),u=!0);else{let{changes:e,changesArePossible:t}=JO({matchUp:l,check:p});if(t&&!l.tieFormat)U({changes:e,matchUp:l,tieFormat:n,uuids:c});else{if(!r)return Qs({result:{error:ia},stack:d});(!l.tieFormat||ZN({ancestor:r,descendant:l.tieFormat}).different)&&(l.tieFormat=r,u=!0)}}u&&(s+=1,Jf({tournamentId:t?.tournamentId,drawDefinition:i,context:d,eventId:a,matchUp:l}))}return{modifiedMatchUpsCount:s}}function U({uuids:e,matchUp:t,tieFormat:r,changes:n}){t.tieFormat=yw(r);let o=[],s=[];return n.forEach((i=>{if(i.countChange>0){let n=Math.max(0,...t.tieMatchUps.filter((e=>e.collectionId===i.collectionId)).map(Dy("collectionPosition"))),a=r.collectionDefinitions.find((e=>e.collectionId===i.collectionId)),o=ob({matchUpsLimit:i.countChange,collectionPositionOffset:n,collectionDefinition:a,matchUp:t,uuids:e});s.push(...yd(o,!1,!0)),m+=s.length,t.tieMatchUps.push(...o)}else{let e=i.toBePlayedTieMatchUpIds.slice(0,Math.abs(i.countChange));console.log("remove",e.length),o.push(...e),t.tieMatchUps=t.tieMatchUps.filter((({matchUpId:t})=>!e.includes(t)))}})),s.length&&Kf({matchUps:s,drawDefinition:i,tournamentId:u,eventId:a}),o.length&&Xf({matchUpIds:o,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:o,matchUpsAdded:s}}}({tieFormat:_,updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:a,structure:D,eventId:m,matchUp:T,event:h}),!w.error){let{appliedPolicies:e}=Fh({tournamentRecord:t});QO({appliedPolicies:e,drawDefinition:a,auditData:Js({collectionDefinition:M,drawId:a?.drawId,action:U,structureId:u,matchUpId:l,eventId:m})})}return Qs({result:{...w,modifications:A},stack:U})}function ex({updateInProgressMatchUps:e,originalValueGoal:t,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:c,matchUpId:d,matchUp:u,eventId:l,event:p}){let{aggregateValue:m,valueGoal:f}=aM(c);c.winCriteria=Js({aggregateValue:m,valueGoal:f}),(t&&t!==f||m&&!r)&&(n?c.tieFormatName=n:delete c.tieFormatName);let{targetMatchUps:h}=function({updateInProgressMatchUps:e,drawDefinition:t,structureId:i,structure:r,matchUpId:n,matchUp:a}){let o=[];return n&&a?o=[a]:i&&r?o=oy({matchUpFilters:{matchUpTypes:[Gi]},structure:r})?.matchUps??[]:t&&(o=by({matchUpFilters:{matchUpTypes:[Gi]},drawDefinition:t})?.matchUps??[]),{targetMatchUps:o.filter((t=>!t.winningSide&&t.matchUpStatus!==jm&&(e||t.matchUpStatus!==Hm&&!My(t))))}}({updateInProgressMatchUps:e,drawDefinition:a,structureId:o,structure:s,matchUpId:d,matchUp:u});!function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let r,s=!!o.tieFormat;if(s&&(o.tieFormat=yw(n)),e){let e=Fh({tournamentRecord:t,drawDefinition:i,event:a}).appliedPolicies,n=Uw({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:t,appliedPolicies:e,drawDefinition:i,event:a});if(n.error)return n;r=n.score}s&&!r&&Jf({tournamentId:t?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:o,drawDefinition:i})}}({updateInProgressMatchUps:e,tournamentRecord:i,targetMatchUps:h,drawDefinition:a,tieFormat:c,event:p});let g=Js(c),I=md({tieFormat:g});if(I.error)return I;if(l&&p)p.tieFormat=g;else if(d&&u)u.tieFormat=c;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:Jr};return Zf({drawDefinition:a,eventId:p?.eventId}),{..._r}}function tx({updateInProgressMatchUps:e=!0,collectionGroupNumber:t,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:c,event:d}){if(!t)return{error:va};if(isNaN(t))return{error:Ho};let u="removeCollectionGroup",l=s?void 0:YO({drawDefinition:r,structureId:a,matchUpId:o,eventId:c,event:d});if(l?.error)return Qs({result:l,stack:u});let p=l?.structure;s=s??l?.matchUp;let m=l?.tieFormat,f=m?.winCriteria.valueGoal,h=m?.winCriteria.aggregateValue,g=yw(m);if(l=md({tieFormat:g}),l.error)return Qs({result:l,stack:u});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map((e=>{let{collectionGroupNumber:i,...r}=e;return i!==t?e:(I.push(e.collectionId),r)})),g.collectionGroups=g.collectionGroups.filter((({groupNumber:e})=>e!==t)),l=ex({updateInProgressMatchUps:e,originalValueGoal:f,wasAggregateValue:h,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:c,event:d}),!l.error){let{appliedPolicies:e}=Fh({tournamentRecord:i});QO({appliedPolicies:e,drawDefinition:r,auditData:Js({drawId:r?.drawId,collectionGroupNumber:t,action:u,structureId:a,matchUpId:o,eventId:c})})}return Qs({result:{...l,modifiedCollectionIds:I},stack:u})}function ix({tieFormat:e,orderMap:t}){let i=yw(e);return i.collectionDefinitions?.forEach((e=>{let i=t[e.collectionId];i&&(e.collectionOrder=i)})),i.collectionDefinitions?.sort(((e,t)=>cr(e.collectionOrder)-cr(t.collectionOrder))),i}function rx({tournamentRecord:e,drawDefinition:t,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if("object"!=typeof n||!Object.values(n).every((e=>ir(e))))return Qs({result:{error:Ho},context:{orderMap:n}});let c=i?lf({drawDefinition:t,structureId:i}):void 0;if(c?.error)return c;let d=c?.structure;if(a&&s?.tieFormat)nx({tournamentRecord:e,event:s,orderMap:n});else if(r){let i=t&&cw({drawDefinition:t,matchUpId:r});if(i?.error)return i;if(!(o=i.matchUp))return{error:sa};let a=rE({tournamentRecord:e,matchUpId:r,structure:d,drawDefinition:t,event:s})?.tieFormat;o.tieFormat=ix({tieFormat:a,orderMap:n}),Jf({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:t,matchUp:o})}else if(i)if(d?.tieFormat)d.tieFormat=ix({tieFormat:d.tieFormat,orderMap:n}),ox({eventId:s?.eventId,tournamentRecord:e,drawDefinition:t,structure:d,orderMap:n}),Zf({drawDefinition:t,structureIds:[d.structureId]});else if(t.tieFormat)ax({structureIds:[i],tournamentRecord:e,drawDefinition:t,orderMap:n,event:s});else{if(!s?.tieFormat)return{error:Qo};nx({structureIds:[i],tournamentRecord:e,orderMap:n,event:s})}else{if(!t?.tieFormat)return{error:Qo};ax({tournamentRecord:e,drawDefinition:t,orderMap:n,event:s})}return{..._r}}function nx({tournamentRecord:e,structureIds:t,orderMap:i,event:r}){let n=ix({tieFormat:r.tieFormat,orderMap:i});t?.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])ax({tournamentRecord:e,drawDefinition:a,structureIds:t,orderMap:i,event:r})}function ax({tournamentRecord:e,drawDefinition:t,structureIds:i,orderMap:r,event:n}){let a=ix({tieFormat:t.tieFormat??n?.tieFormat,orderMap:r});i?.length||(t.tieFormat=a);let o=[];for(let s of t.structures??[])i?.length&&!i.includes(s.structureId)||((s.tieFormat||i?.includes(s.structureId))&&(s.tieFormat=ix({tieFormat:s.tieFormat??t.tieFormat??n?.tieFormat,orderMap:r})),ox({eventId:n?.eventId,tournamentRecord:e,drawDefinition:t,structure:s,orderMap:r}),o.push(s.structureId));Zf({drawDefinition:t,structureIds:o})}function ox({tournamentRecord:e,drawDefinition:t,structure:i,orderMap:r,eventId:n}){let a=oy({matchUpFilters:{matchUpTypes:[Gi]},structure:i})?.matchUps;for(let o of a)o.tieFormat&&(o.tieFormat=ix({tieFormat:o.tieFormat,orderMap:r}),Jf({tournamentId:e?.tournamentId,drawDefinition:t,eventId:n,matchUp:o}))}function sx({updateInProgressMatchUps:e=!0,tieFormatComparison:t,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:c,matchUp:d,event:u}){let l="removeCollectionDefinition",p=d?void 0:YO({drawDefinition:r,structureId:o,matchUpId:s,eventId:c,event:u});if(p?.error)return Qs({result:p,stack:l});let m=p?.structure;d=d??p?.matchUp;let f=p?.tieFormat,h=yw(f);if(p=md({tieFormat:h}),p.error)return Qs({result:p,stack:l});let g=h?.collectionDefinitions?.find((e=>e.collectionId===a));if(!g)return Qs({result:{error:Qo,collectionId:a}});h.collectionDefinitions=h.collectionDefinitions.filter((e=>e.collectionId!==a)),g.collectionGroupNumber&&(h.collectionDefinitions=h.collectionDefinitions.map((e=>{let{collectionGroupNumber:t,...i}=e;return i})),h.collectionGroups=h.collectionGroups.filter((({groupNumber:e})=>e!==g.collectionGroupNumber)));let{aggregateValue:I,valueGoal:y}=aM(h);h.winCriteria=Js({aggregateValue:I,valueGoal:y});let v=f?.winCriteria.valueGoal,S=f?.winCriteria.aggregateValue;(v&&v!==y||I&&!S)&&(n?h.tieFormatName=n:delete h.tieFormatName);let U=[];s&&d?U=[d]:o&&m?U=oy({matchUpFilters:{matchUpTypes:[Gi]},structure:m})?.matchUps??[]:r?U=by({matchUpFilters:{matchUpTypes:[Gi]},drawDefinition:r})?.matchUps??[]:u&&(U=yy({matchUpFilters:{matchUpTypes:[Gi]}})?.matchUps??[]);let b=(U||[]).filter((i=>{let r=i.tieMatchUps?.filter((e=>e.collectionId===a))?.some(My),n=!(!t||!i.tieFormat)&&ZN({descendant:i.tieFormat,ancestor:h})?.different;return e&&!r||!i.winningSide&&i.matchUpStatus!==jm&&(e||i.matchUpStatus!==Hm&&!My(i)&&!n)}));if(!b.length)return{error:_o};let{appliedPolicies:w}=Fh({tournamentRecord:i});if(s&&d&&e){let e=d.tieMatchUps?.filter((e=>e.collectionId===a));for(let t of e??[]){let e=YC({matchUpId:t.matchUpId,tieMatchUpId:d?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:w,drawDefinition:r,event:u});if(e.error||(e=cw({drawDefinition:r,matchUpId:s}),e.error))return e;d=e?.matchUp}}let T=[];for(let P of b){for(let e of P?.sides??[])e.lineUp=(e.lineUp??[]).map((e=>({participantId:e.participantId,collectionAssignments:(e?.collectionAssignments??[]).filter((e=>e.collectionId!==a))})));if(P.tieMatchUps=(P.tieMatchUps??[]).filter((e=>{let t=e.collectionId===a;return t&&T.push(e.matchUpId),!t})),P.tieFormat&&(P.tieFormat=yw(h)),e){let e=Uw({matchUpId:P.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:w,drawDefinition:r,event:u});if(e.error)return e}Jf({tournamentId:i?.tournamentId,eventId:u?.eventId,drawDefinition:r,context:l,matchUp:P})}T.length&&Xf({tournamentId:i?.tournamentId,matchUpIds:T,eventId:u?.eventId,drawDefinition:r});let D=Js(h);if(p=md({tieFormat:D}),p.error)return Qs({result:p,stack:l});if(c&&u)u.tieFormat=D;else if(s&&d)d.tieFormat=D;else if(m)m.tieFormat=D;else if(r)r.tieFormat=D;else if(!d||!r)return{error:Jr};return Zf({drawDefinition:r,eventId:u?.eventId}),QO({appliedPolicies:w,drawDefinition:r,auditData:Js({drawId:r?.drawId,action:l,collectionId:a,structureId:o,matchUpId:s,eventId:c})}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:b,..._r}}function cx({updateInProgressMatchUps:e=!0,tournamentRecord:t,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:c,eventId:d,event:u}){let l="addCollectionGroup";if(!Array.isArray(n))return Qs({result:{error:va},stack:l});let p=c?void 0:YO({drawDefinition:r,structureId:o,matchUpId:s,eventId:d,event:u});if(p?.error)return Qs({result:p,stack:l});let m=p?.structure;c=c||p?.matchUp;let f=p?.tieFormat,h=f?.winCriteria.valueGoal,g=yw(f);if(p=md({tieFormat:g}),p.error)return Qs({result:p,stack:l});for(let y of g.collectionDefinitions){let{collectionId:e,collectionGroupNumber:t}=y;if(t&&n.includes(e))return Qs({info:"collectionIds cannot be part of other collectionGroups",result:{error:Ho},stack:l})}let I=(g.collectionGroups||[]).reduce(((e,t)=>t.groupNumber>e?t.groupNumber:e),0)+1;return i.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map((e=>n.includes(e.collectionId)?{...e,collectionGroupNumber:I}:e)),g.collectionGroups=[...g.collecitonGroups||[],i],ex({updateInProgressMatchUps:e,originalValueGoal:h,tournamentRecord:t,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:c,eventId:d,event:u})}function dx({updateInProgressMatchUps:e=!0,collectionDefinition:t,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:c,enforceGender:d,structureId:u,matchUpId:l,matchUp:p,eventId:m,uuids:f,event:h}){let g="addCollectionDefinition",I=Fh({tournamentRecord:r,drawDefinition:s,event:h}).appliedPolicies??{},y=n?.[wp]??I?.[wp];a=a??y?.participants?.enforceCategory;let v=!1!==(d??y?.participants?.enforceGender),S=!(!(i??h?.category)||!1===a),U=!(!(o??h?.gender)||!v),b=pd({referenceCategory:i??h?.category,collectionDefinition:t,referenceGender:o,checkCategory:S,checkGender:U,event:h});if(b.error)return Qs({result:b,stack:g});let w=p?.tieFormat?void 0:YO({drawDefinition:s,structureId:u,matchUpId:l,eventId:m,event:h});if(w?.error)return Qs({result:{error:w.error},stack:g});let T=w?.structure;p=p??w?.matchUp;let D=p?.tieFormat??w?.tieFormat,P=yw(D);if(w=md({tieFormat:P}),w?.error)return Qs({result:{error:w.error},stack:g});if(t.collectionId){if(P.collectionDefinitions.map((({collectionId:e})=>e)).includes(t.collectionId))return Qs({context:{collectionId:t.collectionId},result:{error:zo}})}else t.collectionId=Ud();P.collectionDefinitions.push(t),P.collectionDefinitions.sort(((e,t)=>(e.collectionOrder||0)-(t.collectionOrder||0))).forEach(((e,t)=>e.collectionOrder=t+1));let{aggregateValue:N,valueGoal:E}=aM(P);P.winCriteria=Js({aggregateValue:N,valueGoal:E});let M=D?.winCriteria.valueGoal,R=D?.winCriteria.aggregateValue;(M&&M!==E||N&&!R)&&(c?P.tieFormatName=c:delete P.tieFormatName);let C=[],A=[],k=[],O=Js(P);if(w=md({tieFormat:O}),w?.error)return Qs({result:{error:w.error},stack:g});if(m&&h){h.tieFormat=O;for(let i of h.drawDefinitions??[])if(!i.tieFormat)for(let r of i.structures??[]){if(r.tieFormat)continue;let i=ux({updateInProgressMatchUps:e,collectionDefinition:t,structure:r,uuids:f});A.push(...i.newMatchUps),k.push(...i.targetMatchUps),C.push(r.structureId)}lx({modifiedMatchUps:k,eventId:h?.eventId,modifiedStructureIds:C,tournamentRecord:r,drawDefinition:s,addedMatchUps:A,stack:g})}else if(u&&T){T.tieFormat=O;let i=ux({updateInProgressMatchUps:e,collectionDefinition:t,structure:T,uuids:f});A.push(...i.newMatchUps),k=i.targetMatchUps,lx({modifiedMatchUps:k,eventId:h?.eventId,modifiedStructureIds:C,tournamentRecord:r,drawDefinition:s,addedMatchUps:A,stack:g})}else if(l&&p){if(!KO({matchUp:p,updateInProgressMatchUps:e}))return Qs({result:{error:ka},stack:g});p.tieFormat=O;let i=ob({collectionDefinition:t,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...i),A.push(...i),lx({modifiedMatchUps:[p],eventId:h?.eventId,modifiedStructureIds:C,tournamentRecord:r,drawDefinition:s,addedMatchUps:A,stack:g})}else{if(!s)return{error:Jr};s.tieFormat=O;for(let i of s.structures??[]){let r=ux({updateInProgressMatchUps:e,collectionDefinition:t,structure:i,uuids:f});C.push(i.structureId),A.push(...r.newMatchUps),k.push(...r.targetMatchUps)}lx({modifiedMatchUps:k,eventId:h?.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:A,stack:g})}return QO({appliedPolicies:I,drawDefinition:s,auditData:Js({drawId:s?.drawId,collectionDefinition:t,action:g,structureId:u,matchUpId:l,eventId:m})}),{tieFormat:O,targetMatchUps:k,addedMatchUps:A,..._r}}function ux({updateInProgressMatchUps:e,collectionDefinition:t,structure:i,uuids:r}){let n=[],a=(oy({matchUpFilters:{matchUpTypes:[Gi]},structure:i})?.matchUps).filter((t=>KO({matchUp:t,updateInProgressMatchUps:e})&&!t.tieFormat));for(let o of a){let e=ob({collectionDefinition:t,matchUp:o,uuids:r});Array.isArray(o.tieMatchUps)||(o.tieMatchUps=[]),o.tieMatchUps.push(...e),n.push(...e)}return{newMatchUps:n,targetMatchUps:a}}function lx({modifiedStructureIds:e,tournamentRecord:t,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){Kf({tournamentId:t?.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i?.forEach((e=>{Jf({tournamentId:t?.tournamentId,drawDefinition:r,context:o,matchUp:e,eventId:a})})),Zf({structureIds:e,drawDefinition:r,eventId:a})}function px({updateInProgressMatchUps:e=!1,tieFormatComparison:t,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:c,uuids:d,event:u}){let l="modifyTieFormat";if(!md({tieFormat:i}).valid)return Qs({result:{error:Qn},info:"falied validation",stack:l});let p=YO({drawDefinition:a,structureId:o,matchUpId:s,eventId:c,event:u});if(p.error)return Qs({result:p,stack:l});let{matchUp:m,tieFormat:f}=p,h=yw(f),g=ZN({descendant:i,ancestor:h,considerations:n});if(g.invalid)return Qs({context:{invalid:g.invalid},result:{error:Qn},stack:l});if(!g?.different)return Qs({result:{..._r},info:"Nothing to do",stack:l});let I,y=h.collectionDefinitions.map((({collectionId:e})=>e)),v=i.collectionDefinitions.map((({collectionId:e})=>e)),S=y.filter((e=>!v.includes(e))),U=i.collectionDefinitions.filter((({collectionId:e})=>!y.includes(e))),b=U.map(Dy("collectionId")),w=[],T=i.tieFormatName;for(let D of i.collectionDefinitions){if(b.includes(D.collectionId))continue;let t=ZO({updateInProgressMatchUps:e,...D,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:c,event:u});if(t.modifications&&w.push(...t.modifications),t.error)return Qs({result:t,stack:l});t.tieFormat&&(I=t.tieFormat)}for(let D of U){let t=dx({updateInProgressMatchUps:e,collectionDefinition:D,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:c,uuids:d,event:u});if(t.error)return Qs({result:t,stack:l});t.tieFormat&&(I=t.tieFormat)}for(let D of S){let i=sx({updateInProgressMatchUps:e,tieFormatComparison:t,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:o,matchUpId:s,eventId:c,matchUp:m,event:u});if(i.error)return Qs({result:i,stack:l});i.tieFormat&&(I=i.tieFormat)}return f?.tieFormatName!==T?(I.tieFormatName=T,w.push({tieFormatName:T})):(w.length||b.length||S.length)&&(delete I.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),I.collectionDefinitions=I.collectionDefinitions.sort(((e,t)=>cr(e.collectionOrder)-cr(t.collectionOrder))).map(((e,t)=>({...e,collectionOrder:t+1}))),{processedTieFormat:yw(I),modifications:w,..._r}}function mx({tournamentRecord:e}){if(!e)return{error:zr};let t=0;for(let i of e.events??[]){let r=i.tieFormats??[],n=e=>{if(!e.tieFormat)return;let i;for(let t of r)ZN({descendant:e.tieFormat,ancestor:t}).different||(i=t.tieFormatId);if(i)e.tieFormatId=i,delete e.tieFormat;else{let i=yd(e.tieFormat,void 0,!0);i.tieFormatId||(i.tieFormatId=Ud()),e.tieFormatId=i.tieFormatId,delete e.tieFormat,r.push(i),t+=1}};i.eventType,n({tieFormat:i.tieFormat});for(let e of i.drawDefinitions??[]){n({tieFormat:e.tieFormat});for(let t of e.structures??[])n({tieFormat:t.tieFormat})}let a=(t,r)=>{let n=s.matchUps?.find((e=>e.matchUpId===t));n&&(n.tieFormatId=r,delete n.tieFormat,Jf({tournamentId:e?.tournamentId,eventId:i.eventId,matchUp:n}))},o=e=>{let i=yd(e.tieFormat,void 0,!0);i.tieFormatId||(i.tieFormatId=Ud()),r.push(i),t+=1,a(e.matchUpId,i.tieFormatId)},s=yy({matchUpFilters:{matchUpTypes:[$i]},event:i}),c=s.matchUps??[];for(let e of c){let t;for(let i of r)e.tieFormat&&ZN({descendant:e.tieFormat,ancestor:i}).different||(t=i.tieFormatId);t?a(e.matchUpId,t):o(e)}r.length&&(i.tieFormats=r)}return{..._r,addedCount:t}}Oi(zO,{addCollectionDefinition:()=>dx,addCollectionGroup:()=>cx,aggregateTieFormats:()=>mx,modifyCollectionDefinition:()=>ZO,modifyTieFormat:()=>px,orderCollectionDefinitions:()=>rx,removeCollectionDefinition:()=>sx,removeCollectionGroup:()=>tx});var fx={};Oi(fx,{addDrawDefinitionExtension:()=>$p,addEventExtension:()=>Gp,addEventTimeItem:()=>Ew,addExtension:()=>Vp,addNotes:()=>dw,addOnlineResource:()=>wx,addParticipantExtension:()=>Wp,addParticipantTimeItem:()=>Pw,addTimeItem:()=>Dw,addTournamentExtension:()=>jp,addTournamentTimeItem:()=>Nw,analyzeDraws:()=>_w,analyzeTournament:()=>HN,copyTournamentRecord:()=>gx,createTournamentRecord:()=>_A,generate:()=>hx,getAggregateTeamResults:()=>WN,getAllowedDrawTypes:()=>FN,getAllowedMatchUpFormats:()=>xN,getAppliedPolicies:()=>Fh,getCompetitionDateRange:()=>$N,getCompetitionPenalties:()=>_N,getPolicyDefinitions:()=>Lh,getTournamentInfo:()=>jN,getTournamentPenalties:()=>LN,getTournamentPersons:()=>GN,getTournamentPoints:()=>XN,getTournamentStructures:()=>xS,getTournamentTimeItem:()=>Nh,hydrateTournamentRecord:()=>yx,mutate:()=>Ix,query:()=>ON,removeDrawDefinitionExtension:()=>Hp,removeEventExtension:()=>zp,removeExtension:()=>_p,removeNotes:()=>uw,removeOnlineResource:()=>Ux,removeParticipantExtension:()=>Yp,removeTournamentExtension:()=>qp,setTournamentCategories:()=>Nx,setTournamentDates:()=>Ex,setTournamentEndDate:()=>Rx,setTournamentName:()=>Dx,setTournamentNotes:()=>Px,setTournamentStartDate:()=>Mx,setTournamentStatus:()=>Sx});var hx={};function gx(e){let t=dp(e,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(t.error)return t;let{startDate:i,endDate:r}=e.tournamentRecord,n=(i&&r?new Date(Yc(r)).getTime()-new Date(Yc(i)).getTime():0)/864e5,a=e.endDate||Zc(e.startDate,n),o=t=>t?.filter((({itemType:t})=>e.itemTypeList?.includes(t))),s=t=>t?.filter((({name:t})=>e.extensionList?.includes(t))),c={participants:e.copyParticipants?e.tournamentRecord.participants?.map((e=>{let{timeItems:t,extensions:i,...r}=e;return yd({...r,timeItems:o(t),extensions:s(i)},!1,!0)}))??[]:[],parentOrganisation:yd({...e.tournamentRecord.parentOrganisation},!1,!0),venues:yd(e.tournamentRecord.venues??[],!1,!0),extensions:s(e.tournamentRecord.extensions),timeItems:o(e.tournamentRecord.timeItems),events:e.tournamentRecord.events?.map((t=>{let{drawDefinitions:i,timeItems:r,extensions:n,startDate:c,endDate:d,...u}=t;return yd({extensions:s(n),timeItems:o(r),startDate:e.startDate,endDate:a,...u},!1,!0)}))??[],weekdays:[...e.tournamentRecord.weekdays??[]],tournamentName:e.tournamentName,startDate:e.startDate,tournamentId:Ud(),endDate:a};return{..._r,tournamentRecord:c}}Oi(hx,{copyTournamentRecord:()=>gx,createTournamentRecord:()=>_A});var Ix={};function yx(e){let{tournamentRecord:t,eventProfiles:i=[],directives:r,policyDefinitions:n}=e;return t?((t.events||[]).forEach((e=>{let t=i.find((t=>t.eventId&&t.eventId===e.eventId));(t?.directives?.hydrateRoundNames||r?.hydrateRoundNames)&&e.drawDefinitions?.forEach((e=>{(t?.policyDefinitions?.[Dp]||n?.[Dp])&&DM({drawDefinition:e,appliedPolicies:n})}))})),{tournamentRecord:t}):{error:zr}}Oi(Ix,{addDrawDefinitionExtension:()=>$p,addEventExtension:()=>Gp,addEventTimeItem:()=>Ew,addExtension:()=>Vp,addNotes:()=>dw,addOnlineResource:()=>wx,addParticipantExtension:()=>Wp,addParticipantTimeItem:()=>Pw,addTimeItem:()=>Dw,addTournamentExtension:()=>jp,addTournamentTimeItem:()=>Nw,hydrateTournamentRecord:()=>yx,removeDrawDefinitionExtension:()=>Hp,removeEventExtension:()=>zp,removeExtension:()=>_p,removeNotes:()=>uw,removeOnlineResource:()=>Ux,removeParticipantExtension:()=>Yp,removeTournamentExtension:()=>qp,setTournamentCategories:()=>Nx,setTournamentDates:()=>Ex,setTournamentEndDate:()=>Rx,setTournamentName:()=>Dx,setTournamentNotes:()=>Px,setTournamentStartDate:()=>Mx,setTournamentStatus:()=>Sx});var vx={ABANDONED:"ABANDONED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};function Sx({tournamentRecord:e,status:t}){return e?t&&!Object.keys(vx).includes(t)?{error:Ho,info:"Unknown status"}:(e.tournamentStatus=t,{..._r}):{error:zr}}function Ux(e){let t=dp(e,[{tournamentRecord:!0,onlineResource:!0}]);if(t.error)return t;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:c}=e;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return Qs({result:{error:Qo}});bx({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let e=(i.participants??[]).find((e=>o&&e.person?.personId===o||e.participantId===a));if(!e)return Qs(o?{result:{error:Qo}}:{result:{error:Ya}});if(o){if(e.person?.personId!==o)return Qs({result:{error:_a}});bx({element:e.person,onlineResource:r})}else bx({element:e,onlineResource:r})}else if(s){let e=(i.venues??[]).filter((e=>!c||e.venueId===c)).flatMap((e=>(e.courts??[]).filter((e=>e.courtId===s))))?.[0];if(!e)return Qs({result:{error:yo}});bx({element:e,onlineResource:r})}else if(c){let e=(i.venues??[]).find((e=>e.venueId===c));if(!e)return Qs({result:{error:wo}});bx({element:e,onlineResource:r})}else bx({element:i,onlineResource:r}),As({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:xf});return{..._r}}function bx({element:e,onlineResource:t}){let i=(e.onlineResources??[]).filter((e=>!(e?.[fd]===t[fd]&&e?.[hd]===t[hd]&&e?.[gd]===t[gd])));e.onlineResources=i}function wx(e){let t=dp(e,[{tournamentRecord:!0,onlineResource:!0}]);if(t.error)return t;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:c}=e;if(n){if(i.parentOrganisation?.parentOrganisationId!==n)return Qs({result:{error:Qo}});Tx({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let e=(i.participants??[]).find((e=>o&&e.person?.personId===o||e.participantId===a));if(!e)return Qs(o?{result:{error:Qo}}:{result:{error:Ya}});if(o){if(e.person?.personId!==o)return Qs({result:{error:_a}});Tx({element:e.person,onlineResource:r})}else Tx({element:e,onlineResource:r})}else if(s){let e=(i.venues??[]).filter((e=>!c||e.venueId===c)).flatMap((e=>(e.courts??[]).filter((e=>e.courtId===s))))?.[0];if(!e)return Qs({result:{error:yo}});Tx({element:e,onlineResource:r})}else if(c){let e=(i.venues??[]).find((e=>e.venueId===c));if(!e)return Qs({result:{error:wo}});Tx({element:e,onlineResource:r})}else Tx({element:i,onlineResource:r}),As({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:xf});return{..._r}}function Tx({element:e,onlineResource:t}){let i=(e.onlineResources??[]).filter((e=>e?.[fd]!==t[fd]&&e?.[hd]!==t[hd]&&e?.[gd]!==t[gd]));return i.push(t),e.onlineResources=i,{..._r}}function Dx({tournamentRecord:e,promotionalName:t,tournamentName:i,formalName:r}){if(!e)return{error:zr};let n=e.tournamentId,a={tournamentId:n};return i&&i!==e.tournamentName&&(e.tournamentName=i,a.tournamentName=i),t&&t!==e.promotionalName&&(e.promotionalName=t,a.promotionalName=t),r&&r!==e.formalName&&(e.formalName=r,a.formalName=r),e.promotionalName===e.tournamentName&&(delete e.promotionalName,a.promotionalName=""),e.formalName===e.tournamentName&&(delete e.formalName,a.formalName=""),Object.keys(a).length>1&&As({topic:xf,payload:{parentOrganisation:e.parentOrganisation,tournamentId:n,...a}}),{..._r}}function Px({tournamentRecord:e,notes:t}){if(!e)return{error:zr};let i=t?dw({element:e,notes:t}):uw({element:e});return i.error?i:(As({topic:xf,payload:{parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,notes:t??""}}),{..._r})}function Nx({tournamentRecord:e,categories:t}){return e?(t=(t||[]).filter((e=>e.categoryName&&e.type)),e.tournamentCategories=t,As({topic:xf,payload:{parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,categories:t}}),{..._r}):{error:zr}}function Ex(e){let t,{tournamentRecord:i,startDate:r,endDate:n,weekdays:a}=e,o=e.activeDates?.filter(Boolean),s=dp(e,[{tournamentRecord:!0},{[ep]:e=>Cc.test(e),[ip]:Pa,startDate:!1,endDate:!1},{[ep]:e=>e.filter(Boolean).every((e=>Cc.test(e))),[ip]:Pa,activeDates:!1},{[ep]:cR,weekdays:!1}]);if(s.error)return s;if(n&&r&&new Date(n)<new Date(r))return{error:Ho};if(n&&r&&new Date(r)>new Date(n))return{error:Ho};if(o?.length){let e=r||i.startDate,t=n||i.endDate,a=!e||o.every((t=>new Date(t)>=new Date(e))),s=!t||o.every((e=>new Date(e)<=new Date(t)));if(!a||!s)return{error:Pa}}(r&&i.startDate&&new Date(r)>new Date(i.startDate)||n&&i.endDate&&new Date(n)<new Date(i.endDate))&&(t=!0);let c=jc(i.startDate,i.endDate);r&&(i.startDate=r),n&&(i.endDate=n);let d=jc(i.startDate,i.endDate),u=c.filter((e=>!d.includes(e))),l=d.filter((e=>!c.includes(e)));for(let m of i.events??[])r&&m.startDate&&new Date(m.startDate)<new Date(r)&&(m.startDate=r),n&&m.startDate&&new Date(m.startDate)>new Date(n)&&(m.startDate=r??n),n&&m.endDate&&new Date(m.endDate)>new Date(n)&&(m.endDate=n),r&&m.endDate&&new Date(m.endDate)<new Date(r)&&(m.endDate=n??r);r&&i.endDate&&new Date(r)>new Date(i.endDate)&&(i.endDate=r),n&&i.startDate&&new Date(n)<new Date(i.startDate)&&(i.startDate=n),o&&(i.activeDates=o),a&&(i.weekdays=a);let p=t&&function({tournamentRecord:e}){let t=vy({tournamentRecord:e}).matchUps??[],i=e.startDate&&new Date(e.startDate),r=e.endDate&&new Date(e.endDate),n=[],a=[];for(let o of t){let{schedule:e,matchUpId:t}=o;if(e&&e.scheduledDate){let o=new Date(e.scheduledDate);(i&&o<i||r&&o>r)&&(a.push(t),n.includes(e.scheduledDate)||n.push(e.scheduledDate))}}return n.length&&!xA({scheduledDates:n,tournamentRecord:e}).clearedScheduleCount?{error:an}:{unscheduledMatchUpIds:a}}({tournamentRecord:i})?.unscheduledMatchUpIds;return function({tournamentRecord:e}){if(!e)return{error:zr};let{startDate:t,endDate:i}=e,r=jc(t,i),n=[];for(let a of e.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:e,endTime:t}=(a.dateAvailability??[]).reduce(((e,t)=>{let i=qc(e.startTime),r=qc(e.endTime);return t.startTime&&qc(t.startTime)<i&&(e.startTime=t.startTime),t.endTime&&qc(t.endTime)>r&&(e.endTime=t.endTime),e}),{startTime:"08:00",endTime:"18:00"}),i=r.map((i=>a.dateAvailability?.find((e=>e.date===i))??{date:i,startTime:e,endTime:t})),n=a.dateAvailability?.find((e=>!e.date));n&&i.unshift(n),a.dateAvailability=i}}({tournamentRecord:i}),As({payload:Js({parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,activeDates:o,startDate:r,weekdays:a,endDate:n}),topic:xf}),{..._r,unscheduledMatchUpIds:p,datesAdded:l,datesRemoved:u}}function Mx({tournamentRecord:e,startDate:t}){return t?Ex({tournamentRecord:e,startDate:t}):{error:Pa}}function Rx({tournamentRecord:e,endDate:t}){return t?Ex({tournamentRecord:e,endDate:t}):{error:Pa}}var Cx={};Oi(Cx,{addCourt:()=>Tk,addCourts:()=>Dk,addVenue:()=>$I,deleteCourt:()=>zx,deleteVenue:()=>_x,deleteVenues:()=>Bx,disableCourts:()=>Vx,disableVenues:()=>$x,enableCourts:()=>Wx,enableVenues:()=>Hx,generate:()=>Ax,generateCourts:()=>jR,getCompetitionVenues:()=>dE,getCourts:()=>yM,getVenuesAndCourts:()=>cE,modifyCourt:()=>Kx,modifyCourtAvailability:()=>xx,modifyVenue:()=>Qx,mutate:()=>kx,publicFindVenue:()=>qI,query:()=>IM});var Ax={};Oi(Ax,{generateCourts:()=>jR});var kx={};function Ox(e){if(!e?.tournamentRecord&&!Array.isArray(e?.venueMatchUps))return{error:zr};if(!e?.courtId)return{error:ya};let{scheduleVisibilityFilters:t,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=e,{schedulingProfile:o}=wE({tournamentRecord:i});if(Array.isArray(n))return{matchUps:c({matchUps:n,courtId:a})};let{matchUps:s}=vy({scheduleVisibilityFilters:t,tournamentRecord:i,matchUpFilters:r});return{matchUps:c({matchUps:s,courtId:a})};function c({matchUps:e,courtId:t}){return XE({matchUps:e.filter((e=>{let i=e.schedule?.allocatedCourts?.map((({courtId:e})=>e));return e.schedule?.courtId===t||i?.includes(t)})),schedulingProfile:o})}}function xx({tournamentRecord:e,dateAvailability:t,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){if(!e)return{error:zr};if(!n)return{error:ya};let o=wk({dateAvailability:t});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:c}=function(e){let t=0,i=e.reduce(((e,t)=>{let{date:i,startTime:r,endTime:n,bookings:a}=t;return e[i]||(e[i]=[]),e[i].push({startTime:r,endTime:n,bookings:a}),e}),{}),r=[];return Object.keys(i).forEach((e=>{i[e].sort(bk);let{mergedAvailability:n,mergeCount:a}=function(e){let t,i,r,n=e.length,a=0,o=[];for(;e.length&&n;){let s=e.shift(),{startTime:c,endTime:d,bookings:u}=s;if(n-=1,t)if(td(ed(i),ed(c),!1)>0){let e={startTime:t,endTime:i};r?.length&&(e.bookings=r),o.push(e),t=c,r=u,i=d}else u&&(r?r.push(u):r=u),i=d,a+=1;else t=c,r=u,i=d}let s={startTime:t,endTime:i};return r?.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}(i[e]);r.push(...n.map((t=>({date:e,...t})))),t+=a})),{updatedDateAvailability:r,totalMergeCount:t}}(t);t=s;let d=HI({tournamentRecord:e,courtId:n});if(d.error)return d;let{court:u,venue:l}=d,{matchUps:p}=Ox({tournamentRecord:e,venueMatchUps:r,courtId:n});if(p?.length){let t=Fh({tournamentRecord:e})?.appliedPolicies,i=a??t?.[Ep]?.allowDeletionWithScoresPresent?.courts,r=[];r.length&&(i||console.log("throw error: scheduled court matchUps",r.length))}return u&&(u.dateAvailability=t,!i&&l&&As({payload:{venue:l,tournamentId:e.tournamentId},topic:Ff,key:l.venueId})),{..._r,totalMergeCount:c}}function Fx({matchUpsCount:e=0}){return{error:ss,info:`Schedule would be deleted from ${e} ${1===e?"matchUp":"matchUps"}; use { force: true }`}}function Lx({tournamentRecord:e,drawDefinition:t,matchUpId:i,drawId:r}){let n;if(!i)return{error:ra};if(!t&&!r)return{error:In};if(!t){if(!e)return{error:zr};({drawDefinition:t}=JI({tournamentRecord:e,drawId:r}))}if(t)({matchUp:n}=cw({drawDefinition:t,matchUpId:i}));else{if(!e)return{error:zr};let t=vy({tournamentRecord:e,inContext:!1}).matchUps??[];({matchUp:n}=sw({matchUps:t,matchUpId:i}))}return n?(n.timeItems&&n.timeItems.find((e=>[Hg,qg].includes(e.itemType)))&&(n.timeItems=n.timeItems.filter((({itemType:e})=>![Hg,qg].includes(e))),Jf({tournamentId:e?.tournamentId,context:"removeCourtAssignment",drawDefinition:t,matchUp:n})),{..._r}):{error:aa}}function _x(e){if("string"!=typeof e?.venueId)return{error:To};let{tournamentRecord:t,venueId:i,force:r}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!Object.keys(n).length)return{error:zr};let a=Sy({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],o=Fh({tournamentRecord:t})?.appliedPolicies,s=r??o?.[Ep]?.allowDeletionWithScoresPresent?.venues;if(a.length&&!s)return Fx({matchUpsCount:a.length});for(let c of Object.values(n)){for(let t of a){let e=Lx({matchUpId:t.matchUpId,drawId:t.drawId,tournamentRecord:c});if(e.error)return e}let e;c.venues=(c.venues??[]).filter((t=>t?.venueId!==i||(e=!0,!1))),e&&As({payload:{venueId:i,tournamentId:c.tournamentId},topic:Df,key:i})}return DE({tournamentRecords:n}),{..._r}}function Bx({tournamentRecord:e,venueIds:t,force:i}){if(!e)return{error:zr};if(!Array.isArray(t))return{error:Ho};for(let r of e.venues||[]){let{venueId:n}=r;if(t.includes(n)){let{venueId:t}=r,n=_x({tournamentRecord:e,venueId:t,force:i});if(n.error)return n}}return{..._r}}function Vx(e){let{courtIds:t,dates:i}=e,r=sh(e),n=dp(e,[{[bl]:!0,[jl]:!0}]);if(n.error)return n;for(let a of Object.values(r))jx({tournamentRecord:a,courtIds:t,dates:i});return{..._r}}function jx({tournamentRecord:e,courtIds:t,dates:i}){let r=!Array.isArray(i)||!i.length||{dates:i},n=e=>Vp({extension:{value:r,name:tm},creationTime:!1,element:e});for(let a of e.venues||[])for(let e of a.courts||[])if(t?.includes(e.courtId)){let t=n(e);if(t.error)return t}return{..._r}}function $x(e){let{tournamentRecords:t,tournamentId:i,venueIds:r}=e,n=dp(e,[{[bl]:!0,[$l]:!0}]);if(n.error)return n;let a=Object.keys(t).filter((e=>!i||e===i));for(let o of a){Gx({tournamentRecord:t[o],venueIds:r})}return{..._r}}function Gx({tournamentRecord:e,venueIds:t}){for(let i of e.venues||[])if(t?.includes(i.venueId)){let e=Vp({creationTime:!1,element:i,extension:{name:tm,value:!0}});if(e.error)return e}return{..._r}}function Wx(e){let t=sh(e),i=[{[bl]:!0}];!e.enableAll&&i.push({[jl]:!0});let r=dp(e,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=e;for(let s of Object.values(t))qx({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{..._r}}function qx({tournamentRecord:e,courtIds:t,enableAll:i,dates:r}){for(let n of e.venues||[])for(let e of n.courts||[])if(i||t?.includes(e.courtId))if(Array.isArray(r)){let{extension:t}=Jp({element:e,name:tm});if(t){let i=t.value;Array.isArray(i.dates)&&(i.dates=i.dates.filter((e=>!r.includes(e)))),Vp({extension:{name:tm,value:i},creationTime:!1,element:e})}}else _p({element:e,name:tm});return{..._r}}function Hx(e){let t=sh(e),i=[{[bl]:!0}];!e.enableAll&&i.push({[$l]:!0});let r=dp(e,i);if(r.error)return r;let{venueIds:n,enableAll:a}=e;for(let o of Object.values(t))for(let e of o.venues||[])(a||n?.includes(e.venueId))&&_p({element:e,name:tm});return{..._r}}function zx(e){let t,i,{courtId:r,disableNotice:n,force:a}=e,o=sh(e),s=dp(e,[{[bl]:!0,[Wl]:!0}]);if(s.error)return s;for(let c of Object.values(o)){if(i=Yx({tournamentRecord:c,disableNotice:n,courtId:r,force:a}),i.error&&i.error!==yo)return i;i.success&&(t=!0)}return t?{..._r}:i}function Yx({tournamentRecord:e,disableNotice:t,courtId:i,force:r}){let n=HI({tournamentRecord:e,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:o}=Ox({tournamentRecord:e,courtId:i}),s=Fh({tournamentRecord:e})?.appliedPolicies,c=r??s?.[Ep]?.allowDeletionWithScoresPresent?.courts;if(o?.length&&!c)return Fx({matchUpsCount:o.length});for(let d of o??[]){let t=Lx({matchUpId:d.matchUpId,drawId:d.drawId,tournamentRecord:e});if(t.error)return t}return a&&(a.courts=(a.courts??[]).filter((e=>e.courtId!==i)),t||As({payload:{venue:a,tournamentId:e.tournamentId},topic:Ff,key:a.venueId})),{..._r}}function Kx(e){let t,{disableNotice:i,modifications:r,courtId:n,force:a,venueMatchUps:o}=e,s=sh(e);if(!Object.keys(s).length)return{error:Hr};for(let c of Object.values(s)){let e=Xx({tournamentRecord:c,disableNotice:i,venueMatchUps:o,modifications:r,courtId:n,force:a});if(e?.error)return e;t=!0}return t?{..._r}:undefined}function Xx({tournamentRecord:e,disableNotice:t,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!e)return{error:zr};if(!n)return{error:ya};if(!r||"object"!=typeof r)return{error:Go};let o=HI({tournamentRecord:e,courtId:n});if(o.error)return o;let{venue:s,court:c}=o,d=Object.keys(vk()).filter((e=>"courtId"!==e));if(!Object.keys(r).filter((e=>d.includes(e))).length)return{error:Xo};let u=d.filter((e=>!["dateAvailability"].includes(e))),l=Object.keys(r).filter((e=>u.includes(e)));if(c&&l.forEach((e=>Object.assign(c,{[e]:r[e]}))),r.dateAvailability){let o=xx({dateAvailability:r.dateAvailability,tournamentRecord:e,venueMatchUps:i,disableNotice:t,courtId:n,force:a});if(o.error)return o}return t||As({payload:{venue:s,tournamentId:e.tournamentId},topic:Ff,key:s?.venueId}),{..._r,court:yd(c)}}Oi(kx,{addCourt:()=>Tk,addCourts:()=>Dk,addVenue:()=>$I,deleteCourt:()=>zx,deleteVenue:()=>_x,deleteVenues:()=>Bx,disableCourts:()=>Vx,disableVenues:()=>$x,enableCourts:()=>Wx,enableVenues:()=>Hx,modifyCourt:()=>Kx,modifyCourtAvailability:()=>xx,modifyVenue:()=>Qx});var Jx=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]});function Qx(e){let t,i,{modifications:r,venueId:n,force:a}=e,o=sh(e);if(!Object.keys(o).length)return{error:Hr};if("string"!=typeof n)return{error:To};for(let s of Object.values(o)){let e=Zx({tournamentRecord:s,modifications:r,venueId:n,force:a});if(e.success&&(i=!0),e.error&&(t=e.error),e.error&&e.error!==wo)return e}return DE({tournamentRecords:o}),i?{..._r}:{error:t}}function Zx({tournamentRecord:e,modifications:t,venueId:i,force:r}){if(!e)return{error:zr};if(!t||"object"!=typeof t)return{error:Go};if(!i)return{error:To};let n=Fh({tournamentRecord:e})?.appliedPolicies,a=r??n?.[Ep]?.allowDeletionWithScoresPresent?.venues,{matchUps:o}=function({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:i,venueId:r}){if(!t)return{error:zr};if(!r)return{error:To};let{schedulingProfile:n}=wE({tournamentRecord:t}),{matchUps:a}=vy({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:i});return{matchUps:function({matchUps:e,venueId:t}){return XE({matchUps:e.filter((e=>{let i=e.schedule?.allocatedCourts?.map((({venueId:e})=>e));return e.schedule?.venueId===t||i?.includes(t)})),schedulingProfile:n})}({matchUps:a,venueId:r})}}({tournamentRecord:e,venueId:i}),s=WI({tournamentRecord:e,venueId:i});if(s.error)return s;let c=s.venue,d=Object.keys(Jx()).filter((e=>"venueId"!==e));if(!Object.keys(t).filter((e=>d.includes(e))).length)return{error:Xo};let u=d.filter((e=>!["courts","onlineResources"].includes(e))),l=Object.keys(t).filter((e=>u.includes(e)));c&&l.forEach((e=>Object.assign(c,{[e]:t[e]})));let p=c?.courts?.map((e=>e.courtId))??[],m=t.courts?.map((e=>e.courtId))||[],f=m.length?p.filter((e=>!m.includes(e))):t?.courts&&p,h=[];if(f?.length){let t=c?.courts?.filter((e=>f.includes(e.courtId)))?.map((t=>{let i=Ox({courtId:t.courtId,tournamentRecord:e,venueMatchUps:o});for(let e of i.matchUps??[])h.push({matchUpId:e.matchUpId,drawId:e.drawId});return i.matchUps?.length??0})).reduce(((e,t)=>e+t));if(!c||t&&!a)return Fx({matchUpsCount:t});c.courts=c.courts?.filter((e=>m.includes(e.courtId))),AA({schedule:{courtId:"",scheduledDate:""},matchUpDetails:h,removePriorValues:!0,tournamentRecord:e})}if(t.courts)for(let g of t.courts){let{courtId:t}=g||{},n=Kx({modifications:g,disableNotice:!0,tournamentRecord:e,venueMatchUps:o,courtId:t,force:r});if(n.error===yo&&(n=Tk({disableNotice:!0,tournamentRecord:e,venueId:i,court:g})),n.error)return n}return DE({tournamentRecord:e}),c&&As({payload:{venue:c,tournamentId:e.tournamentId},topic:Ff,key:c?.venueId}),{..._r,venue:yd(c)}}var eF={};function tF({scheduledMatchUps:e,showGlobalLog:t}){Fy.length=0;let i=e?.reduce(((e,{structureId:t})=>e.includes(t)?e:e.concat(t)),[]),r=Array.isArray(i)&&{...i.map((t=>{let{structureName:i,matchUpType:r}=e.find((e=>e.structureId===t));return{[t]:`${i} ${r}`}}))};i?.forEach((t=>{Ly({color:"blue",method:"draw",structure:r[t],keyColors:{structure:"magenta"}},!0);let i=e.filter((e=>e.structureId===t)),n=Ng({matchUps:i})?.roundMatchUps||[];Object.keys(n).forEach((e=>{Ly({roundNumber:e,keyColors:{roundNumber:"brightcyan"}},!0),n[e].forEach((({matchUpId:e,schedule:t})=>{Ly({matchUpId:e,time:zc(t.scheduledTime),date:t.scheduledDate,venue:t.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)}))}))})),t&&_y()}Oi(eF,{JSON2CSV:()=>sF,UUID:()=>Ud,UUIDS:()=>Sd,allNumeric:()=>Dr,attributeFilter:()=>yp,chunkArray:()=>wr,chunkByNth:()=>Nr,chunkSizeProfile:()=>Tr,constantToString:()=>zv,countValues:()=>ur,createMap:()=>Ar,dateTime:()=>od,definedAttributes:()=>Js,dehydrateMatchUps:()=>aF,extractAttributes:()=>Ty,flattenJSON:()=>cF,generateDateRange:()=>jc,generateHashCode:()=>Fr,generateRange:()=>gr,generateTimeCode:()=>Lk,groupValues:()=>lr,hasAttributeValues:()=>kr,instanceCount:()=>dr,intersection:()=>yr,isConvertableInteger:()=>ir,isNumeric:()=>Qi,isOdd:()=>Zi,isPowerOf2:()=>Yi,makeDeepCopy:()=>yd,matchUpScheduleSort:()=>nF,matchUpSort:()=>Uy,nearestPowerOf2:()=>Ji,nextPowerOf2:()=>er,noNulls:()=>or,noNumeric:()=>Pr,numericSort:()=>Hi,occurrences:()=>Ur,overlap:()=>Sr,randomMember:()=>hr,randomPop:()=>fr,shuffleArray:()=>sr,structureSort:()=>df,subSort:()=>br,undefinedToNull:()=>Or,unique:()=>ar,visualizeScheduledMatchUps:()=>tF});var{extractTime:iF,timeStringMinutes:rF}=od;function nF(e,t){let i=e.schedule??{},r=t.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){return rF(iF(i.scheduledTime))-rF(iF(r.scheduledTime))}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function aF({tournamentRecord:e}){if(!e)return{error:zr};if("object"!=typeof e||!e.tournamentId)return{error:Ho};let{matchUps:t}=vy({tournamentRecord:e,inContext:!1});if(t?.length){let i=function({tournamentRecord:e}){let t={};for(let i of e.events||[]){i.matchUpFormat&&(t[i.eventId]=i.matchUpFormat);for(let e of i.drawDefinitions||[]){e.matchUpFormat&&(t[e.drawId]=e.matchUpFormat);for(let i of e.structures||[]){i.matchUpFormat&&(t[i.structureId]=i.matchUpFormat);for(let e of i.structures||[])e.matchUpFormat&&(t[e.structureId]=e.matchUpFormat)}}}return t}({tournamentRecord:e});!function(e,t={}){for(let i of e){let{structureId:e,drawId:r,eventId:n}=i,a=t[e]||t[r]||t[n],o=i.matchUpFormat===a?void 0:i.matchUpFormat;for(let t of Object.keys(i))oF.includes(t)||delete i[t];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}(t,i)}return{..._r}}var oF=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function sF(e,t){if(t&&"object"!=typeof t)return{error:Ho};let{columnTransform:i={}}=t||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:c=[],functionMap:d={},columnMap:u={},valuesMap:l={},context:p={},delimiter:m='"',columnJoiner:f=",",rowJoiner:h="\r\n",keyJoiner:g="."}=t||{};if(!Array.isArray(e)||!Array.isArray(c)||"object"!=typeof p||"object"!=typeof u||"object"!=typeof i||"object"!=typeof d||"object"!=typeof l||"string"!=typeof f||"string"!=typeof h||"string"!=typeof g||"string"!=typeof m)return{error:Ho};i=Object.assign({},...Object.keys(i).reverse().map((e=>({[e]:Array.isArray(i[e])?i[e]:["string"==typeof i[e]&&i[e]].filter(Boolean)}))));let I=e.filter(Boolean).map((e=>cF(e,g))),y=Object.values(i).flat();r&&c.push(...y);let v=I.reduce(((e,t)=>Object.keys(t).every((t=>!e.includes(t)&&e.push(t)||!0))&&e),[]).filter((e=>!c?.length||c.includes(e))),S=Object.assign({},...Object.keys(i).reverse().map((e=>i[e].map((t=>({[t]:e}))).flat())).flat()),U=v.reduce(((e,t)=>{let i=S[t];return i?e.includes(i)||e.push(i):e.push(t),e}),[]).sort(((e,i)=>t?.sortOrder?t.sortOrder.includes(e)&&t.sortOrder.includes(i)&&t.sortOrder.indexOf(e)-t.sortOrder.indexOf(i)||!t.sortOrder.includes(i)&&-1:0));Object.keys(u).forEach((e=>!U.includes(e)&&U.unshift(e))),Object.keys(i).forEach((e=>!U.includes(e)&&U.unshift(e))),"object"==typeof p&&Object.keys(p).forEach((e=>!U.includes(e)&&U.unshift(e)));let b=U.map((e=>u[e]||e));if(s)return[b];let w=e=>`${m}${e}${m}`,T=[],D=I.map((e=>Object.values(U.reduce(((t,r,n)=>{let a=i[r],o=(a?.length?e[a.find((t=>e[t]))]:e[r])||p?.[r]||"",s=l[r]?.[o]||o,c=Er(d[r])?d[r](s):s;return t[r]=w(c),c&&(T[n]=(T[n]||0)+1),t}),{})))),P=o&&[...T].map(((e,t)=>!e&&t)).filter(Qi).reverse();if(P){let e=e=>e.filter(((e,t)=>!P.includes(t)));D=D.map(e),b=e(b)}let N=D.map((e=>e.join(f)));return a?N.map((e=>{let t=e.split(f);return Object.assign({},...t.map(((e,t)=>({[b[t]]:e}))))})):n?[b.map(w).join(f),...N].join(h):N.join(h)}function cF(e,t=".",i=[]){return"object"==typeof e&&Object.keys(e).reduce(((r,n)=>"object"!=typeof e[n]?(r[i.concat(n).join(t)]=e[n],r):Object.assign(r,cF(e[n],t,i.concat(n)))),{})}var{FACTORY:dF}=bm;function uF({timeStamp:e}){let t=$s(),i=Cs();return i&&Object.values(t).forEach((t=>{!function({tournamentRecord:e,value:t}){let{extension:i}=Jp({element:e,name:dF});Vp({element:e,extension:{name:dF,value:{...i?.value,...t}}})}({tournamentRecord:t,value:{version:"2.3.3",timeStamp:e}})})),i}function lF({engineType:e,methodName:t,elapsed:i,params:r,result:n}){let a=vs();if("object"!=typeof a)return;let o={method:t},s=n?.error&&(!0===a.errors||Array.isArray(a.errors)&&a.errors.includes(t)),c=Array.isArray(a.params)&&a.params?.includes(t),d=a.params&&!Array.isArray(a.params)||c,u=Array.isArray(a.exclude)&&a.exclude.includes(t);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(o.elapsed=i),!u&&(s||d)&&(o.params=r),!u&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||c)||Array.isArray(a.result)&&a.result?.includes(t))&&(o.result=n),Object.keys(o).length>1&&Ks(o,e)}function pF({methodName:e,params:t,start:i}){let r={error:os,methodName:e};return lF({result:r,methodName:e,elapsed:i?Date.now()-i:0,params:t,engineType:"sync"}),r}function mF(e,t,i,r,n){delete e.success,delete e.error;let a=Date.now(),o=Vs();i&&(i.activeTournamentId=o);let s=i?.tournamentRecord||js(o),c="object"==typeof i?.tournamentRecord&&{[i?.tournamentRecord.tournamentId]:i.tournamentRecord}||$s(),d=i?yd(i,void 0,!0):void 0,u=i?function(e,t){if(!1===t._middleware)return t;if(t.tournamentId&&!e[t.tournamentId])return{error:zr};let i=t.drawId||t.matchUp?.drawId;if(i){let{event:r,drawDefinition:n,tournamentId:a}=JI({tournamentRecords:e,drawId:i});n&&(t.drawDefinition=n),a&&(t.tournamentId=a),r&&(t.event=r)}if(t.eventId&&!t.event){let{event:i,tournamentId:r}=JI({eventId:t.eventId,tournamentRecords:e});if(!i)return{error:Ln};t.tournamentId=r,t.event=i}let r=t.tournamentId??Vs();if(!r&&t)return t;let n=e[r];return r&&!n?{error:zr}:(n&&(t.tournamentRecord=n),t)}(c,i):void 0;if(u?.error)return u;let l=function({tournamentRecords:e,tournamentRecord:t,params:i,methodName:r,method:n}){if(vs())return n({tournamentRecords:e,tournamentRecord:t,...i});try{return n({tournamentRecords:e,tournamentRecord:t,...i})}catch(a){return Ys({engineName:"engine",methodName:r,params:i,err:a})}}({params:u,tournamentRecords:c,tournamentRecord:s,methodName:r,method:t});return lF({result:l,methodName:r,elapsed:Date.now()-a,params:d,engineType:n}),l}function fF(e){let{mutationStatus:t,tournamentId:i,directives:r,timeStamp:n}=e||{},{topics:a}=Ls();for(let o of[...a].sort(gF)){let e=Os({topic:o});e?.length&&Bs({topic:o,notices:e})}t&&n&&a.includes(Lf)&&Bs({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:Lf})}var hF={[Gf]:5,[$f]:5,[Wf]:5,[Of]:5,[kf]:5,[Ef]:5,[Mf]:5,[Rf]:5,[Cf]:1,[Hf]:1,[Af]:5,[Ff]:5,[Nf]:4,[Tf]:4,[Df]:4,[Pf]:4,[If]:3,[gf]:2};function gF(e,t){return(hF[t]||0)-(hF[e]||0)}function IF(e,t=!0){return"object"!=typeof e||Array.isArray(e)?{error:Go}:e?.tournamentId?Gs(t?yd(e):e):{error:Ho}}function yF(e,t=!0){if("object"!=typeof e)return{error:Go};if(qs(),Array.isArray(e)){if(e.filter((e=>e?.tournamentId)).length!==e.length)return{error:qr};e=Object.assign({},...e.map((e=>({[e.tournamentId]:e}))))}else if(e?.tournamentId)qs((e={[e.tournamentId]:e}).tournamentId);else if(!Object.keys(e).every((t=>e[t].tournamentId===t)))return{error:qr};return Ws(t?yd(e):e)}function vF(e,t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function SF(e,t){e.importMethods=(i,r,n,a)=>function(e,t,i,r,n,a){let o=Xs(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter((e=>Er(s[e]))).forEach((i=>{e[i]=r=>{let n=()=>t(e,{[i]:s[i],...r});if(vs())return n();try{return n()}catch(a){Ys({engineName:"engine",methodName:i,params:r,err:a})}}})),{..._r,...e}}(e,t,i,r,n,a),e.getTournament=e=>function(e){let{convertExtensions:t=!1,removeExtensions:i=!1}=e??{},r=e?.tournamentId??Vs();return"string"!=typeof r?{}:{tournamentRecord:yd(js(r),t,!1,i)}}(e),e.getState=e=>function({convertExtensions:e,removeExtensions:t}){let i=$s();return{tournamentId:Vs(),tournamentRecords:yd(i,e,!1,t)}}({convertExtensions:e?.convertExtensions,removeExtensions:e?.removeExtensions}),e.version=()=>"2.3.3",e.reset=()=>(Ws({}),vF(e)),e.devContext=t=>(bs(t),vF(e)),e.getDevContext=e=>vs(e),e.newTournamentRecord=(e={})=>{let t=_A(e),i=t.tournamentId;return t.error?t:(IF(t),qs(i),{..._r,tournamentId:i})},e.setState=(t,i,r)=>{Ds(i,r);let n=yF(t,i);return vF(e,n)},e.setTournamentId=e=>qs(e),e.getTournamentId=()=>Vs(),e.setTournamentRecord=(t,i,r)=>{Ds(i,r);let n=IF(t,i);return vF(e,n)},e.removeTournamentRecord=t=>{let i=Hs(t);return vF(e,i)},e.removeUnlinkedTournamentRecords=()=>{let t=function(){let e=$s(),{extension:t}=Jp({name:um,tournamentRecords:e,discover:!0}),i=t?.value?.tournamentIds||[];return Object.keys(e).forEach((t=>{i.includes(t)||delete e[t]})),Ws(e)}();return vF(e,t)}}function UF(e,t){if(!Rr(t))return{error:Ho,message:"args must be an object"};let i=Object.values(t).filter(Er).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ho};let r=i?Object.keys(t).find((e=>Er(t[e]))):Mr(t.method)&&t.method;if(!r)return{error:os};let{[r]:n,...a}=t,o=t?.params?{...t.params}:{...a},s=o.rollbackOnError&&yd($s(),!1,!0),c=n||e[r]||ms()[r];if(!c)return pF({methodName:r,params:o});let d=mF(e,c,o,r,"sync")??{};d?.error&&s&&yF(s);let u=Date.now(),l=uF({timeStamp:u}),p=d?.success&&!0!==o?.delayNotify&&!0!==o?.doNotNotify;return p&&fF({directives:[{method:c,params:o}],mutationStatus:l,timeStamp:u}),(p||!d?.success||o?.doNotNotify)&&Fs(),d}var bF=(()=>{let e={executionQueue:(t,i)=>function(e,t,i){if(!Array.isArray(t))return{error:Ho,message:"directives must be an array"};let r=ks(),n=Date.now(),a=i&&yd($s(),!1,!0),o=[];for(let c of t){if("object"!=typeof c)return{error:Ho,message:"directive must be an object"};if(c.params&&"object"!=typeof c.params)return{error:Ho,message:"params must be an object"};let{method:t,pipe:i}=c,s=c.params?{...c.params}:{};if(!r[t])return pF({methodName:t,start:n,params:s});if(i){let e=o.at(-1),t=Object.keys(i);for(let i of t)e[i]&&(s[i]=e[i])}let d=mF(e,r[t],s,t,"sync");if(d?.error)return a&&yF(a),{...d,rolledBack:!!a};o.push({...d,methodName:t})}let s=Date.now();return fF({directives:t,mutationStatus:uF({timeStamp:s}),timeStamp:s}),Fs(),{success:o.every((e=>e.success)),results:o}}(e,t,i),execute:t=>UF(e,t)};return SF(e,UF),e})(),wF=bF;function TF(e,t){if(!Rr(t))return{error:Ho,message:"args must be an object"};let i=Object.values(t).filter(Er).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ho};let r=i?Object.keys(t).find((e=>Er(t[e]))):Mr(t.method)&&t.method;if(!r)return{error:os};let{[r]:n,...a}=t,o=t?.params?{...t.params}:{...a},s=n||e[r]||ms()[r];return s?mF(e,s,o,r,"ask"):pF({methodName:r,params:o})}(()=>{let e={execute:t=>TF(e,t)};SF(e,TF)})();var DF,PF={};function NF(e,t=!0){if(!e)return{error:va};if("object"!=typeof e)return{error:Go};if(e.matchUpId)DF=e.matchUpId,PF[DF]=t?yd(e):e;else if(Array.isArray(e))for(let i of e.reverse())i.matchUpId&&(PF[i.matchUpId]=t?yd(i):i,DF||(DF=i.matchUpId));else for(let i of Object.values(e))i.matchUpId&&(PF[i.matchUpId]=t?yd(i):i,DF||(DF=i.matchUpId));return t?yd(e):e}function EF(e,{params:t,governor:i,methodName:r}){e.error=void 0,e.success=!1;let n=t?.matchUp||PF[DF],a=t?.matchUps||Object.values(PF),o=t?.rollbackOnError&&yd(n,!1,!0);t={...t,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let s=i[r](t);if(s?.error)return o&&NF(o),{...s,rolledBack:!!o};let c=s?.success&&!0!==t?.delayNotify&&!0!==t?.doNotNotify;return c&&fF(),(c||!s?.success||t?.doNotNotify)&&Fs(),s}(()=>{let e={getState:e=>function(e){return yd(PF[DF],e?.convertExtensions,!1,e?.removeExtensions)}(e),version:()=>"2.3.3",reset:()=>(DF=void 0,PF={},{..._r}),drawId:void 0,error:void 0,success:!1,devContext:t=>(bs(t),e),setState:(t,i,r)=>(Ds(i,r),function(t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,e.drawId=t.drawId),e}(NF(t)))};(function(e,t){t.forEach((t=>{Object.keys(t).forEach((i=>{e[i]=r=>{if(vs())return EF(e,{params:r,governor:t,methodName:i});try{return EF(e,{params:r,governor:t,methodName:i})}catch(n){Ys({engineName:"matchUpEngine",methodName:i,params:r,err:n})}}}))}))})(e,[mD])})();var MF=!1,RF=(()=>{let e={version:()=>"2.3.3",setDeepCopy:(t,i)=>(Ds(t,i),e),devContext:t=>(bs(t),MF=!0,e)};return[mA].forEach((i=>{Object.keys(i).forEach((r=>{e[r]=e=>{if(vs()){let n=t(i[r],e);return!n?.error&&e?.setState&&n?.tournamentRecord&&yF(n.tournamentRecord),n}try{let n=t(i[r],e);return!n?.error&&e?.setState&&n?.tournamentRecord&&yF(n.tournamentRecord),n}catch(n){let t;"string"==typeof n?t=n.toUpperCase():n instanceof Error&&(t=n.message),console.log("ERROR",{params:JSON.stringify(e),method:r,error:t})}}}))})),e;function t(e,t){let i=e({...t});return i?.error||fF(),Fs(),MF&&(bs(!1),MF=!1),i}})();wF.importMethods(xi,!0,1);var CF=wF,AF={...{getTournamentPoints:XN},...{calculateNewRatings:QT,generateDynamicRatings:eD}};wF.importMethods(AF);var kF="Personal circumstance",OF={ratingsParameters:kb,matchUpFormats:Od,countryToFlag:vh,tieFormats:GM,countries:Sh,policies:{POLICY_AVOIDANCE_COUNTRY:{[Mp]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},POLICY_POSITION_ACTIONS_DEFAULT:eT,POLICY_POSITION_ACTIONS_DISABLED:{[bp]:{policyName:"positionActionsDisabled",enabledStructures:!1}},POLICY_POSITION_ACTIONS_NO_MOVEMENT:{[bp]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[QU,JU,ZU],disabledActions:[]}]}},POLICY_POSITION_ACTIONS_UNRESTRICTED:{[bp]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[QU,KU]}},POLICY_PRIVACY_DEFAULT:{[Pp]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},POLICY_ROUND_NAMING_DEFAULT:Ag,POLICY_SCHEDULING_DEFAULT:GE,POLICY_SCORING_DEFAULT:{[Rp]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Ad,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[vu]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[_m]:[],[Vm]:[],[Gm]:[],[zm]:[],[Km]:[],[Qm]:[]}}},POLICY_SCORING_USTA:{[Rp]:{requireAllPositionsAssigned:!1,stage:{[vu]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Ad,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Ad,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[_m]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Vm]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[zm]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Gm]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[Qm]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:kF,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Km]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:kF,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[cg]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:kF,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},POLICY_SEEDING_ITF:{[Cp]:{seedingProfile:{positioning:Ru},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},POLICY_SEEDING_DEFAULT:bN},flagIOC:function(e){return vh(Object.assign({},...Sh.filter((e=>e.ioc)).map((e=>({[e.ioc]:e.iso}))))[e])}},xF={};Oi(xF,{activeMatchUpStatuses:()=>of,auditConstants:()=>QM,completedMatchUpStatuses:()=>af,directingMatchUpStatuses:()=>rf,displayConstants:()=>mE,drawDefinitionConstants:()=>Sl,entryStatusConstants:()=>fg,errorConditionConstants:()=>ds,eventConstants:()=>yu,extensionConstants:()=>bm,flightConstants:()=>MR,genderConstants:()=>rc,keyValueConstants:()=>lP,matchUpActionConstants:()=>wT,matchUpStatusConstants:()=>cf,matchUpTypes:()=>Wi,nonDirectingMatchUpStatuses:()=>nf,particicipantsRequiredMatchUpStatuses:()=>ef,participantConstants:()=>Ih,participantRoles:()=>kv,participantTypes:()=>gh,penaltyConstants:()=>FF,policyConstants:()=>Op,positionActionConstants:()=>eb,ratingConstants:()=>Ab,recoveryTimeRequiredMatchUpStatuses:()=>Zm,requestConstants:()=>UA,resourceContants:()=>Id,resultConstants:()=>Vr,scaleConstants:()=>gp,scheduleConstants:()=>kI,sortingConstants:()=>BR,surfaceConstants:()=>LF,tieFormatConstants:()=>cu,timeItemConstants:()=>gI,topicConstants:()=>zf,tournamentConstants:()=>vx,upcomingMatchUpStatuses:()=>sf,validMatchUpStatuses:()=>tf,venueConstants:()=>_F,weekdayConstants:()=>sR});var FF={COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},LF={CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},_F={INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"};const BF=Q({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function VF({individualParticipant:e,composition:t,className:i,matchUp:r,spacer:n,side:a,type:o}){if("scale"===o)return function({individualParticipant:e,composition:t,className:i,matchUp:r,spacer:n}){const a=t?.configuration,o=a?.scaleAttributes?.eventType||r?.matchUpType||"SINGLES",s=e?.rankings,c=e?.ratings,d=a?.scaleAttributes,u=d?.scaleType,l=d?.scaleName,p=d?.accessor,m="RATING"===u?c:s,f=m?.SINGLES?.find((e=>e?.scaleName===l))?.scaleValue,h=m?.DOUBLES?.find((e=>e?.scaleName===l))?.scaleValue,g=f&&p?f[p]:f||"",I=h&&p?h[p]:h||"",y="SINGLES"===o?g:I,v=a?.scaleAttributes?.fallback,S=!n&&(y||v&&(g||I)),U=document.createElement("span"),b=a?.scaleAttributes?.scaleColor,w="green"===b||"red"===b?b:void 0;return S&&(U.className=se(i,Ai(w?{color:w}:{}))),U.innerHTML=S||"",U}({individualParticipant:e,composition:t,className:i,matchUp:r,spacer:n});const s=t?.configuration||{},c=document.createElement("div");if("flag"===o&&s.flags)return function({matchUp:e,individualParticipant:t,spacer:i}){const r=t?.person?.iso2NationalityCode||"",n=r?OF.countryToFlag(r)?.slice(0,4):"",a=document.createElement("span"),o=e?.matchUpType?.toLowerCase();return i||(a.className=BF({variant:o})),a.innerHTML=i?"":n,a}({matchUp:r,individualParticipant:e,spacer:n});if("seeding"===o){const e=function({className:e,composition:t,side:i}){const r="~"===i?.seedValue?"":void 0!==i?.seedValue&&i.seedValue||i?.seedNumber;if(!r)return"";const n=t?.configuration||{},{bracketedSeeds:a}=n,o="boolean"==typeof a&&["(",")"]||"square"===a&&["[","]"]||["",""],s=`${o[0]}${r}${o[1]}`,c="sup"===n.seedingElement?"sup":"span",d=document.createElement(c);return d.className=e||"",d.innerHTML=s,d}({className:i,composition:t,side:a});return"string"==typeof e?c:e}return c}const jF="Qualifier",$F="BYE",GF="TBD";function WF(e){const{isWinningSide:t,side:i,sideNumber:r,individualParticipant:n,matchUp:a,composition:o}=e||{},s=t?"winner":void 0,c=e.eventHandlers||{},d=o?.configuration,u={QUALIFIER:d?.placeHolders?.qualifier||jF,BYE:d?.placeHolders?.bye||$F,TBD:d?.placeHolders?.tbd||GF},l=n?.participantName,p=document.createElement("div");p.classList.add("tmx-i"),p.setAttribute("sideNumber",r),p.setAttribute("id",n?.participantId),p.onclick=e=>{Ie(c?.participantClick)&&(e.stopPropagation(),c.participantClick({individualParticipant:n,pointerEvent:e,matchUp:a,side:i}))};const m=document.createElement("div");m.className=Z({variant:s});const f=d?.flags&&VF({...e,type:"flag"});if(f)m.appendChild(f);else{const t=VF({type:"scale",...e});t&&m.appendChild(t)}const h=document.createElement("div");if(h.className=ee({variant:s}),l){const e=document.createElement("span");if(t&&d?.winnerColor)e.style.color="string"==typeof d.winnerColor?d.winnerColor:"green";else if(d?.genderColor){const t=n?.person?.sex,i=("MALE"===t?"#2E86C1":"FEMALE"===t&&"#AA336A")||"";e.style.color="string"==typeof d.genderColor?d.genderColor:i}e.innerHTML=l,h.appendChild(e)}else{const e=1===a?.roundNumber||"FEED_IN"===a?.drawType&&a?.roundNumber>1&&i?.drawPosition&&!i?.sourceMatchUp;if(d?.inlineAssignment&&Ie(c?.assignParticipant)&&Ie(d?.participantProvider)&&e&&!i?.bye&&!i?.qualifier&&a){const e=Ri({matchUp:a,side:i,sideNumber:r,eventHandlers:c,composition:o});h.appendChild(e)}else{const e=document.createElement("abbr");e.className=function({variant:e}){return Q({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:e})}({variant:d?.showAddress?"showAddress":""}),e.innerHTML=i?.bye&&u.BYE||i?.qualifier&&u.QUALIFIER||u.TBD,h.appendChild(e)}}const g=VF({...e,className:Ci(),type:"seeding"});g&&h.appendChild(g),m.appendChild(h),p.appendChild(m);const I=be(e);return p.appendChild(I),{element:p}}const qF=Q({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{in_progress:{backgroundColor:"#199f01ff"},awaiting_result:{backgroundColor:"#199f01ff"},defaulted:{backgroundColor:"#df164c"},dead_rubber:{backgroundColor:"#df164c"},cancelled:{backgroundColor:"#df164c"},incomplete:{backgroundColor:"#f7ae04ff"},suspended:{backgroundColor:"#f7ae04ff"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}}),{WALKOVER:HF,DEFAULTED:zF,DOUBLE_WALKOVER:YF,DOUBLE_DEFAULT:KF}=cf;const XF=Q({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});const JF=Q({flexDirection:"column",position:"relative",display:"flex"}),QF=Q({alignItems:"stretch",display:"flex"}),ZF=Q({marginInlineEnd:".25rem",color:"green"});const{WALKOVER:eL,DEFAULTED:tL,DOUBLE_WALKOVER:iL,RETIRED:rL}=cf;function nL({initialRoundNumber:e=1,eventHandlers:t,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:o,matchUp:s}){const{winningSide:c,matchUpType:d,isRoundRobin:u,matchUpStatus:l}=s||{},p=r?.configuration;let m;const f=o?s?.sides?.find((e=>e.sideNumber===o)):void 0;n||(n=f?.participant,m=p?.allDrawPositions||p?.drawPositions&&f?.drawPosition&&(s?.roundNumber===e||f?.participantFed||u)?f?.drawPosition:"");const h="DOUBLES"===d,g=h?n?.individualParticipants?.[0]:n,I=h&&n?.individualParticipants?.[1],y=!!(o===c||"BYE"===l&&n),v=p?.winnerChevron&&y,S=p?.teamLogo,U=[rL,iL,eL,tL].includes(l)&&!y,b=p?.gameScoreOnly,w=document.createElement("div");if(i&&(w.className=function({drawPosition:e,sideNumber:t}){return Q({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:t,css:e&&{"&:before":{backgroundColor:"$backgroundColor",content:`${e}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}({drawPosition:m,sideNumber:o})),w.classList.add("tmx-p"),w.setAttribute("id",n?.participantId||""),S){const e=function({teamLogo:e}){console.log({teamLogo:e});const t=document.createElement("div");return t.className=XF(),t}({teamLogo:S});w.appendChild(e)}const T=document.createElement("div");T.className=te(h?{variant:"doubles"}:{});const D=document.createElement("div");D.className=function({winnerChevron:e,isDoubles:t}){const i=2*(t?.4:.3);return Q({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:e?"winner":void 0})}({winnerChevron:v,isDoubles:h});const P=WF({individualParticipant:g,eventHandlers:t,isWinningSide:y,composition:r,sideNumber:o,matchUp:s,side:f}).element;if(D.appendChild(P),I){const e=WF({individualParticipant:I,eventHandlers:t,isWinningSide:y,composition:r,sideNumber:o,matchUp:s,side:f}).element;D.appendChild(e)}else h&&a&&function(e){return e instanceof Element||e}(a)&&D.appendChild(a);if(T.appendChild(D),w.appendChild(T),i){const e=document.createElement("div");if(y&&!b){const t=function({dim:e="20px"}={}){return`\n    <div style="line-height: 0;">\n      <svg height="${e}" viewBox="0 0 18 24" width="${e}" xmlns="http://www.w3.org/2000/svg" class="${ZF()}" style="fill: currentcolor;">\n        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>\n      </svg>\n    </div>\n  `}();"string"==typeof t?e.innerHTML=t:e.appendChild(t)}else if(U){const t=function({matchUpStatus:e}){const t=e?.toLowerCase(),i=["defaulted","retired","walkover","defaulted","cancelled","in_progress","awaiting_result","dead_rubber","incomplete","suspended"].includes(t)?t:void 0,r=[HF,YF].includes(e||"")?"WO":[zF,KF].includes(e||"")?"DEF":e?.split("_").join("").slice(0,3)||"",n=document.createElement("div");n.className=qF(i?{variant:i}:{});const a=document.createElement("abbr");return a.setAttribute("title",e||""),a.style.textDecoration="none",a.style.borderBottom="none",a.innerHTML=r,n.appendChild(a),n}({matchUpStatus:l});e.appendChild(t)}w.appendChild(e)}return w}const aL=Q({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function oL({eventHandlers:e,roundMatchUps:t,roundProfile:i,roundNumber:r,context:n}){const a=document.createElement("div");a.className=aL(),a.classList.add("tmx-rh"),a.setAttribute("roundNumber",String(r));const o=Ie(e?.roundHeaderClick);o&&(a.onclick=a=>e.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:t,context:n,pointerEvent:a}));const s=o?"\u22ee":"",c=i?.[r]?.roundName,d=c&&` <div style="display: flex; flex-direction: row; justify-content: space-between">\n        <div>${c}</div>\n        <div style="font-weight: bold">${s}</div>\n      </div>\n  `;return a.innerHTML=d||"",a}const sL=Q({flexDirection:"column",display:"flex"}),cL=Q({flexDirection:"row",display:"flex"}),dL=Q({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),uL=Q({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),lL=Q({fontWeight:"bold",color:"blue",height:"1em"}),pL=Q({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),mL=Q({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});const fL=Q({});const hL=Q({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),gL=Q({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),IL=Q({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function yL({eventHandlers:e,entryStatus:t,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");Ie(e?.centerInfoClick)&&(a.onclick=t=>e.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:t})),a.className=se(function({variant:e}){return Q({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:e})}({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",String(i));const o=document.createElement("div");o.className=hL();const s=document.createElement("div");s.className=gL();const c=document.createElement("div");c.className=IL(),c.innerHTML=t?"Entry status:&nbsp;":"",s.appendChild(c);const d=document.createElement("div");return d.className=IL(),d.innerHTML=t||"",s.appendChild(d),o.appendChild(s),a.appendChild(o),{element:a}}const vL={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};const SL=e=>Q({display:"flex",alignItems:"center",height:e,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),UL=Q({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),bL=Q({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),wL=Q({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function TL({gameScoreOnly:e,scoreStripes:t,set:i,sideNumber:r}){const n=r===i?.winningSide||i?.winningSide?"loser":void 0,a=2===r?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=2===r?i.side2TiebreakScore:i.side1TiebreakScore,c=void 0===a&&s,d=c||a,u=t&&i.setNumber%2?"lightgray":"transparent";let l;if(i.editing?i.editing===r:void 0)l=function({value:e}={}){const t=document.createElement("input");return t.onclick=e=>e.target.select(),t.className=bL(),t.value=String(e||""),t}({value:d});else if(l=document.createElement("p"),l.className=bL({variant:n}),l.classList.add("tmx-st"),l.setAttribute("setNumber",i.setNumber),l.style.backgroundColor=u,l.innerHTML=isNaN(d)?"":d,!e){const e=document.createElement("span");e.className=UL(),e.innerHTML=o&&!c?String(s):"",l.appendChild(e)}return l}const DL=Q({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var PL,NL={exports:{}};var EL=(PL||(PL=1,function(e,t){e.exports=function(){var e=1e3,t=6e4,i=36e5,r="millisecond",n="second",a="minute",o="hour",s="day",c="week",d="month",u="quarter",l="year",p="date",m="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],i=e%100;return"["+e+(t[(i-20)%10]||t[i]||t[0])+"]"}},I=function(e,t,i){var r=String(e);return!r||r.length>=t?e:""+Array(t+1-r.length).join(i)+e},y={s:I,z:function(e){var t=-e.utcOffset(),i=Math.abs(t),r=Math.floor(i/60),n=i%60;return(t<=0?"+":"-")+I(r,2,"0")+":"+I(n,2,"0")},m:function e(t,i){if(t.date()<i.date())return-e(i,t);var r=12*(i.year()-t.year())+(i.month()-t.month()),n=t.clone().add(r,d),a=i-n<0,o=t.clone().add(r+(a?-1:1),d);return+(-(r+(i-n)/(a?n-o:o-n))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:d,y:l,w:c,d:s,D:p,h:o,m:a,s:n,ms:r,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},v="en",S={};S[v]=g;var U="$isDayjsObject",b=function(e){return e instanceof P||!(!e||!e[U])},w=function e(t,i,r){var n;if(!t)return v;if("string"==typeof t){var a=t.toLowerCase();S[a]&&(n=a),i&&(S[a]=i,n=a);var o=t.split("-");if(!n&&o.length>1)return e(o[0])}else{var s=t.name;S[s]=t,n=s}return!r&&n&&(v=n),n||!r&&v},T=function(e,t){if(b(e))return e.clone();var i="object"==typeof t?t:{};return i.date=e,i.args=arguments,new P(i)},D=y;D.l=w,D.i=b,D.w=function(e,t){return T(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var P=function(){function g(e){this.$L=w(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[U]=!0}var I=g.prototype;return I.parse=function(e){this.$d=function(e){var t=e.date,i=e.utc;if(null===t)return new Date(NaN);if(D.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var r=t.match(f);if(r){var n=r[2]-1||0,a=(r[7]||"0").substring(0,3);return i?new Date(Date.UTC(r[1],n,r[3]||1,r[4]||0,r[5]||0,r[6]||0,a)):new Date(r[1],n,r[3]||1,r[4]||0,r[5]||0,r[6]||0,a)}}return new Date(t)}(e),this.init()},I.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},I.$utils=function(){return D},I.isValid=function(){return this.$d.toString()!==m},I.isSame=function(e,t){var i=T(e);return this.startOf(t)<=i&&i<=this.endOf(t)},I.isAfter=function(e,t){return T(e)<this.startOf(t)},I.isBefore=function(e,t){return this.endOf(t)<T(e)},I.$g=function(e,t,i){return D.u(e)?this[t]:this.set(i,e)},I.unix=function(){return Math.floor(this.valueOf()/1e3)},I.valueOf=function(){return this.$d.getTime()},I.startOf=function(e,t){var i=this,r=!!D.u(t)||t,u=D.p(e),m=function(e,t){var n=D.w(i.$u?Date.UTC(i.$y,t,e):new Date(i.$y,t,e),i);return r?n:n.endOf(s)},f=function(e,t){return D.w(i.toDate()[e].apply(i.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(t)),i)},h=this.$W,g=this.$M,I=this.$D,y="set"+(this.$u?"UTC":"");switch(u){case l:return r?m(1,0):m(31,11);case d:return r?m(1,g):m(0,g+1);case c:var v=this.$locale().weekStart||0,S=(h<v?h+7:h)-v;return m(r?I-S:I+(6-S),g);case s:case p:return f(y+"Hours",0);case o:return f(y+"Minutes",1);case a:return f(y+"Seconds",2);case n:return f(y+"Milliseconds",3);default:return this.clone()}},I.endOf=function(e){return this.startOf(e,!1)},I.$set=function(e,t){var i,c=D.p(e),u="set"+(this.$u?"UTC":""),m=(i={},i[s]=u+"Date",i[p]=u+"Date",i[d]=u+"Month",i[l]=u+"FullYear",i[o]=u+"Hours",i[a]=u+"Minutes",i[n]=u+"Seconds",i[r]=u+"Milliseconds",i)[c],f=c===s?this.$D+(t-this.$W):t;if(c===d||c===l){var h=this.clone().set(p,1);h.$d[m](f),h.init(),this.$d=h.set(p,Math.min(this.$D,h.daysInMonth())).$d}else m&&this.$d[m](f);return this.init(),this},I.set=function(e,t){return this.clone().$set(e,t)},I.get=function(e){return this[D.p(e)]()},I.add=function(r,u){var p,m=this;r=Number(r);var f=D.p(u),h=function(e){var t=T(m);return D.w(t.date(t.date()+Math.round(e*r)),m)};if(f===d)return this.set(d,this.$M+r);if(f===l)return this.set(l,this.$y+r);if(f===s)return h(1);if(f===c)return h(7);var g=(p={},p[a]=t,p[o]=i,p[n]=e,p)[f]||1,I=this.$d.getTime()+r*g;return D.w(I,this)},I.subtract=function(e,t){return this.add(-1*e,t)},I.format=function(e){var t=this,i=this.$locale();if(!this.isValid())return i.invalidDate||m;var r=e||"YYYY-MM-DDTHH:mm:ssZ",n=D.z(this),a=this.$H,o=this.$m,s=this.$M,c=i.weekdays,d=i.months,u=i.meridiem,l=function(e,i,n,a){return e&&(e[i]||e(t,r))||n[i].slice(0,a)},p=function(e){return D.s(a%12||12,e,"0")},f=u||function(e,t,i){var r=e<12?"AM":"PM";return i?r.toLowerCase():r};return r.replace(h,(function(e,r){return r||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return D.s(t.$y,4,"0");case"M":return s+1;case"MM":return D.s(s+1,2,"0");case"MMM":return l(i.monthsShort,s,d,3);case"MMMM":return l(d,s);case"D":return t.$D;case"DD":return D.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return l(i.weekdaysMin,t.$W,c,2);case"ddd":return l(i.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(a);case"HH":return D.s(a,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return f(a,o,!0);case"A":return f(a,o,!1);case"m":return String(o);case"mm":return D.s(o,2,"0");case"s":return String(t.$s);case"ss":return D.s(t.$s,2,"0");case"SSS":return D.s(t.$ms,3,"0");case"Z":return n}return null}(e)||n.replace(":","")}))},I.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},I.diff=function(r,p,m){var f,h=this,g=D.p(p),I=T(r),y=(I.utcOffset()-this.utcOffset())*t,v=this-I,S=function(){return D.m(h,I)};switch(g){case l:f=S()/12;break;case d:f=S();break;case u:f=S()/3;break;case c:f=(v-y)/6048e5;break;case s:f=(v-y)/864e5;break;case o:f=v/i;break;case a:f=v/t;break;case n:f=v/e;break;default:f=v}return m?f:D.a(f)},I.daysInMonth=function(){return this.endOf(d).$D},I.$locale=function(){return S[this.$L]},I.locale=function(e,t){if(!e)return this.$L;var i=this.clone(),r=w(e,t,!0);return r&&(i.$L=r),i},I.clone=function(){return D.w(this.$d,this)},I.toDate=function(){return new Date(this.valueOf())},I.toJSON=function(){return this.isValid()?this.toISOString():null},I.toISOString=function(){return this.$d.toISOString()},I.toString=function(){return this.$d.toUTCString()},g}(),N=P.prototype;return T.prototype=N,[["$ms",r],["$s",n],["$m",a],["$H",o],["$W",s],["$M",d],["$y",l],["$D",p]].forEach((function(e){N[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),T.extend=function(e,t){return e.$i||(e(t,P,T),e.$i=!0),T},T.locale=w,T.isDayjs=b,T.unix=function(e){return T(1e3*e)},T.en=S[v],T.Ls=S,T.p={},T}()}(NL)),NL.exports);const ML=re(EL);function RL({initialRoundNumber:e=1,eventHandlers:t,composition:i,sideNumber:r,className:n,matchUp:a}){const o=(i?.configuration||{})?.scheduleInfo,s=a?.score?.scoreStringSide1,c=i?.configuration?.scoreBox&&s,d=a?.readyToScore&&t?.scoreClick&&!CF.checkScoreHasValue({matchUp:a}),u=document.createElement("div");if(u.className=se(JF(),n),u.classList.add("tmx-sd"),u.setAttribute("sideNumber",String(r)),o&&1===r){const e=function({matchUp:e,eventHandlers:t}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=e?.schedule||{},{dateTime:{extractDate:o,extractTime:s}}=eF,c=s(i);let d=o(r),u="ddd D MMMM";c&&(u+=", hh:mm A",d+=`T${c}`);const l=r?ML(d).format(u):"Not scheduled",p=n&&a?.toString().startsWith(n)&&a||n&&a&&`${n} ${a}`||a||n||"",m=document.createElement("div");m.className=DL(),m.classList.add("tmx-sch"),Ie(t?.scheduleClick)&&(m.onclick=i=>t.scheduleClick({matchUp:e,pointerEvent:i}));const f=document.createElement("div");f.innerHTML=l,m.append(f);const h=document.createElement("div");h.style="display: flex; flex-direction: row";const g=document.createElement("div");if(g.style.paddingRight=".2rem",g.onclick=i=>{Ie(t?.venueClick)&&(i.stopPropagation(),t.venueClick({pointerEvent:i,matchUp:e}))},g.innerHTML=p,h.append(g),m.append(h),m.onclick){const e=document.createElement("div");e.innerHTML="\u22ee",h.append(e)}return m}({matchUp:a,eventHandlers:t});u.appendChild(e)}const l=document.createElement("div");l.className=QF();const p=nL({sideContainer:!0,initialRoundNumber:e,eventHandlers:t,composition:i,sideNumber:r,matchUp:a});if(l.appendChild(p),c){const e=document.createElement("div");e.style.border="1px solid lightgray",l.appendChild(e)}if(s){const e=function({participantHeight:e,eventHandlers:t,composition:i,sideNumber:r,matchUp:n}){const a=i?.configuration?.winnerChevron,o=i?.configuration?.gameScoreOnly,s=n?.score?.sets||[],c=i?.configuration?.scoreBox,d=e?2===r?e:e-1:void 0,u=document.createElement("div");u.className=SL(d)({...!c&&1===r&&{sideNumber:1},fontSize:"small"}),u.classList.add("sideScore"),u.classList.add("tmx-scr"),u.onclick=e=>{Ie(t?.scoreClick)&&(e.stopPropagation(),t.scoreClick({pointerEvent:e,matchUp:n}))};const l=document.createElement("div");l.className=wL();for(const p of s||[]){const e=TL({gameScoreOnly:o,scoreStripes:a,sideNumber:r,set:p});l.appendChild(e)}return u.appendChild(l),u}({eventHandlers:t,composition:i,sideNumber:r,matchUp:a});l.appendChild(e)}if(d){const e=e=>{Ie(t?.scoreClick)&&(e.stopPropagation(),t.scoreClick({pointerEvent:e,matchUp:a}))},i=document.createElement("div");i.className=SL(void 0)({...!c&&1===r&&{sideNumber:1},fontSize:"small"}),i.onclick=e,i.innerHTML="[Score]",l.appendChild(i)}return u.appendChild(l),u}function CL(e){const{composition:t,initialRoundNumber:i=1,matchUp:r,moiety:n,selectedMatchUpId:a,searchActive:o}=e,{roundFactor:s,roundNumber:c,finishingRound:d,matchUpType:u,preFeedRound:l,stage:p}=r,m=e.isFinalRound||!!d&&1===Number.parseInt(String(d)),f="QUALIFYING"===p&&m,h=m,g=!!c&&Number.parseInt(String(c))===i,I="DOUBLES"===u,y=(o||r.isRoundRobin||r.collectionId||e.isLucky||e.isAdHoc?"mr":h&&"noProgression")||(f||l)&&"m0"||n&&"m1"||"m2",v=function({composition:e,isDoubles:t,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=e?.configuration||{},a=n?.connectorWidth||16,o=n.centerInfo?vL.centerInfo*r:0,s=n.scheduleInfo?vL.scheduleInfo*r:0,c=(60+(n.showAddress?r:0))*(t?1.3:1)+o;return Q({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c*i,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:(c+s)*i}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}({composition:t,isDoubles:I,roundFactor:s})({isFirstRound:g,link:y}),S=t?.configuration||{},{resultsInfo:U,centerInfo:b}=S||{},w=e.eventHandlers||{},T=document.createElement("div");T.className=se(t?.theme,e?.className,"matchup",fL()),T.classList.add("tmx-m"),T.setAttribute("id",r?.matchUpId),T.onclick=e=>{Ie(w?.matchUpClick)&&w.matchUpClick({pointerEvent:e,matchUp:r})};const D=document.createElement("div");D.className=function({configuration:e}){const t={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(e?.matchUpHover){const i="string"==typeof e.matchUpHover?e.matchUpHover:"cyan";t["&:hover"]={backgroundColor:i}}else t["&:hover"]={borderColor:"$borderHover"};return Q(t)()}({configuration:S});const P=({sideNumber:e})=>{const t=r?.sides?.find((t=>t.sideNumber===e))?.participant?.entryStatus?.replace("_"," ");return yL({eventHandlers:w,entryStatus:t,sideNumber:e,className:2===e?v:void 0,matchUp:r})},N=RL({initialRoundNumber:i,eventHandlers:w,sideNumber:1,composition:t,matchUp:r}),E=RL({className:!b&&v,initialRoundNumber:i,eventHandlers:w,sideNumber:2,composition:t,matchUp:r});if(D.appendChild(N),b){const e=P({sideNumber:1}),t=P({sideNumber:2});D.appendChild(e.element),D.appendChild(t.element)}if(D.appendChild(E),U){const e=function({score:e}){const t=e?.sets?.filter(Boolean).sort(((e,t)=>(e.setNumber||0)-(t.setNumber||0))),i=t?.at(-1),r=i?.side1PointsScore||i?.side2PointsScore,n=document.createElement("div");if(n.className=mL(),r){const e=document.createElement("div");e.className=pL({variant:"points"}),e.innerHTML="PTS",n.appendChild(e)}for(const a of t||[]){const e=document.createElement("div");e.setAttribute("key",String(a.setNumber)),e.className=pL({variant:"set"}),e.innerHTML=String(a.setNumber),n.appendChild(e)}return n}({score:r.score});D.appendChild(e)}if(T.appendChild(D),a===r.matchUpId){const e=document.createElement("div");e.className=Q({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})(),T.appendChild(e)}return T}function AL({initialRoundNumber:e=1,selectedMatchUpId:t,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:o,roundFactor:s,roundNumber:c,roundProfile:d,minWidth:u,matchUps:l,context:p,isLucky:m}){const f=l.filter((e=>e.roundNumber===c)).sort(((e,t)=>(e.roundPosition||0)-(t.roundPosition||0))),h=f.every((({roundPosition:e,drawPositions:t})=>!e&&!t)),g=o?.configuration||{},I=document.createElement("div");if(I.className=sL(),I.classList.add("tmx-rd"),I.setAttribute("roundNumber",String(c)),g.roundHeader){const e=oL({roundProfile:d,roundMatchUps:f,roundNumber:c,eventHandlers:i,context:p});I.appendChild(e)}const y=document.createElement("div");let v,S,U;if(y.className=dL({variant:h?"adHoc":void 0}),u&&(y.style.minWidth=u),n){const e=e=>(e||[]).reduce(((e,t)=>t+e),0);f.sort(((t,i)=>{const r=e(t.drawPositions)-e(i.drawPositions),n=t.drawPositions||[],a=i.drawPositions||[],o=(n.length?Math.min.apply(null,n):0)-(a.length?Math.min.apply(null,a):0);return r||o}));const t=f.reduce(((e,t)=>(e[t.structureId]=t.structureName,e)),{});v=Object.values(t),S=Object.keys(t),U=Object.keys(eF.instanceCount(f.map((({structureId:e})=>e)))).length}else h&&f.sort(((e,t)=>(e.roundOrder??0)-(t.roundOrder??0)));const b=U&&f.length/U,w=Object.keys(d).map((e=>parseInt(e))),T=w.indexOf(c),D=0===T?"first":T===w.length-1&&"last";return f.forEach(((n,d)=>{const u=b&&!(d%b),l=b&&Math.floor(d/b),p=b&&v[l];if(u){const t=document.createElement("div");t.className=uL({...0===l&&{variant:0},...D&&{roundOrder:D}}),y.appendChild(t);const r=document.createElement("div");if(r.className=lL(),Ie(i?.groupHeaderClick)){const{drawId:e,containerStructureId:t}=f[0];y.onclick=r=>i.groupHeaderClick({structureId:S[l],containerStructureId:t,pointerEvent:r,drawId:e})}c===e&&(r.innerHTML=p),y.appendChild(r)}const g=d%2==0;s?n.roundFactor=s:e>1&&(n.roundFactor=Math.pow(2,c-e));const I=CL({initialRoundNumber:e,selectedMatchUpId:t,eventHandlers:i,isFinalRound:r,searchActive:a,composition:o,isAdHoc:h,isLucky:m,matchUp:n,moiety:g});y.appendChild(I)})),I.appendChild(y),I}function kL({initialRoundNumber:e=1,selectedMatchUpId:t,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:o,matchUps:s,minWidth:c,context:d}){const{roundNumbers:u,roundProfile:l,hasOddMatchUpsCount:p,isNotEliminationStructure:m}=CF.getRoundMatchUps({matchUps:s});a=a||d?.structureId||s?.[0]?.structureId;const f=s.some((({isRoundRobin:e})=>e)),h=p||m,g=document.createElement("div");g.className=cL(),g.classList.add("tmx-str"),g.setAttribute("id",a||"");const I=u.length?Math.max.apply(null,u):0;for(const y of u){if(y<e)continue;const a=AL({initialRoundNumber:e,selectedMatchUpId:t,eventHandlers:i,isFinalRound:y===I,isRoundRobin:f,searchActive:r,composition:n,roundNumber:y,roundProfile:l,matchUps:s,minWidth:c,context:d,isLucky:h});g.appendChild(a)}if(o&&"boolean"!=typeof o){const e=document.createElement("div");e.className=sL();const t=document.createElement("div");t.className=dL(),t.appendChild(o),e.appendChild(t),g.appendChild(e)}return g}const OL=Q({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function xL({content:e,theme:t}){const i=document.createElement("div");return i.className=t?se(OL(),t):OL(),t&&i.classList.add(t),"string"==typeof e?i.innerHTML=e:i.appendChild(e),i}const{createTheme:FL}=J({theme:{lineHeights:{scheduleInfo:`${vL.scheduleInfo}rem`,centerInfo:`${vL.centerInfo}rem`,gameScore:`${vL.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),LL=FL("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),_L=FL("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),BL=FL("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),VL=FL("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),jL=FL("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),$L=FL("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),GL={Australian:{configuration:{flags:!0},theme:LL},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:jL},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:jL},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:BL},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:_L},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:VL},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:FL("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}})},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:LL},Night:{configuration:{flags:!0},theme:$L}};function WL(e,t,i){const r=document.createElement("div");r.style.cssText="display: flex; flex-direction: column; width: 100%;",r.classList.add("flexcol");const n={},a={};let o;for(const s of t)if(!s.text&&!s.html||s.field){if(s.divider){const e=document.createElement("hr");e.classList.add("dropdown-divider"),r.appendChild(e)}else if(s.spacer){const e=document.createElement("div"),t="number"==typeof s.spacer&&`${s.spacer}em`||"string"==typeof s.spacer&&s.spacer||"1em";e.style.marginBlockEnd=t,r.appendChild(e)}else if((s.label||s.field)&&!s.hide&&s.field){const e=s.fieldPair&&document.createElement("div");e&&(e.className="flexrow");const{field:t,inputElement:i,datepicker:c,subFields:d}=Mi(s);if(d&&d.forEach((e=>n[e.field]=e.input)),c&&(n[`${s.field}.date`]=c),s.focus&&(o=i),n[s.field]=i,a[s.field]=t,e){e.appendChild(t);const{field:i,inputElement:c,datepicker:d}=Mi(s.fieldPair);d&&(n[`${s.field}.date`]=d),c&&(n[s.fieldPair.field]=c,s.fieldPair.focus&&(o=c)),a[s.fieldPair.field]=i,e.appendChild(i),r.appendChild(e)}else r.appendChild(t)}}else{const e=s.fieldPair&&document.createElement("div");e&&(e.className="flexrow");const t=document.createElement("div");t.className="flexaligncenter",t.style.cssText=s.style||s.header&&"font-weight: bold; font-size: larger;"||"height: 2.5em; padding-right: 1em;";const i=document.createElement("div");if(s.id&&(i.id=s.id),i.className="content",i.innerHTML=s.text,t.appendChild(i),e){e.appendChild(t);const{field:i,inputElement:c,datepicker:d}=Mi(s.fieldPair);d&&(n[`${s.field}.date`]=d),c&&(n[s.fieldPair.field]=c,s.fieldPair.focus&&(o=c)),a[s.fieldPair.field]=i,e.appendChild(i),r.appendChild(e)}else r.appendChild(t)}if(o&&setTimeout((()=>o.focus()),200),e.appendChild(r),i?.length)for(const s of i){if(s.dateRange&&Array.isArray(s.fields)){const[e,t]=s.fields;if(n[e]&&n[t]){const i=new Di(n[e],{inputs:[n[e],n[t]],minDate:s.minDate,maxDate:s.maxDate,format:"yyyy-mm-dd",autohide:!0});n[`${e}.date`]=i}}s.control&&(we(s.onChange)&&n[s.control].addEventListener("change",(e=>s.onChange({e:e,inputs:n,fields:a}))),we(s.onInput)&&n[s.control]&&n[s.control].addEventListener("input",(e=>s.onInput({e:e,inputs:n,fields:a}))),we(s.onFocusOut)&&n[s.control]&&n[s.control].addEventListener("focusout",(e=>s.onFocusOut({e:e,inputs:n,fields:a}))))}return n}const{WTN:qL,UTR:HL}=xF.ratingConstants,{FEMALE:zL,MALE:YL,ANY:KL}=rc;function XL(e={}){const{callback:t,consideredDate:i,title:r="Generate mock players",labels:n={},defaults:a={}}=e;let o;const s={gender:n.gender||"Participant gender",count:n.count||"Participant count",ageRange:n.ageRange||"Participant Age Range",minAge:n.minAge||"Minimum Age",maxAge:n.maxAge||"Maximum Age",ratings:n.ratings||"Generate Ratings",wtn:n.wtn||"WTN",utr:n.utr||"UTR"},c={gender:a.gender||KL,participantsCount:a.participantsCount||32,ageMin:a.ageMin,ageMax:a.ageMax,wtnRating:a.wtnRating||!1,utrRating:a.utrRating||!1},d=[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const e=o.participantsCount.value,r=o.wtnRating.checked,n=o.utrRating.checked,a=o.gender.value,s=a===KL?void 0:a,c=o.ageMin?.value?Number.parseInt(o.ageMin.value):void 0,d=o.ageMax?.value?Number.parseInt(o.ageMax.value):void 0,u=[r&&{ratingType:qL,ratingMin:14,ratingMax:19.99},n&&{ratingType:HL,ratingMin:8,ratingMax:10}].filter(Boolean),l=c||d?{ageMin:c,ageMax:d}:void 0,{participants:p}=RF.generateParticipants({participantsCount:Number.parseInt(e),scaleAllParticipants:!0,consideredDate:i,categories:u,category:l,sex:s});t&&t(p)}}],u=[{control:"ageMin",onChange:({inputs:e})=>{const t=Number.parseInt(e.ageMin.value)||0,i=Number.parseInt(e.ageMax.value)||0;t>i&&i>0&&(e.ageMax.value=t)}},{control:"ageMax",onChange:({inputs:e})=>{const t=Number.parseInt(e.ageMin.value)||0,i=Number.parseInt(e.ageMax.value)||0;i<t&&t>0&&i>0&&(e.ageMin.value=i)}}];Se.open({title:r,content:e=>o=WL(e,[{options:[{label:"Any",value:KL,selected:c.gender===KL},{label:"Female",value:zL,selected:c.gender===zL},{label:"Male",value:YL,selected:c.gender===YL}],label:s.gender,field:"gender",value:c.gender},{options:[{label:"8",value:8,selected:8===c.participantsCount},{label:"16",value:16,selected:16===c.participantsCount},{label:"32",value:32,selected:32===c.participantsCount},{label:"64",value:64,selected:64===c.participantsCount},{label:"128",value:128,selected:128===c.participantsCount},{label:"256",value:256,selected:256===c.participantsCount}],label:s.count,field:"participantsCount",value:c.participantsCount},{text:s.ageRange,header:!0},{label:s.minAge,field:"ageMin",placeholder:"e.g., 10",type:"number",value:c.ageMin},{label:s.maxAge,field:"ageMax",placeholder:"e.g., 18",type:"number",value:c.ageMax},{text:s.ratings,header:!0},{label:s.wtn,field:"wtnRating",id:"wtnRating",checkbox:!0,value:c.wtnRating},{label:s.utr,field:"utrRating",id:"utrRating",checkbox:!0,value:c.utrRating}],u),buttons:d})}const JL="Timed set",QL="Tiebreak",ZL="No-Ad",e_="Set",t_="Ad";function i_(e=!1){return{descriptor:e?"Final set":"Best of",bestOf:e?void 0:3,advantage:t_,what:e_,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}}function r_(e){return e<=1?[]:[e-1,e]}const n_=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"},{key:"1pointslam",name:"1 Point Slam",format:"SET1-S:TB1NOAD"}],a_="none",o_="\u25be";function s_(e){return"function"==typeof e}const c_={labels:{title:"Match format",setFormatLabel:"Set format",finalSetLabel:"Final set",tiebreakLabel:"Tiebreak",finalSetToggleLabel:"Final set",standardFormatsLabel:"Standard formats",descriptors:{bestOf:"Best of",exactly:"Exactly"},what:{sets:"Set",tiebreaks:"Tiebreak",timedSets:"Timed set"},advantage:{ad:"Ad",noAd:"No-Ad"}},options:{bestOf:[1,3,5],exactly:[1,2,3,4,5],setTo:[1,2,3,4,5,6,7,8,9],tiebreakTo:[5,7,9,10,12],tiebreakToExactly:[1,3],tiebreakAt:[3,4,5,6,7,8],minutes:[5,10,15,20,30],winBy:[1,2]}};let d_,u_,l_=c_;const p_="Timed set",m_="Tiebreak",f_="No-Ad",h_="Set",g_="Ad",I_={setFormat:{descriptor:"Best of",bestOf:3,advantage:g_,what:h_,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:g_,what:h_,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function y_(e){return function(e,t){const{what:i,setTo:r,tiebreakAt:n,tiebreakTo:a,winBy:o,minutes:s,advantage:c,based:d}=e,u={setTo:r};return i===e_&&c===ZL&&(u.NoAD=!0),t&&i===e_&&(u.tiebreakAt=n,u.tiebreakFormat={tiebreakTo:a},1===o&&(u.tiebreakFormat.NoAD=!0)),i===JL&&(u.minutes=s,u.timed=!0,d&&(u.based=d)),i===QL&&(u.tiebreakSet={tiebreakTo:a},1===o&&(u.tiebreakSet.NoAD=!0)),u}(I_[e?"finalSetFormat":"setFormat"],document.getElementById(e?"finalSetTiebreak":"setTiebreak")?.checked||!1)}function v_(){u_={setFormat:y_()};const e=I_.setFormat.descriptor,t=I_.setFormat.exactly??I_.setFormat.bestOf??3;"Exactly"===e?(u_.exactly=t,delete u_.bestOf):(u_.bestOf=t,delete u_.exactly),document.getElementById("finalSetOption")?.checked&&(u_.finalSetFormat=y_(1));const i=xi.scoreGovernor.stringifyMatchUpFormat(u_),r=(l_.preDefinedFormats?l_.preDefinedFormats.map((e=>({value:e.code,label:e.text,format:e.code}))):n_).some((e=>e.format===i)),n=document.getElementById("matchUpFormatSelector");if(n){const e=n.value,t=r?i:"Custom";if(e!==t){const e=n.onchange;n.onchange=null,n.value=t,n.onchange=e}}return i}function S_(e){const t=e||v_();d_=t;const i=document.getElementById("matchUpFormatString");i&&(i.innerHTML=t)}const U_=(e,t)=>t&&e.finalSetFormat||e.setFormat,b_=[{getValue:e=>e.exactly?l_.labels?.descriptors?.exactly||"Exactly":l_.labels?.descriptors?.bestOf||"Best of",options:()=>[l_.labels?.descriptors?.bestOf||"Best of",l_.labels?.descriptors?.exactly||"Exactly"],id:"descriptor",value:l_.labels?.descriptors?.bestOf||"Best of",finalSet:!1,onChange:"changeDescriptor"},{getValue:e=>e.bestOf||e.exactly,finalSet:!1,id:"bestOf",options:()=>I_.setFormat.descriptor===(l_.labels?.descriptors?.exactly||"Exactly")?l_.options?.exactly||c_.options.exactly:l_.options?.bestOf||c_.options.bestOf,onChange:"pluralize",onChangeCallback:"updateFinalSetVisibility",value:3},{getValue:(e,t)=>{const i=U_(e,t),r=i?.NoAD?f_:g_;return i?.timed||i?.tiebreakSet?void 0:r},options:[g_,f_],onChange:"changeAdvantage",defaultValue:g_,id:"advantage",whats:[h_]},{getValue:(e,t)=>{const i=U_(e,t);return i||console.log({pmf:e}),i?.timed?p_:i?.tiebreakSet?m_:h_},options:[h_,m_,p_],finalSetLabel:`${h_}${o_}`,onChange:"changeWhat",onChangeCallback:"updateWhatValue",pluralize:!0,id:"what"},{getValue:(e,t)=>U_(e,t).setTo,options:()=>l_.options?.setTo||c_.options.setTo,onChange:"changeCount",defaultValue:6,whats:[h_],prefix:"to ",id:"setTo"},{getValue:(e,t)=>{const i=U_(e,t);return i.tiebreakFormat?.tiebreakTo||i.tiebreakSet?.tiebreakTo},options:e=>{const t=I_.setFormat.descriptor,i=l_.options?.tiebreakTo||c_.options.tiebreakTo,r=l_.options?.tiebreakToExactly||c_.options.tiebreakToExactly;return e&&"Exactly"===t?[...r,...i]:i},onChange:"changeTiebreakTo",whats:[h_,m_],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(e,t)=>U_(e,t).tiebreakAt,options:e=>r_(I_[e?"finalSetFormat":"setFormat"].setTo),onChange:"changeTiebreakAt",id:"tiebreakAt",defaultValue:6,whats:[h_],prefix:"@",value:6,tb:!0},{getValue:(e,t)=>{const i=U_(e,t);return i.tiebreakFormat||i.tiebreakSet?i.tiebreakFormat?.NoAD||i.tiebreakSet?.NoAD?1:2:void 0},whats:[h_,m_],onChange:"changeWinBy",prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(e,t)=>{const i=U_(e,t);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],onChange:"changeMinutes",whats:[p_],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0},{getValue:(e,t)=>{const i=U_(e,t);if(i?.timed)return i.based||"G"},options:["G","P","A"],onChange:"changeBased",whats:[p_],defaultValue:"G",id:"based",timed:!0}],w_={changeDescriptor:(e,t,i)=>{I_.setFormat.descriptor=i;const r=I_.setFormat.bestOf||I_.setFormat.exactly||3;if("Exactly"===i){if(I_.setFormat.what!==p_){delete I_.setFormat.setTo,delete I_.setFormat.tiebreakAt,delete I_.setFormat.tiebreakTo,delete I_.setFormat.winBy,delete I_.setFormat.tiebreakFormat,delete I_.setFormat.NoAD,I_.setFormat.what=p_,I_.setFormat.minutes||(I_.setFormat.minutes=10),w_.changeWhat(new Event("click"),void 0,p_);const e=document.getElementById("what");if(e){const t=r>1?"s":"";e.innerHTML=`${p_}${t}${o_}`}const t=document.getElementById("minutes");t&&(t.innerHTML=`${I_.setFormat.minutes} Minutes${o_}`,t.style.display="");const i=document.getElementById("based");if(i){const e=I_.setFormat.based||"G";i.innerHTML=`${e}${o_}`,i.style.display=""}}I_.setFormat.exactly=r,delete I_.setFormat.bestOf}else{const e=r%2==0?r+1:r;I_.setFormat.bestOf=e,delete I_.setFormat.exactly;const t=document.getElementById("bestOf");t&&(t.innerHTML=`${e}${o_}`),e!==r&&w_.pluralize(new Event("click"),void 0,e)}const n=document.getElementById("tiebreakTo-1");if(n&&n.style.display!==a_){const e=I_.finalSetFormat.tiebreakTo||7,t=b_.find((e=>"tiebreakTo"===e.id));if(t){const{prefix:i="",suffix:r=""}=t,a=(s_(t.options)?t.options(1):t.options).includes(e)?e:7;a!==e&&(I_.finalSetFormat.tiebreakTo=a),n.innerHTML=`${i}${a}${r}${o_}`}}S_()},changeWhat:(e,t,i)=>{const r=i===h_,n=t?"finalSetTiebreakToggle":"setTiebreakToggle";if(document.getElementById(n).style.display=r?"":a_,!t&&i!==p_&&"Exactly"===I_.setFormat.descriptor){I_.setFormat.descriptor="Best of";const e=I_.setFormat.exactly||3,t=e%2==0?e+1:e;I_.setFormat.bestOf=t,delete I_.setFormat.exactly;const i=document.getElementById("descriptor");i&&(i.innerHTML=`Best of${o_}`);const r=document.getElementById("bestOf");r&&(r.innerHTML=`${t}${o_}`)}b_.forEach((e=>{if(e.whats){const{prefix:r="",suffix:n="",pluralize:a}=e,o=e.whats.includes(i),s=t?`${e.id}-${t}`:e.id,c=document.getElementById(s);if(c.style.display===a_&&o){const i=u_.bestOf||u_.exactly,o=!t&&a&&i>1?"s":"",s=e.defaultValue;c.innerHTML=`${r}${s}${o}${n}${o_}`,I_[t?"finalSetFormat":"setFormat"][e.id]=s}c.style.display=o?"":a_}})),S_()},changeCount:(e,t,i)=>{const r=t?"finalSetFormat":"setFormat";I_[r].setTo=i;const n=I_[r].tiebreakAt,a=function(e,t){return r_(e).includes(t)?t:e}(i,n);if(a!==n){I_[r].tiebreakAt=a;const e=document.getElementById(t?`tiebreakAt-${t}`:"tiebreakAt");e&&(e.innerHTML=`@${a}${o_}`)}S_()},changeTiebreakAt:(e,t,i)=>{I_[t?"finalSetFormat":"setFormat"].tiebreakAt=i,S_()},updateWhatValue:(e,t,i)=>{I_[t?"finalSetFormat":"setFormat"].what=i},changeAdvantage:(e,t,i)=>{I_[t?"finalSetFormat":"setFormat"].advantage=i,S_()},changeTiebreakTo:(e,t,i)=>{I_[t?"finalSetFormat":"setFormat"].tiebreakTo=i,S_()},changeWinBy:(e,t,i)=>{I_[t?"finalSetFormat":"setFormat"].winBy=i,S_()},changeMinutes:(e,t,i)=>{I_[t?"finalSetFormat":"setFormat"].minutes=i,S_()},changeBased:(e,t,i)=>{I_[t?"finalSetFormat":"setFormat"].based="G"===i?void 0:i,S_()},pluralize:(e,t,i)=>{const r=I_[t?"finalSetFormat":"setFormat"].what,n=t?`what-${t}`:"what",a=i>1?"s":"";document.getElementById(n).innerHTML=`${r}${a}${o_}`,t||("Exactly"===I_.setFormat.descriptor?(I_.setFormat.exactly=i,delete I_.setFormat.bestOf):(I_.setFormat.bestOf=i,delete I_.setFormat.exactly)),S_()},updateFinalSetVisibility:(e,t,i)=>{const r=i>1,n=document.getElementById("finalSetOption"),a=document.querySelector('label[for="finalSetOption"]');n&&a&&(r?(n.style.display="",a.style.display=""):(n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change"))),n.style.display="none",a.style.display="none"))}};function T_({existingMatchUpFormat:e="SET3-S:6/TB7",callback:t,config:i,modalConfig:r}={}){l_=i?{labels:{...c_.labels,...i.labels},options:{...c_.options,...i.options},preDefinedFormats:i.preDefinedFormats||c_.preDefinedFormats}:c_,d_=e,u_=QR.parse(d_),u_||(console.warn("Invalid matchUpFormat:",d_),d_="SET3-S:6/TB7",u_=QR.parse(d_));const n=function(e,t){const i=t(e),r=i_(!1),n=i_(!0),a={setFormat:{...r,...i.setFormat},finalSetFormat:{...n,...i.finalSetFormat}};return i.setFormat?.based&&(a.setFormat.based=i.setFormat.based),i.finalSetFormat?.based&&(a.finalSetFormat.based=i.finalSetFormat.based),i.exactly?(a.setFormat.exactly=i.exactly,a.setFormat.descriptor="Exactly",delete a.setFormat.bestOf,a.setFormat.timed&&(a.setFormat.what=JL)):(a.setFormat.bestOf=i.bestOf||3,a.setFormat.descriptor="Best of",delete a.setFormat.exactly),function(e){return!(!e?.tiebreakSet?.tiebreakTo||e?.setTo)}(i.finalSetFormat)&&(a.finalSetFormat.what=QL,a.finalSetFormat.tiebreakTo=i.finalSetFormat.tiebreakSet.tiebreakTo,a.finalSetFormat.winBy=i.finalSetFormat.tiebreakSet.NoAD?1:2),a}(d_,QR.parse);I_.setFormat={...n.setFormat},I_.finalSetFormat={...n.finalSetFormat};const a=[{onClick:()=>{E_(),t?.("")},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{label:"Select",intent:"is-info",close:!0,onClick:()=>{E_(),(()=>{const e=document.getElementById("matchUpFormatSelector"),i=e?.value&&"Custom"!==e.value?d_:v_();s_(t)&&t(i)})()}}],o="switch is-rounded is-danger",s=document.createElement("div");s.addEventListener("click",(e=>{const t=e.target;!t.closest(".dropdown")&&!t.classList.contains("mfcButton")&&E_()}));const c=document.createElement("div");c.id="matchUpFormatString",c.innerHTML=d_,c.style.fontSize="1.5em",c.style.color="blue",c.style.marginBottom="1em",s.appendChild(c);const d=document.createElement("div");d.style.marginBlockEnd="1em";const u=[{value:"Custom",label:"Custom",selected:!1},...(l_.preDefinedFormats?l_.preDefinedFormats.map((e=>({value:e.code,label:e.text,format:e.code}))):n_).filter((e=>e.format)).map((e=>({selected:e.format===d_,value:e.format,label:("label"in e?e.label:e.name)||""})))],l=document.createElement("select");l.id="matchUpFormatSelector",l.className="input",l.style.width="100%",l.style.backgroundColor="#ffffff",l.style.color="#363636",l.style.border="1px solid #b5b5b5";for(const E of u){const e=document.createElement("option");e.value=E.value||"",e.text=E.label||"",e.style.backgroundColor="#ffffff",e.style.color="#363636",E.selected&&(e.selected=!0),l.appendChild(e)}l.onchange=e=>{if(d_=e.target.value,S_(d_),u_=QR.parse(d_),!u_)return void console.warn("Invalid matchUpFormat selected:",d_);I_.setFormat={...u_.setFormat},u_.exactly?(I_.setFormat.exactly=u_.exactly,I_.setFormat.descriptor="Exactly",delete I_.setFormat.bestOf,I_.setFormat.timed&&(I_.setFormat.what=p_)):(I_.setFormat.bestOf=u_.bestOf,I_.setFormat.descriptor="Best of",delete I_.setFormat.exactly),u_.finalSetFormat&&(I_.finalSetFormat=u_.finalSetFormat);const t=u_.bestOf||u_.exactly;w_.updateFinalSetVisibility(null,0,t);const i=u_.finalSetFormat;v.style.display=i?"":a_,S.style.display=i?"":a_,I.checked=i;const r=i?.tiebreakSet?.tiebreakTo&&!i?.setTo;b.checked=!!i?.tiebreakFormat,b.style.display=r?a_:"";const n=document.getElementById("finalSetTiebreakToggle");n&&(n.style.display=r?a_:""),f.checked=u_.setFormat.tiebreakFormat,b_.forEach((e=>{if(e.getValue){const t=e.getValue(u_),r=document.getElementById(e.id);if(r&&t){const{prefix:i="",suffix:n="",pluralize:a}=e,o=u_.bestOf||u_.exactly,s=a&&o>1?"s":"";r.innerHTML=`${i}${t}${s}${n}${o_}`,r.style.display=""}else r&&(r.style.display=a_);if(i){const t=e.getValue(u_,!0),i=document.getElementById(`${e.id}-1`);if(i&&t){const{prefix:r="",suffix:n="",pluralize:a}=e,o=u_.bestOf||u_.exactly,s=a&&o>1?"s":"";i.innerHTML=`${r}${t}${s}${n}${o_}`,i.style.display=""}else i&&(i.style.display=a_)}}}))},d.appendChild(l),s.appendChild(d);const p=document.createElement("div");p.style.display="flex",p.style.flexWrap="wrap",p.style.gap="0.5em",p.style.marginBottom="1em",b_.map((e=>{const t=e.getValue?e.getValue(u_):void 0;return D_({...e,value:t})})).forEach((e=>p.appendChild(e))),p.id="setFormat",s.appendChild(p);const m=document.createElement("div");m.className="field",m.style.fontSize="1em";const f=document.createElement("input");f.className=o,f.name="setTiebreak",f.id="setTiebreak",f.type="checkbox",f.checked=!!u_.setFormat.tiebreakFormat,f.onchange=e=>{const t=e.target.checked;b_.filter((({tb:e})=>e)).forEach((e=>{const i=document.getElementById(e.id);if(i){if(i.style.display===a_&&t){const{prefix:t="",suffix:r="",pluralize:n,defaultValue:a}=e,o=u_.bestOf||u_.exactly,s=n&&o>1?"s":"";i.innerHTML=`${t}${a}${s}${r}${o_}`}i.style.display=t?"":a_}})),S_()},m.appendChild(f);const h=document.createElement("label");h.setAttribute("for","setTiebreak"),h.id="setTiebreakToggle",h.innerHTML="Tiebreak",h.style.marginRight="1em",m.appendChild(h);const g=(u_.bestOf||u_.exactly)>1,I=document.createElement("input");I.className="switch is-rounded is-info",I.type="checkbox",I.name="finalSetOption",I.checked=!!u_.finalSetFormat,I.id="finalSetOption",I.style.display=g?"":"none",I.onchange=e=>{const t=e.target.checked;if(t){I_.finalSetFormat={...I_.setFormat,descriptor:"Final set"};const e=I_.setFormat.what,t=I_.setFormat.bestOf||I_.setFormat.exactly||3,i=document.getElementById("what-1");if(i){const r=t>1?"s":"";i.innerHTML=`${e}${r}${o_}`}b_.forEach((t=>{const i=document.getElementById(`${t.id}-1`);if(i)if(!t.whats||t.whats.includes(e)){const e=I_.finalSetFormat[t.id];if(void 0!==e){const{prefix:r="",suffix:n=""}=t;i.innerHTML=`${r}${e}${n}${o_}`}i.style.display=""}else i.style.display=a_}));const r=document.getElementById("finalSetTiebreakToggle");if(r&&(r.style.display=e===h_?"":a_),e===h_){const e=document.getElementById("setTiebreak"),t=document.getElementById("finalSetTiebreak");e&&t&&(t.checked=e.checked)}}v.style.display=t?"":a_,S.style.display=t?"":a_,S_()},m.appendChild(I);const y=document.createElement("label");y.setAttribute("for","finalSetOption"),y.innerHTML="Final set",y.style.display=g?"":"none",m.appendChild(y),s.appendChild(m);const v=document.createElement("div");v.style.display=u_.finalSetFormat?"flex":a_,v.style.flexWrap="wrap",v.style.gap="0.5em",v.style.marginBottom="1em",v.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[],finalSet:!0}].concat(b_.map((e=>{const t=e.getValue?e.getValue(u_,!0):void 0;return{...e,value:t}}))).filter((e=>!1!==e.finalSet)).map((e=>D_({...e,index:1}))).forEach((e=>v.appendChild(e))),s.appendChild(v);const S=document.createElement("div");S.id="finalSetConfig",S.style.display=u_.finalSetFormat?"":a_,S.className="field",S.style.fontSize="1em";const U=u_.finalSetFormat?.tiebreakSet?.tiebreakTo&&!u_.finalSetFormat?.setTo,b=document.createElement("input");b.className=o,b.name="finalSetTiebreak",b.id="finalSetTiebreak",b.type="checkbox",b.checked=u_.finalSetFormat?!!u_.finalSetFormat.tiebreakFormat:!!u_.setFormat.tiebreakFormat,b.style.display=U?a_:"",S.onchange=e=>{const t=e.target.checked;b_.filter((({tb:e})=>e)).forEach((e=>{const i=document.getElementById(`${e.id}-1`);if(i.style.display===a_&&t){const{prefix:t="",suffix:r="",pluralize:n,defaultValue:a}=e,o=u_.bestOf||u_.exactly,s=n&&o>1?"s":"";i.innerHTML=`${t}${a}${s}${r}${o_}`}i.style.display=t?"":a_})),S_()},S.appendChild(b);const w=document.createElement("label");w.setAttribute("for","finalSetTiebreak"),w.id="finalSetTiebreakToggle",w.innerHTML="Tiebreak",w.style.marginRight="1em",w.style.display=U?a_:"",S.appendChild(w),s.appendChild(S);const T={content:{padding:"1.5"},maxWidth:480,fontSize:"14px",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 8px 16px rgba(0, 102, 204, 0.2)"}},D=r?.fontSize||r?.style?.fontSize||T.fontSize,P={...T,...r,fontSize:D,style:{...T.style,...i?.style||{},...r?.style||{}}},N=Se.open({title:"Score format",content:s,buttons:a,config:P});return setTimeout((()=>{if(u_.finalSetFormat?.tiebreakSet?.tiebreakTo&&!u_.finalSetFormat?.setTo){const e=document.getElementById("what-1");e&&(e.innerHTML=`${m_}${o_}`),w_.changeWhat(new Event("click"),1,m_)}const e=document.querySelector(".modal.is-active");if(e){const t=new MutationObserver((i=>{i.forEach((i=>{i.removedNodes.forEach((i=>{i===e&&(E_(),t.disconnect())}))}))}));t.observe(document.body,{childList:!0})}}),0),N}function D_(e){const{id:t,initiallyHidden:i,index:r,value:n}=e,a=document.createElement("button");return a.className="mfcButton",a.id=r?`${t}-${r}`:t,a.innerHTML=function({index:e,finalSetLabel:t,label:i,prefix:r="",suffix:n="",value:a,pluralize:o}){const s=I_.setFormat.bestOf||I_.setFormat.exactly||1;return i||e&&t||`${r}${a}${!e&&o&&s>1?"s":""}${n}${o_}`}(e),a.onclick=t=>function(e){const{e:t,id:i,button:r,pluralize:n,options:a,onChange:o,onChangeCallback:s,index:c,prefix:d="",suffix:u=""}=e,l=I_.setFormat.bestOf||I_.setFormat.exactly||1,p=!c&&n&&l>1?"s":"",m=(s_(a)?a(c):a).map((e=>({text:`${e}${p}`,onClick:()=>{r.innerHTML=`${d}${e}${p}${u}${o_}`,o&&s_(w_[o])&&w_[o](t,c,e),s&&s_(w_[s])&&w_[s](t,c,e),I_[c?"finalSetFormat":"setFormat"][i]=e,S_()}})));!function(e,t){E_();const i=document.createElement("div");i.className="dropdown is-active",i.style.position="absolute",i.style.zIndex="10000";const r=document.createElement("div");r.className="dropdown-menu",r.style.backgroundColor="white",r.style.border="1px solid #ddd",r.style.borderRadius="4px",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)";const n=()=>{E_()};t.forEach((e=>{const t=document.createElement("div");t.style.padding="0.5em 1em",t.style.cursor="pointer",t.style.backgroundColor="white",t.style.color="#363636",t.style.fontSize="1rem",t.style.lineHeight="1.5",t.textContent=e.text,t.onclick=t=>{t.preventDefault(),t.stopPropagation(),n(),setTimeout((()=>{e.onClick()}),0)},t.onmouseenter=()=>{t.style.backgroundColor="#f5f5f5",t.style.color="#363636"},t.onmouseleave=()=>{t.style.backgroundColor="white",t.style.color="#363636"},r.appendChild(t)})),i.appendChild(r);const a=e.target.getBoundingClientRect();i.style.left=`${a.left}px`,i.style.top=`${a.bottom}px`,document.body.appendChild(i),P_=i,setTimeout((()=>{N_=e=>{i.contains(e.target)||n()},document.addEventListener("click",N_)}),100)}(t,m)}({e:t,button:a,...e}),a.style.display=n||e.label?"":a_,i&&(a.style.display=a_),a.style.transition="all .2s ease-in-out",a.style.backgroundColor="inherit",a.style.border="none",a.style.color="inherit",a.style.padding=".3em",a.style.textAlign="center",a.style.textDecoration="none",a.style.fontSize="1em",a.style.cursor="pointer",a}let P_=null,N_=null;function E_(){P_&&document.body.contains(P_)&&P_.remove(),N_&&(document.removeEventListener("click",N_),N_=null),P_=null}const M_=Object.freeze(Object.defineProperty({__proto__:null,getMatchUpFormatModal:T_},Symbol.toStringTag,{value:"Module"}));function R_(e){if(!e)return null;const t=e.trim().toUpperCase();if("OPEN"===t)return{type:"open"};const i=t.match(/^C(\d{1,2})-(\d{1,2})$/);if(i){const[,e,t]=i;return{type:"combined",ageMin:parseInt(e,10),ageMax:parseInt(t,10),isCombined:!0}}if(t.includes("-")){const e=t.split("-");if(2===e.length){const t=e[0],i=e[1];let r,n,a,o,s;const c=t.match(/^U?(\d{1,2})U?$/),d=t.match(/^O?(\d{1,2})O?$/),u=i.match(/^U?(\d{1,2})U?$/),l=i.match(/^O?(\d{1,2})O?$/);if(t.startsWith("U")||t.endsWith("U")?s="max-min":(t.startsWith("O")||t.endsWith("O"))&&(s="min-max"),t.startsWith("U")||t.endsWith("U")){if(c){const e=parseInt(c[1],10);n=t.startsWith("U")?e-1:e,a=t.startsWith("U")?"pre":"post"}}else if((t.startsWith("O")||t.endsWith("O"))&&d){const e=parseInt(d[1],10);r=t.startsWith("O")?e+1:e,o=t.startsWith("O")?"pre":"post"}if(i.startsWith("U")||i.endsWith("U")){if(u){const e=parseInt(u[1],10);n=i.startsWith("U")?e-1:e,a=i.startsWith("U")?"pre":"post"}}else if((i.startsWith("O")||i.endsWith("O"))&&l){const e=parseInt(l[1],10);r=i.startsWith("O")?e+1:e,o=i.startsWith("O")?"pre":"post"}if(void 0!==r||void 0!==n)return{type:"range",ageMin:r,ageMax:n,uPosition:a,oPosition:o,rangeOrder:s}}}const r=t.match(/^U(\d{1,2})$|^(\d{1,2})U$/);if(r){return{type:"under",ageValue:parseInt(r[1]||r[2],10),uPosition:r[1]?"pre":"post"}}const n=t.match(/^O(\d{1,2})$|^(\d{1,2})O$/);if(n){return{type:"over",ageValue:parseInt(n[1]||n[2],10),oPosition:n[1]?"pre":"post"}}return null}function C_(e){const{type:t,ageValue:i,ageMin:r,ageMax:n,uPosition:a="post",oPosition:o="post",isCombined:s,rangeOrder:c="min-max"}=e;if("open"===t)return"OPEN";if("combined"===t&&void 0!==r&&void 0!==n)return`C${r}-${n}`;if("under"===t&&void 0!==i)return"pre"===a?`U${i}`:`${i}U`;if("over"===t&&void 0!==i)return"pre"===o?`O${i}`:`${i}O`;if("range"===t&&(void 0!==r||void 0!==n)){const e=void 0!==n&&a?(()=>{const e="pre"===a?n+1:n;return"pre"===a?`U${e}`:`${e}U`})():null,t=void 0!==r&&o?(()=>{const e="pre"===o?r-1:r;return"pre"===o?`O${e}`:`${e}O`})():null;return"max-min"===c?[e,t].filter(Boolean).join("-"):[t,e].filter(Boolean).join("-")}return""}function A_(e){switch(e){case"under":return"Simple Under";case"over":return"Simple Over";case"range":return"Range";case"combined":return"Combined";default:return"Open"}}const k_="\u25be";const O_={labels:{title:"Age Category",consideredDateLabel:"Considered Date",typeLabel:"Category Type",ageLabel:"Age",standardCodesLabel:"Standard Categories"},options:{ages:[8,10,12,14,16,18,21,30,35,40,45,50,55,60,65,70,75,80,85,90],categoryTypes:["Simple Under","Simple Over","Range","Combined","Open"]},defaultConsideredDate:(new Date).toISOString().split("T")[0]};let x_,F_,L_=O_;const __={type:"open"};let B_={};function V_(){const e=C_(__);x_=e;const t=document.getElementById("ageCategoryCodeString");t&&(t.innerHTML=e||"Invalid"),function(){const e=C_(__);if(e&&"OPEN"!==e)try{const t=jM.getCategoryAgeDetails({category:{ageCategoryCode:e},consideredDate:F_});if(t.error)return void(B_={errors:["string"==typeof t.error?t.error:t.error.message||"Invalid category or date"]});B_={ageMin:t.ageMin,ageMax:t.ageMax,ageMinDate:t.ageMinDate,ageMaxDate:t.ageMaxDate,errors:t.errors}}catch(t){B_={errors:[`Failed to calculate age details: ${t instanceof Error?t.message:"Unknown error"}`]}}else B_={}}(),function(){const e=document.getElementById("calculatedDetailsPanel");if(!e)return;if("open"===__.type||!x_)return void(e.style.display="none");e.style.display="";const{ageMin:t,ageMax:i,ageMinDate:r,ageMaxDate:n,errors:a}=B_;let o='<div style="margin-top: 1em; padding: 0.75em; background: #f5f5f5; border-radius: 4px; color: #000;">';a&&a.length>0&&(o+='<div style="color: red; margin-bottom: 0.5em;"><strong style="color: #000;">Errors:</strong><ul style="margin: 0; padding-left: 1.5em; color: #000;">',a.forEach((e=>{o+=`<li style="color: red;">${e}</li>`})),o+="</ul></div>"),(void 0!==t||void 0!==i)&&(o+='<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Age Range:</strong> ',void 0!==t&&void 0!==i?o+=`${t} - ${i}`:void 0!==t?o+=`${t} and over`:void 0!==i&&(o+=`${i} and under`),o+="</div>"),r&&(o+=`<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Min Birth Date:</strong> ${r}</div>`),n&&(o+=`<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Max Birth Date:</strong> ${n}</div>`),o+="</div>",e.innerHTML=o}()}function j_(){const{type:e}=__,t=document.getElementById("ageValue"),i="under"===e||"over"===e;t&&(t.style.display=i?"":"none");const r=document.getElementById("positionToggle"),n="under"===e||"over"===e;r&&(r.style.display=n?"":"none");const a=document.getElementById("ageMin"),o="range"===e||"combined"===e;a&&(a.style.display=o?"":"none");const s=document.getElementById("ageMax"),c="range"===e||"combined"===e;s&&(s.style.display=c?"":"none");const d=document.getElementById("combinedLabel");d&&(d.style.display="combined"===e?"":"none")}function $_(e){const{id:t,label:i,onClick:r,initiallyHidden:n}=e,a=document.createElement("button");return a.className="accButton",a.id=t,a.innerHTML=i,r&&(a.onclick=r),n&&(a.style.display="none"),a.style.transition="all .2s ease-in-out",a.style.backgroundColor="inherit",a.style.border="none",a.style.color="#000",a.style.padding=".3em",a.style.textAlign="center",a.style.textDecoration="none",a.style.fontSize="1em",a.style.cursor="pointer",a}let G_=null,W_=null;function q_(){G_&&document.body.contains(G_)&&G_.remove(),W_&&(document.removeEventListener("click",W_),W_=null),G_=null}function H_(e,t){q_();const i=document.createElement("div");i.className="dropdown is-active",i.style.position="absolute",i.style.zIndex="10000";const r=document.createElement("div");r.className="dropdown-menu",r.style.backgroundColor="white",r.style.border="1px solid #ddd",r.style.borderRadius="4px",r.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)";const n=()=>{q_()};t.forEach((e=>{const t=document.createElement("div");t.style.padding="0.5em 1em",t.style.cursor="pointer",t.style.backgroundColor="white",t.style.color="#363636",t.style.fontSize="1rem",t.style.lineHeight="1.5",t.textContent=e.text,t.onclick=t=>{t.preventDefault(),t.stopPropagation(),n(),setTimeout((()=>{e.onClick()}),0)},t.onmouseenter=()=>{t.style.backgroundColor="#f5f5f5"},t.onmouseleave=()=>{t.style.backgroundColor="white"},r.appendChild(t)})),i.appendChild(r);const a=e.target.getBoundingClientRect();i.style.left=`${a.left}px`,i.style.top=`${a.bottom}px`,document.body.appendChild(i),G_=i,setTimeout((()=>{W_=e=>{i.contains(e.target)||n()},document.addEventListener("click",W_)}),100)}function z_({existingAgeCategoryCode:e,existingCategory:t={},editorConfig:i,consideredDate:r,callback:n,config:a,modalConfig:o}={}){const s=i||a;L_=s?{labels:{...O_.labels,...s.labels},options:{...O_.options,...s.options},preDefinedCodes:s.preDefinedCodes||[{code:"OPEN",text:"Open (No age limit)"},{code:"8U",text:"8 and Under"},{code:"10U",text:"10 and Under"},{code:"12U",text:"12 and Under"},{code:"14U",text:"14 and Under"},{code:"16U",text:"16 and Under"},{code:"18U",text:"18 and Under"},{code:"21U",text:"21 and Under"},{code:"30O",text:"30 and Over"},{code:"35O",text:"35 and Over"},{code:"40O",text:"40 and Over"},{code:"45O",text:"45 and Over"},{code:"50O",text:"50 and Over"},{code:"55O",text:"55 and Over"},{code:"60O",text:"60 and Over"},{code:"65O",text:"65 and Over"},{code:"70O",text:"70 and Over"},{code:"75O",text:"75 and Over"},{code:"80O",text:"80 and Over"}],defaultConsideredDate:s.defaultConsideredDate||O_.defaultConsideredDate}:{...O_,preDefinedCodes:[{code:"OPEN",text:"Open (No age limit)"},{code:"8U",text:"8 and Under"},{code:"10U",text:"10 and Under"},{code:"12U",text:"12 and Under"},{code:"14U",text:"14 and Under"},{code:"16U",text:"16 and Under"},{code:"18U",text:"18 and Under"},{code:"21U",text:"21 and Under"},{code:"30O",text:"30 and Over"},{code:"35O",text:"35 and Over"},{code:"40O",text:"40 and Over"},{code:"45O",text:"45 and Over"},{code:"50O",text:"50 and Over"},{code:"55O",text:"55 and Over"},{code:"60O",text:"60 and Over"},{code:"65O",text:"65 and Over"},{code:"70O",text:"70 and Over"},{code:"75O",text:"75 and Over"},{code:"80O",text:"80 and Over"}]},F_=r||L_.defaultConsideredDate||(new Date).toISOString().split("T")[0];const c=e||t.ageCategoryCode||"OPEN";x_=c;const d=R_(c);d?Object.assign(__,d):Object.assign(__,{type:"open"});const u=[{onClick:()=>{q_(),n?.({...t,ageCategoryCode:""})},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{label:"Select",intent:"is-info",close:!0,onClick:()=>{q_(),(()=>{const e=C_(__);(function(e){return"function"==typeof e})(n)&&n({...t,ageCategoryCode:e})})()}}],l=document.createElement("div");l.addEventListener("click",(e=>{const t=e.target;!t.closest(".dropdown")&&!t.classList.contains("accButton")&&q_()}));const p=document.createElement("div");p.id="ageCategoryCodeString",p.innerHTML=x_,p.style.fontSize="1.5em",p.style.color="blue",p.style.marginBottom="1em",p.style.fontWeight="bold",l.appendChild(p);const m=document.createElement("div");m.style.marginBottom="1em",WL(m,[{label:L_.labels?.standardCodesLabel||"Standard Categories",field:"standardCategory",id:"ageCategorySelector",options:[{label:"Custom",value:"Custom",selected:!L_.preDefinedCodes?.some((e=>e.code===x_))},...(L_.preDefinedCodes||[]).map((e=>({selected:e.code===x_,value:e.code,label:e.text})))],onChange:e=>{const t=e.target.value;if("Custom"===t)return;x_=t;const i=R_(t);i&&(Object.assign(__,i),j_(),w(),V_())}},{label:L_.labels?.consideredDateLabel||"Considered Date",field:"consideredDate",id:"consideredDateInput",value:F_,date:!0,onChange:e=>{F_=e.target.value,V_()}}]),l.appendChild(m);const f=$_({id:"categoryType",label:`${A_(__.type)}${k_}`,onClick:e=>{const t=(L_.options?.categoryTypes||["Simple Under","Simple Over","Range","Combined","Open"]).map((e=>({text:e,onClick:()=>{const t=function(e){switch(e){case"Simple Under":return"under";case"Simple Over":return"over";case"Range":return"range";case"Combined":return"combined";default:return"open"}}(e);__.type=t,__.ageValue=void 0,__.ageMin=void 0,__.ageMax=void 0,"under"===t||"over"===t?(__.ageValue=18,__.uPosition="post",__.oPosition="post"):("range"===t||"combined"===t)&&(__.ageMin=10,__.ageMax=18,__.uPosition="post",__.oPosition="post",__.rangeOrder="min-max"),__.isCombined="combined"===t,f.innerHTML=`${e}${k_}`,j_(),w(),V_()}})));H_(e,t)}}),h=document.createElement("div");h.style.display="flex",h.style.flexWrap="wrap",h.style.gap="0.5em",h.style.marginBottom="1em",h.appendChild(f);const g=$_({id:"ageValue",label:`${__.ageValue||18}${k_}`,onClick:e=>{H_(e,(L_.options?.ages||[8,10,12,14,16,18,21,30,35,40,45,50,55,60,65,70,75,80,85,90]).map((e=>({text:String(e),onClick:()=>{__.ageValue=e,g.innerHTML=`${e}${k_}`,V_()}}))))},initiallyHidden:"under"!==__.type&&"over"!==__.type});h.appendChild(g);const I=$_({id:"positionToggle",label:b(),onClick:()=>{"under"===__.type?__.uPosition="pre"===__.uPosition?"post":"pre":"over"===__.type&&(__.oPosition="pre"===__.oPosition?"post":"pre"),I.innerHTML=b(),V_()},initiallyHidden:"under"!==__.type&&"over"!==__.type});h.appendChild(I);const y=$_({id:"ageMin",label:`Min: ${__.ageMin||10}${k_}`,onClick:e=>{H_(e,(L_.options?.ages||[8,10,12,14,16,18,21,30,35,40,45,50,55,60,65,70,75,80,85,90]).map((e=>({text:String(e),onClick:()=>{__.ageMin=e,y.innerHTML=`Min: ${e}${k_}`,V_()}}))))},initiallyHidden:"range"!==__.type&&"combined"!==__.type});h.appendChild(y);const v=$_({id:"ageMax",label:`Max: ${__.ageMax||18}${k_}`,onClick:e=>{H_(e,(L_.options?.ages||[8,10,12,14,16,18,21,30,35,40,45,50,55,60,65,70,75,80,85,90]).map((e=>({text:String(e),onClick:()=>{__.ageMax=e,v.innerHTML=`Max: ${e}${k_}`,V_()}}))))},initiallyHidden:"range"!==__.type&&"combined"!==__.type});h.appendChild(v);const S=document.createElement("div");S.id="combinedLabel",S.innerHTML='<em style="color: #888;">Combined age range</em>',S.style.display="combined"===__.type?"":"none",S.style.padding="0.3em",h.appendChild(S),l.appendChild(h);const U=document.createElement("div");function b(){if("under"===__.type){const e=__.ageValue||18;return"pre"===__.uPosition?`U${e}`:`${e}U`}if("over"===__.type){const e=__.ageValue||10;return"pre"===__.oPosition?`O${e}`:`${e}O`}return""}function w(){const e=document.getElementById("categoryType");if(e&&(e.innerHTML=`${A_(__.type)}${k_}`),void 0!==__.ageValue){const e=document.getElementById("ageValue");e&&(e.innerHTML=`${__.ageValue}${k_}`)}const t=document.getElementById("positionToggle");if(t&&(t.innerHTML=b()),void 0!==__.ageMin){const e=document.getElementById("ageMin");e&&(e.innerHTML=`Min: ${__.ageMin}${k_}`)}if(void 0!==__.ageMax){const e=document.getElementById("ageMax");e&&(e.innerHTML=`Max: ${__.ageMax}${k_}`)}}U.id="calculatedDetailsPanel",l.appendChild(U);const T={content:{padding:"1.5"},maxWidth:480,fontSize:"14px",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 8px 16px rgba(0, 102, 204, 0.2)"}},D=o?.fontSize||o?.style?.fontSize||T.fontSize,P={...T,...o,fontSize:D,style:{...T.style,...a?.style||{},...o?.style||{}}},N=Se.open({title:L_.labels?.title||"Age Category",content:l,buttons:u,config:P});return setTimeout((()=>{j_(),w(),V_()}),0),setTimeout((()=>{const e=document.querySelector(".modal.is-active");if(e){const t=new MutationObserver((i=>{i.forEach((i=>{i.removedNodes.forEach((i=>{i===e&&(q_(),t.disconnect())}))}))}));t.observe(document.body,{childList:!0})}}),0),N}const Y_={labels:{title:"Category",categoryNameLabel:"Category Name",typeLabel:"Category Type",ageCategoryCodeLabel:"Age Category Code",ratingTypeLabel:"Rating Type",ratingMinLabel:"Minimum Rating",ratingMaxLabel:"Maximum Rating",ballTypeLabel:"Ball Type",notesLabel:"Notes"},options:{types:["AGE","RATING","BOTH"],ratingTypes:["WTN","UTR","TRN","NTRP","DUPR"],ballTypes:["HIGH_ALTITUDE","STAGE1GREEN","STAGE2ORANGE","STAGE3RED","T2STANDARD_PRESSURELESS","T2STANDARD_PRESSURISED","TYPE1FAST","TYPE3SLOW"]},defaultConsideredDate:(new Date).toISOString().split("T")[0]};function K_(e){const{existingCategory:t,editorConfig:i,callback:r}=e,n={labels:{...Y_.labels,...i?.labels},options:{...Y_.options,...i?.options},defaultConsideredDate:i?.defaultConsideredDate||Y_.defaultConsideredDate,modalConfig:i?.modalConfig||{}},a={categoryName:t?.categoryName||"",type:t?.type,ageCategoryCode:t?.ageCategoryCode,ratingType:t?.ratingType,ratingMin:t?.ratingMin,ratingMax:t?.ratingMax,ballType:t?.ballType,notes:t?.notes||"",ageMin:t?.ageMin,ageMax:t?.ageMax,ageMinDate:t?.ageMinDate,ageMaxDate:t?.ageMaxDate},o=n.defaultConsideredDate,s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",s.style.gap="1em",s.style.minWidth="400px";const c=()=>{const e=s.querySelector("#ageDetailsPanel");if(e){if(!a.ageCategoryCode||"OPEN"===a.ageCategoryCode)return void(e.style.display="none");try{const t=jM.getCategoryAgeDetails({category:{ageCategoryCode:a.ageCategoryCode},consideredDate:o});if(t.error)return e.style.display="block",void(e.innerHTML=`\n          <div style="padding: 0.75em; background-color: #ffe8e8; border-left: 4px solid #ff4444; border-radius: 4px; color: #000;">\n            <strong style="color: #000;">Error:</strong> ${"string"==typeof t.error?t.error:t.error.message||"Invalid category"}\n          </div>\n        `);a.ageMin=t.ageMin,a.ageMax=t.ageMax,a.ageMinDate=t.ageMinDate,a.ageMaxDate=t.ageMaxDate,e.style.display="block",e.innerHTML=`\n        <div style="padding: 0.75em; background-color: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 4px; color: #000;">\n          <strong style="color: #000;">Age Range:</strong> ${t.ageMin||"N/A"} - ${t.ageMax||"N/A"}<br>\n          <strong style="color: #000;">Min Birth Date:</strong> ${t.ageMinDate||"N/A"}<br>\n          <strong style="color: #000;">Max Birth Date:</strong> ${t.ageMaxDate||"N/A"}\n        </div>\n      `}catch(t){e.style.display="block",e.innerHTML=`\n        <div style="padding: 0.75em; background-color: #ffe8e8; border-left: 4px solid #ff4444; border-radius: 4px; color: #000;">\n          <strong style="color: #000;">Error:</strong> ${t?.message||"Failed to calculate age details"}\n        </div>\n      `}}},d=document.createElement("div");WL(d,[{label:n.labels?.categoryNameLabel||"Category Name",field:"categoryName",placeholder:"e.g., Boys U18, Open Singles, 3.5-4.0",value:a.categoryName,focus:!0,onChange:e=>{a.categoryName=e.target.value}},{label:n.labels?.typeLabel||"Category Type",field:"type",options:[{label:"Select type...",value:"",selected:!a.type},...(n.options?.types||[]).map((e=>({label:e,value:e,selected:e===a.type})))],onChange:e=>{const t=e.target.value;a.type=t,y()}},{label:n.labels?.ballTypeLabel||"Ball Type",field:"ballType",options:[{label:"None",value:"",selected:!a.ballType},...(n.options?.ballTypes||[]).map((e=>({label:e,value:e,selected:e===a.ballType})))],onChange:e=>{const t=e.target.value;a.ballType=t||void 0}},{label:n.labels?.notesLabel||"Notes",field:"notes",placeholder:"Additional information...",value:a.notes,onChange:e=>{a.notes=e.target.value}}]),s.appendChild(d);const u=document.createElement("div");u.id="ageCategorySection",u.style.display="AGE"===a.type||"BOTH"===a.type?"block":"none";const l=document.createElement("label");l.textContent=n.labels?.ageCategoryCodeLabel||"Age Category Code",l.style.display="block",l.style.marginBottom="0.5em",l.style.fontWeight="bold",l.style.fontSize="0.9em",l.style.color="#000",u.appendChild(l);const p=document.createElement("div");p.style.display="flex",p.style.alignItems="center",p.style.gap="0.5em";const m=document.createElement("div");m.id="ageCategoryValue",m.style.padding="0.5em",m.style.border="1px solid #b5b5b5",m.style.borderRadius="4px",m.style.backgroundColor="#f5f5f5",m.style.flex="1",m.style.minHeight="2.5em",m.style.display="flex",m.style.alignItems="center",m.style.color="#000",m.textContent=a.ageCategoryCode||"Not set",p.appendChild(m);const f=document.createElement("button");f.className="button is-info is-small",f.textContent=a.ageCategoryCode?"Edit":"Set",f.onclick=()=>{z_({existingAgeCategoryCode:a.ageCategoryCode,editorConfig:{defaultConsideredDate:o},callback:e=>{a.ageCategoryCode=e.ageCategoryCode,m.textContent=e.ageCategoryCode||"Not set",f.textContent=e.ageCategoryCode?"Edit":"Set",c()}})},p.appendChild(f),u.appendChild(p);const h=document.createElement("div");h.id="ageDetailsPanel",h.style.marginTop="0.5em",h.style.display="none",u.appendChild(h),s.appendChild(u);const g=document.createElement("div");g.id="ratingSection",g.style.display="RATING"===a.type||"BOTH"===a.type?"block":"none";const I=document.createElement("div");WL(I,[{label:n.labels?.ratingTypeLabel||"Rating Type",field:"ratingType",options:[{label:"Select rating type...",value:"",selected:!a.ratingType},...(n.options?.ratingTypes||[]).map((e=>({label:e,value:e,selected:e===a.ratingType})))],onChange:e=>{const t=e.target.value;a.ratingType=t||void 0}},{label:n.labels?.ratingMinLabel||"Minimum Rating",field:"ratingMin",type:"number",placeholder:"Min",value:a.ratingMin?.toString()||"",onChange:e=>{const t=e.target.value;a.ratingMin=t?Number.parseFloat(t):void 0},fieldPair:{label:n.labels?.ratingMaxLabel||"Maximum Rating",field:"ratingMax",type:"number",placeholder:"Max",value:a.ratingMax?.toString()||"",onChange:e=>{const t=e.target.value;a.ratingMax=t?Number.parseFloat(t):void 0}}}]),g.appendChild(I),s.appendChild(g);const y=()=>{const e="AGE"===a.type||"BOTH"===a.type,t="RATING"===a.type||"BOTH"===a.type;u.style.display=e?"block":"none",g.style.display=t?"block":"none",e&&c()};setTimeout((()=>{y(),c()}),0);const v=[{label:"Cancel",close:!0},{label:"OK",intent:"is-success",close:!0,onClick:()=>{(function(e){return"function"==typeof e})(r)&&r(a)}}],S={...n.modalConfig};return Se.open({title:n.labels?.title||"Category",content:s,buttons:v,config:S})}const X_=(e,t)=>i=>function(e){if(""===e||null==e)return!1;const t=Number(e);return!isNaN(t)&&Number.isInteger(t)&&t>=0}(i)&&Number(i)>=e&&Number(i)<=t,J_=["Blue","Red","Green","Orange","Purple","Yellow","Pink","Gold","Silver","Bronze"],Q_=["WTN","UTR","TRN","NTRP","DUPR"],Z_=[{value:"WATERFALL",label:"Waterfall",description:"Distributes evenly: 1\u21922\u21923\u21921\u21922\u21923 (like dealing cards)"},{value:"LEVEL_BASED",label:"Level Based",description:"Groups by skill tiers: [1-5], [6-10], [11-15]"},{value:"SHUTTLE",label:"Shuttle",description:"Alternating direction: 1\u21922\u21923\u21923\u21922\u21921\u21921\u21922\u21923 (like a loom shuttle)"}];const eB="flightsCount",tB="namingType",iB="customName",rB="suffixType",nB="scaleType",aB="scaleName",oB="splitMethod";const sB="none";function cB(){return[{onInput:({inputs:e})=>{(({inputs:e})=>{const t=document.getElementById("flightProfileOk");if(!t)return;const i=e[eB]?.value,r=X_(2,10)(i);t.disabled=!r,t.style.opacity=r?"1":"0.5",t.style.cursor=r?"pointer":"not-allowed"})({inputs:e})},control:eB},{onChange:({e:e,fields:t})=>{const i=e.target.value;if(t){const e="custom"===i;t[iB].style.display=e?"":sB,t[rB].style.display=e?"":sB}},control:tB},{onChange:({e:e,fields:t})=>{const i=e.target.value;if(t){const e="RATING"===i;t[aB].style.display=e?"":sB}},control:nB}]}function dB(e){return"function"==typeof e}function uB(e){const{existingFlightProfile:t,editorConfig:i={},callback:r}=e,n=!!t;let a;const o=[{label:"Cancel",close:!0},{label:"OK",id:"flightProfileOk",intent:"is-success",close:!0,onClick:()=>{if(n)dB(r)&&r({flights:t.flights});else{const e={flightsCount:Number.parseInt(a.flightsCount?.value||"0"),namingType:a.namingType?.value||"colors",customName:a.customName?.value||"Flight",suffixType:a.suffixType?.value||"numbers",scaleType:a.scaleType?.value||"RATING",scaleName:a.scaleName?.value,splitMethod:a.splitMethod?.value||"LEVEL_BASED"},t=function(e){const t=[];return!e.flightsCount||Number.isNaN(e.flightsCount)||e.flightsCount<=0?t.push("Number of flights must be a valid number greater than 0"):e.flightsCount<2?t.push("Must have at least 2 flights"):e.flightsCount>10&&t.push("Maximum 10 flights allowed"),"RATING"===e.scaleType&&!e.scaleName&&t.push("Rating system must be selected"),e.eventType||t.push("Event type must be specified"),t}(e);if(t.length>0)return alert(t.join("\n")),!1;const i=function(e){const{flightsCount:t,namingType:i,customName:r,suffixType:n}=e,a=[];for(let o=0;o<t;o++)if("colors"===i)a.push(J_[o]||`Flight ${o+1}`);else{const e="letters"===n?String.fromCodePoint(65+o):(o+1).toString();a.push(`${r||"Flight"} ${e}`)}return a}(e),n=function(e){const t={scaleType:e.scaleType};return e.eventType&&(t.eventType=e.eventType),"RATING"===e.scaleType&&e.scaleName&&(t.scaleName=e.scaleName),t}(e),o=function(e){return{WATERFALL:"splitWaterfall",LEVEL_BASED:"splitLevelBased",SHUTTLE:"splitShuttle"}[e]||"splitLevelBased"}(e.splitMethod);dB(r)&&r({flightsCount:e.flightsCount,drawNames:i,scaleAttributes:n,splitMethod:o})}}}],s={modalSize:"is-medium"};return n||(s.info='\n      <div style="color: #000;">\n        <div style="margin-bottom: 1em;">\n          <strong style="color: #000;">Waterfall:</strong><br>\n          <span style="color: #666;">Distributes evenly like dealing cards: 1\u21922\u21923\u21921\u21922\u21923</span>\n        </div>\n        <div style="margin-bottom: 1em;">\n          <strong style="color: #000;">Level Based:</strong><br>\n          <span style="color: #666;">Groups by skill tiers: [1-5], [6-10], [11-15]</span>\n        </div>\n        <div>\n          <strong style="color: #000;">Shuttle:</strong><br>\n          <span style="color: #666;">Alternating direction like a loom shuttle: 1\u21922\u21923\u21923\u21922\u21921\u21921\u21922\u21923</span>\n        </div>\n      </div>\n    '),Se.open({title:i.labels?.title||"Flight Profile",content:e=>{if(n){const t=document.createElement("div");t.className="notification is-info is-light",t.innerHTML='<strong style="color: #000;">Note:</strong> Flight split has already been performed. You can only rename the flights.',e.appendChild(t)}const r=function({existingProfile:e,editorConfig:t={}}={}){const i=!!e,r={flightsCount:2,namingType:"colors",customName:"Flight",suffixType:"numbers",scaleType:"RATING",scaleName:"WTN",splitMethod:"LEVEL_BASED"};if(i&&e){const{flights:t,scaleAttributes:i,splitMethod:n}=e;if(t&&t.length>0){r.flightsCount=t.length;const e=t[0].drawName;if(J_.includes(e))r.namingType="colors";else{const t=e.match(/^(.+?)\s+([A-Z]|\d+)$/);t&&(r.namingType="custom",r.customName=t[1],r.suffixType=/[A-Z]/.test(t[2])?"letters":"numbers")}}if(i&&(r.scaleType=i.scaleType||"RATING",r.scaleName=i.scaleName),n){const e={splitWaterfall:"WATERFALL",splitLevelBased:"LEVEL_BASED",splitShuttle:"SHUTTLE"};r.splitMethod=e[n]||"LEVEL_BASED"}}return[{error:"Must be in range 2-10",placeholder:"2",validator:X_(2,10),value:r.flightsCount,label:t.labels?.flightsCountLabel||"Number of Flights (2-10)",field:eB,selectOnFocus:!0,hide:i,type:"number",focus:!0},{options:[{label:"Color Names",value:"colors",selected:"colors"===r.namingType},{label:"Root Word",value:"custom",selected:"custom"===r.namingType}],label:t.labels?.namingTypeLabel||"Naming Strategy",value:r.namingType,field:tB,hide:i},{placeholder:"Flight",label:t.labels?.customNameLabel||"Root Wor",visible:"custom"===r.namingType,value:r.customName,selectOnFocus:!0,field:iB,hide:i,fieldPair:{options:[{label:"Letters (A, B, C)",value:"letters",selected:"letters"===r.suffixType},{label:"Numbers (1, 2, 3)",value:"numbers",selected:"numbers"===r.suffixType}],label:t.labels?.suffixTypeLabel||"Suffix Style",visible:"custom"===r.namingType,value:r.suffixType,field:rB}},{options:[{label:"Rating",value:"RATING",selected:"RATING"===r.scaleType},{label:"Ranking",value:"RANKING",selected:"RANKING"===r.scaleType}],label:t.labels?.scaleTypeLabel||"Flighting Strategy",field:nB,value:r.scaleType,hide:i},{options:Q_.map((e=>({label:e,value:e,selected:e===r.scaleName}))),label:t.labels?.scaleNameLabel||"Rating System",field:aB,value:r.scaleName,visible:"RATING"===r.scaleType,hide:i},{label:t.labels?.splitMethodLabel||"Split Method",field:oB,value:r.splitMethod,radio:!0,options:Z_.map((e=>({text:e.label,value:e.value,checked:e.value===r.splitMethod}))),hide:i}]}({existingProfile:t,editorConfig:i}),o=cB(),s=document.createElement("div");if(e.appendChild(s),a=WL(s,r,o),n&&t?.flights){const r=document.createElement("div");r.className="field",r.innerHTML=`\n        <label class="label">${i.labels?.flightNamesLabel||"Flight Names"}</label>\n      `,t.flights.forEach(((e,i)=>{const n=document.createElement("div");n.className="field",n.innerHTML=`\n          <div class="control">\n            <input \n              type="text" \n              class="input" \n              id="flightName_${i}"\n              value="${e.drawName}"\n              placeholder="Flight ${i+1}"\n            />\n          </div>\n        `,n.querySelector("input").addEventListener("input",(e=>{t.flights[i].drawName=e.target.value})),r.appendChild(n)})),e.appendChild(r)}},buttons:o,config:s})}const{RETIRED:lB,WALKOVER:pB,DEFAULTED:mB,SUSPENDED:fB,CANCELLED:hB,INCOMPLETE:gB,DEAD_RUBBER:IB,IN_PROGRESS:yB,AWAITING_RESULT:vB}=cf;function SB(e,t){return t===(e.bestOf||3)-1&&e.finalSetFormat?e.finalSetFormat:e.setFormat}function UB(e){return!!e?.tiebreakSet?.tiebreakTo&&!e?.setTo}function bB(e){const t=e?.tiebreakSet,i=e?.tiebreakFormat;return t?t.tiebreakTo||10:i&&i.tiebreakTo||7}function wB(e){return e>="0"&&e<="9"}function TB(e){for(const t of e)if(!wB(t))return!1;return!0}function DB(e){return"("===e||"["===e}function PB(e){return")"===e||"]"===e}function NB(e,t,i){const r=i?.tiebreakAt||i?.setTo||6;return e===r&&t===r}function EB(e,t){const i="1-0"===e?1:0,r="0-1"===e?1:0;return{side1TiebreakScore:i,side2TiebreakScore:r,setNumber:t,winningSide:i>r?1:2}}function MB(e,t,i){const r=e.indexOf("-");if(-1===r)return i.push({position:0,message:`Set ${t}: Invalid format "${e}". Expected "#-#" (e.g., "5-3")`,expected:"#-#",got:e}),null;const n=e.slice(0,r),a=e.slice(r+1);if(!(n&&a&&TB(n)&&TB(a)))return i.push({position:0,message:`Set ${t}: Invalid format "${e}". Expected "#-#" (e.g., "5-3")`,expected:"#-#",got:e}),null;return{side1Score:Number.parseInt(n,10),side2Score:Number.parseInt(a,10),setNumber:t}}function RB(e,t,i){const r=e.indexOf("-");if(-1===r)return i.push({position:0,message:`Final set: Invalid format "${e}". Expected TB format "1-0" or "0-1", or regular "#-#"`,expected:"1-0, 0-1, or #-#",got:e}),null;const n=e.slice(0,r),a=e.slice(r+1);if(!(n&&a&&TB(n)&&TB(a)))return i.push({position:0,message:`Final set: Invalid format "${e}". Expected TB format "1-0" or "0-1", or regular "#-#"`,expected:"1-0, 0-1, or #-#",got:e}),null;return{side1Score:Number.parseInt(n,10),side2Score:Number.parseInt(a,10),setNumber:t}}function CB(e,t,i,r,n){if(!e)return[];if(t){const e=i-r;return[`Enter ${e} more timed set${1===e?"":"s"} (or final TB if aggregate tied)`]}const a=n-r;return[`Need ${a} more set${1===a?"":"s"}`]}function AB(e,t){const i=t.exactly||t.bestOf||1,r=e.trim(),n="A"===t.setFormat?.based||"A"===t.finalSetFormat?.based,a=void 0!==t.finalSetFormat?.tiebreakSet?.tiebreakTo,o=n&&a;if(!r)return function(e,t){return{valid:!1,formattedScore:"",sets:[],confidence:1,errors:[],warnings:[],ambiguities:[],suggestions:e?[`Enter ${t-1} timed sets (final TB only if tied)`]:[`Enter ${t} sets in format: #-# #-# ...`],incomplete:!0,matchComplete:!1}}(o,i);const s=[],c=o?i-1:i,d=function(e,t,i,r){const n=[];for(let a=0;a<e.length;a++){const o=e[a],s=a+1,c=s===i,d="1-0"===o||"0-1"===o;if(t&&c&&d)n.push(EB(o,s));else if(t&&c&&!d){const e=RB(o,s,r);e&&n.push(e)}else{const e=MB(o,s,r);e&&n.push(e)}}return n}(r.split(/\s+/),o,i,s);o&&0===s.length&&function(e,t,i){const r=e.filter((e=>void 0!==e.side1Score)),n=e.some((e=>void 0!==e.side1TiebreakScore));if(r.length<t)return;const a=function(e,t){return e.slice(0,t).reduce(((e,t)=>(e.side1+=t.side1Score||0,e.side2+=t.side2Score||0,e)),{side1:0,side2:0})}(r,t),o=a.side1===a.side2,s=r.length>t;if(o&&!n)if(s){const e=r[t];i.push({position:0,message:`Aggregate tied (${a.side1}-${a.side2}). Final set score "${e.side1Score}-${e.side2Score}" invalid. TB1 only accepts "1-0" or "0-1"`})}else i.push({position:0,message:`Aggregate tied (${a.side1}-${a.side2}), final TB required`});else!o&&n?i.push({position:0,message:`Aggregate not tied (${a.side1}-${a.side2}), final TB not allowed`}):!o&&s&&i.push({position:0,message:`Aggregate not tied (${a.side1}-${a.side2}), extra sets not allowed`})}(d,c,s);const u=o?c:i,l=i;!function(e,t,i,r,n){if(e>i){const a=r?`${t}-${i}`:`${i}`;n.push({position:0,message:`Too many sets: got ${e}, expected ${a}`})}}(d.length,u,l,o,s);const p=d.length<u&&0===s.length,m=(d.length===i||o&&d.length===c)&&0===s.length,f=function(e){return e.map((e=>void 0!==e.side1TiebreakScore?`${e.side1TiebreakScore}-${e.side2TiebreakScore}`:`${e.side1Score}-${e.side2Score}`)).join(" ")}(d);return{valid:0===s.length&&(d.length===u||d.length===l),formattedScore:f,sets:d,confidence:0===s.length?1:0,errors:s,warnings:[],ambiguities:[],suggestions:CB(p,o,u,d.length,i),incomplete:p,matchComplete:m}}function kB(e,t){const i="string"==typeof t?QR.parse(t):t;if(!i)return{valid:!1,formattedScore:"",sets:[],confidence:0,errors:[{position:0,message:"Invalid matchUpFormat"}],warnings:[],ambiguities:[],suggestions:[],incomplete:!1,matchComplete:!1};const r=!(!i.setFormat?.timed&&!i.finalSetFormat?.timed),n=!!i.exactly||1===i.bestOf;if(r&&n)return AB(e,i);const a={input:e,position:0,setIndex:0,currentSide1Buffer:"",currentSide2Buffer:"",currentTiebreakSide1Buffer:"",currentTiebreakSide2Buffer:"",sets:[],parsedFormat:i,state:"START",inTiebreak:!1,expectingTiebreakOnly:!1,isValid:!0,errors:[],warnings:[],confidence:1,ambiguities:[],suggestions:[]};for(UB(SB(i,0))?(a.expectingTiebreakOnly=!0,a.inTiebreak=!0,a.state="PARSING_TIEBREAK_SIDE1"):a.state="PARSING_SIDE1";a.position<e.length&&a.isValid;)OB(a);!function(e){(e.currentSide1Buffer||e.currentSide2Buffer||e.currentTiebreakSide1Buffer||e.currentTiebreakSide2Buffer)&&_B(e)}(a);let o,s=a.sets;a.irregularEnding&&(o=a.irregularEnding,(a.irregularEnding===pB||a.irregularEnding===hB||a.irregularEnding===IB)&&(s=[]));const c=!a.irregularEnding&&function(e){const t=e.parsedFormat.bestOf||3,i=Math.ceil(t/2),r=e.sets.filter((e=>1===e.winningSide)).length,n=e.sets.filter((e=>2===e.winningSide)).length;return r>=i||n>=i}(a),d=function(e){const t=[];for(const i of e.sets)if(i.side1Score&&0!==i.side1Score||i.side2Score&&0!==i.side2Score||void 0===i.side1TiebreakScore&&void 0===i.side2TiebreakScore){let e=`${i.side1Score||0}-${i.side2Score||0}`;if(void 0!==i.side1TiebreakScore||void 0!==i.side2TiebreakScore){const t=i.side1TiebreakScore??0,r=i.side2TiebreakScore??0;e+=`(${1===i.winningSide?r:t})`}t.push(e)}else{const e=i.side1TiebreakScore??0,r=i.side2TiebreakScore??0;t.push(`[${e}-${r}]`)}return t.join(" ")}(a);return{valid:a.isValid&&0===a.errors.length,formattedScore:d,sets:s,confidence:a.confidence,errors:a.errors,warnings:a.warnings,ambiguities:a.ambiguities,suggestions:a.suggestions,incomplete:!c&&s.length>0,matchComplete:c,matchUpStatus:o}}function OB(e){const t=e.input[e.position];if(!wB(t)&&!DB(t)&&!PB(t)){const t=function(e,t){const i=e.substring(t).trim().toLowerCase();return/^in(\s+p(rog(ress)?)?)?$/i.exec(i)?{ending:yB,endPos:e.length}:/^inc(omp(lete?)?)?/i.exec(i)?{ending:gB,endPos:e.length}:/^(dr|dead(\s*r(ubber)?)?)/i.exec(i)?{ending:IB,endPos:e.length}:/^r(et(ired?)?)?/i.exec(i)?{ending:lB,endPos:e.length}:/^(w(\/o|o|alk(over?)?)?)/i.exec(i)?{ending:pB,endPos:e.length}:/^d(ef(aulted?)?)?/i.exec(i)?{ending:mB,endPos:e.length}:/^s(usp(ended?)?)?/i.exec(i)?{ending:fB,endPos:e.length}:/^c(anc(ell?ed?)?)?/i.exec(i)?{ending:hB,endPos:e.length}:/^a(wait(ing(\s*r(esult)?)?)?)?/i.exec(i)?{ending:vB,endPos:e.length}:{endPos:t}}(e.input,e.position);if(t.ending)return e.irregularEnding=t.ending,e.irregularEndingPosition=e.position,void(e.position=t.endPos)}!function(e){return!wB(e)&&!DB(e)&&!PB(e)}(t)?DB(t)?function(e){const t=SB(e.parsedFormat,e.setIndex);if(UB(t))return e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",void e.position++;if(e.currentSide1Buffer&&e.currentSide2Buffer){if(NB(Number.parseInt(e.currentSide1Buffer),Number.parseInt(e.currentSide2Buffer),t))return e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",void e.position++}e.warnings.push(`Tiebreak indicator at position ${e.position} may be ambiguous`),e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",e.position++}(e):PB(t)?function(e){if(e.inTiebreak)return function(e){_B(e)}(e),e.inTiebreak=!1,void e.position++;e.warnings.push(`Unexpected tiebreak closer at position ${e.position}`),e.position++}(e):wB(t)?function(e,t){const i=SB(e.parsedFormat,e.setIndex);e.inTiebreak?function(e,t,i){if("PARSING_TIEBREAK_SIDE1"===e.state)return void function(e,t){e.currentTiebreakSide1Buffer+=t,e.position++}(e,t);if("PARSING_TIEBREAK_SIDE2"===e.state)return void function(e,t,i){e.currentTiebreakSide2Buffer+=t;const r=Number.parseInt(e.currentTiebreakSide2Buffer),n=e.position+1;if(n<e.input.length&&wB(e.input[n])){const t=e.input[n],a=Number.parseInt(e.currentTiebreakSide2Buffer+t),o=Number.parseInt(e.currentTiebreakSide1Buffer);if(a>999){const t=r;(function(e,t,i){const r=bB(i),n=Math.max(e,t),a=Math.min(e,t);return i?.tiebreakSet?.NoAD||i?.tiebreakFormat?.NoAD?n>=r:!(n<r)&&n-a>=2})(o,t,i)||e.warnings.push(`Tiebreak may be incomplete: ${o}-${t}`),_B(e)}}e.position++}(e,t,i);e.position++}(e,t,i):function(e,t,i){const r=function(e){return UB(e)?0:(e?.setTo||6)+1}(i);if("PARSING_SIDE1"===e.state||"START"===e.state)return void function(e,t,i){e.state="PARSING_SIDE1",e.currentSide1Buffer+=t;const r=Number.parseInt(e.currentSide1Buffer),n=e.position+1;if(n<e.input.length&&wB(e.input[n])){const t=e.input[n];xB(e.currentSide1Buffer,t,i)&&(e.warnings.push(`Potential score issue: "${e.currentSide1Buffer}${t}" would exceed max game score ${i}`),e.state="PARSING_SIDE2")}else e.state="PARSING_SIDE2";r>i&&e.warnings.push(`Score ${r} exceeds max ${i} at position ${e.position}`),e.position++}(e,t,r);if("PARSING_SIDE2"===e.state)return void function(e,t,i,r){e.currentSide2Buffer+=t;const n=Number.parseInt(e.currentSide1Buffer),a=Number.parseInt(e.currentSide2Buffer);if(LB(n,a,i))return e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",void e.position++;const o=e.position+1;if(o<e.input.length&&wB(e.input[o])){const t=e.input[o];xB(e.currentSide2Buffer,t,r)&&(function(e,t,i){const r=i?.setTo||6,n=Math.max(e,t),a=Math.min(e,t);return!(n<r)&&n-a>=2}(n,a,i)||NB(n,a,i)||e.warnings.push(`Set ${e.setIndex+1} may be incomplete: ${n}-${a}`),_B(e))}e.position++}(e,t,i,r);e.position++}(e,t,i)}(e,t):(e.errors.push({position:e.position,message:`Unexpected character '${t}'`,got:t,context:BB(e)}),e.isValid=!1):function(e){if("PARSING_SIDE1"===e.state&&e.currentSide1Buffer)return e.state="PARSING_SIDE2",void e.position++;if("PARSING_SIDE2"===e.state&&e.currentSide2Buffer){return LB(Number.parseInt(e.currentSide1Buffer),Number.parseInt(e.currentSide2Buffer),SB(e.parsedFormat,e.setIndex))?(e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",void e.position++):(_B(e),void e.position++)}if("PARSING_TIEBREAK_SIDE1"===e.state&&e.currentTiebreakSide1Buffer)return e.currentSide1Buffer&&e.currentSide2Buffer?(_B(e),void e.position++):(e.state="PARSING_TIEBREAK_SIDE2",void e.position++);e.position++}(e)}function xB(e,t,i){return Number.parseInt(e+t)>i}function FB(e,t,i){const r=t.currentTiebreakSide1Buffer,n=t.currentTiebreakSide2Buffer;r&&n?(e.side1TiebreakScore=Number.parseInt(r),e.side2TiebreakScore=Number.parseInt(n)):(r||n)&&function(e,t,i,r){const n=Number.parseInt(t||i),a=bB(r),o=r?.tiebreakFormat?.NoAD?a:Math.max(a,n+2);e.side1Score>e.side2Score?(e.side1TiebreakScore=o,e.side2TiebreakScore=n):(e.side1TiebreakScore=n,e.side2TiebreakScore=o)}(e,r,n,i)}function LB(e,t,i){const r=i.tiebreakAt||i.setTo||6;return e===r&&t===r+1||t===r&&e===r+1}function _B(e){const t=SB(e.parsedFormat,e.setIndex);let i=null;i=UB(t)?function(e){if(!e.currentTiebreakSide1Buffer||!e.currentTiebreakSide2Buffer)return null;const t=Number.parseInt(e.currentTiebreakSide1Buffer),i=Number.parseInt(e.currentTiebreakSide2Buffer);return{side1Score:0,side2Score:0,side1TiebreakScore:t,side2TiebreakScore:i,setNumber:e.setIndex+1,winningSide:t>i?1:2}}(e):function(e,t){if(!e.currentSide1Buffer||!e.currentSide2Buffer)return null;const i=Number.parseInt(e.currentSide1Buffer),r=Number.parseInt(e.currentSide2Buffer);if(LB(i,r,t)&&!e.currentTiebreakSide1Buffer&&!e.currentTiebreakSide2Buffer)return null;const n={side1Score:i,side2Score:r,setNumber:e.setIndex+1};return(e.currentTiebreakSide1Buffer||e.currentTiebreakSide2Buffer)&&FB(n,e,t),i>r?n.winningSide=1:r>i&&(n.winningSide=2),n}(e,t),i&&e.sets.push(i),function(e){e.currentSide1Buffer="",e.currentSide2Buffer="",e.currentTiebreakSide1Buffer="",e.currentTiebreakSide2Buffer="",e.setIndex++,e.inTiebreak=!1,e.state="PARSING_SIDE1",UB(SB(e.parsedFormat,e.setIndex))&&(e.expectingTiebreakOnly=!0,e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1")}(e)}function BB(e){const t=Math.max(0,e.position-5),i=Math.min(e.input.length,e.position+5),r=e.input.substring(t,e.position),n=e.input.substring(e.position+1,i);return`...${r}[${e.input[e.position]}]${n}...`}const{COMPLETED:VB}=cf,{validateMatchUpScore:jB,validateSetScore:$B}=xi.scoreGovernor;function GB(e,t,i){const{WALKOVER:r,CANCELLED:n,DEAD_RUBBER:a}=cf,o=[r,n,a];if(!e?.trim())return i&&o.includes(i)?{isValid:!0,sets:[],matchUpStatus:i,scoreObject:void 0}:{isValid:!1,sets:[],error:"Score is required"};try{const{outcome:r,error:n}=CF.generateOutcomeFromScoreString({scoreString:e.trim(),matchUpFormat:t,preserveSideOrder:!0});if(n||!r?.score?.sets)return{isValid:!1,sets:[],error:n||"Invalid score format"};const a=r.score.sets,o=r.score,s=e.trim().split(/\s+/).filter((e=>e.length>0)),c=QR.parse(t),d=c?.exactly||c?.bestOf||3,u=function(e,t,i,r,n){const a=i?.finalSetFormat?.tiebreakSet?.tiebreakTo&&!i?.finalSetFormat?.setTo,o=i?.setFormat?.tiebreakSet?.tiebreakTo&&!i?.setFormat?.setTo,s=1===i?.finalSetFormat?.tiebreakSet?.tiebreakTo,c=1===i?.setFormat?.tiebreakSet?.tiebreakTo;for(let d=0;d<e.length;d++){const i=e[d],u=d+1,l=u===t,p=i.startsWith("[")&&i.endsWith("]"),m=o||l&&a;if(!m&&p)return{isValid:!1,sets:r,scoreObject:n,error:`Set ${u}: Format expects regular set (e.g., 6-4), but got tiebreak-only set ${i}`};if(m&&!p&&("1-0"!==i&&"0-1"!==i||!(l&&s||c)))return{isValid:!1,sets:r,scoreObject:n,error:`Set ${u}: Format expects tiebreak-only set (e.g., [10-8]), but got regular set ${i}`}}return null}(s,d,c,a,o);if(u)return u;let l=!1;const p=a.map(((e,i)=>{if(!$B(e,t,i+1===d,!1).isValid){l=!0;const{...t}=e;return t}return e})),m={...o,sets:p},f=jB(p,t,i);if(!f.isValid)return{isValid:!1,sets:p,scoreObject:m,error:f.error};const h=Math.ceil(d/2),g=l?void 0:r.winningSide;return function(e,t,i,r,n){if(e||void 0===t)return!1;if("A"===n?.setFormat?.based||"A"===n?.finalSetFormat?.based)return i.filter((e=>void 0!==e.side1Score&&void 0!==e.side2Score)).length>=r;{const e=Math.ceil(r/2),t={side1:0,side2:0};return i.forEach((e=>{1===e.winningSide?t.side1++:2===e.winningSide&&t.side2++})),t.side1>=e||t.side2>=e}}(l,g,p,d,c)?{isValid:!0,sets:p,scoreObject:m,winningSide:g,matchUpStatus:VB,matchUpFormat:t,score:e.trim()}:{isValid:!1,sets:p,scoreObject:m,error:`Incomplete match - need ${h} sets to win`}}catch(s){return{isValid:!1,sets:[],error:s instanceof Error?s.message:"Invalid score format"}}}const WB={scoringApproach:"dynamicSets",smartComplements:!0,composition:"Australian",idiom:"en",dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm"};let qB={...WB};function HB(){return{...qB}}function zB(e){qB={...qB,...e}}function YB(){qB={...WB}}const{RETIRED:KB,WALKOVER:XB,DEFAULTED:JB,SUSPENDED:QB,CANCELLED:ZB,INCOMPLETE:eV,DEAD_RUBBER:tV,IN_PROGRESS:iV,AWAITING_RESULT:rV}=cf;function nV(e){if(!e)return{bestOf:3,setsToWin:2,isTimed:!1,isExactlyFormat:!1};const t=QR.parse(e);if(!t)return{bestOf:3,setsToWin:2,isTimed:!1,isExactlyFormat:!1};const i=!(!t.setFormat?.timed&&!t.finalSetFormat?.timed),r=!!t.exactly||1===t.bestOf,n=t.exactly||t.bestOf||3,a=r?n:Math.ceil(n/2);return{bestOf:t.bestOf||n,exactly:t.exactly,setsToWin:a,isTimed:i,isExactlyFormat:r}}function aV(e,t){return 1!==t.bestOf&&e+1!==t.bestOf||!t.finalSetFormat?t.setFormat:t.finalSetFormat}function oV(e){return void 0!==e?.tiebreakSet?.tiebreakTo}function sV(e){return!0===e?.timed&&void 0!==e?.minutes}function cV(e,t,i,r){const n=aV(e,r);if(sV(n))return 1/0;const a=n?.setTo||6,o=n?.tiebreakAt||a,s=1===t?i.side2:i.side1,c=o===a?a+1:a;return 0===s?c:s<o-1?a:s===o-1?o===a?a+1:a:s===o?c:s>o&&s<a?a:s===a?o===a?a+2:o:s>a?s+2:c}function dV(e,t,i){const r=aV(e,i);if(sV(r))return void 0!==t.side1&&null!==t.side1&&void 0!==t.side2&&null!==t.side2;if(oV(r))return t.side1>0&&t.side2>0&&t.side1!==t.side2;const n=r?.setTo||6,a=r?.tiebreakAt||n,o=Math.max(t.side1,t.side2),s=Math.min(t.side1,t.side2),c=Math.abs(t.side1-t.side2);return o>=n&&c>=2||(a===n?o===a+1&&s===a:o===n&&s===a)&&void 0!==t.tiebreak}function uV(e,t,i){if(dV(e,t,i)){if(t.side1>t.side2)return 1;if(t.side2>t.side1)return 2}}function lV(e,t){const i=Math.ceil(t/2),r=e.filter((e=>1===e.winningSide)).length,n=e.filter((e=>2===e.winningSide)).length;return r>=i||n>=i}function pV(e,t){if(!lV(e,t))return;const i=Math.ceil(t/2),r=e.filter((e=>1===e.winningSide)).length,n=e.filter((e=>2===e.winningSide)).length;return r>=i?1:n>=i?2:void 0}function mV(e,t){const i=t?.setTo||6;if(e>=i)return null;return e<i-1?i:(t?.tiebreakAt||i)===i?i+1:i}function fV(e,t,i,r,n,a,o){if(!o)return{field1Value:e,field2Value:0,shouldApply:!1,reason:"Feature disabled in settings"};if(a.has(i))return{field1Value:e,field2Value:0,shouldApply:!1,reason:"Already used for this set"};if(lV(r,n.bestOf))return{field1Value:e,field2Value:0,shouldApply:!1,reason:"Match already complete"};const s=aV(i,n);if(oV(s))return{field1Value:e,field2Value:0,shouldApply:!1,reason:"Tiebreak-only set"};const c=mV(e,s);return null===c?{field1Value:e,field2Value:0,shouldApply:!1,reason:"No predictable complement for this digit"}:t?{field1Value:c,field2Value:e,shouldApply:!0}:{field1Value:e,field2Value:c,shouldApply:!0}}function hV(e,t,i){const r=aV(e,i);if(sV(r)||oV(r))return!1;const n=r?.setTo||6,a=r?.tiebreakAt||n,o=Math.max(t.side1,t.side2),s=Math.min(t.side1,t.side2);return a===n?o===a+1&&s===a:o===n&&s===a}function gV(e,t,i){if(e+1>=i.bestOf||lV(t,i.bestOf))return!1;const r=t[e];return!!r&&void 0!==r.winningSide}function IV(e,t,i,r,n){const a=Number.parseInt(t)||0,o=Number.parseInt(i)||0,s=r?Number.parseInt(r):void 0,c=aV(e,n);if(oV(c)){return{setNumber:e+1,side1Score:0,side2Score:0,side1TiebreakScore:a,side2TiebreakScore:o,winningSide:a>0&&o>0&&a!==o?a>o?1:2:void 0}}const d={setNumber:e+1,side1Score:a,side2Score:o,winningSide:uV(e,{side1:a,side2:o,tiebreak:s},n)};if(void 0!==s){const e=c?.tiebreakFormat?.tiebreakTo||7,t=c?.tiebreakFormat?.noAd;let i;i=s<e-1?e:t?s+1:s+2,a>o?(d.side1TiebreakScore=i,d.side2TiebreakScore=s):(d.side1TiebreakScore=s,d.side2TiebreakScore=i)}return d}const{COMPLETED:yV,RETIRED:vV,WALKOVER:SV,DEFAULTED:UV}=cf;function bV(e){const{matchUp:t,container:i,onScoreChange:r}=e;i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";let n=t.matchUpFormat||"SET3-S:6/TB7";const a=()=>{const e=nV(n),t=QR.parse(n);return{bestOf:e.bestOf,setFormat:t?.setFormat,finalSetFormat:t?.finalSetFormat}};let o=a();const s=()=>o.bestOf,c=document.createElement("div");if(c.style.marginBottom="0.5em",i.appendChild(c),t.matchUpFormat){const e=document.createElement("div");e.style.fontSize="0.9em",e.style.marginBottom="0.5em",e.style.display="flex",e.style.alignItems="center",e.style.gap="0.5em";const r=document.createElement("span");r.textContent="Format:",r.style.color="#666",e.appendChild(r);const s=document.createElement("button");s.textContent=t.matchUpFormat,s.className="button is-small is-white",s.style.fontSize="0.75em",s.style.padding="0.2em 0.5em",s.style.cursor="pointer",s.title="Click to edit format",s.addEventListener("click",(async()=>{try{const{getMatchUpFormatModal:e}=await Promise.resolve().then((()=>M_));e({existingMatchUpFormat:t.matchUpFormat,callback:e=>{e&&e!==t.matchUpFormat&&(t.matchUpFormat=e,n=e,s.textContent=e,o=a(),globalThis.resetDynamicSets&&globalThis.resetDynamicSets())},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(e){console.error("[DynamicSets] Error opening format selector:",e)}})),e.appendChild(s),i.appendChild(e)}let d,u=yV;const l=new Set;let p=t.score?{...t.score}:void 0,m=t.winningSide,f=t.matchUpStatus;const h=document.createElement("div");h.style.marginBottom="0.8em";const g=document.createElement("div");g.textContent="Irregular Ending:",g.style.fontSize="0.75em",g.style.fontWeight="500",g.style.marginBottom="0.3em",g.style.color="#444",h.appendChild(g);const I=document.createElement("div");I.style.display="flex",I.style.gap="0.5em",I.style.flexWrap="wrap",[{value:vV,label:"Retired"},{value:SV,label:"Walkover"},{value:UV,label:"Defaulted"}].forEach((e=>{const t=document.createElement("label");t.style.display="flex",t.style.alignItems="center",t.style.gap="0.3em",t.style.cursor="pointer";const i=document.createElement("input");i.type="radio",i.name="matchOutcome",i.value=e.value,i.checked=!1,i.addEventListener("change",(e=>{if(u=e.target.value,u===SV||u===vV||u===UV){T.querySelectorAll("input").forEach((e=>{e.value=""}));const e=T.querySelectorAll(".set-row");for(let t=e.length-1;t>0;t--)e[t].remove();D=[],p=void 0}v.style.display="block",setTimeout((()=>{"function"==typeof M&&M()}),0)}));const r=document.createElement("span");r.textContent=e.label,r.style.fontSize="0.75em",t.appendChild(i),t.appendChild(r),I.appendChild(t)}));const y=document.createElement("button");y.textContent="Clear",y.className="button",y.style.fontSize="0.7em",y.style.padding="0.2em 0.5em",y.addEventListener("click",(()=>{h.querySelectorAll('input[name="matchOutcome"]').forEach((e=>e.checked=!1)),u=yV,d=void 0,v.style.display="none",h.querySelectorAll('input[name="irregularWinner"]').forEach((e=>e.checked=!1)),setTimeout((()=>{"function"==typeof M&&M()}),0)})),I.appendChild(y),h.appendChild(I);const v=document.createElement("div");v.style.display="none",v.style.marginTop="0.3em",v.style.paddingLeft="1em",v.style.borderLeft="3px solid #ffeb3b";const S=document.createElement("div");S.textContent="Winner:",S.style.fontSize="0.75em",S.style.fontWeight="500",S.style.marginBottom="0.2em",S.style.color="#444",v.appendChild(S);const U=document.createElement("div");U.style.display="flex",U.style.gap="0.5em";const b=t.sides?.[0],w=t.sides?.[1];[1,2].forEach((e=>{const t=document.createElement("label");t.style.display="flex",t.style.alignItems="center",t.style.gap="0.3em",t.style.cursor="pointer";const i=document.createElement("input");i.type="radio",i.name="irregularWinner",i.value=e.toString(),i.addEventListener("change",(()=>{d=e,setTimeout((()=>{"function"==typeof M&&M()}),0)}));const r=document.createElement("span"),n=1===e?b:w;r.textContent=n?.participant?.participantName||`Side ${e}`,r.style.fontSize="0.75em",t.appendChild(i),t.appendChild(r),U.appendChild(t)})),v.appendChild(U),h.appendChild(v),i.appendChild(h);const T=document.createElement("div");T.style.display="flex",T.style.flexDirection="column",T.style.gap="0.5em",i.appendChild(T);let D=[];globalThis.resetDynamicSets=()=>{T.innerHTML="",D=[],l.clear(),u=yV,d=void 0,p=void 0,m=void 0,f=void 0,h.querySelectorAll('input[name="matchOutcome"]').forEach((e=>e.checked=!1)),h.querySelectorAll('input[name="irregularWinner"]').forEach((e=>e.checked=!1)),h.style.display="none",v.style.display="none";const e=N(0);T.appendChild(e),e.querySelectorAll("input").forEach((e=>{e.addEventListener("input",k),e.addEventListener("keydown",O)})),P({clearAll:!0}),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"});const t=T.querySelector("input");t&&t.focus()};const P=e=>{let i;c.innerHTML="",e?.clearAll?(i=void 0,p=void 0):e?.scoreObject?(i=e.scoreObject,p=e.scoreObject):D.length>0?(i={sets:D},p={sets:D}):i=p,e?.clearAll?(m=void 0,f=void 0):(void 0!==e?.winningSide&&(m=e.winningSide),e?.matchUpStatus&&(f=e.matchUpStatus,[SV,vV,UV].includes(f)&&0===D.length&&(i=void 0,p=void 0)));const r={...t,score:i,winningSide:m,matchUpStatus:f},n=HB().composition||"Australian",a=CL({matchUp:r,isLucky:!0,composition:GL[n]||GL.Australian});c.appendChild(a)},N=e=>{const t=document.createElement("div");t.className="set-row",t.style.display="flex",t.style.alignItems="center",t.style.gap="0.5em",t.style.marginBottom="0.25em";const i=document.createElement("div");i.textContent=`Set ${e+1}:`,i.style.width="3.5em",i.style.fontSize="0.9em",i.style.fontWeight="500",i.style.color="#444",t.appendChild(i);const r=document.createElement("input");r.type="text",r.className="input",r.style.width="3em",r.style.textAlign="center",r.placeholder="0",r.dataset.setIndex=e.toString(),r.dataset.side="1";const n=document.createElement("input");n.type="text",n.className="input",n.style.width="3em",n.style.textAlign="center",n.placeholder="0",n.dataset.setIndex=e.toString(),n.dataset.side="2";const a=document.createElement("span");a.textContent="-",a.style.fontWeight="bold",a.style.color="#666",t.appendChild(r),t.appendChild(a),t.appendChild(n);const o=document.createElement("span");o.className="tiebreak-container",o.style.display="none",o.style.marginLeft="0.5em";const s=document.createElement("span");s.textContent="(",s.style.color="#666";const c=document.createElement("input");c.type="text",c.className="input tiebreak-input",c.style.width="2.5em",c.style.textAlign="center",c.dataset.setIndex=e.toString(),c.dataset.type="tiebreak";const d=document.createElement("span");d.textContent=")",d.style.color="#666",o.appendChild(s),o.appendChild(c),o.appendChild(d),t.appendChild(o);const u=document.createElement("span");return u.className="set-indicator",u.style.fontSize="1.2em",u.style.minWidth="1.5em",t.appendChild(u),t},E=e=>{const t=T.querySelector(`input[data-set-index="${e}"][data-side="1"]`),i=T.querySelector(`input[data-set-index="${e}"][data-side="2"]`),r=T.querySelector(`input[data-set-index="${e}"][data-type="tiebreak"]`);if(!t||!i)return!1;const n=t.value.trim(),a=i.value.trim();if(""===n||""===a)return!1;return dV(e,{side1:Number.parseInt(n)||0,side2:Number.parseInt(a)||0,tiebreak:r?.value.trim()?Number.parseInt(r.value):void 0},o)},M=()=>{u===yV&&(v.style.display="none");const e=[];for(let t=0;t<s();t++){const i=T.querySelector(`input[data-set-index="${t}"][data-side="1"]`),r=T.querySelector(`input[data-set-index="${t}"][data-side="2"]`),n=T.querySelector(`input[data-set-index="${t}"][data-type="tiebreak"]`);if(!i||!r)break;const a=i.value.trim(),s=r.value.trim();if(""===a&&""===s)break;const c=n?.value.trim(),d=IV(t,a,s,c,o);e.push(d)}D=e;const i=T.querySelectorAll(".set-row");let n;if(lV(D,s())){const e=D.filter((e=>void 0!==e.winningSide)).length;n=Math.max(1,e)}else{const e=D.length-1;n=e>=0&&void 0!==D[e].winningSide&&D.length<s()?D.length+1:Math.max(1,D.length)}for(let t=i.length-1;t>=n;t--)i[t].remove();if(D.length>0||u!==yV){const e=D.some((e=>void 0===e.winningSide)),i=function(e,t,i){if(!e||0===e.length)return{isValid:!1,sets:[],error:"At least one set is required"};const r=e.map((e=>{const t=e.side1??"",i=e.side2??"";if(!(t&&0!==t||i&&0!==i||void 0===e.side1TiebreakScore||void 0===e.side2TiebreakScore))return`[${e.side1TiebreakScore}-${e.side2TiebreakScore}]`;if(""===t||""===i)return"";if(void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore){const r=e.side1TiebreakScore??0,n=e.side2TiebreakScore??0;return`${t}-${i}(${Number(t)>Number(i)?n:r})`}return`${t}-${i}`})).filter((e=>""!==e)).join(" ");return r?GB(r,t,i?void 0:VB):{isValid:!1,sets:[],error:"At least one complete set is required"}}((u!==yV||e?D:D.filter((e=>void 0!==e.winningSide))).map((e=>{if(0!==e.side1Score||0!==e.side2Score||void 0===e.side1TiebreakScore&&void 0===e.side2TiebreakScore){const t={side1:e.side1Score,side2:e.side2Score};return void 0!==e.side1TiebreakScore&&(t.side1TiebreakScore=e.side1TiebreakScore),void 0!==e.side2TiebreakScore&&(t.side2TiebreakScore=e.side2TiebreakScore),void 0!==e.winningSide&&(t.winningSide=e.winningSide),t}{const t={side1TiebreakScore:e.side1TiebreakScore,side2TiebreakScore:e.side2TiebreakScore};return void 0!==e.winningSide&&(t.winningSide=e.winningSide),t}})),t.matchUpFormat,u!==yV),n=i.isValid&&void 0!==i.winningSide;u!==yV?(h.style.display="block",v.style.display="block"):(v.style.display="none",h.style.display=n?"none":"block"),u!==yV&&(i.matchUpStatus=u,d?(i.winningSide=d,i.isValid=!0):i.isValid=!1),P(i),r(i)}else h.style.display="block",P(),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"})},R=()=>{const e=document.getElementById("clearScoreV2");if(e){const t=T.querySelectorAll(".set-row"),i=T.querySelector('input[data-set-index="0"][data-side="1"]'),r=T.querySelector('input[data-set-index="0"][data-side="2"]'),n=t.length>1||""!==i?.value.trim()||""!==r?.value.trim();e.disabled=!n}},C=e=>{const t=T.querySelector(`input[data-set-index="${e}"][data-side="1"]`),i=T.querySelector(`input[data-set-index="${e}"][data-side="2"]`),r=T.querySelector(`.set-row:nth-child(${e+1}) .tiebreak-container`),n=T.querySelector(`input[data-set-index="${e}"][data-type="tiebreak"]`);if(!t||!i||!r)return;hV(e,{side1:Number.parseInt(t.value)||0,side2:Number.parseInt(i.value)||0},o)?r.style.display="inline":(r.style.display="none",n&&(n.value=""))},A=(e,t)=>{const i="1"===t?"2":"1",r=T.querySelector(`input[data-set-index="${e}"][data-side="${i}"]`),n=T.querySelector(`input[data-set-index="${e}"][data-side="${t}"]`),a=Number.parseInt(n?.value)||0,s=Number.parseInt(r?.value)||0;return cV(e,"1"===t?1:2,{side1:"1"===t?a:s,side2:"2"===t?a:s},o)},k=e=>{const i=e.target,r="tiebreak"===i.dataset.type;u!==yV&&i.value&&(u=yV,d=void 0,h.querySelectorAll('input[name="matchOutcome"]').forEach((e=>e.checked=!1)),v.style.display="none");const n=i.value.replace(/\D/g,"");n!==i.value&&(i.value=n);const a=Number.parseInt(i.dataset.setIndex||"0"),c=i.dataset.side||"1",l=void 0!==(e=>aV(e,o))(a)?.tiebreakSet?.tiebreakTo;if(r)i.value.length>2&&(i.value=i.value.slice(0,2));else if(l)i.value.length>3&&(i.value=i.value.slice(0,3));else{const e=A(a,c);(Number.parseInt(i.value)||0)>e&&(i.value=e.toString())}if(!r&&(C(a),!l)){const e="1"===c?"2":"1",t=T.querySelector(`input[data-set-index="${a}"][data-side="${e}"]`);if(t?.value.trim()){const i=Number.parseInt(t.value)||0,r=A(a,e);i>r&&(t.value=r.toString())}}if(M(),R(),E(a)&&!lV(D,s())&&function(e,t){if(!e||0===e.length)return!0;const i=nV(t),{bestOf:r,isExactlyFormat:n,setsToWin:a}=i,o=i.exactly||r;if(n){if(e.length>=o)return!1;const r=QR.parse(t);if(("A"===r?.setFormat?.based||"A"===r?.finalSetFormat?.based)&&void 0!==r?.finalSetFormat?.tiebreakSet?.tiebreakTo&&i.isTimed){const t=o-1;if(e.length<t)return!0;if(e.length===t){const t=e.reduce(((e,t)=>(void 0!==t.side1Score&&null!==t.side1Score&&(e.side1+=t.side1Score),void 0!==t.side2Score&&null!==t.side2Score&&(e.side2+=t.side2Score),e)),{side1:0,side2:0});return t.side1===t.side2}return!1}return!0}const s={side1:0,side2:0};return e.forEach((e=>{const t=e.side1Score??0,i=e.side2Score??0;t>i?s.side1++:i>t&&s.side2++})),!(s.side1>=a||s.side2>=a||e.length>=r)&&e.every((e=>void 0!==e.side1Score&&void 0!==e.side2Score&&null!==e.side1Score&&null!==e.side2Score))}(D,t.matchUpFormat)){const e=D.length,t=T.querySelector(`input[data-set-index="${e}"]`);if(e<s()&&!t){const t=N(e);T.appendChild(t),t.querySelectorAll("input").forEach((e=>{e.addEventListener("input",k),e.addEventListener("keydown",O)})),R()}}},O=e=>{const t=e.target,i=Number.parseInt(t.dataset.setIndex||"0"),r=t.dataset.side||"1",n="tiebreak"===t.dataset.type,a=!0===[qB.scoringApproach,qB.smartComplements,qB.composition][1];if("1"===r&&!n){const r=e.code.match(/^Digit(\d)$/);if(r){const n=Number.parseInt(r[1]);if(""===t.value){const r=fV(n,e.shiftKey,i,D,o,l,a);if(r.shouldApply){e.preventDefault(),t.value=r.field1Value.toString();const n=T.querySelector(`input[data-set-index="${i}"][data-side="2"]`);return n&&(n.value=r.field2Value.toString()),l.add(i),t.dispatchEvent(new Event("input",{bubbles:!0})),void setTimeout((()=>{if(M(),lV(D,s()))return;const e=T.querySelector(`input[data-set-index="${i+1}"][data-side="1"]`);if(e)e.focus();else if(i+1<s()){const e=N(i+1);T.appendChild(e);const t=e.querySelectorAll("input");t.forEach((e=>{e.addEventListener("input",k),e.addEventListener("keydown",O)}));const r=t[0];r instanceof HTMLInputElement&&r.focus(),R()}}),10)}}}}if("Tab"===e.key)if(e.preventDefault(),e.shiftKey){if(n){const e=T.querySelector(`input[data-set-index="${i}"][data-side="2"]`);e&&e.focus()}else if("2"===r){const e=T.querySelector(`input[data-set-index="${i}"][data-side="1"]`);e&&e.focus()}else if(i>0){const e=T.querySelector(`input[data-set-index="${i-1}"][data-type="tiebreak"]`),t=T.querySelector(`input[data-set-index="${i-1}"][data-side="2"]`),r=e?.closest(".tiebreak-container");e&&r&&"none"!==r.style.display?e.focus():t&&t.focus()}}else if(n){const e=T.querySelector(`input[data-set-index="${i+1}"][data-side="1"]`);if(e)e.focus();else if(i+1<s()){if(!E(i)||(M(),lV(D,s())))return;const e=N(i+1);T.appendChild(e);const t=e.querySelectorAll("input");t.forEach((e=>{e.addEventListener("input",k),e.addEventListener("keydown",O)}));const r=t[0];r instanceof HTMLInputElement&&r.focus(),R()}}else if("1"===r){const e=T.querySelector(`input[data-set-index="${i}"][data-side="2"]`);e&&e.focus()}else if("2"===r){M();const e=T.querySelector(`input[data-set-index="${i}"][data-type="tiebreak"]`),t=e?.closest(".tiebreak-container");if(e&&t&&"none"!==t.style.display)e.focus();else{const e=T.querySelector(`input[data-set-index="${i+1}"][data-side="1"]`);if(e)e.focus();else if(i+1<s()){if(!E(i)||lV(D,s()))return;const e=N(i+1);T.appendChild(e);const t=e.querySelectorAll("input");t.forEach((e=>{e.addEventListener("input",k),e.addEventListener("keydown",O)})),t[0].focus(),R()}}}if("Enter"===e.key){const e=document.getElementById("submitScoreV2");e&&!e.disabled&&e.click()}if("Backspace"===e.key&&""===t.value)if(e.preventDefault(),n){const e=T.querySelector(`input[data-set-index="${i}"][data-side="2"]`);e&&e.focus()}else if("2"===r){const e=T.querySelector(`input[data-set-index="${i}"][data-side="1"]`);e&&e.focus()}else if(i>0){const e=T.querySelector(`input[data-set-index="${i-1}"][data-type="tiebreak"]`),t=T.querySelector(`input[data-set-index="${i-1}"][data-side="2"]`),r=e?.closest(".tiebreak-container");e&&r&&"none"!==r.style.display?e.focus():t&&t.focus()}},x=N(0);if(T.appendChild(x),x.querySelectorAll("input").forEach((e=>{e.addEventListener("input",k),e.addEventListener("keydown",O)})),p?.sets&&p.sets.length>0){const e=Math.ceil(s()/2);let t=0,i=0,r=!1;p.sets.forEach(((n,a)=>{if(r)return;if(a>0){const e=N(a);T.appendChild(e),e.querySelectorAll("input").forEach((e=>{e.addEventListener("input",k),e.addEventListener("keydown",O)}))}const o=T.querySelector(`input[data-set-index="${a}"][data-side="1"]`),s=T.querySelector(`input[data-set-index="${a}"][data-side="2"]`),c=T.querySelector(`input[data-set-index="${a}"][data-type="tiebreak"]`);o&&s&&(o.value=n.side1Score?.toString()||"",s.value=n.side2Score?.toString()||"",C(a),c&&(void 0!==n.side1TiebreakScore||void 0!==n.side2TiebreakScore)&&(1===n.winningSide&&void 0!==n.side2TiebreakScore?c.value=n.side2TiebreakScore.toString():2===n.winningSide&&void 0!==n.side1TiebreakScore||void 0!==n.side1TiebreakScore?c.value=n.side1TiebreakScore.toString():void 0!==n.side2TiebreakScore&&(c.value=n.side2TiebreakScore.toString()))),1===n.winningSide&&t++,2===n.winningSide&&i++,r=t>=e||i>=e}))}else P();t.matchUpStatus&&t.matchUpStatus!==yV&&[vV,SV,UV].includes(t.matchUpStatus)&&(u=t.matchUpStatus,h.querySelectorAll('input[name="matchOutcome"]').forEach((e=>{e.value===t.matchUpStatus&&(e.checked=!0)})),t.winningSide&&(d=t.winningSide,h.querySelectorAll('input[name="irregularWinner"]').forEach((e=>{Number.parseInt(e.value)===t.winningSide&&(e.checked=!0)})),v.style.display="block")),p?.sets&&p.sets.length>0?M():u!==yV?P():(h.style.display="none",v.style.display="none"),setTimeout((()=>{const e=T.querySelector("input");e&&e.focus()}),100)}function wV(e,t){const{matchUpFormat:i}=t;if(!e)return"";const r=QR.parse(i),n=r?.setFormat?.bestOf||3,a=e=>e===n&&r?.finalSetFormat?r.finalSetFormat:r?.setFormat;let o="",s=0,c=0;const d=e.split(/[\s/]+|--+/).filter((e=>e.length>0));for(const u of d){s=0;const e=u;for(;s<e.length&&c<n&&!(c>=n);){const t=a(c+1),i=t?.tiebreakSet?.tiebreakTo,r=t?.setTo,n=!!i&&!r,d=!0===t?.timed,u=d?999:i||r||6,l=t?.tiebreakAt||u;let p="",m="",f="";for(;s<e.length;){const t=e[s];if("-"===t){s++;break}if(n||d){p+=t,s++;continue}const i=p+t,r=d?999:u+1;if(Number.parseInt(i)>r||p.length>0&&p.length>=2)break;p+=t,s++;const a=Number.parseInt(p);if(1===p.length&&1!==a&&r<10){if(s<e.length&&"-"===e[s])continue;break}}for(;s<e.length;){const t=e[s];if("-"===t){if(d&&m.length>0){s++;break}break}if(n||d){m+=t,s++;continue}const i=m+t,r=d?999:u+1;if(Number.parseInt(i)>u+3||m.length>0&&m.length>=2)break;m+=t,s++;const a=Number.parseInt(m);if(1===m.length&&1!==a&&r<10)break}if(!m){o&&(o+=" "),o+=p;break}let h=Number.parseInt(p),g=Number.parseInt(m),I=!1;!n&&!d&&(h>u+1&&(h=u,p=u.toString(),I=!0),g>u+1&&(g=u,m=u.toString(),I=!0),h===u+1&&g<u-1?(h=u,p=u.toString(),I=!0):g===u+1&&h<u-1&&(g=u,m=u.toString(),I=!0));const y=Math.abs(h-g),v=Math.max(h,g),S=d||v>=u&&y>=2,U=s<e.length;if(!I&&(h===l&&g===l||(h===l+1&&g===l||g===l+1&&h===l)&&U)){for(;s<e.length;){const t=e[s];if("-"===t){s++;break}f+=t,s++}o&&(o+=" "),f?(o+=`${p}-${m}(${f})`,c++):o+=`${p}-${m}(`}else if(o&&(o+=" "),o+=n?`[${p}-${m}]`:`${p}-${m}`,S)c++;else if(s<e.length)break}}return o}const{COMPLETED:TV,RETIRED:DV,WALKOVER:PV,DEFAULTED:NV}=cf;function EV(e){const{matchUp:t,container:i,onScoreChange:r}=e;try{i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";const e=QR.parse(t.matchUpFormat||"SET3-S:6/TB7"),n=e?.setFormat?.setTo||6,a=e?.setFormat?.tiebreakAt||n;let o=t.score?{...t.score}:void 0,s=t.winningSide,c=t.matchUpStatus;const d={digits:"",setTo:n,tiebreakAt:a,isMatchComplete:!1};if(o){d.digits=function(e){if(!e?.sets||0===e.sets.length)return"";const t=[];return e.sets.forEach(((e,i)=>{if(i>0&&t.push(" "),t.push(e.side1Score?.toString()||"0"),t.push(e.side2Score?.toString()||"0"),void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore){const i=1===e.winningSide?e.side2TiebreakScore:e.side1TiebreakScore;void 0!==i&&(t.push("-"),t.push(i.toString()))}})),t.join("")}(o);const e=wV(d.digits,{matchUpFormat:t.matchUpFormat||"SET3-S:6/TB7"});if(e&&e.includes("-")){const i=GB(e,t.matchUpFormat);d.isMatchComplete=i.isValid&&void 0!==i.winningSide&&(i.matchUpStatus===TV||void 0===i.matchUpStatus)}}const u=document.createElement("div");if(u.style.marginBottom="0.5em",i.appendChild(u),"A"===e?.setFormat?.based||"A"===e?.finalSetFormat?.based){const e=document.createElement("div");e.style.fontSize="0.75em",e.style.color="#666",e.style.marginTop="0.25em",e.style.marginBottom="0.5em",e.style.padding="0.25em 0.5em",e.style.backgroundColor="#fff3cd",e.style.border="1px solid #ffc107",e.style.borderRadius="3px",e.textContent="\u26a0\ufe0f Aggregate Scoring: Winner determined by total points across all sets",i.appendChild(e)}if(t.matchUpFormat){const e=document.createElement("div");e.style.fontSize="0.9em",e.style.marginBottom="0.5em",e.style.display="flex",e.style.alignItems="center",e.style.gap="0.5em";const n=document.createElement("span");n.textContent="Format:",n.style.color="#666",e.appendChild(n);const a=document.createElement("button");a.textContent=t.matchUpFormat,a.className="button is-small is-white",a.style.fontSize="0.75em",a.style.padding="0.2em 0.5em",a.style.cursor="pointer",a.title="Click to edit format",a.addEventListener("click",(async()=>{try{const{getMatchUpFormatModal:e}=await Promise.resolve().then((()=>M_));e({existingMatchUpFormat:t.matchUpFormat,callback:e=>{e&&e!==t.matchUpFormat&&(t.matchUpFormat=e,a.textContent=e,d.digits="",i.innerHTML="",EV({matchUp:t,container:i,onScoreChange:r}))},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(e){console.error("Error opening format selector:",e)}})),e.appendChild(a),i.appendChild(e)}const l=document.createElement("div");l.style.fontSize="1.2em",l.style.color="#64B5F6",l.style.textAlign="center",l.style.padding="0.25em 0.5em",l.style.fontWeight="bold",l.style.minHeight="1.5em",l.style.maxWidth="300px",l.style.margin="0 auto",l.textContent="-",i.appendChild(l);let p,m=TV;const f=document.createElement("div");f.style.display="none",f.style.marginBottom="0.8em",f.style.padding="0.6em",f.style.backgroundColor="#fff3cd",f.style.border="2px solid #ffc107",f.style.borderRadius="4px";const h=document.createElement("div");h.textContent="Irregular Ending:",h.style.fontSize="0.8em",h.style.fontWeight="600",h.style.marginBottom="0.3em",h.style.color="#856404",f.appendChild(h);const g=document.createElement("div");g.style.display="none",g.style.marginTop="0.3em";const I=document.createElement("div");I.textContent="Winner:",I.style.fontSize="0.75em",I.style.fontWeight="500",I.style.marginBottom="0.2em",I.style.color="#856404",g.appendChild(I);const y=document.createElement("div");y.style.display="flex",y.style.gap="0.5em",y.style.flexWrap="wrap";const v=t.sides?.[0],S=t.sides?.[1];[1,2].forEach((e=>{const t=document.createElement("label");t.style.display="flex",t.style.alignItems="center",t.style.gap="0.3em",t.style.cursor="pointer";const i=document.createElement("input");i.type="radio",i.name="irregularWinner",i.value=e.toString(),i.addEventListener("change",(()=>{i.checked&&(p=e,T())}));const r=document.createElement("span"),n=1===e?v:S;r.textContent=n?.participant?.participantName||`Side ${e}`,r.style.fontSize="0.75em",r.style.color="#856404",t.appendChild(i),t.appendChild(r),y.appendChild(t)})),g.appendChild(y),f.appendChild(g),i.appendChild(f);const U=document.createElement("div");U.style.display="grid",U.style.gridTemplateColumns="repeat(4, 1fr)",U.style.gap="8px",U.style.width="100%",U.style.maxWidth="320px",U.style.margin="0 auto",i.appendChild(U);const b=e=>wV(e,{matchUpFormat:t.matchUpFormat||"SET3-S:6/TB7"}),w=e=>{u.innerHTML="";const i=e?.scoreObject?.sets?.length>0;e?.clearAll?(o=void 0,s=void 0,c=void 0):null!=e&&(i&&(o=e?.scoreObject),"winningSide"in e&&(s=e?.winningSide),"matchUpStatus"in e&&(c=e?.matchUpStatus));const r={...t,score:e?.clearAll?void 0:i?o:void 0,winningSide:s,matchUpStatus:c},n=HB().composition||"Australian",a=CL({matchUp:r,isLucky:!0,composition:GL[n]||GL.Australian});a&&u.appendChild(a)},T=(e=!1)=>{const i=b(d.digits);if(i?(l.style.display="block",l.textContent=i):(l.style.display="block",l.textContent="-"),m===DV||m===PV||m===NV?(f.style.display="block",g.style.display="block"):(f.style.display="none",g.style.display="none"),e)return void w({clearAll:!0});let n=GB(i,t.matchUpFormat);d.isMatchComplete=n.isValid&&void 0!==n.winningSide&&(n.matchUpStatus===TV||void 0===n.matchUpStatus),m!==TV&&(n.matchUpStatus=m,p?(n.winningSide=p,n.isValid=!0):n.isValid=!1,d.isMatchComplete=!1),w(n),r(n);const a=document.getElementById("clearScoreV2");a&&(a.disabled=0===d.digits.length&&m===TV),E(),M()},D=e=>{m!==TV&&"number"==typeof e&&(m=TV,p=void 0,f.querySelectorAll('input[name="matchOutcome"]').forEach((e=>e.checked=!1)),g.style.display="none"),"number"==typeof e&&""===d.digits&&e>n&&(e=n);const i=b(d.digits),r=i.includes("(")&&!i.includes(")"),a=d.digits.includes("-"),o=(d.digits.match(/-/g)||[]).length,s=i.includes("[")&&a&&1===o,c=(i?GB(i,t.matchUpFormat):null)?.sets?.length||0,u=QR.parse(t.matchUpFormat),l=u?.setFormat?.bestOf||3,h=e=>{const t=e===l&&u?.finalSetFormat?u.finalSetFormat:u?.setFormat,i=t?.tiebreakSet?.tiebreakTo,r=t?.setTo;return!!i&&!r},I=c<l&&h(c+1),y=c>0&&h(c),v=r||s||I||y,S="-"===e?d.digits+"-":d.digits+e.toString(),U=b(S);if(i){const r=GB(i,t.matchUpFormat),n=r.sets?.[r.sets.length-1],a=i.includes("("),o=U.includes("("),s=a&&o&&U!==i&&U.startsWith(i.substring(0,i.lastIndexOf(")"))),c=n&&(void 0===n.side1TiebreakScore&&void 0===n.side2TiebreakScore||null==n.side1TiebreakScore&&null==n.side2TiebreakScore||s)&&void 0!==n.side1Score&&void 0!==n.side2Score&&(n.side1Score===n.side2Score||1===Math.abs(n.side1Score-n.side2Score));if(r.isValid&&r.winningSide&&!v&&!c||!v&&"-"!==e&&U===i)return}"-"===e?d.digits.endsWith("-")||(d.digits+="-"):d.digits+=e.toString(),T()},P=()=>{d.digits.length>0&&(d.digits=d.digits.slice(0,-1),T())},N=()=>{d.digits="",d.isMatchComplete=!1,m=TV,p=void 0,o=void 0,s=void 0,c=void 0,f.querySelectorAll('input[name="irregularWinner"]').forEach((e=>e.checked=!1)),f.querySelectorAll('input[name="matchOutcome"]').forEach((e=>e.checked=!1)),f.style.display="none",g.style.display="none",l.style.display="block",l.textContent="-",w({clearAll:!0}),M(),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"})};globalThis.resetDialPad=N;const E=()=>{const e=U.querySelector('[data-button="retired"]'),t=U.querySelector('[data-button="defaulted"]'),i=b(d.digits),r=!(i.includes("-")&&i.length>2)||d.isMatchComplete;e&&(e.disabled=r),t&&(t.disabled=r)},M=()=>{const e=m!==TV&&void 0!==p||d.isMatchComplete;U.querySelectorAll("button").forEach((t=>{const i=t.textContent||"";(i.match(/^[0-9]$/)||"-"===i)&&(t.disabled=e)}))};[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"RET",value:"retired",isSpecial:!0,requiresScore:!0},{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"WO",value:"walkover",isSpecial:!0},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"DEF",value:"defaulted",isSpecial:!0,requiresScore:!0},{label:"\u232b",value:"delete",isSpecial:!0},{label:"0",value:0},{label:"-",value:"minus",isSpecial:!0},{label:"",value:"empty",isSpecial:!0,disabled:!0}].forEach((e=>{const t=document.createElement("button");t.className="button is-white",t.textContent=e.label,t.style.cssText="\n        height: 55px !important;\n        width: 100% !important;\n        padding: 0.5em !important;\n        color: #000 !important;\n        border: 1px solid #dbdbdb !important;\n      ",e.label.length>1&&!e.isSpecial?t.style.fontSize="1.3em":e.isSpecial&&["RET","WO","DEF"].includes(e.label)?(t.style.fontSize="0.95em",t.style.backgroundColor="#ffe0b2"):e.isSpecial?(t.style.fontSize="1.3em",t.style.backgroundColor="#f0f0f0"):t.style.fontSize="1.3em",("retired"===e.value||"defaulted"===e.value)&&(t.dataset.button=e.value),e.disabled&&(t.disabled=!0,t.style.visibility="hidden"),e.requiresScore&&(t.disabled=!0),t.onclick=()=>{"delete"===e.value?P():"minus"===e.value?D("-"):"retired"===e.value?(m=DV,p=void 0,f.querySelectorAll('input[name="irregularWinner"]').forEach((e=>e.checked=!1)),T()):"walkover"===e.value?(m=PV,p=void 0,d.digits="",f.querySelectorAll('input[name="irregularWinner"]').forEach((e=>e.checked=!1)),T(),M()):"defaulted"===e.value?(m=NV,p=void 0,f.querySelectorAll('input[name="irregularWinner"]').forEach((e=>e.checked=!1)),T()):"empty"===e.value||D(e.value)},U.appendChild(t)}));const R=e=>{if(e.key>="0"&&e.key<="9")e.preventDefault(),D(Number.parseInt(e.key));else if("Backspace"===e.key||"Delete"===e.key)e.preventDefault(),P();else if("-"===e.key||" "===e.key||"/"===e.key)e.preventDefault(),D("-");else if(")"===e.key){e.preventDefault();const t=b(d.digits);t.includes("(")&&!t.includes(")")&&(d.digits+="-",T())}};i.setAttribute("tabindex","-1"),i.style.outline="none",i.addEventListener("keydown",R),setTimeout((()=>i.focus()),100);const C=()=>{i.removeEventListener("keydown",R)};globalThis.cleanupDialPad=C,c===DV||c===PV||c===NV?(m=c,f.querySelectorAll('input[name="matchOutcome"]').forEach((e=>{e.value===c&&(e.checked=!0)})),s&&(p=s,f.querySelectorAll('input[name="irregularWinner"]').forEach((e=>{Number.parseInt(e.value)===s&&(e.checked=!0)})),g.style.display="block")):!o&&(!c||"TO_BE_PLAYED"===c)&&N(),d.digits?(T(),setTimeout((()=>{const e=document.getElementById("clearScoreV2");e&&(e.disabled=!1),M()}),0)):(w(null),M())}catch(n){console.error("Error rendering dial pad:",n),i.innerHTML=`<p style="color: red;">Error: ${n instanceof Error?n.message:"Unknown error"}</p>`}}function MV(e){const{matchUp:t,callback:i}=e,r=HB().scoringApproach||"dynamicSets",n=document.createElement("div");n.style.padding="1em";const a=!(!t.score?.sets?.length&&!t.matchUpStatus);let o=null,s=!1;const c=e=>{o=e,s&&(e.sets?.length>0||e.score)&&(s=!1);const t=document.getElementById("submitScoreV2");if(t){const i=e.isValid||s&&a;t.disabled=!i}const i=document.getElementById("clearScoreV2");if(i){const t=document.getElementById("scoreInputV2");if(t)i.disabled=!t.value.trim();else{const t=e.sets&&e.sets.length>0,r=e.matchUpStatus&&"COMPLETED"!==e.matchUpStatus&&"TO_BE_PLAYED"!==e.matchUpStatus,n=t||r;i.disabled=!n}}},d=()=>{window.cleanupDialPad&&(window.cleanupDialPad(),window.cleanupDialPad=void 0),window.resetDialPad&&(window.resetDialPad=void 0),window.resetDynamicSets&&(window.resetDynamicSets=void 0)};"freeScore"===r?function(e){const{matchUp:t,container:i,onScoreChange:r}=e;i.innerHTML="",i.style.display="flex",i.style.flexDirection="column",i.style.gap="1em";const n=t?.sides?.find((e=>1===e.sideNumber)),a=t?.sides?.find((e=>2===e.sideNumber));let o=t.score?{...t.score}:void 0,s=t.winningSide,c=t.matchUpStatus;const d=document.createElement("div");d.style.marginBottom="0.25em",i.appendChild(d);const u=document.createElement("div");u.style.display="none",u.style.marginTop="0.25em",u.style.padding="0.35em 0.5em",u.style.backgroundColor="#f5f5f5",u.style.borderRadius="4px",u.style.flexDirection="column",u.style.gap="0.35em";const l=document.createElement("label");l.style.display="flex",l.style.alignItems="center",l.style.gap="0.4em",l.style.cursor="pointer";const p=document.createElement("input");p.type="radio",p.name="winnerSelection",p.value="1";const m=document.createElement("span");m.textContent=n?.participant?.participantName||"Side 1",m.style.fontSize="0.75em",l.appendChild(p),l.appendChild(m);const f=document.createElement("label");f.style.display="flex",f.style.alignItems="center",f.style.gap="0.4em",f.style.cursor="pointer";const h=document.createElement("input");h.type="radio",h.name="winnerSelection",h.value="2";const g=document.createElement("span");g.textContent=a?.participant?.participantName||"Side 2",g.style.fontSize="0.75em",f.appendChild(h),f.appendChild(g),u.appendChild(l),u.appendChild(f),i.appendChild(u);const I=e=>{const{WALKOVER:i,CANCELLED:r,DEAD_RUBBER:n}=cf,a=[i,r,n],u=e?.matchUpStatus&&a.includes(e.matchUpStatus);let l;e?.clearAll||u?(l=void 0,o=void 0):e?.scoreObject?(l=e.scoreObject,o=e.scoreObject):l=o,e?.clearAll?(s=void 0,c=void 0):null!=e&&("winningSide"in e&&(s=e.winningSide),"matchUpStatus"in e&&(c=e.matchUpStatus));const p={...t,score:l,winningSide:s,matchUpStatus:c};d.innerHTML="";const m=HB().composition||"Australian",f=CL({matchUp:p,isLucky:!0,composition:GL[m]||GL.Australian});d.appendChild(f)};if(I(),t.matchUpFormat){const e=document.createElement("div");e.style.fontSize="0.9em",e.style.marginBottom="0.5em",e.style.display="flex",e.style.alignItems="center",e.style.gap="0.5em";const r=document.createElement("span");r.textContent="Format:",r.style.color="#666",e.appendChild(r);const n=document.createElement("button");n.textContent=t.matchUpFormat,n.className="button is-small is-white",n.style.fontSize="0.75em",n.style.padding="0.2em 0.5em",n.style.cursor="pointer",n.title="Click to edit format",n.addEventListener("click",(async()=>{try{const{getMatchUpFormatModal:e}=await Promise.resolve().then((()=>M_));e({existingMatchUpFormat:t.matchUpFormat,callback:e=>{if(e&&e!==t.matchUpFormat){t.matchUpFormat=e,n.textContent=e;const i=document.getElementById("scoreInputV2");i&&(i.value="",i.dispatchEvent(new Event("input",{bubbles:!0}))),b.textContent="Score cleared - format changed",b.style.color="#999"}},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(e){console.error("[FreeScore] Error opening format selector:",e)}})),e.appendChild(n),i.appendChild(e)}const y=document.createElement("div");y.style.display="flex",y.style.alignItems="center",y.style.gap="0.5em";const v=document.createElement("input");if(v.type="text",v.className="input",v.placeholder="",v.style.flex="1",v.id="scoreInputV2",o){const e=function(e,t){if(!e)return"";const i=(e.sets||[]).map((e=>{let t=`${e.side1Score||0}-${e.side2Score||0}`;return void 0===e.side1TiebreakScore&&void 0===e.side2TiebreakScore||(t+=`(${1===e.winningSide?e.side2TiebreakScore:e.side1TiebreakScore})`),t})).join(" ");if(t&&"COMPLETED"!==t&&"TO_BE_PLAYED"!==t){const e=function(e){return{RETIRED:"ret",WALKOVER:"wo",DEFAULTED:"def",SUSPENDED:"susp",CANCELLED:"canc",INCOMPLETE:"inc",DEAD_RUBBER:"dr",IN_PROGRESS:"in",AWAITING_RESULT:"await"}[e]||""}(t);if(e)return i?`${i} ${e}`:e}return i}(o,c);v.value=e}const S=document.createElement("span");S.style.fontSize="1.2em",S.style.minWidth="1.5em",y.appendChild(v),y.appendChild(S),i.appendChild(y);const U=document.createElement("div");U.style.fontSize="0.9em",U.style.color="#0066cc",U.style.fontFamily="monospace",U.style.minHeight="1.5em",U.style.padding="0.25em",i.appendChild(U);const b=document.createElement("div");b.style.fontSize="0.9em",b.style.minHeight="1.5em",i.appendChild(b);let w=s;const T=()=>{p.checked?(w=1,l.style.fontWeight="bold",l.style.color="#22c55e",f.style.fontWeight="",f.style.color=""):h.checked&&(w=2,f.style.fontWeight="bold",f.style.color="#22c55e",l.style.fontWeight="",l.style.color=""),D()};p.addEventListener("change",T),h.addEventListener("change",T);const D=()=>{const e=v.value.trim();if(!e)return S.textContent="",U.textContent="",b.textContent="",b.style.color="",u.style.display="none",p.checked=!1,h.checked=!1,l.style.fontWeight="",l.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,I({clearAll:!0}),void r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"});const i=kB(e,t.matchUpFormat);i.formattedScore?U.textContent=i.formattedScore:U.textContent="";const n=i.matchUpStatus&&[KB,XB,JB,QB,ZB,eV,tV,iV,rV].includes(i.matchUpStatus),a=i.formattedScore?GB(i.formattedScore,t.matchUpFormat,i.matchUpStatus):{isValid:!1,sets:[],error:"No score to validate"},o=a.sets&&a.sets.length>0,s=w||a.winningSide;if((o&&a.scoreObject||n)&&I({scoreObject:a.scoreObject,winningSide:s,matchUpStatus:a.matchUpStatus||i.matchUpStatus}),a.isValid||n){S.textContent="\u2713",S.style.color="green";let t,o="Valid score";a.matchUpStatus===KB?o="Valid score - RETIRED":a.matchUpStatus===XB?o="Valid score - WALKOVER":a.matchUpStatus===JB?o="Valid score - DEFAULTED":a.matchUpStatus===QB?o="Valid score - SUSPENDED":a.matchUpStatus===ZB?o="Valid score - CANCELLED":a.matchUpStatus===eV?o="Valid score - INCOMPLETE":a.matchUpStatus===tV?o="Valid score - DEAD RUBBER":a.matchUpStatus===iV?o="Valid score - IN PROGRESS":a.matchUpStatus===rV&&(o="Valid score - AWAITING RESULT"),b.textContent=o,b.style.color="green";const s=n&&[KB,XB,JB].includes(a.matchUpStatus||i.matchUpStatus),c=n&&[ZB,tV,rV,eV,iV,QB].includes(a.matchUpStatus||i.matchUpStatus);if(s){if(u.style.display="flex",t=w,!t)return void r({...a,isValid:!1,error:"Winner must be selected for irregular ending",matchUpStatus:a.matchUpStatus||i.matchUpStatus,score:i.formattedScore||e})}else c?(u.style.display="none",p.checked=!1,h.checked=!1,l.style.fontWeight="",l.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,t=void 0):(u.style.display="none",p.checked=!1,h.checked=!1,l.style.fontWeight="",l.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,t=a.winningSide);r({...a,isValid:!0,winningSide:t,matchUpStatus:a.matchUpStatus||i.matchUpStatus,score:i.formattedScore||e})}else!a.isValid&&o?(S.textContent="\u22ef",S.style.color="orange",b.textContent=a.error||"Score incomplete - continue typing",b.style.color="orange",u.style.display="none",p.checked=!1,h.checked=!1,l.style.fontWeight="",l.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,r(a)):(S.textContent="\u2717",S.style.color="red",b.textContent=a.error||"Invalid score",b.style.color="red",u.style.display="none",p.checked=!1,h.checked=!1,l.style.fontWeight="",l.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,I({scoreObject:void 0,winningSide:void 0,matchUpStatus:void 0}),r(a))};let P=!1;v.addEventListener("input",(()=>{D();const e=v.value,i=e.trim();if(!P&&i){const r=kB(i,t.matchUpFormat),n=r.formattedScore?GB(r.formattedScore,t.matchUpFormat,r.matchUpStatus):{isValid:!1,winningSide:void 0},a=n.isValid&&void 0!==n.winningSide,o=e.length>0&&/[\s-]$/.test(e),s=QR.parse(t.matchUpFormat),c=!!s?.exactly||1===s?.bestOf,d=s?.exactly||s?.bestOf||3,u=r.sets?.length>=d;a&&o&&(!c||u)&&(P=!0)}else if(P){const t=e.length>0&&/[\s-]$/.test(e);(0===i.length||!t)&&(P=!1)}})),v.addEventListener("keydown",(e=>{P&&!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(e.key)&&e.preventDefault()})),v.addEventListener("keyup",(e=>{if("Enter"===e.key){const e=document.getElementById("submitScoreV2");e&&!e.disabled&&e.click()}})),1===s?(p.checked=!0,l.style.fontWeight="bold",l.style.color="#22c55e"):2===s&&(h.checked=!0,f.style.fontWeight="bold",f.style.color="#22c55e"),setTimeout((()=>{v.focus(),v.value&&D()}),100),globalThis.resetFreeScore=()=>{v.value="",o=void 0,s=void 0,c=void 0,S.textContent="",U.textContent="",b.textContent="",b.style.color="",u.style.display="none",p.checked=!1,h.checked=!1,l.style.fontWeight="",l.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,P=!1,I({clearAll:!0}),r({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"}),v.focus()}}({matchUp:t,container:n,onScoreChange:c}):"dynamicSets"===r?bV({matchUp:t,container:n,onScoreChange:c}):"dialPad"===r?EV({matchUp:t,container:n,onScoreChange:c}):n.innerHTML="<p>Unknown scoring approach...</p>",Se.open({title:"Score Entry",content:n,config:"freeScore"===r?{info:'\n    <strong>Score Entry Tips:</strong><br><br>\n    <strong>Set Scores:</strong> Enter space or dash-separated (e.g., "6-4 6-3")<br><br>\n    <strong>Tiebreaks:</strong> Auto-detected from digits (e.g., "67 3" becomes "6-7(3)")<br><br>\n    <strong>Match Tiebreaks:</strong> Use dash separator (e.g., "10-7")<br><br>\n    <strong>Irregular Endings:</strong><br>\n    <strong>r</strong> = Retired<br>\n    <strong>w</strong> = Walkover<br>\n    <strong>d</strong> = Defaulted<br>\n    <strong>s</strong> = Suspended<br>\n    <strong>c</strong> = Cancelled<br>\n    <strong>a</strong> = Awaiting Result<br>\n    <strong>in</strong> = In Progress<br>\n    <strong>inc</strong> = Incomplete<br>\n    <strong>dr</strong> = Dead Rubber\n  '}:void 0,buttons:[{onClick:()=>{d()},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{id:"clearScoreV2",label:"Clear",intent:"none",disabled:!0,close:!1,onClick:()=>{if(s=!0,"freeScore"===r){const e=document.getElementById("scoreInputV2");e&&(e.value="",e.dispatchEvent(new Event("input",{bubbles:!0})),e.focus())}else"dynamicSets"===r&&window.resetDynamicSets?window.resetDynamicSets():"dialPad"===r&&window.resetDialPad&&window.resetDialPad()}},{id:"submitScoreV2",label:"Submit Score",intent:"is-primary",disabled:!0,onClick:()=>{o&&(o.isValid||s&&a)&&(d(),i(o))},close:!0}]}),setTimeout((()=>{const e=document.getElementById("clearScoreV2");e&&(e.style.backgroundColor="#ffeb3b",e.style.color="#333",a&&(e.disabled=!1),o&&c(o))}),0)}var RV=["input:not([inert]):not([inert] *)","select:not([inert]):not([inert] *)","textarea:not([inert]):not([inert] *)","a[href]:not([inert]):not([inert] *)","button:not([inert]):not([inert] *)","[tabindex]:not(slot):not([inert]):not([inert] *)","audio[controls]:not([inert]):not([inert] *)","video[controls]:not([inert]):not([inert] *)",'[contenteditable]:not([contenteditable="false"]):not([inert]):not([inert] *)',"details>summary:first-of-type:not([inert]):not([inert] *)","details:not([inert]):not([inert] *)"],CV=RV.join(","),AV=typeof Element>"u",kV=AV?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,OV=!AV&&Element.prototype.getRootNode?function(e){var t;return null==e||null===(t=e.getRootNode)||void 0===t?void 0:t.call(e)}:function(e){return e?.ownerDocument},xV=function(e,t){var i;void 0===t&&(t=!0);var r=null==e||null===(i=e.getAttribute)||void 0===i?void 0:i.call(e,"inert");return""===r||"true"===r||t&&e&&("function"==typeof e.closest?e.closest("[inert]"):xV(e.parentNode))},FV=function(e,t,i){if(xV(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(CV));return t&&kV.call(e,CV)&&r.unshift(e),r=r.filter(i)},LV=function(e,t,i){for(var r=[],n=Array.from(e);n.length;){var a=n.shift();if(!xV(a,!1))if("SLOT"===a.tagName){var o=a.assignedElements(),s=o.length?o:a.children,c=LV(s,!0,i);i.flatten?r.push.apply(r,c):r.push({scopeParent:a,candidates:c})}else{kV.call(a,CV)&&i.filter(a)&&(t||!e.includes(a))&&r.push(a);var d=a.shadowRoot||"function"==typeof i.getShadowRoot&&i.getShadowRoot(a),u=!xV(d,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(a));if(d&&u){var l=LV(!0===d?a.children:d.children,!0,i);i.flatten?r.push.apply(r,l):r.push({scopeParent:a,candidates:l})}else n.unshift.apply(n,a.children)}}return r},_V=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},BV=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||function(e){var t,i=null==e||null===(t=e.getAttribute)||void 0===t?void 0:t.call(e,"contenteditable");return""===i||"true"===i}(e))&&!_V(e)?0:e.tabIndex},VV=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},jV=function(e){return"INPUT"===e.tagName},$V=function(e){return function(e){return jV(e)&&"radio"===e.type}(e)&&!function(e){if(!e.name)return!0;var t,i=e.form||OV(e),r=function(e){return i.querySelectorAll('input[type="radio"][name="'+e+'"]')};if(typeof window<"u"&&typeof window.CSS<"u"&&"function"==typeof window.CSS.escape)t=r(window.CSS.escape(e.name));else try{t=r(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var n=function(e,t){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===t)return e[i]}(t,e.form);return!n||n===e}(e)},GV=function(e){var t=e.getBoundingClientRect(),i=t.width,r=t.height;return 0===i&&0===r},WV=function(e,t){var i=t.displayCheck,r=t.getShadowRoot;if("full-native"===i&&"checkVisibility"in e)return!e.checkVisibility({checkOpacity:!1,opacityProperty:!1,contentVisibilityAuto:!0,visibilityProperty:!0,checkVisibilityCSS:!0});if("hidden"===getComputedStyle(e).visibility)return!0;var n=kV.call(e,"details>summary:first-of-type")?e.parentElement:e;if(kV.call(n,"details:not([open]) *"))return!0;if(i&&"full"!==i&&"full-native"!==i&&"legacy-full"!==i){if("non-zero-area"===i)return GV(e)}else{if("function"==typeof r){for(var a=e;e;){var o=e.parentElement,s=OV(e);if(o&&!o.shadowRoot&&!0===r(o))return GV(e);e=e.assignedSlot?e.assignedSlot:o||s===e.ownerDocument?o:s.host}e=a}if(function(e){var t,i,r,n,a=e&&OV(e),o=null===(t=a)||void 0===t?void 0:t.host,s=!1;if(a&&a!==e)for(s=!!(null!==(i=o)&&void 0!==i&&null!==(r=i.ownerDocument)&&void 0!==r&&r.contains(o)||null!=e&&null!==(n=e.ownerDocument)&&void 0!==n&&n.contains(e));!s&&o;){var c,d,u;s=!(null===(d=o=null===(c=a=OV(o))||void 0===c?void 0:c.host)||void 0===d||null===(u=d.ownerDocument)||void 0===u||!u.contains(o))}return s}(e))return!e.getClientRects().length;if("legacy-full"!==i)return!0}return!1},qV=function(e,t){return!(t.disabled||function(e){return jV(e)&&"hidden"===e.type}(t)||WV(t,e)||function(e){return"DETAILS"===e.tagName&&Array.prototype.slice.apply(e.children).some((function(e){return"SUMMARY"===e.tagName}))}(t)||function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if("FIELDSET"===t.tagName&&t.disabled){for(var i=0;i<t.children.length;i++){var r=t.children.item(i);if("LEGEND"===r.tagName)return!!kV.call(t,"fieldset[disabled] *")||!r.contains(e)}return!0}t=t.parentElement}return!1}(t))},HV=function(e,t){return!($V(t)||BV(t)<0||!qV(e,t))},zV=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(t)||t>=0)},YV=function(e){var t=[],i=[];return e.forEach((function(e,r){var n=!!e.scopeParent,a=n?e.scopeParent:e,o=function(e,t){var i=BV(e);return i<0&&t&&!_V(e)?0:i}(a,n),s=n?YV(e.candidates):a;0===o?n?t.push.apply(t,s):t.push(a):i.push({documentOrder:r,tabIndex:o,item:e,isScope:n,content:s})})),i.sort(VV).reduce((function(e,t){return t.isScope?e.push.apply(e,t.content):e.push(t.content),e}),[]).concat(t)},KV=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return!1!==kV.call(e,CV)&&HV(t,e)},XV=RV.concat("iframe:not([inert]):not([inert] *)").join(","),JV=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return!1!==kV.call(e,XV)&&qV(t,e)};function QV(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function ZV(e,t,i,r,n,a,o){try{var s=e[a](o),c=s.value}catch(d){return void i(d)}s.done?t(c):Promise.resolve(c).then(r,n)}function ej(e){return function(){var t=this,i=arguments;return new Promise((function(r,n){var a=e.apply(t,i);function o(e){ZV(a,r,n,o,s,"next",e)}function s(e){ZV(a,r,n,o,s,"throw",e)}o(void 0)}))}}function tj(e,t){var i=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=cj(e))||t){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function ij(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function rj(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function nj(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?rj(Object(i),!0).forEach((function(t){ij(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rj(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function aj(){var e,t,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",n=i.toStringTag||"@@toStringTag";function a(i,r,n,a){var c=r&&r.prototype instanceof s?r:s,d=Object.create(c.prototype);return oj(d,"_invoke",function(i,r,n){var a,s,c,d=0,u=n||[],l=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,i){return a=t,s=0,c=e,p.n=i,o}};function m(i,r){for(s=i,c=r,t=0;!l&&d&&!n&&t<u.length;t++){var n,a=u[t],m=p.p,f=a[2];i>3?(n=f===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=m&&((n=i<2&&m<a[1])?(s=0,p.v=r,p.n=a[1]):m<f&&(n=i<3||a[0]>r||r>f)&&(a[4]=i,a[5]=r,p.n=f,s=0))}if(n||i>1)return o;throw l=!0,r}return function(n,u,f){if(d>1)throw TypeError("Generator is already running");for(l&&1===u&&m(u,f),s=u,c=f;(t=s<2?e:c)||!l;){a||(s?s<3?(s>1&&(p.n=-1),m(s,c)):p.n=c:p.v=c);try{if(d=2,a){if(s||(n="next"),t=a[n]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+n+"' method"),s=1);a=e}else if((t=(l=p.n<0)?c:i.call(r,p))!==o)break}catch(h){a=e,s=1,c=h}finally{d=1}}return{value:t,done:l}}}(i,n,a),!0),d}var o={};function s(){}function c(){}function d(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(oj(t={},r,(function(){return this})),t),l=d.prototype=s.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,oj(e,n,"GeneratorFunction")),e.prototype=Object.create(l),e}return c.prototype=d,oj(l,"constructor",d),oj(d,"constructor",c),c.displayName="GeneratorFunction",oj(d,n,"GeneratorFunction"),oj(l),oj(l,n,"Generator"),oj(l,r,(function(){return this})),oj(l,"toString",(function(){return"[object Generator]"})),(aj=function(){return{w:a,m:p}})()}function oj(e,t,i,r){var n=Object.defineProperty;try{n({},"",{})}catch{n=0}(oj=function(e,t,i,r){function a(t,i){oj(e,t,(function(e){return this._invoke(t,i,e)}))}t?n?n(e,t,{value:i,enumerable:!r,configurable:!r,writable:!r}):e[t]=i:(a("next",0),a("throw",1),a("return",2))})(e,t,i,r)}function sj(e){return function(e){if(Array.isArray(e))return QV(e)}(e)||function(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||cj(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cj(e,t){if(e){if("string"==typeof e)return QV(e,t);var i={}.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?QV(e,t):void 0}}var dj={getActiveTrap:function(e){return e?.length>0?e[e.length-1]:null},activateTrap:function(e,t){t!==dj.getActiveTrap(e)&&dj.pauseTrap(e);var i=e.indexOf(t);-1===i||e.splice(i,1),e.push(t)},deactivateTrap:function(e,t){var i=e.indexOf(t);-1!==i&&e.splice(i,1),dj.unpauseTrap(e)},pauseTrap:function(e){var t=dj.getActiveTrap(e);t?._setPausedState(!0)},unpauseTrap:function(e){var t=dj.getActiveTrap(e);t&&!t._isManuallyPaused()&&t._setPausedState(!1)}},uj=function(e){return"Tab"===e?.key||9===e?.keyCode},lj=function(e){return uj(e)&&!e.shiftKey},pj=function(e){return uj(e)&&e.shiftKey},mj=function(e){return setTimeout(e,0)},fj=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return"function"==typeof e?e.apply(void 0,i):e},hj=function(e){return e.target.shadowRoot&&"function"==typeof e.composedPath?e.composedPath()[0]:e.target},gj=[],Ij=function(e,t){var i,r=document,n=gj,a=nj({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isolateSubtrees:!1,isKeyForward:lj,isKeyBackward:pj},t),o={containers:[],containerGroups:[],tabbableGroups:[],adjacentElements:new Set,alreadySilent:new Set,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},s=function(e,t,i){return e&&void 0!==e[t]?e[t]:a[i||t]},c=function(e,t){var i="function"==typeof t?.composedPath?t.composedPath():void 0;return o.containerGroups.findIndex((function(t){var r=t.container,n=t.tabbableNodes;return r.contains(e)||i?.includes(r)||n.find((function(t){return t===e}))}))},d=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.hasFallback,n=void 0!==i&&i,o=t.params,s=void 0===o?[]:o,c=a[e];if("function"==typeof c&&(c=c.apply(void 0,sj(s))),!0===c&&(c=void 0),!c){if(void 0===c||!1===c)return c;throw new Error("`".concat(e,"` was specified but was not a node, or did not return a node"))}var d=c;if("string"==typeof c){try{d=r.querySelector(c)}catch(u){throw new Error("`".concat(e,'` appears to be an invalid selector; error="').concat(u.message,'"'))}if(!d&&!n)throw new Error("`".concat(e,"` as selector refers to no known node"))}return d},u=function(){var e=d("initialFocus",{hasFallback:!0});if(!1===e)return!1;if(void 0===e||e&&!JV(e,a.tabbableOptions))if(c(r.activeElement)>=0)e=r.activeElement;else{var t=o.tabbableGroups[0];e=t&&t.firstTabbableNode||d("fallbackFocus")}else null===e&&(e=d("fallbackFocus"));if(!e)throw new Error("Your focus-trap needs to have at least one focusable element");return e},l=function(){if(o.containerGroups=o.containers.map((function(e){var t=function(e,t){var i;return i=(t=t||{}).getShadowRoot?LV([e],t.includeContainer,{filter:HV.bind(null,t),flatten:!1,getShadowRoot:t.getShadowRoot,shadowRootFilter:zV}):FV(e,t.includeContainer,HV.bind(null,t)),YV(i)}(e,a.tabbableOptions),i=function(e,t){return(t=t||{}).getShadowRoot?LV([e],t.includeContainer,{filter:qV.bind(null,t),flatten:!0,getShadowRoot:t.getShadowRoot}):FV(e,t.includeContainer,qV.bind(null,t))}(e,a.tabbableOptions),r=t.length>0?t[0]:void 0,n=t.length>0?t[t.length-1]:void 0,o=i.find((function(e){return KV(e)})),s=i.slice().reverse().find((function(e){return KV(e)})),c=!!t.find((function(e){return BV(e)>0}));return{container:e,tabbableNodes:t,focusableNodes:i,posTabIndexesFound:c,firstTabbableNode:r,lastTabbableNode:n,firstDomTabbableNode:o,lastDomTabbableNode:s,nextTabbableNode:function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t.indexOf(e);return n<0?r?i.slice(i.indexOf(e)+1).find((function(e){return KV(e)})):i.slice(0,i.indexOf(e)).reverse().find((function(e){return KV(e)})):t[n+(r?1:-1)]}}})),o.tabbableGroups=o.containerGroups.filter((function(e){return e.tabbableNodes.length>0})),o.tabbableGroups.length<=0&&!d("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find((function(e){return e.posTabIndexesFound}))&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},p=function(e){var t=e.activeElement;if(t)return t.shadowRoot&&null!==t.shadowRoot.activeElement?p(t.shadowRoot):t},m=function(e){if(!1!==e&&e!==p(document)){if(!e||!e.focus)return void m(u());e.focus({preventScroll:!!a.preventScroll}),o.mostRecentlyFocusedNode=e,function(e){return e.tagName&&"input"===e.tagName.toLowerCase()&&"function"==typeof e.select}(e)&&e.select()}},f=function(e){var t=d("setReturnFocus",{params:[e]});return t||!1!==t&&e},h=function(e){var t=e.target,i=e.event,r=e.isBackward,n=void 0!==r&&r;t=t||hj(i),l();var s=null;if(o.tabbableGroups.length>0){var u=c(t,i),p=u>=0?o.containerGroups[u]:void 0;if(u<0)s=n?o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:o.tabbableGroups[0].firstTabbableNode;else if(n){var m=o.tabbableGroups.findIndex((function(e){var i=e.firstTabbableNode;return t===i}));if(m<0&&(p.container===t||JV(t,a.tabbableOptions)&&!KV(t,a.tabbableOptions)&&!p.nextTabbableNode(t,!1))&&(m=u),m>=0){var f=0===m?o.tabbableGroups.length-1:m-1,h=o.tabbableGroups[f];s=BV(t)>=0?h.lastTabbableNode:h.lastDomTabbableNode}else uj(i)||(s=p.nextTabbableNode(t,!1))}else{var g=o.tabbableGroups.findIndex((function(e){var i=e.lastTabbableNode;return t===i}));if(g<0&&(p.container===t||JV(t,a.tabbableOptions)&&!KV(t,a.tabbableOptions)&&!p.nextTabbableNode(t))&&(g=u),g>=0){var I=g===o.tabbableGroups.length-1?0:g+1,y=o.tabbableGroups[I];s=BV(t)>=0?y.firstTabbableNode:y.firstDomTabbableNode}else uj(i)||(s=p.nextTabbableNode(t))}}else s=d("fallbackFocus");return s},g=function(e){var t=hj(e);if(!(c(t,e)>=0)){if(fj(a.clickOutsideDeactivates,e))return void i.deactivate({returnFocus:a.returnFocusOnDeactivate});fj(a.allowOutsideClick,e)||e.preventDefault()}},I=function(e){var t=hj(e),i=c(t,e)>=0;if(i||t instanceof Document)i&&(o.mostRecentlyFocusedNode=t);else{e.stopImmediatePropagation();var r,n=!0;if(o.mostRecentlyFocusedNode)if(BV(o.mostRecentlyFocusedNode)>0){var s=c(o.mostRecentlyFocusedNode),d=o.containerGroups[s].tabbableNodes;if(d.length>0){var l=d.findIndex((function(e){return e===o.mostRecentlyFocusedNode}));l>=0&&(a.isKeyForward(o.recentNavEvent)?l+1<d.length&&(r=d[l+1],n=!1):l-1>=0&&(r=d[l-1],n=!1))}}else o.containerGroups.some((function(e){return e.tabbableNodes.some((function(e){return BV(e)>0}))}))||(n=!1);else n=!1;n&&(r=h({target:o.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(o.recentNavEvent)})),m(r||o.mostRecentlyFocusedNode||u())}o.recentNavEvent=void 0},y=function(e){(a.isKeyForward(e)||a.isKeyBackward(e))&&function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o.recentNavEvent=e;var i=h({event:e,isBackward:t});i&&(uj(e)&&e.preventDefault(),m(i))}(e,a.isKeyBackward(e))},v=function(e){(function(e){return"Escape"===e?.key||"Esc"===e?.key||27===e?.keyCode})(e)&&!1!==fj(a.escapeDeactivates,e)&&(e.preventDefault(),i.deactivate())},S=function(e){var t=hj(e);c(t,e)>=0||fj(a.clickOutsideDeactivates,e)||fj(a.allowOutsideClick,e)||(e.preventDefault(),e.stopImmediatePropagation())},U=function(){return o.active?(dj.activateTrap(n,i),a.delayInitialFocus?e=new Promise((function(e){o.delayInitialFocusTimer=mj((function(){m(u()),e()}))})):(e=Promise.resolve(),m(u())),r.addEventListener("focusin",I,!0),r.addEventListener("mousedown",g,{capture:!0,passive:!1}),r.addEventListener("touchstart",g,{capture:!0,passive:!1}),r.addEventListener("click",S,{capture:!0,passive:!1}),r.addEventListener("keydown",y,{capture:!0,passive:!1}),r.addEventListener("keydown",v),e):Promise.resolve();var e},b=function(){if(o.active)return r.removeEventListener("focusin",I,!0),r.removeEventListener("mousedown",g,!0),r.removeEventListener("touchstart",g,!0),r.removeEventListener("click",S,!0),r.removeEventListener("keydown",y,!0),r.removeEventListener("keydown",v),i},w=typeof window<"u"&&"MutationObserver"in window?new MutationObserver((function(e){e.some((function(e){return Array.from(e.removedNodes).some((function(e){return e===o.mostRecentlyFocusedNode}))}))&&m(u())})):void 0,T=function(){w&&(w.disconnect(),o.active&&!o.paused&&o.containers.map((function(e){w.observe(e,{subtree:!0,childList:!0})})))};return i={get active(){return o.active},get paused(){return o.paused},activate:function(e){if(o.active)return this;var t,a=s(e,"onActivate"),c=s(e,"onPostActivate"),d=s(e,"checkCanFocusTrap"),u=dj.getActiveTrap(n),m=!1;u&&!u.paused&&(null===(t=u._setSubtreeIsolation)||void 0===t||t.call(u,!1),m=!0);try{d||l(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=p(r),a?.();var f=function(){var e=ej(aj().m((function e(){return aj().w((function(e){for(;;)switch(e.n){case 0:return d&&l(),e.n=1,U();case 1:i._setSubtreeIsolation(!0),T(),c?.();case 2:return e.a(2)}}),e)})));return function(){return e.apply(this,arguments)}}();if(d)return d(o.containers.concat()).then(f,f),this;f()}catch(g){var h;if(u===dj.getActiveTrap(n)&&m)null===(h=u._setSubtreeIsolation)||void 0===h||h.call(u,!0);throw g}return this},deactivate:function(e){if(!o.active)return this;var t=nj({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},e);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,o.paused||i._setSubtreeIsolation(!1),o.alreadySilent.clear(),b(),o.active=!1,o.paused=!1,T(),dj.deactivateTrap(n,i);var r=s(t,"onDeactivate"),c=s(t,"onPostDeactivate"),d=s(t,"checkCanReturnFocus"),u=s(t,"returnFocus","returnFocusOnDeactivate");r?.();var l=function(){mj((function(){u&&m(f(o.nodeFocusedBeforeActivation)),c?.()}))};return u&&d?(d(f(o.nodeFocusedBeforeActivation)).then(l,l),this):(l(),this)},pause:function(e){return o.active?(o.manuallyPaused=!0,this._setPausedState(!0,e)):this},unpause:function(e){return o.active?(o.manuallyPaused=!1,n[n.length-1]!==this?this:this._setPausedState(!1,e)):this},updateContainerElements:function(e){var t=[].concat(e).filter(Boolean);return o.containers=t.map((function(e){return"string"==typeof e?r.querySelector(e):e})),a.isolateSubtrees&&function(e){o.active&&!o.paused&&i._setSubtreeIsolation(!1),o.adjacentElements.clear(),o.alreadySilent.clear();var t,r=new Set,n=new Set,a=tj(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;r.add(s);for(var c=typeof ShadowRoot<"u"&&s.getRootNode()instanceof ShadowRoot,d=s;d;){r.add(d);var u=d.parentElement,l=[];u?l=u.children:!u&&c&&(l=d.getRootNode().children,u=d.getRootNode().host,c=typeof ShadowRoot<"u"&&u.getRootNode()instanceof ShadowRoot);var p,m=tj(l);try{for(m.s();!(p=m.n()).done;){var f=p.value;n.add(f)}}catch(h){m.e(h)}finally{m.f()}d=u}}}catch(h){a.e(h)}finally{a.f()}r.forEach((function(e){n.delete(e)})),o.adjacentElements=n}(o.containers),o.active&&(l(),o.paused||i._setSubtreeIsolation(!0)),T(),this}},Object.defineProperties(i,{_isManuallyPaused:{value:function(){return o.manuallyPaused}},_setPausedState:{value:function(e,t){if(o.paused===e)return this;if(o.paused=e,e){var r=s(t,"onPause"),n=s(t,"onPostPause");r?.(),b(),i._setSubtreeIsolation(!1),T(),n?.()}else{var a=s(t,"onUnpause"),c=s(t,"onPostUnpause");a?.();var d=function(){var e=ej(aj().m((function e(){return aj().w((function(e){for(;;)switch(e.n){case 0:return l(),e.n=1,U();case 1:i._setSubtreeIsolation(!0),T(),c?.();case 2:return e.a(2)}}),e)})));return function(){return e.apply(this,arguments)}}();d()}return this}},_setSubtreeIsolation:{value:function(e){a.isolateSubtrees&&o.adjacentElements.forEach((function(t){var i;e?"aria-hidden"===a.isolateSubtrees?(("true"===t.ariaHidden||"true"===(null===(i=t.getAttribute("aria-hidden"))||void 0===i?void 0:i.toLowerCase()))&&o.alreadySilent.add(t),t.setAttribute("aria-hidden","true")):((t.inert||t.hasAttribute("inert"))&&o.alreadySilent.add(t),t.setAttribute("inert",!0)):o.alreadySilent.has(t)||("aria-hidden"===a.isolateSubtrees?t.removeAttribute("aria-hidden"):t.removeAttribute("inert"))}))}}}),i.updateContainerElements(e),i};const yj="courthive-drawer",vj=e=>"function"==typeof e,Sj=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)};let Uj=null,bj=!1;const wj=()=>{if(Uj)return Uj;const e={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},t={};let i,r,n=!1;const a=yj;let o,s=!1;const c=()=>{vj(r)&&r&&r()&&(r=void 0);const t=document.getElementById(a);t&&(t.classList.remove(e.visibleClass),document.documentElement.style.overflow="",setTimeout((function(){i?(t.classList.add(e.visibleClass),document.documentElement.style.overflow="hidden",vj(i?.callback)&&i.callback()):(t.classList.remove(e.activeClass),n=!1),i=!1,o?.deactivate()}),e.speedClose))},d=e=>{const t=document.getElementById(a)?.querySelector(".drawer__title");t&&(t.innerHTML=e)},u=e=>{const i=document.getElementById(a)?.querySelector(".drawer__footer");i&&(Sj(i),vj(e)?t.footer=e(i,c):i.innerHTML=e||"")},l=e=>{const i=document.getElementById(a)?.querySelector(".drawer__content");i&&(Sj(i),vj(e)?t.content=e(i,c):i.innerHTML=e)},p=(t,i,r)=>{n=!0,s=!0,t.classList.add(e.activeClass),document.documentElement.style.overflow="hidden",i&&(o=Ij(t),o.activate()),vj(r)&&r&&r(),setTimeout((function(){t.classList.add(e.visibleClass),setTimeout((()=>{s=!1}),100)}),e.speedOpen)};return bj||(document.addEventListener("click",(function(e){if(!n||s)return;const t=e.target,i=document.querySelector(".drawer__wrapper");if(!i)return;const r=t.classList.contains("drawer__close")||t.closest(".drawer__close")||t.hasAttribute("data-drawer-close")||t.closest("[data-drawer-close]");(!function(e,t){let i=t.parentNode;for(;i;){if(i===e)return!0;i=i.parentNode}return!1}(i,t)||r)&&c()}),!1),document.addEventListener("keydown",(e=>{"Escape"===e.key&&n&&c()}),!1),bj=!0),Uj={settings:e,open:(t={})=>{const{title:o,content:s,side:c,width:m,footer:f,callback:h,onClose:g}=t;if(s&&l(s),g&&(e=>{r=e})(g),o&&d(o),m&&(e=>{const t=document.getElementById(a)?.querySelector(".drawer__wrapper");t&&(t.style.width=e)})(m),u(f),n)i={callback:h};else if(c){if("right"===c)return(t=>{const i=document.getElementById(a);i&&(i.classList.remove(e.leftAlignment),p(i,!1,t))})(h);if("left"===c)return(t=>{const i=document.getElementById(a);i&&(i.classList.contains(e.leftAlignment)||i.classList.add(e.leftAlignment),p(i,!1,t))})(h)}else{const e=document.getElementById(a);e&&p(e,f,h)}},close:c,setTitle:d,setContent:l,setFooter:u,attributes:t},Uj};function Tj(){if(document.getElementById(yj))return;const e=`\n    <div id="${yj}" class="drawer" aria-hidden="true">\n      <div class="drawer__overlay" tabindex="-1" data-drawer-close></div>\n      <div class="drawer__wrapper" role="dialog" aria-modal="true">\n        <div class="drawer__header">\n          <div class="drawer__title"></div>\n          <button class="drawer__close" aria-label="Close drawer" data-drawer-close>\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <line x1="18" y1="6" x2="6" y2="18"></line>\n              <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n          </button>\n        </div>\n        <div class="drawer__content"></div>\n        <div class="drawer__footer"></div>\n      </div>\n    </div>\n  `;document.body.insertAdjacentHTML("beforeend",e)}function Dj(e,t,i){if(!e)return{};const r=document.createElement("aside");r.classList.add("menu");const n={};let a=0;const o=e=>e?.heading||e?.text||e?.label||`Item ${a+=1,a}`,s=e=>{const t=document.createElement("li");if(t.className="font-medium",e.style&&(t.style.cssText=e.style),e.onClick){const r=e.fontSize||"1em";if(e.divider){const e=document.createElement("hr");e.classList.add("dropdown-divider"),t.appendChild(e)}else{const n=document.createElement("a"),a=e.disabled?"0.4":"1";n.style.cssText=`text-decoration: none; opacity: ${a}; font-size: ${r}`,e.class&&n.classList.add(e.class),e.color&&(n.style.color=e.color),e.heading&&(n.style.fontWeight="bold"),e.disabled||(n.onclick=(e=>i&&!1!==e.close?t=>{t.stopPropagation(),i(),e.onClick()}:t=>{t.stopPropagation(),e.onClick()})(e)),n.innerHTML=o(e),t.appendChild(n)}}else t.innerHTML=o(e),e.disabled||(t.onclick=e.onClick);return t};let c;for(const d of t||[])if(!d.hide)if(d.items){if(d.text){const e=document.createElement("p");e.className="menu-label font-medium",e.innerHTML=d.text,r.appendChild(e)}const e=document.createElement("ul");e.className="menu-list";for(const t of d.items)t.hide||e.appendChild(s(t));r.appendChild(e)}else if("input"===d.type){const{field:e,inputElement:t}=Mi(d);d.focus&&(c=t),n[d.field]=t,r.appendChild(e)}else if("divider"===d.type){const e=document.createElement("hr");e.classList.add("dropdown-divider"),r.appendChild(e)}return e.appendChild(r),{focusElement:c}}var Pj="top",Nj="bottom",Ej="right",Mj="left",Rj="auto",Cj=[Pj,Nj,Ej,Mj],Aj="start",kj="end",Oj="clippingParents",xj="viewport",Fj="popper",Lj="reference",_j=Cj.reduce((function(e,t){return e.concat([t+"-"+Aj,t+"-"+kj])}),[]),Bj=[].concat(Cj,[Rj]).reduce((function(e,t){return e.concat([t,t+"-"+Aj,t+"-"+kj])}),[]),Vj=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function jj(e){return e?(e.nodeName||"").toLowerCase():null}function $j(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Gj(e){return e instanceof $j(e).Element||e instanceof Element}function Wj(e){return e instanceof $j(e).HTMLElement||e instanceof HTMLElement}function qj(e){return!(typeof ShadowRoot>"u")&&(e instanceof $j(e).ShadowRoot||e instanceof ShadowRoot)}const Hj={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},r=t.attributes[e]||{},n=t.elements[e];!Wj(n)||!jj(n)||(Object.assign(n.style,i),Object.keys(r).forEach((function(e){var t=r[e];!1===t?n.removeAttribute(e):n.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],n=t.attributes[e]||{},a=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]="",e}),{});!Wj(r)||!jj(r)||(Object.assign(r.style,a),Object.keys(n).forEach((function(e){r.removeAttribute(e)})))}))}},requires:["computeStyles"]};function zj(e){return e.split("-")[0]}var Yj=Math.max,Kj=Math.min,Xj=Math.round;function Jj(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function Qj(){return!/^((?!chrome|android).)*safari/i.test(Jj())}function Zj(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1);var r=e.getBoundingClientRect(),n=1,a=1;t&&Wj(e)&&(n=e.offsetWidth>0&&Xj(r.width)/e.offsetWidth||1,a=e.offsetHeight>0&&Xj(r.height)/e.offsetHeight||1);var o=(Gj(e)?$j(e):window).visualViewport,s=!Qj()&&i,c=(r.left+(s&&o?o.offsetLeft:0))/n,d=(r.top+(s&&o?o.offsetTop:0))/a,u=r.width/n,l=r.height/a;return{width:u,height:l,top:d,right:c+u,bottom:d+l,left:c,x:c,y:d}}function e$(e){var t=Zj(e),i=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:r}}function t$(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&qj(i)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function i$(e){return $j(e).getComputedStyle(e)}function r$(e){return["table","td","th"].indexOf(jj(e))>=0}function n$(e){return((Gj(e)?e.ownerDocument:e.document)||window.document).documentElement}function a$(e){return"html"===jj(e)?e:e.assignedSlot||e.parentNode||(qj(e)?e.host:null)||n$(e)}function o$(e){return Wj(e)&&"fixed"!==i$(e).position?e.offsetParent:null}function s$(e){for(var t=$j(e),i=o$(e);i&&r$(i)&&"static"===i$(i).position;)i=o$(i);return i&&("html"===jj(i)||"body"===jj(i)&&"static"===i$(i).position)?t:i||function(e){var t=/firefox/i.test(Jj());if(/Trident/i.test(Jj())&&Wj(e)&&"fixed"===i$(e).position)return null;var i=a$(e);for(qj(i)&&(i=i.host);Wj(i)&&["html","body"].indexOf(jj(i))<0;){var r=i$(i);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||t&&"filter"===r.willChange||t&&r.filter&&"none"!==r.filter)return i;i=i.parentNode}return null}(e)||t}function c$(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function d$(e,t,i){return Yj(e,Kj(t,i))}function u$(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function l$(e,t){return t.reduce((function(t,i){return t[i]=e,t}),{})}const p$={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,i=e.state,r=e.name,n=e.options,a=i.elements.arrow,o=i.modifiersData.popperOffsets,s=zj(i.placement),c=c$(s),d=[Mj,Ej].indexOf(s)>=0?"height":"width";if(a&&o){var u=function(e,t){return u$("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:l$(e,Cj))}(n.padding,i),l=e$(a),p="y"===c?Pj:Mj,m="y"===c?Nj:Ej,f=i.rects.reference[d]+i.rects.reference[c]-o[c]-i.rects.popper[d],h=o[c]-i.rects.reference[c],g=s$(a),I=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,y=f/2-h/2,v=u[p],S=I-l[d]-u[m],U=I/2-l[d]/2+y,b=d$(v,U,S),w=c;i.modifiersData[r]=((t={})[w]=b,t.centerOffset=b-U,t)}},effect:function(e){var t=e.state,i=e.options.element,r=void 0===i?"[data-popper-arrow]":i;null!=r&&("string"==typeof r&&!(r=t.elements.popper.querySelector(r))||t$(t.elements.popper,r)&&(t.elements.arrow=r))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function m$(e){return e.split("-")[1]}var f$={top:"auto",right:"auto",bottom:"auto",left:"auto"};function h$(e){var t,i=e.popper,r=e.popperRect,n=e.placement,a=e.variation,o=e.offsets,s=e.position,c=e.gpuAcceleration,d=e.adaptive,u=e.roundOffsets,l=e.isFixed,p=o.x,m=void 0===p?0:p,f=o.y,h=void 0===f?0:f,g="function"==typeof u?u({x:m,y:h}):{x:m,y:h};m=g.x,h=g.y;var I=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),v=Mj,S=Pj,U=window;if(d){var b=s$(i),w="clientHeight",T="clientWidth";if(b===$j(i)&&("static"!==i$(b=n$(i)).position&&"absolute"===s&&(w="scrollHeight",T="scrollWidth")),n===Pj||(n===Mj||n===Ej)&&a===kj)S=Nj,h-=(l&&b===U&&U.visualViewport?U.visualViewport.height:b[w])-r.height,h*=c?1:-1;if(n===Mj||(n===Pj||n===Nj)&&a===kj)v=Ej,m-=(l&&b===U&&U.visualViewport?U.visualViewport.width:b[T])-r.width,m*=c?1:-1}var D,P=Object.assign({position:s},d&&f$),N=!0===u?function(e,t){var i=e.x,r=e.y,n=t.devicePixelRatio||1;return{x:Xj(i*n)/n||0,y:Xj(r*n)/n||0}}({x:m,y:h},$j(i)):{x:m,y:h};return m=N.x,h=N.y,c?Object.assign({},P,((D={})[S]=y?"0":"",D[v]=I?"0":"",D.transform=(U.devicePixelRatio||1)<=1?"translate("+m+"px, "+h+"px)":"translate3d("+m+"px, "+h+"px, 0)",D)):Object.assign({},P,((t={})[S]=y?h+"px":"",t[v]=I?m+"px":"",t.transform="",t))}const g$={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,i=e.options,r=i.gpuAcceleration,n=void 0===r||r,a=i.adaptive,o=void 0===a||a,s=i.roundOffsets,c=void 0===s||s,d={placement:zj(t.placement),variation:m$(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,h$(Object.assign({},d,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,h$(Object.assign({},d,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var I$={passive:!0};const y$={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,i=e.instance,r=e.options,n=r.scroll,a=void 0===n||n,o=r.resize,s=void 0===o||o,c=$j(t.elements.popper),d=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&d.forEach((function(e){e.addEventListener("scroll",i.update,I$)})),s&&c.addEventListener("resize",i.update,I$),function(){a&&d.forEach((function(e){e.removeEventListener("scroll",i.update,I$)})),s&&c.removeEventListener("resize",i.update,I$)}},data:{}};var v$={left:"right",right:"left",bottom:"top",top:"bottom"};function S$(e){return e.replace(/left|right|bottom|top/g,(function(e){return v$[e]}))}var U$={start:"end",end:"start"};function b$(e){return e.replace(/start|end/g,(function(e){return U$[e]}))}function w$(e){var t=$j(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function T$(e){return Zj(n$(e)).left+w$(e).scrollLeft}function D$(e){var t=i$(e),i=t.overflow,r=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function P$(e){return["html","body","#document"].indexOf(jj(e))>=0?e.ownerDocument.body:Wj(e)&&D$(e)?e:P$(a$(e))}function N$(e,t){var i;void 0===t&&(t=[]);var r=P$(e),n=r===(null==(i=e.ownerDocument)?void 0:i.body),a=$j(r),o=n?[a].concat(a.visualViewport||[],D$(r)?r:[]):r,s=t.concat(o);return n?s:s.concat(N$(a$(o)))}function E$(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function M$(e,t,i){return t===xj?E$(function(e,t){var i=$j(e),r=n$(e),n=i.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,c=0;if(n){a=n.width,o=n.height;var d=Qj();(d||!d&&"fixed"===t)&&(s=n.offsetLeft,c=n.offsetTop)}return{width:a,height:o,x:s+T$(e),y:c}}(e,i)):Gj(t)?function(e,t){var i=Zj(e,!1,"fixed"===t);return i.top=i.top+e.clientTop,i.left=i.left+e.clientLeft,i.bottom=i.top+e.clientHeight,i.right=i.left+e.clientWidth,i.width=e.clientWidth,i.height=e.clientHeight,i.x=i.left,i.y=i.top,i}(t,i):E$(function(e){var t,i=n$(e),r=w$(e),n=null==(t=e.ownerDocument)?void 0:t.body,a=Yj(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=Yj(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),s=-r.scrollLeft+T$(e),c=-r.scrollTop;return"rtl"===i$(n||i).direction&&(s+=Yj(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:o,x:s,y:c}}(n$(e)))}function R$(e,t,i,r){var n="clippingParents"===t?function(e){var t=N$(a$(e)),i=["absolute","fixed"].indexOf(i$(e).position)>=0&&Wj(e)?s$(e):e;return Gj(i)?t.filter((function(e){return Gj(e)&&t$(e,i)&&"body"!==jj(e)})):[]}(e):[].concat(t),a=[].concat(n,[i]),o=a[0],s=a.reduce((function(t,i){var n=M$(e,i,r);return t.top=Yj(n.top,t.top),t.right=Kj(n.right,t.right),t.bottom=Kj(n.bottom,t.bottom),t.left=Yj(n.left,t.left),t}),M$(e,o,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function C$(e){var t,i=e.reference,r=e.element,n=e.placement,a=n?zj(n):null,o=n?m$(n):null,s=i.x+i.width/2-r.width/2,c=i.y+i.height/2-r.height/2;switch(a){case Pj:t={x:s,y:i.y-r.height};break;case Nj:t={x:s,y:i.y+i.height};break;case Ej:t={x:i.x+i.width,y:c};break;case Mj:t={x:i.x-r.width,y:c};break;default:t={x:i.x,y:i.y}}var d=a?c$(a):null;if(null!=d){var u="y"===d?"height":"width";switch(o){case Aj:t[d]=t[d]-(i[u]/2-r[u]/2);break;case kj:t[d]=t[d]+(i[u]/2-r[u]/2)}}return t}function A$(e,t){void 0===t&&(t={});var i=t,r=i.placement,n=void 0===r?e.placement:r,a=i.strategy,o=void 0===a?e.strategy:a,s=i.boundary,c=void 0===s?Oj:s,d=i.rootBoundary,u=void 0===d?xj:d,l=i.elementContext,p=void 0===l?Fj:l,m=i.altBoundary,f=void 0!==m&&m,h=i.padding,g=void 0===h?0:h,I=u$("number"!=typeof g?g:l$(g,Cj)),y=p===Fj?Lj:Fj,v=e.rects.popper,S=e.elements[f?y:p],U=R$(Gj(S)?S:S.contextElement||n$(e.elements.popper),c,u,o),b=Zj(e.elements.reference),w=C$({reference:b,element:v,placement:n}),T=E$(Object.assign({},v,w)),D=p===Fj?T:b,P={top:U.top-D.top+I.top,bottom:D.bottom-U.bottom+I.bottom,left:U.left-D.left+I.left,right:D.right-U.right+I.right},N=e.modifiersData.offset;if(p===Fj&&N){var E=N[n];Object.keys(P).forEach((function(e){var t=[Ej,Nj].indexOf(e)>=0?1:-1,i=[Pj,Nj].indexOf(e)>=0?"y":"x";P[e]+=E[i]*t}))}return P}const k$={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var n=i.mainAxis,a=void 0===n||n,o=i.altAxis,s=void 0===o||o,c=i.fallbackPlacements,d=i.padding,u=i.boundary,l=i.rootBoundary,p=i.altBoundary,m=i.flipVariations,f=void 0===m||m,h=i.allowedAutoPlacements,g=t.options.placement,I=zj(g),y=c||(I===g||!f?[S$(g)]:function(e){if(zj(e)===Rj)return[];var t=S$(e);return[b$(e),t,b$(t)]}(g)),v=[g].concat(y).reduce((function(e,i){return e.concat(zj(i)===Rj?function(e,t){void 0===t&&(t={});var i=t,r=i.placement,n=i.boundary,a=i.rootBoundary,o=i.padding,s=i.flipVariations,c=i.allowedAutoPlacements,d=void 0===c?Bj:c,u=m$(r),l=u?s?_j:_j.filter((function(e){return m$(e)===u})):Cj,p=l.filter((function(e){return d.indexOf(e)>=0}));0===p.length&&(p=l);var m=p.reduce((function(t,i){return t[i]=A$(e,{placement:i,boundary:n,rootBoundary:a,padding:o})[zj(i)],t}),{});return Object.keys(m).sort((function(e,t){return m[e]-m[t]}))}(t,{placement:i,boundary:u,rootBoundary:l,padding:d,flipVariations:f,allowedAutoPlacements:h}):i)}),[]),S=t.rects.reference,U=t.rects.popper,b=new Map,w=!0,T=v[0],D=0;D<v.length;D++){var P=v[D],N=zj(P),E=m$(P)===Aj,M=[Pj,Nj].indexOf(N)>=0,R=M?"width":"height",C=A$(t,{placement:P,boundary:u,rootBoundary:l,altBoundary:p,padding:d}),A=M?E?Ej:Mj:E?Nj:Pj;S[R]>U[R]&&(A=S$(A));var k=S$(A),O=[];if(a&&O.push(C[N]<=0),s&&O.push(C[A]<=0,C[k]<=0),O.every((function(e){return e}))){T=P,w=!1;break}b.set(P,O)}if(w)for(var x=function(e){var t=v.find((function(t){var i=b.get(t);if(i)return i.slice(0,e).every((function(e){return e}))}));if(t)return T=t,"break"},F=f?3:1;F>0;F--){if("break"===x(F))break}t.placement!==T&&(t.modifiersData[r]._skip=!0,t.placement=T,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function O$(e,t,i){return void 0===i&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function x$(e){return[Pj,Ej,Nj,Mj].some((function(t){return e[t]>=0}))}const F$={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,i=e.name,r=t.rects.reference,n=t.rects.popper,a=t.modifiersData.preventOverflow,o=A$(t,{elementContext:"reference"}),s=A$(t,{altBoundary:!0}),c=O$(o,r),d=O$(s,n,a),u=x$(c),l=x$(d);t.modifiersData[i]={referenceClippingOffsets:c,popperEscapeOffsets:d,isReferenceHidden:u,hasPopperEscaped:l},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":l})}};const L$={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,i=e.options,r=e.name,n=i.offset,a=void 0===n?[0,0]:n,o=Bj.reduce((function(e,i){return e[i]=function(e,t,i){var r=zj(e),n=[Mj,Pj].indexOf(r)>=0?-1:1,a="function"==typeof i?i(Object.assign({},t,{placement:e})):i,o=a[0],s=a[1];return o=o||0,s=(s||0)*n,[Mj,Ej].indexOf(r)>=0?{x:s,y:o}:{x:o,y:s}}(i,t.rects,a),e}),{}),s=o[t.placement],c=s.x,d=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=d),t.modifiersData[r]=o}};const _$={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,i=e.name;t.modifiersData[i]=C$({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})},data:{}};const B$={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,r=e.name,n=i.mainAxis,a=void 0===n||n,o=i.altAxis,s=void 0!==o&&o,c=i.boundary,d=i.rootBoundary,u=i.altBoundary,l=i.padding,p=i.tether,m=void 0===p||p,f=i.tetherOffset,h=void 0===f?0:f,g=A$(t,{boundary:c,rootBoundary:d,padding:l,altBoundary:u}),I=zj(t.placement),y=m$(t.placement),v=!y,S=c$(I),U=function(e){return"x"===e?"y":"x"}(S),b=t.modifiersData.popperOffsets,w=t.rects.reference,T=t.rects.popper,D="function"==typeof h?h(Object.assign({},t.rects,{placement:t.placement})):h,P="number"==typeof D?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),N=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,E={x:0,y:0};if(b){if(a){var M,R="y"===S?Pj:Mj,C="y"===S?Nj:Ej,A="y"===S?"height":"width",k=b[S],O=k+g[R],x=k-g[C],F=m?-T[A]/2:0,L=y===Aj?w[A]:T[A],_=y===Aj?-T[A]:-w[A],B=t.elements.arrow,V=m&&B?e$(B):{width:0,height:0},j=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},$=j[R],G=j[C],W=d$(0,w[A],V[A]),q=v?w[A]/2-F-W-$-P.mainAxis:L-W-$-P.mainAxis,H=v?-w[A]/2+F+W+G+P.mainAxis:_+W+G+P.mainAxis,z=t.elements.arrow&&s$(t.elements.arrow),Y=z?"y"===S?z.clientTop||0:z.clientLeft||0:0,K=null!=(M=N?.[S])?M:0,X=k+H-K,J=d$(m?Kj(O,k+q-K-Y):O,k,m?Yj(x,X):x);b[S]=J,E[S]=J-k}if(s){var Q,Z="x"===S?Pj:Mj,ee="x"===S?Nj:Ej,te=b[U],ie="y"===U?"height":"width",re=te+g[Z],ne=te-g[ee],ae=-1!==[Pj,Mj].indexOf(I),oe=null!=(Q=N?.[U])?Q:0,se=ae?re:te-w[ie]-T[ie]-oe+P.altAxis,ce=ae?te+w[ie]+T[ie]-oe-P.altAxis:ne,de=m&&ae?function(e,t,i){var r=d$(e,t,i);return r>i?i:r}(se,te,ce):d$(m?se:re,te,m?ce:ne);b[U]=de,E[U]=de-te}t.modifiersData[r]=E}},requiresIfExists:["offset"]};function V$(e,t,i){void 0===i&&(i=!1);var r=Wj(t),n=Wj(t)&&function(e){var t=e.getBoundingClientRect(),i=Xj(t.width)/e.offsetWidth||1,r=Xj(t.height)/e.offsetHeight||1;return 1!==i||1!==r}(t),a=n$(t),o=Zj(e,n,i),s={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!i)&&(("body"!==jj(t)||D$(a))&&(s=function(e){return e!==$j(e)&&Wj(e)?function(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}(e):w$(e)}(t)),Wj(t)?((c=Zj(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):a&&(c.x=T$(a))),{x:o.left+s.scrollLeft-c.x,y:o.top+s.scrollTop-c.y,width:o.width,height:o.height}}function j$(e){var t=new Map,i=new Set,r=[];function n(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var r=t.get(e);r&&n(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||n(e)})),r}function $$(e){var t;return function(){return t||(t=new Promise((function(i){Promise.resolve().then((function(){t=void 0,i(e())}))}))),t}}var G$={placement:"bottom",modifiers:[],strategy:"absolute"};function W$(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function q$(e){void 0===e&&(e={});var t=e,i=t.defaultModifiers,r=void 0===i?[]:i,n=t.defaultOptions,a=void 0===n?G$:n;return function(e,t,i){void 0===i&&(i=a);var n={placement:"bottom",orderedModifiers:[],options:Object.assign({},G$,a),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],s=!1,c={state:n,setOptions:function(i){var s="function"==typeof i?i(n.options):i;d(),n.options=Object.assign({},a,n.options,s),n.scrollParents={reference:Gj(e)?N$(e):e.contextElement?N$(e.contextElement):[],popper:N$(t)};var u=function(e){var t=j$(e);return Vj.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}(function(e){var t=e.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(r,n.options.modifiers)));return n.orderedModifiers=u.filter((function(e){return e.enabled})),n.orderedModifiers.forEach((function(e){var t=e.name,i=e.options,r=void 0===i?{}:i,a=e.effect;if("function"==typeof a){var s=a({state:n,name:t,instance:c,options:r}),d=function(){};o.push(s||d)}})),c.update()},forceUpdate:function(){if(!s){var e=n.elements,t=e.reference,i=e.popper;if(W$(t,i)){n.rects={reference:V$(t,s$(i),"fixed"===n.options.strategy),popper:e$(i)},n.reset=!1,n.placement=n.options.placement,n.orderedModifiers.forEach((function(e){return n.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<n.orderedModifiers.length;r++)if(!0!==n.reset){var a=n.orderedModifiers[r],o=a.fn,d=a.options,u=void 0===d?{}:d,l=a.name;"function"==typeof o&&(n=o({state:n,options:u,name:l,instance:c})||n)}else n.reset=!1,r=-1}}},update:$$((function(){return new Promise((function(e){c.forceUpdate(),e(n)}))})),destroy:function(){d(),s=!0}};if(!W$(e,t))return c;function d(){o.forEach((function(e){return e()})),o=[]}return c.setOptions(i).then((function(e){!s&&i.onFirstUpdate&&i.onFirstUpdate(e)})),c}}var H$=q$({defaultModifiers:[y$,_$,g$,Hj,L$,k$,B$,p$,F$]}),z$="tippy-content",Y$="tippy-backdrop",K$="tippy-arrow",X$="tippy-svg-arrow",J$={passive:!0,capture:!0},Q$=function(){return document.body};function Z$(e,t,i){return Array.isArray(e)?e[t]??(Array.isArray(i)?i[t]:i):e}function eG(e,t){var i={}.toString.call(e);return 0===i.indexOf("[object")&&i.indexOf(t+"]")>-1}function tG(e,t){return"function"==typeof e?e.apply(void 0,t):e}function iG(e,t){return 0===t?e:function(r){clearTimeout(i),i=setTimeout((function(){e(r)}),t)};var i}function rG(e){return[].concat(e)}function nG(e,t){-1===e.indexOf(t)&&e.push(t)}function aG(e){return[].slice.call(e)}function oG(e){return Object.keys(e).reduce((function(t,i){return void 0!==e[i]&&(t[i]=e[i]),t}),{})}function sG(){return document.createElement("div")}function cG(e){return["Element","Fragment"].some((function(t){return eG(e,t)}))}function dG(e){return cG(e)?[e]:function(e){return eG(e,"NodeList")}(e)?aG(e):Array.isArray(e)?e:aG(document.querySelectorAll(e))}function uG(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function lG(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function pG(e,t,i){var r=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[r](t,i)}))}function mG(e,t){for(var i=t;i;){var r;if(e.contains(i))return!0;i=null==i.getRootNode||null==(r=i.getRootNode())?void 0:r.host}return!1}var fG={isTouch:!1},hG=0;function gG(){fG.isTouch||(fG.isTouch=!0,window.performance&&document.addEventListener("mousemove",IG))}function IG(){var e=performance.now();e-hG<20&&(fG.isTouch=!1,document.removeEventListener("mousemove",IG)),hG=e}function yG(){var e=document.activeElement;if(function(e){return!(!e||!e._tippy||e._tippy.reference!==e)}(e)){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var vG=!!(typeof window<"u"&&typeof document<"u")&&!!window.msCrypto;var SG={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},UG=Object.assign({appendTo:Q$,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},SG,{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),bG=Object.keys(UG);function wG(e){var t=(e.plugins||[]).reduce((function(t,i){var r,n=i.name,a=i.defaultValue;n&&(t[n]=void 0!==e[n]?e[n]:null!=(r=UG[n])?r:a);return t}),{});return Object.assign({},e,t)}function TG(e,t){var i=Object.assign({},t,{content:tG(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(wG(Object.assign({},UG,{plugins:t}))):bG).reduce((function(t,i){var r=(e.getAttribute("data-tippy-"+i)||"").trim();if(!r)return t;if("content"===i)t[i]=r;else try{t[i]=JSON.parse(r)}catch{t[i]=r}return t}),{})}(e,t.plugins));return i.aria=Object.assign({},UG.aria,i.aria),i.aria={expanded:"auto"===i.aria.expanded?t.interactive:i.aria.expanded,content:"auto"===i.aria.content?t.interactive?null:"describedby":i.aria.content},i}var DG=function(){return"innerHTML"};function PG(e,t){e[DG()]=t}function NG(e){var t=sG();return!0===e?t.className=K$:(t.className=X$,cG(e)?t.appendChild(e):PG(t,e)),t}function EG(e,t){cG(t.content)?(PG(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?PG(e,t.content):e.textContent=t.content)}function MG(e){var t=e.firstElementChild,i=aG(t.children);return{box:t,content:i.find((function(e){return e.classList.contains(z$)})),arrow:i.find((function(e){return e.classList.contains(K$)||e.classList.contains(X$)})),backdrop:i.find((function(e){return e.classList.contains(Y$)}))}}function RG(e){var t=sG(),i=sG();i.className="tippy-box",i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=sG();function n(i,r){var n=MG(t),a=n.box,o=n.content,s=n.arrow;r.theme?a.setAttribute("data-theme",r.theme):a.removeAttribute("data-theme"),"string"==typeof r.animation?a.setAttribute("data-animation",r.animation):a.removeAttribute("data-animation"),r.inertia?a.setAttribute("data-inertia",""):a.removeAttribute("data-inertia"),a.style.maxWidth="number"==typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?a.setAttribute("role",r.role):a.removeAttribute("role"),(i.content!==r.content||i.allowHTML!==r.allowHTML)&&EG(o,e.props),r.arrow?s?i.arrow!==r.arrow&&(a.removeChild(s),a.appendChild(NG(r.arrow))):a.appendChild(NG(r.arrow)):s&&a.removeChild(s)}return r.className=z$,r.setAttribute("data-state","hidden"),EG(r,e.props),t.appendChild(i),i.appendChild(r),n(e.props,e.props),{popper:t,onUpdate:n}}RG.$$tippy=!0;var CG=1,AG=[],kG=[];function OG(e,t){var i,r,n,a,o,s,c,d=TG(e,Object.assign({},UG,wG(oG(t)))),u=!1,l=!1,p=!1,m=!1,f=[],h=iG(H,d.interactiveDebounce),g=CG++,I=function(e){return e.filter((function(t,i){return e.indexOf(t)===i}))}(d.plugins),y={id:g,reference:e,popper:sG(),popperInstance:null,props:d,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:I,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(r),cancelAnimationFrame(n)},setProps:function(t){if(!y.state.isDestroyed){A("onBeforeUpdate",[y,t]),W();var i=y.props,r=TG(e,Object.assign({},i,oG(t),{ignoreAttributes:!0}));y.props=r,G(),i.interactiveDebounce!==r.interactiveDebounce&&(x(),h=iG(H,r.interactiveDebounce)),i.triggerTarget&&!r.triggerTarget?rG(i.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):r.triggerTarget&&e.removeAttribute("aria-expanded"),O(),C(),U&&U(i,r),y.popperInstance&&(X(),Q().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)}))),A("onAfterUpdate",[y,t])}},setContent:function(e){y.setProps({content:e})},show:function(){var e=y.state.isVisible,t=y.state.isDestroyed,i=!y.state.isEnabled,r=fG.isTouch&&!y.props.touch,n=Z$(y.props.duration,0,UG.duration);if(!(e||t||i||r||N().hasAttribute("disabled")||(A("onShow",[y],!1),!1===y.props.onShow(y)))){if(y.state.isVisible=!0,P()&&(S.style.visibility="visible"),C(),B(),y.state.isMounted||(S.style.transition="none"),P()){var a=M();uG([a.box,a.content],0)}s=function(){var e;if(y.state.isVisible&&!m){if(m=!0,S.offsetHeight,S.style.transition=y.props.moveTransition,P()&&y.props.animation){var t=M(),i=t.box,r=t.content;uG([i,r],n),lG([i,r],"visible")}k(),O(),nG(kG,y),null==(e=y.popperInstance)||e.forceUpdate(),A("onMount",[y]),y.props.animation&&P()&&function(e,t){j(e,t)}(n,(function(){y.state.isShown=!0,A("onShown",[y])}))}},function(){var e,t=y.props.appendTo,i=N();e=y.props.interactive&&t===Q$||"parent"===t?i.parentNode:tG(t,[i]),e.contains(S)||e.appendChild(S),y.state.isMounted=!0,X()}()}},hide:function(){var e=!y.state.isVisible,t=y.state.isDestroyed,i=!y.state.isEnabled,r=Z$(y.props.duration,1,UG.duration);if(!(e||t||i)&&(A("onHide",[y],!1),!1!==y.props.onHide(y))){if(y.state.isVisible=!1,y.state.isShown=!1,m=!1,u=!1,P()&&(S.style.visibility="hidden"),x(),V(),C(!0),P()){var n=M(),a=n.box,o=n.content;y.props.animation&&(uG([a,o],r),lG([a,o],"hidden"))}k(),O(),y.props.animation?P()&&function(e,t){j(e,(function(){!y.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&t()}))}(r,y.unmount):y.unmount()}},hideWithInteractivity:function(e){E().addEventListener("mousemove",h),nG(AG,h),h(e)},enable:function(){y.state.isEnabled=!0},disable:function(){y.hide(),y.state.isEnabled=!1},unmount:function(){y.state.isVisible&&y.hide(),y.state.isMounted&&(J(),Q().forEach((function(e){e._tippy.unmount()})),S.parentNode&&S.parentNode.removeChild(S),kG=kG.filter((function(e){return e!==y})),y.state.isMounted=!1,A("onHidden",[y]))},destroy:function(){!y.state.isDestroyed&&(y.clearDelayTimeouts(),y.unmount(),W(),delete e._tippy,y.state.isDestroyed=!0,A("onDestroy",[y]))}};if(!d.render)return y;var v=d.render(y),S=v.popper,U=v.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+y.id,y.popper=S,e._tippy=y,S._tippy=y;var b=I.map((function(e){return e.fn(y)})),w=e.hasAttribute("aria-expanded");return G(),O(),C(),A("onCreate",[y]),d.showOnCreate&&Z(),S.addEventListener("mouseenter",(function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()})),S.addEventListener("mouseleave",(function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&E().addEventListener("mousemove",h)})),y;function T(){var e=y.props.touch;return Array.isArray(e)?e:[e,0]}function D(){return"hold"===T()[0]}function P(){var e;return!(null==(e=y.props.render)||!e.$$tippy)}function N(){return c||e}function E(){var e=N().parentNode;return e?function(e){var t,i=rG(e)[0];return null!=i&&null!=(t=i.ownerDocument)&&t.body?i.ownerDocument:document}(e):document}function M(){return MG(S)}function R(e){return y.state.isMounted&&!y.state.isVisible||fG.isTouch||a&&"focus"===a.type?0:Z$(y.props.delay,e?0:1,UG.delay)}function C(e){void 0===e&&(e=!1),S.style.pointerEvents=y.props.interactive&&!e?"":"none",S.style.zIndex=""+y.props.zIndex}function A(e,t,i){var r;(void 0===i&&(i=!0),b.forEach((function(i){i[e]&&i[e].apply(i,t)})),i)&&(r=y.props)[e].apply(r,t)}function k(){var t=y.props.aria;if(t.content){var i="aria-"+t.content,r=S.id;rG(y.props.triggerTarget||e).forEach((function(e){var t=e.getAttribute(i);if(y.state.isVisible)e.setAttribute(i,t?t+" "+r:r);else{var n=t&&t.replace(r,"").trim();n?e.setAttribute(i,n):e.removeAttribute(i)}}))}}function O(){!w&&y.props.aria.expanded&&rG(y.props.triggerTarget||e).forEach((function(e){y.props.interactive?e.setAttribute("aria-expanded",y.state.isVisible&&e===N()?"true":"false"):e.removeAttribute("aria-expanded")}))}function x(){E().removeEventListener("mousemove",h),AG=AG.filter((function(e){return e!==h}))}function F(t){if(!fG.isTouch||!p&&"mousedown"!==t.type){var i=t.composedPath&&t.composedPath()[0]||t.target;if(!y.props.interactive||!mG(S,i)){if(rG(y.props.triggerTarget||e).some((function(e){return mG(e,i)}))){if(fG.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else A("onClickOutside",[y,t]);!0===y.props.hideOnClick&&(y.clearDelayTimeouts(),y.hide(),l=!0,setTimeout((function(){l=!1})),y.state.isMounted||V())}}}function L(){p=!0}function _(){p=!1}function B(){var e=E();e.addEventListener("mousedown",F,!0),e.addEventListener("touchend",F,J$),e.addEventListener("touchstart",_,J$),e.addEventListener("touchmove",L,J$)}function V(){var e=E();e.removeEventListener("mousedown",F,!0),e.removeEventListener("touchend",F,J$),e.removeEventListener("touchstart",_,J$),e.removeEventListener("touchmove",L,J$)}function j(e,t){var i=M().box;function r(e){e.target===i&&(pG(i,"remove",r),t())}if(0===e)return t();pG(i,"remove",o),pG(i,"add",r),o=r}function $(t,i,r){void 0===r&&(r=!1),rG(y.props.triggerTarget||e).forEach((function(e){e.addEventListener(t,i,r),f.push({node:e,eventType:t,handler:i,options:r})}))}function G(){D()&&($("touchstart",q,{passive:!0}),$("touchend",z,{passive:!0})),function(e){return e.split(/\s+/).filter(Boolean)}(y.props.trigger).forEach((function(e){if("manual"!==e)switch($(e,q),e){case"mouseenter":$("mouseleave",z);break;case"focus":$(vG?"focusout":"blur",Y);break;case"focusin":$("focusout",Y)}}))}function W(){f.forEach((function(e){var t=e.node,i=e.eventType,r=e.handler,n=e.options;t.removeEventListener(i,r,n)})),f=[]}function q(e){var t,i=!1;if(y.state.isEnabled&&!K(e)&&!l){var r="focus"===(null==(t=a)?void 0:t.type);a=e,c=e.currentTarget,O(),!y.state.isVisible&&function(e){return eG(e,"MouseEvent")}(e)&&AG.forEach((function(t){return t(e)})),"click"===e.type&&(y.props.trigger.indexOf("mouseenter")<0||u)&&!1!==y.props.hideOnClick&&y.state.isVisible?i=!0:Z(e),"click"===e.type&&(u=!i),i&&!r&&ee(e)}}function H(e){var t=e.target,i=N().contains(t)||S.contains(t);"mousemove"===e.type&&i||function(e,t){var i=t.clientX,r=t.clientY;return e.every((function(e){var t=e.popperRect,n=e.popperState,a=e.props.interactiveBorder,o=function(e){return e.split("-")[0]}(n.placement),s=n.modifiersData.offset;if(!s)return!0;var c="bottom"===o?s.top.y:0,d="top"===o?s.bottom.y:0,u="right"===o?s.left.x:0,l="left"===o?s.right.x:0,p=t.top-r+c>a,m=r-t.bottom-d>a,f=t.left-i+u>a,h=i-t.right-l>a;return p||m||f||h}))}(Q().concat(S).map((function(e){var t,i=null==(t=e._tippy.popperInstance)?void 0:t.state;return i?{popperRect:e.getBoundingClientRect(),popperState:i,props:d}:null})).filter(Boolean),e)&&(x(),ee(e))}function z(e){if(!(K(e)||y.props.trigger.indexOf("click")>=0&&u)){if(y.props.interactive)return void y.hideWithInteractivity(e);ee(e)}}function Y(e){y.props.trigger.indexOf("focusin")<0&&e.target!==N()||y.props.interactive&&e.relatedTarget&&S.contains(e.relatedTarget)||ee(e)}function K(e){return!!fG.isTouch&&D()!==e.type.indexOf("touch")>=0}function X(){J();var t=y.props,i=t.popperOptions,r=t.placement,n=t.offset,a=t.getReferenceClientRect,o=t.moveTransition,c=P()?MG(S).arrow:null,d=a?{getBoundingClientRect:a,contextElement:a.contextElement||N()}:e,u=[{name:"offset",options:{offset:n}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(P()){var i=M().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?i.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?i.setAttribute("data-"+e,""):i.removeAttribute("data-"+e)})),t.attributes.popper={}}}}];P()&&c&&u.push({name:"arrow",options:{element:c,padding:3}}),u.push.apply(u,i?.modifiers||[]),y.popperInstance=H$(d,S,Object.assign({},i,{placement:r,onFirstUpdate:s,modifiers:u}))}function J(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function Q(){return aG(S.querySelectorAll("[data-tippy-root]"))}function Z(e){y.clearDelayTimeouts(),e&&A("onTrigger",[y,e]),B();var t=R(!0),r=T(),n=r[0],a=r[1];fG.isTouch&&"hold"===n&&a&&(t=a),t?i=setTimeout((function(){y.show()}),t):y.show()}function ee(e){if(y.clearDelayTimeouts(),A("onUntrigger",[y,e]),y.state.isVisible){if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&u)){var t=R(!1);t?r=setTimeout((function(){y.state.isVisible&&y.hide()}),t):n=requestAnimationFrame((function(){y.hide()}))}}else V()}}function xG(e,t){void 0===t&&(t={});var i=UG.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",gG,J$),window.addEventListener("blur",yG);var r=Object.assign({},t,{plugins:i}),n=dG(e).reduce((function(e,t){var i=t&&OG(t,r);return i&&e.push(i),e}),[]);return cG(e)?n[0]:n}function FG(e){return"function"==typeof e}let LG;function _G(e){LG&&(LG?.destroy(!0),LG=void 0),e?.remove&&e.remove()}function BG(e){const{title:t,options:i,menuItems:r=[],coords:n,callback:a,config:o}=e;let{target:s,items:c}=e;if(!i?.length&&!c?.length&&!r)return;_G();const d=document.createElement("div");let u;return s=s||n?.evt?.target,s&&(LG=xG(s,{content:()=>{c=c?.filter((e=>!e.hide&&!e.disabled)).map((e=>({...e,onClick:()=>{_G(d),FG(e.onClick)&&e.onClick()}})))||i?.filter((e=>!e.hide&&!e.disabled)).map((e=>({text:"object"==typeof e?e.option:e,style:e.style,onClick:()=>{e.subMenu?LG.setContent("IMPLEMENT SUB MENU"):FG(e.onClick)?(_G(d),e.onClick()):FG(a)&&a&&(_G(d),a("object"==typeof e?{...e,coords:n}:e))}})));const e=[{text:t,items:c},...r];return u=Dj(d,e).focusElement,d},theme:"light-border",trigger:"click",onShown:()=>{u&&setTimeout((()=>u?.focus()),0)},...o}),LG.show(),LG.setProps({interactive:!0})),LG}function VG(){return"0.9.9"}xG.defaultProps=UG,xG.setDefaultProps=function(e){Object.keys(e).forEach((function(t){UG[t]=e[t]}))},xG.currentInput=fG,Object.assign({},Hj,{effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow)}}),xG.setDefaultProps({render:RG});const jG={SET3_S6_TB7:"SET3-S:6/TB7",SET3_S6_TB7_F_TB10:"SET3-S:6/TB7-F:TB10",SET3_S6_TB10:"SET3-S:6/TB10",SET3_S6_F_TB10:"SET3-S:6-F:TB10",SET3_S6_TB7_NOAD:"SET3-S:6/TB7NOAD",SET3_S8_TB7:"SET3-S:8/TB7",SET3_S8_TB7_AT7:"SET3-S:8/TB7@7",SET3_S4_TB7:"SET3-S:4/TB7",SET3_S4_TB7_F_TB10:"SET3-S:4/TB7-F:TB10",SET3_S4_TB5_AT3_F_TB10:"SET3-S:4/TB5@3-F:TB10",SET5_S6_TB7:"SET5-S:6/TB7",SET5_S6_TB7_F_TB10:"SET5-S:6/TB7-F:TB10",SET1_S6_TB7:"SET1-S:6/TB7",SET1_S6_TB10:"SET1-S:6/TB10",SET1_S6_TB7_AT5:"SET1-S:6/TB7@5",SET1_S8_TB7:"SET1-S:8/TB7",SET1_S4_TB7:"SET1-S:4/TB7",SET1_S5_TB9_AT4:"SET1-S:5/TB9@4",SET1_S_TB7:"SET1-S:T7",SET1_S_TB10:"SET1-S:TB10",SET1_S_TB21:"SET1-S:T21",SET1_S8:"SET1-S:8",SET1_S10:"SET1-S:10",FAST4:"SET5-S:4/NOAD",SET3X_T10A_TB1:"SET3X-S:T10A-F:TB1",SET3X_T10A_TB1_NOAD:"SET3X-S:T10A-F:TB1NOAD",SET4X_T10A_TB1:"SET4X-S:T10A-F:TB1"};function $G(e,t,i){if(!e)return{elements:{}};const r={};for(const n of t||[]){if(!n?.label||n.hide)continue;const t=document.createElement("button");n.id&&(r[n.id]=t,t.id=n.id),t.style.marginRight=".5em",t.className="button font-medium",n.intent&&t.classList.add(n.intent),t.innerHTML=n.label,n.disabled&&(t.disabled=!0),t.onclick=e=>{e.stopPropagation(),!e.target.disabled&&we(n.onClick)&&n.onClick(),i&&we(i)&&i()},e.appendChild(t)}return{elements:r}}}}]);