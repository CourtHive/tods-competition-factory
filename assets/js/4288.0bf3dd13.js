(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[4288],{3905:function(t,e,n){"use strict";n.d(e,{Zo:function(){return d},kt:function(){return m}});var i=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},a=Object.keys(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var c=i.createContext({}),u=function(t){var e=i.useContext(c),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},d=function(t){var e=u(t.components);return i.createElement(c.Provider,{value:e},t.children)},l={inlineCode:"code",wrapper:function(t){var e=t.children;return i.createElement(i.Fragment,{},e)}},p=i.forwardRef((function(t,e){var n=t.components,r=t.mdxType,a=t.originalType,c=t.parentName,d=s(t,["components","mdxType","originalType","parentName"]),p=u(n),m=r,f=p["".concat(c,".").concat(m)]||p[m]||l[m]||a;return n?i.createElement(f,o(o({ref:e},d),{},{components:n})):i.createElement(f,o({ref:e},d))}));function m(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var a=n.length,o=new Array(a);o[0]=p;var s={};for(var c in e)hasOwnProperty.call(e,c)&&(s[c]=e[c]);s.originalType=t,s.mdxType="string"==typeof t?t:r,o[1]=s;for(var u=2;u<a;u++)o[u]=n[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5753:function(t,e,n){"use strict";n.d(e,{aX:function(){return ef},y1:function(){return yI},SX:function(){return og},C9:function(){return g},QO:function(){return ag},_3:function(){return Lo},M6:function(){return Gv},hC:function(){return sg}});const i="SET",r="NOAD",a={S:"normal",F:"final"};function o(t,e){if(t&&"object"==typeof t){if(t.timed&&!isNaN(t.minutes))return c(t);if(t.bestOf&&t.setFormat)return function(t,e){const n=s(t.bestOf),i=n&&`SET${n}`||"",r=u(t.setFormat,e),a=r&&`S:${r}`||"",o=u(t.finalSetFormat,e),c=n>1&&o&&!o.invalid&&r!==o&&`F:${o}`||"";if(i&&r&&!r.invalid&&(!o||!o.invalid))return[i,a,c].filter((t=>t)).join("-")}(t,e)}}function s(t){return!isNaN(Number(t))&&Number(t)}function c(t){return`T${t.minutes}`}function u(t,e){if(t&&"object"==typeof t){if(t.timed)return c(t);if(t.tiebreakSet)return d(t.tiebreakSet);const n=s(t.setTo);if(n){const i=t.NoAD?r:"",a=d(t.tiebreakFormat),o=a&&!a.invalid&&`/${a}`||"",c=s(t.tiebreakAt),u=c&&(c!==n||e)&&`@${c}`||"";return!a||!a.invalid?`${n}${i}${o}${u}`:{invalid:!0}}return{invalid:!0}}}function d(t){if(t)return"object"!=typeof t||t.tiebreakTo?"object"==typeof t&&s(t.tiebreakTo)?`TB${t.tiebreakTo}${t.NoAD?r:""}`:{invalid:!0}:""}function l(t){if(t&&"string"==typeof t){const e=0===t.indexOf("T")?"timed":0===t.indexOf(i)?i:"";if("timed"===e){const e={bestOf:1,setFormat:f(t)};if(e.setFormat)return e}if(e===i)return function(t){const e=t.split("-"),n=I(e[0].slice(3)),i=e&&p(e[1]),r=e&&p(e[2]),a=n&&n<6,o=!e[2]||r&&!r.invalid,s=i&&!i.invalid,c={bestOf:n,setFormat:i};r&&(c.finalSetFormat=r);if(a&&s&&o)return c}(t)}}function p(t){if(t&&":"===t[1]){const e=t.split(":"),n=a[e[0]],i=e[1];if(n&&i){if(0===i.indexOf("TB"))return{tiebreakSet:m(i)};if(0===i.indexOf("T")){return f(i)}const e=t.match(/^[FS]{1}:(\d+)([A-Za-z]*)/),n=e&&h(e[2])||!1,r=!e||!e[2]||n,a=e&&I(e[1]),o=function(t){const e=t&&t.indexOf("@")>0&&t.split("@");if(e){return I(e[1])||{invalid:!0}}}(i),s=!o||o&&!o.invalid,c=s&&o||a,u=m(i.split("/")[1]),d=!u||!u.invalid,l={setTo:a};return n&&(l.NoAD=!0),u?(l.tiebreakFormat=u,l.tiebreakAt=c):l.noTiebreak=!0,a&&r&&d&&s&&l||{invalid:!0}}}}function m(t){if(t){if(0===t.indexOf("TB")){const e=t.match(/^TB(\d+)([A-Za-z]*)/),n=e&&e[1],i=e&&h(e[2]),r=!e||!e[2]||i,a=I(n);if(a&&r){const t={tiebreakTo:a};return i&&(t.NoAD=!0),t}return{invalid:!0}}return{invalid:!0}}}function f(t){const e=I(t.slice(1));if(e)return{timed:!0,minutes:e}}function h(t){return t&&t.indexOf(r)>=0}function I(t){return!isNaN(Number(t))&&Number(t)}function v(t){var e;if("string"!=typeof t)return!1;const n=l(t);if(null!=n&&null!==(e=n.setFormat)&&void 0!==e&&e.timed&&1===(null==n?void 0:n.bestOf)&&t.indexOf("SET1-S:")<1&&0===t.indexOf("T"))return o(n).slice(7)===t;const i=t.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),r=null==i?void 0:i[0],a=null==i?void 0:i[2],s=t.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),c=null==s?void 0:s[0],u=null==s?void 0:s[2];return o(n,i&&r===a||s&&c===u)===t}const g={isValidMatchUpFormat:v,stringify:o,isValid:v,parse:l},y="SET3-S:6/TB7",U="ABANDONED",w="AWAITING_RESULT",S="BYE",N="CANCELLED",D="COMPLETED",P="DEAD_RUBBER",T="DEFAULTED",A="DOUBLE_WALKOVER",M="IN_PROGRESS",b="INCOMPLETE",E="NOT_PLAYED",C="RETIRED",R="SUSPENDED",O="TO_BE_PLAYED",x="WALKOVER",L=[w,D,T,A,M,b,C,R,x],F=[U,w,S,N,D,P,T,A,M,b,E,C,R,O,x],k=[S,D,T,A,C,x],j=[U,w,N,P,M,b,E,R,O,void 0],B=[N,U,D,P,T,A,C,x],_=[U,D,T,A,M,C,x],G=[M,b,R,O],V={ABANDONED:U,AWAITING_RESULT:w,BYE:S,CANCELLED:N,COMPLETED:D,DEAD_RUBBER:P,DEFAULTED:T,DOUBLE_WALKOVER:A,IN_PROGRESS:M,INCOMPLETE:b,NOT_PLAYED:E,RETIRED:C,SUSPENDED:R,TO_BE_PLAYED:O,WALKOVER:x};function H({winningSide:t,matchUpFormat:e=y,matchUpStatus:n,tallyPolicy:i,score:r}){const a=[0,0],{sets:o}=r||{},s=t-1,c=l(e),u=W((null==c?void 0:c.bestOf)||1);return n===T&&null!=i&&i.setsCreditForDefaults||n===x&&null!=i&&i.setsCreditForWalkovers?a[s]=u:o&&o.forEach((t=>{const{winningSide:e}=t;e&&(a[e-1]+=1)})),n===C&&(+a[1-s]===u&&(a[1-s]-=1),a[s]=u),a}function W(t){return t&&Math.ceil(t/2)||1}function q(t){return!isNaN(t)&&(t&&0==(t&t-1))}function K(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function z(t){return!isNaN(parseFloat(t))}function Y(t){if(isNaN(t))return!1;for(;!q(t);)t++;return t}function $(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function J(t){return Number.isSafeInteger("string"==typeof t?+t:t)}function Z(t){if(null===t)return{};const{source:e,template:n}=t||{},i={};return function t(e,n,i){if(!e||!n)return;const r=Object.keys(e),a=Object.keys(n);for(let o=0;o<r.length;o++)if(a.indexOf(r[o])>=0){const a=n[r[o]],s=e[r[o]];a&&"object"==typeof a&&"function"!=typeof s?Array.isArray(s)?i[r[o]]=s.map((e=>{const n={};return t(e,a,n),n})):s&&(i[r[o]]={},t(s,a,i[r[o]])):n[r[o]]&&(i[r[o]]=e[r[o]])}}(e,n,i),i}function Q(t=0){const e=new Date;e.setHours(e.getHours()+t);return e.getTime().toString(36).slice(-6).toUpperCase()}function X(t){return t.filter(((t,e,n)=>n.lastIndexOf(t)===e))}function tt(t){return t.map((t=>[Math.random(),t])).sort(((t,e)=>t[0]-e[0])).map((t=>t[1]))}function et(t){return t.reduce(((t,e)=>(t[e]||(t[e]=0),t[e]++,t)),{})}function nt(t,e,n){return n.indexOf(t)===e}function it(t){return t.filter(nt)}function rt(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function at(t){return t[Math.floor(Math.random()*t.length)]}function ot(t,e){return Array.from({length:e-t},((e,n)=>n+t))}function st(t,e){return e.reduce(((e,n,i)=>(n===t&&e.push(i),e)),[])}function ct(t,e){return Array.isArray(t)&&Array.isArray(e)?t.filter((t=>-1!==e.indexOf(t))).filter(((t,e,n)=>n.indexOf(t)===e)):0}function ut(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.some((t=>e.includes(t)))}function dt(t,e){return t.reduce(((t,n,i)=>{const r=Math.floor(i/e);return t[r]=[].concat(t[r]||[],n),t}),[])}function lt(t,e,n){return t.reduce(((t,i,r)=>{const a=!!n&&!!(Math.floor(r/e)%2),o=r%e,s=a?e-1-o:o;return t[s]||(t[s]=[]),t[s].push(i),t}),[])}const pt={success:!0},mt={SUCCESS:pt,ERROR:"error"},ft="records must be an object with tournamentId keys",ht="Missing tournamentRecords",It="Missing tournamentRecord",vt="Invalid tournamentRecord",gt="Missing tournamentId",yt="Invalid drawDefinition",Ut="Missing drawDefinition",wt="Existing drawDefinition(s)",St="drawDefinition not found",Nt="Invalid structure",Dt="Invalid drawPosition for seedAssignment",Pt="drawPosition already assigned",Tt="drawPosition not cleared",At="Unrecognized drawType",Mt="Missing drawPositions",bt="drawPosition is active",Et="Invlid drawPosition",Ct="Missing drawPosition",Rt="Invalid drawSize",Ot="Missing drawSize",xt="Missing drawId",Lt="drawId exists",Ft="seedsCount greater than drawSize",kt="Missing seedCountThresholds",jt="Missing seedAssignments",Bt="Invalid seedNumber",_t="Invalid seedPosition",Gt="Missing targetLink",Vt="Existing round",Ht="Missing structureId",Wt="structure not found",qt="Missing structures",Kt="Missing structure",zt="Invalie eventType",Yt="Missing event / eventId",$t="Event not found",Jt="Event exists",Zt="Missing entries",Qt="Invalid entries",Xt="Missing assignments",te="Missing stage",ee="Invalid stage",ne="stageSequence limit",ie="Missing positionAssignments",re="Unrecognized matchUpStatus",ae="Unrecognized matchUpFormat",oe="Incompatible matchUpStatus",se="Invalid matchUpStatus",ce="Invalid tieFormat",ue="Invalid matchUpFormat",de="Missing matchUpFormat",le="Missing collectionDefinition",pe="Missing tieFormat",me="Missing matchUpId",fe="Missing matchUpIds",he="matchUp not found",Ie="Missing matchUps",ve="Missing matchUp",ge="Invalid matchUp",ye="Missing policyType",Ue="Missing policyDefinitions",we="Missing avoidance policy",Se="Missing policy attributes",Ne="Invalid policyDefinitions",De="existing policyType",Pe="Policy not attached",Te="Policy not found",Ae="Missing scoring policy / matchUpFormats",Me="Missing setObject",be="Missing courtId",Ee="Missing value",Ce="Missing date",Re="No valid dates",Oe="Invalid bookings",xe="Invalid dateAvailability",Le="Missing dateAvailability",Fe="Invalid Date",ke="Invalid time",je="Invalid tournament dates",Be="Invalid game scores",_e="Invalid winningSide",Ge="Cannot remove participants",Ve="Cannot change winningSide",He="Invalid participant",We="Invalid participantId",qe="Invalid participantIds",Ke="Invalid participantType",ze="Missing participantRole",Ye="Missing participant",$e="Missing participants",Je="Missing participantId",Ze="Participant Not Found",Qe="participantId exists",Xe="No participant removed",tn="Missing participantIds",en="Missing participantCount",nn="Participant not checked in",rn="Participant already checked in",an="Participant has assigned drawPosition",on="Missing person details",sn="Existing participant drawPosition assignment",cn="Existing participant",un="participantCount exceeds drawSize",dn="More Participants than Draw Positions",ln="Invalid entry status",pn="Participant Entry Not Found",mn="entryStatus not allowed in stage",fn="entryStatus not allowed for event",hn="No stage space available for entryStatus",In="Missing penaltyType",vn="Missing penaltyId",gn="Penalty not found",yn="Missing courtsCount/courtNames",Un="Court not found",wn="Court exists",Sn="Venue exists",Nn="Venue not found",Dn="Missing venueId",Pn="Invalid endTime",Tn="Existing endTime",An="Invalid stopTime",Mn="Invalid startTime",bn="Invalid timeItem",En="Missing timeItem",Cn="Missing timeItems",Rn="Missing context",On="Missing schedule",xn="Invalid scaleItem",Ln="No scaleItem found",Fn="Modifications failed",kn="No modifications applied",jn="Invalid configuration",Bn="Invalid object",_n="Invalid values",Gn="Team not found",Vn="No valid actions",Hn="No valid attributes",Wn="Value unchanged",qn="Not found",Kn="Not implemented",zn="Existing flight",Yn="Existing profile",$n="Existing outcome",Jn="Method not found",Zn={CANNOT_CHANGE_WINNINGSIDE:Ve,CANNOT_REMOVE_PARTICIPANTS:Ge,COURT_EXISTS:wn,COURT_NOT_FOUND:Un,DRAW_DEFINITION_NOT_FOUND:St,DRAW_ID_EXISTS:Lt,DRAW_POSITION_ACTIVE:bt,DRAW_POSITION_ASSIGNED:Pt,DRAW_POSITION_NOT_CLEARED:Tt,DRAW_POSITION_NOT_FOUND:"drawPosition not found",ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:fn,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:mn,EVENT_EXISTS:Jt,EVENT_NOT_FOUND:$t,EXISTING_DRAW_DEFINITIONS:wt,EXISTING_END_TIME:Tn,EXISTING_FLIGHT:zn,EXISTING_OUTCOME:$n,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:sn,EXISTING_PARTICIPANT:cn,EXISTING_POLICY_TYPE:De,EXISTING_PROFILE:Yn,EXISTING_ROUND:Vt,INCOMPATIBLE_MATCHUP_STATUS:oe,INVALID_BOOKINGS:Oe,INVALID_CONFIGURATION:jn,INVALID_DATE_AVAILABILITY:xe,INVALID_DATE:Fe,INVALID_DRAW_DEFINITION:yt,INVALID_DRAW_POSITION_FOR_SEEDING:Dt,INVALID_DRAW_POSITION:Et,INVALID_DRAW_SIZE:Rt,INVALID_END_TIME:Pn,INVALID_ENTRIES:Qt,INVALID_EVENT_TYPE:zt,INVALID_GAME_SCORES:Be,INVALID_MATCHUP_FORMAT:ue,INVALID_MATCHUP_STATUS:se,INVALID_MATCHUP:ge,INVALID_OBJECT:Bn,INVALID_PARTICIPANT_ID:We,INVALID_PARTICIPANT_IDS:qe,INVALID_PARTICIPANT_TYPE:Ke,INVALID_PARTICIPANT:He,INVALID_POLICY_DEFINITION:Ne,INVALID_RECORDS:ft,INVALID_SCALE_ITEM:xn,INVALID_SEED_NUMBER:Bt,INVALID_SEED_POSITION:_t,INVALID_SET_NUMBER:"Invalid setNumber",INVALID_SIDE_NUMBER:"Invalid sideNumber",INVALID_STAGE:ee,INVALID_START_TIME:Mn,INVALID_STRUCTURE:Nt,INVALID_STOP_TIME:An,INVALID_TIE_FORMAT:ce,INVALID_TIME:ke,INVALID_TIME_ITEM:bn,INVALID_TOURNAMENT_DATES:je,INVALID_TOURNAMENT_RECORD:vt,INVALID_VALUES:_n,INVALID_WINNING_SIDE:_e,MATCHUP_NOT_FOUND:he,METHOD_NOT_FOUND:Jn,MISSING_ASSIGNMENTS:Xt,MISSING_AVOIDANCE_POLICY:we,MISSING_COLLECTION_DEFINITION:le,MISSING_COURT_ID:be,MISSING_COURTS_INFO:yn,MISSING_DATE_AVAILABILITY:Le,MISSING_DATE:Ce,MISSING_DRAW_DEFINITION:Ut,MISSING_DRAW_ID:xt,MISSING_DRAW_POSITION:Ct,MISSING_DRAW_POSITIONS:Mt,MISSING_DRAW_SIZE:Ot,MISSING_ENTRIES:Zt,MISSING_EVENT:Yt,MISSING_MATCHUP_FORMAT:de,MISSING_MATCHUP_ID:me,MISSING_MATCHUP_IDS:fe,MISSING_MATCHUP:ve,MISSING_MATCHUPS:Ie,MISSING_PARTICIPANT_COUNT:en,MISSING_PARTICIPANT_ID:Je,MISSING_PARTICIPANT_IDS:tn,MISSING_PARTICIPANT_ROLE:ze,MISSING_PARTICIPANT:Ye,MISSING_PARTICIPANTS:$e,MISSING_PENALTY_ID:vn,MISSING_PENALTY_TYPE:In,MISSING_PERSON_DETAILS:on,MISSING_POLICY_ATTRIBUTES:Se,MISSING_POLICY_DEFINITION:Ue,MISSING_POLICY_TYPE:ye,MISSING_POSITION_ASSIGNMENTS:ie,MISSING_ROUND_NUMBER:"Missing roundNumber",MISSING_SCHEDULE:On,MISSING_SCORING_POLICY:Ae,MISSING_SEED_ASSIGNMENTS:jt,MISSING_SEED_BLOCKS:"Missing seedBlocks",MISSING_SEEDCOUNT_THRESHOLDS:kt,MISSING_SEEDING_POLICY:"Missing seeding policy",MISSING_SET_NUMBER:"Missing setNumber",MISSING_SET_OBJECT:Me,MISSING_SIDE_NUMBER:"Missing sideNumber",MISSING_STAGE:te,MISSING_STRUCTURE_ID:Ht,MISSING_STRUCTURE:Kt,MISSING_STRUCTURES:qt,MISSING_TARGET_LINK:Gt,MISSING_TIE_FORMAT:pe,MISSING_TIME_ITEM:En,MISSING_TIME_ITEMS:Cn,MISSING_TOURNAMENT_ID:gt,MISSING_TOURNAMENT_RECORD:It,MISSING_TOURNAMENT_RECORDS:ht,MISSING_VALUE:Ee,MISSING_VENUE_ID:Dn,MODIFICATIONS_FAILED:Fn,MORE_PARTICIPANTS_THAN_DRAW_POSITIONS:dn,NO_MODIFICATIONS_APPLIED:kn,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:hn,NO_PARTICIPANT_REMOVED:Xe,NO_VALID_ACTIONS:Vn,NO_VALID_ATTRIBUTES:Hn,NO_VALID_DATES:Re,NOT_FOUND:qn,NOT_IMPLEMENTED:Kn,PARTICIPANT_ASSIGNED_DRAW_POSITION:an,PARTICIPANT_ALREADY_CHECKED_IN:rn,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:un,PARTICIPANT_ID_EXISTS:Qe,PARTICIPANT_NOT_CHECKED_IN:nn,PARTICIPANT_NOT_FOUND:Ze,PARTICIPANT_PAIR_EXISTS:"participant pair exists",PENALTY_NOT_FOUND:gn,POLICY_NOT_ATTACHED:Pe,POLICY_NOT_FOUND:Te,SCALE_ITEM_NOT_FOUND:Ln,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Ft,STAGE_SEQUENCE_LIMIT:ne,STRUCTURE_NOT_FOUND:Wt,TEAM_NOT_FOUND:Gn,UNRECOGNIZED_DRAW_TYPE:At,UNRECOGNIZED_MATCHUP_FORMAT:ae,UNRECOGNIZED_MATCHUP_STATUS:re,VALUE_UNCHANGED:Wn,VENUE_EXISTS:Sn},Qn={tournamentId:void 0,tournamentRecords:{},subscriptions:{},notices:[]};const Xn={devContext:void 0,timers:{default:{elapsedTime:0}},deepCopy:!0,deepCopyAttributes:{ignore:[],toJSON:[],stringify:[]}};let ti={setSubscriptions:function({subscriptions:t={}}={}){return"object"!=typeof t?{error:_n}:(Object.keys(t).forEach((e=>{Qn.subscriptions[e]=t[e]})),{...pt})},addNotice:function({topic:t,payload:e,key:n}){if("string"!=typeof t||"object"!=typeof e)return;if(!Qn.subscriptions[t])return;n&&(Qn.notices=Qn.notices.filter((e=>!(e.topic===t&&e.key===n))));Qn.notices.push({topic:t,payload:e,key:n})},getNotices:function({topic:t}){const e=Qn.notices.filter((e=>e.topic===t)).map((t=>t.payload));return e.length&&e},deleteNotices:function(){Qn.notices=[]},getTopics:function(){return{topics:Object.keys(Qn.subscriptions)}},callListener:function({topic:t,notices:e}){const n=Qn.subscriptions[t];n&&"function"==typeof n&&n(e)},getTournamentId:function(){return Qn.tournamentId},getTournamentRecord:function(t){return Qn.tournamentRecords[t]},getTournamentRecords:function(){return Qn.tournamentRecords},setTournamentId:function(t){return Qn.tournamentRecords[t]?(Qn.tournamentId=t,{success:!0}):{error:It}},setTournamentRecord:function(t){const e=null==t?void 0:t.tournamentId;return e?(Qn.tournamentRecords[e]=t,{success:!0}):{error:vt}},setTournamentRecords:function(t){Qn.tournamentRecords=t;const e=Object.keys(t);1===e.length?Qn.tournamentId=e[0]:e.length||(Qn.tournamentId=void 0)},removeTournamentRecord:function(t){if("string"!=typeof t)return{error:_n};if(!Qn.tournamentRecords[t])return{error:qn};delete Qn.tournamentRecords[t];const e=Object.keys(Qn.tournamentRecords);1===e.length?Qn.tournamentId=e[0]:e.length||(Qn.tournamentId=void 0);return{success:!0}}};function ei(t){return t&&"object"==typeof t?"object"==typeof Xn.devContext&&Object.keys(t).every((e=>Xn.devContext[e]===t[e])):Xn.devContext||!1}function ni(t){Xn.devContext=t}function ii(t,e){"boolean"==typeof t&&(Xn.deepCopy=t),"object"==typeof e&&(Array.isArray(e.ignore)&&(Xn.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Xn.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Xn.deepCopyAttributes.stringify=e.stringify))}function ri(t){return ti.addNotice(t)}function ai(t){return ti.getNotices(t)}function oi(){return ti.deleteNotices()}function si(){return ti.getTopics()}async function ci(t){return ti.callListener(t)}function ui(){return ti.getTournamentId()}function di(t){return ti.getTournamentRecord(t)}function li(){return ti.getTournamentRecords()}function pi(t){return ti.setTournamentRecord(t)}function mi(t){return ti.setTournamentRecords(t)}function fi(t){return ti.setTournamentId(t)}function hi(t){return ti.removeTournamentRecord(t)}const Ii=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,vi=/^((0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)([.,][0-9]{3})?$/,gi=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))([ T](0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/,yi=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))?([ T]?(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/;function Ui(t){if("object"!=typeof t||Array.isArray(t))return!1;return"[object Date]"===Object.prototype.toString.call(t)}function wi(t){return Mi(t)||Ii.test(t)}const Si=t=>{const e=Pi(t)||Mi(t)?new Date(t):new Date,n=e.getUTCMonth()+1,i=n<10?`0${n}`:`${n}`;return`${e.getUTCFullYear()}-${_i(i)}-${_i(e.getUTCDate())}`};function Ni(t,e="-",n="YMD"){if(!t)return"";"string"==typeof t&&t.indexOf("T")<0&&(t+="T00:00");const i=new Date(t);let r=""+(i.getMonth()+1),a=""+i.getDate();const o=i.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),"DMY"===n?[a,r,o].join(e):"MDY"===n?[r,a,o].join(e):"YDM"===n?[o,a,r].join(e):"DYM"===n?[a,o,r].join(e):"MYD"===n?[r,o,a].join(e):[o,r,a].join(e)}function Di(t){const e=t?new Date(t):new Date,n=e.getTimezoneOffset();return new Date(e.getTime()-60*n*1e3)}function Pi(t){if("boolean"==typeof t)return!1;const e=t instanceof Date?t:!isNaN(t)&&new Date(t);return e&&!isNaN(e.valueOf())}function Ti(t,e){const n=new Date(t),i=new Date(e);var r,a;const o=[];let s=0;if(!!(Pi(i)&&Pi(n)&&(r=n,a=i,Di(r)<=Di(a)))){const t=Di(n),e=Di(i);for(;t<=e&&s<300;)s+=1,o.push(new Date(t)),t.setDate(t.getDate()+1)}return o}const Ai=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Mi(t){return"string"==typeof t&&Ai.test(t)}function bi(t){if("string"!=typeof t)return!1;const e=t.split("Z")[0].split(":"),n=e.every((t=>!isNaN(t)));return!(e.length<2||!n)&&(!(parseInt(e[0])>23)&&!(parseInt(e[1])>60))}function Ei(t){const e=Ri(t);if(!e)return 0;const[n,i]=e.split(":").map((t=>parseInt(t)));return 60*n+i}function Ci(t){return bi(t)?t.split(":").slice(0,2).map(_i).join(":"):void 0}function Ri(t){return Mi(t)&&t.indexOf("T")>0?Ci(t.split("T").reverse()[0]):Ci(t)}function Oi(t){return Mi(t)||gi.test(t)?t.split("T")[0]:void 0}function xi(t,e){const n=new Date(t);return n.setDate(n.getDate()+e),Oi(n.toISOString())}function Li(t){t="string"!=typeof t?"00:00":t;const e={},n={};return({0:e.time,1:e.ampm}=t.split(" ")||[]),({0:n.hours,1:n.minutes}=e.time.split(":")||[]),n.ampm=e.ampm,isNaN(n.hours)||isNaN(n.minutes)||n.ampm&&!["AM","PM"].includes(n.ampm.toUpperCase())?{}:n}function Fi(t,e){const[n,i]=(t||"00:00").split(":").map(_i),r=Di(e).setHours(n,i,0,0);return Di(r)}function ki(t,e,n=!0){const i=new Date(t),r=(new Date(e).getTime()-i.getTime())/1e3/60;return n?Math.abs(Math.round(r)):Math.round(r)}function ji(t,e){const n=Ri(t);if(!n)return"00:00";const i=isNaN(e)?0:e;return Ri(Bi(Fi(n),i).toISOString())}function Bi(t,e){const n=new Date(t);return new Date(n.getTime()+6e4*e)}function _i(t){return t.toString()[1]?t:"0"+t}function Gi(t,e){const n=new Date(t),i=new Date(e);return n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth()&&n.getDate()===i.getDate()}const Vi={addMinutesToTimeString:ji,convertTime:function(t,e){return e?function(t){const e=Li(t);return e.ampm&&e.hours&&("pm"===e.ampm.toLowerCase()&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),"am"===e.ampm.toLowerCase()&&"12"===e.hours&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(_i).join(":")}(t):function(t){const e=Li(t);return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):"12"===e.hours?e.ampm="PM":"00"===e.hours?(e.hours="12",e.ampm="AM"):e.ampm="AM","0"===e.hours[0]&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}(t)},getUTCdateString:Si,DateHHMM:function(t){const e=new Date(t);return function(t,e){const n=parseInt(t,10),i=Math.floor(n/3600),r=Math.floor((n-3600*i)/60),a=n-3600*i-60*r,o=!e||e&&e.displaySeconds;return(o?i+":"+r+":"+a:i+":"+r).split(":").map(_i).join(":")}(e.getSeconds()+60*e.getMinutes()+3600*e.getHours(),{displaySeconds:!1})},extractDate:Oi,extractTime:Ri,formatDate:Ni,getDateByWeek:function(t,e,n,i=!1){let r=new Date(e,0,1+7*(t-1));const a=i?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Ni(r,n)},isISODateString:Mi,isTimeString:bi,offsetDate:Di,offsetTime:function(t){return Di(t).getTime()},sameDay:Gi,timeStringMinutes:Ei,timeToDate:Fi,timeUTC:function(t){const e=Pi(t)||Mi(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}};function Hi(t,e,n,i){const r={enabled:Xn.deepCopy,...Xn.deepCopyAttributes};if((null==r||!r.enabled)&&!n||"object"!=typeof t||"function"==typeof t||null===t)return t;const a=Array.isArray(t)?[]:{},o=Object.keys(t).filter((t=>!n||!(null!=r&&r.ignore.includes(t))));for(const c of o){const o=t[c];if(e&&"extensions"===c&&Array.isArray(o)){const t=null==(s=o)?void 0:s.map((t=>{const{name:e,value:n}=t;return e&&n&&{[`_${e}`]:n}})).filter(Boolean);Object.assign(a,...t)}else i&&"extensions"===c?a[c]=[]:n&&null!=r&&r.stringify.includes(c)?a[c]="function"==typeof(null==o?void 0:o.toString)?o.toString():JSON.stringify(o):n&&null!=r&&r.toJSON.includes(c)&&"function"==typeof(null==o?void 0:o.toJSON)?a[c]=o.toJSON():null===o?a[c]=void 0:Ui(o)?a[c]=new Date(o).toISOString():a[c]=Hi(o,e,n,i)}var s;return a}function Wi(t,e,n){if("object"!=typeof t||null===t)return t;const i=["",void 0,null];e&&i.push(!1);const r=Object.keys(t).filter((e=>!i.includes(t[e])&&(!n||!Array.isArray(t[e])||t[e].length)));return Object.assign({},...r.map((e=>Array.isArray(t[e])?{[e]:t[e].map((t=>Wi(t)))}:{[e]:Wi(t[e])})))}function qi(t){return Array.isArray(t)?t.length+t.map(qi).reduce(((t,e)=>t+e),0):"object"==typeof t&&null!==t?Object.keys(t).length+Object.keys(t).map((e=>qi(t[e]))).reduce(((t,e)=>t+e),0):0}function Ki(t,e){return t-e}function zi(){const t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);const e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&i|128]+t[i>>8&255]+"-"+t[i>>16&255]+t[i>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function Yi({participantIds:t,matchUpFormat:e,tallyPolicy:n,perPlayer:i,matchUps:r}){const a={};function o(t){a[t]||(a[t]={allDefaults:0,defaults:0,retirements:0,walkovers:0,matchUpsWon:0,matchUpsLost:0,victories:[],defeats:[],matchUpsCancelled:0,setsWon:0,setsLost:0,gamesWon:0,gamesLost:0,pointsWon:0,pointsLost:0})}return r.filter((e=>!(null!=t&&t.length)||2===ct(t,[$i(e,0),$i(e,1)]).length)).forEach((t=>{const{matchUpStatus:i,score:r,winningSide:s}=t,c=s&&function(t){const e=t.winningSide-1;return $i(t,e)}(t),u=s&&function(t){const e=1-(t.winningSide-1);return $i(t,e)}(t);if(!c||!u){const e=$i(t,0),n=$i(t,1);return e&&(o(e),a[e].matchUpsCancelled+=1),void(n&&(o(n),a[n].matchUpsCancelled+=1))}const d=s&&s-1,p=1-d;o(c),o(u),i===x&&(a[u].walkovers+=1),i===T&&(a[u].defaults+=1),i===C&&(a[u].retirements+=1),[T,C,x].includes(i)&&(a[u].allDefaults+=1),a[c].matchUpsWon+=1,a[u].matchUpsLost+=1,a[u].defeats.push(c),a[c].victories.push(u);const m=H({score:r,matchUpStatus:i,matchUpFormat:e,tallyPolicy:n,winningSide:s});a[c].setsWon+=m[d],a[c].setsLost+=m[p],a[u].setsWon+=m[p],a[u].setsLost+=m[d];const f=function({winningSide:t,matchUpFormat:e=y,matchUpStatus:n,tallyPolicy:i,score:r}){var a,o;const{sets:s}=r||{},c=t-1,u=l(e);let d=0,p=0;const m=W((null==u?void 0:u.bestOf)||1),f=(null==u||null===(a=u.setFormat)||void 0===a?void 0:a.setTo)||0,h=(null==u||null===(o=u.setFormat)||void 0===o?void 0:o.tiebreakAt)||0;if(!s)return[d,p];const I=m*f,v=[[],[]];if(n===T&&null!=i&&i.gamesCreditForDefaults||n===x&&null!=i&&i.gamesCreditForWalkovers?v[c].push(I):s&&s.forEach((t=>{({side1Score:d,side2Score:p}=t),v[0].push(parseInt(d||0)),v[1].push(parseInt(p||0))})),n===C){const i=H({winningSide:t,matchUpStatus:n,matchUpFormat:e,sets:s}),r=i.reduce(((t,e)=>t+e),0);if(v.map((t=>t[c]<=t[1-c])).reduce(((t,e)=>t+e),0)>i[1-c]){const t=v[c].length,e=function(t){if(u&&""!==t)return+t==h-1||+t===h?parseInt(h||0)+1:+t<h?f:h}(v[1-c][t-1]);e&&(v[c][t-1]=e)}r>v[c].length&&v[c].push(f)}const g=[v[0].reduce(((t,e)=>t+e),0),v[1].reduce(((t,e)=>t+e),0)];return[C,x,T].includes(n)&&g[c]<I&&(g[c]=I),g}({score:r,matchUpStatus:i,matchUpFormat:e,tallyPolicy:n,winningSide:s});a[c].gamesWon+=f[d],a[c].gamesLost+=f[p],a[u].gamesWon+=f[p],a[u].gamesLost+=f[d];const h=function({score:t}){var e;const n=[0,0];return null==t||null===(e=t.sets)||void 0===e||e.forEach((t=>{t.side1TiebreakScore&&(n[0]+=parseInt(t.side1TiebreakScore)),t.side2TiebreakScore&&(n[1]+=parseInt(t.side2TiebreakScore))})),n}({score:r,tallyPolicy:n});a[c].pointsWon+=h[d],a[c].pointsLost+=h[p],a[u].pointsWon+=h[p],a[u].pointsLost+=h[d]})),function({participantResults:t,matchUpFormat:e,perPlayer:n}){var i;const r=e&&l(e)||{},a=r.bestOf,o=a&&Math.ceil(a/2)||1,s=null===(i=r.setFormat)||void 0===i?void 0:i.setTo;Object.keys(t).forEach((e=>{const i=t[e].setsWon,r=t[e].setsLost,a=n*(o||0)||i;let c=Math.round(i/r*1e3)/1e3;(c===1/0||isNaN(c))&&(c=a);const u=t[e].matchUpsWon,d=t[e].matchUpsLost;let l=Math.round(u/d*1e3)/1e3;(l===1/0||isNaN(l))&&(l=u);const p=t[e].gamesWon||0,m=t[e].gamesLost||0,f=(n||0)*(o||0)*(s||0),h=Math.max(f,p+m);let I=Math.round(p/h*1e3)/1e3;(I===1/0||isNaN(I))&&(I=0);let v=Math.round(t[e].pointsWon/t[e].pointsLost*1e3)/1e3;(v===1/0||isNaN(v))&&(v=0),t[e].setsRatio=c,t[e].matchUpsRatio=l,t[e].gamesRatio=I,t[e].pointsRatio=v,t[e].result=`${t[e].matchUpsWon}/${t[e].matchUpsLost}`,t[e].games=`${t[e].gamesWon}/${t[e].gamesLost}`}))}({participantResults:a,perPlayer:i,matchUpFormat:e}),{participantResults:a}}function $i(t,e){if(!t||!t.sides)return console.log("no sides:",{matchUp:t}),"foo";const n=t.sides[e];return n?n.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Ji(t){return B.includes(null==t?void 0:t.matchUpStatus)||(null==t?void 0:t.winningSide)}const Zi=[{attribute:"matchUpsRatio",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsRatio",idsFilter:!1},{attribute:"gamesRatio",idsFilter:!1},{attribute:"pointsRatio",idsFilter:!1},{attribute:"matchUpsRatio",idsFilter:!0},{attribute:"setsRatio",idsFilter:!0},{attribute:"gamesRatio",idsFilter:!0},{attribute:"pointsRatio",idsFilter:!0}];function Qi(t){const{participantResults:e,subOrderMap:n}=t;if(!function({participantResults:t,participantsCount:e}){let n=er({participantResults:t}).filter((t=>e-1===t.results.matchUpsWon+t.results.matchUpsLost+t.results.matchUpsCancelled));return e===n.length}(t))return;const i=tr({attribute:"matchUpsWon",participantResults:e}),r=Object.keys(i).map((t=>parseFloat(t))).sort(((t,e)=>e-t)).map((t=>i[t])).map((e=>Xi({participantIds:e,...t}))).flat(1/0);let a,o=1;r.forEach(((t,e)=>{e&&(t.resolved||a&&!t.resolved)&&(o+=1),a=t.resolved,t.resolved?(t.position=e+1,o=t.position):t.position=o}));const s=et(r.map((({position:t})=>t)));return r.forEach((t=>{const i=e[t.participantId],r=s[t.position];void 0!==t&&void 0!==t.position&&(r>1&&(i.ties=r,n&&(i.subOrder=n[t.participantId])),t.groupOrder=t.position+(i.subOrder||1)-1,i.rankOrder=t.position),i.GEMscore=function(t){return t.matchUpsRatio*Math.pow(10,16)+t.setsRatio*Math.pow(10,12)+t.gamesRatio*Math.pow(10,8)+t.pointsRatio*Math.pow(10,3)}(i)})),r}function Xi({participantResults:t,disableHeadToHead:e,participantIds:n,matchUpFormat:i,tallyPolicy:r,matchUps:a}){if(1===n.length)return{resolved:!0,participantId:n[0]};if(2===n.length&&(null==r||!r.headToHead||!r.headToHead.disabled&&!e)){const e=function({participantIds:t,participantResults:e}){if(e[t[0]].victories.includes(t[1]))return t.map((t=>({resolved:!0,participantId:t})));if(e[t[1]].victories.includes(t[0]))return t.reverse().map((t=>({resolved:!0,participantId:t})))}({participantIds:n,participantResults:t});if(e)return e}let o;return((null==r?void 0:r.tallyDirectives)||Zi).every((({attribute:t,reversed:e,idsFilter:s,disableHeadToHead:c})=>(o=function({disableHeadToHead:t,participantIds:e,matchUpFormat:n,tallyPolicy:i,attribute:r,idsFilter:a,matchUps:o,reversed:s}){const{participantResults:c}=Yi({participantIds:a&&e,matchUpFormat:n,tallyPolicy:i,matchUps:o}),u=tr({participantResults:c,participantIds:e,attribute:r});if(Object.keys(u).length>1)return Object.keys(u).map((t=>parseFloat(t))).sort(((t,e)=>s?t-e:e-t)).map((t=>u[t])).map((e=>Xi({participantResults:c,disableHeadToHead:t,participantIds:e,matchUpFormat:n,tallyPolicy:i,matchUps:o}))).flat(1/0)}({disableHeadToHead:c,participantIds:n,matchUpFormat:i,tallyPolicy:r,attribute:t,idsFilter:s,matchUps:a,reversed:e}),!o))),o||n.map((t=>({participantId:t})))}function tr({participantResults:t,participantIds:e,attribute:n}){return er({participantResults:t,participantIds:e}).reduce(((t,e)=>{const{participantId:i,results:r}=e,a=r[n];return t[a]?t[a].push(i):t[a]=[i],t}),{})}function er({participantResults:t,participantIds:e}){return(e=e||Object.keys(t)).reduce(((e,n,i)=>(e.push({participantId:n,i:i,results:t[n]}),e)),[])}const nr="roundRobinTally",ir="positionActions",rr="roundNaming",ar="participant",or="scheduling",sr="avoidance",cr="seeding",ur="scoring",dr="draws",lr={POLICY_TYPE_ROUND_ROBIN_TALLY:nr,POLICY_TYPE_POSITION_ACTIONS:ir,POLICY_TYPE_ROUND_NAMING:rr,POLICY_TYPE_PARTICIPANT:ar,POLICY_TYPE_SCHEDULING:or,POLICY_TYPE_AVOIDANCE:sr,POLICY_TYPE_SEEDING:cr,POLICY_TYPE_SCORING:ur,POLICY_TYPE_DRAWS:dr};function pr({policyDefinitions:t,matchUpFormat:e,matchUps:n=[],subOrderMap:i,perPlayer:r}){if(!Array.isArray(n))return{error:Ie};if(1!==n.reduce(((t,{structureId:e})=>t.includes(e)?t:t.concat(e)),[]).length)return{error:_n};const a=n.filter((t=>t&&t.matchUpStatus!==S)),o=a.length&&X(a.map((({drawPositions:t})=>t)).flat()).length,s=a.filter(Ji).length===a.length;s||(r=0);const c=t&&t.roundRobinTally,u=n.filter(Ji),{participantResults:d}=Yi({matchUps:u,matchUpFormat:e,tallyPolicy:c,perPlayer:r}),l=Qi({matchUps:u,participantResults:d,participantsCount:o,matchUpFormat:e,tallyPolicy:c,subOrderMap:i});return s&&l&&l.forEach((t=>{d[t.participantId].groupOrder=t.groupOrder})),{participantResults:d}}const mr="CHECK_IN",fr="CHECK_OUT",hr="SCHEDULE.ASSIGNMENT.COURT",Ir="SCHEDULE.ASSIGNMENT.VENUE",vr="SCHEDULE.DATE",gr="SCHEDULE.TIME.SCHEDULED",yr="SCHEDULE.TIME.START",Ur="SCHEDULE.TIME.STOP",wr="SCHEDULE.TIME.RESUME",Sr="SCHEDULE.TIME.END",Nr="SCALE",Dr="RATING",Pr="RANKING",Tr="SEEDING",Ar="PUBLISH",Mr="PUBLIC",br="HIDDEN",Er="STATUS",Cr={ASSIGN_COURT:hr,ASSIGN_OFFICIAL:"SCHEDULE.ASSIGN.OFFICIAL",ASSIGN_VENUE:Ir,CHECK_IN:mr,CHECK_OUT:fr,END_TIME:Sr,HIDDEN:br,MEDICAL:"MEDICAL",OTHER:"other",PENALTY:"PENALTY",PUBLIC:Mr,PUBLISH:Ar,RANKING:Pr,RATING:Dr,RESUME_TIME:wr,RETRIEVAL:"RETRIEVAL",SCALE:Nr,SCHEDULED_DATE:vr,SCHEDULED_TIME:gr,SEEDING:Tr,START_TIME:yr,STATUS:Er,STOP_TIME:Ur,SUSPENSION:"SUSPENSION"};function Rr(t){if(vi.test(t)){const e=Si();return new Date(`${e}T${t}`)}return new Date(t)}function Or({matchUp:t}){if(!t)return{error:ve};if(!t.timeItems)return{error:Cn};const e=t.timeItems.filter((t=>[yr,Ur,wr,Sr].includes(null==t?void 0:t.itemType))).sort(((t,e)=>Rr(t.itemValue)-Rr(e.itemValue))),n=e.reduce(((t,e)=>{var n,i;let r;const a=null==e||null===(n=e.itemType)||void 0===n?void 0:n.split("."),o=`SCHEDULE.TIME.${(null==e||null===(i=e.itemType)||void 0===i?void 0:i.startsWith("SCHEDULE.TIME"))&&a[2]}`;switch(o){case yr:r=0;break;case Sr:if(t.lastValue&&[yr,wr].includes(t.lastType)){const n=Rr(e.itemValue)-Rr(t.lastValue);r=t.milliseconds+n}else r=t.milliseconds;break;case Ur:if([yr,"SCHECULE.TIME.RESUME"].includes(t.lastType)){const n=Rr(e.itemValue)-Rr(t.lastValue);r=t.milliseconds+n}else r=t.milliseconds;break;default:r=t.milliseconds}return{milliseconds:r,lastType:o,lastValue:e.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([yr,wr].includes(n.lastType)){const t=new Date-Rr(n.lastValue);n.milliseconds+=t}return{milliseconds:n.milliseconds,time:xr(n.milliseconds),relevantTimeItems:e}}function xr(t){const e=(t,e=2)=>("00"+t).slice(-e);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function Lr({categoryName:t,categoryType:e,timesBlockArray:n}){return n.filter((t=>Array.isArray(t))).map((n=>n.sort(((t,e)=>{var n,i;return((null===(n=e.categoryNames)||void 0===n?void 0:n.length)||0)-((null===(i=t.categoryNames)||void 0===i?void 0:i.length)||0)})).find((({categoryTypes:n,categoryNames:i})=>!(null!=i&&i.length)&&!(null!=n&&n.length)||(null==i?void 0:i.includes(t))||(null==n?void 0:n.includes(e)))))).find(Boolean)}function Fr({matchUpAverageTimes:t,matchUpFormat:e}={}){const n=(null==t?void 0:t.map((({matchUpFormatCodes:t})=>null==t?void 0:t.filter((t=>t===e)))).flat().filter(Boolean).sort(((t,e)=>((null==t?void 0:t.length)||0)-((null==e?void 0:e.length)||0))))||[],i=n.includes(e)?e:n[0],r=null==t?void 0:t.find((({matchUpFormatCodes:t,averageTimes:e})=>(null==t?void 0:t.find((t=>i===t)))&&e));return null==r?void 0:r.averageTimes}function kr({matchUpRecoveryTimes:t,averageMinutes:e,matchUpFormat:n}={}){var i;return null==t||null===(i=t.find((({matchUpFormatCodes:t,averageTimes:i,recoveryTimes:r})=>{if(i&&e){const{greaterThan:t=0,lessThan:n=360}=i;if(e>t&&e<n)return!0}return(null==t?void 0:t.find((t=>t===n)))&&r})))||void 0===i?void 0:i.recoveryTimes}const jr="appliedPolicies",Br="delegatedOutcome",_r="disableLinks",Gr="entryProfile",Vr="flightProfile",Hr="groupingAttribute",Wr="lineUps",qr="linkedTournamentsIds",Kr="participantRepresentatives",zr="personRequests",Yr="scheduleLimits",$r="scheduleTiming",Jr="schedulingProfile",Zr="subOrder",Qr="tally",Xr={APPLIED_POLICIES:jr,DELEGATED_OUTCOME:Br,DISABLE_LINKS:_r,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:Gr,FLIGHT_PROFILE:Vr,GROUPING_ATTRIBUTE:Hr,LINEUPS:Wr,LINKED_TOURNAMENTS:qr,PARTICIPANT_REPRESENTATIVES:Kr,PERSON_REQUESTS:zr,SCHEDULE_LIMITS:Yr,SCHEDULE_TIMING:$r,SCHEDULING_PROFILE:Jr,SUB_ORDER:Zr,TALLY:Qr};function ta({tournamentRecord:t}){return na({extensions:(null==t?void 0:t.extensions)||[]})}function ea({event:t}){if(!t)return{error:Yt};return na({extensions:t.extensions||[]})}function na({extensions:t}){const e=t.find((t=>t.name===jr));return{appliedPolicies:(null==e?void 0:e.value)||{}}}function ia({tournamentRecord:t,event:e,policyType:n}){if(!t)return{error:It};if(e){const{appliedPolicies:t}=ea({event:e});if(t&&t[n])return{policy:t[n]}}const{appliedPolicies:i}=ta({tournamentRecord:t});return null!=i&&i[n]?{policy:i[n]}:{error:Te}}function ra({tournamentParticipants:t=[],policyDefinitions:e={},participantId:n,personId:i}){const r=t.find((t=>n&&t.participantId===n||i&&t.person&&t.person.personId===i)),a=null==e?void 0:e.participant;if(null!=a&&a.participant){return Z({template:a.participant,source:r})}return Hi(r)}function aa({tournamentRecord:t,participantId:e}){return{participant:(t.participants||[]).reduce(((t,n)=>n.participantId===e?n:t),void 0)}}function oa({element:t,name:e}){if(!t||!e)return{error:Ee};if(!Array.isArray(t.extensions))return{message:qn};const n=t.extensions.find((t=>(null==t?void 0:t.name)===e));return{extension:n,message:n?void 0:qn}}function sa({tournamentRecord:t,name:e}){return oa({element:t,name:e})}function ca({event:t,name:e}){return t?oa({element:t,name:e}):{error:Yt}}function ua({drawDefinition:t,name:e}){return t?oa({element:t,name:e}):{error:Ut}}function da({tournamentRecord:t,categoryName:e,categoryType:n,event:i}){var r,a,o;e=e||(null==i||null===(r=i.category)||void 0===r?void 0:r.categoryName)||(null==i||null===(a=i.category)||void 0===a?void 0:a.ageCategoryCode),n=n||(null==i||null===(o=i.category)||void 0===o?void 0:o.categoryType);const{policy:s}=ia({policyType:or,tournamentRecord:t,event:i}),{extension:c}=sa({tournamentRecord:t,name:$r}),u=null==c?void 0:c.value,{extension:d}=ca({event:i,name:$r});return{scheduleTiming:{categoryName:e,categoryType:n,eventScheduling:null==d?void 0:d.value,tournamentScheduling:u,policy:s}}}const la="SINGLES",pa="DOUBLES",ma="TEAM",fa={SINGLES:la,DOUBLES:pa,TEAM:ma},ha="total",Ia="SINGLES_DOUBLES",va="DOUBLES_SINGLES",ga={TOTAL:ha,SINGLES_DOUBLES:Ia,DOUBLES_SINGLES:va};function ya({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:n,matchUpFormat:i,categoryName:r,categoryType:a,eventType:o,event:s}){if(!n)return{error:It};o=o||(null==s?void 0:s.eventType);const c={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=da({tournamentRecord:n,categoryName:r,categoryType:a,event:s});return Ua({eventType:o,timingDetails:{...u,matchUpFormat:i,categoryType:a,defaultTiming:c}})}function Ua({eventType:t,timingDetails:e}){const n=function({matchUpFormat:t,categoryName:e,categoryType:n,defaultTiming:i,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;return Lr({categoryName:e,categoryType:n,timesBlockArray:[(null==a?void 0:a.matchUpAverageTimes)&&Fr({...a,matchUpFormat:t}),(null==r?void 0:r.matchUpAverageTimes)&&Fr({...r,matchUpFormat:t}),(null==o?void 0:o.matchUpAverageTimes)&&Fr({...o,matchUpFormat:t}),null==o||null===(s=o.defaultTimes)||void 0===s?void 0:s.averageTimes,null==i?void 0:i.averageTimes]})}(e),i=Object.keys((null==n?void 0:n.minutes)||{}),r=(null==n?void 0:n.minutes)&&((null==i?void 0:i.includes(t))&&n.minutes[t]||n.minutes.default),a=function({matchUpFormat:t,categoryName:e,categoryType:n,averageMinutes:i,defaultTiming:r,tournamentScheduling:a,eventScheduling:o,policy:s}){var c;return Lr({categoryName:e,categoryType:n,timesBlockArray:[(null==o?void 0:o.matchUpRecoveryTimes)&&kr({...o,averageMinutes:i,matchUpFormat:t}),(null==a?void 0:a.matchUpRecoveryTimes)&&kr({...a,averageMinutes:i,matchUpFormat:t}),(null==s?void 0:s.matchUpRecoveryTimes)&&kr({...s,averageMinutes:i,matchUpFormat:t}),null==s||null===(c=s.defaultTimes)||void 0===c?void 0:c.recoveryTimes,null==r?void 0:r.recoveryTimes]})}({...e,averageMinutes:r}),o=Object.keys((null==a?void 0:a.minutes)||{}),s=(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(t))&&a.minutes[t]||a.minutes.default),c=t===la?Ia:va;return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(c))&&a.minutes[c]||s)}}function wa({tournamentRecord:t,eventId:e,drawId:n}){if(!t)return{error:It};const i=(null==t?void 0:t.events)||[];if(n){let t;const e=i.find((e=>{const i=((null==e?void 0:e.drawDefinitions)||[]).find((t=>t.drawId===n));return i&&(t=i),i}));if(e)return{event:e,drawDefinition:t}}if(e){const t=i.find((t=>t.eventId===e));return t?{event:t}:{error:$t}}return{error:Ee}}function Sa({tournamentRecord:t,drawId:e}){if(!t)return{error:It};if(!e)return{error:xt};const n=(t.events||[]).reduce(((t,n)=>{const i=(n.drawDefinitions||[]).reduce(((t,n)=>n.drawId===e?n:t),void 0);return i&&i.drawId===e?{event:n,drawDefinition:i}:t}),void 0);return n?{...n,SUCCESS:pt}:{error:St}}function Na(t,e,n){const i=t=>t.createdAt?new Date(t.createdAt).getTime():0,r=t.filter((t=>t&&t.itemType===e&&(!n||i(t)<n))).sort(((t,e)=>i(t)-i(e))).pop();return r&&r.itemValue}function Da({matchUp:t,visibilityThreshold:e}){return{scheduledTime:Na((null==t?void 0:t.timeItems)||[],gr,e)}}function Pa({matchUp:t,visibilityThreshold:e}){return{scheduledDate:Na((null==t?void 0:t.timeItems)||[],vr,e)}}function Ta({matchUp:t,visibilityThreshold:e}){return{courtId:Na((null==t?void 0:t.timeItems)||[],hr,e)}}function Aa({matchUp:t,visibilityThreshold:e}){return{venueId:Na((null==t?void 0:t.timeItems)||[],Ir,e)}}const Ma="SINGLES",ba="DOUBLES",Ea="TEAM",Ca={SINGLES:Ma,DOUBLES:ba,TEAM:Ea,AGE:"AGE",RATING:"RATING",BOTH:"BOTH"};function Ra({scheduleVisibilityFilters:t,afterRecoveryTimes:e=!0,tournamentRecord:n,scheduleTiming:i,matchUpFormat:r,matchUpType:a,matchUp:o,event:s}){if(!o)return{error:ve};if(!o.matchUpType&&!a&&(s||n)&&o.drawId){var c,u,d,l,p,m;let t=null===(c=s)||void 0===c?void 0:c.drawDefinitions.find((t=>t.drawId===o.drawId));!t&&n&&({drawDefinition:t,event:s}=wa({tournamentRecord:n,drawId:o.drawId}));const e=o.structureId&&(null===(u=t)||void 0===u||null===(d=u.structures)||void 0===d?void 0:d.find((({structureId:t})=>t===o.structureId)));a=(null==e?void 0:e.matchUpType)||(null===(l=t)||void 0===l?void 0:l.matchUpType)||(null===(p=s)||void 0===p?void 0:p.eventType)!==Ea&&(null===(m=s)||void 0===m?void 0:m.eventType)}const{milliseconds:f,time:h}=Or({matchUp:o}),{startTime:I}=function({matchUp:t}){const e=(null==t?void 0:t.timeItems)||[],n=t=>t.createdAt?new Date(t.createdAt).getTime():0,i=e.reduce(((t,e)=>{const i=e.itemType===yr&&e;return i&&(!t||n(i)<n(t))?i:t}),void 0);return{startTime:i&&i.itemValue}}({matchUp:o}),{endTime:v}=function({matchUp:t}){const e=(null==t?void 0:t.timeItems)||[],n=t=>t.createdAt?new Date(t.createdAt).getTime():0,i=e.reduce(((t,e)=>{const i=e.itemType===Sr&&e;return i&&(!t||n(i)>n(t))?i:t}),void 0);return{endTime:i&&i.itemValue}}({matchUp:o});let g;const{visibilityThreshold:y,eventIds:U,drawIds:w}=t||{};if(U&&!U.includes(o.eventId)||w&&!w.includes(o.drawId))g=Wi({time:h,startTime:I,endTime:v,milliseconds:f});else{const t={matchUp:o,visibilityThreshold:y};let{scheduledDate:n}=Pa(t);const{scheduledTime:s}=Da(t),{courtId:c}=Ta(t),{venueId:u}=Aa(t);let d,l,p,m,U;if(null!=i&&i.policy&&s&&e){const t={matchUpFormat:o.matchUpFormat||r,...i};({averageMinutes:l=0,recoveryMinutes:p=0,typeChangeRecoveryMinutes:m=0}=Ua({eventType:o.matchUpType||a,timingDetails:t})),(l||p)&&(d=v?ji(Ri(v),p):ji(s,l+p)),m&&(U=v?ji(Ri(v),m):ji(s,l+m))}!n&&s&&(n=Oi(s)),g=Wi({venueId:u,courtId:c,typeChangeTimeAfterRecovery:U,timeAfterRecovery:d,scheduledDate:n,scheduledTime:s,typeChangeRecoveryMinutes:m,recoveryMinutes:p,averageMinutes:l,milliseconds:f,startTime:I,endTime:v,time:h})}const S=B.includes(o.matchUpStatus),{scheduledDate:N}=Pa({matchUp:o}),{scheduledTime:D}=Da({matchUp:o});return{schedule:g,endDate:S&&(Oi(v)||Oi(N)||Oi(D))||void 0}}function Oa({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find((t=>t.matchUpId===e))}}function xa({sideAdjustments:t=[0,0],separator:e="-",tieFormat:n,matchUp:i}){var r;if(!Array.isArray(t)||2!==t.length||isNaN(t.reduce(((t,e)=>t+e))))return{error:_n};if(!i)return{error:ve};n=i.tieFormat||n;const a=[0,0],o=(null==i?void 0:i.tieMatchUps)||[];((null===(r=n)||void 0===r?void 0:r.collectionDefinitions)||[]).forEach((t=>{const e=o.filter((e=>e.collectionId===t.collectionId));if(t.matchUpValue){const n=t.matchUpValue;e.forEach((t=>{t.winningSide&&(a[t.winningSide-1]+=n)}))}else if(t.collectionValue){const n=[0,0],i=Math.floor(t.matchUpCount/2).floor+1;e.forEach((t=>{t.winningSide&&(n[t.winningSide-1]+=1)}));const r=n.reduce(((t,e)=>e>=i?e+1:t),void 0);r&&(a[r]+=t.collectionValue)}else t.collectionValueProfile&&e.forEach((e=>{if(e.winningSide){const n=e.collectionPosition,i=function({collectionDefinition:t,collectionPosition:e}){const n=(t.collectionValueProfile||[]).find((t=>t.collectionPosition===e));return null==n?void 0:n.matchUpValue}({collectionDefinition:t,collectionPosition:n});a[e.winningSide-1]+=i}}))}));const s=a.map(((e,n)=>e+t[n])),c={side1Score:s[0],side2Score:s[1]},u=s.join(e),d=s.slice().reverse().join(e);let l;if(n){var p;const t=null===(p=n.winCriteria)||void 0===p?void 0:p.valueGoal;if(t){const e=s.map(((t,e)=>({sideNumber:e+1,points:t}))).find((({points:e})=>e>=t));l=null==e?void 0:e.sideNumber}}return{scoreStringSide1:u,scoreStringSide2:d,winningSide:l,set:c}}const La="INDIVIDUAL",Fa="TEAM",ka="PAIR",ja="GROUP",Ba={INDIVIDUAL:La,TEAM:Fa,PAIR:ka,GROUP:ja};const _a=t=>{var e;const{isSide1:n,lowValue:i,setTo:r,tiebreakAt:a,NoAD:o}=t;if(void 0===i)return{error:Ee};let s,c=parseInt(i);(null===(e=c)||void 0===e?void 0:e.toString().length)>2&&(c=parseInt(c.toString().slice(0,2))),a&&a<r&&c>a&&(c=a),s=o&&!a?c<r?r:r-1:c+1<r||a&&a<r&&c===a?r:a?r+1:c+2;return[n?c:s,n?s:c]},Ga=t=>{var e;const{isSide1:n,lowValue:i,tiebreakTo:r,tiebreakNoAd:a}=t;if(void 0===i)return{error:Ee};let o=parseInt(i);(null===(e=o)||void 0===e?void 0:e.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),a&&o>r-1&&(o=r-1);const s=function(t){const{lowValue:e,NoAD:n,tiebreakTo:i}=t,r=n?1:2;if(e+1>=i)return e+r;return i}({lowValue:o,NoAD:a,tiebreakTo:r});return[n?o:s,n?s:o]};function Va({checkCollectionIds:t=!0,tieFormat:e}={}){const n=[];if("object"!=typeof e)return n.push("tieformat must be an object"),{error:ce,errors:n};if("object"!=typeof e.winCriteria)return n.push("tieFormat.winCriteria must be an object"),{error:ce,errors:n};if(!Array.isArray(e.collectionDefinitions))return n.push("tieFormat.collectionDefinitiosn must be an array of objects"),{error:ce,errors:n};const i="number"==typeof e.winCriteria.valueGoal&&e.winCriteria.valueGoal>0;i||n.push("Non-zero valueGoal must be specified in winCriteria");const r=e.collectionDefinitions.every((e=>{if("object"!=typeof e)return n.push(`collectionDefinition must be an object: ${e}`),!1;const{collectionValueProfile:i,collectionGroupNumber:r,collectionValue:a,collectionId:o,matchUpCount:s,matchUpFormat:c,matchUpValue:u,matchUpType:d}=e;if(t&&"string"!=typeof o)return n.push(`collectionId is not type string: ${o}`),!1;if("number"!=typeof s)return n.push(`matchUpCount is not type number: ${s}`),!1;if(![la,pa].includes(d))return n.push(`matchUpType must be SINGLES or DOUBLES: ${d}`),!1;if(!u&&!a&&!i)return n.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfile"),!1;if(u&&"number"!=typeof u)return n.push(`matchUpValue is not type number: ${u}`),!1;if(a&&"number"!=typeof a)return n.push(`collectionValue is not type number: ${a}`),!1;if(i){if(!Array.isArray(i))return n.push(`collectionValueProfile is not an array: ${i}`),!1;if(i.length!==s)return n.push("collectionValueProfile does not align with matchUpsCount"),!1;for(const e of i){if("object"!=typeof e)return n.push(`valueProfile is not type object: ${e}`),!1;const{value:t,collectionPosition:i}=e;if("number"!=typeof t||"number"!=typeof i||i>s||i<1)return n.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),!1}const t=i.map((t=>t.collectionPosition));if(t.length!==X(t).length)return n.push("collectionPositions are not unique"),!1}return r&&"number"!=typeof r?(n.push(`collectionValue is not type number: ${a}`),!1):!(c&&!g.isValid(c))||(n.push(`Invalid matchUpFormat: ${c}`),!1)})),a=e.collectionDefinitions.map((({collectionId:t})=>t)),o=!t||a.length===X(a).length,s=r&&i&&o,c={valid:s,errors:n};return s||(c.error=ce),c}function Ha({analysis:t,set:e}){const n=qa({set:e}),{isDecidingSet:i,isTiebreakSet:r,matchUpScoringFormat:a}=t;return Wa({matchUpScoringFormat:a,isDecidingSet:i,isTiebreakSet:r,set:e})&&n}function Wa({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:n,isTiebreakSet:i,isDecidingSet:r,set:a}){var o;if(!a)return{error:Ee};e=e||n;const s=r&&e.finalSetFormat||(null===(o=e)||void 0===o?void 0:o.setFormat),{side1Score:c,side2Score:u}=a,{NoAD:d,setTo:l,tiebreakAt:p,tiebreakFormat:m}=s,f=null==m?void 0:m.NoAd,h=qa({set:a}),I=Math.abs(c-u),v=c>=l||u>=l,g=i||c>=l&&u>=l||p&&p<l&&(c===p||u===p),y=t||g&&(1===h&&a.side1TiebreakScore>a.side2TiebreakScore||2===h&&a.side2TiebreakScore>a.side1TiebreakScore);return(v&&(I>=(d||g&&(p&&!i||i&&f)?1:2)||g)||i)&&(!g||y)}function qa({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}const Ka=" ",za="DEF",Ya=["RET",za,"WO","WO/WO","ABN","SUS","INT"],$a="DEFAULTED",Ja="WALKOVER",Za="ABANDONED",Qa="SUSPENDED",Xa="RETIRED",to="INTERRUPTED",eo=[Xa,$a,Ja],no="()",io="[]",ro=["up","left","shift+tab"],ao=["enter","down","tab","right"],oo="backspace",so=["r","d","w","a","s","i"],co="space",uo=["[","("],lo=[...ro,...ao,co,"]"],po="-",mo="-",fo=["/"],ho=["0","1","2","3","4","5","6","7","8","9"].concat(so),Io=ho.map((t=>`shift+${t}`)),vo=[po,oo].concat(lo,fo),go=[ho,Io,vo].join(","),yo=[go,ro,ao,["=","+","num_1","num_2","shift+=","shift+-"]].join(",");[].concat(...ho,...ho,...vo,...ho,...ho,...ho,...ho,...ho,...ho);const Uo={SIDE1KEYS:ho,SIDE2KEYS:Io,MODIFIERS:vo,PROMPT:"Enter Score",MOVEUP:ro,MOVEDOWN:ao,HOTKEYS:yo};function wo({scoreString:t,lowSide:e,outcome:n}){if(({scoreString:t}=So({scoreString:t})),2===e){return t+((t&&t[t.length-1])!==Ka?Ka:"")+n}return n+Ka+t}function So({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(const i of Ya){var n;const r=null===(n=t)||void 0===n?void 0:n.indexOf(i);0===r?t=t.slice(i.length+1).trim()+Ka:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t&&t.trim()||(t=""),{scoreString:t,removed:e}}function No({analysis:t,scoreString:e,sets:n,lowSide:i}){let r,a;if(!e)return{scoreString:e,sets:n};const{scoreString:o,removed:s}=So({scoreString:e});if(e=o,s)return{scoreString:e,sets:n,outcomeRemoved:!0};let c=n[n.length-1]||{};const u=Object.values(c).filter((t=>void 0!==t)).length;c.setNumber&&1===u&&(c=(n=n.slice(0,n.length-1))[n.length-1]||{});const{tiebreakSet:d}=t.setFormat,{tiebreakTo:l,NoAD:p}=d||{},{isTiebreakEntry:m}=Do({scoreString:e,brackets:io}),f=function(t){const e=t.split("");return e.reduce(((t,e,n)=>(e.match(/\d+/g)&&t.push(n),t)),[]).pop()}(e);if(f>=0){r=e.slice(0,f);const{isTiebreakEntry:o}=Do({scoreString:r,brackets:no}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=Do({scoreString:r,brackets:io}),d=r&&r[r.length-1].trim(),S=r&&!isNaN(d);let N=t.isIncompleteSetScore;if(m&&u){const t=r.slice(s+1).split(mo),n=(null==t?void 0:t.length)>0&&void 0!==t[0]&&!isNaN(parseInt(t[0]))&&parseInt(t[0])||void 0,a=(null==t?void 0:t.length)>1&&void 0!==t[1]&&parseInt(t[1])||void 0,o=[n,a];if(a){const t=1===i?1:0;o[t]=o[1-t]+(p?1:2),o[t]<l&&(o[t]=l),r=e.slice(0,s+1),r+=o.join(mo)}else void 0!==n?(r=e.slice(0,s+1),r+=n):(r=e.slice(0,s),N=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(r.length||(r=void 0),N){var h;const e=null===(h=c.side1Score)||void 0===h?void 0:h.toString();if(e){const t=null==e?void 0:e.slice(0,e.length-1);c.side1Score=!isNaN(t)&&parseInt(t)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}var I,v;if(t.isTimedSet)a=c.side1Score?n:(null===(I=n)||void 0===I?void 0:I.slice(0,n.length-1))||[],a[n.length-1]=c;else a=(null===(v=n)||void 0===v?void 0:v.slice(0,n.length-1))||[]}else if(S){var g,y;const e=null===(g=c.side2Score)||void 0===g?void 0:g.toString(),i=null===(y=c.side1Score)||void 0===y?void 0:y.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(c.side2Score){const t=null==e?void 0:e.slice(0,e.length-1);c.side2Score=!isNaN(t)&&parseInt(t)||void 0}else{const t=null==i?void 0:i.slice(0,i.length-1);c.side1Score=!isNaN(t)&&parseInt(t)||void 0}var U;if(t.isTimedSet)if(c.side1Score)a=n||[],a[n.length-1]=c;else a=(null===(U=n)||void 0===U?void 0:U.slice(0,n.length-1))||[];else a=n||[],a[n.length-1]=c;a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else if(o)a=n||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0});else{var w;if(m&&!u)a=(null===(w=n)||void 0===w?void 0:w.slice(0,n.length-1))||[];else a=n,a[n.length-1]=c;m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0)}return{scoreString:r,sets:a}}return{scoreString:e,sets:n}}function Do({scoreString:t,brackets:e="()"}){if(!t)return!1;const[n,i]=e.split(""),r=t.split(""),a=Math.max(...st(n,r));return{isTiebreakEntry:a>Math.max(...st(i,r)),lastOpenBracketIndex:a}}function Po({lowValue:t=0,NoAD:e=!1,tiebreakTo:n}={}){if(t+1>=n)return t+(e?1:2);return parseInt(n)}function To({matchUpFormat:t,matchUpStatus:e,winningSide:n,sets:i}){const r=l(t),{bestOf:a}=r,o=Math.ceil(a/2),s=i&&i.reduce(((t,e)=>{const{winningSide:n}=e;return n&&t[n-1]++,t}),[0,0]);let c=(null==s?void 0:s.indexOf(o))+1||void 0;return eo.includes(e)&&n&&(c=n),{matchUpWinningSide:c}}function Ao({lowSide:t,value:e,sets:n,scoreString:i,winningSide:r,matchUpStatus:a}){let o;return"r"===e?i?(o=!0,i=wo({scoreString:i,lowSide:t,outcome:"RET"}),r=2===t?1:2,a=Xa):(o=!0,i=wo({scoreString:i,lowSide:t,outcome:za}),r=2===t?1:2,a=$a):"d"===e?(o=!0,i=wo({scoreString:i,lowSide:t,outcome:za}),r=2===t?1:2,a=$a):"w"===e?(o=!0,n=[],i="WO",r=2===t?1:2,a=Ja):"s"===e&&i?(o=!0,i=wo({scoreString:i,lowSide:t,outcome:"SUS"}),a=Qa,r=void 0):"a"===e?(o=!0,i=wo({scoreString:i,lowSide:t,outcome:"ABN"}),a=Za,r=void 0):"i"===e&&i&&(o=!0,i=wo({scoreString:i,lowSide:t,outcome:"INT"}),a=to,r=void 0),{updated:o,sets:n,scoreString:i,matchUpStatus:a,winningSide:r}}function Mo({sets:t,scoreString:e,winningSide:n,matchUpFormat:i,value:r}){var a,o;const s=((null==t||null===(a=t.filter((t=>null==t?void 0:t.winningSide)))||void 0===a?void 0:a.length)||0)+(n?0:1),c=l(i),u=s===(null==c?void 0:c.bestOf),d=u&&c.finalSetFormat||c.setFormat||{},p=(null==d?void 0:d.timed)||c.timed,m=u&&t[(null==c?void 0:c.bestOf)-1],f=m&&m.winningSide,{isTiebreakEntry:h}=Do({scoreString:e,brackets:no}),{isTiebreakEntry:I}=Do({scoreString:e,brackets:io}),v=h||I,g=!!d.tiebreakSet,y=e&&e[e.length-1].trim(),U=e&&!isNaN(y),w=!v&&y===po,S=h&&uo.includes(y),N=I&&uo.includes(y),D=I&&y===mo,P=e&&e.split(""),[T]=io.split(""),A=P&&Math.max(...st(T,P)),M=P&&Math.max(...st(mo,P)),b=P&&M>A,E=null===(o=t[t.length-1])||void 0===o?void 0:o.winningSide,C=(null==t?void 0:t.length)&&!E,R=Ya.find((t=>(null==e?void 0:e.indexOf(t))>=0)),O=!isNaN(r),x=r===co,L=lo.includes(r),F=null==e?void 0:e.split("").find((t=>uo.includes(t)));return{isTiebreakSetValue:g&&O,matchUpScoringFormat:c,setNumber:s,setFormat:d,matchTiebreakHasJoiner:b,isGameScoreEntry:C,isSpace:x,isCloser:L,isTiebreakCloser:L&&F&&v&&U,isDecidingSet:u,isTiebreakSet:g,isTimedSet:p,isNumericEnding:U,isNumericValue:O,hasOpener:F,hasOutcome:R,finalSet:m,finalSetIsComplete:f,lastSetIsComplete:E,isInvalidSetTiebreakValue:x&&v&&S,isInvalidMatchTiebreakValue:L&&I&&!N&&(D||!function({scoreString:t}){if(!t)return!1;const e=t&&t[t.length-1].trim(),n=t&&!isNaN(e),[i,r]=io.split(""),a=t.split(""),o=Math.max(...st(i,a)),s=Math.max(...st(r,a)),c=Math.max(...st(mo,a));return n&&o>s&&c>o}({scoreString:e})),isTiebreakEntry:v,isSetTiebreakEntry:h,isMatchTiebreakEntry:I,isIncompleteSetScore:w,isIncompleteSetTiebreak:S,isIncompleteMatchTiebreak:N,isPartialMatchTiebreakValue:D}}function bo(t){const{sets:e,winningSide:n,autoComplete:i,matchUpStatus:r,reversed:a=!1,winnerFirst:o=!0,addOutcomeString:s}=t;if(!e)return{error:Ee};const c=a||!(!o||!n||1===n),u=s?function({matchUpStatus:t}){const e={[C]:"RET",[x]:"WO",[A]:"WO/WO",[R]:"SUS",[U]:"ABN",[T]:"DEF",[P]:"DR"};return t&&e[t]||""}({matchUpStatus:r}):"",d=(null==e?void 0:e.sort(Eo).map((function(t){const e=(d=t,!(z(null==d?void 0:d.side1Score)||z(null==d?void 0:d.side2Score))&&(t=>z(null==t?void 0:t.side1TiebreakScore)||z(null==t?void 0:t.side2TiebreakScore))(t)),{side1Score:n,side2Score:r,side1TiebreakScore:a,side2TiebreakScore:o}=t,s=a||(z(a)||i?0:""),u=o||(z(o)||i?0:"");var d;if(e){return`[${(c?[u,s]:[s,u]).join("-")}]`}const l=Math.min(s,u),p=l?`(${l})`:"",m=n||(z(n)||i?0:""),f=r||(z(r)||i?0:"");let h=c?`${[f,m].join("-")}${p}`:`${[m,f].join("-")}${p}`;["-"," "].includes(h)&&(h="");return h})).filter(Boolean).join(" "))||"";return u?2===n?`${u} ${d}`:`${d} ${u}`:d}function Eo(t,e){return t.setNumber-e.setNumber}function Co({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:n,setObject:i}){if(!i)return;const r=Ro({set:i});return function({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:n,isTiebreakSet:i,isDecidingSet:r,set:a}){var o;if(!a)return{error:Ee};e=e||n;const s=r&&e.finalSetFormat||(null===(o=e)||void 0===o?void 0:o.setFormat)||{},{side1Score:c,side2Score:u}=a,{setTo:d,tiebreakAt:l,tiebreakFormat:p}=s,m=null==p?void 0:p.NoAd,f=Ro({set:a}),h=Math.abs(c-u),I=c>=d||u>=d,v=i||c>=d&&u>=d||l&&l<d&&(c===l||u===l),g=t||v&&(1===f&&a.side1TiebreakScore>a.side2TiebreakScore||2===f&&a.side2TiebreakScore>a.side1TiebreakScore),y=h>=(v&&(l&&!i||i&&m)?1:2);return(I&&(y||v)||i)&&(!v||g)}({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:n,set:i})&&r||void 0}function Ro({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function Oo(t){const{setObject:e,matchUpScoringFormat:n}=t;if(!e)return{error:Me};const{setNumber:i}=e||{},{bestOf:r}=n||{},a=!(!i||i!==r),o=a&&(null==n?void 0:n.finalSetFormat)||(null==n?void 0:n.setFormat),s=!(null==o||!o.tiebreakSet),c=!(null==o||!o.timed),u=!s&&!c,d=!!(i&&r&&i<=r),l=[null==e?void 0:e.side1Score,null==e?void 0:e.side2Score],p=[null==e?void 0:e.side1PointScore,null==e?void 0:e.side2PointScore],m=[null==e?void 0:e.side1TiebreakScore,null==e?void 0:e.side2TiebreakScore],f=l.filter((t=>void 0!==t)).length,h=p.filter((t=>void 0!==t)).length,I=m.filter((t=>void 0!==t)).length,v=null==l?void 0:l.filter((t=>!isNaN(t))).length,g=null==m?void 0:m.filter((t=>!isNaN(t))).length,{tiebreakAt:y}=o||{},U=y&&2===l.filter((t=>t>=y)).length,w=U&&(l[0]>l[1]?1:l[1]>l[0]?2:void 0),S=!(!g||v),N=!(!e||null==e||!e.winningSide),{error:D,result:P}=function({setObject:t,setFormat:e,sideGameScores:n,sideTiebreakScores:i}){if(!t)return{result:!1,error:Me};const r=!(null==e||!e.tiebreakSet),a=!(null==e||!e.timed);if(!e||r||a)return{result:!1,error:"not standard set"};if(2!==(null==n?void 0:n.filter((t=>!isNaN(t))).length))return{result:!1,error:Be};const{setTo:o,tiebreakAt:s,tiebreakFormat:c,NoAD:u}=e||{};if(!o||null==n||!n.find((t=>t>=o)))return{result:!1,error:Be};const d=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!d)return{result:!1,error:_e};const l=(null==t?void 0:t.winningSide)-1,p=1-l,m=n[l],f=n[p],h=m-f;if(!(m>f))return{result:!1,error:"winningSide game scoreString is not high"};const I=s&&c,v=2===(null==i?void 0:i.filter((t=>!isNaN(t))).length),g=i&&i[l],y=i&&i[p],U=s&&2===n.filter((t=>t>=s)).length;if(I){const{NoAD:t,tiebreakTo:e}=c;if(U){if(h>1)return{result:!1,error:"invalid winning game scoreString (5)"};if(!v)return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(e))return{result:!1,error:"tiebreakTo error"};if(!!(!e||null==i||!i.find((t=>t>=e))))return{result:!1,error:"invalid tiebreak scores (2)"};if(m>(s<o?o:o+1))return{result:!1,error:"invalid winning game scoreString (1)"};if(!g||!y||g<y)return{result:!1,error:"winningSide tiebreak value is not high"};const n=t?1:2,r=g-y,a=y>=e-1;if(r&&a&&r<n)return{result:!1,error:"invalid tiebreak scores (3)"}}if(m>o&&(!I||!U))return{result:!1,error:"invalid winning game scoreString (2)"}}const w=u?1:2,S=f>=o-1;if(h&&S&&!U&&h<w)return{result:!1,error:"invalid winning game scoreString (3)"};if(h>w&&m>o)return{result:!1,error:"invalid winning game scoreString (4)"};return{result:!0}}({setObject:e,setFormat:o,sideGameScores:l,sideTiebreakScores:m}),{error:T,result:A}=function({setObject:t,setFormat:e,sideTiebreakScores:n}){if(!t)return{result:!1,error:Me};const i=!(null==e||!e.tiebreakSet),r=!(null==e||!e.timed);if(!e||!i||r)return{result:!1,error:"not tiebreak set"};const a=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!a)return{result:!1,error:_e};const{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:c}=o||{};if(2!==(null==n?void 0:n.filter((t=>!isNaN(t))).length))return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(c))return{result:!1,error:"tiebreakTo error"};if(null==n||!n.find((t=>t>=c)))return{result:!1,error:"invalid tiebreak scores (2)"};const u=(null==t?void 0:t.winningSide)-1,d=1-u,l=n[u],p=n[d];if(!l||!p||l<p)return{result:!1,error:"winningSide tiebreak value is not high"};const m=s?1:2,f=l-p,h=p>=c-1;if(f&&h&&f<m)return{result:!1,error:"invalid tiebreak scores (3)"};return{result:!0}}({setObject:e,setFormat:o,sideTiebreakScores:m}),M=u&&!S&&P||s&&S&&A,b={expectTiebreakSet:s,expectTimedSet:c,hasTiebreakCondition:U,isCompletedSet:N,isDecidingSet:a,isTiebreakSet:S,isValidSet:d&&!(s&&!S)&&!(u&&S)&&(!N||M),isValidSetNumber:d,isValidSetOutcome:M,leadingSide:w,setFormat:o,sideGameScores:l,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:h,sideTiebreakScores:m,sideTiebreakScoresCount:I,winningSide:Co({isDecidingSet:a,isTiebreakSet:S,matchUpScoringFormat:n,setObject:e})};return void 0!==(null==e?void 0:e.winningSide)&&(S?(b.isValidTiebreakSetOutcome=A,A||(b.tiebreakSetError=T)):(b.isValidStandardSetOutcome=P,P||(b.standardSetError=D))),b}function xo(t){var e;const{matchUp:n,sideNumber:i,setNumber:r,isTiebreakValue:a,isPointValue:o}=t||{};let{matchUpFormat:s}=t||{};if(!n)return{error:ve};s=s||(null==n?void 0:n.matchUpFormat);const c=l(s),u=!(null==n||!n.winningSide),d=null===(e=n.score)||void 0===e?void 0:e.sets,p=null==d?void 0:d.length,m=r&&r-1,f=!(null==d||!d.find(((t,e)=>t.setNumber===r&&e===m))),h=(null==d?void 0:d.filter((t=>null==t?void 0:t.winningSide)))||[],I=(null==h?void 0:h.length)||0,v=r&&(null==d?void 0:d.slice(r))||[],g=!!(p&&r&&null!=v&&v.reduce(((t,e)=>(!e||!e.side1Score&&!e.side2Score&&!e.side1TiebreakScore&&!e.side2TiebreakScore&&!e.side1PointScore&&!e.side2PointScore)&&t),!0)),y=r<=p&&d.find((t=>t.setNumber===r)),U=y&&Oo({setObject:y,matchUpScoringFormat:c}),{isCompletedSet:w,sideGameScores:S,sideTiebreakScores:N}=U||{},D=!!(y&&!w&&g||r&&r===p+1&&!u),P=[1,2].includes(i),T=P?i-1:0,A=y&&P&&(!a&&!o&&void 0!==S[T]&&S[T]||a&&void 0!==N[T]&&N[T]),M=!!A,b=h&&h.map((t=>Oo({setObject:t,matchUpScoringFormat:c}).isValidSetOutcome)).reduce(((t,e)=>t&&e),!0),E=h.reduce(((t,e)=>{const{winningSide:n}=e;return t[n-1]++,t}),[0,0]),C=null==n?void 0:n.winningSide,R=C&&C-1,O=1-R,x=E[R],L=E[O],F=Math.max(...E),k=et(E)[F],{bestOf:j}=c||{},B=F===(j&&Math.ceil(j/2)||1)&&1===k&&E.indexOf(F)+1||void 0,_=x>L&&C===B;return{isActiveSet:D,isExistingSet:f,existingValue:A,hasExistingValue:M,isValidSideNumber:P,completedSetsCount:I,isCompletedMatchUp:u,isLastSetWithValues:g,validMatchUpOutcome:B&&b&&_,matchUpScoringFormat:c,calculatedWinningSide:B,validMatchUpWinningSide:_,completedSetsHaveValidOutcomes:b,...U}}const Lo={stringifyMatchUpFormat:o,isValidMatchUpFormat:v,parseMatchUpFormat:l,generateTieMatchUpScore:xa,tallyParticipantResults:pr,getTiebreakComplement:Ga,generateScoreString:bo,checkSetIsComplete:Wa,validateTieFormat:Va,getSetComplement:_a,analyzeMatchUp:xo,keyValueScore:function(t){let{lowSide:e=1,value:n}=t,{scoreString:i,sets:r,winningSide:a,matchUpStatus:o}=t;const{matchUpFormat:s,shiftFirst:c,auto:u=!0}=t;let d,l;const p=c&&2===e||!c&&1===e;if(!go.includes(n))return{updated:!1,message:"invalid key"};c&&(e=3-e);const{matchUpWinningSide:m}=To({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;const f=Mo({value:n,winningSide:a,scoreString:i,sets:r,matchUpFormat:s});if(fo.includes(n)&&(n=po),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===parseInt(n)&&(f.isTiebreakCloser=!0),lo.includes(n)&&f.hasOpener&&(n=""),lo.includes(n)&&(n=co),f.lastSetIsComplete){var h;const t=(null===(h=i)||void 0===h?void 0:h.length)&&i[i.length-1];i&&" "!==t&&(i+=" ")}if(f.isTimedSet)({message:l,sets:r,scoreString:i,updated:d,matchUpStatus:o,winningSide:a}=function({analysis:t,lowSide:e,scoreString:n,sets:i,winningSide:r,matchUpStatus:a,message:o,value:s}){var c;let u,d;null!==(c=i)&&void 0!==c&&c.length||s===oo||(i=[{setNumber:1}]);const l=i.length-1;if(so.includes(s)){const c=i[i.length-1]||{},{side1Score:d,side2Score:l}=c;d&&!l?o="missing side2Score":t.finalSetIsComplete||r?o="final set is already complete":t.isIncompleteSetScore?o="incomplete set scoreString":t.isIncompleteSetScore||({sets:i,scoreString:n,winningSide:r,matchUpStatus:a,updated:u}=Ao({lowSide:e,value:s,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(s===oo){var p;if(({scoreString:n,sets:i,outcomeRemoved:d}=No({analysis:t,scoreString:n,sets:i})),""===(null===(p=n)||void 0===p?void 0:p.trim())&&(n=n.trim()),n||(i=[]),d){const t=i[i.length-1]||{},{side1Score:e,side2Score:n}=t;if(e&&n){const r=e>n?1:n>e?2:void 0;r&&(t.winningSide=r,i.push({setNumber:i.length+1}))}}a=void 0,r=void 0,u=!0}else if(t.hasOutcome)o="has outcome";else{if(r)return{sets:i,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,message:"matchUp is complete"};if(s===co){const e=i[i.length-1]||{},{side1Score:a,side2Score:o}=e,s=a>o?1:o>a?2:void 0;!s||r||t.isIncompleteSetScore||(i[i.length-1].winningSide=s,i.push({setNumber:i.length+1}),n+=" ",u=!0)}else if(s===po&&void 0!==i[l].side1Score&&void 0===i[l].side2Score&&n&&t.isNumericEnding)n+="-",i[l].side2Score=0,a=void 0,r=void 0,u=!0;else if(!isNaN(s)){let t;if(void 0===i[l].side2Score){const e=parseInt((i[l].side1Score||0).toString()+s).toString().slice(0,2);i[l].side1Score=parseInt(e),t=i[l].side1Score.toString(),u=!0}else{const e=parseInt((i[l].side2Score||0).toString()+s).toString().slice(0,2);i[l].side2Score=parseInt(e),t=[i[l].side1Score,i[l].side2Score].join("-"),u=!0}if(u){const e=(i.slice(0,l)||[]).filter((t=>t)).map((t=>{const{side1Score:e,side2Score:n}=t;return[e,n].join("-")})).join(" ");n=e?e+" "+t:t}}}return{sets:i,scoreString:n,winningSide:r,matchUpStatus:a,message:o,updated:u}}({analysis:f,lowSide:e,scoreString:i,sets:r,matchUpStatus:o,winningSide:a,value:n}));else if(so.includes(n))f.finalSetIsComplete||a?l="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?l="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:n}):({sets:r,scoreString:i,matchUpStatus:o,winningSide:a,updated:d}=Ao({lowSide:e,sets:r,scoreString:i,matchUpStatus:o,winningSide:a,value:n}));else if(n===oo)d=!0,({scoreString:i,sets:r}=No({analysis:f,scoreString:i,sets:r,lowSide:e,auto:u})),i||(r=[]),o=void 0,a=void 0;else if(f.hasOutcome)l="has outcome";else if(n!==po||f.isMatchTiebreakEntry)if(n===mo&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?l="existing joiner":f.isNumericEnding&&(d=!0,i+=mo);else if([po,mo].includes(n))l="invalid location for joiner";else{if(a)return{updated:!1,message:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:i,updated:d}=function({analysis:t,scoreString:e,sets:n,value:i}){let r;if(null==n||!n.length)return{sets:[]};const a=n[n.length-1];i=parseInt(i);const{validSide2Score:o,requiresTiebreak:s}=function({analysis:t,set:e={},value:n}){const i=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=i,{side1Score:s}=e;let c,u;return c=r&&r<a?s===r?n<=a:n<=r:s===a?o?n<a:n<=a+1:s===a-1?o?n<=a:n<=a+1:s===a+1?n===a||n===a-1:n<=a,c&&(u=r&&r<a?s===a&&n===r||s===r&&n===a:s>=a&&n>=a&&s!==n),{validSide2Score:c,requiresTiebreak:u}}({analysis:t,set:a,value:i});if(o){r=!0,e=(e||"")+i,a.side2Score=i;const o=Ha({analysis:t,set:n[n.length-1]});a.winningSide=o||void 0,s?e+=no.split("")[0]:t.isDecidingSet||(e+=Ka)}return{sets:n,scoreString:e,updated:r}}({analysis:f,scoreString:i,sets:r,value:n}));else if(f.isInvalidMatchTiebreakValue)l="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)l="invalid set tiebreak character";else if(f.isTiebreakCloser){const t=f.isSetTiebreakEntry?no:io,e=t.split("").reverse()[0],n=t.split("")[0],a=r[r.length-1],{tiebreakFormat:o}=f.setFormat,{tiebreakTo:s,NoAD:c}=o||{},u=qa({set:a});if(!f.isTiebreakSet){const t=parseInt(i.split(n).reverse()[0]),e=Po({lowValue:t,tiebreakTo:s,NoAD:c});1===u?(a.side1TiebreakScore=e,a.side2TiebreakScore=t):(a.side1TiebreakScore=t,a.side2TiebreakScore=e)}i=(i||"")+e,f.isDecidingSet||(i+=Ka);const l=Ha({analysis:f,set:a});a.winningSide=l||void 0,d=!0}else if(f.isTiebreakSetValue)({message:l,scoreString:i,sets:r,updated:d}=function({analysis:t,auto:e,lowSide:n,scoreString:i="",sets:r,value:a}){let o,s;const{tiebreakSet:{tiebreakTo:c,NoAD:u}}=t.setFormat,[d]=io.split("");if(t.isMatchTiebreakEntry||(i+=d),r[t.setNumber-1]){var l;const{lastOpenBracketIndex:t}=Do({scoreString:i,brackets:io}),d=(i.slice(t+1)+(e?"":a)).split(mo);if(((null===(l=d[n-1])||void 0===l?void 0:l.length)||0)>=2)s="tiebreak digit limit";else if(e){1===n&&(d[0]=(d[0]||"")+a),2===n&&(d[1]=(d[1]||"")+a);const e=[d[0]||0,d[1]||0].map((t=>parseInt(t))),s=1===n?1:0;e[s]=e[1-s]+(u?1:2),e[s]<c&&(e[s]=c);const l=r[r.length-1];l.side1TiebreakScore=e[0],l.side2TiebreakScore=e[1],i=i.slice(0,t+1),i+=e.join(mo),o=!0}else{const t=[d[0]||0,d[1]||0].map((t=>parseInt(t))),e=r[r.length-1];e.side1TiebreakScore=t[0],e.side2TiebreakScore=t[1],i+=a,o=!0}}else{const t=Po({lowValue:parseInt(a||0),tiebreakTo:c,NoAD:u}),e=[parseInt(a),t];2===n&&e.reverse();const s={side1TiebreakScore:e[0],side2TiebreakScore:e[1],setNumber:(null==r?void 0:r.length)+1||1};r.push(s),i+=e.join(mo),o=!0}return{message:s,scoreString:i,sets:r,updated:o}}({analysis:f,auto:u,lowSide:e,scoreString:i,sets:r,value:n}));else if(f.isSetTiebreakEntry){const[t]=no.split(""),e=Math.max(...st(t,i.split(""))),r=i.slice(e+1),a=r&&0===parseInt(r),o=parseInt(r?r+n:n),{tiebreakFormat:s}=f.setFormat,{tiebreakTo:c,NoAD:u}=s||{};!a&&r.length<2?u&&o>c-1?l="invalid low value for NoAD tiebreak":(d=!0,i=(i||"")+n):l=a?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)l=`invalid key: ${n}`;else if(f.isGameScoreEntry)l="game scoreString entry";else if(f.lastSetIsComplete||!r.length){var I,v;d=!0;const{scoreString:t,set:a}=function({analysis:t,lowSide:e,scoreString:n,value:i}){const{setTo:r,tiebreakAt:a,NoAD:o}=t.setFormat,s=i===parseInt(a||r);if(a&&a<r&&i>a)return{scoreString:n};if(o&&i===r||i>r)return{scoreString:n};const c=s?i+1:i+1===r?i+(o?1:2):r,u=[i,c];2===e&&u.reverse();const d=no.split("")[0];n=(n||"")+(u.join(po)+(s?d:Ka));const l={side1Score:u[0],side2Score:u[1]},p=Ha({analysis:t,set:l});return l.winningSide=p||void 0,{scoreString:n,set:l}}({analysis:f,lowSide:e,scoreString:i,value:parseInt(n)});a&&(a.setNumber=(null===(I=r)||void 0===I?void 0:I.length)+1||1),r=(null===(v=r)||void 0===v?void 0:v.concat(a).filter(Boolean))||[a],i=t||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(d=!0,({scoreString:i,sets:r}=No({analysis:f,scoreString:i,sets:r,lowSide:e,auto:u})),o=void 0);if(d){var g;r=null===(g=r)||void 0===g?void 0:g.filter(Boolean);const{matchUpWinningSide:t}=To({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=t,!t||o&&![O,b].includes(o)?!i||a||[Qa,Za,to].includes(o)||(o=void 0):(o="COMPLETED",r=r.filter((t=>{const{side1Score:e,side2Score:n,side1TiebreakScore:i,side2TiebreakScore:r}=t;return e||n||i||r}))),{updated:d,scoreString:i,sets:r,winningSide:a,matchUpStatus:o,message:l}}return{updated:d,scoreString:i,sets:r,winningSide:a,matchUpStatus:o,message:l}},analyzeSet:Oo};const Fo=[{ioc:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso:"AD",label:"Andorra",phone:"376"},{ioc:"UAE",iso:"AE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso:"AF",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso:"AG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso:"AI",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso:"AL",label:"Albania",phone:"355"},{ioc:"ARM",iso:"AM",label:"Armenia",phone:"374"},{ioc:"ANG",iso:"AO",label:"Angola",phone:"244"},{ioc:"",iso:"AQ",label:"Antarctica",phone:"672"},{ioc:"ARG",iso:"AR",label:"Argentina",phone:"54"},{ioc:"ASA",iso:"AS",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso:"AT",label:"Austria",phone:"43"},{ioc:"AUS",iso:"AU",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso:"AW",label:"Aruba",phone:"297"},{ioc:"",iso:"AX",label:"Alland Islands",phone:"358"},{ioc:"AZE",iso:"AZ",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso:"BA",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso:"BB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso:"BD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso:"BE",label:"Belgium",phone:"32"},{ioc:"BUR",iso:"BF",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso:"BG",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso:"BH",label:"Bahrain",phone:"973"},{ioc:"BDI",iso:"BI",label:"Burundi",phone:"257"},{ioc:"BEN",iso:"BJ",label:"Benin",phone:"229"},{ioc:"",iso:"BL",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso:"BM",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso:"BN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso:"BO",label:"Bolivia",phone:"591"},{ioc:"BRA",iso:"BR",label:"Brazil",phone:"55"},{ioc:"BAH",iso:"BS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso:"BT",label:"Bhutan",phone:"975"},{ioc:"",iso:"BV",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso:"BW",label:"Botswana",phone:"267"},{ioc:"BLR",iso:"BY",label:"Belarus",phone:"375"},{ioc:"BIZ",iso:"BZ",label:"Belize",phone:"501"},{ioc:"CAN",iso:"CA",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso:"CC",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso:"CD",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso:"CF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso:"CG",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso:"CH",label:"Switzerland",phone:"41"},{ioc:"CIV",iso:"CI",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso:"CK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso:"CL",label:"Chile",phone:"56"},{ioc:"CMR",iso:"CM",label:"Cameroon",phone:"237"},{ioc:"CHN",iso:"CN",label:"China",phone:"86"},{ioc:"COL",iso:"CO",label:"Colombia",phone:"57"},{ioc:"CRC",iso:"CR",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso:"CU",label:"Cuba",phone:"53"},{ioc:"CPV",iso:"CV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso:"CW",label:"Curacao",phone:"599"},{ioc:"CXR",iso:"CX",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso:"CY",label:"Cyprus",phone:"357"},{ioc:"CZE",iso:"CZ",label:"Czech Republic",phone:"420"},{ioc:"GER",iso:"DE",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso:"DJ",label:"Djibouti",phone:"253"},{ioc:"DEN",iso:"DK",label:"Denmark",phone:"45"},{ioc:"DMA",iso:"DM",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso:"DO",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso:"DZ",label:"Algeria",phone:"213"},{ioc:"ECU",iso:"EC",label:"Ecuador",phone:"593"},{ioc:"EST",iso:"EE",label:"Estonia",phone:"372"},{ioc:"EGY",iso:"EG",label:"Egypt",phone:"20"},{ioc:"",iso:"EH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso:"ER",label:"Eritrea",phone:"291"},{ioc:"ESP",iso:"ES",label:"Spain",phone:"34"},{ioc:"ETH",iso:"ET",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso:"FI",label:"Finland",phone:"358"},{ioc:"FIJ",iso:"FJ",label:"Fiji",phone:"679"},{ioc:"FLK",iso:"FK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso:"FM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso:"FO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso:"FR",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso:"GA",label:"Gabon",phone:"241"},{ioc:"GBR",iso:"GB",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso:"GD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso:"GE",label:"Georgia",phone:"995"},{ioc:"FGU",iso:"GF",label:"French Guiana",phone:"594"},{ioc:"",iso:"GG",label:"Guernsey",phone:"44"},{ioc:"",iso:"GH",label:"Ghana",phone:"233"},{ioc:"GIB",iso:"GI",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso:"GL",label:"Greenland",phone:"299"},{ioc:"GAM",iso:"GM",label:"Gambia",phone:"220"},{ioc:"GUI",iso:"GN",label:"Guinea",phone:"224"},{ioc:"GUD",iso:"GP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso:"GQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso:"GR",label:"Greece",phone:"30"},{ioc:"",iso:"GS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso:"GT",label:"Guatemala",phone:"502"},{ioc:"GUM",iso:"GU",label:"Guam",phone:"1-671"},{ioc:"GBS",iso:"GW",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso:"GY",label:"Guyana",phone:"592"},{ioc:"HKG",iso:"HK",label:"Hong Kong",phone:"852"},{ioc:"",iso:"HM",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso:"HN",label:"Honduras",phone:"504"},{ioc:"CRO",iso:"HR",label:"Croatia",phone:"385"},{ioc:"HAI",iso:"HT",label:"Haiti",phone:"509"},{ioc:"HUN",iso:"HU",label:"Hungary",phone:"36"},{ioc:"INA",iso:"ID",label:"Indonesia",phone:"62"},{ioc:"IRL",iso:"IE",label:"Ireland",phone:"353"},{ioc:"ISR",iso:"IL",label:"Israel",phone:"972"},{ioc:"",iso:"IM",label:"Isle of Man",phone:"44"},{ioc:"IND",iso:"IN",label:"India",phone:"91"},{ioc:"",iso:"IO",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso:"IQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso:"IR",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso:"IS",label:"Iceland",phone:"354"},{ioc:"ITA",iso:"IT",label:"Italy",phone:"39"},{ioc:"",iso:"JE",label:"Jersey",phone:"44"},{ioc:"JAM",iso:"JM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso:"JO",label:"Jordan",phone:"962"},{ioc:"JPN",iso:"JP",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso:"KE",label:"Kenya",phone:"254"},{ioc:"KGZ",iso:"KG",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso:"KH",label:"Cambodia",phone:"855"},{ioc:"KIR",iso:"KI",label:"Kiribati",phone:"686"},{ioc:"COM",iso:"KM",label:"Comoros",phone:"269"},{ioc:"SKN",iso:"KN",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso:"KP",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso:"KR",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso:"KW",label:"Kuwait",phone:"965"},{ioc:"CAY",iso:"KY",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso:"KZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso:"LA",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso:"LB",label:"Lebanon",phone:"961"},{ioc:"LCA",iso:"LC",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso:"LI",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso:"LK",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso:"LR",label:"Liberia",phone:"231"},{ioc:"LES",iso:"LS",label:"Lesotho",phone:"266"},{ioc:"LTU",iso:"LT",label:"Lithuania",phone:"370"},{ioc:"LUX",iso:"LU",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso:"LV",label:"Latvia",phone:"371"},{ioc:"LBA",iso:"LY",label:"Libya",phone:"218"},{ioc:"MAR",iso:"MA",label:"Morocco",phone:"212"},{ioc:"MON",iso:"MC",label:"Monaco",phone:"377"},{ioc:"MDA",iso:"MD",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso:"ME",label:"Montenegro",phone:"382"},{ioc:"",iso:"MF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso:"MG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso:"MH",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso:"MK",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso:"ML",label:"Mali",phone:"223"},{ioc:"MYA",iso:"MM",label:"Myanmar",phone:"95"},{ioc:"MGL",iso:"MN",label:"Mongolia",phone:"976"},{ioc:"MAC",iso:"MO",label:"Macao",phone:"853"},{ioc:"NMA",iso:"MP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso:"MQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso:"MR",label:"Mauritania",phone:"222"},{ioc:"MNT",iso:"MS",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso:"MT",label:"Malta",phone:"356"},{ioc:"MRI",iso:"MU",label:"Mauritius",phone:"230"},{ioc:"MDV",iso:"MV",label:"Maldives",phone:"960"},{ioc:"MAW",iso:"MW",label:"Malawi",phone:"265"},{ioc:"MEX",iso:"MX",label:"Mexico",phone:"52"},{ioc:"MAS",iso:"MY",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso:"MZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso:"NA",label:"Namibia",phone:"264"},{ioc:"NCL",iso:"NC",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso:"NE",label:"Niger",phone:"227"},{ioc:"NFI",iso:"NF",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso:"NG",label:"Nigeria",phone:"234"},{ioc:"NCA",iso:"NI",label:"Nicaragua",phone:"505"},{ioc:"NED",iso:"NL",label:"Netherlands",phone:"31"},{ioc:"NOR",iso:"NO",label:"Norway",phone:"47"},{ioc:"NEP",iso:"NP",label:"Nepal",phone:"977"},{ioc:"NRU",iso:"NR",label:"Nauru",phone:"674"},{ioc:"NIU",iso:"NU",label:"Niue",phone:"683"},{ioc:"NZL",iso:"NZ",label:"New Zealand",phone:"64"},{ioc:"OMA",iso:"OM",label:"Oman",phone:"968"},{ioc:"PAN",iso:"PA",label:"Panama",phone:"507"},{ioc:"PER",iso:"PE",label:"Peru",phone:"51"},{ioc:"FPO",iso:"PF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso:"PG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso:"PH",label:"Philippines",phone:"63"},{ioc:"PAK",iso:"PK",label:"Pakistan",phone:"92"},{ioc:"POL",iso:"PL",label:"Poland",phone:"48"},{ioc:"SPM",iso:"PM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso:"PN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso:"PR",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso:"PS",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso:"PT",label:"Portugal",phone:"351"},{ioc:"PlW",iso:"PW",label:"Palau",phone:"680"},{ioc:"PAR",iso:"PY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso:"QA",label:"Qatar",phone:"974"},{ioc:"REU",iso:"RE",label:"Reunion",phone:"262"},{ioc:"ROU",iso:"RO",label:"Romania",phone:"40"},{ioc:"SRB",iso:"RS",label:"Serbia",phone:"381"},{ioc:"RUS",iso:"RU",label:"Russia",phone:"7"},{ioc:"RWA",iso:"RW",label:"Rwanda",phone:"250"},{ioc:"KSA",iso:"SA",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso:"SB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso:"SC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso:"SD",label:"Sudan",phone:"249"},{ioc:"SWE",iso:"SE",label:"Sweden",phone:"46"},{ioc:"SIN",iso:"SG",label:"Singapore",phone:"65"},{ioc:"HEL",iso:"SH",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso:"SI",label:"Slovenia",phone:"386"},{ioc:"",iso:"SJ",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso:"SK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso:"SL",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso:"SM",label:"San Marino",phone:"378"},{ioc:"SEN",iso:"SN",label:"Senegal",phone:"221"},{ioc:"SOM",iso:"SO",label:"Somalia",phone:"252"},{ioc:"SUR",iso:"SR",label:"Suriname",phone:"597"},{ioc:"",iso:"SS",label:"South Sudan",phone:"211"},{ioc:"STP",iso:"ST",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso:"SV",label:"El Salvador",phone:"503"},{ioc:"",iso:"SX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso:"SY",label:"Syria",phone:"963"},{ioc:"",iso:"SZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso:"TC",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso:"TD",label:"Chad",phone:"235"},{ioc:"",iso:"TF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso:"TG",label:"Togo",phone:"228"},{ioc:"THA",iso:"TH",label:"Thailand",phone:"66"},{ioc:"TJK",iso:"TJ",label:"Tajikistan",phone:"992"},{ioc:"",iso:"TK",label:"Tokelau",phone:"690"},{ioc:"TLS",iso:"TL",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso:"TM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso:"TN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso:"TO",label:"Tonga",phone:"676"},{ioc:"TUR",iso:"TR",label:"Turkey",phone:"90"},{ioc:"TTO",iso:"TT",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso:"TV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso:"TW",label:"Taiwan",phone:"886"},{ioc:"TAN",iso:"TZ",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso:"UA",label:"Ukraine",phone:"380"},{ioc:"UGA",iso:"UG",label:"Uganda",phone:"256"},{ioc:"USA",iso:"US",label:"United States",phone:"1",suggested:!0},{ioc:"URU",iso:"UY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso:"UZ",label:"Uzbekistan",phone:"998"},{ioc:"",iso:"VA",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso:"VC",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso:"VE",label:"Venezuela",phone:"58"},{ioc:"IVB",iso:"VG",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso:"VI",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso:"VN",label:"Vietnam",phone:"84"},{ioc:"VAN",iso:"VU",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso:"WF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso:"WS",label:"Samoa",phone:"685"},{ioc:"KOS",iso:"XK",label:"Kosovo",phone:"383"},{ioc:"YEM",iso:"YE",label:"Yemen",phone:"967"},{ioc:"MAY",iso:"YT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso:"ZA",label:"South Africa",phone:"27"},{ioc:"ZAM",iso:"ZM",label:"Zambia",phone:"260"},{ioc:"ZIM",iso:"ZW",label:"Zimbabwe",phone:"263"}];var ko={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:6/TB10",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},jo={winCriteria:{valueGoal:13},collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}]};const Bo={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6NOAD/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6NOAD/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:ko,LAVER_CUP:jo},_o="MAIN",Go="QUALIFYING",Vo="CONSOLATION",Ho="VOLUNTARY_CONSOLATION",Wo="PLAY_OFF",qo=[_o,Go,Vo,Wo,Ho],Ko={[Go]:1,[_o]:2,[Wo]:3,[Vo]:3,[Ho]:4},zo="CLUSTER",Yo="WATERFALL",$o="ITEM",Jo="CONTAINER",Zo="DRAW",Qo="RANDOM",Xo="TOP_DOWN",ts="BOTTOM_UP",es="POSITION",ns="WINNER",is="LOSER",rs="FIRST_MATCHUP",as="AD_HOC",os="FEED IN",ss="COMPASS",cs="OLYMPIC",us="SINGLE_ELIMINATION",ds="DOUBLE_ELIMINATION",ls="FIRST_MATCH_LOSER_CONSOLATION",ps="FIRST_ROUND_LOSER_CONSOLATION",ms="CURTIS_CONSOLATION",fs="FEED_IN_CHAMPIONSHIP_TO_SF",hs="FEED_IN_CHAMPIONSHIP_TO_SF",Is="FEED_IN_CHAMPIONSHIP_TO_QF",vs="FEED_IN_CHAMPIONSHIP_TO_QF",gs="FEED_IN_CHAMPIONSHIP_TO_R16",ys="FEED_IN_CHAMPIONSHIP_TO_R16",Us="MODIFIED_FEED_IN_CHAMPIONSHIP",ws="MODIFIED_FEED_IN_CHAMPIONSHIP",Ss="FEED_IN_CHAMPIONSHIP",Ns="ROUND_ROBIN",Ds="ROUND_ROBIN_WITH_PLAYOFF",Ps="DECIDER",Ts="BACKDRAW",As={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-3":{name:"NORTHEAST",abbreviation:"NE"},"0-1-1":{name:"SOUTH",abbreviation:"S"},"0-1-2":{name:"SOUTHWEST",abbreviation:"SW"},"0-2-1":{name:"NORTHWEST",abbreviation:"NW"},"0-1-1-1":{name:"SOUTHEAST",abbreviation:"SE"}},Ms={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-1-1":{name:"SOUTH",abbreviation:"S"}},bs="WIN_RATIO",Es="ROUND_OUTCOME",Cs=[os,ss,Wo,cs,ms,fs,Is,gs,ls,ps,ws,ys,vs,hs,Ss,Ds],Rs={MAIN:_o,QUALIFYING:Go,CONSOLATION:Vo,ITEM:$o,CONTAINER:Jo,FIRST_MATCHUP:rs,WINNER:ns,LOSER:is,AD_HOC:as,FEED_IN:os,COMPASS:ss,PLAY_OFF:Wo,OLYMPIC:cs,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:us,DOUBLE_ELIMINATION:ds,CURTIS:ms,FICSF:fs,FICQF:Is,FICR16:gs,MFIC:Us,FIRST_MATCH_LOSER_CONSOLATION:ls,FIRST_ROUND_LOSER_CONSOLATION:ps,MODIFIED_FEED_IN_CHAMPIONSHIP:ws,FEED_IN_CHAMPIONSHIP_TO_R16:ys,FEED_IN_CHAMPIONSHIP_TO_QF:vs,FEED_IN_CHAMPIONSHIP_TO_SF:hs,FEED_IN_CHAMPIONSHIP:Ss,ROUND_ROBIN_WITH_PLAYOFF:Ds,ROUND_ROBIN:Ns,DECIDER:Ps,BACKDRAW:Ts,COMPASS_ATTRIBUTES:As,OLYMPIC_ATTRIBUTES:Ms,DRAW:Zo,RANDOM:Qo,TOP_DOWN:Xo,BOTTOM_UP:ts,WATERFALL:Yo,WIN_RATIO:bs,ROUND_OUTCOME:Es,MULTI_STRUCTURE_DRAWS:Cs,generatedDrawTypes:[as,ss,ms,ds,vs,ys,hs,Ss,os,ls,ps,ws,cs,Wo,Ns,Ds,us]},Os="removeDrawPositionAssignment",xs="assignDrawPosition",Ls="addPenalty",Fs="ALTERNATE",ks="WITHDRAW",js="ASSIGN",Bs="REMOVE",_s="LUCKY",Gs="SWAP",Vs="NICKNAME",Hs="SEED_VALUE",Ws="PENALTY",qs="BYE",Ks={ALTERNATE_PARTICIPANT:Fs,WITHDRAW_PARTICIPANT:ks,ASSIGN_PARTICIPANT:js,LUCKY_PARTICIPANT:_s,REMOVE_ASSIGNMENT:Bs,SWAP_PARTICIPANTS:Gs,ADD_NICKNAME:Vs,ADD_PENALTY:Ws,ASSIGN_BYE:qs,SEED_VALUE:Hs},zs={[ir]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Go,_o],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[Hs,Vs,Ws],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1}},Ys={[rr]:{policyName:"Round Naming Default",abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q"},stageConstants:{[_o]:"",[Wo]:"P",[Go]:"Q",[Vo]:"C"}}},$s={[cr]:{policyName:"USTA",seedingProfile:"SEPARATE",duplicateSeedNumbers:!0,drawSizeProgression:!0,validSeedPositions:{ignore:!0},seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function Js({courtDate:t,includeBookingTypes:e=[]}){const n=[];let i=Fi(t.startTime);(t.bookings||[]).filter((t=>!t.bookingType||!e.includes(t.bookingType))).sort(((t,e)=>Ci(t.startTime).localeCompare(Ci(e.startTime)))).forEach((t=>{const e={startTime:Ri(i.toISOString()),endTime:t.startTime};Fi(t.startTime)>i&&n.push(e),Fi(t.endTime)>i&&(i=Fi(t.endTime))}));const r={startTime:Ri(i.toISOString()),endTime:t.endTime};return Fi(t.endTime)>i&&n.push(r),n}function Zs({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:n,periodEndTime:i,periodLength:r,date:a}){function o(t){const r=Fi(t.startTime),a=Fi(t.endTime);if(r>n)return!1;if(a<i)return!1;return ki(n,a)>=e}return{sameDate:t=>!t.date||Gi(t.date,a),enoughTime:e=>!!Js({courtDate:e,periodLength:r,includeBookingTypes:t}).filter(o).length}}function Qs({includeBookingTypes:t,averageMatchUpMinutes:e,periodLength:n,periodStart:i,courts:r,date:a}){const o=Fi(i),s=Bi(o,e),{sameDate:c,enoughTime:u}=Zs({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:o,periodEndTime:s,periodLength:n,date:a});return{availableToScheduleCount:r.filter((t=>!!(Array.isArray(t.dateAvailability)&&t.dateAvailability.filter(c).filter(u)).length)).length}}function Xs({remainingScheduleTimes:t=[],clearScheduleDates:e,periodLength:n=30,bookings:i=[],scheduleDate:r,courts:a=[]}){if(!Array.isArray(a)||!a.length)return{error:_n,courts:a};if(!Array.isArray(i))return{error:Oe};if(!wi(r))return{error:Fe};e&&(Array.isArray(e)?e.includes(r)&&(i=[]):i=[]);const{courtBookings:o,unassignedBookings:s}=i.reduce(((t,e)=>{const{courtId:n}=e;return n?t.courtBookings[n]?t.courtBookings[n].push(e):t.courtBookings[n]=[e]:t.unassignedBookings.push(e),t}),{courtBookings:{},unassignedBookings:[]}),{sameDate:c}=Zs({date:r}),u=a.map((({courtId:e,dateAvailability:n},i)=>{const r=o[e]||[],a=n.find(c)||{},{date:s,startTime:u,endTime:d,bookings:l=[]}=a;return{courtId:e,dateAvailability:{date:s,startTime:u,endTime:d,bookings:[t[i]&&{startTime:u,endTime:t[i]},...Hi(l,!1,!0),...r].filter(Boolean)}}}));s.sort(((t,e)=>Ei(t.startTime)-Ei(e.startTime)));for(const d of s){const{startTime:t,endTime:e,averageMinutes:i,recoveryMinutes:r,matchUpId:a}=d,o=Ei(t),s=Ei(e),c=u.map((t=>{const e=Js({courtDate:t.dateAvailability});return{courtId:t.courtId,timeSlots:e}})).flat().reduce(((t,{courtId:e,timeSlots:i})=>{let r;return i.find((({startTime:e,endTime:i})=>{r=Ei(e)-o;const a=o>=Ei(e);return s<=Ei(i)&&0!==t.startDifference&&((0===r||r+n>=0)&&(void 0===t.startDifference||r<t.startDifference)||a)}))?{courtId:e,startDifference:r}:t}),{courtId:void 0,startDifference:void 0});if(c.courtId){const n={averageMinutes:i,recoveryMinutes:r,matchUpId:a,startTime:t,endTime:e};u.find((({courtId:t})=>t===c.courtId)).dateAvailability.bookings.push(n)}else console.log({unassignedBooking:d})}return{virtualCourts:u.map((({courtId:t,dateAvailability:e})=>({courtId:t,dateAvailability:[e]})))}}function tc({startTime:t="8:00",endTime:e="20:30",count:n=10,date:i}={}){return ot(0,n).map((()=>({dateAvailability:[{date:i,startTime:t,endTime:e}]})))}function ec({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,averageMatchUpMinutes:n=90,date:i=Si(),clearScheduleDates:r,periodLength:a=30,startTime:o="08:00",endTime:s="19:00",courtsCount:c,bookings:u,courts:d}={}){i=Oi(i),o=Ri(o),s=Ri(s);let l=0,p=0,m=0,f=0,h=0;!d&&c&&(d=tc({startTime:o,endTime:s,count:c,date:i}));const{virtualCourts:I}=Xs({remainingScheduleTimes:e,scheduleDate:i,clearScheduleDates:r,periodLength:a,bookings:u,courts:d}),{firstTimeSlotStartTime:v}=function({averageMinutes:t,startTime:e,endTime:n,courts:i,date:r}){const{sameDate:a}=Zs({date:r});let o;if(e&&n){const r=Fi(e),s=Fi(n);i.every((e=>!!Array.isArray(e.dateAvailability)&&e.dateAvailability.filter(a).find((e=>Js({courtDate:e}).find((e=>{const n=Fi(e.startTime),i=Fi(e.endTime);if(n>s||n<r)return!1;if(i<r)return!1;const a=ki(n,i)>=t;if(a){const t=Ri(n.toISOString());(!o||t<o)&&(o=t)}return a}))))))}return{firstTimeSlotStartTime:o}}({averageMinutes:n,courts:I,startTime:o,endTime:s,date:i});t&&v&&(o=v||o);const g=Ei(o),y=Ei(s)-g,U=ot(0,Math.floor(y/a)+1).map((t=>{const e=function(t){let e=Math.floor(t/60);const n=t-60*e;return e>23&&(e%=24),[_i(e),_i(n)].join(":")}(g+t*a),{availableToScheduleCount:r}=Qs({courts:I,averageMatchUpMinutes:n,periodLength:a,periodStart:e,period:t,date:i}),o=r>p?r-p:0;h+=t?r:0;const s=t?h/t:r,c=t?a*s/n*(t-1)+s:s,u=r?p?c-l:o:0;l=c,p=r,m+=u;const d=parseInt(m)-f;return f+=d,{periodStart:e,add:d,availableToScheduleCount:r,newCourts:o,totalMatchUps:f}}));return{scheduleTimes:U.reduce(((t,e)=>t.concat(...ot(0,e.add).map((()=>({scheduleTime:e.periodStart}))))),[]).flat(),timingProfile:U,totalMatchUps:f}}const nc={getCourtsAvailableAtPeriodStart:Qs,generateTimeSlots:Js,getScheduleTimes:ec,courtGenerator:tc};function ic(t,e,n=[]){return"object"==typeof t&&Object.keys(t).reduce(((i,r)=>"object"!=typeof t[r]?(i[n.concat(r).join(e)]=t[r],i):Object.assign(i,ic(t[r],e,n.concat(r)))),{})}function rc({element:t,itemType:e,itemSubTypes:n,returnPreviousValues:i}){if(!t)return{error:Ee};if(!Array.isArray(t.timeItems))return{error:Cn};const r=t.timeItems.filter((t=>(null==t?void 0:t.itemType)===e)).filter((t=>{var e;return!(null!=n&&n.length)||(null==t||null===(e=t.itemSubTypes)||void 0===e?void 0:e.includes(n))})).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))),a=r.pop();if(a){const t={timeItem:a,...pt};return i&&Object.assign(t,{previousItems:r}),t}return{message:qn}}function ac({event:t,itemType:e,itemSubTypes:n,returnPreviousValues:i}){if(!t)return{error:Yt};if(!t.timeItems)return{message:qn};const{timeItem:r,previousItems:a,message:o}=rc({element:t,itemType:e,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:a}||{message:o}}function oc({element:t,timeItem:e,duplicateValues:n=!0}){if(!t)return{error:Ee};if(!e)return{error:En};const i=e&&Object.keys(e),r=["itemType","itemValue"];if(!(r.filter((t=>i.includes(t))).length===r.length))return{error:bn};if(t.timeItems){const{itemType:i,itemSubTypes:r,itemValue:a}=e,{timeItem:o}=rc({element:t,itemType:i,itemSubTypes:r});if(JSON.stringify(null==o?void 0:o.itemValue)===JSON.stringify(a)&&!n)return pt}else t.timeItems=[];e.itemSubTypes&&!e.itemSubTypes.length&&delete e.itemSubTypes;const a=(new Date).toISOString();return Object.assign(e,{createdAt:a}),t.timeItems.push(e),pt}function sc({tournamentRecord:t,duplicateValues:e,participantId:n,timeItem:i}){if(!t)return{error:It};if(!n)return{error:Je};const r=aa({tournamentRecord:t,participantId:n});return r.error?r:oc({element:r.participant,duplicateValues:e,timeItem:i})}function cc({tournamentRecord:t,duplicateValues:e,timeItem:n}){return t?oc({element:t,timeItem:n,duplicateValues:e}):{error:It}}function uc({event:t,timeItem:e,duplicateValues:n}){return t?oc({element:t,timeItem:e,duplicateValues:n}):{error:$t}}const dc="addDrawDefinition",lc="addMatchUps",pc="addParticipants",mc="addVenue",fc="audit",hc="deletedDrawIds",Ic="deleteParticipants",vc="deleteVenue",gc="deletedMatchUpIds",yc="modifyDrawDefinition",Uc="modifyMatchUp",wc="modifyParticipants",Sc="modifyVenue",Nc="publishEvent",Dc={ADD_DRAW_DEFINITION:dc,ADD_MATCHUPS:lc,ADD_PARTICIPANTS:pc,ADD_VENUE:mc,AUDIT:fc,DELETED_DRAW_IDS:hc,DELETE_PARTICIPANTS:Ic,DELETE_VENUE:vc,DELETED_MATCHUP_IDS:gc,MODIFY_DRAW_DEFINITION:yc,MODIFY_MATCHUP:Uc,MODIFY_PARTICIPANTS:wc,MODIFY_VENUE:Sc,PUBLISH_EVENT:Nc};function Pc(t,e){var n;if(!t)return;let i=Date.now();i===t.updatedAt&&(i+=1);const r=null==e?void 0:e.filter(Boolean);t.updatedAt=i,null===(n=t.structures)||void 0===n||n.forEach((t=>{(null==r||!r.length||null!=r&&r.includes(t.structureId))&&(t.updatedAt=i)}))}function Tc({drawDefinition:t,matchUps:e}){Pc(t),ri({topic:lc,payload:{matchUps:e}})}function Ac({drawDefinition:t,matchUpIds:e,action:n}){Pc(t),ri({topic:gc,payload:{action:n,matchUpIds:e}})}function Mc({drawDefinition:t,matchUp:e}){Ec({drawDefinition:t,structureIds:[e.structureId]}),ri({topic:Uc,payload:{matchUp:e},key:e.matchUpId})}function bc({drawDefinition:t}){Pc(t),ri({topic:dc,payload:{drawDefinition:t},key:t.drawId})}function Ec({drawDefinition:t,structureIds:e}){Pc(t,e),ri({topic:yc,payload:{drawDefinition:t},key:t.drawId})}function Cc({tournamentParticipants:t,tournamentRecord:e,participantIds:n}){if(!t&&!e)return{error:It};if(!Array.isArray(n)||n.length>2)return{error:qe};if(!n.length)return{error:tn};const i=(t=t||(null==e?void 0:e.participants)||[]).filter((t=>t.participantType===ka&&ct(n,t.individualParticipantIds).length===n.length&&t.individualParticipantIds.length===n.length)),r=i[0];if(!r)return{error:Ze};const a=Hi(i.slice(1));return{participant:Hi(r),duplicatedPairParticipants:a,...pt}}function Rc({drawDefinition:t,participantId:e}){if("object"!=typeof t)return{error:Ut};if("string"!=typeof e)return{error:Je};const{extension:n}=oa({element:t,name:Wr});return{lineUp:((null==n?void 0:n.value)||{})[e]}}const Oc=t=>e=>t[e],xc=(t=[])=>t.map(jc).filter(Boolean),Lc=(t=[])=>t.map(Fc).filter(Boolean),Fc=(t={})=>Oc(t)("participantId"),kc=(t={})=>Oc(t)("drawPosition"),jc=(t={})=>Oc(t)("matchUpId");function Bc({drawDefinition:t}){if(!t)return{error:Ut};const e=(t.extensions||[]).find((t=>t.name===jr));return{appliedPolicies:(null==e?void 0:e.value)||{}}}function _c({matchUps:t=[]}){const e=t.reduce(((t,e)=>!e.roundNumber||t.includes(e.roundNumber)?t:t.concat(parseInt(e.roundNumber))),[]).sort(Ki).map((e=>{const n=t.filter((t=>t.roundNumber===e)),i=n.find((({matchUpType:t})=>t===ma))?n.filter((({matchUpType:t})=>t===ma)):n;return{[e]:i.sort(((t,e)=>Ki(t.roundPosition,e.roundPosition)))}})),n=t.reduce(((t,e)=>(t[e.roundNumber]||(t[e.roundNumber]=e.finishingRound),t)),{}),i=Object.assign({},...e),r=Object.assign({},...Object.keys(i).map((t=>{var e;return{[t]:{matchUpsCount:null===(e=i[t])||void 0===e?void 0:e.length}}})));let a=0,o=0;return Object.keys(i).map((t=>parseInt(t))).filter((t=>!isNaN(t))).forEach((t=>{const e=i[t].sort(((t,e)=>t.roundPosition-e.roundPosition)),s=e.map((t=>(null==t?void 0:t.drawPositions)||[])).flat();if(1!==t&&r[t-1]){const n=r[t-1].drawPositions,i=n.length/s.length,a=dt(n,i),o=e.map((e=>{const{roundPosition:i,drawPositions:r}=e;if(!i)return r;const o=(null==r?void 0:r.filter(Boolean))||[];if(null==o||!o.length)return[void 0,void 0];if(t<3&&2===(null==o?void 0:o.length))return null==r?void 0:r.slice().sort(Ki);if(null!=o&&o.length&&ct(n,o).length!==(null==o?void 0:o.length))return 1===(null==o?void 0:o.length)?[o[0],void 0]:null==r?void 0:r.slice().sort(Ki);const s=2*(i-1);return a.slice(s,s+2).map((t=>null==r?void 0:r.find((e=>t.includes(e)))))}));r[t].drawPositions=null==o?void 0:o.flat(),r[t].pairedDrawPositions=o}else{const e=s.sort(Ki),n=dt(e,2);r[t].drawPositions=e,r[t].pairedDrawPositions=n}r[t].finishingRound=n[t],r[t].finishingPositionRange=i[t][0].finishingPositionRange,r[t+1]&&r[t+1].matchUpsCount===r[t].matchUpsCount&&(r[t+1].feedRound=!0,r[t+1].feedRoundIndex=o,r[t].preFeedRound=!0,o+=1),r[t]&&!r[t].feedRound&&(r[t].roundIndex=a,a+=1)})),{roundMatchUps:i,roundProfile:r}}function Gc({drawDefinition:t,structure:e}){const n={},i=[];return((null==t?void 0:t.structures)||[e]).filter((t=>t&&"object"==typeof t)).forEach((t=>{const{structureId:e,matchUps:r,structures:a}=t,o=Array.isArray(a);if(o)o&&a.forEach((t=>{const{structureName:r}=t,a=t.matchUps;n[t.structureId]={matchUps:a,structureName:r},i.push(...a),a.forEach((t=>{i.push(t),t.tieMatchUps&&i.push(...t.tieMatchUps)})),n[e]||(n[e]={}),n[e].itemStructureIds||(n[e].itemStructureIds=[]),n[e].itemStructureIds.push(t.structureId)}));else{const t=r;n[e]={matchUps:t},t.forEach((t=>{i.push(t),t.tieMatchUps&&i.push(...t.tieMatchUps)}))}})),{mappedMatchUps:n,drawMatchUps:i}}function Vc({mappedMatchUps:t,matchUpsMap:e,structureId:n,inContext:i}){let r=(t=(null==e?void 0:e.mappedMatchUps)||t)[n];const a=((null==r?void 0:r.itemStructureIds)||[]).map((e=>{const{matchUps:n,structureName:r}=t[e];return i?n.map((t=>Object.assign(Hi(t,!0,!0),{structureId:e,structureName:r}))):n})).flat();return((null==r?void 0:r.matchUps)||[]).concat(...a)}function Hc(t,e){var n,i;return(Ko[null==t?void 0:t.stage]||0)-(Ko[null==e?void 0:e.stage]||0)||((null==e||null===(n=e.positionAssignments)||void 0===n?void 0:n.length)||9999)-((null==t||null===(i=t.positionAssignments)||void 0===i?void 0:i.length)||9999)||((null==t?void 0:t.stageSequence)||0)-((null==e?void 0:e.stageSequence)||0)}function Wc({drawDefinition:t,structureId:e}){if(!t)return{error:Ut};if(!e)return{error:Ht};const{structures:n}=qc({drawDefinition:t}),i=n.map((t=>t.structures?[].concat(...t.structures,t):t)).flat().find((t=>t.structureId===e));return i?{structure:i}:{error:Wt}}function qc({stage:t,stageSequence:e,drawDefinition:n}){var i;const r=n?n.structures?void 0:qt:Ut;if(r)return{error:r};return{structures:null===(i=n.structures)||void 0===i?void 0:i.filter((function(e){return!t||e.stage===t})).filter((function(t){return!e||t.stageSequence===e})).sort(Hc)}}function Kc(t){if(!t||"object"!=typeof t)return!1;if("string"!=typeof t.name)return!1;const e=Object.keys(t),n=["name","value"];return n.filter((t=>e.includes(t))).length===n.length}function zc({element:t,extension:e}={}){if(!t)return{error:Ee};if("object"!=typeof t)return{error:_n};if(!Kc(e))return{error:_n};t.extensions||(t.extensions=[]);const n=(new Date).toISOString();Object.assign(e,{createdAt:n});const i=t.extensions.find((({name:t})=>t===e.name));return i?i.value=e.value:e.value&&t.extensions.push(e),{...pt}}function Yc({element:t,name:e}={}){return t?"object"!=typeof t?{error:_n}:e?t.extensions?(t.extensions=t.extensions.filter((t=>(null==t?void 0:t.name)!==e)),{...pt}):{...pt,message:qn}:{error:Ee,message:"Missing name"}:{error:Ee}}function $c({tournamentRecord:t,extension:e}={}){return t?zc({element:t,extension:e}):{error:It}}function Jc({drawDefinition:t,extension:e}={}){return t?zc({element:t,extension:e}):{error:St}}function Zc({event:t,extension:e}={}){return t?zc({element:t,extension:e}):{error:Yt}}function Qc({tournamentRecord:t,name:e}={}){return t?Yc({element:t,name:e}):{error:It}}function Xc({event:t,name:e}={}){return t?Yc({element:t,name:e}):{error:$t}}function tu({drawDefinition:t,attributes:e}){var n;let{extension:i}=ua({drawDefinition:t,name:Gr});const r=(null===(n=i)||void 0===n?void 0:n.value)||t.entryProfile||{};return e.forEach((t=>{Object.keys(t).forEach((e=>{r[e]?Object.assign(r[e],t[e]):r[e]=t[e]}))})),i={name:Gr,value:r},Jc({drawDefinition:t,extension:i}),{entryProfile:r}}var eu;!function(t){t.CONFIRMED="CONFIRMED",t.DIRECT_ACCEPTANCE="DIRECT_ACCEPTANCE",t.ORGANISER_ACCEPTANCE="ORGANISER_ACCEPTANCE",t.ALTERNATE="ALTERNATE",t.WITHDRAWN="WITHDRAWN",t.UNPAIRED="UNPAIRED",t.UNGROUPED="UNGROUPED",t.LUCKY_LOSER="LUCKY_LOSER",t.FEED_IN="FEED_IN",t.QUALIFIER="QUALIFIER",t.WILDCARD="WILDCARD"}(eu||(eu={}));var nu=eu.ALTERNATE,iu=eu.FEED_IN,ru=eu.QUALIFIER,au=eu.WILDCARD,ou=eu.DIRECT_ACCEPTANCE,su=eu.CONFIRMED,cu=eu.LUCKY_LOSER,uu=eu.ORGANISER_ACCEPTANCE,du=eu.WITHDRAWN,lu=eu.UNPAIRED,pu=eu.UNGROUPED,mu=[su,ou,uu],fu=[cu,iu,ru,au],hu=[iu,ru,cu,au,su,ou,uu],Iu=[nu,du,iu,lu,pu,ru,au,ou,su,cu,uu],vu={FEED_IN:iu,WILDCARD:au,UNPAIRED:lu,UNGROUPED:pu,ALTERNATE:nu,CONFIRMED:su,QUALIFIER:ru,WITHDRAWN:du,LUCKY_LOSER:cu,DIRECT_ACCEPTANCE:ou,ORGANISER_ACCEPTANCE:uu,DRAW_SPECIFIC_STATUSES:fu,EQUIVALENT_ACCEPTANCE_STATUSES:mu,VALID_ENTERED_TYPES:Iu,VALID_ENTRY_STATUSES:Iu,STRUCTURE_ENTERED_TYPES:hu,STRUCTURE_SELECTED_STATUSES:hu};function gu({drawDefinition:t}){let{extension:e}=ua({name:Gr,drawDefinition:t});return{entryProfile:(null==e?void 0:e.value)||t.entryProfile||{}}}function yu({stage:t,drawDefinition:e}){return Boolean(Uu({stage:t,drawDefinition:e})&&wu({stage:t,drawDefinition:e}))}function Uu({stage:t,drawDefinition:e}){const{entryProfile:n}=gu({drawDefinition:e}),i=Object.keys(n).includes(t);if(!i&&qo.includes(t)){return tu({drawDefinition:e,attributes:[{[t]:{drawSize:void 0,alternates:!0}}]}),!0}return i}function wu({stage:t,drawDefinition:e}){var n;const{entryProfile:i}=gu({drawDefinition:e});return i&&(null===(n=i[t])||void 0===n?void 0:n.drawSize)||0}function Su({stage:t,drawDefinition:e}){var n;const{entryProfile:i}=gu({drawDefinition:e});return i&&(null===(n=i[t])||void 0===n?void 0:n.qualifiersCount)||0}function Nu({stage:t,drawDefinition:e,entryStatus:n}){return e.entries.reduce(((e,i)=>i.entryStage===t&&i.entryStatus===n?e+1:e),0)}function Du({drawDefinition:t,stageSequence:e,entryStatuses:n,structureId:i,stages:r,stage:a}){var o;const s=(null===(o=t.entries)||void 0===o?void 0:o.reduce(((t,i)=>{const o=a&&i.entryStage===a||(null==r?void 0:r.length)&&r.includes(i.entryStage),s=!n||n.includes(i.entryStatus),c=i.stageSequence||1;return o&&(!e||c===e)&&s?t.concat(i):t}),[]))||[];return i&&!s.length?function({drawDefinition:t,structureId:e}){const n=[],i=(t.links||[]).find((t=>t.linkType===es&&t.target.structureId===e));if(i){const{finishingPositions:e,structureId:r}=i.source,{structure:a}=Wc({drawDefinition:t,structureId:r});if(a.structureType===Jo){(a.structures||[]).forEach((t=>{const{positionAssignments:i}=t,{structureId:r}=t,a=r,o=Object.assign({},...i.map((t=>{var e;const{participantId:n}=t,i=null===(e=oa({element:t,name:Qr}).extension)||void 0===e?void 0:e.value;return i?{[n]:i}:void 0})).filter(Boolean));Object.keys(o).filter((t=>{const n=o[t];return e.includes(n.groupOrder)})).forEach((t=>{const i=o[t],{groupOrder:r,GEMscore:s}=i,c=e.sort().indexOf(r)+1;n.push({GEMscore:s,groupingValue:a,participantId:t,placementGroup:c,entryStage:Wo,entryStatus:iu})}))}))}}return n}({drawDefinition:t,structureId:i}):s}function Pu({stage:t,drawDefinition:e}){return Nu({entryStatus:ou,drawDefinition:e,stage:t})}function Tu({stage:t,drawDefinition:e}){return Nu({entryStatus:au,drawDefinition:e,stage:t})}function Au({entryStatus:t=ou,drawDefinition:e,stage:n}){if(t===nu)return function({stage:t,drawDefinition:e}){var n;const{entryProfile:i}=gu({drawDefinition:e});return(null===(n=i[t])||void 0===n?void 0:n.alternates)||0}({stage:n,drawDefinition:e})?Object.assign({positionsAvailable:1/0},pt):{error:mn};const i=function({stage:t,drawDefinition:e}){const n=wu({stage:t,drawDefinition:e}),i=Su({drawDefinition:e,stage:t});return n&&n-i}({drawDefinition:e,stage:n}),r=function({stage:t,drawDefinition:e}){const{entryProfile:n}=gu({drawDefinition:e});return n[t].wildcardsCount||0}({stage:n,drawDefinition:e}),a=Nu({entryStatus:au,drawDefinition:e,stage:n}),o=a+Nu({entryStatus:ou,drawDefinition:e,stage:n}),s=i-o;return o>=i?{error:hn}:t===au?a<r?pt:{error:hn}:Object.assign({positionsAvailable:s},pt)}function Mu({drawDefinition:t,structureId:e,structure:n}){var i,r;let a,o=[];if(n||({structure:n,error:a}=Wc({drawDefinition:t,structureId:e})),!n)return{seedAssignments:[],error:Wt};e||(e=n.structureId);const{stage:s,stageSequence:c}=n;if(!a){if(s===Wo&&t){o=Du({drawDefinition:t,stageSequence:c,structureId:e,stage:s}).filter((t=>1===t.placementGroup)).sort(((t,e)=>t.GEMscore<e.GEMscore?1:t.GEMscore>e.GEMscore?-1:0)).map(((t,e)=>({participantId:t.participantId,seedNumber:e+1,seedValue:e+1,seedProxy:!0})))}else n.seedAssignments?o=n.seedAssignments:a=jt}return{seedAssignments:o,seedLimit:n.seedLimit||(null===(i=n)||void 0===i||null===(r=i.positionAssignments)||void 0===r?void 0:r.length),stage:s,stageSequence:c,error:a}}function bu({groupedOrder:t,roundPositionsCount:e}){if(!t||(null==t?void 0:t.length)<=e)return t;const n=dt(t,t.length/e).map((t=>t.reduce(((t,e)=>t+e)))),i=n.slice().sort(Ki);return n.map((t=>i.indexOf(t)+1))}function Eu(t){if(!Array.isArray(t))return"";const e=t.filter(z);if(!e.length)return"";return X([Math.min(...e),Math.max(...e)]).join("-")}function Cu({structure:t,drawDefinition:e,structureId:n}){let i,r=[];if(!t){if(!e)return{positionAssignments:r,error:Ut};if(({structure:t,error:i}=Wc({drawDefinition:e,structureId:n})),i)return{positionAssignments:r,error:i}}return t.structures?r=[].concat(...t.structures.map((t=>Cu({structure:t}).positionAssignments))):t.positionAssignments?r=t.positionAssignments:i=ie,{positionAssignments:r,error:i}}function Ru({structure:t,drawDefinition:e,structureId:n}){const{positionAssignments:i}=Cu({structure:t,drawDefinition:e,structureId:n}),r=i.filter((t=>t.participantId||t.bye||t.qualifier)),a=i.length===r.length,o=i.filter((t=>!t.participantId&&!t.bye&&!t.qualifier));return{byePositions:i.filter((t=>!t.participantId&&t.bye)),assignedPositions:r,qualifierPositions:i.filter((t=>!t.participantId&&t.qualifier)),unassignedPositions:o,positionAssignments:i,allPositionsAssigned:a}}function Ou({drawPositions:t,roundProfile:e,roundNumber:n}){const i=[void 0,void 0];if(t.reduce(((t,e)=>isNaN(parseInt(e))&&t),!0))return{orderedDrawPositions:i,displayOrder:i};const r=e[n],a=(null==r?void 0:r.pairedDrawPositions.find((e=>ut(e||[],t.filter(Boolean)))))||i,o=null==r?void 0:r.feedRound;if(function(t){return t.reduce(((t,e)=>!isNaN(parseInt(e))&&t),!0)}(t)){const e=t.sort(Ki);return{orderedDrawPositions:e,displayOrder:o?e:a}}if(o){const e=[t.find((t=>!isNaN(parseInt(t)))),void 0];return{orderedDrawPositions:e,displayOrder:e}}return{orderedDrawPositions:a,displayOrder:a}}function xu({matchUp:t}){let e,n=[],i=[],r=[],a=[];if(t||(e=ve),t&&!t.sides&&(e=ge),t&&!t.hasContext&&(e=Rn),!e){n=t.sides.map((t=>t.participantId));const e=t.sides.filter((t=>t.participantType===La)).map((t=>t.participantId)).filter(Boolean);a=t.sides.map((t=>t.participant&&t.participant.individualParticipants)).filter(Boolean).map((t=>t.map((t=>null==t?void 0:t.participantId)).filter(Boolean))),i=[].concat(...e,...a.flat()).filter(Boolean),r=X(i.concat(n)).filter(Boolean)}return{error:e,sideParticipantIds:n,individualParticipantIds:i,allRelevantParticipantIds:r,nestedIndividualParticipantIds:a}}function Lu({matchUp:t}){if(!t)return{error:ve};if(!t.hasContext)return{error:Rn};if(!t.sides||2!==t.sides.filter(Boolean).length)return{error:ge};const{sideParticipantIds:e,nestedIndividualParticipantIds:n,allRelevantParticipantIds:i}=xu({matchUp:t}),r=(t.timeItems||[]).filter((t=>[mr,fr].includes(null==t?void 0:t.itemType))).sort(((t,e)=>new Date(t.createdAt)-new Date(e.createdAt))),a=r.map((t=>t.itemValue)).filter((t=>r.filter((e=>(null==e?void 0:e.itemValue)===t)).reverse()[0].itemType===mr));n.forEach(((t,n)=>{const i=e[n],r=(null==t?void 0:t.length)&&t.reduce(((t,e)=>t&&e&&a.includes(e)),!0);i&&r&&!a.includes(i)&&a.push(i)})),e.forEach(((t,e)=>{a.includes(t)&&(n[e]||[]).forEach((t=>{t&&!a.includes(t)&&a.push(t)}))}));return{allParticipantsCheckedIn:e.reduce(((t,e)=>a.includes(e)&&t),!0),checkedInParticipantIds:a,allRelevantParticipantIds:i}}function Fu(t){const{matchUps:e,isCollectionMatchUp:n,matchUpStatuses:i,matchUpFormats:r,matchUpFormat:a,collectionIds:o,isMatchUpTie:s,matchUpTypes:c,roundNumbers:u,matchUpIds:d,scheduledDates:l,scheduledDate:p,processContext:m,tournamentIds:f,structureIds:h,courtIds:I,eventIds:v,venueIds:g,drawIds:y,stages:U,filterMatchUpIds:w=!0,filterMatchUpTypes:S=!0}=t,N=Array.isArray(i)?i.filter(Boolean):[],D=Array.isArray(U)?U.filter(Boolean):[],P=Array.isArray(o)?o.filter(Boolean):[],T=Array.isArray(u)?u.filter(Boolean):[],A=Array.isArray(d)&&w?d.filter(Boolean):[],M=Array.isArray(c)&&S?c.filter(Boolean):[],b=Array.isArray(I)?I.filter(Boolean):[],E=Array.isArray(g)?g.filter(Boolean):[],C=Array.isArray(r)?r.filter(Boolean):"string"==typeof a?[a]:[],R=Array.isArray(l)?l.filter(Boolean):"string"==typeof p&&p.length?[p]:[],O=Array.isArray(f)?f.filter(Boolean):[],x=Array.isArray(v)?v.filter(Boolean):[],L=Array.isArray(y)?y.filter(Boolean):[],F=Array.isArray(h)?h.filter(Boolean):[];return e.filter((t=>{if(void 0!==s){if(s&&!t.tieMatchUps)return!1;if(!s&&t.tieMatchUps)return!1}if(void 0!==n){if(n&&!t.collectionId)return!1;if(!n&&t.collectionId)return!1}if(D.length&&!D.includes(t.stage))return!1;if(P.length&&!P.includes(t.collectionId))return!1;if(T.length&&!u.includes(t.roundNumber))return!1;if(N.length&&!N.includes(t.matchUpStatus))return!1;if(A.length&&!A.includes(t.matchUpId))return!1;if(M.length&&!M.includes(t.matchUpType))return!1;if(C.length&&!C.includes(t.matchUpFormat))return!1;if(null!=R&&R.length){const{scheduledTime:e}=Da({matchUp:t}),{scheduledDate:n}=Pa({matchUp:t}),i=Oi(e)||n;if(!R.find((t=>Gi(t,i))))return!1}if(b.length){const{courtId:e}=Ta({matchUp:t});if(!I.filter(Boolean).includes(e))return!1}if(E.length){const{venueId:e}=Aa({matchUp:t});if(!g.filter(Boolean).includes(e))return!1}if(m){if(O.length&&!O.includes(t.tournamentId))return!1;if(x.length&&!x.includes(t.eventId))return!1;if(L.length&&!L.includes(t.drawId))return!1;if(F.length&&!F.includes(t.structureId))return!1}return!0}))}function ku({drawPositionCollectionAssignment:t,positionAssignments:e,displaySideNumber:n,seedAssignments:i,drawPosition:r,isFeedRound:a,sideNumber:o}){var s,c,u;const d=e.find((t=>t.drawPosition===r)),l=t?null===(s=t[r])||void 0===s?void 0:s.participantId:null==d?void 0:d.participantId,p=d?function({displaySideNumber:t,seedAssignments:e,participantId:n,assignment:i,sideNumber:r}){const a={drawPosition:i.drawPosition,displaySideNumber:t,sideNumber:r};if(n){const t=function({seedAssignments:t,participantId:e}){return t.find((t=>!t.seedProxy&&t.participantId===e))}({seedAssignments:e,participantId:n});Object.assign(a,t,{participantId:n})}else i.bye?Object.assign(a,{bye:!0}):i.qualifier&&Object.assign(a,{qualifier:!0});return a}({displaySideNumber:n,seedAssignments:i,participantId:l,assignment:d,sideNumber:o}):{};a&&(1===o?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0}));const m=null==t||null===(c=t[r])||void 0===c?void 0:c.teamParticipant,f=null==t||null===(u=t[r])||void 0===u?void 0:u.participant;return f&&Object.assign(p,{participant:f}),m&&Object.assign(p,{teamParticipant:m}),p}function ju({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:n,policyDefinitions:i,seedAssignments:r,drawDefinition:a,contextFilters:o,contextProfile:s,matchUpFilters:c,scheduleTiming:u,context:d={},matchUpsMap:l,roundFilter:p,structure:m,inContext:f,event:h}){var I,v,g,y,U;let w={},N={};if(!m)return{matchUps:[],collectionPositionMatchUps:w,roundMatchUps:N,error:Kt};const D=Array.isArray(null==c?void 0:c.eventIds)?c.eventIds.filter(Boolean):[],P=Array.isArray(null==c?void 0:c.structureIds)?c.structureIds.filter(Boolean):[],T=Array.isArray(null==c?void 0:c.drawIds)?c.drawIds.filter(Boolean):[],A=!(null!=d&&d.eventId)||!D.length&&!(null!=o&&null!==(I=o.eventIds)&&void 0!==I&&I.filter(Boolean).length)||D.includes(d.eventId)||(null==o||null===(v=o.eventIds)||void 0===v?void 0:v.includes(d.eventId)),M=!P.length||P.includes(m.structureId),b=!a||!T.length||T.includes(a.drawId);if(!A||!M||!b)return{matchUps:[],collectionPositionMatchUps:w,roundMatchUps:N};const{appliedPolicies:E}=Bc({drawDefinition:a}),C=Object.assign({},e,E,i),R=null==C||null===(g=C.scoring)||void 0===g?void 0:g.structures,O=(null==R?void 0:R.stage)&&(null==R?void 0:R.stage[m.stage]),x=(null==O?void 0:O.stageSequence)&&O.stageSequence[m.stageSequence],L=(null==C||null===(y=C.scoring)||void 0===y?void 0:y.requireAllPositionsAssigned)||(null==O?void 0:O.requireAllPositionsAssigned)||(null==x?void 0:x.requireAllPositionsAssigned);l||(l=Gc({drawDefinition:a,structure:m}));const{positionAssignments:F,allPositionsAssigned:k}=Ru({structure:m}),j=!L||k,{seedAssignments:B}=Mu({drawDefinition:a,matchUpsMap:l,structure:m});r=r||B;const{structureId:_,structureName:G,stage:V,stageSequence:H,exitProfile:W}=m,{drawId:q,drawName:K}=a||{},z=m.structures;let Y=Vc({matchUpsMap:l,structureId:_,inContext:f});const $=C&&C.roundNaming,{roundNamingProfile:J,roundProfile:Z}=function({roundNamingPolicy:t,structure:e,matchUps:n}){const i={},r=e.structures,{roundProfile:a}=_c({matchUps:n}),{structureAbbreviation:o,stage:s}=e,c=Ys.roundNaming,u=(null==t?void 0:t.roundNamingMap)||c.roundNamingMap||{},d=(null==t?void 0:t.appreviatedRoundNamingMap)||c.abbreviatedRoundNamingMap||{},l=(null==t?void 0:t.affixes)||c.affixes,p=s&&s!==_o&&s[0],m=null==t?void 0:t.stageConstants,f=m&&m[s]||p;return r?Object.assign(i,...Object.keys(a).map((t=>({[t]:{roundName:`R${t}`}})))):Object.assign(i,...Object.keys(a).map((t=>{const{matchUpsCount:e,preFeedRound:n}=a[t],i=2*e,r=u[e]||`${l.roundNumber}${i}`,s=n?`-${l.preFeedRound}`:"",c=[f,o,`${r}${s}`].filter(Boolean).join("-"),p=d[e]||`${l.roundNumber}${i}`;return{[t]:{abbreviatedRoundName:[f,o,`${p}${s}`].filter(Boolean).join("-"),roundName:c}}}))),{roundNamingProfile:i,roundProfile:a}}({roundNamingPolicy:$,drawDefinition:a,structure:m,matchUps:Y});if(c&&(Y=Fu({matchUps:Y,...c,filterMatchUpTypes:!1,filterMatchUpIds:!1})),f){var Q;const{sourceDrawPositionRanges:e}=function({drawDefinition:t,structureId:e,matchUpsMap:n}){if(!t)return{error:Ut};if(!e)return{error:Ht};const{structure:i}=Wc({drawDefinition:t,structureId:e});if(i.stage!==Vo)return{message:"Structure is not CONSOLATION stage"};const{links:r}=t,a=(null==r?void 0:r.filter((t=>t.target.structureId===e)))||[],o=(null==a?void 0:a.reduce(((t,e)=>{const{structureId:n}=e.source;return t.includes(n)?t:t.concat(n)}),[]))||[],s=Object.assign({},...o.map((t=>{const e=Vc({matchUpsMap:n,structureId:t}),{roundProfile:i}=_c({matchUps:e});return{[t]:i}}))),c=Vc({matchUpsMap:n,structureId:e}),{roundProfile:u}=_c({matchUps:c}),d={};return null==a||a.forEach((t=>{const{structureId:e,roundNumber:n}=t.source,{feedProfile:i,groupedOrder:r,positionInterleave:a,roundNumber:o}=t.target,c=s[e],l=c[1]&&c[1].drawPositions,p=c[n],m=null==p?void 0:p.matchUpsCount;if(!m)return;const f=m?l.length/m:0,h=l.length/f;let I=l.slice();const v=bu({groupedOrder:r,roundPositionsCount:I.length}),g=(null==v?void 0:v.length)||1;if(g<=h){const t=dt(I,l.length/g);i===ts&&t.forEach((t=>t.reverse())),I=(null==v?void 0:v.length)&&(null==v?void 0:v.map((e=>t[e-1])).flat())||I}let y=dt(I,f);if(null!=v&&v.length||i===ts&&y.reverse(),a){const t=ot(0,a.interleave).map((()=>{})),e=ot(0,a.offset).map((()=>{}));y=y.map((e=>[e,...t])),y.unshift(e),y=y.flat(1);const n=y.length-a.offset;y=y.slice(0,n)}d[o]||(d[o]={});const U=u[o],w=null!=U&&U.feedRound?2:1;y.forEach(((t,e)=>{const n=1+e*w;d[o][n]||(d[o][n]=Eu(t))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:a,matchUpsMap:l,structureId:_}),{drawPositionsRanges:n}=function({drawDefinition:t,structureId:e,matchUpsMap:n}){var i;if(!t)return{error:Ut};if(!e)return{error:Ht};const r=Vc({matchUpsMap:n,structureId:e}),{roundProfile:a}=_c({matchUps:r}),o=(Math.min(...(null===(i=a[1])||void 0===i?void 0:i.drawPositions)||[])||1)-1,s=Object.keys(a);return{drawPositionsRanges:Object.assign({},...(s||[]).map((t=>{var e;const{matchUpsCount:n}=a[t],i=(null===(e=a[1])||void 0===e?void 0:e.drawPositions)||[],r=dt(i,i.length/n),c=r.map(Eu),u=r.map((t=>t.map((t=>t-o)))).map(Eu),d=s.map((e=>{if(e>t)return;const{drawPositions:i}=a[e];return dt(i,i.length/n)})).filter(Boolean),l=ot(0,n).map((t=>d.map((e=>e[t])).flat().filter(Boolean).sort(Ki))).map((t=>X(t))),p=l.map((t=>{return(e=t,e.reduce(((t,e)=>{const n=t[t.length-1];return n&&n[n.length-1]===e-1||t.push([]),t[t.length-1].push(e),t}),[])).map(Eu).join(", ");var e})),m=Object.assign({},...ot(0,n).map((t=>({[t+1]:{firstRoundDrawPositionsRange:c[t],firstRoundOffsetDrawPositionsRange:u[t],possibleDrawPositions:l[t],drawPositionsRange:p[t]}}))));return{[t]:m}})))}}({drawDefinition:a,matchUpsMap:l,structureId:_});Y=Y.map((i=>et({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,drawPositionsRanges:n,roundNamingProfile:J,appliedPolicies:C,isRoundRobin:z,roundProfile:Z,matchUp:i,event:h})));(null===(Q=Y)||void 0===Q?void 0:Q.filter((t=>Array.isArray(t.tieMatchUps)))).forEach((t=>{const e=t.tieMatchUps;Y=Y.concat(...e)})),o&&(Y=Fu({processContext:!0,...o,matchUps:Y}))}else{var tt;(null===(tt=Y)||void 0===tt?void 0:tt.filter((t=>Array.isArray(t.tieMatchUps)))).forEach((t=>{const e=t.tieMatchUps;Y=Y.concat(...e)}))}return(null!=c&&c.matchUpTypes||null!=c&&c.matchUpIds)&&(Y=Fu({matchUpTypes:c.matchUpTypes,matchUpIds:c.matchUpIds,matchUps:Y})),({roundMatchUps:N}=_c({matchUps:Y})),({collectionPositionMatchUps:w}=function({matchUps:t}){const e=t.reduce(((t,e)=>!e.collectionPosition||t.includes(e.collectionPosition)?t:t.concat(e.collectionPosition)),[]).map((e=>({[e]:t.filter((t=>t.collectionPosition===e))})));return{collectionPositionMatchUps:Object.assign({},...e)}}({matchUps:Y})),p&&(Y=null===(U=Y)||void 0===U?void 0:U.filter((t=>t.roundNumber===p))),{matchUps:Y,roundMatchUps:N,collectionPositionMatchUps:w};function et({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,additionalContext:i={},drawPositionsRanges:o,roundNamingProfile:c,tieDrawPositions:l,appliedPolicies:p,isCollectionBye:f,matchUpTieId:h,isRoundRobin:I,roundProfile:v,sideLineUps:g,matchUp:y,event:U}){var w,N;const D=y.tieFormat||m.tieFormat||(null==a?void 0:a.tieFormat)||(null==U?void 0:U.tieFormat),P=null==D?void 0:D.collectionDefinitions,T=y.collectionId&&(null==P?void 0:P.find((t=>t.collectionId===y.collectionId))),A=y.matchUpFormat||y.collectionId?T&&T.matchUpFormat:m.matchUpFormat||(null==a?void 0:a.matchUpFormat)||(null==U?void 0:U.matchUpFormat),M=y.matchUpType||(null==T?void 0:T.matchUpType)||m.matchUpType||(null==a?void 0:a.matchUpType)||(null==U?void 0:U.eventType)!==Ea&&(null==U?void 0:U.eventType),b=f?S:y.matchUpStatus,{schedule:E,endDate:C}=Ra({scheduleVisibilityFilters:t,scheduleTiming:u,matchUpFormat:A,matchUpType:M,matchUp:y,event:U}),R=l||y.drawPositions,{collectionPosition:O,collectionId:x,roundPosition:L}=y,k=y.roundNumber||i.roundNumber,B=function({tournamentParticipants:t,positionAssignments:e,collectionPosition:n,drawPositions:i=[],drawDefinition:r,collectionId:a,sideLineUps:o,matchUpType:s}){if(!a||!n)return;const c=(null==i?void 0:i.map((i=>{var c,u,d;const l=null===(c=e.find((t=>t.drawPosition===i)))||void 0===c?void 0:c.participantId,p=null==o?void 0:o.find((t=>(null==t?void 0:t.drawPosition)===i)),m=(null==p?void 0:p.teamParticipant)||(null==t?void 0:t.find((({participantId:t})=>t===l))),f=(null==p?void 0:p.lineUp)||(null===(u=Rc({participantId:l,drawDefinition:r}))||void 0===u?void 0:u.lineUp),h=null==f?void 0:f.filter((t=>t.collectionAssignments.find((t=>t.collectionId===a&&t.collectionPosition===n))));if(s===pa||2===(null==h?void 0:h.length)){const e=null==h?void 0:h.map(Fc),{participant:n}=Cc({tournamentParticipants:t,participantIds:e}),r=null==n?void 0:n.participantId;return{[i]:{participantId:r,teamParticipant:m}}}const I=null==h||null===(d=h[0])||void 0===d?void 0:d.participantId;return I&&{[i]:{participantId:I,teamParticipant:m}}})).filter(Boolean))||{};return Object.assign({},...c)}({tournamentParticipants:n,positionAssignments:F,collectionPosition:O,drawDefinition:a,drawPositions:R,collectionId:x,sideLineUps:g,matchUpType:M}),z=c&&(null===(w=c[k])||void 0===w?void 0:w.roundName)||i.roundName,Y=c&&(null===(N=c[k])||void 0===N?void 0:N.abbreviatedRoundName)||i.abbreviatedRoundName,$=v&&v[k]&&v[k].feedRound,J=o&&o[k],Z=J&&J[L],Q=e&&e[k],X=t=>Wi(t,void 0,!0),tt=Object.assign({},X(d),X({matchUpFormat:y.matchUpType!==Ea&&A,tieFormat:y.matchUpType===Ea&&D,endDate:y.endDate||C,abbreviatedRoundName:Y,drawPositionsRange:Z,structureName:G,stageSequence:H,drawPositions:R,matchUpStatus:b,matchUpTieId:h,matchUpType:M,exitProfile:W,structureId:_,roundNumber:k,feedRound:$,roundName:z,drawName:K,schedule:E,drawId:q,stage:V}),Hi(X(y),!0,!0));if(Array.isArray(R)){const{orderedDrawPositions:t,displayOrder:e}=Ou({drawPositions:R,roundProfile:v,roundPosition:L,roundNumber:k}),n=v[k]&&v[k].feedRound,i=e[0]!==t[0],a=t.map(((t,e)=>{var a;const o=e+1,s=ku({drawPositionCollectionAssignment:B,positionAssignments:F,displaySideNumber:i?3-o:o,seedAssignments:r,drawPosition:t,isFeedRound:n,sideNumber:o}),c=null===(a=y.sides)||void 0===a?void 0:a.find((t=>t.sideNumber===o)),u=Q&&Q[2*(L-1)+e+1];return X({...s,...c,sourceDrawPositionRange:u})}));Object.assign(tt,Hi({sides:a},!0,!0))}if(n&&tt.sides&&(tt.sides.filter(Boolean).forEach((t=>{if(t.participantId){const e=ra({policyDefinitions:p,participantId:t.participantId,tournamentParticipants:n});e&&Object.assign(t,{participant:e})}if(t.participant&&t.participant.individualParticipantIds){const e=t.participant.individualParticipantIds.map((t=>ra({policyDefinitions:p,tournamentParticipants:n,participantId:t})));Object.assign(t.participant,{individualParticipants:e})}})),!tt.matchUpType)){const{matchUpType:t}=function({matchUp:t={}}={}){var e;let n=t.matchUpType;if(!n&&null!==(e=t.sides)&&void 0!==e&&e.length){const e=t.sides.find((({participant:t})=>t)),i=null==e?void 0:e.participant,r=null==i?void 0:i.participantType;n=r===La?la:r===ka?pa:r===Fa?Fa:void 0}return{matchUpType:n}}({matchUp:tt});t&&Object.assign(tt,{matchUpType:t})}if(tt.tieMatchUps){var nt;const n=tt.matchUpStatus===S,i=null===(nt=tt.sides)||void 0===nt?void 0:nt.map((({participant:t,drawPosition:e,sideNumber:n,lineUp:i})=>{const r=(null==t?void 0:t.participantType)===Ea&&t;return{teamParticipant:r&&Wi({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participanOthertName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}),drawPosition:e,sideNumber:n,lineUp:i}}));tt.tieMatchUps=tt.tieMatchUps.map((r=>{const a=tt.matchUpId;return et({tieDrawPositions:R,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:i,drawPositionsRanges:o,roundNamingProfile:c,additionalContext:{abbreviatedRoundName:Y,roundNumber:k,roundName:z},appliedPolicies:p,isCollectionBye:n,matchUpTieId:a,isRoundRobin:I,roundProfile:v,matchUp:r,event:U})}))}const it=tt.sides&&2===tt.sides.filter((t=>t&&t.participantId)).length,rt=!tt.winningSide,at=j&&it&&rt;if(Object.assign(tt,{readyToScore:at,hasContext:!0}),it){const{allParticipantsCheckedIn:t,checkedInParticipantIds:e}=Lu({matchUp:tt});Object.assign(tt,{allParticipantsCheckedIn:t,checkedInParticipantIds:e})}return Array.isArray(null==s?void 0:s.exclude),tt}}function Bu({tournamentParticipants:t,drawDefinition:e,contextProfile:n,matchUpsMap:i,matchUpId:r,inContext:a,context:o,event:s}){if(!e)return{error:Ut};if(!r)return{error:me};if("string"!=typeof r)return{error:_n};const{structures:c}=qc({drawDefinition:e});for(const u of c){const{matchUps:c}=ju({tournamentParticipants:t,drawDefinition:e,contextProfile:n,matchUpsMap:i,inContext:a,structure:u,context:o,event:s}),{matchUp:d}=Oa({matchUps:c,matchUpId:r});if(d)return{matchUp:d,structure:u}}return{error:he}}function _u({duplicateValues:t,drawDefinition:e,disableNotice:n,matchUpId:i,timeItem:r,event:a}){const{matchUp:o}=Bu({drawDefinition:e,event:a,matchUpId:i});if(!o)return{error:he};const s=oc({element:o,timeItem:r,duplicateValues:t});return n||Mc({drawDefinition:e,matchUp:o}),s}function Gu({tournamentRecord:t}){if(!t)return{error:It};const e=Hi(t.venues||[]),n=e.reduce(((t,e)=>{var n;return null!=e&&null!==(n=e.courts)&&void 0!==n&&n.length?t.concat(e.courts):t}),[]);return{venues:e,courts:n}}function Vu({tournamentRecord:t,venueId:e}){if(!t)return{error:It};if(!e)return{error:Dn};const n=(t.venues||[]).reduce(((t,n)=>n.venueId===e?n:t),void 0);return n&&{venue:n}||{error:Nn}}function Hu({tournamentRecord:t,drawDefinition:e,matchUpId:n,venueId:i,disableNotice:r}){if(!t)return{error:It};if(!n)return{error:me};if(i){const{error:e}=Vu({tournamentRecord:t,venueId:i});if(e)return{error:e}}return _u({drawDefinition:e,matchUpId:n,timeItem:{itemType:Ir,itemValue:i},disableNotice:r,duplicateValues:!1})}function Wu({tournamentRecord:t,courtId:e}){if(!t)return{error:It};if(!e)return{error:be};let n,i;return(t.venues||[]).forEach((t=>{(t.courts||[]).forEach((r=>{r.courtId===e&&(n=r,i=t)}))})),n&&{court:n,venue:i}||{error:Un}}function qu({tournamentRecord:t,venueId:e,venueIds:n}){if(!t)return{error:It};return{courts:(t.venues||[]).filter((t=>e?t.venueId===e:n?n.includes(t.venueId):!e&&!n)).map((t=>{const{venueId:e}=t,n=Hi(t.courts||[]);return n.forEach((t=>Object.assign(t,{venueId:e}))),n})).flat()}}function Ku({tournamentRecord:t,drawDefinition:e,courtDayDate:n,matchUpId:i,courtId:r,disableNotice:a}){if(!t)return{error:It};if(!i)return{error:me};if(r){const{venue:n,error:o}=Wu({tournamentRecord:t,courtId:r});if(o)return{error:o};Hu({tournamentRecord:t,drawDefinition:e,matchUpId:i,venueId:null==n?void 0:n.venueId,disableNotice:a})}return _u({drawDefinition:e,matchUpId:i,timeItem:{itemType:hr,itemDate:n,itemValue:r},disableNotice:a,duplicateValues:!1})}function zu(t){if(vi.test(t)){const e=Ni(new Date);return new Date(`${e}T${t}`)}return new Date(t)}function Yu(t){return!(void 0!==t&&!yi.test(t))}function $u({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,schedule:r,event:a}){if(!e)return{error:Ut};if(!i)return{error:me};if(!r)return{error:Ee};const{endTime:o,courtId:s,resumeTime:c,scheduledDate:u,scheduledTime:d,startTime:l,stopTime:p,venueId:m}=r;if(void 0!==u){const t=Ju({drawDefinition:e,matchUpId:i,scheduledDate:u,disableNotice:!0});if(null!=t&&t.error)return{error:t.error,scheduledDate:u}}if(void 0!==d){const t=Zu({drawDefinition:e,matchUpId:i,scheduledTime:d,disableNotice:!0});if(null!=t&&t.error)return{error:t.error,scheduledTime:d}}if(void 0!==l){const t=Xu({disableNotice:!0,drawDefinition:e,matchUpId:i,startTime:l,event:a});if(null!=t&&t.error)return{error:t.error,startTime:l}}if(void 0!==p){const t=ed({disableNotice:!0,drawDefinition:e,matchUpId:i,stopTime:p,event:a});if(null!=t&&t.error)return{error:t.error,stopTime:p}}if(void 0!==c){const t=nd({disableNotice:!0,drawDefinition:e,resumeTime:c,matchUpId:i,event:a});if(null!=t&&t.error)return{error:t.error,resumeTime:c}}if(void 0!==o){const t=td({disableNotice:!0,drawDefinition:e,matchUpId:i,endTime:o,event:a});if(null!=t&&t.error)return{error:t.error,endTime:o}}if(void 0!==s&&void 0!==u){const n=Ku({courtDayDate:u,disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,courtId:s,event:a});if(null!=n&&n.error)return{error:n.error,courtId:s}}else if(void 0!==m){const n=Hu({disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,venueId:m,event:a});if(null!=n&&n.error)return{error:n.error,venueId:m}}if(!n){const{matchUp:t}=Bu({drawDefinition:e,event:a,matchUpId:i});if(!t)return{error:he};Mc({drawDefinition:e,matchUp:t})}return{...pt}}function Ju({drawDefinition:t,matchUpId:e,disableNotice:n,scheduledDate:i}){if(!e)return{error:me};const r=gi.test(i);if(i&&!r)return{error:Fe};return _u({drawDefinition:t,matchUpId:e,timeItem:{itemType:vr,itemValue:i},disableNotice:n,duplicateValues:!1})}function Zu({drawDefinition:t,matchUpId:e,disableNotice:n,scheduledTime:i}){if(!e)return{error:me};if(!Yu(i))return{error:ke};return _u({drawDefinition:t,matchUpId:e,timeItem:{itemType:gr,itemValue:i},disableNotice:n,duplicateValues:!1})}function Qu({drawDefinition:t,matchUpId:e,disableNotice:n,participantId:i,officialType:r}){if(!e)return{error:me};return _u({drawDefinition:t,matchUpId:e,timeItem:{itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemSubTypes:[r],itemValue:i},disableNotice:n,duplicateValues:!1})}function Xu({drawDefinition:t,disableNotice:e,matchUpId:n,startTime:i,event:r}){if(!n)return{error:me};if(!Yu(i))return{error:ke};const{matchUp:a}=Bu({drawDefinition:t,event:r,matchUpId:n}),o=(a.timeItems||[]).filter((t=>[Ur,wr,Sr].includes(null==t?void 0:t.itemType))).map((t=>zu(t.itemValue))).reduce(((t,e)=>!t||e<t?e:t),void 0);if(!o||zu(i)<o){a.timeItems&&(a.timeItems=a.timeItems.filter((t=>t.itemType!==yr)));return _u({drawDefinition:t,matchUpId:n,timeItem:{itemType:yr,itemValue:i},disableNotice:e,duplicateValues:!1})}return{error:Mn}}function td({drawDefinition:t,disableNotice:e,matchUpId:n,endTime:i,event:r}){if(!n)return{error:me};if(!Yu(i))return{error:ke};const{matchUp:a}=Bu({drawDefinition:t,event:r,matchUpId:n}),o=(a.timeItems||[]).filter((t=>[yr,wr,Ur].includes(null==t?void 0:t.itemType))).map((t=>zu(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(!o||zu(i)>o){a.timeItems&&(a.timeItems=a.timeItems.filter((t=>t.itemType!==Sr)));return _u({drawDefinition:t,matchUpId:n,timeItem:{itemType:Sr,itemValue:i},disableNotice:e,duplicateValues:!1})}return{error:Pn}}function ed({drawDefinition:t,disableNotice:e,matchUpId:n,stopTime:i,event:r}){if(!n)return{error:me};if(!Yu(i))return{error:ke};const{matchUp:a}=Bu({drawDefinition:t,event:r,matchUpId:n}),o=a.timeItems||[];if(o.reduce(((t,e)=>e.itemType===Sr||t),void 0))return{error:Tn};const s=o.filter((t=>[yr,wr,Ur].includes(null==t?void 0:t.itemType))).sort(((t,e)=>zu(t.itemValue)-zu(e.itemValue))),c=s[s.length-1],u=c&&c.itemType===Ur,d=s.filter((t=>!u||t.createdAt!==c.createdAt)).map((t=>zu(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(zu(i)>d){if(a.timeItems&&u){const t=c.createdAt;a.timeItems=a.timeItems.filter((e=>e.createdAt!==t))}return _u({drawDefinition:t,matchUpId:n,timeItem:{itemType:Ur,itemValue:i},disableNotice:e,duplicateValues:!0})}return{error:An}}function nd({drawDefinition:t,disableNotice:e,resumeTime:n,matchUpId:i,event:r}){if(!i)return{error:me};if(!Yu(n))return{error:ke};const{matchUp:a}=Bu({drawDefinition:t,event:r,matchUpId:i}),o=a.timeItems||[];if(o.reduce(((t,e)=>e.itemType===Sr||t),void 0))return{error:Tn};const s=o.filter((t=>[yr,wr,Ur].includes(null==t?void 0:t.itemType))).sort(((t,e)=>zu(t.itemValue)-zu(e.itemValue))),c=s[s.length-1],u=c&&c.itemType===wr,d=s.filter((t=>!u||t.createdAt!==c.createdAt)).map((t=>zu(t.itemValue))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(zu(n)>d){if(a.timeItems&&u){const t=c.createdAt;a.timeItems=a.timeItems.filter((e=>e.createdAt!==t))}return _u({drawDefinition:t,matchUpId:i,timeItem:{itemType:wr,itemValue:n},disableNotice:e,duplicateValues:!0})}return{error:"Invalid resumeTime"}}function id({participants:t=[]}){const e=Hi(t,!0,!0),n=e.filter((t=>t.participantType===Fa)),i=e.filter((t=>t.participantType===ja)),r=e.filter((t=>t.participantType===ka));return e.forEach((t=>{if(t.participantType===La){const{participantId:e}=t;t.teams=[],t.teamParticipantIds=[],t.groups=[],t.groupParticipantIds=[],t.pairParticipantIds=[],n.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==e||t.teamParticipantIds.includes(n.participantId)||(t.teamParticipantIds.push(n.participantId),t.teams.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId,teamId:n.teamId}))}))})),r.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==e||t.pairParticipantIds.includes(n.participantId)||t.pairParticipantIds.push(n.participantId)}))})),i.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==e||t.groupParticipantIds.includes(n.participantId)||(t.groupParticipantIds.push(n.participantId),t.groups.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId}))}))}))}})),e}function rd({drawDefinition:t,inContextDrawMatchUps:e,targetLink:n,sourceRoundPosition:i,sourceRoundMatchUpCount:r}){if(!n)return{error:Gt};const{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:u}}=n,{structure:d}=Wc({drawDefinition:t,structureId:a}),{positionAssignments:l}=Cu({structure:d}),p=(null==e?void 0:e.filter((t=>t.structureId===d.structureId))).filter((t=>t.roundNumber===c)),m=p.length,f=ot(1,m+1),h=m/r;let I=Math.ceil(h*i),v=1-i%2;if(null!=u&&u.interleave&&.5!==h){const t=i+(u.offset+(i-1)*u.interleave);I=Math.ceil(t/2),v=1-t%2}let g=f,y=f[I-1];const U=bu({groupedOrder:s,roundPositionsCount:f.length}),w=(null==U?void 0:U.length)||1;if(w<=f.length){const t=dt(f,m/w);o===ts&&t.forEach((t=>t.reverse())),g=(null==U?void 0:U.length)&&(null==U?void 0:U.map((e=>t[e-1])).flat())||g}o===Xo?y=g[I-1]:o===ts?((null==U||!U.length||w>f.length)&&(I=p.length+1-I),y=g[I-1]):o===Qo?ei()&&console.log("not implemented:",{feedProfile:o}):o===Zo&&ei()&&console.log("not implemented:",{feedProfile:o});const S=y&&p.reduce(((t,e)=>e.roundPosition===y?e:t),void 0);let N;var D;null!=S&&S.feedRound?(v=0,N=Math.min(...(S.drawPositions||[]).filter(Boolean))):N=2===(null==S||null===(D=S.drawPositions)||void 0===D?void 0:D.length)&&(null==S?void 0:S.drawPositions[v]);const P=l.find((({drawPosition:t})=>t===N));if(P){const{extension:t}=oa({element:P,name:_r});if(null!=t&&t.value)return{disabledDrawPosition:N}}return{matchUp:S,targetDrawPosition:N,matchUpDrawPositionIndex:v}}function ad({source:t,linkType:e,finishingPositions:n}){return t.reduce(((t,i)=>{var r,a;return(!(null!==(r=i.source)&&void 0!==r&&r.finishingPositions)||!n||ut(n,null===(a=i.source)||void 0===a?void 0:a.finishingPositions))&&i.linkType===e?i:t}),void 0)}function od({drawDefinition:t,structureId:e,roundNumber:n}){if(!t)return{error:Ut};if(!e)return{error:Ht};return{links:(t.links||[]).filter(Boolean).reduce(((t,i)=>{var r,a;return(null===(r=i.source)||void 0===r?void 0:r.structureId)!==e||n&&i.source.roundNumber!==n||(t.source=t.source.concat(i)),(null===(a=i.target)||void 0===a?void 0:a.structureId)!==e||n&&i.target.roundNumber!==n||(t.target=t.target.concat(i)),t}),{source:[],target:[]})}}function sd({matchUpId:t,drawDefinition:e,inContextDrawMatchUps:n=[],inContextMatchUp:i,useTargetMatchUpIds:r=!1}){let a=i;n.length&&!a&&(a=n.find((e=>e.matchUpId===t)));const{structure:o}=Wc({drawDefinition:e,structureId:a.structureId}),{finishingPosition:s}=o;return s===Es?function({matchUp:t,structure:e,drawDefinition:n,inContextDrawMatchUps:i,useTargetMatchUpIds:r}){const{links:{source:a}}=function({drawDefinition:t,roundNumber:e,structureId:n}){if(!t)return{error:Ut};if(!n)return{error:Ht};const{links:i}=od({drawDefinition:t,structureId:n});return{links:{source:i.source.reduce(((t,n)=>n.source.roundNumber&&n.source.roundNumber!==e?t:t.concat(n)),[]),target:i.target.reduce(((t,n)=>n.target.roundNumber&&n.target.roundNumber!==e?t:t.concat(n)),[])}}}({drawDefinition:n,roundNumber:t.roundNumber,structureId:e.structureId}),o=ad({source:a,linkType:ns}),s=ad({source:a,linkType:is}),{winnerMatchUpId:c,loserMatchUpId:u}=t;let d,l,p,m,f,h,I;r&&(m=c&&i.find((({matchUpId:t})=>t===c)),d=u&&i.find((({matchUpId:t})=>t===u)));if(o&&!m||s&&!d){const{roundPosition:r}=t;I=I||i.filter((t=>t.structureId===e.structureId));const a=I.reduce(((e,n)=>n.roundNumber===t.roundNumber?e+1:e),0);s&&({matchUp:d,matchUpDrawPositionIndex:p,targetDrawPosition:l}=rd({drawDefinition:n,inContextDrawMatchUps:i,sourceRoundPosition:r,sourceRoundMatchUpCount:a,targetLink:s})),o&&({matchUp:m,matchUpDrawPositionIndex:h,targetDrawPosition:f}=rd({drawDefinition:n,inContextDrawMatchUps:i,sourceRoundPosition:r,sourceRoundMatchUpCount:a,targetLink:o}))}m||(I=I||i.filter((t=>t.structureId===e.structureId)),({matchUp:m}=function({structureMatchUps:t,matchUp:e}){const{roundNumber:n,roundPosition:i}=e,r=t.filter((t=>t.roundNumber===n)),a=t.filter((t=>t.roundNumber===n+1));if(a.length){let t;return a.length===r.length?t=a.find((t=>t.roundPosition===i)):a.length===r.length/2&&(t=a.find((t=>t.roundPosition===Math.ceil(i/2)))),{matchUp:t}}return{error:"no progression found"}}({structureMatchUps:I,matchUp:t})));return{matchUp:t,targetLinks:{loserTargetLink:s,winnerTargetLink:o},targetMatchUps:{loserMatchUp:d,winnerMatchUp:m,loserTargetDrawPosition:l,winnerTargetDrawPosition:f,loserMatchUpDrawPositionIndex:p,winnerMatchUpDrawPositionIndex:h}}}({drawDefinition:e,inContextDrawMatchUps:n,structure:o,matchUp:a,useTargetMatchUpIds:r}):function({matchUp:t}){return{matchUp:t,targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0}}}({drawDefinition:e,matchUp:a,structure:o})}function cd({drawDefinition:t,inContextDrawMatchUps:e}){const n={};return e.forEach((i=>{const{matchUpId:r,structureId:a,drawPositions:o=[]}=i,{structure:s}=Wc({drawDefinition:t,structureId:a});if((null==s?void 0:s.finishingPosition)===bs){const{roundNumber:t}=i,e=t&&parseInt(t)+1,n=s.matchUps||[],{roundMatchUps:r}=_c({matchUps:n});if(e&&r[e]){const t=o.sort().map(((t,n)=>{const i=r[e].find((e=>{var n;return null===(n=e.drawPositions)||void 0===n?void 0:n.includes(t)}));return{matchUpId:null==i?void 0:i.matchUpId,roundNumber:e,schedule:null==i?void 0:i.schedule,sideNumber:n+1,structureName:s.structureName}}));Object.assign(i,{sidesTo:t})}}else{var c,u;const a=sd({matchUpId:r,drawDefinition:t,inContextMatchUp:i,inContextDrawMatchUps:e,useTargetMatchUpIds:!0}),{winnerMatchUp:o,loserMatchUp:s}=a.targetMatchUps;!i.winnerMatchUpId&&o&&(i.winnerMatchUpId=o.matchUpId),!i.loserMatchUpId&&s&&(i.loserMatchUpId=s.matchUpId);const I=dd({upcomingMatchUp:o});let v=dd({upcomingMatchUp:s});if(i.matchUpStatus!==S&&(null==s?void 0:s.matchUpStatus)===S){const{matchUp:n}=ud({matchUp:s,drawDefinition:t,inContextDrawMatchUps:e})||{};v=n&&dd({upcomingMatchUp:n})||v}const g=null===(c=i.schedule)||void 0===c?void 0:c.timeAfterRecovery;if(g){var d,l,p;if(null!=I&&null!==(d=I.schedule)&&void 0!==d&&d.scheduledTime){Ei(I.schedule.scheduledTime)<Ei(g)&&(n[I.matchUpId]=i.matchUpId,I.schedule.scheduleConflict=i.matchUpId)}if(null!==(l=v)&&void 0!==l&&null!==(p=l.schedule)&&void 0!==p&&p.scheduledTime){Ei(I.schedule.scheduledTime)<Ei(g)&&(n[v.matchUpId]=i.matchUpId,v.schedule.scheduleConflict=i.matchUpId)}}if(Object.assign(i,{winnerTo:I,loserTo:v}),null!==(u=i.drawPositions)&&void 0!==u&&u.filter(Boolean).length){var m;const t=null===(m=a.targetLinks)||void 0===m?void 0:m.loserTargetLink,e=(null==t?void 0:t.linkCondition)===rs,n=(null==(f=i)||null===(h=f.sides)||void 0===h?void 0:h.map((({participant:t,participantId:e,qualifier:n})=>t||e&&{participantId:e}||n&&{qualifier:n})).filter(Boolean))||[];if(n.length){const t=Lc(null==o?void 0:o.sides),i=Lc(null==s?void 0:s.sides),r=n.find((({participantId:e})=>t.includes(e)))?[]:n,a=n.find((({participantId:t})=>i.includes(t)))?[]:n;s&&e&&a.length<2&&a.push({bye:!0,tbd:!0}),null!=r&&r.length&&o&&(o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(r)),null!=a&&a.length&&s&&(s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(a))}}}var f,h})),Object.keys(n).length&&e.forEach((t=>{Object.keys(n).includes(t.matchUpId)&&(t.schedule.scheduleConflict=n[t.matchUpId])})),{scheduleConflictMatchUpIds:n}}function ud({matchUp:t,drawDefinition:e,inContextDrawMatchUps:n}){const{matchUpId:i,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||(null==t?void 0:t.matchUpStatus)===O)return{matchUp:t};if(r===S){let r;if(t.winnerMatchUpId)r=n.find((({matchUpId:e})=>e===t.winnerMatchUpId));else{const t=sd({matchUpId:i,drawDefinition:e,inContextDrawMatchUps:n});({winnerMatchUp:r}=(null==t?void 0:t.targetMatchUps)||{})}return ud({matchUp:r,drawDefinition:e,inContextDrawMatchUps:n})}return{matchUp:void 0}}function dd({upcomingMatchUp:t}={}){if(t)return(({matchUpId:t,structureId:e,schedule:n,roundNumber:i,roundPosition:r,structureName:a})=>({matchUpId:t,structureId:e,schedule:n,roundNumber:i,roundPosition:r,structureName:a}))(t)}function ld({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:n,tournamentParticipants:i,policyDefinitions:r,drawDefinition:a,matchUpFilters:o,contextFilters:s,contextProfile:c,scheduleTiming:u,matchUpsMap:d,roundFilter:l,structureId:p,inContext:m,structure:f,context:h,event:I}){!f&&p&&({structure:f}=Wc({drawDefinition:a,structureId:p}));const{matchUps:v,error:g}=ju({tournamentAppliedPolicies:n,scheduleVisibilityFilters:e,tournamentParticipants:i,policyDefinitions:r,drawDefinition:a,matchUpFilters:o,contextFilters:s,contextProfile:c,scheduleTiming:u,matchUpsMap:d,structure:f,inContext:m,context:h,event:I});if(g)return{error:g};const{assignedPositions:y}=Ru({structure:f}),w=y.filter((t=>t.participantId)).map((t=>t.drawPosition)),S=[],N=[],D=[],P=[],T=[];return v.filter((t=>{var e;const n=1===(null==o||null===(e=o.matchUpTypes)||void 0===e?void 0:e.length)&&o.matchUpTypes[0]===ma;return t.matchUpType===ma||!n})).forEach((e=>{var n,i,r;if(e.matchUpStatus===U)return void P.push(e);const a=e.collectionId,o=a&&e.sides.every((t=>t.participantId)),s=e.roundNumber===l,c=!a&&2===(null===(n=e.drawPositions)||void 0===n?void 0:n.filter(Boolean).length),u=!a&&(null===(i=e.drawPositions)||void 0===i?void 0:i.every((t=>w.includes(t)))),d=y.filter((t=>t.bye)).map((t=>t.drawPosition)),p=!a&&(null===(r=e.drawPositions)||void 0===r?void 0:r.find((t=>d.includes(t)))),m=G.includes(e.matchUpStatus)&&(o||c&&(!l||s)&&(!t||u));return p?S.push(e):Ji(e)?T.push(e):m?D.push(e):N.push(e)})),{completedMatchUps:T,upcomingMatchUps:D,pendingMatchUps:N,abandonedMatchUps:P,byeMatchUps:S,structure:f}}function pd(t){if(!t.drawDefinition)return{error:Ut};Object.assign(t,{requireParticipants:!1});const{abandonedMatchUps:e,completedMatchUps:n,upcomingMatchUps:i,pendingMatchUps:r,byeMatchUps:a,matchUpsMap:o}=md(t);return{matchUps:[].concat(...e,...n,...i,...r,...a),matchUpsMap:o}}function md({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:n,requireParticipants:i,includeByeMatchUps:r,policyDefinitions:a,tournamentRecord:o,drawDefinition:s,matchUpFilters:c,contextFilters:u,contextProfile:d,scheduleTiming:l,nextMatchUps:p,roundFilter:m,matchUpsMap:f,inContext:h,context:I,event:v}){var g,y;if(!s)return{error:Ut};let U=[],w=[],S=[],N=[],D=[];n=(null===(g=n)||void 0===g?void 0:g.length)&&n||(null==o?void 0:o.participants),h&&null!==(y=n)&&void 0!==y&&y.length&&(n=id({participants:n}));const{structures:P}=qc({drawDefinition:s});f||(f=Gc({drawDefinition:s})),P.forEach((o=>{const{byeMatchUps:g=[],pendingMatchUps:y,upcomingMatchUps:P,completedMatchUps:T,abandonedMatchUps:A}=ld({inContext:h||p,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:n,requireParticipants:i,includeByeMatchUps:r,policyDefinitions:a,drawDefinition:s,matchUpFilters:c,contextFilters:u,contextProfile:d,scheduleTiming:l,matchUpsMap:f,roundFilter:m,structure:o,context:I,event:v});U=U.concat(...A),w=w.concat(...T),S=S.concat(...P),N=N.concat(...y),D=D.concat(...g)}));const T={matchUpsMap:f,byeMatchUps:D,pendingMatchUps:N,upcomingMatchUps:S,abandonedMatchUps:U,completedMatchUps:w,...pt};if(p){const t="object"==typeof p&&p||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:e,completed:n,upcoming:i,pending:r,bye:a}=t,o=[].concat(...e&&T.abandonedMatchUps||[],...n&&T.completedMatchUps||[],...i&&T.upcomingMatchUps||[],...r&&T.pendingMatchUps||[],...a&&T.byeMatchUps||[]);cd({drawDefinition:s,inContextDrawMatchUps:o})}return T}function fd({scheduleVisibilityFilters:t,policyDefinitions:e,tournamentRecord:n,inContext:i=!0,contextProfile:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,context:c}){var u;if(!n)return{error:It};const d=(null===(u=n.unifiedTournamentId)||void 0===u?void 0:u.tournamentId)||n.tournamentId,l=(null==n?void 0:n.events)||[],p=yd({tournamentRecord:n}),{appliedPolicies:m}=ta({tournamentRecord:n}),f={...c,tournamentId:d,indoorOutDoor:n.indoorOutDoor,surfaceCategory:n.surfaceCategory,endDate:n.endDate};return{matchUps:l.map((c=>Id({scheduleVisibilityFilters:t,tournamentAppliedPolicies:m,context:f,policyDefinitions:e,tournamentRecord:n,matchUpFilters:a,contextFilters:o,contextProfile:r,nextMatchUps:s,participants:p,inContext:i,event:c}).matchUps)).flat(1/0).concat(...n.matchUps||[])}}function hd({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentRecord:n,policyDefinitions:i,matchUpFilters:r,contextFilters:a,drawDefinition:o,contextProfile:s,participants:c,nextMatchUps:u,inContext:d,context:l,event:p}){const{eventId:m,eventName:f,category:h,gender:I,matchUpFormat:v}=p||{};return pd({context:{...l,eventId:m,eventName:f,category:h,gender:I,matchUpFormat:v,indoorOutDoor:(null==p?void 0:p.indoorOutDoor)||(null==n?void 0:n.indoorOutDoor),surfaceCategory:(null==p?void 0:p.surfaceCategory)||(null==n?void 0:n.surfaceCategory),endDate:null==p?void 0:p.endDate},tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:c||n&&yd({tournamentRecord:n})||[],tournamentRecord:n,policyDefinitions:i,drawDefinition:o,matchUpFilters:r,contextFilters:a,contextProfile:s,nextMatchUps:u,inContext:d,event:p})}function Id({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,policyDefinitions:n,tournamentRecord:i,participants:r=[],matchUpFilters:a,contextFilters:o,contextProfile:s,nextMatchUps:c,inContext:u,context:d,event:l}){if(!l)return{error:Yt};const{eventId:p,eventName:m,endDate:f,category:h,gender:I,matchUpFormat:v}=l,g={...d,...Wi({indoorOutDoor:l.indoorOutDoor||(null==i?void 0:i.indoorOutDoor),surfaceCategory:l.surfaceCategory||(null==i?void 0:i.surfaceCategory),endDate:l.endDate||(null==i?void 0:i.endDate),tournamentId:null==i?void 0:i.tournamentId,matchUpFormat:v,eventName:m,category:h,gender:I,eventId:p})};f&&(g.endDate=f),r=r||i&&yd({tournamentRecord:i});const y=l.drawDefinitions||[],U=da({tournamentRecord:i,event:l}).scheduleTiming;return{matchUps:y.map((d=>{const{matchUps:p}=pd({tournamentParticipants:r,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,context:g,policyDefinitions:n,tournamentRecord:i,drawDefinition:d,matchUpFilters:a,contextFilters:o,contextProfile:s,scheduleTiming:U,nextMatchUps:c,inContext:u,event:l});return p})).flat(1/0)}}function vd({scheduleVisibilityFilters:t,policyDefinitions:e,tournamentRecord:n,inContext:i=!0,matchUpFilters:r,contextFilters:a,contextProfile:o,nextMatchUps:s,context:c}){var u;if(!n)return{error:It};const d=(null===(u=n.unifiedTournamentId)||void 0===u?void 0:u.tournamentId)||n.tournamentId,l=n&&n.events||[],p=yd({tournamentRecord:n}),{appliedPolicies:m}=ta({tournamentRecord:n}),f=a&&a.eventIds||[];return l.filter((t=>!f.includes(t.eventId))).map((u=>gd({tournamentAppliedPolicies:m,scheduleVisibilityFilters:t,policyDefinitions:e,tournamentRecord:n,matchUpFilters:r,contextFilters:a,contextProfile:o,participants:p,tournamentId:d,nextMatchUps:s,inContext:i,context:c,event:u}))).reduce(((t,e)=>{const n=e&&Object.keys(e).filter((t=>!["success","matchUpsMap"].includes(t)));return null==n||n.forEach((n=>{t[n]||(t[n]=[]),t[n]=t[n].concat(e[n]),t.matchUpsCount+=e[n].length})),t}),{matchUpsCount:0})}function gd({tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,policyDefinitions:n,tournamentRecord:i,matchUpFilters:r,contextFilters:a,contextProfile:o,nextMatchUps:s,participants:c,tournamentId:u,inContext:d,context:l,event:p}){if(!p)return{error:Yt};const{eventId:m,eventName:f,endDate:h}=p,I={...l,...Wi({eventId:m,eventName:f,endDate:h||(null==i?void 0:i.endDate),tournamentId:u||(null==i?void 0:i.tournamentId),indoorOutDoor:p.indoorOutDoor||(null==i?void 0:i.indoorOutDoor),surfaceCategory:p.surfaceCategory||(null==i?void 0:i.surfaceCategory)})},v=c||i&&yd({tournamentRecord:i});return(p.drawDefinitions||[]).reduce(((c,u)=>{const l=md({context:I,tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:v,policyDefinitions:n,tournamentRecord:i,drawDefinition:u,matchUpFilters:r,contextFilters:a,contextProfile:o,nextMatchUps:s,inContext:d,event:p}),m=Object.keys(l);return null==m||m.forEach((t=>{c[t]||(c[t]=[]),c[t]=c[t].concat(l[t])})),c}),{})}function yd({tournamentRecord:t}){return t&&t.participants||[]}function Ud({tournamentRecord:t,contextProfile:e,nextMatchUps:n,matchUpId:i,inContext:r}){if(!t)return{error:It};if("string"!=typeof i)return{error:me};const{matchUps:a}=fd({tournamentRecord:t}),o=a.find((t=>t.matchUpId===i));if(!o)return{error:he};const{eventId:s,drawId:c}=o,{event:u,drawDefinition:d}=wa({tournamentRecord:t,eventId:s,drawId:c}),l={surfaceCategory:u.surfaceCategory||t.surfaceCategory,indoorOutDoor:u.indoorOutDoor||t.indoorOutDoor,endDate:u.endDate||t.endDate,tournamentId:t.tournamentId,eventId:s,drawId:c},p=t.participants||[],{matchUp:m,structure:f}=Bu({context:r&&l,tournamentParticipants:p,drawDefinition:d,contextProfile:e,nextMatchUps:n,matchUpId:i,inContext:r,event:u});return{matchUp:m,structure:f,drawDefinition:d}}function wd({tournamentRecord:t,matchUpIds:e,schedule:n}){if(!t)return{error:It};if(!e||!Array.isArray(e))return{error:fe};if(!n||"object"!=typeof n)return{error:On};const{matchUps:i}=fd({tournamentRecord:t}),r=i.reduce(((t,e)=>{const{matchUpId:n,drawId:i}=e;return t[i]?t[i].push(n):t[i]=[n],t}),{});for(const a of Object.keys(r)){const{drawDefinition:i}=Sa({tournamentRecord:t,drawId:a}),o=r[a].filter((t=>e.includes(t)));for(const e of o){const r=$u({tournamentRecord:t,drawDefinition:i,matchUpId:e,schedule:n});if(r.error)return r}}return{...pt}}function Sd({tournamentRecords:t}){if(!t)return{error:ht};return Object.keys(t).reduce(((e,n)=>{e.tournamentIdMap[n]=[];const i=t[n].events||[],r=i.map((({eventId:t})=>t)),a=i.map((t=>(t.drawDefinitions||[]).map((({drawId:t})=>t)))).flat();return e.tournamentIdMap[n].push(...r,...a),e.eventIds.push(...r),e.drawIds.push(...a),e}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Nd({drawId:t,eventId:e,tournamentRecords:n}){const{tournamentIdMap:i}=Sd({tournamentRecords:n});return Object.keys(i).find((n=>i[n].includes(e)||i[n].includes(t)))}function Dd({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter((({drawPositions:e})=>t&&(null==e?void 0:e.includes(t)))).map((({roundNumber:t})=>parseInt(t))).sort(Ki)[0]}}function Pd({inContextDrawMatchUps:t,positionAssignments:e,targetDrawPosition:n,drawDefinition:i,dualMatchUp:r,matchUp:a}){if(r){var o,s,c;const e=null===(o=t.find((({matchUpId:t})=>a.matchUpId===t)).sides)||void 0===o||null===(s=o.find((t=>t.drawPosition===n)))||void 0===s?void 0:s.sideNumber,i=null===(c=a.sides)||void 0===c?void 0:c.find((t=>t.sideNumber===e));i&&delete i.lineUp}a.drawPositions=(a.drawPositions||[]).map((t=>t===n?void 0:t));const u=e.filter((({drawPosition:t})=>a.drawPositions.includes(t))).filter((t=>t.bye)).length;return a.matchUpStatus=u?S:a.matchUpStatus===x?x:O,a.matchUpStatus===x&&(a.winningSide=void 0),Mc({drawDefinition:i,matchUp:a}),{...pt}}function Td({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:n}){return t||({matchUps:t,matchUpsMap:n}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:n})),(t||[]).filter((({collectionId:t})=>!t)).forEach((i=>{const{matchUpId:r,structureId:a}=i,o=sd({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:r}),{winnerMatchUp:s,loserMatchUp:c}=o.targetMatchUps,u=null==s?void 0:s.matchUpId,d=null==c?void 0:c.matchUpId,l=Vc({matchUpsMap:n,structureId:a}).find((t=>t.matchUpId===r));l&&(u&&(Object.assign(l,{winnerMatchUpId:u}),Object.assign(i,{winnerMatchUpId:u})),d&&(Object.assign(l,{loserMatchUpId:d}),Object.assign(i,{loserMatchUpId:d})))})),{inContextDrawMatchUps:t}}function Ad(t){var e;const{sides:n,matchUpType:i}=t||{},r=null!==(e=t.potentialParticipants)&&void 0!==e&&e.length?t.potentialParticipants.flat().map((t=>i===pa?(null==t?void 0:t.individualParticipantIds)||[]:t.participantId)).flat():[],a=(n||[]).map((t=>{var e;return i===pa?(null==t||null===(e=t.participant)||void 0===e?void 0:e.individualParticipantIds)||[]:null!=t&&t.participantId?[t.participantId]:[]})).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function Md({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:_n};const{venueIds:n,tournamentsMap:i}=function({tournamentRecords:t={}}={}){const e=t&&Object.values(t)||[],n={},{venueIds:i,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce(((t,e)=>{const{venueIds:i,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s,tournamentMap:c}=bd({tournamentRecord:e});return i.forEach((e=>{t.venueIds.includes(e)||t.venueIds.push(e)})),t.tournamentIds.push(...s),t.structureIds.push(...o),t.eventIds.push(...r),t.drawIds.push(...a),Object.assign(n,c),t}),{venueIds:[],eventIds:[],drawIds:[],structureIds:[],tournamentIds:[]});return{venueIds:i,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s,tournamentsMap:n}}({tournamentRecords:t});let r,a;const o=e.every((t=>{const{scheduleDate:e,venues:o}=t;if(!wi(e))return!1;return o.every((t=>{const{venueId:e,rounds:o}=t;if("string"!=typeof e)return a="venueId should be a string",!1;if(!Array.isArray(o))return a="rounds should be an array",!1;if(!n.includes(e))return r=Nn,!1;return!!o.every((t=>{if(!t)return a="empty round",!1;const{tournamentId:e,eventId:n,drawId:r,structureId:o,roundNumber:s,roundSegment:c}=t,u=i[e]&&i[e][n]&&i[e][n][r]&&i[e][n][r][o],d=null==u?void 0:u.includes(s);d||(a="Invalid rounds");const{segmentNumber:l,segmentsCount:p}=c||{},m=!c||J(l)&&q(p)&&l<=p;return m||(a="Invalid segment"),d&&m}))}))}));return o||r||(r=_n),{valid:!!o,error:r,message:a}}function bd({tournamentRecord:t={},tournamentMap:e={},requireCourts:n}={}){const i=[],r=[],a=[],o=[],s=((null==t?void 0:t.venues)||[]).map((({venueId:t,courts:e})=>(!n||(null==e?void 0:e.length))&&t)),c=null==t?void 0:t.tournamentId;if(c){o.push(c),e[c]={};((null==t?void 0:t.events)||[]).forEach((t=>{const n=t.eventId;r.push(n),e[c][n]={},(t.drawDefinitions||[]).forEach((t=>{const r=t.drawId;i.push(r),e[c][n][r]={};const{structures:o}=qc({drawDefinition:t});(o||[]).forEach((t=>{const i=t.structureId;a.push(i);const{matchUps:o}=ju({structure:t}),{roundMatchUps:s}=_c({matchUps:o}),u=s&&Object.keys(s).map((t=>parseInt(t)));e[c][n][r][i]=u}))}))}))}return{tournamentIds:o,venueIds:s,eventIds:r,drawIds:i,structureIds:a,tournamentMap:e}}function Ed({tournamentRecord:t}){if(!t)return{error:It};const e=(({tournamentId:t,tournamentRank:e,formalName:n,tournamentName:i,promotionalName:r,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l})=>({tournamentId:t,tournamentRank:e,formalName:n,tournamentName:i,promotionalName:r,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l}))(t);return{...pt,tournamentInfo:Hi(e)}}function Cd({tournamentRecords:t}){const e=Object.keys(t).reduce(((e,n)=>{const i=t[n],{tournamentInfo:{startDate:r,endDate:a}}=Ed({tournamentRecord:i}),o=r&&new Date(Oi(r));(!e.startDate||o&&o<e.startDate)&&(e.startDate=o);const s=a&&new Date(Oi(a));return(!e.endDate||s&&s>e.endDate)&&(e.endDate=s),e}),{startDate:void 0,endDate:void 0}),n=e.startDate&&Oi(e.startDate.toISOString()),i=e.endDate&&Oi(e.endDate.toISOString());return n&&i?{startDate:n,endDate:i}:{error:Ce}}function Rd({tournamentRecords:t,venueIds:e=[]}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const n=[],i=[],r=[],a=[];return Object.keys(t).forEach((o=>{var s;null===(s=t[o].venues)||void 0===s||s.filter((({venueId:t})=>!e.length||e.includes(t))).forEach((t=>{var e;r.includes(t.venueId)||(n.push(Hi(t)),r.push(t.venueId)),null===(e=t.courts)||void 0===e||e.forEach((e=>{if(!a.includes(e.courtId)){const n={...Hi(e,!1,!0),venueId:t.venueId};i.push(n),a.push(e.courtId)}}))}))})),{courts:i,venues:n}}function Od({tournamentRecords:t,requireCourts:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};return Object.keys(t).reduce(((n,i)=>{const r=t[i],{venues:a}=Gu({tournamentRecord:r});return a.forEach((t=>{const{venueId:i,courts:r}=t;(!e||(null==r?void 0:r.length))&&!n.venueIds.includes(i)&&(n.venues.push(t),n.venueIds.push(i))})),n}),{venues:[],venueIds:[]})}function xd({tournamentRecords:t,extension:e}){if(!Kc(e))return{error:_n};for(const n of Object.values(t)){const t=$c({tournamentRecord:n,extension:e});if(t.error)return t}return{...pt}}function Ld({tournamentRecords:t,name:e}){if(!e)return{error:Ee,message:"Missing name"};let n;return Object.keys(t).find((i=>{const r=t[i],{extension:a}=sa({tournamentRecord:r,name:e});return n=a,!!a}))?{extension:n}:{error:qn}}function Fd({tournamentRecords:t,name:e}){if(!e)return{error:Ee,message:"Missing name"};let n=0;for(const i of Object.keys(t)){const r=Qc({tournamentRecord:t[i],name:e});if(r.error)return r;r.message!==qn&&n++}return{...pt,removed:n}}function kd({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const{extension:e}=Ld({tournamentRecords:t,name:Jr});let n=(null==e?void 0:e.value)||[];if(n.length){const{venueIds:e}=Od({tournamentRecords:t,requireCourts:!0}),{eventIds:i,drawIds:r}=Sd({tournamentRecords:t}),{updatedSchedulingProfile:a,modifications:o,issues:s}=_d({schedulingProfile:n,venueIds:e,eventIds:i,drawIds:r});if(o){n=a;const e=jd({tournamentRecords:t,schedulingProfile:n});return e.error?e:{schedulingProfile:n,modifications:o,issues:s}}}return{schedulingProfile:n,modifications:0}}function jd({tournamentRecords:t,schedulingProfile:e}){const n=Md({tournamentRecords:t,schedulingProfile:e});if(n.error)return n;if(!e)return Fd({tournamentRecords:t,name:Jr});return xd({tournamentRecords:t,extension:{name:Jr,value:e}})}function Bd({tournamentRecords:t,scheduleDate:e,venueId:n,round:i}){if(!wi(e))return{error:Fe};const{extension:r}=Ld({tournamentRecords:t,name:Jr}),a=(null==r?void 0:r.value)||[];let o=a.find((t=>Gi(e,t.scheduleDate)));if(!o){const{startDate:n,endDate:i}=Cd({tournamentRecords:t}),r=new Date(e);if(r<new Date(n)||r>new Date(i))return{error:Fe};o={scheduleDate:e,venues:[]},a.push(o)}let s=o.venues.find((t=>t.venueId===n));s||(s={venueId:n,rounds:[]},o.venues.push(s));const c=["notBeforeTime"],u=t=>Object.keys(t).filter((t=>!c.includes(t))).sort().map((e=>t[e])).join("|");if(s.rounds.find((t=>u(t)===u(i))))return{error:Vt};s.rounds.push(i);const d=jd({tournamentRecords:t,schedulingProfile:a});return d.error?d:pt}function _d({schedulingProfile:t,venueIds:e,eventIds:n,drawIds:i}){const r=[];return{updatedSchedulingProfile:null==t?void 0:t.map((t=>{const a=Oi(null==t?void 0:t.scheduleDate);if(!a)return void r.push(`Invalid date: ${null==t?void 0:t.scheduledDate}`);const o=((null==t?void 0:t.venues)||[]).map((t=>{const{rounds:a,venueId:o}=t;if(!e.includes(o))return void r.push(`Missing venueId: ${o}`);const s=a.filter((t=>{const e=n.includes(t.eventId)&&i.includes(t.drawId);return e||r.push(`Invalid eventId: ${t.eventId} or drawId: ${t.drawId}`),e}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...t,venues:o}})).filter(Boolean),modifications:r.length,issues:r}}function Gd({tournamentRecords:t}){const{schedulingProfile:e}=kd({tournamentRecords:t,requireCourts:!0});if(e){const{venueIds:n}=Od({tournamentRecords:t}),{eventIds:i,drawIds:r}=Sd({tournamentRecords:t}),{updatedSchedulingProfile:a,modifications:o}=_d({schedulingProfile:e,venueIds:n,eventIds:i,drawIds:r});if(o)return jd({tournamentRecords:t,schedulingProfile:a})}return pt}function Vd({matchUps:t=[],schedulingProfile:e}){const n={},i=({eventId:t,drawId:e,structureId:n,roundNumber:i})=>`${t}|${e}|${n}${i}`;if(null!=e&&e.length){e.map((({venues:t})=>t.map((({rounds:t})=>t)))).flat().forEach((t=>{t.sort(((t,e)=>(t.sortOrder||0)-(e.sortOrder||0))).forEach((({eventId:t,drawId:e,structureId:r,roundNumber:a},o)=>{const s=i({eventId:t,drawId:e,structureId:r,roundNumber:a});n[s]=o}))}))}const r=[],a={noScheduledDate:[]};for(const s of t){const t=s.schedule||{},e=t.scheduledDate&&Oi(t.scheduledDate)||t.scheduledTime&&Oi(t.scheduledTime)||"noScheduledDate";a[e]||(a[e]=[]),a[e].push(s)}const o=Object.keys(a).sort();for(const s of o){const t=a[s],e={noScheduledTime:[]};for(const n of t){const t=n.schedule||{},i=t.scheduledTime&&Ri(t.scheduledTime)||"noScheduledTime";e[i]||(e[i]=[]),e[i].push(n)}const o=Object.keys(e).sort();for(const a of o){const t=e[a];t.sort(((t,e)=>(n[i(t)]||0)-(n[i(e)]||0))),r.push(...t)}}return r}function Hd({scheduleVisibilityFilters:t,tournamentRecords:e,matchUpFilters:n,contextFilters:i,nextMatchUps:r}){if("object"!=typeof e||!Object.keys(e).length)return{error:ht};return{matchUps:Object.keys(e).map((a=>{const o=e[a],{matchUps:s}=fd({scheduleVisibilityFilters:t,tournamentRecord:o,matchUpFilters:n,contextFilters:i,nextMatchUps:r});return s})).flat()}}function Wd(t){if("object"!=typeof(null==t?void 0:t.tournamentRecords)||!Object.keys(null==t?void 0:t.tournamentRecords).length)return{error:ht};const{courts:e,venues:n}=Rd(t),{sortCourtsData:i,sortDateMatchUps:r=!0}=t,a=kd(t).schedulingProfile,{completedMatchUps:o,upcomingMatchUps:s,pendingMatchUps:c}=qd(t),u=[...s||[],...c||[]],d=r?Vd({matchUps:u,schedulingProfile:a}):u;return{courtsData:e.map((t=>{const e=function({courtId:t}){const e=d.filter((e=>{var n;return(null===(n=e.schedule)||void 0===n?void 0:n.courtId)===t}));return i?Vd({matchUps:e,schedulingProfile:a}):e}(t);return{...t,matchUps:e,surfaceCategory:(null==t?void 0:t.surfaceCategory)||""}})),completedMatchUps:o,dateMatchUps:d,venues:n}}function qd({scheduleVisibilityFilters:t,tournamentRecords:e,matchUpFilters:n,contextFilters:i}){if("object"!=typeof e||!Object.keys(e).length)return{error:ht};return Object.keys(e).map((r=>{const a=e[r];return vd({scheduleVisibilityFilters:t,tournamentRecord:a,matchUpFilters:n,contextFilters:i})})).reduce(((t,e)=>(Object.keys(e).forEach((n=>{t[n]||(t[n]=[]),t[n]=t[n].concat(e[n])})),t)),{})}function Kd(t,e){return function(t,e){return(Ko[null==t?void 0:t.stage]||0)-(Ko[null==e?void 0:e.stage]||0)}(t,e)||((null==t?void 0:t.stageSequence)||0)-((null==e?void 0:e.stageSequence)||0)||(null==t?void 0:t.roundNumber)-(null==e?void 0:e.roundNumber)||((null==t?void 0:t.roundPosition)||0)-((null==e?void 0:e.roundPosition)||0)}function zd({includeParticipantDependencies:t,tournamentRecords:e={},drawDefinition:n,matchUps:i=[],drawIds:r=[]}){if(!Array.isArray(i))return{error:Ie};if(!Array.isArray(r))return{error:xt};const a={},o=t=>{a[t]||(a[t]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[]})},s=(e,n)=>{a[e].matchUpIds.forEach((t=>a[n].matchUpIds.push(t))),a[n].matchUpIds.push(e),a[e].dependentMatchUpIds.push(n),t&&a[e].participantIds.forEach((t=>a[n].participantIds.push(t)))},c=e=>{for(const n of e){const{matchUpId:e,winnerMatchUpId:i,loserMatchUpId:r}=n;if(o(e),t){const{individualParticipantIds:t}=Ad(n);a[e].participantIds=t}i&&(o(i),s(e,i)),r&&(o(r),s(e,r))}};if(n)Td({drawDefinition:n}),i.length||({matchUps:i}=hd({drawDefinition:n})),c(i);else{i.length||({matchUps:i}=Hd({tournamentRecords:e,nextMatchUps:!0})),r.length||(r=e?Object.values(e).map((({events:t=[]})=>t.map((({drawDefinitions:t=[]})=>t.map((({drawId:t})=>t)))))).flat(1/0):[]);for(const t of r){let n=i.filter((e=>e.drawId===t)).sort(Kd);if(!!!n.find((({winnerMatchUpId:t,loserMatchUpId:e})=>t||e))){if(!n.find((({roundPosition:t})=>t))){const i=n.find((({tournamentId:t})=>t)),{drawDefinition:r}=wa({tournamentRecord:e[i.tournamentId],drawId:t});Td({drawDefinition:r})}}c(n)}}return{matchUpDependencies:a,...pt}}function Yd({matchUpStatus:t}){return k.includes(t)}function $d({matchUpStatus:t}){return j.includes(t)}function Jd({score:t,winningSide:e,matchUpStatus:n}){return(null==t?void 0:t.scoreStringSide1)||e||function({matchUpStatus:t}){return _.includes(t)}({matchUpStatus:n})}function Zd({drawDefinition:t,structureId:e}){const{structure:n,error:i}=Wc({drawDefinition:t,structureId:e});if(i)return{error:i};const{matchUps:r}=ju({inContext:!0,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},structure:n}),a=X([].concat(...r.map((t=>t.drawPositions||[]))).filter(Boolean)).sort(Ki),{matchUpDependencies:o}=zd({drawIds:[t.drawId],drawDefinition:t,matchUps:r}),s=X(r.filter(Jd).map((t=>{var e;return[].concat(...(null===(e=o[t.matchUpId])||void 0===e?void 0:e.matchUpIds)||[],t.matchUpId)})).flat()),c=X(r.map((({matchUpId:t,drawPositions:e})=>s.includes(t)?e:[])).flat().filter(Boolean)).sort(Ki),{positionAssignments:u}=Cu({drawDefinition:t,structure:n}),d=u.filter((t=>t.bye)).map((t=>t.drawPosition)),l=(null==a?void 0:a.filter((t=>!c.includes(t))))||[];return{allDrawPositions:a,inactiveDrawPositions:l,positionAssignments:u,activeDrawPositions:c,byeDrawPositions:d,structure:n}}function Qd({positionAssignments:t,drawDefinition:e,matchUpsMap:n,structure:i,event:r}){const{matchUps:a}=ju({drawDefinition:e,matchUpsMap:n,structure:i,event:r});a.forEach((n=>{const i=t.filter((({drawPosition:t})=>{var e;return null===(e=n.drawPositions)||void 0===e?void 0:e.includes(t)})).filter((t=>t.bye)).length;if(!n.winningSide){const t=i?S:O;Object.assign(n,{matchUpStatus:t}),Mc({drawDefinition:e,matchUp:n})}}))}function Xd({inContextDrawMatchUps:t,drawDefinition:e,drawPosition:n,matchUpsMap:i,structureId:r,event:a}){const{structure:o}=Wc({drawDefinition:e,structureId:r}),{positionAssignments:s}=Ru({drawDefinition:e,structure:o}),c=s.some((t=>{if(t.drawPosition===n)return delete t.participantId,delete t.qualifier,delete t.bye,!0}));if(o.structureType===Jo)return Qd({positionAssignments:s,drawDefinition:e,structure:o,matchUpsMap:i}),{drawPositionCleared:c};const{matchUps:u}=ju({drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:o,event:a}),{roundProfile:d,roundMatchUps:l}=_c({matchUps:u}),p=Object.keys(d).map((t=>parseInt(t)));let m=n;const f=p.map((t=>{const e=d[t].pairedDrawPositions.find((t=>t.includes(m))),n=null==e?void 0:e.find((t=>t!==m)),i=s.find((t=>t.drawPosition===n)),r=d[t+1],a=null==i?void 0:i.bye,o=r&&r.pairedDrawPositions.find((t=>t.includes(n))),c=a&&o&&r&&r.drawPositions.includes(n),u=e&&{roundNumber:t,relevantPair:e,pairedDrawPosition:n,pairedDrawPositionByeAdvancedPair:!c&&o,targetDrawPosition:m};return c&&(m=n),u})).filter((t=>null==t?void 0:t.targetDrawPosition)).reduce(((t,e)=>{const{roundNumber:n,relevantPair:i,targetDrawPosition:r,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=e,s=[{roundNumber:n,targetDrawPosition:r,relevantPair:i},o&&{roundNumber:n+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return t.concat(...s)}),[]);return f.forEach((({roundNumber:a,targetDrawPosition:c,relevantPair:u})=>{const d=l[a].find((t=>ut(t.drawPositions.filter(Boolean),u.filter(Boolean))));d&&(!function({drawDefinition:t,structureId:e,roundNumber:n,targetDrawPosition:i,matchUpsMap:r,inContextDrawMatchUps:a}){var o;const{structure:s}=Wc({drawDefinition:t,structureId:e});if(s.structureType===Jo)return;r=r||Gc({drawDefinition:t});const c=((null===(o=r)||void 0===o?void 0:o.mappedMatchUps)||{})[e].matchUps,{initialRoundNumber:u}=Dd({drawPosition:i,matchUps:c}),d=null==c?void 0:c.filter((t=>t.roundNumber>=n&&t.roundNumber!==u&&t.drawPositions.includes(i))),{positionAssignments:l}=Cu({drawDefinition:t,structureId:e});null==d||d.forEach((e=>tl({targetMatchUp:e,drawPosition:i,positionAssignments:l,drawDefinition:t,structure:s,matchUpsMap:r,inContextDrawMatchUps:a})))}({drawDefinition:e,structureId:r,roundNumber:a,targetDrawPosition:c,matchUpsMap:i,inContextDrawMatchUps:t}),tl({drawDefinition:e,structure:o,positionAssignments:s,targetMatchUp:d,drawPosition:n,matchUpsMap:i,inContextDrawMatchUps:t}))})),{tasks:f,drawPositionCleared:c}}function tl({positionAssignments:t,targetMatchUp:e,drawPosition:n,drawDefinition:i,structure:r,inContextDrawMatchUps:a,matchUpsMap:o}){const s=(o=o||Gc({drawDefinition:i})).mappedMatchUps[r.structureId].matchUps,{initialRoundNumber:c}=Dd({drawPosition:n,matchUps:s});e.roundNumber>c&&(e.drawPositions=(e.drawPositions||[]).map((t=>t===n?void 0:t)));const u=sd({matchUpId:e.matchUpId,structure:r,drawDefinition:i,inContextDrawMatchUps:a}),{targetLinks:{winnerTargetLink:d},targetMatchUps:{loserMatchUp:l,winnerMatchUp:p,loserMatchUpDrawPositionIndex:m,winnerMatchUpDrawPositionIndex:f}}=u,h=t.filter((({drawPosition:t})=>e.drawPositions.includes(t))).filter((t=>t.bye)).length;if(e.matchUpStatus=h?S:e.matchUpStatus===x?x:O,e.matchUpStatus===x&&(e.winningSide=void 0),Mc({drawDefinition:i,matchUp:e}),l&&l.structureId!==u.matchUp.structureId&&!h){const{drawPositions:t,roundNumber:e}=l;if(1===e){const e=t[m];Xd({drawDefinition:i,structureId:l.structureId,drawPosition:e,matchUpsMap:o,inContextDrawMatchUps:a})}else{var I;const n=Math.min(...t.filter(Boolean)),r=((null===(I=o)||void 0===I?void 0:I.mappedMatchUps)||{})[l.structureId].matchUps,{initialRoundNumber:s}=Dd({drawPosition:n,matchUps:r});s===e&&Xd({drawDefinition:i,structureId:l.structureId,drawPosition:n,matchUpsMap:o,inContextDrawMatchUps:a})}}p&&p.structureId!==u.matchUp.structureId&&console.log("linked structure winnerMatchUp removal",{winnerTargetLink:d,winnerMatchUpDrawPositionIndex:f})}function el({drawDefinition:t,drawPosition:e,participantId:n,structureId:i,matchUpsMap:r,inContextDrawMatchUps:a}){const{structure:o}=Wc({drawDefinition:t,structureId:i}),{positionAssignments:s}=Ru({drawDefinition:t,structure:o}),c=s.find((t=>n&&t.participantId===n||e&&t.drawPosition===e));if(n&&!e&&(e=null==c?void 0:c.drawPosition),!e)return{error:Ct};n||(n=null==c?void 0:c.participantId);const{activeDrawPositions:u}=Zd({drawDefinition:t,structureId:i});if(u.includes(e))return{error:bt};a||({matchUps:a}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const{drawPositionCleared:d,error:l}=Xd({drawDefinition:t,structureId:i,drawPosition:e,matchUpsMap:r,inContextDrawMatchUps:a});return l?{error:l}:d?(Ec({drawDefinition:t,structureIds:[i]}),{...pt,participantId:n}):{error:Tt}}function nl({element:t,notes:e}={}){return"object"!=typeof t?{error:_n}:e?"string"==typeof e||null!=e&&e.testing?(Object.assign(t,{notes:e}),pt):{error:_n}:{error:Ee}}function il({tournamentRecord:t,drawDefinition:e,policyTypes:n=[],event:i}){if(!Array.isArray(n))return{error:ye};const r={},a=t=>{for(const e of n){const n=t[e];n&&!r[e]&&(r[e]=n)}};if(e){const{appliedPolicies:t}=Bc({drawDefinition:e})||{};a(t)}if(i){const{appliedPolicies:t}=ea({event:i})||{};a(t)}if(t){const{appliedPolicies:e}=ta({tournamentRecord:t})||{};a(e)}return Object.keys(r).length?{policyDefinitions:r}:{error:Te}}const rl=t=>null==t?void 0:t.participantId;function al({positionAssignments:t,tournamentRecord:e,drawDefinition:n,matchUpFormat:i,matchUps:r,event:a}){if(!Array.isArray(r))return{error:_n};if(!t)return{error:_n};const{policyDefinitions:o}=il({tournamentRecord:e,drawDefinition:n,event:a,policyTypes:[nr]}),{subOrderMap:s}=function({positionAssignments:t}){const e=(t||[]).filter(rl).map((t=>{const{extension:e}=oa({element:t,name:Zr}),n=parseInt(null==e?void 0:e.value),i=!isNaN(n)&&n;return i&&{participantId:t.participantId,subOrder:i}})).filter(Boolean),n=et(e.map((({subOrder:t})=>t)));return{subOrderMap:Object.assign({},...e.filter((({subOrder:t})=>1===n[t])).map((({participantId:t,subOrder:e})=>({[t]:e}))))}}({positionAssignments:t}),c=pr({policyDefinitions:o,matchUpFormat:i,subOrderMap:s,matchUps:r});if(c.error)return c;const{participantResults:u}=c,d=Object.keys(u);return t.forEach((t=>{const{participantId:e}=t;if(d.includes(e)){zc({element:t,extension:{name:Qr,value:u[e]}}),u[e].ties||Yc({element:t,name:Zr})}else Yc({element:t,name:Qr}),Yc({element:t,name:Zr})})),Ec({drawDefinition:n}),{...pt,participantResults:u}}function ol({event:t,eventId:e}){if(!t)return{error:Yt};const{extension:n}=ca({event:t,name:Vr}),i=e?Hi(null==n?void 0:n.value,!1,!0):null==n?void 0:n.value;var r;e&&(null===(r=t.drawDefinitions)||void 0===r||r.forEach((t=>{var e;null==i||null===(e=i.flights)||void 0===e||e.forEach((e=>{e.drawId===t.drawId&&Object.assign(e,{drawDefinition:t})}))})));return{flightProfile:i}}const sl={matchUpStatus:O,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function cl({matchUpStatusCodes:t,removeWinningSide:e,tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpStatus:a,removeScore:o,winningSide:s,matchUpId:c,matchUp:u,event:d,notes:l,score:p}){var m;let f;const h=u.matchUpType===ma;if(h?c&&u.matchUpId!==c&&({matchUp:u,structure:f}=Bu({drawDefinition:i,matchUpId:c,event:d})):u.matchUpId!==c&&console.log("!!!!!"),o?Object.assign(u,sl):p&&(u.score=p),a&&(u.matchUpStatus=a),r&&(u.matchUpFormat=r),t&&(u.matchUpStatusCodes=t),s&&(u.winningSide=s),e&&(u.winningSide=void 0),f||({structure:f}=Bu({drawDefinition:i,matchUpId:c,event:d})),(null===(m=f)||void 0===m?void 0:m.structureType)===Jo&&!u.collectionId){var I;r=h?"SET1-S:T100":r||u.matchUpFormat||(null===(I=f)||void 0===I?void 0:I.matchUpFormat)||i.matchUpFormat||(null==d?void 0:d.matchUpFormat);const t=f.structures.find((t=>null==t?void 0:t.matchUps.find((t=>t.matchUpId===c)))),e=h&&{matchUpTypes:[ma]},{matchUps:a}=ju({structure:t,inContext:!0,matchUpFilters:e,event:d}),o=al({positionAssignments:t.positionAssignments,tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUps:a,event:d});if(o.error)return o}if(s!==u.winningSide){var v;const{flightProfile:t}=ol({event:d}),e=null==t||null===(v=t.flights)||void 0===v?void 0:v.find((t=>t.drawId===i.drawId));null!=e&&e.matchUpValue&&console.log("recalculate team point tallies")}if(l){const t=nl({element:u,notes:l});if(t.error)return t}return Mc({drawDefinition:i,matchUp:u}),pt}function ul({drawDefinition:t,matchUpId:e,structure:n,event:i}){const r=Bu({drawDefinition:t,event:i,matchUpId:e});if(r.error)return r;const a=r.matchUp,o=a.tieFormat||(null==n?void 0:n.tieFormat)||(null==t?void 0:t.tieFormat)||(null==i?void 0:i.tieFormat),{winningSide:s,set:c,scoreStringSide1:u,scoreStringSide2:d}=xa({matchUp:a,tieFormat:o}),l=[1,2].includes(s),p=l?D:u?M:O,m=a.winningSide&&!l;return cl({score:{scoreStringSide1:u,scoreStringSide2:d,sets:[c]},removeWinningSide:m,drawDefinition:t,matchUpStatus:p,winningSide:s,matchUpId:e,matchUp:a,event:i}),{...pt,removeWinningSide:m}}function dl(t){const{dualWinningSideChange:e,inContextDrawMatchUps:n,drawDefinition:i,matchUpStatus:r,matchUpsMap:a,dualMatchUp:o,targetData:s,structure:c,event:u}=t,d=Boolean(t.matchUp.collectionId),{drawPositions:l,winningSide:p}=s.matchUp||{};if(!l)return{error:Mt};const{targetLinks:{loserTargetLink:m,winnerTargetLink:f},targetMatchUps:{loserMatchUp:h,winnerMatchUp:I}}=s,{positionAssignments:v}=Ru({structure:c}),g=p-1,y=1-g,U=l[g],w=l[y],{winnerParticipantId:N,loserParticipantId:D}=v.reduce(((t,e)=>(e.drawPosition===w&&(t.loserParticipantId=e.participantId),e.drawPosition===U&&(t.winnerParticipantId=e.participantId),t)),{winnerParticipantId:void 0,loserParticipantId:void 0}),P=cl({...t,matchUpStatus:r||O,removeWinningSide:!0});if(P.error)return P;if(d){const{matchUpTieId:n}=t,{removeWinningSide:r}=ul({matchUpId:n,drawDefinition:i,structure:c,event:u});if(!e&&!r)return{...pt}}const{matchUps:A}=ju({inContext:!0,drawDefinition:i,matchUpsMap:a,structure:c}),M=A.filter((t=>t.drawPositions.includes(w)));if(I){const t=ll({inContextDrawMatchUps:n,winningDrawPosition:U,winnerParticipantId:N,winnerTargetLink:f,drawDefinition:i,winnerMatchUp:I,dualMatchUp:o,matchUpsMap:a});if(t.error)return t}if(h){const{winnerHadMatchUpStatus:t}=function({sourceMatchUps:t,loserDrawPosition:e,drawPositionMatchUps:n,matchUpStatuses:i=[S,x,T]}){var r;const a=null==n?void 0:n.reduce(((t,e)=>!t||e.roundNumber>t.roundNumber?e:t),void 0),o=null==a||null===(r=a.drawPositions)||void 0===r?void 0:r.find((t=>t!==e)),s=t.filter((t=>{var e;return null==t||null===(e=t.drawPositions)||void 0===e?void 0:e.includes(o)})).map((t=>t.matchUpStatus)),c=t.filter((t=>{var n;return null==t||null===(n=t.drawPositions)||void 0===n?void 0:n.includes(e)})).map((t=>t.matchUpStatus));return{sourceMatchUp:a,winnerHadMatchUpStatus:ut(s||[],i),winnerMatchUpStatuses:s,loserHadMatchUpStatus:ut(c||[],i),loserMatchUpStatuses:c}}({drawPositionMatchUps:M,loserDrawPosition:w,sourceMatchUps:A}),e=m.linkCondition===rs;if(t&&e){const t=pl({targetLink:m,inContextDrawMatchUps:n,drawDefinition:i,drawPosition:Math.min(...h.drawPositions),matchUpsMap:a});if(t.error)return t}const r=function({inContextDrawMatchUps:t,loserParticipantId:e,loserTargetLink:n,drawDefinition:i,loserMatchUp:r,dualMatchUp:a}){const o=n.target.structureId,{structure:s}=Wc({drawDefinition:i,structureId:o}),{positionAssignments:c}=Ru({structure:s});if(c.forEach((t=>{t.participantId===e&&delete t.participantId})),a){var u,d;const e=a.drawPositions,n=null==r||null===(u=r.sides)||void 0===u?void 0:u.find((t=>e.includes(t.drawPosition))),o=t.find((({matchUpId:t})=>t===r.matchUpId)),s=n&&(null==o||null===(d=o.sides)||void 0===d?void 0:d.find((t=>t.sideNumber===n)));s&&(delete s.lineUp,console.log("remove loser lineUp",{targetSide:s}),Mc({drawDefinition:i,matchUp:o}))}return{...pt}}({inContextDrawMatchUps:n,loserParticipantId:D,loserTargetLink:m,drawDefinition:i,loserMatchUp:h,dualMatchUp:o,matchUpsMap:a});if(r)return r}return{...pt}}function ll({inContextDrawMatchUps:t,winningDrawPosition:e,winnerParticipantId:n,winnerTargetLink:i,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,dualMatchUp:s,event:c}){const{structureId:u,roundNumber:d}=a;if(i){const t=i.target.structureId,{structure:e}=Wc({drawDefinition:r,structureId:t}),{positionAssignments:a}=Ru({structure:e}),o=a.find((t=>t.participantId===n)),s=null==o?void 0:o.drawPosition,{matchUps:u}=ju({drawDefinition:r,structure:e,event:c});1===et(u.map((t=>t.drawPositions)).flat(1/0).filter(Boolean))[s]?a.forEach((t=>{t.participantId===n&&delete t.participantId})):console.log("not removing from position assignments since instances > 1")}const l=function({inContextDrawMatchUps:t,targetDrawPosition:e,drawDefinition:n,structureId:i,dualMatchUp:r,roundNumber:a,matchUpsMap:o}){var s;const{structure:c}=Wc({drawDefinition:n,structureId:i});if(c.structureType===Jo)return;const u=((null===(s=o=o||Gc({drawDefinition:n}))||void 0===s?void 0:s.mappedMatchUps)||{})[i].matchUps,{initialRoundNumber:d}=Dd({drawPosition:e,matchUps:u}),l=null==u?void 0:u.filter((t=>{var n;return t.roundNumber>=a&&t.roundNumber!==d&&(null===(n=t.drawPositions)||void 0===n?void 0:n.includes(e))})),{positionAssignments:p}=Cu({drawDefinition:n,structureId:i});for(const m of l){const i=Pd({inContextDrawMatchUps:t,positionAssignments:p,targetDrawPosition:e,drawDefinition:n,dualMatchUp:r,matchUpsMap:o,matchUp:m});if(i.error)return i}return{...pt}}({targetDrawPosition:e,inContextDrawMatchUps:t,drawDefinition:r,dualMatchUp:s,matchUpsMap:o,roundNumber:d,structureId:u});return l.error?l:{...pt}}function pl({inContextDrawMatchUps:t,drawDefinition:e,drawPosition:n,matchUpsMap:i,targetLink:r}){return el({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i,drawPosition:n,structureId:r.target.structureId}),{...pt}}function ml(t){var e;let{sourceMatchUp:n}=t;const{winnerMatchUp:i,structure:r,matchUpsMap:a,drawPosition:o}=t,s=i.roundNumber>1&&i.roundNumber-1,c=Vc({structureId:r.structureId,matchUpsMap:a});!n&&o&&(n=c.find((({drawPositions:t,roundNumber:e})=>e===s&&(null==t?void 0:t.includes(o)))));const u=null===(e=n)||void 0===e?void 0:e.roundPosition,d=u+(u%2?1:-1),l=s&&c.find((({roundNumber:t,roundPosition:e})=>t===s&&e===d)),p=null==l?void 0:l.matchUpStatus;return{pairedPreviousMatchUp:l,pairedPreviousMatchUpisWOWO:[A].includes(p)}}function fl({drawDefinition:t,drawPosition:e,matchUpsMap:n,structureId:i}){var r;if(!t)return{error:Ut};const{structure:a}=Wc({drawDefinition:t,structureId:i});if(!a)return{error:Wt};n||(n=Gc({drawDefinition:t}));const{positionAssignments:o}=Cu({structure:a}),{activeDrawPositions:s}=Zd({drawDefinition:t,structureId:i});if(o.find((t=>t.drawPosition===e)).bye)return{...pt};if(s.includes(e))return{error:bt};const c=o.find((t=>t.drawPosition===e));if(!c)return{error:Et};const{filled:u,containsBye:d}=function(t){const e=t.bye,n=t.qualifier,i=t.participantId;return{containsBye:e,containsQualifier:n,containsParticipant:i,filled:e||n||i}}(c);if(d)return{...pt};if(u&&!d)return{error:Pt};const{matchUps:l}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:n}),{matchUps:p}=ju({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:a});if(o.forEach((t=>{t.drawPosition===e&&(t.bye=!0)})),a.structureType===Jo)return function({drawDefinition:t,matchUps:e,drawPosition:n}){e.forEach((e=>{e.drawPositions.includes(n)&&hl({drawDefinition:t,matchUp:e})}))}({drawDefinition:t,matchUps:p,drawPosition:e}),{...pt};const{roundProfile:m,roundMatchUps:f}=_c({matchUps:p}),h=Object.keys(m).map((t=>parseInt(t))).reverse(),I=f[h.find((t=>m[t].drawPositions.includes(e)))].find((({drawPositions:t})=>t.includes(e)));hl({drawDefinition:t,matchUp:I});const v=null===(r=I.drawPositions)||void 0===r?void 0:r.find((t=>t!==e));if(v){const e=Il({sourceDrawPositions:I.drawPositions,matchUpId:I.matchUpId,inContextDrawMatchUps:l,drawPositionToAdvance:v,drawDefinition:t,matchUpsMap:n});if(e.error)return e}return Ec({drawDefinition:t,structureIds:[i]}),{...pt}}function hl({drawDefinition:t,matchUp:e}){Object.assign(e,{matchUpStatus:S,score:void 0,winningSide:void 0}),Mc({drawDefinition:t,matchUp:e})}function Il({sourceDrawPositions:t,drawPositionToAdvance:e,inContextDrawMatchUps:n,drawDefinition:i,matchUpId:r,matchUpsMap:a}){const o=a.drawMatchUps.find((t=>t.matchUpId===r)),s=n.find((t=>t.matchUpId===r)),c=null==s?void 0:s.structureId,{structure:u}=Wc({drawDefinition:i,structureId:c}),{positionAssignments:d}=Cu({structure:u}),l=d.filter((t=>t.bye)).map((t=>t.drawPosition)),p=o.drawPositions.find((t=>t!==e)),m=l.includes(p),{targetLinks:{loserTargetLink:f},targetMatchUps:{loserMatchUp:h,winnerMatchUp:I,loserTargetDrawPosition:v}}=sd({matchUpId:r,structure:u,drawDefinition:i,inContextDrawMatchUps:n});if(I&&I.structureId===u.structureId&&function({drawDefinition:t,winnerMatchUp:e,drawPositionToAdvance:n,sourceDrawPositions:i,inContextDrawMatchUps:r,matchUpsMap:a}){var o,s,c;const u=a.drawMatchUps.find((t=>t.matchUpId===e.matchUpId)),d=r.find((t=>t.matchUpId===e.matchUpId)),l=null==d?void 0:d.structureId,{structure:p}=Wc({drawDefinition:t,structureId:l}),{positionAssignments:m}=Cu({structure:p}),f=m.find((({drawPosition:t})=>t===n)).bye,h=null===(o=u.drawPositions)||void 0===o?void 0:o.filter(Boolean),I=m.filter((t=>h.includes(t.drawPosition))),v=m.find((({drawPosition:t})=>t===n)),g=null==i?void 0:i.find((t=>t!==n)),y=g&&I.find((({drawPosition:t})=>t===g)),U=null==y?void 0:y.bye,w=f&&U;if(h.length>1&&f&&!U)return{error:Pt};const N=h.find((t=>t!==n));let D=w;const P=[].concat(...(u.drawPositions||[]).filter(Boolean),void 0,void 0).slice(0,2).map((t=>t||D?t===n?(D=!0,n):t:(D=!0,n)));if(!D)return console.log("@@@@@@@",{advancingAssignmentIsBye:v,drawPositionToAdvance:n,existingAssignments:I}),{error:Pt};const T=null===(s=m.find((({drawPosition:t})=>t===N)))||void 0===s?void 0:s.bye,A=null===(c=m.find((({drawPosition:t})=>t===n)))||void 0===c?void 0:c.bye,M=A||T?S:O;if(Object.assign(u,{matchUpStatus:M,score:void 0,winningSide:void 0,drawPositions:P}),Mc({drawDefinition:t,matchUp:u}),T||A){const i=T?n:N;if(i)Il({drawPositionToAdvance:i,matchUpId:e.matchUpId,inContextDrawMatchUps:r,drawDefinition:t,iterative:"brightmagenta",matchUpsMap:a});else if(A){const{targetLinks:{loserTargetLink:n},targetMatchUps:{loserMatchUp:i,loserTargetDrawPosition:o}}=sd({matchUpId:e.matchUpId,structure:p,drawDefinition:t,inContextDrawMatchUps:r});if(n&&i)if(i.feedRound)vl({drawDefinition:t,loserMatchUp:i,loserTargetLink:n,loserTargetDrawPosition:o,matchUpsMap:a});else{const r=1-e.roundPosition%2,a=i.drawPositions[r],s=fl({drawDefinition:t,structureId:n.target.structureId,drawPosition:a,loserTargetDrawPosition:o,iterative:"brightgreen"});if(s.error);}}}}({drawDefinition:i,winnerMatchUp:I,drawPositionToAdvance:e,sourceDrawPositions:t,inContextDrawMatchUps:n,matchUpsMap:a}),h&&m&&h.structureId!==u.structureId){const{roundNumber:t}=h;if(1===t){const t=fl({drawDefinition:i,structureId:f.target.structureId,drawPosition:v,iterative:"brightyellow"});if(t.error)return t}else vl({drawDefinition:i,loserMatchUp:h,loserTargetLink:f,loserTargetDrawPosition:v,matchUpsMap:a})}return{...pt}}function vl({drawDefinition:t,loserMatchUp:e,loserTargetLink:n,loserTargetDrawPosition:i,matchUpsMap:r}){const{roundNumber:a}=e,o=((null==r?void 0:r.mappedMatchUps)||{})[e.structureId].matchUps,{initialRoundNumber:s}=Dd({drawPosition:i,matchUps:o});if(s===a){const e=fl({drawDefinition:t,structureId:n.target.structureId,drawPosition:i,iterative:"red"});if(e.error)return e}}function gl({inContextDrawMatchUps:t,matchUpId:e,drawPosition:n}){const i=t.filter((({winnerMatchUpId:t,loserMatchUpId:n})=>n===e||t===e)).sort(((t,e)=>t.roundPosition-e.roundPosition));return i.find((({feedRound:t})=>t))?1:i.reduce(((t,e,i)=>e.drawPositions.includes(n)?i+1:t),void 0)}function yl({drawDefinition:t,matchUpId:e,matchUpStatus:n,drawPosition:i,matchUpsMap:r,inContextDrawMatchUps:a}){var o,s,c;r||(r=Gc({drawDefinition:t})),a||({matchUps:a}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const u=a.find((t=>t.matchUpId===e)),d=null==u?void 0:u.structureId,l=null==t||null===(o=t.structures)||void 0===o?void 0:o.find((t=>t.structureId===d)),p=null===(s=r)||void 0===s||null===(c=s.drawMatchUps)||void 0===c?void 0:c.find((t=>t.matchUpId===e)),m=p.drawPositions||[],{positionAdded:f,positionAssigned:h,updatedDrawPositions:I}=function({drawPosition:t,drawPositions:e}){let n,i=null==e?void 0:e.includes(t);return{updatedDrawPositions:i?e:[].concat(...e,void 0,void 0).slice(0,2).map((e=>e||i?e:(i=!0,n=!0,t))).sort(Ki),positionAdded:n,positionAssigned:i}}({drawPosition:i,drawPositions:m}),{positionAssignments:v}=Cu({drawDefinition:t,structure:l}),g=v.filter((t=>I.includes(t.drawPosition))).find((({bye:t})=>t)),y=p.matchUpStatus===x&&I.filter(Boolean).length<2;if(n=g?S:n||(y?x:p.matchUpStatus===A?A:O),f){({matchUps:a}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t,matchUpsMap:r}));const o=y&&gl({inContextDrawMatchUps:a,drawPosition:i,matchUpId:e})||void 0;Object.assign(p,{drawPositions:I,winningSide:o,matchUpStatus:n}),Mc({drawDefinition:t,matchUp:p})}const U=sd({matchUpId:e,drawDefinition:t,inContextDrawMatchUps:a,inContextMatchUp:u}),{targetMatchUps:{winnerMatchUp:w,loserMatchUp:N,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:T}}=U,M=Vc({structureId:l.structureId,matchUpsMap:r});if(h&&g){if(w)if([S,A].includes(n)){const e=yl({drawDefinition:t,drawPosition:i,matchUpId:w.matchUpId,iterative:"brightmagenta",matchUpsMap:r,inContextDrawMatchUps:a});if(e.error)return e}else{const{structureId:t}=w;t!==l.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else{const{pairedPreviousMatchUpisWOWO:e}=ml({winnerMatchUp:p,drawPosition:i,structure:l,matchUpsMap:r});if(e&&w){const e=yl({drawDefinition:t,drawPosition:i,matchUpId:w.matchUpId,iterative:"brightred",matchUpsMap:r,inContextDrawMatchUps:a});if(e.error)return e}}if((null==T?void 0:T.linkCondition)===rs&&2===I.filter(Boolean).length&&!g){if(M.filter((({drawPositions:t,roundNumber:e})=>1===e&&ut(t,I))).every((({matchUpStatus:t})=>[D,C].includes(t)))&&N){const{structureId:e}=N,n=fl({drawDefinition:t,structureId:e,drawPosition:P,matchUpsMap:r});if(n.error)return n}}return h?pt:{error:Pt,drawPosition:i}}function Ul(t){const{drawDefinition:e,matchUpsMap:n,targetData:i,structure:r}=t;if(r.structureType===Jo)return pt;const{matchUp:a,targetMatchUps:o,targetLinks:s}=i,{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}=o;if(c){const{loserTargetLink:t}=s,i=wl({drawDefinition:e,loserMatchUp:c,loserTargetLink:t,loserTargetDrawPosition:d,matchUpsMap:n});if(i.error)return i}if(u){const e=function(t){var e,n;const{inContextDrawMatchUps:i,drawDefinition:r,sourceMatchUp:a,winnerMatchUp:o,matchUpsMap:s,structure:c,matchUpId:u}=t,d=s.drawMatchUps.find((t=>t.matchUpId===o.matchUpId));if(!d)return{error:ve};const l=(null==a?void 0:a.drawPositions)||[];let p=null===(e=d.drawPositions)||void 0===e?void 0:e.filter(Boolean);ut(l,p)&&(p=p.filter((t=>!l.includes(t))));if(p.length>1)return{error:Pt};const{pairedPreviousMatchUpisWOWO:m}=ml(t),f=sd({matchUpId:o.matchUpId,structure:c,drawDefinition:r,inContextDrawMatchUps:i}),{targetMatchUps:h,targetLinks:I}=f,{winnerMatchUp:v,loserMatchUp:g,loserTargetDrawPosition:y}=h;if(g){const{loserTargetLink:t}=I,e=wl({drawDefinition:r,loserMatchUp:g,loserTargetLink:t,loserTargetDrawPosition:y,matchUpsMap:s});if(e.error)return e}const U=(null===(n=d.drawPositions)||void 0===n?void 0:n.filter(Boolean))||[],w=1===U.length&&gl({drawPosition:U[0],inContextDrawMatchUps:i,matchUpId:u})||void 0,S=d.matchUpStatus===x&&!U.length,N=1===d.finishingRound,D=S&&!N?A:x,P=cl({...t,matchUp:d,winningSide:w,matchUpStatus:D});if(P.error)return P;if(S)return Ul({...t,targetData:f});if(!v)return{...pt};const T=p[0];if(T)return yl({drawDefinition:r,inContextDrawMatchUps:i,matchUpId:v.matchUpId,drawPosition:T});if(m){const e=s.drawMatchUps.find((t=>t.matchUpId===v.matchUpId));if(!e)return{error:ve};const n=e.drawPositions.filter(Boolean);if(1===n.length){const t=gl({matchUpId:u,drawPosition:n[0],inContextDrawMatchUps:i});console.log("existing drawPosition is winningSide",{walkoverWinningSide:t})}const a=e.matchUpStatus===x?x:A,o=cl({matchUpId:e.matchUpId,matchUp:e,removeScore:!0,drawDefinition:r,matchUpStatus:a});if(o.error)return o;if(a===A){const e=Ul({...t,targetData:f,matchUpId:u});if(e.error)return e}}return pt}({...t,matchUpId:u.matchUpId,sourceMatchUp:a,winnerMatchUp:u});if(e.error)return e}return pt}function wl(t){var e;const{drawDefinition:n,loserTargetLink:i,loserTargetDrawPosition:r,matchUpsMap:a}=t,o=null==i||null===(e=i.target)||void 0===e?void 0:e.structureId,{structure:s}=Wc({drawDefinition:n,structureId:o});return s?fl({drawDefinition:n,structureId:o,drawPosition:r,matchUpsMap:a}):{error:Kt}}function Sl(t){const{drawDefinition:e,matchUp:n,structure:i,matchUpStatus:r}=t,a=r===S,o=n.winningSide,s=r===A,c=Yd({matchUpStatus:r}),u=$d({matchUpStatus:r}),d=o&&s;return!c&&!u&&{error:re}||o&&c&&!s&&Nl(t)||d&&function(t){let e=dl(t);return e.error?e:Ul(t)}(t)||o&&dl(t)||u&&cl({...t,removeScore:[N,x].includes(r),matchUpStatus:r||O})||a&&function({drawDefinition:t,structure:e,matchUp:n}){var i;if(null!=n&&n.winningSide)return{error:se,matchUpStatus:S};const{positionAssignments:r}=Ru({structure:e}),a=r.filter((t=>t.bye)).map((t=>t.drawPosition));return(null===(i=n.drawPositions)||void 0===i?void 0:i.some((t=>a.includes(t))))?(n.matchUpStatus=S,n.matchUpStatusCodes=[],Mc({drawDefinition:t,matchUp:n}),pt):{error:"Cannot Assign BYE status if no assignment: { bye: true }"}}({drawDefinition:e,matchUp:n,structure:i})||!c&&{error:re}||s&&function(t){const e=Nl({...t,removeScore:!0});return e.error?e:Ul(t)}(t)||{error:se}}function Nl(t){var e;const n=t.isCollectionMatchUp&&(null===(e=t.dualMatchUp)||void 0===e?void 0:e.winningSide)&&t.projectedWinningSide,i=Boolean(t.matchUp.collectionId),r=cl(t);if(i){const{matchUpTieId:e,drawDefinition:i}=t,{removeWinningSide:r}=ul({matchUpId:e,drawDefinition:i});console.log("atsms",{removeWinningSide:r,removeDirected:n})}return r}function Dl({tournamentRecord:t,drawDefinition:e,event:n}){const i=(null==t?void 0:t.events)||n&&[n],r=(null==i?void 0:i.map((t=>null==t?void 0:t.drawDefinitions)).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=r.map((({structures:t})=>null==t?void 0:t.filter((t=>null==t?void 0:t.structures)))).flat().filter(Boolean);for(const c of s){const{structures:t,structureId:e}=c||{};t&&(a[e]=null==t?void 0:t.map((t=>t.structureId)))&&t.forEach((t=>o[t.structureId]=c.structureId))}return{containedStructures:a,containerStructures:o}}function Pl({drawDefinition:t,structureId:e}){if(!t)return{error:Ut};const{structure:n}=Wc({drawDefinition:t,structureId:e}),i=((null==t?void 0:t.links)||[]).filter((t=>{var n;return(null===(n=t.source)||void 0===n?void 0:n.structureId)===e})).map((t=>{var e;return null===(e=t.target)||void 0===e?void 0:e.structureId}));return{playoffStructures:((null==t?void 0:t.structures)||[]).filter((t=>i.includes(t.structureId)&&t.stage===Wo)),structure:n}}function Tl(t){if(null==t||!t.drawDefinition)return{error:Ut};const e=ld(t),{completedMatchUps:n,pendingMatchUps:i,upcomingMatchUps:r}=e||{};return!!((null==n?void 0:n.length)&&!(null!=i&&i.length)&&!r.length)}function Al(t){var e,n;const{drawDefinition:i,structureId:r}=t;if(!i)return{error:Ut};const{playoffStructures:a}=Pl({drawDefinition:i,structureId:r});if(null==a||!a.length)return!1;const o=(null==i||null===(e=i.entries)||void 0===e||null===(n=e.filter((t=>hu.includes(null==t?void 0:t.entryStatus))))||void 0===n?void 0:n.length)||0;let s=0;return(a||[]).reduce(((t,e)=>{var n;return!(null!=e&&null!==(n=e.positionAssignments)&&void 0!==n&&n.filter((t=>(t.participantId&&s++,!(null!=t&&t.bye||null!=t&&t.participantId)))).length)&&t}),!0)||s===o}function Ml({drawDefinition:t,structure:e,matchUp:n}){const i=[];if(e.finishingPosition===bs){if(Tl({drawDefinition:t,structure:e})){const{structureIds:r}=function({drawDefinition:t,structure:e,matchUp:n}){const{drawPositions:i}=n,{positionAssignments:r}=Cu({drawDefinition:t,structure:e}),a=r.filter((({drawPosition:t})=>i.includes(t))).map((t=>{var e;const{extension:n}=oa({element:t,name:Qr});return null==n||null===(e=n.value)||void 0===e?void 0:e.groupOrder})),{containerStructures:o}=Dl({drawDefinition:t}),s=o[e.structureId],{links:{source:c}}=od({drawDefinition:t,structureId:s});return{structureIds:null==c?void 0:c.filter((t=>{var e;return ut(a,(null===(e=t.source)||void 0===e?void 0:e.finishingPositions)||[])})).map((t=>t.source.structureId))}}({drawDefinition:t,structure:e,matchUp:n});null!=r&&r.length&&i.push(...r)}}return{connectedStructureIds:i}}function bl({drawDefinition:t,drawPosition:e,structure:n}){var i,r,a;const o=null==n||null===(i=n.matchUps)||void 0===i?void 0:i.find((t=>{var n;return null===(n=t.drawPositions)||void 0===n?void 0:n.includes(e)})),s=null==o?void 0:o.roundNumber,c=null==n||null===(r=n.matchUps)||void 0===r?void 0:r.filter((t=>t.roundNumber===s)).map((({drawPositions:t})=>t)).flat(),u=null==n||null===(a=n.positionAssignments)||void 0===a?void 0:a.filter((({drawPosition:t,participantId:e})=>c.includes(t)&&e)).map(Fc);return t.entries.filter((({entryStatus:t})=>[ou,uu,au].includes(t))).map(Fc).filter((t=>!u.includes(t)))}function El({drawPositions:t,structure:e}){if([Go,_o].includes(e.stage)&&1===e.stageSequence)return;const{positionAssignments:n}=Cu({structure:e});n.filter((({drawPosition:e})=>t.includes(e))).forEach((t=>{zc({element:t,extension:{name:_r,value:!0}})}))}function Cl({drawDefinition:t,positionAction:e}){const{extension:n}=oa({element:t,name:"positionActions"});zc({element:t,extension:{name:"positionActions",value:Array.isArray(null==n?void 0:n.value)?n.value.concat(e):[e]}})}function Rl({participantsCount:t,cluster:e}){const n=Y(t),i=ot(1,n+1);let r=[],a=n/2;for(;a>1;){const t=dt(i,a),n=t.length;t.forEach(((t,i)=>{let a;const o=i<n/2,s=i%2==0,c=t[0],u=t[t.length-1];a=e&&n>4?8===n?o?u:c:s?c:u:o?c:u,ut(t,r)||r.push(a)})),a/=2}const o=i.filter((t=>!r.includes(t)));for(;o.length;)o.length%2==0?r.push(o.pop()):r.push(o.shift());const s=ot(0,20).map((t=>Math.pow(2,t)));s.unshift(1);const c=s.indexOf(n);let u=0;const d=[];return ot(0,c).forEach((t=>{d.push(r.slice(u,u+s[t])),u+=s[t]})),{seedBlocks:d}}function Ol({drawDefinition:t,appliedPolicies:e,allPositions:n,structure:i}){var r;let a,o,s,c,u=0,d=[];if(!i)return{error:Kt};const{roundMatchUps:l}=ju({roundFilter:1,structure:i}),{seedAssignments:p}=Mu({drawDefinition:t,structure:i}),{positionAssignments:m}=Ru({structure:i}),f=m.length,h=(null==p?void 0:p.length)||0;let I=[];const v=Object.keys(l).sort(((t,e)=>t-e)).map((t=>{const e=l[t].map((t=>t.drawPositions)).flat(1/0).filter(Boolean),n=e.filter((t=>!I.includes(t)));return I=I.concat(...e),n})).filter((t=>t.length)).reverse(),g=v.pop(),y=g&&Math.min(...g)-1||0,U=null==e||null===(r=e.seeding)||void 0===r?void 0:r.seedingProfile,w=(null==g?void 0:g.length)||0,S=v.filter((t=>t.filter((t=>t<=h)).length)),N=n?f:h;if(i.structureType===Jo){if(c=!0,({validSeedBlocks:d,error:o}=function({seedingProfile:t,structure:e,seedBlocks:n}){const i=e.structures||[],r=[];for(const l of i){const{positionAssignments:e}=Ru({structure:l}),i=Math.min(...e.map((t=>t.drawPosition)))-1,a=e.length;let o,s;if(q(a)?({blocks:o,error:s}=xl({seedBlocks:n,baseDrawSize:a,seedingProfile:t,drawPositionOffset:i,seedCountGoal:a})):({blocks:o,error:s}=Ll({baseDrawSize:a,drawPositionOffset:i,seedCountGoal:a})),s)return{error:s};r.push(o)}const a=r.map((t=>t.map((t=>t.seedNumbers.map(((e,n)=>({seedNumber:e,drawPosition:t.drawPositions[n]}))))))).flat(1/0).sort(((t,e)=>t.seedNumber-e.seedNumber)).reduce(((t,e)=>{const n=e.seedNumber;return t[n]||(t[n]=[]),t[n].push(e.drawPosition),t}),{});let o=1,s=[];a[1]&&a[1].forEach(((t,e)=>{s.push({seedNumbers:[e+1],drawPositions:[t]}),o++}));[[2],[3,4],[5,6,7,8],ot(9,17)].forEach((t=>{const e=[].concat(...t.map((t=>a[t]||[]))),n=e.map(((t,e)=>o+e)),i={seedNumbers:n,drawPositions:e};s.push(i),o+=n.length}));const c=(t,e)=>t-e,u=(t,e)=>e-t,d=Object.keys(a).map(((t,e)=>a[t].sort(e%2?u:c))).flat().map(((t,e)=>({seedNumbers:[e+1],drawPositions:[t]})));e.seedingProfile===Yo&&(s=d);return{validSeedBlocks:s}}({seedingProfile:U,structure:i})),o)return{error:o}}else if(v.length){s=!0,d=S.map((t=>({seedNumbers:t,drawPositions:t})));const t=S.flat(1/0);a=t.length<N?N-t.length:0,u=t.length}else a=N;if(!c){const{blocks:t,error:e}=xl({baseDrawSize:w,seedingProfile:U,seedCountGoal:a,seedNumberOffset:u,drawPositionOffset:y});if(e)return{error:e,validSeedBlocks:[],isContainer:c,isFeedIn:s};t.forEach((t=>d.push(t)))}const D=[].concat(...d.map((t=>t.drawPositions))).reduce(((t,e)=>(null==g?void 0:g.includes(e))&&t),!0);return s||c||D?{validSeedBlocks:d,isFeedIn:s,isContainer:c}:{error:_t,validSeedBlocks:[],isContainer:c,isFeedIn:s}}function xl({baseDrawSize:t,seedCountGoal:e,seedingProfile:n,drawPositionOffset:i=0,seedNumberOffset:r=0}){let a=1;const o=[],{seedBlocks:s}=Rl({participantsCount:t,cluster:n===zo});a=0;for(const u of s){if(a+1>e)break;const t=u.map((t=>t+i)),n=c(a+1,u.length).map((t=>+t+r));a+=u.length,o.push({drawPositions:t,seedNumbers:n})}return{blocks:o};function c(t,e){return Array.from(new Array(e),((e,n)=>n+t))}}function Ll({baseDrawSize:t,seedCountGoal:e,drawPositionOffset:n=0}){let i=1;const r=[],a=ot(n+1,n+t+1);return[[1],[2],[3,4],[5,6,7,8],ot(9,17),ot(17,33),ot(33,65)].forEach((t=>{const n=t.map((()=>a.reverse().pop())).filter(Boolean),o={seedNumbers:t=t.slice(0,n.length),drawPositions:n};i<=e&&r.push(o),i+=n.length})),{blocks:r}}function Fl({seedNumber:t,drawDefinition:e,structureId:n,drawPosition:i}){var r,a,o,s;const{structure:c}=Wc({drawDefinition:e,structureId:n}),{appliedPolicies:u}=Bc({drawDefinition:e}),{validSeedBlocks:d}=Ol({structure:c,drawDefinition:e,appliedPolicies:u});if(null!=u&&null!==(r=u.seeding)&&void 0!==r&&null!==(a=r.validSeedPositions)&&void 0!==a&&a.ignore)return!0;if(null!=u&&null!==(o=u.seeding)&&void 0!==o&&null!==(s=o.validSeedPositions)&&void 0!==s&&s.strict){const e=d.find((e=>e.seedNumbers.includes(t)));return((null==e?void 0:e.drawPositions)||[]).includes(i)}return[].concat(...d.map((t=>t.drawPositions))).includes(i)}function kl({drawDefinition:t,structureId:e,randomize:n}){var i;const{structure:r}=Wc({drawDefinition:t,structureId:e}),{seedAssignments:a}=Mu({drawDefinition:t,structure:r}),{positionAssignments:o}=Ru({structure:r}),s=o.filter((t=>t.participantId||t.bye||t.qualifier)).map((t=>t.drawPosition)).filter(Boolean),{appliedPolicies:c}=Bc({drawDefinition:t}),{validSeedBlocks:u}=Ol({structure:r,drawDefinition:t,appliedPolicies:c}),d=(u||[]).filter((t=>t.drawPositions.filter((t=>!s.includes(t))).length))[0],l=a.map((t=>t.participantId)).filter(Boolean),p=o.map((t=>t.participantId)).filter(Boolean),m=l.filter((t=>p.includes(t))),f=l.filter((t=>!p.includes(t))),h=a.filter((t=>f.includes(t.participantId))),I=a.filter((t=>!t.participantId)),v=(h.length||I.length)&&(null==d?void 0:d.drawPositions.filter((t=>!s.includes(t))))||[],g=n?tt(v):v,y=[],U=g.map((()=>{const t=function(t,e){const n=t.filter((t=>!e.includes(t.participantId))),i=Math.min(...n.map((t=>t.seedValue))),r=n.filter((t=>t.seedValue===i));return tt(r).pop()}(h,y),e=t&&t.participantId;return e&&y.push(e),e})).filter(Boolean),w=a.filter((t=>m.includes(t.participantId))).map((t=>t.seedNumber)),S=(d&&d.seedNumbers||[]).filter((t=>!w.includes(t))),N=a.filter((t=>S.includes(t.seedNumber))).map((t=>t.participantId)),D=null==c||null===(i=c.seeding)||void 0===i?void 0:i.duplicateSeedNumbers;return{nextSeedBlock:d,unplacedSeedParticipantIds:void 0===D||D?U:N,unplacedSeedNumbers:S,unfilledPositions:g,unplacedSeedAssignments:h}}function jl({inContextDrawMatchUps:t,automaticPlacement:e,drawDefinition:n,participantId:i,drawPosition:r,matchUpsMap:a,structureId:o,event:s}){a=a||Gc({drawDefinition:n}),t||({matchUps:t}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:a}));const{structure:c,error:u}=Wc({drawDefinition:n,structureId:o});if(u)return{error:u};const{positionAssignments:d}=Ru({structure:c}),{seedAssignments:l}=Mu({drawDefinition:n,structure:c}),p=l.find((t=>t.participantId===i)),m=null==p?void 0:p.seedNumber;if(m){if(!Fl({structureId:o,drawPosition:r,drawDefinition:n,seedNumber:m}))return{error:Dt}}const f=d.find((t=>t.drawPosition===r));if(!f)return{error:Et};if(!i)return{error:Je};if(!(null!=c&&c.structures||null!=c&&c.matchUps.find((({roundPosition:t})=>!!t)))?!bl({drawDefinition:n,drawPosition:r,structure:c}).includes(i):d.map(Fc).includes(i))return{error:sn};const{containsParticipant:h,containsBye:I}=function(t){const e=t.bye,n=t.qualifier,i=t.participantId;return{containsBye:e,containsQualifier:n,containsParticipant:i,filled:e||n||i}}(f);if(h&&f.participantId!==i){const{activeDrawPositions:t}=Zd({drawDefinition:n,structureId:o});if(t.includes(r))return{error:bt}}if(I){let e=el({drawDefinition:n,drawPosition:r,structureId:o,matchUpsMap:a,inContextDrawMatchUps:t});if(e.error)return e}if(f.participantId=i,c.structureType!==Jo?function({inContextDrawMatchUps:t,automaticPlacement:e,drawDefinition:n,drawPosition:i,matchUpsMap:r,structure:a,event:o}){const s={isCollectionMatchUp:!1},{matchUps:c}=ju({inContextDrawMatchUps:t,drawDefinition:n,matchUpFilters:s,matchUpsMap:r,structure:a,event:o}),{roundMatchUps:u}=_c({matchUps:c}),{initialRoundNumber:d}=Dd({drawPosition:i,matchUps:c}),l=u[d].find((t=>t.drawPositions.includes(i)));if(l){const a=yl({drawDefinition:n,drawPosition:i,automaticPlacement:e,matchUpId:l.matchUpId,matchUpsMap:r,inContextDrawMatchUps:t});if(a.error);}}({inContextDrawMatchUps:t,positionAssignments:d,automaticPlacement:e,drawDefinition:n,matchUpsMap:a,drawPosition:r,structure:c,event:s}):Qd({inContextDrawMatchUps:t,positionAssignments:d,drawDefinition:n,matchUpsMap:a,structure:c}),!e){El({structure:c,drawPositions:[r]});Cl({drawDefinition:n,positionAction:{name:"positionAssignment",drawPosition:r,structureId:o,participantId:i}})}return Ec({drawDefinition:n,structureIds:[o]}),Object.assign({positionAssignments:d},pt)}function Bl(t){const{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:n,projectedWinningSide:i,loserDrawPosition:r,loserTargetLink:a,drawDefinition:o,loserMatchUp:s,dualMatchUp:c,matchUpsMap:u,event:d}=t,l=a.linkCondition,p=s.drawPositions||[],m=l===rs&&2===s.roundNumber&&Math.min(...p.filter(Boolean)),f=m||p[e],h=m||p[1-e],I=a.source.structureId,{structure:v}=Wc({drawDefinition:o,structureId:I}),{matchUps:g}=ju({inContext:!0,drawDefinition:o,structure:v,event:d}),y=g.filter((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.includes(r)})).filter((t=>{var e;const n=t.sides.find((t=>t.drawPosition===r)),i=t.matchUpStatus===x||t.matchUpStatus===T&&!(null===(e=t.score)||void 0===e||!e.scoreStringSide1);return(null==n?void 0:n.sideNumber)===t.winningSide&&!i})),U=l===rs&&0===y.length,{positionAssignments:w}=Ru({drawDefinition:o,structureId:I}),S=w.find((t=>t.drawPosition===r)),N=null==S?void 0:S.participantId,D=a.target.structureId,{positionAssignments:P}=Ru({drawDefinition:o,structureId:D}),A=P.filter((({drawPosition:t})=>p.includes(t)));if(A.some((t=>t.participantId===N)))return pt;const M=A.filter((t=>{const e=p.includes(t.drawPosition),n=!t.participantId&&!t.bye&&!t.qualifier;return e&&n})).map((t=>t.drawPosition)),b=M.includes(f),E=a.target.roundNumber>1&&M.length,C=1===a.target.roundNumber&&b;if(m){const t=U?O():fl({drawDefinition:o,structureId:D,drawPosition:h});if(t.error)return t}else if(C){const t=O();if(t.error)return t}else{if(!E)return{error:Et};{const t=M.sort(Ki)[0],e=jl({participantId:N,structureId:D,drawPosition:t,automaticPlacement:!0,inContextDrawMatchUps:n,drawDefinition:o,matchUpsMap:u});if(e.error)return e}}if(c&&i){var R;const t=null===(R=c.sides)||void 0===R?void 0:R.find((t=>t.sideNumber===3-i));if(null!=t&&t.lineUp){const{roundNumber:e}=s,{roundPosition:n}=c,i=1===e?n%2+1:1,{matchUp:r}=Bu({matchUpId:s.matchUpId,drawDefinition:o,matchUpsMap:u,event:d}),a=[1,2].map((t=>{var e;return{...(null===(e=r.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));r.sides=a;const l=r.sides.find((t=>t.sideNumber===i));l&&(l.lineUp=t.lineUp,Mc({drawDefinition:o,matchUp:r}))}}return{...pt};function O(){return jl({drawDefinition:o,participantId:N,structureId:D,drawPosition:f,automaticPlacement:!0,matchUpsMap:u,inContextDrawMatchUps:n})}}function _l(t){const{dualWinningSideChange:e,projectedWinningSide:n,inContextDrawMatchUps:i,matchUpStatusCodes:r,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:l,targetData:p,matchUpId:m,structure:f,matchUp:h,event:I,score:v}=t,g=Boolean(h.collectionId);if(!(g||function({structure:t,matchUp:e}){const{drawPositions:n}=e,{positionAssignments:i}=Ru({structure:t});return 2===i.filter((t=>n.includes(t.drawPosition)&&t.participantId)).length}({structure:f,matchUp:h})))return{error:Xt};const y=Yd({matchUpStatus:c}),U=[x].includes(c),w=cl({matchUpStatusCodes:y&&r||[],matchUpStatus:y&&c||D,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,removeScore:U,winningSide:l,matchUpId:m,matchUp:h,event:I,score:v});if(w.error)return w;let S=h.drawPositions;if(g){const{matchUpTieId:n}=t;ul({matchUpId:n,drawDefinition:o,structure:f,event:I});const r=i.find((({matchUpId:t})=>t===n));if(S=null==r?void 0:r.drawPositions,!e)return{...pt}}if(!S)return{error:Mt};{const t=l-1,e=1-t,r=S[t],a=S[e],{targetLinks:{loserTargetLink:s,winnerTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:f,loserMatchUpDrawPositionIndex:h,winnerMatchUp:v,loserMatchUp:g}}=p;if(v){const t=function({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:n,winningDrawPosition:i,winnerTargetLink:r,drawDefinition:a,winnerMatchUp:o,dualMatchUp:s,matchUpsMap:c,event:u}){if(r){const n=o.drawPositions||[],s=n[t],u=r.source.structureId,{positionAssignments:d}=Ru({structureId:u,drawDefinition:a}),l=d.find((t=>t.drawPosition===i)),p=null==l?void 0:l.participantId,m=r.target.structureId,{positionAssignments:f}=Ru({structureId:m,drawDefinition:a}),h=f.find((t=>t.participantId===p)),I=null==h?void 0:h.drawPosition,v=f.filter((t=>{const e=n.includes(t.drawPosition),i=!t.participantId&&!t.bye&&!t.qualifier;return e&&i})).map((t=>t.drawPosition)),g=v.includes(s);if(1===r.target.roundNumber&&g)jl({drawPosition:s,participantId:p,structureId:m,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});else if(v.length){const t=v.pop();jl({participantId:p,structureId:m,inContextDrawMatchUps:e,drawDefinition:a,drawPosition:t,matchUpsMap:c})}else{if(!I){const t="winner target position unavaiallble";return console.log(t),{error:t}}{const t=yl({drawPosition:I,matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});if(t.error)return t}}}else{const t=yl({matchUpId:o.matchUpId,drawPosition:i,inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:c});if(t.error)return t}if(s&&n){var d;const t=null===(d=s.sides)||void 0===d?void 0:d.find((t=>t.sideNumber===n));if(null!=t&&t.lineUp){const e=s.roundPosition,n=o.roundPosition,i=e===n&&1!==e||Math.floor(e/2)===n?2:1,{matchUp:r}=Bu({matchUpId:o.matchUpId,drawDefinition:a,matchUpsMap:c,event:u}),d=[1,2].map((t=>{var e;return{...(null===(e=r.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));r.sides=d;const l=r.sides.find((t=>t.sideNumber===i));l&&(l.lineUp=t.lineUp,Mc({drawDefinition:a,matchUp:r}))}}return{...pt}}({winnerMatchUpDrawPositionIndex:f,inContextDrawMatchUps:i,projectedWinningSide:n,winningDrawPosition:r,winnerTargetLink:m,drawDefinition:o,winnerMatchUp:v,dualMatchUp:u,matchUpsMap:d,event:I});if(t.error)return t}if(g){const t=Bl({loserMatchUpDrawPositionIndex:h,inContextDrawMatchUps:i,projectedWinningSide:n,loserDrawPosition:a,loserTargetLink:s,drawDefinition:o,matchUpStatus:c,loserMatchUp:g,winningSide:l,matchUpsMap:d,dualMatchUp:u,event:I});if(t.error)return t}}return pt}function Gl(t){const{drawDefinition:e,targetData:n,structure:i,matchUp:r,matchUpsMap:a,inContextDrawMatchUps:o}=t,{targetLinks:{loserTargetLink:s},targetMatchUps:{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}}=n;if(c){const t=pl({targetLink:s,drawPosition:d,drawDefinition:e,inContextDrawMatchUps:o,matchUpsMap:a});if(t.error)return t}if(u){var l;const n=null==a?void 0:a.drawMatchUps.find((t=>t.matchUpId===u.matchUpId)),{pairedPreviousMatchUp:s}=function({matchUp:t,structureId:e,matchUpsMap:n}){const i=null==t?void 0:t.roundPosition,r=i+(i%2?1:-1);return{pairedPreviousMatchUp:Vc({matchUpsMap:n,structureId:e}).find((({roundNumber:e,roundPosition:n})=>e===t.roundNumber&&n===r))}}({matchUp:r,structureId:i.structureId,matchUpsMap:a}),c=(null==s?void 0:s.matchUpStatus)===A,d=(null==s||null===(l=s.drawPositions)||void 0===l?void 0:l.filter(Boolean))||[],p=[...B,S].includes(null==s?void 0:s.matchUpStatus)||(null==s?void 0:s.winningSide),m=sd({matchUpId:u.matchUpId,drawDefinition:e,inContextDrawMatchUps:o}),{targetMatchUps:{winnerMatchUp:f}}=m;if(p){const t=r.drawPositions||[];let n=u.drawPositions.filter(Boolean);ut(t,n)&&(n=n.filter((e=>!t.includes(e))));const i=t.concat(d).find((t=>n.includes(t)));if(f&&i){const t=ll({winnerMatchUp:f,drawDefinition:e,winningDrawPosition:i,matchUpsMap:a,inContextDrawMatchUps:o});if(t.error)return t}}Gl({drawDefinition:e,targetData:m,structure:i,matchUp:u,matchUpsMap:a,inContextDrawMatchUps:o});let h=[x,A].includes(null==n?void 0:n.matchUpStatus)&&c?x:O;const I=!c;let v=cl({...t,matchUpStatus:h,removeScore:I,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:n,matchUpId:u.matchUpId});if(v.error)return v}return{...pt}}function Vl({score:t}={}){const{sets:e,scoreStringSide1:n,scoreStringSide2:i}=t||{};return!!t&&(!(!n&&!i)||!(null==e||!e.length)&&Object.values(e[0]).some((t=>t)))}function Hl(t){const{matchUp:e,matchUpStatus:n,score:i,winningSide:r}=t;if((null==e?void 0:e.matchUpStatus)===A&&n!==A){const e=Gl(t);if(e.error)return e}const a=n===A,o=Vl({score:i})&&!a&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),s=![b,U].includes(n||b),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!Vl({score:i}),u=n&&n!==O,d=({removeScore:n}={})=>{let i;const{structure:r,drawDefinition:a}=t,{connectedStructureIds:o}=Ml({drawDefinition:a,structure:r,matchUp:e});o.length&&(console.log({connectedStructureIds:o}),i=!0),Object.assign(t,{removeScore:n});const s=dl(t);return s.error?s:{...pt,connectedStructures:i}};return r&&function(t){const{drawDefinition:e,winningSide:n,structure:i,matchUp:r}=t;let a;if(r.winningSide&&r.winningSide!==n){const{connectedStructureIds:n}=Ml({drawDefinition:e,structure:i,matchUp:r});n.length&&(console.log({connectedStructureIds:n}),a=!0);const o=dl(t);if(o.error)return o}const o=_l(t);return o.error?o:{...pt,connectedStructures:a}}(t)||o&&d({removeScore:s})||u&&Sl(t)||c&&d()||e&&function(t){var e;const n=Boolean(t.matchUp.collectionId),i=t.isCollectionMatchUp&&(null===(e=t.dualMatchUp)||void 0===e?void 0:e.winningSide)&&t.projectedWinningSide,r=cl({...t,removeScore:!0});if(n){const{matchUpTieId:e,drawDefinition:n,structure:r,event:a}=t,{removeWinningSide:o}=ul({matchUpId:e,drawDefinition:n,structure:r,event:a});console.log("ndd",{removeWinningSide:o,removeDirected:i})}return r}({...t,removeScore:!0})||console.log("unknown condition")&&{...pt}}function Wl(t){var e;const{inContextDrawMatchUps:n,targetData:i,drawDefinition:r}=t,{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o}}=i,s=(null==o||null===(e=o.drawPositions)||void 0===e?void 0:e.filter(Boolean).length)||0;if(null!=a&&a.winningSide||2===s&&null!=o&&o.winningSide)return!0;let c=a&&sd({matchUpId:a.matchUpId,drawDefinition:r,inContextDrawMatchUps:n}),u=o&&sd({matchUpId:o.matchUpId,drawDefinition:r,inContextDrawMatchUps:n});const d=c&&Wl({inContextDrawMatchUps:n,drawDefinition:r,targetData:c});return!(!(u&&Wl({inContextDrawMatchUps:n,drawDefinition:r,targetData:u}))&&!d)}function ql(t){var e;const{allowChangePropagation:n,tournamentRecord:i,drawDefinition:r,matchUpStatus:a,winningSide:o,matchUpId:s,event:c}=t;if(!r)return{error:Ut};if([N,b,U,O].includes(a)&&o)return{error:_n,winningSide:o,matchUpStatus:a};if(![void 0,...F].includes(a))return{error:se};const u=Gc({drawDefinition:r});let{matchUps:d}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:u});!!d.find((({winnerMatchUpId:t,loserMatchUpId:e})=>t||e))||({inContextDrawMatchUps:d}=Td({inContextDrawMatchUps:d,drawDefinition:r,matchUpsMap:u}));const l=u.drawMatchUps.find((t=>t.matchUpId===s)),p=d.find((t=>t.matchUpId===s));if(!l||!d)return{error:he};if((l.winningSide||o)&&a===S)return{error:oe,matchUpStatus:a};const m=null===(e=p.drawPositions)||void 0===e?void 0:e.filter(Boolean);if(a&&L.includes(a)&&(!m||(null==m?void 0:m.length)<2))return{error:se};if(l.matchUpType===ma)return{error:"DIRECT SCORING of TEAM matchUp not implemented"};const f=p.matchUpTieId,h=sd({matchUpId:f||s,inContextDrawMatchUps:d,drawDefinition:r}),I=p.structureId,{structure:v}=Wc({drawDefinition:r,structureId:I});let g;if(Object.assign(t,{inContextDrawMatchUps:d,inContextMatchUp:p,matchUpTieId:f,matchUpsMap:u,targetData:h,structure:v,matchUp:l}),f){const{matchUp:e}=Bu({matchUpId:f,inContext:!0,drawDefinition:r,matchUpsMap:u,event:c}),n=e.tieFormat||r.tieFormat,{projectedWinningSide:i}=function({drawDefinition:t,winningSide:e,dualMatchUp:n,tieFormat:i,structure:r,matchUp:a,event:o}){const s=a.winningSide;let c=[0,0];1===e&&2===s?c=[1,-1]:2===e&&1===s?c=[-1,1]:e&&!s?c=1===e?[1,0]:[0,1]:s&&!e&&(c=1===s?[-1,0]:[0,-1]),i=i||(null==a?void 0:a.tieFormat)||(null==r?void 0:r.tieFormat)||(null==t?void 0:t.tieFormat)||(null==o?void 0:o.tieFormat);const{winningSide:u}=xa({matchUp:n,sideAdjustments:c,tieFormat:i});return{projectedWinningSide:u}}({winningSide:o,dualMatchUp:e,tieFormat:n,structure:v,matchUp:l,event:c});g=i!==e.winningSide,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:g,projectedWinningSide:i,matchUpTieId:f,dualMatchUp:e,tieFormat:n})}const y=Wl(t),w=Yd({matchUpStatus:a});if(!f){if(y&&!o&&$d({matchUpStatus:a}))return{error:oe,activeDownstream:y,winningSide:o};if(o&&o===l.winningSide&&a&&!w)return{error:oe,directingMatchUpStatus:w,matchUpStatus:a}}const{schedule:D}=t;if(D){const t=$u({tournamentRecord:i,disableNotice:!0,drawDefinition:r,matchUpId:s,schedule:D});if(t.error)return t}const P=l.matchUpType!==ma&&!g&&o&&l.winningSide&&l.winningSide!==o;if(n&&P&&l.roundPosition)return function(t){var e;const{inContextMatchUp:n,structure:i,drawDefinition:r}=t,a=n.roundNumber,o=n.sides.find((t=>t.sideNumber===n.winningSide)),s=n.sides.find((t=>t.sideNumber!==n.winningSide)),{drawPosition:c,participantId:u}=o,{drawPosition:d,participantId:l}=s,{matchUps:p}=ju(t),m=p.filter((({drawPositions:t,roundNumber:e})=>(null==t?void 0:t.includes(c))&&e>a));ei({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach((t=>{var e;t.drawPositions=(null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>t===c?d:t)))||[],Mc({drawDefinition:r,matchUp:t})}));const{stage:f,stageSequence:h}=i,I=r.structures.filter((({stage:t,stageSequence:e})=>t===f&&e>h)).map((({structureId:t})=>t)),{targetLinks:{loserTargetLink:v,winnerTargetLink:g}}=t.targetData,y=[null==v?void 0:v.target.structureId,null==g||null===(e=g.target)||void 0===e?void 0:e.structureId].filter(Boolean);return r.structures.filter((({stage:t,structureId:e})=>t!==f&&y.includes(e))).forEach((({stage:t,stageSequence:e,structureId:n})=>{I.includes(n)||I.push(n),r.structures.filter((({stage:n,stageSequence:i})=>n===t&&i>e)).forEach((({structureId:t})=>{I.includes(t)||I.push(t)}))})),r.structures.filter((({structureId:t})=>I.includes(t))).forEach((t=>{const{positionAssignments:e}=Cu({structure:t}),n=e.find((({participantId:t})=>t===u)),i=e.find((({participantId:t})=>t===l));n&&(n.participantId=l),i&&(i.participantId=u)})),cl(t)}(t);const T=o&&!f||t.projectedWinningSide;return!y&&Hl(t)||T&&function(t){const{matchUp:e,winningSide:n,matchUpTieId:i,dualWinningSideChange:r}=t;return n===e.winningSide||i&&!r?Kl(t):{error:Ve}}(t)||w&&Kl(t)||{error:Vn}}function Kl(t){const{matchUp:e,event:n}=t,i=t.isCollectionMatchUp&&e.winningSide&&!t.winningSide&&!Vl({score:t.score}),r=t.isCollectionMatchUp?t.machUpStatus||i&&O:t.matchUpStatus||D,a=[N,x].includes(r)&&![b,U].includes(r),o=cl({...t,matchUpStatus:r,removeWinningSide:i,removeScore:a});if(t.isCollectionMatchUp){const{matchUpTieId:e,drawDefinition:i,structure:r}=t,{removeWinningSide:a}=ul({matchUpId:e,drawDefinition:i,structure:r,event:n});console.log("sms",{removeWinningSide:a})}return o}function zl(t){const{drawDefinition:e,event:n,matchUpFormat:i,structureId:r,matchUpId:a}=t;let{tieFormat:o}=t;if(!e)return{error:Ut};if(!i&&!o)return{error:de};if(i&&!v(i))return{error:ae};if(o){const t=function(t){const e=Va({tieFormat:t,checkCollectionIds:!1});if(e.error)return e;for(const n of t.collectionDefinitions)n.collectionId||(n.collectionId=zi());return{tieFormat:t}}(o);if(t.error)return t;o=t.tieFormat}if(a){const{matchUp:t,error:r}=Bu({drawDefinition:e,matchUpId:a,event:n});if(r)return{error:r};if(i&&t.matchUpType!==Fa)t.matchUpFormat=i;else{if(!o||t.matchUpType!==Fa)return{error:_n};t.tieFormat=o}Mc({drawDefinition:e,matchUp:t})}else if(r){const{structure:t,error:n}=Wc({drawDefinition:e,structureId:r});if(n)return{error:n};if(!t)return{error:Wt};i&&t.matchUpType!==Fa?t.matchUpFormat=i:o&&(t.tieFormat=o)}else e&&(i?e.matchUpFormat=i:o&&(e.tieFormat=o));return Ec({drawDefinition:e,structureIds:r?[r]:void 0}),{...pt,tieFormat:o}}function Yl({score:t,winningSide:e,matchUpStatus:n}={}){if(!t)return{sets:[]};const i=t.sets||[];let r=bo({winnerFirst:!1,matchUpStatus:n,sets:i}),a=bo({winnerFirst:!1,matchUpStatus:n,reversed:!0,sets:i}),o=bo({winningSide:e,matchUpStatus:n,sets:i}),s=r===o?a:r;return e&&(r=1===e?o:s,a=2===e?o:s),{score:{sets:i,scoreStringSide1:r,scoreStringSide2:a}}}function $l(t){var e;const{tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpId:a,schedule:o,event:s,notes:c}=t;if(!i)return{error:xt};if(!a)return{error:me};const{policy:u}=ia({policyType:ur,tournamentRecord:n,event:s}),d=void 0!==t.allowChangePropagation?t.allowChangePropagation:void 0!==(null==u?void 0:u.allowChangePropagation)?u.allowChangePropagation:void 0;let{outcome:l}=t;if(r){const t=zl({drawDefinition:i,matchUpFormat:r,matchUpId:a,event:s});if(t.error)return t}if(null!=l&&null!==(e=l.score)&&void 0!==e&&e.sets&&!l.score.scoreStringSide1){const{score:t}=Yl(l);l.score=t,l.score.sets=l.score.sets.filter((t=>t.side1Score||t.side2Score||t.side1TiebreakScore||t.side2TiebreakScore))}return ql({tournamentRecord:n,drawDefinition:i,event:s,matchUpStatusCodes:null==l?void 0:l.matchUpStatusCodes,matchUpStatus:null==l?void 0:l.matchUpStatus,matchUpFormat:r,matchUpId:a,winningSide:null==l?void 0:l.winningSide,allowChangePropagation:d,score:null==l?void 0:l.score,schedule:o,notes:c})}function Jl(t){if(!t.tournamentRecord)return{error:It};const{tournamentRecord:e,outcomes:n}=t,i={};n.forEach((t=>{const{eventId:e}=t;i[e]||(i[e]=[]),i[e].push(t)}));for(const r of Object.keys(i)){const{event:t}=wa({tournamentRecord:e,eventId:r});for(const n of i[r]){const{drawId:i}=n,r=t.drawDefinitions.find((t=>t.drawId===i));if(r){const{matchUpFormat:a,matchUpId:o}=n,s=$l({tournamentRecord:e,drawDefinition:r,event:t,drawId:i,matchUpFormat:a,matchUpId:o,schedule:null==n?void 0:n.schedule,outcome:n});if(s.error)return s}}}return pt}function Zl({tournamentRecord:t}){if(!t)return{error:It};const e=t.tournamentId,{extension:n}=sa({tournamentRecord:t,name:Jr});let i=(null==n?void 0:n.value)||[];if(i.length){const n=t.venues.map((({venueId:t,courts:e})=>(null==e?void 0:e.length)&&t)),{eventIds:r,drawIds:a}=Sd({tournamentRecords:{[e]:t}}),{updatedSchedulingProfile:o,modifications:s,issues:c}=_d({schedulingProfile:i,venueIds:n,eventIds:r,drawIds:a});if(s){i=o;const e=function({tournamentRecord:t,schedulingProfile:e}){return $c({tournamentRecord:t,extension:{name:Jr,value:e}})}({tournamentRecord:t,schedulingProfile:i});return e.error?e:{schedulingProfile:i,modifications:s,issues:c}}}return{schedulingProfile:i,modifications:0}}function Ql({tournamentRecord:t,schedulingProfile:e,requireCourts:n=!0}){if(!e){const{modifications:e,issues:n}=Zl({tournamentRecord:t});return{success:!e,modifications:e,issues:n}}const{venueIds:i,eventIds:r,drawIds:a}=bd({tournamentRecord:t,requireCourts:n}),{modifications:o,issues:s}=_d({schedulingProfile:e,venueIds:i,eventIds:r,drawIds:a});return{success:!o,modifications:o,issues:s}}function Xl({tournamentRecord:t,courtId:e,scheduleVisibilityFilters:n,matchUpFilters:i}){if(!t)return{error:It};if(!e)return{error:be};const{schedulingProfile:r}=Zl({tournamentRecord:t}),{matchUps:a}=fd({tournamentRecord:t,scheduleVisibilityFilters:n,matchUpFilters:i});return{matchUps:function({matchUps:t,courtId:e}){return Vd({matchUps:t.filter((t=>{var n;return(null===(n=t.schedule)||void 0===n?void 0:n.courtId)===e})),schedulingProfile:r})}({matchUps:a,courtId:e})}}function tp({matchUpsCount:t=0}){const e=`Schedule would be deleted from ${t} ${1===t?"matchUp":"matchUps"}; use { force: true }`;return{message:e,error:e}}function ep({startTime:t,endTime:e}={}){if(!yi.test(t)||!yi.test(e))return!1;const[n,i]=t.split(":"),[r,a]=e.split(":");return!(r<n)&&!(n===r&&a<i)}function np({dateAvailability:t}){if(!t)return{error:Le};if(!Array.isArray(t))return{error:xe};const e="Times must be 24 hour => 00:00";for(const n of t){if("object"!=typeof n)return{error:xe};const{date:t,startTime:i,endTime:r,bookings:a=[]}=n;if(!i||!r)return{error:xe};if(t&&!gi.test(t))return{error:Fe,dateAvailability:{date:t},message:"Dates must be formated => YYYY-MM-DD"};if(!yi.test(i))return{error:ke,dateAvailability:{startTime:i},message:e};if(!yi.test(r))return{error:ke,dateAvailability:{endTime:r},message:e};if(i===r)return{error:ke,dateAvailability:{startTime:i,endTime:r},message:"startTime and endTime are equivalent"};if(!ep({startTime:i,endTime:r}))return{error:ke,dateAvailability:{startTime:i,endTime:r},message:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:Oe};for(const t of a){if("object"!=typeof t)return{error:Oe};const{startTime:n,endTime:i}=t;if(!yi.test(n))return{error:ke,booking:{startTime:n},message:e};if(!yi.test(i))return{error:ke,booking:{endTime:i},message:e};if(n===i)return{error:ke,dateAvailability:{startTime:n,endTime:i},message:"startTime and endTime are equivalent"};if(!ep({startTime:n,endTime:i}))return{error:ke,dateAvailability:{startTime:n,endTime:i},message:"endTime must be after startTime"}}}}return{valid:!0}}function ip({tournamentRecord:t,dateAvailability:e,disableNotice:n,courtId:i,force:r}){if(!t)return{error:It};if(!i)return{error:be};const a=np({dateAvailability:e});if(a.error)return a;const{court:o,venue:s,error:c}=Wu({tournamentRecord:t,courtId:i});return c?{error:c}:(o.dateAvailability=e,n||ri({topic:Sc,payload:{venue:s},key:s.venueId}),pt)}function rp({tournamentRecord:t,modifications:e,disableNotice:n,courtId:i,force:r}){if(!t)return{error:It};if(!i)return{error:be};if(!e||"object"!=typeof e)return{error:Bn};const{court:a,venue:o,error:s}=Wu({tournamentRecord:t,courtId:i});if(s)return{error:s};const c=Object.keys({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}).filter((t=>"courtId"!==t));if(!Object.keys(e).filter((t=>c.includes(t))).length)return{error:Hn};const u=c.filter((t=>!["dateAvailability"].includes(t)));if(Object.keys(e).filter((t=>u.includes(t))).forEach((t=>Object.assign(a,{[t]:e[t]}))),e.dateAvailability){const a=ip({tournamentRecord:t,dateAvailability:e.dateAvailability,disableNotice:n,courtId:i,force:r});if(a.error)return a}return n||ri({topic:Sc,payload:{venue:o},key:o.venueId}),{...pt,court:Hi(a)}}function ap({tournamentRecord:t,disableNotice:e,returnDetails:n,venueId:i,court:r}){const{venue:a}=Vu({tournamentRecord:t,venueId:i});if(!a)return{error:Nn};a.courts||(a.courts=[]);const o={altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0,venueId:i};o.courtId||(o.courtId=zi());if(a.courts.reduce(((t,e)=>t||e.courtId===o.courtId),void 0))return{error:wn};{const t=((null==r?void 0:r.dateAvailability)||[]).map((t=>{var e;return{...t,date:Oi(t.date),startTime:Ri(t.startTime),endTime:Ri(t.endTime),bookings:null===(e=t.bookings)||void 0===e?void 0:e.map((({startTime:t,endTime:e,bookingType:n})=>({startTime:Ri(t),endTime:Ri(e),bookingType:n})))}}));for(const e of Object.keys(o))if(r[e])if("dateAvailability"===e){const e=np({dateAvailability:t}),{valid:n,error:i}=e;if(n)o.dateAvailability=t;else if(i)return{error:i}}else o[e]=r[e];return a.courts.push(o),e||ri({topic:Sc,payload:{venue:a},key:a.venueId}),ei()||n?{...pt,court:Hi(o),venueId:i}:{...pt}}}function op({dateAvailability:t=[],tournamentRecord:e,courtNames:n=[],courtsCount:i,venueId:r}){if(!r)return{error:Dn};if(!z(i)||!n)return{error:yn};const a=ot(0,i=i||n.length).map((e=>({courtName:n[e]||`Court ${e+1}`,dateAvailability:t}))).map((t=>ap({tournamentRecord:e,venueId:r,court:t,disableNotice:!0,returnDetails:!0}))),o=a.map((t=>t.court)).filter(Boolean);if(o.length===i){const{venue:t}=Vu({tournamentRecord:e,venueId:r});return ri({topic:Sc,payload:{venue:t},key:t.venueId}),{...pt,courts:Hi(o)}}return Object.assign({},{courts:Hi(o)},{error:a})}function sp({tournamentRecord:t,modifications:e,venueId:n,force:i}){var r,a;if(!t)return{error:It};if(!e||"object"!=typeof e)return{error:Bn};if(!n)return{error:Dn};const{venue:o,error:s}=Vu({tournamentRecord:t,venueId:n});if(s)return{error:s};const c=Object.keys({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}).filter((t=>"venueId"!==t));if(!Object.keys(e).filter((t=>c.includes(t))).length)return{error:Hn};const u=c.filter((t=>!["courts"].includes(t)));Object.keys(e).filter((t=>u.includes(t))).forEach((t=>Object.assign(o,{[t]:e[t]})));const d=(null==o||null===(r=o.courts)||void 0===r?void 0:r.map((t=>t.courtId)))||[],l=(null===(a=e.courts)||void 0===a?void 0:a.map((t=>t.courtId)))||[],p=d.filter((t=>!l.includes(t)));if(p.length){const e=o.courts.filter((t=>p.includes(t.courtId))).map((e=>{const{matchUps:n}=Xl({tournamentRecord:t,courtId:e.courtId});return n.length})).reduce(((t,e)=>t+e));if(e&&!i){return{error:tp({matchUpsCount:e})}}o.courts=o.courts.filter((t=>l.includes(t.courtId)))}if(e.courts)for(const m of e.courts){const{courtId:e}=m||{};let r=rp({tournamentRecord:t,modifications:m,disableNotice:!0,courtId:e,force:i});if(r.error===Un&&(r=ap({tournamentRecord:t,venueId:n,court:m,disableNotice:!0})),r.error)return r}return Ql({tournamentRecord:t}),ri({topic:Sc,payload:{venue:o},key:o.venueId}),{...pt,venue:Hi(o)}}function cp({tournamentRecord:t,drawDefinition:e,drawId:n,matchUpId:i}){if(!i)return{error:me};if(!e&&!n)return{error:xt};let r;if(!e){if(!t)return{error:It};({drawDefinition:e}=wa({tournamentRecord:t,drawId:n}))}if(e)({matchUp:r}=Bu({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:It};const{matchUps:e}=vd({tournamentRecord:t});({matchUp:r}=Oa({matchUps:e,matchUpId:i}))}if(!r)return{error:he};if(r.timeItems){if(r.timeItems.reduce(((t,e)=>e.itemType===hr||t),void 0)){const t={itemType:hr,itemValue:"",itemDate:""};r.timeItems.push(t),Mc({drawDefinition:e,matchUp:r})}}return pt}function up({tournamentRecord:t,venueId:e,force:n}){if(!t)return{error:It};if("string"!=typeof e)return{error:Dn};const{courts:i}=qu({tournamentRecord:t,venueId:e}),r={courtIds:i.map((t=>t.courtId))},{matchUps:a}=fd({tournamentRecord:t,contextFilters:r});if(a.length&&!n)return tp({matchUpsCount:a.length});for(const s of a){const e=cp({tournamentRecord:t,drawId:s.drawId,matchUpId:s.matchUpId});if(e.error)return e}let o;return t.venues=(t.venues||[]).filter((t=>{if(t.venueId!==e)return!0;o=!0})),o&&ri({topic:vc,payload:{venueId:e}}),pt}function dp({flight:t,checkEntryStatus:e=!0,modifyEventEntries:n,existingDrawCount:i,drawDefinition:r,event:a}){var o,s,c,u,d;if(!r)return{error:xt};if(!a)return{error:Yt};a.drawDefinitions||(a.drawDefinitions=[]);const{drawId:l,drawName:p,entries:m}=r,{entries:f}=a;let h=0;if(void 0!==i&&i!==a.drawDefinitions.length)return{error:_n,message:"drawDefintions count mismatch"};if(!!a.drawDefinitions.find((t=>t.drawId===l)))return{error:Lt};const{flightProfile:I}=ol({event:a}),v=t&&(null==I||null===(o=I.flights)||void 0===o?void 0:o.find((e=>e.flightNumber===t.flightNumber)));if(v&&v.drawId!==r.drawId)return{error:yt,relevantFlight:v};const g=null==v?void 0:v.drawEntries.every((({participantId:t,entryStatus:e})=>{const n=m.find((e=>e&&e.participantId===t));return(null==n?void 0:n.entryStatus)===e})),y=!e||f&&(null==m?void 0:m.every((({participantId:t,entryStatus:e})=>{const n=f.find((e=>e.participantId===t));return(null==n?void 0:n.entryStatus)===e})));if(v&&!g)return{error:yt,relevantFlight:v,matchingEventEntries:y};if(n&&m.filter(Boolean).forEach((t=>{if(hu.includes(null==t?void 0:t.entryStatus)){const e=f.filter(Boolean).find((e=>e.participantId===t.participantId));t.entryStatus&&e.entryStatus!==t.entryStatus&&(e.entryStatus=t.entryStatus,h+=1)}})),f&&!y)return{error:yt,eventEntries:f,matchingEventEntries:y};const U=(null==I||null===(s=I.flights)||void 0===s||null===(c=s.map((({flightNumber:t})=>!isNaN(t)&&parseInt(t))))||void 0===c?void 0:c.filter(Boolean))||[],w=(null===(u=a.drawDefinitions.map((({drawOrder:t})=>!isNaN(t)&&parseInt(t))))||void 0===u?void 0:u.filter(Boolean))||[];let S=Math.max(0,...w,...U)+1;const N=null==I||null===(d=I.flights)||void 0===d?void 0:d.find((t=>t.drawId===l));let D;if(N){N.drawName=r.drawName,D={name:Vr,value:{...I,flights:I.flights}};const t=N.flightNumber;t&&!w.includes(t)?S=t:N.flightNumber=S}else{const t=(null==I?void 0:I.flights)||[];t.push({manuallyAdded:!0,flightNumber:S,drawEntries:m,drawName:p,drawId:l}),D={name:Vr,value:{...I||{},flights:t}}}Zc({event:a,extension:D}),Object.assign(r,{drawOrder:S}),a.drawDefinitions.push(r);const{topics:P}=si();if(P.includes(lc)){const{matchUps:t}=hd({drawDefinition:r,event:a});Tc({drawDefinition:r,matchUps:t})}return bc({drawDefinition:r}),{...pt,modifiedEventEntryStatusCount:h}}function lp({tournamentRecord:t,returnDetails:e,disableNotice:n,venue:i}){if(!t)return{error:It};if(!i)return{error:Ee};t.venues||(t.venues=[]),i.venueId||(i.venueId=zi());return t.venues.reduce(((t,e)=>t||e.venueId===i.venueId),void 0)?{error:Sn}:(t.venues.push(i),n||ri({topic:mc,payload:{venue:i}}),ei({addVenue:!0})?{...pt,venue:Hi(i)}:e?i:{...pt})}function pp({allowDuplicateParticipantIdPairs:t,tournamentRecord:e,disableNotice:n,pairOverride:i,participant:r}){if(!e)return{error:It};if(!r)return{error:Ye};r.participantId||(r.participantId=zi()),e.participants||(e.participants=[]);const{participantId:a}=r;if(e.participants.reduce(((t,e)=>e.participantId===a||t),!1))return{error:Qe};const{participantType:o,participantRole:s}=r;if(!Object.keys(Ba).includes(o))return{error:Ke,participantType:o};if(!s)return{error:ze};const c=e.participants||[],u=c.filter((t=>t.participantType===La)).map((t=>t.participantId));if(o===ka){if(r.person)return{error:_n,person:r.person};if(!r.individualParticipantIds)return{error:tn};if(2!==r.individualParticipantIds.length&&!i)return{error:qe,message:"PAIR must be 2 individualParticipantIds"};{const t=c.filter((t=>t.participantType===La)).map((t=>t.participantId));if(!Array.isArray(r.individualParticipantIds))return{error:qe};if(!r.individualParticipantIds.reduce(((e,n)=>t.includes(n)&&e),!0))return{error:qe}}const e=c.filter((t=>t.participantType===ka)).map((t=>({participant:t,individualParticipantIds:t.individualParticipantIds}))),n=r.participantType===ka&&e.find((t=>2===ct(t.individualParticipantIds,r.individualParticipantIds).length));if(n&&!t)return{...pt,participant:Hi(n.participant)};if(!r.participantName){const t=c.filter((t=>r.individualParticipantIds.includes(t.participantId)));let e=t.map((t=>{var e;return null===(e=t.person)||void 0===e?void 0:e.standardFamilyName})).filter(Boolean).join("/");1===t.length&&(e+="/Unknown"),r.participantName=e}}else if(o===La){if(!r.person||!r.person.standardFamilyName||!r.person.standardGivenName)return{error:on};if(!r.participantName){const t=`${r.person.standardFamilyName.toUpperCase()}, ${r.person.standardGivenName}`;r.participantName=t,r.name=t}}else{if(r.person)return{error:_n,person:r.person};const{individualParticipantIds:t}=r;if(null!=t&&t.length)for(const e of t){if("string"!=typeof e)return{error:_n,participantId:e};if(!u.includes(e))return{error:Ze,participantId:e}}}e.participants.push(r),n||ri({topic:pc,payload:{participants:[r]}});return{...pt,participant:Hi(r)}}function mp({tournamentRecord:t,participants:e=[],allowDuplicateParticipantIdPairs:n}){if(!t)return{error:It};t.participants||(t.participants=[]);const i=t.participants.map((t=>t.participantId))||[];e.forEach((t=>{t.participantId||(t.participantId=zi())}));const r=e.filter((t=>!i.includes(t.participantId))),a=e.filter((t=>i.includes(t.participantId))),o=r.filter((t=>t.participantType===La)),s=r.filter((t=>t.participantType!==La)),c=o.concat(...s);if(c.length){const e=[];for(const r of c){const i=pp({tournamentRecord:t,participant:r,disableNotice:!0,allowDuplicateParticipantIdPairs:n}),{success:a,error:o,participant:s}=i;if(a&&e.push(s),o)return{error:o}}ri({topic:pc,payload:{participants:e}});const i={...pt,participants:Hi(e)};return a.length&&Object.assign(i,{notAdded:a,message:cn}),i}return{...pt,message:"No new participants to add"}}const fp=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e})=>!!Object.keys(e).filter((e=>t.includes(e))).filter((t=>e[t])).length;function hp({matchUps:t=[],scheduleAttributes:e=["scheduledDate","scheduledTime"]}){if(!Array.isArray(t))return{error:Ie};if(!Array.isArray(e))return{error:_n};const n=t.filter((({schedule:t})=>fp({schedule:t,scheduleAttributes:e}))).reduce(((t,e)=>{const{schedule:n}=e,i=Oi(null==n?void 0:n.scheduledDate),r=Ri(null==n?void 0:n.scheduledTime);return i&&r&&(t[i]?t[i].push(e):t[i]=[e]),t}),{});return Object.keys(n).forEach((t=>{n[t].sort(((t,e)=>{var n,i;return function(t,e){const n=Li(t),i=Li(e);if(parseInt(n.hours)<parseInt(i.hours))return-1;if(parseInt(n.hours)>parseInt(i.hours))return 1;if(n.hours===i.hours){if(parseInt(n.minutes)<parseInt(i.minutes))return-1;if(parseInt(n.minutes)>parseInt(i.minutes))return 1}return 0}(Ri(null===(n=t.schedule)||void 0===n?void 0:n.scheduledTime),Ri(null===(i=e.schedule)||void 0===i?void 0:i.scheduledTime))}))})),{scheduledMatchUps:n}}var Ip,vp="SIGN_IN_STATUS";!function(t){t.INDIVIDUAL="INDIVIDUAL",t.PAIR="PAIR",t.TEAM="TEAM"}(Ip||(Ip={}));var gp,yp=Ip.INDIVIDUAL,Up=Ip.PAIR,wp=Ip.TEAM;!function(t){t.SIGNED_IN="SIGNED_IN",t.SIGNED_OUT="SIGNED_OUT"}(gp||(gp={}));var Sp=gp.SIGNED_IN,Np=gp.SIGNED_OUT,Dp={INDIVIDUAL:yp,PAIR:Up,TEAM:wp,SIGNED_IN:Sp,SIGNED_OUT:Np,SIGN_IN_STATUS:vp};function Pp(t){var e,n;const i=[],r={},{tournamentRecord:a,participantFilters:o}=t,s=(null==a?void 0:a.participants)||[],{relevantParticipantIdsMap:c}=function({tournamentRecord:t,tournamentRecords:e,processParticipantId:n}){if("object"!=typeof t&&"object"!=typeof e)return{error:It};const i=e?Object.values(e).map((({participants:t=[]})=>t)).flat():t.participants||[];return{relevantParticipantIdsMap:Object.assign({},...i.map((({participantId:t,participantType:e,individualParticipantIds:i})=>("function"==typeof n&&n(t),{[t]:(i||[]).map((t=>({relevantParticipantId:t,participantType:yp}))).concat({relevantParticipantId:t,participantType:e})}))))}}({processParticipantId:t=>{r[t]||(r[t]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},draws:{},losses:0,wins:0})},tournamentRecord:a}),u=null==o?void 0:o.participantIds,d=t=>{const e=t&&c[t]||[];return e.some((t=>!u||u.includes(t.relevantParticipantId)))?e:[]};return s.forEach((t=>{if(t.participantType===ja){const e=t.participantId;t.individualParticipantIds.forEach((t=>{r[t].groupParticipantIds.includes(e)||r[t].groupParticipantIds.push(e)}))}if(t.participantType===ma){const e=t.participantId;t.individualParticipantIds.forEach((t=>{r[t].teamParticipantIds.includes(e)||r[t].teamParticipantIds.push(e)}))}if(t.participantType===ka){const e=t.participantId;t.individualParticipantIds.forEach((t=>{r[t].pairParticipantIds.includes(e),r[t].pairParticipantIds.push(e)}))}})),null===(e=t.tournamentEvents)||void 0===e||e.forEach((t=>{var e,n,i;const o=Hi(t,!0,!0),{eventId:s,eventName:u,eventType:l,category:p}=o,m={eventId:s,eventName:u,eventType:l,category:p},f=o&&Object.keys(o).filter((t=>"_"===t[0]));null==f||f.forEach((t=>m[t]=o[t]));const h=o.entries||[],I=[].concat(...Object.values(Xr)).map((t=>`_${t}`)),v=m&&Object.keys(m).filter((t=>!I.includes(t))).reduce(((t,e)=>(t[e]=m[e],t)),{});null==h||h.filter((t=>null==t?void 0:t.participantId)).forEach((t=>{const{participantId:e,entryStage:n,entryStatus:i,entryPosition:a}=t,o=d(e);null==o||o.forEach((({relevantParticipantId:t})=>{r[t].events[s]={...v,partnerParticipantIds:[],entryPosition:a,entryStatus:i,entryStage:n,drawIds:[]}}))}));const g=(null===(e=o.drawDefinitions)||void 0===e?void 0:e.map((({drawId:t})=>t)))||[];null===(n=m._flightProfile)||void 0===n||null===(i=n.flights)||void 0===i||i.forEach((t=>{const{drawId:e,drawEntries:n}=t;g.includes(e)||null==n||n.forEach((t=>(({drawId:t,drawEntry:e,drawName:n,drawType:i})=>{const{participantId:a,entryStage:o,entryStatus:c,entryPosition:u}=e,p=d(a);l===ma&&console.log({eventType:l},p),null==p||p.forEach((({relevantParticipantId:e})=>{r[e].events[s]||(r[e].events[s]={...v,partnerParticipantIds:[],entryPosition:u,entryStatus:c,entryStage:o,drawIds:[]}),r[e].draws[t]||(r[e].draws[t]={partnerParticipantIds:[],entryPosition:u,entryStatus:c,entryStage:o,drawName:n,drawType:i,eventId:s,drawId:t});const a=r[e].events[s].drawIds;!a||null!=a&&a.includes(t)||r[e].events[s].drawIds.push(t)}))})({drawId:e,drawEntry:t})))}));const{matchUps:y}=Id({tournamentRecord:a,nextMatchUps:!0,inContext:!0,event:o}),U=Object.assign({},...(o.drawDefinitions||[]).map((t=>{const e=Object.assign({},...h.filter((t=>t.participantId)).map((t=>({[t.participantId]:t}))),...t.entries.filter((t=>t.participantId)).map((t=>({[t.participantId]:t})))),n=Object.values(e);return{[t.drawId]:{drawType:t.drawType,drawEntries:n}}})));null==y||y.forEach((t=>function({matchUp:t,drawDetails:e,eventType:n}){const{drawId:i,drawName:a,eventId:o,eventName:s,finishingPositionRange:u,loserTo:l,matchUpId:p,matchUpType:m,matchUpFormat:f,matchUpStatus:h,roundName:I,roundNumber:v,roundPosition:g,score:y,sides:U,schedule:w,structureName:S,structureId:N,tieFormat:D,tieMatchUps:P,tournamentId:T,winnerTo:A,winningSide:M}=t,{winner:b,loser:E}=u||{},C=(null==P?void 0:P.length)&&P.filter((({matchUpType:t})=>t===pa)).map((({sides:t})=>t.map((({sideNumber:t,participantId:e})=>t&&e&&{sideNumber:t,participantId:e})))).flat().filter(Boolean);if(null==U||U.forEach((({participantId:u,sideNumber:P}={})=>{if(!u)return;const{drawType:R,drawEntries:O}=e[i],x=1===P?null==y?void 0:y.scoreStringSide1:null==y?void 0:y.scoreStringSide2,L=M&&P===M,F=t.sides.find((({sideNumber:t}={})=>t===3-P)),k=null==F?void 0:F.participantId,j=k&&c[k]||[],B=M&&(L?b:E),_=O.find((t=>t.participantId===u)),G=d(u).filter((t=>n!==ma||n===ma&&m===pa||t.participantType!==ka));null==C||C.filter((t=>t.sideNumber===P)).forEach((({participantId:t})=>{t&&!G.includes(t)&&G.push({relevantParticipantId:t,participantType:ka})})),null==G||G.forEach((({relevantParticipantId:t,participantType:e})=>{const{entryStage:c,entryStatus:u,entryPosition:d}=_||{};r[t].draws[i]||(r[t].draws[i]={partnerParticipantIds:[],entryPosition:d,entryStatus:u,entryStage:c,drawName:a,drawType:R,eventId:o,drawId:i}),r[t].events[o]||(r[t].events[o]={partnerParticipantIds:[],drawIds:[],eventName:s,eventId:o});const P=r[t].events[o].drawIds;let b;if(!P||null!=P&&P.includes(i)||r[t].events[o].drawIds.push(i),e===La&&m===pa){const e=G.find((e=>e.relevantParticipantId!==t&&e.participantType===La));b=null==e?void 0:e.relevantParticipantId}null==j||j.filter((t=>e===La||t.participantType===e)).forEach((({relevantParticipantId:e,participantType:n})=>{r[t].opponents[e]?r[t].opponents[e].push({eventId:o,drawId:i,matchUpId:p,participantType:n,participantId:e}):r[t].opponents[e]=[{eventId:o,drawId:i,matchUpId:p,participantType:n,participantId:e}]}));const E=j.map((({relevantParticipantId:t,participantType:e})=>({participantId:t,participantType:e})));r[t].matchUps[p]=Wi({drawId:i,eventId:o,eventType:n,finishingPositionRange:B,loserTo:l,matchUpId:p,matchUpType:m,matchUpFormat:f,matchUpStatus:h,opponentParticipantInfo:E,participantWon:L,partnerParticipantId:b,perspectiveScoreString:x,roundName:I,roundNumber:v,roundPosition:g,schedule:w,score:y,sides:U,structureName:S,structureId:N,tieFormat:D,tournamentId:T,winnerTo:A,winningSide:M}),b&&(r[t].events[o].partnerParticipantIds.push(b),r[t].draws[i].partnerParticipantIds.push(b),r[t].events[o].partnerParticipantId=b,r[t].draws[i].partnerParticipantId=b),M&&(L?r[t].wins++:r[t].losses++)}))})),Array.isArray(t.potentialParticipants)){const e=Lc(t.potentialParticipants.flat());null==e||e.forEach((t=>{const e=d(t);null==e||e.forEach((({relevantParticipantId:t})=>{r[t].potentialMatchUps[p]=Wi({drawId:i,eventId:o,eventType:n,matchUpId:p,matchUpType:m,matchUpFormat:f,roundName:I,roundNumber:v,roundPosition:g,schedule:w,tieFormat:D,structureName:S,potential:!0})}))}))}}({matchUp:t,drawDetails:U,eventType:l})))})),null===(n=t.tournamentParticipants)||void 0===n||n.forEach((e=>{const{scheduleConflicts:n,scheduleItems:a}=function({withDraws:t=!0,withEvents:e=!0,withOpponents:n,withMatchUps:i,withStatistics:r,scheduleAnalysis:a,participant:o,participantIdMap:s}){const c=[],u=[],d=null==o?void 0:o.participantId;if(!d||!s[d])return{};const{wins:l,losses:p,matchUps:m,potentialMatchUps:f,events:h,draws:I,opponents:v}=s[d],g=l,y=l+p,U={statCode:"winRatio",numerator:g,denominator:y,statValue:y&&g/y},w=Object.values(I),N=Object.values(h);t&&w&&(o.draws=w),e&&N&&(o.events=N);const D=Object.values(v).flat();n&&null!=D&&D.length&&(o.opponents=D,null==w||w.forEach((t=>{t.opponents=D.filter((e=>e.drawId===t.drawId))})));const P=Object.values(f),T=Object.values(m);i&&(o.potentialMatchUps=P,o.matchUps=T);const A=T.concat(P),{scheduledMatchUps:M}=hp({matchUps:A}),{scheduledMinutesDifference:b}=a||{};Object.keys(M).forEach((t=>{M[t].forEach(((e,n)=>{const{schedule:{scheduledTime:i,timeAfterRecovery:r,typeChangeTimeAfterRecovery:a},matchUpStatus:o,matchUpId:s,roundNumber:d,roundPosition:l,structureName:p,matchUpType:m,drawId:f}=e;if(c.push({drawId:f,matchUpType:m,matchUpId:s,structureName:p,roundNumber:d,roundPosition:l,...e.schedule,scheduledTime:Ri(e.schedule.scheduledTime)}),i&&o!==S){const c=Ei(i),d=M[t].slice(n+1);for(const t of d){var h;if(o!==S&&null!==(h=t.schedule)&&void 0!==h&&h.scheduledTime){const n=e.matchUpType!==t.matchUpType&&a||r,i=e.drawId===t.drawId,o=e.potential&&t.potential,d=Ei(t.schedule.scheduledTime)-c;!(b&&!isNaN(b)?d<=b:Ei(n)>Ei(t.schedule.scheduledTime))||o&&i||u.push({priorScheduledMatchUpId:t.matchUpId,matchUpIdWithConflict:s})}}}}))})),null==w||w.forEach((t=>{const e=m&&T.filter((e=>e.drawId===t.drawId))||[],n=t=>Math.abs(t[0]-t[1]),i=e.reduce(((t,e)=>t?t&&e.finishingPositionRange&&n(t)>n(e.finishingPositionRange)?e.finishingPositionRange:t:e.finishingPositionRange),void 0);t.finishingPositionRange=i})),r&&(o.statistics=[U]);return{scheduleConflicts:u,scheduleItems:c}}({...t,participant:e,participantIdMap:r});t.withScheduleItems&&(e.scheduleItems=a),t.scheduleAnalysis&&(e.scheduleConflicts=n,null!=n&&n.length&&(i.includes(e.participantId)||i.push(e.participantId))),!1!==t.withGroupings&&(e.groupParticipantIds=r[e.participantId].groupParticipantIds,e.pairParticipantIds=r[e.participantId].pairParticipantIds,e.teamParticipantIds=r[e.participantId].teamParticipantIds)})),{participantIdsWithConflicts:i}}function Tp({element:t,accessor:e}){if("string"!=typeof e)return{values:[]};const n=Hi(t),i=e.split(".");let r,a=[];!function t({targetElement:e,attributes:n=[],significantCharacters:i}){for(const[r,a]of n.entries())if(e&&e[a])if(Array.isArray(e[a])){const i=e[a],o=n.slice(r);i.forEach((e=>t({targetElement:e,attributes:o})))}else o({targetElement:e=e[a],index:r});function o({targetElement:t,index:e}){if(t&&e===n.length-1&&["string","number"].includes(typeof t)){const e=i?t.slice(0,i):t;r?a.includes(e)||a.push(e):(r=e,a.push(e))}}}({targetElement:n,attributes:i});const o={value:r};return a.length&&(o.values=a),o}function Ap({tournamentRecord:t,participantFilters:e,participants:n}){var i,r;let{eventIds:a}=e;const{accessorValues:o,drawEntryStatuses:s,positionedParticipants:c,eventEntryStatuses:u,participantRoles:d,participantRoleResponsibilities:l,participantTypes:p,participantIds:m,signInStatus:f,enableOrFiltering:h}=e,I=Mp(a)&&(null===(i=t.events)||void 0===i?void 0:i.filter((t=>a.includes(t.eventId))))||t.events||[],v=s&&function({drawEntryStatuses:t,tournamentEvents:e}){const n=({entryStatus:e})=>!Array.isArray(t)||t.includes(e);return X(e.reduce(((t,e)=>{var i,r;const{flightProfile:a}=ol({event:e}),o=(null==a||null===(i=a.flights)||void 0===i?void 0:i.map((({drawEntries:t})=>Array.isArray(t)?t.filter(n).map(Fc):[])).flat())||[],s=(null===(r=e.drawDefinitions)||void 0===r?void 0:r.map((({entries:t})=>t?t.filter(n).map(Fc):[])))||[];return t.concat(...o,...s)}),[]))}({drawEntryStatuses:s,tournamentEvents:I}),g=u&&function({eventEntryStatuses:t,tournamentEvents:e}){return X(e.reduce(((e,n)=>{const i=(n.entries||[]).filter((({entryStatus:e})=>!Array.isArray(t)||t.includes(e))).map(Fc);return e.concat(...i)}),[]))}({eventEntryStatuses:u,tournamentEvents:I}),y=[!0,!1].includes(c)&&I.reduce(((t,e)=>t.concat(...(e.drawDefinitions||[]).map((t=>function({drawDefinition:t}){return t?(t.structures||[]).map((t=>{const{positionAssignments:e}=Cu({structure:t});return Lc(e)})).flat():{error:Ut}}({drawDefinition:t}))).filter(Boolean))),[]),U=t=>o.reduce(((e,n)=>{const{accessor:i,value:r}=n,{values:a}=Tp({element:t,accessor:i});return e&&(null==a?void 0:a.includes(r))}),!0);if(n=null===(r=n)||void 0===r?void 0:r.filter((t=>{const e=rc({element:t,itemType:vp}),{participantId:n,participantType:i,participantRole:r,participantRoleResponsibilities:a}=t;return h?c&&y.includes(n)||!1===c&&!y.includes(n)||v&&v.includes(n)||g&&g.includes(n)||m&&m.includes(n)||f&&e===f||p&&Mp(p)&&p.includes(i)||d&&Mp(d)&&d.includes(r)||l&&Mp(a)&&Mp(l)&&l.find((t=>a.includes(t)))||(null==o?void 0:o.length)&&Mp(o)&&U(t):(void 0===c||c&&y.includes(n)||!1===c&&!y.includes(n))&&(!v||v.includes(n))&&(!g||g.includes(n))&&(!m||m.includes(n))&&(!f||e===f)&&(!p||Mp(p)&&p.includes(i))&&(!d||Mp(d)&&d.includes(r))&&(!l||Mp(a)&&Mp(l)&&l.find((t=>a.includes(t))))&&(!(null!=o&&o.length)||Mp(o)&&U(t))})),I.length&&a){var w;const e=I.filter((t=>a.includes(t.eventId))).map((e=>{const n=(e.entries||[]).map((t=>t.participantId));if(e.eventType===Ma)return n;const i=(t.participants||[]).filter((t=>n.includes(t.participantId))).map((t=>t.individualParticipantIds)).flat(1);return n.concat(...i)})).flat(1);n=null===(w=n)||void 0===w?void 0:w.filter((t=>e.includes(t.participantId)))}return n}function Mp(t){return t&&Array.isArray(t)&&t.length}function bp({participantFilters:t={},convertExtensions:e,policyDefinitions:n,withScheduleItems:i,tournamentRecord:r,scheduleAnalysis:a,withStatistics:o,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l,inContext:p}){if(!r)return{error:It};if(!r.participants)return{error:$e};let m=r.participants.map((t=>Hi(t,e)));if("object"!=typeof t)return{error:Bn,participantFilters:t};var f;p&&(null===(f=m)||void 0===f||f.forEach((t=>{[ka,Fa,ja].includes(t.participantType)&&(t.individualParticipants=t.individualParticipantIds.map((t=>Hi(r.participants.find((e=>e.participantId===t)),e,!0))))})));t&&(m=Ap({tournamentRecord:r,participantFilters:t,participants:m}));let h;if(d||l||u||s||c||o||a||i||p){const e=Pp({tournamentEvents:r.events,tournamentParticipants:m,participantFilters:t,withScheduleItems:i,tournamentRecord:r,scheduleAnalysis:a,withStatistics:o,withGroupings:s,withOpponents:c,withMatchUps:u,withEvents:d,withDraws:l});h=null==e?void 0:e.participantIdsWithConflicts}const I=null==n?void 0:n.participant;return null!=I&&I.participant&&(m=m.map((t=>Z({source:t,template:I.participant})))),{tournamentParticipants:m,participantIdsWithConflicts:h}}function Ep(t,e,n){if(!t&&e)return e;if(t&&!e)return t;if("object"!=typeof t||"object"!=typeof e)return t;return X(Object.keys(t).concat(Object.keys(e))).reduce(((i,r)=>{if(e[r])if(t[r])if(typeof t[r]!=typeof e[r])i[r]=e[r];else if(Array.isArray(t[r]))if(!0===n||Array.isArray(n)&&n.includes(r)){const n=X(t[r].map((t=>JSON.stringify(t))).concat(e[r].map((t=>JSON.stringify(t))))).map((t=>JSON.parse(t)));i[r]=n}else i[r]=e[r];else"object"==typeof t[r]?i[r]=Ep(t[r],e[r],n):i[r]=e[r];else i[r]=e[r];else i[r]=t[r];return i}),{})}function Cp(t){return{tournamentIds:Object.keys(t).filter(Boolean)}}const Rp=({penaltyId:t=zi()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t});function Op({tournamentRecord:t,participantIds:e,penaltyCode:n,penaltyType:i,penaltyId:r,matchUpId:a,notes:o,extensions:s,issuedAt:c,refereeParticipantId:u}){if(!t)return{error:It};if(!e)return{error:Je};if(!i)return{error:In};const d=((null==t?void 0:t.participants)||[]).filter((t=>e.includes(t.participantId)));if(!d.length)return{error:Ze};const l=(new Date).toISOString(),p=Object.assign(Rp({penaltyId:r}),{refereeParticipantId:u,penaltyCode:n,penaltyType:i,matchUpId:a,notes:o,issuedAt:c,createdAt:l});return Array.isArray(s)&&s.forEach((t=>zc({element:p,extension:t}))),d.forEach((t=>{t.penalties||(t.penalties=[]),t.penalties.push(p)})),ri({topic:wc,payload:{participants:d}}),{...pt,penaltyId:p.penaltyId}}function xp({tournamentRecord:t,penaltyId:e}){if(!t)return{error:It};if(!e)return{error:vn};const n=(null==t?void 0:t.participants)||[],i=[];let r,a=!1;return n.forEach((t=>{let n=!1;t.penalties=(t.penalties||[]).filter((o=>(o.penaltyId===e&&(n=!0,a||(r=o,a=!0)),n&&i.push(t),o.penaltyId!==e)))})),r&&ri({topic:wc,payload:{participants:i}}),r?{...pt,penalty:r}:{error:gn}}function Lp({tournamentRecord:t}){if(!t)return{error:It};const e=((null==t?void 0:t.participants)||[]).reduce(((t,e)=>{const{participantId:n}=e;return(e.penalties||[]).forEach((e=>{const{penaltyId:i}=e||{};t[i]?t[i].participants.push(n):t[i]={...e,participantIds:[n]}})),t}),{});return{penalties:Object.values(e)}}function Fp({tournamentRecord:t,penaltyId:e,modifications:n}){if(!t)return{error:It};if(!n)return{error:_n,modifications:n};if(!e)return{error:vn};const i=(null==t?void 0:t.participants)||[],r=Object.keys(Rp()).filter((t=>"penaltyId"!==t)),a=Object.keys(n).filter((t=>r.includes(t)));if(!a.length)return{error:Hn};let o;const s=[];return i.forEach((t=>{let i=!1;t.penalties=(t.penalties||[]).map((t=>(t.penaltyId===e&&(i=!0,a.forEach((e=>Object.assign(t,{[e]:n[e]}))),o||(o=t)),t))),i&&s.push(t)})),o&&ri({topic:wc,payload:{participants:s}}),o?{...pt,penalty:o}:{error:gn}}const kp={addExtension:xd,findExtension:Ld,removeExtension:Fd,addEventExtension:function({tournamentRecords:t,eventId:e,extension:n}){if("string"!=typeof e)return{error:Yt};if(!Kc(n))return{error:_n};for(const i of Object.values(t)){const{event:t}=wa({tournamentRecord:i,eventId:e});if(t)return Zc({event:t,extension:n})}return{error:$t}},linkTournaments:function({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const{tournamentIds:e,error:n}=Cp(t);if(n)return{error:n};if((null==e?void 0:e.length)>1){return xd({tournamentRecords:t,extension:{name:qr,value:{tournamentIds:e}}})}return pt},unlinkTournament:function({tournamentRecords:t,tournamentId:e}){if("object"!=typeof t)return{error:_n};if(!e)return{error:gt};const{tournamentIds:n,error:i}=Cp(t);if(i)return{error:i};if(!n.includes(e))return{error:gt};let r;return n.every((n=>{var i;const a=t[n],{extension:o}=sa({tournamentRecord:a,name:qr});if(!o)return!0;let s=(null==o||null===(i=o.value)||void 0===i?void 0:i.tournamentIds)||[];if(null==s||!s.length||1===s.length&&s.includes(e)||n===e){const t=Qc({tournamentRecord:a,name:qr});return t.error&&(r=t.error),t.success}const c=s.filter((t=>t!==e));o.value={tournamentIds:c};const u=$c({tournamentRecord:a,extension:o});return u.error&&(r=u.error),u.success})),r?{error:r}:{...pt}},unlinkTournaments:function({tournamentRecords:t}){return"object"==typeof t&&Object.keys(t).length?Fd({tournamentRecords:t,name:qr}):{error:ht}},getLinkedTournamentIds:function({tournamentRecords:t}){return"object"==typeof t&&Object.keys(t).length?{linkedTournamentIds:Object.assign({},...Object.keys(t).map((e=>{var n;const i=t[e],r=null==i?void 0:i.tournamentId,{extension:a}=sa({tournamentRecord:i,name:qr});return{[e]:((null==a||null===(n=a.value)||void 0===n?void 0:n.tournamentIds)||[]).filter((t=>t!==r))}})))}:{error:ht}},addDrawDefinition:function({tournamentRecords:t,drawDefinition:e,tournamentId:n,eventId:i,flight:r,existingDrawCount:a}){if(!i)return{error:Yt};if(!(n=n||Nd({tournamentRecords:t,eventId:i})))return{error:gt};const o=t[n];if(!o)return{error:It};const{event:s,error:c}=wa({tournamentRecord:o,eventId:i});return c?{error:c}:dp({drawDefinition:e,event:s,flight:r,existingDrawCount:a})},getCompetitionParticipants:function(t){const{tournamentRecords:e}=t||{};if("object"!=typeof e||!Object.keys(e).length)return{error:ht};let n=[];const i=[],r=[];for(const a of Object.values(e)){const{tournamentParticipants:e,participantIdsWithConflicts:o}=bp({tournamentRecord:a,...t});for(const t of e){const{participantId:e}=t;i.includes(e)?n=n.map((n=>n.participantId!==e?n:Ep(n,t,!0))):(i.push(e),n.push(t))}o&&o.forEach((t=>{r.includes(t)||r.push(t)}))}return{competitionParticipants:n,participantIdsWithConflicts:r}},addParticipant:function({tournamentRecords:t,pairOverride:e,tournamentId:n,participant:i}){if("string"!=typeof n)return{error:gt};const r=t[n];return r?pp({tournamentRecord:r,participant:i,pairOverride:e}):{error:It}},setMatchUpStatus:function(t){const e=t.tournamentRecords,n=t.tournamentId||Nd(t);if("string"!=typeof n)return{error:gt};const i=e[n];if(!i)return{error:It};const{drawDefinition:r,event:a}=wa({eventId:t.eventId,drawId:t.drawId,tournamentRecord:i});return $l({tournamentRecord:i,...t,drawDefinition:r,event:a})},bulkMatchUpStatusUpdate:function(t){const{tournamentRecords:e,outcomes:n}=t;if(!Array.isArray(n))return{error:Ee};const i=n.reduce(((t,e)=>t.includes(e.tournamentId)?t:t.concat(e.tournamentId)),[]);for(const r of i){const t=e[r];if(!t)return{error:It};const i=n.filter((t=>t.tournamentId===r));if(i.length){const e=Jl({tournamentRecord:t,outcomes:i});if(e.error)return e}}return{...pt}},bulkScheduleMatchUps:function({tournamentRecords:t,matchUpContextIds:e,schedule:n}){if(!t)return{error:ht};if(!Array.isArray(e))return{error:_n};for(const i of Object.values(t)){const{tournamentId:t}=i,r=e.filter((e=>e.tournamentId===t)).map(jc);if(null!=r&&r.length){const t=wd({tournamentRecord:i,matchUpIds:r,schedule:n});if(t.error)return t}}return pt},addVenue:function({tournamentRecords:t,venue:e,disableNotice:n}){if("object"!=typeof e)return{error:_n};e.venueId||(e.venueId=zi());for(const i of Object.values(t)){const t=lp({tournamentRecord:i,returnDetails:!0,disableNotice:!0,venue:e});if(null!=t&&t.error)return t}return n||ri({topic:mc,payload:{venue:e}}),pt},deleteVenue:function({tournamentRecords:t,venueId:e,force:n}){if(!t)return{error:ht};if("string"!=typeof e)return{error:Dn};let i;for(const r of Object.values(t)){const t=up({tournamentRecord:r,venueId:e,force:n});if(t.error&&t.error!==Nn)return t;i=!0}return Gd({tournamentRecords:t}),i?pt:{error:Nn}},modifyVenue:function({tournamentRecords:t,modifications:e,venueId:n,force:i}){if(!t)return{error:ht};if("string"!=typeof n)return{error:Dn};let r,a;for(const o of Object.values(t)){const t=sp({tournamentRecord:o,modifications:e,venueId:n,force:i});if(t.success&&(a=!0),t.error&&(r=t.error),t.error&&t.error!==Nn)return t}return Gd({tournamentRecords:t}),a?{...pt}:{error:r}},addCourts:function(t){const{tournamentRecords:e,venueId:n}=t;if("string"!=typeof n||!n)return{error:Dn};let i;for(const r of Object.values(e)){const{venue:e}=Vu({tournamentRecord:r,venueId:n});if(e){const e=op({tournamentRecord:r,...t});if(e.error)return e;i=!0}}return i?pt:{error:Nn}},addPenalty:function(t){const{tournamentRecords:e,participantIds:n}=t;let i;for(const r of Object.values(e)){const{tournamentParticipants:e}=bp({tournamentRecord:r}),a=Lc(e).filter((t=>n.includes(t)));if(a.length){i=Op({...t,penaltyId:t.penaltyId||i,tournamentRecord:r,participantIds:a}).penaltyId}}return i?{...pt,penaltyId:i}:{error:Ze}},removePenalty:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:ht};for(const n of Object.values(e)){const e=xp({tournamentRecord:n,...t});if(e.error&&e.error!==gn)return e}return{...pt}},modifyPenalty:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:ht};for(const n of Object.values(e)){const e=Fp({tournamentRecord:n,...t});if(e.error&&e.error!==gn)return e}return{...pt}},getCompetitionPenalties:function({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const e=[];for(const n of Object.values(t)){const{penalties:t}=Lp({tournamentRecord:n});e.push(...t)}return{penalties:e}},findParticipant:function({tournamentRecords:t,participantId:e,personId:n,policyDefinitions:i,inContext:r}){if(!t)return{error:ht};if("string"!=typeof e&&"string"!=typeof n)return{error:Ee};let a;for(const o of Object.values(t)){const{tournamentParticipants:t}=bp({tournamentRecord:o,policyDefinitions:i,inContext:r});if(a=ra({tournamentParticipants:t,participantId:e,personId:n,policyDefinitions:i}),a)break}return{participant:Hi(a,!1,!0)}}};function jp(){const{topics:t}=si();for(const e of t){const t=ai({topic:e});t&&ci({topic:e,notices:t})}}function Bp({tournamentRecord:t,matchUpFormat:e,event:n}){if(!t)return{error:It};if(!v(e))return{error:ae};const{extension:i}=ca({event:n,name:$r}),r=null==i?void 0:i.value,{extension:a}=sa({tournamentRecord:t,name:$r}),o=null==a?void 0:a.value;return{matchUpFormat:e,averageTimes:[(null==r?void 0:r.matchUpAverageTimes)&&Fr({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpAverageTimes)&&Fr({...o,matchUpFormat:e})].find((t=>t)),recoveryTimes:[(null==r?void 0:r.matchUpRecoveryTimes)&&kr({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpRecoveryTimes)&&kr({...o,matchUpFormat:e})].find((t=>t))}}function _p({tournamentRecord:t,matchUpFormat:e,averageTimes:n,recoveryTimes:i,event:r}){if(!t)return{error:It};if(n&&!Array.isArray(n))return{error:_n};if(i&&!Array.isArray(i))return{error:_n};const a=$r;if(r){const{extension:t}=ca({event:r,name:a});Zc({event:r,extension:{name:a,value:Gp({...(null==t?void 0:t.value)||{},matchUpFormat:e,averageTimes:n,recoveryTimes:i})}})}else{const{extension:r}=sa({tournamentRecord:t,name:a});$c({tournamentRecord:t,extension:{name:a,value:Gp({...(null==r?void 0:r.value)||{},matchUpFormat:e,averageTimes:n,recoveryTimes:i})}})}return pt}function Gp({matchUpAverageTimes:t=[],matchUpRecoveryTimes:e=[],averageTimes:n,recoveryTimes:i,matchUpFormat:r}){var a,o;const s=(null===(a=n=(n||[]).filter((t=>{var e,n;return(null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length)||(null==t||null===(n=t.categoryTypes)||void 0===n?void 0:n.length)})))||void 0===a?void 0:a.length)&&t.map((t=>{var e;return null!=t&&t.matchUpFormatCodes.includes(r)?{...t,matchUpFormatCodes:null===(e=t.matchUpFormatCodes)||void 0===e?void 0:e.filter((t=>t!==r))}:t})).filter((({matchUpFormatCodes:t})=>null==t?void 0:t.length)).concat({matchUpFormatCodes:[r],averageTimes:n}),c=(null===(o=i=(i||[]).filter((t=>{var e,n;return(null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length)||(null==t||null===(n=t.categoryTypes)||void 0===n?void 0:n.length)})))||void 0===o?void 0:o.length)&&e.map((t=>{var e;return null!=t&&t.matchUpFormatCodes.includes(r)?{...t,matchUpFormatCodes:null===(e=t.matchUpFormatCodes)||void 0===e?void 0:e.filter((t=>t!==r))}:t})).filter((({matchUpFormatCodes:t,averageTimes:e})=>(null==t?void 0:t.length)||e)).concat({matchUpFormatCodes:[r],recoveryTimes:i});return{matchUpAverageTimes:(null==s?void 0:s.length)&&s||t,matchUpRecoveryTimes:(null==c?void 0:c.length)&&c||e}}function Vp({tournamentRecord:t,event:e,categoryType:n,matchUpFormat:i,averageMinutes:r,recoveryMinutes:a}){if(!t)return{error:It};if(!v(i))return{error:_n};if(!e)return{error:Yt};const{averageTimes:o=[],recoveryTimes:s=[]}=Bp({tournamentRecord:t,matchUpFormat:i,event:e}),c=e.category,u=(null==c?void 0:c.categoryName)||(null==c?void 0:c.ageCategoryCode),d="DOUBLES"===e.eventType;let l={categoryNames:[u],minutes:{}},p={categoryNames:[u],minutes:{}};const m=t=>{var e,i;if(null!==(e=t.categoryTypes)&&void 0!==e&&e.includes(n)&&console.log("encountered:",{categoryType:n}),null===(i=t.categoryNames)||void 0===i||!i.includes(u)||(t.categoryNames=t.categoryNames.filter((t=>t!==u)),l={minutes:t.minutes,categoryNames:[u]},t.categoryNames.length))return t},f=!isNaN(parseInt(r)),h=!isNaN(parseInt(a)),I=o.map(m).filter((t=>{var e;return null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length})),g=s.map(m).filter((t=>{var e;return null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length}));return f&&(Object.assign(l.minutes,{[d?ba:la]:r}),I.push(l)),h&&(Object.assign(p.minutes,{[d?ba:la]:a}),g.push(p)),f||h?_p({tournamentRecord:t,event:e,matchUpFormat:i,averageTimes:f&&I,recoveryTimes:h&&g}):{error:_n}}function Hp({tournamentRecords:t,extensionName:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const n=[];let i;for(const r of Object.values(t)){const{extension:t}=sa({tournamentRecord:r,name:e});t&&!i&&(n.push({method:"addExtension",params:{extension:t}}),i=!0);const a=r.events||[];for(const i of a){const{eventId:t}=i,{extension:r}=ca({event:i,name:e});r&&n.push({method:"addEventExtension",params:{eventId:t,extension:r}})}}return{methods:n}}function Wp({tournamentRecord:t,matchUpFormats:e,categoryType:n,event:i}){if(!t)return{error:It};if(!i)return{error:Yt};let r=[];if(null!=e&&e.length){const t=[];r=e.map((e=>{let n="string"==typeof e?{matchUpFormat:e}:e;if(!t.includes(null==n?void 0:n.matchUpFormat)&&v(null==n?void 0:n.matchUpFormat))return t.push(n.matchUpFormat),n})).filter(Boolean)}else{const{policy:e}=ia({policyType:ur,tournamentRecord:t,event:i});if(null!=e&&e.matchUpFormats)r=null==e?void 0:e.matchUpFormats;else{const{extension:t}=ca({event:i,name:$r});if(null==t||!t.value)return{error:Ae};r=X([...(t.value.matchUpAverageTimes||[]).map((t=>t.matchUpFormatCodes)),...(t.value.matchUpRecoveryTimes||[]).map((t=>t.matchUpFormatCodes))].flat()).map((t=>({matchUpFormat:t})))}}const{eventType:a,eventId:o,category:s}=i,c=null==s?void 0:s.categoryName;if(!o)return{error:Yt};return{eventMatchUpFormatTiming:r.map((({matchUpFormat:e,description:r})=>{const o=ya({tournamentRecord:t,matchUpFormat:e,categoryName:c,categoryType:n,eventType:a,event:i});return Object.assign({},{...o,description:r,matchUpFormat:e})}))}}function qp({tournamentRecord:t,drawDefinition:e,structureId:n,matchUpId:i,drawId:r,event:a}){var o,s,c;if(!t)return{error:It};if(!(r||a||n||i))return{error:Ee};const u=Ud({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r,event:a});if(i&&null!=u&&u.error)return u;!e&&null!=u&&u.drawDefinition&&(e=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&n&&!i){if(!e)return{error:xt};const t=Wc({drawDefinition:e,structureId:n});if(t.error)return t;d=t.structure}const l=null===(o=d)||void 0===o?void 0:o.matchUpFormat,p=null===(s=e)||void 0===s?void 0:s.matchUpFormat,m=null==a?void 0:a.matchUpFormat;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:m,drawDefaultMatchUpFormat:p,matchUpFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.matchUpFormat)||l||p||m}}function Kp({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:n,tournamentId:i,matchUpFormat:r,categoryName:a,categoryType:o,eventType:s,eventId:c}){var u,d,l,p;if(!v(r))return{error:ae};let m;return Object.keys(n).filter((t=>!i||t===i)).find((t=>{var e,i,u;const d=n[t],l=c&&(null===(e=wa({tournamentRecord:d,eventId:c}))||void 0===e?void 0:e.event);m=ya({tournamentRecord:d,event:l,matchUpFormat:r,categoryName:a,categoryType:o,eventType:s});return(null===(i=m)||void 0===i?void 0:i.averageMinutes)||(null===(u=m)||void 0===u?void 0:u.recoveryMinutes)})),{averageMinutes:(null===(u=m)||void 0===u?void 0:u.averageMinutes)||e,recoveryMinutes:(null===(d=m)||void 0===d?void 0:d.recoveryMinutes)||t,typeChangeRecoveryMinutes:(null===(l=m)||void 0===l?void 0:l.typeChangeRecoveryMinutes)||(null===(p=m)||void 0===p?void 0:p.recoveryMinutes)||t}}function zp({tournamentRecords:t,containedStructureIds:e,periodLength:n=30,matchUps:i,rounds:r}){if("object"!=typeof t)return{error:ht};if(!Array.isArray(r))return{error:Ee};const a=[],o=r.sort(((t,e)=>(t.sortOrder||0)-(e.sortOrder||0)));e=e||Object.assign({},...Object.values(t).map((t=>Dl({tournamentRecord:t}).containedStructures))),i||({matchUps:i}=Hd({tournamentRecords:t,nextMatchUps:!0}));const s={},c={},u={};let d=0;return{scheduledRoundsDetails:o.map((r=>{var o,l,p;const m=r.periodLength||n,f=e[r.structureId]||[r.structureId],h={tournamentIds:[r.tournamentId],roundNumbers:[r.roundNumber],matchUpIds:r.matchUpIds,eventIds:[r.eventId],drawIds:[r.drawId],structureIds:f};let I=Fu({matchUps:i,processContext:!0,...h}).sort(Kd);const{segmentNumber:v,segmentsCount:g}=r.roundSegment||{};if(J(v)&&q(null===(o=I)||void 0===o?void 0:o.length)&&q(g)&&v>0&&v<=g&&g<(null===(l=I)||void 0===l?void 0:l.length)&&(null===(p=r.matchUpIds)||void 0===p||!p.length)){const t=I.length/g,e=t*(v-1);I=I.slice(e,e+t)}const y=t[r.tournamentId],{drawDefinition:U,event:w}=wa({drawId:r.drawId,tournamentRecord:y}),{matchUpFormat:N}=qp({structureId:r.structureId,tournamentRecord:y,drawDefinition:U,event:w}),{eventType:D,category:P}=w||{},{categoryName:T,ageCategoryCode:A}=P||{},{typeChangeRecoveryMinutes:M,recoveryMinutes:b,averageMinutes:E,error:C}=Kp({tournamentRecords:t,categoryName:T||A,tournamentId:r.tournamentId,eventId:r.eventId,matchUpFormat:N,eventType:D});if(C)return{error:C,round:r};const R=I.filter((({matchUpStatus:t})=>!B.includes(t)&&t!==S)).map(jc);R.forEach((t=>{s[t]={typeChangeRecoveryMinutes:M,recoveryMinutes:b,averageMinutes:E},c[t]=b,u[t]=E})),a.push(...R),d=Math.max(E||0,d);return{roundPeriodLength:m,recoveryMinutes:b,averageMinutes:E,matchUpIds:R,hash:`${E}|${m}`}})),greatestAverageMinutes:d,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:a,minutesMap:s,...pt}}function Yp({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=60,averageMatchUpMinutes:n=90,remainingScheduleTimes:i,clearScheduleDates:r,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,endTime:d}){if("object"!=typeof o||!Object.keys(o).length)return{error:ht};const{courts:l,venues:p}=Rd({tournamentRecords:o}),m=l.filter((t=>!u||u.includes(t.venueId)));c||(c=m.reduce(((t,e)=>{var n;const i=null===(n=e.dateAvailability)||void 0===n?void 0:n.find((t=>!t.date||Gi(s,t.date))),r=(null==i?void 0:i.startTime)||e.startTime;return r&&(!t||Ei(r)<Ei(t))?r:t}),void 0)),d||(d=m.reduce(((t,e)=>{var n;const i=null===(n=e.dateAvailability)||void 0===n?void 0:n.find((t=>!t.date||Gi(s,t.date))),r=(null==i?void 0:i.endTime)||e.endTime;return r&&(!t||Ei(r)>Ei(t))?r:t}),void 0));const f=Object.assign({},...Object.values(o).map((t=>(t.events||[]).map((e=>{const{scheduleTiming:n}=da({tournamentRecord:t,event:e});return{[e.eventId]:{event:e,scheduleTiming:n}}})))).flat()),h=Wd({tournamentRecords:o,sortDateMatchUps:!1,matchUpFilters:{scheduledDate:s,venueIds:u}}),I=[].concat(...h.dateMatchUps||[],...h.completedMatchUps||[]),v={averageTimes:[{minutes:{default:n}}],recoveryTimes:[{minutes:{default:e}}]},g=null==I?void 0:I.map((({eventId:t,schedule:e,matchUpFormat:n})=>{const{event:i,scheduleTiming:r}=f[t],o=null==i?void 0:i.eventType,s={...r,defaultTiming:v,matchUpFormat:n},{averageMinutes:c,recoveryMinutes:u}=Ua({eventType:o,timingDetails:s}),{courtId:d,venueId:l}=e,p=Ri(e.scheduledTime),m=ji(p,c);return{averageMinutes:c,recoveryMinutes:u,periodLength:a,startTime:p,endTime:m,courtId:d,venueId:l}})),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:i,averageMatchUpMinutes:n,date:s,clearScheduleDates:r,periodLength:a,startTime:c,endTime:d,bookings:g,courts:m},{scheduleTimes:U}=ec(y);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==p?void 0:p.length)?p[0].venueId:void 0,scheduleTimes:U,dateScheduledMatchUpIds:I.map(jc)}}function $p({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function Jp({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:n,value:i}){const{matchUpType:r}=n,{individualParticipantIds:a}=Ad(n),o=(t[n.matchUpId]||[]).filter((t=>!ut(t,a))).flat();[...a,...o].forEach((t=>{if($p({individualParticipantProfiles:e,participantId:t}),!e[t].potentialCounted[n.drawId]){const a=e[t].counters;a[r]?a[r]+=i:i>0&&(a[r]=i),a[ha]?a[ha]+=i:i>0&&(a[ha]=i),o.includes(t)&&(e[t].potentialCounted[n.drawId]=!0)}}))}function Zp({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:n,matchUp:i}){var r;const a=((null==e||null===(r=e[i.matchUpId])||void 0===r?void 0:r.matchUpIds)||[]).filter((t=>n.includes(t))).filter((e=>!t[e]));return{dependenciesScheduled:!(null!=a&&a.length),remainingDependencies:a}}function Qp({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:n,matchUp:i}){var r,a,o,s;const{individualParticipantIds:c}=Ad(i);n=n||(null===(r=i.schedule)||void 0===r?void 0:r.timeAfterRecovery);const u=e=>{t[e]||(t[e]=[]),t[e]=X(t[e].concat(...c))},d=t=>{(!e[t]||n>e[t])&&(e[t]=n)},l=(null===(a=i.winnerTo)||void 0===a?void 0:a.matchUpId)||i.winnerMatchUpId;l&&(n&&d(l),u(l));const p=(null===(o=i.loserTo)||void 0===o?void 0:o.matchUpId)||i.loserMatchUpId;p&&(n&&d(p),u(p)),null!==(s=i.sidesTo)&&void 0!==s&&s.length&&i.sidesTo.forEach((({matchUpId:t})=>{t&&(n&&d(t),u(t))}))}function Xp({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:n,matchUpDependencies:i,averageMatchUpMinutes:r=0,typeChangeRecoveryMinutes:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){var u,d;const l=Ri(null==c||null===(u=c.schedule)||void 0===u?void 0:u.endTime),p=l?ji(l,parseInt(o)):ji(s,parseInt(r)+parseInt(o)),m=a&&(l?ji(Ri(l),a):ji(s,parseInt(r)+parseInt(a))),f=(null==i||null===(d=i[c.matchUpId])||void 0===d?void 0:d.participantIds)||[],h=(c.roundPosition&&e[c.matchUpId]||[]).flat();f.forEach((e=>{$p({individualParticipantProfiles:t,participantId:e});const n=t[e].priorMatchUpType!==c.matchUpType&&m||p;h.includes(e)?function({individualParticipantProfiles:t,recoveryValue:e,participantId:n,scheduleTime:i,drawId:r}){t[n].potentialRecovery[r]||(t[n].potentialRecovery[r]=[]),t[n].potentialRecovery[r].push(e),t[n].potentialBookings[r]||(t[n].potentialBookings[r]=[]),t[n].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:i})}({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:n,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=n,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:n}))})),Qp({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:n,timeAfterRecovery:p,matchUp:c})}function tm({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:n,matchUpId:i,details:r}){var a,o,s,c,u;let d;const l=null===(a=r.minutesMap)||void 0===a||null===(o=a[i])||void 0===o?void 0:o.recoveryMinutes,p=ji(n,((null===(s=r.minutesMap)||void 0===s||null===(c=s[i])||void 0===c?void 0:c.averageMinutes)||0)+(l||0)),m=(null==e||null===(u=e[i])||void 0===u?void 0:u.dependentMatchUpIds)||[];if(m.length){const e=m.reduce(((e,n)=>{const i=t[n];if(!i)return e;const r={scheduleTime:i,matchUpId:n};return i&&!e.matchUpId||Ei(i)<Ei(e.scheduleTime)?r:e}),{});e.scheduleTime&&Ei(p)>Ei(e.scheduleTime)&&(d=e)}return{scheduledDependent:d}}const em="DO_NOT_SCHEDULE",nm={DO_NOT_SCHEDULE:em};function im({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:n=!0,personRequests:i,scheduleTime:r,scheduleDate:a,matchUp:o}){const s=function(t){const{sides:e,matchUpType:n}=t||{};return(e||[]).map((t=>{var e;return n===pa?(null==t||null===(e=t.participant)||void 0===e?void 0:e.individualParticipants)||[]:null!=t&&t.participant?[t.participant]:[]})).flat()}(o).map((({person:t})=>null==t?void 0:t.personId));if(n){const t=((null==o?void 0:o.potentialParticipants)||[]).flat().map((({person:t})=>null==t?void 0:t.personId));s.push(...t)}const c=s.map((t=>{var e;return null===(e=i[t])||void 0===e?void 0:e.map((e=>({...e,personId:t})))})).filter(Boolean).flat().filter((t=>t.requestType===em&&Gi(a,t.date))),u=[],d=null==o?void 0:o.matchUpId,l=Fi(Ri(r),Oi(a)),p=Ri(Bi(l,t).toISOString());for(const m of c){const{requestId:t,startTime:n,endTime:i}=m;(r>n&&r<i||p>n&&p<i)&&(u.push({matchUpId:d,request:m,scheduleTime:r}),e[t]?(e[t].scheduleTimes.includes(r)||e[t].scheduleTimes.push(r),e[t].matchUpIds.includes(d)||e[t].matchUpIds.push(d)):e[t]={request:m,scheduleTimes:[r],matchUpIds:[d]})}return{conflicts:u}}function rm({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:n,scheduleTime:i,matchUp:r,details:a}){var o,s,c,u,d;const l=((null==n||null===(o=n[r.matchUpId])||void 0===o?void 0:o.participantIds)||[]).flat(),p=(null==a||null===(s=a.minutesMap)||void 0===s||null===(c=s[r.matchUpId])||void 0===c?void 0:c.averageMinutes)||0,m=(null==a||null===(u=a.minutesMap)||void 0===u||null===(d=u[r.matchUpId])||void 0===d?void 0:d.recoveryMinutes)||0,f=l.every((e=>{var n;$p({individualParticipantProfiles:t,participantId:e});let a=t[e];if(!a.timeAfterRecovery)return!0;const o=Ri(null==r||null===(n=r.schedule)||void 0===n?void 0:n.endTime),s=o?ji(o,parseInt(m)):ji(i,parseInt(p)+parseInt(m));return!!![...Object.keys(a.potentialBookings).filter((t=>t!==r.drawId)).map((t=>a.potentialBookings[t])).flat(),...a.bookings].find((t=>function(t,e){const n=Ei(t.scheduleTime),i=Ei(t.timeAfterRecovery),r=Ei(e.scheduleTime),a=Ei(e.timeAfterRecovery),o=n>r&&n<a,s=r>n&&r<i,c=i>r&&i<a,u=a>n&&a<i;return Wi({hasOverlap:n===r||i===a||o||c||s||u,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:i,timeAfterRecovery:s},t).hasOverlap))})),h=e[r.matchUpId],I=h?ki(Fi(h),Fi(i),!1):0;return{enoughTime:f&&I>=0}}function am({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:n}){let i,r,a,o,s=[],c=[];for(const u of t)i||(i=u.hash),(u.hash===i||n)&&(s=s.concat(u.matchUpIds)),u.hash===i||n||(i=u.hash,c.push({averageMinutes:r,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),s=u.matchUpIds),r=n?e:u.averageMinutes,a=u.recoveryMinutes,o=u.roundPeriodLength;return s.length&&c.push({averageMinutes:r,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),{groupedRounds:c}}function om({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:n={},matchUp:i}){const{matchUpId:r,matchUpType:a}=i,{enteredIndividualParticipantIds:o}=Ad(i),s=(i.roundPosition&&e[r]||[]).flat(),c=X(o.concat(...s));c.forEach((e=>{$p({individualParticipantProfiles:t,participantId:e})}));return{participantIdsAtLimit:c.filter((e=>{const i=t[e];if(i){return[a,ha].find((t=>{const e=i.counters&&i.counters[t]||0,r=n[t]||0;return e&&r&&e>=r}))}})),relevantParticipantIds:c}}function sm({tournamentRecords:t,requestType:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const n={};for(const i of Object.values(t)){const{extension:t}=sa({tournamentRecord:i,name:zr}),r=(null==t?void 0:t.value)||[];for(const i of r){const{personId:t,requests:r}=i||{};n[t]||(n[t]=[]);for(const i of r)e&&i.requestType!==e||n[t].push(i)}}return{personRequests:n}}function cm({tournamentRecords:t,personRequests:e}){if(!t)return{error:ht};for(const n of Object.values(t)){const{participants:t}=n,i=[];for(const n of Object.keys(e))if(ra({tournamentParticipants:t,personId:n})){const t=e[n];t.length&&i.push({personId:n,requests:t})}if(Object.keys(i).length){$c({tournamentRecord:n,extension:{name:zr,value:i}})}}return pt}function um({personRequests:t,personId:e,requests:n}){t[e]||(t[e]=[]);const i=n.filter((({requestType:t})=>t)).map((t=>{let{date:e,requestType:n,startTime:i,endTime:r}=t;return n===em&&(e=Oi(e),i=Ri(i),r=Ri(r),e&&i&&r)?{date:e,startTime:i,endTime:r,requestType:n}:t})).filter(Boolean);for(const r of i)r.requestId=Q(),t[e].push(r);return{mergeCount:i.length}}function dm({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=B,tournamentRecord:n,scheduledDates:i,venueIds:r=[]}){if("object"!=typeof n)return{error:It};if(!Array.isArray(e)||!Array.isArray(r))return{error:_n};r.length&&t.push("venueId");const{matchUps:a}=fd({matchUpFilters:{scheduledDates:i},tournamentRecord:n});return wd({schedule:{venueId:"",scheduledDate:"",scheduledTime:""},matchUpIds:a.filter((n=>!e.includes(n.matchUpStatus)&&fp({schedule:n.schedule,scheduleAttributes:t})&&(!(null!=r&&r.length)||r.includes(n.schedule.venueId)))).map(jc),tournamentRecord:n})}function lm({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=B,tournamentRecords:n,scheduledDates:i,venueIds:r}){const a="object"==typeof n&&Object.values(n).map((({tournamentId:t})=>t)).filter(Boolean);if(null==a||!a.length)return{error:ht};for(const o of a){const a=dm({ignoreMatchUpStatuses:e,scheduleAttributes:t,tournamentRecord:n[o],scheduledDates:i,venueIds:r});if(a.error)return a}return{...pt}}function pm({tournamentRecord:t}){var e;if(!t)return{error:It};const{policy:n}=ia({policyType:or,tournamentRecord:t}),{extension:i}=sa({tournamentRecord:t,name:Yr}),r=null==i||null===(e=i.value)||void 0===e?void 0:e.dailyLimits,a=null==n?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:r||a}}function mm({tournamentRecords:t,tournamentId:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};let n;return Object.keys(t).filter((t=>!e||t===e)).find((e=>{const i=t[e],{matchUpDailyLimits:r}=pm({tournamentRecord:i});return n=r,!0})),{matchUpDailyLimits:n}}function fm({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,periodLength:n=30,tournamentRecords:i,venueIds:r=[],scheduleDate:a,matchUps:o}){if("object"!=typeof i)return{error:ht};if(!Array.isArray(o))return{error:Ie};const s=Object.assign({},...Object.values(i).map((t=>(t.events||[]).map((e=>{const{scheduleTiming:n}=da({tournamentRecord:t,event:e});return{[e.eventId]:{event:e,scheduleTiming:n}}})))).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},u=null==o?void 0:o.filter((t=>fp(t)&&(!r.length||r.includes(t.schedule.venueId))&&(!a||t.schedule.scheduledDate===a)));return{bookings:null==u?void 0:u.map((({eventId:t,schedule:e,matchUpFormat:i})=>{const{event:r,scheduleTiming:a}=s[t],o=null==r?void 0:r.eventType,u={...a,defaultTiming:c,matchUpFormat:i},{averageMinutes:d,recoveryMinutes:l}=Ua({eventType:o,timingDetails:u}),{courtId:p,venueId:m}=e,f=Ri(e.scheduledTime),h=ji(f,d);return{averageMinutes:d,recoveryMinutes:l,periodLength:n,startTime:f,endTime:h,courtId:p,venueId:m}})).filter(Boolean),relevantMatchUps:u}}function hm({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=60,averageMatchUpMinutes:n=90,remainingScheduleTimes:i,clearScheduleDates:r,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,matchUps:d,endTime:l}){if("object"!=typeof o||!Object.keys(o).length)return{error:ht};const{courts:p,venues:m}=Rd({tournamentRecords:o}),f=p.filter((t=>!u||u.includes(t.venueId)));c||(c=f.reduce(((t,e)=>{var n;const i=null===(n=e.dateAvailability)||void 0===n?void 0:n.find((t=>!t.date||Gi(s,t.date))),r=(null==i?void 0:i.startTime)||e.startTime;return r&&(!t||Ei(r)<Ei(t))?r:t}),void 0)),l||(l=f.reduce(((t,e)=>{var n;const i=null===(n=e.dateAvailability)||void 0===n?void 0:n.find((t=>!t.date||Gi(s,t.date))),r=(null==i?void 0:i.endTime)||e.endTime;return r&&(!t||Ei(r)>Ei(t))?r:t}),void 0));const{bookings:h,relevantMatchUps:I}=fm({defaultRecoveryMinutes:e,averageMatchUpMinutes:n,tournamentRecords:o,scheduleDate:s,periodLength:a,venueIds:u,matchUps:d}),v={calculateStartTimeFromCourts:t,remainingScheduleTimes:i,averageMatchUpMinutes:n,clearScheduleDates:r,date:s,periodLength:a,startTime:c,endTime:l,bookings:h,courts:f},{scheduleTimes:g}=ec(v);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==m?void 0:m.length)?m[0].venueId:void 0,scheduleTimes:g,dateScheduledMatchUpIds:I.map(jc)}}function Im({checkPotentialRequestConflicts:t=!0,clearScheduleDates:e,scheduleDates:n=[],tournamentRecords:i,periodLength:r,dryRun:a}){return function({checkPotentialRequestConflicts:t=!0,clearScheduleDates:e,scheduleDates:n=[],tournamentRecords:i,periodLength:r,dryRun:a}){if(!i)return{error:ht};if(!Array.isArray(n))return{error:_n};const{schedulingProfile:o=[],issues:s=[],modifications:c}=kd({tournamentRecords:i}),u=Object.assign({},...Object.values(i).map((t=>Dl({tournamentRecord:t}).containedStructures))),d=n.map((t=>{if(wi(t))return Oi(t)})).filter(Boolean),l=o.map((t=>t.scheduleDate)).map((t=>wi(t)&&Oi(t))).filter((t=>t&&(!n.length||d.includes(t))));if(!l.length)return{error:Re};if(e&&!a){const t=Array.isArray(e)?e:void 0;lm({tournamentRecords:i,scheduledDates:t})}const{courts:p}=Rd({tournamentRecords:i}),{matchUps:m}=Hd({tournamentRecords:i,nextMatchUps:!0}),{matchUpDependencies:f}=zd({includeParticipantDependencies:!0,tournamentRecords:i,matchUps:m}),{matchUpDailyLimits:h}=mm({tournamentRecords:i}),{personRequests:I}=sm({requestType:em,tournamentRecords:i}),v=o.filter((t=>{const e=Oi(null==t?void 0:t.scheduleDate);return l.includes(e)})).sort(((t,e)=>{new Date(t.scheduleDate).getTime(),new Date(e.scheduleDate).getTime()})),g={},y={},w={},N={},P={},A={},M={},b={},E={},R={};for(const K of v){const n=Oi(null==K?void 0:K.scheduleDate),o=(null==K?void 0:K.venues)||[],s={},c={},d={},l=(t,e)=>{t.forEach((t=>{const n=d[t].counters;n[e]?n[e]+=1:n[e]=1,n[ha]?n[ha]+=1:n[ha]=1}))};w[n]={},N[n]={},g[n]={},y[n]={},M[n]=[],b[n]=[],E[n]=[],R[n]=[];const v={};m.forEach((t=>{var e;null!==(e=t.schedule)&&void 0!==e&&e.scheduledDate&&Gi(n,Oi(t.schedule.scheduledDate))&&Qp({matchUp:t,matchUpNotBeforeTimes:v,matchUpPotentialParticipantIds:s})}));const H=[];for(const t of o){var O;const{rounds:a=[],venueId:o}=t,{scheduledRoundsDetails:l,greatestAverageMinutes:h,orderedMatchUpIds:I,minutesMap:g}=zp({tournamentRecords:i,containedStructureIds:u,periodLength:r,matchUps:m,rounds:a});H.push(...I);const{groupedRounds:y}=am({scheduledRoundsDetails:l,greatestAverageMinutes:h,garmanSinglePass:!0}),{scheduleTimes:w,dateScheduledMatchUpIds:N}=hm({averageMatchUpMinutes:null===(O=y[0])||void 0===O?void 0:O.averageMinutes,scheduleDate:Oi(n),venueIds:[t.venueId],clearScheduleDates:e,tournamentRecords:i,periodLength:r,matchUps:m}),P=Array.isArray(e)?e.includes(n):e,M=P?[]:m.filter((({matchUpId:t})=>N.includes(t)));for(const t of M){var L;Jp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,scheduleDate:n,matchUp:t,value:1});const e=null===(L=t.schedule)||void 0===L?void 0:L.scheduledTime;if(e){var F;A[t.matchUpId]=e;const i=null==g||null===(F=g[t.matchUpId])||void 0===F?void 0:F.recoveryMinutes;Xp({individualParticipantProfiles:d,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:v,matchUpDependencies:f,recoveryMinutes:i,averageMatchUpMinutes:h,scheduleDate:n,scheduleTime:e,matchUp:t})}}let b=I.map((t=>m.find((e=>e.matchUpId===t)))).filter(Boolean).filter((t=>{const e=!P&&N.includes(t.matchUpId),n=[S,T,D,U,C,x].includes(null==t?void 0:t.matchUpStatus);return!e&&!t.winningSide&&!n}));const{matchUpMap:E}=b.reduce(((t,e)=>{const{drawId:n,tournamentId:i}=e;return t.matchUpMap[i]||(t.matchUpMap[i]={}),t.matchUpMap[i][n]?t.matchUpMap[i][n].push(e):t.matchUpMap[i][n]=[e],Qp({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:v,matchUp:e}),t}),{matchUpMap:{}});c[o]={courtsCount:p.filter((t=>t.venueId===o)).length,previousRemainingScheduleTimes:[],greatestAverageMinutes:h,scheduledRoundsDetails:l,matchUpsToSchedule:b,scheduleTimes:w,groupedRounds:y,minutesMap:g,matchUpMap:E}}const W=10;let q,z=0,Y=10;for(;!q;){for(const{venueId:e}of o){var k,j,B;let i=0;const r=c[e];for(;r.courtsCount&&null!==(_=r.scheduleTimes)&&void 0!==_&&_.length&&null!==(G=r.matchUpsToSchedule)&&void 0!==G&&G.length&&i<=r.courtsCount;){var _,G;const{scheduleTime:a,attempts:o=0}=r.scheduleTimes.shift(),c=r.matchUpsToSchedule.find((e=>{var i,o;const{matchUpId:c,matchUpType:u}=e,{participantIdsAtLimit:p,relevantParticipantIds:g}=om({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,matchUpDailyLimits:h,matchUp:e});if(p.length)return b[n].includes(c)||b[n].push(c),!1;const{scheduledDependent:y}=tm({matchUpScheduleTimes:A,matchUpDependencies:f,scheduleTime:a,matchUpId:c,details:r});if(y)return!1;const{dependenciesScheduled:U,remainingDependencies:S}=Zp({matchUpScheduleTimes:A,matchUpDependencies:f,allDateMatchUpIds:H,matchUps:m,matchUp:e});if(!U)return N[n][c]||(N[n][c]=[]),N[n][c].push({scheduleTime:a,remainingDependencies:S}),!1;const{enoughTime:D}=rm({individualParticipantProfiles:d,matchUpNotBeforeTimes:v,matchUpDependencies:f,scheduleTime:a,details:r,matchUp:e});if(!D)return w[n][c]||(w[n][c]=[]),w[n][c].push({scheduleTime:a}),!1;const T=r.greatestAverageMinutes,{conflicts:M}=im({potentials:t,averageMatchUpMinutes:T,requestConflicts:R,personRequests:I,scheduleTime:a,scheduleDate:n,matchUp:e});if(null!=M&&M.length)return P[n]||(P[n]=[]),P[n].push(...M),!1;l(g,u);const E=null===(i=r.minutesMap)||void 0===i||null===(o=i[c])||void 0===o?void 0:o.recoveryMinutes;return Xp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:d,matchUpNotBeforeTimes:v,averageMatchUpMinutes:T,matchUpDependencies:f,recoveryMinutes:E,scheduleDate:n,scheduleTime:a,matchUp:e}),A[c]=a,!0}));r.matchUpsToSchedule=r.matchUpsToSchedule.filter((({matchUpId:t})=>t!==(null==c?void 0:c.matchUpId))),c?i+=1:(y[n][e]||(y[n][e]=[]),y[n][e].push({scheduleTime:a,attempts:o+1}))}var V;null!==(k=r.matchUpsToSchedule)&&void 0!==k&&k.length&&(y[n][e]=null===(V=y[n][e])||void 0===V?void 0:V.filter((t=>{const e=t.attempts<Y;return e&&r.scheduleTimes.push(t),!e}))),null!==(j=r.scheduleTimes)&&void 0!==j&&j.length&&null!==(B=r.matchUpsToSchedule)&&void 0!==B&&B.length||(r.complete=!0)}z+=1,q=o.every((({venueId:t})=>c[t].complete))||z===W}for(const{venueId:t}of o){const e=c[t].matchUpMap;Object.keys(e).forEach((r=>{const o=i[r];o&&Object.keys(e[r]).forEach((i=>{const{drawDefinition:s}=Sa({tournamentRecord:o,drawId:i});s&&e[r][i].forEach((({matchUpId:e})=>{const i=A[e];if(i){const r=i.split(":").map(_i).join(":"),c=`${Oi(n)}T${r}`;a?M[n].push(e):(Zu({drawDefinition:s,matchUpId:e,scheduledTime:c}).success&&M[n].push(e),t&&Hu({tournamentRecord:o,drawDefinition:s,matchUpId:e,venueId:t}))}}))}))})),E[n]=c[t].matchUpsToSchedule.map(jc),g[n][t]=c[t].scheduleTimes.sort(((t,e)=>Ei(t.scheduleTime)-Ei(e.scheduleTime)))}}const H=v.map((({scheduleDate:t})=>t)),W={timeStamp:Date.now(),schedulingProfile:o,scheduledDates:H,noTimeMatchUpIds:E,scheduledMatchUpIds:M,overLimitMatchUpIds:b,requestConflicts:R},{topics:q}=si();if(q.includes(fc))ri({topic:fc,payload:W});else{const t={itemType:"autoSchedulingAudit",itemValue:W};for(const e of Object.values(i))cc({tournamentRecord:e,timeItem:t})}return{...pt,schedulingProfileModifications:c,schedulingProfileIssues:s,scheduleTimesRemaining:g,skippedScheduleTimes:y,recoveryTimeDeferredMatchUpIds:w,dependencyDeferredMatchUpIds:N,matchUpScheduleTimes:A,scheduledMatchUpIds:M,overLimitMatchUpIds:b,noTimeMatchUpIds:E,requestConflicts:R,scheduledDates:H}}({checkPotentialRequestConflicts:t,clearScheduleDates:e,tournamentRecords:i,scheduleDates:n,periodLength:r,dryRun:a})}function vm({event:t}){return t?Xc({event:t,name:$r}):{error:Yt}}function gm({tournamentParticipants:t,drawDefinition:e,participantId:n,matchUpId:i,event:r}){if(!n)return{error:Je};if(!i)return{error:ve};if(t&&t.length){const{matchUp:a}=Bu({tournamentParticipants:t,inContext:!0,drawDefinition:e,matchUpId:i,event:r});if(!a)return{error:he};const{error:o,checkedInParticipantIds:s,allRelevantParticipantIds:c}=Lu({matchUp:a});if(!c.includes(n))return{error:We};if(o)return{error:o};if(s.includes(n))return{error:rn}}return _u({drawDefinition:e,matchUpId:i,timeItem:{itemType:mr,itemValue:n}})}function ym({tournamentParticipants:t,drawDefinition:e,participantId:n,matchUpId:i,event:r}){if(!n)return{error:Je};if(!i)return{error:me};if(t&&t.length){const{matchUp:a}=Bu({tournamentParticipants:t,inContext:!0,drawDefinition:e,matchUpId:i,event:r}),{checkedInParticipantIds:o,allRelevantParticipantIds:s}=Lu({matchUp:a});if(!s.includes(n))return{error:We};if(!o.includes(n))return{error:nn};const{sideParticipantIds:c,nestedIndividualParticipantIds:u}=xu({matchUp:a}),d=c.indexOf(n);[0,1].includes(d)&&(u[d]||[]).forEach((t=>{_u({drawDefinition:e,matchUpId:i,timeItem:{itemType:fr,itemValue:t}})}))}return _u({drawDefinition:e,matchUpId:i,timeItem:{itemType:fr,itemValue:n}})}function Um(t){if(null==t||!t.tournamentRecord)return{error:It};const{tournamentRecord:e,participantId:n,matchUpId:i,drawDefinition:r}=t,a=e.participants||[],{matchUp:o}=Ud({tournamentRecord:e,drawDefinition:r,matchUpId:i,inContext:!0});if(!o)return{error:he};const{checkedInParticipantIds:s=[]}=Lu({matchUp:o});return s.includes(n)?ym({drawDefinition:r,tournamentParticipants:a,matchUpId:i,participantId:n}):gm({drawDefinition:r,tournamentParticipants:a,matchUpId:i,participantId:n})}function wm(t){const{tournamentRecords:e}=t;if(!e)return{error:ht};const{tournamentId:n,drawId:i,matchUpId:r,courtDayDate:a}=t,o=e[n];if(!o)return{error:It};const{drawDefinition:s}=Sa({tournamentRecord:o,drawId:i});return Ku({tournamentRecord:o,drawDefinition:s,matchUpId:r,courtId:"",courtDayDate:a})}const Sm="OTHER",Nm="OFFICIAL",Dm="COMPETITOR",Pm={OTHER:Sm,COACH:"COACH",MEDIA:"MEDIA",CAPTAIN:"CAPTAIN",MEDICAL:"MEDICAL",OFFICIAL:Nm,SECURITY:"SECURITY",COMPETITOR:Dm,ADMINISTRATION:"ADMINISTRATION"};function Tm(t){return $u(t)}function Am({drawDefinition:t,matchUpId:e,disableNotice:n,scheduledDate:i}){return Ju({drawDefinition:t,matchUpId:e,disableNotice:n,scheduledDate:i})}function Mm({drawDefinition:t,scheduledTime:e,matchUpId:n,disableNotice:i}){return Zu({drawDefinition:t,matchUpId:n,scheduledTime:e,disableNotice:i})}function bm({drawDefinition:t,matchUpId:e,startTime:n,disableNotice:i}){return Xu({drawDefinition:t,matchUpId:e,startTime:n,disableNotice:i})}function Em({drawDefinition:t,matchUpId:e,endTime:n,disableNotice:i}){return td({drawDefinition:t,matchUpId:e,endTime:n,disableNotice:i})}function Cm({drawDefinition:t,matchUpId:e,stopTime:n,disableNotice:i}){return ed({drawDefinition:t,matchUpId:e,stopTime:n,disableNotice:i})}function Rm({drawDefinition:t,matchUpId:e,resumeTime:n,disableNotice:i}){return nd({drawDefinition:t,matchUpId:e,resumeTime:n,disableNotice:i})}function Om({tournamentRecord:t,drawDefinition:e,participantId:n,officialType:i,matchUpId:r,disableNotice:a}){if(!n)return{error:Je};const{tournamentParticipants:o}=bp({tournamentRecord:t,participantFilters:{participantTypes:[La],participantRoles:[Nm]}});if(!ra({tournamentParticipants:o,participantId:n}))return{error:Ze};return Qu({drawDefinition:e,participantId:n,officialType:i,matchUpId:r,disableNotice:a})}function xm({tournamentRecord:t,scheduleChange:e,matchUpIds:n,dryRun:i}){if(!t)return{error:It};if(!n||!Array.isArray(n))return{error:fe};if("object"!=typeof e)return{error:_n};const r=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...pt};if(o&&isNaN(o))return{error:_n};if(s&&isNaN(s))return{error:_n};const{matchUps:c}=fd({tournamentRecord:t,matchUpFilters:{matchUpIds:n}}),u=null==c?void 0:c.filter(fp).filter((({matchUpStatus:t})=>!B.includes(t)));if(!u.length)return{...pt};const{tournamentInfo:d}=Ed({tournamentRecord:t}),{startDate:l,endDate:p}=d,m=u.reduce(((t,e)=>{const{matchUpId:n,drawId:i}=e;return t[i]?t[i].push(n):t[i]=[n],t}),{});for(const h of Object.keys(m)){const{drawDefinition:e,error:c}=Sa({tournamentRecord:t,drawId:h});if(c)return{error:c};const d=m[h].filter((t=>n.includes(t)));for(const t of d)if(t&&e){const n=u.find((e=>e.matchUpId===t)),c=n.schedule,{scheduledTime:d,scheduledDate:m}=c;let f,h,I;if(o&&d){const t=Oi(d),e=Ei(Ri(d))+o;if(f=e<0||e>1440,!f){let e=ji(d,o);h=t?`${t}T${e}`:e}}if(!f&&s&&m){I=xi(Oi(m),s),f=new Date(I)<new Date(l)||new Date(I)>new Date(p)}if(f)a.push(n);else{if(!i){if(h){const n=Mm({drawDefinition:e,matchUpId:t,scheduledTime:h});if(n.error)return n}if(I){const n=Am({drawDefinition:e,matchUpId:t,scheduledDate:I});if(n.error)return n}}(h||I)&&r.push(n)}}}const f=r.length&&!a.length;return{...pt,rescheduled:r,notRescheduled:a,allRescheduled:f}}function Lm({tournamentRecord:t,dailyLimits:e}){if(!t)return{error:It};if("object"!=typeof e)return{error:Bn};return $c({tournamentRecord:t,extension:{name:Yr,value:{dailyLimits:e}}})}function Fm({tournamentRecords:t,tournamentId:e,drawId:n}){if(!t)return{error:ht};if("string"!=typeof e&&!(e=Nd({tournamentRecords:t,drawId:n})))return{error:gt};const i=t[e];if(!i)return{error:It};const{drawDefinition:r,error:a}=wa({tournamentRecord:i,drawId:n});return{drawDefinition:r,error:a,tournamentRecord:i}}const km={scheduleMatchUps:function({tournamentRecords:t,competitionMatchUps:e,matchUpDependencies:n,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:a=0,recoveryMinutesMap:o,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:c={},matchUpNotBeforeTimes:u={},matchUpDailyLimits:d={},checkPotentialRequestConflicts:l=!0,remainingScheduleTimes:p,clearScheduleDates:m,periodLength:f=30,scheduleDate:h,matchUpIds:I,venueIds:v,startTime:g,endTime:y,dryRun:w}){if(!t)return{error:ht};if(!I)return{error:fe};if(!wi(h))return{error:Fe};if(isNaN(f)||isNaN(r)||isNaN(a))return{error:_n};e||({matchUps:e}=Hd({tournamentRecords:t,nextMatchUps:!0})),n||({matchUpDependencies:n}=zd({tournamentRecords:t,includeParticipantDependencies:!0,matchUps:e})),e.forEach((t=>{var e;null!==(e=t.schedule)&&void 0!==e&&e.scheduledDate&&Gi(h,Oi(t.schedule.scheduledDate))&&Qp({matchUp:t,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s})}));const N=I.map((t=>e.find((e=>e.matchUpId===t)))).filter(Boolean),{venueId:P,scheduleTimes:A,dateScheduledMatchUpIds:M}=Yp({tournamentRecords:t,remainingScheduleTimes:p,startTime:Ri(g),endTime:Ri(y),scheduleDate:Oi(h),averageMatchUpMinutes:r,clearScheduleDates:m,periodLength:f,venueIds:v}),b={},E=[],R={},O={},L={};e.filter((({matchUpId:t})=>M.includes(t))).forEach((t=>{var e;Jp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,scheduleDate:h,matchUp:t,value:1});const i=null===(e=t.schedule)||void 0===e?void 0:e.scheduledTime;if(i){R[t.matchUpId]=i;const e=null==o?void 0:o[t.matchUpId];Xp({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:u,matchUpDependencies:n,recoveryMinutes:e||a,averageMatchUpMinutes:r,scheduleDate:h,scheduleTime:i,matchUp:t})}}));let F=N.filter((t=>{const e=M.includes(t.matchUpId),n=[S,T,D,U,C,x].includes(null==t?void 0:t.matchUpStatus);return!e&&!t.winningSide&&!n}));const{matchUpMap:k,overLimitMatchUpIds:j,participantIdsAtLimit:B}=F.reduce(((t,e)=>{const{drawId:n,tournamentId:i,matchUpType:r}=e,{participantIdsAtLimit:a,relevantParticipantIds:o}=om({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpDailyLimits:d,matchUp:e});return null!=a&&a.length?(t.overLimitMatchUpIds.push(e.matchUpId),t.participantIdsAtLimit.push(...a),t):(o.forEach((t=>{$p({individualParticipantProfiles:c,participantId:t});const e=c[t].counters;e[r]?e[r]+=1:e[r]=1,e[ha]?e[ha]+=1:e[ha]=1})),t.matchUpMap[i]||(t.matchUpMap[i]={}),t.matchUpMap[i][n]?t.matchUpMap[i][n].push(e):t.matchUpMap[i][n]=[e],Qp({matchUp:e,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s}),t)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});F=F.filter((({matchUpId:t})=>!j.includes(t)));let _=0;const G=(null==A?void 0:A.length)||0,{personRequests:V}=sm({tournamentRecords:t,requestType:em});for(;null!=A&&A.length&&F.length&&_<=G;){_++;const{scheduleTime:t}=A.shift(),d=F.find((d=>{const{matchUpId:p}=d,{dependenciesScheduled:m,remainingDependencies:f}=Zp({matchUps:e,matchUpScheduleTimes:R,matchUpDependencies:n,allDateMatchUpIds:i,matchUp:d});if(!m)return L[p]||(L[p]=[]),L[p].push({scheduleTime:t,remainingDependencies:f}),!1;const{enoughTime:I}=rm({individualParticipantProfiles:c,matchUpNotBeforeTimes:u,matchUpDependencies:n,scheduleTime:t,matchUp:d});if(!I)return O[p]||(O[p]=[]),O[p].push({scheduleTime:t}),!1;const{conflicts:v}=im({potentials:l,averageMatchUpMinutes:r,requestConflicts:b,personRequests:V,scheduleTime:t,scheduleDate:h,matchUp:d});if(null!=v&&v.length)return!1;const g=null==o?void 0:o[d.matchUpId];return Xp({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUpNotBeforeTimes:u,averageMatchUpMinutes:r,matchUpDependencies:n,recoveryMinutes:g||a,scheduleDate:h,scheduleTime:t,matchUp:d}),R[d.matchUpId]=t,!0}));F=F.filter((({matchUpId:t})=>t!==(null==d?void 0:d.matchUpId))),d||E.push(t)}F.forEach((t=>{Jp({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,scheduleDate:h,value:-1,matchUp:t})}));let H=[];Object.keys(k).forEach((e=>{const n=t[e];n?Object.keys(k[e]).forEach((t=>{const{drawDefinition:i}=Sa({tournamentRecord:n,drawId:t});if(i){k[e][t].forEach((({matchUpId:t})=>{const e=R[t];if(e){const r=e.split(":").map(_i).join(":"),a=`${Oi(h)}T${r}`;if(w)H.push(t);else{Zu({drawDefinition:i,matchUpId:t,scheduledTime:a}).success&&H.push(t),P&&Hu({tournamentRecord:n,drawDefinition:i,matchUpId:t,venueId:P})}}}))}})):ei()&&console.log(gt)}));const W=xc(F);return{...pt,requestConflicts:Object.values(b),remainingScheduleTimes:A.map((({scheduleTime:t})=>t)),individualParticipantProfiles:c,matchUpNotBeforeTimes:u,participantIdsAtLimit:B,skippedScheduleTimes:E,overLimitMatchUpIds:j,scheduledMatchUpIds:H,noTimeMatchUpIds:W,recoveryTimeDeferred:O,dependencyDeferred:L}},scheduleProfileRounds:Im,clearScheduledMatchUps:lm,bulkRescheduleMatchUps:function({tournamentRecords:t,scheduleChange:e,matchUpIds:n,dryRun:i}){if(!t)return{error:ht};if(!n||!Array.isArray(n))return{error:fe};if("object"!=typeof e)return{error:_n};const r=[];let a=[];for(const u of Object.values(t)){var o;const t=xm({tournamentRecord:u,scheduleChange:e,matchUpIds:n,dryRun:i});if(t.error)return t;Array.isArray(t.notRescheduled)&&a.push(...t.notRescheduled);const c=xc(t.notRescheduled),d=[];var s;if(null===(o=t.rescheduled)||void 0===o||o.forEach((t=>{const{matchUpId:e}=t;c.includes(e)&&d.push(e),r.push(t)})),d.length)a=(null==t||null===(s=t.notRescheduled)||void 0===s?void 0:s.filter((({matchUpId:t})=>!d.includes(t))))||[]}const c=r.length&&!a.length;return{...pt,rescheduled:r,notRescheduled:a,allRescheduled:c}},getScheduledRoundsDetails:zp,getMatchUpDependencies:zd,generateVirtualCourts:Xs,generateBookings:fm,matchUpScheduleChange:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:ht};const{sourceMatchUpContextIds:n,targetMatchUpContextIds:i,sourceCourtId:r,targetCourtId:a,courtDayDate:o}=t||{},{drawId:s,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:l,tournamentId:p}=i||{};if(!c&&!l)return{error:Ee};let m=0;if(a&&c&&!l){const t=f({tournamentId:u,drawId:s,courtDayDate:o,matchUpId:c,courtId:a});if(null!=t&&t.success&&m++,t.error)return t}else if(r&&a&&c&&l){const t=f({tournamentId:u,drawId:s,courtDayDate:o,matchUpId:c,courtId:a});if(t.success&&m++,t.error)return t;const e=f({tournamentId:p,drawId:d,courtDayDate:o,matchUpId:l,courtId:r});if(e.success&&m++,e.error)return e}return m?pt:{error:kn};function f({tournamentId:t,drawId:n,matchUpId:i,courtDayDate:r,courtId:a}){const o=e[t],{drawDefinition:s}=Sa({tournamentRecord:o,drawId:n});return Ku({tournamentRecord:o,drawDefinition:s,matchUpId:i,courtId:a,courtDayDate:r})}},calculateScheduleTimes:Yp,reorderUpcomingMatchUps:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:ht};const{matchUpsContextIds:n,firstToLast:i}=t;if(!n)return{error:Ee};const r=null==n?void 0:n.length;if(!r)return pt;let a=0;return n.forEach(((t,o)=>{const{tournamentId:s,drawId:c,matchUpId:u}=t;let d=o+(i?-1:1);d<0&&(d=r-1),d===r&&(d=0);const l=function({tournamentId:t,drawId:n,matchUpId:i,scheduledTime:r}){const a=e[t],{drawDefinition:o}=Sa({tournamentRecord:a,drawId:n});return Zu({drawDefinition:o,matchUpId:i,scheduledTime:r})}({tournamentId:s,drawId:c,matchUpId:u,scheduledTime:n[d].schedule.scheduledTime});if(!l.success)return l;a++})),a===r?pt:{error:Fn}},bulkUpdateCourtAssignments:function({tournamentRecords:t,courtAssignments:e,courtDayDate:n}){if(!t)return{error:ht};if(!Array.isArray(e))return{error:Ee};const i=e.reduce(((t,e)=>{const{tournamentId:n}=e;return t[n]||(t[n]=[]),t[n].push(e),t}),{});let r;return Object.keys(i).every((e=>{const a=t[e];if(!a)return r={error:It},!1;const o=i[e].reduce(((t,e)=>{const{drawId:n}=e;return t[n]||(t[n]=[]),t[n].push(e),t}),{});Object.keys(o).every((t=>{const{drawDefinition:e}=wa({tournamentRecord:a,drawId:t});return e?(o[t].every((t=>{const{matchUpId:i,courtId:o}=t,s=Ku({tournamentRecord:a,drawDefinition:e,courtDayDate:n,matchUpId:i,courtId:o});if(s.success)return null==s?void 0:s.success;r={error:"Unable to assign court"}})),!0):(r={error:Ut},!1)}))})),r||pt},removeMatchUpCourtAssignment:wm,toggleParticipantCheckInState:function(t){const{tournamentRecords:e}=t,{participantId:n,tournamentId:i,matchUpId:r,drawId:a}=t;if(!(e&&i&&n&&r))return{error:Ee};const o=e[i],{drawDefinition:s}=Sa({tournamentRecord:o,drawId:a});return Object.assign(t,{drawDefinition:s,tournamentRecord:o}),Um(t)},findMatchUpFormatTiming:Kp,modifyMatchUpFormatTiming:function({tournamentRecords:t,matchUpFormat:e,recoveryTimes:n,averageTimes:i,tournamentId:r,eventId:a}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const o=Object.keys(t).filter((t=>!r||r===t));if(r&&!o.includes(r))return{error:_n};let s;for(const c of o){const r=t[c],{event:o}=wa({tournamentRecord:r,eventId:a});a&&o&&(s=!0);const u=_p({tournamentRecord:r,event:o,matchUpFormat:e,averageTimes:i,recoveryTimes:n});if(u.error)return u}return!a||s?{...pt}:{error:$t}},modifyEventMatchUpFormatTiming:function({tournamentRecords:t,tournamentId:e,eventId:n,categoryType:i,matchUpFormat:r,averageMinutes:a,recoveryMinutes:o}){if(!n)return{error:Yt};const s=Object.keys(t).filter((t=>!e||e===t));if(e&&!s.includes(e))return{error:_n};for(const c of s){const e=t[c],{event:s}=wa({tournamentRecord:e,eventId:n});if(s)return Vp({tournamentRecord:e,event:s,categoryType:i,matchUpFormat:r,averageMinutes:a,recoveryMinutes:o})}return{error:$t}},getMatchUpFormatTimingUpdate:function({tournamentRecords:t}){return Hp({tournamentRecords:t,extensionName:$r})},getEventMatchUpFormatTiming:function({tournamentRecords:t,matchUpFormats:e,categoryType:n,tournamentId:i,eventId:r}){if(!r)return{error:Yt};const a=Object.keys(t).filter((t=>!i||t===i));if(i&&!a.length)return{error:_n};let o,s,c;return a.find((i=>{const a=t[i],{event:u}=wa({tournamentRecord:a,eventId:r});if(!u)return!1;c=!0;const{eventMatchUpFormatTiming:d,error:l}=Wp({tournamentRecord:a,matchUpFormats:e,categoryType:n,event:u});return l&&(s=l),o=d,!0})),c?s?{error:s}:{eventMatchUpFormatTiming:o}:{error:$t}},removeEventMatchUpFormatTiming:function({tournamentRecords:t,eventId:e}){if(!t)return{error:ht};if("string"!=typeof e)return{error:Ee};for(const n of Object.values(t)){const{event:t}=wa({tournamentRecord:n,eventId:e});if(t)return vm({event:t})}return{error:$t}},getMatchUpDailyLimits:mm,setMatchUpDailyLimits:function({tournamentRecords:t,tournamentId:e,dailyLimits:n}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const i=Object.keys(t).filter((t=>!e||e===t));if(e&&!i.includes(e))return{error:_n};for(const r of i){const e=Lm({tournamentRecord:t[r],dailyLimits:n});if(e.error)return e}return pt},getMatchUpDailyLimitsUpdate:function({tournamentRecords:t}){return Hp({tournamentRecords:t,extensionName:Yr})},assignMatchUpVenue:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{matchUpId:r,venueId:a,disableNotice:o}=t;return Hu({tournamentRecord:e,drawDefinition:n,disableNotice:o,matchUpId:r,venueId:a})},assignMatchUpCourt:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{matchUpId:r,courtId:a,courtDayDate:o,disableNotice:s}=t;return Ku({tournamentRecord:e,disableNotice:s,drawDefinition:n,courtDayDate:o,matchUpId:r,courtId:a})},addMatchUpScheduleItems:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);return i?{error:i}:Tm({...t,tournamentRecord:e,drawDefinition:n})},addMatchUpScheduledDate:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{disableNotice:r,scheduledDate:a,matchUpId:o}=t;return Am({tournamentRecord:e,drawDefinition:n,disableNotice:r,scheduledDate:a,matchUpId:o})},addMatchUpScheduledTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{disableNotice:r,scheduledTime:a,matchUpId:o}=t;return Mm({tournamentRecord:e,drawDefinition:n,disableNotice:r,scheduledTime:a,matchUpId:o})},addMatchUpStartTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{disableNotice:r,startTime:a,matchUpId:o}=t;return bm({tournamentRecord:e,drawDefinition:n,disableNotice:r,startTime:a,matchUpId:o})},addMatchUpStopTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{disableNotice:r,stopTime:a,matchUpId:o}=t;return Cm({tournamentRecord:e,drawDefinition:n,disableNotice:r,stopTime:a,matchUpId:o})},addMatchUpResumeTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{disableNotice:r,resumeTime:a,matchUpId:o}=t;return Rm({tournamentRecord:e,drawDefinition:n,disableNotice:r,resumeTime:a,matchUpId:o})},addMatchUpEndTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{disableNotice:r,endTime:a,matchUpId:o}=t;return Em({tournamentRecord:e,drawDefinition:n,disableNotice:r,endTime:a,matchUpId:o})},addMatchUpOfficial:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=Fm(t);if(i)return{error:i};const{disableNotice:r,participantId:a,officialType:o,matchUpId:s}=t;return Om({tournamentRecord:e,drawDefinition:n,disableNotice:r,participantId:a,officialType:o,matchUpId:s})},getSchedulingProfile:kd,setSchedulingProfile:jd,addSchedulingProfileRound:Bd,isValidSchedulingProfile:Md,addPersonRequests:function({tournamentRecords:t,personId:e,requests:n}){if(!t)return{error:ht};if("string"!=typeof e)return{error:_n};if(!Array.isArray(n))return{error:_n};const{personRequests:i}=sm({tournamentRecords:t}),{mergeCount:r}=um({personRequests:i,personId:e,requests:n});return r?cm({tournamentRecords:t,personRequests:i}):{error:_n}},getPersonRequests:sm,modifyPersonRequests:function({tournamentRecords:t,requests:e,personId:n}){if(!t)return{error:ht};if(!Array.isArray(e))return{error:_n};const i=e.map((({requestId:t})=>t)).filter(Boolean),{personRequests:r}=sm({tournamentRecords:t}),a=t=>{r[t]=r[t].map((t=>{if(!i.includes(t.requestId))return t;const n=e.find((e=>e.requestId===t.requestId));return n.requestType?Object.assign(t,n):void 0})).filter(Boolean)};if(n&&r[n])a(n);else for(const s of Object.keys(r))a(s);const o=e.filter((t=>!t.requestId));return o.length&&um({personRequests:r,personId:n,requests:o}),cm({tournamentRecords:t,personRequests:r})},removePersonRequests:function({tournamentRecords:t,requestType:e,requestId:n,personId:i,date:r}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};const{personRequests:a}=sm({tournamentRecords:t}),o=t=>{a[t]=a[t].filter((t=>!(e&&t.requestType===e||n&&t.requestId===n||r&&t.date===r))),a[t].length||delete a[t]},s=!(e||n||i||r);if(!s)if(i&&a[i])o(i);else for(const c of Object.keys(a))o(c);return s||!Object.keys(a).length?Fd({tournamentRecords:t,name:zr}):cm({tournamentRecords:t,personRequests:a})}};function jm({tournamentRecord:t,policyDefinitions:e,allowReplacement:n}){if(!t)return{error:It};if(!e||"object"!=typeof e)return{error:Ue};t.extensions||(t.extensions=[]);const{appliedPolicies:i}=ta({tournamentRecord:t}),r=Object.keys(e).map((t=>{if(!i[t]||n)return i[t]=e[t],t})).filter(Boolean);if(null!=r&&r.length){const e=$c({tournamentRecord:t,extension:{name:jr,value:i}});if(e.error)return e}return null!=r&&r.length?{...pt,applied:r}:{error:De}}function Bm({policyDefinitions:t,allowReplacement:e,event:n}){if(!n)return{error:Yt};if(!t)return{error:Ue};let i=0;n.extensions||(n.extensions=[]);const{appliedPolicies:r}=ea({event:n});if(Object.keys(t).forEach((n=>{r[n]&&!e||(r[n]=t[n],i++)})),i){Zc({event:n,extension:{name:jr,value:r}})}return i?pt:{error:Pe}}const _m={attachPolicies:function({tournamentRecords:t,policyDefinitions:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:ht};for(const n of Object.values(t)){const t=jm({tournamentRecord:n,policyDefinitions:e,allowReplacement:!0});if(t.error)return t}return pt}};function Gm(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antoina, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and challenging me.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}const Vm="REFEREE",Hm="SCHEDULE",Wm="SCORE",qm="START",Km="STATUS",zm={END:"END",NICKNAME:"NICKNAME",PENALTY:"PENALTY",REFEREE:Vm,SCHEDULE:Hm,SCORE:Wm,START:qm,STATUS:Km};function Ym({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:n,matchUpId:i,event:r}){var a,o,s;if(!e)return{error:Ut};if(!i)return{error:me};const{matchUp:c,structure:u}=Bu({drawDefinition:e,matchUpId:i,event:r}),{assignedPositions:d,allPositionsAssigned:l}=Ru({structure:u}),{drawPositions:p}=c||{},{structureId:m}=u||{},f=[];if(!m)return{validActions:f};const h=Tl({drawDefinition:e,structure:u}),I=d.filter((t=>t.participantId)).map((t=>t.drawPosition)),v=d.filter((t=>t.bye)).map((t=>t.drawPosition)),g=c.collectionId,y=c.matchUpStatus===S||!g&&(null===(a=c.drawPositions)||void 0===a?void 0:a.reduce(((t,e)=>v.includes(e)||t),!1));if(y)return{validActions:f,isByeMatchUp:y};const U=null==p?void 0:p.reduce(((t,e)=>I.includes(e)&&t),2===(null==p?void 0:p.length));f.push({type:Vm});const w=!Yd({matchUpStatus:c.matchUpStatus}),{appliedPolicies:N}=Bc({drawDefinition:e}),D=null==N||null===(o=N.scoring)||void 0===o?void 0:o.structures,P=(null==D?void 0:D.stage)&&(null==D?void 0:D.stage[u.stage]),T=(null==P?void 0:P.stageSequence)&&P.stageSequence[u.stageSequence],M=!((null==N||null===(s=N.scoring)||void 0===s?void 0:s.requireAllPositionsAssigned)||(null==P?void 0:P.requireAllPositionsAssigned)||(null==T?void 0:T.requireAllPositionsAssigned))||l,b=c.sides&&2===c.sides.filter((t=>t&&t.participantId)).length;let E;const C=c.matchUpStatus===A;if(C){n=n||Gc({drawDefinition:e}),t||({matchUps:t}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:n}));E=Wl({inContextDrawMatchUps:t,drawDefinition:e,targetData:sd({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:i})})}const R=(U||b)&&!(C&&E),{drawId:O}=e,x={type:Ws,method:Ls,payload:{drawId:O,matchUpId:i,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(w&&f.push({type:Hm}),R&&f.push(x),w&&R&&f.push({type:Km}),M&&R){const{matchUpId:t,matchUpFormat:e}=c,n={drawId:O,matchUpId:t,matchUpFormat:e,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};f.push({type:Wm,method:"setMatchUpStatus",message:"set outcome and winningSide",payload:n}),f.push({type:qm}),f.push({type:"END"})}return{validActions:f,isDoubleWalkover:C,structureIsComplete:h}}function $m({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:i}){if(!t)return{error:It};if(!i){const{matchUps:r}=fd({tournamentRecord:t});i=r.reduce(((t,e)=>e.matchUpId===n?e.drawId:t),void 0);e=(t.events||[]).map((t=>t.drawDefinitions||[])).flat().reduce(((t,e)=>e.drawId===i?e:t),void 0)}return i?Ym({drawDefinition:e,matchUpId:n}):{error:St}}const Jm={getCompetitionDateRange:Cd,getTournamentIds:function({tournamentRecords:t}){const e=Object.keys(t);return{...pt,tournamentIds:e}},competitionScheduleMatchUps:Wd,getSchedulingProfileIssues:function({tournamentRecords:t,scheduleDates:e=[]}={}){if("object"!=typeof t)return{error:vt};if(!Array.isArray(e))return{error:_n};if(!e.every(wi))return{error:Fe};const n=[];let i=0;const r={},{schedulingProfile:a}=kd({tournamentRecords:t});if(!a)return{issues:n,...pt};const{matchUps:o}=Hd({tournamentRecords:t,nextMatchUps:!0});for(const s of a){const{scheduleDate:a,venues:c=[]}=s;if(null==e||!e.length||e.includes(a))for(const e of c||[])if(e){const{rounds:s}=e,c=[];let{orderedMatchUpIds:u,scheduledRoundsDetails:d}=zp({tournamentRecords:t,periodLength:30,matchUps:o,rounds:s});const{matchUpDependencies:l}=zd({tournamentRecords:t,matchUps:o}),p=t=>{let e;return d.find(((n,i)=>{const r=n.matchUpIds.includes(t);return r&&(e=i),r})),e};if(u.forEach(((t,e)=>{var n;const i=ct(u.slice(e+1),(null==l||null===(n=l[t])||void 0===n?void 0:n.matchUpIds)||[]);i.length&&c.push({matchUpId:t,shouldBeAfter:i})})),c.length){i+=c.length;const t=c.map((({matchUpId:t,shouldBeAfter:e})=>{const n=p(t),i=X(e.map(p));return r[a]||(r[a]={}),r[a][n]||(r[a][n]=[]),i.forEach((t=>{r[a][n].includes(t)||r[a][n].push(t)})),{matchUpId:t,matchUpRoundIndex:n,earlierRoundIndices:i,shouldBeAfter:e}}));n.push(...t)}}}return{issuesCount:i,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...n.map((t=>{const{matchUpId:e,shouldBeAfter:n,earlierRoundIndices:i}=t;return{[e]:{earlierRoundIndices:i,shouldBeAfter:n}}})))},roundIndexShouldBeAfter:r,...pt}},allCompetitionMatchUps:Hd,competitionMatchUps:qd,matchUpActions:function({tournamentRecords:t,tournamentId:e,matchUpId:n,eventId:i,drawId:r}={}){if("object"!=typeof t||"string"!=typeof e||"string"!=typeof n||"string"!=typeof r)return{error:_n};const a=t[e];if(!a)return{error:It};const{drawDefinition:o,error:s}=wa({tournamentRecord:a,eventId:i,drawId:r});return s?{error:s}:$m({tournamentRecord:a,drawDefinition:o,drawId:r,matchUpId:n})},getCompetitionVenues:Od,getVenuesAndCourts:Rd,getVenuesReport:function({tournamentRecords:t,venueIds:e=[],dates:n=[]}){if(!Array.isArray(n))return{error:_n,dates:n};if(!Array.isArray(e))return{error:_n,venueIds:e};if(!n.every(wi))return{error:Fe};const i=Rd({tournamentRecords:t});if(i.error)return i;const r=i.venues.filter((({venueId:t})=>!(null!=e&&e.length)||e.includes(t))),a=i.courts.reduce(((t,e)=>(e.dateAvailability.forEach((({date:e})=>{t.includes(e)||t.push(e)})),t)),[]).filter((t=>!n.length||n.includes(t))),o={venueIds:r.map((({venueId:t})=>t))},{matchUps:s}=Hd({tournamentRecords:t,matchUpFilters:o});return{venuesReport:r.map((t=>function(t,e,n){const{venueId:i,courts:r,venueName:a}=e,o={};return t.forEach((t=>{let e=0,a=0,s=0;for(const n of r){const i=n.dateAvailability.find((e=>e.date===t)),r=i&&Js({courtDate:i}),a=null==r?void 0:r.reduce(((t,e)=>{const{startTime:n,endTime:i}=e;return t+(Ei(i)-Ei(n))}),0);a&&(s+=1),e+=a}const c=n.filter((({schedule:e})=>e.venueId===i&&Gi(t,e.scheduledDate)));c.forEach((({schedule:t})=>{const e=Ri(t.scheduledTime),n=Ei(ji(e,t.averageMinutes))-Ei(e);a+=n}));const u=e?(a/e*100).toFixed(2):"100";o[t]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:e,scheduledMinutes:a,percentUtilization:u}})),{venueId:i,venueName:a,venueReport:o}}(a,t,s)))}},credits:Gm};function Zm({convertExtensions:t,removeExtensions:e}){const n=li();return{tournamentId:ui(),tournamentRecords:Hi(n,t,!1,e)}}function Qm(){var t;const e=li(),{extension:n}=Ld({tournamentRecords:e,name:qr}),i=(null==n||null===(t=n.value)||void 0===t?void 0:t.tournamentIds)||[];return Object.keys(e).forEach((t=>{i.includes(t)||delete e[t]})),mi(e)}function Xm(t,e=!0){return"object"!=typeof t||Array.isArray(t)?{error:Bn}:t.tournamentId?pi(e?Hi(t):t):{error:_n}}function tf(t,e=!0){if("object"!=typeof t)return{error:Bn};if(Array.isArray(t)){if(!(t.filter((({tournamentId:t})=>t)).length===t.length))return{error:ft};t=Object.assign({},...t.map((t=>({[t.tournamentId]:t}))))}else if(t.tournamentId)t={[t.tournamentId]:t};else{if(!Object.keys(t).every((e=>t[e].tournamentId===e)))return{error:ft}}return mi(e?Hi(t):t)}const ef=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>Zm({convertExtensions:t,removeExtensions:e}),version:()=>"0.56.2",reset:()=>(mi({}),e())};return[kp,_m,Jm,km].forEach((e=>{Object.keys(e).forEach((i=>{t[i]=t=>{if(ei())return n(e[i],t);try{return n(e[i],t)}catch(r){console.log("%c ERROR","color: orange",{err:r})}}}))})),t.devContext=t=>(ni(t),e()),t.getDevContext=t=>ei(t),t.setState=(t,n,i)=>{ii(n,i);return e(tf(t,n))},t.setTournamentRecord=(t,n,i)=>{ii(n,i);return e(Xm(t,n))},t.removeTournamentRecord=t=>e(hi(t)),t.removeUnlinkedTournamentRecords=()=>e(Qm()),t.executionQueue=(e,n)=>function(e,n){if(!Array.isArray(e))return{error:_n};const i=li(),r=n&&Hi(i,!1,!0),a=[];for(const o of e){if("object"!=typeof o)return{error:_n};const{method:e,params:n}=o;if(!t[e])return{error:Jn};const s=t[e]({...n,tournamentRecords:i});if(null!=s&&s.error)return r&&tf(r),{...s,rolledBack:!!r};a.push(s)}return jp(),oi(),{results:a}}(e,n),t;function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function n(e,n){delete t.success,delete t.error;const i=li(),r=(null==n?void 0:n.rollbackOnError)&&Hi(i,!1,!0),a=e({...n,tournamentRecords:i});null!=a&&a.error&&r&&tf(r);const o=(null==a?void 0:a.success)&&!0!==(null==n?void 0:n.delayNotify)&&!0!==(null==n?void 0:n.doNotNotify);return o&&jp(),(o||null==a||!a.success||null!=n&&n.doNotNotify)&&oi(),a}}();function nf({policyAttributes:t,idCollections:e,participants:n,participant:i}){if(!Array.isArray(t))return{error:Se};if(!i)return{error:Ye};const r=[];t.forEach((t=>{const o=i,{directive:s,groupings:c,key:u,significantCharacters:d}=t||{};if(u){a({value:o,keys:u.split("."),significantCharacters:d})}else if(s){const a=null==t?void 0:t.includeIds,o=(e&&e[s]||[]).filter((t=>!a||a.includes(t)));null!=o&&o.length&&null!=n&&n.length&&o.forEach((t=>{var e;const a=n.find((e=>e.participantId===t));if(null!=a&&null!==(e=a.individualParticipantIds)&&void 0!==e&&e.includes(i.participantId)){const t=null==a?void 0:a.participantId;r.push(t)}}))}else c&&Object.keys(c).forEach((t=>{c[t].includes(i.participantId)&&r.push(t)}))}));return{values:X(r)};function a({value:t,keys:e=[],significantCharacters:n}){for(const[r,o]of e.entries())if(t&&t[o])if(Array.isArray(t[o])){const i=t[o],s=e.slice(r);i.forEach((t=>a({value:t,keys:s,significantCharacters:n})))}else i({value:t=t[o],index:r});function i({value:t,index:i}){if(t&&i===e.length-1&&["string","number"].includes(typeof t)){const e=n?t.slice(0,n):t;r.push(e)}}}}function rf({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:n,idCollections:i}){const r=Object.assign({},...e.map((t=>({[t.participantId]:t}))));return t.map((t=>{const a=r[t.participantId],{values:o}=nf({participants:e,policyAttributes:n,idCollections:i,participant:a});return{...t,values:o}}))}function af({participantIdGroups:t,positionAssignments:e,groupsToAvoid:n}){return Object.assign({},...e.filter((t=>null==t?void 0:t.participantId)).map((e=>{const{drawPosition:i,participantId:r}=e,a=t&&t[r]||[],o=!!n.some((t=>a.includes(t)));return{[i]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function of(t){const{unfilledPositions:e,chunkedDrawPositions:n}=t,i=af(t);return n.map((t=>{const n=e.filter((e=>t.includes(e))),r=function(t){return t.filter((t=>!e(t)));function e(e){const n=sf(e);return!t.includes(n)}}(n),a=n.filter((t=>!r.includes(t))).filter((t=>{var e;const n=sf(t);return!(null!==(e=i[n])&&void 0!==e&&e.includesGroupsToAvoid)}));return{unassigned:n,unpaired:r,pairedNoConflict:a}}))}function sf(t){return t%2?t+1:t-1}function cf({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:n,drawPositionChunks:i,unfilledPositions:r,isRoundRobin:a}){const o=i.map((i=>a?function(t){const{unfilledPositions:e,chunkedDrawPositions:n}=t,i=af(t);return n.map((t=>{const n=e.filter((e=>t.includes(e))),r=n.length===t.length?n:[],a=t.filter((t=>{var e;return null===(e=i[t])||void 0===e?void 0:e.includesGroupsToAvoid})).length;return{unassigned:n,unpaired:r,pairedNoConflict:a?[]:n,conflictsCount:a}}))}({groupsToAvoid:t,chunkedDrawPositions:i,participantIdGroups:e,positionAssignments:n,unfilledPositions:r}):of({groupsToAvoid:t,chunkedDrawPositions:i,participantIdGroups:e,positionAssignments:n,unfilledPositions:r})));if(a){return{unassigned:o.map((t=>t.map((t=>t.unassigned)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)).sort(((t,e)=>(e.length||0)-(t.length||0))),unpaired:o.map((t=>t.map((t=>t.unpaired)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),pairedNoConflict:o.map((t=>t.map((t=>t.pairedNoConflict)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)).sort(((t,e)=>(e.length||0)-(t.length||0)))}}return{unassigned:o.map((t=>t.map((t=>t.unassigned)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),unpaired:o.map((t=>t.map((t=>t.unpaired)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),pairedNoConflict:o.map((t=>t.map((t=>t.pairedNoConflict)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length))}}function uf({participantIds:t,positionAssignments:e}){const n=e.map((t=>t.participantId));return t.filter((t=>!n.includes(t)))}function df({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:n,drawPositionChunks:i,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){const c=r.reduce(((t,e)=>e.length>t?e.length:t),0),u=!!(c>2),d=uf({participantIds:e,positionAssignments:t}),l=function({drawPositionGroups:t,positionAssignments:e}){const n=Object.assign({},...e.map((t=>({[t.drawPosition]:t}))));return t.map((t=>t.filter(Boolean).map((t=>n[t])).filter((t=>!t.participantId&&!t.bye)).map((t=>t.drawPosition)))).flat().filter(Boolean)}({drawPositionGroups:r,positionAssignments:t}),{participantId:p,groupKey:m}=function({groupKey:t,allGroups:e,largestFirst:n=!0,targetParticipantIds:i,useSpecifiedGroupKey:r=!1}){var a;const o=Object.assign({},...Object.keys(e).map((t=>[t,e[t].filter((t=>i.includes(t)))])).filter((t=>t[1].length)).map((([t,e])=>({[t]:e})))),s=Object.keys(o).reduce(((t,e)=>o[e].length>t?o[e].length:t),0),c=Object.keys(o).filter((t=>o[t].length===s)),u=at(n?c:Object.keys(o));return{participantId:(t=r&&null!==(a=o[t])&&void 0!==a&&a.length?t:u)&&o[t]?at(o[t]):at(i),groupKey:t}}({groupKey:s,allGroups:o,targetParticipantIds:d,useSpecifiedGroupKey:u}),f=cf({positionAssignments:t,isRoundRobin:u,selectedParticipantGroups:function({allGroups:t,participantId:e}){return Object.keys(t).filter((n=>t[n].includes(e)))}({allGroups:o,participantId:p}),participantIdGroups:n,drawPositionChunks:i,unfilledPositions:l,largestGroupSize:c,allGroups:o}),{unassigned:h,unpaired:I,pairedNoConflict:v}=f,g=(null==v?void 0:v.length)&&v[0],y=(null==I?void 0:I.length)&&I[0],U=a&&g?g:y,w=a?y:g,S=(null==U?void 0:U.length)&&U||(null==w?void 0:w.length)&&w;let N;if(null!=S&&S.length){const t=rt(S);N=rt(t)}else{const t=rt(h[0]);N=rt(t)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:N}}function lf({drawPositions:t}){const e=[].concat(...t.map((e=>t.filter((t=>t!==e)).map((t=>[e,t]))))),n=X(e.map(pf)).map((t=>t.split("|").map((t=>+t))));return{groupMatchUps:e,uniqueMatchUpGroupings:n}}function pf(t){return t.sort(Ki).join("|")}function mf({isRoundRobin:t,groupedParticipants:e}){const n=[];return t?e.forEach((t=>{const e=t.map((t=>t.drawPosition)),{uniqueMatchUpGroupings:i}=lf({drawPositions:e}),r=Object.assign({},...t.map((t=>({[t.drawPosition]:t}))));i.forEach((e=>{ut(r[e[0]].values||[],r[e[1]].values||[])&&(n.push(e),t.conflict=!0)}))})):e.forEach((t=>{ut(t[0].values||[],t[1].values||[])&&(n.push(t),t.conflict=!0)})),n}function ff({isRoundRobin:t,avoidanceConflicts:e,drawPositionGroups:n,positionedParticipants:i,potentialDrawPositions:r}){return e.map((e=>{const a=e.map((t=>t.drawPosition));return e.filter((t=>r.includes(t.drawPosition))).map((e=>{const o=r.filter((t=>!a.includes(t))).filter((r=>{const a=n.find((t=>t.includes(r))).find((t=>t!==r)),o=i.find((t=>t.drawPosition===a)),s=mf({isRoundRobin:t,groupedParticipants:[[e,o]]}),c=i.find((t=>t.drawPosition===r)),u=mf({isRoundRobin:t,groupedParticipants:[[c,o]]});return!s.length&&!u.length}));if(o.length)return{drawPosition:e.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function hf(t){const{initialPositionAssignments:e,participantsWithGroupings:n,opponentsToPlaceCount:i,drawPositionGroups:r,policyAttributes:a,idCollections:o,allGroups:s}=t,c=[];let u;const d=Math.min(...r.map((t=>t.length))),l=d>2,p=Hi(e,!1,!0),m=e.filter((t=>!t.participantId)).map((t=>t.drawPosition));ot(0,i).forEach((()=>{const{newGroupKey:e,selectedParticipantId:n,targetDrawPosition:i}=df({...t,groupKey:u,allGroups:s,candidatePositionAssignments:p});u=e,p.forEach((t=>{t.drawPosition===i&&(t.participantId=n)}))}));let f=rf({candidatePositionAssignments:p,participantsWithGroupings:n,policyAttributes:a,idCollections:o}),h=dt(f,d),I=mf({isRoundRobin:l,groupedParticipants:h}),v=0;for(;v<20&&I.length;){const t=ff({isRoundRobin:l,avoidanceConflicts:I,drawPositionGroups:r,positionedParticipants:f,potentialDrawPositions:m});t.length?(If({candidatePositionAssignments:p,swapOptions:t}),f=rf({candidatePositionAssignments:p,participantsWithGroupings:n,policyAttributes:a,idCollections:o}),h=dt(f,d),I=mf({isRoundRobin:l,groupedParticipants:h}),v++):v=20}return p.forEach((t=>{t.bye&&t.participantId&&c.push({error:"Invalid Assignment",assignment:t})})),{positionAssignments:p,conflicts:I.length,groupedParticipants:h,errors:c}}function If({candidatePositionAssignments:t,swapOptions:e}){const n=rt(e);if(!n)return{error:"No swap options"};const i=n.drawPosition,r=rt(n.possibleDrawPositions),a=t.find((t=>t.drawPosition===i)).participantId,o=t.find((t=>t.drawPosition===r)).participantId;return t.forEach((t=>{t.drawPosition===i&&(t.participantId=o),t.drawPosition===r&&(t.participantId=a)})),pt}function vf({unseededParticipantIds:t,inContextDrawMatchUps:e,drawDefinition:n,participants:i,matchUpsMap:r,structureId:a,avoidance:o,entries:s,event:c}){if(!o)return{error:we};const{policyAttributes:u,roundsToSeparate:d,candidatesCount:l=1}=o,{structure:p}=Wc({drawDefinition:n,structureId:a}),{matchUps:m}=ju({matchUpsMap:r,structure:p,event:c}),{positionAssignments:f}=Ru({structure:p}),h=id({participants:i}),I=f.filter((t=>!t.participantId)),v=f.map((t=>t.drawPosition)),g=p.structureType===Jo,y=g?{structure:p,matchUps:m,allDrawPositions:v,roundsToSeparate:d}:{matchUps:m,allDrawPositions:v,roundsToSeparate:d},{drawPositionGroups:U,drawPositionChunks:w}=g?function(t){const{structure:{structures:e}}=t,n=e.map((t=>t.positionAssignments.map((t=>t.drawPosition))));return{drawPositionGroups:n,drawPositionChunks:[n]}}(y):function({matchUps:t,allDrawPositions:e,roundsToSeparate:n}){const i=t.filter((t=>1===t.roundNumber)).map((t=>t.drawPositions)),r=i.flat().sort(Ki),a=Math.max(...r),o=e.filter((t=>t>a)),s=ot(2,r.length).filter((t=>t===K(t))),c=s.slice(0,n||s.length).reverse().map((t=>dt(r,t)));o.length&&console.log({fedDrawPositions:o});return{drawPositionGroups:i,drawPositionChunks:c}}(y),S={};S.groupParticipants=i.filter((t=>t.participantType===ja)).map((t=>t.participantId)),S.teamParticipants=i.filter((t=>t.participantType===Fa)).map((t=>t.participantId)),S.pairParticipants=i.filter((t=>t.participantType===ka)).map((t=>t.participantId));const N=function({targetParticipantIds:t,policyAttributes:e,idCollections:n,participants:i}){if(!Array.isArray(e))return{error:Se};if(!Array.isArray(i))return{error:$e};const r={};return t.forEach((t=>{const a=i.find((e=>e.participantId===t)),{values:o}=nf({policyAttributes:e,idCollections:n,participants:i,participant:a});o&&o.forEach((e=>{r[e]||(r[e]=[]),r[e].includes(t)||r[e].push(t)}))})),r}({targetParticipantIds:t,policyAttributes:u,idCollections:S,participants:i}),D=Object.assign({},...t.map((t=>{const e=Object.keys(N).filter((e=>N[e].includes(t)));return{[t]:e}}))),P=uf({participantIds:t,positionAssignments:f});if(P.length>I.length)return{error:"More participantIds than unpaired positions"};let T;const A=[],M=P.length,b=ot(0,l).map((()=>hf({initialPositionAssignments:f,participantsWithGroupings:h,unseededParticipantIds:t,opponentsToPlaceCount:M,drawPositionChunks:w,drawPositionGroups:U,participantIdGroups:D,idCollections:S,allGroups:N,policyAttributes:u,pairedPriority:!1})));if(T=b.reduce(((t,e)=>!t||(e.conflicts||0)<(t.conflicts||0)?e:t),void 0),!T||T.conflicts){const e=ot(0,l).map((()=>hf({initialPositionAssignments:f,participantsWithGroupings:h,unseededParticipantIds:t,opponentsToPlaceCount:M,drawPositionChunks:w,drawPositionGroups:U,participantIdGroups:D,idCollections:S,allGroups:N,entries:s,policyAttributes:u,pairedPriority:!0})));T=b.concat(...e).filter((t=>{var e;return!(null!==(e=t.errors)&&void 0!==e&&e.length)})).reduce(((t,e)=>!t||(e.conflicts||0)<(t.conflicts||0)?e:t),void 0)}if(!T)return{error:"Could not produce candidate"};const E=(p.positionAssignments||[]).filter((t=>t.participantId)).map((t=>t.participantId));return T.positionAssignments.filter((t=>!E.includes(t.participantId))).forEach((t=>{if(t.participantId&&!t.bye){const i=jl({automaticPlacement:!0,drawDefinition:n,structureId:a,matchUpsMap:r,inContextDrawMatchUps:e,...t});null!=i&&i.success||A.push(i)}})),A.length?{error:A,conflicts:T.conflicts}:Object.assign({positionAssignments:T.positionAssignments,conflicts:T.conflicts},pt)}function gf({drawDefinition:t,candidatesCount:e,participants:n,structureId:i,structure:r,matchUpsMap:a,inContextDrawMatchUps:o}){r||({structure:r}=Wc({drawDefinition:t,structureId:i})),i||({structureId:i}=r);const{positionAssignments:s}=Ru({structure:r}),{seedAssignments:c}=Mu({drawDefinition:t,structure:r}),u=c.map((t=>t.participantId)).filter(Boolean),{stage:d,stageSequence:l}=r,p=Du({drawDefinition:t,stageSequence:l,entryStatuses:[ou,au],structureId:i,stage:d}),m=p.filter((t=>!u.includes(t.participantId))).map((t=>t.participantId)),f=s.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));if(m.length>f.length)return{error:"Insufficient drawPositions to accommodate entries"};const{appliedPolicies:h}=Bc({drawDefinition:t});let{avoidance:I}=h||{};if(r.stage===Wo){const t=p.reduce(((t,e)=>(t[e.groupingValue]||(t[e.groupingValue]=[]),t[e.groupingValue].push(e.participantId),t)),{});Object.keys(t).length&&(I||(I={policyName:"Playoff Avoidance"}),I.policyAttributes||(I.policyAttributes=[]),I.policyAttributes.push({groupings:t}))}if(I&&n){return vf({unseededParticipantIds:m,candidatesCount:e,drawDefinition:t,participants:n,structureId:i,avoidance:I,entries:p,matchUpsMap:a,inContextDrawMatchUps:o})}return function({unseededParticipantIds:t,unfilledDrawPositions:e,drawDefinition:n,structureId:i,matchUpsMap:r,inContextDrawMatchUps:a}){const o=tt(e);for(const s of t){const t=jl({structureId:i,drawPosition:o.pop(),participantId:s,drawDefinition:n,automaticPlacement:!0,matchUpsMap:r,inContextDrawMatchUps:a});if(t&&t.error)return t}return pt}({unseededParticipantIds:m,unfilledDrawPositions:f,drawDefinition:t,structureId:i,matchUpsMap:a,inContextDrawMatchUps:o})}function yf({structure:t,drawDefinition:e,appliedPolicies:n,relevantMatchUps:i}){const{validSeedBlocks:r,isFeedIn:a,isContainer:o}=Ol({appliedPolicies:n,drawDefinition:e,structure:t}),s=function({drawDefinition:t,structure:e}){const{positionAssignments:n}=Ru({structure:e}),{seedAssignments:i}=Mu({drawDefinition:t,structure:e}),r=Object.assign({},...i.filter((t=>t.participantId)).map((t=>({[t.participantId]:t}))));return n.map((t=>r[t.participantId]?{...t,seedNumber:r[t.participantId].seedNumber,seedValue:r[t.participantId].seedValue}:"")).filter(Boolean)}({drawDefinition:e,structure:t}),c=X([].concat(...i.map((t=>t.drawPositions)))),u=s.filter((t=>c.includes(t.drawPosition))),d=[].concat(...r.map((t=>tt(t.drawPositions)))).filter((t=>c.includes(t))),l=(t,e)=>t.seedValue-e.seedValue;return{strictSeedOrderByePositions:Uf({orderedSeedDrawPositions:r.reduce(((t,e)=>{const n=u.filter((t=>{var n;return null===(n=e.drawPositions)||void 0===n?void 0:n.includes(t.drawPosition)})).sort(l);return t.concat(...n)}),[]).map((t=>t.drawPosition)),relevantMatchUps:i}).slice(0,s.length),blockSeedOrderByePositions:Uf({orderedSeedDrawPositions:d,relevantMatchUps:i}).slice(0,s.length),isFeedIn:a,isContainer:o}}function Uf({orderedSeedDrawPositions:t,relevantMatchUps:e}){const n=e.map((t=>t.drawPositions)).map((t=>t.sort(((t,e)=>t-e)))).filter((t=>t[0]+1===t[1]));return t.map((t=>n.find((e=>null==e?void 0:e.includes(t))))).filter(Boolean).map((e=>null==e?void 0:e.reduce(((e,n)=>t.includes(n)?e:n),void 0))).filter(Boolean)}function wf({blockOrdered:t=!1,drawDefinition:e,matchUpsMap:n,structureId:i,structure:r,seedsOnly:a,event:o}){r||({structure:r}=Wc({drawDefinition:e,structureId:i})),i||({structureId:i}=r);const{byesCount:s,placedByes:c,relevantMatchUps:u}=function({drawDefinition:t,event:e,matchUpsMap:n,structure:i}){var r;const{matchUps:a,roundMatchUps:o}=ju({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:i,event:e}),s=o&&o[1]||[],c=(null==i?void 0:i.structureType)===Jo,u=c?a:s,d=c?(null==i||null===(r=i.structures)||void 0===r?void 0:r.length)||0:a.length,{structureId:l,stage:p,stageSequence:m}=i,f=Du({drawDefinition:t,stageSequence:m,entryStatuses:[ou,au],structureId:l,stage:p}),h=Su({drawDefinition:t,stage:p}),I=f.length+h,{positionAssignments:v,unassignedPositions:g}=Ru({structure:i}),y=g.map((t=>t.drawPosition)),U=v.filter((t=>t.bye)).length,w=v.filter((t=>t.bye)).map((t=>t.drawPosition)),S=u.map((t=>t.drawPositions)).filter((t=>t&&(null==t?void 0:t.reduce(((t,e)=>!w.includes(e)&&t),!0)))).flat(1/0).filter((t=>y.includes(t)));let N=v.length-I;return N>d&&1===i.stageSequence&&i.stage!==Vo&&(N=d),{placedByes:U,byesCount:N,relevantMatchUps:u,placedByePositions:w,roundMatchUps:o,positionsToAvoidDoubleBye:S}}({drawDefinition:e,matchUpsMap:n,structure:r,event:o}),d=s-c;if(d<=0)return pt;const{appliedPolicies:l}=Bc({drawDefinition:e}),{isFeedIn:p,strictSeedOrderByePositions:m,blockSeedOrderByePositions:f}=yf({structure:r,drawDefinition:e,appliedPolicies:l,relevantMatchUps:u}),h=t?f:m,{unseededByePositions:I}=function({structure:t,appliedPolicies:e,isFeedIn:n}){var i;const r=null==e||null===(i=e.seeding)||void 0===i?void 0:i.seedingProfile,{positionAssignments:a}=Ru({structure:t}),o=a.filter((t=>t.participantId)).map((t=>t.drawPosition)),{matchUps:s,roundMatchUps:c}=ju({matchUpFilters:{isCollectionMatchUp:!1},structure:t}),u=c&&c[1]||[],d=t.structureType===Jo?s:u,l=X([].concat(...d.map((t=>t.drawPositions)))),p=Math.min(...l)-1,m=o.filter((t=>l.includes(t))),f=t=>{const e=Math.ceil(t.length/2),n=[t.slice(0,e),t.slice(e)],i=n.map((t=>[].concat(...t.flat(1/0)).length)),r=Math.min(...i.flat(1/0)),a=Math.max(...i.flat(1/0)),o=i.indexOf(a),s=r!==a,c=tt(n),[u,d]=!r||s?[n[o],n[1-o]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:d}},h=t=>{const{greaterHalf:e,lesserHalf:n}=f(t),{greaterHalf:i,lesserHalf:r}=f(e),a=tt(i.flat(1/0)).pop();return{newlyFilteredChunks:[...n,...r,i.flat().filter((t=>t!==a))],drawPosition:a}},I=t=>!m.includes(t),v=t=>{let e=dt(t.sort(Ki),Math.ceil(t.length/4)).map((t=>t.filter(I)));const n=[].concat(...e.flat(1/0)).length,i=[];for(let r=0;r<n;r++){const{newlyFilteredChunks:t,drawPosition:n}=h(e);i.push(n),e=t}return i},{validSeedBlocks:g}=Ol({structure:t,appliedPolicies:e,allPositions:!0});let y=g.map((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>t+p))})).map(v).filter((t=>t.length));if(n){const t=l.length,{seedBlocks:e}=Rl({participantsCount:t,cluster:r===zo});y=e.map((t=>t.map((t=>t+p)))).map(v).filter((t=>t.length))}const U=d.map((t=>t.drawPositions)).map((t=>t.sort(((t,e)=>t-e)))).filter((t=>t[0]+1===t[1])),w=t=>U.reduce(((e,n)=>n.includes(t)?n.reduce(((e,n)=>n!==t?n:e),void 0):e),void 0);return{unseededByePositions:y.map((t=>t.map(w))).flat(1/0).filter(Boolean)}}({appliedPolicies:l,structure:r,isFeedIn:p}),v=[].concat(...h,...a?[]:I).slice(0,d);for(const g of v){const t=fl({drawDefinition:e,structureId:i,drawPosition:g,matchUpsMap:n});if(null!=t&&t.error)return t}return pt}function Sf({drawDefinition:t,structure:e,structureId:n}){e||({structure:e}=Wc({drawDefinition:t,structureId:n})),n||({structureId:n}=e);const{positionAssignments:i}=Ru({structure:e}),r=i.filter((t=>t.qualifier)).map((t=>t.drawPosition)),{stage:a,stageSequence:o}=e,s=Su({drawDefinition:t,stage:a,stageSequence:o}),c=s-r.length;return{positionAssignments:i,qualifiersCount:s,placedQualifiersCount:r.length,unplacedQualifiersCount:c}}function Nf({drawDefinition:t,participants:e,groupsCount:n,structureId:i,structure:r,matchUpsMap:a,inContextDrawMatchUps:o}){const s=[];let c=0;r||({structure:r}=Wc({drawDefinition:t,structureId:i})),i||({structureId:i}=r);const{appliedPolicies:u}=Bc({drawDefinition:t}),{validSeedBlocks:d,error:l}=Ol({structure:r,drawDefinition:t,appliedPolicies:u});return l&&s.push(l),ot(0,n=n||d.length).forEach((()=>{if(c<n){const n=function({drawDefinition:t,structureId:e,participants:n,matchUpsMap:i,inContextDrawMatchUps:r}){const{unplacedSeedParticipantIds:a,unfilledPositions:o}=kl({drawDefinition:t,structureId:e,randomize:!0}),{appliedPolicies:s}=Bc({drawDefinition:t}),{avoidance:c}=s||{};c&&n&&(null==a||a.length);for(const u of a){const n=o.pop();if(!n)return{error:Ct};const a=jl({drawDefinition:t,structureId:e,drawPosition:n,participantId:u,automaticPlacement:!0,matchUpsMap:i,inContextDrawMatchUps:r});if(!a.success)return a}return pt}({drawDefinition:t,participants:e,structureId:i,matchUpsMap:a,inContextDrawMatchUps:o});n&&n.success&&c++,n.error&&s.push({seedPositionError:n.error})}})),{errors:s}}function Df({inContextDrawMatchUps:t,drawDefinition:e,candidatesCount:n,participants:i,structureId:r,matchUpsMap:a,seedsOnly:o,event:s}){const{structure:c,error:u}=Wc({drawDefinition:e,structureId:r});if(u)return{error:u};const d=[ou,au],l=Du({stageSequence:c.stageSequence,stage:c.stage,drawDefinition:e,entryStatuses:d,structureId:r});if(null==l||!l.length)return pt;const{seedingProfile:p}=c;if(a=a||Gc({drawDefinition:e}),t||({matchUps:t}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:a})),p===Yo){let n=wf({drawDefinition:e,matchUpsMap:a,structure:c,seedsOnly:o,event:s});if(n.error)return n;if(n=Nf({drawDefinition:e,participants:i,structure:c,matchUpsMap:a,inContextDrawMatchUps:t}),n.error)return n}else{let n=Nf({drawDefinition:e,participants:i,structure:c,matchUpsMap:a,inContextDrawMatchUps:t});if(n.error)return n;if(n=wf({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:a,structure:c,seedsOnly:o,event:s}),n.error)return n}const m={};if(!o){let r=gf({candidatesCount:n,drawDefinition:e,participants:i,structure:c,matchUpsMap:a,inContextDrawMatchUps:t});if(r.error)return r;if(r.conflicts&&(m.unseededConflicts=r.conflicts),r=function(t){let{structure:e,structureId:n}=t;if(e||({structure:e}=Wc(t)),n||({structureId:n}=e),e.stage===Vo)return console.log("Consolation Stage: No Qualifiers"),{error:"Consolation Stage: No Qualifiters"};const{positionAssignments:i,unplacedQualifiersCount:r}=Sf(t),a=i.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));return r>a.length?{error:"Insufficient drawPositions to accommodate qualifiers"}:(ot(0,r).forEach((()=>{const t=a.pop();i.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0)}))})),pt)}({drawDefinition:e,participants:i,structure:c,matchUpsMap:a,inContextDrawMatchUps:t}),r.error)return r;r.conflicts&&(m.qualifierConflicts=r.conflicts)}return Ec({drawDefinition:e,structureIds:[r]}),{conflicts:m}}const Pf=({stage:t,structureId:e,matchUps:n=[],structures:i,stageOrder:r,roundLimit:a,roundOffset:o,exitProfile:s,matchUpFormat:c,structureType:u,structureAbbreviation:d,structureName:l,seedingProfile:p,qualifyingRound:m,stageSequence:f=1,seedAssignments:h=[],finishingPosition:I=Es})=>{const v={structureAbbreviation:d,structureName:l,matchUpFormat:c,stageSequence:f,finishingPosition:I,seedAssignments:h,structureId:e||zi()};t&&(v.stage=t),r&&(v.stageOrder=r),a&&(v.roundLimit=a),o&&(v.roundOffset=o),u&&(v.structureType=u),p&&(v.seedingProfile=p),m&&(v.qualifyingRound=m),s&&(v.exitProfile=s);const g=[].concat(...n.map((t=>t.drawPositions))).filter(Boolean);return i?v.structures=i:(v.matchUps=n,v.positionAssignments=X(g).sort(((t,e)=>t-e)).map((t=>({drawPosition:t})))),v};function Tf({qualifyingRound:t,finishingPositionOffset:e,qualifyingPositions:n,matchUpType:i,roundLimit:r,idPrefix:a,drawSize:o,isMock:s,uuids:c}){if(isNaN(o)||!q(o)||o<2)return{matchUps:[],roundsCount:0};const u=ot(1,parseInt(o)+1).map((t=>({drawPosition:t})));let d,l=[],p=1;for(({roundNodes:d,matchUps:l}=Mf({roundNumber:p,matchUpType:i,idPrefix:a,matchUps:l,isMock:s,nodes:u,uuids:c})),p++,r=r||t;d.length>1;)n&&d.length===n&&(r=p-1),({roundNodes:d,matchUps:l}=Mf({nodes:d,roundNumber:p,matchUpType:i,idPrefix:a,matchUps:l,isMock:s,uuids:c})),p++;const m=p-1;return l=Af({finishingPositionOffset:e,roundsCount:m,roundLimit:r,matchUps:l}),r&&(l=l.filter((t=>t.roundNumber<=r))),{matchUps:l,roundsCount:m,roundLimit:r}}function Af({finishingPositionOffset:t=0,positionsFed:e,roundsCount:n,roundLimit:i,matchUps:r,fmlc:a}){const o=r.reduce(((t,e)=>(t[e.roundNumber]=(t[e.roundNumber]||0)+1,t)),{}),s=Object.values(o),c=t=>[Math.min(...t),Math.max(...t)],u=i?n-i:0;return r.forEach((i=>{i.finishingRound=n+1-i.roundNumber-u;const r=a&&1!==i.roundNumber,d=1+t+(r?e:0),l=o[i.roundNumber],p=s.slice(i.roundNumber-1).reduce(((t,e)=>t+e),0),m=ot(d,p+d+1),f=p+1-l,h=c(m.slice(f)),I=c(m.slice(0,f));i.finishingPositionRange={loser:h,winner:I}})),r}function Mf({includeMatchUpType:t,matchUpType:e,roundNumber:n,matchUps:i,idPrefix:r,isMock:a,uuids:o,nodes:s}){let c=0;const u=[];let d=1;const l=n-1,p=s.length;for(;c<p;){const p=s[c],m=s[c+1];l&&(p.roundNumber=l),m&&l&&(m.roundNumber=l);const f={roundPosition:d,children:[p,m],matchUpId:Cf({roundPosition:d,roundNumber:n,idPrefix:r,uuids:o})};u.push(f);const h={matchUpId:f.matchUpId,roundNumber:n,roundPosition:d,matchUpStatus:O,drawPositions:f.children.map((t=>t.drawPosition))};t&&(h.matchUpType=e),a&&(h.isMock=!0),i.push(h),c+=2,d++}return{roundNodes:u,matchUps:i}}function bf({linkFedFinishingRoundNumbers:t=[],linkFedRoundNumbers:e=[],finishingPositionOffset:n,feedRoundsProfile:i=[],feedRounds:r=0,skipRounds:a=0,feedsFromFinal:o,isConsolation:s,baseDrawSize:c,matchUpType:u,idPrefix:d,drawSize:l,isMock:p,uuids:m,fmlc:f}){const h=function({drawSize:t}){return ot(0,Math.ceil(Math.log(t)/Math.log(2))).reverse().map((t=>Math.pow(2,t)))}({drawSize:c=c||function(t){const e=K(t);return e>t?e/2:e}(l)}),I=h.length;let v=0;if(i.length)v=i.reduce(((t,e)=>t+e),0);else if(l){let t=l-c;i=h.filter((e=>e<=t&&(t-=e,!0))),v=i.reduce(((t,e)=>t+e),0),r=i.length}else a>=I&&(r=0),o&&(r=I-o,a=0),i=h.filter(((t,e)=>o&&!r||r&&e>=a+r||e<a?0:t)),v=i.reduce(((t,e)=>t+e),0),l=c+v,r=i.length;const g=[...h,...i].sort(((t,e)=>e-t)),y=g.length,U=[...e.map((t=>t-1)),...t.map((t=>y-t))].map((t=>g[t])).reduce(((t,e)=>t+e),0);v-=U;let w,S=0,N=[],D=1;let P=ot(0,c).map(((t,e)=>({drawPosition:e+1+v}))),T=v+1;for(const M of h){if(({roundNodes:w,matchUps:N}=Mf({roundNumber:D,matchUpType:u,idPrefix:d,matchUps:N,isMock:p,nodes:P,uuids:m})),D++,i.includes(M)){const n=ot(0,et(i)[M]),r=y+1-D,a=t.includes(r)||e.includes(D);for(const t of n){const e=!a&&T||void 0;({roundNodes:w,matchUps:N,drawPosition:T}=Ef({drawPosition:e,nodes:w,roundIteration:t,roundNumber:D,matchUpType:u,idPrefix:d,matchUps:N,uuids:m,fed:S})),D++,S+=1}}P=w}y!==D-1&&console.log("ERROR");N=Af({finishingPositionOffset:s?c-v:n,positionsFed:v,roundsCount:y,matchUps:N,fmlc:f});const A=w&&w.length?w[0]:w;return A&&(A.roundNumber=D-1,A.matchUps=N),{draw:A,matchUps:N,roundsCount:y}}function Ef({includeMatchUpType:t,drawPosition:e,matchUpType:n,roundNumber:i,idPrefix:r,matchUps:a,uuids:o,nodes:s,fed:c}){const u=s.length,d=e?e-u:void 0,l=ot(0,u).map((t=>d?d+t:void 0)),p=[];for(let m=0;m<u;m++){const e=l.shift(),u={feed:!0,fed:c+1,drawPosition:e},d=s[m];d.roundNumber=i-1;const f={roundNumber:i,matchUpId:Cf({roundPosition:d.roundPosition,roundNumber:i,idPrefix:r,uuids:o}),roundPosition:d.roundPosition,drawPositions:[void 0,e]};t&&(f.matchUpType=n),a.push(f);const h={children:[d,u]};p.push(h)}return{roundNodes:p,matchUps:a,drawPosition:e?e-u:void 0}}function Cf({idPrefix:t,roundNumber:e,roundPosition:n,uuids:i}){return t?`${t}-${e}-${n}`:(null==i?void 0:i.pop())||zi()}function Rf({drawDefinition:t,participants:e,matchUpType:n,event:i,structureName:r=Ho,structureAbbreviation:a,structureId:o,automated:s}){const c=Ho;if(!t)return{error:Ut};n=n||t.matchUpType;const u=wu({stage:c,drawDefinition:t}),{matchUps:d}=Tf({matchUpType:n,drawSize:u}),l=Pf({stage:c,matchUps:d,matchUpType:n,structureName:r,structureAbbreviation:a,structureId:o});return t.structures.push(l),s&&Df({structureId:o||l.structureId,drawDefinition:t,participants:e,event:i}),Ec({drawDefinition:t,structureIds:[o]}),{...pt}}function Of({drawDefinition:t,structureId:e,matchUps:n}){var i;if("object"!=typeof t)return{error:Ut};if("string"!=typeof e)return{error:Ht};if(!Array.isArray(n))return{error:_n};const r=null===(i=t.structures)||void 0===i?void 0:i.find((t=>t.structureId===e));if(!r)return{error:Wt};const a=(null==r?void 0:r.matchUps).find((t=>!!t.roundPosition));if(r.structures||a||r.finishingPosition===Es)return{error:Nt};const o=(r.matchUps||[]).map((({drawPositions:t})=>t)).flat().sort(((t,e)=>t-e)),s=Math.max(...o,0)+1,c=ot(s,s+2*n.length),u=dt(c,2);n.forEach(((t,e)=>t.drawPositions=u[e])),r.matchUps.push(...n);const d=c.map((t=>({drawPosition:t})));return r.positionAssignments||(r.positionAssignments=[]),r.positionAssignments.push(...d),Tc({drawDefinition:t,matchUps:n}),Ec({drawDefinition:t,structureIds:[e]}),{...pt}}function xf({drawDefinition:t,structureId:e,addMatchUps:n=!1,matchUpsCount:i=1,matchUpIds:r=[],roundNumber:a,newRound:o}){var s;if("object"!=typeof t)return{error:Ut};if("string"!=typeof e)return{error:Ht};if(!J(i)||!Array.isArray(r))return{error:_n};const c=null==t||null===(s=t.structures)||void 0===s?void 0:s.find((t=>t.structureId===e));let u;const d=(null==c?void 0:c.matchUps).reduce(((t,e)=>(e.roundPosition&&(u=!0),e.roundNumber>t?e.roundNumber:t)),0);if(c.structures||u||c.finishingPosition===Es)return{error:Nt};if(a&&a-1>d)return{error:_n};const l=a||(o?d+1:d||1),p=ot(0,i).map((()=>({matchUpId:r.pop()||zi(),roundNumber:l,matchUpStatus:O,drawPositions:[]})));if(n){const n=Of({drawDefinition:t,structureId:e,matchUps:p});if(n.error)return n}return{matchUps:p,...pt}}function Lf({event:t,drawId:e,drawDefinition:n,drawName:i}){var r;if(!i||"string"!=typeof i)return{error:_n,drawName:i};const{flightProfile:a}=ol({event:t}),o=null==a||null===(r=a.flights)||void 0===r?void 0:r.find((t=>t.drawId===e));if(o){o.drawName=i;Zc({event:t,extension:{name:Vr,value:{...a,flights:a.flights}}})}return n&&(n.drawName=i),o||n?pt:{error:Ut}}function Ff({drawDefinition:t,stage:e,drawSize:n}){if(!t)return{error:Ut};if(!Uu({drawDefinition:t,stage:e}))return{error:ee};if(n<Pu({drawDefinition:t,stage:e})+Su({drawDefinition:t,stage:e}))return{error:"Cannot set drawSize to be less than existing entries"};const{entryProfile:i}=tu({drawDefinition:t,attributes:[{[e]:{drawSize:n}}]});return Ec({drawDefinition:t}),{...pt,entryProfile:i}}function kf({drawDefinition:t,drawSize:e}){if(!t)return{error:Ut};const n=Ff({drawDefinition:t,stage:Ho,drawSize:e});return n.error?n:(Lf({drawDefinition:t}),pt)}function jf({drawDefinition:t,structureId:e}){const{structure:n,error:i}=Wc({drawDefinition:t,structureId:e});if(i)return{error:i};const{matchUps:r}=ju({structure:n});return _c({matchUps:r})}function Bf({drawDefinition:t,structureId:e,finishingPositions:n}){const{roundProfile:i}=jf({drawDefinition:t,structureId:e});return Object.keys(i).reduce(((t,e)=>(_f(i[e]).forEach((i=>{n.forEach((n=>{(function({position:t,rangeDefinition:e}){if(!Array.isArray(e))return!1;if(e.reduce(((t,e)=>t||isNaN(e)),!1))return!1;const[n,i]=e;return ot(n,(i||n)+1).includes(t)})({position:n,rangeDefinition:i})&&(t[n]={roundNumber:e})}))})),t)),{})}function _f(t){var e,n;return[X((null==t||null===(e=t.finishingPositionRange)||void 0===e?void 0:e.loser)||[]),X((null==t||null===(n=t.finishingPositionRange)||void 0===n?void 0:n.winner)||[])]}function Gf({drawDefinition:t}){if(!t)return{error:Ut};return{positionsPlayedOff:(t.structures||[]).filter((t=>t.structureType!==Go)).map((({structureId:e})=>{const{roundProfile:n}=jf({drawDefinition:t,structureId:e});return Object.values(n).map(_f).flat()})).flat().filter((t=>1===t.length)).sort(Ki).flat()}}function Vf({drawDefinition:t,structureId:e,playoffPositions:n=[],excludeRoundNumbers:i=[]}){if(!t)return{error:Ut};if(!e)return{error:Ht};if(!n)return{error:Ee,message:"missing playoffPositions"};const{positionsPlayedOff:r,error:a}=Gf({drawDefinition:t});if(a)return{error:a};const o=Bf({drawDefinition:t,structureId:e,finishingPositions:n.filter((t=>!r.includes(t)))}),s=Object.values(o).reduce(((t,e)=>t.includes(e.roundNumber)?t:t.concat(e.roundNumber)),[]).map((t=>parseInt(t))).filter((t=>!i.includes(parseInt(t)))),c=Bf({drawDefinition:t,structureId:e,finishingPositions:r}),u=Object.values(c).reduce(((t,e)=>t.includes(e.roundNumber)?t:t.concat(e.roundNumber)),[]).map((t=>parseInt(t))),d=s.filter((t=>!u.includes(t))).sort(Ki),{roundProfile:l}=jf({drawDefinition:t,structureId:e}),p=d.map((t=>{const e=l[t].finishingPositionRange.loser,[n,i]=e;return ot(n,(i||n)+1)})).flat().sort(Ki),m=d.map((t=>{const e=l[t].finishingPositionRange.loser,[n,i]=e;return{roundNumber:t,finishingPositions:ot(n,(i||n)+1),finishingPositionRange:e.join("-")}}));return{sourceRounds:[...d,...u],playoffRoundsRanges:m,playoffSourceRounds:d,playedOffSourceRounds:u,playoffPositionsReturned:p}}function Hf({drawDefinition:t,structureId:e}){if(!t)return{error:Ut};let{structures:n}=qc({drawDefinition:t,stage:_o,stageSeqence:1});const i=n&&n[0];if(!i)return{error:Wt};const r=i.positionAssignments||[],a=null==r?void 0:r.map((t=>t.drawPosition)),{positionsPlayedOff:o}=Gf({drawDefinition:t}),s=a.filter((t=>!o.includes(t)));({structures:n}=qc({drawDefinition:t}));const c=n.filter((t=>!e||t.structureId===e)),u={};for(const d of c){const e=null==d?void 0:d.structureId,{playoffSourceRounds:n,playoffRoundsRanges:i,error:r}=Wf({drawDefinition:t,playoffPositions:s,structureId:e});if(r)return{error:r};u[e]={structureId:e,playoffRounds:n,playoffRoundsRanges:i}}return e?{positionsPlayedOff:o,...u[e]}:{positionsPlayedOff:o,availablePlayoffRounds:Object.values(u)}}function Wf({drawDefinition:t,playoffPositions:e,structureId:n}){var i;const{structure:r}=Wc({drawDefinition:t,structureId:n});if(!r)return{error:Wt};if(r.structureType===Jo)return{playoffSourceRounds:[],playoffRoundsRanges:[]};const{links:a}=od({drawDefinition:t,structureId:n});return Vf({drawDefinition:t,structureId:n,playoffPositions:e,excludeRoundNumbers:(null==a||null===(i=a.source)||void 0===i?void 0:i.filter((t=>t.linkCondition!==rs)).map((t=>{var e;return null===(e=t.source)||void 0===e?void 0:e.roundNumber})))||[]})}function qf(t){if(t.matchUpStatus===S){return t.sides.reduce(((t,e)=>e.participantId||t),void 0)}if(!t.winningSide)return;return t.sides.reduce(((e,n)=>n.sideNumber===t.winningSide?n.participantId:e),void 0)}function Kf({tieFormat:t,uuids:e,isMock:n}){const{collectionDefinitions:i}=t||{};return{tieMatchUps:(i||[]).map((t=>{const{matchUpCount:i,matchUpFormat:r,matchUpType:a,collectionId:o}=t||{};return ot(0,i||0).map((t=>({isMock:n,collectionId:o,matchUpType:a,matchUpFormat:r,collectionPosition:t+1,matchUpId:(null==e?void 0:e.pop())||zi(),sides:[{sideNumber:1},{sideNumber:2}]})))})).filter(Boolean).flat()}}function zf(t){const{structure:e,childStructures:n}=Yf(t),i=[e.structureId,...n.map((({structureId:t})=>t))];return t.drawDefinition.structures.sort(Hc),Ec({drawDefinition:t.drawDefinition,structureIds:i}),Object.assign({structure:e,childStructures:n},pt)}function Yf({finishingPositionOffset:t=0,playoffStructureNameBase:e,finishingPositionNaming:n,finishingPositionLimit:i,playoffAttributes:r,stageSequence:a=1,exitProfile:o="0",exitProfileLimit:s,roundOffsetLimit:c,roundOffset:u=0,drawDefinition:d,staggeredEntry:l,sequenceLimit:p,stage:m=_o,matchUpType:f,idPrefix:h,drawSize:I,isMock:v,uuids:g}){if(!(!r||!s||r&&r[o])||I<2||p&&a>p)return{};f=f||(null==d?void 0:d.matchUpType);const y=t+1,U=`${y}-${t+I}`,w=r&&r[o],S=e&&`${e} `||"",N=n&&n[U],D=(null==N?void 0:N.name)||(null==w?void 0:w.name)||`${S}${U}`,P=(null==N?void 0:N.abbreviation)||(null==w?void 0:w.abbreviation),T={idPrefix:h&&`${h}-${D}-RP`,finishingPositionOffset:t,matchUpType:f,drawSize:I,isMock:v,uuids:g},{matchUps:A}=l?bf(T):Tf(T),M=Pf({structureId:null==g?void 0:g.pop(),structureAbbreviation:P,stageSequence:a,structureName:D,matchUpType:f,roundOffset:u,exitProfile:o,matchUps:A,stage:m});d.structures.push(M),Tc({drawDefinition:d,matchUps:A});const b=Math.ceil(Math.log(I)/Math.log(2)),E=ot(1,(c?Math.min(c-u,b):!i||y<i?b:0)+1).map((function(l){const v=I/Math.pow(2,l);if(v<2)return;const y=I/Math.pow(2,l)+t;if(y+1>i)return;const{structure:U,structureName:w,childStructures:S}=Yf({finishingPositionOffset:y,exitProfile:`${o}-${l}`,roundOffset:u+l,stageSequence:a+1,drawSize:v,playoffStructureNameBase:e,finishingPositionNaming:n,finishingPositionLimit:i,playoffAttributes:r,exitProfileLimit:s,roundOffsetLimit:c,drawDefinition:d,sequenceLimit:p,matchUpType:f,idPrefix:h,uuids:g,stage:m}),N={linkType:is,source:{roundNumber:l,structureName:D,structureId:null==M?void 0:M.structureId},target:{roundNumber:1,feedProfile:Xo,structureName:w,structureId:null==U?void 0:U.structureId}};M&&U&&d.links.push(N);return{structure:U,childStructures:S}})).filter(Boolean);return{structure:M,structureName:D,childStructures:E}}function $f(t){var e;const{playoffRoundsRanges:n,playoffRounds:i,error:r}=Hf(t);if(r)return{error:r};const{playoffSourceRounds:a,playoffRoundsRanges:o,playoffPositionsReturned:s,error:c}=Vf(t);if(c)return{error:c};const{structureId:u,playoffStructureNameBase:d,playoffAttributes:l,playoffPositions:p,exitProfileLimit:m,drawDefinition:f,roundProfiles:h,roundNumbers:I,idPrefix:v,isMock:g,event:y,uuids:U}=t,w=(null==h?void 0:h.length)&&Object.assign({},...h),S=I||"object"==typeof h&&h.map((t=>Object.keys(t))).flat(),N=S&&S.map((t=>!isNaN(t)&&parseInt(t))).filter(Boolean);if(N){if(!Array.isArray(N))return{error:_n,validRoundNumbers:N};N.forEach((t=>{if(!i.includes(t))return{error:_n,roundNumber:t}}))}p&&p.forEach((t=>{if(!s.includes(t))return{error:_n,playoffPosition:t}}));const{structure:D}=Wc({structureId:u,drawDefinition:f}),P=N||a,T=N?n:o,A=[],M=[];for(const O of P){const t=T.find((t=>t.roundNumber===O));if(!t)return{error:_n,message:{roundNumber:O}};const e=t.finishingPositions.length,n=Math.min(...t.finishingPositions)-1,i=2,r=w&&w[O]&&i+w[O]-1,{structure:a}=zf({exitProfile:`0-${O}`,playoffStructureNameBase:d,finishingPositionOffset:n,playoffAttributes:l,exitProfileLimit:m,stage:Wo,drawDefinition:f,roundOffset:0,sequenceLimit:r,stageSequence:i,drawSize:e,idPrefix:v,isMock:g,uuids:U});if(a){M.push(a.structureId);const t={linkType:is,source:{structureId:u,roundNumber:O},target:{structureId:a.structureId,feedProfile:Xo,roundNumber:1}};A.push(t)}}f.links=(f.links||[]).concat(...A);const{matchUps:b,matchUpsMap:E}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:f}),C=b.filter((({structureId:t})=>M.includes(t))).map(jc),R=null==E||null===(e=E.drawMatchUps)||void 0===e?void 0:e.filter((({matchUpId:t})=>C.includes(t)));if(R.length){const t=f.tieFormat||(null==y?void 0:y.tieFormat);t&&R.forEach((e=>{const{tieMatchUps:n}=Kf({tieFormat:t,isMock:g});Object.assign(e,{tieMatchUps:n,matchUpType:ma})}))}return b.filter((t=>Ji(t)&&t.structureId===u)).forEach((t=>{const{matchUpId:e,score:n,winningSide:i}=t,r=sd({inContextDrawMatchUps:b,drawDefinition:f,matchUpId:e,structure:D}),a=_l({inContextDrawMatchUps:b,drawDefinition:f,matchUpsMap:E,winningSide:i,targetData:r,matchUpId:e,structure:D,matchUp:t,score:n});a.error&&console.log(a.error)})),t.goesTo&&Td({inContextDrawMatchUps:b,drawDefinition:f,matchUpsMap:E}),Ec({drawDefinition:f,structureIds:M}),{...pt}}function Jf({drawDefinition:t,structureId:e,matchUpIds:n=[]}){var i;if("object"!=typeof t)return{error:Ut};if("string"!=typeof e)return{error:Ht};if(!Array.isArray(n))return{error:_n};const r=null===(i=t.structures)||void 0===i?void 0:i.find((t=>t.structureId===e));if(!r)return{error:Wt};const a=null==r?void 0:r.matchUps,o=a.find((t=>!!t.roundPosition));if(r.structures||o||r.finishingPosition===Es)return{error:Nt};const s=a.filter((({matchUpId:t})=>n.includes(t))),c=xc(s),u=s.map((({drawPositions:t})=>t)).flat();if(u.length){r.positionAssignments=r.positionAssignments.filter((({drawPosition:t})=>!u.includes(t))).sort(((t,e)=>t.drawPosition-e.drawPosition)),r.matchUps=r.matchUps.filter((({matchUpId:t})=>!c.includes(t)));const n=Object.assign({},...r.positionAssignments.map((({drawPosition:t},e)=>({[t]:e+1}))));r.positionAssignments=r.positionAssignments.map((t=>({...t,drawPosition:n[t.drawPosition]})));const i=t=>{var e;return t.drawPositions=(null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>n[t])))||[]};r.matchUps.forEach(i),Ac({drawDefinition:t,matchUpIds:c,action:"deleteAdHocMatchUps"}),Ec({drawDefinition:t,structureIds:[e]})}return{...pt}}function Zf({drawDefinition:t,structureName:e,matchUpType:n,idPrefix:i,drawSize:r,isMock:a,uuids:o}){const{matchUps:s}=bf({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:n,idPrefix:i,isMock:a}),c=Pf({structureName:e||_o,structureId:null==o?void 0:o.pop(),stageSequence:1,stage:_o,matchUpType:n,matchUps:s});t.structures.push(c);const u=r/2,{matchUps:d}=bf({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:n,isMock:a,uuids:o}),l=Pf({matchUps:d,structureId:null==o?void 0:o.pop(),structureName:Ts,stageSequence:2,matchUpType:n,stage:_o});t.structures.push(l);const{matchUps:p}=Tf({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:n,isMock:a}),m=Pf({matchUps:p,structureId:null==o?void 0:o.pop(),structureName:Ps,stageSequence:3,stage:_o,matchUpType:n});t.structures.push(m);const f=function({mainStructure:t,consolationStructure:e,deciderStructure:n}){const i=e.matchUps.reduce(((t,e)=>(e.drawPositions||[]).filter(Boolean).length&&!t.includes(e.roundNumber)?t.concat(e.roundNumber):t),[]),r=t.matchUps.reduce(((t,e)=>!t||e.roundNumber>t?e.roundNumber:t),void 0),a=e.matchUps.reduce(((t,e)=>!t||e.roundNumber>t?e.roundNumber:t),void 0);return[...[1,2].map((n=>{const i=n%2?Xo:ts;return{linkType:is,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:i,roundNumber:1,positionInterleave:{offset:n-1,interleave:1},structureId:e.structureId}}})),...i.slice(1).map(((n,r)=>{const a=i.indexOf(n)%2?Xo:ts;return{linkType:is,source:{roundNumber:3+r,structureId:t.structureId},target:{feedProfile:a,roundNumber:n,structureId:e.structureId}}})),{linkType:ns,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Xo,roundNumber:r,structureId:t.structureId}},{linkType:ns,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Xo,roundNumber:1,structureId:n.structureId}},{linkType:is,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Xo,roundNumber:1,structureId:n.structureId}}]}({mainStructure:c,consolationStructure:l,deciderStructure:m});return t.links=t.links.concat(...f),Object.assign({structures:t.structures,links:t.links},pt)}function Qf({mainStructure:t,consolationStructure:e,roundsCount:n,roundOffset:i=0,feedPolicy:r,fmlc:a}){const o=e.matchUps.reduce(((t,e)=>(e.drawPositions||[]).filter(Boolean).length&&!t.includes(e.roundNumber)?t.concat(e.roundNumber):t),[]),s=(null==r?void 0:r.roundGroupedOrder)||[],c=null==r?void 0:r.roundFeedProfiles;return ot(1+i,n+1+i).map((n=>{const r=c&&c[n-1]?c[n-1]:n%2?Xo:ts,u=n-i<=2?n-i:2*(n-i-2)+2,d={linkType:is,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:r,roundNumber:u,structureId:e.structureId}},l=s[n-1];return l&&(d.target.groupedOrder=l),ei()&&(d.source.structureName=t.structureName,d.target.structureName=e.structureName),2===n&&a&&(d.linkCondition=rs,d.target.feedProfile=Xo),o.includes(u)?d:void 0})).filter(Boolean)}function Xf({finishingPositionOffset:t,structureName:e=_o,stageSequence:n=1,staggeredEntry:i,drawDefinition:r,matchUpType:a,idPrefix:o,isMock:s,uuids:c}){const u=wu({stage:_o,drawDefinition:r}),d={finishingPositionOffset:t,matchUpType:a,drawSize:u,idPrefix:o,isMock:s,uuids:c},{matchUps:l,roundsCount:p}=i?bf(d):Tf(d),m=Pf({matchUps:l,matchUpType:a,stage:_o,structureName:e,stageSequence:n,structureId:null==c?void 0:c.pop()});r.structures.push(m);const f=[0,2].slice(0,u/16).map(((t,e)=>{const n=e+1,{consolationStructure:i}=function({stageSequence:t=1,roundOffset:e=0,matchUpType:n,structureId:i,idPrefix:r,drawSize:a,isMock:o,index:s,uuids:c}){const u=a/(2*Math.pow(2,e)),{matchUps:d,roundsCount:l}=bf({finishingPositionOffset:u,baseDrawSize:u,isConsolation:!0,feedRounds:1,matchUpType:n,idPrefix:r,isMock:o,uuids:c});return{consolationStructure:Pf({matchUps:d,stage:Vo,structureName:`${Vo} ${s+1}`,stageSequence:t,matchUpType:n,structureId:i}),consolationRoundsCount:l}}({structureId:null==c?void 0:c.pop(),idPrefix:o&&`${o}-c${e}`,stageSequence:n,roundOffset:t,matchUpType:a,drawSize:u,isMock:s,index:e,uuids:c});r.structures.push(i);return{consolationStructure:i,links:Qf({mainStructure:m,consolationStructure:i,roundsCount:2,roundOffset:t})}})).map((t=>t.links));if(r.links=r.links.concat(...f),u>=4&&u<=16||u>32){const{matchUps:t}=Tf({finishingPositionOffset:2,idPrefix:o&&`${o}-p3t4`,drawSize:2,matchUpType:a,isMock:s}),e=Pf({structureId:null==c?void 0:c.pop(),matchUps:t,structureName:Wo,stageSequence:2,matchUpType:a,stage:_o}),n={linkType:is,source:{roundNumber:p-1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Xo,structureId:e.structureId}};r.structures.push(e),r.links.push(n)}return Object.assign({structures:r.structures,links:r.links},pt)}function th(t={}){const{uuids:e,feedRounds:n,matchUpType:i,stage:r=_o,structureName:a,drawDefinition:o,feedsFromFinal:s,stageSequence:c=1,finishingPositionOffset:u,staggeredEntry:d,feedPolicy:l,idPrefix:p,isMock:m,fmlc:f}=t,h=wu({stage:r,drawDefinition:o}),I={finishingPositionOffset:u,matchUpType:i,drawSize:h,idPrefix:p,isMock:m,uuids:e},{matchUps:v}=d?bf(I):Tf(I),g=Pf({structureName:a||_o,structureId:null==e?void 0:e.pop(),stageSequence:c,stage:_o,matchUpType:i,matchUps:v});o.structures.push(g);const y=h/2,{matchUps:U,roundsCount:w}=bf({finishingPositionOffset:y,isConsolation:!0,feedsFromFinal:s,baseDrawSize:y,matchUpType:i,feedRounds:n,idPrefix:p&&`${p}-c`,isMock:m,uuids:e,fmlc:f}),S=Pf({matchUpType:i,stageSequence:1,stage:Vo,structureId:null==e?void 0:e.pop(),structureName:Vo,matchUps:U});o.structures.push(S);const N=Qf({mainStructure:g,consolationStructure:S,roundsCount:w,feedPolicy:l,fmlc:f});return o.links=o.links.concat(...N),Object.assign({mainStructure:g,consolationStructure:S,links:o.links},pt)}function eh({stage:t,stageSequence:e,drawDefinition:n}={}){if(!n)return{error:Ut};return{structures:n.structures.filter((function(e){return e.stage===t})).filter((function(t){return!e||t.stageSequence===e}))}}function nh({structureName:t=_o,stageSequence:e=1,structureOptions:n,seedingProfile:i,drawDefinition:r,stage:a=_o,matchUpType:o,idPrefix:s,uuids:c}){const u=bs,d=wu({stage:a,drawDefinition:r}),{groupCount:l,groupSize:p}=function({structureOptions:t,drawSize:e}){let n=null==t?void 0:t.groupSize;const i=(null==t?void 0:t.groupSizeLimit)||8,r=function({drawSize:t,groupSizeLimit:e=10}){return ot(3,e+1).filter((e=>Math.ceil(t/e)*e-t<e))}({drawSize:e,groupSizeLimit:i}),a=Math.max(...r);n&&r.includes(n)||(n=n&&n>4||!r.includes(4)?a:4);const o=Math.ceil(e/n);return{groupSize:n,groupCount:o}}({structureOptions:n,drawSize:d}),m=ot(1,l+1).map((t=>Pf({structureName:`Group ${t}`,matchUps:rh({groupSize:p,structureOrder:t,matchUpType:o,idPrefix:s}),structureId:null==c?void 0:c.pop(),structureType:$o,finishingPosition:u,structureOrder:t,matchUpType:o}))),f=Pf({structureId:null==c?void 0:c.pop(),structureType:Jo,finishingPosition:u,seedingProfile:i,structureName:t,stageSequence:e,matchUpType:o,structures:m,stage:a});return r.structures.push(f),Object.assign({structure:f,groupCount:l,groupSize:p},pt)}function ih({finishingPositions:t,playoffStructure:e,mainStructure:n}){return{linkType:es,source:{finishingPositions:t,structureId:n.structureId},target:{roundNumber:1,feedProfile:Zo,structureId:e.structureId}}}function rh({structureOrder:t,matchUpType:e,groupSize:n,idPrefix:i,uuids:r}){const a=(t-1)*n,o=ot(1+a,n+1+a),{uniqueMatchUpGroupings:s}=lf({drawPositions:o}),c=function({groupSize:t,drawPositionOffset:e}){const n=t=>[...Array(t)].map(((t,e)=>e)),i=n(2*Math.round(t/2)+1).slice(1),r=n(i.length-1).map((()=>[]));let a=i.slice(0,i.length/2),o=i.slice(i.length/2);i.slice(1).forEach(((t,e)=>{a.forEach(((t,n)=>{r[e].push([a[n],o[n]])}));const n=a.shift(),i=a.pop(),s=o.shift();a=[].concat(n,s,...a),o=[].concat(...o,i)}));const s=a.shift(),c=a.pop(),u=o.shift();a=[].concat(s,u,...a),o=[].concat(...o,c);const d=t=>t[0].reduce(((t,e)=>t+e));return r.reverse().sort(((t,e)=>d(t)-d(e))).map((n=>n.filter((e=>e.every((e=>e<=t)))).map((t=>pf(t.map((t=>t+e)))))))}({groupSize:n,drawPositionOffset:a});return s.map((function(n){const a=function(t){return c.reduce(((e,n,i)=>n.includes(t)?i+1:e),void 0)}(pf(n)),o=u(n.slice(1)),s=u(n.slice(0,n.length-1)),d=function({structureOrder:t,drawPositions:e,roundNumber:n,idPrefix:i,uuids:r}){return i?`${i}-${t}-${n}-DP-${e.join("-")}`:(null==r?void 0:r.pop())||zi()}({structureOrder:t,drawPositions:n,roundNumber:a,idPrefix:i,uuids:r});return{matchUpStatus:a?O:S,matchUpType:e,finishingPositionRange:{winner:s,loser:o},drawPositions:n,roundNumber:a,matchUpId:d}})).sort(((t,e)=>(t.roundNumber||9999)-(e.roundNumber||9999)));function u(t){return[Math.min(...t),Math.max(...t)]}}function ah(t={}){const{drawType:e=us,stageSequence:n=1,drawDefinition:i,staggeredEntry:r,structureName:a,goesTo:o=!0,stage:s=_o,isMock:c,uuids:u}=t;if(!i)return{error:Ut};let{tieFormat:d,matchUpType:l}=t;d=d||i.tieFormat,l=l||i.matchUpType||la;const p=wu({stage:s,drawDefinition:i});Object.assign(t,{drawSize:p,matchUpType:l,tieFormat:d});const m=q(2*p/3);if(p<2||!r&&![os,as].includes(e)&&(e===Ns&&p<3||e===ds&&!m||![Ns,ds,Ds].includes(e)&&!q(p)))return{error:Rt,drawSize:p};const f=Cs.includes(e);if(parseInt(p)<4&&f)return{error:Rt};const h=1===n?1:void 0,{structures:I}=eh({drawDefinition:i,stageSequence:n,stage:s});if(I.length>=h)return{error:ne};const v={[as]:()=>{const t=Pf({structureName:a||s,finishingPosition:bs,structureId:null==u?void 0:u.pop(),stageSequence:n,matchUps:[],matchUpType:l,stage:s});return i.structures.push(t),Object.assign({structure:t},pt)},[us]:()=>{const{matchUps:e,roundLimit:r}=Tf(t),o=s===Go&&r,c=Pf({structureName:a||s,roundLimit:r,structureId:null==u?void 0:u.pop(),qualifyingRound:o,stageSequence:n,matchUpType:l,matchUps:e,stage:s});return i.structures.push(c),Object.assign({structure:c},pt)},[ds]:()=>Zf(t),[ss]:()=>zf(Object.assign(t,{roundOffsetLimit:3,playoffAttributes:As})),[cs]:()=>zf(Object.assign(t,{roundOffsetLimit:2,playoffAttributes:Ms})),[Wo]:()=>zf(t),[os]:()=>{const{matchUps:t}=bf({drawSize:p,uuids:u,matchUpType:l}),e=Pf({structureName:a||s,structureId:null==u?void 0:u.pop(),stageSequence:n,matchUpType:l,matchUps:t,stage:s});return i.structures.push(e),Object.assign({structure:e},pt)},[ps]:()=>function(t){let{drawSize:e,consolationStructureName:n}=t;const{finishingPositionOffset:i=0,stageSequence:r=1,drawDefinition:a,staggeredEntry:o,structureName:s,stage:c=_o,matchUpType:u,idPrefix:d,isMock:l,uuids:p}=t;e=e||wu({stage:c,drawDefinition:a});const m={finishingPositionOffset:i,matchUpType:u,drawSize:e,idPrefix:d,isMock:l,uuids:p},{matchUps:f}=o?bf(m):Tf(m),h=Pf({stage:c,matchUps:f,matchUpType:u,stageSequence:r,structureId:null==p?void 0:p.pop(),structureName:s||_o});a&&a.structures.push(h);const I=e/2,{matchUps:v}=Tf({finishingPositionOffset:i+I,drawSize:I,idPrefix:d&&`${d}-c`,matchUpType:u,isMock:l});n=n||(s?`${s} ${Vo}`:Vo);const g=Pf({matchUpType:u,stageSequence:1,stage:Vo,structureId:null==p?void 0:p.pop(),matchUps:v,structureName:n});a&&a.structures.push(g);const y={linkType:is,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:Xo,structureId:g.structureId}};return a&&a.links.push(y),Object.assign({link:y,mainStructure:h,consolationStructure:g,links:null==a?void 0:a.links},pt)}(t),[ls]:()=>th(Object.assign(t,{feedRounds:1,fmlc:!0})),[Us]:()=>th(Object.assign(t,{feedRounds:1})),[Is]:()=>th(Object.assign(t,{feedsFromFinal:2})),[fs]:()=>th(Object.assign(t,{feedsFromFinal:1})),[gs]:()=>th(Object.assign(t,{feedsFromFinal:3})),[Ss]:()=>th(t),[ms]:()=>Xf(t),[Ns]:()=>nh(t),[Ds]:()=>function(t){const{playoffMatchUpFormat:e,stageSequence:n=1,structureOptions:i,drawDefinition:r,matchUpType:a,idPrefix:o,uuids:s}=t,c=Object.assign({structureName:_o},t,{stage:_o}),{structure:u,groupCount:d,groupSize:l}=nh(c);d<1&&console.log(jn);const p=i&&i.playoffGroups||[{finishingPositions:[1],structureName:Wo}];let m=0;const f=p.map(((t,i)=>{const c=i+1,p=ot(1,l+1),f=t.finishingPositions;if(!f.reduce(((t,e)=>p.includes(e)&&t),!0))return;const h=t.drawType||us,I=d*f.length,v=Y(I);if(h===us){const{matchUps:i}=Tf({idPrefix:o&&`${o}-po`,finishingPositionOffset:m,matchUpType:a,drawSize:v}),d=Pf({matchUps:i,stageOrder:c,matchUpType:a,stageSequence:n,stage:Wo,structureId:null==s?void 0:s.pop(),structureName:t.structureName,matchUpFormat:e});r.structures.push(d);const l=ih({mainStructure:u,playoffStructure:d,finishingPositions:f});return r.links.push(l),m+=I,d}if(h===ls){console.log("RRw/PO FIRST_MATCH_LOSER_CONSOLATION");const e=[null==s?void 0:s.pop(),null==s?void 0:s.pop()],{mainStructure:n,consolationStructure:i,link:c}=th({structureName:t.structureName,idPrefix:o&&`${o}-po`,finishingPositionOffset:m,uuids:e,stage:Wo,feedRounds:1,matchUpType:a,fmlc:!0,drawSize:v}),d=ih({mainStructure:u,playoffStructure:n,finishingPositions:f});return r.links.push(d),r.structures.push(n),r.structures.push(i),r.links.push(c),m+=I,n}})).filter(Boolean);return Object.assign({mainStructure:u,playoffStructures:f,links:r.links},pt)}(t)}[e],g=v&&v();if(null==g||!g.success)return{error:At};const{matchUps:y,matchUpsMap:U}=pd({drawDefinition:i});let w;d&&y.forEach((t=>{const{tieMatchUps:e}=Kf({tieFormat:d,isMock:c});Object.assign(t,{tieMatchUps:e,matchUpType:l})})),o&&({inContextDrawMatchUps:w}=Td({drawDefinition:i,matchUpsMap:U}));const S={...pt,matchUps:y};return Object.assign(S,g,{inContextDrawMatchUps:w,matchUpsMap:U}),Ec({drawDefinition:i}),S}function oh({drawDefinition:t,structureId:e}){var n;if(!t)return{error:Ut};if(!e)return{error:Ht};const i=[],r=[e],a=e=>{var n;return null===(n=t.links)||void 0===n?void 0:n.map((t=>t.source.structureId===e&&t.target.structureId)).filter(Boolean)},o=(null===(n=t.structures)||void 0===n?void 0:n.map((({structureId:t})=>t)))||[],s=Object.assign({},...o.map((t=>({[t]:a(t)}))));for(;r.length;){var c;const e=r.pop(),{structure:n}=Wc({drawDefinition:t,structureId:e}),{matchUps:a}=ju({structure:n}),o=xc(a);i.push(...o),t.links=(null===(c=t.links)||void 0===c?void 0:c.filter((t=>t.source.structureId!==e&&t.target.structureId!==e)))||[],t.structures=(t.structures||[]).filter((t=>t.structureId!==e));const u=s[e];null!=u&&u.length&&r.push(...u)}const{matchUps:u}=pd({drawDefinition:t});return u.forEach((t=>{i.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,i.includes(t.loserMatchUpId)&&delete t.loserMatchUpId})),Ac({drawDefinition:t,matchUpIds:i,action:"removeStructure"}),Ec({drawDefinition:t}),{...pt,removedMatchUpIds:i}}const sh={getSourceRounds:Vf,getDrawStructures:eh,getPositionsPlayedOff:Gf,getStructureQualifiersCount:function({drawDefinition:t,structure:e,structureId:n}){let i,r;if(e||({structure:e,error:i}=Wc({drawDefinition:t,structureId:n})),!i)if(e.stage!==Go)i="Structure is not Qualifying";else{const{matchUps:n}=ju({drawDefinition:t,structure:e});r=n.reduce(((t,e)=>t+(1===e.finishingRound?1:0)),0)}return{qualifiersCount:r,error:i}},getAvailablePlayoffRounds:Hf,addPlayoffStructures:$f,removeStructure:oh,addAdHocMatchUps:Of,generateAdHocMatchUps:xf,deleteAdHocMatchUps:Jf,structureSort:Hc,generateDrawType:ah,addVoluntaryConsolationStage:kf,generateVoluntaryConsolationStructure:Rf,buildDrawHierarchy:function({matchUps:t,matchUpType:e}){var n;if(!t)return{error:Ie};let i=0,r=[],a=[];e&&(t=t.filter((t=>t.matchUpType===e)));const o=X(t.map((({matchUpType:t})=>t)));if(o.length>1)if(o.includes(ma))t=t.filter((t=>t.matchUpType===ma));else if(o.includes(la))t=t.filter((t=>t.matchUpType===la));else{if(!o.includes(pa))return{};t=t.filter((t=>t.matchUpType===pa))}if(!Array.isArray(t)||!t.length)return{};const s=(t,e)=>parseInt(t)-parseInt(e),c=X(t.map((t=>t.drawPositions)).flat().filter(Boolean)).sort(s),u=ot(1,Math.max(...c)+1).filter((t=>!c.includes(t))).sort(s),{roundMatchUps:d}=_c({matchUps:t}),l=d[1],p=d[2]||[],[m]=l||[{}],f=m.drawId,h=m.structureId,I=Math.max(...Object.keys(d)),v=(null===(n=d[I])||void 0===n?void 0:n.length)||0,g=Math.ceil(Math.log(v)/Math.log(2)),y=ot(1,g+1).map((t=>{const e=Math.pow(2,t-1),n=I+g-t+1;return ot(1,e+1).map((e=>({drawId:f,structureId:h,matchUpId:zi(),drawPositions:[],sides:[],roundNumber:n,roundPosition:e,finishingRound:t})))}));g&&(t=t.concat(...y.flat()));const U=l.map((t=>t.drawPositions)).flat(1/0),w=p.map((t=>t.drawPositions)).flat(1/0).filter((t=>!U.includes(t))).sort(s),S=p.filter((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.reduce(((t,e)=>w.includes(e)||t),void 0)})).map((t=>{var e,n;const i=null===(e=t.drawPositions)||void 0===e?void 0:e.reduce(((t,e)=>w.includes(e)?e:t),void 0),r=null===(n=t.drawPositions)||void 0===n?void 0:n.indexOf(i);return{[i]:t.sides[r]}}));if(null!=u&&u.length&&(null==w?void 0:w.length)===(null==u?void 0:u.length)){const e=w.map(((t,e)=>[t,u[e]].sort(s))),n=Object.assign({},...S),i=Hi(l[0].finishingRound,!1,!0),r=Hi(l[0].finishingPositionRange);a=e.map(((t,e)=>{const a=Math.max(...t||[])/2;return{sides:null==t?void 0:t.map((t=>n[t]||{bye:!0,drawPosition:t})),drawId:f,structureId:h,roundPosition:a,drawPositions:t,roundNumber:1,finishingRound:i,matchUpId:zi(),matchUpStatus:"BYE",sideNumber:e+1,finishingPositionRange:r}})),t=t.concat(...a)}const N=I+g;return ot(1,N+1).forEach((e=>{var n,a;const o=[],s=D({matchUps:t,roundNumber:e}),c=D({matchUps:t,roundNumber:e-1}).map(qf).filter(Boolean),u=(null==s?void 0:s.length)===(null===(n=r)||void 0===n?void 0:n.length),d=(null==s?void 0:s.length)===(null===(a=r)||void 0===a?void 0:a.length)/2;1===e&&s.forEach((t=>{const e=t.drawPositions||[],{matchUpId:n,structureId:i}=t,r=[{...t.sides[0],drawPosition:e[0],matchUpId:n,structureId:i},{...t.sides[1],drawPosition:e[1],matchUpId:n,structureId:i}],a={...t,children:r};o.push(a)})),u?(i++,s.forEach(((t,e)=>{const n=t.drawPositions||[],{matchUpId:a,structureId:s}=t,u=n.filter(Boolean).reduce(((t,e)=>U.includes(e)?t:e),void 0),d=[{...t.sides.filter(Boolean).reduce(((t,e)=>e.participantId&&!c.includes(e.participantId)?e:t),void 0),drawPosition:u,feedRoundNumber:i,sides:t.sides,matchUpId:a,structureId:s},r[e]],l={...t,children:d};o.push(l)}))):d&&s.forEach(((t,e)=>{const n={...t,children:[r[2*e],r[2*e+1]]};o.push(n)})),r=o})),{hierarchy:r[0],missingMatchUps:a,maxRound:I,finalRound:N,matchUps:t};function D({matchUps:t,roundNumber:e}){return t.filter((t=>t.roundNumber===e)).sort(((t,e)=>t.roundPosition-e.roundPosition))}}};function ch({participantCount:t}){if(isNaN(t))return{error:_n};return{drawSize:[0,2,4,8,16,32,64,128,256,512,1024].find((e=>e>=t))||0}}function uh({tournamentRecord:t,drawDefinition:e,event:n,requireParticipantCount:i=!0,drawSizeProgression:r=!1,policyDefinitions:a,participantCount:o,drawSize:s}={}){if(!a){const i=il({tournamentRecord:t,drawDefinition:e,event:n});if(i.error)return i;a=i.policyDefinitions}if(o&&isNaN(o))return{error:_n};if(i&&isNaN(o))return{error:en};if(!s){if(!o)return{error:Ot};({drawSize:s}=ch({participantCount:o}))}if((i&&o||s)>s)return{error:un};const c=a.seeding;if(!c)return{error:Ne};const u=c.seedsCountThresholds;if(!u)return{error:kt};void 0!==c.drawSizeProgression&&(r=c.drawSizeProgression);return{seedsCount:u.filter((t=>r?t.drawSize<=s:s===t.drawSize)).reduce(((t,e)=>o>=e.minimumParticipantCount?e.seedsCount:t),0)}}function dh({tournamentRecord:t,drawDefinition:e,event:n,requireParticipantCount:i=!0,enforcePolicyLimits:r=!0,drawSizeProgression:a,participantCount:o,structureId:s,seedsCount:c}){const{structure:u,error:d}=Wc({drawDefinition:e,structureId:s});if(d)return{error:d};const{positionAssignments:l}=Ru({structure:u}),p=l.length;if(c>p)return{error:Ft};const{policyDefinitions:m}=il({policyTypes:[cr],tournamentRecord:t,drawDefinition:e,event:n}),{seedsCount:f}=uh({requireParticipantCount:i,drawSizeProgression:a,policyDefinitions:m,participantCount:o,drawSize:p});return m&&f&&c>f&&r&&(c=f),u.seedLimit=c,u.seedAssignments=ot(1,c+1).map((t=>({seedNumber:t,seedValue:t,participantId:void 0}))),Ec({drawDefinition:e,structureIds:[s]}),{...pt,seedLimit:c}}function lh({participantPreferences:t,drawPositionResolutions:e={}}){const n=Object.keys(t).reduce(((e,n)=>{const i=t[n].preferences[0];return i&&(e[i]||(e[i]=[]),e[i].push(n)),e}),{}),i=Math.min(...Object.values(n).filter((t=>t.length)).map((t=>t.length))),r=Object.keys(n).filter((t=>n[t].length&&i&&n[t].length===i));let a;return r.forEach((i=>{const r=rt(n[i]);e[i]=r,delete t[r]})),Object.values(t).forEach((t=>{t.preferences=t.preferences.filter((t=>{const e=!r.includes(t.toString());return e&&(a=!0),e}))})),{drawPositionResolutions:e,remainingPreferences:a,participantPreferences:t}}function ph(t){const{participantIdAttributeName:e="participantId",positionActionName:n,drawDefinition:i,participantId:r,drawPosition:a,structureId:o}=t;if(!i)return{error:Ut};let{inContextDrawMatchUps:s,matchUpsMap:c}=t;c||(c=Gc({drawDefinition:i}),Object.assign(t,{matchUpsMap:c})),s||(({matchUps:s}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:c})),Object.assign(t,{inContextDrawMatchUps:s}));const{positionAssignments:u}=Cu({drawDefinition:i,structureId:o}),d=u.find((t=>t.drawPosition===a));if(null!=d&&d.participantId){let t=jl({inContextDrawMatchUps:s,drawDefinition:i,participantId:r,drawPosition:a,structureId:o,matchUpsMap:c});return t.success||console.log({result:t}),m({removedParticipantId:d.participantId})}let l=el({inContextDrawMatchUps:s,drawDefinition:i,drawPosition:a,structureId:o,matchUpsMap:c});if(l.error)return l;const p=l.participantId;return l=jl({inContextDrawMatchUps:s,drawDefinition:i,participantId:r,drawPosition:a,structureId:o,matchUpsMap:c}),l.success?m({removedParticipantId:p}):l;function m({removedParticipantId:t}){const{structure:s}=Wc({drawDefinition:i,structureId:o});El({drawPositions:[a],structure:s});return Cl({drawDefinition:i,positionAction:{[e]:r,name:n,drawPosition:a,structureId:o}}),{...pt,removedParticipantId:t}}}function mh({alternateParticipantId:t,drawDefinition:e,drawPosition:n,structureId:i}){return ph({participantId:t,drawDefinition:e,drawPosition:n,structureId:i,participantIdAttributeName:"alternateParticipantid",positionActionName:"alternateDrawPositionAssignment"})}function fh({drawDefinition:t,stages:e}){return((null==t?void 0:t.structures)||[]).filter((t=>!(null!=e&&e.length)||e.includes(t.stage))).map((t=>{const{positionAssignments:e}=Cu({structure:t});return Lc(e)})).flat()}function hh({entries:t=[]}={}){const e=t.reduce(((t,e)=>{const{entryStage:n,entryStatus:i}=e,r=`_${n||_o}${i||""}`;return t[r]||(t[r]=[]),t[r].push(e),t}),{}),n=t=>isNaN(t)?9999:t;return Object.keys(e).map((t=>e[t].sort(((t,e)=>n(t.entryPosition)-n(e.entryPosition))).map(((t,e)=>{const n=e;return Object.assign(t,{entryPosition:n})})))).flat()}function Ih(t){return[lu,pu].includes(t)}function vh({autoEntryPositions:t=!0,tournamentRecord:e,drawDefinition:n,participantIds:i,entryStatus:r,eventSync:a,drawId:o,stage:s,event:c}){var u,d,l,p,m,f,h,I,v,g;if(!i||!Array.isArray(i))return{error:We,method:"modifyEntriesStatus",participantIds:i};if(!Iu.includes(r))return{error:ln};if(!n&&!c)return{error:Yt};const y=[];null===(u=c.drawDefinitions)||void 0===u||u.forEach((t=>{const e=fh({drawDefinition:t});y.push(...e)}));const U=(null==e?void 0:e.participants)||[];if(!i.every((t=>{const{participantType:e}=ra({tournamentParticipants:U,participantId:t});return!(e===ka&&Ih(r))})))return{error:ln};const{flightProfile:w}=ol({event:c}),S=null==w||null===(d=w.flights)||void 0===d?void 0:d.find((t=>t.drawId===o)),N=(t=[])=>{const e=t.filter((t=>!s||!t.entryStage||s===t.entryStage)).filter((({participantId:t})=>i.includes(t)));return e.every((t=>!(t=>y.includes(t.participantId)&&!(mu.includes(t.entryStatus)&&mu.includes(r)))(t)&&(t.entryStatus=r,delete t.entryPosition,!0)))?pt:{error:an}},D=({flight:t,drawDefinition:e})=>{c.entries=hh({entries:c.entries||[]}),t&&(t.drawEntries=hh({entries:t.drawEntries})),e&&(e.entries=hh({entries:e.entries}))},P=({flight:t,drawDefinition:e})=>{if(t){const e=N(t.drawEntries);if(e.error)return e}if(e){const t=N(e.entries);if(t.error)return t}return{...pt}},T=(null===(l=c.entries)||void 0===l?void 0:l.find((({entryPosition:t})=>!isNaN(t))))||(null==S||null===(p=S.drawEntries)||void 0===p?void 0:p.find((({entryPosition:t})=>!isNaN(t))))||(null==n||null===(m=n.entries)||void 0===m?void 0:m.find((({entryPosition:t})=>!isNaN(t))));if(t&&!T&&D({flight:S,drawDefinition:n}),S||n){const t=P({flight:S,drawDefinition:n});if(t.error)return t}const A=(null===(f=c.drawDefinitions)||void 0===f?void 0:f.map((({drawId:t})=>t)))||[],M=(null==w||null===(h=w.flights)||void 0===h?void 0:h.filter((t=>!A.includes(t.drawId))))||[];for(const R of M){const t=P({flight:R});if(t.error)return t}const b=1===(null==w||null===(I=w.flights)||void 0===I?void 0:I.length)&&(null===(v=c.drawDefinitions)||void 0===v?void 0:v.length)<=(null==w||null===(g=w.flights)||void 0===g?void 0:g.length);if(!S&&!n&&fu.includes(r))return{error:fn};if(!S&&!n||r===du||a&&b){const t=N(c.entries);if(t.error)return t;let e;var E,C;if(r===du)null==w||null===(E=w.flights)||void 0===E||E.every((t=>{const n=N(t.drawEntries);return n.error?(e=n.error,!1):(t.drawEntries=t.drawEntries.filter((({participantId:t})=>!i.includes(t))),!0)})),null===(C=c.drawDefinitions)||void 0===C||C.every((t=>{const n=N(t.entries);return n.error?(e=n.error,!1):(t.entries=t.entries.filter((({participantId:t})=>!i.includes(t))),!0)}));if(e)return{error:e}}return t&&D({flight:S,drawDefinition:n}),pt}function gh({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:n}){if(!t)return{error:It};if(!e||!n)return{error:Ee};const i=(t.participants||[]).find((t=>t.participantId===e));if(!i)return{error:Ze};if(![Fa,ja].includes(i.participantType))return{error:Ke,participantType:i.participantType};const{removed:r,error:a}=yh({groupingParticipant:i,individualParticipantIds:n});return a?{error:a}:(r&&ri({topic:wc,payload:{participants:[i]}}),{...pt,removed:r})}function yh({groupingParticipant:t,individualParticipantIds:e=[]}){let n=0,i=[];return t?(t.individualParticipantIds||(t.individualParticipantIds=[]),t.individualParticipantIds=t.individualParticipantIds.filter((t=>{const i=null==e?void 0:e.includes(t);return i&&n++,!i})),i.length?{error:"Participants not removed",notRemoved:i}:{groupingParticipant:t,removed:n}):{removed:n}}function Uh({groupingType:t=Fa,participantRole:e=Dm,tournamentRecord:n,individualParticipantIds:i=[]}){if(!n)return{error:It};const r=n.participants||[];let a=0;return r.filter((n=>(n.participantRole===e||!n.participantRole)&&n.participantType===t)).forEach((t=>{const{removed:e}=yh({groupingParticipant:t,individualParticipantIds:i});e&&a++})),a?pt:{error:Xe}}function wh({teamDrawIds:t=[],tournamentRecord:e,participantIds:n}){var i;if(!e)return{error:It};if(null==n||!n.length)return{error:tn};const r=(null===(i=e.participants)||void 0===i?void 0:i.length)||0;if(!r)return pt;const{tournamentParticipants:a}=bp({participantFilters:{participantIds:n},withStatistics:!0,tournamentRecord:e}),o=t.length&&(()=>{const{matchUps:i}=fd({tournamentRecord:e,matchUpFilters:{drawIds:t,matchUpTypes:[pa]}});return ct(i.map((({sides:t})=>t.map((({participantId:t})=>t)))).flat().filter(Boolean),n)})(),s=a.filter((e=>{var n;return null===(n=e.draws)||void 0===n?void 0:n.filter((({drawId:e})=>!t.length||!t.includes(e))).length}));if(o.length||s.length)return{error:an};e.participants=e.participants.filter((t=>!n.includes(t.participantId)));const c=r-e.participants.length;return Uh({tournamentRecord:e,individualParticipantIds:n}),c&&ri({topic:Ic,payload:{participantIds:n}}),c?pt:{error:Ge}}function Sh({selected:t=!0,drawDefinition:e,entryStatuses:n,drawId:i,event:r,stage:a}){let o=r.entries||[];if(i){var s;const{flightProfile:t}=ol({event:r}),n=null==t||null===(s=t.flights)||void 0===s?void 0:s.find((t=>t.drawId===i));o=n?n.drawEntries:null==e?void 0:e.entries}const c=o.filter((e=>(!(null!=n&&n.length)||!e.entryStatus||n.includes(e.entryStatus))&&(!a||!e.entryStage||e.entryStage===a)&&(!t||hu.includes(e.entryStatus))));return{entries:o,stageEntries:c}}function Nh({autoEntryPositions:t=!0,tournamentRecord:e,participantIds:n,event:i}){var r,a,o,s;if(null==i||!i.eventId)return{error:Yt};if(!Array.isArray(n))return{error:tn};if(null===(a=n=null===(r=n)||void 0===r?void 0:r.filter(Boolean))||void 0===a||!a.length)return{error:tn};const{eventId:c}=i,{tournamentParticipants:u}=bp({participantFilters:{participantIds:n},withStatistics:!0,tournamentRecord:e});if(null==u?void 0:u.every((t=>{var e;const n=t.events.find((t=>t.eventId===c));return null==n||null===(e=n.drawIds)||void 0===e?void 0:e.length})))return{error:sn};i.entries=(i.entries||[]).filter((t=>!n.includes(null==t?void 0:t.participantId))),t&&(i.entries=hh({entries:i.entries}));const{flightProfile:d}=ol({event:i});return null==d||null===(o=d.flights)||void 0===o||o.forEach((t=>{t.drawEntries=(t.drawEntries||[]).filter((t=>!n.includes(t.participantId)))})),null===(s=i.drawDefinitions)||void 0===s||s.forEach((t=>{t.entries=(t.entries||[]).filter((t=>!n.includes(t.participantId)))})),pt}function Dh({participantId:t,drawDefinition:e,entryStatus:n,entryStage:i}){var r;if(!e)return{error:Ut};const a=null===(r=e.entries)||void 0===r?void 0:r.find((e=>!(e.participantId!==t||n&&n!==e.entryStatus||i&&i!==e.entryStage)));return t&&a}function Ph({entryStatus:t=ou,entryStage:e=_o,entryPosition:n,drawDefinition:i,participantId:r,participant:a}){if(!i)return{error:Ut};if(!e)return{error:te};if(!yu({stage:e,drawDefinition:i}))return{error:ee};const o=Au({stage:e,drawDefinition:i,entryStatus:t});if(!o.success)return{error:o.error};if(!(r=r||a&&a.participantId))return{error:Je};const s=t===cu&&Dh({participantId:r,drawDefinition:i,entryStatus:t}),c=e===Ho&&Dh({participantId:r,drawDefinition:i,entryStage:e});if(t!==cu&&e!==Ho&&Dh({drawDefinition:i,participantId:r})||s||c)return{error:cn};const u=Wi({...a,participantId:r,entryStage:e,entryStatus:t,entryPosition:n});return i.entries.push(u),Ec({drawDefinition:i}),{...pt}}function Th({entryStatus:t=ou,autoEntryPositions:e=!0,drawDefinition:n,participantIds:i,stage:r=_o}){if(!r)return{error:te};if(!n)return{error:Ut};if(!Array.isArray(i))return{error:qe};if(!yu({stage:r,drawDefinition:n}))return{error:ee};const a=Au({stage:r,drawDefinition:n,entryStatus:t});if(!a.success)return{error:a.error};if((a.positionsAvailable||0)<i.length)return{error:dn};const o=i.reduce(((e,i)=>{const a=t===cu&&Dh({participantId:i,drawDefinition:n,entryStatus:t}),o=r===Ho&&Dh({participantId:i,drawDefinition:n,entryStage:r});return t!==cu&&r!==Ho&&Dh({drawDefinition:n,participantId:i})||a||o?e.concat({participantId:i,error:cn}):e}),[]);return o.length?{error:Qt,invalidParticipantIds:o}:(i.forEach((e=>{const i=Object.assign({participantId:e},{entryStage:r,entryStatus:t});n.entries.push(i)})),e&&(n.entries=hh({entries:n.entries})),Ec({drawDefinition:n}),{...pt})}function Ah({autoEntryPositions:t=!0,drawDefinition:e,participantIds:n,entryStatus:i,entryStage:r,drawId:a,event:o}){if(!a)return{error:xt};if(!o)return{error:$t};const s=(o.entries||[]).map(Fc);if(n.filter((t=>!s.includes(t))).length)return{error:Zt};if(e){const a=Th({drawDefinition:e,participantIds:n,entryStatus:i,stage:r,autoEntryPositions:t});if(a.error)return a}const{flightProfile:c}=ol({event:o}),u=null==c?void 0:c.flights.find((t=>t.drawId===a));return null!=u&&u.drawEntries&&(n.forEach((t=>{const e=i===cu&&Mh({participantId:t,entryStatus:i,flight:u}),n=r===Ho&&Mh({participantId:t,entryStage:r,flight:u});i!==cu&&r!==Ho&&Mh({flight:u,participantId:t})||e||n||u.drawEntries.push({participantId:t,entryStatus:i,entryStage:r})})),t&&(u.drawEntries=hh({entries:u.drawEntries}))),pt}function Mh({participantId:t,entryStatus:e,entryStage:n,flight:i}){var r;const a=null===(r=i.drawEntries)||void 0===r?void 0:r.find((i=>!(i.participantId!==t||e&&e!==i.entryStatus||n&&n!==i.entryStage)));return t&&a}function bh(t){var e;const{tournamentRecord:n,drawDefinition:i,drawId:r,event:a,participantIds:o=[],entryStatus:s=ou,entryStage:c=_o,autoEntryPositions:u=!0}=t;if(!a)return{error:Yt};if(!o||!o.length)return{error:tn};if(!a||!a.eventId)return{error:$t};const d=(null==n||null===(e=n.participants)||void 0===e?void 0:e.filter((t=>a.eventType===la&&t.participantType===La||(a.eventType===pa&&t.participantType===ka||(!(a.eventType!==pa||t.participantType!==La||!Ih(s))||a.eventType===Fa&&t.participantType===Fa)))).map((t=>t.participantId)))||[],l=o.filter((t=>!d.length||d.includes(t)));a.entries||(a.entries=[]);const p=a.entries.map((t=>t.participantId||t.participant&&t.participant.participantId));let m;if(l.forEach((t=>{p.includes(t)||a.entries.push({participantId:t,entryStatus:s,entryStage:c})})),r){const t=Ah({participantIds:l,autoEntryPositions:u,drawDefinition:i,entryStatus:s,entryStage:c,drawId:r,event:a});t.error&&(m=t.error)}if(a.eventType===pa){const t=(a.entries||[]).map((t=>t.participantId)),e=(a.entries||[]).filter((t=>Ih(t.entryStatus))).map((t=>t.participantId)),i=((null==n?void 0:n.participants)||[]).filter((e=>t.includes(e.participantId)&&e.participantType===ka)).map((t=>t.individualParticipantIds)).flat(1/0),r=e.filter((t=>i.includes(t)));r.length&&Nh({tournamentRecord:n,participantIds:r,autoEntryPositions:!1,event:a})}const f=!(l.length===o.length);return u&&(a.entries=hh({entries:a.entries||[]})),f?{error:qe}:Object.assign({message:m},pt)}function Eh({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:n,participantId:i,entryStatus:r,drawId:a,event:o}){return function({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:n,participantId:i,entryStatus:r,drawId:a,stage:o,event:s}){if(!e)return{error:It};if(!i)return{error:Je};if(!s)return{error:Yt};if(![ba,Ea].includes(s.eventType))return{error:zt};const c=e.participants||[],u=c.find((t=>t.participantId===i));if(!u)return{error:Ze};if(![ka,Ea].includes(u.participantType)||u.participantType===Ea&&s.eventType!==Ea||u.participantType===ka&&s.eventType!==ba)return{error:Ke};const d=pu,l=(s.entries||[]).find((t=>t.participantId===i));if(!l)return{error:pn};const{stageEntries:p}=Sh({entryStatusees:[ou,nu,au],selected:!1,drawDefinition:n,drawId:a,event:s,stage:o}),m=p.map(Fc),f=c.filter((({participantId:t})=>m.includes(t))).map((({individualParticipantIds:t})=>t)).flat().filter(Boolean),h=u.individualParticipantIds.filter((t=>1===st(t,f).length));let I,v=Nh({event:s,drawId:a,drawDefinition:n,tournamentRecord:e,participantIds:[i]});if(v.error)return v;if(h.length&&(v=bh({event:s,drawId:a,drawDefinition:n,tournamentRecord:e,entryStage:l.entryStage,entryStatus:r||d,participantIds:h}),v.error))return v;t&&wh({tournamentRecord:e,participantIds:[i]}).success&&(I=!0);return{...pt,participantRemoved:I}}({removeGroupParticipant:t,individualEntryStatus:pu,tournamentRecord:e,drawDefinition:n,participantId:i,entryStatus:r,drawId:a,event:o})}function Ch(t){const{drawId:e,replaceWithBye:n,destroyPair:i,entryStatus:r,drawDefinition:a,matchUpsMap:o}=t,s=el(t);if(s.error)return s;const{participantId:c}=s,{drawPosition:u,event:d,structureId:l}=t;if([nu,du].includes(r)&&c){const{tournamentRecord:n}=t,{participant:o}=aa({tournamentRecord:n,participantId:c}),{participantType:s,individualParticipantIds:u}=o||{};if(i&&s===ka){const t=Eh({tournamentRecord:n,drawDefinition:a,participantId:c,event:d});if(t.error)return t;vh({tournamentRecord:n,participantIds:u,entryStatus:r,drawDefinition:a,drawId:e,event:d})}else vh({tournamentRecord:n,participantIds:[c],entryStatus:r,drawDefinition:a,drawId:e,event:d})}if(n){const t=fl({drawDefinition:a,structureId:l,drawPosition:u,matchUpsMap:o});if(t.error)return t}const{structure:p}=Wc({drawDefinition:a,structureId:l});El({structure:p,drawPositions:[u]});return Cl({drawDefinition:a,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:n,drawPosition:u,entryStatus:r,structureId:l}}),s}function Rh({drawDefinition:t,drawPositions:e,structureId:n}){if(!t)return{error:Ut};if(!n)return{error:Ht};if(2!==(null==e?void 0:e.length))return{error:_n,drawPositions:e};const i=Gc({drawDefinition:t}),{matchUps:r}=pd({includeByeMatchUps:!0,inContext:!0,drawDefinition:t}),{structure:a}=Wc({drawDefinition:t,structureId:n});if(!a)return{error:Wt};let o;if(o=a.structureType===Jo?function({drawDefinition:t,drawPositions:e,structure:n,matchUpsMap:i,inContextDrawMatchUps:r}){var a;const o=null===(a=n.structures)||void 0===a?void 0:a.reduce(((t,n)=>{const i=null==n?void 0:n.positionAssignments.filter((t=>e.includes(t.drawPosition)));return i&&t.push(...i),t}),[]);if(2===o.filter((({bye:t})=>t)).length)return{...pt};if(o.some((({bye:t})=>t)))Oh({drawDefinition:t,assignments:o,structure:n,matchUpsMap:i,inContextDrawMatchUps:r});else{const t=o.map(Fc);o.forEach(((e,n)=>e.participantId=t[1-n]))}return{...pt}}({drawDefinition:t,structure:a,drawPositions:e,matchUpsMap:i,inContextDrawMatchUps:r}):function({inContextDrawMatchUps:t,drawDefinition:e,drawPositions:n,matchUpsMap:i,structure:r}){const a=null==r?void 0:r.positionAssignments.filter((t=>null==n?void 0:n.includes(t.drawPosition)));if(!a)return{error:_n,structure:r,message:"Missing positionAssignments"};if(2===a.filter((({bye:t})=>t)).length)return{...pt};return a.some((({bye:t})=>t))?Oh({drawDefinition:e,structure:r,assignments:a,matchUpsMap:i,inContextDrawMatchUps:t}):function({structure:t,assignments:e}){const n=Object.assign({},...e.map(((t,n)=>{const{drawPosition:i}=t;return{[i]:{...e[1-n],drawPosition:i}}})));return t.positionAssignments=t.positionAssignments.map((t=>n[t.drawPosition]||t)),{...pt}}({structure:r,assignments:a,matchUpsMap:i,inContextDrawMatchUps:t})}({drawDefinition:t,structure:a,drawPositions:e,matchUpsMap:i,inContextDrawMatchUps:r}),o.error)return o;El({structure:a,drawPositions:e});return Cl({drawDefinition:t,positionAction:{name:"swapDrawPositionAssignments",drawPositions:e,structureId:n}}),Ec({drawDefinition:t,structureIds:[n]}),{...pt}}function Oh({drawDefinition:t,structure:e,assignments:n,matchUpsMap:i,inContextDrawMatchUps:r}){const a=n.find((({bye:t})=>t)),o=n.find((({participantId:t})=>t)),s=a.drawPosition,{participantId:c,drawPosition:u}=o,{structureId:d}=e;let l=Ch({drawDefinition:t,structureId:d,drawPosition:s,matchUpsMap:i,inContextDrawMatchUps:r});return l.error?l:(l=Ch({drawDefinition:t,structureId:d,drawPosition:u,matchUpsMap:i,inContextDrawMatchUps:r}),l.error?l:(l=fl({drawDefinition:t,structureId:d,drawPosition:u,matchUpsMap:i,inContextDrawMatchUps:r}),l=jl({drawDefinition:t,structureId:d,drawPosition:s,participantId:c,matchUpsMap:i,inContextDrawMatchUps:r}),l.error?l:{...pt}))}function xh({tournamentRecord:t,drawDefinition:e,event:n,structureId:i,drawPosition:r,subOrder:a}){if(!e)return{error:Ut};if(!i)return{error:Ht};if(!r)return{error:Ct};const{structure:o}=Wc({drawDefinition:e,structureId:i});let s=o;o.structureType===Jo&&(s=o.structures.find((t=>t.positionAssignments.find((t=>t.drawPosition===r)))));const c=s.positionAssignments;let u=zc({element:c.find((t=>t.drawPosition===r)),extension:{name:Zr,value:a}});if(u.error)return u;const{matchUps:d}=ju({structure:s,inContext:!0});return u=al({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:(null==o?void 0:o.matchUpFormat)||e.matchUpFormat,matchUps:d,event:n}),u.error?u:(Ec({drawDefinition:e,structureIds:[i]}),{...pt})}const Lh={setSubOrder:xh,clearDrawPosition:el,assignDrawPosition:jl,automatedPositioning:Df,assignDrawPositionBye:fl,swapDrawPositionAssignments:Rh,alternateDrawPositionAssignment:mh,resolveDrawPositions:function({participantFactors:t,positionAssignments:e}){if(!t||!e)return{error:Ee};let n=Hi(t,!1,!0);const i=e.map((({drawPosition:t})=>t)),r=e.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map(kc);let a,o=!0;for(;o;)({drawPositionResolutions:a,remainingPreferences:o,participantPreferences:n}=lh({participantPreferences:n,drawPositionResolutions:a}));const s=Object.keys(a).map((t=>parseInt(t)));let c=r.filter((t=>!s.includes(t))),u=Object.keys(n);const d=ot(1,(l=2,p=(null==i?void 0:i.length)||0,Math.log(p)/Math.log(l)+1)).map((t=>Math.pow(2,t)));var l,p;const m={};for(const h of d){const e=dt(i,h).filter((t=>ut(t,c))),n={};u.forEach((i=>{e.forEach((e=>{const r=e.join("|");ut(e,t[i].preferences)&&(n[r]||(n[r]=[]),n[r].push(i))}))}));if(tt(Object.keys(n)).forEach((t=>{const e=n[t].filter((t=>u.includes(t)));for(;e.length;){const n=rt(e),i=t.split("|").map((t=>parseInt(t))).filter((t=>c.includes(parseInt(t))));if(i.length){const e=rt(i);c=c.filter((t=>t!==e)),u=u.filter((t=>t!==n)),a[e]=n;const r=t.split("|").length;m[r]||(m[r]=0),m[r]+=1}}})),!c.length)break}const f={chunkResolution:m};return u.length&&(u.forEach((t=>{const e=rt(c);e&&(a[e]=t)})),f.randomAssignment=u.length),{drawPositionResolutions:a,report:f}},initializeStructureSeedAssignments:dh,getNextSeedBlock:kl};function Fh({drawDefinition:t,event:e,matchUpId:n}){if(!t)return{error:Ut};if(!n)return{error:me};const{matchUp:i}=Bu({drawDefinition:t,event:e,matchUpId:n});return i?Yc({element:i,name:Br}):{error:he}}const kh="SCALE",jh="RATING",Bh="RANKING",_h="SEEDING",Gh={SCALE:kh,RATING:jh,RANKING:Bh,SEEDING:_h};function Vh({requireTimeStamp:t,scaleAttributes:e,participant:n}){if(!n)return{error:Ye};if("object"!=typeof e)return{error:_n};if(n.timeItems||(n.timeItems=[]),n&&Array.isArray(n.timeItems)){const{accessor:i,scaleType:r,eventType:a,scaleName:o}=e,s=[kh,r,a,o].join("."),c=n.timeItems.filter((t=>(null==t?void 0:t.itemType)===s)).filter((e=>!t||(null==e?void 0:e.itemDate))).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))).pop();if(c){const[t,e,n,r]=c.itemType.split(".");if(t!==kh)return{error:xn};const a=i&&Tp({element:c.itemValue,accessor:i}),o=i?a.value:c.itemValue;return{scaleItem:{scaleDate:c.itemDate,scaleName:r,scaleType:e,eventType:n,scaleValue:o}}}return{error:Ln}}return{error:Ye}}function Hh({rankedPairings:t,rankedMatchUpValues:e,stipulated:n=[],deltaObjects:i}){let r=0,a=[],o=[].concat(...n);n.filter(Boolean).forEach((t=>{const n=Wh(...t),i=e[n];a.push({participantIds:t,value:i}),r+=e[n]})),t.forEach((t=>{const e=t.pairing.split("|");if(!e.reduce(((t,e)=>o.indexOf(e)>=0||t),!1)){o=o.concat(...e);let n=t.value;r+=n,a.push({participantIds:e,value:n})}})),a.sort(((t,e)=>t.value-e.value));const s=a.reduce(((t,e)=>{const n=Wh(...e.participantIds),r=i[n];return r>t?r:t}),0);return{value:r,participantIdPairings:a,maxDelta:s}}function Wh(t,e){return[t,e].sort().join("|")}function qh({tournamentParticipants:t,drawDefinition:e,participantIds:n,adHocRatings:i,structureId:r,matchUpIds:a,eventType:o,structure:s}){const{positionAssignments:c}=Cu({structure:s}),{encounters:u}=function({matchUps:t,positionAssignments:e}){let n=[];for(const i of t){const t=e.filter((({drawPosition:t})=>i.drawPositions.includes(t))).map(Fc).filter(Boolean);if(2===t.length){const e=zh(...t);n.includes(e)||n.push(e)}}return{encounters:n}}({matchUps:s.matchUps,positionAssignments:c}),d={};for(const y of u)d[y]||(d[y]=0),d[y]+=50;const l=null==t?void 0:t.filter((({participantType:t})=>t===Fa));if(l)for(const y of l){const t=y.individualParticipantIds,{uniquePairings:e}=Kh({participantIds:t});for(const n of e)d[n]||(d[n]=0),d[n]+=60}const{uniquePairings:p,possiblePairings:m,deltaObjects:f}=Kh({participantIds:n}),h=xf({newRound:!0,drawDefinition:e,matchUpsCount:Math.floor(n.length/2),structureId:r,matchUpIds:a,addMatchUps:!0});if(h.error)return h;const I=h.matchUps,v={drawDefinition:e,participantIds:n,possiblePairings:m,uniquePairings:p,adHocRatings:i,deltaObjects:f,valueObjects:d,structure:s},{participantIdPairings:g}=o===ba?function({roundMatchUps:t}){return{matchUps:t}}(v):function({deltaObjects:t,valueObjects:e,adHocRatings:n={},uniquePairings:i,possiblePairings:r}){i.forEach((i=>{const r=i.split("|").map((t=>n[t]||0)),a=Math.abs(r[0]-r[1])+1;t[i]=Math.abs(r[0]-r[1]),e[i]||(e[i]=0),e[i]+=Math.pow(a,2)}));const a=i.map((t=>({pairing:t,value:e[t]}))).sort(((t,e)=>t.value-e.value)),{pairingValues:o}=function({possiblePairings:t,valueObjects:e}){let n={};for(const r of Object.keys(t)){let e=t[r].map((t=>i(r,t)));n[r]=e.sort(((t,e)=>t.value-e.value))}function i(t,n){let i=zh(t,n);return{opponent:n,value:e[i]}}return{pairingValues:n}}({possiblePairings:r,valueObjects:e}),{participantIdPairings:s}=function({rankedPairings:t,pairingValues:e,deltaObjects:n,candidateGoal:i=2e3,actorDivisor:r=100}){const a=Object.assign({},...t.map((t=>({[t.matchUp]:t.value}))));let o=Hh({rankedPairings:t,rankedMatchUpValues:a,deltaObjects:n}),s=o;const c=Object.keys(e),u=i/(c.length/r);let d=Math.floor(u/c.length);return d>i&&(d=i),c.forEach((i=>{e[i].slice(0,d).forEach((e=>{const i=Hh({rankedPairings:t,rankedMatchUpValues:a,stipulated:[e.participantIds],deltaObjects:n});i.maxDelta<s.maxDelta&&(s=i),i.value<o.value&&(o=i)}))})),o}({rankedPairings:a,pairingValues:o,deltaObjects:t,candidateGoal:2e3,actorDivisor:100});return{participantIdPairings:s}}(v);for(const[y,U]of I.entries()){const t=U.drawPositions,{participantIds:n}=g[y];for(const i of t.keys()){const a=jl({drawDefinition:e,structureId:r,participantId:n[i],drawPosition:t[i]});if(a.error)return a}}return{...pt}}function Kh({participantIds:t}){const e={},n=[];t.forEach((i=>{e[i]=t.filter((t=>t!==i)),e[i].forEach((t=>{const e=zh(t,i);n.includes(e)||n.push(e)}))}));const i=Object.assign({},...n.map((t=>({[t]:0}))));return{uniquePairings:n,possiblePairings:e,deltaObjects:i}}function zh(t,e){return[t,e].sort().join("|")}function Yh({tournamentParticipants:t,restrictEntryStatus:e,drawDefinition:n,participantIds:i,structureId:r,matchUpIds:a,scaleName:o,eventType:s}){var c;if("object"!=typeof n)return{error:yt};const u=n.entries.filter((({entryStatus:t})=>!e||[ou,uu,au].includes(t))).map(Fc);if(i){const t=!!i.find((t=>u.includes(t)));if(t)return{error:We,participantId:t}}else i=u;const d=t=>!(null!=t&&t.structures||null!=t&&t.matchUps.find((({roundPosition:t})=>!!t)));if(!r){var l;const t=null===(l=n.structures)||void 0===l?void 0:l.find((t=>1===t.stageSequence)).recuce(((t,e)=>{const n=Ko[e.stage];return d(e)&&n>Ko[t.stage]?e:t}),void 0);r=null==t?void 0:t.structureId}const p=null===(c=n.structures)||void 0===c?void 0:c.find((t=>t.structureId===r));if(!p)return{error:Wt};if(!d(p))return{error:yt};const m={};for(const h of i){const e=null==t?void 0:t.find((t=>t.participantId===h));let n=$h({eventType:s,participant:e});!n&&o&&(n=$h({scaleValue:n,eventType:s,participant:e})),n&&(m[h]=n)}const{matchUps:f}=qh({tournamentParticipants:t,drawDefinition:n,participantIds:i,adHocRatings:m,matchUpIds:a,structureId:r,structure:p,eventType:s});return{...pt,matchUps:f}}function $h({scaleName:t="dynamic",eventType:e,participant:n}){var i;const r=n&&Vh({participant:n,scaleAttributes:{scaleType:jh,eventType:e||Ma,scaleName:t}});return null==r||null===(i=r.scaleItem)||void 0===i?void 0:i.scaleValue}function Jh({drawDefinition:t,matchUpId:e,outcome:n,matchUp:i}){var r,a;if(!i&&!t)return{error:Ut};if(!i&&!e)return{error:ve};if(!n)return{error:Ee};if(!i){const{error:n,matchUp:r}=Bu({drawDefinition:t,matchUpId:e});if(n)return{error:n};i=r}if("object"!=typeof n||null===(r=n.score)||void 0===r||!r.scoreStringSide1||null===(a=n.score)||void 0===a||!a.scoreStringSide2)return{error:_n};return zc({element:i,extension:{name:Br,value:n}})}function Zh(t){return null!==t&&(void 0===t||!isNaN(t))}function Qh({drawDefinition:t,finishingOrder:e}){if(!t)return{error:Ut};if(!Array.isArray(e))return{error:_n,message:"finishingOrder must be an array"};const{completedMatchUps:n,matchUpsMap:i}=md({inContext:!0,drawDefinition:t}),r=n.map(jc),a=e.map(jc),{matchUpTypes:o,roundNumbers:s,structureIds:c,matchUpTieIds:u}=n.filter((({matchUpId:t})=>a.includes(t))).reduce(((t,e)=>{const{matchUpTieId:n,matchUpType:i,roundNumber:r,structureId:a}=e;return t.matchUpTypes.includes(i)||t.matchUpTypes.push(i),t.roundNumbers.includes(r)||t.roundNumbers.push(r),t.structureIds.includes(a)||t.structureIds.push(a),t.matchUpTieIds.includes(n)||t.matchUpTieIds.push(n),t}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(o.length>1||u.length>1||s.length>1||c.length>1)return{error:_n,message:"matchUpType, structureId and roundNumber must be equivalent"};let d,l;const p={},m=[],f=[];if(!e.every((({orderOfFinish:t,matchUpId:e})=>(m.push(e),t&&f.push(t),p[e]=t,d=r.includes(e),l=void 0===t||J(t)&&Math.floor(t)>0,d&&l))))return{error:d?_n:se,message:d?l?void 0:"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed"};const h=n.filter((t=>t.structureId===c[0]&&t.roundNumber===s[0]&&t.matchUpType===o[0]&&t.matchUpTieId===u[0]&&!m.includes(t.matchUpId)));for(const v of h){const{orderOfFinish:t}=v||{};if(t){if(!J(t))return{error:_n,message:"Existing value",matchUp:v};f.push(t)}}if(it(f).length!==f.length||Math.max(...f)>f.length)return{error:_n,message:"Values not unique or greater than expected number of values"};if(c.length){var I;const e=ld({matchUpFilters:{matchUpIds:a},structureId:c[0],drawDefinition:t,matchUpsMap:i});if(e.error)return e;null===(I=e.completedMatchUps)||void 0===I||I.forEach((t=>t.orderOfFinish=p[t.matchUpId]))}return{...pt}}const Xh={setMatchUpStatus:ql,setMatchUpFormat:zl,isValidMatchUpFormat:v,addMatchUpTimeItem:_u,resetMatchUpTimeItems:function({drawDefinition:t,event:e,matchUpId:n}){const{matchUp:i}=Bu({drawDefinition:t,event:e,matchUpId:n});return i?(i.timeItems=[],Mc({drawDefinition:t,matchUp:i}),{...pt}):{error:he}},checkInParticipant:gm,checkOutParticipant:ym,getCheckedInParticipantIds:Lu,addMatchUpScheduleItems:$u,addMatchUpScheduledDate:Ju,addMatchUpScheduledTime:Zu,addMatchUpStartTime:Xu,addMatchUpEndTime:td,addMatchUpStopTime:ed,addMatchUpResumeTime:nd,setOrderOfFinish:Qh,setDelegatedOutcome:Jh,removeDelegatedOutcome:Fh,drawMatic:Yh,matchUpSort:Kd,addMatchUpOfficial:Qu,findMatchUp:function(t){return Object.assign(t,{inContext:!0}),{matchUp:Hi(Bu(t).matchUp,!1,!0)}},getRoundMatchUps:_c,validDrawPositions:function({matchUps:t}){if(!t)return{error:Ie};const e=t.map((t=>t.drawPositions)).flat();ei()&&t.forEach((t=>{var e;Array.isArray(t.drawPositions)?null===(e=t.drawPositions)||void 0===e||e.forEach((e=>{Zh(e)||console.log("invalid drawPosition",t)})):console.log("drawPositions not an array",t)}));const n=null==e?void 0:e.every(Zh),i=t.find((t=>!Array.isArray(t.drawPositions)));return n&&!i}};function tI({drawDefinition:t,policyDefinitions:e}){if(!t)return{error:Ut};if(!e||"object"!=typeof e)return{error:Ue};t.extensions||(t.extensions=[]);const{appliedPolicies:n}=Bc({drawDefinition:t}),i=Object.keys(e).every((t=>!n[t]&&(n[t]=e[t],!0)));if(i){const e=zc({element:t,extension:{name:jr,value:n}});if(e.error)return e}return Ec({drawDefinition:t}),i?{...pt}:{error:De}}const eI={attachPolicies:tI};function nI({tournamentParticipants:t,drawDefinition:e,event:n}){if(!e)return{error:Ut};const i=Hi(pd({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:n}).matchUps,!1,!0),r=X(i.reduce(((t,e)=>t.concat(...e.sides.map((t=>t.participantId)).filter(Boolean))),[])),a=Object.assign({},...r.map((t=>{const e=i.filter((e=>e.sides.map((t=>t.participantId)).filter(Boolean).includes(t)));return{[t]:e}})));return{participantIds:r,participantIdMatchUps:a}}function iI({byeAdvancements:t=!1,tournamentParticipants:e,drawDefinition:n}){if(!n)return{error:Ut};const{participantIds:i,participantIdMatchUps:r}=nI({tournamentParticipants:e,drawDefinition:n}),a=i.map((e=>{const n=r[e].filter((t=>[D,S].includes(t.matchUpStatus)||t.winningSide)),i=n.map((n=>{const i=n.sides.find((t=>t.bye)),r=n.sides.find((t=>t.participantId===e)).sideNumber;return(n.winningSide||t&&i&&r)===r?n.finishingPositionRange.winner:n.finishingPositionRange.loser})),a=t=>Math.abs(t[0]-t[1]),o=i.reduce(((t,e)=>t&&a(t)<a(e)?t:e),void 0);return{[e]:{relevantMatchUps:n,finishingPositionRanges:i,finishingPositionRange:o}}}));return Object.assign({},...a)}function rI({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:n,positionAssignments:i,policyDefinitions:r,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l;if(n.includes(o))return{};const p=null==r||null===(l=r.positionActions)||void 0===l?void 0:l.otherFlightEntries,m=(a.entries||[]).map((({participantId:t})=>t)).filter(Boolean),f=i.map((t=>t.participantId)).filter(Boolean),h=(d.entries||[]).filter((t=>t.entryStatus===nu&&function({structure:t,entry:e}){const{stage:n}=t;if(!e.entryStage||e.entryStage===n||e.entryStage===_o&&n===Vo)return!0}({structure:c,entry:t})&&!f.includes(t.participantId))).sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))).map((t=>t.participantId));if(p){var I;const{flightProfile:t}=ol({event:d}),e=null==t||null===(I=t.flights)||void 0===I?void 0:I.filter((t=>t.drawId!==u)).map((t=>t.drawEntries.filter((t=>t.participantId&&!m.includes(t.participantId))).map((({participantId:t})=>t)))).flat().filter(Boolean);null!=e&&e.length&&h.push(...e)}const v=null==t?void 0:t.filter((t=>h.includes(t.participantId)));if(v.forEach((t=>{const e=(a.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),v.sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))),h.length){return{validAlternatesAction:{type:Fs,method:"alternateDrawPositionAssignment",availableAlternates:v,availableAlternatesParticipantIds:h,willDisableLinks:e,payload:{drawId:u,structureId:s,drawPosition:o}}}}return{}}function aI(t,e){return t.bye||t.seedValue<e.seedValue||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function oI({drawDefinition:t,drawPosition:e,structureId:n,structure:i,drawId:r,event:a,isByePosition:o,byeDrawPositions:s,positionAssignments:c,tournamentParticipants:u,onlyAssignedPositions:d=!0,activeDrawPositions:l,inactiveDrawPositions:p,possiblyDisablingAction:m}){if(l.includes(e))return{};const f=null==p?void 0:p.filter((t=>t!==e&&!(o&&s.includes(t)))),h=(null==c?void 0:c.filter((t=>(t=>!d||t.participantId||t.qualifier||t.bye)(t)&&(null==f?void 0:f.includes(t.drawPosition)))))||[],I=h.map((({drawPosition:t})=>t)),{matchUps:v}=ju({inContext:!0,drawDefinition:t,structure:i,event:a}),g=v.filter((({drawPositions:t})=>ut(t,I))),y=Object.assign({},...g.map((t=>{var e;return null===(e=t.sides)||void 0===e?void 0:e.filter((({sourceDrawPositionRange:t})=>t)).map((({drawPosition:t,sourceDrawPositionRange:e})=>({[t]:e})))})).flat()),U=h.map((t=>t.participantId)).filter(Boolean),w=(u||[]).filter((t=>U.includes(t.participantId))),S=Object.assign({},...w.map((t=>({[t.participantId]:t})))),N=h.map((t=>{const e=S&&S[t.participantId],n=y[t.drawPosition];return{...t,participant:Hi(e,!1,!0),sourceDrawPositionRange:n}}));if(N.length){return{validSwapAction:{type:Gs,method:"swapDrawPositionAssignments",availableAssignments:N,willDisableLinks:m,payload:{drawId:r,structureId:n,drawPositions:[e]}}}}return{}}function sI({action:t,policyActions:e}){var n;const i=!(null!=e&&e.enabledActions)||(null==e||null===(n=e.disabledActions)||void 0===n?void 0:n.length)&&e.disabledActions.includes(t);if(i)return!1;return!(!(0===(null==e?void 0:e.enabledActions.length)||(null==e?void 0:e.enabledActions.includes(t)))||i)}function cI({policyDefinitions:t,tournamentParticipants:e=[],tournamentRecord:n,drawDefinition:i,drawPosition:r,structureId:a,event:o}){if(!o)return{error:Yt};if(!i)return{error:Ut};if(void 0===r)return{error:Ct};if(!a)return{error:Ht};const{activeDrawPositions:s,byeDrawPositions:c,inactiveDrawPositions:u,structure:d,error:l}=Zd({tournamentRecord:n,drawDefinition:i,structureId:a});if(l)return{error:l};const{policyDefinitions:p}=il({policyTypes:[ir],tournamentRecord:n,drawDefinition:i,event:o}),m=t||p,{enabledStructures:f,actionsDisabled:h}=function({policyDefinitions:t,tournamentRecord:e,drawDefinition:n,structure:i,event:r}){const{policyDefinitions:a}=il({policyTypes:[ir],tournamentRecord:e,drawDefinition:n,event:r}),o=(t=t||a||zs).positionActions,{enabledStructures:s,disabledStructures:c}=o||{};return{enabledStructures:s,actionsDisabled:null==c?void 0:c.find((t=>{var e,n;return(null===(e=t.stages)||void 0===e?void 0:e.includes(i.stage))&&(!(null!==(n=t.stageSequences)&&void 0!==n&&n.length)||t.stageSequences.includes(i.stageSequence))}))}}({policyDefinitions:m,tournamentRecord:n,drawDefinition:i,structure:d,event:o}),{sourceStructureIds:I}=function({drawDefinition:t,structureId:e,finishingPosition:n,linkType:i}){const{links:r}=od({drawDefinition:t,structureId:e})||{};return{sourceStructureIds:((null==r?void 0:r.target)||[]).filter((({linkType:t})=>t===i)).map((({source:t})=>t.structureId)).map((e=>{const{structure:n}=Wc({drawDefinition:t,structureId:e});return{sourceStructureId:e,sourceFinishingPosition:n.finishingPosition}})).filter((({sourceFinishingPosition:t})=>t===n)).map((({sourceStructureId:t})=>t))}}({drawDefinition:i,structureId:a,finishingPosition:bs,linkType:es})||{};let v;null!=I&&I.length&&(v=I.reduce(((t,e)=>Tl({drawDefinition:i,structureId:e})&&t),!0));const g=I.length,y=I.length&&!v,{policyActions:U}=function({enabledStructures:t,structure:e}){if(!1===t)return{};if(null==t||!t.length)return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:n,stageSequence:i}=e||{};return{policyActions:t.find((t=>{var e,r;const a=!(null!==(e=t.stages)&&void 0!==e&&e.length)||t.stages.includes(n),o=!(null!==(r=t.stageSequences)&&void 0!==r&&r.length)||t.stageSequences.includes(i);if(t&&a&&o)return!0}))}}({enabledStructures:f,structure:d}),w=![Go,_o].includes(d.stage)||1!==d.stageSequence,S=[],{drawId:N}=i,{assignedPositions:D,positionAssignments:P}=Ru({structure:d}),T=D.find((t=>t.drawPosition===r)),A=P.map((t=>t.drawPosition));if(null==A||!A.includes(r))return{error:Et};const{stage:M,stageSequence:b}=d,E=[ou,au],C=[M];M===Vo&&C.push(_o),M===_o&&C.push(Vo);const R=Du({drawDefinition:i,stageSequence:b,entryStatuses:E,structureId:a,stages:C}),O=fh({drawDefinition:i,stages:C}),x=R.filter((t=>!O.includes(t.participantId))).map((t=>t.participantId)),L=c.includes(r),F=s.includes(r);if(h)return{message:"Actions Disabled for structure",isByePosition:L,isActiveDrawPosition:F,isDrawPosition:!0,hasPositionAssigned:!!T,validActions:[]};if(sI({policyActions:U,action:js})&&!F&&!y&&(!T||L)){const{validAssignmentActions:t}=function({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:n,tournamentParticipants:i,isWinRatioFedStructure:r,positionAssignments:a,policyDefinitions:o,drawDefinition:s,isByePosition:c,drawPosition:u,structureId:d,structure:l}){var p,m,f;const{drawId:h}=s,I=[];let v,g,y=[];const U=null==o||null===(p=o.seeding)||void 0===p||null===(m=p.validSeedPositions)||void 0===m?void 0:m.ignore;if(!U){const t=kl({randomize:!0,drawDefinition:s,structureId:d});({unplacedSeedParticipantIds:v,unplacedSeedAssignments:g,unfilledPositions:y}=t)}if(null!==(f=y)&&void 0!==f&&f.length||(y=a.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition))),c||I.push({type:qs,method:"assignDrawPositionBye",willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}}),r&&U){var w;const e=a.map((t=>t.participantId)).filter(Boolean),r={structureIds:t},{completedMatchUps:o}=md({inContext:!0,matchUpFilters:r,drawDefinition:s}),c=X(null===(w=o||[])||void 0===w?void 0:w.map((({sides:t})=>t.map(Fc))).flat().filter((t=>!e.includes(t)))),l=null==i?void 0:i.filter((t=>null==c?void 0:c.includes(t.participantId)));return null==l||l.forEach((t=>{const e=(s.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),null!=l&&l.length&&I.push({type:js,method:xs,availableParticipantIds:c,participantsAvailable:l,willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}}),{validAssignmentActions:I}}const S=!(null!=l&&l.structures||null!=l&&l.matchUps.find((({roundPosition:t})=>!!t)));if(y.includes(u)||c){var N;let t;if(null!==(N=g)&&void 0!==N&&N.length){const e=g.filter((t=>{var e;return null===(e=v)||void 0===e?void 0:e.includes(t.participantId)}));e.sort(aI),t=e.map((t=>t.participantId))}else if(S)t=bl({drawDefinition:s,drawPosition:u,structure:l});else{t=e;const{unplacedQualifiersCount:n}=Sf({drawDefinition:s,structureId:d,structure:l});n&&console.log({unplacedQualifiersCount:n})}const r=null==i?void 0:i.filter((e=>t.includes(e.participantId)));null!=r&&r.length&&I.push({type:js,method:xs,availableParticipantIds:t,participantsAvailable:r,willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}})}return{validAssignmentActions:I}}({positionSourceStructureIds:I,unassignedParticipantIds:x,possiblyDisablingAction:w,isWinRatioFedStructure:g,tournamentParticipants:e,positionAssignments:P,activeDrawPositions:s,policyDefinitions:m,drawDefinition:i,isByePosition:L,drawPosition:r,structureId:a,structure:d});null==t||t.forEach((t=>S.push(t)))}const{participantId:k}=T||{},j=k&&e.find((t=>t.participantId===k));if(T){sI({policyActions:U,action:Bs})&&!F&&(S.push({type:Bs,method:Os,payload:{drawId:N,structureId:a,drawPosition:r},willDisableLinks:w}),L||S.push({type:ks,method:"withdrawParticipantAtDrawPosition",payload:{drawId:N,structureId:a,drawPosition:r},willDisableLinks:w}),sI({policyActions:U,action:qs})&&!L&&S.push({type:qs,method:Os,payload:{drawId:N,structureId:a,drawPosition:r,replaceWithBye:!0},willDisableLinks:w}));const t=d.stage===Go||d.stage===_o&&1===d.stageSequence;if(!L&&sI({policyActions:U,action:Hs})&&Fl({drawDefinition:i,structureId:a,drawPosition:r})&&t){const{seedAssignments:t}=Mu({drawDefinition:i,structure:d}),{seedNumber:e,seedValue:n}=t.find((t=>t.participantId===k))||{};S.push({type:Hs,method:"modifySeedAssignment",participant:j,seedNumber:e,payload:{drawId:N,structureId:a,participantId:k,seedValue:n}})}if(!L&&k){if(sI({policyActions:U,action:Ws})){const t={type:Ws,method:Ls,participant:j,payload:{drawId:N,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};S.push(t)}if(sI({policyActions:U,action:Vs})){const t={type:Vs,method:"modifyParticipantOtherName",participant:j,payload:{participantId:k,otherName:void 0}};S.push(t)}}if(sI({policyActions:U,action:Gs})){const{validSwapAction:t}=oI({drawId:N,structure:d,structureId:a,drawPosition:r,isByePosition:L,drawDefinition:i,byeDrawPositions:c,positionAssignments:P,activeDrawPositions:s,inactiveDrawPositions:u,tournamentParticipants:e,possiblyDisablingAction:w});t&&S.push(t)}}if(sI({policyActions:U,action:Fs})&&!y){const{validAlternatesAction:t}=rI({possiblyDisablingAction:w,tournamentParticipants:e,positionAssignments:P,activeDrawPositions:s,policyDefinitions:m,drawDefinition:i,drawPosition:r,structureId:a,structure:d,drawId:N,event:o});t&&S.push(t)}if(sI({policyActions:U,action:_s})&&!y){const{validLuckyLosersAction:t}=function({tournamentParticipants:t=[],possiblyDisablingAction:e,isWinRatioFedStructure:n,activeDrawPositions:i,positionAssignments:r,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l,p,m,f;if(i.includes(o)||n)return{};const{sourceStructureIds:h,targetStructureIds:I}=(null===(l=a.links)||void 0===l?void 0:l.reduce(((t,e)=>{var n,i;const r=null===(n=e.source)||void 0===n?void 0:n.structureId,a=null===(i=e.target)||void 0===i?void 0:i.structureId;return t.sourceStructureIds.includes(r)||t.sourceStructureIds.push(r),t.targetStructureIds.includes(a)||t.targetStructureIds.push(a),t}),{sourceStructureIds:[],targetStructureIds:[]}))||{};let v=null===(p=a.links)||void 0===p?void 0:p.find((t=>{var e;return(null===(e=t.target)||void 0===e?void 0:e.structureId)===c.structureId}));const g=null===(m=v)||void 0===m||null===(f=m.source)||void 0===f?void 0:f.structureId,{structure:y}=Wc({drawDefinition:a,structureId:g}),U={};if((null==y?void 0:y.finishingPosition)===Es&&(1!==(null==h?void 0:h.length)||1!==(null==I?void 0:I.length))){var w,S,N;const{matchUps:t}=ju({drawDefinition:a,structure:c,event:d}),{initialRoundNumber:e}=Dd({drawPosition:o,matchUps:t});v=null===(w=a.links)||void 0===w?void 0:w.find((t=>{var n;return(null===(n=t.target)||void 0===n?void 0:n.structureId)===(null==c?void 0:c.structureId)&&t.target.roundNumber===e}));const n=null===(S=v)||void 0===S||null===(N=S.source)||void 0===N?void 0:N.roundNumber;U.roundNumbers=[n]}const{completedMatchUps:D}=ld({structureId:g,inContext:!0,matchUpFilters:U,drawDefinition:a}),P=r.map((t=>t.participantId)).filter(Boolean),T=null==D?void 0:D.map((({winningSide:t,sides:e})=>e[1-(t-1)])).map(Fc).filter((t=>!P.includes(t))),A=null==t?void 0:t.filter((t=>null==T?void 0:T.includes(t.participantId)));if(null==A||A.forEach((t=>{const e=(a.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),null!=T&&T.length)return{validLuckyLosersAction:{type:_s,method:"luckyLoserDrawPositionAssignment",availableLuckyLosers:A,availableLuckyLoserParticipantIds:T,willDisableLinks:e,payload:{drawId:u,structureId:s,drawPosition:o}}};return{}}({drawId:N,structure:d,structureId:a,drawPosition:r,drawDefinition:i,activeDrawPositions:s,positionAssignments:P,isWinRatioFedStructure:g,tournamentParticipants:e,possiblyDisablingAction:w});t&&S.push(t)}return{isByePosition:L,isActiveDrawPosition:F,isDrawPosition:!0,hasPositionAssigned:!!T,validActions:S}}const uI={allPlayoffPositionsFilled:Al,isCompletedStructure:Tl,getStructureMatchUps:ld,allStructureMatchUps:function(t){const{structure:e}=Wc(t);return Object.assign(t,{structure:e,inContext:!0}),ju(t)},allDrawMatchUps:function(t){return Object.assign(t,{inContext:!0}),pd(t)},drawMatchUps:function(t){return Object.assign(t,{inContext:!0}),md(t)},getEliminationDrawSize:ch,getParticipantIdMatchUps:nI,getParticipantIdFinishingPositions:iI,structureActions:function(t){return null!=t&&t.drawDefinition?{actions:[],state:{isComplete:Tl(t),hasPlayoffPositionsFilled:Al(t)}}:{error:Ut}},matchUpActions:Ym,positionActions:cI,getStructureSeedAssignments:Mu,getNextUnfilledDrawPositions:function({drawDefinition:t,structureId:e}){if(!t){return{error:Ut,nextUnfilledDrawPositions:[]}}if(!e){return{error:Ht,nextUnfilledDrawPositions:[]}}const{structure:n,error:i}=Wc({drawDefinition:t,structureId:e});if(i)return{error:i};const r=Ru({structure:n}),a=(null==r?void 0:r.positionAssignments)||[],{unfilledPositions:o}=kl({drawDefinition:t,structureId:e,randomize:!0}),s=a.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));return null!=o&&o.length?{nextUnfilledDrawPositions:o}:{nextUnfilledDrawPositions:s}},getExitProfiles:function({drawDefinition:t}){if("object"!=typeof t)return{error:yt};const e={},{structures:n=[],links:i=[]}=t||{},r=n.reduce(((t,e)=>{const{stage:n}=e;return t[n]?t[n].push(e):t[n]=[e],t}),{});for(const o of Object.keys(r)){const t=r[o].find((({stageSequence:t})=>1===t)),{structureId:n}=t;a(e,"0",o,n,0)}return{exitProfiles:e};function a(t,e,r,o,s){t[o]||(t[o]=[]),"0"===e&&[Vo,Wo].includes(r)||t[o].push(e);const c=i.filter((t=>t.source.structureId===o&&t.source.roundNumber>=s));for(const i of c){const r=i.source.roundNumber,o=i.target.roundNumber,s=i.target.structureId;a(t,`${e}-${r}`,n.find((t=>t.structureId===s)).stage,s,o)}}},getMatchUpContextIds:function({matchUps:t,matchUpId:e}){if(!Array.isArray(t))return{error:_n};const n=t.find((t=>t.matchUpId===e)),{drawId:i,eventId:r,structureId:a,tournamentId:o}=n||{};return{matchUpId:e,drawId:i,eventId:r,structureId:a,tournamentId:o}},getMatchUpParticipantIds:xu,getMatchUpScheduleDetails:Ra,generateTieMatchUpScore:xa,matchUpDuration:Or,credits:Gm};function dI({validation:t=!0,drawDefinition:e,participantId:n,structureId:i,seedValue:r}){if(!e)return{error:Ut};if(!i)return{error:Ht};const{structure:a}=Wc({drawDefinition:e,structureId:i});if(!a)return{error:Wt};if(!(!t||z(r)||"string"==typeof r&&r.split("-").every(z)))return{error:_n};const{seedAssignments:o}=Mu({drawDefinition:e,structure:a}),s=o.map((t=>t.seedNumber)),c=o.find((t=>t.participantId===n));if(c)c.seedValue=r;else{const t=Math.max(0,...s)+1;a.seedAssignments.push({seedNumber:t,seedValue:r,participantId:n})}return Ec({drawDefinition:e,structureIds:[i]}),pt}function lI({drawDefinition:t,participantId:e,structureId:n,seedNumber:i,seedValue:r}){const{structure:a}=Wc({drawDefinition:t,structureId:n}),{positionAssignments:o}=Ru({structure:a}),{seedAssignments:s}=Mu({drawDefinition:t,structure:a}),c=s.map((t=>t.seedNumber)),u=Dh({drawDefinition:t,participantId:e});if(e&&!u)return{error:We,participantId:e,method:"assignSeed"};const d=o.find((t=>t.participantId===e)),l=null==d?void 0:d.drawPosition;if(l){if(!Fl({seedNumber:i,drawDefinition:t,structureId:n,drawPosition:l}))return{error:Dt}}if(c.includes(i)){let a;if(s.forEach((t=>{t.participantId===e&&t.seedNumber!==i&&(t.participantId=void 0),t.seedNumber===i&&(t.participantId=e,t.seedValue=r||i,a=!0)})),a)return Ec({drawDefinition:t,structureIds:[n]}),{...pt}}return{error:Bt}}const pI={addDrawEntry:Ph,addDrawEntries:Th,assignSeed:lI,removeEntry:function({participantId:t,drawDefinition:e,autoEntryPositions:n=!0}){return e?t?fh({drawDefinition:e}).includes(t)?{error:sn}:(null!=e&&e.entries&&(e.entries=e.entries.filter((e=>e.participantId!==t))),n&&(e.entries=hh({entries:e.entries})),Ec({drawDefinition:e}),{...pt}):{error:Je}:{error:Ut}},setStageDrawSize:Ff,setStageAlternatesCount:function({drawDefinition:t,stage:e,alternatesCount:n}){return t?Uu({drawDefinition:t,stage:e})?(tu({drawDefinition:t,attributes:[{[e]:{alternates:n}}]}),n||(t.entries=(null===(i=t.entries)||void 0===i?void 0:i.filter((t=>t.entryStatus!==nu)))||[]),Ec({drawDefinition:t}),{...pt}):{error:ee}:{error:Ut};var i},setStageWildcardsCount:function({drawDefinition:t,stage:e,wildcardsCount:n=0}){if(!t)return{error:Ut};if(!Uu({drawDefinition:t,stage:e}))return{error:ee};const i=wu({drawDefinition:t,stage:e}),r=Su({drawDefinition:t,stage:e}),a=Tu({drawDefinition:t,stage:e}),o=Pu({drawDefinition:t,stage:e});return n<a?{error:"Number of Wildcards cannot be less than number of Wildcards already entered"}:o+n+r>i?{error:"Total stage Entries cannot be greater than drawPositions"}:(tu({drawDefinition:t,attributes:[{[e]:{wildcardsCount:n}}]}),Ec({drawDefinition:t}),{...pt})},setStageQualifiersCount:function({drawDefinition:t,stage:e,qualifiersCount:n=0}){if(!t)return{error:Ut};if(!Uu({drawDefinition:t,stage:e}))return{error:ee};if(e!==_o)return{error:"qualifiersCount can only be set for main stage"};const i=wu({drawDefinition:t,stage:e}),r=Tu({drawDefinition:t,stage:e});return Pu({drawDefinition:t,stage:e})+r+n>i?{error:"Total stage Entries cannot be greater than drawPositions"}:(tu({drawDefinition:t,attributes:[{[e]:{qualifiersCount:n}}]}),Ec({drawDefinition:t}),{...pt})},modifySeedAssignment:dI};const mI={generateQualifyingLink:function({qualifyingStructureId:t,mainStructureId:e,qualifyingRound:n,mainEntryRound:i=1,drawDefinition:r}){if(!r)return{error:Ut};const a={linkType:ns,source:{roundNumber:n,structureId:t},target:{feedProfile:Zo,roundNumber:i,structureId:e}};r.links.push(a),Ec({drawDefinition:r})}},fI=["drawId","structures"];function hI(t,e=!0){return t?"object"!=typeof t?{error:Bn}:t.drawId?function(t){const e=Object.keys(t);return fI.reduce(((t,n)=>!!e.includes(n)&&t),!0)}(t)?e?Hi(t):t:{error:yt}:{error:xt,method:"setState"}:{error:Ut}}function II({drawId:t=zi(),matchUpType:e,drawType:n}={}){const i={drawId:void 0,drawName:void 0,matchUpType:void 0,entries:[],links:[],structures:[]};return Object.assign(i,{drawId:t,drawType:n,matchUpType:e})}let vI,gI=[];const yI=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>({drawDefinition:Hi(vI,t,!1,e)}),version:()=>"0.56.2",reset:()=>(vI=void 0,pt),newDrawDefinition:({drawId:t,drawType:e}={})=>(vI=II({drawId:t,drawType:e}),Object.assign({drawId:vI.drawId,drawDefinition:Hi(vI)},pt)),setDrawDescription:({description:t}={})=>vI?(vI.description=t,Ec({drawDefinition:vI}),Object.assign({drawId:vI.drawId},pt)):{error:Ut}};return[mI,uI,Lo,pI,eI,Xh,Lh,sh].forEach((n=>{Object.keys(n).forEach((i=>{t[i]=t=>{if(ei())return e({params:t,governor:n,governorMethod:i});try{return e({params:t,governor:n,governorMethod:i})}catch(r){console.log("%c ERROR","color: orange",{err:r})}}}))})),t.devContext=e=>(ni(e),t),t.setParticipants=(e=[])=>(gI=e,t),t.setState=(e,n,i)=>{ii(n,i);return function(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0,vI=e,t.drawId=e.drawId),t}(hI(e))},t;function e({params:e,governor:n,governorMethod:i}){var r,a,o,s;delete t.success,delete t.error;const c=(null===(r=e)||void 0===r?void 0:r.rollbackOnError)&&Hi(vI,!1,!0);e={...e,tournamentParticipants:gI,drawDefinition:vI};const u=n[i](e);if(null!=u&&u.error)return c&&hI(c),{...u,rolledBack:!!c};const d=(null==u?void 0:u.success)&&!0!==(null===(a=e)||void 0===a?void 0:a.delayNotify)&&!0!==(null===(o=e)||void 0===o?void 0:o.doNotNotify);return d&&jp(),(d||null==u||!u.success||null!==(s=e)&&void 0!==s&&s.doNotNotify)&&oi(),u}}();function UI(t,e){var n;if("object"!=typeof t)return{error:Bn};const i=(null===(n=t.unifiedTournamentId)||void 0===n?void 0:n.tournamentId)||t.tournamentId;if(!i)return{error:gt};const r=!1!==e?Hi(t):t;return mi({[i]:r}),fi(i),r}function wI({convertExtensions:t,removeExtensions:e,tournamentId:n}={}){if("string"!=typeof n)return{};return{tournamentRecord:Hi(di(n),t,!1,e)}}function SI(t,e){return e&&e.someParam&&(e={...e}),e}const NI={},DI="ELO",PI="NTRP",TI={ELO:DI,NTRP:PI,TRN:"TRN",UTR:"UTR",WTN:"WTN"},AI={[DI]:{range:[0,3e3],decimalsCount:0,defaultInitialization:1500},WTN:{range:[40,1],decimalsCount:2,defaultInitialization:23},UTR:{range:[1,16],decimalsCount:2,defaultInitialization:6},[PI]:{range:[1,7],decimalsCount:1,defaultInitialization:3}};const MI={nSpread:400,diffThreshold:.125,kCalc:t=>250/Math.pow(t+5,.4),kMultiplier:function(t=3,e=2){let n=t/e;return isNaN(n)?MI.kDefault():n},kDefault:()=>1};function bI({ratings:t=AI,winnerCountables:e=1,loserCountables:n=0,ratingType:i=DI,maxCountables:r,winnerRating:a,loserRating:o,ratingRange:s,countables:c}={}){const u=null==t?void 0:t[i];if(!u)return{error:Ee};s=u.range||s,a=a||u.defaultInitialization,o=o||u.defaultInitialization;const d=s[0]>s[1],l=u.decimalsCount||0,p=d?s.slice().reverse():s,m=(t,e)=>parseFloat(e)>=Math.min(...t)&&parseFloat(e)<=Math.max(...t);m(s,a)&&m(s,o)||(m(s,a)||(a=u.defaultInitialization),m(s,o)||(o=u.defaultInitialization));const f=({value:t,sourceRange:e,targetRange:n})=>(t-e[0])*(n[1]-n[0])/(e[1]-e[0])+n[0],h=f({targetRange:AI.ELO.range,sourceRange:p,value:d?s[0]-a:a}),I=f({targetRange:AI.ELO.range,sourceRange:p,value:d?s[0]-o:o}),v=(t,e)=>1/(1+Math.pow(10,(e-t)/MI.nSpread));let g=v(h,I),y=v(I,h),U=MI.kCalc(e),w=MI.kCalc(n),S=MI.kMultiplier(r,c),N=h+S*U*(1-g),D=I+S*w*(0-y),P=f({sourceRange:AI.ELO.range,value:N,targetRange:p}),T=f({sourceRange:AI.ELO.range,value:D,targetRange:p});const A=d?s[0]-P:P;let M=parseFloat(A).toFixed(l);const b=d?s[0]-T:T;let E=parseFloat(b).toFixed(l);const C=Math.max(...s)?Math.abs(a-o)/Math.max(...s):0;return(P>T&&C>MI.diffThreshold||M<0||E<0)&&(M=a,E=o),{newWinnerRating:M,newLoserRating:E}}function EI({tournamentRecord:t,scaleAttributes:e,participantId:n}){if(!t)return{error:It};if(!n)return{error:Je};const{participant:i}=aa({tournamentRecord:t,participantId:n});return i?Vh({participant:i,scaleAttributes:e}):{error:Ze}}function CI({tournamentRecord:t,participantId:e,scaleItem:n}){let i,r;const a=n&&Object.keys(n)||[],o=["scaleType","eventType","scaleName"],s=o.filter((t=>a.includes(t))).length===o.length;if(!s)return{error:xn};if(e&&s&&Array.isArray(t.participants)&&(r=t.participants.find((t=>t.participantId===e)),r)){const{valueChanged:t,error:e}=OI({participant:r,scaleItem:n});if(e)return{error:e};i=!t;const{topics:a}=si();a.includes(wc)&&ri({topic:wc,payload:{participants:[r]}})}return i?{...pt,message:Wn,existingValue:n.scaleValue}:r?{...pt,newValue:n.scaleValue}:{error:Ze}}function RI({scaleItem:t}){const e=t&&Object.keys(t),n=["scaleType","eventType","scaleName"];return!!(n.filter((t=>e.includes(t))).length===n.length)}function OI({participant:t,scaleItem:e}){if(!t)return{error:Ye};const n=e&&Object.keys(e),i=["scaleType","eventType","scaleName"];if(!(i.filter((t=>n.includes(t))).length===i.length))return{error:xn};const r=(new Date).toISOString();t.timeItems||(t.timeItems=[]);const{scaleItem:a}=Vh({participant:t,scaleAttributes:e}),o=t=>[void 0,null,""].includes(t),s=!(o(null==a?void 0:a.scaleValue)&&o(e.scaleValue))&&(null==a?void 0:a.scaleValue)!==e.scaleValue;if(s){const{scaleType:n,eventType:i,scaleName:a}=e,o={itemType:[kh,n,i,a].join("."),itemValue:e.scaleValue,itemDate:e.scaleDate,createdAt:r};e.scaleId&&(o.itemSubTypes=[e.scaleId]),t.timeItems.push(o)}return Object.assign({valueChanged:s,newValue:e.scaleValue},pt)}const xI={calculateNewRatings:bI,processMatchUps:function({tournamentRecord:t,ratingType:e=DI,considerGames:n,matchUpIds:i,asDynamic:r}){if(!t)return{error:It};if(!Array.isArray(i))return{error:Ie};if("string"!=typeof e)return{error:_n,ratingType:e};if(!AI[e])return{error:_n};const a={},{matchUps:o}=fd({tournamentRecord:t,matchUpFilters:{matchUpIds:i,matchUpStatuses:B},inContext:!0});for(const p of o.sort(Kd)){const{endDate:i,matchUpFormat:o,matchUpType:d,score:m,sides:f,winningSide:h}=p,I={scaleType:jh,eventType:d,scaleName:e},v=`${e}.DYNAMIC`,g={scaleType:jh,eventType:d,scaleName:v},y=Object.assign({},...f.map((({sideNumber:t,participant:e})=>({[t]:[null==e?void 0:e.participantId,...(null==e?void 0:e.individualParticipantIds)||[]].filter(Boolean).flat()})))),U=r?v:e,w=Object.assign({},...Object.values(y).flat().map((e=>{const{scaleItem:n}=EI({scaleAttributes:g,tournamentRecord:t,participantId:e}),{scaleItem:r}=EI({tournamentRecord:t,scaleAttributes:I,participantId:e});return{[e]:n||r||{scaleName:U,scaleType:jh,eventType:d,scaleDate:i}}}))),S=l(o)||{},N=(null==S?void 0:S.bestOf)||1,D=(null==S?void 0:S.setsTo)||1,P=n?N&D:N,T=null!=m&&m.sets?(null==(u=m.sets)?void 0:u.reduce(((t,e)=>(e.winningSide&&(t[e.winningSide-1]+=1),t)),[0,0]))||[0,0]:1===h?[1,0]:[0,1],A=y[h],M=y[3-h];for(const n of A){var s;const i=null===(s=w[n])||void 0===s?void 0:s.scaleValue;for(const r of M){var c;const a=null===(c=w[r])||void 0===c?void 0:c.scaleValue,o=T[h],s=T[3-h],{newWinnerRating:u,newLoserRating:d}=bI({winnerCountables:o,loserCountables:s,maxCountables:P,winnerRating:i,loserRating:a,ratingType:e});w[n].scaleValue=u,w[r].scaleValue=d;let l=CI({scaleItem:{...w[n],scaleName:U},participantId:n,tournamentRecord:t});if(l.error)return l;if(l=CI({scaleItem:{...w[r],scaleName:U},participantId:r,tournamentRecord:t}),l.error)return l}}Object.assign(a,w)}var u;const d=o.map((({matchUpId:t})=>t));return{...pt,modifiedScaleValues:a,processedMatchUpIds:d}}};!function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>wI({convertExtensions:t,removeExtensions:e,tournamentId:ui()}),setTournamentId:t=>fi(t)};function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}return t.version=()=>"0.56.2",t.reset=()=>e(hi(ui())),t.setState=(t,n,i)=>{ii(n,i);return e(UI(t,n))},t.devContext=e=>(ni(e),t),t.getDevContext=t=>ei(t),t.executionQueue=(e,i)=>function(e,i){if(!Array.isArray(e))return{error:_n};const r=di(ui()),a=i&&Hi(r,!1,!0),o=[];for(const s of e){if("object"!=typeof s)return{error:_n};const{method:e,params:i}=s;if(!t[e])return{error:Jn};const c=n(r,t[e],i);if(null!=c&&c.error)return a&&UI(a),{...c,rolledBack:!!a};o.push(c)}return jp(),oi(),{results:o}}(e,i),[NI,xI].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{if(ei())return i(e[n],t);try{return i(e[n],t)}catch(r){console.log("%c ERROR","color: orange",{err:r})}}}))})),t;function n(e,n,i){delete t.success,delete t.error;return n({...SI(0,i),tournamentRecord:e})}function i(t,e){const i=(null==e?void 0:e.sandBoxRecord)||(null==e?void 0:e.sandboxRecord)||(null==e?void 0:e.sandboxTournament)||di(ui()),r=(null==e?void 0:e.rollbackOnError)&&Hi(i,!1,!0),a=n(i,t,e);null!=a&&a.error&&r&&UI(r);const o=(null==a?void 0:a.success)&&!0!==(null==e?void 0:e.delayNotify)&&!0!==(null==e?void 0:e.doNotNotify);return o&&jp(),(o||null==a||!a.success||null!=e&&e.doNotNotify)&&oi(),a}}();function LI(t={}){return t.tournamentId||Object.assign(t,{tournamentId:zi()}),(!t.startDate||Mi(t.startDate)||Ii.test(t.startDate))&&(!t.endDate||Mi(t.endDate)||Ii.test(t.endDate))?(t.extensions&&(t.extensions=t.filter(Kc)),{...t}):{error:Fe}}function FI(t,e){var n;if("object"!=typeof t)return{error:Bn};const i=(null===(n=t.unifiedTournamentId)||void 0===n?void 0:n.tournamentId)||t.tournamentId;if(!i)return{error:gt};const r=!1!==e?Hi(t):t;return mi({[i]:r}),fi(i),r}function kI({convertExtensions:t,removeExtensions:e,tournamentId:n}={}){if("string"!=typeof n)return{};return{tournamentRecord:Hi(di(n),t,!1,e)}}function jI(t,e,n){if(e){const{drawId:i}=e||e.matchUp&&e.matchUp.drawId;if(i){const{event:r,drawDefinition:a}=wa({tournamentRecord:t,drawId:i});if(e={...e,event:r,drawDefinition:a},n){const t=Gc({drawDefinition:a}),{matchUps:n}=pd({drawDefinition:a,inContext:!0,includeByeMatchUps:!0,matchUpsMap:t});e.matchUpsMap=t,e.inContextDrawMatchUps=n}}if(e.eventId&&!e.event){const{event:n}=wa({tournamentRecord:t,eventId:e.eventId});n&&(e={...e,event:n})}}return e}function BI({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:n,removeFromOtherTeams:i}){if(!t)return{error:It};if(!e||!n)return{error:Ee};const r=t.participants||[],a=r.find((t=>t.participantId===e));if(!a)return{error:Ze};if(![Fa,ja].includes(a.participantType))return{error:Ke,participantType:a.participantType};const o=n.filter((t=>{const e=r.find((e=>e.participantId===t));return(null==e?void 0:e.participantType)!==La}));if(o.length)return{error:qe,invalidParticipantIds:o};a.individualParticipantIds||(a.individualParticipantIds=[]);const s=a.individualParticipantIds,c=n.filter((t=>!s.includes(t)));c.length&&(i&&Uh({tournamentRecord:t,individualParticipantIds:c}),a.individualParticipantIds=a.individualParticipantIds.concat(...c));const{topics:u}=si();if(u.includes(wc)){const t=r.find((({participantId:t})=>t===e));ri({topic:wc,payload:{participants:[t]}})}return{...pt,groupingParticipant:Hi(a),added:c.length}}function _I({tournamentRecord:t,participantAttribute:e,personAttribute:n,accessor:i,uuids:r}){if(!t)return{error:It};const a={},o=(t.participants||[]).filter((({participantType:t,participantRole:e})=>t===La&&e===Dm));for(const l of o){const{value:t}=Tp({element:l,accessor:i}),o=t||(n?l.person[n]:l[e]);if(o){if(!Object.keys(a).includes(o)){a[o]={participantName:o,participantId:(null==r?void 0:r.pop())||zi(),participantType:Fa,participantRole:Dm,individualParticipantIds:[]};const t={name:Hr,value:n||e};zc({element:a[o],extension:t})}a[o].individualParticipantIds.push(l.participantId)}}const s=Object.keys(a),c=(t.participants||[]).map((t=>{if(t.participantType!==Fa)return;if(t.participantRole!==Dm)return;const{extension:e}=oa({element:t,name:Hr}),n=null==e?void 0:e.value;return s.includes(n)?t.participantId:void 0})).filter(Boolean),u=[];let d=0;return Object.keys(a).forEach((e=>{const n=a[e],{participantId:i}=n;c.includes(i)||(t.participants.push(n),u.push(n),d++)})),d&&ri({topic:pc,payload:{participants:u}}),d?{...pt,participantsAdded:d}:{error:"No matching participants found"}}const GI="MALE",VI="FEMALE",HI={ANY:"ANY",MALE:GI,FEMALE:VI,MIXED:"MIXED",OTHER:"OTHER"};function WI({updateParticipantName:t=!0,groupingParticipantId:e,removeFromOtherTeams:n,tournamentRecord:i,pairOverride:r,participant:a}){if(!i)return{error:It};if(!a)return{error:Ye};if(!a.participantId)return pp({tournamentRecord:i,participant:a});const{participant:o}=aa({tournamentRecord:i,participantId:a.participantId});if(!o)return pp({tournamentRecord:i,participant:a});const{individualParticipantIds:s,participantName:c,participantRole:u,participantType:d,onlineProfiles:l,person:p}=a,m={};if(l&&(m.onlineProfiles=l),c&&"string"==typeof c&&(m.participantName=c),Array.isArray(s)){const{tournamentParticipants:e}=bp({tournamentRecord:i,participantFilters:{participantTypes:[Ba.INDIVIDUAL]}}),n=null==e?void 0:e.map(Fc);if(n){const i=s.filter((t=>"string"==typeof t&&n.includes(t)));([ja,ma].includes(d)||d===ka&&(2===i.length||r))&&(m.individualParticipantIds=i),o.participantType===Ba.PAIR&&t&&(m.participantName=function({individualParticipants:t,newValues:e}){const n=e.individualParticipantIds;let i=t.filter((({participantId:t})=>n.includes(t))).map((({person:t})=>null==t?void 0:t.standardFamilyName)).filter(Boolean).sort().join("/");1===n.length&&(i+="/Unknown");return i}({individualParticipants:e,newValues:m}))}}return Object.keys(Pm).includes(u)&&(m.participantRole=u),Object.keys(Ba).includes(d)&&(m.participantType=d),o.participantType===Ba.INDIVIDUAL&&p&&function({updateParticipantName:t,existingParticipant:e,newValues:n,person:i}){const r={},{sex:a,personId:o,nationalityCode:s,standardFamilyName:c,standardGivenName:u}=i;a&&Object.keys(HI).includes(a)&&(r.sex=a);let d;o&&"string"==typeof o&&(r.personId=o);s&&"string"==typeof s&&s.length<4&&(r.nationalityCode=s);c&&"string"==typeof c&&c.length>1&&(r.standardFamilyName=c,d=!0);u&&"string"==typeof u&&u.length>1&&(r.standardGivenName=u,d=!0);if(d&&t){const t=`${r.standardGivenName} ${r.standardFamilyName}`;n.participantName=t}Object.assign(e.person,r)}({updateParticipantName:t,existingParticipant:o,newValues:m,person:p}),Object.assign(o,m),e&&BI({tournamentRecord:i,groupingParticipantId:e,individualParticipantIds:[o.participantId],removeFromOtherTeams:n}),ri({topic:wc,payload:{participants:[o]}}),ei()?{...pt,participant:Hi(o)}:{...pt}}const qI={addPenalty:Op,modifyPenalty:Fp,removePenalty:xp,getTournamentPenalties:Lp,addParticipant:pp,addParticipants:mp,deleteParticipants:wh,createGroupParticipant:function({tournamentRecord:t,participantId:e,individualParticipantIds:n=[],participantRoleResponsibilities:i,participantRole:r="OTHER",groupName:a}){if(!t)return{error:It};if(!a)return{error:Ee,message:"Missing groupName"};if(!Array.isArray(n))return{error:_n,message:"Invalid individualParticipantIds"};const{tournamentParticipants:o}=bp({tournamentRecord:t,participantFilters:{participantTypes:[La]}}),s=o.map((t=>t.participantId));for(const l of n)if(!s.includes(l))return{error:Ke,participantId:l};const c=Wi({participantId:e||zi(),participantType:ja,participantRole:r,participantName:a,individualParticipantIds:n,participantRoleResponsibilities:i}),u=pp({tournamentRecord:t,participant:c});if(u.error)return u;const{topics:d}=si();return d.includes(pc)&&ri({topic:pc,payload:{participants:[c]}}),{...pt,participant:Hi(c)}},addIndividualParticipantIds:BI,removeIndividualParticipantIds:gh,modifyIndividualParticipantIds:function({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:n}){if(!t)return{error:It};if(!e||!n)return{error:Ee};const i=t.participants||[],r=i.find((t=>t.participantId===e));if(!r)return{error:Ze};if(![Fa,ja].includes(r.participantType))return{error:Ke,participantType:r.participantType};const a=n.filter((t=>{const e=i.find((e=>e.participantId===t));return(null==e?void 0:e.participantType)!==La}));if(a.length)return{error:qe,invalidParticipantIds:a};const o=r.individualParticipantIds||[],s=n.filter((t=>!o.includes(t))),c=o.filter((t=>!n.includes(t))),u=BI({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:s});if(u.error)return u;const d=gh({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:c});if(d.error)return d;const{topics:l}=si();if(l.includes(wc)){const t=i.find((({participantId:t})=>t===e));ri({topic:wc,payload:{participants:[t]}})}return{...u,...d}},removeParticipantIdsFromAllTeams:Uh,getParticipantMembership:function({tournamentRecord:t,participantId:e}){if(!t)return{error:It};if(!e)return{error:Je};const{tournamentParticipants:n}=bp({tournamentRecord:t,participantFilters:{participantTypes:[Fa,ka,ja]}});return(n||[]).filter((t=>{var n;return null===(n=t.individualParticipantIds)||void 0===n?void 0:n.includes(e)})).reduce(((t,e)=>{const{participantType:n}=e;return t[n]||(t[n]=[]),t[n].push(e),t}),{})},generateTeamsFromParticipantAttribute:_I,getParticipantIdFinishingPositions:function({tournamentRecord:t,drawDefinition:e,byeAdvancements:n=!1}){return t?iI({tournamentParticipants:t.participants,byeAdvancements:n,drawDefinition:e}):{error:It}},modifyParticipant:WI,modifyParticipantName:function({tournamentRecord:t,participantId:e,participantName:n}){if(!t)return{error:It};if(!e)return{error:Je};if(!n)return{error:Ee,message:"Missing participantName"};const{participant:i}=aa({tournamentRecord:t,participantId:e});if(!i)return{error:Ze};i.participantName=n;const{topics:r}=si();return r.includes(wc)&&ri({topic:wc,payload:{participants:[i]}}),pt},modifyParticipantOtherName:function({tournamentRecord:t,participantId:e,participantOtherName:n}){if(!t)return{error:It};if(!e)return{error:Je};const{participant:i}=aa({tournamentRecord:t,participantId:e});if(!i)return{error:Ze};i.participantOtherName=n;const{topics:r}=si();return r.includes(wc)&&ri({topic:wc,payload:{participants:[i]}}),pt},mergeParticipants:function({tournamentRecord:t,participants:e=[],arraysToMerge:n}){if(!t)return{error:It};t.participants||(t.participants=[]);const i=Object.assign(...e.filter(rl).map((t=>({[t.participantId]:t})))),r=[];t.participants=t.participants.map((t=>{if(i[t.participantId]){const e=Ep(t,i[t.participantId],n);return r.push(e),e}return t}));const a=t.participants.map(Fc),o=e.filter((({participantId:t})=>!a.includes(t))),{topics:s}=si();return o.length&&(t.participants=t.participants.concat(...o),s.includes(pc)&&ri({topic:pc,payload:{participants:o}})),r.length&&s.includes(wc)&&ri({topic:wc,payload:{participants:r}}),o.length||r.length?pt:void 0},getPairedParticipant:Cc,setParticipantScaleItem:CI,setParticipantScaleItems:function({tournamentRecord:t,scaleItemsWithParticipantIds:e=[]}){if(!t)return{error:It};if(!t.participants)return{error:$e};let n=0;const i={},r=[];for(const s of e){const t=null==s?void 0:s.participantId;Array.isArray(null==s?void 0:s.scaleItems)&&s.scaleItems.forEach((e=>{if(!RI({scaleItem:e}))return{error:xn};Array.isArray(i[t])||(i[t]=[]),i[t].push(e)}))}t.participants.forEach((t=>{const{participantId:e}=t||{};Array.isArray(i[e])&&i[e].forEach((e=>{OI({participant:t,scaleItem:e}),r.push(t),n++}))}));const a=!n&&kn,{topics:o}=si();return o.includes(wc)&&n&&ri({topic:wc,payload:{participants:r}}),{...pt,modificationsApplied:n,message:a}},modifyParticipantsSignInStatus:function({tournamentRecord:t,participantIds:e,signInState:n}){if(!t)return{error:It};if(!Array.isArray(e))return{error:Ee};if(![Sp,Np].includes(n))return{error:_n,signInState:n};const i=t.participants||[];if(!i.length)return{error:$e};const r=[],a=(new Date).toISOString();for(const s of i){const{participantId:i}=s;if(e.includes(i)){const e=sc({tournamentRecord:t,duplicateValues:!1,participantId:i,timeItem:{itemType:vp,itemValue:n,createdAt:a}});if(e.error)return e;r.push(s)}}const{topics:o}=si();return r.length&&o.includes(wc)&&ri({topic:wc,payload:{participants:r}}),{...pt}},getParticipantEventDetails:function({tournamentRecord:t,participantId:e}){if(!t)return{error:It};if(!e)return{error:Je};const n=[e].concat((t.participants||[]).filter((t=>{var n;return[Fa,ka].includes(t.participantType)&&(null===(n=t.individualParticipantIds)||void 0===n?void 0:n.includes(e))})).map((t=>t.participantId)));return{eventDetails:(t.events||[]).filter((t=>ut(((null==t?void 0:t.entries)||[]).map((t=>t.participantId)),n))).map((t=>({eventName:t.eventName,eventId:t.eventId})))}},findParticipant:function({tournamentRecord:t,policyDefinitions:e,convertExtensions:n,participantId:i,inContext:r,personId:a}){return t?"string"!=typeof i&&"string"!=typeof a?{error:Ee}:{participant:Hi(ra({tournamentParticipants:t.participants||[],policyDefinitions:e,participantId:i,personId:a,inContext:r}),n,!0)}:{error:It}},getTournamentParticipants:bp,getTournamentPersons:function({tournamentRecord:t,participantFilters:e}){if(!t)return{error:It};let n=t.participants||[];e&&(n=Ap({tournamentRecord:t,participantFilters:e,participants:n}));const i={},r=t=>{if(t.person){const{personId:e}=t.person;i[e]?i[e].participantIds.push(t.participantId):i[e]={...t.person,participantIds:[t.participantId]}}};return n.forEach((t=>{t.person&&r(t),t.individualParticipants&&t.individualParticipants.forEach(r)})),{tournamentPersons:Object.values(i)}}};function KI({tournamentRecord:t,courtId:e}){if(!t)return{error:It};if(!e)return{error:be};const{court:n,error:i}=Wu({tournamentRecord:t,courtId:e});if(i)return{error:i};const r=(({altitude:t,courtId:e,courtName:n,courtDimensions:i,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d})=>({altitude:t,courtId:e,courtName:n,courtDimensions:i,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d}))(n);return{...pt,courtInfo:Hi(r)}}function zI({tournamentParticipants:t=[],policyDefinitions:e,inContext:n=!0,drawDefinition:i,context:r,event:a}){if(!i)return{error:Ut};const o=(({drawId:t,drawName:e,matchUpFormat:n,updatedAt:i})=>({matchUpFormat:n,updatedAt:i,drawName:e,drawId:t}))(i);let s,c;const{structureGroups:u}=function({drawDefinition:t}){let e=(t.links||[]).map((t=>[t.source.structureId,t.target.structureId]));const n=e.length;ot(0,Math.ceil(n/2)).forEach((()=>{e=ot(0,n).map((t=>{const n=e[t],i=e.reduce(((t,e)=>ut(n,e)?t.concat(...e):t),[])||[];return X(n.concat(...i))}))}));const i=e[0],r=(t,e)=>ct(t,e).length===t.length,a=e.slice(1).reduce(((t,e)=>t&&r(e,i)),!0),o=[i].filter(Boolean);(t.structures||[]).forEach((t=>{const{structureId:e}=t;o.find((t=>t.includes(e)))||o.push([e])}));const s=a&&1===o.length;return{structureGroups:o,allStructuresLinked:s}}({drawDefinition:i});let d=!1,l=!1;const p=u.map((u=>{const p=u.map((t=>{const{structure:e}=Wc({drawDefinition:i,structureId:t}),{seedAssignments:n}=Mu({drawDefinition:i,structure:e});return e.stage===_o&&1===e.stageSequence&&(s=n),e.stage===Go&&1===e.stageSequence&&(c=n),e})).sort(Hc).map((u=>{const{structureId:p}=u;let m=[];[_o,Vo,Wo].includes(u.stage)&&(m=s),u.stage===Go&&(m=c);const{matchUps:f,roundMatchUps:h}=ju({context:{drawId:o.drawId,...r},tournamentParticipants:t,policyDefinitions:e,seedAssignments:m,drawDefinition:i,structure:u,inContext:n,event:a}),{positionAssignments:I}=Cu({structure:u}),v=I.filter(rl).map((t=>{l=!0;const{drawPosition:e,participantId:n}=t,{extension:i}=oa({element:t,name:Qr});return i&&{drawPosition:e,participantId:n,participantResult:i.value}})).filter((t=>null==t?void 0:t.participantResult)),g=(({stage:t,stageSequence:e,structureName:n,structureType:i,matchUpFormat:r,positionAssignments:a})=>({stage:t,stageSequence:e,structureName:n,structureType:i,matchUpFormat:r,positionAssignments:a}))(u);return g.structureActive=f.reduce(((t,e)=>{var n;const i=[D,N,T,C,x,M,A].includes(e.matchUpStatus);return t||i||!!e.winningSide||!(null===(n=e.score)||void 0===n||!n.scoreStringSide1)}),!1),g.structureCompleted=f.reduce(((t,e)=>t&&[S,D,C,x,T,U].includes(e.matchUpStatus)),!0),g.structureActive&&(d=!0),{...g,structureId:p,roundMatchUps:h,seedAssignments:m,participantResults:v}}));return p.forEach((t=>delete t.positionAssignments)),p}));if(p.length>1){const t={error:"drawDefinition contains unlinked structures"};return ei()&&console.log(t),t}const m=p.flat();return o.drawActive=d,o.participantPlacements=l,o.drawGenerated=null==m?void 0:m.reduce(((t,e)=>t||!(null==e||!e.roundMatchUps)),!1),o.drawCompleted=null==m?void 0:m.reduce(((t,e)=>t&&e.structureCompleted),!0),{...pt,drawInfo:Hi(o),structures:Hi(m)}}function YI({tournamentRecord:t,venueId:e}){if(!t)return{error:It};if(!e)return{error:Dn};const{venue:n,error:i}=Vu({tournamentRecord:t,venueId:e});if(i)return{error:i};const r=(n.courts||[]).map((e=>(({courtInfo:t})=>({...t}))(KI({tournamentRecord:t,courtId:e.courtId})))),a={...(({venueId:t,venueName:e,venueAbbreviation:n})=>({venueId:t,venueName:e,venueAbbreviation:n}))(n),courtsInfo:r};return{...pt,venueData:Hi(a)}}function $I({tournamentRecord:t,event:e,policyDefinitions:n}){if(!t)return{error:It};if(!e)return{error:Yt};const{eventId:i}=e,{tournamentId:r,endDate:a,participants:o}=t,s=id({participants:o}),c=(e.drawDefinitions||[]).map((t=>(({drawInfo:t,structures:e})=>({...t,structures:e}))(zI({tournamentParticipants:s,policyDefinitions:n,drawDefinition:t,context:{eventId:i,tournamentId:r,endDate:a},event:e})))),{tournamentInfo:u}=Ed({tournamentRecord:t}),d=(t.venues||[]).map((e=>(({venueData:t})=>({...t}))(YI({tournamentRecord:t,venueId:e.venueId})))),l={eventInfo:(({eventId:t,eventName:e,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:t,eventName:e,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(e),drawsData:c,venuesData:d,tournamentInfo:u},{timeItem:p}=ac({event:e,itemType:"PUBLISH.STATUS"});return l.eventInfo.publish={state:null==p?void 0:p.itemValue,createdAt:null==p?void 0:p.createdAt},{...pt,eventData:Hi(l)}}const JI={getTournamentInfo:Ed,getVenueData:YI,getCourtInfo:KI,getAllEventData:function({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:It};const n=t.events||[],i=(null==t?void 0:t.participants)||[],{tournamentInfo:r}=Ed({tournamentRecord:t}),{venues:a}=Gu({tournamentRecord:t});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:n.map((n=>{const{eventId:r}=n,a=(({eventId:t,eventName:e,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:t,eventName:e,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(n),o=da({tournamentRecord:t,event:n}).scheduleTiming,s=(n.drawDefinitions||[]).map((a=>{const s=(({drawId:t,drawName:e,matchUpFormat:n,updatedAt:i})=>({drawId:t,drawName:e,matchUpFormat:n,updatedAt:i}))(a),{pendingMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,abandonedMatchUps:l}=md({event:n,context:{eventId:r},inContext:!0,drawDefinition:a,scheduleTiming:o,policyDefinitions:e,tournamentRecord:t,includeByeMatchUps:!1,requireParticipants:!0,tournamentParticipants:i});return{drawInfo:s,matchUps:{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}}})),{timeItem:c}=ac({event:n,itemType:"PUBLISH.STATUS"});return Object.assign(a,{publish:null==c?void 0:c.itemValue,drawsData:s}),a}))}}},getEventData:$I,getDrawData:zI,publishEvent:function({tournamentRecord:t,policyDefinitions:e,status:n=Mr,structureIds:i=[],drawIdsToRemove:r,drawIdsToAdd:a,drawIds:o,event:s}){var c,u,d;if(!t)return{error:It};if(!s)return{error:Yt};const l="PUBLISH.STATUS",p=(null===(c=s.drawDefinitions)||void 0===c?void 0:c.map((({drawId:t})=>t)))||[];if(o||a||r){if(!o&&(null!=a&&a.length||null!=r&&r.length)){var m,f;const{timeItem:t}=ac({itemType:l,event:s});o=(null==t||null===(m=t.itemValue)||void 0===m||null===(f=m.PUBLIC)||void 0===f?void 0:f.drawIds)||[]}}else o=p;o=(o||[]).filter((t=>!(null!=r&&r.length&&r.includes(t)))),null!=a&&a.length&&(o=X(o.concat(...a.filter((t=>p.includes(t)))))),uc({event:s,timeItem:{itemType:l,itemValue:{[n]:{drawIds:o,structureIds:i}}}});const{eventData:h}=$I({policyDefinitions:e,tournamentRecord:t,event:s}),I=null==h||null===(u=h.eventInfo)||void 0===u||null===(d=u.publish)||void 0===d?void 0:d.state;return h.drawsData=h.drawsData.filter((({drawId:t})=>{var e;return null==I||null===(e=I.PUBLIC)||void 0===e?void 0:e.drawIds.includes(t)})),ri({topic:Nc,payload:{eventData:h}}),{...pt,eventData:h}},unPublishEvent:function({tournamentRecord:t,event:e}){return t?e?(uc({event:e,timeItem:{itemType:"PUBLISH.STATUS",itemValue:br}}),ri({topic:"unPublishEvent",payload:{eventId:e.eventId}}),Object.assign({eventId:e.eventId},pt)):{error:Yt}:{error:It}}};const ZI={addNotes:nl,removeNotes:function({element:t}={}){return"object"!=typeof t?{error:_n}:(t.notes&&delete t.notes,pt)},setTournamentName:function({tournamentRecord:t,tournamentName:e,promotionalName:n,formalName:i}){return t?(e&&(t.tournamentName=e),n&&(t.promotionalName=n),i&&(t.formalName=i),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,pt):{error:It}},setTournamentNotes:function({tournamentRecord:t,notes:e}){return t?nl({element:t,notes:e}):{error:It}},setTournamentEndDate:function({tournamentRecord:t,endDate:e}){return t?gi.test(e)?(t.endDate&&(new Date(e),new Date(t.endDate)),t.startDate&&new Date(e)<new Date(t.startDate)&&(t.startDate=e),t.endDate=e,pt):{error:Fe}:{error:It}},setTournamentStartDate:function({tournamentRecord:t,startDate:e}){return t?gi.test(e)?(t.startDate&&(new Date(e),new Date(t.startDate)),t.endDate&&new Date(e)>new Date(t.endDate)&&(t.endDate=e),t.startDate=e,pt):{error:Fe}:{error:It}},setTournamentCategories:function({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter((t=>t.categoryName&&t.type)),t.tournamentCategories=e,pt):{error:It}},addEventTimeItem:uc,addTournamentTimeItem:cc,addParticipantTimeItem:sc,addEventExtension:Zc,removeEventExtension:Xc,addTournamentExtension:$c,removeTournamentExtension:Qc,addParticipantExtension:function({tournamentRecord:t,participantId:e,extension:n}={}){if(!e)return{error:Je};const i=ra({tournamentParticipants:(null==t?void 0:t.participants)||[],participantId:e});return i?zc({element:i,extension:n}):{error:Ze}},removeParticipantExtension:function({tournamentRecord:t,participantId:e,name:n}={}){if(!e)return{error:Je};const i=ra({tournamentParticipants:(null==t?void 0:t.participants)||[],participantId:e});return i?Yc({element:i,name:n}):{error:Ze}},addDrawDefinitionExtension:Jc,removeDrawDefinitionExtension:function({drawDefinition:t,name:e}={}){return t?Yc({element:t,name:e}):{error:St}}};const QI={assignMatchUpCourt:Ku,assignMatchUpVenue:Hu,addMatchUpScheduleItems:Tm,addMatchUpScheduledDate:Am,addMatchUpScheduledTime:Mm,addMatchUpStartTime:bm,addMatchUpEndTime:Em,addMatchUpStopTime:Cm,addMatchUpResumeTime:Rm,addMatchUpOfficial:Om,getMatchUpFormatTiming:ya,modifyMatchUpFormatTiming:_p,getModifiedMatchUpFormatTiming:Bp,getEventMatchUpFormatTiming:Wp,modifyEventMatchUpFormatTiming:Vp,removeEventMatchUpFormatTiming:vm,getMatchUpFormatTimingUpdate:function({tournamentRecord:t}){if(!t)return{error:It};const e=[],{extension:n}=sa({tournamentRecord:t,name:$r});n&&e.push({method:"addTournamentExtension",params:{extension:n}});const i=t.events||[];for(const r of i){const{eventId:t}=r,{extension:n}=ca({event:r,name:$r});n&&e.push({method:"addEventExtension",params:{eventId:t,extension:n}})}return{methods:e}},getMatchUpDailyLimits:pm,setMatchUpDailyLimits:Lm,getMatchUpDailyLimitsUpdate:function({tournamentRecord:t}){if(!t)return{error:It};const e=[],{extension:n}=sa({tournamentRecord:t,name:Yr});n&&e.push({method:"addTournamentExtension",params:{extension:n}});const i=t.events||[];for(const r of i){const{eventId:t}=r,{extension:n}=ca({event:r,name:Yr});n&&e.push({method:"addEventExtension",params:{eventId:t,extension:n}})}return{methods:e}},isValidSchedulingProfile:Md,setSchedulingProfile:function({tournamentRecord:t,schedulingProfile:e}){return t?Array.isArray(e)?Ql({tournamentRecord:t,schedulingProfile:e}):{error:_n}:{error:It}},getSchedulingProfile:Zl,removeMatchUpCourtAssignment:function({drawDefinition:t,matchUpId:e,courtDayDate:n}){return wm({drawDefinition:t,matchUpId:e,courtDayDate:n})},clearScheduledMatchUps:dm,bulkScheduleMatchUps:wd,bulkRescheduleMatchUps:xm};function XI({tournamentRecord:t,categoryName:e,categoryType:n}){if(!t)return{error:It};const{appliedPolicies:i}=ta({tournamentRecord:t}),r=null==i?void 0:i.draws;return((null==r?void 0:r.allowedDrawTypes)||[]).filter((({categoryNames:t,categoryTypes:i})=>!e&&!i||e&&(null==t?void 0:t.includes(e))||n&&(null==i?void 0:i.includes(n))))}function tv({policyDefinitions:t,drawDefinition:e,drawSize:n,drawId:i,event:r,stage:a}){if(!r)return{error:Yt};const{entries:o,stageEntries:s}=Sh({drawDefinition:e,drawId:i,stage:a,event:r}),c=s.length,{drawSize:u}=ch({participantCount:c}),{seedsCount:d,error:l}=uh({drawSize:n||u,policyDefinitions:t,participantCount:c});return l?{error:l}:{entries:o,seedsCount:d,stageEntries:s}}const ev={attachPolicies:jm,attachEventPolicies:Bm,removeEventPolicy:function({event:t,policyType:e}){if(!e)return{error:Ee};if(!t)return{error:Yt};let n;if(t.extensions){const{appliedPolicies:i}=ea({event:t});if(i&&i[e])if(delete i[e],n=!0,Object.keys(i).length){Zc({event:t,extension:{name:jr,value:i}})}else Xc({event:t,name:jr})}return n?pt:{error:Te}},findPolicy:ia,getSeedsCount:uh,getEntriesAndSeedsCount:tv,getAllowedDrawTypes:XI,getAllowedMatchUpFormats:function({tournamentRecord:t,categoryName:e,categoryType:n}){if(!t)return{error:It};const{appliedPolicies:i}=ta({tournamentRecord:t}),r=null==i?void 0:i.scoring;return((null==r?void 0:r.matchUpFormats)||[]).filter((({categoryNames:t,categoryTypes:i})=>!e&&!i||e&&(null==t?void 0:t.includes(e))||n&&(null==i?void 0:i.includes(n))))},getEventAppliedPolicies:ea},nv="COLLEGE_DEFAULT",iv="COLLEGE_JUCO",rv="COLLEGE_D3",av="DOMINANT_DUO",ov="LAVER_CUP",sv={COLLEGE_D3:rv,COLLEGE_DEFAULT:nv,COLLEGE_JUCO:iv,DOMINANT_DUO:av,LAVER_CUP:ov},cv={STANDARD:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[rv]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_D3",valueGoal:5},[nv]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:"SET1-S:6NOAD/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6NOAD/TB7"},tieFormatName:"COLLEGE_DEFAULT",valueGoal:4},[iv]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_JUCO",valueGoal:5},[ov]:jo,[av]:ko},uv=({namedFormat:t,uuids:e=[]}={})=>{var n,i;Object.keys(cv).includes(t)||(t="STANDARD"),Array.isArray(e)||(e=[]);const r=cv[t];if(!r.hydrate)return r.collectionDefinitions.forEach((t=>t.collectionId=zi())),r;const a={winCriteria:{valueGoal:r.valueGoal},collectionDefinitions:[{collectionId:(null===(n=e)||void 0===n?void 0:n.pop())||zi(),collectionName:"Doubles",matchUpType:pa,matchUpFormat:"SET3-S:6/TB7-F:TB10",...r.doubles},{collectionId:(null===(i=e)||void 0===i?void 0:i.pop())||zi(),collectionName:"Singles",matchUpType:la,matchUpFormat:"SET3-S:6/TB7",...r.singles}]};return r.tieFormatName&&(a.tieFormatName=r.tieFormatName),a};function dv({tournamentRecord:t,event:e}){if(!t)return{error:It};t.events||(t.events=[]);const{startDate:n,endDate:i}=t,r=Object.assign({},{startDate:n,endDate:i,eventType:Ma},e);e.eventType===Ea&&e.tieFormatName&&Bo[e.tieFormatName]&&(r.tieFormat=uv({namedFormat:e.tieFormatName})),r.eventId||(r.eventId=zi());return t.events.reduce(((t,e)=>t||e.eventId===r.eventId),void 0)?{error:Jt}:(t.events.push(r),{...pt,event:r})}const lv="deleteEvents",pv="deleteDrawDefinitions",mv={DELETE_EVENTS:lv,DELETE_DRAW_DEFINITIONS:pv};function fv({element:t,participantId:e,stage:n,stageSequence:i}){const r=(t.entries||[]).filter((t=>t.entryStatus===nu)),a=(t.entries||[]).find((t=>t.participantId===e))||r.reduce(((t,e)=>{const{entryPosition:n}=e;return isNaN(n)?t:!t||n<t.entryPosition?e:t}),void 0);if(!a)return{error:pn};if(a.entryStatus!==nu)return{error:ln};if(a.stage&&a.entryStage!==n)return{error:"Participant not entered in stage"};if(i&&a.stageSequence!==i)return{error:"Participant not found in stageSequence"};a.entryStatus=ou;const o=null==a?void 0:a.entryPosition;isNaN(o)||t.entries.forEach((t=>{t.entryStatus===nu&&t.entryPosition>o&&(t.entryPosition=t.entryPosition-1)}));let s=Math.max(...t.entries.filter((t=>t.entryStatus===ou&&!isNaN(t.entryPosition))).map((({entryPosition:t})=>parseInt(t||0))),0);return a.entryPosition=s||0,pt}function hv({event:t,participants:e,ignoreGender:n}){if(!e)return{error:$e};if(!t)return{error:Yt};const{eventType:i,gender:r}=t,a=i===la?La:i===pa?ka:ma,o=Object.assign({},...(t.entries||[]).map((t=>({[t.participantId]:t.entryStatus})))),s=Object.keys(o),c=e.filter((t=>s.includes(t.participantId))).filter((t=>{const e=o[t.participantId],s=i===pa&&t.participantType===La&&(Ih(e)||e===du),c=t.participantType!==a&&!s,u=!n&&i===La&&[GI,VI].includes(r)&&t.sex!==r;return c||u}));if(c.length){const t=c.map((t=>t.participantId));return{error:Qt,invalidParticipantIds:t}}return pt}function Iv({candidatesCount:t=1,tournamentRecord:e,drawDefinition:n,structureId:i,seedsOnly:r,event:a}){if(!a)return{error:$t};if(!n)return{error:St};const o=null==e?void 0:e.participants,{playoffStructures:s}=Pl({drawDefinition:n,structureId:i});if(s)for(const c of s){const{structureId:e}=c,i=Df({structureId:e,candidatesCount:t,drawDefinition:n,participants:o,seedsOnly:r});if(i.error)return i}return{...pt}}function vv({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:n,drawDefinition:i,participantIds:r,collectionId:a}){var o;if(!a||!t||!Array.isArray(r))return{error:_n,modifiedLineUp:(null==n?void 0:n.lineUp)||[]};const s=(null==n?void 0:n.lineUp)||(null===(o=Rc({participantId:e,drawDefinition:i}))||void 0===o?void 0:o.lineUp);return{modifiedLineUp:(null==s?void 0:s.map((e=>{var n;if(!r.includes(e.participantId))return e;const i=null===(n=e.collectionAssignments)||void 0===n?void 0:n.filter((e=>!(e.collectionId===a&&e.collectionPosition===t)));return{participantId:e.participantId,collectionAssignments:i}})).filter(Boolean))||[]}}function gv({lineUp:t,tieFormat:e}){var n;let i=[];if(!Array.isArray(t))return i.push("lineUp must be an array of objects"),{valid:!1,errors:i,error:_n};const r=(null==e||null===(n=e.collectionDefinitions)||void 0===n?void 0:n.map((({collectionId:t})=>t)))||[],a=t.every((t=>{if("object"!=typeof t)return i.push("lineUp entries must be objects"),!1;const{participantId:e,collectionAssignments:n}=t;return e?"string"!=typeof e?(i.push("participantIds must be strings"),!1):Array.isArray(n)?n.every((t=>{if("object"!=typeof t)return i.push("collectionAssignments must be objects"),!1;const{collectionPosition:e,collectionId:n}=t;return"number"!=typeof e?(i.push("collectionPosition must be a number"),!1):!!r.includes(n)||(i.push("Invalid collectionId"),!1)})):(i.push("collectionAssignments must be an array"),!1):(i.push("Missing participantId"),!1)})),o=X(t.map(Fc)).length===t.length;o||i.push("Duplicated participantId(s)");return{valid:a&&o,errors:i,error:i.length?_n:void 0}}function yv({drawDefinition:t,participantId:e,tieFormat:n,lineUp:i}){if("object"!=typeof t)return{error:Ut};if("string"!=typeof e)return{error:Je};const r=gv({lineUp:i,tieFormat:n});if(!r.valid)return r;const{extension:a}=oa({element:t,name:Wr}),o=(null==a?void 0:a.value)||{},s=i.map(Fc);if(Object.keys(o).filter((t=>t!==e)).find((t=>{const n=o[t],r=ct(n.map(Fc),s);return r.length&&console.log({overlap:r,submittedParticipantId:e,submittedLineUp:i,storedParticipantId:t,storedLineUp:n}),r.length})))return{error:"lineUp conflict"};o[e]=i;return zc({element:t,extension:{name:Wr,value:o}}),bc({drawDefinition:t}),{...pt}}function Uv({tournamentRecord:t,drawDefinition:e,tieMatchUpId:n,event:i}){if(!t)return{error:It};if(!e)return{error:xt};if(!i)return{error:$t};const r=Gc({drawDefinition:e}),{matchUp:a,structure:o}=Bu({tournamentParticipants:t.participants,matchUpId:n,inContext:!0,drawDefinition:e,matchUpsMap:r,event:i});if(!a)return{error:he};const{collectionPosition:s,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:l}=a;if(![la,pa].includes(l))return{error:ge};const{positionAssignments:p}=Cu({structure:o}),m=null==p?void 0:p.filter((t=>null==c?void 0:c.includes(t.drawPosition))),f=Lc(m),{tournamentParticipants:h}=bp({tournamentRecord:t,participantFilters:{participantTypes:[Fa],participantIds:f}}),{matchUp:I}=Bu({matchUpId:d,drawDefinition:e,matchUpsMap:r});return{relevantAssignments:m,collectionPosition:s,teamParticipants:h,collectionId:u,matchUpType:l,dualMatchUp:I,tieMatchUp:a,tieFormat:I.tieFormat||o.tieFormat||e.tieFormat||i.tieFormat,structure:o,...pt}}function wv({collectionPosition:t,teamParticipantId:e,drawDefinition:n,modifiedLineUp:i,participantId:r,collectionId:a,tieFormat:o}){var s,c;const u=null===(s=Rc({participantId:e,drawDefinition:n}))||void 0===s?void 0:s.lineUp,d=null===(c=i||u)||void 0===c?void 0:c.find((t=>(null==t?void 0:t.participantId)===r)),l={collectionId:a,collectionPosition:t};if(d)d.collectionAssignments.push(l);else{const t={collectionAssignments:[l],participantId:r};i.push(t)}e&&yv({participantId:e,lineUp:i,drawDefinition:n,tieFormat:o})}function Sv({drawDefinition:t,participantIds:e}){if("object"!=typeof t)return{error:Ut};if(!Array.isArray(e))return{error:qe};const{extension:n}=oa({element:t,name:Wr}),i=(null==n?void 0:n.value)||{},r=Object.keys(i).find((t=>i[t].map(Fc).some((t=>e.includes(t)))));return{lineUp:i[r],teamParticipantId:r}}function Nv({tournamentRecord:t,drawIds:e=[],auditData:n,eventId:i}){var r;if(!t)return{error:It};const a=Array.isArray(e)&&e[0],{event:o,error:s}=wa({tournamentRecord:t,eventId:i,drawId:a});if(s)return{error:s};const c=[],u=[],d=[];if(!o.drawDefinitions)return{error:St};const l=o.drawDefinitions.map((({drawId:t})=>t));e.length||(e=l);if(!(e.length&&e.every((t=>l.includes(t)))))return{error:St};o.drawDefinitions=o.drawDefinitions.filter((t=>{if(e.includes(t.drawId)){const e={action:pv,payload:{drawDefinitions:[t],eventId:o.eventId,auditData:n}};c.push(e);const{drawId:i,drawType:r,drawName:a}=t;d.push({auditData:n,drawId:i,drawType:r,drawName:a,eventId:o.eventId});const{matchUps:s}=hd({event:o,drawDefinition:t});s.forEach((({matchUpId:t})=>u.push(t)))}return!e.includes(t.drawId)})),Ql({tournamentRecord:t});const{timeItem:p}=rc({element:o,itemType:"PUBLISH.STATUS"}),m=null==p||null===(r=p.itemValue)||void 0===r?void 0:r.PUBLIC;for(const I of e){var f;if(null==m||null===(f=m.drawIds)||void 0===f?void 0:f.includes(I)){var h;const t=(null===(h=m.drawIds)||void 0===h?void 0:h.filter((t=>t!==I)))||[],e=uc({event:o,timeItem:{itemType:"PUBLISH.STATUS",itemValue:{[Mr]:{drawIds:t}}}});if(e.error)return{error:e.error}}}if(c.length){ri({topic:fc,payload:c});const t=uc({event:o,timeItem:{itemType:pv,itemValue:d}});if(t.error)return t}return u.length&&Ac({matchUpIds:u}),function({drawId:t}){ri({topic:hc,payload:{drawId:t}})}({drawId:a}),pt}function Dv({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:n,scaleSortMethod:i,entries:r,event:a,stage:o}){if(!e)return{error:It};return{scaledEntries:(r=r||(null==a?void 0:a.entries)||[]).filter((t=>(!o||!t.entryStage||t.entryStage===o)&&hu.includes(t.entryStatus))).map((t=>{const{participantId:i}=t,{scaleItem:r}=EI({tournamentRecord:e,scaleAttributes:n,participantId:i});return{...t,...r}})).filter((t=>{const e=t.scaleValue;return!!(i||!isNaN(e)&&parseFloat(e))&&e})).sort(i||function(e,n){return t?s(n)-s(e):s(e)-s(n)})};function s(e){return parseFloat(e.scaleValue||(t?-1:1e5))}}function Pv(t){const{drawType:e=us,enforcePolicyLimits:n=!0,finishingPositionNaming:i,ignoreAllowedDrawTypes:r,seedAssignmentProfile:a,playoffMatchUpFormat:o,seedByRanking:s=!0,qualifyingPositions:c,seededParticipants:u,policyDefinitions:d,seedingScaleName:l,assignSeedsCount:p,automated:m=!0,qualifyingRound:f,seedingProfile:h,tieFormatName:I,stage:v=_o,drawEntries:g,feedPolicy:y,idPrefix:U,drawId:w,isMock:S,uuids:N}=t,{tournamentRecord:D,event:P}=t;let{drawName:T,matchUpType:A,structureOptions:M}=t;const b=null==D?void 0:D.participants,E=P&&b&&hv({event:P,participants:b});if(null!=E&&E.error)return E;const C=!r&&D&&XI({tournamentRecord:D,categoryType:null==P?void 0:P.categoryType,categoryName:null==P?void 0:P.categoryName});if(null!=C&&C.length&&!C.includes(e))return{error:"Invalid drawType"};let{seedsCount:R,drawSize:O=32,tieFormat:x,matchUpFormat:L}=t;"number"!=typeof O&&(O=parseInt(O)),"number"!=typeof R&&(R=parseInt(R||0));const F=null==P?void 0:P.eventType;A=A||F,A===ma&&F===ma?(x=x||null!=P&&P.tieFormat||I?"object"==typeof x?x:I?uv({namedFormat:I}):"object"==typeof(null==P?void 0:P.tieFormat)&&P.tieFormat:uv(),L=void 0):L||(x=void 0,L="SET3-S:6/TB7");const k=g||(null==P?void 0:P.entries)||[],j=k.filter((t=>(!t.entryStage||t.entryStage===v)&&hu.includes(t.entryStatus)));[Ns].includes(e)&&(O=j.length||O);const B=II({drawType:e,drawId:w});if(Ff({drawDefinition:B,stage:v,drawSize:O}),g){g.reduce(((t,e)=>t.includes(e.entryStage)?t:t.concat(e.entryStage)),[]).filter((t=>t!==v)).filter(Boolean).length&&console.log("drawEntryStages")}if(L||x){if(!(L&&(null==P?void 0:P.matchUpFormat)===L||(null==P?void 0:P.tieFormat)&&x&&JSON.stringify(P.tieFormat)===JSON.stringify(x))){let t=zl({drawDefinition:B,matchUpFormat:L,tieFormat:x,event:P});if(t.error)return{error:t.error,message:"matchUpFormat or tieFormat error"};A&&(B.matchUpType=A),x&&(B.tieFormat=x),t.tieFormat&&(x=t.tieFormat)}}x=x||(null==P?void 0:P.tieFormat);let _=ah({finishingPositionNaming:i,goesTo:t.goesTo,playoffMatchUpFormat:o,qualifyingPositions:c,structureOptions:M,qualifyingRound:f,drawDefinition:B,seedingProfile:h,matchUpFormat:L,matchUpType:A,feedPolicy:y,tieFormat:x,drawType:e,idPrefix:U,isMock:S,stage:v,uuids:N});if(_.error)return _;const{matchUpsMap:G,inContextDrawMatchUps:V}=_,{structures:H}=eh({drawDefinition:B,stageSequence:1,stage:v}),[W]=H,{structureId:q}=W||{};if("object"==typeof d)for(const tt of Object.keys(d))tI({policyDefinitions:{[tt]:d[tt]},drawDefinition:B});const{policyDefinitions:K}=il({policyTypes:[cr],tournamentRecord:D,drawDefinition:B,event:P})||{};null!=d&&d.seeding||null!=K&&K.seeding||tI({drawDefinition:B,policyDefinitions:$s});const{policyDefinitions:z}=il({policyTypes:[sr],tournamentRecord:D,drawDefinition:B,event:P})||{};null!=d&&d.avoidance||null==z||!z.avoidance||tI({drawDefinition:B,policyDefinitions:z});for(const tt of k){const t=Ph({...tt,entryStage:tt.entryStage||_o,drawDefinition:B});if(g&&t.error)return t}const Y=k.map(Fc);u&&(R=u.length),R>O&&(R=O),R>j.length&&(R=j.length);const{seedLimit:$}=dh({participantCount:j.length,enforcePolicyLimits:n,tournamentRecord:D,drawDefinition:B,structureId:q,seedsCount:R,event:P});if($&&$<R&&(R=$),u)u.filter((({participantId:t})=>Y.includes(t))).filter((t=>!t.seedNumber||t.seedNumber<=u.length)).sort(((t,e)=>t.seedNumber<e.seedNumber?-1:t.seedNumber<e.seedNumber?1:0)).forEach((t=>{const{participantId:e,seedNumber:n,seedValue:i}=t;lI({drawDefinition:B,participantId:e,structureId:q,seedNumber:n,seedValue:i})}));else if(null!=P&&P.category||l){var J,Z;const{categoryName:t,ageCategoryCode:e}=(null==P?void 0:P.category)||{},n={scaleType:_h,scaleName:l||t||e,eventType:F};let{scaledEntries:i}=Dv({scaleAttributes:n,tournamentRecord:D,entries:k,stage:v});if((null===(J=i)||void 0===J||!J.length)&&s){const n={scaleType:Bh,scaleName:t||e,eventType:F};({scaledEntries:i}=Dv({scaleAttributes:n,tournamentRecord:D,entries:k,stage:v}))}const r=(null===(Z=i)||void 0===Z?void 0:Z.length)||0;r<R&&(R=r),i&&i.filter((({participantId:t})=>Y.includes(t))).slice(0,p||R).forEach(((t,e)=>{const n=e+1,i=(null==a?void 0:a[n])||n,{participantId:r}=t;lI({drawDefinition:B,participantId:r,structureId:q,seedNumber:n,seedValue:i})}))}let Q=[];if(!1!==m){const t="object"==typeof m&&m.seedsOnly;({conflicts:Q}=Df({drawDefinition:B,participants:b,structureId:q,seedsOnly:t,inContextDrawMatchUps:V,matchUpsMap:G}))}T=T||e,B&&Object.assign(B,{drawName:T});const X={drawId:B.drawId,category:null==P?void 0:P.category,eventId:null==P?void 0:P.eventId,seedingScaleName:l,matchUpType:A,seedsCount:R,automated:m,tieFormat:x,drawSize:O,drawType:e,drawName:T};return ri({topic:fc,payload:{action:"generateDrawDefinition",payload:X}}),{...pt,structureId:q,drawDefinition:B,conflicts:Q}}function Tv({tournamentRecord:t,drawDefinition:e,participantId:n,entryPosition:i,event:r}){return t?n?void 0===i||Number.isSafeInteger(i)?(((null==r?void 0:r.entries)||[]).forEach((t=>{t.participantId===n&&(t.entryPosition=i)})),((null==e?void 0:e.entries)||[]).forEach((t=>{t.participantId===n&&(t.entryPosition=i)})),pt):{error:_n,entryPosition:i}:{error:Je}:{error:It}}function Av({playoffStructureNameBase:t,playoffAttributes:e,playoffPositions:n,exitProfileLimit:i,tournamentRecord:r,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l}){if(!r)return{error:It};const p=$f({playoffStructureNameBase:t,playoffAttributes:e,playoffPositions:n,exitProfileLimit:i,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l});return cc({tournamentRecord:r,timeItem:{itemType:"addPlayoffStructures",itemValue:{playoffStructureNameBase:t,playoffPositions:n,roundNumbers:s,structureId:c}}}),p}function Mv({scaledEntries:t,seedsCount:e,scaleAttributes:n,scaleName:i,stageEntries:r}){if(!n)return{error:Ee};const a=Object.assign({},...(t||[]).slice(0,e).map((({participantId:t},e)=>({[t]:e+1}))));i=i||n.scaleName;const o=(new Date).toISOString();return{scaleItemsWithParticipantIds:r.map((({participantId:t})=>({participantId:t,scaleItems:[{scaleValue:a[t],eventType:n.eventType,scaleType:_h,scaleName:i,scaleDate:o}]})))}}function bv({tournamentRecord:t,drawDefinition:e,scaleAttributes:n,drawId:i,event:r,stage:a}){if(!r)return{error:Yt};let o=r.entries;if(i){var s;const{flightProfile:t}=ol({event:r}),n=null==t||null===(s=t.flights)||void 0===s?void 0:s.find((t=>t.drawId===i));o=n?n.drawEntries:null==e?void 0:e.entries}return function({tournamentRecord:t,participantIds:e,scaleAttributes:n}){var i;if(!t)return{error:It};if(!e)return{error:tn};if(!n)return{error:Ee,message:"scaleAttributes required"};const{scaleType:r,eventType:a,scaleName:o}=n,s=[Nr,r,a,o].join(".");return null===(i=t.participants)||void 0===i||i.forEach((t=>{e.includes(t.participantId)&&t.timeItems&&(t.timeItems=t.timeItems.filter((t=>t&&(null==t?void 0:t.itemType)!==s)))})),pt}({tournamentRecord:t,participantIds:(o||[]).filter((t=>(!a||!t.entryStage||t.entryStage===a)&&hu.includes(t.entryStatus))).map(Fc),scaleAttributes:n})}function Ev({deleteExisting:t,event:e,flightProfile:n}){var i;if(!n)return{error:Ee};if(!e)return{error:Yt};const{flightProfile:r}=ol({event:e});if(r&&Ev&&!t)return{error:Yn};if(null!==(i=e.drawDefinitions)&&void 0!==i&&i.length)return{error:wt};return Zc({event:e,extension:{name:Vr,value:n}}),{flightProfile:Hi(n,!1,!0),...pt}}const Cv="splitWaterfall",Rv="splitShuttle",Ov={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:Cv,SPLIT_SHUTTLE:Rv};function xv({qualifyingPositions:t,drawEntries:e=[],matchUpValue:n,drawName:i,drawId:r,event:a,stage:o}){var s,c;if(!a)return{error:Yt};if(!i)return{error:Ee};if(null!=e&&e.length){const t=Lc(a.entries||[]),n=Lc(e);if(ct(n,t).length!==n.length)return{error:_n}}const{flightProfile:u}=ol({event:a}),d=(null==u||null===(s=u.flights)||void 0===s||null===(c=s.map((({flightNumber:t})=>!isNaN(t)&&parseInt(t))))||void 0===c?void 0:c.filter(Boolean))||[],l=Math.max(0,...d)+1,p={drawId:r||zi(),flightNumber:l,matchUpValue:n,drawEntries:e,drawName:i};o&&(p.stage=o),t&&(p.qualifyingPositions=t);if(((null==u?void 0:u.flights)||[]).find((({drawId:t})=>t===p.drawId)))return{error:zn};const m=((null==u?void 0:u.flights)||[]).concat(p);return Zc({event:a,extension:{name:Vr,value:{...u||{},flights:m}}})}function Lv({tournamentRecord:t,event:e,startDate:n}){if(!t)return{error:It};if(!e)return{error:Yt};if(!gi.test(n))return{error:Fe};const{tournamentStartDate:i,tournamentEndDate:r,error:a}=kv(t);if(a)return{error:a};const o=new Date(Oi(n));if(o<i||o>r)return{error:Fe};const s=e.endDate&&new Date(Oi(e.endDate));return s&&o>s&&(e.endDate=n),e.startDate=n,pt}function Fv({tournamentRecord:t,event:e,endDate:n}){if(!t)return{error:It};if(!e)return{error:Yt};if(!gi.test(n))return{error:Fe};const{tournamentStartDate:i,tournamentEndDate:r,error:a}=kv(t);if(a)return{error:a};const o=new Date(Oi(n));if(o<i||o>r)return{error:Fe};const s=e.startDate&&new Date(Oi(e.startDate));return s&&o<s&&(e.startDate=n),e.endDate=n,pt}function kv(t){const{startDate:e,endDate:n}=t;return gi.test(e)&&gi.test(n)?{tournamentStartDate:new Date(Oi(e)),tournamentEndDate:new Date(Oi(n))}:{error:je}}const jv={addEvent:dv,deleteEvents:function({tournamentRecord:t,eventIds:e}){if(!t)return{error:It};if(!t.events)return{error:$t};if(!Array.isArray(e))return{error:Ee};const n=[],i=[];if(t.events=(t.events||[]).filter((t=>{if(e.includes(t.eventId)){const e={action:lv,payload:{events:[t]}};n.push(e),i.push({eventName:t.eventName,eventType:t.eventType,category:t.category,eventId:t.eventId,gender:t.gender})}return!e.includes(t.eventId)})),Ql({tournamentRecord:t}),n.length){ri({topic:fc,payload:n});cc({tournamentRecord:t,timeItem:{itemType:lv,itemValue:i}})}return pt},setEventDates:function({tournamentRecord:t,event:e,startDate:n,endDate:i}){if(!t)return{error:It};if(!e)return{error:Yt};if(!n&&!i)return{error:Ee};if(n&&!gi.test(n))return{error:Fe};if(i&&!gi.test(i))return{error:Fe};if(n&&i){if(new Date(Oi(n))>new Date(Oi(i)))return{error:_n}}if(n){const{error:i}=Lv({tournamentRecord:t,event:e,startDate:n});if(i)return{error:i}}if(i){const{error:n}=Fv({tournamentRecord:t,event:e,endDate:i});if(n)return{error:n}}return pt},setEventStartDate:Lv,setEventEndDate:Fv,autoSeeding:function({tournamentRecord:t,drawDefinition:e,policyDefinitions:n,scaleAttributes:i,scaleName:r,drawSize:a,drawId:o,event:s,stage:c,sortDescending:u,scaleSortMethod:d}){const{error:l,entries:p,seedsCount:m,stageEntries:f}=tv({drawDefinition:e,drawId:o,event:s,policyDefinitions:n,drawSize:a,stage:c});if(l)return{error:l};const{scaledEntries:h}=Dv({scaleAttributes:i,tournamentRecord:t,scaleSortMethod:d,sortDescending:u,entries:p,stage:c}),{scaleItemsWithParticipantIds:I}=Mv({scaledEntries:h,seedsCount:m,scaleAttributes:i,scaleName:r,stageEntries:f});return{scaleItemsWithParticipantIds:I}},removeSeeding:function({tournamentRecord:t,drawDefinition:e,scaleName:n,drawId:i,event:r,stage:a}){var o,s;return t?r?(n=n||(null===(o=r.category)||void 0===o?void 0:o.categoryName)||(null===(s=r.category)||void 0===s?void 0:s.ageCategoryCode),bv({tournamentRecord:t,scaleAttributes:{eventType:r.eventType,scaleType:_h,scaleName:n},drawDefinition:e,drawId:i,event:r,stage:a})):{error:Yt}:{error:It}},removeScaleValues:bv,addDrawEntries:Ah,checkValidEntries:hv,modifyDrawName:Lf,addDrawDefinition:dp,addPlayoffStructures:Av,deleteDrawDefinitions:Nv,getAvailablePlayoffRounds:function({drawDefinition:t,structureId:e}){return Hf({drawDefinition:t,structureId:e})},removeStructure:oh,generateSeedingScaleItems:Mv,setSubOrder:xh,addEventEntries:bh,promoteAlternate:function({tournamentRecord:t,drawDefinition:e,event:n,participantId:i,stage:r=_o,stageSequence:a}){if(!t)return{error:It};if(!n)return{error:Yt};if(n){const t=fv({element:n,participantId:i,stageSequence:a,stage:r});if(t.error)return t}if(e){const t=fv({element:e,participantId:i,stageSequence:a,stage:r});if(t.error)return t}return pt},destroyPairEntry:Eh,setEntryPosition:Tv,setEntryPositions:function({tournamentRecord:t,entryPositions:e,drawDefinition:n,event:i}){if(!t)return{error:It};if(!Array.isArray(e))return{error:_n};for(const r of e){const{participantId:e,entryPosition:a}=r,o=Tv({tournamentRecord:t,drawDefinition:n,participantId:e,entryPosition:a,event:i});if(o.error)return o}return{...pt}},addEventEntryPairs:function({event:t,uuids:e,drawDefinition:n,tournamentRecord:i,entryStage:r=_o,entryStatus:a=nu,participantIdPairs:o=[],allowDuplicateParticipantIdPairs:s}){if(!i)return{error:It};if(!t)return{error:Yt};if(t.eventType!==pa)return{error:zt};const c=i.participants||[],u=c.filter((t=>t.participantType===La)).map((t=>t.participantId)),d=u.filter((t=>!u.includes(t)));if(d.length)return{error:qe,invalidParticipantIds:d};const l=o.filter((t=>2!==t.length));if(l.length)return{error:qe,invalidParticipantIdPairs:l};const p=c.filter((t=>t.participantType===ka)).map((t=>t.individualParticipantIds)),m=o.map((t=>({participantId:(null==e?void 0:e.pop())||zi(),participantType:ka,participantRole:Dm,individualParticipantIds:t}))),f=s?m:m.filter((t=>!p.find((e=>2===ct(e,t.individualParticipantIds).length))));let h,I=[];if(f){const t=mp({tournamentRecord:i,participants:f,allowDuplicateParticipantIdPairs:s});if(t.error)return t;I=t.participants||[],h=t.message}const v=o.map((t=>{const e=I.find((e=>2===ct(e.individualParticipantIds,t).length));if(e)return e;const{participant:n}=Cc({tournamentRecord:i,participantIds:t});return n})).map((t=>t.participantId)),g=bh({event:t,entryStage:r,entryStatus:a,drawDefinition:n,tournamentRecord:i,participantIds:v});return f.length&&ri({topic:pc,participants:f}),{...g,message:h,newParticipantIds:f.map(Fc)}},removeEventEntries:Nh,removeDrawEntries:function({participantIds:t,drawDefinition:e,drawId:n,event:i,autoEntryPositions:r=!0}){var a;if(!i)return{error:Yt};if(!n)return{error:xt};if(!t||!t.length)return{error:tn};const o=fh({drawDefinition:e});if(ut(t,o))return{error:sn};const s=e=>{const n=e.participantId;return!t.includes(n)},{flightProfile:c}=ol({event:i}),u=null==c||null===(a=c.flights)||void 0===a?void 0:a.find((t=>t.drawId===n));return null!=u&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),r&&(u.drawEntries=hh({entries:u.drawEntries}))),null!=e&&e.entries&&(e.entries=e.entries.filter(s),r&&(e.entries=hh({entries:e.entries}))),pt},modifyEventEntries:function({event:t,tournamentRecord:e,entryStage:n=_o,participantIdPairs:i=[],unpairedParticipantIds:r=[],entryStatus:a=ou}){if(!e)return{error:It};if(!t)return{error:Yt};const o=e.participants||[],s=o.filter((t=>t.participantType===La)).map((t=>t.participantId)),c=r.concat(...i).flat(1/0).filter((t=>!s.includes(t)));if(c.length)return{error:qe,invalidParticipantIds:c};const u=i.filter((t=>2!==t.length));if(u.length)return{error:qe,invalidParticipantIdPairs:u};const d=o.filter((t=>t.participantType===ka)).map((t=>t.individualParticipantIds)),l=i.filter((t=>!d.find((e=>2===ct(e,t).length)))).map((t=>({participantType:ka,participantRole:Dm,individualParticipantIds:t}))),p=mp({tournamentRecord:e,participants:l});if(p.error)return p;const m=i.map((t=>{const{participant:n}=Cc({tournamentRecord:e,participantIds:t});return n})).map((t=>({participantId:t,entryStatus:a,entryStage:n}))),f=r.map((t=>({entryStatus:pu,participantId:t,entryStage:n})));return t.entries=(t.entries||[]).filter((t=>t.entryStage===n)),t.entries=t.entries.concat(...m,...f),pt},modifyEntriesStatus:vh,modifySeedAssignment:function({tournamentRecord:t,drawDefinition:e,participantId:n,structureId:i,seedValue:r}){return t?(t.participants||[]).find((t=>t.participantId===n))?dI({drawDefinition:e,participantId:n,structureId:i,seedValue:r}):{error:We}:{error:It}},deleteFlightProfileAndFlightDraws:function({tournamentRecord:t,event:e}){if(!t)return{error:It};if(!e)return{error:Yt};const{flightProfile:n}=ol({event:e});if(n){var i;const r=null===(i=n.flights)||void 0===i?void 0:i.map((({drawId:t})=>t)).filter(Boolean),a=Nv({tournamentRecord:t,eventId:e.eventId,drawIds:r});return a.error?a:Xc({event:e,name:Vr})}return pt},deleteFlightAndFlightDraw:function({tournamentRecord:t,event:e,drawId:n,auditData:i}){if(!t)return{error:It};if(!n)return{error:xt};if(!e)return{error:Yt};const{flightProfile:r}=ol({event:e});var a;if(r&&(null===(a=r.flights)||void 0===a?void 0:a.find((t=>t.drawId===n)))){const t=r.flights.filter((t=>t.drawId!==n));Zc({event:e,extension:{name:Vr,value:{...r,flights:t}}})}return Nv({tournamentRecord:t,eventId:e.eventId,drawIds:[n],auditData:i}),pt},generateFlightProfile:function({drawNameRoot:t="Flight",attachFlightProfile:e,tournamentRecord:n,scaleAttributes:i,scaleSortMethod:r,deleteExisting:a,sortDescending:o,drawNames:s=[],flightsCount:c,flightValues:u,splitMethod:d,uuids:l=[],event:p,stage:m}){if(!p)return{error:Yt};const f=p.entries||[],{flightProfile:h}=ol({event:p});if(h&&e&&!a)return{error:Yn};const{scaledEntries:I}=Dv({tournamentRecord:n,scaleAttributes:i,scaleSortMethod:r,sortDescending:o,event:p,stage:m}),v=I.map(Fc),g=f.filter((({participantId:t})=>!v.includes(t))).filter((t=>(!m||!t.entryStage||t.entryStage===m)&&hu.includes(t.entryStatus))),y=I.concat(...g),U=y.length;let w=dt(y,Math.ceil(U/c));d===Cv?w=lt(y,c):d===Rv&&(w=lt(y,c,!0));const S={scaleAttributes:i,splitMethod:d,flights:ot(0,c).map((e=>{var n;const i=e+1,r={flightNumber:i,drawId:(null==l?void 0:l.pop())||zi(),drawEntries:(a=w[e],(a||[]).map((({participantId:t})=>f.find((e=>e.participantId===t))))),drawName:(null==s?void 0:s.length)&&s[e]||`${t} ${i}`};var a;const o=null==u||null===(n=u.find((t=>t.flightNumber===i)))||void 0===n?void 0:n.matchUpValue;return o&&(r.matchUpValue=o),r}))};if(e){const t=Ev({flightProfile:S,deleteExisting:a,event:p});return{splitEntries:ei()&&w||void 0,...t}}return{flightProfile:S,...pt}},attachFlightProfile:Ev,updateDrawIdsOrder:function({event:t,orderedDrawIdsMap:e}){var n,i;if("object"!=typeof t)return{error:Yt};if(!e)return{error:Ee,message:"Missing drawIdsOrderMap"};if("object"!=typeof e)return{error:_n,message:"orderedDrawIdsMap must be an object"};const r=Object.values(e);if(!r.every((t=>!isNaN(t))))return{error:_n,message:"drawOrder must be numeric"};if(X(r).length!==r.length)return{error:_n,message:"drawOrder values must be unique"};if(null!==(n=t.drawDefinitions)&&void 0!==n&&n.length){const n=(t.drawDefinitions||[]).map((({drawId:t})=>t));if(ct(n,Object.keys(e)).length!==n.length)return{error:_n,message:"Missing drawIds"};t.drawDefinitions.forEach((t=>{t.drawOrder=e[t.drawId]}))}const{flightProfile:a}=ol({event:t});return null==a||null===(i=a.flights)||void 0===i||i.forEach((t=>{t.flightNumber=e[t.drawId]})),pt},getFlightProfile:ol,getScaledEntries:Dv,addFlight:xv,addAdHocMatchUps:function(t){return Of(t)},generateAdHocMatchUps:function(t){return xf(t)},deleteAdHocMatchUps:function(t){return Jf(t)},drawMatic:function(t){var e;const n=null===(e=t.tournamentRecord)||void 0===e?void 0:e.participants;return Object.assign(t,{tournamentParticipants:n}),Yh(t)},setOrderOfFinish:function(t){return Qh(t)},setDelegatedOutcome:function(t){return Jh(t)},removeDelegatedOutcome:function(t){return Fh(t)},addVoluntaryConsolationStage:function({drawDefinition:t,drawSize:e}){return kf({drawDefinition:t,drawSize:e})},generateVoluntaryConsolationStructure:function(t){const{tournamentRecord:e}=t;return e?Rf({participants:e.participants,...t}):{error:It}},setMatchUpStatus:$l,bulkMatchUpStatusUpdate:Jl,setDrawDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:n}){return t?e?n?zl({drawDefinition:e,matchUpFormat:n}):{error:de}:{error:Ut}:{error:It}},setEventDefaultMatchUpFormat:function({tournamentRecord:t,event:e,matchUpFormat:n}){return t?n?e?v(n)?(e.matchUpFormat=n,pt):{error:ae}:{error:Yt}:{error:de}:{error:It}},setStructureDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:n,structureId:i,event:r}){return t?e?n?i?zl({drawDefinition:e,matchUpFormat:n,structureId:i,event:r}):{error:Ht}:{error:de}:{error:Ut}:{error:It}},setCollectionDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:n}){return t?e?n?v(n)?{error:Kn}:{error:ae}:{error:de}:{error:Ut}:{error:It}},assignDrawPosition:function({drawDefinition:t,drawPosition:e,structureId:n,participantId:i,qualifier:r,bye:a}){if(!t)return{error:Ut};if(!e)return{error:Ct};if(!n)return{error:Ht};if(a){const i=fl({drawDefinition:t,drawPosition:e,structureId:n});if(i.error)return i}else{if(r)return{error:Kn};{const r=jl({drawDefinition:t,structureId:n,drawPosition:e,participantId:i});if(r.error)return r}}return{...pt}},assignSeedPositions:function(t){const{useExistingSeedLimit:e,tournamentRecord:n,drawDefinition:i,structureId:r,assignments:a,drawId:o}=t;let s=0;if(null==a||!a.length)return{error:Xt};if(!n)return{error:It};if(!o)return{error:xt};const{seedAssignments:c,seedLimit:u,error:d}=Mu({drawDefinition:i,structureId:r});if(d)return{error:d};const l=Object.assign({},...c.filter((t=>t.seedNumber)).map((t=>({[t.seedNumber]:t}))));a.forEach((t=>{const{seedNumber:n}=t;n<=u&&(!e||l[n])&&(l[n]=t)}));const p=Object.values(l),m=p.map((t=>null==t?void 0:t.participantId)).filter(Boolean);if(m.length!==it(m).length)return{error:"participantId cannot be assigned to multiple seedNumbers"};for(const f of p){const t=lI({...f,drawDefinition:i,structureId:r});if(null!=t&&t.error)return t;null!=t&&t.success&&s++}return s?{...pt,modifications:s}:{error:kn}},assignDrawPositionBye:function({drawDefinition:t,structureId:e,drawPosition:n}){return fl({drawDefinition:t,structureId:e,drawPosition:n})},swapDrawPositionAssignments:function(t){return Rh(t)},removeDrawPositionAssignment:Ch,alternateDrawPositionAssignment:function(t){return mh(t)},withdrawParticipantAtDrawPosition:function(t){return Object.assign(t,{entryStatus:du}),Ch(t)},setDrawParticipantRepresentativeIds:function({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:St};if(!Array.isArray(t))return{error:_n};const n=Lc((null==e?void 0:e.entries)||[]);return t.length&&ct(t,n).length<t.length?{error:_n}:Jc({drawDefinition:e,extension:{name:Kr,value:t}})},getDrawParticipantRepresentativeIds:function({drawDefinition:t}){const{extension:e,error:n}=ua({drawDefinition:t,name:"participantRepresentatives"});return n?{error:n}:{representativeParticipantIds:(null==e?void 0:e.value)||[]}},luckyLoserDrawPositionAssignment:function(t){return function({luckyLoserParticipantId:t,drawDefinition:e,drawPosition:n,structureId:i}){return ph({participantId:t,drawDefinition:e,drawPosition:n,structureId:i,positionActionName:"luckyLoserDrawPositionAssignment"})}(t)},automatedPositioning:function({tournamentRecord:t,drawDefinition:e,structureId:n,seedsOnly:i,event:r}){var a;if(!r)return{error:$t};if(!e)return{error:St};const o=Df({drawDefinition:e,participants:null==t?void 0:t.participants,structureId:n,seedsOnly:i});return o.error?o:null!=o&&null!==(a=o.errors)&&void 0!==a&&a.length?{error:o.errors}:pt},automatedPlayoffPositioning:Iv,checkInParticipant:function({tournamentRecord:t,participantId:e,matchUpId:n,matchUp:i,drawId:r}){i&&!r&&({drawId:r}=i),i&&!n&&({matchUpId:n}=i);const{event:a,drawDefinition:o}=wa({tournamentRecord:t,drawId:r});if(!a)return{error:$t};{const i=gm({tournamentParticipants:t.participants,drawDefinition:o,participantId:e,matchUpId:n});if(i.error&&i.error!==rn)return i}return pt},checkOutParticipant:function({tournamentRecord:t,drawId:e,matchUpId:n,participantId:i,matchUp:r}){r&&!e&&({drawId:e}=r),r&&!n&&({matchUpId:n}=r);const{event:a,drawDefinition:o}=wa({tournamentRecord:t,drawId:e});if(!a)return{error:$t};{const e=ym({drawDefinition:o,tournamentParticipants:t.participants,matchUpId:n,participantId:i});if(e.error)return e}return pt},toggleParticipantCheckInState:Um,generateDrawDefinition:Pv,addDrawDefinitionTimeItem:function({drawDefinition:t,timeItem:e}){if(!t)return{error:St};if(!e)return{error:En};const n=e&&Object.keys(e),i=["itemType","itemValue"];if(!(i.filter((t=>n.includes(t))).length===i.length))return{error:bn};t.timeItems||(t.timeItems=[]);const r=(new Date).toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),bc({drawDefinition:t}),pt},assignTieMatchUpParticipantId:function(t){var e,n;const i=Uv(t);if(i.error)return i;let r=t.teamParticipantId;const{tournamentRecord:a,drawDefinition:o,participantId:s}=t;if(!s)return{error:Je};const{relevantAssignments:c,collectionPosition:u,teamParticipants:d,collectionId:l,matchUpType:p,dualMatchUp:m,tieMatchUp:f,tieFormat:h}=i,{tournamentParticipants:[I]}=bp({tournamentRecord:a,participantFilters:{participantIds:[s]}});if(!I)return{error:Ze};const{individualParticipantIds:v,participantType:g}=I;if(p===la&&g!==La)return{error:Ke};const y=g===La?[s]:v,U=r?d.find((({participantId:t})=>t===r)):d.find((({individualParticipantIds:t})=>ut(y,t)));if(!U)return{error:Gn};r||(r=U.participantId);const w=c.find((t=>t.participantId===(null==U?void 0:U.participantId))),S=null==w?void 0:w.drawPosition,N=f.sides.find((({drawPosition:t})=>t===S)),D=null==N?void 0:N.sideNumber;if(!h)return{error:pe};if(!(null===(e=h.collectionDefinitions)||void 0===e?void 0:e.find((t=>t.collectionId===l))))return{error:le};if(null===(n=m.sides)||void 0===n||!n.length){const t=({displaySideNumber:t,drawPosition:e,sideNumber:n})=>({drawPosition:e,sideNumber:n,displaySideNumber:t});m.sides=[{...t(f.sides[0]),lineUp:[]},{...t(f.sides[1]),lineUp:[]}]}const P=m.sides.find((t=>t.sideNumber===D)),T=f.sides.find((t=>t.sideNumber===D));let A;if(p===pa&&g!==ka){const t=function({side:t}){let e;if(t.participant){const n=t.participant.individualParticipantIds||[];if(1===n.filter(Boolean).length){const{participant:t}=Cc({participantIds:n,tournamentRecord:a});n.push(s);const{participant:i}=Cc({participantIds:n,tournamentRecord:a});if(i)e=t.participantId;else{t.individualParticipantIds=n;const e=WI({individualParticipantIds:n,pairOverride:!0,tournamentRecord:a,participant:t});if(e.error)return e}}else console.log("###")}else{const t=pp({participant:{participantType:ka,participantRole:Dm,individualParticipantIds:[s]},pairOverride:!0,tournamentRecord:a});if(t.error)return t}return{...pt,deleteParticipantId:e}}({side:T});if(t.error)return t;A=t.deleteParticipantId}else if(p===pa&&g===ka){const t=I.individualParticipantIds||[],{modifiedLineUp:e}=vv({collectionPosition:u,teamParticipantId:r,dualMatchUpSide:P,drawDefinition:o,participantIds:t,collectionId:l});for(const n of t)wv({collectionPosition:u,teamParticipantId:r,drawDefinition:o,modifiedLineUp:e,participantId:n,collectionId:l,tieFormat:h});return P.lineUp=e,Mc({drawDefinition:o,matchUp:m}),{...pt,modifiedLineUp:e}}const{modifiedLineUp:M}=vv({participantIds:[s],collectionPosition:u,teamParticipantId:r,dualMatchUpSide:P,drawDefinition:o,collectionId:l});if(wv({collectionPosition:u,teamParticipantId:r,drawDefinition:o,modifiedLineUp:M,participantId:s,collectionId:l,tieFormat:h}),P.lineUp=M,Mc({drawDefinition:o,matchUp:m}),A){const t=wh({participantIds:[A],teamDrawIds:[o.drawId],tournamentRecord:a});t.error&&console.log("cleanup",{result:t})}return{...pt,modifiedLineUp:M}},removeTieMatchUpParticipantId:function(t){var e,n,i,r;const{tournamentRecord:a,drawDefinition:o,participantId:s}=t;if(!s)return{error:Je};const c=Uv(t);if(c.error)return c;const{relevantAssignments:u,collectionPosition:d,teamParticipants:l,collectionId:p,matchUpType:m,dualMatchUp:f,tieMatchUp:h,tieFormat:I}=c;if(Vl({score:h.score})||h.winningSide)return{error:$n};const v=null===(e=h.sides)||void 0===e?void 0:e.find((t=>{var e,n,i;return(null===(e=t.participant)||void 0===e?void 0:e.participantId)===s||(null===(n=t.participant)||void 0===n||null===(i=n.individualParticipantIds)||void 0===i?void 0:i.includes(s))}));if(!v)return{error:Ze};const{tournamentParticipants:[g]}=bp({tournamentRecord:a,participantFilters:{participantIds:[s]}});if(!g)return{error:Ze};if(m===la&&g.participantType===ka)return{error:He};const y=g.participantType===La?[s]:g.individualParticipantIds;f.sides||(f.sides=[{sideNumber:1},{sideNumber:2}]);let U=null===(n=f.sides)||void 0===n?void 0:n.find((({sideNumber:t})=>t===v.sideNumber));const w=Sv({drawDefinition:o,participantIds:y}),S=(null==w?void 0:w.teamParticipantId)||(null==l||null===(i=l.find((t=>ct((null==t?void 0:t.individualParticipantIds)||[],y).length===y.length)))||void 0===i?void 0:i.participantId);if(!S)return{error:Ze};if(!U&&((null===(r=f.sides)||void 0===r?void 0:r.filter((({lineUp:t})=>!t)).length)||0)<2){var N;const t=l.map((({participantId:t})=>{var e;return{drawPosition:null===(e=u.find((e=>e.participantId===t)))||void 0===e?void 0:e.drawPosition,teamParticipantId:t}}));console.log({drawPositionMap:t}),U=null===(N=f.sides)||void 0===N?void 0:N.find((e=>{var n;return(null===(n=t.find((({drawPosition:t})=>t===e.drawPosition)))||void 0===n?void 0:n.teamParticipantId)===S}))}if(!U)return{error:qn,participantId:s};const{modifiedLineUp:D}=vv({collectionPosition:d,teamParticipantId:S,dualMatchUpSide:U,participantIds:y,drawDefinition:o,collectionId:p});if(U.lineUp=D,S&&yv({participantId:S,lineUp:D,drawDefinition:o,tieFormat:I}),m===pa&&g.participantType===La){var P;const t=null===(P=h.sides)||void 0===P?void 0:P.find((t=>t.sideNumber===U.sideNumber)),{participantId:e}=t||{},{tournamentParticipants:[n]}=bp({tournamentRecord:a,participantFilters:{participantIds:[e]},withEvents:!0});if(!n)return{error:Ze};{const t=null==n?void 0:n.individualParticipantIds.filter((t=>t!==s));if(n.draws.length){if(1===t.length){const{participant:e}=Cc({participantIds:t,tournamentRecord:a});if(!e){const e=pp({participant:{participantRole:Dm,individualParticipantIds:t,participantType:ka},pairOverride:!0,tournamentRecord:a});if(e.error)return e}}}else if(t.length){n.individualParticipantIds=t;const e=WI({participant:n,pairOverride:!0,tournamentRecord:a});if(e.error)return e}else{const t=wh({participantIds:[e],tournamentRecord:a});t.error&&console.log("cleanup",{result:t})}}}return Mc({drawDefinition:o,matchUp:f}),{...pt,modifiedLineUp:D}},replaceTieMatchUpParticipantId:function(t){var e;const n=Uv(t);if(n.error)return n;const{existingParticipantId:i,tournamentRecord:r,newParticipantId:a,drawDefinition:o}=t;if(!i||!a)return{error:Je};const{collectionPosition:s,teamParticipants:c,collectionId:u,dualMatchUp:d,tieMatchUp:l,tieFormat:p}=n,{matchUpType:m}=l,f=l.sides.find((t=>{var e,n,r;return(null===(e=t.participant)||void 0===e?void 0:e.participantId)===i||(null===(n=t.participant)||void 0===n||null===(r=n.individualParticipantIds)||void 0===r?void 0:r.includes(i))}));if(!f)return{error:Ze};const{tournamentParticipants:h}=bp({tournamentRecord:r,participantFilters:{participantIds:[i,a]}});if(2!==h.length)return{error:Je};if(h[0].participantType!==h[1].participantType)return{error:Ke};const I=d.sides.find((({sideNumber:t})=>t===f.sideNumber));if(!I)return{error:qn,existingParticipantId:i};const v=h.find((({participantId:t})=>t===i)),g=(null==v?void 0:v.individualParticipantIds)||[v.participantId],y=Sv({drawDefinition:o,participantIds:g}),U=(null==y?void 0:y.teamParticipantId)||(null===(e=c.find((t=>ct((null==t?void 0:t.individualParticipantIds)||[],g).length===g.length)))||void 0===e?void 0:e.participantId),w=I.lineUp||y,S=w.find((({participantId:t})=>a===t)),N=(null==w?void 0:w.map((t=>{if(![i,a].includes(t.participantId))return t;var e;[i,a].includes(t.participantId)&&(t.collectionAssignments=null===(e=t.collectionAssignments)||void 0===e?void 0:e.filter((t=>!(t.collectionId===u&&t.collectionPosition===s))));return t.participantId===a&&(t.collectionAssignments||(t.collectionAssignments=[]),t.collectionAssignments.push({collectionId:u,collectionPosition:s})),t})))||[];S||N.push({participantId:a,collectionAssignments:[{collectionId:u,collectionPosition:s}]});const D=m===pa,P=D&&w.map((t=>{var e;return(null===(e=t.collectionAssignments)||void 0===e?void 0:e.find((t=>t.collectionId===u&&t.collectionPosition===s)))&&t.participantId})).filter(Boolean),T=D&&N.map((t=>{var e;return(null===(e=t.collectionAssignments)||void 0===e?void 0:e.find((t=>t.collectionId===u&&t.collectionPosition===s)))&&t.participantId})).filter(Boolean);let A,M;if(I.lineUp=N,U&&yv({participantId:U,lineUp:N,drawDefinition:o,tieFormat:p}),D){var b;const{tournamentRecord:e}=t;let n=Cc({participantIds:T,tournamentRecord:e});if(!n.participant){var E;const t=pp({tournamentRecord:e,pairOverride:!0,participant:{individualParticipantIds:T,participantType:ka,participantRole:Dm}});if(t.error)return t;A=null===(E=t.participant)||void 0===E?void 0:E.participantId}n=Cc({participantIds:P,tournamentRecord:e});const i=null===(b=n.participant)||void 0===b?void 0:b.participantId;if(i){wh({participantIds:[i],tournamentRecord:e}).success&&(M=i)}}return Tc({drawDefinition:o,matchUp:d}),{...pt,participantRemoved:M,participantAdded:A}},updateTeamLineUp:yv,validateLineUp:gv,getTeamLineUp:Rc};const Bv={allTournamentMatchUps:fd,tournamentMatchUps:vd,allEventMatchUps:Id,getRoundMatchUps:function(t){return _c(t)},allDrawMatchUps:hd,eventMatchUps:gd,drawMatchUps:function({tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,policyDefinitions:n,tournamentRecord:i,matchUpFilters:r,contextFilters:a,contextProfile:o,drawDefinition:s,nextMatchUps:c,participants:u,tournamentId:d,inContext:l,context:p,event:m}){if(!m)return{error:Yt};const{eventId:f,eventName:h,endDate:I}=m||{};return md({context:{...p,...Wi({eventId:f,eventName:h,endDate:I||(null==m?void 0:m.endDate)||(null==i?void 0:i.endDate),tournamentId:d||(null==i?void 0:i.tournamentId),indoorOutDoor:(null==m?void 0:m.indoorOutDoor)||(null==i?void 0:i.indoorOutDoor),surfaceCategory:(null==m?void 0:m.surfaceCategory)||(null==i?void 0:i.surfaceCategory)})},tournamentAppliedPolicies:t,scheduleVisibilityFilters:e,tournamentParticipants:u||i&&yd({tournamentRecord:i}),policyDefinitions:n,tournamentRecord:i,drawDefinition:s,matchUpFilters:r,contextFilters:a,contextProfile:o,nextMatchUps:c,inContext:l,event:m})},credits:Gm,getEvent:function({tournamentRecord:t,drawDefinition:e,event:n,context:i}){var r;if(!t)return{error:It};if(!n)return{error:Yt};const a=Hi(n);return i&&Object.assign(a,i),{event:a,drawDefinition:e&&(null===(r=a.drawDefinitions)||void 0===r?void 0:r.find((({drawId:t})=>e.drawId===t)))}},getEvents:function({tournamentRecord:t,context:e,inContext:n}){if(!t)return{error:It};const{tournamentId:i}=t;return{events:(t.events||[]).map((t=>{const r=Hi(t);return e&&Object.assign(r,e),n&&Object.assign(r,{tournamentId:i}),r}))}},findEventExtension:ca,findTournamentExtension:sa,findParticipantExtension:function({tournamentRecord:t,participantId:e,name:n}){if(!t)return{error:It};if(!e)return{error:Je};const{participant:i}=aa({tournamentRecord:t,participantId:e});return oa({element:i,name:n})},findDrawDefinitionExtension:ua,getTieFormat:function({tournamentRecord:t,drawDefinition:e,structureId:n,matchUpId:i,drawId:r,event:a}){var o,s,c;if(!t)return{error:It};if(!(r||a||n||i))return{error:Ee};const u=Ud({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r,event:a});if(i&&null!=u&&u.error)return u;!e&&null!=u&&u.drawDefinition&&(e=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&n&&!i){if(!e)return{error:xt};const t=Wc({drawDefinition:e,structureId:n});if(t.error)return t;d=t.structure}const l=null===(o=d)||void 0===o?void 0:o.tieFormat,p=null===(s=e)||void 0===s?void 0:s.tieFormat,m=null==a?void 0:a.tieFormat;return{structureDefaultTieFormat:l,eventDefaultTieFormat:m,drawDefaultTieFormat:p,tieFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.tieFormat)||l||p||m}},getMatchUpFormat:qp,getDrawDefinition:function({tournamentRecord:t,drawDefinition:e}){return t?{drawDefinition:Hi(e)}:{error:It}},getEventProperties:function({tournamentRecord:t,event:e}){var n,i;if(!t)return{error:It};if(!e)return{error:Yt};const r=e.entries||[],a=t.participants||[],o=(null===(n=e.category)||void 0===n?void 0:n.categoryName)||(null===(i=e.category)||void 0===i?void 0:i.ageCategoryCode),{eventType:s}=e,c=r.map((t=>t.participantId));let u,d,l;return{entryScaleAttributes:a.filter((t=>c.includes(t.participantId))).map((t=>{var e,n,i,r,a,c;const{participantId:p,participantName:m,name:f}=t;let h={scaleType:Tr,eventType:s,scaleName:o};const I=null===(e=Vh({participant:t,scaleAttributes:h}))||void 0===e||null===(n=e.scaleItem)||void 0===n?void 0:n.scaleValue;h={scaleType:Pr,eventType:s,scaleName:o};const v=null===(i=Vh({participant:t,scaleAttributes:h}))||void 0===i||null===(r=i.scaleItem)||void 0===r?void 0:r.scaleValue;h={scaleType:Dr,eventType:s,scaleName:o};const g=null===(a=Vh({participant:t,scaleAttributes:h}))||void 0===a||null===(c=a.scaleItem)||void 0===c?void 0:c.scaleValue;return u=!(!u&&!I),d=!(!d&&!v),l=!(!l&&!g),{participantId:p,participantName:m||f,seed:I,ranking:v,rating:g}})),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:l}},getPositionAssignments:function({tournamentRecord:t,drawDefinition:e,structureId:n}){return t?e?n?Cu({drawDefinition:e,structureId:n}):{error:Ht}:{error:Ut}:{error:It}},isValidMatchUpFormat:v,getMaxEntryPosition:function({entries:t=[],entryStatus:e,stage:n}){return Math.max(...t.filter((t=>!(n&&n!==t.entryStage||e&&t.entryStatus!==e||isNaN(t.entryPosition)))).map((({entryPosition:t})=>parseInt(t||0))),0)},findVenue:Vu,getCourts:qu,getVenuesAndCourts:Gu,findCourt:function(t){return Hi(Wu(t),!1,!0)},getEventTimeItem:ac,getTournamentTimeItem:function({tournamentRecord:t,itemType:e,itemSubTypes:n,returnPreviousValues:i}){if(!t)return{error:It};if(!t.timeItems)return{message:qn};const{timeItem:r,previousItems:a,message:o}=rc({element:t,itemType:e,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:a}||{message:o}},getParticipantTimeItem:function({tournamentRecord:t,participantId:e,itemType:n,itemSubTypes:i,returnPreviousValues:r}){if(!t)return{error:It};if(!e)return{error:Je};const a=aa({tournamentRecord:t,participantId:e});if(a.error)return a;const{participant:o}=a;if(null==o||!o.timeItems)return{message:qn};const{timeItem:s,previousItems:c,message:u}=rc({element:a.participant,itemType:n,itemSubTypes:i,returnPreviousValues:r});return s&&{timeItem:s,previousItems:c}||{message:u}},getDrawDefinitionTimeItem:function({drawDefinition:t,itemType:e,itemSubTypes:n,returnPreviousValues:i}){if(!t)return{error:xt};if(!t.timeItems)return{message:qn};const{timeItem:r,previousItems:a,message:o}=rc({element:t,itemType:e,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:a}||{message:o}},bulkUpdatePublishedEventIds:function({tournamentRecord:t,outcomes:e}){var n;if(!t)return{error:It};if(null==e||!e.length)return{error:Ee,message:"Missing outcomes"};const i=e.reduce(((t,e)=>{const{drawId:n,eventId:i}=e;return i&&n&&(t[i]?t[i].includes(n)||t[i].push(n):t[i]=[n]),t}),{}),r=Object.keys(i);return{publishedEventIds:(null===(n=t.events)||void 0===n?void 0:n.filter((t=>r.includes(t.eventId)))).filter((t=>{const{timeItem:e}=ac({event:t,itemType:"PUBLISH.STATUS"}),n=null==e?void 0:e.itemValue,{eventId:r}=t;return i[r].filter((t=>{var e;return n&&n.PUBLIC&&(null===(e=n.PUBLIC.drawIds)||void 0===e?void 0:e.includes(t))&&n!==br})).length})).map((t=>t.eventId)),eventIdPublishedDrawIdsMap:i}},matchUpActions:$m,positionActions:function({policyDefinitions:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,structureId:r,drawId:a,event:o}){const{tournamentParticipants:s}=bp({tournamentRecord:e,inContext:!0});return cI({tournamentParticipants:s,policyDefinitions:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,structureId:r,drawId:a,event:o})},findMatchUp:function(t){Object.assign(t,{inContext:!0});const{matchUp:e,error:n}=Ud(t);return{matchUp:Hi(e,!0,!0),error:n}},participantScheduledMatchUps:hp,participantScaleItem:Vh,getParticipantScaleItem:EI,getParticipantSignInStatus:function({tournamentRecord:t,participantId:e}){if(!t)return{error:It};if(!e)return{error:Je};const{participant:n}=aa({tournamentRecord:t,participantId:e});if(!n)return{error:Ze};const{timeItem:i}=rc({element:n,itemType:vp});return i&&i.itemValue===Sp&&Sp},getPolicyDefinitions:il,getMatchUpScheduleDetails:Ra};const _v={addVenue:lp,deleteVenue:up,deleteVenues:function({tournamentRecord:t,venueIds:e,force:n}){if(!t)return{error:It};if(!Array.isArray(e))return{error:_n};for(const i of t.venues||[]){const{venueId:r}=i;if(e.includes(r)){const{venueId:e}=i,r=up({tournamentRecord:t,venueId:e,force:n});if(r.error)return r}}return pt},modifyVenue:sp,addCourt:ap,addCourts:op,deleteCourt:function({tournamentRecord:t,drawDefinition:e,disableNotice:n,courtId:i,force:r}){const{venue:a,error:o}=Wu({tournamentRecord:t,courtId:i});if(o)return{error:o};const{matchUps:s}=Xl({tournamentRecord:t,courtId:i});if(s.length&&!r)return tp({matchUpsCount:s.length});for(const c of s){const n=cp({tournamentRecord:t,drawDefinition:e,drawId:c.drawId,matchUpId:c.matchUpId});if(n.error)return n}return a.courts=(a.courts||[]).filter((t=>t.courtId!==i)),n||ri({topic:Sc,payload:{venue:a},key:a.venueId}),{...pt}},modifyCourt:rp,modifyCourtAvailability:ip,findVenue:function(t){return Hi(Vu(t),!1,!0)}},Gv=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>kI({convertExtensions:t,removeExtensions:e,tournamentId:ui()}),newTournamentRecord:(t={})=>{const e=LI(t);return e.error?e:(pi(e),fi(e.tournamentId),Object.assign({tournamentId:e.tournamentId},pt))},setTournamentId:t=>fi(t)};function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}return t.version=()=>"0.56.2",t.reset=()=>e(hi(ui())),t.setState=(t,n,i)=>{ii(n,i);return e(FI(t,n))},t.devContext=e=>(ni(e),t),t.getDevContext=t=>ei(t),t.executionQueue=(e,i)=>function(e,i){if(!Array.isArray(e))return{error:_n};const r=di(ui()),a=i&&Hi(r,!1,!0),o=[];for(const s of e){if("object"!=typeof s)return{error:_n};const{method:e,params:i}=s;if(!t[e])return{error:Jn};const c=n(r,t[e],i);if(null!=c&&c.error)return a&&FI(a),{...c,rolledBack:!!a};o.push(c)}return jp(),oi(),{results:o}}(e,i),[Bv,jv,_v,ev,QI,JI,ZI,qI].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{if(ei())return i(e[n],t);try{return i(e[n],t)}catch(r){console.log("%c ERROR","color: orange",{err:r})}}}))})),t;function n(e,n,i){delete t.success,delete t.error;return n({...jI(e,i),tournamentRecord:e})}function i(t,e){const i=(null==e?void 0:e.sandBoxRecord)||(null==e?void 0:e.sandboxRecord)||(null==e?void 0:e.sandboxTournament)||di(ui()),r=(null==e?void 0:e.rollbackOnError)&&Hi(i,!1,!0),a=n(i,t,e);null!=a&&a.error&&r&&FI(r);const o=(null==a?void 0:a.success)&&!0!==(null==e?void 0:e.delayNotify)&&!0!==(null==e?void 0:e.doNotNotify);return o&&jp(),(o||null==a||!a.success||null!=e&&e.doNotNotify)&&oi(),a}}();function Vv({scoreString:t,tiebreakTo:e=7}){return t.split(" ").filter(Boolean).map(((t,n)=>function({set:t,setNumber:n}){const i=(null==t?void 0:t.startsWith("["))&&t.split("[")[1].split("]")[0].split("-").map((t=>parseInt(t))),r=t.includes("(")?t.split("(")[0]:t.includes("[")?t.split("[")[0]:t,a=!i&&r.split("-").map((t=>parseInt(t))),o=a[0]>a[1]?1:a[0]<a[1]?2:void 0,s=t.includes("(")&&t.split("(")[1].split(")")[0],c=![!1,void 0].includes(s)&&Ga({isSide1:2===o,lowValue:s,tiebreakTo:e})||[],[u,d]=a||[],[l,p]=i||c||[];return{side1Score:u,side2Score:d,side1TiebreakScore:l,side2TiebreakScore:p,winningSide:o,setNumber:n}}({set:t,setNumber:n+1})))}function Hv({scoreString:t,winningSide:e,matchUpStatus:n}){if(!t)return{outcome:{...sl,winningSide:e,matchUpStatus:n}};if(e&&![1,2,void 0].includes(e))return{error:_n,winningSide:e};const i=t&&Vv({scoreString:t}),r={},a=bo({sets:i}),o=bo({sets:i,reversed:!0});return 2===e?(r.scoreStringSide1=o,r.scoreStringSide2=a):(r.scoreStringSide1=a,r.scoreStringSide2=o),r.sets=Vv({scoreString:r.scoreStringSide1}),{outcome:{matchUpStatus:n,winningSide:e,score:r}}}var Wv=[{AL:"Alabama"},{AK:"Alaska"},{AZ:"Arizona"},{AR:"Arkansas"},{CA:"California"},{CO:"Colorado"},{CT:"Connecticut"},{DE:"Delaware"},{DC:"District of Columbia"},{FL:"Florida"},{GA:"Georgia"},{HI:"Hawaii"},{ID:"Idaho"},{IL:"Illinois"},{IN:"Indiana"},{IA:"Iowa"},{KS:"Kansas"},{KY:"Kentucky"},{LA:"Louisiana"},{ME:"Maine"},{MD:"Maryland"},{MA:"Massachusetts"},{MI:"Michigan"},{MN:"Minnesota"},{MS:"Mississippi"},{MO:"Missouri"},{MT:"Montana"},{NE:"Nebraska"},{NV:"Nevada"},{NH:"New Hampshire"},{NJ:"New Jersey"},{NM:"New Mexico"},{NY:"New York"},{NC:"North Carolina"},{ND:"North Dakota"},{OH:"Ohio"},{OK:"Oklahoma"},{OR:"Oregon"},{PA:"Pennsylvania"},{RI:"Rhode Island"},{SC:"South Carolina"},{SD:"South Dakota"},{TN:"Tennessee"},{TX:"Texas"},{UT:"Utah"},{VT:"Vermont"},{VA:"Virginia"},{WA:"Washington"},{WV:"West Virginia"},{WI:"Wisconsin"},{WY:"Wyoming"},{PR:"Puerto Rico"}],qv=["Adairsville","Ashburn","Ashland","Audubon Park","Aurora","Aurora","Bay Minette","Bayville","Bean Station","Becket","Belle Isle","Bellmead","Belville","Benld","Benton","Boaz","Bolivar","Bossier City","Bremen","Brent","Brentwood","Brownsville","Burns","Cairo","Caledonia","Cambridge","Canutillo","Central Garage","Centralia","Cherry Valley","Chester Center","Chesterfield","Cibecue","Cohoe","Collinsville","Columbus","Corcoran","Cuba","Dolgeville","Douglas","Druid Hills","Dyker Heights","Eagar","East Dubuque","East Valley","Edgefield","Eliot","Elizabeth","Elmsford","Emerald Isle","Emory","Estero","Fairmount","Falcon Heights","Falmouth","Fillmore","Flower Hill","Fobes Hill","Fort Valley","Franklin","Freeport","Gardnertown","Gates Mills","Glasgow Village","Goldsboro","Grant-Valkaria","Greenfield","Gretna","Guilford Siding","Hampton Falls","Harrisonville","Hart","Haskins","Hebron","Hennepin","Highgrove","Homerville","Homewood","Hooksett","Inwood","Island Lake","Issaquah","Jasper","Jefferson","Jewell","Kaukauna","Kings Grant","Kingston","Kirkland","Kokomo","Koloa","La Center","LaBelle","Lake Placid","Lake Waccamaw","Laughlin","LaVerkin","Leadville North","Leland","Long Creek","Longmeadow","Luttrell","Magnolia","Malvern","Mar-Mac","Marana","Marble Falls","Martin","Martindale","Martinsburg","Mazomanie","Mechanicsville","Mexico Beach","Middletown","Mobile","Moravian Falls","Morehead","Mount Hermon","Mulberry","Munhall","Nettleton","Newton","North Granby","North Highlands","Northern Cambria","Northwest Harwinton","Nurillo","Oasis","Orlando","Osceola","Otis","Pacolet","Palm Beach Gardens","Paoli","Patton Village","Paw Paw Lake","Pearl River","Pine Bluffs","Pine","Pioneer","Port Hadlock-Irondale","Porter","Potsdam","Price","Princess Anne","Princeville","Red Oak","Richfield","Ridge Wood Heights","Ringwood","Robinwood","Rochester","Rockland","Rockwell City","Roland","Rolling Hills","Ruskin","Saint Anthony","Saint Robert","Salisbury","Sauk Rapids","Sayreville Junction","Sedona","Shawnee","Shenandoah","Silver Lake","South Waverly","Southwest Ranches","Southwick","Spring Green","Spring Valley","Spry","Strawberry Point","Terryville","Texico","Thomson","Tonganoxie","Townsend","Trinity","Union City","Van Buren","Verona Walk","Villa Rica","Warrenton","Warroad","Washington, D.C.","Weaverville","Wescosville","West Clarkston-Highland","West Orange","Williamsport","Windsor","Winnsboro","Woodbridge","Woodmoor","Wyoming","Young America (historical)","Zeeland"];var Kv=[{firstName:"Novak",lastName:"Djokovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Rafael",lastName:"Nadal",sex:"MALE",nationalityCode:"ESP"},{firstName:"Dominic",lastName:"Thiem",sex:"MALE",nationalityCode:"AUT"},{firstName:"Roger",lastName:"Federer",sex:"MALE",nationalityCode:"SUI"},{firstName:"Stefanos",lastName:"Tsitsipas",sex:"MALE",nationalityCode:"GRE"},{firstName:"Daniil",lastName:"Medvedev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Alexander",lastName:"Zverev",sex:"MALE",nationalityCode:"GER"},{firstName:"Andrey",lastName:"Rublev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Diego",lastName:"Schwartzman",sex:"MALE",nationalityCode:"ARG"},{firstName:"Matteo",lastName:"Berrettini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Gael",lastName:"Monfils",sex:"MALE",nationalityCode:"FRA"},{firstName:"Denis",lastName:"Shapovalov",sex:"MALE",nationalityCode:"CAN"},{firstName:"Roberto",lastName:"Bautista Agut",sex:"MALE",nationalityCode:"ESP"},{firstName:"David",lastName:"Goffin",sex:"MALE",nationalityCode:"BEL"},{firstName:"Pablo",lastName:"Carreno Busta",sex:"MALE",nationalityCode:"ESP"},{firstName:"Fabio",lastName:"Fognini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Milos",lastName:"Raonic",sex:"MALE",nationalityCode:"CAN"},{firstName:"Karen",lastName:"Khachanov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Stan",lastName:"Wawrinka",sex:"MALE",nationalityCode:"SUI"},{firstName:"Grigor",lastName:"Dimitrov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Felix",lastName:"Auger-Aliassime",sex:"MALE",nationalityCode:"CAN"},{firstName:"Cristian",lastName:"Garin",sex:"MALE",nationalityCode:"CHI"},{firstName:"John",lastName:"Isner",sex:"MALE",nationalityCode:"USA"},{firstName:"Borna",lastName:"Coric",sex:"MALE",nationalityCode:"CRO"},{firstName:"Alex",lastName:"de Minaur",sex:"MALE",nationalityCode:"AUS"},{firstName:"Dusan",lastName:"Lajovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Casper",lastName:"Ruud",sex:"MALE",nationalityCode:"NOR"},{firstName:"Benoit",lastName:"Paire",sex:"MALE",nationalityCode:"FRA"},{firstName:"Taylor",lastName:"Fritz",sex:"MALE",nationalityCode:"USA"},{firstName:"Filip",lastName:"Krajinovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Hubert",lastName:"Hurkacz",sex:"MALE",nationalityCode:"POL"},{firstName:"Ugo",lastName:"Humbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Daniel",lastName:"Evans",sex:"MALE",nationalityCode:"GBR"},{firstName:"Jan-Lennard",lastName:"Struff",sex:"MALE",nationalityCode:"GER"},{firstName:"Reilly",lastName:"Opelka",sex:"MALE",nationalityCode:"USA"},{firstName:"Nikoloz",lastName:"Basilashvili",sex:"MALE",nationalityCode:"GEO"},{firstName:"Kei",lastName:"Nishikori",sex:"MALE",nationalityCode:"JPN"},{firstName:"Guido",lastName:"Pella",sex:"MALE",nationalityCode:"ARG"},{firstName:"Adrian",lastName:"Mannarino",sex:"MALE",nationalityCode:"FRA"},{firstName:"Miomir",lastName:"Kecmanovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Marin",lastName:"Cilic",sex:"MALE",nationalityCode:"CRO"},{firstName:"Lorenzo",lastName:"Sonego",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jannik",lastName:"Sinner",sex:"MALE",nationalityCode:"ITA"},{firstName:"Nick",lastName:"Kyrgios",sex:"MALE",nationalityCode:"AUS"},{firstName:"John",lastName:"Millman",sex:"MALE",nationalityCode:"AUS"},{firstName:"Albert",lastName:"Ramos-Vinolas",sex:"MALE",nationalityCode:"ESP"},{firstName:"Kyle",lastName:"Edmund",sex:"MALE",nationalityCode:"GBR"},{firstName:"Tennys",lastName:"Sandgren",sex:"MALE",nationalityCode:"USA"},{firstName:"Alexander",lastName:"Bublik",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Sam",lastName:"Querrey",sex:"MALE",nationalityCode:"USA"},{firstName:"Yoshihito",lastName:"Nishioka",sex:"MALE",nationalityCode:"JPN"},{firstName:"Marton",lastName:"Fucsovics",sex:"MALE",nationalityCode:"HUN"},{firstName:"Aljaz",lastName:"Bedene",sex:"MALE",nationalityCode:"SLO"},{firstName:"Laslo",lastName:"Djere",sex:"MALE",nationalityCode:"SRB"},{firstName:"Richard",lastName:"Gasquet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pablo",lastName:"Andujar",sex:"MALE",nationalityCode:"ESP"},{firstName:"Jo-Wilfried",lastName:"Tsonga",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gilles",lastName:"Simon",sex:"MALE",nationalityCode:"FRA"},{firstName:"Tommy",lastName:"Paul",sex:"MALE",nationalityCode:"USA"},{firstName:"Jordan",lastName:"Thompson",sex:"MALE",nationalityCode:"AUS"},{firstName:"Fernando",lastName:"Verdasco",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alejandro",lastName:"Davidovich Fokina",sex:"MALE",nationalityCode:"ESP"},{firstName:"Feliciano",lastName:"Lopez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Frances",lastName:"Tiafoe",sex:"MALE",nationalityCode:"USA"},{firstName:"Dominik",lastName:"Koepfer",sex:"MALE",nationalityCode:"GER"},{firstName:"Jiri",lastName:"Vesely",sex:"MALE",nationalityCode:"CZE"},{firstName:"Pablo",lastName:"Cuevas",sex:"MALE",nationalityCode:"URU"},{firstName:"Ricardas",lastName:"Berankis",sex:"MALE",nationalityCode:"LTU"},{firstName:"Lucas",lastName:"Pouille",sex:"MALE",nationalityCode:"FRA"},{firstName:"Cameron",lastName:"Norrie",sex:"MALE",nationalityCode:"GBR"},{firstName:"Steve",lastName:"Johnson",sex:"MALE",nationalityCode:"USA"},{firstName:"Jeremy",lastName:"Chardy",sex:"MALE",nationalityCode:"FRA"},{firstName:"Stefano",lastName:"Travaglia",sex:"MALE",nationalityCode:"ITA"},{firstName:"Corentin",lastName:"Moutet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Juan",lastName:"Ignacio Londero",sex:"MALE",nationalityCode:"ARG"},{firstName:"Federico",lastName:"Delbonis",sex:"MALE",nationalityCode:"ARG"},{firstName:"Marco",lastName:"Cecchinato",sex:"MALE",nationalityCode:"ITA"},{firstName:"Thiago",lastName:"Monteiro",sex:"MALE",nationalityCode:"BRA"},{firstName:"Salvatore",lastName:"Caruso",sex:"MALE",nationalityCode:"ITA"},{firstName:"Lloyd",lastName:"Harris",sex:"MALE",nationalityCode:"RSA"},{firstName:"Vasek",lastName:"Pospisil",sex:"MALE",nationalityCode:"CAN"},{firstName:"Pierre-Hugues",lastName:"Herbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Egor",lastName:"Gerasimov",sex:"MALE",nationalityCode:"BLR"},{firstName:"Joao",lastName:"Sousa",sex:"MALE",nationalityCode:"POR"},{firstName:"Radu",lastName:"Albot",sex:"MALE",nationalityCode:"MDA"},{firstName:"Marcos",lastName:"Giron",sex:"MALE",nationalityCode:"USA"},{firstName:"Mikael",lastName:"Ymer",sex:"MALE",nationalityCode:"SWE"},{firstName:"Attila",lastName:"Balazs",sex:"MALE",nationalityCode:"HUN"},{firstName:"Federico",lastName:"Coria",sex:"MALE",nationalityCode:"ARG"},{firstName:"Soonwoo",lastName:"Kwon",sex:"MALE",nationalityCode:"KOR"},{firstName:"Mikhail",lastName:"Kukushkin",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Dennis",lastName:"Novak",sex:"MALE",nationalityCode:"AUT"},{firstName:"Pedro",lastName:"Martinez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Philipp",lastName:"Kohlschreiber",sex:"MALE",nationalityCode:"GER"},{firstName:"Yannick",lastName:"Hanfmann",sex:"MALE",nationalityCode:"GER"},{firstName:"Gianluca",lastName:"Mager",sex:"MALE",nationalityCode:"ITA"},{firstName:"James",lastName:"Duckworth",sex:"MALE",nationalityCode:"AUS"},{firstName:"Emil",lastName:"Ruusuvuori",sex:"MALE",nationalityCode:"FIN"},{firstName:"Yasutaka",lastName:"Uchiyama",sex:"MALE",nationalityCode:"JPN"},{firstName:"Roberto",lastName:"Carballes Baena",sex:"MALE",nationalityCode:"ESP"},{firstName:"Ashleigh",lastName:"Barty",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Simona",lastName:"Halep",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Naomi",lastName:"Osaka",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Sofia",lastName:"Kenin",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Elina",lastName:"Svitolina",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Karolina",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Bianca",lastName:"Andreescu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Petra",lastName:"Kvitova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Kiki",lastName:"Bertens",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Serena",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aryna",lastName:"Sabalenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Belinda",lastName:"Bencic",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Victoria",lastName:"Azarenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Johanna",lastName:"Konta",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Garbine",lastName:"Muguruza",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Madison",lastName:"Keys",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Iga",lastName:"Swiatek",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Petra",lastName:"Martic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Elena",lastName:"Rybakina",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Marketa",lastName:"Vondrousova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Elise",lastName:"Mertens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Maria",lastName:"Sakkari",sex:"FEMALE",nationalityCode:"GRE"},{firstName:"Anett",lastName:"Kontaveit",sex:"FEMALE",nationalityCode:"EST"},{firstName:"Jennifer",lastName:"Brady",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelique",lastName:"Kerber",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Alison",lastName:"Riske",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Karolina",lastName:"Muchova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Yulia",lastName:"Putintseva",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Dayana",lastName:"Yastremska",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Amanda",lastName:"Anisimova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Ons",lastName:"Jabeur",sex:"FEMALE",nationalityCode:"TUN"},{firstName:"Donna",lastName:"Vekic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Ekaterina",lastName:"Alexandrova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qiang",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Shuai",lastName:"Zhang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Svetlana",lastName:"Kuznetsova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Barbora",lastName:"Strycova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Anastasia",lastName:"Pavlyuchenkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Sloane",lastName:"Stephens",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Magda",lastName:"Linette",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Saisai",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Fiona",lastName:"Ferro",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Caroline",lastName:"Garcia",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Jelena",lastName:"Ostapenko",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Danielle",lastName:"Collins",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Veronika",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Cori",lastName:"Gauff",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Nadia",lastName:"Podoroska",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Kristina",lastName:"Mladenovic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Laura",lastName:"Siegemund",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Marie",lastName:"Bouzkova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Polona",lastName:"Hercog",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Alize",lastName:"Cornet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Anastasija",lastName:"Sevastova",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Rebecca",lastName:"Peterson",sex:"FEMALE",nationalityCode:"SWE"},{firstName:"Patricia",lastName:"Maria Tig",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Jil",lastName:"Teichmann",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Shelby",lastName:"Rogers",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Heather",lastName:"Watson",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Anna",lastName:"Blinkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Bernarda",lastName:"Pera",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Jessica",lastName:"Pegula",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alison",lastName:"Van Uytvanck",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Katerina",lastName:"Siniakova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Sara",lastName:"Sorribes Tormo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Su-Wei",lastName:"Hsieh",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Ajla",lastName:"Tomljanovic",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Kristyna",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Paula",lastName:"Badosa",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Daria",lastName:"Kasatkina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nao",lastName:"Hibino",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Arantxa",lastName:"Rus",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lauren",lastName:"Davis",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Krejcikova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Camila",lastName:"Giorgi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Irina-Camelia",lastName:"Begu",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Danka",lastName:"Kovinic",sex:"FEMALE",nationalityCode:"MNE"},{firstName:"Venus",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Zarina",lastName:"Diyas",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Christina",lastName:"Mchale",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Madison",lastName:"Brengle",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Carla",lastName:"Suarez Navarro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Martina",lastName:"Trevisan",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Kirsten",lastName:"Flipkens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Misaki",lastName:"Doi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Tamara",lastName:"Zidansek",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Sorana",lastName:"Cirstea",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Leylah",lastName:"Fernandez",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Taylor",lastName:"Townsend",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Lin",lastName:"Zhu",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Ana",lastName:"Bogdan",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Aliaksandra",lastName:"Sasnovich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Yafan",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Jasmine",lastName:"Paolini",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Varvara",lastName:"Gracheva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Viktoria",lastName:"Kuzmova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Nina",lastName:"Stojanovic",sex:"FEMALE",nationalityCode:"SRB"},{firstName:"Anastasia",lastName:"Potapova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Andrea",lastName:"Petkovic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kaja",lastName:"Juvan",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Elsa",lastName:"Jacquemot",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Victoria",lastName:"Jimenez Kasintseva",sex:"FEMALE",nationalityCode:"AND"},{firstName:"Alexandra",lastName:"Eala",sex:"FEMALE",nationalityCode:"PHI"},{firstName:"Diane",lastName:"Parry",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Daria",lastName:"Snigur",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Polina",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Robin",lastName:"Montgomery",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alexandra",lastName:"Vecic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kristina",lastName:"Dmitruk",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Alexa",lastName:"Noel",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Kamilla",lastName:"Bartone",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Weronika",lastName:"Baszak",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Oksana",lastName:"Selekhmeteva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Alina",lastName:"Charaeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Maria",lastName:"Bondarenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Priska",lastName:"Madelyn Nugroho",sex:"FEMALE",nationalityCode:"INA"},{firstName:"Linda",lastName:"Fruhvirtova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Dana",lastName:"Guzman",sex:"FEMALE",nationalityCode:"PER"},{firstName:"Linda",lastName:"Noskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Hong",lastName:"Yi Cody Wong",sex:"FEMALE",nationalityCode:"HKG"},{firstName:"Zhuoxuan",lastName:"Bai",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Mell",lastName:"Reasco Gonzalez",sex:"FEMALE",nationalityCode:"ECU"},{firstName:"Matilda",lastName:"Mutavdzic",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Diana",lastName:"Shnaider",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qinwen",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Alexandra",lastName:"Yepifanova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Matilde",lastName:"Paoletti",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Melania",lastName:"Delai",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jana",lastName:"Kolodynska",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Guillermina",lastName:"Grant",sex:"FEMALE",nationalityCode:"URU"},{firstName:"Darja",lastName:"Vidmanova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Melodie",lastName:"Collard",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Elvina",lastName:"Kalieva",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Sofia",lastName:"Costoulas",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Aliona",lastName:"Falei",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Mai",lastName:"Nirundorn",sex:"FEMALE",nationalityCode:"THA"},{firstName:"Elizabeth",lastName:"Coleman",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aubane",lastName:"Droguet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Madison",lastName:"Sieg",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Natsumi",lastName:"Kawaguchi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Leyre",lastName:"Romero Gormaz",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Elina",lastName:"Avanesyan",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Oceane",lastName:"Babel",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ziva",lastName:"Falkner",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Julia",lastName:"Garcia",sex:"FEMALE",nationalityCode:"MEX"},{firstName:"Natalia",lastName:"Szabanin",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Erika",lastName:"Andreeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Celia",lastName:"Belle Mohr",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ane",lastName:"Mintegi Del Olmo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Sebastianna",lastName:"Scilipoti",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Ana",lastName:"Geller",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Dayeon",lastName:"Back",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Selena",lastName:"Janicijevic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Romana",lastName:"Cisovska",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Amarissa",lastName:"Kiara Toth",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Mara",lastName:"Guth",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Evialina",lastName:"Laskevich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Julia",lastName:"Avdeeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Beatrice",lastName:"Ricci",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Eleonora",lastName:"Alvisi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jessica",lastName:"Bouzas Maneiro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Julie",lastName:"Belgraver",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lisa",lastName:"Pigato",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Ya",lastName:"Yi Yang",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Eva",lastName:"Lys",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Talia",lastName:"Gibson",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Yeon",lastName:"Ku",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Katrina",lastName:"Scott",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Palicova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Alina",lastName:"Shcherbinina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Giulia",lastName:"Morlet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tina",lastName:"Nadine Smith",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Sohyun",lastName:"Park",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Tara",lastName:"Wurth",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Polina",lastName:"Iatcenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Lauren",lastName:"Anzalotta Kynoch",sex:"FEMALE",nationalityCode:"PUR"},{firstName:"Savannah",lastName:"Broadus",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelina",lastName:"Wirges",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Amarni",lastName:"Banks",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Hanne",lastName:"Vandewinkel",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Jada",lastName:"Bui",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Sabina",lastName:"Zeynalova",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Pia",lastName:"Lovric",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Erika",lastName:"Matsuda",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Lyubov",lastName:"Kostenko",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Anaelle",lastName:"Leclercq",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Alessandra",lastName:"Simone",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Darja",lastName:"Semenistaja",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Daria",lastName:"Frayman",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nastasja",lastName:"Schunk",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Olivia",lastName:"Gadecki",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"India",lastName:"Houghton",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Maria",lastName:"Sholokhova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Julia",lastName:"Middendorf",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Petra",lastName:"Marcinko",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Radka",lastName:"Zelnickova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Lucie",lastName:"Nguyen Tan",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tatiana",lastName:"Barkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Annabelle",lastName:"Xu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Harold",lastName:"Mayot",sex:"MALE",nationalityCode:"FRA"},{firstName:"Holger",lastName:"Vitus Nodskov Rune",sex:"MALE",nationalityCode:"DEN"},{firstName:"Dominic",lastName:"Stephan Stricker",sex:"MALE",nationalityCode:"SUI"},{firstName:"Shintaro",lastName:"Mochizuki",sex:"MALE",nationalityCode:"JPN"},{firstName:"Arthur",lastName:"Cazaux",sex:"MALE",nationalityCode:"FRA"},{firstName:"Leandro",lastName:"Riedi",sex:"MALE",nationalityCode:"SUI"},{firstName:"Martin",lastName:"Damm",sex:"MALE",nationalityCode:"USA"},{firstName:"Natan",lastName:"Rodrigues",sex:"MALE",nationalityCode:"BRA"},{firstName:"Karlis",lastName:"Ozolins",sex:"MALE",nationalityCode:"LAT"},{firstName:"Luciano",lastName:"Darderi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Hanwen",lastName:"Li",sex:"MALE",nationalityCode:"CHN"},{firstName:"Arthur",lastName:"Fery",sex:"MALE",nationalityCode:"GBR"},{firstName:"Juan",lastName:"Bautista Torres",sex:"MALE",nationalityCode:"ARG"},{firstName:"Khololwam",lastName:"Montsi",sex:"MALE",nationalityCode:"RSA"},{firstName:"Jeffrey",lastName:"Von Der Schulenburg",sex:"MALE",nationalityCode:"SUI"},{firstName:"Timo",lastName:"Legout",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gustavo",lastName:"Heide",sex:"MALE",nationalityCode:"BRA"},{firstName:"Flavio",lastName:"Cobolli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Guy",lastName:"Den Ouden",sex:"MALE",nationalityCode:"NED"},{firstName:"Martin",lastName:"Breysach",sex:"MALE",nationalityCode:"FRA"},{firstName:"Toby",lastName:"Kodat",sex:"MALE",nationalityCode:"USA"},{firstName:"Lilian",lastName:"Marmousez",sex:"MALE",nationalityCode:"FRA"},{firstName:"Roman",lastName:"Andres Burruchaga",sex:"MALE",nationalityCode:"ARG"},{firstName:"Alex",lastName:"Barrena",sex:"MALE",nationalityCode:"ARG"},{firstName:"Dalibor",lastName:"Svrcina",sex:"MALE",nationalityCode:"CZE"},{firstName:"Martin",lastName:"Krumich",sex:"MALE",nationalityCode:"CZE"},{firstName:"Peter",lastName:"Fajta",sex:"MALE",nationalityCode:"HUN"},{firstName:"Lukas",lastName:"Neumayer",sex:"MALE",nationalityCode:"AUT"},{firstName:"Raphael",lastName:"Collignon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Dali",lastName:"Blanch",sex:"MALE",nationalityCode:"USA"},{firstName:"Terence",lastName:"Atmane",sex:"MALE",nationalityCode:"FRA"},{firstName:"Felix",lastName:"Gill",sex:"MALE",nationalityCode:"GBR"},{firstName:"Eliakim",lastName:"Coulibaly",sex:"MALE",nationalityCode:"CIV"},{firstName:"Hamad",lastName:"Medjedovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Jerome",lastName:"Kym",sex:"MALE",nationalityCode:"SUI"},{firstName:"Nicholas",lastName:"David Ionel",sex:"MALE",nationalityCode:"ROU"},{firstName:"Shunsuke",lastName:"Mitsui",sex:"MALE",nationalityCode:"JPN"},{firstName:"Giovanni",lastName:"Mpetshi Perricard",sex:"MALE",nationalityCode:"FRA"},{firstName:"Bu",lastName:"Yunchaokete",sex:"MALE",nationalityCode:"CHN"},{firstName:"Jack",lastName:"Pinnington Jones",sex:"MALE",nationalityCode:"GBR"},{firstName:"Alexander",lastName:"Hoogmartens",sex:"MALE",nationalityCode:"BEL"},{firstName:"Bruno",lastName:"Oliveira",sex:"MALE",nationalityCode:"BRA"},{firstName:"Maks",lastName:"Kasnikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Mikolaj",lastName:"Lorens",sex:"MALE",nationalityCode:"POL"},{firstName:"Chak",lastName:"Lam Coleman Wong",sex:"MALE",nationalityCode:"HKG"},{firstName:"Egor",lastName:"Agafonov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Mans",lastName:"Dahlberg",sex:"MALE",nationalityCode:"SWE"},{firstName:"Marat",lastName:"Sharipov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Luca",lastName:"Nardi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Sean",lastName:"Cuenin",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pedro",lastName:"Boscardin Dias",sex:"MALE",nationalityCode:"BRA"},{firstName:"Samuel",lastName:"Vincent Ruggeri",sex:"MALE",nationalityCode:"ITA"},{firstName:"Bruno",lastName:"Kuzuhara",sex:"MALE",nationalityCode:"USA"},{firstName:"Romain",lastName:"Faucon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Elmer",lastName:"Moller",sex:"MALE",nationalityCode:"DEN"},{firstName:"Mario",lastName:"Mansilla Diez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Leonardo",lastName:"Malgaroli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Pierre",lastName:"Yves Bailly",sex:"MALE",nationalityCode:"BEL"},{firstName:"Sebastian",lastName:"Gima",sex:"MALE",nationalityCode:"ROU"},{firstName:"Ilya",lastName:"Snitari",sex:"MALE",nationalityCode:"MDA"},{firstName:"Diego",lastName:"Augusto Barreto Sanchez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alexander",lastName:"Bernard",sex:"MALE",nationalityCode:"USA"},{firstName:"Pengyu",lastName:"Lu",sex:"MALE",nationalityCode:"CHN"},{firstName:"Max",lastName:"Wiskandt",sex:"MALE",nationalityCode:"GER"},{firstName:"Max",lastName:"Westphal",sex:"MALE",nationalityCode:"FRA"},{firstName:"Lorenzo",lastName:"Claverie",sex:"MALE",nationalityCode:"VEN"},{firstName:"Axel",lastName:"Garcian",sex:"MALE",nationalityCode:"FRA"},{firstName:"Aleksander",lastName:"Orlikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Maxwell",lastName:"Mckennon",sex:"MALE",nationalityCode:"USA"},{firstName:"Rafael",lastName:"Alfonso De Alba Valdes",sex:"MALE",nationalityCode:"MEX"},{firstName:"Dev",lastName:"Javia",sex:"MALE",nationalityCode:"IND"},{firstName:"Kokoro",lastName:"Isomura",sex:"MALE",nationalityCode:"JPN"},{firstName:"Matteo",lastName:"Gigante",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jack",lastName:"Anthrop",sex:"MALE",nationalityCode:"USA"},{firstName:"Pablo",lastName:"Llamas Ruiz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Biagio",lastName:"Gramaticopolo",sex:"MALE",nationalityCode:"ITA"},{firstName:"Patorn",lastName:"Hanchaikul",sex:"MALE",nationalityCode:"THA"},{firstName:"Marko",lastName:"Topo",sex:"MALE",nationalityCode:"SRB"},{firstName:"Carlos",lastName:"Alcaraz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Juncheng",lastName:"Shang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Toby",lastName:"Samuel",sex:"MALE",nationalityCode:"GBR"},{firstName:"Petr",lastName:"Nesterov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Mehdi",lastName:"Sadaoui",sex:"MALE",nationalityCode:"FRA"},{firstName:"Max",lastName:"Alcala Gurri",sex:"MALE",nationalityCode:"ESP"},{firstName:"Nikita",lastName:"Kashirin",sex:"MALE",nationalityCode:"RUS"},{firstName:"Aidan",lastName:"Mayo",sex:"MALE",nationalityCode:"USA"},{firstName:"Yu",lastName:"Zhang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Philip",lastName:"Sekulic",sex:"MALE",nationalityCode:"AUS"},{firstName:"Lorenzo",lastName:"Rottoli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Michal",lastName:"Novansky",sex:"MALE",nationalityCode:"SVK"},{firstName:"Maikel",lastName:"De Boes",sex:"MALE",nationalityCode:"BEL"},{firstName:"Chen",lastName:"Dong",sex:"MALE",nationalityCode:"AUS"},{firstName:"Evgeny",lastName:"Philippov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Damien",lastName:"Salvestre",sex:"MALE",nationalityCode:"FRA"},{firstName:"Francesco",lastName:"Maestrelli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Viacheslav",lastName:"Bielinskyi",sex:"MALE",nationalityCode:"UKR"},{firstName:"Jean",lastName:"Marc Malkowski",sex:"MALE",nationalityCode:"SUI"},{firstName:"Santiago",lastName:"De La Fuente",sex:"MALE",nationalityCode:"ARG"},{firstName:"Simeon",lastName:"Terziev",sex:"MALE",nationalityCode:"BUL"},{firstName:"Benjamin",lastName:"Kittay",sex:"MALE",nationalityCode:"USA"}];var zv=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function Yv({valuesInstanceLimit:t,nationalityCodesCount:e,nationalityCodeType:n,nationalityCodes:i,participantsCount:r=32,participantType:a,personIds:o,uuids:s,personExtensions:c,addressProps:u,matchUpType:d,personData:l,category:p,sex:m,inContext:f}){const h=a===ka||d===pa,I=a===Fa||d===Fa,v=r*(h?2:I?8:1),{persons:g,error:y}=function({personExtensions:t,personData:e,count:n=1,category:i,sex:r}={}){if(isNaN(n))return{error:_n};let a=Kv.filter((t=>!r||t.sex===r));if(Array.isArray(e)){const t=e.filter((t=>"string"==typeof t.firstName&&"string"==typeof t.lastName&&!![GI,VI].includes(t.sex)&&!("string"!=typeof t.nationalityCode||t.nationalityCode.length>3)));if(!t.length)return{error:_n};a=t}const o=tt(a);if(o.length<n){const{maleFirstNames:t,maleLastNames:e,femaleFirstNames:i,femaleLastNames:a,nationalityCodes:s}=Kv.reduce(((t,e)=>{const{firstName:n,lastName:i,nationalityCode:r}=e;return e.sex===GI?(t.maleFirstNames.includes(n)||t.maleFirstNames.push(n),t.maleLastNames.includes(i)||t.maleLastNames.push(i)):(t.femaleFirstNames.includes(n)||t.femaleFirstNames.push(n),t.femaleLastNames.includes(i)||t.femaleLastNames.push(i)),t.nationalityCodes.includes(r)||t.nationalityCodes.push(r),t}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});ot(0,n-o.length).forEach((()=>{const n=r||at([GI,VI]),c=at(s),u={firstName:at(n===GI?t:i),lastName:at(n===GI?e:a),sex:n,nationalityCode:c};o.push(u)}))}const s=o.slice(0,n).map(((e,n)=>Object.assign(e,{extensions:t||[{name:"regionCode",value:n+1}],isMock:!0})));return{persons:s.length&&s||o[0]}}({count:v,personExtensions:c,personData:l,category:p,sex:m});if(y)return{error:y};const U=Fo.filter((t=>"ISO"===n?t.iso:t.ioc)),{citiesCount:w,statesCount:S,postalCodesCount:N}=u||{};const{cities:D}=function({count:t=1,participantsCount:e=32}={}){const n=tt(qv),i=n.slice(0,t);return{cities:ot(0,e).map((e=>e<Math.min(t,n.length)?i[e]:at(i)))}}({count:w||v,participantsCount:v}),{states:P}=function({count:t=1,participantsCount:e=32}={}){const n=tt(Wv),i=n.slice(0,t).map((t=>Object.keys(t))).flat();return{states:ot(0,e).map((e=>e<Math.min(t,n.length)?i[e]:at(i)))}}({count:S||v,participantsCount:v}),{postalCodes:T}=function({count:t=1,participantsCount:e=32}={}){const n=ot(0,t).map((()=>ot(0,5).map((()=>$(0,9))).join("")));return{postalCodes:ot(0,e).map((e=>e<t?n[e]:at(n)))}}({count:N||v,participantsCount:v}),A={cities:D,states:P,postalCodes:T},M=function(e){const n=Math.ceil(v/e);return t&&n>t?Math.ceil(v/t):e}(e),b=M?tt(U).slice(0,e):i?U.filter((t=>i.includes(t.key))):U,E=tt(ot(0,Math.ceil(v/(M||1))).map((()=>b)).flat(1/0)),C=function({count:t=1}={}){const e=tt(zv).slice(0,t);return e.length<t&&ot(0,t-e.length).forEach((t=>e.push(`Team ${t+1}`))),{teams:e}}({count:r}).teams;return{participants:ot(0,r).map((t=>{const e=h?2:I?8:1,n=ot(0,e).map((n=>function(t){const e=g[t],{sex:n,firstName:i,lastName:r,extensions:a,nationalityCode:c}=e||{},u=i||"GivenName",d=r||"FamilyName",l=`${u} ${d}`,p=E[t],m=p&&(p.ioc||p.iso)||c;null==E||!E.length||m||c||console.log("%c Invalid Nationality Code",{participantIndex:t,country:p});const f=function(t){const{cities:e,states:n,postalCodes:i,nationalityCode:r,participantIndex:a}=t;return{city:e&&e[a],state:n&&n[a],postalCode:i&&i[a],countryCode:r}}({...A,participantIndex:t,nationalityCode:m});return{participantId:(null==s?void 0:s.pop())||zi(),participantType:La,participantRole:Dm,participantName:l,person:{addresses:[f],personId:(null==o?void 0:o.length)&&o[t]||zi(),standardFamilyName:d,standardGivenName:u,nationalityCode:m,extensions:a,sex:n}}}(t*e+n))),i=n.map((t=>t.participantId)),r=n.map((t=>t.person.standardFamilyName)).join("/"),a={participantId:(null==s?void 0:s.pop())||zi(),participantType:h?ka:Fa,participantRole:Dm,participantName:h?r:C[t],individualParticipantIds:i};return f&&(a.individualParticipants=n),h||I?[a,...n]:n})).flat()}}const $v={[x]:2,[A]:1,[C]:1,[T]:4};function Jv({matchUpFormat:t="SET3-S:6/TB7",matchUpStatusProfile:e=$v,pointsPerMinute:n=1,sideWeight:i=4,winningSide:r,defaultWithScorePercent:a=2}){if(!v(t))return{error:ue};if("object"!=typeof e)return{error:_n};if(a>100&&(a=100),isNaN(a)||isNaN(n)||isNaN(i))return{error:_n};const o=Object.keys(e).filter((t=>Object.keys(V).includes(t)&&t!==D));if(Object.keys(o).reduce(((t,n)=>t+e[n]),0)>100)return{error:_n,matchUpStatusProfile:e};const s=o.reduce(((t,n)=>(t.pointer=t.pointer+e[n],t.valueMap.push([t.pointer,n]),t)),{pointer:0,valueMap:[]}),c=$(1,100),u=(s.valueMap.find((t=>c<=t[0]))||[100,D])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([x,T].includes(u)){const t={score:d,winningSide:r=r||$(1,2),matchUpStatus:u};if(!(u===T&&$(1,100)>100-a))return{outcome:t}}else if(u===A)return{outcome:{score:d,matchUpStatus:u}};const p=l(t),{bestOf:m,setFormat:f,finalSetFormat:h}=p,I=[],g=$(0,1),y=r?[r-1]:[...ot(0,i).map((()=>g)),1-g],U=[C,T,b,R].includes(u)&&(rt(ot(1,m))||1);let w;for(const l of ot(1,m+1)){const e=l===m,{set:i,incomplete:r,winningSideNumber:a}=Zv({incomplete:U===l,matchUpStatus:u,pointsPerMinute:n,setFormat:e&&h||f,setNumber:l,weightedRange:y});if(I.push(i),r){w=a;break}if(xo({matchUp:{score:{sets:I},matchUpFormat:t}}).calculatedWinningSide)break}const S=xo({matchUp:{score:{sets:I},matchUpFormat:t}}),N=w?r||w:S.calculatedWinningSide,{score:P}=Yl({score:{sets:I},winningSide:N,matchUpStatus:u});return{outcome:{score:P,winningSide:N,matchUpStatus:u}}}function Zv({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:n,incomplete:i,setFormat:r,setNumber:a}){const o={setNumber:a},{setTo:s,tiebreakFormat:c,tiebreakAt:u,tiebreakSet:d,timed:l,minutes:p}=r,m=$(0,t.length-1),f=t[m];let h;if(l){const r=p*e,a=Math.round(.2*r),s=r+rt([1,-1])*a,c=function(t=1,e=3,n=!0){let i=0;for(let r=0;r<e;r++)i+=Math.random()*(t/e);return n&&t>1?Math.round(i):i}(s,2),u=[c,s-c];f&&u.reverse(),h=t[m]+1;let d=u[0]>u[1]?1:u[1]>u[0]?2:0;if(i){const[t,e]=u;return Object.assign(o,{side1Score:t,side2Score:e}),B.includes(n)?{set:o,incomplete:i,winningSideNumber:h}:{set:o,incomplete:i}}d||(u[$(0,1)]+=1),d=u[0]>u[1]?1:2,d!==h&&u.reverse();const[l,I]=u;return Object.assign(o,{side1Score:l,side2Score:I,winningSide:h}),{set:o}}if(i)return o.side1Score=$(0,u),o.side2Score=$(0,u),B.includes(n)&&(h=t[m]+1),{set:o,incomplete:i,winningSideNumber:h};{const e=ot(1,s+1).map((t=>ot(0,s+2-t).map((()=>t)))).flat(),n=e[$(0,e.length-1)],i=s&&_a({isSide1:!0,tiebreakAt:u,lowValue:n,setTo:s}),a=!i,l=1===t.length&&t[m]+1;if(!a){if(l){(i[0]>i[1]?1:2)!==l&&i.reverse()}else f&&i.reverse();const[t,e]=i;Object.assign(o,{side1Score:t,side2Score:e})}const p=Oo({matchUpScoringFormat:{setFormat:r},setObject:o});let h;if(p.hasTiebreakCondition||a){const{NoAD:t,tiebreakTo:e}=c||d,n=ot(1,e+1).map((t=>ot(0,e+2-t).map((()=>t)))).flat(),i=n[$(0,n.length-1)];let r=Ga({isSide1:!0,lowValue:i,tiebreakTo:e,tiebreakNoAd:t});if(a){const t=r[0]>r[1]?1:2;l?t!==l&&r.reverse():f&&r.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=r,h=r[0]>r[1]?1:2}else 2===p.leadingSide?[o.side1TiebreakScore,o.side2TiebreakScore]=r:[o.side2TiebreakScore,o.side1TiebreakScore]=r}o.winningSide=p.winningSide||p.leadingSide||l||h}return{set:o}}function Qv({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:n,drawDefinition:i,matchUpFormat:r,event:a}){const o=i.structures.slice().sort(Hc),s="string"==typeof e&&e,c=s&&D;for(const u of o){const e=Gc({drawDefinition:i}),{matchUps:o}=ju({inContext:!0,drawDefinition:i,matchUpsMap:e,structure:u,event:a}),d=o.filter((({winningSide:t})=>!t)).sort(Kd).map(jc);for(const l of d){const{matchUps:o}=ju({inContext:!0,drawDefinition:i,matchUpsMap:e,structure:u,event:a}),d=o.find((t=>t.matchUpId===l)),p=d.matchUpStatus===A;if(null!=d&&d.readyToScore&&!p){const e=tg({winningSide:!n&&1,matchUpStatusProfile:t,drawDefinition:i,targetMatchUp:d,matchUpFormat:r,matchUpStatus:c,scoreString:s});if(e.error)return e}}}return{...pt}}function Xv({drawDefinition:t,targetMatchUp:e,matchUpStatus:n,matchUpFormat:i,scoreString:r,winningSide:a}){if(!e||e.matchUpStatus===S)return;const{matchUpId:o}=e||{},{outcome:s}=Hv({matchUpStatus:n,scoreString:r,winningSide:a});return $l({drawDefinition:t,matchUpFormat:i,matchUpId:o,outcome:s})}function tg(t){const{matchUpStatusProfile:e={},drawDefinition:n,matchUpStatus:i,matchUpFormat:r,targetMatchUp:a,scoreString:o,winningSide:s}=t;if(o||i)return Xv(t);const{matchUpId:c}=a||{},{outcome:u}=Jv({matchUpStatusProfile:e,matchUpFormat:r,winningSide:s});return $l({matchUpFormat:r,drawDefinition:n,matchUpId:c,outcome:u})}function eg({allUniqueParticipantIds:t,matchUpStatusProfile:e,participantsProfile:n,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:a,tournamentRecord:o,eventProfile:s,startDate:c,uuids:u}){let d=s.gender;const{eventName:l="Generated Event",eventType:p=Ma,policyDefinitions:m,drawProfiles:f=[],eventExtensions:h,surfaceCategory:I,tieFormatName:v,discipline:g,eventLevel:y,ballType:U,category:w}=s,S=s.tieFormat||(p===Ea?uv({namedFormat:v}):void 0);let N=o.participants,D=[];for(const W of f)!d&&W.gender&&(d=null==W?void 0:W.gender);let P={};const T=f.reduce(((t,e)=>{const{qualifyingPositions:n=0,participantsCount:i=0,uniqueParticipants:r,stage:a=_o,drawSize:o=0}=e||{};Object.keys(t).includes(a)||(t[a]=0);const s=i||o-n;return r||d?(Object.keys(P).includes(a)||(P[a]=0),P[a]+=s):t[a]=Math.max(s,t[a]),t}),{}),A=Object.keys(P);A.forEach((t=>T[t]+=P[t]));const M=p===Ma?La:p===ba?ka:p,b=[];if(A){const{valuesInstanceLimit:t,nationalityCodesCount:e,nationalityCodeType:i,nationalityCodes:r,addressProps:a,personIds:s,inContext:c}=n||{},l=P[_o]||0,p=P[Go]||0,{participants:m}=Yv({participantsCount:l+p,participantType:M,sex:d,uuids:u,valuesInstanceLimit:t,nationalityCodesCount:e,nationalityCodeType:i,nationalityCodes:r,addressProps:a,personIds:s,inContext:c});let f=mp({tournamentRecord:o,participants:m});if(f.error)return f;D=m.filter((({participantType:t})=>t===M)),m.forEach((({participantId:t})=>b.push(t)))}const E=T[_o]||0,C=T[Go]||0,R={QUALIFYING:N.filter((({participantType:t})=>t===M)).filter((({participantId:e})=>!t.includes(e))).slice(0,C),MAIN:N.filter((({participantType:t})=>t===M)).filter((({participantId:e})=>!t.includes(e))).slice(C,C+E)};let{eventAttributes:O}=s;"object"!=typeof O&&(O={});const x=s.eventId||zi(),L={...O,surfaceCategory:I,discipline:g,eventLevel:y,eventName:l,eventType:p,tieFormat:S,ballType:U,category:w,eventId:x,gender:d};if(null!=h&&h.length&&Array.isArray(h)){const t=h.filter(Kc);null!=t&&t.length&&Object.assign(L,{extensions:t})}if("object"==typeof m)for(const W of Object.keys(m))Bm({event:L,policyDefinitions:{[W]:m[W]}});let F=dv({tournamentRecord:o,event:L});if(F.error)return F;const{event:k}=F;let j=0;for(const W of f){const{drawType:t=us,qualifyingPositions:e=0,uniqueParticipants:n,stage:i=_o,drawSize:a=0,drawName:s,drawId:c}=W,u=a-e,l=n?D.slice(j,u):R[i||_o]||[];(n||d)&&(j+=u);const p=l.slice(0,u).map(Fc);if(p.length){const t=bh({participantIds:p,autoEntryPositions:r,tournamentRecord:o,stage:i,event:k});if(t.error)return t}const m=xv({drawName:s||t,qualifyingPositions:e,drawEntries:p.map((t=>({entryStatus:ou,entryStage:i,participantId:t}))),drawId:c,event:k,stage:i});if(m.error)return m}const B=[],{flightProfile:_}=ol({event:k});if(Array.isArray(null==_?void 0:_.flights))for(const[W,q]of _.flights.entries()){const{drawId:t,stage:n,drawName:r,drawEntries:s}=q;B.push(q.drawId);const u=f[W],{seedsCount:d,generate:m=!0}=u||{};if(m){var G,V,H;const m=s.filter(rl).map(Fc),h=(null===(G=k.category)||void 0===G?void 0:G.ageCategoryCode)||(null===(V=k.category)||void 0===V?void 0:V.categoryName)||l;if(o&&d&&d<=m.length){ot(1,d+1).forEach(((t,e)=>{let n={scaleValue:t,scaleName:h,scaleType:_h,eventType:p,scaleDate:c};const i=m[e];CI({tournamentRecord:o,participantId:i,scaleItem:n})}))}let I=Pv({...u,matchUpType:p,seedingScaleName:h,tournamentRecord:o,isMock:!0,drawEntries:s,drawName:r,drawId:t,event:k,stage:n});const{drawDefinition:v,error:g}=I;if(g)return{error:g};const y=null===(H=f[W])||void 0===H?void 0:H.drawExtensions;if(Array.isArray(y)&&y.filter(Kc).forEach((t=>zc({element:v,extension:t}))),I=dp({drawDefinition:v,event:k}),I.error)return I;if(null!=u&&u.withPlayoffs){const t=v.structures[0].structureId,e=Av({idPrefix:u.idPrefix,...u.withPlayoffs,tournamentRecord:o,drawDefinition:v,isMock:!0,structureId:t,event:k});if(null!=e&&e.error)return e}if(!(!1===(null==u?void 0:u.automated))&&i){const t=null==u?void 0:u.matchUpFormat,n=Qv({matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:a,drawDefinition:v,matchUpFormat:t});if(n.error)return n;if((null==u?void 0:u.drawType)===Ds){let n=Iv({structureId:v.structures.find((t=>t.stage===_o)).structureId,tournamentRecord:o,drawDefinition:v,event:k});if(n.error)return n;if(n=Qv({completeAllMatchUps:i,matchUpStatusProfile:e,randomWinningSide:a,matchUpFormat:t,drawDefinition:v}),n.error)return n}}}}return{drawIds:B,eventId:x,uniqueParticipantIds:b}}function ng({tieFormat:t,tieFormatName:e,drawSize:n,alternatesCount:i=0}){var r,a;let o=0,s=0;null===(r=t="object"==typeof t?t:uv({namedFormat:e}))||void 0===r||null===(a=r.collectionDefinitions)||void 0===a||a.forEach((t=>{if(t.collectionId||(t.collectionId=zi()),(null==t?void 0:t.matchUpType)===pa){const e=t.matchUpCount;o=Math.max(o,e)}if((null==t?void 0:t.matchUpType)===la){const e=t.matchUpCount;s=Math.max(s,e)}}));const c=Math.max(s,2*o);return{maxDoublesDraw:o*(n+i),maxSinglesDraw:s*(n+i),teamSize:c}}function ig({allUniqueParticipantIds:t=[],matchUpStatusProfile:e,participantsProfile:n,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:a,tournamentRecord:o,drawProfile:s,startDate:c,goesTo:u,uuids:d}){var l,p,m;const{excessParticipantAlternates:f=!0,matchUpFormat:h=y,drawType:I=us,eventType:v=Ma,alternatesCount:g=0,eventExtensions:U,drawExtensions:w,drawSize:S=32,tieFormatName:N,seedsCount:P,category:T,idPrefix:A,gender:M,stage:b}=s,E="object"==typeof s.tieFormat?s.tieFormat:v===Fa?uv({namedFormat:N}):void 0;let C=s.eventName||`Generated ${v}`,R=(null==o?void 0:o.participants)||[];const O=!s.participantsCount||s.participantsCount>S?S:s.participantsCount,x=zi();let L={eventName:C,eventType:v,tieFormat:E,category:T,eventId:x},{eventAttributes:F}=s;if("object"!=typeof F&&(F={}),Object.assign(L,F),null!=U&&U.length&&Array.isArray(U)){const t=U.filter(Kc);null!=t&&t.length&&Object.assign(L,{extensions:t})}const k=[];if(s.uniqueParticipants||!o||M||T){let t,e=O+g;v===Fa&&(({teamSize:t}=ng({alternatesCount:g,tieFormatName:N,tieFormat:E,drawSize:S})),e=t*S);const i=v===ba?ka:La,{valuesInstanceLimit:r,nationalityCodesCount:a,nationalityCodeType:c,nationalityCodes:u,addressProps:l,personIds:p,inContext:m}=n||{},{participants:f}=Yv({participantsCount:e,sex:M||(null==n?void 0:n.sex),uuids:s.uuids||d,nationalityCodesCount:a,nationalityCodeType:c,valuesInstanceLimit:r,nationalityCodes:u,participantType:i,addressProps:l,personIds:p,inContext:m});if(o){let t=mp({tournamentRecord:o,participants:f});if(t.error)return t}if(f.forEach((({participantId:t})=>k.push(t))),R=f,v===Fa){const e=f.filter((({participantType:t})=>t===La)).map(Fc),n=ot(0,S).map((n=>{const i=e.slice(n*t,(n+1)*t);return{participantName:`Team ${n+1}`,participantRole:Dm,participantType:Fa,participantId:zi(),individualParticipantIds:i}})),i=mp({tournamentRecord:o,participants:n});if(!i.success)return i;R=n}}const j=t=>{const{participantType:e}=t;return v===Ma&&e===La||(v===ba&&e===ka||v===Fa&&e===Fa)},B=t=>{var e,n;return!s.gender||((null===(e=t.person)||void 0===e?void 0:e.sex)===s.gender||(!(null===(n=t.individualParticipantIds)||void 0===n||!n.some((t=>{const e=R.find((e=>e.participantId===t));return e&&B(e)})))||void 0))},_=R.filter(j).filter(B).filter((({participantId:e})=>!t.includes(e))).slice(0,O).map((t=>t.participantId));let G=bh({entryStage:b,autoEntryPositions:r,tournamentRecord:o,participantIds:_,event:L});if(G.error)return G;const V=f&&(null==o||null===(l=o.participants)||void 0===l?void 0:l.filter((({participantId:t})=>!_.includes(t))).filter(j).filter(B).slice(0,g||S-O).map((t=>t.participantId)));if(null!=V&&V.length&&(G=bh({participantIds:V,autoEntryPositions:!1,entryStatus:nu,tournamentRecord:o,event:L}),G.error))return{error:G.error};const H=(null===(p=L.category)||void 0===p?void 0:p.ageCategoryCode)||(null===(m=L.category)||void 0===m?void 0:m.categoryName)||C;if(o&&P&&P<=_.length){ot(1,P+1).forEach(((t,e)=>{let n={scaleValue:t,scaleName:H,scaleType:Tr,eventType:v,scaleDate:c};const i=_[e];CI({tournamentRecord:o,participantId:i,scaleItem:n})}))}const{drawDefinition:W,error:q}=Pv({...s,tournamentRecord:o,seedingScaleName:H,matchUpFormat:h,isMock:!0,eventId:x,goesTo:u,event:L});if(q)return{error:q};Array.isArray(w)&&w.filter(Kc).forEach((t=>zc({element:W,extension:t}))),G=dp({drawDefinition:W,event:L});const{drawId:K}=W;if(s.withPlayoffs){const t=W.structures[0].structureId,e=Av({...s.withPlayoffs,tournamentRecord:o,drawDefinition:W,isMock:!0,structureId:t,idPrefix:A,event:L});if(null!=e&&e.error)return e}if(!(!1===s.automated)){if(s.outcomes){const{matchUps:t}=hd({drawDefinition:W,inContext:!0,event:L});for(const e of s.outcomes){const{roundNumber:n,drawPositions:i,roundPosition:r,scoreString:a,winningSide:o,stage:s=_o,matchUpFormat:c,stageSequence:u=1,matchUpStatus:d=D,matchUpIndex:l=0,structureOrder:p}=e,m=t.reduce(((t,e)=>{const{structureId:n,matchUpId:i}=e;return t[n]?t[n].push(i):t[n]=[i],t}),{}),f=Object.assign({},...Object.keys(m).map(((t,e)=>({[t]:e+1})))),h=t.filter((t=>!(s&&t.stage!==s||u&&t.stageSequence!==u||n&&t.roundNumber!==n||r&&t.roundPosition!==r||p&&f[t.structureId]!==p||i&&2!==ct(i,t.drawPositions).length)))[l],I=Xv({drawDefinition:W,targetMatchUp:h,matchUpFormat:c,matchUpStatus:d,scoreString:a,winningSide:o,drawId:K});if(null!=I&&I.error)return I}}if(i){const t=Qv({drawDefinition:W,matchUpFormat:h,randomWinningSide:a,completeAllMatchUps:i,matchUpStatusProfile:e});if(t.error)return t;if(I===Ds){let t=Iv({structureId:W.structures.find((t=>t.stage===_o)).structureId,tournamentRecord:o,drawDefinition:W,event:L});if(t=Qv({drawDefinition:W,matchUpFormat:h,randomWinningSide:a,completeAllMatchUps:i,matchUpStatusProfile:e}),t.error)return t}}}return G.error?{error:G.error}:{...pt,event:Wi(L),uniqueParticipantIds:k,targetParticipants:R,drawDefinition:W,eventId:x,drawId:K}}const rg={generateTournamentRecord:function({tournamentName:t="Mock Tournament",tournamentExtensions:e,tournamentAttributes:n,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,randomWinningSide:s,policyDefinitions:c,schedulingProfile:u,eventProfiles:d,venueProfiles:l,drawProfiles:p,autoSchedule:m,startDate:f,endDate:h,goesTo:I,uuids:v}={}){let{participantsCount:g,participantType:y=La}=r||{};const U=g||0;if(f&&!wi(f)||h&&!wi(h))return{error:Fe};if(!f){const t=new Date;f=Ni(h||t),h=Ni(t.setDate(t.getDate()+7))}if(!h){const t=new Date(f);h=Ni(t.setDate(t.getDate()+7))}"object"!=typeof n&&(n={});const w=LI({...n,tournamentName:t,startDate:f,endDate:h});if(null!=e&&e.length&&Array.isArray(e)){const t=e.filter(Kc);null!=t&&t.length&&Object.assign(w,{extensions:t,isMock:!0})}if("object"==typeof c)for(const Y of Object.keys(c))jm({policyDefinitions:{[Y]:c[Y]},tournamentRecord:w});let S=0,N=0,D=0,P=0;const T=({alternatesCount:t=0,uniqueParticipants:e,tieFormatName:n,drawSize:i=0,eventType:r,tieFormat:a,category:o,gender:s})=>{const c=r===ba,u=r===Ea;if(u&&!o&&!e&&!s){P=Math.max(P,i+t),a="object"==typeof a?a:uv({namedFormat:n});const{teamSize:e,maxDoublesDraw:r,maxSinglesDraw:o}=ng({alternatesCount:t,tieFormatName:n,tieFormat:a,drawSize:i});D=Math.max(D,e),S=Math.max(S,r),N=Math.max(N,o)}c&&i+t&&i+t>S&&(S=i+t),!c&&!u&&i&&i>N&&(N=i+t)};if(null==d||d.forEach((t=>{const{tieFormatName:e,tieFormat:n,drawProfiles:i,eventType:r,category:a}=t;if(i)for(const o of i){const{tieFormatName:t,tieFormat:i}=o;T({...o,tieFormatName:t||e,tieFormat:i||n,eventType:r,category:a})}})),p)for(const Y of p)T(Y);const A=Math.max(P*D,2*S,N);S&&(y=ka),(g||U)<A&&(g=A),g&&S&&[ka,Ea].includes(y)&&(N&&Math.floor(N/2)>S?g=Math.floor(N/2):(!N||2*S>=N)&&(g=Math.ceil(g/2))),g||(g=32),g<U&&(g=U);const{nationalityCodesCount:M,nationalityCodeType:b,valuesInstanceLimit:E,nationalityCodes:C,personExtensions:R,addressProps:O,personData:x,personIds:L,inContext:F,teamKey:k,sex:j}=r||{},{participants:B}=Yv({valuesInstanceLimit:E,nationalityCodesCount:M,nationalityCodeType:b,nationalityCodes:C,personExtensions:R,addressProps:O,personData:x,sex:j,participantsCount:g,participantType:y,personIds:L,uuids:v,inContext:F});let _=mp({tournamentRecord:w,participants:B});if(!_.success)return _;if(k){const t=_I({tournamentRecord:w,...k});if(t.error)return t}const G=B.filter((({participantType:t})=>t===La)).map(Fc);if(_=mp({tournamentRecord:w,participants:ot(0,P).map((t=>{const e=G.slice(t*D,(t+1)*D);return{participantName:`Team ${t+1}`,participantRole:Dm,participantType:Ea,participantId:zi(),individualParticipantIds:e}}))}),!_.success)return _;const V=[],H=[],W=[];if(p)for(const Y of p){const{drawId:t,eventId:e,event:n,error:c,uniqueParticipantIds:u}=ig({tournamentRecord:w,allUniqueParticipantIds:W,autoEntryPositions:o,participantsProfile:r,completeAllMatchUps:a,matchUpStatusProfile:i,randomWinningSide:s,drawProfile:Y,startDate:f,goesTo:I});if(c)return{error:c};const d=dv({tournamentRecord:w,event:n});if(d.error)return d;V.push(t),H.push(e),null!=u&&u.length&&W.push(...u)}if(d)for(const Y of d){const{error:t,eventId:e,drawIds:n,uniqueParticipantIds:c}=eg({allUniqueParticipantIds:W,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,randomWinningSide:s,tournamentRecord:w,eventProfile:Y,startDate:f});if(t)return{error:t};n&&V.push(...n),H.push(e),null!=c&&c.length&&W.push(...c)}const q=null!=l&&l.length?function({tournamentRecord:t,venueProfiles:e}){const{startDate:n,endDate:i}=t;let r=[];for(const[a,o]of e.entries()){let{venueId:e=zi(),venueName:s,courtsCount:c,dateAvailability:u,startTime:d="07:00",endTime:l="19:00"}=o,p=lp({tournamentRecord:t,venue:{venueId:e,venueName:s||`Venue ${a+1}`}});if(p.error)return p;r.push(e);const m=Ti(n,i);if(u=!Array.isArray(u)&&m.map((t=>({date:Ni(t),startTime:d,endTime:l})))||u,p=op({tournamentRecord:t,venueId:e,courtsCount:c,dateAvailability:u}),p.error)return p}return r}({tournamentRecord:w,venueProfiles:l}):[];let K,z={};if(u){const t=function({schedulingProfile:t,tournamentRecord:e}){if("object"!=typeof t)return{error:_n};const n=Dl({tournamentRecord:e}).containedStructures,{matchUps:i}=fd({tournamentRecord:e}),{tournamentId:r}=e,a=[];for(const o of t){const{scheduleDate:t,venues:s=[]}=o;for(const o of s){const{rounds:s,venueId:c}=o;for(const o of s){const{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,l=i.filter((t=>{var e;const n=(null==u?void 0:u.indexOf("-"))>0&&u.split("-").map((t=>+t)),i=null===(e=t.finishingPositionRange)||void 0===e?void 0:e.winner;return!(t.drawId!==s||o.roundNumber&&t.roundNumber!==o.roundNumber||i&&n&&2!==ct(i,n).length)}))[0];if(l){const{eventId:i,roundNumber:o,drawName:p,structureName:m,roundName:f}=l;let h=l.structureId;o&&!u&&(h=Object.keys(n).find((t=>n[t].includes(h))));const I={tournamentId:r,eventId:i,drawId:s,structureId:h,roundNumber:o,roundSegment:d};let v=Bd({tournamentRecords:{[r]:e},scheduleDate:t,venueId:c,round:I});if(v.error)return v;a.push({drawName:p,structureName:m,roundName:f,...I})}}}}return{scheduledRounds:a}}({schedulingProfile:u,tournamentRecord:w});if(t.error)return t;if(K=t.scheduledRounds,m){const{tournamentId:t}=w;z=Im({tournamentRecords:{[t]:w}})}}return Wi({tournamentRecord:w,scheduledRounds:K,schedulerResult:z,eventIds:H,venueIds:q,drawIds:V})},generateParticipants:Yv,generateEventWithDraw:ig,generateOutcomeFromScoreString:Hv,generateOutcome:Jv,parseScoreString:Vv,credits:Gm},ag=function(){const t={version:()=>"0.56.2",devContext:e=>(ni(e),t)};return[rg].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{try{return function(t,e){const n=t({...e});return null!=n&&n.error||jp(),oi(),n}(e[n],t)}catch(i){console.log("%c ERROR","color: orange",{err:i})}}}))})),t}(),og={auditConstants:mv,drawDefinitionConstants:Rs,entryStatusConstants:vu,errorConditionConstants:Zn,eventConstants:Ca,extensionConstants:Xr,flightConstants:Ov,genderConstants:HI,keyValueConstants:Uo,matchUpActionConstants:zm,matchUpStatusConstants:V,matchUpTypes:fa,participantConstants:Dp,participantRoles:Pm,participantTypes:Ba,penaltyConstants:{COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},policyConstants:lr,positionActionConstants:Ks,ratingConstants:TI,requestConstants:nm,resultConstants:mt,scaleConstants:Gh,scheduleConstants:ga,surfaceConstants:{CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},tieFormatConstants:sv,timeItemConstants:Cr,topicConstants:Dc,venueConstants:{INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"}};var sg={chunkArray:dt,countValues:function(t){return e=et(t),Object.keys(e).reduce(((t,n)=>{const i=e[n];return t[i]?t[i].push(n):t[i]=[n],t}),{});var e},dateRange:Ti,dateTime:Vi,garman:nc,generateRange:ot,generateHashCode:function(t){if(null===t||"object"!=typeof t)return;const e=JSON.stringify(t),n=qi(t),i=e.split("").reduce(((t,e)=>t+e.charCodeAt(0)),0);return[e.length,n,i].map((t=>t.toString(36))).join("")},generateTimeCode:Q,instanceCount:et,intersection:ct,isNumeric:z,JSON2CSV:function(t,e){if(e&&"object"!=typeof e)return _n;const{includeTransoformAccessors:n,columnAccessors:i=[],columnTransform:r={},columnMap:a={},valuesMap:o={},context:s={},delimiter:c='"',columnJoiner:u=",",rowJoiner:d="\r\n",keyJoiner:l="."}=e||{};if(!Array.isArray(t)||!Array.isArray(i)||"object"!=typeof s||"object"!=typeof a||"object"!=typeof r||"object"!=typeof o||"string"!=typeof u||"string"!=typeof d||"string"!=typeof l||"string"!=typeof c)return _n;const p=t.filter(Boolean).map((t=>ic(t,l))),m=Object.values(r).flat();n&&i.push(...m);const f=p.reduce(((t,e)=>Object.keys(e).every((e=>!t.includes(e)&&t.push(e)||!0))&&t),[]).filter((t=>!(null!=i&&i.length)||i.includes(t))),h=Object.assign({},...Object.keys(r).map((t=>r[t].map((e=>({[e]:t}))).flat())).flat()),I=f.reduce(((t,e)=>{const n=h[e];return n?t.includes(n)||t.push(n):t.push(e),t}),[]);Object.keys(a).forEach((t=>!I.includes(t)&&I.unshift(t))),Object.keys(r).forEach((t=>!I.includes(t)&&I.unshift(t))),"object"==typeof s&&Object.keys(s).forEach((t=>!I.includes(t)&&I.unshift(t)));const v=I.map((t=>a[t]||t)),g=t=>`${c}${t}${c}`,y=p.map((t=>Object.values(I.reduce(((e,n)=>{var i;const a=r[n],c=(null!=a&&a.length?t[a.find((e=>t[e]))]:t[n])||(null==s?void 0:s[n])||"",u=(null===(i=o[n])||void 0===i?void 0:i[c])||c;return e[n]=g(u),e}),{})).join(u)));return[v.map(g).join(u),...y].join(d)},makeDeepCopy:Hi,nearestPowerOf2:K,numericSort:Ki,overlap:ut,isPowerOf2:q,randomMember:at,randomPop:rt,shuffleArray:tt,unique:X,UUID:zi,UUIDS:function(t=1){return ot(0,t).map(zi)}}}}]);