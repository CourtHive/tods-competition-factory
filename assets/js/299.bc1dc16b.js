"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[299],{7942:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>f});var r=n(959);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=r.createContext({}),u=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=u(e.components);return r.createElement(c.Provider,{value:t},e.children)},p="mdxType",l={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=u(n),m=i,f=p["".concat(c,".").concat(m)]||p[m]||l[m]||a;return n?r.createElement(f,o(o({ref:t},d),{},{components:n})):r.createElement(f,o({ref:t},d))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=m;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:i,o[1]=s;for(var u=2;u<a;u++)o[u]=n[u];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2070:(e,t,n)=>{n.d(t,{C9:()=>Di,M6:()=>AR,QO:()=>Ib,SX:()=>gb,_3:()=>jm,aX:()=>JS,hC:()=>Ub,y1:()=>yT});const r="timed",i="NOAD",a="SET",o={S:"normal",F:"final"};function s(e,t){if("object"==typeof e)return(e.bestOf||e.exactly)&&e.setFormat?function(e,t){const n=c(e.bestOf)||void 0,r=c(e.exactly)||void 0,i=n||r;if(e.setFormat?.timed&&e.simplified&&1===i)return u(e.setFormat);const o=i&&`${a}${i}`||"",s=d(e.setFormat,t),p=s&&`S:${s}`||"",l=d(e.finalSetFormat,t),m=i&&i>1&&l&&s!==l&&`F:${l}`||"";if(o&&s)return[o,p,m].filter((e=>e)).join("-");return}(e,t):void 0}function c(e){return!isNaN(Number(e))&&Number(e)}function u(e){let t=`T${e.minutes}`;return e.based&&(t+=e.based),e.modifier&&(t+=`@${e.modifier}`),t}function d(e,t){if("object"==typeof e&&Object.keys(e).length){if(e.timed)return u(e);if(e.tiebreakSet)return p(e.tiebreakSet);const n=c(e.setTo);if(n){const r=e.NoAD&&i||"",a=p(e.tiebreakFormat),o=a&&`/${a}`||"",s=c(e.tiebreakAt);if(!1!==a)return`${n}${r}${o}${s&&(s!==n||t)&&`@${s}`||""}`}}}function p(e){if(e){if("object"!=typeof e||e.tiebreakTo){if("object"==typeof e&&c(e.tiebreakTo)){let t=`TB${e.tiebreakTo}${e.NoAD?i:""}`;return e.modifier&&(t+=`@${e.modifier}`),t}return!1}return""}}function l(e,t){return e-t}function m(e){return"number"==typeof e?parseInt(e.toString()):parseInt(e)}function f(e){return!isNaN(e)&&(e&&0==(e&e-1))}function h(e){if(!e.length)return;const t=[...e].sort(l),n=Math.floor(t.length/2);return t.length%2?t[n]:(t[n-1]+t[n])/2}function I(e){return isNaN(e)?0:e%2&&e+1||e}function g(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function U(e){return!isNaN(parseFloat(e))}function y(e){if(isNaN(e))return!1;for(;!f(e);)e++;return e}function v(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function S(e){return Number.isSafeInteger("string"==typeof e?+e:e)}function w(e,t,n,r,i=2){const a=1-Math.random(),o=1-Math.random();let s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=w(e,t,n):(s=Math.pow(s,n),s*=t-e,s+=e),r&&(s=function(e,t){t||(t=1);const n=1/t;return Math.round(e*n)/n}(s,r)),parseFloat(s.toFixed(i))}function P(e){return e.filter(((e,t,n)=>n.lastIndexOf(e)===t))}function T(e){return e.map((e=>[Math.random(),e])).sort(((e,t)=>e[0]-t[0])).map((e=>e[1]))}function D(e){return S(e)?e:1/0}function R(e){return e.reduce(((e,t)=>(e[t]||(e[t]=0),e[t]++,e)),{})}function b(e,t,n){return n.indexOf(e)===t}function N(e){return e.filter(b)}function M(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function A(e){return e[Math.floor(Math.random()*e.length)]}function E(e,t){return Array.from({length:t-e},((t,n)=>n+e))}function C(e,t){return t.reduce(((t,n,r)=>(n===e&&t.push(r),t)),[])}function O(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>-1!==t.indexOf(e))).filter(((e,t,n)=>n.indexOf(e)===t)):[]}function F(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>!t.includes(e))):[]}function k(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some((e=>t.includes(e)))}function x(e,t){return e.reduce(((e,n,r)=>{const i=Math.floor(r/t);return e[i]=[].concat(e[i]||[],n),e}),[])}function _(e,t,n){return e.reduce(((e,r,i)=>{const a=!!n&&!!(Math.floor(i/t)%2),o=i%t,s=a?t-1-o:o;return e[s]||(e[s]=[]),e[s].push(r),e}),[])}const L={success:!0},B={SUCCESS:L,ERROR:"error"},V={message:"Chronological error; time violation.",code:"ANACHRONISM"},j={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},G={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},q={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},$={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},W={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},H={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},z={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Y={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},K={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Q={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},J={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},X={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},Z={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},ee={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},te={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},ne={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},re={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},ie={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},ae={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},oe={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},se={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},ce={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},ue={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},de={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},pe={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},le={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},me={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},fe={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},he={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Ie={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},ge={message:"Invalid action",code:"ERR_INVALID_ACTION"},Ue={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},ye={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},ve={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Se={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},we={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},Pe={message:"Existing round",code:"ERR_EXISTING_ROUND"},Te={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},De={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Re={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},be={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Ne={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Me={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Ae={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Ee={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Ce={message:"Event exists",code:"ERR_EXISTING_EVENT"},Oe={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Fe={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},ke={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},xe={message:"Missing stage",code:"ERR_MISSING_STAGE"},_e={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Le={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Be={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Ve={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},je={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Ge={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},qe={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},$e={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},We={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},He={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},ze={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Ye={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Ke={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Qe={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Je={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Xe={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Ze={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},et={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},tt={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},nt={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},rt={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},it={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},at={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},ot={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},st={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},ct={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},ut={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},dt={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},pt={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},lt={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},mt={message:"Missing value",code:"ERR_MISSING_VALUE"},ft={message:"Missing date",code:"ERR_MISSING_DATE"},ht={message:"No valid dates",code:"ERR_NO_VALID_DATES"},It={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},gt={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Ut={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},yt={message:"Invalid Date",code:"ERR_INVALID_DATE"},vt={message:"Invalid time",code:"ERR_INVALID_TIME"},St={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},wt={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Pt={message:"Invalid score",code:"ERR_INVALID_SCORE"},Tt={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Dt={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},Rt={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},bt={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Nt={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Mt={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},At={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Et={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ct={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Ot={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Ft={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},kt={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},xt={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},_t={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},Lt={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Bt={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Vt={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},jt={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Gt={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},qt={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},$t={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Wt={message:"Participant already checked in",code:"ERR_UNCHANGED_PARTICIPANT_CHECKED_IN"},Ht={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},zt={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},Yt={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Kt={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},Qt={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Jt={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Xt={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Zt={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},en={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},tn={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},nn={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},rn={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},an={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},on={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},sn={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},cn={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},un={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},dn={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},pn={message:"Court exists",code:"ERR_EXISTING_COURT"},ln={message:"Venue exists",code:"ERR_EXISTING_VENUE"},mn={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},fn={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},hn={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},In={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},gn={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Un={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},yn={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},vn={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Sn={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},wn={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Pn={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Tn={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Dn={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Rn={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},bn={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Nn={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Mn={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},An={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},En={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Cn={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},On={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Fn={message:"Invalid gender",code:"ERR_INVALID_GENDER"},kn={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},xn={message:"Invalid values",code:"ERR_INVALID_VALUES"},_n={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},Ln={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Bn={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},Vn={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},jn={message:"Value unchanged",code:"ABORT_UNCHANGED"},Gn={message:"Not found",code:"ERR_NOT_FOUND"},qn={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},$n={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},Wn={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Hn={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},zn={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},Yn={message:"Existing stage",code:"ERR_EXISTING_STAGE"},Kn={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Qn={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Jn={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Xn={message:"Scores present",code:"ERR_SCORES_PRESENT"},Zn={ANACHRONISM:V,CANNOT_CHANGE_WINNING_SIDE:Mt,CANNOT_MODIFY_TIEFORMAT:Rt,CANNOT_MODIFY_PARTICIPANT_TYPE:bt,CANNOT_REMOVE_MAIN_STRUCTURE:j,CANNOT_REMOVE_PARTICIPANTS:Nt,COURT_EXISTS:pn,COURT_NOT_FOUND:dn,DRAW_DEFINITION_NOT_FOUND:Q,DRAW_ID_EXISTS:me,DRAW_POSITION_ACTIVE:ae,DRAW_POSITION_ASSIGNED:ee,DRAW_POSITION_NOT_CLEARED:ne,DRAW_POSITION_NOT_FOUND:{message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},DRAW_SIZE_MISMATCH:de,DUPLICATE_VALUE:_n,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:tn,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:en,EVENT_EXISTS:Ce,EVENT_NOT_FOUND:Ee,EXISTING_DRAW_DEFINITIONS:K,EXISTING_END_TIME:In,EXISTING_FLIGHT:$n,EXISTING_MATCHUP_ID:zn,EXISTING_OUTCOME:Hn,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:zt,EXISTING_PARTICIPANT:Yt,EXISTING_POLICY_TYPE:st,EXISTING_PROFILE:Wn,EXISTING_ROUND:Pe,EXISTING_STAGE:Yn,EXISTING_STRUCTURE:Kn,INCOMPATIBLE_MATCHUP_STATUS:qe,INCOMPLETE_SOURCE_STRUCTURE:X,INSUFFICIENT_DRAW_POSITIONS:an,INVALID_ACTION:ge,INVALID_ASSIGNMENT:Ue,INVALID_BOOKINGS:It,INVALID_CATEGORY:kn,INVALID_COLLECTION_DEFINITION:Cn,INVALID_CONFIGURATION:En,INVALID_DATE_AVAILABILITY:gt,INVALID_DATE:yt,INVALID_DRAW_DEFINITION:z,INVALID_DRAW_POSITION_FOR_SEEDING:Z,INVALID_DRAW_POSITION:oe,INVALID_DRAW_SIZE:ue,INVALID_END_TIME:hn,INVALID_ENTRIES:Fe,INVALID_EVENT_TYPE:Me,INVALID_GAME_SCORES:wt,INVALID_GENDER:Fn,INVALID_MATCHUP_FORMAT:He,INVALID_MATCHUP_STATUS:$e,INVALID_MATCHUP_STATUS_BYE:Ve,INVALID_MATCHUP:tt,INVALID_OBJECT:On,INVALID_PARTICIPANT_ID:Et,INVALID_PARTICIPANT_IDS:Ct,INVALID_PARTICIPANT_ROLE:Ot,INVALID_PARTICIPANT_SEEDING:fe,INVALID_PARTICIPANT_TYPE:Ft,INVALID_PARTICIPANT:At,INVALID_POLICY_DEFINITION:ot,INVALID_RECORDS:G,INVALID_SCALE_ITEM:Rn,INVALID_SEED_NUMBER:ve,INVALID_SEED_POSITION:Se,INVALID_SET_NUMBER:{message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},INVALID_SIDE_NUMBER:dt,INVALID_SCORE:Pt,INVALID_STAGE:_e,INVALID_START_TIME:Un,INVALID_STRUCTURE:J,INVALID_STOP_TIME:gn,INVALID_TIE_FORMAT:We,INVALID_TIME:vt,INVALID_TIME_ITEM:vn,INVALID_TOURNAMENT_DATES:St,INVALID_TOURNAMENT_RECORD:W,INVALID_VALUES:xn,INVALID_WINNING_SIDE:Tt,MATCHUP_NOT_FOUND:Xe,METHOD_NOT_FOUND:Qn,MISSING_ASSIGNMENTS:ke,MISSING_ASYNC_STATE_PROVIDER:Sn,MISSING_AVOIDANCE_POLICY:it,MISSING_COLLECTION_DEFINITION:Ye,MISSING_COURT_ID:lt,MISSING_COURTS_INFO:un,MISSING_DATE_AVAILABILITY:Ut,MISSING_DATE:ft,MISSING_DRAW_DEFINITION:Y,MISSING_DRAW_ID:le,MISSING_DRAW_POSITION:se,MISSING_DRAW_POSITIONS:ie,MISSING_DRAW_SIZE:pe,MISSING_ENTRIES:Oe,MISSING_EVENT:Ae,MISSING_MATCHUP_FORMAT:ze,MISSING_MATCHUP_ID:Qe,MISSING_MATCHUP_IDS:Je,MISSING_MATCHUP:et,MISSING_MATCHUPS:Ze,MISSING_PARTICIPANT_COUNT:qt,MISSING_PARTICIPANT_ID:Lt,MISSING_PARTICIPANT_IDS:Gt,MISSING_PARTICIPANT_ROLE:kt,MISSING_PARTICIPANT:xt,MISSING_PARTICIPANTS:_t,MISSING_PENALTY_ID:sn,MISSING_PENALTY_TYPE:on,MISSING_PERSON_DETAILS:Ht,MISSING_POLICY_ATTRIBUTES:at,MISSING_POLICY_DEFINITION:rt,MISSING_POLICY_TYPE:nt,MISSING_POSITION_ASSIGNMENTS:Be,MISSING_ROUND_NUMBER:{message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},MISSING_SCHEDULE:Dn,MISSING_SCORING_POLICY:{message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},MISSING_SEED_ASSIGNMENTS:ye,MISSING_SEEDCOUNT_THRESHOLDS:Ie,MISSING_SEEDING_POLICY:{message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},MISSING_SET_NUMBER:{message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},MISSING_SET_OBJECT:pt,MISSING_SIDE_NUMBER:{message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},MISSING_STAGE:xe,MISSING_STRUCTURE_ID:Te,MISSING_STRUCTURE:be,MISSING_STRUCTURES:Re,MISSING_TARGET_LINK:we,MISSING_TIE_FORMAT:Ke,MISSING_TIME_ITEM:wn,MISSING_TIME_ITEMS:Pn,MISSING_TOURNAMENT_ID:H,MISSING_TOURNAMENT_RECORD:$,MISSING_TOURNAMENT_RECORDS:q,MISSING_VALUE:mt,MISSING_VENUE_ID:fn,MODIFICATIONS_FAILED:bn,NO_CANDIDATES:An,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:rn,NO_MODIFICATIONS_APPLIED:Nn,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:nn,NO_PARTICIPANT_REMOVED:jt,NO_VALID_ACTIONS:Bn,NO_VALID_ATTRIBUTES:Vn,NO_VALID_DATES:ht,NOT_FOUND:Gn,NOT_IMPLEMENTED:qn,PARTICIPANT_ALREADY_CHECKED_IN:Wt,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Kt,PARTICIPANT_ID_EXISTS:Vt,PARTICIPANT_NOT_CHECKED_IN:$t,PARTICIPANT_NOT_FOUND:Bt,PARTICIPANT_PAIR_EXISTS:{message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},PENALTY_NOT_FOUND:cn,POLICY_NOT_ATTACHED:ct,POLICY_NOT_FOUND:ut,SCHEDULE_NOT_CLEARED:te,SCHEDULED_MATCHUPS:Jn,SCORES_PRESENT:Xn,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:he,STAGE_SEQUENCE_LIMIT:Le,STRUCTURE_NOT_FOUND:De,TEAM_NOT_FOUND:Ln,UNABLE_TO_ASSIGN_COURT:Mn,UNLINKED_STRUCTURES:Ne,UNRECOGNIZED_DRAW_TYPE:re,UNRECOGNIZED_MATCHUP_FORMAT:Ge,UNRECOGNIZED_MATCHUP_STATUS:je,VALUE_UNCHANGED:jn,VENUE_EXISTS:ln},er={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,notices:[]};var tr={addNotice:function({topic:e,payload:t,key:n}){if("string"!=typeof e||"object"!=typeof t)return;er.disableNotifications||(er.modified=!0);if(er.disableNotifications||!er.subscriptions[e])return;n&&(er.notices=er.notices.filter((t=>!(t.topic===e&&t.key===n))));return er.notices.push({topic:e,payload:t,key:n}),{...L}},callListener:function({topic:e,notices:t}){const n=er.subscriptions[e];n&&"function"==typeof n&&n(t)},cycleMutationStatus:function(){const e=er.modified;return er.modified=!1,e},deleteNotice:function({topic:e,key:t}){er.notices=er.notices.filter((n=>(!e||n.topic===e)&&n.key!==t))},deleteNotices:function(){er.notices=[]},disableNotifications:function(){er.disableNotifications=!0},enableNotifications:function(){er.disableNotifications=!1},getNotices:function({topic:e}){const t=er.notices.filter((t=>t.topic===e)).map((e=>e.payload));return t.length&&t},getTopics:function(){return{topics:Object.keys(er.subscriptions)}},getTournamentId:nr,getTournamentRecord:function(e){return er.tournamentRecords[e]},getTournamentRecords:function(){return er.tournamentRecords},removeTournamentRecord:function(e){if("string"!=typeof e)return{error:xn};if(!er.tournamentRecords[e])return{error:Gn};delete er.tournamentRecords[e];const t=Object.keys(er.tournamentRecords);1===t.length?er.tournamentId=t[0]:t.length||(er.tournamentId=void 0);return{success:!0}},setSubscriptions:function(e){return"object"!=typeof e.subscriptions?{error:xn}:(Object.keys(e.subscriptions).forEach((t=>{er.subscriptions[t]=e.subscriptions[t]})),{...L})},setTournamentId:function(e){return er.tournamentRecords[e]?(er.tournamentId=e,{success:!0}):{error:$}},setTournamentRecord:function(e){const t=e?.tournamentId;return t?(er.tournamentRecords[t]=e,{success:!0}):{error:W}},setTournamentRecords:function(e){er.tournamentRecords=e;const t=Object.keys(e);1===t.length?er.tournamentId=t[0]:t.length||(er.tournamentId=void 0)},handleCaughtError:function({engineName:e,methodName:t,params:n,err:r}){let i;"string"==typeof r?i=r.toUpperCase():r instanceof Error&&(i=r.message);console.log("ERROR",{tournamentId:nr(),params:JSON.stringify(n),engine:e,methodName:t,error:i})}};function nr(){return er.tournamentId}const rr={tournamentFactoryVersion:"0.0.0",timers:{default:{elapsedTime:0}},iterators:{makeDeepCopy:0},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},deepCopy:!0};let ir=tr;function ar(e){return e&&"object"==typeof e?"object"==typeof rr.devContext&&(Object.keys(e).every((t=>rr.devContext?.[t]===e[t]))&&rr.devContext):rr.devContext??!1}function or(e){rr.devContext=e}function sr(){ir.enableNotifications()}function cr(e,t){"boolean"==typeof e&&(rr.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(rr.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(rr.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(rr.deepCopyAttributes.stringify=t.stringify),t.threshold&&(rr.deepCopyAttributes.threshold=t.threshold))}function ur(){return{enabled:rr.deepCopy,...rr.deepCopyAttributes}}function dr(){return ir.cycleMutationStatus()}function pr(e){return ir.addNotice(e)}function lr(e){return ir.getNotices(e)}function mr({key:e,topic:t}){return ir.deleteNotice({key:e,topic:t})}function fr(){return ir.deleteNotices()}function hr(){return ir.getTopics()}async function Ir(e){return ir.callListener(e)}function gr(){return ir.getTournamentId()}function Ur(e){return ir.getTournamentRecord(e)}function yr(){return ir.getTournamentRecords()}function vr(e){return ir.setTournamentRecord(e)}function Sr(e){return ir.setTournamentRecords(e)}function wr(e){return ir.setTournamentId(e)}function Pr(e){return ir.removeTournamentRecord(e)}function Tr(){return ir}function Dr({engineName:e,methodName:t,params:n,err:r}){return("function"==typeof ir.handleCaughtError&&ir.handleCaughtError||tr.handleCaughtError)({engineName:e,methodName:t,params:n,err:r})}const Rr=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,br=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Nr=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Mr=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function Ar(e){let{scheduledDate:t}=e;if(!t&&e.scheduledTime&&(t=Wr(e.scheduledTime)),!t)return;const n=$r(e.scheduledTime);let r=Wr(t);return r&&n&&(r+=`T${n}`),r}function Er(e){if("object"!=typeof e||Array.isArray(e))return!1;return"[object Date]"===Object.prototype.toString.call(e)}function Cr(e){const t="string"==typeof e?e?.split(" "):[];return!(e&&t?.length>1&&!["AM","PM"].includes(t[1].toUpperCase()))&&!(e&&!Mr.test(Yr(e,!0,!0)))}function Or(e){return Vr(e)||Rr.test(e)}const Fr=e=>{const t=_r(e)||Vr(e)?new Date(e):new Date,n=t.getUTCMonth()+1,r=n<10?`0${n}`:`${n}`;return`${t.getUTCFullYear()}-${ti(r)}-${ti(t.getUTCDate())}`};function kr(e,t="-",n="YMD"){if(!e)return"";"string"==typeof e&&e.indexOf("T")<0&&(e+="T00:00");const r=new Date(e);let i=""+(r.getMonth()+1),a=""+r.getDate();const o=r.getFullYear();return i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),"DMY"===n?[a,i,o].join(t):"MDY"===n?[i,a,o].join(t):"YDM"===n?[o,a,i].join(t):"DYM"===n?[a,o,i].join(t):"MYD"===n?[i,o,a].join(t):[o,i,a].join(t)}function xr(e){const t=e?new Date(e):new Date,n=t.getTimezoneOffset();return new Date(t.getTime()-60*n*1e3)}function _r(e){if("boolean"==typeof e)return!1;const t=e instanceof Date&&e||!isNaN(e)&&new Date(e)||!1;return t&&!isNaN(t.valueOf())}function Lr(e,t){if(!Or(e)||!Or(t))return[];const n=Wr(e)+"T00:00",r=Wr(t)+"T00:00",i=new Date(n),a=new Date(r);const o=[];let s=0;if(_r(a)&&_r(i)&&i<=a){const e=i;let t=e.getTime();for(;t<=a.getTime()&&s<300;)s+=1,o.push(new Date(e)),t=e.setDate(e.getDate()+1)}return o.map((e=>kr(e)))}const Br=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Vr(e){return"string"==typeof e&&Br.test(e)}function jr(e){if("string"!=typeof e)return!1;const t=e.split("Z")[0].split(":"),n=t.every((e=>!isNaN(parseInt(e))));return!(t.length<2||!n||parseInt(t[0])>23||parseInt(t[1])>60)}function Gr(e){const t=$r(e);if(!t)return 0;const[n,r]=t.split(":").map((e=>parseInt(e)));return 60*n+r}function qr(e){return jr(e)?e.split(":").slice(0,2).map(ti).join(":"):void 0}function $r(e){return Vr(e)&&e.indexOf("T")>0?qr(e.split("T").reverse()[0]):qr(e)}function Wr(e){return Vr(e)||Nr.test(e)?e.split("T")[0]:void 0}function Hr(e,t){const n=new Date(e);return n.setDate(n.getDate()+t),Wr(n.toISOString())}function zr(e){e="string"!=typeof e?"00:00":e;const t={},n={};return({0:t.time,1:t.ampm}=e.split(" ")||[]),({0:n.hours,1:n.minutes}=t.time.split(":")||[]),n.ampm=t.ampm,isNaN(n.hours)||isNaN(n.minutes)||n.ampm&&!["AM","PM"].includes(n.ampm.toUpperCase())?{}:n}function Yr(e,t,n){const r=Wr(e),i=$r(e),a=r?i:e;return e?t&&(r&&n&&e||function(e){const t=zr(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&parseInt(t.hours)<12&&(t.hours=(t.hours&&parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),`${t.hours||"12"}:${t.minutes||"00"}`.split(":").map(ti).join(":")}(a))||function(e){const t=zr(e);if("object"!=typeof t||Object.keys(t).length)return t.ampm?e:(t.hours>12?(t.hours-=12,t.ampm="PM"):"12"===t.hours?t.ampm="PM":"00"===t.hours?(t.hours="12",t.ampm="AM"):t.ampm="AM","0"===t.hours?.[0]&&(t.hours=t.hours.slice(1)),`${t.hours||"12"}:${t.minutes||"00"} ${t.ampm}`)}(a):void 0}function Kr(e,t){const n=zr(e),r=zr(t);if(parseInt(n.hours)<parseInt(r.hours))return-1;if(parseInt(n.hours)>parseInt(r.hours))return 1;if(n.hours===r.hours){if(parseInt(n.minutes)<parseInt(r.minutes))return-1;if(parseInt(n.minutes)>parseInt(r.minutes))return 1}return 0}function Qr(e,t=7){const n=Wr(e)+"T00:00",r=new Date(n);return kr(new Date(r.setDate(r.getDate()+t)))}function Jr(e,t=void 0){const[n,r]=(e||"00:00").split(":").map(ti),i=xr(t).setHours(n,r,0,0);return xr(i)}function Xr(e,t,n=!0){const r=new Date(e),i=(new Date(t).getTime()-r.getTime())/1e3/60;return n?Math.abs(Math.round(i)):Math.round(i)}function Zr(e,t){const n=$r(e);if(!n)return"00:00";const r=isNaN(t)?0:t;return $r(ei(Jr(n),r).toISOString())}function ei(e,t){const n=new Date(e);return new Date(n.getTime()+6e4*t)}function ti(e){return e.toString()[1]?e:"0"+e}function ni(e,t){const n=new Date(e),r=new Date(t);return n.getFullYear()===r.getFullYear()&&n.getMonth()===r.getMonth()&&n.getDate()===r.getDate()}const ri={addDays:Qr,addWeek:function(e){return Qr(e)},addMinutesToTimeString:Zr,convertTime:Yr,getIsoDateString:Ar,getUTCdateString:Fr,DateHHMM:function(e){const t=new Date(e);return function(e,t){const n=parseInt(e,10),r=Math.floor(n/3600),i=Math.floor((n-3600*r)/60),a=n-3600*r-60*i;return(!t||t?.displaySeconds?r+":"+i+":"+a:r+":"+i).split(":").map(ti).join(":")}(t.getSeconds()+60*t.getMinutes()+3600*t.getHours(),{displaySeconds:!1})},extractDate:Wr,extractTime:$r,formatDate:kr,getDateByWeek:function(e,t,n,r=!1){const i=new Date(t,0,1+7*(e-1)),a=r?0:1;return i.setDate(i.getDate()+(a-i.getDay())),kr(i,n)},isISODateString:Vr,isDate:_r,isTimeString:jr,offsetDate:xr,offsetTime:function(e){return xr(e).getTime()},sameDay:ni,timeStringMinutes:Gr,timeToDate:Jr,timeUTC:function(e){const t=_r(e)||Vr(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},validTimeValue:Cr,validDateString:Rr,timeValidation:Mr,dateValidation:Nr};function ii(e,t,n,r,i=0){if(Tr().makeDeepCopy)return Tr().makeDeepCopy(e,t,n,r);const a=ur(),{stringify:o,toJSON:s,ignore:c,modulate:u}=a||{};if(!a?.enabled&&!n||"object"!=typeof e||"function"==typeof e||null===e||"number"==typeof a?.threshold&&i>=a.threshold)return e;const d=ar({makeDeepCopy:!0});var p;d&&(p=i,rr.iterators.makeDeepCopy=p,"object"==typeof d&&(i>(d.iterationThreshold||15)||d.firstIteration&&0===i)&&d.log&&(!d.notInternalUse||d.notInternalUse&&!n)&&console.log({devContext:d,iteration:i,internalUse:n},e));const l=Array.isArray(e)?[]:{},m=Object.keys(e).filter((e=>!n||!c||Array.isArray(c)&&!c.includes(e)||"function"==typeof c&&!c(e))),f=(e,t)=>{l[e]="function"==typeof t?.toString?t.toString():JSON.stringify(t)};for(const h of m){const a=e[h],c="function"==typeof u?u(a):void 0;if(void 0!==c)l[h]=c;else if(t&&"extensions"===h&&Array.isArray(a)){const e=ai(a);Object.assign(l,...e)}else r&&"extensions"===h?l[h]=[]:Array.isArray(o)&&o.includes(h)?f(h,a):Array.isArray(s)&&s.includes(h)&&"function"==typeof a?.toJSON?l[h]=a.toJSON():null===a?l[h]=void 0:Er(a)?l[h]=new Date(a).toISOString():l[h]=ii(a,t,n,r,i+1)}return l}function ai(e){return e?.map((e=>{const{name:t,value:n}=e;return t&&n&&{[`_${t}`]:n}})).filter(Boolean)}function oi({element:e,accessor:t}){if("string"!=typeof t)return{values:[]};const n=ii(e),r=t.split("."),i=[];let a;!function e({targetElement:t,attributes:n=[],significantCharacters:r}){for(const[s,c]of n.entries())if(t?.[c]){const r=n.slice(s+1);if(r.length)if(Array.isArray(t[c])){t[c].forEach((t=>e({targetElement:t,attributes:r})))}else o({targetElement:t=t[c],index:s});else a||(a=t[c]),i.includes(t[c])||i.push(t[c])}function o({targetElement:e,index:t}){if(e&&t===n.length-1&&["string","number"].includes(typeof e)){const t=r?e.slice(0,r):e;a?i.includes(t)||i.push(t):(a=t,i.push(t))}}}({targetElement:n,attributes:r});const o={value:a};return i.length&&(o.values=i),o}function si(e){return"string"==typeof e}function ci(e){return"object"==typeof e}function ui(e,t){return Array.isArray(e)?Object.assign({},...(e??[]).filter(ci).map((e=>e[t]&&{[e[t]]:e})).filter(Boolean)):{}}const di=e=>t=>e&&"object"==typeof t?Array.isArray(e)&&e.map((e=>({[e]:oi({element:t,accessor:e})?.value})))||"object"==typeof e&&Object.keys(e).map((e=>({[e]:oi({element:t,accessor:e})?.value})))||("string"==typeof e&&oi({element:t,accessor:e}))?.value:void 0;function pi(e,t,n,r){if("object"!=typeof e||null===e)return e;const i=ur();i?.enabled||(r=!0);const a=["",void 0,null];t&&a.push(!1);const o=Object.keys(e).filter((t=>!a.includes(e[t])&&(!n||!Array.isArray(e[t])||e[t].length)));return Object.assign({},...o.map((t=>Array.isArray(e[t])?{[t]:r?e[t]:e[t].map((e=>pi(e)))}:{[t]:r?e[t]:pi(e[t])})))}function li(e){return Array.isArray(e)?e.length+e.map(li).reduce(((e,t)=>e+t),0):"object"==typeof e&&null!==e?Object.keys(e).length+Object.keys(e).map((t=>li(e[t]))).reduce(((e,t)=>e+t),0):0}function mi(e){if(null===e)return{};const{source:t,template:n}=e||{};if(!n)return t;const r={};return function e(t,n,r){if(!t||!n)return;const i=Object.keys(t),a=Object.keys(n),o=Object.assign({},...a.filter((e=>e.indexOf("||"))).map((e=>e.split("||").map((t=>({[t]:e}))))).flat()),s=a.concat(...Object.keys(o)),c=s.includes("*");for(const u of i)if(s.indexOf(u)>=0||c){const i=n[o[u]||u]||c,a=t[u];if("object"!=typeof i||"function"==typeof a||Array.isArray(i)){const e=t[u];if(Array.isArray(i)&&!i.includes(e))return!1;(n[u]||c&&!1!==n[u])&&(r[u]=e)}else if(Array.isArray(a)){const t=a.map((t=>{const n={};return!1!==e(t,i,n)?n:void 0})).filter(Boolean);r[u]=t}else a&&(r[u]={},e(a,i,r[u]))}return}(t,n,r),r}function fi(e=0){const t=new Date;return t.setHours(t.getHours()+e),t.getTime().toString(36).slice(-6).toUpperCase()}function hi(e,t=".",n=[]){return"object"==typeof e&&Object.keys(e).reduce(((r,i)=>"object"!=typeof e[i]?(r[n.concat(i).join(t)]=e[i],r):Object.assign(r,hi(e[i],t,n.concat(i)))),{})}function Ii(){const e=[];for(let a=0;a<256;a++)e[a]=(a<16?"0":"")+a.toString(16);const t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255]}function gi(e){if("string"==typeof e){const t=e.startsWith("T")&&r||e.startsWith(a)&&a||"";if(t===r){const t=Si(e);if(t)return{simplified:!0,setFormat:t,bestOf:1}}if(t===a)return function(e){const t=e.split("-"),n=Pi(t[0].slice(3)),r=1===n||n%2!=0?n:void 0,i=1!==n&&n%2==0?n:void 0,a=t&&Ui(t[1]),o=t&&Ui(t[2]),s=a&&a.timed||o&&o.timed,c=r&&r<6||s&&i,u=!t[2]||o,d=a,p=pi({setFormat:a,exactly:i,bestOf:r});o&&(p.finalSetFormat=o);if(c&&d&&u)return p}(e)}}function Ui(e){if(":"===e?.[1]){const t=e.split(":"),n=o[t[0]],r=t[1];if(n&&r){if(0===r.indexOf("TB")){const e=vi(r);return!1!==e&&("object"==typeof e?{tiebreakSet:e}:void 0)}if(0===r.indexOf("T"))return Si(r);const t=e.match(/^[FS]:(\d+)([A-Za-z]*)/),n=t&&wi(t[2])||!1,i=!t?.[2]||n,a=t?Pi(t[1]):void 0,o=yi(r),s=!1!==o,c=s&&o||a,u=vi(r.split("/")[1]),d=!1!==u,p={setTo:a};return n&&(p.NoAD=!0),u?(p.tiebreakFormat=u,p.tiebreakAt=c):p.noTiebreak=!0,a&&i&&d&&s&&p||!1}}}function yi(e,t=!0){const n=e?.indexOf("@")>0&&e.split("@");if(n){return(t?Pi(n[1]):n[1])||!1}}function vi(e){if(e){if(e.startsWith("TB")){const t=yi(e,!1),n=e.match(/^TB(\d+)([A-Za-z]*)/),r=n?.[1],i=n&&wi(n[2]),a=!n?.[2]||i,o=Pi(r);if(o&&a){const e={tiebreakTo:o};return t&&"string"==typeof t&&!S(t)&&(e.modifier=t),i&&(e.NoAD=!0),e}return!1}return!1}}function Si(e){const t=e.slice(1),n=t.match(/^(\d+)(@?[A-Za-z]*)/),r=Pi(n?.[1]);if(!r)return;const i={timed:!0,minutes:r},a=n?.[2],o=[void 0,"P","G"].includes(a);if(a&&!o){const e=t.match(/^(\d+)(@)([A-Za-z]+)$/)?.[3];return e?(i.modifier=e,i):void 0}return a&&(i.based=n[2]),i}function wi(e){return e&&e.indexOf(i)>=0}function Pi(e){return isNaN(Number(e))?0:Number(e)}function Ti(e){if("string"!=typeof e)return!1;const t=gi(e),n=e.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=n?.[1],i=n?.[2],a=n?.[3],o=e.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),c=o?.[1],u=o?.[2],d=o?.[3];return s(t,!!(n&&i&&r===a||o&&u&&c===d))===e}const Di={isValidMatchUpFormat:Ti,stringify:s,isValid:Ti,parse:gi};function Ri(e){if(!e)return;const{tieFormatId:t,tieFormats:n}=e;return e.tieFormat?e.tieFormat:t&&Array.isArray(n)?n.find((e=>e.tieFormatId===t)):void 0}function bi({item:e,drawDefinition:t,structure:n,event:r}){if(e){if(e.tieFormat)return e.tieFormat;if(e.tieFormatId){if(t.tieFormat)return t.tieFormat;const n=t.tieFormats?.find((t=>e.tieFormatId===t.tieFormatId));return n||(r.tieFormat?r.tieFormat:r.tieFormats?.find((t=>e.tieFormatId===t.tieFormatId)))}if(n.tieFormat)return n.tieFormat;if(n.tieFormatId){const e=t.tieFormats?.find((e=>n.tieFormatId===e.tieFormatId));if(e)return e}}}function Ni({drawDefinition:e,structure:t,matchUp:n,event:r}){return{tieFormat:bi({item:n,drawDefinition:e,structure:t,event:r})||bi({item:t,drawDefinition:e,structure:t,event:r})||Ri(e)||Ri(r)}}function Mi({context:e,result:t,stack:n,info:r}){return t&&!Array.isArray(t?.stack)&&(t.stack=[]),t&&Array.isArray(t?.stack)&&"string"==typeof n&&t.stack.push(n),t&&r&&(t.info=r),t&&"object"==typeof e&&Object.keys(e).length&&Object.assign(t,pi(e)),!t||t?.error||t?.success||Object.assign(t,{...L}),t??{success:!0}}const Ai="ANY",Ei="MALE",Ci="MIXED",Oi="OTHER",Fi="FEMALE",ki={ANY:Ai,MALE:Ei,FEMALE:Fi,MIXED:Ci,OTHER:Oi},xi="SINGLES",_i="SINGLES",Li="DOUBLES",Bi="DOUBLES",Vi="TEAM",ji="TEAM",Gi={SINGLES_MATCHUP:xi,SINGLES:_i,DOUBLES_MATCHUP:Li,DOUBLES:Bi,TEAM_MATCHUP:Vi,TEAM:ji};var qi=(e=>(e.AdHoc="AD_HOC",e.Compass="COMPASS",e.CurtisConsolation="CURTIS_CONSOLATION",e.DoubleElimination="DOUBLE_ELIMINATION",e.FeedIn="FEED_IN",e.FeedInChampionship="FEED_IN_CHAMPIONSHIP",e.FeedInChampionshipToQf="FEED_IN_CHAMPIONSHIP_TO_QF",e.FeedInChampionshipToR16="FEED_IN_CHAMPIONSHIP_TO_R16",e.FeedInChampionshipToSf="FEED_IN_CHAMPIONSHIP_TO_SF",e.FirstMatchLoserConsolation="FIRST_MATCH_LOSER_CONSOLATION",e.FirstRoundLoserConsolation="FIRST_ROUND_LOSER_CONSOLATION",e.ModifiedFeedInChampionship="MODIFIED_FEED_IN_CHAMPIONSHIP",e.Lucky="LUCKY_DRAW",e.Olympic="OLYMPIC",e.Other="OTHER",e.Playoff="PLAYOFF",e.RoundRobin="ROUND_ROBIN",e.RoundRobinWithPlayoff="ROUND_ROBIN_WITH_PLAYOFF",e.SingleElimination="SINGLE_ELIMINATION",e))(qi||{}),$i=(e=>(e.Consolation="CONSOLATION",e.Main="MAIN",e.PlayOff="PLAY_OFF",e.Qualifying="QUALIFYING",e.VoluntaryConsolation="VOLUNTARY_CONSOLATION",e))($i||{}),Wi=(e=>(e.Alternate="ALTERNATE",e.Confirmed="CONFIRMED",e.DirectAcceptance="DIRECT_ACCEPTANCE",e.FeedIn="FEED_IN",e.JuniorExempt="JUNIOR_EXEMPT",e.LuckyLoser="LUCKY_LOSER",e.OrganiserAcceptance="ORGANISER_ACCEPTANCE",e.Qualifier="QUALIFIER",e.SpecialExempt="SPECIAL_EXEMPT",e.Registered="Registered",e.Ungrouped="UNGROUPED",e.Unpaired="UNPAIRED",e.Wildcard="WILDCARD",e.Withdrawn="WITHDRAWN",e))(Wi||{}),Hi=(e=>(e.Loser="LOSER",e.Position="POSITION",e.Winner="WINNER",e))(Hi||{}),zi=(e=>(e.BottomUp="BOTTOM_UP",e.Draw="DRAW",e.LossPosition="LOSS_POSITION",e.Random="RANDOM",e.TopDown="TOP_DOWN",e.Waterfall="WATERFALL",e))(zi||{}),Yi=(e=>(e.Doubles="DOUBLES",e.Singles="SINGLES",e.Team="TEAM",e))(Yi||{}),Ki=(e=>(e.Abandoned="ABANDONED",e.AwaitingResult="AWAITING_RESULT",e.Bye="BYE",e.Cancelled="CANCELLED",e.Completed="COMPLETED",e.DeadRubber="DEAD_RUBBER",e.Defaulted="DEFAULTED",e.DoubleDefault="DOUBLE_DEFAULT",e.DoubleWalkover="DOUBLE_WALKOVER",e.InProgress="IN_PROGRESS",e.Incomplete="INCOMPLETE",e.NotPlayed="NOT_PLAYED",e.Retired="RETIRED",e.Suspended="SUSPENDED",e.ToBePlayed="TO_BE_PLAYED",e.Walkover="WALKOVER",e))(Ki||{}),Qi=(e=>(e.Any="ANY",e.Female="FEMALE",e.Male="MALE",e.Mixed="MIXED",e))(Qi||{}),Ji=(e=>(e.Administration="ADMINISTRATION",e.Captain="CAPTAIN",e.Coach="COACH",e.Competitor="COMPETITOR",e.Media="MEDIA",e.Medical="MEDICAL",e.Official="OFFICIAL",e.Other="OTHER",e.Security="SECURITY",e))(Ji||{}),Xi=(e=>(e.Group="GROUP",e.Individual="INDIVIDUAL",e.Pair="PAIR",e.Team="TEAM",e))(Xi||{});const Zi="MIXED events can not contain mixed singles or { gender: ANY } collections",ea="events with { gender: ANY } can not contain MIXED singles collections";function ta(e){const t="tieFormatGenderValidityCheck",{referenceGender:n,matchUpType:r,gender:i}=e;if(n&&i&&[Qi.Male,Qi.Female].includes(n)&&n!==i)return Mi({result:{valid:!1,error:Fn},context:{gender:i},stack:t});const a=e.eventType??e.referenceEvent?.eventType;return n===Ci&&(a!==ji||i===Ai||i===Ci&&r!==Yi.Doubles)?Mi({result:{error:Fn,valid:!1},info:Zi,stack:t}):n===Ai&&i===Ci&&r!==Yi.Doubles?Mi({result:{error:Fn,valid:!1},info:ea,stack:t}):{valid:!0}}const na=(e,t)=>e.filter(Boolean).every((e=>typeof e===t)),ra=e=>e.filter(Boolean).every(U);function ia(e){const t=e.category;if("object"!=typeof t)return{error:kn};let{ageCategoryCode:n,ageMaxDate:r,ageMinDate:i,ageMax:a,ageMin:o}=t;const s=t.categoryName;let c;if(!na([n,r,i,s],"string")||!ra([a,o]))return{error:kn};const u=e.consideredDate??Wr((new Date).toLocaleDateString("sv"));if(!Or(u))return{error:yt};const[d]=u.split("-").slice(0,3).map((e=>parseInt(e))),p=Hr(u,-1),[l,m]=p.split("-").slice(1,3).map((e=>parseInt(e))),f=`${ti(l)}-${ti(m)}`,h=Hr(u,1),[I,g]=h.split("-").slice(1,3).map((e=>parseInt(e))),U=`${ti(I)}-${ti(g)}`;let y=o&&Hr(u,-365*o),v=a&&Hr(u,-365*a);const S=[],w=e=>!S.includes(e)&&S.push(e);n=n??s;const P=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=n?.includes("-"),R=D&&n?.match(T),b=n?.match(P),N=(e,t)=>`${e}-${t}`,M=e=>{const r=N(d-e-1,U);t.ageMin&&t.ageMin>e&&w(`Invalid submitted ageMin: ${o}`),t.ageMax&&t.ageMax>e&&w(`Invalid submitted ageMax: ${a}`),t.ageMinDate&&t.ageMinDate!==r&&w(`Invalid submitted ageMinDate: ${i}`),i=r,n&&(t.ageMax&&t.ageMax!==e&&(w(`Invalid submitted ageMax: ${a}`),y=void 0),a=e)},A=e=>{const i=N(d-e,f);t.ageMaxDate&&t.ageMaxDate!==i&&w(`Invalid submitted ageMaxDate: ${r}`),r=i,n&&(t.ageMin&&t.ageMin!==e+1&&(w(`Invalid submitted ageMin: ${o}`),y=void 0),o=e+1)},E=e=>{const[s,c,u]=(e.match(P)||[]).slice(1),p=parseInt(c);"U"===s?(t.ageMaxDate&&t.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),(e=>{const r=N(d-e,U);t.ageMinDate&&t.ageMinDate!==r&&w(`Invalid submitted ageMinDate: ${i}`),i=r,n&&(t.ageMax&&t.ageMax!==e-1&&(w(`Invalid submitted ageMax: ${a}`),v=void 0),a=e-1)})(p)):"O"===s&&A(p),"U"===u?(t.ageMaxDate&&t.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),M(p)):"O"===u&&(e=>{const i=N(d-e-1,f);t.ageMaxDate&&t.ageMaxDate!==i&&w(`Invalid submitted ageMaxDate: ${r}`),r=i,n&&(t.ageMin&&t.ageMin!==e&&(w(`Invalid submitted ageMin: ${o}`),y=void 0),o=e)})(p),r=r??y,i=i??v};if(R){if(r=void 0,i=void 0,a=void 0,o=void 0,t.ageMin){const e=d-t.ageMin;r=N(e,f)}if(t.ageMax){const e=d-t.ageMax-1;i=N(e,U)}const[e,s]=(n?.match(T)??[]).slice(1).map((e=>parseInt(e)));e<=s?(o=e,a=s,c=!0):w(`Invalid combined age range ${n}`)}else D?n?.split("-").forEach(E):b?E(n):(o&&A(o),a&&M(a));a&&t.ageMin&&t.ageMin>a&&(w(`Invalid submitted ageMin: ${t.ageMin}`),o=void 0);const C=pi({consideredDate:u,combinedAge:c,ageMaxDate:r,ageMinDate:i,ageMax:a,ageMin:o});return S.length&&(C.errors=S),C}function aa({category:e}){if(!ci(e))return{error:xn};const t=ia({category:e});if(t.error)return{error:t};const{ratingMax:n,ratingMin:r}=e;return n&&!U(n)?Mi({result:{error:xn},context:{ratingMax:n}}):r&&!U(r)?Mi({result:{error:xn},context:{ratingMin:r}}):{...t}}function oa({childCategory:e,withDetails:t,category:n}){const r=aa({category:n}),i=aa({category:e}),a=i.ageMin&&(r.ageMin&&i.ageMin<r.ageMin||r.ageMax&&i.ageMin>r.ageMax),o=i.ageMax&&(r.ageMax&&i.ageMax>r.ageMax||r.ageMin&&i.ageMax<r.ageMin),s=i.ageMinDate&&r.ageMaxDate&&new Date(i.ageMinDate)>new Date(r.ageMaxDate),c=i.ageMaxDate&&r.ageMinDate&&new Date(i.ageMaxDate)<new Date(r.ageMinDate),u=n.ratingType&&e.ratingType&&n.ratingType===e.ratingType&&(n.ratingMin&&e.ratingMin&&e.ratingMin<n.ratingMin||n.ratingMax&&e.ratingMax&&e.ratingMax>n.ratingMax||n.ratingMin&&e.ratingMax&&e.ratingMax<n.ratingMin||n.ratingMax&&e.ratingMin&&e.ratingMin>n.ratingMax),d=n.ballType&&e.ballType&&n.ballType!==e.ballType,p=pi({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:c,invalidBallType:d,invalidAgeMax:o,invalidAgeMin:a,valid:!(u||s||c||d||o||a)},!0);return t&&Object.assign(p,{categoryDetails:r,childCategoryDetails:i}),p}function sa(e){return`${e} must be an array`}function ca(e){const t=!(!1===e?.enforceCategory||!e?.category),n=!(!1===e?.enforceGender||!e?.gender),r=e?.checkCollectionIds,i=e?.tieFormat,a=e?.event,o="validateTieFormat",s=[];if(!e||!i||"object"!=typeof i)return s.push("tieFormat must be an object"),Mi({result:{error:We},context:{tieFormat:i,errors:s},stack:o});if("object"!=typeof i.winCriteria)return s.push("tieFormat.winCriteria must be an object"),Mi({result:{error:We},context:{tieFormat:i,errors:s},stack:o});if(!Array.isArray(i.collectionDefinitions))return s.push(sa("tieFormat.collectionDefinitions")),Mi({result:{error:We},context:{tieFormat:i,errors:s},stack:o});let c;const u=i.collectionDefinitions.every((i=>{const{setValue:o,scoreValue:u,collectionValue:d}=i;!o&&!u||d||(c=!0);const{valid:p,errors:l}=ua({referenceCategory:e.category,referenceGender:e.gender,eventType:e.eventType,collectionDefinition:i,checkCollectionIds:r,checkCategory:t,checkGender:n,event:a});return!!p||(Array.isArray(l)&&s.push(...l),!1)})),d="number"==typeof i.winCriteria?.valueGoal&&i.winCriteria?.valueGoal>0&&!c||i.winCriteria?.aggregateValue;if(!d&&!i.winCriteria?.aggregateValue)return c?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),Mi({context:{tieFormat:i,errors:s,aggregateValueImperative:c},result:{error:We},stack:o});const p=i.collectionDefinitions.map((({collectionId:e})=>e)),l=!r||p.length===P(p).length,m=u&&d&&l;return m?{valid:m,errors:s}:Mi({result:{error:We},context:{tieFormat:i,errors:s},stack:o})}function ua({checkCategory:e=!0,collectionDefinition:t,checkCollectionIds:n,checkGender:r=!0,referenceCategory:i,referenceGender:a,eventType:o,event:s}){a=a??s?.gender;const c="validateCollectionDefinition",u=[];if("object"!=typeof t)return u.push(`collectionDefinition must be an object: ${t}`),Mi({result:{errors:u,error:On},stack:c});const{collectionValueProfiles:d,collectionGroupNumber:p,collectionValue:l,collectionId:m,matchUpCount:f,matchUpFormat:h,matchUpValue:I,matchUpType:g,scoreValue:U,setValue:y,category:v,gender:w}=t;n&&"string"!=typeof m&&u.push(`collectionId is not type string: ${m}`),"number"!=typeof f&&u.push(`matchUpCount is not type number: ${f}`),g&&![Yi.Singles,Yi.Doubles].includes(g)&&u.push(`matchUpType must be SINGLES or DOUBLES: ${g}`);if(1!==[!!d?.length].concat([I,l,U,y].map(S)).filter(Boolean).length&&u.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),I&&"number"!=typeof I&&u.push(`matchUpValue is not type number: ${I}`),l&&"number"!=typeof l&&u.push(`collectionValue is not type number: ${l}`),d){const e=da({collectionValueProfiles:d,matchUpCount:f});e.errors&&u.push(...e.errors)}if(p&&"number"!=typeof p&&u.push(`collectionGroupNumber is not type number: ${l}`),h&&!Di.isValid(h)&&u.push(`Invalid matchUpFormat: ${h}`),r){const e=ta({eventType:o??s?.eventType,referenceGender:a,matchUpType:g,gender:w});if(e.error)return Mi({context:{referenceGender:a,gender:w},result:e,stack:c})}if(e&&i&&v){const e=oa({category:i,childCategory:v});if(!e.valid)return Mi({result:{error:kn},context:e,stack:c})}return u.length?Mi({result:{errors:u,error:Cn},stack:c}):{valid:!0}}function da({collectionValueProfiles:e,matchUpCount:t}){const n=[];if(!Array.isArray(e))return n.push(`collectionValueProfiles is not an array: ${e}`),{errors:n};if(e.length&&e.length!==t)return n.push("collectionValueProfiles do not align with matchUpsCount"),{errors:n};for(const i of e){if("object"!=typeof i)return n.push(`valueProfile is not type object: ${i}`),{errors:n};const{value:e,collectionPosition:r}=i;if("number"!=typeof e||"number"!=typeof r||r>t||r<1)return n.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:n}}const r=e.map((e=>e.collectionPosition));return r.length!==P(r).length?(n.push("collectionPositions are not unique"),{errors:n}):{...L}}const pa="ABANDONED",la="AWAITING_RESULT",ma="BYE",fa="CANCELLED",ha="COMPLETED",Ia="DEAD_RUBBER",ga="DEFAULTED",Ua="DOUBLE_DEFAULT",ya="DOUBLE_WALKOVER",va="IN_PROGRESS",Sa="INCOMPLETE",wa="NOT_PLAYED",Pa="RETIRED",Ta="SUSPENDED",Da="TO_BE_PLAYED",Ra="WALKOVER",ba=[la,ha,ga,va,Sa,Pa,Ta],Na=[la,ha,ga,ya,Ua,va,Sa,Pa,Ta,Ra],Ma=[pa,la,ma,fa,ha,Ia,ga,ya,Ua,va,Sa,wa,Pa,Ta,Da,Ra],Aa=[ma,ya,Ua,ha,ga,Pa,Ra],Ea=[pa,la,fa,Ia,va,Sa,wa,Ta,Da,void 0],Ca=[Ki.Cancelled,Ki.Abandoned,Ki.Completed,Ki.DeadRubber,Ki.Defaulted,Ki.DoubleWalkover,Ki.DoubleDefault,Ki.Retired,Ki.Walkover],Oa=[pa,ha,ga,ya,Ua,va,Pa,Ra],Fa=[va,Sa,Ta,Da],ka={ABANDONED:pa,AWAITING_RESULT:la,BYE:ma,CANCELLED:fa,COMPLETED:ha,DEAD_RUBBER:Ia,DEFAULTED:ga,DOUBLE_WALKOVER:ya,DOUBLE_DEFAULT:Ua,IN_PROGRESS:va,INCOMPLETE:Sa,NOT_PLAYED:wa,RETIRED:Pa,SUSPENDED:Ta,TO_BE_PLAYED:Da,WALKOVER:Ra};function xa({matchUp:e}){return Ca.includes(e?.matchUpStatus)||e?.winningSide}function _a(e){if(!ci(e))return!1;const{matchUpId:t,drawPositions:n}=e,r="string"==typeof t,i=!n||Array.isArray(n)&&n.length<=2&&n.every((e=>S(e)||null==e));return r&&i}function La(e){return!!Array.isArray(e)&&e.every(_a)}const Ba="SET3-S:6/TB7",Va="SET3-S:6/TB7-F:TB10";function ja({winningSide:e,matchUpFormat:t=Ba,matchUpStatus:n,tallyPolicy:r,score:i}){const a=[0,0],o=i?.sets,s="number"==typeof e&&e-1,c=gi(t),u=$a(c?.bestOf??1);if("number"==typeof s&&(n===ga&&r?.setsCreditForDefaults||n===Ra&&r?.setsCreditForWalkovers))a[s]=u;else for(const d of o||[]){const{winningSide:e}=d;e&&(a[e-1]+=1)}return"number"==typeof s&&n===Pa&&(+a[1-s]===u&&(a[1-s]-=1),r?.setsCreditForRetirements&&(a[s]=u)),a}function Ga({matchUpFormat:e=Ba,winningSide:t,matchUpStatus:n,tallyPolicy:r,score:i}){const{sets:a}=i||{};if(!a)return[0,0];const o="number"==typeof t&&t-1,s=gi(e),c=$a(s?.bestOf??1),u=s?.setFormat?.tiebreakAt||0,d=[[],[]];if("number"==typeof o&&(n===ga&&r?.gamesCreditForDefaults||n===Ra&&r?.gamesCreditForWalkovers)){const e=c*(s?.setFormat?.setTo||0);d[o].push(e)}else a.forEach(((e,t)=>{const n=(e.setNumber||t+1)>c&&s?.finalSetFormat?"finalSetFormat":"setFormat",i=s?.[n]?.based,a=s?.[n].tiebreakSet,{side1Score:o,side2Score:u}=e;Ha(i)&&(d[0].push(m(o||0)),d[1].push(m(u||0))),a&&e.winningSide&&!1!==r?.gamesCreditForTiebreakSets&&d[e.winningSide-1].push(1)}));if(n===Pa&&"number"==typeof o){const i=a.length>c&&s?.finalSetFormat?"finalSetFormat":"setFormat",p=s?.[i];if(Ha(p.based)){const i=p?.setTo||0,l=e=>{if(s&&""!==e)return+e==u-1||+e===u?m(u||0)+1:+e<u?i:u},f=ja({winningSide:t,score:{sets:a},matchUpStatus:n,matchUpFormat:e,tallyPolicy:r});if(d.map((e=>e[o]<=e[1-o])).reduce(((e,t)=>e+(t?1:0)),0)>f[1-o]){const e=d[o].length,t=l(d[1-o][e-1]);t&&(d[o][e-1]=t)}c>d[o].length&&r?.gamesCreditForRetirements&&d[o].push(i)}}return[d[0].reduce(((e,t)=>e+t),0),d[1].reduce(((e,t)=>e+t),0)]}function qa({matchUpFormat:e,score:t}){const n=e?gi(e):void 0,r=$a(n?.bestOf??1),i=[0,0],a=[0,0];return t?.sets?.forEach(((e,t)=>{const o=(e.setNumber||t+1)>r&&n?.finalSetFormat?"finalSetFormat":"setFormat",s=n?.[o]?.based;if(Wa(s)){const{side1Score:t,side2Score:n}=e;t&&(a[0]+=m(t||0)),n&&(a[1]+=m(n||0))}else e.side1TiebreakScore&&(a[0]+=m(e.side1TiebreakScore||0)),e.side2TiebreakScore&&(a[1]+=m(e.side2TiebreakScore||0)),(e.side1TiebreakScore||e.side2TiebreakScore)&&e.winningSide&&(i[e.winningSide-1]+=1)})),{pointsTally:a,tiebreaksTally:i}}function $a(e){return e&&Math.ceil(e/2)||1}function Wa(e){return"P"===e}function Ha(e){return!Wa(e)}function za({participantIds:e,matchUpFormat:t,tallyPolicy:n,perPlayer:r,matchUps:i}){const a={},o=n?.excludeMatchUpStatuses||[],s=i.filter((t=>(t.tieMatchUps||!o.includes(t.matchUpStatus))&&(!e?.length||2===O(e,[Qa(t,0),Qa(t,1)]).length))),c=s.flatMap((({score:e,tieMatchUps:t})=>t?t.filter((({matchUpStatus:e})=>!o.includes(e))).flatMap((({score:e})=>e?.sets?.length||0)):e?.sets?.length||0)).reduce(((e,t)=>e+t),0);for(const u of s){const{matchUpStatus:e,tieMatchUps:i,tieFormat:o,score:s,winningSide:c,sides:d}=u,p=o&&u._disableAutoCalc&&o.collectionDefinitions.every((({scoreValue:e})=>e)),l=c&&Ya(u),m=c&&Ka(u);if(l||m)if(Ja(a,l),Ja(a,m),i?.length){r=0;for(const e of i){const{matchUpType:t}=e,r=t===Bi,i=t===_i;e.winningSide&&(e.winningSide===c?(l&&(a[l].tieMatchUpsWon+=1,i&&(a[l].tieSinglesWon+=1),r&&(a[l].tieDoublesWon+=1)),m&&(a[m].tieMatchUpsLost+=1,i&&(a[m].tieSinglesLost+=1),r&&(a[m].tieDoublesLost+=1))):e.winningSide!==c&&(m&&(a[m].tieMatchUpsWon+=1,i&&(a[m].tieSinglesWon+=1),r&&(a[m].tieDoublesWon+=1)),l&&(a[l].tieMatchUpsLost+=1,i&&(a[l].tieSinglesLost+=1),r&&(a[l].tieDoublesLost+=1)))),Za({matchUpFormat:e.matchUpFormat,matchUpStatus:e.matchUpStatus,score:e.score,winningParticipantId:l,losingParticipantId:m,participantResults:a,isTieMatchUp:!0,manualGamesOverride:p,tallyPolicy:n,winningSide:c})}eo({winningParticipantId:l,losingParticipantId:m,participantResults:a,matchUpStatus:e})}else Za({matchUpFormat:u.matchUpFormat||t,isTieMatchUp:void 0,winningParticipantId:l,manualGamesOverride:p,losingParticipantId:m,participantResults:a,matchUpStatus:e,tallyPolicy:n,winningSide:c,score:s});else if(e&&Ca.includes(e)){const e=Qa(u,0),t=Qa(u,1);e&&(Ja(a,e),a[e].matchUpsCancelled+=1),t&&(Ja(a,t),a[t].matchUpsCancelled+=1)}else if(i?.length){r=0;for(const e of i){if(e.winningSide){const t=d?.find((({sideNumber:t})=>t===e.winningSide))?.participantId,n=d?.find((({sideNumber:t})=>t===e.winningSide))?.participantId;t&&n&&(Ja(a,t),Ja(a,n),a[t].tieMatchUpsWon+=1,a[n].tieMatchUpsLost+=1,e.matchUpType===_i?(a[t].tieSinglesWon+=1,a[n].tieSinglesLost+=1):e.matchUpType===Bi&&(a[t].tieDoublesWon+=1,a[n].tieDoublesLost+=1))}Xa({score:e.score,manualGamesOverride:p,participantResults:a,sides:d})}}else Xa({manualGamesOverride:p,participantResults:a,score:s,sides:d});if(p){const e=d?.find((({sideNumber:e})=>1===e))?.participantId,t=d?.find((({sideNumber:e})=>2===e))?.participantId;Ja(a,e),Ja(a,t);const n=s?.sets?.reduce(((e,t)=>e+(t?.side1Score??0)),0),r=s?.sets?.reduce(((e,t)=>e+(t.side2Score??0)),0);e&&(a[e].gamesWon+=n,a[e].gamesLost+=r),t&&(a[t].gamesWon+=r,a[t].gamesLost+=n)}}return function({participantResults:e,matchUpFormat:t,tallyPolicy:n,perPlayer:r,totalSets:i}){const a=t&&gi(t)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,c=a.setFormat?.setTo;Object.keys(e).forEach((t=>{const a=e[t].setsWon,o=e[t].setsLost,u=n?.groupTotalSetsPlayed?i:r*(s||0)||a+o;let d=Math.round(a/u*1e3)/1e3;(d===1/0||isNaN(d))&&(d=u);const p=e[t].tieMatchUpsWon,l=p+e[t].tieMatchUpsLost;let m=Math.round(p/l*1e3)/1e3;(m===1/0||isNaN(m))&&(m=p);const f=e[t].matchUpsWon,h=f+e[t].matchUpsLost;let I=Math.round(f/h*1e3)/1e3;(I===1/0||isNaN(I))&&(I=f);const g=e[t].gamesWon||0,U=e[t].gamesLost||0,y=(r||0)*(s||0)*(c||0),v=Math.max(y,g+U);let S=Math.round(g/v*1e3)/1e3;(S===1/0||isNaN(S))&&(S=0);let w=Math.round(e[t].pointsWon/e[t].pointsLost*1e3)/1e3;(w===1/0||isNaN(w))&&(w=0),e[t].setsWon=a,e[t].setsLost=o,e[t].setsPct=d,e[t].tieMatchUpsWon=p,e[t].tieMatchUpsPct=m,e[t].matchUpsPct=I,e[t].gamesWon=g,e[t].gamesLost=U,e[t].gamesPct=S,e[t].pointsPct=w,e[t].result=`${e[t].matchUpsWon}/${e[t].matchUpsLost}`}))}({participantResults:a,matchUpFormat:t,tallyPolicy:n,perPlayer:r,totalSets:c}),{participantResults:a}}function Ya(e){return Qa(e,e.winningSide-1)}function Ka(e){return Qa(e,1-(e.winningSide-1))}function Qa(e,t){if(!e?.sides)return console.log("no sides:",{matchUp:e}),"foo";const n=e.sides[t];return n?n.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function Ja(e,t){t&&!e[t]&&(e[t]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function Xa({manualGamesOverride:e,participantResults:t,score:n,sides:r}){const{sets:i}=n||{},a=[[],[]],o=[0,0];for(const c of i||[]){const{winningSide:e,side1Score:t,side2Score:n}=c;e&&(o[e-1]+=1),a[0].push(m(t||0)),a[1].push(m(n||0))}const s=[a[0].reduce(((e,t)=>e+t),0),a[1].reduce(((e,t)=>e+t),0)];r.forEach(((n,r)=>{const{participantId:i}=n;i&&(Ja(t,i),t[i].setsWon+=o[r],t[i].setsLost+=o[1-r],e||(t[i].gamesWon+=s[r],t[i].gamesLost+=s[1-r]))}))}function Za({winningParticipantId:e,losingParticipantId:t,participantResults:n,manualGamesOverride:r,matchUpFormat:i,matchUpStatus:a,isTieMatchUp:o,tallyPolicy:s,winningSide:c,score:u}){const d=c&&c-1,p=1-d;o||eo({winningParticipantId:e,losingParticipantId:t,participantResults:n,matchUpStatus:a});const l=ja({matchUpStatus:a,matchUpFormat:i,tallyPolicy:s,winningSide:c,score:u}),m=Ga({matchUpStatus:a,matchUpFormat:i,tallyPolicy:s,winningSide:c,score:u}),{pointsTally:f}=qa({score:u,matchUpFormat:i});e&&(n[e].setsWon+=l[d],n[e].setsLost+=l[p],r||(n[e].gamesWon+=m[d],n[e].gamesLost+=m[p]),n[e].pointsWon+=f[d],n[e].pointsLost+=f[p]),t&&(n[t].setsWon+=l[p],n[t].setsLost+=l[d],r||(n[t].gamesWon+=m[p],n[t].gamesLost+=m[d]),n[t].pointsWon+=f[p],n[t].pointsLost+=f[d])}function eo({winningParticipantId:e,losingParticipantId:t,participantResults:n,matchUpStatus:r}){t&&(r===Ra&&(n[t].walkovers+=1),r===ga&&(n[t].defaults+=1),r===Pa&&(n[t].retirements+=1),[ga,Pa,Ra].includes(r)&&(n[t].allDefaults+=1),n[t].matchUpsLost+=1),e&&(n[e].matchUpsWon+=1),t&&e&&(n[t].defeats.push(e),n[e].victories.push(t))}function to({participantResults:e,participantIds:t,attribute:n}){return no({participantResults:e,participantIds:t}).reduce(((e,t)=>{const{participantId:r,results:i}=t,a=i?.[n];return!isNaN(a)&&r&&(e[a]?e[a].push(r):e[a]=[r]),e}),{})}function no(e){return(e.participantIds||Object.keys(e.participantResults)).reduce(((t,n,r)=>(t.push({participantId:n,i:r,results:e.participantResults[n]}),t)),[])}const ro=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],io={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function ao(e){const{requireCompletion:t=!0,participantResults:n,subOrderMap:r,tallyPolicy:i}=e,a=[];if(t&&!function({participantResults:e,participantsCount:t}){const n=no({participantResults:e}),r=n.filter((e=>t-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled));return t===r.length}(e))return{};const o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(i?.groupOrderKey)?i.groupOrderKey:"matchUpsWon",s=to({participantResults:n,attribute:o});a.push({attribute:o,groups:s});const c=Object.keys(s).map((e=>parseFloat(e))).sort(((e,t)=>t-e)).map((e=>s[e])).map((t=>{const n=oo({participantIds:t,...e});return a.push(...n.report||[]),n.order})).flat(1/0);let u,d=1;c.forEach(((e,t)=>{t&&(e.resolved||u&&!e.resolved)&&(d+=1),u=e.resolved,e.resolved?(e.position=t+1,d=e.position):e.position=d}));const p=R(c.map((({position:e})=>e)));return c.forEach((e=>{const{participantId:t,position:a}=e||{},o=n[t];e.GEMscore=function(e){const t=Array.isArray(i?.GEMscore)?Object.keys(io).filter((e=>i.GEMscore.includes(e))):Object.keys(io);return t.map((t=>(e[t]||0)*Math.pow(10,io[t].toFixed(3)))).reduce(((e,t)=>e+t),0)}(o);const s=p[a];void 0!==e?.position&&(s>1&&(e.ties=s,r&&(e.subOrder=r[t])),e.rankOrder=a,e.groupOrder=a+(e.subOrder||1)-1)})),{groupOrder:c,report:a.flat(1/0).filter(Boolean)}}function oo({participantResults:e,disableHeadToHead:t,participantIds:n,matchUpFormat:r,tallyPolicy:i,matchUps:a}){const o=[],s=[];let c;if(1===n?.length){return{order:[{resolved:!0,participantId:n[0]}]}}if(2===n?.length&&(!i?.headToHead||!i.headToHead.disabled&&!t)){const t=function({participantIds:e,participantResults:t}){if(!e)return;if(t[e[0]].victories.includes(e[1]))return e.map((e=>({resolved:!0,participantId:e})));if(t[e[1]].victories.includes(e[0]))return e.reverse().map((e=>({resolved:!0,participantId:e})))}({participantIds:n,participantResults:e});if(t){const e=t[0].participantId;return s.push({attribute:"head2Head",participantIds:n,headToHeadWinner:e}),{order:[t],headToHeadWinner:e,report:s}}}const u=(i?.tallyDirectives||ro).filter((e=>{const t=!(U(e.maxParticipants)&&n?.length>e.maxParticipants);return t||o.push(e),t}));return o.length&&s.push({excludedDirectives:o,participantIds:n}),u.every((({attribute:e,reversed:t,idsFilter:o,disableHeadToHead:u})=>(c=function({disableHeadToHead:e,participantIds:t,matchUpFormat:n,tallyPolicy:r,attribute:i,idsFilter:a,matchUps:o,reversed:s}){const{participantResults:c}=za({participantIds:a&&t,matchUpFormat:n,tallyPolicy:r,matchUps:o}),u=to({participantResults:c,participantIds:t,attribute:i}),d=[{attribute:i,reversed:s,groups:u,idsFilter:a}];let p;return Object.keys(u).length>1&&t.length&&(p=Object.keys(u).map((e=>parseFloat(e))).sort(((e,t)=>s?e-t:t-e)).map((e=>u[e])).map((t=>{const i=oo({participantResults:c,disableHeadToHead:e,participantIds:t,matchUpFormat:n,tallyPolicy:r,matchUps:o});return d.push(...i.report||[]),i.order})).flat(1/0)),{order:p,report:d}}({disableHeadToHead:u,participantIds:n,matchUpFormat:r,tallyPolicy:i,attribute:e,idsFilter:o,matchUps:a,reversed:t}),s.push(c.report),!c.order))),c.order?{order:c.order,report:s}:{order:n?.map((e=>({participantId:e}))),report:s}}const so="voluntaryConsolation",co="competitiveBands",uo="roundRobinTally",po="positionActions",lo="matchUpActions",mo="rankingPoints",fo="roundNaming",ho="participant",Io="progression",go="scheduling",Uo="avoidance",yo="display",vo="scoring",So="seeding",wo="feedIn",Po="draws",To={POLICY_TYPE_VOLUNTARY_CONSOLATION:so,POLICY_TYPE_COMPETITIVE_BANDS:co,POLICY_TYPE_ROUND_ROBIN_TALLY:uo,POLICY_TYPE_POSITION_ACTIONS:po,POLICY_TYPE_MATCHUP_ACTIONS:lo,POLICY_TYPE_RANKING_POINTS:mo,POLICY_TYPE_ROUND_NAMING:fo,POLICY_TYPE_PARTICIPANT:ho,POLICY_TYPE_PROGRESSION:Io,POLICY_TYPE_SCHEDULING:go,POLICY_TYPE_AVOIDANCE:Uo,POLICY_TYPE_DISPLAY:yo,POLICY_TYPE_FEED_IN:wo,POLICY_TYPE_SCORING:vo,POLICY_TYPE_SEEDING:So,POLICY_TYPE_AUDIT:"audit",POLICY_TYPE_DRAWS:Po};function Do({policyDefinitions:e,generateReport:t,matchUpFormat:n,matchUps:r=[],subOrderMap:i,perPlayer:a}){if(!La(r))return{error:Ze};if(1!==r.reduce(((e,{structureId:t})=>e.includes(t)?e:e.concat(t)),[]).length)return{error:xn,info:"Maximum one structureId"};const o=r.filter((e=>e&&e.matchUpStatus!==ma)),s=o.length&&P(o.map((({drawPositions:e})=>e)).flat()).length,c=o.filter((e=>xa({matchUp:e}))).length===o.length;c||(a=0);const u=r.every((({matchUpType:e,tieMatchUps:t})=>e===ji&&t.every((e=>xa({matchUp:e}))))),d=e?.[uo],p=r.filter((e=>xa({matchUp:e})||e.matchUpType===ji)),{participantResults:l}=za({matchUps:p,matchUpFormat:n,tallyPolicy:d,perPlayer:a});let m,f;const{groupOrder:h,report:I}=ao({matchUps:p,participantResults:l,participantsCount:s,matchUpFormat:n,tallyPolicy:d,subOrderMap:i});if(c&&h)m=I,f=h,h.forEach((e=>{const{participantId:t,groupOrder:n,rankOrder:r,subOrder:i,ties:a,GEMscore:o}=e,s=l[t];Object.assign(s,{groupOrder:n,rankOrder:r,GEMscore:o,subOrder:i,ties:a})}));else{const{groupOrder:e,report:t}=ao({requireCompletion:!1,participantResults:l,participantsCount:s,matchUpFormat:n,tallyPolicy:d,subOrderMap:i,matchUps:r});m=t,f=e,e&&e.forEach((e=>{const{participantId:t,groupOrder:n,GEMscore:r}=e,i=l[t];Object.assign(i,{provisionalOrder:n,GEMscore:r})}))}const g={completedTieMatchUps:u,readableReport:"",participantResults:l,bracketComplete:c,order:[],report:m};if((c||u)&&(g.order=f),t||ar({tally:!0})){const e=function({matchUps:e,order:t,report:n}){const r={};e.forEach((({sides:e})=>{e.forEach((e=>{e.participantId&&e.participant&&(r[e.participantId]=e.participant.participantName)}))}));const i=[];return Array.isArray(n)&&n.forEach(((e,t)=>{if(e.excludedDirectives?.length){const t=e.excludedDirectives.map((({attribute:e})=>e)).join(", "),n=`${t.length} directives were excluded due to participants limit}`;i.push(n);const r=`Excluded: ${t}`;i.push(r)}else{const n=(t,n)=>parseFloat(e.reversed?t:n)-parseFloat(e.reversed?n:t),a=e.groups?Object.values(e.groups).flat(1/0).length:e.participantIds?.length??0,o=e=>{e.groups&&Object.keys(e.groups).sort(n).forEach((t=>{const n=e.groups[t].map((e=>r[e])).join(", "),a=`${t} ${e.attribute}: ${n}`;i.push(a)}))},s=e.reversed?" in reverse order":"",c=`Step ${t+1}: ${a} particiants were ${e.groups?"grouped":"separated"}${s} by ${e.attribute}`;if(i.push(c),e.idsFilter){const t=`${e.attribute} was calculated considering ONLY TIED PARTICIPANTS`;i.push(t)}o(e)}i.push("----------------------")})),i.push("Final Order:"),t.forEach((e=>{const{participantId:t,resolved:n}=e,a=e.groupOrder||e.provisionalOrder;i.push(`${a}: ${r[t]} => resolved: ${!!n}`)})),i.join("\r\n")}({matchUps:r,report:m,order:f});ar({tally:!0})&&console.log(e),g.readableReport=e}return g}const Ro="appliedPolicies",bo="positionActions",No="context",Mo="delegatedOutcome",Ao="disabled",Eo="disableLinks",Co="disableAutoCalc",Oo="drawDeletions",Fo="entryProfile",ko="flightProfile",xo="groupingAttribute",_o="lineUps",Lo="linkedTournamentsIds",Bo="matchUpHistory",Vo="participantRepresentatives",jo="personRequests",Go="rankingPoints",qo="roundTarget",$o="scheduleLimits",Wo="scheduleTiming",Ho="schedulingProfile",zo="subOrder",Yo="tally",Ko="tieFormatModification",Qo={APPLIED_POLICIES:Ro,AUDIT_POSITION_ACTIONS:bo,CONTEXT:No,DELEGATED_OUTCOME:Mo,DISABLED:Ao,DISABLE_LINKS:Eo,DISABLE_AUTO_CALC:Co,DRAW_DELETIONS:Oo,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:Fo,EVENT_PROFILE:"eventProfile",FLIGHT_PROFILE:ko,GROUPING_ATTRIBUTE:xo,LINEUPS:_o,LINKED_TOURNAMENTS:Lo,MATCHUP_HISTORY:Bo,PARTICIPANT_REPRESENTATIVES:Vo,PERSON_REQUESTS:jo,RANKING_POINTS:Go,ROUND_TARGET:qo,SCHEDULE_LIMITS:$o,SCHEDULE_TIMING:Wo,SCHEDULING_PROFILE:Ho,STATUS_DETAIL:"statusDetail",SUB_ORDER:zo,TALLY:Yo,TIE_FORMAT_MODIFICATIONS:Ko,FACTORY:"factory"},Jo=[Mo,Ao,Eo,ko,_o,Bo,Vo,jo,qo,$o,Wo,Ho,zo,Yo];function Xo({onlySpecifiedPolicyTypes:e=!1,policyTypes:t=[],tournamentRecord:n,drawDefinition:r,structure:i,event:a}){if(!Array.isArray(t))return{error:nt};const o={};return n&&s(n),a&&s(a),r&&s(r),i&&s(i),{appliedPolicies:o,...L};function s(n){const r=n?.extensions,i=r?.find((e=>e.name===Ro))?.value;if(i)for(const a of Object.keys(i))(e?t.includes(a):!t.length||t.includes(a))&&(o[a]=ii(i[a],!1,!0))}}function Zo({policyTypes:e=[],tournamentRecord:t,drawDefinition:n,structure:r,event:i}){if(!Array.isArray(e))return{error:nt};const{appliedPolicies:a}=Xo({tournamentRecord:t,drawDefinition:n,structure:r,event:i}),o={};for(const s of e){const e=a?.[s];e&&(o[s]=e)}return Object.keys(o).length?{policyDefinitions:o}:{info:ut.message}}const es="WALKOVER",ts="RETIRED",ns="COMPETITIVE",rs="ROUTINE",is="DECISIVE",as="winRatio",os={[co]:{policyName:"Competitive Bands Default",profileBands:{[is]:20,[rs]:50}}};function ss({policyDefinitions:e,tournamentRecord:t,contextProfile:n,drawDefinition:r,event:i}){const a={policies:{}};if(!n)return a;const o=Zo({tournamentRecord:t,drawDefinition:r,event:i}).policyDefinitions;if(n.withCompetitiveness){const t=e?.[co]||o?.[co]||os[co];a.policies[co]=t}return a}function cs({matchUps:e,matchUpId:t}){return{matchUp:(e||[]).find((e=>e.matchUpId===t))}}const us=(e,t)=>(e||0)+(t||0);function ds(e,t){const n=Array.isArray(e)?e[0]:e;return isNaN(n)&&es||n<=t[is]&&is||n<=t[rs]&&rs||ns}function ps({score:e}){const t=e?.sets||[],n=t.reduce(((e,t)=>(e[0]+=t.side1Score||0,e[1]+=t.side2Score||0,e)),[0,0]),r=t.reduce(((e,t)=>(e[0]+=t.side1TiebreakScore||0,e[1]+=t.side2TiebreakScore||0,e)),[0,0]);return r.reduce(us)&&(n[r[0]>r[1]?0:1]+=1),{sets:t,games:n,score:e}}function ls(e){const t=Math.min(...e.games),n=Math.max(...e.games);return Math.round(t/n*100)}function ms(e){return e.map(ls).sort().map((e=>parseFloat(e.toFixed(2))))}function fs({tournamentRecord:e,drawDefinition:t,policyType:n,structure:r,event:i}){if(!e)return{error:$};const{appliedPolicies:a}=Xo({tournamentRecord:e,drawDefinition:t,structure:r,event:i});return a?.[n]?{policy:a[n]}:{info:ut?.message}}function hs({tournamentRecord:e,profileBands:t,matchUp:n}){if(!n)return{error:et};const{score:r,winningSide:i}=n;if(!i)return{error:xn};const a=!t&&e&&fs({policyType:co,tournamentRecord:e}).policy,o=t||a?.profileBands||os[co].profileBands,s=ms([ps({score:r})]),c=ds(s,o),u=Array.isArray(s)?s[0]:s;return{...L,competitiveness:c,pctSpread:u}}function Is(e){const{matchUpAverageTimes:t,matchUpFormat:n}=e||{},r=t?.map((({matchUpFormatCodes:e})=>e?.filter((e=>e===n)))).flat().filter(Boolean).sort(((e,t)=>(e?.length||0)-(t?.length||0)))||[],i=r.includes(n)?n:r[0],a=t?.find((({matchUpFormatCodes:e,averageTimes:t})=>e?.find((e=>i===e))&&t));return a?.averageTimes}function gs(e){const{matchUpRecoveryTimes:t,averageMinutes:n,matchUpFormat:r}=e||{};return t?.find((({matchUpFormatCodes:e,averageTimes:t,recoveryTimes:i})=>{if(t&&n){const{greaterThan:e=0,lessThan:r=360}=t;if(n>e&&n<r)return!0}return e?.find((e=>e===r))&&i}))?.recoveryTimes}function Us({timesBlockArray:e,categoryName:t,categoryType:n}){return e.filter((e=>Array.isArray(e))).map((e=>e.sort(((e,t)=>(t.categoryNames?.length||0)-(e.categoryNames?.length||0))).find((({categoryTypes:e,categoryNames:r})=>!r?.length&&!e?.length||r?.includes(t)||e?.includes(n))))).find(Boolean)}const ys="DYNAMIC",vs="RANKING",Ss="RATING",ws="SCALE",Ps="SEEDING",Ts={RANKING:vs,RATING:Ss,SCALE:ws,SEEDING:Ps};function Ds({participant:e}){const t=e.timeItems?.filter((({itemType:e})=>e?.startsWith(ws)&&[vs,Ss,Ps].includes(e.split(".")[1]))),n={ratings:{},rankings:{},seedings:{}};if(t?.length){const e=e=>t.filter((t=>t?.itemType===e)).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())).pop(),r=P(t.map((({itemType:e})=>e)));for(const t of r){const r=e(t);if(r){const[,e,t,i,a]=r.itemType.split("."),o=a?`${i}.${a}`:i,s=(e===Ps?"seedings":e===vs&&"rankings")||"ratings";n[s][t]||(n[s][t]=[]),n[s][t].push({scaleValue:r.itemValue,scaleDate:r.itemDate,scaleName:o})}}}return{...L,...n}}function Rs({tournamentParticipants:e=[],policyDefinitions:t={},contextProfile:n,participantId:r,internalUse:i,personId:a}){const o=ii(e.find((e=>r&&e.participantId===r||a&&e.person&&e.person.personId===a)),!1,i);if(o){const e=t?.[ho];if(n?.withScaleValues){const{ratings:e,rankings:t}=Ds({participant:o});o.rankings=t,o.ratings=e}if(e?.participant)return mi({template:e.participant,source:o})}return o}function bs({tournamentRecord:e,participantId:t}){return{participant:(e.participants||[]).reduce(((e,n)=>n.participantId===t?n:e),void 0)}}const Ns="extensionQueries";function Ms({element:e,name:t}){if(!e||!t)return Mi({result:{error:mt},stack:Ns});if(!Array.isArray(e.extensions))return{info:Gn};const n=e.extensions.find((e=>e?.name===t));return{extension:n,info:n?void 0:Gn}}function As({tournamentRecord:e,name:t}){return Ms({element:e,name:t})}function Es({event:e,name:t}){return e?Ms({element:e,name:t}):Mi({result:{error:Ae},stack:Ns})}function Cs({drawDefinition:e,name:t}){return e?Ms({element:e,name:t}):Mi({result:{error:Y},stack:Ns})}function Os({tournamentRecord:e,categoryName:t,categoryType:n,event:r}){t=t??r?.category?.categoryName??r?.category?.ageCategoryCode,n=n??r?.category?.categoryType??r?.category?.subType;const{policy:i}=fs({policyType:go,tournamentRecord:e,event:r}),a=e?As({name:Wo,tournamentRecord:e}).extension:void 0,o=a?.value,s=r&&Es({name:Wo,event:r}).extension,c=s?.value;return{scheduleTiming:{tournamentScheduling:o,eventScheduling:c,categoryName:t,categoryType:n,policy:i}}}const Fs="DOUBLES_SINGLES",ks="SINGLES_DOUBLES",xs="total",_s="participantConflict",Ls="matchUpConflict",Bs="ISSUE_IDS",Vs="CONFLICT",js="WARNING",Gs="ERROR",qs="ISSUE",$s="STATE",Ws={SINGLES_DOUBLES:ks,DOUBLES_SINGLES:Fs,TOTAL:xs,CONFLICT_MATCHUP_ORDER:Ls,CONFLICT_PARTICIPANTS:_s,SCHEDULE_ISSUE_IDS:Bs,SCHEDULE_CONFLICT:Vs,SCHEDULE_WARNING:js,SCHEDULE_ERROR:Gs,SCHEDULE_ISSUE:qs,SCHEDULE_STATE:$s};function Hs({defaultAverageMinutes:e=90,defaultRecoveryMinutes:t=0,tournamentRecord:n,matchUpFormat:r,categoryName:i,categoryType:a,eventType:o,event:s}){if(!n)return{error:$};o=o??s?.eventType??Yi.Singles;const c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},{scheduleTiming:u}=Os({tournamentRecord:n,categoryName:i,categoryType:a,event:s});return zs({eventType:o,timingDetails:{...u,matchUpFormat:r,categoryType:a,defaultTiming:c}})}function zs({timingDetails:e,eventType:t}){const n=function({matchUpFormat:e,categoryName:t,categoryType:n,defaultTiming:r,tournamentScheduling:i,eventScheduling:a,policy:o}){return Us({categoryName:t,categoryType:n,timesBlockArray:[a?.matchUpAverageTimes&&Is({...a,matchUpFormat:e}),i?.matchUpAverageTimes&&Is({...i,matchUpFormat:e}),o?.matchUpAverageTimes&&Is({...o,matchUpFormat:e}),o?.defaultTimes?.averageTimes,r?.averageTimes]})}(e),r=Object.keys(n?.minutes||{}),i=n?.minutes&&(r?.includes(t)&&n.minutes[t]||n.minutes.default),a=function({tournamentScheduling:e,eventScheduling:t,averageMinutes:n,defaultTiming:r,matchUpFormat:i,categoryName:a,categoryType:o,policy:s}){return Us({categoryName:a,categoryType:o,timesBlockArray:[t?.matchUpRecoveryTimes&&gs({...t,averageMinutes:n,matchUpFormat:i}),e?.matchUpRecoveryTimes&&gs({...e,averageMinutes:n,matchUpFormat:i}),s?.matchUpRecoveryTimes&&gs({...s,averageMinutes:n,matchUpFormat:i}),s?.defaultTimes?.recoveryTimes,r?.recoveryTimes]})}({...e,averageMinutes:i}),o=Object.keys(a?.minutes||{}),s=a?.minutes&&(o?.includes(t)&&a.minutes[t]||a.minutes.default),c=t===_i?ks:Fs;return{averageMinutes:i,recoveryMinutes:s,typeChangeRecoveryMinutes:a?.minutes&&(o?.includes(c)&&a.minutes[c]||s)}}function Ys({requiredAttributes:e=["name","value"],extension:t}){if(!t||"object"!=typeof t)return!1;if("string"!=typeof t.name)return!1;const n=Object.keys(t);return e.filter((e=>n.includes(e))).length===e.length}function Ks({event:e,eventId:t}){if(!e)return{error:Ae};const n=Es({name:ko,event:e}),r=n?.extension,i=t?ii(r?.value,!1,!0):r?.value;return t&&e.drawDefinitions?.forEach((e=>{i?.flights?.forEach((t=>{t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})}))})),{flightProfile:i}}function Qs({tournamentRecord:e,eventId:t,drawId:n}){const r="findEvent";if(!e)return Mi({result:{error:$},stack:r});const i=e?.events??[];if(n){let e;const t=i.find((t=>{const r=(t?.drawDefinitions??[]).find((e=>e.drawId===n));if(r)e=r;else{const{flightProfile:e}=Ks({event:t}),r=e?.flights?.find((e=>e.drawId===n));if(r)return{drawId:n,entries:r.drawEntries,drawName:r.drawName}}return r}));if(t)return{event:t,drawDefinition:e}}if(t){const e=i.find((e=>e.eventId===t));return e?{event:e,drawDefinition:void 0}:{event:void 0,drawDefinition:void 0,...Mi({result:{error:Ee},stack:r})}}return{event:void 0,drawDefinition:void 0,...Mi({result:{error:Q},context:{drawId:n,eventId:t},stack:r})}}function Js(e){if("object"!=typeof e)return{error:mt};const t="addExtension";if(!e?.element)return Mi({result:{error:mt},stack:t});if("object"!=typeof e.element)return Mi({result:{error:xn},stack:t});if(!Ys({extension:e.extension}))return Mi({result:{error:xn,info:"invalid extension"},stack:t});e.element.extensions||(e.element.extensions=[]);if(e?.creationTime??!0){const t=(new Date).toISOString();Object.assign(e.extension,{createdAt:t})}const n=e.element.extensions.find((({name:t})=>t===e.extension.name));return n?n.value=e.extension.value:e.extension.value&&e.element.extensions.push(e.extension),{...L}}const Xs="element required",Zs="missing name";function ec(e){return e&&"object"==typeof e?e?.element?"object"!=typeof e?.element?{error:xn}:e?.name?e?.element.extensions?(e.element.extensions=e.element.extensions.filter((t=>t?.name!==e.name)),{...L}):{...L,info:Gn}:{error:mt,info:Zs}:{error:mt,info:Xs}:{error:mt}}function tc(e){return e&&"object"==typeof e?e.tournamentRecord?Js({creationTime:e.creationTime,element:e.tournamentRecord,extension:e.extension}):{error:$}:{error:mt}}function nc(e){return e&&"object"==typeof e?e.drawDefinition?Js({creationTime:e.creationTime,element:e.drawDefinition,extension:e.extension}):{error:Q}:{error:mt}}function rc(e){return e&&"object"==typeof e?e.event?Js({creationTime:e.creationTime,extension:e.extension,element:e.event}):{error:Ae}:{error:mt}}function ic(e){return e&&"object"==typeof e?e.tournamentRecord?ec({element:e.tournamentRecord,name:e.name}):{error:$}:{error:mt}}function ac(e){return e&&"object"==typeof e?e?.event?ec({element:e.event,name:e.name}):{error:Ee}:{error:mt}}function oc({tournamentRecords:e,extension:t}){if(!Ys({extension:t}))return{error:xn};for(const n of Object.values(e)){const e=tc({tournamentRecord:n,extension:t});if(e.error)return Mi({result:e,stack:"addExtension"})}return{...L}}function sc({tournamentRecords:e,name:t}){if(!t)return{error:mt,info:Zs};let n;return Object.keys(e).find((r=>{const i=e[r],{extension:a}=As({tournamentRecord:i,name:t});return n=a,!!a}))?{extension:n}:{error:Gn}}function cc({tournamentRecords:e,name:t}){if(!t)return{error:mt,info:Zs};let n=0;for(const r of Object.keys(e)){const i=ic({tournamentRecord:e[r],name:t});if(i.error)return Mi({result:i,stack:"removeExtension"});i.info!==Gn&&n++}return{...L,removed:n}}function uc({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};return{linkedTournamentIds:Object.assign({},...Object.keys(e).map((t=>{const n=e[t],r=n?.tournamentId,{extension:i}=As({tournamentRecord:n,name:Lo});return{[t]:(i?.value?.tournamentIds||[]).filter((e=>e!==r))}})))}}function dc(e){return{tournamentIds:Object.keys(e).filter(Boolean)}}function pc({extension:e,dates:t=[]}){if(!e)return!1;if("boolean"==typeof e.value&&e.value)return!0;if("object"==typeof e.value&&Array.isArray(e.value.dates)){if(!t.length)return!0;return!!t.filter((t=>e.value.dates.includes(t))).length}}function lc({element:e,name:t}){const n="findExtension";if(!e||!t)return Mi({result:{error:mt},stack:n});if(!Array.isArray(e.extensions))return Mi({result:{error:Gn},stack:n});const r=e.extensions.find((e=>e?.name===t));return r?{extension:r}:Mi({result:{error:Gn},stack:n})}function mc({convertExtensions:e,ignoreDisabled:t,venue:n,court:r}){const i={...ii(r,e,!0),venueId:n.venueId},{extension:a}=lc({name:Ao,element:r});if(t&&a){const e="object"==typeof a.value&&a.value.dates||[],t=!0===a.value?[]:i.dateAvailability.map((t=>{const n=t.date;if(n&&!e.includes(n))return t})).filter(Boolean);i.dateAvailability=t}return{inContextCourt:i}}const fc="addDrawDefinition",hc="addMatchUps",Ic="addParticipants",gc="addScaleItems",Uc="addVenue",yc="audit",vc="deleteParticipants",Sc="deleteVenue",wc="deletedDrawIds",Pc="deletedMatchUpIds",Tc="modifyDrawDefinition",Dc="modifyDrawEntries",Rc="modifyEventEntries",bc="modifyMatchUp",Nc="modifyParticipants",Mc="modifyPositionAssignments",Ac="modifySeedAssignments",Ec="modifyTournamentDetail",Cc="modifyVenue",Oc="mutations",Fc="publishEvent",kc="publishEventSeeding",xc="publishOrderOfPlay",_c="unPublishEvent",Lc="unPublishEventSeeding",Bc="unPublishOrderOfPlay",Vc="updateInContextMatchUp",jc={ADD_DRAW_DEFINITION:fc,ADD_MATCHUPS:hc,ADD_PARTICIPANTS:Ic,ADD_SCALE_ITEMS:gc,ADD_VENUE:Uc,AUDIT:yc,DELETE_PARTICIPANTS:vc,DELETE_VENUE:Sc,DELETED_DRAW_IDS:wc,DELETED_MATCHUP_IDS:Pc,MODIFY_DRAW_DEFINITION:Tc,MODIFY_DRAW_ENTRIES:Dc,MODIFY_EVENT_ENTRIES:Rc,MODIFY_MATCHUP:bc,MODIFY_PARTICIPANTS:Nc,MODIFY_POSITION_ASSIGNMENTS:Mc,MODIFY_SEED_ASSIGNMENTS:Ac,MODIFY_TOURNAMENT_DETAIL:Ec,MODIFY_VENUE:Cc,MUTATIONS:Oc,PUBLISH_EVENT_SEEDING:kc,PUBLISH_EVENT:Fc,PUBLISH_ORDER_OF_PLAY:xc,UNPUBLISH_EVENT_SEEDING:Lc,UNPUBLISH_EVENT:_c,UNPUBLISH_ORDER_OF_PLAY:Bc,UPDATE_INCONTEXT_MATCHUP:Vc};function Gc({tournamentRecord:e,disableNotice:t,context:n,venue:r}){if(!e)return{error:$};if(!r)return{error:mt,info:"missing venue"};e.venues||(e.venues=[]),r.venueId||(r.venueId=Ii());if(e.venues.reduce(((e,t)=>e||t.venueId===r.venueId),void 0))return{error:ln};if(n){Js({element:r,extension:{value:n,name:No}})}return e.venues.push(r),t||pr({payload:{venue:r,tournamentId:e.tournamentId},topic:Uc}),{...L,venue:ii(r)}}function qc({convertExtensions:e,tournamentRecord:t,ignoreDisabled:n,dates:r}){if(!t)return{error:$};const i=ii(t.venues??[],e).filter((e=>{if(!n)return e;const{extension:t}=lc({name:Ao,element:e});return!t?.value&&e})).filter(Boolean),a=i.reduce(((t,i)=>{const a=(i?.courts||[]).filter((e=>{if(!n&&!r?.length)return e;const{extension:t}=lc({name:Ao,element:e});return pc({extension:t,dates:r})})).filter(Boolean).map((t=>{const{inContextCourt:r}=mc({convertExtensions:e,ignoreDisabled:n,venue:i,court:t});return r}));return a.length?t.concat(a):t}),[]);return{venues:i,courts:a}}function $c({tournamentRecords:e,tournamentRecord:t,venueId:n}){if(!t)return{error:$};if(!n)return{error:fn};const r=(t.venues??[]).reduce(((e,t)=>t.venueId===n?t:e),void 0);if(!r&&e){const i=(uc({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(const a of i){const i=$c({tournamentRecord:e[a],venueId:n});if(i.success&&i.venue)return Gc({tournamentRecord:t,venue:i.venue}),{...L,venue:r}}}return r?{...L,venue:r}:{error:mn}}function Wc({tournamentRecords:e,tournamentRecord:t,courtId:n}){if(!t)return{error:$};if(!n)return{error:lt};let r,i;if((t.venues??[]).forEach((e=>{(e.courts??[]).forEach((t=>{t.courtId===n&&(r=t,i=e)}))})),r)return{...L,court:r,venue:i};if(e){const a=(uc({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(const o of a){const a=Wc({tournamentRecord:e[o],courtId:n});if(a.success)return a.venue&&Gc({tournamentRecord:t,venue:a.venue}),{...L,court:r,venue:i}}}return Mi({result:{error:dn},stack:"findCourt"})}function Hc({tournamentRecord:e,internalUse:t,courtId:n}){if(!e)return{error:$};if(!n)return{error:lt};const r=Wc({tournamentRecord:e,courtId:n});if(r.error)return r;const i=r.court&&(({altitude:e,courtId:t,courtName:n,courtDimensions:r,latitude:i,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:c,pace:u,notes:d})=>({altitude:e,courtId:t,courtName:n,courtDimensions:r,latitude:i,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:c,pace:u,notes:d}))(r.court);return{...L,courtInfo:ii(i,!1,t)}}function zc({tournamentRecord:e,venueId:t}){if(!e)return{error:$};if(!t)return{error:fn};const n=$c({tournamentRecord:e,venueId:t});if(n.error)return n;const r=(n.venue?.courts??[]).map((t=>(({courtInfo:e})=>({...e}))(Hc({courtId:t.courtId,internalUse:!0,tournamentRecord:e})))),i=n.venue&&(({venueId:e,venueName:t,venueAbbreviation:n})=>({venueAbbreviation:n,venueName:t,venueId:e}))(n.venue),a=i&&{...i,courtsInfo:r};return{...L,venueData:ii(a,!1,!0)}}const Yc="CHECK_IN",Kc="CHECK_OUT",Qc="SCHEDULE.ASSIGNMENT.VENUE",Jc="SCHEDULE.ALLOCATION.COURTS",Xc="SCHEDULE.ASSIGNMENT.COURT",Zc="SCHEDULE.COURT.ORDER",eu="SCHEDULE.DATE",tu="SCHEDULE.ASSIGN.OFFICIAL",nu="SCHEDULE.TIME.SCHEDULED",ru="SCHEDULE.TIME.START",iu="SCHEDULE.TIME.STOP",au="SCHEDULE.TIME.RESUME",ou="SCHEDULE.TIME.END",su="SCHEDULE.TIME.MODIFIERS",cu="TO_BE_ANNOUNCED",uu="NEXT_AVAILABLE",du="FOLLOWED_BY",pu="AFTER_REST",lu="RAIN_DELAY",mu=[cu,uu,du,pu,lu],fu="SCALE",hu="RATING",Iu="RANKING",gu="SEEDING",Uu="PUBLISH",yu="PUBLIC",vu="STATUS",Su={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:mu,AFTER_REST:pu,ALLOCATE_COURTS:Jc,ASSIGN_COURT:Xc,ASSIGN_OFFICIAL:tu,ASSIGN_VENUE:Qc,CHECK_IN:Yc,CHECK_OUT:Kc,COMPLETED_DATE:"COMPLETED.DATE",COURT_ORDER:Zc,ELIGIBILITY:"ELIGIBILITY",END_TIME:ou,FOLLOWED_BY:du,MEDICAL:"MEDICAL",MODIFICATION:"MODIFICATION",NEXT_AVAILABLE:uu,NOT_BEFORE:"NOT_BEFORE",OTHER:"other",PENALTY:"PENALTY",PUBLIC:yu,PUBLISH:Uu,RANKING:Iu,RATING:hu,RAIN_DELAY:lu,REGISTRATION:"REGISTRATION",RESUME_TIME:au,RETRIEVAL:"RETRIEVAL",SCALE:fu,SCHEDULE:"SCHEDULE",SCHEDULED_DATE:eu,SCHEDULED_TIME:nu,SEEDING:gu,START_TIME:ru,STATUS:vu,STOP_TIME:iu,SUSPENSION:"SUSPENSION",TIME_MODIFIERS:su,TO_BE_ANNOUNCED:cu};function wu(e){return e.createdAt?new Date(e.createdAt).getTime():0}function Pu({visibilityThreshold:e,timeItems:t,itemType:n}){const r=t.filter((t=>t&&t.itemType===n&&(!e||wu(t)<new Date(e).getTime()))).sort(((e,t)=>wu(e)-wu(t))).pop(),i=r&&wu(r);return{itemValue:r?.itemValue,timeStamp:i}}function Tu({visibilityThreshold:e,timeStamp:t,schedule:n,matchUp:r}){const{itemValue:i,timeStamp:a}=Pu({timeItems:r?.timeItems||[],itemType:nu,visibilityThreshold:e});return!n||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{scheduledTime:i}:n}function Du({visibilityThreshold:e,timeStamp:t,schedule:n,matchUp:r}){const{itemValue:i,timeStamp:a}=Pu({timeItems:r?.timeItems||[],itemType:eu,visibilityThreshold:e});return!n||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{scheduledDate:i}:n}function Ru({visibilityThreshold:e,timeStamp:t,schedule:n,matchUp:r}){const{itemValue:i,timeStamp:a}=Pu({timeItems:r?.timeItems||[],itemType:Jc,visibilityThreshold:e});return!n||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{allocatedCourts:ii(i,!1,!0)}:n}function bu({visibilityThreshold:e,timeStamp:t,schedule:n,matchUp:r}){const{itemValue:i,timeStamp:a}=Pu({timeItems:r?.timeItems||[],itemType:Xc,visibilityThreshold:e});return!n||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{courtId:i}:n}function Nu({visibilityThreshold:e,timeStamp:t,schedule:n,matchUp:r}){const{itemValue:i,timeStamp:a}=Pu({timeItems:r?.timeItems||[],itemType:Qc,visibilityThreshold:e});return!n||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{venueId:i}:n}function Mu({visibilityThreshold:e,timeStamp:t,schedule:n,matchUp:r}){const{itemValue:i,timeStamp:a}=Pu({timeItems:r?.timeItems||[],itemType:su,visibilityThreshold:e});return!n||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{timeModifiers:i}:n}function Au(e){if(br.test(e)){const t=Fr();return new Date(`${t}T${e}`)}return new Date(e)}function Eu({matchUp:e}){if(!e)return{error:et};if(!e.timeItems)return{error:Pn};const t=e.timeItems.filter((e=>[ru,iu,au,ou].includes(e?.itemType))).sort(((e,t)=>Au(e.itemValue).getTime()-Au(t.itemValue).getTime())),n=t.reduce(((e,t)=>{let n;const r=t?.itemType?.split("."),i=`SCHEDULE.TIME.${t?.itemType?.startsWith("SCHEDULE.TIME")&&r[2]}`;switch(i){case ru:n=0;break;case ou:if(e.lastValue&&[ru,au].includes(e.lastType)){const r=Au(t.itemValue).getTime()-Au(e.lastValue).getTime();n=e.milliseconds+r}else n=e.milliseconds;break;case iu:if([ru,"SCHECULE.TIME.RESUME"].includes(e.lastType)){const r=Au(t.itemValue).getTime()-Au(e.lastValue).getTime();n=e.milliseconds+r}else n=e.milliseconds;break;default:n=e.milliseconds}return{milliseconds:n,lastType:i,lastValue:t.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([ru,au].includes(n.lastType)){const e=(new Date).getTime()-Au(n.lastValue).getTime();n.milliseconds+=e}return{milliseconds:n.milliseconds,time:Cu(n.milliseconds),relevantTimeItems:t}}function Cu(e){const t=(e,t=2)=>("00"+e).slice(-t);return t(e/36e5|0)+":"+t(e%36e5/6e4|0)+":"+t(e%6e4/1e3|0)}const Ou="SINGLES",Fu="SINGLES",ku="DOUBLES",xu="DOUBLES",_u="TEAM",Lu="TEAM",Bu={AGE:"AGE",BOTH:"BOTH",DOUBLES:ku,DOUBLES_EVENT:xu,RATING:"RATING",SINGLES:Ou,SINGLES_EVENT:Fu,TEAM_EVENT:Lu,TEAM:_u};function Vu({scheduleVisibilityFilters:e,afterRecoveryTimes:t,tournamentRecord:n,scheduleTiming:r,matchUpFormat:i,matchUpType:a,matchUp:o,event:s}){if(!o)return{error:et};if(t&&!o.matchUpType&&!a&&(s||n)&&o.drawId){let e=s?.drawDefinitions?.find((e=>e.drawId===o.drawId));!e&&n&&({drawDefinition:e,event:s}=Qs({tournamentRecord:n,drawId:o.drawId}));const t=o.structureId&&e?.structures?.find((({structureId:e})=>e===o.structureId));a=t?.matchUpType||e?.matchUpType||s?.eventType!==_u&&s?.eventType}const{milliseconds:c,time:u}=Eu({matchUp:o}),{startTime:d}=function({matchUp:e}){const t=e=>e.createdAt?new Date(e.createdAt).getTime():0,n=(e?.timeItems||[]).reduce(((e,n)=>{const r=n.itemType===ru&&n;return r&&(!e||t(r)<t(e))?r:e}),void 0),r=n?.itemValue;return{startTime:r}}({matchUp:o}),{endTime:p}=function({matchUp:e}){const t=e=>e.createdAt?new Date(e.createdAt).getTime():0,n=(e?.timeItems||[]).reduce(((e,n)=>{const r=n.itemType===ou&&n;return r&&(!e||t(r)>t(e))?r:e}),void 0),r=n?.itemValue;return{endTime:r}}({matchUp:o});let l;const{visibilityThreshold:m,eventIds:f,drawIds:h}=e??{};if(f&&!f.includes(o.eventId)||h&&!h.includes(o.drawId))l=pi({time:u,startTime:d,endTime:p,milliseconds:c});else{const e={matchUp:o,visibilityThreshold:m},{allocatedCourts:s}=Ru(e),{scheduledTime:f}=Tu(e);let{scheduledDate:h}=Du(e);const{venueId:I}=Nu(e),{courtId:g}=bu(e),{courtOrder:U}=function({visibilityThreshold:e,timeStamp:t,schedule:n,matchUp:r}){const{itemValue:i,timeStamp:a}=Pu({timeItems:r?.timeItems||[],itemType:Zc,visibilityThreshold:e});return!n||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{courtOrder:i}:n}(e),{timeModifiers:y}=Mu(e);let v,S,w,P,T;const D=o.matchUpType??a;if(r&&f&&t&&D){const e={matchUpFormat:o.matchUpFormat??i,...r};({averageMinutes:S=0,recoveryMinutes:w=0,typeChangeRecoveryMinutes:P=0}=zs({timingDetails:e,eventType:D})),(S||w)&&(v=p?Zr($r(p),w):Zr(f,S+w)),P&&(T=p?Zr($r(p),P):Zr(f,S+P))}!h&&f&&(h=Wr(f));const R=Ar({scheduledDate:h,scheduledTime:f}),b={},N=(n&&I&&zc({tournamentRecord:n,venueId:I}))?.venueData||{};I&&(b[I]=N);const{venueName:M,venueAbbreviation:A,courtsInfo:E}=N,C=g&&E?.find((e=>e.courtId===g)),O=C?.courtName;for(const t of s||[]){if(!n)break;t.venueId&&!b[t.venueid]&&(b[t.venueId]=zc({venueId:t.venueId,tournamentRecord:n})?.venueData);const e=b[t.venueId];t.venueName=e?.venueName;const r=e?.courtsInfo?.find((e=>e.courtId===t.courtId));t.courtName=r?.courtName}l=pi({typeChangeTimeAfterRecovery:T,timeAfterRecovery:v,scheduledDate:h,scheduledTime:f,isoDateString:R,allocatedCourts:s,timeModifiers:y,venueAbbreviation:A,venueName:M,venueId:I,courtOrder:U,courtName:O,courtId:g,typeChangeRecoveryMinutes:P,recoveryMinutes:w,averageMinutes:S,milliseconds:c,startTime:d,endTime:p,time:u})}const I=o.matchUpStatus&&Ca.includes(o.matchUpStatus),{scheduledDate:g}=Du({matchUp:o}),{scheduledTime:U}=Tu({matchUp:o});return{schedule:l,endDate:I&&(Wr(p)||Wr(g)||Wr(U))||void 0}}function ju({collectionPosition:e,collectionId:t,lineUp:n}){let r=[];const i=[];if(n){const a=e=>void 0===e?-1:e,o=n.map((n=>{const{collectionAssignments:r,participantId:i}=n,a=r?.find((n=>n.collectionPosition===e&&n.collectionId===t));return a&&{participantId:i,...a}})).filter(Boolean).sort(((e,t)=>a(e.substitutionOrder)-a(t.substitutionOrder)));for(const e of o){const{participantId:t,previousParticipantId:n,substitutionOrder:a}=e;r.includes(t)||(n&&i.push({previousParticipantId:n,substitutionOrder:a,participantId:t}),r=r.filter((e=>e!==n)),r.push(t))}}return{assignedParticipantIds:r,substitutions:i}}const Gu="SIGN_IN_STATUS",qu=Xi.Individual,$u=Xi.Group,Wu=Xi.Pair,Hu=Xi.Team,zu=Xi.Team,Yu="SIGNED_IN",Ku="SIGNED_OUT",Qu={TEAM_PARTICIPANT:zu,INDIVIDUAL:qu,GROUP:$u,TEAM:Hu,PAIR:Wu},Ju={INDIVIDUAL:qu,GROUP:$u,PAIR:Wu,TEAM:Hu,SIGN_IN_STATUS:Gu,SIGNED_OUT:Ku,SIGNED_IN:Yu};function Xu({tournamentParticipants:e,tournamentRecord:t,participantIds:n}){const r="getPairedParticipant";if(!e&&!t)return{error:$};if(!Array.isArray(n)||n.length>2)return{error:Ct};if(!n.length)return Mi({result:{error:Gt},stack:r});const i=(e=e??t?.participants??[]).filter((e=>e.participantType===Wu&&O(n,e.individualParticipantIds).length===n.length&&e.individualParticipantIds.length===n.length)),a=i[0];if(!a)return Mi({result:{error:Bt},stack:r});const o=ii(i.slice(1),!1,!0);return{participant:ii(a),duplicatedPairParticipants:o,...L}}function Zu({drawDefinition:e,participantId:t}){if("object"!=typeof e)return{error:Y};if("string"!=typeof t)return{error:Lt};const{extension:n}=Ms({element:e,name:_o});return{lineUp:(n?.value||{})[t]}}function ed({matchUps:e=[],interpolate:t}){if(!La(e))return{roundMatchUps:[],error:xn};const n=e.reduce(((e,t)=>{const n="string"==typeof t.roundNumber?m(t.roundNumber):t.roundNumber;return!t.roundNumber||e.includes(n)?e:e.concat(n)}),[]).sort(l).map((t=>{const n=e.filter((e=>e.roundNumber===t)),r=n.find((({matchUpType:e})=>e===ji))?n.filter((({matchUpType:e})=>e===ji)):n;return{[t]:(i=r,i.sort(((e,t)=>l(e.roundPosition,t.roundPosition))))};var i})),r=e.reduce(((e,t)=>{const n="string"==typeof t.roundNumber?m(t.roundNumber):t.roundNumber;return e[n]||(e[n]=pi({abbreviatedRoundName:t.abbreviatedRoundName,finishingRound:t.finishingRound,roundName:t.roundName})),e}),{}),i=Object.assign({},...n);if(t){const e=Math.max(...Object.keys(i).map((e=>m(e))).filter((e=>!isNaN(e)))),t=i[e]?.length;if(t>1&&f(t)){const n=e+1;E(n,n+t/2).forEach(((e,n)=>{i[e]=E(0,t/(2+2*n)).map((()=>({})))}))}}let a=0;const o=Object.assign({},...Object.keys(i).map((e=>{const t=i[e]?.length,n=i[e]?.filter((e=>!Ca.includes(e.matchUpStatus)&&!e.score?.scoreStringSide1))?.length,r=t&&t===n;return a=Math.max(a,t),{[e]:{matchUpsCount:t,inactiveCount:n,inactiveRound:r}}})));let s=0,c=0;const u=Object.keys(i).map((e=>m(e))).filter((e=>!isNaN(e)));u.forEach((e=>{const t=i[e].sort(((e,t)=>e.roundPosition-t.roundPosition)),n=t.map((e=>e?.drawPositions||[])).flat();if(o[e].roundNumber=e,o[e].roundFactor=o[e].matchUpsCount?a/o[e].matchUpsCount:1,o[e].finishingRound=r[e]?.finishingRound,o[e].roundName=r[e]?.roundName,o[e].abbreviatedRoundName=r[e]?.abbreviatedRoundName,o[e].finishingPositionRange=i[e]?.[0]?.finishingPositionRange,1!==e&&o[e-1]){const n=o[e-1],r=n.drawPositions,i=n.matchUpsCount/o[e].matchUpsCount,a=x(r,i),s=t.map((t=>{const{roundPosition:n}=t,i=[...t.drawPositions||[],void 0,void 0].slice(0,2);if(!n)return i;const o=i?.filter(Boolean)||[];if(!o?.length)return[void 0,void 0];if(e<3&&2===o?.length)return i?.slice().sort(l);const s=O(r,o).length!==o?.length;if(o?.length&&s)return 1===o?.length?[o[0],void 0]:i?.slice().sort(l);const c=2*(n-1);return a.slice(c,c+2).map((e=>o?.find((t=>e.includes(t)))))}));o[e].drawPositions=s?.flat(),o[e].pairedDrawPositions=s}else{const t=n.sort(l),r=x(t,2);o[e].drawPositions=t,o[e].pairedDrawPositions=r}o[e+1]&&o[e+1].matchUpsCount===o[e].matchUpsCount&&(o[e+1].feedRound=!0,o[e+1].feedRoundIndex=c,o[e].preFeedRound=!0,c+=1),o[e]&&!o[e].feedRound&&(o[e].roundIndex=s,s+=1)}));const d=!!Object.values(o).find((({matchUpsCount:e})=>!f(e)));return{hasNoRoundPositions:e.some((e=>!e.roundPosition)),roundsNotPowerOf2:d,maxMatchUpsCount:a,roundMatchUps:i,roundNumbers:u,roundProfile:o}}function td(e){const t=e?.matchUp;let n=t?.matchUpType;if(!n&&t.sides?.length){const e=t.sides.find((({participant:e})=>e)),r=e?.participant,i=r?.participantType;n=i===qu&&_i||i===Wu&&Bi||i===Hu&&Hu||void 0}return{matchUpType:n}}const nd="MAIN",rd="QUALIFYING",id="CONSOLATION",ad="VOLUNTARY_CONSOLATION",od="PLAY_OFF",sd=[nd,rd,id,od,ad],cd={[rd]:1,[nd]:2,[od]:3,[id]:3,[ad]:4},ud="finishingPositions",dd="aggregateEventStructures",pd={[nd]:1,[od]:2,[id]:3,[rd]:4,[ad]:5},ld={[od]:1,[nd]:2,[id]:3,[rd]:4,[ad]:5},md="CLUSTER",fd="WATERFALL",hd="ITEM",Id="CONTAINER",gd="DRAW",Ud="RANDOM",yd="TOP_DOWN",vd="BOTTOM_UP",Sd="POSITION",wd="WINNER",Pd="LOSER",Td="FIRST_MATCHUP",Dd="AD_HOC",Rd="FEED_IN",bd="COMPASS",Nd="OLYMPIC",Md="SINGLE_ELIMINATION",Ad="DOUBLE_ELIMINATION",Ed="FIRST_MATCH_LOSER_CONSOLATION",Cd="FIRST_ROUND_LOSER_CONSOLATION",Od="LUCKY_DRAW",Fd="CURTIS_CONSOLATION",kd="CURTIS_CONSOLATION",xd="FEED_IN_CHAMPIONSHIP_TO_SF",_d="FEED_IN_CHAMPIONSHIP_TO_SF",Ld="FEED_IN_CHAMPIONSHIP_TO_QF",Bd="FEED_IN_CHAMPIONSHIP_TO_QF",Vd="FEED_IN_CHAMPIONSHIP_TO_R16",jd="FEED_IN_CHAMPIONSHIP_TO_R16",Gd="MODIFIED_FEED_IN_CHAMPIONSHIP",qd="MODIFIED_FEED_IN_CHAMPIONSHIP",$d="FEED_IN_CHAMPIONSHIP",Wd="ROUND_ROBIN",Hd="ROUND_ROBIN_WITH_PLAYOFF",zd="DECIDER",Yd="BACKDRAW",Kd={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Qd={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Jd="WIN_RATIO",Xd="ROUND_OUTCOME",Zd=[bd,Fd,Bd,jd,_d,$d,Ld,Vd,xd,Ed,Cd,Od,qd,Nd,od,Hd],ep={MAIN:nd,QUALIFYING:rd,CONSOLATION:id,ITEM:hd,CONTAINER:Id,FIRST_MATCHUP:Td,WINNER:wd,LOSER:Pd,AD_HOC:Dd,FEED_IN:Rd,FLEX_ROUNDS:"AD_HOC",COMPASS:bd,PLAY_OFF:od,OLYMPIC:Nd,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:Md,DOUBLE_ELIMINATION:Ad,CURTIS:Fd,FICSF:xd,FICQF:Ld,FICR16:Vd,MFIC:Gd,VOLUNTARY_CONSOLATION:ad,FIRST_MATCH_LOSER_CONSOLATION:Ed,FIRST_ROUND_LOSER_CONSOLATION:Cd,MODIFIED_FEED_IN_CHAMPIONSHIP:qd,FEED_IN_CHAMPIONSHIP_TO_R16:jd,FEED_IN_CHAMPIONSHIP_TO_QF:Bd,FEED_IN_CHAMPIONSHIP_TO_SF:_d,FEED_IN_CHAMPIONSHIP:$d,LUCKY_DRAW:Od,ROUND_ROBIN_WITH_PLAYOFF:Hd,ROUND_ROBIN:Wd,DECIDER:zd,BACKDRAW:Yd,COMPASS_ATTRIBUTES:Kd,OLYMPIC_ATTRIBUTES:Qd,DRAW:gd,RANDOM:Ud,TOP_DOWN:yd,BOTTOM_UP:vd,WATERFALL:fd,WIN_RATIO:Jd,ROUND_OUTCOME:Xd,MULTI_STRUCTURE_DRAWS:Zd,generatedDrawTypes:[Dd,bd,Fd,Ad,Bd,jd,_d,$d,Rd,Ed,Cd,Od,qd,Nd,od,Wd,Hd,Md],stageOrder:cd,finishOrder:pd,AGGREGATE_EVENT_STRUCTURES:dd,FINISHING_POSITIONS:ud};function tp(e,t,n){const r=e=>Ms({element:e,name:qo})?.extension?.value,i=n?.deprioritizeCompleted,a=n?.mode===dd&&ld,o=n?.mode===ud&&pd,s=o||a||cd,c=e=>(e=>e?.stage===nd&&1===e?.stageSequence)(e)?-1:s[e?.stage],u=e=>e?.matchUps.every((({matchUpStatus:e})=>Ca.includes(e)?1:-1));return i&&u(e)-u(t)||a&&c(e)-c(t)||(e?.stage&&s[e.stage]||0)-(t?.stage&&s[t.stage]||0)||(r(e)||0)-(r(t)||0)||!o&&!a&&(t?.positionAssignments?.length??1/0)-(e?.positionAssignments?.length??1/0)||(e?.stageSequence??0)-(t?.stageSequence??0)||(np(e)||0)-(np(t)||0)}function np(e){return(e?.matchUps||[]).reduce(((e,t)=>{const n=(t.finishingPositionRange?.winner||[]).reduce(((e,t)=>e+t),0);return!e||n<e?n:e}),void 0)}function rp({drawDefinition:e,structureId:t}){if(!e)return{error:Y};if(!t)return{error:Te};const{structures:n}=ip({drawDefinition:e}),r=n?.map((e=>e.structures?[...e.structures].concat(e):e)).flat(),i=r?.find((e=>e.structureId===t));if(!i)return{error:De};return{structure:i,containingStructure:i.structureType===hd?r?.find((e=>e.structures?.some((e=>e.structureId===t)))):void 0}}function ip({withStageGrouping:e,drawDefinition:t,stageSequences:n,stageSequence:r,roundTarget:i,sortConfig:a,stages:o,stage:s}){const c=!t&&Y||!t?.structures&&Re||void 0;if(c)return{error:c,structures:[],stageStructures:{}};const u=t?.structures?.filter((function(e){return!s&&!Array.isArray(o)||s&&e.stage===s||Array.isArray(o)&&o.includes(e.stage)})).filter((function(e){return!r&&!Array.isArray(n)||r&&e.stageSequence===r||Array.isArray(n)&&n.includes(e.stageSequence)})).filter((e=>{const t=Ms({element:e,name:qo})?.extension?.value;return!i||i===t})).sort(((e,t)=>tp(e,t,a)))??[],d=e?Object.assign({},...sd.map((e=>{const t=u?.filter((t=>t.stage===e));return t?.length&&{[e]:t}})).filter(Boolean)):{};return{structures:u,stageStructures:d}}function ap({drawDefinition:e}){if(!e)return{error:Y};const t={};return{allPositionedParticipantIds:(e.structures||[]).map((e=>{const n=e.stage;t[n]||(t[n]=[]);const{positionAssignments:r}=op({structure:e}),i=r?.map(di("participantId")).filter(Boolean)??[];return t[n].push(...i),i})).flat(),stagePositionedParticipantIds:t}}function op({drawDefinition:e,structureId:t,structure:n}){let r,i=[];if(!n){if(!e)return{positionAssignments:i,error:Y};if(({structure:n,error:r}=rp({drawDefinition:e,structureId:t})),r)return{positionAssignments:i,error:r}}return n.structures?i=[].concat(...n.structures.map((e=>op({structure:e}).positionAssignments))):n.positionAssignments?i=n.positionAssignments:r=Be,{positionAssignments:i,error:r}}function sp({drawDefinition:e,structureId:t,structure:n}){const r=op({drawDefinition:e,structureId:t,structure:n})?.positionAssignments||[],i=r?.filter((e=>e.participantId??e.bye??e.qualifier)),a=r&&r?.length===i?.length,o=r?.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)),s=r?.filter((e=>!e.participantId&&e.bye)),c=r?.filter((e=>!e.participantId&&e.qualifier));return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:o,assignedPositions:i,qualifierPositions:c,byePositions:s}}function cp({drawDefinition:e,attributes:t}){let{extension:n}=Cs({name:Fo,drawDefinition:e});const r=n?.value||{};return t.forEach((e=>{Object.keys(e).forEach((t=>{r[t]?Object.assign(r[t],e[t]):r[t]=e[t]}))})),n={name:Fo,value:r},nc({drawDefinition:e,extension:n}),{entryProfile:r}}function up({drawDefinition:e}){const{extension:t}=Cs({name:Fo,drawDefinition:e});return{entryProfile:t?.value||{}}}const dp=Wi.Alternate,pp=Wi.Confirmed,lp=Wi.DirectAcceptance,mp=Wi.FeedIn,fp=Wi.JuniorExempt,hp=Wi.LuckyLoser,Ip=Wi.OrganiserAcceptance,gp=Wi.Qualifier,Up=Wi.Registered,yp=Wi.SpecialExempt,vp=Wi.Ungrouped,Sp=Wi.Unpaired,wp=Wi.Wildcard,Pp=Wi.Withdrawn,Tp=[pp,lp,fp,Ip,yp],Dp=[mp,hp,gp],Rp=[pp,lp,mp,fp,Ip,yp,wp],bp=[pp,lp,fp,hp,gp,Ip,yp,wp],Np=[dp,pp,lp,mp,fp,hp,Ip,gp,Up,yp,vp,Sp,wp,Pp],Mp=bp,Ap={ALTERNATE:dp,CONFIRMED:pp,DIRECT_ACCEPTANCE:lp,DIRECT_ENTRY_STATUSES:Rp,DRAW_SPECIFIC_STATUSES:Dp,EQUIVALENT_ACCEPTANCE_STATUSES:Tp,FEED_IN:mp,JUNIOR_EXEMPT:fp,LUCKY_LOSER:hp,ORGANISER_ACCEPTANCE:Ip,QUALIFIER:gp,SPECIAL_EXEMPT:yp,STRUCTURE_ENTERED_TYPES:Mp,STRUCTURE_SELECTED_STATUSES:bp,UNGROUPED:vp,UNPAIRED:Sp,VALID_ENTERED_TYPES:Np,VALID_ENTRY_STATUSES:Np,WILDCARD:wp,WITHDRAWN:Pp};function Ep({stage:e,drawDefinition:t}){const{entryProfile:n}=up({drawDefinition:t}),r=Object.keys(n).includes(e);if(!r&&sd.includes(e)){return cp({drawDefinition:t,attributes:[{[e]:{drawSize:void 0,alternates:!0}}]}),!0}return r}function Cp({stage:e,drawDefinition:t,entryStatus:n}){return t.entries.reduce(((t,r)=>r.entryStage===e&&r.entryStatus===n?t+1:t),0)}function Op({provisionalPositioning:e,placementGroup:t,drawDefinition:n,stageSequence:r,entryStatuses:i,structureId:a,roundTarget:o,stages:s,stage:c}){const u=n.entries?.reduce(((e,t)=>{const n=Ms({name:qo,element:t})?.extension?.value,a=c&&t.entryStage===c||s?.length&&t.entryStage&&s.includes(t.entryStage),u=!i||t.entryStatus&&i.includes(t.entryStatus),d=t.entryStageSequence??1;return a&&(!r||d===r)&&u&&(!o||!n||o===n)?e.concat(t):e}),[])??[];if(a&&c===od){const{playoffEntries:r,error:i}=function({provisionalPositioning:e,drawDefinition:t,structureId:n}){const r=[],i=(t.links??[]).find((e=>e.linkType===Sd&&e.target.structureId===n));if(i){const{finishingPositions:n,structureId:a}=i.source,{structure:o}=rp({drawDefinition:t,structureId:a});if(o?.structureType===Id){(o.structures??[]).forEach((t=>{const i=t.positionAssignments??[],{structureId:a}=t,o=a,s=Object.assign({},...i.map((e=>{const{participantId:t}=e,n=Ms({element:e,name:Yo}).extension?.value;return n&&t?{[t]:n}:void 0})).filter(Boolean)),c=Object.keys(s).reduce(((t,n)=>{const r=s[n],i=r.groupOrder||e&&r.provisionalOrder;return t.includes(i)||t.push(i),t}),[]),u=c.length===Object.keys(s).length,d=Object.keys(s).filter((t=>{const r=s[t],i=r.groupOrder||e&&r.provisionalOrder;return n?.includes(i)}));e&&!u||d.forEach((t=>{const i=s[t],{groupOrder:a,provisionalOrder:c,GEMscore:u}=i,d=a||e&&c,p=(n??[]).sort(l).indexOf(d)+1;r.push({entryStage:od,entryStatus:mp,placementGroup:p,groupingValue:o,participantId:t,GEMscore:u})}))}))}}return{playoffEntries:r}}({provisionalPositioning:e,drawDefinition:n,structureId:a});return i&&console.log("playoff entries error"),(r?.length?r:u).filter((e=>!t||e.placementGroup===t))}return u}function Fp({stage:e,drawDefinition:t}){return Rp.reduce(((n,r)=>(Cp({drawDefinition:t,entryStatus:r,stage:e})||0)+n),0)}function kp({provisionalPositioning:e,returnAllProxies:t,drawDefinition:n,structureId:r,structure:i}){let a,o=[];i||({structure:i,error:a}=rp({drawDefinition:n,structureId:r}));const s=op({structure:i}).positionAssignments;if(a||!i)return{seedAssignments:[],error:De};r||(r=i.structureId);const{stage:c,stageSequence:u}=i,d=c===od&&n&&Op({provisionalPositioning:e,drawDefinition:n,stageSequence:u,structureId:r,stage:c}),p=d?d.filter((e=>1===e.placementGroup)).sort(((e,t)=>(e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore&&-1)||0)).map(((e,t)=>{const n=t+1;return{participantId:e.participantId,seedValue:n,seedProxy:!0,seedNumber:n}})):[],l=p?.slice(0,t?p.length:s.length/2);l.length?o=l:i.seedAssignments?o=i.seedAssignments:a=ye;return{seedAssignments:o,stageSequence:u,seedLimit:i.seedLimit||i?.positionAssignments?.length,stage:c,error:a}}function xp({drawDefinition:e}){if("object"!=typeof e)return{error:z};const t={},{structures:n=[],links:r=[]}=e||{},i=n.reduce(((e,t)=>{const{stage:n}=t;return e[n]?e[n].push(t):e[n]=[t],e}),{});for(const o of Object.keys(i)){const e=i[o].find((({stageSequence:e})=>1===e));if(!e)continue;const{structureId:n}=e;a({aggregator:{},targetRound:0,exitProfiles:t,exitProfile:"0",structureId:n,stage:o})}return{exitProfiles:t};function a({exitProfiles:e,exitProfile:t,structureId:i,targetRound:o,aggregator:s,stage:c}){e[i]||(e[i]=[]),"0"===t&&[id,od].includes(c)||e[i].push(t);const u=r.filter((e=>e.source.structureId===i&&e.source.roundNumber>=o));for(const r of u){const i=r.source.roundNumber,o=r.target.roundNumber,c=r.target.structureId,u=n.find((e=>e.structureId===c)).stage,d=[u,c,o,i].join("|");if(s[d])return;s[d]=!0,a({exitProfile:`${t}-${i}`,structureId:c,exitProfiles:e,targetRound:o,aggregator:s,stage:u})}}}function _p({drawDefinition:e,structure:t}){const n={},r=[];return(e?.structures??[t]).filter((e=>e&&"object"==typeof e)).forEach((e=>{if(!e)return;const{structureId:t,matchUps:i,structures:a}=e,o=Array.isArray(a);if(o)o&&a.forEach((e=>{const{structureName:i}=e,a=e.matchUps;n[e.structureId]={matchUps:a,itemStructureIds:[],structureName:i},a&&(r.push(...a),a.forEach((e=>{e.tieMatchUps&&r.push(...e.tieMatchUps)}))),n[t]||(n[t]={itemStructureIds:[],matchUps:[]}),n[t].itemStructureIds||(n[t].itemStructureIds=[]),n[t].itemStructureIds.push(e.structureId)}));else{const e=i;n[t]={matchUps:e,itemStructureIds:[]},e?.forEach((e=>{r.push(e),e.tieMatchUps&&r.push(...e.tieMatchUps)}))}})),{mappedMatchUps:n,drawMatchUps:r}}function Lp({mappedMatchUps:e,matchUpsMap:t,structureId:n,inContext:r}){const i=(e=t?.mappedMatchUps??e)[n],a=(i?.itemStructureIds||[]).map((t=>{const{matchUps:i,structureName:a}=e[t];return r?i.map((e=>Object.assign(ii(e,!0,!0),{containerStructureId:n,structureId:t,structureName:a}))):i})).flat();return(i?.matchUps||[]).concat(...a)}function Bp({groupedOrder:e,roundPositionsCount:t}){if(!e||e?.length<=t)return e;const n=x(e,e.length/t).map((e=>e.reduce(((e,t)=>e+t)))),r=n.slice().sort(l);return n.map((e=>r.indexOf(e)+1))}function Vp(e){if(!Array.isArray(e))return"";const t=e.filter(U);if(!t.length)return"";return P([Math.min(...t),Math.max(...t)]).join("-")}function jp({drawPositions:e,roundProfile:t,roundNumber:n}){const r=[void 0,void 0];if(e.reduce(((e,t)=>isNaN(parseInt(t))&&e),!0))return{orderedDrawPositions:r,displayOrder:r};const i=t?.[n],a=i?.pairedDrawPositions,o=a?.find((t=>k(t||[],e.filter(Boolean))))??r,s=i?.feedRound;if(function(e){return e.reduce(((e,t)=>!isNaN(parseInt(t))&&e),!0)}(e)){const t=[...e].sort(l);return{orderedDrawPositions:2===t.length?t:o,displayOrder:s?t:o}}if(s){const t=[e.find((e=>!isNaN(m(e)))),void 0];return{orderedDrawPositions:t,displayOrder:t}}return{orderedDrawPositions:o,displayOrder:o}}function Gp({matchUp:e}){let t,n=[],r=[],i=[],a=[];if(e||(t=et),e&&!e.sides&&(t=tt),e&&!e.hasContext&&(t=Tn),!t){a=e.sides.map((e=>e.participantId));const t=e.sides.filter((e=>e.participantType===qu)).map((e=>e.participantId)).filter(Boolean);n=e.sides.map((e=>e.participant?.individualParticipants)).filter(Boolean).map((e=>e.map((e=>e?.participantId)).filter(Boolean))),i=[...t,...n.flat()].filter(Boolean),r=P(i.concat(a)).filter(Boolean)}return{nestedIndividualParticipantIds:n,allRelevantParticipantIds:r,individualParticipantIds:i,sideParticipantIds:a,error:t}}function qp({matchUp:e}){if(!e)return{error:et};if(!e.hasContext)return{error:Tn};if(!e.sides||2!==e.sides.filter(Boolean).length)return{error:tt};const{nestedIndividualParticipantIds:t,allRelevantParticipantIds:n,sideParticipantIds:r}=Gp({matchUp:e}),i=(e.timeItems||[]).filter((e=>[Yc,Kc].includes(e?.itemType))).sort(((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime())),a=i.map((e=>e.itemValue)).filter((e=>i.filter((t=>t?.itemValue===e)).reverse()[0].itemType===Yc));t?.forEach(((e,t)=>{const n=r[t],i=e?.length&&e.every((e=>a.includes(e)));n&&i&&!a.includes(n)&&a.push(n)})),r.forEach(((e,n)=>{a.includes(e)&&(t?.[n]||[]).forEach((e=>{e&&!a.includes(e)&&a.push(e)}))}));return{allParticipantsCheckedIn:r.reduce(((e,t)=>a.includes(t)&&e),!0),checkedInParticipantIds:a,allRelevantParticipantIds:n}}function $p(e){const{matchUps:t,isCollectionMatchUp:n,excludeMatchUpStatuses:r,matchUpStatuses:i,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:l,roundNames:m,stageSequences:f,scheduledDates:h,scheduledDate:I,participantIds:g,processContext:U,tournamentIds:y,matchUpTypes:v,structureIds:S,readyToScore:w,courtIds:P,eventIds:T,venueIds:D,drawIds:R,stages:b,filterMatchUpIds:N=!0,filterMatchUpTypes:M=!0}=e,A=Array.isArray(g)?g.filter(Boolean):[],E=Array.isArray(i)?i.filter(Boolean):[],C=Array.isArray(r)?r.filter(Boolean):[],O=Array.isArray(b)?b.filter(Boolean):[],F=Array.isArray(f)?f.filter(Boolean):[],k=Array.isArray(u)?u.filter(Boolean):[],x=Array.isArray(m)?m.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],L=Array.isArray(s)?s.filter(Boolean):[],B=Array.isArray(l)&&N?l.filter(Boolean):[],V=Array.isArray(v)&&M?v.filter(Boolean):[],j=Array.isArray(P)?P.filter(Boolean):[],G=Array.isArray(D)?D.filter(Boolean):[],q=Array.isArray(o)&&o.filter(Boolean)||"string"==typeof c&&[c]||[],$=Array.isArray(h)&&h.filter(Boolean)||"string"==typeof I&&I.length&&[I]||[],W=Array.isArray(y)?y.filter(Boolean):[],H=Array.isArray(T)?T.filter(Boolean):[],z=Array.isArray(R)?R.filter(Boolean):[],Y=Array.isArray(S)?S.filter(Boolean):[];return t.filter((e=>{if(w&&e.matchUpType!==Vi&&!e.readyToScore)return!1;if(e.winningSide&&a&&![1,2].includes(e.winningSide))return!1;if(void 0!==d){if(d&&!e.tieMatchUps)return!1;if(!d&&e.tieMatchUps)return!1}if(void 0!==n){if(n&&!e.collectionId)return!1;if(!n&&e.collectionId)return!1}if(O.length&&!O.includes(e.stage))return!1;if(F.length&&!F.includes(e.stageSequence))return!1;if(k.length&&(!e.collectionId||!k.includes(e.collectionId)))return!1;if(x.length&&(!e.roundName||!x.includes(e.roundName)))return!1;if(_.length&&(!e.roundNumber||!_.includes(e.roundNumber)))return!1;if(L.length&&(!e.roundPosition||!L.includes(e.roundPosition)))return!1;if(E.length&&(!e.matchUpStatus||!E.includes(e.matchUpStatus)))return!1;if(C.length&&e.matchUpStatus&&C.includes(e.matchUpStatus))return!1;if(B.length&&!B.includes(e.matchUpId))return!1;if(V.length&&(!e.matchUpType||!V.includes(e.matchUpType)))return!1;if(q.length&&(!e.matchUpFormat||!q.includes(e.matchUpFormat)))return!1;if($?.length){const{scheduledTime:t}=Tu({matchUp:e}),{scheduledDate:n}=Du({matchUp:e}),r=Wr(t)||n;if(!$.find((e=>ni(e,r))))return!1}if(j.length){const{courtId:t}=bu({matchUp:e}),{allocatedCourts:n}=Ru({matchUp:e}),r=n?.map((({courtId:e})=>e));if(!j.filter(Boolean).includes(t)||r?.includes(t))return!1}if(G.length){const{venueId:t}=Nu({matchUp:e});if(!G.filter(Boolean).includes(t))return!1}if(U){if(W.length&&!W.includes(e.tournamentId))return!1;if(H.length&&!H.includes(e.eventId))return!1;if(z.length&&!z.includes(e.drawId))return!1;if(Y.length&&!Y.includes(e.structureId))return!1;if(A.length){const t=e.sides?.map((({participantId:e})=>e)).filter(Boolean)??[];if(!A.some((e=>t.includes(e))))return!1}}return!0}))}function Wp({roundsNotPowerOf2:e,drawDefinition:t,structure:n,matchUps:r}){if(!n)return!1;r=r??n.matchUps??[],e=e??ed({matchUps:r}).roundsNotPowerOf2;const i=!!n.positionAssignments?.find((({drawPosition:e})=>e))||!!r?.find((({drawPositions:e})=>e?.length));return(!t?.drawType||t.drawType!==Od)&&!n?.structures&&e&&i}function Hp({drawDefinition:e,structure:t}){if(!t)return!1;const n=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),r=n?.find((e=>e?.roundPosition)),i=n?.find((e=>e?.drawPositions?.length));return!(t?.structures||t?.stage===ad||e?.drawType&&e.drawType!==Dd||r||i)}const zp={[fo]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[nd]:"",[od]:"P",[rd]:"Q",[id]:"C"}}};function Yp({drawPositionCollectionAssignment:e,positionAssignments:t,displaySideNumber:n,seedAssignments:r,drawPosition:i,isFeedRound:a,sideNumber:o}){const s=t.find((e=>e.drawPosition&&e.drawPosition===i)),c=e?e[i]?.participantId:s?.participantId,u=s?function({displaySideNumber:e,seedAssignments:t,participantId:n,assignment:r,sideNumber:i}){const a={drawPosition:r.drawPosition,displaySideNumber:e,sideNumber:i};if(n){const e=function({seedAssignments:e,participantId:t}){return e?.find((e=>!e.seedProxy&&e.participantId===t))}({seedAssignments:t,participantId:n});Object.assign(a,e,{participantId:n})}else r.bye&&Object.assign(a,{bye:!0});r.qualifier&&Object.assign(a,{qualifier:!0});return a}({displaySideNumber:n,seedAssignments:r,participantId:c,assignment:s,sideNumber:o}):{};a&&(1===o?Object.assign(u,{participantFed:!0}):Object.assign(u,{participantAdvanced:!0}));const d=e?.[i]?.teamParticipant,p=e?.[i]?.participant,l=e?.[i]?.substitutions;return p&&Object.assign(u,{participant:p}),l&&Object.assign(u,{substitutions:l}),d&&Object.assign(u,{teamParticipant:d}),u}function Kp({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,provisionalPositioning:n,tournamentParticipants:r,afterRecoveryTimes:i,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:m,contextProfile:f,drawDefinition:h,context:I={},exitProfiles:g,matchUpsMap:U,structure:y,inContext:v,event:w}){let T={},D={};if(r=r??o?.participants,!y)return{collectionPositionMatchUps:T,error:be,roundMatchUps:D,matchUps:[]};const R=Array.isArray(d?.eventIds)?d?.eventIds.filter(Boolean):[],b=Array.isArray(d?.structureIds)?d?.structureIds.filter(Boolean):[],N=Array.isArray(d?.drawIds)?d?.drawIds.filter(Boolean):[],M=!I?.eventId||!R?.length&&!c?.eventIds?.filter(Boolean).length||R?.includes(I.eventId)||c?.eventIds?.includes(I.eventId),A=!b?.length||b.includes(y.structureId),C=!h||!N?.length||N.includes(h.drawId);if(!M||!A||!C)return{collectionPositionMatchUps:T,roundMatchUps:D,matchUps:[]};f&&!u&&(u=ss({tournamentRecord:o,contextProfile:f,drawDefinition:h}));const{appliedPolicies:O}=Xo({drawDefinition:h}),F={...t,...O,...a},k=F?.scoring?.structures,_=y.stage&&k?.stage&&k?.stage[y.stage],L=y.stageSequence&&_?.stageSequence&&_.stageSequence[y.stageSequence],B=F?.scoring?.requireAllPositionsAssigned||_?.requireAllPositionsAssigned||L?.requireAllPositionsAssigned;U||(U=_p({drawDefinition:h,structure:y}));const{positionAssignments:V,allPositionsAssigned:j}=sp({structure:y}),G=!B||j,{seedAssignments:q}=kp({provisionalPositioning:n,drawDefinition:h,structure:y});s=s??q;const{roundOffset:$,structureId:W,structureName:H,stage:z,stageSequence:K}=y,{drawId:Q,drawName:J,drawType:X}=h??{};g=g||h&&xp({drawDefinition:h}).exitProfiles;const Z=g?.[W],ee=Z?.length&&(Z[0].split("-").map((e=>parseInt(e))).reduce(((e,t)=>e+t))||0),te=!!y.structures;let ne=Lp({matchUpsMap:U,structureId:W,inContext:v});const re=F?.[fo],ie=function({roundNamingPolicy:e,drawDefinition:t,structure:n,matchUps:r}){const{roundProfile:i,roundMatchUps:a}=ed({matchUps:r}),{structureAbbreviation:o,stage:s}=n,c=Hp({structure:n}),u=Wp({structure:n}),d=n.structures,p={},l=zp[fo],m=n.stage===rd,f=m?Math.max(...(t?.structures??[]).filter((e=>e.stage===rd)).map((({stageSequence:e})=>e??1)),0):0,h=(n.stageSequence??1)<f?n.stageSequence??1:"",I=h&&(e?.affixes?.preQualifying||l.affixes.preQualifying)||"",g=e?.roundNamingMap||l.roundNamingMap||{},U=e?.abbreviatedRoundNamingMap||l.abbreviatedRoundNamingMap||{},y=e?.affixes?.preFeedRound||l.affixes.preFeedRound,v=e?.affixes?.roundNumber||l.affixes.roundNumber,S=(e?.namingConventions||l.namingConventions).round,w=s&&s!==nd?s[0]:"",P=e?.stageConstants||l.stageConstants,T=`${I}${s&&P?.[s]||w}${h}`,D=i?Object.keys(i):[],R=m&&P?.[rd]?`${P?.[rd]}-`:"";if(d||c||u)Object.assign(p,...D.map((e=>({[e]:{roundName:`${R}${S} ${e}`,abbreviatedRoundName:`${v}${e}`}}))));else{const t=m&&(e?.qualifyingFinishMap||l?.qualifyingFinishMap||{});Object.assign(p,...D.map((e=>{if(!i?.[e])return;const{matchUpsCount:n,preFeedRound:r}=i[e],a=2*n,s=t?.[i?.[e].finishingRound]||t&&`${v}${a}`||g[n]||`${v}${a}`,c=r?`-${y}`:"",u=[T,o,`${s}${c}`].filter(Boolean).join("-"),d=U[n]||`${v}${a}`;return{[e]:{abbreviatedRoundName:[T,o,`${d}${c}`].filter(Boolean).join("-"),roundName:u}}})))}return{roundNamingProfile:p,roundProfile:i,roundMatchUps:a}}({roundNamingPolicy:re,drawDefinition:h,structure:y,matchUps:ne}),{roundNamingProfile:ae,roundProfile:oe}=ie;if(D=ie?.roundMatchUps??[],d&&(ne=$p({matchUps:ne,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),v){const{sourceDrawPositionRanges:t}=function({drawDefinition:e,structureId:t,matchUpsMap:n}){if(!e)return{error:Y};if(!t)return{error:Te};const{structure:r}=rp({drawDefinition:e,structureId:t});if(r?.stage!==id)return{error:_e,info:"Structure is not CONSOLATION stage"};const{links:i}=e,a=i?.filter((e=>e.target.structureId===t))||[],o=a?.reduce(((e,t)=>{const{structureId:n}=t.source;return e.includes(n)?e:e.concat(n)}),[])||[],s=Object.assign({},...o.map((e=>({[e]:ed({matchUps:Lp({structureId:e,matchUpsMap:n})}).roundProfile})))),c=Lp({matchUpsMap:n,structureId:t}),{roundProfile:u}=ed({matchUps:c}),d={};return a?.forEach((e=>{const{structureId:t,roundNumber:n}=e.source,{feedProfile:r,groupedOrder:i,positionInterleave:a,roundNumber:o}=e.target,c=s[t],p=c[1]?.drawPositions,l=c[n],m=l?.matchUpsCount;if(!m)return;const f=m?p.length/m:0,h=p.length/f;let I=p.slice();const g=Bp({roundPositionsCount:I.length,groupedOrder:i}),U=g?.length||1;if(U<=h){const e=x(I,p.length/U);r===vd&&e.forEach((e=>e.reverse())),I=g?.length&&g?.map((t=>e[t-1])).flat()||I}let y=x(I,f);if(g?.length||r!==vd||y.reverse(),a){const e=E(0,a.interleave).map((()=>{})),t=E(0,a.offset).map((()=>{}));y=y.map((t=>[t,...e])),y.unshift(t),y=y.flat(1);const n=y.length-a.offset;y=y.slice(0,n)}d[o]||(d[o]={});const v=u?.[o],S=v?.feedRound?2:1;y.forEach(((e,t)=>{const n=1+t*S;d[o][n]||(d[o][n]=Vp(e))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:h,matchUpsMap:U,structureId:W}),n=h?function({drawDefinition:e,roundProfile:t,structureId:n,matchUpsMap:r}){if(!e)return{error:Y};if(!n)return{error:Te};if(!t){const e=Lp({matchUpsMap:r,structureId:n});if(({roundProfile:t}=ed({matchUps:e})),!t)return{error:mt}}const i=(Math.min(...t?.[1]?.drawPositions||[])||1)-1,a=Object.keys(t);return{drawPositionsRanges:Object.assign({},...(a||[]).map((e=>{const n=t?.[e]?.matchUpsCount,r=t?.[1]?.drawPositions||[],o=x(r,r.length/n),s=o.map(Vp),c=o.map((e=>e.map((e=>e-i)))).map(Vp),u=a.map((r=>{if(r>e)return;const i=t?.[r]?.drawPositions??[];return x(i,i.length/n)})).filter(Boolean),d=E(0,n).map((e=>u.map((t=>t[e])).flat().filter(Boolean).sort(l))).map((e=>P(e))),p=d.map((e=>{return(t=e,t.reduce(((e,t)=>{const n=e[e.length-1];return n&&n[n.length-1]===t-1||e.push([]),e[e.length-1].push(t),e}),[])).map(Vp).join(", ");var t})),m=Object.assign({},...E(0,n).map((e=>({[e+1]:{firstRoundDrawPositionsRange:s[e],firstRoundOffsetDrawPositionsRange:c[e],possibleDrawPositions:d[e],drawPositionsRange:p[e]}}))));return{[e]:m}})))}}({drawDefinition:h,roundProfile:oe,matchUpsMap:U,structureId:W}).drawPositionsRanges:void 0;ne=ne.map((r=>se({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,drawPositionsRanges:n,roundNamingProfile:ae,initialRoundOfPlay:ee,appliedPolicies:F,isRoundRobin:te,roundProfile:oe,matchUp:r,event:w})));const r=ne?.filter((e=>Array.isArray(e.tieMatchUps)));r.forEach((e=>{const t=e.tieMatchUps;ne=ne.concat(...t)})),c&&(ne=$p({processContext:!0,...c,matchUps:ne}))}else{const e=ne?.filter((e=>Array.isArray(e.tieMatchUps)));e.forEach((e=>{const t=e.tieMatchUps;ne=ne.concat(...t)}))}return d&&(ne=$p({matchUps:ne,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d?.matchUpTypes||d?.matchUpIds)&&(ne=$p({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:ne})),(d?.matchUpTypes||d?.matchUpIds||v)&&(D=ed({matchUps:ne}).roundMatchUps??[]),Ni({drawDefinition:h,structure:y,event:w})?.tieFormat&&({collectionPositionMatchUps:T}=function({matchUps:e}){const t=e.reduce(((e,t)=>!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition)),[]).map((t=>({[t]:e.filter((e=>e.collectionPosition===t))})));return{collectionPositionMatchUps:Object.assign({},...t)}}({matchUps:ne})),{collectionPositionMatchUps:T,roundMatchUps:D,roundProfile:oe,matchUpsMap:U,matchUps:ne};function se({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,drawPositionsRanges:n,initialRoundOfPlay:c,additionalContext:d,roundNamingProfile:l,tieDrawPositions:g,appliedPolicies:U,isCollectionBye:v,matchUpTieId:w,isRoundRobin:T,roundProfile:D,sideLineUps:R,matchUp:b,event:N}){d=d??{};const M=Ni({drawDefinition:h,structure:y,matchUp:b,event:N})?.tieFormat,A=M?.collectionDefinitions,E=b.collectionId&&A?.find((e=>e.collectionId===b.collectionId)),C=b.collectionId?E?.matchUpFormat:b.matchUpFormat??y?.matchUpFormat??h?.matchUpFormat??N?.matchUpFormat,O=b.matchUpType||E?.matchUpType||y?.matchUpType||h?.matchUpType||N?.eventType!==_u&&N?.eventType,F=v?ma:b.matchUpStatus,{schedule:k,endDate:x}=Vu({scheduleVisibilityFilters:e,afterRecoveryTimes:i,tournamentRecord:o,scheduleTiming:m,matchUpFormat:C,matchUpType:O,matchUp:b,event:N}),_=g??b.drawPositions??[],{collectionPosition:L,collectionId:B,roundPosition:j}=b,q=b.roundNumber??d.roundNumber,Y=B?function({tournamentParticipants:e,positionAssignments:t,collectionPosition:n,drawPositions:r=[],participantMap:i,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:c}){if(!o||!n)return;const u=r?.map((r=>{const u=t.find((e=>e.drawPosition===r))?.participantId,d=s?.find((e=>e?.drawPosition===r)),p=d?.teamParticipant||u&&i?.[u]?.participant||e?.find((({participantId:e})=>e===u)),l=d?.lineUp||Zu({participantId:u,drawDefinition:a})?.lineUp,{assignedParticipantIds:m,substitutions:f}=ju({collectionPosition:n,collectionId:o,lineUp:l});if(c!==Bi){const e=m?.[0];return e&&{[r]:{participantId:e,teamParticipant:p,substitutions:f}}}if(m?.length<=2){const t=i?.[m[0]]?.pairIdMap?.[m[1]],n=t&&i[t]?.participant||Xu({participantIds:m,tournamentParticipants:e}).participant,a=n?.participantId;return{[r]:{participantId:a,teamParticipant:p,substitutions:f}}}if(m?.length>2)return{[r]:{teamParticipant:p,substitutions:f}}})).filter(Boolean)||{};return Object.assign({},...u)}({tournamentParticipants:r,positionAssignments:V,collectionPosition:L,drawDefinition:h,participantMap:p,drawPositions:_,collectionId:B,sideLineUps:R,matchUpType:O}):void 0,Z=l?.[q]?.roundName||d.roundName,ee=l?.[q]?.abbreviatedRoundName||d.abbreviatedRoundName,te=D?.[q]?.feedRound,ne=D?.[q]?.preFeedRound,re=D?.[q]?.roundFactor,ie=n?.[q],ae=j?ie?.[j]:void 0,oe=t?.[q],ce=E?.category?{...I?.category||{},...E.category}:I?.category??N?.category,ue=b.processCodes?.length&&b.processCodes||E?.processCodes?.length&&E?.processCodes||y?.processCodes?.length&&y?.processCodes||h?.processCodes?.length&&h?.processCodes||N?.processCodes?.length&&N?.processCodes||o?.processCodes,de=f?.withCompetitiveness&&hs({...u,matchUp:b}),pe=b.finishingPositionRange??d.finishingPositionRange,le=e=>pi(e,void 0,!0),me={...le(I),...le({matchUpFormat:b.matchUpType===_u?void 0:C,tieFormat:b.matchUpType!==_u?void 0:M,gender:E?.gender??N?.gender,roundOfPlay:z!==rd&&S(c)&&c+(q||0),endDate:b.endDate??x,discipline:N?.discipline,category:ce,finishingPositionRange:pe,abbreviatedRoundName:ee,drawPositionsRange:ae,competitiveProfile:de,structureName:H,stageSequence:K,drawPositions:_,matchUpStatus:F,processCodes:ue,isRoundRobin:T,matchUpTieId:w,preFeedRound:ne,matchUpType:O,roundFactor:re,roundOffset:$,structureId:W,roundNumber:q,feedRound:te,roundName:Z,drawName:J,drawType:X,schedule:k,drawId:Q,stage:z}),...ii(le(b),!0,!0)};if(C&&b.score?.scoreStringSide1){const e=gi(C),{bestOf:t,finalSetFormat:n,setFormat:r}=e??{};(n?.tiebreakSet||r?.tiebreakSet||r?.timed)&&(me.score.sets=me.score.sets.sort(((e,t)=>e.setNumber-t.setNumber)).map(((e,i)=>(i+1===t?(n?.tiebreakSet||n?.timed)&&(e.tiebreakSet=!0):(r?.tiebreakSet||r?.timed)&&(e.tiebreakSet=!0),e))))}if(Array.isArray(_)){const{orderedDrawPositions:e,displayOrder:t}=jp({drawPositions:_,roundProfile:D,roundNumber:q}),n=D?.[q]?.feedRound,r=t[0]!==e[0],i=e.concat(void 0,void 0).slice(0,2).map(((e,t)=>{const i=t+1,a=Yp({drawPositionCollectionAssignment:Y,positionAssignments:V,displaySideNumber:r?3-i:i,seedAssignments:s,drawPosition:e,isFeedRound:n,sideNumber:i}),o=b.sides?.find((e=>e.sideNumber===i)),c=j?2*(j-1)+t+1:void 0;return le({sourceDrawPositionRange:c?oe?.[c]:void 0,...o,...a})}));Object.assign(me,ii({sides:i},!0,!0))}if(r&&me.sides){const e=a?.[ho],t=t=>{const n=p?.[t]?.participant;return n&&mi({template:e?.participant,source:n})};if(me.sides.filter(Boolean).forEach((e=>{if(e.participantId){const n=ii(t(e.participantId)||r&&Rs({policyDefinitions:U,participantId:e.participantId,tournamentParticipants:r,internalUse:!0,contextProfile:f}),void 0,!0);if(n){if(h?.entries){const t=h.entries.find((t=>t.participantId===e.participantId));t?.entryStatus&&(n.entryStatus=t.entryStatus),t?.entryStage&&(n.entryStage=t.entryStage)}Object.assign(e,{participant:n})}}if(e?.participant?.individualParticipantIds?.length&&!e.participant.individualParticipants?.length){const n=e.participant.individualParticipantIds.map((e=>t(e)||r&&Rs({policyDefinitions:U,tournamentParticipants:r,internalUse:!0,contextProfile:f,participantId:e})));Object.assign(e.participant,{individualParticipants:n})}})),!me.matchUpType){const{matchUpType:e}=td({matchUp:me});e&&Object.assign(me,{matchUpType:e})}if(f?.inferGender&&(!me.gender||me.gender===Ci)&&2===me.sides?.length&&me.matchUpType!==_u){const e=me.sides.map((e=>{if(me.matchUpType===_i)return e.participant?.person?.sex;if(2===e.participant?.individualParticipants?.length){const t=P(e.participant.individualParticipants.map((e=>e.person?.sex))).filter(Boolean);if(1===t.length)return t[0]}}));if(2===e.filter(Boolean).length&&1===P(e).length){const t=e[0];me.inferredGender=t}}}if(me.tieMatchUps){const r=me.matchUpStatus===ma,i=me.sides?.map((({participant:e,drawPosition:t,sideNumber:n,lineUp:r})=>{const i=e?.participantType===_u&&e;return{teamParticipant:i&&pi({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participanOthertName,participantName:i.participantName,participantId:i.participantId,teamId:i.teamId}),drawPosition:t,sideNumber:n,lineUp:r}}));me.tieMatchUps=me.tieMatchUps.map((a=>{const o=me.matchUpId,s=me.finishingPositionRange;return se({tieDrawPositions:_,scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,sideLineUps:i,drawPositionsRanges:n,initialRoundOfPlay:c,roundNamingProfile:l,additionalContext:{finishingPositionRange:s,abbreviatedRoundName:ee,roundNumber:q,roundName:Z},appliedPolicies:U,isCollectionBye:r,matchUpTieId:o,isRoundRobin:T,roundProfile:D,matchUp:a,event:N})}))}const fe=me.sides&&2===me.sides.filter((e=>e?.participantId)).length,he=!me.winningSide,Ie=G&&fe&&he;if(Object.assign(me,{readyToScore:Ie,hasContext:!0}),fe){const{allParticipantsCheckedIn:e,checkedInParticipantIds:t}=qp({matchUp:me});Object.assign(me,{allParticipantsCheckedIn:e,checkedInParticipantIds:t})}return Array.isArray(f?.exclude)&&f?.exclude.forEach((e=>delete me[e])),me}}function Qp({tournamentParticipants:e,afterRecoveryTimes:t,contextContent:n,contextProfile:r,drawDefinition:i,matchUpsMap:a,matchUpId:o,inContext:s,context:c,event:u}){if(!i)return{error:Y};if(!o)return{error:Qe};if("string"!=typeof o)return{error:xn};const{structures:d=[]}=ip({drawDefinition:i});r&&!n&&(n=ss({contextProfile:r,drawDefinition:i}));for(const p of d){const{matchUps:d}=Kp({tournamentParticipants:e,afterRecoveryTimes:t,contextContent:n,drawDefinition:i,contextProfile:r,matchUpsMap:a,inContext:s,structure:p,context:c,event:u}),{matchUp:l}=cs({matchUps:d,matchUpId:o});if(l)return{matchUp:l,structure:p}}return{error:Xe}}function Jp({collectionDefinition:e,groupValueNumbers:t,groupValueGroups:n,sideTieValues:r,tieMatchUps:i}){const a=i.filter((t=>t.collectionId===e.collectionId)),o=[0,0];let s=[0,0];const c=a.every((e=>Ca.includes(e.matchUpStatus))),{collectionValueProfiles:u,collectionGroupNumber:d,collectionValue:p,matchUpValue:l,winCriteria:m,scoreValue:f,setValue:h}=e,I=d&&t.includes(d),g=[0,0];if(a.forEach((e=>{e.winningSide&&(g[e.winningSide-1]+=1)})),S(l)?a.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=l)})):S(h)?a.forEach((e=>{e.score?.sets?.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=h)}))})):S(f)?a.forEach((e=>{e.score?.sets?.forEach((t=>{const{side1TiebreakScore:n=0,side2TiebreakScore:r=0,side1Score:i=0,side2Score:a=0}=t;(e.matchUpStatus===ha||e.winningSide||t.winningSide)&&(i||a?(o[0]+=i,o[1]+=a):(n||r)&&t.winningSide&&(o[t.winningSide-1]+=1))}))})):Array.isArray(u)&&a.forEach((t=>{if(t.winningSide){const n=t.collectionPosition,r=function({collectionDefinition:e,collectionPosition:t}){const n=e.collectionValueProfiles||[],r=n?.find((e=>e.collectionPosition===t));return r?.matchUpValue}({collectionDefinition:e,collectionPosition:n});S(r)&&(o[t.winningSide-1]+=r)}})),S(p)){let t;if(m?.aggregateValue)c&&(S(l||h||f)&&o[0]!==o[1]?t=o[0]>o[1]?1:2:g[0]!==g[1]&&(t=g[0]>g[1]?1:2));else if(m?.valueGoal)t=o.reduce(((e,t,n)=>t>=m.valueGoal?n+1:e),0);else{const n=Math.floor(e.matchUpCount/2)+1;t=g.reduce(((e,t,r)=>t>=n?r+1:e),0)}t&&(I?n[d].values[t-1]+=p:s[t-1]+=p)}else I?(n[d].values[0]+=o[0]||0,n[d].values[1]+=o[1]||0):s=o;I?(n[d].sideWins[0]+=g[0]||0,n[d].sideWins[1]+=g[1]||0,n[d].allGroupMatchUpsCompleted=n[d].allGroupMatchUpsCompleted&&c,n[d].matchUpsCount+=a.length):s.forEach(((e,t)=>r[t]+=e||0))}function Xp({collectionGroups:e=[]}){const t=Object.assign({},...e.filter((e=>S(e?.groupValue)&&e?.groupNumber)).map((e=>({[e.groupNumber]:{...e,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))));return{groupValueGroups:t,groupValueNumbers:Object.keys(t).map((e=>m(e)))}}function Zp(e){const{sideAdjustments:t=[0,0],separator:n="-",drawDefinition:r,matchUpsMap:i,structure:a,matchUp:o,event:s}=e;if(!Array.isArray(t)||2!==t.length||isNaN(t.reduce(((e,t)=>e+t))))return{error:xn};if(!o)return{error:et};const c=Ni({matchUp:o,drawDefinition:r,structure:a,event:s})?.tieFormat||e?.tieFormat;if(!c)return{error:Ke};const u=ca({tieFormat:c,eventType:s?.eventType});if(u.error)return u;const d=c?.collectionDefinitions||[],p=o?.tieMatchUps||[],l=[0,0],{groupValueGroups:m,groupValueNumbers:f}=Xp(c);for(const v of d)Jp({collectionDefinition:v,groupValueNumbers:f,groupValueGroups:m,sideTieValues:l,tieMatchUps:p});for(const v of f){const e=m[v],{allGroupMatchUpsCompleted:t,matchUpCount:n,winCriteria:r,groupValue:i,sideWins:a,values:o}=e;let s;if(r?.aggregateValue)t&&o[0]!==o[1]&&(s=o[0]>o[1]?1:2);else if(r?.valueGoal)s=o.reduce(((e,t,n)=>t>=r.valueGoal?n+1:e),void 0);else{const e=Math.floor(n/2)+1;s=a.reduce(((t,n,r)=>n>=e?r+1:t),void 0)}s&&(l[s-1]+=i||0)}const h=l.map(((e,n)=>(e||0)+t[n])),I={side1Score:h[0],side2Score:h[1],winningSide:void 0},g=h.join(n),U=h.slice().reverse().join(n);let y;if(c?.winCriteria){const{valueGoal:e,aggregateValue:t,tallyDirectives:n}=c.winCriteria;if(e){const t=h.map(((e,t)=>({sideNumber:t+1,points:e}))).find((({points:t})=>t>=e));y=t?.sideNumber}else if(t){p.every((e=>e.matchUpStatus&&Ca.includes(e.matchUpStatus)||e.winningSide))&&h[0]!==h[1]&&(y=h[0]>h[1]?1:2)}if(!y&&n){const e=o.matchUpId,t=o.hasContext?o:i?.drawMatchUps?.[e]||r&&Qp({inContext:!0,drawDefinition:r,matchUpId:e})?.matchUp;if(t){const{completedTieMatchUps:e,order:n}=Do({matchUps:[t]});if(e&&n?.length){const e=n[0].participantId;y=t.sides.find((({participantId:t})=>t===e))?.sideNumber}}}}return y&&(I.winningSide=y),{scoreStringSide1:g,scoreStringSide2:U,winningSide:y,set:I}}function el(e,t){if(!e)return{error:Y};let n=Date.now();e.updatedAt&&n===new Date(e.updatedAt).getTime()&&(n+=1);const r=new Date(n).toISOString(),i=t?.filter(Boolean);return e.updatedAt=r,e.structures?.filter(Boolean).forEach((e=>{i?.length&&!i?.includes(e.structureId)||(e.updatedAt=r)})),{...L}}function tl({drawDefinition:e,tournamentId:t,matchUps:n,eventId:r}){return e&&el(e),pr({payload:{matchUps:n,tournamentId:t,eventId:r},topic:hc}),{...L}}function nl({drawDefinition:e,tournamentId:t,matchUpIds:n,eventId:r,action:i}){e&&el(e),pr({topic:Pc,payload:{tournamentId:t,matchUpIds:n,eventId:r,action:i}});for(const a of n)mr({key:a});return{...L}}function rl({drawDefinition:e,tournamentId:t,structureId:n,context:r,eventId:i,matchUp:a}){if(!a)return console.log(et),{error:et};if(e){al({drawDefinition:e,structureIds:n?[n]:void 0,tournamentId:t,eventId:i})}return pr({topic:bc,payload:{matchUp:a,tournamentId:t,context:r},key:a.matchUpId}),{...L}}function il({tournamentId:e,eventId:t,drawDefinition:n}){return n?(el(n),pr({payload:{drawDefinition:n,tournamentId:e,eventId:t},topic:fc,key:n.drawId}),{...L}):(console.log(Y),{error:Y})}function al({drawDefinition:e,tournamentId:t,structureIds:n,eventId:r}){return e?(el(e,n),pr({payload:{tournamentId:t,eventId:r,drawDefinition:e},topic:Tc,key:e.drawId}),{...L}):{error:Y}}function ol({drawDefinition:e,tournamentId:t,structure:n,eventId:r}){if(!e)return{error:Y};if(!n)return{error:be};const i=n.seedAssignments,a=n.structureId;return pr({payload:{tournamentId:t,eventId:r,drawId:e.drawId,structureId:a,seedAssignments:i},topic:Ac,key:e.drawId}),al({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:r}),{...L}}function sl({drawDefinition:e,tournamentId:t,structure:n,event:r}){if(!e)return{error:Y};if(!n)return{error:be};const i=op({structure:n}),a=n.structureId,o=e.drawId,s=r?.eventId;return pr({topic:Mc,payload:{positionAssignments:i,tournamentId:t,structureId:a,eventId:s,drawId:o},key:a}),al({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:s}),{...L}}function cl({inContextDualMatchUp:e,drawDefinition:t,tournamentId:n,dualMatchUp:r,eventId:i}){if(r){e||(e=Qp({matchUpId:r.matchUpId,inContext:!0,drawDefinition:t})?.matchUp);const{extension:a}=Ms({element:t,name:_o}),o=ii(a?.value||{},!1,!0),s=({displaySideNumber:e,drawPosition:t,sideNumber:n})=>({drawPosition:t,sideNumber:n,displaySideNumber:e});r.sides=e?.sides?.map((e=>{const t=e.participantId,n=t&&o[t]||void 0,{lineUp:i,...a}=r.sides?.find((({sideNumber:t})=>t===e.sideNumber))??{},c=i?.length?i:n;return{...s(e),...a,lineUp:c}})),rl({context:"ensureSidLineUps",matchUp:r,drawDefinition:t,tournamentId:n,eventId:i})}}function ul(e){if(e)return ii(e,!1,!0)}function dl(e){const t=e?.matchUp,n=e?.score||t?.score,r=n?.sets?.[0],{side1Score:i,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:c,side2PointScore:u}=r||{},d=i||a||o||s||c||u;return!!(n?.sets?.length>1||d)}function pl({matchUpStatus:e}){return Aa.includes(e)}function ll({matchUpStatus:e}){return Ea.includes(e)}function ml({matchUpStatus:e,winningSide:t,tieMatchUps:n,sides:r,score:i}){const a=r?.find((({participantId:e})=>e)),o=n?.filter(ml)?.length;return dl({score:i})||o||t&&a||e&&function({matchUpStatus:e}){return Oa.includes(e)}({matchUpStatus:e})&&![ga,Ra,va].includes(e)}function fl(e){return"object"!=typeof e?{error:mt}:"object"!=typeof e.element?{error:xn}:e.notes?"string"==typeof e.notes||e.notes?.testing?(Object.assign(e.element,{notes:e.notes}),{...L}):{error:xn}:{error:mt}}const hl=e=>e?.participantId;function Il({positionAssignments:e,tournamentRecord:t,drawDefinition:n,matchUpFormat:r,matchUps:i,event:a}){if(!La(i))return{error:xn};if(!e)return{error:xn};const{policyDefinitions:o}=Zo({policyTypes:[uo],tournamentRecord:t,drawDefinition:n,event:a}),{subOrderMap:s}=function({positionAssignments:e}){const t=(e||[]).filter(hl).map((e=>{const{extension:t}=Ms({element:e,name:zo}),n=m(t?.value),r=!isNaN(n)&&n;return r&&{participantId:e.participantId,subOrder:r}})).filter(Boolean),n=R(t.map((({subOrder:e})=>e)));return{subOrderMap:Object.assign({},...t.filter((({subOrder:e})=>1===n[e])).map((({participantId:e,subOrder:t})=>({[e]:t}))))}}({positionAssignments:e}),c=Do({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:i});if(c.error)return c;const{participantResults:u,bracketComplete:d,report:p}=c,l=Object.keys(u);return e.forEach((e=>{const{participantId:t}=e;if(l.includes(t)){Js({element:e,extension:{value:u[t],name:Yo}}),u[t].ties||ec({element:e,name:zo})}else ec({element:e,name:Yo}),ec({element:e,name:zo})})),al({drawDefinition:n}),{...L,participantResults:u,bracketComplete:d,report:p}}function gl({participantsProfile:e,participants:t=[],deepCopy:n}){const r=new Map,i=!1!==n?ii(t,e?.convertExtensions,!0):t,a=i.filter((e=>e.participantType===Hu)),o=i.filter((e=>e.participantType===$u)),s=i.filter((e=>e.participantType===Wu));return i.forEach((e=>{if(e.participantType===qu){const{participantId:t}=e;e.groupParticipantIds=[],e.teamParticipantIds=[],e.pairParticipantIds=[],e.groups=[],e.teams=[],a.forEach((n=>{(n?.individualParticipantIds||[]).forEach((i=>{i!==t||e.teamParticipantIds?.includes(n.participantId)||(e.teamParticipantIds.push(n.participantId),r.get(n.participantId)||r.set(n.participantId,{participantName:n.participantName,participantId:n.participantId}),e.teams.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId,teamId:n.teamId}))}))})),s.forEach((n=>{(n?.individualParticipantIds||[]).forEach((r=>{r!==t||e.pairParticipantIds.includes(n.participantId)||e.pairParticipantIds.push(n.participantId)}))})),o.forEach((n=>{(n?.individualParticipantIds||[]).forEach((r=>{r!==t||e.groupParticipantIds.includes(n.participantId)||(e.groupParticipantIds.push(n.participantId),e.groups.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId}))}))}))}})),{participantsWithGroupings:i,groupInfo:Object.fromEntries(r)}}const Ul=e=>t=>e[t],yl=(e=[])=>e.map(Pl).filter(Boolean),vl=(e=[])=>e.map(Sl).filter(Boolean),Sl=(e={})=>Ul(e)("participantId"),wl=(e={})=>Ul(e)("drawPosition"),Pl=(e={})=>Ul(e)("matchUpId");function Tl({sourceRoundMatchUpCount:e,inContextDrawMatchUps:t,sourceRoundPosition:n,drawDefinition:r,targetLink:i}){if(!i)return{error:we};const{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:u}}=i,{structure:d}=rp({drawDefinition:r,structureId:a}),{positionAssignments:p}=op({structure:d}),l=t?.filter((e=>e.structureId===d?.structureId)),m=l.filter((e=>e.roundNumber===c&&!e.matchUpTieId)),f=m.length,h=E(1,f+1),I=f/e;let g=Math.ceil(I*n),U=1-n%2;if(u?.interleave&&.5!==I){const e=n+(u.offset+(n-1)*u.interleave);g=Math.ceil(e/2),U=1-e%2}let y=h,v=h[g-1];const S=Bp({groupedOrder:s,roundPositionsCount:h.length}),w=S?.length||1;if(w<=h.length){const e=x(h,f/w);o===vd&&e.forEach((e=>e.reverse())),y=S?.length&&S?.map((t=>e[t-1])).flat()||y}o===yd?v=y[g-1]:o===vd?((!S?.length||w>h.length)&&(g=m.length+1-g),v=y[g-1]):o===Ud&&ar()&&console.log(qn,{feedProfile:o});const P=v&&m.reduce(((e,t)=>t.roundPosition===v?t:e),void 0);let T;P?.feedRound?(U=0,T=Math.min(...(P.drawPositions||[]).filter(Boolean))):T=2===P?.drawPositions?.length&&P?.drawPositions[U];const D=p?.find((({drawPosition:e})=>e===T));if(D){const{extension:e}=Ms({element:D,name:Eo});if(e?.value)return{disabledDrawPosition:T}}return{matchUp:P,targetDrawPosition:T,matchUpDrawPositionIndex:U}}function Dl({finishingPositions:e,linkCondition:t,linkType:n,source:r}){const i=r.find((r=>{const i=!r.source?.finishingPositions||!e||k(e,r.source?.finishingPositions);return t===r.linkCondition&&i&&r.linkType===n}));return[wd,Pd].includes(i?.linkType)&&!i?.source?.roundNumber?Mi({result:{error:xn},stack:"getTargetLink",context:i}):i}function Rl({drawDefinition:e,structureId:t,roundNumber:n}){if(!e)return{error:Y};if(!t)return{error:Te};return{links:(e.links||[]).filter(Boolean).reduce(((e,r)=>(r.source?.structureId!==t||n&&r.source.roundNumber!==n||(e.source=e.source.concat(r)),r.target?.structureId!==t||n&&r.target.roundNumber!==n||(e.target=e.target.concat(r)),e)),{source:[],target:[]})}}function bl({inContextDrawMatchUps:e=[],useTargetMatchUpIds:t,inContextMatchUp:n,drawDefinition:r,matchUpId:i}){let a=n;e.length&&!a&&(a=e.find((e=>e.matchUpId===i)));const{structure:o}=rp({structureId:a?.structureId,drawDefinition:r}),s=o?.finishingPosition;return s===Xd?function({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:n,structure:r,matchUp:i}){const{winnerMatchUpId:a,loserMatchUpId:o}=i,{links:s}=function({drawDefinition:e,roundNumber:t,structureId:n}){if(!e)return{error:Y};if(!n)return{error:Te};const{links:r}=Rl({drawDefinition:e,structureId:n});return{links:{source:r.source.reduce(((e,n)=>n.source.roundNumber&&n.source.roundNumber!==t?e:e.concat(n)),[]),target:r.target.reduce(((e,n)=>n.target.roundNumber&&n.target.roundNumber!==t?e:e.concat(n)),[])}}}({roundNumber:i.roundNumber,structureId:r.structureId,drawDefinition:n}),c=s?.source,u=Dl({source:c,linkType:wd}),d=Dl({linkCondition:Td,linkType:Pd,source:c});let p=Dl({source:c,linkType:Pd});const l=d&&p;p||(p=d);const m=u?.target?.feedProfile,f=p?.target?.feedProfile,h=d?.target?.feedProfile;let I,g,U,y,v,S,w,P,T,D;if(t&&(a||o)&&(w=a&&m!==gd&&e.find((({matchUpId:e})=>e===a)),y=o&&f!==gd&&e.find((({matchUpId:e})=>e===o)),w||y))return{matchUp:i,targetLinks:{loserTargetLink:p,winnerTargetLink:u},targetMatchUps:{loserMatchUp:y,winnerMatchUp:w}};const{roundPosition:R}=i;D=D||e.filter((e=>e.structureId===r.structureId));const b=D.reduce(((e,t)=>t.roundNumber!==i.roundNumber||t.matchUpTieId?e:e+1),0);p&&!y&&f!==gd&&({matchUpDrawPositionIndex:S,targetDrawPosition:v,matchUp:y}=Tl({targetLink:p,sourceRoundMatchUpCount:b,inContextDrawMatchUps:e,sourceRoundPosition:R,drawDefinition:n}));l&&h!==gd&&({matchUpDrawPositionIndex:U,targetDrawPosition:g,matchUp:I}=Tl({targetLink:d,sourceRoundMatchUpCount:b,inContextDrawMatchUps:e,sourceRoundPosition:R,drawDefinition:n}));u&&!w&&m!==gd&&({matchUpDrawPositionIndex:T,targetDrawPosition:P,matchUp:w}=Tl({targetLink:u,sourceRoundMatchUpCount:b,inContextDrawMatchUps:e,sourceRoundPosition:R,drawDefinition:n}));w||(D=D||e.filter((e=>e.structureId===r.structureId)),({matchUp:w}=function({structureMatchUps:e,matchUp:t}){const{roundNumber:n,roundPosition:r}=t,i=e.filter((e=>e.roundNumber===n&&!e.matchUpTieId)),a=e.filter((e=>e.roundNumber===n+1&&!e.matchUpTieId));if(a.length){let e;return a.length===i.length?e=a.find((e=>e.roundPosition===r)):a.length===i.length/2&&(e=a.find((e=>e.roundPosition===Math.ceil(r/2)))),{matchUp:e}}return{message:"no progression found"}}({structureMatchUps:D,matchUp:i})));return pi({matchUp:i,targetLinks:{loserTargetLink:p,winnerTargetLink:u,byeTargetLink:d},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:S,byeMatchUpDrawPositionIndex:U,winnerTargetDrawPosition:P,loserTargetDrawPosition:v,byeTargetDrawPosition:g,winnerMatchUp:w,loserMatchUp:y,byeMatchUp:I},targetMatchUpIds:!(!a&&!o)})}({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:r,structure:o,matchUp:a}):function({matchUp:e}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:e}}({matchUp:a})}function Nl({drawDefinition:e,inContextDrawMatchUps:t}){const n={};return t.forEach((r=>{const{matchUpId:i,structureId:a,drawPositions:o=[]}=r,{structure:s}=rp({drawDefinition:e,structureId:a});if(s?.finishingPosition===Jd){const{roundNumber:e}=r,t=e&&m(e)+1,n=s.matchUps??[],{roundMatchUps:i}=ed({matchUps:n});if(t&&i?.[t]){const e=[...o].sort(l).map(((e,n)=>{const r=i[t].find((t=>t.drawPositions?.includes(e)));return{matchUpId:r?.matchUpId,roundNumber:t,schedule:r?.schedule,sideNumber:n+1,structureName:s.structureName}}));Object.assign(r,{sidesTo:e})}}else{const a=bl({useTargetMatchUpIds:!0,inContextDrawMatchUps:t,inContextMatchUp:r,drawDefinition:e,matchUpId:i});let{winnerMatchUp:o}=a.targetMatchUps;const{loserMatchUp:s}=a.targetMatchUps;!r.winnerMatchUpId&&o&&(r.winnerMatchUpId=o.matchUpId),!r.loserMatchUpId&&s&&(r.loserMatchUpId=s.matchUpId);const u=Al({upcomingMatchUp:o});let d=Al({upcomingMatchUp:s});if(r.matchUpStatus!==ma&&s?.matchUpStatus===ma){const{matchUp:n}=Ml({matchUp:s,drawDefinition:e,inContextDrawMatchUps:t})||{};d=n&&Al({upcomingMatchUp:n})||d}const p=r.schedule?.timeAfterRecovery;if(p){if(u?.schedule?.scheduledTime){Gr(u.schedule.scheduledTime)<Gr(p)&&(n[u.matchUpId]=r.matchUpId,u.schedule.scheduleConflict=r.matchUpId)}if(d?.schedule?.scheduledTime){Gr(d.schedule.scheduledTime)<Gr(p)&&(n[d.matchUpId]=r.matchUpId,d.schedule.scheduleConflict=r.matchUpId)}}if(Object.assign(r,{winnerTo:u,loserTo:d}),r.drawPositions?.filter(Boolean).length){const e=a.targetLinks?.loserTargetLink,n=e?.linkCondition===Td,i=(c=r,c?.sides?.map((({participant:e,participantId:t,qualifier:n})=>e||t&&{participantId:t}||n&&{qualifier:n})).filter(Boolean)||[]);if(i.length){const e=vl(o?.sides),r=vl(s?.sides),c=i.find((({participantId:t})=>e.includes(t)))?[]:i,u=i.find((({participantId:e})=>r.includes(e)))?[]:i;s&&n&&u.length<2&&u.push({bye:!0,tbd:!0}),c?.length&&o&&(!a.targetMatchUpIds&&o&&(o=t.find((({matchUpId:e})=>e===o.matchUpId))),o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(c)),u?.length&&s&&(a.targetMatchUpIds||(o=t.find((({matchUpId:e})=>e===s.matchUpId))),s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(u))}}}var c})),Object.keys(n).length&&t.forEach((e=>{Object.keys(n).includes(e.matchUpId)&&(e.schedule.scheduleConflict=n[e.matchUpId])})),{scheduleConflictMatchUpIds:n}}function Ml({matchUp:e,drawDefinition:t,inContextDrawMatchUps:n}){const{matchUpId:r,matchUpStatus:i,structureId:a}=e||{};if(!e||!a||e?.matchUpStatus===Da)return{matchUp:e};if(i===ma){let i;if(e.winnerMatchUpId)i=n.find((({matchUpId:t})=>t===e.winnerMatchUpId));else{const e=bl({inContextDrawMatchUps:n,drawDefinition:t,matchUpId:r});({winnerMatchUp:i}=e?.targetMatchUps||{})}return Ml({matchUp:i,drawDefinition:t,inContextDrawMatchUps:n})}return{matchUp:void 0}}function Al(e){if(e?.upcomingMatchUp)return(({matchUpId:e,structureId:t,schedule:n,roundNumber:r,roundPosition:i,structureName:a})=>({matchUpId:e,structureId:t,schedule:n,roundNumber:r,roundPosition:i,structureName:a}))(e.upcomingMatchUp)}function El({requireParticipants:e=!0,scheduleVisibilityFilters:t,tournamentAppliedPolicies:n,tournamentParticipants:r,afterRecoveryTimes:i,policyDefinitions:a,tournamentRecord:o,matchUpFilters:s,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,contextProfile:l,drawDefinition:m,exitProfiles:f,matchUpsMap:h,structureId:I,inContext:g,structure:U,context:y,event:v}){!U&&I&&({structure:U}=rp({drawDefinition:m,structureId:I}));const S=Kp({tournamentAppliedPolicies:n,scheduleVisibilityFilters:t,tournamentParticipants:r,afterRecoveryTimes:i,policyDefinitions:a,tournamentRecord:o,drawDefinition:m,matchUpFilters:s,contextFilters:c,contextProfile:l,contextContent:u,participantMap:d,scheduleTiming:p,exitProfiles:f,matchUpsMap:h,structure:U,inContext:g,context:y,event:v}),w=[],P=[],T=[],D=[],R=[];if(S.error)return S;const{matchUps:b}=S,{assignedPositions:N}=sp({structure:U}),M=N?.filter((e=>e.participantId)).map((e=>e.drawPosition));let A;return b.filter((e=>{const t=1===s?.matchUpTypes?.length&&s.matchUpTypes[0]===ji;return!(e.matchUpType!==ji&&t)})).forEach((t=>{if(t.matchUpStatus===pa)return void w.push(t);t.matchUpType===ji&&(A=!0);const n=t.collectionId,r=n&&t.sides?.every((e=>e.participantId)),i=!n&&2===t.drawPositions?.filter(Boolean).length,a=!n&&t.drawPositions?.every((e=>M?.includes(e))),o=N?.filter((e=>e.bye)).map((e=>e.drawPosition)),s=!n&&t.drawPositions?.find((e=>o?.includes(e))),c=Fa.includes(t.matchUpStatus)&&(r||i&&(!e||a));return s?R.push(t):xa({matchUp:t})?P.push(t):c?T.push(t):D.push(t)})),{includesTeamMatchUps:A,abandonedMatchUps:w,completedMatchUps:P,upcomingMatchUps:T,pendingMatchUps:D,byeMatchUps:R,structure:U}}function Cl(e){Object.assign(e,{requireParticipants:!1});const t=Ol(e);if(t.error)return Mi({result:t,stack:"getAllDrawMatchUps"});const{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:i,pendingMatchUps:a,byeMatchUps:o,matchUpsMap:s}=t;return{matchUps:(n??[]).concat(...r??[],...i??[],...a??[],...o??[]),matchUpsMap:s}}function Ol(e){if(!e?.drawDefinition)return{error:Y};let{tournamentParticipants:t,contextContent:n,matchUpsMap:r}=e;const{scheduleVisibilityFilters:i,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:c,policyDefinitions:u,tournamentRecord:d,contextFilters:p,contextProfile:l,drawDefinition:m,matchUpFilters:f,scheduleTiming:h,participantMap:I,nextMatchUps:g,inContext:U,context:y,event:v}=e;let S,w=[],P=[],T=[],D=[],R=[];l&&!n&&(n=ss({policyDefinitions:u,tournamentRecord:d,contextProfile:l,event:v})),!t?.length&&d&&(t=d?.participants,(U||s?.withGroupings)&&t?.length&&({participantsWithGroupings:t,groupInfo:S}=gl({participants:t,participantsProfile:s})));const{structures:b}=ip({drawDefinition:m});if(!b)return{error:De};r||(r=_p({drawDefinition:m}));const N=m&&xp({drawDefinition:m}).exitProfiles;b.forEach((e=>{const{byeMatchUps:s=[],pendingMatchUps:S=[],upcomingMatchUps:b=[],completedMatchUps:M=[],abandonedMatchUps:A=[]}=El({matchUpFilters:g?void 0:f,contextFilters:g?void 0:p,inContext:U||g||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:i,tournamentParticipants:t,requireParticipants:o,afterRecoveryTimes:c,policyDefinitions:u,tournamentRecord:d,participantMap:I,scheduleTiming:h,contextContent:n,contextProfile:l,drawDefinition:m,exitProfiles:N,matchUpsMap:r,structure:e,context:y,event:v});w=w.concat(...A),P=P.concat(...M),T=T.concat(...b),D=D.concat(...S),R=R.concat(...s)}));const M=e=>f||g||p?(f&&(e=$p({matchUps:e,...f})),p&&(e=$p({matchUps:e,...p,processContext:!0})),e):e,A={abandonedMatchUps:M(w),completedMatchUps:M(P),upcomingMatchUps:M(T),pendingMatchUps:M(D),byeMatchUps:M(R),matchUpsMap:r,...L,groupInfo:S};if(g){const e="object"==typeof g||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:t,completed:n,upcoming:r,pending:i,bye:a}=e;Nl({inContextDrawMatchUps:[].concat(...t&&w||[],...n&&P||[],...r&&T||[],...i&&D||[],...a&&R||[]),drawDefinition:m})}return A}const Fl={matchUpStatus:Da,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function kl({matchUpStatusCodes:e,removeWinningSide:t,tournamentRecord:n,drawDefinition:r,matchUpFormat:i,matchUpStatus:a,removeScore:o,winningSide:s,matchUpId:c,matchUp:u,event:d,notes:p,score:l}){const m="modifyMatchUpScore";let f;const h=u.matchUpType===ji;if(h&&r){if(c&&u.matchUpId!==c){const e=Qp({drawDefinition:r,matchUpId:c,event:d});if(!e.matchUp)return{error:Xe};({matchUp:u,structure:f}=e)}}else u.matchUpId!==c&&console.log("!!!!!");a&&[Ra,ya].includes(a)||o?Object.assign(u,{...Fl}):l&&(u.score=l);const I=a&&u?.matchUpStatus===ga&&a!==ga;let g;if(a&&(u.matchUpStatus=a),i&&(u.matchUpFormat=i),e&&(u.matchUpStatusCodes=e),s&&(u.winningSide=s),t&&(u.winningSide=void 0),!f&&r&&({structure:f}=Qp({drawDefinition:r,matchUpId:c,event:d})),!a||u.winningSide||!dl(u)||Ca.includes(a)||[la,Ta].includes(a)||(u.matchUpStatus=Ki.InProgress),I&&u?.processCodes?.length||a===ga){const e=Xo({tournamentRecord:n,drawDefinition:r,structure:f,event:d})?.appliedPolicies;g=e?.[vo]?.processCodes?.incompleteAssignmentsOnDefault}if(!u.collectionId){const e=f?.structureType===Id,t=Hp({drawDefinition:r,structure:f});if(Wp({drawDefinition:r,structure:f})||t||e){const a=(e=>{i=h?"SET1-S:T100":i??u.matchUpFormat??e?.matchUpFormat??r?.matchUpFormat??d?.matchUpFormat;const a=h?{matchUpTypes:[ji]}:void 0,{matchUps:o}=Kp({afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,matchUpFilters:a,drawDefinition:r,structure:e,event:d});return t&&(e.positionAssignments=P(o.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})))),Il({positionAssignments:e.positionAssignments,tournamentRecord:n,drawDefinition:r,matchUpFormat:i,matchUps:o,event:d})})(e&&f.structures.find((e=>e?.matchUps.find((e=>e.matchUpId===c))))||f);if(a.error)return Mi({result:a,stack:m})}}if(p){const e=fl({element:u,notes:p});if(e.error)return Mi({result:e,stack:m})}const U=n?.tournamentId,y=hr().topics.includes(Vc),v=(y||g)&&_p({drawDefinition:r}),S=v&&Cl({matchUpFilters:{matchUpIds:[c]},nextMatchUps:!0,tournamentRecord:n,inContext:!0,drawDefinition:r,matchUpsMap:v}).matchUps?.[0];if(y&&S&&function({tournamentId:e,inContextMatchUp:t}){t&&pr({payload:{inContextMatchUp:t,tournamentId:e},topic:Vc,key:t.matchUpId})}({tournamentId:U,inContextMatchUp:S}),Array.isArray(g)&&S&&!S.sides?.every((({participantId:e})=>e)))if(a===ga)u.processCodes?u.processCodes.push(...g):u.processCodes=g;else for(const w of g||[]){const e=w&&u?.processCodes?.lastIndexOf(w);u?.processCodes?.splice(e,1)}return rl({eventId:d?.eventId,context:m,drawDefinition:r,tournamentId:U,matchUp:u}),{...L}}function xl({tournamentRecord:e,exitWhenNoValues:t,drawDefinition:n,matchUpStatus:r,removeScore:i,matchUpsMap:a,matchUpId:o,event:s}){const c=Qp({drawDefinition:n,event:s,matchUpId:o});if(c.error)return c;if(!c.matchUp)return{error:Xe};const{matchUp:u,structure:d}=c;if(!u.tieMatchUps)return{error:tt};cl({tournamentId:e?.tournamentId,eventId:s?.eventId,dualMatchUp:u,drawDefinition:n});const{extension:p}=lc({name:Co,element:u});if(p?.value){if(!i)return{...L,score:u.score};ec({element:u,name:Co})}const l=Ni({drawDefinition:n,structure:d,matchUp:u,event:s})?.tieFormat;u.tieFormat=ul(l);const m=Zp({drawDefinition:n,matchUpsMap:a,structure:d,matchUp:u,event:s}),{winningSide:f,set:h,scoreStringSide1:I,scoreStringSide2:g}=m,U=h?.side1Score||h?.side2Score;if(t&&!u.score&&!U)return{...L};const y={scoreStringSide1:I,scoreStringSide2:g,sets:h?[h]:[]},v=f&&[1,2].includes(f),S=v&&ha||ml({matchUpStatus:r??u.matchUpStatus,tieMatchUps:u.tieMatchUps,winningSide:u.winningSide,score:y})&&va||Da,w=!(!u.winningSide||v),P=u.tieMatchUps.find((({score:e,winningSide:t,matchUpStatus:n})=>e?.sets?.length&&(e.sets[0].side1Score||e.sets[0].side2Score)||n&&Ca.includes(n)||t));let T;if(u.tieFormat&&!v&&!P){const e=Ni({drawDefinition:n,structure:d,event:s})?.tieFormat;e&&JSON.stringify(l)===JSON.stringify(e)&&(u.tieFormatId=void 0,u.tieFormat=void 0,T=!0)}return kl({matchUpStatus:S,score:y,removeWinningSide:w,tournamentRecord:e,drawDefinition:n,removeScore:i,winningSide:f,matchUpId:o,matchUp:u,event:s}),{...L,score:y,removeWinningSide:w,tieFormatRemoved:T,winningSide:f}}function _l(e){const{winnerFirst:t=!0,addOutcomeString:n,reversed:r=!1,matchUpStatus:i,matchUpFormat:a,autoComplete:o,winningSide:s,sets:c}=e;if(!c)return{error:mt,info:"missing sets"};const u=a&&gi(a),{bestOf:d,finalSetFormat:p,setFormat:l}=u||{},m=r||!(!t||!s||1===s),f=n?function({matchUpStatus:e}){const t={[Pa]:"RET",[Ra]:"WO",[Ua]:"DF/DF",[ya]:"WO/WO",[Ta]:"SUS",[pa]:"ABN",[ga]:"DEF",[Ia]:"DR"};return e&&t[e]||""}({matchUpStatus:i}):"",h=c?.sort(Ll).map((function(e){const t=d&&e.setNumber===d&&p?p:l,n=t?.tiebreakSet||(f=e,!(U(f?.side1Score)||U(f?.side2Score))&&(e=>U(e?.side1TiebreakScore)||U(e?.side2TiebreakScore))(e)),{side1Score:r,side2Score:i,side1TiebreakScore:a,side2TiebreakScore:s}=e,c=a||(U(a)||o?0:""),u=s||(U(s)||o?0:"");var f;if(n){return`[${(m?[u,c]:[c,u]).join("-")}]`}const h=Math.min(c,u),I=h?`(${h})`:"",g=r||(U(r)||o?0:""),y=i||(U(i)||o?0:"");let v=m?`${[y,g].join("-")}${I}`:`${[g,y].join("-")}${I}`;["-"," "].includes(v)&&(v="");return v})).filter(Boolean).join(" ")||"";return f?2===s?`${f} ${h}`:`${h} ${f}`:h}function Ll(e,t){return e.setNumber-t.setNumber}function Bl({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:n,winningSide:r,score:i}){if("object"!=typeof i)return{error:xn};const{sets:a,scoreStringSide1:o,scoreStringSide2:s}=i,c="scoreString must be a string!";if(void 0!==o&&"string"!=typeof o)return{error:xn,info:c};if(void 0!==s&&"string"!=typeof s)return{error:xn,info:c};if(void 0!==a&&!Array.isArray(a))return{error:xn,info:sa("sets")};if(a?.length){const o=a.map((e=>e?.setNumber)).filter(Boolean);if(o.length!==P(o).length)return{error:xn,info:"setNumbers not unique"};for(const e of a){const{side1Score:t,side2Score:n,side1TiebreakScore:r,side2TiebreakScore:i,side1PointScore:a,side2PointScore:o,winningSide:s,setNumber:c}=e;if(![[t,n],[r,i],[a,o]].filter((e=>e.some((e=>void 0!==e)))).every((e=>e.every((e=>S(e))))))return{error:xn,info:"non-numeric values"};if(![c,s].filter((e=>void 0!==e)).every((e=>S(e))))return{error:xn,info:"non-numeric values"};if(s&&![1,2].includes(s))return{error:xn,info:"winningSide must be 1 or 2"}}const{valid:s}=function({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:n,winningSide:r,score:i}){const a=i?.sets||[],o=(a?.filter((e=>e?.winningSide))||[]).reduce(((e,t)=>{const{winningSide:n}=t;return n?(e[n-1]++,e):e}),[0,0]),s=r?r-1:void 0,c=void 0!==s?1-s:void 0,u=void 0!==s&&o[s],d=void 0!==c&&o[c],p=t?gi(t):void 0,l=Math.max(...o),m=R(o)[l],f=p?.bestOf,h=f&&Math.ceil(f/2)||1,I=n||e,g=I&&[ga,Pa,Ra].includes(I),U=!p||!a.length||a.every(((e,t)=>{const n=t+1,r=n===f,i=n===a.length,{side1Score:o,side2Score:s,side1TiebreakScore:c,side2TiebreakScore:u,winningSide:d}=e,l=Math.max(o||0,s||0),m=c||u,{finalSetFormat:h,setFormat:I}=p,U=r&&h||I;if(m){const{tiebreakTo:e,NoAD:t}=U?.tiebreakFormat||{},n=Math.max(c||0,u||0);if(t&&n>e)return!1;if(n<e&&d){if(i&&!g)return!1;if(!i)return!1}}return!U.setTo||!(!U.noTiebreak&&l>U.setTo+1)})),y=(!t||l===h)&&1===m&&o.indexOf(l)+1||void 0;return{valid:U&&(r&&u>d&&r===y||!r&&!y||g)}}({existingMatchUpStatus:e,matchUpStatus:n,matchUpFormat:t,winningSide:r,score:i});if(!s)return{error:Pt,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}function Vl({analysis:e,set:t}){const n=Gl({set:t}),{isDecidingSet:r,isTiebreakSet:i,matchUpScoringFormat:a}=e;return jl({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:i,set:t})&&n}function jl(e){let t=e.matchUpScoringFormat;const{ignoreTiebreak:n=!1,matchUpFormat:r,isTiebreakSet:i,isDecidingSet:a,set:o}=e;if(!o)return{error:mt};t=t||r;const s=a&&t.finalSetFormat||t?.setFormat||{},{side1Score:c,side2Score:u}=o,{NoAD:d,setTo:p,tiebreakAt:l,tiebreakFormat:m}=s,f=m?.NoAd,h=Gl({set:o}),I=Math.abs(c-u),g=c>=p||u>=p,U=i||c>=p&&u>=p||l&&l<p&&(c===l||u===l),y=n||U&&(1===h&&o.side1TiebreakScore>o.side2TiebreakScore||2===h&&o.side2TiebreakScore>o.side1TiebreakScore);return(g&&(I>=(d||U&&(l&&!i||i&&f)?1:2)||U)||i)&&(!U||y)}function Gl({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}const ql=" ",$l="DEF",Wl="WO",Hl="ABN",zl="SUS",Yl="RET",Kl="INT",Ql=[Yl,$l,Wl,"WO/WO",Hl,zl,Kl],Jl="DEFAULTED",Xl="WALKOVER",Zl="ABANDONED",em="SUSPENDED",tm="RETIRED",nm="INTERRUPTED",rm=[tm,Jl,Xl],im="()",am="[]",om=["up","left","shift+tab"],sm=["enter","down","tab","right"],cm="backspace",um="r",dm="s",pm="a",lm="d",mm="w",fm="i",hm=[um,lm,mm,pm,dm,fm],Im="space",gm=["[","("],Um=[...om,...sm,Im,"]"],ym="-",vm="-",Sm=["/"],wm=["0","1","2","3","4","5","6","7","8","9"].concat(hm),Pm=wm.map((e=>`shift+${e}`)),Tm=[ym,cm].concat(Um,Sm),Dm=[wm,Pm,Tm].join(","),Rm=[Dm,om,sm,["=","+","num_1","num_2","shift+=","shift+-"]].join(",");[].concat(...wm,...wm,...Tm,...wm,...wm,...wm,...wm,...wm,...wm);const bm={OUTCOMEKEYS:hm,SIDE1KEYS:wm,SIDE2KEYS:Pm,MODIFIERS:Tm,PROMPT:"Enter Score",MOVEUP:om,MOVEDOWN:sm,HOTKEYS:Rm};function Nm({scoreString:e,lowSide:t,outcome:n}){if(({scoreString:e}=Mm({scoreString:e})),2===t){return e+((e&&e[e.length-1])!==ql?ql:"")+n}return n+ql+e}function Mm({scoreString:e}){if(!e)return{scoreString:""};let t=!1;for(const n of Ql){const r=e?.indexOf(n);0===r?e=e.slice(n.length+1).trim()+ql:r>0&&(e=e.slice(0,r)),r>=0&&(t=!0)}return e?.trim()||(e=""),{scoreString:e,removed:t}}function Am({analysis:e,scoreString:t,sets:n,lowSide:r}){let i,a;if(!t)return{scoreString:t,sets:n};const{scoreString:o,removed:s}=Mm({scoreString:t});if(t=o,s)return{scoreString:t,sets:n,outcomeRemoved:!0};let c=n[n.length-1]||{};const u=Object.values(c).filter((e=>void 0!==e)).length;c.setNumber&&1===u&&(c=(n=n.slice(0,n.length-1))[n.length-1]||{});const{tiebreakSet:d}=e.setFormat,{tiebreakTo:p,NoAD:l}=d||{},{isTiebreakEntry:m}=Em({brackets:am,scoreString:t}),f=function(e){const t=e.split("");return t.reduce(((e,t,n)=>(t.match(/\d+/g)&&e.push(n),e)),[]).pop()}(t);if(f>=0){i=t.slice(0,f);const{isTiebreakEntry:o}=Em({brackets:im,scoreString:i}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=Em({brackets:am,scoreString:i}),d=i&&i[i.length-1].trim(),h=i&&!isNaN(d);let I=e.isIncompleteSetScore;if(m&&u){const e=i.slice(s+1).split(vm),n=e?.length>0&&void 0!==e[0]&&!isNaN(parseInt(e[0]))&&parseInt(e[0])||void 0,a=e?.length>1&&void 0!==e[1]&&parseInt(e[1])||void 0,o=[n,a];if(a){const e=1===r?1:0;o[e]=(o?.[1-e]||0)+(l?1:2),(o[e]||0)<p&&(o[e]=p),i=t.slice(0,s+1),i+=o.join(vm)}else void 0!==n?(i=t.slice(0,s+1),i+=n):(i=t.slice(0,s),I=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(i.length||(i=void 0),I){const t=c.side1Score?.toString();if(t){const e=t?.slice(0,t.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}e.isTimedSet?(a=c.side1Score?n:n?.slice(0,n.length-1)||[],a[n.length-1]=c):a=n?.slice(0,n.length-1)||[]}else if(h){const t=c.side2Score?.toString(),r=c.side1Score?.toString();if(!e.isTiebreakEntry&&!e.isMatchTiebreak)if(c.side2Score){const e=t?.slice(0,t.length-1);c.side2Score=!isNaN(e)&&parseInt(e)||void 0}else{const e=r?.slice(0,r.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0}e.isTimedSet?c.side1Score?(a=n||[],a[n.length-1]=c):a=n?.slice(0,n.length-1)||[]:(a=n||[],a[n.length-1]=c),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else o?(a=n||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(m&&!u?a=n?.slice(0,n.length-1)||[]:(a=n,a[n.length-1]=c),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:i,sets:a}}return{scoreString:t,sets:n}}function Em({brackets:e=im,scoreString:t}){if(!t)return{};const[n,r]=e.split(""),i=t.split(""),a=Math.max(...C(n,i));return{isTiebreakEntry:a>Math.max(...C(r,i)),lastOpenBracketIndex:a}}function Cm(e){const{lowValue:t=0,NoAD:n=!1,tiebreakTo:r}=e||{};return t+1>=r?t+(n?1:2):parseInt(r)}function Om({matchUpFormat:e,matchUpStatus:t,winningSide:n,sets:r}){const i=gi(e),{bestOf:a}=i,o=Math.ceil(a/2),s=r?.reduce(((e,t)=>{const{winningSide:n}=t;return n&&e[n-1]++,e}),[0,0]);let c=s?.indexOf(o)+1||void 0;return rm.includes(t)&&n&&(c=n),{matchUpWinningSide:c}}function Fm({lowSide:e,value:t,sets:n,scoreString:r,winningSide:i,matchUpStatus:a}){let o;return t===um?r?(o=!0,r=Nm({scoreString:r,lowSide:e,outcome:Yl}),i=2===e?1:2,a=tm):(o=!0,r=Nm({scoreString:r,lowSide:e,outcome:$l}),i=2===e?1:2,a=Jl):t===lm?(o=!0,r=Nm({scoreString:r,lowSide:e,outcome:$l}),i=2===e?1:2,a=Jl):t===mm?(o=!0,n=[],r=Wl,i=2===e?1:2,a=Xl):t===dm&&r?(o=!0,r=Nm({scoreString:r,lowSide:e,outcome:zl}),a=em,i=void 0):t===pm?(o=!0,r=Nm({scoreString:r,lowSide:e,outcome:Hl}),a=Zl,i=void 0):t===fm&&r&&(o=!0,r=Nm({scoreString:r,lowSide:e,outcome:Kl}),a=nm,i=void 0),{updated:o,sets:n,scoreString:r,matchUpStatus:a,winningSide:i}}function km({matchUpFormat:e,scoreString:t,winningSide:n,value:r,sets:i}){const a=(i?.filter((e=>e?.winningSide))?.length||0)+(n?0:1),o=gi(e),s=a===o?.bestOf,c=s&&o?.finalSetFormat||o?.setFormat||{},u=c?.timed,d=s&&i[o?.bestOf-1],p=d?.winningSide,{isTiebreakEntry:l}=Em({brackets:im,scoreString:t}),{isTiebreakEntry:m}=Em({brackets:am,scoreString:t}),f=l||m,h=!!c.tiebreakSet,I=t?.[t.length-1]?.trim(),g=t&&!isNaN(I),U=!f&&I===ym,y=l&&gm.includes(I),v=m&&gm.includes(I),S=m&&I===vm,w=t?.split(""),[P]=am.split(""),T=w&&Math.max(...C(P,w)),D=w&&Math.max(...C(vm,w)),R=w&&D>T,b=i[i.length-1]?.winningSide,N=i?.length&&!b,M=Ql.find((e=>t?.indexOf(e)>=0)),A=!isNaN(r),E=r===Im,O=Um.includes(r),F=t?.split("").find((e=>gm.includes(e))),k=O&&m&&!v&&(S||!function({scoreString:e}){if(!e)return!1;const t=e&&e[e.length-1].trim(),n=e&&!isNaN(t),[r,i]=am.split(""),a=e.split(""),o=Math.max(...C(r,a)),s=Math.max(...C(i,a)),c=Math.max(...C(vm,a));return n&&o>s&&c>o}({scoreString:t}));return{isTiebreakSetValue:h&&A,matchUpScoringFormat:o,setNumber:a,setFormat:c,matchTiebreakHasJoiner:R,isGameScoreEntry:N,isSpace:E,isCloser:O,isTiebreakCloser:O&&F&&f&&g,isDecidingSet:s,isTiebreakSet:h,isTimedSet:u,isNumericEnding:g,isNumericValue:A,hasOpener:F,hasOutcome:M,finalSet:d,finalSetIsComplete:p,lastSetIsComplete:b,isInvalidSetTiebreakValue:E&&f&&y,isInvalidMatchTiebreakValue:k,isTiebreakEntry:f,isSetTiebreakEntry:l,isMatchTiebreakEntry:m,isIncompleteSetScore:U,isIncompleteSetTiebreak:y,isIncompleteMatchTiebreak:v,isPartialMatchTiebreakValue:S}}function xm({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:n,isTiebreakSet:r,isDecidingSet:i,set:a}){if(!a)return{error:mt,info:"missing set"};t=t||n&&gi(n);const o=i&&t.finalSetFormat||t?.setFormat||{},{side1Score:s,side2Score:c}=a,{setTo:u,tiebreakAt:d,tiebreakFormat:p}=o,l=p?.NoAd,m=_m({set:a}),f=Math.abs(s-c),h=s>=u||c>=u,I=r||s>=u&&c>=u||d&&d<u&&(s===d||c===d),g=e||I&&(1===m&&a.side1TiebreakScore>a.side2TiebreakScore||2===m&&a.side2TiebreakScore>a.side1TiebreakScore);return(h&&(f>=(I&&(d&&!r||r&&l)?1:2)||I)||r)&&(!I||g)}function _m({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}function Lm(e){const{setObject:t,matchUpScoringFormat:n}=e;if(!t)return{error:pt};const{setNumber:r}=t||{},{bestOf:i}=n||{},a=!(!r||!i||r!==i),o=a&&n?.finalSetFormat||n?.setFormat,s=!!o?.tiebreakSet,c=!!o?.timed,u=!s&&!c,d=!!(r&&i&&r<=i),p=[t?.side1Score,t?.side2Score],l=[t?.side1PointScore,t?.side2PointScore],m=[t?.side1TiebreakScore,t?.side2TiebreakScore],f=p.filter((e=>void 0!==e)).length,h=l.filter((e=>void 0!==e)).length,I=m.filter((e=>void 0!==e)).length,g=p?.filter((e=>!isNaN(e))).length,U=m?.filter((e=>!isNaN(e))).length,{tiebreakAt:y}=o||{},v=y&&2===p.filter((e=>e>=y)).length,S=v&&((p[0]>p[1]?1:p[1]>p[0]&&2)||void 0),w=!(!U||g),P=!!t?.winningSide,{error:T,result:D}=function({setObject:e,setFormat:t,sideGameScores:n,sideTiebreakScores:r}){if(!e)return{result:!1,error:pt};const i=!!t?.tiebreakSet,a=!!t?.timed;if(!t||i||a)return{result:!1,error:xn};const o=2===n?.filter((e=>!isNaN(e))).length;if(!o)return{result:!1,error:wt};const{setTo:s,tiebreakAt:c,tiebreakFormat:u,NoAD:d}=t||{},p=!(!s||!n?.find((e=>e>=s)));if(!p)return{result:!1,error:wt};const l=[1,2].includes(e?.winningSide);if(!e||!l)return{result:!1,error:Tt};const m=e?.winningSide-1,f=1-m,h=n[m],I=n[f],g=h-I;if(!(h>I))return{result:!1,error:{message:"winningSide game scoreString is not high"}};const U=c&&u,y=2===r?.filter((e=>!isNaN(e))).length,v=r?.[m],S=r?.[f],w=c&&2===n.filter((e=>e>=c)).length;if(U){const{NoAD:e,tiebreakTo:t}=u;if(w){if(g>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!y)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(t))return{result:!1,error:{message:"tiebreakTo error"}};if(!!(!t||!r?.find((e=>e>=t))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(h>(c<s?s:s+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!v||!S||v<S)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};const n=v-S;if(n&&S>=t-1&&n<(e?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>s&&!w)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}const P=d?1:2,T=I>=s-1,D=g&&T&&!w&&g<P;if(D)return{result:!1,error:{message:"invalid winning game scoreString (3)"}};if(g>P&&h>s)return{result:!1,error:{message:"invalid winning game scoreString (4)"}};return{result:!0}}({setObject:t,setFormat:o,sideGameScores:p,sideTiebreakScores:m}),{error:R,result:b}=function({setObject:e,setFormat:t,sideTiebreakScores:n}){if(!e)return{result:!1,error:pt};const r=!!t?.tiebreakSet,i=!!t?.timed;if(!t||!r||i)return{result:!1,error:{message:"not tiebreak set"}};const a=[1,2].includes(e?.winningSide);if(!e||!a)return{result:!1,error:Tt};const{tiebreakSet:o}=t||{},{NoAD:s,tiebreakTo:c}=o||{},u=2===n?.filter((e=>!isNaN(e))).length;if(!u)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(c))return{result:!1,error:{message:"tiebreakTo error"}};const d=!!n?.find((e=>e>=c));if(!d)return{result:!1,error:{message:"invalid tiebreak scores (2)"}};const p=e?.winningSide-1,l=1-p,m=n[p],f=n[l];if(!m||!f||m<f)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};const h=s?1:2,I=m-f,g=f>=c-1;if(I&&g&&I<h)return{result:!1,error:{message:"invalid tiebreak scores (3)"}};return{result:!0}}({setObject:t,setFormat:o,sideTiebreakScores:m}),N=u&&!w&&D||s&&w&&b,M=d&&!(s&&!w)&&!(u&&w)&&(!P||N),A=function({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:n,setObject:r}){if(!r)return;const i=_m({set:r});return xm({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:n,set:r})&&i||void 0}({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:n,setObject:t}),E={expectTiebreakSet:s,expectTimedSet:c,hasTiebreakCondition:v,isCompletedSet:P,isDecidingSet:a,isTiebreakSet:w,isValidSet:M,isValidSetNumber:d,isValidSetOutcome:N,leadingSide:S,setFormat:o,sideGameScores:p,sideGameScoresCount:f,sidePointScores:l,sidePointScoresCount:h,sideTiebreakScores:m,sideTiebreakScoresCount:I,winningSide:A};return void 0!==t?.winningSide&&(w?(E.isValidTiebreakSetOutcome=b,b||(E.tiebreakSetError=R)):(E.isValidStandardSetOutcome=D,D||(E.standardSetError=T))),E}const Bm=e=>{const{isSide1:t,lowValue:n,setTo:r,tiebreakAt:i,NoAD:a}=e;if(void 0===n)return!1;let o,s=m(n);s?.toString().length>2&&(s=parseInt(s.toString().slice(0,2))),i&&i<r&&s>i&&(s=i),o=a&&!i?s<r?r:r-1:s+1<r&&r||i&&i<r&&s===i&&r||!i&&s+2||r+1;return[t?s:o,t?o:s]},Vm=e=>{const{isSide1:t,lowValue:n,tiebreakTo:r,tiebreakNoAd:i}=e;if(void 0===n)return!1;let a="string"==typeof n?parseInt(n):n;a?.toString().length>2&&(a=parseInt(a.toString().slice(0,2))),i&&a>r-1&&(a=r-1);const o=function(e){const{lowValue:t,NoAD:n,tiebreakTo:r}=e,i=n?1:2;if(t+1>=r)return t+i;return r}({lowValue:a,NoAD:i,tiebreakTo:r});return[t?a:o,t?o:a]};const jm={stringifyMatchUpFormat:s,isValidMatchUpFormat:Ti,parseMatchUpFormat:gi,generateTieMatchUpScore:Zp,getTiebreakComplement:Vm,updateTieMatchUpScore:xl,generateScoreString:_l,checkSetIsComplete:jl,validateTieFormat:ca,getSetComplement:Bm,scoreHasValue:dl,keyValueScore:function(e){let{lowSide:t=1,value:n}=e,{scoreString:r,sets:i,winningSide:a,matchUpStatus:o}=e;const{matchUpFormat:s,shiftFirst:c,auto:u=!0}=e;let d,p;const l=c&&2===t||!c&&1===t;if(!Dm.includes(n))return{updated:!1,info:"invalid key"};c&&(t=3-t);const{matchUpWinningSide:f}=Om({sets:i,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=f;const h=km({value:n,winningSide:a,scoreString:r,sets:i,matchUpFormat:s});if(Sm.includes(n)&&(n=ym),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&l&&0===m(n)&&(h.isTiebreakCloser=!0),Um.includes(n)&&h.hasOpener&&(n=""),Um.includes(n)&&(n=Im),h.lastSetIsComplete){const e=r?.length&&r[r.length-1];r&&" "!==e&&(r+=" ")}if(h.isTimedSet)({info:p,sets:i,scoreString:r,updated:d,matchUpStatus:o,winningSide:a}=function(e){let{sets:t,info:n,scoreString:r,winningSide:i,matchUpStatus:a}=e;const{analysis:o,lowSide:s,value:c}=e;let u,d;t?.length||c===cm||(t=[{setNumber:1}]);const p=t.length-1;if(hm.includes(c)){const e=t[t.length-1]||{},{side1Score:d,side2Score:p}=e;d&&!p?n="missing side2Score":o.finalSetIsComplete||i?n="final set is already complete":o.isIncompleteSetScore?n="incomplete set scoreString":o.isIncompleteSetScore||({sets:t,scoreString:r,winningSide:i,matchUpStatus:a,updated:u}=Fm({lowSide:s,value:c,sets:t,scoreString:r,matchUpStatus:a,winningSide:i}))}else if(c===cm){if(({scoreString:r,sets:t,outcomeRemoved:d}=Am({analysis:o,scoreString:r,sets:t})),""===r?.trim()&&(r=r.trim()),r||(t=[]),d){const e=t[t.length-1]||{},{side1Score:n,side2Score:r}=e;if(n&&r){const i=(n>r?1:r>n&&2)||void 0;i&&(e.winningSide=i,t.push({setNumber:t.length+1}))}}a=void 0,i=void 0,u=!0}else if(o.hasOutcome)n="has outcome";else{if(i)return{sets:t,scoreString:r,winningSide:i,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(c===Im){const e=t[t.length-1]||{},{side1Score:n,side2Score:a}=e,s=(n>a?1:a>n&&2)||void 0;!s||i||o.isIncompleteSetScore||(t[t.length-1].winningSide=s,t.push({setNumber:t.length+1}),r+=" ",u=!0)}else if(c===ym&&void 0!==t[p].side1Score&&void 0===t[p].side2Score&&r&&o.isNumericEnding)r+="-",t[p].side2Score=0,a=void 0,i=void 0,u=!0;else if(!isNaN(c)){let e;if(void 0===t[p].side2Score){const n=m((t[p].side1Score||0).toString()+c).toString().slice(0,2);t[p].side1Score=m(n),e=t[p].side1Score.toString(),u=!0}else{const n=m((t[p].side2Score||0).toString()+c).toString().slice(0,2);t[p].side2Score=m(n),e=[t[p].side1Score,t[p].side2Score].join("-"),u=!0}if(u){const n=(t.slice(0,p)||[]).filter((e=>e)).map((e=>{const{side1Score:t,side2Score:n}=e;return[t,n].join("-")})).join(" ");r=n?n+" "+e:e}}}return{sets:t,scoreString:r,winningSide:i,matchUpStatus:a,info:n,updated:u}}({analysis:h,lowSide:t,scoreString:r,sets:i,matchUpStatus:o,winningSide:a,value:n}));else if(hm.includes(n))h.finalSetIsComplete||a?p="final set is already complete":h.isTiebreakEntry||h.isIncompleteSetScore?h.isTiebreakEntry||h.isIncompleteSetScore?p="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:n}):({sets:i,scoreString:r,matchUpStatus:o,winningSide:a,updated:d}=Fm({lowSide:t,sets:i,scoreString:r,matchUpStatus:o,winningSide:a,value:n}));else if(n===cm)d=!0,({scoreString:r,sets:i}=Am({analysis:h,scoreString:r,sets:i,lowSide:t})),r||(i=[]),o=void 0,a=void 0;else if(h.hasOutcome)p="has outcome";else if(n!==ym||h.isMatchTiebreakEntry)if(n===vm&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?p="existing joiner":h.isNumericEnding&&(d=!0,r+=vm);else if([ym,vm].includes(n))p="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:i,scoreString:r,updated:d}=function({analysis:e,scoreString:t,sets:n,value:r}){let i;if(!n?.length)return{sets:[]};const a=n[n.length-1];r=m(r);const{validSide2Score:o,requiresTiebreak:s}=function({analysis:e,set:t={},value:n}){const r=e.isDecidingSet&&e.matchUpScoringFormat.finalSetFormat||e.matchUpScoringFormat.setFormat,{tiebreakAt:i,setTo:a,NoAD:o}=r,{side1Score:s}=t;let c,u;return c=i&&i<a?s===i?n<=a:n<=i:s===a?o?n<a:n<=a+1:s===a-1?o?n<=a:n<=a+1:s===a+1?n===a||n===a-1:n<=a,c&&(u=i&&i<a?s===a&&n===i||s===i&&n===a:s>=a&&n>=a&&s!==n),{validSide2Score:c,requiresTiebreak:u}}({analysis:e,set:a,value:r});if(o){i=!0,t=(t||"")+r,a.side2Score=r;const o=Vl({analysis:e,set:n[n.length-1]});a.winningSide=o||void 0,s?t+=im.split("")[0]:e.isDecidingSet||(t+=ql)}return{sets:n,scoreString:t,updated:i}}({analysis:h,scoreString:r,sets:i,value:n}));else if(h.isInvalidMatchTiebreakValue)p="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)p="invalid set tiebreak character";else if(h.isTiebreakCloser){const e=h.isSetTiebreakEntry?im:am,t=e.split("").reverse()[0],n=e.split("")[0],a=i[i.length-1],{tiebreakFormat:o}=h.setFormat,{tiebreakTo:s,NoAD:c}=o||{},u=Gl({set:a});if(!h.isTiebreakSet){const e=parseInt(r.split(n).reverse()[0]),t=Cm({lowValue:e,tiebreakTo:s,NoAD:c});1===u?(a.side1TiebreakScore=t,a.side2TiebreakScore=e):(a.side1TiebreakScore=e,a.side2TiebreakScore=t)}r=(r||"")+t,h.isDecidingSet||(r+=ql);const p=Vl({analysis:h,set:a});a.winningSide=p||void 0,d=!0}else if(h.isTiebreakSetValue)({info:p,scoreString:r,sets:i,updated:d}=function({analysis:e,auto:t,lowSide:n,scoreString:r="",sets:i,value:a}){let o,s;const{tiebreakSet:{tiebreakTo:c,NoAD:u}}=e.setFormat,[d]=am.split("");if(e.isMatchTiebreakEntry||(r+=d),i[e.setNumber-1]){const{lastOpenBracketIndex:e}=Em({brackets:am,scoreString:r}),d=(r.slice((e??0)+1)+(t?"":a)).split(vm);if((d[n-1]?.length||0)>=2)s="tiebreak digit limit";else if(t){1===n&&(d[0]=(d[0]||"")+a),2===n&&(d[1]=(d[1]||"")+a);const t=[d[0]||0,d[1]||0].map((e=>m(e))),s=1===n?1:0;t[s]=t[1-s]+(u?1:2),t[s]<c&&(t[s]=c);const p=i[i.length-1];p.side1TiebreakScore=t[0],p.side2TiebreakScore=t[1],r=r.slice(0,(e??0)+1),r+=t.join(vm),o=!0}else{const e=[d[0]||0,d[1]||0].map((e=>m(e))),t=i[i.length-1];t.side1TiebreakScore=e[0],t.side2TiebreakScore=e[1],r+=a,o=!0}}else{const e=Cm({lowValue:m(a||0),tiebreakTo:c,NoAD:u}),t=[m(a),e];2===n&&t.reverse();const s={side1TiebreakScore:t[0],side2TiebreakScore:t[1],setNumber:i?.length+1||1};i.push(s),r+=t.join(vm),o=!0}return{info:s,scoreString:r,sets:i,updated:o}}({analysis:h,auto:u,lowSide:t,scoreString:r,sets:i,value:n}));else if(h.isSetTiebreakEntry){const[e]=im.split(""),t=Math.max(...C(e,r.split(""))),i=r.slice(t+1),a=i&&0===m(i),o=m(i?i+n:n),{tiebreakFormat:s}=h.setFormat,{tiebreakTo:c,NoAD:u}=s||{};!a&&i.length<2?u&&o>c-1?p="invalid low value for NoAD tiebreak":(d=!0,r=(r||"")+n):p=a?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)p=`invalid key: ${n}`;else if(h.isGameScoreEntry)p="game scoreString entry";else if(h.lastSetIsComplete||!i.length){d=!0;const{scoreString:e,set:a}=function({analysis:e,lowSide:t,scoreString:n,value:r}){const{setTo:i,tiebreakAt:a,NoAD:o}=e?.setFormat||{},s=r===parseInt(a||i);if(a&&a<i&&r>a)return{scoreString:n};if(o&&r===i||r>i)return{scoreString:n};const c=s?r+1:r+1===i?r+(o?1:2):i,u=[r,c];2===t&&u.reverse();const d=im.split("")[0];n=(n||"")+(u.join(ym)+(s?d:ql));const p={side1Score:u[0],side2Score:u[1]},l=Vl({analysis:e,set:p});return p.winningSide=l||void 0,{scoreString:n,set:p}}({analysis:h,lowSide:t,scoreString:r,value:m(n)});a&&(a.setNumber=i?.length+1||1),i=i?.concat(a).filter(Boolean)||[a],r=e||void 0}else console.log("error: unknown outcome")}else(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(d=!0,({scoreString:r,sets:i}=Am({analysis:h,scoreString:r,sets:i,lowSide:t})),o=void 0);if(d){i=i?.filter(Boolean);const{matchUpWinningSide:e}=Om({sets:i,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=e,!e||o&&![Da,Sa].includes(o)?!r||a||[em,Zl,nm].includes(o)||(o=void 0):(o="COMPLETED",i=i.filter((e=>{const{side1Score:t,side2Score:n,side1TiebreakScore:r,side2TiebreakScore:i}=e;return t||n||r||i}))),{updated:d,scoreString:r,sets:i,winningSide:a,matchUpStatus:o,info:p}}return{updated:d,scoreString:r,sets:i,winningSide:a,matchUpStatus:o,info:p}},validateScore:Bl,reverseScore:function(e){if(!e?.score)return{error:mt};const{sets:t}=e.score,n=t.map((e=>{const{side1TiebreakScore:t,side2TiebreakScore:n,winningSide:r,side1Score:i,side2Score:a,setNumber:o}=e;return pi({winningSide:r?3-r:void 0,side1TiebreakScore:n,side2TiebreakScore:t,side1Score:a,side2Score:i,setNumber:o})}));return{reversedScore:{sets:n,scoreStringSide1:_l({sets:n}),scoreStringSide2:_l({sets:n,reversed:!0})},...L}},analyzeSet:Lm};const Gm=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}],qm="ELO",$m="NTRP",Wm="WTN",Hm={ELO:qm,NTRP:$m,TRN:"TRN",UTR:"UTR",WTN:Wm},zm={[qm]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[$m]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[Wm]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}};var Ym={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Km={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Qm={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Jm={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Xm={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},Zm={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},ef={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},tf={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},nf={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},rf={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},af={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},of={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},sf={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},cf={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},uf={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},df={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},pf={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}};const lf={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:Ym,DOMINANT_DUO_MIXED:Km,LAVER_CUP:Qm,TEAM_DOUBLES_3_AGGREGATION:Jm,TIME_TENNIS_DUAL:Xm,TIME_TENNIS_PRO_CIRCUIT:Zm,USTA_BREWER_CUP:ef,USTA_OZAKI_CUP:tf,USTA_COLLEGE:nf,USTA_GOLD_TEAM_CHALLENGE:rf,USTA_INTERSECTIONAL:af,USTA_LEVEL_1:of,USTA_SECTION_BATTLE:sf,USTA_SOUTHERN_LEVEL_5:cf,USTA_TOC:uf,USTA_WTT_ITT:df,USTA_ZONAL:pf},mf="qualifierDrawPositionAssignment",ff="withdrawParticipantAtDrawPosition",hf="alternateDrawPositionAssignment",If="luckyLoserDrawPositionAssignment",gf="removeDrawPositionAssignment",Uf="swapDrawPositionAssignments",yf="modifyPairAssignment",vf="modifyParticipantOtherName",Sf="assignDrawPosition",wf="removeSeededParticipant",Pf="assignDrawPositionBye",Tf="modifySeedAssignment",Df="addPenalty",Rf="MODIFY_PAIR",bf="QUALIFIER",Nf="ALTERNATE",Mf="WITHDRAW",Af="ASSIGN",Ef="REMOVE",Cf="LUCKY",Of="REMOVE_SEED",Ff="SWAP",kf="NICKNAME",xf="SEED_VALUE",_f="PENALTY",Lf="BYE",Bf={MODIFY_PAIR_ASSIGNMENT:Rf,QUALIFYING_PARTICIPANT:bf,ALTERNATE_PARTICIPANT:Nf,WITHDRAW_PARTICIPANT:Mf,ASSIGN_PARTICIPANT:Af,LUCKY_PARTICIPANT:Cf,REMOVE_ASSIGNMENT:Ef,SWAP_PARTICIPANTS:Ff,ADD_NICKNAME:kf,REMOVE_SEED:Of,ADD_PENALTY:_f,ASSIGN_BYE:Lf,SEED_VALUE:xf},Vf={[po]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[rd,nd],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[kf,_f,bf,xf],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},jf="ADULT",Gf="JUNIOR",qf="WHEELCHAIR",$f={[go]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Bi]:30,default:60}}]},defaultDailyLimits:{[_i]:2,[Bi]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Ba],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[qf],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[jf,qf],minutes:{default:60,[Bi]:30}},{categoryTypes:[Gf],minutes:{default:60,[Bi]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[jf,qf],minutes:{default:30}},{categoryTypes:[Gf],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[jf,Gf],minutes:{default:30}},{categoryTypes:[qf],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},Wf={[So]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Hd]:{positioning:fd},[Wd]:{positioning:fd}},positioning:"SEPARATE"},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function Hf({participant:e,withISO2:t,withIOC:n}){const{person:r,individualParticipants:i}=e;[r,i?.map((({person:e})=>e))].flat().filter(Boolean).forEach((function(e){const{nationalityCode:r}=e||{};if(r){const i=Gm.find((({iso:e})=>e===r));n&&i?.ioc&&!e.iocNationalityCode&&(e.iocNationalityCode=i.ioc),t&&i?.iso2&&!e.iso2NationalityCode&&(e.iso2NationalityCode=i.iso2),i?.label&&!e.countryName&&(e.countryName=i.label)}}))}function zf({returnPreviousValues:e,itemSubTypes:t,itemType:n,element:r}){if(!r)return{error:mt,info:Xs};if(t&&!Array.isArray(t))return{error:xn,context:{itemSubTypes:t}};if(!Array.isArray(r.timeItems))return{error:Pn};const i=r.timeItems.filter((e=>e?.itemType===n)).filter((e=>!t?.length||t.some((t=>e?.itemSubTypes?.includes(t))))).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())),a=i.pop();if(a){const t={timeItem:a,...L};return e&&Object.assign(t,{previousItems:i}),t}return{info:Gn}}function Yf({returnPreviousValues:e,itemSubTypes:t,itemType:n,event:r}){if(!r)return{error:Ae};if(!r.timeItems)return{info:Gn};const{timeItem:i,previousItems:a,info:o}=zf({returnPreviousValues:e,element:r,itemSubTypes:t,itemType:n});return i&&{timeItem:i,previousItems:a}||{info:o}}function Kf({returnPreviousValues:e,tournamentRecord:t,itemSubTypes:n,itemType:r}){if(!t)return{error:$};if(!t.timeItems)return{info:Gn};const{timeItem:i,previousItems:a,info:o}=zf({element:t,returnPreviousValues:e,itemSubTypes:n,itemType:r});return i&&{timeItem:i,previousItems:a}||{info:o}}const Qf={[$u]:"groupParticipantIds",[Wu]:"pairParticipantIds",[Hu]:"teamParticipantIds"},Jf={[$u]:"groups",[Hu]:"teams"};function Xf({withIndividualParticipants:e,convertExtensions:t,tournamentRecord:n,withSignInStatus:r,withScaleValues:i,internalUse:a,withISO2:o,withIOC:s}){const c={};for(const u of n.participants??[]){const e=u?.participantId;e&&th({participantMap:c,participantId:e})}for(const u of n.participants??[]){const e=ii(u,t,a),{participantId:n,individualParticipantIds:d,participantType:p}=e;if(Object.assign(c[n].participant,e),d&&eh({individualParticipantIds:d,participantCopy:e,participantMap:c,participantType:p,participantId:n}),r&&(c[n].participant.signedIn=Zf(e)),i){const{ratings:t,rankings:r,seedings:i}=Ds({participant:e});c[n].participant.seedings=i,c[n].participant.rankings=r,c[n].participant.ratings=t}(s||o)&&Hf({participant:c[n].participant,withISO2:o,withIOC:s})}if(e){!function({participantMap:e,template:t}){const n=Object.values(e);for(const r of n){const n=r.participant;if(n.individualParticipantIds?.length){n.individualParticipants=[];for(const r of n.individualParticipantIds){const i=e[r].participant;n.individualParticipants.push(t?mi({template:t,source:i}):i)}}}}({participantMap:c,template:ci(e)?e:void 0})}return{participantMap:c}}function Zf(e){const{timeItem:t}=zf({itemType:Gu,element:e});return t?.itemValue===Yu}function eh({individualParticipantIds:e,participantCopy:t,participantMap:n,participantType:r,participantId:i}){for(const a of e){const o=n[a].participant;if(o[Qf[r]].push(i),[Hu,$u].includes(r)){const{participantRoleResponsibilities:e,participantOtherName:n,participantName:i,participantId:a,teamId:s}=t;o[Jf[r]].push({participantRoleResponsibilities:e,participantOtherName:n,participantName:i,participantId:a,teamId:s})}if(r===Wu){const t=e.find((e=>e!==a));n[a].pairIdMap[i]=t,n[a].pairIdMap[t]=i}}}function th({participantMap:e,participantId:t}){if(e[t])return;const n={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};e[t]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[_i]:{...n},[Bi]:{...n},[Hu]:{...n},...n}}}function nh({participantsProfile:e,useParticipantMap:t,tournamentRecord:n,contextProfile:r,inContext:i}){if(t){const t=Xf({...e,...r,tournamentRecord:n})?.participantMap;return{participantMap:t}}let a,o=ii(n.participants,!1,!0)||[];if((e?.withIOC||e?.withISO2)&&o.forEach((t=>Hf({participant:t,...e}))),(i||e?.withGroupings)&&o?.length&&({participantsWithGroupings:o,groupInfo:a}=gl({participantsProfile:e,deepCopy:!1,participants:o})),e?.withScaleValues&&o?.length)for(const s of o){const{ratings:e,rankings:t}=Ds({participant:s});s.rankings=t,s.ratings=e}return{participants:o,groupInfo:a}}function rh(e){if(!e?.tournamentRecord)return{error:$};let{participantMap:t,participants:n}=e;const{scheduleVisibilityFilters:r,participantsProfile:i,afterRecoveryTimes:a,useParticipantMap:o,policyDefinitions:s,tournamentRecord:c,inContext:u=!0,contextProfile:d,matchUpFilters:p,contextFilters:l,nextMatchUps:m,context:f}=e,h=e.tournamentId??c.tournamentId,I=c?.events??[];n||({participants:n,participantMap:t}=nh({participantsProfile:i,useParticipantMap:o,policyDefinitions:s,tournamentRecord:c,contextProfile:d,inContext:u}));const{appliedPolicies:g}=Xo({tournamentRecord:c}),U={...f,tournamentId:h,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},y=ss({policyDefinitions:s,tournamentRecord:c,contextProfile:d});return{matchUps:I.flatMap((e=>(U.eventDrawsCount=e.drawDefinitions?.length??0,ah({context:U,scheduleVisibilityFilters:r,tournamentAppliedPolicies:g,participantsProfile:i,afterRecoveryTimes:a,policyDefinitions:s,tournamentRecord:c,contextContent:y,contextFilters:l,contextProfile:d,matchUpFilters:p,participantMap:t,nextMatchUps:m,participants:n,inContext:u,event:e}).matchUps??[]))).concat(...c.matchUps??[])}}function ih(e){let{participants:t,participantMap:n,contextContent:r}=e;const{scheduleVisibilityFilters:i,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:u,tournamentRecord:d,contextFilters:p,contextProfile:l,drawDefinition:m,matchUpFilters:f,nextMatchUps:h,inContext:I,context:g,event:U}=e,{eventId:y,eventName:v,eventType:S,category:w,gender:P,matchUpFormat:T}=U??{},D={...g,eventId:y,eventType:S,eventName:v,category:w,gender:P,matchUpFormat:T,indoorOutDoor:U?.indoorOutdoor??d?.indoorOutdoor,surfaceCategory:U?.surfaceCategory??d?.surfaceCategory,endDate:U?.endDate};let R;t?.length||n||!d||({participants:t=[],participantMap:n,groupInfo:R}=nh({participantsProfile:o,useParticipantMap:u,policyDefinitions:c,tournamentRecord:d,contextProfile:l,inContext:I})),l&&!r&&(r=ss({policyDefinitions:c,tournamentRecord:d,contextProfile:l,drawDefinition:m,event:U}));return{...Cl({context:D,tournamentAppliedPolicies:a,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:d,drawDefinition:m,contextContent:r,contextFilters:p,contextProfile:l,matchUpFilters:f,participantMap:n,nextMatchUps:h,inContext:I,event:U}),groupInfo:R}}function ah(e){let{participants:t=[],contextContent:n,participantMap:r}=e;const{scheduleVisibilityFilters:i,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:u,tournamentRecord:d,contextFilters:p,contextProfile:l,matchUpFilters:m,nextMatchUps:f,inContext:h,context:I,event:g}=e;if(!g)return{error:Ae};const{eventId:U,eventName:y,endDate:v,category:S,gender:w,matchUpFormat:P}=g,T={...I,...pi({indoorOutDoor:g.indoorOutdoor??d?.indoorOutdoor,surfaceCategory:g.surfaceCategory??d?.surfaceCategory,endDate:g.endDate??d?.endDate,tournamentId:d?.tournamentId,matchUpFormat:P,eventName:y,category:S,gender:w,eventId:U})};let D;if(v&&(T.endDate=v),l&&!n&&(n=ss({policyDefinitions:c,tournamentRecord:d,contextProfile:l,event:g})),!t?.length&&!r&&d){const e=nh({participantsProfile:o,useParticipantMap:u,policyDefinitions:c,tournamentRecord:d,contextProfile:l,inContext:h});r=e.participantMap,t=e.participants??[],D=e.groupInfo}const R=g.drawDefinitions??[],b=Os({tournamentRecord:d,event:g}).scheduleTiming,N=R.flatMap((e=>{const{matchUps:u}=Cl({tournamentParticipants:t,tournamentAppliedPolicies:a,scheduleVisibilityFilters:i,context:T,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:d,contextFilters:p,contextProfile:l,drawDefinition:e,contextContent:n,matchUpFilters:m,participantMap:r,scheduleTiming:b,nextMatchUps:f,inContext:h,event:g});return u??[]}));return{matchUps:N,groupInfo:D}}function oh(e){if(!e?.tournamentRecord)return{error:$};let t=e.contextContent;const{scheduleVisibilityFilters:n,participantsProfile:r,afterRecoveryTimes:i,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:c=!0,contextFilters:u,contextProfile:d,matchUpFilters:p,nextMatchUps:l,context:m}=e,f=e.tournamentId??s.tournamentId,h=s?.events??[],{participants:I,participantMap:g,groupInfo:U}=nh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:d,inContext:c});d&&!t&&(t=ss({policyDefinitions:a,tournamentRecord:s,contextProfile:d}));const{appliedPolicies:y}=Xo({tournamentRecord:s}),v=u?.eventIds??[];return{...h.filter((e=>!v.includes(e.eventId))).map((e=>{const o=Ks({event:e}).flightProfile;return sh({context:{eventDrawsCount:o?.flights?.length||e.drawDefinitions?.length||0,...m},tournamentAppliedPolicies:y,scheduleVisibilityFilters:n,participantsProfile:r,afterRecoveryTimes:i,policyDefinitions:a,tournamentRecord:s,contextFilters:u,contextProfile:d,contextContent:t,matchUpFilters:p,participantMap:g,participants:I,tournamentId:f,nextMatchUps:l,inContext:c,event:e})})).reduce(((e,t)=>{const n=t&&Object.keys(t).filter((e=>!["success","matchUpsMap"].includes(e)));return n?.forEach((n=>{Array.isArray(t[n])&&(e[n]||(e[n]=[]),e[n]=e[n].concat(t[n]),e.matchUpsCount+=t[n].length)})),e}),{matchUpsCount:0}),groupInfo:U}}function sh(e){let{participants:t,contextContent:n,participantMap:r}=e;const{tournamentAppliedPolicies:i,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:u,tournamentRecord:d,contextFilters:p,contextProfile:l,matchUpFilters:m,nextMatchUps:f,tournamentId:h,inContext:I,context:g,event:U}=e;if(!U)return{error:Ae};const{eventId:y,eventName:v,endDate:S}=U,w={...g,...pi({eventId:y,eventName:v,endDate:S??d?.endDate,tournamentId:h??d?.tournamentId,indoorOutDoor:U.indoorOutdoor??d?.indoorOutdoor,surfaceCategory:U.surfaceCategory??d?.surfaceCategory})};let P;!t&&d&&({participants:t,participantMap:r,groupInfo:P}=nh({participantsProfile:o,policyDefinitions:c,useParticipantMap:u,tournamentRecord:d,contextProfile:l,inContext:I})),l&&!n&&(n=ss({policyDefinitions:c,tournamentRecord:d,contextProfile:l,event:U}));const T=(U.drawDefinitions??[]).reduce(((e,u)=>{const h=Ol({context:w,tournamentAppliedPolicies:i,scheduleVisibilityFilters:a,tournamentParticipants:t,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:d,drawDefinition:u,contextContent:n,contextFilters:p,contextProfile:l,matchUpFilters:m,participantMap:r,nextMatchUps:f,inContext:I,event:U}),g=Object.keys(h);return g?.forEach((t=>{Array.isArray(h[t])&&(e[t]||(e[t]=[]),e[t]=e[t].concat(h[t]))})),e}),{});return{...T,...L,groupInfo:P}}function ch({drawDefinition:e,matchUpsMap:t,structureId:n}){const r=rp({drawDefinition:e,structureId:n});if(r.error)return Mi({result:r});const{matchUps:i}=Kp({structure:r.structure,matchUpsMap:t});return{...ed({matchUps:i}),matchUps:i,matchUpsMap:t}}function uh({finishingPositions:e,drawDefinition:t,structureId:n}){const{roundProfile:r}=ch({drawDefinition:t,structureId:n}),i=r&&Object.keys(r);return i?.reduce(((t,n)=>(dh(r?.[n]).forEach((r=>{e.forEach((e=>{(function({position:e,rangeDefinition:t}){if(!Array.isArray(t))return!1;if(t.reduce(((e,t)=>e||isNaN(t)),!1))return!1;const[n,r]=t;return E(n,(r||n)+1).includes(e)})({position:e,rangeDefinition:r})&&(t[e]={roundNumber:n})}))})),t)),{})}function dh(e){return[P(e?.finishingPositionRange?.loser||[]),P(e?.finishingPositionRange?.winner||[])]}function ph(e){return dh(e).map((e=>E(e[0],e[1]&&e[1]+1||e[0]+1)))}function lh({drawDefinition:e,structureIds:t,matchUpsMap:n}){if(t&&!Array.isArray(t))return{error:xn,context:{structureIds:t}};if(!e)return{error:Y};const r=(t=t??(e.structures??[]).filter((e=>e.stage!==rd)).map((({structureId:e})=>e))).map((t=>{const{roundProfile:r}=ch({drawDefinition:e,matchUpsMap:n,structureId:t}),i=r&&Object.values(r);return i?.map(ph).flat()})).flat(),i=r.filter((e=>1===e?.length)).sort(l).flat();return{positionsNotPlayedOff:P(r.flat()).filter((e=>!i.includes(e))),positionsPlayedOff:i}}function mh({excludeRoundNumbers:e=[],playoffPositions:t=[],drawDefinition:n,structureId:r}){if(!n)return{error:Y};if(!r)return{error:Te};if(!t)return{error:mt,info:"missing playoffPositions"};const i=lh({drawDefinition:n});if(i.error)return i;const a=i.positionsPlayedOff,o=uh({finishingPositions:t.filter((e=>!a.includes(e))),drawDefinition:n,structureId:r}),s=Object.values(o).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>m(e))).filter((t=>!e.includes(t))),c=uh({finishingPositions:a,drawDefinition:n,structureId:r}),u=c?Object.values(c).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>m(e))):[],d=s.filter((e=>!u.includes(e))).sort(l),{roundProfile:p}=ch({drawDefinition:n,structureId:r}),f=d.map((e=>{const t=p?.[e].finishingPositionRange.loser,[n,r]=t??[0,0];return E(n,(r||n)+1)})).flat().sort(l),{playoffRoundsRanges:h}=function({playoffSourceRounds:e,roundProfile:t}){const n=e.map((e=>{const n=t[e].finishingPositionRange.loser,[r,i]=n,a=E(r,(i||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:a,roundNumber:e}}));return{playoffRoundsRanges:n}}({playoffSourceRounds:d,roundProfile:p}),I=[...d,...u];return{playoffPositionsReturned:f,playedOffSourceRounds:u,playoffRoundsRanges:h,playoffSourceRounds:d,sourceRounds:I,roundProfile:p}}function fh({drawDefinition:e,structureId:t}){if(!e)return{error:Y};const{matchUps:n,matchUpsMap:r}=ih({inContext:!0,drawDefinition:e}),{positionsNotPlayedOff:i,positionsPlayedOff:a}=lh({drawDefinition:e,matchUpsMap:r}),{structures:o}=ip({drawDefinition:e}),s=o.filter((e=>!t&&e.stage!==ad||e.structureId===t)),c={};for(const u of s){const t=u?.structureId,r=hh({playoffPositions:i,drawDefinition:e,structure:u,matchUps:n}),{error:a,...o}=r;if(a)return r;c[t]={structureId:t,...o}}return t?{positionsPlayedOff:a,...c[t]}:{availablePlayoffProfiles:Object.values(c),availablePlayoffRounds:Object.values(c),positionsPlayedOff:a}}function hh({playoffPositions:e,drawDefinition:t,structure:n,matchUps:r}){const i=n?.structureId,{links:a}=Rl({drawDefinition:t,structureId:i});if(n.structureType===Id||n.structures){const e=op({structure:n})?.positionAssignments?.length,o=n.structures.length,s=(e??0)/o,c=a.source?.flatMap((({source:e})=>e?.finishingPositions||[]))||[],u=E(1,s+1).filter((e=>!c.includes(e))),d=r.find((e=>e.containerStructureId===i&&e.finishingPositionRange))?.finishingPositionRange?.winner||[0,1],p=a?.source.map((({target:e})=>e.structureId)),{positionsPlayedOff:l,positionsNotPlayedOff:m}=lh({structureIds:p,drawDefinition:t}),f=[...l??[],...m],h=E(d[0],d[1]+1).filter((e=>!f.includes(e))),I=x(h,h.length/u.length);return{positionsNotPlayedOff:h,playoffFinishingPositionRanges:u.map(((e,t)=>{const n=I[t];return{finishingPosition:e,finishingPositions:n,finishingPositionRange:[Math.min(...n||[]),Math.max(...n||[])].join("-")}})),finishingPositionsAvailable:u,finishingPositionsPlayedOff:c,positionsPlayedOff:l,groupCount:o,groupSize:s}}const o=a?.source?.filter((e=>e.linkCondition!==Td)).map((e=>e.source?.roundNumber))||[],s=a?.source?.filter((e=>e.linkCondition===Td)).map((e=>e.source?.roundNumber))||[],{playoffSourceRounds:c,playoffRoundsRanges:u,roundProfile:d,error:p}=mh({excludeRoundNumbers:o,playoffPositions:e,drawDefinition:t,structureId:i});for(const l of s){const e=a?.source.find((e=>e.source.roundNumber===l)),t=e?.target.roundNumber,n=e?.target.structureId,i=r.filter((({roundNumber:e,structureId:r})=>r===n&&e===t)),o=i.filter((({sides:e})=>e.find((e=>e.participantFed&&!e.participantId)))).length;if(c&&o===i.length){c.push(l);const e=d?.[l]?.finishingPositionRange?.loser;if(e){const t=Math.min(...e),n=t+o,r=E(t,n),i={finishingPositionRange:[t,n-1].join("-"),finishingPositions:r,roundNumber:l};u.push(i)}}}return c&&c.sort(l),u.sort(((e,t)=>e.roundNumber-t.roundNumber)),{playoffRounds:c,playoffRoundsRanges:u,error:p}}const Ih={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",red:"\x1b[31m",brightred:"\x1b[91m",green:"\x1b[32m",brightgreen:"\x1b[92m",yellow:"\x1b[33m",brightyellow:"\x1b[93m",blue:"\x1b[34m",brightblue:"\x1b[94m",lightblue:"\x1b[105m",magenta:"\x1b[35m",brightmagenta:"\x1b[95m",cyan:"\x1b[36m",brightcyan:"\x1b[96m",white:"\x1b[37m",brightwhite:"\x1b[97m"},gh=[];function Uh(e,t){"string"==typeof e&&(e={method:e}),(t||ar())&&gh.push(e)}function yh(e){const t=function(e){const t=gh.slice();return e&&(gh.length=0),t}(e),n=t.map((e=>{const{color:t,keyColors:n,method:r,newline:i}=e,a=Object.keys(Ih).includes(t)?Ih[t]:Ih.cyan,o=Object.keys(e).filter((e=>!["color","keyColors","method","newline"].includes(e))).map((t=>{const r=n&&Object.keys(n).includes(t)&&Ih[n[t]]?Ih[n[t]]:Ih.brightwhite;return`${Ih.white}${t}: ${r}${e[t]}`})).join(", ");return[i?"\n":"",a,r,r?.length<15?"\t\t":"\t",Ih.white,o,Ih.reset,"\n"].join("")}));n?.length&&console.log(...n)}function vh({collectionDefinitions:e=[],collectionGroups:t=[]}){let n=0;const{groupValueNumbers:r}=Xp({collectionGroups:t});let i;for(const a of e||[]){const{collectionValueProfiles:e,collectionGroupNumber:t,collectionValue:o,matchUpCount:s,matchUpValue:c,scoreValue:u,setValue:d}=a,p=t&&r.includes(t);if(S(d||u))i=!0;else{if(p)continue;if("number"==typeof o&&S(o))n+=o;else if(e?.length)for(const t of e)n+=t.matchUpValue;else"number"==typeof c&&S(c)&&(n+=(s||0)*c)}}for(const a of t)n+=a.groupValue||0;if(i||!n)return{aggregateValue:!0};return{valueGoal:Math.floor(n/2)+1}}function Sh({finishingPositionOffset:e=0,finishingPositionLimit:t,positionsFed:n,roundsCount:r,roundLimit:i,matchUps:a,lucky:o,fmlc:s}){if(!La(a))return[];const{roundProfile:c,roundNumbers:u=[]}=ed({interpolate:!0,matchUps:a});r=r||Math.max(...u,0);const d=i?r-i:0,p=d&&c?.[r-d]?.matchUpsCount,l=c&&Object.values(c).map(di("matchUpsCount")),m=(e,n)=>{let r=Math.min(...e);p&&n&&1===r&&(r=p);let i=Math.max(...e);return t&&i>t&&(i=t),[r,i]},f=c&&Object.assign({},...u.map((t=>{const i=(r||0)+1-t-d,a=c[t].matchUpsCount,u={finishingPositionRange:{},finishingRound:i},p=l?.slice(t-1).reduce(((e,t)=>e+(t||0)),0),f=1+e+(s&&1!==t&&n||0),h=E(f,o?f+2*a:p+f+1),I=p+1-a,g=m(h.slice(I)),U=m(h.slice(0,I),!0);return u.finishingPositionRange={loser:g,winner:U},{[t]:u}}))),h=ar({finishingRound:!0});return a.filter(Boolean).forEach((e=>{const t=e.roundNumber&&f[e.roundNumber];h&&!t&&console.log({roundFinishingData:f,matchUp:e}),e.finishingRound=t?.finishingRound,e.finishingPositionRange=t?.finishingPositionRange})),a}function wh({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:n}){if(!t)return{error:Y};const r={loserMatchUpIds:{},winnerMatchUpIds:{}};e||({matchUps:e,matchUpsMap:n}=Cl({inContext:!0,drawDefinition:t,matchUpsMap:n}));const i=n?.drawMatchUps.some((e=>e.finishingPositionRange));if(!i&&1===t?.structures?.length&&!t?.structures[0].structures){Sh({matchUps:n?.drawMatchUps||[]})}return(e||[]).filter((({collectionId:e})=>!e)).forEach((i=>{const{matchUpId:a,structureId:o}=i,s=bl({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:a}),{winnerMatchUp:c,loserMatchUp:u}=s.targetMatchUps,d=c?.matchUpId,p=u?.matchUpId,l=Lp({matchUpsMap:n,structureId:o}).find((e=>e.matchUpId===a));if(l&&(d&&(r.winnerMatchUpIds[l.matchUpId]=d,Object.assign(l,{winnerMatchUpId:d}),Object.assign(i,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[l.matchUpId]=p,i.loserMatchUpId=p,l.loserMatchUpId=p,i.finishingPositionRange))){const e=u.finishingPositionRange&&[...i.finishingPositionRange.loser,...u.finishingPositionRange.loser],t=e&&[Math.min(...e),Math.max(...e)];i.finishingPositionRange.loser=t,l.finishingPositionRange.loser=t}})),{inContextDrawMatchUps:e,goesToMap:r}}function Ph(e){const{sides:t,matchUpType:n}=e||{},r=e.potentialParticipants?.length?e.potentialParticipants.flat().map((e=>n===Bi?e?.individualParticipantIds||[]:e.participantId)).flat():[],i=(t||[]).map((e=>n===Bi&&(e?.participant?.individualParticipantIds||[])||e?.participantId&&[e.participantId]||[])).flat();return{individualParticipantIds:i.concat(r).flat(),enteredIndividualParticipantIds:i,potentialIndividualParticipantIds:r}}function Th({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:n,tournamentRecords:r,policyDefinitions:i,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:c}){if("object"!=typeof r||!Object.keys(r).length)return{error:q};return{matchUps:Object.keys(r).map((u=>{const d=r[u];return rh({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:n,policyDefinitions:i,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:c}).matchUps??[]})).flat()}}function Dh({scheduleVisibilityFilters:e,participantsProfile:t,tournamentRecords:n,policyDefinitions:r,matchUpFilters:i,contextFilters:a,nextMatchUps:o,inContext:s}){if("object"!=typeof n||!Object.keys(n).length)return{error:q};const c=Object.keys(n).map((c=>{const u=n[c];return oh({scheduleVisibilityFilters:e,participantsProfile:t,policyDefinitions:r,tournamentRecord:u,matchUpFilters:i,contextFilters:a,nextMatchUps:o,inContext:s})})),u={};return{...c.reduce(((e,t)=>(Object.keys(t).forEach((n=>{Array.isArray(t[n])&&(e[n]||(e[n]=[]),e[n]=e[n].concat(t[n])),"groupInfo"===n&&Object.assign(u,t[n])})),e)),{}),groupInfo:u}}function Rh(e,t){return function(e,t){return(cd[e?.stage]||0)-(cd[t?.stage]||0)}(e,t)||(e?.stageSequence||0)-(t?.stageSequence||0)||e?.roundNumber&&t.roundNumber&&e?.roundNumber-t?.roundNumber||(e?.roundPosition||0)-(t?.roundPosition||0)}function bh(e){let t=e.tournamentRecords??{};const n=e.matchUps??[];let r=e.drawIds??[];const{includeParticipantDependencies:i,tournamentRecord:a,drawDefinition:o}=e;if(!Array.isArray(n))return{error:Ze};if(!Array.isArray(r))return{error:le};const s=e.matchUpIds?.length?e.matchUpIds:n.map((e=>e.matchUpId));if(!Array.isArray(s))return{error:Je};const c={},u={},d={},p={};a&&!Object.keys(t).length&&(t={[a.tournamentId]:a});const l=Object.values(t),m=l.reduce(((e,t)=>e.concat(t.events??[]).map((e=>(e.drawDefinitions||[]).map((e=>e.links||[])))).flat(1/0)),[]).filter((({linkType:e})=>e===Sd));let f=n;if(m.length){f=Th({nextMatchUps:!0,tournamentRecords:t}).matchUps;const e=m.reduce(((e,t)=>{const n=t.source?.structureId,r=t.target?.structureId;return n&&r&&(d[r]=n),n&&!e.includes(n)&&e.push(n),e}),[]);for(const t of e)c[t]=[];for(const t of f??[]){const n=t.containerStructureId||t.structureId;e.includes(n)&&c[n].push(t.matchUpId)}}const h=e=>{u[e]||(u[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[e]=[])},I=(e,t)=>{u[e].matchUpIds.forEach((e=>{u[t].matchUpIds.push(e)})),u[t].matchUpIds.push(e),u[e].dependentMatchUpIds.push(t),i&&u[e].participantIds.forEach((e=>u[t].participantIds.push(e)))},g=e=>{const t=Object.keys(c).length;for(const n of e||[]){const{matchUpId:e,winnerMatchUpId:r,loserMatchUpId:a}=n;if(!s.length||s.includes(e)){if(h(e),i){const{individualParticipantIds:t}=Ph(n);u[e].participantIds=t}r&&(h(r),I(e,r),p[r].push(e)),a&&(h(a),I(e,a),p[a].push(e)),u[e].sources.push(p[e]);const o=p[e].map((e=>u[e].sources[0])).flat(),s=p[e].map((e=>u[e].sources[1])).flat();if(u[e].sources.push(o,s),t){const t=n.containerStructureId||n.structureId,r=d[t];if(c[r])for(const n of c[r])h(n),I(n,e),p[n].push(e)}}}};if(o)wh({drawDefinition:o}),f?.length||(f=ih({drawDefinition:o}).matchUps),g(f);else{if(f?.length||(f=Th({nextMatchUps:!0,tournamentRecords:t}).matchUps),!r.length){const e=l?.length?l.map((({events:e=[]})=>e.map((({drawDefinitions:e=[]})=>e.map((({drawId:e})=>e)))))).flat(1/0):[];e&&(r=e)}for(const e of r){const n=f?.filter((t=>t.drawId===e)).sort(Rh),r=n?.find((({roundPosition:e})=>!e));if(!r){const r=n?.find((({tournamentId:e})=>e)),{drawDefinition:i}=Qs({tournamentRecord:t[r?.tournamentId],drawId:e});i&&wh({drawDefinition:i})}g(n)}}return{positionDependencies:c,matchUpDependencies:u,sourceMatchUpIds:p,matchUps:f,...L}}function Nh({tournamentRecords:e,matchUps:t}){if(!La(t))return{error:Ze};if(t.some((({matchUpId:e,hasContext:t})=>e&&!t)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Tn};const n=E(1,Math.max(...t.map((({schedule:e})=>e?.courtOrder||1)).map((e=>m(e))))+1).map((e=>t.filter((t=>m(t.schedule?.courtOrder)===e)))),r={},i={},a={};n.flat().filter(Boolean).sort(Rh).forEach((({schedule:e})=>delete e[$s]));const o=bh({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:P(t.map((({drawId:e})=>e)))}).matchUpDependencies,s=n.map(((e,t)=>e.reduce(((e,n)=>{if(!n.matchUpId)return e;const{matchUpId:s,winnerMatchUpId:c,loserMatchUpId:u,schedule:d,sides:p,potentialParticipants:l}=n,m=d?.courtId;r[s]=t,i[m]=[],e.matchUpIds.push(s),a[s]=n;const f=o[s].matchUpIds;f.length&&e.sourceMatchUpIds.push(...f);const h=p?.map((e=>[e.participant?.individualParticipantIds,e.participantId])).flat().filter(Boolean)||[],I=l?.flat().map((({individualParticipantIds:e,participantId:t})=>[e,t])).flat().filter(Boolean)||[];return e.participantIds.push(...I,...h),c&&e.targetMatchUpIds.push(c),u&&e.targetMatchUpIds.push(u),e}),{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]}))),c=s.map((()=>[])),u=(e,t,n,o)=>{if(!a[e].schedule[$s]){a[e].schedule[$s]=t,a[e].schedule[Bs]=o,c[r[e]].push({matchUpId:e,issueType:n,issueIds:o,issue:t});const s=a[e].schedule.courtId;i[s]||(i[s]=[]),i[s].push({matchUpId:e,issue:t,issueType:n,issueIds:o})}};return s.forEach(((e,t)=>{const n=t?s[t-1]:void 0,r=s.slice(t+1),i={},c=R(e.participantIds),d=Object.keys(c).filter((e=>c[e]>1)),p=e.matchUpIds.filter((e=>o[e].participantIds.some((e=>d.includes(e)))));p.forEach((e=>{i[e]||(i[e]={}),i[e][Vs]||(i[e][Vs]=p.filter((t=>t!==e)))}));const l=n&&e.participantIds.filter((e=>n.participantIds.includes(e)));l&&l.forEach((t=>{const r=e.matchUpIds.concat(n.matchUpIds).filter((e=>o[e].participantIds.includes(t)));r.forEach((e=>{i[e]||(i[e]={}),i[e][js]||(i[e][js]=r.filter((t=>t!==e)))}))})),e.matchUpIds.forEach((t=>{const s=o[t].matchUpIds;for(const e of r){const n=e.matchUpIds.filter((e=>s.includes(e)));n?.length&&(n.forEach((e=>u(e,Gs,Ls,[t]))),u(t,Gs,Ls,n))}if(i[t]?.[Vs]&&u(t,Vs,_s,i[t][Vs]),e.sourceMatchUpIds.includes(t)){const n=e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t)));u(t,Vs,Ls,n),e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t))).forEach((e=>u(e,Vs,Ls,[t])))}const c=n?.matchUpIds?.filter((e=>{return n=e,o[t].sources.reduce(((e,t,r)=>t.includes(n)&&r+1||e),0)>1;var n}));if(c?.length&&(u(t,qs,Ls,c),c.forEach((e=>u(e,qs,Ls,[t])))),i[t]?.[js]&&u(t,js,_s,i[t][js]),n?.targetMatchUpIds?.includes(t)){const e=a[t].schedule.courtId,r=s.filter((e=>n.matchUpIds.includes(e)));r.some((t=>a[t].schedule.courtId===e))||(r.forEach((e=>u(e,js,Ls,[t]))),u(t,js,Ls,r))}}))})),{courtIssues:i,rowIssues:c}}function Mh(e,t){return(e||"").localeCompare(t||"")}function Ah(e){if(!e)return{};const t=[],n=e.tieFormatName,r=e.collectionDefinitions?.map((e=>{const{matchUpType:n,matchUpFormat:r,matchUpCount:i,category:a,gender:o}=e;t.includes(r)||t.push(r);const s=a?.ageCategoryCode;return[i,n===Li?"D":"S",s,r,o].join(";")})).join("|");return{tieFormatName:e&&n||"UNNAMED",matchUpFormats:t,tieFormatDesc:r}}function Eh({considerations:e={},descendant:t,ancestor:n}){const r={},i={},{matchUpFormats:a,tieFormatDesc:o}=Ah(t),{matchUpFormats:s,tieFormatDesc:c}=Ah(n),u=P((a??[]).filter((e=>!(s??[]).includes(e))).concat((s??[]).filter((e=>!(a??[]).includes(e))))),d=!(!e?.collectionName||t.collectionDefinitions.map((({collectionName:e})=>e)).join("|")===n.collectionDefinitions.map((({collectionName:e})=>e)).join("|")),p=!(!e?.collectionOrder||t.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")===n.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")),l=Object.assign({},...(t?.collectionDefinitions||[]).map((e=>({[e.collectionId]:e})))),m=Object.assign({},...(n?.collectionDefinitions||[]).map((e=>({[e.collectionId]:e}))));r.collectionIds=F(Object.keys(l),Object.keys(m)),i.collectionIds=F(Object.keys(m),Object.keys(l)),r.collectionsValue=Ch(l),i.collectionsValue=Ch(m),r.groupsCount=n?.collectionGroups?.length??(0-(t?.collectionGroups?.length??0)||0),i.groupsCount=r.groupsCount?-1*r.groupsCount:0;const f=r.collectionsValue.totalValue-i.collectionsValue.totalValue,h=r.collectionsValue.totalMatchUps-i.collectionsValue.totalMatchUps,I=i.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,g=i.collectionsValue.assignmentValues.some(((e,t)=>{const n=r.collectionsValue.assignmentValues[t];return!n||(e.valueKey!==n.valueKey||(e.value!==n.value||!!Array.isArray(e.value)&&e.value.every(((e,t)=>n.value[t]===e))))})),U=d||p||c!==o||I||g||0!==f,y=[...i.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],v=y.length&&y;return{matchUpFormatDifferences:u,matchUpCountDifference:h,descendantDifferences:r,ancestorDifferences:i,orderDifference:p,valueDifference:f,nameDifference:d,descendantDesc:o,ancestorDesc:c,...L,different:U,invalid:v}}function Ch(e){const t=[],n=[];let r=0;return{totalValue:Object.keys(e).sort(Mh).reduce(((i,a)=>{const o=e[a],{collectionValueProfiles:s,collectionValue:c,matchUpCount:u,matchUpValue:d,scoreValue:p,setValue:l}=o,m={collectionValueProfiles:s,collectionValue:c,matchUpValue:d,scoreValue:p,setValue:l},f=Object.keys(m).filter((e=>![void 0,null].includes(m[e])));1!==f.length&&t.push({collectionId:a});const h=f[0];if(h){const e="collectionValueProfiles"===h?Object.values(s):m[h];n.push({valueKey:h,value:e})}return r+=u,s?i+s.reduce(((e,t)=>e+t.value),0):u?S(d)?i+d*u:S(p)?i+p*u:S(l)?i+l*u:i+c:i}),0),totalMatchUps:r,invalidValues:t,assignmentValues:n}}const Oh=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function Fh(e){return si(e)?e.split(" ").map((e=>e.split("").map(((e,t)=>t?e.toLowerCase():e.toUpperCase())).join(""))).join(" "):e}function kh(e){return si(e)?Fh(e.replace(/_/g," ")):e}const xh=({finishingPosition:e=Xd,qualifyingRoundNumber:t,structureAbbreviation:n,seedAssignments:r=[],stageSequence:i=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:c,structureName:u,matchUpType:d,matchUps:p=[],structureId:l,roundOffset:m,roundLimit:f,stageOrder:h,structures:I,stage:g})=>{const U={structureId:l??Ii(),structureAbbreviation:n,finishingPosition:e,seedAssignments:r,matchUpFormat:s,stageSequence:i,structureName:u};a&&(U.structureOrder=a),c&&(U.structureType=c),o&&("string"==typeof o?U.seedingProfile=o:"object"==typeof o&&"string"==typeof o.positioning&&(U.seedingProfile=o.positioning)),d&&(U.matchUpType=d),m&&(U.roundOffset=m),h&&(U.stageOrder=h),f&&(U.roundLimit=f),g&&(U.stage=g),t&&(U.qualifyingRoundNumber=t);const y=p.flatMap((({drawPositions:e})=>e)).filter(Boolean);return I?U.structures=I:(U.matchUps=p,U.positionAssignments=P(y).sort(((e,t)=>e-t)).map((e=>({drawPosition:e})))),U};function _h({drawPositions:e}){const t=[].concat(...e.map((t=>e.filter((e=>e!==t)).map((e=>[t,e]))))),n=P(t.map(Lh)).map((e=>e.split("|").map((e=>+e))));return{groupMatchUps:t,uniqueMatchUpGroupings:n}}function Lh(e){return[...e].sort(l).join("|")}function Bh({groupSize:e,drawPositionOffset:t}){const n=e=>[...Array(e)].map(((e,t)=>t)),r=n(2*Math.round(e/2)+1).slice(1),i=n(r.length-1).map((()=>[]));let a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach(((e,t)=>{a.forEach(((e,n)=>{i[t].push([a[n],o[n]])}));const n=a.shift(),r=a.pop(),s=o.shift();a=[n,s,...a].filter(Boolean),o=[...o,r].filter(Boolean)}));const s=a.shift(),c=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,c].filter(Boolean);const d=e=>e[0].reduce(((e,t)=>e+t));return[...i].reverse().sort(((e,t)=>d(e)-d(t))).map((n=>n.filter((t=>t.every((t=>t<=e)))).map((e=>Lh(e.map((e=>e+t)))))))}const Vh={getRoundRobinGroupMatchUps:_h,determineRoundNumber:function({rounds:e,hash:t}){return e.reduce(((e,n,r)=>n.includes(t)?r+1:e),void 0)},drawPositionsHash:Lh,groupRounds:Bh};function jh(e){const{groupNameBase:t="Group",playoffAttributes:n,stageSequence:r=1,structureOptions:i,appliedPolicies:a,seedingProfile:o,stage:s=nd,matchUpType:c,roundTarget:u,structureId:d,groupNames:p,drawSize:l,idPrefix:m,isMock:f,uuids:h}=e,I=e.structureName??n?.[0]?.name??kh(nd),{groupCount:g,groupSize:U}=function({appliedPolicies:e,structureOptions:t,drawSize:n}){let r=t?.groupSize;const i=t?.groupSizeLimit||8,{validGroupSizes:a}=Gh({groupSizeLimit:i,drawSize:n}),o=a&&Math.max(...a),s=r&&a?.includes(r);s||(r=r&&r>4||!a?.includes(4)?o:4);const c=Math.ceil(n/r);return{groupSize:r,groupCount:c}}({structureOptions:i,appliedPolicies:a,drawSize:l}),y=Jd;let v;const S=E(1,g+1).map((e=>{const n=function({structureOrder:e,matchUpType:t,groupSize:n,drawSize:r,idPrefix:i,isMock:a,uuids:o}){const s=(e-1)*n,c=E(1+s,n+1+s),{uniqueMatchUpGroupings:u}=_h({drawPositions:c}),d=Bh({groupSize:n,drawPositionOffset:s}),p=u.map(m).sort(((e,t)=>(e.roundNumber||1/0)-(t.roundNumber||1/0)));return p;function l(e){return d.reduce(((t,n,r)=>n.includes(e)?r+1:t),void 0)}function m(n){const s=l(Lh(n)),c=[1,r],u=function({structureOrder:e,drawPositions:t,roundNumber:n,idPrefix:r,uuids:i}){return r?`${r}-${e}-${n}-DP-${t.join("-")}`:i?.pop()||Ii()}({structureOrder:e,drawPositions:n,roundNumber:s,idPrefix:i,uuids:o}),d={matchUpStatus:s?Ki.ToBePlayed:Ki.Bye,matchUpType:t,finishingPositionRange:{winner:c,loser:c},drawPositions:n,roundNumber:s,matchUpId:u};return a&&(d.isMock=!0),d}}({groupSize:U,structureOrder:e,matchUpType:c,drawSize:l,idPrefix:m,isMock:f});v=Math.max(...n.map((({roundNumber:e})=>e)));const r=p?.[e-1]??`${t} ${e}`;return xh({structureId:h?.pop(),structureType:hd,finishingPosition:y,structureOrder:e,structureName:r,matchUps:n})})),w=xh({structureId:d||h?.pop(),structureType:Id,finishingPosition:y,seedingProfile:o,structureName:I,stageSequence:r,structures:S,stage:s});return u&&Js({extension:{name:qo,value:u},element:w}),{structures:[w],maxRoundNumber:v,groupCount:g,links:[],groupSize:U,...L}}function Gh({drawSize:e,groupSizeLimit:t=10}){const n=E(3,t+1).filter((t=>{const n=Math.ceil(e/t),r=n*t-e,i=Math.ceil(e/n),a=Math.ceil(r/n);return(!r||r<t)&&i===t&&i>=3&&a<2}));return{...L,validGroupSizes:n}}function qh(e){const{roundRobinGroupsCount:t,participantsCount:n,cluster:r}=e;if(!S(n))return{seedBlocks:void 0,...Mi({result:{error:xn},context:{participantsCount:n},stack:"getSeedBlocks"})};const i=y(n);if(t){const e=Math.min(t,i),n=[];let r=1;for(E(0,e).forEach((()=>{n.push([r]),r++}));r<i;){const t=E(r,r+e);r+=e,n.push(t)}return{...L,seedBlocks:n}}const a=E(1,i+1),o=[];let s=i/2;for(;s>1;){const e=x(a,s),t=e.length;e.forEach(((e,n)=>{let i;const a=n<t/2,s=n%2==0,c=e[0],u=e[e.length-1];i=r&&t>4?8===t?a?u:c:s?c:u:a?c:u,k(e,o)||o.push(i)})),s/=2}const c=a.filter((e=>!o.includes(e)));for(;c.length;)c.length%2==0?o.push(c.pop()):o.push(c.shift());const u=E(0,20).map((e=>Math.pow(2,e)));u.unshift(1);const d=u.indexOf(i);let p=0;const l=[];return E(0,d).forEach((e=>{l.push(o.slice(p,p+u[e])),p+=u[e]})),{...L,seedBlocks:l}}function $h({roundRobinGroupsCount:e,drawSize:t}){const n="getSeedGroups";if(!S(t))return{seedGroups:void 0,...Mi({result:{error:xn},context:{drawSize:t},stack:n})};if(e){if(!S(e))return{seedGroups:void 0,...Mi({context:{roundRobinGroupsCount:e},result:{error:xn},stack:n})};let r=1;return{seedGroups:E(0,Math.floor(t/e)).map((()=>{const t=E(r,r+e);return r+=e,t}))}}{const{seedBlocks:n}=qh({participantsCount:t,roundRobinGroupsCount:e});let r=0;return{seedGroups:(n||[]).map((e=>(e||[]).map((()=>(r+=1,r)))))}}}function Wh({roundRobinGroupsCount:e,participantsCount:t}){if(e){const{validGroupSizes:n}=Gh({drawSize:t}),r=n?.map((e=>Math.ceil(t/e)));if(!r?.includes(e))return Mi({context:{roundRobinGroupsCount:e},result:{error:xn}})}const{seedGroups:n}=$h({drawSize:t,roundRobinGroupsCount:e}),r=n?.map((e=>Math.min(...e)))||[];return{...L,seedingThresholds:r}}function Hh({drawDefinition:e,stages:t}){if(!e)return{error:Y};const n=P((e?.structures||[]).filter((e=>!t?.length||e.stage&&t.includes(e.stage))).map((e=>{const{positionAssignments:t}=op({structure:e});return t?t.map(di("participantId")):[]})).flat().filter(Boolean));return{...L,assignedParticipantIds:n}}function zh({requireTimeStamp:e,scaleAttributes:t,participant:n}){if(!n)return{error:xt};if("object"!=typeof t)return{error:xn};if(n.timeItems||(n.timeItems=[]),Array.isArray(n.timeItems)){const{accessor:r,scaleType:i,eventType:a,scaleName:o}=t,s=[ws,i,a,o].join("."),c=n.timeItems.filter((e=>e?.itemType===s)).filter((t=>!e||t?.itemDate)).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))).pop();if(c){const[e,t,n,i]=c.itemType?.split(".")??[];if(e!==ws)return{error:Rn};const a=r&&oi({element:c.itemValue,accessor:r}),o=a?.value||c.itemValue,s={eventType:n,scaleDate:c.itemDate,scaleValue:o,scaleName:i,scaleType:t};return{...L,scaleItem:s}}}return{...L,scaleItem:void 0}}function Yh({court:e,date:t}){const n=t&&e.dateAvailability.find((e=>ni(e.date,t))),r=e.dateAvailability.find((e=>!e.date));return n||r}function Kh({includeBookingTypes:e=[],courtDate:t}){const n=[];let r=Jr(t.startTime);(t.bookings||[]).filter((t=>!t.bookingType||!e.includes(t.bookingType))).sort(((e,t)=>qr(e.startTime).localeCompare(qr(t.startTime)))).forEach((e=>{const t={startTime:$r(r.toISOString()),endTime:e.startTime};Jr(e.startTime)>r&&n.push(t),Jr(e.endTime)>r&&(r=Jr(e.endTime))}));const i={startTime:$r(r.toISOString()),endTime:t.endTime};return Jr(t.endTime)>r&&n.push(i),n}function Qh(e){const{averageMatchUpMinutes:t,includeBookingTypes:n,periodStart:r,date:i}=e,a=e.courts,o=Jr(r),s=ei(o,t),{enoughTime:c}=function({averageMatchUpMinutes:e,includeBookingTypes:t,periodStartTime:n,periodEndTime:r}){function i(t){const i=Jr(t.startTime),a=Jr(t.endTime);return!(i>n)&&(!(a<r)&&Xr(n,a)>=e)}return{enoughTime:e=>!!Kh({includeBookingTypes:t,courtDate:e}).filter(i).length}}({averageMatchUpMinutes:t,includeBookingTypes:n,periodStartTime:o,periodEndTime:s});return{availableToScheduleCount:(a?.filter((e=>{if(!Array.isArray(e.dateAvailability))return!1;const t=Yh({date:i,court:e});return!(!t||!c(t))}))||[]).length}}function Jh(e){const{remainingScheduleTimes:t=[],clearScheduleDates:n,periodLength:r=30,scheduleDate:i,courts:a=[]}=e;let{bookings:o=[]}=e;if(!Array.isArray(a)||!a.length)return{error:xn,courts:a};if(!Array.isArray(o))return{error:It};if(!Or(i))return{error:yt};n&&(Array.isArray(n)?n.includes(i)&&(o=[]):o=[]);const{courtBookings:s,unassignedBookings:c}=o.reduce(((e,t)=>{const{courtId:n}=t;return n?e.courtBookings[n]?e.courtBookings[n].push(t):e.courtBookings[n]=[t]:e.unassignedBookings.push(t),e}),{courtBookings:{},unassignedBookings:[]}),u=a.map(((e,n)=>{const{courtId:r,courtName:a}=e,o=s[r]||[],c=Yh({date:i,court:e})||{},{bookings:u=[],startTime:d,endTime:p,date:l}=c;return{courtId:r,courtName:a,dateAvailability:{bookings:[t[n]&&{startTime:d,endTime:t[n]},...ii(u,!1,!0),...o].filter(Boolean),startTime:d,endTime:p,date:l}}}));c.sort(((e,t)=>Gr(e.startTime)-Gr(t.startTime)));const d=[];for(const p of c){const{startTime:e,endTime:t,averageMinutes:n,recoveryMinutes:i,matchUpId:a}=p,o=Gr(e),s=Gr(t),c=u.map((e=>{const t=Kh({courtDate:e.dateAvailability});return{courtName:e.courtName,courtId:e.courtId,timeSlots:t}})).flat().reduce(((e,{courtId:t,courtName:n,timeSlots:i})=>{let a;return i.find((({startTime:t,endTime:n})=>{a=Gr(t)-o;const i=o>=Gr(t);return s<=Gr(n)&&0!==e.startDifference&&((0===a||a+r>=0)&&(void 0===e.startDifference||a<e.startDifference)||i)}))?{courtName:n,courtId:t,startDifference:a}:e}),{});if(c.courtId){const r={averageMinutes:n,recoveryMinutes:i,matchUpId:a,startTime:e,endTime:t};d.push(r);const o=u.find((({courtId:e})=>e===c.courtId));o?.dateAvailability.bookings.push(r)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map((({courtId:e,courtName:t,dateAvailability:n})=>({dateAvailability:[n],courtName:t,courtId:e}))),assignedBookings:d}}function Xh({averageMatchUpMinutes:e,periodLength:t=30,recoveryMinutes:n}){const r=(e||90)+(n||0);return t>r?r:t||30}function Zh({scheduleDate:e,startTime:t,endTime:n,courts:r}){const i=(t?"startTime":n&&"endTime")||void 0;return r.reduce(((r,a)=>{const o=Yh({date:e,court:a}),s=i&&(o?.[i]||a[i]);return s&&(!r||t&&Gr(s)<Gr(r)||n&&Gr(s)>Gr(r))?s:r}),void 0)}function eI(e){const{startTime:t="8:00",endTime:n="20:30",count:r=10,date:i}=e||{};return E(0,r).map((()=>({dateAvailability:[{date:i,startTime:t,endTime:n}]})))}function tI(e){let{date:t=Fr(),startTime:n="08:00",endTime:r="19:00",periodLength:i,courts:a}=e;const{calculateStartTimeFromCourts:o=!0,remainingScheduleTimes:s,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=e;i=i||Xh({averageMatchUpMinutes:c}),t=Wr(t),n=$r(n),r=$r(r);let l=0,f=0,h=0,I=0,g=0;!a&&d&&(a=eI({startTime:n,endTime:r,count:d,date:t}));const{virtualCourts:U}=Jh({remainingScheduleTimes:s,clearScheduleDates:u,scheduleDate:t,periodLength:i,bookings:p,courts:a}),{firstTimeSlotStartTime:y}=function({averageMinutes:e,startTime:t,endTime:n,courts:r,date:i}){let a;if(t=t||Zh({courts:r,scheduleDate:i,startTime:!0}),n=n||Zh({courts:r,scheduleDate:i,endTime:!0}),t&&n){const o=Jr(t),s=Jr(n);for(const t of r||[])Array.isArray(t.dateAvailability)&&Kh({courtDate:Yh({court:t,date:i})}).forEach((t=>{const n=Jr(t.startTime),r=Jr(t.endTime);if(n>s||n<o)return!1;if(r<o)return!1;if(Xr(n,r)>=e){const e=$r(n.toISOString());(!a||e<a)&&(a=e)}}))}return{firstTimeSlotStartTime:a}}({averageMinutes:c,courts:U,startTime:n,endTime:r,date:t});o&&y&&(n=y||n);const v=Gr(n),S=Gr(r)-v,w=E(0,Math.floor(S/i)+1).map((e=>{const n=function(e){let t=Math.floor(e/60);const n=e-60*t;return t>23&&(t%=24),[ti(t),ti(n)].join(":")}(v+e*i),{availableToScheduleCount:r}=Qh({courts:U||[],averageMatchUpMinutes:c,periodStart:n,date:t}),a=r>f?r-f:0;g+=e?r:0;const o=e?g/e:r,s=e?i*o/c*(e-1)+o:o,u=r?f&&s-l||a:0;l=s,f=r,h+=u;const d=m(h)-I;return I+=d,{periodStart:n,add:d,availableToScheduleCount:r,newCourts:a,totalMatchUps:I}}));return{scheduleTimes:w.reduce(((e,t)=>{const n=E(0,t.add).map((()=>({scheduleTime:t.periodStart})));return e.concat(...n)}),[]).flat(),timingProfile:w,totalMatchUps:I}}const nI={getCourtsAvailableAtPeriodStart:Qh,generateTimeSlots:Kh,getScheduleTimes:tI,courtGenerator:eI};function rI({matchUps:e,matchUpId:t}){if(!La(e))return{error:xn};const n=e.find((e=>e.matchUpId===t)),{drawId:r,eventId:i,structureId:a,tournamentId:o}=n||{};return{matchUpId:t,drawId:r,eventId:i,structureId:a,tournamentId:o}}function iI({tiebreakTo:e=7,scoreString:t}){return t.split(" ").filter(Boolean).map(((t,n)=>function({set:t,setNumber:n}){const r=t?.startsWith("[")&&t.split("[")[1].split("]")[0].split("-").map((e=>parseInt(e))),i=t.includes("(")&&t.split("(")[0]||t.includes("[")&&t.split("[")[0]||t,a=!r&&i.split("-").map((e=>parseInt(e))),o=r?(r[0]>r[1]?1:r[0]<r[1]&&2)||void 0:(a[0]>a[1]?1:a[0]<a[1]&&2)||void 0,s=t.includes("(")?t.split("(")[1].split(")")[0]:void 0,c=(s&&Vm({lowValue:s,isSide1:2===o,tiebreakTo:e}))??[],[u,d]=a||[],[p,l]=r||c||[];return{side1Score:u,side2Score:d,side1TiebreakScore:p,side2TiebreakScore:l,winningSide:o,setNumber:n}}({set:t,setNumber:n+1})))}const aI="\\d+-\\d+",oI="\\d+-\\d+\\(\\d+\\)",sI="\\[\\d+-\\d+\\]",cI=new RegExp(`(${aI}),`,"g"),uI=new RegExp(`(${oI}),`,"g"),dI=[aI,oI,sI,"\\d+-\\d+\\(\\d+-\\d+\\)"],pI=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map((e=>{const t=e.split("").map((e=>dI[e])).join(" ");return new RegExp(`^${t}$`)}));function lI(e){return!e||pI.some((t=>t.test(e)))}function mI(e){return/^\(\d+\)$/.test(e)||/^\(\d+$/.test(e)}function fI(e){const t=(n=e,n?.split("-").join("").split("/").join(""));var n;if(/^\d+$/.test(t)&&2===t.length){const e=t.split("");return 1===Math.abs(e.reduce(((e,t)=>+e-+t)))}return!1}function hI(e,t){const n=[e.slice(t,t+2),t?e.slice(0,1):e.slice(2)].map((e=>parseInt(e.join(""))));t&&n.reverse();const r=n;if(Math.abs(r.reduce(((e,t)=>+e-+t)))>=2)return r.join("-")}function II(e){return 2===e.length?e.split("").join("-"):([", ",",","/"," "].forEach((t=>e=e.split(t).join("-"))),e=e.replace(/-{2,}/,"-"))}function gI(e){return e.startsWith("(")&&e.endsWith(")")}function UI(e){if(!/^[\d-]+(\(\d\))*$/.test(e))return e;const t=C("-",e.split(""));if(!t.length)return e;const n=e.split("-"),r=!(n.length%2),i=!!(t.length%2);if(r&&i&&t.length>n.length/2){t.filter(((e,t)=>t%2)).forEach((t=>{e=e.substring(0,t)+" "+e.substring(t+1)}))}return e}function yI({score:e}){const t=e.split(""),n=[];let r;const i=()=>r=[void 0,void 0,void 0],a=()=>{let e=`${r[0]}-${r[1]}`;return r[2]&&(e+=` (${r[2]})`),i(),r.push(r),e};i();const o=()=>void 0!==r[0]&&void 0!==r[1]&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;t.length;){const e=t.shift(),i=U(e)&&parseInt(e),s=void 0!==r[0]&&void 0!==r[1];if(U(i)){if(void 0===r[0]){r[0]=i;continue}if(void 0===r[1]&&(r[1]=i,o())){n.push(a()),r=[void 0,void 0];continue}if(s&&1===t.length&&U(t[0])){const e=t.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=e,n.push(a()),r=[void 0,void 0]}s&&o()}}return{sets:n}}function vI(e){const t=e.indexOf("1"),n=e.split(""),r=n.every((e=>!isNaN(e)));if(r&&3===e.length&&0===t){const e=hI(n,t);if(e)return e}if(r&&7===e.length&&t>3){const e=hI(n.slice(4),t-4);if(e)return`${n[0]}-${n[1]} ${n[2]}-${n[3]} ${e}`}}function SI(e){let{score:t}=e;const{applied:n,matchUpStatus:r}=e,i=t?.toString().split(""),a=i?.every((e=>U(e))),o=e=>Math.abs(e[0]-e[1]);if("number"==typeof t||a){t=t.toString().toLowerCase(),a&&(t=i.join(""));const e=a?i.map((e=>parseInt(e))):t.split("").map((e=>parseInt(e)));if(yI({score:t}),e.length,3===t.length&&1===o(e.slice(0,2))){const[r,i,a]=e;t=`${r}-${i}(${a})`,n.push("numericTiebreakPattern1")}else if(3===t.length&&1===e[0]){const[r,i,a]=e;t=`[${r}${i}-${a}]`,n.push("numericTiebreakPattern2")}else if(4===t.length&&1===o(e.slice(0,2))&&"987654".split("").includes(e[0].toString())){const[r,i,a,o]=e;t=`${r}-${i}(${Math.min(a,o)})`,n.push("numericTiebreakPattern3")}else if(4===t.length&&1===e[0]&&1===e[2]){const[r,i,a,o]=e;t=`[${r}${i}-${a}${o}]`,n.push("bigSuper")}else if(4===t.length){const[r,i,a,o]=e;t=`${r}${i} ${a}${o}`,n.push("split4")}else if(5===t.length&&1===o(e.slice(0,2))){const[r,i,a,o,s]=e;t=`${r}-${i}(${a}) ${o}-${s}`,n.push("numericTiebreakPattern4")}else if(5===t.length&&1===o(e.slice(3))){const[r,i,a,o,s]=e;t=`${r}-${i} ${a}-${o}(${s})`,n.push("numericTiebreakPattern5")}else if(7===e.length)if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===e[4]){const[r,i,a,o,s,c,u]=e;t=`${r}-${i} ${a}-${o} [${s}${c}-${u}]`,n.push("numericTiebreakPattern6")}else if(1===o(e.slice(0,2))&&o(e.slice(3,5))>1&&o(e.slice(5,7))>1){const[r,i,a,o,s,c,u]=e;t=`${r}-${i}(${a}) ${o}-${s} ${c}-${u}`,n.push("numericTiebreakPattern7")}else if(o(e.slice(0,2))>1&&1===o(e.slice(2,4))&&o(e.slice(5,7))>1){const[r,i,a,o,s,c,u]=e;t=`${r}-${i} ${a}-${o}(${s}) ${c}-${u}`,n.push("numericTiebreakPattern8")}else if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===o(e.slice(4,6))){const[r,i,a,o,s,c,u]=e;t=`${r}-${i} ${a}-${o} ${s}-${c}(${u})`,n.push("numericTiebreakPattern9")}else t=t.slice(0,2)+" "+t.slice(2,4)+" "+t.slice(4),n.push("numericMatchTiebreakPattern");else if(t.length%2){const e=vI(t);e&&t!==e&&n.push("parsedSuperPattern"),t=e??t}else{const r=x(t.split(""),2).map((e=>e.join(""))),i=r.map((e=>{const[t,n]=e.split("").map((e=>parseInt(e))),r=t>n?1:2;return Math.abs(t-n)>1&&r||-1*r})),a=i.reduce(((e,t)=>e>0&&t>0),1),o=R(i),s=R(i.map((e=>Math.abs(e)))),c=i[0]<0,u=!c&&i[1]<0;if(i[0]>0&&i[1]>0&&i[0]!==i[1])t=[r.slice(0,2).join(" "),r.slice(2).join("-")].join(" "),n.push("numeric3rdSetTiebreakPattern");else if(a)t=r.join(" "),n.push("chunkSplit");else if(6==e.length){if(2==o[1]||2===o[2])if(Object.values(s).includes(3)){const[r,a,o,s,c,u]=e,d=i.reduce(((e,t,n)=>t<0?n:e),void 0);if(0===d){t=`${r}-${a}(${Math.min(o,s)}) ${c}-${u}`,n.push("chunkSplitTiebreak1")}else if(1===d){t=`${r}-${a} ${o}-${s}(${Math.min(c,u)})`,n.push("chunkSplitTiebreak2")}else t=`${r}-${a} ${o}-${s}`,n.push("chunkSplitTrimExtraneous")}else t=r.join(" "),n.push("chunkSplit")}else if(8===e.length){const[n,r,a,o,s,d,p,l]=e;c||u?1===e[5]&&(t=c?`${n}-${r}(${a}) ${o}-${s} [${d}${p}-${l}]`:`${n}-${r} ${a}-${o}(${s}) [${d}${p}-${l}]`):(i[0],i[1])}}}return{score:t,applied:n,matchUpStatus:r}}function wI(e){const t=[0,0],n=[],r=e.split(" "),i=/(\d+)-(\d+)/;r.forEach((e=>{if(i.test(e)){const r=e.match(i).slice(1).map((e=>parseInt(e))),a=r[0]>r[1]?1:r[1]>r[0]&&2;a&&(t[a-1]+=1,n.push(a))}}));const a=t[0]>t[1]?1:t[1]>t[0]&&2,o=t[0]>0&&t[0]===t[1],s=t.reduce(((e,t)=>e+t),0);return{setsWon:t,setsTied:o,setWinners:n,totalSets:s,winningSide:a}}const PI={handleTiebreakSlashSeparation:function({score:e}){const t=new RegExp(/\(\d+\/\d+\)/g),n=e.match(t);for(const r of n||[]){const t=r.replace("/","-");e=e.replace(r,t)}return{score:e}},handleSetSlashSeparation:function({score:e}){return new RegExp(/-\d+\/\d+-/).test(e)&&(e=e.split("/").join(" ")),{score:e}},punctuationAdjustments:function({score:e,applied:t}){e=function(e){const t="[];",n="()",r=t+n,i=[t[0],n[0]],a=Object.assign({},...r.split("").map((e=>({[e]:0}))));let o="";const s=e.split("").map((e=>{const s=r.includes(e)&&e,c=i.includes(s);if(c&&s)return a[s]+=1,o=s,e;if(!c&&s&&o&&s!==o){a[o]-=1;const e=t.includes(o)&&t||n.includes(o)&&n||"",r=e.split("").find((e=>e!==o));if(!e.includes(s))return a[s]||(o=""),r;a[o]||(o="")}return e})).join("");return e!==s?s:e}(e);const n=/\)(\d+)/g;if(n.test(e))for(const v of e.match(n)){const t=v.replace(")",") ");e=e.replace(v,t)}const r=/\(([\d- ]+)\)/,i=(e=(e=e.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);for(const v of i||[]){const[t]=v.match(r).slice(1),n=t.replace(/ /g,"");e=e.replace(v,`(${n})`)}let a=/\(\(\d-\d\)\)/g;if(a.test(e)){const t=e.match(a);t.length&&t.forEach((t=>{const n=t.match(/\((\(\d-\d\))\)/).slice(1)[0];e=e.replace(t,n)}))}if(a=/\(\((\d)\)\)/g,a.test(e)){const t=e.match(a);t.length&&t.forEach((t=>{const n=t.match(/\((\(\d\))\)/).slice(1)[0];e=e.replace(t,n)}))}/(^|\s)6-,/.test(e)&&(e=e.replace(/(^|\s)6-,/g,"6-0,"));const o=new RegExp(/[-,]{2,}/g);e=e.replace(o,"-"),["- "," -"].forEach((t=>{const n=new RegExp(`(\\d+)${t}(\\d+)`,"g"),r=e.match(n);r&&r.forEach((n=>e=e.replace(n,n.split(t).join("-"))))})),/^[(-/,]+$/.test(e)&&(e=""),/\)[-/,]+$/.test(e)&&(e=e.slice(0,e.length-1)),/\d \/\d/.test(e)&&(e=e.replace(/ \//g,"/")),e.includes(" /")&&(e=e.replace(/ \//g," "));const s=/\(\d+, \)/g;if(s.test(e)){e.match(s).forEach((t=>{const[n]=t.match(/\((\d+), \)/).slice(1);2===n.length?e=e.replace(t,`(${n})`):1===n.length&&"6"===n&&(e=e.replace(t,"(6-0)"))}))}const c=/\((\d+)\/\)/g;if(c.test(e)){e.match(c).forEach((t=>{const[n]=t.match(/\((\d+)\/\)/).slice(1);e=2===n.length?e.replace(t,`(${n})`):1===n.length&&"6"===n?e.replace(t,"(6-0)"):e.replace(t,`(${n})`)}))}const u=/\d\/\d\/,/g;if(u.test(e)){e.match(u).forEach((n=>{const[r]=n.match(/(\d\/\d)\/,/).slice(1);e=e.replace(n,`${r},`),t.push("slashComma")}))}const d=/\(\/(\d+)\)/g;if(d.test(e)){e.match(d).forEach((t=>{const[n]=t.match(/\(\/(\d+)\)/).slice(1);e=2===n.length?e.replace(t,`(${n})`):1===n.length&&parseInt(n)<6?e.replace(t,`(6-${n})`):e.replace(t,`(${n})`)}))}let p,l,m,f,h;const I=()=>{h=R(e.split("")),l=h["("]===(h[")"]||0)+1,p=(h["("]||0)+1===h[")"],m=h["["]===h["]"]+1,f=l&&!m};I();const g=/(\d+-\d+\(\d+)0,/;if(g.test(e)){const[t]=e.match(g).slice(1);e=e.replace(g,t+")")}if(h["("]===h[")"]&&h["("]>1){const t=e.split(")(").join(") (").split(" ");e=t.every(gI)?t.map((e=>{const t=e.slice(1,e.length-1);return t.length>2?t:e})).join(" "):t.join(" ")}I();const U=/[A-Za-z]+/.test(e),y=/\d+/.test(e);if(!U&&!y)return{score:""};if(/^\[.+\]$/.test(e)&&"()/,- ".split("").some((e=>h[e]))&&(e=e.slice(1,e.length-1)),/^\(.+\)$/.test(e)&&1===h["("]&&1===h[")"]&&"[]/,".split("").some((e=>h[e]>1))&&(e=e.slice(1,e.length-1)),e.startsWith("(")&&e.endsWith("))")&&(e=e.slice(1,e.length-1)),h["("]>(h[")"]||0)&&"("===e[e.length-1]&&(e=e.slice(0,e.length-1)+")",I()),1!==h["("]||h[")"]||"("!==e[0]||(e+=")",I()),h["("]>(h[")"]||0)&&"(("===e.slice(0,2)&&(e=e.slice(1)),p){if(/^9\d/.test(e))e="("+e.slice(1);else if("("!==e[0])e="("+e;else{const t=[];let n=0;for(const r of e.split("").reverse())")"===r&&(n?t.push("("):n+=1),"("===r&&(n-=1),t.push(r);t.reverse(),e=t.join("")}I()}if(h[")"]>(h["("]||0)&&")"===e[0]&&(e="("+e.slice(1),I()),f&&(e.endsWith(9)||/\d+0$/.test(e))&&(e=e.slice(0,e.length-1)+")",I()),!f||e.endsWith(")")&&!e.startsWith("((")||(e+=")",I()),f){let t="",n=0;for(const r of e.split(""))"("===r&&(n?t+=")":n+=1),")"===r&&(n-=1),t+=r;e=t}if(I(),m&&!l&&(e+="]"),e.includes("([")&&e.includes("])")&&(e=e.split("([").join("[").split("])").join("]"),I()),/\(\d+0$/.test(e)&&(e=e.slice(0,e.length-1)+")"),I(),1===h[")"]&&!h["("]&&e.endsWith(")")&&(e=e.slice(0,e.length-1)),e.startsWith("(")&&e.endsWith(")")&&1===h["("]&&1===h[")"]&&(e=e.slice(1,e.length-1),I()),/^\([\d ]+.*[\d ]+\)$/.test(e)&&h["("]===h[")"]){const t=e.slice(1,e.length-1);(e=>{const t=e.indexOf("("),n=e.indexOf(")");return t>=0&&n>=0&&t<n})(t)&&(e=t,I())}return{score:e,applied:t}},handleGameSeparation:function({score:e}){const t=new RegExp(/^\d+\/\d+/),n=e.split(" ");n.some((e=>t.test(e)))&&(e=n.map((e=>t.test(e)?e.replace("/","-"):e)).join(" "));const r=/^(\d+), *(\d+)$/;if(r.test(e)){const[t,n]=e.match(r).slice(1);e=[t,n].join("-")}return{score:e}},joinFloatingTiebreak:function({score:e}){if("string"!=typeof e)return{score:e};const t=e=>e?.split("-").join("").split("/").join(""),n=e=>e.split("[").join("(").split("]").join(")");let r=(e=e.split(", ").join(" ")).split(" ");e=r.map((e=>{const t=/^-(\d+)$/;if(t.test(e)){const[n]=e.match(t).slice(1);if(2===n.length)return n.split("").join("-")}return e})).join(" "),r=e.split(" ");const i=r.filter(mI);let a=0,o="";for(const l of i){const e=C(l,r).filter((e=>!a||e>a))[0],n=r.slice(a,e-1),i=r[e-1],s=t(i);if(/^\d+$/.test(s)&&2===s.length){const t=s.split(""),r=Math.abs(t.reduce(((e,t)=>+e-+t)));if(1===r){o+=[n.join(" "),[i,l].join("")].join(" "),a=e+1}else if(0===r){const r=Math.max(...t);if([4,5,6,7,8,9].includes(r)){const t=[r,[6,4].includes(r)?r+1:r-1].sort().reverse().join("-");o+=[n.join(" "),[t,l].join("")].join(" "),a=e+1}}}}if(i.length&&o.length){return o=[o,r.slice(a).join(" ")].join(" "),{score:o.trim()}}if(2===r.length&&["(","["].some((e=>r[1].includes(e)))){const e=t(r[0]).split("");if(1===Math.abs(e.reduce(((e,t)=>+e-+t),0)))return r[1]=n(r[1]),{score:r.join("")}}const s=r.map((e=>function(e){return/^\(\d+-\d+\)$/.test(e)||/^\[\d+-\d+\]$/.test(e)}(e)?"bracket":fI(e)&&"set"));if(s.includes("set")&&s.includes("bracket")){let e,t="";return r.forEach(((r,i)=>{"bracket"===s[i]&&"set"===e?(r=n(r),t+=r):t+=` ${r}`,e=s[i]})),{score:t.trim()}}let c;r=e.split(" ");let u=r.map((e=>{const t=new RegExp(/^(\d+)-(\d+)$/);if(t.test(e)){const[n,r]=e.match(t).slice(1),i=Math.abs([n,r].reduce(((e,t)=>+e-+t))),a=Math.max(n,r);if(1===i)return c="tiebreakSet",c;if(i>=2&&a>=7&&"tiebreakSet"===c)return c="tiebreak",c}}));const d=C("tiebreak",u);if(d.length){let t="";r.forEach(((e,n)=>{d.includes(n)?t+=`(${e}) `:d.includes(n+1)?t+=`${e}`:t+=`${e} `})),e=t.trim()}const p=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(p.test(e)){const[t,n,r]=e.match(p).slice(1),i=Math.max(n,r)>=10;!fI(t)&&i&&(e=e.replace(p,`${t} [${n}-${r}]`))}return u=[],e=e.split(" ").map((e=>{const t=/^\((.*)\)$/,n=t.test(e),r=(new RegExp(sI).test(e)?"super":new RegExp(oI).test(e)&&"tiebreak")||new RegExp(aI).test(e)&&"standard"||"unknown";return u.push(r),"standard"===r&&n?e.match(t)[1]:e})).join(" "),{score:e}},handleBracketSpacing:function({score:e,applied:t}){return e.includes("( ")&&(t.push("removeParenSpacingAfterOpen"),e=e.split("( ").map((e=>e.trim())).join("(")),e.includes(" )")&&(t.push("removeParenSpacingBeforeClose"),e=e.split(" )").map((e=>e.trim())).join(")")),[cI,uI].forEach((n=>{const r=e.match(n);r?.length&&(r.forEach((t=>{e=e.replace(t,t.slice(0,t.length-1)+" ")})),t.push("setsEndComma"))})),{score:e=e.split(" ").filter(Boolean).map(UI).join(" "),applied:t}},handleSpaceSeparator:function({score:e}){if(e.includes(",")){const t=e.split(",").map((e=>e.trim())),n=e=>/\d \d/.test(e);t.every(n)&&(e=t.map((e=>{const t=/\d+ \d+/g;for(const n of e.match(t)){const[t,r]=n.match(/(\d+) (\d+)/).slice(1);e=e.replace(n,`${t}-${r}`)}return e})).join(" "))}if(e.includes(" ")){const t=e.replace(/[ ,]/g,"");t.split("").every((e=>U(e)))&&4===t.length&&(e=t)}return{score:e}},separateScoreBlocks:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:{score:e=e.toLowerCase().split(" ").map((e=>{if(/^\d+$/.test(e)&&e.length>2){const n=e.indexOf("1");if(e.length%2){if(3===e.length&&0===n){const r=hI(e.split(""),n);return t.push("getSuper"),r}}else{const{score:n,applied:r}=SI({score:e,applied:[]});n!==e&&(e=n,t.push(...r))}}return e})).join(" "),applied:t}},matchKnownPatterns:function({score:e,applied:t}){for(const P of[".",","," ","/"]){const n=new RegExp(`^(\\d+)\\${P}(\\d+)$`);if(n.test(e)){const r=e.match(n).slice(1).map((e=>parseInt(e))),i=Math.abs(r[0]-r[1]);i<=10&&i>=2&&(e=e.split(P).join("-"),t.push("variedJoinerPattern"))}}e.includes(";")&&(e=e.split(";").join(" "),t.push("semicolon set separation"));const n=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(n.test(e)){const[r,i,a,o,s,c]=e.match(n).slice(1);e=e.replace(n,`${r}${i}-${a} ${o}-${s}${c}`),t.push("smashSlashPattern")}/.*\s6[/-]+$/.test(e)&&(e+="0",t.push("incompleteFinalSetPattern"));const r=/\(6,\)/g;r.test(e)&&(e=e.replace(r,"(6, 0)"),t.push("missingZeroPattern1"));const i=/^\d{3,}\(/,a=/\(\d+\)\d+/;[i,a].forEach((()=>{const n=e.split(" ");e=n.map((e=>(i.test(e)&&(e=e.replace("("," (")),a.test(e)&&(e=e.replace(")",") ")),e))).join(" "),t.push("spaceConsiderationPatterns")}));const o=UI(e);o!==e&&(e=o,t.push("deDashMash"));const s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(e)){const[n,r,i]=e.match(s).slice(1),[a,o]=r.split("");e=`${n}-${a} ${o}-${i}`,t.push("smashSetPattern")}const c=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(e)){const[n,r]=e.match(u).slice(1),i=n.trim(),a=r.trim();if(c.test(i)&&c.test(a)){const n=i.match(c).slice(1,3).join("-"),r=a.match(c).slice(1,3).join("-");e=`${n} ${r}`,t.push("slashSeparationPattern")}}const d=/^([\d -]+),([\d -]+)$/;if(d.test(e)){const[n,r]=e.match(d).slice(1),i=n.trim(),a=r.trim();if(c.test(i)&&c.test(a)){const n=i.match(c).slice(1,3).join("-"),r=a.match(c).slice(1,3).join("-");e=`${n} ${r}`,t.push("commaSeparationPattern")}}const p=/^\d \d,/;if(p.test(e)){const n=e.match(p)[0],r=n.slice(0,n.length-1).split(" ").join("-");e=e.replace(n,r),t.push("singleSetCommaSeparationPattern")}let l=0;const m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(e)&&l<3;){const[n,r,i]=e.match(m).slice(1),a=r.split(""),o=`${n}-${a[0]} ${a[1]}-${i}`;e=e.replace(m,o),t.push("noSetSeparationPattern"),l+=1}const f=e.match(/(^|\s)7-6\s(\d+)\s/g);if(f?.length){const n=/(^|\s)7-6\s(\d+)\s/;f.forEach((r=>{const i=r.match(n).slice(2)[0];e=e.replace(r,`7-6(${i}) `),t.push("floatingTiebreakPattern1")}))}let h=e.match(/\d \d /);h?.forEach((n=>{const r=n.slice(0,n.length-1).split(" ").join("-");e=e.replace(n,r),t.push("spaceSeparatedSetPattern1")})),h=e.match(/ \d \d$/),h?.forEach((n=>{const r=" "+n.slice(1).split(" ").join("-");e=e.replace(n,r),t.push("spaceSeparatedSetPattern2")}));const I=/^\d, *\d\/\d, *\d/;if(I.test(e)){const n=e.match(I)[0],r=n.split("/").map((e=>`(${e})`)).join(" ")+" ";e=e.replace(n,r),t.push("slashCommaSetPattern")}const g=/\(6-\)/g;g.test(e)&&(e=e.replace(g,"(6-0)"),t.push("missingZeroPattern2"));const U=/(?<!-)(\d+)\/(\d+)(?!-)/g;if(U.test(e)){const n=e.match(U),r=/(?<!-)(\d+)\/(\d+)(?!-)/;let i=e;n.forEach((e=>{const[t,n]=e.match(r).slice(1),a=`${t}-${n}`;i=i.replace(e,a)})),e=i,t.push("slashSetPattern")}const y=/(.*)\s(1\d)\s(\d+)$/;if(y.test(e)){const[n,r,i]=e.match(y).slice(1);n.replace(/\D/g,"").length>=4&&(e=n+` ${r}${i}`,t.push("spaceSeparatedSuperPattern"))}const v=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(const P of e.match(v)||[]){const[n,r,i,a]=P.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[o,s]=r.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(P,`${n}${r}(${i})${a}`),t.push("spaceSeparatedSetPattern"))}const S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(const P of e.match(S)||[]){const n=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[r,i,a]=P.match(n).slice(1),[o,s]=r.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(P,`${r}(${i})${a}`),t.push("floatingTiebreakPattern2"))}const w=/(^|\s)(\d \d)\(/g;for(const P of e.match(w)||[]){const n=/(^|\s)(\d \d)\(/,[r,i]=P.match(n).slice(1);e=e.replace(P,`${r}${i.split(" ").join("-")}(`),t.push("spacedTiebreakPattern")}return{score:e,applied:t}},removeDanglingBits:function({score:e,attributes:t}){(e.endsWith(" am")||e.endsWith(" pm"))&&(e=""),e=e.replace(/[A-Za-z]+/g,"").trim(),[".",","].some((t=>e.endsWith(t)))&&(e=e.slice(0,e.length-1));const n="()/-".split("").some((t=>e.includes(t)));if(/ \d$/.test(e)&&n){t={removed:e.slice(e.length-2).trim()},e=e.slice(0,e.length-2)}const r=/(.*)[A-Za-z]+$/;if(r.test(e)){const t=e.match(r).slice(1)[0];e=t.trim()}return{score:e,attributes:t}},removeErroneous:function({score:e,applied:t}){if("string"!=typeof e)return{score:e};if([3,4].includes(e.length)&&vI(e)){return{score:vI(e)}}return{score:e=e.toLowerCase().split(" ").map((e=>{if(!/^\d+$/.test(e)||1!==e.length)return e;t.push("removeErroneous1")})).filter(Boolean).join(" "),applied:t}},handleWalkover:function({score:e,applied:t}){return["walkover","wo","w/o","w-o"].includes(e?.toString().toLowerCase())?(t.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:t}):{score:e}},properTiebreak:function({score:e,matchUpStatus:t}){let n=e?.split(" ");e=n.map((e=>{if(e.endsWith("]")){const t=e.split("[");if(fI(t[0]))return t[0]+`(${t[1].slice(0,t[1].length-1)})`}return e})).join(" ");const r=new RegExp(/(\([\d ]+\))/g);if(r.test(e))for(const s of e.match(r)){const t=s.replace(" ","-");let n=t.match(/\((.*)\)/)?.[1];if(U(n)&&n?.[0]>2)if([2,4].includes(n.length))n=n.split("").join("-");else if(3===n.length){const e=n.indexOf("1");n=hI(n.split(""),e)}e=e.replace(s,`(${n})`)}n=e?.split(" ");let i=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/);const a=n.length-1;e=n.map(((e,n)=>{const r=[void 0,"","COMPLETED"].includes(t)||n!==a;if(i.test(e)&&r){const[t,n,r]=Array.from(e.match(i)).slice(1);return`${t}(${Math.min(n,r)})`}return e})).join(" "),n=e?.split(" "),i=new RegExp(/^(\d{2})\((\d+)\)$/),e=n.map((e=>{if(i.test(e)){const[t,n]=Array.from(e.match(i)).slice(1),r=t.split("");return`${r[0]}-${r[1]}(${n})`}return e})).join(" "),n=e?.split(" "),i=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),e=n.map((e=>{if(i.test(e)){const[t,n]=Array.from(e.match(i)).slice(1);return fI(t)?`${t}(${n})`:t}return e})).join(" "),n=e?.split(" "),i=new RegExp(/^1-0\((\d+)\)$/),e=n.map((e=>{if(i.test(e)){const[t]=e.match(i).slice(1);return`[${t<9?10:parseInt(t)+2}-${t}]`}return e})).join(" ");const o=/\((\d)+0 /;if(o.test(e)){const t=e.match(o)[1];e=e.replace(o,`(${t}) `)}return{score:e}},handleNumeric:SI,handleRetired:function({score:e,profile:t,applied:n}){e=e?.toString().toLowerCase();const r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(e)){const[t]=e.match(r).slice(1);return n.push("handleRetired"),{score:t.trim(),matchUpStatus:"retired",applied:n}}const i=t?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(i)?i:[i].filter(Boolean)].find((t=>e?.endsWith(t)));return a?(n.push("handleRetired"),{matchUpStatus:"retired",score:e?.replace(a,"").trim(),applied:n}):{score:e}},containedSets:function({score:e,attributes:t,identifier:n}){if("string"!=typeof e)return{score:e,identifier:n};const r=new RegExp(/\([\d,/ ]+\)/g),i=e.match(r);for(const d of i||[]){const t=d.match(/^\((.*)\)$/),n=t?.slice(1)?.[0],r=e.split(d)[0].split(")").reverse()[0].replace(/\D/g,"");if(2===n?.length&&r?.length>=2){const e=r.slice(r.length-2).split("").map((e=>parseInt(e)));if(1===Math.abs(e[0]-e[1]))continue}const i=UI(II(n));e=e.replace(d,`(${i})`).trim()}const a=new RegExp(/\[[\d,/ ]+\]/g),o=e.match(a);o?.forEach((t=>{const n=II(t.match(/^\[(.*)\]$/)[1]);e=e.replace(t,`(${n}) `).trim()}));const s=[")(","), (",") (",")[",") [","](","] ("];if(e.startsWith("(")&&[")","]"].some((t=>e.endsWith(t)))&&s.some((t=>e.includes(t)))){let t="";const n=e.split(/[)\]]/).filter(Boolean).map((e=>(e.startsWith(",")&&(e=e.slice(1)),e.trim()))),r=n.every((e=>e.includes(",")||mI(e))),i=n.every((e=>e.includes("/")||mI(e))),a=n.every((e=>e.includes("-")||mI(e))),o=(r?",":a&&"-")||i&&"/";if(o){let r;n.forEach((e=>{if(e.startsWith("("))if("set"===r&&(t+=" "),e.includes(o))t+=e.slice(1).split(o).map((e=>e.trim())).join("-"),r="set";else{const n=e.slice(1);t+=`(${n}) `,r="tiebreak"}else if(e.startsWith("[")){const n=e.slice(1).split(o).map((e=>parseInt(e.trim()))),i=Math.min(...n);t+="set"===r?`(${i}) `:`[${n.join("-")}] `,r="tiebreak"}})),e=t.trim()}}const c=R(e.split(""));1===c["("]&&1===c[")"]&&e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,e.length-1),1===c["-"]&&fI(e)&&U(t?.removed)&&(e+=`(${t.removed})`,t.removed=void 0));const u=/\(\)/g;return u.test(e)&&(e=e.replace(u,"").trim()),{score:e}},sensibleSets:function({score:e,matchUpStatus:t,attributes:n}){const r=[];let i;const a=e.split(" "),o=a.length;e=a.map(((e,n)=>{if(new RegExp(oI).test(e)){const n=e.slice(3),r=e.slice(0,3),i=r.split("-");if(!fI(r)&&!t){const e=Math.max(...i),t=[e,e-1];r.indexOf(e)&&t.reverse();return t.join("-")+n}}else if(2===e.length&&U(e))return e.split("").join("-");e=UI(e);const a=(new RegExp(`^${sI}$`).test(e)?"super":new RegExp(`^${oI}$`).test(e)&&"tiebreak")||new RegExp(`^${aI}$`).test(e)&&"standard"||"unknown";if(r.push(a),o>1&&"standard"===a&&n<2){const[t,r]=e.split("-"),a=Math.abs(parseInt(t)-parseInt(r)),o=Math.max(t,r),s=Math.min(t,r),c=[parseInt(t),parseInt(r)].indexOf(s);if(o>9&&a>2){const t=o.toString().split(""),r=t.find((e=>parseInt(e)>s||n&&parseInt(e)<=i))??t[0];r&&(e=c?[r,s].join("-"):[s,r].join("-"))}o>(i||0)&&(i=o)}if("standard"===a){const[n,r]=e.split("-");if(!Math.abs(parseInt(n)-parseInt(r))&&"RETIRED"!==t)return""}return e})).filter(Boolean).join(" ");const{setsWon:s,setWinners:c,totalSets:u}=wI(e);if(1===u&&"6"===n?.removed&&(e+=" 6-0"),e.split(" ").length>2&&Math.max(...s)>=2&&c[0]===c[1]&&(e=e.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){const t=[0,0];e=e.split(" ").map(((e,n)=>(t[c[n]]+=1,Math.max(...t)>2?void 0:e))).filter(Boolean).join(" ")}return{score:e,profile:r}},stringScore:function({score:e}){return{score:e=e?.toString().toLowerCase()||""}},superSquare:function({score:e}){const{setsTied:t,winningSide:n}=wI(e),r=/\s\((\d+)\)$/;if(!n&&t&&r.test(e)){const t=e.match(r).slice(1)[0],n=t<=8?10:t+2;e=e.replace(r,` [${n}-${t}]`)}const i=e.split(" "),a=i[i.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:e};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every((e=>U(e))))return{score:e};if("76"===o[0]){const t=2===o[1].length?Math.min(...o[1].split("").map((e=>parseInt(e)))):o[1];e=[...i.slice(0,i.length-1),`7-6(${t})`].join(" ")}else{o=o.map((e=>parseInt(e)));const t=Math.max(...o);let n=Math.abs(o[0]-o[1]);if(t>=10){if(n>2&&o.every((e=>+e>=10))){const e=o.map((e=>e===t?e-10:10)).sort();n=Math.abs(e[0]-e[1]),n>2&&(o=e)}e=[...i.slice(0,i.length-1),`[${o.join("-")}]`].join(" ")}else 3===i.length&&t>=7&&n>2&&(e=[...i.slice(0,i.length-1),`[${o.join("-")}]`].join(" "))}return{score:e}},setBuilder:yI,excisions:function({score:e}){const t=new RegExp(/^\[\d+\](.*)$/);t.test(e)&&(e=e.match(t).slice(1)[0].trim());const n=/\(,/g;return n.test(e)&&(e=e.replace(n,"(")),{score:e}},replaceOh:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:(e.toLowerCase().includes("o")&&(e=e.toLowerCase().split(" ").map((e=>e.split("o").join("0"))).join(" "),t.push("replaceOh")),{score:e,applied:t})}};let TI={};const DI=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],RI=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function bI({excludedMatchUpStatuses:e=[],includeEventParticipants:t,includeQualifyingStage:n,finishingRoundLimit:r,policyDefinitions:i,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:c,requirePlay:u,requireLoss:d,allEntries:p,winsLimit:l,event:m}){if(!s)return{error:Y};const f=[$i.Main,$i.PlayOff];n&&f.push($i.Qualifying);const h=m?.eventType?{matchUpTypes:[m.eventType]}:void 0,I=s?.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,g=t&&m?ah({contextFilters:{stages:f},matchUpFilters:h,tournamentRecord:o,inContext:!0,event:m})?.matchUps||[]:ih({contextFilters:{stages:f},matchUpFilters:I,tournamentRecord:o,inContext:!0,drawDefinition:s})?.matchUps||[],U=Op({stage:ad,drawDefinition:s}).map((({participantId:e})=>e)),y={},v={},S={},w={};i||(i=Zo({policyTypes:[so],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);const P=i?.[so];e=e.length&&e||P?.excludedMatchUpStatuses||[],t=void 0!==t?t:P?.includeEventParticipants,p=void 0!==p?p:P?.allEntries,r=r||P?.finishingRoundLimit,a=a||P?.roundNumberLimit,c=c||P?.matchUpsLimit,void 0===u&&(u=void 0===P?.requirePlay||P.requirePlay),void 0===d&&(d=void 0===P?.requireLoss||P.requireLoss),l=l||P?.winsLimit;for(const N of g){if(u&&N.winningSide&&![1,2].includes(N.winningSide)&&N.matchUpStatus!==ya)continue;if(N.finishingRound&&r&&N.finishingRound>=r)continue;if(N.finishingRound&&a&&N.finishingRound<=a)continue;const t=N.sides?.find((({sideNumber:e})=>N.winningSide&&e===3-N.winningSide)),n=N.sides?.find((({sideNumber:e})=>N.winningSide&&e===N.winningSide));if(N.sides?.forEach((t=>{const n=t?.participant?.participantId;n&&(S[n]=t.participant,N.matchUpStatus!==ya||u||(v[n]=t.participant,y[n]||(y[n]=0),e.includes(N.matchUpStatus)||(y[n]+=1)))})),t?.participant){const n=t.participant.participantId;v[n]=t.participant,y[n]||(y[n]=0),N.matchUpStatus&&!e.includes(N.matchUpStatus)&&(y[n]+=1)}if(n?.participant){const t=n.participant.participantId;w[t]||(w[t]=0),w[t]+=1,y[t]||(y[t]=0),N.matchUpStatus&&!e.includes(N.matchUpStatus)&&(y[t]+=1)}}const T=o?.participants&&!u&&!d&&p,D=T?((t&&m?m.entries:s.entries)||[]).filter((e=>![Pp,vp].includes(e.entryStatus))).map((({participantId:e})=>e)):[],R=Object.keys(v),b=T?(o?.participants||[]).filter((({participantId:e})=>D.includes(e))):d&&Object.values(v)||Object.values(S);return{eligibleParticipants:b.filter((e=>{return t=e.participantId,(!d||R.includes(t))&&(e=>!u||(y[e]||0)>=0)(e.participantId)&&(e=>!l||(w[e]||0)<=l)(e.participantId)&&(e=>!c||y[e]<=c)(e.participantId)&&(e=>!U.includes(e))(e.participantId);var t})).map((e=>({...e,individualParticipants:e.individualParticipantIds?.map((e=>o?.participants?.find((t=>t.participantId===e))))}))),losingParticipantIds:R,...L}}function NI(e){Object.assign(e,{inContext:!0});const{matchUp:t,error:n}=MI(e);return{matchUp:ii(t,!0,!0),error:n}}function MI({participantsProfile:e,afterRecoveryTimes:t,tournamentRecord:n,contextContent:r,contextProfile:i,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:c,eventId:u,drawId:d,event:p}){if(!n)return{error:$};if("string"!=typeof s)return{error:Qe};if(!a||!p){const e=(rh({tournamentRecord:n,nextMatchUps:o}).matchUps??[]).find((e=>e.matchUpId===s));if(!e)return{error:Xe};({eventId:u,drawId:d}=e),({event:p,drawDefinition:a}=Qs({tournamentRecord:n,eventId:u,drawId:d}))}if(!a)return{error:Q};i&&!r&&(r=ss({tournamentRecord:n,contextProfile:i}));const l={surfaceCategory:p?.surfaceCategory??n.surfaceCategory,indoorOutDoor:p?.indoorOutdoor??n.indoorOutdoor,endDate:p?.endDate??n.endDate,tournamentId:n.tournamentId,eventId:u??p?.eventId,drawId:d},{participants:m=[]}=nh({participantsProfile:e,tournamentRecord:n,contextProfile:i,inContext:c});if(o){const e=(ih({context:c?l:void 0,participants:m,afterRecoveryTimes:t,contextContent:r,contextProfile:i,drawDefinition:a,nextMatchUps:o,inContext:c,event:p}).matchUps??[]).find((e=>e.matchUpId===s));if(!e)return{error:Xe};const n=a?.structures?.find((t=>t.structureId===e.structureId));return{drawDefinition:a,structure:n,matchUp:e}}{const{matchUp:e,structure:n}=Qp({context:c?l:void 0,tournamentParticipants:m,afterRecoveryTimes:t,contextContent:r,drawDefinition:a,contextProfile:i,matchUpId:s,inContext:c,event:p});return{matchUp:e,structure:n,drawDefinition:a}}}function AI({tournamentRecords:e,extensionName:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const n=[];let r;for(const i of Object.values(e)){const{extension:e}=As({name:t,tournamentRecord:i});e&&!r&&(n.push({method:"addExtension",params:{extension:e}}),r=!0);const a=i.events||[];for(const r of a){const{eventId:e}=r,{extension:i}=Es({name:t,event:r});i&&n.push({params:{eventId:e,extension:i},method:"addEventExtension"})}}return{methods:n}}function EI({tournamentRecord:e,matchUpFormats:t,categoryType:n,event:r}){if(!e)return{error:$};if(!r)return{error:Ae};let i,a=[];if(t?.length){const e=[];a=t.map((t=>{const n="string"==typeof t?{matchUpFormat:t}:t;if(!e.includes(n?.matchUpFormat)&&Ti(n?.matchUpFormat))return e.push(n.matchUpFormat),n})).filter(Boolean)}else{const{policy:t}=fs({policyType:vo,tournamentRecord:e,event:r});if(t?.matchUpFormats)a=t?.matchUpFormats;else{const{extension:e}=Es({name:Wo,event:r});let t,n;({matchUpAverageTimes:t,matchUpRecoveryTimes:n}=e?.value?e.value:$f[go]),a=P([...(t||[]).map((e=>e.matchUpFormatCodes)),...(n||[]).map((e=>e.matchUpFormatCodes))].flat()).map((e=>({matchUpFormat:e}))),i="default scheduling policy in use"}}const{eventType:o,eventId:s,category:c}=r,u=c?.categoryName??c?.ageCategoryCode??s;if(!s)return{error:Ae};return pi({eventMatchUpFormatTiming:a.map((({matchUpFormat:t,description:i})=>({matchUpFormat:t,description:i,...Hs({tournamentRecord:e,matchUpFormat:t,categoryName:u,categoryType:n,eventType:o,event:r})}))),info:i})}function CI({scaleAttributes:e,scaledEntries:t,stageEntries:n,seedsCount:r,scaleName:i}){if(!e)return{error:mt,info:"missing scaleAttributes"};const a=Object.assign({},...(t||[]).slice(0,r).map((({participantId:e},t)=>({[e]:t+1}))));i=i||e.scaleName;const o=(new Date).toISOString();return{scaleItemsWithParticipantIds:n.map((({participantId:t})=>({scaleItems:[{scaleValue:a[t],eventType:e.eventType,scaleType:Ps,scaleName:i,scaleDate:o}],participantId:t})))}}function OI({restrictQualifyingAlternates:e,structure:t,entry:n}){const{stage:r}=t;if(!n.entryStage||n.entryStage===r||r===rd&&!e||n.entryStage===nd&&r===id)return!0}function FI(e){const{inContextDrawMatchUps:t,targetData:n,drawDefinition:r,relevantLink:i}=e;if(i?.linkCondition===Td&&n?.matchUp?.matchUpStatus===ma)return!1;const{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=n,c=[ga,Ra].includes(a?.matchUpStatus),u=o?.drawPositions?.filter(Boolean).length||0;if(a?.winningSide&&!c||o?.winningSide&&2===u&&(!o.feedRound||![Ra,ga].includes(o?.matchUpStatus)))return!0;const d=a&&bl({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),p=o&&bl({matchUpId:o.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),l=d&&FI({relevantLink:s?.loserTargetLink,targetData:d,inContextDrawMatchUps:t,drawDefinition:r});return!(!(p&&FI({targetData:p,inContextDrawMatchUps:t,drawDefinition:r}))&&!l)}function kI({drawDefinition:e,structureId:t}){if(!e)return{error:Y};const{structure:n}=rp({drawDefinition:e,structureId:t}),r=(e?.links||[]).filter((e=>e.source?.structureId===t)).map((e=>e.target?.structureId));return{playoffStructures:(e?.structures||[]).filter((e=>r.includes(e.structureId))),structure:n}}function xI({withStageGrouping:e,stageSequences:t,stageSequence:n,roundTarget:r,stages:i,event:a,stage:o}){if(!a)return{error:Ae};const s={},c=[];for(const u of a.drawDefinitions||[]){const{structures:a,stageStructures:d}=ip({withStageGrouping:e,stageSequences:t,drawDefinition:u,stageSequence:n,roundTarget:r,stages:i,stage:o});if(c.push(...a),d)for(const e of Object.keys(d))s[e]||(s[e]=[]),s[e].push(...d[e])}return{structures:c,stageStructures:s}}function _I(e){if(!e?.drawDefinition)return!1;const t=El(e),n=t?.includesTeamMatchUps;let{completedMatchUps:r,pendingMatchUps:i,upcomingMatchUps:a}=t||{};n&&(r=r?.filter((({matchUpType:e})=>e===ji)),i=i?.filter((({matchUpType:e})=>e===ji)),a=a?.filter((({matchUpType:e})=>e===ji)));return!!(r?.length&&!i?.length&&!a?.length)}function LI(e){const{drawDefinition:t,structureId:n}=e;if(!t)return{error:Y};const{playoffStructures:r}=kI({drawDefinition:t,structureId:n});if(!r?.length)return!1;const i=t?.entries?.filter((e=>e?.entryStatus&&bp.includes(e.entryStatus)))?.length||0;let a=0;return(r||[]).reduce(((e,t)=>{const n=op({structure:t}).positionAssignments??[],r=n?.filter((e=>(e.participantId&&a++,e?.bye||e?.participantId))).length;return!(!r||!e)}),!!r.length)||a===i}const BI={[lo]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},VI="positionAction",jI="matchUpAction";function GI({actionType:e=VI,appliedPolicies:t,drawDefinition:n,structure:r}){const i=e===VI&&po||e===jI&&lo,a=e===VI&&Vf||e===jI&&BI,o=i&&(t?.[i]||a?.[i]),s=n.links?.filter((e=>e?.target?.structureId===r?.structureId)),c=s?.map((({target:e})=>e.feedProfile))??[],{enabledStructures:u,disabledStructures:d}=o||{},p=d?.find((e=>{const{stages:t,stageSequences:n,structureTypes:i,feedProfiles:a}=e;return(!a?.length||Array.isArray(a)&&a.some((e=>c.includes(e))))&&(!t?.length||Array.isArray(t)&&t?.includes(r?.stage))&&(!i?.length||Array.isArray(i)&&i?.includes(r?.structureType))&&(!n?.length||Array.isArray(n)&&n.includes(r?.stageSequence))}));return{enabledStructures:u,actionsDisabled:p,actionsPolicy:o}}function qI({activePositionOverrides:e,activeDrawPositions:t,action:n}){return!(!n||!e.includes(n))||!t.length}function $I({enabledStructures:e,drawDefinition:t,structure:n}){if(!1===e)return{};if(!e?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:r,stageSequence:i,structureType:a}=n||{},o=t.links?.filter((e=>e?.target?.structureId===n?.structureId)),s=o?.map((({target:e})=>e.feedProfile))||[];return{policyActions:e.find((e=>{const{stages:t,stageSequences:n,structureTypes:o,feedProfiles:c}=e||{},u=!t?.length||Array.isArray(t)&&t.includes(r),d=!n?.length||Array.isArray(n)&&n.includes(i),p=!o?.length||Array.isArray(o)&&o.includes(a),l=!c?.length||Array.isArray(c)&&c.some((e=>s.includes(e)));return d&&p&&l&&e&&u}))}}function WI({action:e,policyActions:t}){const n=!t?.enabledActions||t?.disabledActions?.length&&t.disabledActions.includes(e);if(n)return!1;return(0===t?.enabledActions.length||t?.enabledActions.includes(e))&&!n}const HI="replaceTieMatchUpParticipantId",zI="assignTieMatchUpParticipantId",YI="removeTieMatchUpParticipantId",KI="assignMatchUpSideParticipant",QI="removeMatchUpSideParticipant",JI="substituteParticipant",XI="REMOVE_SUBSTITUTION",ZI="REPLACE_PARTICIPANT",eg="REMOVE_PARTICIPANT",tg="setMatchUpStatus",ng="SUBSTITUTION",rg="SCHEDULE",ig="REFEREE",ag="STATUS",og="START",sg="SCORE",cg="END",ug={REPLACE_TEAM_POSITION_METHOD:HI,ASSIGN_TEAM_POSITION_METHOD:zI,REMOVE_TEAM_POSITION_METHOD:YI,REPLACE_PARTICIPANT:ZI,SUBSTITUTION_METHOD:JI,REMOVE_SUBSTITUTION:XI,REMOVE_PARTICIPANT:eg,SCHEDULE_METHOD:tg,SUBSTITUTION:ng,SCHEDULE:rg,PENALTY:"PENALTY",REFEREE:ig,STATUS:ag,SCORE:sg,START:og,END:cg};function dg({restrictAdHocRoundParticipants:e=!0,policyDefinitions:t,tournamentParticipants:n=[],inContextDrawMatchUps:r,tournamentRecord:i,drawDefinition:a,enforceGender:o,participantId:s,matchUpsMap:c,sideNumber:u,matchUpId:d,event:p}){if(!a)return{error:Y};if(!d)return{error:Qe};if(u&&![1,2].includes(u))return Mi({result:{error:xn},context:{sideNumber:u}});const l=t?.[po]?.otherFlightEntries,{drawId:m}=a,{matchUp:f,structure:h}=Qp({drawDefinition:a,matchUpId:d,event:p});if(!f)return{error:Xe};const I=Xo({tournamentRecord:i,drawDefinition:a,structure:h,event:p}).appliedPolicies??{};Object.assign(I,t??{});const g=I?.[lo]??BI[lo],U=Hp({drawDefinition:a,structure:h}),{enabledStructures:y}=GI({actionType:jI,appliedPolicies:I,drawDefinition:a,structure:h}),{policyActions:v}=$I({enabledStructures:y,drawDefinition:a,structure:h});c=c??_p({drawDefinition:a}),r||({matchUps:r}=Cl({tournamentParticipants:n,inContext:!0,drawDefinition:a,matchUpsMap:c,event:p}));const S=r?.find((e=>e.matchUpId===d)),w=u&&S?.sides?.find((e=>e.sideNumber===u)),T=S?.sides?.map((e=>e.participantId||e.participant?.participantid)).filter(Boolean)??[],{assignedPositions:D,allPositionsAssigned:R}=sp({structure:h}),{structureId:b}=h??{},N=[];if(!b)return{validActions:N};if(U){const t=(h?.matchUps??[]).filter((({roundNumber:e})=>e===f.roundNumber)),r=a?.entries?.filter((({entryStatus:e})=>e&&Rp.includes(e))).map(Sl)??[],i=t.map((e=>(e.sides??[]).flatMap(Sl))).flat().filter(Boolean),o=r.filter((t=>!(T.includes(t)||e&&i.includes(t)))),s=n?.filter((e=>o?.includes(e.participantId))).map((e=>ii(e,void 0,!0)));s?.forEach((e=>{const t=(a.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),o.length&&N.push({payload:{drawId:m,matchUpId:d,structureId:b,sideNumber:u},method:KI,type:Af,availableParticipantIds:o,participantsAvailable:s});const c=function({eventEntries:e,structure:t}){const n=e=>e.entryStatus===dp&&OI({structure:t,entry:e}),r=(e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0);return e.filter(n).sort(r).map(Sl)}({eventEntries:p?.entries??[],structure:h});let I=P(r.concat(c));if(l){const e=p?Ks({event:p}):void 0,t=e?.flights?.filter((e=>e.drawId!==m)).flatMap((e=>e.drawEntries.filter((e=>e.participantId&&![Pp,vp,Sp].includes(e.entryStatus))).map((({participantId:e})=>e)))).filter(Boolean);t?.length&&I.push(...t)}I=I.filter((t=>!(T.includes(t)||o.includes(t)||e&&i.includes(t))));const g=n?.filter((e=>I.includes(e.participantId))).map((e=>ii(e,void 0,!0)));if(g.forEach((e=>{const t=(a.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),g.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),I.length&&N.push({payload:{drawId:m,matchUpId:d,structureId:b,sideNumber:u},availableParticipantIds:I,participantsAvailable:g,method:KI,type:dp}),!dl(f)&&u){const e=f.sides?.find((e=>e.sideNumber===u));e?.participantId&&N.push({payload:{drawId:m,matchUpId:d,structureId:b,sideNumber:u},method:QI,type:eg})}}const M=_I({drawDefinition:a,structure:h}),A=D?.filter((e=>e.participantId)).map((e=>e.drawPosition)),E=D?.filter((e=>e.bye)).map((e=>e.drawPosition)),C=f.collectionId,O=f.matchUpStatus===ma||!C&&f.drawPositions?.reduce(((e,t)=>E?.includes(t)||e),!1);if(O)return{validActions:N,isByeMatchUp:O};WI({policyActions:v,action:ig})&&N.push({type:ig,payload:{matchUpId:d}});const F=!pl({matchUpStatus:f.matchUpStatus}),k=I?.scoring?.structures,x=h?.stage&&k?.stage&&k?.stage[h.stage],_=h?.stageSequence&&x?.stageSequence&&x.stageSequence[h.stageSequence],L=!(I?.scoring?.requireAllPositionsAssigned||x?.requireAllPositionsAssigned||_?.requireAllPositionsAssigned)||R,B=f.sides&&2===f.sides.filter((e=>e?.participantId)).length,V=f.matchUpStatus&&[ya,Ua].includes(f.matchUpStatus),j=bl({inContextDrawMatchUps:r,drawDefinition:a,matchUpId:d}),G=FI({inContextDrawMatchUps:r,drawDefinition:a,targetData:j}),q=(2===S?.drawPositions?.length&&S.drawPositions.every((e=>A?.includes(e)))&&2===S?.sides?.length&&S.sides.every((({participantId:e})=>e))||B)&&!(V&&G),$={method:Df,type:_f,payload:{drawId:m,matchUpId:d,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(F&&N.push({payload:{drawId:m,matchUpId:d,schedule:{}},method:tg,type:rg}),WI({policyActions:v,action:_f})&&(w?.participant||!u&&T?.length)&&N.push($),F&&q&&N.push({type:ag}),L&&q){const{matchUpId:e,matchUpFormat:t}=f,n={drawId:m,matchUpId:e,matchUpFormat:t,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};N.push({info:"set outcome and winningSide",method:tg,type:sg,payload:n}),WI({policyActions:v,action:og})&&N.push({type:og}),WI({policyActions:v,action:cg})&&N.push({type:cg})}if(C&&S){const e=S.sides?.find((e=>e.participant)),n=S.gender===Ci&&S.sideNumber&&1===S.sides?.filter((e=>e.particiapntId)).length&&e?.participant?.person?.sex,i=S.matchUpType,a=!1!==(o??g?.participants?.enforceGender)?S.gender:void 0,c=S.sides?.flatMap((e=>e.participant?.individualParticipants||e.participant)).filter(Boolean),p=c?.map(Sl),l=S.sides?.filter((e=>!u||e.sideNumber===u)).flatMap((e=>e.participant?.individualParticipants||e.participant)).filter(Boolean),h=l?.map(Sl),I=r?.find((e=>e.matchUpId===S.matchUpTieId)),U=I?.sides?.map((e=>e.participant.individualParticipants.filter((({participantId:e,person:t})=>!h?.includes(e)&&(!a||a===Ai||t.sex===a||a===Ci&&!n||n&&t.sex!==n))))),y=u?U?.[u-1]:U?.map(((e,t)=>({participants:e,sideNumber:t+1}))),P=u?U?.[u-1]?.map(Sl):U?.map(((e,t)=>({participants:e?.map(Sl),sideNumber:t+1}))),D=u&&(i===xi&&!h?.length||i===Li&&(h?.length??0)<2)||!u&&(i===xi&&(h?.length??0)<2||i===Li&&(h?.length??0)<4),R=P?.filter((e=>!p?.includes(e))),b=y?.filter((({participantId:e})=>R.includes(e)));if(D&&R?.length&&N.push({availableParticipantIds:R,method:zI,availableParticipants:b,type:Af,payload:{participantId:void 0,tieMatchUpId:d,drawId:m}}),!h?.length||dl(f)&&!w?.substitutions?.length||N.push({method:YI,type:eg,existingParticipantIds:h,payload:{participantId:void 0,tieMatchUpId:d,drawId:m}}),b?.length&&(!u&&h?.length||u&&w?.participant)&&N.push({availableParticipantIds:R,method:HI,availableParticipants:b,type:ZI,existingParticipantIds:h,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:d,drawId:m}}),WI({policyActions:v,action:XI})&&w?.substitutions?.length){const e=w.participant?.participantType===qu&&[w.participantId]||w.participant?.participantType===Wu&&w.participant.individualParticipantIds||[],t=w.substitutions.map((e=>e.participantId)).filter((t=>e.includes(t)));s&&!t.includes(s)||N.push({method:YI,type:XI,substitutedParticipantIds:t,payload:{participantId:void 0,tieMatchUpId:d,drawId:m}})}const M=t?.[lo],A=M?.substituteWithoutScore,E=M?.substituteAfterCompleted;if(WI({policyActions:v,action:ng})&&2===T.length&&(!u&&h?.length||u&&w?.participant)&&(A||dl(f))&&(E||f.matchUpStatus&&!Ca.includes(f.matchUpStatus))&&l?.length&&y.length){const e=l.map(Sl);N.push({info:"list of team players available for substitution",method:JI,availableParticipantIds:P,existingParticipantIds:e,availableParticipants:y,existingParticipants:l,type:ng,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:u,matchUpId:d,drawId:m}})}}return{structureIsComplete:M,validActions:N,isDoubleExit:V}}function pg({policyDefinitions:e,tournamentRecord:t,drawDefinition:n,enforceGender:r,participantId:i,sideNumber:a,matchUpId:o,drawId:s,event:c}){if(!t)return{error:$};if(!s){const e=rh({tournamentRecord:t}).matchUps??[];s=e.reduce(((e,t)=>t.matchUpId===o?t.drawId:e),void 0);n=(t.events??[]).map((e=>e.drawDefinitions??[])).flat().reduce(((e,t)=>t.drawId===s?t:e),void 0)}const{policyDefinitions:u}=Zo({policyTypes:[po],tournamentRecord:t,drawDefinition:n,event:c});return e=e??u,n?dg({tournamentParticipants:t.participants,policyDefinitions:e,drawDefinition:n,enforceGender:r,participantId:i,sideNumber:a,matchUpId:o,event:c}):{error:Q}}function lg({tournamentRecords:e,convertExtensions:t,ignoreDisabled:n,venueIds:r=[],dates:i}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const a=[],o=[],s=[],c=[];return Object.keys(e).forEach((u=>{const d=e[u];for(const e of d.venues||[])if(!r.length||r.includes(e.venueId)){if(n){const{extension:t}=lc({name:Ao,element:e});if(t?.value)continue}a.includes(e.venueId)||(c.push(ii(e,t,!0)),a.push(e.venueId));for(const r of e.courts||[])if(!o.includes(r.courtId)){if(n&&i){const{extension:e}=lc({name:Ao,element:r});if(pc({extension:e,dates:i}))continue}const{inContextCourt:a}=mc({convertExtensions:t,ignoreDisabled:n,venue:e,court:r});s.push(a),o.push(r.courtId)}}})),{courts:s,venues:c}}function mg({tournamentRecords:e,requireCourts:t,dates:n}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};return Object.keys(e).reduce(((r,i)=>{const a=e[i],{venues:o}=qc({tournamentRecord:a,dates:n});return o?.forEach((e=>{const{venueId:n,courts:i}=e;(!t||i?.length)&&!r.venueIds.includes(n)&&(r.venues.push(e),r.venueIds.push(n))})),r}),{venues:[],venueIds:[]})}function fg({tournamentRecords:e,schedulingProfile:t}){if(!t)return{valid:!0};if(!Array.isArray(t))return{valid:!1,error:xn};const{venueIds:n,tournamentsMap:r}=function(e){const t=e?.tournamentRecords&&Object.values(e?.tournamentRecords)||[],n={},{venueIds:r,eventIds:i,drawIds:a,structureIds:o,tournamentIds:s}=t.reduce(((e,t)=>{const{tournamentIds:r,tournamentMap:i,structureIds:a,venueIds:o,eventIds:s,drawIds:c}=hg({tournamentRecord:t});return o.forEach((t=>{e.venueIds.includes(t)||e.venueIds.push(t)})),e.tournamentIds.push(...r),e.structureIds.push(...a),e.eventIds.push(...s),e.drawIds.push(...c),Object.assign(n,i),e}),{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:n,tournamentIds:s,structureIds:o,venueIds:r,eventIds:i,drawIds:a}}({tournamentRecords:e});let i,a;const o=t.every((e=>{const{scheduleDate:t,venues:o}=e;return!!Or(t)&&o.every((e=>{const{venueId:t,rounds:o}=e;if("string"!=typeof t)return a="venueId should be a string",!1;if(!Array.isArray(o))return a="rounds should be an array",!1;if(!n.includes(t))return i=mn,!1;return!!o.every((e=>{if(!e)return a="empty round",!1;const{roundSegment:t,tournamentId:n,structureId:i,roundNumber:o,eventId:s,drawId:c}=e,u=r?.[n]?.[s]?.[c]?.[i],d=u?.includes(o);d||(a="Invalid rounds");const{segmentNumber:p,segmentsCount:l}=t||{},m=!t||S(p)&&f(l)&&p<=l;return m||(a="Invalid segment"),d&&m}))}))}));return o||i||(i=xn),{valid:!!o,error:i,info:a}}function hg(e){const{tournamentRecord:t={},tournamentMap:n={},requireCourts:r}=e,i=[],a=[],o=[],s=[],c=(t?.venues||[]).map((({venueId:e,courts:t})=>(!r||t?.length)&&e)),u=t?.tournamentId;if(u){i.push(u),n[u]={};(t?.events||[]).forEach((e=>{const t=e.eventId;o.push(t),n[u][t]={},(e.drawDefinitions||[]).forEach((e=>{const r=e.drawId;s.push(r),n[u][t][r]={};const{structures:i}=ip({drawDefinition:e});(i||[]).forEach((e=>{const i=e.structureId,{matchUps:o}=Kp({structure:e}),{roundMatchUps:s}=ed({matchUps:o}),c=s&&Object.keys(s).map((e=>parseInt(e)));n[u][t][r][i]=c,a.push(i),e.structures?.length&&e.structures.forEach((e=>{a.push(e.structureId),n[u][t][r][e.structureId]=c}))}))}))}))}return{tournamentMap:n,tournamentIds:i,structureIds:a,venueIds:c,eventIds:o,drawIds:s}}function Ig({tournamentRecord:e}){if(!e)return{error:$};const t=(({tournamentId:e,tournamentRank:t,tournamentStatus:n,formalName:r,tournamentName:i,promotionalName:a,onlineResources:o,localTimeZone:s,startDate:c,endDate:u,hostCountryCode:d,tournamentContacts:p,tournamentAddresses:l})=>({tournamentId:e,tournamentRank:t,tournamentStatus:n,formalName:r,tournamentName:i,promotionalName:a,onlineResources:o,localTimeZone:s,startDate:c,endDate:u,hostCountryCode:d,tournamentContacts:p,tournamentAddresses:l}))(e);return{...L,tournamentInfo:ii(t,!1,!0)}}function gg({tournamentRecords:e}){const t=Object.keys(e).reduce(((t,n)=>{const r=e[n],{tournamentInfo:{startDate:i,endDate:a}}=Ig({tournamentRecord:r}),o=i&&new Date(Wr(i));(!t.startDate||o&&o<t.startDate)&&(t.startDate=o);const s=a&&new Date(Wr(a));return(!t.endDate||s&&s>t.endDate)&&(t.endDate=s),t}),{startDate:void 0,endDate:void 0}),n=t.startDate&&Wr(t.startDate.toISOString()),r=t.endDate&&Wr(t.endDate.toISOString());return n&&r?{startDate:n,endDate:r}:{error:ft}}function Ug({tournamentRecords:e}){if(!e)return{error:q};return Object.keys(e).reduce(((t,n)=>{t.tournamentIdMap[n]=[];const r=e[n].events||[],i=r.map((({eventId:e})=>e)),a=r.map((e=>(e.drawDefinitions||[]).map((({drawId:e})=>e)))).flat();return t.tournamentIdMap[n].push(...i,...a),t.eventIds.push(...i),t.drawIds.push(...a),t}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function yg({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const{extension:t}=sc({name:Ho,tournamentRecords:e});let n=t?.value||[];if(n.length){const{venueIds:t}=mg({requireCourts:!0,tournamentRecords:e}),{eventIds:r,drawIds:i}=Ug({tournamentRecords:e}),{updatedSchedulingProfile:a,modifications:o,issues:s}=wg({schedulingProfile:n,venueIds:t,eventIds:r,drawIds:i});if(o){n=a;const t=vg({tournamentRecords:e,schedulingProfile:n});return t.error?t:{schedulingProfile:n,modifications:o,issues:s}}}return{schedulingProfile:n,modifications:0}}function vg({tournamentRecords:e,schedulingProfile:t}){const n=fg({tournamentRecords:e,schedulingProfile:t});if(n.error)return n;if(!t)return cc({tournamentRecords:e,name:Ho});return oc({tournamentRecords:e,extension:{name:Ho,value:t}})}function Sg({tournamentRecords:e,scheduleDate:t,venueId:n,round:r}){if(!Or(t))return{error:yt};const{extension:i}=sc({tournamentRecords:e,name:Ho}),a=i?.value||[];let o=a.find((e=>ni(t,e.scheduleDate)));if(!o){const{startDate:n,endDate:r}=gg({tournamentRecords:e}),i=new Date(t);if(n&&i<new Date(n)||r&&i>new Date(r))return{error:yt};o={scheduleDate:t,venues:[]},a.push(o)}let s=o.venues.find((e=>e.venueId===n));s||(s={venueId:n,rounds:[]},o.venues.push(s));const c=["notBeforeTime"],u=e=>Object.keys(e).filter((e=>!c.includes(e))).sort().map((t=>ci(e[t])?u(e[t]):e[t])).flat().join("|");if(s.rounds.find((e=>u(e)===u(r))))return Mi({result:{error:Pe},stack:"addSchedulingProfileRound"});s.rounds.push(r);const d=vg({tournamentRecords:e,schedulingProfile:a});return d.error?d:{...L}}function wg({schedulingProfile:e,venueIds:t,eventIds:n,drawIds:r}){const i=[],a=e?.map((e=>{const a=Wr(e?.scheduleDate);if(!a)return void i.push(`Invalid date: ${e?.scheduledDate}`);const o=(e?.venues||[]).map((e=>{const{rounds:a,venueId:o}=e;if(!t.includes(o))return void i.push(`Missing venueId: ${o}`);const s=a.filter((e=>{const t=n.includes(e.eventId)&&r.includes(e.drawId);return t||i.push(`Invalid eventId: ${e.eventId} or drawId: ${e.drawId}`),t}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...e,venues:o}})).filter(Boolean);return{updatedSchedulingProfile:a,modifications:i.length,issues:i}}function Pg({tournamentRecords:e}){const{schedulingProfile:t}=yg({tournamentRecords:e});if(t){const{venueIds:n}=mg({tournamentRecords:e}),{eventIds:r,drawIds:i}=Ug({tournamentRecords:e}),{updatedSchedulingProfile:a,modifications:o}=wg({schedulingProfile:t,venueIds:n,eventIds:r,drawIds:i});if(o)return vg({tournamentRecords:e,schedulingProfile:a})}return{...L}}function Tg({defaultRecoveryMinutes:e=0,defaultAverageMinutes:t,tournamentRecords:n,matchUpFormat:r,categoryName:i,categoryType:a,tournamentId:o,eventType:s,eventId:c}){if(!Ti(r))return{error:Ge};let u;return Object.keys(n).filter((e=>!o||e===o)).forEach((e=>{if(u)return;const t=n[e],o=c?Qs({tournamentRecord:t,eventId:c})?.event:void 0;return u=Hs({tournamentRecord:t,matchUpFormat:r,categoryName:i,categoryType:a,eventType:s,event:o}),u?.averageMinutes||u?.recoveryMinutes})),{recoveryMinutes:u?.recoveryMinutes||e,averageMinutes:u?.averageMinutes||t,typeChangeRecoveryMinutes:u?.typeChangeRecoveryMinutes||u?.recoveryMinutes||e}}function Dg(e){const{containerStructureId:t,roundSegment:n,isRoundRobin:r,tournamentId:i,roundNumber:a,structureId:o,eventId:s,drawId:c}=e,u=r?t:o,d=[i,s,c,u,a].join("|");return pi({structureId:u,roundSegment:n,tournamentId:i,roundNumber:a,eventId:s,drawId:c,id:d})}function Rg({round:e,matchUps:t,events:n,tournamentRecords:r}){const i=n.find((t=>t.eventId===e.eventId)),{eventType:a,category:o,categoryType:s}=i||{},{categoryName:c,ageCategoryCode:u}=o||{},d=R(t.map((({matchUpFormat:e})=>e)));let p=0;return Object.keys(d).forEach((t=>{const n=d[t],i=Tg({categoryName:c||u,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:r,matchUpFormat:t,categoryType:s,eventType:a});if(i.error)return i;const o=i.averageMinutes*n;isNaN(p)||(p+=o)})),{roundMinutes:p}}function bg(e){const t=e.length,n=e.filter((({sides:e})=>e?.some((({bye:e})=>e)))).length||0,r=e.filter((({winningSide:e,matchUpStatus:t})=>e||Ca.includes(t))).length||0,i=e.filter((({schedule:e,matchUpStatus:t})=>e?.scheduledDate&&e?.scheduledTime&&t!==ma)).length||0,a=t-n;return{unscheduledCount:a-i,incompleteCount:a-i,scheduledCount:i,completedCount:r,matchUpsCount:t,isScheduled:a===i,isComplete:a===r,byeCount:n}}function Ng({tournamentRecords:e,schedulingProfile:t,tournamentRecord:n,withRoundId:r}){if(n&&!e){if("object"!=typeof n)return{error:W};e={[n.tournamentId]:n}}if(t){const n=fg({tournamentRecords:e,schedulingProfile:t});if(n.error)return n}if(!t&&e){const n=yg({tournamentRecords:e});if(n.error)return n;t=n.schedulingProfile}if(!t)return{error:Gn};const i={};return{profileRounds:t.map((({venues:e,scheduleDate:t})=>e.map((({rounds:e})=>e.map((e=>{const n=Dg(e);return n.roundSegment?.segmentsCount&&(i[n.id]=n.roundSegment.segmentsCount),pi({id:r?n.id:void 0,scheduleDate:t,...n})})))))).flat(1/0),segmentedRounds:i}}function Mg({participantsCount:e,participantCount:t}){if(!(e=e||t))return{error:xn};const n=y(e);return n?{drawSize:n}:Mi({result:{error:xn},stack:"getEliminationDrawSize",context:{participantsCount:e}})}function Ag({selected:e=!0,drawDefinition:t,entryStatuses:n,drawId:r,event:i,stage:a}){let o=i.entries??[];if(r){const{flightProfile:e}=Ks({event:i}),n=e?.flights?.find((e=>e.drawId===r));n?o=n.drawEntries:t.entries&&(o=t?.entries)}const s=o.filter((t=>(!n?.length||!t.entryStatus||n.includes(t.entryStatus))&&(!a||!t.entryStage||t.entryStage===a)&&(!e||t.entryStatus&&bp.includes(t.entryStatus))));return{entries:o,stageEntries:s}}function Eg(e){let{drawSizeProgression:t=!1,policyDefinitions:n,drawSize:r}=e||{};const{requireParticipantCount:i=!0,tournamentRecord:a,drawDefinition:o,event:s}=e||{},c="getSeedsCount",u=e?.participantsCount||e?.participantCount;if(!n){const e=Zo({tournamentRecord:a,drawDefinition:o,event:s});if(e.error)return Mi({result:e,stack:c});n=e.policyDefinitions}const d=S(u);if(u&&!d)return Mi({result:{error:xn},context:{participantsCount:u},stack:c});if(i&&!d)return Mi({result:{error:qt},stack:c});if(isNaN(r)){if(!u)return Mi({result:{error:pe},stack:c});({drawSize:r}=Mg({participantsCount:u}))}const p=i&&u||r;if(p&&p>r)return{error:Kt};const l=n?.[So];if(!l)return{error:ot};const m=l.seedsCountThresholds;if(!m)return{error:Ie};void 0!==l.drawSizeProgression&&(t=l.drawSizeProgression);return{seedsCount:m.filter((e=>t?e.drawSize<=r:r===e.drawSize)).reduce(((e,t)=>u&&u>=t.minimumParticipantCount?t.seedsCount:e),0)}}function Cg({policyDefinitions:e,drawDefinition:t,drawSize:n,drawId:r,event:i,stage:a}){if(!i)return{error:Ae};const{entries:o,stageEntries:s}=Ag({drawDefinition:t,drawId:r,stage:a,event:i}),c=s.length,{drawSize:u}=Mg({participantsCount:c}),d=Eg({drawSize:n??u,participantsCount:c,policyDefinitions:e});if(d.error)return Mi({result:d,stack:"getEntriesAndSeedsCount"});const{seedsCount:p}=d;return{entries:o,seedsCount:p,stageEntries:s}}function Og({tournamentRecord:e}){if(!e)return{error:$};const{policy:t}=fs({policyType:go,tournamentRecord:e}),{extension:n}=As({name:$o,tournamentRecord:e}),r=n?.value?.dailyLimits,i=t?.defaultDailyLimits;return{matchUpDailyLimits:r||i}}function Fg({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};let n;return Object.keys(e).filter((e=>!t||e===t)).forEach((t=>{const r=e[t],{matchUpDailyLimits:i}=Og({tournamentRecord:r});n=i})),{matchUpDailyLimits:n}}function kg({schedulingProfile:e,matchUps:t=[]}){const n={},r=({eventId:e,drawId:t,structureId:n,roundNumber:r})=>`${e}|${t}|${n}${r}`;if(e?.length){e.map((({venues:e})=>e.map((({rounds:e})=>e)))).flat().forEach((e=>{e.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))).forEach((({eventId:e,drawId:t,structureId:i,roundNumber:a},o)=>{const s=r({eventId:e,drawId:t,structureId:i,roundNumber:a});n[s]=o}))}))}const i=[],a={noScheduledDate:[]};for(const s of t){const e=s.schedule||{},t=e.scheduledDate&&Wr(e.scheduledDate)||e.scheduledTime&&Wr(e.scheduledTime)||"noScheduledDate";a[t]||(a[t]=[]),a[t].push(s)}const o=Object.keys(a).sort();for(const s of o){const e=a[s],t={noScheduledTime:[]};for(const n of e){const e=n.schedule||{},r=e.scheduledTime&&$r(e.scheduledTime)||"noScheduledTime";t[r]||(t[r]=[]),t[r].push(n)}const o=Object.keys(t).sort();for(const a of o){const e=t[a];e.sort(((e,t)=>(n[r(e)]||0)-(n[r(t)]||0))),i.push(...e)}}return i}function xg({courtPrefix:e="C|",minRowsCount:t,courtsData:n}){if(!Array.isArray(n))return{error:xn};const r=n?.reduce(((e,t)=>{const n=t.matchUps||[],r=Math.max(0,...n.map((e=>e.schedule.courtOrder||0)));return r>e?r:e}),1),i=E(0,t?Math.max(t,r):r).map((e=>({matchUps:E(0,n.length).map((t=>{const r=n[t],{courtId:i,venueId:a}=r;return{schedule:{courtOrder:e+1,venueId:a,courtId:i}}}))})));return n.forEach(((e,t)=>{for(const n of e.matchUps){const e=n.schedule?.courtOrder;e&&(i[e-1].matchUps[t]=n)}})),{courtPrefix:e,rows:i.map(((t,n)=>Object.assign({rowId:`rowId-${n+1}`},...t.matchUps.map(((t,n)=>({[`${e}${n}`]:t}))))))}}function _g(e){if("object"!=typeof e?.tournamentRecords||!Object.keys(e?.tournamentRecords).length)return{error:q};const{courts:t,venues:n}=lg(e),r=yg(e).schedulingProfile,{sortDateMatchUps:i=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:o,activeTournamentId:s,tournamentRecords:c,withCourtGridRows:u,minCourtGridRows:d,usePublishState:p,status:l=yu,sortCourtsData:m}=e,f=p?Kf({tournamentRecord:c[s??gr()],itemType:`${Uu}.${vu}`}).timeItem:void 0,h=f?.itemValue?.[l],I=o?Dh({...e,matchUpFilters:{...e.matchUpFilters,matchUpStatuses:[Ki.Completed]},contextFilters:e.contextFilters}).completedMatchUps:[];if(p&&(!h||!Object.keys(h).length))return{completedMatchUps:I,dateMatchUps:[],courtsData:[],venues:n};const g=p?function({tournamentRecords:e}){const t=[];for(const n of Object.values(e))for(const e of n.events??[]){const{timeItem:n}=Yf({itemType:`${Uu}.${vu}`,event:e}),r=n?.itemValue?.[yu];if(r?.drawIds?.length)t.push(...r.drawIds);else{const n=(e.drawDefinitions??[]).map((({drawId:e})=>e)).filter(Boolean);t.push(...n)}}return{drawIds:t}}({tournamentRecords:c}).drawIds:void 0;g?.length&&(e.contextFilters||(e.contextFilters={}),e.contextFilters?.drawIds?e.contextFilters.drawIds=e.contextFilters.drawIds.filter((e=>g.includes(e))):e.contextFilters.drawIds=g),h?.eventIds?.length&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters?.eventIds&&e.matchUpFilters.eventIds.length?e.matchUpFilters.eventIds=e.matchUpFilters.eventIds.filter((e=>h.eventIds.includes(e))):e.matchUpFilters.eventIds=h.eventIds),h?.scheduledDates?.length&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters.scheduledDates&&e.matchUpFilters.scheduledDates.length?e.matchUpFilters.scheduledDates=e.matchUpFilters.scheduledDates.filter((e=>h.scheduledDates.includes(e))):e.matchUpFilters.scheduledDates=h.scheduledDates),o&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters?.excludeMatchUpStatuses?.length?e.matchUpFilters.excludeMatchUpStatuses.includes(ha)||e.matchUpFilters.excludeMatchUpStatuses.push(ha):e.matchUpFilters.excludeMatchUpStatuses=[ha]);const{completedMatchUps:U,upcomingMatchUps:y,pendingMatchUps:v,groupInfo:S}=Dh({...e,matchUpFilters:e.matchUpFilters,contextFilters:e.contextFilters}),w=[...y??[],...v??[]],P=i?kg({matchUps:w,schedulingProfile:r}):w,T=t?.map((e=>{const t=function({courtId:e}){const t=(a?P.concat(U??[]):P).filter((t=>t.schedule?.courtId===e||t.schedule?.allocatedCourts?.map((({courtId:e})=>e)).includes(e)));return m?kg({matchUps:t,schedulingProfile:r}):t}(e);return{surfaceCategory:e?.surfaceCategory??"",matchUps:t,...e}})),D={courtsData:T,completedMatchUps:o?I:U,dateMatchUps:P,groupInfo:S,venues:n};if(u){const{rows:e,courtPrefix:t}=xg({minRowsCount:d,courtsData:T});D.courtPrefix=t,D.rows=e}return{...D,...L}}const{stageOrder:Lg}=ep;function Bg(e,t){return e.eventName.localeCompare(t.eventName)||e.eventId.localeCompare(t.eventId)||(Lg[e?.stage]||0)-(Lg[t?.stage]||0)||t.matchUpsCount-e.matchUpsCount||`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`.localeCompare(`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`)}function Vg({excludeScheduleDateProfileRounds:e,excludeScheduledRounds:t,excludeCompletedRounds:n,inContextMatchUps:r,tournamentRecords:i,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:c,scheduleDate:u,withRoundId:d,venueId:p,context:l}){if(r&&!Array.isArray(r||"object"!=typeof r[0]))return{error:xn,inContextMatchUps:r};if(o&&!i){if("object"!=typeof o)return{error:W};i={[o.tournamentId]:o}}const m="object"!=typeof i||!Object.keys(i).length;if((p||u||!r||!a&&(e||n||a||s))&&m)return{error:q};const f=Object.assign({},...Object.values(i??{}).map((({venues:e=[],tournamentId:t})=>({[t]:e?.map((({venueId:e})=>e))})))),h=Object.values(i??{}).map((({events:e=[],tournamentId:t,startDate:n,endDate:r})=>e.map((e=>({...e,validVenueIds:f[t],startDate:e.startDate??n,endDate:e.endDate??r}))))).flat(),{segmentedRounds:I,profileRounds:g}=i&&(e||n||a||s)&&Ng({tournamentRecords:i,schedulingProfile:a})||{},U=e&&Object.assign({},...g.map((e=>({[e.id]:e})))),y=r||i&&Th({tournamentRecords:i,matchUpFilters:c})?.matchUps||[],v=[],S=y&&Object.values(y.reduce(((e,t)=>{const n=Dg(t).id,r=I?.[n],i=[...e[n]?.matchUps??[],t],{containerStructureId:a,stageSequence:o,structureName:s,tournamentId:c,isRoundRobin:u,matchUpType:p,roundNumber:l,roundOffset:m,structureId:f,eventName:h,roundName:g,drawName:U,eventId:y,drawId:v}=t,S=u?a:f;return{...e,[n]:{id:d?n:void 0,structureId:S,stageSequence:o,segmentsCount:r,structureName:s,tournamentId:c,matchUpType:p,roundNumber:l,roundOffset:m,eventName:h,roundName:g,drawName:U,matchUps:i,eventId:y,drawId:v}}}),{})).map((e=>{const{minFinishingSum:t,winnerFinishingPositionRange:n}=(e.matchUps||[]).reduce(((e,t)=>{const n=(t.finishingPositionRange?.winner||[]).reduce(((e,t)=>e+t),0),r=(t.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||n<e.minFinishingSum?{minFinishingSum:n,winnerFinishingPositionRange:r}:e}),{minFinishingSum:0,winnerFinishingPositionRange:""});const r=e.segmentsCount;if(r){const a=e.matchUps.length/r;return x(e.matchUps.sort(((e,t)=>e.roundPosition-t.roundPosition)),a).map(((a,o)=>{const{unscheduledCount:s,incompleteCount:c,matchUpsCount:u,isScheduled:d,isComplete:p,byeCount:m}=bg(a),f=Rg({matchUps:e.matchUps,tournamentRecords:i,events:h,round:e});return pi({...e,...l,roundSegment:{segmentsCount:r,segmentNumber:o+1},winnerFinishingPositionRange:n,unscheduledCount:s,incompleteCount:c,minFinishingSum:t,matchUpsCount:u,isScheduled:d,roundTiming:f,isComplete:p,byeCount:m,matchUps:a})}))}const{unscheduledCount:a,incompleteCount:o,matchUpsCount:s,isScheduled:c,isComplete:u,byeCount:d}=bg(e.matchUps),p=Rg({matchUps:e.matchUps,tournamentRecords:i,events:h,round:e});return pi({...e,...l,winnerFinishingPositionRange:n,unscheduledCount:a,incompleteCount:o,minFinishingSum:t,matchUpsCount:s,isScheduled:c,roundTiming:p,isComplete:u,byeCount:d})})).flat().filter((r=>{if(e){const t=Wr(e),n=d?r.id:Dg(r).id;if(t&&U[n]&&Wr(U[n].scheduleDate)===t)return!1}const{isComplete:i,isScheduled:a}=r,s=!n||!i,c=!t||!a,l=p||u?h?.find((({eventId:e})=>e===r.eventId)):void 0,m=l?.startDate||o?.startDate,f=l?.endDate||o?.endDate,I=!u||!m||new Date(u)>=new Date(m),g=!u||!f||new Date(u)<=new Date(f),y=I&&g,S=!p||l?.validVenueIds.includes(p),w=s&&c&&S&&y;return w||v.push(r),w})).sort(Bg)||[];return{...L,rounds:S,excludedRounds:v}}function jg({participantFilters:e={},tournamentRecord:t,participants:n=[]}){if(!Object.keys(e).length)return n;const{accessorValues:r,drawEntryStatuses:i,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:c,participantTypes:u,participantIds:d,signInStatus:p,enableOrFiltering:l,eventIds:m,genders:f}=e,h=Gg(m)&&t?.events?.filter((e=>m?.includes(e.eventId)))||t?.events||[],I=i&&function({drawEntryStatuses:e,tournamentEvents:t}){const n=({entryStatus:t})=>!Array.isArray(e)||e.includes(t);return P(t.reduce(((e,t)=>{const{flightProfile:r}=Ks({event:t}),i=r?.flights?.map((({drawEntries:e})=>Array.isArray(e)?e.filter(n).map(Sl):[])).flat()||[],a=t.drawDefinitions?.map((({entries:e})=>e?e.filter(n).map(Sl):[]))||[];return e.concat(...i,...a)}),[]))}({drawEntryStatuses:i,tournamentEvents:h}),g=o&&function({eventEntryStatuses:e,tournamentEvents:t}){return P(t.reduce(((t,n)=>{const r=(n.entries||[]).filter((({entryStatus:t})=>!Array.isArray(e)||e.includes(t))).map(Sl);return t.concat(...r)}),[]))}({eventEntryStatuses:o,tournamentEvents:h}),U=void 0!==a&&[!0,!1].includes(a)&&h.reduce(((e,t)=>e.concat(...(t.drawDefinitions||[]).map((e=>ap({drawDefinition:e}).allPositionedParticipantIds)).filter(Boolean))),[]),y=e=>r?.reduce(((t,n)=>{const{accessor:r,value:i}=n,{values:a}=oi({element:e,accessor:r});return t&&a?.includes(i)}),!0);if(n=n?.filter((e=>{const t=zf({element:e,itemType:Gu})?.timeItem?.itemValue,{participantRoleResponsibilities:n,participantType:i,participantRole:o,participantId:m,person:h}=e,v=Array.isArray(f)&&f?.length&&h?.sex&&f.includes(h.sex);return l?f&&v||a&&U.includes(m)||!1===a&&!U.includes(m)||I?.includes(m)||g?.includes(m)||d?.includes(m)||p&&t===p||u&&i&&Gg(u)&&u.includes(i)||s&&o&&Gg(s)&&s.includes(o)||c&&Gg(n)&&Gg(c)&&c.find((e=>n?.includes(e)))||r?.length&&Gg(r)&&y(e):(!f||v)&&(void 0===a||a&&U.includes(m)||!1===a&&!U.includes(m))&&(!I||I.includes(m))&&(!g||g.includes(m))&&(!d||d.includes(m))&&(!p||t===p)&&(!u||i&&Gg(u)&&u.includes(i))&&(!s||o&&Gg(s)&&s.includes(o))&&(!c||Gg(n)&&Gg(c)&&c.find((e=>n?.includes(e))))&&(!r?.length||Gg(r)&&y(e))})),h.length&&m){const e=h.filter((e=>m.includes(e.eventId))).map((e=>{const n=(e.entries||[]).map((e=>e.participantId));if(e.eventType===Ou)return n;const r=(t?.participants??[]).filter((e=>n.includes(e.participantId))).map((e=>e.individualParticipantIds)).flat(1);return n.concat(...r)})).flat(1);n=n?.filter((t=>e.includes(t.participantId)))}return n}function Gg(e){return e&&Array.isArray(e)&&e.length}function qg({event:e}){const t=`${Uu}.${vu}`,{timeItem:n}=zf({element:e,itemType:t});if(n?.itemValue?.PUBLIC){const{drawIds:e=[],seeding:t}=n.itemValue.PUBLIC||{},r={published:void 0,seedingScaleNames:[],drawIds:[]};return t&&Object.assign(r,n.itemValue.PUBLIC.seeding),{publishedDrawIds:e,publishedSeeding:r}}}function $g({publishedSeeding:e,usePublishState:t,withSeeding:n,participant:r,event:i}){const a={},o=e=>[ws,Ps,i.eventType,e].join("."),s=Object.assign({},...(r.timeItems||[]).filter((({itemType:e})=>e.split(".")[1]===Ps)).map((({itemType:e,itemValue:t})=>({[e]:t})))),c=(e?.stageSeedingScaleNames&&Object.values(e?.stageSeedingScaleNames)||Array.isArray(e?.seedingScaleNames)&&e.seedingScaleNames||[]).map(o),u=O(Object.keys(s),c);if(!(t&&(Object.keys(s).length||e?.drawIds?.length)&&!u.length)&&u.length){if(e?.stageSeedingScaleNames){const t=Object.keys(e.stageSeedingScaleNames).map((t=>{const n=o(e.stageSeedingScaleNames[t]);return[t,s[n]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),n=Object.assign({},...t);a.seedAssignments=n}else if(u){const e=u.map((e=>s[e]));a.seedValue=e.pop()}}else if(t||"object"!=typeof n){const{categoryName:n,ageCategoryCode:o}=i.category||{};let s;for(const e of[o,i.eventId,n]){const t=zh({scaleAttributes:{eventType:i.eventType,scaleType:Ps,scaleName:e},participant:r});if(t.scaleItem){s=t.scaleItem;break}}if(s){if(!t||e?.published&&!e?.published?.drawIds?.length){const e=s.scaleValue;a.seedValue=e}}}else{const e=Object.keys(n).map((e=>{const t=o(n[e]);return[e,s[t]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),t=Object.assign({},...e);a.seedAssignments=t}return a}function Wg({convertExtensions:e,seedAssignments:t,participant:n,withSeeding:r,seedValue:i,eventId:a,ranking:o,entry:s}){const{entryStatus:c,entryStage:u,entryPosition:d,extensions:p}=s,l=p?.length&&e?Object.assign({},...ai(p)):{},m=Object.assign(l,{entryPosition:d,entryStatus:c,entryStage:u,ranking:o,eventId:a});n.events[a]=pi(m,!1,!1,!0),r&&(t&&(n.events[a].seedAssignments=t),i&&(n.events[a].seedValue=i))}function Hg(e){const{participantMap:t,participantId:n,matchUpStatus:r,roundPosition:i,structureId:a,matchUpType:o,roundNumber:s,matchUpId:c,potential:u,schedule:d,drawId:p,score:l}=e;if(!d||!Object.keys(d).length)return;r===ma||t[n].scheduleItems.push({...d,scheduledDate:Wr(d?.scheduledDate),scheduledTime:$r(d?.scheduledTime),scoreHasValue:dl({score:l}),matchUpStatus:r,roundPosition:i,structureId:a,matchUpType:o,roundNumber:s,matchUpId:c,potential:u,drawId:p})}function zg({finishingPositionRange:e={},participantMap:t,finishingRound:n,participantWon:r,matchUpStatus:i,participantId:a,stageSequence:o,roundNumber:s,structureId:c,matchUpId:u,drawId:d,stage:p}){const l=t[a],m=e=>Math.abs(e[0]-e[1]);l.structureParticipation[c]||(l.structureParticipation[c]={rankingStage:p,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:c,drawId:d});const f=l.structureParticipation[c],{winner:h,loser:I}=e,g=r?h:I;r&&(f.winCount+=1,i===Ra&&(f.walkoverWinCount+=1),i===ga&&(f.defaultWinCount+=1)),g&&(!f.finishingPositionRange||m(g)<m(f.finishingPositionRange))&&(f.finishingPositionRange=g),n&&((!f.finishingRound||n<f.finishingRound)&&(f.finishingMatchUpId=u,f.finishingRound=n,f.roundNumber=s),1===n&&(f.participantWon=r))}function Yg(e){const{withScheduleItems:t,scheduleAnalysis:n,withTeamMatchUps:r,participantMap:i,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:c,finishingPositionRange:u,finishingRound:d,matchUpStatus:p,stageSequence:l,roundNumber:m,structureId:f,score:h,stage:I,withRankingProfile:g,tieWinningSide:U,roundPosition:y,matchUpTieId:v,matchUpSides:S,collectionId:w,matchUpType:P,winningSide:T,matchUpId:D,schedule:R,eventId:b,drawId:N,sides:M}=e,A=a&&2===M?.length&&Object.assign({},...M.map((({sideNumber:e},t)=>{const n=M[1-t].participantId;return e&&{[e]:n}})).filter(Boolean));for(const E of M){const{participantId:e,sideNumber:M,bye:C}=E;if(C)continue;const O=T===M,F=e=>{const t=i[e]?.participant,n=t?.participantType,r=[{participantId:e,participantType:n}];if(n!==zu)for(const a of t?.individualParticipantIds||[]){const e=i[a]?.participant;r.push({participantType:e?.participantType,participantId:a})}return r},k=(e,r)=>{if(o){if(i[e].matchUps[D]={participantWon:O,matchUpType:P,structureId:f,sideNumber:M,matchUpId:D,eventId:b,drawId:N,stage:I},a){const t=F(r);i[e].matchUps[D].opponentParticipantInfo=t}w&&(i[e].matchUps[D].collectionId=w)}a&&r&&(i[e].opponents[r]={participantId:r,matchUpId:D,eventId:b,drawId:N}),g&&zg({finishingPositionRange:u,participantMap:i,participantWon:O,finishingRound:d,matchUpStatus:p,participantId:e,stageSequence:l,roundNumber:m,structureId:f,matchUpId:D,drawId:N,stage:I}),(n||t)&&Hg({participantMap:i,participantId:e,matchUpStatus:p,roundPosition:y,matchUpType:P,roundNumber:m,structureId:f,matchUpId:D,schedule:R,drawId:N,score:h})},x=({participant:e,partnerParticipantId:t})=>{const n=(e,t)=>{e&&(e.partnerParticipantIds||(e.partnerParticipantIds=[]),e.partnerParticipantIds.includes(t)||e.partnerParticipantIds.push(t))};c&&n(e?.draws?.[N],t),s&&n(e?.events?.[b],t),o&&n(e?.matchUps?.[D],t)};if(e&&i[e]){const t=A?.[M];k(e,t);const n=i[e]?.participant.participantType===Wu,a=i[e]?.participant.individualParticipantIds||[];if(v){if(r){const t=e=>i[e].matchUps[v]={participantWon:U===M,matchUpType:Yi.Team,matchUpId:v,sideNumber:M};t(e),a.forEach(t)}if(c&&!i[e].draws[N]){const t=S.find((e=>e.sideNumber===M))?.participant?.participantId,n=i[t]?.draws?.[N]?.entryStatus,r=e=>i[e].draws[N]={entryStatus:n,eventId:b,drawId:N};r(e),a.forEach(r)}}if(n&&(a.forEach((e=>i[e]&&k(e,t))),a.forEach(((e,t)=>{const n=a[1-t],r=i[e];r&&x({participant:r,partnerParticipantId:n})})),s&&S)){const t=S.find((e=>e.sideNumber===M))?.participant?.participantId;if(t){const n=i[t]?.events[b];n?(i[e].events[b]={...n},a.forEach((e=>i[e].events[b]={...n}))):console.log("Missing teamEntry",{eventId:b,teamParticipantId:t})}}if(T){const t=e=>{O?(i[e].counters[P].wins+=1,i[e].counters.wins+=1,p===Ra&&(i[e].counters[P].walkoverWins+=1,i[e].counters.walkoverWins+=1),p===ga&&(i[e].counters[P].defaultWins+=1,i[e].counters.defaultWins+=1)):(i[e].counters[P].losses+=1,i[e].counters.losses+=1,p===Ra&&(i[e].counters[P].walkovers+=1,i[e].counters.walkovers+=1),p===ga&&(i[e].counters[P].defaults+=1,i[e].counters.defaults+=1))};t(e),a.forEach(t)}}}}function Kg(e){const{withIndividualParticipants:t,participantFilters:n={},withPotentialMatchUps:r,withRankingProfile:i,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:c,scheduleAnalysis:u,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:l,usePublishState:m,contextProfile:f,withStatistics:h,withOpponents:I,withMatchUps:g,internalUse:U,withSeeding:y,withEvents:v,withDraws:S,withISO2:w,withIOC:T}=e;if(!c)return{error:$};(g||i)&&bh({tournamentRecord:c});let{participantMap:D}=Xf({convertExtensions:a,tournamentRecord:c,withSignInStatus:d,withScaleValues:l,internalUse:U,withISO2:w,withIOC:T});const R=function(e){const{participantFilters:t,convertExtensions:n,policyDefinitions:r,tournamentRecord:i,usePublishState:a,contextProfile:o,participantMap:s,withPotentialMatchUps:c,withRankingProfile:u,withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:l,withStatistics:m,withOpponents:f,withMatchUps:h,withSeeding:I,withEvents:g,withDraws:U}=e,y=t?.participantIds,v=e=>{const t=[e];return s[e]?.participant.individualParticipantIds?.forEach((e=>t.push(e))),t.some((e=>!y?.length||y.includes(e)))?t:[]},S={withMatchUps:h||u,withEvents:g||u,withDraws:U||u,withPotentialMatchUps:c,withRankingProfile:u,withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:l,withStatistics:m,participantMap:s,withOpponents:f,withSeeding:I},w=[],T={},D=[],R={},b={},N={},M=({eventType:e,scaleNames:t,participantId:n})=>s[n].participant?.rankings?.[e]?.find((e=>t.includes(e.scaleName)))?.scaleValue;for(const A of i?.events||[]){if(t?.eventIds&&!t.eventIds.includes(A.eventId))continue;const{drawDefinitions:e=[],extensions:y=[],eventType:w,eventName:E,category:C,entries:O,eventId:F,gender:k}=A,{flightProfile:x}=Ks({event:A}),_=x?.flights??[],L=qg({event:A}),B=L?.publishedSeeding;if(L&&(R[F]=L),g||I||u){const e=n?Object.assign({},...ai(y)):{};b[F]={...e,eventName:E,eventType:w,category:C,eventId:F,gender:k};const t=[C?.categoryName,C?.ageCategoryCode].filter(Boolean);for(const r of O){const{participantId:e}=r;if(!e||!s[e])continue;const i=M({eventType:w,scaleNames:t,participantId:e});let o,c;if(I){const t=s[e].participant;({seedAssignments:o,seedValue:c}=$g({publishedSeeding:B,usePublishState:a,withSeeding:I,participant:t,event:A}))}const u=e=>{if(s[e]?.events?.[F])return;const t=s[e];Wg({convertExtensions:n,seedAssignments:o,participant:t,withSeeding:I,seedValue:c,eventId:F,ranking:i,entry:r})};u(e),(s[e].participant.individualParticipantIds||[]).forEach(u)}}const V=R?.[F]?.publishedSeeding;if(U||u||I){const t=e=>e?Object.assign({},...e.map((({participantId:e,seedValue:t,seedNumber:n})=>({[e]:{seedValue:t,seedNumber:n}})))):void 0,n=P([...e.map(di("drawId")),..._.map(di("drawId"))]);for(const r of n){const n=e.find((e=>e.drawId===r)),i=_?.find((e=>e.drawId===r)),o=n?.entries||i?.drawEntries,{structures:c=[],drawOrder:d,drawName:p,drawType:l}=n??{},m=i?.flightNumber,f=[C?.categoryName,C?.ageCategoryCode].filter(Boolean),h=(n?.structures||[]).sort(((e,t)=>tp(e,t))).map((({structureId:e,structures:t})=>[e,...(t||[]).map((({structureId:e})=>e))])).flat(1/0);let y,v,S,P,T=0;const D=c.filter((({stage:e,stageSequence:t})=>e===nd&&1===t||e===rd)).flatMap((e=>{const{seedAssignments:t,stageSequence:n,stage:r}=e,{positionAssignments:i}=op({structure:e});return r===nd?(T=i?.length??0,S=i,P=t):1===n&&(y=i,v=t),i})).map((({participantId:e})=>e)).filter(Boolean),R=t(P),b=t(v),A=n?o.filter((({participantId:e})=>D.includes(e))):o,E=!a||V?.published&&(0===V?.drawIds?.length||V?.drawIds?.includes(r));for(const e of A){const{entryStatus:t,entryStage:n,entryPosition:i,participantId:a}=e,o=M({participantId:a,scaleNames:f,eventType:w}),c=e=>{if(s[e].draws?.[r])return;const c=I&&E,d=c?{}:void 0,p=c?R?.[a]?.seedValue||R?.[a]?.seedNumber:void 0,l=p?R?.[a]:void 0,m=c?b?.[a]?.seedValue||b?.[a]?.seedNumber:void 0,f=m?b?.[a]:void 0;d&&p&&(d[nd]=l),d&&m&&(d[rd]=f);const h=p||m;h&&(s[e].participant.seedings[w]||(s[e].participant.seedings[w]=[]),l&&s[e].participant.seedings[w].push({...l,scaleName:r}),f&&s[e].participant.seedings[w].push({...f,scaleName:r}),d&&(s[e].events[F].seedAssignments||(s[e].events[F].seedAssignments={}),Object.keys(d).forEach((t=>s[e].events[F].seedAssignments[t]=d[t])))),(g||u)&&s[e]&&F&&(s[e].events[F]||(s[e].events[F]={}),c?s[e].events[F].seedValue=h:s[e].events[F].seedValue&&(s[e].events[F].seedValue=void 0)),(U||u)&&(s[e].draws[r]=pi({seedAssignments:d,entryPosition:i,entryStatus:t,entryStage:n,eventId:F,ranking:o,drawId:r},!1,!1,!0))};if(![vp,Sp].includes(t)){c(a);const e=s[a].participant.individualParticipantIds||[];e?.forEach(c)}}const O=(n?.structures??[]).reduce(((e,t)=>(e.includes(t.stage)||e.push(t.stage),e)),[]),k=(n?.links??[]).length;N[r]={qualifyingPositionAssignments:y,qualifyingSeedAssignments:v,mainPositionAssignments:S,qualifyingSeedingMap:b,mainSeedAssignments:P,orderedStructureIds:h,mainSeedingMap:R,flightNumber:m,linksCount:k,drawOrder:d,drawName:p,drawType:l,drawSize:T,drawId:r,stages:O}}}if(u||p||l||m||f||h||U){const e=!!p||c,t=ah({afterRecoveryTimes:!!p,policyDefinitions:r,tournamentRecord:i,inContext:!0,contextProfile:o,participantMap:s,nextMatchUps:e,event:A})?.matchUps??[];for(const n of t){const{finishingPositionRange:t,potentialParticipants:r,tieMatchUps:a=[],sides:o=[],winningSide:c,matchUpType:u,matchUpId:l,eventId:m,drawId:f,collectionId:h,stageSequence:I,finishingRound:g,matchUpStatus:U,roundPosition:y,roundNumber:w,structureId:P,schedule:D,score:R,stage:b}=n;T[l]=n;const N={finishingPositionRange:t,finishingRound:g,stageSequence:I,roundPosition:y,collectionId:h,roundNumber:w,structureId:P,schedule:D,eventId:m,drawId:f,score:R,stage:b};Yg({...N,...S,matchUpStatus:U,winningSide:c,matchUpType:u,matchUpId:l,sides:o});for(const e of a){const{winningSide:t,sides:n=[],matchUpId:r,matchUpStatus:i,matchUpType:a}=e;Yg({...N,...S,winningSide:t,tieWinningSide:c,matchUpTieId:l,matchUpId:r,sides:n,matchUpSides:o,matchUpStatus:i,matchUpType:a})}if(Array.isArray(r)&&(e||p||d)){const e=r.flat().map(di("participantId")).filter(Boolean);e?.forEach((e=>{const t=v(e);t?.forEach((e=>{s[e]&&(s[e].potentialMatchUps[l]=pi({tournamentId:i?.tournamentId,matchUpId:l,eventId:m,drawId:f}))})),(p||d)&&Hg({potential:!0,participantMap:s,participantId:e,matchUpStatus:U,roundPosition:y,structureId:P,matchUpType:u,roundNumber:w,matchUpId:l,schedule:D,drawId:f,score:R})}))}}D.push(...t)}}if(m||u||p){const e=Object.values(s);for(const t of e){const{wins:e,losses:n,[_i]:{wins:r,losses:i},[Bi]:{wins:a,losses:o}}=t.counters,c=(e,n,r)=>{const i=n+r,a=n,o=i&&a/i;t.statistics[e]={denominator:i,numerator:a,statValue:o,statCode:e}};if(m&&(c(as,e,n),c(`${as}.${_i}`,r,i),c(`${as}.${Bi}`,a,o)),u){const e=(e=[])=>Math.abs(e[0]-e[1]);for(const n of Object.keys(t.draws)){const{orderedStructureIds:r=[],flightNumber:i}=N[n]||{};if(t.structureParticipation&&r.length){let a,o=0;const s=r.map((n=>{const r=t.structureParticipation[n];if(!r)return;a||(a=r?.finishingPositionRange),e(a)>e(r?.finishingPositionRange)&&(a=r?.finishingPositionRange);const s=r.stage!==rd;s&&(o+=1);const c=s?o:void 0;return pi({...r,participationOrder:c,flightNumber:i})})).filter(Boolean);t.draws[n]&&(t.draws[n].finishingPositionRange=a,t.draws[n].structureParticipation=s)}}}if(p){const e=ci(p)?p.scheduledMinutesDifference:0,n=t.scheduleItems||[],r=t.potentialMatchUps||{},i=n.reduce(((e,t)=>{const{scheduledDate:n,scheduledTime:r}=t;return e[n]||(e[n]=[]),r&&e[n].push(t),e}),{});Object.values(i).forEach((e=>e.sort(Kr)));for(const o of n){const{typeChangeTimeAfterRecovery:n,timeAfterRecovery:a,scheduledDate:s,scheduledTime:c}=o,u=i[s],d=Gr(c);for(const i of u){if(i.matchUpId===o.matchUpId||[Ra,ga].includes(i.matchUpStatus)&&!i.scoreHasValue)continue;const s=o.matchUpType!==i.matchUpType&&n||a,c=o.drawId===i.drawId,u=r[o.matchUpId]&&r[i.matchUpId],p=Gr(i.scheduledTime),l=Math.abs(p-d),m=p>=d;if((e&&!isNaN(e)?l<=e:m&&Gr(i.scheduledTime)<Gr(s))&&(!u||!c)&&m){const e=[o.matchUpId,i.matchUpId].sort().join("|");t.scheduleConflicts[e]={priorScheduledMatchUpId:o.matchUpId,matchUpIdWithConflict:i.matchUpId}}}}const a=t.participant.participantId;Object.keys(t.scheduleConflicts).length&&w.push(a),s[a].scheduleConflicts=t.scheduleConflicts}}}return{participantIdsWithConflicts:w,eventsPublishStatuses:R,derivedEventInfo:b,derivedDrawInfo:N,mappedMatchUps:T,participantMap:s,matchUps:D}}({withMatchUps:g??i,withEvents:v??i,withDraws:S??i,withPotentialMatchUps:r,participantFilters:n,withRankingProfile:i,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:c,scheduleAnalysis:u,withTeamMatchUps:p,usePublishState:m,withStatistics:h,participantMap:D,withOpponents:I,contextProfile:f,withSeeding:y}),{participantIdsWithConflicts:b,eventsPublishStatuses:N,derivedEventInfo:M,derivedDrawInfo:A,mappedMatchUps:E}=R,C=R.matchUps;D=R.participantMap;const O=u??r,F=({potentialMatchUps:e,scheduleConflicts:t,scheduleItems:n,participant:r,statistics:a,opponents:o,matchUps:c,events:d,draws:p})=>{const l=Object.values(p),m=Object.values(o);return I&&l?.forEach((e=>{e.opponents=m.filter((t=>t.drawId===e.drawId))})),pi({...r,scheduleConflicts:u?Object.values(t):void 0,draws:S||i?l:void 0,events:v||i?Object.values(d):void 0,matchUps:g||i?Object.values(c):void 0,opponents:I?m:void 0,potentialMatchUps:O?Object.values(e):void 0,statistics:h?Object.values(a):void 0,scheduleItems:s?n:void 0},!1,!1,!0)},k=new Map;for(const P of Object.keys(D))k.set(P,F(D[P]));const x=[...k.values()],_=o?.[ho],B=_?.participant,V=jg({participants:x,participantFilters:n,tournamentRecord:c});if(t){const e=ci(t)?t:void 0;for(const t of V)for(const n of t.individualParticipantIds??[]){t.individualParticipants||(t.individualParticipants=[]);const r=k.get(n);t.individualParticipants.push(e?mi({template:e,source:r}):r)}}return{participantIdsWithConflicts:b,eventsPublishStatuses:N,derivedEventInfo:M,derivedDrawInfo:A,mappedMatchUps:E,participantMap:D,participants:B?V.map((e=>mi({source:e,template:B}))):V,...L,matchUps:C}}function Qg(e,t,n){if(!e&&t)return t;if(e&&!t)return e;if("object"!=typeof e||"object"!=typeof t)return e;return P(Object.keys(e).concat(Object.keys(t))).reduce(((r,i)=>{if(t[i])if(e[i])if(typeof e[i]!=typeof t[i])r[i]=t[i];else if(Array.isArray(e[i]))if(!0===n||Array.isArray(n)&&n.includes(i)){const n=P(e[i].map((e=>JSON.stringify(e))).concat(t[i].map((e=>JSON.stringify(e))))).map((e=>JSON.parse(e)));r[i]=n}else r[i]=t[i];else"object"==typeof e[i]?r[i]=Qg(e[i],t[i],n):r[i]=t[i];else r[i]=t[i];else r[i]=e[i];return r}),{})}function Jg({tournamentRecords:e,policyDefinitions:t,contextProfile:n,participantId:r,personId:i}){if(!e)return{error:q};if("string"!=typeof r&&"string"!=typeof i)return{error:mt,stack:"publicFindParticipant"};let a,o;for(const s of Object.values(e)){o=s.tournamentId;if(a=Rs({tournamentParticipants:Kg({policyDefinitions:t,tournamentRecord:s}).participants??[],internalUse:!0,policyDefinitions:t,contextProfile:n,participantId:r,personId:i}),a)break}return{participant:a,tournamentId:o,...L}}function Xg({targetRoundNumber:e,finishingPosition:t,drawDefinition:n,structureId:r,linkType:i}){const{links:a}=Rl({drawDefinition:n,structureId:r})||{},o=(a?.target||[]).filter((({linkType:e})=>e===i)).filter((({target:t})=>!e||e===t.roundNumber)).map((e=>{const r=e.source.structureId,{structure:i}=rp({structureId:r,drawDefinition:n});if(!t||i?.finishingPosition===t)return e})).filter(Boolean);return{sourceStructureIds:o.map((({source:e})=>e.structureId)),relevantLinks:o}}function Zg({tournamentRecord:e,drawDefinition:t,event:n}){const r=e?.events||n&&[n],i=r?.map((e=>e?.drawDefinitions)).flat().filter(Boolean)||t&&[t]||[],a={},o={},s=i.map((e=>e?.structures?.filter((e=>e?.structures)))).flat().filter(Boolean);for(const c of s){const{structures:e,structureId:t}=c??{};e&&t&&(a[t]=e?.map((e=>e.structureId)))&&e.forEach((e=>o[e.structureId]=c?.structureId))}return{containedStructures:a,containerStructures:o}}function eU(e){const{drawDefinition:t,findContainer:n,structureId:r,event:i}=e;let a=e.structure;const{containedStructures:o}=Zg({drawDefinition:t}),s=r&&o[r]||[];if(!a){const e=rp({drawDefinition:t,structureId:r});if(e.error)return e;a=n&&e.containingStructure||e.structure}if(Hp({drawDefinition:t,structure:a}))return{structure:a,isAdHoc:!0,error:oe};const{matchUps:c}=Cl({inContext:!0,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:t,event:i}),u=c?.filter((e=>e.structureId===r||s.includes(e.structureId))),{matchUpDependencies:d}=bh({drawIds:[t.drawId],matchUps:c,drawDefinition:t}),p=[],m=[],f={},h=[];for(const l of c||[]){if(l.structureId===r||s.includes(l.structureId)){m.push(...l.drawPositions||[]);const e=l.roundNumber;for(const t of(l.drawPositions||[]).filter(Boolean))(!f[t]||e&&f[t]>e)&&(f[t]=e)}ml(l)&&(h.push(l),p.push(l.matchUpId,...d?.[l?.matchUpId]?.matchUpIds||[]))}const I=P(m.filter(Boolean)).sort(l),g=P(p),U=P(u?.map((({matchUpId:e,drawPositions:t})=>g.includes(e)?t:[])).flat().filter(Boolean)).sort(l),{positionAssignments:y}=op({drawDefinition:t,structure:a}),v=y?.filter((e=>e.bye)).map((e=>e.drawPosition)),S=y?.filter((e=>e.qualifier)).map((e=>e.drawPosition)),w=I?.filter((e=>!U.includes(e)))||[];return{allDrawPositions:I,inContextStructureMatchUps:u,drawPositionInitialRounds:f,activeDependentMatchUpIds:g,qualifyingDrawPositions:S,inactiveDrawPositions:w,positionAssignments:y,activeDrawPositions:U,byeDrawPositions:v,activeMatchUps:h,structure:a}}function tU({drawPosition:e,matchUps:t=[]}){return{initialRoundNumber:t.filter((({drawPositions:t})=>e&&t?.includes(e))).map((({roundNumber:e})=>e)).sort(l)[0]}}function nU(e){if(!e)return 1/0;if(S(e))return m(e);const t=e.split("-")[0];return S(t)?m(t):1/0}function rU({positioning:e,size:t}){const n=function({size:e}){const t=[e];let n=e;for(;n/2===Math.floor(n/2);)n/=2,t.push(n);return t.includes(1)||t.push(1),t.sort(l),t.reverse(),t}({size:t}),r=[],i=[],a=e=>e[0],o=(t,n)=>(e===md&&n%2?(e=>e[e.length-1])(t):a(t))||a(t),s=(e,t)=>{if(e.every((e=>!i.includes(e)))){const n=o(e,t);return i.push(n),n}},c=e=>{const t=e.filter((e=>!i.includes(e)));if(t.length)return i.push(...t),t},u=(e,t)=>{const n=o(e,t);if(!i.includes(n))return i.push(n),n},d=E(1,t+1);for(const p of n)if(1===p){const e=x(d,2),t=e.map(s).filter(Boolean);t.length&&r.push(t);const n=e.flatMap(c).filter(Boolean);n.length&&r.push(n)}else{const e=x(d,p).map(u).filter(Boolean);e.length&&r.push(e)}return{divisions:n,divisionGroupings:r}}function iU({provisionalPositioning:e,returnAllProxies:t,appliedPolicies:n,seedingProfile:r,drawDefinition:i,allPositions:a,structure:o}){let s=[];if(!o)return{error:be};const{matchUps:c,roundMatchUps:u}=Kp({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:e,structure:o}),{seedAssignments:d}=kp({provisionalPositioning:e,returnAllProxies:t,drawDefinition:i,structure:o}),{positionAssignments:p}=sp({structure:o}),l=p?.length,m=d?.length??0;let f=[];const h=Object.keys(u).map((e=>parseInt(e))).sort(((e,t)=>e-t)).map((e=>{const t=u[e].map((e=>e.drawPositions)).flat(1/0).filter(Boolean),n=t.filter((e=>!f.includes(e)));return f=f.concat(...t),n})).filter((e=>e.length)).reverse(),I=h.pop(),g=I&&Math.min(...I)-1||0;r=r??n?.seeding?.seedingProfile;const U=I?.length||0,y=h.filter((e=>e.filter((e=>e<=m)).length)),{stage:v,structureType:S,roundLimit:w}=o,P=S===Id,T=!P&&h?.length,D=!P&&v===rd&&w,R=y.flat(1/0),b=T?R?.length:0,N=a?l:m,M=Wp({drawDefinition:i,structure:o,matchUps:c}),A=M?0:!T&&N||N&&R.length<N&&N-R.length||0;if(D){const e=o?.matchUps?o.matchUps.filter((({roundNumber:e})=>e===o.roundLimit)).length:0,t=I.length/e;if(T);else{const e=cU(r),n=x(I,t);let i=1;const a=E(0,n[0].length).map((()=>{const e=E(i,i+n.length);return i+=n.length,e}));({validSeedBlocks:s}=aU({drawPositionBlocks:n,nonRandom:r?.nonRandom,positioning:e,seedGroups:a}))}}else if(P){const e=function({seedingProfile:e,structure:t,nonRandom:n}){const r=t.structures||[],i=r.length,a=op({structure:t})?.positionAssignments,o=cU(e),s=a?.length??0,{seedGroups:c}=$h({roundRobinGroupsCount:i,drawSize:s});return aU({drawPositionBlocks:r.map((e=>op({structure:e}).positionAssignments?.map((e=>e.drawPosition)))),positioning:o,seedGroups:c,nonRandom:n})}({nonRandom:r?.nonRandom,seedingProfile:r,structure:o});({validSeedBlocks:s}=e)}else if(T)s=y.map((e=>({seedNumbers:e,drawPositions:e})));else if(M){x(I,2).map(((e,t)=>({drawPositions:[e[0]],seedNumbers:[t+1]}))).forEach((e=>s.push(e)))}if(!P&&!M&&!D){const{blocks:e}=function(e){const{drawPositionOffset:t=0,roundRobinGroupsCount:n,seedNumberOffset:r=0,seedingProfile:i,seedCountGoal:a,baseDrawSize:o}=e;let s=1;const c=[],{seedBlocks:u}=qh({cluster:cU(i)===md,participantsCount:o,roundRobinGroupsCount:n});s=0;for(const p of u){if(s+1>a)break;const e=p.map((e=>e+t)),n=d(s+1,p.length).map((e=>+e+r));s+=p.length,c.push({drawPositions:e,seedNumbers:n})}return{blocks:c};function d(e,t){return Array.from(new Array(t),((t,n)=>n+e))}}({drawPositionOffset:g,seedNumberOffset:b,seedCountGoal:A,seedingProfile:r,baseDrawSize:U});e.forEach((e=>s.push(e)))}const C=s.flatMap((e=>e.drawPositions)).reduce(((e,t)=>I?.includes(t)&&e),!0);return M||T||P||C?{isLuckyStructure:M,validSeedBlocks:s,isContainer:P,isFeedIn:T}:{error:Se,validSeedBlocks:[],isContainer:P,isFeedIn:T}}function aU({drawPositionBlocks:e,positioning:t,seedGroups:n,nonRandom:r}){const i=[],{divisionGroupings:a}=rU({size:n.length,positioning:t}),o=[];return n.forEach(((n,s)=>{const c=function({blockPattern:e,index:t}){let n=0;for(const r of e){if(n===t)return r;let e=0;for(;e<r.length;){if(n===t)return r;n+=1,e++}}}({blockPattern:a,index:s});n.forEach(((n,a)=>{const u=s%2?e.length-a-1:a;let d=e[u].slice().filter(((e,t)=>c.includes(t+1)&&e));t!==fd?d=r?d:T(d):s%2&&d.reverse();const p=d.find((e=>!o.includes(e)));p&&(o.push(p),i.push({seedNumbers:[n],drawPositions:[p]}))}))})),{validSeedBlocks:i}}function oU({appliedPolicies:e,drawDefinition:t,seedBlockInfo:n,drawPosition:r,structureId:i,seedNumber:a}){const{structure:o}=rp({drawDefinition:t,structureId:i});e||(e=Xo({drawDefinition:t}).appliedPolicies);let s=n?.validSeedBlocks;if(!s&&o&&(s=iU({appliedPolicies:e,drawDefinition:t,structure:o})?.validSeedBlocks),e?.seeding?.validSeedPositions?.ignore)return!0;if(e?.seeding?.validSeedPositions?.strict){const e=s.find((e=>e.seedNumbers.includes(a)));return(e?.drawPositions||[]).includes(r)}return[].concat(...s.map((e=>e.drawPositions))).includes(r)}function sU(e){const{provisionalPositioning:t,drawDefinition:n,seedingProfile:r,seedBlockInfo:i,structureId:a,randomize:o}=e,{structure:s}=rp({drawDefinition:n,structureId:a}),{seedAssignments:c}=kp({returnAllProxies:e.returnAllProxies,provisionalPositioning:t,drawDefinition:n,structure:s}),{positionAssignments:u}=sp({structure:s}),d=u?.filter((e=>e.participantId??e.bye??e.qualifier)),p=d?.map((e=>e.drawPosition)).filter(Boolean),{appliedPolicies:l}=Xo({drawDefinition:n}),m=(i?.validSeedBlocks||s&&iU({returnAllProxies:e.returnAllProxies,provisionalPositioning:t,appliedPolicies:l,drawDefinition:n,seedingProfile:r,structure:s})?.validSeedBlocks||[]).filter((e=>e.drawPositions.filter((e=>!p?.includes(e))).length))[0],f=c?.map((e=>e.participantId)).filter(Boolean),h=u?.map((e=>e.participantId)).filter(Boolean),I=f?.filter((e=>h?.includes(e))),g=f?.filter((e=>!h?.includes(e))),U=c?.filter((e=>g?.includes(e.participantId))),y=c?.filter((e=>!e.participantId)),v=(U?.length&&U.length>0?U.length:y?.length??0)&&m?.drawPositions.filter((e=>!p?.includes(e)))||[],S=o?T(v):v,w=[],P=S.map((()=>{const e=function(e,t){const n=e.filter((e=>!t.includes(e.participantId))),r=Math.min(...n.map((e=>nU(e.seedValue)))),i=n.filter((e=>nU(e.seedValue)===r));return T(i).pop()}(U,w),t=e?.participantId;return t&&w.push(t),t})).filter(Boolean),D=c?.filter((e=>I?.includes(e.participantId))).map((e=>e.seedNumber)),R=(m?.seedNumbers||[]).filter((e=>!D?.includes(e))),b=c?.filter((e=>R.includes(e.seedNumber))).map((e=>e.participantId)),N=l?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:m,unplacedSeedParticipantIds:void 0===N||N?P:b,unplacedSeedNumbers:R,unfilledPositions:S,unplacedSeedAssignments:U}}function cU(e){return"string"==typeof e?e:"object"==typeof e?e.positioning:void 0}function uU(e,t){return e.bye||nU(e.seedValue)<nU(t.seedValue)||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function dU({onlyAssignedPositions:e=!0,possiblyDisablingAction:t,tournamentParticipants:n,inactiveDrawPositions:r,activeDrawPositions:i,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:c,isByePosition:u,drawPosition:d,structureId:p,structure:l,drawId:m,event:f}){if(i.includes(d))return{};const h=r?.filter((e=>e!==d&&!(u&&s.includes(e)))),I=a?.filter((t=>(t=>!e||t.participantId||t.qualifier||t.bye)(t)&&h?.includes(t.drawPosition)))||[],g=I.map((({drawPosition:e})=>e)),{matchUps:U}=Kp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:l,event:f}),y=U.filter((({drawPositions:e})=>k(e,g))),v=Object.assign({},...y.map((e=>e.sides?.filter((({sourceDrawPositionRange:e})=>e)).map((({drawPosition:e,sourceDrawPositionRange:t})=>({[e]:t}))))).flat()),S=I.map((e=>e.participantId)).filter(Boolean),w=(n||[]).filter((e=>S.includes(e.participantId))),P=Object.assign({},...w.map((e=>({[e.participantId]:e})))),T=I.map((e=>{const t=P?.[e.participantId],n=v[e.drawPosition];return pi({...e,participant:o?ii(t,!1,!0):void 0,sourceDrawPositionRange:n})}));if(T.length){return{validSwapAction:{payload:{drawId:m,structureId:p,drawPositions:[d]},willDisableLinks:t,method:Uf,type:Ff,availableAssignments:T}}}return{}}function pU(e){const{policyDefinitions:t,tournamentParticipants:n=[],returnParticipants:r=!0,provisionalPositioning:i,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:c}=e;if(!c)return{error:Ae};if(!o)return{error:Y};if(!e.structureId)return{error:Te};let u=rp({structureId:e.structureId,drawDefinition:o});if(u.error)return u;const d=u.containingStructure||u.structure;if(!d)return{error:De};const p=d.structureId;if(u=eU({drawDefinition:o,structureId:p}),void 0===s&&!u.isAdHoc)return{error:se};if(u.isAdHoc)return dg(e);if(u.error)return u;const{drawPositionInitialRounds:l,inactiveDrawPositions:m,activeDrawPositions:f,byeDrawPositions:h}=u,I=Xo({tournamentRecord:a,drawDefinition:o,structure:d,event:c}).appliedPolicies??{};Object.assign(I,t??{});const{actionsPolicy:g,enabledStructures:U,actionsDisabled:y}=GI({actionType:VI,appliedPolicies:I,drawDefinition:o,structure:d}),v=g?.activePositionOverrides||[],{sourceStructureIds:S}=Xg({finishingPosition:Jd,targetRoundNumber:1,linkType:Sd,drawDefinition:o,structureId:p})||{};let w;S?.length&&(w=S.reduce(((e,t)=>_I({structureId:t,drawDefinition:o})&&e),!0));const T=S.length,D=S.length&&!w,{policyActions:R}=$I({enabledStructures:U,drawDefinition:o,structure:d}),b=![rd,nd].includes(d.stage)||1!==d.stageSequence,{drawId:N}=o,M=[],{assignedPositions:A,positionAssignments:E}=sp({structure:d}),C=A?.find((e=>e.drawPosition===s)),O=E?.map((e=>e.drawPosition));if(!O?.includes(s))return{error:oe};const{stage:F,stageSequence:k}=d,x=[F];F===id&&x.push(nd),F===nd&&x.push(id);const _=Op({entryStatuses:Rp,provisionalPositioning:i,drawDefinition:o,stageSequence:k,structureId:p,stages:x}),L=Hh({drawDefinition:o,stages:x}).assignedParticipantIds??[],B=_.filter((e=>!L.includes(e.participantId))).map((e=>e.participantId)),V=h.includes(s),j=f.includes(s);if(y)return{info:"Actions Disabled for structure",isByePosition:V,isActiveDrawPosition:j,isDrawPosition:!0,hasPositionAssigned:!!C,validActions:[]};if(WI({policyActions:R,action:Af})&&!j&&E&&!D&&(!C||V)){const{validAssignmentActions:e}=function({positionSourceStructureIds:e,unassignedParticipantIds:t,possiblyDisablingAction:n,provisionalPositioning:r,tournamentParticipants:i,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:c,drawDefinition:u,seedingProfile:d,isByePosition:p,drawPosition:l,structureId:m,event:f}){const{drawId:h}=u,I=[];let g,U,y=[];const v=c?.[So]?.validSeedPositions?.ignore;if(!v){const e=sU({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:d,structureId:m,event:f});({unplacedSeedParticipantIds:g,unplacedSeedAssignments:U,unfilledPositions:y}=e)}if(y?.length||(y=o.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition))),p||I.push({payload:{drawId:h,structureId:m,drawPosition:l,isPositionAction:!0},willDisableLinks:n,method:Pf,type:Lf}),a&&v){const t=o.map((e=>e.participantId)).filter(Boolean),r={structureIds:e},{completedMatchUps:a}=Ol({inContext:!0,matchUpFilters:r,drawDefinition:u}),c=P((a??[]).filter((({matchUpType:e})=>f?.eventType!==_u||e===_u))?.map((({sides:e})=>e?.map(di("participantId")))).flat().filter((e=>e&&!t.includes(e)))),d=s?i?.filter((e=>c?.includes(e.participantId))).map((e=>ii(e,void 0,!0))):void 0;return d?.forEach((e=>{const t=(u.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),d?.length&&I.push(pi({payload:{drawId:h,structureId:m,drawPosition:l},willDisableLinks:n,method:Sf,type:Af,availableParticipantIds:c,participantsAvailable:d})),{validAssignmentActions:I}}if(y.includes(l)||p){let e;if(U?.length){const t=U.filter((e=>g?.includes(e.participantId)));t.sort(uU),e=t.map((e=>e.participantId))}else e=t;const r=s?i?.filter((t=>e.includes(t.participantId))).map((e=>ii(e,void 0,!0))):void 0;r?.length&&I.push(pi({payload:{drawId:h,structureId:m,drawPosition:l},willDisableLinks:n,method:Sf,type:Af,availableParticipantIds:e,participantsAvailable:r}))}return{validAssignmentActions:I}}({positionSourceStructureIds:S,unassignedParticipantIds:B,possiblyDisablingAction:b,isWinRatioFedStructure:T,tournamentParticipants:n,positionAssignments:E,returnParticipants:r,appliedPolicies:I,drawDefinition:o,isByePosition:V,drawPosition:s,structureId:p,event:c});e?.forEach((e=>M.push(e)))}if(WI({policyActions:R,action:bf})){const{validAssignmentActions:e}=function({drawPositionInitialRounds:e,tournamentParticipants:t,positionAssignments:n,returnParticipants:r,appliedPolicies:i,drawDefinition:a,drawPosition:o,structureId:s,drawId:c}){const u=[],d=[],p=[],l=[],m=n.map((e=>e.participantId)).filter(Boolean),f=i?.[po],h=!f?.disableRoundRestrictions&&e[o],I=f?.requireCompletedStructures,{sourceStructureIds:g,relevantLinks:U}=Xg({targetRoundNumber:h,linkType:wd,drawDefinition:a,structureId:s})||{};g?.length&&l.push(...g);const{sourceStructureIds:y,relevantLinks:v}=Xg({targetRoundNumber:h,linkType:Sd,drawDefinition:a,structureId:s})||{};y?.length&&l.push(...y);for(const S of U){const e=a.structures?.find((e=>e.structureId===S.source.structureId));if(e?.stage!==rd)continue;const n=_I({structureId:S.source.structureId,drawDefinition:a});if(!I||n){const n=e.qualifyingRoundNumber,{matchUps:i}=Kp({matchUpFilters:{roundNumbers:[n],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:t,inContext:!0,structure:e});for(const e of i){const t=e.sides.find((t=>t?.sideNumber===e.winningSide)),n=e.matchUpStatus===ma&&e.sides?.find((({participantId:e})=>e));if(t||n){const{participantId:e,participant:i}=t||n||{};e&&!m.includes(e)&&(i&&r&&u.push(i),d.push(e))}}}}for(const S of v){const e=a.structures?.find((e=>e.structureId===S.source.structureId));if(e?.stage!==rd)continue;const n=_I({structureId:S.source.structureId,drawDefinition:a});if(!I||n){const{positionAssignments:n}=op({structure:e}),i=n?.map((e=>{const t=e.participantId,n=Ms({element:e,name:Yo}).extension?.value;return n?{participantId:t,groupOrder:n?.groupOrder}:{}})).filter((({groupOrder:e,participantId:t})=>1===e&&!m.includes(t))).map((({participantId:e})=>e))??[];if(i&&d.push(...i),r){const e=t.filter((({participantId:e})=>i.includes(e)));u.push(...e)}}}return d.length&&p.push(pi({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:c},method:mf,type:bf,qualifyingParticipantIds:d,qualifyingParticipants:r?u:void 0})),{validAssignmentActions:p,sourceStructureIds:l}}({drawPositionInitialRounds:l,tournamentParticipants:n,positionAssignments:E,returnParticipants:r,appliedPolicies:I,drawDefinition:o,drawPosition:s,structureId:p,drawId:N});e?.forEach((e=>M.push(e)))}const{participantId:G}=C||{},q=G&&n.find((e=>e.participantId===G));if(C){WI({policyActions:R,action:Ef})&&!j&&(M.push({type:Ef,method:gf,payload:{drawId:N,structureId:p,drawPosition:s},willDisableLinks:b}),V||M.push({type:Mf,method:ff,payload:{drawId:N,structureId:p,drawPosition:s},willDisableLinks:b}),WI({policyActions:R,action:Lf})&&!V&&M.push({type:Lf,method:gf,payload:{drawId:N,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:b}));const e=d.stage===rd||d.stage===nd&&1===d.stageSequence;if(!V&&qI({activePositionOverrides:v,activeDrawPositions:f,action:xf})&&WI({policyActions:R,action:xf})&&oU({drawDefinition:o,structureId:p,drawPosition:s})&&e){const{seedAssignments:e}=kp({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:t,seedValue:n}=e?.find((e=>e.participantId===G))??{};M.push({type:xf,method:Tf,participant:q,seedNumber:t,payload:{drawId:N,structureId:p,participantId:G,seedValue:n}})}if(!V&&qI({activePositionOverrides:v,activeDrawPositions:f,action:Of})&&WI({policyActions:R,action:Of})&&oU({drawDefinition:o,structureId:p,drawPosition:s})&&e){const{seedAssignments:e}=kp({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:t}=e?.find((e=>e.participantId===G))??{};M.push({method:wf,type:Of,participant:q,seedNumber:t,payload:{participantId:G,structureId:p,drawId:N}})}if(!V&&G){if(WI({policyActions:R,action:_f})){const e={type:_f,method:Df,participant:q,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};M.push(e)}if(WI({policyActions:R,action:kf})){const e={type:kf,method:vf,participant:q,payload:{participantId:G,otherName:void 0}};M.push(e)}}if(WI({policyActions:R,action:Ff})){const{validSwapAction:e}=dU({possiblyDisablingAction:b,tournamentParticipants:n,inactiveDrawPositions:m,activeDrawPositions:f,positionAssignments:E,returnParticipants:r,byeDrawPositions:h,drawDefinition:o,isByePosition:V,drawPosition:s,structureId:p,structure:d,drawId:N});e&&M.push(e)}}if(WI({policyActions:R,action:Nf})&&!D){const{validAlternatesAction:e}=function({tournamentParticipants:e=[],possiblyDisablingAction:t,activeDrawPositions:n,positionAssignments:r,returnParticipants:i,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:c,structureId:u,structure:d,drawId:p,event:l}){if(n.includes(s))return{};const m=c.find((e=>e.type===Af))?.availableParticipantIds,f=a?.[po]?.otherFlightEntries,h=a?.[po]?.restrictQualifyingAlternates,I=(o.entries??[]).filter((({entryStage:e})=>!h||(d.stage===rd?e===rd:e!==rd))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((({participantId:e})=>e)).filter(Boolean),{allPositionedParticipantIds:g}=ap({drawDefinition:o}),U=r.map((e=>e.participantId)).filter(Boolean),y=I.filter((e=>d.stage&&[rd,nd,od].includes(d.stage)?!g?.includes(e):!U.includes(e))),v=(l?.entries??[]).filter((e=>e.entryStatus===dp&&OI({restrictQualifyingAlternates:h,structure:d,entry:e})&&(d.stage&&[rd,nd,od].includes(d.stage)?!g?.includes(e.participantId):!U.includes(e.participantId)))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((e=>e.participantId));let S=P(y.concat(v));if(f){const e=l?Ks({event:l}).flightProfile:void 0,t=e?.flights?.filter((e=>e.drawId!==p)).map((e=>e.drawEntries.filter((e=>e.participantId&&![Pp,vp,Sp].includes(e.entryStatus)&&!I.includes(e.participantId))).map((({participantId:e})=>e)))).flat().filter(Boolean);t?.length&&S.push(...t)}m?.length&&(S=S.filter((e=>!m.includes(e))));const w=i?e?.filter((e=>S.includes(e.participantId))):void 0;if(w?.forEach((e=>{const t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),w?.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),S.length)return{validAlternatesAction:pi({payload:{drawId:p,structureId:u,drawPosition:s},willDisableLinks:t,method:hf,availableAlternatesParticipantIds:S,type:Nf,availableAlternates:w})};return{}}({possiblyDisablingAction:b,tournamentParticipants:n,positionAssignments:E,activeDrawPositions:f,returnParticipants:r,appliedPolicies:I,drawDefinition:o,drawPosition:s,validActions:M,structureId:p,structure:d,drawId:N,event:c});e&&M.push(e)}if(WI({policyActions:R,action:Cf})&&!D&&E){const{validLuckyLosersAction:e}=function({tournamentParticipants:e=[],sourceStructuresComplete:t,possiblyDisablingAction:n,isWinRatioFedStructure:r,activeDrawPositions:i,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:c,structure:u,drawId:d,event:p}){if(i.includes(s)||r&&!t)return{};const{sourceStructureIds:l,targetStructureIds:m}=o.links?.reduce(((e,t)=>{const n=t.source?.structureId,r=t.target?.structureId;return e.sourceStructureIds.includes(n)||e.sourceStructureIds.push(n),e.targetStructureIds.includes(r)||e.targetStructureIds.push(r),e}),{sourceStructureIds:[],targetStructureIds:[]})||{},f=[],h=o.links?.filter((e=>e.target?.structureId===u.structureId))||[];for(const g of h){const e=g?.source?.structureId,{structure:t}=rp({structureId:e,drawDefinition:o}),n={};if(t?.finishingPosition===Xd&&(1!==l?.length||1!==m?.length)){const{matchUps:e}=Kp({drawDefinition:o,structure:u,event:p}),{initialRoundNumber:t}=tU({drawPosition:s,matchUps:e}),r=o.links?.find((e=>e.target?.structureId===u?.structureId&&e.target.roundNumber===t)),i=r?.source?.roundNumber;n.roundNumbers=[i]}const{completedMatchUps:r}=El({structureId:e,inContext:!0,matchUpFilters:n,drawDefinition:o}),i=a.map((e=>e.participantId)).filter(Boolean),c=r?.filter((({matchUpType:e,winningSide:t})=>t&&(p?.eventType!==_u||e===_u))).map((({winningSide:e,sides:t})=>e&&t?.[1-(e-1)])).map(di("participantId")).filter((e=>e&&!i.includes(e)));c?.forEach((e=>{f.includes(e)||f.push(e)}))}const I=e?.filter((e=>f?.includes(e.participantId)));if(I?.forEach((e=>{const t=(o.entries||[]).find((t=>t.participantId===e.participantId));e.entryPosition=t?.entryPosition})),f?.length)return{validLuckyLosersAction:{type:Cf,method:If,availableLuckyLosers:I,availableLuckyLoserParticipantIds:f,willDisableLinks:n,payload:{drawId:d,structureId:c,drawPosition:s}}};return{}}({sourceStructuresComplete:w,possiblyDisablingAction:b,isWinRatioFedStructure:T,tournamentParticipants:n,activeDrawPositions:f,positionAssignments:E,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:N});e&&M.push(e)}if(q?.participantType===Wu&&WI({policyActions:R,action:Rf})){const{validModifyAssignedPairAction:e}=function({tournamentParticipants:e,returnParticipants:t,drawPosition:n,participant:r,drawId:i,event:a}){const o=a?.entries?.filter((({entryStatus:e})=>[vp,Sp].includes(e))).map((({participantId:e})=>e))||[];if(o.length){const a=r.individualParticipantIds,s=t?e.filter((({participantId:e})=>o.includes(e))):void 0,c=t?e.filter((({participantId:e})=>a.includes(e))):void 0;return{validModifyAssignedPairAction:pi({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:n,drawId:i},method:yf,availableIndividualParticipantIds:o,availableIndividualParticipants:s,existingIndividualParticipantIds:a,existingIndividualParticipants:c,type:Rf},!1,!1,!0)}}return{}}({tournamentParticipants:n,returnParticipants:r,drawPosition:s,participant:q,drawId:N,event:c});e&&M.push(e)}return{hasPositionAssigned:!!C,isActiveDrawPosition:j,isDrawPosition:!0,isByePosition:V,validActions:M}}function lU({drawDefinition:e}){const t=e.structures||[],n=e.links||[],r=new Map,i=e=>{const n=r.get(e)||r.set(e,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(e);if(n&&!n?.stage){const r=t.find((t=>t.structureId===e));n.stage=r?.stage}return n},a={},o={};let s=n.map((e=>{const t=e.source.structureId,n=e.target.structureId,r=i(t),s=i(n);return[vd,yd,Ud,fd].includes(e.target.feedProfile)?(r?.targets.push(n),s?.sources.push(t)):e.target.feedProfile===gd&&(s?.drawSources.push(t),r?.drawTargets.push(n)),o[n]=o[n]||e.target.feedProfile===gd,a[n]=P([...a[n]||[],t]).filter(Boolean),[e.source.structureId,e.target.structureId]}));for(const h of r.keys()){const e=r.get(h);if(e){const t=e.targets??[];for(;t.length;){const n=t.pop(),i=n&&r[n];i?.targets?.length?t.push(...i.targets):i&&(e.rootStage=i.stage)}if(e.rootStage||(e.rootStage=e.stage),!e.targets?.length){const t=e.sources??[];for(;t.length;){const n=t.pop(),i=n&&r[n];if(i?.sources?.length){for(const t of i.sources)e.progeny?.includes(t)||e.progeny?.push(t);t.push(...i.sources)}}}}}let c=0;for(const h of r.keys()){const e=r.get(h);if(e&&e.rootStage===rd){const t=[e.drawTargets?.[0]];let n=0;for(;t.length;){n+=1;const e=t.pop(),i=e?r.get(e):void 0;i?.drawTargets?.length&&t.push(i.drawTargets[0])}e.distanceFromMain=n,n>c&&(c=n)}}const u=s.length;E(0,Math.ceil(u/2)).forEach((()=>{s=E(0,u).map((e=>{const t=s[e],n=s.reduce(((e,n)=>k(t,n)?e.concat(...n):e),[])||[];return P(t.concat(...n))}))}));const d=s[0],p=s.slice(1).reduce(((e,t)=>{return e&&O(n=t,d).length===n.length;var n}),!0),l=[d].filter(Boolean),m=[d].filter(Boolean);t.forEach((e=>{const{structureId:t,stage:n}=e;l.find((e=>e.includes(t)))||(l.push([t]),n!==ad&&m.push([t]))}));const f=p&&1===m.length;return n?.length||1!==t.length||i(t[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:f,maxQualifyingDepth:c,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:l}}function mU(e){const{tournamentParticipants:t=[],includePositionAssignments:n,policyDefinitions:r,tournamentRecord:i,inContext:a=!0,drawDefinition:o,noDeepCopy:s,sortConfig:c,context:u,event:d}=e;if(!o)return{error:Y};const p=(({matchUpFormat:e,updatedAt:t,drawType:n,drawName:r,drawId:i})=>({matchUpFormat:e,updatedAt:t,drawName:r,drawType:n,drawId:i}))(o);let l,m;const{allStructuresLinked:f,sourceStructureIds:h,hasDrawFeedProfile:I,structureGroups:g}=lU({drawDefinition:o});if(!f)return{error:Ne};let U=!1,y=!1;const v=g.map((e=>{const s={},f=e.map((e=>{const{structure:t}=rp({drawDefinition:o,structureId:e}),{seedAssignments:n}=kp({drawDefinition:o,structure:t});return t?.stage===nd&&1===t.stageSequence&&(l=n),t?.stage===rd&&1===t.stageSequence&&(m=n),t})).sort(((e,t)=>tp(e,t,c))).map((e=>{if(!e)return;const n=e?.structureId;let c=[];e.stage&&[$i.Main,$i.Consolation,$i.PlayOff].includes(e.stage)&&(c=l),e?.stage===rd&&(c=m);const{matchUps:f,roundMatchUps:g,roundProfile:v}=Kp({seedAssignments:e?.seedAssignments?.length?void 0:c,context:{drawId:p.drawId,...u},tournamentParticipants:t,policyDefinitions:r,tournamentRecord:i,drawDefinition:o,inContext:a,structure:e,event:d}),{positionAssignments:S}=op({structure:e}),w=S?.filter(hl).map((e=>{y=!0;const{drawPosition:t,participantId:n}=e,{extension:r}=Ms({element:e,name:Yo});return r&&{drawPosition:t,participantId:n,participantResult:r.value}})).filter((e=>e?.participantResult)),P=e?(({stageSequence:e,structureName:t,structureType:n,matchUpFormat:r,stage:i})=>({stageSequence:e,structureName:t,structureType:n,matchUpFormat:r,stage:i}))(e):{};P.sourceStructureIds=h[n],P.hasDrawFeedProfile=I[n],P.positionAssignments=S,P.structureActive=f.reduce(((e,t)=>{const n=[ha,fa,ga,Pa,Ra,va,Ua,ya].includes(t.matchUpStatus);return e||n||!!t.winningSide||!!t.score?.scoreStringSide1}),!1);const T=f.reduce(((e,t)=>e&&[ma,ha,Pa,Ra,ga,pa].includes(t.matchUpStatus)),!!f.length);return P.structureCompleted=T,s[n]=T,P.structureActive&&(U=!0),{...P,participantResults:w,seedAssignments:c,roundMatchUps:g,roundProfile:v,structureId:n}}));return f.forEach((e=>{n||delete e.positionAssignments,e.sourceStructuresComplete=e.sourceStructureIds?.every((e=>s[e]))})),f})).flat();return p.drawActive=U,p.participantPlacements=y,p.drawGenerated=v?.reduce(((e,t)=>e||!!t?.roundMatchUps),!1),p.drawCompleted=v?.reduce(((e,t)=>e&&t.structureCompleted),!0),{structures:s?v:ii(v,!1,!0),drawInfo:s?p:ii(p,!1,!0),...L}}function fU(e){const{includePositionAssignments:t,tournamentRecord:n,participantsProfile:r,policyDefinitions:i,usePublishState:a,status:o=yu,sortConfig:s,event:c}=e,u=ii(n,!1,!0),d=ii(c,!1,!0);if(!u)return{error:$};if(!d)return{error:Ae};const{eventId:p}=d,{tournamentId:l,endDate:m}=u,{timeItem:f}=Yf({itemType:`${Uu}.${vu}`,event:d}),h=f?.itemValue?.[o],{participants:I}=Kg({withGroupings:!0,withEvents:!1,withDraws:!1,...r,tournamentRecord:u}),g=({stage:e})=>!a||!h?.stages?.length||h.stages.includes(e),U=({structureId:e})=>!a||!h?.structureIds?.length||h.structureIds.includes(e),y=(d.drawDefinitions||[]).filter((({drawId:e})=>!a||!h?.drawIds?.length||h.drawIds.includes(e))).map((e=>(({drawInfo:e,structures:t})=>({...e,structures:t}))(mU({context:{eventId:p,tournamentId:l,endDate:m},includePositionAssignments:t,tournamentParticipants:I,noDeepCopy:!0,policyDefinitions:i,tournamentRecord:u,drawDefinition:e,sortConfig:s,event:d})))).map((({structures:e,...t})=>({...t,structures:e?.filter(U)?.filter(g)}))).filter((e=>e.structures?.length)),{tournamentInfo:v}=Ig({tournamentRecord:u}),S={tournamentInfo:v,venuesData:(u.venues||[]).map((e=>(({venueData:e})=>({...e}))(zc({tournamentRecord:u,venueId:e.venueId})))),eventInfo:(({eventId:e,eventName:t,eventType:n,eventLevel:r,surfaceCategory:i,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:p})=>({eventId:e,eventName:t,eventType:n,eventLevel:r,surfaceCategory:i,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:p}))(d),drawsData:y};return S.eventInfo.publish={createdAt:f?.createdAt,state:f?.itemValue},{...L,eventData:S}}const{FACTORY:hU}=Qo;function IU({tournamentRecord:e,value:t}){const{extension:n}=lc({element:e,name:hU});Js({element:e,extension:{name:hU,value:{...n?.value,...t}}})}function gU(e){const{mutationStatus:t,tournamentId:n,directives:r,timeStamp:i}=e||{},{topics:a}=hr();for(const o of[...a].sort(yU)){const e=lr({topic:o});e&&Ir({topic:o,notices:e})}t&&i&&a.includes(Oc)&&Ir({notices:[{tournamentId:n,directives:r,timeStamp:i}],topic:Oc})}const UU={[Lc]:5,[_c]:5,[Bc]:5,[Ac]:5,[Mc]:5,[Tc]:5,[Dc]:5,[Rc]:5,[bc]:1,[Vc]:1,[Nc]:5,[Cc]:5,[Pc]:4,[vc]:4,[Sc]:4,[wc]:4,[hc]:3,[fc]:2};function yU(e,t){return(UU[t]||0)-(UU[e]||0)}function vU({duplicateValues:e=!0,creationTime:t=!0,removePriorValues:n,timeItem:r,element:i}){if(!r)return{error:wn};if(!i)return{error:mt,info:Xs};const a=r&&Object.keys(r),o=["itemType","itemValue"];if(!(o.filter((e=>a.includes(e))).length===o.length))return{error:vn};if(i.timeItems){const{itemType:t,itemSubTypes:n,itemValue:a}=r,{timeItem:o}=zf({itemSubTypes:n,itemType:t,element:i});if(JSON.stringify(o?.itemValue)===JSON.stringify(a)&&!e)return{...L}}else i.timeItems=[];if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,t){const e=(new Date).toISOString();Object.assign(r,{createdAt:e})}n&&(i.timeItems=i.timeItems.filter((({itemType:e})=>r.itemType!==e)));return n&&!r.itemValue||i.timeItems.push(r),{...L}}function SU({creationTime:e=!0,removePriorValues:t,tournamentRecord:n,duplicateValues:r,participantId:i,timeItem:a}){if(!n)return{error:$};if(!i)return{error:Lt};const o=bs({tournamentRecord:n,participantId:i});return o.error?o:vU({element:o.participant,removePriorValues:t,duplicateValues:r,creationTime:e,timeItem:a})}function wU(e){const{removePriorValues:t,tournamentRecord:n,duplicateValues:r,creationTime:i,timeItem:a}=e;return n?vU({element:n,removePriorValues:t,duplicateValues:r,creationTime:i,timeItem:a}):{error:$}}function PU(e){const{removePriorValues:t,duplicateValues:n,creationTime:r,timeItem:i,event:a}=e;return a?vU({removePriorValues:t,duplicateValues:n,element:a,creationTime:r,timeItem:i}):{error:Ee}}function TU({removePriorValues:e,tournamentRecord:t,duplicateValues:n,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:o,event:s}){const{matchUp:c}=Qp({drawDefinition:r,event:s,matchUpId:a});if(!c)return{error:Xe};const u=vU({removePriorValues:e,element:c,duplicateValues:n,timeItem:o});return i||rl({tournamentId:t?.tournamentId,eventId:s?.eventId,context:"addTimeItem",drawDefinition:r,matchUp:c}),u}function DU({removePriorValues:e,tournamentRecords:t,tournamentRecord:n,drawDefinition:r,disableNotice:i,courtDayDate:a,matchUpId:o,courtIds:s}){if(!n&&!t)return{error:$};if(!o)return{error:Qe};const c=Qp({drawDefinition:r,matchUpId:o});if(c.error)return c;if(c?.matchUp?.matchUpType!==Vi)return{error:tt};if(!(void 0===s||Array.isArray(s)&&s.length&&s.every((e=>"string"==typeof e))))return{error:xn,context:{courtIds:s}};let u;if(s){const e=lg({tournamentRecords:t?n:n&&{[n.tournamentId]:n}});if(e.error)return e;const r=e.courts?.filter((e=>s.includes(e.courtId)));if(r?.length!==s.length)return{error:xn,context:{courtIds:s}};u=r?.map((e=>({venueId:e.venueId,courtId:e.courtId})))}return TU({duplicateValues:!1,removePriorValues:e,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:o,timeItem:{itemType:Jc,itemDate:a,itemValue:u}})}function RU({removePriorValues:e,tournamentRecords:t,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:a,venueId:o}){if(!n)return{error:$};if(!a)return{error:Qe};if(o){const e=$c({tournamentRecords:t,tournamentRecord:n,venueId:o});if(e.error)return e}return TU({duplicateValues:!1,removePriorValues:e,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemType:Qc,itemValue:o}})}function bU({removePriorValues:e,tournamentRecords:t,tournamentRecord:n,drawDefinition:r,disableNotice:i,courtDayDate:a,matchUpId:o,courtId:s}){if(!n&&!t)return{error:$};if(!o)return{error:Qe};if(s){const e=Wc({tournamentRecords:t,tournamentRecord:n,courtId:s});if(e.error)return e;const a=e.venue?.venueId;RU({tournamentRecords:t,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:o,venueId:a})}return TU({duplicateValues:!1,removePriorValues:e,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:o,timeItem:{itemType:Xc,itemDate:a,itemValue:s}})}function NU(e){const t="addMatchUpScheduledTime";let n=e.matchUp;const{removePriorValues:r,tournamentRecord:i,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:c}=e;if(!c)return Mi({result:{error:Qe},stack:t});if(!Cr(s))return Mi({result:{error:vt},stack:t});if(!n){const e=Qp({drawDefinition:a,matchUpId:c});if(e.error)return Mi({result:e,stack:t});n=e.matchUp}const u=Wr(s),d=Du({matchUp:n}).scheduledDate,p=u&&!d,l=Mu({matchUp:n}).timeModifiers||[];if(l?.length){const e=MU({disableNotice:!0,removePriorValues:r,tournamentRecord:i,timeModifiers:[],drawDefinition:a,matchUpId:c,matchUp:n});if(e?.error)return Mi({result:e,stack:t})}const m=Yr(s,!0,p);return TU({duplicateValues:!1,removePriorValues:r,tournamentRecord:i,drawDefinition:a,disableNotice:o,matchUpId:c,timeItem:{itemType:nu,itemValue:m}})}function MU({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,timeModifiers:i,matchUpId:a,matchUp:o}){const s="addMatchUpTimeModifiers";if(!a)return Mi({result:{error:Qe},stack:s});if(void 0!==i&&!Array.isArray(i))return Mi({info:sa("timeModifiers"),result:{error:xn},stack:s});if(!o){const e=Qp({drawDefinition:n,matchUpId:a});if(e.error)return Mi({result:e,stack:s});o=e.matchUp}let c=Mu({matchUp:o}).timeModifiers||[];const u=i.filter((e=>!c.includes(e)));if(i.length&&!u.length)return{...L};if(u.some((e=>mu.includes(e)))){c=c.filter((e=>!mu.includes(e)));const r=NU({disableNotice:!0,removePriorValues:e,scheduledTime:"",tournamentRecord:t,drawDefinition:n,matchUpId:a});if(r.error)return Mi({result:r,stack:s})}const d=i?.length?[...u,...c]:void 0;return TU({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:su,itemValue:d}})}function AU(e,t){const n=br.test(e)?e:$r(e),r=Wr(e)||Wr(t)||kr(new Date);return new Date(`${r}T${n}`).getTime()}function EU({errorOnAnachronism:e=!1,checkChronology:t=!0,matchUpDependencies:n,inContextMatchUps:r,removePriorValues:i,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,disableNotice:c,drawMatchUps:u,matchUpId:d,schedule:p,event:l}){if(!p)return{error:mt,info:"Missing schedule"};if(!s)return{error:Y};if(!d)return{error:Qe};const m="drawEngine.addMatchUpScheduleItems";let f,h;if(u)f=u.find((e=>e.matchUpId===d));else{const e=Qp({drawDefinition:s,event:l,matchUpId:d});if(e.error)return e;f=e.matchUp}const{endTime:I,courtId:g,courtIds:U,courtOrder:y,resumeTime:v,scheduledDate:w,scheduledTime:P,startTime:T,stopTime:D,timeModifiers:R,venueId:b}=p;!t||n&&r||({matchUpDependencies:n,matchUps:r}=bh({drawDefinition:s}));const N=n?.[d]?.matchUpIds;if(p.scheduledDate&&t&&N){const t=r?.filter((e=>(e.schedule?.scheduledDate||Wr(e.schedule?.scheduledTime))&&N.includes(e.matchUpId))).map((({schedule:e})=>{const t=Ar(e);return new Date(t).getTime()}));if(t?.length){const n=Ar(p),r=new Date(n).getTime();if(Math.max(...t)>=r){if(e)return Mi({result:{error:V},stack:m});h=V}}}if(void 0!==w){const e=CU({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,scheduledDate:w,matchUpId:d});if(e?.error)return Mi({result:e,stack:m,context:{scheduledDate:w}})}if(void 0!==P){const e=NU({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,scheduledTime:P,matchUpId:d,matchUp:f});if(e?.error)return Mi({result:e,stack:m,context:{scheduledTime:P}})}if(void 0!==T){const e=kU({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,matchUpId:d,startTime:T,event:l});if(e?.error)return Mi({result:e,stack:m,context:{startTime:T}})}if(void 0!==D){const e=_U({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,matchUpId:d,stopTime:D,event:l});if(e?.error)return Mi({result:e,stack:m,context:{stopTime:D}})}if(void 0!==v){const e=LU({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,resumeTime:v,matchUpId:d,event:l});if(e?.error)return Mi({result:e,stack:m,context:{resumeTime:v}})}if(void 0!==I){const e=xU({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,matchUpId:d,endTime:I,event:l});if(e?.error)return Mi({result:e,stack:m,context:{endTime:I}})}if(void 0!==U){const e=DU({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,matchUpId:d,courtIds:U});if(e?.error)return Mi({result:e,stack:m,context:{courtIds:U}})}if(void 0!==g&&void 0!==w){const e=bU({courtDayDate:w,disableNotice:!0,removePriorValues:i,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:d,courtId:g});if(e?.error)return Mi({result:e,stack:m,context:{courtId:g}})}if(void 0!==b){const e=RU({disableNotice:!0,removePriorValues:i,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:d,venueId:b});if(e?.error)return Mi({result:e,stack:m,context:{venueId:b}})}if(void 0!==y&&S(y)){const e=OU({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,courtOrder:y,matchUpId:d});if(e?.error)return Mi({result:e,stack:m,context:{courtOrder:y}})}if(void 0!==R){const e=MU({disableNotice:!0,removePriorValues:i,tournamentRecord:o,drawDefinition:s,timeModifiers:R,matchUpId:d,matchUp:f});if(e?.error)return Mi({result:e,stack:m,context:{timeModifiers:R}})}return c||rl({tournamentId:o?.tournamentId,eventId:l?.eventId,context:m,drawDefinition:s,matchUp:f}),h?{...L,warnings:[h]}:{...L}}function CU({scheduledDate:e,removePriorValues:t,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:a}){if(!a)return{error:Qe};const o=e&&Nr.test(e);if(e&&!o)return{error:yt};return TU({duplicateValues:!1,removePriorValues:t,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemValue:Wr(e),itemType:eu}})}function OU({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,courtOrder:i,matchUpId:a}){if(!a)return{error:Qe};if(i&&!S(i))return{error:xn,info:"courtOrder must be numeric"};const o=i&&m(i);return TU({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Zc,itemValue:o}})}function FU({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,participantId:i,officialType:a,matchUpId:o}){if(!o)return{error:Qe};const s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:i};return a&&(s.itemSubTypes=[a]),TU({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:s})}function kU({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,matchUpId:i,startTime:a,event:o}){if(!i)return{error:Qe};if(!Cr(a))return{error:vt};const{matchUp:s}=Qp({drawDefinition:n,event:o,matchUpId:i}),{scheduledDate:c}=Du({matchUp:s}),u=(s?.timeItems??[]).filter((e=>[iu,au,ou].includes(e?.itemType))).map((e=>AU(e.itemValue,c))).reduce(((e,t)=>!e||t<e?t:e),void 0);if(!u||AU(a,c)<u){s?.timeItems&&(s.timeItems=s.timeItems.filter((e=>e.itemType!==ru)));const o=Yr(a,!0,!0);return TU({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,matchUpId:i,timeItem:{itemType:ru,itemValue:o}})}return{error:Un}}function xU({validateTimeSeries:e=!0,removePriorValues:t,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:a,endTime:o,event:s}){if(!a)return{error:Qe};if(!Cr(o))return{error:vt};const{matchUp:c}=Qp({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:u}=Du({matchUp:c}),d=(c?.timeItems??[]).filter((e=>[ru,au,iu].includes(e?.itemType))).map((e=>AU(e.itemValue,u))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(!e||!d||AU(o,u)>d){c?.timeItems&&(c.timeItems=c.timeItems.filter((e=>e.itemType!==ou)));const e=Yr(o,!0,!0);return TU({duplicateValues:!1,removePriorValues:t,tournamentRecord:n,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemType:ou,itemValue:e}})}return{error:hn}}function _U({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,matchUpId:i,stopTime:a,event:o}){if(!i)return{error:Qe};if(!Cr(a))return{error:vt};const{matchUp:s}=Qp({drawDefinition:n,event:o,matchUpId:i}),{scheduledDate:c}=Du({matchUp:s}),u=s?.timeItems??[];if(u.reduce(((e,t)=>t.itemType===ou||e),void 0))return{error:In};const d=u.filter((e=>[ru,au,iu].includes(e?.itemType))).sort(((e,t)=>AU(e.itemValue,c)-AU(t.itemValue,c))),p=d[d.length-1],l=p&&p.itemType===iu,m=d.filter((e=>!l||e.createdAt!==p.createdAt)).map((e=>AU(e.itemValue,c))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(AU(a,c)>m){if(s?.timeItems&&l){const e=p.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return TU({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,matchUpId:i,timeItem:{itemValue:Yr(a,!0,!0),itemType:iu}})}return{error:gn}}function LU({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,resumeTime:i,matchUpId:a,event:o}){if(!a)return{error:Qe};if(!Cr(i))return{error:vt};const{matchUp:s}=Qp({drawDefinition:n,event:o,matchUpId:a}),{scheduledDate:c}=Du({matchUp:s}),u=s?.timeItems??[];if(u.reduce(((e,t)=>t.itemType===ou||e),void 0))return{error:In};const d=u.filter((e=>[ru,au,iu].includes(e?.itemType))).sort(((e,t)=>AU(e.itemValue,c)-AU(t.itemValue,c))),p=d[d.length-1],l=p&&p.itemType===au,m=d.filter((e=>!l||e.createdAt!==p.createdAt)).map((e=>AU(e.itemValue,c))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(AU(i,c)>m){if(s?.timeItems&&l){const e=p.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return TU({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemValue:Yr(i,!0,!0),itemType:au}})}return{error:yn}}function BU({tournamentRecords:e,eventId:t,drawId:n}){const{tournamentIdMap:r}=Ug({tournamentRecords:e});return(r?Object.keys(r):[]).find((e=>t&&r?.[e].includes(t)||n&&r?.[e].includes(n)))}function VU({tournamentRecords:e,tournamentRecord:t,tournamentId:n,drawId:r}){if(!t&&!e)return{error:$};if(!r)return{error:le};if(!t&&e){if("string"!=typeof n&&!(n=BU({tournamentRecords:e,drawId:r})))return{error:H};if(!(t=e[n]))return{error:$}}const i=t&&Qs({tournamentRecord:t,drawId:r});return i?.drawDefinition?{drawDefinition:i.drawDefinition,event:i.event,tournamentRecord:t,...L}:Mi({result:{error:Q},stack:"getDrawDefinition"})}function jU({scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:t=!1,errorOnAnachronism:n=!1,checkChronology:r=!0,matchUpDependencies:i,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:c,matchUpIds:u,schedule:d}){if(!s)return{error:$};if(!(c||u&&Array.isArray(u)))return{error:Je};if(!(c||d&&"object"==typeof d))return{error:Dn};let p;const l=[];let m=0;if(r&&!i){const e=bh({tournamentRecords:o,tournamentRecord:s});i=e.matchUpDependencies,p=e.matchUps}p||(p=rh({tournamentRecord:s})?.matchUps??[]);const f=p.reduce(((n,r)=>{const{matchUpId:i,drawId:a,matchUpStatus:o}=r;return!t&&o===ma||!e&&Ca.includes(o)||(n[a]?n[a].push(i):n[a]=[i]),n}),{}),h=c?.map((e=>e.matchUpId));for(const I of Object.keys(f)){const{drawDefinition:e}=VU({tournamentRecord:s,drawId:I});if(!e)continue;const t=f[I].filter((e=>u?.includes(e)??h?.includes(e))),g=ih({inContext:!1,drawDefinition:e}).matchUps;for(const u of t){const t=EU({schedule:c?.find((e=>e.matchUpId===u))?.schedule||d,matchUpDependencies:i,errorOnAnachronism:n,removePriorValues:a,inContextMatchUps:p,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:e,drawMatchUps:g,matchUpId:u});if(t?.warnings?.length&&l.push(...t.warnings),t?.success&&(m+=1),t.error)return t}}return l.length?{...L,scheduled:m,warnings:l}:{...L,scheduled:m}}function GU({scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:t=!1,errorOnAnachronism:n,matchUpContextIds:r,removePriorValues:i,tournamentRecords:a,checkChronology:o,matchUpDetails:s,schedule:c}){if(!a)return{error:q};if(!Array.isArray(r)&&!Array.isArray(s))return{error:xn};if((!s||r)&&!c)return{error:mt,info:"schedule is required"};const u=[];let d=0;const{matchUpDependencies:p}=bh({tournamentRecords:a});for(const l of Object.values(a)){const{tournamentId:m}=l,f=r?.filter((e=>e.tournamentId===m)).map(Pl),h=s?.filter((e=>e?.tournamentId===m));if(f?.length||h?.length){const r=jU({matchUpDetails:h,scheduleCompletedMatchUps:e,scheduleByeMatchUps:t,matchUpDependencies:p,errorOnAnachronism:n,removePriorValues:i,tournamentRecords:a,tournamentRecord:l,checkChronology:o,matchUpIds:f,schedule:c});if(r.warnings?.length&&u.push(...r.warnings),r.scheduled&&(d+=r.scheduled),r.error)return r}}return u.length?{...L,scheduled:d,warnings:u}:{...L,scheduled:d}}function qU({structureId:e,matchUpsMap:t,matchUp:n}){const r=n?.roundPosition,i=r+(r%2?1:-1);return{pairedPreviousMatchUp:Lp({matchUpsMap:t,structureId:e}).find((({roundNumber:e,roundPosition:t})=>e===n?.roundNumber&&t===i))}}function $U({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:n,matchUpsMap:r,matchUp:i}){const a=e.find((e=>e.matchUpId===n)),{pairedPreviousMatchUp:o}=qU({structureId:a?.structureId,matchUp:a,matchUpsMap:r});if(a&&o){const n=o?.matchUpId,r=e.find((e=>e.matchUpId===n)),s=a?.structureId===r?.structureId?a?.roundPosition<r?.roundPosition?1:2:a.structureId===r?.structureId?2:1;i.matchUpStatusCodes=(i.matchUpStatusCodes??[]).map((e=>{const n=si(e)||!isNaN(e)?{code:e}:e;return n.sideNumber===s?{...n,previousMatchUpStatus:t}:n}))}}function WU({inContextDrawMatchUps:e,positionAssignments:t,sourceMatchUpStatus:n,targetDrawPosition:r,tournamentRecord:i,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:c,matchUp:u,event:d}){if(s){const t=e.find((({matchUpId:e})=>u.matchUpId===e)),n=t.sides?.find((e=>e.drawPosition===r))?.sideNumber,i=u.sides?.find((e=>e.sideNumber===n));i&&delete i.lineUp}u.drawPositions=(u.drawPositions||[]).map((e=>e===r?void 0:e)).filter(Boolean);const p=t.filter((({drawPosition:e})=>u.drawPositions?.includes(e))).filter((e=>e.bye)).length;return u.matchUpStatus=p&&ma||[ga,Ra].includes(u.matchUpStatus)&&u.matchUpStatus||Da,[Ra,ga].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&$U({inContextDrawMatchUps:e,sourceMatchUpStatus:n,sourceMatchUpId:a,matchUpsMap:c,matchUp:u}),rl({tournamentId:i?.tournamentId,eventId:d?.eventId,context:`removeSubsequentDrawPosition-${r}`,drawDefinition:o,matchUp:u}),{...L}}function HU({positionAssignments:e,tournamentRecord:t,drawDefinition:n,matchUpsMap:r,structure:i,event:a}){const{matchUps:o}=Kp({drawDefinition:n,matchUpsMap:r,structure:i,event:a});o.forEach((r=>{const i=e.filter((({drawPosition:e})=>r.drawPositions?.includes(e))).filter((e=>e.bye)).length;if(!r.winningSide){const e=i?ma:Da;Object.assign(r,{matchUpStatus:e}),rl({tournamentId:t?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:n,matchUp:r})}}))}function zU(e){let{inContextDrawMatchUps:t,participantId:n,drawPosition:r}=e;const{tournamentRecord:i,drawDefinition:a,structureId:o,matchUpsMap:s,event:c}=e,{structure:u}=rp({drawDefinition:a,structureId:o}),d=(sp({drawDefinition:a,structure:u}).positionAssignments||[]).find((e=>n&&e.participantId===n||r&&e.drawPosition===r));if(d&&n&&!r&&(r=d?.drawPosition),!r)return{error:se};n||(n=d?.participantId);const{activeDrawPositions:p}=eU({drawDefinition:a,structureId:o});if(p.includes(r))return{error:ae};t||({matchUps:t}=Cl({inContext:!0,drawDefinition:a,matchUpsMap:s}));return YU({inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:c}).drawPositionCleared?(sl({tournamentId:i?.tournamentId,drawDefinition:a,structure:u,event:c}),{...L,participantId:n}):{error:ne}}function YU({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,matchUpsMap:i,structureId:a,event:o}){const{structure:s}=rp({drawDefinition:n,structureId:a});if(!s)return{error:De};const c=sp({drawDefinition:n,structure:s}).positionAssignments||[],u=c.some((e=>{if(e.drawPosition===r)return delete e.participantId,delete e.qualifier,delete e.bye,!0}));if(s.structureType===Id)return HU({positionAssignments:c,tournamentRecord:t,drawDefinition:n,matchUpsMap:i,structure:s}),{drawPositionCleared:u,...L};const{matchUps:d}=Kp({drawDefinition:n,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:s,event:o}),{roundProfile:p,roundMatchUps:l}=ed({matchUps:d}),f=p&&Object.keys(p),h=f?.map((e=>m(e)));let I=r;const g=h?.map((e=>{const t=p?.[e],n=t?.pairedDrawPositions?.find((e=>e.includes(I))),r=n?.find((e=>e!==I)),i=c.find((e=>e.drawPosition===r)),a=p?.[e+1],o=i?.bye,s=a?.pairedDrawPositions?.find((e=>e.includes(r))),u=o&&s&&a&&a.drawPositions?.includes(r),d=n&&{pairedDrawPositionByeAdvancedPair:!u&&s,pairedDrawPosition:r,targetDrawPosition:I,relevantPair:n,roundNumber:e};return u&&(I=r),d})).filter((e=>e?.targetDrawPosition)),U=g?.reduce(((e,t)=>{const{roundNumber:n,relevantPair:r,targetDrawPosition:i,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=t,s=[{roundNumber:n,targetDrawPosition:i,relevantPair:r},o&&{roundNumber:n+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat(...s)}),[]);return U?.forEach((({roundNumber:u,targetDrawPosition:d,relevantPair:p})=>{const m=l?.[u].find((e=>k(e.drawPositions.filter(Boolean),p.filter(Boolean))));m&&(!function({inContextDrawMatchUps:e,targetDrawPosition:t,tournamentRecord:n,drawDefinition:r,matchUpsMap:i,roundNumber:a,structureId:o}){const{structure:s}=rp({drawDefinition:r,structureId:o});if(!s)return{error:De};if(s.structureType===Id)return;i=i||_p({drawDefinition:r});const c=i?.mappedMatchUps||{},u=c[o].matchUps,{initialRoundNumber:d}=tU({drawPosition:t,matchUps:u}),p=u?.filter((e=>e.roundNumber>=a&&e.roundNumber!==d&&e.drawPositions?.includes(t))),l=op({drawDefinition:r,structureId:o}).positionAssignments??[];p?.forEach((a=>KU({drawPosition:t,targetMatchUp:a,inContextDrawMatchUps:e,positionAssignments:l,tournamentRecord:n,drawDefinition:r,matchUpsMap:i,structure:s})))}({inContextDrawMatchUps:e,targetDrawPosition:d,tournamentRecord:t,drawDefinition:n,structureId:a,roundNumber:u,matchUpsMap:i}),KU({inContextDrawMatchUps:e,positionAssignments:c,tournamentRecord:t,drawDefinition:n,targetMatchUp:m,drawPosition:r,matchUpsMap:i,structure:s,event:o}))})),{tasks:U,drawPositionCleared:u,positionAssignments:c}}function KU({inContextDrawMatchUps:e,positionAssignments:t,tournamentRecord:n,drawDefinition:r,targetMatchUp:i,drawPosition:a,matchUpsMap:o,structure:s,event:c}){const u="removeDrawPosition",d=i.drawPositions?.slice(),p=i.matchUpStatus,l=i.winningSide,m=(o=o??_p({drawDefinition:r})).mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:f}=tU({drawPosition:a,matchUps:m});if(i.roundNumber&&f&&i.roundNumber>f){const e=(i.drawPositions??[]).map((e=>e===a?void 0:e));i.drawPositions=e}if(i.matchUpType===ji){const t=e?.find((e=>e.matchUpId===i.matchUpId)),o=(t?.sides??[]).reduce(((e,t,n)=>t.drawPosition===a?n:e),void 0);void 0!==o&&i.sides?.[o]?.lineUp&&(delete i.sides?.[o].lineUp,rl({tournamentId:n?.tournamentId,context:`${u}-TEAM`,eventId:c?.eventId,matchUp:i,drawDefinition:r}))}const h=bl({matchUpId:i.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetLinks:{winnerTargetLink:I},targetMatchUps:{loserMatchUp:g,winnerMatchUp:U,loserMatchUpDrawPositionIndex:y}}=h,v=t.filter((({drawPosition:e})=>i.drawPositions?.includes(e))).filter((e=>e.bye)).length,S=v&&ma||i.matchUpStatus&&[ga,Ra].includes(i.matchUpStatus)&&i.matcHUpStatus||2===i.drawPositions?.length&&Da||void 0;i.matchUpStatus=S,i.matchUpStatus&&[Ra,ga].includes(i.matchUpStatus)&&(i.winningSide=void 0);const w=d?.find((e=>!i.drawPositions?.includes(e)));if(d?.includes(a)&&p===i.matchUpStatus&&l===i.winningSide||(w&&Uh({method:u,color:"brightyellow",removedDrawPosition:w}),rl({tournamentId:n?.tournamentId,eventId:c?.eventId,matchUp:i,context:`${u}-${a}`,drawDefinition:r})),g&&g.structureId!==h.matchUp.structureId&&!v){const{drawPositions:t,roundNumber:i}=g;if(1===i){const i=t[y];YU({structureId:g.structureId,drawPosition:i,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:o})}else{const i=Math.min(...t.filter(Boolean)),a=function({loserMatchUpDrawPosition:e,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:r,loserMatchUp:i,matchUpsMap:a,event:o}){const{structure:s}=rp({structureId:i.structureId,drawDefinition:r}),{positionAssignments:c}=op({structure:s}),u=c?.find((t=>t.drawPosition===e));if(u?.bye){const s=zU({drawPosition:e,structureId:i.structureId,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,event:o});if(s.error)return s}return{...L}}({loserMatchUpDrawPosition:i,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,loserMatchUp:g,matchUpsMap:o,event:c});if(a.error)return Mi({result:a,stack:u});const s=(o?.mappedMatchUps||{})[g.structureId].matchUps,{initialRoundNumber:d}=tU({drawPosition:i,matchUps:s});1===d&&(Uh({method:u,color:"brightyellow",loserMatchUpDrawPosition:i}),YU({structureId:g.structureId,drawPosition:i,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:o}))}}return U&&U.structureId!==h.matchUp.structureId&&I.target.feedProfile,{...L}}function QU(e){const{dualWinningSideChange:t,inContextDrawMatchUps:n,tournamentRecord:r,drawDefinition:i,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:c,matchUpId:u,structure:d,event:p}=e,l=Boolean(e.matchUp.collectionId),m=Hp({drawDefinition:i,structure:d}),{drawPositions:f,winningSide:h}=c.matchUp||{};if(!m&&!f)return{error:ie};const{targetLinks:{loserTargetLink:I,winnerTargetLink:g,byeTargetLink:U},targetMatchUps:{loserMatchUp:y,winnerMatchUp:v,byeMatchUp:S}}=c,w=kl({...e,matchUpStatus:a||Da,removeWinningSide:!0});if(w.error)return w;let P;if(l){const{matchUpTieId:n,matchUpsMap:a}=e;if(P=xl({matchUpId:n,tournamentRecord:r,drawDefinition:i,matchUpsMap:a,event:p}),!t&&!P.removeWinningSide)return{...L}}if(m)return{...L};const{matchUps:T}=Kp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:i,matchUpsMap:o,structure:d}),{positionAssignments:D}=sp({structure:d}),R=h-1,b=1-R,N=f[R],M=f[b],{winnerParticipantId:A,loserParticipantId:E}=D?.reduce(((e,t)=>(t.drawPosition===M&&(e.loserParticipantId=t.participantId),t.drawPosition===N&&(e.winnerParticipantId=t.participantId),e)),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},C=T.filter((e=>e.drawPositions?.includes(M)));if(v&&JU({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:n,winningDrawPosition:N,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:g,drawDefinition:i,winnerMatchUp:v,dualMatchUp:s,matchUpsMap:o}),y){const{winnerHadMatchUpStatus:e}=function({matchUpStatuses:e=[ma,Ra,ga],drawPositionMatchUps:t,loserDrawPosition:n,sourceMatchUps:r}){const i=t?.reduce(((e,t)=>!e||t.roundNumber>e.roundNumber?t:e),void 0),a=i?.drawPositions?.find((e=>e!==n)),o=r.filter((e=>e?.drawPositions?.includes(a))).map((e=>e.matchUpStatus)),s=r.filter((e=>e?.drawPositions?.includes(n))).map((e=>e.matchUpStatus));return{sourceMatchUp:i,winnerHadMatchUpStatus:k(o||[],e),winnerMatchUpStatuses:o,loserHadMatchUpStatus:k(s||[],e),loserMatchUpStatuses:s}}({drawPositionMatchUps:C,loserDrawPosition:M,sourceMatchUps:T}),t=I.linkCondition;if(e&&t===Td){XU({targetLink:I,inContextDrawMatchUps:n,drawDefinition:i,drawPosition:Math.min(...y.drawPositions),matchUpsMap:o,event:p})}const c=function({sourceMatchUpStatus:e,loserParticipantId:t,tournamentRecord:n,loserTargetLink:r,sourceMatchUpId:i,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:c,event:u}){const d="removeDirectedLoser",p=r.target.structureId,{structure:l}=rp({drawDefinition:a,structureId:p});if(!l)return{error:De};const{positionAssignments:m}=sp({structure:l}),f=m?.find((e=>e.participantId===t))?.drawPosition;if(m?.forEach((e=>{e.participantId===t&&delete e.participantId})),l.seedAssignments=(l.seedAssignments||[]).filter((e=>e.participantId!==t)),c){const e=o?.sides.reduce(((e,t,n)=>t.drawPosition===f?n:e),void 0),t=s?.drawMatchUps?.find((({matchUpId:e})=>e===o.matchUpId)),r=t?.sides?.[e];r&&(delete r.lineUp,rl({tournamentId:n?.tournamentId,eventId:u?.eventId,matchUp:t,context:d,drawDefinition:a}))}return{...L}}({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:E,tournamentRecord:r,loserTargetLink:I,drawDefinition:i,loserMatchUp:y,dualMatchUp:s,matchUpsMap:o,event:p});if(c.error)return c}if(S){XU({sourceMatchUpId:u,targetLink:U,inContextDrawMatchUps:n,drawDefinition:i,drawPosition:Math.min(...S.drawPositions),matchUpsMap:o,event:p})}const O=P&&{tieMatchUpResult:P};return{...L,...O}}function JU({inContextDrawMatchUps:e,winningDrawPosition:t,sourceMatchUpStatus:n,winnerParticipantId:r,tournamentRecord:i,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:c,matchUpsMap:u,dualMatchUp:d,event:p}){const{structureId:l,roundNumber:m}=c;if(a){const e=a.target.structureId,{structure:t}=rp({drawDefinition:s,structureId:e});if(!t)return{error:De};const{positionAssignments:n}=sp({structure:t});t.seedAssignments=(t.seedAssignments||[]).filter((e=>e.participantId!==r));const o=n?.find((e=>e.participantId===r)),d=o?.drawPosition,{matchUps:l}=Kp({drawDefinition:s,structure:t,event:p}),m=R(l.map((e=>e.drawPositions)).flat(1/0).filter(Boolean));if(1===(d?m[d]:void 0))n?.forEach((e=>{e.participantId===r&&delete e.participantId}));else{const e=l.filter((({drawPositions:e})=>e.includes(d)));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:e,winnerTargetLink:a})}const f=u?.drawMatchUps?.find((({matchUpId:e})=>e===c.matchUpId));f&&rl({tournamentId:i?.tournamentId,eventId:p?.eventId,matchUp:f,context:"removeDirectedWinner",drawDefinition:s})}return m&&function({inContextDrawMatchUps:e,sourceMatchUpStatus:t,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:i,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:c,matchUpsMap:u,event:d}){const{structure:p}=rp({drawDefinition:a,structureId:o});if(p?.structureType===Id)return{...L};u=u||_p({drawDefinition:a});const l=(u?.mappedMatchUps||{})[o].matchUps,{initialRoundNumber:m}=tU({drawPosition:n,matchUps:l}),f=l?.filter((e=>e.roundNumber>=c&&e.roundNumber!==m&&e.drawPositions?.includes(n))),{positionAssignments:h}=op({drawDefinition:a,structureId:o});for(const I of f||[])WU({inContextDrawMatchUps:e,sourceMatchUpStatus:t,positionAssignments:h,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:i,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:I,event:d})}({targetDrawPosition:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:i,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:d,matchUpsMap:u,roundNumber:m,structureId:l}),{...L}}function XU({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,matchUpsMap:i,targetLink:a,event:o}){return zU({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,matchUpsMap:i,drawPosition:r,structureId:a.target.structureId,event:o}),{...L}}function ZU(e){let{sourceMatchUp:t}=e;const{targetMatchUp:n,structure:r,matchUpsMap:i,drawPosition:a}=e,o=n.roundNumber>1&&n.roundNumber-1,s=Lp({structureId:r.structureId,matchUpsMap:i});!t&&a&&(t=s.find((({drawPositions:e,roundNumber:t})=>t===o&&e?.includes(a))));const c=t?.roundPosition,u=c+(c%2?1:-1),d=o&&s.find((({roundNumber:e,roundPosition:t})=>e===o&&t===u)),p=d?.matchUpStatus;return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:[ya,Ua].includes(p)}}function ey({drawDefinition:e,positionAction:t}){const{extension:n}=lc({name:bo,element:e}),r=Array.isArray(n?.value)&&n?.value||[];if(!r?.length){const t=e.structures.find((e=>e.stage===nd));if(t){const e=op({structure:t}).positionAssignments?.map((({drawPosition:e,participantId:t,bye:n,qualifier:r})=>({drawPosition:e,participantId:t,qualifier:r,bye:n})));r.push({name:"initialMainAssignments",initialAssignments:e})}}Js({element:e,extension:{name:bo,value:r.concat(t)}})}function ty({provisionalPositioning:e,isPositionAction:t,tournamentRecord:n,drawDefinition:r,drawPosition:i,matchUpsMap:a,structureId:o,structure:s,event:c}){if(!r)return{error:Y};if(s||({structure:s}=rp({drawDefinition:r,structureId:o})),!s)return{error:De};o||({structureId:o}=s);const u="assignDrawPositionBye";Uh({method:u,color:"cyan",drawPosition:i}),a||(a=_p({drawDefinition:r}));const{positionAssignments:d}=op({structure:s}),{activeDrawPositions:p}=eU({drawDefinition:r,structureId:o}),l=d?.find((e=>e.drawPosition===i));if(l?.bye)return{...L};const m=p?.includes(i);if(m)return{error:ae};const f=d?.find((e=>e.drawPosition===i));if(!f)return{error:oe};const{filled:h,containsBye:I,assignedParticipantId:g}=function(e){const t=e.bye,n=e.qualifier,r=e.participantId,i=t||n||r;return{containsBye:t,containsQualifier:n,assignedParticipantId:r,filled:i}}(f);if(I)return{...L};if(h&&!I)return Mi({result:{error:ee},stack:u});const U=Cl({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps||[],{matchUps:y}=Kp({provisionalPositioning:e,drawDefinition:r,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:a,structure:s});if(d?.forEach((e=>{e.drawPosition===i&&(e.bye=!0)})),s.structureType===Id)return function({tournamentRecord:e,drawDefinition:t,drawPosition:n,matchUps:r,event:i}){r.forEach((r=>{r.drawPositions?.includes(n)&&ry({eventId:i?.eventId,tournamentRecord:e,drawDefinition:t,matchUp:r})}))}({tournamentRecord:n,drawDefinition:r,drawPosition:i,matchUps:y}),sl({tournamentId:n?.tournamentId,drawDefinition:r,structure:s,event:c}),ny({assignedParticipantId:g,isPositionAction:t,drawDefinition:r,drawPosition:i,structureId:o,stack:u});const{roundProfile:v,roundMatchUps:S}=ed({matchUps:y}),w=v&&Object.keys(v).map((e=>parseInt(e))).reverse(),P=w?.find((e=>v?.[e].drawPositions?.includes(i))),T=P&&S?.[P].find((({drawPositions:e})=>e?.includes(i)));ry({tournamentRecord:n,drawDefinition:r,matchUp:T,event:c});const D=T.drawPositions?.find((e=>e!==i));if(D){const e=iy({sourceDrawPositions:T.drawPositions,matchUpId:T.matchUpId,inContextDrawMatchUps:U,drawPositionToAdvance:D,tournamentRecord:n,drawDefinition:r,matchUpsMap:a});if(e.error)return e}return sl({tournamentId:n?.tournamentId,drawDefinition:r,structure:s,event:c}),ny({assignedParticipantId:g,isPositionAction:t,drawDefinition:r,drawPosition:i,structureId:o,stack:u})}function ny({assignedParticipantId:e,isPositionAction:t,drawDefinition:n,drawPosition:r,structureId:i,stack:a}){if(t){ey({drawDefinition:n,positionAction:{removedParticipantId:e,drawPosition:r,structureId:i,name:a}})}return Mi({result:{...L},stack:a})}function ry({tournamentRecord:e,drawDefinition:t,eventId:n,matchUp:r,event:i}){Object.assign(r,{matchUpStatus:ma,score:void 0,winningSide:void 0}),rl({tournamentId:e?.tournamentId,eventId:n??i?.eventId,context:"setMatchUpStatusBye",drawDefinition:t,matchUp:r})}function iy({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:n,tournamentRecord:r,drawDefinition:i,matchUpsMap:a,matchUpId:o,event:s}){Uh({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:e});const c=a.drawMatchUps.find((e=>e.matchUpId===o)),u=t.find((e=>e.matchUpId===o)),d=u?.structureId,{structure:p}=rp({drawDefinition:i,structureId:d}),{positionAssignments:m}=op({structure:p}),f=m?.filter((e=>e.bye)).map((e=>e.drawPosition)),h=c?.drawPositions?.find((t=>t!==e)),I=h&&f?.includes(h),{targetLinks:{loserTargetLink:g},targetMatchUps:{loserMatchUp:U,winnerMatchUp:y,loserTargetDrawPosition:v}}=bl({inContextDrawMatchUps:t,drawDefinition:i,matchUpId:o});if(y&&y.structureId===p?.structureId&&function({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:n,tournamentRecord:r,drawDefinition:i,winnerMatchUp:a,matchUpsMap:o,event:s}){const c="advanceWinner",u=o.drawMatchUps.find((e=>e.matchUpId===a.matchUpId)),d=t.find((e=>e.matchUpId===a.matchUpId)),p=d?.structureId,{structure:m}=rp({drawDefinition:i,structureId:p}),{positionAssignments:f}=op({structure:m}),h=f?.find((({drawPosition:t})=>t===e)),I=h?.bye,g=u.drawPositions?.filter(Boolean),U=f?.filter((e=>g?.includes(e.drawPosition))),y=f?.find((({drawPosition:t})=>t===e)),v=n?.find((t=>t!==e)),S=v&&U?.find((({drawPosition:e})=>e===v)),w=S?.bye,P=I&&w;P&&console.log({isByeAdvancedBye:P});if(g?.length>1&&I&&!w)return Mi({result:{error:ee},stack:c});const T=g?.find((t=>t!==e));let D=P;const R=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),b=R.map((t=>!t&&!D||t===e?(D=!0,e):t)).sort(l);if(!D)return console.log("@@@@@@@",{advancingAssignmentIsBye:y,drawPositionToAdvance:e,existingAssignments:U}),Mi({result:{error:ee},stack:c});const N=f?.find((({drawPosition:e})=>e===T))?.bye,M=f?.find((({drawPosition:t})=>t===e))?.bye,A=M||N?ma:Da;Object.assign(u,{matchUpStatus:A,score:void 0,winningSide:void 0,drawPositions:b});const E=u.drawPositions.find((e=>!R.includes(e)));Uh({method:c,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:N,drawPositionIsBye:M}),rl({tournamentId:r?.tournamentId,matchUp:u,eventId:s?.eventId,context:c,drawDefinition:i});const{targetLinks:{loserTargetLink:C},targetMatchUps:{loserMatchUp:O,loserTargetDrawPosition:F}}=bl({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:i});if(N||M){const n=N?e:T;if(n)iy({drawPositionToAdvance:n,matchUpId:a.matchUpId,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,matchUpsMap:o});else if(M&&C&&O)if(O.feedRound)ay({loserTargetDrawPosition:F,tournamentRecord:r,loserTargetLink:C,drawDefinition:i,loserMatchUp:O,matchUpsMap:o});else{const e=1-a.roundPosition%2,t=O.drawPositions[e],n=ty({structureId:C.target.structureId,drawPosition:t,tournamentRecord:r,drawDefinition:i,event:s});if(n.error);}}}({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:n,tournamentRecord:r,drawDefinition:i,winnerMatchUp:y,matchUpsMap:a,event:s}),U&&I&&U.structureId!==p?.structureId){const{roundNumber:e}=U;if(1===e){const e=ty({structureId:g.target.structureId,drawPosition:v,tournamentRecord:r,drawDefinition:i,event:s});if(e.error)return e}else ay({loserTargetDrawPosition:v,tournamentRecord:r,loserTargetLink:g,drawDefinition:i,loserMatchUp:U,matchUpsMap:a,event:s})}return{...L}}function ay({loserTargetDrawPosition:e,tournamentRecord:t,loserTargetLink:n,drawDefinition:r,loserMatchUp:i,matchUpsMap:a,event:o}){const{roundNumber:s}=i;Uh({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:e});const c=(a?.mappedMatchUps||{})[i.structureId].matchUps,{initialRoundNumber:u}=tU({drawPosition:e,matchUps:c});if(u===s){const i=ty({structureId:n.target.structureId,drawPosition:e,tournamentRecord:t,drawDefinition:r,event:o});if(i.error)return i}}function oy({inContextTargetMatchUp:e,drawPositionSideIndex:t,teamParticipantId:n,tournamentRecord:r,drawDefinition:i,matchUp:a,event:o}){const s=e?.sides?.[t]?.sideNumber,c=s&&a.sides?.find((e=>e.sideNumber===s)),{extension:u}=Ms({element:i,name:_o}),d=ii((u?.value||{})[n],!1,!0);if(c)a?.sides?.forEach((e=>{e.sideNumber===s&&(e.lineUp=d)}));else{a.sides=[1,2].map((e=>({...a.sides?.find((t=>t.sideNumber===e))||{},sideNumber:e})));const e=a.sides.find((e=>e.sideNumber===s));e&&(e.lineUp=d)}rl({tournamentId:r?.tournamentId,context:"updateSidLineUp",eventId:o?.eventId,drawDefinition:i,matchUp:a})}function sy({inContextDrawMatchUps:e,drawPosition:t,matchUpId:n}){const r=e.filter((({winnerMatchUpId:e,loserMatchUpId:t})=>t===n||e===n)).sort(((e,t)=>e.roundPosition-t.roundPosition));return e.find((e=>e.matchUpId===n)).feedRound?1:r.reduce(((e,n,r)=>n.drawPositions?.includes(t)?r+1:e),void 0)}function cy({inContextDrawMatchUps:e,sourceMatchUpStatus:t,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:i,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:c,event:u}){const d="assignMatchUpDrawPosition";s||(s=_p({drawDefinition:i})),e||(e=Cl({inContext:!0,drawDefinition:i,matchUpsMap:s}).matchUps??[]);const p=e.find((e=>e.matchUpId===c)),m=p?.structureId,f=i?.structures?.find((e=>e.structureId===m));if(!f)return{error:De};const h=s?.drawMatchUps?.find((e=>e.matchUpId===c)),I=h?.drawPositions??[],{positionAdded:g,positionAssigned:U,updatedDrawPositions:y}=function({drawPosition:e,drawPositions:t}){let n=!1,r=!!t?.includes(e);return{updatedDrawPositions:r?t||[]:[...t,void 0,void 0].slice(0,2).map((t=>t||r?t:(r=!0,n=!0,e))).sort(l).filter(Boolean),positionAdded:n,positionAssigned:r}}({drawPosition:o,drawPositions:I}),{positionAssignments:v}=op({drawDefinition:i,structure:f}),S=v?.filter((e=>y.includes(e.drawPosition))),w=S?.find((({bye:e})=>e)),P=h?.matchUpStatus&&[Ra,ga].includes(h.matchUpStatus)&&y.filter(Boolean).length<2;if(a=w&&ma||a||P&&h.matchUpStatus||h?.matchUpStatus&&[ya,Ua].includes(h.matchUpStatus)&&h.matchUpStatus||Da,h&&g){e=Cl({inContext:!0,drawDefinition:i,matchUpsMap:s}).matchUps??[];const u=P&&sy({inContextDrawMatchUps:e,drawPosition:o,matchUpId:c})||void 0;h?.matchUpStatusCodes&&$U({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:r,matchUpsMap:s,matchUp:h}),Object.assign(h,{drawPositions:y,winningSide:u,matchUpStatus:a}),rl({tournamentId:n?.tournamentId,eventId:p?.eventId,context:d,drawDefinition:i,matchUp:h})}const T=bl({inContextDrawMatchUps:e,inContextMatchUp:p,drawDefinition:i,matchUpId:c}),{targetMatchUps:{winnerMatchUp:D,loserMatchUp:R,loserTargetDrawPosition:b},targetLinks:{loserTargetLink:N}}=T,M=Lp({structureId:f.structureId,matchUpsMap:s});if(U&&w){if(D)if([ma,ya,Ua].includes(a)){const t=cy({matchUpId:D.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:i,drawPosition:o,matchUpsMap:s});if(t.error)return t}else{const{structureId:e}=D;e!==f.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(D&&p&&!p.feedRound){const{pairedPreviousMatchUpIsDoubleExit:t}=ZU({targetMatchUp:h,drawPosition:o,matchUpsMap:s,structure:f});if(t){const t=cy({matchUpId:D.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:i,drawPosition:o,matchUpsMap:s});if(t.error)return t}}if(h?.matchUpType===ji){const t=e?.find((({matchUpId:e})=>e===h.matchUpId)),r=(t?.sides??[]).reduce(((e,t,n)=>t.drawPosition===o?n:e),void 0),a=v?.find((e=>e.drawPosition===o))?.participantId;a&&void 0!==r&&oy({inContextTargetMatchUp:t,drawPositionSideIndex:r,teamParticipantId:a,tournamentRecord:n,drawDefinition:i,matchUp:h})}if(N?.linkCondition===Td&&2===y.filter(Boolean).length&&!w){if(M.filter((({drawPositions:e,roundNumber:t})=>1===t&&k(e,y))).every((({matchUpStatus:e})=>[ha,Pa].includes(e)))&&R){const{structureId:e}=R,t=ty({drawPosition:b,tournamentRecord:n,drawDefinition:i,structureId:e,matchUpsMap:s,event:u});if(t.error)return t}}return U?{...L}:Mi({result:{error:ee},context:{drawPosition:o},stack:d})}function uy(e){const{tournamentRecord:t,appliedPolicies:n,drawDefinition:r,matchUpsMap:i,targetData:a,structure:o,event:s}=e,c="doubleExitAdvancement";if(o.structureType===Id)return Mi({result:{...L},stack:c});const{matchUp:u,targetMatchUps:d,targetLinks:p}=a,{loserMatchUp:l,winnerMatchUp:m,loserTargetDrawPosition:f}=d;if(l&&l.matchUpStatus!==Ki.Bye){const{loserTargetLink:a}=p;if(n?.progression?.doubleExitPropagateBye){const e=py({loserTargetDrawPosition:f,tournamentRecord:t,loserTargetLink:a,drawDefinition:r,loserMatchUp:l,matchUpsMap:i,event:s});if(e.error)return Mi({result:e,stack:c})}else{const{feedRound:n,drawPositions:r,matchUpId:i}=l,a=n?2:2-r.indexOf(f),o=dy({...e,targetMatchUp:l,walkoverWinningSide:a,tournamentRecord:t,sourceMatchUp:u,matchUpId:i});if(o.error)return Mi({result:o,stack:c})}}if(m){const n=dy({...e,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:t,sourceMatchUp:u});if(n.error)return Mi({result:n,stack:c})}return Mi({result:{...L},stack:c})}function dy(e){const{inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:r,sourceMatchUp:i,targetMatchUp:a,matchUpsMap:o}=e,s=r.structures.find((({structureId:e})=>e===a.structureId)),c=e.matchUpStatus===Ki.DoubleDefault?Ki.DoubleDefault:Ki.DoubleWalkover,u=e.matchUpStatus===Ki.DoubleDefault?Ki.Defaulted:Ki.Walkover,d="conditionallyAdvanceDrawPosition",p=o.drawMatchUps.find((e=>e.matchUpId===a.matchUpId));if(!p)return{error:et};const l=i?.drawPositions||[];let m=p.drawPositions?.filter(Boolean);const f=i?.structureId===a.structureId;if(f&&k(l,m)&&(m=m.filter((e=>!l.includes(e)))),f&&m.length>1)return Mi({result:{error:ee},stack:d});const{pairedPreviousMatchUpIsDoubleExit:h,pairedPreviousMatchUp:I}=ZU(e),g=bl({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetMatchUps:U,targetLinks:y}=g,{loserTargetDrawPosition:v,winnerMatchUp:S,loserMatchUp:w}=U;if(w){const{loserTargetLink:e}=y,t=py({loserTargetDrawPosition:v,loserMatchUp:w,tournamentRecord:n,loserTargetLink:e,drawDefinition:r,matchUpsMap:o});if(t.error)return Mi({result:t,stack:d})}const P=p.drawPositions?.filter(Boolean)||[],T=1===P.length,D=e.walkoverWinningSide||T&&sy({drawPosition:P[0],matchUpId:a.matchUpId,inContextDrawMatchUps:t})||void 0,R=[Ki.Walkover,Ki.Defaulted].includes(p.matchUpStatus)&&!P.length,b=1===p.finishingRound,N=R&&!b?c:u,M=t.find((e=>e.matchUpId===I.matchUpId));let A,E=[];i&&(i?.structureId===M?.structureId?A=i.roundPosition<I?.roundPosition?1:2:a.feedRound?A=i.structureId===a.structureId?2:1:D&&(A=3-D));const C=e.matchUpStatus,O=I?.matchUpStatus;1===A?E=[{matchUpStatus:ly(C),previousMatchUpStatus:C,sideNumber:1},{matchUpStatus:ly(O),previousMatchUpStatus:O,sideNumber:2}]:2===A&&(E=[{matchUpStatus:ly(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:ly(C),previousMatchUpStatus:C,sideNumber:2}]),E.length&&(E=E.map((e=>pi(e))));const F=kl({...e,matchUp:p,winningSide:D,matchUpStatusCodes:E,matchUpStatus:N});if(F.error)return Mi({result:F,stack:d});if(R)return uy({...e,matchUpStatus:N,targetData:g});if(!S)return Mi({result:{...L},stack:d});const x=2===m.length?m[D-1]:m[0],{positionAssignments:_}=op({structure:s}),B=_?.find((e=>e.drawPosition===x)),V=o.drawMatchUps.find((e=>e.matchUpId===S.matchUpId)),j=V?.drawPositions?.filter(Boolean),G=1===j.length;if(x){if(B?.bye){const n=bl({matchUpId:V.matchUpId,inContextDrawMatchUps:t,drawDefinition:r});if(G){const e=j.filter(Boolean)[0],n=sy({drawPosition:e,matchUpId:V.matchUpId,inContextDrawMatchUps:t}),i=kl({matchUpId:V.matchUpId,matchUp:V,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,winningSide:n});return i.error?Mi({result:i,stack:d}):iy({drawPositionToAdvance:e,matchUpId:V.matchUpId,inContextDrawMatchUps:t,drawDefinition:r,matchUpsMap:o})}if([Ki.Walkover,Ki.Defaulted].includes(S.matchUpStatus)){const t=uy({...e,matchUpId:V.matchUpId,matchUpStatus:N,targetData:n});if(t.error)return Mi({result:t,stack:d})}return Mi({result:{...L},stack:d})}return cy({matchUpId:S.matchUpId,drawPosition:x,inContextDrawMatchUps:t,drawDefinition:r})}if(h){if(!V)return{error:et};if(G){const e=j[0],n=sy({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawPosition:e});console.log("existing drawPosition is winningSide",{walkoverWinningSide:n})}const n=[Ki.Walkover,Ki.Defaulted].includes(V.matchUpStatus)?u:c,i=kl({matchUpId:V.matchUpId,matchUp:V,matchUpStatusCodes:[],removeScore:!0,drawDefinition:r,matchUpStatus:n});if(i.error)return Mi({result:i,stack:d});if(n===c){const t=uy({...e,matchUpId:a.matchUpId,matchUpStatus:n,targetData:g});if(t.error)return t}}return Mi({result:{...L},stack:d})}function py(e){const{loserTargetDrawPosition:t,tournamentRecord:n,loserTargetLink:r,drawDefinition:i,matchUpsMap:a,event:o}=e,s=r?.target?.structureId,{structure:c}=rp({drawDefinition:i,structureId:s});return c?ty({drawPosition:t,tournamentRecord:n,drawDefinition:i,structureId:s,matchUpsMap:a,event:o}):{error:be}}function ly(e){return e===Ki.DoubleWalkover?Ki.Walkover:e===Ki.DoubleDefault?Ki.Defaulted:e}function my(e){const{tournamentRecord:t,drawDefinition:n,matchUpStatus:r,structure:i,matchUp:a}=e,o=!(!a.tieMatchUps||a.rondPosition||!e.inContextDrawMatchUps.find((e=>e.matchUpId===a.matchUpId)).containerStructureId),s=r===ma,c=a.winningSide,u=[ya,Ua].includes(r),d=pl({matchUpStatus:r}),p=ll({matchUpStatus:r}),l=!d&&!p,m=e.matchUpTieId||c&&d&&!u,f=c&&u;return l&&{error:je}||m&&fy(e)||f&&function(e){const t=QU(e);return t.error?t:uy(e)}(e)||c&&QU(e)||p&&kl({...e,removeScore:[fa,Ra].includes(r),matchUpStatus:r||Da})||s&&function({tournamentRecord:e,drawDefinition:t,structure:n,matchUp:r}){const i="attemptToSetMatchUpStatusBYE";if(r?.winningSide)return Mi({result:{error:$e},context:{matchUpStatus:ma},stack:i});const{positionAssignments:a}=sp({structure:n}),o=a?.filter((e=>e.bye)).map((e=>e.drawPosition)),s=r.drawPositions?.some((e=>o?.includes(e)));return s?(r.matchUpStatus=ma,r.matchUpStatusCodes=[],rl({tournamentId:e?.tournamentId,context:i,drawDefinition:t,matchUp:r}),{...L}):Mi({result:{error:Ve},info:"matchUp does not include BYE",stack:i})}({tournamentRecord:t,drawDefinition:n,structure:i,matchUp:a})||!d&&{error:je}||u&&function(e){const t=fy({...e,removeScore:!0});return t.error?t:uy(e)}(e)||o&&fy(e)||Mi({result:{error:$e},stack:"attemptToSetMatchUpStatus"})}function fy(e){const t="scoreModification";if(e.isCollectionMatchUp&&e.dualMatchUp?.winningSide&&!e.projectedWinningSide){const n=QU(e);if(n.error)return Mi({result:n,stack:t})}const n=Boolean(e.matchUp.collectionId),r=kl(e);if(n){const{matchUpTieId:n,drawDefinition:i,matchUpsMap:a}=e,o=xl({tournamentRecord:e.tournamentRecord,matchUpId:n,event:e.event,drawDefinition:i,matchUpsMap:a});if(o.error)return Mi({result:o,stack:t});Object.assign(r,{tieMatchUpResult:o})}return Mi({result:r,stack:t})}function hy({drawDefinition:e,structure:t,matchUp:n}){const r=[];if(t.finishingPosition===Jd){if(_I({drawDefinition:e,structure:t})){const{structureIds:i}=function({drawDefinition:e,structure:t,matchUp:n}){const{drawPositions:r}=n,{positionAssignments:i}=op({drawDefinition:e,structure:t}),a=i?.filter((({drawPosition:e})=>r?.includes(e))),o=a?.map((e=>{const{extension:t}=Ms({element:e,name:Yo});return t?.value?.groupOrder})),{containerStructures:s}=Zg({drawDefinition:e}),c=s[t.structureId],u=Rl({drawDefinition:e,structureId:c})?.links?.source,d=u?.filter((e=>k(o,e.source?.finishingPositions||[]))).map((e=>e.source.structureId));return{structureIds:d}}({drawDefinition:e,structure:t,matchUp:n});i?.length&&r.push(...i)}}return{connectedStructureIds:r}}function Iy(e){const{dualWinningSideChange:t,matchUpStatusCodes:n,tournamentRecord:r,drawDefinition:i,matchUpFormat:a,matchUpStatus:o,winningSide:s,matchUpId:c,structure:u,matchUp:d,event:p,score:l}=e,m=pl({matchUpStatus:o})||[fa,pa].includes(o)&&t,f=Boolean(d.collectionId),h=Hp({drawDefinition:i,structure:u}),I=f||h||function({structure:e,matchUp:t}){const{drawPositions:n}=t,{positionAssignments:r}=sp({structure:e}),i=r?.filter((e=>n?.includes(e.drawPosition)&&e.participantId));return 2===i?.length}({structure:u,matchUp:d});if(!I)return{error:ke};const g=[Ra].includes(o);return Mi({result:kl({matchUpStatusCodes:m&&n||[],matchUpStatus:m&&o||ha,tournamentRecord:r,drawDefinition:i,matchUpFormat:a,removeScore:g,winningSide:s,matchUpId:c,matchUp:d,event:p,score:l}),stack:"attemptToModifyScore"})}function gy({lineUp:e}){if(!Array.isArray(e))return;const t={};return P(e.flatMap((({collectionAssignments:e})=>e?.map((({collectionId:e,collectionPosition:t})=>[e,t].join("|"))))).filter(Boolean)).forEach((n=>{const[r,i]=n.split("|"),a=parseInt(i),{assignedParticipantIds:o}=ju({collectionPosition:a,collectionId:r,lineUp:e});o.forEach((e=>{t[e]||(t[e]=[]),t[e].push({collectionId:r,collectionPosition:a})}))})),Object.keys(t).map((e=>({participantId:e,collectionAssignments:t[e]})))}function Uy({participantId:e,drawDefinition:t,entryStatus:n,entryStage:r}){if(!t)return{error:Y};const i=t.entries?.find((t=>!(t.participantId!==e||n&&n!==t.entryStatus||r&&r!==t.entryStage)));return e&&i}function yy({provisionalPositioning:e,tournamentRecord:t,drawDefinition:n,seedingProfile:r,participantId:i,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:c,eventId:u,event:d}){const p="assignSeed",{structure:l}=rp({drawDefinition:n,structureId:o}),{positionAssignments:m}=sp({structure:l}),f=kp({provisionalPositioning:e,drawDefinition:n,structure:l}).seedAssignments,h=f.map((e=>e.seedNumber)),I=Uy({drawDefinition:n,participantId:i});if(i&&!I)return Mi({result:{error:Et},context:{participantId:i},stack:p});const g=d?Ks({event:d}).flightProfile?.flights?.length:0,U=g&&g>1,y=m?.find((e=>e.participantId===i)),v=y?.drawPosition;if(v){if(!oU({drawPosition:v,drawDefinition:n,seedBlockInfo:a,structureId:o,seedNumber:s}))return Mi({result:{error:Z},context:{assignedDrawPosition:v},info:"invalid seed position",stack:p})}let S;return h.includes(s)||f.push({seedNumber:s,seedValue:c}),f.forEach((e=>{e.participantId===i&&e.seedNumber!==s&&(e.participantId=void 0),e.seedNumber===s&&(e.participantId=i,r?.groupSeedingThreshold||U||(e.seedValue=c||s),S=!0)})),S?(ol({tournamentId:t?.tournamentId,drawDefinition:n,structure:l,eventId:u}),{...L}):Mi({result:{error:ve},stack:p})}function vy({inContextDrawMatchUps:e,drawDefinition:t,assignments:n,matchUpsMap:r,structure:i}){const a=Zg({drawDefinition:t})?.containedStructures,o=a?.[i.structureId]?.map((({structureId:e})=>e))||[];o.push(i?.structureId);const s=n?.map((({drawPosition:e})=>e))||[],c=e?.filter((e=>o.includes(e.structureId)&&O(e.drawPositions||[],s).length))||[],u=c.map((({matchUpId:e})=>e)),d=r?.drawMatchUps?.filter((e=>u.includes(e.matchUpId)))||[];return{drawPositions:s,matchUps:d,targetMatchUps:c}}function Sy({lineUp:e,tieFormat:t}){const n=[];if(!Array.isArray(e))return n.push(sa("lineUp")),{valid:!1,errors:n,error:xn};const r=e.every((e=>{if("object"!=typeof e)return n.push("lineUp entries must be objects"),!1;const{participantId:t,collectionAssignments:r}=e;return t?"string"!=typeof t?(n.push("participantIds must be strings"),!1):Array.isArray(r)?r.every((e=>{if("object"!=typeof e)return n.push("collectionAssignments must be objects"),!1;const{collectionPosition:t}=e;return"number"==typeof t||(n.push("collectionPosition must be a number"),!1)})):(n.push(sa("collectionAssignments")),!1):(n.push("Missing participantId"),!1)})),i=P(e.map(Sl)).length===e.length;i||n.push("Duplicated participantId(s)");return{valid:r&&i,errors:n,error:n.length?xn:void 0}}function wy({drawDefinition:e,participantId:t,tieFormat:n,lineUp:r}){if("object"!=typeof e)return{error:Y};if("string"!=typeof t)return{error:Lt};const i=Sy({lineUp:r,tieFormat:n});if(!i.valid)return i;const{extension:a}=lc({element:e,name:_o}),o=a?.value||{};o[t]=gy({lineUp:r});return Js({element:e,extension:{name:_o,value:o}}),il({drawDefinition:e}),{...L}}function Py({inContextDrawMatchUps:e,inheritance:t=!0,tournamentRecord:n,drawDefinition:r,matchUpsMap:i,assignments:a,structure:o,event:s}){if(!r)return{error:Y};const{drawPositions:c,matchUps:u,targetMatchUps:d}=vy({inContextDrawMatchUps:e,matchUpsMap:i,assignments:a,structure:o});for(const p of d)p.matchUpType===Vi&&(p.sides||[]).forEach(((e,i)=>{if(e?.drawPosition&&c?.includes(e.drawPosition)){const a=u.find((({matchUpId:e})=>e===p.matchUpId));if(a?.sides?.[i]){if(delete a.sides[i].lineUp,!1===t){const t=p.tieFormat,n=e.participantId;t&&n&&wy({drawDefinition:r,participantId:n,lineUp:[],tieFormat:t})}rl({tournamentId:n?.tournamentId,context:"resetLineUps",eventId:s?.eventId,drawDefinition:r,matchUp:a})}}}));return{...L}}function Ty({provisionalPositioning:e,inContextDrawMatchUps:t,isQualifierPosition:n,sourceMatchUpStatus:r,tournamentRecord:i,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:c,drawPosition:u,matchUpsMap:d,structureId:p,event:l}){const m="assignDrawPosition";if(!s&&!n)return Mi({result:{error:Lt},stack:m});d=d||_p({drawDefinition:a}),t||({matchUps:t}=Cl({inContext:!0,drawDefinition:a,matchUpsMap:d}));const f=rp({drawDefinition:a,structureId:p});if(f.error)return Mi({result:f,stack:m});const{structure:h}=f;if(!h)return{error:De};if(Hp({drawDefinition:a,structure:h}))return Mi({result:{error:tt},stack:m});const{seedAssignments:I}=kp({provisionalPositioning:e,drawDefinition:a,structure:h}),g=I?.find((e=>e.participantId===s)),U=g?.seedNumber,{appliedPolicies:y}=Xo({tournamentRecord:i,drawDefinition:a,structure:h,event:l});if(U){if(!oU({seedNumber:U,appliedPolicies:y,drawDefinition:a,seedBlockInfo:c,drawPosition:u,structureId:p}))return Mi({result:{error:Z},context:{drawPosition:u},stack:m})}const v=sp({structure:h}).positionAssignments||[],S=v?.find((e=>e.drawPosition===u));if(!S)return Mi({result:{error:oe},context:{drawPosition:u},stack:m});const w=v?.map(Sl).includes(s);if(w)return Mi({result:{error:zt},context:{drawPosition:u},stack:m});const{containsParticipant:P,containsBye:T}=function(e){const t=e.bye,n=e.qualifier,r=e.participantId;return{containsBye:t,containsQualifier:n,containsParticipant:r,filled:t||n||r}}(S);if(T){const e=zU({inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:a,drawPosition:u,structureId:p,matchUpsMap:d,event:l});if(e.error)return Mi({result:e,stack:m})}if(P&&S.participantId!==s){const{activeDrawPositions:e}=eU({drawDefinition:a,structureId:p});if(e.includes(u))return Mi({result:{error:ae},stack:m});Py({assignments:[S],inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:a,matchUpsMap:d,structure:h})}if(S.participantId=s,n&&(S.qualifier=!0),(h?.stageSequence||0)>1||h.stage&&[id,od].includes(h.stage)){const t=h.stage===rd?rd:nd,n=a.structures?.find((e=>e?.stage===t&&1===e?.stageSequence)),r=(n?.seedAssignments||[]).find((e=>e.participantId===s));if(r?.participantId){const{participantId:t,seedNumber:n,seedValue:s}=r;yy({eventId:l?.eventId,provisionalPositioning:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,participantId:t,seedNumber:n,seedValue:s,structureId:p,event:l})}}if(h.structureType!==Id)!function({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:i,drawPosition:a,matchUpsMap:o,structure:s,event:c}){const u={isCollectionMatchUp:!1},{matchUps:d}=Kp({provisionalPositioning:e,matchUpFilters:u,drawDefinition:i,matchUpsMap:o,structure:s,event:c}),{roundMatchUps:p}=ed({matchUps:d}),{initialRoundNumber:l}=tU({drawPosition:a,matchUps:d}),m=l&&p?.[l].find((e=>e.drawPositions?.includes(a)));if(m){const e=cy({matchUpId:m.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:i,drawPosition:a,matchUpsMap:o});if(e.error)return Mi({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:e})}}({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:i,drawDefinition:a,drawPosition:u,matchUpsMap:d,structure:h,event:l});else{HU({positionAssignments:v,tournamentRecord:i,drawDefinition:a,matchUpsMap:d,structure:h});const{drawPositions:e,matchUps:n,targetMatchUps:r}=vy({assignments:[S],inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:d,structure:h});if(e&&1===n?.length&&n[0].matchUpType===ji){const t=(r?.[0].sides||[]).reduce(((t,n,r)=>e?.includes(n.drawPosition)?r:t),void 0);oy({inContextTargetMatchUp:r[0],teamParticipantId:s,matchUp:n[0],drawPositionSideIndex:t,tournamentRecord:i,drawDefinition:a})}}return sl({tournamentId:i?.tournamentId,drawDefinition:a,structure:h,event:l}),{positionAssignments:v,...L}}function Dy(e){const t=Iy(e);if(t.error)return t;const n=pl({matchUpStatus:e.matchUpStatus}),{dualWinningSideChange:r,projectedWinningSide:i,inContextDrawMatchUps:a,tournamentRecord:o,drawDefinition:s,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:p,targetData:m,matchUpId:f,structure:h,matchUp:I,event:g}=e,U="directParticipants",y=Boolean(I.collectionId),v=Hp({drawDefinition:s,structure:h});let S,w=I.drawPositions;if(y){const{matchUpTieId:t,matchUpsMap:n}=e,i=xl({matchUpId:t,tournamentRecord:o,drawDefinition:s,matchUpsMap:n,event:g});S=i&&{tieMatchUpResult:i};const c=a.find((({matchUpId:e})=>e===t));if(w=c?.drawPositions,!r)return Mi({result:{...L,...S},stack:U})}if(v)return Mi({result:{...L,...S},stack:U});if(!w)return Mi({result:{error:ie},stack:U});{const e=i?i-1:p-1,t=1-e,r=w[e],h=w[t],{targetLinks:{loserTargetLink:I,winnerTargetLink:y,byeTargetLink:v},targetMatchUps:{winnerMatchUpDrawPositionIndex:S,loserMatchUpDrawPositionIndex:P,winnerMatchUp:T,loserMatchUp:D,byeMatchUp:R}}=m;if(T){const e=function({winnerMatchUpDrawPositionIndex:e,inContextDrawMatchUps:t,projectedWinningSide:n,sourceMatchUpStatus:r,winningDrawPosition:i,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:c,winnerMatchUp:u,dualMatchUp:d,matchUpsMap:p,event:l}){const m="directWinner";if(o){const n=u.drawPositions||[],d=n[e],f=o.source.structureId,h=rp({structureId:f,drawDefinition:c});if(h.error)return h;const{structure:I}=h,{positionAssignments:g}=sp({structureId:f,drawDefinition:c}),U=g?.find((e=>e.drawPosition===i)),y=U?.participantId,v=o.target.structureId,{positionAssignments:S}=sp({structureId:v,drawDefinition:c}),w=S?.find((e=>e.participantId===y)),P=w?.drawPosition,T=S?.filter((e=>{const t=n.includes(e.drawPosition),r=!e.participantId&&!e.bye&&!e.qualifier;return t&&r})).map((e=>e.drawPosition)),D=T?.includes(d);if(y&&1===o.target.roundNumber&&D)Ty({drawPosition:d,participantId:y,structureId:v,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:c,matchUpsMap:p,event:l});else if(y&&T?.length){const e=T.pop();e&&Ty({participantId:y,structureId:v,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:c,drawPosition:e,matchUpsMap:p,event:l})}else if(P){const e=cy({drawPosition:P,matchUpId:u.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:c,matchUpsMap:p});if(e.error)return Mi({result:e,stack:m})}else if(I?.stage!==rd){const e="winner target position unavaiallble";return console.log(e),{error:e}}if(I?.seedAssignments&&I.structureId!==v){const e=I.seedAssignments.find((({participantId:e})=>e===y)),t=e?.participantId;e&&t&&yy({eventId:u?.eventId,structureId:v,...e,tournamentRecord:a,drawDefinition:c,participantId:t})}}else{const e=cy({matchUpId:u.matchUpId,drawPosition:i,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:c,matchUpsMap:p});if(e.error)return e}if(d&&n){const e=d.sides?.find((e=>e.sideNumber===n));if(e?.lineUp){const t=d.roundPosition,n=u.roundPosition,r=t===n&&1!==t||Math.floor(t/2)===n?2:1,i=p?.drawMatchUps?.find((({matchUpId:e})=>e===u.matchUpId)),o=[1,2].map((e=>({...i.sides?.find((t=>t.sideNumber===e))||{},sideNumber:e})));i.sides=o;const s=i.sides.find((e=>e.sideNumber===r));if(s){const t=e.lineUp?.filter((e=>e?.participantId));s.lineUp=gy({lineUp:t}),rl({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:i,context:m,drawDefinition:c})}}}return{...L}}({sourceMatchUpStatus:n&&c||ha,winnerMatchUpDrawPositionIndex:S,sourceMatchUpId:f,inContextDrawMatchUps:a,projectedWinningSide:i,winningDrawPosition:r,tournamentRecord:o,winnerTargetLink:y,drawDefinition:s,winnerMatchUp:T,dualMatchUp:u,matchUpsMap:d,event:g});if(e.error)return Mi({result:e,stack:U})}if(D){const e=function(e){const{loserMatchUpDrawPositionIndex:t,inContextDrawMatchUps:n,projectedWinningSide:r,sourceMatchUpStatus:i,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:c,loserMatchUp:u,dualMatchUp:d,matchUpsMap:p,event:m}=e,f="directLoser",h=s.linkCondition,I=u.drawPositions||[],g=h===Td&&2===u.roundNumber&&Math.min(...I.filter(Boolean)),U=g||I[t],y=g||I[1-t],v=s.source.structureId,{structure:S}=rp({structureId:v,drawDefinition:c}),{matchUps:w}=Kp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:S,event:m}),P=w.filter((e=>e.drawPositions?.includes(a))).filter((e=>{const t=e.sides.find((e=>e.drawPosition===a)),n=e.matchUpStatus===Ra||e.matchUpStatus===ga&&!dl(e);return t?.sideNumber===e.winningSide&&!n})),T=h===Td&&0===P.length,{positionAssignments:D}=sp({structureId:v,drawDefinition:c}),R=D?.find((e=>e.drawPosition===a)),b=R?.participantId,N=s.target.structureId,{positionAssignments:M}=sp({structureId:N,drawDefinition:c}),A=M?.filter((({drawPosition:e})=>I.includes(e))),E=A?.some((e=>e.participantId===b));if(E)return{...L};const C=A?.filter((e=>{const t=I.includes(e.drawPosition),n=!e.participantId&&!e.bye&&!e.qualifier;return t&&n})).map((e=>e.drawPosition)),O=C?.includes(U),F=s.target.roundNumber>1&&C?.length,k=1===s.target.roundNumber&&O;if(g){const e=function(){const e="loserLinkFedFMLC";return Mi(T?{result:_(),stack:e}:{result:x(),stack:e})}();if(e.error)return Mi({result:e,stack:f})}else if(k){const e=_();if(e.error)return Mi({result:e,stack:f})}else{if(!b||!F)return Mi({result:{error:oe},context:{loserDrawPosition:a,loserTargetLink:s},stack:f});{C.sort(l);const e=C[0],t=Ty({participantId:b,structureId:N,drawPosition:e,inContextDrawMatchUps:n,sourceMatchUpStatus:i,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:m});if(t.error)return Mi({result:t,stack:f})}}if(S?.seedAssignments&&S.structureId!==N){const e=S.seedAssignments.find((({participantId:e})=>e===b)),t=e?.participantId;e&&t&&yy({eventId:u?.eventId,structureId:N,...e,tournamentRecord:o,drawDefinition:c,participantId:t})}if(d&&r){const e=d.sides?.find((e=>e.sideNumber===3-r));if(e?.lineUp){const{roundNumber:t,eventId:n}=u,{roundPosition:r}=d,i=1===t?2-r%2:1,a=p?.drawMatchUps?.find((({matchUpId:e})=>e===u.matchUpId)),s=[1,2].map((e=>({...a.sides?.find((t=>t.sideNumber===e))||{},sideNumber:e})));a.sides=s;const l=a.sides.find((e=>e.sideNumber===i));l&&(l.lineUp=gy({lineUp:e.lineUp}),rl({tournamentId:o?.tournamentId,matchUp:a,context:f,drawDefinition:c,eventId:n}))}}return{...L};function x(){return Mi({result:ty({drawPosition:y,structureId:N,tournamentRecord:o,drawDefinition:c,event:m}),stack:"assignLoserPositionBye"})}function _(){return Mi({result:b?Ty({drawPosition:U,participantId:b,structureId:N,inContextDrawMatchUps:n,sourceMatchUpStatus:i,tournamentRecord:o,drawDefinition:c,matchUpsMap:p,event:m}):{error:Lt},stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:n&&c||ha,loserMatchUpDrawPositionIndex:P,sourceMatchUpId:f,inContextDrawMatchUps:a,projectedWinningSide:i,loserDrawPosition:h,tournamentRecord:o,loserTargetLink:I,drawDefinition:s,loserMatchUp:D,winningSide:p,matchUpsMap:d,dualMatchUp:u,event:g});if(e.error)return Mi({result:e,stack:U})}if(R){const e=R.drawPositions||[],t=ty({drawPosition:Math.min(...e.filter(Boolean)),structureId:v.target.structureId,tournamentRecord:o,drawDefinition:s,event:g});if(t.error)return Mi({result:t,stack:U})}}return Mi({result:{...L,...S},stack:U})}function Ry(e){const t="attemptToSetWinningSide";let n;const{appliedPolicies:r,disableAutoCalc:i,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:c,matchUp:u}=e;if(o?._disableAutoCalc&&!1!==i)return Iy(e);if(u.winningSide&&u.winningSide!==s){const{connectedStructureIds:t}=hy({drawDefinition:a,structure:c,matchUp:u});t.length&&(console.log({connectedStructureIds:t}),n=!0);const r=QU(e);if(r.error)return r}const d=Dy(e);if(d.error)return Mi({result:d,stack:t});let p,l;return e.qualifierChanging&&r?.[Io]?.autoReplaceQualifiers&&(p=function(e){let t;const{inContextDrawMatchUps:n,inContextMatchUp:r,drawDefinition:i,winningSide:a}=e,o=e.targetData.targetLinks?.winnerTargetLink;if(o.target.feedProfile===gd){const s=r.sides.find((({sideNumber:e})=>e!==a)).participantId,c=n.find((e=>e.structureId===o.target.structureId&&e.roundNumber===o.target.roundNumber&&e.sides.some((({participantId:e})=>e===s))));if(c?.matchUpStatus===Da&&!FI({inContextDrawMatchUps:n,drawDefinition:i,targetData:bl({matchUpId:c.matchUpId,inContextDrawMatchUps:n,drawDefinition:i})})){const{structure:n}=rp({structureId:c.structureId,drawDefinition:i}),o=op({structure:n}).positionAssignments;for(const c of o||[])if(c.participantId===s){const s=r.sides.find((({sideNumber:e})=>e===a)).participantId;if(c.participantId=s,n?.positionAssignments)n.positionAssignments=o;else if(n?.structures){const e=Object.assign({},...(o||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(const t of n.structures)t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}sl({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:i,structure:n}),t=!0}}}return{...L,qualifierReplaced:t}}(e).qualifierReplaced),e.qualifierAdvancing&&r?.[Io]?.autoPlaceQualifiers&&(l=function(e){let t;const{inContextDrawMatchUps:n,inContextMatchUp:r,drawDefinition:i,winningSide:a}=e,o=e.targetData.targetLinks?.winnerTargetLink;if(o.target.feedProfile===gd){const s=r.sides.find((({sideNumber:e})=>e===a))?.participantId,c=A(n.filter((e=>e.structureId===o.target.structureId&&e.roundNumber===o.target.roundNumber&&e.sides.some((({participantId:e,qualifier:t})=>t&&!e)))));if(c?.matchUpStatus===Da&&!FI({inContextDrawMatchUps:n,drawDefinition:i,targetData:bl({matchUpId:c.matchUpId,inContextDrawMatchUps:n,drawDefinition:i})})){const n=c.sides.find((e=>e.qualifier&&!e.participantId))?.drawPosition,{structure:r}=rp({structureId:c.structureId,drawDefinition:i});if(!r)return{error:De};const a=op({structure:r}).positionAssignments;for(const o of a||[])if(o.drawPosition===n&&!o.participantId){if(o.participantId=s,r.positionAssignments)r.positionAssignments=a;else if(r.structures){const e=Object.assign({},...(a||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(const t of r.structures)t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}sl({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:i,structure:r}),t=!0}}}return{...L,qualifierPlaced:t}}(e).qualifierPlaced),Mi({result:pi({...L,...d,connectedStructures:n,qualifierReplaced:p,qualifierPlaced:l}),stack:t})}const by={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Ny(e){const{inContextDrawMatchUps:t,appliedPolicies:n,drawDefinition:r,matchUpsMap:i,targetData:a,matchUp:o}=e;let{iteration:s=0}=e;s+=1;const c="removeDoubleExit";Uh({method:c,color:"brightyellow",iteration:s,keyColors:by});const{targetLinks:{loserTargetLink:u},targetMatchUps:{loserMatchUp:d,winnerMatchUp:p,loserTargetDrawPosition:l}}=a;if(p&&p.matchUpStatus!==ma){const{stage:t,roundNumber:n,roundPosition:r}=p;Uh({winner:"winner",stage:t,roundNumber:n,roundPosition:r,keyColors:by}),My({...e,targetMatchUp:p,sourceMatchUp:o,iteration:s})}if(d&&d.matchUpStatus!==ma){const a=t.find((({matchUpId:e})=>e===d.matchUpId)),{structure:o}=rp({drawDefinition:r,structureId:a.structureId}),{stage:p,roundNumber:m,roundPosition:f,feedRound:h}=d;if(Uh({loser:"loser",stage:p,roundNumber:m,roundPosition:f,keyColors:by,feedRound:h}),n?.progression?.doubleExitPropagateBye)XU({drawPosition:l,targetLink:u,inContextDrawMatchUps:t,drawDefinition:r,matchUpsMap:i});else{const t=My({...e,structure:o,targetMatchUp:d,iteration:s});if(t.error)return Mi({result:t,stack:c})}}return Mi({result:{...L},stack:c})}function My(e){const{inContextDrawMatchUps:t,appliedPolicies:n,drawDefinition:r,sourceMatchUp:i,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:c}=e,u="conditionallyRemoveDrawPosition";Uh({method:u});const d=bl({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:p}}=d,l=o?.drawMatchUps.find((e=>e.matchUpId===a.matchUpId));let m,f,h,I=[];if(a.feedRound){const e=p?.drawPositions?.filter(Boolean);h=e?.find((e=>a.drawPositions.includes(e)))}else if(i){f=qU({structureId:s.structureId,matchUp:i,matchUpsMap:o})?.pairedPreviousMatchUp,m=[ya,Ua].includes(f?.matchUpStatus),I=f?.drawPositions?.filter(Boolean)||[];if([...Ca,ma].includes(f?.matchUpStatus)||f?.winningSide){const e=i.drawPositions||[];let t=a.drawPositions?.filter(Boolean);k(e,t)&&(t=t?.filter((t=>!e.includes(t))));h=e.concat(I).find((e=>t?.includes(e)))}}else h=O(a?.drawPositions||[],p?.drawPositions||[])?.[0];if(p&&h){const{stage:e,roundNumber:n,roundPosition:i}=p;Uh({method:"removeDirectedWinner",drawPositionToRemove:h,keyColors:by,color:"brightgreen",stage:e,roundNumber:n,roundPosition:i}),JU({winningDrawPosition:h,winnerMatchUp:p,inContextDrawMatchUps:t,drawDefinition:r,matchUpsMap:o})}let g=Ny({targetData:d,matchUp:a,inContextDrawMatchUps:t,appliedPolicies:n,drawDefinition:r,matchUpsMap:o,structure:s,iteration:c});if(g.error)return Mi({result:g,stack:u});const U=function({pairedPreviousDoubleExit:e,noContextTargetMatchUp:t}){return t.matchUpStatus===ma?ma:e?[Ua,ga].includes(t?.matchUpStatus)?ga:Ra:Da}({pairedPreviousDoubleExit:m,noContextTargetMatchUp:l}),y=!m;return g=kl({...e,matchUpStatus:U,removeScore:y,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:l,matchUpId:a.matchUpId,matchUpStatusCodes:[]}),g.error?Mi({result:g,stack:u}):{...L}}function Ay(e){const{matchUp:t,matchUpStatus:n,score:r,winningSide:i}=e,a="noDownStreamDependencies";if([ya,Ua].includes(t?.matchUpStatus)&&![ya,Ua].includes(n)){const t=Ny(e);if(t.error)return Mi({result:t,stack:a})}const o=n===ya,s=dl({score:r})&&!o&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!i),c=e?.inContextMatchUp?.collectionId&&function(e){const{matchUpFormat:t,score:n}=e,r=n?.sets?.length,i=t&&gi(t),{setFormat:a,finalSetFormat:o,bestOf:s}=i||{},c=s&&r===s&&o||a;return c?.timed||!1}(e.inContextMatchUp),u=e.removeScore||!c&&![Sa,pa].includes(n||Sa),d=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||t.winningSide&&!i&&!dl({score:r}),p=n&&n!==Da,l=n=>{let r;const{structure:i,drawDefinition:a,dualMatchUp:o,disableAutoCalc:s}=e;if(o?._disableAutoCalc&&!1!==s)return Iy(e);const{connectedStructureIds:c}=hy({drawDefinition:a,structure:i,matchUp:t});c.length&&(console.log({connectedStructureIds:c}),r=!0),Object.assign(e,{removeScore:n});const u=QU(e);if(u.error)return u;if(e.removingQualifier&&e.appliedPolicies?.[Io]?.autoRemoveQualifiers){const t=function(e){let t;const{inContextDrawMatchUps:n,inContextMatchUp:r,drawDefinition:i}=e,a=e.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===gd){const o=r.sides?.find((({sideNumber:e})=>e===r.winningSide))?.participantId,s=n.find((e=>e.structureId===a.target.structureId&&e.roundNumber===a.target.roundNumber&&e.sides?.some((({participantId:e})=>e===o))));if(s?.matchUpStatus===Da&&!FI({inContextDrawMatchUps:n,drawDefinition:i,targetData:bl({matchUpId:s.matchUpId,inContextDrawMatchUps:n,drawDefinition:i})})){const{structure:n}=rp({structureId:s.structureId,drawDefinition:i}),r=op({structure:n}).positionAssignments;for(const a of r||[])if(a.participantId===o){if(a.participantId=void 0,n?.positionAssignments)n.positionAssignments=r;else if(n?.structures){const e=Object.assign({},...(r||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(const t of n?.structures||[])t.positionAssignments?.forEach((t=>t.participantId=e[t.drawPosition]))}sl({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:i,structure:n}),t=!0}}}return{qualifierRemoved:t}}(e);return{...L,connectedStructures:r,...t}}return{...L,connectedStructures:r}};if(d&&i&&e.isCollectionMatchUp)return Ey(e);const m=[fa,pa].includes(n)&&e.dualWinningSideChange;return Mi({result:(i||m)&&Ry(e)||s&&l(u)||p&&my(e)||d&&l(u)||t&&Ey({...e,removeScore:!0})||{...L},stack:a})}function Ey(e){if(e.isCollectionMatchUp&&e.dualMatchUp?.winningSide&&!e.projectedWinningSide){const t=QU(e);if(t.error)return t}const t=kl({...e});if(e.isCollectionMatchUp){const{matchUpTieId:t,drawDefinition:n,event:r,matchUpsMap:i}=e,{removeWinningSide:a}=xl({tournamentRecord:e.tournamentRecord,matchUpId:t,drawDefinition:n,matchUpsMap:i,event:r});a&&console.log("REMOVE WINNING SIDE")}return Mi({result:t,stack:"scoreModification"})}function Cy(e){const t="setMatchUpStatus";e.matchUpStatus&&[Ra,ya].includes(e.matchUpStatus)&&(e.score=void 0);const{allowChangePropagation:n,disableScoreValidation:r,tournamentRecords:i,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:c,matchUpStatus:u,winningSide:d,matchUpId:p,event:l,score:m}=e;if(!c)return{error:Y};if(u&&[fa,Sa,pa,Da].includes(u)&&d)return{error:xn,winningSide:d,matchUpStatus:u};if(![void 0,...Ma].includes(u))return Mi({result:{error:$e},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});const f=_p({drawDefinition:c}),{matchUps:h}=Cl({nextMatchUps:!0,inContext:!0,drawDefinition:c,matchUpsMap:f,event:l}),I=f.drawMatchUps.find((e=>e.matchUpId===p)),g=h?.find((e=>e.matchUpId===p));if(!I||!h)return{error:Xe};if((I.winningSide||d)&&u===ma)return{context:"Cannot have Bye with winningSide",error:qe,matchUpStatus:u};const U=g?.structureId,{structure:y}=rp({drawDefinition:c,structureId:U}),v=g?.drawPositions?.filter(Boolean);let S;if(I.matchUpType===ji){if(o)Js({extension:{name:Co,value:!0},element:I});else if(s){const t=I.winningSide;ec({name:Co,element:I});const{winningSide:n,scoreStringSide1:r,scoreStringSide2:i,set:a}=Zp({drawDefinition:c,matchUpsMap:f,structure:y,matchUp:I,event:l}),o={scoreStringSide1:r,scoreStringSide2:i,sets:a?[a]:[]};S=n!==t,Object.assign(e,{winningSide:n,dualWinningSideChange:S,projectedWinningSide:n,score:o})}cl({tournamentId:a?.tournamentId,inContextDualMatchUp:g,eventId:l?.eventId,drawDefinition:c,dualMatchUp:I})}if(I.matchUpType===ji&&u&&[la].includes(u))return{error:xn,info:"Not supported for matchUpType: TEAM"};const w=g?.matchUpTieId,P=bl({matchUpId:w||p,inContextDrawMatchUps:h,drawDefinition:c});if(m&&I.matchUpType!==ji&&!r){const e=I.matchUpFormat??y?.matchUpFormat??c?.matchUpFormat??l?.matchUpFormat,t=Bl({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:e,matchUpStatus:u,winningSide:d,score:m});if(t.error)return t}const T=I?.sides?[]:op({drawDefinition:c,structureId:U}).positionAssignments,D=2===I.sides?.map((e=>e.participantId)).filter(Boolean).length||2===v?.length&&T?.filter((e=>v.includes(e.drawPosition))).every((e=>e.participantId));if(u&&Na.includes(u)&&!D)return Mi({info:"present in participantRequiredMatchUpStatuses",context:{matchUpStatus:u,bothSideParticipants:D},result:{error:$e}});const R=Xo({policyTypes:[Io],tournamentRecord:a,drawDefinition:c,event:l})?.appliedPolicies??{};"object"==typeof e.policyDefinitions&&Object.assign(R,e.policyDefinitions);const b=g?.stage===rd&&1===g.finishingRound,N=b&&d,M=b&&I.winningSide&&!d&&(!e.matchUpStatus||e.matchUpStatus&&ll({matchUpStatus:e.matchUpStatus}))&&(!e.outcome||!dl({outcome:e.outcome})),A=N&&d!==I.winningSide&&I.winningSide;if(Object.assign(e,{inContextDrawMatchUps:h,qualifierAdvancing:N,qualifierChanging:A,removingQualifier:M,inContextMatchUp:g,appliedPolicies:R,matchUpTieId:w,matchUpsMap:f,targetData:P,structure:y,matchUp:I}),w){const{matchUp:t}=Qp({matchUpId:w,inContext:!0,drawDefinition:c,matchUpsMap:f,event:l});if(t){const n=Ni({matchUp:t,drawDefinition:c,structure:y,event:l})?.tieFormat,{projectedWinningSide:r}=function({drawDefinition:e,matchUpStatus:t,matchUpsMap:n,winningSide:r,dualMatchUp:i,tieFormat:a,structure:o,matchUp:s,event:c,score:u}){const d=ii(i,void 0,!0);for(const l of d?.tieMatchUps||[])l.matchUpId===s.matchUpId&&(l.winningSide=r,l.score=u,dl({score:u})||t?t&&(l.matchUpStatus=t):Object.assign(l,{...Fl}));a=a||Ni({matchUp:s,structure:o,drawDefinition:e,event:c})?.tieFormat;const{winningSide:p}=Zp({matchUp:d,drawDefinition:e,matchUpsMap:n,structure:o,tieFormat:a,event:c});return{projectedWinningSide:p}}({drawDefinition:c,matchUpStatus:u,dualMatchUp:t,matchUpsMap:f,winningSide:d,tieFormat:n,structure:y,matchUp:I,event:l,score:m});S=r!==t.winningSide,Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:S,projectedWinningSide:r,matchUpTieId:w,dualMatchUp:t,tieFormat:n})}}const E=FI(e),C=pl({matchUpStatus:u});if(!w){if(E&&!d&&(u&&ll({matchUpStatus:u})||u&&[ya,Ua].includes(u)))return{error:qe,activeDownstream:E,winningSide:d};if(d&&d===I.winningSide&&u&&!C)return{context:"winningSide must include directing matchUpStatus",error:qe,directingMatchUpStatus:C,matchUpStatus:u}}const{schedule:O}=e;if(O){const e=EU({disableNotice:!0,tournamentRecords:i,tournamentRecord:a,drawDefinition:c,matchUpId:p,schedule:O});if(e.error)return e}const F=I.matchUpType!==ji&&!S&&d&&I.winningSide&&I.winningSide!==d;if(n&&F&&I.roundPosition)return function(e){const{tournamentRecord:t,inContextMatchUp:n,structure:r,drawDefinition:i}=e,a=n.roundNumber,o=n.sides.find((e=>e.sideNumber===n.winningSide)),s=n.sides.find((e=>e.sideNumber!==n.winningSide)),{drawPosition:c,participantId:u}=o,{drawPosition:d,participantId:p}=s,{matchUps:l}=Kp(e),m=l.filter((({drawPositions:e,roundNumber:t})=>e?.includes(c)&&t>a));ar({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach((n=>{n.drawPositions=n.drawPositions?.map((e=>e===c?d:e))||[],rl({tournamentId:t?.tournamentId,eventId:e.event?.eventId,context:"swapWinnerLoser",drawDefinition:i,matchUp:n})}));const{stage:f,stageSequence:h}=r,I=i.structures.filter((({stage:e,stageSequence:t})=>e===f&&t>h)).map((({structureId:e})=>e)),{targetLinks:{loserTargetLink:g,winnerTargetLink:U}}=e.targetData,y=[g?.target.structureId,U?.target?.structureId].filter(Boolean);return i.structures.filter((({stage:e,structureId:t})=>e!==f&&y.includes(t))).forEach((({stage:e,stageSequence:t,structureId:n})=>{I.includes(n)||I.push(n),i.structures.filter((({stage:n,stageSequence:r})=>n===e&&r>t)).forEach((({structureId:e})=>{I.includes(e)||I.push(e)}))})),i.structures.filter((({structureId:e})=>I.includes(e))).forEach((e=>{const{positionAssignments:t}=op({structure:e}),n=t?.find((({participantId:e})=>e===u)),r=t?.find((({participantId:e})=>e===p));n&&(n.participantId=p),r&&(r.participantId=u)})),kl(e)}(e);const k=d&&!w||e.projectedWinningSide;Uh({method:t,activeDownstream:E,matchUpWinner:k,winningSide:d});const x=!E&&Ay(e)||k&&function(e){const{matchUp:t,winningSide:n,matchUpTieId:r,dualWinningSideChange:i}=e;return n===t.winningSide||r&&!i?Oy(e):Mi({stack:"winningSideWithDownstreamDependencies",result:{error:Mt},context:{winningSide:n,matchUp:t}})}(e)||C&&Oy(e)||{error:Bn};return Mi({result:x,stack:t})}function Oy(e){const{tournamentRecord:t,matchUp:n,event:r}=e,i=e.isCollectionMatchUp&&n.winningSide&&!e.winningSide&&!dl({score:e.score}),a=e.isCollectionMatchUp?e.matchUpStatus||i&&Da||ha:e.matchUpStatus||ha,o=e.removeScore||[fa,Ra].includes(a)&&![Sa,pa].includes(a),s=kl({...e,matchUpStatus:a,removeWinningSide:i,removeScore:o});if(s.error)return s;if(e.isCollectionMatchUp){const{matchUpTieId:n,drawDefinition:i,matchUpsMap:a}=e,o=xl({matchUpId:n,tournamentRecord:t,drawDefinition:i,matchUpsMap:a,event:r});if(o.error)return o;Object.assign(s,{tieMatchUpResult:o})}return s}function Fy(e){let t=e.structureIds;const{tournamentRecord:n,drawDefinition:r,matchUpFormat:i,structureId:a,matchUpId:o,event:s}=e;if(!r)return{error:Y};if(!i)return{error:ze};if(!Ti(i))return{error:Ge};if(o){const e=Qp({drawDefinition:r,matchUpId:o,event:s});if(e.error)return e;if(!e.matchUp)return{error:Xe};const t=e.matchUp;if(t?.matchUpType===_u)return{error:tt,info:"Cannot set matchUpFormat when { matchUpType: TEAM }"};t.matchUpFormat=i,rl({tournamentId:n?.tournamentId,eventId:s?.eventId,context:"setMatchUpFormat",drawDefinition:r,matchUp:t})}else if(Array.isArray(t)){if(s?.eventType===_u)return{error:Me};for(const e of t){const t=rp({drawDefinition:r,structureId:e});if(t.error)return t;if(!t.structure)return{error:De};t.structure.matchUpFormat=i}}else if(a){if(s?.eventType===_u)return{error:Me};const e=rp({drawDefinition:r,structureId:a});if(e.error)return e;if(!e.structure)return{error:De};e.structure.matchUpFormat=i}else r&&(r.matchUpFormat=i);return t=t||(a?[a]:void 0),al({drawDefinition:r,structureIds:t}),{...L}}function ky(e){const{matchUpFormat:t,matchUpStatus:n,winningSide:r,score:i}=e;if(!i)return{sets:[]};const a=i.sets||[];let o=_l({winnerFirst:!1,matchUpFormat:t,matchUpStatus:n,sets:a}),s=_l({winnerFirst:!1,reversed:!0,matchUpFormat:t,matchUpStatus:n,sets:a});const c=_l({matchUpFormat:t,matchUpStatus:n,winningSide:r,sets:a}),u=o===c?s:o;return r&&(o=1===r?c:u,s=2===r?c:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function xy(e){const{tournamentRecords:t,policyDefinitions:n,tournamentRecord:r,disableAutoCalc:i,enableAutoCalc:a,drawDefinition:o,matchUpFormat:s,matchUpId:c,schedule:u,event:d,notes:p}=e;if(!o)return{error:le};if(!c)return{error:Qe};const{policy:l}=fs({policyType:vo,tournamentRecord:r,event:d}),m=void 0!==e.allowChangePropagation&&e.allowChangePropagation||void 0!==l?.allowChangePropagation&&l.allowChangePropagation||void 0,{outcome:f}=e;if(s){const e=Fy({tournamentRecord:r,drawDefinition:o,matchUpFormat:s,matchUpId:c,event:d});if(e.error)return e}if(f?.score?.sets&&!f.score.scoreStringSide1){const{score:e}=ky(f);f.score=e,f.score.sets=f.score.sets.filter((e=>e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore))}return Cy({matchUpStatusCodes:f?.matchUpStatusCodes,matchUpStatus:f?.matchUpStatus,winningSide:f?.winningSide,allowChangePropagation:m,score:f?.score,tournamentRecords:t,policyDefinitions:n,tournamentRecord:r,disableAutoCalc:i,enableAutoCalc:a,drawDefinition:o,matchUpFormat:s,matchUpId:c,schedule:u,event:d,notes:p})}function _y(e){if(!e.tournamentRecord)return{error:$};const{tournamentRecords:t,tournamentRecord:n,outcomes:r,policyDefinitions:i}=e,a={};r.forEach((e=>{const{eventId:t}=e;a[t]||(a[t]=[]),a[t].push(e)}));for(const o of Object.keys(a)){const{event:e}=Qs({tournamentRecord:n,eventId:o});for(const r of a[o]){const{drawId:a}=r,o=e?.drawDefinitions?.find((e=>e.drawId===a));if(o&&a){const{matchUpFormat:s,matchUpId:c}=r,u=xy({schedule:r?.schedule,tournamentRecords:t,policyDefinitions:i,tournamentRecord:n,drawDefinition:o,matchUpFormat:s,matchUpId:c,outcome:r,drawId:a,event:e});if(u.error)return u}}}return{...L}}function Ly(e){const{flight:t,suppressNotifications:n,modifyEventEntries:r,existingDrawCount:i,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:c,event:u}=e;if(!c)return{error:le};if(!u)return{error:Ae};u.drawDefinitions||(u.drawDefinitions=[]);const{drawId:d,drawName:p,entries:l}=c,{entries:f}=u;let h=0;if(void 0!==i&&i!==u.drawDefinitions.length)return{error:xn,info:"drawDefintions count mismatch"};const{flightProfile:I}=Ks({event:u}),g=t&&I?.flights?.find((e=>e.flightNumber===t.flightNumber)),U=I?.links?.find((e=>e?.target?.drawId===d))?.source?.drawId;if(U&&!u.drawDefinitions.find((e=>e.drawId===U)))return Mi({result:{error:Y},info:{sourceDrawId:U}});if(g&&g.drawId!==c.drawId)return Mi({result:{error:z},info:{relevantFlight:g}});const y=l?.every((({participantId:e,entryStatus:t})=>{const n=g?.drawEntries.find((t=>t.participantId===e));return!t||n?.entryStatus===t})),v=!o||f&&l?.every((({participantId:e,entryStatus:t,entryStage:n})=>{const r=f.find((t=>t.participantId===e&&(!t.entryStage||t.entryStage===n)));return r?.entryStatus===t}));if(g&&!y)return Mi({result:{error:z},context:{drawEntriesPresentInFlight:y,matchingEventEntries:v,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&l?.filter(Boolean).forEach((e=>{if(e?.entryStatus&&bp.includes(e?.entryStatus)){const t=f?.filter(Boolean).find((t=>t.participantId===e.participantId));t&&e.entryStatus&&t?.entryStatus!==e.entryStatus&&(t.entryStatus=e.entryStatus,h+=1)}})),f&&!v)return Mi({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:v,eventEntries:f},error:z}});const S=I?.flights?.map((({flightNumber:e})=>!isNaN(e)&&m(e)))?.filter(Boolean)||[],w=u.drawDefinitions.map((({drawOrder:e})=>e&&m(e)))?.filter(Boolean)||[];let P=Math.max(0,...w,...S)+1;const T=I?.flights?.find((e=>e.drawId===d));let D;if(T){T.drawName=c.drawName,D={name:ko,value:{...I,flights:I.flights}};const e=T.flightNumber;e&&!w.includes(e)?P=e:T.flightNumber=P}else{const e=I?.flights||[];e.push({manuallyAdded:!0,flightNumber:P,drawEntries:l,drawName:p,drawId:d}),D={name:ko,value:{...I||{},flights:e}}}rc({event:u,extension:D}),Object.assign(c,{drawOrder:P});const R=u.drawDefinitions.find((e=>e.drawId===d)),b=s?.tournamentId,N=u.eventId;if(R){if(!a)return{error:me};const e=ih({drawDefinition:R})?.matchUps,t=e?.map(Pl)??[],r=ih({drawDefinition:c})?.matchUps;if(!n){t?.length&&nl({matchUpIds:t,action:"modifyDrawDefinition",tournamentId:b,eventId:N}),r?.length&&tl({matchUps:r,tournamentId:b,eventId:N}),u.drawDefinitions=u.drawDefinitions.map((e=>e.drawId===d?c:e));const e=c.structures?.map((({structureId:e})=>e));al({drawDefinition:c,tournamentId:b,structureIds:e,eventId:N})}}else if(u.drawDefinitions.push(c),!n){const{matchUps:e}=ih({drawDefinition:c,event:u});e&&tl({tournamentId:s?.tournamentId,matchUps:e}),il({drawDefinition:c,tournamentId:b,eventId:N})}return{...L,modifiedEventEntryStatusCount:h}}function By({allowDuplicateParticipantIdPairs:e,returnParticipant:t,tournamentRecord:n,disableNotice:r,pairOverride:i,participant:a}){const o="addParticipant";if(!n)return{error:$};if(!a)return Mi({result:{error:xt},stack:o});a.participantId||(a.participantId=Ii()),n.participants||(n.participants=[]);const{participantId:s,individualParticipantIds:c}=a;if(n.participants.reduce(((e,t)=>t.participantId===s||e),!1))return{error:Vt};const{participantType:u,participantRole:d}=a;if(!u||!Object.keys(Qu).includes(u))return{error:Ft,participantType:u};if(!d)return{error:kt};const p=n.participants||[],l=p.filter((e=>e.participantType===qu)).map((e=>e.participantId));if(u!==qu&&a.person)return{error:xn,person:a.person};if(c&&!Array.isArray(c))return{error:xn,individualParticipantIds:c};if(u===Wu){if(a.person)return{error:xn,person:a.person};if(!a.individualParticipantIds)return Mi({result:{error:Gt},stack:o});if(2!==a.individualParticipantIds.length&&!i)return Mi({info:"PAIR must be 2 individualParticipantIds",result:{error:Ct},stack:o});{const e=p.filter((e=>e.participantType===qu)).map((e=>e.participantId));if(!Array.isArray(a.individualParticipantIds))return Mi({result:{error:Ct},stack:o});if(!a.individualParticipantIds.reduce(((t,n)=>e.includes(n)&&t),!0))return Mi({result:{error:Ct},stack:o})}const n=p.filter((e=>e.participantType===Wu)).map((e=>({individualParticipantIds:e.individualParticipantIds,participant:e}))),r=a.participantType===Wu&&n.find((e=>2===O(e.individualParticipantIds,a.individualParticipantIds).length));if(r&&!e)return{...L,existingParticipant:!0,participant:t&&ii(r.participant)};if(!a.participantName){const e=p.filter((e=>a.individualParticipantIds?.includes(e.participantId)));let t=e.map((e=>e.person?.standardFamilyName)).filter(Boolean).join("/");1===e.length&&(t+="/Unknown"),a.participantName=t}}else if(u===qu){if(!a.person?.standardFamilyName||!a.person?.standardGivenName)return{error:Ht};if(!a.participantName){const e=`${a.person.standardFamilyName.toUpperCase()}, ${a.person.standardGivenName}`;a.participantName=e}}else{if(!u||![Hu,$u].includes(u))return{error:Ft};if(c||(a.individualParticipantIds=[]),a.individualParticipantIds?.length)for(const e of a.individualParticipantIds){if("string"!=typeof e)return Mi({result:{participantId:e,error:xn},stack:o});if(!l.includes(e))return Mi({result:{participantId:e,error:Bt},stack:o})}}n.participants.push(a),r||pr({payload:{tournamentId:n.tournamentId,participants:[a]},topic:Ic});return pi({participant:t&&ii(a),...L})}function Vy({allowDuplicateParticipantIdPairs:e,returnParticipants:t,participants:n,tournamentRecord:r}){if(!r)return{error:$};r.participants||(r.participants=[]);const i=r.participants.map((e=>e.participantId))||[];n.forEach((e=>{e.participantId||(e.participantId=Ii())}));const a=n.filter((e=>!i.includes(e.participantId))),o=n.filter((e=>i.includes(e.participantId))),s=a.filter((e=>e.participantType===qu)),c=a.filter((e=>e.participantType!==qu)),u=s.concat(...c),d=[];if(u.length){for(const t of u){const n=By({allowDuplicateParticipantIdPairs:e,returnParticipant:!0,disableNotice:!0,tournamentRecord:r,participant:t});if(n.error)return n;n.success&&!n.existingParticipant&&d.push(n.participant)}d.length&&pr({topic:Ic,payload:{tournamentId:r.tournamentId,participants:d}});const n={participants:t&&ii(d),addedCount:d.length,...L};return o.length&&Object.assign(n,{notAdded:o,info:Yt}),pi(n)}return{info:"No new participants to add",addedCount:0,...L}}const jy=({penaltyId:e=Ii()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:e});function Gy({refereeParticipantId:e,tournamentRecord:t,participantIds:n,penaltyCode:r,penaltyType:i,extensions:a,penaltyId:o,matchUpId:s,issuedAt:c,notes:u}){if(!t)return{error:$};if(!n)return{error:Lt};if(!i)return{error:on};const d=(t?.participants??[]).filter((e=>n.includes(e.participantId)));if(!d.length)return{error:Bt};const p=(new Date).toISOString(),l=Object.assign(jy({penaltyId:o}),{refereeParticipantId:e,penaltyCode:r,penaltyType:i,matchUpId:s,notes:u,issuedAt:c,createdAt:p});return Array.isArray(a)&&a.forEach((e=>Js({element:l,extension:e}))),d.forEach((e=>{e.penalties||(e.penalties=[]),e.penalties.push(l)})),pr({topic:Nc,payload:{tournamentId:t.tournamentId,participants:d}}),{...L,penaltyId:l.penaltyId}}function qy({tournamentRecord:e,penaltyId:t}){if(!e)return{error:$};if(!t)return{error:sn};const n=[];let r,i=!1;return(e?.participants??[]).forEach((e=>{let a=!1;e.penalties=(e.penalties??[]).filter((o=>(o.penaltyId===t&&(a=!0,i||(r=o,i=!0)),a&&n.push(e),o.penaltyId!==t)))})),r&&pr({topic:Nc,payload:{tournamentId:e.tournamentId,participants:n}}),r?{...L,penalty:r}:{error:cn}}function $y({tournamentRecord:e}){if(!e)return{error:$};const t=(e?.participants??[]).reduce(((e,t)=>{const{participantId:n}=t;return(t.penalties??[]).forEach((t=>{const{penaltyId:r}=t||{};e[r]?e[r].participants.push(n):e[r]={...t,participantIds:[n]}})),e}),{});return{penalties:Object.values(t)}}function Wy({tournamentRecord:e,modifications:t,penaltyId:n}){if(!e)return{error:$};if(!t)return{error:xn,modifications:t};if(!n)return{error:sn};const r=e?.participants??[],i=Object.keys(jy()).filter((e=>"penaltyId"!==e)),a=Object.keys(t).filter((e=>i.includes(e)));if(!a.length)return{error:Vn};let o;const s=[];return r.forEach((e=>{let r=!1;e.penalties=(e.penalties??[]).map((e=>(e.penaltyId===n&&(r=!0,a.forEach((n=>Object.assign(e,{[n]:t[n]}))),o||(o=e)),e))),r&&s.push(e)})),o&&pr({topic:Nc,payload:{tournamentId:e.tournamentId,participants:s}}),o?{...L,penalty:o}:{error:cn}}function Hy({drawDefinition:e,structureId:t,matchUpId:n,structure:r,matchUp:i,eventId:a,event:o}){const s="getTieFormat";let c;if(t=r?.structureId??t,((n=i?.matchUpId??n)||t)&&!e)return{error:Y};if(a&&o)c=Ri(o);else if(n){if(e&&(!i||!r)){const t=Qp({drawDefinition:e,matchUpId:n});if(t.error)return t;if(t.matchUp?.matchUpType!==Vi)return Mi({result:{error:tt},stack:s});r||(r=t.structure),i||(i=t.matchUp)}c=bi({item:i,drawDefinition:e,structure:r,event:o})||bi({item:r,drawDefinition:e,structure:r,event:o})||Ri(e)||Ri(o)}else if(e&&t){if(!r){const n=rp({drawDefinition:e,structureId:t});if(n.error)return n;r=n?.structure}c=bi({item:r,drawDefinition:e,structure:r,event:o})||Ri(e)||Ri(o)}else c=Ri(e)||Ri(o);return c?{...L,structure:r,tieFormat:c,matchUp:i}:Mi({result:{error:Ke},stack:s})}function zy({drawDefinition:e,auditData:t}){const{extension:n}=lc({name:Ko,element:e});Js({element:e,extension:{name:Ko,value:Array.isArray(n?.value)?n?.value.concat(t):[t]}})}function Yy({tieFormat:e,isMock:t,uuids:n}){const{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map((e=>Ky({collectionDefinition:e,uuids:n,isMock:t}))).filter(Boolean).flat()}}function Ky({collectionPositionOffset:e=0,collectionDefinition:t,matchUpsLimit:n,isMock:r,uuids:i}){const{matchUpCount:a,matchUpType:o,collectionId:s,processCodes:c}=t||{};return E(0,n??a??0).map((t=>{const n=e+t+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:i?.pop()||Ii(),matchUpStatus:Ki.ToBePlayed,collectionPosition:n,collectionId:s,processCodes:c,matchUpType:o,isMock:r}}))}function Qy({matchUp:e,updateInProgressMatchUps:t}){return!e.winningSide&&![Ca].includes(e.matchUpStatus)&&(t||e.matchUpStatus!==va&&!dl(e))}function Jy({from:e,to:t}){const n=Object.keys(e),r=O(n,Object.keys(t)).length===n.length,i=n.filter((n=>e[n]!==t[n])).map((n=>({countChange:t[n]-e[n],collectionId:n}))),a=n.every((n=>e[n]===t[n]));return{equivalent:r&&a,matchUpsCountChanges:i}}function Xy({check:e,matchUp:t}){let n="";const r=[];return{changesArePossible:e.matchUpsCountChanges.every((({collectionId:e,countChange:i})=>{const a=t.tieMatchUps.filter((t=>t.collectionId===e&&t.matchUpStatus===Da)).map(di("matchUpId")),o=a.length+i>=0||i>0;return!o&&i<0&&(n="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:a,collectionId:e,countChange:i}),o})),changes:r,cannotChangeReaon:n}}function Zy({updateInProgressMatchUps:e=!1,tournamentRecord:t,collectionOrder:n,collectionName:r,tieFormatName:i,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:c,matchUpType:u,structureId:d,matchUpId:p,category:l,eventId:m,gender:f,event:h,collectionValueProfiles:I,collectionValue:g,matchUpValue:U,scoreValue:y,setValue:v}){const w="modifyCollectionDefinition";if(o&&!Ti(o))return Mi({result:{error:xn},context:{matchUpFormat:o},stack:w});if(r&&"string"!=typeof r)return Mi({result:{error:xn},context:{collectionName:r},stack:w});if(f&&!Object.values(ki).includes(f))return Mi({result:{error:xn},context:{gender:f},stack:w});if(l&&"object"!=typeof l)return Mi({result:{error:xn},context:{category:l},stack:w});const P={collectionValueProfiles:I,collectionValue:g,matchUpValue:U,scoreValue:y,setValue:v};if(!(Object.values(P).filter(Boolean).length||n||r||o||s||u))return Mi({result:{error:mt},stack:w});if(Object.values(P).filter(Boolean).length>1)return Mi({info:"Only one value assignment allowed per collectionDefinition",result:{error:xn},stack:w});let T=Hy({drawDefinition:a,structureId:d,matchUpId:p,eventId:m,event:h});if(T.error)return Mi({result:T,stack:w});const{matchUp:D,structure:b,tieFormat:N}=T,M=ul(N),A=N?.collectionDefinitions.find((e=>e.collectionId===c)),E=M?.collectionDefinitions.find((e=>e.collectionId===c));if(!A)return Mi({info:"source collectionDefinition",result:{error:Gn},context:{collectionId:c},stack:w});const C=g??U??y??v;if(I){const e=da({matchUpCount:s??A?.matchUpCount,collectionValueProfiles:I});if(e.errors)return Mi({result:{error:xn},info:e.errors,stack:w})}else if(C&&!S(C))return Mi({result:{error:xn},info:"value is not an integer",context:{value:C},stack:w});const F=I&&(!A.collectionValueProfiles||(k=A.collectionValueProfiles,x=I,!(O(Object.keys(k),Object.keys(x)).length===Object.keys(k).length&&O(Object.values(k),Object.values(x)).length===Object.values(k).length)));var k,x;const _=[];if((S(g)&&A.collectionValue!==g||S(U)&&A.matchUpValue!==U||S(y)&&A.scoreValue!==y||S(v)&&A.setValue!==v||F)&&(E.collectionValueProfiles=void 0,E.collectionValue=void 0,E.matchUpValue=void 0,E.scoreValue=void 0,E.setValue=void 0,Object.assign(E,P),_.push({collectionId:c,...pi(P)})),(S(y)||S(v))&&E.collectionGroupNumber){const e=E.collectionGroupNumber;M.collectionDefinitions=M.collectionDefinitions.map((t=>{const{collectionGroupNumber:n,...r}=t;return n===e?r:t})),M.collectionGroups=M.collectionGroups.filter((({groupNumber:t})=>t!==e)),_.push({collectionId:c,change:"collectionGroupNumber removed"})}const{aggregateValue:B,valueGoal:V}=vh(M),j=pi({aggregateValue:B,valueGoal:V});if(j.aggregateValue===N?.winCriteria.aggregateValue&&j.valueGoal===N?.winCriteria.valueGoal||(M.winCriteria=j,_.push({collectionId:c,winCriteria:j})),S(n)&&A.collectionOrder!==n&&(E.collectionOrder=n,_.push({collectionId:c,collectionOrder:n})),r&&A.collectionName!==r&&(E.collectionName=r,_.push({collectionId:c,collectionName:r})),o&&A.matchUpFormat!==o&&(E.matchUpFormat=o,_.push({collectionId:c,matchUpFormat:o})),S(s)&&A.matchUpCount!==s&&(E.matchUpCount=s,_.push({collectionId:c,matchUpCount:s})),u&&A.matchUpType!==u)return Mi({result:{error:qn},context:{matchUpType:u},stack:w});l&&A.category!==l&&(E.category=l,_.push({collectionId:c,category:l})),f&&A.gender!==f&&(E.gender=f,_.push({collectionId:c,gender:f}));const G=pi(M);if(T=ca({tieFormat:G,eventType:h?.eventType}),T.error)return Mi({result:T,stack:w});if(!_.length)return Mi({result:{...L,modifications:_}});if(N?.tieFormatName!==i?(G.tieFormatName=i,_.push({tieFormatName:i})):_.length&&(delete G.tieFormatName,_.push("tieFormatName removed: modifications without new tieFormatName")),T=function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:n,structure:r,tieFormat:i,eventId:a,matchUp:o,event:s,uuids:c}){const u="updateTieFormat",d=t?.tournamentId;let p=0,l=0,m=0,f=0;const h=i?.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{}),I=({tieFormat:e})=>{const t=e?.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{});return Jy({from:t,to:h}).equivalent},g=Hy({drawDefinition:n})?.tieFormat,U=Hy({event:s})?.tieFormat;if(s&&a){for(const e of s.drawDefinitions??[])y({drawDefinition:e});s.tieFormat=ul(i),f+=1}else if(o){if(!o.tieMatchUps)return Mi({result:{error:tt},stack:u});const t=R(o.tieMatchUps?.map((({collectionId:e})=>e))),r=Jy({to:h,from:t}),{changes:a,changesArePossible:p,cannotChangeReaon:m}=Xy({matchUp:o,check:r});if(r.equivalent){if(!Qy({matchUp:o,updateInProgressMatchUps:e}))return Mi({result:{error:Rt},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});o.tieFormat=ul(i),f+=1}else{if(!p)return Mi({context:{collectionMap:h,matchUpMap:t},result:{error:We},info:m||"specified changes not possible",stack:u});S({tieFormat:i,matchUp:o,changes:a,uuids:c})}l+=1,rl({eventId:s?.eventId,context:u,drawDefinition:n,tournamentId:d,matchUp:o})}else if(r){const e=g??U,t=v({inheritedTieFormat:e,structure:r})?.modifiedMatchUpsCount;t&&(l+=t,p+=1,f+=1);const a=!r.tieFormat||Eh({ancestor:r.tieFormat,descendant:i}).different;a&&(r.tieFormat=ul(i),p+=1,f+=1),(t||a)&&n&&al({structureIds:[r.structureId],eventId:s?.eventId,drawDefinition:n})}else{if(!n)return{error:Y};y({drawDefinition:n}),n.tieFormat=ul(i),f+=1}return{modifiedStructuresCount:p,modifiedMatchUpsCount:l,addedMatchUpsCount:m,modifiedCount:f,...L,tieFormat:i};function y({drawDefinition:e}){const t=e.structures||[],n=[];for(const r of t){if(r.tieFormat)continue;const e=U,t=v({inheritedTieFormat:e,structure:r})?.modifiedMatchUpsCount;if(t){p+=1,l+=t;const e=r.structureId;n.push(e)}}return al({structureIds:n,eventId:s?.eventId,drawDefinition:e}),n.length}function v({inheritedTieFormat:r,structure:o}){let s=0;const d=Kp({matchUpFilters:{matchUpTypes:[ji]},structure:o})?.matchUps||[];for(const p of d){const o=Qy({matchUp:p,updateInProgressMatchUps:e});let d=!1;const l=Jy({from:R(p.tieMatchUps?.map((({collectionId:e})=>e))),to:h});if(l.equivalent)p.tieFormat&&I(p)&&o&&(p.tieFormat=ul(i),d=!0);else{const{changes:e,changesArePossible:t}=Xy({matchUp:p,check:l});if(t&&!p.tieFormat)S({changes:e,matchUp:p,tieFormat:i,uuids:c});else{if(!r)return Mi({result:{error:Ke},stack:u});(!p.tieFormat||Eh({ancestor:r,descendant:p.tieFormat}).different)&&(p.tieFormat=r,d=!0)}}d&&(s+=1,rl({tournamentId:t?.tournamentId,drawDefinition:n,context:u,eventId:a,matchUp:p}))}return{modifiedMatchUpsCount:s}}function S({uuids:e,matchUp:t,tieFormat:r,changes:i}){t.tieFormat=ul(r);const o=[],s=[];return i.forEach((n=>{if(n.countChange>0){const i=Math.max(0,...t.tieMatchUps.filter((e=>e.collectionId===n.collectionId)).map(di("collectionPosition"))),a=r.collectionDefinitions.find((e=>e.collectionId===n.collectionId)),o=Ky({matchUpsLimit:n.countChange,collectionPositionOffset:i,collectionDefinition:a,uuids:e});s.push(...ii(o,!1,!0)),m+=s.length,t.tieMatchUps.push(...o)}else{const e=n.toBePlayedTieMatchUpIds.slice(0,Math.abs(n.countChange));console.log("remove",e.length),o.push(...e),t.tieMatchUps=t.tieMatchUps.filter((({matchUpId:t})=>!e.includes(t)))}})),s.length&&tl({matchUps:s,drawDefinition:n,tournamentId:d,eventId:a}),o.length&&nl({matchUpIds:o,action:"updateTieFormat",drawDefinition:n,tournamentId:d,eventId:a}),{matchUpIdsRemoved:o,matchUpsAdded:s}}}({tieFormat:G,updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:a,structure:b,eventId:m,matchUp:D,event:h}),!T.error){const{appliedPolicies:e}=Xo({tournamentRecord:t});if(e?.audit?.[Ko]){zy({drawDefinition:a,auditData:pi({collectionDefinition:E,drawId:a?.drawId,action:w,structureId:d,matchUpId:p,eventId:m})})}}return Mi({result:{...T,modifications:_},stack:w})}function ev(e){const{method:t,tournamentRecords:n,...r}=e;if(!t)return{error:mt};const i=e.tournamentId||BU({tournamentRecords:n,...r});if("string"!=typeof i)return{error:H};const a=n[i];return t({...r,tournamentRecord:a})}function tv({tieFormat:e,orderMap:t}){const n=ul(e);return n.collectionDefinitions.forEach((e=>{const n=t[e.collectionId];n&&(e.collectionOrder=n)})),n.collectionDefinitions.sort(((e,t)=>D(e.collectionOrder)-D(t.collectionOrder))),n}function nv({tournamentRecord:e,drawDefinition:t,structureId:n,matchUpId:r,orderMap:i,eventId:a,matchUp:o,event:s}){if("object"!=typeof i||!Object.values(i).every((e=>S(e))))return Mi({result:{error:xn},context:{orderMap:i}});if(a&&s?.tieFormat)rv({tournamentRecord:e,event:s,orderMap:i});else if(r){const n=t&&Qp({drawDefinition:t,matchUpId:r});if(n?.error)return n;if(!(o=n.matchUp))return{error:et};o?.tieFormat&&(o.tieFormat=tv({tieFormat:o.tieFormat,orderMap:i}),rl({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:t,matchUp:o}))}else if(n){const r=rp({drawDefinition:t,structureId:n});if(r.error)return r;const a=r.structure;if(a?.tieFormat)a.tieFormat=tv({tieFormat:a.tieFormat,orderMap:i}),av({eventId:s?.eventId,tournamentRecord:e,drawDefinition:t,structure:a,orderMap:i}),al({drawDefinition:t,structureIds:[a.structureId]});else if(t.tieFormat)iv({structureIds:[n],tournamentRecord:e,drawDefinition:t,orderMap:i,event:s});else{if(!s?.tieFormat)return{error:Gn};rv({structureIds:[n],tournamentRecord:e,orderMap:i,event:s})}}else{if(!t?.tieFormat)return{error:Gn};iv({tournamentRecord:e,drawDefinition:t,orderMap:i,event:s})}return{...L}}function rv({tournamentRecord:e,structureIds:t,orderMap:n,event:r}){const i=tv({tieFormat:r.tieFormat,orderMap:n});t?.length||(r.tieFormat=i);for(const a of r.drawDefinitions??[])iv({tournamentRecord:e,drawDefinition:a,structureIds:t,orderMap:n,event:r})}function iv({tournamentRecord:e,drawDefinition:t,structureIds:n,orderMap:r,event:i}){const a=tv({tieFormat:t.tieFormat??i?.tieFormat,orderMap:r});n?.length||(t.tieFormat=a);const o=[];for(const s of t.structures??[])n?.length&&!n.includes(s.structureId)||((s.tieFormat||n?.includes(s.structureId))&&(s.tieFormat=tv({tieFormat:s.tieFormat??t.tieFormat??i?.tieFormat,orderMap:r})),av({eventId:i?.eventId,tournamentRecord:e,drawDefinition:t,structure:s,orderMap:r}),o.push(s.structureId));al({drawDefinition:t,structureIds:o})}function av({tournamentRecord:e,drawDefinition:t,structure:n,orderMap:r,eventId:i}){const a=Kp({matchUpFilters:{matchUpTypes:[ji]},structure:n})?.matchUps;for(const o of a)o.tieFormat&&(o.tieFormat=tv({tieFormat:o.tieFormat,orderMap:r}),rl({tournamentId:e?.tournamentId,drawDefinition:t,eventId:i,matchUp:o}))}function ov({updateInProgressMatchUps:e=!0,tieFormatComparison:t,tournamentRecord:n,drawDefinition:r,tieFormatName:i,collectionId:a,structureId:o,matchUpId:s,eventId:c,matchUp:u,event:d}){const p="removeCollectionDefinition";let l=u?void 0:Hy({drawDefinition:r,structureId:o,matchUpId:s,eventId:c,event:d});if(l?.error)return Mi({result:l,stack:p});const m=l?.structure;u=u??l?.matchUp;const f=l?.tieFormat,h=ul(f),I=d?.eventType;if(l=ca({tieFormat:h,eventType:I}),l.error)return Mi({result:l,stack:p});const g=h?.collectionDefinitions?.find((e=>e.collectionId===a));if(!g)return Mi({result:{error:Gn,collectionId:a}});h.collectionDefinitions=h.collectionDefinitions.filter((e=>e.collectionId!==a)),g.collectionGroupNumber&&(h.collectionDefinitions=h.collectionDefinitions.map((e=>{const{collectionGroupNumber:t,...n}=e;return n})),h.collectionGroups=h.collectionGroups.filter((({groupNumber:e})=>e!==g.collectionGroupNumber)));const{aggregateValue:U,valueGoal:y}=vh(h);h.winCriteria=pi({aggregateValue:U,valueGoal:y});const v=f?.winCriteria.valueGoal,S=f?.winCriteria.aggregateValue;(v&&v!==y||U&&!S)&&(i?h.tieFormatName=i:delete h.tieFormatName);let w=[];s&&u?w=[u]:o&&m?w=Kp({matchUpFilters:{matchUpTypes:[ji]},structure:m})?.matchUps??[]:r?w=ih({matchUpFilters:{matchUpTypes:[ji]},drawDefinition:r})?.matchUps??[]:d&&(w=ah({matchUpFilters:{matchUpTypes:[ji]},drawDefinition:r})?.matchUps??[]);const P=(w||[]).filter((n=>{const r=n.tieMatchUps?.filter((e=>e.collectionId===a)),i=r?.some(dl),o=!(!t||!n.tieFormat)&&Eh({descendant:n.tieFormat,ancestor:h})?.different;return e&&!i||!n.winningSide&&n.matchUpStatus!==ha&&(e||n.matchUpStatus!==va&&!dl(n)&&!o)}));if(!P.length)return{error:Nn};if(s&&u&&e){const e=u.tieMatchUps?.filter((e=>e.collectionId===a));for(const t of e??[]){let e=Cy({matchUpId:t.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:n,drawDefinition:r,event:d});if(e.error)return e;if(e=Qp({drawDefinition:r,matchUpId:s}),e.error)return e;u=e?.matchUp}}const T=[];for(const b of P){for(const e of b?.sides??[])e.lineUp=(e.lineUp??[]).map((e=>({participantId:e.participantId,collectionAssignments:(e?.collectionAssignments??[]).filter((e=>e.collectionId!==a))})));if(b.tieMatchUps=(b.tieMatchUps??[]).filter((e=>{const t=e.collectionId===a;return t&&T.push(e.matchUpId),!t})),b.tieFormat&&(b.tieFormat=ul(h)),e){const e=xl({matchUpId:b.matchUpId,exitWhenNoValues:!0,tournamentRecord:n,drawDefinition:r,event:d});if(e.error)return e}rl({tournamentId:n?.tournamentId,eventId:d?.eventId,drawDefinition:r,context:p,matchUp:b})}T.length&&nl({tournamentId:n?.tournamentId,matchUpIds:T,eventId:d?.eventId,drawDefinition:r});const D=pi(h);if(l=ca({tieFormat:D,eventType:I}),l.error)return Mi({result:l,stack:p});if(c&&d)d.tieFormat=D;else if(s&&u)u.tieFormat=D;else if(m)m.tieFormat=D;else if(r)r.tieFormat=D;else if(!u||!r)return{error:Y};al({drawDefinition:r,eventId:d?.eventId});const{appliedPolicies:R}=Xo({tournamentRecord:n});if(R?.audit?.[Ko]){zy({drawDefinition:r,auditData:pi({drawId:r?.drawId,action:p,collectionId:a,structureId:o,matchUpId:s,eventId:c})})}return{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:P,...L}}function sv({updateInProgressMatchUps:e=!0,collectionDefinition:t,referenceCategory:n,tournamentRecord:r,policyDefinitions:i,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:c,enforceGender:u,structureId:d,matchUpId:p,matchUp:l,eventId:m,uuids:f,event:h}){const I="addCollectionDefinition",g=Xo({tournamentRecord:r,drawDefinition:s,event:h}).appliedPolicies??{},U=i?.[lo]??g?.[lo];a=a??U?.participants?.enforceCategory;const y=!1!==(u??U?.participants?.enforceGender),v=!(!(n??h?.category)||!1===a),S=!(!(o??h?.gender)||!y),w=ua({referenceCategory:n??h?.category,collectionDefinition:t,referenceGender:o,checkCategory:v,checkGender:S,event:h});if(w.error)return Mi({result:w,stack:I});let P=l?.tieFormat?void 0:Hy({drawDefinition:s,structureId:d,matchUpId:p,eventId:m,event:h});if(P?.error)return Mi({result:{error:P.error},stack:I});const T=P?.structure;l=l??P?.matchUp;const D=l?.tieFormat??P?.tieFormat,R=ul(D),b=h?.eventType;if(P=ca({tieFormat:R,eventType:b}),P?.error)return Mi({result:{error:P.error},stack:I});if(t.collectionId){if(R.collectionDefinitions.map((({collectionId:e})=>e)).includes(t.collectionId))return Mi({context:{collectionId:t.collectionId},result:{error:_n}})}else t.collectionId=Ii();R.collectionDefinitions.push(t),R.collectionDefinitions.sort(((e,t)=>(e.collectionOrder||0)-(t.collectionOrder||0))).forEach(((e,t)=>e.collectionOrder=t+1));const{aggregateValue:N,valueGoal:M}=vh(R);R.winCriteria=pi({aggregateValue:N,valueGoal:M});const A=D?.winCriteria.valueGoal,E=D?.winCriteria.aggregateValue;(A&&A!==M||N&&!E)&&(c?R.tieFormatName=c:delete R.tieFormatName);const C=[],O=[];let F=[];const k=pi(R);if(P=ca({tieFormat:k,eventType:b}),P?.error)return Mi({result:{error:P.error},stack:I});if(m&&h){h.tieFormat=k;for(const n of h.drawDefinitions??[])if(!n.tieFormat)for(const r of n.structures??[]){if(r.tieFormat)continue;const n=cv({updateInProgressMatchUps:e,collectionDefinition:t,structure:r,uuids:f});O.push(...n.newMatchUps),F.push(...n.targetMatchUps),C.push(r.structureId)}uv({modifiedMatchUps:F,eventId:h?.eventId,modifiedStructureIds:C,tournamentRecord:r,drawDefinition:s,addedMatchUps:O,stack:I})}else if(d&&T){T.tieFormat=k;const n=cv({updateInProgressMatchUps:e,collectionDefinition:t,structure:T,uuids:f});O.push(...n.newMatchUps),F=n.targetMatchUps,uv({modifiedMatchUps:F,eventId:h?.eventId,modifiedStructureIds:C,tournamentRecord:r,drawDefinition:s,addedMatchUps:O,stack:I})}else if(p&&l){if(!Qy({matchUp:l,updateInProgressMatchUps:e}))return Mi({result:{error:Rt},stack:I});l.tieFormat=k;const n=Ky({collectionDefinition:t,uuids:f});Array.isArray(l.tieMatchUps)||(l.tieMatchUps=[]),l.tieMatchUps.push(...n),O.push(...n),uv({modifiedMatchUps:[l],eventId:h?.eventId,modifiedStructureIds:C,tournamentRecord:r,drawDefinition:s,addedMatchUps:O,stack:I})}else{if(!s)return{error:Y};s.tieFormat=k;for(const n of s.structures??[]){const r=cv({updateInProgressMatchUps:e,collectionDefinition:t,structure:n,uuids:f});C.push(n.structureId),O.push(...r.newMatchUps),F.push(...r.targetMatchUps)}uv({modifiedMatchUps:F,eventId:h?.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:O,stack:I})}if(g?.audit?.[Ko]){zy({drawDefinition:s,auditData:pi({drawId:s?.drawId,collectionDefinition:t,action:I,structureId:d,matchUpId:p,eventId:m})})}return{tieFormat:k,targetMatchUps:F,addedMatchUps:O,...L}}function cv({updateInProgressMatchUps:e,collectionDefinition:t,structure:n,uuids:r}){const i=[],a=Kp({matchUpFilters:{matchUpTypes:[ji]},structure:n})?.matchUps,o=a.filter((t=>Qy({matchUp:t,updateInProgressMatchUps:e})&&!t.tieFormat));for(const s of o){const e=Ky({collectionDefinition:t,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...e),i.push(...e)}return{newMatchUps:i,targetMatchUps:o}}function uv({modifiedStructureIds:e,tournamentRecord:t,modifiedMatchUps:n,drawDefinition:r,addedMatchUps:i,eventId:a,stack:o}){tl({tournamentId:t?.tournamentId,matchUps:i,drawDefinition:r,eventId:a}),n?.forEach((e=>{rl({tournamentId:t?.tournamentId,drawDefinition:r,context:o,matchUp:e,eventId:a})})),al({structureIds:e,drawDefinition:r,eventId:a})}function dv({updateInProgressMatchUps:e,originalValueGoal:t,tournamentRecord:n,wasAggregateValue:r,tieFormatName:i,drawDefinition:a,structureId:o,structure:s,tieFormat:c,matchUpId:u,matchUp:d,eventId:p,event:l}){const{aggregateValue:m,valueGoal:f}=vh(c);c.winCriteria=pi({aggregateValue:m,valueGoal:f}),(t&&t!==f||m&&!r)&&(i?c.tieFormatName=i:delete c.tieFormatName);const{targetMatchUps:h}=function({updateInProgressMatchUps:e,drawDefinition:t,structureId:n,structure:r,matchUpId:i,matchUp:a}){let o=[];return i&&a?o=[a]:n&&r?o=Kp({matchUpFilters:{matchUpTypes:[ji]},structure:r})?.matchUps||[]:t&&(o=ih({matchUpFilters:{matchUpTypes:[ji]},drawDefinition:t})?.matchUps||[]),{targetMatchUps:o.filter((t=>!t.winningSide&&t.matchUpStatus!==ha&&(e||t.matchUpStatus!==va&&!dl(t))))}}({updateInProgressMatchUps:e,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:d});!function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:n,targetMatchUps:r,tieFormat:i,event:a}){for(const o of r){const r=!!o.tieFormat;let s;if(r&&(o.tieFormat=ul(i)),e){const e=xl({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:t,drawDefinition:n,event:a});if(e.error)return e;s=e.score}r&&!s&&rl({tournamentId:t?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:o,drawDefinition:n})}}({updateInProgressMatchUps:e,tournamentRecord:n,targetMatchUps:h,drawDefinition:a,tieFormat:c,event:l});const I=pi(c),g=ca({eventType:l?.eventType,tieFormat:I});if(g.error)return g;if(p&&l)l.tieFormat=I;else if(u&&d)d.tieFormat=c;else if(s)s.tieFormat=I;else if(a)a.tieFormat=I;else if(!d||!a)return{error:Y};return al({drawDefinition:a,eventId:l?.eventId}),{...L}}function pv({updateInProgressMatchUps:e=!0,collectionGroupNumber:t,tournamentRecord:n,drawDefinition:r,tieFormatName:i,structureId:a,matchUpId:o,matchUp:s,eventId:c,event:u}){if(!t)return{error:mt};if(isNaN(t))return{error:xn};const d="removeCollectionGroup";let p=s?void 0:Hy({drawDefinition:r,structureId:a,matchUpId:o,eventId:c,event:u});if(p?.error)return Mi({result:p,stack:d});const l=p?.structure;s=s??p?.matchUp;const m=p?.tieFormat,f=m?.winCriteria.valueGoal,h=m?.winCriteria.aggregateValue,I=ul(m);if(p=ca({tieFormat:I,eventType:u?.eventType}),p.error)return Mi({result:p,stack:d});const g=[];if(I.collectionDefinitions=I.collectionDefinitions.map((e=>{const{collectionGroupNumber:n,...r}=e;return n!==t?e:(g.push(e.collectionId),r)})),I.collectionGroups=I.collectionGroups.filter((({groupNumber:e})=>e!==t)),p=dv({updateInProgressMatchUps:e,originalValueGoal:f,wasAggregateValue:h,tournamentRecord:n,drawDefinition:r,tieFormatName:i,structureId:a,structure:l,tieFormat:I,matchUpId:o,matchUp:s,eventId:c,event:u}),!p.error){const{appliedPolicies:e}=Xo({tournamentRecord:n});if(e?.audit?.[Ko]){zy({drawDefinition:r,auditData:pi({drawId:r?.drawId,collectionGroupNumber:t,action:d,structureId:a,matchUpId:o,eventId:c})})}}return Mi({result:{...p,modifiedCollectionIds:g},stack:d})}function lv({updateInProgressMatchUps:e=!0,tournamentRecord:t,groupDefinition:n,drawDefinition:r,collectionIds:i,tieFormatName:a,structureId:o,matchUpId:s,matchUp:c,eventId:u,event:d}){const p="addCollectionGroup";if(!Array.isArray(i))return Mi({result:{error:mt},stack:p});let l=c?void 0:Hy({drawDefinition:r,structureId:o,matchUpId:s,eventId:u,event:d});if(l?.error)return Mi({result:l,stack:p});const m=l?.structure;c=c||l?.matchUp;const f=l?.tieFormat,h=f?.winCriteria.valueGoal,I=ul(f);if(l=ca({tieFormat:I,eventType:d.eventType}),l.error)return Mi({result:l,stack:p});for(const U of I.collectionDefinitions){const{collectionId:e,collectionGroupNumber:t}=U;if(t&&i.includes(e))return Mi({info:"collectionIds cannot be part of other collectionGroups",result:{error:xn},stack:p})}const g=(I.collectionGroups||[]).reduce(((e,t)=>t.groupNumber>e?t.groupNumber:e),0)+1;return n.groupNumber=g,I.collectionDefinitions=I.collectionDefinitions.map((e=>i.includes(e.collectionId)?{...e,collectionGroupNumber:g}:e)),I.collectionGroups=[...I.collecitonGroups||[],n],dv({updateInProgressMatchUps:e,originalValueGoal:h,tournamentRecord:t,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:I,matchUpId:s,matchUp:c,eventId:u,event:d})}function mv({updateInProgressMatchUps:e=!1,tieFormatComparison:t,modifiedTieFormat:n,tournamentRecord:r,drawDefinition:i,structureId:a,matchUpId:o,eventId:s,uuids:c,event:u}){const d="modifyTieFormat";if(!ca({tieFormat:n,eventType:u?.eventType}).valid)return Mi({result:{error:We},info:"falied validation",stack:d});const p=Hy({drawDefinition:i,structureId:a,matchUpId:o,eventId:s,event:u});if(p.error)return Mi({result:p,stack:d});const{matchUp:l,tieFormat:m}=p,f=ul(m),h=Eh({descendant:n,ancestor:f});if(h.invalid)return Mi({context:{invalid:h.invalid},result:{error:We},stack:d});if(!h?.different)return Mi({result:{...L},info:"Nothing to do",stack:d});const I=f.collectionDefinitions.map((({collectionId:e})=>e)),g=n.collectionDefinitions.map((({collectionId:e})=>e)),U=I.filter((e=>!g.includes(e))),y=n.collectionDefinitions.filter((({collectionId:e})=>!I.includes(e))),v=y.map(di("collectionId")),S=[];let w;const P=n.tieFormatName;for(const T of n.collectionDefinitions){if(v.includes(T.collectionId))continue;const t=Zy({updateInProgressMatchUps:e,...T,tournamentRecord:r,tieFormatName:P,drawDefinition:i,structureId:a,matchUpId:o,eventId:s,event:u});if(t.modifications&&S.push(...t.modifications),t.error)return Mi({result:t,stack:d});t.tieFormat&&(w=t.tieFormat)}for(const T of y){const t=sv({updateInProgressMatchUps:e,collectionDefinition:T,tournamentRecord:r,drawDefinition:i,tieFormatName:P,structureId:a,matchUpId:o,matchUp:l,eventId:s,uuids:c,event:u});if(t.error)return Mi({result:t,stack:d});t.tieFormat&&(w=t.tieFormat)}for(const T of U){const n=ov({updateInProgressMatchUps:e,tieFormatComparison:t,tournamentRecord:r,drawDefinition:i,tieFormatName:P,collectionId:T,structureId:a,matchUpId:o,eventId:s,matchUp:l,event:u});if(n.error)return Mi({result:n,stack:d});n.tieFormat&&(w=n.tieFormat)}return m?.tieFormatName!==P?(w.tieFormatName=P,S.push({tieFormatName:P})):(S.length||v.length||U.length)&&(delete w.tieFormatName,S.push("tieFormatName removed: modifications without new tieFormatName")),w.collectionDefinitions=w.collectionDefinitions.sort(((e,t)=>D(e.collectionOrder)-D(t.collectionOrder))).map(((e,t)=>({...e,collectionOrder:t+1}))),{processedTieFormat:ul(w),modifications:S,...L}}function fv({tournamentRecord:e,drawDefinition:t,matchUpId:n,event:r,uuids:i}){const a="resetTieFormat";if(!e)return Mi({result:{error:$},stack:a});if("string"!=typeof n)return Mi({result:{error:Qe},stack:a});const o=MI({tournamentRecord:e,matchUpId:n});if(o.error)return o;const{matchUp:s,structure:c}=o;if(!s?.tieMatchUps)return Mi({result:{error:tt},info:"Must be a TEAM matchUp",stack:a});if(!s.tieFormat)return{...L};const u=Ni({structure:c,drawDefinition:t,event:r})?.tieFormat;if(!u)return Mi({result:{error:Gn},info:"No inherited tieFormat",stack:a});const d=[],p=[],l=[],m=[];for(const f of u.collectionDefinitions){const{matchUpCount:e,collectionId:t}=f;p.push(t);const n=(s.tieMatchUps||[]).filter((e=>e.collectionId===t));if(n.length>e)n.sort(((e,t)=>(e.matchUpStatus===Da?1:0)-(t.matchUpStatus===Da?1:0))),l.push(...n.slice(0,e)),d.push(...n.slice(3).map(Pl));else if(l.push(...n),n.length<e){const t=Ky({collectionDefinition:f,matchUpsLimit:e-n.length,uuids:i});m.push(...t)}}for(const f of s?.tieMatchUps||[])f.collectionId&&!p.includes(f.collectionId)&&d.push(f.matchUpId);return m.length&&(l.push(...m),tl({tournamentId:e?.tournamentId,eventId:r?.eventId,matchUps:m,drawDefinition:t})),d.length&&nl({tournamentId:e?.tournamentId,matchUpIds:d,eventId:r?.eventId,drawDefinition:t}),s&&(s.tieMatchUps=l,s.tieFormatId=void 0,s.tieFormat=void 0,rl({tournamentId:e?.tournamentId,structureId:c?.structureId,eventId:r?.eventId,context:a,drawDefinition:t,matchUp:s})),{...L,newMatchUps:m,deletedMatchUpIds:d}}function hv(e){const{tournamentRecord:t,drawDefinition:n,matchUpId:r,event:i}=e,a="resetScorecard";if(!n)return Mi({result:{error:Y},stack:a});if(!r)return Mi({result:{error:Qe},stack:a});if("string"!=typeof r)return Mi({result:{error:xn,matchUpId:r},stack:a});const o=_p({drawDefinition:n}),{matchUps:s}=Cl({nextMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:o}),c=o.drawMatchUps.find((e=>e.matchUpId===r)),u=s?.find((e=>e.matchUpId===r));if(!c||!s)return{error:Xe};if(c.matchUpType!==Yi.Team)return{error:tt};const d=bl({inContextDrawMatchUps:s,drawDefinition:n,matchUpId:r}),p=u?.structureId,{structure:l}=rp({drawDefinition:n,structureId:p});Object.assign(e,{inContextDrawMatchUps:s,inContextMatchUp:u,matchUpsMap:o,targetData:d,structure:l,matchUp:c});if(FI(e))return{error:Mt};for(const f of c.tieMatchUps??[]){const e=Cy({matchUpId:f.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:t,drawDefinition:n,event:i});if(e.error)return Mi({result:e,stack:a})}const m=xl({event:e.event,removeScore:!0,tournamentRecord:t,drawDefinition:n,matchUpsMap:o,matchUpId:r});if(m.error)return Mi({result:m,stack:a});if(e.tiebreakReset&&!m.tieFormatRemoved){const e=Ni({drawDefinition:n,structure:l,event:i})?.tieFormat;if(c.tieFormat&&e){const{matchUpCountDifference:a,descendantDifferences:o,ancestorDifferences:s,valueDifference:u}=Eh({descendant:c.tieFormat,ancestor:e});if(1===o.collectionIds.length&&!s.collectionIds.length&&!s.groupsCount&&1===a&&1===u){const e=fv({tournamentRecord:t,drawDefinition:n,matchUpId:r,event:i});if(e.error)return e}}}return{...L}}const Iv={modifyCollectionDefinition:function(e){return ev({...e,method:Zy})},removeCollectionDefinition:function(e){return ev({...e,method:ov})},orderCollectionDefinitions:function(e){return ev({...e,method:nv})},addCollectionDefinition:function(e){return ev({...e,method:sv})},removeCollectionGroup:function(e){return ev({...e,method:pv})},addCollectionGroup:function(e){return ev({...e,method:lv})},modifyTieFormat:function(e){return ev({...e,method:mv})},resetScorecard:function(e){return ev({...e,method:hv})},resetTieFormat:function(e){return ev({...e,method:fv})},addExtension:oc,findExtension:sc,removeExtension:cc,addEventExtension:function({tournamentRecords:e,extension:t,eventId:n}){if("string"!=typeof n)return{error:Ae};if(!Ys({extension:t}))return{error:xn};for(const r of Object.values(e)){const{event:e}=Qs({tournamentRecord:r,eventId:n});if(e)return rc({event:e,extension:t})}return{error:Ee}},linkTournaments:function({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const t=dc(e),{tournamentIds:n}=t;if(n?.length>1){return oc({tournamentRecords:e,extension:{name:Lo,value:{tournamentIds:n}}})}return{...L}},unlinkTournament:function({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e)return{error:xn};if(!t)return{error:H};const n=dc(e),{tournamentIds:r}=n;if(!r.includes(t))return{error:H};let i;return r.every((n=>{const r=e[n],{extension:a}=As({name:Lo,tournamentRecord:r});if(!a)return!0;const o=a?.value?.tournamentIds||[];if(!o?.length||1===o.length&&o.includes(t)||n===t){const e=ic({name:Lo,tournamentRecord:r});return e.error&&(i=e.error),e.success}const s=o.filter((e=>e!==t));a.value={tournamentIds:s};const c=tc({tournamentRecord:r,extension:a});return c.error&&(i=c.error),c.success})),i?{error:i}:{...L}},unlinkTournaments:function({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?Mi({result:cc({name:Lo,tournamentRecords:e}),stack:"unlinkTournaments"}):{error:q}},getLinkedTournamentIds:uc,addDrawDefinition:function({tournamentRecords:e,existingDrawCount:t,allowReplacement:n,drawDefinition:r,tournamentId:i,eventId:a,flight:o}){if(!a)return{error:Ae};if(!(i=i??BU({tournamentRecords:e,eventId:a})))return{error:H};const s=e[i];if(!s)return{error:$};const c=Qs({tournamentRecord:s,eventId:a});return c.event?c.error?c:Ly({event:c.event,existingDrawCount:t,allowReplacement:n,drawDefinition:r,flight:o}):{error:Ee}},getCompetitionParticipants:function(e){const{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:q};let n=[];const r=[],i=[],a={};for(const o of Object.values(t)){const{participants:t,participantIdsWithConflicts:s,mappedMatchUps:c}=Kg({tournamentRecord:o,...e});c&&Object.assign(a,c);for(const e of t??[]){const{participantId:t}=e;i.includes(t)?n=n.map((n=>n.participantId!==t?n:Qg(n,e,!0))):(i.push(t),n.push(e))}s?.forEach((e=>{r.includes(e)||r.push(e)}))}return{competitionParticipants:n,participantIdsWithConflicts:r,mappedMatchUps:a,...L}},getParticipants:function(e){const{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:q};const n={},r=[],i={},a={},o=[],s={},c=[];for(const u of Object.values(t)){const{participantIdsWithConflicts:t,mappedMatchUps:d,participantMap:p,participants:l,matchUps:m,derivedEventInfo:f,derivedDrawInfo:h}=Kg({tournamentRecord:u,...e});Object.assign(s,d),Object.assign(n,p),Object.assign(i,f),Object.assign(a,h),r.push(...l??[]),o.push(...m??[]),t?.forEach((e=>{c.includes(e)||c.push(e)}))}return{participantIdsWithConflicts:c,derivedEventInfo:i,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:r,...L,matchUps:o}},addParticipant:function({tournamentRecords:e,returnParticipant:t,pairOverride:n,tournamentId:r,participant:i}){if("string"!=typeof r)return{error:H};const a=e[r];return a?By({returnParticipant:t,tournamentRecord:a,pairOverride:n,participant:i}):{error:$}},courtGridRows:xg,setMatchUpStatus:function(e){const t=e.tournamentRecords,n=e.tournamentId||BU(e);if("string"!=typeof n)return{error:H};const r=t[n];if(!r)return{error:$};const{drawDefinition:i,event:a}=Qs({eventId:e.eventId,drawId:e.drawId,tournamentRecord:r});return xy({tournamentRecord:r,...e,drawDefinition:i,event:a})},bulkMatchUpStatusUpdate:function(e){const{tournamentRecords:t,outcomes:n}=e;if(!Array.isArray(n))return{error:mt,info:sa("outcomes")};const r=n.reduce(((e,t)=>e.includes(t.tournamentId)?e:e.concat(t.tournamentId)),[]);for(const i of r){const e=t[i];if(!e)return{error:$};const r=n.filter((e=>e.tournamentId===i));if(r.length){const t=_y({tournamentRecord:e,outcomes:r});if(t.error)return t}}return{...L}},bulkScheduleMatchUps:GU,addPenalty:function(e){const{tournamentRecords:t,participantIds:n}=e;let r;for(const i of Object.values(t)){const t=Kg({tournamentRecord:i}).participants??[],a=t?.map(di("participantId")).filter((e=>n.includes(e)));if(a.length){r=Gy({...e,penaltyId:e.penaltyId??r,tournamentRecord:i,participantIds:a}).penaltyId}}return r?{...L,penaltyId:r}:{error:Bt}},removePenalty:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:q};for(const n of Object.values(t)){const t=qy({tournamentRecord:n,...e});if(t.error&&t.error!==cn)return t}return{...L}},modifyPenalty:function(e){const{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:q};for(const n of Object.values(t)){const t=Wy({tournamentRecord:n,...e});if(t.error&&t.error!==cn)return t}return{...L}},getCompetitionPenalties:function({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const t=[];for(const n of Object.values(e)){const{penalties:e}=$y({tournamentRecord:n});t.push(...e??[])}return{penalties:t}},findParticipant:Jg};function gv({removePriorValues:e=!0,tournamentRecord:t,status:n=yu}){if(!t)return{error:$};const r=`${Uu}.${vu}`,{timeItem:i}=Kf({tournamentRecord:t,itemType:r}),a=i?.itemValue||{[n]:{}};a[n]&&delete a[n].orderOfPlay;return wU({timeItem:{itemValue:a,itemType:r},removePriorValues:e,tournamentRecord:t}),pr({topic:Bc,payload:{tournamentId:t.tournamentId}}),{...L}}function Uv({scheduledDates:e=[],removePriorValues:t,tournamentRecord:n,status:r=yu,eventIds:i=[]}){if(!n)return{error:$};const a=`${Uu}.${vu}`,{timeItem:o}=Kf({tournamentRecord:n,itemType:a}),s=o?.itemValue||{[r]:{}};s[r].orderOfPlay={published:!0,scheduledDates:e,eventIds:i};return wU({timeItem:{itemValue:s,itemType:a},removePriorValues:t,tournamentRecord:n}),pr({topic:xc,payload:{tournamentId:n.tournamentId,scheduledDates:e,eventIds:i}}),{...L}}const yv={unPublishOrderOfPlay:function(e){const t=e?.tournamentRecords;if(!t)return{error:q};for(const n of Object.values(t)){const t=gv({tournamentRecord:n,...e});if(t.error)return t}return{...L}},publishOrderOfPlay:function(e){const t=e?.tournamentRecords;if(!t)return{error:q};for(const n of Object.values(t)){const t=Uv({tournamentRecord:n,...e});if(t.error)return t}return{...L}}};function vv({tournamentRecord:e,matchUpFormat:t,event:n}){if(!e)return{error:$};if(!Ti(t))return{error:Ge};const{extension:r}=Es({event:n,name:Wo}),i=r?.value,{extension:a}=As({tournamentRecord:e,name:Wo}),o=a?.value;return{matchUpFormat:t,averageTimes:[i?.matchUpAverageTimes&&Is({...i,matchUpFormat:t}),o?.matchUpAverageTimes&&Is({...o,matchUpFormat:t})].find((e=>e)),recoveryTimes:[i?.matchUpRecoveryTimes&&gs({...i,matchUpFormat:t}),o?.matchUpRecoveryTimes&&gs({...o,matchUpFormat:t})].find((e=>e))}}function Sv({tournamentRecord:e,recoveryTimes:t,matchUpFormat:n,averageTimes:r,event:i}){if(!e)return{error:$};if(r&&!Array.isArray(r))return{error:xn};if(t&&!Array.isArray(t))return{error:xn};const a=Wo;if(i){const{extension:e}=Es({event:i,name:a});rc({event:i,extension:{name:a,value:wv({...e?.value||{},matchUpFormat:n,averageTimes:r,recoveryTimes:t})}})}else{const{extension:i}=As({tournamentRecord:e,name:a});tc({extension:{name:a,value:wv({...i?.value||{},matchUpFormat:n,averageTimes:r,recoveryTimes:t})},tournamentRecord:e})}return{...L}}function wv(e){const{matchUpRecoveryTimes:t=[],matchUpAverageTimes:n=[],matchUpFormat:r}=e;let{averageTimes:i,recoveryTimes:a}=e;i=(i||[]).filter((e=>e?.categoryNames?.length||e?.categoryTypes?.length));const o=i?.length&&n.map((e=>e?.matchUpFormatCodes.includes(r)?{...e,matchUpFormatCodes:e.matchUpFormatCodes?.filter((e=>e!==r))}:e)).filter((({matchUpFormatCodes:e})=>e?.length)).concat({matchUpFormatCodes:[r],averageTimes:i});a=(a||[]).filter((e=>e?.categoryNames?.length||e?.categoryTypes?.length));const s=a?.length&&t.map((e=>e?.matchUpFormatCodes.includes(r)?{...e,matchUpFormatCodes:e.matchUpFormatCodes?.filter((e=>e!==r))}:e)).filter((({matchUpFormatCodes:e,averageTimes:t})=>e?.length||t)).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:o?.length&&o||n,matchUpRecoveryTimes:s?.length&&s||t}}function Pv({tournamentRecord:e,recoveryMinutes:t,averageMinutes:n,matchUpFormat:r,categoryType:i,event:a}){if(!e)return{error:$};if(!Ti(r))return{error:xn};if(!a)return{error:Ae};const{averageTimes:o=[],recoveryTimes:s=[]}=vv({tournamentRecord:e,matchUpFormat:r,event:a}),c=a.category,u=c?.categoryName||c?.ageCategoryCode||a?.eventId;let d={categoryNames:[u],minutes:{}};const p={categoryNames:[u],minutes:{}},l=e=>{if(e.categoryTypes?.includes(i)&&console.log("encountered:",{categoryType:i}),!e.categoryNames?.includes(u)||(e.categoryNames=e.categoryNames.filter((e=>e!==u)),d={minutes:e.minutes,categoryNames:[u]},e.categoryNames.length))return e},f=!isNaN(m(n)),h=!isNaN(m(t)),I=o.map(l).filter((e=>e?.categoryNames?.length)),g=s.map(l).filter((e=>e?.categoryNames?.length));return f&&(Object.assign(d.minutes,{[a?.eventType||_i]:n}),I.push(d)),h&&(Object.assign(p.minutes,{[a?.eventType||_i]:t}),g.push(p)),f||h?Sv({averageTimes:f&&I,recoveryTimes:h&&g,tournamentRecord:e,matchUpFormat:r,event:a}):{error:xn}}function Tv({scheduleCompletedMatchUps:e,containedStructureIds:t,tournamentRecords:n,periodLength:r=30,matchUps:i,rounds:a}){if("object"!=typeof n)return{error:q};if(!Array.isArray(a))return{error:mt,info:sa("rounds")};const o={},s=[];a.sort(((e,t)=>(e.sortOrder??0)-(t.sortOrder??0))),t=t??Object.assign({},...Object.values(n).map((e=>Zg({tournamentRecord:e}).containedStructures))),i||({matchUps:i}=Th({nextMatchUps:!0,tournamentRecords:n}));let c=0;const u={},d={},p={},l=a.flatMap((a=>{const l=a.periodLength||r,m=[];t?.[a.structureId]?m.push(...t[a.structureId]):m.push(a.structureId);let h=i?$p({tournamentIds:[a.tournamentId],roundNumbers:[a.roundNumber],matchUpIds:a.matchUpIds,eventIds:[a.eventId],drawIds:[a.drawId],processContext:!0,structureIds:m,matchUps:i}).sort(Rh):[];const{segmentNumber:I,segmentsCount:g}=a.roundSegment||{};if(S(I)&&f(h?.length)&&f(g)&&I>0&&I<=g&&g<h?.length&&!a.matchUpIds?.length){const e=h.length/g,t=e*(I-1);h=h.slice(t,t+e)}const U=n[a.tournamentId],y=Qs({drawId:a.drawId,tournamentRecord:U}).event,v=[];for(const e of h){const t=e.matchUpFormat;t&&(o[t]||(o[t]=[],o[t].push(e)),v.push(t))}for(const t of v){const{eventType:r,category:i}=y??{},{categoryName:o,ageCategoryCode:m}=i??{},{typeChangeRecoveryMinutes:f,recoveryMinutes:I,averageMinutes:g,error:U}=Tg({categoryName:o??m,categoryType:i?.categoryType,tournamentId:a.tournamentId,eventId:a.eventId,tournamentRecords:n,matchUpFormat:t,eventType:r});if(U)return{error:U,round:a};const v=h.filter((t=>(e||!Ca.includes(t.matchUpStatus))&&t.matchUpStatus!==ma)).map(Pl);v.forEach((e=>{p[e]={typeChangeRecoveryMinutes:f,recoveryMinutes:I,averageMinutes:g},u[e]=I,d[e]=g})),s.push(...v),c=Math.max(g||0,c);return{roundPeriodLength:l,recoveryMinutes:I,averageMinutes:g,matchUpIds:v,hash:`${g}|${l}`}}}));return{scheduledRoundsDetails:l,greatestAverageMinutes:c,matchUpFormatCohorts:o,recoveryMinutesMap:u,averageMinutesMap:d,orderedMatchUpIds:s,minutesMap:p,...L}}function Dv({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=0,averageMatchUpMinutes:n=90,remainingScheduleTimes:r,clearScheduleDates:i,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:c,venueIds:u,endTime:d}){if("object"!=typeof a||!Object.keys(a).length)return{error:q};o=o||Xh({recoveryMinutes:t,averageMatchUpMinutes:n});const{courts:p,venues:l}=lg({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=p?.filter((e=>!u||u.includes(e.venueId)));c||(c=m?.reduce(((e,t)=>{const n=t.dateAvailability?.find((e=>!e.date||ni(s,e.date))),r=n?.startTime||t.startTime;return r&&(!e||Gr(r)<Gr(e))?r:e}),void 0)),d||(d=m?.reduce(((e,t)=>{const n=t.dateAvailability?.find((e=>!e.date||ni(s,e.date))),r=n?.endTime||t.endTime;return r&&(!e||Gr(r)>Gr(e))?r:e}),void 0));const f=Object.values(a),h=Object.assign({},...f.map((e=>(e.events||[]).map((t=>{const{scheduleTiming:n}=Os({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:n}}})))).flat()),I=_g({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),g=I?.dateMatchUps||[],U=I?.completedMatchUps||[],y=[];y.push(...g),y.push(...U);const v={averageTimes:[{minutes:{default:n}}],recoveryTimes:[{minutes:{default:t}}]},S=y?.map((({eventId:e,schedule:t,matchUpFormat:n})=>{const{event:r,scheduleTiming:i}=h[e],a=r?.eventType,s={...i,defaultTiming:v,matchUpFormat:n},{averageMinutes:c,recoveryMinutes:u}=zs({eventType:a,timingDetails:s}),{courtId:d,venueId:p}=t,l=$r(t.scheduledTime),m=Zr(l,c);return{recoveryMinutes:u,averageMinutes:c,periodLength:o,startTime:l,endTime:m,courtId:d,venueId:p}})),w={calculateStartTimeFromCourts:e,remainingScheduleTimes:r,averageMatchUpMinutes:n,date:s,clearScheduleDates:i,periodLength:o,startTime:c,endTime:d,bookings:S,courts:m},{scheduleTimes:P}=tI(w);return{venueId:1===u?.length&&u[0]||1===l?.length&&l[0].venueId||void 0,scheduleTimes:P,dateScheduledMatchUpIds:y.map(Pl)}}function Rv({matchUpScheduleTimes:e,matchUpDependencies:t,allDateMatchUpIds:n,matchUp:r}){const i=(t?.[r.matchUpId]?.matchUpIds||[]).filter((e=>n.includes(e))),a=i.filter((t=>!e[t]));return{dependenciesScheduled:!a?.length,remainingDependencies:a}}function bv({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:t,timeAfterRecovery:n,matchUp:r}){const{individualParticipantIds:i}=Ph(r);n=n||r.schedule?.timeAfterRecovery;const a=t=>{e[t]||(e[t]=[]),e[t]=P(e[t].concat(...i))},o=e=>{n&&(!t[e]||n>t[e])&&(t[e]=n)},s=r.winnerTo?.matchUpId||r.winnerMatchUpId;s&&(n&&o(s),a(s));const c=r.loserTo?.matchUpId||r.loserMatchUpId;c&&(n&&o(c),a(c)),r.sidesTo?.length&&r.sidesTo.forEach((({matchUpId:e})=>{e&&(n&&o(e),a(e))}))}function Nv({individualParticipantProfiles:e,participantId:t}){e[t]||(e[t]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function Mv({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,typeChangeRecoveryMinutes:n,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:i,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){const u=$r(c?.schedule?.endTime),d=u?Zr(u,m(o)):Zr(s,m(r)+m(o)),p=n&&(u?Zr($r(u),n):Zr(s,m(r)+m(n))),l=a?.[c.matchUpId]?.participantIds||[],f=(c.roundPosition&&e[c.matchUpId]||[]).flat();l.forEach((e=>{Nv({individualParticipantProfiles:t,participantId:e});const n=t[e].priorMatchUpType!==c.matchUpType&&p||d;f.includes(e)?function({individualParticipantProfiles:e,recoveryValue:t,participantId:n,scheduleTime:r,drawId:i}){e[n].potentialRecovery[i]||(e[n].potentialRecovery[i]=[]),e[n].potentialRecovery[i].push(t),e[n].potentialBookings[i]||(e[n].potentialBookings[i]=[]),e[n].potentialBookings[i].push({timeAfterRecovery:t,scheduleTime:r})}({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:n,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=n,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:n}))})),bv({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:i,timeAfterRecovery:d,matchUp:c})}function Av({matchUpScheduleTimes:e,matchUpDependencies:t,scheduleTime:n,matchUpId:r,details:i}){let a;const o=i.minutesMap?.[r]?.recoveryMinutes,s=i.minutesMap?.[r]?.averageMinutes,c=Zr(n,(s||0)+(o||0)),u=t?.[r]?.dependentMatchUpIds||[];if(u.length){const t=u.reduce(((t,n)=>{const r=e[n];if(!r)return t;const i={scheduleTime:r,matchUpId:n};return r&&!t.matchUpId||Gr(r)<Gr(t.scheduleTime)?i:t}),{});t.scheduleTime&&Gr(c)>Gr(t.scheduleTime)&&(a=t)}return{scheduledDependent:a}}const Ev="DO_NOT_SCHEDULE",Cv={DO_NOT_SCHEDULE:Ev};function Ov({averageMatchUpMinutes:e=90,requestConflicts:t={},potentials:n=!0,personRequests:r,scheduleTime:i,scheduleDate:a,matchUp:o}){const s=function(e){const{sides:t,matchUpType:n}=e||{};return(t||[]).map((e=>n===Bi&&(e?.participant?.individualParticipants||[])||e?.participant&&[e.participant]||[])).flat()}(o).map((({person:e})=>e?.personId));if(n){const e=(o?.potentialParticipants||[]).flat().map((({person:e})=>e?.personId));s.push(...e)}const c=s.map((e=>r[e]?.map((t=>({...t,personId:e}))))).filter(Boolean).flat().filter((e=>e.requestType===Ev&&ni(a,e.date))),u=[],d=o?.matchUpId,p=Jr($r(i),Wr(a)),l=$r(ei(p,e).toISOString());for(const m of c){const{requestId:e,startTime:n,endTime:r}=m;(i>n&&i<r||l>n&&l<r)&&(u.push({matchUpId:d,request:m,scheduleTime:i}),t[e]?(t[e].scheduleTimes.includes(i)||t[e].scheduleTimes.push(i),t[e].matchUpIds.includes(d)||t[e].matchUpIds.push(d)):t[e]={request:m,scheduleTimes:[i],matchUpIds:[d]})}return{conflicts:u}}function Fv({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUp:n,value:r}){const{matchUpType:i}=n,{individualParticipantIds:a}=Ph(n),o=(e[n.matchUpId]||[]).filter((e=>!k(e,a))).flat();[...a,...o].forEach((e=>{if(Nv({individualParticipantProfiles:t,participantId:e}),!t[e].potentialCounted[n.drawId]){const a=t[e].counters;a[i]?a[i]+=r:r>0&&(a[i]=r),a[xs]?a[xs]+=r:r>0&&(a[xs]=r),o.includes(e)&&(t[e].potentialCounted[n.drawId]=!0)}}))}const kv=({scheduleAttributes:e=["scheduledDate","scheduledTime"],schedule:t={}})=>!!Object.keys(t).filter((t=>e.includes(t))).filter((e=>t[e])).length;function xv({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:n,greatestAverageMinutes:r,dateScheduledMatchUps:i,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:c,scheduleDate:u,minutesMap:d,matchUps:p}){const l=[];n||(i=p?.filter((e=>{const t=e.schedule||{},n=e.matchUpStatus===ma;return n&&l.push({tournamentId:e.tournamentId,matchUpId:e.matchUpId}),!n&&kv({schedule:t})&&(!u||e.schedule.scheduledDate===u)})),n=i.map(Pl));const m=Array.isArray(c)?c.includes(u):c,f=m?[]:p.filter((({matchUpId:e})=>n.includes(e)));for(const h of f){Fv({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,value:1,matchUp:h});const n=h.schedule?.scheduledTime;if(n){o[h.matchUpId]=n;const i=d?.[h.matchUpId]?.recoveryMinutes;Mv({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:i,scheduleTime:n,matchUp:h})}}return{dateScheduledMatchUpIds:n,byeScheduledMatchUpDetails:l,dateScheduledMatchUps:i,clearDate:m}}function _v({scheduledRoundsDetails:e,greatestAverageMinutes:t,garmanSinglePass:n}){const r=[];let i,a,o,s,c=[];for(const u of e.filter(Boolean))s||(s=u.hash),(u.hash===s||n)&&(c=c.concat(u.matchUpIds)),u.hash===s||n||(s=u.hash,r.push({averageMinutes:o,recoveryMinutes:a,roundPeriodLength:i,matchUpIds:c}),c=u.matchUpIds),o=n?t:u.averageMinutes,a=u.recoveryMinutes,i=u.roundPeriodLength;return c.length&&r.push({matchUpIds:c,roundPeriodLength:i,recoveryMinutes:a,averageMinutes:o}),{groupedRounds:r}}function Lv({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:t,dateScheduledMatchUpIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:i,orderedMatchUpIds:a,clearDate:o,matchUps:s}){const c=Object.keys(i),u=a.map((e=>s.find((t=>t.matchUpId===e)))).filter(Boolean).filter((e=>{const r=!o&&(n.includes(e.matchUpId)||c.includes(e.matchUpId)),i=[ma,ga,ha,pa,Pa,Ra,ya,Ua].includes(e?.matchUpStatus);return t||!r&&!e.winningSide&&!i})),{matchUpMap:d}=u.reduce(((t,n)=>{const{drawId:i,tournamentId:a}=n;return t.matchUpMap[a]||(t.matchUpMap[a]={}),t.matchUpMap[a][i]?t.matchUpMap[a][i].push(n):t.matchUpMap[a][i]=[n],bv({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:r,matchUp:n}),t}),{matchUpMap:{}});return{matchUpsToSchedule:u,matchUpMap:d}}function Bv({defaultRecoveryMinutes:e=0,averageMatchUpMinutes:t=90,dateScheduledMatchUps:n,tournamentRecords:r,venueIds:i=[],periodLength:a,scheduleDate:o,matchUps:s}){if("object"!=typeof r)return{error:q};if(!La(s)&&!Array.isArray(n))return{error:Ze};a=a||Xh({recoveryMinutes:e,averageMatchUpMinutes:t});const c=Object.assign({},...Object.values(r).map((e=>(e.events||[]).map((t=>{const{scheduleTiming:n}=Os({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:n}}})))).flat()),u={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]};n||(n=s?.filter((e=>{const t=e.schedule;return kv({schedule:t})&&(!o||e.schedule.scheduledDate===o)})));const d=n?.filter((e=>(!i.length||i.includes(e.schedule.venueId))&&e.matchUpStatus!==ma)),p=d?.map((({eventId:e,schedule:t,matchUpFormat:n})=>{const{event:r,scheduleTiming:i}=c[e],o=r?.eventType,s={...i,defaultTiming:u,matchUpFormat:n},{averageMinutes:d,recoveryMinutes:p}=zs({timingDetails:s,eventType:o}),{courtId:l,venueId:m}=t,f=$r(t.scheduledTime),h=Zr(f,d);return{recoveryMinutes:p,averageMinutes:d,periodLength:a,startTime:f,courtId:l,endTime:h,venueId:m}})).filter(Boolean);return{bookings:p,relevantMatchUps:d,dateScheduledMatchUps:n}}function Vv({calculateStartTimeFromCourts:e=!0,remainingScheduleTimes:t,defaultRecoveryMinutes:n,averageMatchUpMinutes:r,clearScheduleDates:i,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:c,startTime:u,venueIds:d,matchUps:p,endTime:l}){if(o&&!a&&(a={[o.tournamentId]:o}),"object"!=typeof a||!Object.keys(a).length)return{error:q};s=s??Xh({recoveryMinutes:n,averageMatchUpMinutes:r});const{courts:m,venues:f}=lg({dates:[c],ignoreDisabled:!0,tournamentRecords:a}),h=m?.filter((e=>!d||d.includes(e.venueId)))??[];u=u??Zh({courts:h,scheduleDate:c,startTime:!0}),l=l??Zh({courts:h,scheduleDate:c,endTime:!0});const{bookings:I,dateScheduledMatchUps:g}=Bv({defaultRecoveryMinutes:n,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:c,periodLength:s,venueIds:d,matchUps:p}),U={calculateStartTimeFromCourts:e,remainingScheduleTimes:t,averageMatchUpMinutes:r,clearScheduleDates:i,date:c,periodLength:s,startTime:u,bookings:I,endTime:l,courts:h},{scheduleTimes:y}=tI(U),v=1===d?.length&&d[0]||1===f?.length&&f[0].venueId||void 0,S=g?.map(di("matchUpId"));return{dateScheduledMatchUpIds:S,dateScheduledMatchUps:g,scheduleTimes:y,venueId:v}}function jv({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,scheduleCompletedMatchUps:n,containedStructureIds:r,matchUpNotBeforeTimes:i,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:c,periodLength:u,scheduleDate:d,useGarman:p,matchUps:l,courts:m,venues:f}){const h={},I=[],g=[],U=[];for(const y of f){const{rounds:f=[],venueId:v}=y,{scheduledRoundsDetails:S,greatestAverageMinutes:w,orderedMatchUpIds:P,minutesMap:T}=Tv({scheduleCompletedMatchUps:n,containedStructureIds:r,tournamentRecords:c,periodLength:u,matchUps:l,rounds:f});U.push(...P??[]);const{groupedRounds:D}=_v({scheduledRoundsDetails:S,greatestAverageMinutes:w,garmanSinglePass:!0});let R,b,N=[];p&&({scheduleTimes:N,dateScheduledMatchUpIds:R,dateScheduledMatchUps:b}=Vv({averageMatchUpMinutes:D[0]?.averageMinutes,scheduleDate:Wr(d),venueIds:[y.venueId],clearScheduleDates:s,tournamentRecords:c,periodLength:u,matchUps:l}));const M=xv({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:R,greatestAverageMinutes:w,matchUpNotBeforeTimes:i,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:d,minutesMap:T,matchUps:l});({dateScheduledMatchUpIds:R,dateScheduledMatchUps:b}=M);const{byeScheduledMatchUpDetails:A,clearDate:E}=M;A?.length&&g.push(...A);const{matchUpsToSchedule:C,matchUpMap:O}=Lv({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:n,dateScheduledMatchUpIds:R,matchUpNotBeforeTimes:i,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:E,matchUps:l}),F=m.filter((e=>e.venueId===v));h[v]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:w,scheduledRoundsDetails:S,dateScheduledMatchUps:b,matchUpsToSchedule:C,scheduleTimes:N,groupedRounds:D,venueCourts:F,minutesMap:T,matchUpMap:O},s||I.push(...R)}return{allDateScheduledByeMatchUpDetails:g,allDateScheduledMatchUpIds:I,venueScheduledRoundDetails:h,allDateMatchUpIds:U}}function Gv({individualParticipantProfiles:e,matchUpNotBeforeTimes:t,matchUpDependencies:n,scheduleTime:r,matchUp:i,details:a}){const o=(n?.[i.matchUpId]?.participantIds||[]).flat(),s=a?.minutesMap?.[i.matchUpId]?.averageMinutes||0,c=a?.minutesMap?.[i.matchUpId]?.recoveryMinutes||0,u=o.every((t=>{Nv({individualParticipantProfiles:e,participantId:t});const n=e[t];if(!n.timeAfterRecovery)return!0;const a=$r(i?.schedule?.endTime),o=a?Zr(a,m(c)):Zr(r,m(s)+m(c));return!!![...Object.keys(n.potentialBookings).filter((e=>e!==i.drawId)).map((e=>n.potentialBookings[e])).flat(),...n.bookings].find((e=>function(e,t){const n=Gr(e.scheduleTime),r=Gr(e.timeAfterRecovery),i=Gr(t.scheduleTime),a=Gr(t.timeAfterRecovery),o=n>i&&n<a,s=i>n&&i<r,c=r>i&&r<a,u=a>n&&a<r;return pi({hasOverlap:n===i||r===a||o||c||s||u,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:r,timeAfterRecovery:o},e).hasOverlap))})),d=t[i.matchUpId],p=d?Xr(Jr(d),Jr(r),!1):0;return{enoughTime:u&&p>=0}}function qv({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpDailyLimits:n={},matchUp:r}){const{matchUpId:i,matchUpType:a}=r,{enteredIndividualParticipantIds:o}=Ph(r),s=(r.roundPosition&&t[i]||[]).flat(),c=P(o.concat(...s));c.forEach((t=>{Nv({individualParticipantProfiles:e,participantId:t})}));return{participantIdsAtLimit:c.filter((t=>{const r=e[t];if(r)return[a,xs].find((e=>{const t=r.counters?.[e]||0,i=n[e]||0;return t&&i&&t>=i}))})),relevantParticipantIds:c}}const $v="deleteDrawDefinitions",Wv="autoSchedulingAudit",Hv="deleteEvents",zv={AUTO_SCHEDULING_AUDIT:Wv,DELETE_EVENTS:Hv,DELETE_DRAW_DEFINITIONS:$v};function Yv({autoSchedulingAudit:e,tournamentRecords:t}){pr({topic:yc,payload:e});const n=e=>{if(!e)return 0;return Object.values(e).reduce(((e,t)=>e+t.length||0),0)},r=(e?.schedulingProfile||[]).reduce(((e,t)=>e+t.venues.reduce(((e,t)=>e+t.rounds.length),0)),0),i={scheduledDatesCount:e.scheduledDates?.length,noTimeMatchUpIdsCount:n(e?.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(e?.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(e?.overLimitMatchUpIds),requestConflictsCount:n(e?.requestConflicts),profileRoundsCount:r},a={itemType:Wv,itemValue:i};for(const o of Object.values(t))wU({tournamentRecord:o,timeItem:a})}function Kv({tournamentRecords:e,requestType:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const n={};for(const r of Object.values(e)){const{extension:e}=As({name:jo,tournamentRecord:r}),i=e?.value||[];for(const r of i){const{personId:e,requests:i}=r||{};n[e]||(n[e]=[]);for(const r of i)t&&r.requestType!==t||n[e].push(r)}}return{personRequests:n}}function Qv({tournamentRecords:e,personRequests:t}){if(!e)return{error:q};if(!t)return{...L};const n=Object.values(e);for(const r of n){const e=r.participants??[],n=[];for(const r of Object.keys(t))if(Rs({tournamentParticipants:e,personId:r})){const e=t[r];e.length&&n.push({personId:r,requests:e})}if(Object.keys(n).length){tc({tournamentRecord:r,extension:{name:jo,value:n}})}}return{...L}}function Jv({personRequests:e,personId:t,requests:n}){e[t]||(e[t]=[]);const r=n.filter((({requestType:e})=>e)).map((e=>{let{date:t,startTime:n,endTime:r}=e;return e.requestType===Ev&&(t=Wr(t),n=$r(n),r=$r(r),t&&n&&r)?{date:t,startTime:n,endTime:r,requestType:e.requestType}:e})).filter(Boolean);for(const i of r)i.requestId=fi(),e[t].push(i);return{mergeCount:r.length}}function Xv({averageMinutes:e,startTime:t,endTime:n,court:r,date:i}){if(!Array.isArray(r.dateAvailability))return{error:mt,stack:"getEarliestCourtTime"};const a=Zh({scheduleDate:i,courts:[r],startTime:!0}),o=Zh({scheduleDate:i,courts:[r],endTime:!0});t=t||a,n=n||o;const s=Kh({courtDate:Yh({court:r,date:i})}),c=Jr(t),u=Jr(n);return{earliestCourtTime:s.reduce(((t,n)=>{const r=Jr(n.startTime),i=Jr(n.endTime);if(r>u||i<c)return t;const a=c>r?c:r;if(Xr(a,i)>=e){const e=$r(a.toISOString());(!t||e<t)&&(t=e)}return t}),void 0),courtStartTime:a,courtEndTime:o}}function Zv({scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:t=Ca,tournamentRecord:n,scheduledDates:r,venueIds:i=[]}){if("object"!=typeof n)return{error:$};if(!Array.isArray(t)||!Array.isArray(i))return{error:xn};i.length&&e.push("venueId");const a=(rh({matchUpFilters:{scheduledDates:r},tournamentRecord:n}).matchUps??[]).filter((n=>n.matchUpStatus&&!t.includes(n.matchUpStatus)&&kv({schedule:n.schedule,scheduleAttributes:e})&&(!i?.length||i.includes(n.schedule.venueId)))).map(Pl),o=rh({tournamentRecord:n,inContext:!1}).matchUps??[];let s=0;for(const c of o)a.includes(c.matchUpId)&&(c.timeItems=(c.timeItems??[]).filter((e=>e?.itemType&&![Jc,Xc,Qc,eu,nu].includes(e?.itemType))),s+=1);return{...L,clearedScheduleCount:s}}function eS({scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:t=Ca,tournamentRecords:n,scheduledDates:r,venueIds:i}){const a=ci(n)?Object.values(n).map((({tournamentId:e})=>e)).filter(Boolean):[];if(!a?.length)return{error:q};for(const o of a){const a=Zv({ignoreMatchUpStatuses:t,scheduleAttributes:e,tournamentRecord:n[o],scheduledDates:r,venueIds:i});if(a.error)return a}return{...L}}function tS({checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:t,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:i,periodLength:a,useGarman:o,dryRun:s,pro:c}){if(!i)return{error:q};if(!Array.isArray(r))return{error:xn};const u=yg({tournamentRecords:i});if(u.error)return u;const{modifications:d,issues:p=[],schedulingProfile:l=[]}=u,m=Object.assign({},...Object.values(i).map((e=>Zg({tournamentRecord:e}).containedStructures))),f=r.map((e=>{if(Or(e))return Wr(e)})).filter(Boolean),h=l.map((e=>e.scheduleDate)).map((e=>Or(e)&&Wr(e))).filter((e=>e&&(!r.length||f.includes(e))));if(!h.length)return{error:ht};if(n&&!s){eS({tournamentRecords:i,scheduledDates:Array.isArray(n)?n:[]})}const I=lg({ignoreDisabled:!1,tournamentRecords:i}).courts,{matchUps:g}=Th({matchUpFilters:{matchUpTypes:[_i,Bi]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:i}),{matchUpDependencies:U}=bh({includeParticipantDependencies:!0,tournamentRecords:i,matchUps:g}),{matchUpDailyLimits:y}=Fg({tournamentRecords:i}),{personRequests:v}=Kv({requestType:Ev,tournamentRecords:i}),S={schedulingProfileModifications:d,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:t,schedulingProfileIssues:p,dateSchedulingProfiles:l.filter((e=>{const t=Wr(e?.scheduleDate);return h.includes(t)})).sort(((e,t)=>new Date(e.scheduleDate).getTime()-new Date(t.scheduleDate).getTime())),containedStructureIds:m,matchUpDependencies:U,matchUpDailyLimits:y,clearScheduleDates:n,tournamentRecords:i,schedulingProfile:l,personRequests:v,periodLength:a,useGarman:o,matchUps:g,dryRun:s,courts:I};return c?function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:n,schedulingProfileIssues:r,dateSchedulingProfiles:i,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:c,tournamentRecords:u,periodLength:d=30,schedulingProfile:p,personRequests:l,matchUps:m=[],courts:f,dryRun:h}){const I={},g={},U={},y={},v={},S={},w={},P={},T={};for(const b of i??[]){const e=Wr(b?.scheduleDate),r=b?.venues||[],i={},p={},D=(e,t)=>{e.forEach((e=>{const n=p[e].counters;n[t]?n[t]+=1:n[t]=1,n[xs]?n[xs]+=1:n[xs]=1}))};I[e]={},g[e]={},S[e]=[],w[e]=[],P[e]=[],T[e]=[];const R={};m?.forEach((t=>{t.schedule?.scheduledDate&&ni(e,Wr(t.schedule.scheduledDate))&&bv({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:R,matchUp:t})}));const{allDateScheduledByeMatchUpDetails:N,allDateScheduledMatchUpIds:M,venueScheduledRoundDetails:A,allDateMatchUpIds:E}=jv({matchUpPotentialParticipantIds:i,individualParticipantProfiles:p,scheduleCompletedMatchUps:n,containedStructureIds:a,matchUpNotBeforeTimes:R,matchUpScheduleTimes:v,matchUpDependencies:o,clearScheduleDates:c,tournamentRecords:u,periodLength:d,scheduleDate:e,matchUps:m,courts:f,venues:r}),C=m?.filter((({matchUpId:e})=>M.includes(e))),{bookings:O}=Bv({dateScheduledMatchUps:C,tournamentRecords:u,scheduleDate:e,periodLength:d}),{virtualCourts:F}=Jh({scheduleDate:e,periodLength:d,bookings:O,courts:f}),k=F?.reduce(((t,n)=>{const{earliestCourtTime:r,courtEndTime:i}=Xv({date:e,averageMinutes:0,court:n});return(!t.startTime||Jr(r)<Jr(t.startTime))&&(t.startTime=r),(!t.endTime||Jr(i)>Jr(t.endTime))&&(t.endTime=i),t}),{});let x=k.startTime;const _=({courtId:e,booking:t})=>F?.find((t=>t.courtId===e))?.dateAvailability[0].bookings.push(t),L=10;let B,V=0;for(;!B;){for(const{venueId:n}of r){const r=A[n],a=r.matchUpsToSchedule.length,c=[],u=[];let m,f=0;for(;!m;){for(const a of r.matchUpsToSchedule){if(u.length===r.courtsCount||c.length===r.courtsCount){m=!0;break}const{matchUpId:f,matchUpType:h}=a,{participantIdsAtLimit:S,relevantParticipantIds:P}=qv({matchUpPotentialParticipantIds:i,individualParticipantProfiles:p,matchUpDailyLimits:s,matchUp:a});if(S.length){w[e].includes(f)||w[e].push(f);continue}const{dependenciesScheduled:b,remainingDependencies:N}=Rv({matchUpScheduleTimes:v,matchUpDependencies:o,allDateMatchUpIds:E,matchUp:a});if(!b){g[e][f]||(g[e][f]=[]),g[e][f].push({remainingDependencies:N});continue}const M=[],A=F?.reduce(((n,s)=>{if(u.includes(s.courtId))return n;const{earliestCourtTime:c}=Xv({averageMinutes:r.greatestAverageMinutes,startTime:x,date:e,court:s});if(n.scheduleTime&&Gr(c)>=Gr(n.scheduleTime))return n;const{scheduledDependent:d}=Av({matchUpScheduleTimes:v,matchUpDependencies:o,scheduleTime:c,matchUpId:f,details:r});if(d)return n;const{enoughTime:m}=Gv({individualParticipantProfiles:p,matchUpNotBeforeTimes:R,matchUpDependencies:o,scheduleTime:c,details:r,matchUp:a});if(!m)return I[e][f]||(I[e][f]=[]),I[e][f].includes(c)||I[e][f].push(c),n;const g=r.minutesMap?.[f]?.averageMinutes||r.greatestAverageMinutes,{conflicts:U}=Ov({potentials:t,averageMatchUpMinutes:g,requestConflicts:T,personRequests:l,scheduleTime:c,scheduleDate:e,matchUp:a});if(U?.length)return M.push(...U),!1;D(P,h);const y=r.minutesMap?.[f]?.recoveryMinutes;return Mv({matchUpPotentialParticipantIds:i,individualParticipantProfiles:p,matchUpNotBeforeTimes:R,averageMatchUpMinutes:g,matchUpDependencies:o,recoveryMinutes:y,scheduleTime:c,matchUp:a}),(!n.scheduleTime||Gr(c)<Gr(n.scheduleTime))&&(n.averageMatchUpMinutes=g,n.recoveryMinutes=y,n.scheduleTime=c,n.courtName=s.courtName,n.courtId=s.courtId),n}),{});if(A.scheduleTime){const{averageMatchUpMinutes:e,recoveryMinutes:t,scheduleTime:i,courtId:a}=A;v[f]=i,y[f]=a,c.push(f),u.push(a);const o=i,s=Zr(o,e);_({courtId:a,booking:{averageMatchUpMinutes:e,recoveryMinutes:t,periodLength:d,matchUpId:f,startTime:o,courtId:a,endTime:s,venueId:n}}),r.matchUpsToSchedule=r.matchUpsToSchedule.filter((e=>e.matchUpId!==f))}else M?.length&&(U[e]||(U[e]=[]),U[e].push(...M))}u.length!==r.courtsCount&&c.length!==r.courtsCount&&r.matchUpsToSchedule.length||(m=!0),r.matchUpsToSchedule.length&&c<r.courtsCount&&(Jr(x)<Jr(k.endTime)?x=Zr(x,d):(m=!0,r.complete=!0)),f+=1,!m&&f>=a&&(m=!0)}r.matchUpsToSchedule?.length||(r.complete=!0)}V+=1,B=r.every((({venueId:e})=>A[e].complete))||V===L}for(const{venueId:t}of r){const n=A[t].matchUpMap;Object.keys(n).forEach((t=>{const r=u[t];r&&Object.keys(n[t]).forEach((i=>{const{drawDefinition:a}=VU({tournamentRecord:r,drawId:i});a&&n[t][i].forEach((({matchUpId:t})=>{const n=v[t],i=y[t];if(n){const o=n.split(":").map(ti).join(":"),s=`${Wr(e)}T${o}`;h||(NU({drawDefinition:a,scheduledTime:s,matchUpId:t}),bU({courtDayDate:e,tournamentRecords:u,tournamentRecord:r,drawDefinition:a,matchUpId:t,courtId:i})),S[e].push(t)}}))}))})),P[e]=A[t].matchUpsToSchedule.map(Pl)}!h&&N?.length&&GU({matchUpDetails:N,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(const t of b.venues)for(const n of t.rounds){const t=(n.matchUps??[]).map((({matchUpId:e})=>e)),r=t?.filter((t=>S[e].includes(t)));n.canScheduledMatchUpIds=r;let i=Math.round((r?.length||0)/n.matchUpsCount*1e4)/100;(i===1/0||isNaN(i))&&(i=void 0),n.possibleToSchedulePct=i,n.matchUpsCount===r?.length&&(n.possibleToSchedule=!0)}}const D=(i??[]).map((({scheduleDate:e})=>e)),R={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:S,schedulingProfile:p,noTimeMatchUpIds:P,requestConflicts:T,scheduledDates:D};return Yv({tournamentRecords:u,autoSchedulingAudit:R}),{...L,schedulingProfileModifications:e,schedulingProfileIssues:r,dateSchedulingProfiles:i,recoveryTimeDeferredMatchUpIds:I,dependencyDeferredMatchUpIds:g,matchUpScheduleTimes:v,overLimitMatchUpIds:w,scheduledMatchUpIds:S,noTimeMatchUpIds:P,requestConflicts:T,scheduledDates:D}}(S):function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:n,schedulingProfileIssues:r,dateSchedulingProfiles:i,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:c,tournamentRecords:u,schedulingProfile:d,personRequests:p,periodLength:l,matchUps:m,courts:f,dryRun:h}){const I={},g={},U={},y={},v={},S={},w={},P={},T={},D={};for(const N of i){const e=Wr(N?.scheduleDate),r=N?.venues||[],i={},d={},R=(e,t)=>{e.forEach((e=>{const n=d[e].counters;n[t]?n[t]+=1:n[t]=1,n[xs]?n[xs]+=1:n[xs]=1}))};U[e]={},y[e]={},I[e]={},g[e]={},w[e]=[],P[e]=[],T[e]=[],D[e]=[];const b={};m.forEach((t=>{t.schedule?.scheduledDate&&ni(e,Wr(t.schedule.scheduledDate))&&bv({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:b,matchUp:t})}));const{allDateScheduledByeMatchUpDetails:M,venueScheduledRoundDetails:A,allDateMatchUpIds:E}=jv({matchUpPotentialParticipantIds:i,individualParticipantProfiles:d,scheduleCompletedMatchUps:n,containedStructureIds:a,matchUpNotBeforeTimes:b,matchUpScheduleTimes:S,matchUpDependencies:o,clearScheduleDates:c,tournamentRecords:u,useGarman:!0,periodLength:l,scheduleDate:e,matchUps:m,courts:f,venues:r}),C=10;let O,F=0;const k=10;for(;!O;){for(const{venueId:n}of r){let r=0;const a=A[n];for(;a.courtsCount&&a.scheduleTimes?.length&&a.matchUpsToSchedule?.length&&r<=a.courtsCount;){const{scheduleTime:c,attempts:u=0}=a.scheduleTimes.shift(),l=a.matchUpsToSchedule.find((n=>{const{matchUpId:r,matchUpType:u}=n,{participantIdsAtLimit:l,relevantParticipantIds:m}=qv({matchUpPotentialParticipantIds:i,individualParticipantProfiles:d,matchUpDailyLimits:s,matchUp:n});if(l.length)return P[e].includes(r)||P[e].push(r),!1;const{scheduledDependent:f}=Av({matchUpScheduleTimes:S,matchUpDependencies:o,scheduleTime:c,matchUpId:r,details:a});if(f)return!1;const{dependenciesScheduled:h,remainingDependencies:I}=Rv({matchUpScheduleTimes:S,matchUpDependencies:o,allDateMatchUpIds:E,matchUp:n});if(!h)return y[e][r]||(y[e][r]=[]),y[e][r].push({scheduleTime:c,remainingDependencies:I}),!1;const{enoughTime:g}=Gv({individualParticipantProfiles:d,matchUpNotBeforeTimes:b,matchUpDependencies:o,scheduleTime:c,details:a,matchUp:n});if(!g)return U[e][r]||(U[e][r]=[]),U[e][r].push({scheduleTime:c}),!1;const w=a.greatestAverageMinutes,{conflicts:T}=Ov({potentials:t,averageMatchUpMinutes:w,requestConflicts:D,personRequests:p,scheduleTime:c,scheduleDate:e,matchUp:n});if(T?.length)return v[e]||(v[e]=[]),v[e].push(...T),!1;R(m,u);const N=a.minutesMap?.[r]?.recoveryMinutes;return Mv({matchUpPotentialParticipantIds:i,individualParticipantProfiles:d,matchUpNotBeforeTimes:b,averageMatchUpMinutes:w,matchUpDependencies:o,recoveryMinutes:N,scheduleTime:c,matchUp:n}),S[r]=c,!0}));a.matchUpsToSchedule=a.matchUpsToSchedule.filter((({matchUpId:e})=>e!==l?.matchUpId)),l?r+=1:(g[e][n]||(g[e][n]=[]),g[e][n].push({scheduleTime:c,attempts:u+1}))}a.matchUpsToSchedule?.length&&(g[e][n]=g[e][n]?.filter((e=>{const t=e.attempts<C;return t&&a.scheduleTimes.push(e),!t}))),a.scheduleTimes?.length&&a.matchUpsToSchedule?.length||(a.complete=!0)}F+=1,O=r.every((({venueId:e})=>A[e].complete))||F===k}for(const{venueId:t}of r){const n=A[t].matchUpMap;Object.keys(n).forEach((r=>{const i=u[r];i&&Object.keys(n[r]).forEach((a=>{const{drawDefinition:o}=VU({tournamentRecord:i,drawId:a});o&&n[r][a].forEach((({matchUpId:n})=>{const r=S[n];if(r){const a=r.split(":").map(ti).join(":"),s=`${Wr(e)}T${a}`;h?w[e].push(n):(NU({drawDefinition:o,scheduledTime:s,matchUpId:n}).success&&w[e].push(n),t&&RU({tournamentRecord:i,drawDefinition:o,matchUpId:n,venueId:t}))}}))}))})),T[e]=A[t].matchUpsToSchedule.map(Pl),I[e][t]=A[t].scheduleTimes.sort(((e,t)=>Gr(e.scheduleTime)-Gr(t.scheduleTime)))}!h&&M?.length&&GU({matchUpDetails:M,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(const t of N.venues)for(const n of t.rounds){const t=n.matchUps?.map((({matchUpId:e})=>e))||[],r=t.filter((t=>w[e].includes(t)));n.canScheduledMatchUpIds=r;let i=Math.round(r.length/n.matchUpsCount*1e4)/100;(i===1/0||isNaN(i))&&(i=0),n.possibleToSchedulePct=i,n.matchUpsCount===r.length&&(n.possibleToSchedule=!0)}}const R=i.map((({scheduleDate:e})=>e)),b={timeStamp:Date.now(),overLimitMatchUpIds:P,scheduledMatchUpIds:w,schedulingProfile:d,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:R};return Yv({tournamentRecords:u,autoSchedulingAudit:b}),{...L,schedulingProfileModifications:e,schedulingProfileIssues:r,scheduleTimesRemaining:I,dateSchedulingProfiles:i,skippedScheduleTimes:g,recoveryTimeDeferredMatchUpIds:U,dependencyDeferredMatchUpIds:y,matchUpScheduleTimes:S,overLimitMatchUpIds:P,scheduledMatchUpIds:w,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:R}}(S)}function nS({event:e}){return e?ac({event:e,name:Wo}):{error:Ae}}function rS({tournamentParticipants:e,tournamentRecord:t,drawDefinition:n,participantId:r,matchUpId:i,matchUp:a,event:o}){if(!r)return{error:Lt};if(!i)return{error:et};if(e=e??t?.participants,e?.length){if(!a&&n){const t=Qp({tournamentParticipants:e,inContext:!0,drawDefinition:n,matchUpId:i,event:o});if(!t.matchUp)return{error:Xe};a=t.matchUp}const t=qp({matchUp:a});if(t.error)return t;const{checkedInParticipantIds:s,allRelevantParticipantIds:c}=t;if(!c.includes(r))return{error:Et};if(s.includes(r))return{error:Wt}}return TU({tournamentRecord:t,drawDefinition:n,matchUpId:i,timeItem:{itemType:Yc,itemValue:r}})}function iS({tournamentParticipants:e,tournamentRecord:t,drawDefinition:n,participantId:r,matchUpId:i,matchUp:a,event:o}){if(!r)return{error:Lt};if(!i&&!a)return{error:Qe};if(e=e??t?.participants,!a){const t=Qp({tournamentParticipants:e,inContext:!0,drawDefinition:n,matchUpId:i,event:o});if(t.error)return t;if(!t.matchUp)return{error:Xe};a=t.matchUp}const{matchUpStatus:s,score:c}=a;if(s&&Oa.includes(s)||s&&Ca.includes(s)||dl({score:c}))return{error:ge};if(e?.length){const{checkedInParticipantIds:e,allRelevantParticipantIds:t}=qp({matchUp:a});if(!t?.includes(r))return{error:Et};if(!e.includes(r))return{error:$t};const{sideParticipantIds:o,nestedIndividualParticipantIds:s}=Gp({matchUp:a}),c=o.indexOf(r);[0,1].includes(c)&&(s[c]||[]).forEach((e=>{TU({drawDefinition:n,matchUpId:i,timeItem:{itemType:Kc,itemValue:e}})}))}return TU({tournamentRecord:t,drawDefinition:n,matchUpId:i,timeItem:{itemType:Kc,itemValue:r}})}function aS(e){if(!e?.tournamentRecord)return{error:$};const{tournamentRecord:t,participantId:n,matchUpId:r,drawDefinition:i,event:a}=e,o=t.participants||[],s=MI({tournamentRecord:t,inContext:!0,drawDefinition:i,matchUpId:r,event:a});if(!s.matchUp)return{error:Xe};const c=s.matchUp,{checkedInParticipantIds:u=[]}=qp({matchUp:c});return u.includes(n)?iS({tournamentParticipants:o,tournamentRecord:t,drawDefinition:i,participantId:n,matchUpId:r,matchUp:c}):rS({tournamentParticipants:o,tournamentRecord:t,drawDefinition:i,participantId:n,matchUpId:r,matchUp:c})}function oS(e){const{tournamentRecords:t}=e;if(!t)return{error:q};const{removePriorValues:n,tournamentId:r,courtDayDate:i,matchUpId:a,courtId:o,drawId:s}=e,c=t[r];if(!c)return{error:$};const{drawDefinition:u,event:d}=VU({tournamentRecord:c,drawId:s});if(!u)return{error:Y};const p=Qp({drawDefinition:u,event:d,matchUpId:a});if(p.error)return p;if(p?.matchUp?.matchUpType===Vi){const{itemValue:e}=Pu({timeItems:p.matchUp.timeItems??[],itemType:Jc}),t=o&&e.filter((e=>e.courtId!==o));return TU({duplicateValues:!1,removePriorValues:n,tournamentRecord:c,drawDefinition:u,matchUpId:a,timeItem:{itemType:Jc,itemValue:t}})}return bU({tournamentRecord:c,drawDefinition:u,courtDayDate:i,courtId:"",matchUpId:a})}function sS(e){return EU(e)}function cS({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,scheduledDate:i,matchUpId:a}){return CU({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,scheduledDate:i,matchUpId:a})}function uS({removePriorValues:e,tournamentRecord:t,drawDefinition:n,scheduledTime:r,disableNotice:i,matchUpId:a}){return NU({removePriorValues:e,tournamentRecord:t,drawDefinition:n,scheduledTime:r,disableNotice:i,matchUpId:a})}function dS({tournamentRecord:e,drawDefinition:t,disableNotice:n,matchUpId:r,startTime:i}){return kU({tournamentRecord:e,drawDefinition:t,disableNotice:n,matchUpId:r,startTime:i})}function pS({tournamentRecord:e,drawDefinition:t,disableNotice:n,matchUpId:r,endTime:i}){return xU({tournamentRecord:e,drawDefinition:t,disableNotice:n,matchUpId:r,endTime:i})}function lS({tournamentRecord:e,drawDefinition:t,disableNotice:n,matchUpId:r,stopTime:i}){return _U({tournamentRecord:e,drawDefinition:t,disableNotice:n,matchUpId:r,stopTime:i})}function mS({tournamentRecord:e,drawDefinition:t,disableNotice:n,resumeTime:r,matchUpId:i}){return LU({tournamentRecord:e,drawDefinition:t,disableNotice:n,resumeTime:r,matchUpId:i})}function fS({tournamentRecord:e,drawDefinition:t,disableNotice:n,participantId:r,officialType:i,matchUpId:a}){if(!r)return{error:Lt};return Rs({tournamentParticipants:Kg({tournamentRecord:e,participantFilters:{participantTypes:[qu],participantRoles:[Ji.Official]}}).participants??[],participantId:r})?FU({drawDefinition:t,disableNotice:n,participantId:r,officialType:i,matchUpId:a}):{error:Bt}}function hS({tournamentRecord:e,scheduleChange:t,matchUpIds:n,dryRun:r}){if(!e)return{error:$};if(!n||!Array.isArray(n))return{error:Je};if("object"!=typeof t)return{error:xn};const i=[],a=[],{minutesChange:o,daysChange:s}=t;if(!o&&!s)return{...L};if(o&&isNaN(o))return{error:xn};if(s&&isNaN(s))return{error:xn};const{matchUps:c}=rh({matchUpFilters:{matchUpIds:n},tournamentRecord:e}),u=c?.filter((e=>kv({schedule:e.schedule}))).filter((e=>(({matchUpStatus:e})=>!Ca.includes(e))({matchUpStatus:e.matchUpStatus})));if(!u?.length)return{...L};const{tournamentInfo:d}=Ig({tournamentRecord:e}),{startDate:p,endDate:l}=d,m=u?.reduce(((e,t)=>{const{matchUpId:n,drawId:r}=t;return e[r]?e[r].push(n):e[r]=[n],e}),{});for(const U of Object.keys(m)){const t=VU({tournamentRecord:e,drawId:U});if(t.error)return t;const c=t.drawDefinition,d=m[U].filter((e=>n.includes(e)));for(const e of d)if(e&&c){const t=u.find((t=>t.matchUpId===e)),n=t?.schedule,{scheduledTime:d,scheduledDate:m}=n;let f,h,I;if(!f&&s&&m){I=Hr(Wr(m),s),f=new Date(I)<new Date(p)||new Date(I)>new Date(l)}if(o&&d){const e=Wr(d),t=Gr($r(d))+o;if(f=t<0||t>1440,!f){const t=Zr(d,o),n=e&&I||m===e&&e;h=n?`${n}T${t}`:t}}if(f)a.push(e);else{if(!r){if(h){const t=uS({scheduledTime:h,drawDefinition:c,matchUpId:e});if(t.error)return t}if(I){const t=cS({scheduledDate:I,drawDefinition:c,matchUpId:e});if(t.error)return t}}(h||I)&&i.push(e)}}}const f=rh({matchUpFilters:{matchUpIds:n},tournamentRecord:e}).matchUps??[],h=f.filter((({matchUpId:e})=>i.includes(e))),I=f.filter((({matchUpId:e})=>a.includes(e))),g=h.length&&!I.length;return{...L,rescheduled:h,notRescheduled:I,allRescheduled:g}}function IS({tournamentRecord:e,dailyLimits:t}){return e?"object"!=typeof t?{error:On}:tc({extension:{name:$o,value:{dailyLimits:t}},tournamentRecord:e}):{error:$}}const gS={scheduleMatchUps:function({tournamentRecords:e,competitionMatchUps:t,matchUpDependencies:n,allDateMatchUpIds:r=[],averageMatchUpMinutes:i=90,recoveryMinutes:a=0,recoveryMinutesMap:o,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:c={},matchUpNotBeforeTimes:u={},matchUpDailyLimits:d={},checkPotentialRequestConflicts:p=!0,remainingScheduleTimes:l,clearScheduleDates:m,periodLength:f=30,scheduleDate:h,matchUpIds:I,venueIds:g,startTime:U,endTime:y,dryRun:v}){if(!e)return{error:q};if(!I)return{error:Je};if(!Or(h))return{error:yt};if(isNaN(f)||isNaN(i)||isNaN(a))return{error:xn};t||({matchUps:t}=Th({tournamentRecords:e,nextMatchUps:!0})),n||({matchUpDependencies:n}=bh({includeParticipantDependencies:!0,matchUps:t,tournamentRecords:e})),t.forEach((e=>{e.schedule?.scheduledDate&&ni(h,Wr(e.schedule.scheduledDate))&&bv({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:u,matchUp:e})}));const S=I.map((e=>t.find((t=>t.matchUpId===e)))).filter(Boolean),{venueId:w,scheduleTimes:P,dateScheduledMatchUpIds:T}=Dv({tournamentRecords:e,remainingScheduleTimes:l,startTime:$r(U),endTime:$r(y),scheduleDate:Wr(h),averageMatchUpMinutes:i,clearScheduleDates:m,periodLength:f,venueIds:g}),D={},R=[],b={},N={},M={},A=t.filter((({matchUpId:e})=>T?.includes(e)));A.forEach((e=>{Fv({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUp:e,value:1});const t=e.schedule?.scheduledTime;if(t){b[e.matchUpId]=t;const r=o?.[e.matchUpId];Mv({recoveryMinutes:r||a,matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUpNotBeforeTimes:u,averageMatchUpMinutes:i,matchUpDependencies:n,scheduleTime:t,matchUp:e})}}));let E=S.filter((e=>{const t=T?.includes(e.matchUpId),n=[ma,ga,ha,pa,Pa,Ra].includes(e?.matchUpStatus);return!t&&!e.winningSide&&!n}));const{matchUpMap:C,overLimitMatchUpIds:O,participantIdsAtLimit:F}=E.reduce(((e,t)=>{const{drawId:n,tournamentId:r,matchUpType:i}=t,{participantIdsAtLimit:a,relevantParticipantIds:o}=qv({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpDailyLimits:d,matchUp:t});return a?.length?(e.overLimitMatchUpIds.push(t.matchUpId),e.participantIdsAtLimit.push(...a),e):(o.forEach((e=>{Nv({individualParticipantProfiles:c,participantId:e});const t=c[e].counters;t[i]?t[i]+=1:t[i]=1,t[xs]?t[xs]+=1:t[xs]=1})),e.matchUpMap[r]||(e.matchUpMap[r]={}),e.matchUpMap[r][n]?e.matchUpMap[r][n].push(t):e.matchUpMap[r][n]=[t],bv({matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:u,matchUp:t}),e)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});E=E.filter((({matchUpId:e})=>!O.includes(e)));let k=0;const x=P?.length??0,{personRequests:_}=Kv({tournamentRecords:e,requestType:Ev});for(;P?.length&&E.length&&k<=x;){k++;const{scheduleTime:e}=P.shift(),t=E.find((t=>{const{matchUpId:d}=t,{dependenciesScheduled:l,remainingDependencies:m}=Rv({matchUpScheduleTimes:b,matchUpDependencies:n,allDateMatchUpIds:r,matchUp:t});if(!l)return M[d]||(M[d]=[]),M[d].push({scheduleTime:e,remainingDependencies:m}),!1;const{enoughTime:f}=Gv({individualParticipantProfiles:c,matchUpNotBeforeTimes:u,matchUpDependencies:n,scheduleTime:e,matchUp:t});if(!f)return N[d]||(N[d]=[]),N[d].push({scheduleTime:e}),!1;const{conflicts:I}=Ov({potentials:p,averageMatchUpMinutes:i,requestConflicts:D,personRequests:_,scheduleTime:e,scheduleDate:h,matchUp:t});if(I?.length)return!1;const g=o?.[t.matchUpId];return Mv({recoveryMinutes:g||a,matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUpNotBeforeTimes:u,averageMatchUpMinutes:i,matchUpDependencies:n,scheduleTime:e,matchUp:t}),b[t.matchUpId]=e,!0}));E=E.filter((({matchUpId:e})=>e!==t?.matchUpId)),t||R.push(e)}E.forEach((e=>{Fv({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,value:-1,matchUp:e})}));const B=[];Object.keys(C).forEach((t=>{const n=e[t];n&&Object.keys(C[t]).forEach((r=>{const{drawDefinition:i}=VU({tournamentRecord:n,drawId:r});if(i){C[t][r].forEach((({matchUpId:t})=>{const r=b[t];if(r){const a=r.split(":").map(ti).join(":"),o=`${Wr(h)}T${a}`;if(v)B.push(t);else{NU({drawDefinition:i,matchUpId:t,scheduledTime:o}).success&&B.push(t),w&&RU({tournamentRecords:e,tournamentRecord:n,drawDefinition:i,matchUpId:t,venueId:w})}}}))}}))}));const V=yl(E);return{...L,requestConflicts:Object.values(D),remainingScheduleTimes:P?.map((({scheduleTime:e})=>e)),individualParticipantProfiles:c,matchUpNotBeforeTimes:u,participantIdsAtLimit:F,skippedScheduleTimes:R,overLimitMatchUpIds:O,scheduledMatchUpIds:B,noTimeMatchUpIds:V,recoveryTimeDeferred:N,dependencyDeferred:M}},scheduleProfileRounds:tS,clearScheduledMatchUps:eS,bulkRescheduleMatchUps:function({tournamentRecords:e,scheduleChange:t,matchUpIds:n,dryRun:r}){if(!n||!Array.isArray(n))return{error:Je};if("object"!=typeof t)return{error:xn};const i=[];let a=[];for(const s of Object.values(e)){const e=hS({tournamentRecord:s,scheduleChange:t,matchUpIds:n,dryRun:r});if(e.error)return e;Array.isArray(e.notRescheduled)&&a.push(...e.notRescheduled);const o=yl(e.notRescheduled),c=[];e.rescheduled?.forEach((e=>{const{matchUpId:t}=e;o.includes(t)&&c.push(t),i.push(e)})),c.length&&(a=e?.notRescheduled?.filter((({matchUpId:e})=>!c.includes(e)))||[])}const o=!(!i.length||a.length);return{...L,rescheduled:i,notRescheduled:a,allRescheduled:o}},getScheduledRoundsDetails:Tv,getMatchUpDependencies:bh,generateVirtualCourts:Jh,generateBookings:Bv,proAutoSchedule:function({scheduleCompletedMatchUps:e,tournamentRecords:t,scheduledDate:n,matchUps:r}){if(!La(r))return{error:xn};if(r.some((({hasContext:e})=>!e)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Tn};let i=_g({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:t,matchUpFilters:{localPerspective:!0,scheduledDate:n}});if(i.error)return i;const{rows:a}=i,o=[],s=e=>[(e.sides||[]).map((e=>[e.participantId,e.participant?.individualParticipantIds])),(e.potentialParticipants||[]).flat().map((e=>[e.participantId,e.individualParticipantIds]))].flat(1/0).filter(Boolean),c=a?.reduce(((e,t)=>{const n=[],r=[];Object.values(t).forEach((e=>{if(ci(e)&&(e.matchUpId&&(n.push(e.matchUpId),o.push(e)),e.sides)){const t=s(e);r.push(...t)}}));const i=Object.values(t).filter((e=>ci(e)&&!e.matchUpId));return e.concat({matchUpIds:n,availableCourts:i,rowId:t.rowId,participantIds:r})}),[]);r.filter((({matchUpStatus:t})=>t&&t!==Ki.Bye&&(e||!Ca.includes(t)))).sort(Rh);const u=bh({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:t}).matchUpDependencies,d=[],p=[];for(;r.length&&c.length;){const e=c.shift(),t=[];for(;r.length&&e.availableCourts.length;){const n=r.concat(t).map((e=>e.matchUpId)),i=r.shift(),a=i?.matchUpId,o=a&&u[a].matchUpIds.concat(u[a].dependentMatchUpIds),c=a&&n.some((e=>u[a].matchUpIds.includes(e))),l=a&&p.some((e=>u[a].dependentMatchUpIds.includes(e))),m=e.matchUpIds.some((e=>o.includes(e))),f=s(i),h=e.participantIds.some((e=>f.includes(e)));if(!i||m||c||h||l)i&&t.push(i);else{const t=e.availableCourts.shift();Object.assign(i.schedule,t.schedule),Object.assign(t,i),d.push(i),e.participantIds.push(...f),e.matchUpIds.push(a)}}r.push(...t),p.push(...e.matchUpIds)}const l=d.map((({matchUpId:e,tournamentId:t,schedule:r,drawId:i})=>({tournamentId:t,matchUpId:e,drawId:i,schedule:{...r,scheduledDate:n}})));i=GU({tournamentRecords:t,matchUpDetails:l});const m=r;return{...i,scheduled:d,notScheduled:m}},proConflicts:Nh,matchUpScheduleChange:function(e){const t="matchUpScheduleChange",{tournamentRecords:n}=e;if("object"!=typeof n||!Object.keys(n).length)return{error:q};const{sourceMatchUpContextIds:r,targetMatchUpContextIds:i,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=e||{},{drawId:c,matchUpId:u,tournamentId:d}=r||{},{drawId:p,matchUpId:l,tournamentId:m}=i||{};if(!u&&!l)return Mi({result:{error:mt},stack:t});const{matchUps:f}=Th({matchUpFilters:{matchUpIds:[u,l].filter(Boolean),drawIds:[c,p].filter(Boolean)},tournamentRecords:e.tournamentRecords}),h=f?.find((({matchUpId:e})=>e===u)),I=f?.find((({matchUpId:e})=>e===l));let g=0;if(o&&u&&!l){const e=U({tournamentId:d,matchUpId:u,courtId:o,matchUp:h,drawId:c,tournamentRecords:n,sourceCourtId:a,courtDayDate:s});if(e?.success&&g++,e.error)return Mi({result:e,stack:t})}else{if(!(a&&o&&u&&l))return{error:mt};{const e=U({tournamentId:d,matchUpId:u,courtId:o,matchUp:h,drawId:c,tournamentRecords:n,sourceCourtId:a,courtDayDate:s});if(e.success&&g++,e.error)return Mi({result:e,stack:t,info:"source"});const r=U({tournamentId:m,sourceCourtId:o,matchUpId:l,matchUp:I,courtId:a,drawId:p,tournamentRecords:n,courtDayDate:s});if(r.success&&g++,r.error)return Mi({result:r,stack:t,info:"target"})}}return g?L:Mi({result:{error:Nn},stack:t});function U(e){const{tournamentRecords:t,tournamentId:n,matchUp:r,drawId:i}=e,a=t[n],{drawDefinition:o}=VU({tournamentRecord:a,drawId:i});return r.matchUpType===ji?function({removePriorValues:e,tournamentRecords:t,tournamentRecord:n,drawDefinition:r,sourceCourtId:i,courtDayDate:a,matchUpId:o,matchUp:s,courtId:c}){const u=[c].concat(s.schedule.allocatedCourts.map((({courtId:e})=>e)).filter((e=>e!==i)));return DU({removePriorValues:e,tournamentRecords:t,tournamentRecord:n,drawDefinition:r,courtDayDate:a,matchUpId:o,courtIds:u})}({...e,tournamentRecord:a,drawDefinition:o}):function({tournamentRecords:e,tournamentRecord:t,drawDefinition:n,courtDayDate:r,matchUpId:i,courtId:a}){return bU({tournamentRecords:e,tournamentRecord:t,drawDefinition:n,courtDayDate:r,matchUpId:i,courtId:a})}({...e,tournamentRecord:a,drawDefinition:o})}},calculateScheduleTimes:Dv,reorderUpcomingMatchUps:function(e){const t="reorderUpcomingMatchUps",{tournamentRecords:n}=e;if("object"!=typeof n||!Object.keys(n).length)return Mi({result:{error:q},stack:t});const{matchUpsContextIds:r,firstToLast:i}=e;if(!r)return Mi({result:{error:mt},stack:t});const a=r?.length;if(!a)return{...L};let o=0;return r.forEach(((e,t)=>{const{tournamentId:s,drawId:c,matchUpId:u}=e;let d=t+(i?-1:1);d<0&&(d=a-1),d===a&&(d=0);const p=function({tournamentId:e,scheduledTime:t,matchUpId:r,drawId:i}){const a=n[e],{drawDefinition:o}=VU({tournamentRecord:a,drawId:i});return o?NU({drawDefinition:o,scheduledTime:t,matchUpId:r}):{error:Q}}({tournamentId:s,scheduledTime:r[d].schedule.scheduledTime,matchUpId:u,drawId:c});if(!p.success)return p;o++})),o===a?L:Mi({result:{error:bn},stack:t})},bulkUpdateCourtAssignments:function({tournamentRecords:e,courtAssignments:t,courtDayDate:n}){if(!e)return{error:q};if(!Array.isArray(t))return{error:mt,info:sa("courtAssignments")};const r=t.reduce(((e,t)=>{const{tournamentId:n}=t;return e[n]||(e[n]=[]),e[n].push(t),e}),{});let i;return Object.keys(r).every((t=>{const a=e[t];if(!a)return i={error:$},!1;const o=r[t].reduce(((e,t)=>{const{drawId:n}=t;return e[n]||(e[n]=[]),e[n].push(t),e}),{});Object.keys(o).every((e=>{const{drawDefinition:t}=Qs({tournamentRecord:a,drawId:e});return t?(o[e].every((e=>{const{matchUpId:r,courtId:o}=e,s=bU({tournamentRecord:a,drawDefinition:t,courtDayDate:n,matchUpId:r,courtId:o});if(s.success)return s?.success;i={error:Mn}})),!0):(i={error:Y},!1)}))})),i||L},removeMatchUpCourtAssignment:oS,toggleParticipantCheckInState:function(e){const{tournamentRecords:t}=e,{participantId:n,tournamentId:r,matchUpId:i,drawId:a}=e;if(!(t&&r&&n&&i))return{error:mt,stack:"toggleParticipantCheckInState"};const o=t[r],{drawDefinition:s,event:c}=VU({tournamentRecord:o,drawId:a});return Object.assign(e,{drawDefinition:s,event:c,tournamentRecord:o}),aS(e)},findMatchUpFormatTiming:Tg,modifyMatchUpFormatTiming:function({tournamentRecords:e,matchUpFormat:t,recoveryTimes:n,averageTimes:r,tournamentId:i,eventId:a}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const o=Object.keys(e).filter((e=>!i||i===e));if(i&&!o.includes(i))return{error:xn};let s;for(const c of o){const i=e[c],{event:o}=Qs({tournamentRecord:i,eventId:a});a&&o&&(s=!0);const u=Sv({tournamentRecord:i,event:o,matchUpFormat:t,averageTimes:r,recoveryTimes:n});if(u.error)return u}return!a||s?{...L}:{error:Ee}},modifyEventMatchUpFormatTiming:function({tournamentRecords:e,recoveryMinutes:t,averageMinutes:n,matchUpFormat:r,categoryType:i,tournamentId:a,eventId:o}){if(!o)return{error:Ae};const s=Object.keys(e).filter((e=>!a||a===e));if(a&&!s.includes(a))return{error:xn};for(const c of s){const a=e[c],{event:s}=Qs({tournamentRecord:a,eventId:o});if(s)return Pv({tournamentRecord:a,recoveryMinutes:t,averageMinutes:n,matchUpFormat:r,categoryType:i,event:s})}return{error:Ee}},getMatchUpFormatTimingUpdate:function({tournamentRecords:e}){return AI({extensionName:Wo,tournamentRecords:e})},getEventMatchUpFormatTiming:function({tournamentRecords:e,matchUpFormats:t,categoryType:n,tournamentId:r,eventId:i}){if(!i)return{error:Ae};const a=Object.keys(e).filter((e=>!r||e===r));if(r&&!a.length)return{error:xn};let o,s,c;return a.forEach((r=>{const a=e[r],{event:u}=Qs({tournamentRecord:a,eventId:i});if(!u)return!1;c=!0;const{eventMatchUpFormatTiming:d,error:p}=EI({tournamentRecord:a,matchUpFormats:t,categoryType:n,event:u});p&&(s=p),o=d})),!c&&{error:Ee}||s&&{error:s}||{eventMatchUpFormatTiming:o}},removeEventMatchUpFormatTiming:function({tournamentRecords:e,eventId:t}){if(!e)return{error:q};if("string"!=typeof t)return{error:mt,info:"missing eventId"};for(const n of Object.values(e)){const{event:e}=Qs({tournamentRecord:n,eventId:t});if(e)return nS({event:e})}return{error:Ee}},getMatchUpDailyLimitsUpdate:function({tournamentRecords:e}){return AI({extensionName:$o,tournamentRecords:e})},getMatchUpDailyLimits:Fg,setMatchUpDailyLimits:function({tournamentRecords:e,tournamentId:t,dailyLimits:n}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const r=Object.keys(e).filter((e=>!t||t===e));if(t&&!r.includes(t))return{error:xn};for(const i of r){const t=IS({tournamentRecord:e[i],dailyLimits:n});if(t.error)return t}return{...L}},getProfileRounds:Ng,getRounds:Vg,assignMatchUpVenue:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t,{matchUpId:i,venueId:a,disableNotice:o,removePriorValues:s}=e;return r?RU({tournamentRecords:e.tournamentRecords,removePriorValues:s,tournamentRecord:n,drawDefinition:r,disableNotice:o,matchUpId:i,venueId:a}):{error:Y}},assignMatchUpCourt:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t;if(!n)return{error:$};if(!r)return{error:Y};const{removePriorValues:i,tournamentRecords:a,disableNotice:o,courtDayDate:s,matchUpId:c,courtId:u}=e;return bU({removePriorValues:i,tournamentRecords:a,tournamentRecord:n,drawDefinition:r,disableNotice:o,courtDayDate:s,matchUpId:c,courtId:u})},allocateTeamMatchUpCourts:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t;if(!r)return{error:Y};const{removePriorValues:i,tournamentRecords:a,disableNotice:o,courtDayDate:s,matchUpId:c,courtIds:u}=e;return DU({removePriorValues:i,tournamentRecords:a,tournamentRecord:n,drawDefinition:r,disableNotice:o,courtDayDate:s,matchUpId:c,courtIds:u})},addMatchUpScheduleItems:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t;return sS({...e,tournamentRecord:n,drawDefinition:r})},addMatchUpScheduledDate:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t;if(!r)return{error:Y};const{disableNotice:i,scheduledDate:a,matchUpId:o,removePriorValues:s}=e;return cS({removePriorValues:s,tournamentRecord:n,drawDefinition:r,disableNotice:i,scheduledDate:a,matchUpId:o})},addMatchUpScheduledTime:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t,{disableNotice:i,scheduledTime:a,matchUpId:o,removePriorValues:s}=e;return r?uS({removePriorValues:s,tournamentRecord:n,drawDefinition:r,disableNotice:i,scheduledTime:a,matchUpId:o}):{error:Y}},addMatchUpCourtOrder:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t,{removePriorValues:i,disableNotice:a,courtOrder:o,matchUpId:s}=e;return function({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,courtOrder:i,matchUpId:a}){return OU({removePriorValues:e,tournamentRecord:t,drawDefinition:n,disableNotice:r,courtOrder:i,matchUpId:a})}({removePriorValues:i,tournamentRecord:n,drawDefinition:r,disableNotice:a,courtOrder:o,matchUpId:s})},addMatchUpStartTime:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t,{disableNotice:i,startTime:a,matchUpId:o}=e;return dS({tournamentRecord:n,drawDefinition:r,disableNotice:i,startTime:a,matchUpId:o})},addMatchUpStopTime:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t,{disableNotice:i,stopTime:a,matchUpId:o}=e;return lS({tournamentRecord:n,drawDefinition:r,disableNotice:i,stopTime:a,matchUpId:o})},addMatchUpResumeTime:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t,{disableNotice:i,resumeTime:a,matchUpId:o}=e;return mS({tournamentRecord:n,drawDefinition:r,disableNotice:i,resumeTime:a,matchUpId:o})},addMatchUpEndTime:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t,{disableNotice:i,endTime:a,matchUpId:o}=e;return pS({tournamentRecord:n,drawDefinition:r,disableNotice:i,endTime:a,matchUpId:o})},addMatchUpOfficial:function(e){const t=VU(e);if(t.error)return t;const{tournamentRecord:n,drawDefinition:r}=t,{disableNotice:i,participantId:a,officialType:o,matchUpId:s}=e;return fS({tournamentRecord:n,drawDefinition:r,disableNotice:i,participantId:a,officialType:o,matchUpId:s})},getSchedulingProfile:yg,setSchedulingProfile:vg,addSchedulingProfileRound:Sg,validateSchedulingProfile:fg,addPersonRequests:function({tournamentRecords:e,personId:t,requests:n}){if(!e)return{error:q};if("string"!=typeof t)return{error:xn};if(!Array.isArray(n))return{error:xn};const{personRequests:r}=Kv({tournamentRecords:e}),{mergeCount:i}=Jv({personRequests:r,personId:t,requests:n});return i&&r?Qv({tournamentRecords:e,personRequests:r}):{error:xn}},getPersonRequests:Kv,modifyPersonRequests:function({tournamentRecords:e,requests:t,personId:n}){if(!e)return{error:q};if(!Array.isArray(t))return{error:xn};const r=t.map((({requestId:e})=>e)).filter(Boolean),{personRequests:i}=Kv({tournamentRecords:e}),a=e=>{i&&(i[e]=i[e].map((e=>{if(!r.includes(e.requestId))return e;const n=t.find((t=>t.requestId===e.requestId));return n.requestType?Object.assign(e,n):void 0})).filter(Boolean))};if(n&&i?.[n])a(n);else if(i)for(const s of Object.keys(i))a(s);const o=t.filter((e=>!e.requestId));return o.length&&Jv({personRequests:i,personId:n,requests:o}),Qv({tournamentRecords:e,personRequests:i})},removePersonRequests:function({tournamentRecords:e,requestType:t,requestId:n,personId:r,date:i}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};const{personRequests:a}=Kv({tournamentRecords:e}),o=e=>{a&&(a[e]=a[e].filter((e=>!(t&&e.requestType===t||n&&e.requestId===n||i&&e.date===i))),a?.[e]?.length||delete a[e])},s=!(t||n||r||i);if(!s)if(r&&a?.[r])o(r);else if(a)for(const c of Object.keys(a))o(c);return!s&&a&&Object.keys(a).length?Qv({tournamentRecords:e,personRequests:a}):cc({tournamentRecords:e,name:jo})}};function US({tournamentRecord:e,policyDefinitions:t,allowReplacement:n}){if(!e)return{error:$};if(!t||"object"!=typeof t)return{error:rt};e.extensions||(e.extensions=[]);const r=Xo({tournamentRecord:e}).appliedPolicies??{},i=Object.keys(t).map((e=>{if(!r[e]||n)return r[e]=t[e],e})).filter(Boolean);if(i?.length){const t=tc({tournamentRecord:e,extension:{name:Ro,value:r}});if(t.error)return t}return i?.length?{...L,applied:i}:{error:st}}function yS({policyDefinitions:e,allowReplacement:t,event:n}){if(!n)return{error:Ae};if(!e)return{error:rt};let r=0;n.extensions||(n.extensions=[]);const i=Xo({event:n}).appliedPolicies??{};if(Object.keys(e).forEach((n=>{i[n]&&!t||(i[n]=e[n],r++)})),r){rc({event:n,extension:{name:Ro,value:i}})}return r?L:{error:ct}}const vS={attachPolicies:function({tournamentRecords:e,policyDefinitions:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:q};for(const n of Object.values(e)){const e=US({allowReplacement:!0,tournamentRecord:n,policyDefinitions:t});if(e.error)return e}return{...L}}};function SS(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}const wS={getParticipantScaleItem:function({tournamentRecords:e,policyDefinitions:t,scaleAttributes:n,participantId:r,personId:i}){let a=Jg({tournamentRecords:e,policyDefinitions:t,participantId:r,personId:i});if(a.error)return a;const{participant:o,tournamentId:s}=a;return a=zh({participant:o,scaleAttributes:n}),a.error?{...a,tournamentId:s}:{...L,tournamentId:s,...a}},getCompetitionDateRange:gg,getTournamentIds:function({tournamentRecords:e}){const t=Object.keys(e);return{...L,tournamentIds:t}},competitionScheduleMatchUps:_g,getSchedulingProfileIssues:function(e){const{scheduleDates:t=[],tournamentRecords:n,periodLength:r=30}=e||{};if("object"!=typeof n)return{error:W};if(!Array.isArray(t))return{error:xn};if(!t.every(Or))return{error:yt};const i=[];let a=0;const o={},{schedulingProfile:s}=yg({tournamentRecords:n});if(!s)return{issues:i,...L};const{matchUps:c}=Th({nextMatchUps:!0,tournamentRecords:n});for(const d of s){const{scheduleDate:e,venues:s=[]}=d;if(!t?.length||t.includes(e))for(const t of s||[])if(t){const{rounds:s}=t,u=[],{orderedMatchUpIds:d,scheduledRoundsDetails:p}=Tv({tournamentRecords:n,periodLength:r,matchUps:c,rounds:s}),{matchUpDependencies:l}=bh({tournamentRecords:n,matchUps:c}),m=e=>{let t;return p?.find(((n,r)=>{const i=n.matchUpIds.includes(e);return i&&(t=r),i})),t};if(d?.forEach(((e,t)=>{const n=O(d.slice(t+1),l?.[e]?.matchUpIds||[]);n.length&&u.push({matchUpId:e,shouldBeAfter:n})})),u.length){a+=u.length;const t=u.map((({matchUpId:t,shouldBeAfter:n})=>{const r=m(t),i=P(n.map(m));return o[e]||(o[e]={}),o[e][r]||(o[e][r]=[]),i.forEach((t=>{o[e][r].includes(t)||o[e][r].push(t)})),{matchUpId:t,matchUpRoundIndex:r,earlierRoundIndices:i,shouldBeAfter:n}}));i.push(...t)}}}const u={matchUpIdShouldBeAfter:Object.assign({},...i.map((e=>{const{matchUpId:t,shouldBeAfter:n,earlierRoundIndices:r}=e;return{[t]:{earlierRoundIndices:r,shouldBeAfter:n}}})))};return{issuesCount:a,profileIssues:u,roundIndexShouldBeAfter:o,...L}},allCompetitionMatchUps:Th,competitionMatchUps:Dh,matchUpActions:function(e){const{tournamentRecords:t,policyDefinitions:n,enforceGender:r,participantId:i,tournamentId:a,sideNumber:o,matchUpId:s,eventId:c,drawId:u}=e??{};if("object"!=typeof t||"string"!=typeof a||"string"!=typeof s||"string"!=typeof u)return{error:xn};const d=t[a];if(!d)return{error:$};const p=Qs({tournamentRecord:d,eventId:c,drawId:u});return p.error?p:pg({drawDefinition:p.drawDefinition,policyDefinitions:n,tournamentRecord:d,enforceGender:r,participantId:i,sideNumber:o,matchUpId:s,drawId:u})},getCompetitionVenues:mg,getVenuesAndCourts:lg,getVenuesReport:function({ignoreDisabled:e=!0,tournamentRecords:t,venueIds:n=[],dates:r=[]}){if(!Array.isArray(r))return{error:xn,dates:r};if(!Array.isArray(n))return{error:xn,venueIds:n};if(!r.every(Or))return{error:yt};const i=lg({tournamentRecords:t,ignoreDisabled:e,dates:r});if(i.error)return i;const a=i?.venues?.filter((({venueId:e})=>!n?.length||n.includes(e))),o=i.courts?.reduce(((e,t)=>(t.dateAvailability?.forEach((t=>{const n=t.date;e.includes(n)||e.push(n)})),e)),[]).filter((e=>!r.length||r.includes(e))),s={venueIds:a?.map((({venueId:e})=>e))},{matchUps:c}=Th({afterRecoveryTimes:!0,tournamentRecords:t,matchUpFilters:s}),u=a?.map((e=>function(e,t,n){const{venueId:r,courts:i,venueName:a}=t,o={};return e.forEach((e=>{let t=0,a=0,s=0;for(const n of i){const r=n.dateAvailability.find((t=>t.date===e)),i=r&&Kh({courtDate:r}),a=i?.reduce(((e,t)=>{const{startTime:n,endTime:r}=t;return e+(Gr(r)-Gr(n))}),0);a&&(s+=1),t+=a}const c=n.filter((({schedule:t})=>t.venueId===r&&ni(e,t.scheduledDate)));c.forEach((({schedule:e})=>{const t=$r(e.scheduledTime),n=Gr(Zr(t,e.averageMinutes))-Gr(t);a+=n}));const u=t?(a/t*100).toFixed(2):"100";o[e]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:t,scheduledMinutes:a,percentUtilization:u}})),{venueId:r,venueName:a,venueReport:o}}(o,e,c)));return{venuesReport:u}},credits:SS};function PS({tournamentRecord:e,courtIds:t,dates:n}){if(!e)return{error:$};if(!Array.isArray(t))return{info:sa("courtIds"),error:mt};const r=!Array.isArray(n)||!n.length||{dates:n},i=e=>Js({creationTime:!1,element:e,extension:{value:r,name:Ao}});for(const a of e.venues||[])for(const e of a.courts||[])if(t?.includes(e.courtId)){const t=i(e);if(t.error)return t}return{...L}}function TS({tournamentRecord:e,venueIds:t}){if(!e)return{error:$};if(!Array.isArray(t))return{error:mt,info:sa("venueIds")};for(const n of e.venues||[])if(t?.includes(n.venueId)){const e=Js({creationTime:!1,element:n,extension:{name:Ao,value:!0}});if(e.error)return e}return{...L}}function DS({tournamentRecord:e,courtIds:t,enableAll:n,dates:r}){if(!e)return{error:$};if(!Array.isArray(t)&&!n)return{error:mt,info:sa("courtIds")};for(const i of e.venues||[])for(const e of i.courts||[])if(n||t?.includes(e.courtId))if(Array.isArray(r)){const{extension:t}=lc({element:e,name:Ao});if(t){const n=t.value;Array.isArray(n.dates)&&(n.dates=n.dates.filter((e=>!r.includes(e)))),Js({creationTime:!1,element:e,extension:{name:Ao,value:n}})}}else ec({element:e,name:Ao});return{...L}}function RS({tournamentRecord:e,venueIds:t,enableAll:n}){if(!e)return{error:$};if(!Array.isArray(t)&&!n)return{error:mt,info:sa("venueIds")};for(const r of e.venues||[])(n||t?.includes(r.venueId))&&ec({element:r,name:Ao});return{...L}}function bS({tournamentRecord:e,drawDefinition:t,matchUpId:n,drawId:r}){if(!n)return{error:Qe};if(!t&&!r)return{error:le};let i;if(!t){if(!e)return{error:$};({drawDefinition:t}=Qs({tournamentRecord:e,drawId:r}))}if(t)({matchUp:i}=Qp({drawDefinition:t,matchUpId:n}));else{if(!e)return{error:$};const t=rh({tournamentRecord:e,inContext:!1}).matchUps??[];({matchUp:i}=cs({matchUps:t,matchUpId:n}))}if(!i)return{error:Xe};if(i.timeItems){i.timeItems.find((e=>[Xc,Jc].includes(e.itemType)))&&(i.timeItems=i.timeItems.filter((({itemType:e})=>![Xc,Jc].includes(e))),rl({tournamentId:e?.tournamentId,context:"removeCourtAssignment",drawDefinition:t,matchUp:i}))}return{...L}}function NS({matchUpsCount:e=0}){return{error:Jn,info:`Schedule would be deleted from ${e} ${1===e?"matchUp":"matchUps"}; use { force: true }`}}function MS({tournamentRecord:e,venueId:t,force:n}){if(!e)return{error:$};if("string"!=typeof t)return{error:fn};const r=rh({tournamentRecord:e,contextFilters:{venueIds:[t]}}).matchUps??[],i=Xo({tournamentRecord:e})?.appliedPolicies,a=n??i?.[go]?.allowDeletionWithScoresPresent?.venues;if(r.length&&!a)return NS({matchUpsCount:r.length});for(const s of r){const t=bS({matchUpId:s.matchUpId,drawId:s.drawId,tournamentRecord:e});if(t.error)return t}let o;return e.venues=(e.venues??[]).filter((e=>e?.venueId!==t||(o=!0,!1))),o?(pr({payload:{venueId:t,tournamentId:e.tournamentId},topic:Sc,key:t}),{...L}):{error:mn}}function AS({tournamentRecord:e}){if(!e)return{error:$};const t=e.tournamentId,{extension:n}=As({name:Ho,tournamentRecord:e});let r=n?.value||[];if(r.length){const n=e.venues?.map((({venueId:e,courts:t})=>t?.length&&e)),i=Ug({tournamentRecords:{[t]:e}}),{eventIds:a,drawIds:o}=i,{updatedSchedulingProfile:s,modifications:c,issues:u}=wg({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(c){r=s;const t=function({tournamentRecord:e,schedulingProfile:t}){return tc({tournamentRecord:e,extension:{name:Ho,value:t}})}({tournamentRecord:e,schedulingProfile:r});return t.error?t:{schedulingProfile:r,modifications:c,issues:u}}}return{schedulingProfile:r,modifications:0}}function ES({requireCourts:e=!0,tournamentRecord:t,schedulingProfile:n}){if(!n){const{modifications:e,issues:n}=AS({tournamentRecord:t});return{success:!e,modifications:e,issues:n}}const{venueIds:r,eventIds:i,drawIds:a}=hg({tournamentRecord:t,requireCourts:e}),{modifications:o,issues:s}=wg({schedulingProfile:n,venueIds:r,eventIds:i,drawIds:a});return{success:!o,modifications:o,issues:s}}function CS(e){if(!e?.tournamentRecord&&!Array.isArray(e?.venueMatchUps))return{error:$};if(!e?.courtId)return{error:lt};const{scheduleVisibilityFilters:t,tournamentRecord:n,matchUpFilters:r,venueMatchUps:i,courtId:a}=e,{schedulingProfile:o}=AS({tournamentRecord:n});if(Array.isArray(i))return{matchUps:c({matchUps:i,courtId:a})};const{matchUps:s}=rh({scheduleVisibilityFilters:t,tournamentRecord:n,matchUpFilters:r});return{matchUps:c({matchUps:s,courtId:a})};function c({matchUps:e,courtId:t}){return kg({matchUps:e.filter((e=>{const n=e.schedule?.allocatedCourts?.map((({courtId:e})=>e));return e.schedule?.courtId===t||n?.includes(t)})),schedulingProfile:o})}}function OS({tournamentRecord:e,disableNotice:t,courtId:n,force:r}){const i=Wc({tournamentRecord:e,courtId:n});if(i.error)return i;const a=i.venue,{matchUps:o}=CS({tournamentRecord:e,courtId:n}),s=Xo({tournamentRecord:e})?.appliedPolicies,c=r??s?.[go]?.allowDeletionWithScoresPresent?.courts;if(o?.length&&!c)return NS({matchUpsCount:o.length});for(const u of o??[]){const t=bS({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:e});if(t.error)return t}return a&&(a.courts=(a.courts??[]).filter((e=>e.courtId!==n)),t||pr({topic:Cc,payload:{venue:a,tournamentId:e.tournamentId},key:a.venueId})),{...L}}function FS(e){return parseInt(e)}function kS({startTime:e="",endTime:t=""}={}){if(!(e&&t&&Mr.test(e)&&Mr.test(t)))return!1;const[n,r]=e.split(":").map(FS),[i,a]=t.split(":").map(FS);return!(i<n)&&!(n===i&&a<r)}function xS(e,t){const[n,r]=e.startTime.split(":").map(FS),[i,a]=t.startTime.split(":").map(FS);return n<i?-1:n>i?1:r<a?-1:r>a?1:0}function _S({dateAvailability:e}){if(!e)return{error:Ut};if(!Array.isArray(e))return{error:gt};const t="Times must be 24 hour => 00:00";for(const n of e){if("object"!=typeof n)return{error:gt};const{date:e,startTime:r,endTime:i,bookings:a=[]}=n;if(!r||!i)return{error:gt};if(e&&!Nr.test(e))return{error:yt,dateAvailability:{date:e},info:"Dates must be formated => YYYY-MM-DD"};if(!Mr.test(r))return{error:vt,dateAvailability:{startTime:r},info:t};if(!Mr.test(i))return{error:vt,dateAvailability:{endTime:i},info:t};if(r===i)return{error:vt,dateAvailability:{startTime:r,endTime:i},info:"startTime and endTime are equivalent"};if(!kS({startTime:r,endTime:i}))return{error:vt,dateAvailability:{startTime:r,endTime:i},info:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:It};for(const e of a){if("object"!=typeof e)return{error:It};const{startTime:n,endTime:r}=e;if(!Mr.test(n))return{error:vt,booking:{startTime:n},info:t};if(!Mr.test(r))return{error:vt,booking:{endTime:r},info:t};if(n===r)return{error:vt,dateAvailability:{startTime:n,endTime:r},info:"startTime and endTime are equivalent"};if(!kS({startTime:n,endTime:r}))return{error:vt,dateAvailability:{startTime:n,endTime:r},info:"endTime must be after startTime"}}}}return{valid:!0}}function LS({tournamentRecord:e,dateAvailability:t,disableNotice:n,venueMatchUps:r,courtId:i,force:a}){if(!e)return{error:$};if(!i)return{error:lt};const o=_S({dateAvailability:t});if(o.error)return o;const{updatedDateAvailability:s,totalMergeCount:c}=function(e){let t=0;const n=e.reduce(((e,t)=>{const{date:n,startTime:r,endTime:i,bookings:a}=t;return e[n]||(e[n]=[]),e[n].push({startTime:r,endTime:i,bookings:a}),e}),{}),r=[];return Object.keys(n).forEach((e=>{n[e].sort(xS);const{mergedAvailability:i,mergeCount:a}=function(e){let t,n,r,i=e.length,a=0;const o=[];for(;e.length&&i;){const s=e.shift(),{startTime:c,endTime:u,bookings:d}=s;if(i-=1,t){if(Xr(Jr(n),Jr(c),!1)>0){const e={startTime:t,endTime:n};r?.length&&(e.bookings=r),o.push(e),t=c,r=d,n=u}else d&&(r?r.push(d):r=d),n=u,a+=1}else t=c,r=d,n=u}const s={startTime:t,endTime:n};r?.length&&(s.bookings=r);return o.push(s),{mergedAvailability:o,mergeCount:a}}(n[e]);r.push(...i.map((t=>({date:e,...t})))),t+=a})),{updatedDateAvailability:r,totalMergeCount:t}}(t);t=s;const u=Wc({tournamentRecord:e,courtId:i});if(u.error)return u;const{court:d,venue:p}=u,{matchUps:l}=CS({tournamentRecord:e,venueMatchUps:r,courtId:i});if(l?.length){const t=Xo({tournamentRecord:e})?.appliedPolicies,n=a??t?.[go]?.allowDeletionWithScoresPresent?.courts,r=[];r.length&&(n||console.log("throw error: scheduled court matchUps",r.length))}return d&&(d.dateAvailability=t,!n&&p&&pr({payload:{venue:p,tournamentId:e.tournamentId},topic:Cc,key:p.venueId})),{...L,totalMergeCount:c}}const BS=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0});function VS({tournamentRecord:e,disableNotice:t,venueMatchUps:n,modifications:r,courtId:i,force:a}){if(!e)return{error:$};if(!i)return{error:lt};if(!r||"object"!=typeof r)return{error:On};const o=Wc({tournamentRecord:e,courtId:i});if(o.error)return o;const{venue:s,court:c}=o,u=Object.keys(BS()).filter((e=>"courtId"!==e));if(!Object.keys(r).filter((e=>u.includes(e))).length)return{error:Vn};const d=u.filter((e=>!["dateAvailability"].includes(e))),p=Object.keys(r).filter((e=>d.includes(e)));if(c&&p.forEach((e=>Object.assign(c,{[e]:r[e]}))),r.dateAvailability){const o=LS({dateAvailability:r.dateAvailability,tournamentRecord:e,venueMatchUps:n,disableNotice:t,courtId:i,force:a});if(o.error)return o}return t||pr({payload:{venue:s,tournamentId:e.tournamentId},topic:Cc,key:s?.venueId}),{...L,court:ii(c)}}const jS=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]});function GS({tournamentRecord:e,disableNotice:t,venueId:n,courtId:r,court:i}){const{venue:a}=$c({tournamentRecord:e,venueId:n});if(!a)return{error:mn};a.courts||(a.courts=[]);const o={...BS(),venueId:n,courtId:r};o.courtId||(o.courtId=Ii());if(a.courts.some((e=>e.courtId===o.courtId)))return{error:pn};{const r=(i?.dateAvailability||[]).map((e=>({...e,date:Wr(e.date),startTime:$r(e.startTime),endTime:$r(e.endTime),bookings:e.bookings?.map((({startTime:e,endTime:t,bookingType:n})=>({startTime:$r(e),endTime:$r(t),bookingType:n})))}))),s=Object.keys(o);for(const e of s)if(i?.[e])if("dateAvailability"===e){const e=_S({dateAvailability:r});if(!e.valid&&e.error)return e;o.dateAvailability=r}else o[e]=i[e];const c=o;return a.courts.push(c),t||pr({payload:{venue:a,tournamentId:e.tournamentId},topic:Cc,key:a.venueId}),{...L,court:ii(o),venueId:n}}}function qS({courtNameRoot:e="Court",dateAvailability:t=[],venueAbbreviationRoot:n,tournamentRecord:r,courtNames:i=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:c,endTime:u,idPrefix:d,venueId:p,dates:l}){if(!p)return{error:fn};const m=$c({tournamentRecord:r,venueId:p});if(m.error)return m;const{venue:f}=m;if(!U(o)||!i)return{error:un};const h=E(0,o=o??i.length).map((r=>{const o=a?.[r],c=o?l.map((e=>({date:kr(e),startTime:s,endTime:u,...o}))):t;return o&&s&&u&&c.push({startTime:s,endTime:u}),{courtName:i[r]||n&&f?.venueAbbreviation&&`${f?.venueAbbreviation} ${r+1}`||`${e} ${r+1}`,dateAvailability:c}})).map(((e,t)=>{const n=c?.pop()||d&&`${d}-${t+1}`;return GS({disableNotice:!0,tournamentRecord:r,courtId:n,venueId:p,court:e})})).map((e=>e.court)).filter(Boolean);return h.length!==o?{error:"Not all courts could be generated",result:m}:(f&&pr({payload:{venue:f,tournamentId:r.tournamentId},topic:Cc,key:f.venueId}),{...L,courts:ii(h)})}function $S({tournamentRecord:e,modifications:t,venueId:n,force:r}){if(!e)return{error:$};if(!t||"object"!=typeof t)return{error:On};if(!n)return{error:fn};const i=Xo({tournamentRecord:e})?.appliedPolicies,a=r??i?.[go]?.allowDeletionWithScoresPresent?.venues,{matchUps:o}=function({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:n,venueId:r}){if(!t)return{error:$};if(!r)return{error:fn};const{schedulingProfile:i}=AS({tournamentRecord:t}),{matchUps:a}=rh({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:n});return{matchUps:function({matchUps:e,venueId:t}){return kg({matchUps:e.filter((e=>{const n=e.schedule?.allocatedCourts?.map((({venueId:e})=>e));return e.schedule?.venueId===t||n?.includes(t)})),schedulingProfile:i})}({matchUps:a,venueId:r})}}({tournamentRecord:e,venueId:n}),s=$c({tournamentRecord:e,venueId:n});if(s.error)return s;const c=s.venue,u=Object.keys(jS()).filter((e=>"venueId"!==e));if(!Object.keys(t).filter((e=>u.includes(e))).length)return{error:Vn};const d=u.filter((e=>!["courts","onlineResources"].includes(e))),p=Object.keys(t).filter((e=>d.includes(e)));c&&p.forEach((e=>Object.assign(c,{[e]:t[e]})));const l=c?.courts?.map((e=>e.courtId))??[],m=t.courts?.map((e=>e.courtId))||[],f=l.filter((e=>!m.includes(e))),h=[];if(f.length){const t=c?.courts?.filter((e=>f.includes(e.courtId))),n=t?.map((t=>{const n=CS({courtId:t.courtId,tournamentRecord:e,venueMatchUps:o});for(const e of n.matchUps??[])h.push({matchUpId:e.matchUpId,drawId:e.drawId});return n.matchUps?.length??0})).reduce(((e,t)=>e+t));if(!c||n&&!a)return NS({matchUpsCount:n});c.courts=c.courts?.filter((e=>m.includes(e.courtId))),jU({schedule:{courtId:"",scheduledDate:""},matchUpDetails:h,removePriorValues:!0,tournamentRecord:e})}if(t.courts)for(const I of t.courts){const{courtId:t}=I||{};let i=VS({modifications:I,disableNotice:!0,tournamentRecord:e,venueMatchUps:o,courtId:t,force:r});if(i.error===dn&&(i=GS({disableNotice:!0,tournamentRecord:e,venueId:n,court:I})),i.error)return i}return ES({tournamentRecord:e}),c&&pr({payload:{venue:c,tournamentId:e.tournamentId},topic:Cc,key:c?.venueId}),{...L,venue:ii(c)}}const WS={disableCourts:function({tournamentRecords:e,courtIds:t,dates:n}){if(!e)return{error:q};if(!Array.isArray(t))return{error:mt,info:sa("courtIds")};for(const r of Object.values(e))PS({tournamentRecord:r,courtIds:t,dates:n});return{...L}},disableVenues:function({tournamentRecords:e,venueIds:t}){if(!e)return{error:q};if(!Array.isArray(t))return{error:mt,info:sa("venueIds")};for(const n of Object.values(e))TS({tournamentRecord:n,venueIds:t});return{...L}},enableCourts:function({tournamentRecords:e,enableAll:t,courtIds:n,dates:r}){if(!e)return{error:q};if(!t&&!Array.isArray(n))return{error:mt,info:sa("courtIds")};for(const i of Object.values(e))DS({tournamentRecord:i,courtIds:n,enableAll:t,dates:r});return{...L}},enableVenues:function({tournamentRecords:e,venueIds:t,enableAll:n}){if(!e)return{error:q};if(!n&&!Array.isArray(t))return{error:mt,info:sa("venueIds")};for(const r of Object.values(e))RS({tournamentRecord:r,venueIds:t,enableAll:n});return{...L}},deleteCourt:function({tournamentRecords:e,courtId:t,force:n}){if(!e)return{error:q};if("string"!=typeof t)return{error:lt};let r,i;for(const a of Object.values(e)){if(i=OS({tournamentRecord:a,courtId:t,force:n}),i.error&&i.error!==dn)return i;i.success&&(r=!0)}return r?{...L}:i},deleteVenue:function({tournamentRecords:e,venueId:t,force:n}){if(!e)return{error:q};if("string"!=typeof t)return{error:fn};let r;for(const i of Object.values(e)){const e=MS({tournamentRecord:i,venueId:t,force:n});if(e.error&&e.error!==mn)return e;e.success&&(r=!0)}return Pg({tournamentRecords:e}),r?L:{error:mn}},modifyCourt:function({tournamentRecords:e,disableNotice:t,modifications:n,courtId:r,force:i}){if(!e)return{error:q};if(!r)return{error:mt,info:"missing courtId"};let a,o;for(const s of Object.values(e)){const e=VS({tournamentRecord:s,disableNotice:t,modifications:n,courtId:r,force:i});e?.error&&(o=e),a=!0}return a?{...L}:o},modifyVenue:function({tournamentRecords:e,modifications:t,venueId:n,force:r}){if(!e)return{error:q};if("string"!=typeof n)return{error:fn};let i,a;for(const o of Object.values(e)){const e=$S({tournamentRecord:o,modifications:t,venueId:n,force:r});if(e.success&&(a=!0),e.error&&(i=e.error),e.error&&e.error!==mn)return e}return Pg({tournamentRecords:e}),a?{...L}:{error:i}},addCourts:function(e){const{tournamentRecords:t,venueId:n}=e;if("string"!=typeof n||!n)return{error:fn};let r;for(const i of Object.values(t)){const{venue:t}=$c({tournamentRecord:i,venueId:n});if(t){const t=qS({...e,tournamentRecord:i});if(t.error)return t;r=!0}}return r?L:{error:mn}},addVenue:function({tournamentRecords:e,disableNotice:t,venue:n,context:r}){if("object"!=typeof n)return{error:xn};let i;n.venueId||(n.venueId=Ii());for(const a of Object.values(e)){const e=Gc({disableNotice:!0,tournamentRecord:a,context:r,venue:n});if(e?.error)return e;i=e.venue}return t||pr({topic:Uc,payload:{venue:n}}),pi({...L,venue:i})}};function HS({convertExtensions:e,removeExtensions:t}){const n=yr();return{tournamentId:gr(),tournamentRecords:ii(n,e,!1,t)}}function zS(){const e=yr(),{extension:t}=sc({name:Lo,tournamentRecords:e}),n=t?.value?.tournamentIds||[];return Object.keys(e).forEach((t=>{n.includes(t)||delete e[t]})),Sr(e)}function YS(e,t=!0){return"object"!=typeof e||Array.isArray(e)?{error:On}:e?.tournamentId?vr(t?ii(e):e):{error:xn}}function KS(e,t=!0){if("object"!=typeof e)return{error:On};if(Array.isArray(e)){if(!(e.filter((e=>e?.tournamentId)).length===e.length))return{error:G};e=Object.assign({},...e.map((e=>({[e.tournamentId]:e}))))}else if(e?.tournamentId)e={[e.tournamentId]:e};else{if(!Object.keys(e).every((t=>e[t].tournamentId===t)))return{error:G}}return Sr(t?ii(e):e)}function QS({result:e,methodName:t,elapsed:n,params:r,engine:i}){const a=ar(),o={method:t},s=e?.error&&(!0===a.errors||Array.isArray(a.errors)&&a.errors.includes(t)),c=Array.isArray(a.params)&&a.params?.includes(t),u=a.params&&!Array.isArray(a.params)||c,d=Array.isArray(a.exclude)&&a.exclude.includes(t);d||[void 0,!1].includes(a.perf)||!(isNaN(a.perf)||n>a.perf)||(o.elapsed=n),d||!s&&!u||(o.params=r),!d&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||c)||Array.isArray(a.result)&&a.result?.includes(t))&&(o.result=e),Object.keys(o).length>1&&function(e,t){if(rr.globalLog)return rr.globalLog(e,t);console.log(e,t)}(i,o),e&&a.makeDeepCopy&&(e.deepCopyIterations=rr.iterators.makeDeepCopy)}const JS=function(){const e={getState:e=>HS({convertExtensions:e?.convertExtensions,removeExtensions:e?.removeExtensions}),version:()=>"1.8.46",reset:()=>(Sr({}),t())};return[Iv,vS,wS,yv,gS,WS].forEach((t=>{Object.keys(t).forEach((n=>{e[n]=e=>{if(ar())return r(t[n],e,n);try{return r(t[n],e,n)}catch(i){Dr({engineName:"competitionEngine",methodName:n,params:e,err:i})}}}))})),e.devContext=e=>(or(e),t()),e.getDevContext=e=>ar(e),e.setState=(e,n,r)=>{cr(n,r);return t(KS(e,n))},e.setTournamentRecord=(e,n,r)=>{cr(n,r);return t(YS(e,n))},e.removeTournamentRecord=e=>t(Pr(e)),e.removeUnlinkedTournamentRecords=()=>t(zS()),e.executionQueue=(t,r)=>function(t,r){if(!Array.isArray(t))return{error:xn};const i=yr(),a=gr(),o=r&&ii(i,!1,!0);let s;const c=[];for(const d of t){if("object"!=typeof d)return{error:xn};const{method:t,params:r}=d;if(!e[t]){const e={error:Qn,methodName:t},n=ar();return(n.result&&!Array.isArray(n.result)||Array.isArray(n.result)&&n.result?.includes(t))&&console.log("ce:",e),e}const u=n(i,e[t],{activeTournamentId:a,...r},t);if(u?.error)return o&&KS(o),{...u,rolledBack:!!o};c.push({...u,methodName:t}),s=Date.now()}const u=dr();u&&Object.values(i).forEach((e=>{IU({tournamentRecord:e,value:{version:"1.8.46",timeStamp:s}})}));gU({directives:t,mutationStatus:u,timeStamp:s}),fr();return{success:c.every((e=>e.success)),results:c}}(t,r),e;function t(t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function n(t,n,r,i){delete e.success,delete e.error;const a=Date.now(),o=n({tournamentRecords:t,...r});return QS({result:o,methodName:i,elapsed:Date.now()-a,params:r,engine:"ce:"}),o}function r(e,t,r){const i=yr(),a=gr(),o=t?.rollbackOnError&&ii(i,!1,!0),s=n(i,e,{activeTournamentId:a,...t},r);s?.error&&o&&KS(o);const c=s?.success&&!0!==t?.delayNotify&&!0!==t?.doNotNotify,u=dr(),d=Date.now();return u&&(Object.values(i).forEach((e=>{IU({tournamentRecord:e,value:{version:"1.8.46",timeStamp:d}})})),s.modificationsApplied=!0),c&&gU({directives:[{method:e,params:t}],mutationStatus:u,timeStamp:d}),(c||!s?.success||t?.doNotNotify)&&fr(),s}}();function XS({structureName:e=kh(ad),structureAbbreviation:t,drawDefinition:n,matchUpType:r,structureId:i}){if(!n)return{error:Y};const a=xh({stage:ad,structureAbbreviation:t,structureName:e,matchUps:[],structureId:i,matchUpType:r});return n.structures.push(a),al({drawDefinition:n,structureIds:[i]}),{...L}}function ZS({targetEntryRound:e=1,finishingPositions:t,sourceRoundNumber:n,sourceStructureId:r,targetStructureId:i,linkType:a=Hi.Winner}){if(!r||!i)return{error:Te};return{link:pi({linkType:a,source:{roundNumber:n,structureId:r,finishingPositions:t},target:{feedProfile:gd,roundNumber:e,structureId:i}})}}function ew({idPrefix:e,roundNumber:t,roundPosition:n,uuids:r}){return e?`${e}-${t}-${n}`:r?.pop()||Ii()}function tw({includeMatchUpType:e,matchUpType:t,roundNumber:n,matchUps:r,idPrefix:i,isMock:a,uuids:o,nodes:s}){let c=0;const u=[];let d=1;const p=n-1,l=s?.length;for(;c<(l||0);){const l=s?.[c],m=s?.[c+1];p&&(l.roundNumber=p),m&&p&&(m.roundNumber=p);const f={roundPosition:d,children:[l,m],matchUpId:ew({roundPosition:d,roundNumber:n,idPrefix:i,uuids:o})};u.push(f);const h={drawPositions:f.children.map((e=>e?.drawPosition)).filter(Boolean),matchUpStatus:Da,matchUpId:f.matchUpId,roundPosition:d,roundNumber:n};e&&t&&(h.matchUpType=t),a&&(h.isMock=!0),r.push(h),d++,c+=2}return{roundNodes:u,matchUps:r}}function nw({finishingPositionOffset:e,finishingPositionLimit:t,qualifyingRoundNumber:n,qualifyingPositions:r,matchUpType:i,roundLimit:a,idPrefix:o,drawSize:s,isMock:c,uuids:u}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!f(s)||s%r)){let e=r;for(;e<s;)e*=2;s=e}const d=r&&!(s%2)&&(!isNaN(r)||n&&!isNaN(n))&&(s/r===Math.round(s/r)||n&&s/n===Math.round(s/n));if(!f(s)&&!d)return{matchUps:[],roundsCount:0};const p=E(1,s+1).map((e=>({drawPosition:e})));let l,m=[],h=1;for(({roundNodes:l,matchUps:m}=tw({matchUpType:i,roundNumber:h,idPrefix:o,matchUps:m,isMock:c,nodes:p,uuids:u})),h++,a=a??n;l.length>1;)r&&l.length===r&&(a=h-1),({roundNodes:l,matchUps:m}=tw({nodes:l,matchUpType:i,roundNumber:h,idPrefix:o,matchUps:m,isMock:c,uuids:u})),h++;const I=h-1;return m=Sh({finishingPositionOffset:e,finishingPositionLimit:t,roundsCount:I,roundLimit:a,matchUps:m}),a?m=m.filter((e=>a&&(e.roundNumber??0)<=a)):a=h-1,{drawSize:s,matchUps:m,roundsCount:I,roundLimit:a}}function rw({qualifyingProfiles:e,appliedPolicies:t,idPrefix:n,isMock:r,uuids:i}){const a=[],o=[],s=[],c=(e,t)=>e.stageSequence-t.stageSequence,u=(e,t)=>e.roundTarget-t.roundTarget;let d,p=0,l=0,m=1;for(const f of e.sort(u)){const u=f.structureProfiles||[];m=f.roundTarget||m;let h,g,U,y=1,v=0;for(const a of(u||[]).sort(c)){let c=a.drawSize||I(a.participantsCount);const{qualifyingRoundNumber:l,qualifyingPositions:f,structureOptions:w,matchUpFormat:P,structureName:T,structureId:D,drawType:R}=a,b=a.matchUpType;let N,M,A;if(!S(c))return Mi({result:{error:pe},stack:"generateQualifyingSTructures"});const E=e.length>1?`${m}-`:"",C=u.length>1||E?y:"",O=T||(E||C?`${kh(rd)} ${E}${C}`:kh(rd));if(R===Wd){const{structures:e,groupCount:o,maxRoundNumber:s}=jh({structureName:a.structureName||O,structureId:D||i?.pop(),stage:rd,structureOptions:w,appliedPolicies:t,stageSequence:y,matchUpType:b,roundTarget:m,drawSize:c,idPrefix:n,isMock:r,uuids:i});v=o,N=s,M=e[0],d=[1]}else({drawSize:c,matchUps:A,roundLimit:N}=nw({qualifyingRoundNumber:l,qualifyingPositions:f,matchUpType:b,drawSize:c,idPrefix:n,isMock:r,uuids:i})),M=xh({structureName:a.structureName||O,structureId:D||i?.pop(),qualifyingRoundNumber:N,stage:rd,matchUpFormat:P,stageSequence:y,matchUpType:b,roundLimit:N,matchUps:A}),m&&Js({element:M,extension:{name:qo,value:m}}),v=A?.filter((e=>e.roundNumber===N))?.length||0;if(y>1){const{link:e}=ZS({sourceStructureId:g,sourceRoundNumber:h,targetStructureId:M.structureId,finishingPositions:U===Sd?[1]:void 0,linkType:U});s.push(e),p+=(c||0)-v}else p+=c||0;U=R===Wd?Sd:wd,g=M.structureId,h=N,o.push(M),y+=1}l+=v,a.push({qualifiersCount:v,finalQualifyingRoundNumber:h,finalQualifyingStructureId:g,finishingPositions:d,roundTarget:m,linkType:U}),m+=1}return{qualifiersCount:l,qualifyingDrawPositionsCount:p,qualifyingDetails:a,structures:o,...L,links:s}}function iw({includeMatchUpType:e,drawPosition:t,roundNumber:n,matchUpType:r,idPrefix:i,matchUps:a,isMock:o,uuids:s,nodes:c,fed:u}){const d=c.length,p=t?t-d:void 0,l=E(0,d).map((e=>p?p+e:void 0)),m=[];for(let f=0;f<d;f++){const t=l.shift(),d={drawPosition:t,fed:u+1,feed:!0},p=c[f];p.roundNumber=n-1;const h=ew({roundPosition:p.roundPosition,roundNumber:n,idPrefix:i,uuids:s}),I={roundPosition:p.roundPosition,drawPositions:[t],matchUpStatus:Da,roundNumber:n,matchUpId:h};e&&(I.matchUpType=r),o&&(I.isMock=!0),a.push(I);const g={children:[p,d]};m.push(g)}return{roundNodes:m,matchUps:a,drawPosition:t?t-d:void 0}}function aw(e){let{feedRoundsProfile:t,feedRounds:n=0,skipRounds:r=0,baseDrawSize:i,drawSize:a}=e;const{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:c,feedsFromFinal:u,isConsolation:d,matchUpType:p,idPrefix:l,isMock:m,uuids:f,fmlc:h}=e;i=i||function(e){const t=g(e);return t>e?t/2:t}(a);const I=function({drawSize:e}){const t=Math.ceil(Math.log(e)/Math.log(2));return E(0,t).reverse().map((e=>Math.pow(2,e)))}({drawSize:i}),U=I.length;let y=0;if(t?.length)y=t.reduce(((e,t)=>e+t),0);else if(a){let e=a-i;t=I.filter((t=>t<=e&&(e-=t,!0))),y=t.reduce(((e,t)=>e+t),0),n=t.length}else r>=U?n=0:u&&(n=U-u,r=0),t=I.filter(((e,t)=>u&&!n||n&&t>=r+n||t<r?0:e)),y=t.reduce(((e,t)=>e+t),0),a=i+y,n=t.length;const v=[...I,...t].sort(((e,t)=>t-e)),S=v.length,w=[...(c??[]).map((e=>e-1)),...(o??[]).map((e=>S-e))].map((e=>v[e])).reduce(((e,t)=>e+t),0);y-=w;let P,T=0,D=[],b=1;let N=E(0,i).map(((e,t)=>({drawPosition:t+1+y}))),M=y+1;for(const g of I){if(({roundNodes:P,matchUps:D}=tw({matchUpType:p,roundNumber:b,idPrefix:l,matchUps:D,isMock:m,nodes:N,uuids:f})),b++,t.includes(g)){const e=E(0,R(t)[g]),n=S+1-b,r=o?.includes(n)||c?.includes(b);e.forEach((()=>{const e=!r&&M||void 0;({roundNodes:P,matchUps:D,drawPosition:M}=iw({drawPosition:e,nodes:P,matchUpType:p,roundNumber:b,idPrefix:l,matchUps:D,isMock:m,uuids:f,fed:T})),b++,T+=1}))}N=P}S!==b-1&&console.log("ERROR");D=Sh({finishingPositionOffset:d?i-y:s,positionsFed:y,roundsCount:S,matchUps:D,fmlc:h});const A=P?.length?P[0]:P;return A&&(A.roundNumber=b-1,A.matchUps=D),{draw:A,matchUps:D,roundsCount:S}}function ow(e){const{finishingPositionOffset:t=0,playoffAttributes:n,stageSequence:r=1,staggeredEntry:i,structureName:a,stage:o=nd,matchUpType:s,structureId:c,idPrefix:u,drawSize:d,isMock:p,uuids:l}=e,m={finishingPositionOffset:t,matchUpType:s,drawSize:d,idPrefix:u,isMock:p,uuids:l},{matchUps:f}=i?aw(m):nw(m),h=xh({structureName:a||n?.[0]?.name||kh(nd),structureId:c||l?.pop(),stageSequence:r,matchUpType:s,matchUps:f,stage:o}),I=[h],g=[];if(d>2){const r=d/2,{matchUps:i}=nw({finishingPositionOffset:t+r,idPrefix:u&&`${u}-c`,drawSize:r,matchUpType:s,isMock:p}),o=kh(id),c=n?.["0-1"]?.name??e.consolationStructureName??(a?`${a} ${o}`:o),m=xh({structureName:c,matchUps:i,structureId:l?.pop(),stage:id,stageSequence:1,matchUpType:s});I.push(m);const f={linkType:Hi.Loser,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:zi.TopDown,structureId:m.structureId}};g.push(f)}return{...L,structures:I,links:g}}function sw({consolationStructure:e,roundOffset:t=0,mainStructure:n,roundsCount:r,feedPolicy:i,fmlc:a}){const o=e.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),s=i?.roundGroupedOrder||[],c=i?.roundFeedProfiles;return E(1+t,r+1+t).map((r=>{const i=c&&c[r-1]?c[r-1]:r%2?yd:vd,u=r-t<=2?r-t:2*(r-t-2)+2,d={linkType:Pd,source:{roundNumber:r,structureId:n.structureId},target:{feedProfile:i,roundNumber:u,structureId:e.structureId}},p=s[r-1];return p&&(d.target.groupedOrder=p),ar()&&(d.source.structureName=n.structureName,d.target.structureName=e.structureName),2===r&&a&&(d.linkCondition=Td,d.target.feedProfile=yd),o.includes(u)?d:void 0})).filter(Boolean)}function cw(e){const{playoffStructureNameBase:t,finishingPositionOffset:n,stageSequence:r=1,playoffAttributes:i,structureNameMap:a,staggeredEntry:o,stage:s=nd,matchUpType:c,structureId:u,drawSize:d,idPrefix:p,isMock:l,uuids:m}=e,f={finishingPositionOffset:n,matchUpType:c,drawSize:d,idPrefix:p,isMock:l,uuids:m},{matchUps:h,roundsCount:I}=o?aw(f):nw(f),g=e.structureName??i?.[0]?.name??kh(nd),U=xh({structureId:u||m?.pop(),structureName:g,stageSequence:r,matchUpType:c,matchUps:h,stage:s}),y=[U],v=[];if(d>2){const e=[0,2].slice(0,d/16).map(((e,n)=>{const r=n+1,{consolationStructure:o}=function({playoffStructureNameBase:e,stageSequence:t=1,playoffAttributes:n,structureNameMap:r,roundOffset:i=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:c,isMock:u,index:d,uuids:p}){const l=c/(2*Math.pow(2,i)),{matchUps:m,roundsCount:f}=aw({finishingPositionOffset:l,baseDrawSize:l,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:p}),h=0===d&&n?.["0-1"]?.name||1===d&&n?.["0-3"]?.name,I=h||`${kh(id)} ${d+1}`,g=r?.[I]||I,U=e?`${e} ${g}`:g,y=xh({matchUps:m,stage:id,structureName:U,stageSequence:t,matchUpType:a,structureId:o});return{consolationStructure:y,consolationRoundsCount:f}}({idPrefix:p&&`${p}-c${n}`,structureId:m?.pop(),playoffStructureNameBase:t,playoffAttributes:i,structureNameMap:a,stageSequence:r,roundOffset:e,matchUpType:c,drawSize:d,isMock:l,index:n,uuids:m});y.push(o);return{consolationStructure:o,links:sw({consolationStructure:o,roundsCount:2,mainStructure:U,roundOffset:e})}})),n=e.map((e=>e.links)).flat();if(v.push(...n),d>=4&&d<=16||d>32){const{matchUps:e}=nw({idPrefix:p&&`${p}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:l}),n=i?.["3-4"]?.name??kh(od),r=a?.[n]||n,o=t?`${t} ${r}`:r,s=xh({structureId:m?.pop(),matchUps:e,stageSequence:2,stage:od,structureName:o,matchUpType:c}),u={linkType:Hi.Loser,source:{roundNumber:I-1,structureId:U.structureId},target:{structureId:s.structureId,feedProfile:zi.TopDown,roundNumber:1}};y.push(s),v.push(u)}}return{structures:y,links:v,...L}}function uw(e){const{finishingPositionOffset:t=0,addNameBaseToAttributeName:n,playoffStructureNameBase:r,finishingPositionNaming:i,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:c="0",exitProfileLimit:u,roundOffsetLimit:d,roundOffset:p=0,drawDefinition:l,staggeredEntry:m,sequenceLimit:f,stage:h=nd,structureId:I,drawSize:g,idPrefix:U,isMock:y,uuids:v}=e;if(!(!o||!u||o?.[c])||g<2||f&&s>f)return{};const S=[],w=[],P=[],T=e.matchUpType||l?.matchUpType,D=t+1,R=`${D}-${t+g}`,b=o?.[c],N=r&&`${r} `||"",M=o?.[R]??i?.[R],A=e.structureName||M?.name||b?.name&&(n?`${N}${b?.name}`:b.name)||`${N}${R}`,C=M?.abbreviation||b?.abbreviation,O={idPrefix:U&&`${U}-${A}-RP`,finishingPositionOffset:t,matchUpType:T,drawSize:g,isMock:y,uuids:v},{matchUps:F}=m?aw(O):nw(O),k=xh({structureId:I||v?.pop(),structureAbbreviation:C,stageSequence:s,structureName:A,matchUpType:T,roundOffset:p,matchUps:F,stage:h});S.push(...F),w.push(k);const x=Math.ceil(Math.log(g)/Math.log(2)),_=d?Math.min(d-p,x):!a||D<a?x:0;return g>2&&E(1,_+1).forEach((e=>function(e){const m=g/Math.pow(2,e);if(m<2)return;const I=g/Math.pow(2,e)+t;if(a&&I+1>a)return;const{structures:y,structureId:D,matchUps:R,links:b}=uw({finishingPositionOffset:I,exitProfile:`${c}-${e}`,roundOffset:p+e,stageSequence:s+1,drawSize:m,addNameBaseToAttributeName:n,playoffStructureNameBase:r,finishingPositionNaming:i,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:d,drawDefinition:l,sequenceLimit:f,matchUpType:T,idPrefix:U,uuids:v,stage:h});if(k.structureId&&D){const t={linkType:Hi.Loser,source:{roundNumber:e,structureId:k.structureId},target:{roundNumber:1,feedProfile:zi.TopDown,structureId:D}};b&&k&&b.push(t),b?.length&&P.push(...b)}y?.length&&w.push(...y);R?.length&&S.push(...R);return{structureId:D,childLinks:b,structures:w}}(e))),{structureId:k.structureId,matchUps:S,structureName:A,structures:w,links:P,...L}}function dw(e){const{finishingPositionOffset:t,stageSequence:n=1,playoffAttributes:r,policyDefinitions:i,feedsFromFinal:a,staggeredEntry:o,structureName:s,stage:c=nd,structureId:u,matchUpType:d,skipRounds:p,feedRounds:l,idPrefix:m,drawSize:f,isMock:h,uuids:I,fmlc:g}=e,U=e.feedPolicy||i?.[wo],y={finishingPositionOffset:t,matchUpType:d,skipRounds:p,drawSize:f,idPrefix:m,isMock:h,uuids:I},{matchUps:v}=o?aw(y):nw(y),S=xh({structureName:s||r?.[0]?.name||kh(nd),structureId:u||I?.pop(),stageSequence:n,matchUpType:d,matchUps:v,stage:c}),w=[S],P=[],T=f/2,{matchUps:D,roundsCount:R}=aw({finishingPositionOffset:T,idPrefix:m&&`${m}-c`,isConsolation:!0,feedsFromFinal:a,baseDrawSize:T,matchUpType:d,feedRounds:l,skipRounds:p,isMock:h,uuids:I,fmlc:g});if(f>2){const t=r?.["0-1"]?.name??kh(id),n=e.playoffStructureNameBase?`${e.playoffStructureNameBase} ${t}`:t,i=xh({matchUps:D,structureId:I?.pop(),stage:id,stageSequence:1,structureName:n,matchUpType:d});w.push(i);const a=sw({consolationStructure:i,mainStructure:S,roundsCount:R,feedPolicy:U,fmlc:g});P.push(...a)}return{...L,structures:w,links:P}}function pw({requireSequential:e=!0,playoffMatchUpFormat:t,playoffAttributes:n,sourceStructureId:r,policyDefinitions:i,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:c,feedPolicy:u,groupCount:d,idPrefix:p,isMock:m,uuids:f}){u=u||i?.[wo];const h="processPlayoffGroups";let I=0;const g=[],U=[],v=[],{error:S,positionRangeMap:w}=function({playoffGroups:e,drawDefinition:t,structureId:n}){if(!t)return{error:Y};if("string"!=typeof n||!Array.isArray(e))return{error:xn};const r=e.map((({finishingPositions:e})=>e)).flat(),i=fh({drawDefinition:t,structureId:n}),a=i.playoffFinishingPositionRanges?.filter((e=>r.includes(e.finishingPosition))),o=a?.reduce(((e,t)=>(e[t.finishingPosition]=t,e)),{});return{positionRangeMap:o}}({structureId:r,drawDefinition:o,playoffGroups:s});if(S)return Mi({result:{error:S},stack:h});if(!(!w||s?.every((t=>{const{finishingPositions:n=[]}=t;if(!n.length)return!1;const r=n.sort(l).map(((e,t)=>(n[t+1]||e)-e)).every((e=>e<2));return(!e||r)&&n.every((e=>w[e]))}))))return Mi({context:{validFinishingPositions:Object.values(w)},result:{error:xn},stack:h});for(const l of s){const e=l.finishingPositions,o=w&&e.map((e=>w[e]?.finishingPositions)).flat(),s=d*e.length,h=y(s),S=2===h&&Md||l.drawType||Md;o&&(I=Math.min(...o)-1);const P=o&&`${Math.min(...o)}-${Math.max(...o)}`,T=l.structureName||P&&l.playoffAttributes?.[P]?.name||l.playoffAttributes?.[0]?.name,D={...{addNameBaseToAttributeName:l.addNameBaseToAttributeName,playoffStructureNameBase:l.playoffStructureNameBase,finishingPositionNaming:l.finishingPositionNaming,finishingPositionLimit:l.finishingPositionLimit,structureId:l.structureId??f?.pop(),playoffAttributes:l.playoffAttributes,structureNameMap:l.structureNameMap,sequenceLimit:l.sequenceLimit,structureName:T},idPrefix:p&&`${p}-po`,appliedPolicies:i,finishingPositionOffset:I,stage:od,stageSequence:a,matchUpType:c,drawSize:h,isMock:m,uuids:f},R=({playoffStructures:t,playoffLinks:n})=>{const[i]=t,a=lw({playoffStructureId:i.structureId,finishingPositions:e,sourceStructureId:r});v.push(a),v.push(...n),U.push(...t),g.push({structureId:i.structureId,finishingPositions:e}),I+=s};if(S===Md){const{matchUps:n}=nw({finishingPositionLimit:I+s,idPrefix:p&&`${p}-po`,finishingPositionOffset:I,matchUpType:c,drawSize:h,isMock:m,uuids:f}),i=xh({structureId:l.structureId??f?.pop(),matchUpFormat:t,stage:od,structureName:T,stageSequence:a,matchUps:n});U.push(i);const o=lw({playoffStructureId:i.structureId,finishingPositions:e,sourceStructureId:r});v.push(o),I+=s,g.push({structureId:i.structureId,finishingPositions:e})}else if([bd,Nd,od].includes(S)){const t={playoffAttributes:l.playoffAttributes??n,playoffStructureNameBase:l.playoffStructureNameBase,structureId:l.structureId??f?.pop(),structureName:l.structureName,idPrefix:p&&`${p}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:I,stage:od,roundOffset:0,stageSequence:a,drawSize:h,isMock:m,uuids:f};S===bd?Object.assign(t,{playoffAttributes:l?.playoffAttributes??n??Kd,roundOffsetLimit:3}):S===Nd&&Object.assign(t,{playoffAttributes:l?.playoffAttributes??n??Qd,roundOffsetLimit:2});const i=uw(t);if(i.error)return i;if(i.links?.length&&v.push(...i.links),i.structures?.length&&U.push(...i.structures),U.sort(tp),i.structureId){const t=lw({playoffStructureId:i.structureId,finishingPositions:e,sourceStructureId:r});v.push(t),g.push({structureId:i.structureId,finishingPositions:e})}I+=s}else if([Ed,$d,jd,Bd,_d,qd].includes(S)){const t=[f?.pop(),f?.pop()],n={playoffStructureNameBase:l.playoffStructureNameBase,structureId:l.structureId??f?.pop(),playoffAttributes:l.playoffAttributes,idPrefix:p&&`${p}-po`,finishingPositionOffset:I,uuids:t,stage:od,structureName:T,matchUpType:c,feedPolicy:u,drawSize:h,isMock:m},i={[Ed]:{fmlc:!0,feedRounds:1},[qd]:{feedRounds:1},[jd]:{feedsFromFinal:3},[Bd]:{feedsFromFinal:2},[_d]:{feedsFromFinal:1}};Object.assign(n,i[S]||{});const{structures:a,links:o}=dw(n),[d]=a,y=lw({playoffStructureId:d.structureId,finishingPositions:e,sourceStructureId:r});v.push(y),v.push(...o),U.push(...a),g.push({structureId:d.structureId,finishingPositions:e}),I+=s}else if([Wd].includes(S)){const{structures:e,links:t}=jh({...D,structureOptions:l.structureOptions||{groupSize:4}});R({playoffStructures:e,playoffLinks:t})}else if([Cd].includes(S)){const{structures:e,links:t}=ow(D);R({playoffStructures:e,playoffLinks:t})}else if([kd].includes(S)){const{structures:e,links:t}=cw(D);R({playoffStructures:e,playoffLinks:t})}else if([Dd].includes(S)){R({playoffStructures:[xh({structureId:l.structureId??f?.pop(),structureName:l.structureName,finishingPosition:as,stage:od,stageSequence:a,matchUps:[]})],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:w,structures:U,links:v}}function lw({playoffStructureId:e,finishingPositions:t,sourceStructureId:n}){return{linkType:Sd,source:{structureId:n,finishingPositions:t},target:{structureId:e,feedProfile:gd,roundNumber:1}}}function mw({structureName:e,matchUpType:t,idPrefix:n,drawSize:r,isMock:i,uuids:a}){const o=[],{matchUps:s}=aw({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:t,idPrefix:n,isMock:i}),c=xh({structureName:e||kh(nd),structureId:a?.pop(),stageSequence:1,stage:nd,matchUpType:t,matchUps:s});o.push(c);const u=r/2,{matchUps:d}=aw({finishingPositionOffset:u,idPrefix:n&&`${n}-c`,drawSize:r-1,isConsolation:!0,matchUpType:t,isMock:i,uuids:a}),p=xh({structureName:kh(Yd),matchUps:d,structureId:a?.pop(),stage:id,stageSequence:2,matchUpType:t});o.push(p);const{matchUps:l}=nw({idPrefix:n&&`${n}-p1t2`,drawSize:2,matchUpType:t,isMock:i}),m=xh({structureName:kh(zd),matchUps:l,structureId:a?.pop(),stageSequence:3,stage:od,matchUpType:t});o.push(m);const f=function({mainStructure:e,consolationStructure:t,deciderStructure:n}){const r=t.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),i=e.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0),a=t.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0);return[...r.map(((n,i)=>{const a=r.indexOf(n)%2?yd:vd;return{linkType:Pd,source:{roundNumber:1+i,structureId:e.structureId},target:{feedProfile:a,roundNumber:n,structureId:t.structureId}}})),{linkType:wd,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:yd,roundNumber:i,structureId:e.structureId}},{linkType:wd,source:{roundNumber:i,structureId:e.structureId},target:{feedProfile:yd,roundNumber:1,structureId:n.structureId}},{linkType:Pd,source:{roundNumber:i,structureId:e.structureId},target:{feedProfile:yd,roundNumber:1,structureId:n.structureId}}]}({mainStructure:c,consolationStructure:p,deciderStructure:m});return{structures:o,links:f,...L}}function fw(e){const{qualifyingRoundNumber:t,finishingPositionOffset:n,qualifyingPositions:r,matchUpType:i,idPrefix:a,drawSize:o,isMock:s,uuids:c}=e;if(!S(o)||o<2)return{matchUps:[],roundsCount:0};if(f(o))return nw(e);const u=function(e){const t=m(e);let n=t%2?t+1:t;const r=!!(Math.ceil(n/2)%2),i=[{participantsCount:n,preFeedRound:r}];for(;n>2;){const e=Math.ceil(n/2),t=1===e,r=!(t||!(e%2));n=!t&&r?e+1:e;const a=!!(2!==n&&Math.ceil(n/2)%2);i.push({participantsCount:n,preFeedRound:a,feedRound:r})}return i}(o),d=u.shift(),p=E(1,(d?.participantsCount||0)+1).map((e=>({drawPosition:e})));let l=[],h=1;({matchUps:l}=tw({roundNumber:h,matchUpType:i,idPrefix:a,matchUps:l,isMock:s,nodes:p,uuids:c})),h++;let I=e.roundLimit||t;for(const m of u){const e=m.participantsCount/2,t=E(1,e+1);r&&e===r&&(I=h-1);const n=t.map((e=>{const t=ew({roundPosition:e,roundNumber:h,idPrefix:a,uuids:c});return{roundPosition:e,roundNumber:h,matchUpId:t}}));l.push(...n),h++}const g=h-1;return l=Sh({finishingPositionOffset:n,lucky:!0,roundsCount:g,roundLimit:I,matchUps:l}),I&&(l=l.filter((e=>e.roundNumber<=I))),{matchUps:l,roundsCount:g,roundLimit:I}}function hw(e){const{playoffAttributes:t,stageSequence:n=1,structureId:r,stage:i=nd,matchUpType:a,drawSize:o,uuids:s}=e,{appliedPolicies:c}=Xo(e),u=e.policyDefinitions?.[wo]||c?.[wo];e.skipRounds=e.skipRounds||o<=4&&(u?.feedMainFinal?0:1)||0;const d=e.structureName??t?.[0]?.name??kh(nd),p={[Dd]:()=>({structures:[xh({structureId:r||s?.pop(),finishingPosition:Jd,stageSequence:n,structureName:d,matchUps:[],matchUpType:a,stage:i})],links:[],...L}),[Od]:()=>{const{matchUps:t}=fw(e);return{structures:[xh({structureId:r||s?.pop(),stageSequence:n,structureName:d,matchUpType:a,matchUps:t,stage:i})],links:[],...L}},[Md]:()=>(()=>{const{matchUps:t}=nw(e);return{structures:[xh({structureId:r||s?.pop(),stageSequence:n,structureName:d,matchUpType:a,matchUps:t,stage:i})],links:[],...L}})(),[Ad]:()=>mw(e),[bd]:()=>uw({...e,roundOffsetLimit:3,playoffAttributes:t??Kd}),[Nd]:()=>uw({...e,roundOffsetLimit:2,playoffAttributes:t??Qd}),[od]:()=>uw(e),[Rd]:()=>{const{matchUps:e}=aw({drawSize:o,uuids:s,matchUpType:a});return{structures:[xh({structureId:r||s?.pop(),stageSequence:n,structureName:d,matchUpType:a,stage:nd,matchUps:e})],links:[],...L}},[Cd]:()=>ow(e),[Ed]:()=>dw({...e,feedRounds:1,fmlc:!0}),[Gd]:()=>dw({...e,feedRounds:1}),[xd]:()=>dw({...e,feedsFromFinal:1}),[Ld]:()=>dw({...e,feedsFromFinal:2}),[Vd]:()=>dw({...e,feedsFromFinal:3}),[$d]:()=>dw(e),[Fd]:()=>cw(e),[Wd]:()=>jh(e),[Hd]:()=>function(e){const{drawDefinition:t,structureOptions:n,requireSequential:r}=e,i={structureName:kh(nd),...e,stage:nd},{structures:a,groupCount:o,groupSize:s}=jh(i);if(o<1)return{error:En};const c=n?.playoffGroups||[{finishingPositions:[1],structureName:kh(od)}],[u]=a,{structures:d,links:p}=pw({sourceStructureId:u.structureId,requireSequential:r,drawDefinition:t,playoffGroups:c,groupCount:o,groupSize:s,...e});return d&&a.push(...d),{...L,structures:a,links:p}}(e)};return{generators:p}}function Iw(e){const{enforceMinimumDrawSize:t=!0,overwriteExisting:n,appliedPolicies:r,staggeredEntry:i,drawDefinition:a,tieFormat:o,drawSize:s,isMock:c,uuids:u}=e||{},d=e.drawTypeCoercion??r?.[Po]?.drawTypeCoercion??!0,p="generateDrawStructuresAndLinks";let l=d&&2===e.drawSize&&qi.SingleElimination||e.drawType||qi.SingleElimination;const h=[],I=[],g=e?.matchUpType??_i,U=a?.structures?.filter((({stage:e})=>e===rd));U&&h.push(...U);const y=U?.map((({structureId:e})=>e)),v=a?.structures?.find((({stage:e,stageSequence:t})=>e===nd&&1===t)),S=a?.links?.filter((e=>e.target.structureId===v?.structureId&&y?.includes(e.source.structureId))),w=(e,t)=>{if(e.linkType===Sd&&t?.structures){const n=e.source.finishingPositions||[];return t.structures.length*n.length}if(e.linkType===wd&&t?.matchUps?.length){const n=e.source.roundNumber;return t.matchUps.filter((({roundNumber:e})=>e===n)).length}},P=U?.map((e=>{const t=S?.find((t=>t.target.structureId===e.structureId)),n=op({structure:e})?.positionAssignments?.length??0;if(!t)return n;const r=t?.source.structureId,i=a.structures?.find((e=>e.structureId===r));return n-(w(t,i)||0)})).filter(Boolean).reduce(((e,t)=>e+t),0),T=S?.map((e=>{const t=e.source.structureId,n=U?.find((e=>e.structureId===t));return w(e,n)})).filter(Boolean).reduce(((e,t)=>e+t),0),D=!(!v||v?.matchUps?.length);if(U?.length&&!D)return{error:Yn};const R=!U?.length&&e.qualifyingProfiles,b=R?.length&&rw({idPrefix:e.idPrefix,qualifyingProfiles:R,appliedPolicies:r,isMock:c,uuids:u});if(b?.error)return b;const{qualifyingDrawPositionsCount:N,qualifyingDetails:M,qualifiersCount:A}=b||{qualifyingDrawPositionsCount:P,qualifiersCount:T};N&&(b?.structures&&h.push(...b.structures),b?.links&&I.push(...b.links)),Object.assign(e,pi({drawSize:s,matchUpType:g,tieFormat:o}));const E=l!==Dd&&(isNaN(s)||s<2||!i&&![Rd,Od].includes(l)&&([Hd,Wd].includes(l)&&s<3||![Wd,Hd].includes(l)&&!f(s)));if(E&&!N)return Mi({context:{drawSize:s,invalidDrawSize:E},result:{error:ue},stack:p});const C=Zd.includes(l);if(m(s)<4&&C)if(d)l=Md;else if(t)return Mi({context:{enforceMinimumDrawSize:t,invalidDrawSize:E,drawSize:s,drawType:l},result:{error:ue},stack:p});const{generators:O,error:F}=hw(e);if(F)return{error:F};const k=O[l];if(!k)return{error:re};const x=k?.();if(x.error)return x;const{structures:_,links:B}=x;if(_?.length){const e=_.find((({stage:e,stageSequence:t})=>e===nd&&1===t));if(v&&e)if(D){const t=e.structureId;if(e.structureId=v.structureId,B?.length)for(const e of B)e.source.structureId===t&&(e.source.structureId=v.structureId),e.target.structureId===t&&(e.target.structureId=v.structureId)}else if(!n)return{error:Yn};h.push(..._)}h.sort(tp),B?.length&&I.push(...B);const V=x.structures.find((({stage:e,stageSequence:t})=>e===nd&&1===t));for(const m of M||[]){const{finalQualifyingRoundNumber:e,finalQualifyingStructureId:t,roundTarget:n,finishingPositions:r,linkType:i}=m,a=V&&ZS({targetStructureId:V.structureId,sourceStructureId:t,sourceRoundNumber:e,finishingPositions:r,targetEntryRound:n,linkType:i})?.link;if(a?.error)return a;a&&I.push(a)}return S&&I.push(...S),{...L,qualifyingResult:{qualifyingDrawPositionsCount:N,qualifiersCount:A},structures:h,links:I}}function gw(e){const{provisionalPositioning:t,drawDefinition:n,stageSequence:r,structureId:i,stage:a}=e;if(!n)return{error:Y};const{entryProfile:o}=up({drawDefinition:n}),s=a&&r&&o?.[a]?.stageSequence?.[r]?.qualifiersCount||a&&o?.[a]?.qualifiersCount||0,c={};if(!i)return{qualifiersCount:s,roundQualifiersCounts:c};const{structure:u}=rp({drawDefinition:n,structureId:i}),d=n.links?.filter((e=>e?.target?.structureId===u?.structureId));let p=0;if(d?.length)for(const m of d){const e=rp({structureId:m.source.structureId,drawDefinition:n})?.structure;if(e?.stage===rd){const n=m.source.roundNumber,r=m.target.roundNumber;let i=0;if(e.structureType===Id){i=(e.structures?.length||0)*(m.source.finishingPositions?.length||0)}else{const r=Kp({matchUpFilters:{roundNumbers:[n]},structure:e,afterRecoveryTimes:!1,provisionalPositioning:t,inContext:!1}).matchUps;i=r?.length||0}c[r]||(c[r]=0),c[r]+=i,p+=i}}const l=Object.keys(c);if(l.length<=1){const e=l[0]||1;c[e]=Math.max(c[e]||0,s)}return p=Math.max(p,s),{qualifiersCount:p,roundQualifiersCounts:c}}function Uw({stage:e,drawDefinition:t}){const{entryProfile:n}=up({drawDefinition:t});return n?.[e]?.drawSize||0}function yw({stageSequence:e=1,drawDefinition:t,drawSize:n,stage:r}){if(!t)return{error:Y};if(!Ep({drawDefinition:t,stage:r}))return{error:_e};const i=Fp({drawDefinition:t,stage:r}),{qualifiersCount:a}=gw({drawDefinition:t,stageSequence:e,stage:r});if(n<i+a)return{error:de};const{entryProfile:o}=cp({attributes:[{[r]:{drawSize:n}}],drawDefinition:t});return al({drawDefinition:t}),{...L,entryProfile:o}}function vw({qualifiersCount:e=0,drawDefinition:t,stage:n}){return t?Ep({drawDefinition:t,stage:n})?n!==nd?{error:de,info:"qualifiersCount can only be set for main stage"}:(cp({attributes:[{[n]:{qualifiersCount:e}}],drawDefinition:t}),al({drawDefinition:t}),{...L}):{error:_e}:{error:Y}}function Sw(e){const{modifyOriginal:t=!0,stageSequence:n=1,isMock:r}=e||{},i="generateDrawTypeAndModifyDrawDefinition";if(!e.drawDefinition)return Mi({result:{error:Y},stack:i});const a=t?e.drawDefinition:ii(e.drawDefinition,!1,!0);let{tieFormat:o,matchUpType:s}=e;if(o){const t=e.event?.eventType,n=ca({tieFormat:o,eventType:t});if(n.error)return n}o=ul(o||Ni({drawDefinition:a})?.tieFormat),s=s||a.matchUpType||_i,e.tieFormat=o,e.matchUpType=s;const c=Uw({drawDefinition:a,stage:nd});e.drawSize=e.drawSize||c,!c&&e.drawSize&&yw({drawSize:e.drawSize,drawDefinition:a,stageSequence:n,stage:nd});const u=_p({drawDefinition:a}).drawMatchUps.map(Pl),d=Iw(e);if(d.error)return Mi({result:d,stack:i});const{structures:p,links:l,qualifyingResult:m}=d;a.structures=p,a.links=l;const f=Math.max(e.qualifiersCount||0,m?.qualifiersCount||0);if(m?.qualifyingDrawPositionsCount){if(!Uw({stage:rd,drawDefinition:a})){const e=yw({drawSize:m.qualifyingDrawPositionsCount,stage:rd,drawDefinition:a});if(e.error)return e}}if(f){const e=vw({qualifiersCount:f,drawDefinition:a,stage:nd});if(e.error)return e}const h=e.drawSize||c;Object.assign(e,pi({drawSize:h,matchUpType:s,tieFormat:o}));const{matchUps:I,matchUpsMap:g}=Cl({drawDefinition:a});o&&I?.forEach((e=>{if(!u.includes(e.matchUpId)){const{tieMatchUps:t}=Yy({tieFormat:o,isMock:r});Object.assign(e,{tieMatchUps:t,matchUpType:s})}}));const{inContextDrawMatchUps:U}=wh({drawDefinition:a,matchUpsMap:g});return al({tournamentId:e.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:U,drawDefinition:a,matchUpsMap:g,...L,structures:p,matchUps:I,links:l}}function ww({significantCharacters:e,accessors:t=[],value:n}){const r=[],i=t[0];if(n?.[i]){const a=t.slice(1);if(Array.isArray(n[i])){n[i].forEach((t=>{const n=ww({accessors:a,significantCharacters:e,value:t});r.push(...n)}))}else if(n=n[i],a.length){const t=ww({accessors:a,significantCharacters:e,value:n});r.push(...t)}else!function({value:t}){if(t&&["string","number"].includes(typeof t)){const n=e?t.slice(0,e):t;r.push(n)}}({value:n})}return r}function Pw({policyAttributes:e,idCollections:t,participants:n,participant:r}){if(!Array.isArray(e))return{error:at};if(!r)return{error:xt};const i=[];e.forEach((e=>{const{directive:a,groupings:o,key:s,significantCharacters:c}=e||{};if(s){const e=s.split(".");i.push(...ww({significantCharacters:c,value:r,accessors:e}))}else if(a){const o=e?.includeIds,s=(t?.[a]||[]).filter((e=>!o||o.includes(e)));s?.length&&n?.length&&s.forEach((e=>{const t=n.find((t=>t.participantId===e));if(t?.individualParticipantIds?.includes(r.participantId)){const e=t?.participantId;i.push(e)}}))}else o&&Object.keys(o).forEach((e=>{o[e].includes(r.participantId)&&i.push(e)}))}));return{values:P(i)}}function Tw({candidatePositionAssignments:e,participantsWithGroupings:t,policyAttributes:n,idCollections:r}){const i=Object.assign({},...t.map((e=>({[e.participantId]:e}))));return e.map((e=>{const a=i[e.participantId],{values:o}=Pw({participants:t,policyAttributes:n,idCollections:r,participant:a});return{...e,values:o}}))}function Dw({participantIdGroups:e,positionAssignments:t,groupsToAvoid:n}){return Object.assign({},...t.filter((e=>e?.participantId)).map((t=>{const{drawPosition:r,participantId:i}=t,a=e&&e[i]||[],o=!!n.some((e=>a.includes(e)));return{[r]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function Rw(e){const{unfilledPositions:t,chunkedDrawPositions:n}=e,r=Dw(e);return n.map((e=>{const n=t.filter((t=>e.includes(t))),i=function(e){return e.filter((e=>!t(e)));function t(t){const n=bw(t);return!e.includes(n)}}(n),a=n.filter((e=>!i.includes(e))).filter((e=>{const t=bw(e);return!r[t]?.includesGroupsToAvoid}));return{unassigned:n,unpaired:i,pairedNoConflict:a}}))}function bw(e){return Number(e%2?e+1:e-1)}function Nw({selectedParticipantGroups:e,participantIdGroups:t,positionAssignments:n,drawPositionChunks:r,unfilledPositions:i,isRoundRobin:a}){const o=r.map((r=>a?function(e){const{unfilledPositions:t,chunkedDrawPositions:n}=e,r=Dw(e);return n.map((e=>{const n=t.filter((t=>e.includes(t))),i=n.length===e.length?n:[],a=e.filter((e=>r[e]?.includesGroupsToAvoid)).length;return{unassigned:n,unpaired:i,pairedNoConflict:a?[]:n,conflictsCount:a}}))}({groupsToAvoid:e,chunkedDrawPositions:r,participantIdGroups:t,positionAssignments:n,unfilledPositions:i}):Rw({groupsToAvoid:e,chunkedDrawPositions:r,participantIdGroups:t,positionAssignments:n,unfilledPositions:i})));if(a){return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>e?.length)))).filter((e=>e?.length)).sort(((e,t)=>(t.length||0)-(e.length||0))),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>e?.length)))).filter((e=>e?.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>e?.length)))).filter((e=>e?.length)).sort(((e,t)=>(t.length||0)-(e.length||0)))}}return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>e?.length)))).filter((e=>e?.length)),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>e?.length)))).filter((e=>e?.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>e?.length)))).filter((e=>e?.length))}}function Mw({positionAssignments:e,participantIds:t}){const n=e.map((e=>e.participantId));return t.filter((e=>!n.includes(e)))}function Aw({candidatePositionAssignments:e,unseededParticipantIds:t,participantIdGroups:n,drawPositionChunks:r,drawPositionGroups:i,pairedPriority:a,allGroups:o,groupKey:s}){const c=i.reduce(((e,t)=>t.length>e?t.length:e),0)<=2,u=Mw({positionAssignments:e,participantIds:t}),d=function({drawPositionGroups:e,positionAssignments:t}){const n=Object.assign({},...t.map((e=>({[e.drawPosition]:e}))));return e.map((e=>e.filter(Boolean).map((e=>n[e])).filter(Boolean).filter((e=>!e.participantId&&!e.bye)).map((e=>e.drawPosition)))).flat().filter(Boolean)}({positionAssignments:e,drawPositionGroups:i}),{participantId:p,groupKey:l}=function({useSpecifiedGroupKey:e=!1,targetParticipantIds:t,largestFirst:n=!0,allGroups:r,groupKey:i}){const a=Object.assign({},...Object.keys(r).map((e=>[e,r[e].filter((e=>t.includes(e)))])).filter((e=>e[1].length)).map((([e,t])=>({[e]:t})))),o=Object.keys(a).reduce(((e,t)=>a[t].length>e?a[t].length:e),0),s=Object.keys(a).filter((e=>a[e].length===o)),c=A(n?s:Object.keys(a));return{participantId:(i=e&&a[i]?.length?i:c)&&a[i]?A(a[i]):A(t),groupKey:i}}({targetParticipantIds:u,useSpecifiedGroupKey:c,allGroups:o,groupKey:s}),m=function({allGroups:e,participantId:t}){return Object.keys(e).filter((n=>e[n].includes(t)))}({participantId:p,allGroups:o}),f=Nw({positionAssignments:e,isRoundRobin:c,selectedParticipantGroups:m,participantIdGroups:n,drawPositionChunks:r,unfilledPositions:d}),{unassigned:h,unpaired:I,pairedNoConflict:g}=f,U=g?.length&&g[0],y=I?.length&&I[0],v=a&&U?U:y,S=a?y:U,w=v?.length&&v||S?.length&&S;let P;if(w?.length){const e=M(w);P=M(e)}else{const e=M(h[0]);P=M(e)}return{newGroupKey:l,selectedParticipantId:p,targetDrawPosition:P}}function Ew({isRoundRobin:e,groupedParticipants:t}){const n=[];return e?t.forEach((e=>{const t=e.map((e=>e.drawPosition)),{uniqueMatchUpGroupings:r}=_h({drawPositions:t}),i=Object.assign({},...e.map((e=>({[e.drawPosition]:e}))));r.forEach((t=>{k(i[t[0]].values||[],i[t[1]].values||[])&&(n.push(t),e.conflict=!0)}))})):t.forEach((e=>{k(e[0]?.values||[],e[1]?.values||[])&&(n.push(e),e.conflict=!0)})),n}function Cw({positionedParticipants:e,potentialDrawPositions:t,drawPositionGroups:n,avoidanceConflicts:r,isRoundRobin:i}){return r.map((r=>{const a=r.map((e=>e.drawPosition));return r.filter((e=>t.includes(e.drawPosition))).map((r=>{const o=t.filter((e=>!a?.includes(e))).filter((t=>{const a=n.find((e=>e.includes(t))).find((e=>e!==t)),o=e.find((e=>e.drawPosition===a)),s=Ew({isRoundRobin:i,groupedParticipants:[[r,o]]}),c=e.find((e=>e.drawPosition===t)),u=Ew({isRoundRobin:i,groupedParticipants:[[c,o]]});return!s.length&&!u.length}));if(o.length)return{drawPosition:r.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function Ow(e){const{initialPositionAssignments:t,participantsWithGroupings:n,opponentsToPlaceCount:r,unseededByePositions:i,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:c}=e,u=[];let d;const p=Math.min(...(a||[]).map((e=>e?.length)).filter(Boolean)),l=p>2,m=ii(t,!1,!0).filter((e=>!e.qualifier)),f=t.filter((e=>!e.participantId&&(!e.bye||i?.includes(e.drawPosition)))).map((e=>e.drawPosition));E(0,r).forEach((()=>{const{newGroupKey:t,selectedParticipantId:n,targetDrawPosition:r}=Aw({...e,candidatePositionAssignments:m,allGroups:c,groupKey:d});d=t,m.forEach((e=>{e.drawPosition===r&&(e.participantId=n)}))}));let h=Tw({candidatePositionAssignments:m,participantsWithGroupings:n,policyAttributes:o,idCollections:s}),I=x(h,p),g=Ew({groupedParticipants:I,isRoundRobin:l}),U=0;for(;U<20&&g.length;){const e=Cw({positionedParticipants:h,potentialDrawPositions:f,avoidanceConflicts:g,drawPositionGroups:a,isRoundRobin:l});if(e.length){const t=Fw({candidatePositionAssignments:m,swapOptions:e});t.error&&console.log({result:t}),h=Tw({candidatePositionAssignments:m,participantsWithGroupings:n,policyAttributes:o,idCollections:s}),I=x(h,p),g=Ew({groupedParticipants:I,isRoundRobin:l}),U++}else U=20}return m.forEach((e=>{if(e.bye&&e.participantId){const e=Ue;u.push(e)}if(e.qualifier&&e.participantId){const e=Ue;u.push(e)}})),{positionAssignments:m,conflicts:g.length,groupedParticipants:I,errors:u}}function Fw({candidatePositionAssignments:e,swapOptions:t}){const n=M(t);if(!n)return{error:{message:"No swap options"}};const r=n.drawPosition,i=M(n.possibleDrawPositions),a=e.find((e=>e.drawPosition===r)),o=e.find((e=>e.drawPosition===i))??{},s={participantId:o?.participantId,qualifier:o?.qualifier,bye:o?.bye},c={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,c),{...L}}function kw({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:n,unseededByePositions:r,tournamentRecord:i,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,avoidance:d,drawSize:p,event:m}){if(!d)return{error:it};const{candidatesCount:h=1,policyAttributes:I,targetDivisions:U}=d;let{roundsToSeparate:y}=d;const v="randomUnseededSeparation",{structure:S}=rp({drawDefinition:a,structureId:u}),{matchUps:w}=Kp({provisionalPositioning:e,matchUpsMap:c,structure:S,event:m});if(U&&f(U)&&!y){const e=function(e){if(!f(e))return!1;let t=e,n=1;for(;2!==t;)n+=1,t/=2;return n}(U)||0,t=w.reduce(((e,t)=>t.roundNumber>e?t.roundNumber:e),0);y=t<e?1:t-e+1}const{positionAssignments:P}=sp({structure:S}),T=gl({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,D=P?.filter((e=>!e.participantId)),R=P?.map((e=>e.drawPosition)),b=S?.structureType===Id,N=b?{structure:S,matchUps:w,allDrawPositions:R,roundsToSeparate:y}:{matchUps:w,allDrawPositions:R,roundsToSeparate:y},{drawPositionGroups:M,drawPositionChunks:A}=b?function(e){const{structure:{structures:t}}=e,n=t.map((e=>e.positionAssignments.map((e=>e.drawPosition))));return{drawPositionGroups:n,drawPositionChunks:[n]}}(N):function({allDrawPositions:e,roundsToSeparate:t,matchUps:n}){const r=n.filter((e=>1===e.roundNumber)).map((e=>e.drawPositions)),i=r.flat().sort(l),a=Math.max(...i),o=e.filter((e=>e>a)),s=i.length,c=E(2===s?1:2,s).filter((e=>e===g(e))),u=c.slice(0,t||c.length).reverse(),d=u.map((e=>x(i,e)));o.length&&console.log({fedDrawPositions:o});return{drawPositionGroups:r,drawPositionChunks:d}}(N),C={groupParticipants:s.filter((e=>e.participantType===$u)).map((e=>e.participantId)),teamParticipants:s.filter((e=>e.participantType===Hu)).map((e=>e.participantId)),pairParticipants:s.filter((e=>e.participantType===Wu)).map((e=>e.participantId))},O=function({targetParticipantIds:e,policyAttributes:t,idCollections:n,participants:r}){if(!Array.isArray(t))return{error:at};if(!Array.isArray(r))return{error:_t};const i={};return e.forEach((e=>{const a=r.find((t=>t.participantId===e)),{values:o}=Pw({policyAttributes:t,idCollections:n,participants:r,participant:a});o&&o.forEach((t=>{i[t]||(i[t]=[]),i[t].includes(e)||i[t].push(e)}))})),i}({targetParticipantIds:t,policyAttributes:I,idCollections:C,participants:s}),F=Object.assign({},...t.map((e=>{const t=Object.keys(O).filter((t=>O[t].includes(e)));return{[e]:t}}))),k=Mw({participantIds:t,positionAssignments:P});if(k.length>(D?.length||0))return{error:an};let _;const B=k.length,V=E(0,h).map((()=>Ow({initialPositionAssignments:P,participantsWithGroupings:T,unseededParticipantIds:t,opponentsToPlaceCount:B,pairedPriority:!1,unseededByePositions:r,participantIdGroups:F,drawPositionChunks:A,drawPositionGroups:M,policyAttributes:I,idCollections:C,allGroups:O,drawSize:p})));if(_=V.reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0),!_||_.conflicts){const e=E(0,h).map((()=>Ow({initialPositionAssignments:P,participantsWithGroupings:T,unseededParticipantIds:t,opponentsToPlaceCount:B,pairedPriority:!0,unseededByePositions:r,participantIdGroups:F,drawPositionChunks:A,drawPositionGroups:M,policyAttributes:I,idCollections:C,allGroups:O,drawSize:p})));_=V.concat(...e).filter((e=>!e.errors?.length)).reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0)}if(!_)return{error:An};const j=(op({structure:S})?.positionAssignments??[]).filter((e=>e.participantId)).map((e=>e.participantId)),G=_.positionAssignments.filter((e=>!j.includes(e.participantId)));for(const l of G)if(l.bye){const e=ty({tournamentRecord:i,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:c,event:m,...l});if(e.error)return Mi({result:e,stack:v})}else if(l.participantId){const e=Ty({automaticPlacement:!0,inContextDrawMatchUps:n,tournamentRecord:i,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:c,event:m,...l});if(e.error)return Mi({result:e,stack:v,context:{assignment:l}})}return{...L}}function xw({provisionalPositioning:e,inContextDrawMatchUps:t,unseededByePositions:n,multipleStructures:r,tournamentRecord:i,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,structure:d,drawSize:p,event:l}){d||({structure:d}=rp({drawDefinition:a,structureId:u})),u||({structureId:u}=d);const{positionAssignments:m}=sp({structure:d}),{seedAssignments:f}=kp({provisionalPositioning:e,drawDefinition:a,structure:d}),h=f?.map((e=>e.participantId)).filter(Boolean),{stage:I,stageSequence:g}=d,U=I===rd?Ms({element:d,name:qo})?.extension?.value:void 0,y=Op({provisionalPositioning:e,drawDefinition:a,stageSequence:g,entryStatuses:Rp,structureId:u,roundTarget:U,stage:I}),v=y.filter((e=>!h?.includes(e.participantId))).map((e=>e.participantId)),S=m?.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));if(!r&&v.length>(S?.length||0))return Mi({result:{error:an},context:{unseededParticipantsCount:v.length,unfilledDrawPositionsCount:S?.length},stack:"positionUnseededParticipants"});const{appliedPolicies:w}=Xo({tournamentRecord:i,drawDefinition:a,event:l});let P=(w??{})[Uo];if(d.stage===od){const e=y.reduce(((e,t)=>(e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e)),{});Object.keys(e).length&&(P||(P={policyName:"Playoff Avoidance"}),P.policyAttributes||(P.policyAttributes=[]),P.policyAttributes.push({groupings:e}))}return P&&s?kw({provisionalPositioning:e,unseededParticipantIds:v,inContextDrawMatchUps:t,unseededByePositions:n,tournamentRecord:i,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,avoidance:P,drawSize:p,entries:y}):function({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:n,unfilledDrawPositions:r,multipleStructures:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:c,structureId:u,drawSize:d,event:p}){const l=d>2?T(r):r.reverse();for(const m of t){const t=l.pop();if(!i||t){const r=Ty({provisionalPositioning:e,inContextDrawMatchUps:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:t,matchUpsMap:c,structureId:u,event:p});if(r?.error&&console.log("!!!!!",{result:r}),r?.error)return Mi({result:r,stack:"randomUnseededDistribution"})}}return{...L}}({provisionalPositioning:e,unseededParticipantIds:v,inContextDrawMatchUps:t,unfilledDrawPositions:S,multipleStructures:r,tournamentRecord:i,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:c,drawSize:p,event:l})}function _w({orderedSortedFirstRoundSeededDrawPositions:e,validSeedBlocks:t,byesToPlace:n}){const r=[];t.forEach((t=>{if(n-r.length>t.drawPositions.length)r.push(...t.drawPositions);else{const n=Bw(x(t.drawPositions,2));let i,a=e[r.length];for(;i=Lw(n,a);)r.push(i),a=e[r.length]}}));const i=r.map((e=>Array.isArray(e)?T(e):e)).flat(1/0);if(function(e){const t=m(e);if(!isNaN(t))return 0!==t&&1==(t&-t)}(n)){if(t.map((e=>e.seedNumbers[0])).includes(n))return e}return i}function Lw(e,t){if(Array.isArray(e)&&2!==e.length)return e.pop();if(!Array.isArray(e[0]))return e.includes(t)?e.indexOf(t)?e.pop():e.shift():Math.round(Math.random())?e.pop():e.shift();const n=e[0].flat(1/0).length,r=e[1].flat(1/0).length;if(n===r){const n=e[0].flat(1/0).includes(t)?e[0]:e[1];return Lw(t?n:e[Math.round(Math.random())],t)}return Lw(n<r?e[1]:e[0],t)}function Bw(e){const t=Math.floor(e.length/2);return e.length>2?[Bw(e.slice(0,t)),Bw(e.slice(t))]:e}function Vw({provisionalPositioning:e,relevantMatchUps:t,appliedPolicies:n,drawDefinition:r,seedingProfile:i,seedBlockInfo:a,byesToPlace:o,structure:s}){a||(a=iU({provisionalPositioning:e,appliedPolicies:n,drawDefinition:r,seedingProfile:i,structure:s}));const{isFeedIn:c,isLuckyStructure:u,isContainer:d}=a;let{validSeedBlocks:p}=a;n?.seeding?.containerByesIgnoreSeeding&&(p=[]);const l=function({provisionalPositioning:e,drawDefinition:t,structure:n}){const{positionAssignments:r}=sp({structure:n}),{seedAssignments:i}=kp({provisionalPositioning:e,drawDefinition:t,structure:n}),a=Object.assign({},...(i||[]).filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))));return r?.map((e=>a[e.participantId]?{...e,seedNumber:a[e.participantId].seedNumber,seedValue:a[e.participantId].seedValue}:"")).filter(Boolean)}({provisionalPositioning:e,drawDefinition:r,structure:s})??[],m=P([].concat(...t.map((e=>e.drawPositions)))),f=l.filter((e=>m.includes(e.drawPosition))),h=(e,t)=>nU(e.seedValue)-nU(t.seedValue),I=p.reduce(((e,t)=>{const n=f.filter((e=>t.drawPositions?.includes(e.drawPosition))).sort(h);return e.concat(...n)}),[]).map((e=>e.drawPosition)),g=_w({orderedSortedFirstRoundSeededDrawPositions:I,validSeedBlocks:p,byesToPlace:o});return{strictSeedOrderByePositions:jw({orderedSeedDrawPositions:I,relevantMatchUps:t}).slice(0,o),blockSeedOrderByePositions:jw({orderedSeedDrawPositions:g,relevantMatchUps:t}).slice(0,o),isLuckyStructure:u,positionedSeeds:l,isContainer:d,isFeedIn:c}}function jw({orderedSeedDrawPositions:e,relevantMatchUps:t}){const n=t.map((e=>e.drawPositions)).map((e=>e?.sort(((e,t)=>e-t)))).filter((e=>e?.[0]+1===e?.[1]));return e.map((e=>n.find((t=>t?.includes(e))))).filter(Boolean).map((t=>t?.reduce(((t,n)=>e.includes(n)?t:n),void 0))).filter(Boolean)}function Gw({provisionalPositioning:e,tournamentRecord:t,appliedPolicies:n,drawDefinition:r,seedBlockInfo:i,seedingProfile:a,matchUpsMap:o,structureId:s,structure:c,seedLimit:u,seedsOnly:d,event:p}){c||({structure:c}=rp({drawDefinition:r,structureId:s})),s||(s=c?.structureId);const m=!(c?.structures??c?.stage===rd),{byesCount:f,placedByes:h,relevantMatchUps:I}=function({provisionalPositioning:e,drawDefinition:t,matchUpsMap:n,structure:r,event:i}){const{matchUps:a,roundMatchUps:o}=Kp({afterRecoveryTimes:!1,provisionalPositioning:e,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:r,event:i}),s=o?.[1]||[],c=r?.structureType===Id,u=c?a:s,d=c?r?.structures?.length||0:a.length,{structureId:p,stage:l,stageSequence:m}=r,f=Op({entryStatuses:bp,provisionalPositioning:e,drawDefinition:t,stageSequence:m,structureId:p,stage:l}),{qualifiersCount:h}=gw({provisionalPositioning:e,drawDefinition:t,stageSequence:m,structureId:p,stage:l}),I=f.length+h,{positionAssignments:g,unassignedPositions:U}=sp({structure:r}),y=U?.map((e=>e.drawPosition)),v=g?.filter((e=>e.bye)).length,S=g?.filter((e=>e.bye)).map((e=>e.drawPosition)),w=u.map((e=>e.drawPositions)).filter((e=>e?.reduce(((e,t)=>!S?.includes(t)&&e),!0))).flat(1/0).filter((e=>y?.includes(e))),P=g?.length;let T=P?P-I:0;return T>d&&1===r.stageSequence&&r.stage!==id&&(T=d),{placedByes:v,byesCount:T,relevantMatchUps:u,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:w}}({provisionalPositioning:e,drawDefinition:r,matchUpsMap:o,structure:c,event:p}),g=f-(h||0);if(g<=0)return{...L};const{strictSeedOrderByePositions:U,blockSeedOrderByePositions:y,isLuckyStructure:v,isFeedIn:S}=Vw({provisionalPositioning:e,relevantMatchUps:I,appliedPolicies:n,drawDefinition:r,seedingProfile:a,seedBlockInfo:i,byesToPlace:g,structure:c}),w=c?.structureType&&[Id,hd].includes(c.structureType)&&n?.seeding?.containerByesIgnoreSeeding,D=m&&y?.length?y:U;let{unseededByePositions:R}=function({provisionalPositioning:e,seedOrderByePositions:t,isLuckyStructure:n,appliedPolicies:r,drawDefinition:i,seedLimit:a,structure:o,isFeedIn:s}){const c=r?.seeding?.seedingProfile,u=o.stage===rd,{positionAssignments:d}=sp({structure:o}),p=d?.filter((e=>e.participantId)).map((e=>e.drawPosition)),{matchUps:m,roundMatchUps:f}=Kp({provisionalPositioning:e,matchUpFilters:{isCollectionMatchUp:!1},structure:o}),h=f?.[1]||[],I=o.structureType===Id?m:h,g=P([].concat(...I.map((e=>e.drawPositions)))),U=Math.min(...g)-1,y=p?.filter((e=>g.includes(e))),v=e=>{const t=Math.ceil(e.length/2),n=[e.slice(0,t),e.slice(t)],r=n.map((e=>[].concat(...e.flat(1/0)).length)),i=Math.min(...r.flat(1/0)),a=Math.max(...r.flat(1/0)),o=r.indexOf(a),s=i!==a,c=T(n),[u,d]=!i||s?[n[o],n[1-o]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:d}},S=e=>{const{greaterHalf:t,lesserHalf:n}=v(e),{greaterHalf:r,lesserHalf:i}=v(t),a=T(r.flat(1/0)).pop();return{newlyFilteredChunks:[...n,...i,r.flat().filter((e=>e!==a))],drawPosition:a}},w=e=>!y?.includes(e),D=e=>{let t=x(e.sort(l),Math.ceil(e.length/4)).map((e=>e.filter(w)));const n=[].concat(...t.flat(1/0)).length,r=[];for(let i=0;i<n;i++){const{newlyFilteredChunks:e,drawPosition:n}=S(t);r.push(n),t=e}return r},{validSeedBlocks:R}=iU({provisionalPositioning:e,allPositions:!0,appliedPolicies:r,drawDefinition:i,structure:o}),b=R?.map((e=>e.drawPositions?.map((e=>e+U))));let N;if(s){const e=g.length,{seedBlocks:t}=qh({cluster:cU(c)===md,participantsCount:e});N=t.map((e=>e.map((e=>e+U)))).map(D).filter((e=>e.length))}else N=u?b?.map((e=>e.filter(w))):b?.map(D).filter((e=>e.length));const M=I.map((e=>e.drawPositions)).map((e=>e?.sort(((e,t)=>e-t)))).filter((e=>e?.[0]+1===e?.[1])),A=e=>M.reduce(((t,n)=>n.includes(e)?n.reduce(((t,n)=>n!==e?n:t),void 0):t),void 0);let E=N.map((e=>e.map(A))).flat(1/0).filter(w).filter((e=>!t.includes(e))).filter(Boolean);if(u&&!o.structures){const e=a%4,t=E.slice(0,e),n=f[o.roundLimit]?.length,r=x(E.slice(e),n).map(T).flat();E=t.concat(r)}return{unseededByePositions:E}}({provisionalPositioning:e,seedOrderByePositions:D,isLuckyStructure:v,appliedPolicies:n,drawDefinition:r,seedLimit:u,structure:c,isFeedIn:S});let b=[].concat(...D);if(!d)for(;R.length;){const e=R.find((e=>{return t=e,(b||[]).every((e=>e%2?t!==e+1:t!==e-1));var t}));e?(b.push(e),R=R.filter((t=>t!==e))):(b.push(...R),R=[])}w&&(b=T(b),ar({ignoreSeededByes:w})&&console.log({byePositions:b}));const N=b.slice(0,g);for(const l of N){const n=ty({provisionalPositioning:e,tournamentRecord:t,drawDefinition:r,drawPosition:l,matchUpsMap:o,structureId:s,structure:c,event:p});if(n?.error)return n}return{...L,unseededByePositions:R,byeDrawPositions:N}}function qw(e){const t=e.structure??rp(e).structure,n="positionQualifiers",r=[];if(t.stage===id)return Mi({result:{error:_e},stack:n});const{unplacedRoundQualifierCounts:i,positionAssignments:a,roundDrawPositions:o}=function({drawDefinition:e,structure:t,structureId:n}){t||({structure:t}=rp({drawDefinition:e,structureId:n}));n||({structureId:n}=t);const{positionAssignments:r}=sp({structure:t}),{stage:i,stageSequence:a}=t,{qualifiersCount:o,roundQualifiersCounts:s}=gw({drawDefinition:e,stageSequence:a,structureId:n,stage:i}),c=(s?Object.keys(s):[]).map((e=>m(e))),{matchUps:u}=Kp({structure:t}),{roundProfile:d}=ed({matchUps:u}),p=Object.assign({},...c.filter((e=>d?.[e])).map((e=>({[e]:d?.[e]?.drawPositions?.filter(Boolean)??[]})))),l=r?.filter((e=>e.qualifier)).map((e=>e.drawPosition)),f=o-(l?.length??0),h=l?.length,I=Object.assign({},...c.map((e=>{const t=r?.filter((t=>t.qualifier&&p[e]?.drawPositions?.includes(t.drawPosition))).map((e=>e.drawPosition));return{[e]:(s?.[e]??0)-(t?.length??0)}})));return{unplacedRoundQualifierCounts:I,unplacedQualifiersCount:f,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:p,qualifiersCount:o}}(e);for(const s of Object.keys(i)){const e=a?.filter((e=>o[s].includes(e.drawPosition)&&!e.participantId&&!e.qualifier&&!e.bye)).map((e=>e.drawPosition));if(i[s]>(e||0))return Mi({result:{error:rn},context:{unfilledDrawPositions:e},stack:n});E(0,i[s]).forEach((()=>{const t=M(e);r.push(t),a?.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)}))}))}return{...L,qualifierDrawPositions:r}}function $w({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:n,appliedPolicies:r,validSeedBlocks:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:c,groupsCount:u,structureId:d,matchUpsMap:p,structure:l,event:m}){const f=[],h=[];let I=0;if(l||({structure:l}=rp({drawDefinition:a,structureId:d})),d||(d=l?.structureId),r||(r=Xo({drawDefinition:a}).appliedPolicies),!i){const t=l&&iU({provisionalPositioning:e,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:l});t?.error&&h.push(t.error),i=t?.validSeedBlocks}return E(0,u=u??i?.length??0).forEach((()=>{if(I<(u||0)){const r=function({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:r,seedingProfile:i,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:c,event:u}){const{unplacedSeedParticipantIds:d,unfilledPositions:p}=sU({provisionalPositioning:e,randomize:!0,drawDefinition:r,seedingProfile:i,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:l}=Xo({drawDefinition:r}),{avoidance:m}=l??{};const f=[];for(const h of d){const o=p.pop();if(!o)return{error:se};f.push(o);const d=Ty({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:r,seedingProfile:i,participantId:h,seedBlockInfo:a,drawPosition:o,matchUpsMap:c,structureId:s,event:u});if(!d.success)return d}return{...L,seedPositions:f}}({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:c,structureId:d,matchUpsMap:p,event:m});r?.success&&(I++,f.push(...r.seedPositions??[])),r.error&&h.push({seedPositionError:r.error})}})),h.length?{error:h}:{...L,seedPositions:f}}function Ww({applyPositioning:e=!0,provisionalPositioning:t,inContextDrawMatchUps:n,multipleStructures:r,placeByes:i=!0,tournamentRecord:a,appliedPolicies:o,placementGroup:s,drawDefinition:c,seedingProfile:u,participants:d,structureId:p,matchUpsMap:l,seedLimit:m,seedsOnly:f,drawType:h,drawSize:I,event:g}){const U=[];e||(ir.disableNotifications(),c=ii(c,!1,!0));const y=t=>(e||sr(),Mi({result:t,stack:"automatedPositioning"})),v=rp({drawDefinition:c,structureId:p});if(v.error)return y(v);const S=v.structure;if(!S)return{error:De};o||(o=Xo({drawDefinition:c,structure:S,event:g})?.appliedPolicies);const{qualifiersCount:w}=gw({stageSequence:S.stageSequence,provisionalPositioning:t,stage:S.stage,drawDefinition:c,structureId:p}),P=Rp,T=Op({stageSequence:S.stageSequence,provisionalPositioning:t,stage:S.stage,placementGroup:s,drawDefinition:c,entryStatuses:P,structureId:p});if(!T?.length&&!w)return D={...L},e||sr(),D;var D;l=l??_p({drawDefinition:c}),n||({matchUps:n}=Cl({inContext:!0,drawDefinition:c,matchUpsMap:l}));let R=[];const b=iU({provisionalPositioning:t,appliedPolicies:o,drawDefinition:c,seedingProfile:u,structure:S});if(b.error)return b;const{validSeedBlocks:N}=b;if(U.push({validSeedBlocks:N}),cU(S.seedingProfile||u)===fd){let e=i?Gw({provisionalPositioning:t,tournamentRecord:a,appliedPolicies:o,drawDefinition:c,seedBlockInfo:b,matchUpsMap:l,structure:S,seedLimit:m,seedsOnly:f,event:g}):void 0;if(e?.error)return y(e);R=e.unseededByePositions,U.push({action:"positionByes",unseededByePositions:R});if(e=$w({seedingProfile:S.seedingProfile?{positioning:S.seedingProfile}:u,provisionalPositioning:t,inContextDrawMatchUps:n,tournamentRecord:a,appliedPolicies:o,validSeedBlocks:N,drawDefinition:c,seedBlockInfo:b,participants:d,matchUpsMap:l,structure:S,event:g}),e.error)return y(e);U.push({seedPositions:e.seedPositions,action:"positionSeedBlocks"})}else{if(h!==Od){const e=$w({seedingProfile:S.seedingProfile?{positioning:S.seedingProfile}:u,provisionalPositioning:t,inContextDrawMatchUps:n,tournamentRecord:a,appliedPolicies:o,validSeedBlocks:N,drawDefinition:c,seedBlockInfo:b,participants:d,matchUpsMap:l,structure:S,event:g});if(e.error)return y(e);U.push({action:"positionSeedBlocks",seedPositions:e.seedPositions})}const e=i?Gw({provisionalPositioning:t,tournamentRecord:a,appliedPolicies:o,drawDefinition:c,seedBlockInfo:b,matchUpsMap:l,structure:S,seedLimit:m,seedsOnly:f,event:g}):void 0;if(e?.error)return y(e);R=e?.unseededByePositions,U.push({action:"positionByes",byeDrawPositions:e?.byeDrawPositions,unseededByePositions:R})}const M={};if(!f){let e=qw({inContextDrawMatchUps:n,tournamentRecord:a,appliedPolicies:o,validSeedBlocks:N,drawDefinition:c,seedBlockInfo:b,participants:d,matchUpsMap:l,structure:S});if(e.error)return y(e);if(e.conflicts&&(M.qualifierConflicts=e.conflicts),U.push({action:"positionQualifiers",qualifierDrawPositions:e.qualifierDrawPositions}),e=xw({provisionalPositioning:t,inContextDrawMatchUps:n,unseededByePositions:R,multipleStructures:r,tournamentRecord:a,drawDefinition:c,seedBlockInfo:b,participants:d,matchUpsMap:l,structureId:p,structure:S,drawSize:I,event:g}),e.error)return y(e);e.conflicts&&(M.unseededConflicts=e.conflicts),U.push({action:"positionUnseededParticipants"})}const{positionAssignments:A}=op({drawDefinition:c,structure:S});return al({drawDefinition:c,structureIds:[p]}),e||sr(),{positionAssignments:A,conflicts:M,...L,positioningReport:U}}function Hw(e){const{applyPositioning:t=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:i,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:c,event:u}=e;if(!u)return{error:Ee};if(!i)return{error:Q};if(!_I({drawDefinition:i,structureId:o})&&!n)return{error:X};const d=kI({drawDefinition:i,structureId:o}).playoffStructures?.sort(((e,t)=>np(e)-np(t))),p=[],l=r?.participants,m=[];if(d)for(const f of d){const{structureId:e}=f,r=Ww({structureId:e,provisionalPositioning:n,applyPositioning:t,drawDefinition:i,seedingProfile:a,participants:l,placeByes:s,seedsOnly:c});if(r.error)return r;r.positionAssignments&&p.push({positionAssignments:r.positionAssignments,structureId:e}),r.positioningReport&&m.push(r.positioningReport)}return{...L,structurePositionAssignments:p,positioningReports:m}}function zw(e){const t="genPlayoffStructure";if(!e.drawDefinition)return Mi({result:{error:Y},stack:t});const n=fh(e);if(n.error)return Mi({result:n,stack:t});const{structureId:r,addNameBaseToAttributeName:i,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:c,playoffPositions:u,roundOffsetLimit:d,tournamentRecord:p,exitProfileLimit:l,roundProfiles:f,roundNumbers:h,idPrefix:I,isMock:g,event:U,uuids:y}=e,v=ii(e.drawDefinition,!1,!0),{structure:S}=rp({structureId:r,drawDefinition:v});if(!S)return Mi({result:{error:De},stack:t});if(S.structureType===Id||S.structures)return function(e){const t="generateAndPopulateRRplayoffStructures";if(!e.playoffGroups)return Mi({result:{error:mt},info:"playoffGroups required",stack:t});const{sourceStructureId:n,requireSequential:r,drawDefinition:i,playoffGroups:a,groupCount:o,groupSize:s,event:c}=e,{structures:u=[],links:d=[],finishingPositionTargets:p,positionRangeMap:l,error:m}=pw({requireSequential:r,sourceStructureId:n,playoffGroups:a,groupCount:o,groupSize:s,...e});if(m)return{error:m};const f=p?.map((({finishingPositions:e})=>e)).flat().map((e=>l[e].finishingPositions)).flat();i.structures.push(...u),i.links.push(...d);const{matchUps:h,matchUpsMap:I}=Cl({inContext:!0,drawDefinition:i}),g=u.map((({structureId:e})=>e)),U=h?.filter((({structureId:e})=>g.includes(e))).map(Pl),y=I?.drawMatchUps?.filter((({matchUpId:e})=>U?.includes(e)));if(y?.length){const t=Ni({drawDefinition:i,event:c})?.tieFormat;t&&y.forEach((n=>{const{tieMatchUps:r}=Yy({isMock:e.isMock,tieFormat:t});Object.assign(n,{tieMatchUps:r,matchUpType:Vi})}))}const{positionAssignments:v}=op({structureId:n,drawDefinition:i}),S={};v?.forEach((e=>{const t=lc({element:e,name:Yo}),n=t?.extension?.value,r=n?.groupOrder;r&&(S[r]||(S[r]=[]),S[r].push(e.participantId))}));const w=Hw({provisionalPositioning:e.provisionalPositioning,structureId:n,applyPositioning:!0,event:e.event,drawDefinition:i});return w.error&&w.error?.code!==X.code?Mi({result:w,stack:t}):{structures:u,links:d,positionsPlayedOff:f,drawDefinition:i,...L}}({sourceStructureId:S.structureId,...e,...n,drawDefinition:v});const{playoffRoundsRanges:w,playoffRounds:P}=n,{playoffPositionsReturned:T,error:D,playoffSourceRounds:R,playoffRoundsRanges:b}=mh(e);if(D)return Mi({result:{error:D},stack:t});const N=f?.length&&Object.assign({},...f),M=h||"object"==typeof f&&f.map((e=>Object.keys(e))).flat(),A=Array.isArray(M)&&M.map((e=>!isNaN(e)&&m(e))).filter(Boolean);if(A){if(!Array.isArray(A))return Mi({result:{error:xn},context:{validRoundNumbers:A},stack:t});A.forEach((e=>{if(!P?.includes(e))return Mi({result:{error:xn},context:{roundNumber:e},stack:t})}))}u&&u.forEach((e=>{if(!T?.includes(e))return Mi({result:{error:xn},context:{playoffPosition:e},stack:t})}));const E=A||R,C=A?w:b,O=[],F=[];for(const m of E??[]){const e=C?.find((e=>e.roundNumber===m));if(!e)return Mi({result:{error:xn},context:{roundNumber:m},stack:t});const n=e.finishingPositions.length,u=Math.min(...e.finishingPositions)-1,p=2,f=m&&N?.[m]&&p+N[m]-1,h=uw({exitProfile:`0-${m}`,addNameBaseToAttributeName:i,playoffStructureNameBase:a,finishingPositionOffset:u,playoffAttributes:c,exitProfileLimit:l,stage:od,roundOffset:0,drawDefinition:v,sequenceLimit:f,stageSequence:p,drawSize:n,idPrefix:I,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:d});if(h.error)return Mi({result:h,stack:t});const{structures:U,links:S}=h;if(U?.length&&O.push(...U),S?.length&&F.push(...S),h.structureId&&m){const e={linkType:Hi.Loser,source:{structureId:r,roundNumber:m},target:{structureId:h.structureId,feedProfile:zi.TopDown,roundNumber:1}};F.push(e)}}if(!O.length)return Mi({result:{error:xn},info:"No structures generated",stack:t});v.structures.push(...O),v.links.push(...F);const{matchUps:k,matchUpsMap:x}=Cl({inContext:!0,drawDefinition:v}),_=O.map((({structureId:e})=>e)),B=k?.filter((({structureId:e})=>_.includes(e))).map(Pl),V=x?.drawMatchUps?.filter((({matchUpId:e})=>B?.includes(e)));if(V?.length){const e=Ni({drawDefinition:v,event:U})?.tieFormat;e&&V.forEach((t=>{const{tieMatchUps:n}=Yy({tieFormat:e,isMock:g});Object.assign(t,{tieMatchUps:n,matchUpType:ji})}))}const j=k?.filter((e=>xa({matchUp:e})&&e.structureId===r));j?.forEach((e=>{const{matchUpId:t,score:n,winningSide:r}=e,i=bl({inContextDrawMatchUps:k,drawDefinition:v,matchUpId:t}),a=Dy({inContextDrawMatchUps:k,tournamentRecord:p,drawDefinition:v,matchUpsMap:x,winningSide:r,targetData:i,matchUpId:t,structure:S,matchUp:e,score:n,event:U});a.error&&console.log(a.error)}));const G=k?.filter((e=>e.matchUpStatus===ma&&e.structureId===r));G?.forEach((e=>{const{matchUpId:t}=e,n=bl({inContextDrawMatchUps:k,drawDefinition:v,matchUpId:t}),{targetLinks:{loserTargetLink:r},targetMatchUps:{loserMatchUpDrawPositionIndex:i,loserMatchUp:a}}=n;if(r&&a){const e=r.target.structureId,t=ty({drawPosition:a.drawPositions[i],structureId:e,tournamentRecord:p,drawDefinition:v,event:U});t.error&&console.log(t.error)}}));const q=[],$=wh({inContextDrawMatchUps:k,drawDefinition:v,matchUpsMap:x}).goesToMap,{structure:W}=rp({drawDefinition:e.drawDefinition,structureId:r}),{matchUps:H}=Kp({structure:W});return H.forEach((n=>{const r=$?.loserMatchUpIds[n.matchUpId];if(r&&n.loserMatchUpId!==r){n.loserMatchUpId=r;const i={tournamentId:p?.tournamentId,eventId:e.event?.eventId,context:t,matchUp:n};q.push(i)}const i=$?.winnerMatchUpIds[n.matchUpId];if(i&&n.winnerMatchUpId!==i){n.winnerMatchUpId=i;const r={tournamentId:p?.tournamentId,eventId:e.event?.eventId,context:t,matchUp:n};q.push(r)}})),{structures:O,matchUpModifications:q,links:F,drawDefinition:v,...L}}function Yw({drawDefinition:e,drawSize:t}){if(!e)return{error:Y};const n=yw({stage:ad,stageSequence:1,drawDefinition:e,drawSize:t});return n.error?n:(al({drawDefinition:e}),{...L})}function Kw(e){const{drawType:t=Md,attachConsolation:n=!0,applyPositioning:r=!0,tournamentRecord:i,staggeredEntry:a,automated:o,placeByes:s,isMock:c,event:u}=e;let d=e?.drawDefinition;if(!d)return{error:Y};const p=i?Kg({withIndividualParticipants:!0,tournamentRecord:i})?.participants:[],l=ad,m=Op({stageSequence:1,drawDefinition:d,stage:l}),f=[Wd,Ad,Hd].includes(t)?m.length:y(m.length);if(!a&&t===Rd&&m.length<2||t===Wd&&m.length<3)return{error:ue};let{tieFormat:h,matchUpType:I}=e;if(h){const t=e.event?.eventType,n=ca({tieFormat:h,eventType:t});if(n.error)return n}h=ul(h??Ni({drawDefinition:d})?.tieFormat),I=I??d.matchUpType??Yi.Singles;const{structures:g}=ip({stageSequence:1,drawDefinition:d,stage:l});if(g.length>1)return{error:Le};if(g?.[0]?.matchUps?.length)return{error:Kn};const U=g?.[0]?.structureId;Object.assign(e,pi({structureName:e.structureName??kh(ad),structureId:U,matchUpType:I,tieFormat:h,drawSize:f,stage:l}));const v=hw(e);if(v.error)return v;const S=v.generators[t];if(!S)return{error:re};const w=S?.();if(w.error)return w;const{structures:P,links:T}=w,D=P.map((e=>Kp({structure:e}).matchUps)).flat();h&&D.forEach((e=>{const{tieMatchUps:t}=Yy({tieFormat:h,isMock:c});Object.assign(e,{tieMatchUps:t,matchUpType:I})})),r&&n||(d=ii(d,!1,!0)),d.links||(d.links=[]),T.length&&d.links.push(...T);const R=P.map((({structureId:e})=>e));d.structures||(d.structures=[]);const b=d.structures.map((({structureId:e})=>e));d.structures=d.structures.map((e=>R.includes(e.structureId)?P.find((({structureId:t})=>t===e.structureId)):e));const N=P.filter((({structureId:e})=>!b.includes(e)));return N.length&&d.structures.push(...N),o&&Ww({seedingProfile:e.seedingProfile,applyPositioning:r,tournamentRecord:i,drawDefinition:d,participants:p,structureId:U,placeByes:s,drawSize:f,event:u}),n&&al({drawDefinition:d}),{links:T,structures:P,...L}}function Qw(e){const t="generateQualifyingStructure";if(!e.drawDefinition)return Mi({result:{error:Y},stack:t});if(e.drawSize&&!S(e.drawSize)||e.participantsCount&&!S(e.participantsCount)||e.qualifyingPositions&&!S(e.qualifyingPositions))return Mi({result:{error:xn},stack:t});let n=e.drawSize??I(e.participantsCount);const{qualifyingRoundNumber:r,qualifyingPositions:i,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:c,matchUpFormat:u,structureName:d,structureId:p,roundTarget:l,drawType:m,idPrefix:f,isMock:h,uuids:g}=e;if(!e.drawSize)return Mi({result:{error:pe},context:{drawSize:n},stack:t});if(i&&i>=e.drawSize)return Mi({result:{error:xn},context:{drawSize:n,qualifyingPositions:i},stack:t});let U,y,v,w,P,T=0;const{structureProfiles:D}=lU({drawDefinition:c}),R=D[a];if(!R)return Mi({result:{error:De},context:{targetStructureId:a},stack:t});const b=c.matchUpType,N=l?`${l}-`:"",M=R.stage===rd,A=s?.[fo]?.namingConventions?.pre??zp[fo]?.namingConventions?.pre,E=M&&A?`${A}-`:"",C=d??(N?`${E}${kh(rd)} ${N}`:`${E}${kh(rd)}`);if(m===Wd){const{maxRoundNumber:e,structures:t,groupCount:r}=jh({structureName:d??C,structureId:p??g?.pop(),stage:rd,structureOptions:o,appliedPolicies:s,stageSequence:1,matchUpType:b,roundTarget:l,idPrefix:f,drawSize:n,isMock:h,uuids:g});T=r,U=e,v=t[0],P=[1]}else({drawSize:n,matchUps:w,roundLimit:U,roundsCount:y}=nw({qualifyingRoundNumber:r,qualifyingPositions:i,matchUpType:b,idPrefix:f,drawSize:n,isMock:h,uuids:g})),U||(U=y),v=xh({structureName:d??C,structureId:p??g?.pop(),qualifyingRoundNumber:U,stage:rd,matchUpFormat:u,stageSequence:1,matchUpType:b,roundLimit:U,matchUps:w}),l&&Js({element:v,extension:{name:qo,value:l}}),T=w?.filter((e=>e.roundNumber===U))?.length;const O=m===Wd?Hi.Position:Hi.Winner,F=v&&U&&ZS({sourceStructureId:v.structureId,sourceRoundNumber:U,targetStructureId:a,finishingPositions:P,linkType:O})?.link;return{qualifyingDrawPositionsCount:n,qualifiersCount:T,...L,structure:v,link:F}}function Jw({drawDefinition:e}){const{maxQualifyingDepth:t,structureProfiles:n}=lU({drawDefinition:e});for(const r of e.structures){const e=n[r.structureId];e.distanceFromMain&&(r.stageSequence=t+1-e.distanceFromMain)}return{...L}}function Xw({drawDefinition:e,tournamentId:t,structure:n,eventId:r,link:i}){if(!e)return{error:Y};if(!n)return{error:be};if(!i)return{error:we};const a=i.target.structureId,o=rp({drawDefinition:e,structureId:a});if(o.error)return Mi({stack:"attachQualifyingStructure",context:{targetStructureId:a},result:o});e.structures||(e.structures=[]),e.links||(e.links=[]),e.structures.push(n),e.links.push(i),Jw({drawDefinition:e});return tl({drawDefinition:e,tournamentId:t,matchUps:Kp({structure:n})?.matchUps||[],eventId:r}),al({drawDefinition:e,structureIds:[n.structureId]}),{...L}}function Zw(e){return e.matchUpStatus===ma?e.sides.reduce(((e,t)=>t.participantId||e),void 0):e.winningSide?e.sides.reduce(((t,n)=>n.sideNumber===e.winningSide?n.participantId:t),void 0):void 0}function eP(e){if(!e.drawDefinition)return{error:Y};if(!e.targetStructureId)return{error:Te};const t=Qw(e);if(t.error)return t;const{structure:n,link:r}=t;return n&&r?Xw({tournamentId:e.tournamentRecord?.tournamentId,eventId:e.event?.eventId||e.eventId,drawDefinition:e.drawDefinition,structure:n,link:r}):{error:xn}}function tP(e){return nP(e)}function nP({matchUpModifications:e,tournamentRecord:t,drawDefinition:n,structures:r,links:i=[],event:a}){const o="attachStructures";if(!n)return{error:Y};if(!Array.isArray(r)||!Array.isArray(i))return Mi({result:{error:xn},stack:o});const s=e=>[e.source.structureId,e.source.roundNumber||e.source.finishingPositions?.join("|"),e.target.roundNumber].join("|"),c=n.links?.map(s);if(i.some((e=>{const t=s(e);return c?.includes(t)})))return Mi({result:{error:Kn},info:"playoff structure exists",stack:o});i.length&&n.links?.push(...i);const u=r.map((({structureId:e})=>e)),d=n.structures?.map((({structureId:e})=>e));n.structures=(n.structures||[]).map((e=>u.includes(e.structureId)?r.find((({structureId:t})=>t===e.structureId)):e));const p=r?.filter((({structureId:e})=>!d?.includes(e)));p.length&&n.structures.push(...p),wh({drawDefinition:n});const l=r.map((e=>Kp({structure:e})?.matchUps||[])).flat();tl({tournamentId:t?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUps:l});if(al({drawDefinition:n,structureIds:r.map((({structureId:e})=>e))}),e?.length){const t={};e.forEach((e=>{const n=e.matchUp?.matchUpId;n&&(t[n]=e)}));const r=e=>{e.matchUps.forEach((e=>{if(t[e.matchUpId]){const{tieMatchUps:n,...r}=t[e.matchUpId].matchUp;if(Object.assign(e,r),n?.length){const r={};n.forEach((e=>t[e.matchUpId]=e)),e.tieMatchUps.forEach((e=>Object.assign(e,r[e.matchUpId])))}t[e.matchUpId].matchUp=e,rl(t[e.matchUpId])}}))};n.structures.forEach((e=>{if(d?.includes(e.structureId))if(e.structures)for(const t of e.structures)r(t);else r(e)}))}const m=p.map(di("structureId"));return{...L,addedStructureIds:m}}function rP(e){const{structures:t,links:n,matchUpModifications:r,error:i}=zw(e);if(i)return{error:i};const a=e.drawDefinition;return tP({tournamentId:e.tournamentRecord?.tournamentId,eventId:e.event?.eventId||e.eventId,matchUpModifications:r,drawDefinition:a,structures:t,links:n})}function iP({tournamentRecord:e,matchUpIds:t=[],drawDefinition:n,structureId:r,event:i}){if("object"!=typeof n)return{error:Y};if("string"!=typeof r)return{error:Te};if(!Array.isArray(t))return{error:xn};const a=n.structures?.find((e=>e.structureId===r));if(!a)return{error:De};const o=a?.matchUps,s=o?.find((e=>!!e.roundPosition));if(a.structures||s||a.finishingPosition===Xd)return{error:J};const c=[],u=o?.filter((({matchUpId:e,score:n})=>(dl({score:n})&&c.push(e),t.includes(e))))??[],d=u.map(di("matchUpId"));if(d.length){a.matchUps=(a.matchUps??[]).filter((({matchUpId:e})=>!d.includes(e))),nl({tournamentId:e?.tournamentId,matchUpIds:d,action:"deleteAdHocMatchUps",eventId:i?.eventId,drawDefinition:n});const t=function(e,t=1){return Array.isArray(e)&&e.every(S)?E(Math.min(...e,t),Math.max(...e)+1).filter((t=>!e.includes(t))):[]}(P(a.matchUps.map(di("roundNumber"))));if(t.length){t.reverse();for(const r of t)a.matchUps.forEach((t=>{t.roundNumber&&t.roundNumber>r&&(t.roundNumber-=1,rl({tournamentId:e?.tournamentId,context:["adHoc round deletion"],eventId:i?.eventId,drawDefinition:n,matchUp:t}))}))}if(c.length){a.positionAssignments=P(a.matchUps.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})));const t=a?.matchUpFormat??n?.matchUpFormat??i?.matchUpFormat,r=Il({positionAssignments:a.positionAssignments,matchUps:a.matchUps,tournamentRecord:e,drawDefinition:n,matchUpFormat:t,event:i});r.error&&console.log(r)}al({structureIds:[r],eventId:i?.eventId,drawDefinition:n})}return{...L}}function aP({drawDefinition:e,orderMap:t}){return e?("object"==typeof t&&Object.values(t).every((e=>S(e)))||Mi({result:{error:xn},context:{orderMap:t}}),e.structures||(e.structures=[]),e.structures.forEach((e=>{const n=t[e.structureId];n&&(e.structureOrder=n)})),e.structures.sort(((e,t)=>D(e.structureOrder)-D(t.structureOrder))),{...L}):{error:Y}}function oP({drawDefinition:e,structureDetails:t}){if(!ci(t))return{error:xn};if(!e)return{error:Y};const n=Object.assign({},...t.map((e=>{if(!ci(e))return;const{structureId:t,structureName:n}=e||{};return t&&n?{[t]:n}:void 0})).filter(Boolean));if(!Object.values(n).length)return{error:mt};let r=0;for(const i of e.structures||[]){const e=n[i.structureId];e&&(i.structureName=e,r+=1)}return{...L,modificationsApplied:r}}function sP({tournamentRecord:e,drawDefinition:t,structureId:n,event:r,force:i}){if("string"!=typeof n)return{error:xn};if(!t)return{error:Y};if(!n)return{error:Te};const a=t.structures||[],o=[],s=a.find((e=>e.structureId===n));if(!s)return{error:De};if(Kp({structure:s}).matchUps.some((({score:e})=>dl({score:e})))){const n=Xo({tournamentRecord:e,drawDefinition:t,structure:s,event:r})?.appliedPolicies;if(!(i||n?.[vo]?.allowDeletionWithScoresPresent?.structures))return{error:Xn}}const c=a.find((({stage:e,stageSequence:t})=>e===nd&&1===t)),u=n===c?.structureId,d=a.filter((({stage:e})=>e===rd)).map(di("structureId"));if(u&&!d.length)return{error:j};const p=a.map(di("structureId")),l=[],m=d.includes(n),f=new Map;p.forEach((e=>{return f.set(e,m?(n=e,t.links?.map((e=>d.includes(e.source.structureId)&&e.target.structureId===n&&e.source.structureId)).filter(Boolean)??[]):(e=>t.links?.map((t=>t.source.structureId===e&&t.target.structureId!==c?.structureId&&t.target.structureId)).filter(Boolean)??[])(e));var n}));const h=u?f.get(n):[n];for(;h?.length;){const e=h.pop(),{structure:r}=rp({structureId:e,drawDefinition:t}),{matchUps:i}=Kp({structure:r}),a=yl(i);l.push(...a),t.links=t.links?.filter((t=>t.source.structureId!==e&&t.target.structureId!==e))||[],(!u||u&&d.length||e!==n)&&(t.structures=(t.structures??[]).filter((t=>(e&&e===t.structureId&&o.push(e),t.structureId!==e))));const s=e&&f.get(e)?.filter((e=>e!==c?.structureId||n===c.structureId));s?.length&&h.push(...s)}const{matchUps:I}=Cl({drawDefinition:t});if(I?.forEach((e=>{e.winnerMatchUpId&&l.includes(e.winnerMatchUpId)&&delete e.winnerMatchUpId,e.loserMatchUpId&&l.includes(e.loserMatchUpId)&&delete e.loserMatchUpId})),u){const e=(c.matchUps??[])?.map(di("matchUpId"));l.push(...e),c.positionAssignments=[],c.seedAssignments=[],c.matchUps=[],c.extensions&&(c.extensions=[])}return m&&Jw({drawDefinition:t}),nl({tournamentId:e?.tournamentId,matchUpIds:l,action:"removeStructure",eventId:r?.eventId,drawDefinition:t}),al({drawDefinition:t,eventId:r?.eventId}),{...L,removedMatchUpIds:l,removedStructureIds:o}}function cP({participantIdPairings:e,addToStructure:t=!0,tournamentRecord:n,matchUpIds:r=[],drawDefinition:i,matchUpsCount:a,roundNumber:o,structureId:s,newRound:c}){if("object"!=typeof i)return{error:Y};if(s||1!==i.structures?.length||(s=i.structures?.[0]?.structureId),"string"!=typeof s)return{error:Te};const u=i.structures?.find((e=>e.structureId===s));if(!u)return{error:De};let d;const p=u.matchUps??[],l=p?.reduce(((e,t)=>(t.roundPosition&&(d=!0),(t?.roundNumber||0)>e?t.roundNumber:e)),0);if(!a){const e=i?.entries?.filter((e=>{const t=e.entryStatus;return bp.includes(t)}))??[],t=Math.floor(e?.length/2)||1;if(c)a=t;else{const e=o||l||1,n=t-(u.matchUps?.filter((t=>t.roundNumber===e))?.length||0);n>0&&(a=n)}}if(e&&!Array.isArray(e)||a&&!S(a)||r&&!Array.isArray(r)||!e&&!a)return{error:xn,info:"matchUpsCount or pairings error"};if(u.structures||d||u.finishingPosition===Xd)return{error:J};if(o&&o-1>(l||0))return{error:xn,info:"roundNumber error"};const m=o??(c&&(l??0)+1||l||1);e=e??E(0,a).map((()=>({participantIds:[void 0,void 0]})));const f=e?.map((e=>{const t=e?.participantIds??[void 0,void 0];t.push(void 0,void 0);const n=t.slice(0,2).map(((e,t)=>pi({sideNumber:t+1,participantId:e})));return{matchUpStatus:Ki.ToBePlayed,matchUpId:r.pop()??Ii(),roundNumber:m,sides:n}}));if(t){const e=uP({tournamentRecord:n,drawDefinition:i,structureId:s,matchUps:f});if(e.error)return e}return{matchUpsCount:f.length,matchUps:f,...L}}function uP({tournamentRecord:e,drawDefinition:t,structureId:n,matchUps:r}){if("object"!=typeof t)return{error:Y};if(n||1!==t.structures?.length||(n=t.structures?.[0]?.structureId),"string"!=typeof n)return{error:Te};if(!La(r))return{error:xn,info:sa("matchUps")};const i=t.structures?.find((e=>e.structureId===n));if(!i)return{error:De};const a=i?.matchUps,o=a.find((e=>!!e.roundPosition));if(i.structures||o||i.finishingPosition===Xd)return{error:J};return k(rh({tournamentRecord:e,inContext:!1})?.matchUps?.map(Pl)??[],r.map(Pl))?{error:zn,info:"One or more matchUpIds already present in tournamentRecord"}:(i.matchUps.push(...r),tl({tournamentId:e?.tournamentId,drawDefinition:t,matchUps:r}),al({drawDefinition:t,structureIds:[n]}),{...L})}const dP={generateAndPopulatePlayoffStructures:zw,attachPlayoffStructures:tP,addPlayoffStructures:rP,setStructureOrder:aP,renameStructures:oP,generateQualifyingStructure:Qw,attachQualifyingStructure:Xw,addQualifyingStructure:eP,getAvailablePlayoffRounds:fh,getAvailablePlayoffProfiles:fh,getSourceRounds:mh,getDrawStructures:ip,getPositionsPlayedOff:lh,getQualifiersCount:gw,removeStructure:sP,generateAdHocMatchUps:cP,deleteAdHocMatchUps:iP,addAdHocMatchUps:uP,addVoluntaryConsolationStage:Yw,addVoluntaryConsolationStructure:XS,generateVoluntaryConsolation:Kw,buildDrawHierarchy:function({matchUps:e,matchUpType:t}){if(!e)return{error:Ze};let n=[],r=[],i=0;t&&(e=e.filter((e=>e.matchUpType===t)));const a=P(e.map((({matchUpType:e})=>e)));if(a.length>1)if(a.includes(ji))e=e.filter((e=>e.matchUpType===ji));else if(a.includes(_i))e=e.filter((e=>e.matchUpType===_i));else{if(!a.includes(Bi))return{};e=e.filter((e=>e.matchUpType===Bi))}if(!La(e)||!e.length)return{};const o=(e,t)=>m(e)-m(t),s=P(e.map((e=>e.drawPositions)).flat().filter(Boolean)).sort(o),c=E(1,Math.max(...s)+1).filter((e=>!s.includes(e))).sort(o),{roundMatchUps:u}=ed({matchUps:e}),d=u?.[1],p=u?.[2]||[],l=d?.[0]||{},f=l.drawId,h=l.structureId,I=u?Object.keys(u).map((e=>m(e))):[],g=Math.max(...I),U=u?.[g]?.length||0,y=Math.ceil(Math.log(U)/Math.log(2)),v=E(1,y+1).map((e=>{const t=Math.pow(2,e-1),n=g+y-e+1;return E(1,t+1).map((t=>({drawId:f,structureId:h,matchUpId:Ii(),drawPositions:[],sides:[],roundNumber:n,roundPosition:t,finishingRound:e})))}));y&&(e=e.concat(...v.flat()));const S=d?.map((e=>e.drawPositions)),w=S.flat(1/0),T=p.map((e=>e.drawPositions)).flat(1/0).filter((e=>!w.includes(e))).sort(o),D=p.filter((e=>e.drawPositions?.reduce(((e,t)=>T.includes(t)||e),void 0))).map((e=>{const t=e.drawPositions?.reduce(((e,t)=>T.includes(t)?t:e),void 0),n=e.drawPositions?.indexOf(t);return{[t]:e.sides[n]}}));if(c?.length&&T?.length===c?.length){const t=T.map(((e,t)=>[e,c[t]].sort(o))),n=Object.assign({},...D),i=ii(d?.[0].finishingRound,!1,!0),a=ii(d?.[0].finishingPositionRange,!1,!0);r=t.map(((e,t)=>{const r=Math.max(...e||[])/2,o=e?.map((e=>n[e]||{bye:!0,drawPosition:e}));return{sides:o,drawId:f,structureId:h,roundPosition:r,drawPositions:e,roundNumber:1,finishingRound:i,matchUpId:Ii(),matchUpStatus:"BYE",sideNumber:t+1,finishingPositionRange:a}})),e=e.concat(...r)}const R=g+y;return E(1,R+1).forEach((t=>{const r=[],a=b({matchUps:e,roundNumber:t}),o=b({matchUps:e,roundNumber:t-1}).map(Zw).filter(Boolean),s=a?.length===n?.length,c=a?.length===n?.length/2;1===t&&a.forEach((e=>{const t=e.drawPositions||[],{matchUpId:n,structureId:i}=e,a=[{...e.sides[0],drawPosition:t[0],matchUpId:n,structureId:i},{...e.sides[1],drawPosition:t[1],matchUpId:n,structureId:i}],o={...e,children:a};r.push(o)})),s?(i++,a.forEach(((e,t)=>{const a=e.drawPositions||[],{matchUpId:s,structureId:c}=e,u=a.filter(Boolean).reduce(((e,t)=>w.includes(t)?e:t),void 0),d=[{...e.sides.filter(Boolean).reduce(((e,t)=>t.participantId&&!o.includes(t.participantId)?t:e),void 0),drawPosition:u,feedRoundNumber:i,sides:e.sides,matchUpId:s,structureId:c},n[t]],p={...e,children:d};r.push(p)}))):c&&a.forEach(((e,t)=>{const i={...e,children:[n[2*t],n[2*t+1]]};r.push(i)})),n=r})),{hierarchy:n[0],missingMatchUps:r,maxRound:g,finalRound:R,matchUps:e};function b({matchUps:e,roundNumber:t}){return e.filter((e=>e.roundNumber===t)).sort(((e,t)=>e.roundPosition-t.roundPosition))}},generateDrawTypeAndModifyDrawDefinition:Sw,generateDrawStructuresAndLinks:Iw};function pP({requireParticipantCount:e=!0,enforcePolicyLimits:t=!0,drawSizeProgression:n,participantsCount:r,participantCount:i,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:c,seedsCount:u}){r=r??i;const d=rp({drawDefinition:o,structureId:c});if(d.error)return d;const p=d.structure;if(!p)return{error:De};const{positionAssignments:l}=sp({structure:p}),m=l?.length||0;if(u>m)return{error:he};const f=p.structures?.length,h=S(s?.groupSeedingThreshold)&&s.groupSeedingThreshold,I=$h({roundRobinGroupsCount:f,drawSize:m})?.seedGroups,{seedsCount:g}=Eg({policyDefinitions:a,requireParticipantCount:e,drawSizeProgression:n,participantsCount:r,drawSize:m});return g&&a?.[So]&&u>g&&t&&(u=g),p.seedLimit=u,p.seedAssignments=E(1,u+1).map((e=>{const t=I?.find((t=>t.includes(e))),n=t&&Math.min(...t);return{participantId:void 0,seedNumber:e,seedValue:h&&e>=h?n:e}})),al({drawDefinition:o,structureIds:[c]}),{...L,seedLimit:u}}function lP({participantPreferences:e,drawPositionResolutions:t={}}){const n=Object.keys(e).reduce(((t,n)=>{const r=e[n].preferences[0];return r&&(t[r]||(t[r]=[]),t[r].push(n)),t}),{}),r=Math.min(...Object.values(n).filter((e=>e.length)).map((e=>e.length))),i=Object.keys(n).filter((e=>n[e].length&&r&&n[e].length===r));let a;return i.forEach((r=>{const i=M(n[r]);t[r]=i,delete e[i]})),Object.values(e).forEach((e=>{e.preferences=e.preferences.filter((e=>{const t=!i.includes(e.toString());return t&&(a=!0),t}))})),{drawPositionResolutions:t,remainingPreferences:a,participantPreferences:e}}function mP({drawPositions:e,structure:t}){if([rd,nd].includes(t.stage)&&1===t.stageSequence)return;const{positionAssignments:n}=op({structure:t}),r=n?.filter((({drawPosition:t})=>e?.includes(t)));r?.forEach((e=>{Js({element:e,extension:{name:Eo,value:!0}})}))}function fP(e){const{participantIdAttributeName:t="participantId",isQualifierPosition:n,positionActionName:r,tournamentRecord:i,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,event:u}=e,d="positionParticipantAction";if(!a)return{error:Y};let{inContextDrawMatchUps:p,matchUpsMap:l}=e;l||(l=_p({drawDefinition:a}),Object.assign(e,{matchUpsMap:l})),p||(({matchUps:p}=Cl({inContext:!0,drawDefinition:a,matchUpsMap:l})),Object.assign(e,{inContextDrawMatchUps:p}));const{positionAssignments:m}=op({drawDefinition:a,structureId:c}),f=m?.find((e=>e.drawPosition===s));if(f?.participantId){const e=f.participantId,t=Ty({inContextDrawMatchUps:p,tournamentRecord:i,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,matchUpsMap:l,event:u});return t.success?U({removedParticipantId:e}):Mi({result:t,stack:d})}const h=zU({inContextDrawMatchUps:p,tournamentRecord:i,drawDefinition:a,drawPosition:s,structureId:c,matchUpsMap:l,event:u});if(h.error)return Mi({result:h,stack:d});const I=h.participantId,g=Ty({inContextDrawMatchUps:p,isQualifierPosition:n,tournamentRecord:i,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,matchUpsMap:l,event:u});return g.success?U({removedParticipantId:I}):Mi({result:g,stack:d});function U({removedParticipantId:e}){const{structure:n}=rp({drawDefinition:a,structureId:c});mP({drawPositions:[s],structure:n});return ey({drawDefinition:a,positionAction:{[t]:o,name:r,drawPosition:s,structureId:c}}),Mi({context:{removedParticipantId:e},result:{...L},stack:d})}}function hP({alternateParticipantId:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,structureId:i}){return fP({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,structureId:i})}function IP({structurePositionAssignments:e,provisionalPositioning:t,tournamentRecord:n,drawDefinition:r,event:i}){if(!r)return{error:Y};if(!Array.isArray(e))return{error:xn};for(const o of e){const{structureId:e,positionAssignments:a}=o;if(!a)continue;const s=rp({drawDefinition:r,structureId:e});if(s.error)return s;const c=s.structure;if(!c)return{error:De};const u=op({structure:c}).positionAssignments?.map((({drawPosition:e})=>e)),d=a?.map((({drawPosition:e})=>e));if(O(u,d).length!==u?.length)return Mi({result:{error:xn},info:"drawPositions do not match",stack:"setPositionAssignments"});const p=_p({drawDefinition:r}),{matchUps:l}=Cl({inContext:!0,drawDefinition:r,matchUpsMap:p});for(const o of a||[]){const{drawPosition:s,participantId:u,bye:d,qualifier:m}=o;if(d){const t=ty({tournamentRecord:n,drawDefinition:r,drawPosition:s,matchUpsMap:p,structureId:e,structure:c,event:i});if(t?.error)return t}else if(m)a.forEach((e=>{e.drawPosition===s&&(e.qualifier=!0,delete e.participantId,delete e.bye)}));else if(u){const a=Ty({provisionalPositioning:t,inContextDrawMatchUps:l,tournamentRecord:n,drawDefinition:r,participantId:u,drawPosition:s,matchUpsMap:p,structureId:e,event:i});if(a?.error)return a}}sl({tournamentId:n?.tournamentId,drawDefinition:r,structure:c,event:i})}const a=e.map((({structureId:e})=>e));return al({tournamentId:n?.tournamentId,eventId:i?.eventId,drawDefinition:r,structureIds:a}),{...L}}function gP(e){const t=(e?.entries??[]).filter(Boolean).reduce(((e,t)=>{const{entryStage:n,entryStatus:r}=t,i=`_${n||nd}${r||""}`;return e[i]||(e[i]=[]),e[i].push(t),e}),{}),n=e=>isNaN(e)?1/0:e;return Object.keys(t).map((e=>t[e].sort(((e,t)=>n(e.entryPosition)-n(t.entryPosition))).map(((e,t)=>({...e,entryPosition:t+1}))))).flat()}function UP(e){return[Sp,vp].includes(e)}function yP({autoEntryPositions:e=!0,ignoreAssignment:t,tournamentRecord:n,drawDefinition:r,participantIds:i,entryStatus:a,entryStage:o,extension:s,eventSync:c,drawId:u,stage:d,event:p}){if(!i||!Array.isArray(i))return{error:Et,method:"modifyEntriesStatus",participantIds:i};if(!r&&!p)return{error:Ae};if(a&&!Np.includes(a))return{error:Qt};if(o&&!sd.includes(o))return{error:_e};const l="modifyEntriesStatus",m=[];if(!a&&!s)return Mi({result:{error:mt},info:"Missing entryStatus",stack:l});if(s&&!Ys({extension:s,requiredAttributes:["name"]}))return Mi({result:{error:xn},info:"Invalid extension",context:{extension:s},stack:l});const f=[];p?.drawDefinitions?.forEach((e=>{const t=Hh({stages:d&&[d],drawDefinition:e}).assignedParticipantIds??[];f.push(...t)}));const h=n?.participants??[];if(!i.every((e=>{const t=Rs({tournamentParticipants:h,participantId:e})?.participantType;return!(t&&[Xi.Pair,Xi.Team].includes(t)&&UP(a)||a&&p?.eventType&&t===qu&&[ku,Lu].includes(p.eventType)&&[dp,...Tp].includes(a))})))return{error:Qt};const I=p&&Ks({event:p}).flightProfile,g=I?.flights?.find((e=>e.drawId===u)),U=e=>{const n=(e||[]).filter((e=>!d||!e.entryStage||d===e.entryStage)).filter((({participantId:e})=>i.includes(e)));return n.every((e=>!((e=>a&&f.includes(e.participantId)&&!(Tp.includes(e.entryStatus)&&Tp.includes(a)))(e)&&!t)&&(a&&(e.entryStatus=a,delete e.entryPosition),o&&(e.entryStage=o,delete e.entryPosition),s&&(s.value?Js({element:e,extension:s}):ec({element:e,name:s.name})),!0)))?{...L}:{error:zt}},y=({flight:e,drawDefinition:t})=>{p&&(p.entries=gP({entries:p.entries??[]})),e&&(e.drawEntries=gP({entries:e.drawEntries})),t&&(t.entries=gP({entries:t.entries}))},v=e=>{const{flight:t,drawDefinition:n}=e,r="updateDrawEntries";if(t){const e=U(t.drawEntries);if(e.error)return Mi({result:e,stack:r})}if(n){const e=U(n.entries);if(e.error)return Mi({result:e,stack:r});m.includes(n.drawId)||m.push(n.drawId)}return{...L}},S=p?.entries?.find((({entryPosition:e})=>e))??(g?.drawEntries?.find((({entryPosition:e})=>e))||r?.entries?.find((({entryPosition:e})=>e)));if(e&&!S&&y({flight:g,drawDefinition:r}),g||r){const e=v({flight:g,drawDefinition:r});if(e.error)return Mi({result:e,stack:l})}const w=p?.drawDefinitions?.map((({drawId:e})=>e))??[],P=I?.flights?.filter((e=>!w.includes(e.drawId)))||[];for(const D of P){const e=D&&v({flight:D});if(e?.error)return Mi({result:e,stack:l})}const T=1===I?.flights?.length&&(p?.drawDefinitions?.length??0)<=I?.flights?.length;if(!g&&!r&&a&&Dp.includes(a))return{error:tn};if(!g&&!r||a===Pp||c&&T){const e=U(p?.entries);if(e?.error)return Mi({result:e,stack:l});let t;if(a===Pp&&(I?.flights?.every((e=>{const n=U(e.drawEntries);return n.error?(t=n.error,!1):(e.drawEntries=e.drawEntries.filter((({participantId:e})=>!i.includes(e))),!0)})),p?.drawDefinitions?.every((e=>{const n=U(e.entries);return n.error?(t=n.error,!1):(e.entries=e.entries?.filter((({participantId:e})=>!i.includes(e))),!0)}))),t)return Mi({result:{error:t},stack:l})}e&&y({flight:g,drawDefinition:r});for(const D of p?.drawDefinitions??[])m.length&&!m.includes(D.drawId)||al({tournamentId:n.tournamentId,eventId:p?.eventId,drawDefinition:D});return{...L}}function vP({stage:e,drawDefinition:t}){return Boolean(e===ad||Ep({stage:e,drawDefinition:t})&&Uw({stage:e,drawDefinition:t}))}function SP({entryStatus:e=lp,drawDefinition:t,stageSequence:n,stage:r}){if(e===dp)return function({stage:e,drawDefinition:t}){const{entryProfile:n}=up({drawDefinition:t});return n[e]?.alternates||0}({stage:r,drawDefinition:t})?{positionsAvailable:1/0,...L}:{error:en};const i=function(e){const{provisionalPositioning:t,drawDefinition:n,stageSequence:r,stage:i}=e,a=Uw({stage:i,drawDefinition:n}),{qualifiersCount:o}=gw({provisionalPositioning:t,drawDefinition:n,stageSequence:r,stage:i});return a&&a-o}({drawDefinition:t,stageSequence:n,stage:r}),a=function({stage:e,drawDefinition:t}){const{entryProfile:n}=up({drawDefinition:t});return n[e]?.wildcardsCount||0}({drawDefinition:t,stage:r}),o=Cp({entryStatus:wp,drawDefinition:t,stage:r}),s=o+Cp({entryStatus:lp,drawDefinition:t,stage:r}),c=i-s;return r!==ad&&s>=i?{error:nn}:e===wp?o<a?{...L}:{error:nn}:{positionsAvailable:c,...L}}function wP(e){const{entryStatus:t=Wi.DirectAcceptance,entryStageSequence:n,entryStage:r=nd,ignoreStageSpace:i,drawDefinition:a,entryPosition:o,participant:s,roundTarget:c,extensions:u,extension:d,drawType:p}=e,l="addDrawEntry";if(!a)return{error:Y};if(!r)return{error:xe};if(p!==Dd&&!vP({stage:r,drawDefinition:a}))return Mi({result:{error:_e},stack:l});const m=SP({stageSequence:n,stage:r,drawDefinition:a,entryStatus:t});if(!i&&!m.success)return{error:m.error};if(d&&!Ys({extension:d}))return Mi({result:{error:xn},info:"Invalid extension",context:{extension:d},stack:l});const f=e.participantId||s?.participantId;if(!f)return Mi({result:{error:Lt},stack:l});const h=t===Wi.LuckyLoser&&Uy({participantId:f,drawDefinition:a,entryStatus:t}),I=r===ad&&Uy({participantId:f,drawDefinition:a,entryStage:r}),g=t!==Wi.LuckyLoser&&r!==ad&&Uy({drawDefinition:a,participantId:f});if(g||h||I)return Mi({context:{invalidEntry:g,invalidLuckyLoser:h,invalidVoluntaryConsolation:I},result:{error:Yt},stack:l});const U=pi({entryStageSequence:n,participantId:f,entryPosition:o,entryStatus:t,entryStage:r,extensions:u});return d&&Js({element:U,extension:d}),c&&Js({extension:{name:"roundEntry",value:c},element:U}),a.entries||(a.entries=[]),a.entries.push(U),al({drawDefinition:a}),{...L}}function PP(e){const{entryStatus:t=Wi.DirectAcceptance,stage:n=$i.Main,autoEntryPositions:r=!0,ignoreStageSpace:i,drawDefinition:a,participantIds:o,stageSequence:s,roundTarget:c,extension:u}=e;if(!n)return{error:xe};if(!a)return{error:Y};if(!Array.isArray(o))return{error:Ct};if(!vP({stage:n,drawDefinition:a}))return{error:_e};if(u&&!Ys({extension:u}))return Mi({result:{error:xn},info:"Invalid extension",context:{extension:u},stack:"addDrawEntries"});const d=SP({drawDefinition:a,stageSequence:s,entryStatus:t,stage:n});if(!i&&!d.success)return{error:d.error};const p=d.positionsAvailable??0;if(!i&&n!==ad&&p<o.length)return{error:Kt};const l=o.reduce(((e,r)=>{const i=t===Wi.LuckyLoser&&Uy({participantId:r,drawDefinition:a,entryStatus:t}),o=n===ad&&Uy({entryStage:n,drawDefinition:a,participantId:r});return t!==Wi.LuckyLoser&&n!==ad&&Uy({drawDefinition:a,participantId:r})||i||o?e.concat(r):e}),[]);return o.filter((e=>e&&!l.includes(e))).forEach((e=>{const r={entryStageSequence:s,entryStage:n,participantId:e,entryStatus:t};u&&Js({element:r,extension:u}),c&&Js({extension:{name:qo,value:c},element:r}),a.entries||(a.entries=[]),a.entries.push(r)})),r&&(a.entries=gP({entries:a.entries})),al({drawDefinition:a}),l?.length?{info:"some participantIds could not be added",participantIdsNotAdded:l,...L}:{...L}}function TP({autoEntryPositions:e=!0,entryStageSequence:t,ignoreStageSpace:n,drawDefinition:r,participantIds:i,entryStatus:a,roundTarget:o,entryStage:s,extension:c,drawId:u,event:d}){if(!i?.length)return{error:Gt};if(!d)return{error:Ee};if(!u)return{error:le};const p=(d.entries||[]).map(Sl);if(i.filter((e=>!p.includes(e))).length)return{error:Oe};if(r){const u=PP({stageSequence:t,autoEntryPositions:e,stage:s,ignoreStageSpace:n,drawDefinition:r,participantIds:i,entryStatus:a,roundTarget:o,extension:c});if(u.error)return u}const{flightProfile:l}=Ks({event:d}),m=l?.flights.find((e=>e.drawId===u));return m?.drawEntries&&(i.forEach((e=>{const t=a===hp&&DP({participantId:e,entryStatus:a,flight:m}),n=s===ad&&DP({participantId:e,entryStage:s,flight:m});a!==hp&&s!==ad&&DP({flight:m,participantId:e})||t||n||m.drawEntries.push({participantId:e,entryStatus:a,entryStage:s})})),e&&(m.drawEntries=gP({entries:m.drawEntries}))),{...L}}function DP({participantId:e,entryStatus:t,entryStage:n,flight:r}){const i=r.drawEntries?.find((r=>!(r.participantId!==e||t&&t!==r.entryStatus||n&&n!==r.entryStage)));return e&&i}function RP({autoEntryPositions:e=!0,participantIds:t=[],entryStatuses:n,stage:r,event:i}){const a="removeEventEntries";if(!i?.eventId)return{error:Ae};if(!Array.isArray(t)||t.some((e=>!si(e))))return Mi({result:{error:Et},stack:a});const o=(i.drawDefinitions??[]).flatMap((e=>Hh({drawDefinition:e}).assignedParticipantIds??[])),s=(n?.length&&i.entries?.filter((e=>e.entryStatus&&n.includes(e.entryStatus)))||[]).map(di("participantId")).filter((e=>!o.includes(e))),c=(r&&i.entries?.filter((e=>e.entryStage&&e.entryStage===r))||[]).map(di("participantId")).filter((e=>!o.includes(e)));if(t.length?t=t.filter((e=>(!n?.length||s.includes(e))&&(!r||c.includes(e)))):s.length&&c.length?t=O(s,c):s.length?t=s:c.length&&(t=c),t?.length&&o.some((e=>t.includes(e))))return Mi({result:{error:zt},stack:a});if(!t?.length)return{...L,participantIdsRemoved:[]};const u=[];i.entries=(i.entries??[]).filter((e=>{const n=!t.includes(e?.participantId);return n||u.push(e.participantId),n})),e&&(i.entries=gP({entries:i.entries}));const{flightProfile:d}=Ks({event:i});return d?.flights?.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!t.includes(e.participantId)))})),i.drawDefinitions?.forEach((e=>{e.entries=(e.entries??[]).filter((e=>!t.includes(e.participantId)))})),{...L,participantIdsRemoved:u}}function bP(e){const{entryStatus:t=lp,autoEntryPositions:n=!0,enforceGender:r=!0,participantIds:i=[],entryStageSequence:a,policyDefinitions:o,entryStage:s=nd,tournamentRecord:c,ignoreStageSpace:u,drawDefinition:d,roundTarget:p,extensions:l,extension:m,drawId:f,event:h}=e,I="addEventEntries";if(!h)return{error:Ae};if(!i?.length)return Mi({result:{error:Gt},stack:I});if(!h?.eventId)return{error:Ee};const g=Xo({tournamentRecord:c,event:h}).appliedPolicies??{},U=o?.[lo]??g?.[lo]??BI[lo],y=!1!==(r??U?.participants?.enforceGender),v=[],S=[];if(l&&(!Array.isArray(l)||!l.every((e=>Ys({extension:e}))))||m&&!Ys({extension:m}))return Mi({context:pi({extension:m,extensions:l}),result:{error:xn},info:"Invalid extension(s)",stack:I});const w=!!c,P=[];let T;const D=c?.participants?.filter((e=>{if(!i.includes(e.participantId))return!1;const n=h.eventType===_i&&e.participantType===qu&&!UP(t),r=h.eventType===Bi&&e.participantType===Wu;return!(!n||h.gender&&y&&![Ci,Ai].includes(h.gender)&&h.gender!==e.person?.sex)||(!(!r||UP(t))||(!(h.eventType!==Bi||e.participantType!==qu||!UP(t))||(n&&h.gender&&y&&![Ci,Ai].includes(h.gender)&&h.gender!==e.person?.sex?(P.push({participantId:e.participantId,sex:e.person?.sex}),!1):h.eventType===Hu&&(e.participantType===Hu||UP(t)&&e.participantType===qu))))})).map((e=>e.participantId))||[],R=i.filter((e=>!w||D.includes(e)));h.entries||(h.entries=[]);const b=h.entries.map((e=>e.participantId||e.participant?.participantId));if(R.forEach((e=>{if(!b.includes(e)){const n=pi({participantId:e,entryStatus:t,entryStage:s,extensions:l});m&&Js({element:n,extension:m}),p&&Js({extension:{name:qo,value:p},element:n}),a&&(n.entryStageSequence=a),v.push(n.participantId),h.entries&&h.entries.push(n)}})),f&&!UP(s)){const e=TP({participantIds:R,autoEntryPositions:n,entryStageSequence:a,ignoreStageSpace:u,drawDefinition:d,entryStatus:t,roundTarget:p,entryStage:s,extension:m,drawId:f,event:h});e.error&&(T=e.error)}if(h.eventType&&[Yi.Doubles,Yi.Team].includes(h.eventType)){const e=(h.entries||[]).map((e=>e.participantId)),t=(h.entries||[]).filter((e=>UP(e.entryStatus))).map((e=>e.participantId)),n=(c?.participants||[]).filter((t=>e.includes(t.participantId)&&t.participantType&&[Wu,Hu].includes(t.participantType))).map((e=>e.individualParticipantIds)).flat(1/0),r=t.filter((e=>n.includes(e)));r.length&&(S.push(...r),RP({participantIds:r,autoEntryPositions:!1,event:h}))}if(R.length!==i.length)return Mi({context:{mismatchedGender:P,gender:h.gender},result:{error:Ct},stack:I});n&&(h.entries=gP({entries:h.entries||[]}));const N=v.length-S.length;return Mi({result:{...L,addedEntriesCount:N},stack:I,info:T})}function NP({addIndividualParticipantsToEvents:e,individualParticipantIds:t,groupingParticipantId:n,tournamentRecord:r,suppressErrors:i}){const a="removeIndividualParticipantIds";if(!r)return Mi({result:{error:$},stack:a});if(!n||!t)return Mi({result:{error:mt},stack:a});const o=(r.participants??[]).find((e=>e.participantId===n));if(!o)return Mi({result:{error:Bt},stack:a});if(![Hu,$u].includes(o.participantType))return Mi({result:{participantType:o.participantType,error:Ft},stack:a});const s=MP({individualParticipantIds:t,groupingParticipant:o,tournamentRecord:r,suppressErrors:i}),{removed:c,error:u}=s;if(u)return Mi({result:s,stack:a});if(e)for(const d of r.events??[]){const e=(d.entries??[]).map((({participantId:e})=>e)).filter(Boolean);if(e.includes(n)){const t=c?.filter((t=>!e.includes(t)));bP({participantIds:t,entryStatus:vp,tournamentRecord:r,event:d})}}return c&&pr({topic:Nc,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...L,...s}}function MP({individualParticipantIds:e=[],groupingParticipant:t,tournamentRecord:n,suppressErrors:r,mappedMatchUps:i,participants:a}){const o=[];if(!t)return{removed:o};const s=[],c=[];a||({participants:a,mappedMatchUps:i}=Kg({withMatchUps:!0,tournamentRecord:n,withEvents:!0}));const u=a?.find((({participantId:e})=>e===t.participantId)),d=u?.events?.map((({eventId:e})=>e)),p=(t.individualParticipantIds??[]).filter((r=>{const u=e?.includes(r),p=u&&a?.find((e=>e.participantId===r))?.matchUps.filter((({eventId:e})=>d.includes(e))).map((({matchUpId:e})=>i?.[e])).filter((({winningSide:e,score:t})=>e||dl({score:t}))),l=u&&!p?.length;if(u&&!l&&c.push(r),l){o.push(r);for(const e of n.events??[])for(const i of e.drawDefinitions??[]){const{extension:e}=Ms({element:i,name:_o}),a=e?.value[t.participantId];e&&a&&(e.value[t.participantId]=a.filter((e=>e.participantId!==r)),Js({element:i,extension:e}),il({drawDefinition:i}));const o=ih({drawDefinition:i,inContext:!1}).matchUps??[];for(const t of o){const e=t.sides??[];for(const a of e){const e=a.lineUp??[];e.find((e=>e.participantId===r))&&(a.lineUp=e.filter((e=>e.participantId!==r)),rl({tournamentId:n?.tournamentId,drawDefinition:i,matchUp:t}))}}}}else s.push(r);return!l}));t.individualParticipantIds=p;const l={groupingParticipantId:t.participantId,cannotRemove:c,notRemoved:s,removed:o};return c.length&&!r&&{...l,cannotRemove:c,error:Nt}||l}function AP({participantRole:e=Ji.Competitor,individualParticipantIds:t=[],groupingTypes:n=[Xi.Team,Xi.Group],tournamentRecord:r}){if(!r)return{error:$};const i=r.participants??[],{participants:a,mappedMatchUps:o}=Kg({withMatchUps:!0,tournamentRecord:r,withEvents:!0});let s=0;return i.filter((t=>(t.participantRole===e||!t.participantRole)&&t.participantType&&n.includes(t.participantType))).forEach((e=>{const{removed:n}=MP({groupingParticipant:e,individualParticipantIds:t,tournamentRecord:r,mappedMatchUps:o,participants:a});n&&s++})),s?L:{error:jt}}function EP(e){if(!e?.tournamentRecord)return{error:$};if(!e?.participantIds?.length)return{error:Gt};const{addIndividualParticipantsToEvents:t,tournamentRecord:n,participantIds:r}=e,i=n.participants?.length||0;if(!i)return{...L};const a=(n.events||[])?.filter((({eventType:e})=>e===_u)).map((e=>e?.drawDefinitions?.map((({drawId:e})=>e)))).flat(1/0),o=Kg({participantFilters:{participantIds:r},tournamentRecord:n,withDraws:!0}).participants??[],s=a?.length&&O((rh({matchUpFilters:{drawIds:a,matchUpTypes:[Bi]},tournamentRecord:n}).matchUps??[]).map((({sides:e})=>e?.map((({participantId:e})=>e)))).flat().filter(Boolean),r),c=o.filter((e=>e.draws?.filter((e=>(!a?.length||!a?.includes(e.drawId))&&e.positionAssignments)).length));if(s?.length||c.length)return{error:zt};const u={},d={};for(const l of n.events||[]){const e=RP({participantIds:r,event:l});if(e.error)return e;u[l.eventId]=e.participantIdsRemoved}n.participants=n.participants.filter((e=>{const n=r.includes(e.participantId)||e.participantType===Wu&&e.individualParticipantIds.some((e=>r.includes(e)));if(!n&&e.participantType===_u&&e.individualParticipantIds.some((e=>r.includes(e)))&&(e.individualParticipantIds=e.individualParticipantIds.filter((e=>!r.includes(e)))),n&&t&&[Wu,Hu].includes(e.participantType))for(const t of e.individualParticipantIds||[])r.includes(t)||(d[e.participantId]||(d[e.participantId]=[]),d[e.participantId].push(t));return!n}));const p=i-n.participants.length;if(AP({individualParticipantIds:r,tournamentRecord:n}),t)for(const l of n.events||[]){bP({participantIds:u[l.eventId].map((e=>d[e]||[])).flat(),entryStatus:vp,tournamentRecord:n,event:l})}return p&&pr({payload:{participantIds:r,tournamentId:n.tournamentId},topic:vc}),p?{...L,participantsRemovedCount:p}:{error:Nt}}function CP({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:n,participantId:r,drawId:i,stage:a,event:o}){const s="destroyGroupEntry";if(!t)return{error:$};if(!r)return Mi({result:{error:Lt},stack:s});if(!o)return{error:Ae};if(!o.eventType||![Yi.Doubles,Yi.Team].includes(o.eventType))return Mi({result:{error:Me},stack:s});const c=t.participants??[],u=c.find((e=>e.participantId===r));if(!u)return Mi({result:{error:Bt},stack:s});if(!u.participantType||![Xi.Pair,Xi.Team].includes(u.participantType)||u.participantType===_u&&o.eventType!==_u||u.participantType===Wu&&o.eventType!==ku)return{error:Ft};const d=(o.entries??[]).find((e=>e.participantId===r));if(!d)return{error:Jt};const{stageEntries:p}=Ag({selected:!1,drawDefinition:n,drawId:i,event:o,stage:a}),l=p.map(Sl),m=c.filter((({participantId:e})=>l.includes(e))).map((({individualParticipantIds:e})=>e)).flat().filter(Boolean),f=u.individualParticipantIds?.filter((e=>1===C(e,m).length));let h,I=RP({participantIds:[r],event:o});if(I.error)return I;if(f?.length&&(I=bP({participantIds:f,entryStatus:vp,entryStage:d.entryStage,tournamentRecord:t,drawDefinition:n,drawId:i,event:o}),I.error))return I;if(e){EP({participantIds:[r],tournamentRecord:t}).success&&(h=!0)}return{...L,participantRemoved:h}}function OP({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:n,participantId:r,drawId:i,event:a}){return CP({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:n,participantId:r,drawId:i,event:a})}function FP(e){const{tournamentRecord:t,replaceWithBye:n,drawDefinition:r,destroyPair:i,entryStatus:a,matchUpsMap:o,drawId:s}=e,c="removeDrawPositionAssignment",u=zU(e);if(u.error)return Mi({result:u,stack:c});const{participantId:d}=u,{drawPosition:p,event:l,structureId:m}=e;if([dp,Pp].includes(a)&&d){const{tournamentRecord:t}=e,{participant:n}=bs({tournamentRecord:t,participantId:d}),{participantType:o,individualParticipantIds:u}=n??{};if(i&&o===Wu){const e=OP({tournamentRecord:t,drawDefinition:r,participantId:d,event:l});if(e.error)return Mi({result:e,stack:c});u&&yP({participantIds:u,tournamentRecord:t,drawDefinition:r,entryStatus:a,drawId:s,event:l})}else yP({participantIds:[d],tournamentRecord:t,drawDefinition:r,entryStatus:a,drawId:s,event:l})}if(n){const e=ty({tournamentRecord:t,drawDefinition:r,drawPosition:p,structureId:m,matchUpsMap:o,event:l});if(e.error)return Mi({result:e,stack:c})}const{structure:f}=rp({drawDefinition:r,structureId:m});mP({structure:f,drawPositions:[p]});return ey({drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:n,drawPosition:p,entryStatus:a,structureId:m}}),u}function kP({tournamentRecord:e,drawDefinition:t,drawPositions:n,structureId:r,event:i}){if(!t)return{error:Y};if(!r)return{error:Te};if(2!==n?.length)return{error:xn,drawPositions:n};const a=_p({drawDefinition:t}),{matchUps:o}=Cl({inContext:!0,drawDefinition:t,matchUpsMap:a}),{structure:s}=rp({drawDefinition:t,structureId:r});if(!s)return{error:De};let c;if(c=s.structureType===Id?function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,drawPositions:r,matchUpsMap:i,structure:a,event:o}){const s=a.structures?.reduce(((e,t)=>{const n=t?.positionAssignments.filter((e=>r?.includes(e.drawPosition)));return n&&e.push(...n),e}),[]);if(2===s.filter((({bye:e})=>e)).length)return{...L};if(2===s.filter((({qualifier:e})=>e)).length)return{...L};Py({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,matchUpsMap:i,assignments:s,structure:a,event:o});const c=s.some((({qualifier:e})=>e));if(s.some((({bye:e})=>e))&&!c)xP({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,assignments:s,matchUpsMap:i,structure:a,event:o});else{const e=ii(s,!1,!0);s.forEach(((t,n)=>{const r=e[1-n].participantId;t.qualifier=e[1-n].qualifier,t.participantId=r}))}return{...L}}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:n,matchUpsMap:a,structure:s,event:i}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,drawPositions:r,matchUpsMap:i,structure:a,event:o}){const s=a?.positionAssignments.filter((e=>r?.includes(e.drawPosition)));if(!s)return{error:xn,structure:a,info:"Missing positionAssignments"};if(2===s.filter((({bye:e})=>e)).length)return{...L};if(2===s.filter((({qualifier:e})=>e)).length)return{...L};const c=s.some((({qualifier:e})=>e));return s.some((({bye:e})=>e))&&!c?xP({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,assignments:s,matchUpsMap:i,structure:a,event:o}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,assignments:r,matchUpsMap:i,structure:a,event:o}){const s=Object.assign({},...r.map(((e,t)=>{const{drawPosition:n}=e;return{[n]:{...r[1-t],drawPosition:n}}})));return a.positionAssignments=a.positionAssignments.map((e=>s[e.drawPosition]||e)),Py({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,matchUpsMap:i,assignments:r,structure:a,event:o}),{...L}}({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,assignments:s,matchUpsMap:i,structure:a,event:o})}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:n,matchUpsMap:a,structure:s,event:i}),c.error)return c;mP({structure:s,drawPositions:n});if(ey({drawDefinition:t,positionAction:{name:"swapDrawPositionAssignments",drawPositions:n,structureId:r}}),sl({tournamentId:e?.tournamentId,drawDefinition:t,structure:s,event:i}),i.eventType===Lu){const r=Kp({matchUpFilters:{matchUpTypes:[Vi]},inContext:!0,structure:s}).matchUps.filter((e=>e.drawPositions?.some((e=>n.includes(e))))),a=Kp({structure:s,matchUpFilters:{matchUpTypes:[Vi]}}).matchUps;r.forEach((r=>{(r.sides||[]).forEach((o=>{const s=o?.drawPosition;if(n.includes(s)){const n=o.participantId,c=a.find((({matchUpId:e})=>e===r.matchUpId)),u=r?.sides?.reduce(((e,t,n)=>t.drawPosition===s?n:e),void 0);oy({inContextTargetMatchUp:r,drawPositionSideIndex:u,teamParticipantId:n,tournamentRecord:e,drawDefinition:t,matchUp:c,event:i})}}))}))}return al({drawDefinition:t,structureIds:[r]}),{...L}}function xP({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,assignments:r,matchUpsMap:i,structure:a,event:o}){const s=r.find((({bye:e})=>e)),c=r.find((({participantId:e})=>e)),u=s.drawPosition,{participantId:d,drawPosition:p}=c,{structureId:l}=a;let m=FP({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,structureId:l,matchUpsMap:i});return m.error?m:(m=FP({drawPosition:p,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,structureId:l,matchUpsMap:i}),m.error?m:(ty({drawPosition:p,tournamentRecord:t,drawDefinition:n,structureId:l,matchUpsMap:i,event:o}),m=Ty({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:n,structureId:l,participantId:d,matchUpsMap:i,event:o}),m.error?m:{...L}))}function _P({inheritance:e=!0,tournamentRecord:t,drawDefinition:n,matchUpId:r,event:i}){if(!n)return{error:Y};const a=Qp({drawDefinition:n,matchUpId:r})?.matchUp;if(!a?.tieMatchUps)return{error:tt};const o=Qp({inContext:!0,drawDefinition:n,matchUpId:r,event:i})?.matchUp;let s=0;return(a?.sides||[]).forEach((e=>{e.lineUp&&delete e.lineUp})),(o?.sides||[]).forEach((r=>{if(s+=1,!1===e){const e=o?.tieFormat,t=r.participantId;e&&t&&wy({drawDefinition:n,participantId:t,lineUp:[],tieFormat:e})}rl({tournamentId:t?.tournamentId,context:"resetMatchUpLineUps",eventId:i?.eventId,drawDefinition:n,matchUp:a})})),{...L,modificationsCount:s}}function LP({tournamentRecord:e,drawDefinition:t,drawPosition:n,structureId:r,subOrder:i,event:a}){if(!t)return{error:Y};if(!r)return{error:Te};if(!n)return{error:se};const{structure:o}=rp({drawDefinition:t,structureId:r});if(!o)return{error:De};let s=o;o.structures&&o.structureType===Id&&(s=o.structures?.find((e=>e.positionAssignments?.find((e=>e.drawPosition===n)))));const c=s?.positionAssignments,u=c?.find((e=>e.drawPosition===n));u&&Js({element:u,extension:{name:zo,value:i}});const d=(a?.eventType===ji||t.matchUpType===ji||a?.tieFormat||t?.tieFormat||o?.tieFormat)&&{matchUpTypes:[ji]},{matchUps:p}=Kp({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a});return Il({positionAssignments:c,tournamentRecord:e,drawDefinition:t,matchUpFormat:o?.matchUpFormat||t.matchUpFormat,matchUps:p,event:a}),al({drawDefinition:t,structureIds:[r]}),{...L}}const BP={setSubOrder:LP,clearDrawPosition:zU,assignDrawPosition:Ty,setPositionAssignments:IP,automatedPositioning:Ww,assignDrawPositionBye:ty,swapDrawPositionAssignments:kP,alternateDrawPositionAssignment:hP,resolveDrawPositions:function({positionAssignments:e,participantFactors:t}){if(!t||!e)return{error:mt};let n=ii(t,!1,!0);const r=e.map((({drawPosition:e})=>e)),i=e.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map(wl);let a,o=!0;for(;o;)({drawPositionResolutions:a,remainingPreferences:o,participantPreferences:n}=lP({participantPreferences:n,drawPositionResolutions:a}));const s=Object.keys(a).map((e=>m(e)));let c=i.filter((e=>!s.includes(e))),u=Object.keys(n);const d=E(1,(p=2,l=r?.length||0,Math.log(l)/Math.log(p)+1)).map((e=>Math.pow(2,e)));var p,l;const f={};for(const I of d){const e=x(r,I).filter((e=>k(e,c))),n={};u.forEach((r=>{e.forEach((e=>{const i=e.join("|");k(e,t[r].preferences)&&(n[i]||(n[i]=[]),n[i].push(r))}))}));if(T(Object.keys(n)).forEach((e=>{const t=n[e].filter((e=>u.includes(e)));for(;t.length;){const n=M(t),r=e.split("|").map((e=>m(e))).filter((e=>c.includes(m(e))));if(r.length){const t=M(r);c=c.filter((e=>e!==t)),u=u.filter((e=>e!==n)),a[t]=n;const i=e.split("|").length;f[i]||(f[i]=0),f[i]+=1}}})),!c.length)break}const h={chunkResolution:f};return u.length&&(u.forEach((e=>{const t=M(c);t&&(a[t]=e)})),h.randomAssignment=u.length),{drawPositionResolutions:a,report:h}},resetMatchUpLineUps:_P,initializeStructureSeedAssignments:pP,getNextSeedBlock:sU};function VP({drawDefinition:e,event:t,matchUpId:n}){if(!e)return{error:Y};if(!n)return{error:Qe};const{matchUp:r}=Qp({drawDefinition:e,event:t,matchUpId:n});return r?ec({element:r,name:Mo}):{error:Xe}}function jP(e){return e.participantIdPairings.map((({participantIds:e})=>e.sort().join("|"))).sort().join("/")}function GP({valueSortedPairings:e,stipulated:t=[],pairingValueMap:n,deltaObjects:r,valueObjects:i,actorsCount:a}){const o=[].concat(...t),s=[];let c=0;t.filter(Boolean).forEach((e=>{const[t,r]=e,i=qP(t,r),a=n[i];s.push({participantIds:e,value:a}),c+=n[i]}));x(e,a).map((e=>T(e).map((e=>({...e,value:e.value+Math.random()*Math.round(Math.random())}))))).flat().forEach((e=>{const t=e.pairing.split("|");if(!t.reduce(((e,t)=>o.includes(t)||e),!1)){o.push(...t);const n=e.value;c+=n,s.push({participantIds:t,value:n})}})),s.sort(((e,t)=>e.value-t.value));const u=s.reduce(((e,t)=>{const[n,i]=t.participantIds,a=qP(n,i),o=r[a];return o>e?o:e}),0),d=s.reduce(((e,t)=>{const[n,r]=t.participantIds,a=qP(n,r),o=i[a];return o>e?o:e}),0);return{value:c,participantIdPairings:s,maxDelta:u,maxDiff:d}}function qP(e,t){return[e,t].sort(Mh).join("|")}function $P({participantIds:e}){const t={},n=[];e.forEach((r=>{t[r]=e.filter((e=>e!==r)),t[r].forEach((e=>{const t=qP(e,r);n.includes(t)||n.push(t)}))}));const r=Object.assign({},...n.map((e=>({[e]:0}))));return{uniquePairings:n,possiblePairings:t,deltaObjects:r}}const WP=0;function HP({tournamentParticipants:e,adHocRatings:t={},possiblePairings:n,uniquePairings:r,maxIterations:i,deltaObjects:a,valueObjects:o,eventType:s,scaleName:c,salted:u}){r.forEach((n=>{const r=function({tournamentParticipants:e,adHocRatings:t,eventType:n,scaleName:r,pairing:i}){const a=zm[r]?.defaultInitialization??WP;return i.split("|").map((r=>{if(n===ku){const n=e?.find((e=>e.participantId===r))?.individualParticipantIds;return n?n?.map((e=>t[e]||a)):2*a}return t[r]||a}))}({tournamentParticipants:e,adHocRatings:t,scaleName:c,eventType:s,pairing:n}),i="number"==typeof u&&u||.5,d=u&&(Math.round(Math.random())?i:-1*i)||0,p=Math.abs(r[0]-r[1])+d,l=Math.abs(r[0]-r[1]);a[n]=l,o[n]||(o[n]=0),o[n]+=p?Math.pow(p,2):0}));const d=r.map((e=>({pairing:e,value:o[e]}))).sort(((e,t)=>e.value-t.value)),{pairingValues:p}=function({possiblePairings:e,valueObjects:t}){const n={};for(const i of Object.keys(e)){const t=e[i].map((e=>r(i,e)));n[i]=t.sort(((e,t)=>e.value-t.value))}function r(e,n){const r=qP(e,n);return{opponent:n,value:t[r]}}return{pairingValues:n}}({possiblePairings:n,valueObjects:o}),{candidate:l,candidatesCount:m,deltaCandidate:f,iterations:h}=function({maxIterations:e=4e3,valueSortedPairings:t,pairingValues:n,valueObjects:r,deltaObjects:i}){const a=Object.assign({},...t.map((e=>({[e.pairing]:e.value})))),o=Object.keys(n);let s=[];const c=GP({actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:i,valueObjects:r}),u=[jP(c)];s.push(c);let d,p=c.value,l=c,m=0,f=0,h=o.length;do{h-=1,d=o.length*n[o[0]].length}while(d>e&&h>5);const I=[];o.forEach((e=>{n[e].slice(0,h).forEach((n=>{f+=1;const c=qP(e,n.opponent);if(!I.includes(c)){const d=GP({stipulated:[[e,n.opponent]],actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:i,valueObjects:r});if(!u.includes(jP(d))){u.push(jP(d)),s.push(d);const{maxDelta:e,value:t}=d;e<l.maxDelta&&(l=d),(t<p||t===p&&Math.round(Math.random()))&&(p=t),I.push(c),m+=1}}})),s=s.filter((e=>Math.abs(e.value-p)<5))})),s.sort(((e,t)=>e.maxDiff-t.maxDiff));const g=M(s);return{candidatesCount:m,deltaCandidate:l,maxIterations:e,iterations:f,candidate:g}}({valueSortedPairings:d,maxIterations:i,pairingValues:p,deltaObjects:a,valueObjects:o}),{participantIdPairings:I}=l;return{participantIdPairings:I,candidatesCount:m,deltaCandidate:f,iterations:h,candidate:l}}const zP=100,YP=100,KP=4e3;function QP({encounterValue:e=zP,sameTeamValue:t=YP,maxIterations:n=KP,generateMatchUps:r=!0,tournamentParticipants:i,tournamentRecord:a,participantIds:o,addToStructure:s,drawDefinition:c,adHocRatings:u,structureId:d,salted:p=.5,matchUpIds:l,eventType:m,structure:f,scaleName:h}){if(!c)return{error:Y};if(!f&&!d)return{error:De};if(f||(f=rp({drawDefinition:c,structureId:d}).structure),!ci(f))return{error:be};if(!o?.length)return{error:Gt};const{encounters:I}=function({matchUps:e}){const t=[];for(const n of e){const e=n.sides.map(di("participantId"));if(2===e.length){const[n,r]=e,i=qP(n,r);t.includes(i)||t.push(i)}}return{encounters:t}}({matchUps:f?.matchUps??[]}),g={};for(const A of I)g[A]||(g[A]=0),g[A]+=e;const U=i?.filter((({participantType:e})=>e===Hu));if(U)for(const A of U){const e=A.individualParticipantIds??[],{uniquePairings:n}=$P({participantIds:e});for(const r of n)g[r]||(g[r]=0),g[r]+=t}const{uniquePairings:y,possiblePairings:v,deltaObjects:S}=$P({participantIds:o}),w={tournamentParticipants:i,possiblePairings:v,drawDefinition:c,participantIds:o,uniquePairings:y,maxIterations:n,adHocRatings:u,deltaObjects:S,valueObjects:g,eventType:m,scaleName:h,structure:f,salted:p},{candidatesCount:P,participantIdPairings:T,iterations:D,candidate:R}=HP(w);if(!P)return{error:An};let b;if(r){const e=cP({structureId:f?.structureId,participantIdPairings:T,tournamentRecord:a,addToStructure:s,newRound:!0,drawDefinition:c,matchUpIds:l});if(e.error)return e;b=e.matchUps}const{maxDelta:N,maxDiff:M}=R;return{...L,participantIdPairings:T,candidatesCount:P,iterations:D,matchUps:b,maxDelta:N,maxDiff:M}}function JP({tournamentParticipants:e,restrictEntryStatus:t,adHocRatings:n={},generateMatchUps:r,tournamentRecord:i,addToStructure:a,participantIds:o,encounterValue:s,sameTeamValue:c,drawDefinition:u,scaleAccessor:d,maxIterations:p,structureId:l,matchUpIds:m,scaleName:f,eventType:h,salted:I,event:g}){if("object"!=typeof u||u.drawType&&u.drawType!==Dd)return{error:z};if(!Array.isArray(u?.entries)&&o&&!Array.isArray(o))return{error:xn,info:"Missing Entries"};h=h??g?.eventType;const U=u?.entries?.filter((e=>{const n=e.entryStatus;return!t||bp.includes(n)})).map(Sl);if(o){const e=o.filter((e=>!U?.includes(e)));if(e?.length)return{error:Et,invalidParticipantIds:e}}else o=U;if(!l){const e=u?.structures?.filter((e=>1===e.stageSequence))?.reduce(((e,t)=>{const n=t.stage&&cd[t.stage];return Hp({drawDefinition:u,structure:t})&&n>(cd[e?.stage]||1)?t:e}),void 0);l=e?.structureId}const y=u?.structures?.find((e=>e.structureId===l));if(!y)return{error:De};if(!Hp({drawDefinition:u,structure:y}))return{error:z};e=e??i.participants??[];for(const v of o??[]){const t=e?.find((e=>e.participantId===v));let r=XP({scaleName:`${f}.${ys}`,scaleAccessor:d,participant:t,eventType:h});!r&&f&&(r=XP({scaleAccessor:d,participant:t,scaleName:f,eventType:h})),r&&!n[v]&&(n[v]=r)}return QP({tournamentParticipants:e,generateMatchUps:r,tournamentRecord:i,addToStructure:a,participantIds:o,encounterValue:s,sameTeamValue:c,drawDefinition:u,maxIterations:p,adHocRatings:n,matchUpIds:m,structure:y,eventType:h,salted:I})}function XP({scaleType:e=Ss,scaleAccessor:t,participant:n,scaleName:r,eventType:i}){const a={eventType:i||Yi.Singles,scaleType:e,scaleName:r},o=n&&zh({scaleAttributes:a,participant:n}),s=o?.scaleItem?.scaleValue;return t&&ci(s)?s[t]:s}function ZP({drawDefinition:e,matchUpId:t,outcome:n,matchUp:r}){if(!r&&!e)return{error:Y};if(!n)return{error:mt,info:"missing outcome"};if(!r&&!t)return{error:et};if(!r){const n=Qp({drawDefinition:e,matchUpId:t});if(n.error)return n;r=n.matchUp}if("object"!=typeof n||!n.score?.scoreStringSide1||!n.score?.scoreStringSide2)return{error:xn};return Js({element:r,extension:{name:Mo,value:n}})}function eT(e){return null!==e&&(void 0===e||!isNaN(e))}function tT({drawDefinition:e,matchUpId:t,event:n}){if(!e)return{error:Y};const{matchUp:r}=Qp({drawDefinition:e,matchUpId:t,event:n});return Js({extension:{name:Co,value:!0},element:r})}function nT({tournamentRecord:e,drawDefinition:t,matchUpId:n,event:r}){if(!t)return{error:Y};const{matchUp:i}=Qp({drawDefinition:t,matchUpId:n,event:r});return i?.matchUpType!==Vi?{error:tt}:Cy({enableAutoCalc:!0,tournamentRecord:e,drawDefinition:t,matchUpId:n,event:r})}function rT({drawDefinition:e,finishingOrder:t}){if(!e)return{error:Y};const n="setOrderOfFinish";if(!Array.isArray(t))return Mi({info:sa("finishingOrder"),result:{error:xn},stack:n});const{completedMatchUps:r,matchUpsMap:i}=Ol({inContext:!0,drawDefinition:e}),a=r?.map(Pl)??[],o=t.map(Pl),{matchUpTypes:s,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(r??[]).filter((({matchUpId:e})=>o.includes(e))).reduce(((e,t)=>{const{matchUpTieId:n,matchUpType:r,roundNumber:i,structureId:a}=t;return e.matchUpTypes.includes(r)||e.matchUpTypes.push(r),e.roundNumbers.includes(i)||e.roundNumbers.push(i),e.structureIds.includes(a)||e.structureIds.push(a),e.matchUpTieIds.includes(n)||e.matchUpTieIds.push(n),e}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(s.length>1||d.length>1||c.length>1||u.length>1)return Mi({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:xn},stack:n});let p,l;const m={},f=[],h=[],I=t.every((({orderOfFinish:e,matchUpId:t})=>(f.push(t),e&&h.push(e),m[t]=e,p=a.includes(t),l=void 0===e||S(e)&&Math.floor(e)>0,p&&l)));if(!I)return Mi({result:{error:p?xn:$e},info:(p?!l&&"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed")||void 0,stack:n});const g=r?.filter((e=>e.structureId===u[0]&&e.roundNumber===c[0]&&e.matchUpType===s[0]&&e.matchUpTieId===d[0]&&!f.includes(e.matchUpId)));for(const U of g??[]){const{orderOfFinish:e}=U||{};if(e){if(!S(e))return Mi({context:{orderOfFinish:e,matchUp:U},result:{error:xn},stack:n});h.push(e)}}if(N(h).length!==h.length||Math.max(...h)>h.length)return Mi({info:"Values not unique or greater than expected number of values",result:{error:xn},stack:n});if(u.length){const t=El({matchUpFilters:{matchUpIds:o},structureId:u[0],drawDefinition:e,matchUpsMap:i});if(t.error)return Mi({result:t,stack:n});t.completedMatchUps?.forEach((e=>e.orderOfFinish=m[e.matchUpId]))}return{...L}}const iT={resetScorecard:hv,setMatchUpStatus:Cy,setMatchUpFormat:Fy,updateTieMatchUpScore:xl,isValidMatchUpFormat:Ti,disableTieAutoCalc:tT,enableTieAutoCalc:nT,addFinishingRounds:Sh,addMatchUpTimeItem:TU,resetMatchUpTimeItems:function({tournamentRecord:e,drawDefinition:t,matchUpId:n,event:r}){const{matchUp:i}=Qp({drawDefinition:t,event:r,matchUpId:n});return i?(i.timeItems=[],rl({tournamentId:e?.tournamentId,context:"resetTimeItems",eventId:r?.eventId,drawDefinition:t,matchUp:i}),{...L}):{error:Xe}},checkInParticipant:rS,checkOutParticipant:iS,getCheckedInParticipantIds:qp,addMatchUpScheduleItems:EU,addMatchUpScheduledDate:CU,addMatchUpScheduledTime:NU,addMatchUpStartTime:kU,addMatchUpEndTime:xU,addMatchUpStopTime:_U,addMatchUpResumeTime:LU,addMatchUpTimeModifiers:MU,addGoesTo:wh,setOrderOfFinish:rT,setDelegatedOutcome:ZP,removeDelegatedOutcome:VP,drawMatic:JP,addMatchUpOfficial:FU,findMatchUp:function(e){return Object.assign(e,{inContext:!0}),{matchUp:ii(Qp(e).matchUp,!1,!0)}},getRoundMatchUps:ed,validDrawPositions:function({matchUps:e}){if(!e)return{error:Ze};const t=e.map((e=>e.drawPositions)).flat();ar()&&e.forEach((e=>{Array.isArray(e.drawPositions)?e.drawPositions?.forEach((t=>{eT(t)||console.log("invalid drawPosition",e)})):console.log("drawPositions not an array",e)}));const n=t?.every(eT),r=e.find((e=>!Array.isArray(e.drawPositions)));return n&&!r},validateScore:Bl};function aT({drawDefinition:e,policyDefinitions:t}){if(!e)return{error:Y};if(!t||"object"!=typeof t)return{error:rt};e.extensions||(e.extensions=[]);const n=Xo({drawDefinition:e})?.appliedPolicies??{},r=[fo,yo],i=Object.keys(t).every((e=>!(n[e]&&!r.includes(e))&&(n[e]=t[e],!0)));if(i){const t=Js({element:e,extension:{name:Ro,value:n}});if(t.error)return t}return al({drawDefinition:e}),i?{...L}:{error:st}}const oT={attachPolicies:aT};function sT({tournamentParticipants:e,drawDefinition:t,event:n}){if(!t)return{error:Y};const r=ii(Cl({tournamentParticipants:e,inContext:!0,drawDefinition:t,event:n}).matchUps,!1,!0),i=P(r.reduce(((e,t)=>e.concat(...t.sides.map((e=>e.participantId)).filter(Boolean))),[])),a=Object.assign({},...i.map((e=>{const t=r.filter((t=>t.sides.map((e=>e.participantId)).filter(Boolean).includes(e)));return{[e]:t}})));return{participantIds:i,participantIdMatchUps:a}}function cT({byeAdvancements:e=!1,tournamentParticipants:t,drawDefinition:n}){if(!n)return{error:Y};const{participantIds:r,participantIdMatchUps:i}=sT({tournamentParticipants:t,drawDefinition:n}),a=r.map((t=>{const n=i[t].filter((e=>[ha,ma].includes(e.matchUpStatus)||e.winningSide)),r=n.map((n=>{const r=n.sides.find((e=>e.bye)),i=n.sides.find((e=>e.participantId===t)).sideNumber;return(n.winningSide||e&&r&&i)===i?n.finishingPositionRange.winner:n.finishingPositionRange.loser})),a=e=>Math.abs(e[0]-e[1]),o=r.reduce(((e,t)=>e&&a(e)<a(t)?e:t),void 0);return{[t]:{relevantMatchUps:n,finishingPositionRanges:r,finishingPositionRange:o}}}));return Object.assign({},...a)}const uT={allPlayoffPositionsFilled:LI,isCompletedStructure:_I,getAllStructureMatchUps:Kp,getStructureMatchUps:El,allStructureMatchUps:function(e){const{structure:t}=rp(e);return Object.assign(e,{structure:t,inContext:!0}),Kp(e)},allDrawMatchUps:function(e){return Object.assign(e,{inContext:!0}),Cl(e)},drawMatchUps:function(e){return Object.assign(e,{inContext:!0}),Ol(e)},getEliminationDrawSize:Mg,getParticipantIdMatchUps:sT,getParticipantIdFinishingPositions:cT,getEligibleVoluntaryConsolationParticipants:bI,structureActions:function(e){return e?.drawDefinition?{actions:[],state:{isComplete:_I(e),hasPlayoffPositionsFilled:LI(e)}}:{error:Y}},matchUpActions:dg,positionActions:pU,getStructureSeedAssignments:kp,getNextUnfilledDrawPositions:function({provisionalPositioning:e,drawDefinition:t,seedBlockInfo:n,seedingProfile:r,structureId:i,event:a}){if(!t){return{error:Y,nextUnfilledDrawPositions:[]}}if(!i){return{error:Te,nextUnfilledDrawPositions:[]}}const o=rp({drawDefinition:t,structureId:i});if(o.error)return o;const{positionAssignments:s=[]}=sp({structure:o.structure}),{unfilledPositions:c}=sU({provisionalPositioning:e,randomize:!0,drawDefinition:t,seedingProfile:r,seedBlockInfo:n,structureId:i,event:a}),u=s.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));return c?.length?{nextUnfilledDrawPositions:c}:{nextUnfilledDrawPositions:u}},getExitProfiles:xp,getValidGroupSizes:Gh,getSeedingThresholds:Wh,getSeedBlocks:qh,getSeedGroups:$h,getMatchUpContextIds:rI,getMatchUpParticipantIds:Gp,getMatchUpScheduleDetails:Vu,generateTieMatchUpScore:Zp,matchUpDuration:Eu,credits:SS};function dT({validation:e=!0,tournamentRecord:t,drawDefinition:n,participantId:r,structureId:i,seedValue:a,event:o}){if(!n)return{error:Y};if(!i)return{error:Te};const{structure:s}=rp({drawDefinition:n,structureId:i});if(!s)return{error:De};if(!(!e||U(a)||void 0===a||""===a||"string"==typeof a&&a.split("-").every((e=>U(e)&&m(e)>0))))return{error:xn};const{seedAssignments:c}=kp({drawDefinition:n,structure:s}),u=c?.map((e=>e.seedNumber)),d=c?.find((e=>e.participantId===r));if(d){const e="string"==typeof a?a.includes("-")&&a.split("-").map((e=>parseInt(e))).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=e}else{const e={seedNumber:Math.max(0,...u||[])+1,participantId:r};a&&(e.seedValue=a),s.seedAssignments||(s.seedAssignments=[]),s.seedAssignments.push(e)}return ol({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:n,structure:s}),{...L}}const pT={getAssignedParticipantIds:Hh,setStageAlternatesCount:function({alternatesCount:e,drawDefinition:t,stage:n}){return t?Ep({drawDefinition:t,stage:n})?(cp({attributes:[{[n]:{alternates:e}}],drawDefinition:t}),e||(t.entries=t.entries?.filter((e=>e.entryStatus!==dp))||[]),al({drawDefinition:t}),{...L}):{error:_e}:{error:Y}},setStageWildcardsCount:function({wildcardsCount:e=0,drawDefinition:t,stageSequence:n,stage:r}){if(!t)return{error:Y};if(!Ep({drawDefinition:t,stage:r}))return{error:_e};const i=Uw({drawDefinition:t,stage:r}),{qualifiersCount:a}=gw({drawDefinition:t,stageSequence:n,stage:r}),o=function({stage:e,drawDefinition:t}){return Cp({entryStatus:wp,drawDefinition:t,stage:e})}({drawDefinition:t,stage:r}),s=Fp({drawDefinition:t,stage:r});if(e<o){return{error:Object.assign(de,{message:"Number of Wildcards cannot be less than number of Wildcards already entered"})}}return s+e+a>i?{error:de,info:"Total stage Entries cannot be greater than drawPositions"}:(cp({attributes:[{[r]:{wildcardsCount:e}}],drawDefinition:t}),al({drawDefinition:t}),{...L})},setStageQualifiersCount:vw,modifySeedAssignment:dT,setStageDrawSize:yw,addDrawEntries:PP,addDrawEntry:wP,removeEntry:function({autoEntryPositions:e=!0,drawDefinition:t,participantId:n,stages:r}){return t?n?(Hh({drawDefinition:t,stages:r}).assignedParticipantIds??[]).includes(n)?{error:zt}:(t?.entries&&(t.entries=t.entries.filter((e=>e.participantId!==n))),e&&(t.entries=gP({entries:t.entries})),al({drawDefinition:t}),{...L}):{error:Lt}:{error:Y}},assignSeed:yy},lT={generateQualifyingLink:ZS,getStructureLinks:Rl},mT=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),fT=["drawId","structures"];function hT(e,t=!0){return e?"object"!=typeof e?{error:On}:e.drawId?function(e){const t=Object.keys(e);return fT.reduce(((e,n)=>!!t.includes(n)&&e),!0)}(e)?t?ii(e):e:{error:z}:{error:le,method:"setState"}:{error:Y}}function IT({drawId:e=Ii(),processCodes:t,matchUpType:n,drawType:r}){const i=mT();return Object.assign(i,{processCodes:t,matchUpType:n,drawType:r,drawId:e})}let gT,UT=[];const yT=function(){const e={getState:e=>({drawDefinition:ii(gT,e?.convertExtensions,!1,e?.removeExtensions)}),version:()=>"1.8.46",reset:()=>(gT=void 0,{...L}),newDrawDefinition:e=>(gT=IT({drawId:e?.drawId,drawType:e?.drawType}),{drawDefinition:ii(gT),drawId:gT.drawId,...L}),setDrawDescription:e=>gT?(gT.description=e?.description,al({drawDefinition:gT}),{drawId:gT.drawId,...L}):{error:Y}};return[lT,uT,jm,pT,oT,iT,BP,dP].forEach((n=>{Object.keys(n).forEach((r=>{e[r]=e=>{if(ar())return t({params:e,governor:n,methodName:r});try{return t({params:e,governor:n,methodName:r})}catch(i){Dr({engineName:"drawEngine",methodName:r,params:e,err:i})}}}))})),e.devContext=t=>(or(t),e),e.setParticipants=(t=[])=>(UT=t,e),e.setState=(t,n,r)=>{cr(n,r);return function(t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,gT=t,e.drawId=t.drawId),e}(hT(t))},e;function t({params:t,governor:n,methodName:r}){delete e.success,delete e.error;const i=t?.rollbackOnError&&ii(gT,!1,!0);t={...t,tournamentParticipants:UT,drawDefinition:gT};const a=n[r](t);if(a?.error)return i&&hT(i),{...a,rolledBack:!!i};const o=a?.success&&!0!==t?.delayNotify&&!0!==t?.doNotNotify;return o&&gU(),(o||!a?.success||t?.doNotNotify)&&fr(),a}}();const vT={modifyCollectionDefinition:Zy,orderCollectionDefinitions:nv,removeCollectionDefinition:ov,addCollectionDefinition:sv,removeCollectionGroup:pv,calculateWinCriteria:vh,addCollectionGroup:lv,modifyTieFormat:mv};function ST({matchUp:e}){const{extension:t}=lc({name:Bo,element:e});if(!t)return{error:Gn};const{history:n=[],undoHistory:r=[]}=t.value;return{history:n,undoHistory:r,...L}}function wT({undoHistory:e,history:t,matchUp:n}){return Js({element:n,extension:{value:{history:t,undoHistory:e},name:Bo}})}const PT={calculateHistoryScore:function({matchUp:e,updateScore:t}){const n=ST({matchUp:e})?.history||[];if(!Array.isArray(n))return{error:xn,info:"history is not an array"};const{matchUpFormat:r}=e;if(!r)return{error:ze};if(!Ti(r))return{error:He};const i=gi(r),{bestOf:a,finalSetFormat:o,setFormat:s}=i,c=["0","15","30","40","A","G"],u={sets:[]};let d,p,l=[],m=[0,0],f=1,h=0,I=0;const g=e=>[1,2].includes(e),U=()=>(h+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:h,games:[]});let y={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},v={winningSide:void 0,points:[]},w=U(),P=0;for(const T of n){P+=1,p=u.sets.length+1===a;const e=p&&o?o:s,{tiebreakAt:t,setTo:n,NoAD:r,tiebbreakFormat:i}=e,h=w.side1Score===t&&w.side1Score===w.side2Score,D=!!e.tiebreakSet,R=D?e.tiebreakSet:i,{tiebreakTo:b,NoAD:N}=R||{},M=()=>{d=void 0,m=[0,0],f=3-f,w.side1TiebreakScore=0,w.side2TiebreakScore=0,w.side1PointScore="",w.side2PointScore="",I=0},A=e=>{w.winningSide=e;const{s:t,...n}=w;u.sets.push(n),y={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},v={winningSide:void 0,points:[]},w=U(),M()},E=e=>{v.winningSide=e;const{g:t,...n}=v;w.games.push(n),y={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},v={winningSide:void 0,points:[]},M();w[`side${e}Score`]+=1},C=e=>{y.winningSide=e;const{p:t,...n}=y;v.points.push(n),y={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},I=0;const i=e-1;if(h||D){m[i]+=1,d=m.reduce(((e,t)=>e+t))%4/4>.5?f:3-f,w[`side${e}TiebreakScore`]=m[i],w[`side${3-e}TiebreakScore`]=m[1-i];const t=N?1:2;if(m[i]>=b&&m[i]>=m[1-i]+t)return E(e),{gameCompleted:!0}}else if(4===m[1-i]&&3===m[i]?m[1-i]-=1:m[i]+=1,w.side1PointScore=c[m[0]],w.side2PointScore=c[m[1]],5===m[i]||4===m[i]&&m[1-i]<3||r&&4===m[i])return E(e),{gameCompleted:!0}};if(g(T.srv)&&(f=T.srv),["p","s","g","o"].includes(T.u)&&l.push(T.u),T.shotOutcome){y.shots.push(T);if("SERVE"===T.shotType&&["OUT","NET"].includes(T.shotOutcome)&&(I+=1),2===I){C(3-f)}}if(g(T.p)||S(T.pointNumber)){const e=C(T.winningSide||T.p);if(e?.gameCompleted)continue}if(g(T.g)||S(T.gameNumber)){const e=T.winningSide||T.g;v.winningSide=e;const t=`side${e}Score`,i=`side${3-e}Score`;l.length&&(l.includes("p"),l=[]),E(e);if(w[t]===n&&w[t]-w[i]>=(r?1:2)&&(A(e),p))break}if(g(T.s)||S(T.setNumber)){if(A(T.winningSide||T.s),l.length&&(l.includes("p"),l.includes("g"),l=[]),p)break}}return P!==n.length&&console.log({error:"Match completed with excess history"}),(w.side1Score||w.side2Score||w.games.length||w.side1TiebreakScore||w.side2TiebreakScore)&&u.sets.push(w),u.scoreStringSide1=_l({...u,matchUpFormat:r}),u.scoreStringSide2=_l({...u,matchUpFormat:r,reversed:!0}),f=d||f,t&&(e.score=u),{...L,servingSide:f,score:u}},setServingSide:function({matchUp:e,sideNumber:t}){if(![1,2].includes(t))return{error:dt};const{history:n=[]}=ST({matchUp:e});return n.push({srv:t}),wT({matchUp:e,history:n})},clearHistory:function({matchUp:e}){return wT({matchUp:e})},addPoint:function({matchUp:e,point:t}){if(!t)return{error:mt};if("object"!=typeof t)return{error:xn,context:{point:t}};const{history:n=[]}=ST({matchUp:e});return n.push(t),wT({matchUp:e,history:n})},addGame:function({matchUp:e,game:t}){if("object"!=typeof t)return{error:xn,context:{game:t}};const{history:n=[]}=ST({matchUp:e});return n.push(t),wT({matchUp:e,history:n})},addShot:function({matchUp:e,shot:t}){if("object"!=typeof t)return{error:mt};const{history:n=[]}=ST({matchUp:e});return n.push(t),wT({matchUp:e,history:n})},addSet:function({matchUp:e,set:t}){if("object"!=typeof t)return{error:mt};const{history:n=[]}=ST({matchUp:e});return n.push(t),wT({matchUp:e,history:n})},redo:function({matchUp:e}){const{history:t=[],undoHistory:n=[]}=ST({matchUp:e});return n.length&&t.push(n.pop()),wT({matchUp:e,history:t,undoHistory:n})},undo:function({matchUp:e}){const{history:t=[],undoHistory:n=[]}=ST({matchUp:e});return n.push(t.pop()),wT({matchUp:e,history:t,undoHistory:n})},umo:{scoreboard:()=>{},addPoints:()=>{},addPoint:()=>{}}};function TT(e){const{matchUp:t,sideNumber:n,setNumber:r,isTiebreakValue:i,isPointValue:a}=e||{};let{matchUpFormat:o}=e||{};if(!t)return{error:et};o=o||t?.matchUpFormat;const s=gi(o),c=!!t?.winningSide,u=t.score?.sets,d=u?.length,p=r&&r-1,l=!!u?.find(((e,t)=>e.setNumber===r&&t===p)),m=u?.filter((e=>e?.winningSide))||[],f=m?.length||0,h=r&&u?.slice(r)||[],I=!!(d&&r&&h?.reduce(((e,t)=>(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e),!0)),g=r<=d&&u.find((e=>e.setNumber===r)),U=g&&Lm({setObject:g,matchUpScoringFormat:s}),{isCompletedSet:y,sideGameScores:v,sideTiebreakScores:S}=U||{},w=!!(g&&!y&&I||r&&r===d+1&&!c),P=[1,2].includes(n),T=P?n-1:0,D=g&&P&&(!i&&!a&&void 0!==v[T]&&v[T]||i&&void 0!==S[T]&&S[T]),b=!!D,N=m?.map((e=>Lm({setObject:e,matchUpScoringFormat:s}).isValidSetOutcome)).reduce(((e,t)=>e&&t),!0),M=m.reduce(((e,t)=>{const{winningSide:n}=t;return e[n-1]++,e}),[0,0]),A=t?.winningSide,E=A&&A-1,C=1-E,O=M[E],F=M[C],k=Math.max(...M),x=R(M)[k],{bestOf:_}=s||{},L=k===(_&&Math.ceil(_/2)||1)&&1===x&&M.indexOf(k)+1||void 0,B=O>F&&A===L;return{completedSetsHaveValidOutcomes:N,validMatchUpWinningSide:B,calculatedWinningSide:L,matchUpScoringFormat:s,validMatchUpOutcome:L&&N&&B,isLastSetWithValues:I,completedSetsCount:f,isCompletedMatchUp:c,isValidSideNumber:P,hasExistingValue:b,existingValue:D,isExistingSet:l,isActiveSet:w,...U}}const DT={tallyParticipantResults:Do,matchUpIsComplete:xa,analyzeMatchUp:TT,getMatchUpType:td,scoreHasValue:dl,validMatchUps:La,validMatchUp:_a};let RT,bT={};function NT(e,t=!0){if(!e)return{error:mt};if("object"!=typeof e)return{error:On};if(e.matchUpId)RT=e.matchUpId,bT[RT]=t?ii(e):e;else if(Array.isArray(e))for(const n of e.reverse())n.matchUpId&&(bT[n.matchUpId]=t?ii(n):n,RT||(RT=n.matchUpId));else for(const n of Object.values(e))n.matchUpId&&(bT[n.matchUpId]=t?ii(n):n,RT||(RT=n.matchUpId));return t?ii(e):e}function MT(){return bT[RT]}function AT(){return Object.values(bT)}function ET(){RT=void 0,bT={}}function CT(e){return ii(bT[RT],e?.convertExtensions,!1,e?.removeExtensions)}(()=>{const e={getState:e=>CT(e),version:()=>"1.8.46",reset:()=>(ET(),{...L}),drawId:void 0,error:void 0,success:!1,devContext:t=>(or(t),e),setState:(t,n,r)=>{cr(n,r);return function(t){t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,e.drawId=t.drawId);return e}(NT(t))}};return[vT,PT,DT,jm].forEach((n=>{Object.keys(n).forEach((r=>{e[r]=e=>{if(ar())return t({params:e,governor:n,methodName:r});try{return t({params:e,governor:n,methodName:r})}catch(i){Dr({engineName:"matchUpEngine",methodName:r,params:e,err:i})}}}))})),e;function t({params:t,governor:n,methodName:r}){e.error=void 0,e.success=!1;const i=t?.matchUp||MT(),a=t?.matchUps||AT(),o=t?.rollbackOnError&&ii(i,!1,!0);t={...t,matchUpId:i?.matchUpId,matchUps:a,matchUp:i};const s=n[r](t);if(s?.error)return o&&NT(o),{...s,rolledBack:!!o};const c=s?.success&&!0!==t?.delayNotify&&!0!==t?.doNotNotify;return c&&gU(),(c||!s?.success||t?.doNotNotify)&&fr(),s}})();function OT(e){const t=e||{};return t.tournamentId||(t.tournamentId=Ii()),(!t.startDate||Vr(t.startDate)||Rr.test(t.startDate))&&(!t.endDate||Vr(t.endDate)||Rr.test(t.endDate))?(t.extensions&&(t.extensions=t.extensions.filter(Ys)),{...t}):{error:yt}}function FT(e,t){if("object"!=typeof e)return{error:On};const n=e.unifiedTournamentId?.tournamentId||e.tournamentId;if(!n)return{error:H};const r=!1!==t?ii(e):e;return Sr({[n]:r}),wr(n),r}function kT({convertExtensions:e=!1,removeExtensions:t=!1,tournamentId:n}){if("string"!=typeof n)return{};return{tournamentRecord:ii(Ur(n),e,!1,t)}}function xT(e,t,n){if(t){const r=t.drawId||t.matchUp?.drawId;if(r){const{event:i,drawDefinition:a}=Qs({tournamentRecord:e,drawId:r});if(t={...t,event:i,drawDefinition:a},n){const e=_p({drawDefinition:a}),{matchUps:n}=Cl({inContext:!0,drawDefinition:a,matchUpsMap:e});t.matchUpsMap=e,t.inContextDrawMatchUps=n}}if(t.eventId&&!t.event){const{event:n}=Qs({eventId:t.eventId,tournamentRecord:e});n&&(t={...t,event:n})}}return t}function _T({derivedDrawInfo:e,participantId:t,drawId:n}){const r=e[n]?.mainPositionAssignments?.find((e=>e.participantId===t)),i=e[n]?.qualifyingPositionAssignments?.find((e=>e.participantId===t)),a={};if(r){const{participantId:e,...t}=r;e&&(a[nd]={...t})}if(i){const{participantId:e,...t}=i;e&&(a[rd]={...t})}return Object.keys(a).length?a:void 0}function LT({derivedDrawInfo:e,participantId:t,drawId:n}){const r=e[n]?.mainSeedAssignments?.find((e=>e.participantId===t)),i=e[n]?.qualifyingSeedAssignments?.find((e=>e.participantId===t)),a={};if(r){const{participantId:e,...t}=r;e&&(a[nd]={...t})}if(i){const{participantId:e,...t}=i;e&&(a[rd]={...t})}return Object.keys(a).length?a:void 0}function BT({scheduleAttributes:e=["scheduledDate","scheduledTime"],matchUps:t=[]}){if(!La(t))return{error:Ze};if(!Array.isArray(e))return{error:xn};const n=t.filter(Boolean).filter((({schedule:t})=>kv({schedule:t,scheduleAttributes:e}))).reduce(((e,t)=>{const{schedule:n}=t,r=Wr(n?.scheduledDate),i=$r(n?.scheduledTime);return r&&i&&(e[r]?e[r].push(t):e[r]=[t]),e}),{});return Object.keys(n).forEach((e=>{n[e].sort(((e,t)=>Kr($r(e.schedule?.scheduledTime),$r(t.schedule?.scheduledTime))))})),{scheduledMatchUps:n}}function VT(e){const t=[],n={},r={},i={},a=e=>{i[e]||(i[e]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},groups:[],teams:[],draws:{},losses:0,wins:0})},{tournamentRecord:o,participantFilters:s,allTournamentParticipants:c}=e,{relevantParticipantIdsMap:u}=function({processParticipantId:e,tournamentRecords:t,tournamentRecord:n}){if("object"!=typeof n&&"object"!=typeof t)return{error:$};const r=t?Object.values(t).map((e=>e?.participants||[])).flat():n?.participants??[];return{relevantParticipantIdsMap:Object.assign({},...r.map((({participantId:t,participantType:n,individualParticipantIds:r})=>("function"==typeof e&&e(t),{[t]:(r||[]).map((e=>({participantType:qu,relevantParticipantId:e}))).concat({relevantParticipantId:t,participantType:n})}))))}}({processParticipantId:a,tournamentRecord:o}),d=s?.participantIds,p=e=>{const t=e&&u[e]||[];return t.push(e),t.some((e=>!d||d.includes(e.relevantParticipantId)))?t:[]};return e.withGroupings&&c.forEach((e=>{if(e.participantType===$u){const t=e.participantId;e?.individualParticipantIds?.forEach((n=>{i[n].groupParticipantIds.includes(t)||(i[n].groupParticipantIds.push(t),i[n].groups.push({participantRoleResponsibilities:e.participantRoleResponsibilities,participantOtherName:e.participantOtherName,participantName:e.participantName,participantId:e.participantId}))}))}if(e.participantType===ji){const t=e.participantId;e?.individualParticipantIds?.forEach((n=>{i[n]?.teamParticipantIds?.includes(t)||(i[n]?.teamParticipantIds.push(t),i[n]?.teams.push({participantRoleResponsibilities:e.participantRoleResponsibilities,participantOtherName:e.participantOtherName,participantName:e.participantName,participantId:e.participantId,teamId:e.teamId}))}))}if(e.participantType===Wu){const t=e.participantId;e?.individualParticipantIds?.forEach((e=>{i[e]&&!i[e].pairParticipantIds.includes(t)&&i[e].pairParticipantIds.push(t)}))}})),e.withMatchUps&&bh({tournamentRecord:o}),(e.withScheduleItems||e.scheduleAnalysis||e.withStatistics||e.withOpponents||e.withMatchUps||e.withSeeding||e.withEvents||e.withDraws)&&e.tournamentEvents?.forEach((t=>{const d=ii(t,!0,!0),l=Ks({event:d}).flightProfile,m=l?.flights?.length||d.drawDefinitions?.length||0;(d.drawDefinitions||[]).forEach(((e,n)=>{if(d?.eventType===ji){const{extension:r}=Ms({element:t.drawDefinitions[n],name:_o});r&&(e.extensions=[r])}}));const{eventId:f,eventName:h,eventType:I,category:g}=d,U={eventId:f,eventName:h,eventType:I,category:g},y=d&&Object.keys(d).filter((e=>e.startsWith("_")));y?.forEach((e=>U[e]=d[e]));const v=d.entries||[],S=`${Uu}.${vu}`,{timeItem:w}=Yf({itemType:S,event:d});if(w?.itemValue?.PUBLIC){const{drawIds:e=[],seeding:t}=w.itemValue.PUBLIC||{},r={published:void 0,seedingScaleNames:[],drawIds:[]};t&&Object.assign(r,w.itemValue.PUBLIC.seeding),n[f]={publishedDrawIds:e,publishedSeeding:r}}const P=[...Object.values(Qo)].map((e=>`_${e}`)),T=U&&Object.keys(U).filter((e=>!P.includes(e))).reduce(((e,t)=>(e[t]=U[t],e)),{});v?.filter((e=>e?.participantId)).forEach((e=>{const{participantId:t,entryStage:n,entryStatus:r,entryPosition:o}=e,s=p(t);s?.forEach((({relevantParticipantId:e})=>{i[e]||a(e),i[e].events[f]={...T,partnerParticipantIds:[],entryPosition:o,entryStatus:r,entryStage:n,drawIds:[],eventId:f}}))}));const D=d.drawDefinitions?.map((({drawId:e})=>e))||[];U._flightProfile?.flights?.forEach((e=>{const{drawId:t,drawEntries:n}=e;D.includes(t)||n?.forEach((e=>(({drawEntry:e,drawId:t})=>{const{participantId:n,entryStage:a,entryStatus:o,entryPosition:s}=e,c=p(n);c?.forEach((({relevantParticipantId:e})=>{if(i[e].events[f]||(i[e].events[f]={...T,partnerParticipantIds:[],entryPosition:s,entryStatus:o,entryStage:a,drawIds:[],eventId:f}),!i[e].draws[t]){const n=_T({participantId:e,derivedDrawInfo:r,drawId:t}),c=LT({participantId:e,derivedDrawInfo:r,drawId:t});i[e].draws[t]=pi({qualifyingDrawSize:r[t]?.qualifyingDrawSize,drawSize:r[t]?.drawSize,partnerParticipantIds:[],positionAssignments:n,eventDrawsCount:m,seedAssignments:c,entryPosition:s,entryStatus:o,entryStage:a,eventId:f,drawId:t})}const n=i[e].events[f].drawIds;n&&!n?.includes(t)&&i[e].events[f].drawIds.push(t)}))})({drawEntry:e,drawId:t})))}));const{drawDetails:R,derivedInfo:b}=function({eventEntries:e,sortConfig:t,event:n}){const r={},i=Object.assign({},...(n.drawDefinitions??[]).map((i=>{const a=Object.assign({},...(e??[]).filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))),...i.entries.filter((e=>e.participantId)).map((e=>({[e.participantId]:e})))),o=Object.values(a),s=ip({stageSequence:1,drawDefinition:i,stage:nd})?.structures?.[0],c=s&&op({structure:s})?.positionAssignments,u=c?.length,d=ip({stageSequence:1,stage:rd,drawDefinition:i})?.structures?.[0],p=s&&op({structure:d})?.positionAssignments,l=p?.length,m=s?.seedAssignments,f=d?.seedAssignments,h=(i.structures||[]).sort(((e,n)=>tp(e,n,t))).map((({structureId:e,structures:t})=>[e,...(t||[]).map((({structureId:e})=>e))])).flat(1/0),I=n?._flightProfile?.flights?.find((e=>e.drawId===i.drawId))?.flightNumber;return r[i.drawId]={qualifyingPositionAssignments:p,qualifyingSeedAssignments:f,mainPositionAssignments:c,mainSeedAssignments:m,orderedStructureIds:h,qualifyingDrawSize:l,flightNumber:I,drawSize:u},{[i.drawId]:{drawType:i.drawType,drawEntries:o}}})));return{derivedInfo:r,drawDetails:i}}({eventEntries:v,event:d});if(Object.assign(r,b),d.eventType===ji||e.withScheduleItems||e.scheduleAnalysis||e.withStatistics||e.withOpponents||e.withMatchUps||e.withDraws){const t=ah({afterRecoveryTimes:e.scheduleAnalysis,participants:c,nextMatchUps:!0,tournamentRecord:o,inContext:!0,event:d})?.matchUps;t?.forEach((e=>function({relevantParticipantIdsMap:e,participantFilters:t,participantIdMap:n,derivedDrawInfo:r,eventDrawsCount:i,drawDetails:a,eventType:o,matchUp:s}){const{collectionId:c,collectionPosition:u,drawId:d,drawName:p,eventId:l,eventName:m,finishingRound:f,finishingPositionRange:h,processCodes:I,loserTo:g,matchUpId:U,matchUpType:y,matchUpFormat:v,matchUpStatus:S,matchUpStatusCodes:w,matchUpTieId:P,roundName:T,roundNumber:D,roundPosition:R,score:b,sides:N,stage:M,stageSequence:A,schedule:E,structureName:C,structureId:O,tieFormat:F,tieMatchUps:k,tournamentId:x,winnerTo:_,winningSide:L}=s,B=t?.participantIds,V=t=>{const n=t&&e[t]||[];return n.push(t),n.some((e=>!B||B.includes(e.relevantParticipantId)))?n:[]},{winner:j,loser:G}=h||{},q=k?.length&&k.filter((({matchUpType:e})=>e===Li)).map((({sides:e})=>e.map((({sideNumber:e,participantId:t,participant:n})=>e&&t&&{sideNumber:e,participantId:t,participant:n})))).flat().filter(Boolean)||[];if(o===Lu&&y===Li){const e=(s.sides?.filter(Boolean)||[]).map((({sideNumber:e,participantId:t,participant:n})=>e&&t&&{sideNumber:e,participantId:t,participant:n})).filter(Boolean);q.push(...e)}if(N?.forEach((t=>{const{participantId:h,sideNumber:k}=t;if(!h)return;const{drawType:B,drawEntries:$}=a[d],W=1===k?b?.scoreStringSide1:b?.scoreStringSide2,H=L&&k===L,z=s.sides.find((e=>e.sideNumber===3-k)),Y=z?.participantId,K=Y&&e[Y]||[],Q=H?j:G,J=$.find((e=>e.participantId===h)),X=V(h),Z=[];q?.filter((e=>e.sideNumber===k)).forEach((e=>{const t=e.participantId;t&&!Z.includes(t)&&(X.push({relevantParticipantId:t,participantType:Wu}),Z.push(t))}));const ee=X.filter((e=>o!==Lu||o===Lu&&[Li,Vi].includes(y)&&[Wu,zu].includes(e.participantType)||o===Lu&&[xi,Li].includes(y)&&[qu].includes(e.participantType)));ee?.forEach((({relevantParticipantId:e,participantType:t})=>{const{entryStage:a,entryStatus:s,entryPosition:h}=J||{};if(!n[e])return;if(!n[e].draws[d]){const t=_T({participantId:e,derivedDrawInfo:r,drawId:d}),i=LT({participantId:e,derivedDrawInfo:r,drawId:d});n[e].draws[d]=pi({qualifyingDrawSize:r[d]?.qualifyingDrawSize,drawSize:r[d]?.drawSize,partnerParticipantIds:[],positionAssignments:t,seedAssignments:i,entryPosition:h,entryStatus:s,entryStage:a,drawName:p,drawType:B,eventId:l,drawId:d})}n[e].events[l]||(n[e].events[l]={partnerParticipantIds:[],drawIds:[],eventName:m,eventId:l});const k=n[e].events[l].drawIds;let V;if(k&&!k?.includes(d)&&n[e].events[l].drawIds.push(d),t===qu&&y===Li){const t=ee.find((t=>t.relevantParticipantId!==e&&t.participantType===qu));V=t?.relevantParticipantId}const j=K?.filter((e=>y===Vi&&t===zu&&e.participantType===zu||y===xi&&e.participantType===qu||y===Li&&(t===qu?[qu,Wu].includes(e.participantType):e.participantType===Wu)))||[];j.forEach((({relevantParticipantId:t,participantType:r})=>{n[e].opponents||(n[e].opponents={}),n[e].opponents[t]={eventId:l,drawId:d,matchUpId:U,participantType:r,participantId:t}}));const G=j.map((({relevantParticipantId:e,participantType:t})=>({participantId:e,participantType:t})));(y!==Vi&&[qu,Wu].includes(t)||y===Vi&&t===zu)&&(n[e].matchUps[U]=pi({collectionId:c,collectionPosition:u,drawId:d,eventId:l,eventType:o,eventDrawsCount:i,finishingRound:f,finishingPositionRange:Q,loserTo:g,matchUpId:U,matchUpType:y,matchUpFormat:v,matchUpStatus:S,matchUpStatusCodes:w,matchUpTieId:P,opponentParticipantInfo:G,participantWon:H,partnerParticipantId:V,perspectiveScoreString:W,processCodes:I,roundName:T,roundNumber:D,roundPosition:R,schedule:E,score:b,sides:N,stage:M,stageSequence:A,structureName:C,structureId:O,tieFormat:F,tournamentId:x,winnerTo:_,winningSide:L})),V&&(n[e].events[l].partnerParticipantIds.push(V),n[e].draws[d].partnerParticipantIds.push(V),n[e].events[l].partnerParticipantId=V,n[e].draws[d].partnerParticipantId=V),L&&(H?n[e].wins++:n[e].losses++)}))})),Array.isArray(s.potentialParticipants)){const e=vl(s.potentialParticipants.flat());e?.forEach((e=>{const t=V(e);t?.forEach((({relevantParticipantId:e})=>{n[e].potentialMatchUps[U]=pi({drawId:d,eventId:l,eventType:o,matchUpId:U,matchUpType:y,matchUpFormat:v,roundName:T,roundNumber:D,roundPosition:R,schedule:E,tieFormat:F,structureName:C,tournamentId:x,potential:!0})}))}))}}({relevantParticipantIdsMap:u,participantFilters:s,participantIdMap:i,derivedDrawInfo:r,eventDrawsCount:m,drawDetails:R,eventType:I,matchUp:e})))}})),e.tournamentParticipants?.forEach((a=>{const{scheduleConflicts:o,scheduleItems:s}=function(e){const{withScaleValues:t=!0,eventsPublishStatuses:n,withEvents:r=!0,withDraws:i=!0,participantIdMap:a,scheduleAnalysis:o,derivedDrawInfo:s,usePublishState:c,withStatistics:u,withOpponents:d,withMatchUps:p,withSeeding:l,participant:m,withISO2:f,withIOC:h}=e,I=[],g=[];if((h||f)&&Hf({participant:m,withIOC:h,withISO2:f}),t){const{ratings:e,rankings:t}=Ds({participant:m});m.rankings=t,m.ratings=e}const U=m?.participantId;if(!U||!a[U])return{};const{potentialMatchUps:y,opponents:v,matchUps:S,events:w,losses:P,draws:T,wins:D}=a[U],R=D+P,b={statCode:as,denominator:R,numerator:D,statValue:R&&D/R},N=Object.values(T),M=Object.values(w);if(i&&N){m.draws=N;for(const e of N){const t=n[e.eventId]?.publishedSeeding;if(!c||t?.published&&(0===t?.drawIds?.length||t?.drawIds?.includes(e.drawId))){const t=LT({drawId:e.drawId,derivedDrawInfo:s,participantId:U});t&&(e.seedAssignments=t)}}}if(r&&M&&(m.events=M,l)){const e=Object.assign({},...(m.timeItems||[]).filter((({itemType:e})=>e.split(".")[1]===Ps)).map((({itemType:e,itemValue:t})=>({[e]:t}))));for(const t of M){const r=e=>[ws,Ps,t.eventType,e].join("."),i=n[t.eventId]?.publishedSeeding,a=(i?.stageSeedingScaleNames&&Object.values(i?.stageSeedingScaleNames)||Array.isArray(i?.seedingScaleNames)&&i.seedingScaleNames||[]).map(r),o=O(Object.keys(e),a),u=!(c&&(Object.keys(e).length||i?.drawIds?.length)&&!o.length);if(u&&o.length){if(i?.stageSeedingScaleNames){const n=Object.keys(i.stageSeedingScaleNames).map((t=>{const n=r(i.stageSeedingScaleNames[t]);return[t,e[n]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),a=Object.assign({},...n);t.seedAssignments=a}else if(o){const n=o.map((t=>e[t]));t.seedValue=n.pop()}}else if(c||"object"!=typeof l){const{categoryName:e,ageCategoryCode:n}=t.category||{};let r;for(const i of[t.eventId,n,e]){const e=zh({scaleAttributes:{eventType:t.eventType,scaleType:Ps,scaleName:i},participant:m});if(e.scaleItem){r=e.scaleItem;break}}if(r){const e=r.scaleValue;(!c||i?.published&&(0===i?.drawIds?.length||i?.drawIds?.includes(t.drawId)))&&(t.seedValue=e)}}else{const n=Object.keys(l).map((t=>{const n=r(l[t]);return[t,e[n]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),i=Object.assign({},...n);t.seedAssignments=i}if(t.drawIds?.length)for(const e of t.drawIds||[]){const n=i?.drawIds?.length&&!i?.drawIds?.includes(e);if(u&&!n){const n=LT({drawId:e,derivedDrawInfo:s,participantId:U});if(n&&t.seedAssignments)for(const e of Object.keys(t.seedAssignments))t.seedAssignments[e]=n[e];else t.seedAssignments=n}}}}const A=Object.values(v).flat();d&&A?.length&&(m.opponents=A,N?.forEach((e=>{e.opponents=A.filter((t=>t.drawId===e.drawId))})));const E=Object.values(y),C=Object.values(S);p&&(m.potentialMatchUps=E,m.matchUps=C);const F=C.concat(E),k=BT({matchUps:F})?.scheduledMatchUps??[],{scheduledMinutesDifference:x}=o||{};return Object.keys(k).forEach((e=>{k[e].filter(Boolean).forEach(((t,n)=>{const{schedule:{scheduledTime:r,timeAfterRecovery:i,typeChangeTimeAfterRecovery:a},matchUpStatus:o,roundPosition:s,structureName:c,matchUpType:u,roundNumber:d,matchUpId:p,drawId:l,score:m}=t;g.push({...t.schedule,scheduledTime:$r(t.schedule?.scheduledTime),roundPosition:s,structureName:c,matchUpType:u,roundNumber:d,matchUpId:p,drawId:l});const f=o===ma||[Ra,ga].includes(o)&&!dl({score:m});if(r&&!f){const o=Gr(r),s=k[e].slice(n+1);for(const e of s)if(e.matchUpStatus!==ma&&(![Ra,ga].includes(e.matchUpStatus)||dl(e))&&e.schedule?.scheduledTime){const n=t.matchUpType!==e.matchUpType&&a||i,r=t.drawId===e.drawId,s=t.potential&&e.potential,c=Gr(e.schedule?.scheduledTime)-o;!(x&&!isNaN(x)?c<=x:Gr(n)>Gr(e.schedule?.scheduledTime))||s&&r||I.push({priorScheduledMatchUpId:e.matchUpId,matchUpIdWithConflict:p})}}}))})),u&&(m.statistics=[b]),{scheduleConflicts:I,scheduleItems:g}}({...e,eventsPublishStatuses:n,participantIdMap:i,derivedDrawInfo:r,participant:a});if(e.withSignInStatus){const{timeItem:e}=zf({itemType:Gu,element:a});a.signedIn=e?.itemValue===Yu}if(e.withScheduleItems&&(a.scheduleItems=s),e.scheduleAnalysis&&(a.scheduleConflicts=o,o?.length&&!t.includes(a.participantId)&&t.push(a.participantId)),!1!==e.withGroupings){const e=i[a.participantId];a.groupParticipantIds=e?.groupParticipantIds,a.pairParticipantIds=e?.pairParticipantIds,a.teamParticipantIds=e?.teamParticipantIds,a.groups=e?.groups,a.teams=e?.teams}e.withTeamMatchUps})),{participantIdsWithConflicts:t,eventsPublishStatuses:n}}const jT="COMPETITOR",GT="OTHER",qT={ADMINISTRATION:"ADMINISTRATION",CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR:jT,MEDIA:"MEDIA",MEDICAL:"MEDICAL",OFFICIAL:"OFFICIAL",OTHER:GT,SECURITY:"SECURITY"};function $T({individualParticipantIds:e,groupingParticipantId:t,removeFromOtherTeams:n,tournamentRecord:r}){const i="addIndividualParticipantIds";if(!r)return Mi({result:{error:$},stack:i});if(!t||!e)return Mi({result:{error:mt},stack:i});const a=r.participants??[],o=a.find((e=>e.participantId===t));if(!o)return Mi({result:{error:Bt},stack:i});if(o?.participantType&&![Hu,$u].includes(o.participantType))return Mi({context:{participantType:o.participantType},result:{error:Ft},stack:i});const s=e.filter((e=>{const t=a.find((t=>t.participantId===e));return t?.participantType!==qu}));if(s.length)return Mi({result:{error:Ct,invalidParticipantIds:s},stack:i});o.individualParticipantIds||(o.individualParticipantIds=[]);const c=o.individualParticipantIds,u=e.filter((e=>!c.includes(e)));u.length&&(n&&AP({individualParticipantIds:u,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));const{topics:d}=hr();if(d.includes(Nc)){const e=a.find((({participantId:e})=>e===t));pr({topic:Nc,payload:{participants:[e]}})}return function({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:n}){const r=(n.events||[]).filter((e=>e?.eventType===_u&&e?.entries?.some((e=>e.participantId===t)))),i=t=>!e.includes(t.participantId);for(const a of r){a.entries=(a.entries||[]).filter(i);const{flightProfile:e}=Ks({event:a});e?.flights?.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter(i)})),a?.drawDefinitions?.forEach((e=>{e.entries=(e.entries||[]).filter(i)}))}}({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:r}),{groupingParticipant:ii(o,!1,!0),added:u.length,...L}}function WT({addParticipants:e=!0,participantAttribute:t,tournamentRecord:n,personAttribute:r,teamNames:i,accessor:a,uuids:o}){if(!n)return{error:$};const s={},c=(n.participants??[]).filter((({participantType:e,participantRole:t})=>e===qu&&t===jT));let u=0;for(const f of c){const e=a&&oi({element:f,accessor:a})?.value||r&&f.person?.[r]||t&&f[t];if(e){if(!Object.keys(s).includes(e)){s[e]={participantName:i?.[u]??e,participantId:o?.pop()??Ii(),individualParticipantIds:[],participantRole:jT,participantType:Hu};const n={value:r??t,name:xo};Js({element:s[e],extension:n}),u+=1}s[e].individualParticipantIds.push(f.participantId)}}const d=Object.keys(s),p=(n.participants??[]).map((e=>{if(e.participantType!==Hu)return;if(e.participantRole!==jT)return;const{extension:t}=lc({name:xo,element:e}),n=t?.value;return d.includes(n)?e.participantId:void 0})).filter(Boolean);let l=0;const m=[];return Object.keys(s).forEach((t=>{const r=s[t],{participantId:i}=r;p.includes(i)||(n.participants||(n.participants=[]),e&&n.participants.push(r),m.push(r),l++)})),e&&l?(pr({payload:{tournamentId:n.tournamentId,participants:m},topic:Ic}),{...L,participantsAdded:l}):m.length?{...L,newParticipants:m}:{error:Dt}}function HT({personFormat:e,person:t}){const n=e=>e.replace(/\W/g,""),r=e=>e.toLowerCase().indexOf("l")<e.toLowerCase().indexOf("f"),i=e=>e.indexOf(",")>=0;if(!t)return;const a=e.indexOf(" ")>0?" ":"";let o=Fh(t?.standardGivenName??""),s=Fh(t?.standardFamilyName??"");if(!e)return`${o}${a}${s}`;!(e=>e.toLowerCase().indexOf("f.")>=0)(e)||i(e)||r(e)||(o=`${o[0]}.`),(e=>/^[a-z]*$/.test(n(e)))(e)?(o=o.toLowerCase(),s=s.toLowerCase()):(e=>/^[A-Z]*$/.test(n(e)))(e)?(o=o.toUpperCase(),s=s.toUpperCase()):(e=>/^[LAST]{4}/.test(n(e)))(e)&&(s=s.toUpperCase());let c=`${o}${a}${s}`;return(e=>e.toLowerCase().indexOf("f")<0)(e)?c=s:r(e)&&(c=i(e)?`${s},${a}${o}`:`${s}${a}${o}`),c}function zT({participantMap:e,participant:t,formats:n}){const{participantType:r,individualParticipantIds:i,person:a}=t,o=r&&n[r];if(r!==zu&&o){const{personFormat:n,doublesJoiner:s}=o;r===qu&&(t.participantName=HT({person:a,personFormat:n})),r===Wu&&(t.participantName=i?.map((t=>{const r=e[t]?.person;return HT({person:r,personFormat:n})})).filter(Boolean).join(s??"/"))}}function YT(e){const{updateParticipantName:t=!0,groupingParticipantId:n,removeFromOtherTeams:r,tournamentRecord:i,pairOverride:a,participant:o}=e;if(!i)return{error:$};if(!o)return{error:xt};if(!o.participantId)return By({tournamentRecord:i,participant:o});const{participant:s}=bs({participantId:o.participantId,tournamentRecord:i});if(!s)return By({tournamentRecord:i,participant:o});const{participantRoleResponsibilties:c,individualParticipantIds:u,participantOtherName:d,participantName:p,participantRole:l,participantType:m,onlineResources:f,contacts:h,person:I}=o;if(m&&s.participantType!==m)return{error:bt};const g={};if(h&&(g.contacts=h),f&&(g.onlineResources=f),p&&"string"==typeof p&&(g.participantName=p),d&&"string"==typeof d&&(g.participantOtherName=d),Array.isArray(u)){const{participants:e}=Kg({participantFilters:{participantTypes:[Qu.INDIVIDUAL]},tournamentRecord:i}),n=e?.map(Sl);if(n){const r=u.filter((e=>"string"==typeof e&&n.includes(e)));([$u,ji].includes(m||s.participantType)||m===Wu&&(2===r.length||a))&&(g.individualParticipantIds=r),s.participantType===Qu.PAIR&&t&&(g.participantName=function({individualParticipants:e,newValues:t}){const n=t.individualParticipantIds;let r=e.filter((({participantId:e})=>n.includes(e))).map((({person:e})=>e?.standardFamilyName)).filter(Boolean).sort().join("/");1===n.length&&(r+="/Unknown");return r}({individualParticipants:e,newValues:g}))}}return Object.keys(qT).includes(l)&&(g.participantRole=l),Object.keys(Qu).includes(m)&&(g.participantType=m),Array.isArray(c)&&(g.participantRoleResponsibilties=c),s.participantType===Qu.INDIVIDUAL&&I&&function({updateParticipantName:e,existingParticipant:t,newValues:n,person:r}){const i={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:c,sex:u}=r;u&&Object.keys(ki).includes(u)&&(i.sex=u);let d;c&&"string"==typeof c&&(i.personId=c);s&&"string"==typeof s&&(p=s,Gm.flatMap((({iso:e,ioc:t})=>[e,t])).filter(Boolean).includes(p)||""===s)&&(i.nationalityCode=s);var p;a&&"string"==typeof a&&a.length>1&&(i.standardFamilyName=a,d=!0);o&&"string"==typeof o&&o.length>1&&(i.standardGivenName=o,d=!0);if(d&&e){const e=`${i.standardGivenName} ${i.standardFamilyName}`;n.participantName=e}Object.assign(t.person,i)}({updateParticipantName:t,existingParticipant:s,newValues:g,person:I}),Object.assign(s,pi(g)),n&&$T({individualParticipantIds:[s.participantId],groupingParticipantId:n,removeFromOtherTeams:r,tournamentRecord:i}),pr({topic:Nc,payload:{tournamentId:i.tournamentId,participants:[s]}}),{participant:ii(s),...L}}function KT({drawDefinition:e,timeItem:t}){if(!e)return{error:Q};if(!t)return{error:wn};const n=t&&Object.keys(t),r=["itemType","itemValue"];if(!(r.filter((e=>n.includes(e))).length===r.length))return{error:vn};e.timeItems||(e.timeItems=[]);const i=(new Date).toISOString();return Object.assign(t,{createdAt:i}),e.timeItems.push(t),il({drawDefinition:e}),{...L}}function QT(e){const{removePriorValues:t,tournamentRecord:n,participantId:r,scaleItem:i}=e;let a,o;if(!JT({scaleItem:i}))return{error:Rn};if(r&&Array.isArray(n.participants)&&(o=n.participants.find((e=>e.participantId===r)),o)){const e=XT({removePriorValues:t,participant:o,scaleItem:i});if(e.error)return e;a=!e.valueChanged;const{topics:r}=hr();r.includes(Nc)&&pr({topic:Nc,payload:{tournamentId:n.tournamentId,participants:[o]}})}return a&&{...L,info:jn,existingValue:i?.scaleValue}||o&&{...L,newValue:i?.scaleValue}||{error:Bt}}function JT({scaleItem:e}){const t=e&&Object.keys(e),n=["scaleType","eventType","scaleName"];return!!(n.filter((e=>t?.includes(e))).length===n.length)}function XT({removePriorValues:e,participant:t,scaleItem:n}){if(!t)return{error:xt};const r=n&&Object.keys(n),i=["scaleType","eventType","scaleName"];if(!(i.filter((e=>r.includes(e)&&n[e])).length===i.length))return{error:Rn};const a=(new Date).toISOString();t.timeItems||(t.timeItems=[]);const{scaleItem:o}=zh({scaleAttributes:n,participant:t}),s=e=>[void 0,null,""].includes(e),c=!(s(o?.scaleValue)&&s(n.scaleValue))&&JSON.stringify(o?.scaleValue)!==JSON.stringify(n.scaleValue);if(c){const{scaleType:r,eventType:i,scaleName:o}=n,s=[ws,r,i,o].join("."),c=pi({itemValue:n.scaleValue,itemDate:n.scaleDate,createdAt:a,itemType:s});n.scaleId&&(c.itemSubTypes=[n.scaleId]),e&&(t.timeItems=t.timeItems.filter((e=>e.itemType!==s))),t.timeItems.push(c)}return{...L,valueChanged:c,newValue:n.scaleValue}}const ZT={getTournamentPenalties:$y,modifyPenalty:Wy,removePenalty:qy,addPenalty:Gy,createGroupParticipant:function({individualParticipantIds:e=[],participantRoleResponsibilities:t,participantRole:n=GT,tournamentRecord:r,participantId:i,groupName:a}){if(!r)return{error:$};if(!a)return{error:mt,info:"Missing groupName"};if(!Array.isArray(e))return{info:"Invalid individualParticipantIds",error:xn};const o=(Kg({participantFilters:{participantTypes:[qu]},tournamentRecord:r}).participants??[]).map((e=>e.participantId));for(const d of e)if(!o.includes(d))return{error:Ft,participantId:d};const s=pi({participantId:i||Ii(),participantRoleResponsibilities:t,participantName:a,individualParticipantIds:e,participantType:$u,participantRole:n}),c=By({participant:s,tournamentRecord:r});if(c.error)return c;const{topics:u}=hr();return u.includes(Ic)&&pr({topic:Ic,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...L,participant:ii(s)}},scaledTeamAssignment:function({clearExistingAssignments:e=!0,individualParticipantIds:t,reverseAssignmentOrder:n,initialTeamIndex:r=0,scaledParticipants:i=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:c,teamsCount:u,eventId:d,event:p}){if(!o)return{error:$};if(!Array.isArray(a)&&!S(u)&&!d||!S(r)||i&&!Array.isArray(i)||s&&("object"!=typeof s||!Object.keys(s).length))return{error:xn};if(!s&&!i.length||!i&&(!t||!s))return{error:mt,info:"Missing scaling details"};if(d&&!a){if(p?.eventType!==Lu)return{error:Me};a=p?.entries?.filter((({entryStatus:e})=>e===lp)).map(Sl)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:mt};let l=t??i.map((({participantId:e})=>e));n&&(a?.reverse(),r+=1),r>(a?.length||0)-1&&(r=0);const m=a?.slice(r).concat(...a.slice(0,r))??[],f=[];for(const g of o.participants??[]){const{participantId:e,participantType:t}=g;if(m.includes(e)){if(t!==zu)return{error:Ft,participant:g};f.push(g)}}if(u&&f.length<u){const e=c??"Team",t=E(0,u-(f?.length||0)).map((t=>({participantName:`${e} ${t+1}`,participantType:zu,participantRole:jT}))),{participants:n=[]}=Vy({participants:t,returnParticipants:!0,tournamentRecord:o}),r=n.map(Sl),i=o.participants?.filter((({participantId:e})=>r.includes(e)))??[];f.push(...i)}if(!f.length)return{error:Ln};if(e)for(const g of f)g.individualParticipantIds=[];else{const e=f.map((e=>e)).flat();t?.length?l=l.filter((t=>!e.includes(t))):i=i?.filter((({participantId:t})=>!e.includes(t)))}if(!t?.length&&!i?.length)return{error:An,info:"Nothing to be done"};if(!i.length){for(const e of o.participants??[]){const{participantId:t,participantType:n}=e;if(!l.includes(t))continue;if(n!==qu)return{error:Ft,participant:e};const r=zh({scaleAttributes:s,participant:e})?.scaleItem,a={participantId:t,scaleValue:s?.accessor?r?.scaleValue?.[s?.accessor]:r?.scaleValue};i.push(a)}if(!i.length)return{error:Bt}}i.sort(((e,t)=>s?.sortOrder?(t?.scaleValue||0)-(e?.scaleValue||0):(e?.scaleValue||1/0)-(t?.scaleValue||1/0)));for(const g of i)if(!g.participantId)return{error:xn,scaledParticipant:g};let h=0;for(;h<i.length;){for(const e of f){if(h+1>i.length)break;const t=i[h];e.individualParticipantIds.push(t.participantId),h++}f.reverse()}const I=f.map(Sl);for(const g of o.events??[]){if(g.eventType!==Lu)continue;const e=(g.entries??[]).filter((e=>I.includes(e.participantId)));for(const t of e){const e=t.participantId,n=f.find((t=>t.participantId===e)),r=n?.individualParticipantIds;g.entries=(g.entries??[]).filter((e=>!r.includes(e.participantId))),(g.drawDefinitions??[]).forEach((e=>{e.entries=(e.entries??[]).filter((e=>!r.includes(e.participantId)))}));const{flightProfile:i}=Ks({event:g});(i?.flights||[]).forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!r.includes(e.participantId)))}))}}return{...L,scaledParticipants:i}},deleteParticipants:EP,addParticipants:Vy,addParticipant:By,addPersons:function({participantRole:e=jT,tournamentRecord:t,persons:n}){if(!t)return{error:$};if(!Array.isArray(n))return{error:xn};if(!Object.keys(qT).includes(e))return{error:Ot};const r=(t.participants||[]).map((({person:e})=>e?.personId)).filter(Boolean),i=[],a=n.filter((e=>e&&(!e.personId||!r.includes(e.personId)))).map((e=>(e.personId||(e.personId=Ii()),i.push(e.personId),e)));let o=0,s=0,c=Vy({participants:a.map((t=>{return pi({extensions:t.participantExtensions,timeItems:t.participantTimeItems,participantType:qu,participantRole:e,person:(n=t,r=["participantExtensions","participantTimeItems","pairedPersons"],Object.assign({},...Object.keys(n).filter((e=>!r.includes(e))).map((e=>({[e]:n[e]})))))});var n,r})),tournamentRecord:t});if(c.error)return c;s=c.addedCount||0;const u=[],d=Kg({participantFilters:{participantTypes:[qu]},tournamentRecord:t})?.participants??[];if(e===jT&&n.filter((({pairedPersons:e})=>e)).forEach((({personId:e,pairedPersons:t})=>{Array.isArray(t)&&t.forEach((t=>{const n=[e,t.personId].map((e=>Rs({tournamentParticipants:d,personId:e}))).filter(Boolean);if(2===n.length){const e=n.map(Sl);u.push(pi({extensions:t.participantExtensions,timeItems:t.timeItems,participantRole:jT,individualParticipantIds:e,participantType:Wu}))}}))})),u.length){if(c=Vy({participants:u,tournamentRecord:t}),c.error)return c;o=c.addedCount||0}const p=s+o;return{...L,addedCount:p,newPersonIds:i}},addIndividualParticipantIds:$T,removeIndividualParticipantIds:NP,modifyIndividualParticipantIds:function({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:n}){const r="modifyIndividualParticipantIds";if(!n)return Mi({result:{error:$},stack:r});if(!t||!e)return Mi({result:{error:mt},stack:r});const i=n.participants||[],a=i.find((e=>e.participantId===t));if(!a)return Mi({result:{error:Bt},stack:r});if(![Hu,$u].includes(a.participantType))return Mi({result:{error:Ft},context:{participantType:a.participantType},stack:r});const o=e.filter((e=>{const t=i.find((t=>t.participantId===e));return t?.participantType!==qu}));if(o.length)return Mi({result:{error:Ct,invalidParticipantIds:o},stack:r});const s=a.individualParticipantIds||[],c=e.filter((e=>!s.includes(e))),u=s.filter((t=>!e.includes(t))),d=$T({individualParticipantIds:c,groupingParticipantId:t,tournamentRecord:n});if(d.error)return Mi({result:d,stack:r});const p=NP({individualParticipantIds:u,groupingParticipantId:t,tournamentRecord:n});if(p.error)return Mi({result:p,stack:r});const{topics:l}=hr();if(l.includes(Nc)){const e=i.find((({participantId:e})=>e===t));pr({topic:Nc,payload:{tournamentId:n.tournamentId,participants:[e]}})}return{...d,...p}},removeParticipantIdsFromAllTeams:AP,getParticipantMembership:function({tournamentRecord:e,participantId:t}){if(!e)return{error:$};if(!t)return{error:Lt};const{participants:n}=Kg({participantFilters:{participantTypes:[Hu,Wu,$u]},tournamentRecord:e});return(n??[]).filter((e=>e.individualParticipantIds?.includes(t))).reduce(((e,t)=>{const n=t.participantType;return n&&(e[n]||(e[n]=[]),e[n].push(t)),e}),{})},generateTeamsFromParticipantAttribute:WT,regenerateParticipantNames:function({tournamentRecord:e,formats:t}){if(!e)return{error:$};if(!ci(t))return{error:mt};const n=e.participants??[],r=ui(n,"participantId");for(const i of n)zT({participant:i,participantMap:r,formats:t});return{...L}},getParticipantIdFinishingPositions:function({tournamentRecord:e,drawDefinition:t,byeAdvancements:n=!1}){return e?cT({tournamentParticipants:e.participants,byeAdvancements:n,drawDefinition:t}):{error:$}},modifyParticipant:YT,modifyParticipantName:function({tournamentRecord:e,participantName:t,participantId:n}){if(!e)return{error:$};if(!n)return{error:Lt};if(!t)return{error:mt,info:"Missing participantName"};const{participant:r}=bs({tournamentRecord:e,participantId:n});if(!r)return{error:Bt};r.participantName=t;const{topics:i}=hr();return i.includes(Nc)&&pr({topic:Nc,payload:{tournamentId:e.tournamentId,participants:[r]}}),{...L}},modifyParticipantOtherName:function({tournamentRecord:e,participantId:t,participantOtherName:n}){if(!e)return{error:$};if(!t)return{error:Lt};const{participant:r}=bs({tournamentRecord:e,participantId:t});if(!r)return{error:Bt};r.participantOtherName=n;const{topics:i}=hr();return i.includes(Nc)&&pr({topic:Nc,payload:{tournamentId:e.tournamentId,participants:[r]}}),{...L}},mergeParticipants:function({participants:e=[],tournamentRecord:t,arraysToMerge:n}){if(!t)return{error:$};t.participants||(t.participants=[]);const r=e.filter(hl).map((e=>({[e.participantId]:e}))),i=Object.assign({},...r),a=[];t.participants=t.participants.map((e=>{if(i[e.participantId]){const t=Qg(e,i[e.participantId],n);return a.push(t),t}return e}));const o=t.participants.map(Sl),s=e.filter((({participantId:e})=>!o.includes(e))),{topics:c}=hr();return s.length&&(t.participants=t.participants.concat(...s),c.includes(Ic)&&pr({topic:Ic,payload:{participants:s}})),a.length&&c.includes(Nc)&&pr({topic:Nc,payload:{tournamentId:t.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...L}},getPairedParticipant:Xu,filterParticipants:jg,setParticipantScaleItem:QT,setParticipantScaleItems:function(e){const{scaleItemsWithParticipantIds:t=[],removePriorValues:n,tournamentRecord:r,auditData:i,context:a}=e;if(!r)return{error:$};if(!r.participants)return{error:_t};let o=0;const s={},c=[];for(const p of t){const e=p?.participantId;if(Array.isArray(p?.scaleItems))for(const t of p.scaleItems){if(!JT({scaleItem:t}))return{error:Rn};Array.isArray(s[e])||(s[e]=[]),s[e].push(t)}}r.participants.forEach((e=>{const{participantId:t}=e||{};Array.isArray(s[t])&&s[t].forEach((t=>{XT({participant:e,scaleItem:t,removePriorValues:n}),c.push(e),o++}))}));const u=o?void 0:Nn,{topics:d}=hr();if(d.includes(Nc)&&o&&pr({topic:Nc,payload:{tournamentId:r.tournamentId,participants:c}}),a){const{eventId:e,drawId:t,...n}=a,i=n.scaleAttributes?.scaleType&&[n.scaleAttributes.scaleType];if(Object.keys(n).length){const a={itemType:gc,itemValue:n};if(i&&(a.itemSubTypes=i),t||e){const{drawDefinition:n,event:i}=Qs({tournamentRecord:r,eventId:e,drawId:t});t&&KT({drawDefinition:n,timeItem:a}),e&&PU({event:i,timeItem:a})}else wU({tournamentRecord:r,timeItem:a})}}return i&&d.includes(yc)&&pr({topic:yc,payload:i}),pi({...L,modificationsApplied:o,info:u})},modifyParticipantsSignInStatus:function({tournamentRecord:e,participantIds:t,signInState:n}){if(!e)return{error:$};if(!Array.isArray(t))return{error:mt};if(![Yu,Ku].includes(n))return{error:xn,signInState:n};const r=e.participants||[];if(!r.length)return{error:_t};const i=r.map(Sl),a=t.filter((e=>!i.includes(e)));if(a.length)return{error:xn,context:{invalidParticipantIds:a}};const o=[],s=(new Date).toISOString();for(const u of r){const{participantId:r}=u;if(t.includes(r)){const t=SU({duplicateValues:!1,tournamentRecord:e,participantId:r,timeItem:{itemType:Gu,itemValue:n,createdAt:s}});if(t.error)return t;o.push(u)}}const{topics:c}=hr();return o.length&&c.includes(Nc)&&pr({topic:Nc,payload:{tournamentId:e.tournamentId,participants:o}}),{...L}},getParticipantEventDetails:function({tournamentRecord:e,participantId:t}){if(!e)return{error:$};if(!t)return{error:Lt};const n=[t].concat((e.participants??[]).filter((e=>e?.participantType&&[Hu,Wu].includes(e.participantType)&&e.individualParticipantIds?.includes(t))).map((e=>e.participantId)));return{eventDetails:(e.events??[]).filter((e=>k((e?.entries??[]).map((e=>e.participantId)),n))).map((e=>({eventName:e.eventName,eventId:e.eventId})))}},getEligibleVoluntaryConsolationParticipants:function(e){return e.tournamentRecord?bI(e):{error:$}},findParticipant:function({tournamentRecord:e,policyDefinitions:t,convertExtensions:n,participantId:r,personId:i}){return e?"string"!=typeof r&&"string"!=typeof i?{error:mt}:{participant:ii(Rs({tournamentParticipants:e.participants||[],policyDefinitions:t,participantId:r,personId:i}),n,!0)}:{error:$}},getTournamentParticipants:function(e){const{participantFilters:t={},convertExtensions:n,policyDefinitions:r,withScheduleItems:i,scheduleAnalysis:a,withSignInStatus:o,withTeamMatchUps:s,tournamentRecord:c,usePublishState:u,withScaleValues:d,withStatistics:p,withGroupings:l,withOpponents:m,withMatchUps:f,withSeeding:h,withEvents:I,withDraws:g,inContext:U,withISO2:y,withIOC:v}=e;if(!c)return{error:$};if(!c.participants)return{error:_t};const S=c.participants.map((e=>ii(e,n)));if("object"!=typeof t)return{error:On,participantFilters:t};U&&S?.forEach((e=>{[Wu,Hu,$u].includes(e.participantType)&&(e.individualParticipants=e.individualParticipantIds?.map((e=>{const t=ii(c.participants.find((t=>t.participantId===e)),n,!0);if(d){const{ratings:e,rankings:n}=Ds({participant:t});t.ratings=e,t.rankings=n}return(v||y)&&Hf({participant:t,withISO2:y,withIOC:v}),t})))}));let w,P,T=t?jg({participants:S,participantFilters:t,tournamentRecord:c}):S;if(i||o||a||d||p||l||m||f||h||I||g||y||v){const e=VT({tournamentEvents:c.events,allTournamentParticipants:S,tournamentParticipants:T,participantFilters:t,withScheduleItems:i,withSignInStatus:o,tournamentRecord:c,scheduleAnalysis:a,withTeamMatchUps:s,usePublishState:u,withScaleValues:d,withStatistics:p,withGroupings:l,withOpponents:m,withMatchUps:f,withSeeding:h,withEvents:I,withDraws:g,withISO2:y,withIOC:v});w=e?.participantIdsWithConflicts,P=e?.eventsPublishStatuses}const D=r?.[ho];return D?.participant&&(T=T.map((e=>mi({template:D.participant,source:e})))),{participantIdsWithConflicts:w,tournamentParticipants:T,eventsPublishStatuses:P}},getParticipantSchedules:function({participantFilters:e={},tournamentRecord:t}){if(!t)return{error:$};if("object"!=typeof e)return{error:On,context:{participantFilters:e}};const n=rh({tournamentRecord:t,contextFilters:{eventIds:e.eventIds}}).matchUps??[],r=Object.assign({},...n.map((e=>({[e.matchUpId]:e})))),i=n.filter((({schedule:e})=>e&&Object.keys(e).length)),a=bh({tournamentRecord:t,matchUps:n}).sourceMatchUpIds??[],o={};for(const s of i){const{sides:e}=s;let t;const n=e?.map((e=>{if(e.participant)return[e.participant].concat(...e.participant.individualParticipants||[]);a[s.matchUpId]&&!t&&(t=(a[s.matchUpId]||[]).map((e=>r[e])).filter((({winningSide:e,bye:t})=>!e&&!t)))})).filter(Boolean).flat()??[];for(const r of n){const{participantId:e}=r;o[e]||(o[e]={potentialMatchUps:[],participant:r,matchUps:[]}),o[e].matchUps.push(s)}const i=t?.map((({sides:e})=>e)).flat().map((({participant:e})=>e&&[e].concat(...e.individualParticipants||[]))).filter(Boolean).flat()||[];for(const r of i){const{participantId:e}=r;o[e]||(o[e]={potentialMatchUps:[],participant:r,matchUps:[]}),o[e].potentialMatchUps.push(s)}}return{participantSchedules:Object.values(o).filter((({participant:t})=>!(e.participantIds&&!e.participantIds.includes(t.participantId)||e.participantTypes&&!e.participantTypes.includes(t.participantType)))),...L}},getTournamentPersons:function({tournamentRecord:e,participantFilters:t}){if(!e)return{error:$};let n=e.participants||[];t&&(n=jg({participants:n,participantFilters:t,tournamentRecord:e}));const r={},i=e=>{if(e.person){const{personId:t}=e.person;r[t]?r[t].participantIds.push(e.participantId):r[t]={...e.person,participantIds:[e.participantId]}}};return n.forEach((e=>{e.person&&i(e),e.individualParticipants&&e.individualParticipants.forEach(i)})),{tournamentPersons:Object.values(r)}},getParticipants:Kg};function eD(e){let{policyDefinitions:t,drawIds:n,structureIds:r,stages:i}=e;const{includePositionAssignments:a,removePriorValues:o,tournamentRecord:s,status:c=yu,event:u,drawIdsToRemove:d,drawIdsToAdd:p,stagesToRemove:l,stagesToAdd:m,structureIdsToRemove:f,structureIdsToAdd:h}=e;if(!s)return{error:$};if(!u)return{error:Ae};if(!t){const{appliedPolicies:e}=Xo({tournamentRecord:s,event:u});t=e}const I=`${Uu}.${vu}`,g=u.drawDefinitions?.map((({drawId:e})=>e))??[],{timeItem:U}=Yf({itemType:I,event:u});n||p||d?n||!p?.length&&!d?.length||(n=U?.itemValue?.PUBLIC?.drawIds||[]):n=g,n=(n??[]).filter((e=>!d?.length||!d.includes(e))),p?.length&&(n=P(n.concat(...p.filter((e=>g.includes(e)))))),r||!h?.length&&!f?.length||(r=U?.itemValue?.PUBLIC?.structureIds||[]),r=(r??[]).filter((e=>!f?.length||!f.includes(e))),h?.length&&(r=P(r.concat(...h))),i||!m?.length&&!l?.length||(i=U?.itemValue?.PUBLIC?.stages||[]),i=(i??[]).filter((e=>!l?.length||!l.includes(e))),m?.length&&(i=P(i.concat(...m)));const y=U?.itemValue?.[c];PU({event:u,timeItem:{itemValue:{[c]:{...y,drawIds:n,structureIds:r,stages:i}},itemType:I},removePriorValues:o});const{eventData:v}=fU({includePositionAssignments:a,usePublishState:!0,tournamentRecord:s,policyDefinitions:t,event:u}),S=v?.eventInfo?.publish?.state;return v.drawsData=v.drawsData.filter((({drawId:e})=>S?.PUBLIC?.drawIds.includes(e))),pr({payload:{eventData:v,tournamentId:s.tournamentId},topic:Fc}),{...L,eventData:v}}const tD={getTournamentInfo:Ig,getVenueData:zc,getCourtInfo:Hc,getAllEventData:function({tournamentRecord:e,policyDefinitions:t}){if(!e)return{error:$};const n=e.events||[],r=e?.participants||[],{tournamentInfo:i}=Ig({tournamentRecord:e}),{venues:a}=qc({tournamentRecord:e}),o=n.map((n=>{const{eventId:i}=n,a=(({eventId:e,eventName:t,eventType:n,eventLevel:r,surfaceCategory:i,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:p})=>({eventId:e,eventName:t,eventType:n,eventLevel:r,surfaceCategory:i,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:p}))(n),o=Os({tournamentRecord:e,event:n}).scheduleTiming,s=(n.drawDefinitions||[]).map((a=>{const s=(({drawId:e,drawName:t,matchUpFormat:n,updatedAt:r})=>({matchUpFormat:n,updatedAt:r,drawName:t,drawId:e}))(a),{abandonedMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:p}=Ol({requireParticipants:!0,tournamentParticipants:r,context:{eventId:i},policyDefinitions:t,tournamentRecord:e,inContext:!0,scheduleTiming:o,drawDefinition:a,event:n});return{drawInfo:s,matchUps:{abandonedMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:p}}})),{timeItem:c}=Yf({itemType:`${Uu}.${vu}`,event:n});return Object.assign(a,{publish:c?.itemValue,drawsData:s}),a}));return{allEventData:{tournamentInfo:i,venuesData:a,eventsData:o}}},getEventData:fU,getDrawData:mU,unPublishEventSeeding:function({removePriorValues:e=!0,seedingScaleNames:t,tournamentRecord:n,status:r=yu,stages:i,event:a}){if(!n)return{error:$};if(!a)return{error:Ae};const o=`${Uu}.${vu}`,{timeItem:s}=Yf({itemType:o,event:a}),c=s?.itemValue||{[r]:{}};if(c[r]){if(Array.isArray(i)&&c[r].seeding?.stageSeedingScaleNames)for(const e of i)c[r].seeding.stageSeedingScaleNames[e]&&delete c[r].seeding.stageSeedingScaleNames[e];Array.isArray(t)&&c[r].seeding?.seedingScaleNames&&(c[r].seeding.seedingScaleNames=c[r].seeding.seedingScaleNames.filter((e=>!t.includes(e)))),i||t||delete c[r].seeding}return PU({event:a,timeItem:{itemValue:c,itemType:o},removePriorValues:e}),pr({topic:Lc,payload:{tournamentId:n.tournamentId,eventId:a.eventId}}),{...L}},publishEventSeeding:function({removePriorValues:e=!0,stageSeedingScaleNames:t,seedingScaleNames:n,tournamentRecord:r,status:i=yu,drawIds:a=[],event:o}){if(!r)return{error:$};if(!o)return{error:Ae};const s=`${Uu}.${vu}`,{timeItem:c}=Yf({itemType:s,event:o}),u=c?.itemValue||{[i]:{}},d=(u[i].seeding?.seedingScaleNames||n)&&{...u[i].seeding?.seedingScaleNames,...n},p=(u[i].seeding?.stageSeedingScaleNames||t)&&{...u[i].seeding?.stageSeedingScaleNames,...t};return u[i].seeding=pi({stageSeedingScaleNames:p,seedingScaleNames:d,published:!0,drawIds:a}),PU({event:o,timeItem:{itemValue:u,itemType:s},removePriorValues:e}),pr({topic:kc,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...L}},unPublishEvent:function({removePriorValues:e=!0,tournamentRecord:t,status:n=yu,event:r}){if(!t)return{error:$};if(!r)return{error:Ae};const i=`${Uu}.${vu}`,{timeItem:a}=Yf({itemType:i,event:r}),o=a?.itemValue||{[n]:{}};return delete o[n].structureIds,delete o[n].drawIds,PU({event:r,timeItem:{itemValue:o,itemType:i},removePriorValues:e}),pr({topic:_c,payload:{tournamentId:t.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...L}},publishEvent:eD,unPublishOrderOfPlay:gv,publishOrderOfPlay:Uv};function nD({collectionPosition:e,teamParticipantId:t,dualMatchUpSide:n,drawDefinition:r,participantIds:i,collectionId:a}){if(!a||!e||!Array.isArray(i))return{modifiedLineUp:n?.lineUp||[],error:xn};const o=n?.lineUp||Zu({participantId:t,drawDefinition:r})?.lineUp,s=[],c=[];return{modifiedLineUp:o?.map((t=>{if(!i.includes(t.participantId))return t;const n=t.collectionAssignments?.filter((n=>{const r=n.collectionId===a&&n.collectionPosition===e;return r&&(n.previousParticipantId&&s.push(n.previousParticipantId),c.push({participantId:t.participantId,...n})),!r}));return{participantId:t.participantId,collectionAssignments:n}})).filter(Boolean)||[],assignmentsRemoved:c,previousParticipantIds:s}}function rD({tournamentRecord:e,drawDefinition:t,tieMatchUpId:n,event:r}){if(!e)return{error:$};if(!t)return{error:le};if(!r)return{error:Ee};const i=_p({drawDefinition:t}),{matchUp:a}=Qp({matchUpId:n,drawDefinition:t,matchUpsMap:i});if(!a)return{error:Xe};const{matchUp:o,structure:s}=Qp({tournamentParticipants:e.participants,matchUpId:n,inContext:!0,drawDefinition:t,matchUpsMap:i,event:r});if(!o)return{error:Xe};const{collectionPosition:c,drawPositions:u,collectionId:d,matchUpTieId:p,matchUpType:l}=o;if(l&&![_i,Bi].includes(l))return{error:tt};const{positionAssignments:m}=op({structure:s}),f=m?.filter((e=>u?.includes(e.drawPosition))),h=f?.map(di("participantId")),{participants:I}=Kg({tournamentRecord:e,participantFilters:{participantTypes:[Hu],participantIds:h}}),{matchUp:g}=Qp({matchUpId:p,drawDefinition:t,matchUpsMap:i}),{matchUp:U}=Qp({matchUpId:p,inContext:!0,drawDefinition:t,matchUpsMap:i}),y=Ni({matchUp:g,drawDefinition:t,structure:s,event:r})?.tieFormat;return{inContextDualMatchUp:U,inContextTieMatchUp:o,relevantAssignments:f,collectionPosition:c,teamParticipants:I,collectionId:d,matchUpType:l,dualMatchUp:g,tieMatchUp:a,tieFormat:y,structure:s,...L}}function iD(e){const t=rD(e);if(t.error)return t;const n="assignTieMatchUpParticipantId";let r=e.teamParticipantId;const{tournamentRecord:i,drawDefinition:a,participantId:o,event:s}=e;if(!o)return Mi({result:{error:Lt},stack:n});if(e.sideNumber&&![1,2].includes(e.sideNumber))return Mi({result:{error:dt},stack:n});const{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:l,collectionId:m,matchUpType:f,dualMatchUp:h,tieFormat:I}=t,g=u?.sides?.flatMap((e=>e.participant?.individualParticipantIds||e.participant?.participantId||[]));if(g?.includes(o))return Mi({result:{...L},stack:n});r=r??(e.sideNumber?c?.sides?.find((t=>t.sideNumber===e.sideNumber))?.participantId:void 0);const U=Kg({participantFilters:{participantIds:[o]},tournamentRecord:i})?.participants?.[0];if(!U)return Mi({result:{error:Bt},stack:n});const{appliedPolicies:y}=Xo({tournamentRecord:i,drawDefinition:a,event:s}),v=e.policyDefinitions?.[lo]??y?.[lo]??BI[lo];if(!1!==(e.enforceGender??v?.participants?.enforceGender)&&[Ei,Fi].includes(u?.gender)&&u?.gender!==U.person?.sex)return{error:At,info:"Gender mismatch"};const{individualParticipantIds:S,participantType:w}=U;if(f===_i&&w!==qu)return{error:Ft};const P=w===qu?[o]:S,T=r&&l?.find((({participantId:e})=>e===r))||l?.find((({individualParticipantIds:e})=>k(P,e)));if(!T)return{error:Ln};if(r||(r=T.participantId),!r)return{error:Bt};const D=d?.find((e=>e.participantId===T?.participantId)),R=D?.drawPosition,b=u?.sides?.find((e=>e.drawPosition===R)),N=e.sideNumber??b?.sideNumber;if(!I)return{error:Ke};const M=I.collectionDefinitions?.find((e=>e.collectionId===m));if(!M)return{error:Ye};cl({tournamentId:i.tournamentId,eventId:s.eventId,inContextDualMatchUp:c,drawDefinition:a,dualMatchUp:h});const A=h?.sides?.find((e=>e.sideNumber===N)),E=u?.sides?.find((e=>e.sideNumber===N)),C=A?.lineUp??Zu({participantId:r,drawDefinition:a})?.lineUp,O=C?.filter((e=>e.collectionAssignments?.find((e=>e.collectionPosition===p&&e.collectionId===m&&!e.previousParticipantId)))),F=O?.map((e=>e?.participantId)),x=F?.length>1&&F||(w===Wu?U.individualParticipantIds:[o]),_=nD({collectionPosition:p,teamParticipantId:r,dualMatchUpSide:A,drawDefinition:a,participantIds:x,collectionId:m});if(_.error)return Mi({result:_,stack:n});const{modifiedLineUp:B}=_;let V;if(f===Bi){if(w!==Wu){let e=aD({collectionPosition:p,teamParticipantId:r,drawDefinition:a,modifiedLineUp:B,participantId:o,collectionId:m,tieFormat:I});if(e?.error)return Mi({result:e,stack:n});if(e=function({side:e}){let t;if(e.participant){const n=e.participant.individualParticipantIds||[];if(1===n.filter(Boolean).length){const{participant:e}=Xu({participantIds:n,tournamentRecord:i});n.push(o);const{participant:r}=Xu({participantIds:n,tournamentRecord:i});if(!r&&e){e.individualParticipantIds=n;const t=YT({pairOverride:!0,tournamentRecord:i,participant:e});if(t.error)return t}else t=e?.participantId}}else{const e=By({participant:{individualParticipantIds:[o],participantRole:jT,participantType:Wu},pairOverride:!0,tournamentRecord:i});if(e.error)return e}return{...L,deletedParticipantId:t}}({side:E}),e.error)return e;V=e.deletedParticipantId,A&&(A.lineUp=B),h&&rl({tournamentId:i?.tournamentId,matchUp:h,context:n,drawDefinition:a})}else if(w===Wu)for(const k of x)aD({collectionPosition:p,teamParticipantId:r,drawDefinition:a,modifiedLineUp:B,participantId:k,collectionId:m,tieFormat:I})}else{const e=aD({collectionPosition:p,teamParticipantId:r,drawDefinition:a,modifiedLineUp:B,participantId:o,collectionId:m,tieFormat:I});if(e?.error)return e}if(A&&(A.lineUp=B),h&&rl({tournamentId:i?.tournamentId,matchUp:h,context:n,drawDefinition:a}),V){const{error:e}=EP({participantIds:[V],tournamentRecord:i});e&&console.log("cleanup")}return{...L,modifiedLineUp:B}}function aD({collectionPosition:e,teamParticipantId:t,drawDefinition:n,modifiedLineUp:r,participantId:i,collectionId:a,tieFormat:o}){const s=Zu({participantId:t,drawDefinition:n})?.lineUp,c=(r||s)?.find((e=>e?.participantId===i)),u={collectionId:a,collectionPosition:e};if(c)c.collectionAssignments.push(u);else{const e={collectionAssignments:[u],participantId:i};r.push(e)}return wy({participantId:t,lineUp:r,drawDefinition:n,tieFormat:o})}const oD="ASC",sD="DESC",cD={ASC:"ASC",ASCENDING:oD,DESC:"DESC",DESCENDING:sD};function uD(e){let{tieFormat:t}=e;const{useDefaultEventRanking:n,tournamentRecord:r,drawDefinition:i,scaleAccessor:a,singlesOnly:o,attach:s,event:c}=e;if(c?.eventType!==Lu)return{error:Me};if(!r)return{error:$};if(!t&&!i)return{error:Q};if(t=t??Ni({drawDefinition:i,event:c})?.tieFormat,ca({tieFormat:t,eventType:e.event?.eventType}).error)return{error:We};if("object"!=typeof a&&!n)return{error:xn,context:{scaleAccessor:a}};const u={},d=(i?.entries??c?.entries??[]).filter((e=>e?.entryStatus===lp)).map(Sl),{participants:p=[]}=Kg({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),l=p.filter((({participantId:e})=>d.includes(e))),m=c?.category?.categoryName??c?.category?.ageCategoryCode,{scaleName:f=m,scaleType:h=vs,sortOrder:I,accessor:g}=a||{},y=h===vs?"rankings":"ratings";const v=(e,t)=>{let r=e[y]?.[t];if(!r&&n&&(r=e[y]?.[xi]),Array.isArray(r)){const e=r.find((e=>e.scaleName===f))?.scaleValue;if(U(e))return e;if(g&&"object"==typeof e)return e[g]}return 0},S=(e,t,n)=>{const r=I===sD?e:t;return v(I===sD?t:e,n)-v(r,n)},w=(e,t)=>S(e,t,xi),P=(e,t)=>S(e,t,Li),T=[],D=t?.collectionDefinitions??[];for(const U of l){const e=U.individualParticipants.sort(w),t=o?e:U.individualParticipants.sort(P),n={};for(const i of D){const r=[],{collectionId:a,matchUpCount:o,matchUpType:s,gender:c}=i,u=s===xi;E(0,o).forEach((i=>{const o=u?e:t,s=i+1,d=[];E(0,u?1:2).forEach((e=>{const t=o.find((t=>{const n=c&&([Ei,Fi].includes(c)&&c||c===Ci&&[Ei,Fi][e]);return!(n&&n!==t.person.sex||r.includes(t.participantId))})).participantId;t&&(d.push(t),r.push(t),n[t]||(n[t]=[]),n[t].push({collectionPosition:s,collectionId:a}))})),u||T.push(d)}))}const r=Object.keys(n).map((e=>({collectionAssignments:n[e],participantId:e})));u[U.participantId]=r}const R=[];for(const U of T){const{participant:e}=Xu({tournamentParticipants:p,participantIds:U});if(!e){const e={individualParticipantIds:U,participantRole:jT,participantType:Wu};R.push(e)}}if(s){for(;R.length;)By({participant:R.pop(),tournamentRecord:r});Js({element:i,extension:{name:_o,value:u}})}return{...L,lineUps:u,participantsToAdd:R}}function dD(e){const{matchUpFormat:t,matchUpStatus:n,winningSide:r,scoreString:i}=e;if(!i)return{outcome:{...Fl,winningSide:r,matchUpStatus:n}};if(r&&![1,2,void 0].includes(r))return{error:xn,winningSide:r};const a=i&&iI({scoreString:i}),o={},s=_l({sets:a,matchUpFormat:t}),c=_l({sets:a,reversed:!0,matchUpFormat:t});return 2===r?(o.scoreStringSide1=c,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=c),o.sets=iI({scoreString:o.scoreStringSide1}),pi({outcome:{matchUpStatus:n,winningSide:r,score:o}})}const pD={[Ra]:2,[ya]:1,[Ua]:1,[Pa]:1,[ga]:4};function lD(e){let{defaultWithScorePercent:t=2,winningSide:n}=e;const{matchUpStatusProfile:r=pD,matchUpFormat:i=Ba,pointsPerMinute:a=1,sideWeight:o=4}=e;if(!Ti(i))return{error:He};if("object"!=typeof r)return{error:xn};if(t>100&&(t=100),isNaN(t)||isNaN(a)||isNaN(o))return{error:xn};const s=Object.keys(r).filter((e=>Object.keys(ka).includes(e)&&e!==ha));if(Object.keys(s).reduce(((e,t)=>e+r[t]),0)>100)return{error:xn,matchUpStatusProfile:r};const c=s.reduce(((e,t)=>(e.pointer=e.pointer+r[t],e.valueMap.push([e.pointer,t]),e)),{pointer:0,valueMap:[]}),u=v(1,100),d=(c.valueMap.find((e=>u<=e[0]))||[100,ha])[1],p={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Ra,ga].includes(d)){n=n||v(1,2);const e={score:p,winningSide:n,matchUpStatus:d};if(!(d===ga&&v(1,100)>100-t))return{outcome:e}}else if([ya,Ua].includes(d))return{outcome:{score:p,matchUpStatus:d}};const l=gi(i),{bestOf:m,setFormat:f,finalSetFormat:h}=l||{},I=[],g=v(0,1),U=n?[n-1]:[...E(0,o).map((()=>g)),1-g],y=[Pa,ga,Sa,Ta].includes(d)&&(M(E(1,m))||1);let S;for(const v of E(1,(m||0)+1)){const e=v===m,{set:t,incomplete:n,winningSideNumber:r}=mD({incomplete:y===v,matchUpStatus:d,pointsPerMinute:a,setFormat:e&&h||f,setNumber:v,weightedRange:U});if(I.push(t),n){S=r;break}if(TT({matchUp:{score:{sets:I},matchUpFormat:i}}).calculatedWinningSide)break}const w=TT({matchUp:{score:{sets:I},matchUpFormat:i}}),P=S?n||S:w.calculatedWinningSide,{score:T}=ky({score:{sets:I},winningSide:P,matchUpStatus:d});return{outcome:{score:T,winningSide:P,matchUpStatus:d}}}function mD({weightedRange:e=[0,1],pointsPerMinute:t,matchUpStatus:n,incomplete:r,setFormat:i,setNumber:a}){const o={setNumber:a},{setTo:s,tiebreakFormat:c,tiebreakAt:u,tiebreakSet:d,timed:p,minutes:l}=i,m=v(0,e.length-1),f=e[m];let h;if(p){const i=l*t,a=Math.round(.2*i),s=i+M([1,-1])*a,c=function(e=1,t=3,n=!0){let r=0;for(let i=0;i<t;i++)r+=Math.random()*(e/t);return n&&e>1?Math.round(r):r}(s,2),u=[c,s-c];f&&u.reverse(),h=e[m]+1;let d=(u[0]>u[1]?1:u[1]>u[0]&&2)||0;if(r){const[e,t]=u;return Object.assign(o,{side1Score:e,side2Score:t}),Ca.includes(n)?{set:o,incomplete:r,winningSideNumber:h}:{set:o,incomplete:r}}d||(u[v(0,1)]+=1),d=u[0]>u[1]?1:2,d!==h&&u.reverse();const[p,I]=u;return Object.assign(o,{side1Score:p,side2Score:I,winningSide:h}),{set:o}}if(r)return o.side1Score=v(0,u),o.side2Score=v(0,u),Ca.includes(n)&&(h=e[m]+1),{set:o,incomplete:r,winningSideNumber:h};{const t=E(1,s+1).map((e=>E(0,s+2-e).map((()=>e)))).flat(),n=t[v(0,t.length-1)],r=s&&Bm({isSide1:!0,tiebreakAt:u,lowValue:n,setTo:s}),a=!r,p=1===e.length&&e[m]+1;if(!a){if(p){(r[0]>r[1]?1:2)!==p&&r.reverse()}else f&&r.reverse();const[e,t]=r;Object.assign(o,{side1Score:e,side2Score:t})}const l=Lm({matchUpScoringFormat:{setFormat:i},setObject:o});let h;if(l.hasTiebreakCondition||a){const{NoAD:e,tiebreakTo:t}=c||d||{},n=E(1,t+1).map((e=>E(0,t+2-e).map((()=>e)))).flat(),r=n[v(0,n.length-1)],i=Vm({isSide1:!0,tiebreakNoAd:e,tiebreakTo:t,lowValue:r});if(i)if(a){const e=i[0]>i[1]?1:2;p?e!==p&&i.reverse():f&&i.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=i,h=(i[0]>i[1]?1:i[1]>i[0]&&2)||void 0}else 2===l.leadingSide?[o.side1TiebreakScore,o.side2TiebreakScore]=i:[o.side2TiebreakScore,o.side1TiebreakScore]=i}o.winningSide=l.winningSide||l.leadingSide||p||h}return{set:o}}function fD(e){const{matchUpStatusProfile:t,completeAllMatchUps:n,randomWinningSide:r,tournamentRecord:i,completionGoal:a,drawDefinition:o,event:s}=e;if(!o)return{error:Y};const c=e.matchUpFormat||o.matchUpFormat||s?.matchUpFormat,u=o.structures.slice().sort(tp);let d=0;const{matchUps:p,matchUpsMap:l}=Cl({contextFilters:{stages:[nd,rd]},matchUpFilters:{matchUpTypes:[ji],roundNumbers:[1]},inContext:!0,drawDefinition:o});if(p?.length){const e=s?.category?.ageCategoryCode||s?.category?.categoryName;if(e){uD({singlesOnly:!0,tournamentRecord:i,drawDefinition:o,scaleAccessor:{scaleName:e,sortOrder:oD,scaleType:vs},attach:!0,event:s})}else{const e=p[0]?.structureId,{positionAssignments:t}=op({drawDefinition:o,structureId:e});if(t?.length){const{participants:e}=Kg({participantFilters:{participantTypes:[Xi.Team]},tournamentRecord:i}),n=n=>{const r=n.tieMatchUps.filter((({matchUpType:e})=>e===_i)),a=n.tieMatchUps.filter((({matchUpType:e})=>e===Bi));r.forEach(((n,r)=>{const a=n.matchUpId;n.sides.forEach((n=>{const{drawPosition:c}=n,u=e?.find((e=>{const{participantId:n}=e,r=t.find((e=>e.participantId===n));return r?.drawPosition===c}));if(u){const e=u.individualParticipantIds?.[r];e&&iD({teamParticipantId:u.participantId,participantId:e,tournamentRecord:i,drawDefinition:o,tieMatchUpId:a,event:s})}}))})),a.forEach(((n,r)=>{const a=n.matchUpId;n.sides.forEach((n=>{const{drawPosition:c}=n,u=e?.find((e=>{const{participantId:n}=e,r=t.find((e=>e.participantId===n));return r?.drawPosition===c}));if(u){const e=u.individualParticipantIds?.slice(2*r,2*r+2);e?.forEach((e=>{iD({teamParticipantId:u.participantId,participantId:e,tournamentRecord:i,drawDefinition:o,tieMatchUpId:a,event:s})}))}}))}))};p.forEach(n)}}}const m="string"==typeof n&&n,f=m&&ha;for(const h of u){if(d>=a)break;const{matchUps:e}=Kp({matchUpFilters:{matchUpTypes:[Bi,_i]},afterRecoveryTimes:!1,tournamentRecord:i,inContext:!0,drawDefinition:o,matchUpsMap:l,structure:h,event:s}),n=e.filter((({winningSide:e})=>!e)).sort(Rh).map(Pl);for(const u of n){if(!isNaN(a)&&d>=a)break;const{matchUps:e}=Kp({matchUpFilters:{matchUpTypes:[Bi,_i]},afterRecoveryTimes:!1,tournamentRecord:i,inContext:!0,drawDefinition:o,matchUpsMap:l,structure:h,event:s}),n=e.find((e=>e.matchUpId===u)),p=[ya,Ua].includes(n.matchUpStatus);if(n?.readyToScore&&!p){const e=ID({winningSide:!r&&1,matchUpStatusProfile:t,tournamentRecord:i,drawDefinition:o,targetMatchUp:n,matchUpFormat:c,matchUpStatus:f,scoreString:m,event:s});if(e?.error)return e;d+=1}}}return{...L,completedCount:d}}function hD(e){const{matchUpStatusCodes:t,policyDefinitions:n,tournamentRecord:r,drawDefinition:i,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:c,winningSide:u,event:d}=e;if(!a||a.matchUpStatus===ma)return;const{matchUpId:p}=a||{},{outcome:l}=dD({matchUpFormat:s,matchUpStatus:o,scoreString:c,winningSide:u});return t&&(l.matchUpStatusCodes=t),xy({tournamentRecord:r,policyDefinitions:n,drawDefinition:i,matchUpFormat:s,matchUpId:p,outcome:l,event:d})}function ID(e){const{matchUpStatusProfile:t={},tournamentRecord:n,policyDefinitions:r,drawDefinition:i,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:c,winningSide:u,event:d}=e;if(c||a)return hD(e);const{matchUpId:p}=s||{},{outcome:l}=lD({matchUpStatusProfile:t,matchUpFormat:o,winningSide:u});return xy({policyDefinitions:r,tournamentRecord:n,drawDefinition:i,matchUpFormat:o,matchUpId:p,outcome:l,event:d})}function gD(e){const t=[];for(const n of e||[]){const{stageType:e}=n,r=["M",nd].includes(e)&&nd||["Q",rd].includes(e)&&rd||["C",id].includes(e)&&id||["P",od].includes(e)&&od||void 0;for(const i of n.draws||[]){const{drawId:e,drawSize:n,matchUps:a}=i,o={stage:r,drawId:e,drawSize:n};t.push(o),console.log(a.map((({roundNumber:e,roundPosition:t})=>({roundNumber:e,roundPosition:t}))),{draw:i,drawDefinition:o})}}return t}const UD={ABANDONED:"ABANDONED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};function yD({tournamentRecord:e}){if(!e)return{error:$};const t={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={},r=e.events?.map((e=>{const t=e.eventId;return n[t]=e,(e?.drawDefinitions||[]).map((e=>({drawDefinition:e,eventId:t})))})).flat().filter(Boolean);return r.forEach((({drawDefinition:e,eventId:r})=>{let i=0,a=0,o=0;const{allStructuresLinked:s}=lU({drawDefinition:e}),c=n[r],u=(e?.structures||[]).map((t=>{const{stage:n,stageSequence:r,structureId:s}=t,u=cd[n],{inContextStructureMatchUps:d}=eU({drawDefinition:e,structure:t,event:c}),p=d?.filter((({winningSide:e})=>e)),l=p.filter(Boolean).length||0;a+=l,o+=d.length-a;const m=Math.max(p.filter((({roundNumber:e})=>1===e)).map((({roundPosition:e})=>e))),{positionAssignments:f}=op({structure:t}),h=f?.filter((({participantId:e})=>e));i+=h?.length??0;const I=(f?.length??0)-(h?.length??0),{roundMatchUps:g,roundProfile:U,roundNumbers:y,maxMatchUpsCount:v}=ed({matchUps:d}),S=U&&Object.keys(U).filter((e=>!U[e].inactiveRound)).map((e=>parseInt(e))),w=U&&Object.keys(U).filter((e=>U[e].inactiveRound)).map((e=>parseInt(e))),P=U&&Object.values(U).every((e=>e.inactiveRound));return{positionsAssignedCount:h?.length??0,maxWinningSideFirstRoundPosition:m,unassignedPositionsCount:I,inactiveStructure:P,maxMatchUpsCount:v,inactiveRounds:w,roundMatchUps:g,activeRounds:S,roundNumbers:y,roundProfile:U,structureId:s,stageSequence:r,orderNumber:u,stage:n}})),d=u.find((e=>2===e.orderNumber&&1===e.stageSequence)),p=u.filter((({inactiveStructure:e})=>!e)).length,{links:l}=Rl({structureId:d.structureId,drawDefinition:e}),f=1===m(d.activeRounds[0])&&1===d.activeRounds.length&&1===p,h=u?.every((({inactiveStructure:e})=>e)),I=!l.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),g=e.drawId;i&&!a&&t.positionsNoOutcomes.push(g),h&&t.inactive.push(g),f&&t.matchPlay.push(g),I&&t.canBePruned.push(g);const U={matchUpsWithWinningSideCount:a,matchUpsNoOutcomeCount:o,positionsAssignedCount:i,allStructuresLinked:s,structuresData:u,inactiveDraw:h,isMatchPlay:f,drawId:g};t.drawAnalysis[g]=U})),{...L,drawsAnalysis:t}}function vD(e){const t=e.participants?.filter((({participantType:e})=>e===Hu)),n=2===t?.length,r=1===e.events?.length&&e.events[0],i=1===r?.drawDefinitions?.length&&r.drawDefinitions[0],a=1===i?.structures?.length&&i.structures[0],o=2===a?.positionAssignments?.length;return!!(r.tieFormat&&n&&o)}function SD({tournamentRecord:e,startDate:t,endDate:n}){if(!e)return{error:$};if(t&&!Nr.test(t)||n&&!Nr.test(n))return{error:yt};if(!t&&!n)return{error:ft};if(n&&t&&new Date(n)<new Date(t))return{error:xn};let r;(t&&e.startDate&&new Date(t)>new Date(e.startDate)||n&&e.endDate&&new Date(n)<new Date(e.endDate))&&(r=!0),t&&(e.startDate=t),n&&(e.endDate=n),t&&e.endDate&&new Date(t)>new Date(e.endDate)&&(e.endDate=t),n&&e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=n);const i=r&&function({tournamentRecord:e}){const t=rh({tournamentRecord:e}).matchUps??[],n=e.startDate&&new Date(e.startDate),r=e.endDate&&new Date(e.endDate),i=[],a=[];for(const o of t){const{schedule:e,matchUpId:t}=o;if(e&&e.scheduledDate){const o=new Date(e.scheduledDate);(n&&o<n||r&&o>r)&&(a.push(t),i.includes(e.scheduledDate)||i.push(e.scheduledDate))}}if(i.length){if(!Zv({scheduledDates:i,tournamentRecord:e}).clearedScheduleCount)return{error:te}}return{unscheduledMatchUpIds:a}}({tournamentRecord:e})?.unscheduledMatchUpIds;return function({tournamentRecord:e}){if(!e)return{error:$};const{startDate:t,endDate:n}=e,r=Lr(t,n),i=[];for(const a of e.venues||[])a?.courts?.length&&i.push(...a.courts);for(const a of i){const{startTime:e,endTime:t}=(a.dateAvailability??[]).reduce(((e,t)=>{const n=Gr(e.startTime),r=Gr(e.endTime);return t.startTime&&Gr(t.startTime)<n&&(e.startTime=t.startTime),t.endTime&&Gr(t.endTime)>r&&(e.endTime=t.endTime),e}),{startTime:"08:00",endTime:"18:00"}),n=r.map((n=>{const r=a.dateAvailability?.find((e=>e.date===n));return r??{date:n,startTime:e,endTime:t}})),i=a.dateAvailability?.find((e=>!e.date));i&&n.unshift(i),a.dateAvailability=n}}({tournamentRecord:e}),pr({topic:Ec,payload:{startDate:t,endDate:n}}),{...L,unscheduledMatchUpIds:i}}const wD={analyzeTournament:function({tournamentRecord:e}){if(!e)return{error:$};const{drawsAnalysis:t}=yD({tournamentRecord:e}),n={isDual:vD(e),drawsAnalysis:t};return{...L,analysis:n}},analyzeDraws:yD,addOnlineResource:function({tournamentRecord:e,onlineResource:t,organisationId:n,participantId:r,personId:i,courtId:a,venueId:o}){if(!e)return{error:$};if(!ci(t))return{error:mt};if(3!==O(Object.keys(t),["resourceSubType","resourceType","identifier"]).length)return Mi({result:{error:On},context:{onlineResource:t}});if(n){if(e.parentOrganisation?.parentOrganisationId!==n)return Mi({result:{error:Gn}});e.parentOrganisation.onlineResources||(e.parentOrganisation.onlineResources=[]),e.parentOrganisation.onlineResources.push(t)}else if(r||i){const n=(e.participants??[]).find((e=>i&&e.person?.personId===i||e.participantId===r));if(!n)return Mi(i?{result:{error:Gn}}:{result:{error:Bt}});if(i){if(n.person?.personId!==i)return Mi({result:{error:At}});n.person.onlineResources||(n.person.onlineResources=[]),n.person.onlineResources.push(t)}else n.onlineResources||(n.onlineResources=[]),n.onlineResources.push(t)}else if(a){const n=(e.venues??[]).filter((e=>!o||e.venueId===o)).flatMap((e=>(e.courts??[]).filter((e=>e.courtId===a))))?.[0];if(!n)return Mi({result:{error:dn}});n.onlineResources||(n.onlineResources=[]),n.onlineResources.push(t)}else if(o){const n=(e.venues??[]).find((e=>e.venueId===o));if(!n)return Mi({result:{error:mn}});n.onlineResources||(n.onlineResources=[]),n.onlineResources.push(t)}else e.onlineResources||(e.onlineResources=[]),e.onlineResources.push(t);return{...L}},removeNotes:function(e){return"object"!=typeof e?{error:mt}:"object"!=typeof e.element?{error:xn}:(e.element.notes&&delete e.element.notes,{...L})},addNotes:fl,completeDrawMatchUps:fD,getRounds:Vg,getProfileRounds:Ng,setTournamentName:function({tournamentRecord:e,promotionalName:t,tournamentName:n,formalName:r}){return e?(n&&(e.tournamentName=n),t&&(e.promotionalName=t),r&&(e.formalName=r),e.promotionalName===e.tournamentName&&delete e.promotionalName,e.formalName===e.tournamentName&&delete e.formalName,{...L}):{error:$}},setTournamentNotes:function({tournamentRecord:e,notes:t}){return e?fl({element:e,notes:t}):{error:$}},setTournamentDates:SD,setTournamentEndDate:function({tournamentRecord:e,endDate:t}){return SD({tournamentRecord:e,endDate:t})},setTournamentStartDate:function({tournamentRecord:e,startDate:t}){return SD({tournamentRecord:e,startDate:t})},setTournamentCategories:function({tournamentRecord:e,categories:t}){return e?(t=(t||[]).filter((e=>e.categoryName&&e.type)),e.tournamentCategories=t,{...L}):{error:$}},addTimeItem:vU,addEventTimeItem:PU,addTournamentTimeItem:wU,addParticipantTimeItem:SU,addExtension:Js,addEventExtension:rc,removeEventExtension:ac,addTournamentExtension:tc,removeTournamentExtension:ic,addParticipantExtension:function(e){if(!e||"object"!=typeof e)return{error:mt};if(!e.participantId)return{error:Lt};const t=e.tournamentRecord?.participants||[],n=Rs({participantId:e.participantId,tournamentParticipants:t});return n?Js({creationTime:e.creationTime,extension:e.extension,element:n}):{error:Bt}},removeParticipantExtension:function(e){if(!e||"object"!=typeof e)return{error:mt};if(!e.participantId)return{error:Lt};const t=e.tournamentRecord?.participants||[],n=Rs({participantId:e.participantId,tournamentParticipants:t});return n?ec({element:n,name:e.name}):{error:Bt}},addDrawDefinitionExtension:nc,removeDrawDefinitionExtension:function(e){return e&&"object"==typeof e?e.drawDefinition?ec({element:e.drawDefinition,name:e.name}):{error:Q}:{error:mt}},setTournamentStatus:function({tournamentRecord:e,status:t}){return e?t&&!Object.keys(UD).includes(t)?{error:xn,info:"Unknown status"}:(e.tournamentStatus=t,{...L}):{error:$}},convertPointEight:function({tournament:e}){if(!e)return{error:$};const{providerTournamentID:t,hostCountryCode:n,tournamentLevel:r,totalPrizeMoney:i,tournamentName:a,extensions:o,startDate:s,endDate:c}=e,u=OT({hostCountryCode:n,tournamentLevel:r,totalPrizeMoney:i,tournamentName:a,tournamentId:t,extensions:o,startDate:s,endDate:c});u.events=[];for(const d of e.events||[]){const{extensions:e,ageCategory:t,discipline:n,eventType:r,eventId:i,gender:a,stages:o}=d,s={drawDefinitions:gD(o),category:{ageCategory:t},gender:["M",Ei].includes(a)&&Ei||["F",Fi].includes(a)&&Fi||void 0,eventType:["D",ku].includes(r)&&ku||["T",_u].includes(r)?_u:Ou,extensions:e,discipline:n,eventId:i};u.events.push(s)}return{...L,tournamentRecord:u}}};const PD={allocateTeamMatchUpCourts:DU,addMatchUpCourtOrder:OU,assignMatchUpCourt:bU,assignMatchUpVenue:RU,clearMatchUpSchedule:function({scheduleAttributes:e=[Jc,Xc,Qc,eu,nu,ru,ou,au,iu],tournamentRecord:t,drawDefinition:n,matchUpId:r}){const i=n?ih({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:n}).matchUps?.[0]:rh({matchUpFilters:{matchUpIds:[r]},tournamentRecord:t,inContext:!1}).matchUps?.[0];if(!i)return{error:Xe};const a=(i.timeItems??[]).filter((t=>t?.itemType&&!e.includes(t?.itemType)));return i.timeItems=a,rl({tournamentId:t.tournamentId,context:"clearMatchUpSchedule",drawDefinition:n,matchUp:i}),{...L}},addMatchUpScheduleItems:sS,addMatchUpScheduledDate:cS,addMatchUpScheduledTime:uS,addMatchUpStartTime:dS,addMatchUpEndTime:pS,addMatchUpStopTime:lS,addMatchUpResumeTime:mS,addMatchUpOfficial:fS,getMatchUpFormatTiming:Hs,modifyMatchUpFormatTiming:Sv,getModifiedMatchUpFormatTiming:vv,getEventMatchUpFormatTiming:EI,modifyEventMatchUpFormatTiming:Pv,removeEventMatchUpFormatTiming:nS,getMatchUpFormatTimingUpdate:function({tournamentRecord:e}){if(!e)return{error:$};const t=[],{extension:n}=As({tournamentRecord:e,name:Wo});n&&t.push({method:"addTournamentExtension",params:{extension:n}});const r=e.events||[];for(const i of r){const{eventId:e}=i,{extension:n}=Es({event:i,name:Wo});n&&t.push({method:"addEventExtension",params:{eventId:e,extension:n}})}return{methods:t}},getMatchUpDependencies:bh,getMatchUpDailyLimits:Og,setMatchUpDailyLimits:IS,getMatchUpDailyLimitsUpdate:function({tournamentRecord:e}){if(!e)return{error:$};const t=[],{extension:n}=As({name:$o,tournamentRecord:e});n&&t.push({method:"addTournamentExtension",params:{extension:n}});const r=e.events||[];for(const i of r){const{eventId:e}=i,{extension:n}=Es({name:$o,event:i});n&&t.push({params:{eventId:e,extension:n},method:"addEventExtension"})}return{methods:t}},validateSchedulingProfile:fg,setSchedulingProfile:function({tournamentRecord:e,schedulingProfile:t}){return e?Array.isArray(t)?ES({tournamentRecord:e,schedulingProfile:t}):{error:xn}:{error:$}},getSchedulingProfile:AS,removeMatchUpCourtAssignment:function({drawDefinition:e,courtDayDate:t,matchUpId:n}){return oS({drawDefinition:e,courtDayDate:t,matchUpId:n})},clearScheduledMatchUps:Zv,bulkScheduleMatchUps:jU,bulkRescheduleMatchUps:hS};function TD({tournamentRecord:e,categoryName:t,categoryType:n}){if(!e)return{error:$};const{appliedPolicies:r}=Xo({tournamentRecord:e}),i=r?.[Po];return(i?.allowedDrawTypes||[]).filter((({categoryNames:e,categoryTypes:r})=>!t&&!r||t&&e?.includes(t)||n&&r?.includes(n)))}const DD={attachPolicies:US,attachEventPolicies:yS,removeEventPolicy:function({event:e,policyType:t}){if(!t)return{error:mt};if(!e)return{error:Ae};let n;if(e.extensions){const{appliedPolicies:r}=Xo({event:e});if(r?.[t])if(delete r[t],n=!0,Object.keys(r).length){rc({event:e,extension:{name:Ro,value:r}})}else ac({event:e,name:Ro})}return n?L:{error:ut}},findPolicy:fs,getSeedsCount:Eg,getEntriesAndSeedsCount:Cg,getAllowedDrawTypes:TD,getAllowedMatchUpFormats:function({tournamentRecord:e,categoryName:t,categoryType:n}){if(!e)return{error:$};const{appliedPolicies:r}=Xo({tournamentRecord:e}),i=r?.[vo];return(i?.matchUpFormats||[]).filter((({categoryNames:e,categoryTypes:r})=>!t&&!r||t&&e?.includes(t)||n&&r?.includes(n)))},getAppliedPolicies:Xo};function RD({participant:e,eventType:t}){const n=e?.person?.personId,r=e?.person?.personOtherIds?.[0],i=e?.person?.tennisId,a=e?.ratings?.[t]?.find((({scaleName:e})=>e===Wm)),o=a?.scaleValue,{wtnRating:s,confidence:c}=o||{};return{timeStamp:a?.scaleDate,personOtherId:r,confidence:c,wtnRating:s,personId:n,tennisId:i}}function bD({eventType:e,matchUps:t,eventId:n,drawId:r}){const i={},a=t.filter((e=>n?e.eventId===n:e.drawId===r)).reduce(((e,t)=>((e=>{const t=e?.matchUpFormat;t&&(i[t]||(i[t]=0),i[t]+=1)})(t),(t.sides??[]).flatMap((e=>(e?.participant?.individualParticipants||[e?.participant]).filter(Boolean))).forEach((t=>e[t.participantId]=t)),e)),{}),o=Object.values(a),s=o.map((t=>RD({participant:t,eventType:e}))).filter((({wtnRating:e})=>e)),c=(o.length-s.length)/o.length*100,u=s.reduce(((e,t)=>{const{wtnRating:n,confidence:r}=t;return e.totalWTN+=n,e.totalConfidence+=r,e}),{totalWTN:0,totalConfidence:0}),d=s?.length?u.totalWTN/s.length:0,p=s?.length?u.totalConfidence/s.length:0,l=Object.values(i).reduce(((e,t)=>e+(t||0)),0);return{matchUpFormatCounts:i,matchUpsCount:l,avgConfidence:p,pctNoRating:c,avgWTN:d}}const ND={getStructureReports:function({firstFlightOnly:e=!0,extensionProfiles:t,tournamentRecord:n}){if(!n)return{error:H};const r={},i=Object.assign({},...(t??[]).map((({name:e,label:t,accessor:r})=>{const i=As({tournamentRecord:n,name:e})?.extension?.value;return{[t||e]:r?oi({element:i,accessor:r})?.value:i}}))),a=n?.tournamentId,o=rh({participantsProfile:{withScaleValues:!0},tournamentRecord:n}).matchUps??[],s=e=>{const t=zf({itemType:gc,itemSubTypes:[Ps],element:{timeItems:e}})?.timeItem;return t?.itemValue?.scaleBasis},c=n?.events?.flatMap((({timeItems:t,drawDefinitions:n=[],extensions:c,eventType:u,eventId:d,category:p})=>{const l=c?.find((e=>e.name===ko)),m=l?.value?.flights?.map((e=>({[e.drawId]:e.flightNumber}))),f=m&&Object.assign({},...m),h=c?.find((e=>e.name===Oo))?.value?.length||0,I=Object.values(f),g=f&&Math.min(...I),U=s(t);return r[d]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:h,seedingBasis:U?JSON.stringify(U):void 0,tournamentId:a,eventId:d},n.filter((t=>!e||!m||f[t.drawId]===g)).flatMap((e=>{const{matchUpFormat:t,tieFormat:n,timeItems:c,extensions:l,structures:m,drawType:h,drawId:I}=e,{matchUpFormatCounts:g,matchUpsCount:y,avgConfidence:v,pctNoRating:S,avgWTN:w}=bD({eventType:u,matchUps:o,drawId:I}),P=s(c)||U,T=function({extensions:e}){return e?.find((({name:e})=>e===bo))?.value?.slice(1)}({extensions:l}),D=T?.length||0;return r[d].totalPositionManipulations+=D,r[d].generatedDrawsCount+=1,D>r[d].maxPositionManipulations&&(r[d].maxPositionManipulations=D),m?.filter((e=>1===e.stageSequence&&[rd,nd,id,od].includes(e.stage))).map((e=>{const r=[nd,od].includes(e.stage)?o.find((t=>t.structureId===e.structureId&&1===t.finishingRound&&t.winningSide)):void 0,s=r?.sides?.find((e=>e.sideNumber===r.winningSide)),c=s?.participant,l=c?.participantType===zu&&c.participantId,m=c?.participantType===Wu?c.individualParticipants:[],U=RD({participant:m?.[0]||c,eventType:u}),{personId:D,personOtherId:R,tennisId:b,confidence:N,wtnRating:M}=U||{},A=RD({participant:m?.[1],eventType:u}),{personId:E,personOtherId:C,tennisId:O,confidence:F,wtnRating:k}=A||{},{ageCategoryCode:x,categoryName:_,subType:L}=p??{},B=e.matchUpFormat||t,V=(g[B]||0)/y*100,{tieFormatName:j,tieFormatDesc:G}=Ah(n),{tieFormatName:q,tieFormatDesc:$}=Ah(e.tieFormat),W=G===$,H=!W&&q,z=e.tieFormat&&!W&&$,Y=T?.filter((t=>t.structureId===e.structureId))?.length||0;return{...i,tournamentId:a,eventId:d,structureId:e.structureId,drawId:I,eventType:u,category:L,categoryName:_,ageCategoryCode:x,flightNumber:f[I],drawType:h,stage:e.stage,seedingBasis:P?JSON.stringify(P):void 0,winningPersonId:D,winningPersonOtherId:R,winningPersonTennisId:b,winningPersonWTNrating:M,winningPersonWTNconfidence:N,winningPerson2Id:E,winningPerson2OtherId:C,winningPerson2TennisId:O,winningPerson2WTNrating:k,winningPerson2WTNconfidence:F,winningTeamId:l,positionManipulations:Y,pctNoRating:S,matchUpFormat:B,pctInitialMatchUpFormat:V,matchUpsCount:y,drawTieFormatName:j,drawTieFormatDesc:G,tieFormatName:H,tieFormatDesc:z,avgConfidence:v,avgWTN:w}}))}))}));return{eventStructureReports:Object.values(r),structureReports:c}},getEntryStatusReports:function({tournamentRecord:e}){if(!e)return{error:$};const t=e.tournamentId,{participantMap:n}=Kg({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:e,withDraws:!0}),r=(rh({matchUpFilters:{matchUpTypes:[xi,Li]},tournamentRecord:e}).matchUps??[]).flatMap((({sides:e,matchUpType:t})=>e?.flatMap((e=>t===Li?e?.participant?.individualParticipantIds:e?.participant?.participantId||e.participantId)).filter(Boolean))).filter(Boolean),i=[],a={},o={},s={};let c=0;const u=({id:e,entry:r,eventId:o,eventType:s})=>{const{qualifyingSeeding:c,mainSeeding:u,entryStatus:d,entryStage:p,drawId:l}=r;a[e]||(a[e]=[]);const{participant:m,events:f}=n?.[e]??{},h=RD({participant:m,eventType:s}),I=f?.[o]?.ranking;d===Mf&&i.push(e),a[e].push({participantType:m?.participantType,participantId:e,tournamentId:t,eventType:s,eventId:o,drawId:l,entryStatus:d,entryStage:p,...h,ranking:I,mainSeeding:u,qualifyingSeeding:c})};for(const m of e.events??[]){const e={},i=t=>{e[t]||(e[t]={count:0}),e[t].count+=1},{drawDefinitions:a=[],eventType:d,eventId:p}=m,l=a.flatMap((e=>{const{drawId:t,entries:r}=e;c+=1;const a=(e.structures??[]).filter((({stage:e,stageSequence:t})=>e===nd&&1===t||e===rd)).flatMap((({positionAssignments:e})=>e)).filter(Boolean).map((({participantId:e})=>e));return r?.filter((({participantId:e})=>a.includes(e))).map((e=>{const{participantId:r,entryStatus:a,entryStage:o}=e;i(a);const s=n?.[r]?.draws?.[t]?.seedAssignments?.[nd],c=n?.[r]?.draws?.[t]?.seedAssignments?.[rd];return{qualifyingSeeding:c,participantId:r,mainSeeding:s,entryStatus:a,entryStage:o,drawId:t}}))})),f=e=>{const t=e.participantId,i=n?.[t].participant.individualParticipantIds?.filter((e=>r.includes(e)));return t&&{[t]:{individualParticipantIds:i}}};d===xu?(()=>{const e=Object.assign({},...l.map(f).filter(Boolean));l.forEach((t=>{e[t.participantId].individualParticipantIds.forEach((e=>{u({id:e,eventType:d,eventId:p,entry:t})}))}))})():l.forEach((e=>{u({id:e?.participantId,eventType:d,eventId:p,entry:e})}));const h=Object.values(e).reduce(((e,t)=>e+t.count),0);Object.keys(e).forEach((t=>{e[t].pct=e[t].count/h*100})),s[p]={tournamentId:t,eventId:p,entries:l,entryStatuses:e};const I=Object.assign({},...bp.flatMap((t=>[{[t+"_count"]:e[t]?.count},{[t+"_pct"]:e[t]?.pct}])));o[p]={tournamentId:t,eventId:p,...I}}const d=Object.values(n??{}).filter((({participant:{participantType:e,participantRole:t}})=>e===qu&&t===jT)),p=d.filter((({participant:e})=>!r.includes(e.participantId))).map((({participant:e})=>e.participantId)),l={nonParticipatingEntriesCount:p.length,individualParticipantsCount:d.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:p,drawDefinitionsCount:c,tournamentId:t};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:i,tournamentEntryReport:l}},getParticipantStats:function({withCompetitiveProfiles:e,opponentParticipantId:t,withIndividualStats:n,teamParticipantId:r,tournamentRecord:i,withScaleValues:a,tallyPolicy:o,matchUps:s}){if(!i)return{error:$};if(s&&!Array.isArray(s))return{error:tt};if(s=s??rh({tournamentRecord:i,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!s?.length)return{error:Ze};const c=[];t&&c.push(t),r&&c.push(r);const u=Kg({participantFilters:c.length?{participantIds:c}:{participantTypes:[zu]},tournamentRecord:i}).participants??[];if(!u.every((({participantType:e})=>e===zu)))return{error:Ct};c.length||c.push(...u.map(di("participantId")));const d=new Map,p=new Map,l=new Map,m=new Map,f=(e,t="")=>p.get(e)||p.set(e,{participantName:t,participantId:e,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(e);for(const w of u){const{participantId:e,individualParticipantIds:t}=w;m.set(e,t??[]),f(e,w.participantName)}if(r&&!m.get(r))return Mi({result:{error:Bt},context:{teamParticipantId:r}});if(t&&!m.get(t))return Mi({result:{error:Bt},context:{opponentParticipantId:t}});const h=[],I=e=>{const i=[[],[]];for(const t of e){const e=t.participant;if(e?.participantName){d.set(e.participantId,{participantName:e.participantName,ratings:e.ratings});const t=p.get(e.participantId);t&&(t.participantName=e.participantName)}}const a=({side:e,individualParticipantIds:t})=>e.participantId&&(!t?.length||t.includes(e.participantId))&&[e.participantId]||e.participant?.individualParticipantIds?.length&&(!t?.length||O(t,e.participant?.individualParticipantIds).length===e.participant?.individualParticipantIds?.length)&&e.participant.individualParticipantIds;if(m.size){const o=(t,r)=>{for(const o of e){if(!o.participant)continue;const e=a({individualParticipantIds:r,side:o});if(e?.length){const r=o.sideNumber;if(!r)continue;const a=[t];n&&a.push(...e),i[r-1]=a;const s=p.get(t);for(const t of e.filter(Boolean))s&&!s.competitorIds.includes(t)&&s.competitorIds.push(t)}}};if(r){(!t||e.every((e=>e.participant&&(a({individualParticipantIds:m.get(r),side:e})||a({individualParticipantIds:m.get(t),side:e})))))&&o(r,m.get(r))}else for(const[e,t]of m)o(e,t)}else if(n)for(const t of e){if(!t.participant)continue;const e=a({individualParticipantIds:[],side:t}),n=t.sideNumber;n&&(i[n-1]=e)}return i};for(const w of s){if(!ci(w))return{error:tt};const{matchUpStatus:t,matchUpFormat:n,matchUpType:r,winningSide:i,score:a,sides:s}=w;if(!s||!a||r===Vi||t===ma)continue;const c=I(s);if(!c.filter(Boolean).length)continue;const u=e&&i&&hs({matchUp:w})?.competitiveness;h.push(w);const p=ja({matchUpStatus:t,matchUpFormat:n,tallyPolicy:o,winningSide:i,score:a}),l=Ga({matchUpStatus:t,matchUpFormat:n,tallyPolicy:o,winningSide:i,score:a}),{pointsTally:m,tiebreaksTally:g}=qa({matchUpFormat:n,score:a});c.forEach(((e,n)=>{for(const r of e){const e=d.get(r)?.participantName,a=f(r,e);if(a){const e=(e,t)=>t.forEach(((t,n)=>a[e][n]+=t)),r=n?[...g].reverse():g,o=n?[...m].reverse():m,s=n?[...l].reverse():l,c=n?[...p].reverse():p;if(e("tiebreaks",r),e("points",o),e("games",s),e("sets",c),i){const e=i-1===n?0:1;a.matchUps[e]+=1}if(u){const e=u.toLowerCase();a.competitiveness[e]||(a.competitiveness[e]=[0,0]),a.competitiveness[e][n]+=1}if(t){const e=t.toLowerCase();a.matchUpStatuses[e]||(a.matchUpStatuses[e]=0),a.matchUpStatuses[e]+=1}}}}))}const g=["tiebreaks","matchUps","points","games","sets"],U=["competitive","routine","decisive"],y=new Map,v=(e,t)=>(e??0)+(t??0);for(const[w,P]of p.entries()){for(const e of g){const t=P[e].reduce(v);if(t){const n=P[e][0]/t,r=`${e}Ratio`,i=parseFloat(n.toFixed(2));P[r]=i,l.set(w,!0),y.has(r)||y.set(r,[]),y.get(r)?.push(i)}}for(const e of U){const t=P.competitiveness?.[e]?.reduce(v);if(t){const n=P.competitiveness[e][0]/t,r=`${e}Ratio`,i=parseFloat(n.toFixed(2));P[r]=i}}}if(!r){const e=(e,t)=>t-e;for(const t of p.values())for(const n of g){const r=`${n}Ratio`;if("number"==typeof t[r]){const i=y.get(r)?.sort(e).indexOf(t[r]);if("number"==typeof i&&i>=0){t[`${n}Rank`]=i+1}}}}const S={relevantMatchUps:h,...L};return r?(S.teamStats=p.get(r),t&&(S.opponentStats=p.get(t))):S.participatingTeamsCount=l.size,S.allParticipantStats=[...p.values()],S}};function MD(e){const t=rD(e);if(t.error)return t;const n="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:i,newParticipantId:a,drawDefinition:o,substitution:s,event:c}=e;if(!r||!a)return Mi({result:{error:Lt},stack:n});if(r===a)return{...L};const{inContextDualMatchUp:u,inContextTieMatchUp:d,collectionPosition:p,collectionId:l,dualMatchUp:m,tieMatchUp:f,tieFormat:h}=t,I=d?.matchUpType,g=d?.sides?.find((e=>e.participant?.participantId===r||e.participant?.individualParticipantIds?.includes(r)));if(!g)return{error:Bt};const U=Kg({tournamentRecord:i,participantFilters:{participantIds:[r,a]}})?.participants??[];if(2!==U.length)return Mi({result:{error:Lt},stack:n});if(U[0].participantType!==U[1].participantType)return Mi({result:{error:Ft},stack:n});const{appliedPolicies:y}=Xo({tournamentRecord:i,drawDefinition:o,event:c}),v=e.policyDefinitions?.[lo]??y?.[lo]??BI[lo],S=U.find((({participantId:e})=>e===a));if(!1!==(e.enforceGender??v?.participants?.enforceGender)&&[Ei,Fi].includes(d?.gender)&&d?.gender!==S?.person?.sex)return{error:At,info:"Gender mismatch"};const w=v?.processCodes?.substitution;cl({tournamentId:i.tournamentId,eventId:c.eventId,inContextDualMatchUp:u,drawDefinition:o,dualMatchUp:m});const P=m?.sides?.find((({sideNumber:e})=>e===g.sideNumber));if(!P)return Mi({result:{sideNumber:g.sideNumber,existingParticipantId:r,error:Gn},stack:n});const T=d?.sides?.flatMap((e=>e.participant?.individualParticipantIds||e.participant?.participantId||[]));if(T?.includes(a))return Mi({result:{error:Yt},stack:n});const D=u?.sides?.find((({sideNumber:e})=>e===g.sideNumber))?.participantId,R=P.lineUp,b=R?.find((({participantId:e})=>a===e)),N=R?.reduce(((e,t)=>t.substitutionOrder>e?t.substitutionOrder:e),0),M=R?.map((e=>{const t=ii(e,!1,!0);if(![r,a].includes(t.participantId))return t;if(!s&&[r,a].includes(t.participantId)&&(t.collectionAssignments=t.collectionAssignments?.filter((e=>!(e.collectionPosition===p&&e.collectionId===l)))),s&&r===t.participantId&&(t.collectionAssignments=t.collectionAssignments.map((e=>e.collectionPosition===p&&e.collectionId===l&&void 0===e.substitutionOrder?{...e,substitutionOrder:N}:e))),t.participantId===a){t.collectionAssignments||(t.collectionAssignments=[]);const e={collectionId:l,collectionPosition:p};s&&(e.previousParticipantId=r,e.substitutionOrder=(N??0)+1),t.collectionAssignments.push(e)}return t}))??[];if(!b){const e={collectionId:l,collectionPosition:p};s&&(e.substitutionOrder=(N??0)+1,e.previousParticipantId=r);const t={collectionAssignments:[e],participantId:a};M.push(t)}const A=I===Bi,{assignedParticipantIds:E}=ju({lineUp:R,collectionPosition:p,collectionId:l}),{assignedParticipantIds:C}=ju({lineUp:M,collectionPosition:p,collectionId:l});if(P.lineUp=M,D&&h){const e=wy({participantId:D,lineUp:M,drawDefinition:o,tieFormat:h});if(e.error)return Mi({result:e,stack:n})}else console.log("team participantId not found");let O,F;if(A){const{tournamentRecord:t}=e;let r=Xu({participantIds:C,tournamentRecord:t});if(!r.participant){const e=By({returnParticipant:!0,pairOverride:!0,tournamentRecord:t,participant:{participantRole:jT,individualParticipantIds:C,participantType:Wu}});if(e.error)return Mi({result:e,stack:n});O=e.participant?.participantId}r=Xu({participantIds:E,tournamentRecord:t});const i=r.participant?.participantId;if(i){EP({participantIds:[i],tournamentRecord:t}).success&&(F=i)}}if(s||1===g.substitutions?.length){if(s){const e=f?.processCodes??[];w&&e.push(...w),f&&(f.processCodes=e)}else for(const e of w||[]){const t=f?.processCodes?.lastIndexOf(e);void 0!==t&&f?.processCodes?.splice(t,1)}f&&rl({tournamentId:i?.tournamentId,matchUp:f,context:n,drawDefinition:o})}return m&&rl({tournamentId:i?.tournamentId,matchUp:m,context:n,drawDefinition:o}),{...L,modifiedLineUp:M,participantRemoved:F,participantAdded:O}}function AD({tournamentRecord:e,drawDefinition:t,stage:n=nd,structureId:r,structure:i}){if(!e)return{error:$};if(!i&&!t)return{error:Y};if(i||r||1!==t?.structures?.filter((e=>e.stage===n)).length||(i=t.structures.find((e=>e.stage===n))),!i&&!r)return{error:Te};const{error:a,positionAssignments:o}=op({drawDefinition:t,structureId:r,structure:i});return{positionAssignments:o??[],structureId:i?.structureId,error:a}}function ED(e){if(!e.tournamentRecord)return{error:$};const t="deleteDrawDefinitions";let n=e.drawIds??[],r=e.event;const{autoPublish:i=!0,tournamentRecord:a,auditData:o,eventId:s,force:c}=e,{appliedPolicies:u}=Xo({tournamentRecord:a,event:r}),d={...u,...e.policyDefinitions},p=Array.isArray(n)?n[0]:void 0;if(!r){const e=Qs({tournamentRecord:a,eventId:s,drawId:p});if(e.error)return e;r=e.event}const l=[],m=[],f=[];if(!r?.drawDefinitions)return Mi({info:"event has no drawDefinition",result:{...L},stack:t});const h=r.drawDefinitions.map((({drawId:e})=>e));if(n.length||(n=h),n=n.filter((e=>h.includes(e))),!n.length)return Mi({info:"nothing to do; no matching drawIds in event.",result:{...L},stack:t});const I=ii(Ks({event:r}).flightProfile,!1,!0),g=({participantId:e,drawPosition:t,qualifier:n,bye:r})=>({bye:r,qualifier:n,drawPosition:t,participantId:e}),U=c||u?.[vo]?.allowDeletionWithScoresPresent?.drawDefinitions,y=[],v=r.drawDefinitions.filter((e=>{if(n.includes(e.drawId)){const t=ih({event:r,drawDefinition:e})?.matchUps??[];if(t.some((({score:e})=>dl({score:e})))&&!U)return y.push(e.drawId),!0;const{drawId:n,drawType:i,drawName:c}=e,u=I?.flights?.find((t=>t.drawId===e.drawId));u&&(u.drawEntries=u.drawEntries?.filter((e=>Mp.includes(e.entryStatus))));const d=ip({stageSequence:1,drawDefinition:e,stage:nd})?.structures?.[0],p=d?AD({structureId:d.structureId,tournamentRecord:a,drawDefinition:e}):void 0,h=p?.positionAssignments?.map(g),v=ip({stage:rd,drawDefinition:e})?.structures,S=v?.length?v.map((t=>{const n=t.stageSequence,r=AD({structureId:t.structureId,tournamentRecord:a,drawDefinition:e}),i=r?.positionAssignments.map(g);return{positionAssignments:i,stageSequence:n}})):void 0,w={action:$v,payload:{drawDefinitions:[e],eventId:s??r?.eventId,auditData:o}};f.push(w),l.push(pi({tournamentId:a.tournamentId,eventId:s??r?.eventId,qualifyingPositionAssignments:S,positionAssignments:h,auditData:o,drawType:i,drawName:c,drawId:n})),t?.forEach((({matchUpId:e})=>m.push(e)))}return!n.includes(e.drawId)}));if(y.length&&!c)return Mi({context:{drawIdsWithScoresPresent:y},result:{error:Xn},stack:t});if(r.drawDefinitions=v,I){rc({event:r,extension:{name:ko,value:I}})}ES({tournamentRecord:a});const S=`${Uu}.${vu}`,{timeItem:w}=zf({element:r,itemType:S}),P=w?.itemValue?.[yu];let T;for(const D of n){const e=P?.drawIds?.includes(D);if(e){T=!0;const e=P.drawIds?.filter((e=>e!==D))||[],t=PU({event:r,timeItem:{itemType:`${Uu}.${vu}`,itemValue:{[yu]:{drawIds:e}}}});if(t.error)return{error:t.error}}}if(f.length&&pr({topic:yc,payload:f}),m.length&&nl({tournamentId:a?.tournamentId,matchUpIds:m}),n.forEach((e=>{!function({tournamentId:e,eventId:t,drawId:n}){pr({payload:{drawId:n,tournamentId:e,eventId:t},topic:wc,key:n}),mr({key:n})}({drawId:e})})),function({event:e,deletedDrawsDetail:t,auditData:n}){const{extension:r}=lc({name:Oo,element:e}),i={...n,deletedDrawsDetail:t},a={name:Oo,value:Array.isArray(r?.value)?r?.value.concat(i):[i]};Js({element:e,extension:a})}({event:r,deletedDrawsDetail:l,auditData:o}),i&&T){const e=eD({tournamentRecord:a,event:r,policyDefinitions:d});e.error&&console.log("publish error",e)}return{...L}}function CD({consideredEntries:e,policyDefinitions:t,tournamentRecord:n,appliedPolicies:r,participantMap:i,enforceGender:a,participants:o,event:s}){if(o&&i||!n||({participants:o,participantMap:i}=Kg({tournamentRecord:n})),!o)return{error:_t};if(!Array.isArray(o))return{error:xn};if(!s)return{error:Ae};const c=t?.[lo]??r?.[lo]??BI[lo],u=!1!==(a??c?.participants?.enforceGender),{eventType:d,gender:p}=s,l=d===xu,m=d===Lu&&Hu||l&&Wu||qu,f=Object.assign({},...(e??s.entries??[]).map((e=>({[e.participantId]:e.entryStatus})))),h=Object.keys(f),I=o.filter((e=>h.includes(e.participantId))).filter((e=>{const t=f[e.participantId],n=d&&[Yi.Doubles,Yi.Team].includes(d)&&e.participantType===qu&&(UP(t)||t===Pp),r=e.participantType!==m&&!n,a=!r&&l&&P(e?.individualParticipantIds?.map((e=>i?.[e]?.participant?.person?.sex)).filter(Boolean)??[]),o=!p||!a?.length||Qi.Any===p||[Qi.Male,Qi.Female].includes(p)&&a[0]===p||Qi.Mixed===p&&(1==a.length&&1===e.individualParticipantIds?.length||2===a.length),s=e?.person?.sex,c=!e?.person||!p||[Qi.Any,Qi.Mixed].includes(p)||[Qi.Male,Qi.Female].includes(p)&&s===p;return r||!(!u||o&&c)}));if(I.length){const e=I.map((e=>e.participantId));return{error:Fe,invalidParticipantIds:e}}return{...L,valid:!0}}const OD="COLLEGE_DEFAULT",FD="COLLEGE_JUCO",kD="COLLEGE_D3",xD="DOMINANT_DUO",_D="DOMINANT_DUO_MIXED",LD="LAVER_CUP",BD="TEAM_DOUBLES_3_AGGREGATION",VD="TIME_TENNIS_DUAL",jD="TIME_TENNIS_PRO_CIRCUIT",GD="USTA_BREWER_CUP",qD="USTA_OZAKI_CUP",$D="USTA_COLLEGE",WD="USTA_GOLD_TEAM_CHALLENGE",HD="USTA_LEVEL_1",zD="USTA_INTERSECTIONAL",YD="USTA_SECTION_BATTLE",KD="USTA_SOUTHERN_LEVEL_5",QD="USTA_TOC",JD="USTA_WTT_ITT",XD="USTA_ZONAL",ZD={COLLEGE_D3:kD,COLLEGE_DEFAULT:OD,COLLEGE_JUCO:FD,DOMINANT_DUO:xD,DOMINANT_DUO_MIXED:_D,LAVER_CUP:LD,TEAM_DOUBLES_3_AGGREGATION:BD,TIME_TENNIS_DUAL:VD,TIME_TENNIS_PRO_CIRCUIT:jD,USTA_BREWER_CUP:GD,USTA_OZAKI_CUP:qD,USTA_COLLEGE:$D,USTA_GOLD_TEAM_CHALLENGE:WD,USTA_INTERSECTIONAL:zD,USTA_LEVEL_1:HD,USTA_SECTION_BATTLE:YD,USTA_SOUTHERN_LEVEL_5:KD,USTA_TOC:QD,USTA_WTT_ITT:JD,USTA_ZONAL:XD},eR="STANDARD",tR={[eR]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[kD]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:Ba,matchUpCount:6,matchUpValue:1},tieFormatName:kD,valueGoal:5},[OD]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:Ba},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Ba},tieFormatName:OD,valueGoal:4},[FD]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Ba},tieFormatName:FD,valueGoal:5},[LD]:Qm,[xD]:Ym,[_D]:Km,[BD]:Jm,[VD]:Xm,[jD]:Zm,[GD]:ef,[qD]:tf,[$D]:nf,[WD]:rf,[zD]:af,[HD]:of,[YD]:sf,[KD]:cf,[JD]:df,[QD]:uf,[XD]:pf},nR=e=>{const t=e?.namedFormat&&Object.keys(tR).includes(e.namedFormat)?e.namedFormat:eR,n=Array.isArray(e?.uuids)?e?.uuids:[];let r;const{category:i,gender:a}=e?.event??{},o=ii(tR[t],!1,!0);return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:n?.pop()??Ii(),matchUpFormat:Va,matchUpType:Yi.Doubles,collectionName:"Doubles",...o.doubles},{collectionId:n?.pop()??Ii(),matchUpType:Yi.Singles,matchUpFormat:Ba,collectionName:"Singles",...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((e=>e.collectionId=Ii())),r=o),e?.hydrateCollections&&r.collectionDefinitions.forEach((e=>{i&&!e.category&&(e.category=i),a&&!e.gender&&(e.gender=a)})),r};function rR({suppressNotifications:e,tournamentRecord:t,internalUse:n,event:r}){if(!t)return{error:$};if(t.events||(t.events=[]),!r)return{error:Ae};const{startDate:i,endDate:a}=t;if(!n&&(r.entries?.length||r.drawDefinitions?.length)){const e=pi({drawDefinitions:!!r.drawDefinitions?.length,entries:!!r.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:xn,context:e}}const o={drawDefinitions:[],eventType:Yi.Singles,entries:[],startDate:i,endDate:a,...r};if(r.eventType===Yi.Team)if(r.tieFormat){const e=ca({tieFormat:r.tieFormat,eventType:r.eventType});if(e.error)return e}else if(r.tieFormatName){if(!lf[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:xn};const e=nR({namedFormat:r.tieFormatName});o.tieFormat=e}o.eventId||(o.eventId=Ii());if(t.events.reduce(((e,t)=>e||t.eventId===o.eventId),void 0))return{error:Ce};{const n=o;if(t.events.push(n),!e){const{topics:e}=hr();if(e.includes(hc)){const e=ah({event:r}).matchUps??[];tl({tournamentId:t?.tournamentId,eventId:r.eventId,matchUps:e})}for(const t of r.drawDefinitions||[])il({drawDefinition:t})}return{...L,event:o}}}function iR({tournamentRecord:e,drawDefinition:t,participantIds:n,stageSequence:r,stage:i=nd,eventId:a,event:o}){if(!e)return{error:$};if(!Array.isArray(n))return{error:xn,participantIds:n};if(!o)return{error:Ae};if(o){const e=aR({element:o,participantIds:n,stageSequence:r,stage:i});if(e.error)return e}if(t){const e=aR({element:t,participantIds:n,stageSequence:r,stage:i});if(e.error)return a?Mi({context:{drawPromotionError:e.error,drawId:t.drawId},result:{...L},stack:"promoteAlternates"}):e}return{...L}}function aR({participantIds:e,stageSequence:t,element:n,stage:r}){const i=(n.entries||[]).filter((e=>e.entryStatus===dp)),a=(n.entries||[]).filter((t=>e.includes(t.participantId))),o=i.reduce(((e,t)=>{const{entryPosition:n}=t;return isNaN(n)&&e||(!e||n<e.entryPosition)&&t||e}),void 0),s=a.length?a:[o].filter(Boolean);if(!s?.length)return{error:Jt};const c=s.filter((({entryStatus:e})=>e!==dp));if(c.length)return{error:Qt,invalidEntryStatus:c};const u=s.filter((({entryStage:e})=>e&&e!==r));if(u.length)return{error:Xt,invalidStage:u};const d=t&&s.filter((e=>e.stageSequence!==t));if(d?.length)return{error:Zt,invalidStageSequence:d};for(const p of s){p.entryStatus=lp;const e=p?.entryPosition;isNaN(e)||n.entries.forEach((t=>{t.entryStatus===dp&&t.entryPosition>e&&(t.entryPosition=t.entryPosition-1)}));const t=Math.max(...n.entries.filter((e=>e.entryStatus===lp&&!isNaN(e.entryPosition))).map((({entryPosition:e})=>m(e||0))),0);p.entryPosition=t||0}return{...L}}function oR(e){return fh(e)}function sR({tournamentRecord:e,drawDefinition:t,participantId:n,entryPosition:r,skipRefresh:i,event:a}){if(!e)return{error:$};if(!n)return Mi({result:{error:Lt},stack:"setEntryPositions"});if(void 0!==r&&!Number.isSafeInteger(r))return{error:xn,entryPosition:r};(a?.entries||[]).forEach((e=>{e.participantId===n&&(e.entryPosition=r)})),(t?.entries||[]).forEach((e=>{e.participantId===n&&(e.entryPosition=r)}));const o=e=>{e.entries.forEach((e=>{e.entryPosition===r&&e.participantId!==n&&(e.entryPosition+=.1)}))};return i||(a?.entries&&(o(a),a.entries=gP({entries:a.entries})),t?.entries&&(o(t),t.entries=gP({entries:t.entries}))),{...L}}function cR({tournamentRecord:e,scaleAttributes:t,drawDefinition:n,entryStatuses:r,drawId:i,event:a,stage:o}){if(!a)return{error:Ae};if(r&&!Array.isArray(r))return Mi({result:{error:xn},info:sa("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(i){const{flightProfile:e}=Ks({event:a}),t=e?.flights?.find((e=>e.drawId===i));s=t?t.drawEntries:n?.entries}return function({tournamentRecord:e,scaleAttributes:t,participantIds:n}){if(!e)return{error:$};if(!n)return{error:Gt};if(!t)return{error:mt,info:"scaleAttributes required"};const{scaleType:r,eventType:i,scaleName:a}=t,o=[fu,r,i,a].join(".");return e.participants?.forEach((e=>{n.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter((e=>e&&e?.itemType!==o)))})),{...L}}({tournamentRecord:e,scaleAttributes:t,participantIds:(s||[]).filter((e=>(!o||!e.entryStage||e.entryStage===o)&&(!r||r.includes(e.entryStatus)))).map(Sl)})}function uR({tournamentRecord:e,scaleAttributes:t,participantId:n}){if(!e)return{error:$};if(!n)return{error:Lt};const{participant:r}=bs({tournamentRecord:e,participantId:n});return r?zh({participant:r,scaleAttributes:t}):{error:Bt}}function dR({sortDescending:e=!1,tournamentRecord:t,scaleAttributes:n,scaleSortMethod:r,stageSequence:i,entries:a,event:o,stage:s}){if(!t)return{error:$};return{scaledEntries:(a=a??o?.entries??[]).filter((e=>(!s||!e.entryStage||e.entryStage===s)&&(!i||!e.entryStageSequence||e.entryStageSequence===i)&&bp.includes(e.entryStatus))).map((e=>{const{participantId:r}=e,{scaleItem:i}=uR({tournamentRecord:t,scaleAttributes:n,participantId:r});return{...e,...i}})).filter((e=>{const t=e.scaleValue;return!!(r||!isNaN(t)&&parseFloat(t))&&t})).sort(r||function(t,n){return e?c(n)-c(t):c(t)-c(n)})};function c(t){return parseFloat(t.scaleValue||(e?-1:1e5))}}function pR({event:e,orderedDrawIdsMap:t}){if("object"!=typeof e)return{error:Ae};if(!t)return{error:mt,info:"Missing drawIdsOrderMap"};if("object"!=typeof t)return{error:xn,info:"orderedDrawIdsMap must be an object"};const n=Object.values(t);if(!n.every((e=>!isNaN(e))))return{error:xn,info:"drawOrder must be numeric"};if(P(n).length!==n.length)return{error:xn,info:"drawOrder values must be unique"};if(e.drawDefinitions?.length){const n=(e.drawDefinitions||[]).map((({drawId:e})=>e)),r=Object.keys(t);if(r?.length&&O(n,r).length!==n.length)return{error:xn,info:"Missing drawIds"};e.drawDefinitions.forEach((e=>{e.drawOrder=t[e.drawId]}))}const{flightProfile:r}=Ks({event:e});return r?.flights?.forEach((e=>{e.flightNumber=t[e.drawId]})),{...L}}function lR({tournamentRecord:e,event:t}){if(!e)return{error:$};if(!t)return{error:Ae};const{flightProfile:n}=Ks({event:t}),r=n?.flights&&Object.assign({},...n.flights.sort(((e,t)=>e.flightNumber-t.flightNumber)).map(((e,t)=>({[e.drawId]:t+1}))))||t.drawDefinitions?.length&&Object.assign({},...t.drawDefinitions.sort(((e,t)=>e.drawOrder-t.drawOrder)).map(((e,t)=>({[e.drawId]:t+1}))))||void 0;return r?pR({event:t,orderedDrawIdsMap:r}):{...L}}function mR({deleteExisting:e,event:t,flightProfile:n}){const r="attachFlightProfile";if(!n)return Mi({result:{error:mt},stack:r});if(!t)return Mi({result:{error:Ae},stack:r});const{flightProfile:i}=Ks({event:t});if(i&&!e)return Mi({result:{error:Wn},stack:r});if(t.drawDefinitions?.length)return Mi({result:{error:K},stack:r});return rc({event:t,extension:{name:ko,value:n}}),{flightProfile:ii(n,!1,!0),...L}}const fR="splitWaterfall",hR="splitShuttle",IR={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:fR,SPLIT_SHUTTLE:hR};function gR({tournamentRecord:e,drawDefinition:t,flightProfile:n,drawName:r,drawId:i,event:a}){if(!r||"string"!=typeof r)return Mi({result:{error:xn},context:{drawName:r}});n||(n=Ks({event:a}).flightProfile);const o=n?.flights?.find((e=>e.drawId===i));if(o){o.drawName=r;rc({event:a,extension:{name:ko,value:{...n,flights:n.flights}}})}return t&&(t.drawName=r,al({tournamentId:e?.tournamentId,drawDefinition:t})),o||t?{...L,flight:o}:{error:Y}}function UR({qualifyingPositions:e,drawEntries:t=[],drawName:n,drawId:r,event:i,stage:a}){const o="addFlight";if(!i)return Mi({result:{error:Ae},stack:o});if(!n)return Mi({result:{error:mt},stack:o});if(t?.length){const e=(i.entries??[]).map(di("participantId")),n=t.map(di("participantId"));if(O(n,e).length!==n.length)return Mi({result:{error:xn},stack:o})}const s=Ks({event:i})?.flightProfile,c=s?.flights?.map((({flightNumber:e})=>!isNaN(e)&&m(e)))?.filter(Boolean)||[],u=Math.max(0,...c)+1,d={drawId:r||Ii(),flightNumber:u,drawEntries:t,drawName:n};a&&(d.stage=a),e&&(d.qualifyingPositions=e);if((s?.flights||[]).find((({drawId:e})=>e===d.drawId)))return Mi({result:{error:$n},stack:o});const p=(s?.flights||[]).concat(d);return rc({event:i,extension:{name:ko,value:{...s||{},flights:p}}})}function yR({itemType:e="attachStructures",matchUpModifications:t,tournamentRecord:n,drawDefinition:r,structures:i,links:a}){if(!n)return{error:$};if(!r)return{error:Y};const o=nP({matchUpModifications:t,tournamentRecord:n,drawDefinition:r,structures:i,links:a});if(o.error)return o;const s=i?.map((({structureId:e})=>e));return wU({tournamentRecord:n,timeItem:{itemValue:{structureIds:s,drawId:r.drawId},itemType:e}}),o}function vR({tournamentRecord:e,event:t,startDate:n}){if(!e)return{error:$};if(!t)return{error:Ae};if(!Nr.test(n))return{error:yt};const r=wR(e);if(r.error)return r;const{tournamentStartDate:i,tournamentEndDate:a}=r,o=new Date(Wr(n)).getTime();if(!i||!a||o<i||o>a)return{error:yt};const s=t.endDate&&new Date(Wr(t.endDate));return s&&o>s&&(t.endDate=n),t.startDate=n,{...L}}function SR({tournamentRecord:e,event:t,endDate:n}){if(!e)return{error:$};if(!t)return{error:Ae};if(!Nr.test(n))return{error:yt};const r=wR(e);if(r.error)return r;const{tournamentStartDate:i,tournamentEndDate:a}=r,o=new Date(Wr(n)).getTime();if(!i||!a||o<i||o>a)return{error:yt};const s=t.startDate&&new Date(Wr(t.startDate));return s&&o<s&&(t.startDate=n),t.endDate=n,{...L}}function wR(e){const{startDate:t,endDate:n}=e;return Nr.test(t)&&Nr.test(n)?{tournamentStartDate:new Date(Wr(t)).getTime(),tournamentEndDate:new Date(Wr(n)).getTime()}:Mi({result:{error:St},context:{startDate:t,endDate:n}})}function PR(e){const t="prepareStage";let{seedsCount:n}=e;const r=e.preparedStructureIds||[],{provisionalPositioning:i,inContextDrawMatchUps:a,tournamentRecord:o,appliedPolicies:s,qualifyingOnly:c,drawDefinition:u,seedingProfile:d,participants:p,matchUpsMap:l,automated:m,placeByes:f,drawType:h,drawSize:I,entries:g,event:U,enforcePolicyLimits:y=!0,seedAssignmentProfile:v,seedByRanking:S=!0,seededParticipants:w,assignSeedsCount:P,seedingScaleName:T,stageSequence:D=1,roundTarget:R,stage:b}=e,N=U?.eventType,M=g.filter((e=>{const t=Ms({name:qo,element:e})?.extension?.value;return(!e.entryStage||e.entryStage===b)&&(!D||!e.entryStageSequence||e.entryStageSequence===D)&&(!R||!t||t===R)&&Rp.includes(e.entryStatus)}));w&&(n=w.length),n>I&&(n=I),n>M.length&&(n=M.length);const{structures:A}=ip({drawDefinition:u,stageSequence:D,roundTarget:R,stage:b}),E=(A?.length||0)>1,C=A?.find((({structureId:e})=>!r.includes(e)));if(!C)return Mi({result:{error:De},stack:t});const O=C?.structureId,F=C?iU({provisionalPositioning:i,appliedPolicies:s,drawDefinition:u,seedingProfile:d,structure:C}):void 0,{seedLimit:k}=pP({participantsCount:M.length,enforcePolicyLimits:y,appliedPolicies:s,drawDefinition:u,seedingProfile:d,structureId:O,seedsCount:n});k&&k<n&&(n=k);const x=g.map(Sl);if(w)w.filter((({participantId:e})=>x.includes(e))).filter((e=>!e.seedNumber||e.seedNumber<=w.length)).sort(((e,t)=>e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0)).forEach((e=>{const{participantId:t,seedNumber:n,seedValue:r}=e;yy({provisionalPositioning:i,tournamentRecord:o,drawDefinition:u,seedingProfile:d,participantId:t,seedBlockInfo:F,structureId:O,seedNumber:n,seedValue:r,event:U})}));else if(U||T){const{categoryName:e,ageCategoryCode:t}=U?.category||{},r={scaleType:Ps,scaleName:T||e||t||U.eventId,eventType:N};let{scaledEntries:a}=dR({scaleAttributes:r,tournamentRecord:o,stageSequence:D,entries:g,stage:b});if(!a?.length&&S){const n={scaleName:e||t,scaleType:vs,eventType:N};({scaledEntries:a}=dR({scaleAttributes:n,tournamentRecord:o,stageSequence:D,entries:g,stage:b}))}const s=a?.length??0;s<n&&(n=s),a?.filter((({participantId:e})=>x.includes(e))).slice(0,P||n).forEach(((e,t)=>{const n=t+1,{participantId:r,scaleValue:a}=e;yy({provisionalPositioning:i,tournamentRecord:o,drawDefinition:u,seedingProfile:d,participantId:r,structureId:O,seedNumber:n,seedValue:v?.[n]||a||n,event:U})}))}let _,L,B=[];if(!1!==m&&h!==Dd&&(!c||b===rd)){const e="object"==typeof m&&m.seedsOnly,n=Ww({inContextDrawMatchUps:a,multipleStructures:E,tournamentRecord:o,appliedPolicies:s,drawDefinition:u,seedingProfile:d,participants:p,structureId:O,matchUpsMap:l,placeByes:f,seedLimit:k,seedsOnly:e,drawSize:I,drawType:h,event:U});if(n.conflicts&&(B=n?.conflicts),_=n?.positionAssignments,L=n?.positioningReport,n.error)return Mi({result:n,stack:t})}return{positionAssignments:_,positioningReport:L,stageEntries:M,structureId:O,seedsCount:n,conflicts:B}}function TR(e){const t="generateDrawDefinition",{considerEventEntries:n=!0,ignoreAllowedDrawTypes:r,voluntaryConsolation:i,hydrateCollections:a,ignoreStageSpace:o,tournamentRecord:s,qualifyingOnly:c,tieFormatName:u,drawEntries:d,addToEvent:p,placeByes:l,event:f}=e,h=Xo({tournamentRecord:s,event:f}).appliedPolicies??{},I=ii(e.policyDefinitions??{},!1,!0),g=(e.drawTypeCoercion??I?.[Po]?.drawTypeCoercion??h?.[Po]?.drawTypeCoercion??!0)&&2===e.drawSize&&qi.SingleElimination||e.drawType||qi.SingleElimination,U=I?.[So]??h?.[So],v=e.seedingProfile??U?.seedingProfile?.drawTypes?.[g]??U?.seedingProfile;e.seedingProfile&&(I[So]||(I[So]={...Wf[So]}),I[So].seedingProfile=v);const{participants:w,participantMap:P}=Kg({withIndividualParticipants:!0,tournamentRecord:s}),T=e.enforceGender??I?.[lo]?.participants?.enforceGender??h?.[lo]?.participants?.enforceGender,D=!r&&s&&TD({tournamentRecord:s,categoryType:f?.category?.categoryType,categoryName:f?.category?.categoryName});if(D?.length&&!D.includes(g))return Mi({result:{error:ce},stack:t});const R=f?.entries?.filter((e=>e.entryStatus&&[...Mp,gp].includes(e.entryStatus)))??[],b=(c&&[]||d||(n?R:[])).filter((({entryStage:e})=>!e||e===nd)),N=f&&w&&CD({consideredEntries:b,appliedPolicies:h,participantMap:P,enforceGender:T,participants:w,event:f});if(N?.error)return Mi({result:N,stack:t});const M=!e.drawSize&&b.length&&![Dd,Ad,Rd,Wd,Hd].includes(g)&&y(b.length)||e.drawSize&&S(e.drawSize)&&m(e.drawSize)||!1;if(isNaN(M)&&g!==Dd)return Mi({result:{error:pe},stack:t});let A="number"!=typeof e.seedsCount?m(e.seedsCount??0):e.seedsCount??0;const C=f?.eventType,O=e.matchUpType??C,F=e.drawId?f?.drawDefinitions?.find((t=>t.drawId===e.drawId)):void 0;let{tieFormat:k,matchUpFormat:x}=e;if(O===ji&&C===ji){const e=F?.structures?.find((({stage:e})=>e===nd))?.tieFormat;k=k||e||u&&f?.tieFormat?.tieFormatName===u&&f.tieFormat||u&&nR({namedFormat:u,hydrateCollections:a,event:f})||f?.tieFormat||nR({event:f,hydrateCollections:a}),x=void 0}else x||(k=void 0,f?.matchUpFormat||(x=Ba));if(k){const e=ca({gender:f?.gender,enforceGender:T,tieFormat:k,event:f});if(e.error)return Mi({result:e,stack:t})}if(e.drawId&&"string"!=typeof e.drawId)return Mi({result:{error:xn},stack:t});F&&g!==F.drawType&&(F.drawType=g);let _=F??IT({drawType:g,drawId:e.drawId,processCodes:e.processCodes});if(x||k){if(!(x&&f?.matchUpFormat===x||f?.tieFormat&&k&&JSON.stringify(f.tieFormat)===JSON.stringify(k))){if(k){const e=function({tieFormat:e,eventType:t}){const n=ca({checkCollectionIds:!1,eventType:t,tieFormat:e});if(n.error)return n;for(const r of e.collectionDefinitions)r.collectionId||(r.collectionId=Ii());return{tieFormat:e}}({eventType:f.eventType,tieFormat:k});if(e.error)return Mi({result:e,stack:t});_.tieFormat=e.tieFormat??k}else if(x){const e=Fy({tournamentRecord:s,drawDefinition:_,matchUpFormat:x,event:f});if(e.error)return{error:e.error,info:"matchUpFormat or tieFormat error"}}O&&(_.matchUpType=O)}}if(I){if("object"!=typeof I)return Mi({info:"policyDefinitions must be an object",result:{error:xn},stack:t});{const e={};for(const t of Object.keys(I))JSON.stringify(h?.[t])!==JSON.stringify(I[t])&&(e[t]=I[t]);Object.keys(e).length&&(aT({drawDefinition:_,policyDefinitions:e}),Object.assign(h,e))}}h[So]||I[So]||(aT({drawDefinition:_,policyDefinitions:Wf}),Object.assign(h,Wf));let B=F?.structures?.find((e=>e.stage===nd&&1===e.stageSequence))?.structureId;const V=d??R,j=[];let G,q=[];const $=e.qualifyingPlaceholder&&!e.qualifyingProfiles?.length&&!F,W=F?F.structures?.filter((e=>e.stage===rd)):[],H=1===W?.length&&!W[0].matchUps?.length&&W[0].structureId;if(H){const t=e.qualifyingProfiles,n=t?.length?rw({idPrefix:e.idPrefix,isMock:e.isMock,uuids:e.uuids,qualifyingProfiles:t,appliedPolicies:h}):void 0;if(n?.error)return n;_.structures=_.structures?.filter((({structureId:e})=>e!==H)),_.links=_.links?.filter((({source:e})=>e.structureId!==H));const{qualifiersCount:r,qualifyingDrawPositionsCount:i,qualifyingDetails:a}=n??{};i&&(n?.structures&&_.structures?.push(...n.structures),n?.links&&_.links?.push(...n.links));const o=_.structures?.find((({stage:e,stageSequence:t})=>e===nd&&1===t)),{qualifiersCount:s}=gw({stageSequence:1,drawDefinition:_,structureId:B,stage:nd});let c=vw({qualifiersCount:Math.max(r??0,s??0),drawDefinition:_,stage:nd});if(c.error)return c;if(c=yw({drawSize:i,stage:rd,drawDefinition:_}),c.error)return c;for(const e of(d??[]).filter((({entryStage:e})=>e===$i.Qualifying))){wP({...e,entryStage:e.entryStage??$i.Main,drawDefinition:_})}for(const e of a||[]){const{finalQualifyingRoundNumber:t,finalQualifyingStructureId:n,roundTarget:r,finishingPositions:i,linkType:a}=e,s=o&&ZS({targetStructureId:o.structureId,sourceStructureId:n,sourceRoundNumber:t,finishingPositions:i,targetEntryRound:r,linkType:a})?.link;if(s?.error)return s;s&&(_.links||(_.links=[]),_.links.push(s))}G={drawDefinition:_}}else{if(G=Sw({...e,modifyOriginal:!1,tournamentRecord:s,appliedPolicies:h,drawDefinition:_,matchUpFormat:x,matchUpType:O,tieFormat:k,drawSize:M}),G.error)return Mi({result:G,stack:t});_=G.drawDefinition;for(const e of V){if(d&&e.entryStage&&e.entryStage!==$i.Main)continue;const n=wP({...e,ignoreStageSpace:o??g===Dd,entryStage:e.entryStage??$i.Main,drawDefinition:_,drawType:g});if(d&&n.error)return Mi({result:n,stack:t})}g===Od&&(A=0);const n=PR({...G,...e,qualifyingOnly:!M||c,appliedPolicies:h,drawDefinition:_,seedingProfile:v,participants:w,stage:nd,seedsCount:A,placeByes:l,drawSize:M,entries:V});if(n.error&&!n.conflicts)return n;if(n.positioningReport?.length&&j.push({[nd]:n.positioningReport}),B=n.structureId,n.conflicts&&(q=n.conflicts),g===Dd&&e.roundsCount){const t=f?.entries?.filter((({entryStage:e,entryStatus:t})=>(!e||e===nd)&&t&&bp.includes(t))),n=t?.map(di("participantId")),r=t?Math.floor(t.length/2):0;E(1,e.roundsCount+1).forEach((()=>{if(e.automated){const{restrictEntryStatus:t,generateMatchUps:r,addToStructure:i,maxIterations:a,structureId:o,matchUpIds:c,scaleName:u}=e.drawMatic??{};JP({tournamentRecord:s,participantIds:n,drawDefinition:_,eventType:e.drawMatic?.eventType??O,generateMatchUps:r??!0,restrictEntryStatus:t,addToStructure:i,maxIterations:a,structureId:o,matchUpIds:c,scaleName:u})}else cP({addToStructure:!0,tournamentRecord:s,newRound:!0,drawDefinition:_,matchUpsCount:r})}))}}const z=[];if(e.qualifyingProfiles){const n=(e,t)=>e.stageSequence-t.stageSequence,r=(e,t)=>e.roundTarget-t.roundTarget,i=[];let a=1;e.qualifyingProfiles.sort(r);for(const o of e.qualifyingProfiles){if(!Array.isArray(o.structureProfiles))return Mi({info:sa("structureProfiles"),result:{error:mt},stack:t});a=o.roundTarget||a;const r=o.structureProfiles?.sort(n)||[];let s=1;for(const t of r){const{qualifyingRoundNumber:n,qualifyingPositions:r,seededParticipants:o,seedingScaleName:u,seedsCount:d=0,seedByRanking:p,placeByes:l,drawSize:m}=t,f=PR({...G,...e,seedingProfile:t.seedingProfile??v,stageSequence:s,qualifyingRoundNumber:n,preparedStructureIds:i,qualifyingPositions:r,seededParticipants:o,stage:rd,seedingScaleName:u,appliedPolicies:h,drawDefinition:_,qualifyingOnly:c,seedByRanking:p,participants:w,roundTarget:a,seedsCount:d,placeByes:l,drawSize:m,entries:V});if(f.error)return f;f.structureId&&i.push(f.structureId),s+=1,f.conflicts?.length&&z.push(...f.conflicts),f.positioningReport?.length&&j.push({[rd]:f.positioningReport})}a+=1}}else if(B&&$){const e=xh({structureName:kh(rd),stage:rd}),{link:t}=ZS({sourceStructureId:e.structureId,targetStructureId:B,sourceRoundNumber:0,linkType:Hi.Position});_.structures||(_.structures=[]),_.structures.push(e),_.links||(_.links=[]),_.links.push(t)}return _.drawName=e.drawName??(g&&kh(g)),"object"==typeof i&&function(e){const{tournamentRecord:t}=e;t&&XS({participants:t.participants,...e})}({...i,tournamentRecord:s,appliedPolicies:h,drawDefinition:_,matchUpType:O}),p&&Ly({tournamentRecord:s,drawDefinition:_,event:f}),{existingDrawDefinition:!!F,qualifyingConflicts:z,positioningReports:j,drawDefinition:_,structureId:B,...L,conflicts:q}}const DR={generateQualifyingStructure:function(e){const{tournamentRecord:t}=e;return t?Qw({participants:t.participants,...e}):{error:$}},attachQualifyingStructure:function({tournamentRecord:e,drawDefinition:t,structure:n,link:r}){if(!e)return{error:$};if(!t)return{error:Y};const i=Xw({tournamentId:e.tournamentId,drawDefinition:t,structure:n,link:r});return i.error||wU({tournamentRecord:e,timeItem:{itemType:"attachQualifyingStructures",itemValue:{structureId:n.structureId,drawId:t.drawId}}}),i},attachPlayoffStructures:function(e){return yR({...e,itemType:"attachPlayoffStructures"})},addQualifyingStructure:function(e){const t=e.tournamentRecord;if(!t)return{error:$};const n=eP(e);if(n.error)return n;const{qualifyingRoundNumber:r,qualifyingPositions:i,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:c,drawSize:u,drawType:d}=e;return wU({tournamentRecord:t,timeItem:{itemType:"addQualifyingStructures",itemValue:pi({drawId:o.drawId,structureName:s,targetStructureId:a,qualifyingPositions:i,qualifyingRoundNumber:r,matchUpType:c,drawSize:u,drawType:d})}}),n},isValidForQualifying:function({structureId:e,drawDefinition:t}){if(!t)return{error:Y};if(!si(e))return{error:xn};const n=Rl({drawDefinition:t,structureId:e});if(n.error)return n;const r=n.links.target.flatMap((e=>e.target.feedProfile)).filter(Boolean),i=!O([vd,yd,Ud,fd],r).length;return{...L,valid:i}},setStructureOrder:aP,attachStructures:yR,renameStructures:function(e){return oP(e)},disableTieAutoCalc:function(e){return e.tournamentRecord?tT(e):{error:$}},enableTieAutoCalc:function(e){return e.tournamentRecord?nT(e):{error:$}},validateCollectionDefinition:ua,modifyCollectionDefinition:Zy,orderCollectionDefinitions:nv,removeCollectionDefinition:ov,addCollectionDefinition:sv,removeCollectionGroup:pv,addCollectionGroup:lv,modifyTieFormat:mv,resetScorecard:function(e){return hv(e)},resetTieFormat:fv,setEventStartDate:vR,setEventEndDate:SR,setEventDates:function({tournamentRecord:e,event:t,startDate:n,endDate:r}){if(!e)return{error:$};if(!t)return{error:Ae};if(!n&&!r)return{error:mt,info:"missing date"};if(n&&!Nr.test(n))return{error:yt};if(r&&!Nr.test(r))return{error:yt};if(n&&r){if(new Date(Wr(n))>new Date(Wr(r)))return{error:xn}}if(n){const r=vR({tournamentRecord:e,event:t,startDate:n});if(r.error)return r}if(r){const n=SR({tournamentRecord:e,event:t,endDate:r});if(n.error)return n}return{...L}},deleteEvents:function({removePairParticipants:e,tournamentRecord:t,eventIds:n}){if(!t)return{error:$};if(!t.events)return{error:Ee};if(!Array.isArray(n))return{error:mt,info:sa("drawIds")};const r=[],i=[],a=[],o=[];if(t.events=(t.events||[]).filter((e=>{if(n.includes(e.eventId)){const n={action:Hv,payload:{events:[e]}};r.push(n),i.push({tournamentId:t.tournamentId,eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}const s=e.eventType===ku?(e.entries||[]).map((({entryStatus:e,participantId:t})=>e!==vp&&t)).filter(Boolean):[],c=n.includes(e.eventId);return c?o.push(...s):a.push(...s),!c})),e){const e=o.filter((e=>!a.includes(e)));t.participants=t.participants.filter((({participantId:t})=>!e.includes(t)))}if(ES({tournamentRecord:t}),r.length){pr({topic:yc,payload:r});wU({tournamentRecord:t,timeItem:{itemType:Hv,itemValue:i}})}return{...L}},modifyEvent:function({tournamentRecord:e,eventUpdates:t,eventId:n,event:r}){const i="modifyEvent";if(!e)return Mi({result:{error:$},stack:i});if(!si(n))return Mi({result:{error:Ae},context:{eventId:n},stack:i});if(!ci(t))return Mi({result:{error:xn},context:{eventUpdates:t},stack:i});const a=r?.entries?.filter((({entryStatus:e})=>{const t=e;return[...bp,dp].includes(t)})).map((({participantId:e})=>e))??[],o=a?Kg({participantFilters:{participantIds:a},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[],s=[],c=o.reduce(((e,t)=>{const n=t.person?.sex?[t.person.sex]:t.individualParticpants?.map((e=>e.person?.sex))||[];return s.push(...n),e.includes(t.participantType)?e:e.concat(t.participantType)}),[]),u=P(s),d=!u.length||[Ci,Ai].includes(t.gender??"")||1===u.length&&u[0]===t.gender;if(t.gender&&!d)return Mi({context:{gender:t.gender,validGender:d},result:{error:xn},stack:i});const p=(c.includes(_u)&&[_u]||c.includes(qu)&&[Ou]||c.includes(Wu)&&[ku]||[ku,Ou,_u]).includes(t.eventType??"");return t.eventType&&!p?Mi({context:{participantType:t.eventType,validEventType:p},result:{error:xn},stack:i}):(t.eventType&&(r.eventType=t.eventType),t.eventName&&(r.eventName=t.eventName),t.gender&&(r.gender=t.gender),{...L})},addEvent:rR,removeSeededParticipant:function({tournamentRecord:e,drawDefinition:t,participantId:n,structureId:r}){const i="removeSeededParticipant";if(!e)return{error:$};if(!t)return{error:Y};const a=(t.structures??[]).find((e=>e.structureId===r));if(!a)return Mi({result:{error:De},stack:i});if(!a.stage||![$i.Main,$i.Qualifying].includes(a.stage)||a.stage===$i.Main&&1!==a.stageSequence)return Mi({result:{error:J},stack:i});const o=a.seedAssignments?.find((e=>e.participantId===n));return o?{...L}:Mi({info:"participant not seeded",result:{error:Gn},context:{participantId:n}})},removeScaleValues:cR,checkValidEntries:CD,addDrawEntries:TP,removeSeeding:function({tournamentRecord:e,drawDefinition:t,entryStatuses:n,scaleName:r,drawId:i,event:a,stage:o}){return e?a?(r=r||a.category?.categoryName||a.category?.ageCategoryCode,cR({tournamentRecord:e,scaleAttributes:{eventType:a.eventType,scaleType:Ps,scaleName:r},drawDefinition:t,entryStatuses:n,drawId:i,event:a,stage:o})):{error:Ae}:{error:$}},autoSeeding:function({tournamentRecord:e,drawDefinition:t,policyDefinitions:n,scaleAttributes:r,scaleName:i,drawSize:a,drawId:o,event:s,stage:c,sortDescending:u,scaleSortMethod:d}){const p=Cg({policyDefinitions:n,drawDefinition:t,drawSize:a,drawId:o,event:s,stage:c});if(p.error)return p;const{entries:l,seedsCount:m,stageEntries:f}=p;if(!f||!m)return{error:xn};const h=dR({tournamentRecord:e,scaleAttributes:r,scaleSortMethod:d,sortDescending:u,entries:l,stage:c}).scaledEntries??[],{scaleItemsWithParticipantIds:I}=CI({scaleAttributes:r,scaledEntries:h,stageEntries:f,seedsCount:m,scaleName:i});return{scaleItemsWithParticipantIds:I}},getAvailablePlayoffRounds:oR,getAvailablePlayoffProfiles:oR,getAssignedParticipantIds:Hh,deleteDrawDefinitions:ED,addPlayoffStructures:function(e){const t=e.tournamentRecord;if(!t)return{error:$};const n=rP(e);if(n.error)return n;const{playoffStructureNameBase:r,playoffPositions:i,roundNumbers:a,structureId:o}=e;return wU({tournamentRecord:t,timeItem:{itemType:"addPlayoffStructures",itemValue:pi({playoffStructureNameBase:r,playoffPositions:i,roundNumbers:a,structureId:o})}}),n},modifyDrawDefinition:function({tournamentRecord:e,drawDefinition:t,drawUpdates:n,drawId:r,event:i}){if(!ci(n))return{error:xn};const a=Ks({event:i}).flightProfile,o=n.drawName&&gR({drawName:n.drawName,tournamentRecord:e,drawDefinition:t,flightProfile:a,drawId:r,event:i});if(o?.error)return o?.error;const s=o?.flight||a?.flights?.find((e=>e.drawId===r));if(!s&&!t)return{error:Y};if(s){rc({event:i,extension:{name:ko,value:{...a,flights:a.flights}}})}return t&&(n.policyDefinitions&&aT({policyDefinitions:n.policyDefinitions,drawDefinition:t}),al({tournamentId:e?.tournamentId,drawDefinition:t})),{...L}},addDrawDefinition:Ly,removeStructure:sP,modifyDrawName:gR,generateAndPopulatePlayoffStructures:zw,generateSeedingScaleItems:CI,setSubOrder:LP,addEventEntries:bP,promoteAlternate:function(e){const{participantId:t}=e;return t&&"string"!=typeof t?{error:xn,participantId:t}:iR({...e,participantIds:[t].filter(Boolean)})},promoteAlternates:iR,destroyPairEntry:OP,destroyPairEntries:function(e){if(!e.tournamentRecord)return{error:$};const{participantIds:t,...n}=e;let r=0;const i=[];for(const a of t){const e=CP({participantId:a,...n});e.success&&(r+=1),e.error&&i.push(e.error)}return r?{destroyedCount:r,...L}:{error:i}},setEntryPosition:sR,setEntryPositions:function({tournamentRecord:e,entryPositions:t,drawDefinition:n,event:r}){if(!e)return{error:$};if(!Array.isArray(t))return{error:xn};for(const i of t){const{participantId:t,entryPosition:a}=i,o=sR({skipRefresh:!0,tournamentRecord:e,drawDefinition:n,participantId:t,entryPosition:a,event:r});if(o.error)return o}return r?.entries&&(r.entries=gP({entries:r.entries})),n?.entries&&(n.entries=gP({entries:n.entries})),{...L}},addEventEntryPairs:function({allowDuplicateParticipantIdPairs:e,entryStage:t=$i.Main,entryStatus:n=dp,participantIdPairs:r=[],tournamentRecord:i,drawDefinition:a,event:o,uuids:s}){if(!i)return{error:$};if(!o)return{error:Ae};if(o.eventType!==Bi)return{error:Me};const c=[],u=new Map;for(const I of i.participants??[]){const{participantType:e,participantId:t,person:n,individualParticipantIds:r}=I;e===qu&&n?.sex?u.set(t,n.sex):e===Wu&&r&&c.push(r)}const d=r.filter((e=>{if(2!==e.length)return!0;if(!u.has(e[0])||!u.has(e[1]))return!0;if(!o.gender||o.gender===Ai)return!1;const t=e.map((e=>u.get(e)));let n=o.gender===Ei&&(t[0]!==Ei||t[1]!==Ei)||o.gender===Fi&&(t[0]!==Fi||t[1]!==Fi);return o.gender===Ci&&(t.sort(),t[0]===Fi&&t[1]===Ei||(n=!0)),n}));if(d.length)return{error:Ct,invalidParticipantIdPairs:d};const p=r.map((e=>({participantId:s?.pop()??Ii(),participantRole:jT,individualParticipantIds:e,participantType:Wu}))),l=e?p:p.filter((e=>!c.find((t=>2===O(t,e.individualParticipantIds).length))));let m,f=[];if(l){const t=Vy({allowDuplicateParticipantIdPairs:e,participants:l,returnParticipants:!0,tournamentRecord:i});if(t.error)return t;f=t.participants||[],m=t.info}const h=bP({participantIds:r.map((e=>{const t=f.find((t=>2===O(t.individualParticipantIds,e).length));if(t)return t;const{participant:n}=Xu({tournamentRecord:i,participantIds:e});return n})).map((e=>e.participantId)),tournamentRecord:i,drawDefinition:a,entryStatus:n,entryStage:t,event:o});return l.length&&pr({payload:{participants:l},topic:Ic}),{...h,info:m,newParticipantIds:l.map(Sl)}},removeEventEntries:RP,removeDrawEntries:function({autoEntryPositions:e=!0,participantIds:t,drawDefinition:n,drawId:r,stages:i,event:a}){if(!a)return{error:Ae};if(!r)return{error:le};if(!t?.length)return{error:Gt};if(k(Hh({drawDefinition:n,stages:i}).assignedParticipantIds??[],t))return{error:zt};const o=e=>{const n=e.participantId;return!t.includes(n)},{flightProfile:s}=Ks({event:a}),c=s?.flights?.find((e=>e.drawId===r));return c?.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),e&&(c.drawEntries=gP({entries:c.drawEntries}))),n?.entries&&(n.entries=n.entries.filter(o),e&&(n.entries=gP({entries:n.entries}))),{...L}},modifyEventEntries:function({entryStatus:e=lp,unpairedParticipantIds:t=[],participantIdPairs:n=[],entryStage:r=nd,tournamentRecord:i,event:a}){if(!i)return{error:$};if(!a)return{error:Ae};const o=i.participants??[],s=o.filter((e=>e.participantType===qu)).map((e=>e.participantId)),c=t.concat(...n).flat(1/0).filter((e=>!s.includes(e)));if(c.length)return{error:Ct,invalidParticipantIds:c};const u=n.filter((e=>2!==e.length));if(u.length)return{error:Ct,invalidParticipantIdPairs:u};const d=o.filter((e=>e.participantType===Wu)).map((e=>e.individualParticipantIds)),p=Vy({participants:n.filter((e=>!d.find((t=>2===O(t,e).length)))).map((e=>({participantType:Wu,participantRole:jT,individualParticipantIds:e}))),tournamentRecord:i});if(p.error)return p;const l=n.map((e=>{const{participant:t}=Xu({tournamentRecord:i,participantIds:e});return t})).map((t=>({participantId:t,entryStatus:e,entryStage:r}))),m=t.map((e=>({entryStatus:vp,participantId:e,entryStage:r})));return a.entries=(a.entries??[]).filter((e=>e.entryStage===r)),a.entries=a.entries.concat(...l,...m),{...L}},modifyEntriesStatus:yP,modifySeedAssignment:function({tournamentRecord:e,drawDefinition:t,participantId:n,structureId:r,seedValue:i,event:a}){return e?(e.participants||[]).find((e=>e.participantId===n))?dT({tournamentRecord:e,drawDefinition:t,participantId:n,structureId:r,seedValue:i,event:a}):{error:Et}:{error:$}},modifyPairAssignment:function({replacementIndividualParticipantId:e,existingIndividualParticipantId:t,tournamentRecord:n,drawDefinition:r,participantId:i,event:a,uuids:o}){if(!a)return{error:Ae};if(a?.eventType!==ku)return{error:Me};if(o&&!Array.isArray(o))return{error:xn};if(!n)return{error:$};if(![e,t,i].every((e=>"string"==typeof e)))return{error:Lt};if(!(a?.entries?.filter((({entryStatus:e})=>[vp,Sp].includes(e))).map((({participantId:e})=>e))||[]).includes(e))return{error:Et};const s=(n.participants||[]).find((e=>e.participantId===i));if(s?.participantType!==Wu)return{error:At,participant:s};const c=s.individualParticipantIds,u=[e,...c.filter((e=>e!==t))],{participant:d}=Xu({participantIds:u,tournamentRecord:n});let p;if(d)p=d.participantId;else{const e=By({participant:{participantId:o?.pop(),participantRole:jT,individualParticipantIds:u,participantType:Wu},returnParticipant:!0,tournamentRecord:n});if(e.error)return e;p=e.participant.participantId}const{flightProfile:l}=Ks({event:a});if(r){const e=l?.flights?.find((({drawId:e})=>e===r.drawId));e&&(e.drawEntries=e.drawEntries.map((e=>e.participantId===i?{...e,participantId:p}:e))),r.entries=r.entries.map((e=>e.participantId===i?{...e,participantId:p}:e));for(const t of r.structures||[])if(t.positionAssignments)t.positionAssignments=t.positionAssignments.map((e=>e.participantId===i?{...e,participantId:p}:e));else if(t.structures)for(const e of t.structures)e.positionAssignments=e.positionAssignments.map((e=>e.participantId===i?{...e,participantId:p}:e))}a.entries=a.entries.map((n=>n.participantId===i&&{...n,participantId:p}||n.participantId===e&&{...n,participantId:t}||n));const m=n.events.some((({entries:e,eventId:t,drawDefinitions:n})=>a.eventId===t?n.some((({drawId:e,entries:t})=>e!==r?.drawId&&t?.find((e=>e.participantId===i)))):e?.find((e=>e.participantId===i))));if(!m){const e=EP({addIndividualParticipantsToEvents:!1,participantIds:[i],tournamentRecord:n});if(e.error)return e}return{...L,participantOtherEntries:m,newPairParticipantId:p}},resetVoluntaryConsolationStructure:function({tournamentRecord:e,drawDefinition:t,resetEntries:n,event:r}){if(!t)return{error:Y};const i=t.structures?.find((e=>e.stage===ad));if(!i)return{error:De};const a=i.matchUps?.map((({matchUpId:e})=>e))||[];return i.positionAssignments=[],i.seedAssignments=[],i.matchUps=[],nl({tournamentId:e?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:t}),n&&(t.entries=t.entries.filter((e=>e.entryStage!==ad))),al({tournamentId:e?.tournamentId,eventId:r?.eventId,drawDefinition:t,structureIds:[i.structureId]}),{...L}},deleteFlightProfileAndFlightDraws:function({autoPublish:e=!0,tournamentRecord:t,auditData:n,event:r,force:i}){if(!t)return{error:$};if(!r)return{error:Ae};const{flightProfile:a}=Ks({event:r});if(a){const o=a.flights?.map((({drawId:e})=>e)).filter(Boolean),s=ED({eventId:r.eventId,tournamentRecord:t,autoPublish:e,auditData:n,drawIds:o,event:r,force:i});return s.error?s:ac({event:r,name:ko})}return{...L}},deleteFlightAndFlightDraw:function({autoPublish:e=!0,tournamentRecord:t,auditData:n,drawId:r,event:i,force:a}){if(!t)return{error:$};if(!r)return{error:le};if(!i)return{error:Ae};const{flightProfile:o}=Ks({event:i});if(o){const e=o.flights?.find((e=>e.drawId===r));if(e){const e=o.flights.filter((e=>e.drawId!==r));rc({event:i,extension:{name:ko,value:{...o,flights:e}}})}}const s=i.drawDefinitions?.find((e=>e.drawId===r));if(s){const o=ED({drawIds:[r],eventId:i.eventId,tournamentRecord:t,autoPublish:e,auditData:n,event:i,force:a});if(o.error)return o}return lR({tournamentRecord:t,event:i})},generateFlightProfile:function(e){const{drawNameRoot:t="Flight",attachFlightProfile:n,tournamentRecord:r,scaleAttributes:i,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:c=[],flightsCount:u,splitMethod:d,uuids:p=[],event:l,stage:m}=e;if(!l)return{error:Ae};const f=l.entries??[],{flightProfile:h}=Ks({event:l});if(h&&n&&!o)return{error:Wn};const I=e.scaledEntries??dR({tournamentRecord:r,scaleAttributes:i,scaleSortMethod:a,sortDescending:s,event:l,stage:m}).scaledEntries,g=I.map(Sl),U=T(f.filter((({participantId:e})=>!g.includes(e))).filter((e=>(!m||!e.entryStage||e.entryStage===m)&&(!e.entryStatus||Rp.includes(e.entryStatus))))),y=I.concat(...U),v=y.length;let S=x(y,Math.ceil(v/u));d===fR?S=_(y,u):d===hR&&(S=_(y,u,!0));const w={scaleAttributes:i,splitMethod:d,flights:E(0,u).map((e=>{const n=e+1;return{flightNumber:n,drawId:p?.pop()??Ii(),drawEntries:(r=S[e],(r||[]).map((({participantId:e,scaleValue:t})=>{const n=f.find((t=>t.participantId===e));return n?.scaleValue&&t&&(n.scaleValue=t),n})).sort(((e,t)=>e.scaleValue-t.scaleValue)).map(((e,t)=>(e.scaleValue&&(e.seedNumber=t+1),e)))),drawName:c?.length&&c[e]||`${t} ${n}`};var r}))};if(n){const e=mR({flightProfile:w,deleteExisting:o,event:l});return{splitEntries:ar()&&S||void 0,...e}}return{flightProfile:w,...L}},refreshEventDrawOrder:lR,attachFlightProfile:mR,resetDrawDefinition:function({tournamentRecord:e,removeScheduling:t,drawDefinition:n}){if(!n)return{error:Y};const r=_p({drawDefinition:n}),i=e=>r?.drawMatchUps?.find((t=>t.matchUpId===e));for(const a of n.structures||[]){const{positionAssignments:o,stage:s,stageSequence:c}=a;!o||1===c&&[rd,nd].includes(s)||(a.positionAssignments=o.map((e=>(delete e.participantId,e))),a.seedAssignments=[]);const{matchUps:u}=Kp({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:a});for(const r of u){const{matchUpId:a,roundNumber:o,sides:s}=r,c=i(a);if(c){if(delete c.extensions,delete c.notes,c.matchUpStatus!==ma&&Object.assign(c,Fl),o&&o>1&&c.drawPositions){const e=s?.map((({drawPosition:e,participantFed:t})=>!t&&e)).filter(Boolean),t=c.drawPositions.map((t=>e.includes(t)?void 0:t));c.drawPositions=t}t?delete c.timeItems:c.timeItems?.length&&(c.timeItems=c.timeItems.filter((e=>e.itemType&&![Jc,Xc,Qc,tu,eu,nu].includes(e.itemType)))),rl({tournamentId:e?.tournamentId,context:"resetDrawDefiniton",drawDefinition:n,matchUp:c})}}}return al({drawDefinition:n,structureIds:(n.structures||[]).map((({structureId:e})=>e))}),{...L}},pruneDrawDefinition:function({matchPlayDrawPositions:e=!0,tournamentRecord:t,drawDefinition:n,drawId:r}){if(!t)return{error:$};if(!n)return{error:Y};let i=[];const{drawsAnalysis:a}=yD({tournamentRecord:t});if(a.canBePruned.includes(r)){const o=a.matchPlay.includes(r),s=a.drawAnalysis[r],{structures:[c]}=ip({stageSequence:1,drawDefinition:n,stage:nd}),u=s.structuresData.find((({structureId:e})=>c.structureId===e)),d=c.matchUps??[];i=d.sort(((e,t)=>e.roundPosition-t.roundPosition)).filter((({roundNumber:e})=>!u.inactiveRounds.includes(e)));const p=i.map(Pl),l=d.map(Pl).filter((e=>!p.includes(e)));if(o){const t=i.sort(((e,t)=>e.roundPosition-t.roundPosition)).filter((({roundNumber:e})=>!u.inactiveRounds.includes(e))).filter((({winningSide:e})=>e)),n=t.map(Pl),r=p.filter((e=>!n.includes(e)));l.push(...r);const a=t.flatMap((e=>e.drawPositions??[])).filter(Boolean).flat(),o=Object.assign({},...a.map(((e,t)=>({[e]:t+1}))));if(t.forEach((t=>{e?t.drawPositions=t.drawPositions.map((e=>o[e])):delete t.drawPositions})),e){const e=c?.positionAssignments?.filter((e=>a.includes(e.drawPosition))).map((e=>(e.drawPosition=o[e.drawPosition],e)));c.positionAssignments=e}else c.positionAssignments=[];c.matchUps=t,i=t}nl({tournamentId:t?.tournamentId,matchUpIds:l,drawDefinition:n}),al({drawDefinition:n})}return{...L,matchUps:i}},updateDrawIdsOrder:pR,getFlightProfile:Ks,getScaledEntries:dR,generateLineUps:uD,addFlight:UR,generateAdHocMatchUps:function(e){return cP(e)},deleteAdHocMatchUps:function(e){return iP(e)},addAdHocMatchUps:function(e){return uP(e)},drawMatic:function(e){const t=e.tournamentRecord?.participants;return Object.assign(e,{tournamentParticipants:t}),JP(e)},setOrderOfFinish:function(e){return rT(e)},setDelegatedOutcome:function(e){return ZP(e)},removeDelegatedOutcome:function(e){return VP(e)},addVoluntaryConsolationStructure:XS,addVoluntaryConsolationStage:function(e){return Yw(e)},generateVoluntaryConsolation:function(e){const{tournamentRecord:t}=e;return t?Kw({participants:t.participants,...e}):{error:$}},attachConsolationStructures:function(e){return yR({...e,itemType:"attachConsolationStructures"})},bulkMatchUpStatusUpdate:_y,updateTieMatchUpScore:function(e){return e.tournamentRecord?xl(e):{error:$}},aggregateTieFormats:function({tournamentRecord:e}){if(!e)return{error:$};let t=0;for(const n of e.events??[]){const r=n.tieFormats??[],i=e=>{if(!e.tieFormat)return;let n;for(const t of r){Eh({descendant:e.tieFormat,ancestor:t}).different||(n=t.tieFormatId)}if(n)e.tieFormatId=n,delete e.tieFormat;else{const n=ii(e.tieFormat,void 0,!0);n.tieFormatId||(n.tieFormatId=Ii()),e.tieFormatId=n.tieFormatId,delete e.tieFormat,r.push(n),t+=1}},a=n.eventType;i({tieFormat:n.tieFormat,eventType:a});for(const e of n.drawDefinitions??[]){i({tieFormat:e.tieFormat,eventType:a});for(const t of e.structures??[])i({tieFormat:t.tieFormat,eventType:a})}const o=(t,r)=>{const i=c.matchUps?.find((e=>e.matchUpId===t));i&&(i.tieFormatId=r,delete i.tieFormat,rl({tournamentId:e?.tournamentId,eventId:n.eventId,matchUp:i}))},s=e=>{const n=ii(e.tieFormat,void 0,!0);n.tieFormatId||(n.tieFormatId=Ii()),r.push(n),t+=1,o(e.matchUpId,n.tieFormatId)},c=ah({matchUpFilters:{matchUpTypes:[Vi]},event:n}),u=c.matchUps??[];for(const e of u){let t;for(const n of r){e.tieFormat&&Eh({descendant:e.tieFormat,ancestor:n}).different||(t=n.tieFormatId)}t?o(e.matchUpId,t):s(e)}r.length&&(n.tieFormats=r)}return{...L,addedCount:t}},setMatchUpFormat:function({tournamentRecord:e,drawDefinition:t,scheduledDates:n,stageSequences:r,matchUpFormat:i,structureIds:a,structureId:o,eventType:s,matchUpId:c,eventIds:u,eventId:d,drawIds:p,stages:l,drawId:m,event:f,force:h}){const I="setMatchUpFormat";if(!e)return{error:$};if(!i)return{error:ze};if(i&&!Ti(i))return Mi({result:{error:Ge,matchUpFormat:i},stack:I});if(n&&!Array.isArray(n))return Mi({result:{error:xn,scheduledDates:n},stack:I});if(s&&![Ou,ku].includes(s))return Mi({result:{error:Me},stack:I});let g=0;if((o||a)&&!t)return Mi({result:{error:Y},stack:I});if(m&&c){const n=Fy({tournamentRecord:e,drawDefinition:t,matchUpFormat:i,structureIds:a,structureId:o,matchUpId:c});if(n.error)return n;g+=1}const U=t=>{const o=[];for(const s of t.structures||[]){if(Array.isArray(l)&&!l.includes(s.stage)||Array.isArray(r)&&!r.includes(s.stageSequence)||a.length&&!a.includes(s.structureId))continue;a.length&&s.matchUpFormat!==i&&(s.matchUpFormat=i,o.push(s.structureId),g+=1);const c=(h||n)&&Kp({matchUpFilters:{matchUpStatuses:[Ki.ToBePlayed]},structure:s}),u=n&&Kp({matchUpFilters:{matchUpStatuses:[Ki.ToBePlayed]},contextFilters:{scheduledDates:n},afterRecoveryTimes:!1,inContext:!0,structure:s});if(c?.length){const r=u?u.map(Pl):c.map(Pl);for(const a of c)r.includes(a.matchUpId)&&(a.matchUpFormat=n?.length?i:void 0,rl({tournamentId:e?.tournamentId,eventId:f?.eventId,context:I,drawDefinition:t,matchUp:a}))}}return o.length||t.matchUpFormat===i||(t.matchUpFormat=i,g+=1),o};a=a||[o].filter(Boolean),u=u||[d].filter(Boolean),p=p||[m].filter(Boolean);for(const y of e.events||[])if(!(u?.length&&!u.includes(y.eventId)||s&&s!==y.eventType||s===_u))if(Array.isArray(r)||Array.isArray(l)||a.length||p.length)for(const e of y.drawDefinitions||[]){if(Array.isArray(p)&&!p.includes(e.drawId))continue;al({structureIds:U(e),drawDefinition:e})}else y.matchUpFormat!==i&&(y.matchUpFormat=i,g+=1);return g?{...L,modificationsCount:g}:{...L,info:Nn}},setMatchUpStatus:xy,assignDrawPosition:function({tournamentRecord:e,drawDefinition:t,participantId:n,drawPosition:r,structureId:i,qualifier:a,event:o,bye:s}){if(!t)return{error:Y};if(!r)return{error:se};if(!i)return{error:Te};if(s){const n=ty({tournamentRecord:e,drawDefinition:t,drawPosition:r,structureId:i,event:o});if(n.error)return n}else{if(a)return{error:qn};{const a=Ty({tournamentRecord:e,drawDefinition:t,participantId:n,drawPosition:r,structureId:i,event:o});if(a.error)return a}}return{...L}},assignSeedPositions:function(e){const{provisionalPositioning:t,useExistingSeedLimit:n,tournamentRecord:r,drawDefinition:i,seedingProfile:a,structureId:o,assignments:s,drawId:c,event:u}=e;let d=0;if(!s?.length)return{error:ke};if(!r)return{error:$};if(!c)return{error:le};const p=kp({provisionalPositioning:t,drawDefinition:i,structureId:o});if(p.error)return p;const{seedAssignments:l,seedLimit:m}=p,f=Object.assign({},...(l??[]).filter((e=>e.seedNumber)).map((e=>({[e.seedNumber]:e}))));s.forEach((e=>{const{seedNumber:t}=e;m&&t<=m&&(!n||f[t])&&(f[t]=e)}));const h=Object.values(f),I=h.map((e=>e?.participantId)).filter(Boolean);if(I.length!==N(I).length)return{error:fe};for(const g of h){const e=yy({...g,provisionalPositioning:t,tournamentRecord:r,drawDefinition:i,seedingProfile:a,structureId:o,event:u});if(e?.error)return e;e?.success&&d++}return d?{...L,modifications:d}:{error:Nn}},assignDrawPositionBye:function({tournamentRecord:e,drawDefinition:t,drawPosition:n,structureId:r,event:i}){return ty({tournamentRecord:e,drawDefinition:t,drawPosition:n,structureId:r,event:i})},substituteParticipant:function(e){return function({substituteParticipantId:e,existingParticipantId:t,tournamentRecord:n,drawDefinition:r,sideNumber:i,matchUpId:a,event:o}){const s="substituteParticipant";if(!r)return{error:Y};if(!a)return{error:Qe};if(!t||!e)return Mi({result:{error:Lt},stack:s});const{matchUp:c}=Qp({drawDefinition:r,matchUpId:a,event:o});if(!c)return{error:Xe};if(!c.collectionId)return Mi({result:{error:tt},stack:s});const u=_p({drawDefinition:r}),{matchUps:d}=Cl({tournamentParticipants:n?.participants,inContext:!0,drawDefinition:r,matchUpsMap:u}),p=d?.find((e=>e.matchUpId===a)),l=d?.find((e=>e.matchUpId===p?.matchUpTieId)),m=l?.sides?.find((e=>e.participant.individualParticipants.some((({participantId:e})=>e===t))));if(!m||i&&m.sideNumber!==i)return{error:Et};const f=m.participant?.individualParticipants?.map(Sl).filter((e=>e!==t));return f.includes(e)?MD({newParticipantId:e,tieMatchUpId:a,existingParticipantId:t,substitution:!0,tournamentRecord:n,drawDefinition:r,event:o}):Mi({result:{error:Et},stack:s})}(e)},removeRoundMatchUps:function({removeCompletedMatchUps:e,tournamentRecord:t,drawDefinition:n,structureId:r,roundNumber:i,event:a}){if(!t)return{error:$};if(!n)return{error:Y};if(!i)return Mi({result:{error:mt},info:"roundNumber required"});const o=rp({drawDefinition:n,structureId:r});if(o.error)return o;const s=o.structure;return s?.structures?{error:J}:Hp({drawDefinition:n,structure:s})?function({removeCompletedMatchUps:e,drawDefinition:t,tournamentId:n,roundNumber:r,structure:i,eventId:a}){const o=i?.matchUps??[],s=[];let c=!1;if(o.reduce(((e,t)=>{const n=t?.roundNumber;return n?e.includes(n)?e:e.concat(n):e}),[]).sort(l).includes(r)){const u=o.filter((t=>{const n=t.roundNumber===r&&(!Ca.includes(t.matchUpStatus)||e);return n&&s.push(t.matchUpId),!n}));if(s.length){nl({matchUpIds:s,drawDefinition:t,tournamentId:n,eventId:a});u.some((e=>e.roundNumber===r))||(u.forEach((e=>{e.roundNumber>r&&(e.roundNumber-=1,rl({drawDefinition:t,tournamentId:n,eventId:a,matchUp:e}))})),c=!0),i.matchUps=u}}return{deletedMatchUpsCount:s.length,roundRemoved:c,...L}}({tournamentId:t.tournamentId,removeCompletedMatchUps:e,eventId:a.eventId,drawDefinition:n,roundNumber:i,structure:s}):(console.log("not implemented"),{...L})},swapDrawPositionAssignments:function(e){return kP(e)},assignMatchUpSideParticipant:function({tournamentRecord:e,drawDefinition:t,participantId:n,sideNumber:r,matchUpId:i,event:a}){if(n&&"string"!=typeof n)return{error:Et};if(!t)return{error:Y};if(!i)return{error:Qe};const o=void 0===r;if(o&&(r=1),![1,2].includes(r))return Mi({result:{error:xn,context:{sideNumber:r}}});const{matchUp:s,structure:c}=Qp({drawDefinition:t,matchUpId:i,event:a});if(!s)return{error:Xe};if(!!(c?.structures||t.drawType&&t.drawType!==Dd||c?.matchUps?.find((({roundPosition:e})=>!!e))))return{error:ce};if(!n&&(s?.score?.scoreStringSide1||Ca.includes(s?.matchUpstatus)||s?.matchUpStatus&&[ya,Ua].includes(s.matchUpStatus)))return{error:Nt,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map((e=>{const t=s.sides?.find((t=>t.sideNumber===e))??{sideNumber:e};return r===e?{...t,participantId:n}:t})),o)for(const e of s.sides)e.sideNumber&&(e.sideNumber=3-e.sideNumber);rl({tournamentId:e?.tournamentId,context:"assignSideParticipant",drawDefinition:t,matchUp:s})}return{...L,sidesSwapped:o}},removeMatchUpSideParticipant:function({tournamentRecord:e,drawDefinition:t,sideNumber:n,matchUpId:r,event:i}){if(!e)return{error:$};if(!t)return{error:Y};if(!r)return{error:Qe};if(!n)return{error:mt};if(![1,2].includes(n))return{error:xn,sideNumber:n};const{matchUp:a,structure:o}=Qp({drawDefinition:t,matchUpId:r,event:i});return a?o?.structures||t.drawType&&t.drawType!==Dd||o?.matchUps?.find((({roundPosition:e})=>!!e))?{error:ce}:(a.sides?.forEach((e=>{e.sideNumber===n&&delete e.participantId})),rl({tournamentId:e?.tournamentId,context:"assignSideParticipant",drawDefinition:t,matchUp:a}),{...L}):{error:Xe}},removeDrawPositionAssignment:FP,alternateDrawPositionAssignment:function(e){return hP(e)},withdrawParticipantAtDrawPosition:function(e){return Object.assign(e,{entryStatus:Pp}),FP(e)},setDrawParticipantRepresentativeIds:function({representativeParticipantIds:e,drawDefinition:t}){if(!t)return{error:Q};if(!Array.isArray(e))return{error:xn};const n=vl(t?.entries||[]);return e.length&&O(e,n).length<e.length?{error:xn}:nc({drawDefinition:t,extension:{name:Vo,value:e}})},getDrawParticipantRepresentativeIds:function({drawDefinition:e}){const t=Cs({name:"participantRepresentatives",drawDefinition:e});return t.error?t:{representativeParticipantIds:t.extension?.value||[]}},luckyLoserDrawPositionAssignment:function(e){return function({luckyLoserParticipantId:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,structureId:i}){return fP({positionActionName:"luckyLoserDrawPositionAssignment",participantId:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,structureId:i})}(e)},qualifierDrawPositionAssignment:function(e){return function({qualifyingParticipantId:e,tournamentRecord:t,drawDefinition:n,drawPosition:r,structureId:i}){return fP({positionActionName:"qualifierDrawPositionAssignment",participantId:e,isQualifierPosition:!0,tournamentRecord:t,drawDefinition:n,drawPosition:r,structureId:i})}(e)},setPositionAssignments:function(e){return IP(e)},automatedPositioning:function({applyPositioning:e=!0,tournamentRecord:t,drawDefinition:n,seedingProfile:r,structureId:i,placeByes:a,seedsOnly:o,drawSize:s,event:c}){if(!c)return{error:Ee};if(!n)return{error:Q};const u=t?.participants;return Ww({tournamentRecord:t,applyPositioning:e,drawDefinition:n,seedingProfile:r,participants:u,structureId:i,placeByes:a,seedsOnly:o,drawSize:s})},automatedPlayoffPositioning:Hw,checkInParticipant:function({tournamentRecord:e,participantId:t,matchUpId:n,matchUp:r,drawId:i}){r&&!i&&({drawId:i}=r),r&&!n&&({matchUpId:n}=r);const{drawDefinition:a}=Qs({tournamentRecord:e,drawId:i});if(!a)return{error:Ee};{const r=rS({tournamentParticipants:e.participants,drawDefinition:a,participantId:t,matchUpId:n});if(r.error&&r.error!==Wt)return r}return{...L}},checkOutParticipant:function({tournamentRecord:e,participantId:t,matchUpId:n,matchUp:r,drawId:i}){r&&!i&&({drawId:i}=r),r&&!n&&({matchUpId:n}=r);const{drawDefinition:a}=Qs({tournamentRecord:e,drawId:i});if(!a)return{error:Ee};{const r=iS({tournamentParticipants:e.participants,drawDefinition:a,participantId:t,matchUpId:n});if(r.error)return r}return{...L}},toggleParticipantCheckInState:aS,addDrawDefinitionTimeItem:KT,generateDrawTypeAndModifyDrawDefinition:function(e){return Sw(e)},generateDrawStructuresAndLinks:function(e){return Iw(e)},generateDrawMaticRound:QP,generateDrawDefinition:TR,applyLineUps:function({tournamentRecord:e,drawDefinition:t,matchUpId:n,lineUps:r,event:i}){if(!e)return{error:$};if(!t)return{error:Q};if("string"!=typeof n)return{error:tt};if(!Array.isArray(r))return{error:xn,lineUps:r};const a=e.participants||[];let o=Qp({tournamentParticipants:a,inContext:!0,drawDefinition:t,matchUpId:n});if(o.error)return o;if(!o.matchUp)return{error:Xe};const{matchUp:s,structure:c}=o,{drawPositions:u,matchUpType:d}=s;if(d!==ji)return{error:tt};if(!u?.length)return{error:ie};const p=Ni({matchUp:s,drawDefinition:t,structure:c,event:i})?.tieFormat,l={};for(const f of r){if(!Array.isArray(f))return{error:xn,lineUp:f};const t={},n=[];for(const e of f){if("object"!=typeof e)return{error:xn,lineUpAssignment:e};const{participantId:r,collectionAssignments:i=[]}=e;if(!Array.isArray(i))return{error:xn,collectionAssignments:i};const o=a.find((e=>e.participantId===r));if(!o)return{error:Bt};if(o.participantType!==qu)return{error:Ft};const c=s.sides?.find((e=>e.participant?.individualParticipantIds?.includes(r)))?.sideNumber;c&&n.push(c);for(const e of i){if("object"!=typeof e)return{error:xn,collectionAssignment:e};const{collectionId:n,collectionPosition:i}=e,a=p?.collectionDefinitions?.find((e=>e.collectionId===n));if(!a)return{error:xn,collectionId:n};const o=`${n}-${i}`;t[o]||(t[o]=[]);const s=t[o].length;if(a.matchUpType===_i&&s||a.matchUpType===Bi&&s>1)return{info:"Excessive collectionPosition assignments",error:xn};t[o].push(r)}}const r=Object.values(t);for(const s of r)if(2===s.length){const{participant:t}=Xu({tournamentParticipants:a,participantIds:s});if(!t){const t=By({participant:{participantType:Wu,participantRole:jT,individualParticipantIds:s},pairOverride:!0,tournamentRecord:e});if(t.error)return t}}const i=R(n),o=((i[1]||0)>(i[2]||0)?1:(i[2]||0)>(i[1]||0)&&2)||void 0,c=Object.keys(l).map((e=>parseInt(e)));o&&!c.includes(o)&&(l[o]=f)}if(!Object.keys(l).length)return{error:jn};if(o=Qp({drawDefinition:t,matchUpId:n}),o.error)return o;if(!o.matchUp)return{error:Xe};const{matchUp:m}=o;m.sides||(m.sides=[]);for(const f of[1,2]){const e=m.sides.find((e=>e.sideNumber===f)),t=l[f];t&&(e?e.lineUp=t:m.sides.push({lineUp:t,sideNumber:f}))}return rl({tournamentId:e?.tournamentId,context:"applyLineUps",drawDefinition:t,matchUp:m}),{...L}},assignTieMatchUpParticipantId:iD,removeTieMatchUpParticipantId:function(e){const{tournamentRecord:t,drawDefinition:n,participantId:r,event:i}=e,a="removeTieMatchUpParticiapantId";if(!r)return Mi({result:{error:Lt},stack:a});const o=rD(e);if(o.error)return o;const{appliedPolicies:s}=Xo({tournamentRecord:t,drawDefinition:n,event:i}),c=e.policyDefinitions?.[lo]??s?.[lo]??BI[lo],u=c?.processCodes?.substitution,{inContextDualMatchUp:d,inContextTieMatchUp:p,relevantAssignments:l,collectionPosition:m,teamParticipants:f,collectionId:h,matchUpType:I,dualMatchUp:g,tieMatchUp:U,tieFormat:y}=o;if(!g)return Mi({result:{error:et},stack:a});const v=p?.sides?.find((e=>e.participant?.participantId===r||e.participant?.individualParticipantIds?.includes(r)));if(!v)return Mi({result:{error:Bt},stack:a});if(!v.substitutions?.length&&(dl({score:p?.score})||p?.winningSide))return Mi({result:{error:Hn},stack:a});const S=d?.sides?.find((({sideNumber:e})=>e===v.sideNumber))?.participantId;if(!S)return Mi({result:{error:Bt},stack:a});const w=Kg({participantFilters:{participantIds:[r]},tournamentRecord:t})?.participants?.[0];if(!w)return Mi({result:{error:Bt},stack:a});if(I===_i&&w.participantType===Wu)return Mi({result:{error:At},stack:a});const P=w.participantType===qu?[r]:w.individualParticipantIds;cl({tournamentId:t.tournamentId,eventId:i.eventId,inContextDualMatchUp:d,drawDefinition:n,dualMatchUp:g});let T=g.sides?.find((({sideNumber:e})=>e===v.sideNumber));if(!T&&(g.sides?.filter((({lineUp:e})=>!e)).length||0)<2){const e=f?.map((({participantId:e})=>({drawPosition:l?.find((t=>t.participantId===e))?.drawPosition,teamParticipantId:e})));T=g.sides?.find((t=>e?.find((({drawPosition:e})=>e===t.drawPosition))?.teamParticipantId===S))}if(!T)return Mi({result:{error:Bt,context:{participantId:r}}});const{modifiedLineUp:D,previousParticipantIds:R}=nD({collectionPosition:m,teamParticipantId:S,dualMatchUpSide:T,participantIds:P,drawDefinition:n,collectionId:h});if(T.lineUp=D,S&&y&&wy({participantId:S,lineUp:D,drawDefinition:n,tieFormat:y}),I===Bi&&w.participantType===qu){const e=p?.sides?.find((e=>e.sideNumber===T?.sideNumber)),{participantId:n}=e??{},i=n&&Kg({participantFilters:{participantIds:[n]},tournamentRecord:t,withDraws:!0})?.participants?.[0];if(!i)return Mi({result:{error:Bt},stack:a});{const e=i?.individualParticipantIds?.filter((e=>e!==r))??[];if(R&&e.push(...R),e.length>2)return Mi({result:{error:Ct},stack:a});if(i.draws?.length){if(1===e.length){const{participant:n}=Xu({participantIds:e,tournamentRecord:t});if(!n){const n=By({participant:{participantRole:jT,individualParticipantIds:e,participantType:Wu},pairOverride:!0,tournamentRecord:t});if(n.error)return Mi({result:n,stack:a})}}}else if(e.length){i.individualParticipantIds=e;const n=YT({participant:i,pairOverride:!0,tournamentRecord:t});if(n.error)return Mi({result:n,stack:a})}else{const e=EP({participantIds:[n],tournamentRecord:t});e.error&&console.log("cleanup",{result:e})}}}if(1===v.substitutions?.length){const e=p?.sides?.find((e=>e.sideNumber!==v.sideNumber));if(!e?.substitutions?.length&&U?.processCodes?.length){for(const e of u||[]){const t=U.processCodes.lastIndexOf(e);U.processCodes.splice(t,1)}rl({tournamentId:t?.tournamentId,matchUp:U,context:a,drawDefinition:n})}}return rl({tournamentId:t?.tournamentId,matchUp:g,context:a,drawDefinition:n}),{...L,modifiedLineUp:D}},replaceTieMatchUpParticipantId:MD,resetMatchUpLineUps:function(e){return e.tournamentRecord?_P(e):{error:$}},updateTeamLineUp:wy,validateLineUp:Sy,getTeamLineUp:Zu};function RR({singlesForDoubles:e,exclusionRule:t,valueAccessor:n,matchUpType:r,scaleName:i,sides:a}){const o=t?.range.sort(),s=e=>{const n=e?.[t?.valueAccessor];return{exclude:t&&n>=o[0]&&n<=o[1],exclusionValue:n}};return a.sort(((e,t)=>e.sideNumber-t.sideNumber)).map((({participant:t})=>{const a=[],o=t?.individualParticipants;if(o?.length){const c=[];let u=0;for(const t of o){const{scaleValue:o,value:d}=bR({singlesForDoubles:e,valueAccessor:n,participant:t,matchUpType:r,scaleName:i}),{exclude:p,exclusionValue:l}=s(o);p&&a.push(l),c.push(o),d&&!isNaN(u)?u+=d:u=void 0}return{participantName:t.participantName,exclusionValues:a,scaleValues:c,value:u}}if(t){const{scaleValue:o,value:c}=bR({singlesForDoubles:e,valueAccessor:n,matchUpType:r,participant:t,scaleName:i}),{exclude:u,exclusionValue:d}=s(o);return u&&a.push(d),{participantName:t.participantName,exclusionValues:a,scaleValue:o,value:c}}return{}}))}function bR({singlesForDoubles:e,valueAccessor:t,matchUpType:n,participant:r,scaleName:i}){const a=e?_i:n,o=r?.rankings?.[a]?.find((e=>e.scaleName===i)),s=r?.ratings?.[a]?.find((e=>e.scaleName===i)),c=(s||o)?.scaleValue;return{scaleValue:c,value:t?c?.[t]:c}}const NR={allTournamentMatchUps:rh,tournamentMatchUps:oh,allEventMatchUps:ah,getRoundMatchUps:function(e){return ed(e)},allDrawMatchUps:ih,eventMatchUps:sh,drawMatchUps:function({participants:e,tournamentAppliedPolicies:t,scheduleVisibilityFilters:n,participantsProfile:r,afterRecoveryTimes:i,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextFilters:c,contextProfile:u,contextContent:d,drawDefinition:p,matchUpFilters:l,participantMap:m,nextMatchUps:f,tournamentId:h,inContext:I,context:g,event:U}){const{eventId:y,eventName:v,endDate:S}=U??{},w={...g,...pi({eventId:y,eventName:v,endDate:S??U?.endDate??s?.endDate,tournamentId:h??s?.tournamentId,indoorOutDoor:U?.indoorOutdoor??s?.indoorOutdoor,surfaceCategory:U?.surfaceCategory??s?.surfaceCategory})};let P;return!e?.length&&s&&({participants:e,participantMap:m,groupInfo:P}=nh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:u,inContext:I})),U&&u&&!d&&(d=ss({policyDefinitions:a,tournamentRecord:s,contextProfile:u,drawDefinition:p,event:U})),{...Ol({context:w,tournamentAppliedPolicies:t,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:r,afterRecoveryTimes:i,policyDefinitions:a,tournamentRecord:s,participantMap:m,drawDefinition:p,matchUpFilters:l,contextFilters:c,contextProfile:u,contextContent:d,nextMatchUps:f,inContext:I,event:U}),groupInfo:P}},credits:SS,getTournamentStructures:function({withStageGrouping:e,tournamentRecord:t,stageSequences:n,stageSequence:r,roundTarget:i,stages:a,stage:o}){if(!t)return{error:$};const s={},c=[];for(const u of t.events||[]){const{structures:t,stageStructures:d}=xI({withStageGrouping:e,stageSequences:n,stageSequence:r,roundTarget:i,stages:a,event:u,stage:o});if(t&&c.push(...t),d)for(const e of Object.keys(d))s[e]||(s[e]=[]),s[e].push(...d[e])}return{structures:c,stageStructures:s}},getEventStructures:xI,getEvents:function({tournamentRecord:e,withScaleValues:t,scaleEventType:n,inContext:r,eventIds:i,drawIds:a,context:o}){if(!e)return{error:$};const{tournamentId:s}=e,c=(e.events??[]).filter((({eventId:e})=>!i||Array.isArray(i)&&i.includes(e))).map((e=>{const t=ii(e);return r&&Object.assign(t,{tournamentId:s}),o&&Object.assign(t,o),t})),u={};if(t){const t=Kg({withScaleValues:!0,tournamentRecord:e}).participantMap,r=e=>e.reduce(((e,t)=>e+parseFloat(t)),0);for(const e of c){const i=n??e.eventType,o=e.eventId;u[o]||(u[o]={ratingsStats:{},ratings:{},ranking:{},draws:{}});const s=(e.entries??[]).filter((({entryStatus:e})=>bp.includes(e))).map(di("participantId")),c=e=>{if(e?.ratings?.[i])for(const t of e?.ratings?.[i]??[]){const e=t.scaleName;u[o].ratings[e]||(u[o].ratings[e]=[]);const n=zm[e]?.accessor;if(n){const r=parseFloat(t.scaleValue?.[n]);r&&u[o].ratings[e].push(r)}}};for(const e of s){const n=t?.[e]?.participant;if(n?.participantType!==qu)for(const e of n?.individualParticipantIds??[]){const n=t?.[e]?.participant;c(n)}else c(n)}const d=u[o].ratings;for(const e of Object.keys(d)){const t=d[e];if(!t.length)continue;const n=h(t)?.toFixed(2);u[o].ratingsStats[e]={avg:parseFloat((r(t)/t.length).toFixed(2)),median:n?parseFloat(n):void 0,max:Math.max(...t),min:Math.min(...t)}}const p=(e,n)=>{const r=t=>{if(u[o].draws?.[e]&&t?.ratings?.[i])for(const n of t?.ratings?.[i]??[]){const t=n.scaleName;u[o].draws[e]?.ratings[t]||(u[o].draws[e].ratings[t]=[]);const r=zm[t]?.accessor;if(r){const i=parseFloat(n.scaleValue?.[r]);i&&u[o].draws[e].ratings[t].push(i)}}};for(const i of n.filter(Boolean)){const e=t?.[i]?.participant;if(e?.participantType!==qu)for(const n of e?.individualParticipantIds??[]){const e=t?.[n]?.participant;r(e)}else r(e)}},l=[],m=e=>a?.length&&a.includes(e)||l.includes(e);for(const t of e.drawDefinitions??[]){const e=t.drawId;if(m(e))continue;const n=Hh({drawDefinition:t}).assignedParticipantIds??[];u[o].draws[e]||(u[o].draws[e]={ratingsStats:{},ratings:{},ranking:{}}),l.push(e),p(e,n)}const f=Ks({event:e}).flightProfile;for(const e of f?.flights??[]){const t=e.drawId;if(m(t))continue;p(t,e.drawEntries.map(di("participantId")))}for(const e of l){const t=u[o].draws[e].ratings;for(const n of Object.keys(t)){const i=t[n];if(!i.length)continue;const a=h(i)?.toFixed(2);u[o].draws[e].ratingsStats[n]={avg:parseFloat((r(i)/i.length).toFixed(2)),median:a?parseFloat(a):void 0,max:Math.max(...i),min:Math.min(...i)}}}}}return pi({eventScaleValues:u,events:c,...L})},getEvent:function({tournamentRecord:e,drawDefinition:t,context:n,event:r}){if(!e)return{error:$};if(!r)return{error:Ae};const i=ii(r);return n&&Object.assign(i,n),pi({drawDefinition:t&&i.drawDefinitions?.find((({drawId:e})=>t.drawId===e)),event:i})},findDrawDefinitionExtension:Cs,findParticipantExtension:function({tournamentRecord:e,participantId:t,name:n}){if(!e)return Mi({result:{error:$},stack:Ns});if(!t)return Mi({result:{error:Lt},stack:Ns});const{participant:r}=bs({tournamentRecord:e,participantId:t});return Ms({element:r,name:n})},findTournamentExtension:As,findEventExtension:Es,findExtension:lc,getTieFormat:function({tournamentRecord:e,drawDefinition:t,structureId:n,matchUpId:r,structure:i,eventId:a,drawId:o,event:s}){if(!e)return{error:$};if(!(o||s||n||r))return Mi({result:{error:mt},stack:"getTieFormat"});a&&!s&&(s=e.events?.find((e=>e.eventId===a)));const c=NI({tournamentRecord:e,drawDefinition:t,matchUpId:r,drawId:o,event:s});if(r&&c?.error)return c;if(!t&&c?.drawDefinition&&(t=c?.drawDefinition),!(i=i??c?.structure)&&n&&!r){if(!t)return{error:le};const e=rp({drawDefinition:t,structureId:n});if(e.error)return e;i=e.structure}const u=(i?.tieFormat||i?.tieFormatId)&&Ni({structure:i,drawDefinition:t,event:s})?.tieFormat,d=(t?.tieFormat||t?.tieFormatId)&&Ni({drawDefinition:t,event:s})?.tieFormat,p=Ni({event:s})?.tieFormat,l=Ni({matchUp:c?.matchUp,drawDefinition:t,structure:i,event:s})?.tieFormat;return{...L,matchUp:c?.matchUp,structureDefaultTieFormat:ul(u),eventDefaultTieFormat:ul(p),drawDefaultTieFormat:ul(d),tieFormat:ul(l),structure:i}},getMatchUpFormat:function({tournamentRecord:e,drawDefinition:t,structureId:n,matchUpId:r,drawId:i,event:a}){if(!e)return{error:$};if(!(i||a||n||r))return Mi({result:{error:mt},stack:"getMatchUpFormat"});const o=MI({tournamentRecord:e,drawDefinition:t,matchUpId:r,drawId:i,event:a});if(r&&o?.error)return o;!t&&o?.drawDefinition&&(t=o?.drawDefinition);let s=o?.structure;if(!s&&n&&!r){if(!t)return{error:le};const e=rp({drawDefinition:t,structureId:n});if(e.error)return e;s=e.structure}const c=s?.matchUpFormat,u=t?.matchUpFormat,d=a?.matchUpFormat;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:d,drawDefaultMatchUpFormat:u,matchUpFormat:o?.matchUp?.matchUpFormat||c||u||d}},getDrawDefinition:function({tournamentRecord:e,drawDefinition:t}){return e?t?{drawDefinition:ii(t)}:{error:le}:{error:$}},getEventProperties:function({tournamentRecord:e,event:t}){if(!e)return{error:$};if(!t)return{error:Ae};const n=t.entries||[],r=e.participants||[],i=t.category?.categoryName||t.category?.ageCategoryCode,{eventType:a}=t,o=n.map((e=>e.participantId));let s,c,u;return{entryScaleAttributes:r.filter((e=>o.includes(e.participantId))).map((e=>{const{participantId:t,participantName:n,name:r}=e;let o={scaleType:gu,eventType:a,scaleName:i};const d=zh({participant:e,scaleAttributes:o})?.scaleItem?.scaleValue;o={scaleType:Iu,eventType:a,scaleName:i};const p=zh({participant:e,scaleAttributes:o})?.scaleItem?.scaleValue;o={scaleType:hu,eventType:a,scaleName:i};const l=zh({participant:e,scaleAttributes:o})?.scaleItem?.scaleValue;return s=!(!s&&!d),c=!(!c&&!p),u=!(!u&&!l),{participantId:t,participantName:n||r,seed:d,ranking:p,rating:l}})),hasSeededParticipants:s,hasRankedParticipants:c,hasRatedParticipants:u}},getPositionAssignments:AD,isValidMatchUpFormat:Ti,getMaxEntryPosition:function(e){const{entries:t=[],entryStatus:n,stage:r}=e;return Math.max(...t.filter((e=>!(r&&r!==e.entryStage||n&&e.entryStatus!==n||isNaN(e.entryPosition)))).map((({entryPosition:e})=>m(e||0))),0)},getMatchUpCompetitiveProfile:hs,findVenue:$c,getCourts:function({tournamentRecord:e,venueId:t,venueIds:n}){return e?{courts:(e.venues||[]).filter((e=>t?e.venueId===t:!n||n.includes(e.venueId))).map((e=>{const{venueId:t}=e,n=ii(e.courts||[]);return n.forEach((e=>Object.assign(e,{venueId:t}))),n})).flat()}:{error:$}},getVenuesAndCourts:qc,findCourt:function(e){return ii(Wc(e),!1,!0)},getEventTimeItem:Yf,getTournamentTimeItem:Kf,getParticipantTimeItem:function({returnPreviousValues:e,tournamentRecord:t,participantId:n,itemSubTypes:r,itemType:i}){if(!t)return{error:$};if(!n)return{error:Lt};const a=bs({tournamentRecord:t,participantId:n});if(a.error)return a;const{participant:o}=a;if(!o?.timeItems)return{info:Gn};const{timeItem:s,previousItems:c,info:u}=zf({element:a.participant,returnPreviousValues:e,itemSubTypes:r,itemType:i});return s&&{timeItem:s,previousItems:c}||{info:u}},getDrawDefinitionTimeItem:function({returnPreviousValues:e,drawDefinition:t,itemSubTypes:n,itemType:r}){if(!t)return{error:le};if(!t.timeItems)return{info:Gn};const{timeItem:i,previousItems:a,info:o}=zf({element:t,returnPreviousValues:e,itemSubTypes:n,itemType:r});return i&&{timeItem:i,previousItems:a}||{info:o}},bulkUpdatePublishedEventIds:function({tournamentRecord:e,outcomes:t}){if(!e)return{error:$};if(!t?.length)return{error:mt,info:"Missing outcomes"};const n=t.reduce(((e,t)=>{const{drawId:n,eventId:r}=t;return r&&n&&(e[r]?e[r].includes(n)||e[r].push(n):e[r]=[n]),e}),{}),r=Object.keys(n),i=e.events?.filter((e=>r.includes(e.eventId)));return{publishedEventIds:i.filter((e=>{const{timeItem:t}=Yf({itemType:`${Uu}.${vu}`,event:e}),r=t?.itemValue,{eventId:i}=e;return n[i].filter((e=>r?.[yu]?.drawIds?.includes(e))).length})).map((e=>e.eventId)),eventIdPublishedDrawIdsMap:n}},matchUpActions:pg,positionActions:function(e){const{tournamentRecord:t}=e;if(!t)return{error:$};const{participants:n}=Kg({withIndividualParticipants:!0,tournamentRecord:t});return pU({tournamentParticipants:n,...e})},findMatchUp:NI,participantScheduledMatchUps:BT,getPredictiveAccuracy:function(e){let{matchUps:t}=e;const{singlesForDoubles:n,tournamentRecord:r,drawDefinition:i,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:c,scaleName:u,eventId:d,zonePct:p,drawId:l,event:m}=e;if(!r&&!t)return{error:$};if(c&&![_i,Bi].includes(c))return{error:xn,info:{matchUpType:c}};if(t&&!La(t))return{error:xn,context:{matchUps:t}};const f=zm[u],h=f?.ascending??e.ascending??!1,I=f?.accessor??e.valueAccessor,g=Array.isArray(f?.range)?Math.abs(f.range[0]-f.range[1]):0,U=S(p)&&g?(p??0)*g:e.zoneMargin??g,y={withScaleValues:!0,withCompetitiveness:!0},v={matchUpTypes:c?[c]:[_i,Bi]},w=r?.participants;t?.[0]?.hasContext?l?t=t.filter((e=>e.drawId===l)):d&&(t=t.filter((e=>e.eventId===d))):void 0===t&&(t=l&&!i&&[]||!l&&d&&!m&&[]||l&&ih({inContext:!0,drawDefinition:i,contextFilters:v,contextProfile:y,participants:w})?.matchUps||!l&&d&&ah({inContext:!0,contextFilters:v,contextProfile:y,participants:w,event:m})?.matchUps||rh({tournamentRecord:r,contextFilters:v,contextProfile:y})?.matchUps||[]),c&&(t=t.filter((e=>e.matchUpType===c)));const P=t.filter((({winningSide:e,score:t,sides:n,matchUpStatus:r})=>![Pa,ga,Ra,Ia,pa].includes(r??"")&&dl({score:t})&&2===n?.length&&e)),T=function({excludeMargin:e,exclusionRule:t,valueAccessor:n,ascending:r,scaleName:i,matchUps:a}){const o={affirmative:[],negative:[],excluded:[]};for(const u of a){const{matchUpType:a,sides:s,score:c,winningSide:d}=u;if(!d)continue;if(t&&(!t.valueAccessor||!t.range))return{info:"exclusionRule requires valueAccessor and range",error:mt};const p=d-1,l=RR({exclusionRule:t,valueAccessor:n,matchUpType:a,scaleName:i,sides:s});if(t){const e=l.map((({exclusionValues:e})=>e)).flat();if(e.length){o.excluded.push({scoreString:c?.scoreStringSide1,exclusionValues:e,winningSide:d,sideValues:l});continue}}if(l.filter((e=>![void 0,"",null].includes(e.value))).length<2){o.excluded.push({scoreString:c?.scoreStringSide1,missingValues:!0,winningSide:d,sideValues:l});continue}const m=l[p].value-l[1-p].value,f=parseFloat(e||0),h=f&&Math.abs(m)<f;if(h){o.excluded.push({scoreString:c?.scoreStringSide1,excludeMargin:e,winningSide:d,excludeGap:h,sideValues:l,valuesGap:m});continue}const I=r?m:-1*m,g=1===d?c?.scoreStringSide1:c?.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:g,winningSide:d,sideValues:l,valuesGap:m,score:c}):o.negative.push({winningScoreString:g,winningSide:d,sideValues:l,valuesGap:m,score:c})}const s=o.affirmative.length+o.negative.length,c=s&&o.affirmative.length/s*100;return o.percent=c?Math.round(100*c)/100:0,o}({matchUps:P,excludeMargin:a,exclusionRule:o,valueAccessor:I,ascending:h,scaleName:u}),D=s&&c!==_i?2*(U||0):U,R=U?P.map((({competitiveProfile:e,matchUpType:t,score:r,sides:i})=>{const a=RR({singlesForDoubles:n,valueAccessor:I,matchUpType:t,scaleName:u,sides:i}),o=Math.abs(a[0].value-a[1].value);return{competitiveness:e?.competitiveness,valuesGap:o,score:r}})).filter((({valuesGap:e})=>e<=D)):[],b=function({zoneData:e}){const t={[ns]:[],[rs]:[],[is]:[]};for(const n of e){const{competitiveness:e,score:r,valuesGap:i}=n;t[e]&&t[e].push({score:r,valuesGap:i})}return t}({zoneData:R}),N=b&&[].concat(Object.values(b)).flat().length,M=N&&Object.assign({},...Object.keys(b).map((e=>({[e]:Math.round(1e4*b[e].length/N)/100})))),A=P.length-(R?.length||0);return{...L,relevantMatchUps:P,zoneDistribution:M,zoneData:R,accuracy:T,nonZone:A}},getMatchUpsStats:function({profileBands:e,tournamentRecord:t,matchUps:n}){if(!La(n))return{error:Ze};const r=!e&&fs({policyType:co,tournamentRecord:t}).policy,i=e||r?.profileBands||os[co].profileBands,a=n.filter((({winningSide:e})=>e)),o=ms(a.map(ps)).reduce(((e,t)=>((e,t)=>(e[ds(t,i)]+=1,e))(e,t)),{[ns]:0,[rs]:0,[is]:0,[es]:0}),s=Object.keys(o).reduce(((e,t)=>(o[t]||0)+e),0),c=Object.keys(o).map((e=>({[e]:100*parseFloat((o[e]/s).toFixed(4))}))),u=a.filter((({matchUpStatus:e})=>e===ts)).length;return c.push({[ts]:100*parseFloat((u/s).toFixed(4))}),{competitiveBands:Object.assign({},...c),...L}},participantScaleItem:zh,getParticipantScaleItem:uR,getParticipantSignInStatus:function({tournamentRecord:e,participantId:t}){if(!e)return{error:$};if(!t)return{error:Lt};const{participant:n}=bs({tournamentRecord:e,participantId:t});if(!n)return{error:Bt};const{timeItem:r}=zf({itemType:Gu,element:n});return r&&r.itemValue===Yu&&Yu},getPolicyDefinitions:Zo,getMatchUpScheduleDetails:Vu},MR={addVenue:Gc,deleteVenue:MS,deleteVenues:function({tournamentRecord:e,venueIds:t,force:n}){if(!e)return{error:$};if(!Array.isArray(t))return{error:xn};for(const r of e.venues||[]){const{venueId:i}=r;if(t.includes(i)){const{venueId:t}=r,i=MS({tournamentRecord:e,venueId:t,force:n});if(i.error)return i}}return{...L}},modifyVenue:$S,enableCourts:DS,enableVenues:RS,disableCourts:PS,disableVenues:TS,addCourt:GS,addCourts:qS,deleteCourt:OS,modifyCourt:VS,modifyCourtAvailability:LS,findVenue:function({convertExtensions:e,...t}){const{tournamentRecords:n,tournamentRecord:r,venueId:i}=t;return ii($c({tournamentRecords:n,tournamentRecord:r,venueId:i}),e,!0)}},AR=(()=>{const e={getState:e=>kT({convertExtensions:e?.convertExtensions,removeExtensions:e?.removeExtensions,tournamentId:gr()}),newTournamentRecord:(e={})=>{const t=OT(e),n=t.tournamentId;return t.error?t:(vr(t),wr(n),{...L,tournamentId:n})},setTournamentId:e=>wr(e),version:()=>"1.8.46",reset:()=>t(Pr(gr())),setState:(e,n,r)=>{cr(n,r);return t(FT(e,n))},getDevContext:e=>ar(e),executionQueue:(t,r)=>function(t,r){if(!Array.isArray(t))return{error:xn};const i=gr(),a=Ur(i),o=r&&ii(a,!1,!0),s=[];for(const d of t){if("object"!=typeof d)return{error:xn};const{method:t,params:r}=d;if(!e[t]){const e={error:Qn,methodName:t},n=ar();return(n.result&&!Array.isArray(n.result)||Array.isArray(n.result)&&n.result?.includes(t))&&console.log("te:",e),e}const i=n(a,e[t],r,t);if(i?.error)return o&&FT(o),{...i,rolledBack:!!o};s.push({...i,methodName:t})}const c=dr(),u=Date.now();c&&IU({tournamentRecord:a,value:{version:"1.8.46",timeStamp:u}});gU({directives:t,mutationStatus:c,timeStamp:u,tournamentId:i}),fr();return{success:s.every((e=>e.success)),results:s}}(t,r),devContext:t=>(or(t),e)};function t(t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}return[NR,DR,MR,DD,ND,PD,tD,wD,ZT].forEach((t=>{Object.keys(t).forEach((n=>{e[n]=e=>{if(ar())return r(t[n],e,n);try{return r(t[n],e,n)}catch(i){Dr({engineName:"tournamentEngine",methodName:n,params:e,err:i})}}}))})),e;function n(t,n,r,i){delete e.success,delete e.error;const a=Date.now(),o=n({...xT(t,r),tournamentRecord:t});return QS({result:o,methodName:i,elapsed:Date.now()-a,params:r,engine:"te:"}),o}function r(e,t,r){const i=gr(),a=t?.sandBoxRecord||t?.sandboxRecord||t?.sandboxTournament||Ur(i),o=t?.rollbackOnError&&ii(a,!1,!0),s=n(a,e,t,r);s?.error&&o&&FT(o);const c=s?.success&&!0!==t?.delayNotify&&!0!==t?.doNotNotify,u=dr(),d=Date.now();return u&&(IU({tournamentRecord:a,value:{version:"1.8.46",timeStamp:d}}),s.modificationsApplied=!0),c&&gU({directives:[{method:e,params:t}],mutationStatus:u,tournamentId:i,timeStamp:d}),(c||!s?.success||t?.doNotNotify)&&fr(),s}})();function ER(e,t){if("object"!=typeof e)return{error:On};const n=e.unifiedTournamentId?.tournamentId||e.tournamentId;if(!n)return{error:H};const r=!1!==t?ii(e):e;return Sr({[n]:r}),wr(n),r}function CR(e){const{convertExtensions:t,removeExtensions:n,tournamentId:r}=e||{};if("string"!=typeof r)return{};return{tournamentRecord:ii(Ur(r),t,!1,n)}}function OR(e,t){return e?(t?.someParam&&(t={...t}),t):t}function FR(e,t){return e&&t&&Array.isArray(t)&&t[e-1]||"object"==typeof t&&t[e]}function kR(e){const{participation:t={},awardProfiles:n,startDate:r,eventType:i,drawSize:a,drawType:o,category:s,endDate:c,level:u}=e,{participationOrder:d,flightNumber:p,rankingStage:l}=t,m=n.find((e=>(e=>!r&&!c||!e.dateRanges||e.dateRanges.some((e=>{const t=!r||!e.startDate||new Date(r)>new Date(e.startDate),n=!c||!e.endDate||new Date(c)<=new Date(e.endDate);return t&&n})))(e)&&(!e.maxFlightNumber||p<=e.maxFlightNumber)&&(!e.drawTypes?.length||e.drawTypes?.includes(o))&&(!e.drawSizes?.length||e.drawSizes.includes(a))&&(!e.stages?.length||e.stages.includes(l))&&(!e.levels?.length||e.levels.includes(u))&&(!e.maxDrawSize||a<=e.maxDrawSize)&&(!e.drawSize||e.drawSize===a)&&(!e.maxLevel||u<=e.maxLevel)&&(!p||!e.flights?.flightNumbers?.length||e.flights.flightNumbers.includes(p))&&(!e.participationOrder||e.participationOrder===d)&&(!e.category?.ageCategoryCodes||e.category.ageCategoryCodes.includes(s?.ageCategoryCode))&&(!e.eventTypes?.length||e.eventTypes?.includes(i))));return{awardProfile:m}}function xR({participantWon:e,flightNumber:t,valueObj:n,drawSize:r,flights:i,level:a}){const o=(e,t)=>{const n=e?.value||e?.v||(S(e)?e:0),r=FR(a,e?.level),i=((e,t)=>{if(e){if(Array.isArray(t)){const n=t.find((t=>t.flight===e||t.f===e));return n.value||n.v}if("object"==typeof t){const n=t.flights||t.f;if(Array.isArray(n))return n[e-1]}}})(t,r);return{value:i||S(r)&&r||n}};let s,c,u,d,p=0;const l=(e?"won":!1===e&&"lost")||void 0;if(Array.isArray(n)){let e=n.find((e=>e.drawSize===r||e.drawSizes?.includes(r))),i=n.find((e=>e.drawSize&&e.threshold&&r>e.drawSize)),a=n.find((e=>!e.drawSize&&!e.drawSizes?.length));void 0!==l&&(e=e?.[l],i=i?.[l],a=a?.[l]),c=o(e,t).value,u=o(i,t).value,d=o(a,t).value,p=c||u||d,s=c&&e.requireWin||u&&i.requireWin||a?.requireWin}else if("object"==typeof n){let e=n?.drawSizes?.[r],i=n;void 0!==l&&(e=e?.[l],i=i?.[l]),c=o(e,t).value,d=o(i,t).value,p=c||d,s=c?e.requireWin:i?.requireWin}else S(n)&&void 0===l&&(p=n);return t&&i?.pct?.[t]&&(p=Math.round(p*i.pct[t])),{awardPoints:p,requireWin:s}}const _R={getTournamentPoints:function({participantFilters:e,policyDefinitions:t,tournamentRecord:n,saveRankings:r,level:i}){if(!n)return{error:$};const{policyDefinitions:a}=Zo({policyTypes:[mo],tournamentRecord:n}),o=t?.[mo]??a?.[mo];if(!o)return{error:rt};const s=o.awardProfiles;let c=o.requireWinFirstRound;const u=o.requireWinForPoints,{participants:d,derivedEventInfo:p,derivedDrawInfo:l,mappedMatchUps:m}=Kg({withRankingProfile:!0,participantFilters:e,tournamentRecord:n}),f=d?.filter((e=>e.draws?.length)),h={},I={},g={};for(const U of f??[]){const{participantType:e,participantId:t,person:r,draws:a}=U;for(const o of a){const{drawId:a,structureParticipation:d,eventId:f}=o,y=p[f],v=l[a],S=v?.drawType,{category:w,eventType:T}=y||{},D=o.startDate||y.startDate||n.startDate,R=o.endDate||y.endDate||n.endDate;if(T===Lu&&t!==zu)continue;let b;if(s){let n,o=u,p=0,l=0,f=0;for(const r of d){const{finishingPositionRange:a,participationOrder:u,participantWon:d,flightNumber:h,rankingStage:I,winCount:g}=r;p+=g||0;const y=v?.drawSize,{awardProfile:N}=kR({awardProfiles:s,participation:r,eventType:T,startDate:D,category:w,drawSize:y,drawType:S,endDate:R,level:i});if(N){if(!y)continue;const e=Array.isArray(a)&&Math.max(...a),t=P(a||[]).join("-"),r=e&&I!==rd&&a?.includes(y);void 0!==N.requireWinForPoints&&(o=N.requireWinForPoints),void 0!==N.requireWinFirstRound&&(c=N.requireWinFirstRound);const{finishingPositionPoints:s={},finishingPositionRanges:p,finishingRound:m,pointsPerWin:U,flights:v}=N,S=Array.isArray(N.perWinPoints)?N.perWinPoints?.find((e=>e.participationOrders?.includes(u))):N.perWinPoints,w=s.participationOrders;let T,D=0;if((!w||w.includes(u))&&p&&e){const t=p[e];t&&({awardPoints:D,requireWin:T}=xR({flightNumber:h,valueObj:t,drawSize:y,flights:v,level:i}))}if(!D&&m&&1===u&&e){const t=m[e];t&&({awardPoints:D,requireWin:T}=xR({participantWon:d,flightNumber:h,valueObj:t,drawSize:y,flights:v,level:i}))}if(r&&void 0!==c&&(o=c),void 0!==T&&(o=T),D>l&&(!o||g)&&(l=D,n=e),!D&&U&&g&&(f+=g*U,n=t),!D&&g&&S){const e=FR(i,S?.level);e?f+=g*e:S.value&&(f+=g*S.value)}}if(b=l+f,e===zu){const e=(U.matchUps||[]).filter((({structureId:e})=>e===r.structureId));for(const{matchUpId:n}of e){const e=m[n],r=e.sides.find((e=>e.participantId===t)).sideNumber;if(e.winningSice===r)for(const t of e.tieMatchUps)t.winningSide}}}if(f||l){const i={winCount:p,positionPoints:l,rangeAccessor:n,perWinPoints:f,eventType:T,drawId:a,points:b},o=r?.personId;o?(h[o]||(h[o]=[]),h[o].push(i)):e===Wu?(g[t]||(g[t]=[]),g[t].push(i)):e===zu&&(I[t]||(I[t]=[]),I[t].push(i))}}}}if(r){Js({element:n,extension:{name:Go,value:{personPoints:h,teamPoints:I,pairPoints:g}}})}return{participantsWithOutcomes:f,personPoints:h,pairPoints:g,teamPoints:I,...L}}};const LR={nSpread:400,diffThreshold:.125,kCalc:e=>250/Math.pow(e+5,.4),kMultiplier:function(e=3,t=2){const n=e/t;return isNaN(n)?LR.kDefault():n},kDefault:()=>1};function BR(e){let{winnerRating:t,loserRating:n,ratingRange:r}=e;const{ratings:i=zm,winnerCountables:a=1,loserCountables:o=0,ratingType:s=qm,maxCountables:c,countables:u}=e||{},d=i?.[s];if(!d)return{error:mt};r=d.range||r,t=t||d.defaultInitialization,n=n||d.defaultInitialization;const p=r[0]>r[1],l=d.decimalsCount||0,m=p?r.slice().reverse():r,f=(e,t)=>parseFloat(t)>=Math.min(...e)&&parseFloat(t)<=Math.max(...e);f(r,t)&&f(r,n)||(f(r,t)||(t=d.defaultInitialization),f(r,n)||(n=d.defaultInitialization));const h=({value:e,sourceRange:t,targetRange:n})=>(e-t[0])*(n[1]-n[0])/(t[1]-t[0])+n[0],I=h({targetRange:zm[qm].range,sourceRange:m,value:p?r[0]-t:t}),g=h({targetRange:zm[qm].range,sourceRange:m,value:p?r[0]-n:n}),U=(e,t)=>1/(1+Math.pow(10,(t-e)/LR.nSpread)),y=U(I,g),v=U(g,I),S=LR.kCalc(a),w=LR.kCalc(o),P=LR.kMultiplier(c,u),T=I+P*S*(1-y),D=g+P*w*(0-v),R=h({sourceRange:zm[qm].range,value:T,targetRange:m}),b=h({sourceRange:zm[qm].range,value:D,targetRange:m}),N=p?r[0]-R:R;let M=parseFloat(parseFloat(N).toFixed(l));const A=p?r[0]-b:b;let E=parseFloat(parseFloat(A).toFixed(l));const C=Math.max(...r)?Math.abs(t-n)/Math.max(...r):0;return(R>b&&C>LR.diffThreshold||M<0||E<0)&&(M=t,E=n),{newWinnerRating:M,newLoserRating:E}}const VR={calculateNewRatings:BR,generateDynamicRatings:function({removePriorValues:e=!0,tournamentRecord:t,ratingType:n=qm,considerGames:r,matchUpIds:i,asDynamic:a}){if(!t)return{error:$};if(!Array.isArray(i))return{error:Ze};if("string"!=typeof n)return{error:xn,ratingType:n};if(!zm[n])return{error:xn};const o=zm[n],{accessor:s}=o,c={},u=rh({matchUpFilters:{matchUpIds:i,matchUpStatuses:Ca},tournamentRecord:t,inContext:!0}).matchUps??[];u.sort(Rh);for(const l of u){const{endDate:i,matchUpFormat:o,score:u,sides:p,winningSide:m}=l,f=l.matchUpType,h={eventType:f,scaleName:n,scaleType:Ss},I=`${n}.${ys}`,g={scaleName:I,eventType:f,scaleType:Ss},U=Object.assign({},...(p??[]).map((e=>{const{sideNumber:t,participant:n}=e;return t&&{[t]:[n?.participantId,...n?.individualParticipantIds??[]].filter(Boolean).flat()}}))),y=a?I:n,v=Object.assign({},...Object.values(U).flat().map((e=>{const{scaleItem:n}=uR({scaleAttributes:g,tournamentRecord:t,participantId:e}),{scaleItem:r}=uR({tournamentRecord:t,scaleAttributes:h,participantId:e});return e&&{[e]:n??r??{scaleName:y,eventType:f,scaleDate:i,scaleType:Ss,scaleValue:s?{[s]:void 0}:void 0}}}))),S=o?gi(o):{},w=S?.bestOf||1,P=r?w&(S?.setsTo||1):w,T=u?.sets&&(d=u.sets,d?.reduce(((e,t)=>(t.winningSide&&(e[t.winningSide-1]+=1),e)),[0,0])||[0,0])||1===m&&[1,0]||[0,1],D=m?U[m]:[],R=m?U[3-m]:[];for(const r of D){const i=v[r]?.scaleValue,a="object"==typeof i?i[s]:i;for(const o of R){const c=v[o]?.scaleValue,u="object"==typeof c?c[s]:c,d=m?T[m]:[0,0],p=m?T[3-m]:[0,0],{newWinnerRating:l,newLoserRating:f}=BR({winnerCountables:d,loserCountables:p,maxCountables:P,winnerRating:a,loserRating:u,ratingType:n}),h=s?{...i,[s]:l}:l,I=s?{...c,[s]:f}:f;v[r].scaleValue=h,v[o].scaleValue=I;let g=QT({participantId:r,removePriorValues:e,tournamentRecord:t,scaleItem:{...v[r],scaleName:y}});if(g.error)return g;if(g=QT({participantId:o,removePriorValues:e,tournamentRecord:t,scaleItem:{...v[o],scaleName:y}}),g.error)return g}}Object.assign(c,v)}var d;const p=u.map((({matchUpId:e})=>e));return{...L,modifiedScaleValues:c,processedMatchUpIds:p}}};(()=>{const e={getState:e=>CR({convertExtensions:e?.convertExtensions,removeExtensions:e?.removeExtensions,tournamentId:gr()}),setTournamentId:e=>wr(e)};function t(t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}return e.version=()=>"1.8.46",e.reset=()=>t(Pr(gr())),e.setState=(e,n,r)=>{cr(n,r);return t(ER(e,n))},[_R,VR].forEach((t=>{Object.keys(t).forEach((r=>{e[r]=e=>{if(ar())return n(t[r],e);try{return n(t[r],e)}catch(i){Dr({engineName:"scaleEngine",methodName:r,params:e,err:i})}}}))})),e;function n(t,n){const r=n?.sandBoxRecord||n?.sandboxRecord||n?.sandboxTournament||Ur(gr()),i=n?.rollbackOnError&&ii(r,!1,!0),a=function(t,n,r){return delete e.success,delete e.error,n({...OR(t,r),tournamentRecord:t})}(r,t,n);a?.error&&i&&ER(i);const o=a?.success&&!0!==n?.delayNotify&&!0!==n?.doNotNotify;return o&&gU(),(o||!a?.success||n?.doNotNotify)&&fr(),a}})();var jR={lastNames:["Abbey","Assange","Ahern","Ampleforth","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Bill","Bruce","Charles","Chris","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function GR(e){const{count:t=100,sex:n}=e||{};if(!t||n&&![Ei,Fi].includes(n))return{personData:[],error:xn};const r=Math.ceil(1.3*t),{lastNames:i,firstFemale:a,firstMale:o}=jR,s=Gm.map((({iso:e})=>e)).filter(Boolean),c=Math.ceil(r/i.length),u=Math.ceil(r/a.length),d=Math.ceil(r/o.length),p=E(0,c).flatMap((()=>{const e=ii(i,!1,!0);return E(0,i.length).map((()=>M(e)))})),l=E(0,u).flatMap((()=>{const e=ii(a,!1,!0);return E(0,a.length).map((()=>M(e)))})),m=E(0,d).flatMap((()=>{const e=ii(o,!1,!0);return E(0,o.length).map((()=>M(e)))})),f={};for(let h=0;h<r;h++){const e=p.pop(),t=n||A([Ei,Fi]),r=t===Ei?m.pop():l.pop(),i=A(s);f[`${r}${e}`]={nationalityCode:i,sex:t,firstName:r,lastName:e}}return{personData:Object.values(f).slice(0,t)}}function qR(e){let t=e?.count||1;const{personExtensions:n,consideredDate:r,isMock:i=!0,gendersCount:a,personData:o,category:s,sex:c}=e||{};if(isNaN(t))return{error:xn};const u=a?.[Ei]||c===Ei&&t||0,d=a?.[Fi]||c===Fi&&t||0;t=Math.max(t,u+d);const p=t-(u+d),l=[...u&&GR({count:u,sex:Ei}).personData||[],...d&&GR({count:d,sex:Fi}).personData||[],...p&&GR({count:p}).personData||[]];let f=l.filter((e=>!c||u&&d||e.sex===c));const h=[];if(Array.isArray(o)){const e=o.filter((e=>"string"==typeof e.firstName&&("string"==typeof e.lastName&&(!(e.sex&&![Ei,Fi].includes(e.sex))&&(!(e.nationalityCode&&("string"!=typeof e.nationalityCode||e.nationalityCode.length>3||!Gm.find((({iso:t,ioc:n})=>[t,n].includes(e.nationalityCode)))))&&(e.nationalityCode&&h.push(e.nationalityCode),!0))))));if(!e.length)return{error:xn};f=e}const I=o?f:T(f);if(I.length<t){const{maleFirstNames:e,maleLastNames:n,femaleFirstNames:r,femaleLastNames:i,nationalityCodes:a}=l.reduce(((e,t)=>{const{firstName:n,lastName:r,nationalityCode:i}=t;return t.sex===Ei?(e.maleFirstNames.includes(n)||e.maleFirstNames.push(n),e.maleLastNames.includes(r)||e.maleLastNames.push(r)):(e.femaleFirstNames.includes(n)||e.femaleFirstNames.push(n),e.femaleLastNames.includes(r)||e.femaleLastNames.push(r)),e.nationalityCodes.includes(i)||e.nationalityCodes.push(i),e}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});E(0,t-I.length).forEach((()=>{const t=c||A([Ei,Fi]),o=A(a),s={firstName:A(t===Ei?e:r),lastName:A(t===Ei?n:i),sex:t,nationalityCode:o};I.push(s)}))}const{ageMinDate:g,ageMaxDate:U}=ia({consideredDate:r,category:s}),y=m(g?.slice(0,4)||0)||m(U?.slice(0,4)||0)-3,v=m(U?.slice(0,4)||0)||m(g?.slice(0,4)||0)+3,S=(g||U)&&[y,v],w=I.slice(0,t).map(((e,t)=>{const[r,a]=S||[],o=S&&M(E(r,a)),s=M(E(0,365)),c=o&&function(e,t,n){const r=new Date(e,0);return kr(new Date(r.setDate(t)),n)}(o,s);return Object.assign(pi({extensions:n||[{name:"regionCode",value:t+1}],birthDate:c,isMock:i}),e)}));return{persons:w.length&&w||I[0],nationalityCodes:h}}function $R(e){const{cities:t,states:n,postalCodes:r,nationalityCode:i,participantIndex:a}=e;return{postalCode:r?.[a],state:n?.[a],city:t?.[a],countryCode:i}}var WR=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function HR({nameRoot:e="TEAM",count:t=1}={}){const n=T(WR).slice(0,t);return n.length<t&&E(0,t-n.length).forEach((t=>n.push(`${e} ${t+1}`))),{names:n}}var zR=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],YR=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function KR({count:e=1,participantsCount:t=32}={}){const n=T(YR),r=n.slice(0,e);return{cities:E(0,t).map((t=>t<Math.min(e,n.length)?r[t]:A(r)))}}function QR({count:e=1,participantsCount:t=32}={}){const n=T(zR),r=n.slice(0,e).map((e=>Object.keys(e))).flat();return{states:E(0,t).map((t=>t<Math.min(e,n.length)?r[t]:A(r)))}}function JR({count:e=1,participantsCount:t=32}={}){const n=E(0,e).map((()=>E(0,5).map((()=>v(0,9))).join("")));return{postalCodes:E(0,t).map((t=>t<e?n[t]:A(n)))}}function XR({matchUpStatusProfile:e,completeAllMatchUps:t,randomWinningSide:n,tournamentRecord:r,drawProfiles:i,event:a}){const o=Ks({event:a}).flightProfile,{eventName:s,eventType:c,category:u}=a,{startDate:d}=r,p=[],l=u?.categoryName||u?.ageCategoryCode||u?.ratingType,m=a.drawDefinitions?.map((({drawId:e})=>e));if(Array.isArray(o?.flights))for(const[f,h]of o.flights.entries()){const{drawId:o,stage:u,drawName:I,drawEntries:g}=h;p.push(h.drawId);const U=i[f],{seedsCount:y,generate:v=!0}=U||{};if(v){const p=g.filter(hl).map(Sl),h=l||s;if(r&&y&&y<=p.length){E(1,y+1).forEach(((e,t)=>{const n={scaleValue:e,scaleName:h,scaleType:Ps,eventType:c,scaleDate:d},i=p[t];QT({tournamentRecord:r,participantId:i,scaleItem:n})}))}if(m?.includes(o))break;let v=TR({...U,matchUpType:c,seedingScaleName:h,tournamentRecord:r,isMock:!0,drawEntries:g,drawName:I,drawId:o,event:a,stage:u});if(v.error)return{error:v.error,drawIds:[]};const{drawDefinition:S}=v;if(!S)return{error:Q};const w=i[f]?.drawExtensions;if(Array.isArray(w)&&w.filter(Ys).forEach((e=>Js({element:S,extension:e}))),v=Ly({suppressNotifications:!0,tournamentRecord:r,drawDefinition:S,event:a}),v.error)return{error:v.error,drawIds:[]};if(U?.withPlayoffs){const e=S.structures?.[0].structureId,t=rP({idPrefix:U.idPrefix,...U.withPlayoffs,tournamentRecord:r,drawDefinition:S,isMock:!0,structureId:e,event:a});if(t?.error)return t}const P=U?.completionGoal;if(!(!1===U?.automated)&&(t||P)){const i=U?.matchUpFormat,o=fD({completeAllMatchUps:!P&&t,matchUpStatusProfile:e,randomWinningSide:n,tournamentRecord:r,completionGoal:P,drawDefinition:S,matchUpFormat:i,event:a});if(o.error)return{error:o.error,drawIds:[]};const s=o.completedCount;if(U?.drawType===Hd){const o=S.structures?.find((e=>e.stage===nd));if(!o)return{error:De};let c=Hw({structureId:o.structureId,tournamentRecord:r,drawDefinition:S,event:a});if(c.error)return{error:c.error,drawIds:[]};if(c=fD({completeAllMatchUps:!P&&t,completionGoal:P?P?P-(s??0):void 0:void 0,matchUpStatusProfile:e,randomWinningSide:n,tournamentRecord:r,drawDefinition:S,matchUpFormat:i,event:a}),c.error)return{error:c.error,drawIds:[]}}}}}return{...L,drawIds:p}}function ZR(e){let{rankingRange:t,scaledParticipantsCount:n}=e;const{ratingsParameters:r=zm,valuesInstanceLimit:i,consideredDate:a,category:o,nationalityCodesCount:s,nationalityCodeType:c,nationalityCodes:u,participantsCount:d=32,participantType:p,personIds:l,idPrefix:m,uuids:f,personExtensions:h,addressProps:I,gendersCount:g,matchUpType:y,personData:S,sex:P,inContext:D,withISO2:R,withIOC:b,scaleAllParticipants:N}=e,M=p===Wu||y===Li,A=p===Hu||y===Hu;!t||Array.isArray(t)&&t.every((e=>U(e)))&&2===t.length||(t=void 0),n=N?d:n;t=t||[1,n&&n>1e3?n:1e3],t[1]+=1;const C=d*(M?2:A?8:1),O=qR({count:C,personExtensions:h,consideredDate:a,gendersCount:g,personData:S,category:o,sex:P});if(O.error)return O;const{nationalityCodes:F,persons:k}=O;let x=[],_=[],L=[],B=[];if("object"==typeof o){const{categoryName:e,ageCategoryCode:i,ratingType:a}=o;if((e||i)&&!a){const[e,r]=t||[];if(_=T(E(e,r)).slice(0,n||v(20,30)),[Wu,Hu].includes(p)){const[e,r]=t||[];x=T(E(e,r)).slice(0,n||v(20,30))}}if(a&&r[a]){const{ratingMax:e,ratingMin:t,ratingAttributes:i}=o,s={...r[a],...i||{}},{attributes:c={},decimalsCount:u,accessors:d,range:l,step:m}=s,f=e=>{const t={};for(const n of Object.keys(e)||{}){const r=e[n];if("object"==typeof r&&r.generator){const{range:e}=r,[i,a]=e.slice().sort();t[n]=v(i,a)}else t[n]=r}return t},h=l[0]>l[1]?2:.5,[I,g]=l.slice().sort(),U=()=>E(0,2e3).map((()=>w(I,g,h,m,u))).filter((n=>(!e||n<=e)&&(!t||n>=t))).slice(0,n||v(20,30)).map((e=>d?Object.assign({},...d.map((t=>({[t]:e}))),f(c)):e));L=U(),[Wu,Hu].includes(p)&&(B=U())}}const V=Gm.filter((e=>"IOC"===c&&e.ioc||e.iso));const{postalCodesProfile:j,postalCodesCount:G,statesProfile:q,citiesProfile:$,citiesCount:W,statesCount:H}=I||{},z=e=>Object.keys(e).map((e=>E(0,q[e]).map((()=>e)))).flat(),Y={cities:$&&z($)||I?.cities||KR({count:W||C,participantsCount:C}).cities,states:q&&z(q)||I?.states||QR({count:H||C,participantsCount:C}).states,postalCodes:j&&z(j)||I?.postalCodes||JR({count:G||C,participantsCount:C}).postalCodes},K=function(e){const t=Math.ceil(C/e);return i&&t>i?Math.ceil(C/i):e}(s),Q=K?T(V).slice(0,s):u?V.filter((e=>u.includes(e.iso))):V,J=T(E(0,Math.ceil(C/(K||1))).map((()=>Q)).flat(1/0)),X=HR({count:d}).names;return{participants:E(0,d).map((e=>{const t=M?2:A?8:1,n=E(0,t).map((n=>function(e){const t=k[e],{nationalityCode:n,participantExtensions:r,participantTimeItems:i,extensions:a,firstName:s,birthDate:u,lastName:d,personId:p,sex:h}=t||{},I=s||"GivenName",g=d||"FamilyName",U=`${I} ${g}`,y=J[e],v=F?.length&&n||y&&("IOC"===c?y.ioc||y.iso:y.iso||y.ioc)||n;!J?.length||v||n||console.log("%c Invalid Nationality Code",{participantIndex:e,country:y});const S=$R({...Y,participantIndex:e,nationalityCode:v}),w=pi({participantId:tb({participantType:qu,index:e,idPrefix:m,uuids:f}),extensions:r,timeItems:i,participantRole:jT,participantType:qu,participantName:U,person:{addresses:[S],personId:p||l?.length&&l[e]||Ii(),standardFamilyName:g,standardGivenName:I,nationalityCode:v,extensions:a,birthDate:Or(u)?u:void 0,sex:h}});if(b&&v){const e=Gm.find((({iso:e})=>e===v));e?.ioc&&(w.person.iocNationalityCode=e.ioc),e?.label&&(w.person.countryName=e.label)}if(R&&v){const e=Gm.find((({iso:e})=>e===v));e?.iso2&&(w.person.iso2NationalityCode=e.iso2),e?.label&&(w.person.countryName=e.label)}if(o){const t=_[e],n=x[e];eb({scaleValue:t,eventType:Fu,scaleType:vs,participant:w,category:o}),eb({scaleValue:n,eventType:xu,scaleType:vs,participant:w,category:o});const r=L[e],i=B[e];eb({scaleValue:r,eventType:Fu,scaleType:Ss,participant:w,category:o}),eb({scaleValue:i,eventType:xu,scaleType:Ss,participant:w,category:o})}return w}(e*t+n))),r=n.map((e=>e.participantId)),i=n.map((e=>e.person.standardFamilyName)).join("/"),a=M?Wu:Hu,s={participantId:tb({participantType:a,idPrefix:m,index:e,uuids:f}),participantRole:jT,participantName:M?i:X[e],individualParticipantIds:r,participantType:a};return D&&(s.individualParticipants=n),M||A?[s,...n]:n})).flat()}}function eb({scaleValue:e,participant:t,eventType:n,scaleType:r,category:i}){const a=i.categoryName||i.ratingType||i.ageCategoryCode,o={itemValue:e,itemType:[ws,r,n,a].join(".")};a&&e&&(t.timeItems||(t.timeItems=[]),t.timeItems.push(o))}function tb({idPrefix:e,participantType:t,index:n,uuids:r}){return e?`${e}-${t===qu?"I":Wu?"P":Hu?"T":$u?"G":"X"}-${n}`:r?.pop()||Ii()}function nb({alternatesCount:e=0,tieFormatName:t,tieFormat:n,drawSize:r}){let i=0,a=0,o=0,s=0;const c={},u={[Ei]:0,[Fi]:0,[Ci]:0,[Oi]:0,[Ai]:0};n="object"==typeof n?n:nR({namedFormat:t}),n?.collectionDefinitions?.filter(Boolean).forEach((e=>{const{category:t,collectionId:n,matchUpType:r,matchUpCount:d,gender:p}=e;if([Ei,Fi].includes(p)){const e=d*(r===Bi?2:1);u[p]<e&&(u[p]=e)}else p===Ci&&(u[Ei]<d&&(u[Ei]=d),u[Fi]<d&&(u[Fi]=d));if(t){const e=JSON.stringify(t);c[e]=t}if(n||(e.collectionId=Ii()),r===Bi){const e=d;s+=d,i=Math.max(i,e)}if(r===_i){const e=d;o+=d,a=Math.max(a,e)}}));const d=Object.keys(c).length?Math.max(o,2*s):Math.max(a,2*i);return{maxDoublesDraw:i*(r+e),maxSinglesDraw:a*(r+e),teamSize:d,genders:u}}function rb({participantsProfile:e,tournamentRecord:t,eventProfiles:n,drawProfiles:r,startDate:i,uuids:a}){const{participantsCount:o,participantType:s,largestTeamDraw:c,largestTeamSize:u,gendersCount:d}=function({participantsProfile:e,eventProfiles:t,drawProfiles:n}){let{participantsCount:r,participantType:i=qu}=e||{};const a=r||0,o={[Fi]:0,[Ci]:0,[Oi]:0,[Ei]:0,[Ai]:0};let s=0,c=0,u=0,d=0,p=0;const l=({alternatesCount:e=0,uniqueParticipants:t,tieFormatName:n,drawSize:r=0,eventType:i,tieFormat:a,category:l,gender:m,stage:f})=>{const h=i===ku,I=i===_u,g=Boolean(t||f===rd||l||m);if(I){d=Math.max(d,r+e),a="object"==typeof a?a:nR({namedFormat:n});const{teamSize:t,maxDoublesDraw:i,maxSinglesDraw:p,genders:l}=nb({alternatesCount:e,tieFormatName:n,tieFormat:a,drawSize:r});u=Math.max(u,t),c=Math.max(c,p),g||(s=Math.max(s,i)),Object.keys(l).forEach((e=>o[e]+=l[e]))}else if(h)if(g){const t=2*(r+e);p+=t,m&&(o[m]+=t)}else r+e&&r+e>s&&(s=r+e);else if(g){const t=r+e;m&&(o[m]+=t),p+=t}else r&&r>c&&(c=r+e)};if(t?.forEach((e=>{const{tieFormatName:t,tieFormat:n,drawProfiles:r,eventType:i,category:a,gender:o}=e;if(r)for(const s of r){const{tieFormatName:e,tieFormat:r}=s;l({...s,tieFormatName:e||t,tieFormat:r||n,eventType:i,category:a,gender:o})}})),Array.isArray(n))for(const f of n)l(f);const m=Math.max(d*u,2*s,c);return s&&(i=Wu),(r||a)<m&&(r=m),r&&s&&[Wu,_u].includes(i)&&(c&&Math.floor(c/2)>s?r=Math.floor(c/2):(!c||2*s>=c)&&(r=Math.ceil(r/2))),void 0===r&&(r=t?.length||n?.length?0:32),r<a&&(r=a),{uniqueParticipantsCount:p,participantsCount:r,largestTeamDraw:d,largestTeamSize:u,participantType:i,gendersCount:o}}({participantsProfile:e,eventProfiles:n,drawProfiles:r}),p=e?.teamKey,l=ZR({uuids:a,...e,consideredDate:i,participantsCount:o,participantType:s,gendersCount:d}).participants;let m=0,f=Vy({tournamentRecord:t,participants:l});if(f.error)return f;if(m+=f.addedCount,p){const e=WT({tournamentRecord:t,...p});if(e.error)return e}const h=l.filter((({participantType:e})=>e===qu)).map(Sl);return f=Vy({participants:E(0,c).map((e=>{const t=h.slice(e*u,(e+1)*u);return{participantName:`Team ${e+1}`,participantRole:jT,participantType:Hu,participantId:Ii(),individualParticipantIds:t}})),tournamentRecord:t}),f.error?f:(m+=f.addedCount,{addedCount:m,...L})}function ib(e){const{participantsProfile:t={},uniqueParticipantsCount:n,ratingsParameters:r,tournamentRecord:i,eventProfile:a,eventIndex:o,event:s,uuids:c}=e,{category:u,gender:d,eventType:p}=s,l=p===Ou&&qu||p===ku&&Wu||p,m=n[nd]||0,f=n[rd]||0,h=a.drawProfiles?.length?m+f:a.participantsProfile?.participantsCount??0,I=[Ei,Fi].includes(d)?d:void 0,g=t?.idPrefix?`E-${o}-${t?.idPrefix}`:void 0,{participants:U}=ZR({uuids:a.uuids||c,...t,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:i?.startDate,rankingRange:a.rankingRange,participantType:l,participantsCount:h,ratingsParameters:r,category:u,idPrefix:g,sex:I}),y=Vy({tournamentRecord:i,participants:U});if(y.error)return y;const v=U?.filter((({participantType:e})=>e===l)),S=U?.map(Sl);return{uniqueDrawParticipants:v,uniqueParticipantIds:S}}function ab({drawProfiles:e,category:t,gender:n}){const r={},i=e?.reduce(((e,i)=>{const{qualifyingPositions:a=0,participantsCount:o=0,uniqueParticipants:s,stage:c=nd,drawSize:u=0}=i||{};Object.keys(e).includes(c)||(e[c]=0);const d=(o||u)-a;return s||n||t||c===rd?(Object.keys(r).includes(c)||(r[c]=0),r[c]+=d):e[c]=Math.max(e[c],d),e}),{}),a=Object.keys(r);return a.forEach((e=>i[e]+=r[e])),{stageParticipantsCount:i,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function ob({allUniqueParticipantIds:e,stageParticipantsCount:t,eventParticipantType:n,targetParticipants:r}){const i=t[nd]||0,a=t[rd]||0;return{stageParticipants:{QUALIFYING:r.filter((({participantType:e})=>e===n)).filter((({participantId:t})=>!e.includes(t))).slice(0,a),MAIN:r.filter((({participantType:e})=>e===n)).filter((({participantId:t})=>!e.includes(t))).slice(a,a+i)}}}function sb({autoEntryPositions:e,tournamentRecord:t,drawParticipants:n,drawProfile:r,event:i}){const{drawType:a=Md,qualifyingPositions:o=0,stage:s=nd,drawSize:c=0,drawName:u,drawId:d}=r,p=c-o,l=n.slice(0,p).map(Sl);if(l.length){const n=bP({participantIds:l,autoEntryPositions:e,entryStage:s,tournamentRecord:t,event:i});if(n.error)return n}const m=UR({drawName:u||a,qualifyingPositions:o,drawEntries:l.map((e=>({entryStatus:lp,entryStage:s,participantId:e}))),drawId:d,event:i,stage:s});return m.error?m:{...L}}function cb({uniqueDrawParticipants:e,autoEntryPositions:t,stageParticipants:n,tournamentRecord:r,drawProfiles:i,category:a,gender:o,event:s}){let c=0;for(const u of i){const{qualifyingPositions:i=0,uniqueParticipants:d,stage:p=nd,drawSize:l=0}=u,m=l-i,f=d||o||a||p===rd,h=f?e.slice(c,c+m):n[p||nd]||[];f&&(c+=m);const I=sb({autoEntryPositions:t,drawParticipants:h,tournamentRecord:r,drawProfile:u,event:s});if(I.error)return I}return{...L}}function ub(e){const{allUniqueParticipantIds:t,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:i,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,publish:l,uuids:m}=e;let f=d.gender,h=d.eventName;const{eventType:I=Ou,policyDefinitions:g,drawProfiles:U=[],eventExtensions:y,surfaceCategory:v,tieFormatName:S,processCodes:w,discipline:P,eventLevel:T,timeItems:D,ballType:R,category:b}=d,N=d.eventId||Ii(),M=d.tieFormat||(I===_u?nR({namedFormat:S,event:{eventId:N,category:b,gender:f},hydrateCollections:o}):void 0),A=u.participants;for(const $ of U)!f&&$.gender&&(f=$?.gender);const{stageParticipantsCount:E,uniqueParticipantsCount:C,uniqueParticipantStages:O}=ab({drawProfiles:U,category:b,gender:f}),F=I===Ou&&qu||I===ku&&Wu||I,{uniqueDrawParticipants:k=[],uniqueParticipantIds:x=[]}=O?ib({event:{eventType:I,category:b,gender:f},uniqueParticipantsCount:C,participantsProfile:r,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,uuids:m}):{};let{eventAttributes:_}=d;"object"!=typeof _&&(_={});const L=b?.categoryName||b?.ageCategoryCode||b?.ratingType;h=h||L||"Generated Event";const B={..._,surfaceCategory:v,processCodes:w,discipline:P,eventLevel:T,eventName:h,eventType:I,tieFormat:M,ballType:R,category:b,eventId:N,gender:f};if(y?.length&&Array.isArray(y)){const e=y.filter(Ys);e?.length&&Object.assign(B,{extensions:e})}if(Array.isArray(D)&&D.forEach((e=>PU({event:G,timeItem:e}))),"object"==typeof g)for(const $ of Object.keys(g))yS({policyDefinitions:{[$]:g[$]},event:B});let V;B.category&&(B.category.categoryName=L);const j=rR({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:B});if(j.error)return j;const G=j?.event,{stageParticipants:q}=ob({allUniqueParticipantIds:t,stageParticipantsCount:E,eventParticipantType:F,targetParticipants:A});if(U?.length){const e=cb({uniqueDrawParticipants:k,autoEntryPositions:a,stageParticipants:q,tournamentRecord:u,drawProfiles:U,category:b,gender:f,event:G});if(e.error)return e;const t=XR({matchUpStatusProfile:n,completeAllMatchUps:i,randomWinningSide:s,tournamentRecord:u,drawProfiles:U,event:G});if(t.error)return t;V=t.drawIds}else if(d?.participantsProfile?.participantsCount){const e=k.map(di("participantId"));if(e.length){const t=bP({participantIds:e,entryStage:$i.Main,autoEntryPositions:a,tournamentRecord:u,event:G});if(t.error)return t}}return l&&eD({tournamentRecord:u,event:G}),{drawIds:V,eventId:N,uniqueParticipantIds:x}}function db(e){const{allUniqueParticipantIds:t=[],participantsProfile:n={},matchUpStatusProfile:r,completeAllMatchUps:i,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:l,drawIndex:m,uuids:f}=e,h=ii(p,!1,!0),{excessParticipantAlternates:g=!0,matchUpFormat:U=Ba,drawType:y=Md,tournamentAlternates:v=0,alternatesCount:S=0,qualifyingPositions:w,qualifyingProfiles:P,generate:T=!0,eventExtensions:D,drawExtensions:R,completionGoal:b,tieFormatName:N,seedsCount:M,timeItems:A,drawName:C,category:F,idPrefix:k,publish:x,gender:_,stage:B}=h,V=h.drawSize||(h.ignoreDefaults?void 0:32),j=h.eventId||Ii(),G=p.eventType||p.matchUpType||Ou,q=G===ku?Wu:qu,$="object"==typeof p.tieFormat&&p.tieFormat||G===Hu&&nR({namedFormat:N,event:{eventId:j,category:F,gender:_},hydrateCollections:o})||void 0,W=F?.categoryName||F?.ageCategoryCode||F?.ratingType,H=p.eventName||W||`Generated ${G}`;let z=u?.participants||[];const Y=(P?.map((e=>e.structureProfiles||[])).flat().reduce(((e,t)=>e+(!t.participantsCount||t.participantsCount>t.drawSize?t.drawSize:t.participantsCount||0)),0)||0)*(q===Wu?2:1),K=(!p.participantsCount||p.participantsCount>V?V:p.participantsCount)||0,J={eventName:H,eventType:G,tieFormat:$,category:F,eventId:j,gender:_};Array.isArray(A)&&A.forEach((e=>PU({event:J,timeItem:e})));let{eventAttributes:X}=p;if("object"!=typeof X&&(X={}),Object.assign(J,X),D?.length&&Array.isArray(D)){const e=D.filter(Ys);e?.length&&Object.assign(J,{extensions:e})}const Z=[];if(Y||p.uniqueParticipants||!u||_||F){const e=(K||0)+S+Y;let t=e;const r={[Ei]:0,[Fi]:0};let i,a;G===Hu&&(({teamSize:i,genders:a}=nb({alternatesCount:S,tieFormatName:N,tieFormat:$,drawSize:V})),Object.keys(a).forEach((e=>{[Ei,Fi].includes(e)&&a[e]&&(r[e]=V*a[e])})),t=i*((V||0)+Y));const o=n?.idPrefix?`D-${m}-${n?.idPrefix}`:void 0,s=ZR({...n,scaledParticipantsCount:p.scaledParticipantsCount||n.scaledParticipantsCount,participantsCount:t,consideredDate:u?.startDate,sex:_||n?.sex,rankingRange:p.rankingRange,uuids:p.uuids||f,ratingsParameters:c,participantType:q,gendersCount:r,idPrefix:o,category:F}).participants;if(J.category&&(J.category.categoryName=W),u){const e=Vy({participants:s,tournamentRecord:u});if(e.error)return e}if(s.forEach((({participantId:e})=>Z.push(e))),z=s,G===Hu){const t=a[Ei]?s.filter((({participantType:e,person:t})=>e===qu&&t?.sex===Ei)).map(Sl):[],n=a[Fi]?s.filter((({participantType:e,person:t})=>e===qu&&t?.sex===Fi)).map(Sl):[],r=s.filter((({participantType:e})=>e===qu)).map(Sl).filter((e=>!t.includes(e)&&!n.includes(e))),o=i-(a[Ei]+a[Fi]);let c=0,d=0,p=0;const l=E(0,e).map((e=>{const i=n.slice(c,c+a[Fi]),s=t.slice(d,d+a[Ei]),u=r.slice(p,p+o);return c+=a[Fi],d+=a[Ei],p+=o,{individualParticipantIds:[...i,...s,...u],participantOtherName:`TM${e+1}`,participantName:`Team ${e+1}`,participantRole:jT,participantType:Hu,participantId:Ii()}})),m=Vy({participants:l,tournamentRecord:u});if(!m.success)return m;z=l}}const ee=e=>{const{participantType:t}=e;return G===Ou&&t===qu||(G===ku&&t===Wu||G===Hu&&t===Hu)},te=e=>!p.gender||(e.person?.sex===p.gender||e.individualParticipantIds?.some((e=>{const t=z.find((t=>t.participantId===e));return t&&te(t)}))),ne=z.filter(ee).filter(te).filter((({participantId:e})=>!t.includes(e))),re=ne.slice(0,K).map((e=>e.participantId));if(d&&re?.length){const e=bP({autoEntryPositions:a,entryStage:B,tournamentRecord:u,participantIds:re,event:J});if(e.error)return e}const ie=Y?ne.slice(K,K+Y).map((e=>e.participantId)):0;if(d&&ie?.length){let e=0,t=1;const n=(e,t)=>e.stageSequence-t.stageSequence,r=(e,t)=>e.roundTarget-t.roundTarget;for(const i of P.sort(r)){t=i.roundTarget||t;let r,o=1;for(const s of i.structureProfiles.sort(n)){const n=(s.drawSize||I(s.participantsCount))-(r||0),i=ie.slice(e,e+n),c=bP({entryStage:$i.Qualifying,entryStageSequence:o,autoEntryPositions:a,tournamentRecord:u,participantIds:i,roundTarget:t,event:J});if(c.error)return c;r=s.qualifyingPositions,e+=n,o+=1}t+=1}}const ae=g&&u?.participants?.filter((({participantId:e})=>!re.includes(e))).filter(ee).filter(te).slice(0,S||V-K||v).map((e=>e.participantId));if(d&&ae?.length){const e=bP({participantIds:ae,autoEntryPositions:!1,entryStatus:dp,tournamentRecord:u,event:J});if(e.error)return e.error}const oe=W||H;if(u&&M&&M<=re.length){E(1,M+1).forEach(((e,t)=>{const n={scaleName:oe,scaleDate:l,scaleType:gu,scaleValue:e,eventType:G},r=re[t];QT({tournamentRecord:u,participantId:r,scaleItem:n})}))}const se=TR({...ii(p,!1,!0),tournamentRecord:u,seedingScaleName:oe,matchUpFormat:U,eventId:j,isMock:d,event:J});if(se.error)return se;if(!se.drawDefinition)return{error:Q};const{drawDefinition:ce}=se,ue=ce.drawId;if(Array.isArray(R)&&R.filter(Ys).forEach((e=>Js({element:ce,extension:e}))),T){if(Ly({drawDefinition:ce,event:J,suppressNotifications:!0}),p.withPlayoffs){const e=ce.structures?.[0].structureId,t=rP({...p.withPlayoffs,tournamentRecord:u,drawDefinition:ce,structureId:e,idPrefix:k,isMock:d,event:J});if(t?.error)return t}const e=!1===p.automated;if(d&&!e){const e=e=>{const t=fD({completeAllMatchUps:e.completeAllMatchUps,completionGoal:e.completionGoal,matchUpStatusProfile:r,randomWinningSide:s,tournamentRecord:u,drawDefinition:ce,matchUpFormat:U,event:J});if(t.error)return t;const n=t.completedCount;if(y===Hd){const e=ce.structures?.find((e=>e.stage===nd));if(!e)return{error:De};Hw({structureId:e.structureId,tournamentRecord:u,drawDefinition:ce,event:J});const t=fD({completionGoal:b?b?b-(n??0):void 0:void 0,matchUpStatusProfile:r,completeAllMatchUps:i,randomWinningSide:s,tournamentRecord:u,drawDefinition:ce,matchUpFormat:U,event:J});if(t.error)return t}};if(b&&e({completionGoal:b}),p.outcomes){const{matchUps:e}=ih({inContext:!0,drawDefinition:ce,event:J});for(const t of p.outcomes){const{matchUpStatus:n=ha,matchUpStatusCodes:r,stageSequence:i=1,matchUpIndex:a=0,structureOrder:o,matchUpFormat:s,drawPositions:c,roundPosition:d,stage:p=nd,roundNumber:l,winningSide:m,scoreString:f}=t,h=e?.reduce(((e,t)=>{const{structureId:n,matchUpId:r}=t;return e[n]?e[n].push(r):e[n]=[r],e}),{})??[],I=Object.assign({},...Object.keys(h).map(((e,t)=>({[e]:t+1})))),g=e?.filter((e=>!(p&&e.stage!==p||i&&e.stageSequence!==i||l&&e.roundNumber!==l||d&&e.roundPosition!==d||o&&I[e.structureId]!==o||c&&2!==O(c,e.drawPositions).length))),U=g?.[a],y=hD({matchUpStatusCodes:r,tournamentRecord:u,drawDefinition:ce,targetMatchUp:U,matchUpFormat:s,matchUpStatus:n,scoreString:f,winningSide:m});if(y?.error)return y}}i&&e({completeAllMatchUps:i})}x&&eD({tournamentRecord:u,event:J})}else{const e=UR({drawEntries:ce.entries,drawName:C||y,qualifyingPositions:w,drawId:ue,event:J,stage:B});if(e.error)return e}return{...L,event:pi(J),uniqueParticipantIds:Z,targetParticipants:z,drawDefinition:ce,eventId:j,drawId:ue}}function pb({tournamentRecord:e,venueProfiles:t,uuids:n}){const{startDate:r,endDate:i}=e,a=[];for(const[o,s]of t.entries()){const{venueAbbreviation:t,venueId:c=n?.pop()??Ii(),dateAvailability:u,startTime:d="07:00",endTime:p="19:00",courtTimings:l,courtsCount:m,courtNames:f,venueName:h,idPrefix:I,courtIds:g}=s,U=Gc({tournamentRecord:e,venue:{venueName:h||`Venue ${o+1}`,venueAbbreviation:t,venueId:c}});if(U.error)return U;a.push(c);const y=Lr(r,i),v=!Array.isArray(u)&&[{startTime:d,endTime:p}].concat(y.map((e=>({date:kr(e),startTime:d,endTime:p})))),S=qS({dateAvailability:u||v,tournamentRecord:e,courtTimings:l,courtsCount:m,courtNames:f,startTime:d,idPrefix:I,courtIds:g,endTime:p,venueId:c,dates:y});if(S.error)return S}return a}const lb={anonymizeTournamentRecord:function({keepExtensions:e=[],anonymizeParticipantNames:t=!0,tournamentRecord:n,tournamentName:r,personIds:i=[],tournamentId:a}){if(!n)return{error:$};const o=Array.isArray(e)?Jo.concat(...e):Jo,s=t=>Array.isArray(e)?t?.extensions?.filter((e=>o.includes(e.name))):t?.extensions,c={};n.extensions=s(n);const u=a||Ii();c[n.tournamentId]=u,n.tournamentId=u,n.createdAt=(new Date).toISOString(),n.tournamentName=r||`Anonymized: ${kr(new Date)}`,delete n.parentOrganisation;for(const C of n.participants||[]){const e=Ii();c[C.participantId]=e,C.participantId=e}for(const C of n.participants||[])Array.isArray(C.individualParticipantIds)&&(C.individualParticipantIds=C.individualParticipantIds.map((e=>c[e])));let d=0;for(const C of n.venues||[]){C.extensions=s(C),C.venueName=`Venue #${d}`,C.venueAbbreviation=`V${d}`;const e=Ii();c[C.venueId]=e,d+=1}let p=1;for(const C of n.events||[]){C.extensions=s(C);const e=Ii();c[C.eventId]=e,C.eventId=e;const t=C.category?.categoryName||C.category?.ageCategoryCode||C.category?.ratingType||C.gender;if(C.eventName=`Event ${p} ${t}`,Array.isArray(C.entries))for(const r of C.entries)r.participantId=c[r.participantId];for(const r of C.drawDefinitions||[]){r.extensions=s(r);const e=Ii();if(c[r.drawId]=e,r.drawId=e,Array.isArray(r.entries))for(const n of r.entries)n.participantId=c[n.participantId];const t=e=>{e.extensions=s(e);const t=Ii();c[e.structureId]=t,e.structureId=t;for(const n of e.positionAssignments||[])n.participantId&&(n.participantId=c[n.participantId]);for(const n of e.seedAssignments||[])n.participantId&&(n.participantId=c[n.participantId]);for(const n of e.matchUps||[])for(const e of n.sides||[])e.lineUp&&(e.lineUp=e.lineUp.map((({participantId:e,collectionAssignments:t})=>({participantId:c[e],collectionAssignments:t}))))};for(const n of r.structures||[])if(t(n),Array.isArray(n.structures))for(const e of n.structures)t(e);for(const n of r.links||[])n.source.structureId=c[n.source.structureId],n.target.structureId=c[n.target.structureId]}const{extension:n}=Es({name:ko,event:C});Array.isArray(n?.value?.flights)&&n?.value.flights?.forEach((e=>{if(e.drawId=c[e.drawId],Array.isArray(e.drawEntries))for(const t of e.drawEntries)t.participantId=c[t.participantId]})),p+=1}const l=n.startDate||kr(new Date),m=(n.participants||[]).filter((({participantType:e})=>e===qu)),f=m.reduce(((e,t)=>{const n=t.person?.sex;return[Ei,Fi].includes(n)?e[n]+=1:e[Oi]+=1,e}),{[Ei]:0,[Fi]:0,[Oi]:0}),h=Object.assign({},...Object.keys(f).map((e=>({[e]:qR({category:{ageCategoryCode:"O18"},count:f[e],addressProps:{citiesCount:10},personExtensions:[],consideredDate:l,sex:e})?.persons||[]})))),I={[Ei]:0,[Fi]:0,[Oi]:0},g=m.length,U=m.reduce(((e,t)=>{const n=t.person?.addresses?.[0]||{},{city:r,state:i,postalCode:a}=n;return e.cities.includes(r)||e.cities.push(r),e.states.includes(i)||e.states.push(i),e.postalCodes.includes(a)||e.postalCodes.push(a),e}),{cities:[],postalCodes:[],states:[]}),y=U.postalCodes.length,v=U.cities.length,S=U.states.length,{cities:w}=KR({count:v||g,participantsCount:g}),{states:P}=QR({count:S||g,participantsCount:g}),{postalCodes:T}=JR({count:y||g,participantsCount:g}),D={cities:w,states:P,postalCodes:T};m.forEach(((e,n)=>{const r=e?.person,a=r?.sex||Oi,o=Wr(r?.birthDate)?.split("-")[0],u=I[a],d=h[a][u];if(I[a]+=1,o){const[,e,t]=d?.birthDate?.split("-")||[],n=[o,e,t].join("-");d.birthDate=n}if(r?.addresses){const e=$R({...D,participantIndex:n,nationalityCode:d.nationalityCode});d.addresses=[e]}d.personId=i?.[n]||Ii(),t?(d.standardFamilyName=d.lastName,d.standardGivenName=d.firstName,e.participantName=`${d.standardGivenName} ${d.standardFamilyName}`):(d.standardFamilyName=r?.standardFamilyName,d.standardGivenName=r?.standardGivenName),delete d.firstName,delete d.lastName,d.extensions=s(r),e.person=d,c[r?.personId]=d.personId})),(n.participants||[]).filter((({participantType:e})=>e===Wu)).forEach((e=>{const{individualParticipantIds:t}=e;e.participantName=function({individualParticipantIds:e,individualParticipants:t}){let n=t.filter((({participantId:t})=>e.includes(t))).map((({person:e})=>e?.standardFamilyName)).filter(Boolean).sort().join("/");1===e.length&&(n+="/Unknown");return n}({individualParticipantIds:t,individualParticipants:m})}));const R=(n.participants||[]).filter((({participantType:e})=>e===Hu)),b=HR({count:R.length}).names;R.forEach(((e,t)=>{e.participantName=b[t]}));const N=(n.participants||[]).filter((({participantType:e})=>e===$u)),M=HR({count:N.length,nameRoot:"Group"}).names;N.forEach(((e,t)=>{e.participantName=M[t]}));const{extension:A}=As({name:Ho,tournamentRecord:n});Array.isArray(A?.value)&&A?.value.forEach((e=>{e.tournamentId=c[e.tournamentId],e.structureId=c[e.structureId],e.eventId=c[e.eventId],e.drawId=c[e.drawId]}));const{extension:E}=As({name:jo,tournamentRecord:n});return Array.isArray(E?.value)&&E?.value.forEach((e=>{e.personId=c[e.personId]})),{...L}},modifyTournamentRecord:function(e){const{ratingsParameters:t=zm,participantsProfile:n={},matchUpStatusProfile:r,completeAllMatchUps:i,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:c,tournamentRecord:u,eventProfiles:d,periodLength:p,venueProfiles:l,autoSchedule:m,drawProfiles:f,uuids:h}=e;if(!u)return{error:$};const I=[],g=[],U=[];d?.forEach((e=>{const t=u.events?.find(((t,n)=>void 0!==e.eventIndex&&n===e.eventIndex||e.eventName&&t.eventName===e.eventName||e.eventId&&t.eventId===e.eventId));t?.gender&&(e.gender=t.gender)}));const y=u.participants?.length||void 0;y&&n?.idPrefix&&(n.idPrefix=`${n.idPrefix}-${y}`);const v=rb({startDate:u.startDate,participantsProfile:n,tournamentRecord:u,eventProfiles:d,drawProfiles:f,uuids:h});if(!v.success)return v;if(d){let e=u.events?.length||0;for(const t of d){const{ratingsParameters:o}=t,c=u.events?.find(((e,n)=>void 0!==t.eventIndex&&n===t.eventIndex||t.eventName&&e.eventName===t.eventName||t.eventId&&e.eventId===t.eventId));if(c){const{gender:e,category:d,eventType:p}=c,{drawProfiles:l,publish:m}=t,f=p===Ou&&qu||p===ku&&Wu||p;if(l){const{stageParticipantsCount:m,uniqueParticipantsCount:g,uniqueParticipantStages:y}=ab({drawProfiles:l,category:d,gender:e}),{uniqueDrawParticipants:v=[],uniqueParticipantIds:S=[]}=y?ib({event:{eventType:p,category:d,gender:e},uniqueParticipantsCount:g,participantsProfile:n,ratingsParameters:o,tournamentRecord:u,eventProfile:t,uuids:h}):{};I.push(...S);const{stageParticipants:w}=ob({targetParticipants:u.participants||[],allUniqueParticipantIds:I,stageParticipantsCount:m,eventParticipantType:f});let P=cb({uniqueDrawParticipants:v,autoEntryPositions:a,stageParticipants:w,tournamentRecord:u,drawProfiles:l,category:d,gender:e,event:c});if(P.error)return P;if(P=XR({matchUpStatusProfile:r,completeAllMatchUps:i,randomWinningSide:s,tournamentRecord:u,drawProfiles:l,event:c}),P.error)return P;U.push(...P.drawIds)}m&&eD({tournamentRecord:u,event:c})}else{const c=ub({startDate:u.startDate,allUniqueParticipantIds:I,matchUpStatusProfile:r,participantsProfile:n,completeAllMatchUps:i,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:o,tournamentRecord:u,eventProfile:t,eventIndex:e,uuids:h});if(c.error)return c;const{eventId:d,drawIds:p,uniqueParticipantIds:l}=c;p&&U.push(...p),g.push(d),l?.length&&I.push(...l),e+=1}}}if(f){let e=(u.events||[]).map((e=>e.drawDefinitions?.map((()=>1))||[])).flat().reduce(((e,t)=>e+t),0);for(const c of f){let d=db({startDate:u.startDate,allUniqueParticipantIds:I,matchUpStatusProfile:r,participantsProfile:n,completeAllMatchUps:i,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:t,tournamentRecord:u,drawProfile:c,drawIndex:e,uuids:h});if(d.error)return d;const{drawId:p,eventId:l,event:m,uniqueParticipantIds:f}=d;if(d=rR({tournamentRecord:u,event:m,internalUse:!0}),d.error)return d;p&&U.push(p),g.push(l),f?.length&&I.push(...f),e+=1}}const S=l?.length?pb({tournamentRecord:u,venueProfiles:l}):[];let w={};if(c?.length){const e=vg({tournamentRecords:{[u.tournamentId]:u},schedulingProfile:c});if(e.error)return e;if(m){const{tournamentId:e}=u;w=tS({tournamentRecords:{[e]:u},periodLength:p})}}return{totalParticipantsCount:u.participants.length,scheduledRounds:undefined,schedulerResult:w,...L,eventIds:g,venueIds:S,drawIds:U}}};const mb=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];const fb={generateOutcomeFromScoreString:dD,generateTournamentRecord:function(e){let{tournamentAttributes:t,startDate:n,endDate:r}=e;const{tournamentName:i=M(mb),ratingsParameters:a=zm,scheduleCompletedMatchUps:o,tournamentExtensions:s,matchUpStatusProfile:c,completeAllMatchUps:u,participantsProfile:d,autoEntryPositions:p,hydrateCollections:l,randomWinningSide:m,policyDefinitions:f,schedulingProfile:h,periodLength:I,autoSchedule:g,eventProfiles:U,venueProfiles:y,drawProfiles:v,uuids:S}=e;if(n&&!Or(n)||r&&!Or(r))return{error:yt};if(U&&!Array.isArray(U))return{error:xn};if(!n){const e=new Date;n=kr(r??e),r=kr(e.setDate(e.getDate()+7))}if(!r){const e=new Date(n);r=kr(e.setDate(e.getDate()+7))}"object"!=typeof t&&(t={});const w=OT({...t,tournamentName:i,startDate:n,endDate:r});if(s?.length&&Array.isArray(s)){const e=s.filter((e=>Ys({extension:e})));e?.length&&Object.assign(w,{extensions:e,isMock:!0})}if("object"==typeof f)for(const P of Object.keys(f))US({policyDefinitions:{[P]:f[P]},tournamentRecord:w});const T=rb({participantsProfile:d,tournamentRecord:w,eventProfiles:U,drawProfiles:v,startDate:n,uuids:S});if(!T.success)return T;const D=[],R=[],b=[];if(Array.isArray(v)){let e=0;for(const t of v){let r=db({allUniqueParticipantIds:D,matchUpStatusProfile:c,participantsProfile:d,completeAllMatchUps:u,autoEntryPositions:p,hydrateCollections:l,randomWinningSide:m,ratingsParameters:a,tournamentRecord:w,isMock:!0,drawProfile:t,startDate:n,drawIndex:e,uuids:S});if(r.error)return r;const{drawId:i,eventId:o,event:s,uniqueParticipantIds:f}=r;if(r=rR({suppressNotifications:!1,internalUse:!0,tournamentRecord:w,event:s}),r.error)return r;i&&b.push(i),R.push(o),f?.length&&D.push(...f),e+=1}}if(U){let e=0;for(const t of U){const r=ub({allUniqueParticipantIds:D,matchUpStatusProfile:c,participantsProfile:d,completeAllMatchUps:u,autoEntryPositions:p,hydrateCollections:l,randomWinningSide:m,ratingsParameters:a,tournamentRecord:w,eventProfile:t,eventIndex:e,startDate:n,uuids:S});if(r.error)return r;const{eventId:i,drawIds:o,uniqueParticipantIds:s}=r;o&&b.push(...o),R.push(i),s?.length&&D.push(...s),e+=1}}const N=y?.length?pb({tournamentRecord:w,venueProfiles:y,uuids:S}):[];let A,E={};if(h){const e=function({schedulingProfile:e,tournamentRecord:t}){if("object"!=typeof e)return{error:xn};const n=Zg({tournamentRecord:t}).containedStructures,r=rh({tournamentRecord:t}).matchUps??[],{tournamentId:i}=t,a=[];for(const o of e){const{scheduleDate:e,venues:s=[]}=o;for(const o of s){const{rounds:s,venueId:c}=o;for(const o of s){const{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,p=r.filter((e=>{const t=u?.indexOf("-")>0&&u.split("-").map((e=>+e)),n=e.finishingPositionRange?.winner;return!(e.drawId!==s||o.roundNumber&&e.roundNumber!==o.roundNumber||n&&t&&2!==O(n,t).length&&(P(n).length!==P(t).length||O(n,t).length!==P(n).length))}))[0];if(p){const{eventId:r,roundNumber:o,drawName:l,structureName:m,roundName:f}=p;let h=p.structureId;o&&!u&&(h=Object.keys(n).find((e=>n[e].includes(h)))??h);const I={tournamentId:i,structureId:h,roundNumber:o,roundSegment:d,eventId:r,drawId:s},g=Sg({tournamentRecords:{[i]:t},round:I,scheduleDate:e,venueId:c});if(g.error)return g;a.push({structureName:m,roundName:f,drawName:l,...I})}}}}return{scheduledRounds:a}}({schedulingProfile:h,tournamentRecord:w});if(e.error)return e;if(A=e.scheduledRounds,g){const{tournamentId:e}=w;E=tS({scheduleCompletedMatchUps:o,tournamentRecords:{[e]:w},periodLength:I})}}return dr(),pi({...L,tournamentRecord:w,scheduledRounds:A,schedulerResult:E,eventIds:R,venueIds:N,drawIds:b})},generateEventWithDraw:db,generateParticipants:ZR,parseScoreString:iI,generateOutcome:lD,credits:SS};let hb=!1;const Ib=(()=>{const e={version:()=>"1.8.46",setDeepCopy:(t,n)=>(cr(t,n),e),devContext:t=>(or(t),hb=!0,e)};return[lb,fb].forEach((t=>{Object.keys(t).forEach((n=>{e[n]=e=>{try{return function(e,t){const n=e({...t});return n?.error||gU(),fr(),hb&&(or(!1),hb=!1),n}(t[n],e)}catch(r){let t;"string"==typeof r?t=r.toUpperCase():r instanceof Error&&(t=r.message),console.log("ERROR",{params:JSON.stringify(e),method:n,error:t})}}}))})),e})(),gb={activeMatchUpStatuses:Oa,auditConstants:zv,completedMatchUpStatuses:Ca,directingMatchUpStatuses:Aa,drawDefinitionConstants:ep,entryStatusConstants:Ap,errorConditionConstants:Zn,eventConstants:Bu,extensionConstants:Qo,flightConstants:IR,genderConstants:ki,keyValueConstants:bm,matchUpActionConstants:ug,matchUpStatusConstants:ka,matchUpTypes:Gi,nonDirectingMatchUpStatuses:Ea,participantConstants:Ju,participantRoles:qT,particicipantsRequiredMatchUpStatuses:Na,participantTypes:Qu,penaltyConstants:{COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},policyConstants:To,positionActionConstants:Bf,ratingConstants:Hm,recoveryTimeRequiredMatchUpStatuses:ba,requestConstants:Cv,resultConstants:B,scaleConstants:Ts,scheduleConstants:Ws,sortingConstants:cD,surfaceConstants:{CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},tieFormatConstants:ZD,timeItemConstants:Su,topicConstants:jc,tournamentConstants:UD,upcomingMatchUpStatuses:Fa,validMatchUpStatuses:Ma,venueConstants:{INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"}},Ub={addExtension:Js,allPlayoffPositionsFilled:LI,calculateWinCriteria:vh,categoryCanContain:oa,checkSetIsComplete:xm,chunkArray:x,compareTieFormats:Eh,constantToString:kh,countValues:function(e){return t=R(e),Object.keys(t).reduce(((e,n)=>{const r=t[n];return e[r]?e[r].push(n):e[r]=[n],e}),{});var t},createMap:ui,dateRange:Lr,dateTime:ri,definedAttributes:pi,dehydrateMatchUps:function({tournamentRecord:e}){if(!e)return{error:$};if("object"!=typeof e||!e.tournamentId)return{error:xn};const{matchUps:t}=rh({tournamentRecord:e,inContext:!1});if(t?.length){const n=function({tournamentRecord:e}){const t={};for(const n of e.events||[]){n.matchUpFormat&&(t[n.eventId]=n.matchUpFormat);for(const e of n.drawDefinitions||[]){e.matchUpFormat&&(t[e.drawId]=e.matchUpFormat);for(const n of e.structures||[]){n.matchUpFormat&&(t[n.structureId]=n.matchUpFormat);for(const e of n.structures||[])e.matchUpFormat&&(t[e.structureId]=e.matchUpFormat)}}}return t}({tournamentRecord:e});!function(e,t={}){for(const n of e){const{structureId:e,drawId:r,eventId:i}=n,a=t[e]||t[r]||t[i],o=n.matchUpFormat===a?void 0:n.matchUpFormat;for(const t of Object.keys(n))Oh.includes(t)||delete n[t];n.sides&&n.drawPositions&&!n.tieMatchUps&&delete n.sides,o&&(n.matchUpFormat=o)}}(t,n)}return{...L}},extractAttributes:di,findExtension:Ms,flattenJSON:hi,garman:nI,tieFormatGenderValidityCheck:ta,generateHashCode:function(e){if(null===e||"object"!=typeof e)return;const t=JSON.stringify(e),n=li(e),r=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0);return[t.length,n,r].map((e=>e.toString(36))).join("")},generateRange:E,generateScoreString:_l,generateTimeCode:fi,getAssignedParticipantIds:Hh,getAvailablePlayoffProfiles:fh,getCategoryAgeDetails:ia,getMatchUpContextIds:rI,getScaleValues:Ds,getSeedingThresholds:Wh,getSetComplement:Bm,getStructureSeedAssignments:kp,getTimeItem:zf,getValidGroupSizes:Gh,hasAttributeValues:e=>t=>Object.keys(e).every((n=>t[n]===e[n])),instanceCount:R,intersection:O,isAdHoc:Hp,isConvertableInteger:S,isNumeric:U,isPowerOf2:f,isCompletedStructure:_I,JSON2CSV:function(e,t){if(t&&"object"!=typeof t)return xn;let{columnTransform:n={}}=t||{};const{includeTransformAccessors:r,includeHeaderRow:i=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:c=[],functionMap:u={},columnMap:d={},valuesMap:p={},context:l={},delimiter:m='"',columnJoiner:f=",",rowJoiner:h="\r\n",keyJoiner:I="."}=t||{};if(!Array.isArray(e)||!Array.isArray(c)||"object"!=typeof l||"object"!=typeof d||"object"!=typeof n||"object"!=typeof u||"object"!=typeof p||"string"!=typeof f||"string"!=typeof h||"string"!=typeof I||"string"!=typeof m)return xn;n=Object.assign({},...Object.keys(n).reverse().map((e=>({[e]:Array.isArray(n[e])?n[e]:["string"==typeof n[e]&&n[e]].filter(Boolean)}))));const g=e.filter(Boolean).map((e=>hi(e,I))),y=Object.values(n).flat();r&&c.push(...y);const v=g.reduce(((e,t)=>Object.keys(t).every((t=>!e.includes(t)&&e.push(t)||!0))&&e),[]).filter((e=>!c?.length||c.includes(e))),S=Object.assign({},...Object.keys(n).reverse().map((e=>n[e].map((t=>({[t]:e}))).flat())).flat()),w=v.reduce(((e,t)=>{const n=S[t];return n?e.includes(n)||e.push(n):e.push(t),e}),[]).sort(((e,n)=>t?.sortOrder?t.sortOrder.includes(e)&&t.sortOrder.includes(n)&&t.sortOrder.indexOf(e)-t.sortOrder.indexOf(n)||!t.sortOrder.includes(n)&&-1:0));Object.keys(d).forEach((e=>!w.includes(e)&&w.unshift(e))),Object.keys(n).forEach((e=>!w.includes(e)&&w.unshift(e))),"object"==typeof l&&Object.keys(l).forEach((e=>!w.includes(e)&&w.unshift(e)));let P=w.map((e=>d[e]||e));if(s)return[P];const T=e=>`${m}${e}${m}`,D=[];let R=g.map((e=>Object.values(w.reduce(((t,r,i)=>{const a=n[r],o=(a?.length?e[a.find((t=>e[t]))]:e[r])||l?.[r]||"",s=p[r]?.[o]||o,c="function"==typeof u[r]?u[r](s):s;return t[r]=T(c),c&&(D[i]=(D[i]||0)+1),t}),{}))));const b=o&&[...D].map(((e,t)=>!e&&t)).filter(U).reverse();if(b){const e=e=>e.filter(((e,t)=>!b.includes(t)));R=R.map(e),P=e(P)}const N=R.map((e=>e.join(f)));return a?N.map((e=>{const t=e.split(f);return Object.assign({},...t.map(((e,t)=>({[P[t]]:e}))))})):i?[P.map(T).join(f),...N].join(h):N.join(h)},makeDeepCopy:ii,matchUpSort:Rh,nearestPowerOf2:g,nextPowerOf2:y,numericSort:l,overlap:k,parseScoreString:iI,participantScaleItem:zh,proConflicts:Nh,randomMember:A,randomPop:M,roundRobinGroups:Vh,scoreHasValue:dl,shuffleArray:T,structureSort:tp,tidyScore:function(e){const{score:t,sheetName:n,identifier:r,fileName:i,stepLog:a,fullLog:o,profile:s}=e,c=[];let u,d,p,l=[],m=t;const f=e=>{e.forEach((e=>{p=PI[e]({profile:s,identifier:r,matchUpStatus:u,attributes:d,applied:l,score:m});const t=p.score!==m;t&&c.push({method:e,score:p.score}),a&&(o||t||p.matchUpStatus!==u)&&(u?console.log({score:p.score,matchUpStatus:u},e):console.log({score:p.score},e)),p.matchUpStatus&&(u=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(l=p.applied),m=p.score}))};f(DI);let h=lI(m);return h||(m=t.toString().replace(/\D/g,""),d?.removed&&(d.removed=void 0),f(RI),h=lI(m),h||(m="")),l.forEach((e=>{TI[e]||(TI[e]=0),TI[e]+=1})),{matchUpStatus:u?.toUpperCase(),modifications:c,attributes:d,isValid:h,score:m}},unique:P,UUID:Ii,UUIDS:function(e=1){return E(0,e).map(Ii)},validateCategory:aa,validateTieFormat:ca,visualizeScheduledMatchUps:function({scheduledMatchUps:e,showGlobalLog:t}){gh.length=0;const n=e?.reduce(((e,{structureId:t})=>e.includes(t)?e:e.concat(t)),[]),r=Object.assign({},...(n||[]).map((t=>{const{structureName:n,matchUpType:r}=e.find((e=>e.structureId===t));return{[t]:`${n} ${r}`}})));n?.forEach((t=>{Uh({color:"blue",method:"draw",structure:r[t],keyColors:{structure:"magenta"}},!0);const n=e.filter((e=>e.structureId===t)),i=ed({matchUps:n})?.roundMatchUps||[];Object.keys(i).forEach((e=>{Uh({roundNumber:e,keyColors:{roundNumber:"brightcyan"}},!0),i[e].forEach((({matchUpId:e,schedule:t})=>{Uh({matchUpId:e,time:$r(t.scheduledTime),date:t.scheduledDate,venue:t.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)}))}))})),t&&yh()}}}}]);