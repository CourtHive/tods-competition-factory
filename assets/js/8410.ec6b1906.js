/*! For license information please see 8410.ec6b1906.js.LICENSE.txt */
"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[8410],{3039:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(758),r=i(4604);function a(e){let{children:t,fallback:i}=e;return(0,r.A)()?n.createElement(n.Fragment,null,t?.()):i??null}},4196:(e,t,i)=>{i.d(t,{GV:()=>iF,qx:()=>Yk});var n,r="colors",a="sizes",o="space",s={gap:o,gridGap:o,columnGap:o,gridColumnGap:o,rowGap:o,gridRowGap:o,inset:o,insetBlock:o,insetBlockEnd:o,insetBlockStart:o,insetInline:o,insetInlineEnd:o,insetInlineStart:o,margin:o,marginTop:o,marginRight:o,marginBottom:o,marginLeft:o,marginBlock:o,marginBlockEnd:o,marginBlockStart:o,marginInline:o,marginInlineEnd:o,marginInlineStart:o,padding:o,paddingTop:o,paddingRight:o,paddingBottom:o,paddingLeft:o,paddingBlock:o,paddingBlockEnd:o,paddingBlockStart:o,paddingInline:o,paddingInlineEnd:o,paddingInlineStart:o,top:o,right:o,bottom:o,left:o,scrollMargin:o,scrollMarginTop:o,scrollMarginRight:o,scrollMarginBottom:o,scrollMarginLeft:o,scrollMarginX:o,scrollMarginY:o,scrollMarginBlock:o,scrollMarginBlockEnd:o,scrollMarginBlockStart:o,scrollMarginInline:o,scrollMarginInlineEnd:o,scrollMarginInlineStart:o,scrollPadding:o,scrollPaddingTop:o,scrollPaddingRight:o,scrollPaddingBottom:o,scrollPaddingLeft:o,scrollPaddingX:o,scrollPaddingY:o,scrollPaddingBlock:o,scrollPaddingBlockEnd:o,scrollPaddingBlockStart:o,scrollPaddingInline:o,scrollPaddingInlineEnd:o,scrollPaddingInlineStart:o,fontSize:"fontSizes",background:r,backgroundColor:r,backgroundImage:r,borderImage:r,border:r,borderBlock:r,borderBlockEnd:r,borderBlockStart:r,borderBottom:r,borderBottomColor:r,borderColor:r,borderInline:r,borderInlineEnd:r,borderInlineStart:r,borderLeft:r,borderLeftColor:r,borderRight:r,borderRightColor:r,borderTop:r,borderTopColor:r,caretColor:r,color:r,columnRuleColor:r,fill:r,outline:r,outlineColor:r,stroke:r,textDecorationColor:r,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:a,minBlockSize:a,maxBlockSize:a,inlineSize:a,minInlineSize:a,maxInlineSize:a,width:a,minWidth:a,maxWidth:a,height:a,minHeight:a,maxHeight:a,flexBasis:a,gridTemplateColumns:a,gridTemplateRows:a,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},l=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,u=()=>{const e=Object.create(null);return(t,i,...n)=>{const r=(a=t,JSON.stringify(a,l));var a;return r in e?e[r]:e[r]=i(t,...n)}},d=Symbol.for("sxs.internal"),c=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),p=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:m}=Object.prototype,f=e=>e.includes("-")?e:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),h=/\s+(?![^()]*\))/,v=e=>t=>e(..."string"==typeof t?String(t).split(h):[t]),g={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:v(((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e}))),marginInline:v(((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e}))),maxSize:v(((e,t)=>({maxBlockSize:e,maxInlineSize:t||e}))),minSize:v(((e,t)=>({minBlockSize:e,minInlineSize:t||e}))),paddingBlock:v(((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e}))),paddingInline:v(((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e})))},I=/([\d.]+)([^]*)/,U=(e,t)=>e.length?e.reduce(((e,i)=>(e.push(...t.map((e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(e)?`:is(${i})`:i):i+" "+e))),e)),[]):t,y=(e,t)=>e in S&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,i,n,r)=>i+("stretch"===n?`-moz-available${r};${f(e)}:${i}-webkit-fill-available`:`-moz-fit-content${r};${f(e)}:${i}fit-content`)+r)):String(t),S={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},w=e=>e?e+"-":"",P=(e,t,i)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((e,n,r,a,o)=>"$"==a==!!r?e:(n||"--"==a?"calc(":"")+"var(--"+("$"===a?w(t)+(o.includes("$")?"":w(i))+o.replace(/\$/g,"-"):o)+")"+(n||"--"==a?"*"+(n||"")+(r||"1")+")":""))),D=/\s*,\s*(?![^()]*\))/,T=Object.prototype.toString,b=(e,t,i,n,r)=>{let a,o,s;const l=(e,t,i)=>{let u,d;const c=e=>{for(u in e){const h=64===u.charCodeAt(0),v=h&&Array.isArray(e[u])?e[u]:[e[u]];for(d of v){const e=/[A-Z]/.test(m=u)?m:m.replace(/-[^]/g,(e=>e[1].toUpperCase())),v="object"==typeof d&&d&&d.toString===T&&(!n.utils[e]||!t.length);if(e in n.utils&&!v){const t=n.utils[e];if(t!==o){o=t,c(t(d)),o=null;continue}}else if(e in g){const t=g[e];if(t!==s){s=t,c(t(d)),s=null;continue}}if(h&&(p=u.slice(1)in n.media?"@media "+n.media[u.slice(1)]:u,u=p.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((e,t,i,n,r,a)=>{const o=I.test(t),s=.0625*(o?-1:1),[l,u]=o?[n,t]:[t,n];return"("+("="===i[0]?"":">"===i[0]===o?"max-":"min-")+l+":"+("="!==i[0]&&1===i.length?u.replace(I,((e,t,n)=>Number(t)+s*(">"===i?1:-1)+n)):u)+(r?") and ("+(">"===r[0]?"min-":"max-")+l+":"+(1===r.length?a.replace(I,((e,t,i)=>Number(t)+s*(">"===r?-1:1)+i)):a):"")+")"}))),v){const e=h?i.concat(u):[...i],n=h?[...t]:U(t,u.split(D));void 0!==a&&r(R(...a)),a=void 0,l(d,n,e)}else void 0===a&&(a=[[],t,i]),u=h||36!==u.charCodeAt(0)?u:`--${w(n.prefix)}${u.slice(1).replace(/\$/g,"-")}`,d=v?d:"number"==typeof d?d&&e in N?String(d)+"px":String(d):P(y(e,d??""),n.prefix,n.themeMap[e]),a[0].push(`${h?`${u} `:`${f(u)}:`}${d}`)}}var p,m};c(e),void 0!==a&&r(R(...a)),a=void 0};l(e,t,i)},R=(e,t,i)=>`${i.map((e=>`${e}{`)).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,N={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},M=e=>String.fromCharCode(e+(e>25?39:97)),A=e=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=M(t%52)+i;return M(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(e))>>>0),E=["themed","global","styled","onevar","resonevar","allvar","inline"],C=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch{return!1}},O=e=>{let t;const i=()=>{const{cssRules:e}=t.sheet;return[].map.call(e,((i,n)=>{const{cssText:r}=i;let a="";if(r.startsWith("--sxs"))return"";if(e[n-1]&&(a=e[n-1].cssText).startsWith("--sxs")){if(!i.cssRules.length)return"";for(const e in t.rules)if(t.rules[e].group===i)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${r}`;return i.cssRules.length?`${a}${r}`:""}return r})).join("")},n=()=>{if(t){const{rules:e,sheet:i}=t;if(!i.deleteRule){for(;3===Object(Object(i.cssRules)[0]).type;)i.cssRules.splice(0,1);i.cssRules=[]}for(const t in e)delete e[t]}const r=Object(e).styleSheets||[];for(const e of r)if(C(e)){for(let r=0,a=e.cssRules;a[r];++r){const o=Object(a[r]);if(1!==o.type)continue;const s=Object(a[r+1]);if(4!==s.type)continue;++r;const{cssText:l}=o;if(!l.startsWith("--sxs"))continue;const u=l.slice(14,-3).trim().split(/\s+/),d=E[u[0]];d&&(t||(t={sheet:e,reset:n,rules:{},toString:i}),t.rules[d]={group:s,index:r,cache:new Set(u)})}if(t)break}if(!t){const r=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,r(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,(e=>e.cssText)).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:r("","text/css"),rules:{},reset:n,toString:i}}const{sheet:a,rules:o}=t;for(let e=E.length-1;e>=0;--e){const t=E[e];if(!o[t]){const i=E[e+1],n=o[i]?o[i].index:a.cssRules.length;a.insertRule("@media{}",n),a.insertRule(`--sxs{--sxs:${e}}`,n),o[t]={group:a.cssRules[n+1],index:n,cache:new Set([e])}}k(o[t])}};return n(),t},k=e=>{const t=e.group;let i=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,i),++i}catch{}}},F=Symbol(),x=u(),_=(e,t)=>x(e,(()=>(...i)=>{let n={type:null,composers:new Set};for(const t of i)if(null!=t)if(t[d]){null==n.type&&(n.type=t[d].type);for(const e of t[d].composers)n.composers.add(e)}else t.constructor!==Object||t.$$typeof?null==n.type&&(n.type=t):n.composers.add(L(t,e));return null==n.type&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),B(e,n,t)})),L=({variants:e,compoundVariants:t,defaultVariants:i,...n},r)=>{const a=`${w(r.prefix)}c-${A(n)}`,o=[],s=[],l=Object.create(null),u=[];for(const p in i)l[p]=String(i[p]);if("object"==typeof e&&e)for(const f in e){d=l,c=f,m.call(d,c)||(l[f]="undefined");const t=e[f];for(const e in t){const i={[f]:String(e)};"undefined"===String(e)&&u.push(f);const n=t[e],r=[i,n,!p(n)];o.push(r)}}var d,c;if("object"==typeof t&&t)for(const m of t){let{css:e,...t}=m;e="object"==typeof e&&e||{};for(const n in t)t[n]=String(t[n]);const i=[t,e,!p(e)];s.push(i)}return[a,n,o,s,l,u]},B=(e,t,i)=>{const[n,r,a,o]=V(t.composers),s="function"==typeof t.type||t.type.$$typeof?(e=>{function t(){for(let i=0;i<t[F].length;i++){const[n,r]=t[F][i];e.rules[n].apply(r)}return t[F]=[],null}return t[F]=[],t.rules={},E.forEach((e=>t.rules[e]={apply:i=>t[F].push([e,i])})),t})(i):null,l=(s||i).rules,u=`.${n}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,p=d=>{d="object"==typeof d&&d||G;const{css:c,...p}=d,m={};for(const e in a)if(delete p[e],e in d){let t=d[e];"object"==typeof t&&t?m[e]={"@initial":a[e],...t}:(t=String(t),m[e]="undefined"!==t||o.has(e)?t:a[e])}else m[e]=a[e];const f=new Set([...r]);for(const[n,r,a,o]of t.composers){i.rules.styled.cache.has(n)||(i.rules.styled.cache.add(n),b(r,[`.${n}`],[],e,(e=>{l.styled.apply(e)})));const t=j(a,m,e.media),s=j(o,m,e.media,!0);for(const r of t)if(void 0!==r)for(const[t,a,o]of r){const r=`${n}-${A(a)}-${t}`;f.add(r);const s=(o?i.rules.resonevar:i.rules.onevar).cache,u=o?l.resonevar:l.onevar;s.has(r)||(s.add(r),b(a,[`.${r}`],[],e,(e=>{u.apply(e)})))}for(const r of s)if(void 0!==r)for(const[t,a]of r){const r=`${n}-${A(a)}-${t}`;f.add(r),i.rules.allvar.cache.has(r)||(i.rules.allvar.cache.add(r),b(a,[`.${r}`],[],e,(e=>{l.allvar.apply(e)})))}}if("object"==typeof c&&c){const t=`${n}-i${A(c)}-css`;f.add(t),i.rules.inline.cache.has(t)||(i.rules.inline.cache.add(t),b(c,[`.${t}`],[],e,(e=>{l.inline.apply(e)})))}for(const e of String(d.className||"").trim().split(/\s+/))e&&f.add(e);const h=p.className=[...f].join(" ");return{type:t.type,className:h,selector:u,props:p,toString:()=>h,deferredInjector:s}};return c(p,{className:n,selector:u,[d]:t,toString:()=>(i.rules.styled.cache.has(n)||p(),n)})},V=e=>{let t="";const i=[],n={},r=[];for(const[a,,,,o,s]of e){""===t&&(t=a),i.push(a),r.push(...s);for(const e in o){const t=o[e];(void 0===n[e]||"undefined"!==t||s.includes(t))&&(n[e]=t)}}return[t,i,n,new Set(r)]},j=(e,t,i,n)=>{const r=[];e:for(let[a,o,s]of e){if(s)continue;let e,l=0,u=!1;for(e in a){const n=a[e];let r=t[e];if(r!==n){if("object"!=typeof r||!r)continue e;{let e,t,a=0;for(const o in r){if(n===String(r[o])){if("@initial"!==o){const e=o.slice(1);(t=t||[]).push(e in i?i[e]:o.replace(/^@media ?/,"")),u=!0}l+=a,e=!0}++a}if(t&&t.length&&(o={["@media "+t.join(", ")]:o}),!e)continue e}}}(r[l]=r[l]||[]).push([n?"cv":`${e}-${a[e]}`,o,u])}return r},G={},$=u(),q=(e,t)=>$(e,(()=>(...i)=>{const n=()=>{for(let n of i){n="object"==typeof n&&n||{};let i=A(n);if(!t.rules.global.cache.has(i)){if(t.rules.global.cache.add(i),"@import"in n){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let i of[].concat(n["@import"]))i=i.includes('"')||i.includes("'")?i:`"${i}"`,t.sheet.insertRule(`@import ${i};`,e++);delete n["@import"]}b(n,[],[],e,(e=>{t.rules.global.apply(e)}))}}return""};return c(n,{toString:n})})),W=u(),H=(e,t)=>W(e,(()=>i=>{const n=`${w(e.prefix)}k-${A(i)}`,r=()=>{if(!t.rules.global.cache.has(n)){t.rules.global.cache.add(n);const r=[];b(i,[],[],e,(e=>r.push(e)));const a=`@keyframes ${n}{${r.join("")}}`;t.rules.global.apply(a)}return n};return c(r,{get name(){return r()},toString:r})})),z=class{constructor(e,t,i,n){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==i?"":String(i),this.prefix=null==n?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+w(this.prefix)+w(this.scale)+this.token}toString(){return this.computedValue}},Y=u(),K=(e,t)=>Y(e,(()=>(i,n)=>{n="object"==typeof i&&i||Object(n);const r=`.${i=(i="string"==typeof i?i:"")||`${w(e.prefix)}t-${A(n)}`}`,a={},o=[];for(const t in n){a[t]={};for(const i in n[t]){const r=`--${w(e.prefix)}${t}-${i}`,s=P(String(n[t][i]),e.prefix,t);a[t][i]=new z(i,s,t,e.prefix),o.push(`${r}:${s}`)}}const s=()=>{if(o.length&&!t.rules.themed.cache.has(i)){t.rules.themed.cache.add(i);const r=`${n===e.theme?":root,":""}.${i}{${o.join(";")}}`;t.rules.themed.apply(r)}return i};return{...a,get className(){return s()},selector:r,toString:s}})),J=u(),Q=e=>{let t=!1;const i=J(e,(e=>{t=!0;const i="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",n="object"==typeof e.media&&e.media||{},r="object"==typeof e.root?e.root||null:globalThis.document||null,a="object"==typeof e.theme&&e.theme||{},o={prefix:i,media:n,theme:a,themeMap:"object"==typeof e.themeMap&&e.themeMap||{...s},utils:"object"==typeof e.utils&&e.utils||{}},l=O(r),u={css:_(o,l),globalCss:q(o,l),keyframes:H(o,l),createTheme:K(o,l),reset(){l.reset(),u.theme.toString()},theme:{},sheet:l,config:o,prefix:i,getCssText:l.toString,toString:l.toString};return String(u.theme=u.createTheme(a)),u}));return t||i.reset(),i},Z=(...e)=>(n||(n=Q())).css(...e);const X=Z({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),ee=Z({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),te=Z({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});const ie=Z({fontSize:"smaller",color:"gray"});typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof i.g<"u"?i.g:typeof self<"u"&&self;function ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var re,ae={exports:{}};re=ae,function(){var e={}.hasOwnProperty;function t(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];r&&(e=n(e,i(r)))}return e}function i(i){if("string"==typeof i||"number"==typeof i)return i;if("object"!=typeof i)return"";if(Array.isArray(i))return t.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var r="";for(var a in i)e.call(i,a)&&i[a]&&(r=n(r,a));return r}function n(e,t){return t?e?e+" "+t:e+t:e}re.exports?(t.default=t,re.exports=t):window.classNames=t}();const oe=ne(ae.exports);const se=Z({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),le=Z({display:"block"}),ue=Z({position:"fixed",right:0,left:0}),de=Z({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),ce=Z({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),pe=Z({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),me=Z({fontWeight:"600",fontSize:"20px"}),fe=Z({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),he="Nothing to see here";function ve(e){return"function"==typeof e}function ge(e){return"string"==typeof e}function Ie(e){return Array.isArray(e)}function Ue(e){return"object"==typeof e&&!Array.isArray(e)}const ye=(()=>{const e=ue(),t={},i=".5";let n,r,a=[],o=[],s=[];const l=i=>{const l=s.length;if(i&&!1===t[l])return;const u=o.pop(),d=a.pop();ve(u)&&u({content:d}),document.body.classList.remove(e),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),r&&(r.style.opacity=0,r.style.display="none"),(e=>{if(e){let t;s=s.filter((i=>(i.id===e&&(t=i),i.id!==e))),t&&document.body.removeChild(t)}else{const e=s.pop();e&&document.body.removeChild(e)}})()},u=({config:t})=>{n=window.scrollY,document.body.classList.add(e),document.body.style.top=`-${n}px`,r||(r=document.createElement("div"),r.className=se(),r.id="cmdl-backdrop",r.onclick=()=>l(!0),document.body.appendChild(r)),r.style.display="",!1!==(null==t?void 0:t.backdrop)&&(r.style.backgroundColor="rgba(0, 0, 0, 0.2)",r.style.transition="opacity 0.15s linear",r.style.opacity=1)},d=({config:e,attr:t,attrs:i,unit:n="em",value:r})=>{var a;let o;return ge(t)?o=Se({element:e,attr:t}):Ie(i)&&(o=null==(a=i.map((t=>Se({element:e,attr:t}))).filter(Boolean))?void 0:a[0]),void 0!==o&&(r=o),isNaN(r)?r:`${r}${n}`},c=({buttons:e,config:t,modalNumber:n})=>{var r,o;const s=document.createElement("div");s.className=fe(),s.style.padding=d({config:t,attrs:["footer.padding","padding"],value:i});const l={label:(null==(r=null==t?void 0:t.dictionary)?void 0:r.close)||"Close",onClick:ye.close,intent:"is-info"};for(const i of e){if(i.hide)continue;const e={...l};Ue(i)&&Object.assign(e,i);const t=document.createElement("button");void 0!==e.disabled&&(t.disabled=e.disabled),e.id&&(t.id=e.id),t.className=(null==(o=null==e?void 0:e.footer)?void 0:o.className)||"button font-medium",t.classList.add(e.intent),t.style="margin-right: .5em;",t.innerHTML=e.label||e.text,t.onclick=t=>{t.stopPropagation(),ve(e.onClick)&&e.onClick({e:t,content:a[n]}),!1!==e.close&&(ve(e.close)&&e.close(),ye.close())},s.appendChild(t)}return s};return{close:l,open:({title:e="",content:n,buttons:r,footer:p,config:m,onClose:f}={})=>{u({config:m}),o.push(f);const h=s.length+1;t[h]=null==m?void 0:m.clickAway;const v=document.createElement("section"),g=`cmdl-${h}`;v.className=le(),v.role="dialog",v.tabIndex=-1,v.id=g;const I=document.createElement("div");I.className=de(),I.style.maxWidth=`${(null==m?void 0:m.maxWidth)||450}px`,I.onclick=()=>l(!0);const U=document.createElement("div");U.className=ce(),U.onclick=e=>e.stopPropagation();const y=document.createElement("div"),S=document.createElement("div");y.appendChild(S),U.appendChild(y);const w=({title:e,config:t})=>{y.className=e?pe():"",y.style.padding=d({config:t,attrs:["title.padding","padding"],value:i}),S.className=e?me():"",S.innerHTML=e};e&&w({title:e});const P=document.createElement("div");U.appendChild(P);const D=({content:e,config:t})=>{P.style.fontSize=d({config:t,attr:"fontSize",value:"15px"}),P.style.position="relative",P.style.padding=d({config:t,attrs:["content.padding","padding"],value:i}),ve(e)?a[h]=e(P):Ue(e)?P.appendChild(e):ge(e)?P.innerHTML=e:P.innerHTML=he};if(D({content:n,config:m}),Ie(r))p=c({buttons:r,config:m,modalNumber:h}),U.appendChild(p);else if(p){const e=document.createElement("div");e.className=fe(),e.style.padding=d({config:m,attrs:["footer.padding","padding"]}),Ue(p)?e.appendChild(p):ge(p)?e.innerHTML=p:e.innerHTML=he,U.appendChild(e)}I.appendChild(U),v.appendChild(I),document.body.appendChild(v),s.push(v);const T=({content:e,config:t})=>{a[h]=void 0,function(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}(P),D({content:e,config:t})},b=({buttons:e,config:t})=>{U.removeChild(p),p=c({buttons:e,config:t,modalNumber:h}),U.appendChild(p)};return{setContent:T,setButtons:b,update:({content:e,buttons:t,title:i,config:n,onClose:r})=>{m=n||m,e&&T({content:e,config:m}),t&&b({buttons:t,config:m}),r&&(({onClose:e})=>{o.length=0,o.push(e)})({onClose:r}),i&&w({title:i,config:m})}}}}})();function Se({element:e,attr:t}){if(!ge(t))return;const i=t.split(".");for(const n of i)if(!(e=null==e?void 0:e[n]))return;return e}function we(e){var t,i,n,r;const a=null==(i=null==(t=null==e?void 0:e.composition)?void 0:t.configuration)?void 0:i.participantDetail;if("TEAM"===a)return function({individualParticipant:e,className:t}){var i;const n=null==(i=null==e?void 0:e.teams)?void 0:i[0],r=(null==n?void 0:n.participantName)||" ",a=document.createElement("div");return a.className=oe(ie(),t),a.classList.add("tmx-tm"),a.setAttribute("id",null==n?void 0:n.participantId),a.innerHTML=r,a}(e);if((null==(r=null==(n=null==e?void 0:e.composition)?void 0:n.configuration)?void 0:r.showAddress)??"ADDRESS"===a)return function({individualParticipant:e,className:t}){var i,n;const{city:r,state:a,countryCode:o}=(null==(n=null==(i=null==e?void 0:e.person)?void 0:i.addresses)?void 0:n[0])||{},s=[r,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=oe(ie(),t),l.innerHTML=s,l}(e);if(a){const t=function({individualParticipant:e,attribute:t,className:i}){const n=Se({element:null==e?void 0:e.person,attr:t});if(!n)return;const r=document.createElement("div");return r.className=oe(ie(),i),r.innerHTML=n,r}({...e,attribute:a});if(t)return t}return document.createElement("div")}const Pe=Z({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});const De=Z({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});var Te=Object.defineProperty,be=(e,t)=>{for(var i in t)Te(e,i,{get:t[i],enumerable:!0})};var Re={};be(Re,{competitionGovernor:()=>Ne,drawsGovernor:()=>dc,entriesGovernor:()=>lR,eventGovernor:()=>yR,generationGovernor:()=>aN,matchUpFormatGovernor:()=>ON,matchUpGovernor:()=>kN,mocksGovernor:()=>zM,participantGovernor:()=>mE,policyGovernor:()=>ZD,publishingGovernor:()=>GE,queryGovernor:()=>sT,reportGovernor:()=>tC,scheduleGovernor:()=>lC,scoreGovernor:()=>Hw,tieFormatGovernor:()=>wC,tournamentGovernor:()=>qC,venueGovernor:()=>oO});var Ne={};be(Ne,{getLinkedTournamentIds:()=>uc,getTournamentIds:()=>Ad,linkTournaments:()=>ac,mutate:()=>Me,query:()=>lc,unlinkTournament:()=>sc,unlinkTournaments:()=>oc});var Me={};be(Me,{linkTournaments:()=>ac,unlinkTournament:()=>sc,unlinkTournaments:()=>oc});var Ae="SINGLES",Ee="SINGLES",Ce="DOUBLES",Oe="DOUBLES",ke="TEAM",Fe="TEAM",xe={SINGLES_MATCHUP:Ae,SINGLES:Ee,DOUBLES_MATCHUP:Ce,DOUBLES:Oe,TEAM_MATCHUP:ke,TEAM:Fe},_e={[Ee]:[Ee,"S"],[Oe]:[Oe,"D"],[Fe]:[Fe,"T"],S:[Ee,"S"],D:[Oe,"D"],T:[Fe,"T"]};function Le(e,t){return(e??0)-(t??0)}function Be(e){return"number"==typeof e?parseInt(e.toString()):"string"==typeof e?parseInt(e):0}function Ve(e){return!isNaN(e)&&(e&&0==(e&e-1))}function je(e){if(!e.length)return;let t=[...e].sort(Le),i=Math.floor(t.length/2);return t.length%2?t[i]:(t[i-1]+t[i])/2}function Ge(e){return isNaN(e)?0:e%2&&e+1||e}function $e(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function qe(e){return!isNaN(parseFloat(e))}function We(e){let t=Be(e);if(!isNaN(t))return 0!==t&&1==(t&-t)}function He(e){if(isNaN(e))return!1;for(;!Ve(e);)e++;return e}function ze(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function Ye(e){return Number.isSafeInteger("string"==typeof e?+e:e)}function Ke(e,t,i,n,r=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=Ke(e,t,i):(s=Math.pow(s,i),s*=t-e,s+=e),n&&(s=function(e,t){t||(t=1);let i=1/t;return Math.round(e*i)/i}(s,n)),parseFloat(s.toFixed(r))}function Je(e,t=2){return parseFloat(Number(Math.round(1e3*e)/1e3).toFixed(t))}function Qe(e){return Array.isArray(e)?null==e?void 0:e.filter(((e,t,i)=>i.lastIndexOf(e)===t)):[]}function Ze(e){return Array.isArray(e)?null==e?void 0:e.map((e=>null===e?void 0:e)):e}function Xe(e){return Array.isArray(e)?e.map((e=>[Math.random(),e])).sort(((e,t)=>e[0]-t[0])).map((e=>e[1])):[]}function et(e){return Ye(e)?e:1/0}function tt(e){return Array.isArray(e)?e.reduce(((e,t)=>(e[t]||(e[t]=0),e[t]++,e)),{}):{}}function it(e){return nt(tt(e))}function nt(e){return Object.keys(e).reduce(((t,i)=>{let n=e[i];return t[n]?t[n].push(i):t[n]=[i],t}),{})}function rt(e,t,i){return i.indexOf(e)===t}function at(e){return e.filter(rt)}function ot(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function st(e){return e[Math.floor(Math.random()*e.length)]}function lt(e,t){return Array.from({length:t-e},((t,i)=>i+e))}function ut(e,t){return t.reduce(((t,i,n)=>(i===e&&t.push(n),t)),[])}function dt(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>-1!==t.indexOf(e))).filter(((e,t,i)=>i.indexOf(e)===t)):[]}function ct(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>!t.includes(e))):[]}function pt(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some((e=>t.includes(e)))}function mt(e,t){return Array.isArray(t)&&t.reduce(((e,t)=>(e[t]=1+e[t]||1,e)),{})[e]||0}function ft(e,t,i,n){return Array.isArray(e)?[].concat(...e.slice(0,t),...e.slice(t,t+i).sort(n),...e.slice(t+i,e.length)):[]}function ht(e,t){return Array.isArray(e)?e.reduce(((e,i,n)=>{let r=Math.floor(n/t);return e[r]=[].concat(e[r]||[],i),e}),[]):[]}function vt(e,[t,...i]){return e.length?[e.slice(0,t),...vt(e.slice(t),[...i,t])]:[]}function gt(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>!isNaN(parseInt(t))&&e),!0)}function It(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>isNaN(parseInt(t))&&e),!0)}function Ut(e,t,i){return Array.isArray(e)?e.reduce(((e,n,r)=>{let a=!!i&&!!(Math.floor(r/t)%2),o=r%t,s=a?t-1-o:o;return e[s]||(e[s]=[]),e[s].push(n),e}),[]):[]}function yt(e){return"function"==typeof e}function St(e){return"string"==typeof e}function wt(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function Pt(e,t){if(!wt(e)||!wt(t))return!1;let i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(let r of i)if(e[r]!==t[r])return!1;return!0}function Dt(e,t){return Array.isArray(e)?Object.assign({},...(e??[]).filter(wt).map((e=>e[t]&&{[e[t]]:e})).filter(Boolean)):{}}var Tt=e=>t=>Object.keys(e).every((i=>t[i]===e[i]));function bt(e,t){if(void 0===e)return null;if(!wt(e)||null===e)return e;let i=Object.keys(e),n=e=>void 0===e?null:e;return Object.assign({},...i.map((i=>Array.isArray(e[i])?{[i]:t?e[i]:e[i].map((e=>bt(e)))}:{[i]:t?n(e[i]):bt(e[i])})))}function Rt(e){return Array.isArray(e)?e.length+e.map(Rt).reduce(((e,t)=>e+t),0):wt(e)&&null!==e?Object.keys(e).length+Object.keys(e).map((t=>Rt(e[t]))).reduce(((e,t)=>e+t),0):0}function Nt(e){if(null===e||"object"!=typeof e)return;let t=JSON.stringify(e),i=Rt(e),n=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0);return[t.length,i,n].map((e=>e.toString(36))).join("")}function Mt(e,t){return!(!Array.isArray(e)||!St(t))&&dt(e,_e[t]).length}var At={success:!0},Et="error",Ct={SUCCESS:At,ERROR:Et};function Ot({collectionValueProfiles:e,matchUpCount:t}){let i=[];if(!Array.isArray(e))return i.push(`collectionValueProfiles is not an array: ${e}`),{errors:i};if(e.length&&e.length!==t)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of e){if("object"!=typeof r)return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:e,collectionPosition:n}=r;if("number"!=typeof e||"number"!=typeof n||n>t||n<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=e.map((e=>e.collectionPosition));return n.length!==Qe(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...At}}be({},{addNotice:()=>Ia,callListener:()=>Ta,createInstanceState:()=>ra,cycleMutationStatus:()=>ga,deepCopyEnabled:()=>pa,deleteNotice:()=>Sa,deleteNotices:()=>wa,disableNotifications:()=>ua,enableNotifications:()=>da,getDevContext:()=>aa,getMethods:()=>Ua,getNotices:()=>ya,getProvider:()=>Oa,getTopics:()=>Pa,getTournamentId:()=>ba,getTournamentRecord:()=>Ra,getTournamentRecords:()=>Na,globalLog:()=>Fa,handleCaughtError:()=>ka,hasTopic:()=>Da,removeTournamentRecord:()=>Ca,setDeepCopy:()=>ca,setDevContext:()=>la,setGlobalLog:()=>sa,setGlobalMethods:()=>ha,setGlobalSubscriptions:()=>ma,setMethods:()=>va,setStateMethods:()=>xa,setStateProvider:()=>na,setSubscriptions:()=>fa,setTournamentId:()=>Ea,setTournamentRecord:()=>Ma,setTournamentRecords:()=>Aa,timeKeeper:()=>oa});var kt={message:"Chronological error; time violation.",code:"ANACHRONISM"},Ft={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},xt={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},_t={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Lt={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Bt={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Vt={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},jt={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Gt={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},$t={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},qt={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Wt={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Ht={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},zt={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},Yt={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Kt={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},Jt={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Qt={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Zt={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Xt={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},ei={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},ti={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},ii={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},ni={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},ri={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},ai={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},oi={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},si={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},li={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},ui={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},di={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},ci={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},pi={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},mi={message:"Invalid action",code:"ERR_INVALID_ACTION"},fi={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},hi={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},vi={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},gi={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},Ii={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},Ui={message:"Existing round",code:"ERR_EXISTING_ROUND"},yi={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Si={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},wi={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Pi={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Di={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Ti={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},bi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Ri={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Ni={message:"Event exists",code:"ERR_EXISTING_EVENT"},Mi={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Ai={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},Ei={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Ci={message:"Missing stage",code:"ERR_MISSING_STAGE"},Oi={message:"Invalid stage",code:"ERR_INVALID_STAGE"},ki={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Fi={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},xi={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},_i={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Li={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},Bi={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Vi={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},ji={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Gi={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},$i={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},qi={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Wi={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Hi={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},zi={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Yi={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Ki={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Ji={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},Qi={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},Zi={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},Xi={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},en={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},tn={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},nn={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},rn={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},an={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},on={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},sn={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},ln={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},un={message:"Missing value",code:"ERR_MISSING_VALUE"},dn={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},cn={message:"Missing date",code:"ERR_MISSING_DATE"},pn={message:"No valid dates",code:"ERR_NO_VALID_DATES"},mn={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},fn={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},hn={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},vn={message:"Invalid Date",code:"ERR_INVALID_DATE"},gn={message:"Invalid time",code:"ERR_INVALID_TIME"},In={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},Un={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},yn={message:"Invalid score",code:"ERR_INVALID_SCORE"},Sn={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},wn={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},Pn={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Dn={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Tn={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},bn={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},Rn={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Nn={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Mn={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},An={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},En={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Cn={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},On={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},kn={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Fn={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},xn={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},_n={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Ln={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Bn={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Vn={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},jn={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},Gn={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},$n={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},qn={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},Wn={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Hn={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},zn={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Yn={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Kn={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Jn={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Qn={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Zn={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},Xn={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},er={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},tr={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},ir={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},nr={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},rr={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},ar={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},or={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},sr={message:"Court exists",code:"ERR_EXISTING_COURT"},lr={message:"Venue exists",code:"ERR_EXISTING_VENUE"},ur={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},dr={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},cr={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},pr={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},mr={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},fr={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},hr={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},vr={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},gr={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},Ir={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Ur={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},yr={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Sr={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},wr={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Pr={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Dr={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Tr={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},br={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Rr={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Nr={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Mr={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Ar={message:"Invalid gender",code:"ERR_INVALID_GENDER"},Er={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Cr={message:"Invalid values",code:"ERR_INVALID_VALUES"},Or={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},kr={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Fr={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},xr={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},_r={message:"Value unchanged",code:"ABORT_UNCHANGED"},Lr={message:"Not found",code:"ERR_NOT_FOUND"},Br={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Vr={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},jr={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Gr={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},$r={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},qr={message:"Existing stage",code:"ERR_EXISTING_STAGE"},Wr={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Hr={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},zr={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Yr={message:"Scores present",code:"ERR_SCORES_PRESENT"},Kr={ANACHRONISM:kt,CANNOT_CHANGE_WINNING_SIDE:Rn,CANNOT_MODIFY_TIEFORMAT:Pn,CANNOT_MODIFY_PARTICIPANT_TYPE:Dn,CANNOT_REMOVE_MAIN_STRUCTURE:xt,CANNOT_REMOVE_PARTICIPANTS:Tn,CATEGORY_MISMATCH:bn,COURT_EXISTS:sr,COURT_NOT_FOUND:or,DRAW_DEFINITION_NOT_FOUND:Wt,DRAW_ID_EXISTS:ui,DRAW_POSITION_ACTIVE:ei,DRAW_POSITION_ASSIGNED:Kt,DRAW_POSITION_NOT_CLEARED:Qt,DRAW_POSITION_NOT_FOUND:{message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},DRAW_SIZE_MISMATCH:oi,DUPLICATE_ENTRY:Ft,DUPLICATE_VALUE:Or,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Zn,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Qn,EVENT_EXISTS:Ni,EVENT_NOT_FOUND:Ri,EXISTING_DRAW_DEFINITIONS:qt,EXISTING_END_TIME:pr,EXISTING_FLIGHT:Vr,EXISTING_MATCHUP_ID:$r,EXISTING_OUTCOME:Gr,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:qn,EXISTING_PARTICIPANT:Wn,EXISTING_POLICY_TYPE:rn,EXISTING_PROFILE:jr,EXISTING_ROUND:Ui,EXISTING_STAGE:qr,EXISTING_STRUCTURE:Wr,INCOMPATIBLE_MATCHUP_STATUS:Bi,INCOMPLETE_SOURCE_STRUCTURE:zt,INSUFFICIENT_DRAW_POSITIONS:tr,INVALID_ACTION:mi,INVALID_ASSIGNMENT:fi,INVALID_BOOKINGS:mn,INVALID_CATEGORY:Er,INVALID_COLLECTION_DEFINITION:Nr,INVALID_CONFIGURATION:Rr,INVALID_DATE_AVAILABILITY:fn,INVALID_DATE:vn,INVALID_DRAW_DEFINITION:Gt,INVALID_DRAW_POSITION_FOR_SEEDING:Yt,INVALID_DRAW_POSITION:ii,INVALID_DRAW_SIZE:ai,INVALID_END_TIME:cr,INVALID_ENTRIES:Ai,INVALID_EVENT_TYPE:Ti,INVALID_GAME_SCORES:Un,INVALID_GENDER:Ar,INVALID_MATCHUP_FORMAT:Gi,INVALID_MATCHUP_STATUS:Vi,INVALID_MATCHUP_STATUS_BYE:xi,INVALID_MATCHUP:Qi,INVALID_OBJECT:Mr,INVALID_PARTICIPANT_ID:Mn,INVALID_PARTICIPANT_IDS:An,INVALID_PARTICIPANT_ROLE:En,INVALID_PARTICIPANT_SEEDING:di,INVALID_PARTICIPANT_TYPE:Cn,INVALID_PARTICIPANT:Nn,INVALID_POLICY_DEFINITION:nn,INVALID_RECORDS:_t,INVALID_SCALE_ITEM:wr,INVALID_SEED_NUMBER:vi,INVALID_SEED_POSITION:gi,INVALID_SET_NUMBER:{message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},INVALID_SIDE_NUMBER:on,INVALID_SCORE:yn,INVALID_STAGE:Oi,INVALID_START_TIME:fr,INVALID_STRUCTURE:Ht,INVALID_STOP_TIME:mr,INVALID_TIE_FORMAT:ji,INVALID_TIME:gn,INVALID_TIME_ITEM:vr,INVALID_TOURNAMENT_DATES:In,INVALID_TOURNAMENT_RECORD:Vt,INVALID_VALUES:Cr,INVALID_WINNING_SIDE:Sn,MATCHUP_NOT_FOUND:Yi,METHOD_NOT_FOUND:Hr,MISSING_ASSIGNMENTS:Ei,MISSING_ASYNC_STATE_PROVIDER:gr,MISSING_AVOIDANCE_POLICY:en,MISSING_BIRTH_DATE:dn,MISSING_COLLECTION_DEFINITION:qi,MISSING_COURT_ID:ln,MISSING_COURTS_INFO:ar,MISSING_DATE_AVAILABILITY:hn,MISSING_DATE:cn,MISSING_DRAW_DEFINITION:$t,MISSING_DRAW_ID:li,MISSING_DRAW_POSITION:ni,MISSING_DRAW_POSITIONS:Xt,MISSING_DRAW_SIZE:si,MISSING_ENTRIES:Mi,MISSING_EVENT:bi,MISSING_MATCHUP_FORMAT:$i,MISSING_MATCHUP_ID:Hi,MISSING_MATCHUP_IDS:zi,MISSING_MATCHUP:Ji,MISSING_MATCHUPS:Ki,MISSING_PARTICIPANT_COUNT:jn,MISSING_PARTICIPANT_ID:xn,MISSING_PARTICIPANT_IDS:Vn,MISSING_PARTICIPANT_ROLE:On,MISSING_PARTICIPANT:kn,MISSING_PARTICIPANTS:Fn,MISSING_PENALTY_ID:nr,MISSING_PENALTY_TYPE:ir,MISSING_PERSON_DETAILS:$n,MISSING_POLICY_ATTRIBUTES:tn,MISSING_POLICY_DEFINITION:Xi,MISSING_POLICY_TYPE:Zi,MISSING_POSITION_ASSIGNMENTS:Fi,MISSING_ROUND_NUMBER:{message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},MISSING_SCHEDULE:Sr,MISSING_SCORING_POLICY:{message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},MISSING_SEED_ASSIGNMENTS:hi,MISSING_SEEDCOUNT_THRESHOLDS:pi,MISSING_SEEDING_POLICY:{message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},MISSING_SET_NUMBER:{message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},MISSING_SET_OBJECT:sn,MISSING_SIDE_NUMBER:{message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},MISSING_STAGE:Ci,MISSING_STRUCTURE_ID:yi,MISSING_STRUCTURE:Pi,MISSING_STRUCTURES:wi,MISSING_TARGET_LINK:Ii,MISSING_TIE_FORMAT:Wi,MISSING_TIME_ITEM:Ir,MISSING_TIME_ITEMS:Ur,MISSING_TOURNAMENT_ID:jt,MISSING_TOURNAMENT_RECORD:Bt,MISSING_TOURNAMENT_RECORDS:Lt,MISSING_VALUE:un,MISSING_VENUE_ID:dr,MODIFICATIONS_FAILED:Pr,NO_CANDIDATES:br,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:er,NO_MODIFICATIONS_APPLIED:Dr,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:Xn,NO_PARTICIPANT_REMOVED:Bn,NO_VALID_ACTIONS:Fr,NO_VALID_ATTRIBUTES:xr,NO_VALID_DATES:pn,NOT_FOUND:Lr,NOT_IMPLEMENTED:Br,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Hn,PARTICIPANT_ID_EXISTS:Ln,PARTICIPANT_NOT_CHECKED_IN:Gn,PARTICIPANT_NOT_FOUND:_n,PARTICIPANT_PAIR_EXISTS:{message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},PENALTY_NOT_FOUND:rr,POLICY_NOT_ATTACHED:{message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},POLICY_NOT_FOUND:an,SCHEDULE_NOT_CLEARED:Jt,SCHEDULED_MATCHUPS:zr,SCORES_PRESENT:Yr,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:ci,STAGE_SEQUENCE_LIMIT:ki,STRUCTURE_NOT_FOUND:Si,TEAM_NOT_FOUND:kr,UNABLE_TO_ASSIGN_COURT:Tr,UNLINKED_STRUCTURES:Di,UNRECOGNIZED_DRAW_TYPE:Zt,UNRECOGNIZED_MATCHUP_FORMAT:Li,UNRECOGNIZED_MATCHUP_STATUS:_i,VALUE_UNCHANGED:_r,VENUE_EXISTS:lr},Jr={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Qr={addNotice:function({topic:e,payload:t,key:i},n){if("string"==typeof e&&"object"==typeof t&&(Jr.disableNotifications||(Jr.modified=!0),!Jr.disableNotifications&&(Jr.subscriptions[e]||n)))return i&&(Jr.notices=Jr.notices.filter((t=>!(t.topic===e&&t.key===i)))),Jr.notices.push({topic:e,payload:t,key:i}),{...At}},callListener:function({topic:e,notices:t},i){let n=Jr.subscriptions[e];n&&"function"==typeof n&&n(t);let r=null==i?void 0:i[e];r&&"function"==typeof r&&r(t)},cycleMutationStatus:function(){let e=Jr.modified;return Jr.modified=!1,e},deleteNotice:function({topic:e,key:t}){Jr.notices=Jr.notices.filter((i=>(!e||i.topic===e)&&i.key!==t))},deleteNotices:function(){Jr.notices=[]},disableNotifications:function(){Jr.disableNotifications=!0},enableNotifications:function(){Jr.disableNotifications=!1},getMethods:Xr,getNotices:function({topic:e}){return Jr.notices.filter((t=>t.topic===e)).map((e=>e.payload))},getTopics:function(){return{topics:Object.keys(Jr.subscriptions)}},getTournamentId:Zr,getTournamentRecord:function(e){return Jr.tournamentRecords[e]},getTournamentRecords:function(){return Jr.tournamentRecords},removeTournamentRecord:function(e){if("string"!=typeof e)return{error:Cr};if(!Jr.tournamentRecords[e])return{error:Lr};delete Jr.tournamentRecords[e];let t=Object.keys(Jr.tournamentRecords);return 1===t.length?Jr.tournamentId=t[0]:t.length||(Jr.tournamentId=void 0),{success:!0}},setMethods:function(e){return"object"!=typeof e?{error:Cr}:(Object.keys(e).forEach((t=>{"function"==typeof e[t]&&(Jr.methods[t]=e[t])})),{...At})},setSubscriptions:function(e){return"object"!=typeof e.subscriptions?{error:Cr}:(Object.keys(e.subscriptions).forEach((t=>{"function"==typeof e.subscriptions[t]?Jr.subscriptions[t]=e.subscriptions[t]:delete Jr.subscriptions[t]})),{...At})},setTournamentId:function(e){return e?Jr.tournamentRecords[e]?(Jr.tournamentId=e,{success:!0}):{error:Bt}:(Jr.tournamentId=void 0,{success:!0})},setTournamentRecord:function(e){let t=null==e?void 0:e.tournamentId;return t?(Jr.tournamentRecords[t]=e,{success:!0}):{error:Vt}},setTournamentRecords:function(e){Jr.tournamentRecords=e;let t=Object.keys(e);1===t.length?Jr.tournamentId=t[0]:t.length||(Jr.tournamentId=void 0)},handleCaughtError:function({engineName:e,methodName:t,params:i,err:n}){let r;return"string"==typeof n?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:Zr(),params:JSON.stringify(i),engine:e,methodName:t,error:r}),{error:r}}};function Zr(){return Jr.tournamentId}function Xr(){return Jr.methods??{}}var ea={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},ta=Qr,ia=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function na(e){if("object"!=typeof e)throw new Error("Global state provider can not be undefined or null");if(dt(Object.keys(e),ia).length!==ia.length)throw new Error("Global state provider is missing required methods");return ta=e,{success:!0}}function ra(){if(ta.createInstanceState){try{ta.createInstanceState()}catch(re){return{error:re}}return{success:!0}}return{error:gr}}function aa(e){return e&&"object"==typeof e?"object"==typeof ea.devContext&&(Object.keys(e).every((t=>{var i;return(null==(i=ea.devContext)?void 0:i[t])===e[t]}))&&ea.devContext):ea.devContext??!1}function oa(e="reset",t="default"){var i,n;let r=Date.now();if("report"===e){if("allTimers"===t)return Object.keys(ea.timers).filter((e=>"default"!==e||ea.timers[e].startTime)).map((e=>{let t=ea.timers[e],i="stopped"===t.state?0:(r-((null==t?void 0:t.startTime)??0))/1e3,n=t.elapsedTime+i;return{state:ea.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}));{let e="stopped"===ea.timers[t].state?0:(r-((null==(i=ea.timers[t])?void 0:i.startTime)??0))/1e3,n=ea.timers[t].elapsedTime+e;return{state:ea.timers[t].state,elapsedTime:n.toFixed(2),timer:t}}}if(!ea.timers[t]||"reset"===e){if("allTimers"===t)return ea.timers={default:{elapsedTime:0}},!0;ea.timers[t]={startTime:r,state:"active",elapsedTime:0}}return ea.timers[t].elapsedTime||(ea.timers[t].elapsedTime=0),"stop"===e&&"stopped"!==ea.timers[t].state&&(ea.timers[t].state="stopped")&&(ea.timers[t].elapsedTime+=(r-((null==(n=ea.timers[t])?void 0:n.startTime)??0))/1e3),"start"===e&&(ea.timers[t].startTime=r)&&(ea.timers[t].state="active"),ea.timers[t]}function sa(e){yt(e)?ea.globalLog=e:delete ea.globalLog}function la(e){ea.devContext=e}function ua(){ta.disableNotifications()}function da(){ta.enableNotifications()}function ca(e,t){"boolean"==typeof e&&(ea.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(ea.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(ea.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(ea.deepCopyAttributes.stringify=t.stringify),t.threshold&&(ea.deepCopyAttributes.threshold=t.threshold))}function pa(){return{enabled:ea.deepCopy,...ea.deepCopyAttributes}}function ma(e){return null!=e&&e.subscriptions?(Object.keys(e.subscriptions).forEach((t=>{ea.globalSubscriptions[t]=e.subscriptions[t]})),{...At}):{error:un,info:"missing subscriptions"}}function fa(e){return null!=e&&e.subscriptions?ta.setSubscriptions({subscriptions:e.subscriptions}):{error:un,info:"missing subscriptions"}}function ha(e){return e?"object"!=typeof e?{error:Cr}:(Object.keys(e).forEach((t=>{yt(e[t])&&(ea.globalMethods[t]=e[t])})),{...At}):{error:un,info:"missing method declarations"}}function va(e){return e?"object"!=typeof e?{error:Cr}:ta.setMethods(e):{error:un,info:"missing method declarations"}}function ga(){return ta.cycleMutationStatus()}function Ia(e){if("string"!=typeof(null==e?void 0:e.topic))return;let t=ea.globalSubscriptions[e.topic];return ta.addNotice(e,t)}function Ua(){return{...ea.globalMethods,...ta.getMethods()}}function ya(e){return ta.getNotices(e)}function Sa({key:e,topic:t}){return ta.deleteNotice({key:e,topic:t})}function wa(){return ta.deleteNotices()}function Pa(){return ta.getTopics()}function Da(e){var t,i;return null==(i=null==(t=Pa())?void 0:t.topics)?void 0:i.includes(e)}async function Ta(e){return ta.callListener(e,ea.globalSubscriptions)}function ba(){return ta.getTournamentId()}function Ra(e){return ta.getTournamentRecord(e)}function Na(){return ta.getTournamentRecords()}function Ma(e){return ta.setTournamentRecord(e)}function Aa(e){return ta.setTournamentRecords(e)}function Ea(e){return ta.setTournamentId(e)}function Ca(e){return ta.removeTournamentRecord(e)}function Oa(){return ta}function ka({engineName:e,methodName:t,params:i,err:n}){let r=yt(ta.handleCaughtError)&&ta.handleCaughtError||Qr.handleCaughtError,{tournamentRecord:a,...o}=i;return r({params:o,engineName:e,methodName:t,err:n})}function Fa(e,t){if(ea.globalLog)try{ea.globalLog({log:e,engine:t})}catch(i){console.log("globalLog error",i),console.log(t,e),sa()}else console.log(t,e)}function xa(e,t,i,n){if(!wt(e))return{error:Cr};qe||(i=1);let r=Array.isArray(t)?t:[],a={},o=(e,n=0)=>{Object.keys(e).forEach((s=>{yt(e[s])?a[s]=e[s]:wt(e[s])&&(!0===t||null!=r&&r.includes(s))&&(void 0===i||n<i)&&o(e[s],n+1)}))};return o(e),n?ha(a):va(a),{methods:a}}function _a(e,t,i,n){var r;if("object"!=typeof e||null===e)return e;null!=(r=pa())&&r.enabled||(n=!0);let a=["",void 0,null];t&&a.push(!1);let o=function(e,t,i){return Object.keys(e).filter((n=>!t.includes(e[n])&&(!i||!Array.isArray(e[n])||e[n].length)))}(e,a,i);return Object.assign({},...o.map((t=>Array.isArray(e[t])?{[t]:n?e[t]:e[t].map((e=>_a(e)))}:{[t]:n?e[t]:_a(e[t])})))}function La({context:e,result:t,stack:i,info:n}){return t&&!Array.isArray(null==t?void 0:t.stack)&&(t.stack=[]),t&&Array.isArray(null==t?void 0:t.stack)&&"string"==typeof i&&t.stack.push(i),t&&n&&(t.info=n),t&&"object"==typeof e&&Object.keys(e).length&&Object.assign(t,_a(e)),t&&!(null!=t&&t.error)&&!(null!=t&&t.success)&&Object.assign(t,{...At}),t??{success:!0}}var Ba="ANY",Va="MALE",ja="MIXED",Ga="OTHER",$a="FEMALE",qa={ANY:Ba,MALE:Va,FEMALE:$a,MIXED:ja,OTHER:Ga},Wa="MIXED events can not contain mixed singles or { gender: ANY } collections",Ha="events with { gender: ANY } can not contain MIXED singles collections";function za(e){let t="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=e;return i&&r&&[Va,$a].includes(i)&&i!==r?La({result:{valid:!1,error:Ar},context:{gender:r},stack:t}):i===ja&&(r===Ba||r===ja&&n!==Oe)?La({result:{error:Ar,valid:!1},info:Wa,stack:t}):i===Ba&&r===ja&&n!==Oe?La({result:{error:Ar,valid:!1},info:Ha,stack:t}):{valid:!0}}var Ya="timed",Ka="NOAD",Ja="SET",Qa={S:"normal",F:"final"};function Za(e,t){if((null!=e&&e.bestOf||null!=e&&e.exactly)&&null!=e&&e.setFormat)return function(e,t){var i;let n=Xa(e.bestOf)||void 0,r=Xa(e.exactly)||void 0,a=n||r;if(null!=(i=e.setFormat)&&i.timed&&e.simplified&&1===a)return eo(e.setFormat);let o=a&&`${Ja}${a}`||"",s=to(e.setFormat,t),l=s&&`S:${s}`||"",u=to(e.finalSetFormat,t),d=a&&a>1&&u&&s!==u&&`F:${u}`||"";if(o&&s)return[o,l,d].filter((e=>e)).join("-")}(e,t)}function Xa(e){return!isNaN(Number(e))&&Number(e)}function eo(e){let t=`T${e.minutes}`;return e.based&&(t+=e.based),e.modifier&&(t+=`@${e.modifier}`),t}function to(e,t){if("object"==typeof e&&Object.keys(e).length){if(e.timed)return eo(e);if(e.tiebreakSet)return io(e.tiebreakSet);let i=Xa(e.setTo);if(i){let n=e.NoAD&&Ka||"",r=io(e.tiebreakFormat),a=r&&`/${r}`||"",o=Xa(e.tiebreakAt);if(!1!==r)return`${i}${n}${a}${o&&(o!==i||t)&&`@${o}`||""}`}}}function io(e){if(e){if("object"==typeof e&&!e.tiebreakTo)return"";if("object"==typeof e&&Xa(e.tiebreakTo)){let t=`TB${e.tiebreakTo}${e.NoAD?Ka:""}`;return e.modifier&&(t+=`@${e.modifier}`),t}return!1}}function no(e){if(St(e)){let t=e.startsWith("T")&&Ya||e.startsWith(Ja)&&Ja||"";if(t===Ya){let t=so(e);if(t)return{simplified:!0,setFormat:t,bestOf:1}}if(t===Ja)return function(e){let t=e.split("-"),i=uo(t[0].slice(3)),n=1===i||i%2!=0?i:void 0,r=1!==i&&i%2==0?i:void 0,a=t&&ro(t[1]),o=t&&ro(t[2]),s=a&&a.timed||o&&o.timed,l=n&&n<6||s&&r,u=!t[2]||o,d=a,c=_a({setFormat:a,exactly:r,bestOf:n});if(o&&(c.finalSetFormat=o),l&&d&&u)return c}(e)}}function ro(e){if(":"===(null==e?void 0:e[1])){let t=e.split(":"),i=Qa[t[0]],n=t[1];if(i&&n){if(n.startsWith("TB")){let e=oo(n);return!1!==e&&("object"==typeof e?{tiebreakSet:e}:void 0)}if(n.startsWith("T"))return so(n);let t=e.match(/^[FS]:(\d+)([A-Za-z]*)/),i=t&&lo(t[2])||!1,r=!(null!=t&&t[2])||i,a=t?uo(t[1]):void 0,o=ao(n),s=!1!==o,l=s&&o||a,u=oo(n.split("/")[1]),d=!1!==u,c={setTo:a};return i&&(c.NoAD=!0),u?(c.tiebreakFormat=u,c.tiebreakAt=l):c.noTiebreak=!0,a&&r&&d&&s&&c||!1}}}function ao(e,t=!0){let i=(null==e?void 0:e.indexOf("@"))>0&&e.split("@");if(i)return(t?uo(i[1]):i[1])||!1}function oo(e){if(e){if(e.startsWith("TB")){let t=ao(e,!1),i=e.match(/^TB(\d+)([A-Za-z]*)/),n=null==i?void 0:i[1],r=i&&lo(i[2]),a=!(null!=i&&i[2])||r,o=uo(n);if(o&&a){let e={tiebreakTo:o};return t&&"string"==typeof t&&!Ye(t)&&(e.modifier=t),r&&(e.NoAD=!0),e}return!1}return!1}}function so(e){var t;let i=e.slice(1),n=i.match(/^(\d+)(@?[A-Za-z]*)/),r=uo(null==n?void 0:n[1]);if(!r)return;let a={timed:!0,minutes:r},o=null==n?void 0:n[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let e=null==(t=i.match(/^(\d+)(@)([A-Za-z]+)$/))?void 0:t[3];return e?(a.modifier=e,a):void 0}return o&&(a.based=n[2]),a}function lo(e){return e&&e.indexOf(Ka)>=0}function uo(e){return isNaN(Number(e))?0:Number(e)}function co({matchUpFormat:e}){if(!St(e)||""===e)return!1;let t=no(e),i=e.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=null==i?void 0:i[1],r=null==i?void 0:i[2],a=null==i?void 0:i[3],o=e.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=null==o?void 0:o[1],l=null==o?void 0:o[2],u=null==o?void 0:o[3];return Za(t,!!(i&&r&&n===a||o&&l&&s===u))===e}var po=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,mo=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,fo=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,ho=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function vo(e){let{scheduledDate:t}=e;if(!t&&e.scheduledTime&&(t=Eo(e.scheduledTime)),!t)return;let i=Ao(e.scheduledTime),n=Eo(t);return n&&i&&(n+=`T${i}`),n}function go(e){return"object"==typeof e&&!Array.isArray(e)&&"[object Date]"===Object.prototype.toString.call(e)}function Io(e){let t="string"==typeof e?null==e?void 0:e.split(" "):[];return!(e&&(null==t?void 0:t.length)>1&&!["AM","PM"].includes(t[1].toUpperCase()))&&!(e&&!ho.test(ko(e,!0,!0)))}function Uo(e){return bo(e)||po.test(e)}var yo=e=>{let t=Po(e)||bo(e)?new Date(e):new Date,i=t.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${t.getUTCFullYear()}-${jo(n)}-${jo(t.getUTCDate())}`};function So(e,t="-",i="YMD"){if(!e)return"";"string"==typeof e&&e.indexOf("T")<0&&(e+="T00:00");let n=new Date(e),r=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),"DMY"===i?[a,r,o].join(t):"MDY"===i?[r,a,o].join(t):"YDM"===i?[o,a,r].join(t):"DYM"===i?[a,o,r].join(t):"MYD"===i?[r,o,a].join(t):[o,r,a].join(t)}function wo(e){let t=e?new Date(e):new Date,i=t.getTimezoneOffset();return new Date(t.getTime()-60*i*1e3)}function Po(e){if("boolean"==typeof e)return!1;let t=e instanceof Date&&e||!isNaN(e)&&new Date(e)||!1;return t&&!isNaN(t.valueOf())}function Do(e,t){if(!Uo(e)||!Uo(t))return[];let i=Eo(e)+"T00:00",n=Eo(t)+"T00:00",r=new Date(i),a=new Date(n),o=[],s=0;if(Po(a)&&Po(r)&&r<=a){let e=r,t=e.getTime();for(;t<=a.getTime()&&s<300;)s+=1,o.push(new Date(e)),t=e.setDate(e.getDate()+1)}return o.map((e=>So(e)))}var To=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function bo(e){return"string"==typeof e&&To.test(e)}function Ro(e){if("string"!=typeof e)return!1;let t=e.split("Z")[0].split(":"),i=t.every((e=>!isNaN(parseInt(e))));return!(t.length<2||!i||parseInt(t[0])>23||parseInt(t[1])>60)}function No(e){let t=Ao(e);if(!t)return 0;let[i,n]=t.split(":").map((e=>parseInt(e)));return 60*i+n}function Mo(e){return Ro(e)?e.split(":").slice(0,2).map(jo).join(":"):void 0}function Ao(e){return bo(e)&&e.indexOf("T")>0?Mo(e.split("T").reverse()[0]):Mo(e)}function Eo(e){return bo(e)||fo.test(e)?e.split("T")[0]:void 0}function Co(e,t){let i=new Date(e);return i.setDate(i.getDate()+t),Eo(i.toISOString())}function Oo(e){e="string"!=typeof e?"00:00":e;let t={},i={};return({0:t.time,1:t.ampm}=e.split(" ")||[]),({0:i.hours,1:i.minutes}=t.time.split(":")||[]),i.ampm=t.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function ko(e,t,i){let n=Eo(e),r=Ao(e),a=n?r:e;return e?t&&(n&&i&&e||function(e){let t=Oo(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&parseInt(t.hours)<12&&(t.hours=(t.hours&&parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),`${t.hours||"12"}:${t.minutes||"00"}`.split(":").map(jo).join(":")}(a))||function(e){var t;let i=Oo(e);if("object"!=typeof i||Object.keys(i).length)return i.ampm?e:(i.hours>12?(i.hours-=12,i.ampm="PM"):"12"===i.hours?i.ampm="PM":("00"===i.hours&&(i.hours="12"),i.ampm="AM"),"0"===(null==(t=i.hours)?void 0:t[0])&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}(a):void 0}function Fo(e,t){let i=Oo(e),n=Oo(t);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function xo(e,t=7){let i=Eo(e)+"T00:00",n=new Date(i);return So(new Date(n.setDate(n.getDate()+t)))}function _o(e,t=void 0){let[i,n]=(e||"00:00").split(":").map(jo),r=wo(t).setHours(i,n,0,0);return wo(r)}function Lo(e,t,i=!0){let n=new Date(e),r=(new Date(t).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function Bo(e,t){let i=Ao(e);if(!i)return"00:00";let n=isNaN(t)?0:t;return Ao(Vo(_o(i),n).toISOString())}function Vo(e,t){let i=new Date(e);return new Date(i.getTime()+6e4*t)}function jo(e){return e.toString()[1]?e:"0"+e}function Go(e,t){let i=new Date(e),n=new Date(t);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var $o={addDays:xo,addWeek:function(e){return xo(e)},addMinutesToTimeString:Bo,convertTime:ko,getIsoDateString:vo,getUTCdateString:yo,DateHHMM:function(e){let t=new Date(e);return function(e,t){let i=parseInt(e,10),n=Math.floor(i/3600),r=Math.floor((i-3600*n)/60),a=i-3600*n-60*r;return(!t||null!=t&&t.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(jo).join(":")}(t.getSeconds()+60*t.getMinutes()+3600*t.getHours(),{displaySeconds:!1})},extractDate:Eo,extractTime:Ao,formatDate:So,getDateByWeek:function(e,t,i,n=!1){let r=new Date(t,0,1+7*(e-1)),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),So(r,i)},isISODateString:bo,isDate:Po,isTimeString:Ro,offsetDate:wo,offsetTime:function(e){return wo(e).getTime()},sameDay:Go,timeStringMinutes:No,timeToDate:_o,timeUTC:function(e){let t=Po(e)||bo(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},validTimeValue:Io,validDateString:po,timeValidation:ho,dateValidation:fo},qo=(e,t)=>e.filter(Boolean).every((e=>typeof e===t)),Wo=e=>e.filter(Boolean).every(qe);function Ho(e){let t=e.category;if("object"!=typeof t)return{error:Er};let i,{ageCategoryCode:n,ageMaxDate:r,ageMinDate:a,ageMax:o,ageMin:s}=t,l=t.categoryName;if(!qo([n,r,a,l],"string")||!Wo([o,s]))return{error:Er};let u=e.consideredDate??Eo((new Date).toLocaleDateString("sv"));if(!Uo(u))return{error:vn};let[d]=u.split("-").slice(0,3).map((e=>parseInt(e))),c=Co(u,-1),[p,m]=c.split("-").slice(1,3).map((e=>parseInt(e))),f=`${jo(p)}-${jo(m)}`,h=Co(u,1),[v,g]=h.split("-").slice(1,3).map((e=>parseInt(e))),I=`${jo(v)}-${jo(g)}`,U=s&&Co(u,-365*s),y=o&&Co(u,-365*o),S=[],w=e=>!S.includes(e)&&S.push(e);n=n??l;let P=/^([UO]?)(\d{1,2})([UO]?)$/,D=/^C(\d{1,2})-(\d{1,2})$/,T=null==n?void 0:n.includes("-"),b=T&&(null==n?void 0:n.match(D)),R=null==n?void 0:n.match(P),N=(e,t)=>`${e}-${t}`,M=e=>{let i=N(d-e-1,I);t.ageMin&&t.ageMin>e&&w(`Invalid submitted ageMin: ${s}`),t.ageMax&&t.ageMax>e&&w(`Invalid submitted ageMax: ${o}`),t.ageMinDate&&t.ageMinDate!==i&&w(`Invalid submitted ageMinDate: ${a}`),a=i,n&&(t.ageMax&&t.ageMax!==e&&(w(`Invalid submitted ageMax: ${o}`),U=void 0),o=e)},A=e=>{let i=N(d-e,f);t.ageMaxDate&&t.ageMaxDate!==i&&w(`Invalid submitted ageMaxDate: ${r}`),r=i,n&&(t.ageMin&&t.ageMin!==e+1&&(w(`Invalid submitted ageMin: ${s}`),U=void 0),s=e+1)},E=e=>{let[i,l,u]=(e.match(P)||[]).slice(1),c=parseInt(l);"U"===i?(t.ageMaxDate&&t.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),(e=>{let i=N(d-e,I);t.ageMinDate&&t.ageMinDate!==i&&w(`Invalid submitted ageMinDate: ${a}`),a=i,n&&(t.ageMax&&t.ageMax!==e-1&&(w(`Invalid submitted ageMax: ${o}`),y=void 0),o=e-1)})(c)):"O"===i&&A(c),"U"===u?(t.ageMaxDate&&t.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),M(c)):"O"===u&&(e=>{let i=N(d-e-1,f);t.ageMaxDate&&t.ageMaxDate!==i&&w(`Invalid submitted ageMaxDate: ${r}`),r=i,n&&(t.ageMin&&t.ageMin!==e&&(w(`Invalid submitted ageMin: ${s}`),U=void 0),s=e)})(c),r=r??U,a=a??y};if(b){if(r=void 0,a=void 0,o=void 0,s=void 0,t.ageMin){let e=d-t.ageMin;r=N(e,f)}if(t.ageMax){let e=d-t.ageMax-1;a=N(e,I)}let[e,l]=((null==n?void 0:n.match(D))??[]).slice(1).map((e=>parseInt(e)));e<=l?(s=e,o=l,i=!0):w(`Invalid combined age range ${n}`)}else T?null==n||n.split("-").forEach(E):R?E(n):(s&&A(s),o&&M(o));o&&t.ageMin&&t.ageMin>o&&(w(`Invalid submitted ageMin: ${t.ageMin}`),s=void 0);let C=_a({consideredDate:u,combinedAge:i,ageMaxDate:r,ageMinDate:a,ageMax:o,ageMin:s});return S.length&&(C.errors=S),C}function zo({category:e}){if(!wt(e))return{error:Cr};let t=Ho({category:e});if(t.error)return{error:t};let{ratingMax:i,ratingMin:n}=e;return i&&!qe(i)?La({result:{error:Cr},context:{ratingMax:i}}):n&&!qe(n)?La({result:{error:Cr},context:{ratingMin:n}}):{...t}}function Yo({childCategory:e,withDetails:t,category:i}){let n=zo({category:i}),r=zo({category:e}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),o=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),u=(null==i?void 0:i.ratingType)&&(null==e?void 0:e.ratingType)&&i.ratingType===e.ratingType&&(i.ratingMin&&e.ratingMin&&e.ratingMin<i.ratingMin||i.ratingMax&&e.ratingMax&&e.ratingMax>i.ratingMax||i.ratingMin&&e.ratingMax&&e.ratingMax<i.ratingMin||i.ratingMax&&e.ratingMin&&e.ratingMin>i.ratingMax),d=(null==i?void 0:i.ballType)&&(null==e?void 0:e.ballType)&&i.ballType!==e.ballType,c=_a({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:d,invalidAgeMax:o,invalidAgeMin:a,valid:!(u||s||l||d||o||a)},!0);return t&&Object.assign(c,{categoryDetails:n,childCategoryDetails:r}),c}function Ko({checkCategory:e=!0,collectionDefinition:t,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:o}){a=a??(null==o?void 0:o.gender);let s="validateCollectionDefinition",l=[];if("object"!=typeof t)return l.push(`collectionDefinition must be an object: ${t}`),La({result:{errors:l,error:Mr},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:d,collectionValue:c,collectionId:p,matchUpCount:m,matchUpFormat:f,matchUpValue:h,matchUpType:v,scoreValue:g,setValue:I,category:U,gender:y}=t;if(i&&"string"!=typeof p&&l.push(`collectionId is not type string: ${p}`),"number"!=typeof m&&l.push(`matchUpCount is not type number: ${m}`),v&&!Mt([Ee,Oe],v)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${v}`),1!==[!(null==u||!u.length)].concat([h,c,g,I].map(Ye)).filter(Boolean).length&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&"number"!=typeof h&&l.push(`matchUpValue is not type number: ${h}`),c&&"number"!=typeof c&&l.push(`collectionValue is not type number: ${c}`),u&&m){let e=Ot({collectionValueProfiles:u,matchUpCount:m});e.errors&&l.push(...e.errors)}if(d&&"number"!=typeof d&&l.push(`collectionGroupNumber is not type number: ${c}`),f&&!co({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let e=za({referenceGender:a,matchUpType:v,gender:y});if(e.error)return La({context:{referenceGender:a,gender:y},result:e,stack:s})}if(e&&r&&U){let e=Yo({category:r,childCategory:U});if(!e.valid)return La({result:{error:Er},context:e,stack:s})}return l.length?La({result:{errors:l,error:Nr},stack:s}):{valid:!0}}function Jo(e){var t,i,n,r;let a=!(!1===(null==e?void 0:e.enforceCategory)||null==e||!e.category),o=!(!1===(null==e?void 0:e.enforceGender)||null==e||!e.gender),s=null==e?void 0:e.checkCollectionIds,l=null==e?void 0:e.tieFormat,u=null==e?void 0:e.event,d="validateTieFormat",c=[],p=function(e){let{tieFormat:t,stack:i}=e;return e&&t&&wt(t)?wt(t.winCriteria)?Array.isArray(t.collectionDefinitions)?{...At}:La({result:{error:ji},context:{tieFormat:t,message:"collectionDefinitions must be an array"},stack:i}):La({result:{error:ji},context:{tieFormat:t,message:"tieformat.winCritiera must be an object"},stack:i}):La({result:{error:ji},context:{tieFormat:t,message:"tieformat must be an object"},stack:i})}({...e,stack:d});if(null!=p&&p.error)return p;let m,f=l.collectionDefinitions.every((t=>{let{setValue:i,scoreValue:n,collectionValue:r}=t;(i||n)&&!r&&(m=!0);let{valid:l,errors:d}=Ko({referenceCategory:e.category,referenceGender:e.gender,collectionDefinition:t,checkCollectionIds:s,checkCategory:a,checkGender:o,event:u});return!!l||(Array.isArray(d)&&c.push(...d),!1)})),h="number"==typeof(null==(t=l.winCriteria)?void 0:t.valueGoal)&&(null==(i=l.winCriteria)?void 0:i.valueGoal)>0&&!m||(null==(n=l.winCriteria)?void 0:n.aggregateValue);if(!(h||null!=(r=l.winCriteria)&&r.aggregateValue))return m?c.push("aggregateValue is required"):c.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),La({context:{tieFormat:l,errors:c,aggregateValueImperative:m},result:{error:ji},stack:d});let v=l.collectionDefinitions.map((({collectionId:e})=>e)),g=!s||v.length===Qe(v).length,I=f&&h&&g;return I?{valid:I,errors:c}:La({result:{error:ji},context:{tieFormat:l,errors:c},stack:d})}var Qo="resourceSubType",Zo="resourceType",Xo="identifier",es={RESOURCE_SUB_TYPE:Qo,RESOURCE_TYPE:Zo,IDENTIFIER:Xo};function ts(e,t,i,n,r=0){if(Oa().makeDeepCopy)return Oa().makeDeepCopy(e,t,i,n);let a=pa(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if((null==a||!a.enabled)&&!i||"object"!=typeof e||yt(e)||null===e||"number"==typeof(null==a?void 0:a.threshold)&&r>=a.threshold)return e;let d=Array.isArray(e)?[]:{},c=Object.keys(e).filter((e=>!i||!l||Array.isArray(l)&&!l.includes(e)||yt(l)&&!l(e))),p=(e,t)=>{d[e]=yt(null==t?void 0:t.toString)?t.toString():JSON.stringify(t)};for(let m of c){let a=e[m],l=yt(u)?u(a):void 0;if(void 0!==l)d[m]=l;else if(t&&"extensions"===m&&Array.isArray(a)){let e=is(a);Object.assign(d,...e)}else n&&"extensions"===m?d[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,a):Array.isArray(s)&&s.includes(m)&&yt(null==a?void 0:a.toJSON)?d[m]=a.toJSON():null===a?d[m]=void 0:go(a)?d[m]=new Date(a).toISOString():d[m]=ts(a,t,i,n,r+1)}return d}function is(e){return null==e?void 0:e.map((e=>{let{name:t,value:i}=e;return t&&i&&{[`_${t}`]:i}})).filter(Boolean)}function ns(e=1,t){return lt(0,e).map((()=>rs(t)))}function rs(e){let t=[];for(let s=0;s<256;s++)t[s]=(s<16?"0":"")+s.toString(16);let i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,a=4294967295*Math.random()|0,o=t[255&i]+t[i>>8&255]+t[i>>16&255]+t[i>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&r|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[255&a]+t[a>>8&255]+t[a>>16&255]+t[a>>24&255];return"string"==typeof e?`${e}_${o.replace(/-/g,"")}`:o}var as={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},os={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},ss={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},ls={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},us={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},ds={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},cs={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},ps={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},ms={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},fs={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},hs="SET3-S:6/TB7",vs="SET3-S:6/TB7-F:TB10",gs={FORMAT_STANDARD:hs,FORMAT_STANDARD_NOAD:"SET3-S:6NOAD",FORMAT_ATP_DOUBLES:vs,FORMAT_SHORT_SETS:"SET3-S:4/TB7",FORMAT_FAST4:"SET3-S:4/TB5@3",FORMAT_PRO_SET:"SET1-S:8/TB7",FORMAT_COLLEGE_PRO_SET:"SET1-S:8/TB7@7",TIMED20:"SET1-S:T20"},Is={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Us={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},ys={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Ss={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},ws={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Ps={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Ds={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},Ts="COLLEGE_DEFAULT",bs="COLLEGE_JUCO",Rs="COLLEGE_D3",Ns="DOMINANT_DUO",Ms="DOMINANT_DUO_MIXED",As="LAVER_CUP",Es="TEAM_DOUBLES_3_AGGREGATION",Cs="TIME_TENNIS_DUAL",Os="TIME_TENNIS_PRO_CIRCUIT",ks="USTA_BREWER_CUP",Fs="USTA_OZAKI_CUP",xs="USTA_COLLEGE",_s="USTA_GOLD_TEAM_CHALLENGE",Ls="USTA_LEVEL_1",Bs="USTA_INTERSECTIONAL",Vs="USTA_SECTION_BATTLE",js="USTA_SOUTHERN_LEVEL_5",Gs="USTA_TOC",$s="USTA_WTT_ITT",qs="USTA_ZONAL",Ws={COLLEGE_D3:Rs,COLLEGE_DEFAULT:Ts,COLLEGE_JUCO:bs,DOMINANT_DUO:Ns,DOMINANT_DUO_MIXED:Ms,LAVER_CUP:As,TEAM_DOUBLES_3_AGGREGATION:Es,TIME_TENNIS_DUAL:Cs,TIME_TENNIS_PRO_CIRCUIT:Os,USTA_BREWER_CUP:ks,USTA_OZAKI_CUP:Fs,USTA_COLLEGE:xs,USTA_GOLD_TEAM_CHALLENGE:_s,USTA_INTERSECTIONAL:Bs,USTA_LEVEL_1:Ls,USTA_SECTION_BATTLE:Vs,USTA_SOUTHERN_LEVEL_5:js,USTA_TOC:Gs,USTA_WTT_ITT:$s,USTA_ZONAL:qs},Hs="STANDARD",zs={[Hs]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[Rs]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:hs,matchUpCount:6,matchUpValue:1},tieFormatName:Rs,valueGoal:5},[Ts]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:hs,matchUpCount:6,matchUpValue:1},tieFormatName:Ts,valueGoal:4},[bs]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:hs,matchUpCount:6,matchUpValue:1},tieFormatName:bs,valueGoal:5},[As]:Ps,[Ns]:Is,[Ms]:cs,[Es]:os,[Cs]:ps,[Os]:ds,[ks]:ms,[Fs]:fs,[xs]:Us,[_s]:as,[Bs]:us,[Ls]:ys,[Vs]:ls,[js]:ss,[$s]:Ss,[Gs]:Ds,[qs]:ws},Ys=e=>{let t,i=null!=e&&e.namedFormat&&Object.keys(zs).includes(e.namedFormat)?e.namedFormat:Hs,n=Array.isArray(null==e?void 0:e.uuids)?null==e?void 0:e.uuids:[],{category:r,gender:a}=(null==e?void 0:e.event)??{},o=ts(zs[i],!1,!0),s=t=>{var i,r;if(!((null!=e&&e.isMock||null!=(i=null==e?void 0:e.event)&&i.isMock)&&e.event))return(null==n?void 0:n.pop())??rs();let a=null==(r=null==e?void 0:e.event)?void 0:r.eventId;return n.pop()??`${a}-COL-${t+1}`};return o.hydrate?(t={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:vs,collectionName:"Doubles",matchUpType:Oe,...o.doubles},{collectionId:s(1),matchUpFormat:hs,collectionName:"Singles",matchUpType:Ee,...o.singles}]},o.tieFormatName&&(t.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach(((e,t)=>e.collectionId=s(t))),t=o),null!=e&&e.hydrateCollections&&t.collectionDefinitions.forEach((e=>{r&&!e.category&&(e.category=r),a&&!e.gender&&(e.gender=a)})),t},Ks="SINGLES",Js="SINGLES",Qs="DOUBLES",Zs="DOUBLES",Xs="TEAM",el="TEAM",tl={AGE:"AGE",BOTH:"BOTH",DOUBLES:Qs,DOUBLES_EVENT:Zs,RATING:"RATING",SINGLES:Ks,SINGLES_EVENT:Js,TEAM_EVENT:el,TEAM:Xs},il="MAIN",nl="QUALIFYING",rl="CONSOLATION",al="VOLUNTARY_CONSOLATION",ol="PLAY_OFF",sl=[il,nl,rl,ol,al],ll={[nl]:1,[il]:2,[ol]:3,[rl]:3,[al]:4},ul="finishingPositions",dl="aggregateEventStructures",cl={[il]:1,[ol]:2,[rl]:3,[nl]:4,[al]:5},pl={[ol]:1,[il]:2,[rl]:3,[nl]:4,[al]:5},ml="CLUSTER",fl="WATERFALL",hl="ITEM",vl="CONTAINER",gl="DRAW",Il="RANDOM",Ul="TOP_DOWN",yl="BOTTOM_UP",Sl="POSITION",wl="WINNER",Pl="LOSER",Dl="FIRST_MATCHUP",Tl="AD_HOC",bl="FEED_IN",Rl="COMPASS",Nl="OLYMPIC",Ml="SINGLE_ELIMINATION",Al="DOUBLE_ELIMINATION",El="FIRST_MATCH_LOSER_CONSOLATION",Cl="FIRST_ROUND_LOSER_CONSOLATION",Ol="LUCKY_DRAW",kl="CURTIS_CONSOLATION",Fl="CURTIS_CONSOLATION",xl="FEED_IN_CHAMPIONSHIP_TO_SF",_l="FEED_IN_CHAMPIONSHIP_TO_SF",Ll="FEED_IN_CHAMPIONSHIP_TO_QF",Bl="FEED_IN_CHAMPIONSHIP_TO_QF",Vl="FEED_IN_CHAMPIONSHIP_TO_R16",jl="FEED_IN_CHAMPIONSHIP_TO_R16",Gl="MODIFIED_FEED_IN_CHAMPIONSHIP",$l="MODIFIED_FEED_IN_CHAMPIONSHIP",ql="FEED_IN_CHAMPIONSHIP",Wl="DOUBLE_ROUND_ROBIN",Hl="ROUND_ROBIN",zl="ROUND_ROBIN_WITH_PLAYOFF",Yl="DECIDER",Kl="BACKDRAW",Jl={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Ql={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Zl="WIN_RATIO",Xl="ROUND_OUTCOME",eu=[Rl,kl,Bl,jl,_l,ql,Ll,Vl,xl,El,Cl,Ol,$l,Nl,ol,zl],tu={MAIN:il,QUALIFYING:nl,CONSOLATION:rl,ITEM:hl,CONTAINER:vl,FIRST_MATCHUP:Dl,WINNER:wl,LOSER:Pl,AD_HOC:Tl,FEED_IN:bl,FLEX_ROUNDS:"AD_HOC",COMPASS:Rl,PLAY_OFF:ol,OLYMPIC:Nl,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:Ml,DOUBLE_ELIMINATION:Al,CURTIS:kl,FICSF:xl,FICQF:Ll,FICR16:Vl,MFIC:Gl,VOLUNTARY_CONSOLATION:al,FIRST_MATCH_LOSER_CONSOLATION:El,FIRST_ROUND_LOSER_CONSOLATION:Cl,MODIFIED_FEED_IN_CHAMPIONSHIP:$l,FEED_IN_CHAMPIONSHIP_TO_R16:jl,FEED_IN_CHAMPIONSHIP_TO_QF:Bl,FEED_IN_CHAMPIONSHIP_TO_SF:_l,FEED_IN_CHAMPIONSHIP:ql,LUCKY_DRAW:Ol,ROUND_ROBIN_WITH_PLAYOFF:zl,ROUND_ROBIN:Hl,DECIDER:Yl,BACKDRAW:Kl,COMPASS_ATTRIBUTES:Jl,OLYMPIC_ATTRIBUTES:Ql,DRAW:gl,RANDOM:Il,TOP_DOWN:Ul,BOTTOM_UP:yl,WATERFALL:fl,WIN_RATIO:Zl,ROUND_OUTCOME:Xl,MULTI_STRUCTURE_DRAWS:eu,generatedDrawTypes:[Tl,Rl,kl,Al,Bl,jl,_l,ql,bl,El,Cl,Ol,$l,Nl,ol,Hl,zl,Ml],stageOrder:ll,finishOrder:cl,AGGREGATE_EVENT_STRUCTURES:dl,FINISHING_POSITIONS:ul},iu=tu,nu="tournamentRecords",ru="policyDefinitions",au="tournamentRecord",ou="onlineResource",su="drawDefinition",lu="tieFormatName",uu="matchUpFormat",du="participantId",cu="scheduleDates",pu="structureId",mu="participant",fu="matchUpIds",hu="entryStage",vu="structures",gu="eventType",Iu="matchUpId",Uu="tieFormat",yu="inContext",Su="structure",wu="courtIds",Pu="venueIds",Du="matchUps",Tu="courtId",bu="eventId",Ru="matchUp",Nu="drawId",Mu="error",Au="event",Eu="param",Cu="uuids",Ou="object",ku="array",Fu="_validate",xu="_message",_u="_invalid",Lu="_ofType",Bu="_anyOf",Vu="_oneOf",ju={[ou]:e=>3===dt(Object.keys(e),[Qo,Zo,Xo]).length,[lu]:e=>e&&Ys({namedFormat:e}),[Cu]:e=>!e||Array.isArray(e)&&e.every(St),[Uu]:e=>!Jo({tieFormat:e}).error,[gu]:e=>[Ks,Qs,Xs].includes(e),[hu]:e=>sl.includes(e)},Gu={[nu]:Lt,[au]:Bt,[ru]:Xi,[su]:$t,[du]:xn,[uu]:$i,tournamentId:jt,[pu]:yi,[fu]:zi,[mu]:kn,[ou]:Mr,[gu]:Ti,[vu]:wi,[Iu]:Hi,[Uu]:ji,[Su]:Pi,[Tu]:ln,[Du]:Ki,[bu]:Ri,[Ru]:Ji,[wu]:un,[Pu]:un,[Nu]:li,[Au]:bi},$u={[nu]:Ou,[ru]:Ou,[au]:Ou,[su]:Ou,[ou]:Ou,[cu]:ku,[mu]:Ou,[fu]:ku,[vu]:ku,[Uu]:Ou,[Su]:Ou,[wu]:ku,[Pu]:ku,[Du]:ku,[Ru]:Ou,[Au]:Ou,[Cu]:ku};function qu(e,t,i){if(!e&&!wt(e))return{error:Cr};if(null==t||!t.length||null!=e&&e._bypassParamCheck)return{valid:!0};if(!Array.isArray(t))return{error:Cr};let{paramError:n,errorParam:r}=function(e,t){let i,n;return{paramError:t.find((({_ofType:t,_oneOf:r,_anyOf:a,_validate:o,_info:s,...l})=>{let u=r&&function(e,t){if(!t)return;let i=Wu(e,t);return 1!==i.length?{error:Cr}:i.reduce(((e,t)=>({...e,[t]:!0})),{})}(e,r);if(null!=u&&u.error)return u.error;u&&Object.assign(l,u);let d=a&&function(e,t){if(!t)return;let i=Wu(e,t).filter((t=>e[t]));return i.length<1?{error:Cr}:i.reduce(((e,t)=>({...e,[t]:!0})),{})}(e,a);if(null!=d&&d.error)return d.error;d&&Object.assign(l,d);let c=Object.keys(l).filter((e=>"boolean"==typeof l[e])),p=c.find((r=>{let a=o&&!yt(o),u=void 0!==e[r]&&!o&&function(e,t,i){return i=i||$u[t]||"string","array"===i?!Array.isArray(e[t]):typeof e[t]!==i}(e,r,t),d=l[r]&&[void 0,null].includes(e[r]),c=a||u||d||o&&void 0!==e[r]&&!function(e,t){return!yt(t)||t(e)}(e[r],o)||ju[r]&&!ju[r](e[r]);return c&&(i=r,n=s),c}));return!c.length||p})),errorParam:i,paramInfo:n}}(e,t);if(!n)return{valid:!0};let a=n[Fu]&&(n[Mu]||n[_u])||void 0===(null==e?void 0:e[r])&&(n[Mu]||n[_u]||Gu[r]||Cr)||Cr;return La({info:{param:r??(n[Vu]&&Object.keys(n[Vu]).join(", ")),message:n[xu]},result:{error:a},stack:i})}function Wu(e,t){return dt(Object.keys(e),Object.keys(t))}var Hu="DYNAMIC",zu="RANKING",Yu="RATING",Ku="SCALE",Ju="SEEDING",Qu={RANKING:zu,RATING:Yu,SCALE:Ku,SEEDING:Ju};function Zu(e){var t;let i=qu(e,[{[mu]:!0}]);if(i.error)return i;let n=null==(t=e.participant.timeItems)?void 0:t.filter((({itemType:e})=>(null==e?void 0:e.startsWith(Ku))&&[zu,Yu,Ju].includes(e.split(".")[1]))),r={ratings:{},rankings:{},seedings:{}};if(null!=n&&n.length){let e=e=>n.filter((t=>(null==t?void 0:t.itemType)===e)).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())).pop(),t=Qe(n.map((({itemType:e})=>e)));for(let i of t){let t=e(i);if(t){let[,e,i,n,a]=t.itemType.split("."),o=a?`${n}.${a}`:n,s=(e===Ju?"seedings":e===zu&&"rankings")||"ratings";r[s][i]||(r[s][i]=[]),r[s][i].push({scaleValue:t.itemValue,scaleDate:t.itemDate,scaleName:o})}}}return{...At,...r}}function Xu(e){if(null===e)return{};let{source:t,template:i}=e||{};if(!i)return t;let n={};return function e(t,i,n){if(!t||!i)return;let r=Object.keys(t),a=Object.keys(i),o=Object.assign({},...a.filter((e=>e.indexOf("||"))).map((e=>e.split("||").map((t=>({[t]:e}))))).flat()),s=a.concat(...Object.keys(o)),l=s.includes("*");for(let u of r)if(s.indexOf(u)>=0||l){let r=i[o[u]||u]||l,a=t[u];if("object"!=typeof r||"function"==typeof a||Array.isArray(r)){let e=t[u];if(Array.isArray(r)&&!r.includes(e))return!1;(i[u]||l&&!1!==i[u])&&(n[u]=e)}else if(Array.isArray(a)){let t=a.map((t=>{let i={};return!1!==e(t,r,i)?i:void 0})).filter(Boolean);n[u]=t}else a&&(n[u]={},e(a,r,n[u]))}}(t,i,n),n}var ed="voluntaryConsolation",td="competitiveBands",id="roundRobinTally",nd="positionActions",rd="matchUpActions",ad="rankingPoints",od="roundNaming",sd="participant",ld="progression",ud="scheduling",dd="avoidance",cd="scoring",pd="seeding",md="feedIn",fd="draws",hd={POLICY_TYPE_VOLUNTARY_CONSOLATION:ed,POLICY_TYPE_COMPETITIVE_BANDS:td,POLICY_TYPE_ROUND_ROBIN_TALLY:id,POLICY_TYPE_POSITION_ACTIONS:nd,POLICY_TYPE_MATCHUP_ACTIONS:rd,POLICY_TYPE_RANKING_POINTS:ad,POLICY_TYPE_ROUND_NAMING:od,POLICY_TYPE_PARTICIPANT:sd,POLICY_TYPE_PROGRESSION:ld,POLICY_TYPE_SCHEDULING:ud,POLICY_TYPE_AVOIDANCE:dd,POLICY_TYPE_DISPLAY:"display",POLICY_TYPE_PRIVACY:"participant",POLICY_TYPE_FEED_IN:md,POLICY_TYPE_SCORING:cd,POLICY_TYPE_SEEDING:pd,POLICY_TYPE_AUDIT:"audit",POLICY_TYPE_DRAWS:fd};function vd({tournamentParticipants:e=[],policyDefinitions:t={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let o=ts(e.find((e=>n&&e.participantId===n||a&&e.person&&e.person.personId===a)),!1,r);if(o){let e=null==t?void 0:t[sd];if(null!=i&&i.withScaleValues){let{ratings:e,rankings:t}=Zu({participant:o});o.rankings=t,o.ratings=e}if(null!=e&&e.participant)return Xu({template:e.participant,source:o})}return o}var gd="element required",Id="missing name";function Ud(e){if(!e||"object"!=typeof e)return{error:un};if(e.element&&"object"!=typeof(null==e?void 0:e.element))return{error:Cr};if(null==e||!e.name)return{error:un,info:Id};if(null==e||!e.element){if(e.discover&&e.tournamentRecords){for(let t of Object.keys(e.tournamentRecords)){let i=Ud({element:e.tournamentRecords[t],name:e.name});if(i.error)return La({result:i,stack:"removeExtension"})}return{...At}}return{error:un,info:gd}}return null!=e&&e.element.extensions?(e.element.extensions=e.element.extensions.filter((t=>(null==t?void 0:t.name)!==e.name)),{...At}):{...At,info:Lr}}function yd({requiredAttributes:e=["name","value"],extension:t}){if(!t||"object"!=typeof t||"string"!=typeof t.name)return!1;let i=Object.keys(t);return e.filter((e=>i.includes(e))).length===e.length}function Sd(e){if("object"!=typeof e)return{error:un};let t="addExtension";if(null!=e&&e.element&&"object"!=typeof e.element)return La({result:{error:Cr},stack:t});if(!yd({extension:e.extension}))return La({result:{error:Cr,info:"invalid extension"},stack:t});if(!e.element){if(e.discover&&!e.tournamentId&&e.tournamentRecords){for(let i of Object.values(e.tournamentRecords)){let n=Sd({extension:e.extension,element:i});if(n.error)return La({result:n,stack:t})}return{...At}}return La({result:{error:un},stack:t})}if(e.element.extensions||(e.element.extensions=[]),(null==e?void 0:e.creationTime)??1){let t=(new Date).toISOString();Object.assign(e.extension,{createdAt:t})}let i=e.element.extensions.find((({name:t})=>t===e.extension.name));return i?i.value=e.extension.value:e.extension.value&&e.element.extensions.push(e.extension),{...At}}function wd(e){return e&&"object"==typeof e?e.tournamentRecord?Sd({creationTime:e.creationTime,element:e.tournamentRecord,extension:e.extension}):{error:Bt}:{error:un}}function Pd(e){return e&&"object"==typeof e?e.drawDefinition?Sd({creationTime:e.creationTime,element:e.drawDefinition,extension:e.extension}):{error:Wt}:{error:un}}function Dd(e){return e&&"object"==typeof e?e.event?Sd({creationTime:e.creationTime,extension:e.extension,element:e.event}):{error:Ri}:{error:un}}function Td(e){var t;if(!e||"object"!=typeof e)return{error:un};if(!e.participantId)return{error:xn};let i=(null==(t=e.tournamentRecord)?void 0:t.participants)||[],n=vd({participantId:e.participantId,tournamentParticipants:i});return n?Sd({creationTime:e.creationTime,extension:e.extension,element:n}):{error:_n}}function bd(e){return e&&"object"==typeof e?e.tournamentRecord?Ud({element:e.tournamentRecord,name:e.name}):{error:Bt}:{error:un}}function Rd(e){return e&&"object"==typeof e?e.drawDefinition?Ud({element:e.drawDefinition,name:e.name}):{error:Wt}:{error:un}}function Nd(e){return e&&"object"==typeof e?null!=e&&e.event?Ud({element:e.event,name:e.name}):{error:Ri}:{error:un}}function Md(e){var t;if(!e||"object"!=typeof e)return{error:un};if(!e.participantId)return{error:xn};let i=(null==(t=e.tournamentRecord)?void 0:t.participants)||[],n=vd({participantId:e.participantId,tournamentParticipants:i});return n?Ud({element:n,name:e.name}):{error:_n}}function Ad({tournamentRecords:e}){return{tournamentIds:wt(e)?Object.keys(e):[],...At}}var Ed="extensionQueries";function Cd({discover:e,element:t,name:i,...n}){var r;if(!t||!i){if(e&&n){let t=Object.keys(n).filter((t=>"boolean"==typeof e||Array.isArray(e)&&e.includes(t))).find((e=>{var t;return!!Array.isArray(null==(t=n[e])?void 0:t.extensions)&&n[e].extensions.find((e=>(null==e?void 0:e.name)===i))})),a=t&&n[t];!a&&n.tournamentRecords&&(a=Object.values(n.tournamentRecords).find((e=>{var t;return null==(t=e.extensions)?void 0:t.length})));let o=null==(r=null==a?void 0:a.extensions)?void 0:r.find((e=>(null==e?void 0:e.name)===i));return{extension:o,info:o?void 0:Lr}}return La({result:{error:un},stack:Ed})}if(!Array.isArray(t.extensions))return{info:"no extensions"};let a=t.extensions.find((e=>(null==e?void 0:e.name)===i));return{extension:a,info:a?void 0:Lr}}var Od="appliedPolicies",kd="context",Fd="delegatedOutcome",xd="disabled",_d="disableAutoCalc",Ld="disableLinks",Bd="display",Vd="drawDeletions",jd="entryProfile",Gd="flightProfile",$d="groupingAttribute",qd="lineUps",Wd="linkedTournamentsIds",Hd="matchUpHistory",zd="participantRepresentatives",Yd="personRequests",Kd="positionActions",Jd="roundTarget",Qd="scheduleLimits",Zd="scheduleTiming",Xd="schedulingProfile",ec="subOrder",tc="tally",ic="tieFormatModification",nc={ACTIVE_SUSPENSION:"activeSuspension",APPLIED_POLICIES:Od,CONTEXT:kd,DELEGATED_OUTCOME:Fd,DISABLED:xd,DISABLE_LINKS:Ld,DISABLE_AUTO_CALC:_d,DISPLAY:Bd,DRAW_DELETIONS:Vd,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:jd,EVENT_PROFILE:"eventProfile",EVENT_WITHDRAWAL_REQUESTS:"eventWithdrawalRequests",FLIGHT_PROFILE:Gd,GROUPING_ATTRIBUTE:$d,LINEUPS:qd,LINKED_TOURNAMENTS:Wd,MATCHUP_HISTORY:Hd,PARTICIPANT_REPRESENTATIVES:zd,PERSON_REQUESTS:Yd,POSITION_ACTIONS:Kd,RANKING_POINTS:"rankingPoints",REGISTRATION:"registration",ROUND_TARGET:Jd,SCHEDULE_LIMITS:Qd,SCHEDULE_TIMING:Zd,SCHEDULING_PROFILE:Xd,STATUS_DETAIL:"statusDetail",SUB_ORDER:ec,TALLY:tc,TIE_FORMAT_MODIFICATIONS:ic,FACTORY:"factory"},rc=[Fd,xd,_d,Ld,Gd,qd,Wd,Hd,zd,Yd,Jd,Qd,Zd,Xd,ec,tc,ic];function ac({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Lt};let t=Ad({tournamentRecords:e}),{tournamentIds:i}=t;return(null==i?void 0:i.length)>1?Sd({tournamentRecords:e,discover:!0,extension:{name:Wd,value:{tournamentIds:i}}}):{...At}}function oc({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Lt};return La({result:Ud({name:Wd,tournamentRecords:e,discover:!0}),stack:"unlinkTournaments"})}function sc({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e)return{error:Cr};if(!t)return{error:jt};let i,n=Ad({tournamentRecords:e}),{tournamentIds:r}=n;return r.includes(t)?(r.every((n=>{var r;let a=e[n],{extension:o}=Cd({element:a,name:Wd});if(!o)return!0;let s=(null==(r=null==o?void 0:o.value)?void 0:r.tournamentIds)||[];if(null==s||!s.length||1===s.length&&s.includes(t)||n===t){let e=bd({name:Wd,tournamentRecord:a});return e.error&&(i=e.error),e.success}let l=s.filter((e=>e!==t));o.value={tournamentIds:l};let u=wd({tournamentRecord:a,extension:o});return u.error&&(i=u.error),u.success})),i?{error:i}:{...At}):{error:jt}}var lc={};function uc({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?{linkedTournamentIds:Object.assign({},...Object.keys(e).map((t=>{var i;let n=e[t],r=null==n?void 0:n.tournamentId,{extension:a}=Cd({element:n,name:Wd});return{[t]:((null==(i=null==a?void 0:a.value)?void 0:i.tournamentIds)||[]).filter((e=>e!==r))}})))}:{error:Lt}}be(lc,{getLinkedTournamentIds:()=>uc,getTournamentIds:()=>Ad});var dc={};be(dc,{adHocPositionSwap:()=>jU,addAdHocMatchUps:()=>wS,addDrawDefinitionTimeItem:()=>JI,addFinishingRounds:()=>sv,addGoesTo:()=>lv,addPlayoffStructures:()=>dS,addQualifyingStructure:()=>VU,addVoluntaryConsolationStage:()=>nU,addVoluntaryConsolationStructure:()=>Ng,allPlayoffPositionsFilled:()=>UI,alternateDrawPositionAssignment:()=>mI,assignDrawPosition:()=>IS,assignDrawPositionBye:()=>yv,attachConsolationStructures:()=>sS,attachPlayoffStructures:()=>lS,attachQualifyingStructure:()=>YI,attachStructures:()=>uS,autoSeeding:()=>sR,automatedPlayoffPositioning:()=>qI,automatedPositioning:()=>$I,checkValidEntries:()=>hw,deleteAdHocMatchUps:()=>yS,drawMatic:()=>qD,findDrawDefinition:()=>AS,generateAdHocMatchUps:()=>kw,generateAdHocRounds:()=>GD,generateAndPopulatePlayoffStructures:()=>tS,generateDrawDefinition:()=>aR,generateDrawMaticRound:()=>qw,generateDrawStructuresAndLinks:()=>ww,generateDrawTypeAndModifyDrawDefinition:()=>Pw,generateQualifyingStructure:()=>BU,generateVoluntaryConsolation:()=>Ww,getAssignedParticipantIds:()=>Mv,getAvailableMatchUpsCount:()=>bS,getAvailablePlayoffProfiles:()=>QU,getDrawDefinitionTimeItem:()=>om,getDrawParticipantRepresentativeIds:()=>RS,getDrawStructures:()=>zc,getDrawTypeCoercion:()=>dw,getEligibleVoluntaryConsolationParticipants:()=>TS,getMatchUpsMap:()=>rf,getParticipantIdFinishingPositions:()=>NS,getPositionAssignments:()=>cw,getPositionsPlayedOff:()=>KU,getSeedingThresholds:()=>_g,getSeedsCount:()=>fw,getStructureSeedAssignments:()=>Xm,getTeamLineUp:()=>xh,getValidGroupSizes:()=>kg,isAdHoc:()=>mf,isCompletedStructure:()=>II,isValidForQualifying:()=>pw,luckyLoserDrawPositionAssignment:()=>oI,modifyDrawDefinition:()=>fS,modifyDrawName:()=>mS,modifySeedAssignment:()=>fI,mutate:()=>cc,positionActions:()=>uw,pruneDrawDefinition:()=>gS,qualifierDrawPositionAssignment:()=>pI,query:()=>DS,removeDrawPositionAssignment:()=>wg,removeRoundMatchUps:()=>SS,removeSeededParticipant:()=>kU,removeStructure:()=>QI,renameStructures:()=>KI,resetDrawDefinition:()=>hS,resetVoluntaryConsolationStructure:()=>_p,setDrawParticipantRepresentativeIds:()=>Ic,setPositionAssignments:()=>dI,setStructureOrder:()=>WI,setSubOrder:()=>PS,shiftAdHocRounds:()=>uI,swapAdHocRounds:()=>cI,swapDrawPositionAssignments:()=>CU,updateTeamLineUp:()=>iI,withdrawParticipantAtDrawPosition:()=>Pg});var cc={};be(cc,{adHocPositionSwap:()=>jU,addAdHocMatchUps:()=>wS,addDrawDefinitionTimeItem:()=>JI,addPlayoffStructures:()=>dS,addQualifyingStructure:()=>VU,addVoluntaryConsolationStage:()=>nU,addVoluntaryConsolationStructure:()=>Ng,alternateDrawPositionAssignment:()=>mI,assignDrawPosition:()=>IS,assignDrawPositionBye:()=>yv,attachConsolationStructures:()=>sS,attachPlayoffStructures:()=>lS,attachQualifyingStructure:()=>YI,attachStructures:()=>uS,automatedPlayoffPositioning:()=>qI,automatedPositioning:()=>$I,deleteAdHocMatchUps:()=>yS,luckyLoserDrawPositionAssignment:()=>oI,modifyDrawDefinition:()=>fS,modifyDrawName:()=>mS,modifySeedAssignment:()=>fI,pruneDrawDefinition:()=>gS,qualifierDrawPositionAssignment:()=>pI,removeDrawPositionAssignment:()=>wg,removeRoundMatchUps:()=>SS,removeSeededParticipant:()=>kU,removeStructure:()=>QI,renameStructures:()=>KI,resetDrawDefinition:()=>hS,resetVoluntaryConsolationStructure:()=>_p,setDrawParticipantRepresentativeIds:()=>Ic,setPositionAssignments:()=>dI,setStructureOrder:()=>WI,setSubOrder:()=>PS,shiftAdHocRounds:()=>uI,swapAdHocRounds:()=>cI,swapDrawPositionAssignments:()=>CU,updateTeamLineUp:()=>iI,withdrawParticipantAtDrawPosition:()=>Pg});var pc=e=>t=>e[t],mc=(e=[])=>e.map(vc).filter(Boolean),fc=(e=[])=>e.map(hc).filter(Boolean),hc=(e={})=>pc(e)("participantId"),vc=(e={})=>pc(e)("matchUpId"),gc=(e={})=>pc(e)("drawId");function Ic({representativeParticipantIds:e,drawDefinition:t}){if(!t)return{error:Wt};if(!Array.isArray(e))return{error:Cr};let i=fc((null==t?void 0:t.entries)||[]);return e.length&&dt(e,i).length<e.length?{error:Cr}:Pd({drawDefinition:t,extension:{name:zd,value:e}})}var Uc="ABANDONED",yc="AWAITING_RESULT",Sc="BYE",wc="CANCELLED",Pc="COMPLETED",Dc="DEAD_RUBBER",Tc="DEFAULTED",bc="DOUBLE_DEFAULT",Rc="DOUBLE_WALKOVER",Nc="IN_PROGRESS",Mc="INCOMPLETE",Ac="NOT_PLAYED",Ec="RETIRED",Cc="SUSPENDED",Oc="TO_BE_PLAYED",kc="WALKOVER",Fc=[yc,Pc,Tc,Nc,Mc,Ec,Cc],xc=[yc,Pc,Tc,Rc,bc,Nc,Mc,Ec,Cc,kc],_c=[Uc,yc,Sc,wc,Pc,Dc,Tc,Rc,bc,Nc,Mc,Ac,Ec,Cc,Oc,kc],Lc=[Sc,Rc,bc,Pc,Tc,Ec,kc],Bc=[Uc,yc,wc,Dc,Nc,Mc,Ac,Cc,Oc,void 0],Vc=[wc,Uc,Pc,Dc,Tc,Rc,bc,Ec,kc],jc=[Uc,Pc,Tc,Rc,bc,Nc,Ec,kc],Gc=[Nc,Mc,Cc,Oc],$c={ABANDONED:Uc,AWAITING_RESULT:yc,BYE:Sc,CANCELLED:wc,COMPLETED:Pc,DEAD_RUBBER:Dc,DEFAULTED:Tc,DOUBLE_WALKOVER:Rc,DOUBLE_DEFAULT:bc,IN_PROGRESS:Nc,INCOMPLETE:Mc,NOT_PLAYED:Ac,RETIRED:Ec,SUSPENDED:Cc,TO_BE_PLAYED:Oc,WALKOVER:kc};function qc(e,t,i){var n,r;let a=e=>{var t,i;return null==(i=null==(t=Cd({element:e,name:Jd}))?void 0:t.extension)?void 0:i.value},o=null==i?void 0:i.deprioritizeCompleted,s=(null==i?void 0:i.mode)===dl&&pl,l=(null==i?void 0:i.mode)===ul&&cl,u=l||s||ll,d=e=>(e=>(null==e?void 0:e.stage)===il&&1===(null==e?void 0:e.stageSequence))(e)?-1:u[null==e?void 0:e.stage],c=e=>null==e?void 0:e.matchUps.every((({matchUpStatus:e})=>Vc.includes(e)?1:-1));return o&&c(e)-c(t)||s&&d(e)-d(t)||((null==e?void 0:e.stage)&&u[e.stage]||0)-((null==t?void 0:t.stage)&&u[t.stage]||0)||(a(e)||0)-(a(t)||0)||!l&&!s&&((null==(n=null==t?void 0:t.positionAssignments)?void 0:n.length)??1/0)-((null==(r=null==e?void 0:e.positionAssignments)?void 0:r.length)??1/0)||((null==e?void 0:e.stageSequence)??0)-((null==t?void 0:t.stageSequence)??0)||(Wc(e)||0)-(Wc(t)||0)}function Wc(e){return((null==e?void 0:e.matchUps)||[]).reduce(((e,t)=>{var i;let n=((null==(i=t.finishingPositionRange)?void 0:i.winner)||[]).reduce(((e,t)=>e+t),0);return!e||n<e?n:e}),void 0)}function Hc(e){let t=qu(e,[{[su]:!0,[pu]:!0}]);if(t.error)return t;let{drawDefinition:i,structureId:n}=e,{structures:r}=zc({drawDefinition:i}),a=null==r?void 0:r.map((e=>e.structures?[...e.structures].concat(e):e)).flat(),o=null==a?void 0:a.find((e=>e.structureId===n));return o?{structure:o,containingStructure:o.structureType===hl?null==a?void 0:a.find((e=>{var t;return null==(t=e.structures)?void 0:t.some((e=>e.structureId===n))})):void 0}:{error:Si}}function zc({withStageGrouping:e,drawDefinition:t,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:o,stage:s}){var l;let u=!t&&$t||!(null!=t&&t.structures)&&wi||void 0;if(u)return{error:u,structures:[],stageStructures:{}};let d=(null==(l=null==t?void 0:t.structures)?void 0:l.filter((function(e){return!s&&!Array.isArray(o)||s&&e.stage===s||Array.isArray(o)&&o.includes(e.stage)})).filter((function(e){return!n&&!Array.isArray(i)||n&&e.stageSequence===n||Array.isArray(i)&&i.includes(e.stageSequence)})).filter((e=>{var t,i;let n=null==(i=null==(t=Cd({element:e,name:Jd}))?void 0:t.extension)?void 0:i.value;return!r||r===n})).sort(((e,t)=>qc(e,t,a))))??[],c=e?Object.assign({},...sl.map((e=>{let t=null==d?void 0:d.filter((t=>t.stage===e));return(null==t?void 0:t.length)&&{[e]:t}})).filter(Boolean)):{};return{structures:d,stageStructures:c}}function Yc({drawDefinition:e}){if(!e)return{error:$t};let t={};return{allPositionedParticipantIds:(e.structures||[]).map((e=>{let i=e.stage;t[i]||(t[i]=[]);let{positionAssignments:n}=Kc({structure:e}),r=(null==n?void 0:n.map(hc).filter(Boolean))??[];return t[i].push(...r),r})).flat(),stagePositionedParticipantIds:t}}function Kc({drawDefinition:e,structureId:t,structure:i}){let n,r=[];if(!i){if(!e)return{positionAssignments:r,error:$t};if(({structure:i,error:n}=Hc({drawDefinition:e,structureId:t})),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map((e=>Kc({structure:e}).positionAssignments))):i.positionAssignments?r=i.positionAssignments:n=Fi,{positionAssignments:r,error:n}}function Jc({drawDefinition:e,structureId:t,structure:i}){var n;let r=(null==(n=Kc({drawDefinition:e,structureId:t,structure:i}))?void 0:n.positionAssignments)||[],a=null==r?void 0:r.filter((e=>e.participantId??e.bye??e.qualifier)),o=r&&(null==r?void 0:r.length)===(null==a?void 0:a.length),s=null==r?void 0:r.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)),l=null==r?void 0:r.filter((e=>!e.participantId&&e.bye)),u=null==r?void 0:r.filter((e=>!e.participantId&&e.qualifier));return{allPositionsAssigned:o,positionAssignments:r,unassignedPositions:s,assignedPositions:a,qualifierPositions:u,byePositions:l}}var Qc="addDrawDefinition",Zc="addMatchUps",Xc="addParticipants",ep="addScaleItems",tp="addEvent",ip="addVenue",np="audit",rp="dataIssue",ap="deleteParticipants",op="deleteVenue",sp="deletedDrawIds",lp="deletedMatchUpIds",up="modifyDrawDefinition",dp="modifyDrawEntries",cp="modifyEventEntries",pp="modifyMatchUp",mp="modifyParticipants",fp="modifyPositionAssignments",hp="modifySeedAssignments",vp="modifyTournamentDetail",gp="modifyVenue",Ip="mutations",Up="publishEvent",yp="publishEventSeeding",Sp="publishOrderOfPlay",wp="publishParticipants",Pp="unPublishEvent",Dp="unPublishEventSeeding",Tp="unPublishOrderOfPlay",bp="unPublishParticipants",Rp="updateInContextMatchUp",Np={ADD_DRAW_DEFINITION:Qc,ADD_MATCHUPS:Zc,ADD_PARTICIPANTS:Xc,ADD_SCALE_ITEMS:ep,ADD_EVENT:tp,ADD_VENUE:ip,AUDIT:np,DATA_ISSUE:rp,DELETE_PARTICIPANTS:ap,DELETE_VENUE:op,DELETED_DRAW_IDS:sp,DELETED_MATCHUP_IDS:lp,MODIFY_DRAW_DEFINITION:up,MODIFY_DRAW_ENTRIES:dp,MODIFY_EVENT_ENTRIES:cp,MODIFY_MATCHUP:pp,MODIFY_PARTICIPANTS:mp,MODIFY_POSITION_ASSIGNMENTS:fp,MODIFY_SEED_ASSIGNMENTS:hp,MODIFY_TOURNAMENT_DETAIL:vp,MODIFY_VENUE:gp,MUTATIONS:Ip,PUBLISH_EVENT_SEEDING:yp,PUBLISH_EVENT:Up,PUBLISH_ORDER_OF_PLAY:Sp,PUBLISH_PARTICIPANTS:wp,UNPUBLISH_EVENT_SEEDING:Dp,UNPUBLISH_EVENT:Pp,UNPUBLISH_ORDER_OF_PLAY:Tp,UPDATE_INCONTEXT_MATCHUP:Rp};function Mp(e,t){var i;if(!e)return{error:$t};let n=Date.now();e.updatedAt&&n===new Date(e.updatedAt).getTime()&&(n+=1);let r=new Date(n).toISOString(),a=null==t?void 0:t.filter(Boolean);return e.updatedAt=r,null==(i=e.structures)||i.filter(Boolean).forEach((e=>{(null==a||!a.length||null!=a&&a.includes(e.structureId))&&(e.updatedAt=r)})),{...At}}function Ap({drawDefinition:e,tournamentId:t,matchUps:i,eventId:n}){return e&&Mp(e),Ia({payload:{matchUps:i,tournamentId:t,eventId:n},topic:Zc}),{...At}}function Ep({drawDefinition:e,tournamentId:t,matchUpIds:i,eventId:n,action:r}){e&&Mp(e),Ia({topic:lp,payload:{tournamentId:t,matchUpIds:i,eventId:n,action:r}});for(let a of i)Sa({key:a});return{...At}}function Cp({drawDefinition:e,tournamentId:t,structureId:i,context:n,eventId:r,matchUp:a}){return a?(e&&kp({drawDefinition:e,structureIds:i?[i]:void 0,tournamentId:t,eventId:r}),Ia({topic:pp,payload:{matchUp:a,tournamentId:t,context:n},key:a.matchUpId}),{...At}):(console.log(Ji),{error:Ji})}function Op({tournamentId:e,eventId:t,drawDefinition:i}){return i?(Mp(i),Ia({payload:{drawDefinition:i,tournamentId:e,eventId:t},topic:Qc,key:i.drawId}),{...At}):(console.log($t),{error:$t})}function kp({drawDefinition:e,tournamentId:t,structureIds:i,eventId:n}){return e?(Mp(e,i),Ia({payload:{tournamentId:t,eventId:n,drawDefinition:e},topic:up,key:e.drawId}),{...At}):{error:$t}}function Fp({drawDefinition:e,tournamentId:t,structure:i,eventId:n}){if(!e)return{error:$t};if(!i)return{error:Pi};let r=i.seedAssignments,a=i.structureId;return Ia({payload:{tournamentId:t,eventId:n,drawId:e.drawId,structureId:a,seedAssignments:r},topic:hp,key:e.drawId}),kp({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:n}),{...At}}function xp({drawDefinition:e,tournamentId:t,structure:i,event:n}){if(!e)return{error:$t};if(!i)return{error:Pi};let r=Kc({structure:i}),a=i.structureId,o=e.drawId,s=null==n?void 0:n.eventId;return Ia({topic:fp,payload:{positionAssignments:r,tournamentId:t,structureId:a,eventId:s,drawId:o},key:a}),kp({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:s}),{...At}}function _p({tournamentRecord:e,drawDefinition:t,resetEntries:i,event:n}){var r,a;if(!t)return{error:$t};let o=null==(r=t.structures)?void 0:r.find((e=>e.stage===al));if(!o)return{error:Si};let s=(null==(a=o.matchUps)?void 0:a.map((({matchUpId:e})=>e)))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],Ep({tournamentId:null==e?void 0:e.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:t}),i&&(t.entries=t.entries.filter((e=>e.entryStage!==al))),kp({tournamentId:null==e?void 0:e.tournamentId,eventId:null==n?void 0:n.eventId,drawDefinition:t,structureIds:[o.structureId]}),{...At}}function Lp({drawPositions:e,structure:t}){var i;if([nl,il].includes(t.stage)&&1===t.stageSequence)return;let{positionAssignments:n}=Kc({structure:t});null==(i=null==n?void 0:n.filter((({drawPosition:t})=>null==e?void 0:e.includes(t))))||i.forEach((e=>{Sd({element:e,extension:{name:Ld,value:!0}})}))}function Bp(e){var t,i;let{appliedPolicies:n,positionAction:r,drawDefinition:a}=e;if(!1===(null==(t=null==n?void 0:n.audit)?void 0:t[Kd]))return;let{extension:o}=Cd({name:Kd,element:a}),s=Array.isArray(null==o?void 0:o.value)?(null==o?void 0:o.value)??[]:[];if(null==s||!s.length){let e=a.structures.find((e=>e.stage===il));if(e){let t=null==(i=Kc({structure:e}).positionAssignments)?void 0:i.map((({drawPosition:e,participantId:t,bye:i,qualifier:n})=>({drawPosition:e,participantId:t,qualifier:n,bye:i})));s.push({name:"initialMainAssignments",initialAssignments:t})}}Sd({element:a,extension:{value:s.concat(r),name:Kd}})}function Vp({tournamentRecord:e,drawDefinition:t,event:i}){var n;let r=(null==(n=(null==e?void 0:e.events)||i&&[i])?void 0:n.map((e=>null==e?void 0:e.drawDefinitions)).flat().filter(Boolean))||t&&[t]||[],a={},o={},s=r.map((e=>{var t;return null==(t=null==e?void 0:e.structures)?void 0:t.filter((e=>null==e?void 0:e.structures))})).flat().filter(Boolean);for(let l of s){let{structures:e,structureId:t}=l??{};e&&t&&(a[t]=null==e?void 0:e.map((e=>e.structureId)))&&e.forEach((e=>o[e.structureId]=null==l?void 0:l.structureId))}return{containedStructures:a,containerStructures:o}}function jp(e){var t;let{sides:i,matchUpType:n}=e||{},r=null!=(t=e.potentialParticipants)&&t.length?e.potentialParticipants.flat().map((e=>n===Oe?(null==e?void 0:e.individualParticipantIds)||[]:e.participantId)).flat():[],a=(i||[]).map((e=>{var t;return n===Oe&&((null==(t=null==e?void 0:e.participant)?void 0:t.individualParticipantIds)||[])||(null==e?void 0:e.participantId)&&[e.participantId]||[]})).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function Gp(e){return(null==e?void 0:e.tournamentRecords)??((null==e?void 0:e.tournamentRecord)&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{}}var $p="SIGN_IN_STATUS",qp="SIGNED_OUT",Wp="SIGNED_IN",Hp="TEAM",zp="INDIVIDUAL",Yp="GROUP",Kp="PAIR",Jp="TEAM",Qp={TEAM_PARTICIPANT:Hp,INDIVIDUAL:zp,GROUP:Yp,TEAM:Jp,PAIR:Kp},Zp={INDIVIDUAL:zp,GROUP:Yp,PAIR:Kp,TEAM:Jp,SIGN_IN_STATUS:$p,SIGNED_OUT:qp,SIGNED_IN:Wp};function Xp({participantsProfile:e,participants:t=[],deepCopy:i}){let n=new Map,r=!1!==i?ts(t,null==e?void 0:e.convertExtensions,!0):t,a=r.filter((e=>e.participantType===Jp)),o=r.filter((e=>e.participantType===Yp)),s=r.filter((e=>e.participantType===Kp));return r.forEach((e=>{if(e.participantType===zp){let{participantId:t}=e;e.groupParticipantIds=[],e.teamParticipantIds=[],e.pairParticipantIds=[],e.groups=[],e.teams=[],a.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((r=>{var a;r===t&&(null==(a=e.teamParticipantIds)||!a.includes(i.participantId))&&(e.teamParticipantIds.push(i.participantId),n.get(i.participantId)||n.set(i.participantId,{participantName:i.participantName,participantId:i.participantId}),e.teams.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId,teamId:i.teamId}))}))})),s.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n===t&&!e.pairParticipantIds.includes(i.participantId)&&e.pairParticipantIds.push(i.participantId)}))})),o.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n===t&&!e.groupParticipantIds.includes(i.participantId)&&(e.groupParticipantIds.push(i.participantId),e.groups.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId}))}))}))}})),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function em(e){return e&&typeof String.fromCodePoint<"u"?e.toUpperCase().replace(/./g,(e=>String.fromCodePoint(e.charCodeAt(0)+127397))):e}var tm=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function im({participant:e,withISO2:t,withIOC:i}){let{person:n,individualParticipants:r}=e;[n,null==r?void 0:r.map((({person:e})=>e))].flat().filter(Boolean).forEach((function(e){let{nationalityCode:n}=e||{};if(n){let r=tm.find((({iso:e})=>e===n));i&&null!=r&&r.ioc&&!e.iocNationalityCode&&(e.iocNationalityCode=r.ioc),t&&null!=r&&r.iso2&&!e.iso2NationalityCode&&(e.iso2NationalityCode=r.iso2),null!=r&&r.label&&!e.countryName&&(e.countryName=r.label)}}))}function nm(e){var t;let{tournamentRecord:i,participantId:n}=e,r=e.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(r)){let e=null==(t=a.participants)?void 0:t.find((e=>e.participantId===n));if(e)return{participant:e,tournamentId:a.tournamentId}}return{error:_n}}function rm(e){let{tournamentRecord:t,participantId:i}=e;if(i){let e=nm({tournamentRecord:t,participantId:i});return e.participant??e}return e.element||e.drawDefinition||e.event||e.tournamentRecord||{error:un}}function am(e){let{returnPreviousValues:t,itemSubTypes:i,itemType:n}=e,r=rm(e);if(r.error)return r;if(i&&!Array.isArray(i))return{error:Cr,context:{itemSubTypes:i}};if(!Array.isArray(r.timeItems))return{error:Ur};let a=r.timeItems.filter((e=>(null==e?void 0:e.itemType)===n)).filter((e=>!(null!=i&&i.length)||i.some((t=>{var i;return null==(i=null==e?void 0:e.itemSubTypes)?void 0:i.includes(t)})))).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())),o=ts(a.pop(),!1,!0);if(o){let e={timeItem:o,...At};return t&&Object.assign(e,{previousItems:a}),e}return{info:Lr}}function om({returnPreviousValues:e,drawDefinition:t,itemSubTypes:i,itemType:n}){if(!t)return{error:li};if(!t.timeItems)return{info:Lr};let{timeItem:r,previousItems:a,info:o}=am({element:t,returnPreviousValues:e,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function sm({returnPreviousValues:e,itemSubTypes:t,itemType:i,event:n}){if(!n)return{error:bi};if(!n.timeItems)return{info:Lr};let{timeItem:r,previousItems:a,info:o}=am({returnPreviousValues:e,element:n,itemSubTypes:t,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:o}}function lm({returnPreviousValues:e,tournamentRecord:t,itemSubTypes:i,itemType:n}){if(!t)return{error:Bt};if(!t.timeItems)return{info:Lr};let{timeItem:r,previousItems:a,info:o}=am({element:t,returnPreviousValues:e,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function um({returnPreviousValues:e,tournamentRecord:t,participantId:i,itemSubTypes:n,itemType:r}){if(!t)return{error:Bt};if(!i)return{error:xn};let a=nm({tournamentRecord:t,participantId:i});if(a.error)return a;let{participant:o}=a;if(null==o||!o.timeItems)return{info:Lr};let{timeItem:s,previousItems:l,info:u}=am({element:a.participant,returnPreviousValues:e,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:u}}var dm={[Yp]:"groupParticipantIds",[Kp]:"pairParticipantIds",[Jp]:"teamParticipantIds"},cm={[Yp]:"groups",[Jp]:"teams"};function pm({withIndividualParticipants:e,convertExtensions:t,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,withGroupings:a,internalUse:o,withISO2:s,withIOC:l}){let u,d=[],c={};for(let p of i.participants??[]){let e=null==p?void 0:p.participantId;e&&hm({participantMap:c,participantId:e})}for(let p of i.participants??[]){let e=ts(p,t,o),{participantId:i,individualParticipantIds:a,participantType:u}=e;if(c[i]){if(Object.assign(c[i].participant,e),a){let t=fm({individualParticipantIds:a,participantCopy:e,participantMap:c,participantType:u,participantId:i});t.missingParticipantIds.length&&d.push(...t.missingParticipantIds)}if(n&&(c[i].participant.signedIn=mm(e)),r){let{ratings:t,rankings:n,seedings:r}=Zu({participant:e});c[i].participant.seedings=r,c[i].participant.rankings=n,c[i].participant.ratings=t}(l||s)&&im({participant:c[i].participant,withISO2:s,withIOC:l})}else d.push(i)}if(e){!function({participantMap:e,template:t}){var i;let n=Object.values(e);for(let r of n){let n=r.participant;if(null!=(i=n.individualParticipantIds)&&i.length){n.individualParticipants=[];for(let i of n.individualParticipantIds){let r=e[i].participant;n.individualParticipants.push(t?Xu({template:t,source:r}):r)}}}}({participantMap:c,template:wt(e)?e:void 0})}return a&&(u=Xp({participants:Object.values(c).map((({participant:e})=>e)),participantsProfile:{convertExtensions:t},deepCopy:!1}).groupInfo),{missingParticipantIds:d,participantMap:c,groupInfo:u}}function mm(e){let{timeItem:t}=am({itemType:$p,element:e});return(null==t?void 0:t.itemValue)===Wp}function fm({individualParticipantIds:e,participantCopy:t,participantMap:i,participantType:n,participantId:r}){var a;let o=[];for(let s of e){let l=null==(a=i[s])?void 0:a.participant;if(l){if(l[dm[n]].push(r),[Jp,Yp].includes(n)){let{participantRoleResponsibilities:e,participantOtherName:i,participantName:r,participantId:a,teamId:o}=t;l[cm[n]].push({participantRoleResponsibilities:e,participantOtherName:i,participantName:r,participantId:a,teamId:o})}if(n===Kp){let t=e.find((e=>e!==s));i[s].pairIdMap[r]=t,i[s].pairIdMap[t]=r}}else o.push(s)}return{missingParticipantIds:o}}function hm({participantMap:e,participantId:t}){if(e[t])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};e[t]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Ee]:{...i},[Oe]:{...i},[Jp]:{...i},...i}}}function vm({participantsProfile:e,useParticipantMap:t,tournamentRecord:i,contextProfile:n,inContext:r}){if(t)return pm({...e,...n,tournamentRecord:i});let a,o=ts(i.participants,!1,!0)||[];if((null!=e&&e.withIOC||null!=e&&e.withISO2)&&o.forEach((t=>im({participant:t,...e}))),(r||null!=e&&e.withGroupings)&&null!=o&&o.length&&({participantsWithGroupings:o,groupInfo:a}=Xp({participantsProfile:e,deepCopy:!1,participants:o})),(null==e?void 0:e.withScaleValues)&&(null==o?void 0:o.length))for(let s of o){let{ratings:e,rankings:t}=Zu({participant:s});s.rankings=t,s.ratings=e}return{participants:o,groupInfo:a}}function gm({onlySpecifiedPolicyTypes:e=!1,policyTypes:t=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(t))return{error:Zi};let o={};return i&&s(i),a&&s(a),n&&s(n),r&&s(r),{appliedPolicies:o,...At};function s(i){var n,r;let a=null==(r=null==(n=null==i?void 0:i.extensions)?void 0:n.find((e=>e.name===Od)))?void 0:r.value;if(a)for(let s of Object.keys(a))(e?t.includes(s):!t.length||t.includes(s))&&(o[s]=ts(a[s],!1,!0))}}function Im({policyTypes:e=[],tournamentRecord:t,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(e))return{error:Zi};let{appliedPolicies:a}=gm({tournamentRecord:t,drawDefinition:i,structure:n,event:r}),o={};for(let s of e){let e=null==a?void 0:a[s];e&&(o[s]=e)}return Object.keys(o).length?{policyDefinitions:o}:{info:an.message}}var Um="WALKOVER",ym="RETIRED",Sm="COMPETITIVE",wm="ROUTINE",Pm="DECISIVE",Dm="winRatio",Tm={[td]:{policyName:"Competitive Bands Default",profileBands:{[Pm]:20,[wm]:50}}};function bm({policyDefinitions:e,tournamentRecord:t,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let o=Im({tournamentRecord:t,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let t=(null==e?void 0:e[td])??(null==o?void 0:o[td])??Tm[td];a.policies[td]=t}return a}function Rm({tournamentRecord:e,drawDefinition:t,policyType:i,structure:n,event:r}){if(!e)return{error:Bt};let{appliedPolicies:a}=gm({tournamentRecord:e,drawDefinition:t,structure:n,event:r});return null!=a&&a[i]?{policy:a[i]}:{info:null==an?void 0:an.message}}function Nm({tournamentRecord:e,categoryName:t,categoryType:i,event:n}){var r,a,o,s,l,u;t=t??(null==(r=null==n?void 0:n.category)?void 0:r.categoryName)??(null==(a=null==n?void 0:n.category)?void 0:a.ageCategoryCode),i=i??(null==(o=null==n?void 0:n.category)?void 0:o.categoryType)??(null==(s=null==n?void 0:n.category)?void 0:s.subType);let{policy:d}=Rm({policyType:ud,tournamentRecord:e,event:n});return{scheduleTiming:{tournamentScheduling:null==(l=e?Cd({element:e,name:Zd}).extension:void 0)?void 0:l.value,eventScheduling:null==(u=n&&Cd({name:Zd,element:n}).extension)?void 0:u.value,categoryName:t,categoryType:i,policy:d}}}function Mm({drawDefinition:e,attributes:t}){let{extension:i}=Cd({element:e,name:jd}),n=(null==i?void 0:i.value)||{};return t.forEach((e=>{Object.keys(e).forEach((t=>{n[t]?Object.assign(n[t],e[t]):n[t]=e[t]}))})),i={name:jd,value:n},Pd({drawDefinition:e,extension:i}),{entryProfile:n}}function Am({drawDefinition:e}){let{extension:t}=Cd({element:e,name:jd});return{entryProfile:(null==t?void 0:t.value)||{}}}var Em="ALTERNATE",Cm="CONFIRMED",Om="DIRECT_ACCEPTANCE",km="FEED_IN",Fm="JUNIOR_EXEMPT",xm="LUCKY_LOSER",_m="ORGANISER_ACCEPTANCE",Lm="QUALIFIER",Bm="SPECIAL_EXEMPT",Vm="UNGROUPED",jm="UNPAIRED",Gm="WILDCARD",$m="WITHDRAWN",qm=[Cm,Om,Fm,_m,Bm],Wm=[km,xm,Lm],Hm=[Cm,Om,km,Fm,_m,Bm,Gm],zm=[Cm,Om,Fm,xm,Lm,_m,Bm,Gm],Ym=[Em,Cm,Om,km,Fm,xm,_m,Lm,"REGISTERED",Bm,Vm,jm,Gm,$m],Km={ALTERNATE:Em,CONFIRMED:Cm,DIRECT_ACCEPTANCE:Om,DIRECT_ENTRY_STATUSES:Hm,DRAW_SPECIFIC_STATUSES:Wm,EQUIVALENT_ACCEPTANCE_STATUSES:qm,FEED_IN:km,JUNIOR_EXEMPT:Fm,LUCKY_LOSER:xm,ORGANISER_ACCEPTANCE:_m,QUALIFIER:Lm,SPECIAL_EXEMPT:Bm,STRUCTURE_SELECTED_STATUSES:zm,UNGROUPED:Vm,UNPAIRED:jm,VALID_ENTRY_STATUSES:Ym,WILDCARD:Gm,WITHDRAWN:$m};function Jm({stage:e,drawDefinition:t}){let{entryProfile:i}=Am({drawDefinition:t}),n=Object.keys(i).includes(e);if(!n&&sl.includes(e)){return Mm({drawDefinition:t,attributes:[{[e]:{drawSize:void 0,alternates:!0}}]}),!0}return n}function Qm({stage:e,drawDefinition:t,entryStatus:i}){return t.entries.reduce(((t,n)=>n.entryStage===e&&n.entryStatus===i?t+1:t),0)}function Zm({provisionalPositioning:e,placementGroup:t,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let d=(null==(u=i.entries)?void 0:u.reduce(((e,t)=>{var i,a;let u=null==(a=null==(i=Cd({name:Jd,element:t}))?void 0:i.extension)?void 0:a.value,d=l&&t.entryStage===l||(null==s?void 0:s.length)&&t.entryStage&&s.includes(t.entryStage),c=!r||t.entryStatus&&r.includes(t.entryStatus),p=t.entryStageSequence??1;return!d||n&&p!==n||!c||o&&u&&o!==u?e:e.concat(t)}),[]))??[];if(a&&l===ol){let{playoffEntries:n,error:r}=function({provisionalPositioning:e,drawDefinition:t,structureId:i}){let n=[],r=(t.links??[]).find((e=>e.linkType===Sl&&e.target.structureId===i));if(r){let{finishingPositions:i,structureId:a}=r.source,{structure:o}=Hc({drawDefinition:t,structureId:a});(null==o?void 0:o.structureType)===vl&&(o.structures??[]).forEach((t=>{let r=t.positionAssignments??[],{structureId:a}=t,o=a,s=Object.assign({},...r.map((e=>{var t;let{participantId:i}=e,n=null==(t=Cd({element:e,name:tc}).extension)?void 0:t.value;return n&&i?{[i]:n}:void 0})).filter(Boolean)),l=Object.keys(s).reduce(((t,i)=>{let n=s[i],r=n.groupOrder||e&&n.provisionalOrder;return t.includes(r)||t.push(r),t}),[]).length===Object.keys(s).length,u=Object.keys(s).filter((t=>{let n=s[t],r=n.groupOrder||e&&n.provisionalOrder;return null==i?void 0:i.includes(r)}));(!e||l)&&u.forEach((t=>{let r=s[t],{groupOrder:a,provisionalOrder:l,GEMscore:u}=r,d=a||e&&l,c=[...i??[]].sort(Le).indexOf(d)+1;n.push({entryStage:ol,entryStatus:km,placementGroup:c,groupingValue:o,participantId:t,GEMscore:u})}))}))}return{playoffEntries:n}}({provisionalPositioning:e,drawDefinition:i,structureId:a});return r&&console.log("playoff entries error"),(null!=n&&n.length?n:d).filter((e=>!t||e.placementGroup===t))}return d}function Xm({provisionalPositioning:e,returnAllProxies:t,drawDefinition:i,structureId:n,structure:r}){var a;let o,s=[];r||({structure:r,error:o}=Hc({drawDefinition:i,structureId:n}));let l=Kc({structure:r}).positionAssignments;if(o||!r)return{seedAssignments:[],error:Si};n||(n=r.structureId);let{stage:u,stageSequence:d}=r,c=u===ol&&i&&Zm({provisionalPositioning:e,drawDefinition:i,stageSequence:d,structureId:n,stage:u}),p=c?c.filter((e=>1===e.placementGroup)).sort(((e,t)=>(e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore&&-1)||0)).map(((e,t)=>{let i=t+1;return{participantId:e.participantId,seedValue:i,seedProxy:!0,seedNumber:i}})):[],m=null==p?void 0:p.slice(0,t?p.length:l.length/2);return m.length?s=m:r.seedAssignments?s=r.seedAssignments:o=hi,{seedAssignments:s,stageSequence:d,seedLimit:r.seedLimit??(null==(a=null==r?void 0:r.positionAssignments)?void 0:a.length),stage:u,error:o}}function ef(e){if(!e)return;let{tieFormatId:t,tieFormats:i}=e;return e.tieFormat?e.tieFormat:t&&Array.isArray(i)?i.find((e=>e.tieFormatId===t)):void 0}function tf({item:e,drawDefinition:t,structure:i,event:n}){var r,a,o;if(e){if(e.tieFormat)return e.tieFormat;if(e.tieFormatId)return t.tieFormat?t.tieFormat:(null==(r=t.tieFormats)?void 0:r.find((t=>e.tieFormatId===t.tieFormatId)))||(n.tieFormat?n.tieFormat:null==(a=n.tieFormats)?void 0:a.find((t=>e.tieFormatId===t.tieFormatId)));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let e=null==(o=t.tieFormats)?void 0:o.find((e=>i.tieFormatId===e.tieFormatId));if(e)return e}}}function nf({drawDefinition:e,structure:t,matchUp:i,event:n}){return{tieFormat:tf({item:i,drawDefinition:e,structure:t,event:n})||tf({item:t,drawDefinition:e,structure:t,event:n})||ef(e)||ef(n)}}function rf({drawDefinition:e,structure:t}){let i={},n=[];return((null==e?void 0:e.structures)??[t]).filter((e=>e&&"object"==typeof e)).forEach((e=>{if(!e)return;let{structureId:t,matchUps:r,structures:a}=e,o=Array.isArray(a);if(o)o&&a.forEach((e=>{let{structureName:r}=e,a=e.matchUps;i[e.structureId]={matchUps:a,itemStructureIds:[],structureName:r},a&&(n.push(...a),a.forEach((e=>{e.tieMatchUps&&n.push(...e.tieMatchUps)}))),i[t]||(i[t]={itemStructureIds:[],matchUps:[]}),i[t].itemStructureIds||(i[t].itemStructureIds=[]),i[t].itemStructureIds.push(e.structureId)}));else{let e=r;i[t]={matchUps:e,itemStructureIds:[]},null==e||e.forEach((e=>{n.push(e),e.tieMatchUps&&n.push(...e.tieMatchUps)}))}})),{mappedMatchUps:i,drawMatchUps:n}}function af({mappedMatchUps:e,matchUpsMap:t,structureId:i,inContext:n}){let r=(e=(null==t?void 0:t.mappedMatchUps)??e)[i],a=((null==r?void 0:r.itemStructureIds)||[]).map((t=>{let{matchUps:r,structureName:a}=e[t];return n?r.map((e=>Object.assign(ts(e,!0,!0),{containerStructureId:i,structureId:t,structureName:a}))):r})).flat();return((null==r?void 0:r.matchUps)||[]).concat(...a)}function of({groupedOrder:e,roundPositionsCount:t}){if(!e||(null==e?void 0:e.length)<=t)return e;let i=ht(e,e.length/t).map((e=>e.reduce(((e,t)=>e+t)))),n=i.slice().sort(Le);return i.map((e=>n.indexOf(e)+1))}function sf(e){if(!wt(e))return!1;let{matchUpId:t,drawPositions:i}=e,n="string"==typeof t,r=!i||Array.isArray(i)&&i.length<=2&&i.every((e=>Ye(e)||null==e));return n&&r}function lf(e){return!!Array.isArray(e)&&e.every(sf)}function uf({matchUps:e=[],interpolate:t}){var i;if(!lf(e))return{roundMatchUps:[],error:Cr};let n=e.reduce(((e,t)=>{let i="string"==typeof t.roundNumber?Be(t.roundNumber):t.roundNumber;return!t.roundNumber||e.includes(i)?e:e.concat(i)}),[]).sort(Le).map((t=>{let i=e.filter((e=>e.roundNumber===t)),n=i.find((({matchUpType:e})=>e===Fe))?i.filter((({matchUpType:e})=>e===Fe)):i;return{[t]:(r=n,r.sort(((e,t)=>Le(e.roundPosition,t.roundPosition))))};var r})),r=e.reduce(((e,t)=>{let i="string"==typeof t.roundNumber?Be(t.roundNumber):t.roundNumber;return e[i]||(e[i]=_a({abbreviatedRoundName:t.abbreviatedRoundName,finishingRound:t.finishingRound,roundName:t.roundName})),e}),{}),a=Object.assign({},...n);if(t){let e=Math.max(...Object.keys(a).map((e=>Be(e))).filter((e=>!isNaN(e)))),t=null==(i=a[e])?void 0:i.length;if(t>1&&Ve(t)){let i=e+1;lt(i,i+t/2).forEach(((e,i)=>{a[e]=lt(0,t/(2+2*i)).map((()=>({})))}))}}let o=0,s=Object.assign({},...Object.keys(a).map((e=>{var t,i,n;let r=null==(t=a[e])?void 0:t.length,s=null==(n=null==(i=a[e])?void 0:i.filter((e=>{var t;return!(Vc.includes(e.matchUpStatus)||null!=(t=e.score)&&t.scoreStringSide1)})))?void 0:n.length,l=r&&r===s;return o=Math.max(o,r),{[e]:{matchUpsCount:r,inactiveCount:s,inactiveRound:l}}}))),l=0,u=0,d=Object.keys(a).map((e=>Be(e))).filter((e=>!isNaN(e)));d.forEach((e=>{var t,i,n,d,c;let p=a[e].sort(((e,t)=>e.roundPosition-t.roundPosition)),m=p.map((e=>(null==e?void 0:e.drawPositions)||[])).flat();if(s[e].roundNumber=e,s[e].roundFactor=s[e].matchUpsCount?o/s[e].matchUpsCount:1,s[e].finishingRound=null==(t=r[e])?void 0:t.finishingRound,s[e].roundName=null==(i=r[e])?void 0:i.roundName,s[e].abbreviatedRoundName=null==(n=r[e])?void 0:n.abbreviatedRoundName,s[e].finishingPositionRange=null==(c=null==(d=a[e])?void 0:d[0])?void 0:c.finishingPositionRange,1!==e&&s[e-1]){let t=s[e-1],i=t.drawPositions,n=t.matchUpsCount/s[e].matchUpsCount,r=ht(i,n),a=p.map((t=>{let{roundPosition:n}=t,a=[...t.drawPositions||[],void 0,void 0].slice(0,2);if(!n)return a;let o=(null==a?void 0:a.filter(Boolean))||[];if(null==o||!o.length)return[void 0,void 0];if(e<3&&2===(null==o?void 0:o.length))return null==a?void 0:a.slice().sort(Le);let s=dt(i,o).length!==(null==o?void 0:o.length);if(null!=o&&o.length&&s)return 1===(null==o?void 0:o.length)?[o[0],void 0]:null==a?void 0:a.slice().sort(Le);let l=2*(n-1);return r.slice(l,l+2).map((e=>null==o?void 0:o.find((t=>e.includes(t)))))}));s[e].drawPositions=null==a?void 0:a.flat(),s[e].pairedDrawPositions=a}else{let t=m.sort(Le),i=ht(t,2);s[e].drawPositions=t,s[e].pairedDrawPositions=i}s[e+1]&&s[e+1].matchUpsCount===s[e].matchUpsCount&&(s[e+1].feedRound=!0,s[e+1].feedRoundIndex=u,s[e].preFeedRound=!0,u+=1),s[e]&&!s[e].feedRound&&(s[e].roundIndex=l,l+=1)}));let c=!!Object.values(s).find((({matchUpsCount:e})=>!Ve(e)));return{hasNoRoundPositions:e.some((e=>!e.roundPosition)),roundsNotPowerOf2:c,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:d,roundProfile:s,...At}}function df(e){if(!Array.isArray(e))return"";let t=e.filter(qe);return t.length?Qe([Math.min(...t),Math.max(...t)]).join("-"):""}function cf({drawDefinition:e}){if("object"!=typeof e)return{error:Gt};let t={},{structures:i=[],links:n=[]}=e||{},r=i.reduce(((e,t)=>{let{stage:i}=t;return e[i]?e[i].push(t):e[i]=[t],e}),{});for(let o of Object.keys(r)){let e=r[o].find((({stageSequence:e})=>1===e));if(!e)continue;let{structureId:i}=e;a({aggregator:{},targetRound:0,exitProfiles:t,exitProfile:"0",structureId:i,stage:o})}return{exitProfiles:t};function a({exitProfiles:e,exitProfile:t,structureId:r,targetRound:o,aggregator:s,stage:l}){e[r]||(e[r]=[]),"0"===t&&[rl,ol].includes(l)||e[r].push(t);let u=n.filter((e=>e.source.structureId===r&&e.source.roundNumber>=o));for(let n of u){let r=n.source.roundNumber,o=n.target.roundNumber,l=n.target.structureId,u=i.find((e=>e.structureId===l)).stage,d=[u,l,o,r].join("|");if(s[d])return;s[d]=!0,a({exitProfile:`${t}-${r}`,structureId:l,exitProfiles:e,targetRound:o,aggregator:s,stage:u})}}}function pf({roundsNotPowerOf2:e,drawDefinition:t,structure:i,matchUps:n}){var r;if(!i)return!1;n=n??i.matchUps??[],e=e??uf({matchUps:n}).roundsNotPowerOf2;let a=!(null==(r=i.positionAssignments)||!r.find((({drawPosition:e})=>e)))||!(null==n||!n.find((({drawPositions:e})=>null==e?void 0:e.length)));return(!(null!=t&&t.drawType)||t.drawType!==Ol)&&!(null!=i&&i.structures)&&e&&a}function mf({structure:e}){if(!e)return!1;let t=e.matchUps||e.roundMatchUps&&Object.values(e.roundMatchUps).flat(),i=!(null==t||!t.find((e=>null==e?void 0:e.roundPosition))),n=!(null==t||!t.find((e=>{var t;return null==(t=null==e?void 0:e.drawPositions)?void 0:t.length})));return!(null!=e&&e.structures||(null==e?void 0:e.stage)===al||t.length&&(i||n))}var ff={[od]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[il]:"",[ol]:"P",[nl]:"Q",[rl]:"C"}}},hf=ff;var vf=(e,t)=>(e||0)+(t||0);function gf(e,t){let i=Array.isArray(e)?e[0]:e;return isNaN(i)&&Um||i<=t[Pm]&&Pm||i<=t[wm]&&wm||Sm}function If({score:e}){let t=(null==e?void 0:e.sets)||[],i=t.reduce(((e,t)=>(e[0]+=t.side1Score||0,e[1]+=t.side2Score||0,e)),[0,0]),n=t.reduce(((e,t)=>(e[0]+=t.side1TiebreakScore||0,e[1]+=t.side2TiebreakScore||0,e)),[0,0]);return n.reduce(vf)&&(i[n[0]>n[1]?0:1]+=1),{sets:t,games:i,score:e}}function Uf(e){let t=Math.min(...e.games),i=Math.max(...e.games);return Math.round(t/i*100)}function yf(e){return e.map(Uf).sort().map((e=>parseFloat(e.toFixed(2))))}function Sf({tournamentRecord:e,profileBands:t,matchUp:i}){if(!i)return{error:Ji};let{score:n,winningSide:r}=i;if(!r)return{error:Cr};let a=!t&&e&&Rm({policyType:td,tournamentRecord:e}).policy,o=t||(null==a?void 0:a.profileBands)||Tm[td].profileBands,s=yf([If({score:n})]),l=gf(s,o),u=Array.isArray(s)?s[0]:s;return{...At,competitiveness:l,pctSpread:u}}function wf({matchUp:e}){var t,i,n;if(!e)return{error:Ji};if(e&&!e.sides)return{error:Qi};if(e&&!e.hasContext)return{error:yr};let r=null==(t=e.sides??[])?void 0:t.map((e=>null==e?void 0:e.participantId)).filter(Boolean),a=(null==(i=e.sides)?void 0:i.filter((e=>{var t;return(null==(t=e.participant)?void 0:t.participantType)===zp})).map((e=>e.participantId)).filter(Boolean))??[],o=((null==(n=e.sides??[])?void 0:n.map((e=>{var t;return null==(t=e.participant)?void 0:t.individualParticipants})).filter(Boolean))??[]).map((e=>(e??[]).map((e=>null==e?void 0:e.participantId)).filter(Boolean))),s=[...a,...o.flat()].filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:Qe(s.concat(r)).filter(Boolean)??[],individualParticipantIds:s,sideParticipantIds:r,...At}}var Pf="CHECK_IN",Df="CHECK_OUT",Tf="SCHEDULE.ASSIGNMENT.VENUE",bf="SCHEDULE.ALLOCATION.COURTS",Rf="SCHEDULE.ASSIGNMENT.COURT",Nf="SCHEDULE.COURT.ORDER",Mf="SCHEDULE.DATE",Af="HOME_PARTICIPANT_ID",Ef="SCHEDULE.ASSIGN.OFFICIAL",Cf="SCHEDULE.TIME.SCHEDULED",Of="SCHEDULE.TIME.START",kf="SCHEDULE.TIME.STOP",Ff="SCHEDULE.TIME.RESUME",xf="SCHEDULE.TIME.END",_f="SCHEDULE.TIME.MODIFIERS",Lf="TO_BE_ANNOUNCED",Bf="NEXT_AVAILABLE",Vf="FOLLOWED_BY",jf="AFTER_REST",Gf="RAIN_DELAY",$f=[Lf,Bf,Vf,jf,Gf],qf="SCALE",Wf="RATING",Hf="RANKING",zf="SEEDING",Yf="PUBLISH",Kf="PUBLIC",Jf="STATUS",Qf={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:$f,AFTER_REST:jf,ALLOCATE_COURTS:bf,ASSIGN_COURT:Rf,ASSIGN_OFFICIAL:Ef,ASSIGN_VENUE:Tf,CHECK_IN:Pf,CHECK_OUT:Df,COMPLETED_DATE:"COMPLETED.DATE",COURT_ORDER:Nf,ELIGIBILITY:"ELIGIBILITY",END_TIME:xf,FOLLOWED_BY:Vf,MEDICAL:"MEDICAL",MODIFICATION:"MODIFICATION",NEXT_AVAILABLE:Bf,NOT_BEFORE:"NOT_BEFORE",OTHER:"other",PENALTY:"PENALTY",PUBLIC:Kf,PUBLISH:Yf,RANKING:Hf,RATING:Wf,RAIN_DELAY:Gf,REGISTRATION:"REGISTRATION",RESUME_TIME:Ff,RETRIEVAL:"RETRIEVAL",SCALE:qf,SCHEDULE:"SCHEDULE",SCHEDULED_DATE:Mf,SCHEDULED_TIME:Cf,SEEDING:zf,START_TIME:Of,STATUS:Jf,STOP_TIME:kf,SUSPENSION:"SUSPENSION",TIME_MODIFIERS:_f,TO_BE_ANNOUNCED:Lf};function Zf({matchUp:e}){if(!e)return{error:Ji};if(!e.hasContext)return{error:yr};if(!e.sides||2!==e.sides.filter(Boolean).length)return{error:Qi};let{nestedIndividualParticipantIds:t,allRelevantParticipantIds:i,sideParticipantIds:n}=wf({matchUp:e}),r=(e.timeItems??[]).filter((e=>(null==e?void 0:e.itemType)&&[Pf,Df].includes(e.itemType))).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))),a=r.map((e=>e.itemValue)).filter((e=>r.filter((t=>(null==t?void 0:t.itemValue)===e)).reverse()[0].itemType===Pf));return null==t||t.forEach(((e,t)=>{let i=null==n?void 0:n[t],r=(null==e?void 0:e.length)&&e.every((e=>a.includes(e)));i&&r&&!a.includes(i)&&a.push(i)})),null==n||n.forEach(((e,i)=>{a.includes(e)&&((null==t?void 0:t[i])??[]).forEach((e=>{e&&!a.includes(e)&&a.push(e)}))})),{allRelevantParticipantIds:i,allParticipantsCheckedIn:null==n?void 0:n.reduce(((e,t)=>a.includes(t)&&e),!0),checkedInParticipantIds:a,...At}}var Xf=e=>t=>{let i=wt(t)&&(null==t?void 0:t.matchUpType)||St(t)&&t;return i&&_e[e].includes(i)};function eh(e){var t;let{matchUpAverageTimes:i,matchUpFormat:n}=e||{},r=(null==i?void 0:i.map((({matchUpFormatCodes:e})=>null==e?void 0:e.filter((e=>e===n)))).flat().filter(Boolean).sort(((e,t)=>((null==e?void 0:e.length)||0)-((null==t?void 0:t.length)||0))))||[],a=r.includes(n)?n:r[0];return null==(t=null==i?void 0:i.find((({matchUpFormatCodes:e,averageTimes:t})=>(null==e?void 0:e.find((e=>a===e)))&&t)))?void 0:t.averageTimes}function th(e){var t;let{matchUpRecoveryTimes:i,averageMinutes:n,matchUpFormat:r}=e||{};return null==(t=null==i?void 0:i.find((({matchUpFormatCodes:e,averageTimes:t,recoveryTimes:i})=>{if(t&&n){let{greaterThan:e=0,lessThan:i=360}=t;if(n>e&&n<i)return!0}return(null==e?void 0:e.find((e=>e===r)))&&i})))?void 0:t.recoveryTimes}function ih({timesBlockArray:e,categoryName:t,categoryType:i}){return e.filter((e=>Array.isArray(e))).map((e=>e.sort(((e,t)=>{var i,n;return((null==(i=t.categoryNames)?void 0:i.length)||0)-((null==(n=e.categoryNames)?void 0:n.length)||0)})).find((({categoryTypes:e,categoryNames:n})=>!(null!=n&&n.length)&&!(null!=e&&e.length)||(null==n?void 0:n.includes(t))||(null==e?void 0:e.includes(i)))))).find(Boolean)}var nh="DOUBLES_SINGLES",rh="SINGLES_DOUBLES",ah="total",oh="participantConflict",sh="matchUpConflict",lh="ISSUE_IDS",uh="CONFLICT",dh="WARNING",ch="ERROR",ph="ISSUE",mh="STATE",fh={SINGLES_DOUBLES:rh,DOUBLES_SINGLES:nh,TOTAL:ah,CONFLICT_MATCHUP_ORDER:sh,CONFLICT_PARTICIPANTS:oh,SCHEDULE_ISSUE_IDS:lh,SCHEDULE_CONFLICT:uh,SCHEDULE_WARNING:dh,SCHEDULE_ERROR:ch,SCHEDULE_ISSUE:ph,SCHEDULE_STATE:mh};function hh({defaultAverageMinutes:e=90,defaultRecoveryMinutes:t=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:Bt};o=o??(null==s?void 0:s.eventType)??Js;let l={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},{scheduleTiming:u}=Nm({tournamentRecord:i,categoryName:r,categoryType:a,event:s});return vh({eventType:o,timingDetails:{...u,matchUpFormat:n,categoryType:a,defaultTiming:l}})}function vh({timingDetails:e,eventType:t}){let i=function({matchUpFormat:e,categoryName:t,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;return ih({categoryName:t,categoryType:i,timesBlockArray:[(null==a?void 0:a.matchUpAverageTimes)&&eh({...a,matchUpFormat:e}),(null==r?void 0:r.matchUpAverageTimes)&&eh({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpAverageTimes)&&eh({...o,matchUpFormat:e}),null==(s=null==o?void 0:o.defaultTimes)?void 0:s.averageTimes,null==n?void 0:n.averageTimes]})}(e),n=Object.keys((null==i?void 0:i.minutes)||{}),r=(null==i?void 0:i.minutes)&&((null==n?void 0:n.includes(t))&&i.minutes[t]||i.minutes.default),a=function({tournamentScheduling:e,eventScheduling:t,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:o,policy:s}){var l;return ih({categoryName:a,categoryType:o,timesBlockArray:[(null==t?void 0:t.matchUpRecoveryTimes)&&th({...t,averageMinutes:i,matchUpFormat:r}),(null==e?void 0:e.matchUpRecoveryTimes)&&th({...e,averageMinutes:i,matchUpFormat:r}),(null==s?void 0:s.matchUpRecoveryTimes)&&th({...s,averageMinutes:i,matchUpFormat:r}),null==(l=null==s?void 0:s.defaultTimes)?void 0:l.recoveryTimes,null==n?void 0:n.recoveryTimes]})}({...e,averageMinutes:r}),o=Object.keys((null==a?void 0:a.minutes)||{}),s=(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(t))&&a.minutes[t]||a.minutes.default),l=Xf(Js)(t)?rh:nh;return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(l))&&a.minutes[l]||s)}}function gh(e){return e.createdAt?new Date(e.createdAt).getTime():0}function Ih({timeItems:e,itemType:t}){let i=e.filter((e=>e&&e.itemType===t)).sort(((e,t)=>gh(e)-gh(t))).pop(),n=i&&gh(i);return{itemValue:null==i?void 0:i.itemValue,timeStamp:n}}function Uh({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:n,timeStamp:r}=Ih({timeItems:(null==i?void 0:i.timeItems)||[],itemType:Cf});return!t||r&&e&&new Date(r).getTime()>new Date(e).getTime()?{scheduledTime:n}:t}function yh({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:n,timeStamp:r}=Ih({timeItems:(null==i?void 0:i.timeItems)||[],itemType:Mf});return!t||r&&e&&new Date(r).getTime()>new Date(e).getTime()?{scheduledDate:n}:t}function Sh(e){if(mo.test(e)){let t=yo();return new Date(`${t}T${e}`)}return new Date(e)}function wh(e){let t=(e,t=2)=>("00"+e).slice(-t);return t(e/36e5|0)+":"+t(e%36e5/6e4|0)+":"+t(e%6e4/1e3|0)}function Ph(e){let{disableNotice:t,venue:i,context:n}=e;if("object"!=typeof i)return{error:Cr};let r,a=Gp(e);i.venueId||(i.venueId=rs());for(let o of Object.values(a)){let e=Dh({disableNotice:!0,tournamentRecord:o,context:n,venue:i});if(null!=e&&e.error)return e;r=e.venue}return t||Ia({topic:ip,payload:{venue:i}}),_a({...At,venue:r})}function Dh({tournamentRecord:e,disableNotice:t,context:i,venue:n}){return e?n?(e.venues||(e.venues=[]),n.venueId||(n.venueId=rs()),e.venues.reduce(((e,t)=>e||t.venueId===n.venueId),void 0)?{error:lr}:(i&&Sd({element:n,extension:{value:i,name:kd}}),e.venues.push(n),t||Ia({payload:{venue:n,tournamentId:e.tournamentId},topic:ip}),{...At,venue:ts(n)})):{error:un,info:"missing venue"}:{error:Bt}}function Th({tournamentRecords:e,tournamentRecord:t,venueId:i}){if(!t)return{error:Bt};if(!i)return{error:dr};let n=(t.venues??[]).reduce(((e,t)=>t.venueId===i?t:e),void 0);if(!n&&e){let r=(uc({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let a of r){let r=Th({tournamentRecord:e[a],venueId:i});if(r.success&&r.venue)return Ph({tournamentRecord:t,venue:r.venue}),{...At,venue:n}}}return n?{...At,venue:n}:{error:ur}}function bh({convertExtensions:e,...t}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=t;return ts(Th({tournamentRecords:i,tournamentRecord:n,venueId:r}),e,!0)}function Rh({tournamentRecords:e,tournamentRecord:t,courtId:i}){if(!t)return{error:Bt};if(!i)return{error:ln};let n,r;if((t.venues??[]).forEach((e=>{(e.courts??[]).forEach((t=>{t.courtId===i&&(n=t,r=e)}))})),n)return{...At,court:n,venue:r};if(e){let a=(uc({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let o of a){let a=Rh({tournamentRecord:e[o],courtId:i});if(a.success)return a.venue&&Ph({tournamentRecord:t,venue:a.venue}),{...At,court:n,venue:r}}}return La({result:{error:or},stack:"findCourt"})}function Nh(e){return ts(Rh(e),!1,!0)}function Mh({tournamentRecord:e,internalUse:t,courtId:i}){if(!e)return{error:Bt};if(!i)return{error:ln};let n=Rh({tournamentRecord:e,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:e,courtId:t,courtName:i,courtDimensions:n,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:l,pace:u,notes:d})=>({altitude:e,courtId:t,courtName:i,courtDimensions:n,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:l,pace:u,notes:d}))(n.court);return{...At,courtInfo:ts(r,!1,t)}}function Ah(e){var t;let i=qu(e,[{[au]:!0},{venueId:!0,[Mu]:dr}]);if(i.error)return i;let{tournamentRecord:n,venueId:r}=e,a=Th({tournamentRecord:n,venueId:r});if(a.error)return a;let o=((null==(t=a.venue)?void 0:t.courts)??[]).map((e=>(({courtInfo:e})=>({...e}))(Mh({courtId:e.courtId,internalUse:!0,tournamentRecord:n})))),s=a.venue&&(({venueId:e,venueName:t,venueAbbreviation:i})=>({venueAbbreviation:i,venueName:t,venueId:e}))(a.venue),l=s&&{...s,courtsInfo:o};return{...At,venueData:ts(l,!1,!0)}}function Eh({event:e,eventId:t}){var i,n;if(!e)return{error:bi};let r=null==(i=Cd({name:Gd,element:e}))?void 0:i.extension,a=t?ts(null==r?void 0:r.value,!1,!0):null==r?void 0:r.value;return t&&(null==(n=e.drawDefinitions)||n.forEach((e=>{var t;null==(t=null==a?void 0:a.flights)||t.forEach((t=>{t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})}))}))),{flightProfile:a}}function Ch(e){let t,{tournamentRecord:i,eventId:n,drawId:r}=e,a="findEvent",o={},s=e.tournamentRecords??(i&&{[i.tournamentId]:i})??{},l=Object.values(s).map((({events:e,tournamentId:t})=>(e&&e.forEach((e=>{o[e.eventId]={tournamentId:t}})),e??[]))).flat();if(r){let e,i=l.find((i=>{var n,a,s;let l=((null==i?void 0:i.drawDefinitions)??[]).find((e=>e.drawId===r));if(l)e=l,t=o[i.eventId].tournamentId;else{let e=null==(s=null==(a=i&&(null==(n=Eh({event:i}))?void 0:n.flightProfile))?void 0:a.flights)?void 0:s.find((e=>e.drawId===r));if(e)return t=o[i.eventId].tournamentId,{entries:e.drawEntries,drawName:e.drawName,tournamentId:t,drawId:r}}return l}));if(i)return{event:i,drawDefinition:e,tournamentId:t}}if(n){let e=l.find((e=>(null==e?void 0:e.eventId)===n));return e?(t=o[e.eventId].tournamentId,{event:e,drawDefinition:void 0,tournamentId:t}):{event:void 0,drawDefinition:void 0,...La({result:{error:Ri},stack:a})}}return{event:void 0,drawDefinition:void 0,...La({result:{error:Wt},context:{drawId:r,eventId:n},stack:a})}}function Oh(e){var t,i,n,r,a,o,s,l,u,d;let c=e.event,p=e.matchUpType,{scheduleVisibilityFilters:m,afterRecoveryTimes:f,tournamentRecord:h,usePublishState:v,scheduleTiming:g,matchUpFormat:I,publishStatus:U,matchUp:y}=e;if(!y)return{error:Ji};if(f&&!y.matchUpType&&!e.matchUpType&&(c||h)&&y.drawId){let n=e.drawDefinition||(null==(t=null==c?void 0:c.drawDefinitions)?void 0:t.find((e=>e.drawId===y.drawId)));!n&&h&&({drawDefinition:n,event:c}=Ch({drawId:y.drawId,tournamentRecord:h}));let r=y.structureId&&(null==(i=null==n?void 0:n.structures)?void 0:i.find((({structureId:e})=>e===y.structureId)));p=e.matchUpType||(null==r?void 0:r.matchUpType)||(null==n?void 0:n.matchUpType)||(null==c?void 0:c.eventType)!==Xs&&(null==c?void 0:c.eventType)}let S,{milliseconds:w,time:P}=function({matchUp:e}){if(!e)return{error:Ji};if(!e.timeItems)return{error:Ur};let t=e.timeItems.filter((e=>[Of,kf,Ff,xf].includes(null==e?void 0:e.itemType))).sort(((e,t)=>Sh(e.itemValue).getTime()-Sh(t.itemValue).getTime())),i=t.reduce(((e,t)=>{var i,n;let r,a=null==(i=null==t?void 0:t.itemType)?void 0:i.split("."),o=`SCHEDULE.TIME.${(null==(n=null==t?void 0:t.itemType)?void 0:n.startsWith("SCHEDULE.TIME"))&&a[2]}`;switch(o){case Of:r=0;break;case xf:if(e.lastValue&&[Of,Ff].includes(e.lastType)){let i=Sh(t.itemValue).getTime()-Sh(e.lastValue).getTime();r=e.milliseconds+i}else r=e.milliseconds;break;case kf:if([Of,"SCHECULE.TIME.RESUME"].includes(e.lastType)){let i=Sh(t.itemValue).getTime()-Sh(e.lastValue).getTime();r=e.milliseconds+i}else r=e.milliseconds;break;default:r=e.milliseconds}return{milliseconds:r,lastType:o,lastValue:t.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([Of,Ff].includes(i.lastType)){let e=(new Date).getTime()-Sh(i.lastValue).getTime();i.milliseconds+=e}return{milliseconds:i.milliseconds,time:wh(i.milliseconds),relevantTimeItems:t}}({matchUp:y}),{startTime:D}=function({matchUp:e}){var t;let i=(null==e?void 0:e.timeItems)||[],n=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{startTime:null==(t=i.reduce(((e,t)=>{let i=t.itemType===Of&&t;return i&&(!e||n(i)<n(e))?i:e}),void 0))?void 0:t.itemValue}}({matchUp:y}),{endTime:T}=function({matchUp:e}){var t;let i=(null==e?void 0:e.timeItems)||[],n=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{endTime:null==(t=i.reduce(((e,t)=>{let i=t.itemType===xf&&t;return i&&(!e||n(i)>n(e))?i:e}),void 0))?void 0:t.itemValue}}({matchUp:y}),{eventIds:b,drawIds:R}=m??{};if(b&&!b.includes(y.eventId)||R&&!R.includes(y.drawId))S=_a({milliseconds:w,startTime:D,endTime:T,time:P});else{let e=e=>e.createdAt?new Date(e.createdAt).getTime():0,t=new Map,i=(null==(n=y.timeItems)?void 0:n.toSorted(((t,i)=>e(t)-e(i))))??[];for(let n of i)t.set(n.itemType,n.itemValue);let l,u,d,c,m,v=t.get(Af),U=t.get(bf),b=t.get(Cf),R=t.get(_f),N=t.get(Mf),M=t.get(Ef),A=t.get(Nf),E=t.get(Tf),C=t.get(Rf),O=y.matchUpType??p;if(g&&b&&f&&O){let e={matchUpFormat:y.matchUpFormat??I,...g};({averageMinutes:u=0,recoveryMinutes:d=0,typeChangeRecoveryMinutes:c=0}=vh({timingDetails:e,eventType:O})),(u||d)&&(l=T?Bo(Ao(T),d):Bo(b,u+d)),c&&(m=T?Bo(Ao(T),c):Bo(b,u+c))}!N&&b&&(N=Eo(b));let k=vo({scheduledDate:N,scheduledTime:b}),F={},x=(null==(r=h&&E&&Ah({tournamentRecord:h,venueId:E}))?void 0:r.venueData)||{};E&&(F[E]=x);let{venueName:_,venueAbbreviation:L,courtsInfo:B}=x,V=null==(a=C&&(null==B?void 0:B.find((e=>e.courtId===C))))?void 0:a.courtName;for(let n of U||[]){if(!h)break;n.venueId&&!F[n.venueid]&&(F[n.venueId]=null==(o=Ah({venueId:n.venueId,tournamentRecord:h}))?void 0:o.venueData);let e=F[n.venueId];n.venueName=null==e?void 0:e.venueName;let t=null==(s=null==e?void 0:e.courtsInfo)?void 0:s.find((e=>e.courtId===n.courtId));n.courtName=null==t?void 0:t.courtName}S=_a({typeChangeTimeAfterRecovery:m,timeAfterRecovery:l,scheduledDate:N,scheduledTime:b,isoDateString:k,homeParticipantId:v,venueAbbreviation:L,allocatedCourts:U,timeModifiers:R,venueName:_,venueId:E,courtOrder:A,courtName:V,courtId:C,official:M,typeChangeRecoveryMinutes:c,recoveryMinutes:d,averageMinutes:u,milliseconds:w,startTime:D,endTime:T,time:P})}let{scheduledDate:N}=yh({matchUp:y}),{scheduledTime:M}=Uh({matchUp:y});if(v&&null!=(l=null==U?void 0:U.displaySettings)&&l.draws){let e=U.displaySettings.draws,t=null==(u=(null==e?void 0:e[y.drawId])??(null==e?void 0:e.default))?void 0:u.scheduleDetails;if(t){let e=null==(d=t.find((e=>{var t;return N&&(null==(t=e.dates)?void 0:t.includes(N))}))??t.find((e=>{var t;return!(null!=(t=e.dates)&&t.length)})))?void 0:d.attributes;if(e){S=Xu({source:S,template:Object.assign({},...Object.keys(S).map((e=>({[e]:!0}))),e)})}}}return{schedule:S,endDate:y.matchUpStatus&&Vc.includes(y.matchUpStatus)&&(Eo(T)||Eo(N)||Eo(M))||void 0}}function kh({collectionPosition:e,collectionId:t,lineUp:i}){let n=[],r=[];if(i){let a=e=>void 0===e?-1:e,o=i.map((i=>{let{collectionAssignments:n,participantId:r}=i,a=null==n?void 0:n.find((i=>i.collectionPosition===e&&i.collectionId===t));return a&&{participantId:r,...a}})).filter(Boolean).sort(((e,t)=>a(e.substitutionOrder)-a(t.substitutionOrder)));for(let e of o){let{participantId:t,previousParticipantId:i,substitutionOrder:a}=e;n.includes(t)||(i&&r.push({previousParticipantId:i,substitutionOrder:a,participantId:t}),n=n.filter((e=>e!==i)),n.push(t))}}return{assignedParticipantIds:n,substitutions:r}}function Fh({tournamentParticipants:e,tournamentRecord:t,participantIds:i}){let n="getPairedParticipant";if(!e&&!t)return{error:Bt};if(!Array.isArray(i)||i.length>2)return{error:An};if(!i.length)return La({result:{error:Vn},stack:n});let r=(e=e??(null==t?void 0:t.participants)??[]).filter((e=>e.participantType===Kp&&dt(i,e.individualParticipantIds).length===i.length&&e.individualParticipantIds.length===i.length)),a=r[0];if(!a)return La({result:{error:_n},stack:n});let o=ts(r.slice(1),!1,!0);return{participant:ts(a),duplicatedPairParticipants:o,...At}}function xh({drawDefinition:e,participantId:t}){if("object"!=typeof e)return{error:$t};if("string"!=typeof t)return{error:xn};let{extension:i}=Cd({element:e,name:qd});return{lineUp:((null==i?void 0:i.value)||{})[t]}}function _h(e){var t,i,n;let r=qu(e,[{[Ru]:!0}]);if(r.error)return r;let a=null==e?void 0:e.matchUp,o=null==a?void 0:a.matchUpType;if(!o&&null!=(t=null==a?void 0:a.sides)&&t.length){let e=null==(n=null==(i=a.sides.find((({participant:e})=>e)))?void 0:i.participant)?void 0:n.participantType;o=e===zp&&Ee||e===Kp&&Oe||e===Jp&&Jp||void 0}return{matchUpType:o}}function Lh({drawPositionCollectionAssignment:e,sideNumberCollectionAssignment:t,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,u,d,c;let p=i.find((e=>e.drawPosition&&e.drawPosition===a)),m=a&&e,f=s&&t,h=m?null==(l=m[a])?void 0:l.participantId:null==p?void 0:p.participantId,v=p?function({displaySideNumber:e,seedAssignments:t,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:e,sideNumber:r};if(i){let e=function({seedAssignments:e,participantId:t}){return null==e?void 0:e.find((e=>!e.seedProxy&&e.participantId===t))}({seedAssignments:t,participantId:i});Object.assign(a,e,{participantId:i}),null!=e&&e.seedNumber&&""===(null==e?void 0:e.seedValue)&&(a.seedValue="~")}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}({displaySideNumber:n,seedAssignments:r,participantId:h,assignment:p,sideNumber:s}):{...null==f?void 0:f[s]};if(o&&(1===s?Object.assign(v,{participantFed:!0}):Object.assign(v,{participantAdvanced:!0})),a&&m){let e=null==(u=m[a])?void 0:u.teamParticipant,t=null==(d=m[a])?void 0:d.participant,i=null==(c=m[a])?void 0:c.substitutions;t&&(v.participant=t),i&&(v.substitutions=i),e&&(v.teamParticipant=e)}return v}function Bh({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,tournamentParticipants:i,positionAssignments:n,drawPositionsRanges:r,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:l,roundNamingProfile:u,tournamentRecord:d,tieDrawPositions:c,appliedPolicies:p,isCollectionBye:m,seedAssignments:f,usePublishState:h,participantMap:v,contextContent:g,scheduleTiming:I,contextProfile:U,drawDefinition:y,publishStatus:S,scoringActive:w,matchUpTieId:P,isRoundRobin:D,roundProfile:T,sideLineUps:b,structure:R,context:N,matchUp:M,event:A}){var E,C,O,k,F,x,_,L,B,V,j,G,$,q,W;l=l??{};let H=null==(E=nf({drawDefinition:y,structure:R,matchUp:M,event:A}))?void 0:E.tieFormat,{roundOffset:z,structureId:Y,structureName:K,stage:J,stageSequence:Q}=R,{drawId:Z,drawName:X,drawType:ee}=y??{},te=null==H?void 0:H.collectionDefinitions,ie=M.collectionId&&(null==te?void 0:te.find((e=>e.collectionId===M.collectionId))),ne=M.collectionId?null==ie?void 0:ie.matchUpFormat:M.matchUpFormat??(null==R?void 0:R.matchUpFormat)??(null==y?void 0:y.matchUpFormat)??(null==A?void 0:A.matchUpFormat),re=M.matchUpType||(null==ie?void 0:ie.matchUpType)||(null==R?void 0:R.matchUpType)||(null==y?void 0:y.matchUpType)||!Xf(Xs)(null==A?void 0:A.eventType)&&(null==A?void 0:A.eventType),ae=m?Sc:M.matchUpStatus,{schedule:oe,endDate:se}=Oh({scheduleVisibilityFilters:e,afterRecoveryTimes:o,tournamentRecord:d,usePublishState:h,scheduleTiming:I,drawDefinition:y,matchUpFormat:ne,publishStatus:S,matchUpType:re,matchUp:M,event:A}),le=c??M.drawPositions??[],{collectionPosition:ue,collectionId:de,roundPosition:ce}=M,pe=M.roundNumber??l.roundNumber,me=de?function({tournamentParticipants:e,positionAssignments:t,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:t,lineUp:n,teamParticipant:a})=>{var s,u,d,c;let{assignedParticipantIds:p,substitutions:m}=kh({collectionPosition:i,collectionId:o,lineUp:n});if(l!==Oe){let e=null==p?void 0:p[0];return e&&{[t]:{participantId:e,teamParticipant:a,substitutions:m}}}if((null==p?void 0:p.length)<=2){let i=null==(u=null==(s=null==r?void 0:r[p[0]])?void 0:s.pairIdMap)?void 0:u[p[1]];return{[t]:{participantId:null==(c=i&&(null==(d=r[i])?void 0:d.participant)||Fh({participantIds:p,tournamentParticipants:e}).participant)?void 0:c.participantId,teamParticipant:a,substitutions:m}}}if((null==p?void 0:p.length)>2)return{[t]:{teamParticipant:a,substitutions:m}}};if(null==n||!n.length){let e=(null==s?void 0:s.map((e=>{var t;let{teamParticipant:i,sideNumber:n}=e,r=e.lineUp||(null==(t=xh({participantId:i.teamParticipantId,drawDefinition:a}))?void 0:t.lineUp);return u({attribute:n,lineUp:r,teamParticipant:i})})).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...e)}}let d=(null==n?void 0:n.map((i=>{var n,o,l;let d=null==(n=t.find((e=>e.drawPosition===i)))?void 0:n.participantId,c=null==s?void 0:s.find((e=>(null==e?void 0:e.drawPosition)===i)),p=(null==c?void 0:c.teamParticipant)||d&&(null==(o=null==r?void 0:r[d])?void 0:o.participant)||(null==e?void 0:e.find((({participantId:e})=>e===d))),m=(null==c?void 0:c.lineUp)||(null==(l=xh({participantId:d,drawDefinition:a}))?void 0:l.lineUp);return u({attribute:i,lineUp:m,teamParticipant:p})})).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...d)}}({tournamentParticipants:i,positionAssignments:n,collectionPosition:ue,participantMap:v,drawDefinition:y,drawPositions:le,collectionId:de,sideLineUps:b,matchUpType:re}):void 0,fe=(null==(C=null==u?void 0:u[pe])?void 0:C.roundName)||l.roundName,he=(null==(O=null==u?void 0:u[pe])?void 0:O.abbreviatedRoundName)||l.abbreviatedRoundName,ve=null==(k=null==T?void 0:T[pe])?void 0:k.feedRound,ge=null==(F=null==T?void 0:T[pe])?void 0:F.preFeedRound,Ie=null==(x=null==T?void 0:T[pe])?void 0:x.roundFactor,Ue=null==r?void 0:r[pe],ye=ce?null==Ue?void 0:Ue[ce]:void 0,Se=null==t?void 0:t[pe],we=null!=ie&&ie.category?{...(null==N?void 0:N.category)||{},...ie.category}:(null==N?void 0:N.category)??(null==A?void 0:A.category),Pe=(null==(_=M.processCodes)?void 0:_.length)&&M.processCodes||(null==(L=null==ie?void 0:ie.processCodes)?void 0:L.length)&&(null==ie?void 0:ie.processCodes)||(null==(B=null==R?void 0:R.processCodes)?void 0:B.length)&&(null==R?void 0:R.processCodes)||(null==(V=null==y?void 0:y.processCodes)?void 0:V.length)&&(null==y?void 0:y.processCodes)||(null==(j=null==A?void 0:A.processCodes)?void 0:j.length)&&(null==A?void 0:A.processCodes)||(null==d?void 0:d.processCodes),De=(null==U?void 0:U.withCompetitiveness)&&Sf({...g,matchUp:M}),Te=M.finishingPositionRange??l.finishingPositionRange,be=e=>_a(e,void 0,!0),Re={...be(N),...be({matchUpFormat:M.matchUpType===Xs?void 0:ne,tieFormat:M.matchUpType!==Xs?void 0:H,gender:(null==ie?void 0:ie.gender)??(null==A?void 0:A.gender),roundOfPlay:J!==nl&&Ye(s)&&s+(pe||0),endDate:M.endDate??se,discipline:null==A?void 0:A.discipline,category:we,finishingPositionRange:Te,abbreviatedRoundName:he,drawPositionsRange:ye,competitiveProfile:De,structureName:K,stageSequence:Q,drawPositions:le,matchUpStatus:ae,processCodes:Pe,isRoundRobin:D,matchUpTieId:P,preFeedRound:ge,matchUpType:re,roundFactor:Ie,roundOffset:z,structureId:Y,roundNumber:pe,feedRound:ve,roundName:fe,drawName:X,drawType:ee,schedule:oe,drawId:Z,stage:J}),...ts(be(M),!0,!0)};if(ne&&null!=(G=M.score)&&G.scoreStringSide1){let e=no(ne),{bestOf:t,finalSetFormat:i,setFormat:n}=e??{};(null!=i&&i.tiebreakSet||null!=n&&n.tiebreakSet||null!=n&&n.timed)&&(Re.score.sets=Re.score.sets.sort(((e,t)=>e.setNumber-t.setNumber)).map(((e,r)=>(r+1===t?(null!=i&&i.tiebreakSet||null!=i&&i.timed)&&(e.tiebreakSet=!0):(null!=n&&n.tiebreakSet||null!=n&&n.timed)&&(e.tiebreakSet=!0),e))))}if(Array.isArray(le)){let{orderedDrawPositions:e,displayOrder:t}=function({drawPositions:e,roundProfile:t,roundNumber:i}){var n;let r=[void 0,void 0];if(It(e))return{orderedDrawPositions:r,displayOrder:r};let a=null==t?void 0:t[i],o=(null==(n=null==a?void 0:a.pairedDrawPositions)?void 0:n.find((t=>pt(t||[],e.filter(Boolean)))))??r,s=null==a?void 0:a.feedRound;if(gt(e)){let t=[...e].sort(Le);return{orderedDrawPositions:2===t.length?t:o,displayOrder:s?t:o}}if(s){let t=[e.find((e=>!isNaN(Be(e)))),void 0];return{orderedDrawPositions:t,displayOrder:t}}return{orderedDrawPositions:o,displayOrder:o}}({drawPositions:le,roundProfile:T,roundNumber:pe}),i=null==($=null==T?void 0:T[pe])?void 0:$.feedRound,r=t[0]!==e[0],a=e.concat(void 0,void 0).slice(0,2).map(((e,t)=>{var a;let o=t+1,s=Lh({...me,positionAssignments:n,displaySideNumber:r?3-o:o,seedAssignments:f,drawPosition:e,isFeedRound:i,sideNumber:o}),l=null==(a=M.sides)?void 0:a.find((e=>e.sideNumber===o)),u=ce?2*(ce-1)+t+1:void 0,d=u?null==Se?void 0:Se[u]:void 0;return be({sourceDrawPositionRange:d,...l,...s})}));Object.assign(Re,ts({sides:a},!0,!0))}if(i&&Re.sides){let e=null==p?void 0:p[sd],t=t=>{var i;let n=null==(i=null==v?void 0:v[t])?void 0:i.participant;return n&&Xu({template:null==e?void 0:e.participant,source:n})};if(Re.sides.filter(Boolean).forEach((e=>{var n,r,o,s;if(e.participantId){let r=ts(t(e.participantId)||(i?vd({policyDefinitions:p,participantId:e.participantId,tournamentParticipants:i,internalUse:!0,contextProfile:U}):void 0),void 0,!0);if(r){let t,i;if(null!=y&&y.entries){let a=y.entries.find((t=>t.participantId===e.participantId)),o=null==(n=null==A?void 0:A.entries)?void 0:n.find((t=>t.participantId===e.participantId));t=(null==a?void 0:a.entryStatus)||(null==o?void 0:o.entryStatus),r.entryStatus=t,null!=a&&a.entryStage&&(i=a.entryStage,r.entryStage=i)}!1!==a?Object.assign(e,{participant:r}):Object.assign(e,{participant:{entryStage:i,entryStatus:t}})}}if(null!=(o=null==(r=null==e?void 0:e.participant)?void 0:r.individualParticipantIds)&&o.length&&(null==(s=e.participant.individualParticipants)||!s.length)){let n=e.participant.individualParticipantIds.map((e=>t(e)||(i?vd({policyDefinitions:p,tournamentParticipants:i,internalUse:!0,contextProfile:U,participantId:e}):void 0)));!1!==a&&Object.assign(e.participant,{individualParticipants:n})}})),!Re.matchUpType){let{matchUpType:e}=_h({matchUp:Re});e&&Object.assign(Re,{matchUpType:e})}if(null!=U&&U.inferGender&&(!Re.gender||Re.gender===ja)&&2===(null==(q=Re.sides)?void 0:q.length)&&Re.matchUpType!==Xs){let e=Re.sides.map((e=>{var t,i,n,r;if(Xf(Ee)(Re.matchUpType))return null==(i=null==(t=e.participant)?void 0:t.person)?void 0:i.sex;if(2===(null==(r=null==(n=e.participant)?void 0:n.individualParticipants)?void 0:r.length)){let t=Qe(e.participant.individualParticipants.map((e=>{var t;return null==(t=e.person)?void 0:t.sex}))).filter(Boolean);if(1===t.length)return t[0]}}));if(2===e.filter(Boolean).length&&1===Qe(e).length){let t=e[0];Re.inferredGender=t}}}if(Re.tieMatchUps){let a=Re.matchUpStatus===Sc,o=null==(W=Re.sides)?void 0:W.map((({participant:e,drawPosition:t,sideNumber:i,lineUp:n})=>{let r=(null==e?void 0:e.participantType)===Xs&&e;return{teamParticipant:r&&_a({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participanOthertName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}),drawPosition:t,sideNumber:i,lineUp:n}}));Re.tieMatchUps=Re.tieMatchUps.map((l=>{let c=Re.matchUpId,m={finishingPositionRange:Re.finishingPositionRange,abbreviatedRoundName:he,roundNumber:pe,roundName:fe};return Bh({tieDrawPositions:le,scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,sideLineUps:o,drawPositionsRanges:r,initialRoundOfPlay:s,roundNamingProfile:u,additionalContext:m,appliedPolicies:p,isCollectionBye:a,usePublishState:h,publishStatus:S,matchUpTieId:c,isRoundRobin:D,roundProfile:T,matchUp:l,event:A,tournamentParticipants:i,positionAssignments:n,tournamentRecord:d,seedAssignments:f,participantMap:v,contextContent:g,scheduleTiming:I,contextProfile:U,drawDefinition:y,scoringActive:w,structure:R,context:N})}))}let Ne=Re.sides&&2===Re.sides.filter((e=>null==e?void 0:e.participantId)).length,Me=!Re.winningSide;if(Object.assign(Re,{readyToScore:w&&Ne&&Me,hasContext:!0}),Ne){let{allParticipantsCheckedIn:e,checkedInParticipantIds:t}=Zf({matchUp:Re});Object.assign(Re,{allParticipantsCheckedIn:e,checkedInParticipantIds:t})}return Array.isArray(null==U?void 0:U.exclude)&&(null==U||U.exclude.forEach((e=>delete Re[e]))),Re}function Vh(e){if(!Array.isArray(e.matchUps))return[];let{matchUps:t,excludeMatchUpStatuses:i,hasParticipantsCount:n,isCollectionMatchUp:r,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:u,collectionIds:d,isMatchUpTie:c,roundNumbers:p,matchUpIds:m,roundNames:f,filterMatchUpTypes:h=!0,filterMatchUpIds:v=!0,stageSequences:g,scheduledDates:I,scheduledDate:U,participantIds:y,processContext:S,tournamentIds:w,matchUpTypes:P,structureIds:D,readyToScore:T,courtIds:b,eventIds:R,venueIds:N,drawIds:M,stages:A}=e,E=Array.isArray(y)?y.filter(Boolean):[],C=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(A)?A.filter(Boolean):[],F=Array.isArray(g)?g.filter(Boolean):[],x=Array.isArray(d)?d.filter(Boolean):[],_=Array.isArray(f)?f.filter(Boolean):[],L=Array.isArray(p)?p.filter(Boolean):[],B=Array.isArray(l)?l.filter(Boolean):[],V=Array.isArray(m)&&v?m.filter(Boolean):[],j=Array.isArray(P)&&h?P.filter(Boolean):[],G=Array.isArray(b)?b.filter(Boolean):[],$=Array.isArray(N)?N.filter(Boolean):[],q=Array.isArray(s)&&s.filter(Boolean)||"string"==typeof u&&[u]||[],W=Array.isArray(I)&&I.filter(Boolean)||"string"==typeof U&&U.length&&[U]||[],H=Array.isArray(w)?w.filter(Boolean):[],z=Array.isArray(R)?R.filter(Boolean):[],Y=Array.isArray(M)?M.filter(Boolean):[],K=Array.isArray(D)?D.filter(Boolean):[];return t.filter((e=>{var t;if(T&&!Xf(ke)(e)&&!e.readyToScore||e.winningSide&&o&&![1,2].includes(e.winningSide)||void 0!==c&&(c&&!e.tieMatchUps||!c&&e.tieMatchUps)||void 0!==r&&(r&&!e.collectionId||!r&&e.collectionId)||k.length&&!k.includes(e.stage)||F.length&&!F.includes(e.stageSequence)||x.length&&(!e.collectionId||!x.includes(e.collectionId))||_.length&&(!e.roundName||!_.includes(e.roundName))||L.length&&(!e.roundNumber||!L.includes(e.roundNumber))||B.length&&(!e.roundPosition||!B.includes(e.roundPosition))||C.length&&(!e.matchUpStatus||!C.includes(e.matchUpStatus))||O.length&&e.matchUpStatus&&O.includes(e.matchUpStatus)||V.length&&!V.includes(e.matchUpId)||j.length&&(!e.matchUpType||!Mt(j,e.matchUpType))||q.length&&(!e.matchUpFormat||!q.includes(e.matchUpFormat)))return!1;if(null!=W&&W.length){let{scheduledTime:t}=Uh({matchUp:e}),{scheduledDate:i}=yh({matchUp:e}),n=Eo(t)||i;if(!W.find((e=>Go(e,n))))return!1}if(G.length){let{courtId:t}=function({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:n,timeStamp:r}=Ih({timeItems:(null==i?void 0:i.timeItems)||[],itemType:Rf});return!t||r&&e&&new Date(r).getTime()>new Date(e).getTime()?{courtId:n}:t}({matchUp:e}),{allocatedCourts:i}=function({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:n,timeStamp:r}=Ih({timeItems:(null==i?void 0:i.timeItems)||[],itemType:bf});return!t||r&&e&&new Date(r).getTime()>new Date(e).getTime()?{allocatedCourts:ts(n,!1,!0)}:t}({matchUp:e}),n=null==i?void 0:i.map((({courtId:e})=>e));if(!G.filter(Boolean).includes(t)||null!=n&&n.includes(t))return!1}if($.length){let{venueId:t}=function({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:n,timeStamp:r}=Ih({timeItems:(null==i?void 0:i.timeItems)||[],itemType:Tf});return!t||r&&e&&new Date(r).getTime()>new Date(e).getTime()?{venueId:n}:t}({matchUp:e});if(!$.filter(Boolean).includes(t))return!1}if(S){if(H.length&&!H.includes(e.tournamentId)||z.length&&!z.includes(e.eventId)||Y.length&&!Y.includes(e.drawId)||K.length&&!K.includes(e.structureId))return!1;let i=(null==(t=e.sides)?void 0:t.map((({participantId:e})=>e)).filter(Boolean))??[];if(n&&i.length<n||E.length&&!E.some((e=>i.includes(e))))return!1}return!0}))}function jh(e){var t,i,n,r,a,o,s;let{provisionalPositioning:l,tournamentRecord:u,contextFilters:d,matchUpFilters:c,contextProfile:p,drawDefinition:m,context:f={},structure:h,inContext:v,event:g}=e,{seedAssignments:I,contextContent:U,exitProfiles:y,matchUpsMap:S}=e,w={},P={};if(!h)return{collectionPositionMatchUps:w,error:Pi,roundMatchUps:P,matchUps:[]};let D=Array.isArray(null==c?void 0:c.eventIds)?null==c?void 0:c.eventIds.filter(Boolean):[],T=Array.isArray(null==c?void 0:c.structureIds)?null==c?void 0:c.structureIds.filter(Boolean):[],b=Array.isArray(null==c?void 0:c.drawIds)?null==c?void 0:c.drawIds.filter(Boolean):[],R=!(null!=f&&f.eventId)||!(null!=D&&D.length)&&!(null!=(t=null==d?void 0:d.eventIds)&&t.filter(Boolean).length)||(null==D?void 0:D.includes(f.eventId))||(null==(i=null==d?void 0:d.eventIds)?void 0:i.includes(f.eventId)),N=!(null!=T&&T.length)||T.includes(h.structureId),M=!m||!(null!=b&&b.length)||b.includes(m.drawId);if(!R||!N||!M)return{collectionPositionMatchUps:w,roundMatchUps:P,matchUps:[]};p&&!U&&(U=bm({tournamentRecord:u,contextProfile:p,drawDefinition:m}));let{appliedPolicies:A}=gm({drawDefinition:m}),E={...e.tournamentAppliedPolicies,...A,...e.policyDefinitions},C=null==(n=null==E?void 0:E.scoring)?void 0:n.structures,O=h.stage&&(null==(r=null==C?void 0:C.stage)?void 0:r[h.stage]),k=h.stageSequence&&(null==(a=null==O?void 0:O.stageSequence)?void 0:a[h.stageSequence]),F=(null==(o=null==E?void 0:E.scoring)?void 0:o.requireAllPositionsAssigned)||(null==O?void 0:O.requireAllPositionsAssigned)||(null==k?void 0:k.requireAllPositionsAssigned);S||(S=rf({drawDefinition:m,structure:h}));let{positionAssignments:x,allPositionsAssigned:_}=Jc({structure:h}),L=!F||_,{seedAssignments:B}=Xm({provisionalPositioning:l,drawDefinition:m,structure:h});I=I??B;let{structureId:V}=h;y=y||m&&cf({drawDefinition:m}).exitProfiles;let j=null==y?void 0:y[V],G=(null==j?void 0:j.length)&&(j[0].split("-").map((e=>parseInt(e))).reduce(((e,t)=>e+t))||0),$=!!h.structures,q=af({matchUpsMap:S,structureId:V,inContext:v}),W=function({roundNamingPolicy:e,drawDefinition:t,structure:i,matchUps:n}){var r,a,o;let{roundProfile:s,roundMatchUps:l}=uf({matchUps:n}),{structureAbbreviation:u,stage:d}=i,c=mf({structure:i}),p=pf({structure:i}),m=i.structures,f={},h=ff[od],v=i.stage===nl,g=v?Math.max(...((null==t?void 0:t.structures)??[]).filter((e=>e.stage===nl)).map((({stageSequence:e})=>e??1)),0):0,I=(i.stageSequence??1)<g?i.stageSequence??1:"",U=I&&((null==(r=null==e?void 0:e.affixes)?void 0:r.preQualifying)||h.affixes.preQualifying)||"",y=(null==e?void 0:e.roundNamingMap)||h.roundNamingMap||{},S=(null==e?void 0:e.abbreviatedRoundNamingMap)||h.abbreviatedRoundNamingMap||{},w=(null==(a=null==e?void 0:e.affixes)?void 0:a.preFeedRound)||h.affixes.preFeedRound,P=(null==(o=null==e?void 0:e.affixes)?void 0:o.roundNumber)||h.affixes.roundNumber,D=((null==e?void 0:e.namingConventions)||h.namingConventions).round,T=d&&d!==il?d[0]:"",b=(null==e?void 0:e.stageConstants)||h.stageConstants,R=`${U}${d&&(null==b?void 0:b[d])||T}${I}`,N=s?Object.keys(s):[],M=v&&null!=b&&b[nl]?`${null==b?void 0:b[nl]}-`:"";if(m||c||p)Object.assign(f,...N.map((e=>({[e]:{roundName:`${M}${D} ${e}`,abbreviatedRoundName:`${P}${e}`}}))));else{let t=v&&((null==e?void 0:e.qualifyingFinishMap)||(null==h?void 0:h.qualifyingFinishMap)||{});Object.assign(f,...N.map((e=>{if(null==s||!s[e])return;let{matchUpsCount:i,preFeedRound:n}=s[e],r=2*i,a=(null==t?void 0:t[null==s?void 0:s[e].finishingRound])||t&&`${P}${r}`||y[i]||`${P}${r}`,o=n?`-${w}`:"",l=[R,u,`${a}${o}`].filter(Boolean).join("-"),d=`${S[i]||`${P}${r}`}${o}`;return{[e]:{abbreviatedRoundName:[R,u,d].filter(Boolean).join("-"),roundName:l}}})))}return{roundNamingProfile:f,roundProfile:s,roundMatchUps:l}}({roundNamingPolicy:null==E?void 0:E[od],drawDefinition:m,structure:h,matchUps:q}),{roundNamingProfile:H,roundProfile:z}=W;if(P=(null==W?void 0:W.roundMatchUps)??[],c&&(q=Vh({matchUps:q,...c,filterMatchUpTypes:!1,filterMatchUpIds:!1})),v){let{sourceDrawPositionRanges:t}=function({drawDefinition:e,structureId:t,matchUpsMap:i}){if(!e)return{error:$t};if(!t)return{error:yi};let{structure:n}=Hc({drawDefinition:e,structureId:t});if((null==n?void 0:n.stage)!==rl)return{error:Oi,info:"Structure is not CONSOLATION stage"};let{links:r}=e,a=(null==r?void 0:r.filter((e=>e.target.structureId===t)))||[],o=(null==a?void 0:a.reduce(((e,t)=>{let{structureId:i}=t.source;return e.includes(i)?e:e.concat(i)}),[]))||[],s=Object.assign({},...o.map((e=>({[e]:uf({matchUps:af({structureId:e,matchUpsMap:i})}).roundProfile})))),l=af({matchUpsMap:i,structureId:t}),{roundProfile:u}=uf({matchUps:l}),d={};return null==a||a.forEach((e=>{var t,i,n;let{structureId:r,roundNumber:a}=e.source,{feedProfile:o,groupedOrder:l,positionInterleave:c,roundNumber:p}=e.target,m=s[r],f=null==(t=m[1])?void 0:t.drawPositions,h=null==(i=m[a])?void 0:i.matchUpsCount;if(!h)return;let v=h?f.length/h:0,g=f.length/v,I=f.slice(),U=of({roundPositionsCount:g,groupedOrder:l}),y=(null==U?void 0:U.length)||1;if(y<=g){let e=ht(I,f.length/y);o===yl&&e.forEach((e=>e.reverse())),I=(null==U?void 0:U.length)&&(null==U?void 0:U.map((t=>e[t-1])).flat())||I}let S=ht(I,v);if(c){let e=lt(0,c.interleave).map((()=>{})),t=lt(0,c.offset).map((()=>{}));S=S.map((t=>[t,...e])),S.unshift(t),S=S.flat(1);let i=S.length-c.offset;S=S.slice(0,i)}d[p]||(d[p]={});let w=null!=(n=null==u?void 0:u[p])&&n.feedRound?2:1;S.forEach(((e,t)=>{let i=1+t*w;d[p][i]||(d[p][i]=df(e))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:m,matchUpsMap:S,structureId:V}),i=m?function({drawDefinition:e,roundProfile:t,structureId:i,matchUpsMap:n}){var r;if(!e)return{error:$t};if(!i)return{error:yi};if(!t){let e=af({matchUpsMap:n,structureId:i});if(({roundProfile:t}=uf({matchUps:e})),!t)return{error:un}}let a=(Math.min(...(null==(r=null==t?void 0:t[1])?void 0:r.drawPositions)??[])||1)-1,o=Object.keys(t);return{drawPositionsRanges:Object.assign({},...(o||[]).map((e=>{var i,n;let r=null==(i=null==t?void 0:t[e])?void 0:i.matchUpsCount,s=(null==(n=null==t?void 0:t[1])?void 0:n.drawPositions)??[],l=ht(s,s.length/r),u=l.map(df),d=l.map((e=>e.map((e=>e-a)))).map(df),c=o.map((i=>{var n;if(i>e)return;let a=(null==(n=null==t?void 0:t[i])?void 0:n.drawPositions)??[];return ht(a,a.length/r)})).filter(Boolean),p=lt(0,r).map((e=>c.map((t=>t[e])).flat().filter(Boolean).sort(Le))).map((e=>Qe(e))),m=p.map((e=>function(e){return e.reduce(((e,t)=>{let i=e[e.length-1];return(!i||i[i.length-1]!==t-1)&&e.push([]),e[e.length-1].push(t),e}),[])}(e).map(df).join(", "))),f=Object.assign({},...lt(0,r).map((e=>({[e+1]:{firstRoundDrawPositionsRange:u[e],firstRoundOffsetDrawPositionsRange:d[e],possibleDrawPositions:p[e],drawPositionsRange:m[e]}}))));return{[e]:f}})))}}({drawDefinition:m,roundProfile:z,matchUpsMap:S,structureId:V}).drawPositionsRanges:void 0,n=e.tournamentParticipants,r=e.participantMap;!(null!=n&&n.length)&&!r&&u&&({participants:n=[],participantMap:r}=vm({participantsProfile:e.participantsProfile,useParticipantMap:e.useParticipantMap,policyDefinitions:e.policyDefinitions,tournamentRecord:u,contextProfile:p,inContext:v})),q=q.map((a=>Bh({scheduleVisibilityFilters:e.scheduleVisibilityFilters,hydrateParticipants:e.hydrateParticipants,afterRecoveryTimes:e.afterRecoveryTimes,usePublishState:e.usePublishState,scheduleTiming:e.scheduleTiming,publishStatus:e.publishStatus,sourceDrawPositionRanges:t,tournamentParticipants:n,positionAssignments:x,drawPositionsRanges:i,initialRoundOfPlay:G,roundNamingProfile:H,tournamentRecord:u,appliedPolicies:E,seedAssignments:I,contextContent:U,participantMap:r,contextProfile:p,drawDefinition:m,scoringActive:L,isRoundRobin:$,roundProfile:z,structure:h,context:f,matchUp:a,event:g}))),(null==q?void 0:q.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{let t=e.tieMatchUps;q=q.concat(...t)})),d&&(q=Vh({processContext:!0,...d,matchUps:q}))}else(null==q?void 0:q.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{let t=e.tieMatchUps;q=q.concat(...t)}));return c&&(q=Vh({matchUps:q,...c,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(null!=c&&c.matchUpTypes||null!=c&&c.matchUpIds)&&(q=Vh({matchUpTypes:c.matchUpTypes,matchUpIds:c.matchUpIds,matchUps:q})),(null!=c&&c.matchUpTypes||null!=c&&c.matchUpIds||v)&&(P=uf({matchUps:q}).roundMatchUps??[]),null!=(s=nf({drawDefinition:m,structure:h,event:g}))&&s.tieFormat&&({collectionPositionMatchUps:w}=function({matchUps:e}){let t=e.reduce(((e,t)=>!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition)),[]).map((t=>({[t]:e.filter((e=>e.collectionPosition===t))})));return{collectionPositionMatchUps:Object.assign({},...t)}}({matchUps:q})),{collectionPositionMatchUps:w,roundMatchUps:P,isRoundRobin:$,roundProfile:z,matchUpsMap:S,matchUps:q}}function Gh({matchUp:e}){return!!e&&(Vc.includes(null==e?void 0:e.matchUpStatus)||(null==e?void 0:e.winningSide))}function $h({requireParticipants:e=!0,scheduleVisibilityFilters:t,tournamentAppliedPolicies:i,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:d,contextContent:c,participantMap:p,scheduleTiming:m,publishStatus:f,contextProfile:h,drawDefinition:v,exitProfiles:g,matchUpsMap:I,structureId:U,inContext:y,structure:S,context:w,event:P}){!S&&U&&({structure:S}=Hc({drawDefinition:v,structureId:U}));let D=jh({tournamentAppliedPolicies:i,scheduleVisibilityFilters:t,tournamentParticipants:n,hydrateParticipants:r,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:l,matchUpFilters:u,contextFilters:d,contextContent:c,participantMap:p,scheduleTiming:m,publishStatus:f,contextProfile:h,drawDefinition:v,exitProfiles:g,matchUpsMap:I,structure:S,inContext:y,context:w,event:P}),T=[],b=[],R=[],N=[],M=[];if(D.error)return D;let A,{matchUps:E}=D,{assignedPositions:C}=Jc({structure:S}),O=null==C?void 0:C.filter((e=>e.participantId)).map((e=>e.drawPosition));return E.filter((e=>{var t;let i=1===(null==(t=null==u?void 0:u.matchUpTypes)?void 0:t.length)&&u.matchUpTypes[0]===Fe;return!(e.matchUpType!==Fe&&i)})).forEach((t=>{var i,n,r,a;if(t.matchUpStatus===Uc)return void T.push(t);t.matchUpType===Fe&&(A=!0);let o=t.collectionId,s=o&&(null==(i=t.sides)?void 0:i.every((e=>e.participantId))),l=!o&&2===(null==(n=t.drawPositions)?void 0:n.filter(Boolean).length),u=!o&&(null==(r=t.drawPositions)?void 0:r.every((e=>null==O?void 0:O.includes(e)))),d=null==C?void 0:C.filter((e=>e.bye)).map((e=>e.drawPosition)),c=!o&&(null==(a=t.drawPositions)?void 0:a.find((e=>null==d?void 0:d.includes(e)))),p=Gc.includes(t.matchUpStatus)&&(s||l&&(!e||u));return c?M.push(t):Gh({matchUp:t})?b.push(t):p?R.push(t):N.push(t)})),{includesTeamMatchUps:A,abandonedMatchUps:T,completedMatchUps:b,upcomingMatchUps:R,pendingMatchUps:N,byeMatchUps:M,structure:S}}function qh({finishingPositions:e,linkCondition:t,linkType:i,source:n}){var r;let a=n.find((n=>{var r,a;let o=!(null!=(r=n.source)&&r.finishingPositions)||!e||pt(e,null==(a=n.source)?void 0:a.finishingPositions);return t===n.linkCondition&&o&&n.linkType===i}));return![wl,Pl].includes(null==a?void 0:a.linkType)||null!=(r=null==a?void 0:a.source)&&r.roundNumber?a:La({result:{error:Cr},stack:"getTargetLink",context:a})}function Wh({drawDefinition:e,structureId:t,roundNumber:i}){return e?t?{links:(e.links||[]).filter(Boolean).reduce(((e,n)=>{var r,a;return(null==(r=n.source)?void 0:r.structureId)===t&&(!i||n.source.roundNumber===i)&&(e.source=e.source.concat(n)),(null==(a=n.target)?void 0:a.structureId)===t&&(!i||n.target.roundNumber===i)&&(e.target=e.target.concat(n)),e}),{source:[],target:[]})}:{error:yi}:{error:$t}}function Hh({sourceRoundMatchUpCount:e,inContextDrawMatchUps:t,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var a;if(!r)return{error:Ii};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:u,positionInterleave:d}}=r,{structure:c}=Hc({drawDefinition:n,structureId:o}),{positionAssignments:p}=Kc({structure:c}),m=(null==t?void 0:t.filter((e=>e.structureId===(null==c?void 0:c.structureId)))).filter((e=>e.roundNumber===u&&!e.matchUpTieId)),f=m.length,h=lt(1,f+1),v=f/e,g=Math.ceil(v*i),I=1-i%2;if(null!=d&&d.interleave&&.5!==v){let e=i+(d.offset+(i-1)*d.interleave);g=Math.ceil(e/2),I=1-e%2}let U=h,y=h[g-1],S=of({roundPositionsCount:h.length,groupedOrder:l}),w=(null==S?void 0:S.length)||1;if(w<=h.length){let e=ht(h,f/w);s===yl&&e.forEach((e=>e.reverse())),U=(null==S?void 0:S.length)&&(null==S?void 0:S.map((t=>e[t-1])).flat())||U}s===Ul?y=U[g-1]:s===yl?((!(null!=S&&S.length)||w>h.length)&&(g=m.length+1-g),y=U[g-1]):s===Il&&aa()&&console.log(Br,{feedProfile:s});let P,D=y&&m.reduce(((e,t)=>t.roundPosition===y?t:e),void 0);null!=D&&D.feedRound?(I=0,P=Math.min(...(D.drawPositions||[]).filter(Boolean))):P=2===(null==(a=null==D?void 0:D.drawPositions)?void 0:a.length)&&(null==D?void 0:D.drawPositions[I]);let T=null==p?void 0:p.find((({drawPosition:e})=>e===P));if(T){let{extension:e}=Cd({element:T,name:Ld});if(null!=e&&e.value)return{disabledDrawPosition:P}}return{matchUp:D,targetDrawPosition:P,matchUpDrawPositionIndex:I}}function zh({inContextDrawMatchUps:e=[],useTargetMatchUpIds:t,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;e.length&&!a&&(a=e.find((e=>e.matchUpId===r)));let{structure:o}=Hc({structureId:null==a?void 0:a.structureId,drawDefinition:n});return(null==o?void 0:o.finishingPosition)===Xl?function({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:i,structure:n,matchUp:r}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:u}=r,{links:d}=function({drawDefinition:e,roundNumber:t,structureId:i}){if(!e)return{error:$t};if(!i)return{error:yi};let{links:n}=Wh({drawDefinition:e,structureId:i});return{links:{source:n.source.reduce(((e,i)=>i.source.roundNumber&&i.source.roundNumber!==t?e:e.concat(i)),[]),target:n.target.reduce(((e,i)=>i.target.roundNumber&&i.target.roundNumber!==t?e:e.concat(i)),[])}}}({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),c=null==d?void 0:d.source,p=qh({source:c,linkType:wl}),m=qh({linkCondition:Dl,linkType:Pl,source:c}),f=qh({source:c,linkType:Pl}),h=m&&f;f||(f=m);let v,g,I,U,y,S,w,P,D,T,b=null==(a=null==p?void 0:p.target)?void 0:a.feedProfile,R=null==(o=null==f?void 0:f.target)?void 0:o.feedProfile,N=null==(s=null==m?void 0:m.target)?void 0:s.feedProfile;if(t&&(l||u)&&(w=l&&b!==gl&&e.find((({matchUpId:e})=>e===l)),U=u&&R!==gl&&e.find((({matchUpId:e})=>e===u)),w||U))return{matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p},targetMatchUps:{loserMatchUp:U,winnerMatchUp:w}};let{roundPosition:M}=r;T=T||e.filter((e=>e.structureId===n.structureId));let A=T.reduce(((e,t)=>t.roundNumber!==r.roundNumber||t.matchUpTieId?e:e+1),0);return f&&!U&&R!==gl&&({matchUpDrawPositionIndex:S,targetDrawPosition:y,matchUp:U}=Hh({targetLink:f,sourceRoundMatchUpCount:A,inContextDrawMatchUps:e,sourceRoundPosition:M,drawDefinition:i})),h&&N!==gl&&({matchUpDrawPositionIndex:I,targetDrawPosition:g,matchUp:v}=Hh({targetLink:m,sourceRoundMatchUpCount:A,inContextDrawMatchUps:e,sourceRoundPosition:M,drawDefinition:i})),p&&!w&&b!==gl&&({matchUpDrawPositionIndex:D,targetDrawPosition:P,matchUp:w}=Hh({targetLink:p,sourceRoundMatchUpCount:A,inContextDrawMatchUps:e,sourceRoundPosition:M,drawDefinition:i})),w||(T=T||e.filter((e=>e.structureId===n.structureId)),({matchUp:w}=function({structureMatchUps:e,matchUp:t}){let{roundNumber:i,roundPosition:n}=t,r=e.filter((e=>e.roundNumber===i&&!e.matchUpTieId)),a=e.filter((e=>e.roundNumber===i+1&&!e.matchUpTieId));if(a.length){let e;return a.length===r.length?e=a.find((e=>e.roundPosition===n)):a.length===r.length/2&&(e=a.find((e=>e.roundPosition===Math.ceil(n/2)))),{matchUp:e}}return{message:"no progression found"}}({structureMatchUps:T,matchUp:r}))),_a({matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p,byeTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:D,loserMatchUpDrawPositionIndex:S,byeMatchUpDrawPositionIndex:I,winnerTargetDrawPosition:P,loserTargetDrawPosition:y,byeTargetDrawPosition:g,winnerMatchUp:w,loserMatchUp:U,byeMatchUp:v},targetMatchUpIds:!(!l&&!u)})}({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:n,structure:o,matchUp:a}):function({matchUp:e}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:e}}({matchUp:a})}function Yh({drawDefinition:e,inContextDrawMatchUps:t}){let i={};return t.forEach((n=>{var r,a,o,s,l,u;let{matchUpId:d,structureId:c,drawPositions:p=[]}=n,{structure:m}=Hc({drawDefinition:e,structureId:c});if((null==m?void 0:m.finishingPosition)===Zl){let{roundNumber:e}=n,t=e&&Be(e)+1,i=m.matchUps??[],{roundMatchUps:r}=uf({matchUps:i});if(t&&null!=r&&r[t]){let e=[...p].sort(Le).map(((e,i)=>{let n=r[t].find((t=>{var i;return null==(i=t.drawPositions)?void 0:i.includes(e)}));return{matchUpId:null==n?void 0:n.matchUpId,roundNumber:t,schedule:null==n?void 0:n.schedule,sideNumber:i+1,structureName:m.structureName}}));Object.assign(n,{sidesTo:e})}}else{let c=zh({useTargetMatchUpIds:!0,inContextDrawMatchUps:t,inContextMatchUp:n,drawDefinition:e,matchUpId:d}),{winnerMatchUp:p}=c.targetMatchUps,{loserMatchUp:m}=c.targetMatchUps;!n.winnerMatchUpId&&p&&(n.winnerMatchUpId=p.matchUpId),!n.loserMatchUpId&&m&&(n.loserMatchUpId=m.matchUpId);let f=Jh({upcomingMatchUp:p}),h=Jh({upcomingMatchUp:m});if(n.matchUpStatus!==Sc&&(null==m?void 0:m.matchUpStatus)===Sc){let{matchUp:i}=Kh({matchUp:m,drawDefinition:e,inContextDrawMatchUps:t})||{};h=i&&Jh({upcomingMatchUp:i})||h}let v=null==(r=n.schedule)?void 0:r.timeAfterRecovery;if(v&&(null!=(a=null==f?void 0:f.schedule)&&a.scheduledTime&&No(f.schedule.scheduledTime)<No(v)&&(i[f.matchUpId]=n.matchUpId,f.schedule.scheduleConflict=n.matchUpId),null!=(o=null==h?void 0:h.schedule)&&o.scheduledTime&&No(h.schedule.scheduledTime)<No(v)&&(i[h.matchUpId]=n.matchUpId,h.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:f,loserTo:h}),null==(s=n.drawPositions)?void 0:s.filter(Boolean).length){let e=(null==(u=null==(l=c.targetLinks)?void 0:l.loserTargetLink)?void 0:u.linkCondition)===Dl,i=function(e){var t;return(null==(t=null==e?void 0:e.sides)?void 0:t.map((({participant:e,participantId:t,qualifier:i})=>e||t&&{participantId:t}||i&&{qualifier:i})).filter(Boolean))||[]}(n);if(i.length){let n=fc(null==p?void 0:p.sides),r=fc(null==m?void 0:m.sides),a=i.find((({participantId:e})=>n.includes(e)))?[]:i,o=i.find((({participantId:e})=>r.includes(e)))?[]:i;m&&e&&o.length<2&&o.push({bye:!0,tbd:!0}),null!=a&&a.length&&p&&(!c.targetMatchUpIds&&p&&(p=t.find((({matchUpId:e})=>e===p.matchUpId))),p.potentialParticipants||(p.potentialParticipants=[]),p.potentialParticipants.push(a)),null!=o&&o.length&&m&&(c.targetMatchUpIds||(p=t.find((({matchUpId:e})=>e===m.matchUpId))),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(o))}}}})),Object.keys(i).length&&t.forEach((e=>{Object.keys(i).includes(e.matchUpId)&&(e.schedule.scheduleConflict=i[e.matchUpId])})),{scheduleConflictMatchUpIds:i}}function Kh({matchUp:e,drawDefinition:t,inContextDrawMatchUps:i}){var n;let{matchUpId:r,matchUpStatus:a,structureId:o}=e||{};if(!e||!o||(null==e?void 0:e.matchUpStatus)===Oc)return{matchUp:e};if(a===Sc){let a;return e.winnerMatchUpId?a=i.find((({matchUpId:t})=>t===e.winnerMatchUpId)):({winnerMatchUp:a}=(null==(n=zh({inContextDrawMatchUps:i,drawDefinition:t,matchUpId:r}))?void 0:n.targetMatchUps)||{}),Kh({matchUp:a,drawDefinition:t,inContextDrawMatchUps:i})}return{matchUp:void 0}}function Jh(e){if(null!=e&&e.upcomingMatchUp)return(({matchUpId:e,structureId:t,schedule:i,roundNumber:n,roundPosition:r,structureName:a})=>({matchUpId:e,structureId:t,schedule:i,roundNumber:n,roundPosition:r,structureName:a}))(e.upcomingMatchUp)}function Qh(e){Object.assign(e,{requireParticipants:!1});let t=Zh(e);if(t.error)return La({result:t,stack:"getAllDrawMatchUps"});let{abandonedMatchUps:i,completedMatchUps:n,upcomingMatchUps:r,pendingMatchUps:a,byeMatchUps:o,matchUpsMap:s}=t;return{matchUps:(i??[]).concat(...n??[],...r??[],...a??[],...o??[]),matchUpsMap:s}}function Zh(e){if(null==e||!e.drawDefinition)return{error:$t};let t,{tournamentParticipants:i,contextContent:n,matchUpsMap:r}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,requireParticipants:s,participantsProfile:l,afterRecoveryTimes:u,policyDefinitions:d,tournamentRecord:c,usePublishState:p,contextFilters:m,matchUpFilters:f,scheduleTiming:h,participantMap:v,publishStatus:g,contextProfile:I,drawDefinition:U,nextMatchUps:y,inContext:S,context:w,event:P}=e,D=[],T=[],b=[],R=[],N=[];I&&!n&&(n=bm({policyDefinitions:d,tournamentRecord:c,contextProfile:I,event:P})),(null==i||!i.length)&&c&&(i=null==c?void 0:c.participants,(S||null!=l&&l.withGroupings)&&null!=i&&i.length&&({participantsWithGroupings:i,groupInfo:t}=Xp({participants:i,participantsProfile:l})));let{structures:M}=zc({drawDefinition:U});if(!M)return{error:Si};r||(r=rf({drawDefinition:U}));let A=U&&cf({drawDefinition:U}).exitProfiles;M.forEach((t=>{let{byeMatchUps:l=[],pendingMatchUps:M=[],upcomingMatchUps:E=[],completedMatchUps:C=[],abandonedMatchUps:O=[]}=$h({matchUpFilters:y?void 0:f,contextFilters:y?void 0:m,inContext:S||y||m,hydrateParticipants:e.hydrateParticipants,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:i,requireParticipants:s,afterRecoveryTimes:u,policyDefinitions:d,tournamentRecord:c,usePublishState:p,contextContent:n,participantMap:v,scheduleTiming:h,publishStatus:g,contextProfile:I,drawDefinition:U,exitProfiles:A,matchUpsMap:r,structure:t,context:w,event:P});D=D.concat(...O),T=T.concat(...C),b=b.concat(...E),R=R.concat(...M),N=N.concat(...l)}));let E=e=>(!f&&!y&&!m||(f&&(e=Vh({matchUps:e,...f})),m&&(e=Vh({matchUps:e,...m,processContext:!0}))),e),C={abandonedMatchUps:E(D),completedMatchUps:E(T),upcomingMatchUps:E(b),pendingMatchUps:E(R),byeMatchUps:E(N),matchUpsMap:r,...At,groupInfo:t};if(y){let e="object"==typeof y||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:t,completed:i,upcoming:n,pending:r,bye:a}=e;Yh({inContextDrawMatchUps:[].concat(...t&&D||[],...i&&T||[],...n&&b||[],...r&&R||[],...a&&N||[]),drawDefinition:U})}return C}function Xh(e){let{participants:t=[],contextContent:i,participantMap:n}=e,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:d,usePublishState:c,contextFilters:p,matchUpFilters:m,contextProfile:f,nextMatchUps:h,inContext:v,context:g,event:I}=e;if(!I)return{error:bi};let U,{eventId:y,eventName:S,endDate:w,eventType:P,category:D,gender:T,matchUpFormat:b}=I??{},R={...g,..._a({indoorOutDoor:I.indoorOutdoor??(null==d?void 0:d.indoorOutdoor),surfaceCategory:I.surfaceCategory??(null==d?void 0:d.surfaceCategory),endDate:I.endDate??(null==d?void 0:d.endDate),tournamentId:null==d?void 0:d.tournamentId,matchUpFormat:b,eventName:S,eventType:P,category:D,eventId:y,gender:T})};if(w&&(R.endDate=w),f&&!i&&(i=bm({policyDefinitions:l,tournamentRecord:d,contextProfile:f,event:I})),(null==t||!t.length)&&!n&&d){let e=vm({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:d,contextProfile:f,inContext:v});n=e.participantMap,t=e.participants??[],U=e.groupInfo}let N=I.drawDefinitions??[],M=Nm({tournamentRecord:d,event:I}).scheduleTiming;return{matchUps:N.flatMap((e=>{let{matchUps:u}=Qh({tournamentParticipants:t,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:R,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:d,usePublishState:c,contextFilters:p,contextProfile:f,drawDefinition:e,contextContent:i,matchUpFilters:m,participantMap:n,scheduleTiming:M,nextMatchUps:h,inContext:v,event:I});return u??[]})),groupInfo:U}}function ev(e){let t=qu(e,[{tournamentRecord:!0}]);if(t.error)return t;if(null==e||!e.tournamentRecord)return{error:Bt};let{participantMap:i,participants:n}=e,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:d=!0,usePublishState:c,contextProfile:p,matchUpFilters:m,contextFilters:f,nextMatchUps:h,context:v}=e,g=e.tournamentId??u.tournamentId,I=(null==u?void 0:u.events)??[];n||({participants:n,participantMap:i}=vm({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:d}));let{appliedPolicies:U}=gm({tournamentRecord:u}),y={...v,tournamentId:g,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},S=bm({policyDefinitions:l,tournamentRecord:u,contextProfile:p});return{matchUps:I.flatMap((e=>{var t;return y.eventDrawsCount=(null==(t=e.drawDefinitions)?void 0:t.length)??0,Xh({context:y,scheduleVisibilityFilters:r,tournamentAppliedPolicies:U,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,usePublishState:c,contextContent:S,contextFilters:f,contextProfile:p,matchUpFilters:m,participantMap:i,nextMatchUps:h,participants:n,inContext:d,event:e}).matchUps??[]})).concat(...u.matchUps??[])}}function tv({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u}){if("object"!=typeof n||!Object.keys(n).length)return{error:Lt};let d=Object.keys(n).map((d=>{let c=n[d];return ev({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:i,policyDefinitions:r,tournamentRecord:c,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:l,inContext:u}).matchUps??[]})).flat();return{...At,matchUps:d}}function iv(e,t){return function(e,t){return(ll[null==e?void 0:e.stage]||0)-(ll[null==t?void 0:t.stage]||0)}(e,t)||((null==e?void 0:e.stageSequence)||0)-((null==t?void 0:t.stageSequence)||0)||(null==e?void 0:e.roundNumber)&&t.roundNumber&&(null==e?void 0:e.roundNumber)-(null==t?void 0:t.roundNumber)||((null==e?void 0:e.roundPosition)??0)-((null==t?void 0:t.roundPosition)??0)}function nv(e){let t,{participants:i,participantMap:n,contextContent:r}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,useParticipantMap:d,tournamentRecord:c,matchUpFilters:p,contextFilters:m,contextProfile:f,drawDefinition:h,nextMatchUps:v,inContext:g,context:I,event:U}=e,{eventId:y,eventName:S,endDate:w,eventType:P,category:D,gender:T,matchUpFormat:b}=U??{},R={...I,surfaceCategory:(null==U?void 0:U.surfaceCategory)??(null==c?void 0:c.surfaceCategory),indoorOutDoor:(null==U?void 0:U.indoorOutdoor)??(null==c?void 0:c.indoorOutdoor),matchUpFormat:b,eventType:P,eventName:S,category:D,eventId:y,endDate:w,gender:T};return!(null!=i&&i.length)&&!n&&c&&({participants:i=[],participantMap:n,groupInfo:t}=vm({participantsProfile:s,useParticipantMap:d,policyDefinitions:u,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!r&&(r=bm({policyDefinitions:u,tournamentRecord:c,contextProfile:f,drawDefinition:h,event:U})),{...Qh({context:R,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:i,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:m,contextProfile:f,matchUpFilters:p,participantMap:n,nextMatchUps:v,inContext:g,event:U}),groupInfo:t}}function rv({element:e,accessor:t}){if("string"!=typeof t)return{values:[]};let i,n=ts(e),r=t.split("."),a=[];!function e({targetElement:t,attributes:n=[],significantCharacters:r}){for(let[s,l]of n.entries())if(null!=t&&t[l]){let r=n.slice(s+1);r.length?Array.isArray(t[l])?t[l].forEach((t=>e({targetElement:t,attributes:r}))):o({targetElement:t=t[l],index:s}):(i||(i=t[l]),a.includes(t[l])||a.push(t[l]))}function o({targetElement:e,index:t}){if(e&&t===n.length-1&&["string","number"].includes(typeof e)){let t=r?e.slice(0,r):e;i?a.includes(t)||a.push(t):(i=t,a.push(t))}}}({targetElement:n,attributes:r});let o={value:i};return a.length&&(o.values=a),o}var av=e=>t=>{var i;return e&&"object"==typeof t?Array.isArray(e)&&e.map((e=>{var i;return{[e]:null==(i=rv({element:t,accessor:e}))?void 0:i.value}}))||"object"==typeof e&&Object.keys(e).map((e=>{var i;return{[e]:null==(i=rv({element:t,accessor:e}))?void 0:i.value}}))||(null==(i="string"==typeof e&&rv({element:t,accessor:e}))?void 0:i.value):void 0},ov=av;function sv({finishingPositionOffset:e=0,finishingPositionLimit:t,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:o,fmlc:s}){var l;if(!lf(a))return[];let{roundProfile:u,roundNumbers:d=[]}=uf({interpolate:!0,matchUps:a});n=n??Math.max(...d,0);let c=r?n-r:0,p=c&&(null==(l=null==u?void 0:u[n-c])?void 0:l.matchUpsCount),m=u&&Object.values(u).map(ov("matchUpsCount")),f=(e,i)=>{let n=Math.min(...e);p&&i&&1===n&&(n=p);let r=Math.max(...e);return t&&r>t&&(r=t),[n,r]},h=u&&Object.assign({},...d.map((t=>{let r=(n??0)+1-t-c,a=u[t].matchUpsCount,l={finishingPositionRange:{},finishingRound:r},d=null==m?void 0:m.slice(t-1).reduce(((e,t)=>e+(t||0)),0),p=1+e+(s&&1!==t?i??0:0),h=lt(p,o?p+2*a:d+p+1),v=d+1-a,g=f(h.slice(v)),I=f(h.slice(0,v),!0);return l.finishingPositionRange={loser:g,winner:I},{[t]:l}}))),v=aa({finishingRound:!0});return a.filter(Boolean).forEach((e=>{let t=e.roundNumber&&h[e.roundNumber];v&&!t&&console.log({roundFinishingData:h,matchUp:e}),e.finishingRound=null==t?void 0:t.finishingRound,e.finishingPositionRange=null==t?void 0:t.finishingPositionRange})),a}function lv({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:i}){var n;if(!t)return{error:$t};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(e||({matchUps:e,matchUpsMap:i}=Qh({inContext:!0,drawDefinition:t,matchUpsMap:i})),!(null!=i&&i.drawMatchUps.some((e=>e.finishingPositionRange))||1!==(null==(n=null==t?void 0:t.structures)?void 0:n.length)||null!=t&&t.structures[0].structures)){sv({matchUps:(null==i?void 0:i.drawMatchUps)??[]})}return(e??[]).filter((({collectionId:e})=>!e)).forEach((n=>{let{matchUpId:a,structureId:o}=n,s=zh({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=s.targetMatchUps,d=null==l?void 0:l.matchUpId,c=null==u?void 0:u.matchUpId,p=af({matchUpsMap:i,structureId:o}).find((e=>e.matchUpId===a));if(p&&(d&&(r.winnerMatchUpIds[p.matchUpId]=d,Object.assign(p,{winnerMatchUpId:d}),Object.assign(n,{winnerMatchUpId:d})),c&&(r.loserMatchUpIds[p.matchUpId]=c,n.loserMatchUpId=c,p.loserMatchUpId=c,n.finishingPositionRange))){let e=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],t=e&&[Math.min(...e),Math.max(...e)];n.finishingPositionRange.loser=t,p.finishingPositionRange.loser=t}})),{inContextDrawMatchUps:e,goesToMap:r}}function uv(e){var t;let i=Gp(e),n=e.matchUps??[],r=e.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=e;if(!Array.isArray(n))return{error:Ki};if(!Array.isArray(r))return{error:li};let l=null!=(t=e.matchUpIds)&&t.length?e.matchUpIds:n.map((e=>e.matchUpId));if(!Array.isArray(l))return{error:zi};let u={},d={},c={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let m=Object.values(i),f=m.reduce(((e,t)=>e.concat(t.events??[]).map((e=>(e.drawDefinitions||[]).map((e=>e.links||[])))).flat(1/0)),[]).filter((({linkType:e})=>e===Sl)),h=n;if(f.length){h=tv({nextMatchUps:!0,tournamentRecords:i}).matchUps;let e=f.reduce(((e,t)=>{var i,n;let r=null==(i=t.source)?void 0:i.structureId,a=null==(n=t.target)?void 0:n.structureId;return r&&a&&(c[a]=r),r&&!e.includes(r)&&e.push(r),e}),[]);for(let t of e)u[t]=[];for(let t of h??[]){let i=t.containerStructureId||t.structureId;e.includes(i)&&u[i].push(t.matchUpId)}}let v=e=>{d[e]||(d[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[e]=[])},g=(e,t)=>{d[e].matchUpIds.forEach((e=>{d[t].matchUpIds.push(e)})),d[t].matchUpIds.push(e),d[e].dependentMatchUpIds.push(t),a&&d[e].participantIds.forEach((e=>d[t].participantIds.push(e)))},I=e=>{let t=Object.keys(u).length;for(let i of e||[]){let{matchUpId:e,winnerMatchUpId:n,loserMatchUpId:r}=i;if(!l.length||l.includes(e)){if(v(e),a){let{individualParticipantIds:t}=jp(i);d[e].participantIds=t}n&&(v(n),g(e,n),p[n].push(e)),r&&(v(r),g(e,r),p[r].push(e)),d[e].sources.push(p[e]);let o=p[e].map((e=>d[e].sources[0])).flat(),s=p[e].map((e=>d[e].sources[1])).flat();if(d[e].sources.push(o,s),t){let t=i.containerStructureId||i.structureId,n=c[t];if(u[n])for(let i of u[n])v(i),g(i,e),p[i].push(e)}}}};if(s)lv({drawDefinition:s}),null!=h&&h.length||(h=nv({drawDefinition:s}).matchUps),I(h);else{if(null!=h&&h.length||(h=tv({nextMatchUps:!0,tournamentRecords:i}).matchUps),!r.length){let e=null!=m&&m.length?m.map((({events:e=[]})=>e.map((({drawDefinitions:e=[]})=>e.map((({drawId:e})=>e)))))).flat(1/0):[];e&&(r=e)}for(let e of r){let t=null==h?void 0:h.filter((t=>t.drawId===e)).sort(iv);if(null==t||!t.find((({roundPosition:e})=>!e))){let n=null==t?void 0:t.find((({tournamentId:e})=>e)),{drawDefinition:r}=Ch({tournamentRecord:i[null==n?void 0:n.tournamentId],drawId:e});r&&lv({drawDefinition:r})}I(t)}}return{positionDependencies:u,matchUpDependencies:d,sourceMatchUpIds:p,matchUps:h,...At}}function dv(e){var t,i;let n=null==e?void 0:e.matchUp,r=(null==e?void 0:e.score)||(null==n?void 0:n.score),a=null==(t=null==r?void 0:r.sets)?void 0:t[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:u,side1PointScore:d,side2PointScore:c}=a||{},p=o||s||l||u||d||c;return!!((null==(i=null==r?void 0:r.sets)?void 0:i.length)>1||p)}function cv({matchUpStatus:e}){return Lc.includes(e)}function pv({matchUpStatus:e}){return Bc.includes(e)}function mv({matchUpStatus:e,winningSide:t,tieMatchUps:i,sides:n,score:r}){var a;let o=null==n?void 0:n.find((({participantId:e})=>e)),s=null==(a=null==i?void 0:i.filter(mv))?void 0:a.length;return dv({score:r})||s||t&&o||e&&function({matchUpStatus:e}){return jc.includes(e)}({matchUpStatus:e})&&![Tc,kc,Nc].includes(e)}function fv(e){var t;let{drawDefinition:i,findContainer:n,structureId:r,event:a}=e,o=e.structure,{containedStructures:s}=Vp({drawDefinition:i}),l=r&&s[r]||[];if(!o){let e=Hc({drawDefinition:i,structureId:r});if(e.error)return e;o=n?e.containingStructure??e.structure:e.structure}if(mf({structure:o}))return{structure:o,isAdHoc:!0,error:ii};let{matchUps:u}=Qh({inContext:!0,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:i,event:a}),d=null==u?void 0:u.filter((e=>e.structureId===r||l.includes(e.structureId))),{matchUpDependencies:c}=uv({drawIds:[i.drawId],matchUps:u,drawDefinition:i}),p=[],m=[],f={},h=[];for(let P of u??[]){if(P.structureId===r||l.includes(P.structureId)){m.push(...P.drawPositions??[]);let e=P.roundNumber;for(let t of(P.drawPositions??[]).filter(Boolean))(!f[t]||e&&f[t]>e)&&(f[t]=e)}mv(P)&&(h.push(P),p.push(P.matchUpId,...(null==(t=null==c?void 0:c[null==P?void 0:P.matchUpId])?void 0:t.matchUpIds)||[]))}let v=Qe(m.filter(Boolean)).sort(Le),g=Qe(p),I=Qe(null==d?void 0:d.map((({matchUpId:e,drawPositions:t})=>g.includes(e)?t:[])).flat().filter(Boolean)).sort(Le),{positionAssignments:U}=Kc({drawDefinition:i,structure:o}),y=null==U?void 0:U.filter((e=>e.bye)).map((e=>e.drawPosition)),S=null==U?void 0:U.filter((e=>e.qualifier)).map((e=>e.drawPosition)),w=(null==v?void 0:v.filter((e=>!I.includes(e))))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:f,activeDependentMatchUpIds:g,qualifyingDrawPositions:S,inactiveDrawPositions:w,positionAssignments:U,activeDrawPositions:I,byeDrawPositions:y,activeMatchUps:h,structure:o}}function hv({drawPosition:e,matchUps:t=[]}){return{initialRoundNumber:t.filter((({drawPositions:t})=>e&&(null==t?void 0:t.includes(e)))).map((({roundNumber:e})=>e)).sort(Le)[0]}}var vv={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",red:"\x1b[31m",brightred:"\x1b[91m",green:"\x1b[32m",brightgreen:"\x1b[92m",yellow:"\x1b[33m",brightyellow:"\x1b[93m",blue:"\x1b[34m",brightblue:"\x1b[94m",lightblue:"\x1b[105m",magenta:"\x1b[35m",brightmagenta:"\x1b[95m",cyan:"\x1b[36m",brightcyan:"\x1b[96m",white:"\x1b[37m",brightwhite:"\x1b[97m"},gv=[];function Iv(e,t){St(e)&&(e={method:e}),(t||aa())&&gv.push(e)}function Uv(e){let t=function(e){let t=gv.slice();return e&&(gv.length=0),t}(e).map((e=>{let{color:t,keyColors:i,method:n,newline:r}=e,a=Object.keys(vv).includes(t)?vv[t]:vv.cyan,o=Object.keys(e).filter((e=>!["color","keyColors","method","newline"].includes(e))).map((t=>{let n=i&&Object.keys(i).includes(t)&&vv[i[t]]?vv[i[t]]:vv.brightwhite;return`${vv.white}${t}: ${n}${e[t]}`})).join(", ");return[r?"\n":"",a,n,(null==n?void 0:n.length)<15?"\t\t":"\t",vv.white,o,vv.reset,"\n"].join("")}));null!=t&&t.length&&console.log(...t)}function yv({provisionalPositioning:e,isPositionAction:t,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:o,structure:s,event:l}){var u,d,c;if(!n)return{error:$t};if(s||({structure:s}=Hc({drawDefinition:n,structureId:o})),!s)return{error:Si};o||({structureId:o}=s);let p="assignDrawPositionBye";Iv({method:p,color:"cyan",drawPosition:r}),a||(a=rf({drawDefinition:n}));let{positionAssignments:m}=Kc({structure:s}),{activeDrawPositions:f}=fv({drawDefinition:n,structureId:o});if(null!=(u=null==m?void 0:m.find((e=>e.drawPosition===r)))&&u.bye)return{...At};if(null!=f&&f.includes(r))return{error:ei};let h=null==m?void 0:m.find((e=>e.drawPosition===r));if(!h)return{error:ii};let{filled:v,containsBye:g,assignedParticipantId:I}=function(e){let t=e.bye,i=e.qualifier,n=e.participantId;return{containsBye:t,containsQualifier:i,assignedParticipantId:n,filled:t||i||n}}(h);if(g)return{...At};if(v&&!g)return La({result:{error:Kt},stack:p});let U=gm({tournamentRecord:i,drawDefinition:n,event:l}).appliedPolicies??{},y=Qh({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],{matchUps:S}=jh({provisionalPositioning:e,drawDefinition:n,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:a,structure:s});if(null==m||m.forEach((e=>{e.drawPosition===r&&(e.bye=!0)})),s.structureType===vl)return function({tournamentRecord:e,drawDefinition:t,drawPosition:i,matchUps:n,event:r}){n.forEach((n=>{var a;null!=(a=n.drawPositions)&&a.includes(i)&&wv({eventId:null==r?void 0:r.eventId,tournamentRecord:e,drawDefinition:t,matchUp:n})}))}({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:S}),xp({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),Sv({assignedParticipantId:I,isPositionAction:t,appliedPolicies:U,drawDefinition:n,drawPosition:r,structureId:o,stack:p});let{roundProfile:w,roundMatchUps:P}=uf({matchUps:S}),D=null==(d=w&&Object.keys(w).map((e=>parseInt(e))).reverse())?void 0:d.find((e=>{var t;return null==(t=null==w?void 0:w[e].drawPositions)?void 0:t.includes(r)})),T=D?null==P?void 0:P[D].find((({drawPositions:e})=>null==e?void 0:e.includes(r))):void 0;T&&wv({tournamentRecord:i,drawDefinition:n,matchUp:T,event:l});let b=null==(c=null==T?void 0:T.drawPositions)?void 0:c.find((e=>e!==r));if(T&&b){let e=Pv({sourceDrawPositions:T.drawPositions,matchUpId:T.matchUpId,inContextDrawMatchUps:y,drawPositionToAdvance:b,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(e.error)return e}return xp({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),Sv({assignedParticipantId:I,isPositionAction:t,appliedPolicies:U,drawDefinition:n,drawPosition:r,structureId:o,stack:p})}function Sv({assignedParticipantId:e,isPositionAction:t,appliedPolicies:i,drawDefinition:n,drawPosition:r,structureId:a,stack:o}){return t&&Bp({appliedPolicies:i,drawDefinition:n,positionAction:{removedParticipantId:e,drawPosition:r,structureId:a,name:o}}),La({result:{...At},stack:o})}function wv({tournamentRecord:e,drawDefinition:t,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:Sc,score:void 0,winningSide:void 0}),Cp({tournamentId:null==e?void 0:e.tournamentId,eventId:i??(null==r?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:t,matchUp:n})}function Pv({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,event:s}){var l,u;Iv({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:e});let d=a.drawMatchUps.find((e=>e.matchUpId===o)),c=null==(l=t.find((e=>e.matchUpId===o)))?void 0:l.structureId,{structure:p}=Hc({drawDefinition:r,structureId:c}),{positionAssignments:m}=Kc({structure:p}),f=null==m?void 0:m.filter((e=>e.bye)).map((e=>e.drawPosition)),h=null==(u=null==d?void 0:d.drawPositions)?void 0:u.find((t=>t!==e)),v=h&&(null==f?void 0:f.includes(h)),{targetLinks:{loserTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:U,loserTargetDrawPosition:y}}=zh({inContextDrawMatchUps:t,drawDefinition:r,matchUpId:o});if(U&&U.structureId===(null==p?void 0:p.structureId)&&function({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,u,d,c,p,m;let f="advanceWinner",h=o.drawMatchUps.find((e=>e.matchUpId===a.matchUpId)),v=null==(l=t.find((e=>e.matchUpId===a.matchUpId)))?void 0:l.structureId,{structure:g}=Hc({drawDefinition:r,structureId:v}),{positionAssignments:I}=Kc({structure:g}),U=null==(u=null==I?void 0:I.find((({drawPosition:t})=>t===e)))?void 0:u.bye,y=null==(d=h.drawPositions)?void 0:d.filter(Boolean),S=null==I?void 0:I.filter((e=>null==y?void 0:y.includes(e.drawPosition))),w=null==I?void 0:I.find((({drawPosition:t})=>t===e)),P=null==i?void 0:i.find((t=>t!==e)),D=null==(c=P&&(null==S?void 0:S.find((({drawPosition:e})=>e===P))))?void 0:c.bye,T=U&&D;if(T&&console.log({isByeAdvancedBye:T}),(null==y?void 0:y.length)>1&&U&&!D)return La({result:{error:Kt},stack:f});let b=null==y?void 0:y.find((t=>t!==e)),R=T,N=[...(h.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),M=N.map((t=>!t&&!R||t===e?(R=!0,e):t)).sort(Le);if(!R)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:e,existingAssignments:S}),La({result:{error:Kt},stack:f});let A=null==(p=null==I?void 0:I.find((({drawPosition:e})=>e===b)))?void 0:p.bye,E=null==(m=null==I?void 0:I.find((({drawPosition:t})=>t===e)))?void 0:m.bye;Object.assign(h,{matchUpStatus:E||A?Sc:Oc,score:void 0,winningSide:void 0,drawPositions:M});let C=h.drawPositions.find((e=>!N.includes(e)));Iv({method:f,color:"brightyellow",changedDrawPosition:C,pairedDrawPositionIsBye:A,drawPositionIsBye:E}),Cp({tournamentId:null==n?void 0:n.tournamentId,matchUp:h,eventId:null==s?void 0:s.eventId,context:f,drawDefinition:r});let{targetLinks:{loserTargetLink:O},targetMatchUps:{loserMatchUp:k,loserTargetDrawPosition:F}}=zh({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:r});if(A||E){let i=A?e:b;if(i)Pv({drawPositionToAdvance:i,matchUpId:a.matchUpId,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:r,matchUpsMap:o});else if(E&&O&&k)if(k.feedRound)Dv({loserTargetDrawPosition:F,tournamentRecord:n,loserTargetLink:O,drawDefinition:r,loserMatchUp:k,matchUpsMap:o});else{let e=1-a.roundPosition%2,t=k.drawPositions[e],i=yv({structureId:O.target.structureId,drawPosition:t,tournamentRecord:n,drawDefinition:r,event:s});if(i.error);}}}({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:U,matchUpsMap:a,event:s}),I&&v&&I.structureId!==(null==p?void 0:p.structureId)){let{roundNumber:e}=I;if(1===e){let e=yv({structureId:g.target.structureId,drawPosition:y,tournamentRecord:n,drawDefinition:r,event:s});if(e.error)return e}else Dv({loserTargetDrawPosition:y,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:I,matchUpsMap:a,event:s})}return{...At}}function Dv({loserTargetDrawPosition:e,tournamentRecord:t,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){let{roundNumber:s}=r;Iv({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:e});let l=((null==a?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:u}=hv({drawPosition:e,matchUps:l});if(u===s){let r=yv({structureId:i.target.structureId,drawPosition:e,tournamentRecord:t,drawDefinition:n,event:o});if(r.error)return r}}function Tv({positionAssignments:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:o}=jh({drawDefinition:i,matchUpsMap:n,structure:r,event:a});o.forEach((n=>{let r=e.filter((({drawPosition:e})=>{var t;return null==(t=n.drawPositions)?void 0:t.includes(e)})).filter((e=>e.bye)).length;n.winningSide||(Object.assign(n,{matchUpStatus:r?Sc:Oc}),Cp({tournamentId:null==t?void 0:t.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:null==a?void 0:a.eventId,drawDefinition:i,matchUp:n}))}))}function bv(e){let{inContextDrawMatchUps:t,participantId:i,drawPosition:n}=e,{tournamentRecord:r,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=e,{structure:u}=Hc({drawDefinition:a,structureId:o}),d=(Jc({drawDefinition:a,structure:u}).positionAssignments||[]).find((e=>i&&e.participantId===i||n&&e.drawPosition===n));if(d&&i&&!n&&(n=null==d?void 0:d.drawPosition),!n)return{error:ni};i||(i=null==d?void 0:d.participantId);let{activeDrawPositions:c}=fv({drawDefinition:a,structureId:o});return c.includes(n)?{error:ei}:(t||({matchUps:t}=Qh({inContext:!0,drawDefinition:a,matchUpsMap:s})),Rv({inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:a,structureId:o,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(xp({tournamentId:null==r?void 0:r.tournamentId,drawDefinition:a,structure:u,event:l}),{...At,participantId:i}):{error:Qt})}function Rv({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:o}){var s,l;let{structure:u}=Hc({drawDefinition:i,structureId:a});if(!u)return{error:Si};let d=Jc({drawDefinition:i,structure:u}).positionAssignments||[],c=d.some((e=>{if(e.drawPosition===n)return delete e.participantId,delete e.qualifier,delete e.bye,!0}));if(u.structureType===vl)return Tv({positionAssignments:d,tournamentRecord:t,drawDefinition:i,matchUpsMap:r,structure:u}),{drawPositionCleared:c,...At};let{matchUps:p}=jh({drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:u,event:o}),{roundProfile:m,roundMatchUps:f}=uf({matchUps:p}),h=null==(s=m&&Object.keys(m))?void 0:s.map((e=>Be(e))),v=n,g=null==(l=null==h?void 0:h.map((e=>{var t,i,n,r;let a=null==(i=null==(t=null==m?void 0:m[e])?void 0:t.pairedDrawPositions)?void 0:i.find((e=>e.includes(v))),o=null==a?void 0:a.find((e=>e!==v)),s=d.find((e=>e.drawPosition===o)),l=null==m?void 0:m[e+1],u=null==s?void 0:s.bye,c=null==(n=null==l?void 0:l.pairedDrawPositions)?void 0:n.find((e=>e.includes(o))),p=u&&c&&l&&(null==(r=l.drawPositions)?void 0:r.includes(o)),f=a&&{pairedDrawPositionByeAdvancedPair:!p&&c,pairedDrawPosition:o,targetDrawPosition:v,relevantPair:a,roundNumber:e};return p&&(v=o),f})).filter((e=>null==e?void 0:e.targetDrawPosition)))?void 0:l.reduce(((e,t)=>{let{roundNumber:i,relevantPair:n,targetDrawPosition:r,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=t,s=[{roundNumber:i,targetDrawPosition:r,relevantPair:n},o&&{roundNumber:i+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat(...s)}),[]);return null==g||g.forEach((({roundNumber:s,targetDrawPosition:l,relevantPair:c})=>{let p=null==f?void 0:f[s].find((e=>{var t;return pt(null==(t=e.drawPositions)?void 0:t.filter(Boolean),c.filter(Boolean))}));p&&(function({inContextDrawMatchUps:e,targetDrawPosition:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:o}){let{structure:s}=Hc({drawDefinition:n,structureId:o});if(!s)return{error:Si};if(s.structureType===vl)return;r=r||rf({drawDefinition:n});let l=((null==r?void 0:r.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=hv({drawPosition:t,matchUps:l}),d=null==l?void 0:l.filter((e=>{var i;return e.roundNumber>=a&&e.roundNumber!==u&&(null==(i=e.drawPositions)?void 0:i.includes(t))})),c=Kc({drawDefinition:n,structureId:o}).positionAssignments??[];null==d||d.forEach((a=>Nv({drawPosition:t,targetMatchUp:a,inContextDrawMatchUps:e,positionAssignments:c,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})))}({inContextDrawMatchUps:e,targetDrawPosition:l,tournamentRecord:t,drawDefinition:i,structureId:a,roundNumber:s,matchUpsMap:r}),Nv({inContextDrawMatchUps:e,positionAssignments:d,tournamentRecord:t,drawDefinition:i,targetMatchUp:p,drawPosition:n,matchUpsMap:r,structure:u,event:o}))})),{tasks:g,drawPositionCleared:c,positionAssignments:d}}function Nv({inContextDrawMatchUps:e,positionAssignments:t,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var u,d,c,p,m;let f="removeDrawPosition",h=null==(u=r.drawPositions)?void 0:u.slice(),v=r.matchUpStatus,g=r.winningSide,I=(o=o??rf({drawDefinition:n})).mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:U}=hv({drawPosition:a,matchUps:I});if(r.roundNumber&&U&&r.roundNumber>U){let e=(r.drawPositions??[]).map((e=>e===a?void 0:e));r.drawPositions=e}if(r.matchUpType===Fe){let t=((null==(d=null==e?void 0:e.find((e=>e.matchUpId===r.matchUpId)))?void 0:d.sides)??[]).reduce(((e,t,i)=>t.drawPosition===a?i:e),void 0);void 0!==t&&null!=(p=null==(c=r.sides)?void 0:c[t])&&p.lineUp&&(null==(m=r.sides)||delete m[t].lineUp,Cp({tournamentId:null==i?void 0:i.tournamentId,context:`${f}-TEAM`,eventId:null==l?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let y=zh({matchUpId:r.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetLinks:{winnerTargetLink:S},targetMatchUps:{loserMatchUp:w,winnerMatchUp:P,loserMatchUpDrawPositionIndex:D}}=y,T=t.filter((({drawPosition:e})=>{var t;return null==(t=r.drawPositions)?void 0:t.includes(e)})).filter((e=>e.bye)).length,b=T&&Sc||r.matchUpStatus&&[Tc,kc].includes(r.matchUpStatus)&&r.matcHUpStatus||Oc;r.matchUpStatus=b,r.matchUpStatus&&[kc,Tc].includes(r.matchUpStatus)&&(r.winningSide=void 0);let R=null==h?void 0:h.find((e=>{var t;return!(null!=(t=r.drawPositions)&&t.includes(e))}));if(null!=h&&h.includes(a)&&v===r.matchUpStatus&&g===r.winningSide||(R&&Iv({method:f,color:"brightyellow",removedDrawPosition:R}),Cp({tournamentId:null==i?void 0:i.tournamentId,context:`${f}-${a}`,eventId:null==l?void 0:l.eventId,matchUp:r,drawDefinition:n})),w&&w.structureId!==y.matchUp.structureId&&!T){let{drawPositions:t,roundNumber:r}=w;if(1===r){let r=t[D];Rv({structureId:w.structureId,drawPosition:r,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:o})}else{let r=Math.min(...t.filter(Boolean)),a=function({loserMatchUpDrawPosition:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){var s;let{structure:l}=Hc({structureId:r.structureId,drawDefinition:n}),{positionAssignments:u}=Kc({structure:l});if(null!=(s=null==u?void 0:u.find((t=>t.drawPosition===e)))&&s.bye){let s=bv({drawPosition:e,structureId:r.structureId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:o});if(s.error)return s}return{...At}}({loserMatchUpDrawPosition:r,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:w,matchUpsMap:o,event:l});if(a.error)return La({result:a,stack:f});let s=((null==o?void 0:o.mappedMatchUps)||{})[w.structureId].matchUps,{initialRoundNumber:u}=hv({drawPosition:r,matchUps:s});1===u&&(Iv({method:f,color:"brightyellow",loserMatchUpDrawPosition:r}),Rv({structureId:w.structureId,drawPosition:r,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:o}))}}return P&&P.structureId!==y.matchUp.structureId&&S.target.feedProfile,{...At}}function Mv({drawDefinition:e,stages:t}){if(!e)return{error:$t};let i=Qe(((null==e?void 0:e.structures)??[]).filter((e=>!(null!=t&&t.length)||e.stage&&t.includes(e.stage))).map((e=>{let{positionAssignments:t}=Kc({structure:e});return t?t.map(hc):[]})).flat().filter(Boolean));return{...At,assignedParticipantIds:i}}function Av(e){let t=((null==e?void 0:e.entries)??[]).filter(Boolean).reduce(((e,t)=>{let{entryStage:i,entryStatus:n}=t,r=`_${i||il}${n||""}`;return e[r]||(e[r]=[]),e[r].push(t),e}),{}),i=e=>isNaN(e)?1/0:e;return Object.keys(t).map((e=>t[e].sort(((e,t)=>i(e.entryPosition)-i(t.entryPosition))).map(((e,t)=>({...e,entryPosition:t+1}))))).flat()}function Ev(e){return[jm,Vm].includes(e)}function Cv({autoEntryPositions:e=!0,ignoreAssignment:t,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:d,event:c}){var p,m,f,h,v,g,I,U,y,S,w,P;if(!r||!Array.isArray(r))return{error:Mn,method:"modifyEntriesStatus",participantIds:r};if(!n&&!c)return{error:bi};if(a&&!Ym.includes(a))return{error:zn};if(o&&!sl.includes(o))return{error:Oi};let D="modifyEntriesStatus",T=[];if(!a&&!s)return La({result:{error:un},info:"Missing entryStatus",stack:D});if(s&&!yd({extension:s,requiredAttributes:["name"]}))return La({result:{error:Cr},info:"Invalid extension",context:{extension:s},stack:D});let b=[];null==(p=null==c?void 0:c.drawDefinitions)||p.forEach((e=>{let t=Mv({stages:d&&[d],drawDefinition:e}).assignedParticipantIds??[];b.push(...t)}));let R=(null==i?void 0:i.participants)??[];if(!r.every((e=>{var t;let i=null==(t=vd({tournamentParticipants:R,participantId:e}))?void 0:t.participantType;return!(i&&[Kp,Hp].includes(i)&&Ev(a)||a&&null!=c&&c.eventType&&i===zp&&[Qs,el].includes(c.eventType)&&[Em,...qm].includes(a))})))return{error:zn};let N=c&&Eh({event:c}).flightProfile,M=null==(m=null==N?void 0:N.flights)?void 0:m.find((e=>e.drawId===u)),A=e=>{let i=(e||[]).filter((e=>!d||!e.entryStage||d===e.entryStage)).filter((({participantId:e})=>r.includes(e)));return i.every((e=>!((e=>a&&b.includes(e.participantId)&&!(qm.includes(e.entryStatus)&&qm.includes(a)))(e)&&!t)&&(a&&(e.entryStatus=a,delete e.entryPosition),o&&(e.entryStage=o,delete e.entryPosition),s&&(s.value?Sd({element:e,extension:s}):Ud({element:e,name:s.name})),!0)))?{...At}:{error:qn}},E=({flight:e,drawDefinition:t})=>{c&&(c.entries=Av({entries:c.entries??[]})),e&&(e.drawEntries=Av({entries:e.drawEntries})),t&&(t.entries=Av({entries:t.entries}))},C=e=>{let{flight:t,drawDefinition:i}=e,n="updateDrawEntries";if(t){let e=A(t.drawEntries);if(e.error)return La({result:e,stack:n})}if(i){let e=A(i.entries);if(e.error)return La({result:e,stack:n});T.includes(i.drawId)||T.push(i.drawId)}return{...At}},O=(null==(f=null==c?void 0:c.entries)?void 0:f.find((({entryPosition:e})=>e)))??((null==(h=null==M?void 0:M.drawEntries)?void 0:h.find((({entryPosition:e})=>e)))||(null==(v=null==n?void 0:n.entries)?void 0:v.find((({entryPosition:e})=>e))));if(e&&!O&&E({flight:M,drawDefinition:n}),M||n){let e=C({flight:M,drawDefinition:n});if(e.error)return La({result:e,stack:D})}let k=(null==(g=null==c?void 0:c.drawDefinitions)?void 0:g.map((({drawId:e})=>e)))??[],F=(null==(I=null==N?void 0:N.flights)?void 0:I.filter((e=>!k.includes(e.drawId))))||[];for(let _ of F){let e=_&&C({flight:_});if(null!=e&&e.error)return La({result:e,stack:D})}let x=1===(null==(U=null==N?void 0:N.flights)?void 0:U.length)&&((null==(y=null==c?void 0:c.drawDefinitions)?void 0:y.length)??0)<=(null==(S=null==N?void 0:N.flights)?void 0:S.length);if(!M&&!n&&a&&Wm.includes(a))return{error:Zn};if(!M&&!n||a===$m||l&&x){let e,t=A(null==c?void 0:c.entries);if(null!=t&&t.error)return La({result:t,stack:D});if(a===$m&&(null==(w=null==N?void 0:N.flights)||w.every((t=>{let i=A(t.drawEntries);return i.error?(e=i.error,!1):(t.drawEntries=t.drawEntries.filter((({participantId:e})=>!r.includes(e))),!0)})),null==(P=null==c?void 0:c.drawDefinitions)||P.every((t=>{var i;let n=A(t.entries);return n.error?(e=n.error,!1):(t.entries=null==(i=t.entries)?void 0:i.filter((({participantId:e})=>!r.includes(e))),!0)}))),e)return La({result:{error:e},stack:D})}e&&E({flight:M,drawDefinition:n});for(let _ of(null==c?void 0:c.drawDefinitions)??[])T.length&&!T.includes(_.drawId)||kp({tournamentId:i.tournamentId,eventId:null==c?void 0:c.eventId,drawDefinition:_});return{...At}}function Ov({requireTimeStamp:e,scaleAttributes:t,participant:i}){var n,r;if(!i)return{error:kn};if(!wt(t))return{error:Cr};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=t,u=[Ku,o,s,l].join("."),d=i.timeItems.filter((e=>(null==e?void 0:e.itemType)===u)).filter((t=>!e||(null==t?void 0:t.itemDate))).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))).pop();if(d){let[e,t,i,o]=(null==(n=d.itemType)?void 0:n.split("."))??[];if(e!==Ku)return{error:wr};let s=(null==(r=a&&rv({element:d.itemValue,accessor:a}))?void 0:r.value)||d.itemValue,l={eventType:i,scaleDate:d.itemDate,scaleValue:s,scaleName:o,scaleType:t};return{...At,scaleItem:l}}}return{...At,scaleItem:void 0}}function kv({publishedSeeding:e,usePublishState:t,withSeeding:i,participant:n,event:r}){var a,o,s;let l={},u=e=>[Ku,Ju,r.eventType,e].join("."),d=Object.assign({},...(n.timeItems||[]).filter((({itemType:e})=>e.split(".")[1]===Ju)).map((({itemType:e,itemValue:t})=>({[e]:t})))),c=((null==e?void 0:e.stageSeedingScaleNames)&&Object.values(null==e?void 0:e.stageSeedingScaleNames)||Array.isArray(null==e?void 0:e.seedingScaleNames)&&e.seedingScaleNames||[]).map(u),p=dt(Object.keys(d),c);if(t&&(Object.keys(d).length||null!=(a=null==e?void 0:e.drawIds)&&a.length)&&!p.length||!p.length)if(t||"object"!=typeof i){let i,{categoryName:a,ageCategoryCode:u}=r.category||{},d=[u,r.eventId,a].filter(Boolean);for(let e of d){let t=Ov({scaleAttributes:{eventType:r.eventType,scaleType:Ju,scaleName:e},participant:n});if(t.scaleItem){i=t.scaleItem;break}}if(i&&(!t||null!=e&&e.published&&(null==(s=null==(o=null==e?void 0:e.published)?void 0:o.drawIds)||!s.length))){let e=i.scaleValue;l.seedValue=e}}else{let e=Object.keys(i).map((e=>{let t=u(i[e]);return[e,d[t]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),t=Object.assign({},...e);l.seedAssignments=t}else if(null!=e&&e.stageSeedingScaleNames){let t=Object.keys(e.stageSeedingScaleNames).map((t=>{let i=u(e.stageSeedingScaleNames[t]);return[t,d[i]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),i=Object.assign({},...t);l.seedAssignments=i}else if(p){let e=p.map((e=>d[e]));l.seedValue=e.pop()}return l}function Fv({convertExtensions:e,seedAssignments:t,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:d,extensions:c}=s,p=null!=c&&c.length&&e?Object.assign({},...is(c??[])):{},m=Object.assign(p,{entryPosition:d,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=_a(m,!1,!1,!0),n&&(t&&(i.events[a].seedAssignments=t),r&&(i.events[a].seedValue=r))}function xv(e){let{participantMap:t,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:d,drawId:c,score:p}=e;!d||!Object.keys(d).length||n===Sc||t[i].scheduleItems.push({...d,scheduledDate:Eo(null==d?void 0:d.scheduledDate),scheduledTime:Ao(null==d?void 0:d.scheduledTime),checkScoreHasValue:dv({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:c})}function _v(e){var t,i,n;let r=qu(e,[{[au]:!0}]);if(r.error)return r;let{tournamentRecord:a,status:o=Kf}=e;return ts(null==(n=null==(i=null==(t=lm({tournamentRecord:a,itemType:`${Yf}.${Jf}`}))?void 0:t.timeItem)?void 0:i.itemValue)?void 0:n[o],!1,!0)}function Lv({event:e,status:t=Kf}){var i,n,r;return null==(r=null==(n=null==(i=sm({itemType:`${Yf}.${Jf}`,event:e}))?void 0:i.timeItem)?void 0:n.itemValue)?void 0:r[t]}function Bv({drawDetails:e,drawId:t}){var i,n;return null==(n=null==(i=null==e?void 0:e[t])?void 0:i.publishingDetail)?void 0:n.published}function Vv(e){var t,i,n,r,a,o,s,l,u;let{tournamentRecord:d,drawDefinition:c,eventIds:p,eventId:m,drawIds:f,drawId:h,event:v}=e??{};if(d&&!function(e){let{tournamentId:t}=e??{};return!!t}(d))return{error:Cr};if(m&&!v)return{error:Ri};if(Array.isArray(p)&&null!=p&&p.length){let e={};for(let i of p){if(!St(i))return{error:Cr};let n=null==(t=Ch({tournamentRecord:d,eventId:i}))?void 0:t.event;if(!n)return{error:Ri};let r=jv({event:n});e[i]=r}return{...At,publishState:e}}if(v){let e=jv({event:v}),t={};if(h)return c?{publishState:{status:{published:!(null==(i=e.status.publishedDrawIds)||!i.includes(h)),drawDetail:null==(n=e.status.drawDetails)?void 0:n[h]},...At}}:{error:Wt};if(Array.isArray(f)&&null!=f&&f.length){let i=(null==(r=v.drawDefinitions)?void 0:r.map(gc))??[];for(let n of f){if(!St(n))return{error:Cr};if(!i.includes(n))return{error:Wt};t[n]={status:{published:!!e.status.publishedDrawIds.includes(n),drawDetail:null==(a=e.status.drawDetails)?void 0:a[n]}}}}else t=e;return{...At,publishState:t}}let g=[],I=!1,U={};for(let y of(null==d?void 0:d.events)??[]){let e=jv({event:y});U[y.eventId]=e,e.status.published&&(g.push(y.eventId),I=!0);for(let{drawId:t}of y.drawDefinitions??[]){let i=null==(s=null==(o=e.status)?void 0:o.publishedDrawIds)?void 0:s.includes(t);i&&(U[t]={status:{published:i}})}}if(d){let e=_v({tournamentRecord:d});U.tournament=e??{},(null!=(l=null==e?void 0:e.orderOfPlay)&&l.published||null!=(u=null==e?void 0:e.participants)&&u.published)&&(I=!0),U.tournament.status={published:I,publishedEventIds:g}}return{...At,publishState:U}}function jv({event:e}){var t;let i=Lv({event:e});if(!i)return{status:{published:!1}};let n={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(n,i.seeding);let r=i.drawDetails??{};for(let l of(null==(t=e.drawDefinitions)?void 0:t.map(gc))||[])r[l]||(r[l]={publishingDetail:{published:!1}});let a=r&&Object.keys(r).length&&Object.keys(r).filter((e=>Bv({drawDetails:r,drawId:e}))),o=null!=a&&a.length?a:i.drawIds??[];if(null!=o&&o.length&&(null==a||!a.length))for(let l of o)r[l]={publishingDetail:{published:!0}};let s=(null==o?void 0:o.length)>0;return{status:{publishedDrawIds:o,publishedSeeding:n,drawDetails:r,published:s}}}function Gv(e,t){return(e||"").localeCompare(t||"")}function $v({finishingPositionRange:e={},participantMap:t,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:d,stage:c}){let p=t[a],m=e=>Math.abs(e[0]-e[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:c,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:d});let f=p.structureParticipation[l],{winner:h,loser:v}=e,g=n?h:v;n&&(f.winCount+=1,r===kc&&(f.walkoverWinCount+=1),r===Tc&&(f.defaultWinCount+=1)),g&&(!f.finishingPositionRange||m(g)<m(f.finishingPositionRange))&&(f.finishingPositionRange=g),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=u,f.finishingRound=i,f.roundNumber=s),1===i&&(f.participantWon=n))}function qv(e){var t,i,n,r,a,o,s,l,u,d;let{withScheduleItems:c,scheduleAnalysis:p,withTeamMatchUps:m,participantMap:f,withOpponents:h,withMatchUps:v,withEvents:g,withDraws:I,finishingPositionRange:U,finishingRound:y,matchUpStatus:S,stageSequence:w,roundNumber:P,structureId:D,score:T,stage:b,withRankingProfile:R,tieWinningSide:N,roundPosition:M,matchUpTieId:A,matchUpSides:E,collectionId:C,matchUpType:O,winningSide:k,matchUpId:F,schedule:x,eventId:_,drawId:L,sides:B}=e,V=h&&2===(null==B?void 0:B.length)&&Object.assign({},...B.map((({sideNumber:e},t)=>{let i=B[1-t].participantId;return e&&{[e]:i}})).filter(Boolean));for(let j of B){let{participantId:e,sideNumber:B,bye:G}=j;if(G)continue;let $=k===B,q=e=>{var t,i;let n=null==(t=f[e])?void 0:t.participant,r=null==n?void 0:n.participantType,a=[{participantId:e,participantType:r}];if(r!==Hp)for(let o of(null==n?void 0:n.individualParticipantIds)||[]){let e=null==(i=f[o])?void 0:i.participant;a.push({participantType:null==e?void 0:e.participantType,participantId:o})}return a},W=(e,t)=>{if(v){if(f[e].matchUps[F]={participantWon:$,matchUpType:O,structureId:D,sideNumber:B,matchUpId:F,eventId:_,drawId:L,stage:b},h){let i=q(t);f[e].matchUps[F].opponentParticipantInfo=i}C&&(f[e].matchUps[F].collectionId=C)}h&&t&&(f[e].opponents[t]={participantId:t,matchUpId:F,eventId:_,drawId:L}),R&&$v({finishingPositionRange:U,participantMap:f,participantWon:$,finishingRound:y,matchUpStatus:S,participantId:e,stageSequence:w,roundNumber:P,structureId:D,matchUpId:F,drawId:L,stage:b}),(p||c)&&xv({participantMap:f,participantId:e,matchUpStatus:S,roundPosition:M,matchUpType:O,roundNumber:P,structureId:D,matchUpId:F,schedule:x,drawId:L,score:T})},H=({participant:e,partnerParticipantId:t})=>{var i,n,r;let a=(e,t)=>{e&&(e.partnerParticipantIds||(e.partnerParticipantIds=[]),e.partnerParticipantIds.includes(t)||e.partnerParticipantIds.push(t))};I&&a(null==(i=null==e?void 0:e.draws)?void 0:i[L],t),g&&a(null==(n=null==e?void 0:e.events)?void 0:n[_],t),v&&a(null==(r=null==e?void 0:e.matchUps)?void 0:r[F],t)};if(e&&f[e]){let c=null==V?void 0:V[B];W(e,c);let p=(null==(t=f[e])?void 0:t.participant.participantType)===Kp,h=(null==(i=f[e])?void 0:i.participant.individualParticipantIds)||[];if(A){if(m){let t=e=>f[e].matchUps[A]={participantWon:N===B,matchUpId:A,matchUpType:Fe,sideNumber:B};t(e),h.forEach(t)}if(I&&!f[e].draws[L]){let t=null==(r=null==(n=E.find((e=>e.sideNumber===B)))?void 0:n.participant)?void 0:r.participantId,i=null==(s=null==(o=null==(a=f[t])?void 0:a.draws)?void 0:o[L])?void 0:s.entryStatus,l=e=>f[e].draws[L]={entryStatus:i,eventId:_,drawId:L};l(e),h.forEach(l)}}if(p&&(h.forEach((e=>f[e]&&W(e,c))),h.forEach(((e,t)=>{let i=h[1-t],n=f[e];n&&H({participant:n,partnerParticipantId:i})})),g&&E)){let t=null==(u=null==(l=E.find((e=>e.sideNumber===B)))?void 0:l.participant)?void 0:u.participantId;if(t){let i=null==(d=f[t])?void 0:d.events[_];i?(f[e].events[_]={...i},h.forEach((e=>f[e].events[_]={...i}))):console.log("Missing teamEntry",{eventId:_,teamParticipantId:t})}}if(k){let t=e=>{$?(f[e].counters[O].wins+=1,f[e].counters.wins+=1,S===kc&&(f[e].counters[O].walkoverWins+=1,f[e].counters.walkoverWins+=1),S===Tc&&(f[e].counters[O].defaultWins+=1,f[e].counters.defaultWins+=1)):(f[e].counters[O].losses+=1,f[e].counters.losses+=1,S===kc&&(f[e].counters[O].walkovers+=1,f[e].counters.walkovers+=1),S===Tc&&(f[e].counters[O].defaults+=1,f[e].counters.defaults+=1))};t(e),h.forEach(t)}}}}function Wv({participantFilters:e={},tournamentRecord:t,participants:i=[]}){var n;if(!Object.keys(e).length)return i;let{accessorValues:r,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:u,participantTypes:d,participantIds:c,signInStatus:p,enableOrFiltering:m,eventIds:f,genders:h}=e,v=Hv(f)&&(null==(n=null==t?void 0:t.events)?void 0:n.filter((e=>null==f?void 0:f.includes(e.eventId))))||(null==t?void 0:t.events)||[],g=a&&function({drawEntryStatuses:e,tournamentEvents:t}){let i=({entryStatus:t})=>!Array.isArray(e)||e.includes(t);return Qe(t.reduce(((e,t)=>{var n,r;let{flightProfile:a}=Eh({event:t}),o=(null==(n=null==a?void 0:a.flights)?void 0:n.map((({drawEntries:e})=>Array.isArray(e)?e.filter(i).map(hc):[])).flat())||[],s=(null==(r=t.drawDefinitions)?void 0:r.map((({entries:e})=>e?e.filter(i).map(hc):[])))||[];return e.concat(...o,...s)}),[]))}({drawEntryStatuses:a,tournamentEvents:v}),I=s&&function({eventEntryStatuses:e,tournamentEvents:t}){return Qe(t.reduce(((t,i)=>{let n=(i.entries||[]).filter((({entryStatus:t})=>!Array.isArray(e)||e.includes(t))).map(hc);return t.concat(...n)}),[]))}({eventEntryStatuses:s,tournamentEvents:v}),U=void 0!==o&&[!0,!1].includes(o)&&v.reduce(((e,t)=>e.concat(...(t.drawDefinitions||[]).map((e=>Yc({drawDefinition:e}).allPositionedParticipantIds)).filter(Boolean))),[]),y=e=>null==r?void 0:r.reduce(((t,i)=>{let{accessor:n,value:r}=i,{values:a}=rv({element:e,accessor:n});return t&&(null==a?void 0:a.includes(r))}),!0);if(i=null==i?void 0:i.filter((e=>{var t,i;let n=null==(i=null==(t=am({element:e,itemType:$p}))?void 0:t.timeItem)?void 0:i.itemValue,{participantRoleResponsibilities:a,participantType:s,participantRole:f,participantId:v,person:S}=e,w=Array.isArray(h)&&(null==h?void 0:h.length)&&(null==S?void 0:S.sex)&&h.includes(S.sex);return m?h&&w||o&&U.includes(v)||!1===o&&!U.includes(v)||(null==g?void 0:g.includes(v))||(null==I?void 0:I.includes(v))||(null==c?void 0:c.includes(v))||p&&n===p||d&&s&&Hv(d)&&d.includes(s)||l&&f&&Hv(l)&&l.includes(f)||u&&Hv(a)&&Hv(u)&&u.find((e=>null==a?void 0:a.includes(e)))||(null==r?void 0:r.length)&&Hv(r)&&y(e):(!h||w)&&(void 0===o||o&&U.includes(v)||!1===o&&!U.includes(v))&&(!g||g.includes(v))&&(!I||I.includes(v))&&(!c||c.includes(v))&&(!p||n===p)&&(!d||s&&Hv(d)&&d.includes(s))&&(!l||f&&Hv(l)&&l.includes(f))&&(!u||Hv(a)&&Hv(u)&&u.find((e=>null==a?void 0:a.includes(e))))&&(!(null!=r&&r.length)||Hv(r)&&y(e))})),v.length&&f){let e=v.filter((e=>f.includes(e.eventId))).map((e=>{let i=(e.entries||[]).map((e=>e.participantId));if(Xf(Ks)(e.eventType))return i;let n=((null==t?void 0:t.participants)??[]).filter((e=>i.includes(e.participantId))).map((e=>e.individualParticipantIds)).flat(1);return i.concat(...n)})).flat(1);i=null==i?void 0:i.filter((t=>e.includes(t.participantId)))}return i}function Hv(e){return e&&Array.isArray(e)&&e.length}function zv(e){var t;let{withIndividualParticipants:i,participantFilters:n={},withPotentialMatchUps:r,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:u,scheduleAnalysis:d,withSignInStatus:c,withTeamMatchUps:p,withScaleValues:m,usePublishState:f,withStatistics:h,contextFilters:v,matchUpFilters:g,contextProfile:I,withOpponents:U,withMatchUps:y,internalUse:S,withSeeding:w,withEvents:P,withDraws:D,withISO2:T,withIOC:b}=e;if(!u)return{error:Bt};(y||a)&&uv({tournamentRecord:u});let R=pm({convertExtensions:o,tournamentRecord:u,withSignInStatus:c,withScaleValues:m,internalUse:S,withISO2:T,withIOC:b}),{participantMap:N}=R,M=function(e){var t,i,n,r,a,o,s;let{participantFilters:l,convertExtensions:u,policyDefinitions:d,tournamentRecord:c,usePublishState:p,contextFilters:m,matchUpFilters:f,participantMap:h,contextProfile:v,withPotentialMatchUps:g,withRankingProfile:I,withScheduleItems:U,scheduleAnalysis:y,withTeamMatchUps:S,withStatistics:w,withOpponents:P,withMatchUps:D,withSeeding:T,withEvents:b,withDraws:R}=e,N=null==l?void 0:l.participantIds,M=e=>{var t,i;let n=[e];return null==(i=null==(t=h[e])?void 0:t.participant.individualParticipantIds)||i.forEach((e=>n.push(e))),n.some((e=>!(null!=N&&N.length)||N.includes(e)))?n:[]},A={withMatchUps:D||I,withEvents:b||I,withDraws:R||I,withPotentialMatchUps:g,withRankingProfile:I,withScheduleItems:U,scheduleAnalysis:y,withTeamMatchUps:S,withStatistics:w,participantMap:h,withOpponents:P,withSeeding:T},E=[],C={},O=[],k={},F={},x={},_=({eventType:e,scaleNames:t,participantId:i})=>{var n,r,a,o,s;return null==(s=null==(o=null==(a=null==(r=null==(n=h[i])?void 0:n.participant)?void 0:r.rankings)?void 0:a[e])?void 0:o.find((e=>t.includes(e.scaleName))))?void 0:s.scaleValue};for(let L of(null==c?void 0:c.events)||[]){if(null!=l&&l.eventIds&&!l.eventIds.includes(L.eventId))continue;let{drawDefinitions:e=[],extensions:N=[],eventType:E,eventName:B,category:V,entries:j,eventId:G,gender:$}=L,{flightProfile:q}=Eh({event:L}),W=(null==q?void 0:q.flights)??[],H=Vv({event:L}).publishState;H&&(k[G]=H);let z=null==(t=null==H?void 0:H.status)?void 0:t.publishedSeeding;if(b||T||I){let e=u?Object.assign({},...is(N??[])):{};F[G]={...e,eventName:B,eventType:E,category:V,eventId:G,gender:$};let t=[null==V?void 0:V.categoryName,null==V?void 0:V.ageCategoryCode].filter(Boolean);for(let i of j){let{participantId:e}=i;if(!e||!h[e])continue;let n,r,a=_({eventType:E,scaleNames:t,participantId:e});if(T){let t=h[e].participant;({seedAssignments:n,seedValue:r}=kv({publishedSeeding:z,usePublishState:p,withSeeding:T,participant:t,event:L}))}let o=e=>{var t,o;if(null!=(o=null==(t=h[e])?void 0:t.events)&&o[G])return;let s=h[e];Fv({convertExtensions:u,seedAssignments:n,participant:s,withSeeding:T,seedValue:r,eventId:G,ranking:a,entry:i})};o(e),(h[e].participant.individualParticipantIds||[]).forEach(o)}}let Y=null==(i=null==k?void 0:k[G])?void 0:i.publishedSeeding;if(R||I||T){let t=e=>e?Object.assign({},...e.map((({participantId:e,seedValue:t,seedNumber:i})=>({[e]:{seedValue:t,seedNumber:i}})))):void 0,i=Qe([...e.map(gc),...W.map(gc)]);for(let o of i){let i,s,l,u,d=e.find((e=>e.drawId===o)),c=[null==V?void 0:V.categoryName,null==V?void 0:V.ageCategoryCode].filter(Boolean),{structures:m=[],drawOrder:f,drawName:v,drawType:g}=d??{},U=null==W?void 0:W.find((e=>e.drawId===o)),y=(null==d?void 0:d.entries)||(null==U?void 0:U.drawEntries),S=null==U?void 0:U.flightNumber,w=((null==d?void 0:d.structures)||[]).sort(((e,t)=>qc(e,t))).map((({structureId:e,structures:t})=>[e,...(t||[]).map((({structureId:e})=>e))])).flat(1/0),P=0,D=m.filter((({stage:e,stageSequence:t})=>e===il&&1===t||e===nl)).flatMap((e=>{let{positionAssignments:t}=Kc({structure:e}),{seedAssignments:n,stageSequence:r,stage:a}=e;return a===il?(P=(null==t?void 0:t.length)??0,l=t,u=n):1===r&&(i=t,s=n),t})).map((({participantId:e})=>e)).filter(Boolean),b=t(u),N=t(s),M=d?y.filter((({participantId:e})=>D.includes(e))):y,A=!p||(null==Y?void 0:Y.published)&&(0===(null==(n=null==Y?void 0:Y.drawIds)?void 0:n.length)||(null==(r=null==Y?void 0:Y.drawIds)?void 0:r.includes(o)));for(let e of M){if(!h[e.participantId])continue;let{entryStatus:t,entryStage:i,entryPosition:n,participantId:r}=e,s=_({participantId:r,scaleNames:c,eventType:E}),l=e=>{var a,l,u,d,c;if(!h[e]||null!=(a=h[e].draws)&&a[o])return;let p=T&&A,m=p?{}:void 0,f=p?(null==(l=null==b?void 0:b[r])?void 0:l.seedValue)||(null==(u=null==b?void 0:b[r])?void 0:u.seedNumber):void 0,v=f?null==b?void 0:b[r]:void 0,g=p?(null==(d=null==N?void 0:N[r])?void 0:d.seedValue)||(null==(c=null==N?void 0:N[r])?void 0:c.seedNumber):void 0,U=g?null==N?void 0:N[r]:void 0;m&&f&&(m[il]=v),m&&g&&(m[nl]=U);let y=f||g;y&&(h[e].participant.seedings[E]||(h[e].participant.seedings[E]=[]),v&&h[e].participant.seedings[E].push({...v,scaleName:o}),U&&h[e].participant.seedings[E].push({...U,scaleName:o}),m&&(h[e].events[G].seedAssignments||(h[e].events[G].seedAssignments={}),Object.keys(m).forEach((t=>h[e].events[G].seedAssignments[t]=m[t])))),(R||I)&&(h[e].draws[o]=_a({seedAssignments:m,entryPosition:n,entryStatus:t,entryStage:i,seedValue:y,eventId:G,ranking:s,drawId:o},!1,!1,!0))};[Vm,jm].includes(t)||(l(r),null==(a=h[r].participant.individualParticipantIds||[])||a.forEach(l))}let C=((null==d?void 0:d.structures)??[]).reduce(((e,t)=>(e.includes(t.stage)||e.push(t.stage),e)),[]),O=((null==d?void 0:d.links)??[]).length;x[o]={qualifyingPositionAssignments:i,qualifyingSeedAssignments:s,mainPositionAssignments:l,qualifyingSeedingMap:N,mainSeedAssignments:u,orderedStructureIds:w,mainSeedingMap:b,flightNumber:S,linksCount:O,drawOrder:f,drawName:v,drawType:g,drawSize:P,drawId:o,stages:C}}}if(I||y||S||w||P||D||R){let e=!!y||g,t=(null==(o=Xh({afterRecoveryTimes:!!y,policyDefinitions:d,tournamentRecord:c,inContext:!0,participantMap:h,contextFilters:m,matchUpFilters:f,contextProfile:v,nextMatchUps:e,event:L}))?void 0:o.matchUps)??[];for(let i of t){let{finishingPositionRange:t,potentialParticipants:n,tieMatchUps:r=[],sides:a=[],winningSide:o,matchUpType:l,matchUpId:u,eventId:d,drawId:p,collectionId:m,stageSequence:f,finishingRound:v,matchUpStatus:g,roundPosition:I,roundNumber:S,structureId:w,schedule:P,score:D,stage:T}=i;C[u]=i;let b={finishingPositionRange:t,finishingRound:v,stageSequence:f,roundPosition:I,collectionId:m,roundNumber:S,structureId:w,schedule:P,eventId:d,drawId:p,score:D,stage:T};qv({...b,...A,matchUpStatus:g,winningSide:o,matchUpType:l,matchUpId:u,sides:a});for(let e of r){let{winningSide:t,sides:i=[],matchUpId:n,matchUpStatus:r,matchUpType:s}=e;qv({...b,...A,winningSide:t,tieWinningSide:o,matchUpTieId:u,matchUpId:n,sides:i,matchUpSides:a,matchUpStatus:r,matchUpType:s})}Array.isArray(n)&&(e||y||U)&&(null==(s=n.flat().map(hc).filter(Boolean))||s.forEach((e=>{var t;null==(t=M(e))||t.forEach((e=>{h[e]&&(h[e].potentialMatchUps[u]=_a({tournamentId:null==c?void 0:c.tournamentId,matchUpId:u,eventId:d,drawId:p}))})),(y||U)&&xv({potential:!0,participantMap:h,participantId:e,matchUpStatus:g,roundPosition:I,structureId:w,matchUpType:l,roundNumber:S,matchUpId:u,schedule:P,drawId:p,score:D})})))}O.push(...t)}}if(w||I||y){let e=Object.values(h);for(let t of e){let{wins:e,losses:i,[Ee]:{wins:n,losses:r},[Oe]:{wins:a,losses:o}}=t.counters,s=(e,i,n)=>{let r=i+n,a=i,o=r&&a/r;t.statistics[e]={denominator:r,numerator:a,statValue:o,statCode:e}};if(w&&(s(Dm,e,i),s(`${Dm}.${Ee}`,n,r),s(`${Dm}.${Oe}`,a,o)),I){let e=(e=[])=>Math.abs(e[0]-e[1]);for(let i of Object.keys(t.draws)){let{orderedStructureIds:n=[],flightNumber:r}=x[i]||{};if(t.structureParticipation&&n.length){let a,o=0,s=n.map((i=>{let n=t.structureParticipation[i];if(!n)return;a||(a=null==n?void 0:n.finishingPositionRange),e(a)>e(null==n?void 0:n.finishingPositionRange)&&(a=null==n?void 0:n.finishingPositionRange);let s=n.stage!==nl;return s&&(o+=1),_a({...n,participationOrder:s?o:void 0,flightNumber:r})})).filter(Boolean);t.draws[i]&&(t.draws[i].finishingPositionRange=a,t.draws[i].structureParticipation=s)}}}if(y){let e=wt(y)?y.scheduledMinutesDifference:0,i=t.scheduleItems||[],n=t.potentialMatchUps||{},r=i.reduce(((e,t)=>{let{scheduledDate:i,scheduledTime:n}=t;return e[i]||(e[i]=[]),n&&e[i].push(t),e}),{});Object.values(r).forEach((e=>e.sort(Fo)));for(let o of i){let{typeChangeTimeAfterRecovery:i,timeAfterRecovery:a,scheduledDate:s,scheduledTime:l}=o,u=r[s],d=No(l);for(let r of u){if(r.matchUpId===o.matchUpId||[kc,Tc].includes(r.matchUpStatus)&&!r.checkScoreHasValue)continue;let s=o.matchUpType!==r.matchUpType&&i||a,l=o.drawId===r.drawId,u=n[o.matchUpId]&&n[r.matchUpId],c=No(r.scheduledTime),p=Math.abs(c-d),m=c>=d;if((e&&!isNaN(e)?p<=e:m&&No(r.scheduledTime)<No(s))&&(!u||!l)&&m){let e=[o.matchUpId,r.matchUpId].sort(Gv).join("|");t.scheduleConflicts[e]={priorScheduledMatchUpId:o.matchUpId,matchUpIdWithConflict:r.matchUpId}}}}let a=t.participant.participantId;Object.keys(t.scheduleConflicts).length&&E.push(a),h[a].scheduleConflicts=t.scheduleConflicts}}}return{participantIdsWithConflicts:E,eventsPublishStatuses:k,derivedEventInfo:F,derivedDrawInfo:x,mappedMatchUps:C,participantMap:h,matchUps:O}}({withMatchUps:y??a,withEvents:P??a,withDraws:D??a,withPotentialMatchUps:r,participantFilters:n,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:u,scheduleAnalysis:d,withTeamMatchUps:p,usePublishState:f,withStatistics:h,contextFilters:v,matchUpFilters:g,participantMap:N,withOpponents:U,contextProfile:I,withSeeding:w}),{participantIdsWithConflicts:A,eventsPublishStatuses:E,derivedEventInfo:C,derivedDrawInfo:O,mappedMatchUps:k}=M,F=M.matchUps;N=M.participantMap;let x=d??r,_=({potentialMatchUps:e,scheduleConflicts:t,scheduleItems:i,participant:n,statistics:r,opponents:o,matchUps:s,events:u,draws:c})=>{let p=Object.values(c),m=Object.values(o);return U&&(null==p||p.forEach((e=>{e.opponents=m.filter((t=>t.drawId===e.drawId))}))),_a({...n,scheduleConflicts:d?Object.values(t):void 0,draws:D||a?p:void 0,events:P||a?Object.values(u):void 0,matchUps:y||a?Object.values(s):void 0,opponents:U?m:void 0,potentialMatchUps:x?Object.values(e):void 0,statistics:h?Object.values(r):void 0,scheduleItems:l?i:void 0},!1,!1,!0)},L=new Map;for(let $ of Object.keys(N))L.set($,_(N[$]));let B=[...L.values()],V=null==(t=null==s?void 0:s[sd])?void 0:t.participant,j=Wv({participants:B,participantFilters:n,tournamentRecord:u});if(i){let e=wt(i)?i:void 0;for(let t of j)for(let i of t.individualParticipantIds??[]){t.individualParticipants||(t.individualParticipants=[]);let n=L.get(i),r=e?Xu({template:e,source:n}):n;t.individualParticipants.push(r)}}let G=V?j.map((e=>Xu({source:e,template:V}))):j;return{participantMap:!1!==e.returnParticipantMap?N:void 0,mappedMatchUps:!1!==e.returnMatchUps?k:void 0,matchUps:!1!==e.returnMatchUps?F:void 0,missingParticipantIds:R.missingParticipantIds,participantIdsWithConflicts:A,eventsPublishStatuses:E,derivedEventInfo:C,derivedDrawInfo:O,participants:G,...At}}function Yv({participantId:e,drawDefinition:t,entryStatus:i,entryStage:n}){var r;if(!t)return{error:$t};let a=null==(r=t.entries)?void 0:r.find((t=>!(t.participantId!==e||i&&i!==t.entryStatus||n&&n!==t.entryStage)));return e&&a}function Kv(e){var t,i,n,r,a,o,s,l,u;let{provisionalPositioning:d,drawDefinition:c,stageSequence:p,structureId:m,stage:f}=e;if(!c)return{error:$t};let{entryProfile:h}=Am({drawDefinition:c}),v=f&&p&&(null==(n=null==(i=null==(t=null==h?void 0:h[f])?void 0:t.stageSequence)?void 0:i[p])?void 0:n.qualifiersCount)||f&&(null==(r=null==h?void 0:h[f])?void 0:r.qualifiersCount)||0,g={};if(!m)return{qualifiersCount:v,roundQualifiersCounts:g};let{structure:I}=Hc({drawDefinition:c,structureId:m}),U=null==(a=c.links)?void 0:a.filter((e=>{var t;return(null==(t=null==e?void 0:e.target)?void 0:t.structureId)===(null==I?void 0:I.structureId)})),y=0;if(null!=U&&U.length)for(let w of U){let e=null==(o=Hc({structureId:w.source.structureId,drawDefinition:c}))?void 0:o.structure;if((null==e?void 0:e.stage)===nl){let t=w.source.roundNumber,i=w.target.roundNumber,n=0;if(e.structureType===vl){n=((null==(s=e.structures)?void 0:s.length)??0)*((null==(l=w.source.finishingPositions)?void 0:l.length)??0)}else n=(null==(u=jh({matchUpFilters:{roundNumbers:[t]},structure:e,afterRecoveryTimes:!1,provisionalPositioning:d,inContext:!1}).matchUps)?void 0:u.length)||0;g[i]||(g[i]=0),g[i]+=n,y+=n}}let S=Object.keys(g);if(S.length<=1){let e=S[0]||1;g[e]=Math.max(g[e]||0,v)}return y=Math.max(y,v),{qualifiersCount:y,roundQualifiersCounts:g}}function Jv({stage:e,drawDefinition:t}){var i;let{entryProfile:n}=Am({drawDefinition:t});return(null==(i=null==n?void 0:n[e])?void 0:i.drawSize)||0}function Qv({stage:e,drawDefinition:t}){return!!(e===al||Jm({stage:e,drawDefinition:t})&&Jv({stage:e,drawDefinition:t}))}function Zv({entryStatus:e=Om,drawDefinition:t,stageSequence:i,stage:n}){if(e===Em)return function({stage:e,drawDefinition:t}){var i;let{entryProfile:n}=Am({drawDefinition:t});return(null==(i=n[e])?void 0:i.alternates)||0}({stage:n,drawDefinition:t})?{positionsAvailable:1/0,...At}:{error:Qn};let r=function(e){let{provisionalPositioning:t,drawDefinition:i,stageSequence:n,stage:r}=e,a=Jv({stage:r,drawDefinition:i}),{qualifiersCount:o}=Kv({provisionalPositioning:t,drawDefinition:i,stageSequence:n,stage:r});return a&&a-o}({drawDefinition:t,stageSequence:i,stage:n}),a=function({stage:e,drawDefinition:t}){var i;let{entryProfile:n}=Am({drawDefinition:t});return(null==(i=n[e])?void 0:i.wildcardsCount)||0}({drawDefinition:t,stage:n}),o=Qm({entryStatus:Gm,drawDefinition:t,stage:n}),s=o+Qm({entryStatus:Om,drawDefinition:t,stage:n}),l=r-s;return n!==al&&s>=r?{error:Xn}:e===Gm?o<a?{...At}:{error:Xn}:{positionsAvailable:l,...At}}function Xv(e){let t=qu(e,[{[su]:!0,[hu]:!0}]);if(t.error)return t;let{suppressDuplicateEntries:i=!0,entryStatus:n=Om,entryStageSequence:r,entryStage:a=il,ignoreStageSpace:o,drawDefinition:s,entryPosition:l,participant:u,roundTarget:d,extensions:c,extension:p,drawType:m,event:f}=e,h="addDrawEntry";if(m!==Tl&&!Qv({stage:a,drawDefinition:s}))return La({result:{error:Oi},stack:h});let v=Zv({stageSequence:r,stage:a,drawDefinition:s,entryStatus:n});if(!(o||v.success||m&&m===Tl))return{error:v.error};if(p&&!yd({extension:p}))return La({result:{error:Cr},info:"Invalid extension",context:{extension:p},stack:h});let g=e.participantId||(null==u?void 0:u.participantId);if(!g)return La({result:{error:xn},stack:h});let I=n===xm&&Yv({participantId:g,drawDefinition:s,entryStatus:n}),U=a===al&&Yv({participantId:g,drawDefinition:s,entryStage:a}),y=Yv({participantId:g,drawDefinition:s}),S=n!==xm&&a!==al&&y;if(S)return i?(Ia({payload:{drawId:s.drawId,eventId:null==f?void 0:f.eventId,error:Ft,participantId:g},topic:rp}),{...At}):La({result:{error:Ft},context:{participantId:g},stack:h});if(I||U)return La({context:{invalidEntry:S,invalidLuckyLoser:I,invalidVoluntaryConsolation:U},result:{error:Wn},stack:h});let w=_a({entryStageSequence:r,participantId:g,entryPosition:l,entryStatus:n,entryStage:a,extensions:c});return p&&Sd({element:w,extension:p}),d&&Sd({extension:{name:"roundEntry",value:d},element:w}),s.entries||(s.entries=[]),s.entries.push(w),kp({drawDefinition:s}),{...At}}function eg({suppressDuplicateEntries:e=!0,autoEntryPositions:t=!0,entryStageSequence:i,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:l,extension:u,drawId:d,event:c}){if(null==r||!r.length)return{error:Vn};if(!c)return{error:Ri};if(!d)return{error:li};let p=(c.entries||[]).map(hc);if(r.filter((e=>!p.includes(e))).length)return{error:Mi};if(a){let d=function(e){let t="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:n=Om,autoEntryPositions:r=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:l,stage:u=il,roundTarget:d,extension:c,event:p}=e;if(!u)return{error:Ci};if(!s)return{error:$t};if(!Array.isArray(o))return{error:An};if(!Qv({stage:u,drawDefinition:s}))return{error:Oi};if(c&&!yd({extension:c}))return La({result:{error:Cr},info:"Invalid extension",context:{extension:c},stack:t});let m=Zv({drawDefinition:s,stageSequence:l,entryStatus:n,stage:u});if(!a&&!m.success)return{error:m.error};let f=m.positionsAvailable??0;if(!a&&u!==al&&f<o.length)return{error:Hn};let h=[],v=s.drawId,g=null==p?void 0:p.eventId,I=o.reduce(((e,t)=>{let r=n===xm&&Yv({participantId:t,drawDefinition:s,entryStatus:n}),a=u===al&&Yv({entryStage:u,drawDefinition:s,participantId:t}),o=Yv({participantId:t,drawDefinition:s});return n!==xm&&u!==al&&o&&(h.push(t),i&&Ia({payload:{error:Ft,participantId:t,eventId:g,drawId:v},topic:rp})),r||a?e.concat(t):e}),[]);return h.length&&!i?La({context:{eventId:g,drawId:v,duplicateEntries:h},result:{error:Ft},stack:t}):(o.filter((e=>e&&!I.includes(e))).forEach((e=>{let t={entryStageSequence:l,entryStage:u,participantId:e,entryStatus:n};c&&Sd({element:t,extension:c}),d&&Sd({extension:{name:Jd,value:d},element:t}),s.entries||(s.entries=[]),s.entries.push(t)})),r&&(s.entries=Av({entries:s.entries})),kp({drawDefinition:s}),null!=I&&I.length||null!=h&&h.length?{info:"some participantIds could not be added",participantIdsNotAdded:I,duplicateEntries:h,...At}:{...At})}({stageSequence:i,suppressDuplicateEntries:e,autoEntryPositions:t,stage:l,ignoreStageSpace:n,participantIds:r,drawDefinition:a,entryStatus:o,roundTarget:s,extension:u});if(d.error)return d}let{flightProfile:m}=Eh({event:c}),f=null==m?void 0:m.flights.find((e=>e.drawId===d));return null!=f&&f.drawEntries&&(r.forEach((e=>{let t=o===xm&&tg({participantId:e,entryStatus:o,flight:f}),i=l===al&&tg({participantId:e,entryStage:l,flight:f});(o===xm||l===al||!tg({flight:f,participantId:e}))&&!t&&!i&&f.drawEntries.push({participantId:e,entryStatus:o,entryStage:l})})),t&&(f.drawEntries=Av({entries:f.drawEntries}))),{...At}}function tg({participantId:e,entryStatus:t,entryStage:i,flight:n}){var r;let a=null==(r=n.drawEntries)?void 0:r.find((n=>!(n.participantId!==e||t&&t!==n.entryStatus||i&&i!==n.entryStage)));return e&&a}function ig({autoEntryPositions:e=!0,participantIds:t=[],entryStatuses:i,stage:n,event:r}){var a,o,s,l;let u="removeEventEntries";if(null==r||!r.eventId)return{error:bi};if(!Array.isArray(t)||t.some((e=>!St(e))))return La({result:{error:Mn},stack:u});let d=(r.drawDefinitions??[]).flatMap((e=>Mv({drawDefinition:e}).assignedParticipantIds??[])),c=((null==i?void 0:i.length)&&(null==(a=r.entries)?void 0:a.filter((e=>e.entryStatus&&i.includes(e.entryStatus))))||[]).map(hc).filter((e=>!d.includes(e))),p=(n&&(null==(o=r.entries)?void 0:o.filter((e=>e.entryStage&&e.entryStage===n)))||[]).map(hc).filter((e=>!d.includes(e)));if(t.length?t=t.filter((e=>(!(null!=i&&i.length)||c.includes(e))&&(!n||p.includes(e)))):c.length&&p.length?t=dt(c,p):c.length?t=c:p.length&&(t=p),(null==t?void 0:t.length)&&d.some((e=>t.includes(e))))return La({result:{error:qn},stack:u});if(null==t||!t.length)return{...At,participantIdsRemoved:[]};let m=[];r.entries=(r.entries??[]).filter((e=>{let i=!t.includes(null==e?void 0:e.participantId);return i||m.push(e.participantId),i})),e&&(r.entries=Av({entries:r.entries}));let{flightProfile:f}=Eh({event:r});return null==(s=null==f?void 0:f.flights)||s.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!t.includes(e.participantId)))})),null==(l=r.drawDefinitions)||l.forEach((e=>{e.entries=(e.entries??[]).filter((e=>!t.includes(e.participantId)))})),{...At,participantIdsRemoved:m}}var ng={[rd]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},rg=ng;function ag(e){var t,i;let{suppressDuplicateEntries:n=!0,entryStatus:r=Om,autoEntryPositions:a=!0,enforceGender:o=!0,entryStageSequence:s,policyDefinitions:l,entryStage:u=il,tournamentRecord:d,ignoreStageSpace:c,drawDefinition:p,roundTarget:m,extensions:f,extension:h,drawId:v,event:g}=e,I="addEventEntries";if(!Array.isArray(e.participantIds))return La({result:{error:An},stack:I});let U=Qe(e.participantIds??[]);if(!g)return{error:bi};if(null==U||!U.length)return La({result:{error:Vn},stack:I});if(null==g||!g.eventId)return{error:Ri};let y=gm({tournamentRecord:d,event:g}).appliedPolicies??{},S=(null==l?void 0:l[rd])??(null==y?void 0:y[rd])??rg[rd],w=!1!==(o??(null==(t=null==S?void 0:S.participants)?void 0:t.enforceGender)),P=[],D=[];if(f&&(!Array.isArray(f)||!f.every((e=>yd({extension:e}))))||h&&!yd({extension:h}))return La({context:_a({extension:h,extensions:f}),result:{error:Cr},info:"Invalid extension(s)",stack:I});let T,b=!!d,R=[],N=(null==(i=null==d?void 0:d.participants)?void 0:i.filter((e=>{var t,i,n;if(!U.includes(e.participantId))return!1;let a=Xf(Ee)(g.eventType)&&e.participantType===zp&&!Ev(r),o=g.eventType===Oe&&e.participantType===Kp;return!!(a&&(!g.gender||!w||[ja,Ba].includes(g.gender)||g.gender===(null==(t=e.person)?void 0:t.sex))||o&&!Ev(r)||g.eventType===Oe&&e.participantType===zp&&Ev(r))||(a&&g.gender&&w&&![ja,Ba].includes(g.gender)&&g.gender!==(null==(i=e.person)?void 0:i.sex)?(R.push({participantId:e.participantId,sex:null==(n=e.person)?void 0:n.sex}),!1):g.eventType===Jp&&(e.participantType===Jp||Ev(r)&&e.participantType===zp))})).map((e=>e.participantId)))??[],M=U.filter((e=>!b||N.includes(e)));g.entries||(g.entries=[]);let A=g.entries.map((e=>{var t;return e.participantId||(null==(t=e.participant)?void 0:t.participantId)}));if(M.forEach((e=>{var t;if(!A.includes(e)){let i=_a({participantId:e,entryStatus:r,entryStage:u,extensions:f});h&&Sd({element:i,extension:h}),m&&Sd({extension:{name:Jd,value:m},element:i}),s&&(i.entryStageSequence=s),P.push(i.participantId),null==(t=g.entries)||t.push(i)}})),v&&!Ev(u)){let e=eg({participantIds:M,suppressDuplicateEntries:n,autoEntryPositions:a,entryStageSequence:s,ignoreStageSpace:c,drawDefinition:p,entryStatus:r,roundTarget:m,entryStage:u,extension:h,drawId:v,event:g});e.error&&(T=e.error)}if(g.eventType&&[Zs,el].includes(g.eventType)){let e=(g.entries||[]).map((e=>e.participantId)),t=(g.entries||[]).filter((e=>Ev(e.entryStatus))).map((e=>e.participantId)),i=((null==d?void 0:d.participants)??[]).filter((t=>e.includes(t.participantId)&&t.participantType&&[Kp,Jp].includes(t.participantType))).map((e=>e.individualParticipantIds)).flat(1/0),n=t.filter((e=>i.includes(e)));n.length&&(D.push(...n),ig({participantIds:n,autoEntryPositions:!1,event:g}))}if(M.length!==U.length)return La({context:{mismatchedGender:R,gender:g.gender},result:{error:An},stack:I});a&&(g.entries=Av({entries:g.entries||[]}));let E=P.length,C=D.length;return La({result:{...At,addedEntriesCount:E,removedEntriesCount:C},stack:I,info:T})}var og="ADMINISTRATION",sg="COMPETITOR",lg="MEDIA",ug="MEDICAL",dg="OFFICIAL",cg="OTHER",pg="SECURITY",mg={ADMINISTRATION:og,CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR:sg,MEDIA:lg,MEDICAL:ug,OFFICIAL:dg,OTHER:cg,SECURITY:pg};function fg({addIndividualParticipantsToEvents:e,individualParticipantIds:t,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return La({result:{error:Bt},stack:a});if(!i||!t)return La({result:{error:un},stack:a});let o=(n.participants??[]).find((e=>e.participantId===i));if(!o)return La({result:{error:_n},stack:a});if(![Jp,Yp].includes(o.participantType))return La({result:{participantType:o.participantType,error:Cn},stack:a});let s=hg({individualParticipantIds:t,groupingParticipant:o,tournamentRecord:n,suppressErrors:r}),{removed:l,error:u}=s;if(u)return La({result:s,stack:a});if(e)for(let d of n.events??[]){let e=(d.entries??[]).map((({participantId:e})=>e)).filter(Boolean);if(e.includes(i)){ag({participantIds:null==l?void 0:l.filter((t=>!e.includes(t))),entryStatus:Vm,tournamentRecord:n,event:d})}}return l&&Ia({topic:mp,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...At,...s}}function hg({individualParticipantIds:e=[],groupingParticipant:t,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var o,s;let l=[];if(!t)return{removed:l};let u=[],d=[];a||({participants:a,mappedMatchUps:r}=zv({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=null==(s=null==(o=null==a?void 0:a.find((({participantId:e})=>e===t.participantId)))?void 0:o.events)?void 0:s.map((({eventId:e})=>e)),p=(t.individualParticipantIds??[]).filter((n=>{var o;let s=null==e?void 0:e.includes(n),p=s&&(null==(o=null==a?void 0:a.find((e=>e.participantId===n)))?void 0:o.matchUps.filter((({eventId:e})=>c.includes(e))).map((({matchUpId:e})=>null==r?void 0:r[e])).filter((({winningSide:e,score:t})=>e||dv({score:t})))),m=s&&!(null!=p&&p.length);if(s&&!m&&d.push(n),m){l.push(n);for(let e of i.events??[])for(let r of e.drawDefinitions??[]){let{extension:e}=Cd({element:r,name:qd}),a=null==e?void 0:e.value[t.participantId];e&&a&&(e.value[t.participantId]=a.filter((e=>e.participantId!==n)),Sd({element:r,extension:e}),Op({drawDefinition:r}));let o=nv({drawDefinition:r,inContext:!1}).matchUps??[];for(let t of o){let e=t.sides??[];for(let a of e){let e=a.lineUp??[];e.find((e=>e.participantId===n))&&(a.lineUp=e.filter((e=>e.participantId!==n)),Cp({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:r,matchUp:t}))}}}}else u.push(n);return!m}));t.individualParticipantIds=p;let m={groupingParticipantId:t.participantId,cannotRemove:d,notRemoved:u,removed:l};return d.length&&!n&&{...m,cannotRemove:d,error:Tn}||m}function vg({participantRole:e=sg,individualParticipantIds:t=[],groupingTypes:i=[Hp,Yp],tournamentRecord:n}){if(!n)return{error:Bt};let r=n.participants??[],{participants:a,mappedMatchUps:o}=zv({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter((t=>(t.participantRole===e||!t.participantRole)&&t.participantType&&i.includes(t.participantType))).forEach((e=>{let{removed:i}=hg({groupingParticipant:e,individualParticipantIds:t,tournamentRecord:n,mappedMatchUps:o,participants:a});i&&s++})),s?At:{error:Bn}}function gg(e){var t,i;let n=qu(e,[{[au]:!0},{participantIds:!0,[Lu]:ku,[Mu]:Vn}]);if(n.error)return n;let{addIndividualParticipantsToEvents:r,tournamentRecord:a,participantIds:o}=e,s=(null==(t=a.participants)?void 0:t.length)||0;if(!s)return{...At};let l=null==(i=a.events||[])?void 0:i.filter((({eventType:e})=>e===Xs)).map((e=>{var t;return null==(t=null==e?void 0:e.drawDefinitions)?void 0:t.map((({drawId:e})=>e))})).flat(1/0),u=zv({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],d=null!=l&&l.length?dt((ev({matchUpFilters:{drawIds:l,matchUpTypes:[Oe]},tournamentRecord:a}).matchUps??[]).flatMap((({sides:e})=>null==e?void 0:e.map((({participantId:e})=>e||[])))).filter(Boolean),o):[],c=u.filter((e=>{var t;return null==(t=e.draws)?void 0:t.filter((e=>(!(null!=l&&l.length)||!(null!=l&&l.includes(e.drawId)))&&e.positionAssignments)).length}));if(null!=d&&d.length||c.length)return{error:qn};let p={},m={};for(let h of a.events||[]){let e=ig({participantIds:o,event:h});if(e.error)return e;p[h.eventId]=e.participantIdsRemoved}a.participants=(a.participants??[]).filter((e=>{var t,i;let n=o.includes(e.participantId)||e.participantType===Kp&&(null==(t=e.individualParticipantIds)?void 0:t.some((e=>o.includes(e))));if(!n&&e.participantType===Xs&&null!=(i=e.individualParticipantIds)&&i.some((e=>o.includes(e)))&&(e.individualParticipantIds=e.individualParticipantIds.filter((e=>!o.includes(e)))),n&&r&&e.participantType&&[Kp,Jp].includes(e.participantType))for(let r of e.individualParticipantIds||[])o.includes(r)||(m[e.participantId]||(m[e.participantId]=[]),m[e.participantId].push(r));return!n}));let f=s-a.participants.length;if(vg({individualParticipantIds:o,tournamentRecord:a}),r)for(let h of a.events||[]){ag({participantIds:p[h.eventId].map((e=>m[e]||[])).flat(),entryStatus:Vm,tournamentRecord:a,event:h})}return f&&Ia({payload:{participantIds:o,tournamentId:a.tournamentId},topic:ap}),f?{...At,participantsRemovedCount:f}:{error:Tn}}function Ig({selected:e=!0,drawDefinition:t,entryStatuses:i,drawId:n,event:r,stage:a}){var o;let s=r.entries??[];if(n){let{flightProfile:e}=Eh({event:r}),i=null==(o=null==e?void 0:e.flights)?void 0:o.find((e=>e.drawId===n));i?s=i.drawEntries:t.entries&&(s=null==t?void 0:t.entries)}let l=s.filter((t=>(!(null!=i&&i.length)||!t.entryStatus||i.includes(t.entryStatus))&&(!a||!t.entryStage||t.entryStage===a)&&(!e||t.entryStatus&&zm.includes(t.entryStatus))));return{entries:s,stageEntries:l}}function Ug({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:n,drawId:r,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!t)return{error:Bt};if(!n)return La({result:{error:xn},stack:l});if(!o)return{error:bi};if(!o.eventType||![Zs,el].includes(o.eventType))return La({result:{error:Ti},stack:l});let u=t.participants??[],d=u.find((e=>e.participantId===n));if(!d)return La({result:{error:_n},stack:l});if(!d.participantType||![Kp,Hp].includes(d.participantType)||d.participantType===Hp&&o.eventType!==el||d.participantType===Kp&&o.eventType!==Zs)return{error:Cn};let c=(o.entries??[]).find((e=>e.participantId===n));if(!c)return{error:Yn};let p,{stageEntries:m}=Ig({selected:!1,drawDefinition:i,drawId:r,event:o,stage:a}),f=m.map(hc),h=u.filter((({participantId:e})=>f.includes(e))).map((({individualParticipantIds:e})=>e)).flat().filter(Boolean),v=null==(s=d.individualParticipantIds)?void 0:s.filter((e=>1===ut(e,h).length)),g=ig({participantIds:[n],event:o});return g.error||null!=v&&v.length&&(g=ag({participantIds:v,entryStatus:Vm,entryStage:c.entryStage,tournamentRecord:t,drawDefinition:i,drawId:r,event:o}),g.error)?g:(e&&gg({participantIds:[n],tournamentRecord:t}).success&&(p=!0),{...At,participantRemoved:p})}function yg({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:n,drawId:r,event:a}){return Ug({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:n,drawId:r,event:a})}function Sg(e){if(!e.tournamentRecord)return{error:Bt};let{participantIds:t,...i}=e,n=0,r=[];for(let a of t){let e=Ug({participantId:a,...i});e.success&&(n+=1),e.error&&r.push(e.error)}return n?{destroyedCount:n,...At}:{error:r}}function wg(e){let{tournamentRecord:t,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=e,l="removeDrawPositionAssignment",u=bv(e);if(u.error)return La({result:u,stack:l});let{participantId:d}=u,{drawPosition:c,event:p,structureId:m}=e,f=gm({tournamentRecord:t,drawDefinition:n,event:p}).appliedPolicies??{};if([Em,$m].includes(a)&&d){let{tournamentRecord:t}=e,{participant:i}=nm({tournamentRecord:t,participantId:d}),{participantType:o,individualParticipantIds:u}=i??{};if(r&&o===Kp){let e=yg({tournamentRecord:t,drawDefinition:n,participantId:d,event:p});if(e.error)return La({result:e,stack:l});u&&Cv({participantIds:u,tournamentRecord:t,drawDefinition:n,entryStatus:a,drawId:s,event:p})}else Cv({participantIds:[d],tournamentRecord:t,drawDefinition:n,entryStatus:a,drawId:s,event:p})}if(i){let e=yv({tournamentRecord:t,drawDefinition:n,drawPosition:c,structureId:m,matchUpsMap:o,event:p});if(e.error)return La({result:e,stack:l})}let{structure:h}=Hc({drawDefinition:n,structureId:m});return Lp({structure:h,drawPositions:[c]}),Bp({appliedPolicies:f,drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:c,entryStatus:a,structureId:m}}),u}function Pg(e){return Object.assign(e,{entryStatus:$m}),wg(e)}function Dg(e){return St(e)?e.split(" ").map((e=>e.split("").map(((e,t)=>t?e.toLowerCase():e.toUpperCase())).join(""))).join(" "):e}function Tg(e){return St(e)?Dg(e.replace(/_/g," ")):""}var bg=({finishingPosition:e=Xl,qualifyingRoundNumber:t,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:d,matchUps:c=[],structureId:p,roundOffset:m,roundLimit:f,stageOrder:h,structures:v,stage:g})=>{let I={structureId:p??rs(),structureAbbreviation:i,finishingPosition:e,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:u};a&&(I.structureOrder=a),l&&(I.structureType=l),o&&("string"==typeof o?I.seedingProfile=o:"object"==typeof o&&"string"==typeof o.positioning&&(I.seedingProfile=o.positioning)),d&&(I.matchUpType=d),m&&(I.roundOffset=m),h&&(I.stageOrder=h),f&&(I.roundLimit=f),g&&(I.stage=g),t&&(I.qualifyingRoundNumber=t);let U=c.flatMap((({drawPositions:e})=>e)).filter(Boolean);return v?I.structures=v:(I.matchUps=c,I.positionAssignments=Qe(U).sort(((e,t)=>e-t)).map((e=>({drawPosition:e})))),I},Rg=bg;function Ng({structureName:e=Tg(al),structureAbbreviation:t,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:$t};let a=Rg({stage:al,structureAbbreviation:t,structureName:e,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),kp({drawDefinition:i,structureIds:[a.structureId]}),{...At}}function Mg({drawPositions:e}){if(null==e||!e.length)return{error:Xt};let t=[].concat(...(e??[]).map((t=>e.filter((e=>e!==t)).map((e=>[t,e]))))),i=Qe(t.map(Ag)).map((e=>e.split("|").map((e=>+e))));return{groupMatchUps:t,uniqueMatchUpGroupings:i}}function Ag(e=[]){return Array.isArray(e)&&e.length?[...e].sort(Le).join("|"):""}function Eg({groupSize:e,drawPositionOffset:t}){if(!e)return[];let i=e=>[...Array(e)].map(((e,t)=>t)),n=i(2*Math.round(e/2)+1).slice(1),r=i(n.length-1).map((()=>[])),a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach(((e,t)=>{a.forEach(((e,i)=>{r[t].push([a[i],o[i]])}));let i=a.shift(),n=a.pop(),s=o.shift();a=[i,s,...a].filter(Boolean),o=[...o,n].filter(Boolean)}));let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let d=e=>e[0].reduce(((e,t)=>e+t));return[...r].reverse().sort(((e,t)=>d(e)-d(t))).map((i=>i.filter((t=>t.every((t=>t<=e)))).map((e=>Ag(e.map((e=>e+t)))))))}var Cg={getRoundRobinGroupMatchUps:Mg,determineRoundNumber:function({rounds:e,hash:t}){return null!=e&&e.length?null==e?void 0:e.reduce(((e,i,n)=>i.includes(t)?n+1:e),void 0):{error:un}},drawPositionsHash:Ag,groupRounds:Eg};function Og(e){var t;let i,{groupNameBase:n="Group",playoffAttributes:r,stageSequence:a=1,structureOptions:o,appliedPolicies:s,seedingProfile:l,stage:u=il,matchUpType:d,roundTarget:c,structureId:p,groupNames:m,drawSize:f,idPrefix:h,isMock:v,uuids:g}=e,I=e.structureName??(null==(t=null==r?void 0:r[0])?void 0:t.name)??Tg(il),{groupCount:U,groupSize:y}=function({appliedPolicies:e,structureOptions:t,drawSize:i}){let n=null==t?void 0:t.groupSize,r=(null==t?void 0:t.groupSizeLimit)||8,{validGroupSizes:a}=kg({groupSizeLimit:r,drawSize:i}),o=a&&Math.max(...a);n&&null!=a&&a.includes(n)||(n=n&&n>4||null==a||!a.includes(4)?o:4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}({structureOptions:o,appliedPolicies:s,drawSize:f}),S=Zl,w=lt(1,U+1).map((e=>{let t=function({structureOrder:e,matchUpType:t,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:o}){let s=(e-1)*i,l=lt(1+s,i+1+s),u=Mg({drawPositions:l}).uniqueMatchUpGroupings??[],d=Eg({groupSize:i,drawPositionOffset:s});return u.map(p).sort(((e,t)=>(e.roundNumber??1/0)-(t.roundNumber??1/0)));function c(e){return d.reduce(((t,i,n)=>i.includes(e)?n+1:t),void 0)}function p(i){let s=c(Ag(i)),l=[1,n],u=function({structureOrder:e,drawPositions:t,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${e}-${i}-DP-${t.join("-")}`:(null==r?void 0:r.pop())||rs()}({structureOrder:e,drawPositions:i,roundNumber:s,idPrefix:r,uuids:o}),d={matchUpStatus:s?Oc:Sc,matchUpType:t,finishingPositionRange:{winner:l,loser:l},drawPositions:i,roundNumber:s,matchUpId:u};return a&&(d.isMock=!0),d}}({groupSize:y,structureOrder:e,matchUpType:d,drawSize:f,idPrefix:h,isMock:v});i=Array.isArray(t)?Math.max(...t.map((({roundNumber:e})=>e??0))):0;let r=(null==m?void 0:m[e-1])??`${n} ${e}`;return bg({structureId:null==g?void 0:g.pop(),structureType:hl,finishingPosition:S,structureOrder:e,structureName:r,matchUps:t})})),P=bg({structureId:p??(null==g?void 0:g.pop()),structureType:vl,finishingPosition:S,seedingProfile:l,structureName:I,stageSequence:a,structures:w,stage:u});return c&&Sd({extension:{name:Jd,value:c},element:P}),{structures:[P],maxRoundNumber:i,groupCount:U,links:[],groupSize:y,...At}}function kg(e){let{groupSizeLimit:t=10,drawSize:i=0}=e??{},n=lt(3,t+1).filter((e=>{let t=Math.ceil(i/e),n=t*e-i,r=Math.ceil(i/t),a=Math.ceil(n/t);return(!n||n<e)&&r===e&&r>=3&&a<2}));return{...At,validGroupSizes:n}}function Fg(e){let{roundRobinGroupsCount:t,participantsCount:i,cluster:n}=e;if(!Ye(i))return{seedBlocks:void 0,...La({result:{error:Cr},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=He(i);if(t){let e=Math.min(t,r),i=[],n=1;for(lt(0,e).forEach((()=>{i.push([n]),n++}));n<r;){let t=lt(n,n+e);n+=e,i.push(t)}return{...At,seedBlocks:i}}let a=lt(1,r+1),o=[],s=r/2;for(;s>1;){let e=ht(a,s),t=e.length;e.forEach(((e,i)=>{let r,a=i<t/2,s=i%2==0,l=e[0],u=e[e.length-1];r=n&&t>4?8===t?a?u:l:s?l:u:a?l:u,pt(e,o)||o.push(r)})),s/=2}let l=a.filter((e=>!o.includes(e)));for(;l.length;)l.length%2==0?o.push(l.pop()):o.push(l.shift());let u=lt(0,20).map((e=>Math.pow(2,e)));u.unshift(1);let d=u.indexOf(r),c=0,p=[];return lt(0,d).forEach((e=>{p.push(o.slice(c,c+u[e])),c+=u[e]})),{...At,seedBlocks:p}}function xg({roundRobinGroupsCount:e,drawSize:t}){let i="getSeedGroups";if(!Ye(t))return{seedGroups:void 0,...La({result:{error:Cr},context:{drawSize:t},stack:i})};if(e){if(!Ye(e))return{seedGroups:void 0,...La({context:{roundRobinGroupsCount:e},result:{error:Cr},stack:i})};let n=1;return{seedGroups:lt(0,Math.floor(t/e)).map((()=>{let t=lt(n,n+e);return n+=e,t}))}}{let{seedBlocks:i}=Fg({participantsCount:t,roundRobinGroupsCount:e}),n=0;return{seedGroups:(i||[]).map((e=>(e||[]).map((()=>(n+=1,n)))))}}}function _g({roundRobinGroupsCount:e,participantsCount:t}){var i;if(e){let{validGroupSizes:n}=kg({drawSize:t});if(null==(i=null==n?void 0:n.map((e=>Math.ceil(t/e))))||!i.includes(e))return La({context:{roundRobinGroupsCount:e},result:{error:Cr}})}let{seedGroups:n}=xg({drawSize:t,roundRobinGroupsCount:e}),r=(null==n?void 0:n.map((e=>Math.min(...e))))||[];return{...At,seedingThresholds:r}}function Lg(e){if(!e)return 1/0;if(Ye(e))return Be(e);let t=e.split("-")[0];return Ye(t)?Be(t):1/0}function Bg({positioning:e,size:t}){let i=function({size:e}){let t=[e],i=e;for(;i/2===Math.floor(i/2);)i/=2,t.push(i);return t.includes(1)||t.push(1),t.sort(Le),t.reverse(),t}({size:t}),n=[],r=[],a=e=>e[0],o=(t,i)=>(e&&[ml,fl].includes(e)&&i%2?(e=>e[e.length-1])(t):a(t))||a(t),s=(e,t)=>{if(e.every((e=>!r.includes(e)))){let i=o(e,t);return r.push(i),i}},l=e=>{let t=e.filter((e=>!r.includes(e)));if(t.length)return r.push(...t),t},u=(e,t)=>{let i=o(e,t);if(!r.includes(i))return r.push(i),i},d=lt(1,t+1);for(let c of i)if(1===c){let e=ht(d,2),t=e.map(s).filter(Boolean);t.length&&n.push(t);let i=e.flatMap(l).filter(Boolean);i.length&&n.push(i)}else{let e=ht(d,c).map(u).filter(Boolean);e.length&&n.push(e)}return{divisions:i,divisionGroupings:n}}function Vg({provisionalPositioning:e,returnAllProxies:t,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:Pi};let{matchUps:u,roundMatchUps:d}=jh({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:e,structure:o}),{seedAssignments:c}=Xm({provisionalPositioning:e,returnAllProxies:t,drawDefinition:r,structure:o}),{positionAssignments:p}=Jc({structure:o}),m=null==p?void 0:p.length,f=(null==c?void 0:c.length)??0,h=[],v=Object.keys(d).map((e=>parseInt(e))).sort(((e,t)=>e-t)).map((e=>{let t=d[e].map((e=>e.drawPositions)).flat(1/0).filter(Boolean),i=t.filter((e=>!h.includes(e)));return h=h.concat(...t),i})).filter((e=>e.length)).reverse(),g=v.pop()??[],I=g&&Math.min(...g)-1||0;n=n??(null==(s=null==i?void 0:i.seeding)?void 0:s.seedingProfile);let U=(null==g?void 0:g.length)||0,y=v.filter((e=>e.filter((e=>e<=f)).length)),{stage:S,structureType:w,roundLimit:P}=o,D=w===vl,T=!D&&(null==v?void 0:v.length),b=!D&&S===nl&&P,R=y.flat(1/0),N=T?null==R?void 0:R.length:0,M=a?m:f,A=pf({drawDefinition:r,structure:o,matchUps:u}),E=A?0:!T&&M||M&&R.length<M&&M-R.length||0;if(b){let e=null!=o&&o.matchUps?o.matchUps.filter((({roundNumber:e})=>e===o.roundLimit)).length:0,t=g.length/e;if(!T){let e=qg(n),i=ht(g,t),r=1,a=lt(0,i[0].length).map((()=>{let e=lt(r,r+i.length);return r+=i.length,e}));({validSeedBlocks:l}=jg({drawPositionBlocks:i,nonRandom:null==n?void 0:n.nonRandom,positioning:e,seedGroups:a}))}}else D?({validSeedBlocks:l}=function({seedingProfile:e,structure:t,nonRandom:i}){var n;let r=t.structures||[],a=r.length,o=null==(n=Kc({structure:t}))?void 0:n.positionAssignments,s=qg(e),l=(null==o?void 0:o.length)??0,{seedGroups:u}=xg({roundRobinGroupsCount:a,drawSize:l}),d=r.map((e=>{var t;return null==(t=Kc({structure:e}).positionAssignments)?void 0:t.map((e=>e.drawPosition))}));return jg({drawPositionBlocks:d,positioning:s,seedGroups:u,nonRandom:i})}({nonRandom:null==n?void 0:n.nonRandom,seedingProfile:n,structure:o})):T?l=y.map((e=>({seedNumbers:e,drawPositions:e}))):A&&ht(g,2).map(((e,t)=>({drawPositions:[e[0]],seedNumbers:[t+1]}))).forEach((e=>l.push(e)));if(!D&&!A&&!b){let{blocks:e}=function(e){let{drawPositionOffset:t=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:o}=e,s=1,l=[],{seedBlocks:u}=Fg({cluster:qg(r)===ml,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let c of u){if(s+1>a)break;let e=c.map((e=>e+t)),i=d(s+1,c.length).map((e=>+e+n));s+=c.length,l.push({drawPositions:e,seedNumbers:i})}return{blocks:l};function d(e,t){return Array.from(new Array(t),((t,i)=>i+e))}}({drawPositionOffset:I,seedNumberOffset:N,seedCountGoal:E,seedingProfile:n,baseDrawSize:U});e.forEach((e=>l.push(e)))}let C=l.flatMap((e=>e.drawPositions)).reduce(((e,t)=>(null==g?void 0:g.includes(t))&&e),!0);return A||T||D||C?{isLuckyStructure:A,validSeedBlocks:l,isContainer:D,isFeedIn:T}:{error:gi,validSeedBlocks:[],isContainer:D,isFeedIn:T}}function jg({drawPositionBlocks:e,positioning:t,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=Bg({size:i.length,positioning:t}),o=[];return i.forEach(((i,s)=>{let l=function({blockPattern:e,index:t}){let i=0;for(let n of e){if(i===t)return n;let e=0;for(;e<n.length;){if(i===t)return n;i+=1,e++}}}({blockPattern:a,index:s});i.forEach(((i,a)=>{let u=s%2?e.length-a-1:a,d=e[u].slice().filter(((e,t)=>l.includes(t+1)&&e));t!==fl?d=n?d:Xe(d):s%2&&d.reverse();let c=d.find((e=>!o.includes(e)));c&&(o.push(c),r.push({drawPositions:[c],seedNumbers:[i]}))}))})),{validSeedBlocks:r}}function Gg({appliedPolicies:e,drawDefinition:t,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var o,s,l,u,d,c;let{structure:p}=Hc({drawDefinition:t,structureId:r});e||(e=gm({drawDefinition:t}).appliedPolicies);let m=null==i?void 0:i.validSeedBlocks;return!m&&p&&(m=null==(o=Vg({appliedPolicies:e,drawDefinition:t,structure:p}))?void 0:o.validSeedBlocks),!(null==(l=null==(s=null==e?void 0:e.seeding)?void 0:s.validSeedPositions)||!l.ignore)||(null!=(d=null==(u=null==e?void 0:e.seeding)?void 0:u.validSeedPositions)&&d.strict?((null==(c=m.find((e=>e.seedNumbers.includes(a))))?void 0:c.drawPositions)||[]).includes(n):[].concat(...m.map((e=>e.drawPositions))).includes(n))}function $g(e){var t,i,n;let{provisionalPositioning:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:u}=e,{structure:d}=Hc({drawDefinition:a,structureId:l}),{seedAssignments:c}=Xm({returnAllProxies:e.returnAllProxies,provisionalPositioning:r,drawDefinition:a,structure:d}),{positionAssignments:p}=Jc({structure:d}),m=null==(t=null==p?void 0:p.filter((e=>e.participantId??e.bye??e.qualifier)))?void 0:t.map((e=>e.drawPosition)).filter(Boolean),{appliedPolicies:f}=gm({drawDefinition:a}),h=((null==s?void 0:s.validSeedBlocks)||d&&(null==(i=Vg({returnAllProxies:e.returnAllProxies,provisionalPositioning:r,appliedPolicies:f,drawDefinition:a,seedingProfile:o,structure:d}))?void 0:i.validSeedBlocks)||[]).filter((e=>e.drawPositions.filter((e=>!(null!=m&&m.includes(e)))).length))[0],v=null==c?void 0:c.map((e=>e.participantId)).filter(Boolean),g=null==p?void 0:p.map((e=>e.participantId)).filter(Boolean),I=null==v?void 0:v.filter((e=>null==g?void 0:g.includes(e))),U=null==v?void 0:v.filter((e=>!(null!=g&&g.includes(e)))),y=null==c?void 0:c.filter((e=>null==U?void 0:U.includes(e.participantId))),S=null==c?void 0:c.filter((e=>!e.participantId)),w=(null!=y&&y.length&&y.length>0?y.length:(null==S?void 0:S.length)??0)&&(null==h?void 0:h.drawPositions.filter((e=>!(null!=m&&m.includes(e)))))||[],P=u?Xe(w):w,D=[],T=P.map((()=>{var e;let t=null==(e=function(e,t){let i=e.filter((e=>!t.includes(e.participantId))),n=Math.min(...i.map((e=>Lg(e.seedValue))));return Xe(i.filter((e=>Lg(e.seedValue)===n))).pop()}(y,D))?void 0:e.participantId;return t&&D.push(t),t})).filter(Boolean),b=null==c?void 0:c.filter((e=>null==I?void 0:I.includes(e.participantId))).map((e=>e.seedNumber)),R=((null==h?void 0:h.seedNumbers)||[]).filter((e=>!(null!=b&&b.includes(e)))),N=null==c?void 0:c.filter((e=>R.includes(e.seedNumber))).map((e=>e.participantId)),M=null==(n=null==f?void 0:f.seeding)?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:h,unplacedSeedParticipantIds:void 0===M||M?T:N,unplacedSeedNumbers:R,unfilledPositions:P,unplacedSeedAssignments:y}}function qg(e){return"string"==typeof e?e:"object"==typeof e?e.positioning:void 0}function Wg({provisionalPositioning:e,tournamentRecord:t,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:d}){var c,p,m;let f="assignSeed",{structure:h}=Hc({drawDefinition:i,structureId:o}),{positionAssignments:v}=Jc({structure:h}),g=Xm({provisionalPositioning:e,drawDefinition:i,structure:h}).seedAssignments,I=g.map((e=>e.seedNumber)),U=Yv({drawDefinition:i,participantId:r});if(r&&!U)return La({result:{error:Mn},context:{participantId:r},stack:f});let y,S=d?null==(p=null==(c=Eh({event:d}).flightProfile)?void 0:c.flights)?void 0:p.length:0,w=S&&S>1,P=null==(m=null==v?void 0:v.find((e=>e.participantId===r)))?void 0:m.drawPosition;return P&&!Gg({drawPosition:P,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s})?La({result:{error:Yt},context:{assignedDrawPosition:P},info:"invalid seed position",stack:f}):(I.includes(s)||g.push({seedNumber:s,seedValue:l}),g.forEach((e=>{e.participantId===r&&e.seedNumber!==s&&(e.participantId=void 0),e.seedNumber===s&&(e.participantId=r,!(null!=n&&n.groupSeedingThreshold)&&!w&&(e.seedValue=l??s),y=!0)})),y?(Fp({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:i,structure:h,eventId:u}),{...At}):La({result:{error:vi},stack:f}))}function Hg({inContextTargetMatchUp:e,drawPositionSideIndex:t,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:o}){var s,l,u,d;let c=null==(l=null==(s=null==e?void 0:e.sides)?void 0:s[t])?void 0:l.sideNumber,p=c&&(null==(u=a.sides)?void 0:u.find((e=>e.sideNumber===c))),{extension:m}=Cd({element:r,name:qd}),f=ts(((null==m?void 0:m.value)||{})[i],!1,!0);if(p)null==(d=null==a?void 0:a.sides)||d.forEach((e=>{e.sideNumber===c&&(e.lineUp=f)}));else{a.sides=[1,2].map((e=>{var t;return{...(null==(t=a.sides)?void 0:t.find((t=>t.sideNumber===e)))??{},sideNumber:e}}));let e=a.sides.find((e=>e.sideNumber===c));e&&(e.lineUp=f)}Cp({tournamentId:null==n?void 0:n.tournamentId,context:"updateSidLineUp",eventId:null==o?void 0:o.eventId,drawDefinition:r,matchUp:a})}function zg(e){let{sourceMatchUp:t}=e,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=e,o=i.roundNumber>1&&i.roundNumber-1,s=af({structureId:n.structureId,matchUpsMap:r});!t&&a&&(t=s.find((({drawPositions:e,roundNumber:t})=>t===o&&(null==e?void 0:e.includes(a)))));let l=null==t?void 0:t.roundPosition,u=l+(l%2?1:-1),d=o&&s.find((({roundNumber:e,roundPosition:t})=>e===o&&t===u)),c=null==d?void 0:d.matchUpStatus;return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:[Rc,bc].includes(c)}}function Yg({structureId:e,matchUpsMap:t,matchUp:i}){let n=null==i?void 0:i.roundPosition,r=n+(n%2?1:-1);return{pairedPreviousMatchUp:af({matchUpsMap:t,structureId:e}).find((({roundNumber:e,roundPosition:t})=>e===(null==i?void 0:i.roundNumber)&&t===r))}}function Kg({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=e.find((e=>e.matchUpId===i)),{pairedPreviousMatchUp:o}=Yg({structureId:null==a?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&o){let i=null==o?void 0:o.matchUpId,n=e.find((e=>e.matchUpId===i)),s=(null==a?void 0:a.structureId)===(null==n?void 0:n.structureId)?(null==a?void 0:a.roundPosition)<(null==n?void 0:n.roundPosition)?1:2:a.structureId===(null==n?void 0:n.structureId)?2:1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map((e=>{let i=St(e)||!isNaN(e)?{code:e}:e;return i.sideNumber===s?{...i,previousMatchUpStatus:t}:i}))}}function Jg({inContextDrawMatchUps:e,drawPosition:t,matchUpId:i}){let n=e.filter((({winnerMatchUpId:e,loserMatchUpId:t})=>t===i||e===i)).sort(((e,t)=>e.roundPosition-t.roundPosition));return e.find((e=>e.matchUpId===i)).feedRound?1:n.reduce(((e,i,n)=>{var r;return null!=(r=i.drawPositions)&&r.includes(t)?n+1:e}),void 0)}function Qg({inContextDrawMatchUps:e,sourceMatchUpStatus:t,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var d,c,p,m;let f="assignMatchUpDrawPosition";s||(s=rf({drawDefinition:r})),e||(e=Qh({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let h=e.find((e=>e.matchUpId===l)),v=null==h?void 0:h.structureId,g=null==(d=null==r?void 0:r.structures)?void 0:d.find((e=>e.structureId===v));if(!g)return{error:Si};let I=null==(c=null==s?void 0:s.drawMatchUps)?void 0:c.find((e=>e.matchUpId===l)),U=(null==I?void 0:I.drawPositions)??[],{positionAdded:y,positionAssigned:S,updatedDrawPositions:w}=function({drawPosition:e,drawPositions:t}){let i=!1,n=!(null==t||!t.includes(e));return{updatedDrawPositions:n?t||[]:[...t,void 0,void 0].slice(0,2).map((t=>t||n?t:(n=!0,i=!0,e))).sort(Le).filter(Boolean),positionAdded:i,positionAssigned:n}}({drawPositions:U,drawPosition:o}),{positionAssignments:P}=Kc({drawDefinition:r,structure:g}),D=null==(p=null==P?void 0:P.filter((e=>w.includes(e.drawPosition))))?void 0:p.find((({bye:e})=>e)),T=(null==I?void 0:I.matchUpStatus)&&[kc,Tc].includes(I.matchUpStatus)&&w.filter(Boolean).length<2;if(a=D&&Sc||a||T&&I.matchUpStatus||(null==I?void 0:I.matchUpStatus)&&[Rc,bc].includes(I.matchUpStatus)&&I.matchUpStatus||Oc,I&&y){e=Qh({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let u=T&&Jg({inContextDrawMatchUps:e,drawPosition:o,matchUpId:l})||void 0;null!=I&&I.matchUpStatusCodes&&Kg({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:n,matchUpsMap:s,matchUp:I}),Object.assign(I,{drawPositions:w,winningSide:u,matchUpStatus:a}),Cp({tournamentId:null==i?void 0:i.tournamentId,eventId:null==h?void 0:h.eventId,context:f,drawDefinition:r,matchUp:I})}let b=zh({inContextDrawMatchUps:e,inContextMatchUp:h,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:R,loserMatchUp:N,loserTargetDrawPosition:M},targetLinks:{loserTargetLink:A}}=b,E=af({structureId:g.structureId,matchUpsMap:s});if(S&&D){if(R)if([Sc,Rc,bc].includes(a)){let t=Qg({matchUpId:R.matchUpId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(t.error)return t}else{let{structureId:e}=R;e!==g.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(R&&h&&!h.feedRound){let{pairedPreviousMatchUpIsDoubleExit:t}=zg({targetMatchUp:I,drawPosition:o,matchUpsMap:s,structure:g});if(t){let t=Qg({matchUpId:R.matchUpId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(t.error)return t}}if((null==I?void 0:I.matchUpType)===Fe){let t=null==e?void 0:e.find((({matchUpId:e})=>e===I.matchUpId)),n=((null==t?void 0:t.sides)??[]).reduce(((e,t,i)=>t.drawPosition===o?i:e),void 0),a=null==(m=null==P?void 0:P.find((e=>e.drawPosition===o)))?void 0:m.participantId;a&&void 0!==n&&Hg({inContextTargetMatchUp:t,drawPositionSideIndex:n,teamParticipantId:a,tournamentRecord:i,drawDefinition:r,matchUp:I})}if((null==A?void 0:A.linkCondition)===Dl&&2===w.filter(Boolean).length&&!D&&E.filter((({drawPositions:e,roundNumber:t})=>1===t&&pt(e,w))).every((({matchUpStatus:e})=>[Pc,Ec].includes(e)))&&N){let{structureId:e}=N,t=yv({drawPosition:M,tournamentRecord:i,drawDefinition:r,structureId:e,matchUpsMap:s,event:u});if(t.error)return t}return S?{...At}:La({result:{error:Kt},context:{drawPosition:o},stack:f})}function Zg({inContextDrawMatchUps:e,drawDefinition:t,assignments:i,matchUpsMap:n,structure:r}){var a,o,s,l;let u=(null==(s=null==(o=null==(a=Vp({drawDefinition:t}))?void 0:a.containedStructures)?void 0:o[r.structureId])?void 0:s.map((({structureId:e})=>e)))||[];u.push(null==r?void 0:r.structureId);let d=(null==i?void 0:i.map((({drawPosition:e})=>e)))||[],c=(null==e?void 0:e.filter((e=>u.includes(e.structureId)&&dt(e.drawPositions??[],d).length)))??[],p=c.map((({matchUpId:e})=>e)),m=(null==(l=null==n?void 0:n.drawMatchUps)?void 0:l.filter((e=>p.includes(e.matchUpId))))??[];return{drawPositions:d,matchUps:m,targetMatchUps:c}}function Xg({lineUp:e}){if(!Array.isArray(e))return;let t={};return Qe(e.flatMap((({collectionAssignments:e})=>null==e?void 0:e.map((({collectionId:e,collectionPosition:t})=>[e,t].join("|"))))).filter(Boolean)).forEach((i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:o}=kh({collectionPosition:a,collectionId:n,lineUp:e});o.forEach((e=>{t[e]||(t[e]=[]),t[e].push({collectionId:n,collectionPosition:a})}))})),Object.keys(t).map((e=>({participantId:e,collectionAssignments:t[e]})))}function eI(e){return`${e} must be an array`}function tI({lineUp:e,tieFormat:t}){let i=[];if(!Array.isArray(e))return i.push(eI("lineUp")),{valid:!1,errors:i,error:Cr};let n=e.every((e=>{if("object"!=typeof e)return i.push("lineUp entries must be objects"),!1;let{participantId:t,collectionAssignments:n}=e;return t?"string"!=typeof t?(i.push("participantIds must be strings"),!1):Array.isArray(n)?n.every((e=>{if("object"!=typeof e)return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:t}=e;return"number"==typeof t||(i.push("collectionPosition must be a number"),!1)})):(i.push(eI("collectionAssignments")),!1):(i.push("Missing participantId"),!1)})),r=Qe(e.map(hc)).length===e.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Cr:void 0}}function iI({drawDefinition:e,participantId:t,tieFormat:i,lineUp:n}){if("object"!=typeof e)return{error:$t};if("string"!=typeof t)return{error:xn};let r=tI({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=Cd({element:e,name:qd}),o=(null==a?void 0:a.value)||{};return o[t]=Xg({lineUp:n}),Sd({element:e,extension:{name:qd,value:o}}),Op({drawDefinition:e}),{...At}}function nI({inContextDrawMatchUps:e,inheritance:t=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:o,event:s}){if(!n)return{error:$t};let{drawPositions:l,matchUps:u,targetMatchUps:d}=Zg({inContextDrawMatchUps:e,matchUpsMap:r,assignments:a,structure:o});for(let c of d)c.matchUpType===ke&&(c.sides??[]).forEach(((e,r)=>{var a;if(null!=e&&e.drawPosition&&null!=l&&l.includes(e.drawPosition)){let o=u.find((({matchUpId:e})=>e===c.matchUpId));if(null!=(a=null==o?void 0:o.sides)&&a[r]){if(delete o.sides[r].lineUp,!1===t){let t=c.tieFormat,i=e.participantId;t&&i&&iI({drawDefinition:n,participantId:i,lineUp:[],tieFormat:t})}Cp({tournamentId:null==i?void 0:i.tournamentId,context:"resetLineUps",eventId:null==s?void 0:s.eventId,drawDefinition:n,matchUp:o})}}}));return{...At}}function rI({provisionalPositioning:e,inContextDrawMatchUps:t,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:d,structureId:c,event:p}){var m,f,h,v,g;let I="assignDrawPosition";if(!s&&!i)return La({result:{error:xn},stack:I});d=d??rf({drawDefinition:a}),t||({matchUps:t}=Qh({inContext:!0,drawDefinition:a,matchUpsMap:d}));let U=Hc({drawDefinition:a,structureId:c});if(U.error)return La({result:U,stack:I});let{structure:y}=U;if(!y)return{error:Si};if(mf({structure:y}))return La({result:{error:Qi},stack:I});let{seedAssignments:S}=Xm({provisionalPositioning:e,drawDefinition:a,structure:y}),w=null==(m=null==S?void 0:S.find((e=>e.participantId===s)))?void 0:m.seedNumber,{appliedPolicies:P}=gm({tournamentRecord:r,drawDefinition:a,structure:y,event:p});if(w&&!Gg({seedNumber:w,appliedPolicies:P,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:c}))return La({result:{error:Yt},context:{drawPosition:u},stack:I});let D=Jc({structure:y}).positionAssignments||[],T=null==D?void 0:D.find((e=>e.drawPosition===u));if(!T)return La({result:{error:ii},context:{drawPosition:u},stack:I});if(null!=D&&D.map(hc).includes(s))return La({result:{error:qn},context:{drawPosition:u},stack:I});let{containsParticipant:b,containsBye:R}=function(e){let t=e.bye,i=e.qualifier,n=e.participantId;return{containsBye:t,containsQualifier:i,containsParticipant:n,filled:t||i||n}}(T);if(R){let e=bv({inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:a,drawPosition:u,structureId:c,matchUpsMap:d,event:p});if(e.error)return La({result:e,stack:I})}if(b&&T.participantId!==s){let{activeDrawPositions:e}=fv({drawDefinition:a,structureId:c});if(e.includes(u))return La({result:{error:ei},stack:I});nI({assignments:[T],inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:a,matchUpsMap:d,structure:y})}if(T.participantId=s,i&&(T.qualifier=!0),y.stage===il&&(!y.stageSequence||y.stageSequence>1)||y.stage&&[rl,ol].includes(y.stage)){let t=y.stage===nl?nl:il,i=((null==(h=null==(f=a.structures)?void 0:f.find((e=>(null==e?void 0:e.stage)===t&&1===(null==e?void 0:e.stageSequence))))?void 0:h.seedAssignments)??[]).find((e=>e.participantId===s));if(null!=i&&i.participantId){let{participantId:t,seedNumber:n,seedValue:s}=i;Wg({eventId:null==p?void 0:p.eventId,provisionalPositioning:e,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:t,seedNumber:n,seedValue:s,structureId:c,event:p})}}if(y.structureType!==vl)!function({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:d}=jh({provisionalPositioning:e,matchUpFilters:u,drawDefinition:r,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:c}=uf({matchUps:d}),{initialRoundNumber:p}=hv({drawPosition:a,matchUps:d}),m=p&&(null==c?void 0:c[p].find((e=>{var t;return null==(t=e.drawPositions)?void 0:t.includes(a)})));if(m){let e=Qg({matchUpId:m.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o});if(e.error)return La({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:e})}}({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:u,matchUpsMap:d,structure:y,event:p});else{Tv({positionAssignments:D,tournamentRecord:r,drawDefinition:a,matchUpsMap:d,structure:y});let{drawPositions:e,matchUps:i,targetMatchUps:n}=Zg({assignments:[T],inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:d,structure:y});if(e&&1===(null==i?void 0:i.length)&&i[0].matchUpType===Fe){let t=((null==n?void 0:n[0].sides)??[]).reduce(((t,i,n)=>null!=e&&e.includes(i.drawPosition)?n:t),void 0);Hg({inContextTargetMatchUp:n[0],teamParticipantId:s,matchUp:i[0],drawPositionSideIndex:t,tournamentRecord:r,drawDefinition:a})}}let N=null==(v=a.entries)?void 0:v.find((e=>e.participantId===s)),M=null==(g=null==p?void 0:p.entries)?void 0:g.find((e=>e.participantId===s));return!N&&M&&Xv({entryStatus:M.entryStatus,entryStage:y.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),xp({tournamentId:null==r?void 0:r.tournamentId,drawDefinition:a,structure:y,event:p}),{positionAssignments:D,...At}}function aI(e){let{participantIdAttributeName:t="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=e,d="positionParticipantAction";if(!a)return{error:$t};let c=gm({tournamentRecord:r,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=e;m||(m=rf({drawDefinition:a}),Object.assign(e,{matchUpsMap:m})),p||(({matchUps:p}=Qh({inContext:!0,drawDefinition:a,matchUpsMap:m})),Object.assign(e,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Kc({drawDefinition:a,structureId:l}),h=null==f?void 0:f.find((e=>e.drawPosition===s));if(null!=h&&h.participantId){let e=h.participantId,t=rI({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});return t.success?U({appliedPolicies:c,removedParticipantId:e}):La({result:t,stack:d})}let v=bv({inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:m,event:u});if(v.error)return La({result:v,stack:d});let g=v.participantId,I=rI({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:u});return I.success?U({appliedPolicies:c,removedParticipantId:g}):La({result:I,stack:d});function U({appliedPolicies:e,removedParticipantId:i}){let{structure:r}=Hc({drawDefinition:a,structureId:l});return Lp({drawPositions:[s],structure:r}),Bp({appliedPolicies:e,drawDefinition:a,positionAction:{[t]:o,name:n,drawPosition:s,structureId:l}}),La({context:{removedParticipantId:i},result:{...At},stack:d})}}function oI(e){return function({luckyLoserParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r}){return aI({positionActionName:"luckyLoserDrawPositionAssignment",participantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r})}(e)}function sI({params:e,modMap:t,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=e;for(let o of i.matchUps)t[o.matchUpId]&&(o.roundNumber=t[o.matchUpId],Cp({tournamentId:null==n?void 0:n.tournamentId,eventId:null==a?void 0:a.eventId,drawDefinition:r,matchUp:o}))}function lI(e,t){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(t)&&i.push(...t);let n=qu(e,i);if(n.error)return n;let r=Hc(e);if(r.error)return r;let a=r.structure;if(!mf({structure:a}))return La({result:{error:Ht,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=uf({matchUps:null==a?void 0:a.matchUps});return null!=s&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Ki}}function uI(e){var t;let i=lI(e,[{targetRoundNumber:!0,roundNumber:!0,[Lu]:"number"}]);if(i.error)return i;let{structure:n,roundMatchUps:r,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=e;if(null==a||!a.includes(s)||null==a||!a.includes(o))return La({result:{error:Cr},info:"roundNumbers must be valid rounds"});let l=o>s,u=l?lt(s+1,o+1):lt(o,s),d={};return u.forEach((e=>((null==r?void 0:r[e])??[]).forEach((({matchUpId:t})=>{d[t]=e-(l?1:-1)})))),null==(t=null==r?void 0:r[s])||t.forEach((({matchUpId:e})=>d[e]=o)),sI({params:e,modMap:d,structure:n}),{...At}}function dI({structurePositionAssignments:e,provisionalPositioning:t,tournamentRecord:i,drawDefinition:n,event:r}){var a;if(!n)return{error:$t};if(!Array.isArray(e))return{error:Cr};for(let s of e){let{structureId:e,positionAssignments:o}=s;if(!o)continue;let l=Hc({drawDefinition:n,structureId:e});if(l.error)return l;let u=l.structure;if(!u)return{error:Si};let d=null==(a=Kc({structure:u}).positionAssignments)?void 0:a.map((({drawPosition:e})=>e));if(dt(d,null==o?void 0:o.map((({drawPosition:e})=>e))).length!==(null==d?void 0:d.length))return La({result:{error:Cr},info:"drawPositions do not match",stack:"setPositionAssignments"});let c=rf({drawDefinition:n}),{matchUps:p}=Qh({inContext:!0,drawDefinition:n,matchUpsMap:c});for(let a of o||[]){let{drawPosition:s,participantId:l,bye:d,qualifier:m}=a;if(d){let t=yv({tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:c,structureId:e,structure:u,event:r});if(null!=t&&t.error)return t}else if(m)o.forEach((e=>{e.drawPosition===s&&(e.qualifier=!0,delete e.participantId,delete e.bye)}));else if(l){let a=rI({provisionalPositioning:t,inContextDrawMatchUps:p,tournamentRecord:i,drawDefinition:n,participantId:l,drawPosition:s,matchUpsMap:c,structureId:e,event:r});if(null!=a&&a.error)return a}}xp({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:n,structure:u,event:r})}let o=e.map((({structureId:e})=>e));return kp({tournamentId:null==i?void 0:i.tournamentId,eventId:null==r?void 0:r.eventId,drawDefinition:n,structureIds:o}),{...At}}function cI(e){let t=lI(e,[{roundNumbers:!0,[Lu]:ku,[Fu]:e=>2===e.length&&e.every(qe)}]);if(t.error)return t;let{structure:i,roundMatchUps:n,roundNumbers:r}=t;if(!e.roundNumbers.every((e=>null==r?void 0:r.includes(e))))return La({result:{error:Cr,message:"roundNumbers must be valid rounds"}});let a={};return e.roundNumbers.forEach(((t,i)=>((null==n?void 0:n[t])??[]).forEach((({matchUpId:t})=>{a[t]=e.roundNumbers[1-i]})))),sI({params:e,modMap:a,structure:i}),{...At}}function pI(e){return function({qualifyingParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r}){return aI({positionActionName:"qualifierDrawPositionAssignment",participantId:e,isQualifierPosition:!0,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r})}(e)}function mI({alternateParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r,event:a}){return aI({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r,event:a})}function fI({validation:e=!0,tournamentRecord:t,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:o}){if(!i)return{error:$t};if(!r)return{error:yi};let s=((null==t?void 0:t.participants)??[]).find((e=>e.participantId===n));if(t&&!s)return{error:Mn};let{structure:l}=Hc({drawDefinition:i,structureId:r});if(!l)return{error:Si};if(!(!e||qe(a)||void 0===a||""===a||"string"==typeof a&&a.split("-").every((e=>qe(e)&&Be(e)>0))))return{error:Cr};let{seedAssignments:u}=Xm({drawDefinition:i,structure:l}),d=null==u?void 0:u.map((e=>e.seedNumber)),c=null==u?void 0:u.find((e=>e.participantId===n));if(c){let e="string"==typeof a?a.includes("-")&&a.split("-").map((e=>parseInt(e))).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";c.seedValue=e}else{let e={seedNumber:Math.max(0,...d||[])+1,participantId:n};a&&(e.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(e)}return Fp({tournamentId:null==t?void 0:t.tournamentId,eventId:null==o?void 0:o.eventId,drawDefinition:i,structure:l}),{...At}}function hI({drawDefinition:e,structureId:t}){if(!e)return{error:$t};let{structure:i}=Hc({drawDefinition:e,structureId:t}),n=((null==e?void 0:e.links)||[]).filter((e=>{var i;return(null==(i=e.source)?void 0:i.structureId)===t})).map((e=>{var t;return null==(t=e.target)?void 0:t.structureId}));return{playoffStructures:((null==e?void 0:e.structures)||[]).filter((e=>n.includes(e.structureId))),structure:i}}function vI({withStageGrouping:e,stageSequences:t,stageSequence:i,roundTarget:n,stages:r,event:a,stage:o}){if(!a)return{error:bi};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:a,stageStructures:d}=zc({withStageGrouping:e,stageSequences:t,drawDefinition:u,stageSequence:i,roundTarget:n,stages:r,stage:o});if(l.push(...a),d)for(let e of Object.keys(d))s[e]||(s[e]=[]),s[e].push(...d[e])}return{structures:l,stageStructures:s}}function gI({withStageGrouping:e,tournamentRecord:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:o}){if(!t)return{error:Bt};let s={},l=[];for(let u of t.events||[]){let{structures:t,stageStructures:d}=vI({withStageGrouping:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:u,stage:o});if(t&&l.push(...t),d)for(let e of Object.keys(d))s[e]||(s[e]=[]),s[e].push(...d[e])}return{structures:l,stageStructures:s}}function II(e){if(null==e||!e.drawDefinition)return!1;let t=$h(e),i=null==t?void 0:t.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=t||{};return i&&(n=null==n?void 0:n.filter((({matchUpType:e})=>e===Fe)),r=null==r?void 0:r.filter((({matchUpType:e})=>e===Fe)),a=null==a?void 0:a.filter((({matchUpType:e})=>e===Fe))),!(null==n||!n.length||null!=r&&r.length||null!=a&&a.length)}function UI(e){var t,i;let{drawDefinition:n,structureId:r}=e;if(!n)return{error:$t};let{playoffStructures:a}=hI({drawDefinition:n,structureId:r});if(null==a||!a.length)return!1;let o=(null==(i=null==(t=null==n?void 0:n.entries)?void 0:t.filter((e=>(null==e?void 0:e.entryStatus)&&zm.includes(e.entryStatus))))?void 0:i.length)??0,s=0;return(a||[]).reduce(((e,t)=>{var i;return!(null==(i=Kc({structure:t}).positionAssignments??[])||!i.filter((e=>(e.participantId&&s++,(null==e?void 0:e.bye)??(null==e?void 0:e.participantId)))).length||!e)}),!!a.length)||s===o}function yI({significantCharacters:e,accessors:t=[],value:i}){let n=[],r=t[0];if(null!=i&&i[r]){let a=t.slice(1);if(Array.isArray(i[r]))i[r].forEach((t=>{let i=yI({accessors:a,significantCharacters:e,value:t});n.push(...i)}));else if(i=i[r],a.length){let t=yI({accessors:a,significantCharacters:e,value:i});n.push(...t)}else!function({value:t}){if(t&&["string","number"].includes(typeof t)){let i=e?t.slice(0,e):t;n.push(i)}}({value:i})}return n}function SI({policyAttributes:e,idCollections:t,participants:i,participant:n}){if(!Array.isArray(e))return{error:tn};if(!n)return{error:kn};let r=[];return e.forEach((e=>{let{directive:a,groupings:o,key:s,significantCharacters:l}=e||{};if(s){let e=s.split(".");r.push(...yI({significantCharacters:l,value:n,accessors:e}))}else if(a){let o=null==e?void 0:e.includeIds,s=((null==t?void 0:t[a])||[]).filter((e=>!o||o.includes(e)));null!=s&&s.length&&null!=i&&i.length&&s.forEach((e=>{var t;let a=i.find((t=>t.participantId===e));if(null!=(t=null==a?void 0:a.individualParticipantIds)&&t.includes(n.participantId)){let e=null==a?void 0:a.participantId;r.push(e)}}))}else o&&Object.keys(o).forEach((e=>{o[e].includes(n.participantId)&&r.push(e)}))})),{values:Qe(r)}}function wI({candidatePositionAssignments:e,participantsWithGroupings:t,policyAttributes:i,idCollections:n}){let r=Object.assign({},...t.map((e=>({[e.participantId]:e}))));return e.map((e=>{let a=r[e.participantId],{values:o}=SI({participants:t,policyAttributes:i,idCollections:n,participant:a});return{...e,values:o}}))}function PI({participantIdGroups:e,positionAssignments:t,groupsToAvoid:i}){return Object.assign({},...t.filter((e=>null==e?void 0:e.participantId)).map((t=>{let{drawPosition:n,participantId:r}=t,a=e&&e[r]||[],o=!!i.some((e=>a.includes(e)));return{[n]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function DI(e){let{unfilledPositions:t,chunkedDrawPositions:i}=e,n=PI(e);return i.map((e=>{let i=t.filter((t=>e.includes(t))),r=function(e){return e.filter((e=>!t(e)));function t(t){let i=TI(t);return!e.includes(i)}}(i),a=i.filter((e=>!r.includes(e))).filter((e=>{var t;let i=TI(e);return!(null!=(t=n[i])&&t.includesGroupsToAvoid)}));return{unassigned:i,unpaired:r,pairedNoConflict:a}}))}function TI(e){return Number(e%2?e+1:e-1)}function bI({selectedParticipantGroups:e,participantIdGroups:t,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let o=n.map((n=>a?function(e){let{unfilledPositions:t,chunkedDrawPositions:i}=e,n=PI(e);return i.map((e=>{let i=t.filter((t=>e.includes(t))),r=i.length===e.length?i:[],a=e.filter((e=>{var t;return null==(t=n[e])?void 0:t.includesGroupsToAvoid})).length;return{unassigned:i,unpaired:r,pairedNoConflict:a?[]:i,conflictsCount:a}}))}({groupsToAvoid:e,chunkedDrawPositions:n,participantIdGroups:t,positionAssignments:i,unfilledPositions:r}):DI({groupsToAvoid:e,chunkedDrawPositions:n,participantIdGroups:t,positionAssignments:i,unfilledPositions:r})));if(a){return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)).sort(((e,t)=>(t.length||0)-(e.length||0))),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)).sort(((e,t)=>(t.length||0)-(e.length||0)))}}return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length))}}function RI({positionAssignments:e,participantIds:t}){let i=e.map((e=>e.participantId));return t.filter((e=>!i.includes(e)))}function NI({candidatePositionAssignments:e,unseededParticipantIds:t,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){let l,u=r.reduce(((e,t)=>t.length>e?t.length:e),0)<=2,d=RI({positionAssignments:e,participantIds:t}),c=function({drawPositionGroups:e,positionAssignments:t}){let i=Object.assign({},...t.map((e=>({[e.drawPosition]:e}))));return e.map((e=>e.filter(Boolean).map((e=>i[e])).filter(Boolean).filter((e=>!e.participantId&&!e.bye)).map((e=>e.drawPosition)))).flat().filter(Boolean)}({positionAssignments:e,drawPositionGroups:r}),{participantId:p,groupKey:m}=function({useSpecifiedGroupKey:e=!1,targetParticipantIds:t,largestFirst:i=!0,allGroups:n,groupKey:r}){var a;let o=Object.assign({},...Object.keys(n).map((e=>[e,n[e].filter((e=>t.includes(e)))])).filter((e=>e[1].length)).map((([e,t])=>({[e]:t})))),s=Object.keys(o).reduce(((e,t)=>o[t].length>e?o[t].length:e),0),l=Object.keys(o).filter((e=>o[e].length===s)),u=st(i?l:Object.keys(o));return{participantId:(r=e&&null!=(a=o[r])&&a.length?r:u)&&o[r]?st(o[r]):st(t),groupKey:r}}({targetParticipantIds:d,useSpecifiedGroupKey:u,allGroups:o,groupKey:s}),f=function({allGroups:e,participantId:t}){return Object.keys(e).filter((i=>e[i].includes(t)))}({participantId:p,allGroups:o}),h=bI({positionAssignments:e,isRoundRobin:u,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:c}),{unassigned:v,unpaired:g,pairedNoConflict:I}=h,U=(null==I?void 0:I.length)&&I[0],y=(null==g?void 0:g.length)&&g[0],S=a&&U?U:y,w=a?y:U,P=(null==S?void 0:S.length)&&S||(null==w?void 0:w.length)&&w;if(null!=P&&P.length){let e=ot(P);l=ot(e)}else{let e=ot(v[0]);l=ot(e)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:l}}function MI({isRoundRobin:e,groupedParticipants:t}){let i=[];return e?t.forEach((e=>{let t=Mg({drawPositions:e.map((e=>e.drawPosition))}).uniqueMatchUpGroupings??[],n=Object.assign({},...e.map((e=>({[e.drawPosition]:e}))));t.forEach((t=>{pt(n[t[0]].values||[],n[t[1]].values||[])&&(i.push(t),e.conflict=!0)}))})):t.forEach((e=>{var t,n;pt((null==(t=e[0])?void 0:t.values)||[],(null==(n=e[1])?void 0:n.values)||[])&&(i.push(e),e.conflict=!0)})),i}function AI({positionedParticipants:e,potentialDrawPositions:t,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map((n=>{let a=n.map((e=>e.drawPosition));return n.filter((e=>t.includes(e.drawPosition))).map((n=>{let o=t.filter((e=>!(null!=a&&a.includes(e)))).filter((t=>{let a=i.find((e=>e.includes(t))).find((e=>e!==t)),o=e.find((e=>e.drawPosition===a)),s=MI({isRoundRobin:r,groupedParticipants:[[n,o]]}),l=[e.find((e=>e.drawPosition===t)),o],u=MI({isRoundRobin:r,groupedParticipants:[l]});return!s.length&&!u.length}));if(o.length)return{drawPosition:n.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function EI(e){let t,{initialPositionAssignments:i,participantsWithGroupings:n,opponentsToPlaceCount:r,unseededByePositions:a,drawPositionGroups:o,policyAttributes:s,idCollections:l,allGroups:u}=e,d=[],c=Math.min(...(o||[]).map((e=>null==e?void 0:e.length)).filter(Boolean)),p=c>2,m=ts(i,!1,!0).filter((e=>!e.qualifier)),f=i.filter((e=>!e.participantId&&(!e.bye||(null==a?void 0:a.includes(e.drawPosition))))).map((e=>e.drawPosition));lt(0,r).forEach((()=>{let{newGroupKey:i,selectedParticipantId:n,targetDrawPosition:r}=NI({...e,candidatePositionAssignments:m,allGroups:u,groupKey:t});t=i,m.forEach((e=>{e.drawPosition===r&&(e.participantId=n)}))}));let h=wI({candidatePositionAssignments:m,participantsWithGroupings:n,policyAttributes:s,idCollections:l}),v=ht(h,c),g=MI({groupedParticipants:v,isRoundRobin:p}),I=0;for(;I<20&&g.length;){let e=AI({positionedParticipants:h,potentialDrawPositions:f,avoidanceConflicts:g,drawPositionGroups:o,isRoundRobin:p});if(e.length){let t=CI({candidatePositionAssignments:m,swapOptions:e});t.error&&console.log({result:t}),h=wI({candidatePositionAssignments:m,participantsWithGroupings:n,policyAttributes:s,idCollections:l}),v=ht(h,c),g=MI({groupedParticipants:v,isRoundRobin:p}),I++}else I=20}return m.forEach((e=>{if(e.bye&&e.participantId){let e=fi;d.push(e)}if(e.qualifier&&e.participantId){let e=fi;d.push(e)}})),{positionAssignments:m,conflicts:g.length,groupedParticipants:v,errors:d}}function CI({candidatePositionAssignments:e,swapOptions:t}){let i=ot(t);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=ot(i.possibleDrawPositions),a=e.find((e=>e.drawPosition===n)),o=e.find((e=>e.drawPosition===r))??{},s={participantId:null==o?void 0:o.participantId,qualifier:null==o?void 0:o.qualifier,bye:null==o?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...At}}function OI({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:d,drawSize:c,event:p}){var m;if(!d)return{error:en};let{candidatesCount:f=1,policyAttributes:h,targetDivisions:v}=d,{roundsToSeparate:g}=d,I="randomUnseededSeparation",{structure:U}=Hc({drawDefinition:a,structureId:u}),{matchUps:y}=jh({provisionalPositioning:e,matchUpsMap:l,structure:U,event:p});if(v&&Ve(v)&&!g){let e=function(e){if(!Ve(e))return!1;let t=e,i=1;for(;2!==t;)i+=1,t/=2;return i}(v)||0,t=y.reduce(((e,t)=>t.roundNumber>e?t.roundNumber:e),0);g=t<e?1:t-e+1}let{positionAssignments:S}=Jc({structure:U}),w=Xp({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,P=null==S?void 0:S.filter((e=>!e.participantId)),D=null==S?void 0:S.map((e=>e.drawPosition)),T=(null==U?void 0:U.structureType)===vl,b=T?{structure:U,matchUps:y,allDrawPositions:D,roundsToSeparate:g}:{matchUps:y,allDrawPositions:D,roundsToSeparate:g},{drawPositionGroups:R,drawPositionChunks:N}=T?function(e){let{structure:{structures:t}}=e,i=t.map((e=>e.positionAssignments.map((e=>e.drawPosition))));return{drawPositionGroups:i,drawPositionChunks:[i]}}(b):function({allDrawPositions:e,roundsToSeparate:t,matchUps:i}){let n=i.filter((e=>1===e.roundNumber)).map((e=>e.drawPositions)),r=n.flat().sort(Le),a=Math.max(...r),o=e.filter((e=>e>a)),s=r.length,l=lt(2===s?1:2,s).filter((e=>e===$e(e))),u=l.slice(0,t||l.length).reverse().map((e=>ht(r,e)));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:u}}(b),M={groupParticipants:s.filter((e=>e.participantType===Yp)).map((e=>e.participantId)),teamParticipants:s.filter((e=>e.participantType===Jp)).map((e=>e.participantId)),pairParticipants:s.filter((e=>e.participantType===Kp)).map((e=>e.participantId))},A=function({targetParticipantIds:e,policyAttributes:t,idCollections:i,participants:n}){if(!Array.isArray(t))return{error:tn};if(!Array.isArray(n))return{error:Fn};let r={};return e.forEach((e=>{let a=n.find((t=>t.participantId===e)),{values:o}=SI({policyAttributes:t,idCollections:i,participants:n,participant:a});o&&o.forEach((t=>{r[t]||(r[t]=[]),r[t].includes(e)||r[t].push(e)}))})),r}({targetParticipantIds:t,policyAttributes:h,idCollections:M,participants:s});if(A.error)return La({result:A,stack:I});let E=Object.assign({},...t.map((e=>{let t=Object.keys(A).filter((t=>(A[t]??[]).includes(e)));return{[e]:t}}))),C=RI({participantIds:t,positionAssignments:S});if(C.length>((null==P?void 0:P.length)||0))return{error:tr};let O,k=C.length,F=lt(0,f).map((()=>EI({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:t,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:n,participantIdGroups:E,drawPositionChunks:N,drawPositionGroups:R,policyAttributes:h,idCollections:M,allGroups:A,drawSize:c})));if(O=F.reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0),!O||O.conflicts){let e=lt(0,f).map((()=>EI({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:t,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:n,participantIdGroups:E,drawPositionChunks:N,drawPositionGroups:R,policyAttributes:h,idCollections:M,allGroups:A,drawSize:c})));O=F.concat(...e).filter((e=>{var t;return!(null!=(t=e.errors)&&t.length)})).reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0)}if(!O)return{error:br};let x=((null==(m=Kc({structure:U}))?void 0:m.positionAssignments)??[]).filter((e=>e.participantId)).map((e=>e.participantId)),_=O.positionAssignments.filter((e=>!x.includes(e.participantId)));for(let L of _)if(L.bye){let e=yv({tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,...L});if(e.error)return La({result:e,stack:I})}else if(L.participantId){let e=rI({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,...L});if(e.error)return La({result:e,stack:I,context:{assignment:L}})}return{...At}}function kI({provisionalPositioning:e,inContextDrawMatchUps:t,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:d,drawSize:c,event:p}){var m,f;d||({structure:d}=Hc({drawDefinition:a,structureId:u})),u||({structureId:u}=d);let{positionAssignments:h}=Jc({structure:d}),{seedAssignments:v}=Xm({provisionalPositioning:e,drawDefinition:a,structure:d}),g=null==v?void 0:v.map((e=>e.participantId)).filter(Boolean),{stage:I,stageSequence:U}=d,y=I===nl?null==(f=null==(m=Cd({element:d,name:Jd}))?void 0:m.extension)?void 0:f.value:void 0,S=Zm({provisionalPositioning:e,drawDefinition:a,stageSequence:U,entryStatuses:Hm,structureId:u,roundTarget:y,stage:I}),w=S.filter((e=>!(null!=g&&g.includes(e.participantId)))).map((e=>e.participantId)),P=null==h?void 0:h.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));if(!n&&w.length>((null==P?void 0:P.length)||0))return La({result:{error:tr},context:{unseededParticipantsCount:w.length,unfilledDrawPositionsCount:null==P?void 0:P.length},stack:"positionUnseededParticipants"});let{appliedPolicies:D}=gm({tournamentRecord:r,drawDefinition:a,event:p}),T=null==D?void 0:D[dd];if(d.stage===ol){let e=S.reduce(((e,t)=>(e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e)),{});Object.keys(e).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:e}))}return T&&s?OI({provisionalPositioning:e,unseededParticipantIds:w,inContextDrawMatchUps:t,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:T,drawSize:c,entries:S}):function({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:d,event:c}){let p=d>2?Xe(n):n.reverse();for(let m of t){let t=p.pop();if(!r||t){let n=rI({provisionalPositioning:e,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:t,matchUpsMap:l,structureId:u,event:c});if(null!=n&&n.error&&console.log("!!!!!",{result:n}),null==n?void 0:n.error)return La({result:n,stack:"randomUnseededDistribution"})}}return{...At}}({provisionalPositioning:e,unseededParticipantIds:w,inContextDrawMatchUps:t,unfilledDrawPositions:P,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:c,event:p})}function FI(e){let t=e.structure??Hc(e).structure,i="positionQualifiers",n=[];if(t.stage===rl)return La({result:{error:Oi},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:o}=function({drawDefinition:e,structure:t,structureId:i}){t||({structure:t}=Hc({drawDefinition:e,structureId:i})),i||({structureId:i}=t);let{positionAssignments:n}=Jc({structure:t}),{stage:r,stageSequence:a}=t,{qualifiersCount:o,roundQualifiersCounts:s}=Kv({drawDefinition:e,stageSequence:a,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map((e=>Be(e))),{matchUps:u}=jh({structure:t}),{roundProfile:d}=uf({matchUps:u}),c=Object.assign({},...l.filter((e=>null==d?void 0:d[e])).map((e=>{var t,i;return{[e]:(null==(i=null==(t=null==d?void 0:d[e])?void 0:t.drawPositions)?void 0:i.filter(Boolean))??[]}}))),p=null==n?void 0:n.filter((e=>e.qualifier)).map((e=>e.drawPosition)),m=o-((null==p?void 0:p.length)??0),f=null==p?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map((e=>{let t=null==n?void 0:n.filter((t=>{var i,n;return t.qualifier&&(null==(n=null==(i=c[e])?void 0:i.drawPositions)?void 0:n.includes(t.drawPosition))})).map((e=>e.drawPosition));return{[e]:((null==s?void 0:s[e])??0)-((null==t?void 0:t.length)??0)}}))),unplacedQualifiersCount:m,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:c,qualifiersCount:o}}(e);for(let s of Object.keys(r)){let e=null==a?void 0:a.filter((e=>o[s].includes(e.drawPosition)&&!e.participantId&&!e.qualifier&&!e.bye)).map((e=>e.drawPosition));if(r[s]>(e||0))return La({result:{error:er},context:{unfilledDrawPositions:e},stack:i});lt(0,r[s]).forEach((()=>{let t=ot(e);n.push(t),null==a||a.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)}))}))}return{...At,qualifierDrawPositions:n}}function xI({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:d,matchUpsMap:c,structure:p,event:m}){let f=[],h=[],v=0;if(p||({structure:p}=Hc({drawDefinition:a,structureId:d})),d||(d=null==p?void 0:p.structureId),n||(n=gm({drawDefinition:a}).appliedPolicies),!r){let t=p&&Vg({provisionalPositioning:e,appliedPolicies:n,drawDefinition:a,seedingProfile:o,structure:p});null!=t&&t.error&&h.push(t.error),r=null==t?void 0:t.validSeedBlocks}return lt(0,u=u??(null==r?void 0:r.length)??0).forEach((()=>{if(v<(u||0)){let n=function({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:d,unfilledPositions:c}=$g({provisionalPositioning:e,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=gm({drawDefinition:n}),{avoidance:m}=p??{};m&&o&&(null==d||d.length);let f=[];for(let h of d){let o=c.pop();if(!o)return{error:ni};f.push(o);let d=rI({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:h,seedBlockInfo:a,drawPosition:o,matchUpsMap:l,structureId:s,event:u});if(!d.success)return d}return{...At,seedPositions:f}}({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:d,matchUpsMap:c,event:m});null!=n&&n.success&&(v++,f.push(...n.seedPositions??[])),n.error&&h.push({seedPositionError:n.error})}})),h.length?{error:h}:{...At,seedPositions:f}}function _I({orderedSortedFirstRoundSeededDrawPositions:e,validSeedBlocks:t,byesToPlace:i}){let n=[];t.forEach((t=>{if(i-n.length>t.drawPositions.length)n.push(...t.drawPositions);else{let i,r=BI(ht(t.drawPositions,2)),a=e[n.length];for(;i=LI(r,a);)n.push(i),a=e[n.length]}}));let r=n.map((e=>Array.isArray(e)?Xe(e):e)).flat(1/0);return We(i)&&t.map((e=>e.seedNumbers[0])).includes(i)?e:r}function LI(e,t){if(Array.isArray(e)&&2!==e.length)return e.pop();if(!Array.isArray(e[0]))return e.includes(t)?e.indexOf(t)?e.pop():e.shift():Math.round(Math.random())?e.pop():e.shift();let i=e[0].flat(1/0).length,n=e[1].flat(1/0).length;if(i===n){let i=e[0].flat(1/0).includes(t)?e[0]:e[1];return LI(t?i:e[Math.round(Math.random())],t)}return LI(i<n?e[1]:e[0],t)}function BI(e){let t=Math.floor(e.length/2);return e.length>2?[BI(e.slice(0,t)),BI(e.slice(t))]:e}function VI({provisionalPositioning:e,relevantMatchUps:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=Vg({provisionalPositioning:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:u,isLuckyStructure:d,isContainer:c}=a,{validSeedBlocks:p}=a;null!=(l=null==i?void 0:i.seeding)&&l.containerByesIgnoreSeeding&&(p=[]);let m=function({provisionalPositioning:e,drawDefinition:t,structure:i}){let{positionAssignments:n}=Jc({structure:i}),{seedAssignments:r}=Xm({provisionalPositioning:e,drawDefinition:t,structure:i}),a=Object.assign({},...(r||[]).filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))));return null==n?void 0:n.map((e=>a[e.participantId]?{...e,seedNumber:a[e.participantId].seedNumber,seedValue:a[e.participantId].seedValue}:"")).filter(Boolean)}({provisionalPositioning:e,drawDefinition:n,structure:s})??[],f=Qe([].concat(...t.map((e=>e.drawPositions)))),h=m.filter((e=>f.includes(e.drawPosition))),v=(e,t)=>Lg(e.seedValue)-Lg(t.seedValue),g=p.reduce(((e,t)=>{let i=h.filter((e=>{var i;return null==(i=t.drawPositions)?void 0:i.includes(e.drawPosition)})).sort(v);return e.concat(...i)}),[]).map((e=>e.drawPosition)),I=_I({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:p,byesToPlace:o});return{strictSeedOrderByePositions:jI({orderedSeedDrawPositions:g,relevantMatchUps:t}).slice(0,o),blockSeedOrderByePositions:jI({orderedSeedDrawPositions:I,relevantMatchUps:t}).slice(0,o),isLuckyStructure:d,positionedSeeds:m,isContainer:c,isFeedIn:u}}function jI({orderedSeedDrawPositions:e,relevantMatchUps:t}){let i=t.map((e=>e.drawPositions)).map((e=>null==e?void 0:e.sort(((e,t)=>e-t)))).filter((e=>(null==e?void 0:e[0])+1===(null==e?void 0:e[1])));return e.map((e=>i.find((t=>null==t?void 0:t.includes(e))))).filter(Boolean).map((t=>null==t?void 0:t.reduce(((t,i)=>e.includes(i)?t:i),void 0))).filter(Boolean)}function GI({provisionalPositioning:e,tournamentRecord:t,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:d,event:c}){var p;l||({structure:l}=Hc({drawDefinition:n,structureId:s})),s||(s=null==l?void 0:l.structureId);let m=!((null==l?void 0:l.structures)??(null==l?void 0:l.stage)===nl),{byesCount:f,placedByes:h,relevantMatchUps:v}=function({provisionalPositioning:e,drawDefinition:t,matchUpsMap:i,structure:n,event:r}){var a;let{matchUps:o,roundMatchUps:s}=jh({afterRecoveryTimes:!1,provisionalPositioning:e,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:n,event:r}),l=(null==s?void 0:s[1])||[],u=(null==n?void 0:n.structureType)===vl,d=u?o:l,c=u?(null==(a=null==n?void 0:n.structures)?void 0:a.length)||0:o.length,{structureId:p,stage:m,stageSequence:f}=n,h=Zm({entryStatuses:zm,provisionalPositioning:e,drawDefinition:t,stageSequence:f,structureId:p,stage:m}),{qualifiersCount:v}=Kv({provisionalPositioning:e,drawDefinition:t,stageSequence:f,structureId:p,stage:m}),g=h.length+v,{positionAssignments:I,unassignedPositions:U}=Jc({structure:n}),y=null==U?void 0:U.map((e=>e.drawPosition)),S=null==I?void 0:I.filter((e=>e.bye)).length,w=null==I?void 0:I.filter((e=>e.bye)).map((e=>e.drawPosition)),P=d.map((e=>e.drawPositions)).filter((e=>null==e?void 0:e.reduce(((e,t)=>!(null!=w&&w.includes(t))&&e),!0))).flat(1/0).filter((e=>null==y?void 0:y.includes(e))),D=null==I?void 0:I.length,T=D?D-g:0;return T>c&&1===n.stageSequence&&n.stage!==rl&&(T=c),{placedByes:S,byesCount:T,relevantMatchUps:d,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:P}}({provisionalPositioning:e,drawDefinition:n,matchUpsMap:o,structure:l,event:c}),g=f-(h||0);if(g<=0)return{...At};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:U,isLuckyStructure:y,isFeedIn:S}=VI({provisionalPositioning:e,relevantMatchUps:v,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:g,structure:l}),w=(null==l?void 0:l.structureType)&&[vl,hl].includes(l.structureType)&&(null==(p=null==i?void 0:i.seeding)?void 0:p.containerByesIgnoreSeeding),P=m&&null!=U&&U.length?U:I,{unseededByePositions:D}=function({provisionalPositioning:e,seedOrderByePositions:t,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:o,isFeedIn:s}){var l,u;let d,c=null==(l=null==n?void 0:n.seeding)?void 0:l.seedingProfile,p=o.stage===nl,{positionAssignments:m}=Jc({structure:o}),f=null==m?void 0:m.filter((e=>e.participantId)).map((e=>e.drawPosition)),{matchUps:h,roundMatchUps:v}=jh({provisionalPositioning:e,matchUpFilters:{isCollectionMatchUp:!1},structure:o}),g=(null==v?void 0:v[1])||[],I=o.structureType===vl?h:g,U=Qe([].concat(...I.map((e=>e.drawPositions)))),y=Math.min(...U)-1,S=null==f?void 0:f.filter((e=>U.includes(e))),w=e=>{let t=Math.ceil(e.length/2),i=[e.slice(0,t),e.slice(t)],n=i.map((e=>[].concat(...e.flat(1/0)).length)),r=Math.min(...n.flat(1/0)),a=Math.max(...n.flat(1/0)),o=n.indexOf(a),s=r!==a,l=Xe(i),[u,d]=!r||s?[i[o],i[1-o]]:[l[0],l[1]];return{greaterHalf:u,lesserHalf:d}},P=e=>{let{greaterHalf:t,lesserHalf:i}=w(e),{greaterHalf:n,lesserHalf:r}=w(t),a=Xe(n.flat(1/0)).pop();return{newlyFilteredChunks:[...i,...r,n.flat().filter((e=>e!==a))],drawPosition:a}},D=e=>!(null!=S&&S.includes(e)),T=e=>{let t=ht(e.sort(Le),Math.ceil(e.length/4)).map((e=>e.filter(D))),i=[].concat(...t.flat(1/0)).length,n=[];for(let r=0;r<i;r++){let{newlyFilteredChunks:e,drawPosition:i}=P(t);n.push(i),t=e}return n},{validSeedBlocks:b}=Vg({provisionalPositioning:e,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:o}),R=null==b?void 0:b.map((e=>{var t;return null==(t=e.drawPositions)?void 0:t.map((e=>e+y))}));if(s){let e=U.length,{seedBlocks:t}=Fg({cluster:qg(c)===ml,participantsCount:e});d=t.map((e=>e.map((e=>e+y)))).map(T).filter((e=>e.length))}else d=p?null==R?void 0:R.map((e=>e.filter(D))):null==R?void 0:R.map(T).filter((e=>e.length));let N=I.map((e=>e.drawPositions)).map((e=>null==e?void 0:e.sort(((e,t)=>e-t)))).filter((e=>(null==e?void 0:e[0])+1===(null==e?void 0:e[1]))),M=e=>N.reduce(((t,i)=>i.includes(e)?i.reduce(((t,i)=>i!==e?i:t),void 0):t),void 0),A=d.map((e=>e.map(M))).flat(1/0).filter(D).filter((e=>!t.includes(e))).filter(Boolean);if(p&&!o.structures){let e=a%4,t=A.slice(0,e),i=null==(u=v[o.roundLimit])?void 0:u.length,n=ht(A.slice(e),i).map(Xe).flat();A=t.concat(n)}return{unseededByePositions:A}}({provisionalPositioning:e,seedOrderByePositions:P,isLuckyStructure:y,appliedPolicies:i,drawDefinition:n,seedLimit:u,structure:l,isFeedIn:S}),T=(e,t)=>(e||[]).every((e=>(e=>e%2)(e)?t!==e+1:t!==e-1)),b=[].concat(...P);if(!d)for(;D.length;){let e=D.find((e=>T(b,e)));e?(b.push(e),D=D.filter((t=>t!==e))):(b.push(...D),D=[])}w&&(b=Xe(b),aa({ignoreSeededByes:w})&&console.log({byePositions:b}));let R=b.slice(0,g);for(let N of R){let i=yv({provisionalPositioning:e,tournamentRecord:t,drawDefinition:n,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:c});if(null!=i&&i.error)return i}return{...At,unseededByePositions:D,byeDrawPositions:R}}function $I(e){var t,i,n,r;let{drawDefinition:a}=e,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:u=!0,tournamentRecord:d,placementGroup:c,seedingProfile:p,structureId:m,seedLimit:f,seedsOnly:h,drawType:v,drawSize:g,event:I}=e,U=[];o||(ua(),a=ts(a,!1,!0));let y=e=>(o||da(),La({result:e,stack:"automatedPositioning"})),S=Hc({drawDefinition:a,structureId:m});if(S.error)return y(S);let w=S.structure;if(!w)return{error:Si};let P=e.appliedPolicies||(null==(t=gm({drawDefinition:a,structure:w,event:I}))?void 0:t.appliedPolicies),{qualifiersCount:D}=Kv({stageSequence:w.stageSequence,provisionalPositioning:s,stage:w.stage,drawDefinition:a,structureId:m}),T=Hm;if(!(null!=(i=Zm({stageSequence:w.stageSequence,provisionalPositioning:s,stage:w.stage,placementGroup:c,drawDefinition:a,entryStatuses:T,structureId:m}))&&i.length||D))return b={...At},o||da(),b;var b;let R=e.matchUpsMap??rf({drawDefinition:a}),N=e.inContextDrawMatchUps??(null==(n=Qh({inContext:!0,drawDefinition:a,matchUpsMap:R}))?void 0:n.matchUps),M=[],A=Vg({provisionalPositioning:s,appliedPolicies:P,drawDefinition:a,seedingProfile:p,structure:w});if(A.error)return A;let{validSeedBlocks:E}=A;U.push({validSeedBlocks:E});let C=e.participants||(d?null==(r=zv({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:d}))?void 0:r.participants:[]);if(qg(w.seedingProfile||p)===fl){let e=u?GI({provisionalPositioning:s,tournamentRecord:d,appliedPolicies:P,drawDefinition:a,seedBlockInfo:A,matchUpsMap:R,structure:w,seedLimit:f,seedsOnly:h,event:I}):void 0;if(null!=e&&e.error)return y(e);if(M=e.unseededByePositions,U.push({action:"positionByes",unseededByePositions:M}),e=xI({seedingProfile:w.seedingProfile?{positioning:w.seedingProfile}:p,provisionalPositioning:s,inContextDrawMatchUps:N,tournamentRecord:d,appliedPolicies:P,validSeedBlocks:E,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:R,structure:w,event:I}),e.error)return y(e);U.push({seedPositions:e.seedPositions,action:"positionSeedBlocks"})}else{if(v!==Ol){let e=xI({seedingProfile:w.seedingProfile?{positioning:w.seedingProfile}:p,provisionalPositioning:s,inContextDrawMatchUps:N,tournamentRecord:d,appliedPolicies:P,validSeedBlocks:E,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:R,structure:w,event:I});if(e.error)return y(e);U.push({action:"positionSeedBlocks",seedPositions:e.seedPositions})}let e=u?GI({provisionalPositioning:s,tournamentRecord:d,appliedPolicies:P,drawDefinition:a,seedBlockInfo:A,matchUpsMap:R,structure:w,seedLimit:f,seedsOnly:h,event:I}):void 0;if(null!=e&&e.error)return y(e);M=null==e?void 0:e.unseededByePositions,U.push({action:"positionByes",byeDrawPositions:null==e?void 0:e.byeDrawPositions,unseededByePositions:M})}let O={};if(!h){let e=FI({inContextDrawMatchUps:N,tournamentRecord:d,appliedPolicies:P,validSeedBlocks:E,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:R,structure:w});if(e.error||(e.conflicts&&(O.qualifierConflicts=e.conflicts),U.push({action:"positionQualifiers",qualifierDrawPositions:e.qualifierDrawPositions}),e=kI({provisionalPositioning:s,inContextDrawMatchUps:N,unseededByePositions:M,multipleStructures:l,tournamentRecord:d,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:R,structureId:m,structure:w,drawSize:g,event:I}),e.error))return y(e);e.conflicts&&(O.unseededConflicts=e.conflicts),U.push({action:"positionUnseededParticipants"})}let{positionAssignments:k}=Kc({drawDefinition:a,structure:w});return kp({drawDefinition:a,structureIds:[m]}),o||da(),{positionAssignments:k,conflicts:O,...At,positioningReport:U}}function qI(e){var t;let{applyPositioning:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:u}=e;if(!a)return{error:Wt};if(!II({drawDefinition:a,structureId:s})&&!n)return{error:zt};let d=null==(t=hI({drawDefinition:a,structureId:s}).playoffStructures)?void 0:t.sort(((e,t)=>Wc(e)-Wc(t))),c=[],p=[];if(d)for(let m of d){let{structureId:e}=m,t=$I({structureId:e,provisionalPositioning:n,applyPositioning:i,tournamentRecord:r,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:u});if(t.error)return t;t.positionAssignments&&c.push({positionAssignments:t.positionAssignments,structureId:e}),t.positioningReport&&p.push(t.positioningReport)}return{...At,structurePositionAssignments:c,positioningReports:p}}function WI({drawDefinition:e,orderMap:t}){return e?(("object"!=typeof t||!Object.values(t).every((e=>Ye(e))))&&La({result:{error:Cr},context:{orderMap:t}}),e.structures||(e.structures=[]),e.structures.forEach((e=>{let i=t[e.structureId];i&&(e.structureOrder=i)})),e.structures.sort(((e,t)=>et(e.structureOrder)-et(t.structureOrder))),{...At}):{error:$t}}function HI({drawDefinition:e}){var t,i,n,r,a,o,s;let l=e.structures??[],u=e.links??[],d=new Map,c=e=>{let t=d.get(e)||d.set(e,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&d.get(e);if(t&&(null==t||!t.stage)){let i=l.find((t=>t.structureId===e));t.stage=null==i?void 0:i.stage}return t},p={},m={},f=u.map((e=>{let t=e.source.structureId,i=e.target.structureId,n=c(t),r=c(i);return[yl,Ul,Il,fl].includes(e.target.feedProfile)?(null==n||n.targets.push(i),null==r||r.sources.push(t)):e.target.feedProfile===gl&&(null==r||r.drawSources.push(t),null==n||n.drawTargets.push(i)),m[i]=m[i]||e.target.feedProfile===gl,p[i]=Qe([...p[i]||[],t]).filter(Boolean),[e.source.structureId,e.target.structureId]}));for(let w of d.keys()){let e=d.get(w);if(e){let o=e.targets??[];for(;o.length;){let i=o.pop(),n=i&&d[i];null!=(t=null==n?void 0:n.targets)&&t.length?o.push(...n.targets):n&&(e.rootStage=n.stage)}if(e.rootStage||(e.rootStage=e.stage),null==(i=e.targets)||!i.length){let t=e.sources??[];for(;t.length;){let i=t.pop(),o=i&&d[i];if(null!=(n=null==o?void 0:o.sources)&&n.length){for(let t of o.sources)null!=(r=e.progeny)&&r.includes(t)||null==(a=e.progeny)||a.push(t);t.push(...o.sources)}}}}}let h=0;for(let w of d.keys()){let e=d.get(w);if(e&&e.rootStage===nl){let t=[null==(o=e.drawTargets)?void 0:o[0]],i=0;for(;t.length;){i+=1;let e=t.pop(),n=e?d.get(e):void 0;null!=(s=null==n?void 0:n.drawTargets)&&s.length&&t.push(n.drawTargets[0])}e.distanceFromMain=i,i>h&&(h=i)}}let v=f.length;lt(0,Math.ceil(v/2)).forEach((()=>{f=lt(0,v).map((e=>{let t=f[e],i=f.reduce(((e,i)=>pt(t,i)?e.concat(...i):e),[])||[];return Qe(t.concat(...i))}))}));let g=f[0],I=f.slice(1).reduce(((e,t)=>e&&((e,t)=>dt(e,t).length===e.length)(t,g)),!0),U=[g].filter(Boolean),y=[g].filter(Boolean);l.forEach((e=>{let{structureId:t,stage:i}=e;U.find((e=>e.includes(t)))||(U.push([t]),i!==al&&y.push([t]))}));let S=I&&1===y.length;return!(null!=u&&u.length)&&1===l.length&&c(l[0].structureId),{structureProfiles:Object.fromEntries(d),allStructuresLinked:S,maxQualifyingDepth:h,sourceStructureIds:p,hasDrawFeedProfile:m,structureGroups:U}}function zI({drawDefinition:e}){let{maxQualifyingDepth:t,structureProfiles:i}=HI({drawDefinition:e});for(let n of e.structures){let e=i[n.structureId];e.distanceFromMain&&(n.stageSequence=t+1-e.distanceFromMain)}return{...At}}function YI(e){let t=qu(e,[{[au]:!0,[su]:!0}]);if(t.error)return t;let{tournamentRecord:i,drawDefinition:n,structure:r,link:a}=e;return function(e){var t;let i=qu(e,[{[su]:!0,[Su]:!0},{link:!0,[Lu]:Ou,[Et]:Ii}]);if(i.error)return i;let{drawDefinition:n,tournamentId:r,structure:a,eventId:o,link:s}=e,l=s.target.structureId,u=Hc({drawDefinition:n,structureId:l});if(u.error)return La({stack:"attachQualifyingStructure",context:{targetStructureId:l},result:u});n.structures||(n.structures=[]),n.links||(n.links=[]),n.structures.push(a),n.links.push(s),zI({drawDefinition:n});let d=(null==(t=jh({structure:a}))?void 0:t.matchUps)||[];return Ap({drawDefinition:n,tournamentId:r,matchUps:d,eventId:o}),kp({drawDefinition:n,structureIds:[a.structureId]}),{...At}}({tournamentId:i.tournamentId,drawDefinition:n,structure:r,link:a})}function KI({drawDefinition:e,structureDetails:t}){if(!Array.isArray(t))return{error:Cr};if(!e)return{error:$t};let i=Object.assign({},...t.map((e=>{if(!wt(e))return;let{structureId:t,structureName:i}=e||{};return t&&i?{[t]:i}:void 0})).filter(Boolean));if(!Object.values(i).length)return{error:un};for(let n of e.structures||[]){let e=i[n.structureId];if(e&&(n.structureName=e),n.structures)for(let t of n.structures){let e=i[t.structureId];e&&(t.structureName=e)}}return{...At}}function JI({drawDefinition:e,timeItem:t}){if(!e)return{error:Wt};if(!t)return{error:Ir};let i=t&&Object.keys(t),n=["itemType","itemValue"];if(n.filter((e=>i.includes(e))).length!==n.length)return{error:vr};e.timeItems||(e.timeItems=[]);let r=(new Date).toISOString();return Object.assign(t,{createdAt:r}),e.timeItems.push(t),Op({drawDefinition:e}),{...At}}function QI(e){var t;let{tournamentRecord:i,drawDefinition:n,structureId:r,event:a}=e,o=qu(e,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=n.structures??[],l=s.find((e=>e.structureId===r));if(!l)return{error:Si};let u=s.find((({stage:e,stageSequence:t})=>e===il&&1===t)),d=r===(null==u?void 0:u.structureId),c=s.filter((({stage:e})=>e===nl)).map(ov("structureId"));if(d&&!c.length)return{error:xt};let p=c.includes(r),m=function({isQualifyingStructure:e,tournamentRecord:t,drawDefinition:i,structureId:n,structure:r,event:a,force:o}){var s,l,u,d,c,p;let m=[n];if(e){let e=e=>{var t;return null==(t=i.links)?void 0:t.find((t=>t.target.structureId===e))},t=null==(s=e(n))?void 0:s.source.structureId;for(;t;)m.push(t),t=null==(l=e(t))?void 0:l.source.structureId}if(null!=(u=Qh({matchUpFilters:{structureIds:m},drawDefinition:i}).matchUps)&&u.some((({score:e})=>dv({score:e})))){let e=null==(d=gm({tournamentRecord:t,drawDefinition:i,structure:r,event:a}))?void 0:d.appliedPolicies;if(!(o??(null==(p=null==(c=null==e?void 0:e[cd])?void 0:c.allowDeletionWithScoresPresent)?void 0:p.structures)))return{error:Yr}}return{...At}}({isQualifyingStructure:p,structure:l,...e});if(null!=m&&m.error)return m;let{structureIdsToRemove:f,relatedStructureIdsMap:h}=function({qualifyingStructureIds:e,isQualifyingStructure:t,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let o=(r.structures??[]).map(ov("structureId")),s=e=>{var t;return(null==(t=r.links)?void 0:t.map((t=>t.source.structureId===e&&t.target.structureId!==(null==n?void 0:n.structureId)&&t.target.structureId)).filter(Boolean))??[]},l=t=>{var i;return(null==(i=r.links)?void 0:i.map((i=>e.includes(i.source.structureId)&&i.target.structureId===t&&i.source.structureId)).filter(Boolean))??[]},u=new Map;return o.forEach((e=>u.set(e,t?l(e):s(e)))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}({qualifyingStructureIds:c,isQualifyingStructure:p,isMainStageSequence1:d,mainStageSequence1:u,drawDefinition:n,structureId:r}),{removedMatchUpIds:v,removedStructureIds:g}=function({relatedStructureIdsMap:e,qualifyingStructureIds:t,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;null!=a&&a.length;){let u=a.pop();l.push(...eU({idBeingRemoved:u,drawDefinition:r}));let d=XI({qualifyingStructureIds:t,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:r,structureId:o});s.push(...d.removedStructureIds);let c=ZI({relatedStructureIdsMap:e,mainStageSequence1:n,idBeingRemoved:u,structureId:o});null!=c&&c.length&&a.push(...c)}return{removedMatchUpIds:l,removedStructureIds:s}}({relatedStructureIdsMap:h,qualifyingStructureIds:c,isMainStageSequence1:d,mainStageSequence1:u,drawDefinition:n,structureIdsToRemove:f,structureId:r});if(function({removedMatchUpIds:e,drawDefinition:t}){let{matchUps:i}=Qh({drawDefinition:t});null==i||i.forEach((t=>{t.winnerMatchUpId&&e.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,t.loserMatchUpId&&e.includes(t.loserMatchUpId)&&delete t.loserMatchUpId}))}({removedMatchUpIds:v,drawDefinition:n}),d){let e=null==(t=u.matchUps??[])?void 0:t.map(ov("matchUpId"));v.push(...e),u.positionAssignments=[],u.seedAssignments=[],u.matchUps=[],u.extensions&&(u.extensions=[])}return p&&zI({drawDefinition:n}),Ep({tournamentId:null==i?void 0:i.tournamentId,matchUpIds:v,action:"removeStructure",eventId:null==a?void 0:a.eventId,drawDefinition:n}),kp({drawDefinition:n,eventId:null==a?void 0:a.eventId}),{...At,removedMatchUpIds:v,removedStructureIds:g}}function ZI({idBeingRemoved:e,relatedStructureIdsMap:t,mainStageSequence1:i,structureId:n}){var r;return e&&(null==(r=t.get(e))?void 0:r.filter((e=>e!==(null==i?void 0:i.structureId)||n===i.structureId)))}function XI({qualifyingStructureIds:e,isMainStageSequence1:t,idBeingRemoved:i,drawDefinition:n,structureId:r}){var a;let o=[];return n.links=(null==(a=n.links)?void 0:a.filter((e=>e.source.structureId!==i&&e.target.structureId!==i)))??[],(!t||t&&e.length||i!==r)&&(n.structures=(n.structures??[]).filter((e=>(i&&i===e.structureId&&o.push(i),e.structureId!==i)))),{removedStructureIds:o}}function eU({idBeingRemoved:e,drawDefinition:t}){let{structure:i}=Hc({structureId:e,drawDefinition:t}),n=jh({structure:i}).matchUps;return mc(n)}function tU({stageSequence:e=1,drawDefinition:t,drawSize:i,stage:n}){if(!t)return{error:$t};if(!Jm({drawDefinition:t,stage:n}))return{error:Oi};let r=function({stage:e,drawDefinition:t}){return Hm.reduce(((i,n)=>(Qm({drawDefinition:t,entryStatus:n,stage:e})||0)+i),0)}({drawDefinition:t,stage:n}),{qualifiersCount:a}=Kv({drawDefinition:t,stageSequence:e,stage:n});if(i<r+a)return{error:oi};let{entryProfile:o}=Mm({attributes:[{[n]:{drawSize:i}}],drawDefinition:t});return kp({drawDefinition:t}),{...At,entryProfile:o}}function iU({qualifiersCount:e=0,drawDefinition:t,stage:i}){return t?Jm({drawDefinition:t,stage:i})?i!==il?{error:oi,info:"qualifiersCount can only be set for main stage"}:(Mm({attributes:[{[i]:{qualifiersCount:e}}],drawDefinition:t}),kp({drawDefinition:t}),{...At}):{error:Oi}:{error:$t}}function nU(e){return function({drawDefinition:e,drawSize:t}){if(!e)return{error:$t};let i=tU({stage:al,stageSequence:1,drawDefinition:e,drawSize:t});return i.error?i:(kp({drawDefinition:e}),{...At})}(e)}var rU="qualifierDrawPositionAssignment",aU="withdrawParticipantAtDrawPosition",oU="alternateDrawPositionAssignment",sU="luckyLoserDrawPositionAssignment",lU="removeDrawPositionAssignment",uU="swapDrawPositionAssignments",dU="modifyPairAssignment",cU="adHocPositionSwap",pU="modifyParticipantOtherName",mU="assignDrawPosition",fU="removeSeededParticipant",hU="assignDrawPositionBye",vU="modifySeedAssignment",gU="addPenalty",IU="MODIFY_PAIR",UU="QUALIFIER",yU="ALTERNATE",SU="WITHDRAW",wU="ASSIGN",PU="REMOVE",DU="LUCKY",TU="REMOVE_SEED",bU="SWAP",RU="NICKNAME",NU="SEED_VALUE",MU="PENALTY",AU="BYE",EU={MODIFY_PAIR_ASSIGNMENT:IU,QUALIFYING_PARTICIPANT:UU,ALTERNATE_PARTICIPANT:yU,WITHDRAW_PARTICIPANT:SU,ASSIGN_PARTICIPANT:wU,LUCKY_PARTICIPANT:DU,REMOVE_ASSIGNMENT:PU,SWAP_PARTICIPANTS:bU,ADD_NICKNAME:RU,REMOVE_SEED:TU,ADD_PENALTY:MU,ASSIGN_BYE:AU,SEED_VALUE:NU};function CU({tournamentRecord:e,drawDefinition:t,drawPositions:i,structureId:n,event:r}){if(!t)return{error:$t};if(!n)return{error:yi};if(2!==(null==i?void 0:i.length))return{error:Cr,drawPositions:i};let a=rf({drawDefinition:t}),{matchUps:o}=Qh({inContext:!0,drawDefinition:t,matchUpsMap:a}),{structure:s}=Hc({drawDefinition:t,structureId:n});if(!s)return{error:Si};let l,u=gm({tournamentRecord:e,drawDefinition:t,event:r}).appliedPolicies??{};if(l=s.structureType===vl?function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){var s;let l=null==(s=a.structures)?void 0:s.reduce(((e,t)=>{let i=null==t?void 0:t.positionAssignments.filter((e=>null==n?void 0:n.includes(e.drawPosition)));return i&&e.push(...i),e}),[]);if(2===l.filter((({bye:e})=>e)).length)return{...At};if(2===l.filter((({qualifier:e})=>e)).length)return{...At};nI({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:r,assignments:l,structure:a,event:o});let u=l.some((({qualifier:e})=>e));if(l.some((({bye:e})=>e))&&!u)OU({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:l,matchUpsMap:r,structure:a,event:o});else{let e=ts(l,!1,!0);l.forEach(((t,i)=>{let n=e[1-i].participantId;t.qualifier=e[1-i].qualifier,t.participantId=n}))}return{...At}}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:i,matchUpsMap:a,structure:s,event:r}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){let s=null==a?void 0:a.positionAssignments.filter((e=>null==n?void 0:n.includes(e.drawPosition)));if(!s)return{error:Cr,structure:a,info:"Missing positionAssignments"};if(2===s.filter((({bye:e})=>e)).length)return{...At};if(2===s.filter((({qualifier:e})=>e)).length)return{...At};let l=s.some((({qualifier:e})=>e));return s.some((({bye:e})=>e))&&!l?OU({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=Object.assign({},...n.map(((e,t)=>{let{drawPosition:i}=e;return{[i]:{...n[1-t],drawPosition:i}}})));return a.positionAssignments=a.positionAssignments.map((e=>s[e.drawPosition]||e)),nI({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:o}),{...At}}({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o})}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:i,matchUpsMap:a,structure:s,event:r}),l.error)return l;if(Lp({structure:s,drawPositions:i}),Bp({appliedPolicies:u,drawDefinition:t,positionAction:{name:uU,drawPositions:i,structureId:n}}),xp({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:t,structure:s,event:r}),r.eventType===el){let n=jh({matchUpFilters:{matchUpTypes:[ke]},inContext:!0,structure:s}).matchUps.filter((e=>{var t;return null==(t=e.drawPositions)?void 0:t.some((e=>i.includes(e)))})),a=jh({matchUpFilters:{matchUpTypes:[ke]},structure:s}).matchUps;n.forEach((n=>{(n.sides||[]).forEach((o=>{var s;let l=null==o?void 0:o.drawPosition;if(i.includes(l)){let i=o.participantId,u=a.find((({matchUpId:e})=>e===n.matchUpId)),d=null==(s=null==n?void 0:n.sides)?void 0:s.reduce(((e,t,i)=>t.drawPosition===l?i:e),void 0);Hg({inContextTargetMatchUp:n,drawPositionSideIndex:d,teamParticipantId:i,tournamentRecord:e,drawDefinition:t,matchUp:u,event:r})}}))}))}return kp({drawDefinition:t,structureIds:[n]}),{...At}}function OU({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=n.find((({bye:e})=>e)),l=n.find((({participantId:e})=>e)),u=s.drawPosition,{participantId:d,drawPosition:c}=l,{structureId:p}=a,m=wg({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:r});return m.error||(m=wg({drawPosition:c,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:r}),m.error)||(yv({drawPosition:c,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:r,event:o}),m=rI({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,participantId:d,matchUpsMap:r,event:o}),m.error)?m:{...At}}function kU({tournamentRecord:e,drawDefinition:t,participantId:i,structureId:n}){var r;let a="removeSeededParticipant";if(!e)return{error:Bt};if(!t)return{error:$t};let o=(t.structures??[]).find((e=>e.structureId===n));return o?!o.stage||![il,nl].includes(o.stage)||o.stage===il&&1!==o.stageSequence?La({result:{error:Ht},stack:a}):null!=(r=o.seedAssignments)&&r.find((e=>e.participantId===i))?{...At}:La({info:"participant not seeded",result:{error:Lr},context:{participantId:i}}):La({result:{error:Si},stack:a})}function FU({targetEntryRound:e=1,finishingPositions:t,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=wl}){return n&&r?{link:_a({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:t},target:{feedProfile:gl,roundNumber:e,structureId:r}})}:{error:yi}}function xU({roundPosition:e,roundNumber:t,idPrefix:i,uuids:n}){return i?`${i}-${t}-${e}`:(null==n?void 0:n.pop())||rs()}function _U({includeMatchUpType:e,matchUpType:t,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let l=0,u=[],d=1,c=i-1,p=null==s?void 0:s.length;for(;l<(p||0);){let p=null==s?void 0:s[l],m=null==s?void 0:s[l+1];c&&(p.roundNumber=c),m&&c&&(m.roundNumber=c);let f={roundPosition:d,children:[p,m],matchUpId:xU({roundPosition:d,roundNumber:i,idPrefix:r,uuids:o})};u.push(f);let h={drawPositions:f.children.map((e=>null==e?void 0:e.drawPosition)).filter(Boolean),matchUpStatus:Oc,matchUpId:f.matchUpId,roundPosition:d,roundNumber:i};e&&t&&(h.matchUpType=t),a&&(h.isMock=!0),n.push(h),d++,l+=2}return{roundNodes:u,matchUps:n}}function LU({finishingPositionOffset:e,finishingPositionLimit:t,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!Ve(s)||s%n)){let e=n;for(;e<s;)e*=2;s=e}let d=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!Ve(s)&&!d)return{matchUps:[],roundsCount:0};let c,p=lt(1,s+1).map((e=>({drawPosition:e}))),m=[],f=1;for(({roundNodes:c,matchUps:m}=_U({matchUpType:r,roundNumber:f,idPrefix:o,matchUps:m,isMock:l,nodes:p,uuids:u})),f++,a=a??i;c.length>1;)n&&c.length===n&&(a=f-1),({roundNodes:c,matchUps:m}=_U({nodes:c,matchUpType:r,roundNumber:f,idPrefix:o,matchUps:m,isMock:l,uuids:u})),f++;let h=f-1;return m=sv({finishingPositionOffset:e,finishingPositionLimit:t,roundsCount:h,roundLimit:a,matchUps:m}),a?m=m.filter((e=>a&&(e.roundNumber??0)<=a)):a=f-1,{drawSize:s,matchUps:m,roundsCount:h,roundLimit:a}}function BU(e){var t,i,n,r,a,o;let s="generateQualifyingStructure";if(!e.drawDefinition)return La({result:{error:$t},stack:s});if(e.drawSize&&!Ye(e.drawSize)||e.participantsCount&&!Ye(e.participantsCount)||e.qualifyingPositions&&!Ye(e.qualifyingPositions))return La({result:{error:Cr},stack:s});let l=e.drawSize??Ge(e.participantsCount),{qualifyingRoundNumber:u,qualifyingPositions:d,targetStructureId:c,structureOptions:p,appliedPolicies:m,drawDefinition:f,matchUpFormat:h,structureName:v,structureId:g,roundTarget:I,drawType:U,idPrefix:y,isMock:S,uuids:w}=e;if(!e.drawSize)return La({result:{error:si},context:{drawSize:l},stack:s});if(d&&d>=e.drawSize)return La({result:{error:Cr},context:{drawSize:l,qualifyingPositions:d},stack:s});let P,D,T,b,R,N=0,{structureProfiles:M}=HI({drawDefinition:f}),A=M[c];if(!A)return La({result:{error:Si},context:{targetStructureId:c},stack:s});let E=f.matchUpType,C=I?`${I}-`:"",O=A.stage===nl,k=(null==(i=null==(t=null==m?void 0:m[od])?void 0:t.namingConventions)?void 0:i.pre)??(null==(r=null==(n=hf[od])?void 0:n.namingConventions)?void 0:r.pre),F=O&&k?`${k}-`:"",x=v??(C?`${F}${Tg(nl)} ${C}`:`${F}${Tg(nl)}`);if(U===Hl){let{maxRoundNumber:e,structures:t,groupCount:i}=Og({structureName:v??x,structureId:g??(null==w?void 0:w.pop()),stage:nl,structureOptions:p,appliedPolicies:m,stageSequence:1,matchUpType:E,roundTarget:I,idPrefix:y,drawSize:l,isMock:S,uuids:w});N=i,P=e,T=t[0],R=[1]}else({drawSize:l,matchUps:b,roundLimit:P,roundsCount:D}=LU({qualifyingRoundNumber:u,qualifyingPositions:d,matchUpType:E,idPrefix:y,drawSize:l,isMock:S,uuids:w})),P||(P=D),T=Rg({structureName:v??x,structureId:g??(null==w?void 0:w.pop()),qualifyingRoundNumber:P,stage:nl,matchUpFormat:h,stageSequence:1,matchUpType:E,roundLimit:P,matchUps:b}),I&&Sd({extension:{name:Jd,value:I},element:T}),N=null==(a=null==b?void 0:b.filter((e=>e.roundNumber===P)))?void 0:a.length;let _=U===Hl?Sl:wl,L=T&&P&&(null==(o=FU({sourceStructureId:T.structureId,sourceRoundNumber:P,targetStructureId:c,finishingPositions:R,linkType:_}))?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:N,...At,structure:T,link:L}}function VU(e){if(!e.tournamentRecord)return{error:Bt};let t=function(e){if(!e.drawDefinition)return{error:$t};if(!e.targetStructureId)return{error:yi};let t=BU(e);if(t.error)return t;let{structure:i,link:n}=t;return i&&n?YI({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,structure:i,link:n}):{error:Cr}}(e);return t.error,t}function jU(e){var t;let i=qu(e,[{[su]:!0,[pu]:!0,[Iu]:!0},{roundNumber:!0,[Fu]:e=>Number.isInteger(e)&&e>0},{[Fu]:e=>Array.isArray(e)&&2===e.length&&e.every(St),[_u]:An,participantIds:!0}]);if(i.error)return i;let{drawDefinition:n,structureId:r,tournamentRecord:a,event:o}=e,{structure:s}=Hc({drawDefinition:n,structureId:r});if(!s)return{error:Si};if(!mf({structure:s}))return{error:Ht};let l=((null==s?void 0:s.matchUps)??[]).filter((t=>t.roundNumber===e.roundNumber)).filter((e=>!dv(e))).filter((t=>{var i;return null==(i=t.sides)?void 0:i.map((e=>e.participantId)).some((t=>e.participantIds.includes(t)))}));if(2!==l.length)return{error:An};for(let u of l){let i=null==(t=null==u?void 0:u.sides)?void 0:t.find((t=>e.participantIds.includes(null==t?void 0:t.participantId)));if(i){let t=e.participantIds.find((e=>e!==(null==i?void 0:i.participantId)));i.participantId=t,Cp({tournamentId:null==a?void 0:a.tournamentId,eventId:null==o?void 0:o.eventId,drawDefinition:n,matchUp:u})}}return kp({drawDefinition:n,structureIds:[r]}),{...At}}function GU({includeMatchUpType:e,drawPosition:t,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let d=l.length,c=t?t-d:void 0,p=lt(0,d).map((e=>c?c+e:void 0)),m=[];for(let f=0;f<d;f++){let t=p.shift(),d={drawPosition:t,fed:u+1,feed:!0},c=l[f];c.roundNumber=i-1;let h=xU({roundPosition:c.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),v={roundPosition:c.roundPosition,drawPositions:[t],matchUpStatus:Oc,roundNumber:i,matchUpId:h};e&&(v.matchUpType=n),o&&(v.isMock=!0),a.push(v);let g={children:[c,d]};m.push(g)}return{roundNodes:m,matchUps:a,drawPosition:t?t-d:void 0}}function $U(e){let t=e.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=e,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:d,matchUpType:c,idPrefix:p,isMock:m,uuids:f,fmlc:h}=e;a=a??function(e){let t=$e(e);return t>e?t/2:t}(t);let v=function({drawSize:e}){let t=Math.ceil(Math.log(e)/Math.log(2));return lt(0,t).reverse().map((e=>Math.pow(2,e)))}({drawSize:a}),g=v.length,I=0;if(null!=i&&i.length)I=i.reduce(((e,t)=>e+t),0);else if(t){let e=t-a;i=v.filter((t=>t<=e&&(e-=t,!0))),I=i.reduce(((e,t)=>e+t),0),n=i.length}else r>=g?n=0:u&&(n=g-u,r=0),i=v.filter(((e,t)=>u&&!n||n&&t>=r+n||t<r?0:e)),I=i.reduce(((e,t)=>e+t),0),n=i.length;let U=[...v,...i].sort(((e,t)=>t-e)),y=U.length,S=[...(l??[]).map((e=>e-1)),...(o??[]).map((e=>y-e))].map((e=>U[e])).reduce(((e,t)=>e+t),0);I-=S;let w,P=0,D=[],T=1,b=lt(0,a).map(((e,t)=>({drawPosition:t+1+I}))),R=I+1;for(let M of v){if(({roundNodes:w,matchUps:D}=_U({matchUpType:c,roundNumber:T,idPrefix:p,matchUps:D,isMock:m,nodes:b,uuids:f})),T++,i.includes(M)){let e=lt(0,tt(i)[M]),t=y+1-T,n=(null==o?void 0:o.includes(t))??(null==l?void 0:l.includes(T));e.forEach((()=>{({roundNodes:w,matchUps:D,drawPosition:R}=GU({drawPosition:!n&&R||void 0,nodes:w,matchUpType:c,roundNumber:T,idPrefix:p,matchUps:D,isMock:m,uuids:f,fed:P})),T++,P+=1}))}b=w}y!==T-1&&console.log("ERROR"),D=sv({finishingPositionOffset:d?a-I:s,positionsFed:I,roundsCount:y,matchUps:D,fmlc:h});let N=null!=w&&w.length?w[0]:w;return N&&(N.roundNumber=T-1,N.matchUps=D),{draw:N,matchUps:D,roundsCount:y}}function qU(e){let{finishingPositionOffset:t=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:d,roundOffset:c=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:f,stage:h=il,drawSize:v,idPrefix:g,isMock:I,uuids:U}=e;if(o&&u&&(null==o||!o[l])||v<2||f&&s>f)return{};let y=[],S=[],w=[],P=e.matchUpType??(null==p?void 0:p.matchUpType),D=t+1,T=`${D}-${t+v}`,b=null==o?void 0:o[l],R=n&&`${n} `||"",N=(null==o?void 0:o[T])??(null==r?void 0:r[T]),M=e.structureName||(null==N?void 0:N.name)||(null==b?void 0:b.name)&&(i?`${R}${null==b?void 0:b.name}`:b.name)||`${R}${T}`,A=(null==N?void 0:N.abbreviation)??(null==b?void 0:b.abbreviation),E=e.structureId??(null==b?void 0:b.structureId)??(null==U?void 0:U.pop()),C={idPrefix:g&&`${g}-${M}-RP`,finishingPositionOffset:t,matchUpType:P,drawSize:v,isMock:I,uuids:U},{matchUps:O}=m?$U(C):LU(C),k=Rg({structureAbbreviation:A,stageSequence:s,structureName:M,matchUpType:P,roundOffset:c,structureId:E,matchUps:O,stage:h});y.push(...O),S.push(k);let F=Math.ceil(Math.log(v)/Math.log(2)),x=d?Math.min(d-c,F):(!a||D<a)&&F||0;return v>2&&lt(1,x+1).forEach((e=>function(e){let m=v/Math.pow(2,e);if(m<2)return;let I=v/Math.pow(2,e)+t;if(a&&I+1>a)return;let{structures:D,structureId:T,matchUps:b,links:R}=qU({finishingPositionOffset:I,exitProfile:`${l}-${e}`,roundOffset:c+e,stageSequence:s+1,drawSize:m,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:d,drawDefinition:p,sequenceLimit:f,matchUpType:P,idPrefix:g,uuids:U,stage:h});if(k.structureId&&T){let t={linkType:Pl,source:{roundNumber:e,structureId:k.structureId},target:{roundNumber:1,feedProfile:Ul,structureId:T}};R&&k&&R.push(t),null!=R&&R.length&&w.push(...R)}return null!=D&&D.length&&S.push(...D),null!=b&&b.length&&y.push(...b),{structureId:T,childLinks:R,structures:S}}(e))),{structureId:k.structureId,matchUps:y,structureName:M,structures:S,links:w,...At}}function WU({drawDefinition:e,matchUpsMap:t,structureId:i}){let n=Hc({drawDefinition:e,structureId:i});if(n.error)return La({result:n});let{matchUps:r}=jh({structure:n.structure,matchUpsMap:t});return{...uf({matchUps:r}),matchUps:r,matchUpsMap:t}}function HU({finishingPositions:e,drawDefinition:t,structureId:i}){var n;let{roundProfile:r}=WU({drawDefinition:t,structureId:i});return null==(n=r&&Object.keys(r))?void 0:n.reduce(((t,i)=>(zU(null==r?void 0:r[i]).forEach((n=>{e.forEach((e=>{(function({position:e,rangeDefinition:t}){if(!Array.isArray(t)||t.reduce(((e,t)=>e||isNaN(t)),!1))return!1;let[i,n]=t;return lt(i,(n||i)+1).includes(e)})({position:e,rangeDefinition:n})&&(t[e]={roundNumber:i})}))})),t)),{})}function zU(e){var t,i;return[Qe((null==(t=null==e?void 0:e.finishingPositionRange)?void 0:t.loser)||[]),Qe((null==(i=null==e?void 0:e.finishingPositionRange)?void 0:i.winner)||[])]}function YU(e){return zU(e).map((e=>lt(e[0],e[1]&&e[1]+1||e[0]+1)))}function KU({drawDefinition:e,structureIds:t,matchUpsMap:i}){if(t&&!Array.isArray(t))return{error:Cr,context:{structureIds:t}};if(!e)return{error:$t};let n=(t=t??(e.structures??[]).filter((e=>e.stage!==nl)).map((({structureId:e})=>e))).map((t=>{var n;let{roundProfile:r}=WU({drawDefinition:e,matchUpsMap:i,structureId:t});return null==(n=r&&Object.values(r))?void 0:n.map(YU).flat()})).flat(),r=n.filter((e=>1===(null==e?void 0:e.length))).sort(Le).flat();return{positionsNotPlayedOff:Qe(n.flat()).filter((e=>!r.includes(e))),positionsPlayedOff:r}}function JU({excludeRoundNumbers:e=[],playoffPositions:t=[],drawDefinition:i,structureId:n}){if(!i)return{error:$t};if(!n)return{error:yi};if(!t)return{error:un,info:"missing playoffPositions"};let r=KU({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,o=HU({finishingPositions:t.filter((e=>!a.includes(e))),drawDefinition:i,structureId:n}),s=Object.values(o).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>Be(e))).filter((t=>!e.includes(t))),l=HU({finishingPositions:a,drawDefinition:i,structureId:n}),u=l?Object.values(l):[],d=l?u.reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>Be(e))):[],c=s.filter((e=>!d.includes(e))).sort(Le),{roundProfile:p}=WU({drawDefinition:i,structureId:n}),m=c.map((e=>{let t=null==p?void 0:p[e].finishingPositionRange.loser,[i,n]=t??[0,0];return lt(i,(n||i)+1)})).flat().sort(Le),{playoffRoundsRanges:f}=function({playoffSourceRounds:e,roundProfile:t}){return{playoffRoundsRanges:e.map((e=>{let i=t[e].finishingPositionRange.loser,[n,r]=i,a=lt(n,(r||n)+1);return{finishingPositionRange:i.join("-"),finishingPositions:a,roundNumber:e}}))}}({playoffSourceRounds:c,roundProfile:p}),h=[...c,...d];return{playoffPositionsReturned:m,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:c,sourceRounds:h,roundProfile:p}}function QU({drawDefinition:e,structureId:t}){if(!e)return{error:$t};let{matchUps:i,matchUpsMap:n}=nv({inContext:!0,drawDefinition:e}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=KU({drawDefinition:e,matchUpsMap:n}),{structures:o}=zc({drawDefinition:e}),s=o.filter((e=>!t&&e.stage!==al||e.structureId===t)),l={};for(let u of s){let t=null==u?void 0:u.structureId,n=ZU({playoffPositions:r,drawDefinition:e,structure:u,matchUps:i}),{error:a,...o}=n;if(a)return n;l[t]={structureId:t,...o}}return t?{positionsPlayedOff:a,...l[t]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function ZU({playoffPositions:e,drawDefinition:t,structure:i,matchUps:n}){var r,a,o,s,l,u,d,c,p;let m=null==i?void 0:i.structureId,{links:f}=Wh({drawDefinition:t,structureId:m});if(i.structureType===vl||i.structures){let e=null==(a=null==(r=Kc({structure:i}))?void 0:r.positionAssignments)?void 0:a.length,u=i.structures.length,d=(e??0)/u,c=(null==(o=f.source)?void 0:o.flatMap((({source:e})=>(null==e?void 0:e.finishingPositions)||[])))||[],p=lt(1,d+1).filter((e=>!c.includes(e))),h=(null==(l=null==(s=n.find((e=>e.containerStructureId===m&&e.finishingPositionRange)))?void 0:s.finishingPositionRange)?void 0:l.winner)||[0,1],v=null==f?void 0:f.source.map((({target:e})=>e.structureId)),{positionsPlayedOff:g=[],positionsNotPlayedOff:I=[]}=KU({structureIds:v,drawDefinition:t}),U=[...g,...I],y=lt(h[0],h[1]+1).filter((e=>!U.includes(e))),S=ht(y,y.length/p.length);return{positionsNotPlayedOff:y,playoffFinishingPositionRanges:p.map(((e,t)=>{let i=S[t];return{finishingPosition:e,finishingPositions:i,finishingPositionRange:[Math.min(...i||[]),Math.max(...i||[])].join("-")}})),finishingPositionsAvailable:p,finishingPositionsPlayedOff:c,positionsPlayedOff:g,groupCount:u,groupSize:d}}let h=(null==(u=null==f?void 0:f.source)?void 0:u.filter((e=>e.linkCondition!==Dl)).map((e=>{var t;return null==(t=e.source)?void 0:t.roundNumber})))||[],v=(null==(d=null==f?void 0:f.source)?void 0:d.filter((e=>e.linkCondition===Dl)).map((e=>{var t;return null==(t=e.source)?void 0:t.roundNumber})))||[],g=JU({excludeRoundNumbers:h,playoffPositions:e,drawDefinition:t,structureId:m}),I=null!=g&&g.playoffSourceRounds?[...(null==g?void 0:g.playoffSourceRounds)||[]]:void 0,U=[...(null==g?void 0:g.playoffRoundsRanges)||[]],{roundProfile:y,error:S}=g;for(let w of v){let e=null==f?void 0:f.source.find((e=>e.source.roundNumber===w)),t=null==e?void 0:e.target.roundNumber,i=null==e?void 0:e.target.structureId,r=n.filter((({roundNumber:e,structureId:n})=>n===i&&e===t)),a=r.filter((({sides:e})=>e.find((e=>e.participantFed&&!e.participantId)))).length;if(I&&a===r.length){I.push(w);let e=null==(p=null==(c=null==y?void 0:y[w])?void 0:c.finishingPositionRange)?void 0:p.loser;if(e){let t=Math.min(...e),i=t+a,n=lt(t,i),r={finishingPositionRange:[t,i-1].join("-"),finishingPositions:n,roundNumber:w};U.push(r)}}}return I&&I.sort(Le),U.sort(((e,t)=>e.roundNumber-t.roundNumber)),{playoffRounds:I,playoffRoundsRanges:U,error:S}}function XU(e){var t,i;let{finishingPositionOffset:n=0,playoffAttributes:r,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=il,matchUpType:u,structureId:d,idPrefix:c,drawSize:p,isMock:m,uuids:f}=e,h={finishingPositionOffset:n,matchUpType:u,drawSize:p,idPrefix:c,isMock:m,uuids:f},{matchUps:v}=o?$U(h):LU(h),g=Rg({structureName:s||(null==(t=null==r?void 0:r[0])?void 0:t.name)||Tg(il),structureId:d||(null==f?void 0:f.pop()),stageSequence:a,matchUpType:u,matchUps:v,stage:l}),I=[g],U=[];if(p>2){let t=p/2,{matchUps:a}=LU({finishingPositionOffset:n+t,idPrefix:c&&`${c}-c`,drawSize:t,matchUpType:u,isMock:m}),o=Tg(rl),l=(null==(i=null==r?void 0:r["0-1"])?void 0:i.name)??e.consolationStructureName??(s?`${s} ${o}`:o),d=Rg({structureName:l,matchUps:a,structureId:null==f?void 0:f.pop(),stage:rl,stageSequence:1,matchUpType:u});I.push(d);let h={linkType:Pl,source:{roundNumber:1,structureId:g.structureId},target:{roundNumber:1,feedProfile:Ul,structureId:d.structureId}};U.push(h)}return{...At,structures:I,links:U}}function ey({consolationStructure:e,roundOffset:t=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let o=e.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),s=(null==r?void 0:r.roundGroupedOrder)||[],l=null==r?void 0:r.roundFeedProfiles;return lt(1+t,n+1+t).map((n=>{let r=null!=l&&l[n-1]?l[n-1]:n%2&&Ul||yl,u=n-t<=2?n-t:2*(n-t-2)+2,d={linkType:Pl,source:{roundNumber:n,structureId:i.structureId},target:{feedProfile:r,roundNumber:u,structureId:e.structureId}},c=s[n-1];return c&&(d.target.groupedOrder=c),aa()&&(d.source.structureName=i.structureName,d.target.structureName=e.structureName),2===n&&a&&(d.linkCondition=Dl,d.target.feedProfile=Ul),o.includes(u)?d:void 0})).filter(Boolean)}function ty(e){var t,i;let{playoffStructureNameBase:n,finishingPositionOffset:r,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:u=il,matchUpType:d,structureId:c,drawSize:p,idPrefix:m,isMock:f,uuids:h}=e,v={finishingPositionOffset:r,matchUpType:d,drawSize:p,idPrefix:m,isMock:f,uuids:h},{matchUps:g,roundsCount:I}=l?$U(v):LU(v),U=e.structureName??(null==(t=null==o?void 0:o[0])?void 0:t.name)??Tg(il),y=bg({structureId:c||(null==h?void 0:h.pop()),structureName:U,stageSequence:a,matchUpType:d,matchUps:g,stage:u}),S=[y],w=[];if(p>2){let e=[0,2].slice(0,p/16).map(((e,t)=>{let i=t+1,{consolationStructure:r}=function({playoffStructureNameBase:e,stageSequence:t=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:d,uuids:c}){var p,m;let f=l/(2*Math.pow(2,r)),{matchUps:h,roundsCount:v}=$U({finishingPositionOffset:f,baseDrawSize:f,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:c}),g=0===d&&(null==(p=null==i?void 0:i["0-1"])?void 0:p.name)||1===d&&(null==(m=null==i?void 0:i["0-3"])?void 0:m.name)||`${Tg(rl)} ${d+1}`,I=(null==n?void 0:n[g])||g,U=e?`${e} ${I}`:I;return{consolationStructure:bg({matchUps:h,stage:rl,structureName:U,stageSequence:t,matchUpType:a,structureId:o}),consolationRoundsCount:v}}({idPrefix:m&&`${m}-c${t}`,structureId:null==h?void 0:h.pop(),playoffStructureNameBase:n,playoffAttributes:o,structureNameMap:s,stageSequence:i,roundOffset:e,matchUpType:d,drawSize:p,isMock:f,index:t,uuids:h});return S.push(r),{consolationStructure:r,links:ey({consolationStructure:r,roundsCount:2,mainStructure:y,roundOffset:e})}})).map((e=>e.links)).flat();if(w.push(...e),p>=4&&p<=16||p>32){let{matchUps:e}=LU({idPrefix:m&&`${m}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:d,isMock:f}),t=(null==(i=null==o?void 0:o["3-4"])?void 0:i.name)??Tg(ol),r=(null==s?void 0:s[t])||t,a=n?`${n} ${r}`:r,l=bg({structureId:null==h?void 0:h.pop(),matchUps:e,stageSequence:2,stage:ol,structureName:a,matchUpType:d}),u={linkType:Pl,source:{roundNumber:I-1,structureId:y.structureId},target:{structureId:l.structureId,feedProfile:Ul,roundNumber:1}};S.push(l),w.push(u)}}return{structures:S,links:w,...At}}function iy(e){var t,i,n,r;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:u,structureName:d,stage:c=il,structureId:p,matchUpType:m,skipRounds:f,feedRounds:h,idPrefix:v,drawSize:g,isMock:I,uuids:U,fmlc:y}=e,S=e.feedPolicy||(null==(t=e.policyDefinitions)?void 0:t[md])||(null==(i=e.appliedPolicies)?void 0:i[md]),w={finishingPositionOffset:a,matchUpType:m,skipRounds:f,drawSize:g,idPrefix:v,isMock:I,uuids:U},{matchUps:P}=u?$U(w):LU(w),D=Rg({structureName:d||(null==(n=null==s?void 0:s[0])?void 0:n.name)||Tg(il),structureId:p||(null==U?void 0:U.pop()),stageSequence:o,matchUpType:m,matchUps:P,stage:c}),T=[D],b=[],R=g/2,{matchUps:N,roundsCount:M}=$U({finishingPositionOffset:R,idPrefix:v&&`${v}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:R,matchUpType:m,feedRounds:h,skipRounds:f,isMock:I,uuids:U,fmlc:y});if(g>2){let t=(null==(r=null==s?void 0:s["0-1"])?void 0:r.name)??Tg(rl),i=e.playoffStructureNameBase?`${e.playoffStructureNameBase} ${t}`:t,n=Rg({matchUps:N,structureId:null==U?void 0:U.pop(),stage:rl,stageSequence:1,structureName:i,matchUpType:m});T.push(n);let a=ey({consolationStructure:n,mainStructure:D,roundsCount:M,feedPolicy:S,fmlc:y});b.push(...a)}return{...At,structures:T,links:b}}function ny({requireSequential:e=!0,playoffMatchUpFormat:t,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:d,idPrefix:c,isMock:p,uuids:m}){var f,h,v,g,I,U;u=u||(null==r?void 0:r[md]);let y="processPlayoffGroups",S=0,w=[],P=[],D=[],{error:T,positionRangeMap:b}=function({playoffGroups:e,drawDefinition:t,structureId:i}){var n,r;if(!t)return{error:$t};if(!St(i)||!Array.isArray(e))return{error:Cr};let a=e.map((({finishingPositions:e})=>e)).flat();return{positionRangeMap:null==(r=null==(n=QU({drawDefinition:t,structureId:i}).playoffFinishingPositionRanges)?void 0:n.filter((e=>a.includes(e.finishingPosition))))?void 0:r.reduce(((e,t)=>(e[t.finishingPosition]=t,e)),{})}}({structureId:n,drawDefinition:o,playoffGroups:s});if(T)return La({result:{error:T},stack:y});if(b&&(null==s||!s.every((t=>{let{finishingPositions:i=[]}=t;if(!i.length)return!1;let n=[...i].sort(Le).map(((e,t)=>(i[t+1]||e)-e)).every((e=>e<2));return(!e||n)&&i.every((e=>b[e]))}))))return La({context:{validFinishingPositions:Object.values(b)},result:{error:Cr},stack:y});for(let R of s){let e=R.finishingPositions,o=b&&e.map((e=>{var t;return null==(t=b[e])?void 0:t.finishingPositions})).flat(),s=d*e.length,y=He(s),T=2===y&&Ml||R.drawType||Ml;o&&(S=Math.min(...o)-1);let N=o&&`${Math.min(...o)}-${Math.max(...o)}`,M=R.structureName||N&&(null==(h=null==(f=R.playoffAttributes)?void 0:f[N])?void 0:h.name)||(null==(g=null==(v=R.playoffAttributes)?void 0:v[0])?void 0:g.name),A={addNameBaseToAttributeName:R.addNameBaseToAttributeName,playoffStructureNameBase:R.playoffStructureNameBase,finishingPositionNaming:R.finishingPositionNaming,finishingPositionLimit:R.finishingPositionLimit,structureId:R.structureId??(null==m?void 0:m.pop()),playoffAttributes:R.playoffAttributes,structureNameMap:R.structureNameMap,sequenceLimit:R.sequenceLimit,structureName:M,idPrefix:c&&`${c}-po`,appliedPolicies:r,finishingPositionOffset:S,stage:ol,stageSequence:a,matchUpType:l,drawSize:y,isMock:p,uuids:m},E=({playoffStructures:t,playoffLinks:i})=>{let[r]=t,a=ry({playoffStructureId:r.structureId,finishingPositions:e,sourceStructureId:n});D.push(a),D.push(...i),P.push(...t),w.push({structureId:r.structureId,finishingPositions:e}),S+=s};if(T===Ml){let{matchUps:i}=LU({finishingPositionLimit:S+s,idPrefix:c&&`${c}-po`,finishingPositionOffset:S,matchUpType:l,drawSize:y,isMock:p,uuids:m}),r=Rg({structureId:R.structureId??(null==m?void 0:m.pop()),matchUpFormat:t,stage:ol,structureName:M,stageSequence:a,matchUps:i});P.push(r);let o=ry({playoffStructureId:r.structureId,finishingPositions:e,sourceStructureId:n});D.push(o),S+=s,w.push({structureId:r.structureId,finishingPositions:e})}else if([Rl,Nl,ol].includes(T)){let t={playoffAttributes:R.playoffAttributes??i,playoffStructureNameBase:R.playoffStructureNameBase,structureId:R.structureId??(null==m?void 0:m.pop()),structureName:R.structureName,idPrefix:c&&`${c}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:S,stage:ol,roundOffset:0,stageSequence:a,drawSize:y,isMock:p,uuids:m};T===Rl?Object.assign(t,{playoffAttributes:(null==R?void 0:R.playoffAttributes)??i??Jl,roundOffsetLimit:3}):T===Nl&&Object.assign(t,{playoffAttributes:(null==R?void 0:R.playoffAttributes)??i??Ql,roundOffsetLimit:2});let r=qU(t);if(r.error)return r;if(null!=(I=r.links)&&I.length&&D.push(...r.links),null!=(U=r.structures)&&U.length&&P.push(...r.structures),P.sort(qc),r.structureId){let t=ry({playoffStructureId:r.structureId,finishingPositions:e,sourceStructureId:n});D.push(t),w.push({structureId:r.structureId,finishingPositions:e})}S+=s}else if([El,ql,jl,Bl,_l,$l].includes(T)){let t=[null==m?void 0:m.pop(),null==m?void 0:m.pop()],i={playoffStructureNameBase:R.playoffStructureNameBase,structureId:R.structureId??(null==m?void 0:m.pop()),playoffAttributes:R.playoffAttributes,idPrefix:c&&`${c}-po`,finishingPositionOffset:S,uuids:t,stage:ol,structureName:M,matchUpType:l,feedPolicy:u,drawSize:y,isMock:p},r={[El]:{fmlc:!0,feedRounds:1},[$l]:{feedRounds:1},[jl]:{feedsFromFinal:3},[Bl]:{feedsFromFinal:2},[_l]:{feedsFromFinal:1}};Object.assign(i,r[T]||{});let{structures:a,links:o}=iy(i),[d]=a,f=ry({playoffStructureId:d.structureId,finishingPositions:e,sourceStructureId:n});D.push(f),D.push(...o),P.push(...a),w.push({structureId:d.structureId,finishingPositions:e}),S+=s}else if([Hl].includes(T)){let{structures:e,links:t}=Og({...A,structureOptions:R.structureOptions||{groupSize:4}});E({playoffStructures:e,playoffLinks:t})}else if([Cl].includes(T)){let{structures:e,links:t}=XU(A);E({playoffStructures:e,playoffLinks:t})}else if([Fl].includes(T)){let{structures:e,links:t}=ty(A);E({playoffStructures:e,playoffLinks:t})}else if([Tl].includes(T)){E({playoffStructures:[Rg({structureId:R.structureId??(null==m?void 0:m.pop()),structureName:R.structureName,finishingPosition:Dm,stage:ol,stageSequence:a,matchUps:[]})],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:b,structures:P,links:D}}function ry({playoffStructureId:e,finishingPositions:t,sourceStructureId:i}){return{linkType:Sl,source:{structureId:i,finishingPositions:t},target:{structureId:e,feedProfile:gl,roundNumber:1}}}function ay({matchUp:e,tieFormat:t,isMock:i,uuids:n}){let{collectionDefinitions:r}=t??{};return{tieMatchUps:(r??[]).map((t=>oy({matchUp:e,collectionDefinition:t,uuids:n,isMock:i}))).filter(Boolean).flat()}}function oy({collectionPositionOffset:e=0,collectionDefinition:t,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=t||{},d=e=>{if(!(r||null!=n&&n.isMock))return(null==a?void 0:a.pop())??rs();let i=null==t?void 0:t.collectionId;return(null==a?void 0:a.pop())??`${null==n?void 0:n.matchUpId}-${i}-TMU-${e+1}`};return lt(0,i??o??0).map((t=>{let i=e+t+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(t),matchUpStatus:Oc,collectionPosition:i,collectionId:l,processCodes:u,matchUpType:s,isMock:r}}))}function sy({value:e,sourceRange:t,targetRange:i}){let n=Math.min(...t),r=Math.max(...t),a=Math.min(...i);return(e-n)*(Math.max(...i)-a)/(r-n)+a}var ly="ELO",uy="NTRP",dy="WTN",cy={ELO:ly,NTRP:uy,TRN:"TRN",UTR:"UTR",WTN:dy},py={[ly]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[uy]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[dy]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}};function my({targetRatingType:e,sourceRating:t}){let i=py[e].decimalsCount||0,n=py[e].range,r=n[0]>n[1],a=Math.max(...n),o=sy({targetRange:n,sourceRange:py[ly].range,value:t}),s=parseFloat(o.toFixed(i));return r?a-s:s}function fy(e){var t;let i=qu(e,[{ratings:!0,[Lu]:Ou}]);if(i.error)return i;let n=e.matchUpType&&[Ee,Oe].includes(e.matchUpType)?e.matchUpType:Ee,r=Object.keys(py),a=e.targetRatingType&&r.includes(e.targetRatingType)?e.targetRatingType:ly,o=e.ratings[n]?e.ratings[n].reduce(((e,t)=>e.includes(t.scaleName)?e:e.concat(t.scaleName)),[]):[];if(!o)return{error:Lr};let s=(null==(t=e.ratings[n])?void 0:t.find((e=>e.scaleName===a)))??e.ratings[n][0];if(o[0]===a)return s;let l=s.scaleName,u=py[s.scaleName].accessor,d=u?s.scaleValue[u]:s.scaleValue,c=function({sourceRatingType:e,sourceRating:t}){let i=py[e].range,n=i[0]>i[1],r=py[ly].range;return sy({value:n?i[0]-t:t,sourceRange:i,targetRange:r})}({sourceRatingType:l,sourceRating:d});return{convertedRating:my({targetRatingType:a,sourceRating:c}),sourceRating:d}}function hy({participantResults:e,sides:t,score:i}){var n,r;let a=t.find((({sideNumber:e})=>1===e)),o=t.find((({sideNumber:e})=>2===e)),s=null==(n=null==a?void 0:a.participant)?void 0:n.ratings,l=null==(r=null==o?void 0:o.participant)?void 0:r.ratings;if(null!=s&&s[Ee]&&null!=l&&l[Ee]){let t=ly,{convertedRating:n}=fy({ratings:s,targetRatingType:t}),{convertedRating:r}=fy({ratings:l,targetRatingType:t}),{side1pressure:u,side2pressure:d}=function({side1ConvertedRating:e,side2ConvertedRating:t,score:i}){var n,r;let a=e>t?e:t,o=e>t?t:e,s=Math.abs(e-t),l=py[ly].range,u=Math.max(...l),d=0*(u-a),c=(a+d)/u*s,p=null==(n=null==i?void 0:i.sets)?void 0:n.reduce(((e,t)=>e+((null==t?void 0:t.side1Score)??0)),0),m=null==(r=null==i?void 0:i.sets)?void 0:r.reduce(((e,t)=>e+(t.side2Score??0)),0),f=e>t?2:1,h=(p||0)*(o+(1===f?c:0)),v=(m||0)*(o+(2===f?c:0)),g=h+v,I=g?Je(h/g):0,U=g?Je(v/g):0;return{side1pressure:I,side2pressure:U}}({side1ConvertedRating:n,side2ConvertedRating:r,score:i});u&&e[null==a?void 0:a.participantId].pressureScores.push(u),d&&e[null==o?void 0:o.participantId].pressureScores.push(d);let c=Math.max(...py[ly].range),p=Je((r-n)/c),m=Je((n-r)/c);e[null==a?void 0:a.participantId].ratingVariation.push(p),e[null==o?void 0:o.participantId].ratingVariation.push(m)}}function vy({winningSide:e,matchUpFormat:t=hs,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],o=null==r?void 0:r.sets,s="number"==typeof e&&e-1,l=no(t),u=Uy((null==l?void 0:l.bestOf)??1);if("number"==typeof s&&(i===Tc&&null!=n&&n.setsCreditForDefaults||i===kc&&null!=n&&n.setsCreditForWalkovers))a[s]=u;else for(let d of o||[]){let{winningSide:e}=d;e&&(a[e-1]+=1)}return"number"==typeof s&&i===Ec&&(+a[1-s]===u&&(a[1-s]-=1),null!=n&&n.setsCreditForRetirements&&(a[s]=u)),a}function gy({matchUpFormat:e=hs,winningSide:t,matchUpStatus:i,tallyPolicy:n,score:r}){var a,o;let{sets:s}=r||{};if(!s)return[0,0];let l="number"==typeof t&&t-1,u=no(e),d=Uy((null==u?void 0:u.bestOf)??1),c=(null==(a=null==u?void 0:u.setFormat)?void 0:a.tiebreakAt)||0,p=[[],[]];if("number"==typeof l&&(i===Tc&&null!=n&&n.gamesCreditForDefaults||i===kc&&null!=n&&n.gamesCreditForWalkovers)){let e=(null==(o=null==u?void 0:u.setFormat)?void 0:o.setTo)||0,t=d*e;p[l].push(t)}else s.forEach(((e,t)=>{var i;let r=(e.setNumber||t+1)>d&&null!=u&&u.finalSetFormat?"finalSetFormat":"setFormat",a=null==(i=null==u?void 0:u[r])?void 0:i.based,o=null==u?void 0:u[r].tiebreakSet,{side1Score:s,side2Score:l}=e;Sy(a)&&(p[0].push(Be(s||0)),p[1].push(Be(l||0))),o&&e.winningSide&&!1!==(null==n?void 0:n.gamesCreditForTiebreakSets)&&p[e.winningSide-1].push(1)}));if(i===Ec&&"number"==typeof l){let r=s.length>d&&null!=u&&u.finalSetFormat?"finalSetFormat":"setFormat",a=null==u?void 0:u[r];if(Sy(a.based)){let r=(null==a?void 0:a.setTo)||0,o=e=>{if(u&&""!==e)return+e==c-1||+e===c?Be(c||0)+1:+e<c?r:c},m=vy({winningSide:t,score:{sets:s},matchUpStatus:i,matchUpFormat:e,tallyPolicy:n});if(p.map((e=>e[l]<=e[1-l])).reduce(((e,t)=>e+(t?1:0)),0)>m[1-l]){let e=p[l].length,t=o(p[1-l][e-1]);t&&(p[l][e-1]=t)}d>p[l].length&&null!=n&&n.gamesCreditForRetirements&&p[l].push(r)}}return[p[0].reduce(((e,t)=>e+t),0),p[1].reduce(((e,t)=>e+t),0)]}function Iy({matchUpFormat:e,score:t}){var i;let n=e?no(e):void 0,r=Uy((null==n?void 0:n.bestOf)??1),a=[0,0],o=[0,0];return null==(i=null==t?void 0:t.sets)||i.forEach(((e,t)=>{var i;let s=(e.setNumber||t+1)>r&&null!=n&&n.finalSetFormat?"finalSetFormat":"setFormat";if(yy(null==(i=null==n?void 0:n[s])?void 0:i.based)){let{side1Score:t,side2Score:i}=e;t&&(o[0]+=Be(t||0)),i&&(o[1]+=Be(i||0))}else e.side1TiebreakScore&&(o[0]+=Be(e.side1TiebreakScore||0)),e.side2TiebreakScore&&(o[1]+=Be(e.side2TiebreakScore||0)),(e.side1TiebreakScore||e.side2TiebreakScore)&&e.winningSide&&(a[e.winningSide-1]+=1)})),{pointsTally:o,tiebreaksTally:a}}function Uy(e){return e&&Math.ceil(e/2)||1}function yy(e){return"P"===e}function Sy(e){return!yy(e)}function wy({participantIds:e,pressureRating:t,matchUpFormat:i,tallyPolicy:n,perPlayer:r,matchUps:a}){var o,s,l,u,d,c,p;let m={},f=(null==n?void 0:n.excludeMatchUpStatuses)||[],h=null==a?void 0:a.filter((t=>(t.tieMatchUps||!f.includes(t.matchUpStatus))&&(!(null!=e&&e.length)||2===dt(e,[Ty(t,0),Ty(t,1)]).length))),v=null==(o=null==h?void 0:h.flatMap((({score:e,tieMatchUps:t})=>{var i;return t?t.filter((({matchUpStatus:e})=>!f.includes(e))).flatMap((({score:e})=>{var t;return(null==(t=null==e?void 0:e.sets)?void 0:t.length)??0})):(null==(i=null==e?void 0:e.sets)?void 0:i.length)??0})))?void 0:o.reduce(((e,t)=>e+t),0);for(let g of h??[]){let{matchUpStatus:e,tieMatchUps:a,tieFormat:o,score:f,winningSide:h,sides:v}=g,I=o&&g._disableAutoCalc&&o.collectionDefinitions.every((({scoreValue:e})=>e)),U=h&&Py(g),y=h&&Dy(g);if(U||y)if(by(m,U),by(m,y),null==a?void 0:a.length){r=0;for(let e of a){let{matchUpType:i}=e,r=Xf(Oe)(i),a=Xf(Ee)(i);e.winningSide&&(e.winningSide===h?(U&&(m[U].tieMatchUpsWon+=1,a&&(m[U].tieSinglesWon+=1),r&&(m[U].tieDoublesWon+=1)),y&&(m[y].tieMatchUpsLost+=1,a&&(m[y].tieSinglesLost+=1),r&&(m[y].tieDoublesLost+=1))):e.winningSide!==h&&(y&&(m[y].tieMatchUpsWon+=1,a&&(m[y].tieSinglesWon+=1),r&&(m[y].tieDoublesWon+=1)),U&&(m[U].tieMatchUpsLost+=1,a&&(m[U].tieSinglesLost+=1),r&&(m[U].tieDoublesLost+=1)))),Ny({matchUpFormat:e.matchUpFormat,matchUpStatus:e.matchUpStatus,matchUpType:e.matchUpType,score:e.score,sides:e.sides,winningParticipantId:U,losingParticipantId:y,manualGamesOverride:I,participantResults:m,isTieMatchUp:!0,pressureRating:t,tallyPolicy:n,winningSide:h})}My({winningParticipantId:U,losingParticipantId:y,participantResults:m,matchUpStatus:e})}else Ny({matchUpFormat:g.matchUpFormat??i,matchUpType:g.matchUpType,isTieMatchUp:void 0,winningParticipantId:U,manualGamesOverride:I,losingParticipantId:y,participantResults:m,pressureRating:t,matchUpStatus:e,tallyPolicy:n,winningSide:h,score:f,sides:v});else if(e&&Vc.includes(e)){let e=Ty(g,0),t=Ty(g,1);e&&(by(m,e),m[e].matchUpsCancelled+=1),t&&(by(m,t),m[t].matchUpsCancelled+=1)}else if(null!=a&&a.length){r=0;for(let e of a){if(e.winningSide){let t=null==(s=null==v?void 0:v.find((({sideNumber:t})=>t===e.winningSide)))?void 0:s.participantId,i=null==(l=null==v?void 0:v.find((({sideNumber:t})=>t===e.winningSide)))?void 0:l.participantId;t&&i&&(by(m,t),by(m,i),m[t].tieMatchUpsWon+=1,m[i].tieMatchUpsLost+=1,Xf(Ee)(e.matchUpType)?(m[t].tieSinglesWon+=1,m[i].tieSinglesLost+=1):Xf(Oe)(e.matchUpType)&&(m[t].tieDoublesWon+=1,m[i].tieDoublesLost+=1))}Ry({score:e.score,manualGamesOverride:I,participantResults:m,sides:v})}}else Ry({manualGamesOverride:I,participantResults:m,score:f,sides:v});let S=null==(u=null==f?void 0:f.sets)?void 0:u.reduce(((e,t)=>e+((null==t?void 0:t.side1Score)??0)),0),w=null==(d=null==f?void 0:f.sets)?void 0:d.reduce(((e,t)=>e+(t.side2Score??0)),0);if(I){let e=null==(c=null==v?void 0:v.find((({sideNumber:e})=>1===e)))?void 0:c.participantId,t=null==(p=null==v?void 0:v.find((({sideNumber:e})=>2===e)))?void 0:p.participantId;by(m,e),by(m,t),e&&(m[e].gamesWon+=S,m[e].gamesLost+=w),t&&(m[t].gamesWon+=w,m[t].gamesLost+=S)}}return function({participantResults:e,matchUpFormat:t,tallyPolicy:i,perPlayer:n,totalSets:r}){var a;let o=t&&no(t)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,u=null==(a=o.setFormat)?void 0:a.setTo;Object.keys(e).forEach((t=>{let a=e[t].setsWon,o=e[t].setsLost,s=null!=i&&i.groupTotalSetsPlayed?r:n*(l||0)||a+o,d=Math.round(a/s*1e3)/1e3;(d===1/0||isNaN(d))&&(d=s);let c=e[t].tieMatchUpsWon,p=c+e[t].tieMatchUpsLost,m=Math.round(c/p*1e3)/1e3;(m===1/0||isNaN(m))&&(m=c);let f=e[t].matchUpsWon,h=f+e[t].matchUpsLost,v=Math.round(f/h*1e3)/1e3;(v===1/0||isNaN(v))&&(v=f);let g=e[t].gamesWon||0,I=e[t].gamesLost||0,U=(n||0)*(l||0)*(u||0),y=Math.max(U,g+I),S=Math.round(g/y*1e3)/1e3;(S===1/0||isNaN(S))&&(S=0);let w=e[t].pointsWon+e[t].pointsLost,P=Math.round(e[t].pointsWon/w*1e3)/1e3;(P===1/0||isNaN(P))&&(P=0),e[t].setsWon=a,e[t].setsLost=o,e[t].setsPct=d,e[t].tieMatchUpsWon=c,e[t].tieMatchUpsPct=m,e[t].matchUpsPct=v,e[t].gamesWon=g,e[t].gamesLost=I,e[t].gamesPct=S,e[t].pointsPct=P,e[t].result=`${e[t].matchUpsWon}/${e[t].matchUpsLost}`}))}({participantResults:m,matchUpFormat:i,tallyPolicy:n,perPlayer:r,totalSets:v}),{participantResults:m}}function Py(e){return Ty(e,e.winningSide-1)}function Dy(e){return Ty(e,1-(e.winningSide-1))}function Ty(e,t){if(null==e||!e.sides)return console.log("no sides:",{matchUp:e}),"foo";let i=e.sides[t];return i?i.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function by(e,t){t&&!e[t]&&(e[t]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function Ry({manualGamesOverride:e,participantResults:t,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],o=[0,0];for(let l of r||[]){let{winningSide:e,side1Score:t,side2Score:i}=l;e&&(o[e-1]+=1),a[0].push(Be(t||0)),a[1].push(Be(i||0))}let s=[a[0].reduce(((e,t)=>e+t),0),a[1].reduce(((e,t)=>e+t),0)];n.forEach(((i,n)=>{let{participantId:r}=i;r&&(by(t,r),t[r].setsWon+=o[n],t[r].setsLost+=o[1-n],e||(t[r].gamesWon+=s[n],t[r].gamesLost+=s[1-n]))}))}function Ny({winningParticipantId:e,manualGamesOverride:t,losingParticipantId:i,participantResults:n,pressureRating:r,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:u,winningSide:d,score:c,sides:p}){let m=d&&d-1,f=1-m;r&&l===Ee&&hy({participantResults:n,sides:p,score:c}),s||My({winningParticipantId:e,losingParticipantId:i,participantResults:n,matchUpStatus:o});let h=vy({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:d,score:c}),v=gy({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:d,score:c}),{pointsTally:g}=Iy({score:c,matchUpFormat:a});e&&(n[e].setsWon+=h[m],n[e].setsLost+=h[f],t||(n[e].gamesWon+=v[m],n[e].gamesLost+=v[f]),n[e].pointsWon+=g[m],n[e].pointsLost+=g[f]),i&&(n[i].setsWon+=h[f],n[i].setsLost+=h[m],t||(n[i].gamesWon+=v[f],n[i].gamesLost+=v[m]),n[i].pointsWon+=g[f],n[i].pointsLost+=g[m])}function My({winningParticipantId:e,losingParticipantId:t,participantResults:i,matchUpStatus:n}){t&&(n===kc&&(i[t].walkovers+=1),n===Tc&&(i[t].defaults+=1),n===Ec&&(i[t].retirements+=1),[Tc,Ec,kc].includes(n)&&(i[t].allDefaults+=1),i[t].matchUpsLost+=1),e&&(i[e].matchUpsWon+=1),t&&e&&(i[t].defeats.push(e),i[e].victories.push(t))}function Ay({participantResults:e,participantIds:t,attribute:i}){return Ey({participantResults:e,participantIds:t}).reduce(((e,t)=>{let{participantId:n,results:r}=t,a=null==r?void 0:r[i];return!isNaN(a)&&n&&(e[a]?e[a].push(n):e[a]=[n]),e}),{})}function Ey(e){return(e.participantIds||Object.keys(e.participantResults)).reduce(((t,i,n)=>(t.push({participantId:i,i:n,results:e.participantResults[i]}),t)),[])}var Cy=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],Oy={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function ky(e){let{requireCompletion:t=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=e,a=[];if(t&&!function({participantResults:e,participantsCount:t}){let i=Ey({participantResults:e}).filter((e=>t-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled));return t===i.length}(e))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(null==r?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=Ay({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l,u,d=Object.keys(s).map((e=>parseFloat(e))).sort(((e,t)=>t-e)).map((e=>s[e])).map((t=>{let i=Fy({participantIds:t,...e});return a.push(...i.report??[]),i.order})).map(((e,t)=>e.map((e=>e.resolved?e:{...e,subGroup:[t].concat(...e.subGroup??[])})))).flat(),c=0,p=1;d.forEach(((e,t)=>{var i;t&&(e.resolved||u&&!e.resolved)&&(p+=1),u=e.resolved;let n=parseInt((null==(i=e.subGroup)?void 0:i.join(""))||0);e.resolved?(e.position=t+1,p=e.position):(l&&n>l&&(p+=c,c=0),e.position=p,c+=1),l=n}));let m=tt(d.map((({position:e})=>e)));return d.forEach((e=>{let{participantId:t,position:a}=e||{},o=i[t];e.GEMscore=function(e){return(Array.isArray(null==r?void 0:r.GEMscore)?Object.keys(Oy).filter((e=>r.GEMscore.includes(e))):Object.keys(Oy)).map((t=>(e[t]||0)*Math.pow(10,Oy[t].toFixed(3)))).reduce(((e,t)=>e+t),0)}(o);let s=m[a];void 0!==(null==e?void 0:e.position)&&(s>1&&(e.ties=s,n&&(e.subOrder=n[t])),e.rankOrder=a,e.groupOrder=a+(e.subOrder||1)-1)})),{groupOrder:d,report:a.flat(1/0).filter(Boolean)}}function Fy({participantResults:e,disableHeadToHead:t,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let o,s=[],l=[];if(1===(null==i?void 0:i.length))return{order:[{resolved:!0,participantId:i[0]}]};if(2===(null==i?void 0:i.length)&&(null==r||!r.headToHead||!r.headToHead.disabled&&!t)){let t=function({participantIds:e,participantResults:t}){if(e){if(t[e[0]].victories.includes(e[1]))return e.map((e=>({resolved:!0,participantId:e})));if(t[e[1]].victories.includes(e[0]))return e.reverse().map((e=>({resolved:!0,participantId:e})))}}({participantIds:i,participantResults:e});if(t){let e=t[0].participantId;return l.push({attribute:"head2Head",participantIds:i,headToHeadWinner:e}),{order:t,headToHeadWinner:e,report:l}}}let u=((null==r?void 0:r.tallyDirectives)||Cy).filter((e=>{let t=!(qe(e.maxParticipants)&&(null==i?void 0:i.length)>e.maxParticipants);return t||s.push(e),t}));return s.length&&l.push({excludedDirectives:s,participantIds:i}),u.every((({attribute:e,reversed:t,idsFilter:s,disableHeadToHead:u})=>(o=function({disableHeadToHead:e,participantIds:t,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){let l,{participantResults:u}=wy({participantIds:a&&t,matchUpFormat:i,tallyPolicy:n,matchUps:o}),d=Ay({participantResults:u,participantIds:t,attribute:r}),c=[{attribute:r,reversed:s,groups:d,idsFilter:a}];return Object.keys(d).length>1&&t.length&&(l=Object.keys(d).map((e=>parseFloat(e))).sort(((e,t)=>s?e-t:t-e)).map((e=>d[e])).map((t=>{let r=Fy({participantResults:u,disableHeadToHead:e,participantIds:t,matchUpFormat:i,tallyPolicy:n,matchUps:o});return c.push(...r.report??[]),r.order})).map(((e,t)=>e.map((e=>e.resolved?e:{...e,subGroup:[t].concat(...e.subGroup??[])})))).flat()),{order:l,report:c}}({disableHeadToHead:u,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:e,idsFilter:s,matchUps:a,reversed:t}),l.push(o.report),!o.order))),o.order?{order:o.order,report:l}:{order:null==i?void 0:i.map((e=>({participantId:e}))),report:l}}function xy({policyDefinitions:e,generateReport:t,pressureRating:i,matchUpFormat:n,matchUps:r=[],subOrderMap:a,perPlayer:o}){if(null==r||!r.length||!lf(r))return{error:Ki};let s=Qe(r.map((({structureId:e})=>e)));if(1!==s.length)return La({result:{error:Cr,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=r.filter((e=>e&&e.matchUpStatus!==Sc)),u=l.length&&Qe(l.map((({drawPositions:e})=>e)).flat()).length,d=l.filter((e=>Gh({matchUp:e}))).length===l.length;d||(o=0);let c,p,m=r.every((({matchUpType:e,tieMatchUps:t})=>e===Fe&&(null==t?void 0:t.every((e=>Gh({matchUp:e})))))),f=null==e?void 0:e[id],h=r.filter((e=>Gh({matchUp:e})||e.matchUpType===Fe)),{participantResults:v}=wy({matchUps:h,pressureRating:i,matchUpFormat:n,tallyPolicy:f,perPlayer:o}),{groupOrder:g,report:I}=ky({matchUps:h,participantResults:v,participantsCount:u,matchUpFormat:n,tallyPolicy:f,subOrderMap:a});if(i&&function({participantResults:e}){let t=e=>e.reduce(((e,t)=>e+parseFloat(t)),0),i=e=>parseFloat((t(e)/e.length).toFixed(2)),n=Object.keys(e).map((t=>{let n=e[t],{pressureScores:r}=n;return{participantId:t,averagePressure:null!=r&&r.length?i(r):0}})).sort(((e,t)=>(t.averagePressure||0)-(e.averagePressure||0))).map(((e,t)=>({...e,order:t+1})));for(let r of n)e[r.participantId].pressureOrder=r.order}({participantResults:v}),d&&g)c=I,p=g,g.forEach((e=>{let{participantId:t,groupOrder:i,rankOrder:n,subOrder:r,ties:a,GEMscore:o}=e,s=v[t];Object.assign(s,{groupOrder:i,rankOrder:n,GEMscore:o,subOrder:r,ties:a})}));else{let{groupOrder:e,report:t}=ky({requireCompletion:!1,participantResults:v,participantsCount:u,matchUpFormat:n,tallyPolicy:f,subOrderMap:a,matchUps:r});c=t,p=e,e&&e.forEach((e=>{let{participantId:t,groupOrder:i,GEMscore:n}=e,r=v[t];Object.assign(r,{provisionalOrder:i,GEMscore:n})}))}let U={completedTieMatchUps:m,readableReport:"",participantResults:v,bracketComplete:d,order:[],report:c};if((d||m)&&(U.order=p),t||aa({tally:!0})){let e=function({matchUps:e,order:t,report:i}){let n={};e.forEach((({sides:e})=>{e.forEach((e=>{e.participantId&&e.participant&&(n[e.participantId]=e.participant.participantName)}))}));let r=[];return Array.isArray(i)&&i.forEach(((e,t)=>{var i,a;if(null!=(i=e.excludedDirectives)&&i.length){let t=e.excludedDirectives.map((({attribute:e})=>e)).join(", "),i=`${t.length} directives were excluded due to participants limit}`;r.push(i);let n=`Excluded: ${t}`;r.push(n)}else{let i=(t,i)=>parseFloat(e.reversed?t:i)-parseFloat(e.reversed?i:t),o=e.groups?Object.values(e.groups).flat(1/0).length:(null==(a=e.participantIds)?void 0:a.length)??0,s=e=>{e.groups&&Object.keys(e.groups).sort(i).forEach((t=>{let i=e.groups[t].map((e=>n[e])).join(", "),a=`${t} ${e.attribute}: ${i}`;r.push(a)}))},l=e.reversed?" in reverse order":"",u=`Step ${t+1}: ${o} particiants were ${e.groups?"grouped":"separated"}${l} by ${e.attribute}`;if(r.push(u),e.idsFilter){let t=`${e.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(t)}s(e)}r.push("----------------------")})),r.push("Final Order:"),t.forEach((e=>{let{participantId:t,resolved:i}=e,a=e.groupOrder||e.provisionalOrder;r.push(`${a}: ${n[t]} => resolved: ${!!i}`)})),r.join("\r\n")}({matchUps:r,report:c,order:p});aa({tally:!0})&&console.log(e),U.readableReport=e}return U}function _y({positionAssignments:e}){let t=(e||[]).filter(ov(du)).map((e=>{let{extension:t}=Cd({element:e,name:ec}),i=Be(null==t?void 0:t.value),n=!isNaN(i)&&i;return n&&{participantId:e.participantId,subOrder:n}})).filter(Boolean),i=tt(t.map((({subOrder:e})=>e)));return{subOrderMap:Object.assign({},...t.filter((({subOrder:e})=>1===i[e])).map((({participantId:e,subOrder:t})=>({[e]:t}))))}}function Ly({positionAssignments:e,tournamentRecord:t,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!lf(r))return{error:Cr};if(!e)return{error:Cr};let{policyDefinitions:o}=Im({policyTypes:[id],tournamentRecord:t,drawDefinition:i,event:a}),{subOrderMap:s}=_y({positionAssignments:e}),l=r.length?xy({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(null!=l&&l.error)return l;let{participantResults:u={},bracketComplete:d,report:c}=l??{},p=Object.keys(u);return e.forEach((e=>{let{participantId:t}=e;if(p.includes(t)){Sd({element:e,extension:{value:u[t],name:tc}}),u[t].ties||Ud({element:e,name:ec})}else Ud({element:e,name:tc}),Ud({element:e,name:ec})})),kp({drawDefinition:i}),{...At,participantResults:u,bracketComplete:d,report:c}}function By({matchUps:e,matchUpId:t}){return{matchUp:(e||[]).find((e=>e.matchUpId===t))}}function Vy(e){let t=qu(e,[{[su]:!0,[Iu]:!0}]);if(t.error)return t;let{tournamentParticipants:i,afterRecoveryTimes:n,contextProfile:r,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:u,event:d}=e,{structures:c=[]}=zc({drawDefinition:a}),p=e.contextContent||r&&bm({contextProfile:r,drawDefinition:a});for(let m of c){let{matchUps:e}=jh({tournamentParticipants:i,afterRecoveryTimes:n,contextContent:p,drawDefinition:a,contextProfile:r,matchUpsMap:o,inContext:l,structure:m,context:u,event:d}),{matchUp:t}=By({matchUps:e,matchUpId:s});if(t)return{matchUp:t,structure:m}}return{error:Yi}}function jy(e){var t;return wt(e)&&e.notes?wt(e.element)&&(St(e.notes)||null!=(t=e.notes)&&t.testing)?(Object.assign(e.element,{notes:e.notes}),{...At}):{error:Cr}:{error:un}}function Gy(e){return wt(e)?wt(e.element)?(e.element.notes&&delete e.element.notes,{...At}):{error:Cr}:{error:un}}var $y={matchUpStatus:Oc,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function qy(e){var t,i,n,r,a,o,s,l;let u,d="modifyMatchUpScore",c=e.matchUpFormat,p=e.matchUp,{matchUpStatusCodes:m,tournamentRecord:f,drawDefinition:h,matchUpStatus:v,removeScore:g,winningSide:I,matchUpId:U,event:y,notes:S,score:w}=e,P=e.appliedPolicies&&Object.keys(e.appliedPolicies).length?e.appliedPolicies:null==(t=gm({policyTypes:[cd],tournamentRecord:f,drawDefinition:h,structure:u,event:y}))?void 0:t.appliedPolicies,D=p.matchUpType===Fe;if(D&&h){if(U&&p.matchUpId!==U){let e=Vy({drawDefinition:h,matchUpId:U,event:y});if(!e.matchUp)return{error:Yi};({matchUp:p,structure:u}=e)}}else p.matchUpId!==U&&console.log("!!!!!");v&&[kc,Rc].includes(v)||g?Object.assign(p,{...$y}):w&&(p.score=w);let T,b=v&&(null==p?void 0:p.matchUpStatus)===Tc&&v!==Tc;if(v&&(p.matchUpStatus=v),c&&(p.matchUpFormat=c),m&&(p.matchUpStatusCodes=m),I&&(p.winningSide=I),e.removeWinningSide&&(p.winningSide=void 0),!u&&h&&({structure:u}=Vy({drawDefinition:h,matchUpId:U,event:y})),v&&!p.winningSide&&dv(p)&&!Vc.includes(v)&&![yc,Cc,Mc].includes(v)&&(p.matchUpStatus=Nc),(b&&null!=(i=null==p?void 0:p.processCodes)&&i.length||v===Tc)&&(T=null==(r=null==(n=null==P?void 0:P[cd])?void 0:n.processCodes)?void 0:r.incompleteAssignmentsOnDefault),!p.collectionId){let e=(null==u?void 0:u.structureType)===vl,t=mf({structure:u});if(pf({drawDefinition:h,structure:u})||t||e){let i=(e=>{c=D?"SET1-S:T100":c??p.matchUpFormat??(null==e?void 0:e.matchUpFormat)??(null==h?void 0:h.matchUpFormat)??(null==y?void 0:y.matchUpFormat);let i=D?{matchUpTypes:[Fe]}:void 0,{matchUps:n}=jh({afterRecoveryTimes:!1,tournamentRecord:f,inContext:!0,matchUpFilters:i,drawDefinition:h,structure:e,event:y});return t&&(e.positionAssignments=Qe(n.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})))),Ly({positionAssignments:e.positionAssignments,tournamentRecord:f,drawDefinition:h,matchUpFormat:c,matchUps:n,event:y})})(e&&u.structures.find((e=>null==e?void 0:e.matchUps.find((e=>e.matchUpId===U))))||u);if(i.error)return La({result:i,stack:d})}}if(S){let e=jy({element:p,notes:S});if(e.error)return La({result:e,stack:d})}let R=null==f?void 0:f.tournamentId,N=Pa().topics.includes(Rp),M=(N||T)&&rf({drawDefinition:h}),A=M&&(null==(a=Qh({matchUpFilters:{matchUpIds:[U]},nextMatchUps:!0,tournamentRecord:f,inContext:!0,drawDefinition:h,matchUpsMap:M}).matchUps)?void 0:a[0]);if(N&&A&&function({tournamentId:e,inContextMatchUp:t}){t&&Ia({payload:{inContextMatchUp:t,tournamentId:e},topic:Rp,key:t.matchUpId})}({tournamentId:R,inContextMatchUp:A}),Array.isArray(T)&&A&&(null==(o=A.sides)||!o.every((({participantId:e})=>e))))if(v===Tc)p.processCodes=Qe([...p.processCodes??[],...T]);else for(let E of T||[]){let e=E&&(null==(s=null==p?void 0:p.processCodes)?void 0:s.lastIndexOf(E));null==(l=null==p?void 0:p.processCodes)||l.splice(e,1)}return Cp({eventId:null==y?void 0:y.eventId,context:d,drawDefinition:h,tournamentId:R,matchUp:p}),{...At}}function Wy(e){var t,i,n,r;let{matchUpStatusCodes:a,matchUpStatus:o,structure:s,matchUp:l,dualMatchUp:u,inContextMatchUp:d,autoCalcDisabled:c}=e,p=cv({matchUpStatus:o})||[wc,Uc].includes(o)&&u||c,m=(null==(t=null==l?void 0:l.sides)?void 0:t.map((e=>e.participantId)).filter(Boolean).length)||(null==(i=null==d?void 0:d.sides)?void 0:i.map((e=>e.participantId)).filter(Boolean).length),f="attemptToModifyScore";if(!(mf({structure:s})&&1===m||o===Tc&&m||function({structure:e,matchUp:t,inContextMatchUp:i}){var n;let{drawPositions:r}=t,{positionAssignments:a}=Jc({structure:e}),o=null==a?void 0:a.filter((e=>(null==r?void 0:r.includes(e.drawPosition))&&e.participantId)),s=null==(n=null==i?void 0:i.sides)?void 0:n.every((e=>e.participantId));return 2===(null==o?void 0:o.length)||s}({structure:s,matchUp:l,inContextMatchUp:d})||!1===(null==(r=null==(n=e.appliedPolicies)?void 0:n[cd])?void 0:r.requireParticipantsForScoring)))return La({result:{error:Ei},stack:f});let h=[kc].includes(o),v=p?o:e.winningSide&&Pc||Mc;return La({result:qy({...e,matchUpStatusCodes:p&&a||[],matchUpStatus:v,context:f,removeScore:h}),stack:f})}function Hy({collectionGroups:e=[]}){let t=Object.assign({},...e.filter((e=>Ye(null==e?void 0:e.groupValue)&&(null==e?void 0:e.groupNumber))).map((e=>({[e.groupNumber]:{...e,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))));return{groupValueGroups:t,groupValueNumbers:Object.keys(t).map((e=>Be(e)))}}function zy({collectionDefinition:e,groupValueNumbers:t,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter((t=>t.collectionId===e.collectionId)),o=[0,0],s=[0,0],l=a.every((e=>Vc.includes(e.matchUpStatus))),{collectionValueProfiles:u,collectionGroupNumber:d,collectionValue:c,matchUpValue:p,winCriteria:m,scoreValue:f,setValue:h}=e,v=d&&t.includes(d),g=[0,0];if(a.forEach((e=>{e.winningSide&&(g[e.winningSide-1]+=1)})),Ye(p)?a.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=p)})):Ye(h)?a.forEach((e=>{var t,i;null==(i=null==(t=e.score)?void 0:t.sets)||i.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=h)}))})):Ye(f)?a.forEach((e=>{var t,i;null==(i=null==(t=e.score)?void 0:t.sets)||i.forEach((t=>{let{side1TiebreakScore:i=0,side2TiebreakScore:n=0,side1Score:r=0,side2Score:a=0}=t;(e.matchUpStatus===Pc||e.winningSide||t.winningSide)&&(r||a?(o[0]+=r,o[1]+=a):(i||n)&&t.winningSide&&(o[t.winningSide-1]+=1))}))})):Array.isArray(u)&&a.forEach((t=>{if(t.winningSide){let i=t.collectionPosition,n=function({collectionDefinition:e,collectionPosition:t}){var i,n;return null==(n=null==(i=e.collectionValueProfiles||[])?void 0:i.find((e=>e.collectionPosition===t)))?void 0:n.matchUpValue}({collectionDefinition:e,collectionPosition:i});Ye(n)&&(o[t.winningSide-1]+=n)}})),Ye(c)){let t;if(null!=m&&m.aggregateValue)l&&(Ye(p||h||f)&&o[0]!==o[1]?t=o[0]>o[1]?1:2:g[0]!==g[1]&&(t=g[0]>g[1]?1:2));else if(null!=m&&m.valueGoal)t=o.reduce(((e,t,i)=>t>=m.valueGoal?i+1:e),0);else{let i=Math.floor(e.matchUpCount/2)+1;t=g.reduce(((e,t,n)=>t>=i?n+1:e),0)}t&&(v?i[d].values[t-1]+=c:s[t-1]+=c)}else v?(i[d].values[0]+=o[0]||0,i[d].values[1]+=o[1]||0):s=o;v?(i[d].sideWins[0]+=g[0]||0,i[d].sideWins[1]+=g[1]||0,i[d].allGroupMatchUpsCompleted=i[d].allGroupMatchUpsCompleted&&l,i[d].matchUpsCount+=a.length):s.forEach(((e,t)=>n[t]+=e||0))}function Yy(e){var t,i,n,r,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:u,structure:d,matchUp:c,event:p}=e;if(!Array.isArray(o)||2!==o.length||isNaN(o.reduce(((e,t)=>e+t))))return{error:Cr};if(!c)return{error:Ji};let m=(null==(t=nf({matchUp:c,drawDefinition:l,structure:d,event:p}))?void 0:t.tieFormat)||(null==e?void 0:e.tieFormat);if(!m)return{error:Wi};let f=Jo({tieFormat:m});if(f.error)return f;let h=(null==m?void 0:m.collectionDefinitions)||[],v=(null==c?void 0:c.tieMatchUps)??[],g=[0,0],{groupValueGroups:I,groupValueNumbers:U}=Hy(m);for(let T of h)zy({collectionDefinition:T,groupValueNumbers:U,groupValueGroups:I,sideTieValues:g,tieMatchUps:v});for(let T of U){let e,t=I[T],{allGroupMatchUpsCompleted:i,matchUpCount:n,winCriteria:r,groupValue:a,sideWins:o,values:s}=t;if(null!=r&&r.aggregateValue)i&&s[0]!==s[1]&&(e=s[0]>s[1]?1:2);else if(null!=r&&r.valueGoal)e=s.reduce(((e,t,i)=>t>=r.valueGoal?i+1:e),void 0);else{let t=Math.floor(n/2)+1;e=o.reduce(((e,i,n)=>i>=t?n+1:e),void 0)}e&&(g[e-1]+=a||0)}let y,S=g.map(((e,t)=>(e||0)+o[t])),w={side1Score:S[0],side2Score:S[1],winningSide:void 0},P=S.join(s),D=S.slice().reverse().join(s);if(null!=m&&m.winCriteria){let{valueGoal:e,aggregateValue:t,tallyDirectives:o}=m.winCriteria;if(e?y=null==(i=S.map(((e,t)=>({sideNumber:t+1,points:e}))).find((({points:t})=>t>=e)))?void 0:i.sideNumber:t&&v.every((e=>e.matchUpStatus&&Vc.includes(e.matchUpStatus)||e.winningSide))&&S[0]!==S[1]&&(y=S[0]>S[1]?1:2),!y&&o){let e=c.matchUpId,t=c.hasContext?c:(null==(n=null==u?void 0:u.drawMatchUps)?void 0:n[e])||l&&(null==(r=Vy({inContext:!0,drawDefinition:l,matchUpId:e}))?void 0:r.matchUp);if(t){let{completedTieMatchUps:e,order:i}=xy({matchUps:[t]});if(e&&null!=i&&i.length){let e=i[0].participantId;y=null==(a=t.sides.find((({participantId:t})=>t===e)))?void 0:a.sideNumber}}}}return y&&(w.winningSide=y),{scoreStringSide1:P,scoreStringSide2:D,winningSide:y,set:w}}function Ky({inContextDualMatchUp:e,drawDefinition:t,tournamentId:i,dualMatchUp:n,eventId:r}){var a,o;if(n){e||(e=null==(a=Vy({matchUpId:n.matchUpId,inContext:!0,drawDefinition:t}))?void 0:a.matchUp);let{extension:s}=Cd({element:t,name:qd}),l=ts((null==s?void 0:s.value)||{},!1,!0),u=({displaySideNumber:e,drawPosition:t,sideNumber:i})=>({drawPosition:t,sideNumber:i,displaySideNumber:e});n.sides=null==(o=null==e?void 0:e.sides)?void 0:o.map((e=>{var t;let i=e.participantId,r=i&&l[i]||void 0,{lineUp:a,...o}=(null==(t=n.sides)?void 0:t.find((({sideNumber:t})=>t===e.sideNumber)))??{},s=null!=a&&a.length?a:r;return{...u(e),...o,lineUp:s}})),Cp({context:"ensureSidLineUps",matchUp:n,drawDefinition:t,tournamentId:i,eventId:r})}}function Jy(e){if(e)return ts(e,!1,!0)}function Qy(e){let t=qu(e,[{[nu]:!0}]);return t.error?t:Object.keys(e.tournamentRecords).reduce(((t,i)=>{t.tournamentIdMap[i]=[];let n=e.tournamentRecords[i].events??[],r=n.map((({eventId:e})=>e)),a=n.map((e=>(e.drawDefinitions??[]).map((({drawId:e})=>e)))).flat();return t.tournamentIdMap[i].push(...r,...a),t.eventIds.push(...r),t.drawIds.push(...a),t}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Zy({tournamentRecords:e,eventId:t,drawId:i}){let{tournamentIdMap:n}=Qy({tournamentRecords:e});return(n?Object.keys(n):[]).find((e=>t&&(null==n?void 0:n[e].includes(t))||i&&(null==n?void 0:n[e].includes(i))))}function Xy(e){var t,i,n,r;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:u,matchUpId:d,event:c}=e,p=e.tournamentRecords||e.tournamentRecord&&{[null==(t=e.tournamentRecord)?void 0:t.tournamentId]:e.tournamentRecord}||{},m=e.tournamentId||(null==(i=e.tournamentRecord)?void 0:i.tournamentId);p&&Zy({tournamentRecords:p,...e});let f=m&&p[m];if(!f)return{error:Bt};let h=Vy({drawDefinition:o,event:c,matchUpId:d});if(h.error)return h;if(!h.matchUp)return{error:Yi};let{matchUp:v,structure:g}=h;if(!v.tieMatchUps)return{error:Qi};Ky({tournamentId:null==f?void 0:f.tournamentId,eventId:null==c?void 0:c.eventId,dualMatchUp:v,drawDefinition:o});let{extension:I}=Cd({name:_d,element:v});if(null!=I&&I.value){if(!l)return{...At,score:v.score};Ud({element:v,name:_d})}let U=null==(n=nf({drawDefinition:o,structure:g,matchUp:v,event:c}))?void 0:n.tieFormat;v.tieFormat=Jy(U);let y=Yy({drawDefinition:o,matchUpsMap:u,structure:g,matchUp:v,event:c}),{winningSide:S,set:w,scoreStringSide1:P,scoreStringSide2:D}=y,T=(null==w?void 0:w.side1Score)||(null==w?void 0:w.side2Score);if(a&&!v.score&&!T)return{...At};let b,R={scoreStringSide1:P,scoreStringSide2:D,sets:w?[w]:[]},N=S&&[1,2].includes(S),M=N&&Pc||mv({matchUpStatus:s??v.matchUpStatus,tieMatchUps:v.tieMatchUps,winningSide:v.winningSide,score:R})&&Nc||Oc,A=!(!v.winningSide||N),E=v.tieMatchUps.find((({score:e,winningSide:t,matchUpStatus:i})=>{var n;return(null==(n=null==e?void 0:e.sets)?void 0:n.length)&&(e.sets[0].side1Score||e.sets[0].side2Score)||i&&Vc.includes(i)||t}));if(v.tieFormat&&!N&&!E){let e=null==(r=nf({drawDefinition:o,structure:g,event:c}))?void 0:r.tieFormat;e&&JSON.stringify(U)===JSON.stringify(e)&&(v.tieFormatId=void 0,v.tieFormat=void 0,b=!0)}return qy({appliedPolicies:e.appliedPolicies,matchUpStatus:M,score:R,removeWinningSide:A,tournamentRecord:f,drawDefinition:o,removeScore:l,winningSide:S,matchUpId:d,matchUp:v,event:c}),{...At,score:R,removeWinningSide:A,tieFormatRemoved:b,winningSide:S}}function eS(e){var t;let i="directParticipants",n=Wy(e);if(n.error)return La({result:n,stack:i});let r,a=cv({matchUpStatus:e.matchUpStatus}),{dualWinningSideChange:o,projectedWinningSide:s,inContextDrawMatchUps:l,tournamentRecord:u,drawDefinition:d,matchUpStatus:c,dualMatchUp:p,matchUpsMap:m,winningSide:f,targetData:h,matchUpId:v,structure:g,matchUp:I,event:U}=e,y=!!I.collectionId,S=mf({structure:g}),w=I.drawPositions;if(y){let{matchUpTieId:n,matchUpsMap:a}=e,s=Xy({appliedPolicies:e.appliedPolicies,matchUpId:n,tournamentRecord:u,drawDefinition:d,matchUpsMap:a,event:U});if(r=s&&{tieMatchUpResult:s},w=null==(t=l.find((({matchUpId:e})=>e===n)))?void 0:t.drawPositions,!o)return La({result:{...At,...r},stack:i})}if(S)return La({result:{...At,...r},stack:i});if(!w)return La({result:{error:Xt},stack:i});{let e=s?s-1:f-1,t=1-e,n=w[e],r=w[t],{targetLinks:{loserTargetLink:o,winnerTargetLink:g,byeTargetLink:I},targetMatchUps:{winnerMatchUpDrawPositionIndex:y,loserMatchUpDrawPositionIndex:S,winnerMatchUp:P,loserMatchUp:D,byeMatchUp:T}}=h;if(P){let e=function({winnerMatchUpDrawPositionIndex:e,inContextDrawMatchUps:t,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:d,matchUpsMap:c,event:p}){var m,f,h,v,g;let I="directWinner";if(o){let i=u.drawPositions||[],d=i[e],h=o.source.structureId,v=Hc({structureId:h,drawDefinition:l});if(v.error)return v;let{structure:g}=v,{positionAssignments:U}=Jc({structureId:h,drawDefinition:l}),y=null==(m=null==U?void 0:U.find((e=>e.drawPosition===r)))?void 0:m.participantId,S=o.target.structureId,{positionAssignments:w}=Jc({structureId:S,drawDefinition:l}),P=null==(f=null==w?void 0:w.find((e=>e.participantId===y)))?void 0:f.drawPosition,D=null==w?void 0:w.filter((e=>{let t=i.includes(e.drawPosition),n=!e.participantId&&!e.bye&&!e.qualifier;return t&&n})).map((e=>e.drawPosition)),T=null==D?void 0:D.includes(d);if(y&&1===o.target.roundNumber&&T)rI({drawPosition:d,participantId:y,structureId:S,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:c,event:p});else if(y&&null!=D&&D.length){let e=D.pop();e&&rI({participantId:y,structureId:S,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:e,matchUpsMap:c,event:p})}else if(P){let e=Qg({drawPosition:P,matchUpId:u.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:c});if(e.error)return La({result:e,stack:I})}else if((null==g?void 0:g.stage)!==nl){let e="winner target position unavaiallble";return console.log(e),{error:e}}if(null!=g&&g.seedAssignments&&g.structureId!==S){let e=g.seedAssignments.find((({participantId:e})=>e===y)),t=null==e?void 0:e.participantId;e&&t&&Wg({eventId:null==u?void 0:u.eventId,structureId:S,...e,tournamentRecord:a,drawDefinition:l,participantId:t})}}else{let e=Qg({matchUpId:u.matchUpId,drawPosition:r,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:c});if(e.error)return e}if(d&&i){let e=null==(h=d.sides)?void 0:h.find((e=>e.sideNumber===i));if(null!=e&&e.lineUp){let t=d.roundPosition,i=u.roundPosition,n=t===i&&1!==t||Math.floor(t/2)===i?2:1,r=null==(v=null==c?void 0:c.drawMatchUps)?void 0:v.find((({matchUpId:e})=>e===u.matchUpId)),o=[1,2].map((e=>{var t;return{...(null==(t=r.sides)?void 0:t.find((t=>t.sideNumber===e)))||{},sideNumber:e}}));r.sides=o;let s=r.sides.find((e=>e.sideNumber===n));if(s){let t=null==(g=e.lineUp)?void 0:g.filter((e=>null==e?void 0:e.participantId));s.lineUp=Xg({lineUp:t}),Cp({tournamentId:null==a?void 0:a.tournamentId,eventId:null==u?void 0:u.eventId,matchUp:r,context:I,drawDefinition:l})}}}return{...At}}({sourceMatchUpStatus:a&&c||Pc,winnerMatchUpDrawPositionIndex:y,sourceMatchUpId:v,inContextDrawMatchUps:l,projectedWinningSide:s,winningDrawPosition:n,tournamentRecord:u,winnerTargetLink:g,drawDefinition:d,winnerMatchUp:P,dualMatchUp:p,matchUpsMap:m,event:U});if(e.error)return La({result:e,stack:i})}if(D){let e=function(e){var t,i,n;let{loserMatchUpDrawPositionIndex:r,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:u,loserTargetLink:d,drawDefinition:c,loserMatchUp:p,dualMatchUp:m,matchUpsMap:f,event:h}=e,v="directLoser",g=d.linkCondition,I=p.drawPositions||[],U=g===Dl&&2===p.roundNumber&&Math.min(...I.filter(Boolean)),y=U||I[r],S=U||I[1-r],w=d.source.structureId,{structure:P}=Hc({structureId:w,drawDefinition:c}),{matchUps:D}=jh({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:P,event:h}),T=D.filter((e=>{var t;return null==(t=e.drawPositions)?void 0:t.includes(l)})).filter((e=>{let t=e.sides.find((e=>e.drawPosition===l)),i=e.matchUpStatus===kc||e.matchUpStatus===Tc&&!dv(e);return(null==t?void 0:t.sideNumber)===e.winningSide&&!i})),b=g===Dl&&0===T.length,{positionAssignments:R}=Jc({structureId:w,drawDefinition:c}),N=null==(t=null==R?void 0:R.find((e=>e.drawPosition===l)))?void 0:t.participantId,M=d.target.structureId,{positionAssignments:A}=Jc({structureId:M,drawDefinition:c}),E=null==A?void 0:A.filter((({drawPosition:e})=>I.includes(e)));if(null!=E&&E.some((e=>e.participantId===N)))return{...At};let C=null==E?void 0:E.filter((e=>{let t=I.includes(e.drawPosition),i=!e.participantId&&!e.bye&&!e.qualifier;return t&&i})).map((e=>e.drawPosition)),O=null==C?void 0:C.includes(y),k=d.target.roundNumber>1&&(null==C?void 0:C.length),F=1===d.target.roundNumber&&O;if(U){let e=function(){let e="loserLinkFedFMLC";return La(b?{result:_(),stack:e}:{result:x(),stack:e})}();if(e.error)return La({result:e,stack:v})}else if(F){let e=_();if(e.error)return La({result:e,stack:v})}else{if(!N||!k)return La({context:{loserDrawPosition:l,loserTargetLink:d,targetDrawPositionIsUnfilled:O},result:{error:O?ii:ti},stack:v});{C.sort(Le);let e=C[0],t=rI({participantId:N,structureId:M,drawPosition:e,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:c,matchUpsMap:f,event:h});if(t.error)return La({result:t,stack:v})}}if(null!=P&&P.seedAssignments&&P.structureId!==M){let e=P.seedAssignments.find((({participantId:e})=>e===N)),t=null==e?void 0:e.participantId;e&&t&&Wg({eventId:null==p?void 0:p.eventId,structureId:M,...e,tournamentRecord:u,drawDefinition:c,participantId:t})}if(m&&o){let e=null==(i=m.sides)?void 0:i.find((e=>e.sideNumber===3-o));if(null!=e&&e.lineUp){let{roundNumber:t,eventId:i}=p,{roundPosition:r}=m,a=1===t?2-r%2:1,o=null==(n=null==f?void 0:f.drawMatchUps)?void 0:n.find((({matchUpId:e})=>e===p.matchUpId)),s=[1,2].map((e=>{var t;return{...(null==(t=o.sides)?void 0:t.find((t=>t.sideNumber===e)))||{},sideNumber:e}}));o.sides=s;let l=o.sides.find((e=>e.sideNumber===a));l&&(l.lineUp=Xg({lineUp:e.lineUp}),Cp({tournamentId:null==u?void 0:u.tournamentId,matchUp:o,context:v,drawDefinition:c,eventId:i}))}}return{...At};function x(){return La({result:yv({drawPosition:S,structureId:M,tournamentRecord:u,drawDefinition:c,event:h}),stack:"assignLoserPositionBye"})}function _(){return La({result:N?rI({drawPosition:y,participantId:N,structureId:M,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:c,matchUpsMap:f,event:h}):{error:xn},stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:a&&c||Pc,loserMatchUpDrawPositionIndex:S,sourceMatchUpId:v,inContextDrawMatchUps:l,projectedWinningSide:s,loserDrawPosition:r,tournamentRecord:u,loserTargetLink:o,drawDefinition:d,loserMatchUp:D,winningSide:f,matchUpsMap:m,dualMatchUp:p,event:U});if(e.error)return La({result:e,stack:i})}if(T){let e=T.drawPositions||[],t=yv({drawPosition:Math.min(...e.filter(Boolean)),structureId:I.target.structureId,tournamentRecord:u,drawDefinition:d,event:U});if(t.error)return La({result:t,stack:i})}}return La({result:{...At,...r},stack:i})}function tS(e){var t,i,n,r;let a="genPlayoffStructure";if(!e.drawDefinition)return La({result:{error:$t},stack:a});let o=QU(e);if(o.error)return La({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionNaming:d,finishingPositionLimit:c,playoffAttributes:p,playoffPositions:m,roundOffsetLimit:f,tournamentRecord:h,exitProfileLimit:v,roundProfiles:g,roundNumbers:I,idPrefix:U,isMock:y,event:S,uuids:w}=e,P=ts(e.drawDefinition,!1,!0),{structure:D}=Hc({structureId:s,drawDefinition:P});if(!D)return La({result:{error:Si},stack:a});if(D.structureType===vl||D.structures)return function(e){var t,i,n;let r="generateAndPopulateRRplayoffStructures";if(!e.playoffGroups)return La({result:{error:un},info:"playoffGroups required",stack:r});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:u,groupCount:d,groupSize:c,event:p}=e,m=ny({requireSequential:o,sourceStructureId:a,playoffGroups:u,groupCount:d,groupSize:c,...e});if(m.error)return La({result:m,stack:r});let{structures:f=[],links:h=[],finishingPositionTargets:v,positionRangeMap:g}=m,I=null==v?void 0:v.map((({finishingPositions:e})=>e)).flat().map((e=>g[e].finishingPositions)).flat();l.structures.push(...f),l.links.push(...h);let{matchUps:U,matchUpsMap:y}=Qh({inContext:!0,drawDefinition:l}),S=f.map((({structureId:e})=>e)),w=null==U?void 0:U.filter((({structureId:e})=>S.includes(e))).map(vc),P=null==(t=null==y?void 0:y.drawMatchUps)?void 0:t.filter((({matchUpId:e})=>null==w?void 0:w.includes(e)));if(null!=P&&P.length){let t=null==(i=nf({drawDefinition:l,event:p}))?void 0:i.tieFormat;t&&P.forEach((i=>{let{tieMatchUps:n}=ay({isMock:e.isMock,tieFormat:t,matchUp:i});Object.assign(i,{tieMatchUps:n,matchUpType:ke})}))}let{positionAssignments:D}=Kc({structureId:a,drawDefinition:l}),T={};null==D||D.forEach((e=>{var t,i,n;let r=null==(n=null==(i=null==(t=Cd({element:e,name:tc}))?void 0:t.extension)?void 0:i.value)?void 0:n.groupOrder;r&&(T[r]||(T[r]=[]),T[r].push(e.participantId))}));let b=qI({provisionalPositioning:e.provisionalPositioning,structureId:a,applyPositioning:!0,event:e.event,tournamentRecord:s,drawDefinition:l});return b.error&&(null==(n=b.error)?void 0:n.code)!==zt.code?La({result:b,stack:r}):{structures:f,links:h,positionsPlayedOff:I,drawDefinition:l,...At}}({sourceStructureId:D.structureId,...e,...o,drawDefinition:P});let{playoffRoundsRanges:T,playoffRounds:b}=o,{playoffPositionsReturned:R,error:N,playoffSourceRounds:M,playoffRoundsRanges:A}=JU(e);if(N)return La({result:{error:N},stack:a});let E=(null==g?void 0:g.length)&&Object.assign({},...g),C=I||"object"==typeof g&&g.map((e=>Object.keys(e))).flat(),O=Array.isArray(C)&&C.map((e=>!isNaN(e)&&Be(e))).filter(Boolean);if(O){if(!Array.isArray(O))return La({result:{error:Cr},context:{validRoundNumbers:O},stack:a});O.forEach((e=>{if(null==b||!b.includes(e))return La({result:{error:Cr},context:{roundNumber:e},stack:a})}))}m&&m.forEach((e=>{if(null==R||!R.includes(e))return La({result:{error:Cr},context:{playoffPosition:e},stack:a})}));let k=O||M,F=O?T:A,x=[],_=[];for(let z of k??[]){let e=null==F?void 0:F.find((e=>e.roundNumber===z));if(!e)return La({result:{error:Cr},context:{roundNumber:z},stack:a});let t=e.finishingPositions.length,i=Math.min(...e.finishingPositions)-1,n=2,r=z&&(null==E?void 0:E[z])&&n+E[z]-1,o=qU({exitProfile:`0-${z}`,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionOffset:i,playoffAttributes:p,exitProfileLimit:v,stage:ol,roundOffset:0,drawDefinition:P,sequenceLimit:r,stageSequence:n,drawSize:t,idPrefix:U,isMock:y,uuids:w,finishingPositionNaming:d,finishingPositionLimit:c,roundOffsetLimit:f});if(o.error)return La({result:o,stack:a});let{structures:m,links:h}=o;if(null!=m&&m.length&&x.push(...m),null!=h&&h.length&&_.push(...h),o.structureId&&z){let e={linkType:Pl,source:{structureId:s,roundNumber:z},target:{structureId:o.structureId,feedProfile:Ul,roundNumber:1}};_.push(e)}}if(!x.length)return La({result:{error:Cr},info:"No structures generated",stack:a});P.structures.push(...x),P.links.push(..._);let{matchUps:L,matchUpsMap:B}=Qh({inContext:!0,drawDefinition:P}),V=x.map((({structureId:e})=>e)),j=null==L?void 0:L.filter((({structureId:e})=>V.includes(e))).map(vc),G=null==(t=null==B?void 0:B.drawMatchUps)?void 0:t.filter((({matchUpId:e})=>null==j?void 0:j.includes(e)));if(null!=G&&G.length){let e=null==(i=nf({drawDefinition:P,event:S}))?void 0:i.tieFormat;e&&G.forEach((t=>{let{tieMatchUps:i}=ay({matchUp:t,tieFormat:e,isMock:y});Object.assign(t,{tieMatchUps:i,matchUpType:Fe})}))}null==(n=null==L?void 0:L.filter((e=>Gh({matchUp:e})&&e.structureId===s)))||n.forEach((e=>{let{matchUpId:t,score:i,winningSide:n}=e,r=zh({inContextDrawMatchUps:L,drawDefinition:P,matchUpId:t}),a=eS({inContextDrawMatchUps:L,tournamentRecord:h,drawDefinition:P,matchUpsMap:B,winningSide:n,targetData:r,matchUpId:t,structure:D,matchUp:e,score:i,event:S});a.error&&console.log(a.error)})),null==(r=null==L?void 0:L.filter((e=>e.matchUpStatus===Sc&&e.structureId===s)))||r.forEach((e=>{let{matchUpId:t}=e,i=zh({inContextDrawMatchUps:L,drawDefinition:P,matchUpId:t}),{targetLinks:{loserTargetLink:n},targetMatchUps:{loserMatchUpDrawPositionIndex:r,loserMatchUp:a}}=i;if(n&&a){let e=n.target.structureId,t=yv({drawPosition:a.drawPositions[r],structureId:e,tournamentRecord:h,drawDefinition:P,event:S});t.error&&console.log(t.error)}}));let $=[],q=lv({inContextDrawMatchUps:L,drawDefinition:P,matchUpsMap:B}).goesToMap,{structure:W}=Hc({drawDefinition:e.drawDefinition,structureId:s}),{matchUps:H}=jh({structure:W});return H.forEach((t=>{var i,n;let r=null==q?void 0:q.loserMatchUpIds[t.matchUpId];if(r&&t.loserMatchUpId!==r){t.loserMatchUpId=r;let n={tournamentId:null==h?void 0:h.tournamentId,eventId:null==(i=e.event)?void 0:i.eventId,context:a,matchUp:t};$.push(n)}let o=null==q?void 0:q.winnerMatchUpIds[t.matchUpId];if(o&&t.winnerMatchUpId!==o){t.winnerMatchUpId=o;let i={tournamentId:null==h?void 0:h.tournamentId,eventId:null==(n=e.event)?void 0:n.eventId,context:a,matchUp:t};$.push(i)}})),{structures:x,matchUpModifications:$,links:_,drawDefinition:P,...At}}function iS({element:e}){if(!e)return{error:Cr};if(!e.timeItems)return{};if(!Array.isArray(e.timeItems))return{error:Cr};return e.timeItems.reduce((t="itemType",i="itemValue",(e,n)=>(n[t]&&(e[n[t]]=n[i]),e)),{});var t,i}function nS(e){let{duplicateValues:t=!0,creationTime:i=!0,removePriorValues:n,timeItem:r}=e;if(!r)return{error:Ir};let a=rm(e);if(a.error)return a;if(!(wt(r)&&St(r.itemType)&&Object.keys(r).includes("itemValue")))return{error:vr};if(a.timeItems){if(function({element:e,duplicateValues:t,timeItem:i}){var n;let{itemType:r,itemSubTypes:a,itemValue:o}=i,s=r&&(null==(n=am({itemSubTypes:a,itemType:r,element:e}))?void 0:n.timeItem);return s&&JSON.stringify(null==s?void 0:s.itemValue)===JSON.stringify(o)&&!t}({element:a,duplicateValues:t,timeItem:r}))return{...At}}else a.timeItems=[];if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let e=(new Date).toISOString();Object.assign(r,{createdAt:e})}return n&&(a.timeItems=a.timeItems.filter((({itemType:e})=>r.itemType!==e))),n&&!r.itemValue||a.timeItems.push(r),{...At}}function rS({creationTime:e=!0,removePriorValues:t,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:Bt};if(!r)return{error:xn};let o=nm({tournamentRecord:i,participantId:r});return o.error?o:nS({element:o.participant,removePriorValues:t,duplicateValues:n,creationTime:e,timeItem:a})}function aS(e){let{removePriorValues:t,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=e;if(!i)return{error:Bt};let o=nS({element:i,removePriorValues:t,duplicateValues:n,creationTime:r,timeItem:a});if(o.error)return o;let s=iS({element:i});return Ia({payload:{parentOrganisation:i.parentOrganisation,tournamentId:i.tournamentId,timeItemValues:s},topic:vp}),o}function oS(e){let{removePriorValues:t,duplicateValues:i,creationTime:n,timeItem:r,event:a}=e;return a?nS({removePriorValues:t,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Ri}}function sS(e){return uS({...e,itemType:"attachConsolationStructures"})}function lS(e){return uS({...e,itemType:"attachPlayoffStructures"})}function uS({itemType:e="attachStructures",matchUpModifications:t,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:o}){var s,l,u;let d="attachStructures";if(!n)return{error:$t};if(!Array.isArray(r)||!Array.isArray(a))return La({result:{error:Cr},stack:d});let c=e=>{var t;return[e.source.structureId,e.source.roundNumber||(null==(t=e.source.finishingPositions)?void 0:t.join("|")),e.target.roundNumber].join("|")},p=null==(s=n.links)?void 0:s.map(c);if(a.some((e=>{let t=c(e);return null==p?void 0:p.includes(t)})))return La({result:{error:Wr},info:"playoff structure exists",stack:d});a.length&&(null==(l=n.links)||l.push(...a));let m=r.map((({structureId:e})=>e)),f=null==(u=n.structures)?void 0:u.map((({structureId:e})=>e));n.structures=(n.structures??[]).map((e=>m.includes(e.structureId)?r.find((({structureId:t})=>t===e.structureId)):e));let h=null==r?void 0:r.filter((({structureId:e})=>!(null!=f&&f.includes(e))));h.length&&n.structures.push(...h),lv({drawDefinition:n});let v=r.map((e=>{var t;return(null==(t=jh({structure:e}))?void 0:t.matchUps)||[]})).flat();Ap({tournamentId:null==i?void 0:i.tournamentId,eventId:null==o?void 0:o.eventId,drawDefinition:n,matchUps:v});let g=r.map((({structureId:e})=>e));if(kp({drawDefinition:n,structureIds:g}),null==t?void 0:t.length){let e={};t.forEach((t=>{var i;let n=null==(i=t.matchUp)?void 0:i.matchUpId;n&&(e[n]=t)}));let i=t=>{t.matchUps.forEach((t=>{if(e[t.matchUpId]){let{tieMatchUps:i,...n}=e[t.matchUpId].matchUp;if(Object.assign(t,n),null==i?void 0:i.length){let n={};i.forEach((t=>e[t.matchUpId]=t)),t.tieMatchUps.forEach((e=>Object.assign(e,n[e.matchUpId])))}e[t.matchUpId].matchUp=t,Cp(e[t.matchUpId])}}))};n.structures.forEach((e=>{if(null!=f&&f.includes(e.structureId))if(e.structures)for(let t of e.structures)i(t);else i(e)}))}let I=h.map(ov("structureId"));if(i){nS({element:i,timeItem:{itemValue:{structureIds:g,drawId:n.drawId},itemType:e}})}return{...At,addedStructureIds:I}}function dS(e){var t,i;let{structures:n,links:r,matchUpModifications:a,error:o}=tS(e);if(o)return{error:o};let s=e.drawDefinition;return lS({tournamentId:null==(t=e.tournamentRecord)?void 0:t.tournamentId,eventId:(null==(i=e.event)?void 0:i.eventId)||e.eventId,matchUpModifications:a,drawDefinition:s,structures:n,links:r})}function cS(e){let t=qu(e,[{_anyOf:{[nu]:!1,[au]:!1,[su]:!1,[Au]:!1},[ru]:!0}]);if(t.error)return t;let i=[],n=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(n){let t=pS(e,n);if(t.error)return t;i.push(...(null==t?void 0:t.applied)??[]),e.drawDefinition&&kp({drawDefinition:e.drawDefinition,tournamentId:e.tournamentId})}else{if(!e.tournamentRecords)return{error:Bt};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:Bt};for(let n of t){let t=pS(e,e.tournamentRecords[n]);if(t.error)return t;i.push(...(null==t?void 0:t.applied)??[])}}}return i.length?{...At,applied:i}:{error:rn}}function pS(e,t){let i=gm(e).appliedPolicies??{};t.extensions||(t.extensions=[]);let n=[],r=Object.keys(e.policyDefinitions);if(!r.length)return{error:Xi};for(let a of r)if(!i[a]||e.allowReplacement){let t=e.policyDefinitions[a];if(!t)continue;if(!wt(t))return{error:Cr};let{policyName:r,...o}=t;if(!o||!Object.keys(o).length||r&&!St(r))return{error:Cr};i[a]=e.policyDefinitions[a],n.push(a)}return null!=n&&n.length?{...Sd({element:t,extension:{name:Od,value:i}}),applied:n}:{applied:n,error:rn}}function mS({tournamentRecord:e,drawDefinition:t,flightProfile:i,drawName:n,drawId:r,event:a}){var o;if(!n||"string"!=typeof n)return La({result:{error:Cr},context:{drawName:n}});i||(i=Eh({event:a}).flightProfile);let s=null==(o=null==i?void 0:i.flights)?void 0:o.find((e=>e.drawId===r));if(s){s.drawName=n,Dd({event:a,extension:{name:Gd,value:{...i,flights:i.flights}}})}return t&&(t.drawName=n,kp({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:t})),s||t?{...At,flight:s}:{error:$t}}function fS({tournamentRecord:e,drawDefinition:t,drawUpdates:i,drawId:n,event:r}){var a;if(!wt(i))return{error:Cr};let o=Eh({event:r}).flightProfile,s=i.drawName&&mS({drawName:i.drawName,tournamentRecord:e,drawDefinition:t,flightProfile:o,drawId:n,event:r});if(null!=s&&s.error)return null==s?void 0:s.error;let l=(null==s?void 0:s.flight)||(null==(a=null==o?void 0:o.flights)?void 0:a.find((e=>e.drawId===n)));if(!l&&!t)return{error:$t};if(l){Dd({event:r,extension:{name:Gd,value:{...o,flights:o.flights}}})}return t&&(i.policyDefinitions&&cS({policyDefinitions:i.policyDefinitions,drawDefinition:t}),kp({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:t})),{...At}}function hS({tournamentRecord:e,removeScheduling:t,drawDefinition:i}){var n,r;if(!i)return{error:$t};let a=rf({drawDefinition:i}),o=e=>{var t;return null==(t=null==a?void 0:a.drawMatchUps)?void 0:t.find((t=>t.matchUpId===e))};for(let s of i.structures||[]){let{positionAssignments:l,stage:u,stageSequence:d}=s;l&&(1!==d||![nl,il].includes(u))&&(s.positionAssignments=l.map((e=>(delete e.participantId,e))),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:p}=jh({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:s});for(let a of c){let{matchUpId:s,roundNumber:l}=a,u=a.sides||[],d=o(s);if(d){if(delete d.extensions,delete d.notes,d.matchUpStatus!==Sc&&Object.assign(d,$y),l&&l>1&&(null==(n=d.drawPositions)?void 0:n.length)&&!p){let e=null==u?void 0:u.map((({drawPosition:e,participantFed:t})=>!t&&e)).filter(Boolean),t=d.drawPositions.map((t=>e.includes(t)?void 0:t));d.drawPositions=t}t?delete d.timeItems:null!=(r=d.timeItems)&&r.length&&(d.timeItems=d.timeItems.filter((e=>e.itemType&&![bf,Rf,Tf,Ef,Mf,Cf].includes(e.itemType)))),Cp({tournamentId:null==e?void 0:e.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:d})}}}return i.extensions=i.extensions.filter((e=>e.name!==Kd)),kp({drawDefinition:i,structureIds:(i.structures||[]).map((({structureId:e})=>e))}),{...At}}function vS({tournamentRecord:e}){var t;if(!e)return{error:Bt};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={};return(null==(t=e.events)?void 0:t.map((e=>{let t=e.eventId;return n[t]=e,((null==e?void 0:e.drawDefinitions)||[]).map((e=>({drawDefinition:e,eventId:t})))})).flat().filter(Boolean)).forEach((({drawDefinition:e,eventId:t})=>{let r=0,a=0,o=0,{allStructuresLinked:s}=HI({drawDefinition:e}),l=n[t],u=((null==e?void 0:e.structures)||[]).map((t=>{let{stage:i,stageSequence:n,structureId:s}=t,u=ll[i],{inContextStructureMatchUps:d}=fv({drawDefinition:e,structure:t,event:l}),c=null==d?void 0:d.filter((({winningSide:e})=>e)),p=c.filter(Boolean).length||0;a+=p,o+=d.length-a;let m=Math.max(c.filter((({roundNumber:e})=>1===e)).map((({roundPosition:e})=>e))),{positionAssignments:f}=Kc({structure:t}),h=null==f?void 0:f.filter((({participantId:e})=>e));r+=(null==h?void 0:h.length)??0;let v=((null==f?void 0:f.length)??0)-((null==h?void 0:h.length)??0),{roundMatchUps:g,roundProfile:I,roundNumbers:U,maxMatchUpsCount:y}=uf({matchUps:d}),S=I&&Object.keys(I).filter((e=>!I[e].inactiveRound)).map((e=>parseInt(e))),w=I&&Object.keys(I).filter((e=>I[e].inactiveRound)).map((e=>parseInt(e))),P=I&&Object.values(I).every((e=>e.inactiveRound));return{positionsAssignedCount:(null==h?void 0:h.length)??0,maxWinningSideFirstRoundPosition:m,unassignedPositionsCount:v,inactiveStructure:P,maxMatchUpsCount:y,inactiveRounds:w,roundMatchUps:g,activeRounds:S,roundNumbers:U,roundProfile:I,structureId:s,stageSequence:n,orderNumber:u,stage:i}})),d=u.find((e=>2===e.orderNumber&&1===e.stageSequence)),c=u.filter((({inactiveStructure:e})=>!e)).length,{links:p}=Wh({structureId:d.structureId,drawDefinition:e}),m=1===Be(d.activeRounds[0])&&1===d.activeRounds.length&&1===c,f=null==u?void 0:u.every((({inactiveStructure:e})=>e)),h=!p.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),v=e.drawId;r&&!a&&i.positionsNoOutcomes.push(v),f&&i.inactive.push(v),m&&i.matchPlay.push(v),h&&i.canBePruned.push(v);let g={matchUpsWithWinningSideCount:a,matchUpsNoOutcomeCount:o,positionsAssignedCount:r,allStructuresLinked:s,structuresData:u,inactiveDraw:f,isMatchPlay:m,drawId:v};i.drawAnalysis[v]=g})),{...At,drawsAnalysis:i}}function gS({matchPlayDrawPositions:e=!0,tournamentRecord:t,drawDefinition:i,drawId:n}){var r;if(!t)return{error:Bt};if(!i)return{error:$t};let a=[],{drawsAnalysis:o}=vS({tournamentRecord:t});if(o.canBePruned.includes(n)){let s=o.matchPlay.includes(n),l=o.drawAnalysis[n],{structures:[u]}=zc({stageSequence:1,drawDefinition:i,stage:il}),d=l.structuresData.find((({structureId:e})=>u.structureId===e)),c=(u.matchUps??[]).sort(((e,t)=>e.roundPosition-t.roundPosition));a=c.filter((({roundNumber:e})=>!d.inactiveRounds.includes(e)));let p=a.map(vc),m=c.map(vc).filter((e=>!p.includes(e)));if(s){let t=a.filter((({roundNumber:e})=>!d.inactiveRounds.includes(e))).filter((({winningSide:e})=>e)),i=t.map(vc),n=p.filter((e=>!i.includes(e)));m.push(...n);let o=t.flatMap((e=>e.drawPositions??[])).filter(Boolean).flat(),s=Object.assign({},...o.map(((e,t)=>({[e]:t+1}))));if(t.forEach((t=>{e?t.drawPositions=t.drawPositions.map((e=>s[e])):delete t.drawPositions})),e){let e=null==(r=null==u?void 0:u.positionAssignments)?void 0:r.filter((e=>o.includes(e.drawPosition))).map((e=>(e.drawPosition=s[e.drawPosition],e)));u.positionAssignments=e}else u.positionAssignments=[];u.matchUps=t,a=t}Ep({tournamentId:null==t?void 0:t.tournamentId,matchUpIds:m,drawDefinition:i}),kp({drawDefinition:i})}return{...At,matchUps:a}}function IS({tournamentRecord:e,drawDefinition:t,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:o,bye:s}){if(!t)return{error:$t};if(!n)return{error:ni};if(!r)return{error:yi};if(s){let i=yv({tournamentRecord:e,drawDefinition:t,drawPosition:n,structureId:r,event:o});if(i.error)return i}else{if(a)return{error:Br};{let a=rI({tournamentRecord:e,drawDefinition:t,participantId:i,drawPosition:n,structureId:r,event:o});if(a.error)return a}}return{...At}}function US(e){var t,i,n,r,a;let o=e.matchUpIds??[],{drawDefinition:s}=e,l=e.structureId??(null==(i=null==(t=null==s?void 0:s.structures)?void 0:t.find((e=>{var t;return null==(t=e.matchUps)?void 0:t.some((({matchUpId:e})=>o.includes(e)))})))?void 0:i.structureId)??(null==(r=null==(n=null==s?void 0:s.structures)?void 0:n[0])?void 0:r.structureId);if(!l)return{error:Si};let u=null==(a=s.structures)?void 0:a.find((e=>e.structureId===l));if(!u)return{error:Si};let d=null==u?void 0:u.matchUps,c=null==d?void 0:d.find((e=>!!e.roundPosition));if(u.structures||c||u.finishingPosition===Xl)return{error:Ht};let p=d.filter((({roundNumber:t})=>{var i;return null==(i=e.roundNumbers)?void 0:i.includes(t)})).map(vc);return o=o.filter((e=>!p.includes(e))),e.roundNumbers&&!o.length&&(o=p),{existingMatchUps:d,matchUpIds:o,structureId:l,structure:u}}function yS(e){let t=qu(e,[{[su]:!0},{[Vu]:{[fu]:!1,roundNumbers:!1},[_u]:Cr,[Lu]:ku}]);if(t.error)return t;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:o,event:s}=e,l=US(e);if(l.error)return l;let{structure:u,structureId:d,existingMatchUps:c,matchUpIds:p}=l,m=[],f=(null==c?void 0:c.filter((({matchUpId:e,score:t,winningSide:a})=>{if(a&&!r)return!1;if(a||dv({score:t})){if(!a&&!i)return!1;m.push(e)}else if(!n)return!1;return null==p?void 0:p.includes(e)})))??[],h=f.map(vc),v=f.map((({tieMatchUps:e})=>null==e?void 0:e.map(vc))).filter(Boolean).flat();if(h.length){u.matchUps=(u.matchUps??[]).filter((({matchUpId:e})=>!h.includes(e))),Ep({tournamentId:null==a?void 0:a.tournamentId,matchUpIds:[...v,...h],action:"deleteAdHocMatchUps",eventId:null==s?void 0:s.eventId,drawDefinition:o});let e=function(e,t=1){return Array.isArray(e)&&e.every(Ye)?lt(Math.min(...e,t),Math.max(...e)+1).filter((t=>!e.includes(t))):[]}(Qe(u.matchUps.map(ov("roundNumber"))));if(e.length){e.reverse();for(let t of e)u.matchUps.forEach((e=>{e.roundNumber&&e.roundNumber>t&&(e.roundNumber-=1,Cp({tournamentId:null==a?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:null==s?void 0:s.eventId,drawDefinition:o,matchUp:e}))}))}if(m.length){u.positionAssignments=Qe(u.matchUps.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})));let e=(null==u?void 0:u.matchUpFormat)??(null==o?void 0:o.matchUpFormat)??(null==s?void 0:s.matchUpFormat),t=l.existingMatchUps.some((e=>e.matchUpType===ke))?{matchUpTypes:[ke]}:void 0,{matchUps:i}=jh({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:t,structure:u,event:s});mf({structure:u})&&(u.positionAssignments=Qe(i.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e}))));let n=Ly({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:e,matchUps:i,event:s});n.error&&console.log(n)}kp({structureIds:[d],eventId:null==s?void 0:s.eventId,drawDefinition:o})}return!h.length&&p.length?{error:Yr}:{...At,deletedMatchUpsCount:[...h,...v].length}}function SS({removeCompletedMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!t)return{error:Bt};if(!i)return{error:$t};if(!r)return La({result:{error:un},info:"roundNumber required"});let o=Hc({drawDefinition:i,structureId:n});if(o.error)return o;let s=o.structure;return null!=s&&s.structures?{error:Ht}:mf({structure:s})?function({removeCompletedMatchUps:e,drawDefinition:t,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let o=(null==r?void 0:r.matchUps)??[],s=[],l=[],u=!1;if(o.reduce(((e,t)=>{let i=null==t?void 0:t.roundNumber;return i?e.includes(i)?e:e.concat(i):e}),[]).sort(Le).includes(n)){let d=o.filter((t=>{let i=t.roundNumber===n&&(!Vc.includes(t.matchUpStatus)||e);return i&&(l.push(t.matchUpId),t.tieMatchUps&&s.push(...t.tieMatchUps.map(vc))),!i}));l.length&&(Ep({matchUpIds:[...s,...l],drawDefinition:t,tournamentId:i,eventId:a}),d.some((e=>e.roundNumber===n))||(d.forEach((e=>{e.roundNumber>n&&(e.roundNumber-=1,Cp({drawDefinition:t,tournamentId:i,eventId:a,matchUp:e}))})),u=!0),r.matchUps=d)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...At}}({tournamentId:t.tournamentId,removeCompletedMatchUps:e,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...At})}function wS(e){var t,i,n,r,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:u,matchUps:d,event:c}=e;if("object"!=typeof u)return{error:$t};let p=null==e?void 0:e.structureId;if(!p&&1===(null==(t=u.structures)?void 0:t.length)&&(p=null==(n=null==(i=u.structures)?void 0:i[0])?void 0:n.structureId),"string"!=typeof p)return{error:yi};if(!lf(d))return{error:Cr,info:eI("matchUps")};let m=null==(r=u.structures)?void 0:r.find((e=>e.structureId===p));if(!m)return{error:Si};let f=(null==m?void 0:m.matchUps).find((e=>!!e.roundPosition));if(m.structures||f||m.finishingPosition===Xl)return{error:Ht};if(pt((null==(o=null==(a=ev({tournamentRecord:l,inContext:!1}))?void 0:a.matchUps)?void 0:o.map(vc))??[],d.map(vc)))return{error:$r,info:"One or more matchUpIds already present in tournamentRecord"};m.matchUps.push(...d);let h=d.map((({tieMatchUps:e})=>e)).filter(Boolean).flat();return s||(Ap({tournamentId:null==l?void 0:l.tournamentId,matchUps:[...h,...d],eventId:null==c?void 0:c.eventId,drawDefinition:u}),kp({drawDefinition:u,structureIds:[p]})),{...At}}function PS({tournamentRecord:e,drawDefinition:t,drawPosition:i,structureId:n,subOrder:r,event:a}){var o;if(!t)return{error:$t};if(!n)return{error:yi};if(!i)return{error:ni};let{structure:s}=Hc({drawDefinition:t,structureId:n});if(!s)return{error:Si};let l=s;s.structures&&s.structureType===vl&&(l=null==(o=s.structures)?void 0:o.find((e=>{var t;return null==(t=e.positionAssignments)?void 0:t.find((e=>e.drawPosition===i))})));let u=null==l?void 0:l.positionAssignments,d=null==u?void 0:u.find((e=>e.drawPosition===i));d&&Sd({element:d,extension:{name:ec,value:r}});let c=((null==a?void 0:a.eventType)===Fe||t.matchUpType===Fe||((null==a?void 0:a.tieFormat)??(null==t?void 0:t.tieFormat)??(null==s?void 0:s.tieFormat)))&&{matchUpTypes:[Fe]},{matchUps:p}=jh({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a});return Ly({positionAssignments:u,tournamentRecord:e,drawDefinition:t,matchUpFormat:(null==s?void 0:s.matchUpFormat)??t.matchUpFormat,matchUps:p,event:a}),kp({drawDefinition:t,structureIds:[n]}),{...At}}var DS={};function TS({excludedMatchUpStatuses:e=[],includeEventParticipants:t,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:d,allEntries:c,winsLimit:p,event:m}){var f,h,v,g,I;if(!s)return{error:$t};let U=[il,ol];i&&U.push(nl);let y=null!=m&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,S=null!=s&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=t&&m?(null==(f=Xh({contextFilters:{stages:U},matchUpFilters:y,tournamentRecord:o,inContext:!0,event:m}))?void 0:f.matchUps)??[]:(null==(h=nv({contextFilters:{stages:U},matchUpFilters:S,tournamentRecord:o,inContext:!0,drawDefinition:s}))?void 0:h.matchUps)??[],P=Zm({stage:al,drawDefinition:s}).map((({participantId:e})=>e)),D={},T={},b={},R={};r||(r=Im({policyTypes:[ed],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let N=null==r?void 0:r[ed];e=e.length&&e||(null==N?void 0:N.excludedMatchUpStatuses)||[],t=t??(null==N?void 0:N.includeEventParticipants),c=c??(null==N?void 0:N.allEntries),n=n??(null==N?void 0:N.finishingRoundLimit),a=a??(null==N?void 0:N.roundNumberLimit),l=l??(null==N?void 0:N.matchUpsLimit),void 0===u&&(u=void 0===(null==N?void 0:N.requirePlay)||N.requirePlay),void 0===d&&(d=void 0===(null==N?void 0:N.requireLoss)||N.requireLoss),p=p??(null==N?void 0:N.winsLimit);for(let O of w){if(u&&O.winningSide&&![1,2].includes(O.winningSide)&&O.matchUpStatus!==Rc||O.finishingRound&&n&&O.finishingRound>=n||O.finishingRound&&a&&O.finishingRound<=a)continue;let t=null==(v=O.sides)?void 0:v.find((({sideNumber:e})=>O.winningSide&&e===3-O.winningSide)),i=null==(g=O.sides)?void 0:g.find((({sideNumber:e})=>O.winningSide&&e===O.winningSide));if(null==(I=O.sides)||I.forEach((t=>{var i;let n=null==(i=null==t?void 0:t.participant)?void 0:i.participantId;n&&(b[n]=t.participant,O.matchUpStatus===Rc&&!u&&(T[n]=t.participant,D[n]||(D[n]=0),(!O.matchUpStatus||!e.includes(O.matchUpStatus))&&(D[n]+=1)))})),null==t?void 0:t.participant){let i=t.participant.participantId;T[i]=t.participant,D[i]||(D[i]=0),O.matchUpStatus&&!e.includes(O.matchUpStatus)&&(D[i]+=1)}if(null!=i&&i.participant){let t=i.participant.participantId;R[t]||(R[t]=0),R[t]+=1,D[t]||(D[t]=0),O.matchUpStatus&&!e.includes(O.matchUpStatus)&&(D[t]+=1)}}let M=(null==o?void 0:o.participants)&&!u&&!d&&c,A=M?((t&&m?m.entries:s.entries)??[]).filter((e=>![$m,Vm].includes(e.entryStatus))).map((({participantId:e})=>e)):[],E=Object.keys(T),C=M?((null==o?void 0:o.participants)??[]).filter((({participantId:e})=>A.includes(e))):d&&Object.values(T)||Object.values(b);return{eligibleParticipants:C.filter((e=>(e=>!d||E.includes(e))(e.participantId)&&(e=>!u||(D[e]||0)>=0)(e.participantId)&&(e=>!p||(R[e]||0)<=p)(e.participantId)&&(e=>!l||D[e]<=l)(e.participantId)&&(e=>!P.includes(e))(e.participantId))).map((e=>{var t;return{...e,individualParticipants:null==(t=e.individualParticipantIds)?void 0:t.map((e=>{var t;return null==(t=null==o?void 0:o.participants)?void 0:t.find((t=>t.participantId===e))}))}})),losingParticipantIds:E,...At}}function bS(e){var t,i,n,r,a,o,s,l;let u=qu(e,[{drawDefinition:!0}]);if(u.error)return u;let{drawDefinition:d,roundNumber:c}=e,p=e.structureId??(1===(null==(t=d.structures)?void 0:t.length)&&(null==(n=null==(i=d.structures)?void 0:i[0])?void 0:n.structureId));if("string"!=typeof p)return{error:yi};let m=null==(r=d.structures)?void 0:r.find((e=>e.structureId===p));if(!m)return{error:Si};let f,h=null==(a=m.matchUps??[])?void 0:a.reduce(((e,t)=>(t.roundPosition&&(f=!0),((null==t?void 0:t.roundNumber)||0)>e?t.roundNumber:e)),0);if(m.structures||f||m.finishingPosition===Xl)return{error:Ht};let v=(null==(o=null==d?void 0:d.entries)?void 0:o.filter((e=>{let t=e.entryStatus;return zm.includes(t)})))??[],g=Math.floor((null==v?void 0:v.length)/2)||1,I=c??h??1,U=g-((null==(l=null==(s=m.matchUps)?void 0:s.filter((e=>e.roundNumber===I)))?void 0:l.length)??0),y=U>0?U:0;return{...At,availableMatchUpsCount:y,lastRoundNumber:h,roundMatchUpsCount:g}}function RS({drawDefinition:e}){var t;let i=Cd({name:"participantRepresentatives",element:e});return i.error?i:{representativeParticipantIds:(null==(t=i.extension)?void 0:t.value)||[]}}function NS({byeAdvancements:e=!1,tournamentRecord:t,drawDefinition:i}){if(!i)return{error:$t};let{participantIds:n,participantIdMatchUps:r}=function({tournamentParticipants:e,drawDefinition:t,event:i}){if(!t)return{error:$t};let n=ts(Qh({tournamentParticipants:e,inContext:!0,drawDefinition:t,event:i}).matchUps,!1,!0),r=Qe(n.reduce(((e,t)=>e.concat(...t.sides.map((e=>e.participantId)).filter(Boolean))),[])),a=Object.assign({},...r.map((e=>{let t=n.filter((t=>t.sides.map((e=>e.participantId)).filter(Boolean).includes(e)));return{[e]:t}})));return{participantIds:r,participantIdMatchUps:a}}({tournamentParticipants:null==t?void 0:t.participants,drawDefinition:i}),a=(null==n?void 0:n.map((t=>{let i=r[t].filter((e=>[Pc,Sc].includes(e.matchUpStatus)||e.winningSide)),n=i.map((i=>{let n=i.sides.find((e=>e.bye)),r=i.sides.find((e=>e.participantId===t)).sideNumber;return(i.winningSide||e&&n&&r)===r?i.finishingPositionRange.winner:i.finishingPositionRange.loser})),a=e=>Math.abs(e[0]-e[1]),o=n.reduce(((e,t)=>e&&a(e)<a(t)?e:t),void 0);return{[t]:{relevantMatchUps:i,finishingPositionRanges:n,finishingPositionRange:o}}})))||[];return Object.assign({},...a)}function MS({tournamentRecords:e,tournamentRecord:t,tournamentId:i,drawId:n}){if(!t&&!e)return{error:Bt};if(!n)return{error:li};if(!t&&e){if("string"!=typeof i&&!(i=Zy({tournamentRecords:e,drawId:n})))return{error:jt};if(!(t=e[i]))return{error:Bt}}let r=t&&Ch({tournamentRecord:t,drawId:n});return null!=r&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:t,...At}:La({result:{error:Wt},stack:"findDrawDefinition"})}function AS(e){let{drawDefinition:t,error:i}=MS(e);return i?{error:i}:{drawDefinition:ts(t)}}function ES({targetRoundNumber:e,finishingPosition:t,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=Wh({drawDefinition:i,structureId:n})||{},o=((null==a?void 0:a.target)||[]).filter((({linkType:e})=>e===r)).filter((({target:t})=>!e||e===t.roundNumber)).map((e=>{let n=e.source.structureId,{structure:r}=Hc({structureId:n,drawDefinition:i});if(!t||(null==r?void 0:r.finishingPosition)===t)return e})).filter(Boolean);return{sourceStructureIds:o.map((({source:e})=>e.structureId)),relevantLinks:o}}function CS(e){var t,i,n,r,a;let{inContextDrawMatchUps:o,targetData:s,drawDefinition:l,relevantLink:u}=e;if((null==u?void 0:u.linkCondition)===Dl&&(null==(t=null==s?void 0:s.matchUp)?void 0:t.matchUpStatus)===Sc)return!1;let{targetMatchUps:{loserMatchUp:d,winnerMatchUp:c},targetLinks:p}=s,m=d&&zh({matchUpId:d.matchUpId,inContextDrawMatchUps:o,drawDefinition:l}),f=null==(i=null==m?void 0:m.targetMatchUps)?void 0:i.loserMatchUp,h=null==(n=null==m?void 0:m.targetMatchUps)?void 0:n.loserMatchUpDrawPositionIndex,v=null==(r=null==f?void 0:f.sides[h])?void 0:r.participant,g=[Tc,kc].includes(null==d?void 0:d.matchUpStatus)&&!v,I=(null==(a=null==c?void 0:c.drawPositions)?void 0:a.filter(Boolean).length)||0;if(null!=d&&d.winningSide&&!g||null!=c&&c.winningSide&&2===I&&(!c.feedRound||![kc,Tc].includes(null==c?void 0:c.matchUpStatus)))return!0;let U=c&&zh({matchUpId:c.matchUpId,inContextDrawMatchUps:o,drawDefinition:l}),y=m&&CS({relevantLink:null==p?void 0:p.loserTargetLink,targetData:m,inContextDrawMatchUps:o,drawDefinition:l});return!!(U&&CS({targetData:U,inContextDrawMatchUps:o,drawDefinition:l})||y)}be(DS,{addGoesTo:()=>lv,allPlayoffPositionsFilled:()=>UI,checkValidEntries:()=>hw,findDrawDefinition:()=>AS,getAssignedParticipantIds:()=>Mv,getAvailableMatchUpsCount:()=>bS,getAvailablePlayoffProfiles:()=>QU,getDrawDefinitionTimeItem:()=>om,getDrawParticipantRepresentativeIds:()=>RS,getDrawStructures:()=>zc,getDrawTypeCoercion:()=>dw,getEligibleVoluntaryConsolationParticipants:()=>TS,getMatchUpsMap:()=>rf,getParticipantIdFinishingPositions:()=>NS,getPositionAssignments:()=>cw,getPositionsPlayedOff:()=>KU,getSeedingThresholds:()=>_g,getSeedsCount:()=>fw,getStructureSeedAssignments:()=>Xm,getTeamLineUp:()=>xh,getValidGroupSizes:()=>kg,isAdHoc:()=>mf,isCompletedStructure:()=>II,isValidForQualifying:()=>pw,positionActions:()=>uw});var OS={[nd]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[nl,il],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[RU,MU,UU,NU],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},kS="positionAction",FS="matchUpAction";function xS({actionType:e=kS,appliedPolicies:t,drawDefinition:i,structure:n}){var r,a;let o=e===kS&&nd||e===FS&&rd,s=e===kS&&OS||e===FS&&ng,l=o&&((null==t?void 0:t[o])||(null==s?void 0:s[o])),u=(null==(a=null==(r=i.links)?void 0:r.filter((e=>{var t;return(null==(t=null==e?void 0:e.target)?void 0:t.structureId)===(null==n?void 0:n.structureId)})))?void 0:a.map((({target:e})=>e.feedProfile)))??[],{enabledStructures:d,disabledStructures:c}=l||{};return{enabledStructures:d,actionsDisabled:null==c?void 0:c.find((e=>{let{stages:t,stageSequences:i,structureTypes:r,feedProfiles:a}=e;return(!(null!=a&&a.length)||Array.isArray(a)&&a.some((e=>u.includes(e))))&&(!(null!=t&&t.length)||Array.isArray(t)&&(null==t?void 0:t.includes(null==n?void 0:n.stage)))&&(!(null!=r&&r.length)||Array.isArray(r)&&(null==r?void 0:r.includes(null==n?void 0:n.structureType)))&&(!(null!=i&&i.length)||Array.isArray(i)&&i.includes(null==n?void 0:n.stageSequence))})),actionsPolicy:l}}function _S({activePositionOverrides:e,activeDrawPositions:t,action:i}){return!(!i||!e.includes(i))||!t.length}function LS({enabledStructures:e,drawDefinition:t,structure:i}){var n,r;if(!1===e)return{};if(null==e||!e.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=(null==(r=null==(n=t.links)?void 0:n.filter((e=>{var t;return(null==(t=null==e?void 0:e.target)?void 0:t.structureId)===(null==i?void 0:i.structureId)})))?void 0:r.map((({target:e})=>e.feedProfile)))||[];return{policyActions:e.find((e=>{let{stages:t,stageSequences:i,structureTypes:n,feedProfiles:r}=e||{},u=!(null!=t&&t.length)||Array.isArray(t)&&t.includes(a),d=!(null!=i&&i.length)||Array.isArray(i)&&i.includes(o),c=!(null!=n&&n.length)||Array.isArray(n)&&n.includes(s),p=!(null!=r&&r.length)||Array.isArray(r)&&r.some((e=>l.includes(e)));return d&&c&&p&&e&&u}))}}function BS({action:e,policyActions:t}){var i;let n=!(null!=t&&t.enabledActions)||(null==(i=null==t?void 0:t.disabledActions)?void 0:i.length)&&t.disabledActions.includes(e);return!n&&((0===(null==t?void 0:t.enabledActions.length)||(null==t?void 0:t.enabledActions.includes(e)))&&!n)}var VS="replaceTieMatchUpParticipantId",jS="assignTieMatchUpParticipantId",GS="removeTieMatchUpParticipantId",$S="assignMatchUpSideParticipant",qS="removeMatchUpSideParticipant",WS="substituteParticipant",HS="REMOVE_SUBSTITUTION",zS="REPLACE_PARTICIPANT",YS="REMOVE_PARTICIPANT",KS="setMatchUpStatus",JS="SUBSTITUTION",QS="SCHEDULE",ZS="REFEREE",XS="STATUS",ew="START",tw="SCORE",iw="END",nw={REPLACE_TEAM_POSITION_METHOD:VS,ASSIGN_TEAM_POSITION_METHOD:jS,REMOVE_TEAM_POSITION_METHOD:GS,REPLACE_PARTICIPANT:zS,SUBSTITUTION_METHOD:WS,REMOVE_SUBSTITUTION:HS,REMOVE_PARTICIPANT:YS,SCHEDULE_METHOD:KS,SUBSTITUTION:JS,SCHEDULE:QS,PENALTY:"PENALTY",REFEREE:ZS,STATUS:XS,SCORE:tw,START:ew,END:iw};function rw({restrictQualifyingAlternates:e,structure:t,entry:i}){let{stage:n}=t;if(!i.entryStage||i.entryStage===n||n===nl&&!e||i.entryStage===il&&n===rl)return!0}function aw({restrictAdHocRoundParticipants:e,tournamentParticipants:t,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:d,event:c}){var p,m,f,h,v,g,I;let U=[],y=(null==l?void 0:l.matchUps)??[],S=null==(m=null==(p=u.sides)?void 0:p.find((e=>e.sideNumber===o)))?void 0:m.participantId,w=y.filter((({roundNumber:e})=>e===u.roundNumber)),P=(null==(f=null==r?void 0:r.entries)?void 0:f.filter((({entryStatus:e})=>e&&Hm.includes(e))).map(hc))??[],D=w.map((e=>(e.sides??[]).flatMap(hc))).flat().filter(Boolean),T=P.filter((t=>!(i.includes(t)||e&&D.includes(t)))),b=null==t?void 0:t.filter((e=>null==T?void 0:T.includes(e.participantId))).map((e=>ts(e,void 0,!0)));null==b||b.forEach((e=>{let t=(r.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),T.length&&U.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},method:$S,type:wU,availableParticipantIds:T,participantsAvailable:b});let R=function({eventEntries:e,structure:t}){return e.filter((e=>e.entryStatus===Em&&rw({structure:t,entry:e}))).sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))).map(hc)}({eventEntries:(null==c?void 0:c.entries)??[],structure:l}),N=Qe(P.concat(R));if(n){let e=null==(v=null==(h=c?Eh({event:c}):void 0)?void 0:h.flights)?void 0:v.filter((e=>e.drawId!==d)).flatMap((e=>e.drawEntries.filter((e=>e.participantId&&![$m,Vm,jm].includes(e.entryStatus))).map((({participantId:e})=>e)))).filter(Boolean);null!=e&&e.length&&N.push(...e)}N=N.filter((t=>!(i.includes(t)||T.includes(t)||e&&D.includes(t))));let M=null==t?void 0:t.filter((e=>N.includes(e.participantId))).map((e=>ts(e,void 0,!0)));if(null==M||M.forEach((e=>{let t=(r.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null==M||M.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),N.length&&U.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:N,participantsAvailable:M,method:$S,type:Em}),!dv(u)&&o&&S){U.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},method:qS,type:YS});let e=e=>e.sides.map(hc),i=({matchUpId:e})=>e!==u.matchUpId,n=e=>!dv(e),r=[null==(I=null==(g=u.sides)?void 0:g.find((e=>e.sideNumber!==o)))?void 0:I.participantId,...y.filter((({roundNumber:e})=>e!==u.roundNumber)).filter(i).map(e).filter((e=>e.includes(S))).flat()].filter(Boolean),l=e=>!r.flat().includes(e),c=w.filter(n).filter(i).map(e).flat().filter(l);if(c.length){let e=null==t?void 0:t.filter((e=>c.includes(e.participantId))).map((e=>ts(e,void 0,!0)));U.push({payload:{participantIds:[S],roundNumber:u.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:d},swappableParticipantIds:c,method:cU,type:bU,swappableParticipants:e})}}return U}function ow(e){var t,i,n,r,a,o,s,l,u;if(!e)return{error:Cr};let{drawDefinition:d,event:c}=e,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:m,enforceGender:f,participantId:h,sideNumber:v,matchUpId:g}=e,I=e.tournamentRecord??(e.tournamentId&&St(e.tournamentId)&&(null==(t=e.tournamentRecords)?void 0:t[e.tournamentId]));if(!I)return{error:Bt};if(!g||!St(g))return{error:Hi};if(v&&![1,2].includes(v))return La({result:{error:Cr},context:{sideNumber:v}});if(!d){let e=(ev({tournamentRecord:I}).matchUps??[]).find((e=>e.matchUpId===g));c=((null==I?void 0:I.events)??[]).find((t=>t.eventId===(null==e?void 0:e.eventId)));let t=((null==c?void 0:c.drawDefinitions)??[]).find((t=>t.drawId===(null==e?void 0:e.drawId)));t&&(d=t)}if(!d)return{error:$t};let U=zv({withIndividualParticipants:!0,tournamentRecord:I}).participants,{drawId:y}=d,{matchUp:S,structure:w}=Vy({drawDefinition:d,matchUpId:g,event:c});if(!S)return{error:Yi};let P=gm({tournamentRecord:I,drawDefinition:d,structure:w,event:c}).appliedPolicies??{};Object.assign(P,m??{});let D=null==(i=null==P?void 0:P[nd])?void 0:i.otherFlightEntries,T=(null==P?void 0:P[rd])??rg[rd],{enabledStructures:b}=xS({actionType:FS,appliedPolicies:P,drawDefinition:d,structure:w}),{policyActions:R}=LS({enabledStructures:b,drawDefinition:d,structure:w}),N=e.matchUpsMap??rf({drawDefinition:d}),M=e.inContextDrawMatchUps??Qh({tournamentParticipants:U,inContext:!0,drawDefinition:d,matchUpsMap:N,event:c}).matchUps,A=null==M?void 0:M.find((e=>e.matchUpId===g)),E=v&&(null==(n=null==A?void 0:A.sides)?void 0:n.find((e=>e.sideNumber===v))),C=(null==(r=null==A?void 0:A.sides)?void 0:r.map((e=>{var t;return e.participantId||(null==(t=e.participant)?void 0:t.participantid)})).filter(Boolean))??[],{assignedPositions:O,allPositionsAssigned:k}=Jc({structure:w}),{structureId:F}=w??{},x=[];if(!F)return{validActions:x};let _=mf({structure:w}),L=S.collectionId;if(_&&!L){let e=aw({restrictAdHocRoundParticipants:p,tournamentParticipants:U,matchUpParticipantIds:C,otherFlightEntries:D,drawDefinition:d,structureId:F,sideNumber:v,matchUpId:g,structure:w,matchUp:S,drawId:y,event:c});x.push(...e)}let B=II({drawDefinition:d,structure:w}),V=null==O?void 0:O.filter((e=>e.participantId)).map((e=>e.drawPosition)),j=null==O?void 0:O.filter((e=>e.bye)).map((e=>e.drawPosition)),G=S.matchUpStatus===Sc||!L&&(null==(a=S.drawPositions)?void 0:a.reduce(((e,t)=>(null==j?void 0:j.includes(t))||e),!1));if(G)return{validActions:x,isByeMatchUp:G};BS({policyActions:R,action:ZS})&&x.push({type:ZS,payload:{matchUpId:g}});let $=!cv({matchUpStatus:S.matchUpStatus}),q=null==(o=null==P?void 0:P.scoring)?void 0:o.structures,W=(null==w?void 0:w.stage)&&(null==q?void 0:q.stage)&&(null==q?void 0:q.stage[w.stage]),H=(null==w?void 0:w.stageSequence)&&(null==W?void 0:W.stageSequence)&&W.stageSequence[w.stageSequence],z=!(null!=(s=null==P?void 0:P.scoring)&&s.requireAllPositionsAssigned||null!=W&&W.requireAllPositionsAssigned||null!=H&&H.requireAllPositionsAssigned)||k,Y=S.sides&&2===S.sides.filter((e=>null==e?void 0:e.participantId)).length,K=S.matchUpStatus&&[Rc,bc].includes(S.matchUpStatus),J=CS({inContextDrawMatchUps:M,drawDefinition:d,targetData:zh({inContextDrawMatchUps:M,drawDefinition:d,matchUpId:g})}),Q=(2===(null==(l=null==A?void 0:A.drawPositions)?void 0:l.length)&&A.drawPositions.every((e=>null==V?void 0:V.includes(e)))&&2===(null==(u=null==A?void 0:A.sides)?void 0:u.length)&&A.sides.every((({participantId:e})=>e))||Y)&&!(K&&J),Z={method:gU,type:MU,payload:{drawId:y,matchUpId:g,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if($&&x.push({payload:{drawId:y,matchUpId:g,schedule:{}},method:KS,type:QS}),BS({policyActions:R,action:MU})&&(null!=E&&E.participant||!v&&null!=C&&C.length)&&x.push(Z),$&&Q&&x.push({type:XS}),z&&Q){let{matchUpId:e,matchUpFormat:t}=S,i={drawId:y,matchUpId:e,matchUpFormat:t,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};x.push({info:"set outcome and winningSide",method:KS,type:tw,payload:i}),BS({policyActions:R,action:ew})&&x.push({type:ew}),BS({policyActions:R,action:iw})&&x.push({type:iw})}if(L&&A){let e=function({specifiedPolicyDefinitions:e,inContextDrawMatchUps:t,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:d,drawId:c,side:p}){var m,f,h,v,g,I,U,y,S,w,P,D,T,b,R;let N=[],M=null==(m=r.sides)?void 0:m.find((e=>e.participant)),A=r.gender===ja&&r.sideNumber&&1===(null==(f=r.sides)?void 0:f.filter((e=>e.particiapntId)).length)&&(null==(v=null==(h=null==M?void 0:M.participant)?void 0:h.person)?void 0:v.sex),E=r.matchUpType,C=!1!==(o??(null==(g=null==n?void 0:n.participants)?void 0:g.enforceGender))?r.gender:void 0,O=null==(U=null==(I=r.sides)?void 0:I.flatMap((e=>{var t;return(null==(t=e.participant)?void 0:t.individualParticipants)||e.participant})).filter(Boolean))?void 0:U.map(hc),k=null==(y=r.sides)?void 0:y.filter((e=>!l||e.sideNumber===l)).flatMap((e=>{var t;return(null==(t=e.participant)?void 0:t.individualParticipants)||e.participant})).filter(Boolean),F=null==k?void 0:k.map(hc),x=null==(w=null==(S=null==t?void 0:t.find((e=>e.matchUpId===r.matchUpTieId)))?void 0:S.sides)?void 0:w.map((e=>{var t,i;return null==(i=null==(t=null==e?void 0:e.participant)?void 0:t.individualParticipants)?void 0:i.filter((({participantId:e,person:t})=>!(null!=F&&F.includes(e))&&(!C||C===Ba||t.sex===C||C===ja&&!A||A&&t.sex!==A)))})),_=l?null==x?void 0:x[l-1]:null==x?void 0:x.map(((e,t)=>({participants:e,sideNumber:t+1}))),L=l?null==(P=null==x?void 0:x[l-1])?void 0:P.map(hc):null==x?void 0:x.map(((e,t)=>({participants:null==e?void 0:e.map(hc),sideNumber:t+1}))),B=l&&(Xf(Ae)(E)&&!(null!=F&&F.length)||Xf(Ce)(E)&&((null==F?void 0:F.length)??0)<2)||!l&&(Xf(Ae)(E)&&((null==F?void 0:F.length)??0)<2||Xf(Ce)(E)&&((null==F?void 0:F.length)??0)<4),V=null==L?void 0:L.filter((e=>!(null!=O&&O.includes(e)))),j=null==_?void 0:_.filter((({participantId:e})=>V.includes(e)));if(B&&null!=V&&V.length&&N.push({availableParticipantIds:V,method:jS,availableParticipants:j,type:wU,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:c}}),null!=F&&F.length&&(!dv(d)||null!=(D=null==p?void 0:p.substitutions)&&D.length)&&N.push({method:GS,type:YS,existingParticipantIds:F,payload:{participantId:void 0,tieMatchUpId:u,drawId:c}}),null!=j&&j.length&&(!l&&null!=F&&F.length||l&&null!=p&&p.participant)&&N.push({availableParticipantIds:V,method:VS,availableParticipants:j,type:zS,existingParticipantIds:F,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:c}}),BS({policyActions:a,action:HS})&&(null==(T=null==p?void 0:p.substitutions)?void 0:T.length)){let e=(null==(b=p.participant)?void 0:b.participantType)===zp&&[p.participantId]||(null==(R=p.participant)?void 0:R.participantType)===Kp&&p.participant.individualParticipantIds||[],t=p.substitutions.map((e=>e.participantId)).filter((t=>e.includes(t)));(!s||t.includes(s))&&N.push({method:GS,type:HS,substitutedParticipantIds:t,payload:{participantId:void 0,tieMatchUpId:u,drawId:c}})}let G=null==e?void 0:e[rd],$=null==G?void 0:G.substituteWithoutScore,q=null==G?void 0:G.substituteAfterCompleted;if(BS({policyActions:a,action:JS})&&2===i.length&&(!l&&null!=F&&F.length||l&&null!=p&&p.participant)&&($||dv(d))&&(q||d.matchUpStatus&&!Vc.includes(d.matchUpStatus))&&null!=k&&k.length&&_.length){let e=k.map(hc);N.push({info:"list of team players available for substitution",method:WS,availableParticipantIds:L,existingParticipantIds:e,availableParticipants:_,existingParticipants:k,type:JS,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:c}})}return N}({specifiedPolicyDefinitions:m,inContextDrawMatchUps:M,matchUpParticipantIds:C,matchUpActionsPolicy:T,inContextMatchUp:A,policyActions:R,enforceGender:f,participantId:h,sideNumber:v,matchUpId:g,matchUp:S,drawId:y,side:E});x.push(...e)}return{structureIsComplete:B,validActions:x,isDoubleExit:K,...At}}function sw(e,t){return e.bye||Lg(e.seedValue)<Lg(t.seedValue)||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function lw({onlyAssignedPositions:e=!0,possiblyDisablingAction:t,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:d,structureId:c,structure:p,drawId:m,event:f}){if(r.includes(d))return{};let h=null==n?void 0:n.filter((e=>e!==d&&!(u&&s.includes(e)))),v=(null==a?void 0:a.filter((t=>(t=>!e||t.participantId||t.qualifier||t.bye)(t)&&(null==h?void 0:h.includes(t.drawPosition)))))??[],g=v.map((({drawPosition:e})=>e)),{matchUps:I}=jh({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),U=I.filter((({drawPositions:e})=>pt(e,g))),y=Object.assign({},...U.map((e=>{var t;return null==(t=e.sides)?void 0:t.filter((({sourceDrawPositionRange:e})=>e)).map((({drawPosition:e,sourceDrawPositionRange:t})=>({[e]:t})))})).flat()),S=v.map((e=>e.participantId)).filter(Boolean),w=(i??[]).filter((e=>S.includes(e.participantId))),P=Object.assign({},...w.map((e=>({[e.participantId]:e})))),D=v.map((e=>{let t=null==P?void 0:P[e.participantId],i=y[e.drawPosition];return _a({...e,participant:o?ts(t,!1,!0):void 0,sourceDrawPositionRange:i})}));return D.length?{validSwapAction:{payload:{drawId:m,structureId:c,drawPositions:[d]},willDisableLinks:t,method:uU,type:bU,availableAssignments:D}}:{}}function uw(e){var t;let i=qu(e,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:n,returnParticipants:r=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:u}=e,d=e.tournamentParticipants??(o&&zv({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],c=Hc({structureId:e.structureId,drawDefinition:s});if(c.error)return c;let p=c.containingStructure||c.structure;if(!p)return{error:Si};let m=p.structureId;if(c=fv({drawDefinition:s,structureId:m}),void 0===l&&!c.isAdHoc)return{error:ni};if(c.isAdHoc)return ow(e);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:h,activeDrawPositions:v,byeDrawPositions:g}=c,I=gm({tournamentRecord:o,drawDefinition:s,structure:p,event:u}).appliedPolicies??{};Object.assign(I,n??{});let U,{actionsPolicy:y,enabledStructures:S,actionsDisabled:w}=xS({actionType:kS,appliedPolicies:I,drawDefinition:s,structure:p}),P=(null==y?void 0:y.activePositionOverrides)||[],{sourceStructureIds:D}=ES({finishingPosition:Zl,targetRoundNumber:1,linkType:Sl,drawDefinition:s,structureId:m})||{};null!=D&&D.length&&(U=D.every((e=>II({structureId:e,drawDefinition:s}))));let T=D.length,b=D.length&&!U,{policyActions:R}=LS({enabledStructures:S,drawDefinition:s,structure:p}),N=![nl,il].includes(p.stage)||1!==p.stageSequence,{drawId:M}=s,A=[],{assignedPositions:E,positionAssignments:C}=Jc({structure:p}),O=null==E?void 0:E.find((e=>e.drawPosition===l)),k=!!O;if(null==(t=null==C?void 0:C.map((e=>e.drawPosition)))||!t.includes(l))return{error:ii};let{stage:F,stageSequence:x}=p,_=[F];F===rl&&_.push(il),F===il&&_.push(rl);let L=Zm({entryStatuses:Hm,provisionalPositioning:a,drawDefinition:s,stageSequence:x,structureId:m,stages:_}),B=Mv({drawDefinition:s,stages:_}).assignedParticipantIds??[],V=L.filter((e=>!B.includes(e.participantId))).map((e=>e.participantId)),j=g.includes(l),G=v.includes(l);if(w)return{info:"Actions Disabled for structure",isActiveDrawPosition:G,isDrawPosition:!0,hasPositionAssigned:k,validActions:[],isByePosition:j};if(BS({policyActions:R,action:wU})&&!G&&C&&!b&&(!O||j)){let{validAssignmentActions:e}=function({positionSourceStructureIds:e,unassignedParticipantIds:t,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:d,isByePosition:c,drawPosition:p,structureId:m,event:f}){var h,v,g;let I,U,{drawId:y}=u,S=[],w=[],P=null==(v=null==(h=null==l?void 0:l[pd])?void 0:h.validSeedPositions)?void 0:v.ignore;if(P||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:U,unfilledPositions:w}=$g({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:d,structureId:m,event:f})),null!=w&&w.length||(w=o.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition))),c||S.push({payload:{drawId:y,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:hU,type:AU}),a&&P){let t=o.map((e=>e.participantId)).filter(Boolean),n={structureIds:e},{completedMatchUps:a}=Zh({inContext:!0,matchUpFilters:n,drawDefinition:u}),l=Qe(null==(g=(a??[]).filter((({matchUpType:e})=>(null==f?void 0:f.eventType)!==Xs||e===Xs)))?void 0:g.map((({sides:e})=>null==e?void 0:e.map(hc))).flat().filter((e=>e&&!t.includes(e)))),d=s?null==r?void 0:r.filter((e=>null==l?void 0:l.includes(e.participantId))).map((e=>ts(e,void 0,!0))):void 0;return null==d||d.forEach((e=>{let t=(u.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null!=d&&d.length&&S.push(_a({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:mU,type:wU,availableParticipantIds:l,participantsAvailable:d})),{validAssignmentActions:S}}if(w.includes(p)||c){let e;if(null!=U&&U.length){let t=U.filter((e=>null==I?void 0:I.includes(e.participantId)));t.sort(sw),e=t.map((e=>e.participantId))}else e=t;let n=s?null==r?void 0:r.filter((t=>e.includes(t.participantId))).map((e=>ts(e,void 0,!0))):void 0;null!=n&&n.length&&S.push(_a({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:mU,type:wU,availableParticipantIds:e,participantsAvailable:n}))}return{validAssignmentActions:S}}({positionSourceStructureIds:D,unassignedParticipantIds:V,possiblyDisablingAction:N,isWinRatioFedStructure:T,tournamentParticipants:d,positionAssignments:C,returnParticipants:r,appliedPolicies:I,drawDefinition:s,isByePosition:j,drawPosition:l,structureId:m,event:u});null==e||e.forEach((e=>A.push(e)))}if(BS({policyActions:R,action:UU})&&!G){let{validAssignmentActions:e}=function({drawPositionInitialRounds:e,tournamentParticipants:t,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var u,d,c;let p=[],m=[],f=[],h=[],v=i.map((e=>e.participantId)).filter(Boolean),g=null==r?void 0:r[nd],I=!(null!=g&&g.disableRoundRestrictions)&&e[o],U=null==g?void 0:g.requireCompletedStructures,{sourceStructureIds:y,relevantLinks:S}=ES({targetRoundNumber:I,linkType:wl,drawDefinition:a,structureId:s})||{};null!=y&&y.length&&h.push(...y);let{sourceStructureIds:w,relevantLinks:P}=ES({targetRoundNumber:I,linkType:Sl,drawDefinition:a,structureId:s})||{};null!=w&&w.length&&h.push(...w);for(let D of S){let e=null==(u=a.structures)?void 0:u.find((e=>e.structureId===D.source.structureId));if((null==e?void 0:e.stage)!==nl)continue;let i=II({structureId:D.source.structureId,drawDefinition:a});if(!U||i){let i=e.qualifyingRoundNumber,{matchUps:r}=jh({matchUpFilters:{roundNumbers:[i],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:t,inContext:!0,structure:e});for(let e of r){let t=e.sides.find((t=>(null==t?void 0:t.sideNumber)===e.winningSide)),i=e.matchUpStatus===Sc&&(null==(d=e.sides)?void 0:d.find((({participantId:e})=>e)));if(t||i){let{participantId:e,participant:r}=t||i||{};e&&!v.includes(e)&&(r&&n&&p.push(r),m.push(e))}}}}for(let D of P){let e=null==(c=a.structures)?void 0:c.find((e=>e.structureId===D.source.structureId));if((null==e?void 0:e.stage)!==nl)continue;let i=II({structureId:D.source.structureId,drawDefinition:a});if(!U||i){let{positionAssignments:i}=Kc({structure:e}),r=(null==i?void 0:i.map((e=>{var t;let i=e.participantId,n=null==(t=Cd({element:e,name:tc}).extension)?void 0:t.value;return n?{participantId:i,groupOrder:null==n?void 0:n.groupOrder}:{}})).filter((({groupOrder:e,participantId:t})=>1===e&&!v.includes(t))).map((({participantId:e})=>e)))??[];if(r&&m.push(...r),n){let e=t.filter((({participantId:e})=>r.includes(e)));p.push(...e)}}}return m.length&&f.push(_a({qualifyingParticipants:n?p:void 0,method:rU,type:UU,qualifyingParticipantIds:m,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l}})),{validAssignmentActions:f,sourceStructureIds:h}}({drawPositionInitialRounds:f,tournamentParticipants:d,positionAssignments:C,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:l,structureId:m,drawId:M});null==e||e.forEach((e=>A.push(e)))}let{participantId:$}=O||{},q=$&&d.find((e=>e.participantId===$));if(O){BS({policyActions:R,action:PU})&&!G&&(A.push({type:PU,method:lU,payload:{drawId:M,structureId:m,drawPosition:l},willDisableLinks:N}),j||A.push({type:SU,method:aU,payload:{drawId:M,structureId:m,drawPosition:l},willDisableLinks:N}),BS({policyActions:R,action:AU})&&!j&&A.push({type:AU,method:lU,payload:{drawId:M,structureId:m,drawPosition:l,replaceWithBye:!0},willDisableLinks:N}));let e=p.stage===nl||p.stage===il&&1===p.stageSequence;if(!j&&_S({activePositionOverrides:P,activeDrawPositions:v,action:NU})&&BS({policyActions:R,action:NU})&&Gg({drawDefinition:s,structureId:m,drawPosition:l})&&e){let{seedAssignments:e}=Xm({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:t,seedValue:i}=(null==e?void 0:e.find((e=>e.participantId===$)))??{};A.push({type:NU,method:vU,participant:q,seedNumber:t,payload:{drawId:M,structureId:m,participantId:$,seedValue:i}})}if(!j&&_S({activePositionOverrides:P,activeDrawPositions:v,action:TU})&&BS({policyActions:R,action:TU})&&Gg({drawDefinition:s,structureId:m,drawPosition:l})&&e){let{seedAssignments:e}=Xm({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:t}=(null==e?void 0:e.find((e=>e.participantId===$)))??{};A.push({method:fU,type:TU,participant:q,seedNumber:t,payload:{participantId:$,structureId:m,drawId:M}})}if(!j&&$){if(BS({policyActions:R,action:MU})){let e={type:MU,method:gU,participant:q,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:M}};A.push(e)}if(BS({policyActions:R,action:RU})){let e={type:RU,method:pU,participant:q,payload:{participantId:$,otherName:void 0}};A.push(e)}}if(BS({policyActions:R,action:bU})){let{validSwapAction:e}=lw({possiblyDisablingAction:N,tournamentParticipants:d,inactiveDrawPositions:h,activeDrawPositions:v,positionAssignments:C,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:j,drawPosition:l,structureId:m,structure:p,drawId:M});e&&A.push(e)}}if(BS({policyActions:R,action:yU})&&!b){let{validAlternatesAction:e}=function({tournamentParticipants:e=[],possiblyDisablingAction:t,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:d,drawId:c,event:p}){var m,f,h,v,g;if(i.includes(s))return{};let I=null==(m=l.find((e=>e.type===wU)))?void 0:m.availableParticipantIds,U=null==(f=null==a?void 0:a[nd])?void 0:f.otherFlightEntries,y=null==(h=null==a?void 0:a[nd])?void 0:h.restrictQualifyingAlternates,S=(o.entries??[]).filter((({entryStage:e})=>!y||(d.stage===nl?e===nl:e!==nl))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((({participantId:e})=>e)).filter(Boolean),{allPositionedParticipantIds:w}=Yc({drawDefinition:o}),P=n.map((e=>e.participantId)).filter(Boolean),D=S.filter((e=>d.stage&&[nl,il,ol].includes(d.stage)?!(null!=w&&w.includes(e)):!P.includes(e))),T=((null==p?void 0:p.entries)??[]).filter((e=>e.entryStatus===Em&&rw({restrictQualifyingAlternates:y,structure:d,entry:e})&&(d.stage&&[nl,il,ol].includes(d.stage)?!(null!=w&&w.includes(e.participantId)):!P.includes(e.participantId)))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((e=>e.participantId)),b=Qe(D.concat(T));if(U){let e=null==(g=null==(v=p?Eh({event:p}).flightProfile:void 0)?void 0:v.flights)?void 0:g.filter((e=>e.drawId!==c)).map((e=>e.drawEntries.filter((e=>e.participantId&&![$m,Vm,jm].includes(e.entryStatus)&&!S.includes(e.participantId))).map((({participantId:e})=>e)))).flat().filter(Boolean);null!=e&&e.length&&b.push(...e)}null!=I&&I.length&&(b=b.filter((e=>!I.includes(e))));let R=r?null==e?void 0:e.filter((e=>b.includes(e.participantId))):void 0;return null==R||R.forEach((e=>{let t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null==R||R.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),b.length?{validAlternatesAction:_a({payload:{drawId:c,structureId:u,drawPosition:s},willDisableLinks:t,method:oU,availableAlternatesParticipantIds:b,type:yU,availableAlternates:R})}:{}}({possiblyDisablingAction:N,tournamentParticipants:d,positionAssignments:C,activeDrawPositions:v,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:l,validActions:A,structureId:m,structure:p,drawId:M,event:u});e&&A.push(e)}if(BS({policyActions:R,action:DU})&&!b&&!G&&C){let{validLuckyLosersAction:e}=function({tournamentParticipants:e=[],sourceStructuresComplete:t,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:d,event:c}){var p,m,f,h,v,g,I;if(r.includes(s)||n&&!t)return{};let{sourceStructureIds:U,targetStructureIds:y}=(null==(p=o.links)?void 0:p.reduce(((e,t)=>{var i,n;let r=null==(i=t.source)?void 0:i.structureId,a=null==(n=t.target)?void 0:n.structureId;return e.sourceStructureIds.includes(r)||e.sourceStructureIds.push(r),e.targetStructureIds.includes(a)||e.targetStructureIds.push(a),e}),{sourceStructureIds:[],targetStructureIds:[]}))||{},S=[],w=(null==(m=o.links)?void 0:m.filter((e=>{var t;return(null==(t=e.target)?void 0:t.structureId)===u.structureId})))??[];for(let D of w){let e=null==(f=null==D?void 0:D.source)?void 0:f.structureId,{structure:t}=Hc({structureId:e,drawDefinition:o}),i={};if((null==t?void 0:t.finishingPosition)===Xl&&(1!==(null==U?void 0:U.length)||1!==(null==y?void 0:y.length))){let{matchUps:e}=jh({drawDefinition:o,structure:u,event:c}),{initialRoundNumber:t}=hv({drawPosition:s,matchUps:e}),n=null==(g=null==(v=null==(h=o.links)?void 0:h.find((e=>{var i;return(null==(i=e.target)?void 0:i.structureId)===(null==u?void 0:u.structureId)&&e.target.roundNumber===t})))?void 0:v.source)?void 0:g.roundNumber;i.roundNumbers=[n]}let{completedMatchUps:n}=$h({structureId:e,inContext:!0,matchUpFilters:i,drawDefinition:o}),r=a.map((e=>e.participantId)).filter(Boolean);null==(I=null==n?void 0:n.filter((({matchUpType:e,winningSide:t})=>t&&((null==c?void 0:c.eventType)!==Xs||e===Xs))).map((({winningSide:e,sides:t})=>e&&(null==t?void 0:t[1-(e-1)]))).map(hc).filter((e=>e&&!r.includes(e))))||I.forEach((e=>{S.includes(e)||S.push(e)}))}let P=null==e?void 0:e.filter((e=>null==S?void 0:S.includes(e.participantId)));return null==P||P.forEach((e=>{let t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null!=S&&S.length?{validLuckyLosersAction:{type:DU,method:sU,availableLuckyLosers:P,availableLuckyLoserParticipantIds:S,willDisableLinks:i,payload:{drawId:d,structureId:l,drawPosition:s}}}:{}}({sourceStructuresComplete:U,possiblyDisablingAction:N,isWinRatioFedStructure:T,tournamentParticipants:d,activeDrawPositions:v,positionAssignments:C,drawDefinition:s,drawPosition:l,structureId:m,structure:p,drawId:M});e&&A.push(e)}if((null==q?void 0:q.participantType)===Kp&&BS({policyActions:R,action:IU})){let{validModifyAssignedPairAction:e}=function({tournamentParticipants:e,returnParticipants:t,drawPosition:i,participant:n,drawId:r,event:a}){var o;let s=(null==(o=null==a?void 0:a.entries)?void 0:o.filter((({entryStatus:e})=>[Vm,jm].includes(e))).map((({participantId:e})=>e)))||[];if(s.length){let a=n.individualParticipantIds,o=t?e.filter((({participantId:e})=>s.includes(e))):void 0,l=t?e.filter((({participantId:e})=>a.includes(e))):void 0;return{validModifyAssignedPairAction:_a({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:dU,availableIndividualParticipantIds:s,availableIndividualParticipants:o,existingIndividualParticipantIds:a,existingIndividualParticipants:l,type:IU},!1,!1,!0)}}return{}}({tournamentParticipants:d,returnParticipants:r,drawPosition:l,participant:q,drawId:M,event:u});e&&A.push(e)}return{isActiveDrawPosition:G,isDrawPosition:!0,hasPositionAssigned:k,isByePosition:j,validActions:A,...At}}function dw({policyDefinitions:e,appliedPolicies:t,drawType:i}){var n,r;let a=null==(n=null==e?void 0:e[fd])?void 0:n.drawTypeCoercion,o=null==(r=null==t?void 0:t[fd])?void 0:r.drawTypeCoercion;return("boolean"==typeof a?a:void 0)??(i&&(null==a?void 0:a[i]))??("boolean"==typeof o?o:void 0)??(i&&(null==o?void 0:o[i]))??!0}function cw({tournamentRecord:e,drawDefinition:t,stage:i=il,structureId:n,structure:r}){var a;if(!e)return{error:Bt};if(!r&&!t)return{error:$t};if(!r&&!n&&1===(null==(a=null==t?void 0:t.structures)?void 0:a.filter((e=>e.stage===i)).length)&&(r=t.structures.find((e=>e.stage===i))),!r&&!n)return{error:yi};let{error:o,positionAssignments:s}=Kc({drawDefinition:t,structureId:n,structure:r});return{positionAssignments:s??[],structureId:null==r?void 0:r.structureId,error:o}}function pw({structureId:e,drawDefinition:t}){if(!t)return{error:$t};if(!St(e))return{error:Cr};let i=Wh({drawDefinition:t,structureId:e});if(i.error)return i;let n=i.links.target.flatMap((e=>e.target.feedProfile)).filter(Boolean),r=!dt([yl,Ul,Il,fl],n).length;return{...At,valid:r}}function mw({participantsCount:e,participantCount:t}){if(!(e=e??t))return{error:Cr};let i=He(e);return i?{drawSize:i}:La({result:{error:Cr},stack:"getEliminationDrawSize",context:{participantsCount:e}})}function fw(e){let{drawSizeProgression:t=!1,policyDefinitions:i,drawSize:n}=e||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:o,event:s}=e||{},l="getSeedsCount",u=(null==e?void 0:e.participantsCount)??(null==e?void 0:e.participantCount);if(!i){let e=Im({tournamentRecord:a,drawDefinition:o,event:s});if(e.error)return La({result:e,stack:l});i=e.policyDefinitions}let d=Ye(u);if(u&&!d)return La({result:{error:Cr},context:{participantsCount:u},stack:l});if(r&&!d)return La({result:{error:jn},stack:l});if(isNaN(n)){if(!u)return La({result:{error:si},stack:l});({drawSize:n}=mw({participantsCount:u}))}let c=r&&u||n;if(c&&c>n)return{error:Hn};let p=null==i?void 0:i[pd];if(!p)return{error:nn};let m=p.seedsCountThresholds;return m?(void 0!==p.drawSizeProgression&&(t=p.drawSizeProgression),{seedsCount:m.filter((e=>t?e.drawSize<=n:n===e.drawSize)).reduce(((e,t)=>u&&u>=t.minimumParticipantCount?t.seedsCount:e),0)}):{error:pi}}function hw({consideredEntries:e,policyDefinitions:t,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:o,event:s}){var l;if((!o||!r)&&i&&({participants:o,participantMap:r}=zv({tournamentRecord:i})),!o)return{error:Fn};if(!Array.isArray(o))return{error:Cr};if(!s)return{error:bi};let u=(null==t?void 0:t[rd])??(null==n?void 0:n[rd])??rg[rd],d=!1!==(a??(null==(l=null==u?void 0:u.participants)?void 0:l.enforceGender)),{eventType:c,gender:p}=s,m=c===Zs,f=c===el&&Jp||m&&Kp||zp,h=Object.assign({},...(e??s.entries??[]).map((e=>({[e.participantId]:e.entryStatus})))),v=Object.keys(h),g=o.filter((e=>v.includes(e.participantId))).filter((e=>{let t=function({participant:e,participantType:t,eventType:i,entryStatusMap:n}){let r=n[e.participantId],a=i&&[Zs,el].includes(i)&&e.participantType===zp&&(Ev(r)||r===$m);return e.participantType!==t&&!a}({participant:e,participantType:f,eventType:c,entryStatusMap:h}),i=function(e){var t,i,n;let{participant:r,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:u}=e,d=!s&&l&&Qe((null==(t=null==r?void 0:r.individualParticipantIds)?void 0:t.map((e=>{var t,i,n;return null==(n=null==(i=null==(t=null==a?void 0:a[e])?void 0:t.participant)?void 0:i.person)?void 0:n.sex})).filter(Boolean))??[])||[],c=!o||!(null!=d&&d.length)||Ba===o||[Va,$a].includes(o)&&d[0]===o||ja===o&&(1===d.length&&1===(null==(i=r.individualParticipantIds)?void 0:i.length)||2===d.length),p=null==(n=null==r?void 0:r.person)?void 0:n.sex,m=!(null!=r&&r.person)||!o||[Ba,ja].includes(o)||[Va,$a].includes(o)&&p===o;return!u||c&&m}({genderEnforced:d,participantMap:r,eventGender:p,participant:e,isDoubles:m,mismatch:t});return t||!i}));if(g.length){let e=g.map((e=>e.participantId));return{error:Ai,invalidParticipantIds:e}}return{...At,valid:!0}}function vw({qualifyingProfiles:e,appliedPolicies:t,idPrefix:i,isMock:n,uuids:r}){var a;let o,s=[],l=[],u=[],d=(e,t)=>e.stageSequence-t.stageSequence,c=(e,t)=>e.roundTarget-t.roundTarget,p=0,m=0,f=1;for(let h of e.sort(c)){let c=h.structureProfiles||[];f=h.roundTarget||f;let v,g,I,U=1,y=0;for(let s of(c||[]).sort(d)){let d,m,h,S=Ge(s.drawSize||s.participantsCount),{qualifyingRoundNumber:w,structureOptions:P,matchUpFormat:D,structureName:T,structureId:b,drawType:R}=s,N=s.matchUpType,M=s.qualifyingPositions||gw({drawSize:S,qualifyingRoundNumber:w});if(!Ye(S))return La({result:{error:si},stack:"generateQualifyingSTructures"});let A=e.length>1?`${f}-`:"",E=c.length>1||A?U:"",C=T||(A||E?`${Tg(nl)} ${A}${E}`:Tg(nl));if(R===Hl){let{structures:e,groupCount:a,maxRoundNumber:l}=Og({structureName:s.structureName||C,structureId:b||(null==r?void 0:r.pop()),stage:nl,structureOptions:P,appliedPolicies:t,stageSequence:U,matchUpType:N,roundTarget:f,drawSize:S,idPrefix:i,isMock:n,uuids:r});y=a,d=l,m=e[0],o=[1]}else({drawSize:S,matchUps:h,roundLimit:d}=LU({qualifyingRoundNumber:w,qualifyingPositions:M,matchUpType:N,drawSize:S,idPrefix:i,isMock:n,uuids:r})),m=Rg({structureName:s.structureName||C,structureId:b||(null==r?void 0:r.pop()),qualifyingRoundNumber:d,stage:nl,matchUpFormat:D,stageSequence:U,matchUpType:N,roundLimit:d,matchUps:h}),f&&Sd({extension:{name:Jd,value:f},element:m}),y=(null==(a=null==h?void 0:h.filter((e=>e.roundNumber===d)))?void 0:a.length)||0;if(U>1){let{link:e}=FU({sourceStructureId:g,sourceRoundNumber:v,targetStructureId:m.structureId,finishingPositions:I===Sl?[1]:void 0,linkType:I});u.push(e),p+=(S||0)-y}else p+=S||0;I=R===Hl?Sl:wl,g=m.structureId,v=d,l.push(m),U+=1}m+=y,s.push({qualifiersCount:y,finalQualifyingRoundNumber:v,finalQualifyingStructureId:g,finishingPositions:o,roundTarget:f,linkType:I}),f+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...At,links:u}}function gw({drawSize:e,qualifyingRoundNumber:t}){let i=e,n=0;for(;n<t;)i=Math.floor(i/2),n+=1;return i}function Iw(e){let{drawTypeCoercion:t,enforceMinimumDrawSize:i}=e,n=Be(e.drawSize),r=t&&e.drawType!==Tl&&("boolean"==typeof t||t<=2)&&2===n&&Ml||e.drawType||Ml,a=eu.includes(r);if(n&&a)if(t&&("boolean"==typeof t&&n<4||n<=t))r=Ml;else if(n<4&&i)return{...La({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:ai},stack:"getCoercedDrawType"}),drawType:r};return{drawType:r}}function Uw({structureName:e,matchUpType:t,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let o=[],{matchUps:s}=$U({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:t,idPrefix:i,isMock:r}),l=bg({structureName:e||Tg(il),structureId:null==a?void 0:a.pop(),stageSequence:1,stage:il,matchUpType:t,matchUps:s});o.push(l);let u=n/2,{matchUps:d}=$U({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:t,isMock:r,uuids:a}),c=bg({structureName:Tg(Kl),matchUps:d,structureId:null==a?void 0:a.pop(),stage:rl,stageSequence:2,matchUpType:t});o.push(c);let{matchUps:p}=LU({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:t,isMock:r}),m=bg({structureName:Tg(Yl),matchUps:p,structureId:null==a?void 0:a.pop(),stageSequence:3,stage:ol,matchUpType:t});o.push(m);let f=function({mainStructure:e,consolationStructure:t,deciderStructure:i}){let n=t.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),r=e.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0),a=t.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0);return[...n.map(((i,r)=>{let a=n.indexOf(i)%2?Ul:yl;return{linkType:Pl,source:{roundNumber:1+r,structureId:e.structureId},target:{feedProfile:a,roundNumber:i,structureId:t.structureId}}})),{linkType:wl,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:Ul,roundNumber:r,structureId:e.structureId}},{linkType:wl,source:{roundNumber:r,structureId:e.structureId},target:{feedProfile:Ul,roundNumber:1,structureId:i.structureId}},{linkType:Pl,source:{roundNumber:r,structureId:e.structureId},target:{feedProfile:Ul,roundNumber:1,structureId:i.structureId}}]}({mainStructure:l,consolationStructure:c,deciderStructure:m});return{structures:o,links:f,...At}}function yw(e){let{qualifyingRoundNumber:t,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:l}=e;if(!Ye(o)||o<2)return{matchUps:[],roundsCount:0};if(Ve(o))return LU(e);let u=function(e){let t=Be(e),i=t%2?t+1:t,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let e=Math.ceil(i/2),t=1===e,n=!(t||!(e%2));i=!t&&n?e+1:e;let a=!!(2!==i&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:a,feedRound:n})}return r}(o),d=u.shift(),c=lt(1,((null==d?void 0:d.participantsCount)||0)+1).map((e=>({drawPosition:e}))),p=[],m=1;({matchUps:p}=_U({roundNumber:m,matchUpType:r,idPrefix:a,matchUps:p,isMock:s,nodes:c,uuids:l})),m++;let f=e.roundLimit||t;for(let v of u){let e=v.participantsCount/2,t=lt(1,e+1);n&&e===n&&(f=m-1);let i=t.map((e=>{let t=xU({roundPosition:e,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:e,roundNumber:m,matchUpId:t}}));p.push(...i),m++}let h=m-1;return p=sv({finishingPositionOffset:i,lucky:!0,roundsCount:h,roundLimit:f,matchUps:p}),f&&(p=p.filter((e=>e.roundNumber<=f))),{matchUps:p,roundsCount:h,roundLimit:f}}function Sw(e){var t,i;let{playoffAttributes:n,stageSequence:r=1,stage:a=il,matchUpType:o,drawSize:s,uuids:l}=e,u=e.structureId||(e.isMock||e.idPrefix?`${e.drawDefinition.drawId}-s-0`:void 0)||(null==l?void 0:l.pop()),d=e.appliedPolicies??gm(e),c=(null==(t=e.policyDefinitions)?void 0:t[md])||(null==d?void 0:d[md]);e.skipRounds=e.skipRounds||s<=4&&(null!=c&&c.feedFromMainFinal?0:1)||0;let p=e.structureName??(null==(i=null==n?void 0:n[0])?void 0:i.name)??Tg(il);return{generators:{[Tl]:()=>({structures:[Rg({finishingPosition:Zl,stageSequence:r,structureName:p,matchUps:[],matchUpType:o,structureId:u,stage:a})],links:[],...At}),[Ol]:()=>{let{matchUps:t}=yw(e);return{structures:[Rg({stageSequence:r,structureName:p,matchUpType:o,structureId:u,matchUps:t,stage:a})],links:[],...At}},[Ml]:()=>(()=>{let{matchUps:t}=LU(e);return{structures:[Rg({stageSequence:r,structureName:p,matchUpType:o,structureId:u,matchUps:t,stage:a})],links:[],...At}})(),[Al]:()=>Uw(e),[Rl]:()=>qU({...e,roundOffsetLimit:3,playoffAttributes:n??Jl}),[Nl]:()=>qU({...e,roundOffsetLimit:2,playoffAttributes:n??Ql}),[ol]:()=>qU(e),[bl]:()=>{let{matchUps:e}=$U({drawSize:s,uuids:l,matchUpType:o});return{structures:[Rg({stageSequence:r,structureName:p,matchUpType:o,structureId:u,stage:il,matchUps:e})],links:[],...At}},[Cl]:()=>XU(e),[El]:()=>iy({...e,feedRounds:1,fmlc:!0}),[Gl]:()=>iy({...e,feedRounds:1}),[xl]:()=>iy({...e,feedsFromFinal:1}),[Ll]:()=>iy({...e,feedsFromFinal:2}),[Vl]:()=>iy({...e,feedsFromFinal:3}),[ql]:()=>iy(e),[kl]:()=>ty(e),[Hl]:()=>Og(e),[zl]:()=>function(e){let{drawDefinition:t,structureOptions:i,requireSequential:n}=e,r={structureName:Tg(il),...e,stage:il},{structures:a,groupCount:o,groupSize:s}=Og(r);if(o<1)return{error:Rr};let l=(null==i?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:Tg(ol)}],[u]=a,{structures:d,links:c}=ny({sourceStructureId:u.structureId,requireSequential:n,drawDefinition:t,playoffGroups:l,groupCount:o,groupSize:s,...e});return d&&a.push(...d),{...At,structures:a,links:c}}(e)}}}function ww(e){var t,i,n,r,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:u,drawDefinition:d,tieFormat:c,isMock:p,uuids:m}=e||{},f=Be(e.drawSize),h=e.drawTypeCoercion??dw({appliedPolicies:l,drawType:e.drawType}),v=Iw({drawType:e.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:h,drawSize:f});if(v.error)return v;let g=v.drawType,I=[],U=[],y=(null==e?void 0:e.matchUpType)??Ee,S=null==(t=null==d?void 0:d.structures)?void 0:t.filter((({stage:e})=>e===nl));S&&I.push(...S);let w=null==S?void 0:S.map((({structureId:e})=>e)),P=null==(i=null==d?void 0:d.structures)?void 0:i.find((({stage:e,stageSequence:t})=>e===il&&1===t)),D=null==(n=null==d?void 0:d.links)?void 0:n.filter((e=>e.target.structureId===(null==P?void 0:P.structureId)&&(null==w?void 0:w.includes(e.source.structureId)))),T=(e,t)=>{var i;if(e.linkType===Sl&&null!=t&&t.structures){let i=e.source.finishingPositions||[];return t.structures.length*i.length}if(e.linkType===wl&&null!=(i=null==t?void 0:t.matchUps)&&i.length){let i=e.source.roundNumber;return t.matchUps.filter((({roundNumber:e})=>e===i)).length}},b=null==S?void 0:S.map((e=>{var t,i,n;let r=null==D?void 0:D.find((t=>t.target.structureId===e.structureId)),a=(null==(i=null==(t=Kc({structure:e}))?void 0:t.positionAssignments)?void 0:i.length)??0;if(!r)return a;let o=null==r?void 0:r.source.structureId,s=null==(n=d.structures)?void 0:n.find((e=>e.structureId===o));return a-(T(r,s)||0)})).filter(Boolean).reduce(((e,t)=>e+t),0),R=null==D?void 0:D.map((e=>{let t=e.source.structureId,i=null==S?void 0:S.find((e=>e.structureId===t));return T(e,i)})).filter(Boolean).reduce(((e,t)=>e+t),0),N=!(!P||null!=(r=null==P?void 0:P.matchUps)&&r.length);if(null!=S&&S.length&&!N)return{error:qr};let M=!(null!=S&&S.length)&&e.qualifyingProfiles,A=(null==M?void 0:M.length)&&vw({idPrefix:e.idPrefix,qualifyingProfiles:M,appliedPolicies:l,isMock:p,uuids:m});if(null!=A&&A.error)return A;let{qualifyingDrawPositionsCount:E,qualifyingDetails:C,qualifiersCount:O}=A||{qualifyingDrawPositionsCount:b,qualifiersCount:R};E&&(null!=A&&A.structures&&I.push(...A.structures),null!=A&&A.links&&U.push(...A.links)),Object.assign(e,_a({drawSize:f,matchUpType:y,tieFormat:c}));let k=g!==Tl&&(!f||f<2||!u&&![bl,Ol].includes(g)&&([zl,Hl].includes(g)&&f<3||![Hl,zl].includes(g)&&!Ve(f)));if(k&&!E)return La({context:{drawSize:f,invalidDrawSize:k},result:{error:ai},stack:"generateDrawStructuresAndLinks"});let{generators:F,error:x}=Sw(e);if(x)return{error:x};let _=F[g];if(!_)return{error:Zt};let L=null==_?void 0:_();if(L.error)return L;let{structures:B,links:V}=L;if(null!=B&&B.length){let e=B.find((({stage:e,stageSequence:t})=>e===il&&1===t));if(P&&e)if(N){let t=e.structureId;if(e.structureId=P.structureId,null==V?void 0:V.length)for(let e of V)e.source.structureId===t&&(e.source.structureId=P.structureId),e.target.structureId===t&&(e.target.structureId=P.structureId)}else if(!s)return{error:qr};I.push(...B)}I.sort(qc),null!=V&&V.length&&U.push(...V);let j=L.structures.find((({stage:e,stageSequence:t})=>e===il&&1===t));for(let G of C||[]){let{finalQualifyingRoundNumber:e,finalQualifyingStructureId:t,roundTarget:i,finishingPositions:n,linkType:r}=G,o=j&&(null==(a=FU({targetStructureId:j.structureId,sourceStructureId:t,sourceRoundNumber:e,finishingPositions:n,targetEntryRound:i,linkType:r}))?void 0:a.link);if(null!=o&&o.error)return o;o&&U.push(o)}return D&&U.push(...D),{...At,qualifyingResult:{qualifyingDrawPositionsCount:E,qualifiersCount:O},structures:I,links:U}}function Pw(e){var t,i;let{modifyOriginal:n=!0,stageSequence:r=1,isMock:a}=e||{},o="generateDrawTypeAndModifyDrawDefinition";if(!e.drawDefinition)return La({result:{error:$t},stack:o});let s=n?e.drawDefinition:ts(e.drawDefinition,!1,!0),{tieFormat:l,matchUpType:u}=e;if(l){let e=Jo({tieFormat:l});if(e.error)return e}l=Jy(l??(null==(t=nf({drawDefinition:s}))?void 0:t.tieFormat)),u=u??(s.matchUpType||Ee),e.tieFormat=l,e.matchUpType=u;let d=Jv({drawDefinition:s,stage:il});e.drawSize=e.drawSize??d,!d&&e.drawSize&&tU({drawSize:e.drawSize,drawDefinition:s,stageSequence:r,stage:il});let c=rf({drawDefinition:s}).drawMatchUps.map(vc),p=ww(e);if(p.error)return La({result:p,stack:o});let{structures:m,links:f,qualifyingResult:h}=p;s.structures=m,s.links=f;let v=Math.max(e.qualifiersCount??0,(null==h?void 0:h.qualifiersCount)||0);if(null!=h&&h.qualifyingDrawPositionsCount&&!Jv({stage:nl,drawDefinition:s})){let e=tU({drawSize:h.qualifyingDrawPositionsCount,stage:nl,drawDefinition:s});if(e.error)return e}if(v){let e=iU({qualifiersCount:v,drawDefinition:s,stage:il});if(e.error)return e}let g=e.drawSize??d;Object.assign(e,_a({drawSize:g,matchUpType:u,tieFormat:l}));let{matchUps:I,matchUpsMap:U}=Qh({drawDefinition:s});l&&(null==I||I.forEach((e=>{if(!c.includes(e.matchUpId)){let{tieMatchUps:t}=ay({tieFormat:l,matchUp:e,isMock:a});Object.assign(e,{tieMatchUps:t,matchUpType:u})}})));let{inContextDrawMatchUps:y}=lv({drawDefinition:s,matchUpsMap:U});return kp({tournamentId:null==(i=e.tournamentRecord)?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:y,drawDefinition:s,matchUpsMap:U,...At,structures:m,matchUps:I,links:f}}function Dw(e){let t,i,{removePriorValues:n,tournamentRecord:r,participantId:a,scaleItem:o}=e;if(!bw({scaleItem:o}))return{error:wr};if(a&&Array.isArray(r.participants)&&(i=r.participants.find((e=>e.participantId===a)),i)){if(i.participantType===Hp&&(null==o?void 0:o.eventType)!==el)return{error:wr};let e=Rw({removePriorValues:n,participant:i,scaleItem:o});if(e.error)return e;t=!e.valueChanged;let{topics:a}=Pa();a.includes(mp)&&Ia({topic:mp,payload:{tournamentId:r.tournamentId,participants:[i]}})}return t&&{...At,info:_r,existingValue:null==o?void 0:o.scaleValue}||i&&{...At,newValue:null==o?void 0:o.scaleValue}||{error:_n}}function Tw(e){var t;let{scaleItemsWithParticipantIds:i=[],removePriorValues:n,tournamentRecord:r,auditData:a,context:o}=e;if(!r)return{error:Bt};if(!r.participants)return{error:Fn};let s=0,l={},u=[];for(let p of i){let e=null==p?void 0:p.participantId;if(Array.isArray(null==p?void 0:p.scaleItems))for(let t of p.scaleItems){if(!bw({scaleItem:t}))return{error:wr};Array.isArray(l[e])||(l[e]=[]),l[e].push(t)}}for(let p of r.participants){let{participantId:e}=p||{};if(Array.isArray(l[e]))for(let t of l[e]){if(p.participantType===Hp&&(null==t?void 0:t.eventType)!==el)return La({context:{participantId:e,scaleItem:t,participantType:p.participantType},info:"Invalid participantType for eventType",result:{error:wr}});Rw({participant:p,scaleItem:t,removePriorValues:n}),u.push(p),s++}}let d=s?void 0:Dr,{topics:c}=Pa();if(c.includes(mp)&&s&&Ia({topic:mp,payload:{tournamentId:r.tournamentId,participants:u}}),o){let{eventId:e,drawId:i,...n}=o,a=(null==(t=n.scaleAttributes)?void 0:t.scaleType)&&[n.scaleAttributes.scaleType];if(Object.keys(n).length){let t={itemType:ep,itemValue:n};if(a&&(t.itemSubTypes=a),i||e){let{drawDefinition:n,event:a}=Ch({tournamentRecord:r,eventId:e,drawId:i});i&&JI({drawDefinition:n,timeItem:t}),e&&oS({event:a,timeItem:t})}else aS({tournamentRecord:r,timeItem:t})}}return a&&c.includes(np)&&Ia({topic:np,payload:a}),_a({...At,modificationsApplied:s,info:d})}function bw({scaleItem:e}){let t=e&&Object.keys(e),i=["scaleType","eventType","scaleName"];return i.filter((e=>null==t?void 0:t.includes(e))).length===i.length}function Rw({removePriorValues:e,participant:t,scaleItem:i}){if(!t)return{error:kn};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter((e=>n.includes(e)&&i[e])).length!==r.length)return{error:wr};let a=(new Date).toISOString();t.timeItems||(t.timeItems=[]);let{scaleItem:o}=Ov({scaleAttributes:i,participant:t}),s=e=>[void 0,null,""].includes(e),l=!(s(null==o?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(null==o?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:n,eventType:r,scaleName:o}=i,s=[Ku,n,r,o].join("."),l=_a({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:s});i.scaleId&&(l.itemSubTypes=[i.scaleId]),e&&(t.timeItems=t.timeItems.filter((e=>e.itemType!==s))),t.timeItems.push(l)}return{...At,valueChanged:l,newValue:i.scaleValue}}function Nw(e){let{tournamentRecord:t,modifiedScaleValues:i,removePriorValues:n}=e,r=qu(e,[{[au]:!0},{modifiedScaleValues:!0,[Lu]:Ou}]);if(r.error)return r;for(let a in i){let e=Dw({scaleItem:i[a],removePriorValues:n,tournamentRecord:t,participantId:a});if(e.error)return e}return{...At}}function Mw(e){let{tournamentRecord:t,scaleAttributes:i,participantId:n}=e,r=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!n)return{error:xn};let{participant:a,tournamentId:o}=nm({tournamentRecords:r,tournamentRecord:t,participantId:n});return a?{...Ov({participant:a,scaleAttributes:i}),tournamentId:o}:{error:_n}}var Aw={nSpread:400,diffThreshold:.125,kCalc:(e=0)=>250/Math.pow(e+5,.4),kMultiplier:function(e=3,t=2){let i=e/t;return isNaN(i)?Aw.kDefault():i},kDefault:()=>1};function Ew(e){let{winnerRating:t,loserRating:i}=e,{ratings:n=py,winnerCountables:r=1,loserCountables:a=0,ratingType:o=ly,maxCountables:s,countables:l}=e||{},u=null==n?void 0:n[o];if(!u)return{error:un};let d=u.range||e.ratingRange;t=t||u.defaultInitialization,i=i||u.defaultInitialization;let c=d[0]>d[1],p=u.decimalsCount||0,m=c?d.slice().reverse():d,f=(e,t)=>parseFloat(t)>=Math.min(...e)&&parseFloat(t)<=Math.max(...e);(!f(d,t)||!f(d,i))&&(f(d,t)||(t=u.defaultInitialization),f(d,i)||(i=u.defaultInitialization));let h=sy({targetRange:py[ly].range,sourceRange:m,value:c?d[0]-t:t}),v=sy({targetRange:py[ly].range,sourceRange:m,value:c?d[0]-i:i}),g=(e,t)=>1/(1+Math.pow(10,(t-e)/Aw.nSpread)),I=g(h,v),U=g(v,h),y=Aw.kCalc(r),S=Aw.kCalc(a),w=Aw.kMultiplier(s,l),P=h+w*y*(1-I),D=v+w*S*(0-U),T=sy({sourceRange:py[ly].range,value:P,targetRange:m}),b=sy({sourceRange:py[ly].range,value:D,targetRange:m}),R=c?d[0]-T:T,N=parseFloat(R.toFixed(p)),M=c?d[0]-b:b,A=parseFloat(M.toFixed(p)),E=Math.max(...d)?Math.abs(t-i)/Math.max(...d):0;return(T>b&&E>Aw.diffThreshold||N<0||A<0)&&(N=t,A=i),{newWinnerRating:N,newLoserRating:A}}var Cw=e=>(null==e?void 0:e.reduce(((e,t)=>(t.winningSide&&(e[t.winningSide-1]+=1),e)),[0,0]))||[0,0];function Ow(e){var t,i;let n=qu(e,[{[au]:!0},{matchUpIds:!0,[Lu]:ku,[Mu]:zi},{ratingType:!1,[Fu]:e=>py[e]}]);if(n.error)return n;let{updateParticipantRatings:r,removePriorValues:a=!0,tournamentRecord:o,ratingType:s=ly,refreshDynamic:l,considerGames:u,drawDefinition:d,matchUpIds:c,asDynamic:p}=e,m=py[s],{accessor:f}=m,h={},v=(e.matchUps||l&&nv({drawDefinition:d,tournamentRecord:o,inContext:!0,matchUpFilters:{matchUpStatuses:Vc}}).matchUps||ev({matchUpFilters:{matchUpIds:c,matchUpStatuses:Vc},tournamentRecord:o,inContext:!0}).matchUps)??[],g=`${s}.${Hu}`,I=p?g:s;v.sort(iv);for(let y of v){let{endDate:e,matchUpFormat:n,score:d,sides:c,winningSide:p}=y,m=y.matchUpType,v={eventType:m,scaleName:s,scaleType:Yu},U={scaleName:g,eventType:m,scaleType:Yu},S=Object.assign({},...(c??[]).map((e=>{let{sideNumber:t,participant:i}=e;return t&&{[t]:[null==i?void 0:i.participantId,...(null==i?void 0:i.individualParticipantIds)??[]].filter(Boolean).flat()}}))),w=Object.assign({},...Object.values(S).flat().map((t=>{let i=!l||h[t]?Mw({scaleAttributes:U,tournamentRecord:o,participantId:t}).scaleItem:void 0,n=Mw({tournamentRecord:o,scaleAttributes:v,participantId:t}).scaleItem;return t&&{[t]:i??n??{scaleName:I,eventType:m,scaleDate:e,scaleType:Yu,scaleValue:f?{[f]:void 0}:void 0}}}))),P=n?no(n):{},D=(null==P?void 0:P.bestOf)||1,T=(null==P?void 0:P.setsTo)||1,b=u?D&T:D,R=(null==d?void 0:d.sets)&&Cw(d.sets)||1===p&&[1,0]||[0,1],N=p?S[p]:[],M=p?S[3-p]:[];for(let r of N){let e=null==(t=w[r])?void 0:t.scaleValue,n="object"==typeof e?e[f]:e;for(let t of M){let a=null==(i=w[t])?void 0:i.scaleValue,o="object"==typeof a?a[f]:a,l=p?R[p]:[0,0],u=p?R[3-p]:[0,0],{newWinnerRating:d,newLoserRating:c}=Ew({winnerCountables:l,loserCountables:u,maxCountables:b,winnerRating:n,loserRating:o,ratingType:s}),m=f?{...e,[f]:d}:d,h=f?{...a,[f]:c}:c;w[r].scaleValue=m,w[t].scaleValue=h,w[r].scaleName=I,w[t].scaleName=I}}Object.assign(h,w),r&&Nw({tournamentRecord:o,modifiedScaleValues:h,removePriorValues:a})}let U=v.map((({matchUpId:e})=>e));return{...At,modifiedScaleValues:h,outputScaleName:I,processedMatchUpIds:U}}function kw(e){var t;let{matchUpIds:i=[],drawDefinition:n,roundNumber:r,newRound:a,isMock:o,event:s}=e;if("object"!=typeof n)return{error:$t};let{participantIdPairings:l,matchUpsCount:u}=e,d=bS(e);if(d.error)return La({result:d});let{lastRoundNumber:c,availableMatchUpsCount:p=0,roundMatchUpsCount:m=0}=d;if(u){if(u>m&&!1!==e.restrictMatchUpsCount)return La({result:{error:Cr,info:"matchUpsCount error",context:{roundMatchUpsCount:m}}})}else a?u=m:p>0&&(u=p);if(l&&!Array.isArray(l)||u&&!Ye(u)||i&&!Array.isArray(i)||!l&&!u)return{error:Cr,info:"matchUpsCount or pairings error"};if(u&&!1!==e.restrictMatchUpsCount&&u>32)return{error:Cr,info:"matchUpsCount must be less than 33"};if(r&&!e.ignoreLastRoundNumber&&r-1>(c||0))return{error:Cr,info:"roundNumber error"};let f=r??(a&&(c??0)+1||c||1);l=l??lt(0,u).map((()=>({participantIds:[void 0,void 0]})));let h=null==l?void 0:l.map(((t,r)=>{let a=(null==t?void 0:t.participantIds)??[void 0,void 0];a.push(void 0,void 0);let o=a.slice(0,2).map(((e,t)=>_a({sideNumber:t+1,participantId:e}))),s=i[r]??(t=>{if(!e.idPrefix)return;return`${n.drawId}-${e.idPrefix??"ah"}-${f}-${t}`})(r)??rs();return{roundNumber:f,matchUpStatus:Oc,matchUpId:s,sides:o}}));if(null!=h&&h.length){let e=null==(t=nf({drawDefinition:n,event:s}))?void 0:t.tieFormat;e&&h.forEach((t=>{let{tieMatchUps:i}=ay({tieFormat:e,matchUp:t,isMock:o});Object.assign(t,{tieMatchUps:i,matchUpType:Fe})}))}return{roundNumber:f,matchUpsCount:(null==h?void 0:h.length)??0,matchUps:h,...At}}function Fw(e){return e.participantIdPairings.map((({participantIds:e})=>e.sort().join("|"))).sort().join("/")}function xw({valueSortedPairings:e,stipulated:t=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let o=[].concat(...t),s=[],l=0;t.filter(Boolean).forEach((e=>{let[t,n]=e,r=_w(t,n),a=i[r];s.push({participantIds:e,value:a}),l+=i[r]})),ht(e,a).map((e=>Xe(e).map((e=>({...e,value:e.value+Math.random()*Math.round(Math.random())}))))).flat().forEach((e=>{let t=e.pairing.split("|");if(!t.reduce(((e,t)=>o.includes(t)||e),!1)){o.push(...t);let i=e.value;l+=i,s.push({participantIds:t,value:i})}})),s.sort(((e,t)=>e.value-t.value));let u=s.reduce(((e,t)=>{let[i,r]=t.participantIds,a=_w(i,r),o=n[a];return o>e?o:e}),0),d=s.reduce(((e,t)=>{let[i,n]=t.participantIds,a=_w(i,n),o=r[a];return o>e?o:e}),0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:d}}function _w(e,t){return[e,t].sort(Gv).join("|")}function Lw({participantIds:e}){let t={},i=[];e.forEach((n=>{t[n]=e.filter((e=>e!==n)),t[n].forEach((e=>{let t=_w(e,n);i.includes(t)||i.push(t)}))}));let n=Object.assign({},...i.map((e=>({[e]:0}))));return{uniquePairings:i,possiblePairings:t,deltaObjects:n}}var Bw=0;function Vw(e){let{tournamentParticipants:t,adHocRatings:i={},possiblePairings:n,uniquePairings:r,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:u,scaleName:d,salted:c}=e;r.forEach((e=>{let n=function({tournamentParticipants:e,adHocRatings:t,eventType:i,scaleName:n,pairing:r}){var a;let o=(null==(a=py[n])?void 0:a.defaultInitialization)??Bw;return r.split("|").map((n=>{var r;if(i===Qs){let i=null==(r=null==e?void 0:e.find((e=>e.participantId===n)))?void 0:r.individualParticipantIds;return i?null==i?void 0:i.map((e=>t[e]||o)):2*o}return t[n]||o}))}({tournamentParticipants:t,adHocRatings:i,scaleName:d,eventType:u,pairing:e}),r="number"==typeof c&&c||.5,a=c&&(Math.round(Math.random())?r:-1*r)||0,o=Math.abs(n[0]-n[1])+a,p=Math.abs(n[0]-n[1]);s[e]=p,l[e]||(l[e]=0),l[e]+=o?Math.pow(o,2):0}));let p=r.map((e=>({pairing:e,value:l[e]}))).sort(((e,t)=>e.value-t.value)),{pairingValues:m}=function({possiblePairings:e,valueObjects:t}){let i={};for(let r of Object.keys(e)){let t=e[r].map((e=>n(r,e)));i[r]=t.sort(((e,t)=>e.value-t.value))}function n(e,i){let n=_w(e,i);return{opponent:i,value:t[n]}}return{pairingValues:i}}({possiblePairings:n,valueObjects:l}),{candidate:f,candidatesCount:h,deltaCandidate:v,iterations:g}=function({maxIterations:e=4e3,valueSortedPairings:t,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...t.map((e=>({[e.pairing]:e.value})))),o=Object.keys(i),s=[],l=xw({actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:r,valueObjects:n}),u=[Fw(l)];s.push(l);let d,c=l.value,p=l,m=1,f=0,h=o.length;do{h-=1,d=o.length*i[o[0]].length}while(d>e&&h>5);let v=[];o.forEach((e=>{i[e].slice(0,h).forEach((i=>{f+=1;let l=_w(e,i.opponent);if(!v.includes(l)){let d=xw({stipulated:[[e,i.opponent]],actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!u.includes(Fw(d))){u.push(Fw(d)),s.push(d);let{maxDelta:e,value:t}=d;e<p.maxDelta&&(p=d),(t<c||t===c&&Math.round(Math.random()))&&(c=t),v.push(l),m+=1}}})),s=s.filter((e=>Math.abs(e.value-c)<5))})),s.sort(((e,t)=>e.maxDiff-t.maxDiff));let g=ot(s);return{candidatesCount:m,deltaCandidate:p,maxIterations:e,iterations:f,candidate:g}}({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:l}),{participantIdPairings:I}=o?v:f;return{participantIdPairings:I,candidatesCount:h,deltaCandidate:v,iterations:g,candidate:f}}var jw=100,Gw=100,$w=4e3;function qw(e){var t,i;let{encounterValue:n=jw,sameTeamValue:r=Gw,maxIterations:a=$w,updateParticipantRatings:o,generateMatchUps:s=!0,ignoreLastRoundNumber:l,iterationMatchUps:u,tournamentRecord:d,dynamicRatings:c,refreshDynamic:p,participantIds:m,drawDefinition:f,roundNumber:h,structureId:v,matchUpIds:g,eventType:I,scaleName:U,idPrefix:y,isMock:S,salted:w,event:P}=e;if(!f)return{error:$t};if(!e.structure&&!v)return{error:Si};let D=e.structure||Hc({drawDefinition:f,structureId:v}).structure;if(!wt(D))return{error:Pi};if(null==m||!m.length)return{error:Vn};let T=[...u??[],...(null==D?void 0:D.matchUps)??[]],{encounters:b}=function({matchUps:e}){let t=[];for(let i of e){let e=i.sides.map(hc);if(2===e.length){let[i,n]=e,r=_w(i,n);t.includes(r)||t.push(r)}}return{encounters:t}}({matchUps:T}),R=(null==d?void 0:d.participants)??[],N={};if(c){let e=Qe(null!=D&&D.matchUps?D.matchUps.map((({roundNumber:e})=>e)):[]),n=Math.max(...e,0);if(n){let e=null==(t=null==D?void 0:D.matchUps)?void 0:t.filter((({roundNumber:e})=>e===n)).map((({matchUpId:e})=>e)),r=Ow({ratingType:U??(null==(i=null==P?void 0:P.category)?void 0:i.ratingType),updateParticipantRatings:o,tournamentRecord:d,asDynamic:!0,refreshDynamic:p,drawDefinition:f,matchUpIds:e});if(r.error)return r;r.modifiedScaleValues&&(N=r.modifiedScaleValues)}}let M,A,{valueObjects:E}=function({encounters:e,tournamentParticipants:t,encounterValue:i,sameTeamValue:n}){let r={};for(let o of e)r[o]||(r[o]=0),r[o]+=i;let a=null==t?void 0:t.filter((({participantType:e})=>e===Jp));if(a)for(let o of a){let e=o.individualParticipantIds??[],{uniquePairings:t}=Lw({participantIds:e});for(let i of t)r[i]||(r[i]=0),r[i]+=n}return{valueObjects:r}}({tournamentParticipants:R,encounterValue:n,sameTeamValue:r,encounters:b}),{uniquePairings:C,possiblePairings:O,deltaObjects:k}=Lw({participantIds:m}),F={tournamentParticipants:R,possiblePairings:O,participantIds:m,uniquePairings:C,drawDefinition:f,maxIterations:a,adHocRatings:Object.values(N).length?N:e.adHocRatings,deltaObjects:k,valueObjects:E,eventType:I,scaleName:U,structure:D,salted:w},{candidatesCount:x,participantIdPairings:_,deltaCandidate:L,iterations:B,candidate:V}=Vw(F);if(!x)return{error:br};if(s){let e=kw({structureId:null==D?void 0:D.structureId,ignoreLastRoundNumber:l,participantIdPairings:_,newRound:!0,drawDefinition:f,roundNumber:h,matchUpIds:g,idPrefix:y,isMock:S,event:P});if(e.error)return e;M=e.roundNumber,A=e.matchUps}let{maxDelta:j,maxDiff:G}=V;return{roundNumber:M,participantIdPairings:_,modifiedScaleValues:N,candidatesCount:x,deltaCandidate:L,...At,iterations:B,matchUps:A,maxDelta:j,maxDiff:G}}function Ww(e){var t,i,n,r;let{drawType:a=Ml,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:u,automated:d,placeByes:c,isMock:p,event:m}=e,f=null==e?void 0:e.drawDefinition;if(!f)return{error:$t};let h=al,v=Zm({stageSequence:1,drawDefinition:f,stage:h}),g=[Hl,Al,zl].includes(a)?v.length:He(v.length);if(!u&&a===bl&&v.length<2||a===Hl&&v.length<3)return{error:ai};let{tieFormat:I,matchUpType:U}=e;if(I){let e=Jo({tieFormat:I});if(e.error)return e}I=Jy(I??(null==(t=nf({drawDefinition:f}))?void 0:t.tieFormat)),U=U??f.matchUpType;let{structures:y}=zc({stageSequence:1,drawDefinition:f,stage:h});if(y.length>1)return{error:ki};if(null!=(n=null==(i=null==y?void 0:y[0])?void 0:i.matchUps)&&n.length)return{error:Wr};let S=null==(r=null==y?void 0:y[0])?void 0:r.structureId;Object.assign(e,_a({structureName:e.structureName??Tg(al),structureId:S,matchUpType:U,tieFormat:I,drawSize:g,stage:h}));let w=Sw(e);if(w.error)return w;let P=w.generators[a];if(!P)return{error:Zt};let D=null==P?void 0:P();if(D.error)return D;let{structures:T,links:b}=D,R=T.map((e=>jh({structure:e}).matchUps)).flat();I&&R.forEach((e=>{let{tieMatchUps:t}=ay({matchUp:e,tieFormat:I,isMock:p});Object.assign(e,{tieMatchUps:t,matchUpType:U})})),(!s||!o)&&(f=ts(f,!1,!0)),f.links||(f.links=[]),b.length&&f.links.push(...b);let N=T.map((({structureId:e})=>e));f.structures||(f.structures=[]);let M=f.structures.map((({structureId:e})=>e));f.structures=f.structures.map((e=>N.includes(e.structureId)?T.find((({structureId:t})=>t===e.structureId)):e));let A=T.filter((({structureId:e})=>!M.includes(e)));return A.length&&f.structures.push(...A),d&&$I({seedingProfile:e.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:f,structureId:S,placeByes:c,drawSize:g,event:m}),o&&kp({drawDefinition:f}),{links:b,structures:T,...At}}var Hw={};be(Hw,{addGame:()=>rP,addPoint:()=>nP,addSet:()=>oP,addShot:()=>aP,analyzeScore:()=>kD,analyzeSet:()=>BD,calculateHistoryScore:()=>Xw,checkScoreHasValue:()=>dv,checkSetIsComplete:()=>rD,clearHistory:()=>iP,generate:()=>zw,generateScoreString:()=>Yw,generateTieMatchUpScore:()=>Yy,getSetComplement:()=>xD,getTiebreakComplement:()=>_D,helpers:()=>dP,isValidMatchUpFormat:()=>co,keyValueScore:()=>uD,mutate:()=>Qw,parseMatchUpFormat:()=>no,parseScoreString:()=>LD,query:()=>OD,redo:()=>sP,reverseScore:()=>Jw,setServingSide:()=>tP,stringifyMatchUpFormat:()=>Za,tidyScore:()=>CD,umo:()=>uP,undo:()=>lP,validateScore:()=>FD,validateTieFormat:()=>Jo});var zw={};function Yw(e){let{winnerFirst:t=!0,setTBlast:i=!0,addOutcomeString:n,reversed:r=!1,matchUpStatus:a,matchUpFormat:o,autoComplete:s,winningSide:l,sets:u}=e;if(!u)return{error:un,info:"missing sets"};let d=o&&no(o),{bestOf:c,finalSetFormat:p,setFormat:m}=d??{},f=r||!(!t||!l||1===l),h=n?function({matchUpStatus:e}){let t={[Ec]:"RET",[kc]:"WO",[bc]:"DF/DF",[Rc]:"WO/WO",[Cc]:"SUS",[Uc]:"ABN",[Tc]:"DEF",[Dc]:"DR"};return e&&t[e]||""}({matchUpStatus:a}):"",v=(null==u?void 0:u.sort(Kw).map((function(e){let t=c&&e.setNumber===c&&p?p:m,n=(v=e,qe(null==v?void 0:v.side1TiebreakScore)||qe(null==v?void 0:v.side2TiebreakScore)),r=(null==t?void 0:t.tiebreakSet)||!(e=>qe(null==e?void 0:e.side1Score)||qe(null==e?void 0:e.side2Score))(e)&&n,{side1Score:a,side2Score:o,side1TiebreakScore:l,side2TiebreakScore:u}=e,d=l||(qe(l)||n&&s?0:""),h=u||(qe(u)||n&&s?0:"");var v;if(r)return`[${(f?[h,d]:[d,h]).join("-")}]`;let g=n?Math.min(d,h):"",I=g===d?1:2,U=qe(g)?`(${g})`:"",y=a||(qe(a)||s?0:""),S=o||(qe(o)||s?0:""),w=e=>i||I!==e?"":U,P=`${y}${w(1)}`,D=`${S}${w(2)}`,T=i&&n?`(${g})`:"",b=f?`${[D,P].join("-")}${T}`:`${[P,D].join("-")}${T}`;return["-"," "].includes(b)&&(b=""),b})).filter(Boolean).join(" "))||"";return h?2===l?`${h} ${v}`:`${v} ${h}`:v}function Kw(e,t){return e.setNumber-t.setNumber}function Jw(e){if(null==e||!e.score)return{error:un};let{sets:t}=e.score,i=t.map((e=>{let{side1TiebreakScore:t,side2TiebreakScore:i,winningSide:n,side1Score:r,side2Score:a,setNumber:o}=e;return _a({winningSide:n?3-n:void 0,side1TiebreakScore:i,side2TiebreakScore:t,side1Score:a,side2Score:r,setNumber:o})})),n=null==e?void 0:e.setTBlast;return{reversedScore:{sets:i,scoreStringSide1:Yw({setTBlast:n,sets:i}),scoreStringSide2:Yw({sets:i,reversed:!0,setTBlast:n})},...At}}be(zw,{generateScoreString:()=>Yw,generateTieMatchUpScore:()=>Yy,reverseScore:()=>Jw});var Qw={};function Zw({matchUp:e}){let{extension:t}=Cd({name:Hd,element:e});if(!t)return{error:Lr};let{history:i=[],undoHistory:n=[]}=t.value;return{history:i,undoHistory:n,...At}}function Xw(e){var t,i;if(!e)return{error:un};let{matchUp:n,updateScore:r}=e;if(!n)return{error:Ji};let a=(null==(t=Zw({matchUp:n}))?void 0:t.history)||[];if(!Array.isArray(a))return{error:Cr,info:"history is not an array"};let{matchUpFormat:o}=n;if(!o)return{error:$i};if(!co({matchUpFormat:o}))return{error:Gi};let s,l,u=no(o),{bestOf:d,finalSetFormat:c,setFormat:p}=u,m=["0","15","30","40","A","G"],f={sets:[]},h=[],v=[0,0],g=1,I=0,U=0,y=e=>[1,2].includes(e),S=()=>(I+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:I,games:[]}),w={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},P={winningSide:void 0,points:[]},D=S(),T=0;for(let b of a){T+=1,l=f.sets.length+1===d;let e=l&&c?c:p,{tiebreakAt:t,setTo:n,NoAD:r,tiebbreakFormat:a}=e,o=D.side1Score===t&&D.side1Score===D.side2Score,u=!!e.tiebreakSet,I=u?e.tiebreakSet:a,{tiebreakTo:R,NoAD:N}=I||{},M=()=>{s=void 0,v=[0,0],g=3-g,D.side1TiebreakScore="",D.side2TiebreakScore="",D.side1PointScore="",D.side2PointScore="",U=0},A=e=>{D.winningSide=e;let{s:t,...i}=D;f.sets.push(i),w={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},P={winningSide:void 0,points:[]},D=S(),M()},E=e=>{P.winningSide=e;let{g:t,...i}=P;D.games.push(i),w={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},P={winningSide:void 0,points:[]},M(),D[`side${e}Score`]+=1},C=e=>{w.winningSide=e;let{p:t,...i}=w;P.points.push(i),w={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},U=0;let n=e-1;if(o||u){v[n]+=1,s=v.reduce(((e,t)=>e+t))%4/4>.5?g:3-g,D[`side${e}TiebreakScore`]=v[n],D[`side${3-e}TiebreakScore`]=v[1-n];let t=N?1:2;if(v[n]>=R&&v[n]>=v[1-n]+t)return E(e),{gameCompleted:!0}}else if(4===v[1-n]&&3===v[n]?v[1-n]-=1:v[n]+=1,D.side1PointScore=m[v[0]],D.side2PointScore=m[v[1]],5===v[n]||4===v[n]&&v[1-n]<3||r&&4===v[n])return E(e),{gameCompleted:!0}};if(y(b.srv)&&(g=b.srv),["p","s","g","o"].includes(b.u)&&h.push(b.u),b.shotOutcome&&(w.shots.push(b),"SERVE"===b.shotType&&["OUT","NET"].includes(b.shotOutcome)&&(U+=1),2===U)){C(3-g)}if(y(b.p)||Ye(b.pointNumber)){if(null!=(i=C(b.winningSide||b.p))&&i.gameCompleted)continue}if(y(b.g)||Ye(b.gameNumber)){let e=b.winningSide||b.g;P.winningSide=e;let t=`side${e}Score`,i=`side${3-e}Score`;if(h.length&&(h.includes("p"),h=[]),E(e),D[t]===n&&D[t]-D[i]>=(r?1:2)&&(A(e),l))break}if(y(b.s)||Ye(b.setNumber)){if(A(b.winningSide||b.s),h.length&&(h.includes("p"),h.includes("g"),h=[]),l)break}}return T!==a.length&&console.log({error:"Match completed with excess history"}),(D.side1Score||D.side2Score||D.games.length||D.side1TiebreakScore||D.side2TiebreakScore)&&f.sets.push(D),f.scoreStringSide1=Yw({...f,matchUpFormat:o}),f.scoreStringSide2=Yw({...f,matchUpFormat:o,reversed:!0}),g=s||g,r&&(n.score=f),{...At,servingSide:g,score:f}}function eP({undoHistory:e,history:t,matchUp:i}){return Sd({element:i,extension:{value:{history:t,undoHistory:e},name:Hd}})}function tP({matchUp:e,sideNumber:t}){if(![1,2].includes(t))return{error:on};let{history:i=[]}=Zw({matchUp:e});return i.push({srv:t}),eP({matchUp:e,history:i})}function iP({matchUp:e}){return eP({matchUp:e})}function nP({matchUp:e,point:t}){if(!t||!e)return{error:un};if("object"!=typeof t)return{error:Cr,context:{point:t}};let{history:i=[]}=Zw({matchUp:e});return i.push(t),eP({matchUp:e,history:i})}function rP({matchUp:e,game:t}){if("object"!=typeof t)return{error:Cr,context:{game:t}};let{history:i=[]}=Zw({matchUp:e});return i.push(t),eP({matchUp:e,history:i})}function aP({matchUp:e,shot:t}){if("object"!=typeof t)return{error:un};let{history:i=[]}=Zw({matchUp:e});return i.push(t),eP({matchUp:e,history:i})}function oP({matchUp:e,set:t}){if("object"!=typeof t)return{error:un};let{history:i=[]}=Zw({matchUp:e});return i.push(t),eP({matchUp:e,history:i})}function sP({matchUp:e}){let{history:t=[],undoHistory:i=[]}=Zw({matchUp:e});return i.length&&t.push(i.pop()),eP({matchUp:e,history:t,undoHistory:i})}function lP({matchUp:e}){let{history:t=[],undoHistory:i=[]}=Zw({matchUp:e});return i.push(t.pop()),eP({matchUp:e,history:t,undoHistory:i})}be(Qw,{addGame:()=>rP,addPoint:()=>nP,addSet:()=>oP,addShot:()=>aP,calculateHistoryScore:()=>Xw,clearHistory:()=>iP,redo:()=>sP,setServingSide:()=>tP,umo:()=>uP,undo:()=>lP});var uP={},dP={};be(dP,{keyValueScore:()=>uD,parseMatchUpFormat:()=>no,stringifyMatchUpFormat:()=>Za,tidyScore:()=>CD});var cP=" ",pP="DEF",mP="COMPLETED",fP="WO",hP="ABN",vP="SUS",gP="RET",IP="INT",UP=[gP,pP,fP,"WO/WO",hP,vP,IP],yP="DEFAULTED",SP="WALKOVER",wP="ABANDONED",PP="SUSPENDED",DP="RETIRED",TP="INTERRUPTED",bP=[DP,yP,SP],RP="()",NP="[]",MP=["up","left","shift+tab"],AP=["enter","down","tab","right"],EP="backspace",CP="r",OP="s",kP="a",FP="d",xP="w",_P="i",LP=[CP,FP,xP,kP,OP,_P],BP="space",VP=["[","("],jP=[...MP,...AP,BP,"]"],GP="-",$P="-",qP=["/"],WP=0,HP=["0","1","2","3","4","5","6","7","8","9"].concat(LP),zP=HP.map((e=>`shift+${e}`)),YP=[GP,EP].concat(jP,qP),KP=[HP,zP,YP].join(","),JP=[KP,MP,AP,["=","+","num_1","num_2","shift+=","shift+-"]].join(","),QP={OUTCOMEKEYS:LP,SIDE1KEYS:HP,SIDE2KEYS:zP,MODIFIERS:YP,PROMPT:"Enter Score",MOVEUP:MP,MOVEDOWN:AP,HOTKEYS:JP};function ZP({scoreString:e,lowSide:t,outcome:i}){if(({scoreString:e}=XP({scoreString:e})),2===t){return e+((e&&e[e.length-1])!==cP?cP:"")+i}return i+cP+e}function XP({scoreString:e}){if(!e)return{scoreString:""};let t=!1;for(let i of UP){let n=null==e?void 0:e.indexOf(i);0===n?e=e.slice(i.length+1).trim()+cP:n>0&&(e=e.slice(0,n)),n>=0&&(t=!0)}return null!=e&&e.trim()||(e=""),{scoreString:e,removed:t}}function eD({analysis:e,scoreString:t,sets:i,lowSide:n}){var r,a,o;let s,l;if(!t)return{scoreString:t,sets:i};let{scoreString:u,removed:d}=XP({scoreString:t});if(t=u,d)return{scoreString:t,sets:i,outcomeRemoved:!0};let c=i[i.length-1]||{},p=Object.values(c).filter((e=>void 0!==e)).length;c.setNumber&&1===p&&(c=(i=i.slice(0,i.length-1))[i.length-1]||{});let{tiebreakSet:m}=e.setFormat,{tiebreakTo:f,NoAD:h}=m||{},{isTiebreakEntry:v}=tD({brackets:NP,scoreString:t}),g=function(e){return e.split("").reduce(((e,t,i)=>(t.match(/\d+/g)&&e.push(i),e)),[]).pop()}(t);if(g>=0){s=t.slice(0,g);let{isTiebreakEntry:u}=tD({brackets:RP,scoreString:s}),{lastOpenBracketIndex:d,isTiebreakEntry:p}=tD({brackets:NP,scoreString:s}),m=s&&s[s.length-1].trim(),I=s&&!isNaN(m),U=e.isIncompleteSetScore;if(v&&p){let e=s.slice(d+1).split($P),i=(null==e?void 0:e.length)>0&&void 0!==e[0]&&!isNaN(parseInt(e[0]))&&parseInt(e[0])||void 0,r=(null==e?void 0:e.length)>1&&void 0!==e[1]&&parseInt(e[1])||void 0,a=[i,r];if(r){let e=1===n?1:0;a[e]=((null==a?void 0:a[1-e])||0)+(h?1:2),(a[e]||0)<f&&(a[e]=f),s=t.slice(0,d+1),s+=a.join($P)}else void 0!==i?(s=t.slice(0,d+1),s+=i):(s=t.slice(0,d),U=!0);c.side1TiebreakScore=a[0]||0,c.side2TiebreakScore=a[1]||0}if(s.length||(s=void 0),U){let t=null==(r=c.side1Score)?void 0:r.toString();if(t){let e=null==t?void 0:t.slice(0,t.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}e.isTimedSet?(l=c.side1Score?i:(null==i?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=c):l=(null==i?void 0:i.slice(0,i.length-1))||[]}else if(I){let t=null==(a=c.side2Score)?void 0:a.toString(),n=null==(o=c.side1Score)?void 0:o.toString();if(!e.isTiebreakEntry&&!e.isMatchTiebreak)if(c.side2Score){let e=null==t?void 0:t.slice(0,t.length-1);c.side2Score=!isNaN(e)&&parseInt(e)||void 0}else{let e=null==n?void 0:n.slice(0,n.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0}e.isTimedSet?c.side1Score?(l=i||[],l[i.length-1]=c):l=(null==i?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=c),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else u?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(v&&!p?l=(null==i?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=c),v||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:t,sets:i}}function tD({brackets:e=RP,scoreString:t}){if(!t)return{};let[i,n]=e.split(""),r=t.split(""),a=Math.max(...ut(i,r));return{isTiebreakEntry:a>Math.max(...ut(n,r)),lastOpenBracketIndex:a}}function iD(e){let{lowValue:t=0,NoAD:i=!1,tiebreakTo:n}=e||{};return t+1>=n?t+(i?1:2):parseInt(n)}function nD({matchUpFormat:e,matchUpStatus:t,winningSide:i,sets:n}){var r;let a=no(e),{bestOf:o}=a,s=Math.ceil(o/2),l=(null==(r=null==n?void 0:n.reduce(((e,t)=>{let{winningSide:i}=t;return i&&e[i-1]++,e}),[0,0]))?void 0:r.indexOf(s))+1||void 0;return bP.includes(t)&&i&&(l=i),{matchUpWinningSide:l}}function rD({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,isTimedSet:a,set:o}){var s;if(!o)return{error:un,info:"missing set"};t=t||i&&no(i);let l=r&&t.finalSetFormat||(null==t?void 0:t.setFormat)||{},{side1Score:u,side2Score:d}=o,{setTo:c,tiebreakAt:p}=l,m=u||d,f=aD({set:o}),h=Math.abs(u-d),v=u>=c||d>=c,g=n||u>=c&&d>=c||p&&p<c&&(u===p||d===p),I=e||g&&(1===f&&o.side1TiebreakScore>o.side2TiebreakScore||2===f&&o.side2TiebreakScore>o.side1TiebreakScore),U=!g&&l.NoAD||g||n&&null!=(s=l.tiebreakFormat)&&s.NoAD?1:2;return!(!(a&&m||v&&(h>=U||g)||n)||g&&!I)}function aD({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}function oD({analysis:e,set:t}){let i=aD({set:t}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=e;return rD({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:t})&&i}function sD({lowSide:e,value:t,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return t===CP?n?(o=!0,n=ZP({scoreString:n,lowSide:e,outcome:gP}),r=2===e?1:2,a=DP):(o=!0,n=ZP({scoreString:n,lowSide:e,outcome:pP}),r=2===e?1:2,a=yP):t===FP?(o=!0,n=ZP({scoreString:n,lowSide:e,outcome:pP}),r=2===e?1:2,a=yP):t===xP?(o=!0,i=[],n=fP,r=2===e?1:2,a=SP):t===OP&&n?(o=!0,n=ZP({scoreString:n,lowSide:e,outcome:vP}),a=PP,r=void 0):t===kP?(o=!0,n=ZP({scoreString:n,lowSide:e,outcome:hP}),a=wP,r=void 0):t===_P&&n&&(o=!0,n=ZP({scoreString:n,lowSide:e,outcome:IP}),a=TP,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function lD({matchUpFormat:e,scoreString:t,winningSide:i,value:n,sets:r}){var a,o,s;let l=((null==(a=null==r?void 0:r.filter((e=>null==e?void 0:e.winningSide)))?void 0:a.length)||0)+(i?0:1),u=no(e),d=l===(null==u?void 0:u.bestOf),c=d&&(null==u?void 0:u.finalSetFormat)||(null==u?void 0:u.setFormat)||{},p=null==c?void 0:c.timed,m=d&&r[(null==u?void 0:u.bestOf)-1],f=null==m?void 0:m.winningSide,{isTiebreakEntry:h}=tD({brackets:RP,scoreString:t}),{isTiebreakEntry:v}=tD({brackets:NP,scoreString:t}),g=h||v,I=!!c.tiebreakSet,U=null==(o=null==t?void 0:t[t.length-1])?void 0:o.trim(),y=t&&!isNaN(U),S=!g&&U===GP,w=h&&VP.includes(U),P=v&&VP.includes(U),D=v&&U===$P,T=null==t?void 0:t.split(""),[b]=NP.split(""),R=T&&Math.max(...ut(b,T)),N=T&&Math.max(...ut($P,T)),M=T&&N>R,A=null==(s=r[r.length-1])?void 0:s.winningSide,E=(null==r?void 0:r.length)&&!A,C=UP.find((e=>(null==t?void 0:t.indexOf(e))>=0)),O=!isNaN(n),k=n===BP,F=jP.includes(n),x=null==t?void 0:t.split("").find((e=>VP.includes(e))),_=F&&v&&!P&&(D||!function({scoreString:e}){if(!e)return!1;let t=e&&e[e.length-1].trim(),i=e&&!isNaN(t),[n,r]=NP.split(""),a=e.split(""),o=Math.max(...ut(n,a)),s=Math.max(...ut(r,a)),l=Math.max(...ut($P,a));return i&&o>s&&l>o}({scoreString:t}));return{isTiebreakSetValue:I&&O,matchUpScoringFormat:u,setNumber:l,setFormat:c,matchTiebreakHasJoiner:M,isGameScoreEntry:E,isSpace:k,isCloser:F,isTiebreakCloser:F&&x&&g&&y,isDecidingSet:d,isTiebreakSet:I,isTimedSet:p,isNumericEnding:y,isNumericValue:O,hasOpener:x,hasOutcome:C,finalSet:m,finalSetIsComplete:f,lastSetIsComplete:A,isInvalidSetTiebreakValue:k&&g&&w,isInvalidMatchTiebreakValue:_,isTiebreakEntry:g,isSetTiebreakEntry:h,isMatchTiebreakEntry:v,isIncompleteSetScore:S,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:P,isPartialMatchTiebreakValue:D}}function uD(e){let t,i,{lowSide:n=1,value:r}=e,{scoreString:a,sets:o,winningSide:s,matchUpStatus:l}=e,{matchUpFormat:u,shiftFirst:d,auto:c=!0}=e,p=d&&2===n||!d&&1===n;if(!KP.includes(r))return{updated:!1,info:"invalid key"};d&&(n=3-n);let{matchUpWinningSide:m}=nD({sets:o,winningSide:s,matchUpStatus:l,matchUpFormat:u});s=m;let f=lD({value:r,winningSide:s,scoreString:a,sets:o,matchUpFormat:u});if(qP.includes(r)&&(r=GP),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===Be(r)&&(f.isTiebreakCloser=!0),jP.includes(r)&&f.hasOpener&&(r=""),jP.includes(r)&&(r=BP),f.lastSetIsComplete){let e=(null==a?void 0:a.length)&&a[a.length-1];a&&" "!==e&&(a+=" ")}if(f.isTimedSet)({info:i,sets:o,scoreString:a,updated:t,matchUpStatus:l,winningSide:s}=function(e){let t,i,{sets:n,info:r,scoreString:a,winningSide:o,matchUpStatus:s}=e,{analysis:l,lowSide:u,value:d}=e;(null==n||!n.length)&&d!==EP&&(n=[{setNumber:1}]);let c=n.length-1;if(LP.includes(d)){let e=n[n.length-1]||{},{side1Score:i,side2Score:c}=e;i&&!c?r="missing side2Score":l.finalSetIsComplete||o?r="final set is already complete":l.isIncompleteSetScore?r="incomplete set scoreString":l.isIncompleteSetScore||({sets:n,scoreString:a,winningSide:o,matchUpStatus:s,updated:t}=sD({lowSide:u,value:d,sets:n,scoreString:a,matchUpStatus:s,winningSide:o}))}else if(d===EP){if(({scoreString:a,sets:n,outcomeRemoved:i}=eD({analysis:l,scoreString:a,sets:n})),""===(null==a?void 0:a.trim())&&(a=a.trim()),a||(n=[]),i){let e=n[n.length-1]||{},{side1Score:t,side2Score:i}=e;if(t&&i){let r=(t>i?1:i>t&&2)||void 0;r&&(e.winningSide=r,n.push({setNumber:n.length+1}))}}s=void 0,o=void 0,t=!0}else if(l.hasOutcome)r="has outcome";else{if(o)return{sets:n,scoreString:a,winningSide:o,matchUpStatus:s,updated:!1,info:"matchUp is complete"};if(d===BP){let e=n[n.length-1]||{},{side1Score:i,side2Score:r}=e,s=(i>r?1:r>i&&2)||void 0;s&&!o&&!l.isIncompleteSetScore&&(n[n.length-1].winningSide=s,n.push({setNumber:n.length+1}),a+=" ",t=!0)}else if(d===GP&&void 0!==n[c].side1Score&&void 0===n[c].side2Score&&a&&l.isNumericEnding)a+="-",n[c].side2Score=0,s=void 0,o=void 0,t=!0;else if(!isNaN(d)){let e;if(void 0===n[c].side2Score){let i=Be((n[c].side1Score||0).toString()+d).toString().slice(0,2);n[c].side1Score=Be(i),e=n[c].side1Score.toString(),t=!0}else{let i=Be((n[c].side2Score||0).toString()+d).toString().slice(0,2);n[c].side2Score=Be(i),e=[n[c].side1Score,n[c].side2Score].join("-"),t=!0}if(t){let t=(n.slice(0,c)||[]).filter((e=>e)).map((e=>{let{side1Score:t,side2Score:i}=e;return[t,i].join("-")})).join(" ");a=t?t+" "+e:e}}}return{sets:n,scoreString:a,winningSide:o,matchUpStatus:s,info:r,updated:t}}({analysis:f,lowSide:n,scoreString:a,sets:o,matchUpStatus:l,winningSide:s,value:r}));else if(LP.includes(r))f.finalSetIsComplete||s?i="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?i="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:r}):({sets:o,scoreString:a,matchUpStatus:l,winningSide:s,updated:t}=sD({lowSide:n,sets:o,scoreString:a,matchUpStatus:l,winningSide:s,value:r}));else if(r===EP)t=!0,({scoreString:a,sets:o}=eD({analysis:f,scoreString:a,sets:o,lowSide:n})),a||(o=[]),l=void 0,s=void 0;else if(f.hasOutcome)i="has outcome";else if(r!==GP||f.isMatchTiebreakEntry)if(r===$P&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?i="existing joiner":f.isNumericEnding&&(t=!0,a+=$P);else if([GP,$P].includes(r))i="invalid location for joiner";else{if(s)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:o,scoreString:a,updated:t}=function({analysis:e,scoreString:t,sets:i,value:n}){let r;if(null==i||!i.length)return{sets:[]};let a=i[i.length-1];n=Be(n);let{validSide2Score:o,requiresTiebreak:s}=function({analysis:e,set:t={},value:i}){let n,r,a=e.isDecidingSet&&e.matchUpScoringFormat.finalSetFormat||e.matchUpScoringFormat.setFormat,{tiebreakAt:o,setTo:s,NoAD:l}=a,{side1Score:u}=t;return n=o&&o<s?u===o?i<=s:i<=o:u===s?l?i<s:i<=s+1:u===s-1?l?i<=s:i<=s+1:u===s+1?i===s||i===s-1:i<=s,n&&(r=o&&o<s?u===s&&i===o||u===o&&i===s:u>=s&&i>=s&&u!==i),{validSide2Score:n,requiresTiebreak:r}}({analysis:e,set:a,value:n});if(o){r=!0,t=(t||"")+n,a.side2Score=n;let o=oD({analysis:e,set:i[i.length-1]});a.winningSide=o||void 0,s?t+=RP.split("")[0]:e.isDecidingSet||(t+=cP)}return{sets:i,scoreString:t,updated:r}}({analysis:f,scoreString:a,sets:o,value:r}));else if(f.isInvalidMatchTiebreakValue)i="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)i="invalid set tiebreak character";else if(f.isTiebreakCloser){let e=f.isSetTiebreakEntry?RP:NP,i=e.split("").reverse()[0],n=e.split("")[0],r=o[o.length-1],{tiebreakFormat:s}=f.setFormat,{tiebreakTo:l,NoAD:u}=s||{},d=aD({set:r});if(!f.isTiebreakSet){let e=parseInt(a.split(n).reverse()[0]),t=iD({lowValue:e,tiebreakTo:l,NoAD:u});1===d?(r.side1TiebreakScore=t,r.side2TiebreakScore=e):(r.side1TiebreakScore=e,r.side2TiebreakScore=t)}a=(a||"")+i,f.isDecidingSet||(a+=cP);let c=oD({analysis:f,set:r});r.winningSide=c||void 0,t=!0}else if(f.isTiebreakSetValue)({info:i,scoreString:a,sets:o,updated:t}=function({analysis:e,auto:t,lowSide:i,scoreString:n="",sets:r,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:u,NoAD:d}}=e.setFormat,[c]=NP.split("");if(e.isMatchTiebreakEntry||(n+=c),r[e.setNumber-1]){let{lastOpenBracketIndex:e}=tD({brackets:NP,scoreString:n}),c=(n.slice((e??0)+1)+(t?"":a)).split($P);if(((null==(o=c[i-1])?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(t){1===i&&(c[0]=(c[0]||"")+a),2===i&&(c[1]=(c[1]||"")+a);let t=[c[0]||0,c[1]||0].map((e=>Be(e))),o=1===i?1:0;t[o]=t[1-o]+(d?1:2),t[o]<u&&(t[o]=u);let l=r[r.length-1];l.side1TiebreakScore=t[0],l.side2TiebreakScore=t[1],n=n.slice(0,(e??0)+1),n+=t.join($P),s=!0}else{let e=[c[0]||0,c[1]||0].map((e=>Be(e))),t=r[r.length-1];t.side1TiebreakScore=e[0],t.side2TiebreakScore=e[1],n+=a,s=!0}}else{let e=iD({lowValue:Be(a||0),tiebreakTo:u,NoAD:d}),t=[Be(a),e];2===i&&t.reverse();let o={side1TiebreakScore:t[0],side2TiebreakScore:t[1],setNumber:(null==r?void 0:r.length)+1||1};r.push(o),n+=t.join($P),s=!0}return{info:l,scoreString:n,sets:r,updated:s}}({analysis:f,auto:c,lowSide:n,scoreString:a,sets:o,value:r}));else if(f.isSetTiebreakEntry){let[e]=RP.split(""),n=Math.max(...ut(e,a.split(""))),o=a.slice(n+1),s=o&&Be(o)===WP,l=Be(o?o+r:r),{tiebreakFormat:u}=f.setFormat,{tiebreakTo:d,NoAD:c}=u||{};!s&&o.length<2?c&&l>d-1?i="invalid low value for NoAD tiebreak":(t=!0,a=(a||"")+r):i=s?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)i=`invalid key: ${r}`;else if(f.isGameScoreEntry)i="game scoreString entry";else if(f.lastSetIsComplete||!o.length){t=!0;let{scoreString:e,set:i}=function({analysis:e,lowSide:t,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:o}=(null==e?void 0:e.setFormat)||{},s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};let l=[n,s?n+1:n+1===r?n+(o?1:2):r];2===t&&l.reverse();let u=RP.split("")[0];i=(i||"")+(l.join(GP)+(s?u:cP));let d={side1Score:l[0],side2Score:l[1]},c=oD({analysis:e,set:d});return d.winningSide=c||void 0,{scoreString:i,set:d}}({analysis:f,lowSide:n,scoreString:a,value:Be(r)});i&&(i.setNumber=(null==o?void 0:o.length)+1||1),o=(null==o?void 0:o.concat(i).filter(Boolean))||[i],a=e||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(t=!0,({scoreString:a,sets:o}=eD({analysis:f,scoreString:a,sets:o,lowSide:n})),l=void 0);if(t){o=null==o?void 0:o.filter(Boolean);let{matchUpWinningSide:e}=nD({sets:o,winningSide:s,matchUpStatus:l,matchUpFormat:u});return s=e,!e||l&&![Oc,Mc].includes(l)?a&&!s&&![PP,wP,TP].includes(l)&&(l=void 0):(l=mP,o=o.filter((e=>{let{side1Score:t,side2Score:i,side1TiebreakScore:n,side2TiebreakScore:r}=e;return t||i||n||r}))),{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:l,info:i}}return{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:l,info:i}}var dD="\\d+-\\d+",cD="\\d+-\\d+\\(\\d+\\)",pD="\\[\\d+-\\d+\\]",mD=new RegExp(`(${dD}),`,"g"),fD=new RegExp(`(${cD}),`,"g"),hD=[dD,cD,pD,"\\d+-\\d+\\(\\d+-\\d+\\)"],vD=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map((e=>{let t=e.split("").map((e=>hD[e])).join(" ");return new RegExp(`^${t}$`)}));function gD(e){return!e||vD.some((t=>t.test(e)))}function ID(e){return/^\(\d+\)$/.test(e)||/^\(\d+$/.test(e)}function UD(e){let t=null==(i=e)?void 0:i.split("-").join("").split("/").join("");var i;if(/^\d+$/.test(t)&&2===t.length){let e=t.split("");return 1===Math.abs(e.reduce(((e,t)=>+e-+t)))}return!1}function yD(e,t){let i=[e.slice(t,t+2),t?e.slice(0,1):e.slice(2)].map((e=>parseInt(e.join(""))));t&&i.reverse();let n=i;if(Math.abs(n.reduce(((e,t)=>+e-+t)))>=2)return n.join("-")}function SD(e){return 2===e.length?e.split("").join("-"):([", ",",","/"," "].forEach((t=>e=e.split(t).join("-"))),e=e.replace(/-{2,}/,"-"))}function wD(e){return e.startsWith("(")&&e.endsWith(")")}function PD(e){if(!/^[\d-]+(\(\d\))*$/.test(e))return e;let t=ut("-",e.split(""));if(!t.length)return e;let i=e.split("-"),n=!(i.length%2),r=!!(t.length%2);return n&&r&&t.length>i.length/2&&t.filter(((e,t)=>t%2)).forEach((t=>{e=e.substring(0,t)+" "+e.substring(t+1)})),e}function DD({score:e}){let t,i=e.split(""),n=[],r=()=>t=[void 0,void 0,void 0],a=()=>{let e=`${t[0]}-${t[1]}`;return t[2]&&(e+=` (${t[2]})`),r(),t.push(t),e};r();let o=()=>void 0!==t[0]&&void 0!==t[1]&&Math.abs(parseInt(t[0])-parseInt(t[1]));for(;i.length;){let e=i.shift(),r=qe(e)&&parseInt(e),s=void 0!==t[0]&&void 0!==t[1];if(qe(r)){if(void 0===t[0]){t[0]=r;continue}if(void 0===t[1]&&(t[1]=r,o())){n.push(a()),t=[void 0,void 0];continue}if(s&&1===i.length&&qe(i[0])){let e=i.pop();t[0]=t[0].toString()+t[1].toString(),t[1]=e,n.push(a()),t=[void 0,void 0]}s&&o()}}return{sets:n}}function TD(e){let t=e.indexOf("1"),i=e.split(""),n=i.every((e=>!isNaN(e)));if(n&&3===e.length&&0===t){let e=yD(i,t);if(e)return e}if(n&&7===e.length&&t>3){let e=yD(i.slice(4),t-4);if(e)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${e}`}}function bD(e){let{score:t}=e,{applied:i,matchUpStatus:n}=e,r=null==t?void 0:t.toString().split(""),a=null==r?void 0:r.every((e=>qe(e))),o=e=>Math.abs(e[0]-e[1]);if("number"==typeof t||a){t=t.toString().toLowerCase(),a&&(t=r.join(""));let e=a?r.map((e=>parseInt(e))):t.split("").map((e=>parseInt(e)));if(DD({score:t}),e.length,3===t.length&&1===o(e.slice(0,2))){let[n,r,a]=e;t=`${n}-${r}(${a})`,i.push("numericTiebreakPattern1")}else if(3===t.length&&1===e[0]){let[n,r,a]=e;t=`[${n}${r}-${a}]`,i.push("numericTiebreakPattern2")}else if(4===t.length&&1===o(e.slice(0,2))&&"987654".split("").includes(e[0].toString())){let[n,r,a,o]=e;t=`${n}-${r}(${Math.min(a,o)})`,i.push("numericTiebreakPattern3")}else if(4===t.length&&1===e[0]&&1===e[2]){let[n,r,a,o]=e;t=`[${n}${r}-${a}${o}]`,i.push("bigSuper")}else if(4===t.length){let[n,r,a,o]=e;t=`${n}${r} ${a}${o}`,i.push("split4")}else if(5===t.length&&1===o(e.slice(0,2))){let[n,r,a,o,s]=e;t=`${n}-${r}(${a}) ${o}-${s}`,i.push("numericTiebreakPattern4")}else if(5===t.length&&1===o(e.slice(3))){let[n,r,a,o,s]=e;t=`${n}-${r} ${a}-${o}(${s})`,i.push("numericTiebreakPattern5")}else if(7===e.length)if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===e[4]){let[n,r,a,o,s,l,u]=e;t=`${n}-${r} ${a}-${o} [${s}${l}-${u}]`,i.push("numericTiebreakPattern6")}else if(1===o(e.slice(0,2))&&o(e.slice(3,5))>1&&o(e.slice(5,7))>1){let[n,r,a,o,s,l,u]=e;t=`${n}-${r}(${a}) ${o}-${s} ${l}-${u}`,i.push("numericTiebreakPattern7")}else if(o(e.slice(0,2))>1&&1===o(e.slice(2,4))&&o(e.slice(5,7))>1){let[n,r,a,o,s,l,u]=e;t=`${n}-${r} ${a}-${o}(${s}) ${l}-${u}`,i.push("numericTiebreakPattern8")}else if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===o(e.slice(4,6))){let[n,r,a,o,s,l,u]=e;t=`${n}-${r} ${a}-${o} ${s}-${l}(${u})`,i.push("numericTiebreakPattern9")}else t=t.slice(0,2)+" "+t.slice(2,4)+" "+t.slice(4),i.push("numericMatchTiebreakPattern");else if(t.length%2){let e=TD(t);e&&t!==e&&i.push("parsedSuperPattern"),t=e??t}else{let n=ht(t.split(""),2).map((e=>e.join(""))),r=n.map((e=>{let[t,i]=e.split("").map((e=>parseInt(e))),n=t>i?1:2;return Math.abs(t-i)>1&&n||-1*n})),a=r.reduce(((e,t)=>e>0&&t>0),1),o=tt(r),s=tt(r.map((e=>Math.abs(e)))),l=r[0]<0,u=!l&&r[1]<0;if(r[0]>0&&r[1]>0&&r[0]!==r[1])t=[n.slice(0,2).join(" "),n.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(a)t=n.join(" "),i.push("chunkSplit");else if(6===e.length){if(2===o[1]||2===o[2])if(Object.values(s).includes(3)){let[n,a,o,s,l,u]=e,d=r.reduce(((e,t,i)=>t<0?i:e),void 0);if(0===d){t=`${n}-${a}(${Math.min(o,s)}) ${l}-${u}`,i.push("chunkSplitTiebreak1")}else if(1===d){t=`${n}-${a} ${o}-${s}(${Math.min(l,u)})`,i.push("chunkSplitTiebreak2")}else t=`${n}-${a} ${o}-${s}`,i.push("chunkSplitTrimExtraneous")}else t=n.join(" "),i.push("chunkSplit")}else if(8===e.length){let[i,n,a,o,s,d,c,p]=e;l||u?1===e[5]&&(t=l?`${i}-${n}(${a}) ${o}-${s} [${d}${c}-${p}]`:`${i}-${n} ${a}-${o}(${s}) [${d}${c}-${p}]`):(r[0],r[1])}}}return{score:t,applied:i,matchUpStatus:n}}function RD(e){let t=[0,0],i=[],n=e.split(" "),r=/(\d+)-(\d+)/;n.forEach((e=>{if(r.test(e)){let n=e.match(r).slice(1).map((e=>parseInt(e))),a=n[0]>n[1]?1:n[1]>n[0]&&2;a&&(t[a-1]+=1,i.push(a))}}));let a=t[0]>t[1]?1:t[1]>t[0]&&2,o=t[0]>0&&t[0]===t[1],s=t.reduce(((e,t)=>e+t),0);return{setsWon:t,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}var ND={handleTiebreakSlashSeparation:function({score:e}){let t=new RegExp(/\(\d+\/\d+\)/g),i=e.match(t);for(let n of i||[]){let t=n.replace("/","-");e=e.replace(n,t)}return{score:e}},handleSetSlashSeparation:function({score:e}){return new RegExp(/-\d+\/\d+-/).test(e)&&(e=e.split("/").join(" ")),{score:e}},punctuationAdjustments:function({score:e,applied:t}){e=function(e){let t="[];",i="()",n=t+i,r=[t[0],i[0]],a=Object.assign({},...n.split("").map((e=>({[e]:0})))),o="",s=e.split("").map((e=>{let s=n.includes(e)&&e,l=r.includes(s);if(l&&s)return a[s]+=1,o=s,e;if(!l&&s&&o&&s!==o){a[o]-=1;let e=t.includes(o)&&t||i.includes(o)&&i||"",n=e.split("").find((e=>e!==o));if(!e.includes(s))return a[s]||(o=""),n;a[o]||(o="")}return e})).join("");return e!==s?s:e}(e);let i=/\)(\d+)/g;if(i.test(e))for(let y of e.match(i)){let t=y.replace(")",") ");e=e.replace(y,t)}let n=/\(([\d- ]+)\)/,r=(e=(e=e.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);for(let y of r||[]){let[t]=y.match(n).slice(1),i=t.replace(/ /g,"");e=e.replace(y,`(${i})`)}let a=/\(\(\d-\d\)\)/g;if(a.test(e)){let t=e.match(a);t.length&&t.forEach((t=>{let i=t.match(/\((\(\d-\d\))\)/).slice(1)[0];e=e.replace(t,i)}))}if(a=/\(\((\d)\)\)/g,a.test(e)){let t=e.match(a);t.length&&t.forEach((t=>{let i=t.match(/\((\(\d\))\)/).slice(1)[0];e=e.replace(t,i)}))}/(^|\s)6-,/.test(e)&&(e=e.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);e=e.replace(o,"-"),["- "," -"].forEach((t=>{let i=new RegExp(`(\\d+)${t}(\\d+)`,"g"),n=e.match(i);n&&n.forEach((i=>e=e.replace(i,i.split(t).join("-"))))})),/^[(-/,]+$/.test(e)&&(e=""),/\)[-/,]+$/.test(e)&&(e=e.slice(0,e.length-1)),/\d \/\d/.test(e)&&(e=e.replace(/ \//g,"/")),e.includes(" /")&&(e=e.replace(/ \//g," "));let s=/\(\d+, \)/g;s.test(e)&&e.match(s).forEach((t=>{let[i]=t.match(/\((\d+), \)/).slice(1);2===i.length?e=e.replace(t,`(${i})`):1===i.length&&"6"===i&&(e=e.replace(t,"(6-0)"))}));let l=/\((\d+)\/\)/g;l.test(e)&&e.match(l).forEach((t=>{let[i]=t.match(/\((\d+)\/\)/).slice(1);e=2===i.length?e.replace(t,`(${i})`):1===i.length&&"6"===i?e.replace(t,"(6-0)"):e.replace(t,`(${i})`)}));let u=/\d\/\d\/,/g;u.test(e)&&e.match(u).forEach((i=>{let[n]=i.match(/(\d\/\d)\/,/).slice(1);e=e.replace(i,`${n},`),t.push("slashComma")}));let d=/\(\/(\d+)\)/g;d.test(e)&&e.match(d).forEach((t=>{let[i]=t.match(/\(\/(\d+)\)/).slice(1);e=2===i.length?e.replace(t,`(${i})`):1===i.length&&parseInt(i)<6?e.replace(t,`(6-${i})`):e.replace(t,`(${i})`)}));let c,p,m,f,h,v=()=>{h=tt(e.split("")),p=h["("]===(h[")"]||0)+1,c=(h["("]||0)+1===h[")"],m=h["["]===h["]"]+1,f=p&&!m};v();let g=/(\d+-\d+\(\d+)0,/;if(g.test(e)){let[t]=e.match(g).slice(1);e=e.replace(g,t+")")}if(h["("]===h[")"]&&h["("]>1){let t=e.split(")(").join(") (").split(" ");e=t.every(wD)?t.map((e=>{let t=e.slice(1,e.length-1);return t.length>2?t:e})).join(" "):t.join(" ")}v();let I=/[A-Za-z]+/.test(e),U=/\d+/.test(e);if(!I&&!U)return{score:""};if(/^\[.+\]$/.test(e)&&"()/,- ".split("").some((e=>h[e]))&&(e=e.slice(1,e.length-1)),/^\(.+\)$/.test(e)&&1===h["("]&&1===h[")"]&&"[]/,".split("").some((e=>h[e]>1))&&(e=e.slice(1,e.length-1)),e.startsWith("(")&&e.endsWith("))")&&(e=e.slice(1,e.length-1)),h["("]>(h[")"]||0)&&"("===e[e.length-1]&&(e=e.slice(0,e.length-1)+")",v()),1===h["("]&&!h[")"]&&"("===e[0]&&(e+=")",v()),h["("]>(h[")"]||0)&&"(("===e.slice(0,2)&&(e=e.slice(1)),c){if(/^9\d/.test(e))e="("+e.slice(1);else if("("!==e[0])e="("+e;else{let t=[],i=0;for(let n of e.split("").reverse())")"===n&&(i?t.push("("):i+=1),"("===n&&(i-=1),t.push(n);t.reverse(),e=t.join("")}v()}if(h[")"]>(h["("]||0)&&")"===e[0]&&(e="("+e.slice(1),v()),f&&(e.endsWith(9)||/\d+0$/.test(e))&&(e=e.slice(0,e.length-1)+")",v()),f&&(!e.endsWith(")")||e.startsWith("(("))&&(e+=")",v()),f){let t="",i=0;for(let n of e.split(""))"("===n&&(i?t+=")":i+=1),")"===n&&(i-=1),t+=n;e=t}if(v(),m&&!p&&(e+="]"),e.includes("([")&&e.includes("])")&&(e=e.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(e)&&(e=e.slice(0,e.length-1)+")"),v(),1===h[")"]&&!h["("]&&e.endsWith(")")&&(e=e.slice(0,e.length-1)),e.startsWith("(")&&e.endsWith(")")&&1===h["("]&&1===h[")"]&&(e=e.slice(1,e.length-1),v()),/^\([\d ]+.*[\d ]+\)$/.test(e)&&h["("]===h[")"]){let t=e.slice(1,e.length-1);(e=>{let t=e.indexOf("("),i=e.indexOf(")");return t>=0&&i>=0&&t<i})(t)&&(e=t,v())}return{score:e,applied:t}},handleGameSeparation:function({score:e}){let t=new RegExp(/^\d+\/\d+/),i=e.split(" ");i.some((e=>t.test(e)))&&(e=i.map((e=>t.test(e)?e.replace("/","-"):e)).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(e)){let[t,i]=e.match(n).slice(1);e=[t,i].join("-")}return{score:e}},joinFloatingTiebreak:function({score:e}){if("string"!=typeof e)return{score:e};let t=e=>null==e?void 0:e.split("-").join("").split("/").join(""),i=e=>e.split("[").join("(").split("]").join(")"),n=(e=e.split(", ").join(" ")).split(" ");e=n.map((e=>{let t=/^-(\d+)$/;if(t.test(e)){let[i]=e.match(t).slice(1);if(2===i.length)return i.split("").join("-")}return e})).join(" "),n=e.split(" ");let r=n.filter(ID),a=0,o="";for(let p of r){let e=ut(p,n).filter((e=>!a||e>a))[0],i=n.slice(a,e-1),r=n[e-1],s=t(r);if(/^\d+$/.test(s)&&2===s.length){let t=s.split(""),n=Math.abs(t.reduce(((e,t)=>+e-+t)));if(1===n){o+=[i.join(" "),[r,p].join("")].join(" "),a=e+1}else if(0===n){let n=Math.max(...t);if([4,5,6,7,8,9].includes(n)){let t=[n,[6,4].includes(n)?n+1:n-1].sort().reverse().join("-");o+=[i.join(" "),[t,p].join("")].join(" "),a=e+1}}}}if(r.length&&o.length){return o=[o,n.slice(a).join(" ")].join(" "),{score:o.trim()}}if(2===n.length&&["(","["].some((e=>n[1].includes(e)))){let e=t(n[0]).split("");if(1===Math.abs(e.reduce(((e,t)=>+e-+t),0)))return n[1]=i(n[1]),{score:n.join("")}}let s=n.map((e=>function(e){return/^\(\d+-\d+\)$/.test(e)||/^\[\d+-\d+\]$/.test(e)}(e)?"bracket":UD(e)&&"set"));if(s.includes("set")&&s.includes("bracket")){let e,t="";return n.forEach(((n,r)=>{"bracket"===s[r]&&"set"===e?(n=i(n),t+=n):t+=` ${n}`,e=s[r]})),{score:t.trim()}}n=e.split(" ");let l,u=n.map((e=>{let t=new RegExp(/^(\d+)-(\d+)$/);if(t.test(e)){let[i,n]=e.match(t).slice(1),r=Math.abs([i,n].reduce(((e,t)=>+e-+t))),a=Math.max(i,n);if(1===r)return l="tiebreakSet",l;if(r>=2&&a>=7&&"tiebreakSet"===l)return l="tiebreak",l}})),d=ut("tiebreak",u);if(d.length){let t="";n.forEach(((e,i)=>{d.includes(i)?t+=`(${e}) `:d.includes(i+1)?t+=`${e}`:t+=`${e} `})),e=t.trim()}let c=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(c.test(e)){let[t,i,n]=e.match(c).slice(1),r=Math.max(i,n)>=10;!UD(t)&&r&&(e=e.replace(c,`${t} [${i}-${n}]`))}return u=[],{score:e=e.split(" ").map((e=>{let t=/^\((.*)\)$/,i=t.test(e),n=(new RegExp(pD).test(e)?"super":new RegExp(cD).test(e)&&"tiebreak")||new RegExp(dD).test(e)&&"standard"||"unknown";return u.push(n),"standard"===n&&i?e.match(t)[1]:e})).join(" ")}},handleBracketSpacing:function({score:e,applied:t}){return e.includes("( ")&&(t.push("removeParenSpacingAfterOpen"),e=e.split("( ").map((e=>e.trim())).join("(")),e.includes(" )")&&(t.push("removeParenSpacingBeforeClose"),e=e.split(" )").map((e=>e.trim())).join(")")),[mD,fD].forEach((i=>{let n=e.match(i);null!=n&&n.length&&(n.forEach((t=>{e=e.replace(t,t.slice(0,t.length-1)+" ")})),t.push("setsEndComma"))})),{score:e=e.split(" ").filter(Boolean).map(PD).join(" "),applied:t}},handleSpaceSeparator:function({score:e}){if(e.includes(",")){let t=e.split(",").map((e=>e.trim())),i=e=>/\d \d/.test(e);t.every(i)&&(e=t.map((e=>{let t=/\d+ \d+/g;for(let i of e.match(t)){let[t,n]=i.match(/(\d+) (\d+)/).slice(1);e=e.replace(i,`${t}-${n}`)}return e})).join(" "))}if(e.includes(" ")){let t=e.replace(/[ ,]/g,"");t.split("").every((e=>qe(e)))&&4===t.length&&(e=t)}return{score:e}},separateScoreBlocks:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:{score:e=e.toLowerCase().split(" ").map((e=>{if(/^\d+$/.test(e)&&e.length>2){let i=e.indexOf("1");if(e.length%2){if(3===e.length&&0===i){let n=yD(e.split(""),i);return t.push("getSuper"),n}}else{let{score:i,applied:n}=bD({score:e,applied:[]});i!==e&&(e=i,t.push(...n))}}return e})).join(" "),applied:t}},matchKnownPatterns:function({score:e,applied:t}){for(let P of[".",","," ","/"]){let i=new RegExp(`^(\\d+)\\${P}(\\d+)$`);if(i.test(e)){let n=e.match(i).slice(1).map((e=>parseInt(e))),r=Math.abs(n[0]-n[1]);r<=10&&r>=2&&(e=e.split(P).join("-"),t.push("variedJoinerPattern"))}}e.includes(";")&&(e=e.split(";").join(" "),t.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(e)){let[n,r,a,o,s,l]=e.match(i).slice(1);e=e.replace(i,`${n}${r}-${a} ${o}-${s}${l}`),t.push("smashSlashPattern")}/.*\s6[/-]+$/.test(e)&&(e+="0",t.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(e)&&(e=e.replace(n,"(6, 0)"),t.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach((()=>{e=e.split(" ").map((e=>(r.test(e)&&(e=e.replace("("," (")),a.test(e)&&(e=e.replace(")",") ")),e))).join(" "),t.push("spaceConsiderationPatterns")}));let o=PD(e);o!==e&&(e=o,t.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(e)){let[i,n,r]=e.match(s).slice(1),[a,o]=n.split("");e=`${i}-${a} ${o}-${r}`,t.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(e)){let[i,n]=e.match(u).slice(1),r=i.trim(),a=n.trim();if(l.test(r)&&l.test(a)){let i=r.match(l).slice(1,3).join("-"),n=a.match(l).slice(1,3).join("-");e=`${i} ${n}`,t.push("slashSeparationPattern")}}let d=/^([\d -]+),([\d -]+)$/;if(d.test(e)){let[i,n]=e.match(d).slice(1),r=i.trim(),a=n.trim();if(l.test(r)&&l.test(a)){let i=r.match(l).slice(1,3).join("-"),n=a.match(l).slice(1,3).join("-");e=`${i} ${n}`,t.push("commaSeparationPattern")}}let c=/^\d \d,/;if(c.test(e)){let i=e.match(c)[0],n=i.slice(0,i.length-1).split(" ").join("-");e=e.replace(i,n),t.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(e)&&p<3;){let[i,n,r]=e.match(m).slice(1),a=n.split(""),o=`${i}-${a[0]} ${a[1]}-${r}`;e=e.replace(m,o),t.push("noSetSeparationPattern"),p+=1}let f=e.match(/(^|\s)7-6\s(\d+)\s/g);if(null!=f&&f.length){let i=/(^|\s)7-6\s(\d+)\s/;f.forEach((n=>{let r=n.match(i).slice(2)[0];e=e.replace(n,`7-6(${r}) `),t.push("floatingTiebreakPattern1")}))}let h=e.match(/\d \d /);null==h||h.forEach((i=>{let n=i.slice(0,i.length-1).split(" ").join("-");e=e.replace(i,n),t.push("spaceSeparatedSetPattern1")})),h=e.match(/ \d \d$/),null==h||h.forEach((i=>{let n=" "+i.slice(1).split(" ").join("-");e=e.replace(i,n),t.push("spaceSeparatedSetPattern2")}));let v=/^\d, *\d\/\d, *\d/;if(v.test(e)){let i=e.match(v)[0],n=i.split("/").map((e=>`(${e})`)).join(" ")+" ";e=e.replace(i,n),t.push("slashCommaSetPattern")}let g=/\(6-\)/g;g.test(e)&&(e=e.replace(g,"(6-0)"),t.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(e)){let i=e.match(I),n=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),r=e;i.forEach((e=>{let[t,i]=e.match(n).slice(1),a=`${t}-${i}`;r=r.replace(e,a)})),e=r,t.push("slashSetPattern")}let U=/(.*)\s(1\d)\s(\d+)$/;if(U.test(e)){let[i,n,r]=e.match(U).slice(1);i.replace(/\D/g,"").length>=4&&(e=i+` ${n}${r}`,t.push("spaceSeparatedSuperPattern"))}let y=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let P of e.match(y)||[]){let[i,n,r,a]=P.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[o,s]=n.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(P,`${i}${n}(${r})${a}`),t.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let P of e.match(S)||[]){let i=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[n,r,a]=P.match(i).slice(1),[o,s]=n.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(P,`${n}(${r})${a}`),t.push("floatingTiebreakPattern2"))}let w=/(^|\s)(\d \d)\(/g;for(let P of e.match(w)||[]){let i=/(^|\s)(\d \d)\(/,[n,r]=P.match(i).slice(1);e=e.replace(P,`${n}${r.split(" ").join("-")}(`),t.push("spacedTiebreakPattern")}return{score:e,applied:t}},removeDanglingBits:function({score:e,attributes:t}){(e.endsWith(" am")||e.endsWith(" pm"))&&(e=""),e=e.replace(/[A-Za-z]+/g,"").trim(),[".",","].some((t=>e.endsWith(t)))&&(e=e.slice(0,e.length-1));let i="()/-".split("").some((t=>e.includes(t)));/ \d$/.test(e)&&i&&(t={removed:e.slice(e.length-2).trim()},e=e.slice(0,e.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(e)&&(e=e.match(n).slice(1)[0].trim()),{score:e,attributes:t}},removeErroneous:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:[3,4].includes(e.length)&&TD(e)?{score:TD(e)}:{score:e=e.toLowerCase().split(" ").map((e=>{if(!/^\d+$/.test(e)||1!==e.length)return e;t.push("removeErroneous1")})).filter(Boolean).join(" "),applied:t}},handleWalkover:function({score:e,applied:t}){return["walkover","wo","w/o","w-o"].includes(null==e?void 0:e.toString().toLowerCase())?(t.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:t}):{score:e}},properTiebreak:function({score:e,matchUpStatus:t}){var i;let n=null==e?void 0:e.split(" ");e=n.map((e=>{if(e.endsWith("]")){let t=e.split("[");if(UD(t[0]))return t[0]+`(${t[1].slice(0,t[1].length-1)})`}return e})).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(e))for(let l of e.match(r)){let t=null==(i=l.replace(" ","-").match(/\((.*)\)/))?void 0:i[1];if(qe(t)&&(null==t?void 0:t[0])>2)if([2,4].includes(t.length))t=t.split("").join("-");else if(3===t.length){let e=t.indexOf("1");t=yD(t.split(""),e)}e=e.replace(l,`(${t})`)}n=null==e?void 0:e.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=n.length-1;e=n.map(((e,i)=>{let n=[void 0,"","COMPLETED"].includes(t)||i!==o;if(a.test(e)&&n){let[t,i,n]=Array.from(e.match(a)).slice(1);return`${t}(${Math.min(i,n)})`}return e})).join(" "),n=null==e?void 0:e.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),e=n.map((e=>{if(a.test(e)){let[t,i]=Array.from(e.match(a)).slice(1),n=t.split("");return`${n[0]}-${n[1]}(${i})`}return e})).join(" "),n=null==e?void 0:e.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),e=n.map((e=>{if(a.test(e)){let[t,i]=Array.from(e.match(a)).slice(1);return UD(t)?`${t}(${i})`:t}return e})).join(" "),n=null==e?void 0:e.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),e=n.map((e=>{if(a.test(e)){let[t]=e.match(a).slice(1);return`[${t<9?10:parseInt(t)+2}-${t}]`}return e})).join(" ");let s=/\((\d)+0 /;if(s.test(e)){let t=e.match(s)[1];e=e.replace(s,`(${t}) `)}return{score:e}},handleNumeric:bD,handleRetired:function({score:e,profile:t,applied:i}){var n;e=null==e?void 0:e.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(e)){let[t]=e.match(r).slice(1);return i.push("handleRetired"),{score:t.trim(),matchUpStatus:"retired",applied:i}}let a=null==(n=null==t?void 0:t.matchUpStatuses)?void 0:n.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find((t=>null==e?void 0:e.endsWith(t)));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:null==e?void 0:e.replace(o,"").trim(),applied:i}):{score:e}},containedSets:function({score:e,attributes:t,identifier:i}){var n,r,a;if("string"!=typeof e)return{score:e,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=e.match(o);for(let c of s||[]){let t=null==(r=null==(n=c.match(/^\((.*)\)$/))?void 0:n.slice(1))?void 0:r[0],i=e.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(2===(null==t?void 0:t.length)&&(null==i?void 0:i.length)>=2){let e=i.slice(i.length-2).split("").map((e=>parseInt(e)));if(1===Math.abs(e[0]-e[1]))continue}let a=PD(SD(t));e=e.replace(c,`(${a})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);if(null==(a=e.match(l))||a.forEach((t=>{let i=SD(t.match(/^\[(.*)\]$/)[1]);e=e.replace(t,`(${i}) `).trim()})),e.startsWith("(")&&[")","]"].some((t=>e.endsWith(t)))&&[")(","), (",") (",")[",") [","](","] ("].some((t=>e.includes(t)))){let t="",i=e.split(/[)\]]/).filter(Boolean).map((e=>(e.startsWith(",")&&(e=e.slice(1)),e.trim()))),n=i.every((e=>e.includes(",")||ID(e))),r=i.every((e=>e.includes("/")||ID(e))),a=i.every((e=>e.includes("-")||ID(e))),o=(n?",":a&&"-")||r&&"/";if(o){let n;i.forEach((e=>{if(e.startsWith("("))if("set"===n&&(t+=" "),e.includes(o))t+=e.slice(1).split(o).map((e=>e.trim())).join("-"),n="set";else{let i=e.slice(1);t+=`(${i}) `,n="tiebreak"}else if(e.startsWith("[")){let i=e.slice(1).split(o).map((e=>parseInt(e.trim()))),r=Math.min(...i);t+="set"===n?`(${r}) `:`[${i.join("-")}] `,n="tiebreak"}})),e=t.trim()}}let u=tt(e.split(""));1===u["("]&&1===u[")"]&&e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,e.length-1),1===u["-"]&&UD(e)&&qe(null==t?void 0:t.removed)&&(e+=`(${t.removed})`,t.removed=void 0));let d=/\(\)/g;return d.test(e)&&(e=e.replace(d,"").trim()),{score:e}},sensibleSets:function({score:e,matchUpStatus:t,attributes:i}){let n,r=[],a=e.split(" "),o=a.length;e=a.map(((e,i)=>{if(new RegExp(cD).test(e)){let i=e.slice(3),n=e.slice(0,3),r=n.split("-");if(!UD(n)&&!t){let e=Math.max(...r),t=[e,e-1];return n.indexOf(e)&&t.reverse(),t.join("-")+i}}else if(2===e.length&&qe(e))return e.split("").join("-");e=PD(e);let a=(new RegExp(`^${pD}$`).test(e)?"super":new RegExp(`^${cD}$`).test(e)&&"tiebreak")||new RegExp(`^${dD}$`).test(e)&&"standard"||"unknown";if(r.push(a),o>1&&"standard"===a&&i<2){let[t,r]=e.split("-"),a=Math.abs(parseInt(t)-parseInt(r)),o=Math.max(t,r),s=Math.min(t,r),l=[parseInt(t),parseInt(r)].indexOf(s);if(o>9&&a>2){let t=o.toString().split(""),r=t.find((e=>parseInt(e)>s||i&&parseInt(e)<=n))??t[0];r&&(e=l?[r,s].join("-"):[s,r].join("-"))}o>(n||0)&&(n=o)}if("standard"===a){let[i,n]=e.split("-");if(!Math.abs(parseInt(i)-parseInt(n))&&"RETIRED"!==t)return""}return e})).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=RD(e);if(1===u&&"6"===(null==i?void 0:i.removed)&&(e+=" 6-0"),e.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(e=e.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let t=[0,0];e=e.split(" ").map(((e,i)=>(t[l[i]]+=1,Math.max(...t)>2?void 0:e))).filter(Boolean).join(" ")}return{score:e,profile:r}},stringScore:function({score:e}){return{score:e=(null==e?void 0:e.toString().toLowerCase())||""}},superSquare:function({score:e}){let{setsTied:t,winningSide:i}=RD(e),n=/\s\((\d+)\)$/;if(!i&&t&&n.test(e)){let t=e.match(n).slice(1)[0],i=t<=8?10:t+2;e=e.replace(n,` [${i}-${t}]`)}let r=e.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:e};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every((e=>qe(e))))return{score:e};if("76"===o[0]){let t=2===o[1].length?Math.min(...o[1].split("").map((e=>parseInt(e)))):o[1];e=[...r.slice(0,r.length-1),`7-6(${t})`].join(" ")}else{o=o.map((e=>parseInt(e)));let t=Math.max(...o),i=Math.abs(o[0]-o[1]);if(t>=10){if(i>2&&o.every((e=>+e>=10))){let e=o.map((e=>e===t?e-10:10)).sort();i=Math.abs(e[0]-e[1]),i>2&&(o=e)}e=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" ")}else 3===r.length&&t>=7&&i>2&&(e=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" "))}return{score:e}},setBuilder:DD,excisions:function({score:e}){let t=new RegExp(/^\[\d+\](.*)$/);t.test(e)&&(e=e.match(t).slice(1)[0].trim());let i=/\(,/g;return i.test(e)&&(e=e.replace(i,"(")),{score:e}},replaceOh:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:(e.toLowerCase().includes("o")&&(e=e.toLowerCase().split(" ").map((e=>e.split("o").join("0"))).join(" "),t.push("replaceOh")),{score:e,applied:t})}},MD={},AD=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],ED=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function CD(e){if(!e.score)return{error:Cr};let t,i,n,{score:r,sheetName:a,identifier:o,fileName:s,stepLog:l,fullLog:u,profile:d}=e,c=[],p=[],m=r,f=e=>{e.forEach((e=>{n=ND[e]({profile:d,identifier:o,matchUpStatus:t,attributes:i,applied:p,score:m});let r=n.score!==m;r&&c.push({method:e,score:n.score}),l&&(u||r||n.matchUpStatus!==t)&&console.log(t?{score:n.score,matchUpStatus:t}:{score:n.score},e),n.matchUpStatus&&(t=n.matchUpStatus),n.attributes&&(i=n.attributes),n.applied&&(p=n.applied),m=n.score}))};f(AD);let h=gD(m);return h||(m=r.toString().replace(/\D/g,""),null!=i&&i.removed&&(i.removed=void 0),f(ED),h=gD(m),h||(m="")),p.forEach((e=>{MD[e]||(MD[e]=0),MD[e]+=1})),{matchUpStatus:null==t?void 0:t.toUpperCase(),modifications:c,attributes:i,isValid:h,score:m}}var OD={};function kD({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:i,winningSide:n,score:r}){var a,o;let s=(null==r?void 0:r.sets)??[],l=((null==s?void 0:s.filter((e=>null==e?void 0:e.winningSide)))||[]).reduce(((e,t)=>{let{winningSide:i}=t;return i?(e[i-1]++,e):e}),[0,0]),u=n?n-1:void 0,d=void 0!==u?1-u:void 0,c=void 0!==u&&l[u],p=void 0!==d&&l[d],m=t?no(t):void 0,f=Math.max(...l),h=tt(l)[f],v=(null==(a=null==m?void 0:m.setFormat)?void 0:a.timed)||(null==(o=null==m?void 0:m.finalSetFormat)?void 0:o.timed),g=null==m?void 0:m.bestOf,I=g&&Math.ceil(g/2)||1,U=i??e,y=U&&[Tc,Ec,kc].includes(U),S=!m||!s.length||s.every(((e,t)=>{let i=t+1,n=i===g,r=i===s.length,{side1Score:a,side2Score:o,side1TiebreakScore:l,side2TiebreakScore:u,winningSide:d}=e,c=Math.max(a??0,o??0),p=l??u,{finalSetFormat:f,setFormat:h}=m,v=n&&f||h;if(p){let{tiebreakTo:e,NoAD:t}=(null==v?void 0:v.tiebreakFormat)||{},i=Math.max(l??0,u??0);if(t&&i>e||i<e&&d&&(r&&!y||!r))return!1}return!v.setTo||!(!v.noTiebreak&&c>v.setTo+1)})),w=(!t||f===I)&&1===h&&l.indexOf(f)+1||void 0;return{valid:!(!S||!(n&&c>p&&n===w||n&&y||!n&&!w&&(![Pc,Tc,Ec,kc].includes(U)||v&&U===Pc)))}}function FD({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:i,winningSide:n,score:r}){if("object"!=typeof r)return{error:Cr};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r,l="scoreString must be a string!";if(void 0!==o&&"string"!=typeof o)return{error:Cr,info:l};if(void 0!==s&&"string"!=typeof s)return{error:Cr,info:l};if(void 0!==a&&!Array.isArray(a))return{error:Cr,info:eI("sets")};if(null!=a&&a.length){let o=a.map((e=>null==e?void 0:e.setNumber)).filter(Boolean);if(o.length!==Qe(o).length)return{error:Cr,info:"setNumbers not unique"};for(let e of a){let{side1Score:t,side2Score:i,side1TiebreakScore:n,side2TiebreakScore:r,side1PointScore:a,side2PointScore:o,winningSide:s,setNumber:l}=e;if(![[t,i],[n,r],[a,o]].filter((e=>e.some((e=>![void 0,null].includes(e))))).every((e=>e.every((e=>Ye(e))))))return{error:Cr,info:"non-numeric values"};if(![l,s].filter((e=>![void 0,null].includes(e))).every((e=>Ye(e))))return{error:Cr,info:"non-numeric values"};if(s&&![1,2].includes(s))return{error:Cr,info:"winningSide must be 1 or 2"}}let{valid:s}=kD({existingMatchUpStatus:e,matchUpStatus:i,matchUpFormat:t,winningSide:n,score:r});if(!s)return{error:yn,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}be(OD,{analyzeScore:()=>kD,analyzeSet:()=>BD,checkScoreHasValue:()=>dv,checkSetIsComplete:()=>rD,getSetComplement:()=>xD,getTiebreakComplement:()=>_D,isValidMatchUpFormat:()=>co,parseScoreString:()=>LD,validateScore:()=>FD,validateTieFormat:()=>Jo});var xD=e=>{let{isSide1:t,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=e;if(void 0===i)return!1;let o,s=Be(i);return(null==s?void 0:s.toString().length)>2&&(s=parseInt(s.toString().slice(0,2))),r&&r<n&&s>r&&(s=r),a&&!r?(s>n&&(o=n),o=s<n?n:n-1):o=s+1<n&&n||r&&r<n&&s===r&&n||!r&&s+2||n+1,[t?s:o,t?o:s]},_D=e=>{let{isSide1:t,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=e;if(void 0===i)return!1;let a="string"==typeof i?parseInt(i):i;(null==a?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let o=function(e){let{lowValue:t,NoAD:i,tiebreakTo:n}=e,r=i?1:2;return t+1>=n?t+r:n}({lowValue:a,NoAD:r,tiebreakTo:n});return[t?a:o,t?o:a]};function LD({tiebreakTo:e=7,scoreString:t=""}){return null==t?void 0:t.split(" ").filter(Boolean).map(((t,i)=>function({set:t,setNumber:i}){let n=/\[([^)]+)\]/,r=/\(([^)]+)\)/.exec(t),a=n.exec(t),o=(null==t?void 0:t.startsWith("["))&&a&&a[1].split("-").map((e=>parseInt(e))),s=r&&t.replace(r[0],"")||a&&t.replace(a[0],"")||t,l=!o&&s.split("-").map((e=>parseInt(e))),u=o?(o[0]>o[1]?1:o[0]<o[1]&&2)||void 0:(l[0]>l[1]?1:l[0]<l[1]&&2)||void 0,d=r?r[1]:void 0,c=(d&&_D({lowValue:d,isSide1:2===u,tiebreakTo:e}))??[],[p,m]=l||[],[f,h]=o||c||[];return{side1Score:p,side2Score:m,side1TiebreakScore:f,side2TiebreakScore:h,winningSide:u,setNumber:i}}({set:t,setNumber:i+1})))}function BD(e){let{setObject:t,matchUpScoringFormat:i}=e;if(!t)return{error:sn};let{setNumber:n}=t||{},{bestOf:r,exactly:a}=i||{},o=r||a,s=!(!n||!o||n!==o),l=s&&(null==i?void 0:i.finalSetFormat)||(null==i?void 0:i.setFormat),u=!(null==l||!l.tiebreakSet),d=!(null==l||!l.timed),c=!u&&!d,p=!!(n&&o&&n<=o),m=[null==t?void 0:t.side1Score,null==t?void 0:t.side2Score],f=[null==t?void 0:t.side1PointScore,null==t?void 0:t.side2PointScore],h=[null==t?void 0:t.side1TiebreakScore,null==t?void 0:t.side2TiebreakScore],v=m.filter((e=>void 0!==e)).length,g=f.filter((e=>void 0!==e)).length,I=h.filter((e=>void 0!==e)).length,U=null==m?void 0:m.filter((e=>!isNaN(e))).length,y=null==h?void 0:h.filter((e=>!isNaN(e))).length,{tiebreakAt:S}=l||{},w=S&&2===m.filter((e=>e>=S)).length,P=w&&((m[0]>m[1]?1:m[1]>m[0]&&2)||void 0),D=!(!y||U),T=!(null==t||!t.winningSide),{error:b,result:R}=function({setObject:e,setFormat:t,sideGameScores:i,sideTiebreakScores:n}){if(!e)return{result:!1,error:sn};let r=!(null==t||!t.tiebreakSet),a=!(null==t||!t.timed);if(!t||r||a)return{result:!1,error:Cr};if(2!==(null==i?void 0:i.filter((e=>!isNaN(e))).length))return{result:!1,error:Un};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=t||{};if(!o||null==i||!i.find((e=>e>=o)))return{result:!1,error:Un};let d=[1,2].includes(null==e?void 0:e.winningSide);if(!e||!d)return{result:!1,error:Sn};let c=(null==e?void 0:e.winningSide)-1,p=1-c,m=i[c],f=i[p],h=m-f;if(!(m>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let v=s&&l,g=2===(null==n?void 0:n.filter((e=>!isNaN(e))).length),I=null==n?void 0:n[c],U=null==n?void 0:n[p],y=s&&2===i.filter((e=>e>=s)).length;if(v){let{NoAD:e,tiebreakTo:t}=l;if(y){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!g)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(t))return{result:!1,error:{message:"tiebreakTo error"}};if(!t||null==n||!n.find((e=>e>=t)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(m>(s<o?o:o+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!I||!U||I<U)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let i=I-U;if(i&&U>=t-1&&i<(e?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=f>=o-1;return h&&w&&!y&&h<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}({sideTiebreakScores:h,sideGameScores:m,setFormat:l,setObject:t}),{error:N,result:M}=function({setObject:e,setFormat:t,sideTiebreakScores:i}){if(!e)return{result:!1,error:sn};let n=!(null==t||!t.tiebreakSet),r=!(null==t||!t.timed);if(!t||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(null==e?void 0:e.winningSide);if(!e||!a)return{result:!1,error:Sn};let{tiebreakSet:o}=t||{},{NoAD:s,tiebreakTo:l}=o||{};if(2!==(null==i?void 0:i.filter((e=>!isNaN(e))).length))return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(null==i||!i.find((e=>e>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(null==e?void 0:e.winningSide)-1,d=1-u,c=i[u],p=i[d];if(!c||!p||c<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,f=c-p,h=p>=l-1;return f&&h&&f<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}({sideTiebreakScores:h,setObject:t,setFormat:l}),A=c&&!D&&R||u&&D&&M||d,E=p&&!(u&&!D)&&!(c&&D)&&(!T||A),C=function({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:i,isTimedSet:n,setObject:r}){if(!r)return;let a=aD({set:r});return rD({matchUpScoringFormat:e,set:r,isDecidingSet:t,isTiebreakSet:i,isTimedSet:n})&&a||void 0}({isTimedSet:d,matchUpScoringFormat:i,isDecidingSet:s,isTiebreakSet:D,setObject:t}),O={expectTiebreakSet:u,expectTimedSet:d,hasTiebreakCondition:w,isCompletedSet:T,isDecidingSet:s,isTiebreakSet:D,isValidSet:E,isValidSetNumber:p,isValidSetOutcome:A,leadingSide:P,setFormat:l,sideGameScores:m,sideGameScoresCount:v,sidePointScores:f,sidePointScoresCount:g,sideTiebreakScores:h,sideTiebreakScoresCount:I,winningSide:C};return void 0!==(null==t?void 0:t.winningSide)&&(D?(O.isValidTiebreakSetOutcome=M,M||(O.tiebreakSetError=N)):(O.isValidStandardSetOutcome=R,R||(O.standardSetError=b))),O}function VD(e){var t,i,n,r,a;let o=e.drawDefinition,{existingQualifyingPlaceholderStructureId:s,appliedPolicies:l,drawEntries:u,structureId:d,idPrefix:c,isMock:p,event:m}=e,f=e.qualifyingProfiles,h=null!=f&&f.length?vw({uuids:e.uuids,qualifyingProfiles:f,appliedPolicies:l,idPrefix:c,isMock:p}):void 0;if(null!=h&&h.error)return h;o.structures=null==(t=o.structures)?void 0:t.filter((({structureId:e})=>e!==s)),o.links=null==(i=o.links)?void 0:i.filter((({source:e})=>e.structureId!==s));let{qualifiersCount:v,qualifyingDrawPositionsCount:g,qualifyingDetails:I}=h??{};g&&(null!=h&&h.structures&&(null==(n=o.structures)||n.push(...h.structures)),null!=h&&h.links&&(null==(r=o.links)||r.push(...h.links)));let U=null==(a=o.structures)?void 0:a.find((({stage:e,stageSequence:t})=>e===il&&1===t)),{qualifiersCount:y}=Kv({stageSequence:1,drawDefinition:o,structureId:d,stage:il}),S=iU({qualifiersCount:Math.max(v??0,y??0),drawDefinition:o,stage:il});if(S.error||(S=tU({drawSize:g,stage:nl,drawDefinition:o}),S.error))return S;!function({drawDefinition:e,drawEntries:t,event:i}){for(let n of(t??[]).filter((({entryStage:e})=>e===nl))){Xv({...n,entryStage:n.entryStage??il,drawDefinition:e,event:i})}}({drawDefinition:o,drawEntries:u,event:m});let w=function({mainStructure:e,qualifyingDetails:t,drawDefinition:i}){var n;for(let r of t||[]){let{finalQualifyingRoundNumber:t,finalQualifyingStructureId:a,roundTarget:o,finishingPositions:s,linkType:l}=r,u=e&&(null==(n=FU({targetStructureId:e.structureId,sourceStructureId:a,sourceRoundNumber:t,finishingPositions:s,targetEntryRound:o,linkType:l}))?void 0:n.link);if(null!=u&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}({mainStructure:U,qualifyingDetails:I,drawDefinition:o});return w.error?w:{drawDefinition:o,structureId:d}}function jD(e){var t,i;let{participantIds:n}=e,r=(null==(i=null==(t=e.drawDefinition)?void 0:t.entries)?void 0:i.filter((t=>{let i=t.entryStatus;return!e.restrictEntryStatus||zm.includes(i)})).map(hc))??[];if(n){let e=n.filter((e=>!(null!=r&&r.includes(e))));if(null!=e&&e.length)return La({result:{error:Mn},info:{invalidParticipantIds:e}})}else n=r;return e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>n.length-1&&(!e.enableDoubleRobin||e.roundsCount>2*(n.length-1))?{error:Cr,info:"Not enough participants for roundsCount"}:e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>31?{error:Cr,info:"roundsCount must be less than 32"}:{participantIds:n}}function GD(e){var t;let i,n=[],{roundsCount:r=1,drawDefinition:a,matchUpsCount:o,structureId:s,idPrefix:l,isMock:u,event:d}=e,c=jD(e);if(c.error)return c;for(let p of lt(1,r+1)){let r=kw({restrictMatchUpsCount:e.restrictMatchUpsCount,ignoreLastRoundNumber:!!i,newRound:!i,drawDefinition:a,matchUpsCount:o,structureId:s,roundNumber:i,idPrefix:l,isMock:u,event:d});if(r.error)return La({result:r,info:{iteration:p}});null!=(t=r.matchUps)&&t.length&&n.push(...r.matchUps),i=((null==r?void 0:r.roundNumber)??1)+1}return{matchUps:n}}function $D({scaleType:e=Yu,scaleAccessor:t,participant:i,scaleName:n,eventType:r}){var a,o;let s=null==(o=null==(a=i&&Ov({scaleAttributes:{eventType:r??Js,scaleType:e,scaleName:n},participant:i}))?void 0:a.scaleItem)?void 0:o.scaleValue;return t&&wt(s)?s[t]:s}function qD(e){var t,i;let n=function(e){var t;return e.roundsCount&&"number"!=typeof e.roundsCount?{error:Cr,info:"roundsCount must be a number"}:"object"!=typeof e.drawDefinition||e.drawDefinition.drawType&&e.drawDefinition.drawType!==Tl?{error:Gt}:Array.isArray(null==(t=e.drawDefinition)?void 0:t.entries)||!e.participantIds||Array.isArray(e.participantIds)?{error:void 0}:{error:Cr,info:"Missing Entries"}}(e);if(null!=n&&n.error)return n;let r=jD(e);if(r.error)return r;let a=function(e){var t,i,n;if(e.structureId)return e.structureId;let r=e.drawDefinition,a=null==(i=null==(t=null==r?void 0:r.structures)?void 0:t.filter((e=>1===e.stageSequence)))?void 0:i.reduce(((e,t)=>{let i=t.stage&&ll[t.stage];return mf({structure:t})&&i>(ll[null==e?void 0:e.stage]||1)?t:e}),void 0),o=null==(n=null==r?void 0:r.structures)?void 0:n.find((e=>e.structureId===(null==a?void 0:a.structureId)));return o?mf({structure:o})?{structure:o}:{error:Gt}:{error:Si}}(e);if(a.error)return a;let o,s=function(e){var t;let{tournamentRecord:i,participantIds:n,scaleName:r,eventType:a,adHocRatings:o={}}=e,s=e.scaleAccessor??(null==(t=py[r])?void 0:t.accessor),l=i.participants??[];for(let u of n??[]){let e=null==l?void 0:l.find((e=>e.participantId===u)),t=$D({scaleName:`${r}.${Hu}`,participant:e,eventType:a});!t&&r&&(t=$D({scaleAccessor:s,participant:e,scaleName:r,eventType:a})),t&&!o[u]&&(o[u]=t)}return o}(e),l=(null==(t=e.tournamentRecord)?void 0:t.isMock)??e.isMock,u=e.eventType??(null==(i=e.event)?void 0:i.eventType),d=[],c=[];for(let p of lt(1,(e.roundsCount??1)+1)){let t=qw({...e,participantIds:r.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:d,adHocRatings:s,roundNumber:o,eventType:u,isMock:l});if(t.error)return t;let{matchUps:i,...n}=t;n.modifiedScaleValues&&(s=n.modifiedScaleValues),c.push({...n,iteration:p,matchUpsCount:null==i?void 0:i.length}),o=((null==n?void 0:n.roundNumber)??1)+1,null!=i&&i.length&&d.push(...i)}return{...At,matchUps:d,roundResults:c}}function WD(e){var t,i;let{tournamentRecord:n,drawDefinition:r,structureId:a,idPrefix:o,isMock:s,event:l}=e,u=null==(t=null==l?void 0:l.entries)?void 0:t.filter((({entryStage:e,entryStatus:t})=>(!e||e===il)&&t&&zm.includes(t))),d=null==u?void 0:u.map(hc),c=u?Math.floor(u.length/2):0;if(e.automated)return function(e){var t,i;let{restrictEntryStatus:n,generateMatchUps:r,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=e.drawMatic??{},u=qD({...e,eventType:(null==(t=e.drawMatic)?void 0:t.eventType)??e.matchUpType,generateMatchUps:r??!0,scaleAccessor:l??e.scaleAccessor,scaleName:s??e.scaleName,participantIds:e.participantIds,roundsCount:e.roundsCount,restrictEntryStatus:n,structureId:a,matchUpIds:o});return u.error?u:(null!=(i=null==u?void 0:u.matchUps)&&i.length&&wS({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,suppressNotifications:!0,matchUps:u.matchUps,event:e.event,structureId:a}),{...At})}({...e,participantIds:d});{let t=GD({roundsCount:e.roundsCount,drawDefinition:r,matchUpsCount:c,idPrefix:o,isMock:s,event:l});if(t.error)return t;null!=(i=t.matchUps)&&i.length&&wS({matchUps:t.matchUps,suppressNotifications:!0,tournamentRecord:n,drawDefinition:r,structureId:a,event:l})}return{...At}}function HD({sortDescending:e=!1,tournamentRecord:t,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:o,stage:s}){return t?{scaledEntries:(a=a??(null==o?void 0:o.entries)??[]).filter((e=>(!s||!e.entryStage||e.entryStage===s)&&(!r||!e.entryStageSequence||e.entryStageSequence===r)&&zm.includes(e.entryStatus))).map((e=>{let{participantId:n}=e,{scaleItem:r}=Mw({tournamentRecord:t,scaleAttributes:i,participantId:n});return{...e,...r}})).filter((e=>{let t=e.scaleValue;return!!(n||!isNaN(t)&&parseFloat(t))&&t})).sort(n||function(t,i){return e?l(i)-l(t):l(t)-l(i)})}:{error:Bt};function l(t){return parseFloat(t.scaleValue||(e?-1:1e5))}}function zD(e){let t="prepareStage",{drawDefinition:i}=e,{structures:n}=zc({stageSequence:e.stageSequence||1,roundTarget:e.roundTarget,stage:e.stage,drawDefinition:i}),r=e.preparedStructureIds||[],a=null==n?void 0:n.find((({structureId:e})=>!r.includes(e)));if(!a)return La({result:{error:Si},stack:t});let o=null==a?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=function(e){let{seedsCount:t}=e;e.seededParticipants&&(t=e.seededParticipants.length),t>e.drawSize&&(t=e.drawSize);let i=function({entries:e,stage:t,stageSequence:i,roundTarget:n}){return e.filter((e=>{var r,a;let o=null==(a=null==(r=Cd({name:Jd,element:e}))?void 0:r.extension)?void 0:a.value;return(!e.entryStage||e.entryStage===t)&&(!i||!e.entryStageSequence||e.entryStageSequence===i)&&(!n||!o||o===n)&&Hm.includes(e.entryStatus)}))}(e);t>i.length&&(t=i.length);let{seedLimit:n}=function({requireParticipantCount:e=!0,enforcePolicyLimits:t=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var d,c;n=n??r;let p=Hc({drawDefinition:o,structureId:l});if(p.error)return p;let m=p.structure;if(!m)return{error:Si};let{positionAssignments:f}=Jc({structure:m}),h=(null==f?void 0:f.length)||0;if(u>h)return{error:ci};let v=null==(d=m.structures)?void 0:d.length,g=Ye(null==s?void 0:s.groupSeedingThreshold)&&(null==s?void 0:s.groupSeedingThreshold),I=null==(c=xg({roundRobinGroupsCount:v,drawSize:h}))?void 0:c.seedGroups,{seedsCount:U}=fw({policyDefinitions:a,requireParticipantCount:e,drawSizeProgression:i,participantsCount:n,drawSize:h});return U&&null!=a&&a[pd]&&u>U&&t&&(u=U),m.seedLimit=u,m.seedAssignments=lt(1,u+1).map((e=>{let t=null==I?void 0:I.find((t=>t.includes(e))),i=t&&Math.min(...t);return{participantId:void 0,seedNumber:e,seedValue:g&&e>=g?i:e}})),kp({drawDefinition:o,structureIds:[l]}),{...At,seedLimit:u}}({enforcePolicyLimits:e.enforcePolicyLimits??!0,appliedPolicies:e.appliedPolicies,participantsCount:i.length,seedingProfile:e.seedingProfile,drawDefinition:e.drawDefinition,structureId:e.structureId,seedsCount:t});return n&&n<t&&(t=n),{seedsCount:t,stageEntries:i,seedLimit:n}}({...e,structureId:o});(e.seededParticipants||e.event||e.seedingScaleName)&&function(e){let{seededParticipants:t,seedingScaleName:i,entries:n,event:r}=e,a=n.map(hc);t?function(e){let{provisionalPositioning:t,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:d}=e,c=u?Vg({provisionalPositioning:t,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;n.filter((({participantId:e})=>i.includes(e))).filter((e=>!e.seedNumber||e.seedNumber<=n.length)).sort(((e,t)=>e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0)).forEach((e=>{let{participantId:i,seedNumber:n,seedValue:a}=e;Wg({provisionalPositioning:t,tournamentRecord:r,drawDefinition:o,seedingProfile:s,participantId:i,seedBlockInfo:c,structureId:l,seedNumber:n,seedValue:a,event:d})}))}({...e,enteredParticipantIds:a}):(r||i)&&function(e){let t=e.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:d,event:c}=e,{categoryName:p,ageCategoryCode:m}=(null==c?void 0:c.category)||{},f=null==c?void 0:c.eventType,h=function(e){let{tournamentRecord:t,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:o}=e,{categoryName:s,ageCategoryCode:l}=(null==o?void 0:o.category)||{},u=null==o?void 0:o.eventType,d={scaleName:i||s||l||o.eventId,scaleType:Ju,eventType:u};return HD({scaleAttributes:d,tournamentRecord:t,stageSequence:n,entries:r,stage:a}).scaledEntries}({...e,ageCategoryCode:m,categoryName:p,eventType:f})||l&&function(e){let{tournamentRecord:t,stageSequence:i,event:n,entries:r,stage:a}=e,{categoryName:o,ageCategoryCode:s}=(null==n?void 0:n.category)||{},l=null==n?void 0:n.eventType;return HD({scaleAttributes:{scaleName:o||s,scaleType:zu,eventType:l},tournamentRecord:t,stageSequence:i,entries:r,stage:a}).scaledEntries}({...e,ageCategoryCode:m,categoryName:p,eventType:f}),v=(null==h?void 0:h.length)??0;v<t&&(t=v),null==h||h.filter((({participantId:e})=>n.includes(e))).slice(0,a||t).forEach(((e,t)=>{let n=t+1,{participantId:a,scaleValue:l}=e,p=(null==r?void 0:r[n])||l||n;Wg({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:a,structureId:d,seedNumber:n,seedValue:p,event:c})}))}({...e,enteredParticipantIds:a})}({...e,seedsCount:s,structure:a,structureId:o});let d=!1!==e.automated&&e.drawType!==Tl&&!(e.qualifyingOnly&&e.stage!==nl),c=((null==n?void 0:n.length)||0)>1,p=d?function(e){let t="object"==typeof e.automated&&e.automated.seedsOnly,i=$I({...e,seedsOnly:t});if(i.error)return i;let n=null==i?void 0:i.positionAssignments,r=null==i?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}({...e,multipleStructures:c,seedLimit:u,structureId:o}):{};return null!=p&&p.error?La({result:p,stack:t}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function YD(e){var t;let i=Pw({...e,modifyOriginal:!1});if(i.error)return i;let n=i.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:a,appliedPolicies:o,qualifyingOnly:s,seedingProfile:l,participants:u,drawEntries:d,placeByes:c,drawSize:p,drawType:m,entries:f}=e,h=[],v=[],g=function(e){let{ignoreStageSpace:t,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=e;for(let o of a){if(n&&o.entryStage&&o.entryStage!==il)continue;let a=Xv({...o,ignoreStageSpace:t??r===Tl,entryStage:o.entryStage??il,event:e.event,drawDefinition:i,drawType:r});if(n&&a.error)return a}return{error:void 0}}({suppressDuplicateEntries:r,ignoreStageSpace:a,drawDefinition:n,drawEntries:d,drawType:m,entries:f});if(g.error)return g;let I=m===Ol?0:Be(e.seedsCount??0),U=zD({...e,qualifyingOnly:!p||s,appliedPolicies:o,drawDefinition:n,seedingProfile:l,participants:u,stage:il,seedsCount:I,placeByes:c,drawSize:p,entries:f});if(U.error&&!U.conflicts)return U;null!=(t=U.positioningReport)&&t.length&&h.push({[il]:U.positioningReport});let y=U.structureId;return U.conflicts&&(v=U.conflicts),m===Tl&&e.roundsCount&&WD({...e,drawDefinition:n,structureId:y}),{drawDefinition:n,positioningReports:h,conflicts:v,structureId:y}}var KD=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]});function JD(e){let t=e.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:o,event:s}=e,l=qu(e,[{[su]:!0,[uu]:!0}]);if(l.error)return l;if(!co({matchUpFormat:r}))return{error:Li};if(o){let e=Vy({drawDefinition:n,matchUpId:o,event:s});if(e.error)return e;let t=e.matchUp;if((null==t?void 0:t.matchUpType)===Xs)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:Qi};t&&(t.matchUpFormat=r,Cp({tournamentId:null==i?void 0:i.tournamentId,eventId:null==s?void 0:s.eventId,context:"setMatchUpFormat",drawDefinition:n,matchUp:t}))}else if(Array.isArray(t)){if((null==s?void 0:s.eventType)===Xs)return{error:Ti};for(let e of t){let t=Hc({drawDefinition:n,structureId:e});if(t.error)return t;t.structure&&(t.structure.matchUpFormat=r)}}else if(a){if((null==s?void 0:s.eventType)===Xs)return{error:Ti};let e=Hc({drawDefinition:n,structureId:a});if(e.error)return e;e.structure&&(e.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return t=t??(a?[a]:void 0),kp({drawDefinition:n,structureIds:t}),{...At}}function QD({tournamentRecord:e,drawDefinition:t,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(null==a?void 0:a.matchUpFormat)===i||null!=a&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let e=function({tieFormat:e}){let t=Jo({checkCollectionIds:!1,tieFormat:e});if(t.error)return t;for(let i of e.collectionDefinitions)i.collectionId||(i.collectionId=rs());return{tieFormat:e}}({tieFormat:r});if(e.error)return e;t.tieFormat=e.tieFormat??r}else if(i){let n=JD({tournamentRecord:e,drawDefinition:t,matchUpFormat:i,event:a});if(n.error)return{info:"matchUpFormat or tieFormat error",error:n.error}}n&&(t.matchUpType=n)}return{error:void 0}}var ZD={};be(ZD,{attachPolicies:()=>cS,findPolicy:()=>Rm,getAppliedPolicies:()=>gm,getPolicyDefinitions:()=>Im,mutate:()=>XD,query:()=>iT,removePolicy:()=>eT});var XD={};function eT(e){let t=qu(e,[{policyType:!0,_anyOf:{[nu]:!1,[au]:!1,[su]:!1,[Au]:!1}}]);if(t.error)return t;let i,n=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(n)return tT(e,n);if(!e.tournamentRecords)return{error:Bt};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:Bt};for(let n of t){let t=tT(e,e.tournamentRecords[n]);if(t.error)return t;i=!0}}return i?{...At}:{error:an}}function tT(e,t){let i=gm(e).appliedPolicies??{};return i[e.policyType]?(delete i[e.policyType],Object.keys(i).length?Sd({element:t,extension:{name:Od,value:i}}):Ud({element:t,name:Od}),{...At}):{error:an}}be(XD,{attachPolicies:()=>cS,removePolicy:()=>eT});var iT={};be(iT,{findPolicy:()=>Rm,getAppliedPolicies:()=>gm,getPolicyDefinitions:()=>Im});var nT={[pd]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[zl]:{positioning:fl},[Hl]:{positioning:fl}},positioning:"SEPARATE"},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},rT=nT;function aT({appliedPolicies:e,policyDefinitions:t,drawDefinition:i,stack:n}){if(t&&"object"!=typeof t)return La({info:"policyDefinitions must be an object",result:{error:Cr},stack:n});let r={[dd]:null==e?void 0:e[dd]};return t?function({policyDefinitions:e,appliedPolicies:t,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(e))JSON.stringify(null==t?void 0:t[r])!==JSON.stringify(e[r])&&(i[r]=e[r]);Object.keys(i).length&&(cS({policyDefinitions:i,drawDefinition:n}),t&&Object.assign(t,i))}({policyDefinitions:t,appliedPolicies:e,policiesToAttach:r,drawDefinition:i}):r.avoidance&&cS({drawDefinition:i,policyDefinitions:r}),!(null!=e&&e[pd])&&!(null!=t&&t[pd])&&(cS({policyDefinitions:rT,drawDefinition:i}),e&&Object.assign(e,rT)),{error:void 0}}function oT(e){var t,i,n,r,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:u,matchUpType:d,tieFormat:c,drawType:p,stack:m,event:f}=e,h=e.drawId?null==(t=null==f?void 0:f.drawDefinitions)?void 0:t.find((t=>t.drawId===e.drawId)):void 0;h&&p!==h.drawType&&(h.drawType=p);let v=h??function(e){let{drawId:t=rs(),processCodes:i,matchUpType:n,drawType:r}=e??{},a=KD();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:t})}({processCodes:e.processCodes,drawId:e.drawId,drawType:p}),g=QD({tournamentRecord:o,drawDefinition:v,matchUpFormat:s,matchUpType:d,tieFormat:c,event:f});if(g.error)return La({result:g,stack:m});let I=aT({appliedPolicies:l,policyDefinitions:u,drawDefinition:v,stack:m});if(I.error)return I;let U=null==(n=null==(i=null==h?void 0:h.structures)?void 0:i.find((e=>e.stage===il&&1===e.stageSequence)))?void 0:n.structureId,y=h?null==(r=h.structures)?void 0:r.filter((e=>e.stage===nl)):[];return{drawDefinition:v,structureId:U,existingDrawDefinition:h,existingQualifyingPlaceholderStructureId:1===(null==y?void 0:y.length)&&!(null!=(a=y[0].matchUps)&&a.length)&&y[0].structureId}}var sT={};function lT(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}be(sT,{addGoesTo:()=>lv,allCompetitionMatchUps:()=>tv,allDrawMatchUps:()=>nv,allEventMatchUps:()=>Xh,allPlayoffPositionsFilled:()=>UI,allTournamentMatchUps:()=>ev,analyzeDraws:()=>vS,analyzeMatchUp:()=>Kb,analyzeTournament:()=>RT,bulkUpdatePublishedEventIds:()=>VT,calculateWinCriteria:()=>Bb,categoryCanContain:()=>Yo,checkMatchUpIsComplete:()=>Gh,checkValidEntries:()=>hw,compareTieFormats:()=>kT,competitionScheduleMatchUps:()=>kb,courtGridRows:()=>mb,credits:()=>lT,drawMatchUps:()=>Jb,eventMatchUps:()=>Eb,filterMatchUps:()=>Vh,filterParticipants:()=>Wv,findDrawDefinition:()=>AS,findExtension:()=>Cd,findVenue:()=>Th,getAggregateTeamResults:()=>TT,getAllDrawMatchUps:()=>Qh,getAllEventData:()=>WT,getAllStructureMatchUps:()=>jh,getAllowedDrawTypes:()=>gT,getAllowedMatchUpFormats:()=>vT,getAppliedPolicies:()=>gm,getAssignedParticipantIds:()=>Mv,getAvailableMatchUpsCount:()=>bS,getAvailablePlayoffProfiles:()=>QU,getCategoryAgeDetails:()=>Ho,getCheckedInParticipantIds:()=>Zf,getCompetitionDateRange:()=>PT,getCompetitionMatchUps:()=>Ob,getCompetitionParticipants:()=>dT,getCompetitionPenalties:()=>UT,getCompetitionVenues:()=>qT,getCourtInfo:()=>Mh,getCourts:()=>Zb,getDrawData:()=>KT,getDrawDefinitionTimeItem:()=>om,getDrawParticipantRepresentativeIds:()=>RS,getDrawStructures:()=>zc,getDrawTypeCoercion:()=>dw,getEligibleVoluntaryConsolationParticipants:()=>TS,getEntriesAndSeedsCount:()=>hb,getEvent:()=>iR,getEventData:()=>JT,getEventMatchUpFormatTiming:()=>Tb,getEventProperties:()=>eR,getEventPublishStatus:()=>Lv,getEventStructures:()=>vI,getEventTimeItem:()=>sm,getEvents:()=>tR,getFlightProfile:()=>Eh,getHomeParticipantId:()=>Vb,getLinkedTournamentIds:()=>uc,getMatchUpCompetitiveProfile:()=>Sf,getMatchUpContextIds:()=>jb,getMatchUpDailyLimits:()=>Fb,getMatchUpDailyLimitsUpdate:()=>Rb,getMatchUpDependencies:()=>uv,getMatchUpFormat:()=>qb,getMatchUpFormatTiming:()=>hh,getMatchUpFormatTimingUpdate:()=>Ub,getMatchUpScheduleDetails:()=>Oh,getMatchUpType:()=>_h,getMatchUpsMap:()=>rf,getMatchUpsStats:()=>Wb,getMatchUpsToSchedule:()=>XT,getMaxEntryPosition:()=>vb,getModifiedMatchUpFormatTiming:()=>bb,getPairedParticipant:()=>Fh,getParticipantEventDetails:()=>cT,getParticipantIdFinishingPositions:()=>NS,getParticipantMembership:()=>pT,getParticipantResults:()=>wy,getParticipantScaleItem:()=>Mw,getParticipantSchedules:()=>mT,getParticipantSignInStatus:()=>fT,getParticipantTimeItem:()=>um,getParticipants:()=>zv,getPersonRequests:()=>lb,getPolicyDefinitions:()=>Im,getPositionAssignments:()=>cw,getPositionsPlayedOff:()=>KU,getPredictiveAccuracy:()=>xb,getProfileRounds:()=>pb,getPublishState:()=>Vv,getRoundMatchUps:()=>uf,getRounds:()=>Yb,getScaleValues:()=>Zu,getScaledEntries:()=>HD,getScheduledRoundsDetails:()=>tb,getSchedulingProfile:()=>rb,getSchedulingProfileIssues:()=>sb,getSeedingThresholds:()=>_g,getSeedsCount:()=>fw,getStructureSeedAssignments:()=>Xm,getTeamLineUp:()=>xh,getTieFormat:()=>LT,getTimeItem:()=>am,getTournamentIds:()=>Ad,getTournamentInfo:()=>wT,getTournamentPenalties:()=>IT,getTournamentPersons:()=>DT,getTournamentPoints:()=>ET,getTournamentPublishStatus:()=>_v,getTournamentStructures:()=>gI,getTournamentTimeItem:()=>lm,getValidGroupSizes:()=>kg,getVenueData:()=>Ah,getVenuesAndCourts:()=>$T,isAdHoc:()=>mf,isCompletedStructure:()=>II,isValidForQualifying:()=>pw,isValidMatchUpFormat:()=>co,matchUpActions:()=>ow,participantScaleItem:()=>Ov,participantScheduledMatchUps:()=>Mb,positionActions:()=>uw,publicFindCourt:()=>Nh,publicFindVenue:()=>bh,tallyParticipantResults:()=>xy,tieFormatGenderValidityCheck:()=>za,tournamentMatchUps:()=>Cb,validMatchUp:()=>sf,validMatchUps:()=>lf,validateCollectionDefinition:()=>Ko,validateLineUp:()=>tI});var uT={};function dT(e){let{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:Lt};let i=[],n={},r={},a={},o=[],s={},l=[];for(let u of Object.values(t)){let{participantIdsWithConflicts:t,mappedMatchUps:d,participantMap:c,participants:p,matchUps:m,derivedEventInfo:f,derivedDrawInfo:h}=zv({...e,tournamentRecord:u});Object.assign(s,d),Object.assign(n,c),Object.assign(r,f),Object.assign(a,h),i.push(...p??[]),o.push(...m??[]),null==t||t.forEach((e=>{l.includes(e)||l.push(e)}))}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:i,...At,matchUps:o}}function cT({tournamentRecord:e,participantId:t}){if(!e)return{error:Bt};if(!t)return{error:xn};let i=[t].concat((e.participants??[]).filter((e=>{var i;return(null==e?void 0:e.participantType)&&[Jp,Kp].includes(e.participantType)&&(null==(i=e.individualParticipantIds)?void 0:i.includes(t))})).map((e=>e.participantId)));return{eventDetails:(e.events??[]).filter((e=>pt(((null==e?void 0:e.entries)??[]).map((e=>e.participantId)),i))).map((e=>({eventName:e.eventName,eventId:e.eventId})))}}function pT({tournamentRecord:e,participantId:t}){if(!e)return{error:Bt};if(!t)return{error:xn};let{participants:i}=zv({participantFilters:{participantTypes:[Jp,Kp,Yp]},tournamentRecord:e});return(i??[]).filter((e=>{var i;return null==(i=e.individualParticipantIds)?void 0:i.includes(t)})).reduce(((e,t)=>{let i=t.participantType;return i&&(e[i]||(e[i]=[]),e[i].push(t)),e}),{})}function mT({participantFilters:e={},tournamentRecord:t}){if(!t)return{error:Bt};if("object"!=typeof e)return{error:Mr,context:{participantFilters:e}};let i=ev({tournamentRecord:t,contextFilters:{eventIds:e.eventIds}}).matchUps??[],n=Object.assign({},...i.map((e=>({[e.matchUpId]:e})))),r=i.filter((({schedule:e})=>e&&Object.keys(e).length)),a=uv({tournamentRecord:t,matchUps:i}).sourceMatchUpIds??[],o={};for(let s of r){let e,{sides:t}=s,i=(null==t?void 0:t.map((t=>{if(t.participant)return[t.participant].concat(...t.participant.individualParticipants||[]);a[s.matchUpId]&&!e&&(e=(a[s.matchUpId]||[]).map((e=>n[e])).filter((({winningSide:e,bye:t})=>!e&&!t)))})).filter(Boolean).flat())??[];for(let n of i){let{participantId:e}=n;o[e]||(o[e]={potentialMatchUps:[],participant:n,matchUps:[]}),o[e].matchUps.push(s)}let r=(null==e?void 0:e.map((({sides:e})=>e)).flat().map((({participant:e})=>e&&[e].concat(...e.individualParticipants||[]))).filter(Boolean).flat())||[];for(let n of r){let{participantId:e}=n;o[e]||(o[e]={potentialMatchUps:[],participant:n,matchUps:[]}),o[e].potentialMatchUps.push(s)}}return{participantSchedules:Object.values(o).filter((({participant:t})=>!(e.participantIds&&!e.participantIds.includes(t.participantId)||e.participantTypes&&!e.participantTypes.includes(t.participantType)))),...At}}function fT({tournamentRecord:e,participantId:t}){if(!e)return{error:Bt};if(!t)return{error:xn};let{participant:i}=nm({tournamentRecord:e,participantId:t});if(!i)return{error:_n};let{timeItem:n}=am({itemType:$p,element:i});return n&&n.itemValue===Wp&&Wp}be(uT,{filterParticipants:()=>Wv,getCompetitionParticipants:()=>dT,getPairedParticipant:()=>Fh,getParticipantEventDetails:()=>cT,getParticipantMembership:()=>pT,getParticipantScaleItem:()=>Mw,getParticipantSchedules:()=>mT,getParticipantSignInStatus:()=>fT,getParticipantTimeItem:()=>um,getParticipants:()=>zv,getScaleValues:()=>Zu,participantScaleItem:()=>Ov,validateLineUp:()=>tI});var hT={};function vT({tournamentRecord:e,categoryName:t,categoryType:i}){var n;if(!e)return{error:Bt};let{appliedPolicies:r}=gm({tournamentRecord:e});return((null==(n=null==r?void 0:r[cd])?void 0:n.matchUpFormats)||[]).filter((({categoryNames:e,categoryTypes:n})=>!t&&!n||t&&(null==e?void 0:e.includes(t))||i&&(null==n?void 0:n.includes(i))))}function gT({tournamentRecord:e,categoryName:t,categoryType:i}){var n;if(!e)return{error:Bt};let{appliedPolicies:r}=gm({tournamentRecord:e});return((null==(n=null==r?void 0:r[fd])?void 0:n.allowedDrawTypes)||[]).filter((({categoryNames:e,categoryTypes:n})=>!t&&!n||t&&(null==e?void 0:e.includes(t))||i&&(null==n?void 0:n.includes(i))))}function IT({tournamentRecord:e}){if(!e)return{error:Bt};let t=((null==e?void 0:e.participants)??[]).reduce(((e,t)=>{let{participantId:i}=t;return(t.penalties??[]).forEach((t=>{let{penaltyId:n}=t||{};e[n]?e[n].participants.push(i):e[n]={...t,participantIds:[i]}})),e}),{});return{penalties:Object.values(t)}}function UT({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Lt};let t=[];for(let i of Object.values(e)){let{penalties:e}=IT({tournamentRecord:i});t.push(...e??[])}return{penalties:t}}function yT({event:e}){return{eventInfo:(({eventId:e,eventName:t,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:l,endDate:u,ballType:d,discipline:c,onlineResources:p,notes:m})=>({eventId:e,eventName:t,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:l,endDate:u,ballType:d,discipline:c,onlineResources:p,notes:m}))(e)}}be(hT,{analyzeDraws:()=>vS,analyzeTournament:()=>RT,getAggregateTeamResults:()=>TT,getAllowedDrawTypes:()=>gT,getAllowedMatchUpFormats:()=>vT,getAppliedPolicies:()=>gm,getCompetitionDateRange:()=>PT,getCompetitionPenalties:()=>UT,getPolicyDefinitions:()=>Im,getTournamentInfo:()=>wT,getTournamentPenalties:()=>IT,getTournamentPersons:()=>DT,getTournamentPoints:()=>ET,getTournamentStructures:()=>gI,getTournamentTimeItem:()=>lm});var ST={[sd]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}};function wT(e){var t,i,n,r;let{tournamentRecord:a}=e??{};if(!a)return{error:Bt};let o=(({tournamentId:e,tournamentRank:t,tournamentStatus:i,formalName:n,tournamentName:r,promotionalName:a,onlineResources:o,localTimeZone:s,activeDates:l,startDate:u,endDate:d,hostCountryCode:c,venues:p,notes:m,updatedAt:f})=>({tournamentId:e,tournamentRank:t,tournamentStatus:i,formalName:n,tournamentName:r,promotionalName:a,onlineResources:o,localTimeZone:s,activeDates:l,startDate:u,endDate:d,hostCountryCode:c,venues:p,notes:m,updatedAt:f}))(a),s=(null==(t=zv({participantFilters:{participantRoles:[og,dg,lg,ug,pg]},policyDefinitions:ST,tournamentRecord:a}))?void 0:t.participants)??[];s&&(o.tournamentContacts=s);let l=null==(i=Vv({tournamentRecord:a}))?void 0:i.publishState,u=(null==(r=null==(n=null==l?void 0:l.tournament)?void 0:n.status)?void 0:r.publishedEventIds)||[],d=[];for(let c of a.events??[])if(null==e||!e.usePublishState||u.includes(c.eventId)){let e=yT({event:c}).eventInfo;e&&d.push(e)}return o.timeItemValues=iS({element:a}),o.publishState=null==l?void 0:l.tournament,o.eventInfo=d,{tournamentInfo:ts(_a(o),!1,!0),...At}}function PT({tournamentRecords:e}){if(!wt(e))return{error:Lt};let t=Object.keys(e??{}).reduce(((t,i)=>{let n=e[i],{tournamentInfo:{startDate:r,endDate:a}}=wT({tournamentRecord:n}),o=r&&new Date(Eo(r));(!t.startDate||o&&o<t.startDate)&&(t.startDate=o);let s=a&&new Date(Eo(a));return(!t.endDate||s&&s>t.endDate)&&(t.endDate=s),t}),{startDate:void 0,endDate:void 0}),i=t.startDate&&Eo(t.startDate.toISOString()),n=t.endDate&&Eo(t.endDate.toISOString());return i&&n?{startDate:i,endDate:n}:{error:cn}}function DT({tournamentRecord:e,participantFilters:t}){if(!e)return{error:Bt};let i=e.participants||[];t&&(i=Wv({participants:i,participantFilters:t,tournamentRecord:e}));let n={};return i.forEach((e=>{e.person&&(e=>{if(e.person){let{personId:t}=e.person;n[t]?n[t].participantIds.push(e.participantId):n[t]={...e.person,participantIds:[e.participantId]}}})(e)})),{tournamentPersons:Object.values(n)}}function TT(e){var t,i,n,r,a,o,s,l;let u=qu(e,[{[au]:!0}]);if(u.error)return u;let d=e.finishingPositionRangeBounsPoints||{},c={},p=e=>{var t,i,n;let r=null==(t=null==e?void 0:e.individualParticipants)?void 0:t.map((e=>{var t;return 1===(null==(t=e.teams)?void 0:t.length)&&e.teams[0]}));return 1===(null==(i=null==e?void 0:e.teams)?void 0:i.length)&&(null==(n=null==e?void 0:e.teams)?void 0:n[0])||(null==r?void 0:r[0].participantId)===(null==r?void 0:r[1].participantId)&&(null==r?void 0:r[0])},{matchUps:m,participants:f}=zv({participantFilters:{participantTypes:[zp]},withRankingProfile:!0,withStatistics:!0,...e});for(let U of f??[]){if(U.participantType===Hp)continue;"draw-0-3"===(null==(i=null==(t=U.draws)?void 0:t[0])?void 0:i.drawId)&&console.log(U.participantType,U.draws[0].finishingPositionRange);let e=p(U);if(e)for(let t of(null==U?void 0:U.draws)??[]){let i=null==(n=null==t?void 0:t.finishingPositionRange)?void 0:n.join("-");if(i&&null!=d&&d[i]){c[`${null==e?void 0:e.participantId}|${null==t?void 0:t.drawId}|${i}`]=d[i]}}}let h=e=>({teamName:e,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),v=(e,t,i)=>{void 0===e[t]&&(e[t]=0),e[t]+=i},g={},I={};for(let U of m??[]){let{sides:e,matchUpFormat:t}=U,i=t&&no(t);if(2===(null==e?void 0:e.length)&&null!=(r=i.setFormat)&&r.timed&&(!i.finalSetFormat||null!=(a=i.finalSetFormat)&&a.timed))for(let n of e){let e=p(n.participant),t=null==e?void 0:e.participantId,i=null==(o=n.participant)?void 0:o.participantId,r=null==e?void 0:e.participantName,a=n.sideNumber,u=(null==(s=n.participant)?void 0:s.individualParticipantIds)||i&&[i]||[];if(u.forEach((e=>{e&&!g[e]&&(g[e]=h(r))})),t&&a){I[t]||(I[t]=h(r));let e=[...u.map((e=>g[e])),I[t]];U.winningSide&&(a===U.winningSide?e.forEach((e=>v(e,"win",1))):e.forEach((e=>v(e,"loss",1))));let i=(null==(l=U.score)?void 0:l.sets)||[];for(let t of i){let i=(null==t?void 0:t[`side${3-a}Score`])||0,n=(null==t?void 0:t[`side${a}Score`])||0,r=n-i;e.forEach((e=>v(e,"pointsPlayed",n+i))),e.forEach((e=>v(e,"points",n))),e.forEach((e=>v(e,"diff",r)))}}}}for(let U of Object.keys(c)){let[e]=U.split("|");I[e]&&(I[e].bonus+=c[U],I[e].pointsPct=parseFloat((I[e].points/I[e].pointsPlayed).toFixed(2)),I[e].standingPoints=I[e].win+I[e].bonus)}for(let U of Object.keys(g))g[U].pointsPct=parseFloat((g[U].points/g[U].pointsPlayed).toFixed(2));return{...At,individualResults:g,teamResults:I}}function bT(e){var t,i,n,r,a,o,s;let l=2===(null==(i=null==(t=e.participants)?void 0:t.filter((({participantType:e})=>e===Jp)))?void 0:i.length),u=1===(null==(n=e.events)?void 0:n.length)&&e.events[0],d=1===(null==(r=null==u?void 0:u.drawDefinitions)?void 0:r.length)&&u.drawDefinitions[0],c=2===(null==(s=null==(o=1===(null==(a=null==d?void 0:d.structures)?void 0:a.length)&&d.structures[0])?void 0:o.positionAssignments)?void 0:s.length);return!!(u.tieFormat&&l&&c)}function RT({tournamentRecord:e}){var t;if(!e)return{error:Bt};let{drawsAnalysis:i}=vS({tournamentRecord:e}),n={isDual:bT(e),drawsAnalysis:i},r=zv({tournamentRecord:e});return null!=(t=r.missingParticipantIds)&&t.length&&(n.missingParticipantIds=r.missingParticipantIds),{...At,analysis:n}}function NT(e,t){return e&&t&&Array.isArray(t)&&t[e-1]||"object"==typeof t&&t[e]}function MT(e){let{participation:t={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:o,category:s,endDate:l,level:u}=e,{participationOrder:d,flightNumber:c,rankingStage:p}=t;return{awardProfile:i.find((e=>{var t,i,m,f,h,v,g,I,U,y;return(e=>!n&&!l||!e.dateRanges||e.dateRanges.some((e=>{let t=!n||!e.startDate||new Date(n)>new Date(e.startDate),i=!l||!e.endDate||new Date(l)<=new Date(e.endDate);return t&&i})))(e)&&(!e.maxFlightNumber||c<=e.maxFlightNumber)&&(!(null!=(t=e.drawTypes)&&t.length)||(null==(i=e.drawTypes)?void 0:i.includes(o)))&&(!(null!=(m=e.drawSizes)&&m.length)||e.drawSizes.includes(a))&&(!(null!=(f=e.stages)&&f.length)||e.stages.includes(p))&&(!(null!=(h=e.levels)&&h.length)||e.levels.includes(u))&&(!e.maxDrawSize||a<=e.maxDrawSize)&&(!e.drawSize||e.drawSize===a)&&(!e.maxLevel||u<=e.maxLevel)&&(!c||!(null!=(g=null==(v=e.flights)?void 0:v.flightNumbers)&&g.length)||e.flights.flightNumbers.includes(c))&&(!e.participationOrder||e.participationOrder===d)&&(!(null!=(I=e.category)&&I.ageCategoryCodes)||e.category.ageCategoryCodes.includes(null==s?void 0:s.ageCategoryCode))&&(!(null!=(U=e.eventTypes)&&U.length)||(null==(y=e.eventTypes)?void 0:y.includes(r)))}))}}function AT({participantWon:e,flightNumber:t,valueObj:i,drawSize:n,flights:r,level:a}){var o,s;let l,u,d,c,p=(e,t)=>{if(e){if(Array.isArray(t)){let i=t.find((t=>t.flight===e||t.f===e));return i.value||i.v}if("object"==typeof t){let i=t.flights||t.f;if(Array.isArray(i))return i[e-1]}}},m=(e,t)=>{let i=(null==e?void 0:e.value)||(null==e?void 0:e.v)||(Ye(e)?e:0),n=NT(a,null==e?void 0:e.level);return{value:p(t,n)||Ye(n)&&n||i}},f=0,h=(e?"won":!1===e&&"lost")||void 0;if(Array.isArray(i)){let e=i.find((e=>{var t;return e.drawSize===n||(null==(t=e.drawSizes)?void 0:t.includes(n))})),r=i.find((e=>e.drawSize&&e.threshold&&n>e.drawSize)),a=i.find((e=>{var t;return!(e.drawSize||null!=(t=e.drawSizes)&&t.length)}));void 0!==h&&(e=null==e?void 0:e[h],r=null==r?void 0:r[h],a=null==a?void 0:a[h]),u=m(e,t).value,d=m(r,t).value,c=m(a,t).value,f=u||d||c,l=u&&e.requireWin||d&&r.requireWin||(null==a?void 0:a.requireWin)}else if("object"==typeof i){let e=null==(o=null==i?void 0:i.drawSizes)?void 0:o[n],r=i;void 0!==h&&(e=null==e?void 0:e[h],r=null==r?void 0:r[h]),u=m(e,t).value,c=m(r,t).value,f=u||c,l=u?e.requireWin:null==r?void 0:r.requireWin}else Ye(i)&&void 0===h&&(f=i);return t&&null!=(s=null==r?void 0:r.pct)&&s[t]&&(f=Math.round(f*r.pct[t])),{awardPoints:f,requireWin:l}}function ET({participantFilters:e,policyDefinitions:t,tournamentRecord:i,level:n}){var r;if(!i)return{error:Bt};let{policyDefinitions:a}=Im({policyTypes:[ad],tournamentRecord:i}),o=(null==t?void 0:t[ad])??(null==a?void 0:a[ad]);if(!o)return{error:Xi};let s=o.awardProfiles,l=o.requireWinFirstRound,u=o.requireWinForPoints,{participants:d,derivedEventInfo:c,derivedDrawInfo:p,mappedMatchUps:m}=zv({withRankingProfile:!0,participantFilters:e,tournamentRecord:i}),f=null==d?void 0:d.filter((e=>{var t;return null==(t=e.draws)?void 0:t.length})),h={},v={},g={};for(let I of f??[]){let{participantType:e,participantId:t,person:a,draws:o}=I;for(let d of o){let o,{drawId:f,structureParticipation:U,eventId:y}=d,S=c[y],w=p[f],P=null==w?void 0:w.drawType,{category:D,eventType:T}=S||{},b=d.startDate||S.startDate||i.startDate,R=d.endDate||S.endDate||i.endDate;if((T!==el||t===Hp)&&s){let i,d=u,c=0,p=0,y=0;for(let a of U){let{finishingPositionRange:u,participationOrder:f,participantWon:h,flightNumber:v,rankingStage:g,winCount:U}=a;c+=U||0;let S=null==w?void 0:w.drawSize,{awardProfile:N}=MT({awardProfiles:s,participation:a,eventType:T,startDate:b,category:D,drawSize:S,drawType:P,endDate:R,level:n});if(N){if(!S)continue;let e=Array.isArray(u)&&Math.max(...u),t=Qe(u||[]).join("-"),a=e&&g!==nl&&(null==u?void 0:u.includes(S));void 0!==N.requireWinForPoints&&(d=N.requireWinForPoints),void 0!==N.requireWinFirstRound&&(l=N.requireWinFirstRound);let o,{finishingPositionPoints:s={},finishingPositionRanges:c,finishingRound:m,pointsPerWin:I,flights:w}=N,P=Array.isArray(N.perWinPoints)?null==(r=N.perWinPoints)?void 0:r.find((e=>{var t;return null==(t=e.participationOrders)?void 0:t.includes(f)})):N.perWinPoints,D=s.participationOrders,T=0;if((!D||D.includes(f))&&c&&e){let t=c[e];t&&({awardPoints:T,requireWin:o}=AT({flightNumber:v,valueObj:t,drawSize:S,flights:w,level:n}))}if(!T&&m&&1===f&&e){let t=m[e];t&&({awardPoints:T,requireWin:o}=AT({participantWon:h,flightNumber:v,valueObj:t,drawSize:S,flights:w,level:n}))}if(a&&void 0!==l&&(d=l),void 0!==o&&(d=o),T>p&&(!d||U)&&(p=T,i=e),!T&&I&&U&&(y+=U*I,i=t),!T&&U&&P){let e=NT(n,null==P?void 0:P.level);e?y+=U*e:P.value&&(y+=U*P.value)}}if(o=p+y,e===Hp){let e=(I.matchUps||[]).filter((({structureId:e})=>e===a.structureId));for(let{matchUpId:i}of e){let e=m[i],n=e.sides.find((e=>e.participantId===t)).sideNumber;if(e.winningSice===n)for(let t of e.tieMatchUps)t.winningSide}}}if(y||p){let n={winCount:c,positionPoints:p,rangeAccessor:i,perWinPoints:y,eventType:T,drawId:f,points:o},r=null==a?void 0:a.personId;r?(h[r]||(h[r]=[]),h[r].push(n)):e===Kp?(g[t]||(g[t]=[]),g[t].push(n)):e===Hp&&(v[t]||(v[t]=[]),v[t].push(n))}}}}return{participantsWithOutcomes:f,personPoints:h,pairPoints:g,teamPoints:v,...At}}var CT={};function OT(e){var t;if(!e)return{};let i=[],n=e.tieFormatName,r=null==(t=e.collectionDefinitions)?void 0:t.map((e=>{let{matchUpType:t,matchUpFormat:n,matchUpCount:r,category:a,gender:o}=e;i.includes(n)||i.push(n);let s=null==a?void 0:a.ageCategoryCode;return[r,t===Ce?"D":"S",s,n,o].join(";")})).join("|");return{tieFormatName:e&&n||"UNNAMED",matchUpFormats:i,tieFormatDesc:r}}function kT({considerations:e={},descendant:t,ancestor:i}){var n,r;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=OT(t),{matchUpFormats:u,tieFormatDesc:d}=OT(i),c=Qe((s??[]).filter((e=>!(u??[]).includes(e))).concat((u??[]).filter((e=>!(s??[]).includes(e))))),p=!(null==e||!e.collectionName||t.collectionDefinitions.map((({collectionName:e})=>e)).join("|")===i.collectionDefinitions.map((({collectionName:e})=>e)).join("|")),m=!(null==e||!e.collectionOrder||t.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")===i.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")),f=Object.assign({},...((null==t?void 0:t.collectionDefinitions)||[]).map((e=>({[e.collectionId]:e})))),h=Object.assign({},...((null==i?void 0:i.collectionDefinitions)||[]).map((e=>({[e.collectionId]:e}))));a.collectionIds=ct(Object.keys(f),Object.keys(h)),o.collectionIds=ct(Object.keys(h),Object.keys(f)),a.collectionsValue=FT(f),o.collectionsValue=FT(h),a.groupsCount=(null==(n=null==i?void 0:i.collectionGroups)?void 0:n.length)??(0-((null==(r=null==t?void 0:t.collectionGroups)?void 0:r.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let v=a.collectionsValue.totalValue-o.collectionsValue.totalValue,g=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,I=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,U=o.collectionsValue.assignmentValues.some(((e,t)=>{let i=a.collectionsValue.assignmentValues[t];return!i||e.valueKey!==i.valueKey||e.value!==i.value||!!Array.isArray(e.value)&&e.value.every(((e,t)=>i.value[t]===e))})),y=p||m||d!==l||I||U||0!==v,S=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=S.length&&S;return{matchUpFormatDifferences:c,matchUpCountDifference:g,descendantDifferences:a,ancestorDifferences:o,orderDifference:m,valueDifference:v,nameDifference:p,descendantDesc:l,ancestorDesc:d,...At,different:y,invalid:w}}function FT(e){let t=[],i=[],n=0;return{totalValue:Object.keys(e).sort(Gv).reduce(((r,a)=>{let o=e[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:d,scoreValue:c,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:d,scoreValue:c,setValue:p},f=Object.keys(m).filter((e=>![void 0,null].includes(m[e])&&(!Array.isArray(m[e])||m[e].length>0)));1!==f.length&&t.push({collectionId:a});let h=f[0];if(h){let e="collectionValueProfiles"===h?Object.values(s):m[h];i.push({valueKey:h,value:e})}return n+=u,null!=s&&s.length?r+s.reduce(((e,t)=>e+t.value),0):u?Ye(d)?r+d*u:Ye(c)?r+c*u:Ye(p)?r+p*u:r+l:r}),0),totalMatchUps:n,invalidValues:t,assignmentValues:i}}function xT(e){Object.assign(e,{inContext:!0});let{matchUp:t,error:i}=_T(e);return{matchUp:ts(t,!0,!0),error:i}}function _T({participantsProfile:e,afterRecoveryTimes:t,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:d,event:c}){var p;if(!i)return{error:Bt};if("string"!=typeof s)return{error:Hi};if(!a||!c){let e=(ev({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find((e=>e.matchUpId===s));if(!e)return{error:Yi};({eventId:u,drawId:d}=e),({event:c,drawDefinition:a}=Ch({tournamentRecord:i,eventId:u,drawId:d}))}if(!a)return{error:Wt};r&&!n&&(n=bm({tournamentRecord:i,contextProfile:r}));let m={surfaceCategory:(null==c?void 0:c.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(null==c?void 0:c.indoorOutdoor)??i.indoorOutdoor,endDate:(null==c?void 0:c.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(null==c?void 0:c.eventId),drawId:d},{participants:f=[]}=vm({participantsProfile:e,tournamentRecord:i,contextProfile:r,inContext:l});if(o){let e=(nv({context:l?m:void 0,participants:f,afterRecoveryTimes:t,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,inContext:l,event:c}).matchUps??[]).find((e=>e.matchUpId===s));return e?{drawDefinition:a,structure:null==(p=null==a?void 0:a.structures)?void 0:p.find((t=>t.structureId===e.structureId)),matchUp:e}:{error:Yi}}{let{matchUp:e,structure:i}=Vy({context:l?m:void 0,tournamentParticipants:f,afterRecoveryTimes:t,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:s,inContext:l,event:c});return{matchUp:e,structure:i,drawDefinition:a}}}function LT({tournamentRecord:e,drawDefinition:t,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:o,event:s}){var l,u,d,c,p;if(!e)return{error:Bt};if(!(o||s||i||n))return La({result:{error:un},stack:"getTieFormat"});a&&!s&&(s=null==(l=e.events)?void 0:l.find((e=>e.eventId===a)));let m=xT({tournamentRecord:e,drawDefinition:t,matchUpId:n,drawId:o,event:s});if(n&&null!=m&&m.error)return m;if(!t&&null!=m&&m.drawDefinition&&(t=null==m?void 0:m.drawDefinition),!(r=r??(null==m?void 0:m.structure))&&i&&!n){if(!t)return{error:li};let e=Hc({drawDefinition:t,structureId:i});if(e.error)return e;r=e.structure}let f=((null==r?void 0:r.tieFormat)||(null==r?void 0:r.tieFormatId))&&(null==(u=nf({structure:r,drawDefinition:t,event:s}))?void 0:u.tieFormat),h=((null==t?void 0:t.tieFormat)||(null==t?void 0:t.tieFormatId))&&(null==(d=nf({drawDefinition:t,event:s}))?void 0:d.tieFormat),v=null==(c=nf({event:s}))?void 0:c.tieFormat,g=null==(p=nf({matchUp:null==m?void 0:m.matchUp,drawDefinition:t,structure:r,event:s}))?void 0:p.tieFormat;return{...At,matchUp:null==m?void 0:m.matchUp,structureDefaultTieFormat:Jy(f),eventDefaultTieFormat:Jy(v),drawDefaultTieFormat:Jy(h),tieFormat:Jy(g),structure:r}}be(CT,{compareTieFormats:()=>kT,getTieFormat:()=>LT,tieFormatGenderValidityCheck:()=>za,validateCollectionDefinition:()=>Ko});var BT={};function VT({tournamentRecord:e,outcomes:t}){var i;if(!e)return{error:Bt};if(null==t||!t.length)return{error:un,info:"Missing outcomes"};let n=t.reduce(((e,t)=>{let{drawId:i,eventId:n}=t;return n&&i&&(e[n]?e[n].includes(i)||e[n].push(i):e[n]=[i]),e}),{}),r=Object.keys(n);return{publishedEventIds:(null==(i=e.events)?void 0:i.filter((e=>r.includes(e.eventId)))).filter((e=>{let t=Lv({event:e}),{drawDetails:i,drawIds:r}=t??{},{eventId:a}=e;return n[a].filter((e=>{let n=i?Object.keys(t.drawDetails).filter((e=>Bv({drawId:e,drawDetails:i}))):[];return(null==r?void 0:r.includes(e))||n.includes(e)})).length})).map((e=>e.eventId)),eventIdPublishedDrawIdsMap:n}}function jT({dates:e=[],extension:t}){var i;if(!t)return!1;if("boolean"==typeof t.value&&t.value)return!0;if(!e.length)return!1;let n=wt(t.value)?null==(i=t.value)?void 0:i.dates:void 0;return Array.isArray(n)?!(null==n||!n.length)&&!!n.filter((t=>!e.length||e.includes(t))).length:void 0}function GT({convertExtensions:e,ignoreDisabled:t,venue:i,court:n}){var r;let a={...ts(n,e,!0),venueId:i.venueId},{extension:o}=Cd({name:xd,element:n});if(t&&o){let e=wt(o.value)?null==(r=o.value)?void 0:r.dates:void 0,t=!0===(null==o?void 0:o.value)?[]:a.dateAvailability.map((t=>{let i=t.date;if(i&&!e.includes(i))return t})).filter(Boolean);a.dateAvailability=t}return{inContextCourt:a}}function $T(e){let{convertExtensions:t,ignoreDisabled:i,venueIds:n=[],dates:r}=e,a=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter((t=>!e.tournamentId||t===e.tournamentId)).forEach((e=>{let d=a[e];for(let a of d.venues??[])if(!n.length||n.includes(a.venueId)){if(i){let{extension:e}=Cd({name:xd,element:a});if(null!=e&&e.value)continue}o.includes(a.venueId)||(u.push(ts(a,t,!0)),o.push(a.venueId));for(let e of a.courts??[])if(!s.includes(e.courtId)){if(i){let{extension:t}=Cd({name:xd,element:e});if(jT({extension:t,dates:r}))continue}let{inContextCourt:n}=GT({convertExtensions:t,ignoreDisabled:i,venue:a,court:e});l.push(n),s.push(e.courtId)}}})),{courts:l,venues:u,...At}}function qT({tournamentRecords:e,requireCourts:t,dates:i}){return"object"==typeof e&&Object.keys(e).length?Object.keys(e).reduce(((n,r)=>{let a=e[r],{venues:o}=function({convertExtensions:e,tournamentRecord:t,ignoreDisabled:i,dates:n}){if(!t)return{error:Lt};let r=ts(t.venues??[],e).filter((e=>{if(!i)return e;let{extension:t}=Cd({name:xd,element:e});return!(null!=t&&t.value)&&e})).filter(Boolean),a=r.reduce(((t,r)=>{let a=((null==r?void 0:r.courts)||[]).filter((e=>{if(!(i||null!=n&&n.length))return e;let{extension:t}=Cd({name:xd,element:e});return jT({extension:t,dates:n})})).filter(Boolean).map((t=>{let{inContextCourt:n}=GT({convertExtensions:e,ignoreDisabled:i,venue:r,court:t});return n}));return a.length?t.concat(a):t}),[]);return{venues:r,courts:a}}({tournamentRecord:a,dates:i});return null==o||o.forEach((e=>{let{venueId:i,courts:r}=e;(!t||null!=r&&r.length)&&!n.venueIds.includes(i)&&(n.venues.push(e),n.venueIds.push(i))})),n}),{venues:[],venueIds:[]}):{error:Lt}}function WT({tournamentRecord:e,policyDefinitions:t}){if(!e)return{error:Bt};let i=e.events||[],n=(null==e?void 0:e.participants)||[],{tournamentInfo:r}=wT({tournamentRecord:e}),{venues:a}=$T({tournamentRecord:e});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:i.map((i=>{let{eventId:r}=i,a=yT({event:i}).eventInfo,o=Nm({tournamentRecord:e,event:i}).scheduleTiming,s=(i.drawDefinitions||[]).map((a=>{let s=(({drawId:e,drawName:t,matchUpFormat:i,updatedAt:n})=>({matchUpFormat:i,updatedAt:n,drawName:t,drawId:e}))(a),{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}=Zh({requireParticipants:!0,tournamentParticipants:n,context:{eventId:r},policyDefinitions:t,tournamentRecord:e,inContext:!0,scheduleTiming:o,drawDefinition:a,event:i});return{drawInfo:s,matchUps:{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}}})),l=Lv({event:i});return Object.assign(a,{drawsData:s,publish:l}),a}))}}}function HT({publishStatus:e,drawId:t}){var i,n,r;return null!=e&&e.drawDetails?null==(r=null==(n=null==(i=e.drawDetails)?void 0:i[t])?void 0:n.publishingDetail)?void 0:r.published:null==e||!e.drawIds||e.drawIds.includes(t)}be(BT,{bulkUpdatePublishedEventIds:()=>VT,getAllEventData:()=>WT,getCourtInfo:()=>Mh,getDrawData:()=>KT,getEventData:()=>JT,getEventPublishStatus:()=>Lv,getPublishState:()=>Vv,getTournamentPublishStatus:()=>_v,getVenueData:()=>Ah});var zT="PUBLIC",YT={PUBLIC_DISPLAY:zT,ADMIN_DISPLAY:"ADMIN"};function KT(e){var t,i,n;let{tournamentParticipants:r=[],includePositionAssignments:a,policyDefinitions:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,status:d=Kf,pressureRating:c,refreshResults:p,contextProfile:m,drawDefinition:f,noDeepCopy:h,sortConfig:v,context:g,event:I}=e;if(!f)return{error:$t};let U=(({matchUpFormat:e,updatedAt:t,drawType:i,drawName:n,drawId:r})=>({matchUpFormat:e,updatedAt:t,drawName:n,drawType:i,drawId:r}))(f);U.display=null==(t=Cd({element:f,name:Bd}).extension)?void 0:t.value;let y,S={},{allStructuresLinked:w,sourceStructureIds:P,hasDrawFeedProfile:D,structureGroups:T}=HI({drawDefinition:f});if(!w)return{error:Di};let b=(null==e?void 0:e.publishStatus)??Lv({event:I,status:d}),R=e.eventPublished??!(null==(n=null==(i=Vv({event:I}).publishState)?void 0:i.status)||!n.published),N=!1,M=!1,A=T.map((t=>{let i={},n=t.map((e=>{let{structure:t}=Hc({drawDefinition:f,structureId:e}),{seedAssignments:i}=Xm({drawDefinition:f,structure:t});return(null==t?void 0:t.stage)===il&&1===t.stageSequence&&(y=i),(null==t?void 0:t.stage)===nl&&(S[t.stageSequence??0]=i),t})).sort(((e,t)=>qc(e,t,v))).map((t=>{var n,a;if(!t)return;let d=null==t?void 0:t.structureId,h=[];t.stage&&[il,rl,ol].includes(t.stage)&&(h=y),(null==t?void 0:t.stage)===nl&&(h=S[t.stageSequence??0]);let{matchUps:v,roundMatchUps:w,roundProfile:T}=jh({seedAssignments:null!=(n=null==t?void 0:t.seedAssignments)&&n.length?void 0:h,context:{drawId:U.drawId,...g},hydrateParticipants:e.hydrateParticipants,participantsProfile:e.participantsProfile,tournamentParticipants:r,policyDefinitions:o,tournamentRecord:s,usePublishState:u,publishStatus:b,contextProfile:m,drawDefinition:f,inContext:l,structure:t,event:I}),{positionAssignments:R}=Kc({structure:t}),A=null==R?void 0:R.filter(ov(du)).map((e=>{var t,i;let n=null==(i=null==(t=Cd({element:e,name:tc}))?void 0:t.extension)?void 0:i.value,{drawPosition:r,participantId:a}=e;return M=!0,{participantResult:n,participantId:a,drawPosition:r}}));if(v.length&&((null==A||!A.length)&&e.allParticipantResults||p&&!t.structures)){let{subOrderMap:e}=_y({positionAssignments:R}),i=v.some((e=>e.matchUpType===ke))?v.filter((e=>e.matchUpType===ke)):v,n=xy({matchUpFormat:t.matchUpFormat,matchUps:i,policyDefinitions:o,pressureRating:c,subOrderMap:e});A=null==R?void 0:R.filter(ov(du)).map((e=>{var t;let{drawPosition:i,participantId:r}=e;return M=!0,{participantResult:r&&(null==(t=null==n?void 0:n.participantResults)?void 0:t[r]),participantId:r,drawPosition:i}}))}let E=t?(({stageSequence:e,structureName:t,structureType:i,matchUpFormat:n,stage:r})=>({stageSequence:e,structureName:t,structureType:i,matchUpFormat:n,stage:r}))(t):{},C=null==(a=Cd({element:t,name:Bd}).extension)?void 0:a.value;E.display=(null==C?void 0:C[zT])??C,E.sourceStructureIds=P[d],E.hasDrawFeedProfile=D[d],E.positionAssignments=R,E.structureActive=v.reduce(((e,t)=>{var i;let n=[Rc,bc,Nc,Pc,wc,Tc,Ec,kc].includes(t.matchUpStatus);return e||n||!!t.winningSide||!(null==(i=t.score)||!i.scoreStringSide1)}),!1);let O=v.reduce(((e,t)=>e&&[Sc,Pc,Ec,kc,Tc,Uc].includes(t.matchUpStatus)),!!v.length);return E.structureCompleted=O,i[d]=O,E.structureActive&&(N=!0),{...E,participantResults:A,seedAssignments:h,roundMatchUps:w,roundProfile:T,structureId:d}}));return n.forEach((e=>{var t;a||delete e.positionAssignments,e.sourceStructuresComplete=null==(t=e.sourceStructureIds)?void 0:t.every((e=>i[e]))})),n})).flat();return U.drawActive=N,U.participantPlacements=M,U.drawGenerated=null==A?void 0:A.reduce(((e,t)=>e||!(null==t||!t.roundMatchUps)),!1),U.drawCompleted=null==A?void 0:A.reduce(((e,t)=>e&&t.structureCompleted),!0),U.drawPublished=u?R&&HT({publishStatus:b,drawId:U.drawId}):void 0,{structures:!u||U.drawPublished?h&&A||ts(A,!1,!0):void 0,drawInfo:h?U:ts(U,!1,!0),...At}}function JT(e){var t,i,n;let{includePositionAssignments:r,participantsProfile:a,policyDefinitions:o,usePublishState:s,status:l=Kf,contextProfile:u,sortConfig:d}=e,c=qu(e,[{tournamentRecord:!0},{[Bu]:{event:!1,eventId:!1}}]);if(c.error)return c;let p=ts(e.tournamentRecord,!1,!0),m=e.event?void 0:Ch({tournamentRecord:p,eventId:e.eventId}).event,f=e.event?ts(e.event,!1,!0):m&&ts(m,!1,!0)||void 0;if(!f)return{error:Ri};let{eventId:h}=f,{tournamentId:v,endDate:g}=p,I=Lv({event:f,status:l}),U=Vv({event:f}).publishState??{},y=!(null==(t=null==U?void 0:U.status)||!t.published),{participants:S}=zv({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:o,...a,tournamentRecord:p}),w=f.drawDefinitions||[],P=!s||y?w.filter((({drawId:e})=>!s||HT({publishStatus:I,drawId:e}))).map((t=>(({drawInfo:e,structures:t})=>({...e,structures:t}))(KT({allParticipantResults:e.allParticipantResults,hydrateParticipants:e.hydrateParticipants,context:{eventId:h,tournamentId:v,endDate:g},pressureRating:e.pressureRating,refreshResults:e.refreshResults,includePositionAssignments:r,tournamentParticipants:S,noDeepCopy:!0,policyDefinitions:o,tournamentRecord:p,usePublishState:s,contextProfile:u,drawDefinition:t,publishStatus:I,sortConfig:d,event:f})))).map((({structures:e,...t})=>{let i=null==e?void 0:e.filter((({stage:e,structureId:i})=>(({structureId:e,drawId:t})=>{var i,n,r;if(!s)return!0;let a=null==(n=null==(i=null==I?void 0:I.drawDetails)?void 0:i[t])?void 0:n.structureDetails;return!a||!Object.keys(a).length||(null==(r=a[e])?void 0:r.published)})({structureId:i,drawId:t.drawId})&&(({stage:e,drawId:t})=>{var i,n,r;if(!s)return!0;let a=null==(n=null==(i=null==I?void 0:I.drawDetails)?void 0:i[t])?void 0:n.stageDetails;return!a||!Object.keys(a).length||(null==(r=a[e])?void 0:r.published)})({stage:e,drawId:t.drawId}))).map((e=>(({drawId:e,structure:t})=>{var i,n,r,a;if(!s)return t;let o=null==(a=null==(r=null==(n=null==(i=null==I?void 0:I.drawDetails)?void 0:i[e])?void 0:n.structureDetails)?void 0:r[t.structureId])?void 0:a.roundLimit;if(Ye(o)){let e=lt(1,o+1),i={},n={};for(let r of e)t.roundMatchUps[r]&&(i[r]=t.roundMatchUps[r],n[r]=t.roundProfile[r]);t.roundMatchUps=i,t.roundProfile=n}return t})({drawId:t.drawId,structure:e})));return{...t,structures:i}})).filter((e=>{var t;return null==(t=e.structures)?void 0:t.length})):void 0,D=(Array.isArray(p.venues)?p.venues:[]).map((e=>(({venueData:e})=>({...e}))(Ah({venueId:e.venueId,tournamentRecord:p})))),T=(({eventId:e,eventName:t,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:l,endDate:u,ballType:d,discipline:c})=>({eventId:e,eventName:t,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:l,endDate:u,ballType:d,discipline:c}))(f);T.display=null==(i=Cd({element:f,name:Bd}).extension)?void 0:i.value;let{tournamentInfo:b}=wT({tournamentRecord:p}),R={tournamentInfo:b,venuesData:D,eventInfo:T,drawsData:P};return R.eventInfo.publishState=U,R.eventInfo.published=null==(n=null==U?void 0:U.status)?void 0:n.published,{...At,eventData:R,participants:S}}var QT={};function ZT({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:t,timeAfterRecovery:i,matchUp:n}){var r,a,o,s;let{individualParticipantIds:l}=jp(n);i=i??(null==(r=n.schedule)?void 0:r.timeAfterRecovery);let u=t=>{e[t]||(e[t]=[]),e[t]=Qe(e[t].concat(...l))},d=e=>{i&&(!t[e]||i>t[e])&&(t[e]=i)},c=(null==(a=n.winnerTo)?void 0:a.matchUpId)||n.winnerMatchUpId;c&&(i&&d(c),u(c));let p=(null==(o=n.loserTo)?void 0:o.matchUpId)||n.loserMatchUpId;p&&(i&&d(p),u(p)),null!=(s=n.sidesTo)&&s.length&&n.sidesTo.forEach((({matchUpId:e})=>{e&&(i&&d(e),u(e))}))}function XT(e){let t=qu(e,[{[Du]:!0}]);if(t.error)return t;let{matchUpPotentialParticipantIds:i,dateScheduledMatchUpIds:n=[],scheduleCompletedMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:l,matchUps:u}=e,d=o?Object.keys(o):[],c=(s??[]).map((e=>u.find((t=>t.matchUpId===e)))).filter(Boolean).filter((e=>{let t=!l&&(n.includes(e.matchUpId)||d.includes(e.matchUpId)),i=[Sc,Tc,Pc,Uc,Ec,kc,Rc,bc].includes(null==e?void 0:e.matchUpStatus);return r||!t&&!e.winningSide&&!i})),p=i&&a?c.reduce(((e,t)=>{let{drawId:n,tournamentId:r}=t;return e.matchUpMap[r]||(e.matchUpMap[r]={}),e.matchUpMap[r][n]?e.matchUpMap[r][n].push(t):e.matchUpMap[r][n]=[t],ZT({matchUpPotentialParticipantIds:i,matchUpNotBeforeTimes:a,matchUp:t}),e}),{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:c,matchUpMap:p}}function eb({defaultRecoveryMinutes:e=0,defaultAverageMinutes:t,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!co({matchUpFormat:n}))return{error:Li};let u;return Object.keys(i).filter((e=>!o||e===o)).forEach((e=>{var t;if(u)return;let o=i[e],d=l?null==(t=Ch({tournamentRecord:o,eventId:l}))?void 0:t.event:void 0;return u=hh({tournamentRecord:o,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:d}),(null==u?void 0:u.averageMinutes)||(null==u?void 0:u.recoveryMinutes)})),{recoveryMinutes:(null==u?void 0:u.recoveryMinutes)||e,averageMinutes:(null==u?void 0:u.averageMinutes)||t,typeChangeRecoveryMinutes:(null==u?void 0:u.typeChangeRecoveryMinutes)||(null==u?void 0:u.recoveryMinutes)||e}}function tb(e){let t=qu(e,[{[Bu]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[Lu]:ku}]);if(t.error)return t;let{scheduleCompletedMatchUps:i,periodLength:n=30}=e,r=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{};if("object"!=typeof r)return{error:Lt};let a={},o=[],s=e.rounds.toSorted(((e,t)=>(e.sortOrder??0)-(t.sortOrder??0))),l=e.containedStructureIds??Object.assign({},...Object.values(r).map((e=>Vp({tournamentRecord:e}).containedStructures))),u=e.matchUps??tv({nextMatchUps:!0,tournamentRecords:r}).matchUps,d=0,c={},p={},m={};return{scheduledRoundsDetails:s.flatMap((e=>{var t;let s=e.periodLength||n,f=[];null!=l&&l[e.structureId]?f.push(...l[e.structureId]):f.push(e.structureId);let h=u?Vh({tournamentIds:[e.tournamentId],roundNumbers:[e.roundNumber],matchUpIds:e.matchUpIds,eventIds:[e.eventId],drawIds:[e.drawId],processContext:!0,structureIds:f,matchUps:u}).sort(iv):[],{segmentNumber:v,segmentsCount:g}=e.roundSegment||{};if(Ye(v)&&Ve(null==h?void 0:h.length)&&Ve(g)&&v>0&&v<=g&&g<(null==h?void 0:h.length)&&(null==(t=e.matchUpIds)||!t.length)){let e=h.length/g,t=e*(v-1);h=h.slice(t,t+e)}let I=r[e.tournamentId],U=Ch({drawId:e.drawId,tournamentRecord:I}).event,y=[];for(let i of h){let e=i.matchUpFormat;e&&(a[e]||(a[e]=[],a[e].push(i)),y.push(e))}for(let n of y){let{eventType:t,category:a}=U??{},{categoryName:l,ageCategoryCode:u}=a??{},{typeChangeRecoveryMinutes:f,recoveryMinutes:v,averageMinutes:g,error:I}=eb({categoryName:l??u,categoryType:null==a?void 0:a.categoryType,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:r,matchUpFormat:n,eventType:t});if(I)return{error:I,round:e};let y=h.filter((e=>(i||!Vc.includes(e.matchUpStatus))&&e.matchUpStatus!==Sc)).map(vc);return y.forEach((e=>{m[e]={typeChangeRecoveryMinutes:f,recoveryMinutes:v,averageMinutes:g},c[e]=v,p[e]=g})),o.push(...y),d=Math.max(g||0,d),{roundPeriodLength:s,recoveryMinutes:v,averageMinutes:g,matchUpIds:y,hash:`${g}|${s}`}}})),greatestAverageMinutes:d,matchUpFormatCohorts:a,recoveryMinutesMap:c,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,...At}}function ib({schedulingProfile:e,venueIds:t,eventIds:i,drawIds:n}){let r=[];return{updatedSchedulingProfile:null==e?void 0:e.map((e=>{let a=Eo(null==e?void 0:e.scheduleDate);if(!a)return void r.push(`Invalid date: ${null==e?void 0:e.scheduledDate}`);let o=((null==e?void 0:e.venues)||[]).map((e=>{let{rounds:a,venueId:o}=e;if(null==t||!t.includes(o))return void r.push(`Missing venueId: ${o}`);let s=a.filter((e=>{let t=i.includes(e.eventId)&&n.includes(e.drawId);return t||r.push(`Invalid eventId: ${e.eventId} or drawId: ${e.drawId}`),t}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...e,venues:o}})).filter(Boolean),modifications:r.length,issues:r}}function nb({tournamentRecords:e,schedulingProfile:t}){if(!t)return{valid:!0};if(!Array.isArray(t))return{valid:!1,error:Cr};let i,n,{venueIds:r,tournamentsMap:a}=function(e){let t=(null==e?void 0:e.tournamentRecords)&&Object.values(null==e?void 0:e.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=t.reduce(((e,t)=>{let{tournamentIds:n,tournamentMap:r,structureIds:a,venueIds:o,eventIds:s,drawIds:l}=function(e){let{tournamentRecord:t={},tournamentMap:i={},requireCourts:n}=e,r=[],a=[],o=[],s=[],l=((null==t?void 0:t.venues)||[]).map((({venueId:e,courts:t})=>(!n||(null==t?void 0:t.length))&&e)),u=null==t?void 0:t.tournamentId;return u&&(r.push(u),i[u]={},((null==t?void 0:t.events)||[]).forEach((e=>{let t=e.eventId;o.push(t),i[u][t]={},(e.drawDefinitions||[]).forEach((e=>{let n=e.drawId;s.push(n),i[u][t][n]={};let{structures:r}=zc({drawDefinition:e});(r||[]).forEach((e=>{var r;let o=e.structureId,{matchUps:s}=jh({structure:e}),{roundMatchUps:l}=uf({matchUps:s}),d=l&&Object.keys(l).map((e=>parseInt(e)));i[u][t][n][o]=d,a.push(o),null!=(r=e.structures)&&r.length&&e.structures.forEach((e=>{a.push(e.structureId),i[u][t][n][e.structureId]=d}))}))}))}))),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}({tournamentRecord:t});return o.forEach((t=>{e.venueIds.includes(t)||e.venueIds.push(t)})),e.tournamentIds.push(...n),e.structureIds.push(...a),e.eventIds.push(...s),e.drawIds.push(...l),Object.assign(i,r),e}),{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:n,eventIds:r,drawIds:a}}({tournamentRecords:e}),o=t.every((e=>{let{scheduleDate:t,venues:o}=e;return!!Uo(t)&&o.every((e=>{let{venueId:t,rounds:o}=e;return"string"!=typeof t?(n="venueId should be a string",!1):Array.isArray(o)?r.includes(t)?!!o.every((e=>{var t,i,r,o;if(!e)return n="empty round",!1;let{roundSegment:s,tournamentId:l,structureId:u,roundNumber:d,eventId:c,drawId:p}=e,m=null==(o=null==(r=null==(i=null==(t=null==a?void 0:a[l])?void 0:t[c])?void 0:i[p])?void 0:r[u])?void 0:o.includes(d);m||(n="Invalid rounds");let{segmentNumber:f,segmentsCount:h}=s||{},v=!s||Ye(f)&&Ve(h)&&f<=h;return v||(n="Invalid segment"),m&&v})):(i=ur,!1):(n="rounds should be an array",!1)}))}));return!o&&!i&&(i=Cr),{valid:!!o,error:i,info:n}}function rb({tournamentRecords:e,tournamentRecord:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Lt};let{extension:i}=Cd({element:t,name:Xd,tournamentRecords:e,discover:!0}),n=(null==i?void 0:i.value)||[];if(n.length){let{venueIds:i}=qT({requireCourts:!0,tournamentRecords:e}),{eventIds:r,drawIds:a}=Qy({tournamentRecords:e}),{updatedSchedulingProfile:o,modifications:s,issues:l}=ib({schedulingProfile:n,venueIds:i,eventIds:r,drawIds:a});if(s){n=o;let i=ab({tournamentRecords:e,tournamentRecord:t,schedulingProfile:n});return i.error?i:{schedulingProfile:n,modifications:s,issues:l}}}return{schedulingProfile:n,modifications:0}}function ab({tournamentRecords:e,tournamentRecord:t,schedulingProfile:i}){let n=nb({tournamentRecords:e,schedulingProfile:i});return n.error?n:i?Sd({tournamentRecords:e,discover:!0,extension:{name:Xd,value:i}}):Ud({element:t,name:Xd,tournamentRecords:e,discover:!0})}function ob(e){let{tournamentRecord:t}=e,i=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!e.schedulingProfile){let{modifications:e,issues:n}=rb({tournamentRecords:i,tournamentRecord:t});return{success:!e,modifications:e,issues:n}}let{venueIds:n}=qT({tournamentRecords:i}),{eventIds:r,drawIds:a}=Qy({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=ib({schedulingProfile:e.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return s?{...ab({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...At,modifications:s,issues:l}}function sb(e){let{scheduleDates:t=[],tournamentRecords:i,periodLength:n=30}=e??{};if("object"!=typeof i)return{error:Vt};if(!Array.isArray(t))return{error:Cr};if(!t.every(Uo))return{error:vn};let r=[],a=0,o={},{schedulingProfile:s}=rb({tournamentRecords:i});if(!s)return{issues:r,...At};let{matchUps:l}=tv({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:e,venues:s=[]}=u;if(null==t||!t.length||t.includes(e))for(let t of s||[])if(t){let{rounds:s}=t,u=[],{orderedMatchUpIds:d,scheduledRoundsDetails:c}=tb({tournamentRecords:i,periodLength:n,matchUps:l,rounds:s}),{matchUpDependencies:p}=uv({tournamentRecords:i,matchUps:l}),m=e=>{let t;return null==c||c.find(((i,n)=>{let r=i.matchUpIds.includes(e);return r&&(t=n),r})),t};if(null==d||d.forEach(((e,t)=>{var i;let n=dt(d.slice(t+1),(null==(i=null==p?void 0:p[e])?void 0:i.matchUpIds)||[]);n.length&&u.push({matchUpId:e,shouldBeAfter:n})})),u.length){a+=u.length;let t=u.map((({matchUpId:t,shouldBeAfter:i})=>{let n=m(t),r=Qe(i.map(m));return o[e]||(o[e]={}),o[e][n]||(o[e][n]=[]),r.forEach((t=>{o[e][n].includes(t)||o[e][n].push(t)})),{matchUpId:t,matchUpRoundIndex:n,earlierRoundIndices:r,shouldBeAfter:i}}));r.push(...t)}}}return{issuesCount:a,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...r.map((e=>{let{matchUpId:t,shouldBeAfter:i,earlierRoundIndices:n}=e;return{[t]:{earlierRoundIndices:n,shouldBeAfter:i}}})))},roundIndexShouldBeAfter:o,...At}}function lb(e){let{tournamentRecords:t,requestType:i}=e,n=qu(e,[{[nu]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(t)){let{extension:e}=Cd({element:a,name:Yd}),t=(null==e?void 0:e.value)||[];for(let n of t){let{personId:e,requests:t}=n||{};r[e]||(r[e]=[]);for(let n of t)i&&n.requestType!==i||r[e].push(n)}}return{personRequests:r,...At}}function ub(e){let{containerStructureId:t,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:o,eventId:s,drawId:l}=e,u=n?t:o,d=[r,s,l,u,a].join("|");return _a({structureId:u,roundSegment:i,tournamentId:r,roundNumber:a,eventId:s,drawId:l,id:d})}function db({round:e,matchUps:t,events:i,tournamentRecords:n}){let r=i.find((t=>t.eventId===e.eventId)),{eventType:a,category:o,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:u}=o||{},d=tt(t.map((({matchUpFormat:e})=>e))),c=0;return Object.keys(d).forEach((t=>{let i=d[t],r=eb({categoryName:l||u,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:n,matchUpFormat:t,categoryType:s,eventType:a});if(r.error)return r;let o=r.averageMinutes*i;isNaN(c)||(c+=o)})),{roundMinutes:c}}function cb(e){let t=e.length,i=e.filter((({sides:e})=>null==e?void 0:e.some((({bye:e})=>e)))).length||0,n=e.filter((({winningSide:e,matchUpStatus:t})=>e||Vc.includes(t))).length||0,r=e.filter((({schedule:e,matchUpStatus:t})=>(null==e?void 0:e.scheduledDate)&&(null==e?void 0:e.scheduledTime)&&t!==Sc)).length||0,a=t-i;return{unscheduledCount:a-r,incompleteCount:a-r,scheduledCount:r,completedCount:n,matchUpsCount:t,isScheduled:a===r,isComplete:a===n,byeCount:i}}function pb({tournamentRecords:e,schedulingProfile:t,tournamentRecord:i,withRoundId:n}){if(i&&!e){if("object"!=typeof i)return{error:Vt};e={[i.tournamentId]:i}}if(t){let i=nb({tournamentRecords:e,schedulingProfile:t});if(i.error)return i}if(!t&&e){let i=rb({tournamentRecords:e});if(i.error)return i;t=i.schedulingProfile}if(!t)return{error:Lr};let r={};return{profileRounds:t.map((({venues:e,scheduleDate:t})=>e.map((({rounds:e})=>e.map((e=>{var i;let a=ub(e);return null!=(i=a.roundSegment)&&i.segmentsCount&&(r[a.id]=a.roundSegment.segmentsCount),_a({id:n?a.id:void 0,scheduleDate:t,...a})})))))).flat(1/0),segmentedRounds:r}}function mb({courtPrefix:e="C|",minRowsCount:t,courtsData:i}){if(!Array.isArray(i))return{error:Cr};let n=null==i?void 0:i.reduce(((e,t)=>{let i=t.matchUps||[],n=Math.max(0,...i.map((e=>e.schedule.courtOrder||0)));return n>e?n:e}),1),r=lt(0,t?Math.max(t,n):n).map((e=>({matchUps:lt(0,i.length).map((t=>{let n=i[t],{courtId:r,venueId:a}=n;return{schedule:{courtOrder:e+1,venueId:a,courtId:r}}}))})));return i.forEach(((e,t)=>{var i;for(let n of e.matchUps){let e=null==(i=n.schedule)?void 0:i.courtOrder;e&&(r[e-1].matchUps[t]=n)}})),{courtPrefix:e,rows:r.map(((t,i)=>Object.assign({rowId:`rowId-${i+1}`},...t.matchUps.map(((t,i)=>({[`${e}${i}`]:t}))))))}}be(QT,{courtGridRows:()=>mb,findVenue:()=>Th,getMatchUpsToSchedule:()=>XT,getPersonRequests:()=>lb,getProfileRounds:()=>pb,getScheduledRoundsDetails:()=>tb,getSchedulingProfile:()=>rb,getSchedulingProfileIssues:()=>sb,publicFindCourt:()=>Nh});var fb={};function hb({policyDefinitions:e,drawDefinition:t,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:bi};let{entries:o,stageEntries:s}=Ig({drawDefinition:t,drawId:n,stage:a,event:r}),l=s.length,{drawSize:u}=mw({participantsCount:l}),d=fw({drawSize:i??u,participantsCount:l,policyDefinitions:e});if(d.error)return La({result:d,stack:"getEntriesAndSeedsCount"});let{seedsCount:c}=d;return{entries:o,seedsCount:c,stageEntries:s}}function vb(e){let{entries:t=[],entryStatus:i,stage:n}=e;return Math.max(...t.filter((e=>!(n&&n!==e.entryStage||i&&e.entryStatus!==i||isNaN(e.entryPosition)))).map((({entryPosition:e})=>Be(e||0))),0)}be(fb,{getEntriesAndSeedsCount:()=>hb,getMaxEntryPosition:()=>vb});var gb={};function Ib({tournamentRecords:e,extensionName:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Lt};let i,n=[];for(let r of Object.values(e)){let{extension:e}=Cd({element:r,name:t});e&&!i&&(n.push({params:{extension:e,discover:!0},method:"addExtension"}),i=!0);let a=r.events??[];for(let i of a){let{eventId:e}=i,{extension:r}=Cd({name:t,element:i});r&&n.push({params:{eventId:e,extension:r},method:"addEventExtension"})}}return{methods:n}}function Ub({tournamentRecords:e}){return Ib({extensionName:Zd,tournamentRecords:e})}be(gb,{allCompetitionMatchUps:()=>tv,allDrawMatchUps:()=>nv,allEventMatchUps:()=>Xh,allTournamentMatchUps:()=>ev,analyzeMatchUp:()=>Kb,calculateWinCriteria:()=>Bb,checkMatchUpIsComplete:()=>Gh,competitionScheduleMatchUps:()=>kb,drawMatchUps:()=>Jb,eventMatchUps:()=>Eb,filterMatchUps:()=>Vh,getAllDrawMatchUps:()=>Qh,getAllStructureMatchUps:()=>jh,getCheckedInParticipantIds:()=>Zf,getCompetitionMatchUps:()=>Ob,getEventMatchUpFormatTiming:()=>Tb,getHomeParticipantId:()=>Vb,getMatchUpCompetitiveProfile:()=>Sf,getMatchUpContextIds:()=>jb,getMatchUpDailyLimits:()=>Fb,getMatchUpDailyLimitsUpdate:()=>Rb,getMatchUpDependencies:()=>uv,getMatchUpFormat:()=>qb,getMatchUpFormatTiming:()=>hh,getMatchUpFormatTimingUpdate:()=>Ub,getMatchUpScheduleDetails:()=>Oh,getMatchUpType:()=>_h,getMatchUpsStats:()=>Wb,getModifiedMatchUpFormatTiming:()=>bb,getParticipantResults:()=>wy,getPredictiveAccuracy:()=>xb,getRoundMatchUps:()=>uf,getRounds:()=>Yb,isValidMatchUpFormat:()=>co,matchUpActions:()=>ow,participantScheduledMatchUps:()=>Mb,tallyParticipantResults:()=>xy,tournamentMatchUps:()=>Cb,validMatchUp:()=>sf,validMatchUps:()=>lf});var yb="ADULT",Sb="JUNIOR",wb="WHEELCHAIR",Pb={[ud]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Oe]:30,default:60}}]},defaultDailyLimits:{[Ee]:2,[Oe]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[hs],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[wb],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[yb,wb],minutes:{default:60,[Oe]:30}},{categoryTypes:[Sb],minutes:{default:60,[Oe]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[yb,wb],minutes:{default:30}},{categoryTypes:[Sb],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[yb,Sb],minutes:{default:30}},{categoryTypes:[wb],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},Db=Pb;function Tb({tournamentRecord:e,matchUpFormats:t,categoryType:i,event:n}){if(!n)return{error:bi};let r,a=[];if(null!=t&&t.length){let e=[];a=t.map((t=>{let i="string"==typeof t?{matchUpFormat:t}:t;if(!e.includes(null==i?void 0:i.matchUpFormat)&&co({matchUpFormat:null==i?void 0:i.matchUpFormat}))return e.push(i.matchUpFormat),i})).filter(Boolean)}else{let{policy:t}=Rm({policyType:cd,tournamentRecord:e,event:n});if(null!=t&&t.matchUpFormats)a=null==t?void 0:t.matchUpFormats;else{let e,t,{extension:i}=Cd({name:Zd,element:n});null!=i&&i.value?({matchUpAverageTimes:e,matchUpRecoveryTimes:t}=i.value):({matchUpAverageTimes:e,matchUpRecoveryTimes:t}=Db[ud]),a=Qe([...(e||[]).map((e=>e.matchUpFormatCodes)),...(t||[]).map((e=>e.matchUpFormatCodes))].flat()).map((e=>({matchUpFormat:e}))),r="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=n,u=(null==l?void 0:l.categoryName)??(null==l?void 0:l.ageCategoryCode)??s;return s?_a({eventMatchUpFormatTiming:a.map((({matchUpFormat:t,description:r})=>({matchUpFormat:t,description:r,...hh({tournamentRecord:e,matchUpFormat:t,categoryName:u,categoryType:i,eventType:o,event:n})}))),info:r}):{error:bi}}function bb(e){let t=qu(e,[{[au]:!0},{[Fu]:e=>co({matchUpFormat:e}),[_u]:Li,[uu]:!0}]);if(t.error)return t;let{tournamentRecord:i,matchUpFormat:n,event:r}=e,{extension:a}=Cd({name:Zd,element:r}),o=null==a?void 0:a.value,{extension:s}=Cd({element:i,name:Zd}),l=null==s?void 0:s.value,u=[(null==o?void 0:o.matchUpAverageTimes)&&eh({...o,matchUpFormat:n}),(null==l?void 0:l.matchUpAverageTimes)&&eh({...l,matchUpFormat:n})].find((e=>e));return{matchUpFormat:n,recoveryTimes:[(null==o?void 0:o.matchUpRecoveryTimes)&&th({...o,matchUpFormat:n}),(null==l?void 0:l.matchUpRecoveryTimes)&&th({...l,matchUpFormat:n})].find((e=>e)),averageTimes:u}}function Rb({tournamentRecords:e}){return Ib({extensionName:Qd,tournamentRecords:e})}var Nb=({scheduleAttributes:e=["scheduledDate","scheduledTime"],schedule:t={}})=>!!Object.keys(t).filter((t=>e.includes(t))).filter((e=>t[e])).length;function Mb({scheduleAttributes:e=["scheduledDate","scheduledTime"],matchUps:t=[]}){if(!lf(t))return{error:Ki};if(!Array.isArray(e))return{error:Cr};let i=t.filter(Boolean).filter((({schedule:t})=>Nb({schedule:t,scheduleAttributes:e}))).reduce(((e,t)=>{let{schedule:i}=t,n=Eo(null==i?void 0:i.scheduledDate),r=Ao(null==i?void 0:i.scheduledTime);return n&&r&&(e[n]?e[n].push(t):e[n]=[t]),e}),{});return Object.keys(i).forEach((e=>{i[e].sort(((e,t)=>{var i,n;return Fo(Ao(null==(i=e.schedule)?void 0:i.scheduledTime),Ao(null==(n=t.schedule)?void 0:n.scheduledTime))}))})),{...At,scheduledMatchUps:i}}function Ab({schedulingProfile:e,matchUps:t=[]}){let i={},n=({eventId:e,drawId:t,structureId:i,roundNumber:n})=>`${e}|${t}|${i}${n}`;null!=e&&e.length&&e.map((({venues:e})=>e.map((({rounds:e})=>e)))).flat().forEach((e=>{e.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))).forEach((({eventId:e,drawId:t,structureId:r,roundNumber:a},o)=>{let s=n({eventId:e,drawId:t,structureId:r,roundNumber:a});i[s]=o}))}));let r=[],a={noScheduledDate:[]};for(let s of t){let e=s.schedule||{},t=e.scheduledDate&&Eo(e.scheduledDate)||e.scheduledTime&&Eo(e.scheduledTime)||"noScheduledDate";a[t]||(a[t]=[]),a[t].push(s)}let o=Object.keys(a).sort();for(let s of o){let e=a[s],t={noScheduledTime:[]};for(let i of e){let e=i.schedule||{},n=e.scheduledTime&&Ao(e.scheduledTime)||"noScheduledTime";t[n]||(t[n]=[]),t[n].push(i)}let o=Object.keys(t).sort();for(let a of o){let e=t[a];e.sort(((e,t)=>(i[n(e)]||0)-(i[n(t)]||0))),r.push(...e)}}return r}function Eb(e){let{participants:t,contextContent:i,participantMap:n}=e,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:d,usePublishState:c,contextFilters:p,matchUpFilters:m,contextProfile:f,nextMatchUps:h,tournamentId:v,inContext:g,context:I,event:U}=e;if(!U)return{error:bi};let y,{eventId:S,eventName:w,endDate:P,eventType:D,category:T,gender:b}=U??{},R={...I,..._a({surfaceCategory:U.surfaceCategory??(null==d?void 0:d.surfaceCategory),indoorOutDoor:U.indoorOutdoor??(null==d?void 0:d.indoorOutdoor),tournamentId:v??(null==d?void 0:d.tournamentId),endDate:P??(null==d?void 0:d.endDate),eventName:w,eventType:D,category:T,eventId:S,gender:b})};!t&&d&&({participants:t,participantMap:n,groupInfo:y}=vm({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:d,contextProfile:f,inContext:g})),f&&!i&&(i=bm({policyDefinitions:l,tournamentRecord:d,contextProfile:f,event:U}));let N=Lv({event:U});return{...(U.drawDefinitions??[]).reduce(((u,v)=>{var I;let y=Zh({hydrateParticipants:e.hydrateParticipants,context:R,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:t,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:d,usePublishState:c,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:n,publishStatus:N,contextProfile:f,drawDefinition:v,nextMatchUps:h,inContext:g,event:U});return null==(I=Object.keys(y))||I.forEach((e=>{Array.isArray(y[e])&&(u[e]||(u[e]=[]),u[e]=u[e].concat(y[e]))})),u}),{}),...At,groupInfo:y}}function Cb(e){if(null==e||!e.tournamentRecord)return{error:Bt};let t=e.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,contextFilters:u,matchUpFilters:d,contextProfile:c,nextMatchUps:p,context:m}=e,f=e.tournamentId??o.tournamentId,h=(null==o?void 0:o.events)??[],{participants:v,participantMap:g,groupInfo:I}=vm({participantsProfile:n,policyDefinitions:a,tournamentRecord:o,contextProfile:c,inContext:s});c&&!t&&(t=bm({policyDefinitions:a,tournamentRecord:o,contextProfile:c}));let{appliedPolicies:U}=gm({tournamentRecord:o}),y=(null==u?void 0:u.eventIds)??[];return{...h.filter((e=>!y.includes(e.eventId))).map((h=>{var I,y,S;let w={eventDrawsCount:(null==(y=null==(I=Eh({event:h}).flightProfile)?void 0:I.flights)?void 0:y.length)||(null==(S=h.drawDefinitions)?void 0:S.length)||0,...m};return Eb({hydrateParticipants:e.hydrateParticipants,context:w,tournamentAppliedPolicies:U,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:l,contextFilters:u,contextProfile:c,contextContent:t,matchUpFilters:d,participantMap:g,participants:v,tournamentId:f,nextMatchUps:p,inContext:s,event:h})})).reduce(((e,t)=>{var i;return null==(i=t&&Object.keys(t).filter((e=>!["success","matchUpsMap"].includes(e))))||i.forEach((i=>{Array.isArray(t[i])&&(e[i]||(e[i]=[]),e[i]=e[i].concat(t[i]),void 0!==e.matchUpsCount?e.matchUpsCount+=t[i].length:e.matchUpsCount=t[i].length)})),e}),{matchUpsCount:0}),groupInfo:I,participants:v}}function Ob({scheduleVisibilityFilters:e,hydrateParticipants:t,participantsProfile:i,tournamentRecords:n,useParticipantMap:r,policyDefinitions:a,usePublishState:o,matchUpFilters:s,contextFilters:l,nextMatchUps:u,inContext:d}){if("object"!=typeof n||!Object.keys(n).length)return{error:Lt};let c=Object.keys(n).map((c=>{let p=n[c];return Cb({scheduleVisibilityFilters:e,hydrateParticipants:t,participantsProfile:i,useParticipantMap:r,policyDefinitions:a,tournamentRecord:p,usePublishState:o,matchUpFilters:s,contextFilters:l,nextMatchUps:u,inContext:d})})),p={},m={};return{...c.reduce(((e,t)=>(Object.keys(t).forEach((i=>{if("groupInfo"===i)Object.assign(m,t[i]);else if("participants"===i)for(let e of t[i]??[])p[e.participantId]=e;else Array.isArray(t[i])&&(e[i]||(e[i]=[]),e[i]=e[i].concat(t[i]))})),e)),{}),groupInfo:m,mappedParticipants:p}}function kb(e){var t,i,n,r,a,o,s;if("object"!=typeof(null==e?void 0:e.tournamentRecords)||!Object.keys(null==e?void 0:e.tournamentRecords).length)return{error:Lt};let l,u,{courts:d,venues:c}=$T(e),p=rb(e).schedulingProfile,{sortDateMatchUps:m=!0,courtCompletedMatchUps:f,alwaysReturnCompleted:h,activeTournamentId:v,tournamentRecords:g,withCourtGridRows:I,minCourtGridRows:U,usePublishState:y,status:S=Kf,sortCourtsData:w}=e,P=v??ba()??Object.keys(g)[0],D=y?_v({tournamentRecord:g[P],status:S}):void 0,T=h?Ob({...e,matchUpFilters:{...e.matchUpFilters,matchUpStatuses:[Pc]},contextFilters:e.contextFilters}).completedMatchUps:[];if(y&&(null==(t=null==D?void 0:D.orderOfPlay)||!t.published))return{completedMatchUps:T,dateMatchUps:[],courtsData:[],venues:c};y&&({drawIds:l,detailsMap:u}=function({tournamentRecords:e}){var t;let i={},n=[];for(let r of Object.values(e))for(let e of r.events??[]){let r=Lv({event:e}),a=null==r?void 0:r.drawDetails;wt(a)?(Object.assign(i,a),n.push(...Object.keys(a).filter((e=>Bv({drawId:e,drawDetails:a}))))):null!=(t=null==r?void 0:r.drawIds)&&t.length&&n.push(...r.drawIds)}return{drawIds:n,detailsMap:i}}({tournamentRecords:g})),null!=l&&l.length&&(e.contextFilters||(e.contextFilters={}),null!=(i=e.contextFilters)&&i.drawIds?e.contextFilters.drawIds=e.contextFilters.drawIds.filter((e=>l.includes(e))):e.contextFilters.drawIds=l),null!=(n=null==D?void 0:D.eventIds)&&n.length&&(e.matchUpFilters||(e.matchUpFilters={}),null!=(r=e.matchUpFilters)&&r.eventIds&&e.matchUpFilters.eventIds.length?e.matchUpFilters.eventIds=e.matchUpFilters.eventIds.filter((e=>D.eventIds.includes(e))):e.matchUpFilters.eventIds=D.eventIds),null!=(a=null==D?void 0:D.scheduledDates)&&a.length&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters.scheduledDates&&e.matchUpFilters.scheduledDates.length?e.matchUpFilters.scheduledDates=e.matchUpFilters.scheduledDates.filter((e=>D.scheduledDates.includes(e))):e.matchUpFilters.scheduledDates=D.scheduledDates),h&&(e.matchUpFilters||(e.matchUpFilters={}),null!=(s=null==(o=e.matchUpFilters)?void 0:o.excludeMatchUpStatuses)&&s.length?e.matchUpFilters.excludeMatchUpStatuses.includes(Pc)||e.matchUpFilters.excludeMatchUpStatuses.push(Pc):e.matchUpFilters.excludeMatchUpStatuses=[Pc]);let{completedMatchUps:b,upcomingMatchUps:R,pendingMatchUps:N,groupInfo:M,mappedParticipants:A}=Ob({...e,matchUpFilters:e.matchUpFilters,contextFilters:e.contextFilters}),E=[...R??[],...N??[]];u&&(null==l||!l.length||Object.keys(u).length)&&(E=E.filter((e=>{var t,i;let{drawId:n,structureId:r,stage:a}=e;if(null==(i=null==(t=null==u?void 0:u[n])?void 0:t.publishingDetail)||!i.published)return!1;if(u[n].stageDetails){let e=Object.keys(u[n].stageDetails),t=e.filter((e=>!u[n].stageDetails[e].published)),i=e.filter((e=>u[n].stageDetails[e].published));return(!t.length||!t.includes(a))&&(!(!i.length||!i.includes(a))||t.length&&!t.includes(a)&&!i.length)}if(u[n].structureDetails){let e=Object.keys(u[n].structureDetails),t=e.filter((e=>!u[n].structureDetails[e].published)),i=e.filter((e=>u[n].structureDetails[e].published));return(!t.length||!t.includes(r))&&(!(!i.length||!i.includes(r))||t.length&&!t.includes(r)&&!i.length)}return!0})));let C=m?Ab({matchUps:E,schedulingProfile:p}):E,O=null==d?void 0:d.map((e=>{let t=function({courtId:e}){let t=(f?C.concat(b??[]):C).filter((t=>{var i,n,r;return(null==(i=t.schedule)?void 0:i.courtId)===e||(null==(r=null==(n=t.schedule)?void 0:n.allocatedCourts)?void 0:r.map((({courtId:e})=>e)).includes(e))}));return w?Ab({matchUps:t,schedulingProfile:p}):t}(e);return{surfaceCategory:(null==e?void 0:e.surfaceCategory)??"",matchUps:t,...e}})),k={completedMatchUps:h?T:b,mappedParticipants:e.hydrateParticipants?void 0:A,dateMatchUps:C,courtsData:O,groupInfo:M,venues:c};if(I){let{rows:e,courtPrefix:t}=mb({minRowsCount:U,courtsData:O});k.courtPrefix=t,k.rows=e}return{...k,...At}}function Fb({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Lt};let i;return Object.keys(e).filter((e=>!t||e===t)).forEach((t=>{let n=e[t],{matchUpDailyLimits:r}=function(e){var t;let i=qu(e,[{[au]:!0}]);if(i.error)return i;let{tournamentRecord:n}=e,{policy:r}=Rm({policyType:ud,tournamentRecord:n}),{extension:a}=Cd({element:n,name:Qd}),o=null==(t=null==a?void 0:a.value)?void 0:t.dailyLimits,s=null==r?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:o||s}}({tournamentRecord:n});i=r})),{matchUpDailyLimits:i}}function xb(e){var t,i,n,r;let{matchUps:a}=e,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:u,exclusionRule:d,zoneDoubling:c,matchUpType:p,scaleName:m,eventId:f,zonePct:h,drawId:v,event:g}=e;if(!s&&!a)return{error:Bt};if(p&&![Ee,Oe].includes(p))return{error:Cr,info:{matchUpType:p}};if(a&&!lf(a))return{error:Cr,context:{matchUps:a}};let I=py[m],U=(null==I?void 0:I.ascending)??e.ascending??!1,y=(null==I?void 0:I.accessor)??e.valueAccessor,S=Array.isArray(null==I?void 0:I.range)?Math.abs(I.range[0]-I.range[1]):0,w=Ye(h)&&S?(h??0)*S:e.zoneMargin??S,P={withScaleValues:!0,withCompetitiveness:!0},D={matchUpTypes:p?[p]:[Ee,Oe]},T=null==s?void 0:s.participants;null!=(t=null==a?void 0:a[0])&&t.hasContext?v?a=a.filter((e=>e.drawId===v)):f&&(a=a.filter((e=>e.eventId===f))):void 0===a&&(a=v&&!l&&[]||!v&&f&&!g&&[]||v&&(null==(i=nv({inContext:!0,drawDefinition:l,contextFilters:D,contextProfile:P,participants:T}))?void 0:i.matchUps)||!v&&f&&(null==(n=Xh({inContext:!0,contextFilters:D,contextProfile:P,participants:T,event:g}))?void 0:n.matchUps)||(null==(r=ev({tournamentRecord:s,contextFilters:D,contextProfile:P}))?void 0:r.matchUps)||[]),p&&(a=a.filter((e=>e.matchUpType===p)));let b=a.filter((({winningSide:e,score:t,sides:i,matchUpStatus:n})=>![Ec,Tc,kc,Dc,Uc].includes(n??"")&&dv({score:t})&&2===(null==i?void 0:i.length)&&e)),R=function({excludeMargin:e,exclusionRule:t,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:a,sides:s,score:l,winningSide:d}=u;if(!d)continue;if(t&&(!t.valueAccessor||!t.range))return{info:"exclusionRule requires valueAccessor and range",error:un};let c=d-1,p=_b({exclusionRule:t,valueAccessor:i,matchUpType:a,scaleName:r,sides:s});if(t){let e=p.map((({exclusionValues:e})=>e)).flat();if(e.length){o.excluded.push({scoreString:null==l?void 0:l.scoreStringSide1,exclusionValues:e,winningSide:d,sideValues:p});continue}}if(p.filter((e=>![void 0,"",null].includes(e.value))).length<2){o.excluded.push({scoreString:null==l?void 0:l.scoreStringSide1,missingValues:!0,winningSide:d,sideValues:p});continue}let m=p[c].value-p[1-c].value,f=parseFloat(e||0),h=f&&Math.abs(m)<f;if(h){o.excluded.push({scoreString:null==l?void 0:l.scoreStringSide1,excludeMargin:e,winningSide:d,excludeGap:h,sideValues:p,valuesGap:m});continue}let v=n?m:-1*m,g=1===d?null==l?void 0:l.scoreStringSide1:null==l?void 0:l.scoreStringSide2;v>0?o.affirmative.push({winningScoreString:g,winningSide:d,sideValues:p,valuesGap:m,score:l}):o.negative.push({winningScoreString:g,winningSide:d,sideValues:p,valuesGap:m,score:l})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}({matchUps:b,excludeMargin:u,exclusionRule:d,valueAccessor:y,ascending:U,scaleName:m}),N=!c||Xf(Ee)(p)?w:2*(w||0),M=w?b.map((({competitiveProfile:e,matchUpType:t,score:i,sides:n})=>{let r=_b({singlesForDoubles:o,valueAccessor:y,matchUpType:t,scaleName:m,sides:n}),a=Math.abs(r[0].value-r[1].value);return{competitiveness:null==e?void 0:e.competitiveness,valuesGap:a,score:i}})).filter((({valuesGap:e})=>e<=N)):[],A=function({zoneData:e}){let t={[Sm]:[],[wm]:[],[Pm]:[]};for(let i of e){let{competitiveness:e,score:n,valuesGap:r}=i;t[e]&&t[e].push({score:n,valuesGap:r})}return t}({zoneData:M}),E=A&&[].concat(Object.values(A)).flat().length,C=E&&Object.assign({},...Object.keys(A).map((e=>({[e]:Math.round(1e4*A[e].length/E)/100})))),O=b.length-((null==M?void 0:M.length)||0);return{...At,relevantMatchUps:b,zoneDistribution:C,zoneData:M,accuracy:R,nonZone:O}}function _b({singlesForDoubles:e,exclusionRule:t,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let o=null==t?void 0:t.range.sort(),s=e=>{let i=null==e?void 0:e[null==t?void 0:t.valueAccessor];return{exclude:t&&i>=o[0]&&i<=o[1],exclusionValue:i}};return a.sort(((e,t)=>e.sideNumber-t.sideNumber)).map((({participant:t})=>{let a=[],o=null==t?void 0:t.individualParticipants;if(null!=o&&o.length){let l=[],u=0;for(let t of o){let{scaleValue:o,value:d}=Lb({singlesForDoubles:e,valueAccessor:i,participant:t,matchUpType:n,scaleName:r}),{exclude:c,exclusionValue:p}=s(o);c&&a.push(p),l.push(o),d&&!isNaN(u)?u+=d:u=void 0}return{participantName:t.participantName,exclusionValues:a,scaleValues:l,value:u}}if(t){let{scaleValue:o,value:l}=Lb({singlesForDoubles:e,valueAccessor:i,matchUpType:n,participant:t,scaleName:r}),{exclude:u,exclusionValue:d}=s(o);return u&&a.push(d),{participantName:t.participantName,exclusionValues:a,scaleValue:o,value:l}}return{}}))}function Lb({singlesForDoubles:e,valueAccessor:t,matchUpType:i,participant:n,scaleName:r}){var a,o,s,l,u;let d=e?Ee:i,c=null==(o=null==(a=null==n?void 0:n.rankings)?void 0:a[d])?void 0:o.find((e=>e.scaleName===r)),p=null==(u=(null==(l=null==(s=null==n?void 0:n.ratings)?void 0:s[d])?void 0:l.find((e=>e.scaleName===r)))||c)?void 0:u.scaleValue;return{scaleValue:p,value:t?null==p?void 0:p[t]:p}}function Bb({collectionDefinitions:e=[],collectionGroups:t=[]}){let i,n=0,{groupValueNumbers:r}=Hy({collectionGroups:t});for(let a of e||[]){let{collectionValueProfiles:e,collectionGroupNumber:t,collectionValue:o,matchUpCount:s,matchUpValue:l,scoreValue:u,setValue:d}=a,c=t&&r.includes(t);if(Ye(d||u))i=!0;else{if(c)continue;if("number"==typeof o&&Ye(o))n+=o;else if(Array.isArray(e)&&null!=e&&e.length)for(let t of e)n+=t.matchUpValue;else"number"==typeof l&&Ye(l)&&(n+=(s??0)*l)}}for(let a of t)n+=a.groupValue??0;return i||!n?{aggregateValue:!0,...At}:{valueGoal:Math.floor(n/2)+1,...At}}function Vb(e){let{timeStamp:t,schedule:i,matchUp:n}=e,r=qu(e,[{[Ru]:!0}]);if(r.error)return r;let{itemValue:a,timeStamp:o}=Ih({timeItems:(null==n?void 0:n.timeItems)||[],itemType:Af});return!i||o&&t&&new Date(o).getTime()>new Date(t).getTime()?{homeParticipantId:a}:i}function jb({matchUps:e,matchUpId:t}){if(!lf(e))return{error:Cr};let i=e.find((e=>e.matchUpId===t)),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:t,drawId:n,eventId:r,structureId:a,tournamentId:o}}function Gb(e,t){if(!wt(e))return{error:Cr};if(!Array.isArray(t))return{error:Cr};let i={};for(let{param:n,error:r,attr:a}of t){let t=$b({params:e,param:n,attr:a,error:r});if(null!=t&&t.error)return t;i[n]=t}return i}function $b({params:e,param:t,attr:i,error:n}){if(t===Su&&wt(e.drawDefinition)&&St(e.structureId)){let t=(e.drawDefinition.structures??[]).find((({structureId:t})=>t===e.structureId));return!t.length&&n?{error:n}:{structure:t}}if(t===Ru){let t=_T({...e,...i});return t.error&&n?{...t,error:n}:t}return{error:Lr,info:{param:t}}}function qb(e){var t,i;let{structureId:n,matchUpId:r,event:a}=e,o=e.drawDefinition,s=qu(e,[{[au]:!0},{[Bu]:{[pu]:!1,[Iu]:!1,[Nu]:!1,[Au]:!1}}]);if(s[Mu])return s;let l=null==(t=Gb(e,[{[Eu]:Ru,[Mu]:un}]))?void 0:t.matchUp;if(r&&null!=l&&l.error)return l;!o&&null!=l&&l.drawDefinition&&(o=null==l?void 0:l.drawDefinition);let u=null==l?void 0:l.structure;if(!u&&n&&!r){if(!o)return{error:li};let e=Hc({drawDefinition:o,structureId:n});if(e.error)return e;u=e.structure}let d=null==u?void 0:u.matchUpFormat,c=null==o?void 0:o.matchUpFormat,p=null==a?void 0:a.matchUpFormat;return{structureDefaultMatchUpFormat:d,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:c,matchUpFormat:(null==(i=null==l?void 0:l.matchUp)?void 0:i.matchUpFormat)||d||c||p}}function Wb({profileBands:e,tournamentRecord:t,matchUps:i}){if(!lf(i))return{error:Ki};let n=!e&&Rm({policyType:td,tournamentRecord:t}).policy,r=e||(null==n?void 0:n.profileBands)||Tm[td].profileBands,a=i.filter((({winningSide:e})=>e)),o=a.map(If),s=yf(o).reduce(((e,t)=>((e,t)=>(e[gf(t,r)]+=1,e))(e,t)),{[Sm]:0,[wm]:0,[Pm]:0,[Um]:0}),l=Object.keys(s).reduce(((e,t)=>(s[t]||0)+e),0),u=Object.keys(s).map((e=>({[e]:100*parseFloat((s[e]/l).toFixed(4))}))),d=a.filter((({matchUpStatus:e})=>e===ym)).length;return u.push({[ym]:100*parseFloat((d/l).toFixed(4))}),{competitiveBands:Object.assign({},...u),...At}}var{stageOrder:Hb}=iu;function zb(e,t){return e.eventName.localeCompare(t.eventName)||e.eventId.localeCompare(t.eventId)||(Hb[null==e?void 0:e.stage]||0)-(Hb[null==t?void 0:t.stage]||0)||t.matchUpsCount-e.matchUpsCount||`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`.localeCompare(`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`)}function Yb({excludeScheduleDateProfileRounds:e,excludeScheduledRounds:t,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:d,venueId:c,context:p}){var m;if(n&&!Array.isArray(n||"object"!=typeof n[0]))return{error:Cr,inContextMatchUps:n};if(o&&!r){if("object"!=typeof o)return{error:Vt};r={[o.tournamentId]:o}}let f="object"!=typeof r||!Object.keys(r).length;if((c||u||!n||!a&&(e||i||a||s))&&f)return{error:Lt};let h=Object.assign({},...Object.values(r??{}).map((({venues:e=[],tournamentId:t})=>({[t]:null==e?void 0:e.map((({venueId:e})=>e))})))),v=Object.values(r??{}).map((({events:e=[],tournamentId:t,startDate:i,endDate:n})=>e.map((e=>({...e,validVenueIds:h[t],startDate:e.startDate??i,endDate:e.endDate??n}))))).flat(),{segmentedRounds:g,profileRounds:I}=r&&(e||i||a||s)&&pb({tournamentRecords:r,schedulingProfile:a})||{},U=e&&Object.assign({},...I.map((e=>({[e.id]:e})))),y=n||r&&(null==(m=tv({tournamentRecords:r,matchUpFilters:l}))?void 0:m.matchUps)||[],S=[],w=y&&Object.values(y.reduce(((e,t)=>{var i;let n=ub(t).id,r=null==g?void 0:g[n],a=[...(null==(i=e[n])?void 0:i.matchUps)??[],t],{containerStructureId:o,stageSequence:s,structureName:l,tournamentId:u,isRoundRobin:c,matchUpType:p,roundNumber:m,roundOffset:f,structureId:h,eventName:v,roundName:I,drawName:U,eventId:y,drawId:S}=t,w=c?o:h;return{...e,[n]:{id:d?n:void 0,structureId:w,stageSequence:s,segmentsCount:r,structureName:l,tournamentId:u,matchUpType:p,roundNumber:m,roundOffset:f,eventName:v,roundName:I,drawName:U,matchUps:a,eventId:y,drawId:S}}}),{})).map((e=>{let{minFinishingSum:t,winnerFinishingPositionRange:i}=function(e){return(e||[]).reduce(((e,t)=>{var i,n;let r=((null==(i=t.finishingPositionRange)?void 0:i.winner)||[]).reduce(((e,t)=>e+t),0),a=((null==(n=t.finishingPositionRange)?void 0:n.winner)||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:a}:e}),{minFinishingSum:0,winnerFinishingPositionRange:""})}(e.matchUps),n=e.segmentsCount;if(n){let a=e.matchUps.length/n;return ht(e.matchUps.sort(((e,t)=>e.roundPosition-t.roundPosition)),a).map(((a,o)=>{let{unscheduledCount:s,incompleteCount:l,matchUpsCount:u,isScheduled:d,isComplete:c,byeCount:m}=cb(a),f=db({matchUps:e.matchUps,tournamentRecords:r,events:v,round:e});return _a({...e,...p,roundSegment:{segmentsCount:n,segmentNumber:o+1},winnerFinishingPositionRange:i,unscheduledCount:s,incompleteCount:l,minFinishingSum:t,matchUpsCount:u,isScheduled:d,roundTiming:f,isComplete:c,byeCount:m,matchUps:a})}))}let{unscheduledCount:a,incompleteCount:o,matchUpsCount:s,isScheduled:l,isComplete:u,byeCount:d}=cb(e.matchUps),c=db({matchUps:e.matchUps,tournamentRecords:r,events:v,round:e});return _a({...e,...p,winnerFinishingPositionRange:i,unscheduledCount:a,incompleteCount:o,minFinishingSum:t,matchUpsCount:s,isScheduled:l,roundTiming:c,isComplete:u,byeCount:d})})).flat().filter((n=>{if(e){let t=Eo(e),i=d?n.id:ub(n).id;if(t&&U[i]&&Eo(U[i].scheduleDate)===t)return!1}let{isComplete:r,isScheduled:a}=n,s=!i||!r,l=!t||!a,p=c||u?null==v?void 0:v.find((({eventId:e})=>e===n.eventId)):void 0,m=(null==p?void 0:p.startDate)??(null==o?void 0:o.startDate),f=(null==p?void 0:p.endDate)??(null==o?void 0:o.endDate),h=!u||!m||new Date(u)>=new Date(m),g=!u||!f||new Date(u)<=new Date(f),I=h&&g,y=!c||(null==p?void 0:p.validVenueIds.includes(c)),w=s&&l&&y&&I;return w||S.push(n),w})).sort(zb)||[];return{...At,rounds:w,excludedRounds:S}}function Kb(e){var t;let{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:o}=e||{},{matchUpFormat:s}=e||{};if(!i)return{error:Ji};s=s||(null==i?void 0:i.matchUpFormat);let l=no(s),u=!(null==i||!i.winningSide),d=null==(t=i.score)?void 0:t.sets,c=null==d?void 0:d.length,p=r&&r-1,m=!(null==d||!d.find(((e,t)=>e.setNumber===r&&t===p))),f=(null==d?void 0:d.filter((e=>null==e?void 0:e.winningSide)))||[],h=(null==f?void 0:f.length)||0,v=r&&(null==d?void 0:d.slice(r))||[],g=!!(c&&r&&null!=v&&v.reduce(((e,t)=>(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e),!0)),I=r<=c&&d.find((e=>e.setNumber===r)),U=I&&BD({setObject:I,matchUpScoringFormat:l}),{isCompletedSet:y,sideGameScores:S,sideTiebreakScores:w}=U||{},P=!!(I&&!y&&g||r&&r===c+1&&!u),D=[1,2].includes(n),T=D?n-1:0,b=I&&D&&(!a&&!o&&void 0!==S[T]&&S[T]||a&&void 0!==w[T]&&w[T]),R=!!b,N=null==f?void 0:f.map((e=>BD({setObject:e,matchUpScoringFormat:l}).isValidSetOutcome)).reduce(((e,t)=>e&&t),!0),M=f.reduce(((e,t)=>{let{winningSide:i}=t;return e[i-1]++,e}),[0,0]),A=null==i?void 0:i.winningSide,E=A&&A-1,C=1-E,O=M[E],k=M[C],F=Math.max(...M),x=tt(M)[F],{bestOf:_,exactly:L}=l??{},B=F===(_&&Math.ceil(_/2)||L||1)&&1===x&&M.indexOf(F)+1||void 0,V=O>k&&A===B;return{completedSetsHaveValidOutcomes:N,validMatchUpWinningSide:V,calculatedWinningSide:B,matchUpScoringFormat:l,validMatchUpOutcome:B&&N&&V,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:u,isValidSideNumber:D,hasExistingValue:R,existingValue:b,isExistingSet:m,isActiveSet:P,...U}}function Jb({participants:e,tournamentAppliedPolicies:t,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:d,matchUpFilters:c,participantMap:p,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:v,tournamentId:g,inContext:I,context:U,event:y}){let S,{eventId:w,eventName:P,endDate:D,eventType:T,category:b,gender:R}=y??{},N={...U,..._a({surfaceCategory:(null==y?void 0:y.surfaceCategory)??(null==s?void 0:s.surfaceCategory),indoorOutDoor:(null==y?void 0:y.indoorOutdoor)??(null==s?void 0:s.indoorOutdoor),endDate:D??(null==y?void 0:y.endDate)??(null==s?void 0:s.endDate),tournamentId:g??(null==s?void 0:s.tournamentId),eventName:P,eventType:T,category:b,eventId:w,gender:R})};return!(null!=e&&e.length)&&s&&({participants:e,participantMap:p,groupInfo:S}=vm({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:I})),y&&f&&!d&&(d=bm({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:h,event:y})),{...Zh({context:N,tournamentAppliedPolicies:t,scheduleVisibilityFilters:i,tournamentParticipants:e,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:d,contextFilters:u,matchUpFilters:c,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:v,inContext:I,event:y}),groupInfo:S}}var Qb={};function Zb({tournamentRecord:e,venueId:t,venueIds:i}){return e?{courts:(e.venues||[]).filter((e=>t?e.venueId===t:!i||i.includes(e.venueId))).map((e=>{let{venueId:t}=e,i=ts(e.courts||[]);return i.forEach((e=>Object.assign(e,{venueId:t}))),i})).flat()}:{error:Bt}}be(Qb,{getCompetitionVenues:()=>qT,getCourts:()=>Zb,getVenuesAndCourts:()=>$T,publicFindVenue:()=>bh});var Xb={};function eR({tournamentRecord:e,event:t}){var i,n;if(!e)return{error:Bt};if(!t)return{error:bi};let r,a,o,s=t.entries||[],l=e.participants||[],u=(null==(i=t.category)?void 0:i.categoryName)||(null==(n=t.category)?void 0:n.ageCategoryCode),{eventType:d}=t,c=s.map((e=>e.participantId));return{entryScaleAttributes:l.filter((e=>c.includes(e.participantId))).map((e=>{var t,i,n,s,l,c;let{participantId:p,participantName:m,name:f}=e,h={scaleType:zf,eventType:d,scaleName:u},v=null==(i=null==(t=Ov({participant:e,scaleAttributes:h}))?void 0:t.scaleItem)?void 0:i.scaleValue;h={scaleType:Hf,eventType:d,scaleName:u};let g=null==(s=null==(n=Ov({participant:e,scaleAttributes:h}))?void 0:n.scaleItem)?void 0:s.scaleValue;h={scaleType:Wf,eventType:d,scaleName:u};let I=null==(c=null==(l=Ov({participant:e,scaleAttributes:h}))?void 0:l.scaleItem)?void 0:c.scaleValue;return r=!(!r&&!v),a=!(!a&&!g),o=!(!o&&!I),{participantId:p,participantName:m||f,seed:v,ranking:g,rating:I}})),hasSeededParticipants:r,hasRankedParticipants:a,hasRatedParticipants:o}}function tR({tournamentRecord:e,withScaleValues:t,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:o}){var s,l,u,d;if(!e)return{error:Bt};let{tournamentId:c}=e,p=(e.events??[]).filter((({eventId:e})=>!r||Array.isArray(r)&&r.includes(e))).map((e=>{var t;let i=null==(t=e.drawDefinitions)?void 0:t.map(gc);if(null!=a&&a.length&&!dt(a,i).length)return;let r=ts(e);return n&&Object.assign(r,{tournamentId:c}),o&&Object.assign(r,o),r})).filter(Boolean),m={};if(t){let t=zv({withScaleValues:!0,tournamentRecord:e}).participantMap,n=e=>e.reduce(((e,t)=>e+parseFloat(t)),0);for(let e of p){let r=i??e.eventType,o=e.eventId;m[o]||(m[o]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let c=(e.entries??[]).filter((({entryStatus:e})=>zm.includes(e))).map(hc),p=e=>{var t,i,n,a,s,l;if(null!=(t=null==e?void 0:e.ratings)&&t[r])for(let u of(null==(i=null==e?void 0:e.ratings)?void 0:i[r])??[]){let e=u.scaleName;m[o].ratings[e]||(m[o].ratings[e]=[]);let t=null==(n=py[e])?void 0:n.accessor;if(t){let i=parseFloat(null==(a=u.scaleValue)?void 0:a[t]);i&&m[o].ratings[e].push(i)}}if(null!=(s=null==e?void 0:e.rankings)&&s[r])for(let u of(null==(l=null==e?void 0:e.rankings)?void 0:l[r])??[]){let e=u.scaleName;m[o].ranking[e]||(m[o].ranking[e]=[]),u.scaleValue&&m[o].ranking[e].push(u.scaleValue)}};for(let e of c){let i=null==(s=null==t?void 0:t[e])?void 0:s.participant;if((null==i?void 0:i.participantType)!==zp)for(let e of(null==i?void 0:i.individualParticipantIds)??[]){p(null==(l=null==t?void 0:t[e])?void 0:l.participant)}else p(i)}let f=m[o].ratings;for(let e of Object.keys(f)){let t=f[e];if(!t.length)continue;let i=null==(u=je(t))?void 0:u.toFixed(2);m[o].ratingsStats[e]={avg:parseFloat((n(t)/t.length).toFixed(2)),median:i?parseFloat(i):void 0,max:Math.max(...t),min:Math.min(...t)}}let h=(e,i)=>{var n,a;let s=t=>{var i,n,a,s,l,u,d,c,p,f;if(null!=(i=m[o].draws)&&i[e]&&null!=(n=null==t?void 0:t.ratings)&&n[r])for(let h of(null==(a=null==t?void 0:t.ratings)?void 0:a[r])??[]){let t=h.scaleName;null!=(s=m[o].draws[e])&&s.ratings[t]||(m[o].draws[e].ratings[t]=[]);let i=null==(l=py[t])?void 0:l.accessor;if(i){let n=parseFloat(null==(u=h.scaleValue)?void 0:u[i]);n&&m[o].draws[e].ratings[t].push(n)}}if(null!=(d=m[o].draws)&&d[e]&&null!=(c=null==t?void 0:t.rankings)&&c[r])for(let h of(null==(p=null==t?void 0:t.rankings)?void 0:p[r])??[]){let t=h.scaleName;null!=(f=m[o].draws[e])&&f.ranking[t]||(m[o].draws[e].ranking[t]=[]);let i=h.scaleValue;i&&m[o].draws[e].ranking[t].push(i)}};for(let r of i.filter(Boolean)){let e=null==(n=null==t?void 0:t[r])?void 0:n.participant;if((null==e?void 0:e.participantType)!==zp)for(let i of(null==e?void 0:e.individualParticipantIds)??[]){s(null==(a=null==t?void 0:t[i])?void 0:a.participant)}else s(e)}},v=[],g=e=>(null==a?void 0:a.length)&&a.includes(e)||v.includes(e);for(let t of e.drawDefinitions??[]){let e=t.drawId;if(g(e))continue;let i=Mv({drawDefinition:t}).assignedParticipantIds??[];m[o].draws[e]||(m[o].draws[e]={ratingsStats:{},ratings:{},ranking:{}}),v.push(e),h(e,i)}let I=Eh({event:e}).flightProfile;for(let e of(null==I?void 0:I.flights)??[]){let t=e.drawId;g(t)||h(t,e.drawEntries.map(hc))}for(let e of v){let t=m[o].draws[e].ratings;for(let i of Object.keys(t)){let r=t[i];if(!r.length)continue;let a=null==(d=je(r))?void 0:d.toFixed(2);m[o].draws[e].ratingsStats[i]={avg:parseFloat((n(r)/r.length).toFixed(2)),median:a?parseFloat(a):void 0,max:Math.max(...r),min:Math.min(...r)}}}}}return _a({eventScaleValues:m,events:p,...At})}function iR({tournamentRecord:e,drawDefinition:t,context:i,event:n}){var r;if(!e)return{error:Bt};if(!n)return{error:bi};let a=ts(n);return i&&Object.assign(a,i),_a({drawDefinition:t&&(null==(r=a.drawDefinitions)?void 0:r.find((({drawId:e})=>t.drawId===e))),event:a})}function nR(e){var t,i;let n="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:a}=function(e){let{tournamentRecord:t,event:i}=e,n=gm({tournamentRecord:t,event:i}).appliedPolicies??{},r=ts(e.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}(e),o=function({enforceGender:e,policyDefinitions:t,appliedPolicies:i}){var n,r,a,o;return e??(null==(r=null==(n=null==t?void 0:t[rd])?void 0:n.participants)?void 0:r.enforceGender)??(null==(o=null==(a=null==i?void 0:i[rd])?void 0:a.participants)?void 0:o.enforceGender)}({...e,policyDefinitions:a,appliedPolicies:r}),s=function({considerEventEntries:e=!0,drawEntries:t,eventEntries:i,qualifyingOnly:n}){return(n&&[]||rR(t)||(e?i:[])).filter((({entryStage:e})=>!e||e===il))}(e),l=function(e){let{consideredEntries:t,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:o,event:s}=e;return s&&o&&hw({consideredEntries:t,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:o,event:s})}({...e,consideredEntries:s,appliedPolicies:r});if(null!=l&&l.error)return La({result:l,stack:n});let u=function(e){return!e.drawSize&&e.consideredEntries.length&&![Tl,Al,bl,Hl,zl].includes(e.drawType??"")&&He(e.consideredEntries.length)||e.drawSize&&Be(e.drawSize)||!1}({...e,consideredEntries:s}),d=function(e){let{policyDefinitions:t,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=e,a=e.drawTypeCoercion??dw({drawType:e.drawType,policyDefinitions:t,appliedPolicies:i}),o=Iw({drawType:e.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return o.error?o:{drawType:o.drawType}}({...e,appliedPolicies:r,policyDefinitions:a,drawSize:u});if(d.error)return La({result:d,stack:n});let c=d.drawType;if(isNaN(u)&&c!==Tl)return La({result:{error:si},stack:n});let p=(null==a?void 0:a[pd])??(null==r?void 0:r[pd]),m=e.seedingProfile??(null==(i=null==(t=null==p?void 0:p.seedingProfile)?void 0:t.drawTypes)?void 0:i[c??""])??(null==p?void 0:p.seedingProfile);e.seedingProfile&&(a[pd]||(a[pd]={...rT[pd]}),a[pd].seedingProfile=m);let f=function(e){var t,i;let{tournamentRecord:n,event:r,ignoreAllowedDrawTypes:a,drawType:o}=e,s=!a&&n&&gT({tournamentRecord:n,categoryType:null==(t=null==r?void 0:r.category)?void 0:t.categoryType,categoryName:null==(i=null==r?void 0:r.category)?void 0:i.categoryName});return null!=s&&s.length&&!s.includes(o)?{error:ri}:{...At}}({...e,drawType:c});return null!=f&&f.error?La({result:f,stack:n}):{drawSize:u,drawType:c,enforceGender:o,seedingProfile:m,appliedPolicies:r,policyDefinitions:a}}function rR(e){return null==e?void 0:e.filter((e=>e.entryStatus&&[...zm,Lm].includes(e.entryStatus)))}function aR(e){let{voluntaryConsolation:t,tournamentRecord:i,event:n}=e,r="generateDrawDefinition",{participants:a,participantMap:o}=zv({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=rR(null==n?void 0:n.entries)??[],l=nR({...e,participantMap:o,participants:a,eventEntries:s});if(l.error)return La({result:l,stack:r});let{appliedPolicies:u,policyDefinitions:d,drawSize:c,drawType:p,enforceGender:m,seedingProfile:f}=l,h=null==n?void 0:n.eventType,v=e.matchUpType??h,g=function(e){var t,i,n;let{existingDrawDefinition:r,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:u,isMock:d,event:c}=e,{tieFormat:p,matchUpFormat:m}=e;if(l===Xs&&u===Xs){let e=null==(i=null==(t=null==r?void 0:r.structures)?void 0:t.find((({stage:e})=>e===il)))?void 0:i.tieFormat;p=p||e||s&&(null==(n=null==c?void 0:c.tieFormat)?void 0:n.tieFormatName)===s&&c.tieFormat||s&&Ys({namedFormat:s,hydrateCollections:a,isMock:d,event:c})||(null==c?void 0:c.tieFormat)||Ys({event:c,isMock:d,hydrateCollections:a}),m=void 0}else m||(p=void 0,null!=c&&c.matchUpFormat||(m=hs));if(p){let e=Jo({gender:null==c?void 0:c.gender,enforceGender:o,tieFormat:p});if(e.error)return e}return{tieFormat:p,matchUpFormat:m}}({...e,enforceGender:m,eventType:h,matchUpType:v});if(g.error)return La({result:g,stack:r});let{matchUpFormat:I,tieFormat:U}=g;if(e.drawId&&"string"!=typeof e.drawId)return La({result:{error:Cr},stack:r});let y=function(e){var t,i;let n="generateOrGetExisting",r=[],a=[],o=oT(e);if(o.error)return La({result:o,stack:n});let s=o.existingDrawDefinition,l=o.drawDefinition??{},u=o.structureId,d=e.drawEntries??e.eventEntries??[],c=o.existingQualifyingPlaceholderStructureId&&VD({...e,...o})||YD({...e,...o,entries:d});return c.error?La({result:c,stack:n}):(null!=(t=c.positioningReports)&&t.length&&r.push(...c.positioningReports??[]),null!=(i=c.conflicts)&&i.length&&a.push(...c.conflicts??[]),l=c.drawDefinition,u=c.structureId,{existingDrawDefinition:s,positioningReports:r,drawDefinition:l,structureId:u,conflicts:a,entries:d})}({...e,policyDefinitions:d,tournamentRecord:i,appliedPolicies:u,matchUpFormat:I,seedingProfile:f,participants:a,eventEntries:s,matchUpType:v,tieFormat:U,drawSize:c,drawType:p,event:n});if(y.error)return La({result:y,stack:r});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:P,structureId:D,conflicts:T,entries:b}=y;if(!P)return La({result:{error:Cr},stack:r});let R=function(e){var t,i,n;let{qualifyingPlaceholder:r,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:u,drawDefinition:d,seedingProfile:c,participants:p,structureId:m,entries:f,stack:h}=e,v=r&&!(null!=a&&a.length)&&!o,g=[];if(a){let r=(e,t)=>e.stageSequence-t.stageSequence,o=(e,t)=>e.roundTarget-t.roundTarget,m=[],v=1;a.sort(o);for(let I of a){if(!Array.isArray(I.structureProfiles))return La({info:eI("structureProfiles"),result:{error:un},stack:h});v=I.roundTarget||v;let a=(null==(t=I.structureProfiles)?void 0:t.sort(r))||[],o=1;for(let t of a){let{qualifyingRoundNumber:r,qualifyingPositions:a,seededParticipants:h,seedingScaleName:I,seedsCount:U=0,seedByRanking:y,placeByes:S,drawSize:w}=t,P=zD({...e,seedingProfile:t.seedingProfile??c,stageSequence:o,qualifyingRoundNumber:r,preparedStructureIds:m,qualifyingPositions:a,seededParticipants:h,stage:nl,seedingScaleName:I,appliedPolicies:l,drawDefinition:d,qualifyingOnly:u,seedByRanking:y,participants:p,roundTarget:v,seedsCount:U,placeByes:S,drawSize:w,entries:f});if(P.error)return P;P.structureId&&m.push(P.structureId),o+=1,null!=(i=P.conflicts)&&i.length&&g.push(...P.conflicts),null!=(n=P.positioningReport)&&n.length&&s.push({[nl]:P.positioningReport})}v+=1}}else if(m&&v){let e=Rg({structureName:Tg(nl),stage:nl}),{link:t}=FU({sourceStructureId:e.structureId,targetStructureId:m,sourceRoundNumber:0,linkType:Sl});d.structures||(d.structures=[]),d.structures.push(e),d.links||(d.links=[]),d.links.push(t)}return{qualifyingConflicts:g,error:void 0}}({...e,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:P,seedingProfile:f,participants:a,structureId:D,entries:b,params:e,stack:r});if(R.error)return R;let{qualifyingConflicts:N}=R;return P.drawName=e.drawName??(p&&Tg(p)),c&&"object"==typeof t&&c>=4&&Ng({...t,drawDefinition:P,matchUpType:v}),{existingDrawDefinition:!!S,qualifyingConflicts:N,positioningReports:w,drawDefinition:P,structureId:D,...At,conflicts:T}}function oR({scaleAttributes:e,scaledEntries:t,stageEntries:i,seedsCount:n,scaleName:r}){if(!e)return{error:un,info:"missing scaleAttributes"};let a=Object.assign({},...(t||[]).slice(0,n).map((({participantId:e},t)=>({[e]:t+1}))));r=r||e.scaleName;let o=(new Date).toISOString();return{scaleItemsWithParticipantIds:i.map((({participantId:t})=>({scaleItems:[{scaleValue:a[t],eventType:e.eventType,scaleType:Ju,scaleName:r,scaleDate:o}],participantId:t})))}}function sR({tournamentRecord:e,drawDefinition:t,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:d}){let c=hb({policyDefinitions:i,drawDefinition:t,drawSize:a,drawId:o,event:s,stage:l});if(c.error)return c;let{entries:p,seedsCount:m,stageEntries:f}=c;if(!f||!m)return{error:Cr};let h=HD({tournamentRecord:e,scaleAttributes:n,scaleSortMethod:d,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:v}=oR({scaleAttributes:n,scaledEntries:h,stageEntries:f,seedsCount:m,scaleName:r});return{scaleItemsWithParticipantIds:v}}be(Xb,{categoryCanContain:()=>Yo,getCategoryAgeDetails:()=>Ho,getEvent:()=>iR,getEventProperties:()=>eR,getEventStructures:()=>vI,getEventTimeItem:()=>sm,getEvents:()=>tR,getFlightProfile:()=>Eh,getScaledEntries:()=>HD});var lR={};be(lR,{addDrawEntries:()=>eg,addEventEntries:()=>ag,addEventEntryPairs:()=>IR,destroyPairEntries:()=>Sg,destroyPairEntry:()=>yg,getEntriesAndSeedsCount:()=>hb,getMaxEntryPosition:()=>vb,modifyEntriesStatus:()=>Cv,modifyEventEntries:()=>UR,mutate:()=>uR,promoteAlternate:()=>pR,promoteAlternates:()=>mR,query:()=>fb,removeDrawEntries:()=>hR,removeEventEntries:()=>ig,setEntryPosition:()=>dR,setEntryPositions:()=>cR});var uR={};function dR({tournamentRecord:e,drawDefinition:t,participantId:i,entryPosition:n,skipRefresh:r,event:a}){if(!e)return{error:Bt};if(!i)return La({result:{error:xn},stack:"setEntryPositions"});if(void 0!==n&&!Number.isSafeInteger(n))return{error:Cr,entryPosition:n};((null==a?void 0:a.entries)||[]).forEach((e=>{e.participantId===i&&(e.entryPosition=n)})),((null==t?void 0:t.entries)||[]).forEach((e=>{e.participantId===i&&(e.entryPosition=n)}));let o=e=>{e.entries.forEach((e=>{e.entryPosition===n&&e.participantId!==i&&(e.entryPosition+=.1)}))};return r||(null!=a&&a.entries&&(o(a),a.entries=Av({entries:a.entries})),null!=t&&t.entries&&(o(t),t.entries=Av({entries:t.entries}))),{...At}}function cR({tournamentRecord:e,entryPositions:t,drawDefinition:i,event:n}){if(!e)return{error:Bt};if(!Array.isArray(t))return{error:Cr};for(let r of t){let{participantId:t,entryPosition:a}=r,o=dR({skipRefresh:!0,tournamentRecord:e,drawDefinition:i,participantId:t,entryPosition:a,event:n});if(o.error)return o}return null!=n&&n.entries&&(n.entries=Av({entries:n.entries})),null!=i&&i.entries&&(i.entries=Av({entries:i.entries})),{...At}}function pR(e){let{participantId:t}=e;return t&&"string"!=typeof t?{error:Cr,participantId:t}:mR({...e,participantIds:[t].filter(Boolean)})}function mR({tournamentRecord:e,drawDefinition:t,participantIds:i,stageSequence:n,stage:r=il,eventId:a,event:o}){if(!e)return{error:Bt};if(!Array.isArray(i))return{error:Cr,participantIds:i};if(!o)return{error:bi};if(o){let e=fR({element:o,participantIds:i,stageSequence:n,stage:r});if(e.error)return e}if(t){let e=fR({element:t,participantIds:i,stageSequence:n,stage:r});if(e.error)return a?La({context:{drawPromotionError:e.error,drawId:t.drawId},result:{...At},stack:"promoteAlternates"}):e}return{...At}}function fR({participantIds:e,stageSequence:t,element:i,stage:n}){let r=(i.entries||[]).filter((e=>e.entryStatus===Em)),a=(i.entries||[]).filter((t=>e.includes(t.participantId))),o=r.reduce(((e,t)=>{let{entryPosition:i}=t;return isNaN(i)&&e||(!e||i<e.entryPosition)&&t||e}),void 0),s=a.length?a:[o].filter(Boolean);if(null==s||!s.length)return{error:Yn};let l=s.filter((({entryStatus:e})=>e!==Em));if(l.length)return{error:zn,invalidEntryStatus:l};let u=s.filter((({entryStage:e})=>e&&e!==n));if(u.length)return{error:Kn,invalidStage:u};let d=t&&s.filter((e=>e.stageSequence!==t));if(null!=d&&d.length)return{error:Jn,invalidStageSequence:d};for(let c of s){c.entryStatus=Om;let e=null==c?void 0:c.entryPosition;isNaN(e)||i.entries.forEach((t=>{t.entryStatus===Em&&t.entryPosition>e&&(t.entryPosition=t.entryPosition-1)}));let t=Math.max(...i.entries.filter((e=>e.entryStatus===Om&&!isNaN(e.entryPosition))).map((({entryPosition:e})=>Be(e||0))),0);c.entryPosition=t||0}return{...At}}function hR({autoEntryPositions:e=!0,participantIds:t,drawDefinition:i,drawId:n,stages:r,event:a}){var o;if(!a)return{error:bi};if(!n)return{error:li};if(null==t||!t.length)return{error:Vn};if(pt(Mv({drawDefinition:i,stages:r}).assignedParticipantIds??[],t))return{error:qn};let s=e=>{let i=e.participantId;return!t.includes(i)},{flightProfile:l}=Eh({event:a}),u=null==(o=null==l?void 0:l.flights)?void 0:o.find((e=>e.drawId===n));return null!=u&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),e&&(u.drawEntries=Av({entries:u.drawEntries}))),null!=i&&i.entries&&(i.entries=i.entries.filter(s),e&&(i.entries=Av({entries:i.entries}))),{...At}}function vR(e){var t,i,n,r,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:u,pairOverride:d,participant:c}=e,p=e.tournamentId?null==(t=e.tournamentRecords)?void 0:t[e.tournamentId]:e.tournamentRecord??(e.activeTournamentId&&(null==(i=e.tournamentRecords)?void 0:i[e.activeTournamentId]));if(!p)return{error:Bt};if(!c)return La({result:{error:kn},stack:o});c.participantId||(c.participantId=rs()),p.participants||(p.participants=[]);let{participantId:m,individualParticipantIds:f}=c;if(p.participants.reduce(((e,t)=>t.participantId===m||e),!1))return{error:Ln};let{participantType:h,participantRole:v}=c;if(!h||!Object.keys(Qp).includes(h))return{error:Cn,participantType:h};if(!v)return{error:On};let g=p.participants||[],I=g.filter((e=>e.participantType===zp)).map((e=>e.participantId));if(h!==zp&&c.person)return{error:Cr,person:c.person};if(f&&!Array.isArray(f))return{error:Cr,individualParticipantIds:f};if(h===Kp){if(c.person)return{error:Cr,person:c.person};if(!c.individualParticipantIds)return La({result:{error:Vn},stack:o});if(2!==c.individualParticipantIds.length&&!d)return La({info:"PAIR must be 2 individualParticipantIds",result:{error:An},stack:o});{let e=g.filter((e=>e.participantType===zp)).map((e=>e.participantId));if(!Array.isArray(c.individualParticipantIds))return La({result:{error:An},stack:o});if(!c.individualParticipantIds.reduce(((t,i)=>e.includes(i)&&t),!0))return La({result:{error:An},stack:o})}let e=g.filter((e=>e.participantType===Kp)).map((e=>({individualParticipantIds:e.individualParticipantIds,participant:e}))),t=c.participantType===Kp&&e.find((e=>2===dt(e.individualParticipantIds,c.individualParticipantIds).length));if(t&&!s)return{...At,existingParticipant:!0,participant:l&&ts(t.participant)};if(!c.participantName){let e=g.filter((e=>{var t;return null==(t=c.individualParticipantIds)?void 0:t.includes(e.participantId)})),t=e.map((e=>{var t;return null==(t=e.person)?void 0:t.standardFamilyName})).filter(Boolean).join("/");1===e.length&&(t+="/Unknown"),c.participantName=t}}else if(h===zp){if(null==(n=c.person)||!n.standardFamilyName||null==(r=c.person)||!r.standardGivenName)return{error:$n};if(!c.participantName){let e=`${c.person.standardFamilyName.toUpperCase()}, ${c.person.standardGivenName}`;c.participantName=e}}else{if(!h||![Jp,Yp].includes(h))return{error:Cn};if(f||(c.individualParticipantIds=[]),null==(a=c.individualParticipantIds)?void 0:a.length)for(let e of c.individualParticipantIds){if("string"!=typeof e)return La({result:{participantId:e,error:Cr},stack:o});if(!I.includes(e))return La({result:{participantId:e,error:_n},stack:o})}}return p.participants.push(c),u||Ia({payload:{tournamentId:p.tournamentId,participants:[c]},topic:Xc}),_a({participant:l&&ts(c),...At})}function gR({allowDuplicateParticipantIdPairs:e,returnParticipants:t,tournamentRecord:i,participants:n=[]}){if(!i)return{error:Bt};i.participants||(i.participants=[]);let r=i.participants.map((e=>e.participantId))||[];n.forEach((e=>{e.participantId||(e.participantId=rs())}));let a=n.filter((e=>!r.includes(e.participantId))),o=n.filter((e=>r.includes(e.participantId))),s=a.filter((e=>e.participantType===zp)),l=a.filter((e=>e.participantType!==zp)),u=s.concat(...l),d=[];if(u.length){for(let t of u){let n=vR({allowDuplicateParticipantIdPairs:e,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:t});if(n.error)return n;n.success&&!n.existingParticipant&&d.push(n.participant)}d.length&&Ia({topic:Xc,payload:{tournamentId:i.tournamentId,participants:d}});let n={participants:t&&ts(d),addedCount:d.length,...At};return o.length&&Object.assign(n,{notAdded:o,info:Wn}),_a(n)}return{info:"No new participants to add",addedCount:0,...At}}function IR(e){let t=qu(e,[{[au]:!0,[Au]:!0}]);if(t.error)return t;let{allowDuplicateParticipantIdPairs:i,entryStatus:n=Em,participantIdPairs:r=[],entryStage:a=il,tournamentRecord:o,drawDefinition:s,event:l,uuids:u}=e;if(l.eventType!==Oe)return{error:Ti};let d=[],c=new Map;for(let I of o.participants??[]){let{participantType:e,participantId:t,person:i,individualParticipantIds:n}=I;e===zp&&null!=i&&i.sex?c.set(t,i.sex):e===Kp&&n&&d.push(n)}let p=r.filter((e=>{if(2!==e.length)return!0;if(!l.gender||l.gender===Ba)return!1;if(!c.has(e[0])||!c.has(e[1]))return!0;let t=e.map((e=>c.get(e))),i=l.gender===Va&&(t[0]!==Va||t[1]!==Va)||l.gender===$a&&(t[0]!==$a||t[1]!==$a);return l.gender===ja&&(t.sort(Gv),(t[0]!==$a||t[1]!==Va)&&(i=!0)),i}));if(p.length)return{error:An,invalidParticipantIdPairs:p};let m,f=r.map((e=>({participantId:(null==u?void 0:u.pop())??rs(),participantRole:sg,individualParticipantIds:e,participantType:Kp}))),h=i?f:f.filter((e=>!d.find((t=>2===dt(t,e.individualParticipantIds).length)))),v=[];if(h){let e=gR({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(e.error)return e;v=e.participants||[],m=e.info}let g=ag({participantIds:r.map((e=>{let t=v.find((t=>2===dt(t.individualParticipantIds,e).length));if(t)return t;let{participant:i}=Fh({tournamentRecord:o,participantIds:e});return i})).map((e=>e.participantId)),tournamentRecord:o,drawDefinition:s,entryStatus:n,entryStage:a,event:l});return h.length&&Ia({payload:{participants:h},topic:Xc}),{...g,info:m,newParticipantIds:h.map(hc)}}function UR({entryStatus:e=Om,unpairedParticipantIds:t=[],participantIdPairs:i=[],entryStage:n=il,tournamentRecord:r,event:a}){if(!r)return{error:Bt};if(!a)return{error:bi};let o=r.participants??[],s=o.filter((e=>e.participantType===zp)).map((e=>e.participantId)),l=t.concat(...i).flat(1/0).filter((e=>!s.includes(e)));if(l.length)return{error:An,invalidParticipantIds:l};let u=i.filter((e=>2!==e.length));if(u.length)return{error:An,invalidParticipantIdPairs:u};let d=o.filter((e=>e.participantType===Kp)).map((e=>e.individualParticipantIds)),c=gR({participants:i.filter((e=>!d.find((t=>2===dt(t,e).length)))).map((e=>({participantType:Kp,participantRole:sg,individualParticipantIds:e}))),tournamentRecord:r});if(c.error)return c;let p=i.map((e=>{let{participant:t}=Fh({tournamentRecord:r,participantIds:e});return t})).map((t=>({participantId:t,entryStatus:e,entryStage:n}))),m=t.map((e=>({entryStatus:Vm,participantId:e,entryStage:n})));return a.entries=(a.entries??[]).filter((e=>e.entryStage===n)),a.entries=a.entries.concat(...p,...m),{...At}}be(uR,{addDrawEntries:()=>eg,addEventEntries:()=>ag,addEventEntryPairs:()=>IR,destroyPairEntries:()=>Sg,destroyPairEntry:()=>yg,modifyEntriesStatus:()=>Cv,modifyEventEntries:()=>UR,promoteAlternate:()=>pR,promoteAlternates:()=>mR,removeDrawEntries:()=>hR,removeEventEntries:()=>ig,setEntryPosition:()=>dR,setEntryPositions:()=>cR});var yR={};be(yR,{addDrawDefinition:()=>JR,addEvent:()=>PR,addFlight:()=>rN,assignSeedPositions:()=>QR,attachFlightProfile:()=>ZR,categoryCanContain:()=>Yo,deleteDrawDefinitions:()=>CR,deleteEvents:()=>iN,deleteFlightAndFlightDraw:()=>YR,deleteFlightProfileAndFlightDraws:()=>OR,generate:()=>SR,generateEventsFromTieFormat:()=>DR,getCategoryAgeDetails:()=>Ho,getEvent:()=>iR,getEventProperties:()=>eR,getEventStructures:()=>vI,getEventTimeItem:()=>sm,getEvents:()=>tR,getFlightProfile:()=>Eh,getScaledEntries:()=>HD,modifyEvent:()=>nN,modifyEventMatchUpFormatTiming:()=>_R,modifyPairAssignment:()=>KR,mutate:()=>TR,query:()=>Xb,refreshEventDrawOrder:()=>zR,removeEventMatchUpFormatTiming:()=>LR,removeScaleValues:()=>XR,removeSeeding:()=>tN,setEventDates:()=>qR,setEventDisplay:()=>eN,setEventEndDate:()=>$R,setEventStartDate:()=>GR,updateDrawIdsOrder:()=>HR,validateCategory:()=>zo});var SR={};be(SR,{generateEventsFromTieFormat:()=>DR});var wR={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:Is,DOMINANT_DUO_MIXED:cs,LAVER_CUP:Ps,TEAM_DOUBLES_3_AGGREGATION:os,TIME_TENNIS_DUAL:ps,TIME_TENNIS_PRO_CIRCUIT:ds,USTA_BREWER_CUP:ms,USTA_OZAKI_CUP:fs,USTA_COLLEGE:Us,USTA_GOLD_TEAM_CHALLENGE:as,USTA_INTERSECTIONAL:us,USTA_LEVEL_1:ys,USTA_SECTION_BATTLE:ls,USTA_SOUTHERN_LEVEL_5:ss,USTA_TOC:Ds,USTA_WTT_ITT:Ss,USTA_ZONAL:ws};function PR({suppressNotifications:e,tournamentRecord:t,internalUse:i,event:n}){var r,a,o,s;if(!t)return{error:Bt};if(t.events||(t.events=[]),!n)return{error:bi};let{startDate:l,endDate:u}=t;if(!i&&(null!=(r=n.entries)&&r.length||null!=(a=n.drawDefinitions)&&a.length)){let e=_a({drawDefinitions:!(null==(o=n.drawDefinitions)||!o.length),entries:!(null==(s=n.entries)||!s.length)});return{info:"entries/drawDefinitions cannot exist",error:Cr,context:e}}let d={eventType:Js,drawDefinitions:[],entries:[],startDate:l,endDate:u,...n};if(n.eventType===el)if(n.tieFormat){let e=Jo({tieFormat:n.tieFormat});if(e.error)return e}else if(n.tieFormatName){if(!wR[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Cr};let e=Ys({isMock:null==t?void 0:t.isMock,namedFormat:n.tieFormatName,event:n});d.tieFormat=e}if(d.eventId||(d.eventId=rs()),t.events.reduce(((e,t)=>e||t.eventId===d.eventId),void 0))return{error:Ni};{let i=d;if(t.events.push(i),!e){let{topics:e}=Pa();if(e.includes(Zc)){let e=Xh({event:n}).matchUps??[];Ap({tournamentId:null==t?void 0:t.tournamentId,eventId:n.eventId,matchUps:e})}let{drawDefinitions:i,...r}=n;for(let t of i||[])Op({drawDefinition:t});!function({tournamentId:e,event:t}){t&&Ia({payload:{tournamentId:e,event:t},key:t.eventId,topic:tp})}({tournamentId:null==t?void 0:t.tournamentId,event:r})}return{...At,event:d}}}function DR(e){var t,i,n,r;let a=qu(e,[{[Vu]:{[Uu]:!0,[lu]:!0}},{[au]:!0}]);if(a.error)return a;let o=e.tieFormat||Ys({namedFormat:e.tieFormatName}),s=e.uuids||[ns(o.collectionDefinitions.length)],l={[Va]:[],[$a]:[]};if(e.addEntriesFromTeams){let r=null==(i=null==(t=e.tournamentRecord.participants)?void 0:t.filter((e=>e.participantType===Hp)))?void 0:i.flatMap((e=>e.individualParticipantIds??[]));for(let t of e.tournamentRecord.participants??[])if(null!=r&&r.includes(t.participantId)){let e=null==(n=t.person)?void 0:n.sex;e&&[Va,$a].includes(e)&&l[e].push(t.participantId)}}let u=[];for(let d of o.collectionDefinitions??[]){let t=(null==(r=null==s?void 0:s.pop())?void 0:r.toString())||rs(),i=d.matchUpType,n=d.gender,a={matchUpFormat:d.matchUpFormat,eventName:d.collectionName,category:d.category,gender:n,eventType:i,eventId:t};if(e.addEntriesFromTeams){let t=i===Zs?Vm:e.entryStatus||Om,r=n===ja?[...l[Va],...l[$a]]:l[n]??[];if(r.length){let e=ag({participantIds:r,entryStatus:t,event:a});if(e.error)return e}}if(u.push(a),!1!==e.addEvents){let t=PR({internalUse:!0,tournamentRecord:e.tournamentRecord,event:a});if(t.error)return t}}return{...At,events:u}}var TR={};function bR({removePriorValues:e=!0,status:t=Kf,statusObject:i,event:n}){if(!wt(i))return{error:Cr};let r=Lv({event:n,status:t}),a=`${Yf}.${Jf}`;return oS({timeItem:{itemValue:{[t]:{...r,...i}},itemType:a},removePriorValues:e,event:n})}function RR(e){var t,i,n,r,a,o,s;let l=qu(e,[{[au]:!0,[Au]:!0},{eventDataParams:!1,[Lu]:Ou}]);if(l.error)return l;let{includePositionAssignments:u,removePriorValues:d,tournamentRecord:c,status:p=Kf,event:m,drawIdsToRemove:f,drawIdsToAdd:h}=e,{appliedPolicies:v}=gm({tournamentRecord:c,event:m}),g={...v,...e.policyDefinitions},I=(null==(t=null==m?void 0:m.drawDefinitions)?void 0:t.map((({drawId:e})=>e)))??[],U=e.drawDetails?Object.keys(e.drawDetails):[],y=U.length?[]:e.drawIds,S=(h??[]).concat(...f??[],...y??[],...U),w=S.filter((e=>!I.includes(e)));if(w.length)return La({result:{error:Wt},context:{invalidDrawIds:w}});let P=Lv({event:m,status:p}),D=Object.keys((null==P?void 0:P.drawDetails)||{}).filter((e=>I.includes(e))).reduce(((e,t)=>(e[t]=P.drawDetails[t],e)),{});for(let N of I)if((!S.length||S.includes(N))&&(null!=f&&f.includes(N)||null!=y&&y.length&&!y.includes(N)?D[N]={...D[N],publishingDetail:{published:!1}}:(null!=h&&h.includes(N)||null!=y&&y.includes(N)||!(null!=y&&y.length))&&(D[N]={...D[N],publishingDetail:{published:!0}})),null==(i=e.drawDetails)?void 0:i[N]){let t=e.drawDetails[N],i=t.structureDetails??D[N].structureDetails,s=t.stageDetails??D[N].stageDetails??{},{structureIdsToRemove:l=[],structureIdsToAdd:u=[],publishingDetail:d={},stagesToRemove:c=[],stagesToAdd:p=[]}=t;if((u||p)&&(d.published=!0),D[N]={publishingDetail:d,structureDetails:i,stageDetails:s},u.length||l.length){let e=((null==(r=null==(n=null==m?void 0:m.drawDefinitions)?void 0:n.find((e=>e.drawId===N)))?void 0:r.structures)??[]).map((({structureId:e})=>e)),t=(u??[]).concat(l??[]).filter((t=>!e.includes(t)));if(t.length)return La({result:{error:Si},context:{invalidStructureIds:t}});i=i??{};for(let n of e)l.includes(n)?i[n]={published:!1}:i[n]={published:!0};D[N].structureDetails=i}let f=((null==(o=null==(a=null==m?void 0:m.drawDefinitions)?void 0:a.find((e=>e.drawId===N)))?void 0:o.structures)??[]).map((({stage:e})=>e));if(p.length){for(let e of p)s[e]={published:!0};for(let e of f)s[e]||(s[e]={published:!1})}if(p.length||c.length){for(let e of c)s[e]={published:!1};for(let e of f)s[e]||(s[e]={published:!0})}(p.length||c.length)&&(D[N].stageDetails=s)}bR({statusObject:{drawDetails:D},removePriorValues:d,status:p,event:m});let{topics:T}=Pa(),b=T.includes(Up),R=b||e.returnEventData?null==(s=JT({includePositionAssignments:u,...e.eventDataParams,usePublishState:!0,tournamentRecord:c,policyDefinitions:g,event:m}))?void 0:s.eventData:void 0;return b&&Ia({payload:{eventData:R,tournamentId:c.tournamentId},topic:Up}),{...At,eventData:R}}be(TR,{addDrawDefinition:()=>JR,addEvent:()=>PR,addFlight:()=>rN,assignSeedPositions:()=>QR,attachFlightProfile:()=>ZR,deleteDrawDefinitions:()=>CR,deleteEvents:()=>iN,deleteFlightAndFlightDraw:()=>YR,deleteFlightProfileAndFlightDraws:()=>OR,modifyEvent:()=>nN,modifyEventMatchUpFormatTiming:()=>_R,modifyPairAssignment:()=>KR,refreshEventDrawOrder:()=>zR,removeEventMatchUpFormatTiming:()=>LR,removeScaleValues:()=>XR,removeSeeding:()=>tN,setEventDates:()=>qR,setEventDisplay:()=>eN,setEventEndDate:()=>$R,setEventStartDate:()=>GR,updateDrawIdsOrder:()=>HR,validateCategory:()=>zo});var NR="deleteDrawDefinitions",MR="autoSchedulingAudit",AR="deleteEvents",ER={AUTO_SCHEDULING_AUDIT:MR,DELETE_EVENTS:AR,DELETE_DRAW_DEFINITIONS:NR};function CR(e){var t,i,n,r,a;if(!e.tournamentRecord)return{error:Bt};let o="deleteDrawDefinitions",s=e.drawIds??[],l=e.event,{autoPublish:u=!0,tournamentRecord:d,auditData:c,eventId:p,force:m}=e,{appliedPolicies:f}=gm({tournamentRecord:d,event:l}),h={...f,...e.policyDefinitions},v=Array.isArray(s)?s[0]:void 0;if(!l){let e=Ch({tournamentRecord:d,eventId:p,drawId:v});if(e.error)return e;l=e.event}let g=[],I=[],U=[];if(null==l||!l.drawDefinitions)return La({info:"event has no drawDefinition",result:{...At},stack:o});let y=l.drawDefinitions.map((({drawId:e})=>e));if(s.length||(s=y),s=s.filter((e=>y.includes(e))),!s.length)return La({info:"nothing to do; no matching drawIds in event.",result:{...At},stack:o});let S,w=ts(Eh({event:l}).flightProfile,!1,!0),P=({participantId:e,drawPosition:t,qualifier:i,bye:n})=>({bye:n,qualifier:i,drawPosition:t,participantId:e}),D=m??(null==(i=null==(t=null==f?void 0:f[cd])?void 0:t.allowDeletionWithScoresPresent)?void 0:i.drawDefinitions),T=Lv({event:l})??{},b=T.drawIds??(T.drawDetails&&Object.keys(T.drawDetails))??[],R=[],N=l.drawDefinitions.filter((e=>{var t,i,n,r,a,o,u,m;if(s.includes(e.drawId)){let s=(null==(t=nv({event:l,drawDefinition:e}))?void 0:t.matchUps)??[];if(s.some((({score:e})=>dv({score:e})))&&!D)return R.push(e.drawId),!0;let{drawId:f,drawType:h,drawName:v}=e,y=null==(i=null==w?void 0:w.flights)?void 0:i.find((t=>t.drawId===e.drawId));y&&(y.drawEntries=null==(n=y.drawEntries)?void 0:n.filter((e=>zm.includes(e.entryStatus)))),b.includes(f)&&(b=b.filter((e=>e!==f)),S=!0);let T=null==(a=null==(r=zc({stageSequence:1,drawDefinition:e,stage:il}))?void 0:r.structures)?void 0:a[0],N=null==(u=null==(o=T?cw({structureId:T.structureId,tournamentRecord:d,drawDefinition:e}):void 0)?void 0:o.positionAssignments)?void 0:u.map(P),M=null==(m=zc({stage:nl,drawDefinition:e}))?void 0:m.structures,A=null!=M&&M.length?M.map((t=>{var i;let n=t.stageSequence;return{positionAssignments:null==(i=cw({structureId:t.structureId,tournamentRecord:d,drawDefinition:e}))?void 0:i.positionAssignments.map(P),stageSequence:n}})):void 0,E={action:NR,payload:{drawDefinitions:[e],eventId:p??(null==l?void 0:l.eventId),auditData:c}};U.push(E),g.push(_a({tournamentId:d.tournamentId,eventId:p??(null==l?void 0:l.eventId),qualifyingPositionAssignments:A,positionAssignments:N,auditData:c,drawType:h,drawName:v,drawId:f})),null==s||s.forEach((({matchUpId:e})=>I.push(e)))}return!s.includes(e.drawId)}));if(R.length&&!m)return La({context:{drawIdsWithScoresPresent:R},result:{error:Yr},stack:o});if(l.drawDefinitions=N,w&&Dd({event:l,extension:{name:Gd,value:w}}),ob({tournamentRecord:d}),S){let e={};for(let i of b)e[i]=(null==(n=T.drawDetails)?void 0:n[i])??{published:!0};let t=bR({statusObject:{drawDetails:e},event:l});if(t.error)return{error:t.error}}if(U.length)if(Da(np)){let e=d.tournamentId;Ia({topic:np,payload:{tournamentId:e,detail:U}});let t=((null==(a=null==(r=am({element:l,itemType:Vd}))?void 0:r.timeItem)?void 0:a.itemValue)||0)+1;nS({element:l,timeItem:{itemType:Vd,itemValue:t},removePriorValues:!0})}else!function({appliedPolicies:e,event:t,deletedDrawsDetail:i,auditData:n}){var r;if(!1===(null==(r=null==e?void 0:e.audit)?void 0:r[Vd]))return;let{extension:a}=Cd({name:Vd,element:t}),o={...n,deletedDrawsDetail:i},s={value:Array.isArray(null==a?void 0:a.value)?null==a?void 0:a.value.concat(o):[o],name:Vd};Sd({element:t,extension:s})}({appliedPolicies:f,event:l,deletedDrawsDetail:g,auditData:c});if(I.length&&Ep({tournamentId:null==d?void 0:d.tournamentId,matchUpIds:I}),s.forEach((e=>function({tournamentId:e,eventId:t,drawId:i}){return Ia({payload:{drawId:i,tournamentId:e,eventId:t},topic:sp,key:i}),Sa({key:i}),{...At}}({drawId:e}))),u&&S){let t=RR({...e.eventDataParams,drawIdsToRemove:s,policyDefinitions:h,tournamentRecord:d,event:l});if(t.error)return{...At,info:t.error}}return{...At}}function OR({autoPublish:e=!0,tournamentRecord:t,auditData:i,event:n,force:r}){var a;if(!t)return{error:Bt};if(!n)return{error:bi};let{flightProfile:o}=Eh({event:n});if(o){let s=null==(a=o.flights)?void 0:a.map((({drawId:e})=>e)).filter(Boolean),l=CR({eventId:n.eventId,tournamentRecord:t,autoPublish:e,auditData:i,drawIds:s,event:n,force:r});return l.error?l:Nd({event:n,name:Gd})}return{...At}}function kR(e){let{matchUpFormat:t,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=e,o=(null==e?void 0:e.tournamentRecords)??((null==e?void 0:e.tournamentRecord)&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Lt};let s,l=Object.keys(o).filter((e=>!r||r===e));if(r&&!l.includes(r))return{error:Cr};for(let u of l){let e=o[u],{event:r}=Ch({tournamentRecord:e,eventId:a});a&&r&&(s=!0);let l=FR({tournamentRecord:e,event:r,matchUpFormat:t,averageTimes:n,recoveryTimes:i});if(l.error)return l}return!a||s?{...At}:{error:Ri}}function FR({tournamentRecord:e,recoveryTimes:t,matchUpFormat:i,averageTimes:n,event:r}){if(!e)return{error:Bt};if(n&&!Array.isArray(n))return{error:Cr};if(t&&!Array.isArray(t))return{error:Cr};let a=Zd;if(r){let{extension:e}=Cd({element:r,name:a});Sd({element:r,extension:{name:a,value:xR({...(null==e?void 0:e.value)||{},matchUpFormat:i,averageTimes:n,recoveryTimes:t})}})}else{let{extension:r}=Cd({element:e,name:a});Sd({extension:{name:a,value:xR({...(null==r?void 0:r.value)||{},matchUpFormat:i,averageTimes:n,recoveryTimes:t})},element:e})}return{...At}}function xR(e){let{matchUpRecoveryTimes:t=[],matchUpAverageTimes:i=[],matchUpFormat:n}=e,{averageTimes:r,recoveryTimes:a}=e;r=(r||[]).filter((e=>{var t,i;return(null==(t=null==e?void 0:e.categoryNames)?void 0:t.length)||(null==(i=null==e?void 0:e.categoryTypes)?void 0:i.length)}));let o=(null==r?void 0:r.length)&&i.map((e=>{var t;return null!=e&&e.matchUpFormatCodes.includes(n)?{...e,matchUpFormatCodes:null==(t=e.matchUpFormatCodes)?void 0:t.filter((e=>e!==n))}:e})).filter((({matchUpFormatCodes:e})=>null==e?void 0:e.length)).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter((e=>{var t,i;return(null==(t=null==e?void 0:e.categoryNames)?void 0:t.length)||(null==(i=null==e?void 0:e.categoryTypes)?void 0:i.length)}));let s=(null==a?void 0:a.length)&&t.map((e=>{var t;return null!=e&&e.matchUpFormatCodes.includes(n)?{...e,matchUpFormatCodes:null==(t=e.matchUpFormatCodes)?void 0:t.filter((e=>e!==n))}:e})).filter((({matchUpFormatCodes:e,averageTimes:t})=>(null==e?void 0:e.length)||t)).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(null==o?void 0:o.length)&&o||i,matchUpRecoveryTimes:(null==s?void 0:s.length)&&s||t}}function _R(e){let{tournamentRecord:t,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:o,event:s}=e;if(!t)return{error:Bt};if(!co({matchUpFormat:r}))return{error:Cr};if(!s)return{error:bi};let{averageTimes:l=[],recoveryTimes:u=[]}=bb({tournamentRecord:t,matchUpFormat:r,event:s}),d=s.category,c=(null==d?void 0:d.categoryName)||(null==d?void 0:d.ageCategoryCode)||(null==s?void 0:s.eventId),p={categoryNames:[c],minutes:{}},m={categoryNames:[c],minutes:{}},f=e=>{var t,i;if(null!=(t=e.categoryTypes)&&t.includes(a)&&console.log("encountered:",{categoryType:a}),null==(i=e.categoryNames)||!i.includes(c)||(e.categoryNames=e.categoryNames.filter((e=>e!==c)),p={minutes:e.minutes,categoryNames:[c]},e.categoryNames.length))return e},h=n&&!isNaN(Be(n)),v=i&&!isNaN(Be(i)),g=l.map(f).filter((e=>{var t;return null==(t=null==e?void 0:e.categoryNames)?void 0:t.length})),I=u.map(f).filter((e=>{var t;return null==(t=null==e?void 0:e.categoryNames)?void 0:t.length}));return h&&(Object.assign(p.minutes,{[(null==s?void 0:s.eventType)||Ee]:n}),g.push(p)),v&&(Object.assign(m.minutes,{[(null==s?void 0:s.eventType)||Ee]:i}),I.push(m)),h||v?kR({averageTimes:h&&g,recoveryTimes:v&&I,tournamentRecord:t,matchUpFormat:r,eventId:o,event:s}):{error:Cr}}function LR(e){if(e.event)return BR({event:e.event});{e.tournamentRecord&&!e.tournamentRecords&&(e.tournamentRecords={[e.tournamentRecord.tournamentId]:e.tournamentRecord});let t=qu(e,[{[nu]:!0,[bu]:!0}]);if(t.error)return t;let{tournamentRecords:i,eventId:n}=e;for(let e of Object.values(i??{})){let{event:t}=Ch({tournamentRecord:e,eventId:n});if(t)return BR({event:t})}}return{error:Ri}}function BR({event:e}){return Nd({event:e,name:Zd})}var VR={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function jR(e){return!(!Array.isArray(e)||Qe(e).length!==e.length)&&e.every((e=>Object.keys(VR).includes(e)))}function GR({tournamentRecord:e,event:t,startDate:i}){if(!e)return{error:Bt};if(!t)return{error:bi};if(!fo.test(i))return{error:vn};let n=WR(e);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Eo(i)).getTime();if(!r||!a||o<r||o>a)return{error:vn};let s=t.endDate&&new Date(Eo(t.endDate)).getTime();return s&&o>s&&(t.endDate=i),t.startDate=i,{...At}}function $R(e){let{tournamentRecord:t,event:i,endDate:n}=e;if(!t)return{error:Bt};if(!i)return{error:bi};if(!fo.test(n))return{error:vn};let r=WR(t);if(r.error)return r;let{tournamentStartDate:a,tournamentEndDate:o}=r,s=new Date(Eo(n)).getTime();if(!a||!o||s<a||s>o)return{error:vn};let l=i.startDate&&new Date(Eo(i.startDate)).getTime();return l&&s<l&&(i.startDate=n),i.endDate=n,{...At}}function qR(e){var t;let i=qu(e,[{tournamentRecord:!0,event:!0},{[Fu]:e=>fo.test(e),[_u]:vn,startDate:!1,endDate:!1},{[Fu]:e=>e.filter(Boolean).every((e=>fo.test(e))),[_u]:vn,activeDates:!1},{[Fu]:jR,weekdays:!1}]);if(i.error)return i;let{tournamentRecord:n,weekdays:r,event:a,startDate:o,endDate:s}=e,l=null==(t=e.activeDates)?void 0:t.filter(Boolean);if(o&&s){if(new Date(Eo(o)).getTime()>new Date(Eo(s)).getTime())return{error:Cr}}if(l){let e=o||n.startDate,t=s||n.endDate,i=!e||l.every((t=>new Date(t)>=new Date(e))),r=!t||l.every((e=>new Date(e)<=new Date(t)));if(!i||!r)return{error:vn}}if(o){let e=GR({tournamentRecord:n,event:a,startDate:o});if(e.error)return e}if(s){let e=$R({tournamentRecord:n,event:a,endDate:s});if(e.error)return e}return l&&(a.activeDates=l),r&&(a.weekdays=r),{...At}}function WR(e){let{startDate:t,endDate:i}=e;return fo.test(t)&&fo.test(i)?{tournamentStartDate:new Date(Eo(t)).getTime(),tournamentEndDate:new Date(Eo(i)).getTime()}:La({result:{error:In},context:{startDate:t,endDate:i}})}function HR({event:e,orderedDrawIdsMap:t}){var i,n;if("object"!=typeof e)return{error:bi};if(!t)return{error:un,info:"Missing drawIdsOrderMap"};if("object"!=typeof t)return{error:Cr,info:"orderedDrawIdsMap must be an object"};let r=Object.values(t);if(!r.every((e=>!isNaN(e))))return{error:Cr,info:"drawOrder must be numeric"};if(Qe(r).length!==r.length)return{error:Cr,info:"drawOrder values must be unique"};if(null!=(i=e.drawDefinitions)&&i.length){let i=(e.drawDefinitions||[]).map((({drawId:e})=>e)),n=Object.keys(t);if(null!=n&&n.length&&dt(i,n).length!==i.length)return{error:Cr,info:"Missing drawIds"};e.drawDefinitions.forEach((e=>{e.drawOrder=t[e.drawId]}))}let{flightProfile:a}=Eh({event:e});return null==(n=null==a?void 0:a.flights)||n.forEach((e=>{e.flightNumber=t[e.drawId]})),{...At}}function zR({tournamentRecord:e,event:t}){var i;if(!e)return{error:Bt};if(!t)return{error:bi};let{flightProfile:n}=Eh({event:t}),r=(null==n?void 0:n.flights)&&Object.assign({},...n.flights.sort(((e,t)=>e.flightNumber-t.flightNumber)).map(((e,t)=>({[e.drawId]:t+1}))))||(null==(i=t.drawDefinitions)?void 0:i.length)&&Object.assign({},...t.drawDefinitions.sort(((e,t)=>e.drawOrder-t.drawOrder)).map(((e,t)=>({[e.drawId]:t+1}))))||void 0;return r?HR({event:t,orderedDrawIdsMap:r}):{...At}}function YR({autoPublish:e=!0,tournamentRecord:t,auditData:i,drawId:n,event:r,force:a}){var o,s;if(!t)return{error:Bt};if(!n)return{error:li};if(!r)return{error:bi};let{flightProfile:l}=Eh({event:r});if(l&&null!=(o=l.flights)&&o.find((e=>e.drawId===n))){let e=l.flights.filter((e=>e.drawId!==n));Dd({event:r,extension:{name:Gd,value:{...l,flights:e}}})}if(null!=(s=r.drawDefinitions)&&s.find((e=>e.drawId===n))){let o=CR({drawIds:[n],eventId:r.eventId,tournamentRecord:t,autoPublish:e,auditData:i,event:r,force:a});if(o.error)return o}return zR({tournamentRecord:t,event:r})}function KR(e){var t,i;let n=qu(e,[{[Au]:!0,[au]:!0,[Cu]:!1},{replacementIndividualParticipantId:!0,[Fu]:e=>St(e),existingIndividualParticipantId:!0,[Mu]:xn,participantId:!0}]),{replacementIndividualParticipantId:r,existingIndividualParticipantId:a,tournamentRecord:o,drawDefinition:s,participantId:l,event:u,uuids:d}=e;if(n.error)return n;if((null==u?void 0:u.eventType)!==Qs)return{error:Ti};if(!((null==(t=null==u?void 0:u.entries)?void 0:t.filter((({entryStatus:e})=>[Vm,jm].includes(e))).map((({participantId:e})=>e)))||[]).includes(r))return{error:Mn};let c=(o.participants||[]).find((e=>e.participantId===l));if((null==c?void 0:c.participantType)!==Kp)return{error:Nn,participant:c};let p,m=c.individualParticipantIds,f=[r,...m.filter((e=>e!==a))],{participant:h}=Fh({participantIds:f,tournamentRecord:o});if(h)p=h.participantId;else{let e=vR({participant:{participantId:null==d?void 0:d.pop(),participantRole:sg,individualParticipantIds:f,participantType:Kp},returnParticipant:!0,tournamentRecord:o});if(e.error)return e;p=e.participant.participantId}let{flightProfile:v}=Eh({event:u});if(s){let e=null==(i=null==v?void 0:v.flights)?void 0:i.find((({drawId:e})=>e===s.drawId));e&&(e.drawEntries=e.drawEntries.map((e=>e.participantId===l?{...e,participantId:p}:e))),s.entries=s.entries.map((e=>e.participantId===l?{...e,participantId:p}:e));for(let t of s.structures||[])if(t.structures){t.positionAssignments=void 0;for(let e of t.structures)e.positionAssignments=e.positionAssignments.map((e=>e.participantId===l?{...e,participantId:p}:e))}else t.positionAssignments&&(t.positionAssignments=t.positionAssignments.map((e=>e.participantId===l?{...e,participantId:p}:e)))}u.entries=u.entries.map((e=>e.participantId===l&&{...e,participantId:p}||e.participantId===r&&{...e,participantId:a}||e));let g=o.events.some((({entries:e,eventId:t,drawDefinitions:i})=>u.eventId===t?i.some((({drawId:e,entries:t})=>e!==(null==s?void 0:s.drawId)&&(null==t?void 0:t.find((e=>e.participantId===l))))):null==e?void 0:e.find((e=>e.participantId===l))));if(!g){let e=gg({addIndividualParticipantsToEvents:!1,participantIds:[l],tournamentRecord:o});if(e.error)return e}return{...At,participantOtherEntries:g,newPairParticipantId:p}}function JR(e){var t,i,n,r,a,o,s,l,u,d,c,p;let{flight:m,suppressNotifications:f,modifyEventEntries:h,existingDrawCount:v,allowReplacement:g,checkEntryStatus:I,tournamentRecord:U,drawDefinition:y,event:S}=e;if(!y)return{error:$t};if(!S)return{error:bi};S.drawDefinitions||(S.drawDefinitions=[]);let{drawId:w,drawName:P,entries:D}=y,{entries:T}=S,b=0;if(void 0!==v&&v!==S.drawDefinitions.length)return{error:Cr,info:"drawDefintions count mismatch"};let{flightProfile:R}=Eh({event:S}),N=m&&(null==(t=null==R?void 0:R.flights)?void 0:t.find((e=>e.flightNumber===m.flightNumber))),M=null==(r=null==(n=null==(i=null==R?void 0:R.links)?void 0:i.find((e=>{var t;return(null==(t=null==e?void 0:e.target)?void 0:t.drawId)===w})))?void 0:n.source)?void 0:r.drawId;if(M&&!S.drawDefinitions.find((e=>e.drawId===M)))return La({result:{error:$t},info:{sourceDrawId:M}});if(N&&N.drawId!==y.drawId)return La({result:{error:Gt},info:{relevantFlight:N}});let A=null==D?void 0:D.every((({participantId:e,entryStatus:t})=>{let i=null==N?void 0:N.drawEntries.find((t=>t.participantId===e));return!t||(null==i?void 0:i.entryStatus)===t})),E=!I||T&&(null==D?void 0:D.every((({participantId:e,entryStatus:t,entryStage:i})=>{var n;return(null==(n=T.find((t=>t.participantId===e&&(!t.entryStage||t.entryStage===i))))?void 0:n.entryStatus)===t})));if(N&&!A)return La({result:{error:Gt},context:{drawEntriesPresentInFlight:A,matchingEventEntries:E,relevantFlight:N},info:"Draw entries are not present in flight or do not match entryStatuses"});if(h&&(null==D||D.filter(Boolean).forEach((e=>{if(null!=e&&e.entryStatus&&zm.includes(null==e?void 0:e.entryStatus)){let t=null==T?void 0:T.filter(Boolean).find((t=>t.participantId===e.participantId));t&&e.entryStatus&&(null==t?void 0:t.entryStatus)!==e.entryStatus&&(t.entryStatus=e.entryStatus,b+=1)}}))),T&&!E)return La({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:E,eventEntries:T},error:Gt}});let C,O=(null==(o=null==(a=null==R?void 0:R.flights)?void 0:a.map((({flightNumber:e})=>!isNaN(e)&&Be(e))))?void 0:o.filter(Boolean))||[],k=(null==(s=S.drawDefinitions.map((({drawOrder:e})=>e&&Be(e))))?void 0:s.filter(Boolean))||[],F=Math.max(0,...k,...O)+1,x=null==(l=null==R?void 0:R.flights)?void 0:l.find((e=>e.drawId===w));if(x){x.drawName=y.drawName,C={name:Gd,value:{...R,flights:R.flights}};let e=x.flightNumber;e&&!k.includes(e)?F=e:x.flightNumber=F}else{let e=(null==R?void 0:R.flights)||[];e.push({manuallyAdded:!0,flightNumber:F,drawEntries:D,drawName:P,drawId:w}),C={name:Gd,value:{...R||{},flights:e}}}Dd({event:S,extension:C}),Object.assign(y,{drawOrder:F});let _=S.drawDefinitions.find((e=>e.drawId===w)),L=null==U?void 0:U.tournamentId,B=S.eventId;if(_){if(!g)return{error:ui};let e=(null==(d=null==(u=nv({drawDefinition:_}))?void 0:u.matchUps)?void 0:d.map(vc))??[],t=null==(c=nv({drawDefinition:y}))?void 0:c.matchUps;if(!f){null!=e&&e.length&&Ep({matchUpIds:e,action:"modifyDrawDefinition",tournamentId:L,eventId:B}),null!=t&&t.length&&Ap({matchUps:t,tournamentId:L,eventId:B}),S.drawDefinitions=S.drawDefinitions.map((e=>e.drawId===w?y:e));let i=null==(p=y.structures)?void 0:p.map((({structureId:e})=>e));kp({drawDefinition:y,tournamentId:L,structureIds:i,eventId:B})}}else if(S.drawDefinitions.push(y),!f){let{matchUps:e}=nv({drawDefinition:y,event:S});e&&Ap({tournamentId:null==U?void 0:U.tournamentId,matchUps:e}),Op({drawDefinition:y,tournamentId:L,eventId:B})}return{...At,modifiedEventEntryStatusCount:b}}function QR(e){let{provisionalPositioning:t,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=e,d=0;if(null==s||!s.length)return{error:Ei};if(!n)return{error:Bt};if(!l)return{error:li};let c=Xm({provisionalPositioning:t,drawDefinition:r,structureId:o});if(c.error)return c;let{seedAssignments:p,seedLimit:m}=c,f=Object.assign({},...(p??[]).filter((e=>e.seedNumber)).map((e=>({[e.seedNumber]:e}))));s.forEach((e=>{let{seedNumber:t}=e;m&&t<=m&&(!i||f[t])&&(f[t]=e)}));let h=Object.values(f),v=h.map((e=>null==e?void 0:e.participantId)).filter(Boolean);if(v.length!==at(v).length)return{error:di};for(let g of h){let e=Wg({...g,provisionalPositioning:t,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,event:u});if(null!=e&&e.error)return e;null!=e&&e.success&&d++}return d?{...At,modifications:d}:{error:Dr}}function ZR({deleteExisting:e,event:t,flightProfile:i}){var n;let r="attachFlightProfile";if(!i)return La({result:{error:un},stack:r});if(!t)return La({result:{error:bi},stack:r});let{flightProfile:a}=Eh({event:t});return a&&!e?La({result:{error:jr},stack:r}):null!=(n=t.drawDefinitions)&&n.length?La({result:{error:qt},stack:r}):(Dd({event:t,extension:{name:Gd,value:i}}),{flightProfile:ts(i,!1,!0),...At})}function XR({tournamentRecord:e,scaleAttributes:t,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:o}){var s;if(!a)return{error:bi};if(n&&!Array.isArray(n))return La({result:{error:Cr},info:eI("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(r){let{flightProfile:e}=Eh({event:a}),t=null==(s=null==e?void 0:e.flights)?void 0:s.find((e=>e.drawId===r));l=t?t.drawEntries:null==i?void 0:i.entries}return function({tournamentRecord:e,scaleAttributes:t,participantIds:i}){var n;if(!e)return{error:Bt};if(!i)return{error:Vn};if(!t)return{error:un,info:"scaleAttributes required"};let{scaleType:r,eventType:a,scaleName:o}=t,s=[qf,r,a,o].join(".");return null==(n=e.participants)||n.forEach((e=>{i.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter((e=>e&&(null==e?void 0:e.itemType)!==s)))})),{...At}}({tournamentRecord:e,scaleAttributes:t,participantIds:(l||[]).filter((e=>(!o||!e.entryStage||e.entryStage===o)&&(!n||n.includes(e.entryStatus)))).map(hc)})}function eN({removePriorValues:e,tournamentRecord:t,displaySettings:i,status:n=Kf,event:r}){if(!t)return La({result:{error:Bt}});if(!r)return La({result:{error:bi}});if(!wt(i))return La({result:{error:un}});if(wt(i.draws))for(let o of Object.keys(i.draws)){let e=i.draws[o].scheduleDetails??[];if(e.length){let t=[];for(let i of e){let e=t.find((e=>Pt(e.attributes,i.attributes)));null!=e&&e.dates&&i.dates?e.dates.push(...i.dates):t.push(i)}i.draws[o].scheduleDetails=t}}let a=bR({statusObject:{displaySettings:i},removePriorValues:e,status:n,event:r});return a.error?a:{...At}}function tN({tournamentRecord:e,drawDefinition:t,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:o}){var s,l;if(!e)return{error:Bt};if(!a)return{error:bi};return n=n||(null==(s=a.category)?void 0:s.categoryName)||(null==(l=a.category)?void 0:l.ageCategoryCode),XR({tournamentRecord:e,scaleAttributes:{eventType:a.eventType,scaleType:Ju,scaleName:n},drawDefinition:t,entryStatuses:i,drawId:r,event:a,stage:o})}function iN(e){let t=qu(e,[{[au]:!0},{eventIds:!0,[Lu]:ku}]);if(t.error)return t;let{removePairParticipants:i,tournamentRecord:n,eventIds:r}=e,a=[],o=[],s=[],l=[];if(n.events=(n.events||[]).filter((e=>{if(r.includes(e.eventId)){let t={action:AR,payload:{events:[e]}};a.push(t),o.push({tournamentId:n.tournamentId,eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}let t=e.eventType===Qs?(e.entries||[]).map((({entryStatus:e,participantId:t})=>e!==Vm&&t)).filter(Boolean):[],i=r.includes(e.eventId);return i?l.push(...t):s.push(...t),!i})),i){let e=l.filter((e=>!s.includes(e)));n.participants=n.participants.filter((({participantId:t})=>!e.includes(t)))}if(ob({tournamentRecord:n}),a.length)if(Da(np)){let e=n.tournamentId;Ia({topic:np,payload:{type:AR,tournamentId:e,detail:a}})}else aS({tournamentRecord:n,timeItem:{itemValue:o,itemType:AR}});return{...At}}function nN(e){var t,i,n;let r=qu(e,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Ou}]);if(r.error)return r;let{eventUpdates:a,event:o}=e,s="modifyEvent",l=function(e){var t;let{tournamentRecord:i,event:n}=e,r=(null==(t=null==n?void 0:n.entries)?void 0:t.filter((({entryStatus:e})=>{let t=e;return[...zm,Em].includes(t)})).map((({participantId:e})=>e)))??[];return r?zv({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:i}).participants??[]:[]}(e),u=function({enteredParticipants:e}){let t=[],i=e.reduce(((e,i)=>{var n,r;let a=null!=(n=i.person)&&n.sex?[i.person.sex]:(null==(r=i.individualParticpants)?void 0:r.map((e=>{var t;return null==(t=e.person)?void 0:t.sex})))||[];return t.push(...a),e.includes(i.participantType)?e:e.concat(i.participantType)}),[]),n=Qe(t);return{enteredParticipantTypes:i,enteredParticipantGenders:n}}({enteredParticipants:l}),{enteredParticipantGenders:d,enteredParticipantTypes:c}=u,p=null==(i=null==(t=Eh({event:o}))?void 0:t.flightProfile)?void 0:i.flights,m=function({noFlightsNoDraws:e,enteredParticipantGenders:t,eventUpdates:i,stack:n}){let r=!t.length||!i.gender||i.gender===Ba||1===t.length&&t[0]===i.gender||e&&i.gender===ja;return i.gender&&!r?La({context:{gender:i.gender,validGender:r},result:{error:Ar},stack:n}):{...At}}({noFlightsNoDraws:!(null!=(n=o.drawDefinitions)&&n.length||null!=p&&p.length),enteredParticipantGenders:d,eventUpdates:a,stack:s});if(m.error)return m;let f=function({enteredParticipantTypes:e,eventUpdates:t,stack:i}){let n=(e.includes(Xs)&&[Xs]||e.includes(zp)&&[Ks]||e.includes(Kp)&&[Qs]||[Qs,Ks,Xs]).includes(t.eventType??"");return t.eventType&&!n?La({context:{participantType:t.eventType,validEventType:n},result:{error:Ti},stack:i}):{...At}}({enteredParticipantTypes:c,eventUpdates:a,stack:s});if(f.error)return f;let h=function(e){var t,i,n,r,a,o;let s=null==(t=e.eventUpdates)?void 0:t.category;if(!s)return{...At};let l=zo({category:s});if(l.error)return l;if(e.event.eventType===Xs){let t=(null==(n=null==(i=e.event)?void 0:i.drawDefinitions)?void 0:n.map((e=>ef(e))))??[],a=ef(e.event),o=((null==(r=Xh(e))?void 0:r.matchUps)??[]).map((e=>ef(e)))??[];if(![a,...t,...o].filter(Boolean).every((t=>t.collectionDefinitions.every((t=>!t.category||Yo({category:e.eventUpdates.category,childCategory:t.category}))))))return La({result:{error:Er},stack:e.stack})}if(null!=(a=e.enteredParticipants)&&a.length){let t=e.eventUpdates.startDate||e.event.startDate||e.tournamentRecord.startDate,i=e.eventUpdates.endDate||e.event.endDate||e.tournamentRecord.endDate,n=e.enteredParticipants.map((e=>e.participantType===zp?e:e.individualParticpants??[])).flat(),r=Ho({category:s,consideredDate:t}),a=Ho({category:s,consideredDate:i});if(null!=r&&r.ageMinDate||null!=r&&r.ageMaxDate||null!=a&&a.ageMinDate||null!=a&&a.ageMaxDate)for(let s of n){let t=null==(o=s.person)?void 0:o.birthDate;if(!t)return La({result:{error:dn},stack:e.stack});let i=new Date(t).getTime();if(r.ageMinDate||r.ageMaxDate){let t=new Date(r.ageMinDate).getTime(),n=new Date(r.ageMaxDate).getTime();if(i<t||i>n)return La({result:{error:bn},stack:e.stack})}if(a.ageMin||a.ageMax){let t=new Date(a.ageMinDate).getTime(),n=new Date(a.ageMaxDate).getTime();if(i<t||i>n)return La({result:{error:bn},stack:e.stack})}}}return{...At}}({...e,...u,enteredParticipants:l,stack:s});if(h.error)return h;let v=function(e){let{tournamentRecord:t,eventUpdates:i,event:n,stack:r}=e;if(i.startDate||i.endDate){let e=qR({startDate:i.startDate,endDate:i.endDate,tournamentRecord:t,event:n});if(e.error)return La({result:e,stack:r})}return{...At}}({...e,stack:s});return v.error?v:(a.eventType&&(o.eventType=a.eventType),a.eventName&&(o.eventName=a.eventName),a.gender&&(o.gender=a.gender),{...At})}function rN({qualifyingPositions:e,drawEntries:t=[],drawName:i,drawId:n,event:r,stage:a}){var o,s,l;let u="addFlight";if(!r)return La({result:{error:bi},stack:u});if(!i)return La({result:{error:un},stack:u});if(null!=t&&t.length){let e=(r.entries??[]).map(hc),i=t.map(hc);if(dt(i,e).length!==i.length)return La({result:{error:Cr},stack:u})}let d=null==(o=Eh({event:r}))?void 0:o.flightProfile,c=(null==(l=null==(s=null==d?void 0:d.flights)?void 0:s.map((({flightNumber:e})=>!isNaN(e)&&Be(e))))?void 0:l.filter(Boolean))||[],p=Math.max(0,...c)+1,m={drawId:n||rs(),flightNumber:p,drawEntries:t,drawName:i};if(a&&(m.stage=a),e&&(m.qualifyingPositions=e),((null==d?void 0:d.flights)||[]).find((({drawId:e})=>e===m.drawId)))return La({result:{error:Vr},stack:u});let f=((null==d?void 0:d.flights)||[]).concat(m);return Dd({event:r,extension:{name:Gd,value:{...d||{},flights:f}}})}var aN={};be(aN,{drawMatic:()=>qD,garman:()=>wN,generateAdHocMatchUps:()=>kw,generateAdHocRounds:()=>GD,generateAndPopulatePlayoffStructures:()=>tS,generateCourts:()=>SN,generateDrawDefinition:()=>aR,generateDrawMaticRound:()=>qw,generateDrawStructuresAndLinks:()=>ww,generateDrawTypeAndModifyDrawDefinition:()=>Pw,generateFlightProfile:()=>uN,generateLineUps:()=>yN,generateQualifyingStructure:()=>BU,generateSeedingScaleItems:()=>oR,generateStatCrew:()=>pN,generateVoluntaryConsolation:()=>Ww,roundRobinGroups:()=>Cg});var oN="splitWaterfall",sN="splitShuttle",lN={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:oN,SPLIT_SHUTTLE:sN};function uN(e){let{drawNameRoot:t="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:d,uuids:c=[],event:p,stage:m}=e;if(!p)return{error:bi};let f=p.entries??[],{flightProfile:h}=Eh({event:p});if(h&&i&&!o)return{error:jr};let v=e.scaledEntries??HD({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,g=v.map(hc),I=Xe(f.filter((({participantId:e})=>!g.includes(e))).filter((e=>(!m||!e.entryStage||e.entryStage===m)&&(!e.entryStatus||Hm.includes(e.entryStatus))))),U=v.concat(...I),y=U.length,S=ht(U,Math.ceil(y/u));function w(e){return(e||[]).map((({participantId:e,scaleValue:t})=>{let i=f.find((t=>t.participantId===e));return null!=i&&i.scaleValue&&t&&(i.scaleValue=t),i})).sort(((e,t)=>e.scaleValue-t.scaleValue)).map(((e,t)=>(e.scaleValue&&(e.seedNumber=t+1),e)))}d===oN?S=Ut(U,u):d===sN&&(S=Ut(U,u,!0));let P={scaleAttributes:r,splitMethod:d,flights:lt(0,u).map((e=>{let i=e+1;return{flightNumber:i,drawId:(null==c?void 0:c.pop())??rs(),drawEntries:w(S[e]),drawName:(null==l?void 0:l.length)&&l[e]||`${t} ${i}`}}))};if(i){let e=ZR({flightProfile:P,deleteExisting:o,event:p});return{splitEntries:aa()&&S||void 0,...e}}return{flightProfile:P,...At}}function dN({json:e,tagName:t}){let i=Object.keys(e).filter((t=>Array.isArray(e[t]))).map((t=>({key:t,value:e[t].filter((e=>"object"==typeof e&&1===Object.keys(e).length))}))),n=Object.keys(e).filter((t=>"object"==typeof e[t]&&!Array.isArray(e[t]))).map((t=>({key:t,value:e[t]})));return cN({tagName:t,attributes:Object.keys(e).filter((t=>["string","number"].includes(typeof e[t]))).map((t=>({key:t,value:e[t]}))),childArrays:i,childObjects:n})}function cN(e){let{tagName:t,attributes:i=[],childArrays:n=[],childObjects:r}=e,a="\r\n",o=e=>{let t=Object.keys(e)[0];return{key:t,value:e[t]}},s=null==n?void 0:n.map((({key:e,value:t})=>cN({tagName:e,childObjects:t.map(o)}))).join("\r\n"),l=null==r?void 0:r.map((({key:e,value:t})=>dN({tagName:e,json:t??[]}))).join("\r\n"),u=null==i?void 0:i.map((({key:e,value:t})=>`${e}="${t}"`)).join(" ");return"childArray"===t?l:`<${t}${u?` ${u}`:""}>${null!=l&&l.length?`${a}${l}${a}`:""}${null!=s&&s.length?`${a}${s}${a}`:""}</${t}>`}function pN(e){var t,i,n;let r=qu(e,[{[au]:!0}]);if(r.error)return r;let{tournamentRecord:a}=e,{startDate:o,tournamentId:s,tournamentName:l}=a,{participantMap:u,matchUps:d,mappedMatchUps:c}=zv({withMatchUps:!0,withEvents:!0,tournamentRecord:a}),p=a.participants.filter((e=>e.participantType===Jp)),m=(null==d?void 0:d.filter((e=>e.matchUpType===Jp)))??[],f=(null==m?void 0:m.reduce(((e,t)=>{let i=(null==t?void 0:t.tieMatchUps)??[];return i&&[...e,...i]}),[]))??[],h=(null==d?void 0:d.filter((e=>e.matchUpType===Ee)))??[],v=(null==d?void 0:d.filter((e=>e.matchUpType===Oe)))??[],g=f.length===h.length+v.length,I=1===m.length&&g,U={mappedMatchUps:c,participantMap:u,tournamentName:l,tournamentId:s,tournament:g?"N":"Y",startDate:o},y=[],S=[];if(I){let e=m[0],{json:t,xml:i}=mN({teamParticipants:p,teamMatchUp:e,...U,doubles:v,singles:h});S.push(t),y.push(i)}else for(let w of m){let e=null==(t=null==w?void 0:w.sides)?void 0:t.map((({participant:e})=>null==e?void 0:e.participantId)).filter(Boolean);if(2!==(null==e?void 0:e.length))continue;let r=e.map((e=>{var t;return e&&(null==(t=null==u?void 0:u[e])?void 0:t.participant)})),{xml:a,json:o}=mN({doubles:null==(i=w.tieMatchUps)?void 0:i.filter((e=>e.matchUpType===Oe)),singles:null==(n=w.tieMatchUps)?void 0:n.filter((e=>e.matchUpType===Ee)),teamParticipants:r,teamMatchUp:w,...U});S.push(o),y.push(a)}return{json:S,xml:y,...At}}function mN({teamParticipants:e,mappedMatchUps:t,participantMap:i,tournamentName:n,tournamentId:r,teamMatchUp:a,tournament:o,startDate:s,doubles:l,singles:u}){var d,c,p,m;let f=null==e?void 0:e.find((e=>{var t;return null==(t=e.participantRoleResponsibilities)?void 0:t.includes("Home")})),h=null==e?void 0:e.filter((e=>e.participantId!==(null==f?void 0:f.participantId))),v=So(s,"/","MDY"),g=(null==f?void 0:f.participantName)||(null==(d=null==h?void 0:h[1])?void 0:d.participantName),I=(null==f?void 0:f.participantId)||(null==(c=null==h?void 0:h[1])?void 0:c.participantId),U=null==(p=null==h?void 0:h[0])?void 0:p.participantName,y=null==(m=null==h?void 0:h[0])?void 0:m.participantId,S={},w=e.map((e=>({team:{...hN({teamParticipant:e,teamMatchUp:a,uniValues:S,participantMap:i,mappedMatchUps:t,homeid:I})}}))),P=_a({venue:{tournamentname:o?n:void 0,neutralgame:f?"N":"Y",gameid:r,officials:{},tournament:o,rules:{},homename:g,visname:U,homeid:I,visid:y,date:v},childArray:w,singles_matches:null==u?void 0:u.map((e=>vN({matchUp:e,homeid:I,uniValues:S}))),doubles_matches:null==l?void 0:l.map((e=>vN({matchUp:e,homeid:I,uniValues:S})))});return{json:P,xml:dN({json:P,tagName:"tngame"})}}function fN({homeid:e,uniValues:t,participant:i}){var n,r,a,o,s,l,u,d,c,p,m,f,h,v,g;if(!i)return{};let I=2===(null==(n=i.individualParticipants)?void 0:n.length),U=I?Qe(null==(r=i.individualParticipants)?void 0:r.map((e=>{var t,i;return null==(i=null==(t=e.teams)?void 0:t[0])?void 0:i.participantId}))):[],y=I?Qe(null==(a=i.individualParticipants)?void 0:a.map((e=>{var t,i;return null==(i=null==(t=e.teams)?void 0:t[0])?void 0:i.teamId}))):[],S=!I&&(null==(s=null==(o=i.teams)?void 0:o[0])?void 0:s.participantId)||1===(null==U?void 0:U.length)&&U[0]||void 0,w=!I&&(null==(u=null==(l=i.teams)?void 0:l[0])?void 0:u.teamId)||1===(null==y?void 0:y.length)&&y[0]||S,P=I?void 0:i.participantName,D=null==(c=null==(d=i.individualParticipants)?void 0:d[0])?void 0:c.participantName,T=null==(m=null==(p=i.individualParticipants)?void 0:p[1])?void 0:m.participantName;return _a({vh:e&&(S===e?"H":"V")||"",uni:I?void 0:t[S][i.participantId],uni_1:t[S][null==(h=null==(f=i.individualParticipants)?void 0:f[0])?void 0:h.participantId],uni_2:t[S][null==(g=null==(v=i.individualParticipants)?void 0:v[1])?void 0:g.participantId],team:w,name:P,name_1:D,name_2:T})}function hN({teamParticipant:e,teamMatchUp:t,participantMap:i,mappedMatchUps:n,homeid:r,uniValues:a}){var o,s,l,u,d,c,p,m,f,h,v,g,I,U;let{participantId:y,participantName:S}=e,w=r&&(y===r?"H":"V")||"",P=null==(o=null==i?void 0:i[y])?void 0:o.matchUps,D=P&&Object.keys(P),T=null==(l=null==(s=null==t?void 0:t.sides)?void 0:s.find((({participant:e})=>e.participantId===y)))?void 0:l.sideNumber,b=(null==(c=null==(d=null==(u=null==t?void 0:t.score)?void 0:u.sets)?void 0:d[0])?void 0:c[`side${T}Score`])??0;a[y]={};let R={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},N=[],M=[],A=0;for(let k of D??[]){let e=null==n?void 0:n[k],t=null==(p=e.sides.find((({participant:e})=>e.participantId===y)))?void 0:p.sideNumber;A+=(null==(h=null==(f=null==(m=e.score)?void 0:m.sets)?void 0:f[0])?void 0:h[`side${t}Score`])??0;for(let i of e.tieMatchUps??[]){let{matchUpType:e,winningSide:n}=i,r=n&&(n===t?"w":"l")||"";r&&(R[e][r]+=1);let a="w"===r?"1":"0",o="l"===r?"1":"0";if(e===Ee){let e=M.length+1;M.push({singles_pair:{pair:e,won:a,lost:o,tied:"0"}})}else if(e===Oe){let e=N.length+1;N.push({doubles_pair:{pair:e,won:a,lost:o,tied:"0"}})}}}let E=[{singles:{childArray:M,won:R.SINGLES.w,lost:R.SINGLES.l}},{doubles:{childArray:N,won:R.DOUBLES.w,lost:R.DOUBLES.l}}],C=[],O=1;for(let k of e.individualParticipantIds){let e=null==i?void 0:i[k];if(e){let{participant:t,counters:i}=e,n={won:(null==(v=null==i?void 0:i.DOUBLES)?void 0:v.wins)||0,lost:(null==(g=null==i?void 0:i.DOUBLES)?void 0:g.losses)||0},r={won:(null==(I=null==i?void 0:i.SINGLES)?void 0:I.wins)||0,lost:(null==(U=null==i?void 0:i.SINGLES)?void 0:U.losses)||0},{participantName:o,participantId:s}=t;a[y][s]=O,C.push({player:{name:o,uni:O,singles:r,doubles:n}})}O+=1}return{vh:w,id:y,name:S,score:b||A,totals:E,childArray:C}}function vN({matchUp:e,homeid:t,uniValues:i}){let{collectionPosition:n,orderOfFinish:r,matchUpType:a,sides:o}=e??{},s=null==o?void 0:o.map((n=>{var r;let{sideNumber:o,participant:s}=n,l=function({sets:e,sideNumber:t}){return Object.assign({},...(null==e?void 0:e.map((e=>{let{setNumber:i,side1Score:n,side2Score:r,side1TiebreakScore:a,side2TiebreakScore:o}=e;return{[`set_${i}`]:1===t?n:r,[`tie_${i}`]:1===t?a:o}})))??[])}({sets:null==(r=e.score)?void 0:r.sets,sideNumber:o});return{[a===Ee?"singles_score":"doubles_score"]:{...fN({homeid:t,uniValues:i,participant:s}),...l}}}));return{[a===Ee?"singles_match":"doubles_match"]:{match:n,order:r,childArray:s}}}var gN="ASC",IN="DESC",UN={ASC:"ASC",ASCENDING:gN,DESC:"DESC",DESCENDING:IN};function yN(e){var t,i,n,r,a;let{tieFormat:o}=e,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:u,scaleAccessor:d,singlesOnly:c,attach:p,event:m}=e;if((null==m?void 0:m.eventType)!==el)return{error:Ti};if(!l)return{error:Bt};if(!o&&!u)return{error:Wt};if(o=o??(null==(t=nf({drawDefinition:u,event:m}))?void 0:t.tieFormat),Jo({tieFormat:o}).error)return{error:ji};if("object"!=typeof d&&!s)return{error:Cr,context:{scaleAccessor:d}};let f={},h=((null==u?void 0:u.entries)??(null==m?void 0:m.entries)??[]).filter((e=>(null==e?void 0:e.entryStatus)===Om)).map(hc),{participants:v=[]}=zv({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),g=v.filter((({participantId:e})=>h.includes(e))),I=(null==(i=null==m?void 0:m.category)?void 0:i.categoryName)??(null==(n=null==m?void 0:m.category)?void 0:n.ageCategoryCode),{scaleName:U=I,scaleType:y=zu,sortOrder:S,accessor:w}=d||{},P=y===zu?"rankings":"ratings",D=(e,t)=>{var i,n,r;let a=null==(i=e[P])?void 0:i[t];if(!a&&s&&(a=null==(n=e[P])?void 0:n[Ae]),Array.isArray(a)){let e=null==(r=a.find((e=>e.scaleName===U)))?void 0:r.scaleValue;if(qe(e))return e;if(w&&"object"==typeof e)return e[w]}return 0},T=(e,t,i)=>{let n=S===IN?e:t;return D(S===IN?t:e,i)-D(n,i)},b=(e,t)=>T(e,t,Ae),R=(e,t)=>T(e,t,Ce),N=[],M=(null==o?void 0:o.collectionDefinitions)??[];for(let E of g){let e=(null==(r=E.individualParticipants)?void 0:r.sort(b))??[],t=c?e:(null==(a=E.individualParticipants)?void 0:a.sort(R))??[],i={};for(let r of M){let n=[],{collectionId:a,matchUpCount:o,matchUpType:s,gender:l}=r,u=Xf(Ae)(s);lt(0,o).forEach((r=>{let o=u?e:t??[],s=r+1,d=[];lt(0,u?1:2).forEach((e=>{var t;let r=null==(t=null==o?void 0:o.find((t=>{var i;let r=l&&([Va,$a].includes(l)&&l||l===ja&&[Va,$a][e]);return!(r&&r!==(null==(i=t.person)?void 0:i.sex)||n.includes(t.participantId))})))?void 0:t.participantId;r&&(d.push(r),n.push(r),i[r]||(i[r]=[]),i[r].push({collectionPosition:s,collectionId:a}))})),u||N.push(d)}))}let n=Object.keys(i).map((e=>({collectionAssignments:i[e],participantId:e})));f[E.participantId]=n}let A=[];for(let E of N){let{participant:e}=Fh({tournamentParticipants:v,participantIds:E});if(!e){let e={individualParticipantIds:E,participantRole:sg,participantType:Kp};A.push(e)}}if(p){for(;A.length;)vR({participant:A.pop(),tournamentRecord:l});Sd({element:u,extension:{name:qd,value:f}})}return{...At,lineUps:f,participantsToAdd:A}}function SN(e){if(!e)return{error:un};let t=qu(e,[{dates:!1,[Fu]:e=>Array.isArray(e)&&e.every(Uo)},{uuids:!1,[Fu]:e=>Array.isArray(e)&&e.every(St)},{startTime:!1,endTime:!1,[Fu]:Ro},{idPrefix:!1,namePrefix:!1,[Fu]:St},{count:!0,[Fu]:qe}]);if(t.error)return t;let{startDate:i,endDate:n}=e.tournamentRecord??{},r=e.dates||i&&n&&Do(i,n)||[],a=lt(1,e.count+1).map((t=>{var i,n;return _a({courtId:(null==(i=e.uuids)?void 0:i.pop())??(e.idPrefix&&`${e.idPrefix}-${t}`)??rs(),courtName:(null==(n=e.courtNames)?void 0:n.pop())??(e.namePrefix&&`${e.namePrefix} ${t}`),dateAvailability:r.map((t=>({startTime:e.startTime??"08:00",endTime:e.endTime??"20:00",date:t})))})}));return{...At,courts:a}}var wN={};function PN({court:e,date:t}){let i=t&&e.dateAvailability.find((e=>Go(e.date,t))),n=e.dateAvailability.find((e=>!e.date));return i||n}function DN(e){let t=qu(e,[{courtDate:!0,_ofType:Ou}]);if(t.error)return t;let{includeBookingTypes:i=[],courtDate:n}=e,r=[],a=_o(n.startTime);(n.bookings||[]).filter((e=>!e.bookingType||!i.includes(e.bookingType))).sort(((e,t)=>Mo(e.startTime).localeCompare(Mo(t.startTime)))).forEach((e=>{let t={startTime:Ao(a.toISOString()),endTime:e.startTime};_o(e.startTime)>a&&r.push(t),_o(e.endTime)>a&&(a=_o(e.endTime))}));let o={startTime:Ao(a.toISOString()),endTime:n.endTime};return _o(n.endTime)>a&&r.push(o),{timeSlots:r}}function TN(e){let t=qu(e,[{periodStart:!0,date:!0},{courts:!0,_ofType:ku}]);if(t.error)return t;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=e,o=e.courts,s=_o(r),l=Vo(s,i),{enoughTime:u}=function({averageMatchUpMinutes:e,includeBookingTypes:t,periodStartTime:i,periodEndTime:n}){function r(t){let r=_o(t.startTime),a=_o(t.endTime);return!(r>i||a<n)&&Lo(i,a)>=e}return{enoughTime:e=>{var i;let{timeSlots:n}=DN({includeBookingTypes:t,courtDate:e});return!(null==(i=null==n?void 0:n.filter(r))||!i.length)}}}({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((null==o?void 0:o.filter((e=>{if(!Array.isArray(e.dateAvailability))return!1;let t=PN({date:a,court:e});return!(!t||!u(t))})))||[]).length,...At}}function bN(e){var t;let{remainingScheduleTimes:i=[],clearScheduleDates:n,periodLength:r=30,scheduleDate:a,courts:o=[]}=e,{bookings:s=[]}=e;if(!Array.isArray(o)||!o.length)return{error:Cr,courts:o};if(!Array.isArray(s))return{error:mn};if(!Uo(a))return{error:vn};n&&(Array.isArray(n)?n.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:u}=s.reduce(((e,t)=>{let{courtId:i}=t;return i?e.courtBookings[i]?e.courtBookings[i].push(t):e.courtBookings[i]=[t]:e.unassignedBookings.push(t),e}),{courtBookings:{},unassignedBookings:[]}),d=o.map(((e,t)=>{let{courtId:n,courtName:r}=e,o=l[n]||[],s=PN({date:a,court:e})||{},{bookings:u=[],startTime:d,endTime:c,date:p}=s;return{courtId:n,courtName:r,dateAvailability:{bookings:[i[t]&&{startTime:d,endTime:i[t]},...ts(u,!1,!0),...o].filter(Boolean),startTime:d,endTime:c,date:p}}}));u.sort(((e,t)=>No(e.startTime)-No(t.startTime)));let c=[];for(let p of u){let{startTime:e,endTime:i,averageMinutes:n,recoveryMinutes:a,matchUpId:o}=p,s=No(e),l=No(i),u=d.map((e=>{let t=e.dateAvailability,{timeSlots:i=[]}=DN({courtDate:t});return{courtName:e.courtName,courtId:e.courtId,timeSlots:i}})).flat().reduce(((e,{courtId:t,courtName:i,timeSlots:n})=>{let a;return n.find((({startTime:t,endTime:i})=>{a=No(t)-s;let n=s>=No(t);return l<=No(i)&&0!==e.startDifference&&((0===a||a+r>=0)&&(void 0===e.startDifference||a<e.startDifference)||n)}))?{courtName:i,courtId:t,startDifference:a}:e}),{});if(u.courtId){let r={averageMinutes:n,recoveryMinutes:a,matchUpId:o,startTime:e,endTime:i};c.push(r),null==(t=d.find((({courtId:e})=>e===u.courtId)))||t.dateAvailability.bookings.push(r)}else console.log({unassignedBooking:p})}return{virtualCourts:d.map((({courtId:e,courtName:t,dateAvailability:i})=>({dateAvailability:[i],courtName:t,courtId:e}))),assignedBookings:c}}function RN({averageMatchUpMinutes:e,periodLength:t=30,recoveryMinutes:i}){let n=(e||90)+(i||0);return t>n?n:t||30}function NN(e){let{startTime:t="8:00",endTime:i="20:30",count:n=10,date:r}=e??{};return lt(0,n).map((()=>({dateAvailability:[{date:r,startTime:t,endTime:i}]})))}function MN({scheduleDate:e,startTime:t,endTime:i,courts:n}){let r=(t?"startTime":i&&"endTime")||void 0;return n.reduce(((n,a)=>{let o=PN({date:e,court:a}),s=r&&((null==o?void 0:o[r])||a[r]);return s&&(!n||t&&No(s)<No(n)||i&&No(s)>No(n))?s:n}),void 0)}function AN(e){let t=qu(e,[{courts:!0,_ofType:ku}]);if(t.error)return t;let{date:i=yo(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:o}=e,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:d,courtsCount:c,bookings:p}=e;a=a||RN({averageMatchUpMinutes:u}),i=Eo(i),n=Ao(n),r=Ao(r);let m=0,f=0,h=0,v=0,g=0;!o&&c&&(o=NN({startTime:n,endTime:r,count:c,date:i}));let{virtualCourts:I}=bN({remainingScheduleTimes:l,clearScheduleDates:d,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:U}=function({averageMinutes:e,startTime:t,endTime:i,courts:n,date:r}){let a;if(t=t||MN({courts:n,scheduleDate:r,startTime:!0}),i=i||MN({courts:n,scheduleDate:r,endTime:!0}),t&&i){let o=_o(t),s=_o(i);for(let t of n||[]){if(!Array.isArray(t.dateAvailability))continue;let i=PN({court:t,date:r}),{timeSlots:n}=DN({courtDate:i});null==n||n.forEach((t=>{let i=_o(t.startTime),n=_o(t.endTime);if(i>s||i<o||n<o)return!1;if(Lo(i,n)>=e){let e=Ao(i.toISOString());(!a||e<a)&&(a=e)}}))}}return{firstTimeSlotStartTime:a}}({averageMinutes:u,courts:I,startTime:n,endTime:r,date:i});s&&U&&(n=U??n);let y=No(n),S=No(r)-y,w=lt(0,Math.floor(S/a)+1).map((e=>{let t=function(e){let t=Math.floor(e/60),i=e-60*t;return t>23&&(t%=24),[jo(t),jo(i)].join(":")}(y+e*a),n=TN({courts:I??[],averageMatchUpMinutes:u,periodStart:t,date:i});if(n.error)return{error:n.error};let{availableToScheduleCount:r=0}=n,o=r>f?r-f:0;g+=e?r:0;let s=e?g/e:r,l=e?a*s/u*(e-1)+s:s,d=r?f&&l-m||o:0;m=l,f=r,h+=d;let c=Be(h)-v;return v+=c,{periodStart:t,add:c,availableToScheduleCount:r,newCourts:o,totalMatchUps:v}}));return{scheduleTimes:w.reduce(((e,t)=>{let i=lt(0,t.add).map((()=>({scheduleTime:t.periodStart})));return e.concat(...i)}),[]).flat(),timingProfile:w,totalMatchUps:v}}be(wN,{default:()=>CN,garman:()=>EN});var EN={getCourtsAvailableAtPeriodStart:TN,generateTimeSlots:DN,getScheduleTimes:AN,courtGenerator:NN},CN=EN,ON={};be(ON,{isValid:()=>co,isValidMatchUpFormat:()=>co,parse:()=>no,stringify:()=>Za});var kN={};be(kN,{allCompetitionMatchUps:()=>tv,allDrawMatchUps:()=>nv,allEventMatchUps:()=>Xh,allTournamentMatchUps:()=>ev,analyzeMatchUp:()=>Kb,applyLineUps:()=>HM,assignMatchUpSideParticipant:()=>xN,assignTieMatchUpParticipantId:()=>HN,bulkMatchUpStatusUpdate:()=>BM,calculateWinCriteria:()=>Bb,checkInParticipant:()=>BN,checkMatchUpIsComplete:()=>Gh,checkOutParticipant:()=>LN,competitionScheduleMatchUps:()=>kb,disableTieAutoCalc:()=>kM,drawMatchUps:()=>Jb,enableTieAutoCalc:()=>EM,eventMatchUps:()=>Eb,filterMatchUps:()=>Vh,findMatchUp:()=>xT,getAllDrawMatchUps:()=>Qh,getAllStructureMatchUps:()=>jh,getCheckedInParticipantIds:()=>Zf,getCompetitionMatchUps:()=>Ob,getEventMatchUpFormatTiming:()=>Tb,getHomeParticipantId:()=>Vb,getMatchUpCompetitiveProfile:()=>Sf,getMatchUpContextIds:()=>jb,getMatchUpDailyLimits:()=>Fb,getMatchUpDailyLimitsUpdate:()=>Rb,getMatchUpDependencies:()=>uv,getMatchUpFormat:()=>qb,getMatchUpFormatTiming:()=>hh,getMatchUpFormatTimingUpdate:()=>Ub,getMatchUpScheduleDetails:()=>Oh,getMatchUpType:()=>_h,getMatchUpsStats:()=>Wb,getModifiedMatchUpFormatTiming:()=>bb,getParticipantResults:()=>wy,getPredictiveAccuracy:()=>xb,getRoundMatchUps:()=>uf,getRounds:()=>Yb,isValidMatchUpFormat:()=>co,matchUpActions:()=>ow,mutate:()=>FN,participantScheduledMatchUps:()=>Mb,query:()=>gb,removeDelegatedOutcome:()=>CM,removeMatchUpSideParticipant:()=>KN,removeTieMatchUpParticipantId:()=>YN,replaceTieMatchUpParticipantId:()=>GN,resetAdHocMatchUps:()=>qM,resetMatchUpLineUps:()=>xM,resetScorecard:()=>$M,resetTieFormat:()=>GM,setDelegatedOutcome:()=>jM,setMatchUpFormat:()=>FM,setMatchUpStatus:()=>LM,setOrderOfFinish:()=>WM,substituteParticipant:()=>OM,tallyParticipantResults:()=>xy,toggleParticipantCheckInState:()=>VN,tournamentMatchUps:()=>Cb,updateTieMatchUpScore:()=>Xy,validMatchUp:()=>sf,validMatchUps:()=>lf});var FN={};function xN({tournamentRecord:e,drawDefinition:t,participantId:i,sideNumber:n,matchUpId:r,event:a}){var o,s;if(i&&"string"!=typeof i)return{error:Mn};if(!t)return{error:$t};if(!r)return{error:Hi};let l=void 0===n;if(l&&(n=1),![1,2].includes(n))return La({result:{error:Cr,context:{sideNumber:n}}});let{matchUp:u,structure:d}=Vy({drawDefinition:t,matchUpId:r,event:a});if(!u)return{error:Yi};if(null!=d&&d.structures||t.drawType&&t.drawType!==Tl||null!=(o=null==d?void 0:d.matchUps)&&o.find((({roundPosition:e})=>!!e)))return{error:ri};if(!i&&(null!=(s=null==u?void 0:u.score)&&s.scoreStringSide1||Vc.includes(null==u?void 0:u.matchUpstatus)||null!=u&&u.matchUpStatus&&[Rc,bc].includes(u.matchUpStatus)))return{error:Tn,info:"matchUp has completed status or score"};if(u){if(u.sides=[1,2].map((e=>{var t;let r=(null==(t=u.sides)?void 0:t.find((t=>t.sideNumber===e)))??{sideNumber:e};return n===e?{...r,participantId:i}:r})),l)for(let e of u.sides)e.sideNumber&&(e.sideNumber=3-e.sideNumber);Cp({tournamentId:null==e?void 0:e.tournamentId,context:"assignSideParticipant",drawDefinition:t,matchUp:u})}return{...At,sidesSwapped:l}}function _N({removePriorValues:e,tournamentRecord:t,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=Vy({drawDefinition:n,event:s,matchUpId:a});if(!l)return{error:Yi};let u=nS({removePriorValues:e,element:l,duplicateValues:i,timeItem:o});return r||Cp({tournamentId:null==t?void 0:t.tournamentId,eventId:null==s?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),u}function LN(e){var t;let i=qu(e,[{[au]:!0},{[su]:!0},{[du]:!0},{[Iu]:!0}]);if(i.error)return i;let n=Gb(e,[{[Eu]:Ru,attr:{[yu]:!0}}]);if(n.error)return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=e,l=null==(t=null==n?void 0:n.matchUp)?void 0:t.matchUp,{matchUpStatus:u,score:d}=l??{};if(u&&jc.includes(u)||u&&Vc.includes(u)||dv({score:d}))return{error:mi};let c=Zf({matchUp:l});if(null!=c&&c.error)return c;let{checkedInParticipantIds:p,allRelevantParticipantIds:m}=c??{};if(null==m||!m.includes(o))return{error:Mn};if(null==p||!p.includes(o))return{error:Gn};let f=wf({matchUp:l});if(null!=f&&f.error)return f;let{sideParticipantIds:h,nestedIndividualParticipantIds:v}=f??{},g=null==h?void 0:h.indexOf(o);return void 0!==g&&[0,1].includes(g)&&((null==v?void 0:v[g])??[]).forEach((e=>{_N({drawDefinition:a,matchUpId:s,timeItem:{itemType:Df,itemValue:e}})})),_N({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:Df}}),{...At,checkedOut:!0}}function BN(e){var t;let i=qu(e,[{[au]:!0},{[su]:!0},{[du]:!0},{[Iu]:!0}]);if(i[Mu])return i;let n=Gb(e,[{[Eu]:Ru,attr:{[yu]:!0}}]);if(n[Mu])return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=e,l=Zf({matchUp:null==(t=null==n?void 0:n.matchUp)?void 0:t.matchUp});if(null!=l&&l.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:d}=l??{};if(null==d||!d.includes(o))return{[Mu]:Mn};let c={...At,checkedIn:!0};return null!=u&&u.includes(o)||_N({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:Pf}}),c}function VN(e){var t,i;let n=qu(e,[{[du]:!0,[su]:!0,[Iu]:!0}]);if(n.error)return n;let r=e.tournamentId??e.activeTournamentId,a=e.tournamentRecord??(r&&(null==(t=e.tournamentRecords)?void 0:t[r]));if(!a)return{error:Bt};let o=null==(i=Gb(e,[{[Eu]:Ru,attr:{[yu]:!0},[Mu]:Yi}]).matchUp)?void 0:i.matchUp;if(!o)return{error:Yi};let{checkedInParticipantIds:s=[]}=Zf({matchUp:o}),{participantId:l,matchUpId:u,drawDefinition:d}=e;return l&&s.includes(l)?LN({tournamentRecord:a,drawDefinition:d,participantId:l,matchUpId:u,matchUp:o}):BN({tournamentRecord:a,drawDefinition:d,participantId:l,matchUpId:u,matchUp:o})}function jN({tournamentRecord:e,drawDefinition:t,tieMatchUpId:i,event:n}){var r,a;if(!e)return{error:Bt};if(!t)return{error:li};if(!n)return{error:Ri};let o=rf({drawDefinition:t}),{matchUp:s}=Vy({matchUpId:i,drawDefinition:t,matchUpsMap:o});if(!s)return{error:Yi};let{matchUp:l,structure:u}=Vy({tournamentParticipants:e.participants,matchUpId:i,inContext:!0,drawDefinition:t,matchUpsMap:o,event:n});if(!l)return{error:Yi};let{collectionPosition:d,drawPositions:c,collectionId:p,matchUpTieId:m,matchUpType:f}=l;if(f&&!Mt([Ee,Oe],f))return{error:Qi};let{positionAssignments:h}=Kc({structure:u}),v=null==h?void 0:h.filter((e=>null==c?void 0:c.includes(e.drawPosition))),{matchUp:g}=Vy({matchUpId:m,drawDefinition:t,matchUpsMap:o}),I=[...(null==(r=null==g?void 0:g.sides)?void 0:r.map(hc))??[],...(null==v?void 0:v.map(hc))??[]],{participants:U}=zv({tournamentRecord:e,participantFilters:{participantTypes:[Jp],participantIds:I}}),{matchUp:y}=Vy({matchUpId:m,inContext:!0,drawDefinition:t,matchUpsMap:o});return{inContextDualMatchUp:y,inContextTieMatchUp:l,relevantAssignments:v,collectionPosition:d,teamParticipants:U,collectionId:p,matchUpType:f,dualMatchUp:g,tieMatchUp:s,tieFormat:null==(a=nf({matchUp:g,drawDefinition:t,structure:u,event:n}))?void 0:a.tieFormat,structure:u,...At}}function GN(e){var t,i,n,r,a,o,s,l,u,d,c,p,m,f,h,v;let g=jN(e);if(g.error)return g;let I="replaceTieMatchUpParticipantid",{existingParticipantId:U,tournamentRecord:y,newParticipantId:S,drawDefinition:w,substitution:P,event:D}=e;if(!U||!S)return La({result:{error:xn},stack:I});if(U===S)return{...At};let{inContextDualMatchUp:T,inContextTieMatchUp:b,collectionPosition:R,collectionId:N,dualMatchUp:M,tieMatchUp:A,tieFormat:E}=g,C=null==b?void 0:b.matchUpType,O=null==(t=null==b?void 0:b.sides)?void 0:t.find((e=>{var t,i,n;return(null==(t=e.participant)?void 0:t.participantId)===U||(null==(n=null==(i=e.participant)?void 0:i.individualParticipantIds)?void 0:n.includes(U))}));if(!O)return{error:_n};let k=(null==(i=zv({tournamentRecord:y,participantFilters:{participantIds:[U,S]}}))?void 0:i.participants)??[];if(2!==k.length)return La({result:{error:xn},stack:I});if(k[0].participantType!==k[1].participantType)return La({result:{error:Cn},stack:I});let{appliedPolicies:F}=gm({tournamentRecord:y,drawDefinition:w,event:D}),x=(null==(n=e.policyDefinitions)?void 0:n[rd])??(null==F?void 0:F[rd])??rg[rd],_=k.find((({participantId:e})=>e===S));if(!1!==(e.enforceGender??(null==(r=null==x?void 0:x.participants)?void 0:r.enforceGender))&&[Va,$a].includes(null==b?void 0:b.gender)&&(null==b?void 0:b.gender)!==(null==(a=null==_?void 0:_.person)?void 0:a.sex))return{error:Nn,info:"Gender mismatch"};let L=null==(o=null==x?void 0:x.processCodes)?void 0:o.substitution;Ky({tournamentId:y.tournamentId,eventId:D.eventId,inContextDualMatchUp:T,drawDefinition:w,dualMatchUp:M});let B=null==(s=null==M?void 0:M.sides)?void 0:s.find((({sideNumber:e})=>e===O.sideNumber));if(!B)return La({result:{sideNumber:O.sideNumber,existingParticipantId:U,error:Lr},stack:I});if(null!=(u=null==(l=null==b?void 0:b.sides)?void 0:l.flatMap((e=>{var t,i;return(null==(t=e.participant)?void 0:t.individualParticipantIds)||(null==(i=e.participant)?void 0:i.participantId)||[]})))&&u.includes(S))return La({result:{error:Wn},stack:I});let V=null==(c=null==(d=null==T?void 0:T.sides)?void 0:d.find((({sideNumber:e})=>e===O.sideNumber)))?void 0:c.participantId,j=B.lineUp,G=null==j?void 0:j.find((({participantId:e})=>S===e)),$=null==j?void 0:j.reduce(((e,t)=>t.substitutionOrder>e?t.substitutionOrder:e),0),q=(null==j?void 0:j.map((e=>{var t;let i=ts(e,!1,!0);if(![U,S].includes(i.participantId))return i;if(!P&&[U,S].includes(i.participantId)&&(i.collectionAssignments=null==(t=i.collectionAssignments)?void 0:t.filter((e=>!(e.collectionPosition===R&&e.collectionId===N)))),P&&U===i.participantId&&(i.collectionAssignments=i.collectionAssignments.map((e=>e.collectionPosition===R&&e.collectionId===N&&void 0===e.substitutionOrder?{...e,substitutionOrder:$}:e))),i.participantId===S){i.collectionAssignments||(i.collectionAssignments=[]);let e={collectionId:N,collectionPosition:R};P&&(e.previousParticipantId=U,e.substitutionOrder=($??0)+1),i.collectionAssignments.push(e)}return i})))??[];if(!G){let e={collectionId:N,collectionPosition:R};P&&(e.substitutionOrder=($??0)+1,e.previousParticipantId=U);let t={collectionAssignments:[e],participantId:S};q.push(t)}let W,H,z=C===Oe,{assignedParticipantIds:Y}=kh({lineUp:j,collectionPosition:R,collectionId:N}),{assignedParticipantIds:K}=kh({lineUp:q,collectionPosition:R,collectionId:N});if(B.lineUp=q,V&&E){let e=iI({participantId:V,lineUp:q,drawDefinition:w,tieFormat:E});if(e.error)return La({result:e,stack:I})}else console.log("team participantId not found");if(z){let{tournamentRecord:t}=e,i=Fh({participantIds:K,tournamentRecord:t});if(!i.participant){let e=vR({returnParticipant:!0,pairOverride:!0,tournamentRecord:t,participant:{participantRole:sg,individualParticipantIds:K,participantType:Kp}});if(e.error)return La({result:e,stack:I});W=null==(p=e.participant)?void 0:p.participantId}i=Fh({participantIds:Y,tournamentRecord:t});let n=null==(m=i.participant)?void 0:m.participantId;n&&gg({participantIds:[n],tournamentRecord:t}).success&&(H=n)}if(P||1===(null==(f=O.substitutions)?void 0:f.length)){if(P)L&&A&&(A.processCodes=Qe([...(null==A?void 0:A.processCodes)??[],...L]));else for(let e of L||[]){let t=null==(h=null==A?void 0:A.processCodes)?void 0:h.lastIndexOf(e);void 0!==t&&(null==(v=null==A?void 0:A.processCodes)||v.splice(t,1))}A&&Cp({tournamentId:null==y?void 0:y.tournamentId,matchUp:A,context:I,drawDefinition:w})}return M&&Cp({tournamentId:null==y?void 0:y.tournamentId,matchUp:M,context:I,drawDefinition:w}),{...At,modifiedLineUp:q,participantRemoved:H,participantAdded:W}}function $N({collectionPosition:e,teamParticipantId:t,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var o;if(!a||!e||!Array.isArray(r))return{modifiedLineUp:(null==i?void 0:i.lineUp)||[],error:Cr};let s=(null==i?void 0:i.lineUp)||(null==(o=xh({participantId:t,drawDefinition:n}))?void 0:o.lineUp),l=[],u=[];return{modifiedLineUp:(null==s?void 0:s.map((t=>{var i;if(!r.includes(t.participantId))return t;let n=null==(i=t.collectionAssignments)?void 0:i.filter((i=>{let n=i.collectionId===a&&i.collectionPosition===e;return n&&(i.previousParticipantId&&l.push(i.previousParticipantId),u.push({participantId:t.participantId,...i})),!n}));return{participantId:t.participantId,collectionAssignments:n}})).filter(Boolean))||[],assignmentsRemoved:u,previousParticipantIds:l}}function qN({individualParticipantIds:e,groupingParticipantId:t,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return La({result:{error:Bt},stack:r});if(!t||!e)return La({result:{error:un},stack:r});let a=n.participants??[],o=a.find((e=>e.participantId===t));if(!o)return La({result:{error:_n},stack:r});if(null!=o&&o.participantType&&![Jp,Yp].includes(o.participantType))return La({context:{participantType:o.participantType},result:{error:Cn},stack:r});let s=e.filter((e=>{var t;return(null==(t=a.find((t=>t.participantId===e)))?void 0:t.participantType)!==zp}));if(s.length)return La({result:{error:An,invalidParticipantIds:s},stack:r});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=e.filter((e=>!l.includes(e)));u.length&&(i&&vg({individualParticipantIds:u,tournamentRecord:n}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:d}=Pa();if(d.includes(mp)){let e=a.find((({participantId:e})=>e===t));Ia({topic:mp,payload:{participants:[e]}})}return function({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}){var n,r;let a=(i.events||[]).filter((e=>{var i;return(null==e?void 0:e.eventType)===Xs&&(null==(i=null==e?void 0:e.entries)?void 0:i.some((e=>e.participantId===t)))})),o=t=>!e.includes(t.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:e}=Eh({event:s});null==(n=null==e?void 0:e.flights)||n.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter(o)})),null==(r=null==s?void 0:s.drawDefinitions)||r.forEach((e=>{e.entries=(e.entries||[]).filter(o)}))}}({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:n}),{groupingParticipant:ts(o,!1,!0),added:u.length,...At}}function WN(e){let{updateParticipantName:t=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:o}=e;if(!r)return{error:Bt};if(!o)return{error:kn};if(!o.participantId)return vR({tournamentRecord:r,participant:o});let{participant:s}=nm({participantId:o.participantId,tournamentRecord:r});if(!s)return vR({tournamentRecord:r,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:d,participantName:c,participantRole:p,participantType:m,onlineResources:f,contacts:h,person:v}=o;if(m&&s.participantType!==m)return{error:Dn};let g={};if(h&&(g.contacts=h),f&&(g.onlineResources=f),d&&St(d)&&(g.participantOtherName=d),c&&St(c)&&(g.participantName=c),Array.isArray(u)){let{participants:e}=zv({participantFilters:{participantTypes:[zp]},tournamentRecord:r}),i=null==e?void 0:e.map(hc);if(i){let n=u.filter((e=>St(e)&&i.includes(e)));([Yp,Fe].includes(m||s.participantType)||m===Kp&&(2===n.length||a))&&(g.individualParticipantIds=n),s.participantType===Qp.PAIR&&t&&(g.participantName=function({individualParticipants:e,newValues:t}){let i=t.individualParticipantIds,n=e.filter((({participantId:e})=>i.includes(e))).map((({person:e})=>null==e?void 0:e.standardFamilyName)).filter(Boolean).sort().join("/");return 1===i.length&&(n+="/Unknown"),n}({individualParticipants:e,newValues:g}))}}return Object.keys(mg).includes(p)&&(g.participantRole=p),Object.keys(Qp).includes(m)&&(g.participantType=m),Array.isArray(l)&&(g.participantRoleResponsibilties=l),s.participantType===Qp.INDIVIDUAL&&v&&function({updateParticipantName:e,existingParticipant:t,newValues:i,person:n}){let r,a={},{standardFamilyName:o,standardGivenName:s,nationalityCode:l,personId:u,birthdate:d,tennisId:c,sex:p}=n;if(p&&Object.keys(qa).includes(p)&&(a.sex=p),St(u)&&(a.personId=u),l&&St(l)&&(function(e){return tm.flatMap((({iso:e,ioc:t})=>[e,t])).filter(Boolean).includes(e)}(l)||""===l)&&(a.nationalityCode=l),o&&typeof St(o)&&o.length>1&&(a.standardFamilyName=o,r=!0),s&&typeof St(s)&&s.length>1&&(a.standardGivenName=s,r=!0),r&&e){let e=`${a.standardGivenName} ${a.standardFamilyName}`;i.participantName=e}d&&Uo(d)&&(a.birthdate=d),c&&St(c)&&(a.tennisId=c),Object.assign(t.person,a)}({updateParticipantName:t,existingParticipant:s,newValues:g,person:v}),Object.assign(s,_a(g)),i&&qN({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),Ia({topic:mp,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:ts(s),...At}}function HN(e){var t,i,n,r,a,o,s,l,u,d,c,p,m,f,h,v,g,I,U,y;let S=jN(e);if(S.error)return S;let w="assignTieMatchUpParticipantId",P=e.teamParticipantId,{tournamentRecord:D,drawDefinition:T,participantId:b,event:R}=e;if(!b)return La({result:{error:xn},stack:w});if(e.sideNumber&&![1,2].includes(e.sideNumber))return La({result:{error:on},stack:w});let{inContextDualMatchUp:N,inContextTieMatchUp:M,relevantAssignments:A,collectionPosition:E,teamParticipants:C,collectionId:O,matchUpType:k,dualMatchUp:F,tieFormat:x}=S;if(null!=(i=null==(t=null==M?void 0:M.sides)?void 0:t.flatMap((e=>{var t,i;return(null==(t=e.participant)?void 0:t.individualParticipantIds)||(null==(i=e.participant)?void 0:i.participantId)||[]})))&&i.includes(b))return La({result:{...At},stack:w});P=P??(e.sideNumber?null==(r=null==(n=null==N?void 0:N.sides)?void 0:n.find((t=>t.sideNumber===e.sideNumber)))?void 0:r.participantId:void 0);let _=null==(o=null==(a=zv({participantFilters:{participantIds:[b]},tournamentRecord:D}))?void 0:a.participants)?void 0:o[0];if(!_)return La({result:{error:_n},stack:w});let{appliedPolicies:L}=gm({tournamentRecord:D,drawDefinition:T,event:R}),B=(null==(s=e.policyDefinitions)?void 0:s[rd])??(null==L?void 0:L[rd])??rg[rd];if(!1!==(e.enforceGender??(null==(l=null==B?void 0:B.participants)?void 0:l.enforceGender))&&[Va,$a].includes(null==M?void 0:M.gender)&&(null==M?void 0:M.gender)!==(null==(u=_.person)?void 0:u.sex))return{error:Nn,info:"Gender mismatch"};let{individualParticipantIds:V,participantType:j}=_;if(Xf(Ee)(k)&&j!==zp)return{error:Cn};let G=j===zp?[b]:V,$=P&&(null==C?void 0:C.find((({participantId:e})=>e===P)))||(null==C?void 0:C.find((({individualParticipantIds:e})=>pt(G,e))));if(!$)return{error:kr};if(P||(P=$.participantId),!P)return{error:_n};let q=null==(d=null==A?void 0:A.find((e=>e.participantId===(null==$?void 0:$.participantId))))?void 0:d.drawPosition,W=null==(p=null==(c=null==F?void 0:F.sides)?void 0:c.find((e=>e.participantId===P)))?void 0:p.sideNumber,H=null==(f=null==(m=null==M?void 0:M.sides)?void 0:m.find((e=>q&&e.drawPosition===q)))?void 0:f.sideNumber,z=W??H??e.sideNumber;if(!x)return{error:Wi};if(null==(h=x.collectionDefinitions)||!h.find((e=>e.collectionId===O)))return{error:qi};Ky({tournamentId:D.tournamentId,eventId:R.eventId,inContextDualMatchUp:N,drawDefinition:T,dualMatchUp:F});let Y=null==(v=null==F?void 0:F.sides)?void 0:v.find((e=>e.sideNumber===z)),K=null==(g=null==M?void 0:M.sides)?void 0:g.find((e=>e.sideNumber===z)),J=null==(y=null==(U=(null==Y?void 0:Y.lineUp)??(null==(I=xh({participantId:P,drawDefinition:T}))?void 0:I.lineUp))?void 0:U.filter((e=>{var t;return null==(t=e.collectionAssignments)?void 0:t.find((e=>e.collectionPosition===E&&e.collectionId===O&&!e.previousParticipantId))})))?void 0:y.map((e=>null==e?void 0:e.participantId)),Q=(null==J?void 0:J.length)>1&&J||(j===Kp?_.individualParticipantIds:[b]),Z=$N({collectionPosition:E,teamParticipantId:P,dualMatchUpSide:Y,drawDefinition:T,participantIds:Q,collectionId:O});if(Z.error)return La({result:Z,stack:w});let X,{modifiedLineUp:ee}=Z;if(k===Oe){if(j!==Kp){let e=zN({collectionPosition:E,teamParticipantId:P,drawDefinition:T,modifiedLineUp:ee,participantId:b,collectionId:O,tieFormat:x});if(null!=e&&e.error)return La({result:e,stack:w});if(e=function({side:e}){let t;if(e.participant){let i=e.participant.individualParticipantIds||[];if(1===i.filter(Boolean).length){let{participant:e}=Fh({participantIds:i,tournamentRecord:D});i.push(b);let{participant:n}=Fh({participantIds:i,tournamentRecord:D});if(!n&&e){e.individualParticipantIds=i;let t=WN({pairOverride:!0,tournamentRecord:D,participant:e});if(t.error)return t}else t=null==e?void 0:e.participantId}}else{let e=vR({participant:{individualParticipantIds:[b],participantRole:sg,participantType:Kp},pairOverride:!0,tournamentRecord:D});if(e.error)return e}return{...At,deletedParticipantId:t}}({side:K}),e.error)return e;X=e.deletedParticipantId,Y&&(Y.lineUp=ee),F&&Cp({tournamentId:null==D?void 0:D.tournamentId,matchUp:F,context:w,drawDefinition:T})}else if(j===Kp)for(let te of Q)zN({collectionPosition:E,teamParticipantId:P,drawDefinition:T,modifiedLineUp:ee,participantId:te,collectionId:O,tieFormat:x})}else{let e=zN({collectionPosition:E,teamParticipantId:P,drawDefinition:T,modifiedLineUp:ee,participantId:b,collectionId:O,tieFormat:x});if(null!=e&&e.error)return e}if(Y&&(Y.lineUp=ee),F&&Cp({tournamentId:null==D?void 0:D.tournamentId,matchUp:F,context:w,drawDefinition:T}),X){let{error:e}=gg({participantIds:[X],tournamentRecord:D});e&&console.log("cleanup")}return{...At,modifiedLineUp:ee}}function zN({collectionPosition:e,teamParticipantId:t,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var s,l;let u=null==(s=xh({participantId:t,drawDefinition:i}))?void 0:s.lineUp,d=null==(l=n||u)?void 0:l.find((e=>(null==e?void 0:e.participantId)===r)),c={collectionId:a,collectionPosition:e};if(d)d.collectionAssignments.push(c);else{let e={collectionAssignments:[c],participantId:r};n.push(e)}return iI({participantId:t,lineUp:n,drawDefinition:i,tieFormat:o})}function YN(e){var t,i,n,r,a,o,s,l,u,d,c,p,m,f,h,v,g,I,U,y,S,w,P;let{tournamentRecord:D,drawDefinition:T,participantId:b,event:R}=e,N="removeTieMatchUpParticiapantId";if(!b)return La({result:{error:xn},stack:N});let M=jN(e);if(M.error)return M;let{appliedPolicies:A}=gm({tournamentRecord:D,drawDefinition:T,event:R}),E=null==(n=null==(i=(null==(t=e.policyDefinitions)?void 0:t[rd])??(null==A?void 0:A[rd])??rg[rd])?void 0:i.processCodes)?void 0:n.substitution,{inContextDualMatchUp:C,inContextTieMatchUp:O,relevantAssignments:k,collectionPosition:F,teamParticipants:x,collectionId:_,matchUpType:L,dualMatchUp:B,tieMatchUp:V,tieFormat:j}=M;if(!B)return La({result:{error:Ji},stack:N});let G=null==(r=null==O?void 0:O.sides)?void 0:r.find((e=>{var t,i,n;return(null==(t=e.participant)?void 0:t.participantId)===b||(null==(n=null==(i=e.participant)?void 0:i.individualParticipantIds)?void 0:n.includes(b))}));if(!G)return La({result:{error:_n},stack:N});let $=(null==(a=e.policyDefinitions)?void 0:a[cd])??(null==A?void 0:A[cd]);if((null==(o=G.substitutions)||!o.length)&&(dv({score:null==O?void 0:O.score})||null!=O&&O.winningSide)&&!1!==(null==$?void 0:$.requireParticipantsForScoring))return La({result:{error:Gr},stack:N});let q=null==(l=null==(s=null==C?void 0:C.sides)?void 0:s.find((({sideNumber:e})=>e===G.sideNumber)))?void 0:l.participantId;if(!q)return La({result:{error:_n},stack:N});let W=null==(d=null==(u=zv({participantFilters:{participantIds:[b]},tournamentRecord:D}))?void 0:u.participants)?void 0:d[0];if(!W)return La({result:{error:_n},stack:N});if(L===Ee&&W.participantType===Kp)return La({result:{error:Nn},stack:N});let H=W.participantType===zp?[b]:W.individualParticipantIds;Ky({tournamentId:D.tournamentId,eventId:R.eventId,inContextDualMatchUp:C,drawDefinition:T,dualMatchUp:B});let z=null==(c=B.sides)?void 0:c.find((({sideNumber:e})=>e===G.sideNumber));if(!z&&((null==(p=B.sides)?void 0:p.filter((({lineUp:e})=>!e)).length)||0)<2){let e=null==x?void 0:x.map((({participantId:e})=>{var t;return{drawPosition:null==(t=null==k?void 0:k.find((t=>t.participantId===e)))?void 0:t.drawPosition,teamParticipantId:e}}));z=null==(m=B.sides)?void 0:m.find((t=>{var i;return(null==(i=null==e?void 0:e.find((({drawPosition:e})=>e===t.drawPosition)))?void 0:i.teamParticipantId)===q}))}if(!z)return La({result:{error:_n,context:{participantId:b}}});let{modifiedLineUp:Y,previousParticipantIds:K}=$N({collectionPosition:F,teamParticipantId:q,dualMatchUpSide:z,participantIds:H,drawDefinition:T,collectionId:_});if(z.lineUp=Y,q&&j&&iI({participantId:q,lineUp:Y,drawDefinition:T,tieFormat:j}),L===Oe&&W.participantType===zp){let e=null==(f=null==O?void 0:O.sides)?void 0:f.find((e=>e.sideNumber===(null==z?void 0:z.sideNumber))),{participantId:t}=e??{},i=t&&(null==(v=null==(h=zv({participantFilters:{participantIds:[t]},tournamentRecord:D,withDraws:!0}))?void 0:h.participants)?void 0:v[0]);if(!i)return La({result:{error:_n},stack:N});{let e=(null==(g=null==i?void 0:i.individualParticipantIds)?void 0:g.filter((e=>e!==b)))??[];if(K&&e.push(...K),e.length>2)return La({result:{error:An},stack:N});if(null!=(I=i.draws)&&I.length){if(1===e.length){let{participant:t}=Fh({participantIds:e,tournamentRecord:D});if(!t){let t=vR({participant:{participantRole:sg,individualParticipantIds:e,participantType:Kp},pairOverride:!0,tournamentRecord:D});if(t.error)return La({result:t,stack:N})}}}else if(e.length){i.individualParticipantIds=e;let t=WN({participant:i,pairOverride:!0,tournamentRecord:D});if(t.error)return La({result:t,stack:N})}else{let e=gg({participantIds:[t],tournamentRecord:D});e.error&&console.log("cleanup",{result:e})}}}if(1===(null==(U=G.substitutions)?void 0:U.length)&&(null==(w=null==(S=null==(y=null==O?void 0:O.sides)?void 0:y.find((e=>e.sideNumber!==G.sideNumber)))?void 0:S.substitutions)||!w.length)&&null!=(P=null==V?void 0:V.processCodes)&&P.length){for(let e of E||[]){let t=V.processCodes.lastIndexOf(e);V.processCodes.splice(t,1)}Cp({tournamentId:null==D?void 0:D.tournamentId,matchUp:V,context:N,drawDefinition:T})}return Cp({tournamentId:null==D?void 0:D.tournamentId,matchUp:B,context:N,drawDefinition:T}),{...At,modifiedLineUp:Y}}function KN(e){var t,i;let n=qu(e,[{[au]:!0,[su]:!0,[Iu]:!0}]);if(n.error)return n;let{drawDefinition:r,sideNumber:a,matchUpId:o,event:s}=e;if(a&&![1,2].includes(a))return{error:Cr,sideNumber:a};let{matchUp:l,structure:u}=Vy({drawDefinition:r,matchUpId:o,event:s});return l?mf({structure:u})?(null==(t=l.sides)||t.forEach((e=>{(!a||e.sideNumber===a)&&delete e.participantId})),Cp({tournamentId:null==(i=e.tournamentRecord)?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:l}),{...At}):{error:ri}:{error:Yi}}function JN({inContextDrawMatchUps:e,positionAssignments:t,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:d}){var c,p,m;if(s){let t=null==(p=null==(c=e.find((({matchUpId:e})=>u.matchUpId===e)).sides)?void 0:c.find((e=>e.drawPosition===n)))?void 0:p.sideNumber,i=null==(m=u.sides)?void 0:m.find((e=>e.sideNumber===t));i&&delete i.lineUp}u.drawPositions=(u.drawPositions||[]).map((e=>e===n?void 0:e)).filter(Boolean);let f=t.filter((({drawPosition:e})=>{var t;return null==(t=u.drawPositions)?void 0:t.includes(e)})).filter((e=>e.bye)).length;return u.matchUpStatus=f&&Sc||[Tc,kc].includes(u.matchUpStatus)&&u.matchUpStatus||Oc,[kc,Tc].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&Kg({inContextDrawMatchUps:e,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),Cp({tournamentId:null==r?void 0:r.tournamentId,eventId:null==d?void 0:d.eventId,context:`removeSubsequentDrawPosition-${n}`,drawDefinition:o,matchUp:u}),{...At}}function QN(e){let{dualWinningSideChange:t,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:d,event:c}=e,p=!!e.matchUp.collectionId,m=mf({structure:d}),{drawPositions:f,winningSide:h}=l.matchUp||{};if(!m&&!f)return{error:Xt};let v,{targetLinks:{loserTargetLink:g,winnerTargetLink:I,byeTargetLink:U},targetMatchUps:{loserMatchUp:y,winnerMatchUp:S,byeMatchUp:w}}=l,P=qy({...e,matchUpStatus:a||Oc,removeWinningSide:!0});if(P.error)return P;if(p){let{matchUpTieId:i,matchUpsMap:a}=e;if(v=Xy({appliedPolicies:e.appliedPolicies,matchUpId:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,event:c}),!t&&!v.removeWinningSide)return{...At}}if(m)return{...At};let{matchUps:D}=jh({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:o,structure:d}),{positionAssignments:T}=Jc({structure:d}),b=h-1,R=1-b,N=f[b],M=f[R],{winnerParticipantId:A,loserParticipantId:E}=(null==T?void 0:T.reduce(((e,t)=>(t.drawPosition===M&&(e.loserParticipantId=t.participantId),t.drawPosition===N&&(e.winnerParticipantId=t.participantId),e)),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},C=D.filter((e=>{var t;return null==(t=e.drawPositions)?void 0:t.includes(M)}));if(S&&ZN({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:N,winnerParticipantId:A,tournamentRecord:n,winnerTargetLink:I,drawDefinition:r,winnerMatchUp:S,dualMatchUp:s,matchUpsMap:o}),y){let{winnerHadMatchUpStatus:e}=function({matchUpStatuses:e=[Sc,kc,Tc],drawPositionMatchUps:t,loserDrawPosition:i,sourceMatchUps:n}){var r;let a=null==t?void 0:t.reduce(((e,t)=>!e||t.roundNumber>e.roundNumber?t:e),void 0),o=null==(r=null==a?void 0:a.drawPositions)?void 0:r.find((e=>e!==i)),s=n.filter((e=>{var t;return null==(t=null==e?void 0:e.drawPositions)?void 0:t.includes(o)})).map((e=>e.matchUpStatus)),l=n.filter((e=>{var t;return null==(t=null==e?void 0:e.drawPositions)?void 0:t.includes(i)})).map((e=>e.matchUpStatus));return{sourceMatchUp:a,winnerHadMatchUpStatus:pt(s||[],e),winnerMatchUpStatuses:s,loserHadMatchUpStatus:pt(l||[],e),loserMatchUpStatuses:l}}({drawPositionMatchUps:C,loserDrawPosition:M,sourceMatchUps:D}),t=g.linkCondition===Dl;if(e&&t){XN({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:Math.min(...y.drawPositions),matchUpsMap:o,event:c})}let l=function({sourceMatchUpStatus:e,loserParticipantId:t,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var d,c,p;let m="removeDirectedLoser",f=n.target.structureId,{structure:h}=Hc({drawDefinition:a,structureId:f});if(!h)return{error:Si};let{positionAssignments:v}=Jc({structure:h}),g=null==(d=null==v?void 0:v.find((e=>e.participantId===t)))?void 0:d.drawPosition;if(null==v||v.forEach((e=>{e.participantId===t&&delete e.participantId})),h.seedAssignments=(h.seedAssignments??[]).filter((e=>e.participantId!==t)),l){let e=null==o?void 0:o.sides.reduce(((e,t,i)=>t.drawPosition===g?i:e),void 0),t=null==(c=null==s?void 0:s.drawMatchUps)?void 0:c.find((({matchUpId:e})=>e===o.matchUpId)),n=null==(p=null==t?void 0:t.sides)?void 0:p[e];n&&(delete n.lineUp,Cp({tournamentId:null==i?void 0:i.tournamentId,eventId:null==u?void 0:u.eventId,matchUp:t,context:m,drawDefinition:a}))}return{...At}}({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:E,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:y,dualMatchUp:s,matchUpsMap:o,event:c});if(l.error)return l}if(w){XN({sourceMatchUpId:u,targetLink:U,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:Math.min(...w.drawPositions),matchUpsMap:o,event:c})}return{...At,...v&&{tieMatchUpResult:v}}}function ZN({inContextDrawMatchUps:e,winningDrawPosition:t,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:d,event:c}){var p,m;let{structureId:f,roundNumber:h}=l;if(a){let e=a.target.structureId,{structure:t}=Hc({drawDefinition:s,structureId:e});if(!t)return{error:Si};let{positionAssignments:i}=Jc({structure:t});t.seedAssignments=(t.seedAssignments??[]).filter((e=>e.participantId!==n));let o=null==(p=null==i?void 0:i.find((e=>e.participantId===n)))?void 0:p.drawPosition,{matchUps:d}=jh({drawDefinition:s,structure:t,event:c}),f=tt(d.map((e=>e.drawPositions)).flat(1/0).filter(Boolean));if(1===(o?f[o]:void 0))null==i||i.forEach((e=>{e.participantId===n&&delete e.participantId}));else{let e=d.filter((({drawPositions:e})=>e.includes(o)));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:e,winnerTargetLink:a})}let h=null==(m=null==u?void 0:u.drawMatchUps)?void 0:m.find((({matchUpId:e})=>e===l.matchUpId));h&&Cp({tournamentId:null==r?void 0:r.tournamentId,eventId:null==c?void 0:c.eventId,matchUp:h,context:"removeDirectedWinner",drawDefinition:s})}return h&&function({inContextDrawMatchUps:e,sourceMatchUpStatus:t,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:d}){let{structure:c}=Hc({drawDefinition:a,structureId:o});if((null==c?void 0:c.structureType)===vl)return{...At};let p=((null==(u=u??rf({drawDefinition:a}))?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=hv({drawPosition:i,matchUps:p}),f=null==p?void 0:p.filter((e=>{var t;return e.roundNumber>=l&&e.roundNumber!==m&&(null==(t=e.drawPositions)?void 0:t.includes(i))})),{positionAssignments:h}=Kc({drawDefinition:a,structureId:o});for(let v of f??[])JN({inContextDrawMatchUps:e,sourceMatchUpStatus:t,positionAssignments:h,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:v,event:d})}({targetDrawPosition:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:d,matchUpsMap:u,roundNumber:h,structureId:f}),{...At}}function XN({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:o}){let s=a.target.structureId,l="removeDirectedBye";return Iv({color:"brightyellow",method:l,drawPosition:n}),La({result:bv({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:s,event:o}),stack:l})}function eM(e){var t,i;let{tournamentRecord:n,appliedPolicies:r,drawDefinition:a,matchUpsMap:o,targetData:s,structure:l,event:u}=e,d="doubleExitAdvancement";if(l.structureType===vl)return La({result:{...At},stack:d});let{matchUp:c,targetMatchUps:p,targetLinks:m}=s,{loserMatchUp:f,winnerMatchUp:h,loserTargetDrawPosition:v}=p,g=[kc,Tc].includes(null==f?void 0:f.matchUpStatus)&&!(null!=(t=f.sides)&&t.map((e=>e.participantId??e.participant)).filter(Boolean).length);if(f&&f.matchUpStatus!==Sc){let{loserTargetLink:t}=m;if(null!=(i=null==r?void 0:r.progression)&&i.doubleExitPropagateBye){let e=iM({loserTargetDrawPosition:v,tournamentRecord:n,loserTargetLink:t,drawDefinition:a,loserMatchUp:f,matchUpsMap:o,event:u});if(e.error)return La({result:e,stack:d})}else if(!g){let{feedRound:t,drawPositions:i,matchUpId:r}=f,a=t?2:2-i.indexOf(v),o=tM({...e,targetMatchUp:f,walkoverWinningSide:a,tournamentRecord:n,sourceMatchUp:c,matchUpId:r});if(o.error)return La({result:o,stack:d})}}if(h){let t=tM({...e,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:n,sourceMatchUp:c});if(t.error)return La({result:t,stack:d})}return La({result:{...At},stack:d})}function tM(e){var t,i,n;let{inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:u}=e,d=o.structures.find((({structureId:e})=>e===l.structureId)),c=e.matchUpStatus===bc?bc:Rc,p=e.matchUpStatus===bc?Tc:kc,m="conditionallyAdvanceDrawPosition",f=u.drawMatchUps.find((e=>e.matchUpId===l.matchUpId));if(!f)return{error:Ji};let h=(null==s?void 0:s.drawPositions)||[],v=null==(t=f.drawPositions)?void 0:t.filter(Boolean),g=(null==s?void 0:s.structureId)===l.structureId;if(g&&pt(h,v)&&(v=v.filter((e=>!h.includes(e)))),g&&v.length>1)return La({result:{error:Kt},stack:m});let{pairedPreviousMatchUpIsDoubleExit:I,pairedPreviousMatchUp:U}=zg(e),y=zh({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:o}),{targetMatchUps:S,targetLinks:w}=y,{loserTargetDrawPosition:P,winnerMatchUp:D,loserMatchUp:T}=S;if(T){let{loserTargetLink:e}=w,t=iM({loserTargetDrawPosition:P,loserMatchUp:T,tournamentRecord:a,loserTargetLink:e,drawDefinition:o,matchUpsMap:u});if(t.error)return La({result:t,stack:m})}let b,R=(null==(i=f.drawPositions)?void 0:i.filter(Boolean))||[],N=1===R.length,M=e.walkoverWinningSide||N&&Jg({drawPosition:R[0],matchUpId:l.matchUpId,inContextDrawMatchUps:r})||void 0,A=[kc,Tc].includes(f.matchUpStatus)&&!R.length,E=1===f.finishingRound,C=A&&!E?c:p,O=r.find((e=>e.matchUpId===U.matchUpId)),k=[];s&&((null==s?void 0:s.structureId)===(null==O?void 0:O.structureId)?b=s.roundPosition<(null==U?void 0:U.roundPosition)?1:2:l.feedRound?b=s.structureId===l.structureId?2:1:M&&(b=3-M));let F=e.matchUpStatus,x=null==U?void 0:U.matchUpStatus;1===b?k=[{matchUpStatus:nM(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:nM(x),previousMatchUpStatus:x,sideNumber:2}]:2===b&&(k=[{matchUpStatus:nM(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:nM(F),previousMatchUpStatus:F,sideNumber:2}]),k.length&&(k=k.map((e=>_a(e))));let _=qy({...e,winningSide:M,matchUp:f,matchUpStatusCodes:k,context:m,matchUpStatus:C});if(_.error)return La({result:_,stack:m});if(A)return eM({...e,matchUpStatus:C,targetData:y});if(!D)return La({result:{...At},stack:m});let L=2===v.length?v[M-1]:v[0],{positionAssignments:B}=Kc({structure:d}),V=null==B?void 0:B.find((e=>e.drawPosition===L)),j=u.drawMatchUps.find((e=>e.matchUpId===D.matchUpId)),G=null==(n=null==j?void 0:j.drawPositions)?void 0:n.filter(Boolean),$=1===G.length;if(L){if(null!=V&&V.bye){let t=zh({matchUpId:j.matchUpId,inContextDrawMatchUps:r,drawDefinition:o});if($){let t=G.filter(Boolean)[0],i=Jg({drawPosition:t,matchUpId:j.matchUpId,inContextDrawMatchUps:r}),n=qy({appliedPolicies:e.appliedPolicies,matchUpId:j.matchUpId,matchUp:j,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,winningSide:i});return n.error?La({result:n,stack:m}):Pv({drawPositionToAdvance:t,matchUpId:j.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,matchUpsMap:u})}if([kc,Tc].includes(D.matchUpStatus)){let i=eM({...e,matchUpId:j.matchUpId,matchUpStatus:C,targetData:t});if(i.error)return La({result:i,stack:m})}return La({result:{...At},stack:m})}return Qg({matchUpId:D.matchUpId,drawPosition:L,inContextDrawMatchUps:r,drawDefinition:o})}if(I){if(!j)return{error:Ji};if($){let e=G[0],t=Jg({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawPosition:e});console.log("existing drawPosition is winningSide",{walkoverWinningSide:t})}let t=[kc,Tc].includes(j.matchUpStatus)?p:c,i=qy({matchUpId:j.matchUpId,appliedPolicies:e.appliedPolicies,matchUp:j,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,matchUpStatus:t});if(i.error)return La({result:i,stack:m});if(t===c){let i=eM({...e,matchUpId:l.matchUpId,matchUpStatus:t,targetData:y});if(i.error)return i}}return La({result:{...At},stack:m})}function iM(e){var t;let{loserTargetDrawPosition:i,tournamentRecord:n,loserTargetLink:r,drawDefinition:a,matchUpsMap:o,event:s}=e,l=null==(t=null==r?void 0:r.target)?void 0:t.structureId,{structure:u}=Hc({drawDefinition:a,structureId:l});return u?yv({drawPosition:i,tournamentRecord:n,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:Pi}}function nM(e){return e===Rc?kc:e===bc?Tc:e}function rM(e){let{tournamentRecord:t,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=e,o=!(!a.tieMatchUps||a.rondPosition||!e.inContextDrawMatchUps.find((e=>e.matchUpId===a.matchUpId)).containerStructureId),s=n===Sc,l=a.winningSide,u=[Rc,bc].includes(n),d=cv({matchUpStatus:n}),c=pv({matchUpStatus:n}),p=!d&&!c,m=e.matchUpTieId||l&&d&&!u,f=l&&u;return p&&{error:_i}||m&&aM(e)||f&&function(e){let t=QN(e);return t.error?t:eM(e)}(e)||l&&QN(e)||c&&qy({...e,removeScore:[wc,kc].includes(n),matchUpStatus:n||Oc})||s&&function({tournamentRecord:e,drawDefinition:t,structure:i,matchUp:n}){var r;let a="attemptToSetMatchUpStatusBYE";if(null!=n&&n.winningSide)return La({result:{error:Vi},context:{matchUpStatus:Sc},stack:a});let{positionAssignments:o}=Jc({structure:i}),s=null==o?void 0:o.filter((e=>e.bye)).map((e=>e.drawPosition));return null!=(r=n.drawPositions)&&r.some((e=>null==s?void 0:s.includes(e)))?(n.matchUpStatus=Sc,n.matchUpStatusCodes=[],Cp({tournamentId:null==e?void 0:e.tournamentId,context:a,drawDefinition:t,matchUp:n}),{...At}):La({result:{error:xi},info:"matchUp does not include BYE",stack:a})}({tournamentRecord:t,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:_i}||u&&function(e){let t=aM({...e,removeScore:!0});return t.error?t:eM(e)}(e)||o&&aM(e)||La({result:{error:Vi},stack:"attemptToSetMatchUpStatus"})}function aM(e){var t;let i="scoreModification";if(e.isCollectionMatchUp&&null!=(t=e.dualMatchUp)&&t.winningSide&&!e.projectedWinningSide){let t=QN(e);if(t.error)return La({result:t,stack:i})}let n=!!e.matchUp.collectionId,r=qy({...e,context:i});if(n){let{matchUpTieId:t,drawDefinition:n,matchUpsMap:a}=e,o=Xy({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:t,event:e.event,drawDefinition:n,matchUpsMap:a});if(o.error)return La({result:o,stack:i});Object.assign(r,{tieMatchUpResult:o})}return La({result:r,stack:i})}function oM({drawDefinition:e,structure:t,matchUp:i}){let n=[];if(t.finishingPosition===Zl&&II({drawDefinition:e,structure:t})){let{structureIds:r}=function({drawDefinition:e,structure:t,matchUp:i}){var n,r,a,o;let{drawPositions:s}=i,{positionAssignments:l}=Kc({drawDefinition:e,structure:t}),u=null==(n=null==l?void 0:l.filter((({drawPosition:e})=>null==s?void 0:s.includes(e))))?void 0:n.map((e=>{var t;let{extension:i}=Cd({element:e,name:tc});return null==(t=null==i?void 0:i.value)?void 0:t.groupOrder})),{containerStructures:d}=Vp({drawDefinition:e});return{structureIds:null==(o=null==(a=null==(r=Wh({drawDefinition:e,structureId:d[t.structureId]}))?void 0:r.links)?void 0:a.source)?void 0:o.filter((e=>{var t;return pt(u,(null==(t=e.source)?void 0:t.finishingPositions)||[])})).map((e=>e.source.structureId))}}({drawDefinition:e,structure:t,matchUp:i});null!=r&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function sM(e){var t,i;let n,r="attemptToSetWinningSide",{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:u,structure:d,matchUp:c}=e;if(null!=l&&l._disableAutoCalc&&!1!==o)return Wy(e);if(c.winningSide&&c.winningSide!==u){let{connectedStructureIds:t}=oM({drawDefinition:s,structure:d,matchUp:c});t.length&&(console.log({connectedStructureIds:t}),n=!0);let i=QN(e);if(i.error)return i}let p,m,f=eS(e);return f.error?La({result:f,stack:r}):(e.qualifierChanging&&null!=(t=null==a?void 0:a[ld])&&t.autoReplaceQualifiers&&(p=function(e){var t,i,n;let r,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=e,u=null==(t=e.targetData.targetLinks)?void 0:t.winnerTargetLink;if(u.target.feedProfile===gl){let t=o.sides.find((({sideNumber:e})=>e!==l)).participantId,d=a.find((e=>e.structureId===u.target.structureId&&e.roundNumber===u.target.roundNumber&&e.sides.some((({participantId:e})=>e===t))));if((null==d?void 0:d.matchUpStatus)===Oc&&!CS({inContextDrawMatchUps:a,drawDefinition:s,targetData:zh({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s})})){let{structure:a}=Hc({structureId:d.structureId,drawDefinition:s}),u=Kc({structure:a}).positionAssignments;for(let d of u||[])if(d.participantId===t){let t=o.sides.find((({sideNumber:e})=>e===l)).participantId;if(d.participantId=t,null==a?void 0:a.positionAssignments)a.positionAssignments=u;else if(null!=a&&a.structures){let e=Object.assign({},...(u||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of a.structures)null==(i=t.positionAssignments)||i.forEach((t=>t.participantId=e[t.drawPosition]))}xp({tournamentId:null==(n=e.tournamentRecord)?void 0:n.tournamentId,event:e.event,drawDefinition:s,structure:a}),r=!0}}}return{...At,qualifierReplaced:r}}(e).qualifierReplaced),e.qualifierAdvancing&&null!=(i=null==a?void 0:a[ld])&&i.autoPlaceQualifiers&&(m=function(e){var t,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u,winningSide:d}=e,c=null==(t=e.targetData.targetLinks)?void 0:t.winnerTargetLink;if(c.target.feedProfile===gl){let t=null==(i=l.sides.find((({sideNumber:e})=>e===d)))?void 0:i.participantId,p=st(s.filter((e=>e.structureId===c.target.structureId&&e.roundNumber===c.target.roundNumber&&e.sides.some((({participantId:e,qualifier:t})=>t&&!e)))));if((null==p?void 0:p.matchUpStatus)===Oc&&!CS({inContextDrawMatchUps:s,drawDefinition:u,targetData:zh({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:u})})){let i=null==(n=p.sides.find((e=>e.qualifier&&!e.participantId)))?void 0:n.drawPosition,{structure:s}=Hc({structureId:p.structureId,drawDefinition:u});if(!s)return{error:Si};let l=Kc({structure:s}).positionAssignments;for(let n of l||[])if(n.drawPosition===i&&!n.participantId){if(n.participantId=t,s.positionAssignments)s.positionAssignments=l;else if(s.structures){let e=Object.assign({},...(l||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of s.structures)null==(r=t.positionAssignments)||r.forEach((t=>t.participantId=e[t.drawPosition]))}xp({tournamentId:null==(a=e.tournamentRecord)?void 0:a.tournamentId,event:e.event,drawDefinition:u,structure:s}),o=!0}}}return{...At,qualifierPlaced:o}}(e).qualifierPlaced),La({result:_a({...At,...f,connectedStructures:n,qualifierReplaced:p,qualifierPlaced:m}),stack:r}))}be(FN,{applyLineUps:()=>HM,assignMatchUpSideParticipant:()=>xN,assignTieMatchUpParticipantId:()=>HN,bulkMatchUpStatusUpdate:()=>BM,checkInParticipant:()=>BN,checkOutParticipant:()=>LN,disableTieAutoCalc:()=>kM,enableTieAutoCalc:()=>EM,findMatchUp:()=>xT,removeDelegatedOutcome:()=>CM,removeMatchUpSideParticipant:()=>KN,removeTieMatchUpParticipantId:()=>YN,replaceTieMatchUpParticipantId:()=>GN,resetAdHocMatchUps:()=>qM,resetMatchUpLineUps:()=>xM,resetScorecard:()=>$M,resetTieFormat:()=>GM,setDelegatedOutcome:()=>jM,setMatchUpFormat:()=>FM,setMatchUpStatus:()=>LM,setOrderOfFinish:()=>WM,substituteParticipant:()=>OM,toggleParticipantCheckInState:()=>VN,updateTieMatchUpScore:()=>Xy});var lM={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function uM(e){var t,i,n,r;let{inContextDrawMatchUps:a,appliedPolicies:o,drawDefinition:s,matchUpsMap:l,targetData:u,matchUp:d}=e,{matchUpId:c}=d,{iteration:p=0}=e;p+=1;let m="removeDoubleExit";Iv({color:"brightyellow",method:m,matchUpId:c,iteration:p,keyColors:lM});let{targetMatchUps:{loserMatchUp:f,winnerMatchUp:h,loserTargetDrawPosition:v},targetLinks:{loserTargetLink:g}}=u;if(h&&h.matchUpStatus!==Sc){let{stage:t,roundNumber:i,roundPosition:n,structureName:r}=h;Iv({winner:"winner",roundPosition:n,structureName:r,roundNumber:i,keyColors:lM,stage:t}),dM({...e,targetMatchUp:h,sourceMatchUp:d,iteration:p})}let I=(null==f?void 0:f.matchUpStatus)===Sc&&((null==f?void 0:f.feedRound)||1===(null==f?void 0:f.roundNumber)),U=(null==(i=null==(t=null==u?void 0:u.targetLinks)?void 0:t.loserTargetLink)?void 0:i.linkCondition)===Dl;if(I&&U){let e=a.filter((({roundNumber:e,structureId:t})=>t===d.structureId&&1===e)),t=ht(e.map((({roundPosition:e})=>e)).sort(),2).find((e=>e.includes(d.roundPosition)));if((null==(n=e.filter((({roundPosition:e})=>t.includes(e))))?void 0:n.map((({matchUpStatus:e})=>e))).every((e=>[bc,Rc].includes(e))))return La({result:{...At},stack:m})}if(f&&(f.matchUpStatus!==Sc||I)){let t=a.find((({matchUpId:e})=>e===f.matchUpId)),{structure:i}=Hc({drawDefinition:s,structureId:t.structureId}),{stage:n,roundNumber:u,roundPosition:d,feedRound:c,structureName:h}=f;if(Iv({loser:"loser",roundPosition:d,structureName:h,roundNumber:u,keyColors:lM,feedRound:c,stage:n}),(null==(r=null==o?void 0:o.progression)?void 0:r.doubleExitPropagateBye)||I)XN({drawPosition:v,targetLink:g,inContextDrawMatchUps:a,drawDefinition:s,matchUpsMap:l});else{let t=dM({...e,targetMatchUp:f,structure:i,iteration:p});if(t.error)return La({result:t,stack:m})}}return La({result:{...At},stack:m})}function dM(e){var t,i,n,r,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,sourceMatchUp:d,targetMatchUp:c,matchUpsMap:p,structure:m,iteration:f}=e,h="conditionallyRemoveDrawPosition";Iv({method:h,structureName:null==m?void 0:m.structureName,iteration:f});let v,g,I,U=zh({matchUpId:c.matchUpId,inContextDrawMatchUps:s,drawDefinition:u}),{targetMatchUps:{winnerMatchUp:y}}=U,S=null==p?void 0:p.drawMatchUps.find((e=>e.matchUpId===c.matchUpId)),w=[];if(c.feedRound)I=null==(i=null==(t=null==y?void 0:y.drawPositions)?void 0:t.filter(Boolean))?void 0:i.find((e=>c.drawPositions.includes(e)));else if(d){if(g=null==(r=Yg({structureId:m.structureId,matchUp:d,matchUpsMap:p}))?void 0:r.pairedPreviousMatchUp,v=[Rc,bc].includes(null==g?void 0:g.matchUpStatus),w=(null==(a=null==g?void 0:g.drawPositions)?void 0:a.filter(Boolean))||[],[...Vc,Sc].includes(null==g?void 0:g.matchUpStatus)||(null==g?void 0:g.winningSide)){let e=d.drawPositions||[],t=null==(o=c.drawPositions)?void 0:o.filter(Boolean);pt(e,t)&&(t=null==t?void 0:t.filter((t=>!e.includes(t)))),I=e.concat(w).find((e=>null==t?void 0:t.includes(e)))}}else I=null==(n=dt((null==c?void 0:c.drawPositions)||[],(null==y?void 0:y.drawPositions)||[]))?void 0:n[0];if(y&&I){let{stage:e,roundNumber:t,roundPosition:i,structureName:n}=y;Iv({method:"removeDirectedWinner",drawPositionToRemove:I,color:"brightgreen",roundPosition:i,structureName:n,roundNumber:t,keyColors:lM,stage:e}),ZN({winningDrawPosition:I,winnerMatchUp:y,inContextDrawMatchUps:s,drawDefinition:u,matchUpsMap:p})}let P=uM({targetData:U,matchUp:c,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,matchUpsMap:p,structure:m,iteration:f});if(P.error)return La({result:P,stack:h});let D=function({pairedPreviousDoubleExit:e,noContextTargetMatchUp:t}){return t.matchUpStatus===Sc?Sc:e?[bc,Tc].includes(null==t?void 0:t.matchUpStatus)?Tc:kc:Oc}({pairedPreviousDoubleExit:v,noContextTargetMatchUp:S}),T=!v;return P=qy({...e,matchUpId:c.matchUpId,matchUp:S,removeWinningSide:!0,matchUpStatusCodes:[],context:h,matchUpStatus:D,removeScore:T,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),P.error?La({result:P,stack:h}):{...At}}function cM(e){var t;let{matchUp:i,matchUpStatus:n,score:r,winningSide:a}=e,o="noDownStreamDependencies";if([Rc,bc].includes(null==i?void 0:i.matchUpStatus)&&![Rc,bc].includes(n)){let t=uM(e);if(t.error)return La({result:t,stack:o})}let s=n===Rc,l=dv({score:r})&&!s&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!a),u=(null==(t=null==e?void 0:e.inContextMatchUp)?void 0:t.collectionId)&&function(e){var t,i;let{matchUpFormat:n,score:r}=e,a=null==(t=null==r?void 0:r.sets)?void 0:t.length,o=n&&no(n),{setFormat:s,finalSetFormat:l,bestOf:u}=o??{};return(null==(i=u&&a===u&&l||s)?void 0:i.timed)||!1}(e.inContextMatchUp),d=e.removeScore||!u&&![Mc,Uc].includes(n||Mc),c=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||i.winningSide&&!a&&!dv({score:r}),p=n&&n!==Oc,m=t=>{var n,r;let a,{structure:o,drawDefinition:s,dualMatchUp:l,disableAutoCalc:u}=e;if(null!=l&&l._disableAutoCalc&&!1!==u)return Wy({...e,removeWinningSide:c});let{connectedStructureIds:d}=oM({drawDefinition:s,structure:o,matchUp:i});d.length&&(console.log({connectedStructureIds:d}),a=!0),Object.assign(e,{removeScore:t});let p=QN(e);if(p.error)return p;if(e.removingQualifier&&null!=(r=null==(n=e.appliedPolicies)?void 0:n[ld])&&r.autoRemoveQualifiers){let t=function(e){var t,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u}=e,d=null==(t=e.targetData.targetLinks)?void 0:t.winnerTargetLink;if(d.target.feedProfile===gl){let t=null==(n=null==(i=l.sides)?void 0:i.find((({sideNumber:e})=>e===l.winningSide)))?void 0:n.participantId,c=s.find((e=>{var i;return e.structureId===d.target.structureId&&e.roundNumber===d.target.roundNumber&&(null==(i=e.sides)?void 0:i.some((({participantId:e})=>e===t)))}));if(c&&c.matchUpStatus===Oc&&!CS({inContextDrawMatchUps:s,drawDefinition:u,targetData:zh({matchUpId:c.matchUpId,inContextDrawMatchUps:s,drawDefinition:u})})){let{structure:i}=Hc({structureId:c.structureId,drawDefinition:u}),n=Kc({structure:i}).positionAssignments;for(let s of n||[])if(s.participantId===t){if(s.participantId=void 0,null==i?void 0:i.positionAssignments)i.positionAssignments=n;else if(null!=i&&i.structures){let e=Object.assign({},...(n||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of(null==i?void 0:i.structures)||[])null==(r=t.positionAssignments)||r.forEach((t=>t.participantId=e[t.drawPosition]))}xp({tournamentId:null==(a=e.tournamentRecord)?void 0:a.tournamentId,event:e.event,drawDefinition:u,structure:i}),o=!0}}}return{qualifierRemoved:o}}(e);return{...At,connectedStructures:a,...t}}return{...At,connectedStructures:a}};if(c&&a&&e.isCollectionMatchUp)return pM(e);let f=[wc,Uc].includes(n)&&e.dualWinningSideChange;return La({result:(a||f)&&sM(e)||l&&m(d)||p&&rM(e)||c&&m(d)||i&&pM({...e,removeScore:!0})||{...At},stack:o})}function pM(e){var t;let i="ndd:scoreModification";if(e.isCollectionMatchUp&&null!=(t=e.dualMatchUp)&&t.winningSide&&!e.projectedWinningSide&&!e.autoCalcDisabled){let t=QN(e);if(t.error)return t}let n=qy({...e,context:i});if(e.isCollectionMatchUp){let{matchUpTieId:t,drawDefinition:i,event:n,matchUpsMap:r}=e,{removeWinningSide:a}=Xy({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:t,drawDefinition:i,matchUpsMap:r,event:n});a&&console.log("REMOVE WINNING SIDE")}return La({result:n,stack:i})}function mM(e){var t,i,n;let r=qu(e,[{[au]:!0,[su]:!0,[Iu]:!0},{homeParticipantId:!0,[Mu]:xn}]);if(r.error)return r;let a=Gb(e,[{[Eu]:Ru,attr:{[yu]:!0}}]);if(a.error)return a;let o=null==(n=null==(i=null==(t=null==a?void 0:a.matchUp)?void 0:t.matchUp)?void 0:i.sides)?void 0:n.map((e=>null==e?void 0:e.participantId));if(e.homeParticipantId&&(null==o||!o.includes(e.homeParticipantId)))return{error:Mn};let{disableNotice:s,homeParticipantId:l,removePriorValues:u,tournamentRecord:d,drawDefinition:c,matchUpId:p}=e;return _N({duplicateValues:!1,removePriorValues:u,tournamentRecord:d,drawDefinition:c,disableNotice:s,matchUpId:p,timeItem:{itemType:Af,itemValue:l}})}function fM({timeStamp:e,schedule:t,matchUp:i}){let{itemValue:n,timeStamp:r}=Ih({timeItems:(null==i?void 0:i.timeItems)||[],itemType:_f});return!t||r&&e&&new Date(r).getTime()>new Date(e).getTime()?{timeModifiers:n}:t}function hM(e){var t;let i="addMatchUpScheduledTime",n=e.matchUp,{removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:u}=e;if(!u)return La({result:{error:Hi},stack:i});if(!Io(l))return La({result:{error:gn},stack:i});if(!n){let e=Vy({drawDefinition:o,matchUpId:u});if(e.error)return La({result:e,stack:i});n=e.matchUp}let d=Eo(l),c=yh({matchUp:n}).scheduledDate,p=d&&!c;if(null!=(t=fM({matchUp:n}).timeModifiers||[])&&t.length){let e=vM({disableNotice:!0,removePriorValues:r,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:u,matchUp:n});if(null!=e&&e.error)return La({result:e,stack:i})}let m=ko(l,!0,p);return _N({duplicateValues:!1,removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:u,timeItem:{itemType:Cf,itemValue:m}})}function vM({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return La({result:{error:Hi},stack:s});if(void 0!==r&&!Array.isArray(r))return La({info:eI("timeModifiers"),result:{error:Cr},stack:s});if(!o){let e=Vy({drawDefinition:i,matchUpId:a});if(e.error)return La({result:e,stack:s});o=e.matchUp}let l=fM({matchUp:o}).timeModifiers||[],u=r.filter((e=>!l.includes(e)));if(r.length&&!u.length)return{...At};if(u.some((e=>$f.includes(e)))){l=l.filter((e=>!$f.includes(e)));let n=hM({disableNotice:!0,removePriorValues:e,scheduledTime:"",tournamentRecord:t,drawDefinition:i,matchUpId:a});if(n.error)return La({result:n,stack:s})}let d=null!=r&&r.length?[...u,...l]:void 0;return _N({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:_f,itemValue:d}})}function gM({scheduledDate:e,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:Hi};let o=e&&fo.test(e);return e&&!o?{error:vn}:_N({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemValue:Eo(e),itemType:Mf}})}function IM({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtIds:s}){var l,u;if(!i&&!t)return{error:Bt};if(!o)return{error:Hi};let d,c=Vy({drawDefinition:n,matchUpId:o});if(c.error)return c;if((null==(l=null==c?void 0:c.matchUp)?void 0:l.matchUpType)!==ke)return{error:Qi};if(!(void 0===s||Array.isArray(s)&&s.length&&s.every((e=>"string"==typeof e))))return{error:Cr,context:{courtIds:s}};if(s){let e=$T({tournamentRecords:t||i&&{[i.tournamentId]:i}});if(e.error)return e;let n=null==(u=e.courts)?void 0:u.filter((e=>s.includes(e.courtId)));if((null==n?void 0:n.length)!==s.length)return{error:Cr,context:{courtIds:s}};d=null==n?void 0:n.map((e=>({venueId:e.venueId,courtId:e.courtId})))}return _N({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:bf,itemDate:a,itemValue:d}})}function UM({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:o}){if(!i)return{error:Bt};if(!a)return{error:Hi};if(o){let e=Th({tournamentRecords:t,tournamentRecord:i,venueId:o});if(e.error)return e}return _N({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Tf,itemValue:o}})}function yM({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!t)return{error:Bt};if(!o)return{error:Hi};if(s){let e=Rh({tournamentRecords:t,tournamentRecord:i,courtId:s});if(e.error)return e;UM({tournamentRecords:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:null==(l=e.venue)?void 0:l.venueId})}return _N({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Rf,itemDate:a,itemValue:s}})}function SM(e,t){let i=mo.test(e)?e:Ao(e),n=Eo(e)||Eo(t)||So(new Date);return new Date(`${n}T${i}`).getTime()}function wM(e){var t;let i="addMatchUpScheduleItems",n=qu(e,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[Lu]:Ou}],i);if(n.error)return n;let r,a,{matchUpDependencies:o,inContextMatchUps:s}=e,{errorOnAnachronism:l=!1,checkChronology:u=!0,removePriorValues:d,tournamentRecords:c,tournamentRecord:p,drawDefinition:m,disableNotice:f,drawMatchUps:h,matchUpId:v,schedule:g,event:I}=e;if(h)r=h.find((e=>e.matchUpId===v));else{let e=Vy({drawDefinition:m,event:I,matchUpId:v});if(e.error)return e;r=e.matchUp}let{endTime:U,courtId:y,courtIds:S,courtOrder:w,resumeTime:P,homeParticipantId:D,scheduledDate:T,scheduledTime:b,startTime:R,stopTime:N,timeModifiers:M,venueId:A}=g;u&&(!o||!s)&&({matchUpDependencies:o,matchUps:s}=uv({drawDefinition:m}));let E=null==(t=null==o?void 0:o[v])?void 0:t.matchUpIds;if(g.scheduledDate&&u&&E){let e=null==s?void 0:s.filter((e=>{var t,i;return((null==(t=e.schedule)?void 0:t.scheduledDate)||Eo(null==(i=e.schedule)?void 0:i.scheduledTime))&&E.includes(e.matchUpId)})).map((({schedule:e})=>{let t=vo(e);return new Date(t).getTime()}));if(null!=e&&e.length){let t=vo(g),n=new Date(t).getTime();if(Math.max(...e)>=n){if(l)return La({result:{error:kt},stack:i});a=kt}}}if(void 0!==T){let e=gM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,scheduledDate:T,matchUpId:v});if(null!=e&&e.error)return La({result:e,stack:i,context:{scheduledDate:T}})}if(void 0!==b){let e=hM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,scheduledTime:b,matchUpId:v,matchUp:r});if(null!=e&&e.error)return La({result:e,stack:i,context:{scheduledTime:b}})}if(void 0!==R){let e=TM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:v,startTime:R,event:I});if(null!=e&&e.error)return La({result:e,stack:i,context:{startTime:R}})}if(void 0!==N){let e=RM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:v,stopTime:N,event:I});if(null!=e&&e.error)return La({result:e,stack:i,context:{stopTime:N}})}if(void 0!==P){let e=NM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,resumeTime:P,matchUpId:v,event:I});if(null!=e&&e.error)return La({result:e,stack:i,context:{resumeTime:P}})}if(void 0!==U){let e=bM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:v,endTime:U,event:I});if(null!=e&&e.error)return La({result:e,stack:i,context:{endTime:U}})}if(void 0!==S){let e=IM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:v,courtIds:S});if(null!=e&&e.error)return La({result:e,stack:i,context:{courtIds:S}})}if(void 0!==y&&void 0!==T){let e=yM({courtDayDate:T,disableNotice:!0,removePriorValues:d,tournamentRecords:c,tournamentRecord:p,drawDefinition:m,matchUpId:v,courtId:y});if(null!=e&&e.error)return La({result:e,stack:i,context:{courtId:y}})}if(void 0!==A){let e=UM({disableNotice:!0,removePriorValues:d,tournamentRecords:c,tournamentRecord:p,drawDefinition:m,matchUpId:v,venueId:A});if(null!=e&&e.error)return La({result:e,stack:i,context:{venueId:A}})}if(void 0!==w&&Ye(w)){let e=PM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,courtOrder:w,matchUpId:v});if(null!=e&&e.error)return La({result:e,stack:i,context:{courtOrder:w}})}if(void 0!==M){let e=vM({disableNotice:!0,removePriorValues:d,tournamentRecord:p,drawDefinition:m,timeModifiers:M,matchUpId:v,matchUp:r});if(null!=e&&e.error)return La({result:e,stack:i,context:{timeModifiers:M}})}return St(D)&&mM({disableNotice:!0,homeParticipantId:D,removePriorValues:d,tournamentRecord:p,drawDefinition:m,matchUpId:v}),f||Cp({tournamentId:null==p?void 0:p.tournamentId,eventId:null==I?void 0:I.eventId,context:i,drawDefinition:m,matchUp:r}),a?{...At,warnings:[a]}:{...At}}function PM({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:Hi};if(r&&!Ye(r))return{error:Cr,info:"courtOrder must be numeric"};let o=r&&Be(r);return _N({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:Nf,itemValue:o}})}function DM({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:o}){if(!o)return{error:Hi};if(!r)return{error:xn};if(t){if(!vd({tournamentParticipants:zv({tournamentRecord:t,participantFilters:{participantTypes:[zp],participantRoles:[dg]}}).participants??[],participantId:r}))return{error:_n}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(s.itemSubTypes=[a]),_N({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:s})}function TM({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:o}){if(!r)return{error:Hi};if(!Io(a))return{error:gn};let{matchUp:s}=Vy({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=yh({matchUp:s}),u=((null==s?void 0:s.timeItems)??[]).filter((e=>[kf,Ff,xf].includes(null==e?void 0:e.itemType))).map((e=>SM(e.itemValue,l))).reduce(((e,t)=>!e||t<e?t:e),void 0);if(!u||SM(a,l)<u){null!=s&&s.timeItems&&(s.timeItems=s.timeItems.filter((e=>e.itemType!==Of)));let o=ko(a,!0,!0);return _N({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:Of,itemValue:o}})}return{error:fr}}function bM({validateTimeSeries:e=!0,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:o,event:s}){if(!a)return{error:Hi};if(!Io(o))return{error:gn};let{matchUp:l}=Vy({drawDefinition:n,event:s,matchUpId:a}),{scheduledDate:u}=yh({matchUp:l}),d=((null==l?void 0:l.timeItems)??[]).filter((e=>[Of,Ff,kf].includes(null==e?void 0:e.itemType))).map((e=>SM(e.itemValue,u))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(!e||!d||SM(o,u)>d){null!=l&&l.timeItems&&(l.timeItems=l.timeItems.filter((e=>e.itemType!==xf)));let e=ko(o,!0,!0);return _N({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:xf,itemValue:e}})}return{error:cr}}function RM({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:o}){if(!r)return{error:Hi};if(!Io(a))return{error:gn};let{matchUp:s}=Vy({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=yh({matchUp:s}),u=(null==s?void 0:s.timeItems)??[];if(u.reduce(((e,t)=>t.itemType===xf||e),void 0))return{error:pr};let d=u.filter((e=>[Of,Ff,kf].includes(null==e?void 0:e.itemType))).sort(((e,t)=>SM(e.itemValue,l)-SM(t.itemValue,l))),c=d[d.length-1],p=c&&c.itemType===kf,m=d.filter((e=>!p||e.createdAt!==c.createdAt)).map((e=>SM(e.itemValue,l))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(SM(a,l)>m){if(null!=s&&s.timeItems&&p){let e=c.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return _N({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemValue:ko(a,!0,!0),itemType:kf}})}return{error:mr}}function NM({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:o}){if(!a)return{error:Hi};if(!Io(r))return{error:gn};let{matchUp:s}=Vy({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=yh({matchUp:s}),u=(null==s?void 0:s.timeItems)??[];if(u.reduce(((e,t)=>t.itemType===xf||e),void 0))return{error:pr};let d=u.filter((e=>[Of,Ff,kf].includes(null==e?void 0:e.itemType))).sort(((e,t)=>SM(e.itemValue,l)-SM(t.itemValue,l))),c=d[d.length-1],p=c&&c.itemType===Ff,m=d.filter((e=>!p||e.createdAt!==c.createdAt)).map((e=>SM(e.itemValue,l))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(SM(r,l)>m){if(null!=s&&s.timeItems&&p){let e=c.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return _N({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemValue:ko(r,!0,!0),itemType:Ff}})}return{error:hr}}function MM(e){var t,i,n;let r="setMatchUpStatus";e.matchUpStatus&&[kc,Rc].includes(e.matchUpStatus)&&(e.score=void 0);let{allowChangePropagation:a,disableScoreValidation:o,tournamentRecords:s,tournamentRecord:l,disableAutoCalc:u,enableAutoCalc:d,drawDefinition:c,matchUpStatus:p,winningSide:m,matchUpId:f,event:h,score:v}=e;if(!c)return{error:$t};if(p&&[wc,Mc,Uc,Oc].includes(p)&&m)return{error:Cr,winningSide:m,matchUpStatus:p};if(![void 0,..._c].includes(p))return La({result:{error:Vi},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let g=rf({drawDefinition:c}),{matchUps:I}=Qh({nextMatchUps:!0,tournamentRecord:l,inContext:!0,drawDefinition:c,matchUpsMap:g,event:h}),U=g.drawMatchUps.find((e=>e.matchUpId===f)),y=null==I?void 0:I.find((e=>e.matchUpId===f));if(!U||!I)return{error:Yi};if((U.winningSide||m)&&p===Sc)return{context:"Cannot have Bye with winningSide",error:Bi,matchUpStatus:p};let S=null==y?void 0:y.structureId,{structure:w}=Hc({drawDefinition:c,structureId:S}),P=Xf(Fe)(U.matchUpType),D=null==(t=null==y?void 0:y.drawPositions)?void 0:t.filter(Boolean),T=null==y?void 0:y.matchUpTieId,b=zh({matchUpId:T||f,inContextDrawMatchUps:I,drawDefinition:c});Object.assign(e,{inContextDrawMatchUps:I,inContextMatchUp:y,matchUpTieId:T,matchUpsMap:g,targetData:b,structure:w,matchUp:U});let R,N=CS(e);if(P){if(u)Sd({extension:{name:_d,value:!0},element:U});else if(d){let t=U.winningSide,{winningSide:i,scoreStringSide1:n,scoreStringSide2:r,set:a}=Yy({drawDefinition:c,matchUpsMap:g,structure:w,matchUp:U,event:h}),o={scoreStringSide1:n,scoreStringSide2:r,sets:a?[a]:[]};if(R=i!==t,N&&R)return La({stack:"winningSideWithDownstreamDependencies",result:{error:Rn},context:{winningSide:m,matchUp:U}});Ud({name:_d,element:U}),Object.assign(e,{winningSide:i,dualWinningSideChange:R,projectedWinningSide:i,score:o})}Ky({tournamentId:null==l?void 0:l.tournamentId,inContextDualMatchUp:y,eventId:null==h?void 0:h.eventId,dualMatchUp:U,drawDefinition:c})}if(P&&p&&[yc].includes(p))return{info:"Not supported for matchUpType: TEAM",error:Cr};if(v&&!P&&!o){let e=U.matchUpFormat??(null==w?void 0:w.matchUpFormat)??(null==c?void 0:c.matchUpFormat)??(null==h?void 0:h.matchUpFormat),t=FD({existingMatchUpStatus:U.matchUpStatus,matchUpFormat:e,matchUpStatus:p,winningSide:m,score:v});if(t.error)return t}let M=(null==(i=gm({policyTypes:[ld,cd],tournamentRecord:l,drawDefinition:c,event:h}))?void 0:i.appliedPolicies)??{};wt(e.policyDefinitions)&&Object.assign(M,e.policyDefinitions);let A=function({assignedDrawPositions:e,inContextMatchUp:t,appliedPolicies:i,drawDefinition:n,matchUpStatus:r,structure:a,matchUp:o}){var s,l;if(!1===(null==(s=null==i?void 0:i[cd])?void 0:s.requireParticipantsForScoring))return{...At};let u=null==(l=null==t?void 0:t.sides)?void 0:l.map((e=>e.participantId)).filter(Boolean).length,d=null!=o&&o.sides?[]:Kc({structureId:null==a?void 0:a.structureId,drawDefinition:n}).positionAssignments,c=u&&2===u||o.collectionId&&mf({structure:a})&&u&&u>=1||2===(null==e?void 0:e.length)&&(null==d?void 0:d.filter((t=>e.includes(t.drawPosition))).every((e=>e.participantId)));return r&&xc.includes(r)&&!c?La({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:r,requiredParticipants:c},result:{error:Vi}}):{...At}}({assignedDrawPositions:D,inContextMatchUp:y,appliedPolicies:M,drawDefinition:c,matchUpStatus:p,structure:w,matchUp:U});if(null!=A&&A.error)return A;let E=(null==y?void 0:y.stage)===nl&&1===y.finishingRound,C=E&&m,O=E&&U.winningSide&&!m&&(!e.matchUpStatus||e.matchUpStatus&&pv({matchUpStatus:e.matchUpStatus}))&&(!e.outcome||!dv({outcome:e.outcome})),k=C&&m!==U.winningSide&&U.winningSide;if(Object.assign(e,{qualifierAdvancing:C,qualifierChanging:k,removingQualifier:O,appliedPolicies:M}),T){let{matchUp:t}=Vy({matchUpId:T,inContext:!0,drawDefinition:c,matchUpsMap:g,event:h});if(t){let i=null==(n=nf({matchUp:t,drawDefinition:c,structure:w,event:h}))?void 0:n.tieFormat,{projectedWinningSide:r}=function({drawDefinition:e,matchUpStatus:t,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var d;let c=ts(r,void 0,!0);for(let m of(null==c?void 0:c.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=n,m.score=u,dv({score:u})||t?t&&(m.matchUpStatus=t):Object.assign(m,{...$y}));a=a??(null==(d=nf({matchUp:s,structure:o,drawDefinition:e,event:l}))?void 0:d.tieFormat);let{winningSide:p}=Yy({matchUp:c,drawDefinition:e,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}({drawDefinition:c,matchUpStatus:p,dualMatchUp:t,matchUpsMap:g,winningSide:m,tieFormat:i,structure:w,matchUp:U,event:h,score:v});R=r!==t.winningSide;let a=t._disableAutoCalc;Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:R,projectedWinningSide:r,autoCalcDisabled:a,matchUpTieId:T,dualMatchUp:t,tieFormat:i})}}let F=cv({matchUpStatus:p});if(!T){if(N&&!m&&(p&&pv({matchUpStatus:p})||p&&[Rc,bc].includes(p)))return{error:Bi,activeDownstream:N,winningSide:m};if(m&&m===U.winningSide&&p&&!F)return{context:"winningSide must include directing matchUpStatus",error:Bi,directingMatchUpStatus:F,matchUpStatus:p}}let{schedule:x}=e;if(x){let e=wM({disableNotice:!0,tournamentRecords:s,tournamentRecord:l,drawDefinition:c,matchUpId:f,schedule:x});if(e.error)return e}let _=!P&&!R&&m&&U.winningSide&&U.winningSide!==m;if(a&&_&&U.roundPosition)return function(e){var t;let{tournamentRecord:i,inContextMatchUp:n,structure:r,drawDefinition:a}=e,o=n.roundNumber,s=n.sides.find((e=>e.sideNumber===n.winningSide)),l=n.sides.find((e=>e.sideNumber!==n.winningSide)),{drawPosition:u,participantId:d}=s,{drawPosition:c,participantId:p}=l,m="swapWinnerLoser",{matchUps:f}=jh(e),h=f.filter((({drawPositions:e,roundNumber:t})=>(null==e?void 0:e.includes(u))&&t>o));aa({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach((t=>{var n,r;t.drawPositions=(null==(n=t.drawPositions)?void 0:n.map((e=>e===u?c:e)))||[],Cp({tournamentId:null==i?void 0:i.tournamentId,eventId:null==(r=e.event)?void 0:r.eventId,context:m,drawDefinition:a,matchUp:t})}));let{stage:v,stageSequence:g}=r,I=a.structures.filter((({stage:e,stageSequence:t})=>e===v&&t>g)).map((({structureId:e})=>e)),{targetLinks:{loserTargetLink:U,winnerTargetLink:y}}=e.targetData,S=[null==U?void 0:U.target.structureId,null==(t=null==y?void 0:y.target)?void 0:t.structureId].filter(Boolean);return a.structures.filter((({stage:e,structureId:t})=>e!==v&&S.includes(t))).forEach((({stage:e,stageSequence:t,structureId:i})=>{I.includes(i)||I.push(i),a.structures.filter((({stage:i,stageSequence:n})=>i===e&&n>t)).forEach((({structureId:e})=>{I.includes(e)||I.push(e)}))})),a.structures.filter((({structureId:e})=>I.includes(e))).forEach((e=>{let{positionAssignments:t}=Kc({structure:e}),i=null==t?void 0:t.find((({participantId:e})=>e===d)),n=null==t?void 0:t.find((({participantId:e})=>e===p));i&&(i.participantId=p),n&&(n.participantId=d)})),qy({...e,context:m})}(e);let L=m&&!T||e.projectedWinningSide;Iv({activeDownstream:N,matchUpWinner:L,method:r,winningSide:m});let B=!N&&cM(e)||L&&function(e){let{matchUp:t,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=e;return i===t.winningSide||n&&!r?AM(e):La({stack:"winningSideWithDownstreamDependencies",result:{error:Rn},context:{winningSide:i,matchUp:t}})}(e)||(F||e.autoCalcDisabled)&&AM(e)||{error:Fr};return La({result:B,stack:r})}function AM(e){let{tournamentRecord:t,matchUp:i,event:n}=e,r=e.isCollectionMatchUp&&i.winningSide&&!e.winningSide&&!dv({score:e.score}),a=e.isCollectionMatchUp?e.matchUpStatus||r&&Oc||e.winningSide&&Pc||Mc:e.matchUpStatus||Pc,o=e.removeScore||[wc,kc].includes(a)&&![Mc,Uc].includes(a),s=qy({...e,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:o});if(s.error)return s;if(e.isCollectionMatchUp){let{matchUpTieId:i,drawDefinition:r,matchUpsMap:a}=e,o=Xy({appliedPolicies:e.appliedPolicies,matchUpId:i,tournamentRecord:t,drawDefinition:r,matchUpsMap:a,event:n});if(o.error)return o;Object.assign(s,{tieMatchUpResult:o})}return s}function EM({tournamentRecord:e,drawDefinition:t,matchUpId:i,event:n}){if(!t)return{error:$t};let{matchUp:r}=Vy({drawDefinition:t,matchUpId:i,event:n});return(null==r?void 0:r.matchUpType)!==ke?{error:Qi}:MM({enableAutoCalc:!0,tournamentRecord:e,drawDefinition:t,matchUpId:i,event:n})}function CM({drawDefinition:e,event:t,matchUpId:i}){if(!e)return{error:$t};if(!i)return{error:Hi};let{matchUp:n}=Vy({drawDefinition:e,event:t,matchUpId:i});return n?Ud({name:Fd,element:n}):{error:Yi}}function OM(e){return function({substituteParticipantId:e,existingParticipantId:t,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:o}){var s,l,u,d,c;let p="substituteParticipant";if(!n)return{error:$t};if(!a)return{error:Hi};if(!t||!e)return La({result:{error:xn},stack:p});let{matchUp:m}=Vy({drawDefinition:n,matchUpId:a,event:o});if(!m)return{error:Yi};if(!m.collectionId)return La({result:{error:Qi},stack:p});let f=rf({drawDefinition:n}),{matchUps:h}=Qh({tournamentParticipants:null==i?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:f}),v=null==h?void 0:h.find((e=>e.matchUpId===a)),g=null==(l=null==(s=null==h?void 0:h.find((e=>e.matchUpId===(null==v?void 0:v.matchUpTieId))))?void 0:s.sides)?void 0:l.find((e=>e.participant.individualParticipants.some((({participantId:e})=>e===t))));return!g||r&&g.sideNumber!==r?{error:Mn}:null!=(c=null==(d=null==(u=g.participant)?void 0:u.individualParticipants)?void 0:d.map(hc).filter((e=>e!==t)))&&c.includes(e)?GN({newParticipantId:e,tieMatchUpId:a,existingParticipantId:t,substitution:!0,tournamentRecord:i,drawDefinition:n,event:o}):La({result:{error:Mn},stack:p})}(e)}function kM({drawDefinition:e,matchUpId:t,event:i}){if(!e)return{error:$t};let{matchUp:n}=Vy({drawDefinition:e,matchUpId:t,event:i});return Sd({extension:{name:_d,value:!0},element:n})}function FM(e){let t="setMatchUpFormat",i=qu(e,[{tournamentRecord:!0},{[Fu]:e=>co({matchUpFormat:e}),[_u]:Li,matchUpFormat:!0}]);if(i.error)return La({result:i,stack:t});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:d,eventId:c,stages:p,drawId:m,event:f,force:h}=e;if(a&&!Array.isArray(a))return La({result:{error:Cr,scheduledDates:a},stack:t});if(u&&!Mt([Ks,Qs],u))return La({result:{error:Ti},stack:t});let v=0,g=e.structureIds||l&&[l].filter(Boolean)||[],I=e.eventIds||c&&[c].filter(Boolean)||[],U=e.drawIds||m&&[m].filter(Boolean)||[];if((l||null!=g&&g.length)&&!r)return La({result:{error:$t},stack:t});if(m&&d&&r){let e=JD({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:g,structureId:l,matchUpId:d});if(e.error)return e;v+=1}let y=e=>{let i=[];for(let r of e.structures||[]){if(Array.isArray(p)&&!p.includes(r.stage)||Array.isArray(o)&&!o.includes(r.stageSequence)||null!=g&&g.length&&!g.includes(r.structureId))continue;null!=g&&g.length&&r.matchUpFormat!==s&&(r.matchUpFormat=s,i.push(r.structureId),v+=1);let l=((h||a)&&jh({matchUpFilters:{matchUpStatuses:[Oc]},structure:r}).matchUps)??[],u=(a&&jh({matchUpFilters:{matchUpStatuses:[Oc]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:r}).matchUps)??[];if(null!=l&&l.length){let i=u?u.map(vc):l.map(vc);for(let r of l)i.includes(r.matchUpId)&&(r.matchUpFormat=null!=a&&a.length?s:void 0,Cp({tournamentId:null==n?void 0:n.tournamentId,eventId:null==f?void 0:f.eventId,context:t,drawDefinition:e,matchUp:r}))}}return!i.length&&e.matchUpFormat!==s&&(e.matchUpFormat=s,v+=1),i};for(let S of(null==n?void 0:n.events)||[])if(!(null!=I&&I.length&&!I.includes(S.eventId)||u&&u!==S.eventType||u===Xs))if(Array.isArray(o)||Array.isArray(p)||null!=g&&g.length||null!=U&&U.length)for(let e of S.drawDefinitions||[]){if(Array.isArray(U)&&!U.includes(e.drawId))continue;kp({structureIds:y(e),drawDefinition:e})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,v+=1);return v?{...At,modificationsCount:v}:{...At,info:Dr}}function xM({inheritance:e=!0,tournamentRecord:t,drawDefinition:i,matchUpId:n,event:r}){var a,o;if(!i)return{error:$t};let s=null==(a=Vy({drawDefinition:i,matchUpId:n}))?void 0:a.matchUp;if(null==s||!s.tieMatchUps)return{error:Qi};let l=null==(o=Vy({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))?void 0:o.matchUp,u=0;return((null==s?void 0:s.sides)||[]).forEach((e=>{e.lineUp&&delete e.lineUp})),((null==l?void 0:l.sides)||[]).forEach((n=>{if(u+=1,!1===e){let e=null==l?void 0:l.tieFormat,t=n.participantId;e&&t&&iI({drawDefinition:i,participantId:t,lineUp:[],tieFormat:e})}Cp({tournamentId:null==t?void 0:t.tournamentId,context:"resetMatchUpLineUps",eventId:null==r?void 0:r.eventId,drawDefinition:i,matchUp:s})})),{...At,modificationsCount:u}}function _M(e){let{matchUpFormat:t,matchUpStatus:i,winningSide:n,score:r,setTBlast:a}=e;if(!r)return{sets:[]};let o=r.sets||[],s=Yw({winnerFirst:!1,matchUpFormat:t,matchUpStatus:i,setTBlast:a,sets:o}),l=Yw({winnerFirst:!1,reversed:!0,matchUpFormat:t,matchUpStatus:i,setTBlast:a,sets:o}),u=Yw({matchUpFormat:t,matchUpStatus:i,winningSide:n,setTBlast:a,sets:o}),d=s===u?l:s;return n&&(s=1===n?u:d,l=2===n?u:d),{score:{sets:o,scoreStringSide1:s,scoreStringSide2:l}}}function LM(e){var t,i;let n=qu(e,[{[Iu]:!0,[su]:!0}]);if(n.error)return n;let r=Gp(e);if(!e.drawDefinition){let t=e.tournamentRecord??(e.tournamentId&&r[e.tournamentId]);e.tournamentRecord||(e.tournamentRecord=t);let i=Ch({eventId:e.eventId,drawId:e.drawId,tournamentRecord:t});if(i.error)return i;i.drawDefinition&&(e.drawDefinition=i.drawDefinition),e.event=i.event}let{disableScoreValidation:a,policyDefinitions:o,tournamentRecord:s,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:d,matchUpId:c,schedule:p,event:m,notes:f}=e,h=e.matchUpFormat||(null==(t=e.outcome)?void 0:t.matchUpFormat),{policy:v}=Rm({policyType:cd,tournamentRecord:s,event:m}),g=void 0!==e.allowChangePropagation&&e.allowChangePropagation||void 0!==(null==v?void 0:v.allowChangePropagation)&&v.allowChangePropagation||void 0,{outcome:I,setTBlast:U}=e;if(null!=I&&I.winningSide&&![1,2].includes(I.winningSide))return{error:Sn};if(h){let e=JD({tournamentRecord:s,drawDefinition:d,matchUpFormat:h,matchUpId:c,event:m});if(e.error)return e}if(null!=(i=null==I?void 0:I.score)&&i.sets&&!I.score.scoreStringSide1){let{score:e}=_M({...I,setTBlast:U});I.score=e,I.score.sets=I.score.sets.filter((e=>e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore))}return MM({matchUpStatusCodes:null==I?void 0:I.matchUpStatusCodes,matchUpStatus:null==I?void 0:I.matchUpStatus,winningSide:null==I?void 0:I.winningSide,allowChangePropagation:g,disableScoreValidation:a,score:null==I?void 0:I.score,tournamentRecords:r,policyDefinitions:o,tournamentRecord:s,disableAutoCalc:l,enableAutoCalc:u,drawDefinition:d,matchUpFormat:h,matchUpId:c,schedule:p,event:m,notes:f})}function BM(e){if(null==e||!e.outcomes)return{error:un};if(!Array.isArray(e.outcomes))return{error:un,info:{outcomes:e.outcomes}};let t=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},i=e.outcomes??[],n=i.reduce(((e,t)=>e.includes(t.tournamentId)?e:e.concat(t.tournamentId)),[]);for(let r of n){let e=t[r];if(!e)return{error:Bt};let n=i.filter((e=>e.tournamentId===r));if(n.length){let t=VM({outcomes:n,tournamentRecord:e});if(t.error)return t}}return{...At}}function VM(e){var t;let{tournamentRecords:i,tournamentRecord:n,outcomes:r,policyDefinitions:a}=e,o={};r.forEach((e=>{let{eventId:t}=e;o[t]||(o[t]=[]),o[t].push(e)}));for(let s of Object.keys(o)){let{event:e}=Ch({tournamentRecord:n,eventId:s});for(let r of o[s]){let{drawId:o}=r,s=null==(t=null==e?void 0:e.drawDefinitions)?void 0:t.find((e=>e.drawId===o));if(s&&o){let{matchUpFormat:t,matchUpId:l}=r,u=LM({schedule:null==r?void 0:r.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:n,drawDefinition:s,matchUpFormat:t,matchUpId:l,outcome:r,drawId:o,event:e});if(u.error)return u}}}return{...At}}function jM(e){return function({drawDefinition:e,matchUpId:t,outcome:i,matchUp:n}){var r,a;if(!n&&!e)return{error:$t};if(!i)return{error:un,info:"missing outcome"};if(!n&&!t)return{error:Ji};if(!n){let i=Vy({drawDefinition:e,matchUpId:t});if(i.error)return i;n=i.matchUp}return"object"==typeof i&&null!=(r=i.score)&&r.scoreStringSide1&&null!=(a=i.score)&&a.scoreStringSide2?Sd({element:n,extension:{name:Fd,value:i}}):{error:Cr}}(e)}function GM(e){var t,i;let n="resetTieFormat",{drawDefinition:r,event:a,uuids:o}=e,s=qu(e,[{[au]:!0,[Iu]:!0}],n);if(s.error)return s;let l=Gb(e,[{[Eu]:Ru}]);if(l[Mu])return l;let u=null==(t=e.tournamentRecord)?void 0:t.tournamentId,{matchUp:d,structure:c}=(null==l?void 0:l.matchUp)??{};if(null==d||!d.tieMatchUps)return La({result:{error:Qi},info:"Must be a TEAM matchUp",stack:n});if(!d.tieFormat)return{...At};let p=null==(i=nf({structure:c,drawDefinition:r,event:a}))?void 0:i.tieFormat;if(!p)return La({result:{error:Lr},info:"No inherited tieFormat",stack:n});let m=[],f=[],h=[],v=[];for(let g of p.collectionDefinitions){let{matchUpCount:e,collectionId:t}=g;f.push(t);let i=(d.tieMatchUps||[]).filter((e=>e.collectionId===t));if(i.length>e)i.sort(((e,t)=>(e.matchUpStatus===Oc?1:0)-(t.matchUpStatus===Oc?1:0))),h.push(...i.slice(0,e)),m.push(...i.slice(3).map(vc));else if(h.push(...i),i.length<e){let t=oy({collectionDefinition:g,matchUpsLimit:e-i.length,matchUp:d,uuids:o});v.push(...t)}}for(let g of(null==d?void 0:d.tieMatchUps)||[])g.collectionId&&!f.includes(g.collectionId)&&m.push(g.matchUpId);return v.length&&(h.push(...v),Ap({eventId:null==a?void 0:a.eventId,matchUps:v,drawDefinition:r,tournamentId:u})),m.length&&Ep({matchUpIds:m,eventId:null==a?void 0:a.eventId,drawDefinition:r,tournamentId:u}),d&&(d.tieMatchUps=h,d.tieFormatId=void 0,d.tieFormat=void 0,Cp({structureId:null==c?void 0:c.structureId,eventId:null==a?void 0:a.eventId,context:n,drawDefinition:r,tournamentId:u,matchUp:d})),{...At,newMatchUps:v,deletedMatchUpIds:m}}function $M(e){var t,i,n;let{tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s}=e,l="resetScorecard";if(!a)return La({result:{error:$t},stack:l});if(!o)return La({result:{error:Hi},stack:l});if(!St(o))return La({result:{error:Cr,matchUpId:o},stack:l});let u=rf({drawDefinition:a}),{matchUps:d}=Qh({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:u}),c=u.drawMatchUps.find((e=>e.matchUpId===o)),p=null==d?void 0:d.find((e=>e.matchUpId===o));if(!c||!d)return{error:Yi};if(c.matchUpType!==el)return{error:Qi};let m=zh({inContextDrawMatchUps:d,drawDefinition:a,matchUpId:o}),f=null==p?void 0:p.structureId,{structure:h}=Hc({drawDefinition:a,structureId:f});if(Object.assign(e,{inContextDrawMatchUps:d,inContextMatchUp:p,matchUpsMap:u,targetData:m,structure:h,matchUp:c}),CS(e))return{error:Rn};if(null!=(t=c.tieMatchUps)&&t.length)for(let I of c.tieMatchUps){let e=MM({matchUpId:I.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:a,event:s});if(e.error)return La({result:e,stack:l})}let v=null==(i=gm({tournamentRecord:r,drawDefinition:a,event:s}))?void 0:i.appliedPolicies,g=Xy({event:e.event,removeScore:!0,tournamentRecord:r,appliedPolicies:v,drawDefinition:a,matchUpsMap:u,matchUpId:o});if(g.error)return La({result:g,stack:l});if(e.tiebreakReset&&!g.tieFormatRemoved){let e=null==(n=nf({drawDefinition:a,structure:h,event:s}))?void 0:n.tieFormat;if(c.tieFormat&&e){let{matchUpCountDifference:t,descendantDifferences:i,ancestorDifferences:n,valueDifference:l}=kT({descendant:c.tieFormat,ancestor:e});if(1===i.collectionIds.length&&!n.collectionIds.length&&!n.groupsCount&&1===t&&1===l){let e=GM({tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s});if(e.error)return e}}}return{...At}}function qM(e){let t=qu(e,[{[su]:!0,[Au]:!0},{[Vu]:{[fu]:!1,roundNumbers:!1},[xu]:"At least one must be provided",[Lu]:ku}]);if(t.error)return t;let i=US(e);if(i.error)return i;let{matchUpIds:n}=i,r=Xf(el)(e.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=e;for(let l of n){if(r){let t=$M({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(t.error||e.removeAssignments&&xM({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return t}let t=MM({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(t.error)return t;if(e.removeAssignments){let t=KN({...e,matchUpId:l});if(t.error)return t}}return{...At}}function WM(e){return function({tournamentRecord:e,drawDefinition:t,finishingOrder:i}){var n;if(!t)return{error:$t};let r="setOrderOfFinish";if(!Array.isArray(i))return La({info:eI("finishingOrder"),result:{error:Cr},stack:r});let{completedMatchUps:a,matchUpsMap:o}=Zh({inContext:!0,drawDefinition:t}),s=(null==a?void 0:a.map(vc))??[],l=i.map(vc),{matchUpTypes:u,roundNumbers:d,structureIds:c,matchUpTieIds:p}=(a??[]).filter((({matchUpId:e})=>l.includes(e))).reduce(((e,t)=>{let{matchUpTieId:i,matchUpType:n,roundNumber:r,structureId:a}=t;return e.matchUpTypes.includes(n)||e.matchUpTypes.push(n),e.roundNumbers.includes(r)||e.roundNumbers.push(r),e.structureIds.includes(a)||e.structureIds.push(a),e.matchUpTieIds.includes(i)||e.matchUpTieIds.push(i),e}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(u.length>1||p.length>1||d.length>1||c.length>1)return La({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Cr},stack:r});let m,f,h={},v=[],g=[];if(!i.every((({orderOfFinish:e,matchUpId:t})=>(v.push(t),e&&g.push(e),h[t]=e,m=s.includes(t),f=void 0===e||Ye(e)&&Math.floor(e)>0,m&&f))))return La({result:{error:m?Cr:Vi},info:(m?!f&&"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed")||void 0,stack:r});let I=null==a?void 0:a.filter((e=>e.structureId===c[0]&&e.roundNumber===d[0]&&e.matchUpType===u[0]&&e.matchUpTieId===p[0]&&!v.includes(e.matchUpId)));for(let U of I??[]){let{orderOfFinish:e}=U||{};if(e){if(!Ye(e))return La({context:{orderOfFinish:e,matchUp:U},result:{error:Cr},stack:r});g.push(e)}}if(at(g).length!==g.length||Math.max(...g)>g.length)return La({info:"Values not unique or greater than expected number of values",result:{error:Cr},stack:r});if(c.length){let i=$h({matchUpFilters:{matchUpIds:l},structureId:c[0],drawDefinition:t,matchUpsMap:o});if(i.error)return La({result:i,stack:r});null==(n=i.completedMatchUps)||n.forEach((i=>{i.orderOfFinish=h[i.matchUpId],Cp({tournamentId:e.tournamentId,context:"setOrderOfFinish",drawDefinition:t,matchUp:i})}))}return{...At}}(e)}function HM(e){var t,i,n,r;let{tournamentRecord:a,drawDefinition:o,matchUpId:s,lineUps:l,event:u}=e,d="applyLineUps",c=qu(e,[{[au]:!0,[su]:!0,[Iu]:!0},{lineUps:!0,[Lu]:ku}],d);if(c.error)return c;let p=a.participants||[],m=Vy({tournamentParticipants:p,inContext:!0,drawDefinition:o,matchUpId:s});if(m.error)return m;if(!m.matchUp)return{error:Yi};let{matchUp:f,structure:h}=m,{drawPositions:v,matchUpType:g}=f;if(g!==Fe)return{error:Qi};if(null==v||!v.length)return{error:Xt};let I=null==(t=nf({matchUp:f,drawDefinition:o,structure:h,event:u}))?void 0:t.tieFormat,U={};for(let S of l){if(!Array.isArray(S))return{error:Cr,lineUp:S};let e={},t=[];for(let a of S){if("object"!=typeof a)return{error:Cr,lineUpAssignment:a};let{participantId:o,collectionAssignments:s=[]}=a;if(!Array.isArray(s))return{error:Cr,collectionAssignments:s};let l=p.find((e=>e.participantId===o));if(!l)return{error:_n};if(l.participantType!==zp)return{error:Cn};let u=null==(n=null==(i=f.sides)?void 0:i.find((e=>{var t,i;return null==(i=null==(t=e.participant)?void 0:t.individualParticipantIds)?void 0:i.includes(o)})))?void 0:n.sideNumber;u&&t.push(u);for(let t of s){if("object"!=typeof t)return{error:Cr,collectionAssignment:t};let{collectionId:i,collectionPosition:n}=t,a=null==(r=null==I?void 0:I.collectionDefinitions)?void 0:r.find((e=>e.collectionId===i));if(!a)return{error:Cr,collectionId:i};let s=`${i}-${n}`;e[s]||(e[s]=[]);let l=e[s].length;if(Xf(Ee)(a.matchUpType)&&l||a.matchUpType===Oe&&l>1)return{info:"Excessive collectionPosition assignments",error:Cr};e[s].push(o)}}let o=Object.values(e);for(let i of o)if(2===i.length){let{participant:e}=Fh({tournamentParticipants:p,participantIds:i});if(!e){let e=vR({participant:{participantType:Kp,participantRole:sg,individualParticipantIds:i},pairOverride:!0,tournamentRecord:a});if(e.error)return e}}let s=tt(t),l=((s[1]||0)>(s[2]||0)?1:(s[2]||0)>(s[1]||0)&&2)||void 0,u=Object.keys(U).map((e=>parseInt(e)));l&&!u.includes(l)&&(U[l]=S)}if(!Object.keys(U).length)return{error:_r};if(m=Vy({drawDefinition:o,matchUpId:s}),m.error)return m;if(!m.matchUp)return{error:Yi};let{matchUp:y}=m;y.sides||(y.sides=[]);for(let S of[1,2]){let e=y.sides.find((e=>e.sideNumber===S)),t=U[S];t&&(e?e.lineUp=t:y.sides.push({lineUp:t,sideNumber:S}))}return Cp({tournamentId:null==a?void 0:a.tournamentId,context:d,drawDefinition:o,matchUp:y}),{...At}}var zM={};be(zM,{anonymizeTournamentRecord:()=>cE,generate:()=>YM,generateEventWithDraw:()=>QA,generateOutcome:()=>VA,generateOutcomeFromScoreString:()=>KM,generateParticipants:()=>CA,generateTournamentRecord:()=>uE,modifyTournamentRecord:()=>pE,mutate:()=>dE});var YM={};function KM(e){let{matchUpFormat:t,matchUpStatus:i,winningSide:n,scoreString:r,setTBlast:a}=e;if(!r)return{outcome:{...$y,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Cr,winningSide:n};let o=r&&LD({scoreString:r}),s={},l=Yw({sets:o,matchUpFormat:t,setTBlast:a}),u=Yw({sets:o,reversed:!0,matchUpFormat:t,setTBlast:a});return 2===n?(s.scoreStringSide1=u,s.scoreStringSide2=l):(s.scoreStringSide1=l,s.scoreStringSide2=u),s.sets=LD({scoreString:s.scoreStringSide1}),_a({outcome:{matchUpStatus:i,winningSide:n,score:s}})}function JM({matchUpScheduleTimes:e,matchUpDependencies:t,allDateMatchUpIds:i,matchUp:n}){var r;let a=((null==(r=null==t?void 0:t[n.matchUpId])?void 0:r.matchUpIds)||[]).filter((e=>i.includes(e))).filter((t=>!e[t]));return{dependenciesScheduled:!(null!=a&&a.length),remainingDependencies:a}}function QM({individualParticipantProfiles:e,participantId:t}){e[t]||(e[t]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function ZM({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var u,d;let c=Ao(null==(u=null==l?void 0:l.schedule)?void 0:u.endTime),p=c?Bo(c,Be(o)):Bo(s,Be(n)+Be(o)),m=i&&(c?Bo(Ao(c),i):Bo(s,Be(n)+Be(i))),f=(null==(d=null==a?void 0:a[l.matchUpId])?void 0:d.participantIds)||[],h=(l.roundPosition&&e[l.matchUpId]||[]).flat();f.forEach((e=>{QM({individualParticipantProfiles:t,participantId:e});let i=t[e].priorMatchUpType!==l.matchUpType&&m||p;h.includes(e)?function({individualParticipantProfiles:e,recoveryValue:t,participantId:i,scheduleTime:n,drawId:r}){e[i].potentialRecovery[r]||(e[i].potentialRecovery[r]=[]),e[i].potentialRecovery[r].push(t),e[i].potentialBookings[r]||(e[i].potentialBookings[r]=[]),e[i].potentialBookings[r].push({timeAfterRecovery:t,scheduleTime:n})}({individualParticipantProfiles:t,drawId:l.drawId,recoveryValue:i,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=i,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:i}))})),ZT({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:l})}function XM({matchUpScheduleTimes:e,matchUpDependencies:t,scheduleTime:i,matchUpId:n,details:r}){var a,o,s,l,u;let d,c=null==(o=null==(a=r.minutesMap)?void 0:a[n])?void 0:o.recoveryMinutes,p=Bo(i,((null==(l=null==(s=r.minutesMap)?void 0:s[n])?void 0:l.averageMinutes)||0)+(c||0)),m=(null==(u=null==t?void 0:t[n])?void 0:u.dependentMatchUpIds)||[];if(m.length){let t=m.reduce(((t,i)=>{let n=e[i];if(!n)return t;let r={scheduleTime:n,matchUpId:i};return n&&!t.matchUpId||No(n)<No(t.scheduleTime)?r:t}),{});t.scheduleTime&&No(p)>No(t.scheduleTime)&&(d=t)}return{scheduledDependent:d}}be(YM,{generateEventWithDraw:()=>QA,generateOutcome:()=>VA,generateOutcomeFromScoreString:()=>KM,generateParticipants:()=>CA,generateTournamentRecord:()=>uE});var eA="DO_NOT_SCHEDULE",tA={DO_NOT_SCHEDULE:eA};function iA({averageMatchUpMinutes:e=90,requestConflicts:t={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){let s=function(e){let{sides:t,matchUpType:i}=e||{};return(t||[]).map((e=>{var t;return i===Oe&&((null==(t=null==e?void 0:e.participant)?void 0:t.individualParticipants)||[])||(null==e?void 0:e.participant)&&[e.participant]||[]})).flat()}(o).map((({person:e})=>null==e?void 0:e.personId));if(i){let e=((null==o?void 0:o.potentialParticipants)||[]).flat().map((({person:e})=>null==e?void 0:e.personId));s.push(...e)}let l=s.map((e=>{var t;return null==(t=n[e])?void 0:t.map((t=>({...t,personId:e})))})).filter(Boolean).flat().filter((e=>e.requestType===eA&&Go(a,e.date))),u=[],d=null==o?void 0:o.matchUpId,c=_o(Ao(r),Eo(a)),p=Ao(Vo(c,e).toISOString());for(let m of l){let{requestId:e,startTime:i,endTime:n}=m;(r>i&&r<n||p>i&&p<n)&&(u.push({matchUpId:d,request:m,scheduleTime:r}),t[e]?(t[e].scheduleTimes.includes(r)||t[e].scheduleTimes.push(r),t[e].matchUpIds.includes(d)||t[e].matchUpIds.push(d)):t[e]={request:m,scheduleTimes:[r],matchUpIds:[d]})}return{conflicts:u}}function nA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=jp(i),o=(e[i.matchUpId]||[]).filter((e=>!pt(e,a))).flat();[...a,...o].forEach((e=>{if(QM({individualParticipantProfiles:t,participantId:e}),!t[e].potentialCounted[i.drawId]){let a=t[e].counters;a[r]?a[r]+=n:n>0&&(a[r]=n),a[ah]?a[ah]+=n:n>0&&(a[ah]=n),o.includes(e)&&(t[e].potentialCounted[i.drawId]=!0)}}))}function rA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:d,matchUps:c}){var p,m;let f=[];i||(r=null==c?void 0:c.filter((e=>{let t=e.schedule||{},i=e.matchUpStatus===Sc;return i&&f.push({tournamentId:e.tournamentId,matchUpId:e.matchUpId}),!i&&Nb({schedule:t})&&(!u||e.schedule.scheduledDate===u)})),i=r.map(vc));let h=Array.isArray(l)?l.includes(u):l,v=h?[]:c.filter((({matchUpId:e})=>i.includes(e)));for(let g of v){nA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,value:1,matchUp:g});let i=null==(p=g.schedule)?void 0:p.scheduledTime;if(i){o[g.matchUpId]=i,ZM({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:null==(m=null==d?void 0:d[g.matchUpId])?void 0:m.recoveryMinutes,scheduleTime:i,matchUp:g})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:f,dateScheduledMatchUps:r,clearDate:h}}function aA({defaultRecoveryMinutes:e=0,averageMatchUpMinutes:t=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:o,matchUps:s}){if("object"!=typeof n)return{error:Lt};if(!lf(s)&&!Array.isArray(i))return{error:Ki};a=a??RN({recoveryMinutes:e,averageMatchUpMinutes:t});let l=Object.assign({},...Object.values(n).map((e=>(e.events??[]).map((t=>{let{scheduleTiming:i}=Nm({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:i}}})))).flat()),u={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]};i||(i=null==s?void 0:s.filter((e=>{let t=e.schedule;return Nb({schedule:t})&&(!o||e.schedule.scheduledDate===o)})));let d=null==i?void 0:i.filter((e=>(!r.length||r.includes(e.schedule.venueId))&&e.matchUpStatus!==Sc));return{bookings:null==d?void 0:d.map((({eventId:e,schedule:t,matchUpFormat:i})=>{let{event:n,scheduleTiming:r}=l[e],o=null==n?void 0:n.eventType,s={...r,defaultTiming:u,matchUpFormat:i},{averageMinutes:d,recoveryMinutes:c}=vh({timingDetails:s,eventType:o}),{courtId:p,venueId:m}=t,f=Ao(t.scheduledTime),h=Bo(f,d);return{recoveryMinutes:c,averageMinutes:d,periodLength:a,startTime:f,courtId:p,endTime:h,venueId:m}})).filter(Boolean),relevantMatchUps:d,dateScheduledMatchUps:i}}function oA({calculateStartTimeFromCourts:e=!0,remainingScheduleTimes:t,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:d,matchUps:c,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),"object"!=typeof a||!Object.keys(a).length)return{error:Lt};s=s??RN({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:m,venues:f}=$T({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),h=(null==m?void 0:m.filter((e=>!d||d.includes(e.venueId))))??[];u=u??MN({courts:h,scheduleDate:l,startTime:!0}),p=p??MN({courts:h,scheduleDate:l,endTime:!0});let{bookings:v,dateScheduledMatchUps:g}=aA({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:d,matchUps:c}),I={calculateStartTimeFromCourts:e,remainingScheduleTimes:t,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:u,bookings:v,endTime:p,courts:h},{scheduleTimes:U}=AN(I),y=1===(null==d?void 0:d.length)&&d[0]||1===(null==f?void 0:f.length)&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:null==g?void 0:g.map(ov("matchUpId")),dateScheduledMatchUps:g,scheduleTimes:U,venueId:y}}function sA({scheduledRoundsDetails:e,greatestAverageMinutes:t,garmanSinglePass:i}){let n,r,a,o,s=[],l=[];for(let u of e.filter(Boolean))o||(o=u.hash),(u.hash===o||i)&&(l=l.concat(u.matchUpIds)),u.hash!==o&&!i&&(o=u.hash,s.push({averageMinutes:a,recoveryMinutes:r,roundPeriodLength:n,matchUpIds:l}),l=u.matchUpIds),a=i?t:u.averageMinutes,r=u.recoveryMinutes,n=u.roundPeriodLength;return l.length&&s.push({matchUpIds:l,roundPeriodLength:n,recoveryMinutes:r,averageMinutes:a}),{groupedRounds:s}}function lA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:d,useGarman:c,matchUps:p,courts:m,venues:f}){var h;let v={},g=[],I=[],U=[];for(let y of f){let{rounds:f=[],venueId:S}=y,{scheduledRoundsDetails:w,greatestAverageMinutes:P,orderedMatchUpIds:D,minutesMap:T}=tb({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:u,matchUps:p,rounds:f});U.push(...D??[]);let b,{groupedRounds:R}=sA({scheduledRoundsDetails:w,greatestAverageMinutes:P,garmanSinglePass:!0}),N=[];c&&({scheduleTimes:N,dateScheduledMatchUpIds:b}=oA({averageMatchUpMinutes:null==(h=R[0])?void 0:h.averageMinutes,scheduleDate:Eo(d),venueIds:[y.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let M=rA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:b,greatestAverageMinutes:P,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:d,minutesMap:T,matchUps:p});({dateScheduledMatchUpIds:b}=M);let A=M,{byeScheduledMatchUpDetails:E,clearDate:C}=M;null!=E&&E.length&&I.push(...E);let{matchUpsToSchedule:O,matchUpMap:k}=XT({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:b,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:D,clearDate:C,matchUps:p}),F=m.filter((e=>e.venueId===S));v[S]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:P,scheduledRoundsDetails:w,dateScheduledMatchUps:A,matchUpsToSchedule:O,scheduleTimes:N,groupedRounds:R,venueCourts:F,minutesMap:T,matchUpMap:k},s||g.push(...b)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:v,allDateMatchUpIds:U}}function uA({individualParticipantProfiles:e,matchUpNotBeforeTimes:t,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var o,s,l,u,d;let c=((null==(o=null==i?void 0:i[r.matchUpId])?void 0:o.participantIds)||[]).flat(),p=(null==(l=null==(s=null==a?void 0:a.minutesMap)?void 0:s[r.matchUpId])?void 0:l.averageMinutes)||0,m=(null==(d=null==(u=null==a?void 0:a.minutesMap)?void 0:u[r.matchUpId])?void 0:d.recoveryMinutes)||0,f=c.every((t=>{var i;QM({individualParticipantProfiles:e,participantId:t});let a=e[t];if(!a.timeAfterRecovery)return!0;let o=Ao(null==(i=null==r?void 0:r.schedule)?void 0:i.endTime),s=o?Bo(o,Be(m)):Bo(n,Be(p)+Be(m));return![...Object.keys(a.potentialBookings).filter((e=>e!==r.drawId)).map((e=>a.potentialBookings[e])).flat(),...a.bookings].find((e=>function(e,t){let i=No(e.scheduleTime),n=No(e.timeAfterRecovery),r=No(t.scheduleTime),a=No(t.timeAfterRecovery),o=i>r&&i<a,s=r>i&&r<n,l=n>r&&n<a,u=a>i&&a<n;return _a({hasOverlap:i===r||n===a||o||l||s||u,startAisContained:o,endAisContained:l,startBisContained:s,endBisContained:u},!0)}({scheduleTime:n,timeAfterRecovery:s},e).hasOverlap))})),h=t[r.matchUpId],v=(h?Lo(_o(h),_o(n),!1):0)>=0;return{enoughTime:f&&v}}function dA({autoSchedulingAudit:e,tournamentRecords:t}){var i;Ia({topic:np,payload:e});let n=e=>e?Object.values(e).reduce(((e,t)=>e+t.length||0),0):0,r=((null==e?void 0:e.schedulingProfile)||[]).reduce(((e,t)=>e+t.venues.reduce(((e,t)=>e+t.rounds.length),0)),0),a={scheduledDatesCount:null==(i=e.scheduledDates)?void 0:i.length,noTimeMatchUpIdsCount:n(null==e?void 0:e.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(null==e?void 0:e.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(null==e?void 0:e.overLimitMatchUpIds),requestConflictsCount:n(null==e?void 0:e.requestConflicts),profileRoundsCount:r},o={itemType:MR,itemValue:a};for(let s of Object.values(t)){let e=s.tournamentId;Da(np)?Ia({payload:{type:MR,tournamentId:e,detail:a},topic:np}):aS({tournamentRecord:s,timeItem:o})}}function cA({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=jp(n),{matchUpId:a,matchUpType:o}=n,s=(n.roundPosition&&e[a]||[]).flat(),l=Qe(r.concat(...s));return l.forEach((e=>{QM({individualParticipantProfiles:t,participantId:e})})),{participantIdsAtLimit:l.filter((e=>{let n=t[e];if(n)return[o,ah].find((e=>{var t;let r=(null==(t=n.counters)?void 0:t[e])||0,a=i[e]||0;return r&&a&&r>=a}))})),relevantParticipantIds:l}}function pA({scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:t=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:d}){var c,p,m;if(!s)return{error:Bt};if(!(l||u&&Array.isArray(u)))return{error:zi};if(!(l||d&&"object"==typeof d))return{error:Sr};let f,h=[],v=0;if(n&&!r){let e=uv({tournamentRecords:o,tournamentRecord:s});r=e.matchUpDependencies,f=e.matchUps}f||(f=(null==(c=ev({tournamentRecord:s}))?void 0:c.matchUps)??[]);let g=f.reduce(((i,n)=>{let{matchUpId:r,drawId:a,matchUpStatus:o}=n;return(t||o!==Sc)&&(e||!Vc.includes(o))&&(i[a]?i[a].push(r):i[a]=[r]),i}),{}),I=null==l?void 0:l.map((e=>e.matchUpId));for(let U of Object.keys(g)){let{drawDefinition:e}=MS({tournamentRecord:s,drawId:U});if(!e)continue;let t=g[U].filter((e=>(null==u?void 0:u.includes(e))??(null==I?void 0:I.includes(e)))),c=nv({inContext:!1,drawDefinition:e}).matchUps;for(let u of t){let t=wM({schedule:(null==(p=null==l?void 0:l.find((e=>e.matchUpId===u)))?void 0:p.schedule)||d,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:f,tournamentRecords:o,tournamentRecord:s,checkChronology:n,drawDefinition:e,drawMatchUps:c,matchUpId:u});if(null!=(m=null==t?void 0:t.warnings)&&m.length&&h.push(...t.warnings),null!=t&&t.success&&(v+=1),t.error)return t}}return h.length?{...At,scheduled:v,warnings:h}:{...At,scheduled:v}}function mA(e){var t;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:n=!1,errorOnAnachronism:r,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:u,schedule:d}=e;if(e.matchUpIds&&!a)return pA(e);let c=qu(e,[{[nu]:!0},{[Vu]:{matchUpContextIds:!1,matchUpDetails:!1},[_u]:Cr,[Lu]:ku}]);if(c.error)return c;if((!u||a)&&!d)return{error:un,info:"schedule is required"};let p=[],m=0,{matchUpDependencies:f}=uv({tournamentRecords:s});for(let h of Object.values(s)){let{tournamentId:e}=h,c=null==a?void 0:a.filter((t=>t.tournamentId===e)).map(vc),v=null==u?void 0:u.filter((t=>(null==t?void 0:t.tournamentId)===e));if(null!=c&&c.length||null!=v&&v.length){let e=pA({matchUpDetails:v,scheduleCompletedMatchUps:i,scheduleByeMatchUps:n,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:o,tournamentRecords:s,tournamentRecord:h,checkChronology:l,matchUpIds:c,schedule:d});if(null!=(t=e.warnings)&&t.length&&p.push(...e.warnings),e.scheduled&&(m+=e.scheduled),e.error)return e}}return p.length?{...At,scheduled:m,warnings:p}:{...At,scheduled:m}}function fA({averageMinutes:e,startTime:t,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:un,stack:"getEarliestCourtTime"};let a=MN({scheduleDate:r,courts:[n],startTime:!0}),o=MN({scheduleDate:r,courts:[n],endTime:!0});t=t||a,i=i||o;let s=PN({court:n,date:r}),{timeSlots:l}=DN({courtDate:s}),u=_o(t),d=_o(i);return{earliestCourtTime:null==l?void 0:l.reduce(((t,i)=>{let n=_o(i.startTime),r=_o(i.endTime);if(n>d||r<u)return t;let a=u>n?u:n;if(Lo(a,r)>=e){let e=Ao(a.toISOString());(!t||e<t)&&(t=e)}return t}),void 0),courtStartTime:a,courtEndTime:o}}function hA(e){let{scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=Vc,scheduledDates:n,venueIds:r}=e,a=Gp(e),o=wt(a)?Object.values(a).map((({tournamentId:e})=>e)).filter(Boolean):[];if(null==o||!o.length)return{error:Lt};let s=0;for(let l of o){let e=vA({ignoreMatchUpStatuses:i,scheduleAttributes:t,tournamentRecord:a[l],scheduledDates:n,venueIds:r});if(e.error)return e;s+=e.clearedScheduleCount??0}return{...At,clearedScheduleCount:s}}function vA({scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:t=Vc,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if("object"!=typeof i)return{error:Bt};if(!Array.isArray(t)||!Array.isArray(r))return{error:Cr};r.length&&e.push("venueId");let a=ev({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],o={};a.forEach((({matchUpStatus:i,schedule:n,drawId:a,matchUpId:s})=>{(!i||!t.includes(i))&&Nb({schedule:n,scheduleAttributes:e})&&(null==r||!r.length||r.includes(n.venueId))&&(o[a]||(o[a]=[]),o[a].push(s))}));let s=i.tournamentId,l=0;for(let u in o){let{event:e,drawDefinition:t}=Ch({tournamentRecord:i,drawId:u}),n=nv({drawDefinition:t,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let i of n){let n=!1;i.timeItems=(i.timeItems??[]).filter((e=>{let t=(null==e?void 0:e.itemType)&&![bf,Rf,Tf,Nf,Mf,Cf].includes(null==e?void 0:e.itemType);return t||(n=!0),t})),n&&(Cp({context:"clear schedules",eventId:null==e?void 0:e.eventId,drawDefinition:t,tournamentId:s,matchUp:i}),l+=1)}}return{...At,clearedScheduleCount:l}}function gA(e){let{checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=e,d=qu(e,[{[nu]:!0},{[Fu]:e=>!e||Array.isArray(e)&&e.every(Uo),[cu]:!1,[Lu]:ku}]);if(d.error)return d;let c=rb({tournamentRecords:a});if(c.error)return c;if(!c.schedulingProfile.length)return{...At};let{modifications:p,issues:m=[],schedulingProfile:f=[]}=c,h=Object.assign({},...Object.values(a).map((e=>Vp({tournamentRecord:e}).containedStructures))),v=r.map((e=>{if(Uo(e))return Eo(e)})).filter(Boolean),g=f.map((e=>e.scheduleDate)).map((e=>Uo(e)&&Eo(e))).filter((e=>e&&(!r.length||v.includes(e))));if(!g.length)return{error:pn};if(n&&!l){hA({tournamentRecords:a,scheduledDates:Array.isArray(n)?n:[]})}let I=$T({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:U}=tv({matchUpFilters:{matchUpTypes:[Ee,Oe]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=uv({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:U}),{matchUpDailyLimits:S}=Fb({tournamentRecords:a}),{personRequests:w}=lb({requestType:eA,tournamentRecords:a}),P={schedulingProfileModifications:p,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:f.filter((e=>{let t=Eo(null==e?void 0:e.scheduleDate);return g.includes(t)})).sort(((e,t)=>new Date(e.scheduleDate).getTime()-new Date(t.scheduleDate).getTime())),containedStructureIds:h,matchUpDependencies:y,matchUpDailyLimits:S,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:o,useGarman:s,matchUps:U,dryRun:l,courts:I};return u?function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:d=30,schedulingProfile:c,personRequests:p,matchUps:m=[],courts:f,dryRun:h}){var v,g;let I={},U={},y={},S={},w={},P={},D={},T={},b={};for(let M of r??[]){let e=Eo(null==M?void 0:M.scheduleDate),n=(null==M?void 0:M.venues)||[],r={},c={},R=(e,t)=>{e.forEach((e=>{let i=c[e].counters;i[t]?i[t]+=1:i[t]=1,i[ah]?i[ah]+=1:i[ah]=1}))};I[e]={},U[e]={},P[e]=[],D[e]=[],T[e]=[],b[e]=[];let N={};null==m||m.forEach((t=>{var i;null!=(i=t.schedule)&&i.scheduledDate&&Go(e,Eo(t.schedule.scheduledDate))&&ZT({matchUpPotentialParticipantIds:r,matchUpNotBeforeTimes:N,matchUp:t})}));let A,{allDateScheduledByeMatchUpDetails:E,allDateScheduledMatchUpIds:C,venueScheduledRoundDetails:O,allDateMatchUpIds:k}=lA({matchUpPotentialParticipantIds:r,individualParticipantProfiles:c,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:N,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:d,scheduleDate:e,matchUps:m,courts:f,venues:n}),F=null==m?void 0:m.filter((({matchUpId:e})=>C.includes(e))),{bookings:x}=aA({dateScheduledMatchUps:F,tournamentRecords:u,scheduleDate:e,periodLength:d}),{virtualCourts:_}=bN({scheduleDate:e,periodLength:d,bookings:x,courts:f}),L=null==_?void 0:_.reduce(((t,i)=>{let{earliestCourtTime:n,courtEndTime:r}=fA({date:e,averageMinutes:0,court:i});return(!t.startTime||_o(n)<_o(t.startTime))&&(t.startTime=n),(!t.endTime||_o(r)>_o(t.endTime))&&(t.endTime=r),t}),{}),B=L.startTime,V=({courtId:e,booking:t})=>{var i;return null==(i=null==_?void 0:_.find((t=>t.courtId===e)))?void 0:i.dateAvailability[0].bookings.push(t)},j=10,G=0;for(;!A;){for(let{venueId:i}of n){let n,a=O[i],l=a.matchUpsToSchedule.length,u=[],m=[],f=0;for(;!n;){for(let l of a.matchUpsToSchedule){if(m.length===a.courtsCount||u.length===a.courtsCount){n=!0;break}let{matchUpId:f,matchUpType:h}=l,{participantIdsAtLimit:v,relevantParticipantIds:g}=cA({matchUpPotentialParticipantIds:r,individualParticipantProfiles:c,matchUpDailyLimits:s,matchUp:l});if(v.length){D[e].includes(f)||D[e].push(f);continue}let{dependenciesScheduled:P,remainingDependencies:T}=JM({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:k,matchUp:l});if(!P){U[e][f]||(U[e][f]=[]),U[e][f].push({remainingDependencies:T});continue}let M=[],A=null==_?void 0:_.reduce(((i,n)=>{var s,u,d,v;if(m.includes(n.courtId))return i;let{earliestCourtTime:U}=fA({averageMinutes:a.greatestAverageMinutes,startTime:B,date:e,court:n});if(i.scheduleTime&&No(U)>=No(i.scheduleTime))return i;let{scheduledDependent:y}=XM({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:U,matchUpId:f,details:a});if(y)return i;let{enoughTime:S}=uA({individualParticipantProfiles:c,matchUpNotBeforeTimes:N,matchUpDependencies:o,scheduleTime:U,details:a,matchUp:l});if(!S)return I[e][f]||(I[e][f]=[]),I[e][f].includes(U)||I[e][f].push(U),i;let P=(null==(u=null==(s=a.minutesMap)?void 0:s[f])?void 0:u.averageMinutes)||a.greatestAverageMinutes,{conflicts:D}=iA({potentials:t,averageMatchUpMinutes:P,requestConflicts:b,personRequests:p,scheduleTime:U,scheduleDate:e,matchUp:l});if(null!=D&&D.length)return M.push(...D),!1;R(g,h);let T=null==(v=null==(d=a.minutesMap)?void 0:d[f])?void 0:v.recoveryMinutes;return ZM({matchUpPotentialParticipantIds:r,individualParticipantProfiles:c,matchUpNotBeforeTimes:N,averageMatchUpMinutes:P,matchUpDependencies:o,recoveryMinutes:T,scheduleTime:U,matchUp:l}),(!i.scheduleTime||No(U)<No(i.scheduleTime))&&(i.averageMatchUpMinutes=P,i.recoveryMinutes=T,i.scheduleTime=U,i.courtName=n.courtName,i.courtId=n.courtId),i}),{});if(A.scheduleTime){let{averageMatchUpMinutes:e,recoveryMinutes:t,scheduleTime:n,courtId:r}=A;w[f]=n,S[f]=r,u.push(f),m.push(r);let o=n,s=Bo(o,e);V({courtId:r,booking:{averageMatchUpMinutes:e,recoveryMinutes:t,periodLength:d,matchUpId:f,startTime:o,courtId:r,endTime:s,venueId:i}}),a.matchUpsToSchedule=a.matchUpsToSchedule.filter((e=>e.matchUpId!==f))}else null!=M&&M.length&&(y[e]||(y[e]=[]),y[e].push(...M))}(m.length===a.courtsCount||u.length===a.courtsCount||!a.matchUpsToSchedule.length)&&(n=!0),a.matchUpsToSchedule.length&&u<a.courtsCount&&(_o(B)<_o(L.endTime)?B=Bo(B,d):(n=!0,a.complete=!0)),f+=1,!n&&f>=l&&(n=!0)}null!=(v=a.matchUpsToSchedule)&&v.length||(a.complete=!0)}G+=1,A=n.every((({venueId:e})=>O[e].complete))||G===j}for(let{venueId:t}of n){let i=O[t].matchUpMap;Object.keys(i).forEach((t=>{let n=u[t];n&&Object.keys(i[t]).forEach((r=>{let{drawDefinition:a}=MS({tournamentRecord:n,drawId:r});a&&i[t][r].forEach((({matchUpId:t})=>{let i=w[t],r=S[t];if(i){let o=i.split(":").map(jo).join(":"),s=`${Eo(e)}T${o}`;h||(hM({drawDefinition:a,scheduledTime:s,matchUpId:t}),yM({courtDayDate:e,tournamentRecords:u,tournamentRecord:n,drawDefinition:a,matchUpId:t,courtId:r})),P[e].push(t)}}))}))})),T[e]=O[t].matchUpsToSchedule.map(vc)}!h&&null!=E&&E.length&&mA({matchUpDetails:E,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of M.venues)for(let i of t.rounds){let t=null==(g=(i.matchUps??[]).map((({matchUpId:e})=>e)))?void 0:g.filter((t=>P[e].includes(t)));i.canScheduledMatchUpIds=t;let n=Math.round(((null==t?void 0:t.length)||0)/i.matchUpsCount*1e4)/100;(n===1/0||isNaN(n))&&(n=void 0),i.possibleToSchedulePct=n,i.matchUpsCount===(null==t?void 0:t.length)&&(i.possibleToSchedule=!0)}}let R=(r??[]).map((({scheduleDate:e})=>e)),N={timeStamp:Date.now(),overLimitMatchUpIds:D,scheduledMatchUpIds:P,schedulingProfile:c,noTimeMatchUpIds:T,requestConflicts:b,scheduledDates:R};return dA({tournamentRecords:u,autoSchedulingAudit:N}),{...At,schedulingProfileModifications:e,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:I,dependencyDeferredMatchUpIds:U,matchUpScheduleTimes:w,overLimitMatchUpIds:D,scheduledMatchUpIds:P,noTimeMatchUpIds:T,requestConflicts:b,scheduledDates:R}}(P):function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:d,personRequests:c,periodLength:p,matchUps:m,courts:f,dryRun:h}){var v,g,I,U,y,S,w;let P={},D={},T={},b={},R={},N={},M={},A={},E={},C={};for(let F of r){let e=Eo(null==F?void 0:F.scheduleDate),n=(null==F?void 0:F.venues)||[],r={},d={},O=(e,t)=>{e.forEach((e=>{let i=d[e].counters;i[t]?i[t]+=1:i[t]=1,i[ah]?i[ah]+=1:i[ah]=1}))};T[e]={},b[e]={},P[e]={},D[e]={},M[e]=[],A[e]=[],E[e]=[],C[e]=[];let k={};m.forEach((t=>{var i;null!=(i=t.schedule)&&i.scheduledDate&&Go(e,Eo(t.schedule.scheduledDate))&&ZT({matchUpPotentialParticipantIds:r,matchUpNotBeforeTimes:k,matchUp:t})}));let x,{allDateScheduledByeMatchUpDetails:_,venueScheduledRoundDetails:L,allDateMatchUpIds:B}=lA({matchUpPotentialParticipantIds:r,individualParticipantProfiles:d,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:k,matchUpScheduleTimes:N,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:e,matchUps:m,courts:f,venues:n}),V=10,j=0,G=10;for(;!x;){for(let{venueId:i}of n){let n=0,a=L[i];for(;a.courtsCount&&null!=(v=a.scheduleTimes)&&v.length&&null!=(g=a.matchUpsToSchedule)&&g.length&&n<=a.courtsCount;){let{scheduleTime:l,attempts:u=0}=a.scheduleTimes.shift(),p=a.matchUpsToSchedule.find((i=>{var n,u;let{matchUpId:p,matchUpType:m}=i,{participantIdsAtLimit:f,relevantParticipantIds:h}=cA({matchUpPotentialParticipantIds:r,individualParticipantProfiles:d,matchUpDailyLimits:s,matchUp:i});if(f.length)return A[e].includes(p)||A[e].push(p),!1;let{scheduledDependent:v}=XM({matchUpScheduleTimes:N,matchUpDependencies:o,scheduleTime:l,matchUpId:p,details:a});if(v)return!1;let{dependenciesScheduled:g,remainingDependencies:I}=JM({matchUpScheduleTimes:N,matchUpDependencies:o,allDateMatchUpIds:B,matchUp:i});if(!g)return b[e][p]||(b[e][p]=[]),b[e][p].push({scheduleTime:l,remainingDependencies:I}),!1;let{enoughTime:U}=uA({individualParticipantProfiles:d,matchUpNotBeforeTimes:k,matchUpDependencies:o,scheduleTime:l,details:a,matchUp:i});if(!U)return T[e][p]||(T[e][p]=[]),T[e][p].push({scheduleTime:l}),!1;let y=a.greatestAverageMinutes,{conflicts:S}=iA({potentials:t,averageMatchUpMinutes:y,requestConflicts:C,personRequests:c,scheduleTime:l,scheduleDate:e,matchUp:i});if(null!=S&&S.length)return R[e]||(R[e]=[]),R[e].push(...S),!1;O(h,m);let w=null==(u=null==(n=a.minutesMap)?void 0:n[p])?void 0:u.recoveryMinutes;return ZM({matchUpPotentialParticipantIds:r,individualParticipantProfiles:d,matchUpNotBeforeTimes:k,averageMatchUpMinutes:y,matchUpDependencies:o,recoveryMinutes:w,scheduleTime:l,matchUp:i}),N[p]=l,!0}));a.matchUpsToSchedule=a.matchUpsToSchedule.filter((({matchUpId:e})=>e!==(null==p?void 0:p.matchUpId))),p?n+=1:(D[e][i]||(D[e][i]=[]),D[e][i].push({scheduleTime:l,attempts:u+1}))}null!=(I=a.matchUpsToSchedule)&&I.length&&(D[e][i]=null==(U=D[e][i])?void 0:U.filter((e=>{let t=e.attempts<V;return t&&a.scheduleTimes.push(e),!t}))),(null==(y=a.scheduleTimes)||!y.length||null==(S=a.matchUpsToSchedule)||!S.length)&&(a.complete=!0)}j+=1,x=n.every((({venueId:e})=>L[e].complete))||j===G}for(let{venueId:t}of n){let i=L[t].matchUpMap;Object.keys(i).forEach((n=>{let r=u[n];r&&Object.keys(i[n]).forEach((a=>{let{drawDefinition:o}=MS({tournamentRecord:r,drawId:a});o&&i[n][a].forEach((({matchUpId:i})=>{let n=N[i];if(n){let a=n.split(":").map(jo).join(":"),s=`${Eo(e)}T${a}`;h?M[e].push(i):(hM({drawDefinition:o,scheduledTime:s,matchUpId:i}).success&&M[e].push(i),t&&UM({tournamentRecord:r,drawDefinition:o,matchUpId:i,venueId:t}))}}))}))})),E[e]=L[t].matchUpsToSchedule.map(vc),P[e][t]=L[t].scheduleTimes.sort(((e,t)=>No(e.scheduleTime)-No(t.scheduleTime)))}!h&&null!=_&&_.length&&mA({matchUpDetails:_,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of F.venues)for(let i of t.rounds){let t=((null==(w=i.matchUps)?void 0:w.map((({matchUpId:e})=>e)))||[]).filter((t=>M[e].includes(t)));i.canScheduledMatchUpIds=t;let n=Math.round(t.length/i.matchUpsCount*1e4)/100;(n===1/0||isNaN(n))&&(n=0),i.possibleToSchedulePct=n,i.matchUpsCount===t.length&&(i.possibleToSchedule=!0)}}let O=r.map((({scheduleDate:e})=>e)),k={timeStamp:Date.now(),overLimitMatchUpIds:A,scheduledMatchUpIds:M,schedulingProfile:d,noTimeMatchUpIds:E,requestConflicts:C,scheduledDates:O};return dA({tournamentRecords:u,autoSchedulingAudit:k}),{...At,schedulingProfileModifications:e,schedulingProfileIssues:n,scheduleTimesRemaining:P,dateSchedulingProfiles:r,skippedScheduleTimes:D,recoveryTimeDeferredMatchUpIds:T,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:N,overLimitMatchUpIds:A,scheduledMatchUpIds:M,noTimeMatchUpIds:E,requestConflicts:C,scheduledDates:O}}(P)}function IA(e){let{tournamentRecord:t,tournamentRecords:i,activeTournamentId:n,...r}=e||{};return r.tournamentId||(r.tournamentId=rs()),(!r.startDate||bo(r.startDate)||po.test(r.startDate))&&(!r.endDate||bo(r.endDate)||po.test(r.endDate))?(r.extensions&&(r.extensions=r.extensions.filter(yd)),{...r}):{error:vn}}function UA({addParticipants:e=!0,participantAttribute:t,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:o}){var s,l;if(!i)return{error:Bt};let u={},d=(i.participants??[]).filter((({participantType:e,participantRole:t})=>e===zp&&t===sg)),c=0;for(let v of d){let e=a&&(null==(s=rv({element:v,accessor:a}))?void 0:s.value)||n&&(null==(l=v.person)?void 0:l[n])||t&&v[t];if(e){if(!Object.keys(u).includes(e)){u[e]={participantName:(null==r?void 0:r[c])??e,participantId:(null==o?void 0:o.pop())??rs(),individualParticipantIds:[],participantRole:sg,participantType:Jp};let i={value:n??t,name:$d};Sd({element:u[e],extension:i}),c+=1}u[e].individualParticipantIds.push(v.participantId)}}let p=Object.keys(u),m=(i.participants??[]).map((e=>{if(e.participantType!==Jp||e.participantRole!==sg)return;let{extension:t}=Cd({name:$d,element:e}),i=null==t?void 0:t.value;return p.includes(i)?e.participantId:void 0})).filter(Boolean),f=0,h=[];return Object.keys(u).forEach((t=>{let n=u[t],{participantId:r}=n;m.includes(r)||(i.participants||(i.participants=[]),e&&i.participants.push(n),h.push(n),f++)})),e&&f?(Ia({payload:{tournamentId:i.tournamentId,participants:h},topic:Xc}),{...At,participantsAdded:f}):h.length?{...At,newParticipants:h}:{error:wn}}var yA=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],SA=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function wA({count:e=1,participantsCount:t=32}={}){let i=Xe(SA),n=i.slice(0,e);return{cities:lt(0,t).map((t=>t<Math.min(e,i.length)?n[t]:st(n)))}}function PA({count:e=1,participantsCount:t=32}={}){let i=Xe(yA),n=i.slice(0,e).map((e=>Object.keys(e))).flat();return{states:lt(0,t).map((t=>t<Math.min(e,i.length)?n[t]:st(n)))}}function DA({count:e=1,participantsCount:t=32}={}){let i=lt(0,e).map((()=>lt(0,5).map((()=>ze(0,9))).join("")));return{postalCodes:lt(0,t).map((t=>t<e?i[t]:st(i)))}}function TA({idPrefix:e,participantType:t,index:i,uuids:n}){let r=St(t)?t[0]:"X";return e?`${e}-${r}-${i}`:(null==n?void 0:n.pop())||rs()}function bA(e){let{cities:t,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=e;return{postalCode:null==n?void 0:n[a],state:null==i?void 0:i[a],city:null==t?void 0:t[a],countryCode:r}}var RA={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function NA(e){let{count:t=100,sex:i}=e||{};if(!t||i&&![Va,$a].includes(i))return{personData:[],error:Cr};let n=Math.ceil(1.3*t),{lastNames:r,firstFemale:a,firstMale:o}=RA,s=tm.map((({iso:e})=>e)).filter(Boolean),l=Math.ceil(n/r.length),u=Math.ceil(n/a.length),d=Math.ceil(n/o.length),c=lt(0,l).flatMap((()=>{let e=ts(r,!1,!0);return lt(0,r.length).map((()=>ot(e)))})),p=lt(0,u).flatMap((()=>{let e=ts(a,!1,!0);return lt(0,a.length).map((()=>ot(e)))})),m=lt(0,d).flatMap((()=>{let e=ts(o,!1,!0);return lt(0,o.length).map((()=>ot(e)))})),f={};for(let h=0;h<n;h++){let e=c.pop(),t=i||st([Va,$a]),n=t===Va?m.pop():p.pop(),r=st(s);f[`${n}${e}`]={nationalityCode:r,sex:t,firstName:n,lastName:e}}return{personData:Object.values(f).slice(0,t)}}function MA(e){let t=(null==e?void 0:e.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:o,category:s,sex:l}=e||{};if(isNaN(t))return{error:Cr};let u=(null==a?void 0:a[Va])||l===Va&&t||0,d=(null==a?void 0:a[$a])||l===$a&&t||0;t=Math.max(t,u+d);let c=t-(u+d),p=[...u&&NA({count:u,sex:Va}).personData||[],...d&&NA({count:d,sex:$a}).personData||[],...c&&NA({count:c}).personData||[]],m=p.filter((e=>!l||u&&d||e.sex===l)),f=[];if(Array.isArray(o)){let e=o.filter((e=>!("string"!=typeof e.firstName||"string"!=typeof e.lastName||e.sex&&![Va,$a].includes(e.sex)||e.nationalityCode&&("string"!=typeof e.nationalityCode||e.nationalityCode.length>3||!tm.find((({iso:t,ioc:i})=>[t,i].includes(e.nationalityCode)))))&&(e.nationalityCode&&f.push(e.nationalityCode),!0)));if(!e.length)return{error:Cr};m=e}let h=o?m:Xe(m);if(h.length<t){let{maleFirstNames:e,maleLastNames:i,femaleFirstNames:n,femaleLastNames:r,nationalityCodes:a}=p.reduce(((e,t)=>{let{firstName:i,lastName:n,nationalityCode:r}=t;return t.sex===Va?(e.maleFirstNames.includes(i)||e.maleFirstNames.push(i),e.maleLastNames.includes(n)||e.maleLastNames.push(n)):(e.femaleFirstNames.includes(i)||e.femaleFirstNames.push(i),e.femaleLastNames.includes(n)||e.femaleLastNames.push(n)),e.nationalityCodes.includes(r)||e.nationalityCodes.push(r),e}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});lt(0,t-h.length).forEach((()=>{let t=l||st([Va,$a]),o=st(a),s={firstName:st(t===Va?e:n),lastName:st(t===Va?i:r),sex:t,nationalityCode:o};h.push(s)}))}let{ageMinDate:v,ageMaxDate:g}=Ho({consideredDate:n,category:s}),I=Be((null==v?void 0:v.slice(0,4))||0)||Be((null==g?void 0:g.slice(0,4))||0)-3,U=Be((null==g?void 0:g.slice(0,4))||0)||Be((null==v?void 0:v.slice(0,4))||0)+3,y=(v||g)&&[I,U],S=h.slice(0,t).map(((e,t)=>{let[n,a]=y||[],o=y&&ot(lt(n,a)),s=ot(lt(0,365)),l=o&&function(e,t,i){let n=new Date(e,0);return So(new Date(n.setDate(t)),i)}(o,s);return Object.assign(_a({extensions:i||[{name:"regionCode",value:t+1}],birthDate:l,isMock:r}),e)}));return{persons:S.length&&S||h[0],nationalityCodes:f}}var AA=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function EA({nameRoot:e="TEAM",count:t=1}={}){let i=Xe(AA).slice(0,t);return i.length<t&&lt(0,t-i.length).forEach((t=>i.push(`${e} ${t+1}`))),{names:i}}function CA(e){let{scaledParticipantsCount:t,rankingRange:i}=e,{ratingsParameters:n=py,valuesInstanceLimit:r,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:u,nationalityCodeType:d,nationalityCodes:c,participantsCount:p=32,participantType:m,teamSize:f=8,personIds:h,idPrefix:v,uuids:g,personExtensions:I,addressProps:U,gendersCount:y,matchUpType:S,personData:w,sex:P,inContext:D,withISO2:T,withIOC:b,scaleAllParticipants:R}=e,N=m===Kp||S===Ce,M=m===Jp||S===Jp;i&&(!Array.isArray(i)||!i.every((e=>qe(e)))||2!==i.length)&&(i=void 0),t=R?p:t;i=i||[1,t&&t>1e3?t:1e3],i[1]+=1;let A=p*((N?2:M&&(f??8))||1),E=MA({count:A,personExtensions:I,consideredDate:o,gendersCount:y,personData:w,category:l,sex:P});if(E.error)return E;let{nationalityCodes:C,persons:O}=E,k={},F={},x={},_={},L=e=>{Object.assign(k,e.doublesRankings),Object.assign(F,e.singlesRankings),Object.assign(_,e.doublesRatings),Object.assign(x,e.singlesRatings)};if(wt(l)){let e=kA({scaledParticipantsCount:t,ratingsParameters:n,participantType:m,ratingsValues:a,rankingRange:i,category:l});L(e)}Array.isArray(s)&&s.forEach((e=>{let r=kA({scaledParticipantsCount:t,ratingsParameters:n,participantType:m,ratingsValues:a,rankingRange:i,category:e});L(r)}));let B=tm.filter((e=>"IOC"===d&&e.ioc||e.iso));let{postalCodesProfile:V,postalCodesCount:j,statesProfile:G,citiesProfile:$,citiesCount:q,statesCount:W}=U||{},H=e=>Object.keys(e).map((e=>lt(0,G[e]).map((()=>e)))).flat(),z={cities:$&&H($)||(null==U?void 0:U.cities)||wA({count:q||A,participantsCount:A}).cities,states:G&&H(G)||(null==U?void 0:U.states)||PA({count:W||A,participantsCount:A}).states,postalCodes:V&&H(V)||(null==U?void 0:U.postalCodes)||DA({count:j||A,participantsCount:A}).postalCodes},Y=function(e){let t=Math.ceil(A/e);return r&&t>r?Math.ceil(A/r):e}(u),K=Y?Xe(B).slice(0,u):c&&B.filter((e=>c.includes(e.iso)))||B,J=Xe(lt(0,Math.ceil(A/(Y||1))).map((()=>K)).flat(1/0)),Q=EA({count:p}).names;return{participants:lt(0,p).map((e=>{let t=(N?2:M&&(f??8))||1,i=lt(0,t).map((i=>function(e){let t=O[e],{nationalityCode:i,participantExtensions:n,participantTimeItems:r,extensions:a,firstName:o,birthDate:u,lastName:c,personId:p,sex:m}=t||{},f=o||"GivenName",I=c||"FamilyName",U=`${f} ${I}`,y=J[e],S=(null==C?void 0:C.length)&&i||y&&("IOC"===d?y.ioc||y.iso:y.iso||y.ioc)||i;null!=J&&J.length&&!S&&!i&&console.log("%c Invalid Nationality Code",{participantIndex:e,country:y});let w=bA({...z,participantIndex:e,nationalityCode:S}),P=_a({participantId:TA({participantType:zp,index:e,idPrefix:v,uuids:g}),extensions:n,timeItems:r,participantRole:sg,participantType:zp,participantName:U,person:{personId:p||(null==h?void 0:h.length)&&h[e]||rs(),birthDate:Uo(u)?u:void 0,addresses:[w],standardFamilyName:I,standardGivenName:f,nationalityCode:S,extensions:a,sex:m}});if(b&&S){let e=tm.find((({iso:e})=>e===S));null!=e&&e.ioc&&(P.person.iocNationalityCode=e.ioc),null!=e&&e.label&&(P.person.countryName=e.label)}if(T&&S){let e=tm.find((({iso:e})=>e===S));null!=e&&e.iso2&&(P.person.iso2NationalityCode=e.iso2),null!=e&&e.label&&(P.person.countryName=e.label)}let D=t=>{var i,n,r,a;let o=t.categoryName||t.ratingType||t.ageCategoryCode,s=null==(i=F[o])?void 0:i[e],l=null==(n=k[o])?void 0:n[e];OA({scaleValue:s,eventType:Js,scaleType:zu,participant:P,category:t}),OA({scaleValue:l,eventType:Zs,scaleType:zu,participant:P,category:t});let u=null==(r=x[o])?void 0:r[e],d=null==(a=_[o])?void 0:a[e];OA({scaleValue:u,eventType:Js,scaleType:Yu,participant:P,category:t}),OA({scaleValue:d,eventType:Zs,scaleType:Yu,participant:P,category:t})};return Array.isArray(s)?s.forEach((e=>D(e))):l&&D(l),P}(e*t+i))),n=i.map((e=>e.participantId)),r=i.map((e=>e.person.standardFamilyName)).join("/"),a=N?Kp:Jp,o={participantId:TA({participantType:a,index:e,idPrefix:v,uuids:g}),participantName:N?r:Q[e],participantRole:sg,individualParticipantIds:n,participantType:a};return D&&(o.individualParticipants=i),N||M?[o,...i]:i})).flat(),...At}}function OA({scaleValue:e,participant:t,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,o={itemValue:e,itemType:[Ku,n,i,a].join(".")};a&&e&&(t.timeItems||(t.timeItems=[]),t.timeItems.push(o))}function kA(e){let{category:t,scaledParticipantsCount:i,ratingsParameters:n,participantType:r,ratingsValues:a=[]}=e,o=t.rankingRange||e.rankingRange||[1,1e3],s={},l={},u={},d={},{categoryName:c,ageCategoryCode:p,ratingType:m}=t,f=t.categoryName||t.ratingType||t.ageCategoryCode;if((c||p)&&!m){let[e,t]=o||[];if(l[f]=Xe(lt(e,t)).slice(0,i||ze(20,30)),[Kp,Jp].includes(r)){let[e,t]=o||[];s[f]=Xe(lt(e,t)).slice(0,i||ze(20,30))}}if(m&&n[m]){let{ratingMax:e,ratingMin:o,ratingAttributes:s}=t,l={...n[m],...s||{}},{attributes:c={},decimalsCount:p,accessors:h,range:v,step:g}=l,I=e=>{let t={},i=Object.keys(e||{});for(let n of i){let i=e[n];if("object"==typeof i&&i.generator){let{range:e}=i,[r,a]=e.slice().sort();t[n]=ze(r,a)}else t[n]=i}return t},U=v[0]>v[1]?2:.7,[y,S]=v.slice().sort(),w=lt(0,2e3).map((()=>Ke(y,S,U,g,p))).filter((t=>(!e||t<=e)&&(!o||t>=o))).slice(0,i||ze(20,30)).map((e=>h?Object.assign({},...h.map((t=>({[t]:e}))),I(c)):e));u[f]=[...a,...w],[Kp,Jp].includes(r)&&(d[f]=[...a,...w])}return{singlesRankings:l,doublesRankings:s,singlesRatings:u,doublesRatings:d}}function FA(e){var t,i;let{alternatesCount:n=0,tieFormatName:r,drawSize:a}=e,o=0,s=0,l=0,u=0,d={},c={[Va]:0,[$a]:0,[ja]:0,[Ga]:0,[Ba]:0};null==(i=null==(t=wt(e.tieFormat)?e.tieFormat:Ys({namedFormat:r}))?void 0:t.collectionDefinitions)||i.filter(Boolean).forEach((e=>{let{category:t,collectionId:i,matchUpType:n,matchUpCount:r,gender:a}=e;if([Va,$a].includes(a)){let e=r*(n===Oe?2:1);c[a]<e&&(c[a]=e)}else a===ja&&(c[Va]<r&&(c[Va]=r),c[$a]<r&&(c[$a]=r));if(t){let e=JSON.stringify(t);d[e]=t}if(i||(e.collectionId=rs()),Xf(Oe)(n)){let e=r;u+=r,o=Math.max(o,e)}if(Xf(Ee)(n)){let e=r;l+=r,s=Math.max(s,e)}}));let p=Object.keys(d).length?Math.max(l,2*u):Math.max(s,2*o);return{maxDoublesDraw:o*(a+n),maxSinglesDraw:s*(a+n),teamSize:p,genders:c}}function xA({participantsProfile:e,tournamentRecord:t,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){if(0===(null==e?void 0:e.participantsCount))return{addedCount:0,...At};let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:d}=function({participantsProfile:e,eventProfiles:t,drawProfiles:i}){let{participantsCount:n,participantType:r=zp}=e||{},a=n||0,o={[$a]:0,[ja]:0,[Ga]:0,[Va]:0,[Ba]:0},s=0,l=0,u=0,d=0,c=0,p=({alternatesCount:e=0,uniqueParticipants:t,tieFormatName:i,drawSize:n=0,eventType:r,tieFormat:a,category:p,gender:m,stage:f})=>{let h=r===Qs,v=!!(t||f===nl||p||m);if(r===Xs){d=Math.max(d,n+e),a="object"==typeof a?a:Ys({namedFormat:i});let{teamSize:t,maxDoublesDraw:r,maxSinglesDraw:c,genders:p}=FA({alternatesCount:e,tieFormatName:i,tieFormat:a,drawSize:n});u=Math.max(u,t),l=Math.max(l,c),v||(s=Math.max(s,r)),Object.keys(p).forEach((e=>o[e]+=p[e]))}else if(h)if(v){let t=2*(n+e);c+=t,m&&(o[m]+=t)}else n+e&&n+e>s&&(s=n+e);else if(v){let t=n+e;m&&(o[m]+=t),c+=t}else n&&n>l&&(l=n+e)};if(null==t||t.forEach((e=>{let{tieFormatName:t,tieFormat:i,drawProfiles:n,eventType:r,category:a,gender:o}=e;if(n)for(let s of n){let{tieFormatName:e,tieFormat:n}=s;p({...s,tieFormatName:e||t,tieFormat:n||i,eventType:r,category:a,gender:o})}})),Array.isArray(i))for(let f of i)p(f);let m=Math.max(d*u,2*s,l);return s&&(r=Kp),(n||a)<m&&(n=m),n&&s&&[Kp,Xs].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||2*s>=l)&&(n=Math.ceil(n/2))),void 0===n&&(n=null!=t&&t.length||null!=i&&i.length?0:32),n<a&&(n=a),{uniqueParticipantsCount:c,participantsCount:n,largestTeamDraw:d,largestTeamSize:u,participantType:r,gendersCount:o}}({participantsProfile:e,eventProfiles:i,drawProfiles:n}),c=null==e?void 0:e.teamKey,p=CA({consideredDate:r,...e,participantsCount:o,participantType:s,gendersCount:d,uuids:a}).participants,m=0,f=gR({tournamentRecord:t,participants:p});if(f.error)return f;if(m+=f.addedCount,c){let e=UA({tournamentRecord:t,...c});if(e.error)return e}let h=p.filter((({participantType:e})=>e===zp)).map(hc),v=null!=e&&e.idPrefix?`${Jp}-${e.idPrefix}`:void 0;return f=gR({participants:lt(0,l).map((e=>{let t=h.slice(e*u,(e+1)*u),i=TA({index:e,participantType:s,idPrefix:v,uuids:a});return{participantName:`Team ${e+1}`,participantRole:sg,individualParticipantIds:t,participantType:Jp,participantId:i}})),tournamentRecord:t}),f.error?f:(m+=f.addedCount,{addedCount:m,...At})}function _A({drawProfiles:e,category:t,gender:i}){let n={},r=null==e?void 0:e.reduce(((e,r)=>{let{qualifyingPositions:a=0,participantsCount:o=0,uniqueParticipants:s,stage:l=il,drawSize:u=0}=r||{};Object.keys(e).includes(l)||(e[l]=0);let d=(o||u)-a;return s||i||t||l===nl?(Object.keys(n).includes(l)||(n[l]=0),n[l]+=d):e[l]=Math.max(e[l],d),e}),{}),a=Object.keys(n);return a.forEach((e=>r[e]+=n[e])),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function LA({allUniqueParticipantIds:e,stageParticipantsCount:t,eventParticipantType:i,targetParticipants:n}){let r=t[il]||0,a=t[nl]||0;return{stageParticipants:{QUALIFYING:null==n?void 0:n.filter((({participantType:e})=>e===i)).filter((({participantId:t})=>!e.includes(t))).slice(0,a),MAIN:null==n?void 0:n.filter((({participantType:e})=>e===i)).filter((({participantId:t})=>!e.includes(t))).slice(a,a+r)}}}var BA={[kc]:2,[Rc]:1,[bc]:1,[Ec]:1,[Tc]:4};function VA(e){let{defaultWithScorePercent:t=2,winningSide:i}=e,{matchUpStatusProfile:n=BA,matchUpFormat:r=hs,pointsPerMinute:a=1,sideWeight:o=4}=e;if(!co({matchUpFormat:r}))return{error:Gi};if("object"!=typeof n)return{error:Cr};if(t>100&&(t=100),isNaN(t)||isNaN(a)||isNaN(o))return{error:Cr};let s=Object.keys(n).filter((e=>Object.keys($c).includes(e)&&e!==Pc));if(Object.keys(s).reduce(((e,t)=>e+n[t]),0)>100)return{error:Cr,matchUpStatusProfile:n};let l=s.reduce(((e,t)=>(e.pointer=e.pointer+n[t],e.valueMap.push([e.pointer,t]),e)),{pointer:0,valueMap:[]}),u=ze(1,100),d=(l.valueMap.find((e=>u<=e[0]))??[100,Pc])[1],c={sets:[],scoreStringSide1:"",side2ScoreString:""};if([kc,Tc].includes(d)){i=i||ze(1,2);let e={score:c,matchUpStatus:d,winningSide:i};if(!(d===Tc&&ze(1,100)>100-t))return{outcome:e}}else if([Rc,bc].includes(d))return{outcome:{score:c,matchUpStatus:d}};let p,m=no(r),{bestOf:f=1,exactly:h,setFormat:v,finalSetFormat:g}=m??{},I=[],U=ze(0,1),y=i?[i-1]:[...lt(0,o).map((()=>U)),1-U],S=[Ec,Tc,Mc,Cc].includes(d)&&(ot(lt(1,h||f))||1),w=lt(1,(h??f)+1);for(let b of w){let e=b===(h??f),{set:t,incomplete:i,winningSideNumber:n}=jA({setFormat:e&&g||v,incomplete:S===b,pointsPerMinute:a,matchUpStatus:d,weightedRange:y,setNumber:b});if(I.push(t),i){p=n;break}if(Kb({matchUp:{score:{sets:I},matchUpFormat:r}}).calculatedWinningSide)break}let P=Kb({matchUp:{score:{sets:I},matchUpFormat:r,winningSide:i}}),D=p?i||p:P.calculatedWinningSide,{score:T}=_M({winningSide:D,score:{sets:I},matchUpStatus:d});return{outcome:{winningSide:D,matchUpStatus:d,score:T}}}function jA({weightedRange:e=[0,1],pointsPerMinute:t,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let o,s={setNumber:a},{setTo:l,tiebreakFormat:u,tiebreakAt:d,tiebreakSet:c,timed:p,minutes:m}=r,f=ze(0,e.length-1),h=e[f];if(p){let r=m*t,a=Math.round(.2*r),l=r+ot([1,-1])*a,u=function(e=1,t=3,i=!0){let n=0;for(let r=0;r<t;r++)n+=Math.random()*(e/t);return i&&e>1?Math.round(n):n}(l,2),d=[u,l-u];h&&d.reverse(),o=e[f]+1;let c=(d[0]>d[1]?1:d[1]>d[0]&&2)||0;if(n){let[e,t]=d;return Object.assign(s,{side1Score:e,side2Score:t}),Vc.includes(i)?{set:s,incomplete:n,winningSideNumber:o}:{set:s,incomplete:n}}c||(d[ze(0,1)]+=1),c=d[0]>d[1]?1:2,c!==o&&d.reverse();let[p,v]=d;return Object.assign(s,{side1Score:p,side2Score:v,winningSide:o}),{set:s}}if(n)return s.side1Score=ze(0,d),s.side2Score=ze(0,d),Vc.includes(i)&&(o=e[f]+1),{set:s,incomplete:n,winningSideNumber:o};{let t=lt(1,l+1).map((e=>lt(0,l+2-e).map((()=>e)))).flat(),i=t[ze(0,t.length-1)],n=l&&xD({isSide1:!0,tiebreakAt:d,lowValue:i,setTo:l}),a=!n,o=1===e.length&&e[f]+1;if(!a){o?(n[0]>n[1]?1:2)!==o&&n.reverse():h&&n.reverse();let[e,t]=n;Object.assign(s,{side1Score:e,side2Score:t})}let p,m=BD({matchUpScoringFormat:{setFormat:r},setObject:s});if(m.hasTiebreakCondition||a){let{NoAD:e,tiebreakTo:t}=u||c||{},i=lt(1,t+1).map((e=>lt(0,t+2-e).map((()=>e)))).flat(),n=i[ze(0,i.length-1)],r=_D({isSide1:!0,tiebreakNoAd:e,tiebreakTo:t,lowValue:n});if(r)if(a){let e=r[0]>r[1]?1:2;o?e!==o&&r.reverse():h&&r.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=r,p=(r[0]>r[1]?1:r[1]>r[0]&&2)||void 0}else 2===m.leadingSide?[s.side1TiebreakScore,s.side2TiebreakScore]=r:[s.side2TiebreakScore,s.side1TiebreakScore]=r}s.winningSide=m.winningSide||m.leadingSide||o||p}return{set:s}}function GA(e){var t,i,n;let{matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:u,event:d}=e;if(!u)return{error:$t};let c=e.matchUpFormat||u.matchUpFormat||(null==d?void 0:d.matchUpFormat),p=u.structures.slice().sort(qc),m=0,{matchUps:f,matchUpsMap:h}=Qh({matchUpFilters:{matchUpTypes:[Fe],roundNumbers:[1]},contextFilters:{stages:[il,nl]},inContext:!0,drawDefinition:u});if(null!=f&&f.length){let e=(null==(t=null==d?void 0:d.category)?void 0:t.ageCategoryCode)||(null==(i=null==d?void 0:d.category)?void 0:i.categoryName);if(e){let t=yN({singlesOnly:!0,tournamentRecord:s,drawDefinition:u,scaleAccessor:{scaleName:e,sortOrder:gN,scaleType:zu},event:d});if(t.error)return t;let{lineUps:i,participantsToAdd:n}=t;gR({tournamentRecord:s,participants:n}),Sd({element:u,extension:{name:qd,value:i}})}else{let e=null==(n=f[0])?void 0:n.structureId,{positionAssignments:t}=Kc({drawDefinition:u,structureId:e});if(null!=t&&t.length){let{participants:e}=zv({participantFilters:{participantTypes:[Fe]},tournamentRecord:s}),i=i=>{let n=i.tieMatchUps.filter(Xf(Ee)),r=i.tieMatchUps.filter(Xf(Oe));n.forEach(((i,n)=>{let r=i.matchUpId;i.sides.forEach((i=>{var a;let{drawPosition:o}=i,l=null==e?void 0:e.find((e=>{var i;let{participantId:n}=e;return(null==(i=t.find((e=>e.participantId===n)))?void 0:i.drawPosition)===o}));if(l){let e=null==(a=l.individualParticipantIds)?void 0:a[n];e&&HN({teamParticipantId:l.participantId,participantId:e,tournamentRecord:s,drawDefinition:u,tieMatchUpId:r,event:d})}}))})),r.forEach(((i,n)=>{let r=i.matchUpId;i.sides.forEach((i=>{var a,o;let{drawPosition:l}=i,c=null==e?void 0:e.find((e=>{var i;let{participantId:n}=e;return(null==(i=t.find((e=>e.participantId===n)))?void 0:i.drawPosition)===l}));c&&(null==(o=null==(a=c.individualParticipantIds)?void 0:a.slice(2*n,2*n+2))||o.forEach((e=>{HN({teamParticipantId:c.participantId,participantId:e,tournamentRecord:s,drawDefinition:u,tieMatchUpId:r,event:d})})))}))}))};f.forEach(i)}}}let v="string"==typeof a&&a,g=v&&Pc,I=2===p.length&&p[0].finishingPosition===Zl&&2===dt(p.map((({stage:e})=>e)),[il,ol]).length,U=p.map((({structureId:e})=>e));for(let y of U){if(m>=l)break;let t=u.structures.find((e=>e.structureId===y)),i=jh({contextFilters:{matchUpTypes:[Oe,Ee]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:h,structure:t,event:d}).matchUps;i.length;let n=i.filter((({winningSide:e})=>!e)).sort(iv).map(vc);for(let e of n){if(!isNaN(l)&&m>=l)break;let{matchUps:i}=jh({matchUpFilters:{matchUpTypes:[Oe,Ee]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:h,structure:t,event:d}),n=i.find((t=>t.matchUpId===e)),a=[Rc,bc].includes(n.matchUpStatus);if(null!=n&&n.readyToScore&&!a){let e=qA({matchUpStatusProfile:r,tournamentRecord:s,drawDefinition:u,targetMatchUp:n,matchUpFormat:c,matchUpStatus:g,scoreString:v,winningSide:!o&&1,event:d});if(null!=e&&e.error)return e;m+=1}}I&&t.finishingPosition===Zl&&e.completeRoundRobinPlayoffs&&qI({structureId:t.structureId,applyPositioning:!0,drawDefinition:u})}return{...At,completedCount:m}}function $A(e){let{matchUpStatusCodes:t,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:d}=e;if(!a||a.matchUpStatus===Sc)return;let{matchUpId:c}=a||{},{outcome:p}=KM({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return t&&(p.matchUpStatusCodes=t),LM({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:c,outcome:p,event:d})}function qA(e){let{matchUpStatusProfile:t={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:d}=e;if(l||a)return $A(e);let{matchUpId:c}=s||{},{outcome:p}=VA({matchUpStatusProfile:t,matchUpFormat:o,winningSide:u});return LM({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:o,matchUpId:c,outcome:p,event:d})}function WA({matchUpStatusProfile:e,completeAllMatchUps:t,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,isMock:a,event:o}){var s,l,u,d;let c=Eh({event:o}).flightProfile,{eventName:p,eventType:m,category:f}=o,{startDate:h}=n,v=[],g=(null==f?void 0:f.categoryName)||(null==f?void 0:f.ageCategoryCode)||(null==f?void 0:f.ratingType),I=null==(s=o.drawDefinitions)?void 0:s.map((({drawId:e})=>e));if(Array.isArray(null==c?void 0:c.flights))for(let[U,y]of c.flights.entries()){let{drawId:s,stage:c,drawName:f,drawEntries:S}=y;v.push(y.drawId);let w=r[U],{seedsCount:P,generate:D=!0}=w||{};if(D){let v=S.filter(ov(du)).map(ov(du)),y=g||p;if(n&&P&&P<=v.length&&lt(1,P+1).forEach(((e,t)=>{let i={scaleValue:e,scaleName:y,scaleType:Ju,eventType:m,scaleDate:h},r=v[t];Dw({tournamentRecord:n,participantId:r,scaleItem:i})})),null==I?void 0:I.includes(s))break;let D=aR({...w,matchUpType:m,seedingScaleName:y,tournamentRecord:n,drawEntries:S,drawName:f,drawId:s,isMock:a,event:o,stage:c});if(D.error)return{error:D.error,drawIds:[]};let{drawDefinition:T}=D;if(!T)return{error:Wt};let b=null==(l=r[U])?void 0:l.drawExtensions;if(Array.isArray(b)&&b.filter(yd).forEach((e=>Sd({element:T,extension:e}))),D=JR({suppressNotifications:!0,tournamentRecord:n,drawDefinition:T,event:o}),D.error)return{error:D.error,drawIds:[]};if(null!=w&&w.withPlayoffs){let e=null==(u=T.structures)?void 0:u[0].structureId,t=dS({idPrefix:w.idPrefix,...w.withPlayoffs,tournamentRecord:n,drawDefinition:T,structureId:e,isMock:a,event:o});if(null!=t&&t.error)return t}let R=null==w?void 0:w.completionGoal;if(!1!==(null==w?void 0:w.automated)&&(t||R)){let r=null==w?void 0:w.matchUpFormat,a=GA({completeAllMatchUps:!R&&t,matchUpStatusProfile:e,randomWinningSide:i,tournamentRecord:n,completionGoal:R,drawDefinition:T,matchUpFormat:r,event:o});if(a.error)return{error:a.error,drawIds:[]};let s=a.completedCount;if((null==w?void 0:w.drawType)===zl){let a=null==(d=T.structures)?void 0:d.find((e=>e.stage===il));if(!a)return{error:Si};let l=qI({structureId:a.structureId,tournamentRecord:n,drawDefinition:T,event:o});if(l.error)return{error:l.error,drawIds:[]};if(l=GA({completeAllMatchUps:!R&&t,completionGoal:R?R?R-(s??0):void 0:void 0,matchUpStatusProfile:e,randomWinningSide:i,tournamentRecord:n,drawDefinition:T,matchUpFormat:r,event:o}),l.error)return{error:l.error,drawIds:[]}}}}}return{...At,drawIds:v}}function HA(e){var t,i;let{participantsProfile:n={},uniqueParticipantsCount:r,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:u,uuids:d}=e,{category:c,gender:p,eventType:m}=u,f=Xf(Ks)(m)&&zp||Xf(Qs)(m)&&Kp||m,h=r[il]||0,v=r[nl]||0,g=null!=(t=s.drawProfiles)&&t.length?h+v:(null==(i=s.participantsProfile)?void 0:i.participantsCount)??0,I=[Va,$a].includes(p)?p:void 0,U=null!=n&&n.idPrefix?`E-${l}-${null==n?void 0:n.idPrefix}`:void 0,{participants:y}=CA({uuids:s.uuids||d,...n,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:null==o?void 0:o.startDate,rankingRange:s.rankingRange,participantType:f,participantsCount:g,ratingsParameters:a,category:c,idPrefix:U,sex:I}),S=gR({tournamentRecord:o,participants:y});return S.error?S:{uniqueDrawParticipants:null==y?void 0:y.filter((({participantType:e})=>e===f)),uniqueParticipantIds:null==y?void 0:y.map(hc)}}function zA({autoEntryPositions:e,tournamentRecord:t,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=Ml,qualifyingPositions:o=0,stage:s=il,drawSize:l=0,drawName:u,drawId:d}=n,c=l-o,p=i.slice(0,c).map(hc);if(p.length){let i=ag({participantIds:p,autoEntryPositions:e,entryStage:s,tournamentRecord:t,event:r});if(i.error)return i}let m=rN({drawName:u||a,qualifyingPositions:o,drawEntries:p.map((e=>({entryStatus:Om,entryStage:s,participantId:e}))),drawId:d,event:r,stage:s});return m.error?m:{...At}}function YA({uniqueDrawParticipants:e,autoEntryPositions:t,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let l=0;for(let u of r){let{qualifyingPositions:r=0,uniqueParticipants:d,stage:c=il,drawSize:p=0}=u,m=p-r,f=d||o||a||c===nl,h=f?e.slice(l,l+m):i[c||il]||[];f&&(l+=m);let v=zA({autoEntryPositions:t,drawParticipants:h,tournamentRecord:n,drawProfile:u,event:s});if(v.error)return v}return{...At}}function KA(e){var t;let{allUniqueParticipantIds:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:d,eventProfile:c,eventIndex:p,publish:m,isMock:f,uuids:h}=e,v=c.gender,g=c.eventName,{eventType:I=Ks,policyDefinitions:U,drawProfiles:y=[],eventExtensions:S,surfaceCategory:w,tieFormatName:P,processCodes:D,discipline:T,eventLevel:b,timeItems:R,ballType:N,category:M}=c,A=c.eventId||rs(),E=c.tieFormat||(I===Xs?Ys({namedFormat:P,event:{eventId:A,category:M,gender:v},hydrateCollections:s,isMock:f}):void 0),C=d.participants;for(let H of y)!v&&H.gender&&(v=null==H?void 0:H.gender);let{stageParticipantsCount:O,uniqueParticipantsCount:k,uniqueParticipantStages:F}=_A({drawProfiles:y,category:M,gender:v}),x=Xf(Ks)(I)&&zp||Xf(Qs)(I)&&Kp||I,{uniqueDrawParticipants:_=[],uniqueParticipantIds:L=[]}=F?HA({event:{eventType:I,category:M,gender:v},uniqueParticipantsCount:k,participantsProfile:r,ratingsParameters:u,tournamentRecord:d,eventProfile:c,eventIndex:p,uuids:h}):{},{eventAttributes:B}=c;"object"!=typeof B&&(B={});let V=(null==M?void 0:M.categoryName)||(null==M?void 0:M.ageCategoryCode)||(null==M?void 0:M.ratingType);g=g||V||"Generated Event";let j={...B,surfaceCategory:w,processCodes:D,discipline:T,eventLevel:b,eventName:g,eventType:I,tieFormat:E,ballType:N,category:M,eventId:A,gender:v};if(null!=S&&S.length&&Array.isArray(S)){let e=S.filter(yd);null!=e&&e.length&&Object.assign(j,{extensions:e})}if(Array.isArray(R)&&R.forEach((e=>oS({event:q,timeItem:e}))),"object"==typeof U)for(let H of Object.keys(U))cS({policyDefinitions:{[H]:U[H]},event:j});j.category&&(j.category.categoryName=V);let G,$=PR({suppressNotifications:!1,internalUse:!0,tournamentRecord:d,event:j});if($.error)return $;let q=null==$?void 0:$.event,{stageParticipants:W}=LA({allUniqueParticipantIds:i,stageParticipantsCount:O,eventParticipantType:x,targetParticipants:C});if(null!=y&&y.length){let e=YA({uniqueDrawParticipants:_,autoEntryPositions:o,stageParticipants:W,tournamentRecord:d,drawProfiles:y,category:M,gender:v,event:q});if(e.error)return e;let t=WA({matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:d,drawProfiles:y,isMock:f,event:q});if(t.error)return t;G=t.drawIds}else if(null!=(t=null==c?void 0:c.participantsProfile)&&t.participantsCount){let e=_.map(hc);if(e.length){let t=ag({participantIds:e,autoEntryPositions:o,tournamentRecord:d,entryStage:il,event:q});if(t.error)return t}}return m&&RR({tournamentRecord:d,event:q}),{drawIds:G,eventId:A,uniqueParticipantIds:L}}function JA({tournamentRecords:e,scheduleDate:t,venueId:i,round:n}){if(!Uo(t))return{error:vn};let{extension:r}=Cd({name:Xd,tournamentRecords:e,discover:!0}),a=(null==r?void 0:r.value)||[],o=a.find((e=>Go(t,e.scheduleDate)));if(!o){let{startDate:i,endDate:n}=PT({tournamentRecords:e}),r=new Date(t);if(i&&r<new Date(i)||n&&r>new Date(n))return{error:vn};o={scheduleDate:t,venues:[]},a.push(o)}let s=o.venues.find((e=>e.venueId===i));s||(s={venueId:i,rounds:[]},o.venues.push(s));let l=["notBeforeTime"],u=e=>Object.keys(e).filter((e=>!l.includes(e))).sort().map((t=>wt(e[t])?u(e[t]):e[t])).flat().join("|");if(s.rounds.find((e=>u(e)===u(n))))return La({result:{error:Ui},stack:"addSchedulingProfileRound"});s.rounds.push(n);let d=ab({tournamentRecords:e,schedulingProfile:a});return d.error?d:{...At}}function QA(e){var t,i,n;let r=qu(e,[{drawProfile:!0,_ofType:Ou}]);if(r.error)return r;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:u,hydrateCollections:d,randomWinningSide:c,ratingsParameters:p,tournamentRecord:m,isMock:f=!0,drawProfile:h,startDate:v,drawIndex:g,uuids:I}=e,U=ts(h,!1,!0),{excessParticipantAlternates:y=!0,matchUpFormat:S=hs,drawType:w=Ml,tournamentAlternates:P=0,alternatesCount:D=0,qualifyingPositions:T,qualifyingProfiles:b,generate:R=!0,eventExtensions:N,drawExtensions:M,completionGoal:A,tieFormatName:E,buildTeams:C,seedsCount:O,timeItems:k,drawName:F,category:x,idPrefix:_,publish:L,gender:B,stage:V}=U,j=U.drawSize||(U.ignoreDefaults?void 0:32),G=U.eventId||rs(),$=h.eventType||h.matchUpType||Ks,q=$===Qs?Kp:zp,W=wt(h.tieFormat)&&h.tieFormat||$===Jp&&Ys({event:{eventId:G,category:x,gender:B},namedFormat:E,hydrateCollections:d,isMock:f})||void 0,H=(null==x?void 0:x.categoryName)||(null==x?void 0:x.ageCategoryCode)||(null==x?void 0:x.ratingType),z=h.eventName||H||`Generated ${$}`,Y=(null==m?void 0:m.participants)||[],K=((null==b?void 0:b.map((e=>e.structureProfiles||[])).flat().reduce(((e,t)=>e+(!t.participantsCount||t.participantsCount>t.drawSize?t.drawSize:t.participantsCount||0)),0))||0)*(q===Kp?2:1),J=(!h.participantsCount||h.participantsCount>j?j:h.participantsCount)||0,Q={eventName:z,eventType:$,tieFormat:W,category:x,eventId:G,gender:B};Array.isArray(k)&&k.forEach((e=>oS({event:Q,timeItem:e})));let{eventAttributes:Z}=h;if("object"!=typeof Z&&(Z={}),Object.assign(Q,Z),(null==N?void 0:N.length)&&Array.isArray(N)){let e=N.filter(yd);null!=e&&e.length&&Object.assign(Q,{extensions:e})}let X=[];if(0===(null==o?void 0:o.participantsCount)||h.uniqueParticipants||K||!m||B||x){let e,t,i=(J||0)+D+K,n=i,r={[Va]:0,[$a]:0};$===Jp&&(({teamSize:e,genders:t}=FA({alternatesCount:D,tieFormatName:E,tieFormat:W,drawSize:j})),Object.keys(t).forEach((e=>{[Va,$a].includes(e)&&t[e]&&(r[e]=j*t[e])})),n=e*((j||0)+K));let a=null!=o&&o.idPrefix?`D-${g}-${null==o?void 0:o.idPrefix}`:void 0,s=CA({...o,scaledParticipantsCount:h.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:n,consideredDate:null==m?void 0:m.startDate,sex:B||(null==o?void 0:o.sex),rankingRange:h.rankingRange,uuids:h.uuids||I,ratingsParameters:p,participantType:q,gendersCount:r,idPrefix:a,category:x}).participants;if(Q.category&&(Q.category.categoryName=H),m){let e=gR({participants:s,tournamentRecord:m});if(e.error)return e}if(s.forEach((({participantId:e})=>X.push(e))),Y=s,$===Jp){let n=t[Va]?s.filter((({participantType:e,person:t})=>e===zp&&(null==t?void 0:t.sex)===Va)).map(hc):[],r=t[$a]?s.filter((({participantType:e,person:t})=>e===zp&&(null==t?void 0:t.sex)===$a)).map(hc):[],a=s.filter((({participantType:e})=>e===zp)).map(hc).filter((e=>!n.includes(e)&&!r.includes(e))),o=[...U.teamNames??[],...EA({count:i}).names],l=e-(t[Va]+t[$a]),u=0,d=0,c=0,p=lt(0,i).map((e=>{let i=r.slice(u,u+t[$a]),s=n.slice(d,d+t[Va]),p=a.slice(c,c+l);u+=t[$a],d+=t[Va],c+=l;let m=!1!==C?[...i,...s,...p]:[];return{participantName:o[e]||`Team ${e+1}`,participantOtherName:`TM${e+1}`,participantRole:sg,individualParticipantIds:m,participantType:Jp,participantId:rs()}})),f=gR({participants:p,tournamentRecord:m});if(!f.success)return f;Y=p}}let ee=e=>{let{participantType:t}=e;return!!(Xf(Ks)($)&&t===zp||Xf(Qs)($)&&t===Kp)||$===Jp&&t===Jp},te=e=>{var t,i;return!h.gender||(null==(t=e.person)?void 0:t.sex)===h.gender||(null==(i=e.individualParticipantIds)?void 0:i.some((e=>{let t=Y.find((t=>t.participantId===e));return t&&te(t)})))},ie=Y.filter(ee).filter(te).filter((({participantId:e})=>!a.includes(e))),ne=ie.slice(0,J).map((e=>e.participantId));if(f&&null!=ne&&ne.length){let e=ag({autoEntryPositions:u,entryStage:V,tournamentRecord:m,participantIds:ne,event:Q});if(e.error)return e}let re=K?ie.slice(J,J+K).map((e=>e.participantId)):0;if(f&&null!=re&&re.length){let e=0,t=1,i=(e,t)=>e.stageSequence-t.stageSequence,n=(e,t)=>e.roundTarget-t.roundTarget;for(let r of b.sort(n)){t=r.roundTarget||t;let n,a=1;for(let o of r.structureProfiles.sort(i)){let i=(o.drawSize||Ge(o.participantsCount))-(n||0),r=re.slice(e,e+i),s=ag({entryStage:nl,entryStageSequence:a,autoEntryPositions:u,tournamentRecord:m,participantIds:r,roundTarget:t,event:Q});if(s.error)return s;n=o.qualifyingPositions,e+=i,a+=1}t+=1}}let ae=y&&(null==(t=null==m?void 0:m.participants)?void 0:t.filter((({participantId:e})=>!ne.includes(e))).filter(ee).filter(te).slice(0,D||j-J||P).map((e=>e.participantId)));if(f&&null!=ae&&ae.length){let e=ag({participantIds:ae,autoEntryPositions:!1,entryStatus:Em,tournamentRecord:m,event:Q});if(e.error)return e.error}let oe=H||z;m&&O&&O<=ne.length&&lt(1,O+1).forEach(((e,t)=>{let i={scaleName:oe,scaleDate:v,scaleType:zf,scaleValue:e,eventType:$},n=ne[t];Dw({tournamentRecord:m,participantId:n,scaleItem:i})}));let se=aR({...ts(h,!1,!0),tournamentRecord:m,seedingScaleName:oe,matchUpFormat:S,eventId:G,isMock:f,event:Q});if(se.error)return se;if(!se.drawDefinition)return{error:Wt};let{drawDefinition:le}=se,ue=le.drawId;if(Array.isArray(M)&&M.filter(yd).forEach((e=>Sd({element:le,extension:e}))),R){if(JR({drawDefinition:le,event:Q,suppressNotifications:!0}),h.withPlayoffs){let e=null==(i=le.structures)?void 0:i[0].structureId,t=dS({...h.withPlayoffs,tournamentRecord:m,drawDefinition:le,structureId:e,idPrefix:_,isMock:f,event:Q});if(null!=t&&t.error)return t}let e=!1===h.automated;if(f&&!e){let e=e=>{var t;let i=GA({completeAllMatchUps:e.completeAllMatchUps,completionGoal:e.completionGoal,matchUpStatusProfile:s,randomWinningSide:c,tournamentRecord:m,drawDefinition:le,matchUpFormat:S,event:Q});if(i.error)return i;let n=i.completedCount;if(w===zl){let e=null==(t=le.structures)?void 0:t.find((e=>e.stage===il));if(!e)return{error:Si};qI({structureId:e.structureId,tournamentRecord:m,drawDefinition:le,event:Q});let i=GA({completionGoal:A?A?A-(n??0):void 0:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:c,tournamentRecord:m,drawDefinition:le,matchUpFormat:S,event:Q});if(i.error)return i}};if(A&&e({completionGoal:A}),h.outcomes){let{matchUps:e}=nv({inContext:!0,drawDefinition:le,event:Q});for(let t of h.outcomes){let{matchUpStatus:i=Pc,matchUpStatusCodes:r,stageSequence:a=1,matchUpIndex:o=0,structureOrder:s,matchUpFormat:l,drawPositions:u,roundPosition:d,stage:c=il,roundNumber:p,winningSide:f,scoreString:h}=t,v=(null==e?void 0:e.reduce(((e,t)=>{let{structureId:i,matchUpId:n}=t;return e[i]?e[i].push(n):e[i]=[n],e}),{}))??[],g=Object.assign({},...Object.keys(v).map(((e,t)=>({[e]:t+1})))),I=null==(n=null==e?void 0:e.filter((e=>!(c&&e.stage!==c||a&&e.stageSequence!==a||p&&e.roundNumber!==p||d&&e.roundPosition!==d||s&&g[e.structureId]!==s||u&&2!==dt(u,e.drawPositions).length))))?void 0:n[o],U=$A({matchUpStatusCodes:r,tournamentRecord:m,drawDefinition:le,targetMatchUp:I,matchUpFormat:l,matchUpStatus:i,scoreString:h,winningSide:f});if(null!=U&&U.error)return U}}l&&e({completeAllMatchUps:l})}L&&RR({tournamentRecord:m,event:Q})}else{let e=rN({drawEntries:le.entries,drawName:F||w,qualifyingPositions:T,drawId:ue,event:Q,stage:V});if(e.error)return e}return{...At,event:_a(Q),uniqueParticipantIds:X,targetParticipants:Y,drawDefinition:le,eventId:G,drawId:ue}}var ZA=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),XA=ZA;function eE(e){return parseInt(e)}function tE({startTime:e="",endTime:t=""}={}){if(!(e&&t&&ho.test(e)&&ho.test(t)))return!1;let[i,n]=e.split(":").map(eE),[r,a]=t.split(":").map(eE);return!(r<i)&&!(i===r&&a<n)}function iE(e,t){let[i,n]=e.startTime.split(":").map(eE),[r,a]=t.startTime.split(":").map(eE);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function nE({dateAvailability:e}){if(!e)return{error:hn};if(!Array.isArray(e))return{error:fn};let t="Times must be 24 hour => 00:00";for(let i of e){if("object"!=typeof i)return{error:fn};let{date:e,startTime:n,endTime:r,bookings:a=[]}=i;if(!n||!r)return{error:fn};if(e&&!fo.test(e))return{error:vn,dateAvailability:{date:e},info:"Dates must be formated => YYYY-MM-DD"};if(!ho.test(n))return{error:gn,dateAvailability:{startTime:n},info:t};if(!ho.test(r))return{error:gn,dateAvailability:{endTime:r},info:t};if(n===r)return{error:gn,dateAvailability:{startTime:n,endTime:r},info:"startTime and endTime are equivalent"};if(!tE({startTime:n,endTime:r}))return{error:gn,dateAvailability:{startTime:n,endTime:r},info:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:mn};for(let e of a){if("object"!=typeof e)return{error:mn};let{startTime:i,endTime:n}=e;if(!ho.test(i))return{error:gn,booking:{startTime:i},info:t};if(!ho.test(n))return{error:gn,booking:{endTime:n},info:t};if(i===n)return{error:gn,dateAvailability:{startTime:i,endTime:n},info:"startTime and endTime are equivalent"};if(!tE({startTime:i,endTime:n}))return{error:gn,dateAvailability:{startTime:i,endTime:n},info:"endTime must be after startTime"}}}}return{valid:!0}}function rE({tournamentRecord:e,disableNotice:t,venueId:i,courtId:n,court:r}){let{venue:a}=Th({tournamentRecord:e,venueId:i});if(!a)return{error:ur};a.courts||(a.courts=[]);let o={...ZA(),venueId:i,courtId:n};if(o.courtId||(o.courtId=rs()),a.courts.some((e=>e.courtId===o.courtId)))return{error:sr};{let n=((null==r?void 0:r.dateAvailability)||[]).map((e=>{var t;return{...e,date:Eo(e.date),startTime:Ao(e.startTime),endTime:Ao(e.endTime),bookings:null==(t=e.bookings)?void 0:t.map((({startTime:e,endTime:t,bookingType:i})=>({startTime:Ao(e),endTime:Ao(t),bookingType:i})))}})),s=Object.keys(o);for(let e of s)if(null!=r&&r[e])if("dateAvailability"===e){let e=nE({dateAvailability:n});if(!e.valid&&e.error)return e;o.dateAvailability=n}else o[e]=r[e];let l=o;return a.courts.push(l),t||Ia({payload:{venue:a,tournamentId:e.tournamentId},topic:gp,key:a.venueId}),{...At,court:ts(o),venueId:i}}}function aE(e){let{tournamentRecord:t,venueId:i}=e;if("string"!=typeof i||!i)return{error:dr};let n,r=e.tournamentRecords??(t&&{[t.tournamentId]:t})??{},a=[];for(let o of Object.values(r)){let{venue:t}=Th({tournamentRecord:o,venueId:i});if(t){let t=oE({...e,tournamentRecord:o});for(let e of(null==t?void 0:t.courts)??[])a.push(null==e?void 0:e.courtId);if(t.error)return t;n=!0}}return n?{...At,courtIds:a}:{error:ur}}function oE({courtNameRoot:e="Court",dateAvailability:t=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:d,venueId:c,dates:p}){if(!c)return{error:dr};let m=Th({tournamentRecord:n,venueId:c});if(m.error)return m;let{venue:f}=m;if(!qe(o)||!r)return{error:ar};let h=lt(0,o=o??r.length).map((n=>{let o=null==a?void 0:a[n],l=o?p.map((e=>({date:So(e),startTime:s,endTime:u,...o}))):t;return o&&s&&u&&l.push({startTime:s,endTime:u}),{courtName:r[n]||i&&(null==f?void 0:f.venueAbbreviation)&&`${null==f?void 0:f.venueAbbreviation} ${n+1}`||`${e} ${n+1}`,dateAvailability:l}})).map(((e,t)=>{let i=(null==l?void 0:l.pop())||d&&`${d}-${t+1}`;return rE({disableNotice:!0,tournamentRecord:n,courtId:i,venueId:c,court:e})})).map((e=>e.court)).filter(Boolean);return h.length!==o?La({info:"not all courts could be generated",result:{error:Cr}}):(f&&Ia({payload:{venue:f,tournamentId:n.tournamentId},topic:gp,key:f.venueId}),{...At,courts:ts(h)})}function sE({tournamentRecord:e,ignoreExistingVenues:t,venueProfiles:i,uuids:n}){let{startDate:r,endDate:a}=e,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:i,venueId:u=(null==n?void 0:n.pop())??rs(),dateAvailability:d,startTime:c="07:00",endTime:p="19:00",courtTimings:m,courtsCount:f,courtNames:h,venueName:v,idPrefix:g,courtIds:I}=l,U=Ph({tournamentRecord:e,venue:{venueName:v||`Venue ${s+1}`,venueAbbreviation:i,venueId:u}});if(U.error){if(t)continue;return U}o.push(u);let y=Do(r,a),S=!Array.isArray(d)&&[{startTime:c,endTime:p}].concat(y.map((e=>({date:So(e),startTime:c,endTime:p}))));if(f||h){let t=aE({dateAvailability:d||S,tournamentRecord:e,courtTimings:m,courtsCount:f,courtNames:h,startTime:c,idPrefix:g,courtIds:I,endTime:p,venueId:u,dates:y});if(t.error)return t}}return o}var lE=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function uE(e){var t,i,n;let{startDate:r,endDate:a}=e??{},{tournamentName:o=ot(lE),ratingsParameters:s=py,tournamentExtensions:l,policyDefinitions:u,schedulingProfile:d,venueProfiles:c,uuids:p}=e??{},m=!1!==(null==e?void 0:e.isMock)||void 0;if(r&&!Uo(r)||a&&!Uo(a))return{error:vn};if(e.leagueProfiles&&!Array.isArray(e.leagueProfiles)||e.eventProfiles&&!Array.isArray(e.eventProfiles)||e.drawProfiles&&!Array.isArray(e.drawProfiles))return{error:Cr};if(!r){let e=new Date;r=So(a??e),a=So(e.setDate(e.getDate()+7))}if(!a){let e=new Date(r);a=So(e.setDate(e.getDate()+7))}let f=IA({...e.tournamentAttributes??{},tournamentName:o,startDate:r,endDate:a,isMock:m}),h=null!=c&&c.length?sE({tournamentRecord:f,venueProfiles:c,uuids:p}):[];if(null!=l&&l.length&&Array.isArray(l)){let e=l.filter((e=>yd({extension:e})));null!=e&&e.length&&Object.assign(f,{extensions:e,isMock:m})}if("object"==typeof u)for(let S of Object.keys(u))cS({policyDefinitions:{[S]:u[S]},tournamentRecord:f});if(null==(t=null==e?void 0:e.leagueProfiles)||!t.length||null!=(i=e.eventProfiles)&&i.length||null!=(n=e.drawProfiles)&&n.length||e.participantsProfile){let t=xA({tournamentRecord:f,...e});if(!t.success)return t}let v=[],g=[],I=[];if(e.leagueProfiles){let t=function(e){var t,i,n;let{tournamentRecord:r,leagueProfiles:a,eventIds:o,venueIds:s,drawIds:l,allUniqueParticipantIds:u,uuids:d}=e,c=0;for(let p of a){let a=[],{tieFormatName:m=Ts,teamProfiles:f=[],teamsCount:h=0,category:v,idPrefix:g,gender:I}=p,U=p.leagueName??p.eventName??`League ${c+1}`,y=p.leagueId??p.eventId??(null==d?void 0:d.pop())??rs();o.push(y);let S=wt(p.tieFormat)&&p.tieFormat||Ys({event:{eventId:y,category:v,gender:I},namedFormat:m,isMock:e.isMock})||void 0;if(!S)return{error:Wi};let w=Math.max(h,f.length),P=lt(0,w),{genders:D,teamSize:T}=FA({tieFormat:S,drawSize:w}),b={[$a]:0,[ja]:0,[Ga]:0,[Va]:0,[Ba]:0};Object.keys(D).forEach((e=>b[e]+=D[e]));for(let o of P){let l=(null==(t=null==f?void 0:f[o])?void 0:t.teamName)??`Team ${o+1}`,c=(null==(i=null==f?void 0:f[o])?void 0:i.teamId)||(null==d?void 0:d.pop())||rs(),m=p.startDate??e.startDate,h=CA({...null==p?void 0:p.participantsProfile,participantsCount:T,consideredDate:m,gendersCount:b,category:v,gender:I,uuids:d}).participants,U=h.map((e=>e.participantId)),y=Jp,S=c??TA({participantType:y,idPrefix:g,index:o,uuids:d});a.push({participantId:S,entryStatus:Om,entryStage:il});let w=(null==(n=null==f?void 0:f[o])?void 0:n.venueIds)??[],P={participantId:S,participantRole:sg,participantName:l,individualParticipantIds:U,participantType:y,homeVenueIds:w};w.forEach((e=>!s.includes(e)&&s.push(e))),u.push(...U),u.push(S);let D=gR({participants:[P,...h],tournamentRecord:r});if(D.error)return D}let R={eventName:U,entries:a,eventType:Jp,tieFormat:S,category:v,eventId:y,gender:I};if(r.events||(r.events=[]),r.events.push(R),a.length){let e=(qe(p.roundsCount)&&p.roundsCount)??p.roundsCount===Wl?2*(w-1):w-1,t=aR({automated:p.automated,tournamentRecord:r,drawType:Tl,roundsCount:e,drawSize:w,event:R});if(t.error)return t;let{drawDefinition:i}=t;if(i){let e=null==i?void 0:i.drawId;JR({drawDefinition:i,event:R,suppressNotifications:!0}),l.push(e)}}c++}sE({tournamentRecord:r,ignoreExistingVenues:!0,venueProfiles:s.map((e=>({venueId:e}))),uuids:d})}({allUniqueParticipantIds:v,tournamentRecord:f,...e,eventIds:g,venueIds:h,drawIds:I});if(null!=t&&t.error)return t}if(e.drawProfiles){let t=function(e){let{tournamentRecord:t,drawProfiles:i,allUniqueParticipantIds:n,eventIds:r,drawIds:a}=e,o=0;for(let s of i){let i=QA({allUniqueParticipantIds:n,tournamentRecord:t,drawProfile:s,drawIndex:o,...e});if(i.error)return i;let{drawId:l,eventId:u,event:d,uniqueParticipantIds:c}=i;if(!1!==(null==s?void 0:s.addEvent)){if(i=PR({suppressNotifications:!1,internalUse:!0,tournamentRecord:t,event:d}),i.error)return i;l&&a.push(l),r.push(u)}null!=c&&c.length&&n.push(...c),o+=1}}({allUniqueParticipantIds:v,ratingsParameters:s,tournamentRecord:f,...e,eventIds:g,drawIds:I});if(null!=t&&t.error)return t}if(e.eventProfiles){let t=function(e){let{eventProfiles:t,allUniqueParticipantIds:i,eventIds:n,drawIds:r}=e,a=0;for(let o of t){let t=KA({...e,eventIndex:a,eventProfile:o});if(t.error)return t;let{eventId:s,drawIds:l,uniqueParticipantIds:u}=t;l&&r.push(...l),n.push(s),null!=u&&u.length&&i.push(...u),a+=1}}({allUniqueParticipantIds:v,ratingsParameters:s,tournamentRecord:f,...e,eventIds:g,drawIds:I});if(null!=t&&t.error)return t}let{scheduledRounds:U,schedulerResult:y={}}=d?function(e){let{schedulingProfile:t,tournamentRecord:i,autoSchedule:n,periodLength:r,scheduleCompletedMatchUps:a}=e,o=function({schedulingProfile:e,tournamentRecord:t}){if("object"!=typeof e)return{error:Cr};let i=Vp({tournamentRecord:t}).containedStructures,n=ev({tournamentRecord:t}).matchUps??[],{tournamentId:r}=t,a=[];for(let o of e){let{scheduleDate:e,venues:s=[]}=o;for(let o of s){let{rounds:s,venueId:l}=o;for(let o of s){let{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,c=n.filter((e=>{var t;let i=(null==u?void 0:u.indexOf("-"))>0&&u.split("-").map((e=>+e)),n=null==(t=e.finishingPositionRange)?void 0:t.winner;return!(e.drawId!==s||o.roundNumber&&e.roundNumber!==o.roundNumber||n&&i&&2!==dt(n,i).length&&(Qe(n).length!==Qe(i).length||dt(n,i).length!==Qe(n).length))}))[0];if(c){let{eventId:n,roundNumber:o,drawName:p,structureName:m,roundName:f}=c,h=c.structureId;o&&!u&&(h=Object.keys(i).find((e=>i[e].includes(h)))??h);let v={tournamentId:r,structureId:h,roundNumber:o,roundSegment:d,eventId:n,drawId:s},g=JA({tournamentRecords:{[r]:t},round:v,scheduleDate:e,venueId:l});if(g.error)return g;a.push({structureName:m,roundName:f,drawName:p,...v})}}}}return{scheduledRounds:a}}({schedulingProfile:t,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(n){let{tournamentId:e}=i;return{schedulerResult:gA({scheduleCompletedMatchUps:a,tournamentRecords:{[e]:i},periodLength:r}),scheduledRounds:s}}return{scheduledRounds:s}}({...e,tournamentRecord:f}):{};return ga(),_a({...At,tournamentRecord:f,scheduledRounds:U,schedulerResult:y,eventIds:g,venueIds:h,drawIds:I})}var dE={};function cE({keepExtensions:e=[],anonymizeParticipantNames:t=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var o,s,l,u,d;if(!i)return{error:Bt};let c=Array.isArray(e)?rc.concat(...e):rc,p=t=>{var i;return Array.isArray(e)?null==(i=null==t?void 0:t.extensions)?void 0:i.filter((e=>c.includes(e.name))):null==t?void 0:t.extensions},m={};i.extensions=p(i);let f=a||rs();m[i.tournamentId]=f,i.tournamentId=f,i.createdAt=(new Date).toISOString(),i.tournamentName=n||`Anonymized: ${So(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let _ of i.participants||[]){_.extensions=p(_),_.onlineResources=[];let e=rs();m[_.participantId]=e,_.participantId=e}for(let _ of i.participants||[])Array.isArray(_.individualParticipantIds)&&(_.individualParticipantIds=_.individualParticipantIds.map((e=>m[e])));let h=0;for(let _ of i.venues||[]){_.venueAbbreviation=`V${h}`,_.extensions=p(_),_.venueName=`Venue #${h}`,_.onlineResources=[],_.addresses=[];let e=rs();m[_.venueId]=e,_.isMock=!0,h+=1;let t=0;for(let i of _.courts||[])i.courtName=`V${h}C${t}`,i.extensions=p(i),i.onlineResources=[],i.isMock=!0,t+=1}let v=1;for(let _ of i.events||[]){_.extensions=p(_),_.onlineResources=[],_.isMock=!0;let e=rs();m[_.eventId]=e,_.eventId=e;let t=(null==(o=_.category)?void 0:o.categoryName)||(null==(s=_.category)?void 0:s.ageCategoryCode)||(null==(l=_.category)?void 0:l.ratingType)||_.gender;if(_.eventName=`Event ${v} ${t}`,Array.isArray(_.entries))for(let n of _.entries)n.participantId=m[n.participantId];for(let n of _.drawDefinitions||[]){n.extensions=p(n);let e=rs();if(m[n.drawId]=e,n.drawId=e,n.isMock=!0,Array.isArray(n.entries))for(let i of n.entries)i.participantId=m[i.participantId];let t=e=>{e.extensions=p(e);let t=rs();m[e.structureId]=t,e.structureId=t;for(let i of e.positionAssignments||[])i.participantId&&(i.participantId=m[i.participantId]);for(let i of e.seedAssignments||[])i.participantId&&(i.participantId=m[i.participantId]);for(let i of e.matchUps||[]){i.isMock=!0;for(let e of i.sides||[])e.lineUp&&(e.lineUp=e.lineUp.map((({participantId:e,collectionAssignments:t})=>({participantId:m[e],collectionAssignments:t}))))}};for(let i of n.structures||[])if(t(i),Array.isArray(i.structures))for(let e of i.structures)t(e);for(let i of n.links||[])i.source.structureId=m[i.source.structureId],i.target.structureId=m[i.target.structureId]}let{extension:i}=Cd({name:Gd,element:_});Array.isArray(null==(u=null==i?void 0:i.value)?void 0:u.flights)&&(null==(d=null==i?void 0:i.value.flights)||d.forEach((e=>{if(e.drawId=m[e.drawId],Array.isArray(e.drawEntries))for(let t of e.drawEntries)t.participantId=m[t.participantId]}))),v+=1}let g=i.startDate||So(new Date),I=(i.participants||[]).filter((({participantType:e})=>e===zp)),U=I.reduce(((e,t)=>{var i;let n=null==(i=t.person)?void 0:i.sex;return[Va,$a].includes(n)?e[n]+=1:e[Ga]+=1,e}),{[Va]:0,[$a]:0,[Ga]:0}),y=Object.assign({},...Object.keys(U).map((e=>{var t;return{[e]:(null==(t=MA({category:{ageCategoryCode:"O18"},count:U[e],addressProps:{citiesCount:10},personExtensions:[],consideredDate:g,sex:e}))?void 0:t.persons)||[]}}))),S={[Va]:0,[$a]:0,[Ga]:0},w=I.length,P=I.reduce(((e,t)=>{var i,n;let r=(null==(n=null==(i=t.person)?void 0:i.addresses)?void 0:n[0])||{},{city:a,state:o,postalCode:s}=r;return e.cities.includes(a)||e.cities.push(a),e.states.includes(o)||e.states.push(o),e.postalCodes.includes(s)||e.postalCodes.push(s),e}),{cities:[],postalCodes:[],states:[]}),D=P.postalCodes.length,T=P.cities.length,b=P.states.length,{cities:R}=wA({count:T||w,participantsCount:w}),{states:N}=PA({count:b||w,participantsCount:w}),{postalCodes:M}=DA({count:D||w,participantsCount:w}),A={cities:R,states:N,postalCodes:M};I.forEach(((e,i)=>{var n,a;let o=null==e?void 0:e.person,s=(null==o?void 0:o.sex)||Ga,l=null==(n=Eo(null==o?void 0:o.birthDate))?void 0:n.split("-")[0],u=S[s],d=y[s][u];if(S[s]+=1,l){let[,e,t]=(null==(a=null==d?void 0:d.birthDate)?void 0:a.split("-"))||[],i=[l,e,t].join("-");d.birthDate=i}if(null!=o&&o.addresses){let e=bA({...A,participantIndex:i,nationalityCode:d.nationalityCode});d.addresses=[e]}d.personId=(null==r?void 0:r[i])||rs(),t?(d.standardFamilyName=d.lastName,d.standardGivenName=d.firstName,e.participantName=`${d.standardGivenName} ${d.standardFamilyName}`):(d.standardFamilyName=null==o?void 0:o.standardFamilyName,d.standardGivenName=null==o?void 0:o.standardGivenName),delete d.firstName,delete d.lastName,d.extensions=p(o),e.person=d,m[null==o?void 0:o.personId]=d.personId})),(i.participants||[]).filter((({participantType:e})=>e===Kp)).forEach((e=>{let{individualParticipantIds:t}=e;e.participantName=function({individualParticipantIds:e,individualParticipants:t}){let i=t.filter((({participantId:t})=>e.includes(t))).map((({person:e})=>null==e?void 0:e.standardFamilyName)).filter(Boolean).sort().join("/");return 1===e.length&&(i+="/Unknown"),i}({individualParticipantIds:t,individualParticipants:I})}));let E=(i.participants||[]).filter((({participantType:e})=>e===Jp)),C=EA({count:E.length}).names;E.forEach(((e,t)=>{e.participantName=C[t]}));let O=(i.participants||[]).filter((({participantType:e})=>e===Yp)),k=EA({count:O.length,nameRoot:"Group"}).names;O.forEach(((e,t)=>{e.participantName=k[t]}));let{extension:F}=Cd({element:i,name:Xd});Array.isArray(null==F?void 0:F.value)&&(null==F||F.value.forEach((e=>{e.tournamentId=m[e.tournamentId],e.structureId=m[e.structureId],e.eventId=m[e.eventId],e.drawId=m[e.drawId]})));let{extension:x}=Cd({element:i,name:Yd});return Array.isArray(null==x?void 0:x.value)&&(null==x||x.value.forEach((e=>{e.personId=m[e.personId]}))),{...At}}function pE(e){var t,i,n;let{ratingsParameters:r=py,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:d,schedulingProfile:c,tournamentRecord:p,autoSchedule:m,eventProfiles:f,periodLength:h,venueProfiles:v,drawProfiles:g,isMock:I,uuids:U}=e;if(!p)return{error:Bt};let y=[],S=[],w=[];null==f||f.forEach((e=>{var t;let i=null==(t=p.events)?void 0:t.find(((t,i)=>void 0!==e.eventIndex&&i===e.eventIndex||e.eventName&&t.eventName===e.eventName||e.eventId&&t.eventId===e.eventId));null!=i&&i.gender&&(e.gender=i.gender)}));let P=(null==(t=p.participants)?void 0:t.length)||void 0;P&&null!=a&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${P}`);let D=xA({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:f,drawProfiles:g,uuids:U});if(!D.success)return D;if(f){let e=(null==(i=p.events)?void 0:i.length)||0;for(let t of f){let{ratingsParameters:i}=t,r=null==(n=p.events)?void 0:n.find(((e,i)=>void 0!==t.eventIndex&&i===t.eventIndex||t.eventName&&e.eventName===t.eventName||t.eventId&&e.eventId===t.eventId));if(r){let{gender:e,category:n,eventType:u}=r,{drawProfiles:c,publish:m}=t,f=Xf(Ks)(u)&&zp||Xf(Qs)(u)&&Kp||u;if(c){let{stageParticipantsCount:m,uniqueParticipantsCount:h,uniqueParticipantStages:v}=_A({drawProfiles:c,category:n,gender:e}),{uniqueDrawParticipants:g=[],uniqueParticipantIds:S=[]}=v?HA({event:{eventType:u,category:n,gender:e},uniqueParticipantsCount:h,participantsProfile:a,ratingsParameters:i,tournamentRecord:p,eventProfile:t,uuids:U}):{};y.push(...S);let{stageParticipants:P}=LA({targetParticipants:p.participants||[],allUniqueParticipantIds:y,stageParticipantsCount:m,eventParticipantType:f}),D=YA({uniqueDrawParticipants:g,autoEntryPositions:l,stageParticipants:P,tournamentRecord:p,drawProfiles:c,category:n,gender:e,event:r});if(D.error||(D=WA({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:d,tournamentRecord:p,drawProfiles:c,isMock:I,event:r}),D.error))return D;w.push(...D.drawIds)}m&&RR({tournamentRecord:p,event:r})}else{let n=KA({startDate:p.startDate,allUniqueParticipantIds:y,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:d,ratingsParameters:i,tournamentRecord:p,eventProfile:t,eventIndex:e,uuids:U});if(n.error)return n;let{eventId:r,drawIds:u,uniqueParticipantIds:c}=n;u&&w.push(...u),S.push(r),null!=c&&c.length&&y.push(...c),e+=1}}}if(g){let e=(p.events||[]).map((e=>{var t;return(null==(t=e.drawDefinitions)?void 0:t.map((()=>1)))||[]})).flat().reduce(((e,t)=>e+t),0);for(let t of g){let i=QA({startDate:p.startDate,allUniqueParticipantIds:y,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:d,ratingsParameters:r,tournamentRecord:p,drawProfile:t,drawIndex:e,uuids:U});if(i.error)return i;let{drawId:n,eventId:c,event:m,uniqueParticipantIds:f}=i;if(i=PR({tournamentRecord:p,event:m,internalUse:!0}),i.error)return i;n&&w.push(n),S.push(c),null!=f&&f.length&&y.push(...f),e+=1}}let T=null!=v&&v.length?sE({tournamentRecord:p,venueProfiles:v}):[],b={};if(null!=c&&c.length){let e=ab({tournamentRecords:{[p.tournamentId]:p},schedulingProfile:c});if(e.error)return e;if(m){let{tournamentId:e}=p;b=gA({tournamentRecords:{[e]:p},periodLength:h})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:undefined,schedulerResult:b,...At,eventIds:S,venueIds:T,drawIds:w}}be(dE,{anonymizeTournamentRecord:()=>cE,modifyTournamentRecord:()=>pE});var mE={};be(mE,{addDynamicRatings:()=>Nw,addIndividualParticipantIds:()=>qN,addParticipant:()=>vR,addParticipants:()=>gR,addPenalty:()=>BE,addPersonRequests:()=>yE,addPersons:()=>jE,createGroupParticipant:()=>NE,createTeamsFromParticipantAttributes:()=>UA,deleteParticipants:()=>gg,filterParticipants:()=>Wv,findParticipant:()=>RE,getCompetitionParticipants:()=>dT,getPairedParticipant:()=>Fh,getParticipantEventDetails:()=>cT,getParticipantMembership:()=>pT,getParticipantScaleItem:()=>Mw,getParticipantSchedules:()=>mT,getParticipantSignInStatus:()=>fT,getParticipantTimeItem:()=>um,getParticipants:()=>zv,getScaleValues:()=>Zu,mergeParticipants:()=>LE,modifyIndividualParticipantIds:()=>SE,modifyParticipant:()=>WN,modifyParticipantName:()=>ME,modifyParticipantOtherName:()=>PE,modifyParticipantsSignInStatus:()=>wE,modifyPenalty:()=>FE,modifyPersonRequests:()=>IE,mutate:()=>fE,participantScaleItem:()=>Ov,query:()=>uT,regenerateParticipantNames:()=>bE,removeIndividualParticipantIds:()=>fg,removeParticipantIdsFromAllTeams:()=>vg,removePenalty:()=>CE,removePersonRequests:()=>UE,removeRatings:()=>EE,scaledTeamAssignment:()=>AE,setParticipantScaleItem:()=>Dw,setParticipantScaleItems:()=>Tw,validateLineUp:()=>tI});var fE={};function hE(e=0){("number"!=typeof e||isNaN(e))&&(e=0);let t=new Date;return t.setHours(t.getHours()+e),t.getTime().toString(36).slice(-6).toUpperCase()}function vE({personRequests:e,personId:t,requests:i}){e[t]||(e[t]=[]);let n=i.filter((({requestType:e})=>e)).map((e=>{let{date:t,startTime:i,endTime:n}=e;return e.requestType===eA&&(t=Eo(t),i=Ao(i),n=Ao(n),t&&i&&n)?{date:t,startTime:i,endTime:n,requestType:e.requestType}:e})).filter(Boolean);for(let r of n)r.requestId=hE(),e[t].push(r);return{mergeCount:n.length}}function gE(e){let{tournamentRecords:t,personRequests:i}=e,n=qu(e,[{[nu]:!0}]);if(n.error)return n;if(!i)return{...At};let r=Object.values(t);for(let a of r){let e=a.participants??[],t=[];for(let n of Object.keys(i))if(vd({tournamentParticipants:e,personId:n})){let e=i[n];e.length&&t.push({personId:n,requests:e})}Object.keys(t).length&&Sd({element:a,extension:{value:t,name:Yd}})}return{...At}}function IE(e){let{tournamentRecords:t,requests:i,personId:n}=e,r=qu(e,[{[nu]:!0},{requests:!0,[Lu]:ku,[_u]:Cr}]);if(r.error)return r;let a=i.map((({requestId:e})=>e)).filter(Boolean),{personRequests:o}=lb({tournamentRecords:t}),s=e=>{o&&(o[e]=o[e].map((e=>{if(!a.includes(e.requestId))return e;let t=i.find((t=>t.requestId===e.requestId));return t.requestType?Object.assign(e,t):void 0})).filter(Boolean))};if(n&&null!=o&&o[n])s(n);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter((e=>!e.requestId));return l.length&&vE({personRequests:o,personId:n,requests:l}),gE({tournamentRecords:t,personRequests:o})}function UE(e){let{tournamentRecords:t,requestType:i,requestId:n,personId:r,date:a}=e,o=qu(e,[{[nu]:!0}]);if(o.error)return o;let{personRequests:s}=lb({tournamentRecords:t}),l=e=>{var t;s&&(s[e]=s[e].filter((e=>!(i&&e.requestType===i||n&&e.requestId===n||a&&e.date===a))),null!=(t=null==s?void 0:s[e])&&t.length||delete s[e])},u=!(i||n||r||a);if(!u)if(r&&null!=s&&s[r])l(r);else if(s)for(let d of Object.keys(s))l(d);return!u&&s&&Object.keys(s).length?gE({tournamentRecords:t,personRequests:s}):Ud({name:Yd,tournamentRecords:t,discover:!0})}function yE(e){let{tournamentRecords:t,personId:i,requests:n}=e,r=qu(e,[{[nu]:!0,personId:!0},{requests:!0,[Lu]:ku,[_u]:Cr}]);if(r.error)return r;let{personRequests:a}=lb({tournamentRecords:t}),{mergeCount:o}=vE({personRequests:a,personId:i,requests:n});return o&&a?gE({tournamentRecords:t,personRequests:a}):{error:Cr}}function SE({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return La({result:{error:Bt},stack:n});if(!t||!e)return La({result:{error:un},stack:n});let r=i.participants||[],a=r.find((e=>e.participantId===t));if(!a)return La({result:{error:_n},stack:n});if(![Jp,Yp].includes(a.participantType))return La({result:{error:Cn},context:{participantType:a.participantType},stack:n});let o=e.filter((e=>{var t;return(null==(t=r.find((t=>t.participantId===e)))?void 0:t.participantType)!==zp}));if(o.length)return La({result:{error:An,invalidParticipantIds:o},stack:n});let s=a.individualParticipantIds||[],l=e.filter((e=>!s.includes(e))),u=s.filter((t=>!e.includes(t))),d=qN({individualParticipantIds:l,groupingParticipantId:t,tournamentRecord:i});if(d.error)return La({result:d,stack:n});let c=fg({individualParticipantIds:u,groupingParticipantId:t,tournamentRecord:i});if(c.error)return La({result:c,stack:n});let{topics:p}=Pa();if(p.includes(mp)){let e=r.find((({participantId:e})=>e===t));Ia({topic:mp,payload:{tournamentId:i.tournamentId,participants:[e]}})}return{...d,...c}}function wE({tournamentRecord:e,participantIds:t,signInState:i}){if(!e)return{error:Bt};if(!Array.isArray(t))return{error:un};if(![Wp,qp].includes(i))return{error:Cr,signInState:i};let n=e.participants||[];if(!n.length)return{error:Fn};let r=n.map(hc),a=t.filter((e=>!r.includes(e)));if(a.length)return{error:Cr,context:{invalidParticipantIds:a}};let o=[],s=(new Date).toISOString();for(let u of n){let{participantId:n}=u;if(t.includes(n)){let t=rS({duplicateValues:!1,tournamentRecord:e,participantId:n,timeItem:{itemType:$p,itemValue:i,createdAt:s}});if(t.error)return t;o.push(u)}}let{topics:l}=Pa();return o.length&&l.includes(mp)&&Ia({topic:mp,payload:{tournamentId:e.tournamentId,participants:o}}),{...At}}function PE({tournamentRecord:e,participantId:t,participantOtherName:i}){if(!e)return{error:Bt};if(!t)return{error:xn};let{participant:n}=nm({tournamentRecord:e,participantId:t});if(!n)return{error:_n};n.participantOtherName=i;let{topics:r}=Pa();return r.includes(mp)&&Ia({topic:mp,payload:{tournamentId:e.tournamentId,participants:[n]}}),{...At}}function DE({personFormat:e,person:t}){let i=e=>e.replace(/\W/g,""),n=e=>e.toLowerCase().indexOf("l")<e.toLowerCase().indexOf("f"),r=e=>e.indexOf(",")>=0;if(!t)return;let a=e.indexOf(" ")>0?" ":"",o=Dg((null==t?void 0:t.standardGivenName)??""),s=Dg((null==t?void 0:t.standardFamilyName)??"");if(!e)return`${o}${a}${s}`;(e=>e.toLowerCase().indexOf("f.")>=0)(e)&&!r(e)&&!n(e)&&(o=`${o[0]}.`),(e=>/^[a-z]*$/.test(i(e)))(e)?(o=o.toLowerCase(),s=s.toLowerCase()):(e=>/^[A-Z]*$/.test(i(e)))(e)?(o=o.toUpperCase(),s=s.toUpperCase()):(e=>/^[LAST]{4}/.test(i(e)))(e)&&(s=s.toUpperCase());let l=`${o}${a}${s}`;return(e=>e.toLowerCase().indexOf("f")<0)(e)?l=s:n(e)&&(l=r(e)?`${s},${a}${o}`:`${s}${a}${o}`),l}function TE({participantMap:e,participant:t,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=t,o=n&&i[n];if(n!==Hp&&o){let{personFormat:i,doublesJoiner:s}=o;n===zp&&(t.participantName=DE({person:a,personFormat:i})),n===Kp&&(t.participantName=null==r?void 0:r.map((t=>{var n;return DE({person:null==(n=e[t])?void 0:n.person,personFormat:i})})).filter(Boolean).join(s??"/"))}}function bE({tournamentRecord:e,formats:t}){if(!e)return{error:Bt};if(!wt(t))return{error:un};let i=e.participants??[],n=Dt(i,"participantId");for(let r of i)TE({participant:r,participantMap:n,formats:t});return{...At}}function RE(e){let t,i,{tournamentRecord:n,policyDefinitions:r,contextProfile:a,participantId:o,personId:s}=e,l=e.tournamentRecords||n&&{[n.tournamentId]:n}||{};if("string"!=typeof o&&"string"!=typeof s)return{error:un,stack:"publicFindParticipant"};for(let u of Object.values(l)){if(i=u.tournamentId,t=vd({tournamentParticipants:u.participants||[],internalUse:!0,policyDefinitions:r,contextProfile:a,participantId:o,personId:s}),t)break}return{participant:t,tournamentId:i,...At}}function NE({individualParticipantIds:e=[],participantRoleResponsibilities:t,participantRole:i=cg,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:Bt};if(!a)return{error:un,info:"Missing groupName"};if(!Array.isArray(e))return{info:"Invalid individualParticipantIds",error:Cr};let o=(zv({participantFilters:{participantTypes:[zp]},tournamentRecord:n}).participants??[]).map((e=>e.participantId));for(let d of e)if(!o.includes(d))return{error:Cn,participantId:d};let s=_a({participantId:r||rs(),participantRoleResponsibilities:t,participantName:a,individualParticipantIds:e,participantType:Yp,participantRole:i}),l=vR({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:u}=Pa();return u.includes(Xc)&&Ia({topic:Xc,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...At,participant:ts(s)}}function ME({tournamentRecord:e,participantName:t,participantId:i}){if(!e)return{error:Bt};if(!i)return{error:xn};if(!t)return{error:un,info:"Missing participantName"};let{participant:n}=nm({tournamentRecord:e,participantId:i});if(!n)return{error:_n};n.participantName=t;let{topics:r}=Pa();return r.includes(mp)&&Ia({topic:mp,payload:{tournamentId:e.tournamentId,participants:[n]}}),{...At}}function AE({clearExistingAssignments:e=!0,individualParticipantIds:t,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:d,event:c}){var p,m,f,h,v;if(!o)return{error:Bt};if(!Array.isArray(a)&&!Ye(u)&&!d||!Ye(n)||r&&!Array.isArray(r)||s&&("object"!=typeof s||!Object.keys(s).length))return{error:Cr};if(!s&&!r.length||!r&&(!t||!s))return{error:un,info:"Missing scaling details"};if(d&&!a){if((null==c?void 0:c.eventType)!==el)return{error:Ti};a=null==(p=null==c?void 0:c.entries)?void 0:p.filter((({entryStatus:e})=>e===Om)).map(hc)}if(!(null!=a&&a.length||u))return{info:"Missing teamParticipantIds or teamsCount",error:un};let g=t??r.map((({participantId:e})=>e));i&&(null==a||a.reverse(),n+=1),n>((null==a?void 0:a.length)||0)-1&&(n=0);let I=(null==a?void 0:a.slice(n).concat(...a.slice(0,n)))??[],U=[];for(let w of o.participants??[]){let{participantId:e,participantType:t}=w;if(I.includes(e)){if(t!==Hp)return{error:Cn,participant:w};U.push(w)}}if(u&&U.length<u){let e=u-((null==U?void 0:U.length)||0),t=l??"Team",i=lt(0,e).map((e=>({participantName:`${t} ${e+1}`,participantType:Hp,participantRole:sg}))),{participants:n=[]}=gR({participants:i,returnParticipants:!0,tournamentRecord:o}),r=n.map(hc),a=(null==(m=o.participants)?void 0:m.filter((({participantId:e})=>r.includes(e))))??[];U.push(...a)}if(!U.length)return{error:kr};if(e)for(let w of U)w.individualParticipantIds=[];else{let e=U.map((e=>e)).flat();null!=t&&t.length?g=g.filter((t=>!e.includes(t))):r=null==r?void 0:r.filter((({participantId:t})=>!e.includes(t)))}if(!(null!=t&&t.length||null!=r&&r.length))return{error:br,info:"Nothing to be done"};if(!r.length){for(let e of o.participants??[]){let{participantId:t,participantType:i}=e;if(!g.includes(t))continue;if(i!==zp)return{error:Cn,participant:e};let n=null==(f=Ov({scaleAttributes:s,participant:e}))?void 0:f.scaleItem,a={participantId:t,scaleValue:null!=s&&s.accessor?null==(h=null==n?void 0:n.scaleValue)?void 0:h[null==s?void 0:s.accessor]:null==n?void 0:n.scaleValue};r.push(a)}if(!r.length)return{error:_n}}r.sort(((e,t)=>null!=s&&s.sortOrder?((null==t?void 0:t.scaleValue)||0)-((null==e?void 0:e.scaleValue)||0):((null==e?void 0:e.scaleValue)||1/0)-((null==t?void 0:t.scaleValue)||1/0)));for(let w of r)if(!w.participantId)return{error:Cr,scaledParticipant:w};let y=0;for(;y<r.length;){for(let e of U){if(y+1>r.length)break;let t=r[y];e.individualParticipantIds.push(t.participantId),y++}U.reverse()}let S=U.map(hc);for(let w of o.events??[]){if(w.eventType!==el)continue;let e=(w.entries??[]).filter((e=>S.includes(e.participantId)));for(let t of e){let e=t.participantId,i=null==(v=U.find((t=>t.participantId===e)))?void 0:v.individualParticipantIds;w.entries=(w.entries??[]).filter((e=>!i.includes(e.participantId))),(w.drawDefinitions??[]).forEach((e=>{e.entries=(e.entries??[]).filter((e=>!i.includes(e.participantId)))}));let{flightProfile:n}=Eh({event:w});((null==n?void 0:n.flights)||[]).forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!i.includes(e.participantId)))}))}}return{...At,scaledParticipants:r}}function EE(e){let t=qu(e,[{[au]:!0,[gu]:!0},{ratingType:!1,[Fu]:e=>py[e]}]);if(t.error)return t;let i=`${e.ratingType}.${Hu}`,n=e.asDynamic?i:e.ratingType,r=[Ku,Yu,e.eventType,n].join("."),a=e.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter((e=>e.itemType!==r)));return{...At}}function CE(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:Lt};for(let i of Object.values(t)){let t=OE({...e,tournamentRecord:i});if(t.error&&t.error!==rr)return t}return{...At}}function OE({tournamentRecord:e,penaltyId:t}){if(!e)return{error:Bt};if(!t)return{error:nr};let i,n=(null==e?void 0:e.participants)??[],r=[],a=!1;return n.forEach((e=>{let n=!1;e.penalties=(e.penalties??[]).filter((o=>(o.penaltyId===t&&(n=!0,a||(i=o,a=!0)),n&&r.push(e),o.penaltyId!==t)))})),i&&Ia({topic:mp,payload:{tournamentId:e.tournamentId,participants:r}}),i?{...At,penalty:i}:{error:rr}}be(fE,{addDynamicRatings:()=>Nw,addIndividualParticipantIds:()=>qN,addParticipant:()=>vR,addParticipants:()=>gR,addPenalty:()=>BE,addPersonRequests:()=>yE,addPersons:()=>jE,createGroupParticipant:()=>NE,createTeamsFromParticipantAttributes:()=>UA,deleteParticipants:()=>gg,findParticipant:()=>RE,mergeParticipants:()=>LE,modifyIndividualParticipantIds:()=>SE,modifyParticipant:()=>WN,modifyParticipantName:()=>ME,modifyParticipantOtherName:()=>PE,modifyParticipantsSignInStatus:()=>wE,modifyPenalty:()=>FE,modifyPersonRequests:()=>IE,regenerateParticipantNames:()=>bE,removeIndividualParticipantIds:()=>fg,removeParticipantIdsFromAllTeams:()=>vg,removePenalty:()=>CE,removePersonRequests:()=>UE,removeRatings:()=>EE,scaledTeamAssignment:()=>AE,setParticipantScaleItem:()=>Dw,setParticipantScaleItems:()=>Tw});var kE=({penaltyId:e=rs()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:e});function FE(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:Lt};for(let i of Object.values(t)){let t=xE({...e,tournamentRecord:i});if(t.error&&t.error!==rr||t.success)return t}return{error:rr}}function xE({tournamentRecord:e,modifications:t,penaltyId:i}){if(!e)return{error:Bt};if(!t)return{error:Cr,modifications:t};if(!i)return{error:nr};let n=(null==e?void 0:e.participants)??[],r=Object.keys(kE()).filter((e=>"penaltyId"!==e)),a=Object.keys(t).filter((e=>r.includes(e)));if(!a.length)return{error:xr};let o,s=[];return n.forEach((e=>{let n=!1;e.penalties=(e.penalties??[]).map((e=>(e.penaltyId===i&&(n=!0,a.forEach((i=>Object.assign(e,{[i]:t[i]}))),o||(o=e)),e))),n&&s.push(e)})),o&&Ia({topic:mp,payload:{tournamentId:e.tournamentId,participants:s}}),o?{...At,penalty:o}:{error:rr}}function _E(e,t,i){return!e&&t?t:e&&!t||"object"!=typeof e||"object"!=typeof t?e:Qe(Object.keys(e).concat(Object.keys(t))).reduce(((n,r)=>{if(t[r])if(e[r])if(typeof e[r]!=typeof t[r])n[r]=t[r];else if(Array.isArray(e[r]))if(!0===i||Array.isArray(i)&&i.includes(r)){let i=Qe(e[r].map((e=>JSON.stringify(e))).concat(t[r].map((e=>JSON.stringify(e))))).map((e=>JSON.parse(e)));n[r]=i}else n[r]=t[r];else"object"==typeof e[r]?n[r]=_E(e[r],t[r],i):n[r]=t[r];else n[r]=t[r];else n[r]=e[r];return n}),{})}function LE({participants:e=[],tournamentRecord:t,arraysToMerge:i}){if(!t)return{error:Bt};t.participants||(t.participants=[]);let n=e.filter(ov(du)).map((e=>({[e.participantId]:e}))),r=Object.assign({},...n),a=[];t.participants=t.participants.map((e=>{if(r[e.participantId]){let t=_E(e,r[e.participantId],i);return a.push(t),t}return e}));let o=t.participants.map(ov(du))||[],s=e.filter((({participantId:e})=>!o.includes(e))),{topics:l}=Pa();return s.length&&(t.participants=t.participants.concat(...s),l.includes(Xc)&&Ia({topic:Xc,payload:{participants:s}})),a.length&&l.includes(mp)&&Ia({topic:mp,payload:{tournamentId:t.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...At}}function BE(e){var t;let i,{tournamentRecord:n,participantIds:r}=e,a=e.tournamentRecords??(n&&{[n.tournamentId]:n})??{};for(let o of Object.values(a)){let n=null==(t=zv({tournamentRecord:o}).participants??[])?void 0:t.map(hc).filter((e=>r.includes(e)));n.length&&(i=VE({...e,penaltyId:e.penaltyId??i,tournamentRecord:o,participantIds:n}).penaltyId)}return i?{...At,penaltyId:i}:{error:_n}}function VE({refereeParticipantId:e,tournamentRecord:t,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!t)return{error:Bt};if(!i)return{error:xn};if(!r)return{error:ir};let d=((null==t?void 0:t.participants)??[]).filter((e=>i.includes(e.participantId)));if(!d.length)return{error:_n};let c=(new Date).toISOString(),p=Object.assign(kE({penaltyId:o}),{refereeParticipantId:e,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:c,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach((e=>Sd({element:p,extension:e}))),d.forEach((e=>{e.penalties||(e.penalties=[]),e.penalties.push(p)})),Ia({topic:mp,payload:{tournamentId:t.tournamentId,participants:d}}),{...At,penaltyId:p.penaltyId}}function jE({participantRole:e=sg,tournamentRecord:t,persons:i}){var n;if(!t)return{error:Bt};if(!Array.isArray(i))return{error:Cr};if(!Object.keys(mg).includes(e))return{error:En};let r=(t.participants||[]).map((({person:e})=>null==e?void 0:e.personId)).filter(Boolean),a=[],o=i.filter((e=>e&&(!e.personId||!r.includes(e.personId)))).map((e=>(e.personId||(e.personId=rs()),a.push(e.personId),e))),s=(e,t)=>Object.assign({},...Object.keys(e).filter((e=>!t.includes(e))).map((t=>({[t]:e[t]})))),l=0,u=0,d=gR({participants:o.map((t=>_a({extensions:t.participantExtensions,timeItems:t.participantTimeItems,participantType:zp,participantRole:e,person:s(t,["participantExtensions","participantTimeItems","pairedPersons"])}))),tournamentRecord:t});if(d.error)return d;u=d.addedCount||0;let c=[],p=(null==(n=zv({participantFilters:{participantTypes:[zp]},tournamentRecord:t}))?void 0:n.participants)??[];if(e===sg&&i.filter((({pairedPersons:e})=>e)).forEach((({personId:e,pairedPersons:t})=>{Array.isArray(t)&&t.forEach((t=>{let i=[e,t.personId].map((e=>vd({tournamentParticipants:p,personId:e}))).filter(Boolean);if(2===i.length){let e=i.map(hc);c.push(_a({extensions:t.participantExtensions,timeItems:t.timeItems,participantRole:sg,individualParticipantIds:e,participantType:Kp}))}}))})),c.length){if(d=gR({participants:c,tournamentRecord:t}),d.error)return d;l=d.addedCount||0}let m=u+l;return{...At,addedCount:m,newPersonIds:a}}var GE={};be(GE,{bulkUpdatePublishedEventIds:()=>VT,getAllEventData:()=>WT,getCourtInfo:()=>Mh,getDrawData:()=>KT,getEventData:()=>JT,getEventPublishStatus:()=>Lv,getPublishState:()=>Vv,getTournamentPublishStatus:()=>_v,getVenueData:()=>Ah,mutate:()=>$E,publishEvent:()=>RR,publishEventSeeding:()=>qE,publishOrderOfPlay:()=>ZE,publishParticipants:()=>JE,query:()=>BT,setEventDisplay:()=>eN,unPublishEvent:()=>eC,unPublishEventSeeding:()=>WE,unPublishOrderOfPlay:()=>YE,unPublishParticipants:()=>HE});var $E={};function qE({removePriorValues:e=!0,stageSeedingScaleNames:t,seedingScaleNames:i,tournamentRecord:n,status:r=Kf,drawIds:a=[],event:o}){var s,l,u,d;if(!n)return{error:Bt};if(!o)return{error:bi};let c=Lv({event:o,status:r}),p=((null==(s=null==c?void 0:c.seeding)?void 0:s.seedingScaleNames)||i)&&{...null==(l=null==c?void 0:c.seeding)?void 0:l.seedingScaleNames,...i};return bR({statusObject:{seeding:_a({stageSeedingScaleNames:((null==(u=null==c?void 0:c.seeding)?void 0:u.stageSeedingScaleNames)||t)&&{...null==(d=null==c?void 0:c.seeding)?void 0:d.stageSeedingScaleNames,...t},seedingScaleNames:p,published:!0,drawIds:a})},removePriorValues:e,status:r,event:o}),Ia({topic:yp,payload:{tournamentId:n.tournamentId,eventId:o.eventId,drawIds:a}}),{...At}}function WE({removePriorValues:e=!0,seedingScaleNames:t,tournamentRecord:i,status:n=Kf,drawIds:r,stages:a,event:o}){var s,l;if(!i)return{error:Bt};if(!o)return{error:bi};let u=Lv({event:o});if(u){let i=u.seeding;if(Array.isArray(a)&&i.stageSeedingScaleNames)for(let e of a)i.stageSeedingScaleNames[e]&&delete i.stageSeedingScaleNames[e];Array.isArray(t)&&null!=i&&i.seedingScaleNames&&(i.seedingScaleNames=i.seedingScaleNames.filter((e=>!t.includes(e)))),Array.isArray(r)&&null!=i&&i.drawIds&&(i.drawIds=i.drawIds.filter((e=>!r.includes(e)))),(Object.values(i.stageSeedingScaleNames??{}).length||null!=(s=i.seedingScaleNames)&&s.length||null!=(l=i.drawIds)&&l.length)&&(a||t||null!=r&&r.length)||(delete i.stageSeedingScaleNames,delete i.seedingScaleNames,delete i.drawIds,i.published=!1),bR({statusObject:{seeding:i},removePriorValues:e,status:n,event:o})}return Ia({topic:Dp,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...At}}function HE(e){let t=Gp(e);if(!Object.keys(t).length)return{error:Lt};for(let i of Object.values(t)){let t=zE({tournamentRecord:i,...e});if(t.error)return t}return{...At}}function zE({removePriorValues:e=!0,tournamentRecord:t,status:i=Kf}){if(!t)return{error:Bt};let n=`${Yf}.${Jf}`,{timeItem:r}=am({element:t,itemType:n}),a=(null==r?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,nS({timeItem:{itemValue:a,itemType:n},element:t,removePriorValues:e}),Ia({payload:{tournamentId:t.tournamentId},topic:bp}),{...At}}function YE(e){let t=Gp(e);if(!Object.keys(t).length)return{error:Lt};for(let i of Object.values(t)){let t=KE({tournamentRecord:i,...e});if(t.error)return t}return{...At}}function KE({removePriorValues:e=!0,tournamentRecord:t,status:i=Kf}){if(!t)return{error:Bt};let n=`${Yf}.${Jf}`,{timeItem:r}=am({element:t,itemType:n}),a=(null==r?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,nS({timeItem:{itemValue:a,itemType:n},element:t,removePriorValues:e}),Ia({topic:Tp,payload:{tournamentId:t.tournamentId}}),{...At}}function JE(e){let t=Gp(e);if(!Object.keys(t).length)return{error:Lt};for(let i of Object.values(t)){let t=QE({tournamentRecord:i,...e});if(t.error)return t}return{...At}}function QE({removePriorValues:e,tournamentRecord:t,status:i=Kf}){if(!t)return{error:Bt};let n=`${Yf}.${Jf}`,{timeItem:r}=am({element:t,itemType:n}),a=(null==r?void 0:r.itemValue)||{[i]:{}};return a[i].participants={published:!0},nS({timeItem:{itemValue:a,itemType:n},element:t,removePriorValues:e}),Ia({payload:{tournamentId:t.tournamentId},topic:wp}),{...At}}function ZE(e){let t=Gp(e);if(!Object.keys(t).length)return{error:Lt};for(let i of Object.values(t)){let t=XE({tournamentRecord:i,...e});if(t.error)return t}return{...At}}function XE({scheduledDates:e=[],removePriorValues:t,tournamentRecord:i,status:n=Kf,eventIds:r=[]}){if(!i)return{error:Bt};let a=`${Yf}.${Jf}`,{timeItem:o}=am({element:i,itemType:a}),s=(null==o?void 0:o.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:e,eventIds:r},nS({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:t}),Ia({topic:Sp,payload:{tournamentId:i.tournamentId,scheduledDates:e,eventIds:r}}),{...At}}function eC({removePriorValues:e=!0,tournamentRecord:t,status:i=Kf,event:n}){if(!t)return{error:Bt};if(!n)return{error:bi};let r=`${Yf}.${Jf}`,{timeItem:a}=sm({itemType:r,event:n}),o=(null==a?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,oS({event:n,timeItem:{itemValue:o,itemType:r},removePriorValues:e}),bR({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:e,status:i,event:n}),Ia({topic:Pp,payload:{tournamentId:t.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...At}}be($E,{publishEvent:()=>RR,publishEventSeeding:()=>qE,publishOrderOfPlay:()=>ZE,publishParticipants:()=>JE,setEventDisplay:()=>eN,unPublishEvent:()=>eC,unPublishEventSeeding:()=>WE,unPublishOrderOfPlay:()=>YE,unPublishParticipants:()=>HE});var tC={};function iC({withCompetitiveProfiles:e,opponentParticipantId:t,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,u,d,c,p;if(!r)return{error:Bt};if(s&&!Array.isArray(s))return{error:Qi};if(null==(s=s??ev({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps)||!s.length)return{error:Ki};let m=[];t&&m.push(t),n&&m.push(n);let f=zv({participantFilters:m.length?{participantIds:m}:{participantTypes:[Hp]},tournamentRecord:r}).participants??[];if(!f.every((({participantType:e})=>e===Hp)))return{error:An};m.length||m.push(...f.map(hc));let h=new Map,v=new Map,g=new Map,I=new Map,U=(e,t="")=>v.get(e)||v.set(e,{participantName:t,participantId:e,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(e);for(let R of f){let{participantId:e,individualParticipantIds:t}=R;I.set(e,t??[]),U(e,R.participantName)}if(n&&!I.get(n))return La({result:{error:_n},context:{teamParticipantId:n}});if(t&&!I.get(t))return La({result:{error:_n},context:{opponentParticipantId:t}});let y=[],S=e=>{let r=[[],[]];for(let t of e){let e=t.participant;if(null!=e&&e.participantName){h.set(e.participantId,{participantName:e.participantName,ratings:e.ratings});let t=v.get(e.participantId);t&&(t.participantName=e.participantName)}}let a=({side:e,individualParticipantIds:t})=>{var i,n,r,a,o;return e.participantId&&(!(null!=t&&t.length)||t.includes(e.participantId))&&[e.participantId]||(null==(n=null==(i=e.participant)?void 0:i.individualParticipantIds)?void 0:n.length)&&(!(null!=t&&t.length)||dt(t,null==(r=e.participant)?void 0:r.individualParticipantIds).length===(null==(o=null==(a=e.participant)?void 0:a.individualParticipantIds)?void 0:o.length))&&e.participant.individualParticipantIds};if(I.size){let o=(t,n)=>{for(let o of e){if(!o.participant)continue;let e=a({individualParticipantIds:n,side:o});if(null!=e&&e.length){let n=o.sideNumber;if(!n)continue;let a=[t];i&&a.push(...e),r[n-1]=a;let s=v.get(t);for(let t of e.filter(Boolean))s&&!s.competitorIds.includes(t)&&s.competitorIds.push(t)}}};if(n)(!t||e.every((e=>e.participant&&(a({individualParticipantIds:I.get(n),side:e})||a({individualParticipantIds:I.get(t),side:e})))))&&o(n,I.get(n));else for(let[e,t]of I)o(e,t)}else if(i)for(let t of e){if(!t.participant)continue;let e=a({individualParticipantIds:[],side:t}),i=t.sideNumber;i&&(r[i-1]=e)}return r};for(let R of s){if(!wt(R))return{error:Qi};let{matchUpStatus:t,matchUpFormat:i,matchUpType:n,winningSide:r,score:a,sides:s}=R;if(!s||!a||n===ke||t===Sc)continue;let u=S(s);if(!u.filter(Boolean).length)continue;let d=e&&r&&(null==(l=Sf({matchUp:R}))?void 0:l.competitiveness);y.push(R);let c=vy({matchUpStatus:t,matchUpFormat:i,tallyPolicy:o,winningSide:r,score:a}),p=gy({matchUpStatus:t,matchUpFormat:i,tallyPolicy:o,winningSide:r,score:a}),{pointsTally:m,tiebreaksTally:f}=Iy({matchUpFormat:i,score:a});u.forEach(((e,i)=>{var n;for(let a of e){let e=null==(n=h.get(a))?void 0:n.participantName,o=U(a,e);if(o){let e=(e,t)=>t.forEach(((t,i)=>o[e][i]+=t)),n=i?[...f].reverse():f,a=i?[...m].reverse():m,s=i?[...p].reverse():p,l=i?[...c].reverse():c;if(e("tiebreaks",n),e("points",a),e("games",s),e("sets",l),r){let e=r-1===i?0:1;o.matchUps[e]+=1}if(d){let e=d.toLowerCase();o.competitiveness[e]||(o.competitiveness[e]=[0,0]),o.competitiveness[e][i]+=1}if(t){let e=t.toLowerCase();o.matchUpStatuses[e]||(o.matchUpStatuses[e]=0),o.matchUpStatuses[e]+=1}}}}))}let w=["tiebreaks","matchUps","points","games","sets"],P=["competitive","routine","decisive"],D=new Map,T=(e,t)=>(e??0)+(t??0);for(let[R,N]of v.entries()){for(let e of w){let t=N[e].reduce(T);if(t){let i=N[e][0]/t,n=`${e}Ratio`,r=parseFloat(i.toFixed(2));N[n]=r,g.set(R,!0),D.has(n)||D.set(n,[]),null==(u=D.get(n))||u.push(r)}}for(let e of P){let t=null==(c=null==(d=N.competitiveness)?void 0:d[e])?void 0:c.reduce(T);if(t){let i=N.competitiveness[e][0]/t,n=`${e}Ratio`,r=parseFloat(i.toFixed(2));N[n]=r}}}if(!n){let e=(e,t)=>t-e;for(let t of v.values())for(let i of w){let n=`${i}Ratio`;if("number"==typeof t[n]){let r=null==(p=D.get(n))?void 0:p.sort(e).indexOf(t[n]);if("number"==typeof r&&r>=0){t[`${i}Rank`]=r+1}}}}let b={relevantMatchUps:y,...At};return n?(b.teamStats=v.get(n),t&&(b.opponentStats=v.get(t))):b.participatingTeamsCount=g.size,b.allParticipantStats=[...v.values()],b}function nC({participant:e,eventType:t}){var i,n,r,a,o,s;let l=null==(i=null==e?void 0:e.person)?void 0:i.personId,u=null==(r=null==(n=null==e?void 0:e.person)?void 0:n.personOtherIds)?void 0:r[0],d=null==(a=null==e?void 0:e.person)?void 0:a.tennisId,c=null==(s=null==(o=null==e?void 0:e.ratings)?void 0:o[t])?void 0:s.find((({scaleName:e})=>e===dy)),p=null==c?void 0:c.scaleValue,{wtnRating:m,confidence:f}=p||{};return{timeStamp:null==c?void 0:c.scaleDate,personOtherId:u,confidence:f,wtnRating:m,personId:l,tennisId:d}}function rC({tournamentRecord:e}){if(!e)return{error:Bt};let t=e.tournamentId,{participantMap:i}=zv({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:e,withDraws:!0}),n=(ev({matchUpFilters:{matchUpTypes:[Ae,Ce]},tournamentRecord:e}).matchUps??[]).flatMap((({sides:e,matchUpType:t})=>null==e?void 0:e.flatMap((e=>{var i,n;return t===Ce?null==(i=null==e?void 0:e.participant)?void 0:i.individualParticipantIds:(null==(n=null==e?void 0:e.participant)?void 0:n.participantId)||e.participantId})).filter(Boolean))).filter(Boolean),r=[],a={},o={},s={},l=0,u=({id:e,entry:n,eventId:o,eventType:s})=>{var l;let{qualifyingSeeding:u,mainSeeding:d,entryStatus:c,entryStage:p,drawId:m}=n;a[e]||(a[e]=[]);let{participant:f,events:h}=(null==i?void 0:i[e])??{},v=nC({participant:f,eventType:s}),g=null==(l=null==h?void 0:h[o])?void 0:l.ranking;c===SU&&r.push(e),a[e].push({participantType:null==f?void 0:f.participantType,participantId:e,tournamentId:t,eventType:s,eventId:o,drawId:m,entryStatus:c,entryStage:p,...v,ranking:g,mainSeeding:d,qualifyingSeeding:u})};for(let m of e.events??[]){let e={},r=t=>{e[t]||(e[t]={count:0}),e[t].count+=1},{drawDefinitions:a=[],eventType:d,eventId:c}=m,p=a.flatMap((e=>{let{drawId:t,entries:n}=e;l+=1;let a=(e.structures??[]).filter((({stage:e,stageSequence:t})=>e===il&&1===t||e===nl)).flatMap((({positionAssignments:e})=>e)).filter(Boolean).map((({participantId:e})=>e));return null==n?void 0:n.filter((({participantId:e})=>a.includes(e))).map((e=>{var n,a,o,s,l,u,d,c;let{participantId:p,entryStatus:m,entryStage:f}=e;r(m);let h=null==(s=null==(o=null==(a=null==(n=null==i?void 0:i[p])?void 0:n.draws)?void 0:a[t])?void 0:o.seedAssignments)?void 0:s[il];return{qualifyingSeeding:null==(c=null==(d=null==(u=null==(l=null==i?void 0:i[p])?void 0:l.draws)?void 0:u[t])?void 0:d.seedAssignments)?void 0:c[nl],participantId:p,mainSeeding:h,entryStatus:m,entryStage:f,drawId:t}}))})),f=e=>{var t;let r=e.participantId,a=null==(t=null==i?void 0:i[r].participant.individualParticipantIds)?void 0:t.filter((e=>n.includes(e)));return r&&{[r]:{individualParticipantIds:a}}};d===Zs?(()=>{let e=Object.assign({},...p.map(f).filter(Boolean));p.forEach((t=>{e[t.participantId].individualParticipantIds.forEach((e=>{u({id:e,eventType:d,eventId:c,entry:t})}))}))})():p.forEach((e=>{u({id:null==e?void 0:e.participantId,eventType:d,eventId:c,entry:e})}));let h=Object.values(e).reduce(((e,t)=>e+t.count),0);Object.keys(e).forEach((t=>{e[t].pct=e[t].count/h*100})),s[c]={tournamentId:t,eventId:c,entries:p,entryStatuses:e};let v=Object.assign({},...zm.flatMap((t=>{var i,n;return[{[t+"_count"]:null==(i=e[t])?void 0:i.count},{[t+"_pct"]:null==(n=e[t])?void 0:n.pct}]})));o[c]={tournamentId:t,eventId:c,...v}}let d=Object.values(i??{}).filter((({participant:{participantType:e,participantRole:t}})=>e===zp&&t===sg)),c=d.filter((({participant:e})=>!n.includes(e.participantId))).map((({participant:e})=>e.participantId)),p={nonParticipatingEntriesCount:c.length,individualParticipantsCount:d.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:c,drawDefinitionsCount:l,tournamentId:t};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function aC({eventType:e,matchUps:t,eventId:i,drawId:n}){let r={},a=t.filter((e=>i?e.eventId===i:e.drawId===n)).reduce(((e,t)=>((e=>{let t=null==e?void 0:e.matchUpFormat;t&&(r[t]||(r[t]=0),r[t]+=1)})(t),(t.sides??[]).flatMap((e=>{var t;return((null==(t=null==e?void 0:e.participant)?void 0:t.individualParticipants)||[null==e?void 0:e.participant]).filter(Boolean)})).forEach((t=>e[t.participantId]=t)),e)),{}),o=Object.values(a),s=o.map((t=>nC({participant:t,eventType:e}))).filter((({wtnRating:e})=>e)),l=(o.length-s.length)/o.length*100,u=s.reduce(((e,t)=>{let{wtnRating:i,confidence:n}=t;return e.totalWTN+=i,e.totalConfidence+=n,e}),{totalWTN:0,totalConfidence:0}),d=null!=s&&s.length?u.totalWTN/s.length:0,c=null!=s&&s.length?u.totalConfidence/s.length:0,p=Object.values(r).reduce(((e,t)=>e+(t||0)),0);return{matchUpFormatCounts:r,matchUpsCount:p,avgConfidence:c,pctNoRating:l,avgWTN:d}}function oC(e){var t;let{tournamentRecord:i,extensionProfiles:n,firstFlightOnly:r}=e;if(!i)return{error:jt};let a=[],o={},s={},l=[],u=Object.assign({},...(n??[]).map((({name:e,label:t,accessor:n})=>{var r,a,o;let s=null==(a=null==(r=Cd({element:i,name:e}))?void 0:r.extension)?void 0:a.value;return{[t||e]:n?null==(o=rv({element:s,accessor:n}))?void 0:o.value:s}}))),d=null==i?void 0:i.tournamentId,c=ev({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],p=e=>{var t,i,n;return null==(n=null==(i=null==(t=am({itemType:ep,itemSubTypes:[Ju],element:{timeItems:e}}))?void 0:t.timeItem)?void 0:i.itemValue)?void 0:n.scaleBasis},m=null==(t=null==i?void 0:i.events)?void 0:t.flatMap((({timeItems:e,drawDefinitions:t=[],extensions:i,eventType:n,eventName:l,eventId:m,category:f})=>{var h,v,g,I;let U=null==(g=null==(v=null==(h=null==i?void 0:i.find((e=>e.name===Gd)))?void 0:h.value)?void 0:v.flights)?void 0:g.map((e=>({[e.drawId]:e.flightNumber}))),y=U&&Object.assign({},...U),S=null==i?void 0:i.find((e=>e.name===Vd)),w=null==e?void 0:e.find((e=>e.itemType===Vd)),P=(null==(I=null==S?void 0:S.value)?void 0:I.length)||(null==w?void 0:w.itemValue)||0,D=Object.values(y??{}),T=y&&Math.min(...D),b=p(e);return s[m]={seedingBasis:b?JSON.stringify(b):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:P,tournamentId:d,eventId:m},t.filter((e=>!r||!U||y[e.drawId]===T)).flatMap((e=>{let{matchUpFormat:t,tieFormat:i,timeItems:r,extensions:h,structures:v,drawName:g,drawType:I,drawId:U}=e,{matchUpFormatCounts:S,matchUpsCount:w,avgConfidence:P,pctNoRating:D,avgWTN:T}=aC({eventType:n,matchUps:c,drawId:U}),R=p(r)||b,N=function({extensions:e}){var t,i;return null==(i=null==(t=null==e?void 0:e.find((({name:e})=>e===Kd)))?void 0:t.value)?void 0:i.slice(1)}({extensions:h}),M=(null==N?void 0:N.length)||0;return(({positionManipulations:e})=>{null==e||e.forEach((e=>{let{structureId:t,name:i}=e,n=e.drawPositions||[e.drawPosition];o[t]||(o[t]=[]),o[t].push(`${i}: ${n.join("/")}`)}))})({positionManipulations:N}),s[m].totalPositionManipulations+=M,s[m].generatedDrawsCount+=1,M>s[m].maxPositionManipulations&&(s[m].maxPositionManipulations=M),null==v?void 0:v.filter((e=>1===e.stageSequence&&[nl,il,rl,ol].includes(e.stage))).map((e=>{var r,o,s;let p=[il,ol].includes(e.stage)?c.find((t=>t.structureId===e.structureId&&1===t.finishingRound&&t.winningSide)):void 0;e.stage===il&&a.push({eventName:l,drawName:g,structureId:e.structureId});let h=null==(o=null==(r=null==p?void 0:p.sides)?void 0:r.find((e=>e.sideNumber===p.winningSide)))?void 0:o.participant,v=(null==h?void 0:h.participantType)===Hp&&h.participantId,b=(null==h?void 0:h.participantType)===Kp?h.individualParticipants:[],M=nC({participant:(null==b?void 0:b[0])||h,eventType:n}),{personId:A,personOtherId:E,tennisId:C,confidence:O,wtnRating:k}=M||{},F=nC({participant:null==b?void 0:b[1],eventType:n}),{personId:x,personOtherId:_,tennisId:L,confidence:B,wtnRating:V}=F||{},{ageCategoryCode:j,categoryName:G,subType:$}=f??{},q=e.matchUpFormat||t,W=(S[q]||0)/w*100,{tieFormatName:H,tieFormatDesc:z}=OT(i),{tieFormatName:Y,tieFormatDesc:K}=OT(e.tieFormat),J=z===K,Q=!J&&Y,Z=e.tieFormat&&!J&&K,X=(null==(s=null==N?void 0:N.filter((t=>t.structureId===e.structureId)))?void 0:s.length)||0;return{...u,tournamentId:d,eventId:m,structureId:e.structureId,drawId:U,eventType:n,category:$,categoryName:G,ageCategoryCode:j,flightNumber:null==y?void 0:y[U],drawType:I,stage:e.stage,seedingBasis:R?JSON.stringify(R):void 0,winningPersonId:A,winningPersonOtherId:E,winningPersonTennisId:C,winningPersonWTNrating:k,winningPersonWTNconfidence:O,winningPerson2Id:x,winningPerson2OtherId:_,winningPerson2TennisId:L,winningPerson2WTNrating:V,winningPerson2WTNconfidence:B,winningTeamId:v,positionManipulations:X,pctNoRating:D,matchUpFormat:q,pctInitialMatchUpFormat:W,matchUpsCount:w,drawTieFormatName:H,drawTieFormatDesc:z,tieFormatName:Q,tieFormatDesc:Z,avgConfidence:P,avgWTN:T}}))}))}));return a.forEach((({eventName:e,drawName:t,structureId:i})=>{var n;null!=(n=o[i])&&n.length&&l.push({eventName:e,drawName:t,actions:o[i]})})),{eventStructureReports:Object.values(s),structureReports:m,flightReports:l}}function sC({ignoreDisabled:e=!0,tournamentRecords:t,tournamentId:i,venueIds:n=[],dates:r=[]}){var a,o;if(!Array.isArray(r))return{error:Cr,dates:r};if(!Array.isArray(n))return{error:Cr,venueIds:n};if(!(t&&Object.keys(t).filter((e=>!i||e===i))||[]).length)return{error:Lt};if(!r.every(Uo))return{error:vn};let s=$T({tournamentRecords:t,ignoreDisabled:e,dates:r});if(s.error)return s;let l=null==(a=null==s?void 0:s.venues)?void 0:a.filter((({venueId:e})=>!(null!=n&&n.length)||n.includes(e))),u=null==(o=s.courts)?void 0:o.reduce(((e,t)=>{var i;return null==(i=t.dateAvailability)||i.forEach((t=>{let i=t.date;e.includes(i)||e.push(i)})),e}),[]).filter((e=>!r.length||r.includes(e))),d={venueIds:null==l?void 0:l.map((({venueId:e})=>e))},{matchUps:c}=tv({afterRecoveryTimes:!0,tournamentRecords:t,matchUpFilters:d});return{venuesReport:null==l?void 0:l.map((e=>function(e,t,i){let{venueId:n,courts:r,venueName:a}=t,o={};return e.forEach((e=>{var t;let a=0,s=0,l=0;for(let i of r){let n=i.dateAvailability.find((t=>t.date===e)),r=null==(t=n&&DN({courtDate:n}).timeSlots)?void 0:t.reduce(((e,t)=>{let{startTime:i,endTime:n}=t;return e+(No(n)-No(i))}),0);r&&(l+=1),a+=r}let u=i.filter((({schedule:t})=>t.venueId===n&&Go(e,t.scheduledDate)));u.forEach((({schedule:e})=>{let t=Ao(e.scheduledTime),i=No(Bo(t,e.averageMinutes))-No(t);s+=i}));let d=a?(s/a*100).toFixed(2):"100";o[e]={scheduledMatchUpsCount:u.length,availableCourts:l,availableMinutes:a,scheduledMinutes:s,percentUtilization:d}})),{venueId:n,venueName:a,venueReport:o}}(u,e,c)))}}be(tC,{getEntryStatusReports:()=>rC,getParticipantStats:()=>iC,getStructureReports:()=>oC,getVenuesReport:()=>sC});var lC={};be(lC,{addMatchUpCourtOrder:()=>PM,addMatchUpEndTime:()=>bM,addMatchUpOfficial:()=>DM,addMatchUpResumeTime:()=>NM,addMatchUpScheduleItems:()=>wM,addMatchUpScheduledDate:()=>gM,addMatchUpScheduledTime:()=>hM,addMatchUpStartTime:()=>TM,addMatchUpStopTime:()=>RM,addSchedulingProfileRound:()=>JA,allocateTeamMatchUpCourts:()=>IM,assignMatchUpCourt:()=>yM,assignMatchUpVenue:()=>UM,bulkRescheduleMatchUps:()=>gC,bulkScheduleMatchUps:()=>mA,bulkScheduleTournamentMatchUps:()=>pA,bulkUpdateCourtAssignments:()=>mC,calculateScheduleTimes:()=>dC,clearMatchUpSchedule:()=>yC,clearScheduledMatchUps:()=>hA,courtGridRows:()=>mb,findMatchUpFormatTiming:()=>eb,findVenue:()=>Th,generateBookings:()=>aA,generateVirtualCourts:()=>bN,getMatchUpsToSchedule:()=>XT,getPersonRequests:()=>lb,getProfileRounds:()=>pb,getScheduledRoundsDetails:()=>tb,getSchedulingProfile:()=>rb,getSchedulingProfileIssues:()=>sb,matchUpScheduleChange:()=>UC,modifyMatchUpFormatTiming:()=>kR,mutate:()=>uC,proAutoSchedule:()=>pC,proConflicts:()=>hC,publicFindCourt:()=>Nh,query:()=>QT,removeEventMatchUpFormatTiming:()=>LR,removeMatchUpCourtAssignment:()=>cC,reorderUpcomingMatchUps:()=>vC,scheduleMatchUps:()=>fC,scheduleProfileRounds:()=>gA,setMatchUpDailyLimits:()=>SC,setMatchUpHomeParticipantId:()=>mM,setSchedulingProfile:()=>ab,toggleParticipantCheckInState:()=>VN,validateSchedulingProfile:()=>nb});var uC={};function dC({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:d}){if("object"!=typeof a||!Object.keys(a).length)return{error:Lt};o=o??RN({recoveryMinutes:t,averageMatchUpMinutes:i});let{courts:c,venues:p}=$T({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=null==c?void 0:c.filter((e=>!u||u.includes(e.venueId)));l||(l=null==m?void 0:m.reduce(((e,t)=>{var i,n;let r=(null==(n=null==(i=t.dateAvailability)?void 0:i.find((e=>!e.date||Go(s,e.date))))?void 0:n.startTime)??t.startTime;return r&&(!e||No(r)<No(e))?r:e}),void 0)),d||(d=null==m?void 0:m.reduce(((e,t)=>{var i,n;let r=(null==(n=null==(i=t.dateAvailability)?void 0:i.find((e=>!e.date||Go(s,e.date))))?void 0:n.endTime)??t.endTime;return r&&(!e||No(r)>No(e))?r:e}),void 0));let f=Object.values(a),h=Object.assign({},...f.map((e=>(e.events??[]).map((t=>{let{scheduleTiming:i}=Nm({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:i}}})))).flat()),v=kb({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),g=(null==v?void 0:v.dateMatchUps)??[],I=(null==v?void 0:v.completedMatchUps)??[],U=[];U.push(...g),U.push(...I);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:t}}]},S=null==U?void 0:U.map((({eventId:e,schedule:t,matchUpFormat:i})=>{let{event:n,scheduleTiming:r}=h[e],a=null==n?void 0:n.eventType,s={...r,defaultTiming:y,matchUpFormat:i},{averageMinutes:l,recoveryMinutes:u}=vh({eventType:a,timingDetails:s}),{courtId:d,venueId:c}=t,p=Ao(t.scheduledTime),m=Bo(p,l);return{recoveryMinutes:u,averageMinutes:l,periodLength:o,startTime:p,endTime:m,courtId:d,venueId:c}})),w={calculateStartTimeFromCourts:e,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:o,startTime:l,endTime:d,bookings:S,courts:m},{scheduleTimes:P}=AN(w);return{venueId:1===(null==u?void 0:u.length)&&u[0]||1===(null==p?void 0:p.length)&&p[0].venueId||void 0,scheduleTimes:P,dateScheduledMatchUpIds:U.map(vc)}}function cC(e){var t;let i=qu(e,[{[nu]:!0}]);if(i.error)return i;let{removePriorValues:n,tournamentRecords:r,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:u}=e,d=r[a];if(!d)return{error:Bt};let{drawDefinition:c,event:p}=MS({tournamentRecord:d,drawId:u});if(!c)return{error:$t};let m=Vy({drawDefinition:c,event:p,matchUpId:s});if(m.error)return m;if((null==(t=null==m?void 0:m.matchUp)?void 0:t.matchUpType)===ke){let{itemValue:e}=Ih({timeItems:m.matchUp.timeItems??[],itemType:bf}),t=l&&e.filter((e=>e.courtId!==l));return _N({duplicateValues:!1,removePriorValues:n,tournamentRecord:d,drawDefinition:c,matchUpId:s,timeItem:{itemType:bf,itemValue:t}})}return yM({tournamentRecord:d,drawDefinition:c,courtDayDate:o,courtId:"",matchUpId:s})}function pC({scheduleCompletedMatchUps:e,tournamentRecords:t,scheduledDate:i,matchUps:n}){if(!lf(n))return{error:Cr};if(n.some((({hasContext:e})=>!e)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:yr};let r=kb({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:t,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,o=[],s=e=>[(e.sides||[]).map((e=>{var t;return[e.participantId,null==(t=e.participant)?void 0:t.individualParticipantIds]})),(e.potentialParticipants||[]).flat().map((e=>[e.participantId,e.individualParticipantIds]))].flat(1/0).filter(Boolean),l=null==a?void 0:a.reduce(((e,t)=>{let i=[],n=[];Object.values(t).forEach((e=>{if(wt(e)&&(e.matchUpId&&(i.push(e.matchUpId),o.push(e)),e.sides)){let t=s(e);n.push(...t)}}));let r=Object.values(t).filter((e=>wt(e)&&!e.matchUpId));return e.concat({matchUpIds:i,availableCourts:r,rowId:t.rowId,participantIds:n})}),[]);n.filter((({matchUpStatus:t})=>t&&t!==Sc&&(e||!Vc.includes(t)))).sort(iv);let u=uv({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:t}).matchUpDependencies,d=[],c=[];for(;n.length&&l.length;){let e=l.shift(),t=[];for(;n.length&&e.availableCourts.length;){let i=n.concat(t).map((e=>e.matchUpId)),r=n.shift(),a=null==r?void 0:r.matchUpId,o=a&&u[a].matchUpIds.concat(u[a].dependentMatchUpIds),l=a&&i.some((e=>u[a].matchUpIds.includes(e))),p=a&&c.some((e=>u[a].dependentMatchUpIds.includes(e))),m=e.matchUpIds.some((e=>o.includes(e))),f=s(r),h=e.participantIds.some((e=>f.includes(e)));if(!r||m||l||h||p)r&&t.push(r);else{let t=e.availableCourts.shift();Object.assign(r.schedule,t.schedule),Object.assign(t,r),d.push(r),e.participantIds.push(...f),e.matchUpIds.push(a)}}n.push(...t),c.push(...e.matchUpIds)}return r=mA({tournamentRecords:t,matchUpDetails:d.map((({matchUpId:e,tournamentId:t,schedule:n,drawId:r})=>({tournamentId:t,matchUpId:e,drawId:r,schedule:{...n,scheduledDate:i}})))}),{...r,scheduled:d,notScheduled:n}}function mC(e){let{courtDayDate:t}=e,i=qu(e,[{courtAssignments:!0,[Lu]:ku,[_u]:un},{[nu]:!0}]);if(i.error)return i;let n,r=e.courtAssignments.reduce(((e,t)=>{let{tournamentId:i}=t;return e[i]||(e[i]=[]),e[i].push(t),e}),{});return Object.keys(r).every((i=>{let a=e[nu][i];if(!a)return n={error:Bt},!1;let o=r[i].reduce(((e,t)=>{let{drawId:i}=t;return e[i]||(e[i]=[]),e[i].push(t),e}),{});Object.keys(o).every((e=>{let{drawDefinition:i}=Ch({tournamentRecord:a,drawId:e});return i?(o[e].every((e=>{let{matchUpId:r,courtId:o}=e,s=yM({tournamentRecord:a,drawDefinition:i,courtDayDate:t,matchUpId:r,courtId:o});if(s.success)return null==s?void 0:s.success;n={error:Tr}})),!0):(n={error:$t},!1)}))})),n||At}function fC(e){let{tournamentRecords:t,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:d=!0,remainingScheduleTimes:c,clearScheduleDates:p,periodLength:m=30,scheduleDate:f,matchUpIds:h,venueIds:v,startTime:g,endTime:I,dryRun:U}=e,y=qu(e,[{[nu]:!0,[fu]:!0},{[Fu]:Uo,[_u]:vn,scheduleDate:!0},{[Fu]:e=>!e||!isNaN(e),averageMatchUpMinutes:!1,[_u]:Cr,recoveryMinutes:!1,periodLength:!1}]);if(y.error)return y;let S=e.competitionMatchUps??tv({nextMatchUps:!0,tournamentRecords:t}).matchUps??[],w=e.matchUpDependencies??uv({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:t}).matchUpDependencies;S.forEach((e=>{var t;null!=(t=e.schedule)&&t.scheduledDate&&Go(f,Eo(e.schedule.scheduledDate))&&ZT({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:e})}));let P=h.map((e=>S.find((t=>t.matchUpId===e)))).filter(Boolean),{venueId:D,scheduleTimes:T,dateScheduledMatchUpIds:b}=dC({tournamentRecords:t,remainingScheduleTimes:c,startTime:Ao(g),endTime:Ao(I),scheduleDate:Eo(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:m,venueIds:v}),R={},N=[],M={},A={},E={};S.filter((({matchUpId:e})=>null==b?void 0:b.includes(e))).forEach((e=>{var t;nA({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:e,value:1});let i=null==(t=e.schedule)?void 0:t.scheduledTime;if(i){M[e.matchUpId]=i,ZM({recoveryMinutes:(null==a?void 0:a[e.matchUpId])||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:i,matchUp:e})}}));let C=P.filter((e=>{let t=null==b?void 0:b.includes(e.matchUpId),i=[Sc,Tc,Pc,Uc,Ec,kc].includes(null==e?void 0:e.matchUpStatus);return!t&&!e.winningSide&&!i})),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:F}=C.reduce(((e,t)=>{let{drawId:i,tournamentId:n,matchUpType:r}=t,{participantIdsAtLimit:a,relevantParticipantIds:d}=cA({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:t});return null!=a&&a.length?(e.overLimitMatchUpIds.push(t.matchUpId),e.participantIdsAtLimit.push(...a),e):(d.forEach((e=>{QM({individualParticipantProfiles:s,participantId:e});let t=s[e].counters;t[r]?t[r]+=1:t[r]=1,t[ah]?t[ah]+=1:t[ah]=1})),e.matchUpMap[n]||(e.matchUpMap[n]={}),e.matchUpMap[n][i]?e.matchUpMap[n][i].push(t):e.matchUpMap[n][i]=[t],ZT({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:t}),e)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter((({matchUpId:e})=>!k.includes(e)));let x=0,_=(null==T?void 0:T.length)??0,{personRequests:L}=lb({tournamentRecords:t,requestType:eA});for(;null!=T&&T.length&&C.length&&x<=_;){x++;let{scheduleTime:e}=T.shift(),t=C.find((t=>{let{matchUpId:u}=t,{dependenciesScheduled:c,remainingDependencies:p}=JM({matchUpScheduleTimes:M,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:t});if(!c)return E[u]||(E[u]=[]),E[u].push({scheduleTime:e,remainingDependencies:p}),!1;let{enoughTime:m}=uA({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:e,matchUp:t});if(!m)return A[u]||(A[u]=[]),A[u].push({scheduleTime:e}),!1;let{conflicts:h}=iA({potentials:d,averageMatchUpMinutes:n,requestConflicts:R,personRequests:L,scheduleTime:e,scheduleDate:f,matchUp:t});return(null==h||!h.length)&&(ZM({recoveryMinutes:(null==a?void 0:a[t.matchUpId])||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:e,matchUp:t}),M[t.matchUpId]=e,!0)}));C=C.filter((({matchUpId:e})=>e!==(null==t?void 0:t.matchUpId))),t||N.push(e)}C.forEach((e=>{nA({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:e})}));let B=[];Object.keys(O).forEach((e=>{let i=t[e];i&&Object.keys(O[e]).forEach((n=>{let{drawDefinition:r}=MS({tournamentRecord:i,drawId:n});r&&O[e][n].forEach((({matchUpId:e})=>{let n=M[e];if(n){let a=n.split(":").map(jo).join(":"),o=`${Eo(f)}T${a}`;U?B.push(e):(hM({drawDefinition:r,matchUpId:e,scheduledTime:o}).success&&B.push(e),D&&UM({tournamentRecords:t,tournamentRecord:i,drawDefinition:r,matchUpId:e,venueId:D}))}}))}))}));let V=mc(C);return{...At,requestConflicts:Object.values(R),remainingScheduleTimes:null==T?void 0:T.map((({scheduleTime:e})=>e)),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:N,overLimitMatchUpIds:k,scheduledMatchUpIds:B,noTimeMatchUpIds:V,recoveryTimeDeferred:A,dependencyDeferred:E}}function hC({tournamentRecords:e,matchUps:t}){if(!lf(t))return{error:Ki};if(t.some((({matchUpId:e,hasContext:t})=>e&&!t)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:yr};let i=lt(1,Math.max(...t.map((({schedule:e})=>(null==e?void 0:e.courtOrder)||1)).map((e=>Be(e))))+1).map((e=>t.filter((t=>{var i;return Be(null==(i=t.schedule)?void 0:i.courtOrder)===e})))),n={},r={},a={};i.flat().filter(Boolean).sort(iv).forEach((({schedule:e})=>delete e[mh]));let o=uv({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:Qe(t.map((({drawId:e})=>e)))}).matchUpDependencies,s=i.map(((e,t)=>e.reduce(((e,i)=>{if(!i.matchUpId)return e;let{matchUpId:s,winnerMatchUpId:l,loserMatchUpId:u,schedule:d,sides:c,potentialParticipants:p}=i,m=null==d?void 0:d.courtId;n[s]=t,r[m]=[],e.matchUpIds.push(s),a[s]=i;let f=o[s].matchUpIds;f.length&&e.sourceMatchUpIds.push(...f);let h=(null==c?void 0:c.map((e=>{var t;return[null==(t=e.participant)?void 0:t.individualParticipantIds,e.participantId]})).flat().filter(Boolean))??[],v=(null==p?void 0:p.flat().map((({individualParticipantIds:e,participantId:t})=>[e,t])).flat().filter(Boolean))||[];return e.participantIds.push(...v,...h),l&&e.targetMatchUpIds.push(l),u&&e.targetMatchUpIds.push(u),e}),{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]}))),l=s.map((()=>[])),u=(e,t,i,o)=>{if(!a[e].schedule[mh]){a[e].schedule[mh]=t,a[e].schedule[lh]=o,l[n[e]].push({matchUpId:e,issueType:i,issueIds:o,issue:t});let s=a[e].schedule.courtId;r[s]||(r[s]=[]),r[s].push({matchUpId:e,issue:t,issueType:i,issueIds:o})}};return s.forEach(((e,t)=>{let i=t?s[t-1]:void 0,n=s.slice(t+1),r={},l=tt(e.participantIds),d=Object.keys(l).filter((e=>l[e]>1)),c=e.matchUpIds.filter((e=>o[e].participantIds.some((e=>d.includes(e)))));c.forEach((e=>{r[e]||(r[e]={}),r[e][uh]||(r[e][uh]=c.filter((t=>t!==e)))}));let p=i&&e.participantIds.filter((e=>i.participantIds.includes(e)));p&&p.forEach((t=>{let n=e.matchUpIds.concat(i.matchUpIds).filter((e=>o[e].participantIds.includes(t)));n.forEach((e=>{r[e]||(r[e]={}),r[e][dh]||(r[e][dh]=n.filter((t=>t!==e)))}))})),e.matchUpIds.forEach((t=>{var s,l,d,c;let p=o[t].matchUpIds;for(let e of n){let i=e.matchUpIds.filter((e=>p.includes(e)));null!=i&&i.length&&(i.forEach((e=>u(e,ch,sh,[t]))),u(t,ch,sh,i))}if(null!=(s=r[t])&&s[uh]&&u(t,uh,oh,r[t][uh]),e.sourceMatchUpIds.includes(t)){let i=e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t)));u(t,uh,sh,i),e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t))).forEach((e=>u(e,uh,sh,[t])))}let m=null==(l=null==i?void 0:i.matchUpIds)?void 0:l.filter((e=>((e,t)=>o[e].sources.reduce(((e,i,n)=>i.includes(t)&&n+1||e),0))(t,e)>1));if(null!=m&&m.length&&(u(t,ph,sh,m),m.forEach((e=>u(e,ph,sh,[t])))),null!=(d=r[t])&&d[dh]&&u(t,dh,oh,r[t][dh]),null==(c=null==i?void 0:i.targetMatchUpIds)?void 0:c.includes(t)){let e=a[t].schedule.courtId,n=p.filter((e=>i.matchUpIds.includes(e)));n.some((t=>a[t].schedule.courtId===e))||(n.forEach((e=>u(e,dh,sh,[t]))),u(t,dh,sh,n))}}))})),{courtIssues:r,rowIssues:l}}function vC(e){let t="reorderUpcomingMatchUps",{tournamentRecords:i}=e;if("object"!=typeof i||!Object.keys(i).length)return La({result:{error:Lt},stack:t});let{matchUpsContextIds:n,firstToLast:r}=e;if(!n)return La({result:{error:un},stack:t});let a=null==n?void 0:n.length;if(!a)return{...At};let o=0;return n.forEach(((e,t)=>{let{tournamentId:s,drawId:l,matchUpId:u}=e,d=t+(r?-1:1);d<0&&(d=a-1),d===a&&(d=0);let c=function({tournamentId:e,scheduledTime:t,matchUpId:n,drawId:r}){let a=i[e],{drawDefinition:o}=MS({tournamentRecord:a,drawId:r});return o?hM({drawDefinition:o,scheduledTime:t,matchUpId:n}):{error:Wt}}({tournamentId:s,scheduledTime:n[d].schedule.scheduledTime,matchUpId:u,drawId:l});if(!c.success)return c;o++})),o===a?At:La({result:{error:Pr},stack:t})}function gC(e){var t,i;let{scheduleChange:n,matchUpIds:r,dryRun:a}=e;if(!r||!Array.isArray(r))return{error:zi};if("object"!=typeof n)return{error:Cr};let o=Gp(e),s=[],l=[];for(let d of Object.values(o)){let e=IC({tournamentRecord:d,scheduleChange:n,matchUpIds:r,dryRun:a});if(e.error)return e;Array.isArray(e.notRescheduled)&&l.push(...e.notRescheduled);let o=mc(e.notRescheduled),u=[];null==(t=e.rescheduled)||t.forEach((e=>{let{matchUpId:t}=e;o.includes(t)&&u.push(t),s.push(e)})),u.length&&(l=(null==(i=null==e?void 0:e.notRescheduled)?void 0:i.filter((({matchUpId:e})=>!u.includes(e))))||[])}let u=!(!s.length||l.length);return{...At,rescheduled:s,notRescheduled:l,allRescheduled:u}}function IC({tournamentRecord:e,scheduleChange:t,matchUpIds:i,dryRun:n}){var r;if(!e)return{error:Bt};if(!i||!Array.isArray(i))return{error:zi};if("object"!=typeof t)return{error:Cr};let a=[],o=[],{minutesChange:s,daysChange:l}=t;if(!s&&!l)return{...At};if(s&&isNaN(s))return{error:Cr};if(l&&isNaN(l))return{error:Cr};let{matchUps:u}=ev({matchUpFilters:{matchUpIds:i},tournamentRecord:e}),d=null==u?void 0:u.filter((e=>Nb({schedule:e.schedule}))).filter((e=>(({matchUpStatus:e})=>!Vc.includes(e))({matchUpStatus:e.matchUpStatus})));if(null==d||!d.length)return{...At};let{tournamentInfo:c}=wT({tournamentRecord:e}),{startDate:p,endDate:m}=c,f=null==d?void 0:d.reduce(((e,t)=>{let{matchUpId:i,drawId:n}=t;return e[n]?e[n].push(i):e[n]=[i],e}),{});for(let U of Object.keys(f)){let t=MS({tournamentRecord:e,drawId:U});if(t.error)return t;let u=t.drawDefinition,c=f[U].filter((e=>i.includes(e)));for(let e of c)if(e&&u){let t,i,c,f=null==(r=d.find((t=>t.matchUpId===e)))?void 0:r.schedule,{scheduledTime:h,scheduledDate:v}=f;if(!t&&l&&v){c=Co(Eo(v),l),t=new Date(c)<new Date(p)||new Date(c)>new Date(m)}if(s&&h){let e=Eo(h),n=No(Ao(h))+s;if(t=n<0||n>1440,!t){let t=Bo(h,s),n=e&&c||v===e&&e;i=n?`${n}T${t}`:t}}if(t)o.push(e);else{if(!n){if(i){let t=hM({scheduledTime:i,drawDefinition:u,matchUpId:e});if(t.error)return t}if(c){let t=gM({scheduledDate:c,drawDefinition:u,matchUpId:e});if(t.error)return t}}(i||c)&&a.push(e)}}}let h=ev({matchUpFilters:{matchUpIds:i},tournamentRecord:e}).matchUps??[],v=h.filter((({matchUpId:e})=>a.includes(e))),g=h.filter((({matchUpId:e})=>o.includes(e))),I=v.length&&!g.length;return{...At,rescheduled:v,notRescheduled:g,allRescheduled:I}}function UC(e){let t="matchUpScheduleChange",{tournamentRecords:i}=e;if("object"!=typeof i||!Object.keys(i).length)return{error:Lt};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=e||{},{drawId:l,matchUpId:u,tournamentId:d}=n||{},{drawId:c,matchUpId:p,tournamentId:m}=r||{};if(!u&&!p)return La({result:{error:un},stack:t});let{matchUps:f}=tv({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,c].filter(Boolean)},tournamentRecords:e.tournamentRecords}),h=null==f?void 0:f.find((({matchUpId:e})=>e===u)),v=null==f?void 0:f.find((({matchUpId:e})=>e===p)),g=0;if(o&&u&&!p){let e=I({tournamentId:d,matchUpId:u,courtId:o,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(null!=e&&e.success&&g++,e.error)return La({result:e,stack:t})}else{if(!(a&&o&&u&&p))return{error:un};{let e=I({tournamentId:d,matchUpId:u,courtId:o,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(e.success&&g++,e.error)return La({result:e,stack:t,info:"source"});let n=I({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:v,courtId:a,drawId:c,tournamentRecords:i,courtDayDate:s});if(n.success&&g++,n.error)return La({result:n,stack:t,info:"target"})}}return g?At:La({result:{error:Dr},stack:t});function I(e){let{tournamentRecords:t,tournamentId:i,matchUp:n,drawId:r}=e,a=t[i],{drawDefinition:o}=MS({tournamentRecord:a,drawId:r});return n.matchUpType===Fe?function({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,sourceCourtId:r,courtDayDate:a,matchUpId:o,matchUp:s,courtId:l}){let u=[l].concat(s.schedule.allocatedCourts.map((({courtId:e})=>e)).filter((e=>e!==r)));return IM({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,courtDayDate:a,matchUpId:o,courtIds:u})}({...e,tournamentRecord:a,drawDefinition:o}):yM({...e,tournamentRecord:a,drawDefinition:o})}}function yC({scheduleAttributes:e=[bf,Rf,Tf,Mf,Cf,Of,xf,Ff,kf],tournamentRecord:t,drawDefinition:i,matchUpId:n}){var r,a;let o=i?null==(r=nv({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)?void 0:r[0]:null==(a=ev({matchUpFilters:{matchUpIds:[n]},tournamentRecord:t,inContext:!1}).matchUps)?void 0:a[0];if(!o)return{error:Yi};let s=(o.timeItems??[]).filter((t=>(null==t?void 0:t.itemType)&&!e.includes(null==t?void 0:t.itemType)));return o.timeItems=s,Cp({tournamentId:t.tournamentId,context:"clearMatchUpSchedule",drawDefinition:i,matchUp:o}),{...At}}function SC(e){let{tournamentRecord:t,tournamentId:i,dailyLimits:n}=e,r=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if("object"!=typeof r||!Object.keys(r).length)return{error:Lt};if("object"!=typeof n)return{error:Mr};let a=Object.keys(r).filter((e=>!i||i===e));if(i&&!a.includes(i))return{error:Cr};for(let o of a){let e=r[o],t=Sd({extension:{name:Qd,value:{dailyLimits:n}},element:e});if(t.error)return t}return{...At}}be(uC,{addMatchUpCourtOrder:()=>PM,addMatchUpEndTime:()=>bM,addMatchUpOfficial:()=>DM,addMatchUpResumeTime:()=>NM,addMatchUpScheduleItems:()=>wM,addMatchUpScheduledDate:()=>gM,addMatchUpScheduledTime:()=>hM,addMatchUpStartTime:()=>TM,addMatchUpStopTime:()=>RM,addSchedulingProfileRound:()=>JA,allocateTeamMatchUpCourts:()=>IM,assignMatchUpCourt:()=>yM,assignMatchUpVenue:()=>UM,bulkRescheduleMatchUps:()=>gC,bulkScheduleMatchUps:()=>mA,bulkScheduleTournamentMatchUps:()=>pA,bulkUpdateCourtAssignments:()=>mC,calculateScheduleTimes:()=>dC,clearMatchUpSchedule:()=>yC,clearScheduledMatchUps:()=>hA,findMatchUpFormatTiming:()=>eb,generateBookings:()=>aA,generateVirtualCourts:()=>bN,matchUpScheduleChange:()=>UC,modifyMatchUpFormatTiming:()=>kR,proAutoSchedule:()=>pC,proConflicts:()=>hC,removeEventMatchUpFormatTiming:()=>LR,removeMatchUpCourtAssignment:()=>cC,reorderUpcomingMatchUps:()=>vC,scheduleMatchUps:()=>fC,scheduleProfileRounds:()=>gA,setMatchUpDailyLimits:()=>SC,setMatchUpHomeParticipantId:()=>mM,setSchedulingProfile:()=>ab,toggleParticipantCheckInState:()=>VN,validateSchedulingProfile:()=>nb});var wC={};be(wC,{addCollectionDefinition:()=>BC,addCollectionGroup:()=>LC,aggregateTieFormats:()=>$C,compareTieFormats:()=>kT,getTieFormat:()=>LT,modifyCollectionDefinition:()=>MC,modifyTieFormat:()=>GC,mutate:()=>PC,orderCollectionDefinitions:()=>OC,query:()=>CT,removeCollectionDefinition:()=>_C,removeCollectionGroup:()=>EC,tieFormatGenderValidityCheck:()=>za,validateCollectionDefinition:()=>Ko});var PC={};function DC({drawDefinition:e,structureId:t,matchUpId:i,structure:n,matchUp:r,eventId:a,event:o}){var s;let l,u="getTieFormat";if(t=(null==n?void 0:n.structureId)??t,((i=(null==r?void 0:r.matchUpId)??i)||t)&&!e)return{error:$t};if(a&&o)l=ef(o);else if(i){if(e&&(!r||!n)){let t=Vy({drawDefinition:e,matchUpId:i});if(t.error)return t;if((null==(s=t.matchUp)?void 0:s.matchUpType)!==ke)return La({result:{error:Qi},stack:u});n||(n=t.structure),r||(r=t.matchUp)}l=tf({item:r,drawDefinition:e,structure:n,event:o})||tf({item:n,drawDefinition:e,structure:n,event:o})||ef(e)||ef(o)}else if(e&&t){if(!n){let i=Hc({drawDefinition:e,structureId:t});if(i.error)return i;n=null==i?void 0:i.structure}l=tf({item:n,drawDefinition:e,structure:n,event:o})||ef(e)||ef(o)}else l=ef(e)||ef(o);return l?{...At,structure:n,tieFormat:l,matchUp:r}:La({result:{error:Wi},stack:u})}function TC({matchUp:e,updateInProgressMatchUps:t}){return!e.winningSide&&![Vc].includes(e.matchUpStatus)&&(t||e.matchUpStatus!==Nc&&!dv(e))}function bC({from:e,to:t}){let i=Object.keys(e),n=dt(i,Object.keys(t)).length===i.length,r=i.filter((i=>e[i]!==t[i])).map((i=>({countChange:t[i]-e[i],collectionId:i}))),a=i.every((i=>e[i]===t[i]));return{equivalent:n&&a,matchUpsCountChanges:r}}function RC({check:e,matchUp:t}){let i="",n=[];return{changesArePossible:e.matchUpsCountChanges.every((({collectionId:e,countChange:r})=>{let a=t.tieMatchUps.filter((t=>t.collectionId===e&&t.matchUpStatus===Oc)).map(ov("matchUpId")),o=a.length+r>=0||r>0;return!o&&r<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:a,collectionId:e,countChange:r}),o})),changes:n,cannotChangeReaon:i}}function NC({appliedPolicies:e,drawDefinition:t,auditData:i}){var n;if(null==(n=null==e?void 0:e.audit)||!n[ic])return;let{extension:r}=Cd({name:ic,element:t});Sd({element:t,extension:{value:Array.isArray(null==r?void 0:r.value)?null==r?void 0:r.value.concat(i):[i],name:ic}})}function MC({updateInProgressMatchUps:e=!1,tournamentRecord:t,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:d,matchUpId:c,category:p,eventId:m,gender:f,event:h,collectionValueProfiles:v,collectionValue:g,matchUpValue:I,scoreValue:U,setValue:y}){let S="modifyCollectionDefinition";if(o&&!co({matchUpFormat:o}))return La({result:{error:Cr},context:{matchUpFormat:o},stack:S});if(n&&"string"!=typeof n)return La({result:{error:Cr},context:{collectionName:n},stack:S});if(f&&!Object.values(qa).includes(f))return La({result:{error:Cr},context:{gender:f},stack:S});if(p&&"object"!=typeof p)return La({result:{error:Cr},context:{category:p},stack:S});let w={collectionValueProfiles:v,collectionValue:g,matchUpValue:I,scoreValue:U,setValue:y};if(!(Object.values(w).filter(Boolean).length||i||n||o||s||u))return La({result:{error:un},stack:S});if(Object.values(w).filter(Boolean).length>1)return La({info:"Only one value assignment allowed per collectionDefinition",result:{error:Cr},stack:S});let P=DC({drawDefinition:a,structureId:d,matchUpId:c,eventId:m,event:h});if(P.error)return La({result:P,stack:S});let{matchUp:D,structure:T,tieFormat:b}=P,R=Jy(b),N=null==b?void 0:b.collectionDefinitions.find((e=>e.collectionId===l)),M=null==R?void 0:R.collectionDefinitions.find((e=>e.collectionId===l));if(!N)return La({info:"source collectionDefinition",result:{error:Lr},context:{collectionId:l},stack:S});let A=g??I??U??y;if(null!=v&&v.length){let e=Ot({matchUpCount:s??(null==N?void 0:N.matchUpCount)??0,collectionValueProfiles:v});if(e.errors)return La({result:{error:Cr},info:e.errors,stack:S})}else if(A&&!Ye(A))return La({result:{error:Cr},info:"value is not an integer",context:{value:A},stack:S});let E=v&&(!N.collectionValueProfiles||(O=N.collectionValueProfiles,k=v,!(dt(Object.keys(O),Object.keys(k)).length===Object.keys(O).length&&dt(Object.values(O),Object.values(k)).length===Object.values(O).length))),C=[];var O,k;if((Ye(g)&&N.collectionValue!==g||Ye(I)&&N.matchUpValue!==I||Ye(U)&&N.scoreValue!==U||Ye(y)&&N.setValue!==y||E)&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,w),C.push({collectionId:l,..._a(w)})),(Ye(U)||Ye(y))&&M.collectionGroupNumber){let e=M.collectionGroupNumber;R.collectionDefinitions=R.collectionDefinitions.map((t=>{let{collectionGroupNumber:i,...n}=t;return i===e?n:t})),R.collectionGroups=R.collectionGroups.filter((({groupNumber:t})=>t!==e)),C.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:x}=Bb(R),_=_a({aggregateValue:F,valueGoal:x});if((_.aggregateValue!==(null==b?void 0:b.winCriteria.aggregateValue)||_.valueGoal!==(null==b?void 0:b.winCriteria.valueGoal))&&(R.winCriteria=_,C.push({collectionId:l,winCriteria:_})),Ye(i)&&N.collectionOrder!==i&&(M.collectionOrder=i,C.push({collectionId:l,collectionOrder:i})),n&&N.collectionName!==n&&(M.collectionName=n,C.push({collectionId:l,collectionName:n})),o&&N.matchUpFormat!==o&&(M.matchUpFormat=o,C.push({collectionId:l,matchUpFormat:o})),Ye(s)&&N.matchUpCount!==s&&(M.matchUpCount=s,C.push({collectionId:l,matchUpCount:s})),u&&N.matchUpType!==u)return La({result:{error:Br},context:{matchUpType:u},stack:S});p&&N.category!==p&&(M.category=p,C.push({collectionId:l,category:p})),f&&N.gender!==f&&(M.gender=f,C.push({collectionId:l,gender:f}));let L=_a(R);if(P=Jo({tieFormat:L}),P.error)return La({result:P,stack:S});if(!C.length)return La({result:{...At,modifications:C}});if((null==b?void 0:b.tieFormatName)!==r?(L.tieFormatName=r,C.push({tieFormatName:r})):C.length&&(delete L.tieFormatName,C.push("tieFormatName removed: modifications without new tieFormatName")),P=function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:o,event:s,uuids:l}){var u,d,c,p;let m="updateTieFormat",f=null==t?void 0:t.tournamentId,h=0,v=0,g=0,I=0,U=null==r?void 0:r.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{}),y=({tieFormat:e})=>bC({from:null==e?void 0:e.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{}),to:U}).equivalent,S=null==(u=DC({drawDefinition:i}))?void 0:u.tieFormat,w=null==(d=DC({event:s}))?void 0:d.tieFormat;if(s&&a){for(let e of s.drawDefinitions??[])P({drawDefinition:e});s.tieFormat=Jy(r),I+=1}else if(o){if(!o.tieMatchUps)return La({result:{error:Qi},stack:m});let t=tt(null==(c=o.tieMatchUps)?void 0:c.map((({collectionId:e})=>e))),n=bC({to:U,from:t}),{changes:a,changesArePossible:u,cannotChangeReaon:d}=RC({matchUp:o,check:n});if(n.equivalent){if(!TC({matchUp:o,updateInProgressMatchUps:e}))return La({result:{error:Pn},info:"matchUp is IN_PROGRESS or COMPLETE",stack:m});o.tieFormat=Jy(r),I+=1}else{if(!u)return La({context:{collectionMap:U,matchUpMap:t},result:{error:ji},info:d||"specified changes not possible",stack:m});T({tieFormat:r,matchUp:o,changes:a,uuids:l})}v+=1,Cp({eventId:null==s?void 0:s.eventId,context:m,drawDefinition:i,tournamentId:f,matchUp:o})}else if(n){let e=null==(p=D({inheritedTieFormat:S??w,structure:n}))?void 0:p.modifiedMatchUpsCount;e&&(v+=e,h+=1,I+=1);let t=!n.tieFormat||kT({ancestor:n.tieFormat,descendant:r}).different;t&&(n.tieFormat=Jy(r),h+=1,I+=1),(e||t)&&i&&kp({structureIds:[n.structureId],eventId:null==s?void 0:s.eventId,drawDefinition:i})}else{if(!i)return{error:$t};P({drawDefinition:i}),i.tieFormat=Jy(r),I+=1}return{modifiedStructuresCount:h,modifiedMatchUpsCount:v,addedMatchUpsCount:g,modifiedCount:I,...At,tieFormat:r};function P({drawDefinition:e}){var t;let i=e.structures||[],n=[];for(let r of i){if(r.tieFormat)continue;let e=null==(t=D({inheritedTieFormat:w,structure:r}))?void 0:t.modifiedMatchUpsCount;if(e){h+=1,v+=e;let t=r.structureId;n.push(t)}}return kp({structureIds:n,eventId:null==s?void 0:s.eventId,drawDefinition:e}),n.length}function D({inheritedTieFormat:n,structure:o}){var s,u;let d=0,c=(null==(s=jh({matchUpFilters:{matchUpTypes:[Fe]},structure:o}))?void 0:s.matchUps)||[];for(let p of c){let o=TC({matchUp:p,updateInProgressMatchUps:e}),s=!1,c=bC({from:tt(null==(u=p.tieMatchUps)?void 0:u.map((({collectionId:e})=>e))),to:U});if(c.equivalent)p.tieFormat&&y(p)&&o&&(p.tieFormat=Jy(r),s=!0);else{let{changes:e,changesArePossible:t}=RC({matchUp:p,check:c});if(t&&!p.tieFormat)T({changes:e,matchUp:p,tieFormat:r,uuids:l});else{if(!n)return La({result:{error:Wi},stack:m});(!p.tieFormat||kT({ancestor:n,descendant:p.tieFormat}).different)&&(p.tieFormat=n,s=!0)}}s&&(d+=1,Cp({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:i,context:m,eventId:a,matchUp:p}))}return{modifiedMatchUpsCount:d}}function T({uuids:e,matchUp:t,tieFormat:n,changes:r}){t.tieFormat=Jy(n);let o=[],s=[];return r.forEach((i=>{if(i.countChange>0){let r=Math.max(0,...t.tieMatchUps.filter((e=>e.collectionId===i.collectionId)).map(ov("collectionPosition"))),a=n.collectionDefinitions.find((e=>e.collectionId===i.collectionId)),o=oy({matchUpsLimit:i.countChange,collectionPositionOffset:r,collectionDefinition:a,matchUp:t,uuids:e});s.push(...ts(o,!1,!0)),g+=s.length,t.tieMatchUps.push(...o)}else{let e=i.toBePlayedTieMatchUpIds.slice(0,Math.abs(i.countChange));console.log("remove",e.length),o.push(...e),t.tieMatchUps=t.tieMatchUps.filter((({matchUpId:t})=>!e.includes(t)))}})),s.length&&Ap({matchUps:s,drawDefinition:i,tournamentId:f,eventId:a}),o.length&&Ep({matchUpIds:o,action:"updateTieFormat",drawDefinition:i,tournamentId:f,eventId:a}),{matchUpIdsRemoved:o,matchUpsAdded:s}}}({tieFormat:L,updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:a,structure:T,eventId:m,matchUp:D,event:h}),!P.error){let{appliedPolicies:e}=gm({tournamentRecord:t});NC({appliedPolicies:e,drawDefinition:a,auditData:_a({collectionDefinition:M,drawId:null==a?void 0:a.drawId,action:S,structureId:d,matchUpId:c,eventId:m})})}return La({result:{...P,modifications:C},stack:S})}function AC({updateInProgressMatchUps:e,originalValueGoal:t,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:d,eventId:c,event:p}){let{aggregateValue:m,valueGoal:f}=Bb(l);l.winCriteria=_a({aggregateValue:m,valueGoal:f}),(t&&t!==f||m&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:h}=function({updateInProgressMatchUps:e,drawDefinition:t,structureId:i,structure:n,matchUpId:r,matchUp:a}){var o,s;let l=[];return r&&a?l=[a]:i&&n?l=(null==(o=jh({matchUpFilters:{matchUpTypes:[Fe]},structure:n}))?void 0:o.matchUps)??[]:t&&(l=(null==(s=nv({matchUpFilters:{matchUpTypes:[Fe]},drawDefinition:t}))?void 0:s.matchUps)??[]),{targetMatchUps:l.filter((t=>!t.winningSide&&t.matchUpStatus!==Pc&&(e||t.matchUpStatus!==Nc&&!dv(t))))}}({updateInProgressMatchUps:e,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:d});!function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let o of n){let n,s=!!o.tieFormat;if(s&&(o.tieFormat=Jy(r)),e){let e=gm({tournamentRecord:t,drawDefinition:i,event:a}).appliedPolicies,r=Xy({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:t,appliedPolicies:e,drawDefinition:i,event:a});if(r.error)return r;n=r.score}s&&!n&&Cp({tournamentId:null==t?void 0:t.tournamentId,context:"updateTargetTeamMatchUps",eventId:null==a?void 0:a.eventId,matchUp:o,drawDefinition:i})}}({updateInProgressMatchUps:e,tournamentRecord:i,targetMatchUps:h,drawDefinition:a,tieFormat:l,event:p});let v=_a(l),g=Jo({tieFormat:v});if(g.error)return g;if(c&&p)p.tieFormat=v;else if(u&&d)d.tieFormat=l;else if(s)s.tieFormat=v;else if(a)a.tieFormat=v;else if(!d||!a)return{error:$t};return kp({drawDefinition:a,eventId:null==p?void 0:p.eventId}),{...At}}function EC({updateInProgressMatchUps:e=!0,collectionGroupNumber:t,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){if(!t)return{error:un};if(isNaN(t))return{error:Cr};let d="removeCollectionGroup",c=s?void 0:DC({drawDefinition:n,structureId:a,matchUpId:o,eventId:l,event:u});if(null!=c&&c.error)return La({result:c,stack:d});let p=null==c?void 0:c.structure;s=s??(null==c?void 0:c.matchUp);let m=null==c?void 0:c.tieFormat,f=null==m?void 0:m.winCriteria.valueGoal,h=null==m?void 0:m.winCriteria.aggregateValue,v=Jy(m);if(c=Jo({tieFormat:v}),c.error)return La({result:c,stack:d});let g=[];if(v.collectionDefinitions=v.collectionDefinitions.map((e=>{let{collectionGroupNumber:i,...n}=e;return i!==t?e:(g.push(e.collectionId),n)})),v.collectionGroups=v.collectionGroups.filter((({groupNumber:e})=>e!==t)),c=AC({updateInProgressMatchUps:e,originalValueGoal:f,wasAggregateValue:h,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:p,tieFormat:v,matchUpId:o,matchUp:s,eventId:l,event:u}),!c.error){let{appliedPolicies:e}=gm({tournamentRecord:i});NC({appliedPolicies:e,drawDefinition:n,auditData:_a({drawId:null==n?void 0:n.drawId,collectionGroupNumber:t,action:d,structureId:a,matchUpId:o,eventId:l})})}return La({result:{...c,modifiedCollectionIds:g},stack:d})}function CC({tieFormat:e,orderMap:t}){var i;let n=Jy(e);return n.collectionDefinitions.forEach((e=>{let i=t[e.collectionId];i&&(e.collectionOrder=i)})),null==(i=n.collectionDefinitions)||i.sort(((e,t)=>et(e.collectionOrder)-et(t.collectionOrder))),n}function OC({tournamentRecord:e,drawDefinition:t,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:o,event:s}){if("object"!=typeof r||!Object.values(r).every((e=>Ye(e))))return La({result:{error:Cr},context:{orderMap:r}});if(a&&null!=s&&s.tieFormat)kC({tournamentRecord:e,event:s,orderMap:r});else if(n){let i=t&&Vy({drawDefinition:t,matchUpId:n});if(null!=i&&i.error)return i;if(!(o=i.matchUp))return{error:Ji};null!=o&&o.tieFormat&&(o.tieFormat=CC({tieFormat:o.tieFormat,orderMap:r}),Cp({tournamentId:null==e?void 0:e.tournamentId,eventId:null==s?void 0:s.eventId,drawDefinition:t,matchUp:o}))}else if(i){let n=Hc({drawDefinition:t,structureId:i});if(n.error)return n;let a=n.structure;if(null!=a&&a.tieFormat)a.tieFormat=CC({tieFormat:a.tieFormat,orderMap:r}),xC({eventId:null==s?void 0:s.eventId,tournamentRecord:e,drawDefinition:t,structure:a,orderMap:r}),kp({drawDefinition:t,structureIds:[a.structureId]});else if(t.tieFormat)FC({structureIds:[i],tournamentRecord:e,drawDefinition:t,orderMap:r,event:s});else{if(null==s||!s.tieFormat)return{error:Lr};kC({structureIds:[i],tournamentRecord:e,orderMap:r,event:s})}}else{if(null==t||!t.tieFormat)return{error:Lr};FC({tournamentRecord:e,drawDefinition:t,orderMap:r,event:s})}return{...At}}function kC({tournamentRecord:e,structureIds:t,orderMap:i,event:n}){let r=CC({tieFormat:n.tieFormat,orderMap:i});null!=t&&t.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])FC({tournamentRecord:e,drawDefinition:a,structureIds:t,orderMap:i,event:n})}function FC({tournamentRecord:e,drawDefinition:t,structureIds:i,orderMap:n,event:r}){let a=CC({tieFormat:t.tieFormat??(null==r?void 0:r.tieFormat),orderMap:n});null!=i&&i.length||(t.tieFormat=a);let o=[];for(let s of t.structures??[])null!=i&&i.length&&!i.includes(s.structureId)||((s.tieFormat||null!=i&&i.includes(s.structureId))&&(s.tieFormat=CC({tieFormat:s.tieFormat??t.tieFormat??(null==r?void 0:r.tieFormat),orderMap:n})),xC({eventId:null==r?void 0:r.eventId,tournamentRecord:e,drawDefinition:t,structure:s,orderMap:n}),o.push(s.structureId));kp({drawDefinition:t,structureIds:o})}function xC({tournamentRecord:e,drawDefinition:t,structure:i,orderMap:n,eventId:r}){var a;let o=null==(a=jh({matchUpFilters:{matchUpTypes:[Fe]},structure:i}))?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=CC({tieFormat:s.tieFormat,orderMap:n}),Cp({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:t,eventId:r,matchUp:s}))}function _C({updateInProgressMatchUps:e=!0,tieFormatComparison:t,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:d}){var c,p,m,f,h;let v="removeCollectionDefinition",g=u?void 0:DC({drawDefinition:n,structureId:o,matchUpId:s,eventId:l,event:d});if(null!=g&&g.error)return La({result:g,stack:v});let I=null==g?void 0:g.structure;u=u??(null==g?void 0:g.matchUp);let U=null==g?void 0:g.tieFormat,y=Jy(U);if(g=Jo({tieFormat:y}),g.error)return La({result:g,stack:v});let S=null==(c=null==y?void 0:y.collectionDefinitions)?void 0:c.find((e=>e.collectionId===a));if(!S)return La({result:{error:Lr,collectionId:a}});y.collectionDefinitions=y.collectionDefinitions.filter((e=>e.collectionId!==a)),S.collectionGroupNumber&&(y.collectionDefinitions=y.collectionDefinitions.map((e=>{let{collectionGroupNumber:t,...i}=e;return i})),y.collectionGroups=y.collectionGroups.filter((({groupNumber:e})=>e!==S.collectionGroupNumber)));let{aggregateValue:w,valueGoal:P}=Bb(y);y.winCriteria=_a({aggregateValue:w,valueGoal:P});let D=null==U?void 0:U.winCriteria.valueGoal,T=null==U?void 0:U.winCriteria.aggregateValue;(D&&D!==P||w&&!T)&&(r?y.tieFormatName=r:delete y.tieFormatName);let b=[];s&&u?b=[u]:o&&I?b=(null==(p=jh({matchUpFilters:{matchUpTypes:[Fe]},structure:I}))?void 0:p.matchUps)??[]:n?b=(null==(m=nv({matchUpFilters:{matchUpTypes:[Fe]},drawDefinition:n}))?void 0:m.matchUps)??[]:d&&(b=(null==(f=Xh({matchUpFilters:{matchUpTypes:[Fe]},drawDefinition:n}))?void 0:f.matchUps)??[]);let R=(b||[]).filter((i=>{var n,r,o;let s=null==(r=null==(n=i.tieMatchUps)?void 0:n.filter((e=>e.collectionId===a)))?void 0:r.some(dv),l=!(!t||!i.tieFormat)&&(null==(o=kT({descendant:i.tieFormat,ancestor:y}))?void 0:o.different);return e&&!s||!i.winningSide&&i.matchUpStatus!==Pc&&(e||i.matchUpStatus!==Nc&&!dv(i)&&!l)}));if(!R.length)return{error:Dr};let{appliedPolicies:N}=gm({tournamentRecord:i});if(s&&u&&e){let e=null==(h=u.tieMatchUps)?void 0:h.filter((e=>e.collectionId===a));for(let t of e??[]){let e=MM({matchUpId:t.matchUpId,tieMatchUpId:null==u?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:n,event:d});if(e.error||(e=Vy({drawDefinition:n,matchUpId:s}),e.error))return e;u=null==e?void 0:e.matchUp}}let M=[];for(let E of R){for(let e of(null==E?void 0:E.sides)??[])e.lineUp=(e.lineUp??[]).map((e=>({participantId:e.participantId,collectionAssignments:((null==e?void 0:e.collectionAssignments)??[]).filter((e=>e.collectionId!==a))})));if(E.tieMatchUps=(E.tieMatchUps??[]).filter((e=>{let t=e.collectionId===a;return t&&M.push(e.matchUpId),!t})),E.tieFormat&&(E.tieFormat=Jy(y)),e){let e=Xy({matchUpId:E.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:n,event:d});if(e.error)return e}Cp({tournamentId:null==i?void 0:i.tournamentId,eventId:null==d?void 0:d.eventId,drawDefinition:n,context:v,matchUp:E})}M.length&&Ep({tournamentId:null==i?void 0:i.tournamentId,matchUpIds:M,eventId:null==d?void 0:d.eventId,drawDefinition:n});let A=_a(y);if(g=Jo({tieFormat:A}),g.error)return La({result:g,stack:v});if(l&&d)d.tieFormat=A;else if(s&&u)u.tieFormat=A;else if(I)I.tieFormat=A;else if(n)n.tieFormat=A;else if(!u||!n)return{error:$t};return kp({drawDefinition:n,eventId:null==d?void 0:d.eventId}),NC({appliedPolicies:N,drawDefinition:n,auditData:_a({drawId:null==n?void 0:n.drawId,action:v,collectionId:a,structureId:o,matchUpId:s,eventId:l})}),{tieFormat:A,deletedMatchUpIds:M,targetMatchUps:R,...At}}function LC({updateInProgressMatchUps:e=!0,tournamentRecord:t,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:d}){let c="addCollectionGroup";if(!Array.isArray(r))return La({result:{error:un},stack:c});let p=l?void 0:DC({drawDefinition:n,structureId:o,matchUpId:s,eventId:u,event:d});if(null!=p&&p.error)return La({result:p,stack:c});let m=null==p?void 0:p.structure;l=l||(null==p?void 0:p.matchUp);let f=null==p?void 0:p.tieFormat,h=null==f?void 0:f.winCriteria.valueGoal,v=Jy(f);if(p=Jo({tieFormat:v}),p.error)return La({result:p,stack:c});for(let I of v.collectionDefinitions){let{collectionId:e,collectionGroupNumber:t}=I;if(t&&r.includes(e))return La({info:"collectionIds cannot be part of other collectionGroups",result:{error:Cr},stack:c})}let g=(v.collectionGroups||[]).reduce(((e,t)=>t.groupNumber>e?t.groupNumber:e),0)+1;return i.groupNumber=g,v.collectionDefinitions=v.collectionDefinitions.map((e=>r.includes(e.collectionId)?{...e,collectionGroupNumber:g}:e)),v.collectionGroups=[...v.collecitonGroups||[],i],AC({updateInProgressMatchUps:e,originalValueGoal:h,tournamentRecord:t,drawDefinition:n,tieFormatName:a,structureId:o,structure:m,tieFormat:v,matchUpId:s,matchUp:l,eventId:u,event:d})}function BC({updateInProgressMatchUps:e=!0,collectionDefinition:t,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:d,matchUpId:c,matchUp:p,eventId:m,uuids:f,event:h}){var v,g;let I="addCollectionDefinition",U=gm({tournamentRecord:n,drawDefinition:s,event:h}).appliedPolicies??{},y=(null==r?void 0:r[rd])??(null==U?void 0:U[rd]);a=a??(null==(v=null==y?void 0:y.participants)?void 0:v.enforceCategory);let S=!1!==(u??(null==(g=null==y?void 0:y.participants)?void 0:g.enforceGender)),w=!(!(i??(null==h?void 0:h.category))||!1===a),P=!(!(o??(null==h?void 0:h.gender))||!S),D=Ko({referenceCategory:i??(null==h?void 0:h.category),collectionDefinition:t,referenceGender:o,checkCategory:w,checkGender:P,event:h});if(D.error)return La({result:D,stack:I});let T=null!=p&&p.tieFormat?void 0:DC({drawDefinition:s,structureId:d,matchUpId:c,eventId:m,event:h});if(null!=T&&T.error)return La({result:{error:T.error},stack:I});let b=null==T?void 0:T.structure,R=(null==(p=p??(null==T?void 0:T.matchUp))?void 0:p.tieFormat)??(null==T?void 0:T.tieFormat),N=Jy(R);if(T=Jo({tieFormat:N}),null==T?void 0:T.error)return La({result:{error:T.error},stack:I});if(t.collectionId){if(N.collectionDefinitions.map((({collectionId:e})=>e)).includes(t.collectionId))return La({context:{collectionId:t.collectionId},result:{error:Or}})}else t.collectionId=rs();N.collectionDefinitions.push(t),N.collectionDefinitions.sort(((e,t)=>(e.collectionOrder||0)-(t.collectionOrder||0))).forEach(((e,t)=>e.collectionOrder=t+1));let{aggregateValue:M,valueGoal:A}=Bb(N);N.winCriteria=_a({aggregateValue:M,valueGoal:A});let E=null==R?void 0:R.winCriteria.valueGoal,C=null==R?void 0:R.winCriteria.aggregateValue;(E&&E!==A||M&&!C)&&(l?N.tieFormatName=l:delete N.tieFormatName);let O=[],k=[],F=[],x=_a(N);if(T=Jo({tieFormat:x}),null==T?void 0:T.error)return La({result:{error:T.error},stack:I});if(m&&h){h.tieFormat=x;for(let i of h.drawDefinitions??[])if(!i.tieFormat)for(let n of i.structures??[]){if(n.tieFormat)continue;let i=VC({updateInProgressMatchUps:e,collectionDefinition:t,structure:n,uuids:f});k.push(...i.newMatchUps),F.push(...i.targetMatchUps),O.push(n.structureId)}jC({modifiedMatchUps:F,eventId:null==h?void 0:h.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:k,stack:I})}else if(d&&b){b.tieFormat=x;let i=VC({updateInProgressMatchUps:e,collectionDefinition:t,structure:b,uuids:f});k.push(...i.newMatchUps),F=i.targetMatchUps,jC({modifiedMatchUps:F,eventId:null==h?void 0:h.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:k,stack:I})}else if(c&&p){if(!TC({matchUp:p,updateInProgressMatchUps:e}))return La({result:{error:Pn},stack:I});p.tieFormat=x;let i=oy({collectionDefinition:t,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...i),k.push(...i),jC({modifiedMatchUps:[p],eventId:null==h?void 0:h.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:k,stack:I})}else{if(!s)return{error:$t};s.tieFormat=x;for(let i of s.structures??[]){let n=VC({updateInProgressMatchUps:e,collectionDefinition:t,structure:i,uuids:f});O.push(i.structureId),k.push(...n.newMatchUps),F.push(...n.targetMatchUps)}jC({modifiedMatchUps:F,eventId:null==h?void 0:h.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:k,stack:I})}return NC({appliedPolicies:U,drawDefinition:s,auditData:_a({drawId:null==s?void 0:s.drawId,collectionDefinition:t,action:I,structureId:d,matchUpId:c,eventId:m})}),{tieFormat:x,targetMatchUps:F,addedMatchUps:k,...At}}function VC({updateInProgressMatchUps:e,collectionDefinition:t,structure:i,uuids:n}){var r;let a=[],o=(null==(r=jh({matchUpFilters:{matchUpTypes:[Fe]},structure:i}))?void 0:r.matchUps).filter((t=>TC({matchUp:t,updateInProgressMatchUps:e})&&!t.tieFormat));for(let s of o){let e=oy({collectionDefinition:t,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...e),a.push(...e)}return{newMatchUps:a,targetMatchUps:o}}function jC({modifiedStructureIds:e,tournamentRecord:t,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:o}){Ap({tournamentId:null==t?void 0:t.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),null==i||i.forEach((e=>{Cp({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:n,context:o,matchUp:e,eventId:a})})),kp({structureIds:e,drawDefinition:n,eventId:a})}function GC({updateInProgressMatchUps:e=!1,tieFormatComparison:t,modifiedTieFormat:i,tournamentRecord:n,considerations:r,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:u,event:d}){let c="modifyTieFormat";if(!Jo({tieFormat:i}).valid)return La({result:{error:ji},info:"falied validation",stack:c});let p=DC({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:d});if(p.error)return La({result:p,stack:c});let{matchUp:m,tieFormat:f}=p,h=Jy(f),v=kT({descendant:i,ancestor:h,considerations:r});if(v.invalid)return La({context:{invalid:v.invalid},result:{error:ji},stack:c});if(null==v||!v.different)return La({result:{...At},info:"Nothing to do",stack:c});let g,I=h.collectionDefinitions.map((({collectionId:e})=>e)),U=i.collectionDefinitions.map((({collectionId:e})=>e)),y=I.filter((e=>!U.includes(e))),S=i.collectionDefinitions.filter((({collectionId:e})=>!I.includes(e))),w=S.map(ov("collectionId")),P=[],D=i.tieFormatName;for(let T of i.collectionDefinitions){if(w.includes(T.collectionId))continue;let t=MC({updateInProgressMatchUps:e,...T,tournamentRecord:n,tieFormatName:D,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:d});if(t.modifications&&P.push(...t.modifications),t.error)return La({result:t,stack:c});t.tieFormat&&(g=t.tieFormat)}for(let T of S){let t=BC({updateInProgressMatchUps:e,collectionDefinition:T,tournamentRecord:n,drawDefinition:a,tieFormatName:D,structureId:o,matchUpId:s,matchUp:m,eventId:l,uuids:u,event:d});if(t.error)return La({result:t,stack:c});t.tieFormat&&(g=t.tieFormat)}for(let T of y){let i=_C({updateInProgressMatchUps:e,tieFormatComparison:t,tournamentRecord:n,drawDefinition:a,tieFormatName:D,collectionId:T,structureId:o,matchUpId:s,eventId:l,matchUp:m,event:d});if(i.error)return La({result:i,stack:c});i.tieFormat&&(g=i.tieFormat)}return(null==f?void 0:f.tieFormatName)!==D?(g.tieFormatName=D,P.push({tieFormatName:D})):(P.length||w.length||y.length)&&(delete g.tieFormatName,P.push("tieFormatName removed: modifications without new tieFormatName")),g.collectionDefinitions=g.collectionDefinitions.sort(((e,t)=>et(e.collectionOrder)-et(t.collectionOrder))).map(((e,t)=>({...e,collectionOrder:t+1}))),{processedTieFormat:Jy(g),modifications:P,...At}}function $C({tournamentRecord:e}){if(!e)return{error:Bt};let t=0;for(let i of e.events??[]){let n=i.tieFormats??[],r=e=>{if(!e.tieFormat)return;let i;for(let t of n)kT({descendant:e.tieFormat,ancestor:t}).different||(i=t.tieFormatId);if(i)e.tieFormatId=i,delete e.tieFormat;else{let i=ts(e.tieFormat,void 0,!0);i.tieFormatId||(i.tieFormatId=rs()),e.tieFormatId=i.tieFormatId,delete e.tieFormat,n.push(i),t+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let e of i.drawDefinitions??[]){r({tieFormat:e.tieFormat,eventType:a});for(let t of e.structures??[])r({tieFormat:t.tieFormat,eventType:a})}let o=(t,n)=>{var r;let a=null==(r=l.matchUps)?void 0:r.find((e=>e.matchUpId===t));a&&(a.tieFormatId=n,delete a.tieFormat,Cp({tournamentId:null==e?void 0:e.tournamentId,eventId:i.eventId,matchUp:a}))},s=e=>{let i=ts(e.tieFormat,void 0,!0);i.tieFormatId||(i.tieFormatId=rs()),n.push(i),t+=1,o(e.matchUpId,i.tieFormatId)},l=Xh({matchUpFilters:{matchUpTypes:[ke]},event:i}),u=l.matchUps??[];for(let e of u){let t;for(let i of n)e.tieFormat&&kT({descendant:e.tieFormat,ancestor:i}).different||(t=i.tieFormatId);t?o(e.matchUpId,t):s(e)}n.length&&(i.tieFormats=n)}return{...At,addedCount:t}}be(PC,{addCollectionDefinition:()=>BC,addCollectionGroup:()=>LC,aggregateTieFormats:()=>$C,modifyCollectionDefinition:()=>MC,modifyTieFormat:()=>GC,orderCollectionDefinitions:()=>OC,removeCollectionDefinition:()=>_C,removeCollectionGroup:()=>EC});var qC={};be(qC,{addDrawDefinitionExtension:()=>Pd,addEventExtension:()=>Dd,addEventTimeItem:()=>oS,addExtension:()=>Sd,addNotes:()=>jy,addOnlineResource:()=>ZC,addParticipantExtension:()=>Td,addParticipantTimeItem:()=>rS,addTimeItem:()=>nS,addTournamentExtension:()=>wd,addTournamentTimeItem:()=>aS,analyzeDraws:()=>vS,analyzeTournament:()=>RT,copyTournamentRecord:()=>HC,createTournamentRecord:()=>IA,generate:()=>WC,getAggregateTeamResults:()=>TT,getAllowedDrawTypes:()=>gT,getAllowedMatchUpFormats:()=>vT,getAppliedPolicies:()=>gm,getCompetitionDateRange:()=>PT,getCompetitionPenalties:()=>UT,getPolicyDefinitions:()=>Im,getTournamentInfo:()=>wT,getTournamentPenalties:()=>IT,getTournamentPersons:()=>DT,getTournamentPoints:()=>ET,getTournamentStructures:()=>gI,getTournamentTimeItem:()=>lm,mutate:()=>zC,query:()=>hT,removeDrawDefinitionExtension:()=>Rd,removeEventExtension:()=>Nd,removeExtension:()=>Ud,removeNotes:()=>Gy,removeOnlineResource:()=>JC,removeParticipantExtension:()=>Md,removeTournamentExtension:()=>bd,setTournamentCategories:()=>iO,setTournamentDates:()=>nO,setTournamentEndDate:()=>aO,setTournamentName:()=>eO,setTournamentNotes:()=>tO,setTournamentStartDate:()=>rO,setTournamentStatus:()=>KC});var WC={};function HC(e){var t,i;let n=qu(e,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(n.error)return n;let{startDate:r,endDate:a}=e.tournamentRecord,o=(r&&a?new Date(Eo(a)).getTime()-new Date(Eo(r)).getTime():0)/864e5,s=e.endDate||xo(e.startDate,o),l=t=>null==t?void 0:t.filter((({itemType:t})=>{var i;return null==(i=e.itemTypeList)?void 0:i.includes(t)})),u=t=>null==t?void 0:t.filter((({name:t})=>{var i;return null==(i=e.extensionList)?void 0:i.includes(t)})),d={participants:e.copyParticipants?(null==(t=e.tournamentRecord.participants)?void 0:t.map((e=>{let{timeItems:t,extensions:i,...n}=e;return ts({...n,timeItems:l(t),extensions:u(i)},!1,!0)})))??[]:[],parentOrganisation:ts({...e.tournamentRecord.parentOrganisation},!1,!0),venues:ts(e.tournamentRecord.venues??[],!1,!0),extensions:u(e.tournamentRecord.extensions),timeItems:l(e.tournamentRecord.timeItems),events:(null==(i=e.tournamentRecord.events)?void 0:i.map((t=>{let{drawDefinitions:i,timeItems:n,extensions:r,startDate:a,endDate:o,...d}=t;return ts({extensions:u(r),timeItems:l(n),startDate:e.startDate,endDate:s,...d},!1,!0)})))??[],weekdays:[...e.tournamentRecord.weekdays??[]],tournamentName:e.tournamentName,startDate:e.startDate,tournamentId:rs(),endDate:s};return{...At,tournamentRecord:d}}be(WC,{copyTournamentRecord:()=>HC,createTournamentRecord:()=>IA});var zC={};be(zC,{addDrawDefinitionExtension:()=>Pd,addEventExtension:()=>Dd,addEventTimeItem:()=>oS,addExtension:()=>Sd,addNotes:()=>jy,addOnlineResource:()=>ZC,addParticipantExtension:()=>Td,addParticipantTimeItem:()=>rS,addTimeItem:()=>nS,addTournamentExtension:()=>wd,addTournamentTimeItem:()=>aS,removeDrawDefinitionExtension:()=>Rd,removeEventExtension:()=>Nd,removeExtension:()=>Ud,removeNotes:()=>Gy,removeOnlineResource:()=>JC,removeParticipantExtension:()=>Md,removeTournamentExtension:()=>bd,setTournamentCategories:()=>iO,setTournamentDates:()=>nO,setTournamentEndDate:()=>aO,setTournamentName:()=>eO,setTournamentNotes:()=>tO,setTournamentStartDate:()=>rO,setTournamentStatus:()=>KC});var YC={ABANDONED:"ABANDONED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};function KC({tournamentRecord:e,status:t}){return e?t&&!Object.keys(YC).includes(t)?{error:Cr,info:"Unknown status"}:(e.tournamentStatus=t,{...At}):{error:Bt}}function JC(e){var t,i,n;let r=qu(e,[{tournamentRecord:!0,onlineResource:!0}]);if(r.error)return r;let{tournamentRecord:a,onlineResource:o,organisationId:s,participantId:l,personId:u,courtId:d,venueId:c}=e;if(s){if((null==(t=a.parentOrganisation)?void 0:t.parentOrganisationId)!==s)return La({result:{error:Lr}});QC({element:a.parentOrganisation,onlineResource:o})}else if(l||u){let e=(a.participants??[]).find((e=>{var t;return u&&(null==(t=e.person)?void 0:t.personId)===u||e.participantId===l}));if(!e)return La(u?{result:{error:Lr}}:{result:{error:_n}});if(u){if((null==(i=e.person)?void 0:i.personId)!==u)return La({result:{error:Nn}});QC({element:e.person,onlineResource:o})}else QC({element:e,onlineResource:o})}else if(d){let e=null==(n=(a.venues??[]).filter((e=>!c||e.venueId===c)).flatMap((e=>(e.courts??[]).filter((e=>e.courtId===d)))))?void 0:n[0];if(!e)return La({result:{error:or}});QC({element:e,onlineResource:o})}else if(c){let e=(a.venues??[]).find((e=>e.venueId===c));if(!e)return La({result:{error:ur}});QC({element:e,onlineResource:o})}else QC({element:a,onlineResource:o}),Ia({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:vp});return{...At}}function QC({element:e,onlineResource:t}){let i=(e.onlineResources??[]).filter((e=>!((null==e?void 0:e[Qo])===t[Qo]&&(null==e?void 0:e[Zo])===t[Zo]&&(null==e?void 0:e[Xo])===t[Xo])));e.onlineResources=i}function ZC(e){var t,i,n;let r=qu(e,[{tournamentRecord:!0,onlineResource:!0}]);if(r.error)return r;let{tournamentRecord:a,onlineResource:o,organisationId:s,participantId:l,personId:u,courtId:d,venueId:c}=e;if(s){if((null==(t=a.parentOrganisation)?void 0:t.parentOrganisationId)!==s)return La({result:{error:Lr}});XC({element:a.parentOrganisation,onlineResource:o})}else if(l||u){let e=(a.participants??[]).find((e=>{var t;return u&&(null==(t=e.person)?void 0:t.personId)===u||e.participantId===l}));if(!e)return La(u?{result:{error:Lr}}:{result:{error:_n}});if(u){if((null==(i=e.person)?void 0:i.personId)!==u)return La({result:{error:Nn}});XC({element:e.person,onlineResource:o})}else XC({element:e,onlineResource:o})}else if(d){let e=null==(n=(a.venues??[]).filter((e=>!c||e.venueId===c)).flatMap((e=>(e.courts??[]).filter((e=>e.courtId===d)))))?void 0:n[0];if(!e)return La({result:{error:or}});XC({element:e,onlineResource:o})}else if(c){let e=(a.venues??[]).find((e=>e.venueId===c));if(!e)return La({result:{error:ur}});XC({element:e,onlineResource:o})}else XC({element:a,onlineResource:o}),Ia({payload:{parentOrganisation:a.parentOrganisation,onlineResources:a.onlineResources,tournamentId:a.tournamentId},topic:vp});return{...At}}function XC({element:e,onlineResource:t}){let i=(e.onlineResources??[]).filter((e=>(null==e?void 0:e[Qo])!==t[Qo]&&(null==e?void 0:e[Zo])!==t[Zo]&&(null==e?void 0:e[Xo])!==t[Xo]));return i.push(t),e.onlineResources=i,{...At}}function eO({tournamentRecord:e,promotionalName:t,tournamentName:i,formalName:n}){if(!e)return{error:Bt};let r=e.tournamentId,a={tournamentId:r};return i&&i!==e.tournamentName&&(e.tournamentName=i,a.tournamentName=i),t&&t!==e.promotionalName&&(e.promotionalName=t,a.promotionalName=t),n&&n!==e.formalName&&(e.formalName=n,a.formalName=n),e.promotionalName===e.tournamentName&&(delete e.promotionalName,a.promotionalName=""),e.formalName===e.tournamentName&&(delete e.formalName,a.formalName=""),Object.keys(a).length>1&&Ia({topic:vp,payload:{parentOrganisation:e.parentOrganisation,tournamentId:r,...a}}),{...At}}function tO({tournamentRecord:e,notes:t}){if(!e)return{error:Bt};let i=t?jy({element:e,notes:t}):Gy({element:e});return i.error?i:(Ia({topic:vp,payload:{parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,notes:t??""}}),{...At})}function iO({tournamentRecord:e,categories:t}){return e?(t=(t||[]).filter((e=>e.categoryName&&e.type)),e.tournamentCategories=t,Ia({topic:vp,payload:{parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,categories:t}}),{...At}):{error:Bt}}function nO(e){var t,i;let n,{tournamentRecord:r,startDate:a,endDate:o,weekdays:s}=e,l=null==(t=e.activeDates)?void 0:t.filter(Boolean),u=qu(e,[{tournamentRecord:!0},{[Fu]:e=>fo.test(e),[_u]:vn,startDate:!1,endDate:!1},{[Fu]:e=>e.filter(Boolean).every((e=>fo.test(e))),[_u]:vn,activeDates:!1},{[Fu]:jR,weekdays:!1}]);if(u.error)return u;if(o&&a&&new Date(o)<new Date(a))return{error:Cr};if(o&&a&&new Date(a)>new Date(o))return{error:Cr};if(null!=l&&l.length){let e=a||r.startDate,t=o||r.endDate,i=!e||l.every((t=>new Date(t)>=new Date(e))),n=!t||l.every((e=>new Date(e)<=new Date(t)));if(!i||!n)return{error:vn}}(a&&r.startDate&&new Date(a)>new Date(r.startDate)||o&&r.endDate&&new Date(o)<new Date(r.endDate))&&(n=!0);let d=Do(r.startDate,r.endDate);a&&(r.startDate=a),o&&(r.endDate=o);let c=Do(r.startDate,r.endDate),p=d.filter((e=>!c.includes(e))),m=c.filter((e=>!d.includes(e)));for(let h of r.events??[])a&&h.startDate&&new Date(h.startDate)<new Date(a)&&(h.startDate=a),o&&h.startDate&&new Date(h.startDate)>new Date(o)&&(h.startDate=a??o),o&&h.endDate&&new Date(h.endDate)>new Date(o)&&(h.endDate=o),a&&h.endDate&&new Date(h.endDate)<new Date(a)&&(h.endDate=o??a);a&&r.endDate&&new Date(a)>new Date(r.endDate)&&(r.endDate=a),o&&r.startDate&&new Date(o)<new Date(r.startDate)&&(r.startDate=o),l&&(r.activeDates=l),s&&(r.weekdays=s);let f=n&&(null==(i=function({tournamentRecord:e}){let t=ev({tournamentRecord:e}).matchUps??[],i=e.startDate&&new Date(e.startDate),n=e.endDate&&new Date(e.endDate),r=[],a=[];for(let o of t){let{schedule:e,matchUpId:t}=o;if(e&&e.scheduledDate){let o=new Date(e.scheduledDate);(i&&o<i||n&&o>n)&&(a.push(t),r.includes(e.scheduledDate)||r.push(e.scheduledDate))}}return r.length&&!hA({scheduledDates:r,tournamentRecord:e}).clearedScheduleCount?{error:Jt}:{unscheduledMatchUpIds:a}}({tournamentRecord:r}))?void 0:i.unscheduledMatchUpIds);return function({tournamentRecord:e}){var t,i;if(!e)return{error:Bt};let{startDate:n,endDate:r}=e,a=Do(n,r),o=[];for(let s of e.venues||[])null!=(t=null==s?void 0:s.courts)&&t.length&&o.push(...s.courts);for(let s of o){let{startTime:e,endTime:t}=(s.dateAvailability??[]).reduce(((e,t)=>{let i=No(e.startTime),n=No(e.endTime);return t.startTime&&No(t.startTime)<i&&(e.startTime=t.startTime),t.endTime&&No(t.endTime)>n&&(e.endTime=t.endTime),e}),{startTime:"08:00",endTime:"18:00"}),n=a.map((i=>{var n;return(null==(n=s.dateAvailability)?void 0:n.find((e=>e.date===i)))??{date:i,startTime:e,endTime:t}})),r=null==(i=s.dateAvailability)?void 0:i.find((e=>!e.date));r&&n.unshift(r),s.dateAvailability=n}}({tournamentRecord:r}),Ia({payload:_a({parentOrganisation:r.parentOrganisation,tournamentId:r.tournamentId,activeDates:l,startDate:a,weekdays:s,endDate:o}),topic:vp}),{...At,unscheduledMatchUpIds:f,datesAdded:m,datesRemoved:p}}function rO({tournamentRecord:e,startDate:t}){return t?nO({tournamentRecord:e,startDate:t}):{error:vn}}function aO({tournamentRecord:e,endDate:t}){return t?nO({tournamentRecord:e,endDate:t}):{error:vn}}var oO={};be(oO,{addCourt:()=>rE,addCourts:()=>aE,addVenue:()=>Ph,deleteCourt:()=>wO,deleteVenue:()=>mO,deleteVenues:()=>fO,disableCourts:()=>hO,disableVenues:()=>gO,enableCourts:()=>UO,enableVenues:()=>SO,generate:()=>sO,generateCourts:()=>SN,getCompetitionVenues:()=>qT,getCourts:()=>Zb,getVenuesAndCourts:()=>$T,modifyCourt:()=>DO,modifyCourtAvailability:()=>dO,modifyVenue:()=>RO,mutate:()=>lO,publicFindVenue:()=>bh,query:()=>Qb});var sO={};be(sO,{generateCourts:()=>SN});var lO={};function uO(e){if(!(null!=e&&e.tournamentRecord||Array.isArray(null==e?void 0:e.venueMatchUps)))return{error:Bt};if(null==e||!e.courtId)return{error:ln};let{scheduleVisibilityFilters:t,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=e,{schedulingProfile:o}=rb({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:s}=ev({scheduleVisibilityFilters:t,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:e,courtId:t}){return Ab({matchUps:e.filter((e=>{var i,n,r;let a=null==(n=null==(i=e.schedule)?void 0:i.allocatedCourts)?void 0:n.map((({courtId:e})=>e));return(null==(r=e.schedule)?void 0:r.courtId)===t||(null==a?void 0:a.includes(t))})),schedulingProfile:o})}}function dO({tournamentRecord:e,dateAvailability:t,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var o,s,l;if(!e)return{error:Bt};if(!r)return{error:ln};let u=nE({dateAvailability:t});if(u.error)return u;let{updatedDateAvailability:d,totalMergeCount:c}=function(e){let t=0,i=e.reduce(((e,t)=>{let{date:i,startTime:n,endTime:r,bookings:a}=t;return e[i]||(e[i]=[]),e[i].push({startTime:n,endTime:r,bookings:a}),e}),{}),n=[];return Object.keys(i).forEach((e=>{i[e].sort(iE);let{mergedAvailability:r,mergeCount:a}=function(e){let t,i,n,r=e.length,a=0,o=[];for(;e.length&&r;){let s=e.shift(),{startTime:l,endTime:u,bookings:d}=s;if(r-=1,t)if(Lo(_o(i),_o(l),!1)>0){let e={startTime:t,endTime:i};null!=n&&n.length&&(e.bookings=n),o.push(e),t=l,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,a+=1;else t=l,n=d,i=u}let s={startTime:t,endTime:i};return null!=n&&n.length&&(s.bookings=n),o.push(s),{mergedAvailability:o,mergeCount:a}}(i[e]);n.push(...r.map((t=>({date:e,...t})))),t+=a})),{updatedDateAvailability:n,totalMergeCount:t}}(t);t=d;let p=Rh({tournamentRecord:e,courtId:r});if(p.error)return p;let{court:m,venue:f}=p,{matchUps:h}=uO({tournamentRecord:e,venueMatchUps:n,courtId:r});if(null!=h&&h.length){let t=null==(o=gm({tournamentRecord:e}))?void 0:o.appliedPolicies,i=a??(null==(l=null==(s=null==t?void 0:t[ud])?void 0:s.allowDeletionWithScoresPresent)?void 0:l.courts),n=[];n.length&&(i||console.log("throw error: scheduled court matchUps",n.length))}return m&&(m.dateAvailability=t,!i&&f&&Ia({payload:{venue:f,tournamentId:e.tournamentId},topic:gp,key:f.venueId})),{...At,totalMergeCount:c}}function cO({matchUpsCount:e=0}){return{error:zr,info:`Schedule would be deleted from ${e} ${1===e?"matchUp":"matchUps"}; use { force: true }`}}function pO({tournamentRecord:e,drawDefinition:t,matchUpId:i,drawId:n}){let r;if(!i)return{error:Hi};if(!t&&!n)return{error:li};if(!t){if(!e)return{error:Bt};({drawDefinition:t}=Ch({tournamentRecord:e,drawId:n}))}if(t)({matchUp:r}=Vy({drawDefinition:t,matchUpId:i}));else{if(!e)return{error:Bt};let t=ev({tournamentRecord:e,inContext:!1}).matchUps??[];({matchUp:r}=By({matchUps:t,matchUpId:i}))}return r?(r.timeItems&&r.timeItems.find((e=>[Rf,bf].includes(e.itemType)))&&(r.timeItems=r.timeItems.filter((({itemType:e})=>![Rf,bf].includes(e))),Cp({tournamentId:null==e?void 0:e.tournamentId,context:"removeCourtAssignment",drawDefinition:t,matchUp:r})),{...At}):{error:Yi}}function mO(e){var t,i,n;if("string"!=typeof(null==e?void 0:e.venueId))return{error:dr};let{tournamentRecord:r,venueId:a,force:o}=e,s=e.tournamentRecords||r&&{[r.tournamentId]:r}||{};if(!Object.keys(s).length)return{error:Bt};let l=tv({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],u=null==(t=gm({tournamentRecord:r}))?void 0:t.appliedPolicies,d=o??(null==(n=null==(i=null==u?void 0:u[ud])?void 0:i.allowDeletionWithScoresPresent)?void 0:n.venues);if(l.length&&!d)return cO({matchUpsCount:l.length});for(let c of Object.values(s)){for(let t of l){let e=pO({matchUpId:t.matchUpId,drawId:t.drawId,tournamentRecord:c});if(e.error)return e}let e;c.venues=(c.venues??[]).filter((t=>(null==t?void 0:t.venueId)!==a||(e=!0,!1))),e&&Ia({payload:{venueId:a,tournamentId:c.tournamentId},topic:op,key:a})}return ob({tournamentRecords:s}),{...At}}function fO({tournamentRecord:e,venueIds:t,force:i}){if(!e)return{error:Bt};if(!Array.isArray(t))return{error:Cr};for(let n of e.venues||[]){let{venueId:r}=n;if(t.includes(r)){let{venueId:t}=n,r=mO({tournamentRecord:e,venueId:t,force:i});if(r.error)return r}}return{...At}}function hO(e){let{courtIds:t,dates:i}=e,n=Gp(e),r=qu(e,[{[nu]:!0,[wu]:!0}]);if(r.error)return r;for(let a of Object.values(n))vO({tournamentRecord:a,courtIds:t,dates:i});return{...At}}function vO({tournamentRecord:e,courtIds:t,dates:i}){let n=!Array.isArray(i)||!i.length||{dates:i},r=e=>Sd({extension:{value:n,name:xd},creationTime:!1,element:e});for(let a of e.venues||[])for(let e of a.courts||[])if(null!=t&&t.includes(e.courtId)){let t=r(e);if(t.error)return t}return{...At}}function gO(e){let{tournamentRecords:t,tournamentId:i,venueIds:n}=e,r=qu(e,[{[nu]:!0,[Pu]:!0}]);if(r.error)return r;let a=Object.keys(t).filter((e=>!i||e===i));for(let o of a){IO({tournamentRecord:t[o],venueIds:n})}return{...At}}function IO({tournamentRecord:e,venueIds:t}){for(let i of e.venues||[])if(null!=t&&t.includes(i.venueId)){let e=Sd({creationTime:!1,element:i,extension:{name:xd,value:!0}});if(e.error)return e}return{...At}}function UO(e){let t=Gp(e),i=[{[nu]:!0}];!e.enableAll&&i.push({[wu]:!0});let n=qu(e,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:o}=e;for(let s of Object.values(t))yO({tournamentRecord:s,courtIds:a,enableAll:r,dates:o});return{...At}}function yO({tournamentRecord:e,courtIds:t,enableAll:i,dates:n}){for(let r of e.venues||[])for(let e of r.courts||[])if(i||null!=t&&t.includes(e.courtId))if(Array.isArray(n)){let{extension:t}=Cd({element:e,name:xd});if(t){let i=t.value;Array.isArray(i.dates)&&(i.dates=i.dates.filter((e=>!n.includes(e)))),Sd({extension:{name:xd,value:i},creationTime:!1,element:e})}}else Ud({element:e,name:xd});return{...At}}function SO(e){let t=Gp(e),i=[{[nu]:!0}];!e.enableAll&&i.push({[Pu]:!0});let n=qu(e,i);if(n.error)return n;let{venueIds:r,enableAll:a}=e;for(let o of Object.values(t))for(let e of o.venues||[])(a||null!=r&&r.includes(e.venueId))&&Ud({element:e,name:xd});return{...At}}function wO(e){let t,i,{courtId:n,disableNotice:r,force:a}=e,o=Gp(e),s=qu(e,[{[nu]:!0,[Tu]:!0}]);if(s.error)return s;for(let l of Object.values(o)){if(i=PO({tournamentRecord:l,disableNotice:r,courtId:n,force:a}),i.error&&i.error!==or)return i;i.success&&(t=!0)}return t?{...At}:i}function PO({tournamentRecord:e,disableNotice:t,courtId:i,force:n}){var r,a,o;let s=Rh({tournamentRecord:e,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:u}=uO({tournamentRecord:e,courtId:i}),d=null==(r=gm({tournamentRecord:e}))?void 0:r.appliedPolicies,c=n??(null==(o=null==(a=null==d?void 0:d[ud])?void 0:a.allowDeletionWithScoresPresent)?void 0:o.courts);if(null!=u&&u.length&&!c)return cO({matchUpsCount:u.length});for(let p of u??[]){let t=pO({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:e});if(t.error)return t}return l&&(l.courts=(l.courts??[]).filter((e=>e.courtId!==i)),t||Ia({payload:{venue:l,tournamentId:e.tournamentId},topic:gp,key:l.venueId})),{...At}}function DO(e){let t,{disableNotice:i,modifications:n,courtId:r,force:a,venueMatchUps:o}=e,s=Gp(e);if(!Object.keys(s).length)return{error:Lt};for(let l of Object.values(s)){let e=TO({tournamentRecord:l,disableNotice:i,venueMatchUps:o,modifications:n,courtId:r,force:a});if(null!=e&&e.error)return e;t=!0}return t?{...At}:undefined}function TO({tournamentRecord:e,disableNotice:t,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!e)return{error:Bt};if(!r)return{error:ln};if(!n||"object"!=typeof n)return{error:Mr};let o=Rh({tournamentRecord:e,courtId:r});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(XA()).filter((e=>"courtId"!==e));if(!Object.keys(n).filter((e=>u.includes(e))).length)return{error:xr};let d=u.filter((e=>!["dateAvailability"].includes(e))),c=Object.keys(n).filter((e=>d.includes(e)));if(l&&c.forEach((e=>Object.assign(l,{[e]:n[e]}))),n.dateAvailability){let o=dO({dateAvailability:n.dateAvailability,tournamentRecord:e,venueMatchUps:i,disableNotice:t,courtId:r,force:a});if(o.error)return o}return t||Ia({payload:{venue:s,tournamentId:e.tournamentId},topic:gp,key:null==s?void 0:s.venueId}),{...At,court:ts(l)}}be(lO,{addCourt:()=>rE,addCourts:()=>aE,addVenue:()=>Ph,deleteCourt:()=>wO,deleteVenue:()=>mO,deleteVenues:()=>fO,disableCourts:()=>hO,disableVenues:()=>gO,enableCourts:()=>UO,enableVenues:()=>SO,modifyCourt:()=>DO,modifyCourtAvailability:()=>dO,modifyVenue:()=>RO});var bO=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]});function RO(e){let t,i,{modifications:n,venueId:r,force:a}=e,o=Gp(e);if(!Object.keys(o).length)return{error:Lt};if("string"!=typeof r)return{error:dr};for(let s of Object.values(o)){let e=NO({tournamentRecord:s,modifications:n,venueId:r,force:a});if(e.success&&(i=!0),e.error&&(t=e.error),e.error&&e.error!==ur)return e}return ob({tournamentRecords:o}),i?{...At}:{error:t}}function NO({tournamentRecord:e,modifications:t,venueId:i,force:n}){var r,a,o,s,l,u,d,c;if(!e)return{error:Bt};if(!t||"object"!=typeof t)return{error:Mr};if(!i)return{error:dr};let p=null==(r=gm({tournamentRecord:e}))?void 0:r.appliedPolicies,m=n??(null==(o=null==(a=null==p?void 0:p[ud])?void 0:a.allowDeletionWithScoresPresent)?void 0:o.venues),{matchUps:f}=function({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:i,venueId:n}){if(!t)return{error:Bt};if(!n)return{error:dr};let{schedulingProfile:r}=rb({tournamentRecord:t}),{matchUps:a}=ev({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:i});return{matchUps:function({matchUps:e,venueId:t}){return Ab({matchUps:e.filter((e=>{var i,n,r;let a=null==(n=null==(i=e.schedule)?void 0:i.allocatedCourts)?void 0:n.map((({venueId:e})=>e));return(null==(r=e.schedule)?void 0:r.venueId)===t||(null==a?void 0:a.includes(t))})),schedulingProfile:r})}({matchUps:a,venueId:n})}}({tournamentRecord:e,venueId:i}),h=Th({tournamentRecord:e,venueId:i});if(h.error)return h;let v=h.venue,g=Object.keys(bO()).filter((e=>"venueId"!==e));if(!Object.keys(t).filter((e=>g.includes(e))).length)return{error:xr};let I=g.filter((e=>!["courts","onlineResources"].includes(e))),U=Object.keys(t).filter((e=>I.includes(e)));v&&U.forEach((e=>Object.assign(v,{[e]:t[e]})));let y=(null==(s=null==v?void 0:v.courts)?void 0:s.map((e=>e.courtId)))??[],S=(null==(l=t.courts)?void 0:l.map((e=>e.courtId)))||[],w=S.length?y.filter((e=>!S.includes(e))):(null==t?void 0:t.courts)&&y,P=[];if(null!=w&&w.length){let t=null==(d=null==(u=null==v?void 0:v.courts)?void 0:u.filter((e=>w.includes(e.courtId))))?void 0:d.map((t=>{var i;let n=uO({courtId:t.courtId,tournamentRecord:e,venueMatchUps:f});for(let e of n.matchUps??[])P.push({matchUpId:e.matchUpId,drawId:e.drawId});return(null==(i=n.matchUps)?void 0:i.length)??0})).reduce(((e,t)=>e+t));if(!v||t&&!m)return cO({matchUpsCount:t});v.courts=null==(c=v.courts)?void 0:c.filter((e=>S.includes(e.courtId))),pA({schedule:{courtId:"",scheduledDate:""},matchUpDetails:P,removePriorValues:!0,tournamentRecord:e})}if(t.courts)for(let D of t.courts){let{courtId:t}=D||{},r=DO({modifications:D,disableNotice:!0,tournamentRecord:e,venueMatchUps:f,courtId:t,force:n});if(r.error===or&&(r=rE({disableNotice:!0,tournamentRecord:e,venueId:i,court:D})),r.error)return r}return ob({tournamentRecord:e}),v&&Ia({payload:{venue:v,tournamentId:e.tournamentId},topic:gp,key:null==v?void 0:v.venueId}),{...At,venue:ts(v)}}var MO={};function AO({scheduledMatchUps:e,showGlobalLog:t}){gv.length=0;let i=null==e?void 0:e.reduce(((e,{structureId:t})=>e.includes(t)?e:e.concat(t)),[]),n=Array.isArray(i)&&{...i.map((t=>{let{structureName:i,matchUpType:n}=e.find((e=>e.structureId===t));return{[t]:`${i} ${n}`}}))};null==i||i.forEach((t=>{var i;Iv({color:"blue",method:"draw",structure:n[t],keyColors:{structure:"magenta"}},!0);let r=(null==(i=uf({matchUps:e.filter((e=>e.structureId===t))}))?void 0:i.roundMatchUps)||[];Object.keys(r).forEach((e=>{Iv({roundNumber:e,keyColors:{roundNumber:"brightcyan"}},!0),r[e].forEach((({matchUpId:e,schedule:t})=>{Iv({matchUpId:e,time:Ao(t.scheduledTime),date:t.scheduledDate,venue:t.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)}))}))})),t&&Uv()}be(MO,{JSON2CSV:()=>xO,UUID:()=>rs,UUIDS:()=>ns,allNumeric:()=>gt,attributeFilter:()=>Xu,chunkArray:()=>ht,chunkByNth:()=>Ut,chunkSizeProfile:()=>vt,constantToString:()=>Tg,countValues:()=>it,createMap:()=>Dt,dateTime:()=>$o,definedAttributes:()=>_a,dehydrateMatchUps:()=>kO,extractAttributes:()=>av,flattenJSON:()=>_O,generateDateRange:()=>Do,generateHashCode:()=>Nt,generateRange:()=>lt,generateTimeCode:()=>hE,groupValues:()=>nt,hasAttributeValues:()=>Tt,instanceCount:()=>tt,intersection:()=>dt,isConvertableInteger:()=>Ye,isNumeric:()=>qe,isOdd:()=>We,isPowerOf2:()=>Ve,makeDeepCopy:()=>ts,matchUpScheduleSort:()=>OO,matchUpSort:()=>iv,nearestPowerOf2:()=>$e,nextPowerOf2:()=>He,noNulls:()=>Ze,noNumeric:()=>It,numericSort:()=>Le,occurrences:()=>mt,overlap:()=>pt,randomMember:()=>st,randomPop:()=>ot,shuffleArray:()=>Xe,structureSort:()=>qc,subSort:()=>ft,undefinedToNull:()=>bt,unique:()=>Qe,visualizeScheduledMatchUps:()=>AO});var{extractTime:EO,timeStringMinutes:CO}=$o;function OO(e,t){let i=e.schedule??{},n=t.schedule??{};if(i.scheduledDate&&!n.scheduledDate)return 1;if(n.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&n.scheduledDate){if(i.scheduledDate===n.scheduledDate){if(i.scheduledTime&&!n.scheduledTime)return 1;if(n.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&n.scheduledTime){return CO(EO(i.scheduledTime))-CO(EO(n.scheduledTime))}}return new Date(i.scheduledDate).getTime()-new Date(n.scheduledDate).getTime()}return 0}function kO({tournamentRecord:e}){if(!e)return{error:Bt};if("object"!=typeof e||!e.tournamentId)return{error:Cr};let{matchUps:t}=ev({tournamentRecord:e,inContext:!1});if(null!=t&&t.length){let i=function({tournamentRecord:e}){let t={};for(let i of e.events||[]){i.matchUpFormat&&(t[i.eventId]=i.matchUpFormat);for(let e of i.drawDefinitions||[]){e.matchUpFormat&&(t[e.drawId]=e.matchUpFormat);for(let i of e.structures||[]){i.matchUpFormat&&(t[i.structureId]=i.matchUpFormat);for(let e of i.structures||[])e.matchUpFormat&&(t[e.structureId]=e.matchUpFormat)}}}return t}({tournamentRecord:e});!function(e,t={}){for(let i of e){let{structureId:e,drawId:n,eventId:r}=i,a=t[e]||t[n]||t[r],o=i.matchUpFormat===a?void 0:i.matchUpFormat;for(let t of Object.keys(i))FO.includes(t)||delete i[t];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}(t,i)}return{...At}}var FO=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function xO(e,t){if(t&&"object"!=typeof t)return{error:Cr};let{columnTransform:i={}}=t||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:d={},valuesMap:c={},context:p={},delimiter:m='"',columnJoiner:f=",",rowJoiner:h="\r\n",keyJoiner:v="."}=t||{};if(!Array.isArray(e)||!Array.isArray(l)||"object"!=typeof p||"object"!=typeof d||"object"!=typeof i||"object"!=typeof u||"object"!=typeof c||"string"!=typeof f||"string"!=typeof h||"string"!=typeof v||"string"!=typeof m)return{error:Cr};i=Object.assign({},...Object.keys(i).reverse().map((e=>({[e]:Array.isArray(i[e])?i[e]:["string"==typeof i[e]&&i[e]].filter(Boolean)}))));let g=e.filter(Boolean).map((e=>_O(e,v))),I=Object.values(i).flat();n&&l.push(...I);let U=g.reduce(((e,t)=>Object.keys(t).every((t=>!e.includes(t)&&e.push(t)||!0))&&e),[]).filter((e=>!(null!=l&&l.length)||l.includes(e))),y=Object.assign({},...Object.keys(i).reverse().map((e=>i[e].map((t=>({[t]:e}))).flat())).flat()),S=U.reduce(((e,t)=>{let i=y[t];return i?e.includes(i)||e.push(i):e.push(t),e}),[]).sort(((e,i)=>null!=t&&t.sortOrder?t.sortOrder.includes(e)&&t.sortOrder.includes(i)&&t.sortOrder.indexOf(e)-t.sortOrder.indexOf(i)||!t.sortOrder.includes(i)&&-1:0));Object.keys(d).forEach((e=>!S.includes(e)&&S.unshift(e))),Object.keys(i).forEach((e=>!S.includes(e)&&S.unshift(e))),"object"==typeof p&&Object.keys(p).forEach((e=>!S.includes(e)&&S.unshift(e)));let w=S.map((e=>d[e]||e));if(s)return[w];let P=e=>`${m}${e}${m}`,D=[],T=g.map((e=>Object.values(S.reduce(((t,n,r)=>{var a;let o=i[n],s=(null!=o&&o.length?e[o.find((t=>e[t]))]:e[n])||(null==p?void 0:p[n])||"",l=(null==(a=c[n])?void 0:a[s])||s,d=yt(u[n])?u[n](l):l;return t[n]=P(d),d&&(D[r]=(D[r]||0)+1),t}),{})))),b=o&&[...D].map(((e,t)=>!e&&t)).filter(qe).reverse();if(b){let e=e=>e.filter(((e,t)=>!b.includes(t)));T=T.map(e),w=e(w)}let R=T.map((e=>e.join(f)));return a?R.map((e=>{let t=e.split(f);return Object.assign({},...t.map(((e,t)=>({[w[t]]:e}))))})):r?[w.map(P).join(f),...R].join(h):R.join(h)}function _O(e,t=".",i=[]){return"object"==typeof e&&Object.keys(e).reduce(((n,r)=>"object"!=typeof e[r]?(n[i.concat(r).join(t)]=e[r],n):Object.assign(n,_O(e[r],t,i.concat(r)))),{})}var{FACTORY:LO}=nc;function BO({timeStamp:e}){let t=Na(),i=ga();return i&&Object.values(t).forEach((t=>{!function({tournamentRecord:e,value:t}){let{extension:i}=Cd({element:e,name:LO});Sd({element:e,extension:{name:LO,value:{...null==i?void 0:i.value,...t}}})}({tournamentRecord:t,value:{version:"2.2.9",timeStamp:e}})})),i}function VO({engineType:e,methodName:t,elapsed:i,params:n,result:r}){var a,o;let s=aa();if("object"!=typeof s)return;let l={method:t},u=(null==r?void 0:r.error)&&(!0===s.errors||Array.isArray(s.errors)&&s.errors.includes(t)),d=Array.isArray(s.params)&&(null==(a=s.params)?void 0:a.includes(t)),c=s.params&&!Array.isArray(s.params)||d,p=Array.isArray(s.exclude)&&s.exclude.includes(t);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(u||c)&&(l.params=n),!p&&(u||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||d)||Array.isArray(s.result)&&null!=(o=s.result)&&o.includes(t))&&(l.result=r),Object.keys(l).length>1&&Fa(l,e)}function jO({methodName:e,params:t,start:i}){let n={error:Hr,methodName:e};return VO({result:n,methodName:e,elapsed:i?Date.now()-i:0,params:t,engineType:"sync"}),n}function GO(e,t,i,n,r){delete e.success,delete e.error;let a=Date.now(),o=ba();i&&(i.activeTournamentId=o);let s=(null==i?void 0:i.tournamentRecord)||Ra(o),l="object"==typeof(null==i?void 0:i.tournamentRecord)&&{[null==i?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Na(),u=i?ts(i,void 0,!0):void 0,d=i?function(e,t){var i;if(!1===t._middleware)return t;if(t.tournamentId&&!e[t.tournamentId])return{error:Bt};let n=t.drawId||(null==(i=t.matchUp)?void 0:i.drawId);if(n){let{event:i,drawDefinition:r,tournamentId:a}=Ch({tournamentRecords:e,drawId:n});r&&(t.drawDefinition=r),a&&(t.tournamentId=a),i&&(t.event=i)}if(t.eventId&&!t.event){let{event:i,tournamentId:n}=Ch({eventId:t.eventId,tournamentRecords:e});if(!i)return{error:Ri};t.tournamentId=n,t.event=i}let r=t.tournamentId??ba();if(!r&&t)return t;let a=e[r];return r&&!a?{error:Bt}:(a&&(t.tournamentRecord=a),t)}(l,i):void 0;if(null!=d&&d.error)return d;let c=function({tournamentRecords:e,tournamentRecord:t,params:i,methodName:n,method:r}){if(aa())return r({tournamentRecords:e,tournamentRecord:t,...i});try{return r({tournamentRecords:e,tournamentRecord:t,...i})}catch(a){return ka({engineName:"engine",methodName:n,params:i,err:a})}}({params:d,tournamentRecords:l,tournamentRecord:s,methodName:n,method:t});return VO({result:c,methodName:n,elapsed:Date.now()-a,params:u,engineType:r}),c}function $O(e){let{mutationStatus:t,tournamentId:i,directives:n,timeStamp:r}=e||{},{topics:a}=Pa();for(let o of[...a].sort(WO)){let e=ya({topic:o});null!=e&&e.length&&Ta({topic:o,notices:e})}t&&r&&a.includes(Ip)&&Ta({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:Ip})}var qO={[Dp]:5,[Pp]:5,[Tp]:5,[hp]:5,[fp]:5,[up]:5,[dp]:5,[cp]:5,[pp]:1,[Rp]:1,[mp]:5,[gp]:5,[lp]:4,[ap]:4,[op]:4,[sp]:4,[Zc]:3,[Qc]:2};function WO(e,t){return(qO[t]||0)-(qO[e]||0)}function HO(e,t=!0){return"object"!=typeof e||Array.isArray(e)?{error:Mr}:null!=e&&e.tournamentId?Ma(t?ts(e):e):{error:Cr}}function zO(e,t=!0){if("object"!=typeof e)return{error:Mr};if(Ea(),Array.isArray(e)){if(e.filter((e=>null==e?void 0:e.tournamentId)).length!==e.length)return{error:_t};e=Object.assign({},...e.map((e=>({[e.tournamentId]:e}))))}else if(null!=e&&e.tournamentId)Ea((e={[e.tournamentId]:e}).tournamentId);else if(!Object.keys(e).every((t=>e[t].tournamentId===t)))return{error:_t};return Aa(t?ts(e):e)}function YO(e,t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function KO(e,t){e.importMethods=(i,n,r,a)=>function(e,t,i,n,r,a){let o=xa(i,n,r,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter((e=>yt(s[e]))).forEach((i=>{e[i]=n=>{let r=()=>t(e,{[i]:s[i],...n});if(aa())return r();try{return r()}catch(a){ka({engineName:"engine",methodName:i,params:n,err:a})}}})),{...At,...e}}(e,t,i,n,r,a),e.getTournament=e=>function(e){let{convertExtensions:t=!1,removeExtensions:i=!1}=e??{},n=(null==e?void 0:e.tournamentId)??ba();return"string"!=typeof n?{}:{tournamentRecord:ts(Ra(n),t,!1,i)}}(e),e.getState=e=>function({convertExtensions:e,removeExtensions:t}){let i=Na();return{tournamentId:ba(),tournamentRecords:ts(i,e,!1,t)}}({convertExtensions:null==e?void 0:e.convertExtensions,removeExtensions:null==e?void 0:e.removeExtensions}),e.version=()=>"2.2.9",e.reset=()=>(Aa({}),YO(e)),e.devContext=t=>(la(t),YO(e)),e.getDevContext=e=>aa(e),e.newTournamentRecord=(e={})=>{let t=IA(e),i=t.tournamentId;return t.error?t:(HO(t),Ea(i),{...At,tournamentId:i})},e.setState=(t,i,n)=>{ca(i,n);let r=zO(t,i);return YO(e,r)},e.setTournamentId=e=>Ea(e),e.getTournamentId=()=>ba(),e.setTournamentRecord=(t,i,n)=>{ca(i,n);let r=HO(t,i);return YO(e,r)},e.removeTournamentRecord=t=>{let i=Ca(t);return YO(e,i)},e.removeUnlinkedTournamentRecords=()=>{let t=function(){var e;let t=Na(),{extension:i}=Cd({name:Wd,tournamentRecords:t,discover:!0}),n=(null==(e=null==i?void 0:i.value)?void 0:e.tournamentIds)||[];return Object.keys(t).forEach((e=>{n.includes(e)||delete t[e]})),Aa(t)}();return YO(e,t)}}function JO(e,t){if(!wt(t))return{error:Cr,message:"args must be an object"};let i=Object.values(t).filter(yt).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Cr};let n=i?Object.keys(t).find((e=>yt(t[e]))):St(t.method)&&t.method;if(!n)return{error:Hr};let{[n]:r,...a}=t,o=null!=t&&t.params?{...t.params}:{...a},s=o.rollbackOnError&&ts(Na(),!1,!0),l=r||e[n]||Xr()[n];if(!l)return jO({methodName:n,params:o});let u=GO(e,l,o,n,"sync")??{};null!=u&&u.error&&s&&zO(s);let d=Date.now(),c=BO({timeStamp:d}),p=(null==u?void 0:u.success)&&!0!==(null==o?void 0:o.delayNotify)&&!0!==(null==o?void 0:o.doNotNotify);return p&&$O({directives:[{method:l,params:o}],mutationStatus:c,timeStamp:d}),(p||!(null!=u&&u.success)||null!=o&&o.doNotNotify)&&wa(),u}var QO=(()=>{let e={executionQueue:(t,i)=>function(e,t,i){if(!Array.isArray(t))return{error:Cr,message:"directives must be an array"};let n=Ua(),r=Date.now(),a=i&&ts(Na(),!1,!0),o=[];for(let l of t){if("object"!=typeof l)return{error:Cr,message:"directive must be an object"};if(l.params&&"object"!=typeof l.params)return{error:Cr,message:"params must be an object"};let{method:t,pipe:i}=l,s=l.params?{...l.params}:{};if(!n[t])return jO({methodName:t,start:r,params:s});if(i){let e=o[o.length-1],t=Object.keys(i);for(let i of t)e[i]&&(s[i]=e[i])}let u=GO(e,n[t],s,t,"sync");if(null!=u&&u.error)return a&&zO(a),{...u,rolledBack:!!a};o.push({...u,methodName:t})}let s=Date.now();return $O({directives:t,mutationStatus:BO({timeStamp:s}),timeStamp:s}),wa(),{success:o.every((e=>e.success)),results:o}}(e,t,i),execute:t=>JO(e,t)};return KO(e,JO),e})(),ZO=QO;function XO(e,t){if(!wt(t))return{error:Cr,message:"args must be an object"};let i=Object.values(t).filter(yt).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Cr};let n=i?Object.keys(t).find((e=>yt(t[e]))):St(t.method)&&t.method;if(!n)return{error:Hr};let{[n]:r,...a}=t,o=null!=t&&t.params?{...t.params}:{...a},s=r||e[n]||Xr()[n];return s?GO(e,s,o,n,"ask"):jO({methodName:n,params:o})}(()=>{let e={execute:t=>XO(e,t)};KO(e,XO)})();var ek,tk={};function ik(e,t=!0){if(!e)return{error:un};if("object"!=typeof e)return{error:Mr};if(e.matchUpId)ek=e.matchUpId,tk[ek]=t?ts(e):e;else if(Array.isArray(e))for(let i of e.reverse())i.matchUpId&&(tk[i.matchUpId]=t?ts(i):i,ek||(ek=i.matchUpId));else for(let i of Object.values(e))i.matchUpId&&(tk[i.matchUpId]=t?ts(i):i,ek||(ek=i.matchUpId));return t?ts(e):e}(()=>{let e={getState:e=>function(e){return ts(tk[ek],null==e?void 0:e.convertExtensions,!1,null==e?void 0:e.removeExtensions)}(e),version:()=>"2.2.9",reset:()=>(ek=void 0,tk={},{...At}),drawId:void 0,error:void 0,success:!1,devContext:t=>(la(t),e),setState:(t,i,n)=>(ca(i,n),function(t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,e.drawId=t.drawId),e}(ik(t)))};return[Hw].forEach((i=>{Object.keys(i).forEach((n=>{e[n]=e=>{if(aa())return t({params:e,governor:i,methodName:n});try{return t({params:e,governor:i,methodName:n})}catch(r){ka({engineName:"matchUpEngine",methodName:n,params:e,err:r})}}}))})),e;function t({params:t,governor:i,methodName:n}){e.error=void 0,e.success=!1;let r=(null==t?void 0:t.matchUp)||tk[ek],a=(null==t?void 0:t.matchUps)||Object.values(tk),o=(null==t?void 0:t.rollbackOnError)&&ts(r,!1,!0);t={...t,matchUpId:null==r?void 0:r.matchUpId,matchUps:a,matchUp:r};let s=i[n](t);if(null!=s&&s.error)return o&&ik(o),{...s,rolledBack:!!o};let l=(null==s?void 0:s.success)&&!0!==(null==t?void 0:t.delayNotify)&&!0!==(null==t?void 0:t.doNotNotify);return l&&$O(),(l||!(null!=s&&s.success)||null!=t&&t.doNotNotify)&&wa(),s}})();var nk=!1;(()=>{let e={version:()=>"2.2.9",setDeepCopy:(t,i)=>(ca(t,i),e),devContext:t=>(la(t),nk=!0,e)};return[zM].forEach((i=>{Object.keys(i).forEach((n=>{e[n]=e=>{if(aa()){let r=t(i[n],e);return!(null!=r&&r.error)&&null!=e&&e.setState&&null!=r&&r.tournamentRecord&&zO(r.tournamentRecord),r}try{let r=t(i[n],e);return!(null!=r&&r.error)&&null!=e&&e.setState&&null!=r&&r.tournamentRecord&&zO(r.tournamentRecord),r}catch(r){let t;"string"==typeof r?t=r.toUpperCase():r instanceof Error&&(t=r.message),console.log("ERROR",{params:JSON.stringify(e),method:n,error:t})}}}))})),e;function t(e,t){let i=e({...t});return null!=i&&i.error||$O(),wa(),nk&&(la(!1),nk=!1),i}})(),ZO.importMethods(Re,!0,1);var rk=ZO,ak={...{getTournamentPoints:ET},...{calculateNewRatings:Ew,generateDynamicRatings:Ow}};ZO.importMethods(ak);var ok="Personal circumstance",sk={ratingsParameters:py,matchUpFormats:gs,countryToFlag:em,tieFormats:wR,countries:tm,policies:{POLICY_AVOIDANCE_COUNTRY:{[dd]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},POLICY_POSITION_ACTIONS_DEFAULT:OS,POLICY_POSITION_ACTIONS_DISABLED:{[nd]:{policyName:"positionActionsDisabled",enabledStructures:!1}},POLICY_POSITION_ACTIONS_NO_MOVEMENT:{[nd]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[NU,RU,MU],disabledActions:[]}]}},POLICY_POSITION_ACTIONS_UNRESTRICTED:{[nd]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[NU,TU]}},POLICY_PRIVACY_DEFAULT:{[sd]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},POLICY_ROUND_NAMING_DEFAULT:ff,POLICY_SCHEDULING_DEFAULT:Pb,POLICY_SCORING_DEFAULT:{[cd]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:hs,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[il]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[Uc]:[],[wc]:[],[Tc]:[],[Mc]:[],[Ec]:[],[kc]:[]}}},POLICY_SCORING_USTA:{[cd]:{requireAllPositionsAssigned:!1,stage:{[il]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:hs,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:hs,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[Uc]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[wc]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[Mc]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[Tc]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[kc]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:ok,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[Ec]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:ok,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[$m]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:ok,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},POLICY_SEEDING_ITF:{[pd]:{seedingProfile:{positioning:ml},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},POLICY_SEEDING_DEFAULT:nT},flagIOC:function(e){return em(Object.assign({},...tm.filter((e=>e.ioc)).map((e=>({[e.ioc]:e.iso}))))[e])}};be({},{activeMatchUpStatuses:()=>jc,auditConstants:()=>ER,completedMatchUpStatuses:()=>Vc,directingMatchUpStatuses:()=>Lc,displayConstants:()=>YT,drawDefinitionConstants:()=>tu,entryStatusConstants:()=>Km,errorConditionConstants:()=>Kr,eventConstants:()=>tl,extensionConstants:()=>nc,flightConstants:()=>lN,genderConstants:()=>qa,keyValueConstants:()=>QP,matchUpActionConstants:()=>nw,matchUpStatusConstants:()=>$c,matchUpTypes:()=>xe,nonDirectingMatchUpStatuses:()=>Bc,particicipantsRequiredMatchUpStatuses:()=>xc,participantConstants:()=>Zp,participantRoles:()=>mg,participantTypes:()=>Qp,penaltyConstants:()=>lk,policyConstants:()=>hd,positionActionConstants:()=>EU,ratingConstants:()=>cy,recoveryTimeRequiredMatchUpStatuses:()=>Fc,requestConstants:()=>tA,resourceContants:()=>es,resultConstants:()=>Ct,scaleConstants:()=>Qu,scheduleConstants:()=>fh,sortingConstants:()=>UN,surfaceConstants:()=>uk,tieFormatConstants:()=>Ws,timeItemConstants:()=>Qf,topicConstants:()=>Np,tournamentConstants:()=>YC,upcomingMatchUpStatuses:()=>Gc,validMatchUpStatuses:()=>_c,venueConstants:()=>dk,weekdayConstants:()=>VR});var lk={COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},uk={CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},dk={INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"};const ck=Z({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function pk({individualParticipant:e,composition:t,className:i,matchUp:n,spacer:r,side:a,type:o}){if("scale"===o)return function({individualParticipant:e,composition:t,className:i,matchUp:n,spacer:r}){var a,o,s,l,u,d,c;const p=null==t?void 0:t.configuration,m=(null==(a=null==p?void 0:p.scaleAttributes)?void 0:a.eventType)||(null==n?void 0:n.matchUpType)||"SINGLES",f=null==e?void 0:e.rankings,h=null==e?void 0:e.ratings,v=null==p?void 0:p.scaleAttributes,g=null==v?void 0:v.scaleType,I=null==v?void 0:v.scaleName,U=null==v?void 0:v.accessor,y="RATING"===g?h:f,S=null==(s=null==(o=null==y?void 0:y.SINGLES)?void 0:o.find((e=>(null==e?void 0:e.scaleName)===I)))?void 0:s.scaleValue,w=null==(u=null==(l=null==y?void 0:y.DOUBLES)?void 0:l.find((e=>(null==e?void 0:e.scaleName)===I)))?void 0:u.scaleValue,P=S&&U?S[U]:S||"",D=w&&U?w[U]:w||"",T="SINGLES"===m?P:D,b=null==(d=null==p?void 0:p.scaleAttributes)?void 0:d.fallback,R=!r&&(T||b&&(P||D)),N=document.createElement("span");return R&&(N.className=oe(i,De({color:null==(c=null==p?void 0:p.scaleAttributes)?void 0:c.scaleColor}))),N.innerHTML=R||"",N}({individualParticipant:e,composition:t,className:i,matchUp:n,spacer:r});const s=(null==t?void 0:t.configuration)||{},l=document.createElement("div");return"flag"===o&&s.flags&&function({matchUp:e,individualParticipant:t,spacer:i}){var n,r,a;const o=(null==(n=null==t?void 0:t.person)?void 0:n.iso2NationalityCode)||"",s=o?null==(r=sk.countryToFlag(o))?void 0:r.slice(0,4):"",l=document.createElement("span"),u=null==(a=null==e?void 0:e.matchUpType)?void 0:a.toLowerCase();return i||(l.className=ck({variant:u})),l.innerHTML=i?"":s,l}({className:i,matchUp:n,individualParticipant:e,spacer:r})||"seeding"===o&&function({className:e,composition:t,side:i}){const n="~"===(null==i?void 0:i.seedValue)?"":void 0!==(null==i?void 0:i.seedValue)&&i.seedValue||(null==i?void 0:i.seedNumber);if(!n)return"";const r=(null==t?void 0:t.configuration)||{},{bracketedSeeds:a}=r,o="boolean"==typeof a&&["(",")"]||"square"===a&&["[","]"]||["",""],s=`${o[0]}${n}${o[1]}`,l="sup"===r.seedingElement?"sup":"span",u=document.createElement(l);return u.className=e,u.innerHTML=s,u}({className:i,composition:t,matchUp:n,side:a})||l}const mk="Qualifier",fk="BYE",hk="TBD";function vk(e){var t,i,n,r;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:u,composition:d}=e||{},c=a?"winner":void 0,p=e.eventHandlers||{},m=null==d?void 0:d.configuration,f={QUALIFIER:(null==(t=null==m?void 0:m.placeHolders)?void 0:t.qualifier)||mk,BYE:(null==(i=null==m?void 0:m.placeHolders)?void 0:i.bye)||fk,TBD:(null==(n=null==m?void 0:m.placeHolders)?void 0:n.tbd)||hk},h=null==l?void 0:l.participantName,v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",null==l?void 0:l.participantId),v.onclick=e=>{ve(null==p?void 0:p.participantClick)&&(e.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:e,matchUp:u,side:o}))};const g=document.createElement("div");g.className=X({variant:c});const I=(null==m?void 0:m.flags)&&pk({...e,type:"flag"});if(I)g.appendChild(I);else{const t=pk({type:"scale",...e});t&&g.appendChild(t)}const U=document.createElement("div");if(U.className=ee({variant:c}),h){const e=document.createElement("span");if(a&&null!=m&&m.winnerColor)e.style.color="string"==typeof m.winnerColor?m.winnerColor:"green";else if(null!=m&&m.genderColor){const t=null==(r=null==l?void 0:l.person)?void 0:r.sex,i=("MALE"===t?"#2E86C1":"FEMALE"===t&&"#AA336A")||"";e.style.color="string"==typeof m.genderColor?m.genderColor:i}e.innerHTML=h,U.appendChild(e)}else{const e=document.createElement("abbr");e.className=function({variant:e}){return Z({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:e})}({variant:m.showAddress?"showAddress":""}),e.innerHTML=(null==o?void 0:o.bye)&&f.BYE||(null==o?void 0:o.qualifier)&&f.QUALIFIER||f.TBD,U.appendChild(e)}const y=pk({...e,className:Pe(),type:"seeding"});y&&U.appendChild(y),g.appendChild(U),v.appendChild(g);const S=we(e);return v.appendChild(S),{element:v}}const gk=Z({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});const Ik=Z({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});const Uk=Z({flexDirection:"column",position:"relative",display:"flex"}),yk=Z({alignItems:"stretch",display:"flex"}),Sk=Z({marginInlineEnd:".25rem",color:"green"});function wk({initialRoundNumber:e=1,eventHandlers:t,sideContainer:i,composition:n,participant:r,placeholder:a,sideNumber:o,matchUp:s}){var l,u,d;const{winningSide:c,matchUpType:p,isRoundRobin:m,matchUpStatus:f}=s||{},h=null==n?void 0:n.configuration;let v;const g=o?null==(l=null==s?void 0:s.sides)?void 0:l.find((e=>e.sideNumber===o)):void 0;r||(r=null==g?void 0:g.participant,v=null!=h&&h.allDrawPositions||null!=h&&h.drawPositions&&null!=g&&g.drawPosition&&((null==s?void 0:s.roundNumber)===e||null!=g&&g.participantFed||m)?null==g?void 0:g.drawPosition:"");const I="DOUBLES"===p,U=I?null==(u=null==r?void 0:r.individualParticipants)?void 0:u[0]:r,y=I&&(null==(d=null==r?void 0:r.individualParticipants)?void 0:d[1]),S=o===c||"BYE"===f&&r,w=(null==h?void 0:h.winnerChevron)&&S,P=null==h?void 0:h.teamLogo,D=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(f)&&!S,T=null==h?void 0:h.gameScoreOnly,b=document.createElement("div");if(b.className=i&&function({drawPosition:e,sideNumber:t}){return Z({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:t,css:e&&{"&:before":{backgroundColor:"$backgroundColor",content:`${e}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}({drawPosition:v,sideNumber:o}),b.classList.add("tmx-p"),b.setAttribute("id",null==r?void 0:r.participantId),P){const e=function({teamLogo:e}){console.log({teamLogo:e});const t=document.createElement("div");return t.className=Ik(),t}({teamLogo:P});b.appendChild(e)}const R=document.createElement("div");R.className=te({variant:I?"doubles":"singles"});const N=document.createElement("div");N.className=function({winnerChevron:e,isDoubles:t}){const i=2*(t?.4:.3);return Z({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:e?"winner":void 0})}({winnerChevron:w,isDoubles:I});const M=vk({individualParticipant:U,eventHandlers:t,isWinningSide:S,composition:n,sideNumber:o,matchUp:s,side:g}).element;if(N.appendChild(M),y){const e=vk({individualParticipant:y,eventHandlers:t,isWinningSide:S,composition:n,sideNumber:o,matchUp:s,side:g}).element;N.appendChild(e)}else I&&a&&function(e){return e instanceof Element||e}(a)&&N.appendChild(a);if(R.appendChild(N),b.appendChild(R),i){const e=document.createElement("div");if(S&&!T){const t=function({dim:e="20px"}={}){return`\n    <div style="line-height: 0;">\n      <svg height="${e}" viewBox="0 0 18 24" width="${e}" xmlns="http://www.w3.org/2000/svg" class="${Sk()}" style="fill: currentcolor;">\n        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>\n      </svg>\n    </div>\n  `}();"string"==typeof t?e.innerHTML=t:e.appendChild(t)}else if(D){const t=function({matchUpStatus:e}){const t=null==e?void 0:e.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(e)?"WO":(null==e?void 0:e.slice(0,3))||"",n=document.createElement("div");n.className=gk({variant:t});const r=document.createElement("abbr");return r.setAttribute("title",e),r.style.textDecoration="none",r.style.borderBottom="none",r.innerHTML=i,n.appendChild(r),n}({matchUpStatus:f});e.appendChild(t)}b.appendChild(e)}return b}const Pk=Z({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});const Dk=Z({flexDirection:"column",display:"flex"}),Tk=Z({flexDirection:"row",display:"flex"}),bk=Z({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),Rk=Z({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),Nk=Z({fontWeight:"bold",color:"blue",height:"1em"}),Mk=Z({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),Ak=Z({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});const Ek=Z({});const Ck=Z({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),Ok=Z({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),kk=Z({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function Fk({eventHandlers:e,entryStatus:t,sideNumber:i,className:n,matchUp:r}){const a=document.createElement("div");ve(null==e?void 0:e.centerInfoClick)&&(a.onclick=t=>e.centerInfoClick({matchUp:r,sideNumber:i,pointerEvent:t})),a.className=oe(function({variant:e}){return Z({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:e})}({variant:i}),n),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=Ck();const s=document.createElement("div");s.className=Ok();const l=document.createElement("div");l.className=kk(),l.innerHTML=t?"Entry status:&nbsp;":"",s.appendChild(l);const u=document.createElement("div");return u.className=kk(),u.innerHTML=t||"",s.appendChild(u),o.appendChild(s),a.appendChild(o),{element:a}}const xk={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};const _k=e=>Z({display:"flex",alignItems:"center",height:e,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),Lk=Z({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),Bk=Z({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),Vk=Z({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function jk({gameScoreOnly:e,scoreStripes:t,set:i,sideNumber:n}){const r=n===(null==i?void 0:i.winningSide)||null!=i&&i.winningSide?"loser":void 0,a=2===n?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=2===n?i.side2TiebreakScore:i.side1TiebreakScore,l=void 0===a&&s,u=l||a,d=t&&i.setNumber%2?"lightgray":"transparent";let c;if(i.editing?i.editing===n:void 0)c=function({value:e}={}){const t=document.createElement("input");return t.onclick=e=>e.target.select(),t.className=Bk(),t.value=e,t}({value:u});else if(c=document.createElement("p"),c.className=Bk({variant:r}),c.classList.add("tmx-st"),c.setAttribute("setNumber",i.setNumber),c.style.backgroundColor=d,c.innerHTML=isNaN(u)?"":u,!e){const e=document.createElement("span");e.className=Lk(),e.innerHTML=o&&!l?s:"",c.appendChild(e)}return c}const Gk=Z({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var $k={exports:{}};!function(e,t){e.exports=function(){var e=1e3,t=6e4,i=36e5,n="millisecond",r="second",a="minute",o="hour",s="day",l="week",u="month",d="quarter",c="year",p="date",m="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],i=e%100;return"["+e+(t[(i-20)%10]||t[i]||t[0])+"]"}},g=function(e,t,i){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(i)+e},I={s:g,z:function(e){var t=-e.utcOffset(),i=Math.abs(t),n=Math.floor(i/60),r=i%60;return(t<=0?"+":"-")+g(n,2,"0")+":"+g(r,2,"0")},m:function e(t,i){if(t.date()<i.date())return-e(i,t);var n=12*(i.year()-t.year())+(i.month()-t.month()),r=t.clone().add(n,u),a=i-r<0,o=t.clone().add(n+(a?-1:1),u);return+(-(n+(i-r)/(a?r-o:o-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:c,w:l,d:s,D:p,h:o,m:a,s:r,ms:n,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},U="en",y={};y[U]=v;var S="$isDayjsObject",w=function(e){return e instanceof b||!(!e||!e[S])},P=function e(t,i,n){var r;if(!t)return U;if("string"==typeof t){var a=t.toLowerCase();y[a]&&(r=a),i&&(y[a]=i,r=a);var o=t.split("-");if(!r&&o.length>1)return e(o[0])}else{var s=t.name;y[s]=t,r=s}return!n&&r&&(U=r),r||!n&&U},D=function(e,t){if(w(e))return e.clone();var i="object"==typeof t?t:{};return i.date=e,i.args=arguments,new b(i)},T=I;T.l=P,T.i=w,T.w=function(e,t){return D(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var b=function(){function v(e){this.$L=P(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[S]=!0}var g=v.prototype;return g.parse=function(e){this.$d=function(e){var t=e.date,i=e.utc;if(null===t)return new Date(NaN);if(T.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(f);if(n){var r=n[2]-1||0,a=(n[7]||"0").substring(0,3);return i?new Date(Date.UTC(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)):new Date(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)}}return new Date(t)}(e),this.init()},g.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},g.$utils=function(){return T},g.isValid=function(){return this.$d.toString()!==m},g.isSame=function(e,t){var i=D(e);return this.startOf(t)<=i&&i<=this.endOf(t)},g.isAfter=function(e,t){return D(e)<this.startOf(t)},g.isBefore=function(e,t){return this.endOf(t)<D(e)},g.$g=function(e,t,i){return T.u(e)?this[t]:this.set(i,e)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(e,t){var i=this,n=!!T.u(t)||t,d=T.p(e),m=function(e,t){var r=T.w(i.$u?Date.UTC(i.$y,t,e):new Date(i.$y,t,e),i);return n?r:r.endOf(s)},f=function(e,t){return T.w(i.toDate()[e].apply(i.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),i)},h=this.$W,v=this.$M,g=this.$D,I="set"+(this.$u?"UTC":"");switch(d){case c:return n?m(1,0):m(31,11);case u:return n?m(1,v):m(0,v+1);case l:var U=this.$locale().weekStart||0,y=(h<U?h+7:h)-U;return m(n?g-y:g+(6-y),v);case s:case p:return f(I+"Hours",0);case o:return f(I+"Minutes",1);case a:return f(I+"Seconds",2);case r:return f(I+"Milliseconds",3);default:return this.clone()}},g.endOf=function(e){return this.startOf(e,!1)},g.$set=function(e,t){var i,l=T.p(e),d="set"+(this.$u?"UTC":""),m=(i={},i[s]=d+"Date",i[p]=d+"Date",i[u]=d+"Month",i[c]=d+"FullYear",i[o]=d+"Hours",i[a]=d+"Minutes",i[r]=d+"Seconds",i[n]=d+"Milliseconds",i)[l],f=l===s?this.$D+(t-this.$W):t;if(l===u||l===c){var h=this.clone().set(p,1);h.$d[m](f),h.init(),this.$d=h.set(p,Math.min(this.$D,h.daysInMonth())).$d}else m&&this.$d[m](f);return this.init(),this},g.set=function(e,t){return this.clone().$set(e,t)},g.get=function(e){return this[T.p(e)]()},g.add=function(n,d){var p,m=this;n=Number(n);var f=T.p(d),h=function(e){var t=D(m);return T.w(t.date(t.date()+Math.round(e*n)),m)};if(f===u)return this.set(u,this.$M+n);if(f===c)return this.set(c,this.$y+n);if(f===s)return h(1);if(f===l)return h(7);var v=(p={},p[a]=t,p[o]=i,p[r]=e,p)[f]||1,g=this.$d.getTime()+n*v;return T.w(g,this)},g.subtract=function(e,t){return this.add(-1*e,t)},g.format=function(e){var t=this,i=this.$locale();if(!this.isValid())return i.invalidDate||m;var n=e||"YYYY-MM-DDTHH:mm:ssZ",r=T.z(this),a=this.$H,o=this.$m,s=this.$M,l=i.weekdays,u=i.months,d=i.meridiem,c=function(e,i,r,a){return e&&(e[i]||e(t,n))||r[i].slice(0,a)},p=function(e){return T.s(a%12||12,e,"0")},f=d||function(e,t,i){var n=e<12?"AM":"PM";return i?n.toLowerCase():n};return n.replace(h,(function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return T.s(t.$y,4,"0");case"M":return s+1;case"MM":return T.s(s+1,2,"0");case"MMM":return c(i.monthsShort,s,u,3);case"MMMM":return c(u,s);case"D":return t.$D;case"DD":return T.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return c(i.weekdaysMin,t.$W,l,2);case"ddd":return c(i.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(a);case"HH":return T.s(a,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return f(a,o,!0);case"A":return f(a,o,!1);case"m":return String(o);case"mm":return T.s(o,2,"0");case"s":return String(t.$s);case"ss":return T.s(t.$s,2,"0");case"SSS":return T.s(t.$ms,3,"0");case"Z":return r}return null}(e)||r.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(n,p,m){var f,h=this,v=T.p(p),g=D(n),I=(g.utcOffset()-this.utcOffset())*t,U=this-g,y=function(){return T.m(h,g)};switch(v){case c:f=y()/12;break;case u:f=y();break;case d:f=y()/3;break;case l:f=(U-I)/6048e5;break;case s:f=(U-I)/864e5;break;case o:f=U/i;break;case a:f=U/t;break;case r:f=U/e;break;default:f=U}return m?f:T.a(f)},g.daysInMonth=function(){return this.endOf(u).$D},g.$locale=function(){return y[this.$L]},g.locale=function(e,t){if(!e)return this.$L;var i=this.clone(),n=P(e,t,!0);return n&&(i.$L=n),i},g.clone=function(){return T.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},v}(),R=b.prototype;return D.prototype=R,[["$ms",n],["$s",r],["$m",a],["$H",o],["$W",s],["$M",u],["$y",c],["$D",p]].forEach((function(e){R[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),D.extend=function(e,t){return e.$i||(e(t,b,D),e.$i=!0),D},D.locale=P,D.isDayjs=w,D.unix=function(e){return D(1e3*e)},D.en=y[U],D.Ls=y,D.p={},D}()}($k);const qk=ne($k.exports);function Wk({initialRoundNumber:e=1,eventHandlers:t,composition:i,sideNumber:n,className:r,matchUp:a}){var o,s;const l=(null==i?void 0:i.configuration)||{},u=null==l?void 0:l.scheduleInfo,d=null==(o=null==a?void 0:a.score)?void 0:o.scoreStringSide1,c=(null==(s=null==i?void 0:i.configuration)?void 0:s.scoreBox)&&d,p=(null==a?void 0:a.readyToScore)&&(null==t?void 0:t.scoreClick)&&!rk.checkScoreHasValue({matchUp:a}),m=document.createElement("div");if(m.className=oe(Uk(),r),m.classList.add("tmx-sd"),m.setAttribute("sideNumber",n),u&&1===n){const e=function({matchUp:e,eventHandlers:t}){const{scheduledTime:i,scheduledDate:n,venueAbbreviation:r,courtName:a}=(null==e?void 0:e.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=MO,l=s(i);let u=o(n),d="ddd D MMMM";l&&(d+=", hh:mm A",u+=`T${l}`);const c=n?qk(u).format(d):"Not scheduled",p=r&&(null==a?void 0:a.toString().startsWith(r))&&a||r&&a&&`${r} ${a}`||a||r||"",m=document.createElement("div");m.className=Gk(),m.classList.add("tmx-sch"),ve(null==t?void 0:t.scheduleClick)&&(m.onclick=i=>t.scheduleClick({matchUp:e,pointerEvent:i}));const f=document.createElement("div");f.innerHTML=c,m.append(f);const h=document.createElement("div");h.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=i=>{ve(null==t?void 0:t.venueClick)&&(i.stopPropagation(),t.venueClick({pointerEvent:i,matchUp:e}))},v.innerHTML=p,h.append(v),m.append(h),m.onclick){const e=document.createElement("div");e.innerHTML="\u22ee",h.append(e)}return m}({matchUp:a,eventHandlers:t});m.appendChild(e)}const f=document.createElement("div");f.className=yk();const h=wk({sideContainer:!0,initialRoundNumber:e,eventHandlers:t,composition:i,sideNumber:n,matchUp:a});if(f.appendChild(h),c){const e=document.createElement("div");e.style.border="1px solid lightgray",f.appendChild(e)}if(d){const e=function({participantHeight:e,eventHandlers:t,composition:i,sideNumber:n,matchUp:r}){var a,o,s,l;const u=null==(a=null==i?void 0:i.configuration)?void 0:a.winnerChevron,d=null==(o=null==i?void 0:i.configuration)?void 0:o.gameScoreOnly,c=(null==(s=null==r?void 0:r.score)?void 0:s.sets)||[],p=null==(l=null==i?void 0:i.configuration)?void 0:l.scoreBox,m=_k(2===n?e:e-1),f=document.createElement("div");f.className=m({sideNumber:!p&&n,fontSize:"5px"}),f.classList.add("sideScore"),f.classList.add("tmx-scr"),f.onclick=e=>{ve(null==t?void 0:t.scoreClick)&&(e.stopPropagation(),t.scoreClick({pointerEvent:e,matchUp:r}))};const h=document.createElement("div");h.className=Vk();for(const v of c||[]){const e=jk({gameScoreOnly:d,scoreStripes:u,sideNumber:n,set:v});h.appendChild(e)}return f.appendChild(h),f}({eventHandlers:t,composition:i,sideNumber:n,matchUp:a});f.appendChild(e)}if(p){const e=_k(),i=e=>{ve(null==t?void 0:t.scoreClick)&&(event.stopPropagation(),t.scoreClick({pointerEvent:e,matchUp:a}))},r=document.createElement("div");r.className=e({sideNumber:!c&&n,fontSize:"small"}),r.onclick=i,r.innerHTML="[Score]",f.appendChild(r)}return m.appendChild(f),m}function Hk(e){const{composition:t,initialRoundNumber:i=1,matchUp:n,moiety:r,selectedMatchUpId:a,searchActive:o}=e,{roundFactor:s,roundNumber:l,finishingRound:u,matchUpType:d,preFeedRound:c,stage:p}=n,m=e.isFinalRound||1===parseInt(u),f="QUALIFYING"===p&&m,h=m,v=parseInt(l)===i,g="DOUBLES"===d,I=(o||n.isRoundRobin||n.collectionId||e.isLucky||e.isAdHoc?"mr":h&&"noProgression")||(f||c)&&"m0"||r&&"m1"||"m2",U=function({composition:e,isDoubles:t,roundFactor:i=1}){const n=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),r=(null==e?void 0:e.configuration)||{},a=(null==r?void 0:r.connectorWidth)||16,o=r.centerInfo?xk.centerInfo*n:0,s=r.scheduleInfo?xk.scheduleInfo*n:0,l=(60+(r.showAddress?n:0))*(t?1.3:1)+o;return Z({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:l*i,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:(l+s)*i}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}({composition:t,isDoubles:g,roundFactor:s})({isFirstRound:v,link:I}),y=(null==t?void 0:t.configuration)||{},{resultsInfo:S,centerInfo:w}=y||{},P=e.eventHandlers||{},D=document.createElement("div");D.className=oe(t.theme,null==e?void 0:e.className,"matchup",Ek()),D.classList.add("tmx-m"),D.setAttribute("id",null==n?void 0:n.matchUpId),D.onclick=e=>{ve(null==P?void 0:P.matchUpClick)&&P.matchUpClick({pointerEvent:e,matchUp:n})};const T=document.createElement("div");T.className=function({configuration:e}){const t={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(null!=e&&e.matchUpHover){const i="string"==typeof e.matchUpHover?e.matchUpHover:"cyan";t["&:hover"]={backgroundColor:i}}else t["&:hover"]={borderColor:"$borderHover"};return Z(t)}({configuration:y});const b=({sideNumber:e})=>{var t,i,r;const a=null==(r=null==(i=null==(t=null==n?void 0:n.sides.find((t=>t.sideNumber===e)))?void 0:t.participant)?void 0:i.entryStatus)?void 0:r.replace("_"," ");return Fk({eventHandlers:P,entryStatus:a,sideNumber:e,className:2===e&&U,matchUp:n})},R=Wk({initialRoundNumber:i,eventHandlers:P,sideNumber:1,composition:t,matchUp:n}),N=Wk({className:!w&&U,initialRoundNumber:i,eventHandlers:P,sideNumber:2,composition:t,matchUp:n});if(T.appendChild(R),w){const e=b({sideNumber:1}),t=b({sideNumber:2});T.appendChild(e.element),T.appendChild(t.element)}if(T.appendChild(N),S){const e=function({score:e}){var t;const i=null==(t=null==e?void 0:e.sets)?void 0:t.filter(Boolean).sort(((e,t)=>(e.setNumber||0)-(t.setNumber||0))),n=null==i?void 0:i[i.length-1],r=(null==n?void 0:n.side1PointsScore)||(null==n?void 0:n.side2PointsScore),a=document.createElement("div");if(a.className=Ak(),r){const e=document.createElement("div");e.className=Mk({variant:"points"}),e.innerHTML="PTS",a.appendChild(e)}for(const o of i||[]){const e=document.createElement("div");e.setAttribute("key",o.setNumber),e.className=Mk({variant:"set"}),e.innerHTML=o.setNumber,a.appendChild(e)}return a}({score:n.score});T.appendChild(e)}if(D.appendChild(T),a===n.matchUpId){const e=document.createElement("div");e.className=Z({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0}),D.appendChild(e)}return D}function zk({initialRoundNumber:e=1,selectedMatchUpId:t,eventHandlers:i,isFinalRound:n,isRoundRobin:r,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:u,minWidth:d,matchUps:c,context:p,isLucky:m}){const f=c.filter((e=>e.roundNumber===l)).sort(((e,t)=>(e.roundPosition||0)-(t.roundPosition||0))),h=f.every((({roundPosition:e,drawPositions:t})=>!e&&!t)),v=(null==o?void 0:o.configuration)||{},g=document.createElement("div");if(g.className=Dk(),g.classList.add("tmx-rd"),g.setAttribute("roundNumber",l),v.roundHeader){const e=function({eventHandlers:e,roundMatchUps:t,roundProfile:i,roundNumber:n,context:r}){var a;const o=document.createElement("div");o.className=Pk(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",n);const s=ve(null==e?void 0:e.roundHeaderClick);s&&(o.onclick=a=>e.roundHeaderClick({roundNumber:n,roundProfile:i,roundMatchUps:t,context:r,pointerEvent:a}));const l=s?"\u22ee":"",u=null==(a=null==i?void 0:i[n])?void 0:a.roundName,d=u&&` <div style="display: flex; flex-direction: row; justify-content: space-between">\n        <div>${u}</div>\n        <div style="font-weight: bold">${l}</div>\n      </div>\n  `;return o.innerHTML=d||"",o}({roundProfile:u,roundMatchUps:f,roundNumber:l,eventHandlers:i,context:p});g.appendChild(e)}const I=document.createElement("div");let U,y,S;if(I.className=bk({variant:h?"adHoc":void 0}),d&&(I.style.minWidth=d),r){const e=e=>e.reduce(((e,t)=>t+e),0);f.sort(((t,i)=>{const n=e(t.drawPositions)-e(i.drawPositions),r=Math.min(...t.drawPositions??[])-Math.min(...i.drawPositions??[]);return n||r}));const t=f.reduce(((e,t)=>(e[t.structureId]=t.structureName,e)),{});U=Object.values(t),y=Object.keys(t),S=Object.keys(MO.instanceCount(f.map((({structureId:e})=>e)))).length}else h&&f.sort(((e,t)=>(e.roundOrder??0)-(t.roundOrder??0)));const w=S&&f.length/S,P=Object.keys(u).map((e=>parseInt(e))),D=P.indexOf(l),T=0===D?"first":D===P.length-1&&"last";return f.forEach(((r,u)=>{const d=w&&!(u%w),c=w&&Math.floor(u/w),p=w&&U[c];if(d){const t=document.createElement("div");t.className=Rk({variant:c,roundOrder:T}),I.appendChild(t);const n=document.createElement("div");if(n.className=Nk(),ve(null==i?void 0:i.groupHeaderClick)){const{drawId:e,containerStructureId:t}=f[0];I.onclick=n=>i.groupHeaderClick({structureId:y[c],containerStructureId:t,pointerEvent:n,drawId:e})}l===e&&(n.innerHTML=p),I.appendChild(n)}const v=u%2==0;s?r.roundFactor=s:e>1&&(r.roundFactor=Math.pow(2,l-e));const g=Hk({initialRoundNumber:e,selectedMatchUpId:t,eventHandlers:i,isFinalRound:n,searchActive:a,composition:o,isAdHoc:h,isLucky:m,matchUp:r,moiety:v});I.appendChild(g)})),g.appendChild(I),g}function Yk({initialRoundNumber:e=1,selectedMatchUpId:t,eventHandlers:i,searchActive:n,composition:r,structureId:a,finalColumn:o,matchUps:s,minWidth:l,context:u}){var d;const{roundNumbers:c,roundProfile:p,hasOddMatchUpsCount:m,isNotEliminationStructure:f}=rk.getRoundMatchUps({matchUps:s});a=a||(null==u?void 0:u.structureId)||(null==(d=null==s?void 0:s[0])?void 0:d.structureId);const h=s.some((({isRoundRobin:e})=>e)),v=m||f,g=document.createElement("div");g.className=Tk(),g.classList.add("tmx-str"),g.setAttribute("id",a);const I=Math.max(...c);for(const U of c){if(U<e)continue;const a=zk({initialRoundNumber:e,selectedMatchUpId:t,eventHandlers:i,isFinalRound:U===I,isRoundRobin:h,searchActive:n,composition:r,roundNumber:U,roundProfile:p,matchUps:s,minWidth:l,context:u,isLucky:v});g.appendChild(a)}if(o){const e=document.createElement("div");e.className=Dk();const t=document.createElement("div");t.className=bk(),t.appendChild(o),e.appendChild(t),g.appendChild(e)}return g}Z({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});const{createTheme:Kk}=Q({theme:{lineHeights:{scheduleInfo:`${xk.scheduleInfo}rem`,centerInfo:`${xk.centerInfo}rem`,gameScore:`${xk.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),Jk=Kk("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),Qk=Kk("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),Zk=Kk("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),Xk=Kk("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),eF=Kk("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),tF=Kk("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),iF={Australian:{configuration:{flags:!0},theme:Jk},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:eF},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:eF},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:Zk},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:Qk},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:Xk},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:Kk("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}})},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:Jk},Night:{configuration:{flags:!0},theme:tF}}}}]);