"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[1117],{9249(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"scale-engine/ranking-points-pipeline","title":"Ranking Points Pipeline","description":"The ranking points pipeline transforms tournament results into granular point awards. This page documents how getTournamentPoints processes each participant\'s tournament performance.","source":"@site/docs/scale-engine/ranking-points-pipeline.md","sourceDirName":"scale-engine","slug":"/scale-engine/ranking-points-pipeline","permalink":"/competition-factory/docs/scale-engine/ranking-points-pipeline","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Ranking Points Pipeline"},"sidebar":"docs","previous":{"title":"Core API Reference","permalink":"/competition-factory/docs/scale-engine/scale-engine-api"},"next":{"title":"Quality Win Points","permalink":"/competition-factory/docs/scale-engine/quality-win-points"}}');var r=i(6070),t=i(8322);const c={title:"Ranking Points Pipeline"},l=void 0,d={},o=[{value:"Pipeline Overview",id:"pipeline-overview",level:2},{value:"Profile Selection",id:"profile-selection",level:2},{value:"Specificity Scoring",id:"specificity-scoring",level:3},{value:"CategoryScope Matching",id:"categoryscope-matching",level:3},{value:"Position Points",id:"position-points",level:2},{value:"The Accessor",id:"the-accessor",level:3},{value:"Position Value Resolution",id:"position-value-resolution",level:3},{value:"Multi-Structure Draws",id:"multi-structure-draws",level:3},{value:"Per-Win Points",id:"per-win-points",level:2},{value:"Simple Per-Win",id:"simple-per-win",level:3},{value:"Level-Keyed Per-Win",id:"level-keyed-per-win",level:3},{value:"maxCountableMatches",id:"maxcountablematches",level:3},{value:"Bonus Points",id:"bonus-points",level:2},{value:"Doubles Attribution",id:"doubles-attribution",level:2},{value:"PointAward Output",id:"pointaward-output",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["The ranking points pipeline transforms tournament results into granular point awards. This page documents how ",(0,r.jsx)(n.code,{children:"getTournamentPoints"})," processes each participant's tournament performance."]}),"\n",(0,r.jsx)(n.h2,{id:"pipeline-overview",children:"Pipeline Overview"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Tournament Record\n       |\n       v\n  1. Policy Resolution      Find POLICY_TYPE_RANKING_POINTS\n       |\n       v\n  2. Participant Hydration   getParticipants({ withRankingProfile: true })\n       |                     -> structureParticipation per draw\n       v\n  3. Per-Draw Processing     For each draw a participant entered:\n       |\n       +-> 3a. Profile Selection   getAwardProfile (specificity scoring)\n       +-> 3b. Position Points     finishingPositionRanges[accessor]\n       +-> 3c. Per-Win Points      pointsPerWin or perWinPoints (level-keyed)\n       +-> 3d. Bonus Points        champion/finalist bonusPoints\n       +-> 3e. Quality Wins        getQualityWinPoints (ranked opponent bonus)\n       +-> 3f. Doubles Attribution pair -> individual point distribution\n       |\n       v\n  4. Output                  personPoints, pairPoints, teamPoints\n"})}),"\n",(0,r.jsx)(n.h2,{id:"profile-selection",children:"Profile Selection"}),"\n",(0,r.jsxs)(n.p,{children:["When a participant has a ",(0,r.jsx)(n.code,{children:"structureParticipation"})," entry, ",(0,r.jsx)(n.code,{children:"getAwardProfile"})," finds the best matching ",(0,r.jsx)(n.code,{children:"awardProfile"})," from the policy."]}),"\n",(0,r.jsx)(n.h3,{id:"specificity-scoring",children:"Specificity Scoring"}),"\n",(0,r.jsxs)(n.p,{children:["Profiles are scored by counting their populated scope fields. A profile that specifies ",(0,r.jsx)(n.code,{children:"drawTypes"}),", ",(0,r.jsx)(n.code,{children:"levels"}),", and ",(0,r.jsx)(n.code,{children:"maxDrawSize"})," (score 3) beats a catch-all profile with no scope constraints (score 0)."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Scored fields"})," (1 point each):"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Field"}),(0,r.jsx)(n.th,{children:"Matches Against"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"eventTypes"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"event.eventType"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"drawTypes"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"drawDefinition.drawType"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"drawSizes"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"drawDefinition.drawSize"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"maxDrawSize"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"drawDefinition.drawSize <= maxDrawSize"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"stages"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"structureParticipation.rankingStage"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"stageSequences"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"structureParticipation.stageSequence"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"levels"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"level"})," parameter"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"maxLevel"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"level <= maxLevel"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"flights"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"structureParticipation.flightNumber"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"maxFlightNumber"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"flightNumber <= maxFlightNumber"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"participationOrder"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"structureParticipation.participationOrder"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"dateRanges"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"startDate"}),"/",(0,r.jsx)(n.code,{children:"endDate"})," within range"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"category.*"})}),(0,r.jsx)(n.td,{children:"Each populated CategoryScope field"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Priority override:"})," If any matching profile has an explicit ",(0,r.jsx)(n.code,{children:"priority"})," number, the highest priority wins regardless of specificity score."]}),"\n",(0,r.jsx)(n.h3,{id:"categoryscope-matching",children:"CategoryScope Matching"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"category"})," field on an ",(0,r.jsx)(n.code,{children:"awardProfile"})," uses ",(0,r.jsx)(n.code,{children:"CategoryScope"})," to match against the event's competitive context:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"category: {\n  ageCategoryCodes: ['U18'],        // event.category.ageCategoryCode\n  genders: ['MALE'],                // event.gender\n  categoryNames: ['Junior'],        // event.category.categoryName\n  categoryTypes: ['AGE'],           // event.category.type\n  ratingTypes: ['WTN'],             // event.category.ratingType\n  ballTypes: ['GREEN'],             // event.category.ballType\n  wheelchairClasses: ['QUAD'],      // event.wheelchairClass\n  subTypes: ['ADVANCED'],           // event.category.subType\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Each field uses contains semantics: if the scope field is present, the event value must be in the array. Absent fields match everything."}),"\n",(0,r.jsx)(n.h2,{id:"position-points",children:"Position Points"}),"\n",(0,r.jsxs)(n.p,{children:["Position points are determined by the participant's ",(0,r.jsx)(n.a,{href:"/docs/concepts/finishing-positions",children:(0,r.jsx)(n.code,{children:"finishingPositionRange"})})," \u2014 a numeric range representing where they finished in the draw structure."]}),"\n",(0,r.jsx)(n.h3,{id:"the-accessor",children:"The Accessor"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const accessor = Math.max(...finishingPositionRange);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The accessor is used to look up points in the profile's ",(0,r.jsx)(n.code,{children:"finishingPositionRanges"}),":"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Finish"}),(0,r.jsx)(n.th,{children:"finishingPositionRange"}),(0,r.jsx)(n.th,{children:"accessor"}),(0,r.jsx)(n.th,{children:"Policy key"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Champion"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[1, 1]"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"1"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Runner-up"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[2, 2]"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"2"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SF losers (no 3-4 playoff)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[3, 4]"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"4"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"4"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"3rd place (with playoff)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[3, 3]"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"3"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"3"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"QF losers"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[5, 8]"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"8"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"8"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"R16 losers"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"[9, 16]"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"16"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"16"})})]})]})]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["In draws without a 3rd-place playoff (standard single elimination), both semifinal losers get ",(0,r.jsx)(n.code,{children:"finishingPositionRange: [3, 4]"})," and accessor ",(0,r.jsx)(n.code,{children:"4"}),". Set the key ",(0,r.jsx)(n.code,{children:"4"}),' value to your intended "semifinal loser" points.']})}),"\n",(0,r.jsx)(n.h3,{id:"position-value-resolution",children:"Position Value Resolution"}),"\n",(0,r.jsx)(n.p,{children:"The value at each policy key can be:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Simple number"}),": ",(0,r.jsx)(n.code,{children:"{ 1: 1000 }"})," \u2014 1000 points regardless of level"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Level-keyed"}),": ",(0,r.jsx)(n.code,{children:"{ 1: { level: { 1: 1000, 2: 500, 3: 300 } } }"})," \u2014 varies by tournament level"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Draw size threshold"}),": ",(0,r.jsx)(n.code,{children:"{ 1: [{ threshold: 16, value: 800 }, { threshold: 32, value: 1000 }] }"})," \u2014 varies by draw size"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Flight-specific"}),": ",(0,r.jsx)(n.code,{children:"{ 1: { flights: { 1: 1000, 2: 500 } } }"})," \u2014 varies by flight number"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"multi-structure-draws",children:"Multi-Structure Draws"}),"\n",(0,r.jsxs)(n.p,{children:["For draws with multiple structures (FIC, Curtis Consolation, Compass), participants may have ",(0,r.jsx)(n.code,{children:"structureParticipation"})," entries in multiple structures. The pipeline iterates all entries and takes the ",(0,r.jsx)(n.strong,{children:"maximum position points"})," across structures (see ",(0,r.jsx)(n.a,{href:"/docs/concepts/finishing-positions#multi-structure-draws",children:"Multi-Structure Draws"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Main draw R2 loser:      accessor 24 -> 75 pts\nConsolation SF finisher:  accessor 12 -> 150 pts\nFinal position points:    150 pts (consolation finish is better)\n"})}),"\n",(0,r.jsx)(n.p,{children:"This happens automatically \u2014 no special policy configuration is needed for multi-structure draws."}),"\n",(0,r.jsx)(n.h2,{id:"per-win-points",children:"Per-Win Points"}),"\n",(0,r.jsxs)(n.p,{children:["Per-win points are awarded when a participation has no position points (the accessor doesn't match any ",(0,r.jsx)(n.code,{children:"finishingPositionRanges"})," key) or through a dedicated per-win config."]}),"\n",(0,r.jsx)(n.h3,{id:"simple-per-win",children:"Simple Per-Win"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"awardProfile: {\n  pointsPerWin: 60, // flat value per match won\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"level-keyed-per-win",children:"Level-Keyed Per-Win"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"awardProfile: {\n  perWinPoints: {\n    level: { 1: 300, 2: 225, 3: 150 }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"maxcountablematches",children:"maxCountableMatches"}),"\n",(0,r.jsx)(n.p,{children:"Caps the number of wins counted for per-win points per participant per draw:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"awardProfile: {\n  maxCountableMatches: 5,\n  // or level-keyed:\n  maxCountableMatches: { level: { 3: 5, 4: 4 } },\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"When a participant has wins across multiple structures (e.g., qualifying + main draw), the cap applies cumulatively across all participations sharing the same award profile."}),"\n",(0,r.jsx)(n.h2,{id:"bonus-points",children:"Bonus Points"}),"\n",(0,r.jsx)(n.p,{children:"Champion and finalist bonuses based on the participant's best finishing position across all structures in a draw:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"awardProfile: {\n  bonusPoints: [\n    { finishingPositions: [1], value: { level: { 6: 50, 7: 25 } } },\n    { finishingPositions: [2], value: { level: { 6: 30, 7: 15 } } },\n  ],\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"bestFinishingPosition"})," is ",(0,r.jsx)(n.code,{children:"Math.min(finishingPositionRange)"})," \u2014 the best position the participant could have achieved."]}),"\n",(0,r.jsx)(n.h2,{id:"doubles-attribution",children:"Doubles Attribution"}),"\n",(0,r.jsx)(n.p,{children:"Controls how pair (doubles) points flow to individual participants:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"rankingPolicy: {\n  doublesAttribution: 'fullToEach', // or 'splitEven'\n}\n"})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Mode"}),(0,r.jsx)(n.th,{children:"Effect"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"'fullToEach'"})}),(0,r.jsx)(n.td,{children:"Each individual receives 100% of pair points"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"'splitEven'"})}),(0,r.jsx)(n.td,{children:"Each individual receives 50% of pair points (rounded)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Not set"}),(0,r.jsx)(n.td,{children:"Points only on pair record, not distributed to individuals"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"pointaward-output",children:"PointAward Output"}),"\n",(0,r.jsxs)(n.p,{children:["Each award in ",(0,r.jsx)(n.code,{children:"personPoints"})," contains a granular breakdown:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"{\n  positionPoints: 500,       // from finishingPositionRanges\n  perWinPoints: 225,         // from per-win config\n  bonusPoints: 50,           // from bonusPoints config\n  points: 775,               // total: position + perWin + bonus\n  winCount: 3,               // total wins in this draw\n  rangeAccessor: 4,          // finishingPositionRange accessor used\n  eventType: 'SINGLES',\n  drawId: 'draw-abc',\n  drawType: 'SINGLE_ELIMINATION',\n  category: { ageCategoryCode: 'U18' },\n  level: 3,\n  startDate: '2025-06-01',\n  endDate: '2025-06-07',\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./scale-engine-overview",children:"Scale Engine Overview"})})," \u2014 Introduction and architecture"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./scale-engine-api",children:"Core API Reference"})})," \u2014 Complete method reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./quality-win-points",children:"Quality Win Points"})})," \u2014 Quality win bonus system"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/docs/policies/rankingPolicy",children:"Ranking Policy"})})," \u2014 Full policy structure reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/docs/governors/ranking-governor",children:"Ranking Governor"})})," \u2014 Stateless function reference"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8322(e,n,i){i.d(n,{R:()=>c,x:()=>l});var s=i(758);const r={},t=s.createContext(r);function c(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);