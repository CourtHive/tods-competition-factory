/*! For license information please see 88.d464cdcc.js.LICENSE.txt */
"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[88],{462:(e,t,i)=>{i.d(t,{Z:()=>a});var n=i(1258),r=i(8433);function a(e){let{children:t,fallback:i}=e;return(0,r.Z)()?n.createElement(n.Fragment,null,t?.()):i??null}},5353:(e,t,i)=>{i.d(t,{Ex:()=>HO,K:()=>_O});var n,r="colors",a="sizes",o="space",s={gap:o,gridGap:o,columnGap:o,gridColumnGap:o,rowGap:o,gridRowGap:o,inset:o,insetBlock:o,insetBlockEnd:o,insetBlockStart:o,insetInline:o,insetInlineEnd:o,insetInlineStart:o,margin:o,marginTop:o,marginRight:o,marginBottom:o,marginLeft:o,marginBlock:o,marginBlockEnd:o,marginBlockStart:o,marginInline:o,marginInlineEnd:o,marginInlineStart:o,padding:o,paddingTop:o,paddingRight:o,paddingBottom:o,paddingLeft:o,paddingBlock:o,paddingBlockEnd:o,paddingBlockStart:o,paddingInline:o,paddingInlineEnd:o,paddingInlineStart:o,top:o,right:o,bottom:o,left:o,scrollMargin:o,scrollMarginTop:o,scrollMarginRight:o,scrollMarginBottom:o,scrollMarginLeft:o,scrollMarginX:o,scrollMarginY:o,scrollMarginBlock:o,scrollMarginBlockEnd:o,scrollMarginBlockStart:o,scrollMarginInline:o,scrollMarginInlineEnd:o,scrollMarginInlineStart:o,scrollPadding:o,scrollPaddingTop:o,scrollPaddingRight:o,scrollPaddingBottom:o,scrollPaddingLeft:o,scrollPaddingX:o,scrollPaddingY:o,scrollPaddingBlock:o,scrollPaddingBlockEnd:o,scrollPaddingBlockStart:o,scrollPaddingInline:o,scrollPaddingInlineEnd:o,scrollPaddingInlineStart:o,fontSize:"fontSizes",background:r,backgroundColor:r,backgroundImage:r,borderImage:r,border:r,borderBlock:r,borderBlockEnd:r,borderBlockStart:r,borderBottom:r,borderBottomColor:r,borderColor:r,borderInline:r,borderInlineEnd:r,borderInlineStart:r,borderLeft:r,borderLeftColor:r,borderRight:r,borderRightColor:r,borderTop:r,borderTopColor:r,caretColor:r,color:r,columnRuleColor:r,fill:r,outline:r,outlineColor:r,stroke:r,textDecorationColor:r,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:a,minBlockSize:a,maxBlockSize:a,inlineSize:a,minInlineSize:a,maxInlineSize:a,width:a,minWidth:a,maxWidth:a,height:a,minHeight:a,maxHeight:a,flexBasis:a,gridTemplateColumns:a,gridTemplateRows:a,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},l=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,u=()=>{const e=Object.create(null);return(t,i,...n)=>{const r=(a=t,JSON.stringify(a,l));var a;return r in e?e[r]:e[r]=i(t,...n)}},d=Symbol.for("sxs.internal"),c=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),p=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:m}=Object.prototype,f=e=>e.includes("-")?e:e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase())),h=/\s+(?![^()]*\))/,v=e=>t=>e(..."string"==typeof t?String(t).split(h):[t]),g={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:v(((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e}))),marginInline:v(((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e}))),maxSize:v(((e,t)=>({maxBlockSize:e,maxInlineSize:t||e}))),minSize:v(((e,t)=>({minBlockSize:e,minInlineSize:t||e}))),paddingBlock:v(((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e}))),paddingInline:v(((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e})))},I=/([\d.]+)([^]*)/,U=(e,t)=>e.length?e.reduce(((e,i)=>(e.push(...t.map((e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(i)&&/&.*&/.test(e)?`:is(${i})`:i):i+" "+e))),e)),[]):t,y=(e,t)=>e in S&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,((t,i,n,r)=>i+("stretch"===n?`-moz-available${r};${f(e)}:${i}-webkit-fill-available`:`-moz-fit-content${r};${f(e)}:${i}fit-content`)+r)):String(t),S={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},w=e=>e?e+"-":"",T=(e,t,i)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,((e,n,r,a,o)=>"$"==a==!!r?e:(n||"--"==a?"calc(":"")+"var(--"+("$"===a?w(t)+(o.includes("$")?"":w(i))+o.replace(/\$/g,"-"):o)+")"+(n||"--"==a?"*"+(n||"")+(r||"1")+")":""))),P=/\s*,\s*(?![^()]*\))/,D=Object.prototype.toString,b=(e,t,i,n,r)=>{let a,o,s;const l=(e,t,i)=>{let u,d;const c=e=>{for(u in e){const h=64===u.charCodeAt(0),v=h&&Array.isArray(e[u])?e[u]:[e[u]];for(d of v){const e=/[A-Z]/.test(m=u)?m:m.replace(/-[^]/g,(e=>e[1].toUpperCase())),v="object"==typeof d&&d&&d.toString===D&&(!n.utils[e]||!t.length);if(e in n.utils&&!v){const t=n.utils[e];if(t!==o){o=t,c(t(d)),o=null;continue}}else if(e in g){const t=g[e];if(t!==s){s=t,c(t(d)),s=null;continue}}if(h&&(p=u.slice(1)in n.media?"@media "+n.media[u.slice(1)]:u,u=p.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,((e,t,i,n,r,a)=>{const o=I.test(t),s=.0625*(o?-1:1),[l,u]=o?[n,t]:[t,n];return"("+("="===i[0]?"":">"===i[0]===o?"max-":"min-")+l+":"+("="!==i[0]&&1===i.length?u.replace(I,((e,t,n)=>Number(t)+s*(">"===i?1:-1)+n)):u)+(r?") and ("+(">"===r[0]?"min-":"max-")+l+":"+(1===r.length?a.replace(I,((e,t,i)=>Number(t)+s*(">"===r?-1:1)+i)):a):"")+")"}))),v){const e=h?i.concat(u):[...i],n=h?[...t]:U(t,u.split(P));void 0!==a&&r(M(...a)),a=void 0,l(d,n,e)}else void 0===a&&(a=[[],t,i]),u=h||36!==u.charCodeAt(0)?u:`--${w(n.prefix)}${u.slice(1).replace(/\$/g,"-")}`,d=v?d:"number"==typeof d?d&&e in N?String(d)+"px":String(d):T(y(e,d??""),n.prefix,n.themeMap[e]),a[0].push(`${h?`${u} `:`${f(u)}:`}${d}`)}}var p,m};c(e),void 0!==a&&r(M(...a)),a=void 0};l(e,t,i)},M=(e,t,i)=>`${i.map((e=>`${e}{`)).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,N={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R=e=>String.fromCharCode(e+(e>25?39:97)),A=e=>(e=>{let t,i="";for(t=Math.abs(e);t>52;t=t/52|0)i=R(t%52)+i;return R(t%52)+i})(((e,t)=>{let i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e})(5381,JSON.stringify(e))>>>0),E=["themed","global","styled","onevar","resonevar","allvar","inline"],C=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch{return!1}},O=e=>{let t;const i=()=>{const{cssRules:e}=t.sheet;return[].map.call(e,((i,n)=>{const{cssText:r}=i;let a="";if(r.startsWith("--sxs"))return"";if(e[n-1]&&(a=e[n-1].cssText).startsWith("--sxs")){if(!i.cssRules.length)return"";for(const e in t.rules)if(t.rules[e].group===i)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${r}`;return i.cssRules.length?`${a}${r}`:""}return r})).join("")},n=()=>{if(t){const{rules:e,sheet:i}=t;if(!i.deleteRule){for(;3===Object(Object(i.cssRules)[0]).type;)i.cssRules.splice(0,1);i.cssRules=[]}for(const t in e)delete e[t]}const r=Object(e).styleSheets||[];for(const e of r)if(C(e)){for(let r=0,a=e.cssRules;a[r];++r){const o=Object(a[r]);if(1!==o.type)continue;const s=Object(a[r+1]);if(4!==s.type)continue;++r;const{cssText:l}=o;if(!l.startsWith("--sxs"))continue;const u=l.slice(14,-3).trim().split(/\s+/),d=E[u[0]];d&&(t||(t={sheet:e,reset:n,rules:{},toString:i}),t.rules[d]={group:s,index:r,cache:new Set(u)})}if(t)break}if(!t){const r=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,r(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,(e=>e.cssText)).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:r("","text/css"),rules:{},reset:n,toString:i}}const{sheet:a,rules:o}=t;for(let e=E.length-1;e>=0;--e){const t=E[e];if(!o[t]){const i=E[e+1],n=o[i]?o[i].index:a.cssRules.length;a.insertRule("@media{}",n),a.insertRule(`--sxs{--sxs:${e}}`,n),o[t]={group:a.cssRules[n+1],index:n,cache:new Set([e])}}k(o[t])}};return n(),t},k=e=>{const t=e.group;let i=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,i),++i}catch{}}},F=Symbol(),x=u(),L=(e,t)=>x(e,(()=>(...i)=>{let n={type:null,composers:new Set};for(const t of i)if(null!=t)if(t[d]){null==n.type&&(n.type=t[d].type);for(const e of t[d].composers)n.composers.add(e)}else t.constructor!==Object||t.$$typeof?null==n.type&&(n.type=t):n.composers.add(_(t,e));return null==n.type&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),B(e,n,t)})),_=({variants:e,compoundVariants:t,defaultVariants:i,...n},r)=>{const a=`${w(r.prefix)}c-${A(n)}`,o=[],s=[],l=Object.create(null),u=[];for(const p in i)l[p]=String(i[p]);if("object"==typeof e&&e)for(const f in e){d=l,c=f,m.call(d,c)||(l[f]="undefined");const t=e[f];for(const e in t){const i={[f]:String(e)};"undefined"===String(e)&&u.push(f);const n=t[e],r=[i,n,!p(n)];o.push(r)}}var d,c;if("object"==typeof t&&t)for(const m of t){let{css:e,...t}=m;e="object"==typeof e&&e||{};for(const n in t)t[n]=String(t[n]);const i=[t,e,!p(e)];s.push(i)}return[a,n,o,s,l,u]},B=(e,t,i)=>{const[n,r,a,o]=j(t.composers),s="function"==typeof t.type||t.type.$$typeof?(e=>{function t(){for(let i=0;i<t[F].length;i++){const[n,r]=t[F][i];e.rules[n].apply(r)}return t[F]=[],null}return t[F]=[],t.rules={},E.forEach((e=>t.rules[e]={apply:i=>t[F].push([e,i])})),t})(i):null,l=(s||i).rules,u=`.${n}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,p=d=>{d="object"==typeof d&&d||G;const{css:c,...p}=d,m={};for(const e in a)if(delete p[e],e in d){let t=d[e];"object"==typeof t&&t?m[e]={"@initial":a[e],...t}:(t=String(t),m[e]="undefined"!==t||o.has(e)?t:a[e])}else m[e]=a[e];const f=new Set([...r]);for(const[n,r,a,o]of t.composers){i.rules.styled.cache.has(n)||(i.rules.styled.cache.add(n),b(r,[`.${n}`],[],e,(e=>{l.styled.apply(e)})));const t=V(a,m,e.media),s=V(o,m,e.media,!0);for(const r of t)if(void 0!==r)for(const[t,a,o]of r){const r=`${n}-${A(a)}-${t}`;f.add(r);const s=(o?i.rules.resonevar:i.rules.onevar).cache,u=o?l.resonevar:l.onevar;s.has(r)||(s.add(r),b(a,[`.${r}`],[],e,(e=>{u.apply(e)})))}for(const r of s)if(void 0!==r)for(const[t,a]of r){const r=`${n}-${A(a)}-${t}`;f.add(r),i.rules.allvar.cache.has(r)||(i.rules.allvar.cache.add(r),b(a,[`.${r}`],[],e,(e=>{l.allvar.apply(e)})))}}if("object"==typeof c&&c){const t=`${n}-i${A(c)}-css`;f.add(t),i.rules.inline.cache.has(t)||(i.rules.inline.cache.add(t),b(c,[`.${t}`],[],e,(e=>{l.inline.apply(e)})))}for(const e of String(d.className||"").trim().split(/\s+/))e&&f.add(e);const h=p.className=[...f].join(" ");return{type:t.type,className:h,selector:u,props:p,toString:()=>h,deferredInjector:s}};return c(p,{className:n,selector:u,[d]:t,toString:()=>(i.rules.styled.cache.has(n)||p(),n)})},j=e=>{let t="";const i=[],n={},r=[];for(const[a,,,,o,s]of e){""===t&&(t=a),i.push(a),r.push(...s);for(const e in o){const t=o[e];(void 0===n[e]||"undefined"!==t||s.includes(t))&&(n[e]=t)}}return[t,i,n,new Set(r)]},V=(e,t,i,n)=>{const r=[];e:for(let[a,o,s]of e){if(s)continue;let e,l=0,u=!1;for(e in a){const n=a[e];let r=t[e];if(r!==n){if("object"!=typeof r||!r)continue e;{let e,t,a=0;for(const o in r){if(n===String(r[o])){if("@initial"!==o){const e=o.slice(1);(t=t||[]).push(e in i?i[e]:o.replace(/^@media ?/,"")),u=!0}l+=a,e=!0}++a}if(t&&t.length&&(o={["@media "+t.join(", ")]:o}),!e)continue e}}}(r[l]=r[l]||[]).push([n?"cv":`${e}-${a[e]}`,o,u])}return r},G={},$=u(),q=(e,t)=>$(e,(()=>(...i)=>{const n=()=>{for(let n of i){n="object"==typeof n&&n||{};let i=A(n);if(!t.rules.global.cache.has(i)){if(t.rules.global.cache.add(i),"@import"in n){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let i of[].concat(n["@import"]))i=i.includes('"')||i.includes("'")?i:`"${i}"`,t.sheet.insertRule(`@import ${i};`,e++);delete n["@import"]}b(n,[],[],e,(e=>{t.rules.global.apply(e)}))}}return""};return c(n,{toString:n})})),W=u(),H=(e,t)=>W(e,(()=>i=>{const n=`${w(e.prefix)}k-${A(i)}`,r=()=>{if(!t.rules.global.cache.has(n)){t.rules.global.cache.add(n);const r=[];b(i,[],[],e,(e=>r.push(e)));const a=`@keyframes ${n}{${r.join("")}}`;t.rules.global.apply(a)}return n};return c(r,{get name(){return r()},toString:r})})),z=class{constructor(e,t,i,n){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==i?"":String(i),this.prefix=null==n?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+w(this.prefix)+w(this.scale)+this.token}toString(){return this.computedValue}},Y=u(),K=(e,t)=>Y(e,(()=>(i,n)=>{n="object"==typeof i&&i||Object(n);const r=`.${i=(i="string"==typeof i?i:"")||`${w(e.prefix)}t-${A(n)}`}`,a={},o=[];for(const t in n){a[t]={};for(const i in n[t]){const r=`--${w(e.prefix)}${t}-${i}`,s=T(String(n[t][i]),e.prefix,t);a[t][i]=new z(i,s,t,e.prefix),o.push(`${r}:${s}`)}}const s=()=>{if(o.length&&!t.rules.themed.cache.has(i)){t.rules.themed.cache.add(i);const r=`${n===e.theme?":root,":""}.${i}{${o.join(";")}}`;t.rules.themed.apply(r)}return i};return{...a,get className(){return s()},selector:r,toString:s}})),J=u(),Q=e=>{let t=!1;const i=J(e,(e=>{t=!0;const i="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",n="object"==typeof e.media&&e.media||{},r="object"==typeof e.root?e.root||null:globalThis.document||null,a="object"==typeof e.theme&&e.theme||{},o={prefix:i,media:n,theme:a,themeMap:"object"==typeof e.themeMap&&e.themeMap||{...s},utils:"object"==typeof e.utils&&e.utils||{}},l=O(r),u={css:L(o,l),globalCss:q(o,l),keyframes:H(o,l),createTheme:K(o,l),reset(){l.reset(),u.theme.toString()},theme:{},sheet:l,config:o,prefix:i,getCssText:l.toString,toString:l.toString};return String(u.theme=u.createTheme(a)),u}));return t||i.reset(),i},Z=(...e)=>(n||(n=Q())).css(...e);const X=Z({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),ee=Z({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),te=Z({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});const ie=Z({fontSize:"smaller",color:"gray"});typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof i.g<"u"?i.g:typeof self<"u"&&self;function ne(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var re,ae={exports:{}};re=ae,function(){var e={}.hasOwnProperty;function t(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];r&&(e=n(e,i(r)))}return e}function i(i){if("string"==typeof i||"number"==typeof i)return i;if("object"!=typeof i)return"";if(Array.isArray(i))return t.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var r="";for(var a in i)e.call(i,a)&&i[a]&&(r=n(r,a));return r}function n(e,t){return t?e?e+" "+t:e+t:e}re.exports?(t.default=t,re.exports=t):window.classNames=t}();const oe=ne(ae.exports);const se=Z({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),le=Z({display:"block"}),ue=Z({position:"fixed",right:0,left:0}),de=Z({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),ce=Z({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),pe=Z({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),me=Z({fontWeight:"600",fontSize:"20px"}),fe=Z({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),he="Nothing to see here";function ve(e){return"function"==typeof e}function ge(e){return"string"==typeof e}function Ie(e){return Array.isArray(e)}function Ue(e){return"object"==typeof e&&!Array.isArray(e)}const ye=(()=>{const e=ue(),t={},i=".5";let n,r,a=[],o=[],s=[];const l=i=>{const l=s.length;if(i&&!1===t[l])return;const u=o.pop(),d=a.pop();ve(u)&&u({content:d}),document.body.classList.remove(e),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),r&&(r.style.opacity=0,r.style.display="none"),(e=>{if(e){let t;s=s.filter((i=>(i.id===e&&(t=i),i.id!==e))),t&&document.body.removeChild(t)}else{const e=s.pop();e&&document.body.removeChild(e)}})()},u=({config:t})=>{n=window.scrollY,document.body.classList.add(e),document.body.style.top=`-${n}px`,r||(r=document.createElement("div"),r.className=se(),r.id="cmdl-backdrop",r.onclick=()=>l(!0),document.body.appendChild(r)),r.style.display="",!1!==(null==t?void 0:t.backdrop)&&(r.style.backgroundColor="rgba(0, 0, 0, 0.2)",r.style.transition="opacity 0.15s linear",r.style.opacity=1)},d=({config:e,attr:t,attrs:i,unit:n="em",value:r})=>{var a;let o;return ge(t)?o=Se({element:e,attr:t}):Ie(i)&&(o=null==(a=i.map((t=>Se({element:e,attr:t}))).filter(Boolean))?void 0:a[0]),void 0!==o&&(r=o),isNaN(r)?r:`${r}${n}`},c=({buttons:e,config:t,modalNumber:n})=>{var r,o;const s=document.createElement("div");s.className=fe(),s.style.padding=d({config:t,attrs:["footer.padding","padding"],value:i});const l={label:(null==(r=null==t?void 0:t.dictionary)?void 0:r.close)||"Close",onClick:ye.close,intent:"is-info"};for(const i of e){if(i.hide)continue;const e={...l};Ue(i)&&Object.assign(e,i);const t=document.createElement("button");void 0!==e.disabled&&(t.disabled=e.disabled),e.id&&(t.id=e.id),t.className=(null==(o=null==e?void 0:e.footer)?void 0:o.className)||"button font-medium",t.classList.add(e.intent),t.style="margin-right: .5em;",t.innerHTML=e.label||e.text,t.onclick=i=>{i.stopPropagation(),ve(e.onClick)&&(t.classList.add("is-loading"),e.onClick({e:i,content:a[n]})),!1!==e.close&&(ve(e.close)&&e.close(),ye.close())},s.appendChild(t)}return s};return{close:l,open:({title:e="",content:n,buttons:r,footer:p,config:m,onClose:f}={})=>{u({config:m}),o.push(f);const h=s.length+1;t[h]=null==m?void 0:m.clickAway;const v=document.createElement("section"),g=`cmdl-${h}`;v.className=le(),v.role="dialog",v.tabIndex=-1,v.id=g;const I=document.createElement("div");I.className=de(),I.style.maxWidth=`${(null==m?void 0:m.maxWidth)||450}px`,I.onclick=()=>l(!0);const U=document.createElement("div");U.className=ce(),U.onclick=e=>e.stopPropagation();const y=document.createElement("div"),S=document.createElement("div");y.appendChild(S),U.appendChild(y);const w=({title:e,config:t})=>{y.className=e?pe():"",y.style.padding=d({config:t,attrs:["title.padding","padding"],value:i}),S.className=e?me():"",S.innerHTML=e};e&&w({title:e});const T=document.createElement("div");U.appendChild(T);const P=({content:e,config:t})=>{T.style.fontSize=d({config:t,attr:"fontSize",value:"15px"}),T.style.position="relative",T.style.padding=d({config:t,attrs:["content.padding","padding"],value:i}),ve(e)?a[h]=e(T):Ue(e)?T.appendChild(e):ge(e)?T.innerHTML=e:T.innerHTML=he};if(P({content:n,config:m}),Ie(r))p=c({buttons:r,config:m,modalNumber:h}),U.appendChild(p);else if(p){const e=document.createElement("div");e.className=fe(),e.style.padding=d({config:m,attrs:["footer.padding","padding"]}),Ue(p)?e.appendChild(p):ge(p)?e.innerHTML=p:e.innerHTML=he,U.appendChild(e)}I.appendChild(U),v.appendChild(I),document.body.appendChild(v),s.push(v);const D=({content:e,config:t})=>{a[h]=void 0,function(e){if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}(T),P({content:e,config:t})},b=({buttons:e,config:t})=>{U.removeChild(p),p=c({buttons:e,config:t,modalNumber:h}),U.appendChild(p)};return{setContent:D,setButtons:b,update:({content:e,buttons:t,title:i,config:n,onClose:r})=>{m=n||m,e&&D({content:e,config:m}),t&&b({buttons:t,config:m}),r&&(({onClose:e})=>{o.length=0,o.push(e)})({onClose:r}),i&&w({title:i,config:m})}}}}})();function Se({element:e,attr:t}){if(!ge(t))return;const i=t.split(".");for(const n of i)if(!(e=null==e?void 0:e[n]))return;return e}function we(e){var t,i,n,r;const a=null==(i=null==(t=null==e?void 0:e.composition)?void 0:t.configuration)?void 0:i.participantDetail;if((null==(r=null==(n=null==e?void 0:e.composition)?void 0:n.configuration)?void 0:r.showAddress)??"ADDRESS"===a)return function({individualParticipant:e,className:t}){var i,n;const{city:r,state:a,countryCode:o}=(null==(n=null==(i=null==e?void 0:e.person)?void 0:i.addresses)?void 0:n[0])||{},s=[r,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=oe(ie(),t),l.innerHTML=s,l}(e);if("TEAM"===a)return function({individualParticipant:e,className:t}){var i;const n=null==(i=null==e?void 0:e.teams)?void 0:i[0],r=(null==n?void 0:n.participantName)||" ",a=document.createElement("div");return a.className=oe(ie(),t),a.classList.add("tmx-tm"),a.setAttribute("id",null==n?void 0:n.participantId),a.innerHTML=r,a}(e);if(a){const t=function({individualParticipant:e,attribute:t,className:i}){const n=Se({element:null==e?void 0:e.person,attr:t});if(!n)return;const r=document.createElement("div");return r.className=oe(ie(),i),r.innerHTML=n,r}({...e,attribute:a});if(t)return t}return document.createElement("div")}const Te=Z({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});const Pe=Z({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});var De=Object.defineProperty,be=(e,t)=>{for(var i in t)De(e,i,{get:t[i],enumerable:!0})};var Me={};be(Me,{competitionGovernor:()=>Ne,drawsGovernor:()=>il,entriesGovernor:()=>yb,eventGovernor:()=>Cb,generationGovernor:()=>mM,matchUpFormatGovernor:()=>kM,matchUpGovernor:()=>FM,mocksGovernor:()=>HN,participantGovernor:()=>mA,policyGovernor:()=>yP,publishingGovernor:()=>VA,queryGovernor:()=>RP,reportGovernor:()=>JA,scheduleGovernor:()=>nE,scoreGovernor:()=>NS,tieFormatGovernor:()=>gE,tournamentGovernor:()=>BE,venueGovernor:()=>JE});var Ne={};be(Ne,{getLinkedTournamentIds:()=>tl,getTournamentIds:()=>Ts,linkTournaments:()=>Qs,mutate:()=>Re,query:()=>el,unlinkTournament:()=>Xs,unlinkTournaments:()=>Zs});var Re={};be(Re,{linkTournaments:()=>Qs,unlinkTournament:()=>Xs,unlinkTournaments:()=>Zs});function Ae(e){return"function"==typeof e}function Ee(e){return"string"==typeof e}function Ce(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function Oe(e,t){if(!Ce(e)||!Ce(t))return!1;let i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(let r of i)if(e[r]!==t[r])return!1;return!0}function ke(e,t){return Array.isArray(e)?Object.assign({},...(e??[]).filter(Ce).map((e=>e[t]&&{[e[t]]:e})).filter(Boolean)):{}}be({},{addNotice:()=>ia,callListener:()=>la,createInstanceState:()=>Gr,cycleMutationStatus:()=>ta,deepCopyEnabled:()=>Jr,deleteNotice:()=>aa,deleteNotices:()=>oa,disableNotifications:()=>zr,enableNotifications:()=>Yr,getDevContext:()=>$r,getMethods:()=>na,getNotices:()=>ra,getProvider:()=>va,getTopics:()=>sa,getTournamentId:()=>ua,getTournamentRecord:()=>da,getTournamentRecords:()=>ca,globalLog:()=>Ia,handleCaughtError:()=>ga,removeTournamentRecord:()=>ha,setDeepCopy:()=>Kr,setDevContext:()=>Hr,setGlobalLog:()=>Wr,setGlobalMethods:()=>Xr,setGlobalSubscriptions:()=>Qr,setMethods:()=>ea,setStateMethods:()=>Ua,setStateProvider:()=>Vr,setSubscriptions:()=>Zr,setTournamentId:()=>fa,setTournamentRecord:()=>pa,setTournamentRecords:()=>ma,timeKeeper:()=>qr});var Fe=e=>t=>Object.keys(e).every((i=>t[i]===e[i]));function xe(e,t){if(void 0===e)return null;if("object"!=typeof e||null===e)return e;let i=Object.keys(e),n=e=>void 0===e?null:e;return Object.assign({},...i.map((i=>Array.isArray(e[i])?{[i]:t?e[i]:e[i].map((e=>xe(e)))}:{[i]:t?n(e[i]):xe(e[i])})))}function Le(e){return Array.isArray(e)?e.length+e.map(Le).reduce(((e,t)=>e+t),0):"object"==typeof e&&null!==e?Object.keys(e).length+Object.keys(e).map((t=>Le(e[t]))).reduce(((e,t)=>e+t),0):0}function _e(e){if(null===e||"object"!=typeof e)return;let t=JSON.stringify(e),i=Le(e),n=t.split("").reduce(((e,t)=>e+t.charCodeAt(0)),0);return[t.length,i,n].map((e=>e.toString(36))).join("")}var Be={success:!0},je={SUCCESS:Be,ERROR:"error"},Ve={message:"Chronological error; time violation.",code:"ANACHRONISM"},Ge={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},$e={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},qe={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},We={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},He={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},ze={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Ye={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Ke={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Je={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Qe={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Ze={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},Xe={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},et={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},tt={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},it={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},nt={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},rt={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},at={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},ot={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},st={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},lt={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},ut={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},dt={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},ct={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},pt={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},mt={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},ft={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},ht={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},vt={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},gt={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},It={message:"Invalid action",code:"ERR_INVALID_ACTION"},Ut={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},yt={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},St={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},wt={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},Tt={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},Pt={message:"Existing round",code:"ERR_EXISTING_ROUND"},Dt={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},bt={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Mt={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Nt={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Rt={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},At={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Et={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Ct={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Ot={message:"Event exists",code:"ERR_EXISTING_EVENT"},kt={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Ft={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},xt={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Lt={message:"Missing stage",code:"ERR_MISSING_STAGE"},_t={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Bt={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},jt={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Vt={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Gt={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},$t={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},qt={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Wt={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Ht={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},zt={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Yt={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Kt={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Jt={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Qt={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Zt={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Xt={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},ei={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},ti={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},ii={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},ni={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},ri={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},ai={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},oi={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},si={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},li={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},ui={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},di={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},ci={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},pi={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},mi={message:"Missing value",code:"ERR_MISSING_VALUE"},fi={message:"Missing date",code:"ERR_MISSING_DATE"},hi={message:"No valid dates",code:"ERR_NO_VALID_DATES"},vi={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},gi={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Ii={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ui={message:"Invalid Date",code:"ERR_INVALID_DATE"},yi={message:"Invalid time",code:"ERR_INVALID_TIME"},Si={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},wi={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Ti={message:"Invalid score",code:"ERR_INVALID_SCORE"},Pi={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Di={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},bi={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Mi={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Ni={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Ri={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Ai={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ei={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ci={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Oi={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},ki={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Fi={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},xi={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Li={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},_i={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Bi={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},ji={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Vi={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Gi={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},$i={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},qi={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Wi={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Hi={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},zi={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Yi={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},Ki={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Ji={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Qi={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Zi={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Xi={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},en={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},tn={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},nn={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},rn={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},an={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},on={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},sn={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},ln={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},un={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},dn={message:"Court exists",code:"ERR_EXISTING_COURT"},cn={message:"Venue exists",code:"ERR_EXISTING_VENUE"},pn={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},mn={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},fn={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},hn={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},vn={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},gn={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},In={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},Un={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},yn={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},Sn={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},wn={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Tn={message:"Missing context",code:"ERR_MISSING_CONTEXT"},Pn={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Dn={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},bn={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Mn={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Nn={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},Rn={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},An={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},En={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Cn={message:"Invalid object",code:"ERR_INVALID_OBJECT"},On={message:"Invalid gender",code:"ERR_INVALID_GENDER"},kn={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Fn={message:"Invalid values",code:"ERR_INVALID_VALUES"},xn={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},Ln={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},_n={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},Bn={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},jn={message:"Value unchanged",code:"ABORT_UNCHANGED"},Vn={message:"Not found",code:"ERR_NOT_FOUND"},Gn={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},$n={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},qn={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Wn={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Hn={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},zn={message:"Existing stage",code:"ERR_EXISTING_STAGE"},Yn={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Kn={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Jn={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Qn={message:"Scores present",code:"ERR_SCORES_PRESENT"},Zn={ANACHRONISM:Ve,CANNOT_CHANGE_WINNING_SIDE:Ri,CANNOT_MODIFY_TIEFORMAT:bi,CANNOT_MODIFY_PARTICIPANT_TYPE:Mi,CANNOT_REMOVE_MAIN_STRUCTURE:Ge,CANNOT_REMOVE_PARTICIPANTS:Ni,COURT_EXISTS:dn,COURT_NOT_FOUND:un,DRAW_DEFINITION_NOT_FOUND:Qe,DRAW_ID_EXISTS:ft,DRAW_POSITION_ACTIVE:ot,DRAW_POSITION_ASSIGNED:tt,DRAW_POSITION_NOT_CLEARED:nt,DRAW_POSITION_NOT_FOUND:{message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},DRAW_SIZE_MISMATCH:ct,DUPLICATE_VALUE:xn,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:en,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Xi,EVENT_EXISTS:Ot,EVENT_NOT_FOUND:Ct,EXISTING_DRAW_DEFINITIONS:Je,EXISTING_END_TIME:hn,EXISTING_FLIGHT:$n,EXISTING_MATCHUP_ID:Hn,EXISTING_OUTCOME:Wn,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Hi,EXISTING_PARTICIPANT:zi,EXISTING_POLICY_TYPE:li,EXISTING_PROFILE:qn,EXISTING_ROUND:Pt,EXISTING_STAGE:zn,EXISTING_STRUCTURE:Yn,INCOMPATIBLE_MATCHUP_STATUS:qt,INCOMPLETE_SOURCE_STRUCTURE:Xe,INSUFFICIENT_DRAW_POSITIONS:rn,INVALID_ACTION:It,INVALID_ASSIGNMENT:Ut,INVALID_BOOKINGS:vi,INVALID_CATEGORY:kn,INVALID_COLLECTION_DEFINITION:En,INVALID_CONFIGURATION:An,INVALID_DATE_AVAILABILITY:gi,INVALID_DATE:Ui,INVALID_DRAW_DEFINITION:Ye,INVALID_DRAW_POSITION_FOR_SEEDING:et,INVALID_DRAW_POSITION:st,INVALID_DRAW_SIZE:dt,INVALID_END_TIME:fn,INVALID_ENTRIES:Ft,INVALID_EVENT_TYPE:At,INVALID_GAME_SCORES:wi,INVALID_GENDER:On,INVALID_MATCHUP_FORMAT:zt,INVALID_MATCHUP_STATUS:Wt,INVALID_MATCHUP_STATUS_BYE:Vt,INVALID_MATCHUP:ii,INVALID_OBJECT:Cn,INVALID_PARTICIPANT_ID:Ei,INVALID_PARTICIPANT_IDS:Ci,INVALID_PARTICIPANT_ROLE:Oi,INVALID_PARTICIPANT_SEEDING:ht,INVALID_PARTICIPANT_TYPE:ki,INVALID_PARTICIPANT:Ai,INVALID_POLICY_DEFINITION:si,INVALID_RECORDS:$e,INVALID_SCALE_ITEM:Dn,INVALID_SEED_NUMBER:St,INVALID_SEED_POSITION:wt,INVALID_SET_NUMBER:{message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},INVALID_SIDE_NUMBER:di,INVALID_SCORE:Ti,INVALID_STAGE:_t,INVALID_START_TIME:gn,INVALID_STRUCTURE:Ze,INVALID_STOP_TIME:vn,INVALID_TIE_FORMAT:Ht,INVALID_TIME:yi,INVALID_TIME_ITEM:Un,INVALID_TOURNAMENT_DATES:Si,INVALID_TOURNAMENT_RECORD:He,INVALID_VALUES:Fn,INVALID_WINNING_SIDE:Pi,MATCHUP_NOT_FOUND:Xt,METHOD_NOT_FOUND:Kn,MISSING_ASSIGNMENTS:xt,MISSING_ASYNC_STATE_PROVIDER:yn,MISSING_AVOIDANCE_POLICY:ai,MISSING_COLLECTION_DEFINITION:Kt,MISSING_COURT_ID:pi,MISSING_COURTS_INFO:ln,MISSING_DATE_AVAILABILITY:Ii,MISSING_DATE:fi,MISSING_DRAW_DEFINITION:Ke,MISSING_DRAW_ID:mt,MISSING_DRAW_POSITION:lt,MISSING_DRAW_POSITIONS:at,MISSING_DRAW_SIZE:pt,MISSING_ENTRIES:kt,MISSING_EVENT:Et,MISSING_MATCHUP_FORMAT:Yt,MISSING_MATCHUP_ID:Qt,MISSING_MATCHUP_IDS:Zt,MISSING_MATCHUP:ti,MISSING_MATCHUPS:ei,MISSING_PARTICIPANT_COUNT:$i,MISSING_PARTICIPANT_ID:_i,MISSING_PARTICIPANT_IDS:Gi,MISSING_PARTICIPANT_ROLE:Fi,MISSING_PARTICIPANT:xi,MISSING_PARTICIPANTS:Li,MISSING_PENALTY_ID:on,MISSING_PENALTY_TYPE:an,MISSING_PERSON_DETAILS:Wi,MISSING_POLICY_ATTRIBUTES:oi,MISSING_POLICY_DEFINITION:ri,MISSING_POLICY_TYPE:ni,MISSING_POSITION_ASSIGNMENTS:jt,MISSING_ROUND_NUMBER:{message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},MISSING_SCHEDULE:Pn,MISSING_SCORING_POLICY:{message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},MISSING_SEED_ASSIGNMENTS:yt,MISSING_SEEDCOUNT_THRESHOLDS:gt,MISSING_SEEDING_POLICY:{message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},MISSING_SET_NUMBER:{message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},MISSING_SET_OBJECT:ci,MISSING_SIDE_NUMBER:{message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},MISSING_STAGE:Lt,MISSING_STRUCTURE_ID:Dt,MISSING_STRUCTURE:Nt,MISSING_STRUCTURES:Mt,MISSING_TARGET_LINK:Tt,MISSING_TIE_FORMAT:Jt,MISSING_TIME_ITEM:Sn,MISSING_TIME_ITEMS:wn,MISSING_TOURNAMENT_ID:ze,MISSING_TOURNAMENT_RECORD:We,MISSING_TOURNAMENT_RECORDS:qe,MISSING_VALUE:mi,MISSING_VENUE_ID:mn,MODIFICATIONS_FAILED:bn,NO_CANDIDATES:Rn,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:nn,NO_MODIFICATIONS_APPLIED:Mn,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:tn,NO_PARTICIPANT_REMOVED:Vi,NO_VALID_ACTIONS:_n,NO_VALID_ATTRIBUTES:Bn,NO_VALID_DATES:hi,NOT_FOUND:Vn,NOT_IMPLEMENTED:Gn,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Yi,PARTICIPANT_ID_EXISTS:ji,PARTICIPANT_NOT_CHECKED_IN:qi,PARTICIPANT_NOT_FOUND:Bi,PARTICIPANT_PAIR_EXISTS:{message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},PENALTY_NOT_FOUND:sn,POLICY_NOT_ATTACHED:{message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},POLICY_NOT_FOUND:ui,SCHEDULE_NOT_CLEARED:it,SCHEDULED_MATCHUPS:Jn,SCORES_PRESENT:Qn,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:vt,STAGE_SEQUENCE_LIMIT:Bt,STRUCTURE_NOT_FOUND:bt,TEAM_NOT_FOUND:Ln,UNABLE_TO_ASSIGN_COURT:Nn,UNLINKED_STRUCTURES:Rt,UNRECOGNIZED_DRAW_TYPE:rt,UNRECOGNIZED_MATCHUP_FORMAT:$t,UNRECOGNIZED_MATCHUP_STATUS:Gt,VALUE_UNCHANGED:jn,VENUE_EXISTS:cn},Xn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},er={addNotice:function({topic:e,payload:t,key:i},n){if("string"==typeof e&&"object"==typeof t&&(Xn.disableNotifications||(Xn.modified=!0),!Xn.disableNotifications&&(Xn.subscriptions[e]||n)))return i&&(Xn.notices=Xn.notices.filter((t=>!(t.topic===e&&t.key===i)))),Xn.notices.push({topic:e,payload:t,key:i}),{...Be}},callListener:function({topic:e,notices:t},i){let n=Xn.subscriptions[e];n&&"function"==typeof n&&n(t);let r=null==i?void 0:i[e];r&&"function"==typeof r&&r(t)},cycleMutationStatus:function(){let e=Xn.modified;return Xn.modified=!1,e},deleteNotice:function({topic:e,key:t}){Xn.notices=Xn.notices.filter((i=>(!e||i.topic===e)&&i.key!==t))},deleteNotices:function(){Xn.notices=[]},disableNotifications:function(){Xn.disableNotifications=!0},enableNotifications:function(){Xn.disableNotifications=!1},getMethods:ir,getNotices:function({topic:e}){return Xn.notices.filter((t=>t.topic===e)).map((e=>e.payload))},getTopics:function(){return{topics:Object.keys(Xn.subscriptions)}},getTournamentId:tr,getTournamentRecord:function(e){return Xn.tournamentRecords[e]},getTournamentRecords:function(){return Xn.tournamentRecords},removeTournamentRecord:function(e){if("string"!=typeof e)return{error:Fn};if(!Xn.tournamentRecords[e])return{error:Vn};delete Xn.tournamentRecords[e];let t=Object.keys(Xn.tournamentRecords);return 1===t.length?Xn.tournamentId=t[0]:t.length||(Xn.tournamentId=void 0),{success:!0}},setMethods:function(e){return"object"!=typeof e?{error:Fn}:(Object.keys(e).forEach((t=>{"function"==typeof e[t]&&(Xn.methods[t]=e[t])})),{...Be})},setSubscriptions:function(e){return"object"!=typeof e.subscriptions?{error:Fn}:(Object.keys(e.subscriptions).forEach((t=>{Xn.subscriptions[t]=e.subscriptions[t]})),{...Be})},setTournamentId:function(e){return e?Xn.tournamentRecords[e]?(Xn.tournamentId=e,{success:!0}):{error:We}:(Xn.tournamentId=void 0,{success:!0})},setTournamentRecord:function(e){let t=null==e?void 0:e.tournamentId;return t?(Xn.tournamentRecords[t]=e,{success:!0}):{error:He}},setTournamentRecords:function(e){Xn.tournamentRecords=e;let t=Object.keys(e);1===t.length?Xn.tournamentId=t[0]:t.length||(Xn.tournamentId=void 0)},handleCaughtError:function({engineName:e,methodName:t,params:i,err:n}){let r;return"string"==typeof n?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:tr(),params:JSON.stringify(i),engine:e,methodName:t,error:r}),{error:r}}};function tr(){return Xn.tournamentId}function ir(){return Xn.methods??{}}function nr(e,t){return(e??0)-(t??0)}function rr(e){return"number"==typeof e?parseInt(e.toString()):"string"==typeof e?parseInt(e):0}function ar(e){return!isNaN(e)&&(e&&0==(e&e-1))}function or(e){if(!e.length)return;let t=[...e].sort(nr),i=Math.floor(t.length/2);return t.length%2?t[i]:(t[i-1]+t[i])/2}function sr(e){return isNaN(e)?0:e%2&&e+1||e}function lr(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function ur(e){return!isNaN(parseFloat(e))}function dr(e){let t=rr(e);if(!isNaN(t))return 0!==t&&1==(t&-t)}function cr(e){if(isNaN(e))return!1;for(;!ar(e);)e++;return e}function pr(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function mr(e){return Number.isSafeInteger("string"==typeof e?+e:e)}function fr(e,t,i,n,r=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=fr(e,t,i):(s=Math.pow(s,i),s*=t-e,s+=e),n&&(s=function(e,t){t||(t=1);let i=1/t;return Math.round(e*i)/i}(s,n)),parseFloat(s.toFixed(r))}function hr(e){return Array.isArray(e)?null==e?void 0:e.filter(((e,t,i)=>i.lastIndexOf(e)===t)):[]}function vr(e){return Array.isArray(e)?null==e?void 0:e.map((e=>null===e?void 0:e)):e}function gr(e){return Array.isArray(e)?e.map((e=>[Math.random(),e])).sort(((e,t)=>e[0]-t[0])).map((e=>e[1])):[]}function Ir(e){return mr(e)?e:1/0}function Ur(e){return Array.isArray(e)?e.reduce(((e,t)=>(e[t]||(e[t]=0),e[t]++,e)),{}):{}}function yr(e){return Sr(Ur(e))}function Sr(e){return Object.keys(e).reduce(((t,i)=>{let n=e[i];return t[n]?t[n].push(i):t[n]=[i],t}),{})}function wr(e,t,i){return i.indexOf(e)===t}function Tr(e){return e.filter(wr)}function Pr(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function Dr(e){return e[Math.floor(Math.random()*e.length)]}function br(e,t){return Array.from({length:t-e},((t,i)=>i+e))}function Mr(e,t){return t.reduce(((t,i,n)=>(i===e&&t.push(n),t)),[])}function Nr(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>-1!==t.indexOf(e))).filter(((e,t,i)=>i.indexOf(e)===t)):[]}function Rr(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((e=>!t.includes(e))):[]}function Ar(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some((e=>t.includes(e)))}function Er(e,t){return Array.isArray(t)&&t.reduce(((e,t)=>(e[t]=1+e[t]||1,e)),{})[e]||0}function Cr(e,t,i,n){return Array.isArray(e)?[].concat(...e.slice(0,t),...e.slice(t,t+i).sort(n),...e.slice(t+i,e.length)):[]}function Or(e,t){return Array.isArray(e)?e.reduce(((e,i,n)=>{let r=Math.floor(n/t);return e[r]=[].concat(e[r]||[],i),e}),[]):[]}function kr(e,[t,...i]){return e.length?[e.slice(0,t),...kr(e.slice(t),[...i,t])]:[]}function Fr(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>!isNaN(parseInt(t))&&e),!0)}function xr(e){return!!Array.isArray(e)&&e.reduce(((e,t)=>isNaN(parseInt(t))&&e),!0)}function Lr(e,t,i){return Array.isArray(e)?e.reduce(((e,n,r)=>{let a=!!i&&!!(Math.floor(r/t)%2),o=r%t,s=a?t-1-o:o;return e[s]||(e[s]=[]),e[s].push(n),e}),[]):[]}var _r={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Br=er,jr=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function Vr(e){if("object"!=typeof e)throw new Error("Global state provider can not be undefined or null");if(Nr(Object.keys(e),jr).length!==jr.length)throw new Error("Global state provider is missing required methods");return Br=e,{success:!0}}function Gr(){if(Br.createInstanceState){try{Br.createInstanceState()}catch(re){return{error:re}}return{success:!0}}return{error:yn}}function $r(e){return e&&"object"==typeof e?"object"==typeof _r.devContext&&(Object.keys(e).every((t=>{var i;return(null==(i=_r.devContext)?void 0:i[t])===e[t]}))&&_r.devContext):_r.devContext??!1}function qr(e="reset",t="default"){var i,n;let r=Date.now();if("report"===e){if("allTimers"===t)return Object.keys(_r.timers).filter((e=>"default"!==e||_r.timers[e].startTime)).map((e=>{let t=_r.timers[e],i="stopped"===t.state?0:(r-((null==t?void 0:t.startTime)??0))/1e3,n=t.elapsedTime+i;return{state:_r.timers[e].state,elapsedTime:n.toFixed(2),timer:e}}));{let e="stopped"===_r.timers[t].state?0:(r-((null==(i=_r.timers[t])?void 0:i.startTime)??0))/1e3,n=_r.timers[t].elapsedTime+e;return{state:_r.timers[t].state,elapsedTime:n.toFixed(2),timer:t}}}if(!_r.timers[t]||"reset"===e){if("allTimers"===t)return _r.timers={default:{elapsedTime:0}},!0;_r.timers[t]={startTime:r,state:"active",elapsedTime:0}}return _r.timers[t].elapsedTime||(_r.timers[t].elapsedTime=0),"stop"===e&&"stopped"!==_r.timers[t].state&&(_r.timers[t].state="stopped")&&(_r.timers[t].elapsedTime+=(r-((null==(n=_r.timers[t])?void 0:n.startTime)??0))/1e3),"start"===e&&(_r.timers[t].startTime=r)&&(_r.timers[t].state="active"),_r.timers[t]}function Wr(e){Ae(e)?_r.globalLog=e:delete _r.globalLog}function Hr(e){_r.devContext=e}function zr(){Br.disableNotifications()}function Yr(){Br.enableNotifications()}function Kr(e,t){"boolean"==typeof e&&(_r.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(_r.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(_r.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(_r.deepCopyAttributes.stringify=t.stringify),t.threshold&&(_r.deepCopyAttributes.threshold=t.threshold))}function Jr(){return{enabled:_r.deepCopy,..._r.deepCopyAttributes}}function Qr(e){return null!=e&&e.subscriptions?(Object.keys(e.subscriptions).forEach((t=>{_r.globalSubscriptions[t]=e.subscriptions[t]})),{...Be}):{error:mi,info:"missing subscriptions"}}function Zr(e){return null!=e&&e.subscriptions?Br.setSubscriptions({subscriptions:e.subscriptions}):{error:mi,info:"missing subscriptions"}}function Xr(e){return e?"object"!=typeof e?{error:Fn}:(Object.keys(e).forEach((t=>{Ae(e[t])&&(_r.globalMethods[t]=e[t])})),{...Be}):{error:mi,info:"missing method declarations"}}function ea(e){return e?"object"!=typeof e?{error:Fn}:Br.setMethods(e):{error:mi,info:"missing method declarations"}}function ta(){return Br.cycleMutationStatus()}function ia(e){if("string"!=typeof(null==e?void 0:e.topic))return;let t=_r.globalSubscriptions[e.topic];return Br.addNotice(e,t)}function na(){return{..._r.globalMethods,...Br.getMethods()}}function ra(e){return Br.getNotices(e)}function aa({key:e,topic:t}){return Br.deleteNotice({key:e,topic:t})}function oa(){return Br.deleteNotices()}function sa(){return Br.getTopics()}async function la(e){return Br.callListener(e,_r.globalSubscriptions)}function ua(){return Br.getTournamentId()}function da(e){return Br.getTournamentRecord(e)}function ca(){return Br.getTournamentRecords()}function pa(e){return Br.setTournamentRecord(e)}function ma(e){return Br.setTournamentRecords(e)}function fa(e){return Br.setTournamentId(e)}function ha(e){return Br.removeTournamentRecord(e)}function va(){return Br}function ga({engineName:e,methodName:t,params:i,err:n}){return(Ae(Br.handleCaughtError)&&Br.handleCaughtError||er.handleCaughtError)({engineName:e,methodName:t,params:i,err:n})}function Ia(e,t){if(_r.globalLog)try{_r.globalLog({log:e,engine:t})}catch(i){console.log("globalLog error",i),console.log(t,e),Wr()}else console.log(t,e)}function Ua(e,t,i,n){if(!Ce(e))return{error:Fn};ur||(i=1);let r=Array.isArray(t)?t:[],a={},o=(e,n=0)=>{Object.keys(e).forEach((s=>{Ae(e[s])?a[s]=e[s]:Ce(e[s])&&(!0===t||null!=r&&r.includes(s))&&(void 0===i||n<i)&&o(e[s],n+1)}))};return o(e),n?Xr(a):ea(a),{methods:a}}function ya(e,t,i,n){var r;if("object"!=typeof e||null===e)return e;null!=(r=Jr())&&r.enabled||(n=!0);let a=["",void 0,null];t&&a.push(!1);let o=function(e,t,i){return Object.keys(e).filter((n=>!t.includes(e[n])&&(!i||!Array.isArray(e[n])||e[n].length)))}(e,a,i);return Object.assign({},...o.map((t=>Array.isArray(e[t])?{[t]:n?e[t]:e[t].map((e=>ya(e)))}:{[t]:n?e[t]:ya(e[t])})))}function Sa({context:e,result:t,stack:i,info:n}){return t&&!Array.isArray(null==t?void 0:t.stack)&&(t.stack=[]),t&&Array.isArray(null==t?void 0:t.stack)&&"string"==typeof i&&t.stack.push(i),t&&n&&(t.info=n),t&&"object"==typeof e&&Object.keys(e).length&&Object.assign(t,ya(e)),t&&!(null!=t&&t.error)&&!(null!=t&&t.success)&&Object.assign(t,{...Be}),t??{success:!0}}var wa="tournamentRecords",Ta="policyDefinitions",Pa="tournamentRecord",Da="drawDefinition",ba="matchUpFormat",Ma="participantId",Na="scheduleDates",Ra="structureId",Aa="participant",Ea="matchUpIds",Ca="structures",Oa="matchUpId",ka="inContext",Fa="structure",xa="courtIds",La="venueIds",_a="matchUps",Ba="courtId",ja="eventId",Va="matchUp",Ga="drawId",$a="error",qa="event",Wa="param",Ha="object",za="array",Ya="_validate",Ka="_message",Ja="_invalid",Qa="_ofType",Za="_anyOf",Xa="_oneOf",eo={[wa]:qe,[Pa]:We,[Ta]:ri,[Da]:Ke,[Ma]:_i,[ba]:Yt,tournamentId:ze,[Ra]:Dt,[Ea]:Zt,[Aa]:xi,[Ca]:Mt,[Oa]:Qt,[Fa]:Nt,[Ba]:pi,[_a]:ei,[ja]:Ct,[Va]:ti,[xa]:mi,[La]:mi,[Ga]:mt,[qa]:Et},to={[wa]:Ha,[Ta]:Ha,[Pa]:Ha,[Da]:Ha,[Na]:za,[Aa]:Ha,[Ea]:za,[Ca]:za,[Fa]:Ha,[xa]:za,[La]:za,[_a]:za,[Va]:Ha,[qa]:Ha,uuids:za};function io(e,t,i){if(!e&&!Ce(e))return{error:Fn};if(null==t||!t.length||null!=e&&e._bypassParamCheck)return{valid:!0};if(!Array.isArray(t))return{error:Fn};let{paramError:n,errorParam:r}=function(e,t){let i,n;return{paramError:t.find((({_ofType:t,_oneOf:r,_anyOf:a,_validate:o,_info:s,...l})=>{let u=r&&function(e,t){if(!t)return;let i=no(e,t);return 1!==i.length?{error:Fn}:i.reduce(((e,t)=>({...e,[t]:!0})),{})}(e,r);if(null!=u&&u.error)return u.error;u&&Object.assign(l,u);let d=a&&function(e,t){if(!t)return;let i=no(e,t).filter((t=>e[t]));return i.length<1?{error:Fn}:i.reduce(((e,t)=>({...e,[t]:!0})),{})}(e,a);if(null!=d&&d.error)return d.error;d&&Object.assign(l,d);let c=Object.keys(l).filter((e=>"boolean"==typeof l[e])),p=c.find((r=>{let a=o&&!Ae(o),u=e[r]&&!o&&function(e,t,i){return i=i||to[t]||"string","array"===i?!Array.isArray(e[t]):typeof e[t]!==i}(e,r,t),d=l[r]&&!e[r],c=a||u||d||o&&e[r]&&!function(e,t){return!Ae(t)||t(e)}(e[r],o);return c&&(i=r,n=s),c}));return!c.length||p})),errorParam:i,paramInfo:n}}(e,t);if(!n)return{valid:!0};let a=void 0===(null==e?void 0:e[r])?eo[r]||Fn:n[Ya]&&n[Ja]||Fn;return Sa({info:{param:r??(n[Xa]&&Object.keys(n[Xa]).join(", ")),message:n[Ka]},result:{error:a},stack:i})}function no(e,t){return Nr(Object.keys(e),Object.keys(t))}var ro="DYNAMIC",ao="RANKING",oo="RATING",so="SCALE",lo="SEEDING",uo={RANKING:ao,RATING:oo,SCALE:so,SEEDING:lo};function co(e){var t;let i=io(e,[{[Aa]:!0}]);if(i.error)return i;let n=null==(t=e.participant.timeItems)?void 0:t.filter((({itemType:e})=>(null==e?void 0:e.startsWith(so))&&[ao,oo,lo].includes(e.split(".")[1]))),r={ratings:{},rankings:{},seedings:{}};if(null!=n&&n.length){let e=e=>n.filter((t=>(null==t?void 0:t.itemType)===e)).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())).pop(),t=hr(n.map((({itemType:e})=>e)));for(let i of t){let t=e(i);if(t){let[,e,i,n,a]=t.itemType.split("."),o=a?`${n}.${a}`:n,s=(e===lo?"seedings":e===ao&&"rankings")||"ratings";r[s][i]||(r[s][i]=[]),r[s][i].push({scaleValue:t.itemValue,scaleDate:t.itemDate,scaleName:o})}}}return{...Be,...r}}function po(e){if(null===e)return{};let{source:t,template:i}=e||{};if(!i)return t;let n={};return function e(t,i,n){if(!t||!i)return;let r=Object.keys(t),a=Object.keys(i),o=Object.assign({},...a.filter((e=>e.indexOf("||"))).map((e=>e.split("||").map((t=>({[t]:e}))))).flat()),s=a.concat(...Object.keys(o)),l=s.includes("*");for(let u of r)if(s.indexOf(u)>=0||l){let r=i[o[u]||u]||l,a=t[u];if("object"!=typeof r||"function"==typeof a||Array.isArray(r)){let e=t[u];if(Array.isArray(r)&&!r.includes(e))return!1;(i[u]||l&&!1!==i[u])&&(n[u]=e)}else if(Array.isArray(a)){let t=a.map((t=>{let i={};return!1!==e(t,r,i)?i:void 0})).filter(Boolean);n[u]=t}else a&&(n[u]={},e(a,r,n[u]))}}(t,i,n),n}var mo=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,fo=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,ho=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,vo=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function go(e){let{scheduledDate:t}=e;if(!t&&e.scheduledTime&&(t=Co(e.scheduledTime)),!t)return;let i=Eo(e.scheduledTime),n=Co(t);return n&&i&&(n+=`T${i}`),n}function Io(e){return"object"==typeof e&&!Array.isArray(e)&&"[object Date]"===Object.prototype.toString.call(e)}function Uo(e){let t="string"==typeof e?null==e?void 0:e.split(" "):[];return!(e&&(null==t?void 0:t.length)>1&&!["AM","PM"].includes(t[1].toUpperCase()))&&!(e&&!vo.test(Fo(e,!0,!0)))}function yo(e){return Mo(e)||mo.test(e)}var So=e=>{let t=Po(e)||Mo(e)?new Date(e):new Date,i=t.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${t.getUTCFullYear()}-${Go(n)}-${Go(t.getUTCDate())}`};function wo(e,t="-",i="YMD"){if(!e)return"";"string"==typeof e&&e.indexOf("T")<0&&(e+="T00:00");let n=new Date(e),r=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),"DMY"===i?[a,r,o].join(t):"MDY"===i?[r,a,o].join(t):"YDM"===i?[o,a,r].join(t):"DYM"===i?[a,o,r].join(t):"MYD"===i?[r,o,a].join(t):[o,r,a].join(t)}function To(e){let t=e?new Date(e):new Date,i=t.getTimezoneOffset();return new Date(t.getTime()-60*i*1e3)}function Po(e){if("boolean"==typeof e)return!1;let t=e instanceof Date&&e||!isNaN(e)&&new Date(e)||!1;return t&&!isNaN(t.valueOf())}function Do(e,t){if(!yo(e)||!yo(t))return[];let i=Co(e)+"T00:00",n=Co(t)+"T00:00",r=new Date(i),a=new Date(n),o=[],s=0;if(Po(a)&&Po(r)&&r<=a){let e=r,t=e.getTime();for(;t<=a.getTime()&&s<300;)s+=1,o.push(new Date(e)),t=e.setDate(e.getDate()+1)}return o.map((e=>wo(e)))}var bo=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Mo(e){return"string"==typeof e&&bo.test(e)}function No(e){if("string"!=typeof e)return!1;let t=e.split("Z")[0].split(":"),i=t.every((e=>!isNaN(parseInt(e))));return!(t.length<2||!i||parseInt(t[0])>23||parseInt(t[1])>60)}function Ro(e){let t=Eo(e);if(!t)return 0;let[i,n]=t.split(":").map((e=>parseInt(e)));return 60*i+n}function Ao(e){return No(e)?e.split(":").slice(0,2).map(Go).join(":"):void 0}function Eo(e){return Mo(e)&&e.indexOf("T")>0?Ao(e.split("T").reverse()[0]):Ao(e)}function Co(e){return Mo(e)||ho.test(e)?e.split("T")[0]:void 0}function Oo(e,t){let i=new Date(e);return i.setDate(i.getDate()+t),Co(i.toISOString())}function ko(e){e="string"!=typeof e?"00:00":e;let t={},i={};return({0:t.time,1:t.ampm}=e.split(" ")||[]),({0:i.hours,1:i.minutes}=t.time.split(":")||[]),i.ampm=t.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Fo(e,t,i){let n=Co(e),r=Eo(e),a=n?r:e;return e?t&&(n&&i&&e||function(e){let t=ko(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&parseInt(t.hours)<12&&(t.hours=(t.hours&&parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),`${t.hours||"12"}:${t.minutes||"00"}`.split(":").map(Go).join(":")}(a))||function(e){var t;let i=ko(e);if("object"!=typeof i||Object.keys(i).length)return i.ampm?e:(i.hours>12?(i.hours-=12,i.ampm="PM"):"12"===i.hours?i.ampm="PM":("00"===i.hours&&(i.hours="12"),i.ampm="AM"),"0"===(null==(t=i.hours)?void 0:t[0])&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}(a):void 0}function xo(e,t){let i=ko(e),n=ko(t);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function Lo(e,t=7){let i=Co(e)+"T00:00",n=new Date(i);return wo(new Date(n.setDate(n.getDate()+t)))}function _o(e,t=void 0){let[i,n]=(e||"00:00").split(":").map(Go),r=To(t).setHours(i,n,0,0);return To(r)}function Bo(e,t,i=!0){let n=new Date(e),r=(new Date(t).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function jo(e,t){let i=Eo(e);if(!i)return"00:00";let n=isNaN(t)?0:t;return Eo(Vo(_o(i),n).toISOString())}function Vo(e,t){let i=new Date(e);return new Date(i.getTime()+6e4*t)}function Go(e){return e.toString()[1]?e:"0"+e}function $o(e,t){let i=new Date(e),n=new Date(t);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var qo={addDays:Lo,addWeek:function(e){return Lo(e)},addMinutesToTimeString:jo,convertTime:Fo,getIsoDateString:go,getUTCdateString:So,DateHHMM:function(e){let t=new Date(e);return function(e,t){let i=parseInt(e,10),n=Math.floor(i/3600),r=Math.floor((i-3600*n)/60),a=i-3600*n-60*r;return(!t||null!=t&&t.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Go).join(":")}(t.getSeconds()+60*t.getMinutes()+3600*t.getHours(),{displaySeconds:!1})},extractDate:Co,extractTime:Eo,formatDate:wo,getDateByWeek:function(e,t,i,n=!1){let r=new Date(t,0,1+7*(e-1)),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),wo(r,i)},isISODateString:Mo,isDate:Po,isTimeString:No,offsetDate:To,offsetTime:function(e){return To(e).getTime()},sameDay:$o,timeStringMinutes:Ro,timeToDate:_o,timeUTC:function(e){let t=Po(e)||Mo(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},validTimeValue:Uo,validDateString:mo,timeValidation:vo,dateValidation:ho};function Wo(e,t,i,n,r=0){if(va().makeDeepCopy)return va().makeDeepCopy(e,t,i,n);let a=Jr(),{stringify:o,toJSON:s,ignore:l,modulate:u}=a||{};if((null==a||!a.enabled)&&!i||"object"!=typeof e||Ae(e)||null===e||"number"==typeof(null==a?void 0:a.threshold)&&r>=a.threshold)return e;let d=Array.isArray(e)?[]:{},c=Object.keys(e).filter((e=>!i||!l||Array.isArray(l)&&!l.includes(e)||Ae(l)&&!l(e))),p=(e,t)=>{d[e]=Ae(null==t?void 0:t.toString)?t.toString():JSON.stringify(t)};for(let m of c){let a=e[m],l=Ae(u)?u(a):void 0;if(void 0!==l)d[m]=l;else if(t&&"extensions"===m&&Array.isArray(a)){let e=Ho(a);Object.assign(d,...e)}else n&&"extensions"===m?d[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,a):Array.isArray(s)&&s.includes(m)&&Ae(null==a?void 0:a.toJSON)?d[m]=a.toJSON():null===a?d[m]=void 0:Io(a)?d[m]=new Date(a).toISOString():d[m]=Wo(a,t,i,n,r+1)}return d}function Ho(e){return null==e?void 0:e.map((e=>{let{name:t,value:i}=e;return t&&i&&{[`_${t}`]:i}})).filter(Boolean)}var zo="voluntaryConsolation",Yo="competitiveBands",Ko="roundRobinTally",Jo="positionActions",Qo="matchUpActions",Zo="rankingPoints",Xo="roundNaming",es="participant",ts="progression",is="scheduling",ns="avoidance",rs="scoring",as="seeding",os="feedIn",ss="draws",ls={POLICY_TYPE_VOLUNTARY_CONSOLATION:zo,POLICY_TYPE_COMPETITIVE_BANDS:Yo,POLICY_TYPE_ROUND_ROBIN_TALLY:Ko,POLICY_TYPE_POSITION_ACTIONS:Jo,POLICY_TYPE_MATCHUP_ACTIONS:Qo,POLICY_TYPE_RANKING_POINTS:Zo,POLICY_TYPE_ROUND_NAMING:Xo,POLICY_TYPE_PARTICIPANT:es,POLICY_TYPE_PROGRESSION:ts,POLICY_TYPE_SCHEDULING:is,POLICY_TYPE_AVOIDANCE:ns,POLICY_TYPE_DISPLAY:"display",POLICY_TYPE_FEED_IN:os,POLICY_TYPE_SCORING:rs,POLICY_TYPE_SEEDING:as,POLICY_TYPE_AUDIT:"audit",POLICY_TYPE_DRAWS:ss};function us({tournamentParticipants:e=[],policyDefinitions:t={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let o=Wo(e.find((e=>n&&e.participantId===n||a&&e.person&&e.person.personId===a)),!1,r);if(o){let e=null==t?void 0:t[es];if(null!=i&&i.withScaleValues){let{ratings:e,rankings:t}=co({participant:o});o.rankings=t,o.ratings=e}if(null!=e&&e.participant)return po({template:e.participant,source:o})}return o}var ds="element required",cs="missing name";function ps(e){if(!e||"object"!=typeof e)return{error:mi};if(e.element&&"object"!=typeof(null==e?void 0:e.element))return{error:Fn};if(null==e||!e.name)return{error:mi,info:cs};if(null==e||!e.element){if(e.discover&&e.tournamentRecords){for(let t of Object.keys(e.tournamentRecords)){let i=ps({element:e.tournamentRecords[t],name:e.name});if(i.error)return Sa({result:i,stack:"removeExtension"})}return{...Be}}return{error:mi,info:ds}}return null!=e&&e.element.extensions?(e.element.extensions=e.element.extensions.filter((t=>(null==t?void 0:t.name)!==e.name)),{...Be}):{...Be,info:Vn}}function ms({requiredAttributes:e=["name","value"],extension:t}){if(!t||"object"!=typeof t||"string"!=typeof t.name)return!1;let i=Object.keys(t);return e.filter((e=>i.includes(e))).length===e.length}function fs(e){if("object"!=typeof e)return{error:mi};let t="addExtension";if(null!=e&&e.element&&"object"!=typeof e.element)return Sa({result:{error:Fn},stack:t});if(!ms({extension:e.extension}))return Sa({result:{error:Fn,info:"invalid extension"},stack:t});if(!e.element){if(e.discover&&!e.tournamentId&&e.tournamentRecords){for(let i of Object.values(e.tournamentRecords)){let n=fs({extension:e.extension,element:i});if(n.error)return Sa({result:n,stack:t})}return{...Be}}return Sa({result:{error:mi},stack:t})}if(e.element.extensions||(e.element.extensions=[]),(null==e?void 0:e.creationTime)??1){let t=(new Date).toISOString();Object.assign(e.extension,{createdAt:t})}let i=e.element.extensions.find((({name:t})=>t===e.extension.name));return i?i.value=e.extension.value:e.extension.value&&e.element.extensions.push(e.extension),{...Be}}function hs(e){return e&&"object"==typeof e?e.tournamentRecord?fs({creationTime:e.creationTime,element:e.tournamentRecord,extension:e.extension}):{error:We}:{error:mi}}function vs(e){return e&&"object"==typeof e?e.drawDefinition?fs({creationTime:e.creationTime,element:e.drawDefinition,extension:e.extension}):{error:Qe}:{error:mi}}function gs(e){return e&&"object"==typeof e?e.event?fs({creationTime:e.creationTime,extension:e.extension,element:e.event}):{error:Ct}:{error:mi}}function Is(e){var t;if(!e||"object"!=typeof e)return{error:mi};if(!e.participantId)return{error:_i};let i=(null==(t=e.tournamentRecord)?void 0:t.participants)||[],n=us({participantId:e.participantId,tournamentParticipants:i});return n?fs({creationTime:e.creationTime,extension:e.extension,element:n}):{error:Bi}}function Us(e){return e&&"object"==typeof e?e.tournamentRecord?ps({element:e.tournamentRecord,name:e.name}):{error:We}:{error:mi}}function ys(e){return e&&"object"==typeof e?e.drawDefinition?ps({element:e.drawDefinition,name:e.name}):{error:Qe}:{error:mi}}function Ss(e){return e&&"object"==typeof e?null!=e&&e.event?ps({element:e.event,name:e.name}):{error:Ct}:{error:mi}}function ws(e){var t;if(!e||"object"!=typeof e)return{error:mi};if(!e.participantId)return{error:_i};let i=(null==(t=e.tournamentRecord)?void 0:t.participants)||[],n=us({participantId:e.participantId,tournamentParticipants:i});return n?ps({element:n,name:e.name}):{error:Bi}}function Ts({tournamentRecords:e}){return{tournamentIds:Ce(e)?Object.keys(e):[],...Be}}var Ps="extensionQueries";function Ds({discover:e,element:t,name:i,...n}){var r;if(!t||!i){if(e&&n){let t=Object.keys(n).filter((t=>"boolean"==typeof e||Array.isArray(e)&&e.includes(t))).find((e=>{var t;return!!Array.isArray(null==(t=n[e])?void 0:t.extensions)&&n[e].extensions.find((e=>(null==e?void 0:e.name)===i))})),a=t&&n[t];!a&&n.tournamentRecords&&(a=Object.values(n.tournamentRecords).find((e=>{var t;return null==(t=e.extensions)?void 0:t.length})));let o=null==(r=null==a?void 0:a.extensions)?void 0:r.find((e=>(null==e?void 0:e.name)===i));return{extension:o,info:o?void 0:Vn}}return Sa({result:{error:mi},stack:Ps})}if(!Array.isArray(t.extensions))return{info:"no extensions"};let a=t.extensions.find((e=>(null==e?void 0:e.name)===i));return{extension:a,info:a?void 0:Vn}}var bs="appliedPolicies",Ms="positionActions",Ns="context",Rs="delegatedOutcome",As="disabled",Es="disableLinks",Cs="disableAutoCalc",Os="drawDeletions",ks="entryProfile",Fs="flightProfile",xs="groupingAttribute",Ls="lineUps",_s="linkedTournamentsIds",Bs="matchUpHistory",js="participantRepresentatives",Vs="personRequests",Gs="roundTarget",$s="scheduleLimits",qs="scheduleTiming",Ws="schedulingProfile",Hs="subOrder",zs="tally",Ys="tieFormatModification",Ks={ACTIVE_SUSPENSION:"activeSuspension",APPLIED_POLICIES:bs,AUDIT_POSITION_ACTIONS:Ms,CONTEXT:Ns,DELEGATED_OUTCOME:Rs,DISABLED:As,DISABLE_LINKS:Es,DISABLE_AUTO_CALC:Cs,DRAW_DELETIONS:Os,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:ks,EVENT_PROFILE:"eventProfile",EVENT_WITHDRAWAL_REQUESTS:"eventWithdrawalRequests",FLIGHT_PROFILE:Fs,GROUPING_ATTRIBUTE:xs,LINEUPS:Ls,LINKED_TOURNAMENTS:_s,MATCHUP_HISTORY:Bs,PARTICIPANT_REPRESENTATIVES:js,PERSON_REQUESTS:Vs,RANKING_POINTS:"rankingPoints",ROUND_TARGET:Gs,SCHEDULE_LIMITS:$s,SCHEDULE_TIMING:qs,SCHEDULING_PROFILE:Ws,STATUS_DETAIL:"statusDetail",SUB_ORDER:Hs,TALLY:zs,TIE_FORMAT_MODIFICATIONS:Ys,FACTORY:"factory"},Js=[Rs,As,Es,Fs,Ls,Bs,js,Vs,Gs,$s,qs,Ws,Hs,zs];function Qs({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:qe};let t=Ts({tournamentRecords:e}),{tournamentIds:i}=t;return(null==i?void 0:i.length)>1?fs({tournamentRecords:e,discover:!0,extension:{name:_s,value:{tournamentIds:i}}}):{...Be}}function Zs({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:qe};return Sa({result:ps({name:_s,tournamentRecords:e,discover:!0}),stack:"unlinkTournaments"})}function Xs({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e)return{error:Fn};if(!t)return{error:ze};let i,n=Ts({tournamentRecords:e}),{tournamentIds:r}=n;return r.includes(t)?(r.every((n=>{var r;let a=e[n],{extension:o}=Ds({element:a,name:_s});if(!o)return!0;let s=(null==(r=null==o?void 0:o.value)?void 0:r.tournamentIds)||[];if(null==s||!s.length||1===s.length&&s.includes(t)||n===t){let e=Us({name:_s,tournamentRecord:a});return e.error&&(i=e.error),e.success}let l=s.filter((e=>e!==t));o.value={tournamentIds:l};let u=hs({tournamentRecord:a,extension:o});return u.error&&(i=u.error),u.success})),i?{error:i}:{...Be}):{error:ze}}var el={};function tl({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?{linkedTournamentIds:Object.assign({},...Object.keys(e).map((t=>{var i;let n=e[t],r=null==n?void 0:n.tournamentId,{extension:a}=Ds({element:n,name:_s});return{[t]:((null==(i=null==a?void 0:a.value)?void 0:i.tournamentIds)||[]).filter((e=>e!==r))}})))}:{error:qe}}be(el,{getLinkedTournamentIds:()=>tl,getTournamentIds:()=>Ts});var il={};be(il,{addAdHocMatchUps:()=>MU,addDrawDefinitionTimeItem:()=>bg,addFinishingRounds:()=>qd,addGoesTo:()=>cf,addPlayoffStructures:()=>hU,addQualifyingStructure:()=>jg,addVoluntaryConsolationStage:()=>Og,addVoluntaryConsolationStructure:()=>Qh,allPlayoffPositionsFilled:()=>Wv,alternateDrawPositionAssignment:()=>Av,assignDrawPosition:()=>TU,assignDrawPositionBye:()=>qf,attachConsolationStructures:()=>pU,attachPlayoffStructures:()=>mU,attachQualifyingStructure:()=>Pg,attachStructures:()=>fU,autoSeeding:()=>Ub,automatedPlayoffPositioning:()=>vg,automatedPositioning:()=>hg,checkValidEntries:()=>zy,deleteAdHocMatchUps:()=>DU,drawMatic:()=>pP,findDrawDefinition:()=>FU,generateAdHocMatchUps:()=>vS,generateAdHocRounds:()=>dP,generateAndPopulatePlayoffStructures:()=>cU,generateDrawDefinition:()=>gb,generateDrawMaticRound:()=>bS,generateDrawStructuresAndLinks:()=>eS,generateDrawTypeAndModifyDrawDefinition:()=>tS,generateQualifyingStructure:()=>Bg,generateVoluntaryConsolation:()=>MS,getAssignedParticipantIds:()=>Xf,getAvailableMatchUpsCount:()=>EU,getAvailablePlayoffProfiles:()=>Jg,getDrawDefinitionTimeItem:()=>gf,getDrawParticipantRepresentativeIds:()=>CU,getDrawTypeCoercion:()=>Gy,getEligibleVoluntaryConsolationParticipants:()=>AU,getMatchUpsMap:()=>Wd,getParticipantIdFinishingPositions:()=>OU,getPositionAssignments:()=>$y,getPositionsPlayedOff:()=>Yg,getSeedingThresholds:()=>ov,getSeedsCount:()=>Hy,getStructureSeedAssignments:()=>Nc,getTeamLineUp:()=>Dm,getValidGroupSizes:()=>nv,isAdHoc:()=>Nm,isCompletedStructure:()=>qv,isValidForQualifying:()=>qy,luckyLoserDrawPositionAssignment:()=>Rv,modifyDrawDefinition:()=>UU,modifyDrawName:()=>IU,modifySeedAssignment:()=>jv,mutate:()=>nl,positionActions:()=>Vy,pruneDrawDefinition:()=>wU,qualifierDrawPositionAssignment:()=>xv,query:()=>RU,removeDrawPositionAssignment:()=>Wh,removeRoundMatchUps:()=>bU,removeSeededParticipant:()=>kg,removeStructure:()=>Mg,renameStructures:()=>Dg,resetDrawDefinition:()=>yU,resetVoluntaryConsolationStructure:()=>Dd,setDrawParticipantRepresentativeIds:()=>dl,setPositionAssignments:()=>kv,setStructureOrder:()=>gg,setSubOrder:()=>NU,shiftAdHocRounds:()=>Ov,swapAdHocRounds:()=>Fv,swapDrawPositionAssignments:()=>Bv,updateTeamLineUp:()=>Dv,withdrawParticipantAtDrawPosition:()=>Hh});var nl={};be(nl,{addAdHocMatchUps:()=>MU,addDrawDefinitionTimeItem:()=>bg,addPlayoffStructures:()=>hU,addQualifyingStructure:()=>jg,addVoluntaryConsolationStage:()=>Og,addVoluntaryConsolationStructure:()=>Qh,alternateDrawPositionAssignment:()=>Av,assignDrawPosition:()=>TU,assignDrawPositionBye:()=>qf,attachConsolationStructures:()=>pU,attachPlayoffStructures:()=>mU,attachQualifyingStructure:()=>Pg,attachStructures:()=>fU,automatedPlayoffPositioning:()=>vg,automatedPositioning:()=>hg,deleteAdHocMatchUps:()=>DU,luckyLoserDrawPositionAssignment:()=>Rv,modifyDrawDefinition:()=>UU,modifyDrawName:()=>IU,modifySeedAssignment:()=>jv,pruneDrawDefinition:()=>wU,qualifierDrawPositionAssignment:()=>xv,removeDrawPositionAssignment:()=>Wh,removeRoundMatchUps:()=>bU,removeSeededParticipant:()=>kg,removeStructure:()=>Mg,renameStructures:()=>Dg,resetDrawDefinition:()=>yU,resetVoluntaryConsolationStructure:()=>Dd,setDrawParticipantRepresentativeIds:()=>dl,setPositionAssignments:()=>kv,setStructureOrder:()=>gg,setSubOrder:()=>NU,shiftAdHocRounds:()=>Ov,swapAdHocRounds:()=>Fv,swapDrawPositionAssignments:()=>Bv,updateTeamLineUp:()=>Dv,withdrawParticipantAtDrawPosition:()=>Hh});var rl=e=>t=>e[t],al=(e=[])=>e.map(ll).filter(Boolean),ol=(e=[])=>e.map(sl).filter(Boolean),sl=(e={})=>rl(e)("participantId"),ll=(e={})=>rl(e)("matchUpId"),ul=(e={})=>rl(e)("drawId");function dl({representativeParticipantIds:e,drawDefinition:t}){if(!t)return{error:Qe};if(!Array.isArray(e))return{error:Fn};let i=ol((null==t?void 0:t.entries)||[]);return e.length&&Nr(e,i).length<e.length?{error:Fn}:vs({drawDefinition:t,extension:{name:js,value:e}})}var cl="ABANDONED",pl="AWAITING_RESULT",ml="BYE",fl="CANCELLED",hl="COMPLETED",vl="DEAD_RUBBER",gl="DEFAULTED",Il="DOUBLE_DEFAULT",Ul="DOUBLE_WALKOVER",yl="IN_PROGRESS",Sl="INCOMPLETE",wl="NOT_PLAYED",Tl="RETIRED",Pl="SUSPENDED",Dl="TO_BE_PLAYED",bl="WALKOVER",Ml=[pl,hl,gl,yl,Sl,Tl,Pl],Nl=[pl,hl,gl,Ul,Il,yl,Sl,Tl,Pl,bl],Rl=[cl,pl,ml,fl,hl,vl,gl,Ul,Il,yl,Sl,wl,Tl,Pl,Dl,bl],Al=[ml,Ul,Il,hl,gl,Tl,bl],El=[cl,pl,fl,vl,yl,Sl,wl,Pl,Dl,void 0],Cl=[fl,cl,hl,vl,gl,Ul,Il,Tl,bl],Ol=[cl,hl,gl,Ul,Il,yl,Tl,bl],kl=[yl,Sl,Pl,Dl],Fl={ABANDONED:cl,AWAITING_RESULT:pl,BYE:ml,CANCELLED:fl,COMPLETED:hl,DEAD_RUBBER:vl,DEFAULTED:gl,DOUBLE_WALKOVER:Ul,DOUBLE_DEFAULT:Il,IN_PROGRESS:yl,INCOMPLETE:Sl,NOT_PLAYED:wl,RETIRED:Tl,SUSPENDED:Pl,TO_BE_PLAYED:Dl,WALKOVER:bl},xl="MAIN",Ll="QUALIFYING",_l="CONSOLATION",Bl="VOLUNTARY_CONSOLATION",jl="PLAY_OFF",Vl=[xl,Ll,_l,jl,Bl],Gl={[Ll]:1,[xl]:2,[jl]:3,[_l]:3,[Bl]:4},$l="finishingPositions",ql="aggregateEventStructures",Wl={[xl]:1,[jl]:2,[_l]:3,[Ll]:4,[Bl]:5},Hl={[jl]:1,[xl]:2,[_l]:3,[Ll]:4,[Bl]:5},zl="CLUSTER",Yl="WATERFALL",Kl="ITEM",Jl="CONTAINER",Ql="DRAW",Zl="RANDOM",Xl="TOP_DOWN",eu="BOTTOM_UP",tu="POSITION",iu="WINNER",nu="LOSER",ru="FIRST_MATCHUP",au="AD_HOC",ou="FEED_IN",su="COMPASS",lu="OLYMPIC",uu="SINGLE_ELIMINATION",du="DOUBLE_ELIMINATION",cu="FIRST_MATCH_LOSER_CONSOLATION",pu="FIRST_ROUND_LOSER_CONSOLATION",mu="LUCKY_DRAW",fu="CURTIS_CONSOLATION",hu="CURTIS_CONSOLATION",vu="FEED_IN_CHAMPIONSHIP_TO_SF",gu="FEED_IN_CHAMPIONSHIP_TO_SF",Iu="FEED_IN_CHAMPIONSHIP_TO_QF",Uu="FEED_IN_CHAMPIONSHIP_TO_QF",yu="FEED_IN_CHAMPIONSHIP_TO_R16",Su="FEED_IN_CHAMPIONSHIP_TO_R16",wu="MODIFIED_FEED_IN_CHAMPIONSHIP",Tu="MODIFIED_FEED_IN_CHAMPIONSHIP",Pu="FEED_IN_CHAMPIONSHIP",Du="ROUND_ROBIN",bu="ROUND_ROBIN_WITH_PLAYOFF",Mu="DECIDER",Nu="BACKDRAW",Ru={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Au={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Eu="WIN_RATIO",Cu="ROUND_OUTCOME",Ou=[su,fu,Uu,Su,gu,Pu,Iu,yu,vu,cu,pu,mu,Tu,lu,jl,bu],ku={MAIN:xl,QUALIFYING:Ll,CONSOLATION:_l,ITEM:Kl,CONTAINER:Jl,FIRST_MATCHUP:ru,WINNER:iu,LOSER:nu,AD_HOC:au,FEED_IN:ou,FLEX_ROUNDS:"AD_HOC",COMPASS:su,PLAY_OFF:jl,OLYMPIC:lu,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:uu,DOUBLE_ELIMINATION:du,CURTIS:fu,FICSF:vu,FICQF:Iu,FICR16:yu,MFIC:wu,VOLUNTARY_CONSOLATION:Bl,FIRST_MATCH_LOSER_CONSOLATION:cu,FIRST_ROUND_LOSER_CONSOLATION:pu,MODIFIED_FEED_IN_CHAMPIONSHIP:Tu,FEED_IN_CHAMPIONSHIP_TO_R16:Su,FEED_IN_CHAMPIONSHIP_TO_QF:Uu,FEED_IN_CHAMPIONSHIP_TO_SF:gu,FEED_IN_CHAMPIONSHIP:Pu,LUCKY_DRAW:mu,ROUND_ROBIN_WITH_PLAYOFF:bu,ROUND_ROBIN:Du,DECIDER:Mu,BACKDRAW:Nu,COMPASS_ATTRIBUTES:Ru,OLYMPIC_ATTRIBUTES:Au,DRAW:Ql,RANDOM:Zl,TOP_DOWN:Xl,BOTTOM_UP:eu,WATERFALL:Yl,WIN_RATIO:Eu,ROUND_OUTCOME:Cu,MULTI_STRUCTURE_DRAWS:Ou,generatedDrawTypes:[au,su,fu,du,Uu,Su,gu,Pu,ou,cu,pu,mu,Tu,lu,jl,Du,bu,uu],stageOrder:Gl,finishOrder:Wl,AGGREGATE_EVENT_STRUCTURES:ql,FINISHING_POSITIONS:$l},Fu=ku;function xu(e,t,i){var n,r;let a=e=>{var t,i;return null==(i=null==(t=Ds({element:e,name:Gs}))?void 0:t.extension)?void 0:i.value},o=null==i?void 0:i.deprioritizeCompleted,s=(null==i?void 0:i.mode)===ql&&Hl,l=(null==i?void 0:i.mode)===$l&&Wl,u=l||s||Gl,d=e=>(e=>(null==e?void 0:e.stage)===xl&&1===(null==e?void 0:e.stageSequence))(e)?-1:u[null==e?void 0:e.stage],c=e=>null==e?void 0:e.matchUps.every((({matchUpStatus:e})=>Cl.includes(e)?1:-1));return o&&c(e)-c(t)||s&&d(e)-d(t)||((null==e?void 0:e.stage)&&u[e.stage]||0)-((null==t?void 0:t.stage)&&u[t.stage]||0)||(a(e)||0)-(a(t)||0)||!l&&!s&&((null==(n=null==t?void 0:t.positionAssignments)?void 0:n.length)??1/0)-((null==(r=null==e?void 0:e.positionAssignments)?void 0:r.length)??1/0)||((null==e?void 0:e.stageSequence)??0)-((null==t?void 0:t.stageSequence)??0)||(Lu(e)||0)-(Lu(t)||0)}function Lu(e){return((null==e?void 0:e.matchUps)||[]).reduce(((e,t)=>{var i;let n=((null==(i=t.finishingPositionRange)?void 0:i.winner)||[]).reduce(((e,t)=>e+t),0);return!e||n<e?n:e}),void 0)}function _u(e){let t=io(e,[{[Da]:!0,[Ra]:!0}]);if(t.error)return t;let{drawDefinition:i,structureId:n}=e,{structures:r}=Bu({drawDefinition:i}),a=null==r?void 0:r.map((e=>e.structures?[...e.structures].concat(e):e)).flat(),o=null==a?void 0:a.find((e=>e.structureId===n));return o?{structure:o,containingStructure:o.structureType===Kl?null==a?void 0:a.find((e=>{var t;return null==(t=e.structures)?void 0:t.some((e=>e.structureId===n))})):void 0}:{error:bt}}function Bu({withStageGrouping:e,drawDefinition:t,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:o,stage:s}){var l;let u=!t&&Ke||!(null!=t&&t.structures)&&Mt||void 0;if(u)return{error:u,structures:[],stageStructures:{}};let d=(null==(l=null==t?void 0:t.structures)?void 0:l.filter((function(e){return!s&&!Array.isArray(o)||s&&e.stage===s||Array.isArray(o)&&o.includes(e.stage)})).filter((function(e){return!n&&!Array.isArray(i)||n&&e.stageSequence===n||Array.isArray(i)&&i.includes(e.stageSequence)})).filter((e=>{var t,i;let n=null==(i=null==(t=Ds({element:e,name:Gs}))?void 0:t.extension)?void 0:i.value;return!r||r===n})).sort(((e,t)=>xu(e,t,a))))??[],c=e?Object.assign({},...Vl.map((e=>{let t=null==d?void 0:d.filter((t=>t.stage===e));return(null==t?void 0:t.length)&&{[e]:t}})).filter(Boolean)):{};return{structures:d,stageStructures:c}}function ju({drawDefinition:e}){if(!e)return{error:Ke};let t={};return{allPositionedParticipantIds:(e.structures||[]).map((e=>{let i=e.stage;t[i]||(t[i]=[]);let{positionAssignments:n}=Vu({structure:e}),r=(null==n?void 0:n.map(sl).filter(Boolean))??[];return t[i].push(...r),r})).flat(),stagePositionedParticipantIds:t}}function Vu({drawDefinition:e,structureId:t,structure:i}){let n,r=[];if(!i){if(!e)return{positionAssignments:r,error:Ke};if(({structure:i,error:n}=_u({drawDefinition:e,structureId:t})),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map((e=>Vu({structure:e}).positionAssignments))):i.positionAssignments?r=i.positionAssignments:n=jt,{positionAssignments:r,error:n}}function Gu({drawDefinition:e,structureId:t,structure:i}){var n;let r=(null==(n=Vu({drawDefinition:e,structureId:t,structure:i}))?void 0:n.positionAssignments)||[],a=null==r?void 0:r.filter((e=>e.participantId??e.bye??e.qualifier)),o=r&&(null==r?void 0:r.length)===(null==a?void 0:a.length),s=null==r?void 0:r.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)),l=null==r?void 0:r.filter((e=>!e.participantId&&e.bye)),u=null==r?void 0:r.filter((e=>!e.participantId&&e.qualifier));return{allPositionsAssigned:o,positionAssignments:r,unassignedPositions:s,assignedPositions:a,qualifierPositions:u,byePositions:l}}var $u="addDrawDefinition",qu="addMatchUps",Wu="addParticipants",Hu="addScaleItems",zu="addVenue",Yu="audit",Ku="deleteParticipants",Ju="deleteVenue",Qu="deletedDrawIds",Zu="deletedMatchUpIds",Xu="modifyDrawDefinition",ed="modifyDrawEntries",td="modifyEventEntries",id="modifyMatchUp",nd="modifyParticipants",rd="modifyPositionAssignments",ad="modifySeedAssignments",od="modifyTournamentDetail",sd="modifyVenue",ld="mutations",ud="publishEvent",dd="publishEventSeeding",cd="publishOrderOfPlay",pd="unPublishEvent",md="unPublishEventSeeding",fd="unPublishOrderOfPlay",hd="updateInContextMatchUp",vd={ADD_DRAW_DEFINITION:$u,ADD_MATCHUPS:qu,ADD_PARTICIPANTS:Wu,ADD_SCALE_ITEMS:Hu,ADD_VENUE:zu,AUDIT:Yu,DELETE_PARTICIPANTS:Ku,DELETE_VENUE:Ju,DELETED_DRAW_IDS:Qu,DELETED_MATCHUP_IDS:Zu,MODIFY_DRAW_DEFINITION:Xu,MODIFY_DRAW_ENTRIES:ed,MODIFY_EVENT_ENTRIES:td,MODIFY_MATCHUP:id,MODIFY_PARTICIPANTS:nd,MODIFY_POSITION_ASSIGNMENTS:rd,MODIFY_SEED_ASSIGNMENTS:ad,MODIFY_TOURNAMENT_DETAIL:od,MODIFY_VENUE:sd,MUTATIONS:ld,PUBLISH_EVENT_SEEDING:dd,PUBLISH_EVENT:ud,PUBLISH_ORDER_OF_PLAY:cd,UNPUBLISH_EVENT_SEEDING:md,UNPUBLISH_EVENT:pd,UNPUBLISH_ORDER_OF_PLAY:fd,UPDATE_INCONTEXT_MATCHUP:hd};function gd(e,t){var i;if(!e)return{error:Ke};let n=Date.now();e.updatedAt&&n===new Date(e.updatedAt).getTime()&&(n+=1);let r=new Date(n).toISOString(),a=null==t?void 0:t.filter(Boolean);return e.updatedAt=r,null==(i=e.structures)||i.filter(Boolean).forEach((e=>{(null==a||!a.length||null!=a&&a.includes(e.structureId))&&(e.updatedAt=r)})),{...Be}}function Id({drawDefinition:e,tournamentId:t,matchUps:i,eventId:n}){return e&&gd(e),ia({payload:{matchUps:i,tournamentId:t,eventId:n},topic:qu}),{...Be}}function Ud({drawDefinition:e,tournamentId:t,matchUpIds:i,eventId:n,action:r}){e&&gd(e),ia({topic:Zu,payload:{tournamentId:t,matchUpIds:i,eventId:n,action:r}});for(let a of i)aa({key:a});return{...Be}}function yd({drawDefinition:e,tournamentId:t,structureId:i,context:n,eventId:r,matchUp:a}){return a?(e&&wd({drawDefinition:e,structureIds:i?[i]:void 0,tournamentId:t,eventId:r}),ia({topic:id,payload:{matchUp:a,tournamentId:t,context:n},key:a.matchUpId}),{...Be}):(console.log(ti),{error:ti})}function Sd({tournamentId:e,eventId:t,drawDefinition:i}){return i?(gd(i),ia({payload:{drawDefinition:i,tournamentId:e,eventId:t},topic:$u,key:i.drawId}),{...Be}):(console.log(Ke),{error:Ke})}function wd({drawDefinition:e,tournamentId:t,structureIds:i,eventId:n}){return e?(gd(e,i),ia({payload:{tournamentId:t,eventId:n,drawDefinition:e},topic:Xu,key:e.drawId}),{...Be}):{error:Ke}}function Td({drawDefinition:e,tournamentId:t,structure:i,eventId:n}){if(!e)return{error:Ke};if(!i)return{error:Nt};let r=i.seedAssignments,a=i.structureId;return ia({payload:{tournamentId:t,eventId:n,drawId:e.drawId,structureId:a,seedAssignments:r},topic:ad,key:e.drawId}),wd({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:n}),{...Be}}function Pd({drawDefinition:e,tournamentId:t,structure:i,event:n}){if(!e)return{error:Ke};if(!i)return{error:Nt};let r=Vu({structure:i}),a=i.structureId,o=e.drawId,s=null==n?void 0:n.eventId;return ia({topic:rd,payload:{positionAssignments:r,tournamentId:t,structureId:a,eventId:s,drawId:o},key:a}),wd({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:s}),{...Be}}function Dd({tournamentRecord:e,drawDefinition:t,resetEntries:i,event:n}){var r,a;if(!t)return{error:Ke};let o=null==(r=t.structures)?void 0:r.find((e=>e.stage===Bl));if(!o)return{error:bt};let s=(null==(a=o.matchUps)?void 0:a.map((({matchUpId:e})=>e)))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],Ud({tournamentId:null==e?void 0:e.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:t}),i&&(t.entries=t.entries.filter((e=>e.entryStage!==Bl))),wd({tournamentId:null==e?void 0:e.tournamentId,eventId:null==n?void 0:n.eventId,drawDefinition:t,structureIds:[o.structureId]}),{...Be}}function bd({drawPositions:e,structure:t}){var i;if([Ll,xl].includes(t.stage)&&1===t.stageSequence)return;let{positionAssignments:n}=Vu({structure:t});null==(i=null==n?void 0:n.filter((({drawPosition:t})=>null==e?void 0:e.includes(t))))||i.forEach((e=>{fs({element:e,extension:{name:Es,value:!0}})}))}function Md({drawDefinition:e,positionAction:t}){var i;let{extension:n}=Ds({name:Ms,element:e}),r=Array.isArray(null==n?void 0:n.value)?(null==n?void 0:n.value)??[]:[];if(null==r||!r.length){let t=e.structures.find((e=>e.stage===xl));if(t){let e=null==(i=Vu({structure:t}).positionAssignments)?void 0:i.map((({drawPosition:e,participantId:t,bye:i,qualifier:n})=>({drawPosition:e,participantId:t,qualifier:n,bye:i})));r.push({name:"initialMainAssignments",initialAssignments:e})}}fs({element:e,extension:{name:Ms,value:r.concat(t)}})}function Nd({tournamentRecord:e,drawDefinition:t,event:i}){var n;let r=(null==(n=(null==e?void 0:e.events)||i&&[i])?void 0:n.map((e=>null==e?void 0:e.drawDefinitions)).flat().filter(Boolean))||t&&[t]||[],a={},o={},s=r.map((e=>{var t;return null==(t=null==e?void 0:e.structures)?void 0:t.filter((e=>null==e?void 0:e.structures))})).flat().filter(Boolean);for(let l of s){let{structures:e,structureId:t}=l??{};e&&t&&(a[t]=null==e?void 0:e.map((e=>e.structureId)))&&e.forEach((e=>o[e.structureId]=null==l?void 0:l.structureId))}return{containedStructures:a,containerStructures:o}}var Rd="SINGLES",Ad="SINGLES",Ed="DOUBLES",Cd="DOUBLES",Od="TEAM",kd="TEAM",Fd={SINGLES_MATCHUP:Rd,SINGLES:Ad,DOUBLES_MATCHUP:Ed,DOUBLES:Cd,TEAM_MATCHUP:Od,TEAM:kd};function xd(e){var t;let{sides:i,matchUpType:n}=e||{},r=null!=(t=e.potentialParticipants)&&t.length?e.potentialParticipants.flat().map((e=>n===Cd?(null==e?void 0:e.individualParticipantIds)||[]:e.participantId)).flat():[],a=(i||[]).map((e=>{var t;return n===Cd&&((null==(t=null==e?void 0:e.participant)?void 0:t.individualParticipantIds)||[])||(null==e?void 0:e.participantId)&&[e.participantId]||[]})).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function Ld(e){return(null==e?void 0:e.tournamentRecords)??((null==e?void 0:e.tournamentRecord)&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{}}function _d(e){if(!Ce(e))return!1;let{matchUpId:t,drawPositions:i}=e,n="string"==typeof t,r=!i||Array.isArray(i)&&i.length<=2&&i.every((e=>mr(e)||null==e));return n&&r}function Bd(e){return!!Array.isArray(e)&&e.every(_d)}function jd({matchUps:e=[],interpolate:t}){var i;if(!Bd(e))return{roundMatchUps:[],error:Fn};let n=e.reduce(((e,t)=>{let i="string"==typeof t.roundNumber?rr(t.roundNumber):t.roundNumber;return!t.roundNumber||e.includes(i)?e:e.concat(i)}),[]).sort(nr).map((t=>{let i=e.filter((e=>e.roundNumber===t)),n=i.find((({matchUpType:e})=>e===kd))?i.filter((({matchUpType:e})=>e===kd)):i;return{[t]:(r=n,r.sort(((e,t)=>nr(e.roundPosition,t.roundPosition))))};var r})),r=e.reduce(((e,t)=>{let i="string"==typeof t.roundNumber?rr(t.roundNumber):t.roundNumber;return e[i]||(e[i]=ya({abbreviatedRoundName:t.abbreviatedRoundName,finishingRound:t.finishingRound,roundName:t.roundName})),e}),{}),a=Object.assign({},...n);if(t){let e=Math.max(...Object.keys(a).map((e=>rr(e))).filter((e=>!isNaN(e)))),t=null==(i=a[e])?void 0:i.length;if(t>1&&ar(t)){let i=e+1;br(i,i+t/2).forEach(((e,i)=>{a[e]=br(0,t/(2+2*i)).map((()=>({})))}))}}let o=0,s=Object.assign({},...Object.keys(a).map((e=>{var t,i,n;let r=null==(t=a[e])?void 0:t.length,s=null==(n=null==(i=a[e])?void 0:i.filter((e=>{var t;return!(Cl.includes(e.matchUpStatus)||null!=(t=e.score)&&t.scoreStringSide1)})))?void 0:n.length,l=r&&r===s;return o=Math.max(o,r),{[e]:{matchUpsCount:r,inactiveCount:s,inactiveRound:l}}}))),l=0,u=0,d=Object.keys(a).map((e=>rr(e))).filter((e=>!isNaN(e)));d.forEach((e=>{var t,i,n,d,c;let p=a[e].sort(((e,t)=>e.roundPosition-t.roundPosition)),m=p.map((e=>(null==e?void 0:e.drawPositions)||[])).flat();if(s[e].roundNumber=e,s[e].roundFactor=s[e].matchUpsCount?o/s[e].matchUpsCount:1,s[e].finishingRound=null==(t=r[e])?void 0:t.finishingRound,s[e].roundName=null==(i=r[e])?void 0:i.roundName,s[e].abbreviatedRoundName=null==(n=r[e])?void 0:n.abbreviatedRoundName,s[e].finishingPositionRange=null==(c=null==(d=a[e])?void 0:d[0])?void 0:c.finishingPositionRange,1!==e&&s[e-1]){let t=s[e-1],i=t.drawPositions,n=t.matchUpsCount/s[e].matchUpsCount,r=Or(i,n),a=p.map((t=>{let{roundPosition:n}=t,a=[...t.drawPositions||[],void 0,void 0].slice(0,2);if(!n)return a;let o=(null==a?void 0:a.filter(Boolean))||[];if(null==o||!o.length)return[void 0,void 0];if(e<3&&2===(null==o?void 0:o.length))return null==a?void 0:a.slice().sort(nr);let s=Nr(i,o).length!==(null==o?void 0:o.length);if(null!=o&&o.length&&s)return 1===(null==o?void 0:o.length)?[o[0],void 0]:null==a?void 0:a.slice().sort(nr);let l=2*(n-1);return r.slice(l,l+2).map((e=>null==o?void 0:o.find((t=>e.includes(t)))))}));s[e].drawPositions=null==a?void 0:a.flat(),s[e].pairedDrawPositions=a}else{let t=m.sort(nr),i=Or(t,2);s[e].drawPositions=t,s[e].pairedDrawPositions=i}s[e+1]&&s[e+1].matchUpsCount===s[e].matchUpsCount&&(s[e+1].feedRound=!0,s[e+1].feedRoundIndex=u,s[e].preFeedRound=!0,u+=1),s[e]&&!s[e].feedRound&&(s[e].roundIndex=l,l+=1)}));let c=!!Object.values(s).find((({matchUpsCount:e})=>!ar(e)));return{hasNoRoundPositions:e.some((e=>!e.roundPosition)),roundsNotPowerOf2:c,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:d,roundProfile:s,...Be}}function Vd({element:e,accessor:t}){if("string"!=typeof t)return{values:[]};let i,n=Wo(e),r=t.split("."),a=[];!function e({targetElement:t,attributes:n=[],significantCharacters:r}){for(let[s,l]of n.entries())if(null!=t&&t[l]){let r=n.slice(s+1);r.length?Array.isArray(t[l])?t[l].forEach((t=>e({targetElement:t,attributes:r}))):o({targetElement:t=t[l],index:s}):(i||(i=t[l]),a.includes(t[l])||a.push(t[l]))}function o({targetElement:e,index:t}){if(e&&t===n.length-1&&["string","number"].includes(typeof e)){let t=r?e.slice(0,r):e;i?a.includes(t)||a.push(t):(i=t,a.push(t))}}}({targetElement:n,attributes:r});let o={value:i};return a.length&&(o.values=a),o}var Gd=e=>t=>{var i;return e&&"object"==typeof t?Array.isArray(e)&&e.map((e=>{var i;return{[e]:null==(i=Vd({element:t,accessor:e}))?void 0:i.value}}))||"object"==typeof e&&Object.keys(e).map((e=>{var i;return{[e]:null==(i=Vd({element:t,accessor:e}))?void 0:i.value}}))||(null==(i="string"==typeof e&&Vd({element:t,accessor:e}))?void 0:i.value):void 0},$d=Gd;function qd({finishingPositionOffset:e=0,finishingPositionLimit:t,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:o,fmlc:s}){var l;if(!Bd(a))return[];let{roundProfile:u,roundNumbers:d=[]}=jd({interpolate:!0,matchUps:a});n=n??Math.max(...d,0);let c=r?n-r:0,p=c&&(null==(l=null==u?void 0:u[n-c])?void 0:l.matchUpsCount),m=u&&Object.values(u).map($d("matchUpsCount")),f=(e,i)=>{let n=Math.min(...e);p&&i&&1===n&&(n=p);let r=Math.max(...e);return t&&r>t&&(r=t),[n,r]},h=u&&Object.assign({},...d.map((t=>{let r=(n??0)+1-t-c,a=u[t].matchUpsCount,l={finishingPositionRange:{},finishingRound:r},d=null==m?void 0:m.slice(t-1).reduce(((e,t)=>e+(t||0)),0),p=1+e+(s&&1!==t?i??0:0),h=br(p,o?p+2*a:d+p+1),v=d+1-a,g=f(h.slice(v)),I=f(h.slice(0,v),!0);return l.finishingPositionRange={loser:g,winner:I},{[t]:l}}))),v=$r({finishingRound:!0});return a.filter(Boolean).forEach((e=>{let t=e.roundNumber&&h[e.roundNumber];v&&!t&&console.log({roundFinishingData:h,matchUp:e}),e.finishingRound=null==t?void 0:t.finishingRound,e.finishingPositionRange=null==t?void 0:t.finishingPositionRange})),a}function Wd({drawDefinition:e,structure:t}){let i={},n=[];return((null==e?void 0:e.structures)??[t]).filter((e=>e&&"object"==typeof e)).forEach((e=>{if(!e)return;let{structureId:t,matchUps:r,structures:a}=e,o=Array.isArray(a);if(o)o&&a.forEach((e=>{let{structureName:r}=e,a=e.matchUps;i[e.structureId]={matchUps:a,itemStructureIds:[],structureName:r},a&&(n.push(...a),a.forEach((e=>{e.tieMatchUps&&n.push(...e.tieMatchUps)}))),i[t]||(i[t]={itemStructureIds:[],matchUps:[]}),i[t].itemStructureIds||(i[t].itemStructureIds=[]),i[t].itemStructureIds.push(e.structureId)}));else{let e=r;i[t]={matchUps:e,itemStructureIds:[]},null==e||e.forEach((e=>{n.push(e),e.tieMatchUps&&n.push(...e.tieMatchUps)}))}})),{mappedMatchUps:i,drawMatchUps:n}}function Hd({mappedMatchUps:e,matchUpsMap:t,structureId:i,inContext:n}){let r=(e=(null==t?void 0:t.mappedMatchUps)??e)[i],a=((null==r?void 0:r.itemStructureIds)||[]).map((t=>{let{matchUps:r,structureName:a}=e[t];return n?r.map((e=>Object.assign(Wo(e,!0,!0),{containerStructureId:i,structureId:t,structureName:a}))):r})).flat();return((null==r?void 0:r.matchUps)||[]).concat(...a)}var zd="SIGN_IN_STATUS",Yd="SIGNED_OUT",Kd="SIGNED_IN",Jd="TEAM",Qd="INDIVIDUAL",Zd="GROUP",Xd="PAIR",ec="TEAM",tc={TEAM_PARTICIPANT:Jd,INDIVIDUAL:Qd,GROUP:Zd,TEAM:ec,PAIR:Xd},ic={INDIVIDUAL:Qd,GROUP:Zd,PAIR:Xd,TEAM:ec,SIGN_IN_STATUS:zd,SIGNED_OUT:Yd,SIGNED_IN:Kd};function nc({participantsProfile:e,participants:t=[],deepCopy:i}){let n=new Map,r=!1!==i?Wo(t,null==e?void 0:e.convertExtensions,!0):t,a=r.filter((e=>e.participantType===ec)),o=r.filter((e=>e.participantType===Zd)),s=r.filter((e=>e.participantType===Xd));return r.forEach((e=>{if(e.participantType===Qd){let{participantId:t}=e;e.groupParticipantIds=[],e.teamParticipantIds=[],e.pairParticipantIds=[],e.groups=[],e.teams=[],a.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((r=>{var a;r===t&&(null==(a=e.teamParticipantIds)||!a.includes(i.participantId))&&(e.teamParticipantIds.push(i.participantId),n.get(i.participantId)||n.set(i.participantId,{participantName:i.participantName,participantId:i.participantId}),e.teams.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId,teamId:i.teamId}))}))})),s.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n===t&&!e.pairParticipantIds.includes(i.participantId)&&e.pairParticipantIds.push(i.participantId)}))})),o.forEach((i=>{((null==i?void 0:i.individualParticipantIds)||[]).forEach((n=>{n===t&&!e.groupParticipantIds.includes(i.participantId)&&(e.groupParticipantIds.push(i.participantId),e.groups.push({participantRoleResponsibilities:i.participantRoleResponsibilities,participantOtherName:i.participantOtherName,participantName:i.participantName,participantId:i.participantId}))}))}))}})),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function rc({drawDefinition:e,attributes:t}){let{extension:i}=Ds({element:e,name:ks}),n=(null==i?void 0:i.value)||{};return t.forEach((e=>{Object.keys(e).forEach((t=>{n[t]?Object.assign(n[t],e[t]):n[t]=e[t]}))})),i={name:ks,value:n},vs({drawDefinition:e,extension:i}),{entryProfile:n}}function ac({drawDefinition:e}){let{extension:t}=Ds({element:e,name:ks});return{entryProfile:(null==t?void 0:t.value)||{}}}var oc="ALTERNATE",sc="CONFIRMED",lc="DIRECT_ACCEPTANCE",uc="FEED_IN",dc="JUNIOR_EXEMPT",cc="LUCKY_LOSER",pc="ORGANISER_ACCEPTANCE",mc="QUALIFIER",fc="SPECIAL_EXEMPT",hc="UNGROUPED",vc="UNPAIRED",gc="WILDCARD",Ic="WITHDRAWN",Uc=[sc,lc,dc,pc,fc],yc=[uc,cc,mc],Sc=[sc,lc,uc,dc,pc,fc,gc],wc=[sc,lc,dc,cc,mc,pc,fc,gc],Tc=[oc,sc,lc,uc,dc,cc,pc,mc,"REGISTERED",fc,hc,vc,gc,Ic],Pc={ALTERNATE:oc,CONFIRMED:sc,DIRECT_ACCEPTANCE:lc,DIRECT_ENTRY_STATUSES:Sc,DRAW_SPECIFIC_STATUSES:yc,EQUIVALENT_ACCEPTANCE_STATUSES:Uc,FEED_IN:uc,JUNIOR_EXEMPT:dc,LUCKY_LOSER:cc,ORGANISER_ACCEPTANCE:pc,QUALIFIER:mc,SPECIAL_EXEMPT:fc,STRUCTURE_SELECTED_STATUSES:wc,UNGROUPED:hc,UNPAIRED:vc,VALID_ENTRY_STATUSES:Tc,WILDCARD:gc,WITHDRAWN:Ic};function Dc({stage:e,drawDefinition:t}){let{entryProfile:i}=ac({drawDefinition:t}),n=Object.keys(i).includes(e);if(!n&&Vl.includes(e)){return rc({drawDefinition:t,attributes:[{[e]:{drawSize:void 0,alternates:!0}}]}),!0}return n}function bc({stage:e,drawDefinition:t,entryStatus:i}){return t.entries.reduce(((t,n)=>n.entryStage===e&&n.entryStatus===i?t+1:t),0)}function Mc({provisionalPositioning:e,placementGroup:t,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let d=(null==(u=i.entries)?void 0:u.reduce(((e,t)=>{var i,a;let u=null==(a=null==(i=Ds({name:Gs,element:t}))?void 0:i.extension)?void 0:a.value,d=l&&t.entryStage===l||(null==s?void 0:s.length)&&t.entryStage&&s.includes(t.entryStage),c=!r||t.entryStatus&&r.includes(t.entryStatus),p=t.entryStageSequence??1;return!d||n&&p!==n||!c||o&&u&&o!==u?e:e.concat(t)}),[]))??[];if(a&&l===jl){let{playoffEntries:n,error:r}=function({provisionalPositioning:e,drawDefinition:t,structureId:i}){let n=[],r=(t.links??[]).find((e=>e.linkType===tu&&e.target.structureId===i));if(r){let{finishingPositions:i,structureId:a}=r.source,{structure:o}=_u({drawDefinition:t,structureId:a});(null==o?void 0:o.structureType)===Jl&&(o.structures??[]).forEach((t=>{let r=t.positionAssignments??[],{structureId:a}=t,o=a,s=Object.assign({},...r.map((e=>{var t;let{participantId:i}=e,n=null==(t=Ds({element:e,name:zs}).extension)?void 0:t.value;return n&&i?{[i]:n}:void 0})).filter(Boolean)),l=Object.keys(s).reduce(((t,i)=>{let n=s[i],r=n.groupOrder||e&&n.provisionalOrder;return t.includes(r)||t.push(r),t}),[]).length===Object.keys(s).length,u=Object.keys(s).filter((t=>{let n=s[t],r=n.groupOrder||e&&n.provisionalOrder;return null==i?void 0:i.includes(r)}));(!e||l)&&u.forEach((t=>{let r=s[t],{groupOrder:a,provisionalOrder:l,GEMscore:u}=r,d=a||e&&l,c=[...i??[]].sort(nr).indexOf(d)+1;n.push({entryStage:jl,entryStatus:uc,placementGroup:c,groupingValue:o,participantId:t,GEMscore:u})}))}))}return{playoffEntries:n}}({provisionalPositioning:e,drawDefinition:i,structureId:a});return r&&console.log("playoff entries error"),(null!=n&&n.length?n:d).filter((e=>!t||e.placementGroup===t))}return d}function Nc({provisionalPositioning:e,returnAllProxies:t,drawDefinition:i,structureId:n,structure:r}){var a;let o,s=[];r||({structure:r,error:o}=_u({drawDefinition:i,structureId:n}));let l=Vu({structure:r}).positionAssignments;if(o||!r)return{seedAssignments:[],error:bt};n||(n=r.structureId);let{stage:u,stageSequence:d}=r,c=u===jl&&i&&Mc({provisionalPositioning:e,drawDefinition:i,stageSequence:d,structureId:n,stage:u}),p=c?c.filter((e=>1===e.placementGroup)).sort(((e,t)=>(e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore&&-1)||0)).map(((e,t)=>{let i=t+1;return{participantId:e.participantId,seedValue:i,seedProxy:!0,seedNumber:i}})):[],m=null==p?void 0:p.slice(0,t?p.length:l.length/2);return m.length?s=m:r.seedAssignments?s=r.seedAssignments:o=yt,{seedAssignments:s,stageSequence:d,seedLimit:r.seedLimit??(null==(a=null==r?void 0:r.positionAssignments)?void 0:a.length),stage:u,error:o}}var Rc="WALKOVER",Ac="RETIRED",Ec="COMPETITIVE",Cc="ROUTINE",Oc="DECISIVE",kc="winRatio",Fc=(e,t)=>(e||0)+(t||0);function xc(e,t){let i=Array.isArray(e)?e[0]:e;return isNaN(i)&&Rc||i<=t[Oc]&&Oc||i<=t[Cc]&&Cc||Ec}function Lc({score:e}){let t=(null==e?void 0:e.sets)||[],i=t.reduce(((e,t)=>(e[0]+=t.side1Score||0,e[1]+=t.side2Score||0,e)),[0,0]),n=t.reduce(((e,t)=>(e[0]+=t.side1TiebreakScore||0,e[1]+=t.side2TiebreakScore||0,e)),[0,0]);return n.reduce(Fc)&&(i[n[0]>n[1]?0:1]+=1),{sets:t,games:i,score:e}}function _c(e){let t=Math.min(...e.games),i=Math.max(...e.games);return Math.round(t/i*100)}function Bc(e){return e.map(_c).sort().map((e=>parseFloat(e.toFixed(2))))}function jc({onlySpecifiedPolicyTypes:e=!1,policyTypes:t=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(t))return{error:ni};let o={};return i&&s(i),a&&s(a),n&&s(n),r&&s(r),{appliedPolicies:o,...Be};function s(i){var n,r;let a=null==(r=null==(n=null==i?void 0:i.extensions)?void 0:n.find((e=>e.name===bs)))?void 0:r.value;if(a)for(let s of Object.keys(a))(e?t.includes(s):!t.length||t.includes(s))&&(o[s]=Wo(a[s],!1,!0))}}function Vc({policyTypes:e=[],tournamentRecord:t,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(e))return{error:ni};let{appliedPolicies:a}=jc({tournamentRecord:t,drawDefinition:i,structure:n,event:r}),o={};for(let s of e){let e=null==a?void 0:a[s];e&&(o[s]=e)}return Object.keys(o).length?{policyDefinitions:o}:{info:ui.message}}function Gc({tournamentRecord:e,drawDefinition:t,policyType:i,structure:n,event:r}){if(!e)return{error:We};let{appliedPolicies:a}=jc({tournamentRecord:e,drawDefinition:t,structure:n,event:r});return null!=a&&a[i]?{policy:a[i]}:{info:null==ui?void 0:ui.message}}var $c={[Yo]:{policyName:"Competitive Bands Default",profileBands:{[Oc]:20,[Cc]:50}}};function qc({tournamentRecord:e,profileBands:t,matchUp:i}){if(!i)return{error:ti};let{score:n,winningSide:r}=i;if(!r)return{error:Fn};let a=!t&&e&&Gc({policyType:Yo,tournamentRecord:e}).policy,o=t||(null==a?void 0:a.profileBands)||$c[Yo].profileBands,s=Bc([Lc({score:n})]),l=xc(s,o),u=Array.isArray(s)?s[0]:s;return{...Be,competitiveness:l,pctSpread:u}}function Wc({matchUp:e}){var t,i,n;if(!e)return{error:ti};if(e&&!e.sides)return{error:ii};if(e&&!e.hasContext)return{error:Tn};let r=null==(t=e.sides??[])?void 0:t.map((e=>null==e?void 0:e.participantId)).filter(Boolean),a=(null==(i=e.sides)?void 0:i.filter((e=>{var t;return(null==(t=e.participant)?void 0:t.participantType)===Qd})).map((e=>e.participantId)).filter(Boolean))??[],o=((null==(n=e.sides??[])?void 0:n.map((e=>{var t;return null==(t=e.participant)?void 0:t.individualParticipants})).filter(Boolean))??[]).map((e=>(e??[]).map((e=>null==e?void 0:e.participantId)).filter(Boolean))),s=[...a,...o.flat()].filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:hr(s.concat(r)).filter(Boolean)??[],individualParticipantIds:s,sideParticipantIds:r,...Be}}var Hc="CHECK_IN",zc="CHECK_OUT",Yc="SCHEDULE.ASSIGNMENT.VENUE",Kc="SCHEDULE.ALLOCATION.COURTS",Jc="SCHEDULE.ASSIGNMENT.COURT",Qc="SCHEDULE.COURT.ORDER",Zc="SCHEDULE.DATE",Xc="SCHEDULE.ASSIGN.OFFICIAL",ep="SCHEDULE.TIME.SCHEDULED",tp="SCHEDULE.TIME.START",ip="SCHEDULE.TIME.STOP",np="SCHEDULE.TIME.RESUME",rp="SCHEDULE.TIME.END",ap="SCHEDULE.TIME.MODIFIERS",op="TO_BE_ANNOUNCED",sp="NEXT_AVAILABLE",lp="FOLLOWED_BY",up="AFTER_REST",dp="RAIN_DELAY",cp=[op,sp,lp,up,dp],pp="SCALE",mp="RATING",fp="RANKING",hp="SEEDING",vp="PUBLISH",gp="PUBLIC",Ip="STATUS",Up={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:cp,AFTER_REST:up,ALLOCATE_COURTS:Kc,ASSIGN_COURT:Jc,ASSIGN_OFFICIAL:Xc,ASSIGN_VENUE:Yc,CHECK_IN:Hc,CHECK_OUT:zc,COMPLETED_DATE:"COMPLETED.DATE",COURT_ORDER:Qc,ELIGIBILITY:"ELIGIBILITY",END_TIME:rp,FOLLOWED_BY:lp,MEDICAL:"MEDICAL",MODIFICATION:"MODIFICATION",NEXT_AVAILABLE:sp,NOT_BEFORE:"NOT_BEFORE",OTHER:"other",PENALTY:"PENALTY",PUBLIC:gp,PUBLISH:vp,RANKING:fp,RATING:mp,RAIN_DELAY:dp,REGISTRATION:"REGISTRATION",RESUME_TIME:np,RETRIEVAL:"RETRIEVAL",SCALE:pp,SCHEDULE:"SCHEDULE",SCHEDULED_DATE:Zc,SCHEDULED_TIME:ep,SEEDING:hp,START_TIME:tp,STATUS:Ip,STOP_TIME:ip,SUSPENSION:"SUSPENSION",TIME_MODIFIERS:ap,TO_BE_ANNOUNCED:op};function yp({matchUp:e}){if(!e)return{error:ti};if(!e.hasContext)return{error:Tn};if(!e.sides||2!==e.sides.filter(Boolean).length)return{error:ii};let{nestedIndividualParticipantIds:t,allRelevantParticipantIds:i,sideParticipantIds:n}=Wc({matchUp:e}),r=(e.timeItems??[]).filter((e=>(null==e?void 0:e.itemType)&&[Hc,zc].includes(e.itemType))).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))),a=r.map((e=>e.itemValue)).filter((e=>r.filter((t=>(null==t?void 0:t.itemValue)===e)).reverse()[0].itemType===Hc));return null==t||t.forEach(((e,t)=>{let i=null==n?void 0:n[t],r=(null==e?void 0:e.length)&&e.every((e=>a.includes(e)));i&&r&&!a.includes(i)&&a.push(i)})),null==n||n.forEach(((e,i)=>{a.includes(e)&&((null==t?void 0:t[i])??[]).forEach((e=>{e&&!a.includes(e)&&a.push(e)}))})),{allRelevantParticipantIds:i,allParticipantsCheckedIn:null==n?void 0:n.reduce(((e,t)=>a.includes(t)&&e),!0),checkedInParticipantIds:a,...Be}}var Sp={[Ad]:[Ad,"S"],[Cd]:[Cd,"D"],[kd]:[kd,"T"],S:[Ad,"S"],D:[Cd,"D"],T:[kd,"T"]},wp=e=>t=>{let i=Ce(t)&&(null==t?void 0:t.matchUpType)||Ee(t)&&t;return i&&Sp[e].includes(i)};function Tp(e){var t;let{matchUpAverageTimes:i,matchUpFormat:n}=e||{},r=(null==i?void 0:i.map((({matchUpFormatCodes:e})=>null==e?void 0:e.filter((e=>e===n)))).flat().filter(Boolean).sort(((e,t)=>((null==e?void 0:e.length)||0)-((null==t?void 0:t.length)||0))))||[],a=r.includes(n)?n:r[0];return null==(t=null==i?void 0:i.find((({matchUpFormatCodes:e,averageTimes:t})=>(null==e?void 0:e.find((e=>a===e)))&&t)))?void 0:t.averageTimes}function Pp(e){var t;let{matchUpRecoveryTimes:i,averageMinutes:n,matchUpFormat:r}=e||{};return null==(t=null==i?void 0:i.find((({matchUpFormatCodes:e,averageTimes:t,recoveryTimes:i})=>{if(t&&n){let{greaterThan:e=0,lessThan:i=360}=t;if(n>e&&n<i)return!0}return(null==e?void 0:e.find((e=>e===r)))&&i})))?void 0:t.recoveryTimes}function Dp({timesBlockArray:e,categoryName:t,categoryType:i}){return e.filter((e=>Array.isArray(e))).map((e=>e.sort(((e,t)=>{var i,n;return((null==(i=t.categoryNames)?void 0:i.length)||0)-((null==(n=e.categoryNames)?void 0:n.length)||0)})).find((({categoryTypes:e,categoryNames:n})=>!(null!=n&&n.length)&&!(null!=e&&e.length)||(null==n?void 0:n.includes(t))||(null==e?void 0:e.includes(i)))))).find(Boolean)}function bp({tournamentRecord:e,categoryName:t,categoryType:i,event:n}){var r,a,o,s,l,u;t=t??(null==(r=null==n?void 0:n.category)?void 0:r.categoryName)??(null==(a=null==n?void 0:n.category)?void 0:a.ageCategoryCode),i=i??(null==(o=null==n?void 0:n.category)?void 0:o.categoryType)??(null==(s=null==n?void 0:n.category)?void 0:s.subType);let{policy:d}=Gc({policyType:is,tournamentRecord:e,event:n});return{scheduleTiming:{tournamentScheduling:null==(l=e?Ds({element:e,name:qs}).extension:void 0)?void 0:l.value,eventScheduling:null==(u=n&&Ds({name:qs,element:n}).extension)?void 0:u.value,categoryName:t,categoryType:i,policy:d}}}var Mp="DOUBLES_SINGLES",Np="SINGLES_DOUBLES",Rp="total",Ap="participantConflict",Ep="matchUpConflict",Cp="ISSUE_IDS",Op="CONFLICT",kp="WARNING",Fp="ERROR",xp="ISSUE",Lp="STATE",_p={SINGLES_DOUBLES:Np,DOUBLES_SINGLES:Mp,TOTAL:Rp,CONFLICT_MATCHUP_ORDER:Ep,CONFLICT_PARTICIPANTS:Ap,SCHEDULE_ISSUE_IDS:Cp,SCHEDULE_CONFLICT:Op,SCHEDULE_WARNING:kp,SCHEDULE_ERROR:Fp,SCHEDULE_ISSUE:xp,SCHEDULE_STATE:Lp},Bp="SINGLES",jp="SINGLES",Vp="DOUBLES",Gp="DOUBLES",$p="TEAM",qp="TEAM",Wp={AGE:"AGE",BOTH:"BOTH",DOUBLES:Vp,DOUBLES_EVENT:Gp,RATING:"RATING",SINGLES:Bp,SINGLES_EVENT:jp,TEAM_EVENT:qp,TEAM:$p};function Hp({defaultAverageMinutes:e=90,defaultRecoveryMinutes:t=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:We};o=o??(null==s?void 0:s.eventType)??jp;let l={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},{scheduleTiming:u}=bp({tournamentRecord:i,categoryName:r,categoryType:a,event:s});return zp({eventType:o,timingDetails:{...u,matchUpFormat:n,categoryType:a,defaultTiming:l}})}function zp({timingDetails:e,eventType:t}){let i=function({matchUpFormat:e,categoryName:t,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;return Dp({categoryName:t,categoryType:i,timesBlockArray:[(null==a?void 0:a.matchUpAverageTimes)&&Tp({...a,matchUpFormat:e}),(null==r?void 0:r.matchUpAverageTimes)&&Tp({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpAverageTimes)&&Tp({...o,matchUpFormat:e}),null==(s=null==o?void 0:o.defaultTimes)?void 0:s.averageTimes,null==n?void 0:n.averageTimes]})}(e),n=Object.keys((null==i?void 0:i.minutes)||{}),r=(null==i?void 0:i.minutes)&&((null==n?void 0:n.includes(t))&&i.minutes[t]||i.minutes.default),a=function({tournamentScheduling:e,eventScheduling:t,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:o,policy:s}){var l;return Dp({categoryName:a,categoryType:o,timesBlockArray:[(null==t?void 0:t.matchUpRecoveryTimes)&&Pp({...t,averageMinutes:i,matchUpFormat:r}),(null==e?void 0:e.matchUpRecoveryTimes)&&Pp({...e,averageMinutes:i,matchUpFormat:r}),(null==s?void 0:s.matchUpRecoveryTimes)&&Pp({...s,averageMinutes:i,matchUpFormat:r}),null==(l=null==s?void 0:s.defaultTimes)?void 0:l.recoveryTimes,null==n?void 0:n.recoveryTimes]})}({...e,averageMinutes:r}),o=Object.keys((null==a?void 0:a.minutes)||{}),s=(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(t))&&a.minutes[t]||a.minutes.default),l=wp(jp)(t)?Np:Mp;return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(l))&&a.minutes[l]||s)}}function Yp(e){return e.createdAt?new Date(e.createdAt).getTime():0}function Kp({visibilityThreshold:e,timeItems:t,itemType:i}){let n=t.filter((t=>t&&t.itemType===i&&(!e||Yp(t)<new Date(e).getTime()))).sort(((e,t)=>Yp(e)-Yp(t))).pop(),r=n&&Yp(n);return{itemValue:null==n?void 0:n.itemValue,timeStamp:r}}function Jp({visibilityThreshold:e,timeStamp:t,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Kp({timeItems:(null==n?void 0:n.timeItems)||[],itemType:ep,visibilityThreshold:e});return!i||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{scheduledTime:r}:i}function Qp({visibilityThreshold:e,timeStamp:t,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Kp({timeItems:(null==n?void 0:n.timeItems)||[],itemType:Zc,visibilityThreshold:e});return!i||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{scheduledDate:r}:i}function Zp({visibilityThreshold:e,timeStamp:t,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Kp({timeItems:(null==n?void 0:n.timeItems)||[],itemType:Kc,visibilityThreshold:e});return!i||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{allocatedCourts:Wo(r,!1,!0)}:i}function Xp({visibilityThreshold:e,timeStamp:t,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Kp({timeItems:(null==n?void 0:n.timeItems)||[],itemType:Jc,visibilityThreshold:e});return!i||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{courtId:r}:i}function em({visibilityThreshold:e,timeStamp:t,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Kp({timeItems:(null==n?void 0:n.timeItems)||[],itemType:Yc,visibilityThreshold:e});return!i||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{venueId:r}:i}function tm({visibilityThreshold:e,timeStamp:t,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Kp({timeItems:(null==n?void 0:n.timeItems)||[],itemType:ap,visibilityThreshold:e});return!i||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{timeModifiers:r}:i}function im(e){if(fo.test(e)){let t=So();return new Date(`${t}T${e}`)}return new Date(e)}function nm(e){let t=(e,t=2)=>("00"+e).slice(-t);return t(e/36e5|0)+":"+t(e%36e5/6e4|0)+":"+t(e%6e4/1e3|0)}function rm(e=1){return br(0,e).map(am)}function am(){let e=[];for(let a=0;a<256;a++)e[a]=(a<16?"0":"")+a.toString(16);let t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&n|128]+e[n>>8&255]+"-"+e[n>>16&255]+e[n>>24&255]+e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]}function om(e){let{disableNotice:t,venue:i,context:n}=e;if("object"!=typeof i)return{error:Fn};let r,a=Ld(e);i.venueId||(i.venueId=am());for(let o of Object.values(a)){let e=sm({disableNotice:!0,tournamentRecord:o,context:n,venue:i});if(null!=e&&e.error)return e;r=e.venue}return t||ia({topic:zu,payload:{venue:i}}),ya({...Be,venue:r})}function sm({tournamentRecord:e,disableNotice:t,context:i,venue:n}){return e?n?(e.venues||(e.venues=[]),n.venueId||(n.venueId=am()),e.venues.reduce(((e,t)=>e||t.venueId===n.venueId),void 0)?{error:cn}:(i&&fs({element:n,extension:{value:i,name:Ns}}),e.venues.push(n),t||ia({payload:{venue:n,tournamentId:e.tournamentId},topic:zu}),{...Be,venue:Wo(n)})):{error:mi,info:"missing venue"}:{error:We}}function lm({tournamentRecords:e,tournamentRecord:t,venueId:i}){if(!t)return{error:We};if(!i)return{error:mn};let n=(t.venues??[]).reduce(((e,t)=>t.venueId===i?t:e),void 0);if(!n&&e){let r=(tl({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let a of r){let r=lm({tournamentRecord:e[a],venueId:i});if(r.success&&r.venue)return om({tournamentRecord:t,venue:r.venue}),{...Be,venue:n}}}return n?{...Be,venue:n}:{error:pn}}function um({convertExtensions:e,...t}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=t;return Wo(lm({tournamentRecords:i,tournamentRecord:n,venueId:r}),e,!0)}function dm({tournamentRecords:e,tournamentRecord:t,courtId:i}){if(!t)return{error:We};if(!i)return{error:pi};let n,r;if((t.venues??[]).forEach((e=>{(e.courts??[]).forEach((t=>{t.courtId===i&&(n=t,r=e)}))})),n)return{...Be,court:n,venue:r};if(e){let a=(tl({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let o of a){let a=dm({tournamentRecord:e[o],courtId:i});if(a.success)return a.venue&&om({tournamentRecord:t,venue:a.venue}),{...Be,court:n,venue:r}}}return Sa({result:{error:un},stack:"findCourt"})}function cm(e){return Wo(dm(e),!1,!0)}function pm({tournamentRecord:e,internalUse:t,courtId:i}){if(!e)return{error:We};if(!i)return{error:pi};let n=dm({tournamentRecord:e,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:e,courtId:t,courtName:i,courtDimensions:n,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:l,pace:u,notes:d})=>({altitude:e,courtId:t,courtName:i,courtDimensions:n,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:l,pace:u,notes:d}))(n.court);return{...Be,courtInfo:Wo(r,!1,t)}}function mm({tournamentRecord:e,venueId:t}){var i;if(!e)return{error:We};if(!t)return{error:mn};let n=lm({tournamentRecord:e,venueId:t});if(n.error)return n;let r=((null==(i=n.venue)?void 0:i.courts)??[]).map((t=>(({courtInfo:e})=>({...e}))(pm({courtId:t.courtId,internalUse:!0,tournamentRecord:e})))),a=n.venue&&(({venueId:e,venueName:t,venueAbbreviation:i})=>({venueAbbreviation:i,venueName:t,venueId:e}))(n.venue),o=a&&{...a,courtsInfo:r};return{...Be,venueData:Wo(o,!1,!0)}}function fm({event:e,eventId:t}){var i,n;if(!e)return{error:Et};let r=null==(i=Ds({name:Fs,element:e}))?void 0:i.extension,a=t?Wo(null==r?void 0:r.value,!1,!0):null==r?void 0:r.value;return t&&(null==(n=e.drawDefinitions)||n.forEach((e=>{var t;null==(t=null==a?void 0:a.flights)||t.forEach((t=>{t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})}))}))),{flightProfile:a}}function hm(e){let t,{tournamentRecord:i,eventId:n,drawId:r}=e,a="findEvent",o={},s=e.tournamentRecords??(i&&{[i.tournamentId]:i})??{},l=Object.values(s).map((({events:e,tournamentId:t})=>(e&&e.forEach((e=>{o[e.eventId]={tournamentId:t}})),e??[]))).flat();if(r){let e,i=l.find((i=>{var n,a,s;let l=((null==i?void 0:i.drawDefinitions)??[]).find((e=>e.drawId===r));if(l)e=l,t=o[i.eventId].tournamentId;else{let e=null==(s=null==(a=i&&(null==(n=fm({event:i}))?void 0:n.flightProfile))?void 0:a.flights)?void 0:s.find((e=>e.drawId===r));if(e)return t=o[i.eventId].tournamentId,{entries:e.drawEntries,drawName:e.drawName,tournamentId:t,drawId:r}}return l}));if(i)return{event:i,drawDefinition:e,tournamentId:t}}if(n){let e=l.find((e=>(null==e?void 0:e.eventId)===n));return e?(t=o[e.eventId].tournamentId,{event:e,drawDefinition:void 0,tournamentId:t}):{event:void 0,drawDefinition:void 0,...Sa({result:{error:Ct},stack:a})}}return{event:void 0,drawDefinition:void 0,...Sa({result:{error:Qe},context:{drawId:r,eventId:n},stack:a})}}function vm(e){var t,i,n,r,a,o,s,l,u;let d=e.event,c=e.matchUpType,{scheduleVisibilityFilters:p,afterRecoveryTimes:m,tournamentRecord:f,usePublishState:h,scheduleTiming:v,matchUpFormat:g,publishStatus:I,matchUp:U}=e;if(!U)return{error:ti};if(m&&!U.matchUpType&&!e.matchUpType&&(d||f)&&U.drawId){let n=null==(t=null==d?void 0:d.drawDefinitions)?void 0:t.find((e=>e.drawId===U.drawId));!n&&f&&({drawDefinition:n,event:d}=hm({tournamentRecord:f,drawId:U.drawId}));let r=U.structureId&&(null==(i=null==n?void 0:n.structures)?void 0:i.find((({structureId:e})=>e===U.structureId)));c=e.matchUpType||(null==r?void 0:r.matchUpType)||(null==n?void 0:n.matchUpType)||(null==d?void 0:d.eventType)!==$p&&(null==d?void 0:d.eventType)}let y,{milliseconds:S,time:w}=function({matchUp:e}){if(!e)return{error:ti};if(!e.timeItems)return{error:wn};let t=e.timeItems.filter((e=>[tp,ip,np,rp].includes(null==e?void 0:e.itemType))).sort(((e,t)=>im(e.itemValue).getTime()-im(t.itemValue).getTime())),i=t.reduce(((e,t)=>{var i,n;let r,a=null==(i=null==t?void 0:t.itemType)?void 0:i.split("."),o=`SCHEDULE.TIME.${(null==(n=null==t?void 0:t.itemType)?void 0:n.startsWith("SCHEDULE.TIME"))&&a[2]}`;switch(o){case tp:r=0;break;case rp:if(e.lastValue&&[tp,np].includes(e.lastType)){let i=im(t.itemValue).getTime()-im(e.lastValue).getTime();r=e.milliseconds+i}else r=e.milliseconds;break;case ip:if([tp,"SCHECULE.TIME.RESUME"].includes(e.lastType)){let i=im(t.itemValue).getTime()-im(e.lastValue).getTime();r=e.milliseconds+i}else r=e.milliseconds;break;default:r=e.milliseconds}return{milliseconds:r,lastType:o,lastValue:t.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([tp,np].includes(i.lastType)){let e=(new Date).getTime()-im(i.lastValue).getTime();i.milliseconds+=e}return{milliseconds:i.milliseconds,time:nm(i.milliseconds),relevantTimeItems:t}}({matchUp:U}),{startTime:T}=function({matchUp:e}){var t;let i=(null==e?void 0:e.timeItems)||[],n=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{startTime:null==(t=i.reduce(((e,t)=>{let i=t.itemType===tp&&t;return i&&(!e||n(i)<n(e))?i:e}),void 0))?void 0:t.itemValue}}({matchUp:U}),{endTime:P}=function({matchUp:e}){var t;let i=(null==e?void 0:e.timeItems)||[],n=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{endTime:null==(t=i.reduce(((e,t)=>{let i=t.itemType===rp&&t;return i&&(!e||n(i)>n(e))?i:e}),void 0))?void 0:t.itemValue}}({matchUp:U}),{visibilityThreshold:D,eventIds:b,drawIds:M}=p??{};if(b&&!b.includes(U.eventId)||M&&!M.includes(U.drawId))y=ya({milliseconds:S,startTime:T,endTime:P,time:w});else{let e,t,i,s,l,u={matchUp:U,visibilityThreshold:D},{allocatedCourts:d}=Zp(u),{scheduledTime:p}=Jp(u),{scheduledDate:h}=Qp(u),{venueId:I}=em(u),{courtId:b}=Xp(u),{courtOrder:M}=function({visibilityThreshold:e,timeStamp:t,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=Kp({timeItems:(null==n?void 0:n.timeItems)||[],itemType:Qc,visibilityThreshold:e});return!i||a&&t&&new Date(a).getTime()>new Date(t).getTime()?{courtOrder:r}:i}(u),{timeModifiers:N}=tm(u),R=U.matchUpType??c;if(v&&p&&m&&R){let n={matchUpFormat:U.matchUpFormat??g,...v};({averageMinutes:t=0,recoveryMinutes:i=0,typeChangeRecoveryMinutes:s=0}=zp({timingDetails:n,eventType:R})),(t||i)&&(e=P?jo(Eo(P),i):jo(p,t+i)),s&&(l=P?jo(Eo(P),s):jo(p,t+s))}!h&&p&&(h=Co(p));let A=go({scheduledDate:h,scheduledTime:p}),E={},C=(null==(n=f&&I&&mm({tournamentRecord:f,venueId:I}))?void 0:n.venueData)||{};I&&(E[I]=C);let{venueName:O,venueAbbreviation:k,courtsInfo:F}=C,x=null==(r=b&&(null==F?void 0:F.find((e=>e.courtId===b))))?void 0:r.courtName;for(let n of d||[]){if(!f)break;n.venueId&&!E[n.venueid]&&(E[n.venueId]=null==(a=mm({venueId:n.venueId,tournamentRecord:f}))?void 0:a.venueData);let e=E[n.venueId];n.venueName=null==e?void 0:e.venueName;let t=null==(o=null==e?void 0:e.courtsInfo)?void 0:o.find((e=>e.courtId===n.courtId));n.courtName=null==t?void 0:t.courtName}y=ya({typeChangeTimeAfterRecovery:l,timeAfterRecovery:e,scheduledDate:h,scheduledTime:p,isoDateString:A,allocatedCourts:d,timeModifiers:N,venueAbbreviation:k,venueName:O,venueId:I,courtOrder:M,courtName:x,courtId:b,typeChangeRecoveryMinutes:s,recoveryMinutes:i,averageMinutes:t,milliseconds:S,startTime:T,endTime:P,time:w})}let{scheduledDate:N}=Qp({matchUp:U}),{scheduledTime:R}=Jp({matchUp:U});if(h&&null!=(s=null==I?void 0:I.displaySettings)&&s.draws){let e=I.displaySettings.draws,t=null==(l=(null==e?void 0:e[U.drawId])??(null==e?void 0:e.default))?void 0:l.scheduleDetails;if(t){let e=null==(u=t.find((e=>{var t;return N&&(null==(t=e.dates)?void 0:t.includes(N))}))??t.find((e=>{var t;return!(null!=(t=e.dates)&&t.length)})))?void 0:u.attributes;if(e){y=po({source:y,template:Object.assign({},...Object.keys(y).map((e=>({[e]:!0}))),e)})}}}return{schedule:y,endDate:U.matchUpStatus&&Cl.includes(U.matchUpStatus)&&(Co(P)||Co(N)||Co(R))||void 0}}function gm(e){if(!e)return;let{tieFormatId:t,tieFormats:i}=e;return e.tieFormat?e.tieFormat:t&&Array.isArray(i)?i.find((e=>e.tieFormatId===t)):void 0}function Im({item:e,drawDefinition:t,structure:i,event:n}){var r,a,o;if(e){if(e.tieFormat)return e.tieFormat;if(e.tieFormatId)return t.tieFormat?t.tieFormat:(null==(r=t.tieFormats)?void 0:r.find((t=>e.tieFormatId===t.tieFormatId)))||(n.tieFormat?n.tieFormat:null==(a=n.tieFormats)?void 0:a.find((t=>e.tieFormatId===t.tieFormatId)));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let e=null==(o=t.tieFormats)?void 0:o.find((e=>i.tieFormatId===e.tieFormatId));if(e)return e}}}function Um({drawDefinition:e,structure:t,matchUp:i,event:n}){return{tieFormat:Im({item:i,drawDefinition:e,structure:t,event:n})||Im({item:t,drawDefinition:e,structure:t,event:n})||gm(e)||gm(n)}}function ym({groupedOrder:e,roundPositionsCount:t}){if(!e||(null==e?void 0:e.length)<=t)return e;let i=Or(e,e.length/t).map((e=>e.reduce(((e,t)=>e+t)))),n=i.slice().sort(nr);return i.map((e=>n.indexOf(e)+1))}function Sm(e){if(!Array.isArray(e))return"";let t=e.filter(ur);return t.length?hr([Math.min(...t),Math.max(...t)]).join("-"):""}function wm({policyDefinitions:e,tournamentRecord:t,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let o=Vc({tournamentRecord:t,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let t=(null==e?void 0:e[Yo])??(null==o?void 0:o[Yo])??$c[Yo];a.policies[Yo]=t}return a}function Tm({collectionPosition:e,collectionId:t,lineUp:i}){let n=[],r=[];if(i){let a=e=>void 0===e?-1:e,o=i.map((i=>{let{collectionAssignments:n,participantId:r}=i,a=null==n?void 0:n.find((i=>i.collectionPosition===e&&i.collectionId===t));return a&&{participantId:r,...a}})).filter(Boolean).sort(((e,t)=>a(e.substitutionOrder)-a(t.substitutionOrder)));for(let e of o){let{participantId:t,previousParticipantId:i,substitutionOrder:a}=e;n.includes(t)||(i&&r.push({previousParticipantId:i,substitutionOrder:a,participantId:t}),n=n.filter((e=>e!==i)),n.push(t))}}return{assignedParticipantIds:n,substitutions:r}}function Pm({tournamentParticipants:e,tournamentRecord:t,participantIds:i}){let n="getPairedParticipant";if(!e&&!t)return{error:We};if(!Array.isArray(i)||i.length>2)return{error:Ci};if(!i.length)return Sa({result:{error:Gi},stack:n});let r=(e=e??(null==t?void 0:t.participants)??[]).filter((e=>e.participantType===Xd&&Nr(i,e.individualParticipantIds).length===i.length&&e.individualParticipantIds.length===i.length)),a=r[0];if(!a)return Sa({result:{error:Bi},stack:n});let o=Wo(r.slice(1),!1,!0);return{participant:Wo(a),duplicatedPairParticipants:o,...Be}}function Dm({drawDefinition:e,participantId:t}){if("object"!=typeof e)return{error:Ke};if("string"!=typeof t)return{error:_i};let{extension:i}=Ds({element:e,name:Ls});return{lineUp:((null==i?void 0:i.value)||{})[t]}}function bm({drawDefinition:e}){if("object"!=typeof e)return{error:Ye};let t={},{structures:i=[],links:n=[]}=e||{},r=i.reduce(((e,t)=>{let{stage:i}=t;return e[i]?e[i].push(t):e[i]=[t],e}),{});for(let o of Object.keys(r)){let e=r[o].find((({stageSequence:e})=>1===e));if(!e)continue;let{structureId:i}=e;a({aggregator:{},targetRound:0,exitProfiles:t,exitProfile:"0",structureId:i,stage:o})}return{exitProfiles:t};function a({exitProfiles:e,exitProfile:t,structureId:r,targetRound:o,aggregator:s,stage:l}){e[r]||(e[r]=[]),"0"===t&&[_l,jl].includes(l)||e[r].push(t);let u=n.filter((e=>e.source.structureId===r&&e.source.roundNumber>=o));for(let n of u){let r=n.source.roundNumber,o=n.target.roundNumber,l=n.target.structureId,u=i.find((e=>e.structureId===l)).stage,d=[u,l,o,r].join("|");if(s[d])return;s[d]=!0,a({exitProfile:`${t}-${r}`,structureId:l,exitProfiles:e,targetRound:o,aggregator:s,stage:u})}}}function Mm({roundsNotPowerOf2:e,drawDefinition:t,structure:i,matchUps:n}){var r;if(!i)return!1;n=n??i.matchUps??[],e=e??jd({matchUps:n}).roundsNotPowerOf2;let a=!(null==(r=i.positionAssignments)||!r.find((({drawPosition:e})=>e)))||!(null==n||!n.find((({drawPositions:e})=>null==e?void 0:e.length)));return(!(null!=t&&t.drawType)||t.drawType!==mu)&&!(null!=i&&i.structures)&&e&&a}function Nm({structure:e}){if(!e)return!1;let t=e.matchUps||e.roundMatchUps&&Object.values(e.roundMatchUps).flat(),i=!(null==t||!t.find((e=>null==e?void 0:e.roundPosition))),n=!(null==t||!t.find((e=>{var t;return null==(t=null==e?void 0:e.drawPositions)?void 0:t.length})));return!(null!=e&&e.structures||(null==e?void 0:e.stage)===Bl||t.length&&(i||n))}var Rm={[Xo]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[xl]:"",[jl]:"P",[Ll]:"Q",[_l]:"C"}}},Am=Rm;function Em(e){var t,i,n;let r=io(e,[{[Va]:!0}]);if(r.error)return r;let a=null==e?void 0:e.matchUp,o=null==a?void 0:a.matchUpType;if(!o&&null!=(t=null==a?void 0:a.sides)&&t.length){let e=null==(n=null==(i=a.sides.find((({participant:e})=>e)))?void 0:i.participant)?void 0:n.participantType;o=e===Qd&&Ad||e===Xd&&Cd||e===ec&&ec||void 0}return{matchUpType:o}}var Cm="timed",Om="NOAD",km="SET",Fm={S:"normal",F:"final"};function xm(e){if("string"==typeof e){let t=e.startsWith("T")&&Cm||e.startsWith(km)&&km||"";if(t===Cm){let t=jm(e);if(t)return{simplified:!0,setFormat:t,bestOf:1}}if(t===km)return function(e){let t=e.split("-"),i=Gm(t[0].slice(3)),n=1===i||i%2!=0?i:void 0,r=1!==i&&i%2==0?i:void 0,a=t&&Lm(t[1]),o=t&&Lm(t[2]),s=a&&a.timed||o&&o.timed,l=n&&n<6||s&&r,u=!t[2]||o,d=a,c=ya({setFormat:a,exactly:r,bestOf:n});if(o&&(c.finalSetFormat=o),l&&d&&u)return c}(e)}}function Lm(e){if(":"===(null==e?void 0:e[1])){let t=e.split(":"),i=Fm[t[0]],n=t[1];if(i&&n){if(n.startsWith("TB")){let e=Bm(n);return!1!==e&&("object"==typeof e?{tiebreakSet:e}:void 0)}if(n.startsWith("T"))return jm(n);let t=e.match(/^[FS]:(\d+)([A-Za-z]*)/),i=t&&Vm(t[2])||!1,r=!(null!=t&&t[2])||i,a=t?Gm(t[1]):void 0,o=_m(n),s=!1!==o,l=s&&o||a,u=Bm(n.split("/")[1]),d=!1!==u,c={setTo:a};return i&&(c.NoAD=!0),u?(c.tiebreakFormat=u,c.tiebreakAt=l):c.noTiebreak=!0,a&&r&&d&&s&&c||!1}}}function _m(e,t=!0){let i=(null==e?void 0:e.indexOf("@"))>0&&e.split("@");if(i)return(t?Gm(i[1]):i[1])||!1}function Bm(e){if(e){if(e.startsWith("TB")){let t=_m(e,!1),i=e.match(/^TB(\d+)([A-Za-z]*)/),n=null==i?void 0:i[1],r=i&&Vm(i[2]),a=!(null!=i&&i[2])||r,o=Gm(n);if(o&&a){let e={tiebreakTo:o};return t&&"string"==typeof t&&!mr(t)&&(e.modifier=t),r&&(e.NoAD=!0),e}return!1}return!1}}function jm(e){var t;let i=e.slice(1),n=i.match(/^(\d+)(@?[A-Za-z]*)/),r=Gm(null==n?void 0:n[1]);if(!r)return;let a={timed:!0,minutes:r},o=null==n?void 0:n[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let e=null==(t=i.match(/^(\d+)(@)([A-Za-z]+)$/))?void 0:t[3];return e?(a.modifier=e,a):void 0}return o&&(a.based=n[2]),a}function Vm(e){return e&&e.indexOf(Om)>=0}function Gm(e){return isNaN(Number(e))?0:Number(e)}function $m(e,t){return!(!Array.isArray(e)||!Ee(t))&&Nr(e,Sp[t]).length}function qm(e){let{matchUps:t,isCollectionMatchUp:i,excludeMatchUpStatuses:n,matchUpStatuses:r,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:l,collectionIds:u,isMatchUpTie:d,roundNumbers:c,matchUpIds:p,roundNames:m,stageSequences:f,scheduledDates:h,scheduledDate:v,participantIds:g,processContext:I,tournamentIds:U,matchUpTypes:y,structureIds:S,readyToScore:w,courtIds:T,eventIds:P,venueIds:D,drawIds:b,stages:M,filterMatchUpIds:N=!0,filterMatchUpTypes:R=!0}=e,A=Array.isArray(g)?g.filter(Boolean):[],E=Array.isArray(r)?r.filter(Boolean):[],C=Array.isArray(n)?n.filter(Boolean):[],O=Array.isArray(M)?M.filter(Boolean):[],k=Array.isArray(f)?f.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],x=Array.isArray(m)?m.filter(Boolean):[],L=Array.isArray(c)?c.filter(Boolean):[],_=Array.isArray(s)?s.filter(Boolean):[],B=Array.isArray(p)&&N?p.filter(Boolean):[],j=Array.isArray(y)&&R?y.filter(Boolean):[],V=Array.isArray(T)?T.filter(Boolean):[],G=Array.isArray(D)?D.filter(Boolean):[],$=Array.isArray(o)&&o.filter(Boolean)||"string"==typeof l&&[l]||[],q=Array.isArray(h)&&h.filter(Boolean)||"string"==typeof v&&v.length&&[v]||[],W=Array.isArray(U)?U.filter(Boolean):[],H=Array.isArray(P)?P.filter(Boolean):[],z=Array.isArray(b)?b.filter(Boolean):[],Y=Array.isArray(S)?S.filter(Boolean):[];return t.filter((e=>{var t;if(w&&!wp(Od)(e)&&!e.readyToScore||e.winningSide&&a&&![1,2].includes(e.winningSide)||void 0!==d&&(d&&!e.tieMatchUps||!d&&e.tieMatchUps)||void 0!==i&&(i&&!e.collectionId||!i&&e.collectionId)||O.length&&!O.includes(e.stage)||k.length&&!k.includes(e.stageSequence)||F.length&&(!e.collectionId||!F.includes(e.collectionId))||x.length&&(!e.roundName||!x.includes(e.roundName))||L.length&&(!e.roundNumber||!L.includes(e.roundNumber))||_.length&&(!e.roundPosition||!_.includes(e.roundPosition))||E.length&&(!e.matchUpStatus||!E.includes(e.matchUpStatus))||C.length&&e.matchUpStatus&&C.includes(e.matchUpStatus)||B.length&&!B.includes(e.matchUpId)||j.length&&(!e.matchUpType||!$m(j,e.matchUpType))||$.length&&(!e.matchUpFormat||!$.includes(e.matchUpFormat)))return!1;if(null!=q&&q.length){let{scheduledTime:t}=Jp({matchUp:e}),{scheduledDate:i}=Qp({matchUp:e}),n=Co(t)||i;if(!q.find((e=>$o(e,n))))return!1}if(V.length){let{courtId:t}=Xp({matchUp:e}),{allocatedCourts:i}=Zp({matchUp:e}),n=null==i?void 0:i.map((({courtId:e})=>e));if(!V.filter(Boolean).includes(t)||null!=n&&n.includes(t))return!1}if(G.length){let{venueId:t}=em({matchUp:e});if(!G.filter(Boolean).includes(t))return!1}if(I){if(W.length&&!W.includes(e.tournamentId)||H.length&&!H.includes(e.eventId)||z.length&&!z.includes(e.drawId)||Y.length&&!Y.includes(e.structureId))return!1;if(A.length){let i=(null==(t=e.sides)?void 0:t.map((({participantId:e})=>e)).filter(Boolean))??[];if(!A.some((e=>i.includes(e))))return!1}}return!0}))}function Wm({drawPositionCollectionAssignment:e,sideNumberCollectionAssignment:t,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,u,d,c;let p=i.find((e=>e.drawPosition&&e.drawPosition===a)),m=a&&e,f=s&&t,h=m?null==(l=m[a])?void 0:l.participantId:null==p?void 0:p.participantId,v=p?function({displaySideNumber:e,seedAssignments:t,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:e,sideNumber:r};if(i){let e=function({seedAssignments:e,participantId:t}){return null==e?void 0:e.find((e=>!e.seedProxy&&e.participantId===t))}({seedAssignments:t,participantId:i});Object.assign(a,e,{participantId:i})}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}({displaySideNumber:n,seedAssignments:r,participantId:h,assignment:p,sideNumber:s}):{...null==f?void 0:f[s]};if(o&&(1===s?Object.assign(v,{participantFed:!0}):Object.assign(v,{participantAdvanced:!0})),a&&m){let e=null==(u=m[a])?void 0:u.teamParticipant,t=null==(d=m[a])?void 0:d.participant,i=null==(c=m[a])?void 0:c.substitutions;t&&(v.participant=t),i&&(v.substitutions=i),e&&(v.teamParticipant=e)}return v}var Hm="ANY",zm="MALE",Ym="MIXED",Km="OTHER",Jm="FEMALE",Qm={ANY:Hm,MALE:zm,FEMALE:Jm,MIXED:Ym,OTHER:Km};function Zm({scheduleVisibilityFilters:e,tournamentAppliedPolicies:t,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:u,contextContent:d,matchUpFilters:c,participantMap:p,scheduleTiming:m,contextProfile:f,drawDefinition:h,publishStatus:v,context:g={},exitProfiles:I,matchUpsMap:U,structure:y,inContext:S,event:w}){var T,P,D,b,M;let N={},R={};if(n=n??(null==o?void 0:o.participants),!y)return{collectionPositionMatchUps:N,error:Nt,roundMatchUps:R,matchUps:[]};let A=Array.isArray(null==c?void 0:c.eventIds)?null==c?void 0:c.eventIds.filter(Boolean):[],E=Array.isArray(null==c?void 0:c.structureIds)?null==c?void 0:c.structureIds.filter(Boolean):[],C=Array.isArray(null==c?void 0:c.drawIds)?null==c?void 0:c.drawIds.filter(Boolean):[],O=!(null!=g&&g.eventId)||!(null!=A&&A.length)&&!(null!=(T=null==u?void 0:u.eventIds)&&T.filter(Boolean).length)||(null==A?void 0:A.includes(g.eventId))||(null==(P=null==u?void 0:u.eventIds)?void 0:P.includes(g.eventId)),k=!(null!=E&&E.length)||E.includes(y.structureId),F=!h||!(null!=C&&C.length)||C.includes(h.drawId);if(!O||!k||!F)return{collectionPositionMatchUps:N,roundMatchUps:R,matchUps:[]};f&&!d&&(d=wm({tournamentRecord:o,contextProfile:f,drawDefinition:h}));let{appliedPolicies:x}=jc({drawDefinition:h}),L={...t,...x,...a},_=null==(D=null==L?void 0:L.scoring)?void 0:D.structures,B=y.stage&&(null==_?void 0:_.stage)&&(null==_?void 0:_.stage[y.stage]),j=y.stageSequence&&(null==B?void 0:B.stageSequence)&&B.stageSequence[y.stageSequence],V=(null==(b=null==L?void 0:L.scoring)?void 0:b.requireAllPositionsAssigned)||(null==B?void 0:B.requireAllPositionsAssigned)||(null==j?void 0:j.requireAllPositionsAssigned);U||(U=Wd({drawDefinition:h,structure:y}));let{positionAssignments:G,allPositionsAssigned:$}=Gu({structure:y}),q=!V||$,{seedAssignments:W}=Nc({provisionalPositioning:i,drawDefinition:h,structure:y});s=s??W;let{roundOffset:H,structureId:z,structureName:Y,stage:K,stageSequence:J}=y,{drawId:Q,drawName:Z,drawType:X}=h??{},ee=null==(I=I||h&&bm({drawDefinition:h}).exitProfiles)?void 0:I[z],te=(null==ee?void 0:ee.length)&&(ee[0].split("-").map((e=>parseInt(e))).reduce(((e,t)=>e+t))||0),ie=!!y.structures,ne=Hd({matchUpsMap:U,structureId:z,inContext:S}),re=function({roundNamingPolicy:e,drawDefinition:t,structure:i,matchUps:n}){var r,a,o;let{roundProfile:s,roundMatchUps:l}=jd({matchUps:n}),{structureAbbreviation:u,stage:d}=i,c=Nm({structure:i}),p=Mm({structure:i}),m=i.structures,f={},h=Rm[Xo],v=i.stage===Ll,g=v?Math.max(...((null==t?void 0:t.structures)??[]).filter((e=>e.stage===Ll)).map((({stageSequence:e})=>e??1)),0):0,I=(i.stageSequence??1)<g?i.stageSequence??1:"",U=I&&((null==(r=null==e?void 0:e.affixes)?void 0:r.preQualifying)||h.affixes.preQualifying)||"",y=(null==e?void 0:e.roundNamingMap)||h.roundNamingMap||{},S=(null==e?void 0:e.abbreviatedRoundNamingMap)||h.abbreviatedRoundNamingMap||{},w=(null==(a=null==e?void 0:e.affixes)?void 0:a.preFeedRound)||h.affixes.preFeedRound,T=(null==(o=null==e?void 0:e.affixes)?void 0:o.roundNumber)||h.affixes.roundNumber,P=((null==e?void 0:e.namingConventions)||h.namingConventions).round,D=d&&d!==xl?d[0]:"",b=(null==e?void 0:e.stageConstants)||h.stageConstants,M=`${U}${d&&(null==b?void 0:b[d])||D}${I}`,N=s?Object.keys(s):[],R=v&&null!=b&&b[Ll]?`${null==b?void 0:b[Ll]}-`:"";if(m||c||p)Object.assign(f,...N.map((e=>({[e]:{roundName:`${R}${P} ${e}`,abbreviatedRoundName:`${T}${e}`}}))));else{let t=v&&((null==e?void 0:e.qualifyingFinishMap)||(null==h?void 0:h.qualifyingFinishMap)||{});Object.assign(f,...N.map((e=>{if(null==s||!s[e])return;let{matchUpsCount:i,preFeedRound:n}=s[e],r=2*i,a=(null==t?void 0:t[null==s?void 0:s[e].finishingRound])||t&&`${T}${r}`||y[i]||`${T}${r}`,o=n?`-${w}`:"",l=[M,u,`${a}${o}`].filter(Boolean).join("-"),d=`${S[i]||`${T}${r}`}${o}`;return{[e]:{abbreviatedRoundName:[M,u,d].filter(Boolean).join("-"),roundName:l}}})))}return{roundNamingProfile:f,roundProfile:s,roundMatchUps:l}}({roundNamingPolicy:null==L?void 0:L[Xo],drawDefinition:h,structure:y,matchUps:ne}),{roundNamingProfile:ae,roundProfile:oe}=re;if(R=(null==re?void 0:re.roundMatchUps)??[],c&&(ne=qm({matchUps:ne,...c,filterMatchUpTypes:!1,filterMatchUpIds:!1})),S){let{sourceDrawPositionRanges:t}=function({drawDefinition:e,structureId:t,matchUpsMap:i}){if(!e)return{error:Ke};if(!t)return{error:Dt};let{structure:n}=_u({drawDefinition:e,structureId:t});if((null==n?void 0:n.stage)!==_l)return{error:_t,info:"Structure is not CONSOLATION stage"};let{links:r}=e,a=(null==r?void 0:r.filter((e=>e.target.structureId===t)))||[],o=(null==a?void 0:a.reduce(((e,t)=>{let{structureId:i}=t.source;return e.includes(i)?e:e.concat(i)}),[]))||[],s=Object.assign({},...o.map((e=>({[e]:jd({matchUps:Hd({structureId:e,matchUpsMap:i})}).roundProfile})))),l=Hd({matchUpsMap:i,structureId:t}),{roundProfile:u}=jd({matchUps:l}),d={};return null==a||a.forEach((e=>{var t,i,n;let{structureId:r,roundNumber:a}=e.source,{feedProfile:o,groupedOrder:l,positionInterleave:c,roundNumber:p}=e.target,m=s[r],f=null==(t=m[1])?void 0:t.drawPositions,h=null==(i=m[a])?void 0:i.matchUpsCount;if(!h)return;let v=h?f.length/h:0,g=f.length/v,I=f.slice(),U=ym({roundPositionsCount:g,groupedOrder:l}),y=(null==U?void 0:U.length)||1;if(y<=g){let e=Or(I,f.length/y);o===eu&&e.forEach((e=>e.reverse())),I=(null==U?void 0:U.length)&&(null==U?void 0:U.map((t=>e[t-1])).flat())||I}let S=Or(I,v);if(c){let e=br(0,c.interleave).map((()=>{})),t=br(0,c.offset).map((()=>{}));S=S.map((t=>[t,...e])),S.unshift(t),S=S.flat(1);let i=S.length-c.offset;S=S.slice(0,i)}d[p]||(d[p]={});let w=null!=(n=null==u?void 0:u[p])&&n.feedRound?2:1;S.forEach(((e,t)=>{let i=1+t*w;d[p][i]||(d[p][i]=Sm(e))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:h,matchUpsMap:U,structureId:z}),i=h?function({drawDefinition:e,roundProfile:t,structureId:i,matchUpsMap:n}){var r;if(!e)return{error:Ke};if(!i)return{error:Dt};if(!t){let e=Hd({matchUpsMap:n,structureId:i});if(({roundProfile:t}=jd({matchUps:e})),!t)return{error:mi}}let a=(Math.min(...(null==(r=null==t?void 0:t[1])?void 0:r.drawPositions)??[])||1)-1,o=Object.keys(t);return{drawPositionsRanges:Object.assign({},...(o||[]).map((e=>{var i,n;let r=null==(i=null==t?void 0:t[e])?void 0:i.matchUpsCount,s=(null==(n=null==t?void 0:t[1])?void 0:n.drawPositions)??[],l=Or(s,s.length/r),u=l.map(Sm),d=l.map((e=>e.map((e=>e-a)))).map(Sm),c=o.map((i=>{var n;if(i>e)return;let a=(null==(n=null==t?void 0:t[i])?void 0:n.drawPositions)??[];return Or(a,a.length/r)})).filter(Boolean),p=br(0,r).map((e=>c.map((t=>t[e])).flat().filter(Boolean).sort(nr))).map((e=>hr(e))),m=p.map((e=>function(e){return e.reduce(((e,t)=>{let i=e[e.length-1];return(!i||i[i.length-1]!==t-1)&&e.push([]),e[e.length-1].push(t),e}),[])}(e).map(Sm).join(", "))),f=Object.assign({},...br(0,r).map((e=>({[e+1]:{firstRoundDrawPositionsRange:u[e],firstRoundOffsetDrawPositionsRange:d[e],possibleDrawPositions:p[e],drawPositionsRange:m[e]}}))));return{[e]:f}})))}}({drawDefinition:h,roundProfile:oe,matchUpsMap:U,structureId:z}).drawPositionsRanges:void 0;ne=ne.map((n=>se({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,drawPositionsRanges:i,roundNamingProfile:ae,initialRoundOfPlay:te,appliedPolicies:L,usePublishState:l,publishStatus:v,isRoundRobin:ie,roundProfile:oe,matchUp:n,event:w}))),(null==ne?void 0:ne.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{let t=e.tieMatchUps;ne=ne.concat(...t)})),u&&(ne=qm({processContext:!0,...u,matchUps:ne}))}else(null==ne?void 0:ne.filter((e=>Array.isArray(e.tieMatchUps)))).forEach((e=>{let t=e.tieMatchUps;ne=ne.concat(...t)}));return c&&(ne=qm({matchUps:ne,...c,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(null!=c&&c.matchUpTypes||null!=c&&c.matchUpIds)&&(ne=qm({matchUpTypes:c.matchUpTypes,matchUpIds:c.matchUpIds,matchUps:ne})),(null!=c&&c.matchUpTypes||null!=c&&c.matchUpIds||S)&&(R=jd({matchUps:ne}).roundMatchUps??[]),null!=(M=Um({drawDefinition:h,structure:y,event:w}))&&M.tieFormat&&({collectionPositionMatchUps:N}=function({matchUps:e}){let t=e.reduce(((e,t)=>!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition)),[]).map((t=>({[t]:e.filter((e=>e.collectionPosition===t))})));return{collectionPositionMatchUps:Object.assign({},...t)}}({matchUps:ne})),{collectionPositionMatchUps:N,roundMatchUps:R,isRoundRobin:ie,roundProfile:oe,matchUpsMap:U,matchUps:ne};function se({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,drawPositionsRanges:i,initialRoundOfPlay:a,additionalContext:l,roundNamingProfile:u,tieDrawPositions:c,appliedPolicies:v,isCollectionBye:I,usePublishState:U,publishStatus:S,matchUpTieId:w,isRoundRobin:T,roundProfile:P,sideLineUps:D,matchUp:b,event:M}){var N,R,A,E,C,O,k,F,x,L,_,B,j,V,$;l=l??{};let W=null==(N=Um({drawDefinition:h,structure:y,matchUp:b,event:M}))?void 0:N.tieFormat,ee=null==W?void 0:W.collectionDefinitions,te=b.collectionId&&(null==ee?void 0:ee.find((e=>e.collectionId===b.collectionId))),ie=b.collectionId?null==te?void 0:te.matchUpFormat:b.matchUpFormat??(null==y?void 0:y.matchUpFormat)??(null==h?void 0:h.matchUpFormat)??(null==M?void 0:M.matchUpFormat),ne=b.matchUpType||(null==te?void 0:te.matchUpType)||(null==y?void 0:y.matchUpType)||(null==h?void 0:h.matchUpType)||!wp($p)(null==M?void 0:M.eventType)&&(null==M?void 0:M.eventType),re=I?ml:b.matchUpStatus,{schedule:ae,endDate:oe}=vm({scheduleVisibilityFilters:e,afterRecoveryTimes:r,tournamentRecord:o,usePublishState:U,scheduleTiming:m,matchUpFormat:ie,publishStatus:S,matchUpType:ne,matchUp:b,event:M}),le=c??b.drawPositions??[],{collectionPosition:ue,collectionId:de,roundPosition:ce}=b,pe=b.roundNumber??l.roundNumber,me=de?function({tournamentParticipants:e,positionAssignments:t,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let u=({attribute:t,lineUp:n,teamParticipant:a})=>{var s,u,d,c;let{assignedParticipantIds:p,substitutions:m}=Tm({collectionPosition:i,collectionId:o,lineUp:n});if(l!==Cd){let e=null==p?void 0:p[0];return e&&{[t]:{participantId:e,teamParticipant:a,substitutions:m}}}if((null==p?void 0:p.length)<=2){let i=null==(u=null==(s=null==r?void 0:r[p[0]])?void 0:s.pairIdMap)?void 0:u[p[1]];return{[t]:{participantId:null==(c=i&&(null==(d=r[i])?void 0:d.participant)||Pm({participantIds:p,tournamentParticipants:e}).participant)?void 0:c.participantId,teamParticipant:a,substitutions:m}}}if((null==p?void 0:p.length)>2)return{[t]:{teamParticipant:a,substitutions:m}}};if(null==n||!n.length){let e=(null==s?void 0:s.map((e=>{var t;let{teamParticipant:i,sideNumber:n}=e,r=e.lineUp||(null==(t=Dm({participantId:i.teamParticipantId,drawDefinition:a}))?void 0:t.lineUp);return u({attribute:n,lineUp:r,teamParticipant:i})})).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...e)}}let d=(null==n?void 0:n.map((i=>{var n,o,l;let d=null==(n=t.find((e=>e.drawPosition===i)))?void 0:n.participantId,c=null==s?void 0:s.find((e=>(null==e?void 0:e.drawPosition)===i)),p=(null==c?void 0:c.teamParticipant)||d&&(null==(o=null==r?void 0:r[d])?void 0:o.participant)||(null==e?void 0:e.find((({participantId:e})=>e===d))),m=(null==c?void 0:c.lineUp)||(null==(l=Dm({participantId:d,drawDefinition:a}))?void 0:l.lineUp);return u({attribute:i,lineUp:m,teamParticipant:p})})).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...d)}}({tournamentParticipants:n,positionAssignments:G,collectionPosition:ue,drawDefinition:h,participantMap:p,drawPositions:le,collectionId:de,sideLineUps:D,matchUpType:ne}):void 0,fe=(null==(R=null==u?void 0:u[pe])?void 0:R.roundName)||l.roundName,he=(null==(A=null==u?void 0:u[pe])?void 0:A.abbreviatedRoundName)||l.abbreviatedRoundName,ve=null==(E=null==P?void 0:P[pe])?void 0:E.feedRound,ge=null==(C=null==P?void 0:P[pe])?void 0:C.preFeedRound,Ie=null==(O=null==P?void 0:P[pe])?void 0:O.roundFactor,Ue=null==i?void 0:i[pe],ye=ce?null==Ue?void 0:Ue[ce]:void 0,Se=null==t?void 0:t[pe],we=null!=te&&te.category?{...(null==g?void 0:g.category)||{},...te.category}:(null==g?void 0:g.category)??(null==M?void 0:M.category),Te=(null==(k=b.processCodes)?void 0:k.length)&&b.processCodes||(null==(F=null==te?void 0:te.processCodes)?void 0:F.length)&&(null==te?void 0:te.processCodes)||(null==(x=null==y?void 0:y.processCodes)?void 0:x.length)&&(null==y?void 0:y.processCodes)||(null==(L=null==h?void 0:h.processCodes)?void 0:L.length)&&(null==h?void 0:h.processCodes)||(null==(_=null==M?void 0:M.processCodes)?void 0:_.length)&&(null==M?void 0:M.processCodes)||(null==o?void 0:o.processCodes),Pe=(null==f?void 0:f.withCompetitiveness)&&qc({...d,matchUp:b}),De=b.finishingPositionRange??l.finishingPositionRange,be=e=>ya(e,void 0,!0),Me={...be(g),...be({matchUpFormat:b.matchUpType===$p?void 0:ie,tieFormat:b.matchUpType!==$p?void 0:W,gender:(null==te?void 0:te.gender)??(null==M?void 0:M.gender),roundOfPlay:K!==Ll&&mr(a)&&a+(pe||0),endDate:b.endDate??oe,discipline:null==M?void 0:M.discipline,category:we,finishingPositionRange:De,abbreviatedRoundName:he,drawPositionsRange:ye,competitiveProfile:Pe,structureName:Y,stageSequence:J,drawPositions:le,matchUpStatus:re,processCodes:Te,isRoundRobin:T,matchUpTieId:w,preFeedRound:ge,matchUpType:ne,roundFactor:Ie,roundOffset:H,structureId:z,roundNumber:pe,feedRound:ve,roundName:fe,drawName:Z,drawType:X,schedule:ae,drawId:Q,stage:K}),...Wo(be(b),!0,!0)};if(ie&&null!=(B=b.score)&&B.scoreStringSide1){let e=xm(ie),{bestOf:t,finalSetFormat:i,setFormat:n}=e??{};(null!=i&&i.tiebreakSet||null!=n&&n.tiebreakSet||null!=n&&n.timed)&&(Me.score.sets=Me.score.sets.sort(((e,t)=>e.setNumber-t.setNumber)).map(((e,r)=>(r+1===t?(null!=i&&i.tiebreakSet||null!=i&&i.timed)&&(e.tiebreakSet=!0):(null!=n&&n.tiebreakSet||null!=n&&n.timed)&&(e.tiebreakSet=!0),e))))}if(Array.isArray(le)){let{orderedDrawPositions:e,displayOrder:t}=function({drawPositions:e,roundProfile:t,roundNumber:i}){var n;let r=[void 0,void 0];if(xr(e))return{orderedDrawPositions:r,displayOrder:r};let a=null==t?void 0:t[i],o=(null==(n=null==a?void 0:a.pairedDrawPositions)?void 0:n.find((t=>Ar(t||[],e.filter(Boolean)))))??r,s=null==a?void 0:a.feedRound;if(Fr(e)){let t=[...e].sort(nr);return{orderedDrawPositions:2===t.length?t:o,displayOrder:s?t:o}}if(s){let t=[e.find((e=>!isNaN(rr(e)))),void 0];return{orderedDrawPositions:t,displayOrder:t}}return{orderedDrawPositions:o,displayOrder:o}}({drawPositions:le,roundProfile:P,roundNumber:pe}),i=null==(j=null==P?void 0:P[pe])?void 0:j.feedRound,n=t[0]!==e[0],r=e.concat(void 0,void 0).slice(0,2).map(((e,t)=>{var r;let a=t+1,o=Wm({...me,positionAssignments:G,displaySideNumber:n?3-a:a,seedAssignments:s,drawPosition:e,isFeedRound:i,sideNumber:a}),l=null==(r=b.sides)?void 0:r.find((e=>e.sideNumber===a)),u=ce?2*(ce-1)+t+1:void 0,d=u?null==Se?void 0:Se[u]:void 0;return be({sourceDrawPositionRange:d,...l,...o})}));Object.assign(Me,Wo({sides:r},!0,!0))}if(n&&Me.sides){let e=null==v?void 0:v[es],t=t=>{var i;let n=null==(i=null==p?void 0:p[t])?void 0:i.participant;return n&&po({template:null==e?void 0:e.participant,source:n})};if(Me.sides.filter(Boolean).forEach((e=>{var i,r,a;if(e.participantId){let i=Wo(t(e.participantId)||n&&us({policyDefinitions:v,participantId:e.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:f}),void 0,!0);if(i){if(null!=h&&h.entries){let t=h.entries.find((t=>t.participantId===e.participantId));null!=t&&t.entryStatus&&(i.entryStatus=t.entryStatus),null!=t&&t.entryStage&&(i.entryStage=t.entryStage)}Object.assign(e,{participant:i})}}if(null!=(r=null==(i=null==e?void 0:e.participant)?void 0:i.individualParticipantIds)&&r.length&&(null==(a=e.participant.individualParticipants)||!a.length)){let i=e.participant.individualParticipantIds.map((e=>t(e)||n&&us({policyDefinitions:v,tournamentParticipants:n,internalUse:!0,contextProfile:f,participantId:e})));Object.assign(e.participant,{individualParticipants:i})}})),!Me.matchUpType){let{matchUpType:e}=Em({matchUp:Me});e&&Object.assign(Me,{matchUpType:e})}if(null!=f&&f.inferGender&&(!Me.gender||Me.gender===Ym)&&2===(null==(V=Me.sides)?void 0:V.length)&&Me.matchUpType!==$p){let e=Me.sides.map((e=>{var t,i,n,r;if(wp(Ad)(Me.matchUpType))return null==(i=null==(t=e.participant)?void 0:t.person)?void 0:i.sex;if(2===(null==(r=null==(n=e.participant)?void 0:n.individualParticipants)?void 0:r.length)){let t=hr(e.participant.individualParticipants.map((e=>{var t;return null==(t=e.person)?void 0:t.sex}))).filter(Boolean);if(1===t.length)return t[0]}}));if(2===e.filter(Boolean).length&&1===hr(e).length){let t=e[0];Me.inferredGender=t}}}if(Me.tieMatchUps){let n=Me.matchUpStatus===ml,r=null==($=Me.sides)?void 0:$.map((({participant:e,drawPosition:t,sideNumber:i,lineUp:n})=>{let r=(null==e?void 0:e.participantType)===$p&&e;return{teamParticipant:r&&ya({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participanOthertName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}),drawPosition:t,sideNumber:i,lineUp:n}}));Me.tieMatchUps=Me.tieMatchUps.map((o=>{let s=Me.matchUpId,l={finishingPositionRange:Me.finishingPositionRange,abbreviatedRoundName:he,roundNumber:pe,roundName:fe};return se({tieDrawPositions:le,scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,sideLineUps:r,drawPositionsRanges:i,initialRoundOfPlay:a,roundNamingProfile:u,additionalContext:l,appliedPolicies:v,isCollectionBye:n,usePublishState:U,publishStatus:S,matchUpTieId:s,isRoundRobin:T,roundProfile:P,matchUp:o,event:M})}))}let Ne=Me.sides&&2===Me.sides.filter((e=>null==e?void 0:e.participantId)).length,Re=!Me.winningSide;if(Object.assign(Me,{readyToScore:q&&Ne&&Re,hasContext:!0}),Ne){let{allParticipantsCheckedIn:e,checkedInParticipantIds:t}=yp({matchUp:Me});Object.assign(Me,{allParticipantsCheckedIn:e,checkedInParticipantIds:t})}return Array.isArray(null==f?void 0:f.exclude)&&(null==f||f.exclude.forEach((e=>delete Me[e]))),Me}}function Xm({matchUp:e}){return!!e&&(Cl.includes(null==e?void 0:e.matchUpStatus)||(null==e?void 0:e.winningSide))}function ef({requireParticipants:e=!0,scheduleVisibilityFilters:t,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:u,contextContent:d,participantMap:c,scheduleTiming:p,publishStatus:m,contextProfile:f,drawDefinition:h,exitProfiles:v,matchUpsMap:g,structureId:I,inContext:U,structure:y,context:S,event:w}){!y&&I&&({structure:y}=_u({drawDefinition:h,structureId:I}));let T=Zm({tournamentAppliedPolicies:i,scheduleVisibilityFilters:t,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:u,contextContent:d,participantMap:c,scheduleTiming:p,publishStatus:m,contextProfile:f,drawDefinition:h,exitProfiles:v,matchUpsMap:g,structure:y,inContext:U,context:S,event:w}),P=[],D=[],b=[],M=[],N=[];if(T.error)return T;let R,{matchUps:A}=T,{assignedPositions:E}=Gu({structure:y}),C=null==E?void 0:E.filter((e=>e.participantId)).map((e=>e.drawPosition));return A.filter((e=>{var t;let i=1===(null==(t=null==l?void 0:l.matchUpTypes)?void 0:t.length)&&l.matchUpTypes[0]===kd;return!(e.matchUpType!==kd&&i)})).forEach((t=>{var i,n,r,a;if(t.matchUpStatus===cl)return void P.push(t);t.matchUpType===kd&&(R=!0);let o=t.collectionId,s=o&&(null==(i=t.sides)?void 0:i.every((e=>e.participantId))),l=!o&&2===(null==(n=t.drawPositions)?void 0:n.filter(Boolean).length),u=!o&&(null==(r=t.drawPositions)?void 0:r.every((e=>null==C?void 0:C.includes(e)))),d=null==E?void 0:E.filter((e=>e.bye)).map((e=>e.drawPosition)),c=!o&&(null==(a=t.drawPositions)?void 0:a.find((e=>null==d?void 0:d.includes(e)))),p=kl.includes(t.matchUpStatus)&&(s||l&&(!e||u));return c?N.push(t):Xm({matchUp:t})?D.push(t):p?b.push(t):M.push(t)})),{includesTeamMatchUps:R,abandonedMatchUps:P,completedMatchUps:D,upcomingMatchUps:b,pendingMatchUps:M,byeMatchUps:N,structure:y}}function tf({finishingPositions:e,linkCondition:t,linkType:i,source:n}){var r;let a=n.find((n=>{var r,a;let o=!(null!=(r=n.source)&&r.finishingPositions)||!e||Ar(e,null==(a=n.source)?void 0:a.finishingPositions);return t===n.linkCondition&&o&&n.linkType===i}));return![iu,nu].includes(null==a?void 0:a.linkType)||null!=(r=null==a?void 0:a.source)&&r.roundNumber?a:Sa({result:{error:Fn},stack:"getTargetLink",context:a})}function nf({drawDefinition:e,structureId:t,roundNumber:i}){return e?t?{links:(e.links||[]).filter(Boolean).reduce(((e,n)=>{var r,a;return(null==(r=n.source)?void 0:r.structureId)===t&&(!i||n.source.roundNumber===i)&&(e.source=e.source.concat(n)),(null==(a=n.target)?void 0:a.structureId)===t&&(!i||n.target.roundNumber===i)&&(e.target=e.target.concat(n)),e}),{source:[],target:[]})}:{error:Dt}:{error:Ke}}function rf({sourceRoundMatchUpCount:e,inContextDrawMatchUps:t,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var a;if(!r)return{error:Tt};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:u,positionInterleave:d}}=r,{structure:c}=_u({drawDefinition:n,structureId:o}),{positionAssignments:p}=Vu({structure:c}),m=(null==t?void 0:t.filter((e=>e.structureId===(null==c?void 0:c.structureId)))).filter((e=>e.roundNumber===u&&!e.matchUpTieId)),f=m.length,h=br(1,f+1),v=f/e,g=Math.ceil(v*i),I=1-i%2;if(null!=d&&d.interleave&&.5!==v){let e=i+(d.offset+(i-1)*d.interleave);g=Math.ceil(e/2),I=1-e%2}let U=h,y=h[g-1],S=ym({roundPositionsCount:h.length,groupedOrder:l}),w=(null==S?void 0:S.length)||1;if(w<=h.length){let e=Or(h,f/w);s===eu&&e.forEach((e=>e.reverse())),U=(null==S?void 0:S.length)&&(null==S?void 0:S.map((t=>e[t-1])).flat())||U}s===Xl?y=U[g-1]:s===eu?((!(null!=S&&S.length)||w>h.length)&&(g=m.length+1-g),y=U[g-1]):s===Zl&&$r()&&console.log(Gn,{feedProfile:s});let T,P=y&&m.reduce(((e,t)=>t.roundPosition===y?t:e),void 0);null!=P&&P.feedRound?(I=0,T=Math.min(...(P.drawPositions||[]).filter(Boolean))):T=2===(null==(a=null==P?void 0:P.drawPositions)?void 0:a.length)&&(null==P?void 0:P.drawPositions[I]);let D=null==p?void 0:p.find((({drawPosition:e})=>e===T));if(D){let{extension:e}=Ds({element:D,name:Es});if(null!=e&&e.value)return{disabledDrawPosition:T}}return{matchUp:P,targetDrawPosition:T,matchUpDrawPositionIndex:I}}function af({inContextDrawMatchUps:e=[],useTargetMatchUpIds:t,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;e.length&&!a&&(a=e.find((e=>e.matchUpId===r)));let{structure:o}=_u({structureId:null==a?void 0:a.structureId,drawDefinition:n});return(null==o?void 0:o.finishingPosition)===Cu?function({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:i,structure:n,matchUp:r}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:u}=r,{links:d}=function({drawDefinition:e,roundNumber:t,structureId:i}){if(!e)return{error:Ke};if(!i)return{error:Dt};let{links:n}=nf({drawDefinition:e,structureId:i});return{links:{source:n.source.reduce(((e,i)=>i.source.roundNumber&&i.source.roundNumber!==t?e:e.concat(i)),[]),target:n.target.reduce(((e,i)=>i.target.roundNumber&&i.target.roundNumber!==t?e:e.concat(i)),[])}}}({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),c=null==d?void 0:d.source,p=tf({source:c,linkType:iu}),m=tf({linkCondition:ru,linkType:nu,source:c}),f=tf({source:c,linkType:nu}),h=m&&f;f||(f=m);let v,g,I,U,y,S,w,T,P,D,b=null==(a=null==p?void 0:p.target)?void 0:a.feedProfile,M=null==(o=null==f?void 0:f.target)?void 0:o.feedProfile,N=null==(s=null==m?void 0:m.target)?void 0:s.feedProfile;if(t&&(l||u)&&(w=l&&b!==Ql&&e.find((({matchUpId:e})=>e===l)),U=u&&M!==Ql&&e.find((({matchUpId:e})=>e===u)),w||U))return{matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p},targetMatchUps:{loserMatchUp:U,winnerMatchUp:w}};let{roundPosition:R}=r;D=D||e.filter((e=>e.structureId===n.structureId));let A=D.reduce(((e,t)=>t.roundNumber!==r.roundNumber||t.matchUpTieId?e:e+1),0);return f&&!U&&M!==Ql&&({matchUpDrawPositionIndex:S,targetDrawPosition:y,matchUp:U}=rf({targetLink:f,sourceRoundMatchUpCount:A,inContextDrawMatchUps:e,sourceRoundPosition:R,drawDefinition:i})),h&&N!==Ql&&({matchUpDrawPositionIndex:I,targetDrawPosition:g,matchUp:v}=rf({targetLink:m,sourceRoundMatchUpCount:A,inContextDrawMatchUps:e,sourceRoundPosition:R,drawDefinition:i})),p&&!w&&b!==Ql&&({matchUpDrawPositionIndex:P,targetDrawPosition:T,matchUp:w}=rf({targetLink:p,sourceRoundMatchUpCount:A,inContextDrawMatchUps:e,sourceRoundPosition:R,drawDefinition:i})),w||(D=D||e.filter((e=>e.structureId===n.structureId)),({matchUp:w}=function({structureMatchUps:e,matchUp:t}){let{roundNumber:i,roundPosition:n}=t,r=e.filter((e=>e.roundNumber===i&&!e.matchUpTieId)),a=e.filter((e=>e.roundNumber===i+1&&!e.matchUpTieId));if(a.length){let e;return a.length===r.length?e=a.find((e=>e.roundPosition===n)):a.length===r.length/2&&(e=a.find((e=>e.roundPosition===Math.ceil(n/2)))),{matchUp:e}}return{message:"no progression found"}}({structureMatchUps:D,matchUp:r}))),ya({matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p,byeTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:P,loserMatchUpDrawPositionIndex:S,byeMatchUpDrawPositionIndex:I,winnerTargetDrawPosition:T,loserTargetDrawPosition:y,byeTargetDrawPosition:g,winnerMatchUp:w,loserMatchUp:U,byeMatchUp:v},targetMatchUpIds:!(!l&&!u)})}({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:n,structure:o,matchUp:a}):function({matchUp:e}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:e}}({matchUp:a})}function of({drawDefinition:e,inContextDrawMatchUps:t}){let i={};return t.forEach((n=>{var r,a,o,s,l,u;let{matchUpId:d,structureId:c,drawPositions:p=[]}=n,{structure:m}=_u({drawDefinition:e,structureId:c});if((null==m?void 0:m.finishingPosition)===Eu){let{roundNumber:e}=n,t=e&&rr(e)+1,i=m.matchUps??[],{roundMatchUps:r}=jd({matchUps:i});if(t&&null!=r&&r[t]){let e=[...p].sort(nr).map(((e,i)=>{let n=r[t].find((t=>{var i;return null==(i=t.drawPositions)?void 0:i.includes(e)}));return{matchUpId:null==n?void 0:n.matchUpId,roundNumber:t,schedule:null==n?void 0:n.schedule,sideNumber:i+1,structureName:m.structureName}}));Object.assign(n,{sidesTo:e})}}else{let c=af({useTargetMatchUpIds:!0,inContextDrawMatchUps:t,inContextMatchUp:n,drawDefinition:e,matchUpId:d}),{winnerMatchUp:p}=c.targetMatchUps,{loserMatchUp:m}=c.targetMatchUps;!n.winnerMatchUpId&&p&&(n.winnerMatchUpId=p.matchUpId),!n.loserMatchUpId&&m&&(n.loserMatchUpId=m.matchUpId);let f=lf({upcomingMatchUp:p}),h=lf({upcomingMatchUp:m});if(n.matchUpStatus!==ml&&(null==m?void 0:m.matchUpStatus)===ml){let{matchUp:i}=sf({matchUp:m,drawDefinition:e,inContextDrawMatchUps:t})||{};h=i&&lf({upcomingMatchUp:i})||h}let v=null==(r=n.schedule)?void 0:r.timeAfterRecovery;if(v&&(null!=(a=null==f?void 0:f.schedule)&&a.scheduledTime&&Ro(f.schedule.scheduledTime)<Ro(v)&&(i[f.matchUpId]=n.matchUpId,f.schedule.scheduleConflict=n.matchUpId),null!=(o=null==h?void 0:h.schedule)&&o.scheduledTime&&Ro(h.schedule.scheduledTime)<Ro(v)&&(i[h.matchUpId]=n.matchUpId,h.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:f,loserTo:h}),null==(s=n.drawPositions)?void 0:s.filter(Boolean).length){let e=(null==(u=null==(l=c.targetLinks)?void 0:l.loserTargetLink)?void 0:u.linkCondition)===ru,i=function(e){var t;return(null==(t=null==e?void 0:e.sides)?void 0:t.map((({participant:e,participantId:t,qualifier:i})=>e||t&&{participantId:t}||i&&{qualifier:i})).filter(Boolean))||[]}(n);if(i.length){let n=ol(null==p?void 0:p.sides),r=ol(null==m?void 0:m.sides),a=i.find((({participantId:e})=>n.includes(e)))?[]:i,o=i.find((({participantId:e})=>r.includes(e)))?[]:i;m&&e&&o.length<2&&o.push({bye:!0,tbd:!0}),null!=a&&a.length&&p&&(!c.targetMatchUpIds&&p&&(p=t.find((({matchUpId:e})=>e===p.matchUpId))),p.potentialParticipants||(p.potentialParticipants=[]),p.potentialParticipants.push(a)),null!=o&&o.length&&m&&(c.targetMatchUpIds||(p=t.find((({matchUpId:e})=>e===m.matchUpId))),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(o))}}}})),Object.keys(i).length&&t.forEach((e=>{Object.keys(i).includes(e.matchUpId)&&(e.schedule.scheduleConflict=i[e.matchUpId])})),{scheduleConflictMatchUpIds:i}}function sf({matchUp:e,drawDefinition:t,inContextDrawMatchUps:i}){var n;let{matchUpId:r,matchUpStatus:a,structureId:o}=e||{};if(!e||!o||(null==e?void 0:e.matchUpStatus)===Dl)return{matchUp:e};if(a===ml){let a;return e.winnerMatchUpId?a=i.find((({matchUpId:t})=>t===e.winnerMatchUpId)):({winnerMatchUp:a}=(null==(n=af({inContextDrawMatchUps:i,drawDefinition:t,matchUpId:r}))?void 0:n.targetMatchUps)||{}),sf({matchUp:a,drawDefinition:t,inContextDrawMatchUps:i})}return{matchUp:void 0}}function lf(e){if(null!=e&&e.upcomingMatchUp)return(({matchUpId:e,structureId:t,schedule:i,roundNumber:n,roundPosition:r,structureName:a})=>({matchUpId:e,structureId:t,schedule:i,roundNumber:n,roundPosition:r,structureName:a}))(e.upcomingMatchUp)}function uf(e){Object.assign(e,{requireParticipants:!1});let t=df(e);if(t.error)return Sa({result:t,stack:"getAllDrawMatchUps"});let{abandonedMatchUps:i,completedMatchUps:n,upcomingMatchUps:r,pendingMatchUps:a,byeMatchUps:o,matchUpsMap:s}=t;return{matchUps:(i??[]).concat(...n??[],...r??[],...a??[],...o??[]),matchUpsMap:s}}function df(e){if(null==e||!e.drawDefinition)return{error:Ke};let t,{tournamentParticipants:i,contextContent:n,matchUpsMap:r}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,requireParticipants:s,participantsProfile:l,afterRecoveryTimes:u,policyDefinitions:d,tournamentRecord:c,usePublishState:p,contextFilters:m,matchUpFilters:f,scheduleTiming:h,participantMap:v,publishStatus:g,contextProfile:I,drawDefinition:U,nextMatchUps:y,inContext:S,context:w,event:T}=e,P=[],D=[],b=[],M=[],N=[];I&&!n&&(n=wm({policyDefinitions:d,tournamentRecord:c,contextProfile:I,event:T})),(null==i||!i.length)&&c&&(i=null==c?void 0:c.participants,(S||null!=l&&l.withGroupings)&&null!=i&&i.length&&({participantsWithGroupings:i,groupInfo:t}=nc({participants:i,participantsProfile:l})));let{structures:R}=Bu({drawDefinition:U});if(!R)return{error:bt};r||(r=Wd({drawDefinition:U}));let A=U&&bm({drawDefinition:U}).exitProfiles;R.forEach((e=>{let{byeMatchUps:t=[],pendingMatchUps:l=[],upcomingMatchUps:R=[],completedMatchUps:E=[],abandonedMatchUps:C=[]}=ef({matchUpFilters:y?void 0:f,contextFilters:y?void 0:m,inContext:S||y||m,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:i,requireParticipants:s,afterRecoveryTimes:u,policyDefinitions:d,tournamentRecord:c,usePublishState:p,contextContent:n,participantMap:v,scheduleTiming:h,publishStatus:g,contextProfile:I,drawDefinition:U,exitProfiles:A,matchUpsMap:r,structure:e,context:w,event:T});P=P.concat(...C),D=D.concat(...E),b=b.concat(...R),M=M.concat(...l),N=N.concat(...t)}));let E=e=>(!f&&!y&&!m||(f&&(e=qm({matchUps:e,...f})),m&&(e=qm({matchUps:e,...m,processContext:!0}))),e),C={abandonedMatchUps:E(P),completedMatchUps:E(D),upcomingMatchUps:E(b),pendingMatchUps:E(M),byeMatchUps:E(N),matchUpsMap:r,...Be,groupInfo:t};if(y){let e="object"==typeof y||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:t,completed:i,upcoming:n,pending:r,bye:a}=e;of({inContextDrawMatchUps:[].concat(...t&&P||[],...i&&D||[],...n&&b||[],...r&&M||[],...a&&N||[]),drawDefinition:U})}return C}function cf({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:i}){var n;if(!t)return{error:Ke};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(e||({matchUps:e,matchUpsMap:i}=uf({inContext:!0,drawDefinition:t,matchUpsMap:i})),!(null!=i&&i.drawMatchUps.some((e=>e.finishingPositionRange))||1!==(null==(n=null==t?void 0:t.structures)?void 0:n.length)||null!=t&&t.structures[0].structures)){qd({matchUps:(null==i?void 0:i.drawMatchUps)??[]})}return(e??[]).filter((({collectionId:e})=>!e)).forEach((n=>{let{matchUpId:a,structureId:o}=n,s=af({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:a}),{winnerMatchUp:l,loserMatchUp:u}=s.targetMatchUps,d=null==l?void 0:l.matchUpId,c=null==u?void 0:u.matchUpId,p=Hd({matchUpsMap:i,structureId:o}).find((e=>e.matchUpId===a));if(p&&(d&&(r.winnerMatchUpIds[p.matchUpId]=d,Object.assign(p,{winnerMatchUpId:d}),Object.assign(n,{winnerMatchUpId:d})),c&&(r.loserMatchUpIds[p.matchUpId]=c,n.loserMatchUpId=c,p.loserMatchUpId=c,n.finishingPositionRange))){let e=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],t=e&&[Math.min(...e),Math.max(...e)];n.finishingPositionRange.loser=t,p.finishingPositionRange.loser=t}})),{inContextDrawMatchUps:e,goesToMap:r}}function pf(e){return e&&typeof String.fromCodePoint<"u"?e.toUpperCase().replace(/./g,(e=>String.fromCodePoint(e.charCodeAt(0)+127397))):e}var mf=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function ff({participant:e,withISO2:t,withIOC:i}){let{person:n,individualParticipants:r}=e;[n,null==r?void 0:r.map((({person:e})=>e))].flat().filter(Boolean).forEach((function(e){let{nationalityCode:n}=e||{};if(n){let r=mf.find((({iso:e})=>e===n));i&&null!=r&&r.ioc&&!e.iocNationalityCode&&(e.iocNationalityCode=r.ioc),t&&null!=r&&r.iso2&&!e.iso2NationalityCode&&(e.iso2NationalityCode=r.iso2),null!=r&&r.label&&!e.countryName&&(e.countryName=r.label)}}))}function hf(e){var t;let{tournamentRecord:i,participantId:n}=e,r=e.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(r)){let e=null==(t=a.participants)?void 0:t.find((e=>e.participantId===n));if(e)return{participant:e,tournamentId:a.tournamentId}}return{error:Bi}}function vf({returnPreviousValues:e,itemSubTypes:t,itemType:i,element:n}){if(!n)return{error:mi,info:ds};if(t&&!Array.isArray(t))return{error:Fn,context:{itemSubTypes:t}};if(!Array.isArray(n.timeItems))return{error:wn};let r=n.timeItems.filter((e=>(null==e?void 0:e.itemType)===i)).filter((e=>!(null!=t&&t.length)||t.some((t=>{var i;return null==(i=null==e?void 0:e.itemSubTypes)?void 0:i.includes(t)})))).sort(((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime())),a=r.pop();if(a){let t={timeItem:a,...Be};return e&&Object.assign(t,{previousItems:r}),t}return{info:Vn}}function gf({returnPreviousValues:e,drawDefinition:t,itemSubTypes:i,itemType:n}){if(!t)return{error:mt};if(!t.timeItems)return{info:Vn};let{timeItem:r,previousItems:a,info:o}=vf({element:t,returnPreviousValues:e,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function If({returnPreviousValues:e,itemSubTypes:t,itemType:i,event:n}){if(!n)return{error:Et};if(!n.timeItems)return{info:Vn};let{timeItem:r,previousItems:a,info:o}=vf({returnPreviousValues:e,element:n,itemSubTypes:t,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:o}}function Uf({returnPreviousValues:e,tournamentRecord:t,itemSubTypes:i,itemType:n}){if(!t)return{error:We};if(!t.timeItems)return{info:Vn};let{timeItem:r,previousItems:a,info:o}=vf({element:t,returnPreviousValues:e,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function yf({returnPreviousValues:e,tournamentRecord:t,participantId:i,itemSubTypes:n,itemType:r}){if(!t)return{error:We};if(!i)return{error:_i};let a=hf({tournamentRecord:t,participantId:i});if(a.error)return a;let{participant:o}=a;if(null==o||!o.timeItems)return{info:Vn};let{timeItem:s,previousItems:l,info:u}=vf({element:a.participant,returnPreviousValues:e,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:u}}var Sf={[Zd]:"groupParticipantIds",[Xd]:"pairParticipantIds",[ec]:"teamParticipantIds"},wf={[Zd]:"groups",[ec]:"teams"};function Tf({withIndividualParticipants:e,convertExtensions:t,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:a,withISO2:o,withIOC:s}){let l={};for(let u of i.participants??[]){let e=null==u?void 0:u.participantId;e&&bf({participantMap:l,participantId:e})}for(let u of i.participants??[]){let e=Wo(u,t,a),{participantId:i,individualParticipantIds:d,participantType:c}=e;if(Object.assign(l[i].participant,e),d&&Df({individualParticipantIds:d,participantCopy:e,participantMap:l,participantType:c,participantId:i}),n&&(l[i].participant.signedIn=Pf(e)),r){let{ratings:t,rankings:n,seedings:r}=co({participant:e});l[i].participant.seedings=r,l[i].participant.rankings=n,l[i].participant.ratings=t}(s||o)&&ff({participant:l[i].participant,withISO2:o,withIOC:s})}if(e){!function({participantMap:e,template:t}){var i;let n=Object.values(e);for(let r of n){let n=r.participant;if(null!=(i=n.individualParticipantIds)&&i.length){n.individualParticipants=[];for(let i of n.individualParticipantIds){let r=e[i].participant;n.individualParticipants.push(t?po({template:t,source:r}):r)}}}}({participantMap:l,template:Ce(e)?e:void 0})}return{participantMap:l}}function Pf(e){let{timeItem:t}=vf({itemType:zd,element:e});return(null==t?void 0:t.itemValue)===Kd}function Df({individualParticipantIds:e,participantCopy:t,participantMap:i,participantType:n,participantId:r}){for(let a of e){let o=i[a].participant;if(o[Sf[n]].push(r),[ec,Zd].includes(n)){let{participantRoleResponsibilities:e,participantOtherName:i,participantName:r,participantId:a,teamId:s}=t;o[wf[n]].push({participantRoleResponsibilities:e,participantOtherName:i,participantName:r,participantId:a,teamId:s})}if(n===Xd){let t=e.find((e=>e!==a));i[a].pairIdMap[r]=t,i[a].pairIdMap[t]=r}}}function bf({participantMap:e,participantId:t}){if(e[t])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};e[t]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Ad]:{...i},[Cd]:{...i},[ec]:{...i},...i}}}function Mf({participantsProfile:e,useParticipantMap:t,tournamentRecord:i,contextProfile:n,inContext:r}){var a;if(t)return{participantMap:null==(a=Tf({...e,...n,tournamentRecord:i}))?void 0:a.participantMap};let o,s=Wo(i.participants,!1,!0)||[];if((null!=e&&e.withIOC||null!=e&&e.withISO2)&&s.forEach((t=>ff({participant:t,...e}))),(r||null!=e&&e.withGroupings)&&null!=s&&s.length&&({participantsWithGroupings:s,groupInfo:o}=nc({participantsProfile:e,deepCopy:!1,participants:s})),(null==e?void 0:e.withScaleValues)&&(null==s?void 0:s.length))for(let l of s){let{ratings:e,rankings:t}=co({participant:l});l.rankings=t,l.ratings=e}return{participants:s,groupInfo:o}}function Nf(e){let{participants:t=[],contextContent:i,participantMap:n}=e,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:d,contextFilters:c,contextProfile:p,matchUpFilters:m,nextMatchUps:f,inContext:h,context:v,event:g}=e;if(!g)return{error:Et};let I,{eventId:U,eventName:y,endDate:S,eventType:w,category:T,gender:P,matchUpFormat:D}=g??{},b={...v,...ya({indoorOutDoor:g.indoorOutdoor??(null==d?void 0:d.indoorOutdoor),surfaceCategory:g.surfaceCategory??(null==d?void 0:d.surfaceCategory),endDate:g.endDate??(null==d?void 0:d.endDate),tournamentId:null==d?void 0:d.tournamentId,matchUpFormat:D,eventName:y,eventType:w,category:T,eventId:U,gender:P})};if(S&&(b.endDate=S),p&&!i&&(i=wm({policyDefinitions:l,tournamentRecord:d,contextProfile:p,event:g})),(null==t||!t.length)&&!n&&d){let e=Mf({participantsProfile:o,useParticipantMap:u,policyDefinitions:l,tournamentRecord:d,contextProfile:p,inContext:h});n=e.participantMap,t=e.participants??[],I=e.groupInfo}let M=g.drawDefinitions??[],N=bp({tournamentRecord:d,event:g}).scheduleTiming;return{matchUps:M.flatMap((e=>{let{matchUps:u}=uf({tournamentParticipants:t,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:b,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:d,contextFilters:c,contextProfile:p,drawDefinition:e,contextContent:i,matchUpFilters:m,participantMap:n,scheduleTiming:N,nextMatchUps:f,inContext:h,event:g});return u??[]})),groupInfo:I}}function Rf(e){let t=io(e,[{tournamentRecord:!0}]);if(t.error)return t;if(null==e||!e.tournamentRecord)return{error:We};let{participantMap:i,participants:n}=e,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,inContext:d=!0,contextProfile:c,matchUpFilters:p,contextFilters:m,nextMatchUps:f,context:h}=e,v=e.tournamentId??u.tournamentId,g=(null==u?void 0:u.events)??[];n||({participants:n,participantMap:i}=Mf({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:u,contextProfile:c,inContext:d}));let{appliedPolicies:I}=jc({tournamentRecord:u}),U={...h,tournamentId:v,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},y=wm({policyDefinitions:l,tournamentRecord:u,contextProfile:c});return{matchUps:g.flatMap((e=>{var t;return U.eventDrawsCount=(null==(t=e.drawDefinitions)?void 0:t.length)??0,Nf({context:U,scheduleVisibilityFilters:r,tournamentAppliedPolicies:I,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:u,contextContent:y,contextFilters:m,contextProfile:c,matchUpFilters:p,participantMap:i,nextMatchUps:f,participants:n,inContext:d,event:e}).matchUps??[]})).concat(...u.matchUps??[])}}function Af({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){return"object"==typeof n&&Object.keys(n).length?{matchUps:Object.keys(n).map((u=>{let d=n[u];return Rf({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:i,policyDefinitions:r,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]})).flat()}:{error:qe}}function Ef(e,t){return function(e,t){return(Gl[null==e?void 0:e.stage]||0)-(Gl[null==t?void 0:t.stage]||0)}(e,t)||((null==e?void 0:e.stageSequence)||0)-((null==t?void 0:t.stageSequence)||0)||(null==e?void 0:e.roundNumber)&&t.roundNumber&&(null==e?void 0:e.roundNumber)-(null==t?void 0:t.roundNumber)||((null==e?void 0:e.roundPosition)??0)-((null==t?void 0:t.roundPosition)??0)}function Cf(e){let t,{participants:i,participantMap:n,contextContent:r}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,useParticipantMap:d,tournamentRecord:c,matchUpFilters:p,contextFilters:m,contextProfile:f,drawDefinition:h,nextMatchUps:v,inContext:g,context:I,event:U}=e,{eventId:y,eventName:S,endDate:w,eventType:T,category:P,gender:D,matchUpFormat:b}=U??{},M={...I,surfaceCategory:(null==U?void 0:U.surfaceCategory)??(null==c?void 0:c.surfaceCategory),indoorOutDoor:(null==U?void 0:U.indoorOutdoor)??(null==c?void 0:c.indoorOutdoor),matchUpFormat:b,eventType:T,eventName:S,category:P,eventId:y,endDate:w,gender:D};return!(null!=i&&i.length)&&!n&&c&&({participants:i=[],participantMap:n,groupInfo:t}=Mf({participantsProfile:s,useParticipantMap:d,policyDefinitions:u,tournamentRecord:c,contextProfile:f,inContext:g})),f&&!r&&(r=wm({policyDefinitions:u,tournamentRecord:c,contextProfile:f,drawDefinition:h,event:U})),{...uf({context:M,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:i,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:u,tournamentRecord:c,drawDefinition:h,contextContent:r,contextFilters:m,contextProfile:f,matchUpFilters:p,participantMap:n,nextMatchUps:v,inContext:g,event:U}),groupInfo:t}}function Of(e){var t;let i=Ld(e),n=e.matchUps??[],r=e.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=e;if(!Array.isArray(n))return{error:ei};if(!Array.isArray(r))return{error:mt};let l=null!=(t=e.matchUpIds)&&t.length?e.matchUpIds:n.map((e=>e.matchUpId));if(!Array.isArray(l))return{error:Zt};let u={},d={},c={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let m=Object.values(i),f=m.reduce(((e,t)=>e.concat(t.events??[]).map((e=>(e.drawDefinitions||[]).map((e=>e.links||[])))).flat(1/0)),[]).filter((({linkType:e})=>e===tu)),h=n;if(f.length){h=Af({nextMatchUps:!0,tournamentRecords:i}).matchUps;let e=f.reduce(((e,t)=>{var i,n;let r=null==(i=t.source)?void 0:i.structureId,a=null==(n=t.target)?void 0:n.structureId;return r&&a&&(c[a]=r),r&&!e.includes(r)&&e.push(r),e}),[]);for(let t of e)u[t]=[];for(let t of h??[]){let i=t.containerStructureId||t.structureId;e.includes(i)&&u[i].push(t.matchUpId)}}let v=e=>{d[e]||(d[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[e]=[])},g=(e,t)=>{d[e].matchUpIds.forEach((e=>{d[t].matchUpIds.push(e)})),d[t].matchUpIds.push(e),d[e].dependentMatchUpIds.push(t),a&&d[e].participantIds.forEach((e=>d[t].participantIds.push(e)))},I=e=>{let t=Object.keys(u).length;for(let i of e||[]){let{matchUpId:e,winnerMatchUpId:n,loserMatchUpId:r}=i;if(!l.length||l.includes(e)){if(v(e),a){let{individualParticipantIds:t}=xd(i);d[e].participantIds=t}n&&(v(n),g(e,n),p[n].push(e)),r&&(v(r),g(e,r),p[r].push(e)),d[e].sources.push(p[e]);let o=p[e].map((e=>d[e].sources[0])).flat(),s=p[e].map((e=>d[e].sources[1])).flat();if(d[e].sources.push(o,s),t){let t=i.containerStructureId||i.structureId,n=c[t];if(u[n])for(let i of u[n])v(i),g(i,e),p[i].push(e)}}}};if(s)cf({drawDefinition:s}),null!=h&&h.length||(h=Cf({drawDefinition:s}).matchUps),I(h);else{if(null!=h&&h.length||(h=Af({nextMatchUps:!0,tournamentRecords:i}).matchUps),!r.length){let e=null!=m&&m.length?m.map((({events:e=[]})=>e.map((({drawDefinitions:e=[]})=>e.map((({drawId:e})=>e)))))).flat(1/0):[];e&&(r=e)}for(let e of r){let t=null==h?void 0:h.filter((t=>t.drawId===e)).sort(Ef);if(null==t||!t.find((({roundPosition:e})=>!e))){let n=null==t?void 0:t.find((({tournamentId:e})=>e)),{drawDefinition:r}=hm({tournamentRecord:i[null==n?void 0:n.tournamentId],drawId:e});r&&cf({drawDefinition:r})}I(t)}}return{positionDependencies:u,matchUpDependencies:d,sourceMatchUpIds:p,matchUps:h,...Be}}function kf(e){var t,i;let n=null==e?void 0:e.matchUp,r=(null==e?void 0:e.score)||(null==n?void 0:n.score),a=null==(t=null==r?void 0:r.sets)?void 0:t[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:u,side1PointScore:d,side2PointScore:c}=a||{},p=o||s||l||u||d||c;return!!((null==(i=null==r?void 0:r.sets)?void 0:i.length)>1||p)}function Ff({matchUpStatus:e}){return Al.includes(e)}function xf({matchUpStatus:e}){return El.includes(e)}function Lf({matchUpStatus:e,winningSide:t,tieMatchUps:i,sides:n,score:r}){var a;let o=null==n?void 0:n.find((({participantId:e})=>e)),s=null==(a=null==i?void 0:i.filter(Lf))?void 0:a.length;return kf({score:r})||s||t&&o||e&&function({matchUpStatus:e}){return Ol.includes(e)}({matchUpStatus:e})&&![gl,bl,yl].includes(e)}function _f(e){var t;let{drawDefinition:i,findContainer:n,structureId:r,event:a}=e,o=e.structure,{containedStructures:s}=Nd({drawDefinition:i}),l=r&&s[r]||[];if(!o){let e=_u({drawDefinition:i,structureId:r});if(e.error)return e;o=n?e.containingStructure??e.structure:e.structure}if(Nm({structure:o}))return{structure:o,isAdHoc:!0,error:st};let{matchUps:u}=uf({inContext:!0,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:i,event:a}),d=null==u?void 0:u.filter((e=>e.structureId===r||l.includes(e.structureId))),{matchUpDependencies:c}=Of({drawIds:[i.drawId],matchUps:u,drawDefinition:i}),p=[],m=[],f={},h=[];for(let T of u??[]){if(T.structureId===r||l.includes(T.structureId)){m.push(...T.drawPositions??[]);let e=T.roundNumber;for(let t of(T.drawPositions??[]).filter(Boolean))(!f[t]||e&&f[t]>e)&&(f[t]=e)}Lf(T)&&(h.push(T),p.push(T.matchUpId,...(null==(t=null==c?void 0:c[null==T?void 0:T.matchUpId])?void 0:t.matchUpIds)||[]))}let v=hr(m.filter(Boolean)).sort(nr),g=hr(p),I=hr(null==d?void 0:d.map((({matchUpId:e,drawPositions:t})=>g.includes(e)?t:[])).flat().filter(Boolean)).sort(nr),{positionAssignments:U}=Vu({drawDefinition:i,structure:o}),y=null==U?void 0:U.filter((e=>e.bye)).map((e=>e.drawPosition)),S=null==U?void 0:U.filter((e=>e.qualifier)).map((e=>e.drawPosition)),w=(null==v?void 0:v.filter((e=>!I.includes(e))))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:f,activeDependentMatchUpIds:g,qualifyingDrawPositions:S,inactiveDrawPositions:w,positionAssignments:U,activeDrawPositions:I,byeDrawPositions:y,activeMatchUps:h,structure:o}}function Bf({drawPosition:e,matchUps:t=[]}){return{initialRoundNumber:t.filter((({drawPositions:t})=>e&&(null==t?void 0:t.includes(e)))).map((({roundNumber:e})=>e)).sort(nr)[0]}}var jf={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",red:"\x1b[31m",brightred:"\x1b[91m",green:"\x1b[32m",brightgreen:"\x1b[92m",yellow:"\x1b[33m",brightyellow:"\x1b[93m",blue:"\x1b[34m",brightblue:"\x1b[94m",lightblue:"\x1b[105m",magenta:"\x1b[35m",brightmagenta:"\x1b[95m",cyan:"\x1b[36m",brightcyan:"\x1b[96m",white:"\x1b[37m",brightwhite:"\x1b[97m"},Vf=[];function Gf(e,t){"string"==typeof e&&(e={method:e}),(t||$r())&&Vf.push(e)}function $f(e){let t=function(e){let t=Vf.slice();return e&&(Vf.length=0),t}(e).map((e=>{let{color:t,keyColors:i,method:n,newline:r}=e,a=Object.keys(jf).includes(t)?jf[t]:jf.cyan,o=Object.keys(e).filter((e=>!["color","keyColors","method","newline"].includes(e))).map((t=>{let n=i&&Object.keys(i).includes(t)&&jf[i[t]]?jf[i[t]]:jf.brightwhite;return`${jf.white}${t}: ${n}${e[t]}`})).join(", ");return[r?"\n":"",a,n,(null==n?void 0:n.length)<15?"\t\t":"\t",jf.white,o,jf.reset,"\n"].join("")}));null!=t&&t.length&&console.log(...t)}function qf({provisionalPositioning:e,isPositionAction:t,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:o,structure:s,event:l}){var u,d,c;if(!n)return{error:Ke};if(s||({structure:s}=_u({drawDefinition:n,structureId:o})),!s)return{error:bt};o||({structureId:o}=s);let p="assignDrawPositionBye";Gf({method:p,color:"cyan",drawPosition:r}),a||(a=Wd({drawDefinition:n}));let{positionAssignments:m}=Vu({structure:s}),{activeDrawPositions:f}=_f({drawDefinition:n,structureId:o});if(null!=(u=null==m?void 0:m.find((e=>e.drawPosition===r)))&&u.bye)return{...Be};if(null!=f&&f.includes(r))return{error:ot};let h=null==m?void 0:m.find((e=>e.drawPosition===r));if(!h)return{error:st};let{filled:v,containsBye:g,assignedParticipantId:I}=function(e){let t=e.bye,i=e.qualifier,n=e.participantId;return{containsBye:t,containsQualifier:i,assignedParticipantId:n,filled:t||i||n}}(h);if(g)return{...Be};if(v&&!g)return Sa({result:{error:tt},stack:p});let U=uf({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],{matchUps:y}=Zm({provisionalPositioning:e,drawDefinition:n,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:a,structure:s});if(null==m||m.forEach((e=>{e.drawPosition===r&&(e.bye=!0)})),s.structureType===Jl)return function({tournamentRecord:e,drawDefinition:t,drawPosition:i,matchUps:n,event:r}){n.forEach((n=>{var a;null!=(a=n.drawPositions)&&a.includes(i)&&Hf({eventId:null==r?void 0:r.eventId,tournamentRecord:e,drawDefinition:t,matchUp:n})}))}({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:y}),Pd({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),Wf({assignedParticipantId:I,isPositionAction:t,drawDefinition:n,drawPosition:r,structureId:o,stack:p});let{roundProfile:S,roundMatchUps:w}=jd({matchUps:y}),T=null==(d=S&&Object.keys(S).map((e=>parseInt(e))).reverse())?void 0:d.find((e=>{var t;return null==(t=null==S?void 0:S[e].drawPositions)?void 0:t.includes(r)})),P=T?null==w?void 0:w[T].find((({drawPositions:e})=>null==e?void 0:e.includes(r))):void 0;P&&Hf({tournamentRecord:i,drawDefinition:n,matchUp:P,event:l});let D=null==(c=null==P?void 0:P.drawPositions)?void 0:c.find((e=>e!==r));if(P&&D){let e=zf({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:U,drawPositionToAdvance:D,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(e.error)return e}return Pd({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),Wf({assignedParticipantId:I,isPositionAction:t,drawDefinition:n,drawPosition:r,structureId:o,stack:p})}function Wf({assignedParticipantId:e,isPositionAction:t,drawDefinition:i,drawPosition:n,structureId:r,stack:a}){return t&&Md({drawDefinition:i,positionAction:{removedParticipantId:e,drawPosition:n,structureId:r,name:a}}),Sa({result:{...Be},stack:a})}function Hf({tournamentRecord:e,drawDefinition:t,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:ml,score:void 0,winningSide:void 0}),yd({tournamentId:null==e?void 0:e.tournamentId,eventId:i??(null==r?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:t,matchUp:n})}function zf({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,event:s}){var l,u;Gf({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:e});let d=a.drawMatchUps.find((e=>e.matchUpId===o)),c=null==(l=t.find((e=>e.matchUpId===o)))?void 0:l.structureId,{structure:p}=_u({drawDefinition:r,structureId:c}),{positionAssignments:m}=Vu({structure:p}),f=null==m?void 0:m.filter((e=>e.bye)).map((e=>e.drawPosition)),h=null==(u=null==d?void 0:d.drawPositions)?void 0:u.find((t=>t!==e)),v=h&&(null==f?void 0:f.includes(h)),{targetLinks:{loserTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:U,loserTargetDrawPosition:y}}=af({inContextDrawMatchUps:t,drawDefinition:r,matchUpId:o});if(U&&U.structureId===(null==p?void 0:p.structureId)&&function({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,u,d,c,p,m;let f="advanceWinner",h=o.drawMatchUps.find((e=>e.matchUpId===a.matchUpId)),v=null==(l=t.find((e=>e.matchUpId===a.matchUpId)))?void 0:l.structureId,{structure:g}=_u({drawDefinition:r,structureId:v}),{positionAssignments:I}=Vu({structure:g}),U=null==(u=null==I?void 0:I.find((({drawPosition:t})=>t===e)))?void 0:u.bye,y=null==(d=h.drawPositions)?void 0:d.filter(Boolean),S=null==I?void 0:I.filter((e=>null==y?void 0:y.includes(e.drawPosition))),w=null==I?void 0:I.find((({drawPosition:t})=>t===e)),T=null==i?void 0:i.find((t=>t!==e)),P=null==(c=T&&(null==S?void 0:S.find((({drawPosition:e})=>e===T))))?void 0:c.bye,D=U&&P;if(D&&console.log({isByeAdvancedBye:D}),(null==y?void 0:y.length)>1&&U&&!P)return Sa({result:{error:tt},stack:f});let b=null==y?void 0:y.find((t=>t!==e)),M=D,N=[...(h.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),R=N.map((t=>!t&&!M||t===e?(M=!0,e):t)).sort(nr);if(!M)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:e,existingAssignments:S}),Sa({result:{error:tt},stack:f});let A=null==(p=null==I?void 0:I.find((({drawPosition:e})=>e===b)))?void 0:p.bye,E=null==(m=null==I?void 0:I.find((({drawPosition:t})=>t===e)))?void 0:m.bye;Object.assign(h,{matchUpStatus:E||A?ml:Dl,score:void 0,winningSide:void 0,drawPositions:R});let C=h.drawPositions.find((e=>!N.includes(e)));Gf({method:f,color:"brightyellow",changedDrawPosition:C,pairedDrawPositionIsBye:A,drawPositionIsBye:E}),yd({tournamentId:null==n?void 0:n.tournamentId,matchUp:h,eventId:null==s?void 0:s.eventId,context:f,drawDefinition:r});let{targetLinks:{loserTargetLink:O},targetMatchUps:{loserMatchUp:k,loserTargetDrawPosition:F}}=af({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:r});if(A||E){let i=A?e:b;if(i)zf({drawPositionToAdvance:i,matchUpId:a.matchUpId,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:r,matchUpsMap:o});else if(E&&O&&k)if(k.feedRound)Yf({loserTargetDrawPosition:F,tournamentRecord:n,loserTargetLink:O,drawDefinition:r,loserMatchUp:k,matchUpsMap:o});else{let e=1-a.roundPosition%2,t=k.drawPositions[e],i=qf({structureId:O.target.structureId,drawPosition:t,tournamentRecord:n,drawDefinition:r,event:s});if(i.error);}}}({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:U,matchUpsMap:a,event:s}),I&&v&&I.structureId!==(null==p?void 0:p.structureId)){let{roundNumber:e}=I;if(1===e){let e=qf({structureId:g.target.structureId,drawPosition:y,tournamentRecord:n,drawDefinition:r,event:s});if(e.error)return e}else Yf({loserTargetDrawPosition:y,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:I,matchUpsMap:a,event:s})}return{...Be}}function Yf({loserTargetDrawPosition:e,tournamentRecord:t,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){let{roundNumber:s}=r;Gf({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:e});let l=((null==a?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:u}=Bf({drawPosition:e,matchUps:l});if(u===s){let r=qf({structureId:i.target.structureId,drawPosition:e,tournamentRecord:t,drawDefinition:n,event:o});if(r.error)return r}}function Kf({positionAssignments:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:o}=Zm({drawDefinition:i,matchUpsMap:n,structure:r,event:a});o.forEach((n=>{let r=e.filter((({drawPosition:e})=>{var t;return null==(t=n.drawPositions)?void 0:t.includes(e)})).filter((e=>e.bye)).length;n.winningSide||(Object.assign(n,{matchUpStatus:r?ml:Dl}),yd({tournamentId:null==t?void 0:t.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:null==a?void 0:a.eventId,drawDefinition:i,matchUp:n}))}))}function Jf(e){let{inContextDrawMatchUps:t,participantId:i,drawPosition:n}=e,{tournamentRecord:r,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=e,{structure:u}=_u({drawDefinition:a,structureId:o}),d=(Gu({drawDefinition:a,structure:u}).positionAssignments||[]).find((e=>i&&e.participantId===i||n&&e.drawPosition===n));if(d&&i&&!n&&(n=null==d?void 0:d.drawPosition),!n)return{error:lt};i||(i=null==d?void 0:d.participantId);let{activeDrawPositions:c}=_f({drawDefinition:a,structureId:o});return c.includes(n)?{error:ot}:(t||({matchUps:t}=uf({inContext:!0,drawDefinition:a,matchUpsMap:s})),Qf({inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:a,structureId:o,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(Pd({tournamentId:null==r?void 0:r.tournamentId,drawDefinition:a,structure:u,event:l}),{...Be,participantId:i}):{error:nt})}function Qf({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:o}){var s,l;let{structure:u}=_u({drawDefinition:i,structureId:a});if(!u)return{error:bt};let d=Gu({drawDefinition:i,structure:u}).positionAssignments||[],c=d.some((e=>{if(e.drawPosition===n)return delete e.participantId,delete e.qualifier,delete e.bye,!0}));if(u.structureType===Jl)return Kf({positionAssignments:d,tournamentRecord:t,drawDefinition:i,matchUpsMap:r,structure:u}),{drawPositionCleared:c,...Be};let{matchUps:p}=Zm({drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:u,event:o}),{roundProfile:m,roundMatchUps:f}=jd({matchUps:p}),h=null==(s=m&&Object.keys(m))?void 0:s.map((e=>rr(e))),v=n,g=null==(l=null==h?void 0:h.map((e=>{var t,i,n,r;let a=null==(i=null==(t=null==m?void 0:m[e])?void 0:t.pairedDrawPositions)?void 0:i.find((e=>e.includes(v))),o=null==a?void 0:a.find((e=>e!==v)),s=d.find((e=>e.drawPosition===o)),l=null==m?void 0:m[e+1],u=null==s?void 0:s.bye,c=null==(n=null==l?void 0:l.pairedDrawPositions)?void 0:n.find((e=>e.includes(o))),p=u&&c&&l&&(null==(r=l.drawPositions)?void 0:r.includes(o)),f=a&&{pairedDrawPositionByeAdvancedPair:!p&&c,pairedDrawPosition:o,targetDrawPosition:v,relevantPair:a,roundNumber:e};return p&&(v=o),f})).filter((e=>null==e?void 0:e.targetDrawPosition)))?void 0:l.reduce(((e,t)=>{let{roundNumber:i,relevantPair:n,targetDrawPosition:r,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=t,s=[{roundNumber:i,targetDrawPosition:r,relevantPair:n},o&&{roundNumber:i+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat(...s)}),[]);return null==g||g.forEach((({roundNumber:s,targetDrawPosition:l,relevantPair:c})=>{let p=null==f?void 0:f[s].find((e=>{var t;return Ar(null==(t=e.drawPositions)?void 0:t.filter(Boolean),c.filter(Boolean))}));p&&(function({inContextDrawMatchUps:e,targetDrawPosition:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:o}){let{structure:s}=_u({drawDefinition:n,structureId:o});if(!s)return{error:bt};if(s.structureType===Jl)return;r=r||Wd({drawDefinition:n});let l=((null==r?void 0:r.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:u}=Bf({drawPosition:t,matchUps:l}),d=null==l?void 0:l.filter((e=>{var i;return e.roundNumber>=a&&e.roundNumber!==u&&(null==(i=e.drawPositions)?void 0:i.includes(t))})),c=Vu({drawDefinition:n,structureId:o}).positionAssignments??[];null==d||d.forEach((a=>Zf({drawPosition:t,targetMatchUp:a,inContextDrawMatchUps:e,positionAssignments:c,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})))}({inContextDrawMatchUps:e,targetDrawPosition:l,tournamentRecord:t,drawDefinition:i,structureId:a,roundNumber:s,matchUpsMap:r}),Zf({inContextDrawMatchUps:e,positionAssignments:d,tournamentRecord:t,drawDefinition:i,targetMatchUp:p,drawPosition:n,matchUpsMap:r,structure:u,event:o}))})),{tasks:g,drawPositionCleared:c,positionAssignments:d}}function Zf({inContextDrawMatchUps:e,positionAssignments:t,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var u,d,c,p,m,f;let h="removeDrawPosition",v=null==(u=r.drawPositions)?void 0:u.slice(),g=r.matchUpStatus,I=r.winningSide,U=(o=o??Wd({drawDefinition:n})).mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:y}=Bf({drawPosition:a,matchUps:U});if(r.roundNumber&&y&&r.roundNumber>y){let e=(r.drawPositions??[]).map((e=>e===a?void 0:e));r.drawPositions=e}if(r.matchUpType===kd){let t=((null==(d=null==e?void 0:e.find((e=>e.matchUpId===r.matchUpId)))?void 0:d.sides)??[]).reduce(((e,t,i)=>t.drawPosition===a?i:e),void 0);void 0!==t&&null!=(p=null==(c=r.sides)?void 0:c[t])&&p.lineUp&&(null==(m=r.sides)||delete m[t].lineUp,yd({tournamentId:null==i?void 0:i.tournamentId,context:`${h}-TEAM`,eventId:null==l?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let S=af({matchUpId:r.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetLinks:{winnerTargetLink:w},targetMatchUps:{loserMatchUp:T,winnerMatchUp:P,loserMatchUpDrawPositionIndex:D}}=S,b=t.filter((({drawPosition:e})=>{var t;return null==(t=r.drawPositions)?void 0:t.includes(e)})).filter((e=>e.bye)).length,M=b&&ml||r.matchUpStatus&&[gl,bl].includes(r.matchUpStatus)&&r.matcHUpStatus||2===(null==(f=r.drawPositions)?void 0:f.length)&&Dl||void 0;r.matchUpStatus=M,r.matchUpStatus&&[bl,gl].includes(r.matchUpStatus)&&(r.winningSide=void 0);let N=null==v?void 0:v.find((e=>{var t;return!(null!=(t=r.drawPositions)&&t.includes(e))}));if(null!=v&&v.includes(a)&&g===r.matchUpStatus&&I===r.winningSide||(N&&Gf({method:h,color:"brightyellow",removedDrawPosition:N}),yd({tournamentId:null==i?void 0:i.tournamentId,eventId:null==l?void 0:l.eventId,matchUp:r,context:`${h}-${a}`,drawDefinition:n})),T&&T.structureId!==S.matchUp.structureId&&!b){let{drawPositions:t,roundNumber:r}=T;if(1===r){let r=t[D];Qf({structureId:T.structureId,drawPosition:r,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:o})}else{let r=Math.min(...t.filter(Boolean)),a=function({loserMatchUpDrawPosition:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){var s;let{structure:l}=_u({structureId:r.structureId,drawDefinition:n}),{positionAssignments:u}=Vu({structure:l});if(null!=(s=null==u?void 0:u.find((t=>t.drawPosition===e)))&&s.bye){let s=Jf({drawPosition:e,structureId:r.structureId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:o});if(s.error)return s}return{...Be}}({loserMatchUpDrawPosition:r,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:T,matchUpsMap:o,event:l});if(a.error)return Sa({result:a,stack:h});let s=((null==o?void 0:o.mappedMatchUps)||{})[T.structureId].matchUps,{initialRoundNumber:u}=Bf({drawPosition:r,matchUps:s});1===u&&(Gf({method:h,color:"brightyellow",loserMatchUpDrawPosition:r}),Qf({structureId:T.structureId,drawPosition:r,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:o}))}}return P&&P.structureId!==S.matchUp.structureId&&w.target.feedProfile,{...Be}}function Xf({drawDefinition:e,stages:t}){if(!e)return{error:Ke};let i=hr(((null==e?void 0:e.structures)??[]).filter((e=>!(null!=t&&t.length)||e.stage&&t.includes(e.stage))).map((e=>{let{positionAssignments:t}=Vu({structure:e});return t?t.map(sl):[]})).flat().filter(Boolean));return{...Be,assignedParticipantIds:i}}function eh(e){let t=((null==e?void 0:e.entries)??[]).filter(Boolean).reduce(((e,t)=>{let{entryStage:i,entryStatus:n}=t,r=`_${i||xl}${n||""}`;return e[r]||(e[r]=[]),e[r].push(t),e}),{}),i=e=>isNaN(e)?1/0:e;return Object.keys(t).map((e=>t[e].sort(((e,t)=>i(e.entryPosition)-i(t.entryPosition))).map(((e,t)=>({...e,entryPosition:t+1}))))).flat()}function th(e){return[vc,hc].includes(e)}function ih({autoEntryPositions:e=!0,ignoreAssignment:t,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:u,stage:d,event:c}){var p,m,f,h,v,g,I,U,y,S,w,T;if(!r||!Array.isArray(r))return{error:Ei,method:"modifyEntriesStatus",participantIds:r};if(!n&&!c)return{error:Et};if(a&&!Tc.includes(a))return{error:Ki};if(o&&!Vl.includes(o))return{error:_t};let P="modifyEntriesStatus",D=[];if(!a&&!s)return Sa({result:{error:mi},info:"Missing entryStatus",stack:P});if(s&&!ms({extension:s,requiredAttributes:["name"]}))return Sa({result:{error:Fn},info:"Invalid extension",context:{extension:s},stack:P});let b=[];null==(p=null==c?void 0:c.drawDefinitions)||p.forEach((e=>{let t=Xf({stages:d&&[d],drawDefinition:e}).assignedParticipantIds??[];b.push(...t)}));let M=(null==i?void 0:i.participants)??[];if(!r.every((e=>{var t;let i=null==(t=us({tournamentParticipants:M,participantId:e}))?void 0:t.participantType;return!(i&&[Xd,Jd].includes(i)&&th(a)||a&&null!=c&&c.eventType&&i===Qd&&[Vp,qp].includes(c.eventType)&&[oc,...Uc].includes(a))})))return{error:Ki};let N=c&&fm({event:c}).flightProfile,R=null==(m=null==N?void 0:N.flights)?void 0:m.find((e=>e.drawId===u)),A=e=>{let i=(e||[]).filter((e=>!d||!e.entryStage||d===e.entryStage)).filter((({participantId:e})=>r.includes(e)));return i.every((e=>!((e=>a&&b.includes(e.participantId)&&!(Uc.includes(e.entryStatus)&&Uc.includes(a)))(e)&&!t)&&(a&&(e.entryStatus=a,delete e.entryPosition),o&&(e.entryStage=o,delete e.entryPosition),s&&(s.value?fs({element:e,extension:s}):ps({element:e,name:s.name})),!0)))?{...Be}:{error:Hi}},E=({flight:e,drawDefinition:t})=>{c&&(c.entries=eh({entries:c.entries??[]})),e&&(e.drawEntries=eh({entries:e.drawEntries})),t&&(t.entries=eh({entries:t.entries}))},C=e=>{let{flight:t,drawDefinition:i}=e,n="updateDrawEntries";if(t){let e=A(t.drawEntries);if(e.error)return Sa({result:e,stack:n})}if(i){let e=A(i.entries);if(e.error)return Sa({result:e,stack:n});D.includes(i.drawId)||D.push(i.drawId)}return{...Be}},O=(null==(f=null==c?void 0:c.entries)?void 0:f.find((({entryPosition:e})=>e)))??((null==(h=null==R?void 0:R.drawEntries)?void 0:h.find((({entryPosition:e})=>e)))||(null==(v=null==n?void 0:n.entries)?void 0:v.find((({entryPosition:e})=>e))));if(e&&!O&&E({flight:R,drawDefinition:n}),R||n){let e=C({flight:R,drawDefinition:n});if(e.error)return Sa({result:e,stack:P})}let k=(null==(g=null==c?void 0:c.drawDefinitions)?void 0:g.map((({drawId:e})=>e)))??[],F=(null==(I=null==N?void 0:N.flights)?void 0:I.filter((e=>!k.includes(e.drawId))))||[];for(let L of F){let e=L&&C({flight:L});if(null!=e&&e.error)return Sa({result:e,stack:P})}let x=1===(null==(U=null==N?void 0:N.flights)?void 0:U.length)&&((null==(y=null==c?void 0:c.drawDefinitions)?void 0:y.length)??0)<=(null==(S=null==N?void 0:N.flights)?void 0:S.length);if(!R&&!n&&a&&yc.includes(a))return{error:en};if(!R&&!n||a===Ic||l&&x){let e,t=A(null==c?void 0:c.entries);if(null!=t&&t.error)return Sa({result:t,stack:P});if(a===Ic&&(null==(w=null==N?void 0:N.flights)||w.every((t=>{let i=A(t.drawEntries);return i.error?(e=i.error,!1):(t.drawEntries=t.drawEntries.filter((({participantId:e})=>!r.includes(e))),!0)})),null==(T=null==c?void 0:c.drawDefinitions)||T.every((t=>{var i;let n=A(t.entries);return n.error?(e=n.error,!1):(t.entries=null==(i=t.entries)?void 0:i.filter((({participantId:e})=>!r.includes(e))),!0)}))),e)return Sa({result:{error:e},stack:P})}e&&E({flight:R,drawDefinition:n});for(let L of(null==c?void 0:c.drawDefinitions)??[])D.length&&!D.includes(L.drawId)||wd({tournamentId:i.tournamentId,eventId:null==c?void 0:c.eventId,drawDefinition:L});return{...Be}}function nh(e){let{participantMap:t,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,schedule:d,drawId:c,score:p}=e;!d||!Object.keys(d).length||n===ml||t[i].scheduleItems.push({...d,scheduledDate:Co(null==d?void 0:d.scheduledDate),scheduledTime:Eo(null==d?void 0:d.scheduledTime),checkScoreHasValue:kf({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:u,drawId:c})}function rh({requireTimeStamp:e,scaleAttributes:t,participant:i}){var n,r;if(!i)return{error:xi};if(!Ce(t))return{error:Fn};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=t,u=[so,o,s,l].join("."),d=i.timeItems.filter((e=>(null==e?void 0:e.itemType)===u)).filter((t=>!e||(null==t?void 0:t.itemDate))).sort(((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0))).pop();if(d){let[e,t,i,o]=(null==(n=d.itemType)?void 0:n.split("."))??[];if(e!==so)return{error:Dn};let s=(null==(r=a&&Vd({element:d.itemValue,accessor:a}))?void 0:r.value)||d.itemValue,l={eventType:i,scaleDate:d.itemDate,scaleValue:s,scaleName:o,scaleType:t};return{...Be,scaleItem:l}}}return{...Be,scaleItem:void 0}}function ah({publishedSeeding:e,usePublishState:t,withSeeding:i,participant:n,event:r}){var a,o,s;let l={},u=e=>[so,lo,r.eventType,e].join("."),d=Object.assign({},...(n.timeItems||[]).filter((({itemType:e})=>e.split(".")[1]===lo)).map((({itemType:e,itemValue:t})=>({[e]:t})))),c=((null==e?void 0:e.stageSeedingScaleNames)&&Object.values(null==e?void 0:e.stageSeedingScaleNames)||Array.isArray(null==e?void 0:e.seedingScaleNames)&&e.seedingScaleNames||[]).map(u),p=Nr(Object.keys(d),c);if(t&&(Object.keys(d).length||null!=(a=null==e?void 0:e.drawIds)&&a.length)&&!p.length||!p.length)if(t||"object"!=typeof i){let i,{categoryName:a,ageCategoryCode:u}=r.category||{},d=[u,r.eventId,a].filter(Boolean);for(let e of d){let t=rh({scaleAttributes:{eventType:r.eventType,scaleType:lo,scaleName:e},participant:n});if(t.scaleItem){i=t.scaleItem;break}}if(i&&(!t||null!=e&&e.published&&(null==(s=null==(o=null==e?void 0:e.published)?void 0:o.drawIds)||!s.length))){let e=i.scaleValue;l.seedValue=e}}else{let e=Object.keys(i).map((e=>{let t=u(i[e]);return[e,d[t]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),t=Object.assign({},...e);l.seedAssignments=t}else if(null!=e&&e.stageSeedingScaleNames){let t=Object.keys(e.stageSeedingScaleNames).map((t=>{let i=u(e.stageSeedingScaleNames[t]);return[t,d[i]]})).filter((e=>e[1])).map((e=>({[e[0]]:{seedValue:e[1]}}))),i=Object.assign({},...t);l.seedAssignments=i}else if(p){let e=p.map((e=>d[e]));l.seedValue=e.pop()}return l}function oh({convertExtensions:e,seedAssignments:t,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:u,entryPosition:d,extensions:c}=s,p=null!=c&&c.length&&e?Object.assign({},...Ho(c??[])):{},m=Object.assign(p,{entryPosition:d,entryStatus:l,entryStage:u,ranking:o,eventId:a});i.events[a]=ya(m,!1,!1,!0),n&&(t&&(i.events[a].seedAssignments=t),r&&(i.events[a].seedValue=r))}function sh(e,t){return(e||"").localeCompare(t||"")}function lh({event:e,status:t=gp}){var i,n,r;return null==(r=null==(n=null==(i=If({itemType:`${vp}.${Ip}`,event:e}))?void 0:i.timeItem)?void 0:n.itemValue)?void 0:r[t]}function uh({drawDetails:e,drawId:t}){var i,n;return null==(n=null==(i=null==e?void 0:e[t])?void 0:i.publishingDetail)?void 0:n.published}function dh(e){var t,i,n,r,a,o,s;let{tournamentRecord:l,drawDefinition:u,eventIds:d,eventId:c,drawIds:p,drawId:m,event:f}=e??{};if(l&&!function(e){let{tournamentId:t}=e??{};return!!t}(l))return{error:Fn};if(c&&!f)return{error:Ct};if(Array.isArray(d)&&null!=d&&d.length){let e={};for(let i of d){if(!Ee(i))return{error:Fn};let n=null==(t=hm({tournamentRecord:l,eventId:i}))?void 0:t.event;if(!n)return{error:Ct};let r=ch({event:n});e[i]=r}return{...Be,publishState:e}}if(f){let e=ch({event:f}),t={};if(m)return u?{publishState:{status:{published:!(null==(i=e.status.publishedDrawIds)||!i.includes(m)),drawDetail:null==(n=e.status.drawDetails)?void 0:n[m]},...Be}}:{error:Qe};if(Array.isArray(p)&&null!=p&&p.length){let i=(null==(r=f.drawDefinitions)?void 0:r.map(ul))??[];for(let n of p){if(!Ee(n))return{error:Fn};if(!i.includes(n))return{error:Qe};t[n]={status:{published:!!e.status.publishedDrawIds.includes(n),drawDetail:null==(a=e.status.drawDetails)?void 0:a[n]}}}}else t=e;return{...Be,publishState:t}}let h=[],v=!1,g={},I=function({tournamentRecord:e,status:t=gp}){var i,n,r;return null==(r=null==(n=null==(i=Uf({tournamentRecord:e,itemType:`${vp}.${Ip}`}))?void 0:i.timeItem)?void 0:n.itemValue)?void 0:r[t]}({tournamentRecord:l});g.tournament=I??{};for(let U of(null==l?void 0:l.events)??[]){let e=ch({event:U});g[U.eventId]=e,e.status.published&&(h.push(U.eventId),v=!0);for(let{drawId:t}of U.drawDefinitions??[]){let i=null==(s=null==(o=e.status)?void 0:o.publishedDrawIds)?void 0:s.includes(t);i&&(g[t]={status:{published:i}})}}return l&&(g.tournament.status={published:v,publishedEventIds:h}),{...Be,publishState:g}}function ch({event:e}){var t;let i=lh({event:e});if(!i)return{status:{published:!1}};let n={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(n,i.seeding);let r=i.drawDetails??{};for(let o of(null==(t=e.drawDefinitions)?void 0:t.map(ul))||[])r[o]||(r[o]={publishingDetail:{published:!1}});let a=r&&Object.keys(r).length&&Object.keys(r).filter((e=>uh({drawDetails:r,drawId:e})))||i.drawIds;return{status:{published:a&&a.length>0,publishedDrawIds:a,publishedSeeding:n,drawDetails:r}}}function ph({finishingPositionRange:e={},participantMap:t,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:u,drawId:d,stage:c}){let p=t[a],m=e=>Math.abs(e[0]-e[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:c,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:d});let f=p.structureParticipation[l],{winner:h,loser:v}=e,g=n?h:v;n&&(f.winCount+=1,r===bl&&(f.walkoverWinCount+=1),r===gl&&(f.defaultWinCount+=1)),g&&(!f.finishingPositionRange||m(g)<m(f.finishingPositionRange))&&(f.finishingPositionRange=g),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=u,f.finishingRound=i,f.roundNumber=s),1===i&&(f.participantWon=n))}function mh(e){var t,i,n,r,a,o,s,l,u,d;let{withScheduleItems:c,scheduleAnalysis:p,withTeamMatchUps:m,participantMap:f,withOpponents:h,withMatchUps:v,withEvents:g,withDraws:I,finishingPositionRange:U,finishingRound:y,matchUpStatus:S,stageSequence:w,roundNumber:T,structureId:P,score:D,stage:b,withRankingProfile:M,tieWinningSide:N,roundPosition:R,matchUpTieId:A,matchUpSides:E,collectionId:C,matchUpType:O,winningSide:k,matchUpId:F,schedule:x,eventId:L,drawId:_,sides:B}=e,j=h&&2===(null==B?void 0:B.length)&&Object.assign({},...B.map((({sideNumber:e},t)=>{let i=B[1-t].participantId;return e&&{[e]:i}})).filter(Boolean));for(let V of B){let{participantId:e,sideNumber:B,bye:G}=V;if(G)continue;let $=k===B,q=e=>{var t,i;let n=null==(t=f[e])?void 0:t.participant,r=null==n?void 0:n.participantType,a=[{participantId:e,participantType:r}];if(r!==Jd)for(let o of(null==n?void 0:n.individualParticipantIds)||[]){let e=null==(i=f[o])?void 0:i.participant;a.push({participantType:null==e?void 0:e.participantType,participantId:o})}return a},W=(e,t)=>{if(v){if(f[e].matchUps[F]={participantWon:$,matchUpType:O,structureId:P,sideNumber:B,matchUpId:F,eventId:L,drawId:_,stage:b},h){let i=q(t);f[e].matchUps[F].opponentParticipantInfo=i}C&&(f[e].matchUps[F].collectionId=C)}h&&t&&(f[e].opponents[t]={participantId:t,matchUpId:F,eventId:L,drawId:_}),M&&ph({finishingPositionRange:U,participantMap:f,participantWon:$,finishingRound:y,matchUpStatus:S,participantId:e,stageSequence:w,roundNumber:T,structureId:P,matchUpId:F,drawId:_,stage:b}),(p||c)&&nh({participantMap:f,participantId:e,matchUpStatus:S,roundPosition:R,matchUpType:O,roundNumber:T,structureId:P,matchUpId:F,schedule:x,drawId:_,score:D})},H=({participant:e,partnerParticipantId:t})=>{var i,n,r;let a=(e,t)=>{e&&(e.partnerParticipantIds||(e.partnerParticipantIds=[]),e.partnerParticipantIds.includes(t)||e.partnerParticipantIds.push(t))};I&&a(null==(i=null==e?void 0:e.draws)?void 0:i[_],t),g&&a(null==(n=null==e?void 0:e.events)?void 0:n[L],t),v&&a(null==(r=null==e?void 0:e.matchUps)?void 0:r[F],t)};if(e&&f[e]){let c=null==j?void 0:j[B];W(e,c);let p=(null==(t=f[e])?void 0:t.participant.participantType)===Xd,h=(null==(i=f[e])?void 0:i.participant.individualParticipantIds)||[];if(A){if(m){let t=e=>f[e].matchUps[A]={participantWon:N===B,matchUpId:A,matchUpType:kd,sideNumber:B};t(e),h.forEach(t)}if(I&&!f[e].draws[_]){let t=null==(r=null==(n=E.find((e=>e.sideNumber===B)))?void 0:n.participant)?void 0:r.participantId,i=null==(s=null==(o=null==(a=f[t])?void 0:a.draws)?void 0:o[_])?void 0:s.entryStatus,l=e=>f[e].draws[_]={entryStatus:i,eventId:L,drawId:_};l(e),h.forEach(l)}}if(p&&(h.forEach((e=>f[e]&&W(e,c))),h.forEach(((e,t)=>{let i=h[1-t],n=f[e];n&&H({participant:n,partnerParticipantId:i})})),g&&E)){let t=null==(u=null==(l=E.find((e=>e.sideNumber===B)))?void 0:l.participant)?void 0:u.participantId;if(t){let i=null==(d=f[t])?void 0:d.events[L];i?(f[e].events[L]={...i},h.forEach((e=>f[e].events[L]={...i}))):console.log("Missing teamEntry",{eventId:L,teamParticipantId:t})}}if(k){let t=e=>{$?(f[e].counters[O].wins+=1,f[e].counters.wins+=1,S===bl&&(f[e].counters[O].walkoverWins+=1,f[e].counters.walkoverWins+=1),S===gl&&(f[e].counters[O].defaultWins+=1,f[e].counters.defaultWins+=1)):(f[e].counters[O].losses+=1,f[e].counters.losses+=1,S===bl&&(f[e].counters[O].walkovers+=1,f[e].counters.walkovers+=1),S===gl&&(f[e].counters[O].defaults+=1,f[e].counters.defaults+=1))};t(e),h.forEach(t)}}}}function fh({participantFilters:e={},tournamentRecord:t,participants:i=[]}){var n;if(!Object.keys(e).length)return i;let{accessorValues:r,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:u,participantTypes:d,participantIds:c,signInStatus:p,enableOrFiltering:m,eventIds:f,genders:h}=e,v=hh(f)&&(null==(n=null==t?void 0:t.events)?void 0:n.filter((e=>null==f?void 0:f.includes(e.eventId))))||(null==t?void 0:t.events)||[],g=a&&function({drawEntryStatuses:e,tournamentEvents:t}){let i=({entryStatus:t})=>!Array.isArray(e)||e.includes(t);return hr(t.reduce(((e,t)=>{var n,r;let{flightProfile:a}=fm({event:t}),o=(null==(n=null==a?void 0:a.flights)?void 0:n.map((({drawEntries:e})=>Array.isArray(e)?e.filter(i).map(sl):[])).flat())||[],s=(null==(r=t.drawDefinitions)?void 0:r.map((({entries:e})=>e?e.filter(i).map(sl):[])))||[];return e.concat(...o,...s)}),[]))}({drawEntryStatuses:a,tournamentEvents:v}),I=s&&function({eventEntryStatuses:e,tournamentEvents:t}){return hr(t.reduce(((t,i)=>{let n=(i.entries||[]).filter((({entryStatus:t})=>!Array.isArray(e)||e.includes(t))).map(sl);return t.concat(...n)}),[]))}({eventEntryStatuses:s,tournamentEvents:v}),U=void 0!==o&&[!0,!1].includes(o)&&v.reduce(((e,t)=>e.concat(...(t.drawDefinitions||[]).map((e=>ju({drawDefinition:e}).allPositionedParticipantIds)).filter(Boolean))),[]),y=e=>null==r?void 0:r.reduce(((t,i)=>{let{accessor:n,value:r}=i,{values:a}=Vd({element:e,accessor:n});return t&&(null==a?void 0:a.includes(r))}),!0);if(i=null==i?void 0:i.filter((e=>{var t,i;let n=null==(i=null==(t=vf({element:e,itemType:zd}))?void 0:t.timeItem)?void 0:i.itemValue,{participantRoleResponsibilities:a,participantType:s,participantRole:f,participantId:v,person:S}=e,w=Array.isArray(h)&&(null==h?void 0:h.length)&&(null==S?void 0:S.sex)&&h.includes(S.sex);return m?h&&w||o&&U.includes(v)||!1===o&&!U.includes(v)||(null==g?void 0:g.includes(v))||(null==I?void 0:I.includes(v))||(null==c?void 0:c.includes(v))||p&&n===p||d&&s&&hh(d)&&d.includes(s)||l&&f&&hh(l)&&l.includes(f)||u&&hh(a)&&hh(u)&&u.find((e=>null==a?void 0:a.includes(e)))||(null==r?void 0:r.length)&&hh(r)&&y(e):(!h||w)&&(void 0===o||o&&U.includes(v)||!1===o&&!U.includes(v))&&(!g||g.includes(v))&&(!I||I.includes(v))&&(!c||c.includes(v))&&(!p||n===p)&&(!d||s&&hh(d)&&d.includes(s))&&(!l||f&&hh(l)&&l.includes(f))&&(!u||hh(a)&&hh(u)&&u.find((e=>null==a?void 0:a.includes(e))))&&(!(null!=r&&r.length)||hh(r)&&y(e))})),v.length&&f){let e=v.filter((e=>f.includes(e.eventId))).map((e=>{let i=(e.entries||[]).map((e=>e.participantId));if(wp(Bp)(e.eventType))return i;let n=((null==t?void 0:t.participants)??[]).filter((e=>i.includes(e.participantId))).map((e=>e.individualParticipantIds)).flat(1);return i.concat(...n)})).flat(1);i=null==i?void 0:i.filter((t=>e.includes(t.participantId)))}return i}function hh(e){return e&&Array.isArray(e)&&e.length}function vh(e){var t;let{withIndividualParticipants:i,participantFilters:n={},withPotentialMatchUps:r,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:u,scheduleAnalysis:d,withSignInStatus:c,withTeamMatchUps:p,withScaleValues:m,usePublishState:f,contextProfile:h,withStatistics:v,withOpponents:g,withMatchUps:I,internalUse:U,withSeeding:y,withEvents:S,withDraws:w,withISO2:T,withIOC:P}=e;if(!u)return{error:We};(I||a)&&Of({tournamentRecord:u});let{participantMap:D}=Tf({convertExtensions:o,tournamentRecord:u,withSignInStatus:c,withScaleValues:m,internalUse:U,withISO2:T,withIOC:P}),b=function(e){var t,i,n,r,a,o,s;let{participantFilters:l,convertExtensions:u,policyDefinitions:d,tournamentRecord:c,usePublishState:p,contextProfile:m,participantMap:f,withPotentialMatchUps:h,withRankingProfile:v,withScheduleItems:g,scheduleAnalysis:I,withTeamMatchUps:U,withStatistics:y,withOpponents:S,withMatchUps:w,withSeeding:T,withEvents:P,withDraws:D}=e,b=null==l?void 0:l.participantIds,M=e=>{var t,i;let n=[e];return null==(i=null==(t=f[e])?void 0:t.participant.individualParticipantIds)||i.forEach((e=>n.push(e))),n.some((e=>!(null!=b&&b.length)||b.includes(e)))?n:[]},N={withMatchUps:w||v,withEvents:P||v,withDraws:D||v,withPotentialMatchUps:h,withRankingProfile:v,withScheduleItems:g,scheduleAnalysis:I,withTeamMatchUps:U,withStatistics:y,participantMap:f,withOpponents:S,withSeeding:T},R=[],A={},E=[],C={},O={},k={},F=({eventType:e,scaleNames:t,participantId:i})=>{var n,r,a,o;return null==(o=null==(a=null==(r=null==(n=f[i].participant)?void 0:n.rankings)?void 0:r[e])?void 0:a.find((e=>t.includes(e.scaleName))))?void 0:o.scaleValue};for(let x of(null==c?void 0:c.events)||[]){if(null!=l&&l.eventIds&&!l.eventIds.includes(x.eventId))continue;let{drawDefinitions:e=[],extensions:b=[],eventType:R,eventName:L,category:_,entries:B,eventId:j,gender:V}=x,{flightProfile:G}=fm({event:x}),$=(null==G?void 0:G.flights)??[],q=dh({event:x}).publishState;q&&(C[j]=q);let W=null==(t=null==q?void 0:q.status)?void 0:t.publishedSeeding;if(P||T||v){let e=u?Object.assign({},...Ho(b??[])):{};O[j]={...e,eventName:L,eventType:R,category:_,eventId:j,gender:V};let t=[null==_?void 0:_.categoryName,null==_?void 0:_.ageCategoryCode].filter(Boolean);for(let i of B){let{participantId:e}=i;if(!e||!f[e])continue;let n,r,a=F({eventType:R,scaleNames:t,participantId:e});if(T){let t=f[e].participant;({seedAssignments:n,seedValue:r}=ah({publishedSeeding:W,usePublishState:p,withSeeding:T,participant:t,event:x}))}let o=e=>{var t,o;if(null!=(o=null==(t=f[e])?void 0:t.events)&&o[j])return;let s=f[e];oh({convertExtensions:u,seedAssignments:n,participant:s,withSeeding:T,seedValue:r,eventId:j,ranking:a,entry:i})};o(e),(f[e].participant.individualParticipantIds||[]).forEach(o)}}let H=null==(i=null==C?void 0:C[j])?void 0:i.publishedSeeding;if(D||v||T){let t=e=>e?Object.assign({},...e.map((({participantId:e,seedValue:t,seedNumber:i})=>({[e]:{seedValue:t,seedNumber:i}})))):void 0,i=hr([...e.map(ul),...$.map(ul)]);for(let o of i){let i,s,l,u,d=e.find((e=>e.drawId===o)),c=null==$?void 0:$.find((e=>e.drawId===o)),m=(null==d?void 0:d.entries)||(null==c?void 0:c.drawEntries),{structures:h=[],drawOrder:g,drawName:I,drawType:U}=d??{},y=null==c?void 0:c.flightNumber,S=[null==_?void 0:_.categoryName,null==_?void 0:_.ageCategoryCode].filter(Boolean),w=((null==d?void 0:d.structures)||[]).sort(((e,t)=>xu(e,t))).map((({structureId:e,structures:t})=>[e,...(t||[]).map((({structureId:e})=>e))])).flat(1/0),P=0,b=h.filter((({stage:e,stageSequence:t})=>e===xl&&1===t||e===Ll)).flatMap((e=>{let{seedAssignments:t,stageSequence:n,stage:r}=e,{positionAssignments:a}=Vu({structure:e});return r===xl?(P=(null==a?void 0:a.length)??0,l=a,u=t):1===n&&(i=a,s=t),a})).map((({participantId:e})=>e)).filter(Boolean),M=t(u),N=t(s),A=d?m.filter((({participantId:e})=>b.includes(e))):m,E=!p||(null==H?void 0:H.published)&&(0===(null==(n=null==H?void 0:H.drawIds)?void 0:n.length)||(null==(r=null==H?void 0:H.drawIds)?void 0:r.includes(o)));for(let e of A){let{entryStatus:t,entryStage:i,entryPosition:n,participantId:r}=e,s=F({participantId:r,scaleNames:S,eventType:R}),l=e=>{var a,l,u,d,c;if(null!=(a=f[e].draws)&&a[o])return;let p=T&&E,m=p?{}:void 0,h=p?(null==(l=null==M?void 0:M[r])?void 0:l.seedValue)||(null==(u=null==M?void 0:M[r])?void 0:u.seedNumber):void 0,g=h?null==M?void 0:M[r]:void 0,I=p?(null==(d=null==N?void 0:N[r])?void 0:d.seedValue)||(null==(c=null==N?void 0:N[r])?void 0:c.seedNumber):void 0,U=I?null==N?void 0:N[r]:void 0;m&&h&&(m[xl]=g),m&&I&&(m[Ll]=U);let y=h||I;y&&(f[e].participant.seedings[R]||(f[e].participant.seedings[R]=[]),g&&f[e].participant.seedings[R].push({...g,scaleName:o}),U&&f[e].participant.seedings[R].push({...U,scaleName:o}),m&&(f[e].events[j].seedAssignments||(f[e].events[j].seedAssignments={}),Object.keys(m).forEach((t=>f[e].events[j].seedAssignments[t]=m[t])))),(D||v)&&(f[e].draws[o]=ya({seedAssignments:m,entryPosition:n,entryStatus:t,entryStage:i,seedValue:y,eventId:j,ranking:s,drawId:o},!1,!1,!0))};[hc,vc].includes(t)||(l(r),null==(a=f[r].participant.individualParticipantIds||[])||a.forEach(l))}let C=((null==d?void 0:d.structures)??[]).reduce(((e,t)=>(e.includes(t.stage)||e.push(t.stage),e)),[]),O=((null==d?void 0:d.links)??[]).length;k[o]={qualifyingPositionAssignments:i,qualifyingSeedAssignments:s,mainPositionAssignments:l,qualifyingSeedingMap:N,mainSeedAssignments:u,orderedStructureIds:w,mainSeedingMap:M,flightNumber:y,linksCount:O,drawOrder:g,drawName:I,drawType:U,drawSize:P,drawId:o,stages:C}}}if(v||I||U||y||S||w||D){let e=!!I||h,t=(null==(o=Nf({afterRecoveryTimes:!!I,policyDefinitions:d,tournamentRecord:c,inContext:!0,contextProfile:m,participantMap:f,nextMatchUps:e,event:x}))?void 0:o.matchUps)??[];for(let i of t){let{finishingPositionRange:t,potentialParticipants:n,tieMatchUps:r=[],sides:a=[],winningSide:o,matchUpType:l,matchUpId:u,eventId:d,drawId:p,collectionId:m,stageSequence:h,finishingRound:v,matchUpStatus:U,roundPosition:y,roundNumber:S,structureId:w,schedule:T,score:P,stage:D}=i;A[u]=i;let b={finishingPositionRange:t,finishingRound:v,stageSequence:h,roundPosition:y,collectionId:m,roundNumber:S,structureId:w,schedule:T,eventId:d,drawId:p,score:P,stage:D};mh({...b,...N,matchUpStatus:U,winningSide:o,matchUpType:l,matchUpId:u,sides:a});for(let e of r){let{winningSide:t,sides:i=[],matchUpId:n,matchUpStatus:r,matchUpType:s}=e;mh({...b,...N,winningSide:t,tieWinningSide:o,matchUpTieId:u,matchUpId:n,sides:i,matchUpSides:a,matchUpStatus:r,matchUpType:s})}Array.isArray(n)&&(e||I||g)&&(null==(s=n.flat().map(sl).filter(Boolean))||s.forEach((e=>{var t;null==(t=M(e))||t.forEach((e=>{f[e]&&(f[e].potentialMatchUps[u]=ya({tournamentId:null==c?void 0:c.tournamentId,matchUpId:u,eventId:d,drawId:p}))})),(I||g)&&nh({potential:!0,participantMap:f,participantId:e,matchUpStatus:U,roundPosition:y,structureId:w,matchUpType:l,roundNumber:S,matchUpId:u,schedule:T,drawId:p,score:P})})))}E.push(...t)}}if(y||v||I){let e=Object.values(f);for(let t of e){let{wins:e,losses:i,[Ad]:{wins:n,losses:r},[Cd]:{wins:a,losses:o}}=t.counters,s=(e,i,n)=>{let r=i+n,a=i,o=r&&a/r;t.statistics[e]={denominator:r,numerator:a,statValue:o,statCode:e}};if(y&&(s(kc,e,i),s(`${kc}.${Ad}`,n,r),s(`${kc}.${Cd}`,a,o)),v){let e=(e=[])=>Math.abs(e[0]-e[1]);for(let i of Object.keys(t.draws)){let{orderedStructureIds:n=[],flightNumber:r}=k[i]||{};if(t.structureParticipation&&n.length){let a,o=0,s=n.map((i=>{let n=t.structureParticipation[i];if(!n)return;a||(a=null==n?void 0:n.finishingPositionRange),e(a)>e(null==n?void 0:n.finishingPositionRange)&&(a=null==n?void 0:n.finishingPositionRange);let s=n.stage!==Ll;return s&&(o+=1),ya({...n,participationOrder:s?o:void 0,flightNumber:r})})).filter(Boolean);t.draws[i]&&(t.draws[i].finishingPositionRange=a,t.draws[i].structureParticipation=s)}}}if(I){let e=Ce(I)?I.scheduledMinutesDifference:0,i=t.scheduleItems||[],n=t.potentialMatchUps||{},r=i.reduce(((e,t)=>{let{scheduledDate:i,scheduledTime:n}=t;return e[i]||(e[i]=[]),n&&e[i].push(t),e}),{});Object.values(r).forEach((e=>e.sort(xo)));for(let o of i){let{typeChangeTimeAfterRecovery:i,timeAfterRecovery:a,scheduledDate:s,scheduledTime:l}=o,u=r[s],d=Ro(l);for(let r of u){if(r.matchUpId===o.matchUpId||[bl,gl].includes(r.matchUpStatus)&&!r.checkScoreHasValue)continue;let s=o.matchUpType!==r.matchUpType&&i||a,l=o.drawId===r.drawId,u=n[o.matchUpId]&&n[r.matchUpId],c=Ro(r.scheduledTime),p=Math.abs(c-d),m=c>=d;if((e&&!isNaN(e)?p<=e:m&&Ro(r.scheduledTime)<Ro(s))&&(!u||!l)&&m){let e=[o.matchUpId,r.matchUpId].sort(sh).join("|");t.scheduleConflicts[e]={priorScheduledMatchUpId:o.matchUpId,matchUpIdWithConflict:r.matchUpId}}}}let a=t.participant.participantId;Object.keys(t.scheduleConflicts).length&&R.push(a),f[a].scheduleConflicts=t.scheduleConflicts}}}return{participantIdsWithConflicts:R,eventsPublishStatuses:C,derivedEventInfo:O,derivedDrawInfo:k,mappedMatchUps:A,participantMap:f,matchUps:E}}({withMatchUps:I??a,withEvents:S??a,withDraws:w??a,withPotentialMatchUps:r,participantFilters:n,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:u,scheduleAnalysis:d,withTeamMatchUps:p,usePublishState:f,withStatistics:v,participantMap:D,withOpponents:g,contextProfile:h,withSeeding:y}),{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:R,derivedDrawInfo:A,mappedMatchUps:E}=b,C=b.matchUps;D=b.participantMap;let O=d??r,k=({potentialMatchUps:e,scheduleConflicts:t,scheduleItems:i,participant:n,statistics:r,opponents:o,matchUps:s,events:u,draws:c})=>{let p=Object.values(c),m=Object.values(o);return g&&(null==p||p.forEach((e=>{e.opponents=m.filter((t=>t.drawId===e.drawId))}))),ya({...n,scheduleConflicts:d?Object.values(t):void 0,draws:w||a?p:void 0,events:S||a?Object.values(u):void 0,matchUps:I||a?Object.values(s):void 0,opponents:g?m:void 0,potentialMatchUps:O?Object.values(e):void 0,statistics:v?Object.values(r):void 0,scheduleItems:l?i:void 0},!1,!1,!0)},F=new Map;for(let B of Object.keys(D))F.set(B,k(D[B]));let x=[...F.values()],L=null==(t=null==s?void 0:s[es])?void 0:t.participant,_=fh({participants:x,participantFilters:n,tournamentRecord:u});if(i){let e=Ce(i)?i:void 0;for(let t of _)for(let i of t.individualParticipantIds??[]){t.individualParticipants||(t.individualParticipants=[]);let n=F.get(i);t.individualParticipants.push(e?po({template:e,source:n}):n)}}return{participantIdsWithConflicts:M,eventsPublishStatuses:N,derivedEventInfo:R,derivedDrawInfo:A,mappedMatchUps:E,participantMap:D,participants:L?_.map((e=>po({source:e,template:L}))):_,...Be,matchUps:C}}function gh({participantId:e,drawDefinition:t,entryStatus:i,entryStage:n}){var r;if(!t)return{error:Ke};let a=null==(r=t.entries)?void 0:r.find((t=>!(t.participantId!==e||i&&i!==t.entryStatus||n&&n!==t.entryStage)));return e&&a}function Ih(e){var t,i,n,r,a,o,s,l,u;let{provisionalPositioning:d,drawDefinition:c,stageSequence:p,structureId:m,stage:f}=e;if(!c)return{error:Ke};let{entryProfile:h}=ac({drawDefinition:c}),v=f&&p&&(null==(n=null==(i=null==(t=null==h?void 0:h[f])?void 0:t.stageSequence)?void 0:i[p])?void 0:n.qualifiersCount)||f&&(null==(r=null==h?void 0:h[f])?void 0:r.qualifiersCount)||0,g={};if(!m)return{qualifiersCount:v,roundQualifiersCounts:g};let{structure:I}=_u({drawDefinition:c,structureId:m}),U=null==(a=c.links)?void 0:a.filter((e=>{var t;return(null==(t=null==e?void 0:e.target)?void 0:t.structureId)===(null==I?void 0:I.structureId)})),y=0;if(null!=U&&U.length)for(let w of U){let e=null==(o=_u({structureId:w.source.structureId,drawDefinition:c}))?void 0:o.structure;if((null==e?void 0:e.stage)===Ll){let t=w.source.roundNumber,i=w.target.roundNumber,n=0;if(e.structureType===Jl){n=((null==(s=e.structures)?void 0:s.length)??0)*((null==(l=w.source.finishingPositions)?void 0:l.length)??0)}else n=(null==(u=Zm({matchUpFilters:{roundNumbers:[t]},structure:e,afterRecoveryTimes:!1,provisionalPositioning:d,inContext:!1}).matchUps)?void 0:u.length)||0;g[i]||(g[i]=0),g[i]+=n,y+=n}}let S=Object.keys(g);if(S.length<=1){let e=S[0]||1;g[e]=Math.max(g[e]||0,v)}return y=Math.max(y,v),{qualifiersCount:y,roundQualifiersCounts:g}}function Uh({stage:e,drawDefinition:t}){var i;let{entryProfile:n}=ac({drawDefinition:t});return(null==(i=null==n?void 0:n[e])?void 0:i.drawSize)||0}function yh({stage:e,drawDefinition:t}){return!!(e===Bl||Dc({stage:e,drawDefinition:t})&&Uh({stage:e,drawDefinition:t}))}function Sh({entryStatus:e=lc,drawDefinition:t,stageSequence:i,stage:n}){if(e===oc)return function({stage:e,drawDefinition:t}){var i;let{entryProfile:n}=ac({drawDefinition:t});return(null==(i=n[e])?void 0:i.alternates)||0}({stage:n,drawDefinition:t})?{positionsAvailable:1/0,...Be}:{error:Xi};let r=function(e){let{provisionalPositioning:t,drawDefinition:i,stageSequence:n,stage:r}=e,a=Uh({stage:r,drawDefinition:i}),{qualifiersCount:o}=Ih({provisionalPositioning:t,drawDefinition:i,stageSequence:n,stage:r});return a&&a-o}({drawDefinition:t,stageSequence:i,stage:n}),a=function({stage:e,drawDefinition:t}){var i;let{entryProfile:n}=ac({drawDefinition:t});return(null==(i=n[e])?void 0:i.wildcardsCount)||0}({drawDefinition:t,stage:n}),o=bc({entryStatus:gc,drawDefinition:t,stage:n}),s=o+bc({entryStatus:lc,drawDefinition:t,stage:n}),l=r-s;return n!==Bl&&s>=r?{error:tn}:e===gc?o<a?{...Be}:{error:tn}:{positionsAvailable:l,...Be}}function wh(e){let{entryStatus:t=lc,entryStageSequence:i,entryStage:n=xl,ignoreStageSpace:r,drawDefinition:a,entryPosition:o,participant:s,roundTarget:l,extensions:u,extension:d,drawType:c}=e,p="addDrawEntry";if(!a)return{error:Ke};if(!n)return{error:Lt};if(c!==au&&!yh({stage:n,drawDefinition:a}))return Sa({result:{error:_t},stack:p});let m=Sh({stageSequence:i,stage:n,drawDefinition:a,entryStatus:t});if(!(r||m.success||c&&c===au))return{error:m.error};if(d&&!ms({extension:d}))return Sa({result:{error:Fn},info:"Invalid extension",context:{extension:d},stack:p});let f=e.participantId||(null==s?void 0:s.participantId);if(!f)return Sa({result:{error:_i},stack:p});let h=t===cc&&gh({participantId:f,drawDefinition:a,entryStatus:t}),v=n===Bl&&gh({participantId:f,drawDefinition:a,entryStage:n}),g=t!==cc&&n!==Bl&&gh({drawDefinition:a,participantId:f});if(g||h||v)return Sa({context:{invalidEntry:g,invalidLuckyLoser:h,invalidVoluntaryConsolation:v},result:{error:zi},stack:p});let I=ya({entryStageSequence:i,participantId:f,entryPosition:o,entryStatus:t,entryStage:n,extensions:u});return d&&fs({element:I,extension:d}),l&&fs({extension:{name:"roundEntry",value:l},element:I}),a.entries||(a.entries=[]),a.entries.push(I),wd({drawDefinition:a}),{...Be}}function Th({autoEntryPositions:e=!0,entryStageSequence:t,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,entryStage:s,extension:l,drawId:u,event:d}){if(null==r||!r.length)return{error:Gi};if(!d)return{error:Ct};if(!u)return{error:mt};let c=(d.entries||[]).map(sl);if(r.filter((e=>!c.includes(e))).length)return{error:kt};if(n){let u=function(e){let{entryStatus:t=lc,stage:i=xl,autoEntryPositions:n=!0,ignoreStageSpace:r,drawDefinition:a,participantIds:o,stageSequence:s,roundTarget:l,extension:u}=e;if(!i)return{error:Lt};if(!a)return{error:Ke};if(!Array.isArray(o))return{error:Ci};if(!yh({stage:i,drawDefinition:a}))return{error:_t};if(u&&!ms({extension:u}))return Sa({result:{error:Fn},info:"Invalid extension",context:{extension:u},stack:"addDrawEntries"});let d=Sh({drawDefinition:a,stageSequence:s,entryStatus:t,stage:i});if(!r&&!d.success)return{error:d.error};let c=d.positionsAvailable??0;if(!r&&i!==Bl&&c<o.length)return{error:Yi};let p=o.reduce(((e,n)=>{let r=t===cc&&gh({participantId:n,drawDefinition:a,entryStatus:t}),o=i===Bl&&gh({entryStage:i,drawDefinition:a,participantId:n});return t!==cc&&i!==Bl&&gh({drawDefinition:a,participantId:n})||r||o?e.concat(n):e}),[]);return o.filter((e=>e&&!p.includes(e))).forEach((e=>{let n={entryStageSequence:s,entryStage:i,participantId:e,entryStatus:t};u&&fs({element:n,extension:u}),l&&fs({extension:{name:Gs,value:l},element:n}),a.entries||(a.entries=[]),a.entries.push(n)})),n&&(a.entries=eh({entries:a.entries})),wd({drawDefinition:a}),null!=p&&p.length?{info:"some participantIds could not be added",participantIdsNotAdded:p,...Be}:{...Be}}({stageSequence:t,autoEntryPositions:e,stage:s,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,extension:l});if(u.error)return u}let{flightProfile:p}=fm({event:d}),m=null==p?void 0:p.flights.find((e=>e.drawId===u));return null!=m&&m.drawEntries&&(r.forEach((e=>{let t=a===cc&&Ph({participantId:e,entryStatus:a,flight:m}),i=s===Bl&&Ph({participantId:e,entryStage:s,flight:m});(a===cc||s===Bl||!Ph({flight:m,participantId:e}))&&!t&&!i&&m.drawEntries.push({participantId:e,entryStatus:a,entryStage:s})})),e&&(m.drawEntries=eh({entries:m.drawEntries}))),{...Be}}function Ph({participantId:e,entryStatus:t,entryStage:i,flight:n}){var r;let a=null==(r=n.drawEntries)?void 0:r.find((n=>!(n.participantId!==e||t&&t!==n.entryStatus||i&&i!==n.entryStage)));return e&&a}function Dh({autoEntryPositions:e=!0,participantIds:t=[],entryStatuses:i,stage:n,event:r}){var a,o,s,l;let u="removeEventEntries";if(null==r||!r.eventId)return{error:Et};if(!Array.isArray(t)||t.some((e=>!Ee(e))))return Sa({result:{error:Ei},stack:u});let d=(r.drawDefinitions??[]).flatMap((e=>Xf({drawDefinition:e}).assignedParticipantIds??[])),c=((null==i?void 0:i.length)&&(null==(a=r.entries)?void 0:a.filter((e=>e.entryStatus&&i.includes(e.entryStatus))))||[]).map(sl).filter((e=>!d.includes(e))),p=(n&&(null==(o=r.entries)?void 0:o.filter((e=>e.entryStage&&e.entryStage===n)))||[]).map(sl).filter((e=>!d.includes(e)));if(t.length?t=t.filter((e=>(!(null!=i&&i.length)||c.includes(e))&&(!n||p.includes(e)))):c.length&&p.length?t=Nr(c,p):c.length?t=c:p.length&&(t=p),(null==t?void 0:t.length)&&d.some((e=>t.includes(e))))return Sa({result:{error:Hi},stack:u});if(null==t||!t.length)return{...Be,participantIdsRemoved:[]};let m=[];r.entries=(r.entries??[]).filter((e=>{let i=!t.includes(null==e?void 0:e.participantId);return i||m.push(e.participantId),i})),e&&(r.entries=eh({entries:r.entries}));let{flightProfile:f}=fm({event:r});return null==(s=null==f?void 0:f.flights)||s.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!t.includes(e.participantId)))})),null==(l=r.drawDefinitions)||l.forEach((e=>{e.entries=(e.entries??[]).filter((e=>!t.includes(e.participantId)))})),{...Be,participantIdsRemoved:m}}var bh={[Qo]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Mh=bh;function Nh(e){var t,i;let{entryStatus:n=lc,autoEntryPositions:r=!0,enforceGender:a=!0,participantIds:o=[],entryStageSequence:s,policyDefinitions:l,entryStage:u=xl,tournamentRecord:d,ignoreStageSpace:c,drawDefinition:p,roundTarget:m,extensions:f,extension:h,drawId:v,event:g}=e,I="addEventEntries";if(!g)return{error:Et};if(null==o||!o.length)return Sa({result:{error:Gi},stack:I});if(null==g||!g.eventId)return{error:Ct};let U=jc({tournamentRecord:d,event:g}).appliedPolicies??{},y=(null==l?void 0:l[Qo])??(null==U?void 0:U[Qo])??Mh[Qo],S=!1!==(a??(null==(t=null==y?void 0:y.participants)?void 0:t.enforceGender)),w=[],T=[];if(f&&(!Array.isArray(f)||!f.every((e=>ms({extension:e}))))||h&&!ms({extension:h}))return Sa({context:ya({extension:h,extensions:f}),result:{error:Fn},info:"Invalid extension(s)",stack:I});let P,D=!!d,b=[],M=(null==(i=null==d?void 0:d.participants)?void 0:i.filter((e=>{var t,i,r;if(!o.includes(e.participantId))return!1;let a=wp(Ad)(g.eventType)&&e.participantType===Qd&&!th(n),s=g.eventType===Cd&&e.participantType===Xd;return!!(a&&(!g.gender||!S||[Ym,Hm].includes(g.gender)||g.gender===(null==(t=e.person)?void 0:t.sex))||s&&!th(n)||g.eventType===Cd&&e.participantType===Qd&&th(n))||(a&&g.gender&&S&&![Ym,Hm].includes(g.gender)&&g.gender!==(null==(i=e.person)?void 0:i.sex)?(b.push({participantId:e.participantId,sex:null==(r=e.person)?void 0:r.sex}),!1):g.eventType===ec&&(e.participantType===ec||th(n)&&e.participantType===Qd))})).map((e=>e.participantId)))??[],N=o.filter((e=>!D||M.includes(e)));g.entries||(g.entries=[]);let R=g.entries.map((e=>{var t;return e.participantId||(null==(t=e.participant)?void 0:t.participantId)}));if(N.forEach((e=>{var t;if(!R.includes(e)){let i=ya({participantId:e,entryStatus:n,entryStage:u,extensions:f});h&&fs({element:i,extension:h}),m&&fs({extension:{name:Gs,value:m},element:i}),s&&(i.entryStageSequence=s),w.push(i.participantId),null==(t=g.entries)||t.push(i)}})),v&&!th(u)){let e=Th({participantIds:N,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:c,drawDefinition:p,entryStatus:n,roundTarget:m,entryStage:u,extension:h,drawId:v,event:g});e.error&&(P=e.error)}if(g.eventType&&[Gp,qp].includes(g.eventType)){let e=(g.entries||[]).map((e=>e.participantId)),t=(g.entries||[]).filter((e=>th(e.entryStatus))).map((e=>e.participantId)),i=((null==d?void 0:d.participants)??[]).filter((t=>e.includes(t.participantId)&&t.participantType&&[Xd,ec].includes(t.participantType))).map((e=>e.individualParticipantIds)).flat(1/0),n=t.filter((e=>i.includes(e)));n.length&&(T.push(...n),Dh({participantIds:n,autoEntryPositions:!1,event:g}))}if(N.length!==o.length)return Sa({context:{mismatchedGender:b,gender:g.gender},result:{error:Ci},stack:I});r&&(g.entries=eh({entries:g.entries||[]}));let A=w.length-T.length;return Sa({result:{...Be,addedEntriesCount:A},stack:I,info:P})}var Rh="ADMINISTRATION",Ah="COMPETITOR",Eh="MEDIA",Ch="MEDICAL",Oh="OFFICIAL",kh="OTHER",Fh="SECURITY",xh={ADMINISTRATION:Rh,CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR:Ah,MEDIA:Eh,MEDICAL:Ch,OFFICIAL:Oh,OTHER:kh,SECURITY:Fh};function Lh({addIndividualParticipantsToEvents:e,individualParticipantIds:t,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return Sa({result:{error:We},stack:a});if(!i||!t)return Sa({result:{error:mi},stack:a});let o=(n.participants??[]).find((e=>e.participantId===i));if(!o)return Sa({result:{error:Bi},stack:a});if(![ec,Zd].includes(o.participantType))return Sa({result:{participantType:o.participantType,error:ki},stack:a});let s=_h({individualParticipantIds:t,groupingParticipant:o,tournamentRecord:n,suppressErrors:r}),{removed:l,error:u}=s;if(u)return Sa({result:s,stack:a});if(e)for(let d of n.events??[]){let e=(d.entries??[]).map((({participantId:e})=>e)).filter(Boolean);if(e.includes(i)){Nh({participantIds:null==l?void 0:l.filter((t=>!e.includes(t))),entryStatus:hc,tournamentRecord:n,event:d})}}return l&&ia({topic:nd,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...Be,...s}}function _h({individualParticipantIds:e=[],groupingParticipant:t,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var o,s;let l=[];if(!t)return{removed:l};let u=[],d=[];a||({participants:a,mappedMatchUps:r}=vh({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=null==(s=null==(o=null==a?void 0:a.find((({participantId:e})=>e===t.participantId)))?void 0:o.events)?void 0:s.map((({eventId:e})=>e)),p=(t.individualParticipantIds??[]).filter((n=>{var o;let s=null==e?void 0:e.includes(n),p=s&&(null==(o=null==a?void 0:a.find((e=>e.participantId===n)))?void 0:o.matchUps.filter((({eventId:e})=>c.includes(e))).map((({matchUpId:e})=>null==r?void 0:r[e])).filter((({winningSide:e,score:t})=>e||kf({score:t})))),m=s&&!(null!=p&&p.length);if(s&&!m&&d.push(n),m){l.push(n);for(let e of i.events??[])for(let r of e.drawDefinitions??[]){let{extension:e}=Ds({element:r,name:Ls}),a=null==e?void 0:e.value[t.participantId];e&&a&&(e.value[t.participantId]=a.filter((e=>e.participantId!==n)),fs({element:r,extension:e}),Sd({drawDefinition:r}));let o=Cf({drawDefinition:r,inContext:!1}).matchUps??[];for(let t of o){let e=t.sides??[];for(let a of e){let e=a.lineUp??[];e.find((e=>e.participantId===n))&&(a.lineUp=e.filter((e=>e.participantId!==n)),yd({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:r,matchUp:t}))}}}}else u.push(n);return!m}));t.individualParticipantIds=p;let m={groupingParticipantId:t.participantId,cannotRemove:d,notRemoved:u,removed:l};return d.length&&!n&&{...m,cannotRemove:d,error:Ni}||m}function Bh({participantRole:e=Ah,individualParticipantIds:t=[],groupingTypes:i=[Jd,Zd],tournamentRecord:n}){if(!n)return{error:We};let r=n.participants??[],{participants:a,mappedMatchUps:o}=vh({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter((t=>(t.participantRole===e||!t.participantRole)&&t.participantType&&i.includes(t.participantType))).forEach((e=>{let{removed:i}=_h({groupingParticipant:e,individualParticipantIds:t,tournamentRecord:n,mappedMatchUps:o,participants:a});i&&s++})),s?Be:{error:Vi}}function jh(e){var t,i,n;if(null==e||!e.tournamentRecord)return{error:We};if(null==(t=null==e?void 0:e.participantIds)||!t.length)return{error:Gi};let{addIndividualParticipantsToEvents:r,tournamentRecord:a,participantIds:o}=e,s=(null==(i=a.participants)?void 0:i.length)||0;if(!s)return{...Be};let l=null==(n=a.events||[])?void 0:n.filter((({eventType:e})=>e===$p)).map((e=>{var t;return null==(t=null==e?void 0:e.drawDefinitions)?void 0:t.map((({drawId:e})=>e))})).flat(1/0),u=vh({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],d=(null==l?void 0:l.length)&&Nr((Rf({matchUpFilters:{drawIds:l,matchUpTypes:[Cd]},tournamentRecord:a}).matchUps??[]).map((({sides:e})=>null==e?void 0:e.map((({participantId:e})=>e)))).flat().filter(Boolean),o),c=u.filter((e=>{var t;return null==(t=e.draws)?void 0:t.filter((e=>(!(null!=l&&l.length)||!(null!=l&&l.includes(e.drawId)))&&e.positionAssignments)).length}));if(null!=d&&d.length||c.length)return{error:Hi};let p={},m={};for(let h of a.events||[]){let e=Dh({participantIds:o,event:h});if(e.error)return e;p[h.eventId]=e.participantIdsRemoved}a.participants=a.participants.filter((e=>{let t=o.includes(e.participantId)||e.participantType===Xd&&e.individualParticipantIds.some((e=>o.includes(e)));if(!t&&e.participantType===$p&&e.individualParticipantIds.some((e=>o.includes(e)))&&(e.individualParticipantIds=e.individualParticipantIds.filter((e=>!o.includes(e)))),t&&r&&[Xd,ec].includes(e.participantType))for(let i of e.individualParticipantIds||[])o.includes(i)||(m[e.participantId]||(m[e.participantId]=[]),m[e.participantId].push(i));return!t}));let f=s-a.participants.length;if(Bh({individualParticipantIds:o,tournamentRecord:a}),r)for(let h of a.events||[]){Nh({participantIds:p[h.eventId].map((e=>m[e]||[])).flat(),entryStatus:hc,tournamentRecord:a,event:h})}return f&&ia({payload:{participantIds:o,tournamentId:a.tournamentId},topic:Ku}),f?{...Be,participantsRemovedCount:f}:{error:Ni}}function Vh({selected:e=!0,drawDefinition:t,entryStatuses:i,drawId:n,event:r,stage:a}){var o;let s=r.entries??[];if(n){let{flightProfile:e}=fm({event:r}),i=null==(o=null==e?void 0:e.flights)?void 0:o.find((e=>e.drawId===n));i?s=i.drawEntries:t.entries&&(s=null==t?void 0:t.entries)}let l=s.filter((t=>(!(null!=i&&i.length)||!t.entryStatus||i.includes(t.entryStatus))&&(!a||!t.entryStage||t.entryStage===a)&&(!e||t.entryStatus&&wc.includes(t.entryStatus))));return{entries:s,stageEntries:l}}function Gh({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:n,drawId:r,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!t)return{error:We};if(!n)return Sa({result:{error:_i},stack:l});if(!o)return{error:Et};if(!o.eventType||![Gp,qp].includes(o.eventType))return Sa({result:{error:At},stack:l});let u=t.participants??[],d=u.find((e=>e.participantId===n));if(!d)return Sa({result:{error:Bi},stack:l});if(!d.participantType||![Xd,Jd].includes(d.participantType)||d.participantType===Jd&&o.eventType!==qp||d.participantType===Xd&&o.eventType!==Gp)return{error:ki};let c=(o.entries??[]).find((e=>e.participantId===n));if(!c)return{error:Ji};let p,{stageEntries:m}=Vh({selected:!1,drawDefinition:i,drawId:r,event:o,stage:a}),f=m.map(sl),h=u.filter((({participantId:e})=>f.includes(e))).map((({individualParticipantIds:e})=>e)).flat().filter(Boolean),v=null==(s=d.individualParticipantIds)?void 0:s.filter((e=>1===Mr(e,h).length)),g=Dh({participantIds:[n],event:o});return g.error||null!=v&&v.length&&(g=Nh({participantIds:v,entryStatus:hc,entryStage:c.entryStage,tournamentRecord:t,drawDefinition:i,drawId:r,event:o}),g.error)?g:(e&&jh({participantIds:[n],tournamentRecord:t}).success&&(p=!0),{...Be,participantRemoved:p})}function $h({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:n,drawId:r,event:a}){return Gh({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:i,participantId:n,drawId:r,event:a})}function qh(e){if(!e.tournamentRecord)return{error:We};let{participantIds:t,...i}=e,n=0,r=[];for(let a of t){let e=Gh({participantId:a,...i});e.success&&(n+=1),e.error&&r.push(e.error)}return n?{destroyedCount:n,...Be}:{error:r}}function Wh(e){let{tournamentRecord:t,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=e,l="removeDrawPositionAssignment",u=Jf(e);if(u.error)return Sa({result:u,stack:l});let{participantId:d}=u,{drawPosition:c,event:p,structureId:m}=e;if([oc,Ic].includes(a)&&d){let{tournamentRecord:t}=e,{participant:i}=hf({tournamentRecord:t,participantId:d}),{participantType:o,individualParticipantIds:u}=i??{};if(r&&o===Xd){let e=$h({tournamentRecord:t,drawDefinition:n,participantId:d,event:p});if(e.error)return Sa({result:e,stack:l});u&&ih({participantIds:u,tournamentRecord:t,drawDefinition:n,entryStatus:a,drawId:s,event:p})}else ih({participantIds:[d],tournamentRecord:t,drawDefinition:n,entryStatus:a,drawId:s,event:p})}if(i){let e=qf({tournamentRecord:t,drawDefinition:n,drawPosition:c,structureId:m,matchUpsMap:o,event:p});if(e.error)return Sa({result:e,stack:l})}let{structure:f}=_u({drawDefinition:n,structureId:m});return bd({structure:f,drawPositions:[c]}),Md({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:c,entryStatus:a,structureId:m}}),u}function Hh(e){return Object.assign(e,{entryStatus:Ic}),Wh(e)}function zh(e){return Ee(e)?e.split(" ").map((e=>e.split("").map(((e,t)=>t?e.toLowerCase():e.toUpperCase())).join(""))).join(" "):e}function Yh(e){return Ee(e)?zh(e.replace(/_/g," ")):""}var Kh=({finishingPosition:e=Cu,qualifyingRoundNumber:t,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:u,matchUpType:d,matchUps:c=[],structureId:p,roundOffset:m,roundLimit:f,stageOrder:h,structures:v,stage:g})=>{let I={structureId:p??am(),structureAbbreviation:i,finishingPosition:e,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:u};a&&(I.structureOrder=a),l&&(I.structureType=l),o&&("string"==typeof o?I.seedingProfile=o:"object"==typeof o&&"string"==typeof o.positioning&&(I.seedingProfile=o.positioning)),d&&(I.matchUpType=d),m&&(I.roundOffset=m),h&&(I.stageOrder=h),f&&(I.roundLimit=f),g&&(I.stage=g),t&&(I.qualifyingRoundNumber=t);let U=c.flatMap((({drawPositions:e})=>e)).filter(Boolean);return v?I.structures=v:(I.matchUps=c,I.positionAssignments=hr(U).sort(((e,t)=>e-t)).map((e=>({drawPosition:e})))),I},Jh=Kh;function Qh({structureName:e=Yh(Bl),structureAbbreviation:t,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:Ke};let a=Jh({stage:Bl,structureAbbreviation:t,structureName:e,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),wd({drawDefinition:i,structureIds:[a.structureId]}),{...Be}}function Zh({drawPositions:e}){if(null==e||!e.length)return{error:at};let t=[].concat(...(e??[]).map((t=>e.filter((e=>e!==t)).map((e=>[t,e]))))),i=hr(t.map(Xh)).map((e=>e.split("|").map((e=>+e))));return{groupMatchUps:t,uniqueMatchUpGroupings:i}}function Xh(e=[]){return Array.isArray(e)&&e.length?[...e].sort(nr).join("|"):""}function ev({groupSize:e,drawPositionOffset:t}){if(!e)return[];let i=e=>[...Array(e)].map(((e,t)=>t)),n=i(2*Math.round(e/2)+1).slice(1),r=i(n.length-1).map((()=>[])),a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach(((e,t)=>{a.forEach(((e,i)=>{r[t].push([a[i],o[i]])}));let i=a.shift(),n=a.pop(),s=o.shift();a=[i,s,...a].filter(Boolean),o=[...o,n].filter(Boolean)}));let s=a.shift(),l=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,l].filter(Boolean);let d=e=>e[0].reduce(((e,t)=>e+t));return[...r].reverse().sort(((e,t)=>d(e)-d(t))).map((i=>i.filter((t=>t.every((t=>t<=e)))).map((e=>Xh(e.map((e=>e+t)))))))}var tv={getRoundRobinGroupMatchUps:Zh,determineRoundNumber:function({rounds:e,hash:t}){return null!=e&&e.length?null==e?void 0:e.reduce(((e,i,n)=>i.includes(t)?n+1:e),void 0):{error:mi}},drawPositionsHash:Xh,groupRounds:ev};function iv(e){var t;let i,{groupNameBase:n="Group",playoffAttributes:r,stageSequence:a=1,structureOptions:o,appliedPolicies:s,seedingProfile:l,stage:u=xl,matchUpType:d,roundTarget:c,structureId:p,groupNames:m,drawSize:f,idPrefix:h,isMock:v,uuids:g}=e,I=e.structureName??(null==(t=null==r?void 0:r[0])?void 0:t.name)??Yh(xl),{groupCount:U,groupSize:y}=function({appliedPolicies:e,structureOptions:t,drawSize:i}){let n=null==t?void 0:t.groupSize,r=(null==t?void 0:t.groupSizeLimit)||8,{validGroupSizes:a}=nv({groupSizeLimit:r,drawSize:i}),o=a&&Math.max(...a);n&&null!=a&&a.includes(n)||(n=n&&n>4||null==a||!a.includes(4)?o:4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}({structureOptions:o,appliedPolicies:s,drawSize:f}),S=Eu,w=br(1,U+1).map((e=>{let t=function({structureOrder:e,matchUpType:t,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:o}){let s=(e-1)*i,l=br(1+s,i+1+s),u=Zh({drawPositions:l}).uniqueMatchUpGroupings??[],d=ev({groupSize:i,drawPositionOffset:s});return u.map(p).sort(((e,t)=>(e.roundNumber??1/0)-(t.roundNumber??1/0)));function c(e){return d.reduce(((t,i,n)=>i.includes(e)?n+1:t),void 0)}function p(i){let s=c(Xh(i)),l=[1,n],u=function({structureOrder:e,drawPositions:t,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${e}-${i}-DP-${t.join("-")}`:(null==r?void 0:r.pop())||am()}({structureOrder:e,drawPositions:i,roundNumber:s,idPrefix:r,uuids:o}),d={matchUpStatus:s?Dl:ml,matchUpType:t,finishingPositionRange:{winner:l,loser:l},drawPositions:i,roundNumber:s,matchUpId:u};return a&&(d.isMock=!0),d}}({groupSize:y,structureOrder:e,matchUpType:d,drawSize:f,idPrefix:h,isMock:v});i=Array.isArray(t)?Math.max(...t.map((({roundNumber:e})=>e??0))):0;let r=(null==m?void 0:m[e-1])??`${n} ${e}`;return Kh({structureId:null==g?void 0:g.pop(),structureType:Kl,finishingPosition:S,structureOrder:e,structureName:r,matchUps:t})})),T=Kh({structureId:p??(null==g?void 0:g.pop()),structureType:Jl,finishingPosition:S,seedingProfile:l,structureName:I,stageSequence:a,structures:w,stage:u});return c&&fs({extension:{name:Gs,value:c},element:T}),{structures:[T],maxRoundNumber:i,groupCount:U,links:[],groupSize:y,...Be}}function nv({drawSize:e,groupSizeLimit:t=10}){let i=br(3,t+1).filter((t=>{let i=Math.ceil(e/t),n=i*t-e,r=Math.ceil(e/i),a=Math.ceil(n/i);return(!n||n<t)&&r===t&&r>=3&&a<2}));return{...Be,validGroupSizes:i}}function rv(e){let{roundRobinGroupsCount:t,participantsCount:i,cluster:n}=e;if(!mr(i))return{seedBlocks:void 0,...Sa({result:{error:Fn},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=cr(i);if(t){let e=Math.min(t,r),i=[],n=1;for(br(0,e).forEach((()=>{i.push([n]),n++}));n<r;){let t=br(n,n+e);n+=e,i.push(t)}return{...Be,seedBlocks:i}}let a=br(1,r+1),o=[],s=r/2;for(;s>1;){let e=Or(a,s),t=e.length;e.forEach(((e,i)=>{let r,a=i<t/2,s=i%2==0,l=e[0],u=e[e.length-1];r=n&&t>4?8===t?a?u:l:s?l:u:a?l:u,Ar(e,o)||o.push(r)})),s/=2}let l=a.filter((e=>!o.includes(e)));for(;l.length;)l.length%2==0?o.push(l.pop()):o.push(l.shift());let u=br(0,20).map((e=>Math.pow(2,e)));u.unshift(1);let d=u.indexOf(r),c=0,p=[];return br(0,d).forEach((e=>{p.push(o.slice(c,c+u[e])),c+=u[e]})),{...Be,seedBlocks:p}}function av({roundRobinGroupsCount:e,drawSize:t}){let i="getSeedGroups";if(!mr(t))return{seedGroups:void 0,...Sa({result:{error:Fn},context:{drawSize:t},stack:i})};if(e){if(!mr(e))return{seedGroups:void 0,...Sa({context:{roundRobinGroupsCount:e},result:{error:Fn},stack:i})};let n=1;return{seedGroups:br(0,Math.floor(t/e)).map((()=>{let t=br(n,n+e);return n+=e,t}))}}{let{seedBlocks:i}=rv({participantsCount:t,roundRobinGroupsCount:e}),n=0;return{seedGroups:(i||[]).map((e=>(e||[]).map((()=>(n+=1,n)))))}}}function ov({roundRobinGroupsCount:e,participantsCount:t}){var i;if(e){let{validGroupSizes:n}=nv({drawSize:t});if(null==(i=null==n?void 0:n.map((e=>Math.ceil(t/e))))||!i.includes(e))return Sa({context:{roundRobinGroupsCount:e},result:{error:Fn}})}let{seedGroups:n}=av({drawSize:t,roundRobinGroupsCount:e}),r=(null==n?void 0:n.map((e=>Math.min(...e))))||[];return{...Be,seedingThresholds:r}}function sv(e){if(!e)return 1/0;if(mr(e))return rr(e);let t=e.split("-")[0];return mr(t)?rr(t):1/0}function lv({positioning:e,size:t}){let i=function({size:e}){let t=[e],i=e;for(;i/2===Math.floor(i/2);)i/=2,t.push(i);return t.includes(1)||t.push(1),t.sort(nr),t.reverse(),t}({size:t}),n=[],r=[],a=e=>e[0],o=(t,i)=>(e&&[zl,Yl].includes(e)&&i%2?(e=>e[e.length-1])(t):a(t))||a(t),s=(e,t)=>{if(e.every((e=>!r.includes(e)))){let i=o(e,t);return r.push(i),i}},l=e=>{let t=e.filter((e=>!r.includes(e)));if(t.length)return r.push(...t),t},u=(e,t)=>{let i=o(e,t);if(!r.includes(i))return r.push(i),i},d=br(1,t+1);for(let c of i)if(1===c){let e=Or(d,2),t=e.map(s).filter(Boolean);t.length&&n.push(t);let i=e.flatMap(l).filter(Boolean);i.length&&n.push(i)}else{let e=Or(d,c).map(u).filter(Boolean);e.length&&n.push(e)}return{divisions:i,divisionGroupings:n}}function uv({provisionalPositioning:e,returnAllProxies:t,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:Nt};let{matchUps:u,roundMatchUps:d}=Zm({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:e,structure:o}),{seedAssignments:c}=Nc({provisionalPositioning:e,returnAllProxies:t,drawDefinition:r,structure:o}),{positionAssignments:p}=Gu({structure:o}),m=null==p?void 0:p.length,f=(null==c?void 0:c.length)??0,h=[],v=Object.keys(d).map((e=>parseInt(e))).sort(((e,t)=>e-t)).map((e=>{let t=d[e].map((e=>e.drawPositions)).flat(1/0).filter(Boolean),i=t.filter((e=>!h.includes(e)));return h=h.concat(...t),i})).filter((e=>e.length)).reverse(),g=v.pop()??[],I=g&&Math.min(...g)-1||0;n=n??(null==(s=null==i?void 0:i.seeding)?void 0:s.seedingProfile);let U=(null==g?void 0:g.length)||0,y=v.filter((e=>e.filter((e=>e<=f)).length)),{stage:S,structureType:w,roundLimit:T}=o,P=w===Jl,D=!P&&(null==v?void 0:v.length),b=!P&&S===Ll&&T,M=y.flat(1/0),N=D?null==M?void 0:M.length:0,R=a?m:f,A=Mm({drawDefinition:r,structure:o,matchUps:u}),E=A?0:!D&&R||R&&M.length<R&&R-M.length||0;if(b){let e=null!=o&&o.matchUps?o.matchUps.filter((({roundNumber:e})=>e===o.roundLimit)).length:0,t=g.length/e;if(!D){let e=mv(n),i=Or(g,t),r=1,a=br(0,i[0].length).map((()=>{let e=br(r,r+i.length);return r+=i.length,e}));({validSeedBlocks:l}=dv({drawPositionBlocks:i,nonRandom:null==n?void 0:n.nonRandom,positioning:e,seedGroups:a}))}}else P?({validSeedBlocks:l}=function({seedingProfile:e,structure:t,nonRandom:i}){var n;let r=t.structures||[],a=r.length,o=null==(n=Vu({structure:t}))?void 0:n.positionAssignments,s=mv(e),l=(null==o?void 0:o.length)??0,{seedGroups:u}=av({roundRobinGroupsCount:a,drawSize:l}),d=r.map((e=>{var t;return null==(t=Vu({structure:e}).positionAssignments)?void 0:t.map((e=>e.drawPosition))}));return dv({drawPositionBlocks:d,positioning:s,seedGroups:u,nonRandom:i})}({nonRandom:null==n?void 0:n.nonRandom,seedingProfile:n,structure:o})):D?l=y.map((e=>({seedNumbers:e,drawPositions:e}))):A&&Or(g,2).map(((e,t)=>({drawPositions:[e[0]],seedNumbers:[t+1]}))).forEach((e=>l.push(e)));if(!P&&!A&&!b){let{blocks:e}=function(e){let{drawPositionOffset:t=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:o}=e,s=1,l=[],{seedBlocks:u}=rv({cluster:mv(r)===zl,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let c of u){if(s+1>a)break;let e=c.map((e=>e+t)),i=d(s+1,c.length).map((e=>+e+n));s+=c.length,l.push({drawPositions:e,seedNumbers:i})}return{blocks:l};function d(e,t){return Array.from(new Array(t),((t,i)=>i+e))}}({drawPositionOffset:I,seedNumberOffset:N,seedCountGoal:E,seedingProfile:n,baseDrawSize:U});e.forEach((e=>l.push(e)))}let C=l.flatMap((e=>e.drawPositions)).reduce(((e,t)=>(null==g?void 0:g.includes(t))&&e),!0);return A||D||P||C?{isLuckyStructure:A,validSeedBlocks:l,isContainer:P,isFeedIn:D}:{error:wt,validSeedBlocks:[],isContainer:P,isFeedIn:D}}function dv({drawPositionBlocks:e,positioning:t,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=lv({size:i.length,positioning:t}),o=[];return i.forEach(((i,s)=>{let l=function({blockPattern:e,index:t}){let i=0;for(let n of e){if(i===t)return n;let e=0;for(;e<n.length;){if(i===t)return n;i+=1,e++}}}({blockPattern:a,index:s});i.forEach(((i,a)=>{let u=s%2?e.length-a-1:a,d=e[u].slice().filter(((e,t)=>l.includes(t+1)&&e));t!==Yl?d=n?d:gr(d):s%2&&d.reverse();let c=d.find((e=>!o.includes(e)));c&&(o.push(c),r.push({drawPositions:[c],seedNumbers:[i]}))}))})),{validSeedBlocks:r}}function cv({appliedPolicies:e,drawDefinition:t,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var o,s,l,u,d,c;let{structure:p}=_u({drawDefinition:t,structureId:r});e||(e=jc({drawDefinition:t}).appliedPolicies);let m=null==i?void 0:i.validSeedBlocks;return!m&&p&&(m=null==(o=uv({appliedPolicies:e,drawDefinition:t,structure:p}))?void 0:o.validSeedBlocks),!(null==(l=null==(s=null==e?void 0:e.seeding)?void 0:s.validSeedPositions)||!l.ignore)||(null!=(d=null==(u=null==e?void 0:e.seeding)?void 0:u.validSeedPositions)&&d.strict?((null==(c=m.find((e=>e.seedNumbers.includes(a))))?void 0:c.drawPositions)||[]).includes(n):[].concat(...m.map((e=>e.drawPositions))).includes(n))}function pv(e){var t,i,n;let{provisionalPositioning:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:u}=e,{structure:d}=_u({drawDefinition:a,structureId:l}),{seedAssignments:c}=Nc({returnAllProxies:e.returnAllProxies,provisionalPositioning:r,drawDefinition:a,structure:d}),{positionAssignments:p}=Gu({structure:d}),m=null==(t=null==p?void 0:p.filter((e=>e.participantId??e.bye??e.qualifier)))?void 0:t.map((e=>e.drawPosition)).filter(Boolean),{appliedPolicies:f}=jc({drawDefinition:a}),h=((null==s?void 0:s.validSeedBlocks)||d&&(null==(i=uv({returnAllProxies:e.returnAllProxies,provisionalPositioning:r,appliedPolicies:f,drawDefinition:a,seedingProfile:o,structure:d}))?void 0:i.validSeedBlocks)||[]).filter((e=>e.drawPositions.filter((e=>!(null!=m&&m.includes(e)))).length))[0],v=null==c?void 0:c.map((e=>e.participantId)).filter(Boolean),g=null==p?void 0:p.map((e=>e.participantId)).filter(Boolean),I=null==v?void 0:v.filter((e=>null==g?void 0:g.includes(e))),U=null==v?void 0:v.filter((e=>!(null!=g&&g.includes(e)))),y=null==c?void 0:c.filter((e=>null==U?void 0:U.includes(e.participantId))),S=null==c?void 0:c.filter((e=>!e.participantId)),w=(null!=y&&y.length&&y.length>0?y.length:(null==S?void 0:S.length)??0)&&(null==h?void 0:h.drawPositions.filter((e=>!(null!=m&&m.includes(e)))))||[],T=u?gr(w):w,P=[],D=T.map((()=>{var e;let t=null==(e=function(e,t){let i=e.filter((e=>!t.includes(e.participantId))),n=Math.min(...i.map((e=>sv(e.seedValue))));return gr(i.filter((e=>sv(e.seedValue)===n))).pop()}(y,P))?void 0:e.participantId;return t&&P.push(t),t})).filter(Boolean),b=null==c?void 0:c.filter((e=>null==I?void 0:I.includes(e.participantId))).map((e=>e.seedNumber)),M=((null==h?void 0:h.seedNumbers)||[]).filter((e=>!(null!=b&&b.includes(e)))),N=null==c?void 0:c.filter((e=>M.includes(e.seedNumber))).map((e=>e.participantId)),R=null==(n=null==f?void 0:f.seeding)?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:h,unplacedSeedParticipantIds:void 0===R||R?D:N,unplacedSeedNumbers:M,unfilledPositions:T,unplacedSeedAssignments:y}}function mv(e){return"string"==typeof e?e:"object"==typeof e?e.positioning:void 0}function fv({provisionalPositioning:e,tournamentRecord:t,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:u,event:d}){var c,p,m;let f="assignSeed",{structure:h}=_u({drawDefinition:i,structureId:o}),{positionAssignments:v}=Gu({structure:h}),g=Nc({provisionalPositioning:e,drawDefinition:i,structure:h}).seedAssignments,I=g.map((e=>e.seedNumber)),U=gh({drawDefinition:i,participantId:r});if(r&&!U)return Sa({result:{error:Ei},context:{participantId:r},stack:f});let y,S=d?null==(p=null==(c=fm({event:d}).flightProfile)?void 0:c.flights)?void 0:p.length:0,w=S&&S>1,T=null==(m=null==v?void 0:v.find((e=>e.participantId===r)))?void 0:m.drawPosition;return T&&!cv({drawPosition:T,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s})?Sa({result:{error:et},context:{assignedDrawPosition:T},info:"invalid seed position",stack:f}):(I.includes(s)||g.push({seedNumber:s,seedValue:l}),g.forEach((e=>{e.participantId===r&&e.seedNumber!==s&&(e.participantId=void 0),e.seedNumber===s&&(e.participantId=r,!(null!=n&&n.groupSeedingThreshold)&&!w&&(e.seedValue=l??s),y=!0)})),y?(Td({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:i,structure:h,eventId:u}),{...Be}):Sa({result:{error:St},stack:f}))}function hv({inContextTargetMatchUp:e,drawPositionSideIndex:t,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:o}){var s,l,u,d;let c=null==(l=null==(s=null==e?void 0:e.sides)?void 0:s[t])?void 0:l.sideNumber,p=c&&(null==(u=a.sides)?void 0:u.find((e=>e.sideNumber===c))),{extension:m}=Ds({element:r,name:Ls}),f=Wo(((null==m?void 0:m.value)||{})[i],!1,!0);if(p)null==(d=null==a?void 0:a.sides)||d.forEach((e=>{e.sideNumber===c&&(e.lineUp=f)}));else{a.sides=[1,2].map((e=>{var t;return{...(null==(t=a.sides)?void 0:t.find((t=>t.sideNumber===e)))??{},sideNumber:e}}));let e=a.sides.find((e=>e.sideNumber===c));e&&(e.lineUp=f)}yd({tournamentId:null==n?void 0:n.tournamentId,context:"updateSidLineUp",eventId:null==o?void 0:o.eventId,drawDefinition:r,matchUp:a})}function vv(e){let{sourceMatchUp:t}=e,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=e,o=i.roundNumber>1&&i.roundNumber-1,s=Hd({structureId:n.structureId,matchUpsMap:r});!t&&a&&(t=s.find((({drawPositions:e,roundNumber:t})=>t===o&&(null==e?void 0:e.includes(a)))));let l=null==t?void 0:t.roundPosition,u=l+(l%2?1:-1),d=o&&s.find((({roundNumber:e,roundPosition:t})=>e===o&&t===u)),c=null==d?void 0:d.matchUpStatus;return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:[Ul,Il].includes(c)}}function gv({structureId:e,matchUpsMap:t,matchUp:i}){let n=null==i?void 0:i.roundPosition,r=n+(n%2?1:-1);return{pairedPreviousMatchUp:Hd({matchUpsMap:t,structureId:e}).find((({roundNumber:e,roundPosition:t})=>e===(null==i?void 0:i.roundNumber)&&t===r))}}function Iv({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=e.find((e=>e.matchUpId===i)),{pairedPreviousMatchUp:o}=gv({structureId:null==a?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&o){let i=null==o?void 0:o.matchUpId,n=e.find((e=>e.matchUpId===i)),s=(null==a?void 0:a.structureId)===(null==n?void 0:n.structureId)?(null==a?void 0:a.roundPosition)<(null==n?void 0:n.roundPosition)?1:2:a.structureId===(null==n?void 0:n.structureId)?2:1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map((e=>{let i=Ee(e)||!isNaN(e)?{code:e}:e;return i.sideNumber===s?{...i,previousMatchUpStatus:t}:i}))}}function Uv({inContextDrawMatchUps:e,drawPosition:t,matchUpId:i}){let n=e.filter((({winnerMatchUpId:e,loserMatchUpId:t})=>t===i||e===i)).sort(((e,t)=>e.roundPosition-t.roundPosition));return e.find((e=>e.matchUpId===i)).feedRound?1:n.reduce(((e,i,n)=>{var r;return null!=(r=i.drawPositions)&&r.includes(t)?n+1:e}),void 0)}function yv({inContextDrawMatchUps:e,sourceMatchUpStatus:t,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:u}){var d,c,p,m;let f="assignMatchUpDrawPosition";s||(s=Wd({drawDefinition:r})),e||(e=uf({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let h=e.find((e=>e.matchUpId===l)),v=null==h?void 0:h.structureId,g=null==(d=null==r?void 0:r.structures)?void 0:d.find((e=>e.structureId===v));if(!g)return{error:bt};let I=null==(c=null==s?void 0:s.drawMatchUps)?void 0:c.find((e=>e.matchUpId===l)),U=(null==I?void 0:I.drawPositions)??[],{positionAdded:y,positionAssigned:S,updatedDrawPositions:w}=function({drawPosition:e,drawPositions:t}){let i=!1,n=!(null==t||!t.includes(e));return{updatedDrawPositions:n?t||[]:[...t,void 0,void 0].slice(0,2).map((t=>t||n?t:(n=!0,i=!0,e))).sort(nr).filter(Boolean),positionAdded:i,positionAssigned:n}}({drawPosition:o,drawPositions:U}),{positionAssignments:T}=Vu({drawDefinition:r,structure:g}),P=null==(p=null==T?void 0:T.filter((e=>w.includes(e.drawPosition))))?void 0:p.find((({bye:e})=>e)),D=(null==I?void 0:I.matchUpStatus)&&[bl,gl].includes(I.matchUpStatus)&&w.filter(Boolean).length<2;if(a=P&&ml||a||D&&I.matchUpStatus||(null==I?void 0:I.matchUpStatus)&&[Ul,Il].includes(I.matchUpStatus)&&I.matchUpStatus||Dl,I&&y){e=uf({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let u=D&&Uv({inContextDrawMatchUps:e,drawPosition:o,matchUpId:l})||void 0;null!=I&&I.matchUpStatusCodes&&Iv({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:n,matchUpsMap:s,matchUp:I}),Object.assign(I,{drawPositions:w,winningSide:u,matchUpStatus:a}),yd({tournamentId:null==i?void 0:i.tournamentId,eventId:null==h?void 0:h.eventId,context:f,drawDefinition:r,matchUp:I})}let b=af({inContextDrawMatchUps:e,inContextMatchUp:h,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:M,loserMatchUp:N,loserTargetDrawPosition:R},targetLinks:{loserTargetLink:A}}=b,E=Hd({structureId:g.structureId,matchUpsMap:s});if(S&&P){if(M)if([ml,Ul,Il].includes(a)){let t=yv({matchUpId:M.matchUpId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(t.error)return t}else{let{structureId:e}=M;e!==g.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(M&&h&&!h.feedRound){let{pairedPreviousMatchUpIsDoubleExit:t}=vv({targetMatchUp:I,drawPosition:o,matchUpsMap:s,structure:g});if(t){let t=yv({matchUpId:M.matchUpId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(t.error)return t}}if((null==I?void 0:I.matchUpType)===kd){let t=null==e?void 0:e.find((({matchUpId:e})=>e===I.matchUpId)),n=((null==t?void 0:t.sides)??[]).reduce(((e,t,i)=>t.drawPosition===o?i:e),void 0),a=null==(m=null==T?void 0:T.find((e=>e.drawPosition===o)))?void 0:m.participantId;a&&void 0!==n&&hv({inContextTargetMatchUp:t,drawPositionSideIndex:n,teamParticipantId:a,tournamentRecord:i,drawDefinition:r,matchUp:I})}if((null==A?void 0:A.linkCondition)===ru&&2===w.filter(Boolean).length&&!P&&E.filter((({drawPositions:e,roundNumber:t})=>1===t&&Ar(e,w))).every((({matchUpStatus:e})=>[hl,Tl].includes(e)))&&N){let{structureId:e}=N,t=qf({drawPosition:R,tournamentRecord:i,drawDefinition:r,structureId:e,matchUpsMap:s,event:u});if(t.error)return t}return S?{...Be}:Sa({result:{error:tt},context:{drawPosition:o},stack:f})}function Sv({inContextDrawMatchUps:e,drawDefinition:t,assignments:i,matchUpsMap:n,structure:r}){var a,o,s,l;let u=(null==(s=null==(o=null==(a=Nd({drawDefinition:t}))?void 0:a.containedStructures)?void 0:o[r.structureId])?void 0:s.map((({structureId:e})=>e)))||[];u.push(null==r?void 0:r.structureId);let d=(null==i?void 0:i.map((({drawPosition:e})=>e)))||[],c=(null==e?void 0:e.filter((e=>u.includes(e.structureId)&&Nr(e.drawPositions??[],d).length)))??[],p=c.map((({matchUpId:e})=>e)),m=(null==(l=null==n?void 0:n.drawMatchUps)?void 0:l.filter((e=>p.includes(e.matchUpId))))??[];return{drawPositions:d,matchUps:m,targetMatchUps:c}}function wv({lineUp:e}){if(!Array.isArray(e))return;let t={};return hr(e.flatMap((({collectionAssignments:e})=>null==e?void 0:e.map((({collectionId:e,collectionPosition:t})=>[e,t].join("|"))))).filter(Boolean)).forEach((i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:o}=Tm({collectionPosition:a,collectionId:n,lineUp:e});o.forEach((e=>{t[e]||(t[e]=[]),t[e].push({collectionId:n,collectionPosition:a})}))})),Object.keys(t).map((e=>({participantId:e,collectionAssignments:t[e]})))}function Tv(e){return`${e} must be an array`}function Pv({lineUp:e,tieFormat:t}){let i=[];if(!Array.isArray(e))return i.push(Tv("lineUp")),{valid:!1,errors:i,error:Fn};let n=e.every((e=>{if("object"!=typeof e)return i.push("lineUp entries must be objects"),!1;let{participantId:t,collectionAssignments:n}=e;return t?"string"!=typeof t?(i.push("participantIds must be strings"),!1):Array.isArray(n)?n.every((e=>{if("object"!=typeof e)return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:t}=e;return"number"==typeof t||(i.push("collectionPosition must be a number"),!1)})):(i.push(Tv("collectionAssignments")),!1):(i.push("Missing participantId"),!1)})),r=hr(e.map(sl)).length===e.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Fn:void 0}}function Dv({drawDefinition:e,participantId:t,tieFormat:i,lineUp:n}){if("object"!=typeof e)return{error:Ke};if("string"!=typeof t)return{error:_i};let r=Pv({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=Ds({element:e,name:Ls}),o=(null==a?void 0:a.value)||{};return o[t]=wv({lineUp:n}),fs({element:e,extension:{name:Ls,value:o}}),Sd({drawDefinition:e}),{...Be}}function bv({inContextDrawMatchUps:e,inheritance:t=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:o,event:s}){if(!n)return{error:Ke};let{drawPositions:l,matchUps:u,targetMatchUps:d}=Sv({inContextDrawMatchUps:e,matchUpsMap:r,assignments:a,structure:o});for(let c of d)c.matchUpType===Od&&(c.sides??[]).forEach(((e,r)=>{var a;if(null!=e&&e.drawPosition&&null!=l&&l.includes(e.drawPosition)){let o=u.find((({matchUpId:e})=>e===c.matchUpId));if(null!=(a=null==o?void 0:o.sides)&&a[r]){if(delete o.sides[r].lineUp,!1===t){let t=c.tieFormat,i=e.participantId;t&&i&&Dv({drawDefinition:n,participantId:i,lineUp:[],tieFormat:t})}yd({tournamentId:null==i?void 0:i.tournamentId,context:"resetLineUps",eventId:null==s?void 0:s.eventId,drawDefinition:n,matchUp:o})}}}));return{...Be}}function Mv({provisionalPositioning:e,inContextDrawMatchUps:t,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:u,matchUpsMap:d,structureId:c,event:p}){var m,f,h;let v="assignDrawPosition";if(!s&&!i)return Sa({result:{error:_i},stack:v});d=d??Wd({drawDefinition:a}),t||({matchUps:t}=uf({inContext:!0,drawDefinition:a,matchUpsMap:d}));let g=_u({drawDefinition:a,structureId:c});if(g.error)return Sa({result:g,stack:v});let{structure:I}=g;if(!I)return{error:bt};if(Nm({structure:I}))return Sa({result:{error:ii},stack:v});let{seedAssignments:U}=Nc({provisionalPositioning:e,drawDefinition:a,structure:I}),y=null==(m=null==U?void 0:U.find((e=>e.participantId===s)))?void 0:m.seedNumber,{appliedPolicies:S}=jc({tournamentRecord:r,drawDefinition:a,structure:I,event:p});if(y&&!cv({seedNumber:y,appliedPolicies:S,drawDefinition:a,seedBlockInfo:l,drawPosition:u,structureId:c}))return Sa({result:{error:et},context:{drawPosition:u},stack:v});let w=Gu({structure:I}).positionAssignments||[],T=null==w?void 0:w.find((e=>e.drawPosition===u));if(!T)return Sa({result:{error:st},context:{drawPosition:u},stack:v});if(null!=w&&w.map(sl).includes(s))return Sa({result:{error:Hi},context:{drawPosition:u},stack:v});let{containsParticipant:P,containsBye:D}=function(e){let t=e.bye,i=e.qualifier,n=e.participantId;return{containsBye:t,containsQualifier:i,containsParticipant:n,filled:t||i||n}}(T);if(D){let e=Jf({inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:a,drawPosition:u,structureId:c,matchUpsMap:d,event:p});if(e.error)return Sa({result:e,stack:v})}if(P&&T.participantId!==s){let{activeDrawPositions:e}=_f({drawDefinition:a,structureId:c});if(e.includes(u))return Sa({result:{error:ot},stack:v});bv({assignments:[T],inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:a,matchUpsMap:d,structure:I})}if(T.participantId=s,i&&(T.qualifier=!0),((null==I?void 0:I.stageSequence)||0)>1||I.stage&&[_l,jl].includes(I.stage)){let t=I.stage===Ll?Ll:xl,i=((null==(h=null==(f=a.structures)?void 0:f.find((e=>(null==e?void 0:e.stage)===t&&1===(null==e?void 0:e.stageSequence))))?void 0:h.seedAssignments)??[]).find((e=>e.participantId===s));if(null!=i&&i.participantId){let{participantId:t,seedNumber:n,seedValue:s}=i;fv({eventId:null==p?void 0:p.eventId,provisionalPositioning:e,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:t,seedNumber:n,seedValue:s,structureId:c,event:p})}}if(I.structureType!==Jl)!function({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let u={isCollectionMatchUp:!1},{matchUps:d}=Zm({provisionalPositioning:e,matchUpFilters:u,drawDefinition:r,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:c}=jd({matchUps:d}),{initialRoundNumber:p}=Bf({drawPosition:a,matchUps:d}),m=p&&(null==c?void 0:c[p].find((e=>{var t;return null==(t=e.drawPositions)?void 0:t.includes(a)})));if(m){let e=yv({matchUpId:m.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o});if(e.error)return Sa({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:e})}}({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:u,matchUpsMap:d,structure:I,event:p});else{Kf({positionAssignments:w,tournamentRecord:r,drawDefinition:a,matchUpsMap:d,structure:I});let{drawPositions:e,matchUps:i,targetMatchUps:n}=Sv({assignments:[T],inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:d,structure:I});if(e&&1===(null==i?void 0:i.length)&&i[0].matchUpType===kd){let t=((null==n?void 0:n[0].sides)??[]).reduce(((t,i,n)=>null!=e&&e.includes(i.drawPosition)?n:t),void 0);hv({inContextTargetMatchUp:n[0],teamParticipantId:s,matchUp:i[0],drawPositionSideIndex:t,tournamentRecord:r,drawDefinition:a})}}return Pd({tournamentId:null==r?void 0:r.tournamentId,drawDefinition:a,structure:I,event:p}),{positionAssignments:w,...Be}}function Nv(e){let{participantIdAttributeName:t="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:u}=e,d="positionParticipantAction";if(!a)return{error:Ke};let{inContextDrawMatchUps:c,matchUpsMap:p}=e;p||(p=Wd({drawDefinition:a}),Object.assign(e,{matchUpsMap:p})),c||(({matchUps:c}=uf({inContext:!0,drawDefinition:a,matchUpsMap:p})),Object.assign(e,{inContextDrawMatchUps:c}));let{positionAssignments:m}=Vu({drawDefinition:a,structureId:l}),f=null==m?void 0:m.find((e=>e.drawPosition===s));if(null!=f&&f.participantId){let e=f.participantId,t=Mv({inContextDrawMatchUps:c,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:u});return t.success?I({removedParticipantId:e}):Sa({result:t,stack:d})}let h=Jf({inContextDrawMatchUps:c,tournamentRecord:r,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:p,event:u});if(h.error)return Sa({result:h,stack:d});let v=h.participantId,g=Mv({inContextDrawMatchUps:c,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:u});return g.success?I({removedParticipantId:v}):Sa({result:g,stack:d});function I({removedParticipantId:e}){let{structure:i}=_u({drawDefinition:a,structureId:l});return bd({drawPositions:[s],structure:i}),Md({drawDefinition:a,positionAction:{[t]:o,name:n,drawPosition:s,structureId:l}}),Sa({context:{removedParticipantId:e},result:{...Be},stack:d})}}function Rv(e){return function({luckyLoserParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r}){return Nv({positionActionName:"luckyLoserDrawPositionAssignment",participantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r})}(e)}function Av(e){return function({alternateParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r}){return Nv({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r})}(e)}function Ev({params:e,modMap:t,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=e;for(let o of i.matchUps)t[o.matchUpId]&&(o.roundNumber=t[o.matchUpId],yd({tournamentId:null==n?void 0:n.tournamentId,eventId:null==a?void 0:a.eventId,drawDefinition:r,matchUp:o}))}function Cv(e,t){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(t)&&i.push(...t);let n=io(e,i);if(n.error)return n;let r=_u(e);if(r.error)return r;let a=r.structure;if(!Nm({structure:a}))return Sa({result:{error:Ze,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=jd({matchUps:null==a?void 0:a.matchUps});return null!=s&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:ei}}function Ov(e){var t;let i=Cv(e,[{targetRoundNumber:!0,roundNumber:!0,[Qa]:"number"}]);if(i.error)return i;let{structure:n,roundMatchUps:r,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=e;if(null==a||!a.includes(s)||null==a||!a.includes(o))return Sa({result:{error:Fn},info:"roundNumbers must be valid rounds"});let l=o>s,u=l?br(s+1,o+1):br(o,s),d={};return u.forEach((e=>((null==r?void 0:r[e])??[]).forEach((({matchUpId:t})=>{d[t]=e-(l?1:-1)})))),null==(t=null==r?void 0:r[s])||t.forEach((({matchUpId:e})=>d[e]=o)),Ev({params:e,modMap:d,structure:n}),{...Be}}function kv({structurePositionAssignments:e,provisionalPositioning:t,tournamentRecord:i,drawDefinition:n,event:r}){var a;if(!n)return{error:Ke};if(!Array.isArray(e))return{error:Fn};for(let s of e){let{structureId:e,positionAssignments:o}=s;if(!o)continue;let l=_u({drawDefinition:n,structureId:e});if(l.error)return l;let u=l.structure;if(!u)return{error:bt};let d=null==(a=Vu({structure:u}).positionAssignments)?void 0:a.map((({drawPosition:e})=>e));if(Nr(d,null==o?void 0:o.map((({drawPosition:e})=>e))).length!==(null==d?void 0:d.length))return Sa({result:{error:Fn},info:"drawPositions do not match",stack:"setPositionAssignments"});let c=Wd({drawDefinition:n}),{matchUps:p}=uf({inContext:!0,drawDefinition:n,matchUpsMap:c});for(let a of o||[]){let{drawPosition:s,participantId:l,bye:d,qualifier:m}=a;if(d){let t=qf({tournamentRecord:i,drawDefinition:n,drawPosition:s,matchUpsMap:c,structureId:e,structure:u,event:r});if(null!=t&&t.error)return t}else if(m)o.forEach((e=>{e.drawPosition===s&&(e.qualifier=!0,delete e.participantId,delete e.bye)}));else if(l){let a=Mv({provisionalPositioning:t,inContextDrawMatchUps:p,tournamentRecord:i,drawDefinition:n,participantId:l,drawPosition:s,matchUpsMap:c,structureId:e,event:r});if(null!=a&&a.error)return a}}Pd({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:n,structure:u,event:r})}let o=e.map((({structureId:e})=>e));return wd({tournamentId:null==i?void 0:i.tournamentId,eventId:null==r?void 0:r.eventId,drawDefinition:n,structureIds:o}),{...Be}}function Fv(e){let t=Cv(e,[{roundNumbers:!0,[Qa]:za,[Ya]:e=>2===e.length&&e.every(ur)}]);if(t.error)return t;let{structure:i,roundMatchUps:n,roundNumbers:r}=t;if(!e.roundNumbers.every((e=>null==r?void 0:r.includes(e))))return Sa({result:{error:Fn,message:"roundNumbers must be valid rounds"}});let a={};return e.roundNumbers.forEach(((t,i)=>((null==n?void 0:n[t])??[]).forEach((({matchUpId:t})=>{a[t]=e.roundNumbers[1-i]})))),Ev({params:e,modMap:a,structure:i}),{...Be}}function xv(e){return function({qualifyingParticipantId:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r}){return Nv({positionActionName:"qualifierDrawPositionAssignment",participantId:e,isQualifierPosition:!0,tournamentRecord:t,drawDefinition:i,drawPosition:n,structureId:r})}(e)}function Lv({tournamentRecord:e,drawDefinition:t,drawPositions:i,structureId:n,event:r}){if(!t)return{error:Ke};if(!n)return{error:Dt};if(2!==(null==i?void 0:i.length))return{error:Fn,drawPositions:i};let a,o=Wd({drawDefinition:t}),{matchUps:s}=uf({inContext:!0,drawDefinition:t,matchUpsMap:o}),{structure:l}=_u({drawDefinition:t,structureId:n});if(!l)return{error:bt};if(a=l.structureType===Jl?function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){var s;let l=null==(s=a.structures)?void 0:s.reduce(((e,t)=>{let i=null==t?void 0:t.positionAssignments.filter((e=>null==n?void 0:n.includes(e.drawPosition)));return i&&e.push(...i),e}),[]);if(2===l.filter((({bye:e})=>e)).length)return{...Be};if(2===l.filter((({qualifier:e})=>e)).length)return{...Be};bv({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:r,assignments:l,structure:a,event:o});let u=l.some((({qualifier:e})=>e));if(l.some((({bye:e})=>e))&&!u)_v({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:l,matchUpsMap:r,structure:a,event:o});else{let e=Wo(l,!1,!0);l.forEach(((t,i)=>{let n=e[1-i].participantId;t.qualifier=e[1-i].qualifier,t.participantId=n}))}return{...Be}}({inContextDrawMatchUps:s,tournamentRecord:e,drawDefinition:t,drawPositions:i,matchUpsMap:o,structure:l,event:r}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){let s=null==a?void 0:a.positionAssignments.filter((e=>null==n?void 0:n.includes(e.drawPosition)));if(!s)return{error:Fn,structure:a,info:"Missing positionAssignments"};if(2===s.filter((({bye:e})=>e)).length)return{...Be};if(2===s.filter((({qualifier:e})=>e)).length)return{...Be};let l=s.some((({qualifier:e})=>e));return s.some((({bye:e})=>e))&&!l?_v({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=Object.assign({},...n.map(((e,t)=>{let{drawPosition:i}=e;return{[i]:{...n[1-t],drawPosition:i}}})));return a.positionAssignments=a.positionAssignments.map((e=>s[e.drawPosition]||e)),bv({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:o}),{...Be}}({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o})}({inContextDrawMatchUps:s,tournamentRecord:e,drawDefinition:t,drawPositions:i,matchUpsMap:o,structure:l,event:r}),a.error)return a;if(bd({structure:l,drawPositions:i}),Md({drawDefinition:t,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:n}}),Pd({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:t,structure:l,event:r}),r.eventType===qp){let n=Zm({matchUpFilters:{matchUpTypes:[Od]},inContext:!0,structure:l}).matchUps.filter((e=>{var t;return null==(t=e.drawPositions)?void 0:t.some((e=>i.includes(e)))})),a=Zm({matchUpFilters:{matchUpTypes:[Od]},structure:l}).matchUps;n.forEach((n=>{(n.sides||[]).forEach((o=>{var s;let l=null==o?void 0:o.drawPosition;if(i.includes(l)){let i=o.participantId,u=a.find((({matchUpId:e})=>e===n.matchUpId)),d=null==(s=null==n?void 0:n.sides)?void 0:s.reduce(((e,t,i)=>t.drawPosition===l?i:e),void 0);hv({inContextTargetMatchUp:n,drawPositionSideIndex:d,teamParticipantId:i,tournamentRecord:e,drawDefinition:t,matchUp:u,event:r})}}))}))}return wd({drawDefinition:t,structureIds:[n]}),{...Be}}function _v({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=n.find((({bye:e})=>e)),l=n.find((({participantId:e})=>e)),u=s.drawPosition,{participantId:d,drawPosition:c}=l,{structureId:p}=a,m=Wh({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:r});return m.error||(m=Wh({drawPosition:c,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:r}),m.error)||(qf({drawPosition:c,tournamentRecord:t,drawDefinition:i,structureId:p,matchUpsMap:r,event:o}),m=Mv({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:p,participantId:d,matchUpsMap:r,event:o}),m.error)?m:{...Be}}function Bv(e){return Lv(e)}function jv({validation:e=!0,tournamentRecord:t,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:o}){if(!i)return{error:Ke};if(!r)return{error:Dt};let s=((null==t?void 0:t.participants)??[]).find((e=>e.participantId===n));if(t&&!s)return{error:Ei};let{structure:l}=_u({drawDefinition:i,structureId:r});if(!l)return{error:bt};if(!(!e||ur(a)||void 0===a||""===a||"string"==typeof a&&a.split("-").every((e=>ur(e)&&rr(e)>0))))return{error:Fn};let{seedAssignments:u}=Nc({drawDefinition:i,structure:l}),d=null==u?void 0:u.map((e=>e.seedNumber)),c=null==u?void 0:u.find((e=>e.participantId===n));if(c){let e="string"==typeof a?a.includes("-")&&a.split("-").map((e=>parseInt(e))).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";c.seedValue=e}else{let e={seedNumber:Math.max(0,...d||[])+1,participantId:n};a&&(e.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(e)}return Td({tournamentId:null==t?void 0:t.tournamentId,eventId:null==o?void 0:o.eventId,drawDefinition:i,structure:l}),{...Be}}function Vv({drawDefinition:e,structureId:t}){if(!e)return{error:Ke};let{structure:i}=_u({drawDefinition:e,structureId:t}),n=((null==e?void 0:e.links)||[]).filter((e=>{var i;return(null==(i=e.source)?void 0:i.structureId)===t})).map((e=>{var t;return null==(t=e.target)?void 0:t.structureId}));return{playoffStructures:((null==e?void 0:e.structures)||[]).filter((e=>n.includes(e.structureId))),structure:i}}function Gv({withStageGrouping:e,stageSequences:t,stageSequence:i,roundTarget:n,stages:r,event:a,stage:o}){if(!a)return{error:Et};let s={},l=[];for(let u of a.drawDefinitions||[]){let{structures:a,stageStructures:d}=Bu({withStageGrouping:e,stageSequences:t,drawDefinition:u,stageSequence:i,roundTarget:n,stages:r,stage:o});if(l.push(...a),d)for(let e of Object.keys(d))s[e]||(s[e]=[]),s[e].push(...d[e])}return{structures:l,stageStructures:s}}function $v({withStageGrouping:e,tournamentRecord:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:o}){if(!t)return{error:We};let s={},l=[];for(let u of t.events||[]){let{structures:t,stageStructures:d}=Gv({withStageGrouping:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:u,stage:o});if(t&&l.push(...t),d)for(let e of Object.keys(d))s[e]||(s[e]=[]),s[e].push(...d[e])}return{structures:l,stageStructures:s}}function qv(e){if(null==e||!e.drawDefinition)return!1;let t=ef(e),i=null==t?void 0:t.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=t||{};return i&&(n=null==n?void 0:n.filter((({matchUpType:e})=>e===kd)),r=null==r?void 0:r.filter((({matchUpType:e})=>e===kd)),a=null==a?void 0:a.filter((({matchUpType:e})=>e===kd))),!(null==n||!n.length||null!=r&&r.length||null!=a&&a.length)}function Wv(e){var t,i;let{drawDefinition:n,structureId:r}=e;if(!n)return{error:Ke};let{playoffStructures:a}=Vv({drawDefinition:n,structureId:r});if(null==a||!a.length)return!1;let o=(null==(i=null==(t=null==n?void 0:n.entries)?void 0:t.filter((e=>(null==e?void 0:e.entryStatus)&&wc.includes(e.entryStatus))))?void 0:i.length)??0,s=0;return(a||[]).reduce(((e,t)=>{var i;return!(null==(i=Vu({structure:t}).positionAssignments??[])||!i.filter((e=>(e.participantId&&s++,(null==e?void 0:e.bye)??(null==e?void 0:e.participantId)))).length||!e)}),!!a.length)||s===o}function Hv({significantCharacters:e,accessors:t=[],value:i}){let n=[],r=t[0];if(null!=i&&i[r]){let a=t.slice(1);if(Array.isArray(i[r]))i[r].forEach((t=>{let i=Hv({accessors:a,significantCharacters:e,value:t});n.push(...i)}));else if(i=i[r],a.length){let t=Hv({accessors:a,significantCharacters:e,value:i});n.push(...t)}else!function({value:t}){if(t&&["string","number"].includes(typeof t)){let i=e?t.slice(0,e):t;n.push(i)}}({value:i})}return n}function zv({policyAttributes:e,idCollections:t,participants:i,participant:n}){if(!Array.isArray(e))return{error:oi};if(!n)return{error:xi};let r=[];return e.forEach((e=>{let{directive:a,groupings:o,key:s,significantCharacters:l}=e||{};if(s){let e=s.split(".");r.push(...Hv({significantCharacters:l,value:n,accessors:e}))}else if(a){let o=null==e?void 0:e.includeIds,s=((null==t?void 0:t[a])||[]).filter((e=>!o||o.includes(e)));null!=s&&s.length&&null!=i&&i.length&&s.forEach((e=>{var t;let a=i.find((t=>t.participantId===e));if(null!=(t=null==a?void 0:a.individualParticipantIds)&&t.includes(n.participantId)){let e=null==a?void 0:a.participantId;r.push(e)}}))}else o&&Object.keys(o).forEach((e=>{o[e].includes(n.participantId)&&r.push(e)}))})),{values:hr(r)}}function Yv({candidatePositionAssignments:e,participantsWithGroupings:t,policyAttributes:i,idCollections:n}){let r=Object.assign({},...t.map((e=>({[e.participantId]:e}))));return e.map((e=>{let a=r[e.participantId],{values:o}=zv({participants:t,policyAttributes:i,idCollections:n,participant:a});return{...e,values:o}}))}function Kv({participantIdGroups:e,positionAssignments:t,groupsToAvoid:i}){return Object.assign({},...t.filter((e=>null==e?void 0:e.participantId)).map((t=>{let{drawPosition:n,participantId:r}=t,a=e&&e[r]||[],o=!!i.some((e=>a.includes(e)));return{[n]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function Jv(e){let{unfilledPositions:t,chunkedDrawPositions:i}=e,n=Kv(e);return i.map((e=>{let i=t.filter((t=>e.includes(t))),r=function(e){return e.filter((e=>!t(e)));function t(t){let i=Qv(t);return!e.includes(i)}}(i),a=i.filter((e=>!r.includes(e))).filter((e=>{var t;let i=Qv(e);return!(null!=(t=n[i])&&t.includesGroupsToAvoid)}));return{unassigned:i,unpaired:r,pairedNoConflict:a}}))}function Qv(e){return Number(e%2?e+1:e-1)}function Zv({selectedParticipantGroups:e,participantIdGroups:t,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let o=n.map((n=>a?function(e){let{unfilledPositions:t,chunkedDrawPositions:i}=e,n=Kv(e);return i.map((e=>{let i=t.filter((t=>e.includes(t))),r=i.length===e.length?i:[],a=e.filter((e=>{var t;return null==(t=n[e])?void 0:t.includesGroupsToAvoid})).length;return{unassigned:i,unpaired:r,pairedNoConflict:a?[]:i,conflictsCount:a}}))}({groupsToAvoid:e,chunkedDrawPositions:n,participantIdGroups:t,positionAssignments:i,unfilledPositions:r}):Jv({groupsToAvoid:e,chunkedDrawPositions:n,participantIdGroups:t,positionAssignments:i,unfilledPositions:r})));if(a){return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)).sort(((e,t)=>(t.length||0)-(e.length||0))),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)).sort(((e,t)=>(t.length||0)-(e.length||0)))}}return{unassigned:o.map((e=>e.map((e=>e.unassigned)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),unpaired:o.map((e=>e.map((e=>e.unpaired)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length)),pairedNoConflict:o.map((e=>e.map((e=>e.pairedNoConflict)).filter((e=>null==e?void 0:e.length)))).filter((e=>null==e?void 0:e.length))}}function Xv({positionAssignments:e,participantIds:t}){let i=e.map((e=>e.participantId));return t.filter((e=>!i.includes(e)))}function eg({candidatePositionAssignments:e,unseededParticipantIds:t,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){let l,u=r.reduce(((e,t)=>t.length>e?t.length:e),0)<=2,d=Xv({positionAssignments:e,participantIds:t}),c=function({drawPositionGroups:e,positionAssignments:t}){let i=Object.assign({},...t.map((e=>({[e.drawPosition]:e}))));return e.map((e=>e.filter(Boolean).map((e=>i[e])).filter(Boolean).filter((e=>!e.participantId&&!e.bye)).map((e=>e.drawPosition)))).flat().filter(Boolean)}({positionAssignments:e,drawPositionGroups:r}),{participantId:p,groupKey:m}=function({useSpecifiedGroupKey:e=!1,targetParticipantIds:t,largestFirst:i=!0,allGroups:n,groupKey:r}){var a;let o=Object.assign({},...Object.keys(n).map((e=>[e,n[e].filter((e=>t.includes(e)))])).filter((e=>e[1].length)).map((([e,t])=>({[e]:t})))),s=Object.keys(o).reduce(((e,t)=>o[t].length>e?o[t].length:e),0),l=Object.keys(o).filter((e=>o[e].length===s)),u=Dr(i?l:Object.keys(o));return{participantId:(r=e&&null!=(a=o[r])&&a.length?r:u)&&o[r]?Dr(o[r]):Dr(t),groupKey:r}}({targetParticipantIds:d,useSpecifiedGroupKey:u,allGroups:o,groupKey:s}),f=function({allGroups:e,participantId:t}){return Object.keys(e).filter((i=>e[i].includes(t)))}({participantId:p,allGroups:o}),h=Zv({positionAssignments:e,isRoundRobin:u,selectedParticipantGroups:f,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:c}),{unassigned:v,unpaired:g,pairedNoConflict:I}=h,U=(null==I?void 0:I.length)&&I[0],y=(null==g?void 0:g.length)&&g[0],S=a&&U?U:y,w=a?y:U,T=(null==S?void 0:S.length)&&S||(null==w?void 0:w.length)&&w;if(null!=T&&T.length){let e=Pr(T);l=Pr(e)}else{let e=Pr(v[0]);l=Pr(e)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:l}}function tg({isRoundRobin:e,groupedParticipants:t}){let i=[];return e?t.forEach((e=>{let t=Zh({drawPositions:e.map((e=>e.drawPosition))}).uniqueMatchUpGroupings??[],n=Object.assign({},...e.map((e=>({[e.drawPosition]:e}))));t.forEach((t=>{Ar(n[t[0]].values||[],n[t[1]].values||[])&&(i.push(t),e.conflict=!0)}))})):t.forEach((e=>{var t,n;Ar((null==(t=e[0])?void 0:t.values)||[],(null==(n=e[1])?void 0:n.values)||[])&&(i.push(e),e.conflict=!0)})),i}function ig({positionedParticipants:e,potentialDrawPositions:t,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map((n=>{let a=n.map((e=>e.drawPosition));return n.filter((e=>t.includes(e.drawPosition))).map((n=>{let o=t.filter((e=>!(null!=a&&a.includes(e)))).filter((t=>{let a=i.find((e=>e.includes(t))).find((e=>e!==t)),o=e.find((e=>e.drawPosition===a)),s=tg({isRoundRobin:r,groupedParticipants:[[n,o]]}),l=[e.find((e=>e.drawPosition===t)),o],u=tg({isRoundRobin:r,groupedParticipants:[l]});return!s.length&&!u.length}));if(o.length)return{drawPosition:n.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function ng(e){let t,{initialPositionAssignments:i,participantsWithGroupings:n,opponentsToPlaceCount:r,unseededByePositions:a,drawPositionGroups:o,policyAttributes:s,idCollections:l,allGroups:u}=e,d=[],c=Math.min(...(o||[]).map((e=>null==e?void 0:e.length)).filter(Boolean)),p=c>2,m=Wo(i,!1,!0).filter((e=>!e.qualifier)),f=i.filter((e=>!e.participantId&&(!e.bye||(null==a?void 0:a.includes(e.drawPosition))))).map((e=>e.drawPosition));br(0,r).forEach((()=>{let{newGroupKey:i,selectedParticipantId:n,targetDrawPosition:r}=eg({...e,candidatePositionAssignments:m,allGroups:u,groupKey:t});t=i,m.forEach((e=>{e.drawPosition===r&&(e.participantId=n)}))}));let h=Yv({candidatePositionAssignments:m,participantsWithGroupings:n,policyAttributes:s,idCollections:l}),v=Or(h,c),g=tg({groupedParticipants:v,isRoundRobin:p}),I=0;for(;I<20&&g.length;){let e=ig({positionedParticipants:h,potentialDrawPositions:f,avoidanceConflicts:g,drawPositionGroups:o,isRoundRobin:p});if(e.length){let t=rg({candidatePositionAssignments:m,swapOptions:e});t.error&&console.log({result:t}),h=Yv({candidatePositionAssignments:m,participantsWithGroupings:n,policyAttributes:s,idCollections:l}),v=Or(h,c),g=tg({groupedParticipants:v,isRoundRobin:p}),I++}else I=20}return m.forEach((e=>{if(e.bye&&e.participantId){let e=Ut;d.push(e)}if(e.qualifier&&e.participantId){let e=Ut;d.push(e)}})),{positionAssignments:m,conflicts:g.length,groupedParticipants:v,errors:d}}function rg({candidatePositionAssignments:e,swapOptions:t}){let i=Pr(t);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Pr(i.possibleDrawPositions),a=e.find((e=>e.drawPosition===n)),o=e.find((e=>e.drawPosition===r))??{},s={participantId:null==o?void 0:o.participantId,qualifier:null==o?void 0:o.qualifier,bye:null==o?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...Be}}function ag({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:d,drawSize:c,event:p}){var m;if(!d)return{error:ai};let{candidatesCount:f=1,policyAttributes:h,targetDivisions:v}=d,{roundsToSeparate:g}=d,I="randomUnseededSeparation",{structure:U}=_u({drawDefinition:a,structureId:u}),{matchUps:y}=Zm({provisionalPositioning:e,matchUpsMap:l,structure:U,event:p});if(v&&ar(v)&&!g){let e=function(e){if(!ar(e))return!1;let t=e,i=1;for(;2!==t;)i+=1,t/=2;return i}(v)||0,t=y.reduce(((e,t)=>t.roundNumber>e?t.roundNumber:e),0);g=t<e?1:t-e+1}let{positionAssignments:S}=Gu({structure:U}),w=nc({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,T=null==S?void 0:S.filter((e=>!e.participantId)),P=null==S?void 0:S.map((e=>e.drawPosition)),D=(null==U?void 0:U.structureType)===Jl,b=D?{structure:U,matchUps:y,allDrawPositions:P,roundsToSeparate:g}:{matchUps:y,allDrawPositions:P,roundsToSeparate:g},{drawPositionGroups:M,drawPositionChunks:N}=D?function(e){let{structure:{structures:t}}=e,i=t.map((e=>e.positionAssignments.map((e=>e.drawPosition))));return{drawPositionGroups:i,drawPositionChunks:[i]}}(b):function({allDrawPositions:e,roundsToSeparate:t,matchUps:i}){let n=i.filter((e=>1===e.roundNumber)).map((e=>e.drawPositions)),r=n.flat().sort(nr),a=Math.max(...r),o=e.filter((e=>e>a)),s=r.length,l=br(2===s?1:2,s).filter((e=>e===lr(e))),u=l.slice(0,t||l.length).reverse().map((e=>Or(r,e)));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:u}}(b),R={groupParticipants:s.filter((e=>e.participantType===Zd)).map((e=>e.participantId)),teamParticipants:s.filter((e=>e.participantType===ec)).map((e=>e.participantId)),pairParticipants:s.filter((e=>e.participantType===Xd)).map((e=>e.participantId))},A=function({targetParticipantIds:e,policyAttributes:t,idCollections:i,participants:n}){if(!Array.isArray(t))return{error:oi};if(!Array.isArray(n))return{error:Li};let r={};return e.forEach((e=>{let a=n.find((t=>t.participantId===e)),{values:o}=zv({policyAttributes:t,idCollections:i,participants:n,participant:a});o&&o.forEach((t=>{r[t]||(r[t]=[]),r[t].includes(e)||r[t].push(e)}))})),r}({targetParticipantIds:t,policyAttributes:h,idCollections:R,participants:s});if(A.error)return Sa({result:A,stack:I});let E=Object.assign({},...t.map((e=>{let t=Object.keys(A).filter((t=>(A[t]??[]).includes(e)));return{[e]:t}}))),C=Xv({participantIds:t,positionAssignments:S});if(C.length>((null==T?void 0:T.length)||0))return{error:rn};let O,k=C.length,F=br(0,f).map((()=>ng({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:t,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:n,participantIdGroups:E,drawPositionChunks:N,drawPositionGroups:M,policyAttributes:h,idCollections:R,allGroups:A,drawSize:c})));if(O=F.reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0),!O||O.conflicts){let e=br(0,f).map((()=>ng({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:t,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:n,participantIdGroups:E,drawPositionChunks:N,drawPositionGroups:M,policyAttributes:h,idCollections:R,allGroups:A,drawSize:c})));O=F.concat(...e).filter((e=>{var t;return!(null!=(t=e.errors)&&t.length)})).reduce(((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e),void 0)}if(!O)return{error:Rn};let x=((null==(m=Vu({structure:U}))?void 0:m.positionAssignments)??[]).filter((e=>e.participantId)).map((e=>e.participantId)),L=O.positionAssignments.filter((e=>!x.includes(e.participantId)));for(let _ of L)if(_.bye){let e=qf({tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(e.error)return Sa({result:e,stack:I})}else if(_.participantId){let e=Mv({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,event:p,..._});if(e.error)return Sa({result:e,stack:I,context:{assignment:_}})}return{...Be}}function og({provisionalPositioning:e,inContextDrawMatchUps:t,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,structure:d,drawSize:c,event:p}){var m,f;d||({structure:d}=_u({drawDefinition:a,structureId:u})),u||({structureId:u}=d);let{positionAssignments:h}=Gu({structure:d}),{seedAssignments:v}=Nc({provisionalPositioning:e,drawDefinition:a,structure:d}),g=null==v?void 0:v.map((e=>e.participantId)).filter(Boolean),{stage:I,stageSequence:U}=d,y=I===Ll?null==(f=null==(m=Ds({element:d,name:Gs}))?void 0:m.extension)?void 0:f.value:void 0,S=Mc({provisionalPositioning:e,drawDefinition:a,stageSequence:U,entryStatuses:Sc,structureId:u,roundTarget:y,stage:I}),w=S.filter((e=>!(null!=g&&g.includes(e.participantId)))).map((e=>e.participantId)),T=null==h?void 0:h.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition));if(!n&&w.length>((null==T?void 0:T.length)||0))return Sa({result:{error:rn},context:{unseededParticipantsCount:w.length,unfilledDrawPositionsCount:null==T?void 0:T.length},stack:"positionUnseededParticipants"});let{appliedPolicies:P}=jc({tournamentRecord:r,drawDefinition:a,event:p}),D=null==P?void 0:P[ns];if(d.stage===jl){let e=S.reduce(((e,t)=>(e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e)),{});Object.keys(e).length&&(D||(D={policyName:"Playoff Avoidance"}),D.policyAttributes||(D.policyAttributes=[]),D.policyAttributes.push({groupings:e}))}return D&&s?ag({provisionalPositioning:e,unseededParticipantIds:w,inContextDrawMatchUps:t,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:u,avoidance:D,drawSize:c,entries:S}):function({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:u,drawSize:d,event:c}){let p=d>2?gr(n):n.reverse();for(let m of t){let t=p.pop();if(!r||t){let n=Mv({provisionalPositioning:e,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:t,matchUpsMap:l,structureId:u,event:c});if(null!=n&&n.error&&console.log("!!!!!",{result:n}),null==n?void 0:n.error)return Sa({result:n,stack:"randomUnseededDistribution"})}}return{...Be}}({provisionalPositioning:e,unseededParticipantIds:w,inContextDrawMatchUps:t,unfilledDrawPositions:T,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:l,drawSize:c,event:p})}function sg(e){let t=e.structure??_u(e).structure,i="positionQualifiers",n=[];if(t.stage===_l)return Sa({result:{error:_t},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:o}=function({drawDefinition:e,structure:t,structureId:i}){t||({structure:t}=_u({drawDefinition:e,structureId:i})),i||({structureId:i}=t);let{positionAssignments:n}=Gu({structure:t}),{stage:r,stageSequence:a}=t,{qualifiersCount:o,roundQualifiersCounts:s}=Ih({drawDefinition:e,stageSequence:a,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map((e=>rr(e))),{matchUps:u}=Zm({structure:t}),{roundProfile:d}=jd({matchUps:u}),c=Object.assign({},...l.filter((e=>null==d?void 0:d[e])).map((e=>{var t,i;return{[e]:(null==(i=null==(t=null==d?void 0:d[e])?void 0:t.drawPositions)?void 0:i.filter(Boolean))??[]}}))),p=null==n?void 0:n.filter((e=>e.qualifier)).map((e=>e.drawPosition)),m=o-((null==p?void 0:p.length)??0),f=null==p?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map((e=>{let t=null==n?void 0:n.filter((t=>{var i,n;return t.qualifier&&(null==(n=null==(i=c[e])?void 0:i.drawPositions)?void 0:n.includes(t.drawPosition))})).map((e=>e.drawPosition));return{[e]:((null==s?void 0:s[e])??0)-((null==t?void 0:t.length)??0)}}))),unplacedQualifiersCount:m,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:c,qualifiersCount:o}}(e);for(let s of Object.keys(r)){let e=null==a?void 0:a.filter((e=>o[s].includes(e.drawPosition)&&!e.participantId&&!e.qualifier&&!e.bye)).map((e=>e.drawPosition));if(r[s]>(e||0))return Sa({result:{error:nn},context:{unfilledDrawPositions:e},stack:i});br(0,r[s]).forEach((()=>{let t=Pr(e);n.push(t),null==a||a.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)}))}))}return{...Be,qualifierDrawPositions:n}}function lg({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:u,structureId:d,matchUpsMap:c,structure:p,event:m}){let f=[],h=[],v=0;if(p||({structure:p}=_u({drawDefinition:a,structureId:d})),d||(d=null==p?void 0:p.structureId),n||(n=jc({drawDefinition:a}).appliedPolicies),!r){let t=p&&uv({provisionalPositioning:e,appliedPolicies:n,drawDefinition:a,seedingProfile:o,structure:p});null!=t&&t.error&&h.push(t.error),r=null==t?void 0:t.validSeedBlocks}return br(0,u=u??(null==r?void 0:r.length)??0).forEach((()=>{if(v<(u||0)){let n=function({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:u}){let{unplacedSeedParticipantIds:d,unfilledPositions:c}=pv({provisionalPositioning:e,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:s,event:u}),{appliedPolicies:p}=jc({drawDefinition:n}),{avoidance:m}=p??{};m&&o&&(null==d||d.length);let f=[];for(let h of d){let o=c.pop();if(!o)return{error:lt};f.push(o);let d=Mv({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:h,seedBlockInfo:a,drawPosition:o,matchUpsMap:l,structureId:s,event:u});if(!d.success)return d}return{...Be,seedPositions:f}}({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:d,matchUpsMap:c,event:m});null!=n&&n.success&&(v++,f.push(...n.seedPositions??[])),n.error&&h.push({seedPositionError:n.error})}})),h.length?{error:h}:{...Be,seedPositions:f}}function ug({orderedSortedFirstRoundSeededDrawPositions:e,validSeedBlocks:t,byesToPlace:i}){let n=[];t.forEach((t=>{if(i-n.length>t.drawPositions.length)n.push(...t.drawPositions);else{let i,r=cg(Or(t.drawPositions,2)),a=e[n.length];for(;i=dg(r,a);)n.push(i),a=e[n.length]}}));let r=n.map((e=>Array.isArray(e)?gr(e):e)).flat(1/0);return dr(i)&&t.map((e=>e.seedNumbers[0])).includes(i)?e:r}function dg(e,t){if(Array.isArray(e)&&2!==e.length)return e.pop();if(!Array.isArray(e[0]))return e.includes(t)?e.indexOf(t)?e.pop():e.shift():Math.round(Math.random())?e.pop():e.shift();let i=e[0].flat(1/0).length,n=e[1].flat(1/0).length;if(i===n){let i=e[0].flat(1/0).includes(t)?e[0]:e[1];return dg(t?i:e[Math.round(Math.random())],t)}return dg(i<n?e[1]:e[0],t)}function cg(e){let t=Math.floor(e.length/2);return e.length>2?[cg(e.slice(0,t)),cg(e.slice(t))]:e}function pg({provisionalPositioning:e,relevantMatchUps:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=uv({provisionalPositioning:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:u,isLuckyStructure:d,isContainer:c}=a,{validSeedBlocks:p}=a;null!=(l=null==i?void 0:i.seeding)&&l.containerByesIgnoreSeeding&&(p=[]);let m=function({provisionalPositioning:e,drawDefinition:t,structure:i}){let{positionAssignments:n}=Gu({structure:i}),{seedAssignments:r}=Nc({provisionalPositioning:e,drawDefinition:t,structure:i}),a=Object.assign({},...(r||[]).filter((e=>e.participantId)).map((e=>({[e.participantId]:e}))));return null==n?void 0:n.map((e=>a[e.participantId]?{...e,seedNumber:a[e.participantId].seedNumber,seedValue:a[e.participantId].seedValue}:"")).filter(Boolean)}({provisionalPositioning:e,drawDefinition:n,structure:s})??[],f=hr([].concat(...t.map((e=>e.drawPositions)))),h=m.filter((e=>f.includes(e.drawPosition))),v=(e,t)=>sv(e.seedValue)-sv(t.seedValue),g=p.reduce(((e,t)=>{let i=h.filter((e=>{var i;return null==(i=t.drawPositions)?void 0:i.includes(e.drawPosition)})).sort(v);return e.concat(...i)}),[]).map((e=>e.drawPosition)),I=ug({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:p,byesToPlace:o});return{strictSeedOrderByePositions:mg({orderedSeedDrawPositions:g,relevantMatchUps:t}).slice(0,o),blockSeedOrderByePositions:mg({orderedSeedDrawPositions:I,relevantMatchUps:t}).slice(0,o),isLuckyStructure:d,positionedSeeds:m,isContainer:c,isFeedIn:u}}function mg({orderedSeedDrawPositions:e,relevantMatchUps:t}){let i=t.map((e=>e.drawPositions)).map((e=>null==e?void 0:e.sort(((e,t)=>e-t)))).filter((e=>(null==e?void 0:e[0])+1===(null==e?void 0:e[1])));return e.map((e=>i.find((t=>null==t?void 0:t.includes(e))))).filter(Boolean).map((t=>null==t?void 0:t.reduce(((t,i)=>e.includes(i)?t:i),void 0))).filter(Boolean)}function fg({provisionalPositioning:e,tournamentRecord:t,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:u,seedsOnly:d,event:c}){var p;l||({structure:l}=_u({drawDefinition:n,structureId:s})),s||(s=null==l?void 0:l.structureId);let m=!((null==l?void 0:l.structures)??(null==l?void 0:l.stage)===Ll),{byesCount:f,placedByes:h,relevantMatchUps:v}=function({provisionalPositioning:e,drawDefinition:t,matchUpsMap:i,structure:n,event:r}){var a;let{matchUps:o,roundMatchUps:s}=Zm({afterRecoveryTimes:!1,provisionalPositioning:e,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:n,event:r}),l=(null==s?void 0:s[1])||[],u=(null==n?void 0:n.structureType)===Jl,d=u?o:l,c=u?(null==(a=null==n?void 0:n.structures)?void 0:a.length)||0:o.length,{structureId:p,stage:m,stageSequence:f}=n,h=Mc({entryStatuses:wc,provisionalPositioning:e,drawDefinition:t,stageSequence:f,structureId:p,stage:m}),{qualifiersCount:v}=Ih({provisionalPositioning:e,drawDefinition:t,stageSequence:f,structureId:p,stage:m}),g=h.length+v,{positionAssignments:I,unassignedPositions:U}=Gu({structure:n}),y=null==U?void 0:U.map((e=>e.drawPosition)),S=null==I?void 0:I.filter((e=>e.bye)).length,w=null==I?void 0:I.filter((e=>e.bye)).map((e=>e.drawPosition)),T=d.map((e=>e.drawPositions)).filter((e=>null==e?void 0:e.reduce(((e,t)=>!(null!=w&&w.includes(t))&&e),!0))).flat(1/0).filter((e=>null==y?void 0:y.includes(e))),P=null==I?void 0:I.length,D=P?P-g:0;return D>c&&1===n.stageSequence&&n.stage!==_l&&(D=c),{placedByes:S,byesCount:D,relevantMatchUps:d,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:T}}({provisionalPositioning:e,drawDefinition:n,matchUpsMap:o,structure:l,event:c}),g=f-(h||0);if(g<=0)return{...Be};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:U,isLuckyStructure:y,isFeedIn:S}=pg({provisionalPositioning:e,relevantMatchUps:v,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:g,structure:l}),w=(null==l?void 0:l.structureType)&&[Jl,Kl].includes(l.structureType)&&(null==(p=null==i?void 0:i.seeding)?void 0:p.containerByesIgnoreSeeding),T=m&&null!=U&&U.length?U:I,{unseededByePositions:P}=function({provisionalPositioning:e,seedOrderByePositions:t,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:o,isFeedIn:s}){var l,u;let d,c=null==(l=null==n?void 0:n.seeding)?void 0:l.seedingProfile,p=o.stage===Ll,{positionAssignments:m}=Gu({structure:o}),f=null==m?void 0:m.filter((e=>e.participantId)).map((e=>e.drawPosition)),{matchUps:h,roundMatchUps:v}=Zm({provisionalPositioning:e,matchUpFilters:{isCollectionMatchUp:!1},structure:o}),g=(null==v?void 0:v[1])||[],I=o.structureType===Jl?h:g,U=hr([].concat(...I.map((e=>e.drawPositions)))),y=Math.min(...U)-1,S=null==f?void 0:f.filter((e=>U.includes(e))),w=e=>{let t=Math.ceil(e.length/2),i=[e.slice(0,t),e.slice(t)],n=i.map((e=>[].concat(...e.flat(1/0)).length)),r=Math.min(...n.flat(1/0)),a=Math.max(...n.flat(1/0)),o=n.indexOf(a),s=r!==a,l=gr(i),[u,d]=!r||s?[i[o],i[1-o]]:[l[0],l[1]];return{greaterHalf:u,lesserHalf:d}},T=e=>{let{greaterHalf:t,lesserHalf:i}=w(e),{greaterHalf:n,lesserHalf:r}=w(t),a=gr(n.flat(1/0)).pop();return{newlyFilteredChunks:[...i,...r,n.flat().filter((e=>e!==a))],drawPosition:a}},P=e=>!(null!=S&&S.includes(e)),D=e=>{let t=Or(e.sort(nr),Math.ceil(e.length/4)).map((e=>e.filter(P))),i=[].concat(...t.flat(1/0)).length,n=[];for(let r=0;r<i;r++){let{newlyFilteredChunks:e,drawPosition:i}=T(t);n.push(i),t=e}return n},{validSeedBlocks:b}=uv({provisionalPositioning:e,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:o}),M=null==b?void 0:b.map((e=>{var t;return null==(t=e.drawPositions)?void 0:t.map((e=>e+y))}));if(s){let e=U.length,{seedBlocks:t}=rv({cluster:mv(c)===zl,participantsCount:e});d=t.map((e=>e.map((e=>e+y)))).map(D).filter((e=>e.length))}else d=p?null==M?void 0:M.map((e=>e.filter(P))):null==M?void 0:M.map(D).filter((e=>e.length));let N=I.map((e=>e.drawPositions)).map((e=>null==e?void 0:e.sort(((e,t)=>e-t)))).filter((e=>(null==e?void 0:e[0])+1===(null==e?void 0:e[1]))),R=e=>N.reduce(((t,i)=>i.includes(e)?i.reduce(((t,i)=>i!==e?i:t),void 0):t),void 0),A=d.map((e=>e.map(R))).flat(1/0).filter(P).filter((e=>!t.includes(e))).filter(Boolean);if(p&&!o.structures){let e=a%4,t=A.slice(0,e),i=null==(u=v[o.roundLimit])?void 0:u.length,n=Or(A.slice(e),i).map(gr).flat();A=t.concat(n)}return{unseededByePositions:A}}({provisionalPositioning:e,seedOrderByePositions:T,isLuckyStructure:y,appliedPolicies:i,drawDefinition:n,seedLimit:u,structure:l,isFeedIn:S}),D=(e,t)=>(e||[]).every((e=>(e=>e%2)(e)?t!==e+1:t!==e-1)),b=[].concat(...T);if(!d)for(;P.length;){let e=P.find((e=>D(b,e)));e?(b.push(e),P=P.filter((t=>t!==e))):(b.push(...P),P=[])}w&&(b=gr(b),$r({ignoreSeededByes:w})&&console.log({byePositions:b}));let M=b.slice(0,g);for(let N of M){let i=qf({provisionalPositioning:e,tournamentRecord:t,drawDefinition:n,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:c});if(null!=i&&i.error)return i}return{...Be,unseededByePositions:P,byeDrawPositions:M}}function hg(e){var t,i,n,r;let{drawDefinition:a}=e,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:u=!0,tournamentRecord:d,placementGroup:c,seedingProfile:p,structureId:m,seedLimit:f,seedsOnly:h,drawType:v,drawSize:g,event:I}=e,U=[];o||(zr(),a=Wo(a,!1,!0));let y=e=>(o||Yr(),Sa({result:e,stack:"automatedPositioning"})),S=_u({drawDefinition:a,structureId:m});if(S.error)return y(S);let w=S.structure;if(!w)return{error:bt};let T=e.appliedPolicies||(null==(t=jc({drawDefinition:a,structure:w,event:I}))?void 0:t.appliedPolicies),{qualifiersCount:P}=Ih({stageSequence:w.stageSequence,provisionalPositioning:s,stage:w.stage,drawDefinition:a,structureId:m}),D=Sc;if(!(null!=(i=Mc({stageSequence:w.stageSequence,provisionalPositioning:s,stage:w.stage,placementGroup:c,drawDefinition:a,entryStatuses:D,structureId:m}))&&i.length||P))return b={...Be},o||Yr(),b;var b;let M=e.matchUpsMap??Wd({drawDefinition:a}),N=e.inContextDrawMatchUps??(null==(n=uf({inContext:!0,drawDefinition:a,matchUpsMap:M}))?void 0:n.matchUps),R=[],A=uv({provisionalPositioning:s,appliedPolicies:T,drawDefinition:a,seedingProfile:p,structure:w});if(A.error)return A;let{validSeedBlocks:E}=A;U.push({validSeedBlocks:E});let C=e.participants||(d?null==(r=vh({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:d}))?void 0:r.participants:[]);if(mv(w.seedingProfile||p)===Yl){let e=u?fg({provisionalPositioning:s,tournamentRecord:d,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:M,structure:w,seedLimit:f,seedsOnly:h,event:I}):void 0;if(null!=e&&e.error)return y(e);if(R=e.unseededByePositions,U.push({action:"positionByes",unseededByePositions:R}),e=lg({seedingProfile:w.seedingProfile?{positioning:w.seedingProfile}:p,provisionalPositioning:s,inContextDrawMatchUps:N,tournamentRecord:d,appliedPolicies:T,validSeedBlocks:E,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:M,structure:w,event:I}),e.error)return y(e);U.push({seedPositions:e.seedPositions,action:"positionSeedBlocks"})}else{if(v!==mu){let e=lg({seedingProfile:w.seedingProfile?{positioning:w.seedingProfile}:p,provisionalPositioning:s,inContextDrawMatchUps:N,tournamentRecord:d,appliedPolicies:T,validSeedBlocks:E,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:M,structure:w,event:I});if(e.error)return y(e);U.push({action:"positionSeedBlocks",seedPositions:e.seedPositions})}let e=u?fg({provisionalPositioning:s,tournamentRecord:d,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:M,structure:w,seedLimit:f,seedsOnly:h,event:I}):void 0;if(null!=e&&e.error)return y(e);R=null==e?void 0:e.unseededByePositions,U.push({action:"positionByes",byeDrawPositions:null==e?void 0:e.byeDrawPositions,unseededByePositions:R})}let O={};if(!h){let e=sg({inContextDrawMatchUps:N,tournamentRecord:d,appliedPolicies:T,validSeedBlocks:E,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:M,structure:w});if(e.error||(e.conflicts&&(O.qualifierConflicts=e.conflicts),U.push({action:"positionQualifiers",qualifierDrawPositions:e.qualifierDrawPositions}),e=og({provisionalPositioning:s,inContextDrawMatchUps:N,unseededByePositions:R,multipleStructures:l,tournamentRecord:d,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:M,structureId:m,structure:w,drawSize:g,event:I}),e.error))return y(e);e.conflicts&&(O.unseededConflicts=e.conflicts),U.push({action:"positionUnseededParticipants"})}let{positionAssignments:k}=Vu({drawDefinition:a,structure:w});return wd({drawDefinition:a,structureIds:[m]}),o||Yr(),{positionAssignments:k,conflicts:O,...Be,positioningReport:U}}function vg(e){var t;let{applyPositioning:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:u,event:d}=e;if(!d)return{error:Ct};if(!a)return{error:Qe};if(!qv({drawDefinition:a,structureId:s})&&!n)return{error:Xe};let c=null==(t=Vv({drawDefinition:a,structureId:s}).playoffStructures)?void 0:t.sort(((e,t)=>Lu(e)-Lu(t))),p=[],m=[];if(c)for(let f of c){let{structureId:e}=f,t=hg({structureId:e,provisionalPositioning:n,applyPositioning:i,tournamentRecord:r,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:u});if(t.error)return t;t.positionAssignments&&p.push({positionAssignments:t.positionAssignments,structureId:e}),t.positioningReport&&m.push(t.positioningReport)}return{...Be,structurePositionAssignments:p,positioningReports:m}}function gg({drawDefinition:e,orderMap:t}){return e?(("object"!=typeof t||!Object.values(t).every((e=>mr(e))))&&Sa({result:{error:Fn},context:{orderMap:t}}),e.structures||(e.structures=[]),e.structures.forEach((e=>{let i=t[e.structureId];i&&(e.structureOrder=i)})),e.structures.sort(((e,t)=>Ir(e.structureOrder)-Ir(t.structureOrder))),{...Be}):{error:Ke}}function Ig({drawDefinition:e}){var t,i,n,r,a,o,s;let l=e.structures??[],u=e.links??[],d=new Map,c=e=>{let t=d.get(e)||d.set(e,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&d.get(e);if(t&&(null==t||!t.stage)){let i=l.find((t=>t.structureId===e));t.stage=null==i?void 0:i.stage}return t},p={},m={},f=u.map((e=>{let t=e.source.structureId,i=e.target.structureId,n=c(t),r=c(i);return[eu,Xl,Zl,Yl].includes(e.target.feedProfile)?(null==n||n.targets.push(i),null==r||r.sources.push(t)):e.target.feedProfile===Ql&&(null==r||r.drawSources.push(t),null==n||n.drawTargets.push(i)),m[i]=m[i]||e.target.feedProfile===Ql,p[i]=hr([...p[i]||[],t]).filter(Boolean),[e.source.structureId,e.target.structureId]}));for(let w of d.keys()){let e=d.get(w);if(e){let o=e.targets??[];for(;o.length;){let i=o.pop(),n=i&&d[i];null!=(t=null==n?void 0:n.targets)&&t.length?o.push(...n.targets):n&&(e.rootStage=n.stage)}if(e.rootStage||(e.rootStage=e.stage),null==(i=e.targets)||!i.length){let t=e.sources??[];for(;t.length;){let i=t.pop(),o=i&&d[i];if(null!=(n=null==o?void 0:o.sources)&&n.length){for(let t of o.sources)null!=(r=e.progeny)&&r.includes(t)||null==(a=e.progeny)||a.push(t);t.push(...o.sources)}}}}}let h=0;for(let w of d.keys()){let e=d.get(w);if(e&&e.rootStage===Ll){let t=[null==(o=e.drawTargets)?void 0:o[0]],i=0;for(;t.length;){i+=1;let e=t.pop(),n=e?d.get(e):void 0;null!=(s=null==n?void 0:n.drawTargets)&&s.length&&t.push(n.drawTargets[0])}e.distanceFromMain=i,i>h&&(h=i)}}let v=f.length;br(0,Math.ceil(v/2)).forEach((()=>{f=br(0,v).map((e=>{let t=f[e],i=f.reduce(((e,i)=>Ar(t,i)?e.concat(...i):e),[])||[];return hr(t.concat(...i))}))}));let g=f[0],I=f.slice(1).reduce(((e,t)=>e&&((e,t)=>Nr(e,t).length===e.length)(t,g)),!0),U=[g].filter(Boolean),y=[g].filter(Boolean);l.forEach((e=>{let{structureId:t,stage:i}=e;U.find((e=>e.includes(t)))||(U.push([t]),i!==Bl&&y.push([t]))}));let S=I&&1===y.length;return!(null!=u&&u.length)&&1===l.length&&c(l[0].structureId),{structureProfiles:Object.fromEntries(d),allStructuresLinked:S,maxQualifyingDepth:h,sourceStructureIds:p,hasDrawFeedProfile:m,structureGroups:U}}function Ug({drawDefinition:e}){let{maxQualifyingDepth:t,structureProfiles:i}=Ig({drawDefinition:e});for(let n of e.structures){let e=i[n.structureId];e.distanceFromMain&&(n.stageSequence=t+1-e.distanceFromMain)}return{...Be}}function yg(e){var t;let{duplicateValues:i=!0,creationTime:n=!0,removePriorValues:r,timeItem:a,element:o}=e;if(!a)return{error:Sn};if(!o)return{error:mi,info:ds};let s=a&&Object.keys(a),l=["itemType","itemValue"];if(l.filter((e=>s.includes(e))).length!==l.length)return{error:Un};if(o.timeItems){let{itemType:e,itemSubTypes:n,itemValue:r}=a,s=e&&(null==(t=vf({itemSubTypes:n,itemType:e,element:o}))?void 0:t.timeItem);if(s&&JSON.stringify(null==s?void 0:s.itemValue)===JSON.stringify(r)&&!i)return{...Be}}else o.timeItems=[];if(a.itemSubTypes&&!a.itemSubTypes.length&&delete a.itemSubTypes,n){let e=(new Date).toISOString();Object.assign(a,{createdAt:e})}return r&&(o.timeItems=o.timeItems.filter((({itemType:e})=>a.itemType!==e))),r&&!a.itemValue||o.timeItems.push(a),{...Be}}function Sg({creationTime:e=!0,removePriorValues:t,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:We};if(!r)return{error:_i};let o=hf({tournamentRecord:i,participantId:r});return o.error?o:yg({element:o.participant,removePriorValues:t,duplicateValues:n,creationTime:e,timeItem:a})}function wg(e){let{removePriorValues:t,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=e;return i?yg({element:i,removePriorValues:t,duplicateValues:n,creationTime:r,timeItem:a}):{error:We}}function Tg(e){let{removePriorValues:t,duplicateValues:i,creationTime:n,timeItem:r,event:a}=e;return a?yg({removePriorValues:t,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Ct}}function Pg({tournamentRecord:e,drawDefinition:t,structure:i,link:n}){if(!e)return{error:We};if(!t)return{error:Ke};let r=function({drawDefinition:e,tournamentId:t,structure:i,eventId:n,link:r}){var a;if(!e)return{error:Ke};if(!i)return{error:Nt};if(!r)return{error:Tt};let o=r.target.structureId,s=_u({drawDefinition:e,structureId:o});if(s.error)return Sa({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:s});e.structures||(e.structures=[]),e.links||(e.links=[]),e.structures.push(i),e.links.push(r),Ug({drawDefinition:e});let l=(null==(a=Zm({structure:i}))?void 0:a.matchUps)||[];return Id({drawDefinition:e,tournamentId:t,matchUps:l,eventId:n}),wd({drawDefinition:e,structureIds:[i.structureId]}),{...Be}}({tournamentId:e.tournamentId,drawDefinition:t,structure:i,link:n});return r.error||wg({tournamentRecord:e,timeItem:{itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:t.drawId}}}),r}function Dg({drawDefinition:e,structureDetails:t}){if(!Array.isArray(t))return{error:Fn};if(!e)return{error:Ke};let i=Object.assign({},...t.map((e=>{if(!Ce(e))return;let{structureId:t,structureName:i}=e||{};return t&&i?{[t]:i}:void 0})).filter(Boolean));if(!Object.values(i).length)return{error:mi};for(let n of e.structures||[]){let e=i[n.structureId];e&&(n.structureName=e)}return{...Be}}function bg({drawDefinition:e,timeItem:t}){if(!e)return{error:Qe};if(!t)return{error:Sn};let i=t&&Object.keys(t),n=["itemType","itemValue"];if(n.filter((e=>i.includes(e))).length!==n.length)return{error:Un};e.timeItems||(e.timeItems=[]);let r=(new Date).toISOString();return Object.assign(t,{createdAt:r}),e.timeItems.push(t),Sd({drawDefinition:e}),{...Be}}function Mg(e){var t;let{tournamentRecord:i,drawDefinition:n,structureId:r,event:a}=e,o=io(e,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=n.structures??[],l=s.find((e=>e.structureId===r));if(!l)return{error:bt};let u=s.find((({stage:e,stageSequence:t})=>e===xl&&1===t)),d=r===(null==u?void 0:u.structureId),c=s.filter((({stage:e})=>e===Ll)).map($d("structureId"));if(d&&!c.length)return{error:Ge};let p=c.includes(r),m=function({isQualifyingStructure:e,tournamentRecord:t,drawDefinition:i,structureId:n,structure:r,event:a,force:o}){var s,l,u,d,c,p;let m=[n];if(e){let e=e=>{var t;return null==(t=i.links)?void 0:t.find((t=>t.target.structureId===e))},t=null==(s=e(n))?void 0:s.source.structureId;for(;t;)m.push(t),t=null==(l=e(t))?void 0:l.source.structureId}if(null!=(u=uf({matchUpFilters:{structureIds:m},drawDefinition:i}).matchUps)&&u.some((({score:e})=>kf({score:e})))){let e=null==(d=jc({tournamentRecord:t,drawDefinition:i,structure:r,event:a}))?void 0:d.appliedPolicies;if(!(o??(null==(p=null==(c=null==e?void 0:e[rs])?void 0:c.allowDeletionWithScoresPresent)?void 0:p.structures)))return{error:Qn}}return{...Be}}({isQualifyingStructure:p,structure:l,...e});if(null!=m&&m.error)return m;let{structureIdsToRemove:f,relatedStructureIdsMap:h}=function({qualifyingStructureIds:e,isQualifyingStructure:t,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let o=(r.structures??[]).map($d("structureId")),s=e=>{var t;return(null==(t=r.links)?void 0:t.map((t=>t.source.structureId===e&&t.target.structureId!==(null==n?void 0:n.structureId)&&t.target.structureId)).filter(Boolean))??[]},l=t=>{var i;return(null==(i=r.links)?void 0:i.map((i=>e.includes(i.source.structureId)&&i.target.structureId===t&&i.source.structureId)).filter(Boolean))??[]},u=new Map;return o.forEach((e=>u.set(e,t?l(e):s(e)))),{structureIdsToRemove:i?u.get(a):[a],relatedStructureIdsMap:u}}({qualifyingStructureIds:c,isQualifyingStructure:p,isMainStageSequence1:d,mainStageSequence1:u,drawDefinition:n,structureId:r}),{removedMatchUpIds:v,removedStructureIds:g}=function({relatedStructureIdsMap:e,qualifyingStructureIds:t,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;null!=a&&a.length;){let u=a.pop();l.push(...Ag({idBeingRemoved:u,drawDefinition:r}));let d=Rg({qualifyingStructureIds:t,isMainStageSequence1:i,idBeingRemoved:u,drawDefinition:r,structureId:o});s.push(...d.removedStructureIds);let c=Ng({relatedStructureIdsMap:e,mainStageSequence1:n,idBeingRemoved:u,structureId:o});null!=c&&c.length&&a.push(...c)}return{removedMatchUpIds:l,removedStructureIds:s}}({relatedStructureIdsMap:h,qualifyingStructureIds:c,isMainStageSequence1:d,mainStageSequence1:u,drawDefinition:n,structureIdsToRemove:f,structureId:r});if(function({removedMatchUpIds:e,drawDefinition:t}){let{matchUps:i}=uf({drawDefinition:t});null==i||i.forEach((t=>{t.winnerMatchUpId&&e.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,t.loserMatchUpId&&e.includes(t.loserMatchUpId)&&delete t.loserMatchUpId}))}({removedMatchUpIds:v,drawDefinition:n}),d){let e=null==(t=u.matchUps??[])?void 0:t.map($d("matchUpId"));v.push(...e),u.positionAssignments=[],u.seedAssignments=[],u.matchUps=[],u.extensions&&(u.extensions=[])}return p&&Ug({drawDefinition:n}),Ud({tournamentId:null==i?void 0:i.tournamentId,matchUpIds:v,action:"removeStructure",eventId:null==a?void 0:a.eventId,drawDefinition:n}),wd({drawDefinition:n,eventId:null==a?void 0:a.eventId}),{...Be,removedMatchUpIds:v,removedStructureIds:g}}function Ng({idBeingRemoved:e,relatedStructureIdsMap:t,mainStageSequence1:i,structureId:n}){var r;return e&&(null==(r=t.get(e))?void 0:r.filter((e=>e!==(null==i?void 0:i.structureId)||n===i.structureId)))}function Rg({qualifyingStructureIds:e,isMainStageSequence1:t,idBeingRemoved:i,drawDefinition:n,structureId:r}){var a;let o=[];return n.links=(null==(a=n.links)?void 0:a.filter((e=>e.source.structureId!==i&&e.target.structureId!==i)))??[],(!t||t&&e.length||i!==r)&&(n.structures=(n.structures??[]).filter((e=>(i&&i===e.structureId&&o.push(i),e.structureId!==i)))),{removedStructureIds:o}}function Ag({idBeingRemoved:e,drawDefinition:t}){let{structure:i}=_u({structureId:e,drawDefinition:t}),n=Zm({structure:i}).matchUps;return al(n)}function Eg({stageSequence:e=1,drawDefinition:t,drawSize:i,stage:n}){if(!t)return{error:Ke};if(!Dc({drawDefinition:t,stage:n}))return{error:_t};let r=function({stage:e,drawDefinition:t}){return Sc.reduce(((i,n)=>(bc({drawDefinition:t,entryStatus:n,stage:e})||0)+i),0)}({drawDefinition:t,stage:n}),{qualifiersCount:a}=Ih({drawDefinition:t,stageSequence:e,stage:n});if(i<r+a)return{error:ct};let{entryProfile:o}=rc({attributes:[{[n]:{drawSize:i}}],drawDefinition:t});return wd({drawDefinition:t}),{...Be,entryProfile:o}}function Cg({qualifiersCount:e=0,drawDefinition:t,stage:i}){return t?Dc({drawDefinition:t,stage:i})?i!==xl?{error:ct,info:"qualifiersCount can only be set for main stage"}:(rc({attributes:[{[i]:{qualifiersCount:e}}],drawDefinition:t}),wd({drawDefinition:t}),{...Be}):{error:_t}:{error:Ke}}function Og(e){return function({drawDefinition:e,drawSize:t}){if(!e)return{error:Ke};let i=Eg({stage:Bl,stageSequence:1,drawDefinition:e,drawSize:t});return i.error?i:(wd({drawDefinition:e}),{...Be})}(e)}function kg({tournamentRecord:e,drawDefinition:t,participantId:i,structureId:n}){var r;let a="removeSeededParticipant";if(!e)return{error:We};if(!t)return{error:Ke};let o=(t.structures??[]).find((e=>e.structureId===n));return o?!o.stage||![xl,Ll].includes(o.stage)||o.stage===xl&&1!==o.stageSequence?Sa({result:{error:Ze},stack:a}):null!=(r=o.seedAssignments)&&r.find((e=>e.participantId===i))?{...Be}:Sa({info:"participant not seeded",result:{error:Vn},context:{participantId:i}}):Sa({result:{error:bt},stack:a})}function Fg({targetEntryRound:e=1,finishingPositions:t,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=iu}){return n&&r?{link:ya({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:t},target:{feedProfile:Ql,roundNumber:e,structureId:r}})}:{error:Dt}}function xg({roundPosition:e,roundNumber:t,idPrefix:i,uuids:n}){return i?`${i}-${t}-${e}`:(null==n?void 0:n.pop())||am()}function Lg({includeMatchUpType:e,matchUpType:t,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let l=0,u=[],d=1,c=i-1,p=null==s?void 0:s.length;for(;l<(p||0);){let p=null==s?void 0:s[l],m=null==s?void 0:s[l+1];c&&(p.roundNumber=c),m&&c&&(m.roundNumber=c);let f={roundPosition:d,children:[p,m],matchUpId:xg({roundPosition:d,roundNumber:i,idPrefix:r,uuids:o})};u.push(f);let h={drawPositions:f.children.map((e=>null==e?void 0:e.drawPosition)).filter(Boolean),matchUpStatus:Dl,matchUpId:f.matchUpId,roundPosition:d,roundNumber:i};e&&t&&(h.matchUpType=t),a&&(h.isMock=!0),n.push(h),d++,l+=2}return{roundNodes:u,matchUps:n}}function _g({finishingPositionOffset:e,finishingPositionLimit:t,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:u}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!ar(s)||s%n)){let e=n;for(;e<s;)e*=2;s=e}let d=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!ar(s)&&!d)return{matchUps:[],roundsCount:0};let c,p=br(1,s+1).map((e=>({drawPosition:e}))),m=[],f=1;for(({roundNodes:c,matchUps:m}=Lg({matchUpType:r,roundNumber:f,idPrefix:o,matchUps:m,isMock:l,nodes:p,uuids:u})),f++,a=a??i;c.length>1;)n&&c.length===n&&(a=f-1),({roundNodes:c,matchUps:m}=Lg({nodes:c,matchUpType:r,roundNumber:f,idPrefix:o,matchUps:m,isMock:l,uuids:u})),f++;let h=f-1;return m=qd({finishingPositionOffset:e,finishingPositionLimit:t,roundsCount:h,roundLimit:a,matchUps:m}),a?m=m.filter((e=>a&&(e.roundNumber??0)<=a)):a=f-1,{drawSize:s,matchUps:m,roundsCount:h,roundLimit:a}}function Bg(e){var t,i,n,r,a,o;let s="generateQualifyingStructure";if(!e.drawDefinition)return Sa({result:{error:Ke},stack:s});if(e.drawSize&&!mr(e.drawSize)||e.participantsCount&&!mr(e.participantsCount)||e.qualifyingPositions&&!mr(e.qualifyingPositions))return Sa({result:{error:Fn},stack:s});let l=e.drawSize??sr(e.participantsCount),{qualifyingRoundNumber:u,qualifyingPositions:d,targetStructureId:c,structureOptions:p,appliedPolicies:m,drawDefinition:f,matchUpFormat:h,structureName:v,structureId:g,roundTarget:I,drawType:U,idPrefix:y,isMock:S,uuids:w}=e;if(!e.drawSize)return Sa({result:{error:pt},context:{drawSize:l},stack:s});if(d&&d>=e.drawSize)return Sa({result:{error:Fn},context:{drawSize:l,qualifyingPositions:d},stack:s});let T,P,D,b,M,N=0,{structureProfiles:R}=Ig({drawDefinition:f}),A=R[c];if(!A)return Sa({result:{error:bt},context:{targetStructureId:c},stack:s});let E=f.matchUpType,C=I?`${I}-`:"",O=A.stage===Ll,k=(null==(i=null==(t=null==m?void 0:m[Xo])?void 0:t.namingConventions)?void 0:i.pre)??(null==(r=null==(n=Am[Xo])?void 0:n.namingConventions)?void 0:r.pre),F=O&&k?`${k}-`:"",x=v??(C?`${F}${Yh(Ll)} ${C}`:`${F}${Yh(Ll)}`);if(U===Du){let{maxRoundNumber:e,structures:t,groupCount:i}=iv({structureName:v??x,structureId:g??(null==w?void 0:w.pop()),stage:Ll,structureOptions:p,appliedPolicies:m,stageSequence:1,matchUpType:E,roundTarget:I,idPrefix:y,drawSize:l,isMock:S,uuids:w});N=i,T=e,D=t[0],M=[1]}else({drawSize:l,matchUps:b,roundLimit:T,roundsCount:P}=_g({qualifyingRoundNumber:u,qualifyingPositions:d,matchUpType:E,idPrefix:y,drawSize:l,isMock:S,uuids:w})),T||(T=P),D=Jh({structureName:v??x,structureId:g??(null==w?void 0:w.pop()),qualifyingRoundNumber:T,stage:Ll,matchUpFormat:h,stageSequence:1,matchUpType:E,roundLimit:T,matchUps:b}),I&&fs({extension:{name:Gs,value:I},element:D}),N=null==(a=null==b?void 0:b.filter((e=>e.roundNumber===T)))?void 0:a.length;let L=U===Du?tu:iu,_=D&&T&&(null==(o=Fg({sourceStructureId:D.structureId,sourceRoundNumber:T,targetStructureId:c,finishingPositions:M,linkType:L}))?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:N,...Be,structure:D,link:_}}function jg(e){let t=e.tournamentRecord;if(!t)return{error:We};let i=function(e){if(!e.drawDefinition)return{error:Ke};if(!e.targetStructureId)return{error:Dt};let t=Bg(e);if(t.error)return t;let{structure:i,link:n}=t;return i&&n?Pg({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,structure:i,link:n}):{error:Fn}}(e);if(i.error)return i;let{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:l,drawSize:u,drawType:d}=e;return wg({tournamentRecord:t,timeItem:{itemType:"addQualifyingStructures",itemValue:ya({drawId:o.drawId,qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureName:s,matchUpType:l,drawSize:u,drawType:d})}}),i}function Vg({includeMatchUpType:e,drawPosition:t,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:o,uuids:s,nodes:l,fed:u}){let d=l.length,c=t?t-d:void 0,p=br(0,d).map((e=>c?c+e:void 0)),m=[];for(let f=0;f<d;f++){let t=p.shift(),d={drawPosition:t,fed:u+1,feed:!0},c=l[f];c.roundNumber=i-1;let h=xg({roundPosition:c.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),v={roundPosition:c.roundPosition,drawPositions:[t],matchUpStatus:Dl,roundNumber:i,matchUpId:h};e&&(v.matchUpType=n),o&&(v.isMock=!0),a.push(v);let g={children:[c,d]};m.push(g)}return{roundNodes:m,matchUps:a,drawPosition:t?t-d:void 0}}function Gg(e){let t=e.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=e,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:u,isConsolation:d,matchUpType:c,idPrefix:p,isMock:m,uuids:f,fmlc:h}=e;a=a??function(e){let t=lr(e);return t>e?t/2:t}(t);let v=function({drawSize:e}){let t=Math.ceil(Math.log(e)/Math.log(2));return br(0,t).reverse().map((e=>Math.pow(2,e)))}({drawSize:a}),g=v.length,I=0;if(null!=i&&i.length)I=i.reduce(((e,t)=>e+t),0);else if(t){let e=t-a;i=v.filter((t=>t<=e&&(e-=t,!0))),I=i.reduce(((e,t)=>e+t),0),n=i.length}else r>=g?n=0:u&&(n=g-u,r=0),i=v.filter(((e,t)=>u&&!n||n&&t>=r+n||t<r?0:e)),I=i.reduce(((e,t)=>e+t),0),n=i.length;let U=[...v,...i].sort(((e,t)=>t-e)),y=U.length,S=[...(l??[]).map((e=>e-1)),...(o??[]).map((e=>y-e))].map((e=>U[e])).reduce(((e,t)=>e+t),0);I-=S;let w,T=0,P=[],D=1,b=br(0,a).map(((e,t)=>({drawPosition:t+1+I}))),M=I+1;for(let R of v){if(({roundNodes:w,matchUps:P}=Lg({matchUpType:c,roundNumber:D,idPrefix:p,matchUps:P,isMock:m,nodes:b,uuids:f})),D++,i.includes(R)){let e=br(0,Ur(i)[R]),t=y+1-D,n=(null==o?void 0:o.includes(t))??(null==l?void 0:l.includes(D));e.forEach((()=>{({roundNodes:w,matchUps:P,drawPosition:M}=Vg({drawPosition:!n&&M||void 0,nodes:w,matchUpType:c,roundNumber:D,idPrefix:p,matchUps:P,isMock:m,uuids:f,fed:T})),D++,T+=1}))}b=w}y!==D-1&&console.log("ERROR"),P=qd({finishingPositionOffset:d?a-I:s,positionsFed:I,roundsCount:y,matchUps:P,fmlc:h});let N=null!=w&&w.length?w[0]:w;return N&&(N.roundNumber=D-1,N.matchUps=P),{draw:N,matchUps:P,roundsCount:y}}function $g(e){let{finishingPositionOffset:t=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:u,roundOffsetLimit:d,roundOffset:c=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:f,stage:h=xl,drawSize:v,idPrefix:g,isMock:I,uuids:U}=e;if(o&&u&&(null==o||!o[l])||v<2||f&&s>f)return{};let y=[],S=[],w=[],T=e.matchUpType??(null==p?void 0:p.matchUpType),P=t+1,D=`${P}-${t+v}`,b=null==o?void 0:o[l],M=n&&`${n} `||"",N=(null==o?void 0:o[D])??(null==r?void 0:r[D]),R=e.structureName||(null==N?void 0:N.name)||(null==b?void 0:b.name)&&(i?`${M}${null==b?void 0:b.name}`:b.name)||`${M}${D}`,A=(null==N?void 0:N.abbreviation)??(null==b?void 0:b.abbreviation),E=e.structureId??(null==b?void 0:b.structureId)??(null==U?void 0:U.pop()),C={idPrefix:g&&`${g}-${R}-RP`,finishingPositionOffset:t,matchUpType:T,drawSize:v,isMock:I,uuids:U},{matchUps:O}=m?Gg(C):_g(C),k=Jh({structureAbbreviation:A,stageSequence:s,structureName:R,matchUpType:T,roundOffset:c,structureId:E,matchUps:O,stage:h});y.push(...O),S.push(k);let F=Math.ceil(Math.log(v)/Math.log(2)),x=d?Math.min(d-c,F):!a||P<a?F:0;return v>2&&br(1,x+1).forEach((e=>function(e){let m=v/Math.pow(2,e);if(m<2)return;let I=v/Math.pow(2,e)+t;if(a&&I+1>a)return;let{structures:P,structureId:D,matchUps:b,links:M}=$g({finishingPositionOffset:I,exitProfile:`${l}-${e}`,roundOffset:c+e,stageSequence:s+1,drawSize:m,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:d,drawDefinition:p,sequenceLimit:f,matchUpType:T,idPrefix:g,uuids:U,stage:h});if(k.structureId&&D){let t={linkType:nu,source:{roundNumber:e,structureId:k.structureId},target:{roundNumber:1,feedProfile:Xl,structureId:D}};M&&k&&M.push(t),null!=M&&M.length&&w.push(...M)}return null!=P&&P.length&&S.push(...P),null!=b&&b.length&&y.push(...b),{structureId:D,childLinks:M,structures:S}}(e))),{structureId:k.structureId,matchUps:y,structureName:R,structures:S,links:w,...Be}}function qg({drawDefinition:e,matchUpsMap:t,structureId:i}){let n=_u({drawDefinition:e,structureId:i});if(n.error)return Sa({result:n});let{matchUps:r}=Zm({structure:n.structure,matchUpsMap:t});return{...jd({matchUps:r}),matchUps:r,matchUpsMap:t}}function Wg({finishingPositions:e,drawDefinition:t,structureId:i}){var n;let{roundProfile:r}=qg({drawDefinition:t,structureId:i});return null==(n=r&&Object.keys(r))?void 0:n.reduce(((t,i)=>(Hg(null==r?void 0:r[i]).forEach((n=>{e.forEach((e=>{(function({position:e,rangeDefinition:t}){if(!Array.isArray(t)||t.reduce(((e,t)=>e||isNaN(t)),!1))return!1;let[i,n]=t;return br(i,(n||i)+1).includes(e)})({position:e,rangeDefinition:n})&&(t[e]={roundNumber:i})}))})),t)),{})}function Hg(e){var t,i;return[hr((null==(t=null==e?void 0:e.finishingPositionRange)?void 0:t.loser)||[]),hr((null==(i=null==e?void 0:e.finishingPositionRange)?void 0:i.winner)||[])]}function zg(e){return Hg(e).map((e=>br(e[0],e[1]&&e[1]+1||e[0]+1)))}function Yg({drawDefinition:e,structureIds:t,matchUpsMap:i}){if(t&&!Array.isArray(t))return{error:Fn,context:{structureIds:t}};if(!e)return{error:Ke};let n=(t=t??(e.structures??[]).filter((e=>e.stage!==Ll)).map((({structureId:e})=>e))).map((t=>{var n;let{roundProfile:r}=qg({drawDefinition:e,matchUpsMap:i,structureId:t});return null==(n=r&&Object.values(r))?void 0:n.map(zg).flat()})).flat(),r=n.filter((e=>1===(null==e?void 0:e.length))).sort(nr).flat();return{positionsNotPlayedOff:hr(n.flat()).filter((e=>!r.includes(e))),positionsPlayedOff:r}}function Kg({excludeRoundNumbers:e=[],playoffPositions:t=[],drawDefinition:i,structureId:n}){if(!i)return{error:Ke};if(!n)return{error:Dt};if(!t)return{error:mi,info:"missing playoffPositions"};let r=Yg({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,o=Wg({finishingPositions:t.filter((e=>!a.includes(e))),drawDefinition:i,structureId:n}),s=Object.values(o).reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>rr(e))).filter((t=>!e.includes(t))),l=Wg({finishingPositions:a,drawDefinition:i,structureId:n}),u=l?Object.values(l):[],d=l?u.reduce(((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber)),[]).map((e=>rr(e))):[],c=s.filter((e=>!d.includes(e))).sort(nr),{roundProfile:p}=qg({drawDefinition:i,structureId:n}),m=c.map((e=>{let t=null==p?void 0:p[e].finishingPositionRange.loser,[i,n]=t??[0,0];return br(i,(n||i)+1)})).flat().sort(nr),{playoffRoundsRanges:f}=function({playoffSourceRounds:e,roundProfile:t}){return{playoffRoundsRanges:e.map((e=>{let i=t[e].finishingPositionRange.loser,[n,r]=i,a=br(n,(r||n)+1);return{finishingPositionRange:i.join("-"),finishingPositions:a,roundNumber:e}}))}}({playoffSourceRounds:c,roundProfile:p}),h=[...c,...d];return{playoffPositionsReturned:m,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:c,sourceRounds:h,roundProfile:p}}function Jg({drawDefinition:e,structureId:t}){if(!e)return{error:Ke};let{matchUps:i,matchUpsMap:n}=Cf({inContext:!0,drawDefinition:e}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=Yg({drawDefinition:e,matchUpsMap:n}),{structures:o}=Bu({drawDefinition:e}),s=o.filter((e=>!t&&e.stage!==Bl||e.structureId===t)),l={};for(let u of s){let t=null==u?void 0:u.structureId,n=Qg({playoffPositions:r,drawDefinition:e,structure:u,matchUps:i}),{error:a,...o}=n;if(a)return n;l[t]={structureId:t,...o}}return t?{positionsPlayedOff:a,...l[t]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function Qg({playoffPositions:e,drawDefinition:t,structure:i,matchUps:n}){var r,a,o,s,l,u,d,c,p;let m=null==i?void 0:i.structureId,{links:f}=nf({drawDefinition:t,structureId:m});if(i.structureType===Jl||i.structures){let e=null==(a=null==(r=Vu({structure:i}))?void 0:r.positionAssignments)?void 0:a.length,u=i.structures.length,d=(e??0)/u,c=(null==(o=f.source)?void 0:o.flatMap((({source:e})=>(null==e?void 0:e.finishingPositions)||[])))||[],p=br(1,d+1).filter((e=>!c.includes(e))),h=(null==(l=null==(s=n.find((e=>e.containerStructureId===m&&e.finishingPositionRange)))?void 0:s.finishingPositionRange)?void 0:l.winner)||[0,1],v=null==f?void 0:f.source.map((({target:e})=>e.structureId)),{positionsPlayedOff:g=[],positionsNotPlayedOff:I=[]}=Yg({structureIds:v,drawDefinition:t}),U=[...g,...I],y=br(h[0],h[1]+1).filter((e=>!U.includes(e))),S=Or(y,y.length/p.length);return{positionsNotPlayedOff:y,playoffFinishingPositionRanges:p.map(((e,t)=>{let i=S[t];return{finishingPosition:e,finishingPositions:i,finishingPositionRange:[Math.min(...i||[]),Math.max(...i||[])].join("-")}})),finishingPositionsAvailable:p,finishingPositionsPlayedOff:c,positionsPlayedOff:g,groupCount:u,groupSize:d}}let h=(null==(u=null==f?void 0:f.source)?void 0:u.filter((e=>e.linkCondition!==ru)).map((e=>{var t;return null==(t=e.source)?void 0:t.roundNumber})))||[],v=(null==(d=null==f?void 0:f.source)?void 0:d.filter((e=>e.linkCondition===ru)).map((e=>{var t;return null==(t=e.source)?void 0:t.roundNumber})))||[],g=Kg({excludeRoundNumbers:h,playoffPositions:e,drawDefinition:t,structureId:m}),I=null!=g&&g.playoffSourceRounds?[...(null==g?void 0:g.playoffSourceRounds)||[]]:void 0,U=[...(null==g?void 0:g.playoffRoundsRanges)||[]],{roundProfile:y,error:S}=g;for(let w of v){let e=null==f?void 0:f.source.find((e=>e.source.roundNumber===w)),t=null==e?void 0:e.target.roundNumber,i=null==e?void 0:e.target.structureId,r=n.filter((({roundNumber:e,structureId:n})=>n===i&&e===t)),a=r.filter((({sides:e})=>e.find((e=>e.participantFed&&!e.participantId)))).length;if(I&&a===r.length){I.push(w);let e=null==(p=null==(c=null==y?void 0:y[w])?void 0:c.finishingPositionRange)?void 0:p.loser;if(e){let t=Math.min(...e),i=t+a,n=br(t,i),r={finishingPositionRange:[t,i-1].join("-"),finishingPositions:n,roundNumber:w};U.push(r)}}}return I&&I.sort(nr),U.sort(((e,t)=>e.roundNumber-t.roundNumber)),{playoffRounds:I,playoffRoundsRanges:U,error:S}}function Zg(e){var t,i;let{finishingPositionOffset:n=0,playoffAttributes:r,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=xl,matchUpType:u,structureId:d,idPrefix:c,drawSize:p,isMock:m,uuids:f}=e,h={finishingPositionOffset:n,matchUpType:u,drawSize:p,idPrefix:c,isMock:m,uuids:f},{matchUps:v}=o?Gg(h):_g(h),g=Jh({structureName:s||(null==(t=null==r?void 0:r[0])?void 0:t.name)||Yh(xl),structureId:d||(null==f?void 0:f.pop()),stageSequence:a,matchUpType:u,matchUps:v,stage:l}),I=[g],U=[];if(p>2){let t=p/2,{matchUps:a}=_g({finishingPositionOffset:n+t,idPrefix:c&&`${c}-c`,drawSize:t,matchUpType:u,isMock:m}),o=Yh(_l),l=(null==(i=null==r?void 0:r["0-1"])?void 0:i.name)??e.consolationStructureName??(s?`${s} ${o}`:o),d=Jh({structureName:l,matchUps:a,structureId:null==f?void 0:f.pop(),stage:_l,stageSequence:1,matchUpType:u});I.push(d);let h={linkType:nu,source:{roundNumber:1,structureId:g.structureId},target:{roundNumber:1,feedProfile:Xl,structureId:d.structureId}};U.push(h)}return{...Be,structures:I,links:U}}function Xg({consolationStructure:e,roundOffset:t=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let o=e.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),s=(null==r?void 0:r.roundGroupedOrder)||[],l=null==r?void 0:r.roundFeedProfiles;return br(1+t,n+1+t).map((n=>{let r=l&&l[n-1]?l[n-1]:n%2?Xl:eu,u=n-t<=2?n-t:2*(n-t-2)+2,d={linkType:nu,source:{roundNumber:n,structureId:i.structureId},target:{feedProfile:r,roundNumber:u,structureId:e.structureId}},c=s[n-1];return c&&(d.target.groupedOrder=c),$r()&&(d.source.structureName=i.structureName,d.target.structureName=e.structureName),2===n&&a&&(d.linkCondition=ru,d.target.feedProfile=Xl),o.includes(u)?d:void 0})).filter(Boolean)}function eI(e){var t,i;let{playoffStructureNameBase:n,finishingPositionOffset:r,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:u=xl,matchUpType:d,structureId:c,drawSize:p,idPrefix:m,isMock:f,uuids:h}=e,v={finishingPositionOffset:r,matchUpType:d,drawSize:p,idPrefix:m,isMock:f,uuids:h},{matchUps:g,roundsCount:I}=l?Gg(v):_g(v),U=e.structureName??(null==(t=null==o?void 0:o[0])?void 0:t.name)??Yh(xl),y=Kh({structureId:c||(null==h?void 0:h.pop()),structureName:U,stageSequence:a,matchUpType:d,matchUps:g,stage:u}),S=[y],w=[];if(p>2){let e=[0,2].slice(0,p/16).map(((e,t)=>{let i=t+1,{consolationStructure:r}=function({playoffStructureNameBase:e,stageSequence:t=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:u,index:d,uuids:c}){var p,m;let f=l/(2*Math.pow(2,r)),{matchUps:h,roundsCount:v}=Gg({finishingPositionOffset:f,baseDrawSize:f,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:c}),g=0===d&&(null==(p=null==i?void 0:i["0-1"])?void 0:p.name)||1===d&&(null==(m=null==i?void 0:i["0-3"])?void 0:m.name)||`${Yh(_l)} ${d+1}`,I=(null==n?void 0:n[g])||g,U=e?`${e} ${I}`:I;return{consolationStructure:Kh({matchUps:h,stage:_l,structureName:U,stageSequence:t,matchUpType:a,structureId:o}),consolationRoundsCount:v}}({idPrefix:m&&`${m}-c${t}`,structureId:null==h?void 0:h.pop(),playoffStructureNameBase:n,playoffAttributes:o,structureNameMap:s,stageSequence:i,roundOffset:e,matchUpType:d,drawSize:p,isMock:f,index:t,uuids:h});return S.push(r),{consolationStructure:r,links:Xg({consolationStructure:r,roundsCount:2,mainStructure:y,roundOffset:e})}})).map((e=>e.links)).flat();if(w.push(...e),p>=4&&p<=16||p>32){let{matchUps:e}=_g({idPrefix:m&&`${m}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:d,isMock:f}),t=(null==(i=null==o?void 0:o["3-4"])?void 0:i.name)??Yh(jl),r=(null==s?void 0:s[t])||t,a=n?`${n} ${r}`:r,l=Kh({structureId:null==h?void 0:h.pop(),matchUps:e,stageSequence:2,stage:jl,structureName:a,matchUpType:d}),u={linkType:nu,source:{roundNumber:I-1,structureId:y.structureId},target:{structureId:l.structureId,feedProfile:Xl,roundNumber:1}};S.push(l),w.push(u)}}return{structures:S,links:w,...Be}}function tI(e){var t,i,n,r;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:u,structureName:d,stage:c=xl,structureId:p,matchUpType:m,skipRounds:f,feedRounds:h,idPrefix:v,drawSize:g,isMock:I,uuids:U,fmlc:y}=e,S=e.feedPolicy||(null==(t=e.policyDefinitions)?void 0:t[os])||(null==(i=e.appliedPolicies)?void 0:i[os]),w={finishingPositionOffset:a,matchUpType:m,skipRounds:f,drawSize:g,idPrefix:v,isMock:I,uuids:U},{matchUps:T}=u?Gg(w):_g(w),P=Jh({structureName:d||(null==(n=null==s?void 0:s[0])?void 0:n.name)||Yh(xl),structureId:p||(null==U?void 0:U.pop()),stageSequence:o,matchUpType:m,matchUps:T,stage:c}),D=[P],b=[],M=g/2,{matchUps:N,roundsCount:R}=Gg({finishingPositionOffset:M,idPrefix:v&&`${v}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:M,matchUpType:m,feedRounds:h,skipRounds:f,isMock:I,uuids:U,fmlc:y});if(g>2){let t=(null==(r=null==s?void 0:s["0-1"])?void 0:r.name)??Yh(_l),i=e.playoffStructureNameBase?`${e.playoffStructureNameBase} ${t}`:t,n=Jh({matchUps:N,structureId:null==U?void 0:U.pop(),stage:_l,stageSequence:1,structureName:i,matchUpType:m});D.push(n);let a=Xg({consolationStructure:n,mainStructure:P,roundsCount:R,feedPolicy:S,fmlc:y});b.push(...a)}return{...Be,structures:D,links:b}}function iI({requireSequential:e=!0,playoffMatchUpFormat:t,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:u,groupCount:d,idPrefix:c,isMock:p,uuids:m}){var f,h,v,g,I,U;u=u||(null==r?void 0:r[os]);let y="processPlayoffGroups",S=0,w=[],T=[],P=[],{error:D,positionRangeMap:b}=function({playoffGroups:e,drawDefinition:t,structureId:i}){var n,r;if(!t)return{error:Ke};if("string"!=typeof i||!Array.isArray(e))return{error:Fn};let a=e.map((({finishingPositions:e})=>e)).flat();return{positionRangeMap:null==(r=null==(n=Jg({drawDefinition:t,structureId:i}).playoffFinishingPositionRanges)?void 0:n.filter((e=>a.includes(e.finishingPosition))))?void 0:r.reduce(((e,t)=>(e[t.finishingPosition]=t,e)),{})}}({structureId:n,drawDefinition:o,playoffGroups:s});if(D)return Sa({result:{error:D},stack:y});if(b&&(null==s||!s.every((t=>{let{finishingPositions:i=[]}=t;if(!i.length)return!1;let n=[...i].sort(nr).map(((e,t)=>(i[t+1]||e)-e)).every((e=>e<2));return(!e||n)&&i.every((e=>b[e]))}))))return Sa({context:{validFinishingPositions:Object.values(b)},result:{error:Fn},stack:y});for(let M of s){let e=M.finishingPositions,o=b&&e.map((e=>{var t;return null==(t=b[e])?void 0:t.finishingPositions})).flat(),s=d*e.length,y=cr(s),D=2===y&&uu||M.drawType||uu;o&&(S=Math.min(...o)-1);let N=o&&`${Math.min(...o)}-${Math.max(...o)}`,R=M.structureName||N&&(null==(h=null==(f=M.playoffAttributes)?void 0:f[N])?void 0:h.name)||(null==(g=null==(v=M.playoffAttributes)?void 0:v[0])?void 0:g.name),A={addNameBaseToAttributeName:M.addNameBaseToAttributeName,playoffStructureNameBase:M.playoffStructureNameBase,finishingPositionNaming:M.finishingPositionNaming,finishingPositionLimit:M.finishingPositionLimit,structureId:M.structureId??(null==m?void 0:m.pop()),playoffAttributes:M.playoffAttributes,structureNameMap:M.structureNameMap,sequenceLimit:M.sequenceLimit,structureName:R,idPrefix:c&&`${c}-po`,appliedPolicies:r,finishingPositionOffset:S,stage:jl,stageSequence:a,matchUpType:l,drawSize:y,isMock:p,uuids:m},E=({playoffStructures:t,playoffLinks:i})=>{let[r]=t,a=nI({playoffStructureId:r.structureId,finishingPositions:e,sourceStructureId:n});P.push(a),P.push(...i),T.push(...t),w.push({structureId:r.structureId,finishingPositions:e}),S+=s};if(D===uu){let{matchUps:i}=_g({finishingPositionLimit:S+s,idPrefix:c&&`${c}-po`,finishingPositionOffset:S,matchUpType:l,drawSize:y,isMock:p,uuids:m}),r=Jh({structureId:M.structureId??(null==m?void 0:m.pop()),matchUpFormat:t,stage:jl,structureName:R,stageSequence:a,matchUps:i});T.push(r);let o=nI({playoffStructureId:r.structureId,finishingPositions:e,sourceStructureId:n});P.push(o),S+=s,w.push({structureId:r.structureId,finishingPositions:e})}else if([su,lu,jl].includes(D)){let t={playoffAttributes:M.playoffAttributes??i,playoffStructureNameBase:M.playoffStructureNameBase,structureId:M.structureId??(null==m?void 0:m.pop()),structureName:M.structureName,idPrefix:c&&`${c}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:S,stage:jl,roundOffset:0,stageSequence:a,drawSize:y,isMock:p,uuids:m};D===su?Object.assign(t,{playoffAttributes:(null==M?void 0:M.playoffAttributes)??i??Ru,roundOffsetLimit:3}):D===lu&&Object.assign(t,{playoffAttributes:(null==M?void 0:M.playoffAttributes)??i??Au,roundOffsetLimit:2});let r=$g(t);if(r.error)return r;if(null!=(I=r.links)&&I.length&&P.push(...r.links),null!=(U=r.structures)&&U.length&&T.push(...r.structures),T.sort(xu),r.structureId){let t=nI({playoffStructureId:r.structureId,finishingPositions:e,sourceStructureId:n});P.push(t),w.push({structureId:r.structureId,finishingPositions:e})}S+=s}else if([cu,Pu,Su,Uu,gu,Tu].includes(D)){let t=[null==m?void 0:m.pop(),null==m?void 0:m.pop()],i={playoffStructureNameBase:M.playoffStructureNameBase,structureId:M.structureId??(null==m?void 0:m.pop()),playoffAttributes:M.playoffAttributes,idPrefix:c&&`${c}-po`,finishingPositionOffset:S,uuids:t,stage:jl,structureName:R,matchUpType:l,feedPolicy:u,drawSize:y,isMock:p},r={[cu]:{fmlc:!0,feedRounds:1},[Tu]:{feedRounds:1},[Su]:{feedsFromFinal:3},[Uu]:{feedsFromFinal:2},[gu]:{feedsFromFinal:1}};Object.assign(i,r[D]||{});let{structures:a,links:o}=tI(i),[d]=a,f=nI({playoffStructureId:d.structureId,finishingPositions:e,sourceStructureId:n});P.push(f),P.push(...o),T.push(...a),w.push({structureId:d.structureId,finishingPositions:e}),S+=s}else if([Du].includes(D)){let{structures:e,links:t}=iv({...A,structureOptions:M.structureOptions||{groupSize:4}});E({playoffStructures:e,playoffLinks:t})}else if([pu].includes(D)){let{structures:e,links:t}=Zg(A);E({playoffStructures:e,playoffLinks:t})}else if([hu].includes(D)){let{structures:e,links:t}=eI(A);E({playoffStructures:e,playoffLinks:t})}else if([au].includes(D)){E({playoffStructures:[Jh({structureId:M.structureId??(null==m?void 0:m.pop()),structureName:M.structureName,finishingPosition:kc,stage:jl,stageSequence:a,matchUps:[]})],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:b,structures:T,links:P}}function nI({playoffStructureId:e,finishingPositions:t,sourceStructureId:i}){return{linkType:tu,source:{structureId:i,finishingPositions:t},target:{structureId:e,feedProfile:Ql,roundNumber:1}}}function rI({matchUp:e,tieFormat:t,isMock:i,uuids:n}){let{collectionDefinitions:r}=t??{};return{tieMatchUps:(r??[]).map((t=>aI({matchUp:e,collectionDefinition:t,uuids:n,isMock:i}))).filter(Boolean).flat()}}function aI({collectionPositionOffset:e=0,collectionDefinition:t,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:u}=t||{},d=e=>{if(!(r||null!=n&&n.isMock))return(null==a?void 0:a.pop())??am();let i=null==t?void 0:t.collectionId;return(null==a?void 0:a.pop())??`${null==n?void 0:n.matchUpId}-${i}-TMU-${e+1}`};return br(0,i??o??0).map((t=>{let i=e+t+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(t),matchUpStatus:Dl,collectionPosition:i,collectionId:l,processCodes:u,matchUpType:s,isMock:r}}))}var oI="SET3-S:6/TB7",sI="SET3-S:6/TB7-F:TB10",lI={FORMAT_STANDARD:oI,FORMAT_STANDARD_NOAD:"SET3-S:6NOAD",FORMAT_ATP_DOUBLES:sI,FORMAT_SHORT_SETS:"SET3-S:4/TB7",FORMAT_FAST4:"SET3-S:4/TB5@3",FORMAT_PRO_SET:"SET1-S:8/TB7",FORMAT_COLLEGE_PRO_SET:"SET1-S:8/TB7@7",TIMED20:"SET1-S:T20"};function uI({winningSide:e,matchUpFormat:t=oI,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],o=null==r?void 0:r.sets,s="number"==typeof e&&e-1,l=xm(t),u=pI((null==l?void 0:l.bestOf)??1);if("number"==typeof s&&(i===gl&&null!=n&&n.setsCreditForDefaults||i===bl&&null!=n&&n.setsCreditForWalkovers))a[s]=u;else for(let d of o||[]){let{winningSide:e}=d;e&&(a[e-1]+=1)}return"number"==typeof s&&i===Tl&&(+a[1-s]===u&&(a[1-s]-=1),null!=n&&n.setsCreditForRetirements&&(a[s]=u)),a}function dI({matchUpFormat:e=oI,winningSide:t,matchUpStatus:i,tallyPolicy:n,score:r}){var a,o;let{sets:s}=r||{};if(!s)return[0,0];let l="number"==typeof t&&t-1,u=xm(e),d=pI((null==u?void 0:u.bestOf)??1),c=(null==(a=null==u?void 0:u.setFormat)?void 0:a.tiebreakAt)||0,p=[[],[]];if("number"==typeof l&&(i===gl&&null!=n&&n.gamesCreditForDefaults||i===bl&&null!=n&&n.gamesCreditForWalkovers)){let e=(null==(o=null==u?void 0:u.setFormat)?void 0:o.setTo)||0,t=d*e;p[l].push(t)}else s.forEach(((e,t)=>{var i;let r=(e.setNumber||t+1)>d&&null!=u&&u.finalSetFormat?"finalSetFormat":"setFormat",a=null==(i=null==u?void 0:u[r])?void 0:i.based,o=null==u?void 0:u[r].tiebreakSet,{side1Score:s,side2Score:l}=e;fI(a)&&(p[0].push(rr(s||0)),p[1].push(rr(l||0))),o&&e.winningSide&&!1!==(null==n?void 0:n.gamesCreditForTiebreakSets)&&p[e.winningSide-1].push(1)}));if(i===Tl&&"number"==typeof l){let r=s.length>d&&null!=u&&u.finalSetFormat?"finalSetFormat":"setFormat",a=null==u?void 0:u[r];if(fI(a.based)){let r=(null==a?void 0:a.setTo)||0,o=e=>{if(u&&""!==e)return+e==c-1||+e===c?rr(c||0)+1:+e<c?r:c},m=uI({winningSide:t,score:{sets:s},matchUpStatus:i,matchUpFormat:e,tallyPolicy:n});if(p.map((e=>e[l]<=e[1-l])).reduce(((e,t)=>e+(t?1:0)),0)>m[1-l]){let e=p[l].length,t=o(p[1-l][e-1]);t&&(p[l][e-1]=t)}d>p[l].length&&null!=n&&n.gamesCreditForRetirements&&p[l].push(r)}}return[p[0].reduce(((e,t)=>e+t),0),p[1].reduce(((e,t)=>e+t),0)]}function cI({matchUpFormat:e,score:t}){var i;let n=e?xm(e):void 0,r=pI((null==n?void 0:n.bestOf)??1),a=[0,0],o=[0,0];return null==(i=null==t?void 0:t.sets)||i.forEach(((e,t)=>{var i;let s=(e.setNumber||t+1)>r&&null!=n&&n.finalSetFormat?"finalSetFormat":"setFormat";if(mI(null==(i=null==n?void 0:n[s])?void 0:i.based)){let{side1Score:t,side2Score:i}=e;t&&(o[0]+=rr(t||0)),i&&(o[1]+=rr(i||0))}else e.side1TiebreakScore&&(o[0]+=rr(e.side1TiebreakScore||0)),e.side2TiebreakScore&&(o[1]+=rr(e.side2TiebreakScore||0)),(e.side1TiebreakScore||e.side2TiebreakScore)&&e.winningSide&&(a[e.winningSide-1]+=1)})),{pointsTally:o,tiebreaksTally:a}}function pI(e){return e&&Math.ceil(e/2)||1}function mI(e){return"P"===e}function fI(e){return!mI(e)}function hI({participantIds:e,matchUpFormat:t,tallyPolicy:i,perPlayer:n,matchUps:r}){var a,o,s,l,u,d,c;let p={},m=(null==i?void 0:i.excludeMatchUpStatuses)||[],f=null==r?void 0:r.filter((t=>(t.tieMatchUps||!m.includes(t.matchUpStatus))&&(!(null!=e&&e.length)||2===Nr(e,[II(t,0),II(t,1)]).length))),h=null==(a=null==f?void 0:f.flatMap((({score:e,tieMatchUps:t})=>{var i;return t?t.filter((({matchUpStatus:e})=>!m.includes(e))).flatMap((({score:e})=>{var t;return(null==(t=null==e?void 0:e.sets)?void 0:t.length)??0})):(null==(i=null==e?void 0:e.sets)?void 0:i.length)??0})))?void 0:a.reduce(((e,t)=>e+t),0);for(let v of f??[]){let{matchUpStatus:e,tieMatchUps:r,tieFormat:a,score:m,winningSide:f,sides:h}=v,g=a&&v._disableAutoCalc&&a.collectionDefinitions.every((({scoreValue:e})=>e)),I=f&&vI(v),U=f&&gI(v);if(I||U)if(UI(p,I),UI(p,U),null==r?void 0:r.length){n=0;for(let e of r){let{matchUpType:t}=e,n=wp(Cd)(t),r=wp(Ad)(t);e.winningSide&&(e.winningSide===f?(I&&(p[I].tieMatchUpsWon+=1,r&&(p[I].tieSinglesWon+=1),n&&(p[I].tieDoublesWon+=1)),U&&(p[U].tieMatchUpsLost+=1,r&&(p[U].tieSinglesLost+=1),n&&(p[U].tieDoublesLost+=1))):e.winningSide!==f&&(U&&(p[U].tieMatchUpsWon+=1,r&&(p[U].tieSinglesWon+=1),n&&(p[U].tieDoublesWon+=1)),I&&(p[I].tieMatchUpsLost+=1,r&&(p[I].tieSinglesLost+=1),n&&(p[I].tieDoublesLost+=1)))),SI({matchUpFormat:e.matchUpFormat,matchUpStatus:e.matchUpStatus,score:e.score,winningParticipantId:I,losingParticipantId:U,participantResults:p,isTieMatchUp:!0,manualGamesOverride:g,tallyPolicy:i,winningSide:f})}wI({winningParticipantId:I,losingParticipantId:U,participantResults:p,matchUpStatus:e})}else SI({matchUpFormat:v.matchUpFormat??t,isTieMatchUp:void 0,winningParticipantId:I,manualGamesOverride:g,losingParticipantId:U,participantResults:p,matchUpStatus:e,tallyPolicy:i,winningSide:f,score:m});else if(e&&Cl.includes(e)){let e=II(v,0),t=II(v,1);e&&(UI(p,e),p[e].matchUpsCancelled+=1),t&&(UI(p,t),p[t].matchUpsCancelled+=1)}else if(null!=r&&r.length){n=0;for(let e of r){if(e.winningSide){let t=null==(o=null==h?void 0:h.find((({sideNumber:t})=>t===e.winningSide)))?void 0:o.participantId,i=null==(s=null==h?void 0:h.find((({sideNumber:t})=>t===e.winningSide)))?void 0:s.participantId;t&&i&&(UI(p,t),UI(p,i),p[t].tieMatchUpsWon+=1,p[i].tieMatchUpsLost+=1,wp(Ad)(e.matchUpType)?(p[t].tieSinglesWon+=1,p[i].tieSinglesLost+=1):wp(Cd)(e.matchUpType)&&(p[t].tieDoublesWon+=1,p[i].tieDoublesLost+=1))}yI({score:e.score,manualGamesOverride:g,participantResults:p,sides:h})}}else yI({manualGamesOverride:g,participantResults:p,score:m,sides:h});if(g){let e=null==(l=null==h?void 0:h.find((({sideNumber:e})=>1===e)))?void 0:l.participantId,t=null==(u=null==h?void 0:h.find((({sideNumber:e})=>2===e)))?void 0:u.participantId;UI(p,e),UI(p,t);let i=null==(d=null==m?void 0:m.sets)?void 0:d.reduce(((e,t)=>e+((null==t?void 0:t.side1Score)??0)),0),n=null==(c=null==m?void 0:m.sets)?void 0:c.reduce(((e,t)=>e+(t.side2Score??0)),0);e&&(p[e].gamesWon+=i,p[e].gamesLost+=n),t&&(p[t].gamesWon+=n,p[t].gamesLost+=i)}}return function({participantResults:e,matchUpFormat:t,tallyPolicy:i,perPlayer:n,totalSets:r}){var a;let o=t&&xm(t)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,u=null==(a=o.setFormat)?void 0:a.setTo;Object.keys(e).forEach((t=>{let a=e[t].setsWon,o=e[t].setsLost,s=null!=i&&i.groupTotalSetsPlayed?r:n*(l||0)||a+o,d=Math.round(a/s*1e3)/1e3;(d===1/0||isNaN(d))&&(d=s);let c=e[t].tieMatchUpsWon,p=c+e[t].tieMatchUpsLost,m=Math.round(c/p*1e3)/1e3;(m===1/0||isNaN(m))&&(m=c);let f=e[t].matchUpsWon,h=f+e[t].matchUpsLost,v=Math.round(f/h*1e3)/1e3;(v===1/0||isNaN(v))&&(v=f);let g=e[t].gamesWon||0,I=e[t].gamesLost||0,U=(n||0)*(l||0)*(u||0),y=Math.max(U,g+I),S=Math.round(g/y*1e3)/1e3;(S===1/0||isNaN(S))&&(S=0);let w=Math.round(e[t].pointsWon/e[t].pointsLost*1e3)/1e3;(w===1/0||isNaN(w))&&(w=0),e[t].setsWon=a,e[t].setsLost=o,e[t].setsPct=d,e[t].tieMatchUpsWon=c,e[t].tieMatchUpsPct=m,e[t].matchUpsPct=v,e[t].gamesWon=g,e[t].gamesLost=I,e[t].gamesPct=S,e[t].pointsPct=w,e[t].result=`${e[t].matchUpsWon}/${e[t].matchUpsLost}`}))}({participantResults:p,matchUpFormat:t,tallyPolicy:i,perPlayer:n,totalSets:h}),{participantResults:p}}function vI(e){return II(e,e.winningSide-1)}function gI(e){return II(e,1-(e.winningSide-1))}function II(e,t){if(null==e||!e.sides)return console.log("no sides:",{matchUp:e}),"foo";let i=e.sides[t];return i?i.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function UI(e,t){t&&!e[t]&&(e[t]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function yI({manualGamesOverride:e,participantResults:t,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],o=[0,0];for(let l of r||[]){let{winningSide:e,side1Score:t,side2Score:i}=l;e&&(o[e-1]+=1),a[0].push(rr(t||0)),a[1].push(rr(i||0))}let s=[a[0].reduce(((e,t)=>e+t),0),a[1].reduce(((e,t)=>e+t),0)];n.forEach(((i,n)=>{let{participantId:r}=i;r&&(UI(t,r),t[r].setsWon+=o[n],t[r].setsLost+=o[1-n],e||(t[r].gamesWon+=s[n],t[r].gamesLost+=s[1-n]))}))}function SI({winningParticipantId:e,losingParticipantId:t,participantResults:i,manualGamesOverride:n,matchUpFormat:r,matchUpStatus:a,isTieMatchUp:o,tallyPolicy:s,winningSide:l,score:u}){let d=l&&l-1,c=1-d;o||wI({winningParticipantId:e,losingParticipantId:t,participantResults:i,matchUpStatus:a});let p=uI({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:u}),m=dI({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:u}),{pointsTally:f}=cI({score:u,matchUpFormat:r});e&&(i[e].setsWon+=p[d],i[e].setsLost+=p[c],n||(i[e].gamesWon+=m[d],i[e].gamesLost+=m[c]),i[e].pointsWon+=f[d],i[e].pointsLost+=f[c]),t&&(i[t].setsWon+=p[c],i[t].setsLost+=p[d],n||(i[t].gamesWon+=m[c],i[t].gamesLost+=m[d]),i[t].pointsWon+=f[c],i[t].pointsLost+=f[d])}function wI({winningParticipantId:e,losingParticipantId:t,participantResults:i,matchUpStatus:n}){t&&(n===bl&&(i[t].walkovers+=1),n===gl&&(i[t].defaults+=1),n===Tl&&(i[t].retirements+=1),[gl,Tl,bl].includes(n)&&(i[t].allDefaults+=1),i[t].matchUpsLost+=1),e&&(i[e].matchUpsWon+=1),t&&e&&(i[t].defeats.push(e),i[e].victories.push(t))}function TI({participantResults:e,participantIds:t,attribute:i}){return PI({participantResults:e,participantIds:t}).reduce(((e,t)=>{let{participantId:n,results:r}=t,a=null==r?void 0:r[i];return!isNaN(a)&&n&&(e[a]?e[a].push(n):e[a]=[n]),e}),{})}function PI(e){return(e.participantIds||Object.keys(e.participantResults)).reduce(((t,i,n)=>(t.push({participantId:i,i:n,results:e.participantResults[i]}),t)),[])}var DI=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],bI={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function MI(e){let{requireCompletion:t=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=e,a=[];if(t&&!function({participantResults:e,participantsCount:t}){let i=PI({participantResults:e}).filter((e=>t-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled));return t===i.length}(e))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(null==r?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=TI({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l,u=Object.keys(s).map((e=>parseFloat(e))).sort(((e,t)=>t-e)).map((e=>s[e])).map((t=>{let i=NI({participantIds:t,...e});return a.push(...i.report??[]),i.order})).flat(1/0),d=1;u.forEach(((e,t)=>{t&&(e.resolved||l&&!e.resolved)&&(d+=1),l=e.resolved,e.resolved?(e.position=t+1,d=e.position):e.position=d}));let c=Ur(u.map((({position:e})=>e)));return u.forEach((e=>{let{participantId:t,position:a}=e||{},o=i[t];e.GEMscore=function(e){return(Array.isArray(null==r?void 0:r.GEMscore)?Object.keys(bI).filter((e=>r.GEMscore.includes(e))):Object.keys(bI)).map((t=>(e[t]||0)*Math.pow(10,bI[t].toFixed(3)))).reduce(((e,t)=>e+t),0)}(o);let s=c[a];void 0!==(null==e?void 0:e.position)&&(s>1&&(e.ties=s,n&&(e.subOrder=n[t])),e.rankOrder=a,e.groupOrder=a+(e.subOrder||1)-1)})),{groupOrder:u,report:a.flat(1/0).filter(Boolean)}}function NI({participantResults:e,disableHeadToHead:t,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let o,s=[],l=[];if(1===(null==i?void 0:i.length))return{order:[{resolved:!0,participantId:i[0]}]};if(2===(null==i?void 0:i.length)&&(null==r||!r.headToHead||!r.headToHead.disabled&&!t)){let t=function({participantIds:e,participantResults:t}){if(e){if(t[e[0]].victories.includes(e[1]))return e.map((e=>({resolved:!0,participantId:e})));if(t[e[1]].victories.includes(e[0]))return e.reverse().map((e=>({resolved:!0,participantId:e})))}}({participantIds:i,participantResults:e});if(t){let e=t[0].participantId;return l.push({attribute:"head2Head",participantIds:i,headToHeadWinner:e}),{order:[t],headToHeadWinner:e,report:l}}}let u=((null==r?void 0:r.tallyDirectives)||DI).filter((e=>{let t=!(ur(e.maxParticipants)&&(null==i?void 0:i.length)>e.maxParticipants);return t||s.push(e),t}));return s.length&&l.push({excludedDirectives:s,participantIds:i}),u.every((({attribute:e,reversed:t,idsFilter:s,disableHeadToHead:u})=>(o=function({disableHeadToHead:e,participantIds:t,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){let l,{participantResults:u}=hI({participantIds:a&&t,matchUpFormat:i,tallyPolicy:n,matchUps:o}),d=TI({participantResults:u,participantIds:t,attribute:r}),c=[{attribute:r,reversed:s,groups:d,idsFilter:a}];return Object.keys(d).length>1&&t.length&&(l=Object.keys(d).map((e=>parseFloat(e))).sort(((e,t)=>s?e-t:t-e)).map((e=>d[e])).map((t=>{let r=NI({participantResults:u,disableHeadToHead:e,participantIds:t,matchUpFormat:i,tallyPolicy:n,matchUps:o});return c.push(...r.report??[]),r.order})).flat(1/0)),{order:l,report:c}}({disableHeadToHead:u,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:e,idsFilter:s,matchUps:a,reversed:t}),l.push(o.report),!o.order))),o.order?{order:o.order,report:l}:{order:null==i?void 0:i.map((e=>({participantId:e}))),report:l}}function RI({policyDefinitions:e,generateReport:t,matchUpFormat:i,matchUps:n=[],subOrderMap:r,perPlayer:a}){if(null==n||!n.length||!Bd(n))return{error:ei};let o=hr(n.map((({structureId:e})=>e)));if(1!==o.length)return Sa({result:{error:Fn,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let s=n.filter((e=>e&&e.matchUpStatus!==ml)),l=s.length&&hr(s.map((({drawPositions:e})=>e)).flat()).length,u=s.filter((e=>Xm({matchUp:e}))).length===s.length;u||(a=0);let d,c,p=n.every((({matchUpType:e,tieMatchUps:t})=>e===kd&&(null==t?void 0:t.every((e=>Xm({matchUp:e})))))),m=null==e?void 0:e[Ko],f=n.filter((e=>Xm({matchUp:e})||e.matchUpType===kd)),{participantResults:h}=hI({matchUps:f,matchUpFormat:i,tallyPolicy:m,perPlayer:a}),{groupOrder:v,report:g}=MI({matchUps:f,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:m,subOrderMap:r});if(u&&v)d=g,c=v,v.forEach((e=>{let{participantId:t,groupOrder:i,rankOrder:n,subOrder:r,ties:a,GEMscore:o}=e,s=h[t];Object.assign(s,{groupOrder:i,rankOrder:n,GEMscore:o,subOrder:r,ties:a})}));else{let{groupOrder:e,report:t}=MI({requireCompletion:!1,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:m,subOrderMap:r,matchUps:n});d=t,c=e,e&&e.forEach((e=>{let{participantId:t,groupOrder:i,GEMscore:n}=e,r=h[t];Object.assign(r,{provisionalOrder:i,GEMscore:n})}))}let I={completedTieMatchUps:p,readableReport:"",participantResults:h,bracketComplete:u,order:[],report:d};if((u||p)&&(I.order=c),t||$r({tally:!0})){let e=function({matchUps:e,order:t,report:i}){let n={};e.forEach((({sides:e})=>{e.forEach((e=>{e.participantId&&e.participant&&(n[e.participantId]=e.participant.participantName)}))}));let r=[];return Array.isArray(i)&&i.forEach(((e,t)=>{var i,a;if(null!=(i=e.excludedDirectives)&&i.length){let t=e.excludedDirectives.map((({attribute:e})=>e)).join(", "),i=`${t.length} directives were excluded due to participants limit}`;r.push(i);let n=`Excluded: ${t}`;r.push(n)}else{let i=(t,i)=>parseFloat(e.reversed?t:i)-parseFloat(e.reversed?i:t),o=e.groups?Object.values(e.groups).flat(1/0).length:(null==(a=e.participantIds)?void 0:a.length)??0,s=e=>{e.groups&&Object.keys(e.groups).sort(i).forEach((t=>{let i=e.groups[t].map((e=>n[e])).join(", "),a=`${t} ${e.attribute}: ${i}`;r.push(a)}))},l=e.reversed?" in reverse order":"",u=`Step ${t+1}: ${o} particiants were ${e.groups?"grouped":"separated"}${l} by ${e.attribute}`;if(r.push(u),e.idsFilter){let t=`${e.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(t)}s(e)}r.push("----------------------")})),r.push("Final Order:"),t.forEach((e=>{let{participantId:t,resolved:i}=e,a=e.groupOrder||e.provisionalOrder;r.push(`${a}: ${n[t]} => resolved: ${!!i}`)})),r.join("\r\n")}({matchUps:n,report:d,order:c});$r({tally:!0})&&console.log(e),I.readableReport=e}return I}function AI({positionAssignments:e}){let t=(e||[]).filter($d(Ma)).map((e=>{let{extension:t}=Ds({element:e,name:Hs}),i=rr(null==t?void 0:t.value),n=!isNaN(i)&&i;return n&&{participantId:e.participantId,subOrder:n}})).filter(Boolean),i=Ur(t.map((({subOrder:e})=>e)));return{subOrderMap:Object.assign({},...t.filter((({subOrder:e})=>1===i[e])).map((({participantId:e,subOrder:t})=>({[e]:t}))))}}function EI({positionAssignments:e,tournamentRecord:t,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!Bd(r))return{error:Fn};if(!e)return{error:Fn};let{policyDefinitions:o}=Vc({policyTypes:[Ko],tournamentRecord:t,drawDefinition:i,event:a}),{subOrderMap:s}=AI({positionAssignments:e}),l=r.length?RI({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(null!=l&&l.error)return l;let{participantResults:u={},bracketComplete:d,report:c}=l??{},p=Object.keys(u);return e.forEach((e=>{let{participantId:t}=e;if(p.includes(t)){fs({element:e,extension:{value:u[t],name:zs}}),u[t].ties||ps({element:e,name:Hs})}else ps({element:e,name:zs}),ps({element:e,name:Hs})})),wd({drawDefinition:i}),{...Be,participantResults:u,bracketComplete:d,report:c}}function CI({matchUps:e,matchUpId:t}){return{matchUp:(e||[]).find((e=>e.matchUpId===t))}}function OI({tournamentParticipants:e,afterRecoveryTimes:t,contextContent:i,contextProfile:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,inContext:s,context:l,event:u}){if(!r)return{error:Ke};if(!o)return{error:Qt};if("string"!=typeof o)return{error:Fn};let{structures:d=[]}=Bu({drawDefinition:r});n&&!i&&(i=wm({contextProfile:n,drawDefinition:r}));for(let c of d){let{matchUps:d}=Zm({tournamentParticipants:e,afterRecoveryTimes:t,contextContent:i,drawDefinition:r,contextProfile:n,matchUpsMap:a,inContext:s,structure:c,context:l,event:u}),{matchUp:p}=CI({matchUps:d,matchUpId:o});if(p)return{matchUp:p,structure:c}}return{error:Xt}}function kI(e){var t;return"object"!=typeof e?{error:mi}:"object"!=typeof e.element?{error:Fn}:e.notes?"string"==typeof e.notes||null!=(t=e.notes)&&t.testing?(Object.assign(e.element,{notes:e.notes}),{...Be}):{error:Fn}:{error:mi}}function FI(e){return"object"!=typeof e?{error:mi}:"object"!=typeof e.element?{error:Fn}:(e.element.notes&&delete e.element.notes,{...Be})}var xI={matchUpStatus:Dl,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function LI(e){var t,i,n,r,a,o,s,l;let u,d="modifyMatchUpScore",c=e.matchUpFormat,p=e.matchUp,{matchUpStatusCodes:m,removeWinningSide:f,tournamentRecord:h,drawDefinition:v,matchUpStatus:g,removeScore:I,winningSide:U,matchUpId:y,event:S,notes:w,score:T}=e,P=e.appliedPolicies&&Object.keys(e.appliedPolicies).length?e.appliedPolicies:null==(t=jc({policyTypes:[rs],tournamentRecord:h,drawDefinition:v,structure:u,event:S}))?void 0:t.appliedPolicies,D=p.matchUpType===kd;if(D&&v){if(y&&p.matchUpId!==y){let e=OI({drawDefinition:v,matchUpId:y,event:S});if(!e.matchUp)return{error:Xt};({matchUp:p,structure:u}=e)}}else p.matchUpId!==y&&console.log("!!!!!");g&&[bl,Ul].includes(g)||I?Object.assign(p,{...xI}):T&&(p.score=T);let b,M=g&&(null==p?void 0:p.matchUpStatus)===gl&&g!==gl;if(g&&(p.matchUpStatus=g),c&&(p.matchUpFormat=c),m&&(p.matchUpStatusCodes=m),U&&(p.winningSide=U),f&&(p.winningSide=void 0),!u&&v&&({structure:u}=OI({drawDefinition:v,matchUpId:y,event:S})),g&&!p.winningSide&&kf(p)&&!Cl.includes(g)&&![pl,Pl].includes(g)&&(p.matchUpStatus=yl),(M&&null!=(i=null==p?void 0:p.processCodes)&&i.length||g===gl)&&(b=null==(r=null==(n=null==P?void 0:P[rs])?void 0:n.processCodes)?void 0:r.incompleteAssignmentsOnDefault),!p.collectionId){let e=(null==u?void 0:u.structureType)===Jl,t=Nm({structure:u});if(Mm({drawDefinition:v,structure:u})||t||e){let i=(e=>{c=D?"SET1-S:T100":c??p.matchUpFormat??(null==e?void 0:e.matchUpFormat)??(null==v?void 0:v.matchUpFormat)??(null==S?void 0:S.matchUpFormat);let i=D?{matchUpTypes:[kd]}:void 0,{matchUps:n}=Zm({afterRecoveryTimes:!1,tournamentRecord:h,inContext:!0,matchUpFilters:i,drawDefinition:v,structure:e,event:S});return t&&(e.positionAssignments=hr(n.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})))),EI({positionAssignments:e.positionAssignments,tournamentRecord:h,drawDefinition:v,matchUpFormat:c,matchUps:n,event:S})})(e&&u.structures.find((e=>null==e?void 0:e.matchUps.find((e=>e.matchUpId===y))))||u);if(i.error)return Sa({result:i,stack:d})}}if(w){let e=kI({element:p,notes:w});if(e.error)return Sa({result:e,stack:d})}let N=null==h?void 0:h.tournamentId,R=sa().topics.includes(hd),A=(R||b)&&Wd({drawDefinition:v}),E=A&&(null==(a=uf({matchUpFilters:{matchUpIds:[y]},nextMatchUps:!0,tournamentRecord:h,inContext:!0,drawDefinition:v,matchUpsMap:A}).matchUps)?void 0:a[0]);if(R&&E&&function({tournamentId:e,inContextMatchUp:t}){t&&ia({payload:{inContextMatchUp:t,tournamentId:e},topic:hd,key:t.matchUpId})}({tournamentId:N,inContextMatchUp:E}),Array.isArray(b)&&E&&(null==(o=E.sides)||!o.every((({participantId:e})=>e))))if(g===gl)p.processCodes=hr([...p.processCodes??[],...b]);else for(let C of b||[]){let e=C&&(null==(s=null==p?void 0:p.processCodes)?void 0:s.lastIndexOf(C));null==(l=null==p?void 0:p.processCodes)||l.splice(e,1)}return yd({eventId:null==S?void 0:S.eventId,context:d,drawDefinition:v,tournamentId:N,matchUp:p}),{...Be}}function _I(e){let{dualWinningSideChange:t,matchUpStatusCodes:i,matchUpStatus:n,structure:r,matchUp:a}=e,o=Ff({matchUpStatus:n})||[fl,cl].includes(n)&&t,s="attemptToModifyScore",l=!!a.collectionId,u=Nm({structure:r});if(!(l||u||function({structure:e,matchUp:t}){var i;let{drawPositions:n}=t,{positionAssignments:r}=Gu({structure:e});return 2===(null==(i=null==r?void 0:r.filter((e=>(null==n?void 0:n.includes(e.drawPosition))&&e.participantId)))?void 0:i.length)}({structure:r,matchUp:a})))return{error:xt};let d=[bl].includes(n);return Sa({result:LI({...e,matchUpStatusCodes:o&&i||[],matchUpStatus:o&&n||hl,context:s,removeScore:d}),stack:s})}function BI({collectionGroups:e=[]}){let t=Object.assign({},...e.filter((e=>mr(null==e?void 0:e.groupValue)&&(null==e?void 0:e.groupNumber))).map((e=>({[e.groupNumber]:{...e,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))));return{groupValueGroups:t,groupValueNumbers:Object.keys(t).map((e=>rr(e)))}}function jI({collectionDefinition:e,groupValueNumbers:t,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter((t=>t.collectionId===e.collectionId)),o=[0,0],s=[0,0],l=a.every((e=>Cl.includes(e.matchUpStatus))),{collectionValueProfiles:u,collectionGroupNumber:d,collectionValue:c,matchUpValue:p,winCriteria:m,scoreValue:f,setValue:h}=e,v=d&&t.includes(d),g=[0,0];if(a.forEach((e=>{e.winningSide&&(g[e.winningSide-1]+=1)})),mr(p)?a.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=p)})):mr(h)?a.forEach((e=>{var t,i;null==(i=null==(t=e.score)?void 0:t.sets)||i.forEach((e=>{e.winningSide&&(o[e.winningSide-1]+=h)}))})):mr(f)?a.forEach((e=>{var t,i;null==(i=null==(t=e.score)?void 0:t.sets)||i.forEach((t=>{let{side1TiebreakScore:i=0,side2TiebreakScore:n=0,side1Score:r=0,side2Score:a=0}=t;(e.matchUpStatus===hl||e.winningSide||t.winningSide)&&(r||a?(o[0]+=r,o[1]+=a):(i||n)&&t.winningSide&&(o[t.winningSide-1]+=1))}))})):Array.isArray(u)&&a.forEach((t=>{if(t.winningSide){let i=t.collectionPosition,n=function({collectionDefinition:e,collectionPosition:t}){var i,n;return null==(n=null==(i=e.collectionValueProfiles||[])?void 0:i.find((e=>e.collectionPosition===t)))?void 0:n.matchUpValue}({collectionDefinition:e,collectionPosition:i});mr(n)&&(o[t.winningSide-1]+=n)}})),mr(c)){let t;if(null!=m&&m.aggregateValue)l&&(mr(p||h||f)&&o[0]!==o[1]?t=o[0]>o[1]?1:2:g[0]!==g[1]&&(t=g[0]>g[1]?1:2));else if(null!=m&&m.valueGoal)t=o.reduce(((e,t,i)=>t>=m.valueGoal?i+1:e),0);else{let i=Math.floor(e.matchUpCount/2)+1;t=g.reduce(((e,t,n)=>t>=i?n+1:e),0)}t&&(v?i[d].values[t-1]+=c:s[t-1]+=c)}else v?(i[d].values[0]+=o[0]||0,i[d].values[1]+=o[1]||0):s=o;v?(i[d].sideWins[0]+=g[0]||0,i[d].sideWins[1]+=g[1]||0,i[d].allGroupMatchUpsCompleted=i[d].allGroupMatchUpsCompleted&&l,i[d].matchUpsCount+=a.length):s.forEach(((e,t)=>n[t]+=e||0))}function VI({collectionValueProfiles:e,matchUpCount:t}){let i=[];if(!Array.isArray(e))return i.push(`collectionValueProfiles is not an array: ${e}`),{errors:i};if(e.length&&e.length!==t)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of e){if("object"!=typeof r)return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:e,collectionPosition:n}=r;if("number"!=typeof e||"number"!=typeof n||n>t||n<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=e.map((e=>e.collectionPosition));return n.length!==hr(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...Be}}var GI="MIXED events can not contain mixed singles or { gender: ANY } collections",$I="events with { gender: ANY } can not contain MIXED singles collections";function qI(e){let t="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=e;return i&&r&&[zm,Jm].includes(i)&&i!==r?Sa({result:{valid:!1,error:On},context:{gender:r},stack:t}):i===Ym&&(r===Hm||r===Ym&&n!==Cd)?Sa({result:{error:On,valid:!1},info:GI,stack:t}):i===Hm&&r===Ym&&n!==Cd?Sa({result:{error:On,valid:!1},info:$I,stack:t}):{valid:!0}}function WI(e,t){if((null!=e&&e.bestOf||null!=e&&e.exactly)&&null!=e&&e.setFormat)return function(e,t){var i;let n=HI(e.bestOf)||void 0,r=HI(e.exactly)||void 0,a=n||r;if(null!=(i=e.setFormat)&&i.timed&&e.simplified&&1===a)return zI(e.setFormat);let o=a&&`${km}${a}`||"",s=YI(e.setFormat,t),l=s&&`S:${s}`||"",u=YI(e.finalSetFormat,t),d=a&&a>1&&u&&s!==u&&`F:${u}`||"";if(o&&s)return[o,l,d].filter((e=>e)).join("-")}(e,t)}function HI(e){return!isNaN(Number(e))&&Number(e)}function zI(e){let t=`T${e.minutes}`;return e.based&&(t+=e.based),e.modifier&&(t+=`@${e.modifier}`),t}function YI(e,t){if("object"==typeof e&&Object.keys(e).length){if(e.timed)return zI(e);if(e.tiebreakSet)return KI(e.tiebreakSet);let i=HI(e.setTo);if(i){let n=e.NoAD&&Om||"",r=KI(e.tiebreakFormat),a=r&&`/${r}`||"",o=HI(e.tiebreakAt);if(!1!==r)return`${i}${n}${a}${o&&(o!==i||t)&&`@${o}`||""}`}}}function KI(e){if(e){if("object"==typeof e&&!e.tiebreakTo)return"";if("object"==typeof e&&HI(e.tiebreakTo)){let t=`TB${e.tiebreakTo}${e.NoAD?Om:""}`;return e.modifier&&(t+=`@${e.modifier}`),t}return!1}}function JI({matchUpFormat:e}){if("string"!=typeof e)return!1;let t=xm(e),i=e.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=null==i?void 0:i[1],r=null==i?void 0:i[2],a=null==i?void 0:i[3],o=e.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=null==o?void 0:o[1],l=null==o?void 0:o[2],u=null==o?void 0:o[3];return WI(t,!!(i&&r&&n===a||o&&l&&s===u))===e}var QI=(e,t)=>e.filter(Boolean).every((e=>typeof e===t)),ZI=e=>e.filter(Boolean).every(ur);function XI(e){let t=e.category;if("object"!=typeof t)return{error:kn};let i,{ageCategoryCode:n,ageMaxDate:r,ageMinDate:a,ageMax:o,ageMin:s}=t,l=t.categoryName;if(!QI([n,r,a,l],"string")||!ZI([o,s]))return{error:kn};let u=e.consideredDate??Co((new Date).toLocaleDateString("sv"));if(!yo(u))return{error:Ui};let[d]=u.split("-").slice(0,3).map((e=>parseInt(e))),c=Oo(u,-1),[p,m]=c.split("-").slice(1,3).map((e=>parseInt(e))),f=`${Go(p)}-${Go(m)}`,h=Oo(u,1),[v,g]=h.split("-").slice(1,3).map((e=>parseInt(e))),I=`${Go(v)}-${Go(g)}`,U=s&&Oo(u,-365*s),y=o&&Oo(u,-365*o),S=[],w=e=>!S.includes(e)&&S.push(e);n=n??l;let T=/^([UO]?)(\d{1,2})([UO]?)$/,P=/^C(\d{1,2})-(\d{1,2})$/,D=null==n?void 0:n.includes("-"),b=D&&(null==n?void 0:n.match(P)),M=null==n?void 0:n.match(T),N=(e,t)=>`${e}-${t}`,R=e=>{let i=N(d-e-1,I);t.ageMin&&t.ageMin>e&&w(`Invalid submitted ageMin: ${s}`),t.ageMax&&t.ageMax>e&&w(`Invalid submitted ageMax: ${o}`),t.ageMinDate&&t.ageMinDate!==i&&w(`Invalid submitted ageMinDate: ${a}`),a=i,n&&(t.ageMax&&t.ageMax!==e&&(w(`Invalid submitted ageMax: ${o}`),U=void 0),o=e)},A=e=>{let i=N(d-e,f);t.ageMaxDate&&t.ageMaxDate!==i&&w(`Invalid submitted ageMaxDate: ${r}`),r=i,n&&(t.ageMin&&t.ageMin!==e+1&&(w(`Invalid submitted ageMin: ${s}`),U=void 0),s=e+1)},E=e=>{let[i,l,u]=(e.match(T)||[]).slice(1),c=parseInt(l);"U"===i?(t.ageMaxDate&&t.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),(e=>{let i=N(d-e,I);t.ageMinDate&&t.ageMinDate!==i&&w(`Invalid submitted ageMinDate: ${a}`),a=i,n&&(t.ageMax&&t.ageMax!==e-1&&(w(`Invalid submitted ageMax: ${o}`),y=void 0),o=e-1)})(c)):"O"===i&&A(c),"U"===u?(t.ageMaxDate&&t.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),R(c)):"O"===u&&(e=>{let i=N(d-e-1,f);t.ageMaxDate&&t.ageMaxDate!==i&&w(`Invalid submitted ageMaxDate: ${r}`),r=i,n&&(t.ageMin&&t.ageMin!==e&&(w(`Invalid submitted ageMin: ${s}`),U=void 0),s=e)})(c),r=r??U,a=a??y};if(b){if(r=void 0,a=void 0,o=void 0,s=void 0,t.ageMin){let e=d-t.ageMin;r=N(e,f)}if(t.ageMax){let e=d-t.ageMax-1;a=N(e,I)}let[e,l]=((null==n?void 0:n.match(P))??[]).slice(1).map((e=>parseInt(e)));e<=l?(s=e,o=l,i=!0):w(`Invalid combined age range ${n}`)}else D?null==n||n.split("-").forEach(E):M?E(n):(s&&A(s),o&&R(o));o&&t.ageMin&&t.ageMin>o&&(w(`Invalid submitted ageMin: ${t.ageMin}`),s=void 0);let C=ya({consideredDate:u,combinedAge:i,ageMaxDate:r,ageMinDate:a,ageMax:o,ageMin:s});return S.length&&(C.errors=S),C}function eU({category:e}){if(!Ce(e))return{error:Fn};let t=XI({category:e});if(t.error)return{error:t};let{ratingMax:i,ratingMin:n}=e;return i&&!ur(i)?Sa({result:{error:Fn},context:{ratingMax:i}}):n&&!ur(n)?Sa({result:{error:Fn},context:{ratingMin:n}}):{...t}}function tU({childCategory:e,withDetails:t,category:i}){let n=eU({category:i}),r=eU({category:e}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),o=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),u=(null==i?void 0:i.ratingType)&&(null==e?void 0:e.ratingType)&&i.ratingType===e.ratingType&&(i.ratingMin&&e.ratingMin&&e.ratingMin<i.ratingMin||i.ratingMax&&e.ratingMax&&e.ratingMax>i.ratingMax||i.ratingMin&&e.ratingMax&&e.ratingMax<i.ratingMin||i.ratingMax&&e.ratingMin&&e.ratingMin>i.ratingMax),d=(null==i?void 0:i.ballType)&&(null==e?void 0:e.ballType)&&i.ballType!==e.ballType,c=ya({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:d,invalidAgeMax:o,invalidAgeMin:a,valid:!(u||s||l||d||o||a)},!0);return t&&Object.assign(c,{categoryDetails:n,childCategoryDetails:r}),c}function iU({checkCategory:e=!0,collectionDefinition:t,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:o}){a=a??(null==o?void 0:o.gender);let s="validateCollectionDefinition",l=[];if("object"!=typeof t)return l.push(`collectionDefinition must be an object: ${t}`),Sa({result:{errors:l,error:Cn},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:d,collectionValue:c,collectionId:p,matchUpCount:m,matchUpFormat:f,matchUpValue:h,matchUpType:v,scoreValue:g,setValue:I,category:U,gender:y}=t;if(i&&"string"!=typeof p&&l.push(`collectionId is not type string: ${p}`),"number"!=typeof m&&l.push(`matchUpCount is not type number: ${m}`),v&&!$m([Ad,Cd],v)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${v}`),1!==[!(null==u||!u.length)].concat([h,c,g,I].map(mr)).filter(Boolean).length&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&"number"!=typeof h&&l.push(`matchUpValue is not type number: ${h}`),c&&"number"!=typeof c&&l.push(`collectionValue is not type number: ${c}`),u&&m){let e=VI({collectionValueProfiles:u,matchUpCount:m});e.errors&&l.push(...e.errors)}if(d&&"number"!=typeof d&&l.push(`collectionGroupNumber is not type number: ${c}`),f&&!JI({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let e=qI({referenceGender:a,matchUpType:v,gender:y});if(e.error)return Sa({context:{referenceGender:a,gender:y},result:e,stack:s})}if(e&&r&&U){let e=tU({category:r,childCategory:U});if(!e.valid)return Sa({result:{error:kn},context:e,stack:s})}return l.length?Sa({result:{errors:l,error:En},stack:s}):{valid:!0}}function nU(e){var t,i,n,r;let a=!(!1===(null==e?void 0:e.enforceCategory)||null==e||!e.category),o=!(!1===(null==e?void 0:e.enforceGender)||null==e||!e.gender),s=null==e?void 0:e.checkCollectionIds,l=null==e?void 0:e.tieFormat,u=null==e?void 0:e.event,d="validateTieFormat",c=[];if(!e||!l||"object"!=typeof l)return c.push("tieFormat must be an object"),Sa({result:{error:Ht},context:{tieFormat:l,errors:c},stack:d});if("object"!=typeof l.winCriteria)return c.push("tieFormat.winCriteria must be an object"),Sa({result:{error:Ht},context:{tieFormat:l,errors:c},stack:d});if(!Array.isArray(l.collectionDefinitions))return c.push(Tv("tieFormat.collectionDefinitions")),Sa({result:{error:Ht},context:{tieFormat:l,errors:c},stack:d});let p,m=l.collectionDefinitions.every((t=>{let{setValue:i,scoreValue:n,collectionValue:r}=t;(i||n)&&!r&&(p=!0);let{valid:l,errors:d}=iU({referenceCategory:e.category,referenceGender:e.gender,collectionDefinition:t,checkCollectionIds:s,checkCategory:a,checkGender:o,event:u});return!!l||(Array.isArray(d)&&c.push(...d),!1)})),f="number"==typeof(null==(t=l.winCriteria)?void 0:t.valueGoal)&&(null==(i=l.winCriteria)?void 0:i.valueGoal)>0&&!p||(null==(n=l.winCriteria)?void 0:n.aggregateValue);if(!(f||null!=(r=l.winCriteria)&&r.aggregateValue))return p?c.push("aggregateValue is required"):c.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),Sa({context:{tieFormat:l,errors:c,aggregateValueImperative:p},result:{error:Ht},stack:d});let h=l.collectionDefinitions.map((({collectionId:e})=>e)),v=!s||h.length===hr(h).length,g=m&&f&&v;return g?{valid:g,errors:c}:Sa({result:{error:Ht},context:{tieFormat:l,errors:c},stack:d})}function rU(e){var t,i,n,r,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:u,structure:d,matchUp:c,event:p}=e;if(!Array.isArray(o)||2!==o.length||isNaN(o.reduce(((e,t)=>e+t))))return{error:Fn};if(!c)return{error:ti};let m=(null==(t=Um({matchUp:c,drawDefinition:l,structure:d,event:p}))?void 0:t.tieFormat)||(null==e?void 0:e.tieFormat);if(!m)return{error:Jt};let f=nU({tieFormat:m});if(f.error)return f;let h=(null==m?void 0:m.collectionDefinitions)||[],v=(null==c?void 0:c.tieMatchUps)??[],g=[0,0],{groupValueGroups:I,groupValueNumbers:U}=BI(m);for(let D of h)jI({collectionDefinition:D,groupValueNumbers:U,groupValueGroups:I,sideTieValues:g,tieMatchUps:v});for(let D of U){let e,t=I[D],{allGroupMatchUpsCompleted:i,matchUpCount:n,winCriteria:r,groupValue:a,sideWins:o,values:s}=t;if(null!=r&&r.aggregateValue)i&&s[0]!==s[1]&&(e=s[0]>s[1]?1:2);else if(null!=r&&r.valueGoal)e=s.reduce(((e,t,i)=>t>=r.valueGoal?i+1:e),void 0);else{let t=Math.floor(n/2)+1;e=o.reduce(((e,i,n)=>i>=t?n+1:e),void 0)}e&&(g[e-1]+=a||0)}let y,S=g.map(((e,t)=>(e||0)+o[t])),w={side1Score:S[0],side2Score:S[1],winningSide:void 0},T=S.join(s),P=S.slice().reverse().join(s);if(null!=m&&m.winCriteria){let{valueGoal:e,aggregateValue:t,tallyDirectives:o}=m.winCriteria;if(e?y=null==(i=S.map(((e,t)=>({sideNumber:t+1,points:e}))).find((({points:t})=>t>=e)))?void 0:i.sideNumber:t&&v.every((e=>e.matchUpStatus&&Cl.includes(e.matchUpStatus)||e.winningSide))&&S[0]!==S[1]&&(y=S[0]>S[1]?1:2),!y&&o){let e=c.matchUpId,t=c.hasContext?c:(null==(n=null==u?void 0:u.drawMatchUps)?void 0:n[e])||l&&(null==(r=OI({inContext:!0,drawDefinition:l,matchUpId:e}))?void 0:r.matchUp);if(t){let{completedTieMatchUps:e,order:i}=RI({matchUps:[t]});if(e&&null!=i&&i.length){let e=i[0].participantId;y=null==(a=t.sides.find((({participantId:t})=>t===e)))?void 0:a.sideNumber}}}}return y&&(w.winningSide=y),{scoreStringSide1:T,scoreStringSide2:P,winningSide:y,set:w}}function aU({inContextDualMatchUp:e,drawDefinition:t,tournamentId:i,dualMatchUp:n,eventId:r}){var a,o;if(n){e||(e=null==(a=OI({matchUpId:n.matchUpId,inContext:!0,drawDefinition:t}))?void 0:a.matchUp);let{extension:s}=Ds({element:t,name:Ls}),l=Wo((null==s?void 0:s.value)||{},!1,!0),u=({displaySideNumber:e,drawPosition:t,sideNumber:i})=>({drawPosition:t,sideNumber:i,displaySideNumber:e});n.sides=null==(o=null==e?void 0:e.sides)?void 0:o.map((e=>{var t;let i=e.participantId,r=i&&l[i]||void 0,{lineUp:a,...o}=(null==(t=n.sides)?void 0:t.find((({sideNumber:t})=>t===e.sideNumber)))??{},s=null!=a&&a.length?a:r;return{...u(e),...o,lineUp:s}})),yd({context:"ensureSidLineUps",matchUp:n,drawDefinition:t,tournamentId:i,eventId:r})}}function oU(e){if(e)return Wo(e,!1,!0)}function sU(e){let t=io(e,[{[wa]:!0}]);return t.error?t:Object.keys(e.tournamentRecords).reduce(((t,i)=>{t.tournamentIdMap[i]=[];let n=e.tournamentRecords[i].events??[],r=n.map((({eventId:e})=>e)),a=n.map((e=>(e.drawDefinitions??[]).map((({drawId:e})=>e)))).flat();return t.tournamentIdMap[i].push(...r,...a),t.eventIds.push(...r),t.drawIds.push(...a),t}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function lU({tournamentRecords:e,eventId:t,drawId:i}){let{tournamentIdMap:n}=sU({tournamentRecords:e});return(n?Object.keys(n):[]).find((e=>t&&(null==n?void 0:n[e].includes(t))||i&&(null==n?void 0:n[e].includes(i))))}function uU(e){var t,i,n,r;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:u,matchUpId:d,event:c}=e,p=e.tournamentRecords||e.tournamentRecord&&{[null==(t=e.tournamentRecord)?void 0:t.tournamentId]:e.tournamentRecord}||{},m=e.tournamentId||(null==(i=e.tournamentRecord)?void 0:i.tournamentId);p&&lU({tournamentRecords:p,...e});let f=m&&p[m];if(!f)return{error:We};let h=OI({drawDefinition:o,event:c,matchUpId:d});if(h.error)return h;if(!h.matchUp)return{error:Xt};let{matchUp:v,structure:g}=h;if(!v.tieMatchUps)return{error:ii};aU({tournamentId:null==f?void 0:f.tournamentId,eventId:null==c?void 0:c.eventId,dualMatchUp:v,drawDefinition:o});let{extension:I}=Ds({name:Cs,element:v});if(null!=I&&I.value){if(!l)return{...Be,score:v.score};ps({element:v,name:Cs})}let U=null==(n=Um({drawDefinition:o,structure:g,matchUp:v,event:c}))?void 0:n.tieFormat;v.tieFormat=oU(U);let y=rU({drawDefinition:o,matchUpsMap:u,structure:g,matchUp:v,event:c}),{winningSide:S,set:w,scoreStringSide1:T,scoreStringSide2:P}=y,D=(null==w?void 0:w.side1Score)||(null==w?void 0:w.side2Score);if(a&&!v.score&&!D)return{...Be};let b,M={scoreStringSide1:T,scoreStringSide2:P,sets:w?[w]:[]},N=S&&[1,2].includes(S),R=N&&hl||Lf({matchUpStatus:s??v.matchUpStatus,tieMatchUps:v.tieMatchUps,winningSide:v.winningSide,score:M})&&yl||Dl,A=!(!v.winningSide||N),E=v.tieMatchUps.find((({score:e,winningSide:t,matchUpStatus:i})=>{var n;return(null==(n=null==e?void 0:e.sets)?void 0:n.length)&&(e.sets[0].side1Score||e.sets[0].side2Score)||i&&Cl.includes(i)||t}));if(v.tieFormat&&!N&&!E){let e=null==(r=Um({drawDefinition:o,structure:g,event:c}))?void 0:r.tieFormat;e&&JSON.stringify(U)===JSON.stringify(e)&&(v.tieFormatId=void 0,v.tieFormat=void 0,b=!0)}return LI({appliedPolicies:e.appliedPolicies,matchUpStatus:R,score:M,removeWinningSide:A,tournamentRecord:f,drawDefinition:o,removeScore:l,winningSide:S,matchUpId:d,matchUp:v,event:c}),{...Be,score:M,removeWinningSide:A,tieFormatRemoved:b,winningSide:S}}function dU(e){var t;let i=_I(e);if(i.error)return i;let n,r=Ff({matchUpStatus:e.matchUpStatus}),{dualWinningSideChange:a,projectedWinningSide:o,inContextDrawMatchUps:s,tournamentRecord:l,drawDefinition:u,matchUpStatus:d,dualMatchUp:c,matchUpsMap:p,winningSide:m,targetData:f,matchUpId:h,structure:v,matchUp:g,event:I}=e,U="directParticipants",y=!!g.collectionId,S=Nm({structure:v}),w=g.drawPositions;if(y){let{matchUpTieId:i,matchUpsMap:r}=e,o=uU({appliedPolicies:e.appliedPolicies,matchUpId:i,tournamentRecord:l,drawDefinition:u,matchUpsMap:r,event:I});if(n=o&&{tieMatchUpResult:o},w=null==(t=s.find((({matchUpId:e})=>e===i)))?void 0:t.drawPositions,!a)return Sa({result:{...Be,...n},stack:U})}if(S)return Sa({result:{...Be,...n},stack:U});if(!w)return Sa({result:{error:at},stack:U});{let e=o?o-1:m-1,t=1-e,i=w[e],n=w[t],{targetLinks:{loserTargetLink:a,winnerTargetLink:v,byeTargetLink:g},targetMatchUps:{winnerMatchUpDrawPositionIndex:y,loserMatchUpDrawPositionIndex:S,winnerMatchUp:T,loserMatchUp:P,byeMatchUp:D}}=f;if(T){let e=function({winnerMatchUpDrawPositionIndex:e,inContextDrawMatchUps:t,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:u,dualMatchUp:d,matchUpsMap:c,event:p}){var m,f,h,v,g;let I="directWinner";if(o){let i=u.drawPositions||[],d=i[e],h=o.source.structureId,v=_u({structureId:h,drawDefinition:l});if(v.error)return v;let{structure:g}=v,{positionAssignments:U}=Gu({structureId:h,drawDefinition:l}),y=null==(m=null==U?void 0:U.find((e=>e.drawPosition===r)))?void 0:m.participantId,S=o.target.structureId,{positionAssignments:w}=Gu({structureId:S,drawDefinition:l}),T=null==(f=null==w?void 0:w.find((e=>e.participantId===y)))?void 0:f.drawPosition,P=null==w?void 0:w.filter((e=>{let t=i.includes(e.drawPosition),n=!e.participantId&&!e.bye&&!e.qualifier;return t&&n})).map((e=>e.drawPosition)),D=null==P?void 0:P.includes(d);if(y&&1===o.target.roundNumber&&D)Mv({drawPosition:d,participantId:y,structureId:S,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:c,event:p});else if(y&&null!=P&&P.length){let e=P.pop();e&&Mv({participantId:y,structureId:S,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:e,matchUpsMap:c,event:p})}else if(T){let e=yv({drawPosition:T,matchUpId:u.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:c});if(e.error)return Sa({result:e,stack:I})}else if((null==g?void 0:g.stage)!==Ll){let e="winner target position unavaiallble";return console.log(e),{error:e}}if(null!=g&&g.seedAssignments&&g.structureId!==S){let e=g.seedAssignments.find((({participantId:e})=>e===y)),t=null==e?void 0:e.participantId;e&&t&&fv({eventId:null==u?void 0:u.eventId,structureId:S,...e,tournamentRecord:a,drawDefinition:l,participantId:t})}}else{let e=yv({matchUpId:u.matchUpId,drawPosition:r,inContextDrawMatchUps:t,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:c});if(e.error)return e}if(d&&i){let e=null==(h=d.sides)?void 0:h.find((e=>e.sideNumber===i));if(null!=e&&e.lineUp){let t=d.roundPosition,i=u.roundPosition,n=t===i&&1!==t||Math.floor(t/2)===i?2:1,r=null==(v=null==c?void 0:c.drawMatchUps)?void 0:v.find((({matchUpId:e})=>e===u.matchUpId)),o=[1,2].map((e=>{var t;return{...(null==(t=r.sides)?void 0:t.find((t=>t.sideNumber===e)))||{},sideNumber:e}}));r.sides=o;let s=r.sides.find((e=>e.sideNumber===n));if(s){let t=null==(g=e.lineUp)?void 0:g.filter((e=>null==e?void 0:e.participantId));s.lineUp=wv({lineUp:t}),yd({tournamentId:null==a?void 0:a.tournamentId,eventId:null==u?void 0:u.eventId,matchUp:r,context:I,drawDefinition:l})}}}return{...Be}}({sourceMatchUpStatus:r&&d||hl,winnerMatchUpDrawPositionIndex:y,sourceMatchUpId:h,inContextDrawMatchUps:s,projectedWinningSide:o,winningDrawPosition:i,tournamentRecord:l,winnerTargetLink:v,drawDefinition:u,winnerMatchUp:T,dualMatchUp:c,matchUpsMap:p,event:I});if(e.error)return Sa({result:e,stack:U})}if(P){let e=function(e){var t,i,n;let{loserMatchUpDrawPositionIndex:r,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:u,loserTargetLink:d,drawDefinition:c,loserMatchUp:p,dualMatchUp:m,matchUpsMap:f,event:h}=e,v="directLoser",g=d.linkCondition,I=p.drawPositions||[],U=g===ru&&2===p.roundNumber&&Math.min(...I.filter(Boolean)),y=U||I[r],S=U||I[1-r],w=d.source.structureId,{structure:T}=_u({structureId:w,drawDefinition:c}),{matchUps:P}=Zm({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:T,event:h}),D=P.filter((e=>{var t;return null==(t=e.drawPositions)?void 0:t.includes(l)})).filter((e=>{let t=e.sides.find((e=>e.drawPosition===l)),i=e.matchUpStatus===bl||e.matchUpStatus===gl&&!kf(e);return(null==t?void 0:t.sideNumber)===e.winningSide&&!i})),b=g===ru&&0===D.length,{positionAssignments:M}=Gu({structureId:w,drawDefinition:c}),N=null==(t=null==M?void 0:M.find((e=>e.drawPosition===l)))?void 0:t.participantId,R=d.target.structureId,{positionAssignments:A}=Gu({structureId:R,drawDefinition:c}),E=null==A?void 0:A.filter((({drawPosition:e})=>I.includes(e)));if(null!=E&&E.some((e=>e.participantId===N)))return{...Be};let C=null==E?void 0:E.filter((e=>{let t=I.includes(e.drawPosition),i=!e.participantId&&!e.bye&&!e.qualifier;return t&&i})).map((e=>e.drawPosition)),O=null==C?void 0:C.includes(y),k=d.target.roundNumber>1&&(null==C?void 0:C.length),F=1===d.target.roundNumber&&O;if(U){let e=function(){let e="loserLinkFedFMLC";return Sa(b?{result:L(),stack:e}:{result:x(),stack:e})}();if(e.error)return Sa({result:e,stack:v})}else if(F){let e=L();if(e.error)return Sa({result:e,stack:v})}else{if(!N||!k)return Sa({result:{error:st},context:{loserDrawPosition:l,loserTargetLink:d},stack:v});{C.sort(nr);let e=C[0],t=Mv({participantId:N,structureId:R,drawPosition:e,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:c,matchUpsMap:f,event:h});if(t.error)return Sa({result:t,stack:v})}}if(null!=T&&T.seedAssignments&&T.structureId!==R){let e=T.seedAssignments.find((({participantId:e})=>e===N)),t=null==e?void 0:e.participantId;e&&t&&fv({eventId:null==p?void 0:p.eventId,structureId:R,...e,tournamentRecord:u,drawDefinition:c,participantId:t})}if(m&&o){let e=null==(i=m.sides)?void 0:i.find((e=>e.sideNumber===3-o));if(null!=e&&e.lineUp){let{roundNumber:t,eventId:i}=p,{roundPosition:r}=m,a=1===t?2-r%2:1,o=null==(n=null==f?void 0:f.drawMatchUps)?void 0:n.find((({matchUpId:e})=>e===p.matchUpId)),s=[1,2].map((e=>{var t;return{...(null==(t=o.sides)?void 0:t.find((t=>t.sideNumber===e)))||{},sideNumber:e}}));o.sides=s;let l=o.sides.find((e=>e.sideNumber===a));l&&(l.lineUp=wv({lineUp:e.lineUp}),yd({tournamentId:null==u?void 0:u.tournamentId,matchUp:o,context:v,drawDefinition:c,eventId:i}))}}return{...Be};function x(){return Sa({result:qf({drawPosition:S,structureId:R,tournamentRecord:u,drawDefinition:c,event:h}),stack:"assignLoserPositionBye"})}function L(){return Sa({result:N?Mv({drawPosition:y,participantId:N,structureId:R,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:u,drawDefinition:c,matchUpsMap:f,event:h}):{error:_i},stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:r&&d||hl,loserMatchUpDrawPositionIndex:S,sourceMatchUpId:h,inContextDrawMatchUps:s,projectedWinningSide:o,loserDrawPosition:n,tournamentRecord:l,loserTargetLink:a,drawDefinition:u,loserMatchUp:P,winningSide:m,matchUpsMap:p,dualMatchUp:c,event:I});if(e.error)return Sa({result:e,stack:U})}if(D){let e=D.drawPositions||[],t=qf({drawPosition:Math.min(...e.filter(Boolean)),structureId:g.target.structureId,tournamentRecord:l,drawDefinition:u,event:I});if(t.error)return Sa({result:t,stack:U})}}return Sa({result:{...Be,...n},stack:U})}function cU(e){var t,i,n,r;let a="genPlayoffStructure";if(!e.drawDefinition)return Sa({result:{error:Ke},stack:a});let o=Jg(e);if(o.error)return Sa({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionNaming:d,finishingPositionLimit:c,playoffAttributes:p,playoffPositions:m,roundOffsetLimit:f,tournamentRecord:h,exitProfileLimit:v,roundProfiles:g,roundNumbers:I,idPrefix:U,isMock:y,event:S,uuids:w}=e,T=Wo(e.drawDefinition,!1,!0),{structure:P}=_u({structureId:s,drawDefinition:T});if(!P)return Sa({result:{error:bt},stack:a});if(P.structureType===Jl||P.structures)return function(e){var t,i,n;let r="generateAndPopulateRRplayoffStructures";if(!e.playoffGroups)return Sa({result:{error:mi},info:"playoffGroups required",stack:r});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:u,groupCount:d,groupSize:c,event:p}=e,{structures:m=[],links:f=[],finishingPositionTargets:h,positionRangeMap:v,error:g}=iI({requireSequential:o,sourceStructureId:a,playoffGroups:u,groupCount:d,groupSize:c,...e});if(g)return{error:g};let I=null==h?void 0:h.map((({finishingPositions:e})=>e)).flat().map((e=>v[e].finishingPositions)).flat();l.structures.push(...m),l.links.push(...f);let{matchUps:U,matchUpsMap:y}=uf({inContext:!0,drawDefinition:l}),S=m.map((({structureId:e})=>e)),w=null==U?void 0:U.filter((({structureId:e})=>S.includes(e))).map(ll),T=null==(t=null==y?void 0:y.drawMatchUps)?void 0:t.filter((({matchUpId:e})=>null==w?void 0:w.includes(e)));if(null!=T&&T.length){let t=null==(i=Um({drawDefinition:l,event:p}))?void 0:i.tieFormat;t&&T.forEach((i=>{let{tieMatchUps:n}=rI({isMock:e.isMock,tieFormat:t,matchUp:i});Object.assign(i,{tieMatchUps:n,matchUpType:Od})}))}let{positionAssignments:P}=Vu({structureId:a,drawDefinition:l}),D={};null==P||P.forEach((e=>{var t,i,n;let r=null==(n=null==(i=null==(t=Ds({element:e,name:zs}))?void 0:t.extension)?void 0:i.value)?void 0:n.groupOrder;r&&(D[r]||(D[r]=[]),D[r].push(e.participantId))}));let b=vg({provisionalPositioning:e.provisionalPositioning,structureId:a,applyPositioning:!0,event:e.event,tournamentRecord:s,drawDefinition:l});return b.error&&(null==(n=b.error)?void 0:n.code)!==Xe.code?Sa({result:b,stack:r}):{structures:m,links:f,positionsPlayedOff:I,drawDefinition:l,...Be}}({sourceStructureId:P.structureId,...e,...o,drawDefinition:T});let{playoffRoundsRanges:D,playoffRounds:b}=o,{playoffPositionsReturned:M,error:N,playoffSourceRounds:R,playoffRoundsRanges:A}=Kg(e);if(N)return Sa({result:{error:N},stack:a});let E=(null==g?void 0:g.length)&&Object.assign({},...g),C=I||"object"==typeof g&&g.map((e=>Object.keys(e))).flat(),O=Array.isArray(C)&&C.map((e=>!isNaN(e)&&rr(e))).filter(Boolean);if(O){if(!Array.isArray(O))return Sa({result:{error:Fn},context:{validRoundNumbers:O},stack:a});O.forEach((e=>{if(null==b||!b.includes(e))return Sa({result:{error:Fn},context:{roundNumber:e},stack:a})}))}m&&m.forEach((e=>{if(null==M||!M.includes(e))return Sa({result:{error:Fn},context:{playoffPosition:e},stack:a})}));let k=O||R,F=O?D:A,x=[],L=[];for(let z of k??[]){let e=null==F?void 0:F.find((e=>e.roundNumber===z));if(!e)return Sa({result:{error:Fn},context:{roundNumber:z},stack:a});let t=e.finishingPositions.length,i=Math.min(...e.finishingPositions)-1,n=2,r=z&&(null==E?void 0:E[z])&&n+E[z]-1,o=$g({exitProfile:`0-${z}`,addNameBaseToAttributeName:l,playoffStructureNameBase:u,finishingPositionOffset:i,playoffAttributes:p,exitProfileLimit:v,stage:jl,roundOffset:0,drawDefinition:T,sequenceLimit:r,stageSequence:n,drawSize:t,idPrefix:U,isMock:y,uuids:w,finishingPositionNaming:d,finishingPositionLimit:c,roundOffsetLimit:f});if(o.error)return Sa({result:o,stack:a});let{structures:m,links:h}=o;if(null!=m&&m.length&&x.push(...m),null!=h&&h.length&&L.push(...h),o.structureId&&z){let e={linkType:nu,source:{structureId:s,roundNumber:z},target:{structureId:o.structureId,feedProfile:Xl,roundNumber:1}};L.push(e)}}if(!x.length)return Sa({result:{error:Fn},info:"No structures generated",stack:a});T.structures.push(...x),T.links.push(...L);let{matchUps:_,matchUpsMap:B}=uf({inContext:!0,drawDefinition:T}),j=x.map((({structureId:e})=>e)),V=null==_?void 0:_.filter((({structureId:e})=>j.includes(e))).map(ll),G=null==(t=null==B?void 0:B.drawMatchUps)?void 0:t.filter((({matchUpId:e})=>null==V?void 0:V.includes(e)));if(null!=G&&G.length){let e=null==(i=Um({drawDefinition:T,event:S}))?void 0:i.tieFormat;e&&G.forEach((t=>{let{tieMatchUps:i}=rI({matchUp:t,tieFormat:e,isMock:y});Object.assign(t,{tieMatchUps:i,matchUpType:kd})}))}null==(n=null==_?void 0:_.filter((e=>Xm({matchUp:e})&&e.structureId===s)))||n.forEach((e=>{let{matchUpId:t,score:i,winningSide:n}=e,r=af({inContextDrawMatchUps:_,drawDefinition:T,matchUpId:t}),a=dU({inContextDrawMatchUps:_,tournamentRecord:h,drawDefinition:T,matchUpsMap:B,winningSide:n,targetData:r,matchUpId:t,structure:P,matchUp:e,score:i,event:S});a.error&&console.log(a.error)})),null==(r=null==_?void 0:_.filter((e=>e.matchUpStatus===ml&&e.structureId===s)))||r.forEach((e=>{let{matchUpId:t}=e,i=af({inContextDrawMatchUps:_,drawDefinition:T,matchUpId:t}),{targetLinks:{loserTargetLink:n},targetMatchUps:{loserMatchUpDrawPositionIndex:r,loserMatchUp:a}}=i;if(n&&a){let e=n.target.structureId,t=qf({drawPosition:a.drawPositions[r],structureId:e,tournamentRecord:h,drawDefinition:T,event:S});t.error&&console.log(t.error)}}));let $=[],q=cf({inContextDrawMatchUps:_,drawDefinition:T,matchUpsMap:B}).goesToMap,{structure:W}=_u({drawDefinition:e.drawDefinition,structureId:s}),{matchUps:H}=Zm({structure:W});return H.forEach((t=>{var i,n;let r=null==q?void 0:q.loserMatchUpIds[t.matchUpId];if(r&&t.loserMatchUpId!==r){t.loserMatchUpId=r;let n={tournamentId:null==h?void 0:h.tournamentId,eventId:null==(i=e.event)?void 0:i.eventId,context:a,matchUp:t};$.push(n)}let o=null==q?void 0:q.winnerMatchUpIds[t.matchUpId];if(o&&t.winnerMatchUpId!==o){t.winnerMatchUpId=o;let i={tournamentId:null==h?void 0:h.tournamentId,eventId:null==(n=e.event)?void 0:n.eventId,context:a,matchUp:t};$.push(i)}})),{structures:x,matchUpModifications:$,links:L,drawDefinition:T,...Be}}function pU(e){return fU({...e,itemType:"attachConsolationStructures"})}function mU(e){return fU({...e,itemType:"attachPlayoffStructures"})}function fU({itemType:e="attachStructures",matchUpModifications:t,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:o}){var s,l,u;let d="attachStructures";if(!n)return{error:Ke};if(!Array.isArray(r)||!Array.isArray(a))return Sa({result:{error:Fn},stack:d});let c=e=>{var t;return[e.source.structureId,e.source.roundNumber||(null==(t=e.source.finishingPositions)?void 0:t.join("|")),e.target.roundNumber].join("|")},p=null==(s=n.links)?void 0:s.map(c);if(a.some((e=>{let t=c(e);return null==p?void 0:p.includes(t)})))return Sa({result:{error:Yn},info:"playoff structure exists",stack:d});a.length&&(null==(l=n.links)||l.push(...a));let m=r.map((({structureId:e})=>e)),f=null==(u=n.structures)?void 0:u.map((({structureId:e})=>e));n.structures=(n.structures??[]).map((e=>m.includes(e.structureId)?r.find((({structureId:t})=>t===e.structureId)):e));let h=null==r?void 0:r.filter((({structureId:e})=>!(null!=f&&f.includes(e))));h.length&&n.structures.push(...h),cf({drawDefinition:n});let v=r.map((e=>{var t;return(null==(t=Zm({structure:e}))?void 0:t.matchUps)||[]})).flat();Id({tournamentId:null==i?void 0:i.tournamentId,eventId:null==o?void 0:o.eventId,drawDefinition:n,matchUps:v});let g=r.map((({structureId:e})=>e));if(wd({drawDefinition:n,structureIds:g}),null==t?void 0:t.length){let e={};t.forEach((t=>{var i;let n=null==(i=t.matchUp)?void 0:i.matchUpId;n&&(e[n]=t)}));let i=t=>{t.matchUps.forEach((t=>{if(e[t.matchUpId]){let{tieMatchUps:i,...n}=e[t.matchUpId].matchUp;if(Object.assign(t,n),null==i?void 0:i.length){let n={};i.forEach((t=>e[t.matchUpId]=t)),t.tieMatchUps.forEach((e=>Object.assign(e,n[e.matchUpId])))}e[t.matchUpId].matchUp=t,yd(e[t.matchUpId])}}))};n.structures.forEach((e=>{if(null!=f&&f.includes(e.structureId))if(e.structures)for(let t of e.structures)i(t);else i(e)}))}let I=h.map($d("structureId"));if(i){yg({element:i,timeItem:{itemValue:{structureIds:g,drawId:n.drawId},itemType:e}})}return{...Be,addedStructureIds:I}}function hU(e){var t,i;let{structures:n,links:r,matchUpModifications:a,error:o}=cU(e);if(o)return{error:o};let s=e.drawDefinition;return mU({tournamentId:null==(t=e.tournamentRecord)?void 0:t.tournamentId,eventId:(null==(i=e.event)?void 0:i.eventId)||e.eventId,matchUpModifications:a,drawDefinition:s,structures:n,links:r})}function vU(e){let t=io(e,[{_anyOf:{[wa]:!1,[Pa]:!1,[Da]:!1,[qa]:!1},[Ta]:!0}]);if(t.error)return t;let i=[],n=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(n){let t=gU(e,n);if(t.error)return t;i.push(...(null==t?void 0:t.applied)??[]),e.drawDefinition&&wd({drawDefinition:e.drawDefinition,tournamentId:e.tournamentId})}else{if(!e.tournamentRecords)return{error:We};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:We};for(let n of t){let t=gU(e,e.tournamentRecords[n]);if(t.error)return t;i.push(...(null==t?void 0:t.applied)??[])}}}return i.length?{...Be,applied:i}:{error:li}}function gU(e,t){let i=jc(e).appliedPolicies??{};t.extensions||(t.extensions=[]);let n=[],r=Object.keys(e.policyDefinitions);if(!r.length)return{error:ri};for(let a of r)if(!i[a]||e.allowReplacement){let t=e.policyDefinitions[a];if(!t)continue;if(!Ce(t))return{error:Fn};let{policyName:r,...o}=t;if(!o||!Object.keys(o).length||r&&!Ee(r))return{error:Fn};i[a]=e.policyDefinitions[a],n.push(a)}return null!=n&&n.length?{...fs({element:t,extension:{name:bs,value:i}}),applied:n}:{applied:n,error:li}}function IU({tournamentRecord:e,drawDefinition:t,flightProfile:i,drawName:n,drawId:r,event:a}){var o;if(!n||"string"!=typeof n)return Sa({result:{error:Fn},context:{drawName:n}});i||(i=fm({event:a}).flightProfile);let s=null==(o=null==i?void 0:i.flights)?void 0:o.find((e=>e.drawId===r));if(s){s.drawName=n,gs({event:a,extension:{name:Fs,value:{...i,flights:i.flights}}})}return t&&(t.drawName=n,wd({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:t})),s||t?{...Be,flight:s}:{error:Ke}}function UU({tournamentRecord:e,drawDefinition:t,drawUpdates:i,drawId:n,event:r}){var a;if(!Ce(i))return{error:Fn};let o=fm({event:r}).flightProfile,s=i.drawName&&IU({drawName:i.drawName,tournamentRecord:e,drawDefinition:t,flightProfile:o,drawId:n,event:r});if(null!=s&&s.error)return null==s?void 0:s.error;let l=(null==s?void 0:s.flight)||(null==(a=null==o?void 0:o.flights)?void 0:a.find((e=>e.drawId===n)));if(!l&&!t)return{error:Ke};if(l){gs({event:r,extension:{name:Fs,value:{...o,flights:o.flights}}})}return t&&(i.policyDefinitions&&vU({policyDefinitions:i.policyDefinitions,drawDefinition:t}),wd({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:t})),{...Be}}function yU({tournamentRecord:e,removeScheduling:t,drawDefinition:i}){var n,r;if(!i)return{error:Ke};let a=Wd({drawDefinition:i}),o=e=>{var t;return null==(t=null==a?void 0:a.drawMatchUps)?void 0:t.find((t=>t.matchUpId===e))};for(let s of i.structures||[]){let{positionAssignments:l,stage:u,stageSequence:d}=s;l&&(1!==d||![Ll,xl].includes(u))&&(s.positionAssignments=l.map((e=>(delete e.participantId,e))),s.seedAssignments=[]);let{matchUps:c,isRoundRobin:p}=Zm({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:s});for(let a of c){let{matchUpId:s,roundNumber:l}=a,u=a.sides||[],d=o(s);if(d){if(delete d.extensions,delete d.notes,d.matchUpStatus!==ml&&Object.assign(d,xI),l&&l>1&&(null==(n=d.drawPositions)?void 0:n.length)&&!p){let e=null==u?void 0:u.map((({drawPosition:e,participantFed:t})=>!t&&e)).filter(Boolean),t=d.drawPositions.map((t=>e.includes(t)?void 0:t));d.drawPositions=t}t?delete d.timeItems:null!=(r=d.timeItems)&&r.length&&(d.timeItems=d.timeItems.filter((e=>e.itemType&&![Kc,Jc,Yc,Xc,Zc,ep].includes(e.itemType)))),yd({tournamentId:null==e?void 0:e.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:d})}}}return wd({drawDefinition:i,structureIds:(i.structures||[]).map((({structureId:e})=>e))}),{...Be}}function SU({tournamentRecord:e}){var t;if(!e)return{error:We};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={};return(null==(t=e.events)?void 0:t.map((e=>{let t=e.eventId;return n[t]=e,((null==e?void 0:e.drawDefinitions)||[]).map((e=>({drawDefinition:e,eventId:t})))})).flat().filter(Boolean)).forEach((({drawDefinition:e,eventId:t})=>{let r=0,a=0,o=0,{allStructuresLinked:s}=Ig({drawDefinition:e}),l=n[t],u=((null==e?void 0:e.structures)||[]).map((t=>{let{stage:i,stageSequence:n,structureId:s}=t,u=Gl[i],{inContextStructureMatchUps:d}=_f({drawDefinition:e,structure:t,event:l}),c=null==d?void 0:d.filter((({winningSide:e})=>e)),p=c.filter(Boolean).length||0;a+=p,o+=d.length-a;let m=Math.max(c.filter((({roundNumber:e})=>1===e)).map((({roundPosition:e})=>e))),{positionAssignments:f}=Vu({structure:t}),h=null==f?void 0:f.filter((({participantId:e})=>e));r+=(null==h?void 0:h.length)??0;let v=((null==f?void 0:f.length)??0)-((null==h?void 0:h.length)??0),{roundMatchUps:g,roundProfile:I,roundNumbers:U,maxMatchUpsCount:y}=jd({matchUps:d}),S=I&&Object.keys(I).filter((e=>!I[e].inactiveRound)).map((e=>parseInt(e))),w=I&&Object.keys(I).filter((e=>I[e].inactiveRound)).map((e=>parseInt(e))),T=I&&Object.values(I).every((e=>e.inactiveRound));return{positionsAssignedCount:(null==h?void 0:h.length)??0,maxWinningSideFirstRoundPosition:m,unassignedPositionsCount:v,inactiveStructure:T,maxMatchUpsCount:y,inactiveRounds:w,roundMatchUps:g,activeRounds:S,roundNumbers:U,roundProfile:I,structureId:s,stageSequence:n,orderNumber:u,stage:i}})),d=u.find((e=>2===e.orderNumber&&1===e.stageSequence)),c=u.filter((({inactiveStructure:e})=>!e)).length,{links:p}=nf({structureId:d.structureId,drawDefinition:e}),m=1===rr(d.activeRounds[0])&&1===d.activeRounds.length&&1===c,f=null==u?void 0:u.every((({inactiveStructure:e})=>e)),h=!p.length&&d.activeRounds.length&&(d.roundProfile[1].inactiveCount||d.inactiveRounds.length),v=e.drawId;r&&!a&&i.positionsNoOutcomes.push(v),f&&i.inactive.push(v),m&&i.matchPlay.push(v),h&&i.canBePruned.push(v);let g={matchUpsWithWinningSideCount:a,matchUpsNoOutcomeCount:o,positionsAssignedCount:r,allStructuresLinked:s,structuresData:u,inactiveDraw:f,isMatchPlay:m,drawId:v};i.drawAnalysis[v]=g})),{...Be,drawsAnalysis:i}}function wU({matchPlayDrawPositions:e=!0,tournamentRecord:t,drawDefinition:i,drawId:n}){var r;if(!t)return{error:We};if(!i)return{error:Ke};let a=[],{drawsAnalysis:o}=SU({tournamentRecord:t});if(o.canBePruned.includes(n)){let s=o.matchPlay.includes(n),l=o.drawAnalysis[n],{structures:[u]}=Bu({stageSequence:1,drawDefinition:i,stage:xl}),d=l.structuresData.find((({structureId:e})=>u.structureId===e)),c=(u.matchUps??[]).sort(((e,t)=>e.roundPosition-t.roundPosition));a=c.filter((({roundNumber:e})=>!d.inactiveRounds.includes(e)));let p=a.map(ll),m=c.map(ll).filter((e=>!p.includes(e)));if(s){let t=a.filter((({roundNumber:e})=>!d.inactiveRounds.includes(e))).filter((({winningSide:e})=>e)),i=t.map(ll),n=p.filter((e=>!i.includes(e)));m.push(...n);let o=t.flatMap((e=>e.drawPositions??[])).filter(Boolean).flat(),s=Object.assign({},...o.map(((e,t)=>({[e]:t+1}))));if(t.forEach((t=>{e?t.drawPositions=t.drawPositions.map((e=>s[e])):delete t.drawPositions})),e){let e=null==(r=null==u?void 0:u.positionAssignments)?void 0:r.filter((e=>o.includes(e.drawPosition))).map((e=>(e.drawPosition=s[e.drawPosition],e)));u.positionAssignments=e}else u.positionAssignments=[];u.matchUps=t,a=t}Ud({tournamentId:null==t?void 0:t.tournamentId,matchUpIds:m,drawDefinition:i}),wd({drawDefinition:i})}return{...Be,matchUps:a}}function TU({tournamentRecord:e,drawDefinition:t,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:o,bye:s}){if(!t)return{error:Ke};if(!n)return{error:lt};if(!r)return{error:Dt};if(s){let i=qf({tournamentRecord:e,drawDefinition:t,drawPosition:n,structureId:r,event:o});if(i.error)return i}else{if(a)return{error:Gn};{let a=Mv({tournamentRecord:e,drawDefinition:t,participantId:i,drawPosition:n,structureId:r,event:o});if(a.error)return a}}return{...Be}}function PU(e){var t,i,n,r,a;let o=e.matchUpIds??[],{drawDefinition:s}=e,l=e.structureId??(null==(i=null==(t=null==s?void 0:s.structures)?void 0:t.find((e=>{var t;return null==(t=e.matchUps)?void 0:t.some((({matchUpId:e})=>o.includes(e)))})))?void 0:i.structureId)??(null==(r=null==(n=null==s?void 0:s.structures)?void 0:n[0])?void 0:r.structureId);if(!l)return{error:bt};let u=null==(a=s.structures)?void 0:a.find((e=>e.structureId===l));if(!u)return{error:bt};let d=null==u?void 0:u.matchUps,c=null==d?void 0:d.find((e=>!!e.roundPosition));if(u.structures||c||u.finishingPosition===Cu)return{error:Ze};let p=d.filter((({roundNumber:t})=>{var i;return null==(i=e.roundNumbers)?void 0:i.includes(t)})).map(ll);return o=o.filter((e=>!p.includes(e))),e.roundNumbers&&!o.length&&(o=p),{existingMatchUps:d,matchUpIds:o,structureId:l,structure:u}}function DU(e){let t=io(e,[{[Da]:!0},{[Xa]:{[Ea]:!1,roundNumbers:!1},[Ja]:Fn,[Qa]:za}]);if(t.error)return t;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:o,event:s}=e,l=PU(e);if(l.error)return l;let{structure:u,structureId:d,existingMatchUps:c,matchUpIds:p}=l,m=[],f=(null==c?void 0:c.filter((({matchUpId:e,score:t,winningSide:a})=>{if(a&&!r)return!1;if(kf({score:t})){if(!a&&!i)return!1;m.push(e)}else if(!n)return!1;return null==p?void 0:p.includes(e)})))??[],h=f.map(ll),v=f.map((({tieMatchUps:e})=>null==e?void 0:e.map(ll))).filter(Boolean).flat();if(h.length){u.matchUps=(u.matchUps??[]).filter((({matchUpId:e})=>!h.includes(e))),Ud({tournamentId:null==a?void 0:a.tournamentId,matchUpIds:[...v,...h],action:"deleteAdHocMatchUps",eventId:null==s?void 0:s.eventId,drawDefinition:o});let e=function(e,t=1){return Array.isArray(e)&&e.every(mr)?br(Math.min(...e,t),Math.max(...e)+1).filter((t=>!e.includes(t))):[]}(hr(u.matchUps.map($d("roundNumber"))));if(e.length){e.reverse();for(let t of e)u.matchUps.forEach((e=>{e.roundNumber&&e.roundNumber>t&&(e.roundNumber-=1,yd({tournamentId:null==a?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:null==s?void 0:s.eventId,drawDefinition:o,matchUp:e}))}))}if(m.length){u.positionAssignments=hr(u.matchUps.flatMap((e=>(e.sides??[]).map((e=>e.participantId)))).filter(Boolean)).map((e=>({participantId:e})));let e=(null==u?void 0:u.matchUpFormat)??(null==o?void 0:o.matchUpFormat)??(null==s?void 0:s.matchUpFormat),{matchUps:t}=Zm({afterRecoveryTimes:!1,inContext:!0,structure:u,event:s}),i=EI({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:e,matchUps:t,event:s});i.error&&console.log(i)}wd({structureIds:[d],eventId:null==s?void 0:s.eventId,drawDefinition:o})}return!h.length&&p.length?{error:Qn}:{...Be,deletedMatchUpsCount:[...h,...v].length}}function bU({removeCompletedMatchUps:e,tournamentRecord:t,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!t)return{error:We};if(!i)return{error:Ke};if(!r)return Sa({result:{error:mi},info:"roundNumber required"});let o=_u({drawDefinition:i,structureId:n});if(o.error)return o;let s=o.structure;return null!=s&&s.structures?{error:Ze}:Nm({structure:s})?function({removeCompletedMatchUps:e,drawDefinition:t,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let o=(null==r?void 0:r.matchUps)??[],s=[],l=[],u=!1;if(o.reduce(((e,t)=>{let i=null==t?void 0:t.roundNumber;return i?e.includes(i)?e:e.concat(i):e}),[]).sort(nr).includes(n)){let d=o.filter((t=>{let i=t.roundNumber===n&&(!Cl.includes(t.matchUpStatus)||e);return i&&(l.push(t.matchUpId),t.tieMatchUps&&s.push(...t.tieMatchUps.map(ll))),!i}));l.length&&(Ud({matchUpIds:[...s,...l],drawDefinition:t,tournamentId:i,eventId:a}),d.some((e=>e.roundNumber===n))||(d.forEach((e=>{e.roundNumber>n&&(e.roundNumber-=1,yd({drawDefinition:t,tournamentId:i,eventId:a,matchUp:e}))})),u=!0),r.matchUps=d)}return{deletedMatchUpsCount:l.length,roundRemoved:u,...Be}}({tournamentId:t.tournamentId,removeCompletedMatchUps:e,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...Be})}function MU(e){var t,i,n,r,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:u,matchUps:d,event:c}=e;if("object"!=typeof u)return{error:Ke};let p=null==e?void 0:e.structureId;if(!p&&1===(null==(t=u.structures)?void 0:t.length)&&(p=null==(n=null==(i=u.structures)?void 0:i[0])?void 0:n.structureId),"string"!=typeof p)return{error:Dt};if(!Bd(d))return{error:Fn,info:Tv("matchUps")};let m=null==(r=u.structures)?void 0:r.find((e=>e.structureId===p));if(!m)return{error:bt};let f=(null==m?void 0:m.matchUps).find((e=>!!e.roundPosition));if(m.structures||f||m.finishingPosition===Cu)return{error:Ze};if(Ar((null==(o=null==(a=Rf({tournamentRecord:l,inContext:!1}))?void 0:a.matchUps)?void 0:o.map(ll))??[],d.map(ll)))return{error:Hn,info:"One or more matchUpIds already present in tournamentRecord"};m.matchUps.push(...d);let h=d.map((({tieMatchUps:e})=>e)).filter(Boolean).flat();return s||(Id({tournamentId:null==l?void 0:l.tournamentId,matchUps:[...h,...d],eventId:null==c?void 0:c.eventId,drawDefinition:u}),wd({drawDefinition:u,structureIds:[p]})),{...Be}}function NU({tournamentRecord:e,drawDefinition:t,drawPosition:i,structureId:n,subOrder:r,event:a}){var o;if(!t)return{error:Ke};if(!n)return{error:Dt};if(!i)return{error:lt};let{structure:s}=_u({drawDefinition:t,structureId:n});if(!s)return{error:bt};let l=s;s.structures&&s.structureType===Jl&&(l=null==(o=s.structures)?void 0:o.find((e=>{var t;return null==(t=e.positionAssignments)?void 0:t.find((e=>e.drawPosition===i))})));let u=null==l?void 0:l.positionAssignments,d=null==u?void 0:u.find((e=>e.drawPosition===i));d&&fs({element:d,extension:{name:Hs,value:r}});let c=((null==a?void 0:a.eventType)===kd||t.matchUpType===kd||((null==a?void 0:a.tieFormat)??(null==t?void 0:t.tieFormat)??(null==s?void 0:s.tieFormat)))&&{matchUpTypes:[kd]},{matchUps:p}=Zm({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:c,event:a});return EI({positionAssignments:u,tournamentRecord:e,drawDefinition:t,matchUpFormat:(null==s?void 0:s.matchUpFormat)??t.matchUpFormat,matchUps:p,event:a}),wd({drawDefinition:t,structureIds:[n]}),{...Be}}var RU={};function AU({excludedMatchUpStatuses:e=[],includeEventParticipants:t,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:u,requireLoss:d,allEntries:c,winsLimit:p,event:m}){var f,h,v,g,I;if(!s)return{error:Ke};let U=[xl,jl];i&&U.push(Ll);let y=null!=m&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,S=null!=s&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=t&&m?(null==(f=Nf({contextFilters:{stages:U},matchUpFilters:y,tournamentRecord:o,inContext:!0,event:m}))?void 0:f.matchUps)??[]:(null==(h=Cf({contextFilters:{stages:U},matchUpFilters:S,tournamentRecord:o,inContext:!0,drawDefinition:s}))?void 0:h.matchUps)??[],T=Mc({stage:Bl,drawDefinition:s}).map((({participantId:e})=>e)),P={},D={},b={},M={};r||(r=Vc({policyTypes:[zo],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let N=null==r?void 0:r[zo];e=e.length&&e||(null==N?void 0:N.excludedMatchUpStatuses)||[],t=t??(null==N?void 0:N.includeEventParticipants),c=c??(null==N?void 0:N.allEntries),n=n??(null==N?void 0:N.finishingRoundLimit),a=a??(null==N?void 0:N.roundNumberLimit),l=l??(null==N?void 0:N.matchUpsLimit),void 0===u&&(u=void 0===(null==N?void 0:N.requirePlay)||N.requirePlay),void 0===d&&(d=void 0===(null==N?void 0:N.requireLoss)||N.requireLoss),p=p??(null==N?void 0:N.winsLimit);for(let O of w){if(u&&O.winningSide&&![1,2].includes(O.winningSide)&&O.matchUpStatus!==Ul||O.finishingRound&&n&&O.finishingRound>=n||O.finishingRound&&a&&O.finishingRound<=a)continue;let t=null==(v=O.sides)?void 0:v.find((({sideNumber:e})=>O.winningSide&&e===3-O.winningSide)),i=null==(g=O.sides)?void 0:g.find((({sideNumber:e})=>O.winningSide&&e===O.winningSide));if(null==(I=O.sides)||I.forEach((t=>{var i;let n=null==(i=null==t?void 0:t.participant)?void 0:i.participantId;n&&(b[n]=t.participant,O.matchUpStatus===Ul&&!u&&(D[n]=t.participant,P[n]||(P[n]=0),(!O.matchUpStatus||!e.includes(O.matchUpStatus))&&(P[n]+=1)))})),null==t?void 0:t.participant){let i=t.participant.participantId;D[i]=t.participant,P[i]||(P[i]=0),O.matchUpStatus&&!e.includes(O.matchUpStatus)&&(P[i]+=1)}if(null!=i&&i.participant){let t=i.participant.participantId;M[t]||(M[t]=0),M[t]+=1,P[t]||(P[t]=0),O.matchUpStatus&&!e.includes(O.matchUpStatus)&&(P[t]+=1)}}let R=(null==o?void 0:o.participants)&&!u&&!d&&c,A=R?((t&&m?m.entries:s.entries)??[]).filter((e=>![Ic,hc].includes(e.entryStatus))).map((({participantId:e})=>e)):[],E=Object.keys(D),C=R?((null==o?void 0:o.participants)??[]).filter((({participantId:e})=>A.includes(e))):d&&Object.values(D)||Object.values(b);return{eligibleParticipants:C.filter((e=>(e=>!d||E.includes(e))(e.participantId)&&(e=>!u||(P[e]||0)>=0)(e.participantId)&&(e=>!p||(M[e]||0)<=p)(e.participantId)&&(e=>!l||P[e]<=l)(e.participantId)&&(e=>!T.includes(e))(e.participantId))).map((e=>{var t;return{...e,individualParticipants:null==(t=e.individualParticipantIds)?void 0:t.map((e=>{var t;return null==(t=null==o?void 0:o.participants)?void 0:t.find((t=>t.participantId===e))}))}})),losingParticipantIds:E,...Be}}function EU(e){var t,i,n,r,a,o,s,l;let u=io(e,[{drawDefinition:!0}]);if(u.error)return u;let{drawDefinition:d,roundNumber:c}=e,p=e.structureId??(1===(null==(t=d.structures)?void 0:t.length)&&(null==(n=null==(i=d.structures)?void 0:i[0])?void 0:n.structureId));if("string"!=typeof p)return{error:Dt};let m=null==(r=d.structures)?void 0:r.find((e=>e.structureId===p));if(!m)return{error:bt};let f,h=null==(a=m.matchUps??[])?void 0:a.reduce(((e,t)=>(t.roundPosition&&(f=!0),((null==t?void 0:t.roundNumber)||0)>e?t.roundNumber:e)),0);if(m.structures||f||m.finishingPosition===Cu)return{error:Ze};let v=(null==(o=null==d?void 0:d.entries)?void 0:o.filter((e=>{let t=e.entryStatus;return wc.includes(t)})))??[],g=Math.floor((null==v?void 0:v.length)/2)||1,I=c??h??1,U=g-((null==(l=null==(s=m.matchUps)?void 0:s.filter((e=>e.roundNumber===I)))?void 0:l.length)??0),y=U>0?U:0;return{...Be,availableMatchUpsCount:y,lastRoundNumber:h,roundMatchUpsCount:g}}function CU({drawDefinition:e}){var t;let i=Ds({name:"participantRepresentatives",element:e});return i.error?i:{representativeParticipantIds:(null==(t=i.extension)?void 0:t.value)||[]}}function OU({byeAdvancements:e=!1,tournamentRecord:t,drawDefinition:i}){if(!i)return{error:Ke};let{participantIds:n,participantIdMatchUps:r}=function({tournamentParticipants:e,drawDefinition:t,event:i}){if(!t)return{error:Ke};let n=Wo(uf({tournamentParticipants:e,inContext:!0,drawDefinition:t,event:i}).matchUps,!1,!0),r=hr(n.reduce(((e,t)=>e.concat(...t.sides.map((e=>e.participantId)).filter(Boolean))),[])),a=Object.assign({},...r.map((e=>{let t=n.filter((t=>t.sides.map((e=>e.participantId)).filter(Boolean).includes(e)));return{[e]:t}})));return{participantIds:r,participantIdMatchUps:a}}({tournamentParticipants:null==t?void 0:t.participants,drawDefinition:i}),a=(null==n?void 0:n.map((t=>{let i=r[t].filter((e=>[hl,ml].includes(e.matchUpStatus)||e.winningSide)),n=i.map((i=>{let n=i.sides.find((e=>e.bye)),r=i.sides.find((e=>e.participantId===t)).sideNumber;return(i.winningSide||e&&n&&r)===r?i.finishingPositionRange.winner:i.finishingPositionRange.loser})),a=e=>Math.abs(e[0]-e[1]),o=n.reduce(((e,t)=>e&&a(e)<a(t)?e:t),void 0);return{[t]:{relevantMatchUps:i,finishingPositionRanges:n,finishingPositionRange:o}}})))||[];return Object.assign({},...a)}function kU({tournamentRecords:e,tournamentRecord:t,tournamentId:i,drawId:n}){if(!t&&!e)return{error:We};if(!n)return{error:mt};if(!t&&e){if("string"!=typeof i&&!(i=lU({tournamentRecords:e,drawId:n})))return{error:ze};if(!(t=e[i]))return{error:We}}let r=t&&hm({tournamentRecord:t,drawId:n});return null!=r&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:t,...Be}:Sa({result:{error:Qe},stack:"findDrawDefinition"})}function FU(e){let{drawDefinition:t,error:i}=kU(e);return i?{error:i}:{drawDefinition:Wo(t)}}function xU({targetRoundNumber:e,finishingPosition:t,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=nf({drawDefinition:i,structureId:n})||{},o=((null==a?void 0:a.target)||[]).filter((({linkType:e})=>e===r)).filter((({target:t})=>!e||e===t.roundNumber)).map((e=>{let n=e.source.structureId,{structure:r}=_u({structureId:n,drawDefinition:i});if(!t||(null==r?void 0:r.finishingPosition)===t)return e})).filter(Boolean);return{sourceStructureIds:o.map((({source:e})=>e.structureId)),relevantLinks:o}}be(RU,{addGoesTo:()=>cf,allPlayoffPositionsFilled:()=>Wv,checkValidEntries:()=>zy,findDrawDefinition:()=>FU,getAssignedParticipantIds:()=>Xf,getAvailableMatchUpsCount:()=>EU,getAvailablePlayoffProfiles:()=>Jg,getDrawDefinitionTimeItem:()=>gf,getDrawParticipantRepresentativeIds:()=>CU,getDrawTypeCoercion:()=>Gy,getEligibleVoluntaryConsolationParticipants:()=>AU,getMatchUpsMap:()=>Wd,getParticipantIdFinishingPositions:()=>OU,getPositionAssignments:()=>$y,getPositionsPlayedOff:()=>Yg,getSeedingThresholds:()=>ov,getSeedsCount:()=>Hy,getStructureSeedAssignments:()=>Nc,getTeamLineUp:()=>Dm,getValidGroupSizes:()=>nv,isAdHoc:()=>Nm,isCompletedStructure:()=>qv,isValidForQualifying:()=>qy,positionActions:()=>Vy});var LU="qualifierDrawPositionAssignment",_U="withdrawParticipantAtDrawPosition",BU="alternateDrawPositionAssignment",jU="luckyLoserDrawPositionAssignment",VU="removeDrawPositionAssignment",GU="swapDrawPositionAssignments",$U="modifyPairAssignment",qU="modifyParticipantOtherName",WU="assignDrawPosition",HU="removeSeededParticipant",zU="assignDrawPositionBye",YU="modifySeedAssignment",KU="addPenalty",JU="MODIFY_PAIR",QU="QUALIFIER",ZU="ALTERNATE",XU="WITHDRAW",ey="ASSIGN",ty="REMOVE",iy="LUCKY",ny="REMOVE_SEED",ry="SWAP",ay="NICKNAME",oy="SEED_VALUE",sy="PENALTY",ly="BYE",uy={MODIFY_PAIR_ASSIGNMENT:JU,QUALIFYING_PARTICIPANT:QU,ALTERNATE_PARTICIPANT:ZU,WITHDRAW_PARTICIPANT:XU,ASSIGN_PARTICIPANT:ey,LUCKY_PARTICIPANT:iy,REMOVE_ASSIGNMENT:ty,SWAP_PARTICIPANTS:ry,ADD_NICKNAME:ay,REMOVE_SEED:ny,ADD_PENALTY:sy,ASSIGN_BYE:ly,SEED_VALUE:oy};function dy(e){var t,i;let{inContextDrawMatchUps:n,targetData:r,drawDefinition:a,relevantLink:o}=e;if((null==o?void 0:o.linkCondition)===ru&&(null==(t=null==r?void 0:r.matchUp)?void 0:t.matchUpStatus)===ml)return!1;let{targetMatchUps:{loserMatchUp:s,winnerMatchUp:l},targetLinks:u}=r,d=[gl,bl].includes(null==s?void 0:s.matchUpStatus),c=(null==(i=null==l?void 0:l.drawPositions)?void 0:i.filter(Boolean).length)||0;if(null!=s&&s.winningSide&&!d||null!=l&&l.winningSide&&2===c&&(!l.feedRound||![bl,gl].includes(null==l?void 0:l.matchUpStatus)))return!0;let p=s&&af({matchUpId:s.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),m=l&&af({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),f=p&&dy({relevantLink:null==u?void 0:u.loserTargetLink,targetData:p,inContextDrawMatchUps:n,drawDefinition:a});return!!(m&&dy({targetData:m,inContextDrawMatchUps:n,drawDefinition:a})||f)}var cy={[Jo]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ll,xl],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[ay,sy,QU,oy],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},py="positionAction",my="matchUpAction";function fy({actionType:e=py,appliedPolicies:t,drawDefinition:i,structure:n}){var r,a;let o=e===py&&Jo||e===my&&Qo,s=e===py&&cy||e===my&&bh,l=o&&((null==t?void 0:t[o])||(null==s?void 0:s[o])),u=(null==(a=null==(r=i.links)?void 0:r.filter((e=>{var t;return(null==(t=null==e?void 0:e.target)?void 0:t.structureId)===(null==n?void 0:n.structureId)})))?void 0:a.map((({target:e})=>e.feedProfile)))??[],{enabledStructures:d,disabledStructures:c}=l||{};return{enabledStructures:d,actionsDisabled:null==c?void 0:c.find((e=>{let{stages:t,stageSequences:i,structureTypes:r,feedProfiles:a}=e;return(!(null!=a&&a.length)||Array.isArray(a)&&a.some((e=>u.includes(e))))&&(!(null!=t&&t.length)||Array.isArray(t)&&(null==t?void 0:t.includes(null==n?void 0:n.stage)))&&(!(null!=r&&r.length)||Array.isArray(r)&&(null==r?void 0:r.includes(null==n?void 0:n.structureType)))&&(!(null!=i&&i.length)||Array.isArray(i)&&i.includes(null==n?void 0:n.stageSequence))})),actionsPolicy:l}}function hy({activePositionOverrides:e,activeDrawPositions:t,action:i}){return!(!i||!e.includes(i))||!t.length}function vy({enabledStructures:e,drawDefinition:t,structure:i}){var n,r;if(!1===e)return{};if(null==e||!e.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=(null==(r=null==(n=t.links)?void 0:n.filter((e=>{var t;return(null==(t=null==e?void 0:e.target)?void 0:t.structureId)===(null==i?void 0:i.structureId)})))?void 0:r.map((({target:e})=>e.feedProfile)))||[];return{policyActions:e.find((e=>{let{stages:t,stageSequences:i,structureTypes:n,feedProfiles:r}=e||{},u=!(null!=t&&t.length)||Array.isArray(t)&&t.includes(a),d=!(null!=i&&i.length)||Array.isArray(i)&&i.includes(o),c=!(null!=n&&n.length)||Array.isArray(n)&&n.includes(s),p=!(null!=r&&r.length)||Array.isArray(r)&&r.some((e=>l.includes(e)));return d&&c&&p&&e&&u}))}}function gy({action:e,policyActions:t}){var i;let n=!(null!=t&&t.enabledActions)||(null==(i=null==t?void 0:t.disabledActions)?void 0:i.length)&&t.disabledActions.includes(e);return!n&&((0===(null==t?void 0:t.enabledActions.length)||(null==t?void 0:t.enabledActions.includes(e)))&&!n)}var Iy="replaceTieMatchUpParticipantId",Uy="assignTieMatchUpParticipantId",yy="removeTieMatchUpParticipantId",Sy="assignMatchUpSideParticipant",wy="removeMatchUpSideParticipant",Ty="substituteParticipant",Py="REMOVE_SUBSTITUTION",Dy="REPLACE_PARTICIPANT",by="REMOVE_PARTICIPANT",My="setMatchUpStatus",Ny="SUBSTITUTION",Ry="SCHEDULE",Ay="REFEREE",Ey="STATUS",Cy="START",Oy="SCORE",ky="END",Fy={REPLACE_TEAM_POSITION_METHOD:Iy,ASSIGN_TEAM_POSITION_METHOD:Uy,REMOVE_TEAM_POSITION_METHOD:yy,REPLACE_PARTICIPANT:Dy,SUBSTITUTION_METHOD:Ty,REMOVE_SUBSTITUTION:Py,REMOVE_PARTICIPANT:by,SCHEDULE_METHOD:My,SUBSTITUTION:Ny,SCHEDULE:Ry,PENALTY:"PENALTY",REFEREE:Ay,STATUS:Ey,SCORE:Oy,START:Cy,END:ky};function xy({restrictQualifyingAlternates:e,structure:t,entry:i}){let{stage:n}=t;if(!i.entryStage||i.entryStage===n||n===Ll&&!e||i.entryStage===xl&&n===_l)return!0}function Ly({restrictAdHocRoundParticipants:e,tournamentParticipants:t,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:u,drawId:d,event:c}){var p,m,f,h,v;let g=[],I=((null==l?void 0:l.matchUps)??[]).filter((({roundNumber:e})=>e===u.roundNumber)),U=(null==(p=null==r?void 0:r.entries)?void 0:p.filter((({entryStatus:e})=>e&&Sc.includes(e))).map(sl))??[],y=I.map((e=>(e.sides??[]).flatMap(sl))).flat().filter(Boolean),S=U.filter((t=>!(i.includes(t)||e&&y.includes(t)))),w=null==t?void 0:t.filter((e=>null==S?void 0:S.includes(e.participantId))).map((e=>Wo(e,void 0,!0)));null==w||w.forEach((e=>{let t=(r.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),S.length&&g.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},method:Sy,type:ey,availableParticipantIds:S,participantsAvailable:w});let T=function({eventEntries:e,structure:t}){return e.filter((e=>e.entryStatus===oc&&xy({structure:t,entry:e}))).sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))).map(sl)}({eventEntries:(null==c?void 0:c.entries)??[],structure:l}),P=hr(U.concat(T));if(n){let e=null==(f=null==(m=c?fm({event:c}):void 0)?void 0:m.flights)?void 0:f.filter((e=>e.drawId!==d)).flatMap((e=>e.drawEntries.filter((e=>e.participantId&&![Ic,hc,vc].includes(e.entryStatus))).map((({participantId:e})=>e)))).filter(Boolean);null!=e&&e.length&&P.push(...e)}P=P.filter((t=>!(i.includes(t)||S.includes(t)||e&&y.includes(t))));let D=null==t?void 0:t.filter((e=>P.includes(e.participantId))).map((e=>Wo(e,void 0,!0)));return null==D||D.forEach((e=>{let t=(r.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null==D||D.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),P.length&&g.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:P,participantsAvailable:D,method:Sy,type:oc}),!kf(u)&&o&&null!=(v=null==(h=u.sides)?void 0:h.find((e=>e.sideNumber===o)))&&v.participantId&&g.push({payload:{drawId:d,matchUpId:s,structureId:a,sideNumber:o},method:wy,type:by}),g}function _y(e){var t,i,n,r,a,o,s,l,u;if(!e)return{error:Fn};let{drawDefinition:d,event:c}=e,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:m,enforceGender:f,participantId:h,sideNumber:v,matchUpId:g}=e,I=e.tournamentRecord??(e.tournamentId&&Ee(e.tournamentId)&&(null==(t=e.tournamentRecords)?void 0:t[e.tournamentId]));if(!I)return{error:We};if(!g||!Ee(g))return{error:Qt};if(v&&![1,2].includes(v))return Sa({result:{error:Fn},context:{sideNumber:v}});if(!d){let e=(Rf({tournamentRecord:I}).matchUps??[]).find((e=>e.matchUpId===g));c=((null==I?void 0:I.events)??[]).find((t=>t.eventId===(null==e?void 0:e.eventId)));let t=((null==c?void 0:c.drawDefinitions)??[]).find((t=>t.drawId===(null==e?void 0:e.drawId)));t&&(d=t)}if(!d)return{error:Ke};let U=vh({withIndividualParticipants:!0,tournamentRecord:I}).participants,{drawId:y}=d,{matchUp:S,structure:w}=OI({drawDefinition:d,matchUpId:g,event:c});if(!S)return{error:Xt};let T=jc({tournamentRecord:I,drawDefinition:d,structure:w,event:c}).appliedPolicies??{};Object.assign(T,m??{});let P=null==(i=null==T?void 0:T[Jo])?void 0:i.otherFlightEntries,D=(null==T?void 0:T[Qo])??Mh[Qo],{enabledStructures:b}=fy({actionType:my,appliedPolicies:T,drawDefinition:d,structure:w}),{policyActions:M}=vy({enabledStructures:b,drawDefinition:d,structure:w}),N=e.matchUpsMap??Wd({drawDefinition:d}),R=e.inContextDrawMatchUps??uf({tournamentParticipants:U,inContext:!0,drawDefinition:d,matchUpsMap:N,event:c}).matchUps,A=null==R?void 0:R.find((e=>e.matchUpId===g)),E=v&&(null==(n=null==A?void 0:A.sides)?void 0:n.find((e=>e.sideNumber===v))),C=(null==(r=null==A?void 0:A.sides)?void 0:r.map((e=>{var t;return e.participantId||(null==(t=e.participant)?void 0:t.participantid)})).filter(Boolean))??[],{assignedPositions:O,allPositionsAssigned:k}=Gu({structure:w}),{structureId:F}=w??{},x=[];if(!F)return{validActions:x};let L=Nm({structure:w}),_=S.collectionId;if(L&&!_){let e=Ly({restrictAdHocRoundParticipants:p,tournamentParticipants:U,matchUpParticipantIds:C,otherFlightEntries:P,drawDefinition:d,structureId:F,sideNumber:v,matchUpId:g,structure:w,matchUp:S,drawId:y,event:c});x.push(...e)}let B=qv({drawDefinition:d,structure:w}),j=null==O?void 0:O.filter((e=>e.participantId)).map((e=>e.drawPosition)),V=null==O?void 0:O.filter((e=>e.bye)).map((e=>e.drawPosition)),G=S.matchUpStatus===ml||!_&&(null==(a=S.drawPositions)?void 0:a.reduce(((e,t)=>(null==V?void 0:V.includes(t))||e),!1));if(G)return{validActions:x,isByeMatchUp:G};gy({policyActions:M,action:Ay})&&x.push({type:Ay,payload:{matchUpId:g}});let $=!Ff({matchUpStatus:S.matchUpStatus}),q=null==(o=null==T?void 0:T.scoring)?void 0:o.structures,W=(null==w?void 0:w.stage)&&(null==q?void 0:q.stage)&&(null==q?void 0:q.stage[w.stage]),H=(null==w?void 0:w.stageSequence)&&(null==W?void 0:W.stageSequence)&&W.stageSequence[w.stageSequence],z=!(null!=(s=null==T?void 0:T.scoring)&&s.requireAllPositionsAssigned||null!=W&&W.requireAllPositionsAssigned||null!=H&&H.requireAllPositionsAssigned)||k,Y=S.sides&&2===S.sides.filter((e=>null==e?void 0:e.participantId)).length,K=S.matchUpStatus&&[Ul,Il].includes(S.matchUpStatus),J=dy({inContextDrawMatchUps:R,drawDefinition:d,targetData:af({inContextDrawMatchUps:R,drawDefinition:d,matchUpId:g})}),Q=(2===(null==(l=null==A?void 0:A.drawPositions)?void 0:l.length)&&A.drawPositions.every((e=>null==j?void 0:j.includes(e)))&&2===(null==(u=null==A?void 0:A.sides)?void 0:u.length)&&A.sides.every((({participantId:e})=>e))||Y)&&!(K&&J),Z={method:KU,type:sy,payload:{drawId:y,matchUpId:g,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if($&&x.push({payload:{drawId:y,matchUpId:g,schedule:{}},method:My,type:Ry}),gy({policyActions:M,action:sy})&&(null!=E&&E.participant||!v&&null!=C&&C.length)&&x.push(Z),$&&Q&&x.push({type:Ey}),z&&Q){let{matchUpId:e,matchUpFormat:t}=S,i={drawId:y,matchUpId:e,matchUpFormat:t,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};x.push({info:"set outcome and winningSide",method:My,type:Oy,payload:i}),gy({policyActions:M,action:Cy})&&x.push({type:Cy}),gy({policyActions:M,action:ky})&&x.push({type:ky})}if(_&&A){let e=function({specifiedPolicyDefinitions:e,inContextDrawMatchUps:t,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:u,matchUp:d,drawId:c,side:p}){var m,f,h,v,g,I,U,y,S,w,T,P,D,b,M;let N=[],R=null==(m=r.sides)?void 0:m.find((e=>e.participant)),A=r.gender===Ym&&r.sideNumber&&1===(null==(f=r.sides)?void 0:f.filter((e=>e.particiapntId)).length)&&(null==(v=null==(h=null==R?void 0:R.participant)?void 0:h.person)?void 0:v.sex),E=r.matchUpType,C=!1!==(o??(null==(g=null==n?void 0:n.participants)?void 0:g.enforceGender))?r.gender:void 0,O=null==(U=null==(I=r.sides)?void 0:I.flatMap((e=>{var t;return(null==(t=e.participant)?void 0:t.individualParticipants)||e.participant})).filter(Boolean))?void 0:U.map(sl),k=null==(y=r.sides)?void 0:y.filter((e=>!l||e.sideNumber===l)).flatMap((e=>{var t;return(null==(t=e.participant)?void 0:t.individualParticipants)||e.participant})).filter(Boolean),F=null==k?void 0:k.map(sl),x=null==(w=null==(S=null==t?void 0:t.find((e=>e.matchUpId===r.matchUpTieId)))?void 0:S.sides)?void 0:w.map((e=>{var t;return null==(t=e.participant)?void 0:t.individualParticipants.filter((({participantId:e,person:t})=>!(null!=F&&F.includes(e))&&(!C||C===Hm||t.sex===C||C===Ym&&!A||A&&t.sex!==A)))})),L=l?null==x?void 0:x[l-1]:null==x?void 0:x.map(((e,t)=>({participants:e,sideNumber:t+1}))),_=l?null==(T=null==x?void 0:x[l-1])?void 0:T.map(sl):null==x?void 0:x.map(((e,t)=>({participants:null==e?void 0:e.map(sl),sideNumber:t+1}))),B=l&&(wp(Rd)(E)&&!(null!=F&&F.length)||wp(Ed)(E)&&((null==F?void 0:F.length)??0)<2)||!l&&(wp(Rd)(E)&&((null==F?void 0:F.length)??0)<2||wp(Ed)(E)&&((null==F?void 0:F.length)??0)<4),j=null==_?void 0:_.filter((e=>!(null!=O&&O.includes(e)))),V=null==L?void 0:L.filter((({participantId:e})=>j.includes(e)));if(B&&null!=j&&j.length&&N.push({availableParticipantIds:j,method:Uy,availableParticipants:V,type:ey,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:l,drawId:c}}),null!=F&&F.length&&(!kf(d)||null!=(P=null==p?void 0:p.substitutions)&&P.length)&&N.push({method:yy,type:by,existingParticipantIds:F,payload:{participantId:void 0,tieMatchUpId:u,drawId:c}}),null!=V&&V.length&&(!l&&null!=F&&F.length||l&&null!=p&&p.participant)&&N.push({availableParticipantIds:j,method:Iy,availableParticipants:V,type:Dy,existingParticipantIds:F,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:c}}),gy({policyActions:a,action:Py})&&(null==(D=null==p?void 0:p.substitutions)?void 0:D.length)){let e=(null==(b=p.participant)?void 0:b.participantType)===Qd&&[p.participantId]||(null==(M=p.participant)?void 0:M.participantType)===Xd&&p.participant.individualParticipantIds||[],t=p.substitutions.map((e=>e.participantId)).filter((t=>e.includes(t)));(!s||t.includes(s))&&N.push({method:yy,type:Py,substitutedParticipantIds:t,payload:{participantId:void 0,tieMatchUpId:u,drawId:c}})}let G=null==e?void 0:e[Qo],$=null==G?void 0:G.substituteWithoutScore,q=null==G?void 0:G.substituteAfterCompleted;if(gy({policyActions:a,action:Ny})&&2===i.length&&(!l&&null!=F&&F.length||l&&null!=p&&p.participant)&&($||kf(d))&&(q||d.matchUpStatus&&!Cl.includes(d.matchUpStatus))&&null!=k&&k.length&&L.length){let e=k.map(sl);N.push({info:"list of team players available for substitution",method:Ty,availableParticipantIds:_,existingParticipantIds:e,availableParticipants:L,existingParticipants:k,type:Ny,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:u,drawId:c}})}return N}({specifiedPolicyDefinitions:m,inContextDrawMatchUps:R,matchUpParticipantIds:C,matchUpActionsPolicy:D,inContextMatchUp:A,policyActions:M,enforceGender:f,participantId:h,sideNumber:v,matchUpId:g,matchUp:S,drawId:y,side:E});x.push(...e)}return{structureIsComplete:B,validActions:x,isDoubleExit:K,...Be}}function By(e,t){return e.bye||sv(e.seedValue)<sv(t.seedValue)||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function jy({onlyAssignedPositions:e=!0,possiblyDisablingAction:t,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:u,drawPosition:d,structureId:c,structure:p,drawId:m,event:f}){if(r.includes(d))return{};let h=null==n?void 0:n.filter((e=>e!==d&&!(u&&s.includes(e)))),v=(null==a?void 0:a.filter((t=>(t=>!e||t.participantId||t.qualifier||t.bye)(t)&&(null==h?void 0:h.includes(t.drawPosition)))))??[],g=v.map((({drawPosition:e})=>e)),{matchUps:I}=Zm({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),U=I.filter((({drawPositions:e})=>Ar(e,g))),y=Object.assign({},...U.map((e=>{var t;return null==(t=e.sides)?void 0:t.filter((({sourceDrawPositionRange:e})=>e)).map((({drawPosition:e,sourceDrawPositionRange:t})=>({[e]:t})))})).flat()),S=v.map((e=>e.participantId)).filter(Boolean),w=(i??[]).filter((e=>S.includes(e.participantId))),T=Object.assign({},...w.map((e=>({[e.participantId]:e})))),P=v.map((e=>{let t=null==T?void 0:T[e.participantId],i=y[e.drawPosition];return ya({...e,participant:o?Wo(t,!1,!0):void 0,sourceDrawPositionRange:i})}));return P.length?{validSwapAction:{payload:{drawId:m,structureId:c,drawPositions:[d]},willDisableLinks:t,method:GU,type:ry,availableAssignments:P}}:{}}function Vy(e){var t;let i=io(e,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:n,returnParticipants:r=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:u}=e,d=e.tournamentParticipants??(o&&vh({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],c=_u({structureId:e.structureId,drawDefinition:s});if(c.error)return c;let p=c.containingStructure||c.structure;if(!p)return{error:bt};let m=p.structureId;if(c=_f({drawDefinition:s,structureId:m}),void 0===l&&!c.isAdHoc)return{error:lt};if(c.isAdHoc)return _y(e);if(c.error)return c;let{drawPositionInitialRounds:f,inactiveDrawPositions:h,activeDrawPositions:v,byeDrawPositions:g}=c,I=jc({tournamentRecord:o,drawDefinition:s,structure:p,event:u}).appliedPolicies??{};Object.assign(I,n??{});let U,{actionsPolicy:y,enabledStructures:S,actionsDisabled:w}=fy({actionType:py,appliedPolicies:I,drawDefinition:s,structure:p}),T=(null==y?void 0:y.activePositionOverrides)||[],{sourceStructureIds:P}=xU({finishingPosition:Eu,targetRoundNumber:1,linkType:tu,drawDefinition:s,structureId:m})||{};null!=P&&P.length&&(U=P.reduce(((e,t)=>qv({structureId:t,drawDefinition:s})&&e),!0));let D=P.length,b=P.length&&!U,{policyActions:M}=vy({enabledStructures:S,drawDefinition:s,structure:p}),N=![Ll,xl].includes(p.stage)||1!==p.stageSequence,{drawId:R}=s,A=[],{assignedPositions:E,positionAssignments:C}=Gu({structure:p}),O=null==E?void 0:E.find((e=>e.drawPosition===l));if(null==(t=null==C?void 0:C.map((e=>e.drawPosition)))||!t.includes(l))return{error:st};let{stage:k,stageSequence:F}=p,x=[k];k===_l&&x.push(xl),k===xl&&x.push(_l);let L=Mc({entryStatuses:Sc,provisionalPositioning:a,drawDefinition:s,stageSequence:F,structureId:m,stages:x}),_=Xf({drawDefinition:s,stages:x}).assignedParticipantIds??[],B=L.filter((e=>!_.includes(e.participantId))).map((e=>e.participantId)),j=g.includes(l),V=v.includes(l);if(w)return{hasPositionAssigned:!!O,info:"Actions Disabled for structure",isActiveDrawPosition:V,isDrawPosition:!0,validActions:[],isByePosition:j};if(gy({policyActions:M,action:ey})&&!V&&C&&!b&&(!O||j)){let{validAssignmentActions:e}=function({positionSourceStructureIds:e,unassignedParticipantIds:t,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:u,seedingProfile:d,isByePosition:c,drawPosition:p,structureId:m,event:f}){var h,v,g;let I,U,{drawId:y}=u,S=[],w=[],T=null==(v=null==(h=null==l?void 0:l[as])?void 0:h.validSeedPositions)?void 0:v.ignore;if(T||({unplacedSeedParticipantIds:I,unplacedSeedAssignments:U,unfilledPositions:w}=pv({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:d,structureId:m,event:f})),null!=w&&w.length||(w=o.filter((e=>!e.participantId&&!e.bye&&!e.qualifier)).map((e=>e.drawPosition))),c||S.push({payload:{drawId:y,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:zU,type:ly}),a&&T){let t=o.map((e=>e.participantId)).filter(Boolean),n={structureIds:e},{completedMatchUps:a}=df({inContext:!0,matchUpFilters:n,drawDefinition:u}),l=hr(null==(g=(a??[]).filter((({matchUpType:e})=>(null==f?void 0:f.eventType)!==$p||e===$p)))?void 0:g.map((({sides:e})=>null==e?void 0:e.map(sl))).flat().filter((e=>e&&!t.includes(e)))),d=s?null==r?void 0:r.filter((e=>null==l?void 0:l.includes(e.participantId))).map((e=>Wo(e,void 0,!0))):void 0;return null==d||d.forEach((e=>{let t=(u.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null!=d&&d.length&&S.push(ya({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:WU,type:ey,availableParticipantIds:l,participantsAvailable:d})),{validAssignmentActions:S}}if(w.includes(p)||c){let e;if(null!=U&&U.length){let t=U.filter((e=>null==I?void 0:I.includes(e.participantId)));t.sort(By),e=t.map((e=>e.participantId))}else e=t;let n=s?null==r?void 0:r.filter((t=>e.includes(t.participantId))).map((e=>Wo(e,void 0,!0))):void 0;null!=n&&n.length&&S.push(ya({payload:{drawId:y,structureId:m,drawPosition:p},willDisableLinks:i,method:WU,type:ey,availableParticipantIds:e,participantsAvailable:n}))}return{validAssignmentActions:S}}({positionSourceStructureIds:P,unassignedParticipantIds:B,possiblyDisablingAction:N,isWinRatioFedStructure:D,tournamentParticipants:d,positionAssignments:C,returnParticipants:r,appliedPolicies:I,drawDefinition:s,isByePosition:j,drawPosition:l,structureId:m,event:u});null==e||e.forEach((e=>A.push(e)))}if(gy({policyActions:M,action:QU})){let{validAssignmentActions:e}=function({drawPositionInitialRounds:e,tournamentParticipants:t,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var u,d,c;let p=[],m=[],f=[],h=[],v=i.map((e=>e.participantId)).filter(Boolean),g=null==r?void 0:r[Jo],I=!(null!=g&&g.disableRoundRestrictions)&&e[o],U=null==g?void 0:g.requireCompletedStructures,{sourceStructureIds:y,relevantLinks:S}=xU({targetRoundNumber:I,linkType:iu,drawDefinition:a,structureId:s})||{};null!=y&&y.length&&h.push(...y);let{sourceStructureIds:w,relevantLinks:T}=xU({targetRoundNumber:I,linkType:tu,drawDefinition:a,structureId:s})||{};null!=w&&w.length&&h.push(...w);for(let P of S){let e=null==(u=a.structures)?void 0:u.find((e=>e.structureId===P.source.structureId));if((null==e?void 0:e.stage)!==Ll)continue;let i=qv({structureId:P.source.structureId,drawDefinition:a});if(!U||i){let i=e.qualifyingRoundNumber,{matchUps:r}=Zm({matchUpFilters:{roundNumbers:[i],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:t,inContext:!0,structure:e});for(let e of r){let t=e.sides.find((t=>(null==t?void 0:t.sideNumber)===e.winningSide)),i=e.matchUpStatus===ml&&(null==(d=e.sides)?void 0:d.find((({participantId:e})=>e)));if(t||i){let{participantId:e,participant:r}=t||i||{};e&&!v.includes(e)&&(r&&n&&p.push(r),m.push(e))}}}}for(let P of T){let e=null==(c=a.structures)?void 0:c.find((e=>e.structureId===P.source.structureId));if((null==e?void 0:e.stage)!==Ll)continue;let i=qv({structureId:P.source.structureId,drawDefinition:a});if(!U||i){let{positionAssignments:i}=Vu({structure:e}),r=(null==i?void 0:i.map((e=>{var t;let i=e.participantId,n=null==(t=Ds({element:e,name:zs}).extension)?void 0:t.value;return n?{participantId:i,groupOrder:null==n?void 0:n.groupOrder}:{}})).filter((({groupOrder:e,participantId:t})=>1===e&&!v.includes(t))).map((({participantId:e})=>e)))??[];if(r&&m.push(...r),n){let e=t.filter((({participantId:e})=>r.includes(e)));p.push(...e)}}}return m.length&&f.push(ya({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:LU,type:QU,qualifyingParticipantIds:m,qualifyingParticipants:n?p:void 0})),{validAssignmentActions:f,sourceStructureIds:h}}({drawPositionInitialRounds:f,tournamentParticipants:d,positionAssignments:C,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:l,structureId:m,drawId:R});null==e||e.forEach((e=>A.push(e)))}let{participantId:G}=O||{},$=G&&d.find((e=>e.participantId===G));if(O){gy({policyActions:M,action:ty})&&!V&&(A.push({type:ty,method:VU,payload:{drawId:R,structureId:m,drawPosition:l},willDisableLinks:N}),j||A.push({type:XU,method:_U,payload:{drawId:R,structureId:m,drawPosition:l},willDisableLinks:N}),gy({policyActions:M,action:ly})&&!j&&A.push({type:ly,method:VU,payload:{drawId:R,structureId:m,drawPosition:l,replaceWithBye:!0},willDisableLinks:N}));let e=p.stage===Ll||p.stage===xl&&1===p.stageSequence;if(!j&&hy({activePositionOverrides:T,activeDrawPositions:v,action:oy})&&gy({policyActions:M,action:oy})&&cv({drawDefinition:s,structureId:m,drawPosition:l})&&e){let{seedAssignments:e}=Nc({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:t,seedValue:i}=(null==e?void 0:e.find((e=>e.participantId===G)))??{};A.push({type:oy,method:YU,participant:$,seedNumber:t,payload:{drawId:R,structureId:m,participantId:G,seedValue:i}})}if(!j&&hy({activePositionOverrides:T,activeDrawPositions:v,action:ny})&&gy({policyActions:M,action:ny})&&cv({drawDefinition:s,structureId:m,drawPosition:l})&&e){let{seedAssignments:e}=Nc({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:t}=(null==e?void 0:e.find((e=>e.participantId===G)))??{};A.push({method:HU,type:ny,participant:$,seedNumber:t,payload:{participantId:G,structureId:m,drawId:R}})}if(!j&&G){if(gy({policyActions:M,action:sy})){let e={type:sy,method:KU,participant:$,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:R}};A.push(e)}if(gy({policyActions:M,action:ay})){let e={type:ay,method:qU,participant:$,payload:{participantId:G,otherName:void 0}};A.push(e)}}if(gy({policyActions:M,action:ry})){let{validSwapAction:e}=jy({possiblyDisablingAction:N,tournamentParticipants:d,inactiveDrawPositions:h,activeDrawPositions:v,positionAssignments:C,returnParticipants:r,byeDrawPositions:g,drawDefinition:s,isByePosition:j,drawPosition:l,structureId:m,structure:p,drawId:R});e&&A.push(e)}}if(gy({policyActions:M,action:ZU})&&!b){let{validAlternatesAction:e}=function({tournamentParticipants:e=[],possiblyDisablingAction:t,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:u,structure:d,drawId:c,event:p}){var m,f,h,v,g;if(i.includes(s))return{};let I=null==(m=l.find((e=>e.type===ey)))?void 0:m.availableParticipantIds,U=null==(f=null==a?void 0:a[Jo])?void 0:f.otherFlightEntries,y=null==(h=null==a?void 0:a[Jo])?void 0:h.restrictQualifyingAlternates,S=(o.entries??[]).filter((({entryStage:e})=>!y||(d.stage===Ll?e===Ll:e!==Ll))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((({participantId:e})=>e)).filter(Boolean),{allPositionedParticipantIds:w}=ju({drawDefinition:o}),T=n.map((e=>e.participantId)).filter(Boolean),P=S.filter((e=>d.stage&&[Ll,xl,jl].includes(d.stage)?!(null!=w&&w.includes(e)):!T.includes(e))),D=((null==p?void 0:p.entries)??[]).filter((e=>e.entryStatus===oc&&xy({restrictQualifyingAlternates:y,structure:d,entry:e})&&(d.stage&&[Ll,xl,jl].includes(d.stage)?!(null!=w&&w.includes(e.participantId)):!T.includes(e.participantId)))).sort(((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0))).map((e=>e.participantId)),b=hr(P.concat(D));if(U){let e=null==(g=null==(v=p?fm({event:p}).flightProfile:void 0)?void 0:v.flights)?void 0:g.filter((e=>e.drawId!==c)).map((e=>e.drawEntries.filter((e=>e.participantId&&![Ic,hc,vc].includes(e.entryStatus)&&!S.includes(e.participantId))).map((({participantId:e})=>e)))).flat().filter(Boolean);null!=e&&e.length&&b.push(...e)}null!=I&&I.length&&(b=b.filter((e=>!I.includes(e))));let M=r?null==e?void 0:e.filter((e=>b.includes(e.participantId))):void 0;return null==M||M.forEach((e=>{let t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null==M||M.sort(((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0))),b.length?{validAlternatesAction:ya({payload:{drawId:c,structureId:u,drawPosition:s},willDisableLinks:t,method:BU,availableAlternatesParticipantIds:b,type:ZU,availableAlternates:M})}:{}}({possiblyDisablingAction:N,tournamentParticipants:d,positionAssignments:C,activeDrawPositions:v,returnParticipants:r,appliedPolicies:I,drawDefinition:s,drawPosition:l,validActions:A,structureId:m,structure:p,drawId:R,event:u});e&&A.push(e)}if(gy({policyActions:M,action:iy})&&!b&&C){let{validLuckyLosersAction:e}=function({tournamentParticipants:e=[],sourceStructuresComplete:t,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:u,drawId:d,event:c}){var p,m,f,h,v,g,I;if(r.includes(s)||n&&!t)return{};let{sourceStructureIds:U,targetStructureIds:y}=(null==(p=o.links)?void 0:p.reduce(((e,t)=>{var i,n;let r=null==(i=t.source)?void 0:i.structureId,a=null==(n=t.target)?void 0:n.structureId;return e.sourceStructureIds.includes(r)||e.sourceStructureIds.push(r),e.targetStructureIds.includes(a)||e.targetStructureIds.push(a),e}),{sourceStructureIds:[],targetStructureIds:[]}))||{},S=[],w=(null==(m=o.links)?void 0:m.filter((e=>{var t;return(null==(t=e.target)?void 0:t.structureId)===u.structureId})))??[];for(let P of w){let e=null==(f=null==P?void 0:P.source)?void 0:f.structureId,{structure:t}=_u({structureId:e,drawDefinition:o}),i={};if((null==t?void 0:t.finishingPosition)===Cu&&(1!==(null==U?void 0:U.length)||1!==(null==y?void 0:y.length))){let{matchUps:e}=Zm({drawDefinition:o,structure:u,event:c}),{initialRoundNumber:t}=Bf({drawPosition:s,matchUps:e}),n=null==(g=null==(v=null==(h=o.links)?void 0:h.find((e=>{var i;return(null==(i=e.target)?void 0:i.structureId)===(null==u?void 0:u.structureId)&&e.target.roundNumber===t})))?void 0:v.source)?void 0:g.roundNumber;i.roundNumbers=[n]}let{completedMatchUps:n}=ef({structureId:e,inContext:!0,matchUpFilters:i,drawDefinition:o}),r=a.map((e=>e.participantId)).filter(Boolean);null==(I=null==n?void 0:n.filter((({matchUpType:e,winningSide:t})=>t&&((null==c?void 0:c.eventType)!==$p||e===$p))).map((({winningSide:e,sides:t})=>e&&(null==t?void 0:t[1-(e-1)]))).map(sl).filter((e=>e&&!r.includes(e))))||I.forEach((e=>{S.includes(e)||S.push(e)}))}let T=null==e?void 0:e.filter((e=>null==S?void 0:S.includes(e.participantId)));return null==T||T.forEach((e=>{let t=(o.entries??[]).find((t=>t.participantId===e.participantId));e.entryPosition=null==t?void 0:t.entryPosition})),null!=S&&S.length?{validLuckyLosersAction:{type:iy,method:jU,availableLuckyLosers:T,availableLuckyLoserParticipantIds:S,willDisableLinks:i,payload:{drawId:d,structureId:l,drawPosition:s}}}:{}}({sourceStructuresComplete:U,possiblyDisablingAction:N,isWinRatioFedStructure:D,tournamentParticipants:d,activeDrawPositions:v,positionAssignments:C,drawDefinition:s,drawPosition:l,structureId:m,structure:p,drawId:R});e&&A.push(e)}if((null==$?void 0:$.participantType)===Xd&&gy({policyActions:M,action:JU})){let{validModifyAssignedPairAction:e}=function({tournamentParticipants:e,returnParticipants:t,drawPosition:i,participant:n,drawId:r,event:a}){var o;let s=(null==(o=null==a?void 0:a.entries)?void 0:o.filter((({entryStatus:e})=>[hc,vc].includes(e))).map((({participantId:e})=>e)))||[];if(s.length){let a=n.individualParticipantIds,o=t?e.filter((({participantId:e})=>s.includes(e))):void 0,l=t?e.filter((({participantId:e})=>a.includes(e))):void 0;return{validModifyAssignedPairAction:ya({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:$U,availableIndividualParticipantIds:s,availableIndividualParticipants:o,existingIndividualParticipantIds:a,existingIndividualParticipants:l,type:JU},!1,!1,!0)}}return{}}({tournamentParticipants:d,returnParticipants:r,drawPosition:l,participant:$,drawId:R,event:u});e&&A.push(e)}return{hasPositionAssigned:!!O,isActiveDrawPosition:V,isDrawPosition:!0,isByePosition:j,validActions:A,...Be}}function Gy({policyDefinitions:e,appliedPolicies:t,drawType:i}){var n,r;let a=null==(n=null==e?void 0:e[ss])?void 0:n.drawTypeCoercion,o=null==(r=null==t?void 0:t[ss])?void 0:r.drawTypeCoercion;return("boolean"==typeof a?a:void 0)??(i&&(null==a?void 0:a[i]))??("boolean"==typeof o?o:void 0)??(i&&(null==o?void 0:o[i]))??!0}function $y({tournamentRecord:e,drawDefinition:t,stage:i=xl,structureId:n,structure:r}){var a;if(!e)return{error:We};if(!r&&!t)return{error:Ke};if(!r&&!n&&1===(null==(a=null==t?void 0:t.structures)?void 0:a.filter((e=>e.stage===i)).length)&&(r=t.structures.find((e=>e.stage===i))),!r&&!n)return{error:Dt};let{error:o,positionAssignments:s}=Vu({drawDefinition:t,structureId:n,structure:r});return{positionAssignments:s??[],structureId:null==r?void 0:r.structureId,error:o}}function qy({structureId:e,drawDefinition:t}){if(!t)return{error:Ke};if(!Ee(e))return{error:Fn};let i=nf({drawDefinition:t,structureId:e});if(i.error)return i;let n=i.links.target.flatMap((e=>e.target.feedProfile)).filter(Boolean),r=!Nr([eu,Xl,Zl,Yl],n).length;return{...Be,valid:r}}function Wy({participantsCount:e,participantCount:t}){if(!(e=e??t))return{error:Fn};let i=cr(e);return i?{drawSize:i}:Sa({result:{error:Fn},stack:"getEliminationDrawSize",context:{participantsCount:e}})}function Hy(e){let{drawSizeProgression:t=!1,policyDefinitions:i,drawSize:n}=e||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:o,event:s}=e||{},l="getSeedsCount",u=(null==e?void 0:e.participantsCount)??(null==e?void 0:e.participantCount);if(!i){let e=Vc({tournamentRecord:a,drawDefinition:o,event:s});if(e.error)return Sa({result:e,stack:l});i=e.policyDefinitions}let d=mr(u);if(u&&!d)return Sa({result:{error:Fn},context:{participantsCount:u},stack:l});if(r&&!d)return Sa({result:{error:$i},stack:l});if(isNaN(n)){if(!u)return Sa({result:{error:pt},stack:l});({drawSize:n}=Wy({participantsCount:u}))}let c=r&&u||n;if(c&&c>n)return{error:Yi};let p=null==i?void 0:i[as];if(!p)return{error:si};let m=p.seedsCountThresholds;return m?(void 0!==p.drawSizeProgression&&(t=p.drawSizeProgression),{seedsCount:m.filter((e=>t?e.drawSize<=n:n===e.drawSize)).reduce(((e,t)=>u&&u>=t.minimumParticipantCount?t.seedsCount:e),0)}):{error:gt}}function zy({consideredEntries:e,policyDefinitions:t,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:o,event:s}){var l;if((!o||!r)&&i&&({participants:o,participantMap:r}=vh({tournamentRecord:i})),!o)return{error:Li};if(!Array.isArray(o))return{error:Fn};if(!s)return{error:Et};let u=(null==t?void 0:t[Qo])??(null==n?void 0:n[Qo])??Mh[Qo],d=!1!==(a??(null==(l=null==u?void 0:u.participants)?void 0:l.enforceGender)),{eventType:c,gender:p}=s,m=c===Gp,f=c===qp&&ec||m&&Xd||Qd,h=Object.assign({},...(e??s.entries??[]).map((e=>({[e.participantId]:e.entryStatus})))),v=Object.keys(h),g=o.filter((e=>v.includes(e.participantId))).filter((e=>{let t=function({participant:e,participantType:t,eventType:i,entryStatusMap:n}){let r=n[e.participantId],a=i&&[Gp,qp].includes(i)&&e.participantType===Qd&&(th(r)||r===Ic);return e.participantType!==t&&!a}({participant:e,participantType:f,eventType:c,entryStatusMap:h}),i=function(e){var t,i,n;let{participant:r,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:u}=e,d=!s&&l&&hr((null==(t=null==r?void 0:r.individualParticipantIds)?void 0:t.map((e=>{var t,i,n;return null==(n=null==(i=null==(t=null==a?void 0:a[e])?void 0:t.participant)?void 0:i.person)?void 0:n.sex})).filter(Boolean))??[])||[],c=!o||!(null!=d&&d.length)||Hm===o||[zm,Jm].includes(o)&&d[0]===o||Ym===o&&(1==d.length&&1===(null==(i=r.individualParticipantIds)?void 0:i.length)||2===d.length),p=null==(n=null==r?void 0:r.person)?void 0:n.sex,m=!(null!=r&&r.person)||!o||[Hm,Ym].includes(o)||[zm,Jm].includes(o)&&p===o;return!u||c&&m}({genderEnforced:d,participantMap:r,eventGender:p,participant:e,isDoubles:m,mismatch:t});return t||!i}));if(g.length){let e=g.map((e=>e.participantId));return{error:Ft,invalidParticipantIds:e}}return{...Be,valid:!0}}function Yy({qualifyingProfiles:e,appliedPolicies:t,idPrefix:i,isMock:n,uuids:r}){var a;let o,s=[],l=[],u=[],d=(e,t)=>e.stageSequence-t.stageSequence,c=(e,t)=>e.roundTarget-t.roundTarget,p=0,m=0,f=1;for(let h of e.sort(c)){let c=h.structureProfiles||[];f=h.roundTarget||f;let v,g,I,U=1,y=0;for(let s of(c||[]).sort(d)){let d,m,h,S=sr(s.drawSize||s.participantsCount),{qualifyingRoundNumber:w,structureOptions:T,matchUpFormat:P,structureName:D,structureId:b,drawType:M}=s,N=s.matchUpType,R=s.qualifyingPositions||Ky({drawSize:S,qualifyingRoundNumber:w});if(!mr(S))return Sa({result:{error:pt},stack:"generateQualifyingSTructures"});let A=e.length>1?`${f}-`:"",E=c.length>1||A?U:"",C=D||(A||E?`${Yh(Ll)} ${A}${E}`:Yh(Ll));if(M===Du){let{structures:e,groupCount:a,maxRoundNumber:l}=iv({structureName:s.structureName||C,structureId:b||(null==r?void 0:r.pop()),stage:Ll,structureOptions:T,appliedPolicies:t,stageSequence:U,matchUpType:N,roundTarget:f,drawSize:S,idPrefix:i,isMock:n,uuids:r});y=a,d=l,m=e[0],o=[1]}else({drawSize:S,matchUps:h,roundLimit:d}=_g({qualifyingRoundNumber:w,qualifyingPositions:R,matchUpType:N,drawSize:S,idPrefix:i,isMock:n,uuids:r})),m=Jh({structureName:s.structureName||C,structureId:b||(null==r?void 0:r.pop()),qualifyingRoundNumber:d,stage:Ll,matchUpFormat:P,stageSequence:U,matchUpType:N,roundLimit:d,matchUps:h}),f&&fs({extension:{name:Gs,value:f},element:m}),y=(null==(a=null==h?void 0:h.filter((e=>e.roundNumber===d)))?void 0:a.length)||0;if(U>1){let{link:e}=Fg({sourceStructureId:g,sourceRoundNumber:v,targetStructureId:m.structureId,finishingPositions:I===tu?[1]:void 0,linkType:I});u.push(e),p+=(S||0)-y}else p+=S||0;I=M===Du?tu:iu,g=m.structureId,v=d,l.push(m),U+=1}m+=y,s.push({qualifiersCount:y,finalQualifyingRoundNumber:v,finalQualifyingStructureId:g,finishingPositions:o,roundTarget:f,linkType:I}),f+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...Be,links:u}}function Ky({drawSize:e,qualifyingRoundNumber:t}){let i=e,n=0;for(;n<t;)i=Math.floor(i/2),n+=1;return i}function Jy(e){let{drawTypeCoercion:t,enforceMinimumDrawSize:i}=e,n=rr(e.drawSize),r=t&&("boolean"==typeof t||t<=2)&&2===n&&uu||e.drawType||uu,a=Ou.includes(r);if(n&&a)if(t&&("boolean"==typeof t&&n<4||n<=t))r=uu;else if(n<4&&i)return{...Sa({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:dt},stack:"getCoercedDrawType"}),drawType:r};return{drawType:r}}function Qy({structureName:e,matchUpType:t,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let o=[],{matchUps:s}=Gg({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:t,idPrefix:i,isMock:r}),l=Kh({structureName:e||Yh(xl),structureId:null==a?void 0:a.pop(),stageSequence:1,stage:xl,matchUpType:t,matchUps:s});o.push(l);let u=n/2,{matchUps:d}=Gg({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:t,isMock:r,uuids:a}),c=Kh({structureName:Yh(Nu),matchUps:d,structureId:null==a?void 0:a.pop(),stage:_l,stageSequence:2,matchUpType:t});o.push(c);let{matchUps:p}=_g({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:t,isMock:r}),m=Kh({structureName:Yh(Mu),matchUps:p,structureId:null==a?void 0:a.pop(),stageSequence:3,stage:jl,matchUpType:t});o.push(m);let f=function({mainStructure:e,consolationStructure:t,deciderStructure:i}){let n=t.matchUps.reduce(((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e),[]),r=e.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0),a=t.matchUps.reduce(((e,t)=>!e||t.roundNumber>e?t.roundNumber:e),void 0);return[...n.map(((i,r)=>{let a=n.indexOf(i)%2?Xl:eu;return{linkType:nu,source:{roundNumber:1+r,structureId:e.structureId},target:{feedProfile:a,roundNumber:i,structureId:t.structureId}}})),{linkType:iu,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:Xl,roundNumber:r,structureId:e.structureId}},{linkType:iu,source:{roundNumber:r,structureId:e.structureId},target:{feedProfile:Xl,roundNumber:1,structureId:i.structureId}},{linkType:nu,source:{roundNumber:r,structureId:e.structureId},target:{feedProfile:Xl,roundNumber:1,structureId:i.structureId}}]}({mainStructure:l,consolationStructure:c,deciderStructure:m});return{structures:o,links:f,...Be}}function Zy(e){let{qualifyingRoundNumber:t,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:l}=e;if(!mr(o)||o<2)return{matchUps:[],roundsCount:0};if(ar(o))return _g(e);let u=function(e){let t=rr(e),i=t%2?t+1:t,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let e=Math.ceil(i/2),t=1===e,n=!(t||!(e%2));i=!t&&n?e+1:e;let a=!!(2!==i&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:a,feedRound:n})}return r}(o),d=u.shift(),c=br(1,((null==d?void 0:d.participantsCount)||0)+1).map((e=>({drawPosition:e}))),p=[],m=1;({matchUps:p}=Lg({roundNumber:m,matchUpType:r,idPrefix:a,matchUps:p,isMock:s,nodes:c,uuids:l})),m++;let f=e.roundLimit||t;for(let v of u){let e=v.participantsCount/2,t=br(1,e+1);n&&e===n&&(f=m-1);let i=t.map((e=>{let t=xg({roundPosition:e,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:e,roundNumber:m,matchUpId:t}}));p.push(...i),m++}let h=m-1;return p=qd({finishingPositionOffset:i,lucky:!0,roundsCount:h,roundLimit:f,matchUps:p}),f&&(p=p.filter((e=>e.roundNumber<=f))),{matchUps:p,roundsCount:h,roundLimit:f}}function Xy(e){var t,i;let{playoffAttributes:n,stageSequence:r=1,stage:a=xl,matchUpType:o,drawSize:s,uuids:l}=e,u=e.structureId||(e.isMock||e.idPrefix?`${e.drawDefinition.drawId}-s-0`:void 0)||(null==l?void 0:l.pop()),d=e.appliedPolicies??jc(e),c=(null==(t=e.policyDefinitions)?void 0:t[os])||(null==d?void 0:d[os]);e.skipRounds=e.skipRounds||s<=4&&(null!=c&&c.feedFromMainFinal?0:1)||0;let p=e.structureName??(null==(i=null==n?void 0:n[0])?void 0:i.name)??Yh(xl);return{generators:{[au]:()=>({structures:[Jh({finishingPosition:Eu,stageSequence:r,structureName:p,matchUps:[],matchUpType:o,structureId:u,stage:a})],links:[],...Be}),[mu]:()=>{let{matchUps:t}=Zy(e);return{structures:[Jh({stageSequence:r,structureName:p,matchUpType:o,structureId:u,matchUps:t,stage:a})],links:[],...Be}},[uu]:()=>(()=>{let{matchUps:t}=_g(e);return{structures:[Jh({stageSequence:r,structureName:p,matchUpType:o,structureId:u,matchUps:t,stage:a})],links:[],...Be}})(),[du]:()=>Qy(e),[su]:()=>$g({...e,roundOffsetLimit:3,playoffAttributes:n??Ru}),[lu]:()=>$g({...e,roundOffsetLimit:2,playoffAttributes:n??Au}),[jl]:()=>$g(e),[ou]:()=>{let{matchUps:e}=Gg({drawSize:s,uuids:l,matchUpType:o});return{structures:[Jh({stageSequence:r,structureName:p,matchUpType:o,structureId:u,stage:xl,matchUps:e})],links:[],...Be}},[pu]:()=>Zg(e),[cu]:()=>tI({...e,feedRounds:1,fmlc:!0}),[wu]:()=>tI({...e,feedRounds:1}),[vu]:()=>tI({...e,feedsFromFinal:1}),[Iu]:()=>tI({...e,feedsFromFinal:2}),[yu]:()=>tI({...e,feedsFromFinal:3}),[Pu]:()=>tI(e),[fu]:()=>eI(e),[Du]:()=>iv(e),[bu]:()=>function(e){let{drawDefinition:t,structureOptions:i,requireSequential:n}=e,r={structureName:Yh(xl),...e,stage:xl},{structures:a,groupCount:o,groupSize:s}=iv(r);if(o<1)return{error:An};let l=(null==i?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:Yh(jl)}],[u]=a,{structures:d,links:c}=iI({sourceStructureId:u.structureId,requireSequential:n,drawDefinition:t,playoffGroups:l,groupCount:o,groupSize:s,...e});return d&&a.push(...d),{...Be,structures:a,links:c}}(e)}}}function eS(e){var t,i,n,r,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:u,drawDefinition:d,tieFormat:c,isMock:p,uuids:m}=e||{},f=rr(e.drawSize),h=e.drawTypeCoercion??Gy({appliedPolicies:l,drawType:e.drawType}),v=Jy({drawType:e.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:h,drawSize:f});if(v.error)return v;let g=v.drawType,I=[],U=[],y=(null==e?void 0:e.matchUpType)??Ad,S=null==(t=null==d?void 0:d.structures)?void 0:t.filter((({stage:e})=>e===Ll));S&&I.push(...S);let w=null==S?void 0:S.map((({structureId:e})=>e)),T=null==(i=null==d?void 0:d.structures)?void 0:i.find((({stage:e,stageSequence:t})=>e===xl&&1===t)),P=null==(n=null==d?void 0:d.links)?void 0:n.filter((e=>e.target.structureId===(null==T?void 0:T.structureId)&&(null==w?void 0:w.includes(e.source.structureId)))),D=(e,t)=>{var i;if(e.linkType===tu&&null!=t&&t.structures){let i=e.source.finishingPositions||[];return t.structures.length*i.length}if(e.linkType===iu&&null!=(i=null==t?void 0:t.matchUps)&&i.length){let i=e.source.roundNumber;return t.matchUps.filter((({roundNumber:e})=>e===i)).length}},b=null==S?void 0:S.map((e=>{var t,i,n;let r=null==P?void 0:P.find((t=>t.target.structureId===e.structureId)),a=(null==(i=null==(t=Vu({structure:e}))?void 0:t.positionAssignments)?void 0:i.length)??0;if(!r)return a;let o=null==r?void 0:r.source.structureId,s=null==(n=d.structures)?void 0:n.find((e=>e.structureId===o));return a-(D(r,s)||0)})).filter(Boolean).reduce(((e,t)=>e+t),0),M=null==P?void 0:P.map((e=>{let t=e.source.structureId,i=null==S?void 0:S.find((e=>e.structureId===t));return D(e,i)})).filter(Boolean).reduce(((e,t)=>e+t),0),N=!(!T||null!=(r=null==T?void 0:T.matchUps)&&r.length);if(null!=S&&S.length&&!N)return{error:zn};let R=!(null!=S&&S.length)&&e.qualifyingProfiles,A=(null==R?void 0:R.length)&&Yy({idPrefix:e.idPrefix,qualifyingProfiles:R,appliedPolicies:l,isMock:p,uuids:m});if(null!=A&&A.error)return A;let{qualifyingDrawPositionsCount:E,qualifyingDetails:C,qualifiersCount:O}=A||{qualifyingDrawPositionsCount:b,qualifiersCount:M};E&&(null!=A&&A.structures&&I.push(...A.structures),null!=A&&A.links&&U.push(...A.links)),Object.assign(e,ya({drawSize:f,matchUpType:y,tieFormat:c}));let k=g!==au&&(!f||f<2||!u&&![ou,mu].includes(g)&&([bu,Du].includes(g)&&f<3||![Du,bu].includes(g)&&!ar(f)));if(k&&!E)return Sa({context:{drawSize:f,invalidDrawSize:k},result:{error:dt},stack:"generateDrawStructuresAndLinks"});let{generators:F,error:x}=Xy(e);if(x)return{error:x};let L=F[g];if(!L)return{error:rt};let _=null==L?void 0:L();if(_.error)return _;let{structures:B,links:j}=_;if(null!=B&&B.length){let e=B.find((({stage:e,stageSequence:t})=>e===xl&&1===t));if(T&&e)if(N){let t=e.structureId;if(e.structureId=T.structureId,null==j?void 0:j.length)for(let e of j)e.source.structureId===t&&(e.source.structureId=T.structureId),e.target.structureId===t&&(e.target.structureId=T.structureId)}else if(!s)return{error:zn};I.push(...B)}I.sort(xu),null!=j&&j.length&&U.push(...j);let V=_.structures.find((({stage:e,stageSequence:t})=>e===xl&&1===t));for(let G of C||[]){let{finalQualifyingRoundNumber:e,finalQualifyingStructureId:t,roundTarget:i,finishingPositions:n,linkType:r}=G,o=V&&(null==(a=Fg({targetStructureId:V.structureId,sourceStructureId:t,sourceRoundNumber:e,finishingPositions:n,targetEntryRound:i,linkType:r}))?void 0:a.link);if(null!=o&&o.error)return o;o&&U.push(o)}return P&&U.push(...P),{...Be,qualifyingResult:{qualifyingDrawPositionsCount:E,qualifiersCount:O},structures:I,links:U}}function tS(e){var t,i;let{modifyOriginal:n=!0,stageSequence:r=1,isMock:a}=e||{},o="generateDrawTypeAndModifyDrawDefinition";if(!e.drawDefinition)return Sa({result:{error:Ke},stack:o});let s=n?e.drawDefinition:Wo(e.drawDefinition,!1,!0),{tieFormat:l,matchUpType:u}=e;if(l){let e=nU({tieFormat:l});if(e.error)return e}l=oU(l??(null==(t=Um({drawDefinition:s}))?void 0:t.tieFormat)),u=u??(s.matchUpType||Ad),e.tieFormat=l,e.matchUpType=u;let d=Uh({drawDefinition:s,stage:xl});e.drawSize=e.drawSize??d,!d&&e.drawSize&&Eg({drawSize:e.drawSize,drawDefinition:s,stageSequence:r,stage:xl});let c=Wd({drawDefinition:s}).drawMatchUps.map(ll),p=eS(e);if(p.error)return Sa({result:p,stack:o});let{structures:m,links:f,qualifyingResult:h}=p;s.structures=m,s.links=f;let v=Math.max(e.qualifiersCount??0,(null==h?void 0:h.qualifiersCount)||0);if(null!=h&&h.qualifyingDrawPositionsCount&&!Uh({stage:Ll,drawDefinition:s})){let e=Eg({drawSize:h.qualifyingDrawPositionsCount,stage:Ll,drawDefinition:s});if(e.error)return e}if(v){let e=Cg({qualifiersCount:v,drawDefinition:s,stage:xl});if(e.error)return e}let g=e.drawSize??d;Object.assign(e,ya({drawSize:g,matchUpType:u,tieFormat:l}));let{matchUps:I,matchUpsMap:U}=uf({drawDefinition:s});l&&(null==I||I.forEach((e=>{if(!c.includes(e.matchUpId)){let{tieMatchUps:t}=rI({tieFormat:l,matchUp:e,isMock:a});Object.assign(e,{tieMatchUps:t,matchUpType:u})}})));let{inContextDrawMatchUps:y}=cf({drawDefinition:s,matchUpsMap:U});return wd({tournamentId:null==(i=e.tournamentRecord)?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:y,drawDefinition:s,matchUpsMap:U,...Be,structures:m,matchUps:I,links:f}}function iS(e){let{tournamentRecord:t,scaleAttributes:i,participantId:n}=e,r=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!n)return{error:_i};let{participant:a,tournamentId:o}=hf({tournamentRecords:r,tournamentRecord:t,participantId:n});return a?{...rh({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Bi}}function nS(e){let t,i,{removePriorValues:n,tournamentRecord:r,participantId:a,scaleItem:o}=e;if(!aS({scaleItem:o}))return{error:Dn};if(a&&Array.isArray(r.participants)&&(i=r.participants.find((e=>e.participantId===a)),i)){let e=oS({removePriorValues:n,participant:i,scaleItem:o});if(e.error)return e;t=!e.valueChanged;let{topics:a}=sa();a.includes(nd)&&ia({topic:nd,payload:{tournamentId:r.tournamentId,participants:[i]}})}return t&&{...Be,info:jn,existingValue:null==o?void 0:o.scaleValue}||i&&{...Be,newValue:null==o?void 0:o.scaleValue}||{error:Bi}}function rS(e){var t;let{scaleItemsWithParticipantIds:i=[],removePriorValues:n,tournamentRecord:r,auditData:a,context:o}=e;if(!r)return{error:We};if(!r.participants)return{error:Li};let s=0,l={},u=[];for(let p of i){let e=null==p?void 0:p.participantId;if(Array.isArray(null==p?void 0:p.scaleItems))for(let t of p.scaleItems){if(!aS({scaleItem:t}))return{error:Dn};Array.isArray(l[e])||(l[e]=[]),l[e].push(t)}}r.participants.forEach((e=>{let{participantId:t}=e||{};Array.isArray(l[t])&&l[t].forEach((t=>{oS({participant:e,scaleItem:t,removePriorValues:n}),u.push(e),s++}))}));let d=s?void 0:Mn,{topics:c}=sa();if(c.includes(nd)&&s&&ia({topic:nd,payload:{tournamentId:r.tournamentId,participants:u}}),o){let{eventId:e,drawId:i,...n}=o,a=(null==(t=n.scaleAttributes)?void 0:t.scaleType)&&[n.scaleAttributes.scaleType];if(Object.keys(n).length){let t={itemType:Hu,itemValue:n};if(a&&(t.itemSubTypes=a),i||e){let{drawDefinition:n,event:a}=hm({tournamentRecord:r,eventId:e,drawId:i});i&&bg({drawDefinition:n,timeItem:t}),e&&Tg({event:a,timeItem:t})}else wg({tournamentRecord:r,timeItem:t})}}return a&&c.includes(Yu)&&ia({topic:Yu,payload:a}),ya({...Be,modificationsApplied:s,info:d})}function aS({scaleItem:e}){let t=e&&Object.keys(e),i=["scaleType","eventType","scaleName"];return i.filter((e=>null==t?void 0:t.includes(e))).length===i.length}function oS({removePriorValues:e,participant:t,scaleItem:i}){if(!t)return{error:xi};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter((e=>n.includes(e)&&i[e])).length!==r.length)return{error:Dn};let a=(new Date).toISOString();t.timeItems||(t.timeItems=[]);let{scaleItem:o}=rh({scaleAttributes:i,participant:t}),s=e=>[void 0,null,""].includes(e),l=!(s(null==o?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(null==o?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:n,eventType:r,scaleName:o}=i,s=[so,n,r,o].join("."),l=ya({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:s});i.scaleId&&(l.itemSubTypes=[i.scaleId]),e&&(t.timeItems=t.timeItems.filter((e=>e.itemType!==s))),t.timeItems.push(l)}return{...Be,valueChanged:l,newValue:i.scaleValue}}var sS="ELO",lS="NTRP",uS="WTN",dS={ELO:sS,NTRP:lS,TRN:"TRN",UTR:"UTR",WTN:uS},cS={[sS]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[lS]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[uS]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}};var pS={nSpread:400,diffThreshold:.125,kCalc:e=>250/Math.pow(e+5,.4),kMultiplier:function(e=3,t=2){let i=e/t;return isNaN(i)?pS.kDefault():i},kDefault:()=>1};function mS(e){let{winnerRating:t,loserRating:i,ratingRange:n}=e,{ratings:r=cS,winnerCountables:a=1,loserCountables:o=0,ratingType:s=sS,maxCountables:l,countables:u}=e||{},d=null==r?void 0:r[s];if(!d)return{error:mi};n=d.range||n,t=t||d.defaultInitialization,i=i||d.defaultInitialization;let c=n[0]>n[1],p=d.decimalsCount||0,m=c?n.slice().reverse():n,f=(e,t)=>parseFloat(t)>=Math.min(...e)&&parseFloat(t)<=Math.max(...e);(!f(n,t)||!f(n,i))&&(f(n,t)||(t=d.defaultInitialization),f(n,i)||(i=d.defaultInitialization));let h=({value:e,sourceRange:t,targetRange:i})=>(e-t[0])*(i[1]-i[0])/(t[1]-t[0])+i[0],v=h({targetRange:cS[sS].range,sourceRange:m,value:c?n[0]-t:t}),g=h({targetRange:cS[sS].range,sourceRange:m,value:c?n[0]-i:i}),I=(e,t)=>1/(1+Math.pow(10,(t-e)/pS.nSpread)),U=I(v,g),y=I(g,v),S=pS.kCalc(a),w=pS.kCalc(o),T=pS.kMultiplier(l,u),P=v+T*S*(1-U),D=g+T*w*(0-y),b=h({sourceRange:cS[sS].range,value:P,targetRange:m}),M=h({sourceRange:cS[sS].range,value:D,targetRange:m}),N=c?n[0]-b:b,R=parseFloat(parseFloat(N).toFixed(p)),A=c?n[0]-M:M,E=parseFloat(parseFloat(A).toFixed(p)),C=Math.max(...n)?Math.abs(t-i)/Math.max(...n):0;return(b>M&&C>pS.diffThreshold||R<0||E<0)&&(R=t,E=i),{newWinnerRating:R,newLoserRating:E}}var fS=e=>(null==e?void 0:e.reduce(((e,t)=>(t.winningSide&&(e[t.winningSide-1]+=1),e)),[0,0]))||[0,0];function hS(e){var t,i;let{removePriorValues:n=!0,tournamentRecord:r,ratingType:a=sS,considerGames:o,matchUpIds:s,asDynamic:l}=e;if(!r)return{error:We};if(!Array.isArray(s))return{error:ei};if("string"!=typeof a)return{error:Fn,ratingType:a};if(!cS[a])return{error:Fn};let u=cS[a],{accessor:d}=u,c={},p=e.matchUps??Rf({matchUpFilters:{matchUpIds:s,matchUpStatuses:Cl},tournamentRecord:r,inContext:!0}).matchUps??[];p.sort(Ef);for(let f of p){let{endDate:e,matchUpFormat:s,score:u,sides:p,winningSide:m}=f,h=f.matchUpType,v={eventType:h,scaleName:a,scaleType:oo},g=`${a}.${ro}`,I={scaleName:g,eventType:h,scaleType:oo},U=Object.assign({},...(p??[]).map((e=>{let{sideNumber:t,participant:i}=e;return t&&{[t]:[null==i?void 0:i.participantId,...(null==i?void 0:i.individualParticipantIds)??[]].filter(Boolean).flat()}}))),y=l?g:a,S=Object.assign({},...Object.values(U).flat().map((t=>{let{scaleItem:i}=iS({scaleAttributes:I,tournamentRecord:r,participantId:t}),{scaleItem:n}=iS({tournamentRecord:r,scaleAttributes:v,participantId:t});return t&&{[t]:i??n??{scaleName:y,eventType:h,scaleDate:e,scaleType:oo,scaleValue:d?{[d]:void 0}:void 0}}}))),w=s?xm(s):{},T=(null==w?void 0:w.bestOf)||1,P=(null==w?void 0:w.setsTo)||1,D=o?T&P:T,b=(null==u?void 0:u.sets)&&fS(u.sets)||1===m&&[1,0]||[0,1],M=m?U[m]:[],N=m?U[3-m]:[];for(let o of M){let e=null==(t=S[o])?void 0:t.scaleValue,s="object"==typeof e?e[d]:e;for(let t of N){let l=null==(i=S[t])?void 0:i.scaleValue,u="object"==typeof l?l[d]:l,c=m?b[m]:[0,0],p=m?b[3-m]:[0,0],{newWinnerRating:f,newLoserRating:h}=mS({winnerCountables:c,loserCountables:p,maxCountables:D,winnerRating:s,loserRating:u,ratingType:a}),v=d?{...e,[d]:f}:f,g=d?{...l,[d]:h}:h;S[o].scaleValue=v,S[t].scaleValue=g;let I=nS({participantId:o,removePriorValues:n,tournamentRecord:r,scaleItem:{...S[o],scaleName:y}});if(I.error||(I=nS({participantId:t,removePriorValues:n,tournamentRecord:r,scaleItem:{...S[t],scaleName:y}}),I.error))return I}}Object.assign(c,S)}let m=p.map((({matchUpId:e})=>e));return{...Be,modifiedScaleValues:c,processedMatchUpIds:m}}function vS(e){var t;let{matchUpIds:i=[],drawDefinition:n,roundNumber:r,newRound:a,isMock:o,event:s}=e;if("object"!=typeof n)return{error:Ke};let{participantIdPairings:l,matchUpsCount:u}=e,d=EU(e);if(d.error)return Sa({result:d});let{lastRoundNumber:c,availableMatchUpsCount:p=0,roundMatchUpsCount:m=0}=d;if(u){if(u>m&&!1!==e.restrictMatchUpsCount)return Sa({result:{error:Fn,info:"matchUpsCount error",context:{roundMatchUpsCount:m}}})}else a?u=m:p>0&&(u=p);if(l&&!Array.isArray(l)||u&&!mr(u)||i&&!Array.isArray(i)||!l&&!u)return{error:Fn,info:"matchUpsCount or pairings error"};if(u&&!1!==e.restrictMatchUpsCount&&u>32)return{error:Fn,info:"matchUpsCount must be less than 33"};if(r&&!e.ignoreLastRoundNumber&&r-1>(c||0))return{error:Fn,info:"roundNumber error"};let f=r??(a&&(c??0)+1||c||1);l=l??br(0,u).map((()=>({participantIds:[void 0,void 0]})));let h=null==l?void 0:l.map(((t,r)=>{let a=(null==t?void 0:t.participantIds)??[void 0,void 0];a.push(void 0,void 0);let o=a.slice(0,2).map(((e,t)=>ya({sideNumber:t+1,participantId:e}))),s=i[r]??(t=>{if(!e.idPrefix)return;return`${n.drawId}-${e.idPrefix??"ah"}-${f}-${t}`})(r)??am();return{roundNumber:f,matchUpStatus:Dl,matchUpId:s,sides:o}}));if(null!=h&&h.length){let e=null==(t=Um({drawDefinition:n,event:s}))?void 0:t.tieFormat;e&&h.forEach((t=>{let{tieMatchUps:i}=rI({tieFormat:e,matchUp:t,isMock:o});Object.assign(t,{tieMatchUps:i,matchUpType:kd})}))}return{roundNumber:f,matchUpsCount:(null==h?void 0:h.length)??0,matchUps:h,...Be}}function gS(e){return e.participantIdPairings.map((({participantIds:e})=>e.sort().join("|"))).sort().join("/")}function IS({valueSortedPairings:e,stipulated:t=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let o=[].concat(...t),s=[],l=0;t.filter(Boolean).forEach((e=>{let[t,n]=e,r=US(t,n),a=i[r];s.push({participantIds:e,value:a}),l+=i[r]})),Or(e,a).map((e=>gr(e).map((e=>({...e,value:e.value+Math.random()*Math.round(Math.random())}))))).flat().forEach((e=>{let t=e.pairing.split("|");if(!t.reduce(((e,t)=>o.includes(t)||e),!1)){o.push(...t);let i=e.value;l+=i,s.push({participantIds:t,value:i})}})),s.sort(((e,t)=>e.value-t.value));let u=s.reduce(((e,t)=>{let[i,r]=t.participantIds,a=US(i,r),o=n[a];return o>e?o:e}),0),d=s.reduce(((e,t)=>{let[i,n]=t.participantIds,a=US(i,n),o=r[a];return o>e?o:e}),0);return{value:l,participantIdPairings:s,maxDelta:u,maxDiff:d}}function US(e,t){return[e,t].sort(sh).join("|")}function yS({participantIds:e}){let t={},i=[];e.forEach((n=>{t[n]=e.filter((e=>e!==n)),t[n].forEach((e=>{let t=US(e,n);i.includes(t)||i.push(t)}))}));let n=Object.assign({},...i.map((e=>({[e]:0}))));return{uniquePairings:i,possiblePairings:t,deltaObjects:n}}var SS=0;function wS({tournamentParticipants:e,adHocRatings:t={},possiblePairings:i,uniquePairings:n,maxIterations:r,deltaObjects:a,valueObjects:o,eventType:s,scaleName:l,salted:u}){n.forEach((i=>{let n=function({tournamentParticipants:e,adHocRatings:t,eventType:i,scaleName:n,pairing:r}){var a;let o=(null==(a=cS[n])?void 0:a.defaultInitialization)??SS;return r.split("|").map((n=>{var r;if(i===Vp){let i=null==(r=null==e?void 0:e.find((e=>e.participantId===n)))?void 0:r.individualParticipantIds;return i?null==i?void 0:i.map((e=>t[e]||o)):2*o}return t[n]||o}))}({tournamentParticipants:e,adHocRatings:t,scaleName:l,eventType:s,pairing:i}),r="number"==typeof u&&u||.5,d=u&&(Math.round(Math.random())?r:-1*r)||0,c=Math.abs(n[0]-n[1])+d,p=Math.abs(n[0]-n[1]);a[i]=p,o[i]||(o[i]=0),o[i]+=c?Math.pow(c,2):0}));let d=n.map((e=>({pairing:e,value:o[e]}))).sort(((e,t)=>e.value-t.value)),{pairingValues:c}=function({possiblePairings:e,valueObjects:t}){let i={};for(let r of Object.keys(e)){let t=e[r].map((e=>n(r,e)));i[r]=t.sort(((e,t)=>e.value-t.value))}function n(e,i){let n=US(e,i);return{opponent:i,value:t[n]}}return{pairingValues:i}}({possiblePairings:i,valueObjects:o}),{candidate:p,candidatesCount:m,deltaCandidate:f,iterations:h}=function({maxIterations:e=4e3,valueSortedPairings:t,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...t.map((e=>({[e.pairing]:e.value})))),o=Object.keys(i),s=[],l=IS({actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:r,valueObjects:n}),u=[gS(l)];s.push(l);let d,c=l.value,p=l,m=0,f=0,h=o.length;do{h-=1,d=o.length*i[o[0]].length}while(d>e&&h>5);let v=[];o.forEach((e=>{i[e].slice(0,h).forEach((i=>{f+=1;let l=US(e,i.opponent);if(!v.includes(l)){let d=IS({stipulated:[[e,i.opponent]],actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!u.includes(gS(d))){u.push(gS(d)),s.push(d);let{maxDelta:e,value:t}=d;e<p.maxDelta&&(p=d),(t<c||t===c&&Math.round(Math.random()))&&(c=t),v.push(l),m+=1}}})),s=s.filter((e=>Math.abs(e.value-c)<5))})),s.sort(((e,t)=>e.maxDiff-t.maxDiff));let g=Pr(s);return{candidatesCount:m,deltaCandidate:p,maxIterations:e,iterations:f,candidate:g}}({valueSortedPairings:d,maxIterations:r,pairingValues:c,deltaObjects:a,valueObjects:o}),{participantIdPairings:v}=p;return{participantIdPairings:v,candidatesCount:m,deltaCandidate:f,iterations:h,candidate:p}}var TS=100,PS=100,DS=4e3;function bS({encounterValue:e=TS,sameTeamValue:t=PS,maxIterations:i=DS,generateMatchUps:n=!0,ignoreLastRoundNumber:r,iterationMatchUps:a,tournamentRecord:o,dynamicRatings:s,participantIds:l,drawDefinition:u,adHocRatings:d,salted:c=.5,roundNumber:p,structureId:m,matchUpIds:f,eventType:h,structure:v,scaleName:g,idPrefix:I,isMock:U,event:y}){var S,w;if(!u)return{error:Ke};if(!v&&!m)return{error:bt};if(v||(v=_u({drawDefinition:u,structureId:m}).structure),!Ce(v))return{error:Nt};if(null==l||!l.length)return{error:Gi};let T=[...a??[],...(null==v?void 0:v.matchUps)??[]],{encounters:P}=function({matchUps:e}){let t=[];for(let i of e){let e=i.sides.map(sl);if(2===e.length){let[i,n]=e,r=US(i,n);t.includes(r)||t.push(r)}}return{encounters:t}}({matchUps:T}),D=(null==o?void 0:o.participants)??[];if(s){let e=hr(null!=v&&v.matchUps?v.matchUps.map((({roundNumber:e})=>e)):[]),t=Math.max(...e,0);if(t){let e=null==(S=null==v?void 0:v.matchUps)?void 0:S.filter((({roundNumber:e})=>e===t)).map((({matchUpId:e})=>e));hS({ratingType:g||(null==(w=null==y?void 0:y.category)?void 0:w.ratingType),tournamentRecord:o,asDynamic:!0,matchUpIds:e})}}let b,M,{valueObjects:N}=function({encounters:e,tournamentParticipants:t,encounterValue:i,sameTeamValue:n}){let r={};for(let o of e)r[o]||(r[o]=0),r[o]+=i;let a=null==t?void 0:t.filter((({participantType:e})=>e===ec));if(a)for(let o of a){let e=o.individualParticipantIds??[],{uniquePairings:t}=yS({participantIds:e});for(let i of t)r[i]||(r[i]=0),r[i]+=n}return{valueObjects:r}}({tournamentParticipants:D,encounterValue:e,sameTeamValue:t,encounters:P}),{uniquePairings:R,possiblePairings:A,deltaObjects:E}=yS({participantIds:l}),C={tournamentParticipants:D,possiblePairings:A,drawDefinition:u,participantIds:l,uniquePairings:R,maxIterations:i,adHocRatings:d,deltaObjects:E,valueObjects:N,eventType:h,scaleName:g,structure:v,salted:c},{candidatesCount:O,participantIdPairings:k,iterations:F,candidate:x}=wS(C);if(!O)return{error:Rn};if(n){let e=vS({structureId:null==v?void 0:v.structureId,ignoreLastRoundNumber:r,participantIdPairings:k,newRound:!0,drawDefinition:u,roundNumber:p,matchUpIds:f,idPrefix:I,isMock:U,event:y});if(e.error)return e;b=e.roundNumber,M=e.matchUps}let{maxDelta:L,maxDiff:_}=x;return{roundNumber:b,participantIdPairings:k,candidatesCount:O,...Be,iterations:F,matchUps:M,maxDelta:L,maxDiff:_}}function MS(e){var t,i,n,r;let{drawType:a=uu,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:u,automated:d,placeByes:c,isMock:p,event:m}=e,f=null==e?void 0:e.drawDefinition;if(!f)return{error:Ke};let h=Bl,v=Mc({stageSequence:1,drawDefinition:f,stage:h}),g=[Du,du,bu].includes(a)?v.length:cr(v.length);if(!u&&a===ou&&v.length<2||a===Du&&v.length<3)return{error:dt};let{tieFormat:I,matchUpType:U}=e;if(I){let e=nU({tieFormat:I});if(e.error)return e}I=oU(I??(null==(t=Um({drawDefinition:f}))?void 0:t.tieFormat)),U=U??f.matchUpType??Ad;let{structures:y}=Bu({stageSequence:1,drawDefinition:f,stage:h});if(y.length>1)return{error:Bt};if(null!=(n=null==(i=null==y?void 0:y[0])?void 0:i.matchUps)&&n.length)return{error:Yn};let S=null==(r=null==y?void 0:y[0])?void 0:r.structureId;Object.assign(e,ya({structureName:e.structureName??Yh(Bl),structureId:S,matchUpType:U,tieFormat:I,drawSize:g,stage:h}));let w=Xy(e);if(w.error)return w;let T=w.generators[a];if(!T)return{error:rt};let P=null==T?void 0:T();if(P.error)return P;let{structures:D,links:b}=P,M=D.map((e=>Zm({structure:e}).matchUps)).flat();I&&M.forEach((e=>{let{tieMatchUps:t}=rI({matchUp:e,tieFormat:I,isMock:p});Object.assign(e,{tieMatchUps:t,matchUpType:U})})),(!s||!o)&&(f=Wo(f,!1,!0)),f.links||(f.links=[]),b.length&&f.links.push(...b);let N=D.map((({structureId:e})=>e));f.structures||(f.structures=[]);let R=f.structures.map((({structureId:e})=>e));f.structures=f.structures.map((e=>N.includes(e.structureId)?D.find((({structureId:t})=>t===e.structureId)):e));let A=D.filter((({structureId:e})=>!R.includes(e)));return A.length&&f.structures.push(...A),d&&hg({seedingProfile:e.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:f,structureId:S,placeByes:c,drawSize:g,event:m}),o&&wd({drawDefinition:f}),{links:b,structures:D,...Be}}var NS={};be(NS,{addGame:()=>jS,addPoint:()=>BS,addSet:()=>GS,addShot:()=>VS,analyzeSet:()=>yT,calculateHistoryScore:()=>FS,checkScoreHasValue:()=>kf,checkSetIsComplete:()=>jw,clearHistory:()=>_S,generate:()=>RS,generateScoreString:()=>AS,generateTieMatchUpScore:()=>rU,getSetComplement:()=>gT,getTiebreakComplement:()=>IT,helpers:()=>HS,isValidMatchUpFormat:()=>JI,keyValueScore:()=>Ww,mutate:()=>OS,parseMatchUpFormat:()=>xm,parseScoreString:()=>UT,query:()=>hT,redo:()=>$S,reverseScore:()=>CS,setServingSide:()=>LS,stringifyMatchUpFormat:()=>WI,tidyScore:()=>fT,umo:()=>WS,undo:()=>qS,validateScore:()=>vT,validateTieFormat:()=>nU});var RS={};function AS(e){let{winnerFirst:t=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=e;if(!l)return{error:mi,info:"missing sets"};let u=a&&xm(a),{bestOf:d,finalSetFormat:c,setFormat:p}=u??{},m=n||!(!t||!s||1===s),f=i?function({matchUpStatus:e}){let t={[Tl]:"RET",[bl]:"WO",[Il]:"DF/DF",[Ul]:"WO/WO",[Pl]:"SUS",[cl]:"ABN",[gl]:"DEF",[vl]:"DR"};return e&&t[e]||""}({matchUpStatus:r}):"",h=(null==l?void 0:l.sort(ES).map((function(e){let t=d&&e.setNumber===d&&c?c:p,i=(null==t?void 0:t.tiebreakSet)||(f=e,!(ur(null==f?void 0:f.side1Score)||ur(null==f?void 0:f.side2Score))&&(e=>ur(null==e?void 0:e.side1TiebreakScore)||ur(null==e?void 0:e.side2TiebreakScore))(e)),{side1Score:n,side2Score:r,side1TiebreakScore:a,side2TiebreakScore:s}=e,l=a||(ur(a)||o?0:""),u=s||(ur(s)||o?0:"");var f;if(i)return`[${(m?[u,l]:[l,u]).join("-")}]`;let h=Math.min(l,u),v=h?`(${h})`:"",g=n||(ur(n)||o?0:""),I=r||(ur(r)||o?0:""),U=m?`${[I,g].join("-")}${v}`:`${[g,I].join("-")}${v}`;return["-"," "].includes(U)&&(U=""),U})).filter(Boolean).join(" "))||"";return f?2===s?`${f} ${h}`:`${h} ${f}`:h}function ES(e,t){return e.setNumber-t.setNumber}function CS(e){if(null==e||!e.score)return{error:mi};let{sets:t}=e.score,i=t.map((e=>{let{side1TiebreakScore:t,side2TiebreakScore:i,winningSide:n,side1Score:r,side2Score:a,setNumber:o}=e;return ya({winningSide:n?3-n:void 0,side1TiebreakScore:i,side2TiebreakScore:t,side1Score:a,side2Score:r,setNumber:o})}));return{reversedScore:{sets:i,scoreStringSide1:AS({sets:i}),scoreStringSide2:AS({sets:i,reversed:!0})},...Be}}be(RS,{generateScoreString:()=>AS,generateTieMatchUpScore:()=>rU,reverseScore:()=>CS});var OS={};function kS({matchUp:e}){let{extension:t}=Ds({name:Bs,element:e});if(!t)return{error:Vn};let{history:i=[],undoHistory:n=[]}=t.value;return{history:i,undoHistory:n,...Be}}function FS(e){var t,i;if(!e)return{error:mi};let{matchUp:n,updateScore:r}=e;if(!n)return{error:ti};let a=(null==(t=kS({matchUp:n}))?void 0:t.history)||[];if(!Array.isArray(a))return{error:Fn,info:"history is not an array"};let{matchUpFormat:o}=n;if(!o)return{error:Yt};if(!JI({matchUpFormat:o}))return{error:zt};let s,l,u=xm(o),{bestOf:d,finalSetFormat:c,setFormat:p}=u,m=["0","15","30","40","A","G"],f={sets:[]},h=[],v=[0,0],g=1,I=0,U=0,y=e=>[1,2].includes(e),S=()=>(I+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:I,games:[]}),w={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},T={winningSide:void 0,points:[]},P=S(),D=0;for(let b of a){D+=1,l=f.sets.length+1===d;let e=l&&c?c:p,{tiebreakAt:t,setTo:n,NoAD:r,tiebbreakFormat:a}=e,o=P.side1Score===t&&P.side1Score===P.side2Score,u=!!e.tiebreakSet,I=u?e.tiebreakSet:a,{tiebreakTo:M,NoAD:N}=I||{},R=()=>{s=void 0,v=[0,0],g=3-g,P.side1TiebreakScore=0,P.side2TiebreakScore=0,P.side1PointScore="",P.side2PointScore="",U=0},A=e=>{P.winningSide=e;let{s:t,...i}=P;f.sets.push(i),w={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},T={winningSide:void 0,points:[]},P=S(),R()},E=e=>{T.winningSide=e;let{g:t,...i}=T;P.games.push(i),w={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},T={winningSide:void 0,points:[]},R(),P[`side${e}Score`]+=1},C=e=>{w.winningSide=e;let{p:t,...i}=w;T.points.push(i),w={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},U=0;let n=e-1;if(o||u){v[n]+=1,s=v.reduce(((e,t)=>e+t))%4/4>.5?g:3-g,P[`side${e}TiebreakScore`]=v[n],P[`side${3-e}TiebreakScore`]=v[1-n];let t=N?1:2;if(v[n]>=M&&v[n]>=v[1-n]+t)return E(e),{gameCompleted:!0}}else if(4===v[1-n]&&3===v[n]?v[1-n]-=1:v[n]+=1,P.side1PointScore=m[v[0]],P.side2PointScore=m[v[1]],5===v[n]||4===v[n]&&v[1-n]<3||r&&4===v[n])return E(e),{gameCompleted:!0}};if(y(b.srv)&&(g=b.srv),["p","s","g","o"].includes(b.u)&&h.push(b.u),b.shotOutcome&&(w.shots.push(b),"SERVE"===b.shotType&&["OUT","NET"].includes(b.shotOutcome)&&(U+=1),2===U)){C(3-g)}if(y(b.p)||mr(b.pointNumber)){if(null!=(i=C(b.winningSide||b.p))&&i.gameCompleted)continue}if(y(b.g)||mr(b.gameNumber)){let e=b.winningSide||b.g;T.winningSide=e;let t=`side${e}Score`,i=`side${3-e}Score`;if(h.length&&(h.includes("p"),h=[]),E(e),P[t]===n&&P[t]-P[i]>=(r?1:2)&&(A(e),l))break}if(y(b.s)||mr(b.setNumber)){if(A(b.winningSide||b.s),h.length&&(h.includes("p"),h.includes("g"),h=[]),l)break}}return D!==a.length&&console.log({error:"Match completed with excess history"}),(P.side1Score||P.side2Score||P.games.length||P.side1TiebreakScore||P.side2TiebreakScore)&&f.sets.push(P),f.scoreStringSide1=AS({...f,matchUpFormat:o}),f.scoreStringSide2=AS({...f,matchUpFormat:o,reversed:!0}),g=s||g,r&&(n.score=f),{...Be,servingSide:g,score:f}}function xS({undoHistory:e,history:t,matchUp:i}){return fs({element:i,extension:{value:{history:t,undoHistory:e},name:Bs}})}function LS({matchUp:e,sideNumber:t}){if(![1,2].includes(t))return{error:di};let{history:i=[]}=kS({matchUp:e});return i.push({srv:t}),xS({matchUp:e,history:i})}function _S({matchUp:e}){return xS({matchUp:e})}function BS({matchUp:e,point:t}){if(!t||!e)return{error:mi};if("object"!=typeof t)return{error:Fn,context:{point:t}};let{history:i=[]}=kS({matchUp:e});return i.push(t),xS({matchUp:e,history:i})}function jS({matchUp:e,game:t}){if("object"!=typeof t)return{error:Fn,context:{game:t}};let{history:i=[]}=kS({matchUp:e});return i.push(t),xS({matchUp:e,history:i})}function VS({matchUp:e,shot:t}){if("object"!=typeof t)return{error:mi};let{history:i=[]}=kS({matchUp:e});return i.push(t),xS({matchUp:e,history:i})}function GS({matchUp:e,set:t}){if("object"!=typeof t)return{error:mi};let{history:i=[]}=kS({matchUp:e});return i.push(t),xS({matchUp:e,history:i})}function $S({matchUp:e}){let{history:t=[],undoHistory:i=[]}=kS({matchUp:e});return i.length&&t.push(i.pop()),xS({matchUp:e,history:t,undoHistory:i})}function qS({matchUp:e}){let{history:t=[],undoHistory:i=[]}=kS({matchUp:e});return i.push(t.pop()),xS({matchUp:e,history:t,undoHistory:i})}be(OS,{addGame:()=>jS,addPoint:()=>BS,addSet:()=>GS,addShot:()=>VS,calculateHistoryScore:()=>FS,clearHistory:()=>_S,redo:()=>$S,setServingSide:()=>LS,umo:()=>WS,undo:()=>qS});var WS={},HS={};be(HS,{keyValueScore:()=>Ww,parseMatchUpFormat:()=>xm,stringifyMatchUpFormat:()=>WI,tidyScore:()=>fT});var zS=" ",YS="DEF",KS="COMPLETED",JS="WO",QS="ABN",ZS="SUS",XS="RET",ew="INT",tw=[XS,YS,JS,"WO/WO",QS,ZS,ew],iw="DEFAULTED",nw="WALKOVER",rw="ABANDONED",aw="SUSPENDED",ow="RETIRED",sw="INTERRUPTED",lw=[ow,iw,nw],uw="()",dw="[]",cw=["up","left","shift+tab"],pw=["enter","down","tab","right"],mw="backspace",fw="r",hw="s",vw="a",gw="d",Iw="w",Uw="i",yw=[fw,gw,Iw,vw,hw,Uw],Sw="space",ww=["[","("],Tw=[...cw,...pw,Sw,"]"],Pw="-",Dw="-",bw=["/"],Mw=0,Nw=["0","1","2","3","4","5","6","7","8","9"].concat(yw),Rw=Nw.map((e=>`shift+${e}`)),Aw=[Pw,mw].concat(Tw,bw),Ew=[Nw,Rw,Aw].join(","),Cw=[Ew,cw,pw,["=","+","num_1","num_2","shift+=","shift+-"]].join(","),Ow={OUTCOMEKEYS:yw,SIDE1KEYS:Nw,SIDE2KEYS:Rw,MODIFIERS:Aw,PROMPT:"Enter Score",MOVEUP:cw,MOVEDOWN:pw,HOTKEYS:Cw};function kw({scoreString:e,lowSide:t,outcome:i}){if(({scoreString:e}=Fw({scoreString:e})),2===t){return e+((e&&e[e.length-1])!==zS?zS:"")+i}return i+zS+e}function Fw({scoreString:e}){if(!e)return{scoreString:""};let t=!1;for(let i of tw){let n=null==e?void 0:e.indexOf(i);0===n?e=e.slice(i.length+1).trim()+zS:n>0&&(e=e.slice(0,n)),n>=0&&(t=!0)}return null!=e&&e.trim()||(e=""),{scoreString:e,removed:t}}function xw({analysis:e,scoreString:t,sets:i,lowSide:n}){var r,a,o;let s,l;if(!t)return{scoreString:t,sets:i};let{scoreString:u,removed:d}=Fw({scoreString:t});if(t=u,d)return{scoreString:t,sets:i,outcomeRemoved:!0};let c=i[i.length-1]||{},p=Object.values(c).filter((e=>void 0!==e)).length;c.setNumber&&1===p&&(c=(i=i.slice(0,i.length-1))[i.length-1]||{});let{tiebreakSet:m}=e.setFormat,{tiebreakTo:f,NoAD:h}=m||{},{isTiebreakEntry:v}=Lw({brackets:dw,scoreString:t}),g=function(e){return e.split("").reduce(((e,t,i)=>(t.match(/\d+/g)&&e.push(i),e)),[]).pop()}(t);if(g>=0){s=t.slice(0,g);let{isTiebreakEntry:u}=Lw({brackets:uw,scoreString:s}),{lastOpenBracketIndex:d,isTiebreakEntry:p}=Lw({brackets:dw,scoreString:s}),m=s&&s[s.length-1].trim(),I=s&&!isNaN(m),U=e.isIncompleteSetScore;if(v&&p){let e=s.slice(d+1).split(Dw),i=(null==e?void 0:e.length)>0&&void 0!==e[0]&&!isNaN(parseInt(e[0]))&&parseInt(e[0])||void 0,r=(null==e?void 0:e.length)>1&&void 0!==e[1]&&parseInt(e[1])||void 0,a=[i,r];if(r){let e=1===n?1:0;a[e]=((null==a?void 0:a[1-e])||0)+(h?1:2),(a[e]||0)<f&&(a[e]=f),s=t.slice(0,d+1),s+=a.join(Dw)}else void 0!==i?(s=t.slice(0,d+1),s+=i):(s=t.slice(0,d),U=!0);c.side1TiebreakScore=a[0]||0,c.side2TiebreakScore=a[1]||0}if(s.length||(s=void 0),U){let t=null==(r=c.side1Score)?void 0:r.toString();if(t){let e=null==t?void 0:t.slice(0,t.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}e.isTimedSet?(l=c.side1Score?i:(null==i?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=c):l=(null==i?void 0:i.slice(0,i.length-1))||[]}else if(I){let t=null==(a=c.side2Score)?void 0:a.toString(),n=null==(o=c.side1Score)?void 0:o.toString();if(!e.isTiebreakEntry&&!e.isMatchTiebreak)if(c.side2Score){let e=null==t?void 0:t.slice(0,t.length-1);c.side2Score=!isNaN(e)&&parseInt(e)||void 0}else{let e=null==n?void 0:n.slice(0,n.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0}e.isTimedSet?c.side1Score?(l=i||[],l[i.length-1]=c):l=(null==i?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=c),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else u?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(v&&!p?l=(null==i?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=c),v||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:t,sets:i}}function Lw({brackets:e=uw,scoreString:t}){if(!t)return{};let[i,n]=e.split(""),r=t.split(""),a=Math.max(...Mr(i,r));return{isTiebreakEntry:a>Math.max(...Mr(n,r)),lastOpenBracketIndex:a}}function _w(e){let{lowValue:t=0,NoAD:i=!1,tiebreakTo:n}=e||{};return t+1>=n?t+(i?1:2):parseInt(n)}function Bw({matchUpFormat:e,matchUpStatus:t,winningSide:i,sets:n}){var r;let a=xm(e),{bestOf:o}=a,s=Math.ceil(o/2),l=(null==(r=null==n?void 0:n.reduce(((e,t)=>{let{winningSide:i}=t;return i&&e[i-1]++,e}),[0,0]))?void 0:r.indexOf(s))+1||void 0;return lw.includes(t)&&i&&(l=i),{matchUpWinningSide:l}}function jw({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var o;if(!a)return{error:mi,info:"missing set"};t=t||i&&xm(i);let s=r&&t.finalSetFormat||(null==t?void 0:t.setFormat)||{},{side1Score:l,side2Score:u}=a,{setTo:d,tiebreakAt:c}=s,p=Vw({set:a}),m=Math.abs(l-u),f=l>=d||u>=d,h=n||l>=d&&u>=d||c&&c<d&&(l===c||u===c),v=e||h&&(1===p&&a.side1TiebreakScore>a.side2TiebreakScore||2===p&&a.side2TiebreakScore>a.side1TiebreakScore),g=!h&&s.NoAD||h||n&&null!=(o=s.tiebreakFormat)&&o.NoAD?1:2;return!(!(f&&(m>=g||h)||n)||h&&!v)}function Vw({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}function Gw({analysis:e,set:t}){let i=Vw({set:t}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=e;return jw({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:t})&&i}function $w({lowSide:e,value:t,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return t===fw?n?(o=!0,n=kw({scoreString:n,lowSide:e,outcome:XS}),r=2===e?1:2,a=ow):(o=!0,n=kw({scoreString:n,lowSide:e,outcome:YS}),r=2===e?1:2,a=iw):t===gw?(o=!0,n=kw({scoreString:n,lowSide:e,outcome:YS}),r=2===e?1:2,a=iw):t===Iw?(o=!0,i=[],n=JS,r=2===e?1:2,a=nw):t===hw&&n?(o=!0,n=kw({scoreString:n,lowSide:e,outcome:ZS}),a=aw,r=void 0):t===vw?(o=!0,n=kw({scoreString:n,lowSide:e,outcome:QS}),a=rw,r=void 0):t===Uw&&n&&(o=!0,n=kw({scoreString:n,lowSide:e,outcome:ew}),a=sw,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function qw({matchUpFormat:e,scoreString:t,winningSide:i,value:n,sets:r}){var a,o,s;let l=((null==(a=null==r?void 0:r.filter((e=>null==e?void 0:e.winningSide)))?void 0:a.length)||0)+(i?0:1),u=xm(e),d=l===(null==u?void 0:u.bestOf),c=d&&(null==u?void 0:u.finalSetFormat)||(null==u?void 0:u.setFormat)||{},p=null==c?void 0:c.timed,m=d&&r[(null==u?void 0:u.bestOf)-1],f=null==m?void 0:m.winningSide,{isTiebreakEntry:h}=Lw({brackets:uw,scoreString:t}),{isTiebreakEntry:v}=Lw({brackets:dw,scoreString:t}),g=h||v,I=!!c.tiebreakSet,U=null==(o=null==t?void 0:t[t.length-1])?void 0:o.trim(),y=t&&!isNaN(U),S=!g&&U===Pw,w=h&&ww.includes(U),T=v&&ww.includes(U),P=v&&U===Dw,D=null==t?void 0:t.split(""),[b]=dw.split(""),M=D&&Math.max(...Mr(b,D)),N=D&&Math.max(...Mr(Dw,D)),R=D&&N>M,A=null==(s=r[r.length-1])?void 0:s.winningSide,E=(null==r?void 0:r.length)&&!A,C=tw.find((e=>(null==t?void 0:t.indexOf(e))>=0)),O=!isNaN(n),k=n===Sw,F=Tw.includes(n),x=null==t?void 0:t.split("").find((e=>ww.includes(e))),L=F&&v&&!T&&(P||!function({scoreString:e}){if(!e)return!1;let t=e&&e[e.length-1].trim(),i=e&&!isNaN(t),[n,r]=dw.split(""),a=e.split(""),o=Math.max(...Mr(n,a)),s=Math.max(...Mr(r,a)),l=Math.max(...Mr(Dw,a));return i&&o>s&&l>o}({scoreString:t}));return{isTiebreakSetValue:I&&O,matchUpScoringFormat:u,setNumber:l,setFormat:c,matchTiebreakHasJoiner:R,isGameScoreEntry:E,isSpace:k,isCloser:F,isTiebreakCloser:F&&x&&g&&y,isDecidingSet:d,isTiebreakSet:I,isTimedSet:p,isNumericEnding:y,isNumericValue:O,hasOpener:x,hasOutcome:C,finalSet:m,finalSetIsComplete:f,lastSetIsComplete:A,isInvalidSetTiebreakValue:k&&g&&w,isInvalidMatchTiebreakValue:L,isTiebreakEntry:g,isSetTiebreakEntry:h,isMatchTiebreakEntry:v,isIncompleteSetScore:S,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:T,isPartialMatchTiebreakValue:P}}function Ww(e){let t,i,{lowSide:n=1,value:r}=e,{scoreString:a,sets:o,winningSide:s,matchUpStatus:l}=e,{matchUpFormat:u,shiftFirst:d,auto:c=!0}=e,p=d&&2===n||!d&&1===n;if(!Ew.includes(r))return{updated:!1,info:"invalid key"};d&&(n=3-n);let{matchUpWinningSide:m}=Bw({sets:o,winningSide:s,matchUpStatus:l,matchUpFormat:u});s=m;let f=qw({value:r,winningSide:s,scoreString:a,sets:o,matchUpFormat:u});if(bw.includes(r)&&(r=Pw),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===rr(r)&&(f.isTiebreakCloser=!0),Tw.includes(r)&&f.hasOpener&&(r=""),Tw.includes(r)&&(r=Sw),f.lastSetIsComplete){let e=(null==a?void 0:a.length)&&a[a.length-1];a&&" "!==e&&(a+=" ")}if(f.isTimedSet)({info:i,sets:o,scoreString:a,updated:t,matchUpStatus:l,winningSide:s}=function(e){let t,i,{sets:n,info:r,scoreString:a,winningSide:o,matchUpStatus:s}=e,{analysis:l,lowSide:u,value:d}=e;(null==n||!n.length)&&d!==mw&&(n=[{setNumber:1}]);let c=n.length-1;if(yw.includes(d)){let e=n[n.length-1]||{},{side1Score:i,side2Score:c}=e;i&&!c?r="missing side2Score":l.finalSetIsComplete||o?r="final set is already complete":l.isIncompleteSetScore?r="incomplete set scoreString":l.isIncompleteSetScore||({sets:n,scoreString:a,winningSide:o,matchUpStatus:s,updated:t}=$w({lowSide:u,value:d,sets:n,scoreString:a,matchUpStatus:s,winningSide:o}))}else if(d===mw){if(({scoreString:a,sets:n,outcomeRemoved:i}=xw({analysis:l,scoreString:a,sets:n})),""===(null==a?void 0:a.trim())&&(a=a.trim()),a||(n=[]),i){let e=n[n.length-1]||{},{side1Score:t,side2Score:i}=e;if(t&&i){let r=(t>i?1:i>t&&2)||void 0;r&&(e.winningSide=r,n.push({setNumber:n.length+1}))}}s=void 0,o=void 0,t=!0}else if(l.hasOutcome)r="has outcome";else{if(o)return{sets:n,scoreString:a,winningSide:o,matchUpStatus:s,updated:!1,info:"matchUp is complete"};if(d===Sw){let e=n[n.length-1]||{},{side1Score:i,side2Score:r}=e,s=(i>r?1:r>i&&2)||void 0;s&&!o&&!l.isIncompleteSetScore&&(n[n.length-1].winningSide=s,n.push({setNumber:n.length+1}),a+=" ",t=!0)}else if(d===Pw&&void 0!==n[c].side1Score&&void 0===n[c].side2Score&&a&&l.isNumericEnding)a+="-",n[c].side2Score=0,s=void 0,o=void 0,t=!0;else if(!isNaN(d)){let e;if(void 0===n[c].side2Score){let i=rr((n[c].side1Score||0).toString()+d).toString().slice(0,2);n[c].side1Score=rr(i),e=n[c].side1Score.toString(),t=!0}else{let i=rr((n[c].side2Score||0).toString()+d).toString().slice(0,2);n[c].side2Score=rr(i),e=[n[c].side1Score,n[c].side2Score].join("-"),t=!0}if(t){let t=(n.slice(0,c)||[]).filter((e=>e)).map((e=>{let{side1Score:t,side2Score:i}=e;return[t,i].join("-")})).join(" ");a=t?t+" "+e:e}}}return{sets:n,scoreString:a,winningSide:o,matchUpStatus:s,info:r,updated:t}}({analysis:f,lowSide:n,scoreString:a,sets:o,matchUpStatus:l,winningSide:s,value:r}));else if(yw.includes(r))f.finalSetIsComplete||s?i="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?i="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:r}):({sets:o,scoreString:a,matchUpStatus:l,winningSide:s,updated:t}=$w({lowSide:n,sets:o,scoreString:a,matchUpStatus:l,winningSide:s,value:r}));else if(r===mw)t=!0,({scoreString:a,sets:o}=xw({analysis:f,scoreString:a,sets:o,lowSide:n})),a||(o=[]),l=void 0,s=void 0;else if(f.hasOutcome)i="has outcome";else if(r!==Pw||f.isMatchTiebreakEntry)if(r===Dw&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?i="existing joiner":f.isNumericEnding&&(t=!0,a+=Dw);else if([Pw,Dw].includes(r))i="invalid location for joiner";else{if(s)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:o,scoreString:a,updated:t}=function({analysis:e,scoreString:t,sets:i,value:n}){let r;if(null==i||!i.length)return{sets:[]};let a=i[i.length-1];n=rr(n);let{validSide2Score:o,requiresTiebreak:s}=function({analysis:e,set:t={},value:i}){let n,r,a=e.isDecidingSet&&e.matchUpScoringFormat.finalSetFormat||e.matchUpScoringFormat.setFormat,{tiebreakAt:o,setTo:s,NoAD:l}=a,{side1Score:u}=t;return n=o&&o<s?u===o?i<=s:i<=o:u===s?l?i<s:i<=s+1:u===s-1?l?i<=s:i<=s+1:u===s+1?i===s||i===s-1:i<=s,n&&(r=o&&o<s?u===s&&i===o||u===o&&i===s:u>=s&&i>=s&&u!==i),{validSide2Score:n,requiresTiebreak:r}}({analysis:e,set:a,value:n});if(o){r=!0,t=(t||"")+n,a.side2Score=n;let o=Gw({analysis:e,set:i[i.length-1]});a.winningSide=o||void 0,s?t+=uw.split("")[0]:e.isDecidingSet||(t+=zS)}return{sets:i,scoreString:t,updated:r}}({analysis:f,scoreString:a,sets:o,value:r}));else if(f.isInvalidMatchTiebreakValue)i="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)i="invalid set tiebreak character";else if(f.isTiebreakCloser){let e=f.isSetTiebreakEntry?uw:dw,i=e.split("").reverse()[0],n=e.split("")[0],r=o[o.length-1],{tiebreakFormat:s}=f.setFormat,{tiebreakTo:l,NoAD:u}=s||{},d=Vw({set:r});if(!f.isTiebreakSet){let e=parseInt(a.split(n).reverse()[0]),t=_w({lowValue:e,tiebreakTo:l,NoAD:u});1===d?(r.side1TiebreakScore=t,r.side2TiebreakScore=e):(r.side1TiebreakScore=e,r.side2TiebreakScore=t)}a=(a||"")+i,f.isDecidingSet||(a+=zS);let c=Gw({analysis:f,set:r});r.winningSide=c||void 0,t=!0}else if(f.isTiebreakSetValue)({info:i,scoreString:a,sets:o,updated:t}=function({analysis:e,auto:t,lowSide:i,scoreString:n="",sets:r,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:u,NoAD:d}}=e.setFormat,[c]=dw.split("");if(e.isMatchTiebreakEntry||(n+=c),r[e.setNumber-1]){let{lastOpenBracketIndex:e}=Lw({brackets:dw,scoreString:n}),c=(n.slice((e??0)+1)+(t?"":a)).split(Dw);if(((null==(o=c[i-1])?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(t){1===i&&(c[0]=(c[0]||"")+a),2===i&&(c[1]=(c[1]||"")+a);let t=[c[0]||0,c[1]||0].map((e=>rr(e))),o=1===i?1:0;t[o]=t[1-o]+(d?1:2),t[o]<u&&(t[o]=u);let l=r[r.length-1];l.side1TiebreakScore=t[0],l.side2TiebreakScore=t[1],n=n.slice(0,(e??0)+1),n+=t.join(Dw),s=!0}else{let e=[c[0]||0,c[1]||0].map((e=>rr(e))),t=r[r.length-1];t.side1TiebreakScore=e[0],t.side2TiebreakScore=e[1],n+=a,s=!0}}else{let e=_w({lowValue:rr(a||0),tiebreakTo:u,NoAD:d}),t=[rr(a),e];2===i&&t.reverse();let o={side1TiebreakScore:t[0],side2TiebreakScore:t[1],setNumber:(null==r?void 0:r.length)+1||1};r.push(o),n+=t.join(Dw),s=!0}return{info:l,scoreString:n,sets:r,updated:s}}({analysis:f,auto:c,lowSide:n,scoreString:a,sets:o,value:r}));else if(f.isSetTiebreakEntry){let[e]=uw.split(""),n=Math.max(...Mr(e,a.split(""))),o=a.slice(n+1),s=o&&rr(o)===Mw,l=rr(o?o+r:r),{tiebreakFormat:u}=f.setFormat,{tiebreakTo:d,NoAD:c}=u||{};!s&&o.length<2?c&&l>d-1?i="invalid low value for NoAD tiebreak":(t=!0,a=(a||"")+r):i=s?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)i=`invalid key: ${r}`;else if(f.isGameScoreEntry)i="game scoreString entry";else if(f.lastSetIsComplete||!o.length){t=!0;let{scoreString:e,set:i}=function({analysis:e,lowSide:t,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:o}=(null==e?void 0:e.setFormat)||{},s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};let l=[n,s?n+1:n+1===r?n+(o?1:2):r];2===t&&l.reverse();let u=uw.split("")[0];i=(i||"")+(l.join(Pw)+(s?u:zS));let d={side1Score:l[0],side2Score:l[1]},c=Gw({analysis:e,set:d});return d.winningSide=c||void 0,{scoreString:i,set:d}}({analysis:f,lowSide:n,scoreString:a,value:rr(r)});i&&(i.setNumber=(null==o?void 0:o.length)+1||1),o=(null==o?void 0:o.concat(i).filter(Boolean))||[i],a=e||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(t=!0,({scoreString:a,sets:o}=xw({analysis:f,scoreString:a,sets:o,lowSide:n})),l=void 0);if(t){o=null==o?void 0:o.filter(Boolean);let{matchUpWinningSide:e}=Bw({sets:o,winningSide:s,matchUpStatus:l,matchUpFormat:u});return s=e,!e||l&&![Dl,Sl].includes(l)?a&&!s&&![aw,rw,sw].includes(l)&&(l=void 0):(l=KS,o=o.filter((e=>{let{side1Score:t,side2Score:i,side1TiebreakScore:n,side2TiebreakScore:r}=e;return t||i||n||r}))),{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:l,info:i}}return{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:l,info:i}}var Hw="\\d+-\\d+",zw="\\d+-\\d+\\(\\d+\\)",Yw="\\[\\d+-\\d+\\]",Kw=new RegExp(`(${Hw}),`,"g"),Jw=new RegExp(`(${zw}),`,"g"),Qw=[Hw,zw,Yw,"\\d+-\\d+\\(\\d+-\\d+\\)"],Zw=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map((e=>{let t=e.split("").map((e=>Qw[e])).join(" ");return new RegExp(`^${t}$`)}));function Xw(e){return!e||Zw.some((t=>t.test(e)))}function eT(e){return/^\(\d+\)$/.test(e)||/^\(\d+$/.test(e)}function tT(e){let t=null==(i=e)?void 0:i.split("-").join("").split("/").join("");var i;if(/^\d+$/.test(t)&&2===t.length){let e=t.split("");return 1===Math.abs(e.reduce(((e,t)=>+e-+t)))}return!1}function iT(e,t){let i=[e.slice(t,t+2),t?e.slice(0,1):e.slice(2)].map((e=>parseInt(e.join(""))));t&&i.reverse();let n=i;if(Math.abs(n.reduce(((e,t)=>+e-+t)))>=2)return n.join("-")}function nT(e){return 2===e.length?e.split("").join("-"):([", ",",","/"," "].forEach((t=>e=e.split(t).join("-"))),e=e.replace(/-{2,}/,"-"))}function rT(e){return e.startsWith("(")&&e.endsWith(")")}function aT(e){if(!/^[\d-]+(\(\d\))*$/.test(e))return e;let t=Mr("-",e.split(""));if(!t.length)return e;let i=e.split("-"),n=!(i.length%2),r=!!(t.length%2);return n&&r&&t.length>i.length/2&&t.filter(((e,t)=>t%2)).forEach((t=>{e=e.substring(0,t)+" "+e.substring(t+1)})),e}function oT({score:e}){let t,i=e.split(""),n=[],r=()=>t=[void 0,void 0,void 0],a=()=>{let e=`${t[0]}-${t[1]}`;return t[2]&&(e+=` (${t[2]})`),r(),t.push(t),e};r();let o=()=>void 0!==t[0]&&void 0!==t[1]&&Math.abs(parseInt(t[0])-parseInt(t[1]));for(;i.length;){let e=i.shift(),r=ur(e)&&parseInt(e),s=void 0!==t[0]&&void 0!==t[1];if(ur(r)){if(void 0===t[0]){t[0]=r;continue}if(void 0===t[1]&&(t[1]=r,o())){n.push(a()),t=[void 0,void 0];continue}if(s&&1===i.length&&ur(i[0])){let e=i.pop();t[0]=t[0].toString()+t[1].toString(),t[1]=e,n.push(a()),t=[void 0,void 0]}s&&o()}}return{sets:n}}function sT(e){let t=e.indexOf("1"),i=e.split(""),n=i.every((e=>!isNaN(e)));if(n&&3===e.length&&0===t){let e=iT(i,t);if(e)return e}if(n&&7===e.length&&t>3){let e=iT(i.slice(4),t-4);if(e)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${e}`}}function lT(e){let{score:t}=e,{applied:i,matchUpStatus:n}=e,r=null==t?void 0:t.toString().split(""),a=null==r?void 0:r.every((e=>ur(e))),o=e=>Math.abs(e[0]-e[1]);if("number"==typeof t||a){t=t.toString().toLowerCase(),a&&(t=r.join(""));let e=a?r.map((e=>parseInt(e))):t.split("").map((e=>parseInt(e)));if(oT({score:t}),e.length,3===t.length&&1===o(e.slice(0,2))){let[n,r,a]=e;t=`${n}-${r}(${a})`,i.push("numericTiebreakPattern1")}else if(3===t.length&&1===e[0]){let[n,r,a]=e;t=`[${n}${r}-${a}]`,i.push("numericTiebreakPattern2")}else if(4===t.length&&1===o(e.slice(0,2))&&"987654".split("").includes(e[0].toString())){let[n,r,a,o]=e;t=`${n}-${r}(${Math.min(a,o)})`,i.push("numericTiebreakPattern3")}else if(4===t.length&&1===e[0]&&1===e[2]){let[n,r,a,o]=e;t=`[${n}${r}-${a}${o}]`,i.push("bigSuper")}else if(4===t.length){let[n,r,a,o]=e;t=`${n}${r} ${a}${o}`,i.push("split4")}else if(5===t.length&&1===o(e.slice(0,2))){let[n,r,a,o,s]=e;t=`${n}-${r}(${a}) ${o}-${s}`,i.push("numericTiebreakPattern4")}else if(5===t.length&&1===o(e.slice(3))){let[n,r,a,o,s]=e;t=`${n}-${r} ${a}-${o}(${s})`,i.push("numericTiebreakPattern5")}else if(7===e.length)if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===e[4]){let[n,r,a,o,s,l,u]=e;t=`${n}-${r} ${a}-${o} [${s}${l}-${u}]`,i.push("numericTiebreakPattern6")}else if(1===o(e.slice(0,2))&&o(e.slice(3,5))>1&&o(e.slice(5,7))>1){let[n,r,a,o,s,l,u]=e;t=`${n}-${r}(${a}) ${o}-${s} ${l}-${u}`,i.push("numericTiebreakPattern7")}else if(o(e.slice(0,2))>1&&1===o(e.slice(2,4))&&o(e.slice(5,7))>1){let[n,r,a,o,s,l,u]=e;t=`${n}-${r} ${a}-${o}(${s}) ${l}-${u}`,i.push("numericTiebreakPattern8")}else if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===o(e.slice(4,6))){let[n,r,a,o,s,l,u]=e;t=`${n}-${r} ${a}-${o} ${s}-${l}(${u})`,i.push("numericTiebreakPattern9")}else t=t.slice(0,2)+" "+t.slice(2,4)+" "+t.slice(4),i.push("numericMatchTiebreakPattern");else if(t.length%2){let e=sT(t);e&&t!==e&&i.push("parsedSuperPattern"),t=e??t}else{let n=Or(t.split(""),2).map((e=>e.join(""))),r=n.map((e=>{let[t,i]=e.split("").map((e=>parseInt(e))),n=t>i?1:2;return Math.abs(t-i)>1&&n||-1*n})),a=r.reduce(((e,t)=>e>0&&t>0),1),o=Ur(r),s=Ur(r.map((e=>Math.abs(e)))),l=r[0]<0,u=!l&&r[1]<0;if(r[0]>0&&r[1]>0&&r[0]!==r[1])t=[n.slice(0,2).join(" "),n.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(a)t=n.join(" "),i.push("chunkSplit");else if(6==e.length){if(2==o[1]||2===o[2])if(Object.values(s).includes(3)){let[n,a,o,s,l,u]=e,d=r.reduce(((e,t,i)=>t<0?i:e),void 0);if(0===d){t=`${n}-${a}(${Math.min(o,s)}) ${l}-${u}`,i.push("chunkSplitTiebreak1")}else if(1===d){t=`${n}-${a} ${o}-${s}(${Math.min(l,u)})`,i.push("chunkSplitTiebreak2")}else t=`${n}-${a} ${o}-${s}`,i.push("chunkSplitTrimExtraneous")}else t=n.join(" "),i.push("chunkSplit")}else if(8===e.length){let[i,n,a,o,s,d,c,p]=e;l||u?1===e[5]&&(t=l?`${i}-${n}(${a}) ${o}-${s} [${d}${c}-${p}]`:`${i}-${n} ${a}-${o}(${s}) [${d}${c}-${p}]`):(r[0],r[1])}}}return{score:t,applied:i,matchUpStatus:n}}function uT(e){let t=[0,0],i=[],n=e.split(" "),r=/(\d+)-(\d+)/;n.forEach((e=>{if(r.test(e)){let n=e.match(r).slice(1).map((e=>parseInt(e))),a=n[0]>n[1]?1:n[1]>n[0]&&2;a&&(t[a-1]+=1,i.push(a))}}));let a=t[0]>t[1]?1:t[1]>t[0]&&2,o=t[0]>0&&t[0]===t[1],s=t.reduce(((e,t)=>e+t),0);return{setsWon:t,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}var dT={handleTiebreakSlashSeparation:function({score:e}){let t=new RegExp(/\(\d+\/\d+\)/g),i=e.match(t);for(let n of i||[]){let t=n.replace("/","-");e=e.replace(n,t)}return{score:e}},handleSetSlashSeparation:function({score:e}){return new RegExp(/-\d+\/\d+-/).test(e)&&(e=e.split("/").join(" ")),{score:e}},punctuationAdjustments:function({score:e,applied:t}){e=function(e){let t="[];",i="()",n=t+i,r=[t[0],i[0]],a=Object.assign({},...n.split("").map((e=>({[e]:0})))),o="",s=e.split("").map((e=>{let s=n.includes(e)&&e,l=r.includes(s);if(l&&s)return a[s]+=1,o=s,e;if(!l&&s&&o&&s!==o){a[o]-=1;let e=t.includes(o)&&t||i.includes(o)&&i||"",n=e.split("").find((e=>e!==o));if(!e.includes(s))return a[s]||(o=""),n;a[o]||(o="")}return e})).join("");return e!==s?s:e}(e);let i=/\)(\d+)/g;if(i.test(e))for(let y of e.match(i)){let t=y.replace(")",") ");e=e.replace(y,t)}let n=/\(([\d- ]+)\)/,r=(e=(e=e.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);for(let y of r||[]){let[t]=y.match(n).slice(1),i=t.replace(/ /g,"");e=e.replace(y,`(${i})`)}let a=/\(\(\d-\d\)\)/g;if(a.test(e)){let t=e.match(a);t.length&&t.forEach((t=>{let i=t.match(/\((\(\d-\d\))\)/).slice(1)[0];e=e.replace(t,i)}))}if(a=/\(\((\d)\)\)/g,a.test(e)){let t=e.match(a);t.length&&t.forEach((t=>{let i=t.match(/\((\(\d\))\)/).slice(1)[0];e=e.replace(t,i)}))}/(^|\s)6-,/.test(e)&&(e=e.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);e=e.replace(o,"-"),["- "," -"].forEach((t=>{let i=new RegExp(`(\\d+)${t}(\\d+)`,"g"),n=e.match(i);n&&n.forEach((i=>e=e.replace(i,i.split(t).join("-"))))})),/^[(-/,]+$/.test(e)&&(e=""),/\)[-/,]+$/.test(e)&&(e=e.slice(0,e.length-1)),/\d \/\d/.test(e)&&(e=e.replace(/ \//g,"/")),e.includes(" /")&&(e=e.replace(/ \//g," "));let s=/\(\d+, \)/g;s.test(e)&&e.match(s).forEach((t=>{let[i]=t.match(/\((\d+), \)/).slice(1);2===i.length?e=e.replace(t,`(${i})`):1===i.length&&"6"===i&&(e=e.replace(t,"(6-0)"))}));let l=/\((\d+)\/\)/g;l.test(e)&&e.match(l).forEach((t=>{let[i]=t.match(/\((\d+)\/\)/).slice(1);e=2===i.length?e.replace(t,`(${i})`):1===i.length&&"6"===i?e.replace(t,"(6-0)"):e.replace(t,`(${i})`)}));let u=/\d\/\d\/,/g;u.test(e)&&e.match(u).forEach((i=>{let[n]=i.match(/(\d\/\d)\/,/).slice(1);e=e.replace(i,`${n},`),t.push("slashComma")}));let d=/\(\/(\d+)\)/g;d.test(e)&&e.match(d).forEach((t=>{let[i]=t.match(/\(\/(\d+)\)/).slice(1);e=2===i.length?e.replace(t,`(${i})`):1===i.length&&parseInt(i)<6?e.replace(t,`(6-${i})`):e.replace(t,`(${i})`)}));let c,p,m,f,h,v=()=>{h=Ur(e.split("")),p=h["("]===(h[")"]||0)+1,c=(h["("]||0)+1===h[")"],m=h["["]===h["]"]+1,f=p&&!m};v();let g=/(\d+-\d+\(\d+)0,/;if(g.test(e)){let[t]=e.match(g).slice(1);e=e.replace(g,t+")")}if(h["("]===h[")"]&&h["("]>1){let t=e.split(")(").join(") (").split(" ");e=t.every(rT)?t.map((e=>{let t=e.slice(1,e.length-1);return t.length>2?t:e})).join(" "):t.join(" ")}v();let I=/[A-Za-z]+/.test(e),U=/\d+/.test(e);if(!I&&!U)return{score:""};if(/^\[.+\]$/.test(e)&&"()/,- ".split("").some((e=>h[e]))&&(e=e.slice(1,e.length-1)),/^\(.+\)$/.test(e)&&1===h["("]&&1===h[")"]&&"[]/,".split("").some((e=>h[e]>1))&&(e=e.slice(1,e.length-1)),e.startsWith("(")&&e.endsWith("))")&&(e=e.slice(1,e.length-1)),h["("]>(h[")"]||0)&&"("===e[e.length-1]&&(e=e.slice(0,e.length-1)+")",v()),1===h["("]&&!h[")"]&&"("===e[0]&&(e+=")",v()),h["("]>(h[")"]||0)&&"(("===e.slice(0,2)&&(e=e.slice(1)),c){if(/^9\d/.test(e))e="("+e.slice(1);else if("("!==e[0])e="("+e;else{let t=[],i=0;for(let n of e.split("").reverse())")"===n&&(i?t.push("("):i+=1),"("===n&&(i-=1),t.push(n);t.reverse(),e=t.join("")}v()}if(h[")"]>(h["("]||0)&&")"===e[0]&&(e="("+e.slice(1),v()),f&&(e.endsWith(9)||/\d+0$/.test(e))&&(e=e.slice(0,e.length-1)+")",v()),f&&(!e.endsWith(")")||e.startsWith("(("))&&(e+=")",v()),f){let t="",i=0;for(let n of e.split(""))"("===n&&(i?t+=")":i+=1),")"===n&&(i-=1),t+=n;e=t}if(v(),m&&!p&&(e+="]"),e.includes("([")&&e.includes("])")&&(e=e.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(e)&&(e=e.slice(0,e.length-1)+")"),v(),1===h[")"]&&!h["("]&&e.endsWith(")")&&(e=e.slice(0,e.length-1)),e.startsWith("(")&&e.endsWith(")")&&1===h["("]&&1===h[")"]&&(e=e.slice(1,e.length-1),v()),/^\([\d ]+.*[\d ]+\)$/.test(e)&&h["("]===h[")"]){let t=e.slice(1,e.length-1);(e=>{let t=e.indexOf("("),i=e.indexOf(")");return t>=0&&i>=0&&t<i})(t)&&(e=t,v())}return{score:e,applied:t}},handleGameSeparation:function({score:e}){let t=new RegExp(/^\d+\/\d+/),i=e.split(" ");i.some((e=>t.test(e)))&&(e=i.map((e=>t.test(e)?e.replace("/","-"):e)).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(e)){let[t,i]=e.match(n).slice(1);e=[t,i].join("-")}return{score:e}},joinFloatingTiebreak:function({score:e}){if("string"!=typeof e)return{score:e};let t=e=>null==e?void 0:e.split("-").join("").split("/").join(""),i=e=>e.split("[").join("(").split("]").join(")"),n=(e=e.split(", ").join(" ")).split(" ");e=n.map((e=>{let t=/^-(\d+)$/;if(t.test(e)){let[i]=e.match(t).slice(1);if(2===i.length)return i.split("").join("-")}return e})).join(" "),n=e.split(" ");let r=n.filter(eT),a=0,o="";for(let p of r){let e=Mr(p,n).filter((e=>!a||e>a))[0],i=n.slice(a,e-1),r=n[e-1],s=t(r);if(/^\d+$/.test(s)&&2===s.length){let t=s.split(""),n=Math.abs(t.reduce(((e,t)=>+e-+t)));if(1===n){o+=[i.join(" "),[r,p].join("")].join(" "),a=e+1}else if(0===n){let n=Math.max(...t);if([4,5,6,7,8,9].includes(n)){let t=[n,[6,4].includes(n)?n+1:n-1].sort().reverse().join("-");o+=[i.join(" "),[t,p].join("")].join(" "),a=e+1}}}}if(r.length&&o.length){return o=[o,n.slice(a).join(" ")].join(" "),{score:o.trim()}}if(2===n.length&&["(","["].some((e=>n[1].includes(e)))){let e=t(n[0]).split("");if(1===Math.abs(e.reduce(((e,t)=>+e-+t),0)))return n[1]=i(n[1]),{score:n.join("")}}let s=n.map((e=>function(e){return/^\(\d+-\d+\)$/.test(e)||/^\[\d+-\d+\]$/.test(e)}(e)?"bracket":tT(e)&&"set"));if(s.includes("set")&&s.includes("bracket")){let e,t="";return n.forEach(((n,r)=>{"bracket"===s[r]&&"set"===e?(n=i(n),t+=n):t+=` ${n}`,e=s[r]})),{score:t.trim()}}n=e.split(" ");let l,u=n.map((e=>{let t=new RegExp(/^(\d+)-(\d+)$/);if(t.test(e)){let[i,n]=e.match(t).slice(1),r=Math.abs([i,n].reduce(((e,t)=>+e-+t))),a=Math.max(i,n);if(1===r)return l="tiebreakSet",l;if(r>=2&&a>=7&&"tiebreakSet"===l)return l="tiebreak",l}})),d=Mr("tiebreak",u);if(d.length){let t="";n.forEach(((e,i)=>{d.includes(i)?t+=`(${e}) `:d.includes(i+1)?t+=`${e}`:t+=`${e} `})),e=t.trim()}let c=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(c.test(e)){let[t,i,n]=e.match(c).slice(1),r=Math.max(i,n)>=10;!tT(t)&&r&&(e=e.replace(c,`${t} [${i}-${n}]`))}return u=[],{score:e=e.split(" ").map((e=>{let t=/^\((.*)\)$/,i=t.test(e),n=(new RegExp(Yw).test(e)?"super":new RegExp(zw).test(e)&&"tiebreak")||new RegExp(Hw).test(e)&&"standard"||"unknown";return u.push(n),"standard"===n&&i?e.match(t)[1]:e})).join(" ")}},handleBracketSpacing:function({score:e,applied:t}){return e.includes("( ")&&(t.push("removeParenSpacingAfterOpen"),e=e.split("( ").map((e=>e.trim())).join("(")),e.includes(" )")&&(t.push("removeParenSpacingBeforeClose"),e=e.split(" )").map((e=>e.trim())).join(")")),[Kw,Jw].forEach((i=>{let n=e.match(i);null!=n&&n.length&&(n.forEach((t=>{e=e.replace(t,t.slice(0,t.length-1)+" ")})),t.push("setsEndComma"))})),{score:e=e.split(" ").filter(Boolean).map(aT).join(" "),applied:t}},handleSpaceSeparator:function({score:e}){if(e.includes(",")){let t=e.split(",").map((e=>e.trim())),i=e=>/\d \d/.test(e);t.every(i)&&(e=t.map((e=>{let t=/\d+ \d+/g;for(let i of e.match(t)){let[t,n]=i.match(/(\d+) (\d+)/).slice(1);e=e.replace(i,`${t}-${n}`)}return e})).join(" "))}if(e.includes(" ")){let t=e.replace(/[ ,]/g,"");t.split("").every((e=>ur(e)))&&4===t.length&&(e=t)}return{score:e}},separateScoreBlocks:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:{score:e=e.toLowerCase().split(" ").map((e=>{if(/^\d+$/.test(e)&&e.length>2){let i=e.indexOf("1");if(e.length%2){if(3===e.length&&0===i){let n=iT(e.split(""),i);return t.push("getSuper"),n}}else{let{score:i,applied:n}=lT({score:e,applied:[]});i!==e&&(e=i,t.push(...n))}}return e})).join(" "),applied:t}},matchKnownPatterns:function({score:e,applied:t}){for(let T of[".",","," ","/"]){let i=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(i.test(e)){let n=e.match(i).slice(1).map((e=>parseInt(e))),r=Math.abs(n[0]-n[1]);r<=10&&r>=2&&(e=e.split(T).join("-"),t.push("variedJoinerPattern"))}}e.includes(";")&&(e=e.split(";").join(" "),t.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(e)){let[n,r,a,o,s,l]=e.match(i).slice(1);e=e.replace(i,`${n}${r}-${a} ${o}-${s}${l}`),t.push("smashSlashPattern")}/.*\s6[/-]+$/.test(e)&&(e+="0",t.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(e)&&(e=e.replace(n,"(6, 0)"),t.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach((()=>{e=e.split(" ").map((e=>(r.test(e)&&(e=e.replace("("," (")),a.test(e)&&(e=e.replace(")",") ")),e))).join(" "),t.push("spaceConsiderationPatterns")}));let o=aT(e);o!==e&&(e=o,t.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(e)){let[i,n,r]=e.match(s).slice(1),[a,o]=n.split("");e=`${i}-${a} ${o}-${r}`,t.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(e)){let[i,n]=e.match(u).slice(1),r=i.trim(),a=n.trim();if(l.test(r)&&l.test(a)){let i=r.match(l).slice(1,3).join("-"),n=a.match(l).slice(1,3).join("-");e=`${i} ${n}`,t.push("slashSeparationPattern")}}let d=/^([\d -]+),([\d -]+)$/;if(d.test(e)){let[i,n]=e.match(d).slice(1),r=i.trim(),a=n.trim();if(l.test(r)&&l.test(a)){let i=r.match(l).slice(1,3).join("-"),n=a.match(l).slice(1,3).join("-");e=`${i} ${n}`,t.push("commaSeparationPattern")}}let c=/^\d \d,/;if(c.test(e)){let i=e.match(c)[0],n=i.slice(0,i.length-1).split(" ").join("-");e=e.replace(i,n),t.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(e)&&p<3;){let[i,n,r]=e.match(m).slice(1),a=n.split(""),o=`${i}-${a[0]} ${a[1]}-${r}`;e=e.replace(m,o),t.push("noSetSeparationPattern"),p+=1}let f=e.match(/(^|\s)7-6\s(\d+)\s/g);if(null!=f&&f.length){let i=/(^|\s)7-6\s(\d+)\s/;f.forEach((n=>{let r=n.match(i).slice(2)[0];e=e.replace(n,`7-6(${r}) `),t.push("floatingTiebreakPattern1")}))}let h=e.match(/\d \d /);null==h||h.forEach((i=>{let n=i.slice(0,i.length-1).split(" ").join("-");e=e.replace(i,n),t.push("spaceSeparatedSetPattern1")})),h=e.match(/ \d \d$/),null==h||h.forEach((i=>{let n=" "+i.slice(1).split(" ").join("-");e=e.replace(i,n),t.push("spaceSeparatedSetPattern2")}));let v=/^\d, *\d\/\d, *\d/;if(v.test(e)){let i=e.match(v)[0],n=i.split("/").map((e=>`(${e})`)).join(" ")+" ";e=e.replace(i,n),t.push("slashCommaSetPattern")}let g=/\(6-\)/g;g.test(e)&&(e=e.replace(g,"(6-0)"),t.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(e)){let i=e.match(I),n=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),r=e;i.forEach((e=>{let[t,i]=e.match(n).slice(1),a=`${t}-${i}`;r=r.replace(e,a)})),e=r,t.push("slashSetPattern")}let U=/(.*)\s(1\d)\s(\d+)$/;if(U.test(e)){let[i,n,r]=e.match(U).slice(1);i.replace(/\D/g,"").length>=4&&(e=i+` ${n}${r}`,t.push("spaceSeparatedSuperPattern"))}let y=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of e.match(y)||[]){let[i,n,r,a]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[o,s]=n.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(T,`${i}${n}(${r})${a}`),t.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of e.match(S)||[]){let i=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[n,r,a]=T.match(i).slice(1),[o,s]=n.split("-").map((e=>parseInt(e)));1===Math.abs(o-s)&&(e=e.replace(T,`${n}(${r})${a}`),t.push("floatingTiebreakPattern2"))}let w=/(^|\s)(\d \d)\(/g;for(let T of e.match(w)||[]){let i=/(^|\s)(\d \d)\(/,[n,r]=T.match(i).slice(1);e=e.replace(T,`${n}${r.split(" ").join("-")}(`),t.push("spacedTiebreakPattern")}return{score:e,applied:t}},removeDanglingBits:function({score:e,attributes:t}){(e.endsWith(" am")||e.endsWith(" pm"))&&(e=""),e=e.replace(/[A-Za-z]+/g,"").trim(),[".",","].some((t=>e.endsWith(t)))&&(e=e.slice(0,e.length-1));let i="()/-".split("").some((t=>e.includes(t)));/ \d$/.test(e)&&i&&(t={removed:e.slice(e.length-2).trim()},e=e.slice(0,e.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(e)&&(e=e.match(n).slice(1)[0].trim()),{score:e,attributes:t}},removeErroneous:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:[3,4].includes(e.length)&&sT(e)?{score:sT(e)}:{score:e=e.toLowerCase().split(" ").map((e=>{if(!/^\d+$/.test(e)||1!==e.length)return e;t.push("removeErroneous1")})).filter(Boolean).join(" "),applied:t}},handleWalkover:function({score:e,applied:t}){return["walkover","wo","w/o","w-o"].includes(null==e?void 0:e.toString().toLowerCase())?(t.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:t}):{score:e}},properTiebreak:function({score:e,matchUpStatus:t}){var i;let n=null==e?void 0:e.split(" ");e=n.map((e=>{if(e.endsWith("]")){let t=e.split("[");if(tT(t[0]))return t[0]+`(${t[1].slice(0,t[1].length-1)})`}return e})).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(e))for(let l of e.match(r)){let t=null==(i=l.replace(" ","-").match(/\((.*)\)/))?void 0:i[1];if(ur(t)&&(null==t?void 0:t[0])>2)if([2,4].includes(t.length))t=t.split("").join("-");else if(3===t.length){let e=t.indexOf("1");t=iT(t.split(""),e)}e=e.replace(l,`(${t})`)}n=null==e?void 0:e.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=n.length-1;e=n.map(((e,i)=>{let n=[void 0,"","COMPLETED"].includes(t)||i!==o;if(a.test(e)&&n){let[t,i,n]=Array.from(e.match(a)).slice(1);return`${t}(${Math.min(i,n)})`}return e})).join(" "),n=null==e?void 0:e.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),e=n.map((e=>{if(a.test(e)){let[t,i]=Array.from(e.match(a)).slice(1),n=t.split("");return`${n[0]}-${n[1]}(${i})`}return e})).join(" "),n=null==e?void 0:e.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),e=n.map((e=>{if(a.test(e)){let[t,i]=Array.from(e.match(a)).slice(1);return tT(t)?`${t}(${i})`:t}return e})).join(" "),n=null==e?void 0:e.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),e=n.map((e=>{if(a.test(e)){let[t]=e.match(a).slice(1);return`[${t<9?10:parseInt(t)+2}-${t}]`}return e})).join(" ");let s=/\((\d)+0 /;if(s.test(e)){let t=e.match(s)[1];e=e.replace(s,`(${t}) `)}return{score:e}},handleNumeric:lT,handleRetired:function({score:e,profile:t,applied:i}){var n;e=null==e?void 0:e.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(e)){let[t]=e.match(r).slice(1);return i.push("handleRetired"),{score:t.trim(),matchUpStatus:"retired",applied:i}}let a=null==(n=null==t?void 0:t.matchUpStatuses)?void 0:n.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find((t=>null==e?void 0:e.endsWith(t)));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:null==e?void 0:e.replace(o,"").trim(),applied:i}):{score:e}},containedSets:function({score:e,attributes:t,identifier:i}){var n,r,a;if("string"!=typeof e)return{score:e,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=e.match(o);for(let c of s||[]){let t=null==(r=null==(n=c.match(/^\((.*)\)$/))?void 0:n.slice(1))?void 0:r[0],i=e.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(2===(null==t?void 0:t.length)&&(null==i?void 0:i.length)>=2){let e=i.slice(i.length-2).split("").map((e=>parseInt(e)));if(1===Math.abs(e[0]-e[1]))continue}let a=aT(nT(t));e=e.replace(c,`(${a})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);if(null==(a=e.match(l))||a.forEach((t=>{let i=nT(t.match(/^\[(.*)\]$/)[1]);e=e.replace(t,`(${i}) `).trim()})),e.startsWith("(")&&[")","]"].some((t=>e.endsWith(t)))&&[")(","), (",") (",")[",") [","](","] ("].some((t=>e.includes(t)))){let t="",i=e.split(/[)\]]/).filter(Boolean).map((e=>(e.startsWith(",")&&(e=e.slice(1)),e.trim()))),n=i.every((e=>e.includes(",")||eT(e))),r=i.every((e=>e.includes("/")||eT(e))),a=i.every((e=>e.includes("-")||eT(e))),o=(n?",":a&&"-")||r&&"/";if(o){let n;i.forEach((e=>{if(e.startsWith("("))if("set"===n&&(t+=" "),e.includes(o))t+=e.slice(1).split(o).map((e=>e.trim())).join("-"),n="set";else{let i=e.slice(1);t+=`(${i}) `,n="tiebreak"}else if(e.startsWith("[")){let i=e.slice(1).split(o).map((e=>parseInt(e.trim()))),r=Math.min(...i);t+="set"===n?`(${r}) `:`[${i.join("-")}] `,n="tiebreak"}})),e=t.trim()}}let u=Ur(e.split(""));1===u["("]&&1===u[")"]&&e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,e.length-1),1===u["-"]&&tT(e)&&ur(null==t?void 0:t.removed)&&(e+=`(${t.removed})`,t.removed=void 0));let d=/\(\)/g;return d.test(e)&&(e=e.replace(d,"").trim()),{score:e}},sensibleSets:function({score:e,matchUpStatus:t,attributes:i}){let n,r=[],a=e.split(" "),o=a.length;e=a.map(((e,i)=>{if(new RegExp(zw).test(e)){let i=e.slice(3),n=e.slice(0,3),r=n.split("-");if(!tT(n)&&!t){let e=Math.max(...r),t=[e,e-1];return n.indexOf(e)&&t.reverse(),t.join("-")+i}}else if(2===e.length&&ur(e))return e.split("").join("-");e=aT(e);let a=(new RegExp(`^${Yw}$`).test(e)?"super":new RegExp(`^${zw}$`).test(e)&&"tiebreak")||new RegExp(`^${Hw}$`).test(e)&&"standard"||"unknown";if(r.push(a),o>1&&"standard"===a&&i<2){let[t,r]=e.split("-"),a=Math.abs(parseInt(t)-parseInt(r)),o=Math.max(t,r),s=Math.min(t,r),l=[parseInt(t),parseInt(r)].indexOf(s);if(o>9&&a>2){let t=o.toString().split(""),r=t.find((e=>parseInt(e)>s||i&&parseInt(e)<=n))??t[0];r&&(e=l?[r,s].join("-"):[s,r].join("-"))}o>(n||0)&&(n=o)}if("standard"===a){let[i,n]=e.split("-");if(!Math.abs(parseInt(i)-parseInt(n))&&"RETIRED"!==t)return""}return e})).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:u}=uT(e);if(1===u&&"6"===(null==i?void 0:i.removed)&&(e+=" 6-0"),e.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(e=e.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let t=[0,0];e=e.split(" ").map(((e,i)=>(t[l[i]]+=1,Math.max(...t)>2?void 0:e))).filter(Boolean).join(" ")}return{score:e,profile:r}},stringScore:function({score:e}){return{score:e=(null==e?void 0:e.toString().toLowerCase())||""}},superSquare:function({score:e}){let{setsTied:t,winningSide:i}=uT(e),n=/\s\((\d+)\)$/;if(!i&&t&&n.test(e)){let t=e.match(n).slice(1)[0],i=t<=8?10:t+2;e=e.replace(n,` [${i}-${t}]`)}let r=e.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:e};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every((e=>ur(e))))return{score:e};if("76"===o[0]){let t=2===o[1].length?Math.min(...o[1].split("").map((e=>parseInt(e)))):o[1];e=[...r.slice(0,r.length-1),`7-6(${t})`].join(" ")}else{o=o.map((e=>parseInt(e)));let t=Math.max(...o),i=Math.abs(o[0]-o[1]);if(t>=10){if(i>2&&o.every((e=>+e>=10))){let e=o.map((e=>e===t?e-10:10)).sort();i=Math.abs(e[0]-e[1]),i>2&&(o=e)}e=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" ")}else 3===r.length&&t>=7&&i>2&&(e=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" "))}return{score:e}},setBuilder:oT,excisions:function({score:e}){let t=new RegExp(/^\[\d+\](.*)$/);t.test(e)&&(e=e.match(t).slice(1)[0].trim());let i=/\(,/g;return i.test(e)&&(e=e.replace(i,"(")),{score:e}},replaceOh:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:(e.toLowerCase().includes("o")&&(e=e.toLowerCase().split(" ").map((e=>e.split("o").join("0"))).join(" "),t.push("replaceOh")),{score:e,applied:t})}},cT={},pT=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],mT=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function fT(e){if(!e.score)return{error:Fn};let t,i,n,{score:r,sheetName:a,identifier:o,fileName:s,stepLog:l,fullLog:u,profile:d}=e,c=[],p=[],m=r,f=e=>{e.forEach((e=>{n=dT[e]({profile:d,identifier:o,matchUpStatus:t,attributes:i,applied:p,score:m});let r=n.score!==m;r&&c.push({method:e,score:n.score}),l&&(u||r||n.matchUpStatus!==t)&&console.log(t?{score:n.score,matchUpStatus:t}:{score:n.score},e),n.matchUpStatus&&(t=n.matchUpStatus),n.attributes&&(i=n.attributes),n.applied&&(p=n.applied),m=n.score}))};f(pT);let h=Xw(m);return h||(m=r.toString().replace(/\D/g,""),null!=i&&i.removed&&(i.removed=void 0),f(mT),h=Xw(m),h||(m="")),p.forEach((e=>{cT[e]||(cT[e]=0),cT[e]+=1})),{matchUpStatus:null==t?void 0:t.toUpperCase(),modifications:c,attributes:i,isValid:h,score:m}}var hT={};function vT({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:i,winningSide:n,score:r}){if("object"!=typeof r)return{error:Fn};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r,l="scoreString must be a string!";if(void 0!==o&&"string"!=typeof o)return{error:Fn,info:l};if(void 0!==s&&"string"!=typeof s)return{error:Fn,info:l};if(void 0!==a&&!Array.isArray(a))return{error:Fn,info:Tv("sets")};if(null!=a&&a.length){let o=a.map((e=>null==e?void 0:e.setNumber)).filter(Boolean);if(o.length!==hr(o).length)return{error:Fn,info:"setNumbers not unique"};for(let e of a){let{side1Score:t,side2Score:i,side1TiebreakScore:n,side2TiebreakScore:r,side1PointScore:a,side2PointScore:o,winningSide:s,setNumber:l}=e;if(![[t,i],[n,r],[a,o]].filter((e=>e.some((e=>void 0!==e)))).every((e=>e.every((e=>mr(e))))))return{error:Fn,info:"non-numeric values"};if(![l,s].filter((e=>void 0!==e)).every((e=>mr(e))))return{error:Fn,info:"non-numeric values"};if(s&&![1,2].includes(s))return{error:Fn,info:"winningSide must be 1 or 2"}}let{valid:s}=function({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:i,winningSide:n,score:r}){let a=(null==r?void 0:r.sets)??[],o=((null==a?void 0:a.filter((e=>null==e?void 0:e.winningSide)))||[]).reduce(((e,t)=>{let{winningSide:i}=t;return i?(e[i-1]++,e):e}),[0,0]),s=n?n-1:void 0,l=void 0!==s?1-s:void 0,u=void 0!==s&&o[s],d=void 0!==l&&o[l],c=t?xm(t):void 0,p=Math.max(...o),m=Ur(o)[p],f=null==c?void 0:c.bestOf,h=f&&Math.ceil(f/2)||1,v=i??e,g=v&&[gl,Tl,bl].includes(v),I=!c||!a.length||a.every(((e,t)=>{let i=t+1,n=i===f,r=i===a.length,{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:u,winningSide:d}=e,p=Math.max(o??0,s??0),m=l??u,{finalSetFormat:h,setFormat:v}=c,I=n&&h||v;if(m){let{tiebreakTo:e,NoAD:t}=(null==I?void 0:I.tiebreakFormat)||{},i=Math.max(l??0,u??0);if(t&&i>e||i<e&&d&&(r&&!g||!r))return!1}return!I.setTo||!(!I.noTiebreak&&p>I.setTo+1)})),U=(!t||p===h)&&1===m&&o.indexOf(p)+1||void 0;return{valid:I&&(n&&u>d&&n===U||!n&&!U||g)}}({existingMatchUpStatus:e,matchUpStatus:i,matchUpFormat:t,winningSide:n,score:r});if(!s)return{error:Ti,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}be(hT,{analyzeSet:()=>yT,checkScoreHasValue:()=>kf,checkSetIsComplete:()=>jw,getSetComplement:()=>gT,getTiebreakComplement:()=>IT,isValidMatchUpFormat:()=>JI,parseScoreString:()=>UT,validateScore:()=>vT,validateTieFormat:()=>nU});var gT=e=>{let{isSide1:t,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=e;if(void 0===i)return!1;let o,s=rr(i);return(null==s?void 0:s.toString().length)>2&&(s=parseInt(s.toString().slice(0,2))),r&&r<n&&s>r&&(s=r),a&&!r?(s>n&&(o=n),o=s<n?n:n-1):o=s+1<n&&n||r&&r<n&&s===r&&n||!r&&s+2||n+1,[t?s:o,t?o:s]},IT=e=>{let{isSide1:t,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=e;if(void 0===i)return!1;let a="string"==typeof i?parseInt(i):i;(null==a?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let o=function(e){let{lowValue:t,NoAD:i,tiebreakTo:n}=e,r=i?1:2;return t+1>=n?t+r:n}({lowValue:a,NoAD:r,tiebreakTo:n});return[t?a:o,t?o:a]};function UT({tiebreakTo:e=7,scoreString:t=""}){return null==t?void 0:t.split(" ").filter(Boolean).map(((t,i)=>function({set:t,setNumber:i}){let n=(null==t?void 0:t.startsWith("["))&&t.split("[")[1].split("]")[0].split("-").map((e=>parseInt(e))),r=t.includes("(")&&t.split("(")[0]||t.includes("[")&&t.split("[")[0]||t,a=!n&&r.split("-").map((e=>parseInt(e))),o=n?(n[0]>n[1]?1:n[0]<n[1]&&2)||void 0:(a[0]>a[1]?1:a[0]<a[1]&&2)||void 0,s=t.includes("(")?t.split("(")[1].split(")")[0]:void 0,l=(s&&IT({lowValue:s,isSide1:2===o,tiebreakTo:e}))??[],[u,d]=a||[],[c,p]=n||l||[];return{side1Score:u,side2Score:d,side1TiebreakScore:c,side2TiebreakScore:p,winningSide:o,setNumber:i}}({set:t,setNumber:i+1})))}function yT(e){let{setObject:t,matchUpScoringFormat:i}=e;if(!t)return{error:ci};let{setNumber:n}=t||{},{bestOf:r}=i||{},a=!(!n||!r||n!==r),o=a&&(null==i?void 0:i.finalSetFormat)||(null==i?void 0:i.setFormat),s=!(null==o||!o.tiebreakSet),l=!(null==o||!o.timed),u=!s&&!l,d=!!(n&&r&&n<=r),c=[null==t?void 0:t.side1Score,null==t?void 0:t.side2Score],p=[null==t?void 0:t.side1PointScore,null==t?void 0:t.side2PointScore],m=[null==t?void 0:t.side1TiebreakScore,null==t?void 0:t.side2TiebreakScore],f=c.filter((e=>void 0!==e)).length,h=p.filter((e=>void 0!==e)).length,v=m.filter((e=>void 0!==e)).length,g=null==c?void 0:c.filter((e=>!isNaN(e))).length,I=null==m?void 0:m.filter((e=>!isNaN(e))).length,{tiebreakAt:U}=o||{},y=U&&2===c.filter((e=>e>=U)).length,S=y&&((c[0]>c[1]?1:c[1]>c[0]&&2)||void 0),w=!(!I||g),T=!(null==t||!t.winningSide),{error:P,result:D}=function({setObject:e,setFormat:t,sideGameScores:i,sideTiebreakScores:n}){if(!e)return{result:!1,error:ci};let r=!(null==t||!t.tiebreakSet),a=!(null==t||!t.timed);if(!t||r||a)return{result:!1,error:Fn};if(2!==(null==i?void 0:i.filter((e=>!isNaN(e))).length))return{result:!1,error:wi};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:u}=t||{};if(!o||null==i||!i.find((e=>e>=o)))return{result:!1,error:wi};let d=[1,2].includes(null==e?void 0:e.winningSide);if(!e||!d)return{result:!1,error:Pi};let c=(null==e?void 0:e.winningSide)-1,p=1-c,m=i[c],f=i[p],h=m-f;if(!(m>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let v=s&&l,g=2===(null==n?void 0:n.filter((e=>!isNaN(e))).length),I=null==n?void 0:n[c],U=null==n?void 0:n[p],y=s&&2===i.filter((e=>e>=s)).length;if(v){let{NoAD:e,tiebreakTo:t}=l;if(y){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!g)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(t))return{result:!1,error:{message:"tiebreakTo error"}};if(!t||null==n||!n.find((e=>e>=t)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(m>(s<o?o:o+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!I||!U||I<U)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let i=I-U;if(i&&U>=t-1&&i<(e?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!y)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=u?1:2,w=f>=o-1;return h&&w&&!y&&h<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}({setObject:t,setFormat:o,sideGameScores:c,sideTiebreakScores:m}),{error:b,result:M}=function({setObject:e,setFormat:t,sideTiebreakScores:i}){if(!e)return{result:!1,error:ci};let n=!(null==t||!t.tiebreakSet),r=!(null==t||!t.timed);if(!t||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(null==e?void 0:e.winningSide);if(!e||!a)return{result:!1,error:Pi};let{tiebreakSet:o}=t||{},{NoAD:s,tiebreakTo:l}=o||{};if(2!==(null==i?void 0:i.filter((e=>!isNaN(e))).length))return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(null==i||!i.find((e=>e>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=(null==e?void 0:e.winningSide)-1,d=1-u,c=i[u],p=i[d];if(!c||!p||c<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,f=c-p,h=p>=l-1;return f&&h&&f<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}({setObject:t,setFormat:o,sideTiebreakScores:m}),N=u&&!w&&D||s&&w&&M,R=d&&!(s&&!w)&&!(u&&w)&&(!T||N),A=function({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:i,setObject:n}){if(!n)return;let r=Vw({set:n});return jw({matchUpScoringFormat:e,set:n,isDecidingSet:t,isTiebreakSet:i})&&r||void 0}({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:t}),E={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:y,isCompletedSet:T,isDecidingSet:a,isTiebreakSet:w,isValidSet:R,isValidSetNumber:d,isValidSetOutcome:N,leadingSide:S,setFormat:o,sideGameScores:c,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:h,sideTiebreakScores:m,sideTiebreakScoresCount:v,winningSide:A};return void 0!==(null==t?void 0:t.winningSide)&&(w?(E.isValidTiebreakSetOutcome=M,M||(E.tiebreakSetError=b)):(E.isValidStandardSetOutcome=D,D||(E.standardSetError=P))),E}var ST={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},wT={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},TT={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},PT={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},DT={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},bT={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},MT={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},NT={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},RT={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},AT={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},ET={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},CT={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},OT={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},kT={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},FT={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},xT={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},LT={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},_T="COLLEGE_DEFAULT",BT="COLLEGE_JUCO",jT="COLLEGE_D3",VT="DOMINANT_DUO",GT="DOMINANT_DUO_MIXED",$T="LAVER_CUP",qT="TEAM_DOUBLES_3_AGGREGATION",WT="TIME_TENNIS_DUAL",HT="TIME_TENNIS_PRO_CIRCUIT",zT="USTA_BREWER_CUP",YT="USTA_OZAKI_CUP",KT="USTA_COLLEGE",JT="USTA_GOLD_TEAM_CHALLENGE",QT="USTA_LEVEL_1",ZT="USTA_INTERSECTIONAL",XT="USTA_SECTION_BATTLE",eP="USTA_SOUTHERN_LEVEL_5",tP="USTA_TOC",iP="USTA_WTT_ITT",nP="USTA_ZONAL",rP={COLLEGE_D3:jT,COLLEGE_DEFAULT:_T,COLLEGE_JUCO:BT,DOMINANT_DUO:VT,DOMINANT_DUO_MIXED:GT,LAVER_CUP:$T,TEAM_DOUBLES_3_AGGREGATION:qT,TIME_TENNIS_DUAL:WT,TIME_TENNIS_PRO_CIRCUIT:HT,USTA_BREWER_CUP:zT,USTA_OZAKI_CUP:YT,USTA_COLLEGE:KT,USTA_GOLD_TEAM_CHALLENGE:JT,USTA_INTERSECTIONAL:ZT,USTA_LEVEL_1:QT,USTA_SECTION_BATTLE:XT,USTA_SOUTHERN_LEVEL_5:eP,USTA_TOC:tP,USTA_WTT_ITT:iP,USTA_ZONAL:nP},aP="STANDARD",oP={[aP]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[jT]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:oI,matchUpCount:6,matchUpValue:1},tieFormatName:jT,valueGoal:5},[_T]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:oI},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:oI},tieFormatName:_T,valueGoal:4},[BT]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:oI},tieFormatName:BT,valueGoal:5},[$T]:xT,[VT]:ET,[GT]:MT,[qT]:wT,[WT]:NT,[HT]:bT,[zT]:RT,[YT]:AT,[KT]:CT,[JT]:ST,[ZT]:DT,[QT]:OT,[XT]:PT,[eP]:TT,[iP]:kT,[tP]:LT,[nP]:FT},sP=e=>{let t,i=null!=e&&e.namedFormat&&Object.keys(oP).includes(e.namedFormat)?e.namedFormat:aP,n=Array.isArray(null==e?void 0:e.uuids)?null==e?void 0:e.uuids:[],{category:r,gender:a}=(null==e?void 0:e.event)??{},o=Wo(oP[i],!1,!0),s=t=>{var i,r;if(!((null!=e&&e.isMock||null!=(i=null==e?void 0:e.event)&&i.isMock)&&e.event))return(null==n?void 0:n.pop())??am();let a=null==(r=null==e?void 0:e.event)?void 0:r.eventId;return n.pop()??`${a}-COL-${t+1}`};return o.hydrate?(t={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:sI,collectionName:"Doubles",matchUpType:Cd,...o.doubles},{collectionId:s(1),matchUpFormat:oI,collectionName:"Singles",matchUpType:Ad,...o.singles}]},o.tieFormatName&&(t.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach(((e,t)=>e.collectionId=s(t))),t=o),null!=e&&e.hydrateCollections&&t.collectionDefinitions.forEach((e=>{r&&!e.category&&(e.category=r),a&&!e.gender&&(e.gender=a)})),t};function lP(e){var t,i,n,r,a;let o=e.drawDefinition,{existingQualifyingPlaceholderStructureId:s,drawEntries:l,appliedPolicies:u,structureId:d,idPrefix:c,isMock:p}=e,m=e.qualifyingProfiles,f=null!=m&&m.length?Yy({uuids:e.uuids,qualifyingProfiles:m,appliedPolicies:u,idPrefix:c,isMock:p}):void 0;if(null!=f&&f.error)return f;o.structures=null==(t=o.structures)?void 0:t.filter((({structureId:e})=>e!==s)),o.links=null==(i=o.links)?void 0:i.filter((({source:e})=>e.structureId!==s));let{qualifiersCount:h,qualifyingDrawPositionsCount:v,qualifyingDetails:g}=f??{};v&&(null!=f&&f.structures&&(null==(n=o.structures)||n.push(...f.structures)),null!=f&&f.links&&(null==(r=o.links)||r.push(...f.links)));let I=null==(a=o.structures)?void 0:a.find((({stage:e,stageSequence:t})=>e===xl&&1===t)),{qualifiersCount:U}=Ih({stageSequence:1,drawDefinition:o,structureId:d,stage:xl}),y=Cg({qualifiersCount:Math.max(h??0,U??0),drawDefinition:o,stage:xl});if(y.error||(y=Eg({drawSize:v,stage:Ll,drawDefinition:o}),y.error))return y;!function({drawDefinition:e,drawEntries:t}){for(let i of(t??[]).filter((({entryStage:e})=>e===Ll))){wh({...i,entryStage:i.entryStage??xl,drawDefinition:e})}}({drawDefinition:o,drawEntries:l});let S=function({mainStructure:e,qualifyingDetails:t,drawDefinition:i}){var n;for(let r of t||[]){let{finalQualifyingRoundNumber:t,finalQualifyingStructureId:a,roundTarget:o,finishingPositions:s,linkType:l}=r,u=e&&(null==(n=Fg({targetStructureId:e.structureId,sourceStructureId:a,sourceRoundNumber:t,finishingPositions:s,targetEntryRound:o,linkType:l}))?void 0:n.link);if(null!=u&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}({mainStructure:I,qualifyingDetails:g,drawDefinition:o});return S.error?S:{drawDefinition:o,structureId:d}}function uP(e){var t,i;let{participantIds:n}=e,r=(null==(i=null==(t=e.drawDefinition)?void 0:t.entries)?void 0:i.filter((t=>{let i=t.entryStatus;return!e.restrictEntryStatus||wc.includes(i)})).map(sl))??[];if(n){let e=n.filter((e=>!(null!=r&&r.includes(e))));if(null!=e&&e.length)return Sa({result:{error:Ei},info:{invalidParticipantIds:e}})}else n=r;return e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>n.length-1&&(!e.enableDoubleRobin||e.roundsCount>2*(n.length-1))?{error:Fn,info:"Not enough participants for roundsCount"}:e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>31?{error:Fn,info:"roundsCount must be less than 32"}:{participantIds:n}}function dP(e){var t;let i,n=[],{roundsCount:r=1,drawDefinition:a,matchUpsCount:o,structureId:s,idPrefix:l,isMock:u,event:d}=e,c=uP(e);if(c.error)return c;for(let p of br(1,r+1)){let r=vS({restrictMatchUpsCount:e.restrictMatchUpsCount,ignoreLastRoundNumber:!!i,newRound:!i,drawDefinition:a,matchUpsCount:o,structureId:s,roundNumber:i,idPrefix:l,isMock:u,event:d});if(r.error)return Sa({result:r,info:{iteration:p}});null!=(t=r.matchUps)&&t.length&&n.push(...r.matchUps),i=((null==r?void 0:r.roundNumber)??1)+1}return{matchUps:n}}function cP({scaleType:e=oo,scaleAccessor:t,participant:i,scaleName:n,eventType:r}){var a,o;let s=null==(o=null==(a=i&&rh({scaleAttributes:{eventType:r??jp,scaleType:e,scaleName:n},participant:i}))?void 0:a.scaleItem)?void 0:o.scaleValue;return t&&Ce(s)?s[t]:s}function pP(e){var t,i;let n=function(e){var t;return e.roundsCount&&"number"!=typeof e.roundsCount?{error:Fn,info:"roundsCount must be a number"}:"object"!=typeof e.drawDefinition||e.drawDefinition.drawType&&e.drawDefinition.drawType!==au?{error:Ye}:Array.isArray(null==(t=e.drawDefinition)?void 0:t.entries)||!e.participantIds||Array.isArray(e.participantIds)?{error:void 0}:{error:Fn,info:"Missing Entries"}}(e);if(null!=n&&n.error)return n;let r=uP(e);if(r.error)return r;let a=function(e){var t,i,n;if(e.structureId)return e.structureId;let r=e.drawDefinition,a=null==(i=null==(t=null==r?void 0:r.structures)?void 0:t.filter((e=>1===e.stageSequence)))?void 0:i.reduce(((e,t)=>{let i=t.stage&&Gl[t.stage];return Nm({structure:t})&&i>(Gl[null==e?void 0:e.stage]||1)?t:e}),void 0),o=null==(n=null==r?void 0:r.structures)?void 0:n.find((e=>e.structureId===(null==a?void 0:a.structureId)));return o?Nm({structure:o})?{structure:o}:{error:Ye}:{error:bt}}(e);if(a.error)return a;let o,s=function(e){var t;let{tournamentRecord:i,participantIds:n,scaleName:r,eventType:a,adHocRatings:o={}}=e,s=e.scaleAccessor??(null==(t=cS[r])?void 0:t.accessor),l=i.participants??[];for(let u of n??[]){let e=null==l?void 0:l.find((e=>e.participantId===u)),t=cP({scaleName:`${r}.${ro}`,participant:e,eventType:a});!t&&r&&(t=cP({scaleAccessor:s,participant:e,scaleName:r,eventType:a})),t&&!o[u]&&(o[u]=t)}return o}(e),l=(null==(t=e.tournamentRecord)?void 0:t.isMock)??e.isMock,u=e.eventType??(null==(i=e.event)?void 0:i.eventType),d=[],c=[];for(let p of br(1,(e.roundsCount??1)+1)){let t=bS({...e,participantIds:r.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:d,adHocRatings:s,roundNumber:o,eventType:u,isMock:l});if(t.error)return t;let{matchUps:i,...n}=t;c.push({...n,iteration:p,matchUpsCount:null==i?void 0:i.length}),o=((null==n?void 0:n.roundNumber)??1)+1,null!=i&&i.length&&d.push(...i)}return{...Be,matchUps:d,roundResults:c}}function mP(e){var t,i;let{tournamentRecord:n,drawDefinition:r,structureId:a,idPrefix:o,isMock:s,event:l}=e,u=null==(t=null==l?void 0:l.entries)?void 0:t.filter((({entryStage:e,entryStatus:t})=>(!e||e===xl)&&t&&wc.includes(t))),d=null==u?void 0:u.map(sl),c=u?Math.floor(u.length/2):0;if(e.automated)return function(e){var t,i;let{restrictEntryStatus:n,generateMatchUps:r,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=e.drawMatic??{},u=pP({...e,eventType:(null==(t=e.drawMatic)?void 0:t.eventType)??e.matchUpType,generateMatchUps:r??!0,scaleAccessor:l??e.scaleAccessor,scaleName:s??e.scaleName,participantIds:e.participantIds,roundsCount:e.roundsCount,restrictEntryStatus:n,structureId:a,matchUpIds:o});return u.error?u:(null!=(i=null==u?void 0:u.matchUps)&&i.length&&MU({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,suppressNotifications:!0,matchUps:u.matchUps,event:e.event,structureId:a}),{...Be})}({...e,participantIds:d});{let t=dP({roundsCount:e.roundsCount,drawDefinition:r,matchUpsCount:c,idPrefix:o,isMock:s,event:l});if(t.error)return t;null!=(i=t.matchUps)&&i.length&&MU({matchUps:t.matchUps,suppressNotifications:!0,tournamentRecord:n,drawDefinition:r,structureId:a,event:l})}return{...Be}}function fP({sortDescending:e=!1,tournamentRecord:t,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:o,stage:s}){return t?{scaledEntries:(a=a??(null==o?void 0:o.entries)??[]).filter((e=>(!s||!e.entryStage||e.entryStage===s)&&(!r||!e.entryStageSequence||e.entryStageSequence===r)&&wc.includes(e.entryStatus))).map((e=>{let{participantId:n}=e,{scaleItem:r}=iS({tournamentRecord:t,scaleAttributes:i,participantId:n});return{...e,...r}})).filter((e=>{let t=e.scaleValue;return!!(n||!isNaN(t)&&parseFloat(t))&&t})).sort(n||function(t,i){return e?l(i)-l(t):l(t)-l(i)})}:{error:We};function l(t){return parseFloat(t.scaleValue||(e?-1:1e5))}}function hP(e){let t="prepareStage",{drawDefinition:i}=e,{structures:n}=Bu({stageSequence:e.stageSequence||1,roundTarget:e.roundTarget,stage:e.stage,drawDefinition:i}),r=e.preparedStructureIds||[],a=null==n?void 0:n.find((({structureId:e})=>!r.includes(e)));if(!a)return Sa({result:{error:bt},stack:t});let o=null==a?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:u}=function(e){let{seedsCount:t}=e;e.seededParticipants&&(t=e.seededParticipants.length),t>e.drawSize&&(t=e.drawSize);let i=function({entries:e,stage:t,stageSequence:i,roundTarget:n}){return e.filter((e=>{var r,a;let o=null==(a=null==(r=Ds({name:Gs,element:e}))?void 0:r.extension)?void 0:a.value;return(!e.entryStage||e.entryStage===t)&&(!i||!e.entryStageSequence||e.entryStageSequence===i)&&(!n||!o||o===n)&&Sc.includes(e.entryStatus)}))}(e);t>i.length&&(t=i.length);let{seedLimit:n}=function({requireParticipantCount:e=!0,enforcePolicyLimits:t=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:u}){var d,c;n=n??r;let p=_u({drawDefinition:o,structureId:l});if(p.error)return p;let m=p.structure;if(!m)return{error:bt};let{positionAssignments:f}=Gu({structure:m}),h=(null==f?void 0:f.length)||0;if(u>h)return{error:vt};let v=null==(d=m.structures)?void 0:d.length,g=mr(null==s?void 0:s.groupSeedingThreshold)&&(null==s?void 0:s.groupSeedingThreshold),I=null==(c=av({roundRobinGroupsCount:v,drawSize:h}))?void 0:c.seedGroups,{seedsCount:U}=Hy({policyDefinitions:a,requireParticipantCount:e,drawSizeProgression:i,participantsCount:n,drawSize:h});return U&&null!=a&&a[as]&&u>U&&t&&(u=U),m.seedLimit=u,m.seedAssignments=br(1,u+1).map((e=>{let t=null==I?void 0:I.find((t=>t.includes(e))),i=t&&Math.min(...t);return{participantId:void 0,seedNumber:e,seedValue:g&&e>=g?i:e}})),wd({drawDefinition:o,structureIds:[l]}),{...Be,seedLimit:u}}({enforcePolicyLimits:e.enforcePolicyLimits??!0,appliedPolicies:e.appliedPolicies,participantsCount:i.length,seedingProfile:e.seedingProfile,drawDefinition:e.drawDefinition,structureId:e.structureId,seedsCount:t});return n&&n<t&&(t=n),{seedsCount:t,stageEntries:i,seedLimit:n}}({...e,structureId:o});(e.seededParticipants||e.event||e.seedingScaleName)&&function(e){let{seededParticipants:t,seedingScaleName:i,entries:n,event:r}=e,a=n.map(sl);t?function(e){let{provisionalPositioning:t,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:u,event:d}=e,c=u?uv({provisionalPositioning:t,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;n.filter((({participantId:e})=>i.includes(e))).filter((e=>!e.seedNumber||e.seedNumber<=n.length)).sort(((e,t)=>e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0)).forEach((e=>{let{participantId:i,seedNumber:n,seedValue:a}=e;fv({provisionalPositioning:t,tournamentRecord:r,drawDefinition:o,seedingProfile:s,participantId:i,seedBlockInfo:c,structureId:l,seedNumber:n,seedValue:a,event:d})}))}({...e,enteredParticipantIds:a}):(r||i)&&function(e){let t=e.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:u,structureId:d,event:c}=e,{categoryName:p,ageCategoryCode:m}=(null==c?void 0:c.category)||{},f=null==c?void 0:c.eventType,h=function(e){let{tournamentRecord:t,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:o}=e,{categoryName:s,ageCategoryCode:l}=(null==o?void 0:o.category)||{},u=null==o?void 0:o.eventType,d={scaleName:i||s||l||o.eventId,scaleType:lo,eventType:u};return fP({scaleAttributes:d,tournamentRecord:t,stageSequence:n,entries:r,stage:a}).scaledEntries}({...e,ageCategoryCode:m,categoryName:p,eventType:f})||l&&function(e){let{tournamentRecord:t,stageSequence:i,event:n,entries:r,stage:a}=e,{categoryName:o,ageCategoryCode:s}=(null==n?void 0:n.category)||{},l=null==n?void 0:n.eventType;return fP({scaleAttributes:{scaleName:o||s,scaleType:ao,eventType:l},tournamentRecord:t,stageSequence:i,entries:r,stage:a}).scaledEntries}({...e,ageCategoryCode:m,categoryName:p,eventType:f}),v=(null==h?void 0:h.length)??0;v<t&&(t=v),null==h||h.filter((({participantId:e})=>n.includes(e))).slice(0,a||t).forEach(((e,t)=>{let n=t+1,{participantId:a,scaleValue:l}=e,p=(null==r?void 0:r[n])||l||n;fv({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:a,structureId:d,seedNumber:n,seedValue:p,event:c})}))}({...e,enteredParticipantIds:a})}({...e,seedsCount:s,structure:a,structureId:o});let d=!1!==e.automated&&e.drawType!==au&&!(e.qualifyingOnly&&e.stage!==Ll),c=((null==n?void 0:n.length)||0)>1,p=d?function(e){let t="object"==typeof e.automated&&e.automated.seedsOnly,i=hg({...e,seedsOnly:t});if(i.error)return i;let n=null==i?void 0:i.positionAssignments,r=null==i?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}({...e,multipleStructures:c,seedLimit:u,structureId:o}):{};return null!=p&&p.error?Sa({result:p,stack:t}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function vP(e){var t;let i=tS({...e,modifyOriginal:!1});if(i.error)return i;let n=i.drawDefinition,{ignoreStageSpace:r,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:u,placeByes:d,drawSize:c,drawType:p,entries:m}=e,f=[],h=[],v=function(e){let{ignoreStageSpace:t,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=e;for(let o of a){if(n&&o.entryStage&&o.entryStage!==xl)continue;let e=wh({...o,ignoreStageSpace:t??r===au,entryStage:o.entryStage??xl,drawDefinition:i,drawType:r});if(n&&e.error)return e}return{error:void 0}}({ignoreStageSpace:r,drawDefinition:n,drawEntries:u,drawType:p,entries:m});if(v.error)return v;let g=p===mu?0:rr(e.seedsCount??0),I=hP({...e,qualifyingOnly:!c||o,appliedPolicies:a,drawDefinition:n,seedingProfile:s,participants:l,stage:xl,seedsCount:g,placeByes:d,drawSize:c,entries:m});if(I.error&&!I.conflicts)return I;null!=(t=I.positioningReport)&&t.length&&f.push({[xl]:I.positioningReport});let U=I.structureId;return I.conflicts&&(h=I.conflicts),p===au&&e.roundsCount&&mP({...e,drawDefinition:n,structureId:U}),{drawDefinition:n,positioningReports:f,conflicts:h,structureId:U}}var gP=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]});function IP(e){let t=e.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:o,event:s}=e,l=io(e,[{[Da]:!0,[ba]:!0}]);if(l.error)return l;if(!JI({matchUpFormat:r}))return{error:$t};if(o){let e=OI({drawDefinition:n,matchUpId:o,event:s});if(e.error)return e;let t=e.matchUp;if((null==t?void 0:t.matchUpType)===$p)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:ii};t&&(t.matchUpFormat=r,yd({tournamentId:null==i?void 0:i.tournamentId,eventId:null==s?void 0:s.eventId,context:"setMatchUpFormat",drawDefinition:n,matchUp:t}))}else if(Array.isArray(t)){if((null==s?void 0:s.eventType)===$p)return{error:At};for(let e of t){let t=_u({drawDefinition:n,structureId:e});if(t.error)return t;t.structure&&(t.structure.matchUpFormat=r)}}else if(a){if((null==s?void 0:s.eventType)===$p)return{error:At};let e=_u({drawDefinition:n,structureId:a});if(e.error)return e;e.structure&&(e.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return t=t??(a?[a]:void 0),wd({drawDefinition:n,structureIds:t}),{...Be}}function UP({tournamentRecord:e,drawDefinition:t,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(null==a?void 0:a.matchUpFormat)===i||null!=a&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let e=function({tieFormat:e}){let t=nU({checkCollectionIds:!1,tieFormat:e});if(t.error)return t;for(let i of e.collectionDefinitions)i.collectionId||(i.collectionId=am());return{tieFormat:e}}({tieFormat:r});if(e.error)return e;t.tieFormat=e.tieFormat??r}else if(i){let n=IP({tournamentRecord:e,drawDefinition:t,matchUpFormat:i,event:a});if(n.error)return{info:"matchUpFormat or tieFormat error",error:n.error}}n&&(t.matchUpType=n)}return{error:void 0}}var yP={};be(yP,{attachPolicies:()=>vU,findPolicy:()=>Gc,getAppliedPolicies:()=>jc,getPolicyDefinitions:()=>Vc,mutate:()=>SP,query:()=>PP,removePolicy:()=>wP});var SP={};function wP(e){let t=io(e,[{policyType:!0,_anyOf:{[wa]:!1,[Pa]:!1,[Da]:!1,[qa]:!1}}]);if(t.error)return t;let i,n=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(n)return TP(e,n);if(!e.tournamentRecords)return{error:We};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:We};for(let n of t){let t=TP(e,e.tournamentRecords[n]);if(t.error)return t;i=!0}}return i?{...Be}:{error:ui}}function TP(e,t){let i=jc(e).appliedPolicies??{};return i[e.policyType]?(delete i[e.policyType],Object.keys(i).length?fs({element:t,extension:{name:bs,value:i}}):ps({element:t,name:bs}),{...Be}):{error:ui}}be(SP,{attachPolicies:()=>vU,removePolicy:()=>wP});var PP={};be(PP,{findPolicy:()=>Gc,getAppliedPolicies:()=>jc,getPolicyDefinitions:()=>Vc});var DP={[as]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[bu]:{positioning:Yl},[Du]:{positioning:Yl}},positioning:"SEPARATE"},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},bP=DP;function MP({appliedPolicies:e,policyDefinitions:t,drawDefinition:i,stack:n}){if(t&&"object"!=typeof t)return Sa({info:"policyDefinitions must be an object",result:{error:Fn},stack:n});let r={[ns]:null==e?void 0:e[ns]};return t?function({policyDefinitions:e,appliedPolicies:t,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(e))JSON.stringify(null==t?void 0:t[r])!==JSON.stringify(e[r])&&(i[r]=e[r]);Object.keys(i).length&&(vU({policyDefinitions:i,drawDefinition:n}),t&&Object.assign(t,i))}({policyDefinitions:t,appliedPolicies:e,policiesToAttach:r,drawDefinition:i}):r.avoidance&&vU({drawDefinition:i,policyDefinitions:r}),!(null!=e&&e[as])&&!(null!=t&&t[as])&&(vU({policyDefinitions:bP,drawDefinition:i}),e&&Object.assign(e,bP)),{error:void 0}}function NP(e){var t,i,n,r,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:u,matchUpType:d,tieFormat:c,drawType:p,stack:m,event:f}=e,h=e.drawId?null==(t=null==f?void 0:f.drawDefinitions)?void 0:t.find((t=>t.drawId===e.drawId)):void 0;h&&p!==h.drawType&&(h.drawType=p);let v=h??function(e){let{drawId:t=am(),processCodes:i,matchUpType:n,drawType:r}=e??{},a=gP();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:t})}({processCodes:e.processCodes,drawId:e.drawId,drawType:p}),g=UP({tournamentRecord:o,drawDefinition:v,matchUpFormat:s,matchUpType:d,tieFormat:c,event:f});if(g.error)return Sa({result:g,stack:m});let I=MP({appliedPolicies:l,policyDefinitions:u,drawDefinition:v,stack:m});if(I.error)return I;let U=null==(n=null==(i=null==h?void 0:h.structures)?void 0:i.find((e=>e.stage===xl&&1===e.stageSequence)))?void 0:n.structureId,y=h?null==(r=h.structures)?void 0:r.filter((e=>e.stage===Ll)):[];return{drawDefinition:v,structureId:U,existingDrawDefinition:h,existingQualifyingPlaceholderStructureId:1===(null==y?void 0:y.length)&&!(null!=(a=y[0].matchUps)&&a.length)&&y[0].structureId}}var RP={};function AP(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}be(RP,{addGoesTo:()=>cf,allCompetitionMatchUps:()=>Af,allDrawMatchUps:()=>Cf,allEventMatchUps:()=>Nf,allPlayoffPositionsFilled:()=>Wv,allTournamentMatchUps:()=>Rf,analyzeDraws:()=>SU,analyzeMatchUp:()=>sb,analyzeTournament:()=>YP,bulkUpdatePublishedEventIds:()=>nD,calculateWinCriteria:()=>ZD,categoryCanContain:()=>tU,checkMatchUpIsComplete:()=>Xm,checkValidEntries:()=>zy,compareTieFormats:()=>QP,competitionScheduleMatchUps:()=>zD,credits:()=>AP,drawMatchUps:()=>lb,eventMatchUps:()=>qD,filterParticipants:()=>fh,findDrawDefinition:()=>FU,findExtension:()=>Ds,getAllDrawMatchUps:()=>uf,getAllEventData:()=>lD,getAllStructureMatchUps:()=>Zm,getAllowedDrawTypes:()=>BP,getAllowedMatchUpFormats:()=>_P,getAppliedPolicies:()=>jc,getAssignedParticipantIds:()=>Xf,getAvailableMatchUpsCount:()=>EU,getAvailablePlayoffProfiles:()=>Jg,getCategoryAgeDetails:()=>XI,getCheckedInParticipantIds:()=>yp,getCompetitionDateRange:()=>WP,getCompetitionMatchUps:()=>HD,getCompetitionParticipants:()=>CP,getCompetitionPenalties:()=>VP,getCompetitionVenues:()=>sD,getCourtInfo:()=>pm,getCourts:()=>db,getDrawData:()=>dD,getDrawDefinitionTimeItem:()=>gf,getDrawParticipantRepresentativeIds:()=>CU,getDrawTypeCoercion:()=>Gy,getEligibleVoluntaryConsolationParticipants:()=>AU,getEntriesAndSeedsCount:()=>MD,getEvent:()=>fb,getEventData:()=>cD,getEventMatchUpFormatTiming:()=>LD,getEventProperties:()=>pb,getEventPublishStatus:()=>lh,getEventStructures:()=>Gv,getEventTimeItem:()=>If,getEvents:()=>mb,getFlightProfile:()=>fm,getLinkedTournamentIds:()=>tl,getMatchUpCompetitiveProfile:()=>qc,getMatchUpContextIds:()=>XD,getMatchUpDailyLimits:()=>YD,getMatchUpDailyLimitsUpdate:()=>BD,getMatchUpDependencies:()=>Of,getMatchUpFormat:()=>ib,getMatchUpFormatTiming:()=>Hp,getMatchUpFormatTimingUpdate:()=>ED,getMatchUpScheduleDetails:()=>vm,getMatchUpType:()=>Em,getMatchUpsMap:()=>Wd,getMatchUpsStats:()=>nb,getMaxEntryPosition:()=>ND,getModifiedMatchUpFormatTiming:()=>_D,getPairedParticipant:()=>Pm,getParticipantEventDetails:()=>OP,getParticipantIdFinishingPositions:()=>OU,getParticipantMembership:()=>kP,getParticipantResults:()=>hI,getParticipantScaleItem:()=>iS,getParticipantSchedules:()=>FP,getParticipantSignInStatus:()=>xP,getParticipantTimeItem:()=>yf,getParticipants:()=>vh,getPersonRequests:()=>SD,getPolicyDefinitions:()=>Vc,getPositionAssignments:()=>$y,getPositionsPlayedOff:()=>Yg,getPredictiveAccuracy:()=>KD,getProfileRounds:()=>DD,getPublishState:()=>dh,getRoundMatchUps:()=>jd,getRounds:()=>ob,getScaleValues:()=>co,getScaledEntries:()=>fP,getScheduledRoundsDetails:()=>fD,getSchedulingProfile:()=>gD,getSchedulingProfileIssues:()=>yD,getSeedingThresholds:()=>ov,getSeedsCount:()=>Hy,getStructureSeedAssignments:()=>Nc,getTeamLineUp:()=>Dm,getTieFormat:()=>tD,getTimeItem:()=>vf,getTournamentIds:()=>Ts,getTournamentInfo:()=>qP,getTournamentPenalties:()=>jP,getTournamentPersons:()=>HP,getTournamentStructures:()=>$v,getTournamentTimeItem:()=>Uf,getValidGroupSizes:()=>nv,getVenueData:()=>mm,getVenuesAndCourts:()=>oD,isAdHoc:()=>Nm,isCompletedStructure:()=>qv,isValidForQualifying:()=>qy,isValidMatchUpFormat:()=>JI,matchUpActions:()=>_y,participantScaleItem:()=>rh,participantScheduledMatchUps:()=>VD,positionActions:()=>Vy,publicFindVenue:()=>um,tallyParticipantResults:()=>RI,tieFormatGenderValidityCheck:()=>qI,tournamentMatchUps:()=>WD,validMatchUp:()=>_d,validMatchUps:()=>Bd,validateCollectionDefinition:()=>iU,validateLineUp:()=>Pv});var EP={};function CP(e){let{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:qe};let i=[],n={},r={},a={},o=[],s={},l=[];for(let u of Object.values(t)){let{participantIdsWithConflicts:t,mappedMatchUps:d,participantMap:c,participants:p,matchUps:m,derivedEventInfo:f,derivedDrawInfo:h}=vh({...e,tournamentRecord:u});Object.assign(s,d),Object.assign(n,c),Object.assign(r,f),Object.assign(a,h),i.push(...p??[]),o.push(...m??[]),null==t||t.forEach((e=>{l.includes(e)||l.push(e)}))}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:i,...Be,matchUps:o}}function OP({tournamentRecord:e,participantId:t}){if(!e)return{error:We};if(!t)return{error:_i};let i=[t].concat((e.participants??[]).filter((e=>{var i;return(null==e?void 0:e.participantType)&&[ec,Xd].includes(e.participantType)&&(null==(i=e.individualParticipantIds)?void 0:i.includes(t))})).map((e=>e.participantId)));return{eventDetails:(e.events??[]).filter((e=>Ar(((null==e?void 0:e.entries)??[]).map((e=>e.participantId)),i))).map((e=>({eventName:e.eventName,eventId:e.eventId})))}}function kP({tournamentRecord:e,participantId:t}){if(!e)return{error:We};if(!t)return{error:_i};let{participants:i}=vh({participantFilters:{participantTypes:[ec,Xd,Zd]},tournamentRecord:e});return(i??[]).filter((e=>{var i;return null==(i=e.individualParticipantIds)?void 0:i.includes(t)})).reduce(((e,t)=>{let i=t.participantType;return i&&(e[i]||(e[i]=[]),e[i].push(t)),e}),{})}function FP({participantFilters:e={},tournamentRecord:t}){if(!t)return{error:We};if("object"!=typeof e)return{error:Cn,context:{participantFilters:e}};let i=Rf({tournamentRecord:t,contextFilters:{eventIds:e.eventIds}}).matchUps??[],n=Object.assign({},...i.map((e=>({[e.matchUpId]:e})))),r=i.filter((({schedule:e})=>e&&Object.keys(e).length)),a=Of({tournamentRecord:t,matchUps:i}).sourceMatchUpIds??[],o={};for(let s of r){let e,{sides:t}=s,i=(null==t?void 0:t.map((t=>{if(t.participant)return[t.participant].concat(...t.participant.individualParticipants||[]);a[s.matchUpId]&&!e&&(e=(a[s.matchUpId]||[]).map((e=>n[e])).filter((({winningSide:e,bye:t})=>!e&&!t)))})).filter(Boolean).flat())??[];for(let n of i){let{participantId:e}=n;o[e]||(o[e]={potentialMatchUps:[],participant:n,matchUps:[]}),o[e].matchUps.push(s)}let r=(null==e?void 0:e.map((({sides:e})=>e)).flat().map((({participant:e})=>e&&[e].concat(...e.individualParticipants||[]))).filter(Boolean).flat())||[];for(let n of r){let{participantId:e}=n;o[e]||(o[e]={potentialMatchUps:[],participant:n,matchUps:[]}),o[e].potentialMatchUps.push(s)}}return{participantSchedules:Object.values(o).filter((({participant:t})=>!(e.participantIds&&!e.participantIds.includes(t.participantId)||e.participantTypes&&!e.participantTypes.includes(t.participantType)))),...Be}}function xP({tournamentRecord:e,participantId:t}){if(!e)return{error:We};if(!t)return{error:_i};let{participant:i}=hf({tournamentRecord:e,participantId:t});if(!i)return{error:Bi};let{timeItem:n}=vf({itemType:zd,element:i});return n&&n.itemValue===Kd&&Kd}be(EP,{filterParticipants:()=>fh,getCompetitionParticipants:()=>CP,getPairedParticipant:()=>Pm,getParticipantEventDetails:()=>OP,getParticipantMembership:()=>kP,getParticipantScaleItem:()=>iS,getParticipantSchedules:()=>FP,getParticipantSignInStatus:()=>xP,getParticipantTimeItem:()=>yf,getParticipants:()=>vh,getScaleValues:()=>co,participantScaleItem:()=>rh,validateLineUp:()=>Pv});var LP={};function _P({tournamentRecord:e,categoryName:t,categoryType:i}){var n;if(!e)return{error:We};let{appliedPolicies:r}=jc({tournamentRecord:e});return((null==(n=null==r?void 0:r[rs])?void 0:n.matchUpFormats)||[]).filter((({categoryNames:e,categoryTypes:n})=>!t&&!n||t&&(null==e?void 0:e.includes(t))||i&&(null==n?void 0:n.includes(i))))}function BP({tournamentRecord:e,categoryName:t,categoryType:i}){var n;if(!e)return{error:We};let{appliedPolicies:r}=jc({tournamentRecord:e});return((null==(n=null==r?void 0:r[ss])?void 0:n.allowedDrawTypes)||[]).filter((({categoryNames:e,categoryTypes:n})=>!t&&!n||t&&(null==e?void 0:e.includes(t))||i&&(null==n?void 0:n.includes(i))))}function jP({tournamentRecord:e}){if(!e)return{error:We};let t=((null==e?void 0:e.participants)??[]).reduce(((e,t)=>{let{participantId:i}=t;return(t.penalties??[]).forEach((t=>{let{penaltyId:n}=t||{};e[n]?e[n].participants.push(i):e[n]={...t,participantIds:[i]}})),e}),{});return{penalties:Object.values(t)}}function VP({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:qe};let t=[];for(let i of Object.values(e)){let{penalties:e}=jP({tournamentRecord:i});t.push(...e??[])}return{penalties:t}}function GP({event:e}){return{eventInfo:(({eventId:e,eventName:t,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:l,endDate:u,ballType:d,discipline:c,onlineResources:p,notes:m})=>({eventId:e,eventName:t,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:l,endDate:u,ballType:d,discipline:c,onlineResources:p,notes:m}))(e)}}be(LP,{analyzeDraws:()=>SU,analyzeTournament:()=>YP,getAllowedDrawTypes:()=>BP,getAllowedMatchUpFormats:()=>_P,getAppliedPolicies:()=>jc,getCompetitionDateRange:()=>WP,getCompetitionPenalties:()=>VP,getPolicyDefinitions:()=>Vc,getTournamentInfo:()=>qP,getTournamentPenalties:()=>jP,getTournamentPersons:()=>HP,getTournamentStructures:()=>$v,getTournamentTimeItem:()=>Uf});var $P={[es]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}};function qP(e){var t,i,n,r;let{tournamentRecord:a}=e??{};if(!a)return{error:We};let o=(({tournamentId:e,tournamentRank:t,tournamentStatus:i,formalName:n,tournamentName:r,promotionalName:a,onlineResources:o,localTimeZone:s,startDate:l,endDate:u,hostCountryCode:d,venues:c,notes:p,updatedAt:m})=>({tournamentId:e,tournamentRank:t,tournamentStatus:i,formalName:n,tournamentName:r,promotionalName:a,onlineResources:o,localTimeZone:s,startDate:l,endDate:u,hostCountryCode:d,venues:c,notes:p,updatedAt:m}))(a),s=vh({participantFilters:{participantRoles:[Rh,Oh,Eh,Ch,Fh]},policyDefinitions:$P,tournamentRecord:a}).participants;s&&(o.tournamentContacts=s);let l=(null==(r=null==(n=null==(i=null==(t=dh({tournamentRecord:a}))?void 0:t.publishState)?void 0:i.tournament)?void 0:n.status)?void 0:r.publishedEventIds)||[],u=[];for(let d of a.events??[])if(null==e||!e.usePublishState||l.includes(d.eventId)){let e=GP({event:d}).eventInfo;e&&u.push(e)}return o.eventInfo=u,{tournamentInfo:Wo(o,!1,!0),...Be}}function WP({tournamentRecords:e}){if(!Ce(e))return{error:qe};let t=Object.keys(e??{}).reduce(((t,i)=>{let n=e[i],{tournamentInfo:{startDate:r,endDate:a}}=qP({tournamentRecord:n}),o=r&&new Date(Co(r));(!t.startDate||o&&o<t.startDate)&&(t.startDate=o);let s=a&&new Date(Co(a));return(!t.endDate||s&&s>t.endDate)&&(t.endDate=s),t}),{startDate:void 0,endDate:void 0}),i=t.startDate&&Co(t.startDate.toISOString()),n=t.endDate&&Co(t.endDate.toISOString());return i&&n?{startDate:i,endDate:n}:{error:fi}}function HP({tournamentRecord:e,participantFilters:t}){if(!e)return{error:We};let i=e.participants||[];t&&(i=fh({participants:i,participantFilters:t,tournamentRecord:e}));let n={};return i.forEach((e=>{e.person&&(e=>{if(e.person){let{personId:t}=e.person;n[t]?n[t].participantIds.push(e.participantId):n[t]={...e.person,participantIds:[e.participantId]}}})(e)})),{tournamentPersons:Object.values(n)}}function zP(e){var t,i,n,r,a,o,s;let l=2===(null==(i=null==(t=e.participants)?void 0:t.filter((({participantType:e})=>e===ec)))?void 0:i.length),u=1===(null==(n=e.events)?void 0:n.length)&&e.events[0],d=1===(null==(r=null==u?void 0:u.drawDefinitions)?void 0:r.length)&&u.drawDefinitions[0],c=2===(null==(s=null==(o=1===(null==(a=null==d?void 0:d.structures)?void 0:a.length)&&d.structures[0])?void 0:o.positionAssignments)?void 0:s.length);return!!(u.tieFormat&&l&&c)}function YP({tournamentRecord:e}){if(!e)return{error:We};let{drawsAnalysis:t}=SU({tournamentRecord:e}),i={isDual:zP(e),drawsAnalysis:t};return{...Be,analysis:i}}var KP={};function JP(e){var t;if(!e)return{};let i=[],n=e.tieFormatName,r=null==(t=e.collectionDefinitions)?void 0:t.map((e=>{let{matchUpType:t,matchUpFormat:n,matchUpCount:r,category:a,gender:o}=e;i.includes(n)||i.push(n);let s=null==a?void 0:a.ageCategoryCode;return[r,t===Ed?"D":"S",s,n,o].join(";")})).join("|");return{tieFormatName:e&&n||"UNNAMED",matchUpFormats:i,tieFormatDesc:r}}function QP({considerations:e={},descendant:t,ancestor:i}){var n,r;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=JP(t),{matchUpFormats:u,tieFormatDesc:d}=JP(i),c=hr((s??[]).filter((e=>!(u??[]).includes(e))).concat((u??[]).filter((e=>!(s??[]).includes(e))))),p=!(null==e||!e.collectionName||t.collectionDefinitions.map((({collectionName:e})=>e)).join("|")===i.collectionDefinitions.map((({collectionName:e})=>e)).join("|")),m=!(null==e||!e.collectionOrder||t.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")===i.collectionDefinitions.map((({collectionOrder:e})=>e)).join("|")),f=Object.assign({},...((null==t?void 0:t.collectionDefinitions)||[]).map((e=>({[e.collectionId]:e})))),h=Object.assign({},...((null==i?void 0:i.collectionDefinitions)||[]).map((e=>({[e.collectionId]:e}))));a.collectionIds=Rr(Object.keys(f),Object.keys(h)),o.collectionIds=Rr(Object.keys(h),Object.keys(f)),a.collectionsValue=ZP(f),o.collectionsValue=ZP(h),a.groupsCount=(null==(n=null==i?void 0:i.collectionGroups)?void 0:n.length)??(0-((null==(r=null==t?void 0:t.collectionGroups)?void 0:r.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let v=a.collectionsValue.totalValue-o.collectionsValue.totalValue,g=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,I=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,U=o.collectionsValue.assignmentValues.some(((e,t)=>{let i=a.collectionsValue.assignmentValues[t];return!i||e.valueKey!==i.valueKey||e.value!==i.value||!!Array.isArray(e.value)&&e.value.every(((e,t)=>i.value[t]===e))})),y=p||m||d!==l||I||U||0!==v,S=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=S.length&&S;return{matchUpFormatDifferences:c,matchUpCountDifference:g,descendantDifferences:a,ancestorDifferences:o,orderDifference:m,valueDifference:v,nameDifference:p,descendantDesc:l,ancestorDesc:d,...Be,different:y,invalid:w}}function ZP(e){let t=[],i=[],n=0;return{totalValue:Object.keys(e).sort(sh).reduce(((r,a)=>{let o=e[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:u,matchUpValue:d,scoreValue:c,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:d,scoreValue:c,setValue:p},f=Object.keys(m).filter((e=>![void 0,null].includes(m[e])));1!==f.length&&t.push({collectionId:a});let h=f[0];if(h){let e="collectionValueProfiles"===h?Object.values(s):m[h];i.push({valueKey:h,value:e})}return n+=u,s?r+s.reduce(((e,t)=>e+t.value),0):u?mr(d)?r+d*u:mr(c)?r+c*u:mr(p)?r+p*u:r+l:r}),0),totalMatchUps:n,invalidValues:t,assignmentValues:i}}function XP(e){Object.assign(e,{inContext:!0});let{matchUp:t,error:i}=eD(e);return{matchUp:Wo(t,!0,!0),error:i}}function eD({participantsProfile:e,afterRecoveryTimes:t,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:u,drawId:d,event:c}){var p;if(!i)return{error:We};if("string"!=typeof s)return{error:Qt};if(!a||!c){let e=(Rf({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find((e=>e.matchUpId===s));if(!e)return{error:Xt};({eventId:u,drawId:d}=e),({event:c,drawDefinition:a}=hm({tournamentRecord:i,eventId:u,drawId:d}))}if(!a)return{error:Qe};r&&!n&&(n=wm({tournamentRecord:i,contextProfile:r}));let m={surfaceCategory:(null==c?void 0:c.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(null==c?void 0:c.indoorOutdoor)??i.indoorOutdoor,endDate:(null==c?void 0:c.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:u??(null==c?void 0:c.eventId),drawId:d},{participants:f=[]}=Mf({participantsProfile:e,tournamentRecord:i,contextProfile:r,inContext:l});if(o){let e=(Cf({context:l?m:void 0,participants:f,afterRecoveryTimes:t,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,inContext:l,event:c}).matchUps??[]).find((e=>e.matchUpId===s));return e?{drawDefinition:a,structure:null==(p=null==a?void 0:a.structures)?void 0:p.find((t=>t.structureId===e.structureId)),matchUp:e}:{error:Xt}}{let{matchUp:e,structure:i}=OI({context:l?m:void 0,tournamentParticipants:f,afterRecoveryTimes:t,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:s,inContext:l,event:c});return{matchUp:e,structure:i,drawDefinition:a}}}function tD({tournamentRecord:e,drawDefinition:t,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:o,event:s}){var l,u,d,c,p;if(!e)return{error:We};if(!(o||s||i||n))return Sa({result:{error:mi},stack:"getTieFormat"});a&&!s&&(s=null==(l=e.events)?void 0:l.find((e=>e.eventId===a)));let m=XP({tournamentRecord:e,drawDefinition:t,matchUpId:n,drawId:o,event:s});if(n&&null!=m&&m.error)return m;if(!t&&null!=m&&m.drawDefinition&&(t=null==m?void 0:m.drawDefinition),!(r=r??(null==m?void 0:m.structure))&&i&&!n){if(!t)return{error:mt};let e=_u({drawDefinition:t,structureId:i});if(e.error)return e;r=e.structure}let f=((null==r?void 0:r.tieFormat)||(null==r?void 0:r.tieFormatId))&&(null==(u=Um({structure:r,drawDefinition:t,event:s}))?void 0:u.tieFormat),h=((null==t?void 0:t.tieFormat)||(null==t?void 0:t.tieFormatId))&&(null==(d=Um({drawDefinition:t,event:s}))?void 0:d.tieFormat),v=null==(c=Um({event:s}))?void 0:c.tieFormat,g=null==(p=Um({matchUp:null==m?void 0:m.matchUp,drawDefinition:t,structure:r,event:s}))?void 0:p.tieFormat;return{...Be,matchUp:null==m?void 0:m.matchUp,structureDefaultTieFormat:oU(f),eventDefaultTieFormat:oU(v),drawDefaultTieFormat:oU(h),tieFormat:oU(g),structure:r}}be(KP,{compareTieFormats:()=>QP,getTieFormat:()=>tD,tieFormatGenderValidityCheck:()=>qI,validateCollectionDefinition:()=>iU});var iD={};function nD({tournamentRecord:e,outcomes:t}){var i;if(!e)return{error:We};if(null==t||!t.length)return{error:mi,info:"Missing outcomes"};let n=t.reduce(((e,t)=>{let{drawId:i,eventId:n}=t;return n&&i&&(e[n]?e[n].includes(i)||e[n].push(i):e[n]=[i]),e}),{}),r=Object.keys(n);return{publishedEventIds:(null==(i=e.events)?void 0:i.filter((e=>r.includes(e.eventId)))).filter((e=>{let t=lh({event:e}),{drawDetails:i,drawIds:r}=t??{},{eventId:a}=e;return n[a].filter((e=>{let n=i?Object.keys(t.drawDetails).filter((e=>uh({drawId:e,drawDetails:i}))):[];return(null==r?void 0:r.includes(e))||n.includes(e)})).length})).map((e=>e.eventId)),eventIdPublishedDrawIdsMap:n}}function rD({dates:e=[],extension:t}){var i;if(!t)return!1;if("boolean"==typeof t.value&&t.value)return!0;if(!e.length)return!1;let n=Ce(t.value)?null==(i=t.value)?void 0:i.dates:void 0;return Array.isArray(n)?!(null==n||!n.length)&&!!n.filter((t=>!e.length||e.includes(t))).length:void 0}function aD({convertExtensions:e,ignoreDisabled:t,venue:i,court:n}){var r;let a={...Wo(n,e,!0),venueId:i.venueId},{extension:o}=Ds({name:As,element:n});if(t&&o){let e=Ce(o.value)?null==(r=o.value)?void 0:r.dates:void 0,t=!0===(null==o?void 0:o.value)?[]:a.dateAvailability.map((t=>{let i=t.date;if(i&&!e.includes(i))return t})).filter(Boolean);a.dateAvailability=t}return{inContextCourt:a}}function oD(e){let{convertExtensions:t,ignoreDisabled:i,venueIds:n=[],dates:r}=e,a=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},o=[],s=[],l=[],u=[];return Object.keys(a).filter((t=>!e.tournamentId||t===e.tournamentId)).forEach((e=>{let d=a[e];for(let a of d.venues??[])if(!n.length||n.includes(a.venueId)){if(i){let{extension:e}=Ds({name:As,element:a});if(null!=e&&e.value)continue}o.includes(a.venueId)||(u.push(Wo(a,t,!0)),o.push(a.venueId));for(let e of a.courts??[])if(!s.includes(e.courtId)){if(i){let{extension:t}=Ds({name:As,element:e});if(rD({extension:t,dates:r}))continue}let{inContextCourt:n}=aD({convertExtensions:t,ignoreDisabled:i,venue:a,court:e});l.push(n),s.push(e.courtId)}}})),{courts:l,venues:u,...Be}}function sD({tournamentRecords:e,requireCourts:t,dates:i}){return"object"==typeof e&&Object.keys(e).length?Object.keys(e).reduce(((n,r)=>{let a=e[r],{venues:o}=function({convertExtensions:e,tournamentRecord:t,ignoreDisabled:i,dates:n}){if(!t)return{error:qe};let r=Wo(t.venues??[],e).filter((e=>{if(!i)return e;let{extension:t}=Ds({name:As,element:e});return!(null!=t&&t.value)&&e})).filter(Boolean),a=r.reduce(((t,r)=>{let a=((null==r?void 0:r.courts)||[]).filter((e=>{if(!(i||null!=n&&n.length))return e;let{extension:t}=Ds({name:As,element:e});return rD({extension:t,dates:n})})).filter(Boolean).map((t=>{let{inContextCourt:n}=aD({convertExtensions:e,ignoreDisabled:i,venue:r,court:t});return n}));return a.length?t.concat(a):t}),[]);return{venues:r,courts:a}}({tournamentRecord:a,dates:i});return null==o||o.forEach((e=>{let{venueId:i,courts:r}=e;(!t||null!=r&&r.length)&&!n.venueIds.includes(i)&&(n.venues.push(e),n.venueIds.push(i))})),n}),{venues:[],venueIds:[]}):{error:qe}}function lD({tournamentRecord:e,policyDefinitions:t}){if(!e)return{error:We};let i=e.events||[],n=(null==e?void 0:e.participants)||[],{tournamentInfo:r}=qP({tournamentRecord:e}),{venues:a}=oD({tournamentRecord:e});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:i.map((i=>{let{eventId:r}=i,a=GP({event:i}).eventInfo,o=bp({tournamentRecord:e,event:i}).scheduleTiming,s=(i.drawDefinitions||[]).map((a=>{let s=(({drawId:e,drawName:t,matchUpFormat:i,updatedAt:n})=>({matchUpFormat:i,updatedAt:n,drawName:t,drawId:e}))(a),{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}=df({requireParticipants:!0,tournamentParticipants:n,context:{eventId:r},policyDefinitions:t,tournamentRecord:e,inContext:!0,scheduleTiming:o,drawDefinition:a,event:i});return{drawInfo:s,matchUps:{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}}})),l=lh({event:i});return Object.assign(a,{drawsData:s,publish:l}),a}))}}}function uD({publishStatus:e,drawId:t}){var i,n,r;return null!=e&&e.drawDetails?null==(r=null==(n=null==(i=e.drawDetails)?void 0:i[t])?void 0:n.publishingDetail)?void 0:r.published:null==e||!e.drawIds||e.drawIds.includes(t)}function dD(e){var t,i;let{tournamentParticipants:n=[],includePositionAssignments:r,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,status:u=gp,drawDefinition:d,noDeepCopy:c,sortConfig:p,context:m,event:f}=e;if(!d)return{error:Ke};let h,v,g=(({matchUpFormat:e,updatedAt:t,drawType:i,drawName:n,drawId:r})=>({matchUpFormat:e,updatedAt:t,drawName:n,drawType:i,drawId:r}))(d),{allStructuresLinked:I,sourceStructureIds:U,hasDrawFeedProfile:y,structureGroups:S}=Ig({drawDefinition:d});if(!I)return{error:Rt};let w=(null==e?void 0:e.publishStatus)??lh({event:f,status:u}),T=e.eventPublished??!(null==(i=null==(t=dh({event:f}).publishState)?void 0:t.status)||!i.published),P=!1,D=!1,b=S.map((t=>{let i={},u=t.map((e=>{let{structure:t}=_u({drawDefinition:d,structureId:e}),{seedAssignments:i}=Nc({drawDefinition:d,structure:t});return(null==t?void 0:t.stage)===xl&&1===t.stageSequence&&(h=i),(null==t?void 0:t.stage)===Ll&&1===t.stageSequence&&(v=i),t})).sort(((e,t)=>xu(e,t,p))).map((t=>{var r;if(!t)return;let u=null==t?void 0:t.structureId,c=[];t.stage&&[xl,_l,jl].includes(t.stage)&&(c=h),(null==t?void 0:t.stage)===Ll&&(c=v);let{matchUps:p,roundMatchUps:I,roundProfile:S}=Zm({seedAssignments:null!=(r=null==t?void 0:t.seedAssignments)&&r.length?void 0:c,context:{drawId:g.drawId,...m},tournamentParticipants:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,publishStatus:w,drawDefinition:d,inContext:s,structure:t,event:f}),{positionAssignments:T}=Vu({structure:t}),b=null==T?void 0:T.filter($d(Ma)).map((e=>{let{drawPosition:t,participantId:i}=e,{extension:n}=Ds({element:e,name:zs});return D=!0,{participantResult:null==n?void 0:n.value,participantId:i,drawPosition:t}}));if((null==b||!b.length)&&p.length&&e.allParticipantResults){let{subOrderMap:e}=AI({positionAssignments:T}),i=RI({matchUpFormat:t.matchUpFormat,policyDefinitions:a,subOrderMap:e,matchUps:p});b=null==T?void 0:T.filter($d(Ma)).map((e=>{let{drawPosition:t,participantId:n}=e;return D=!0,{participantResult:n&&i.participantResults[n],participantId:n,drawPosition:t}}))}let M=t?(({stageSequence:e,structureName:t,structureType:i,matchUpFormat:n,stage:r})=>({stageSequence:e,structureName:t,structureType:i,matchUpFormat:n,stage:r}))(t):{};M.sourceStructureIds=U[u],M.hasDrawFeedProfile=y[u],M.positionAssignments=T,M.structureActive=p.reduce(((e,t)=>{var i;let n=[hl,fl,gl,Tl,bl,yl,Il,Ul].includes(t.matchUpStatus);return e||n||!!t.winningSide||!(null==(i=t.score)||!i.scoreStringSide1)}),!1);let N=p.reduce(((e,t)=>e&&[ml,hl,Tl,bl,gl,cl].includes(t.matchUpStatus)),!!p.length);return M.structureCompleted=N,i[u]=N,M.structureActive&&(P=!0),{...M,participantResults:b,seedAssignments:c,roundMatchUps:I,roundProfile:S,structureId:u}}));return u.forEach((e=>{var t;r||delete e.positionAssignments,e.sourceStructuresComplete=null==(t=e.sourceStructureIds)?void 0:t.every((e=>i[e]))})),u})).flat();return g.drawActive=P,g.participantPlacements=D,g.drawGenerated=null==b?void 0:b.reduce(((e,t)=>e||!(null==t||!t.roundMatchUps)),!1),g.drawCompleted=null==b?void 0:b.reduce(((e,t)=>e&&t.structureCompleted),!0),g.drawPublished=l?T&&uD({publishStatus:w,drawId:g.drawId}):void 0,{structures:!l||g.drawPublished?c?b:Wo(b,!1,!0):void 0,drawInfo:c?g:Wo(g,!1,!0),...Be}}function cD(e){var t,i;let{includePositionAssignments:n,participantsProfile:r,policyDefinitions:a,usePublishState:o,status:s=gp,sortConfig:l}=e,u=io(e,[{tournamentRecord:!0},{[Za]:{event:!1,eventId:!1}}]);if(u.error)return u;let d=Wo(e.tournamentRecord,!1,!0),c=e.event?void 0:hm({tournamentRecord:d,eventId:e.eventId}).event,p=e.event?Wo(e.event,!1,!0):c&&Wo(c,!1,!0)||void 0;if(!p)return{error:Ct};let{eventId:m}=p,{tournamentId:f,endDate:h}=d,v=lh({event:p,status:s}),g=dh({event:p}).publishState??{},I=!(null==(t=null==g?void 0:g.status)||!t.published),{participants:U}=vh({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:a,...r,tournamentRecord:d}),y=p.drawDefinitions||[],S=!o||I?y.filter((({drawId:e})=>!o||uD({publishStatus:v,drawId:e}))).map((t=>(({drawInfo:e,structures:t})=>({...e,structures:t}))(dD({allParticipantResults:e.allParticipantResults,context:{eventId:m,tournamentId:f,endDate:h},includePositionAssignments:n,tournamentParticipants:U,noDeepCopy:!0,policyDefinitions:a,tournamentRecord:d,usePublishState:o,drawDefinition:t,publishStatus:v,sortConfig:l,event:p})))).map((({structures:e,...t})=>{let i=null==e?void 0:e.filter((({stage:e,structureId:i})=>(({structureId:e,drawId:t})=>{var i,n,r;if(!o)return!0;let a=null==(n=null==(i=null==v?void 0:v.drawDetails)?void 0:i[t])?void 0:n.structureDetails;return!a||!Object.keys(a).length||(null==(r=a[e])?void 0:r.published)})({structureId:i,drawId:t.drawId})&&(({stage:e,drawId:t})=>{var i,n,r;if(!o)return!0;let a=null==(n=null==(i=null==v?void 0:v.drawDetails)?void 0:i[t])?void 0:n.stageDetails;return!a||!Object.keys(a).length||(null==(r=a[e])?void 0:r.published)})({stage:e,drawId:t.drawId}))).map((e=>(({drawId:e,structure:t})=>{var i,n,r,a;if(!o)return t;let s=null==(a=null==(r=null==(n=null==(i=null==v?void 0:v.drawDetails)?void 0:i[e])?void 0:n.structureDetails)?void 0:r[t.structureId])?void 0:a.roundLimit;if(mr(s)){let e=br(1,s+1),i={},n={};for(let r of e)t.roundMatchUps[r]&&(i[r]=t.roundMatchUps[r],n[r]=t.roundProfile[r]);t.roundMatchUps=i,t.roundProfile=n}return t})({drawId:t.drawId,structure:e})));return{...t,structures:i}})).filter((e=>{var t;return null==(t=e.structures)?void 0:t.length})):void 0,{tournamentInfo:w}=qP({tournamentRecord:d}),T={tournamentInfo:w,venuesData:(d.venues||[]).map((e=>(({venueData:e})=>({...e}))(mm({tournamentRecord:d,venueId:e.venueId})))),eventInfo:(({eventId:e,eventName:t,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:l,endDate:u,ballType:d,discipline:c})=>({eventId:e,eventName:t,eventType:i,eventLevel:n,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:l,endDate:u,ballType:d,discipline:c}))(p),drawsData:S};return T.eventInfo.publishState=g,T.eventInfo.published=null==(i=null==g?void 0:g.status)?void 0:i.published,{...Be,eventData:T,participants:U}}be(iD,{bulkUpdatePublishedEventIds:()=>nD,getAllEventData:()=>lD,getCourtInfo:()=>pm,getDrawData:()=>dD,getEventData:()=>cD,getEventPublishStatus:()=>lh,getPublishState:()=>dh,getVenueData:()=>mm});var pD={};function mD({defaultRecoveryMinutes:e=0,defaultAverageMinutes:t,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!JI({matchUpFormat:n}))return{error:$t};let u;return Object.keys(i).filter((e=>!o||e===o)).forEach((e=>{var t;if(u)return;let o=i[e],d=l?null==(t=hm({tournamentRecord:o,eventId:l}))?void 0:t.event:void 0;return u=Hp({tournamentRecord:o,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:d}),(null==u?void 0:u.averageMinutes)||(null==u?void 0:u.recoveryMinutes)})),{recoveryMinutes:(null==u?void 0:u.recoveryMinutes)||e,averageMinutes:(null==u?void 0:u.averageMinutes)||t,typeChangeRecoveryMinutes:(null==u?void 0:u.typeChangeRecoveryMinutes)||(null==u?void 0:u.recoveryMinutes)||e}}function fD({scheduleCompletedMatchUps:e,containedStructureIds:t,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:a}){if("object"!=typeof i)return{error:qe};if(!Array.isArray(a))return{error:mi,info:Tv("rounds")};let o={},s=[];a.sort(((e,t)=>(e.sortOrder??0)-(t.sortOrder??0))),t=t??Object.assign({},...Object.values(i).map((e=>Nd({tournamentRecord:e}).containedStructures))),r||({matchUps:r}=Af({nextMatchUps:!0,tournamentRecords:i}));let l=0,u={},d={},c={};return{scheduledRoundsDetails:a.flatMap((a=>{var p;let m=a.periodLength||n,f=[];null!=t&&t[a.structureId]?f.push(...t[a.structureId]):f.push(a.structureId);let h=r?qm({tournamentIds:[a.tournamentId],roundNumbers:[a.roundNumber],matchUpIds:a.matchUpIds,eventIds:[a.eventId],drawIds:[a.drawId],processContext:!0,structureIds:f,matchUps:r}).sort(Ef):[],{segmentNumber:v,segmentsCount:g}=a.roundSegment||{};if(mr(v)&&ar(null==h?void 0:h.length)&&ar(g)&&v>0&&v<=g&&g<(null==h?void 0:h.length)&&(null==(p=a.matchUpIds)||!p.length)){let e=h.length/g,t=e*(v-1);h=h.slice(t,t+e)}let I=i[a.tournamentId],U=hm({drawId:a.drawId,tournamentRecord:I}).event,y=[];for(let e of h){let t=e.matchUpFormat;t&&(o[t]||(o[t]=[],o[t].push(e)),y.push(t))}for(let t of y){let{eventType:n,category:r}=U??{},{categoryName:o,ageCategoryCode:p}=r??{},{typeChangeRecoveryMinutes:f,recoveryMinutes:v,averageMinutes:g,error:I}=mD({categoryName:o??p,categoryType:null==r?void 0:r.categoryType,tournamentId:a.tournamentId,eventId:a.eventId,tournamentRecords:i,matchUpFormat:t,eventType:n});if(I)return{error:I,round:a};let y=h.filter((t=>(e||!Cl.includes(t.matchUpStatus))&&t.matchUpStatus!==ml)).map(ll);return y.forEach((e=>{c[e]={typeChangeRecoveryMinutes:f,recoveryMinutes:v,averageMinutes:g},u[e]=v,d[e]=g})),s.push(...y),l=Math.max(g||0,l),{roundPeriodLength:m,recoveryMinutes:v,averageMinutes:g,matchUpIds:y,hash:`${g}|${m}`}}})),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:u,averageMinutesMap:d,orderedMatchUpIds:s,minutesMap:c,...Be}}function hD({schedulingProfile:e,venueIds:t,eventIds:i,drawIds:n}){let r=[];return{updatedSchedulingProfile:null==e?void 0:e.map((e=>{let a=Co(null==e?void 0:e.scheduleDate);if(!a)return void r.push(`Invalid date: ${null==e?void 0:e.scheduledDate}`);let o=((null==e?void 0:e.venues)||[]).map((e=>{let{rounds:a,venueId:o}=e;if(null==t||!t.includes(o))return void r.push(`Missing venueId: ${o}`);let s=a.filter((e=>{let t=i.includes(e.eventId)&&n.includes(e.drawId);return t||r.push(`Invalid eventId: ${e.eventId} or drawId: ${e.drawId}`),t}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...e,venues:o}})).filter(Boolean),modifications:r.length,issues:r}}function vD({tournamentRecords:e,schedulingProfile:t}){if(!t)return{valid:!0};if(!Array.isArray(t))return{valid:!1,error:Fn};let i,n,{venueIds:r,tournamentsMap:a}=function(e){let t=(null==e?void 0:e.tournamentRecords)&&Object.values(null==e?void 0:e.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=t.reduce(((e,t)=>{let{tournamentIds:n,tournamentMap:r,structureIds:a,venueIds:o,eventIds:s,drawIds:l}=function(e){let{tournamentRecord:t={},tournamentMap:i={},requireCourts:n}=e,r=[],a=[],o=[],s=[],l=((null==t?void 0:t.venues)||[]).map((({venueId:e,courts:t})=>(!n||(null==t?void 0:t.length))&&e)),u=null==t?void 0:t.tournamentId;return u&&(r.push(u),i[u]={},((null==t?void 0:t.events)||[]).forEach((e=>{let t=e.eventId;o.push(t),i[u][t]={},(e.drawDefinitions||[]).forEach((e=>{let n=e.drawId;s.push(n),i[u][t][n]={};let{structures:r}=Bu({drawDefinition:e});(r||[]).forEach((e=>{var r;let o=e.structureId,{matchUps:s}=Zm({structure:e}),{roundMatchUps:l}=jd({matchUps:s}),d=l&&Object.keys(l).map((e=>parseInt(e)));i[u][t][n][o]=d,a.push(o),null!=(r=e.structures)&&r.length&&e.structures.forEach((e=>{a.push(e.structureId),i[u][t][n][e.structureId]=d}))}))}))}))),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}({tournamentRecord:t});return o.forEach((t=>{e.venueIds.includes(t)||e.venueIds.push(t)})),e.tournamentIds.push(...n),e.structureIds.push(...a),e.eventIds.push(...s),e.drawIds.push(...l),Object.assign(i,r),e}),{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:n,eventIds:r,drawIds:a}}({tournamentRecords:e}),o=t.every((e=>{let{scheduleDate:t,venues:o}=e;return!!yo(t)&&o.every((e=>{let{venueId:t,rounds:o}=e;return"string"!=typeof t?(n="venueId should be a string",!1):Array.isArray(o)?r.includes(t)?!!o.every((e=>{var t,i,r,o;if(!e)return n="empty round",!1;let{roundSegment:s,tournamentId:l,structureId:u,roundNumber:d,eventId:c,drawId:p}=e,m=null==(o=null==(r=null==(i=null==(t=null==a?void 0:a[l])?void 0:t[c])?void 0:i[p])?void 0:r[u])?void 0:o.includes(d);m||(n="Invalid rounds");let{segmentNumber:f,segmentsCount:h}=s||{},v=!s||mr(f)&&ar(h)&&f<=h;return v||(n="Invalid segment"),m&&v})):(i=pn,!1):(n="rounds should be an array",!1)}))}));return!o&&!i&&(i=Fn),{valid:!!o,error:i,info:n}}function gD({tournamentRecords:e,tournamentRecord:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:qe};let{extension:i}=Ds({element:t,name:Ws,tournamentRecords:e,discover:!0}),n=(null==i?void 0:i.value)||[];if(n.length){let{venueIds:i}=sD({requireCourts:!0,tournamentRecords:e}),{eventIds:r,drawIds:a}=sU({tournamentRecords:e}),{updatedSchedulingProfile:o,modifications:s,issues:l}=hD({schedulingProfile:n,venueIds:i,eventIds:r,drawIds:a});if(s){n=o;let i=ID({tournamentRecords:e,tournamentRecord:t,schedulingProfile:n});return i.error?i:{schedulingProfile:n,modifications:s,issues:l}}}return{schedulingProfile:n,modifications:0}}function ID({tournamentRecords:e,tournamentRecord:t,schedulingProfile:i}){let n=vD({tournamentRecords:e,schedulingProfile:i});return n.error?n:i?fs({tournamentRecords:e,discover:!0,extension:{name:Ws,value:i}}):ps({element:t,name:Ws,tournamentRecords:e,discover:!0})}function UD(e){let{tournamentRecord:t}=e,i=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!e.schedulingProfile){let{modifications:e,issues:n}=gD({tournamentRecords:i,tournamentRecord:t});return{success:!e,modifications:e,issues:n}}let{venueIds:n}=sD({tournamentRecords:i}),{eventIds:r,drawIds:a}=sU({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=hD({schedulingProfile:e.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return s?{...ID({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...Be,modifications:s,issues:l}}function yD(e){let{scheduleDates:t=[],tournamentRecords:i,periodLength:n=30}=e??{};if("object"!=typeof i)return{error:He};if(!Array.isArray(t))return{error:Fn};if(!t.every(yo))return{error:Ui};let r=[],a=0,o={},{schedulingProfile:s}=gD({tournamentRecords:i});if(!s)return{issues:r,...Be};let{matchUps:l}=Af({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:e,venues:s=[]}=u;if(null==t||!t.length||t.includes(e))for(let t of s||[])if(t){let{rounds:s}=t,u=[],{orderedMatchUpIds:d,scheduledRoundsDetails:c}=fD({tournamentRecords:i,periodLength:n,matchUps:l,rounds:s}),{matchUpDependencies:p}=Of({tournamentRecords:i,matchUps:l}),m=e=>{let t;return null==c||c.find(((i,n)=>{let r=i.matchUpIds.includes(e);return r&&(t=n),r})),t};if(null==d||d.forEach(((e,t)=>{var i;let n=Nr(d.slice(t+1),(null==(i=null==p?void 0:p[e])?void 0:i.matchUpIds)||[]);n.length&&u.push({matchUpId:e,shouldBeAfter:n})})),u.length){a+=u.length;let t=u.map((({matchUpId:t,shouldBeAfter:i})=>{let n=m(t),r=hr(i.map(m));return o[e]||(o[e]={}),o[e][n]||(o[e][n]=[]),r.forEach((t=>{o[e][n].includes(t)||o[e][n].push(t)})),{matchUpId:t,matchUpRoundIndex:n,earlierRoundIndices:r,shouldBeAfter:i}}));r.push(...t)}}}return{issuesCount:a,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...r.map((e=>{let{matchUpId:t,shouldBeAfter:i,earlierRoundIndices:n}=e;return{[t]:{earlierRoundIndices:n,shouldBeAfter:i}}})))},roundIndexShouldBeAfter:o,...Be}}function SD(e){let{tournamentRecords:t,requestType:i}=e,n=io(e,[{[wa]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(t)){let{extension:e}=Ds({element:a,name:Vs}),t=(null==e?void 0:e.value)||[];for(let n of t){let{personId:e,requests:t}=n||{};r[e]||(r[e]=[]);for(let n of t)i&&n.requestType!==i||r[e].push(n)}}return{personRequests:r,...Be}}function wD(e){let{containerStructureId:t,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:o,eventId:s,drawId:l}=e,u=n?t:o,d=[r,s,l,u,a].join("|");return ya({structureId:u,roundSegment:i,tournamentId:r,roundNumber:a,eventId:s,drawId:l,id:d})}function TD({round:e,matchUps:t,events:i,tournamentRecords:n}){let r=i.find((t=>t.eventId===e.eventId)),{eventType:a,category:o,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:u}=o||{},d=Ur(t.map((({matchUpFormat:e})=>e))),c=0;return Object.keys(d).forEach((t=>{let i=d[t],r=mD({categoryName:l||u,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:n,matchUpFormat:t,categoryType:s,eventType:a});if(r.error)return r;let o=r.averageMinutes*i;isNaN(c)||(c+=o)})),{roundMinutes:c}}function PD(e){let t=e.length,i=e.filter((({sides:e})=>null==e?void 0:e.some((({bye:e})=>e)))).length||0,n=e.filter((({winningSide:e,matchUpStatus:t})=>e||Cl.includes(t))).length||0,r=e.filter((({schedule:e,matchUpStatus:t})=>(null==e?void 0:e.scheduledDate)&&(null==e?void 0:e.scheduledTime)&&t!==ml)).length||0,a=t-i;return{unscheduledCount:a-r,incompleteCount:a-r,scheduledCount:r,completedCount:n,matchUpsCount:t,isScheduled:a===r,isComplete:a===n,byeCount:i}}function DD({tournamentRecords:e,schedulingProfile:t,tournamentRecord:i,withRoundId:n}){if(i&&!e){if("object"!=typeof i)return{error:He};e={[i.tournamentId]:i}}if(t){let i=vD({tournamentRecords:e,schedulingProfile:t});if(i.error)return i}if(!t&&e){let i=gD({tournamentRecords:e});if(i.error)return i;t=i.schedulingProfile}if(!t)return{error:Vn};let r={};return{profileRounds:t.map((({venues:e,scheduleDate:t})=>e.map((({rounds:e})=>e.map((e=>{var i;let a=wD(e);return null!=(i=a.roundSegment)&&i.segmentsCount&&(r[a.id]=a.roundSegment.segmentsCount),ya({id:n?a.id:void 0,scheduleDate:t,...a})})))))).flat(1/0),segmentedRounds:r}}be(pD,{getPersonRequests:()=>SD,getProfileRounds:()=>DD,getScheduledRoundsDetails:()=>fD,getSchedulingProfile:()=>gD,getSchedulingProfileIssues:()=>yD});var bD={};function MD({policyDefinitions:e,drawDefinition:t,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:Et};let{entries:o,stageEntries:s}=Vh({drawDefinition:t,drawId:n,stage:a,event:r}),l=s.length,{drawSize:u}=Wy({participantsCount:l}),d=Hy({drawSize:i??u,participantsCount:l,policyDefinitions:e});if(d.error)return Sa({result:d,stack:"getEntriesAndSeedsCount"});let{seedsCount:c}=d;return{entries:o,seedsCount:c,stageEntries:s}}function ND(e){let{entries:t=[],entryStatus:i,stage:n}=e;return Math.max(...t.filter((e=>!(n&&n!==e.entryStage||i&&e.entryStatus!==i||isNaN(e.entryPosition)))).map((({entryPosition:e})=>rr(e||0))),0)}be(bD,{getEntriesAndSeedsCount:()=>MD,getMaxEntryPosition:()=>ND});var RD={};function AD({tournamentRecords:e,extensionName:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:qe};let i,n=[];for(let r of Object.values(e)){let{extension:e}=Ds({element:r,name:t});e&&!i&&(n.push({params:{extension:e,discover:!0},method:"addExtension"}),i=!0);let a=r.events??[];for(let i of a){let{eventId:e}=i,{extension:r}=Ds({name:t,element:i});r&&n.push({params:{eventId:e,extension:r},method:"addEventExtension"})}}return{methods:n}}function ED({tournamentRecords:e}){return AD({extensionName:qs,tournamentRecords:e})}be(RD,{allCompetitionMatchUps:()=>Af,allDrawMatchUps:()=>Cf,allEventMatchUps:()=>Nf,allTournamentMatchUps:()=>Rf,analyzeMatchUp:()=>sb,calculateWinCriteria:()=>ZD,checkMatchUpIsComplete:()=>Xm,competitionScheduleMatchUps:()=>zD,drawMatchUps:()=>lb,eventMatchUps:()=>qD,getAllDrawMatchUps:()=>uf,getAllStructureMatchUps:()=>Zm,getCheckedInParticipantIds:()=>yp,getCompetitionMatchUps:()=>HD,getEventMatchUpFormatTiming:()=>LD,getMatchUpCompetitiveProfile:()=>qc,getMatchUpContextIds:()=>XD,getMatchUpDailyLimits:()=>YD,getMatchUpDailyLimitsUpdate:()=>BD,getMatchUpDependencies:()=>Of,getMatchUpFormat:()=>ib,getMatchUpFormatTiming:()=>Hp,getMatchUpFormatTimingUpdate:()=>ED,getMatchUpScheduleDetails:()=>vm,getMatchUpType:()=>Em,getMatchUpsStats:()=>nb,getModifiedMatchUpFormatTiming:()=>_D,getParticipantResults:()=>hI,getPredictiveAccuracy:()=>KD,getRoundMatchUps:()=>jd,getRounds:()=>ob,isValidMatchUpFormat:()=>JI,matchUpActions:()=>_y,participantScheduledMatchUps:()=>VD,tallyParticipantResults:()=>RI,tournamentMatchUps:()=>WD,validMatchUp:()=>_d,validMatchUps:()=>Bd});var CD="ADULT",OD="JUNIOR",kD="WHEELCHAIR",FD={[is]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Cd]:30,default:60}}]},defaultDailyLimits:{[Ad]:2,[Cd]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[oI],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[kD],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[CD,kD],minutes:{default:60,[Cd]:30}},{categoryTypes:[OD],minutes:{default:60,[Cd]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[CD,kD],minutes:{default:30}},{categoryTypes:[OD],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[CD,OD],minutes:{default:30}},{categoryTypes:[kD],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},xD=FD;function LD({tournamentRecord:e,matchUpFormats:t,categoryType:i,event:n}){if(!n)return{error:Et};let r,a=[];if(null!=t&&t.length){let e=[];a=t.map((t=>{let i="string"==typeof t?{matchUpFormat:t}:t;if(!e.includes(null==i?void 0:i.matchUpFormat)&&JI({matchUpFormat:null==i?void 0:i.matchUpFormat}))return e.push(i.matchUpFormat),i})).filter(Boolean)}else{let{policy:t}=Gc({policyType:rs,tournamentRecord:e,event:n});if(null!=t&&t.matchUpFormats)a=null==t?void 0:t.matchUpFormats;else{let e,t,{extension:i}=Ds({name:qs,element:n});null!=i&&i.value?({matchUpAverageTimes:e,matchUpRecoveryTimes:t}=i.value):({matchUpAverageTimes:e,matchUpRecoveryTimes:t}=xD[is]),a=hr([...(e||[]).map((e=>e.matchUpFormatCodes)),...(t||[]).map((e=>e.matchUpFormatCodes))].flat()).map((e=>({matchUpFormat:e}))),r="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=n,u=(null==l?void 0:l.categoryName)??(null==l?void 0:l.ageCategoryCode)??s;return s?ya({eventMatchUpFormatTiming:a.map((({matchUpFormat:t,description:r})=>({matchUpFormat:t,description:r,...Hp({tournamentRecord:e,matchUpFormat:t,categoryName:u,categoryType:i,eventType:o,event:n})}))),info:r}):{error:Et}}function _D(e){let t=io(e,[{[Pa]:!0},{[Ya]:e=>JI({matchUpFormat:e}),[Ja]:$t,[ba]:!0}]);if(t.error)return t;let{tournamentRecord:i,matchUpFormat:n,event:r}=e,{extension:a}=Ds({name:qs,element:r}),o=null==a?void 0:a.value,{extension:s}=Ds({element:i,name:qs}),l=null==s?void 0:s.value,u=[(null==o?void 0:o.matchUpAverageTimes)&&Tp({...o,matchUpFormat:n}),(null==l?void 0:l.matchUpAverageTimes)&&Tp({...l,matchUpFormat:n})].find((e=>e));return{matchUpFormat:n,recoveryTimes:[(null==o?void 0:o.matchUpRecoveryTimes)&&Pp({...o,matchUpFormat:n}),(null==l?void 0:l.matchUpRecoveryTimes)&&Pp({...l,matchUpFormat:n})].find((e=>e)),averageTimes:u}}function BD({tournamentRecords:e}){return AD({extensionName:$s,tournamentRecords:e})}var jD=({scheduleAttributes:e=["scheduledDate","scheduledTime"],schedule:t={}})=>!!Object.keys(t).filter((t=>e.includes(t))).filter((e=>t[e])).length;function VD({scheduleAttributes:e=["scheduledDate","scheduledTime"],matchUps:t=[]}){if(!Bd(t))return{error:ei};if(!Array.isArray(e))return{error:Fn};let i=t.filter(Boolean).filter((({schedule:t})=>jD({schedule:t,scheduleAttributes:e}))).reduce(((e,t)=>{let{schedule:i}=t,n=Co(null==i?void 0:i.scheduledDate),r=Eo(null==i?void 0:i.scheduledTime);return n&&r&&(e[n]?e[n].push(t):e[n]=[t]),e}),{});return Object.keys(i).forEach((e=>{i[e].sort(((e,t)=>{var i,n;return xo(Eo(null==(i=e.schedule)?void 0:i.scheduledTime),Eo(null==(n=t.schedule)?void 0:n.scheduledTime))}))})),{...Be,scheduledMatchUps:i}}function GD({schedulingProfile:e,matchUps:t=[]}){let i={},n=({eventId:e,drawId:t,structureId:i,roundNumber:n})=>`${e}|${t}|${i}${n}`;null!=e&&e.length&&e.map((({venues:e})=>e.map((({rounds:e})=>e)))).flat().forEach((e=>{e.sort(((e,t)=>(e.sortOrder||0)-(t.sortOrder||0))).forEach((({eventId:e,drawId:t,structureId:r,roundNumber:a},o)=>{let s=n({eventId:e,drawId:t,structureId:r,roundNumber:a});i[s]=o}))}));let r=[],a={noScheduledDate:[]};for(let s of t){let e=s.schedule||{},t=e.scheduledDate&&Co(e.scheduledDate)||e.scheduledTime&&Co(e.scheduledTime)||"noScheduledDate";a[t]||(a[t]=[]),a[t].push(s)}let o=Object.keys(a).sort();for(let s of o){let e=a[s],t={noScheduledTime:[]};for(let i of e){let e=i.schedule||{},n=e.scheduledTime&&Eo(e.scheduledTime)||"noScheduledTime";t[n]||(t[n]=[]),t[n].push(i)}let o=Object.keys(t).sort();for(let a of o){let e=t[a];e.sort(((e,t)=>(i[n(e)]||0)-(i[n(t)]||0))),r.push(...e)}}return r}function $D({courtPrefix:e="C|",minRowsCount:t,courtsData:i}){if(!Array.isArray(i))return{error:Fn};let n=null==i?void 0:i.reduce(((e,t)=>{let i=t.matchUps||[],n=Math.max(0,...i.map((e=>e.schedule.courtOrder||0)));return n>e?n:e}),1),r=br(0,t?Math.max(t,n):n).map((e=>({matchUps:br(0,i.length).map((t=>{let n=i[t],{courtId:r,venueId:a}=n;return{schedule:{courtOrder:e+1,venueId:a,courtId:r}}}))})));return i.forEach(((e,t)=>{var i;for(let n of e.matchUps){let e=null==(i=n.schedule)?void 0:i.courtOrder;e&&(r[e-1].matchUps[t]=n)}})),{courtPrefix:e,rows:r.map(((t,i)=>Object.assign({rowId:`rowId-${i+1}`},...t.matchUps.map(((t,i)=>({[`${e}${i}`]:t}))))))}}function qD(e){let{participants:t,contextContent:i,participantMap:n}=e,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:u,tournamentRecord:d,usePublishState:c,contextFilters:p,matchUpFilters:m,contextProfile:f,nextMatchUps:h,tournamentId:v,inContext:g,context:I,event:U}=e;if(!U)return{error:Et};let y,{eventId:S,eventName:w,endDate:T,eventType:P,category:D,gender:b}=U??{},M={...I,...ya({surfaceCategory:U.surfaceCategory??(null==d?void 0:d.surfaceCategory),indoorOutDoor:U.indoorOutdoor??(null==d?void 0:d.indoorOutdoor),tournamentId:v??(null==d?void 0:d.tournamentId),endDate:T??(null==d?void 0:d.endDate),eventName:w,eventType:P,category:D,eventId:S,gender:b})};!t&&d&&({participants:t,participantMap:n,groupInfo:y}=Mf({participantsProfile:o,policyDefinitions:l,useParticipantMap:u,tournamentRecord:d,contextProfile:f,inContext:g})),f&&!i&&(i=wm({policyDefinitions:l,tournamentRecord:d,contextProfile:f,event:U}));let N=lh({event:U});return{...(U.drawDefinitions??[]).reduce(((e,u)=>{var v;let I=df({context:M,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:t,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:d,usePublishState:c,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:n,publishStatus:N,contextProfile:f,drawDefinition:u,nextMatchUps:h,inContext:g,event:U});return null==(v=Object.keys(I))||v.forEach((t=>{Array.isArray(I[t])&&(e[t]||(e[t]=[]),e[t]=e[t].concat(I[t]))})),e}),{}),...Be,groupInfo:y}}function WD(e){if(null==e||!e.tournamentRecord)return{error:We};let t=e.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:u,contextFilters:d,matchUpFilters:c,contextProfile:p,nextMatchUps:m,context:f}=e,h=e.tournamentId??s.tournamentId,v=(null==s?void 0:s.events)??[],{participants:g,participantMap:I,groupInfo:U}=Mf({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!t&&(t=wm({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:y}=jc({tournamentRecord:s}),S=(null==d?void 0:d.eventIds)??[];return{...v.filter((e=>!S.includes(e.eventId))).map((e=>{var o,v,U;return qD({context:{eventDrawsCount:(null==(v=null==(o=fm({event:e}).flightProfile)?void 0:o.flights)?void 0:v.length)||(null==(U=e.drawDefinitions)?void 0:U.length)||0,...f},tournamentAppliedPolicies:y,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:u,contextFilters:d,contextProfile:p,contextContent:t,matchUpFilters:c,participantMap:I,participants:g,tournamentId:h,nextMatchUps:m,inContext:l,event:e})})).reduce(((e,t)=>{var i;return null==(i=t&&Object.keys(t).filter((e=>!["success","matchUpsMap"].includes(e))))||i.forEach((i=>{Array.isArray(t[i])&&(e[i]||(e[i]=[]),e[i]=e[i].concat(t[i]),e.matchUpsCount+=t[i].length)})),e}),{matchUpsCount:0}),groupInfo:U}}function HD({scheduleVisibilityFilters:e,participantsProfile:t,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if("object"!=typeof i||!Object.keys(i).length)return{error:qe};let u=Object.keys(i).map((u=>{let d=i[u];return WD({scheduleVisibilityFilters:e,participantsProfile:t,policyDefinitions:n,tournamentRecord:d,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})})),d={};return{...u.reduce(((e,t)=>(Object.keys(t).forEach((i=>{Array.isArray(t[i])&&(e[i]||(e[i]=[]),e[i]=e[i].concat(t[i])),"groupInfo"===i&&Object.assign(d,t[i])})),e)),{}),groupInfo:d}}function zD(e){var t,i,n,r,a,o,s,l;if("object"!=typeof(null==e?void 0:e.tournamentRecords)||!Object.keys(null==e?void 0:e.tournamentRecords).length)return{error:qe};let u,d,{courts:c,venues:p}=oD(e),m=gD(e).schedulingProfile,{sortDateMatchUps:f=!0,courtCompletedMatchUps:h,alwaysReturnCompleted:v,activeTournamentId:g,tournamentRecords:I,withCourtGridRows:U,minCourtGridRows:y,usePublishState:S,status:w=gp,sortCourtsData:T}=e,P=S?null==(i=null==(t=Uf({tournamentRecord:I[g??ua()],itemType:`${vp}.${Ip}`}).timeItem)?void 0:t.itemValue)?void 0:i[w]:void 0,D=v?HD({...e,matchUpFilters:{...e.matchUpFilters,matchUpStatuses:[hl]},contextFilters:e.contextFilters}).completedMatchUps:[];if(S&&(!P||!Object.keys(P).length))return{completedMatchUps:D,dateMatchUps:[],courtsData:[],venues:p};S&&({drawIds:u,detailsMap:d}=function({tournamentRecords:e}){var t;let i=[],n={};for(let r of Object.values(e))for(let e of r.events??[]){let r=lh({event:e}),a=null==r?void 0:r.drawDetails;Ce(a)?(Object.assign(n,a),i.push(...Object.keys(a).filter((e=>uh({drawId:e,drawDetails:a}))))):null!=(t=null==r?void 0:r.drawIds)&&t.length&&i.push(...r.drawIds)}return{drawIds:i,detailsMap:n}}({tournamentRecords:I})),null!=u&&u.length&&(e.contextFilters||(e.contextFilters={}),null!=(n=e.contextFilters)&&n.drawIds?e.contextFilters.drawIds=e.contextFilters.drawIds.filter((e=>u.includes(e))):e.contextFilters.drawIds=u),null!=(r=null==P?void 0:P.eventIds)&&r.length&&(e.matchUpFilters||(e.matchUpFilters={}),null!=(a=e.matchUpFilters)&&a.eventIds&&e.matchUpFilters.eventIds.length?e.matchUpFilters.eventIds=e.matchUpFilters.eventIds.filter((e=>P.eventIds.includes(e))):e.matchUpFilters.eventIds=P.eventIds),null!=(o=null==P?void 0:P.scheduledDates)&&o.length&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters.scheduledDates&&e.matchUpFilters.scheduledDates.length?e.matchUpFilters.scheduledDates=e.matchUpFilters.scheduledDates.filter((e=>P.scheduledDates.includes(e))):e.matchUpFilters.scheduledDates=P.scheduledDates),v&&(e.matchUpFilters||(e.matchUpFilters={}),null!=(l=null==(s=e.matchUpFilters)?void 0:s.excludeMatchUpStatuses)&&l.length?e.matchUpFilters.excludeMatchUpStatuses.includes(hl)||e.matchUpFilters.excludeMatchUpStatuses.push(hl):e.matchUpFilters.excludeMatchUpStatuses=[hl]);let{completedMatchUps:b,upcomingMatchUps:M,pendingMatchUps:N,groupInfo:R}=HD({...e,matchUpFilters:e.matchUpFilters,contextFilters:e.contextFilters}),A=[...M??[],...N??[]];d&&Object.keys(d).length&&(A=A.filter((e=>{let{drawId:t,structureId:i,stage:n}=e;if(!d[t])return!1;if(d[t].stageDetails){let e=Object.keys(d[t].stageDetails),i=e.filter((e=>!d[t].stageDetails[e].published)),r=e.filter((e=>d[t].stageDetails[e].published));return(!i.length||!i.includes(n))&&(!(!r.length||!r.includes(n))||i.length&&!i.includes(n)&&!r.length)}if(d[t].structureDetails){let e=Object.keys(d[t].structureDetails),n=e.filter((e=>!d[t].structureDetails[e].published)),r=e.filter((e=>d[t].structureDetails[e].published));return(!n.length||!n.includes(i))&&(!(!r.length||!r.includes(i))||n.length&&!n.includes(i)&&!r.length)}return!0})));let E=f?GD({matchUps:A,schedulingProfile:m}):A,C=null==c?void 0:c.map((e=>{let t=function({courtId:e}){let t=(h?E.concat(b??[]):E).filter((t=>{var i,n,r;return(null==(i=t.schedule)?void 0:i.courtId)===e||(null==(r=null==(n=t.schedule)?void 0:n.allocatedCourts)?void 0:r.map((({courtId:e})=>e)).includes(e))}));return T?GD({matchUps:t,schedulingProfile:m}):t}(e);return{surfaceCategory:(null==e?void 0:e.surfaceCategory)??"",matchUps:t,...e}})),O={completedMatchUps:v?D:b,dateMatchUps:E,courtsData:C,groupInfo:R,venues:p};if(U){let{rows:e,courtPrefix:t}=$D({minRowsCount:y,courtsData:C});O.courtPrefix=t,O.rows=e}return{...O,...Be}}function YD({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:qe};let i;return Object.keys(e).filter((e=>!t||e===t)).forEach((t=>{let n=e[t],{matchUpDailyLimits:r}=function(e){var t;let i=io(e,[{[Pa]:!0}]);if(i.error)return i;let{tournamentRecord:n}=e,{policy:r}=Gc({policyType:is,tournamentRecord:n}),{extension:a}=Ds({element:n,name:$s}),o=null==(t=null==a?void 0:a.value)?void 0:t.dailyLimits,s=null==r?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:o||s}}({tournamentRecord:n});i=r})),{matchUpDailyLimits:i}}function KD(e){var t,i,n,r;let{matchUps:a}=e,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:u,exclusionRule:d,zoneDoubling:c,matchUpType:p,scaleName:m,eventId:f,zonePct:h,drawId:v,event:g}=e;if(!s&&!a)return{error:We};if(p&&![Ad,Cd].includes(p))return{error:Fn,info:{matchUpType:p}};if(a&&!Bd(a))return{error:Fn,context:{matchUps:a}};let I=cS[m],U=(null==I?void 0:I.ascending)??e.ascending??!1,y=(null==I?void 0:I.accessor)??e.valueAccessor,S=Array.isArray(null==I?void 0:I.range)?Math.abs(I.range[0]-I.range[1]):0,w=mr(h)&&S?(h??0)*S:e.zoneMargin??S,T={withScaleValues:!0,withCompetitiveness:!0},P={matchUpTypes:p?[p]:[Ad,Cd]},D=null==s?void 0:s.participants;null!=(t=null==a?void 0:a[0])&&t.hasContext?v?a=a.filter((e=>e.drawId===v)):f&&(a=a.filter((e=>e.eventId===f))):void 0===a&&(a=v&&!l&&[]||!v&&f&&!g&&[]||v&&(null==(i=Cf({inContext:!0,drawDefinition:l,contextFilters:P,contextProfile:T,participants:D}))?void 0:i.matchUps)||!v&&f&&(null==(n=Nf({inContext:!0,contextFilters:P,contextProfile:T,participants:D,event:g}))?void 0:n.matchUps)||(null==(r=Rf({tournamentRecord:s,contextFilters:P,contextProfile:T}))?void 0:r.matchUps)||[]),p&&(a=a.filter((e=>e.matchUpType===p)));let b=a.filter((({winningSide:e,score:t,sides:i,matchUpStatus:n})=>![Tl,gl,bl,vl,cl].includes(n??"")&&kf({score:t})&&2===(null==i?void 0:i.length)&&e)),M=function({excludeMargin:e,exclusionRule:t,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a){let{matchUpType:a,sides:s,score:l,winningSide:d}=u;if(!d)continue;if(t&&(!t.valueAccessor||!t.range))return{info:"exclusionRule requires valueAccessor and range",error:mi};let c=d-1,p=JD({exclusionRule:t,valueAccessor:i,matchUpType:a,scaleName:r,sides:s});if(t){let e=p.map((({exclusionValues:e})=>e)).flat();if(e.length){o.excluded.push({scoreString:null==l?void 0:l.scoreStringSide1,exclusionValues:e,winningSide:d,sideValues:p});continue}}if(p.filter((e=>![void 0,"",null].includes(e.value))).length<2){o.excluded.push({scoreString:null==l?void 0:l.scoreStringSide1,missingValues:!0,winningSide:d,sideValues:p});continue}let m=p[c].value-p[1-c].value,f=parseFloat(e||0),h=f&&Math.abs(m)<f;if(h){o.excluded.push({scoreString:null==l?void 0:l.scoreStringSide1,excludeMargin:e,winningSide:d,excludeGap:h,sideValues:p,valuesGap:m});continue}let v=n?m:-1*m,g=1===d?null==l?void 0:l.scoreStringSide1:null==l?void 0:l.scoreStringSide2;v>0?o.affirmative.push({winningScoreString:g,winningSide:d,sideValues:p,valuesGap:m,score:l}):o.negative.push({winningScoreString:g,winningSide:d,sideValues:p,valuesGap:m,score:l})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}({matchUps:b,excludeMargin:u,exclusionRule:d,valueAccessor:y,ascending:U,scaleName:m}),N=!c||wp(Ad)(p)?w:2*(w||0),R=w?b.map((({competitiveProfile:e,matchUpType:t,score:i,sides:n})=>{let r=JD({singlesForDoubles:o,valueAccessor:y,matchUpType:t,scaleName:m,sides:n}),a=Math.abs(r[0].value-r[1].value);return{competitiveness:null==e?void 0:e.competitiveness,valuesGap:a,score:i}})).filter((({valuesGap:e})=>e<=N)):[],A=function({zoneData:e}){let t={[Ec]:[],[Cc]:[],[Oc]:[]};for(let i of e){let{competitiveness:e,score:n,valuesGap:r}=i;t[e]&&t[e].push({score:n,valuesGap:r})}return t}({zoneData:R}),E=A&&[].concat(Object.values(A)).flat().length,C=E&&Object.assign({},...Object.keys(A).map((e=>({[e]:Math.round(1e4*A[e].length/E)/100})))),O=b.length-((null==R?void 0:R.length)||0);return{...Be,relevantMatchUps:b,zoneDistribution:C,zoneData:R,accuracy:M,nonZone:O}}function JD({singlesForDoubles:e,exclusionRule:t,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let o=null==t?void 0:t.range.sort(),s=e=>{let i=null==e?void 0:e[null==t?void 0:t.valueAccessor];return{exclude:t&&i>=o[0]&&i<=o[1],exclusionValue:i}};return a.sort(((e,t)=>e.sideNumber-t.sideNumber)).map((({participant:t})=>{let a=[],o=null==t?void 0:t.individualParticipants;if(null!=o&&o.length){let l=[],u=0;for(let t of o){let{scaleValue:o,value:d}=QD({singlesForDoubles:e,valueAccessor:i,participant:t,matchUpType:n,scaleName:r}),{exclude:c,exclusionValue:p}=s(o);c&&a.push(p),l.push(o),d&&!isNaN(u)?u+=d:u=void 0}return{participantName:t.participantName,exclusionValues:a,scaleValues:l,value:u}}if(t){let{scaleValue:o,value:l}=QD({singlesForDoubles:e,valueAccessor:i,matchUpType:n,participant:t,scaleName:r}),{exclude:u,exclusionValue:d}=s(o);return u&&a.push(d),{participantName:t.participantName,exclusionValues:a,scaleValue:o,value:l}}return{}}))}function QD({singlesForDoubles:e,valueAccessor:t,matchUpType:i,participant:n,scaleName:r}){var a,o,s,l,u;let d=e?Ad:i,c=null==(o=null==(a=null==n?void 0:n.rankings)?void 0:a[d])?void 0:o.find((e=>e.scaleName===r)),p=null==(u=(null==(l=null==(s=null==n?void 0:n.ratings)?void 0:s[d])?void 0:l.find((e=>e.scaleName===r)))||c)?void 0:u.scaleValue;return{scaleValue:p,value:t?null==p?void 0:p[t]:p}}function ZD({collectionDefinitions:e=[],collectionGroups:t=[]}){let i,n=0,{groupValueNumbers:r}=BI({collectionGroups:t});for(let a of e||[]){let{collectionValueProfiles:e,collectionGroupNumber:t,collectionValue:o,matchUpCount:s,matchUpValue:l,scoreValue:u,setValue:d}=a,c=t&&r.includes(t);if(mr(d||u))i=!0;else{if(c)continue;if("number"==typeof o&&mr(o))n+=o;else if(null!=e&&e.length)for(let t of e)n+=t.matchUpValue;else"number"==typeof l&&mr(l)&&(n+=(s??0)*l)}}for(let a of t)n+=a.groupValue??0;return i||!n?{aggregateValue:!0,...Be}:{valueGoal:Math.floor(n/2)+1,...Be}}function XD({matchUps:e,matchUpId:t}){if(!Bd(e))return{error:Fn};let i=e.find((e=>e.matchUpId===t)),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:t,drawId:n,eventId:r,structureId:a,tournamentId:o}}function eb(e,t){if(!Ce(e))return{error:Fn};if(!Array.isArray(t))return{error:Fn};let i={};for(let{param:n,error:r,attr:a}of t){let t=tb({params:e,param:n,attr:a,error:r});if(null!=t&&t.error)return t;i[n]=t}return i}function tb({params:e,param:t,attr:i,error:n}){if(t===Fa&&Ce(e.drawDefinition)&&Ee(e.structureId)){let t=(e.drawDefinition.structures??[]).find((({structureId:t})=>t===e.structureId));return!t.length&&n?{error:n}:{structure:t}}if(t===Va){let t=eD({...e,...i});return t.error&&n?{...t,error:n}:t}return{error:Vn,info:{param:t}}}function ib(e){var t,i;let{structureId:n,matchUpId:r,event:a}=e,o=e.drawDefinition,s=io(e,[{[Pa]:!0},{[Za]:{[Ra]:!1,[Oa]:!1,[Ga]:!1,[qa]:!1}}]);if(s[$a])return s;let l=null==(t=eb(e,[{[Wa]:Va,[$a]:mi}]))?void 0:t.matchUp;if(r&&null!=l&&l.error)return l;!o&&null!=l&&l.drawDefinition&&(o=null==l?void 0:l.drawDefinition);let u=null==l?void 0:l.structure;if(!u&&n&&!r){if(!o)return{error:mt};let e=_u({drawDefinition:o,structureId:n});if(e.error)return e;u=e.structure}let d=null==u?void 0:u.matchUpFormat,c=null==o?void 0:o.matchUpFormat,p=null==a?void 0:a.matchUpFormat;return{structureDefaultMatchUpFormat:d,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:c,matchUpFormat:(null==(i=null==l?void 0:l.matchUp)?void 0:i.matchUpFormat)||d||c||p}}function nb({profileBands:e,tournamentRecord:t,matchUps:i}){if(!Bd(i))return{error:ei};let n=!e&&Gc({policyType:Yo,tournamentRecord:t}).policy,r=e||(null==n?void 0:n.profileBands)||$c[Yo].profileBands,a=i.filter((({winningSide:e})=>e)),o=a.map(Lc),s=Bc(o).reduce(((e,t)=>((e,t)=>(e[xc(t,r)]+=1,e))(e,t)),{[Ec]:0,[Cc]:0,[Oc]:0,[Rc]:0}),l=Object.keys(s).reduce(((e,t)=>(s[t]||0)+e),0),u=Object.keys(s).map((e=>({[e]:100*parseFloat((s[e]/l).toFixed(4))}))),d=a.filter((({matchUpStatus:e})=>e===Ac)).length;return u.push({[Ac]:100*parseFloat((d/l).toFixed(4))}),{competitiveBands:Object.assign({},...u),...Be}}var{stageOrder:rb}=Fu;function ab(e,t){return e.eventName.localeCompare(t.eventName)||e.eventId.localeCompare(t.eventId)||(rb[null==e?void 0:e.stage]||0)-(rb[null==t?void 0:t.stage]||0)||t.matchUpsCount-e.matchUpsCount||`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`.localeCompare(`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`)}function ob({excludeScheduleDateProfileRounds:e,excludeScheduledRounds:t,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:u,withRoundId:d,venueId:c,context:p}){var m;if(n&&!Array.isArray(n||"object"!=typeof n[0]))return{error:Fn,inContextMatchUps:n};if(o&&!r){if("object"!=typeof o)return{error:He};r={[o.tournamentId]:o}}let f="object"!=typeof r||!Object.keys(r).length;if((c||u||!n||!a&&(e||i||a||s))&&f)return{error:qe};let h=Object.assign({},...Object.values(r??{}).map((({venues:e=[],tournamentId:t})=>({[t]:null==e?void 0:e.map((({venueId:e})=>e))})))),v=Object.values(r??{}).map((({events:e=[],tournamentId:t,startDate:i,endDate:n})=>e.map((e=>({...e,validVenueIds:h[t],startDate:e.startDate??i,endDate:e.endDate??n}))))).flat(),{segmentedRounds:g,profileRounds:I}=r&&(e||i||a||s)&&DD({tournamentRecords:r,schedulingProfile:a})||{},U=e&&Object.assign({},...I.map((e=>({[e.id]:e})))),y=n||r&&(null==(m=Af({tournamentRecords:r,matchUpFilters:l}))?void 0:m.matchUps)||[],S=[],w=y&&Object.values(y.reduce(((e,t)=>{var i;let n=wD(t).id,r=null==g?void 0:g[n],a=[...(null==(i=e[n])?void 0:i.matchUps)??[],t],{containerStructureId:o,stageSequence:s,structureName:l,tournamentId:u,isRoundRobin:c,matchUpType:p,roundNumber:m,roundOffset:f,structureId:h,eventName:v,roundName:I,drawName:U,eventId:y,drawId:S}=t,w=c?o:h;return{...e,[n]:{id:d?n:void 0,structureId:w,stageSequence:s,segmentsCount:r,structureName:l,tournamentId:u,matchUpType:p,roundNumber:m,roundOffset:f,eventName:v,roundName:I,drawName:U,matchUps:a,eventId:y,drawId:S}}}),{})).map((e=>{let{minFinishingSum:t,winnerFinishingPositionRange:i}=function(e){return(e||[]).reduce(((e,t)=>{var i,n;let r=((null==(i=t.finishingPositionRange)?void 0:i.winner)||[]).reduce(((e,t)=>e+t),0),a=((null==(n=t.finishingPositionRange)?void 0:n.winner)||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:a}:e}),{minFinishingSum:0,winnerFinishingPositionRange:""})}(e.matchUps),n=e.segmentsCount;if(n){let a=e.matchUps.length/n;return Or(e.matchUps.sort(((e,t)=>e.roundPosition-t.roundPosition)),a).map(((a,o)=>{let{unscheduledCount:s,incompleteCount:l,matchUpsCount:u,isScheduled:d,isComplete:c,byeCount:m}=PD(a),f=TD({matchUps:e.matchUps,tournamentRecords:r,events:v,round:e});return ya({...e,...p,roundSegment:{segmentsCount:n,segmentNumber:o+1},winnerFinishingPositionRange:i,unscheduledCount:s,incompleteCount:l,minFinishingSum:t,matchUpsCount:u,isScheduled:d,roundTiming:f,isComplete:c,byeCount:m,matchUps:a})}))}let{unscheduledCount:a,incompleteCount:o,matchUpsCount:s,isScheduled:l,isComplete:u,byeCount:d}=PD(e.matchUps),c=TD({matchUps:e.matchUps,tournamentRecords:r,events:v,round:e});return ya({...e,...p,winnerFinishingPositionRange:i,unscheduledCount:a,incompleteCount:o,minFinishingSum:t,matchUpsCount:s,isScheduled:l,roundTiming:c,isComplete:u,byeCount:d})})).flat().filter((n=>{if(e){let t=Co(e),i=d?n.id:wD(n).id;if(t&&U[i]&&Co(U[i].scheduleDate)===t)return!1}let{isComplete:r,isScheduled:a}=n,s=!i||!r,l=!t||!a,p=c||u?null==v?void 0:v.find((({eventId:e})=>e===n.eventId)):void 0,m=(null==p?void 0:p.startDate)??(null==o?void 0:o.startDate),f=(null==p?void 0:p.endDate)??(null==o?void 0:o.endDate),h=!u||!m||new Date(u)>=new Date(m),g=!u||!f||new Date(u)<=new Date(f),I=h&&g,y=!c||(null==p?void 0:p.validVenueIds.includes(c)),w=s&&l&&y&&I;return w||S.push(n),w})).sort(ab)||[];return{...Be,rounds:w,excludedRounds:S}}function sb(e){var t;let{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:o}=e||{},{matchUpFormat:s}=e||{};if(!i)return{error:ti};s=s||(null==i?void 0:i.matchUpFormat);let l=xm(s),u=!(null==i||!i.winningSide),d=null==(t=i.score)?void 0:t.sets,c=null==d?void 0:d.length,p=r&&r-1,m=!(null==d||!d.find(((e,t)=>e.setNumber===r&&t===p))),f=(null==d?void 0:d.filter((e=>null==e?void 0:e.winningSide)))||[],h=(null==f?void 0:f.length)||0,v=r&&(null==d?void 0:d.slice(r))||[],g=!!(c&&r&&null!=v&&v.reduce(((e,t)=>(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e),!0)),I=r<=c&&d.find((e=>e.setNumber===r)),U=I&&yT({setObject:I,matchUpScoringFormat:l}),{isCompletedSet:y,sideGameScores:S,sideTiebreakScores:w}=U||{},T=!!(I&&!y&&g||r&&r===c+1&&!u),P=[1,2].includes(n),D=P?n-1:0,b=I&&P&&(!a&&!o&&void 0!==S[D]&&S[D]||a&&void 0!==w[D]&&w[D]),M=!!b,N=null==f?void 0:f.map((e=>yT({setObject:e,matchUpScoringFormat:l}).isValidSetOutcome)).reduce(((e,t)=>e&&t),!0),R=f.reduce(((e,t)=>{let{winningSide:i}=t;return e[i-1]++,e}),[0,0]),A=null==i?void 0:i.winningSide,E=A&&A-1,C=1-E,O=R[E],k=R[C],F=Math.max(...R),x=Ur(R)[F],{bestOf:L}=l??{},_=F===(L&&Math.ceil(L/2)||1)&&1===x&&R.indexOf(F)+1||void 0,B=O>k&&A===_;return{completedSetsHaveValidOutcomes:N,validMatchUpWinningSide:B,calculatedWinningSide:_,matchUpScoringFormat:l,validMatchUpOutcome:_&&N&&B,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:u,isValidSideNumber:P,hasExistingValue:M,existingValue:b,isExistingSet:m,isActiveSet:T,...U}}function lb({participants:e,tournamentAppliedPolicies:t,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:u,contextContent:d,matchUpFilters:c,participantMap:p,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:v,tournamentId:g,inContext:I,context:U,event:y}){let S,{eventId:w,eventName:T,endDate:P,eventType:D,category:b,gender:M}=y??{},N={...U,...ya({surfaceCategory:(null==y?void 0:y.surfaceCategory)??(null==s?void 0:s.surfaceCategory),indoorOutDoor:(null==y?void 0:y.indoorOutdoor)??(null==s?void 0:s.indoorOutdoor),endDate:P??(null==y?void 0:y.endDate)??(null==s?void 0:s.endDate),tournamentId:g??(null==s?void 0:s.tournamentId),eventName:T,eventType:D,category:b,eventId:w,gender:M})};return!(null!=e&&e.length)&&s&&({participants:e,participantMap:p,groupInfo:S}=Mf({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:I})),y&&f&&!d&&(d=wm({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:h,event:y})),{...df({context:N,tournamentAppliedPolicies:t,scheduleVisibilityFilters:i,tournamentParticipants:e,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:d,contextFilters:u,matchUpFilters:c,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:v,inContext:I,event:y}),groupInfo:S}}var ub={};function db({tournamentRecord:e,venueId:t,venueIds:i}){return e?{courts:(e.venues||[]).filter((e=>t?e.venueId===t:!i||i.includes(e.venueId))).map((e=>{let{venueId:t}=e,i=Wo(e.courts||[]);return i.forEach((e=>Object.assign(e,{venueId:t}))),i})).flat()}:{error:We}}be(ub,{getCompetitionVenues:()=>sD,getCourts:()=>db,getVenuesAndCourts:()=>oD,publicFindVenue:()=>um});var cb={};function pb({tournamentRecord:e,event:t}){var i,n;if(!e)return{error:We};if(!t)return{error:Et};let r,a,o,s=t.entries||[],l=e.participants||[],u=(null==(i=t.category)?void 0:i.categoryName)||(null==(n=t.category)?void 0:n.ageCategoryCode),{eventType:d}=t,c=s.map((e=>e.participantId));return{entryScaleAttributes:l.filter((e=>c.includes(e.participantId))).map((e=>{var t,i,n,s,l,c;let{participantId:p,participantName:m,name:f}=e,h={scaleType:hp,eventType:d,scaleName:u},v=null==(i=null==(t=rh({participant:e,scaleAttributes:h}))?void 0:t.scaleItem)?void 0:i.scaleValue;h={scaleType:fp,eventType:d,scaleName:u};let g=null==(s=null==(n=rh({participant:e,scaleAttributes:h}))?void 0:n.scaleItem)?void 0:s.scaleValue;h={scaleType:mp,eventType:d,scaleName:u};let I=null==(c=null==(l=rh({participant:e,scaleAttributes:h}))?void 0:l.scaleItem)?void 0:c.scaleValue;return r=!(!r&&!v),a=!(!a&&!g),o=!(!o&&!I),{participantId:p,participantName:m||f,seed:v,ranking:g,rating:I}})),hasSeededParticipants:r,hasRankedParticipants:a,hasRatedParticipants:o}}function mb({tournamentRecord:e,withScaleValues:t,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:o}){var s,l,u,d;if(!e)return{error:We};let{tournamentId:c}=e,p=(e.events??[]).filter((({eventId:e})=>!r||Array.isArray(r)&&r.includes(e))).map((e=>{var t;let i=null==(t=e.drawDefinitions)?void 0:t.map(ul);if(null!=a&&a.length&&!Nr(a,i).length)return;let r=Wo(e);return n&&Object.assign(r,{tournamentId:c}),o&&Object.assign(r,o),r})).filter(Boolean),m={};if(t){let t=vh({withScaleValues:!0,tournamentRecord:e}).participantMap,n=e=>e.reduce(((e,t)=>e+parseFloat(t)),0);for(let e of p){let r=i??e.eventType,o=e.eventId;m[o]||(m[o]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let c=(e.entries??[]).filter((({entryStatus:e})=>wc.includes(e))).map(sl),p=e=>{var t,i,n,a,s,l;if(null!=(t=null==e?void 0:e.ratings)&&t[r])for(let u of(null==(i=null==e?void 0:e.ratings)?void 0:i[r])??[]){let e=u.scaleName;m[o].ratings[e]||(m[o].ratings[e]=[]);let t=null==(n=cS[e])?void 0:n.accessor;if(t){let i=parseFloat(null==(a=u.scaleValue)?void 0:a[t]);i&&m[o].ratings[e].push(i)}}if(null!=(s=null==e?void 0:e.rankings)&&s[r])for(let u of(null==(l=null==e?void 0:e.rankings)?void 0:l[r])??[]){let e=u.scaleName;m[o].ranking[e]||(m[o].ranking[e]=[]),u.scaleValue&&m[o].ranking[e].push(u.scaleValue)}};for(let e of c){let i=null==(s=null==t?void 0:t[e])?void 0:s.participant;if((null==i?void 0:i.participantType)!==Qd)for(let e of(null==i?void 0:i.individualParticipantIds)??[]){p(null==(l=null==t?void 0:t[e])?void 0:l.participant)}else p(i)}let f=m[o].ratings;for(let e of Object.keys(f)){let t=f[e];if(!t.length)continue;let i=null==(u=or(t))?void 0:u.toFixed(2);m[o].ratingsStats[e]={avg:parseFloat((n(t)/t.length).toFixed(2)),median:i?parseFloat(i):void 0,max:Math.max(...t),min:Math.min(...t)}}let h=(e,i)=>{var n,a;let s=t=>{var i,n,a,s,l,u,d,c,p,f;if(null!=(i=m[o].draws)&&i[e]&&null!=(n=null==t?void 0:t.ratings)&&n[r])for(let h of(null==(a=null==t?void 0:t.ratings)?void 0:a[r])??[]){let t=h.scaleName;null!=(s=m[o].draws[e])&&s.ratings[t]||(m[o].draws[e].ratings[t]=[]);let i=null==(l=cS[t])?void 0:l.accessor;if(i){let n=parseFloat(null==(u=h.scaleValue)?void 0:u[i]);n&&m[o].draws[e].ratings[t].push(n)}}if(null!=(d=m[o].draws)&&d[e]&&null!=(c=null==t?void 0:t.rankings)&&c[r])for(let h of(null==(p=null==t?void 0:t.rankings)?void 0:p[r])??[]){let t=h.scaleName;null!=(f=m[o].draws[e])&&f.ranking[t]||(m[o].draws[e].ranking[t]=[]);let i=h.scaleValue;i&&m[o].draws[e].ranking[t].push(i)}};for(let r of i.filter(Boolean)){let e=null==(n=null==t?void 0:t[r])?void 0:n.participant;if((null==e?void 0:e.participantType)!==Qd)for(let i of(null==e?void 0:e.individualParticipantIds)??[]){s(null==(a=null==t?void 0:t[i])?void 0:a.participant)}else s(e)}},v=[],g=e=>(null==a?void 0:a.length)&&a.includes(e)||v.includes(e);for(let t of e.drawDefinitions??[]){let e=t.drawId;if(g(e))continue;let i=Xf({drawDefinition:t}).assignedParticipantIds??[];m[o].draws[e]||(m[o].draws[e]={ratingsStats:{},ratings:{},ranking:{}}),v.push(e),h(e,i)}let I=fm({event:e}).flightProfile;for(let e of(null==I?void 0:I.flights)??[]){let t=e.drawId;g(t)||h(t,e.drawEntries.map(sl))}for(let e of v){let t=m[o].draws[e].ratings;for(let i of Object.keys(t)){let r=t[i];if(!r.length)continue;let a=null==(d=or(r))?void 0:d.toFixed(2);m[o].draws[e].ratingsStats[i]={avg:parseFloat((n(r)/r.length).toFixed(2)),median:a?parseFloat(a):void 0,max:Math.max(...r),min:Math.min(...r)}}}}}return ya({eventScaleValues:m,events:p,...Be})}function fb({tournamentRecord:e,drawDefinition:t,context:i,event:n}){var r;if(!e)return{error:We};if(!n)return{error:Et};let a=Wo(n);return i&&Object.assign(a,i),ya({drawDefinition:t&&(null==(r=a.drawDefinitions)?void 0:r.find((({drawId:e})=>t.drawId===e))),event:a})}function hb(e){var t,i;let n="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:a}=function(e){let{tournamentRecord:t,event:i}=e,n=jc({tournamentRecord:t,event:i}).appliedPolicies??{},r=Wo(e.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}(e),o=function({enforceGender:e,policyDefinitions:t,appliedPolicies:i}){var n,r,a,o;return e??(null==(r=null==(n=null==t?void 0:t[Qo])?void 0:n.participants)?void 0:r.enforceGender)??(null==(o=null==(a=null==i?void 0:i[Qo])?void 0:a.participants)?void 0:o.enforceGender)}({...e,policyDefinitions:a,appliedPolicies:r}),s=function({considerEventEntries:e=!0,drawEntries:t,eventEntries:i,qualifyingOnly:n}){return(n&&[]||vb(t)||(e?i:[])).filter((({entryStage:e})=>!e||e===xl))}(e),l=function(e){let{consideredEntries:t,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:o,event:s}=e;return s&&o&&zy({consideredEntries:t,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:o,event:s})}({...e,consideredEntries:s,appliedPolicies:r});if(null!=l&&l.error)return Sa({result:l,stack:n});let u=function(e){return!e.drawSize&&e.consideredEntries.length&&![au,du,ou,Du,bu].includes(e.drawType??"")&&cr(e.consideredEntries.length)||e.drawSize&&rr(e.drawSize)||!1}({...e,consideredEntries:s}),d=function(e){let{policyDefinitions:t,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=e,a=e.drawTypeCoercion??Gy({drawType:e.drawType,policyDefinitions:t,appliedPolicies:i}),o=Jy({drawType:e.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return o.error?o:{drawType:o.drawType}}({...e,appliedPolicies:r,policyDefinitions:a,drawSize:u});if(d.error)return Sa({result:d,stack:n});let c=d.drawType;if(isNaN(u)&&c!==au)return Sa({result:{error:pt},stack:n});let p=(null==a?void 0:a[as])??(null==r?void 0:r[as]),m=e.seedingProfile??(null==(i=null==(t=null==p?void 0:p.seedingProfile)?void 0:t.drawTypes)?void 0:i[c??""])??(null==p?void 0:p.seedingProfile);e.seedingProfile&&(a[as]||(a[as]={...bP[as]}),a[as].seedingProfile=m);let f=function(e){var t,i;let{tournamentRecord:n,event:r,ignoreAllowedDrawTypes:a,drawType:o}=e,s=!a&&n&&BP({tournamentRecord:n,categoryType:null==(t=null==r?void 0:r.category)?void 0:t.categoryType,categoryName:null==(i=null==r?void 0:r.category)?void 0:i.categoryName});return null!=s&&s.length&&!s.includes(o)?{error:ut}:{...Be}}({...e,drawType:c});return null!=f&&f.error?Sa({result:f,stack:n}):{drawSize:u,drawType:c,enforceGender:o,seedingProfile:m,appliedPolicies:r,policyDefinitions:a}}function vb(e){return null==e?void 0:e.filter((e=>e.entryStatus&&[...wc,mc].includes(e.entryStatus)))}function gb(e){let{voluntaryConsolation:t,tournamentRecord:i,event:n}=e,r="generateDrawDefinition",{participants:a,participantMap:o}=vh({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=vb(null==n?void 0:n.entries)??[],l=hb({...e,participantMap:o,participants:a,eventEntries:s});if(l.error)return Sa({result:l,stack:r});let{appliedPolicies:u,policyDefinitions:d,drawSize:c,drawType:p,enforceGender:m,seedingProfile:f}=l,h=null==n?void 0:n.eventType,v=e.matchUpType??h,g=function(e){var t,i,n;let{existingDrawDefinition:r,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:u,isMock:d,event:c}=e,{tieFormat:p,matchUpFormat:m}=e;if(l===$p&&u===$p){let e=null==(i=null==(t=null==r?void 0:r.structures)?void 0:t.find((({stage:e})=>e===xl)))?void 0:i.tieFormat;p=p||e||s&&(null==(n=null==c?void 0:c.tieFormat)?void 0:n.tieFormatName)===s&&c.tieFormat||s&&sP({namedFormat:s,hydrateCollections:a,isMock:d,event:c})||(null==c?void 0:c.tieFormat)||sP({event:c,isMock:d,hydrateCollections:a}),m=void 0}else m||(p=void 0,null!=c&&c.matchUpFormat||(m=oI));if(p){let e=nU({gender:null==c?void 0:c.gender,enforceGender:o,tieFormat:p});if(e.error)return e}return{tieFormat:p,matchUpFormat:m}}({...e,enforceGender:m,eventType:h,matchUpType:v});if(g.error)return Sa({result:g,stack:r});let{matchUpFormat:I,tieFormat:U}=g;if(e.drawId&&"string"!=typeof e.drawId)return Sa({result:{error:Fn},stack:r});let y=function(e){var t,i;let n="generateOrGetExisting",r=[],a=[],o=NP(e);if(o.error)return Sa({result:o,stack:n});let s=o.existingDrawDefinition,l=o.drawDefinition??{},u=o.structureId,d=e.drawEntries??e.eventEntries??[],c=o.existingQualifyingPlaceholderStructureId&&lP({...e,...o})||vP({...e,...o,entries:d});return c.error?Sa({result:c,stack:n}):(null!=(t=c.positioningReports)&&t.length&&r.push(...c.positioningReports??[]),null!=(i=c.conflicts)&&i.length&&a.push(...c.conflicts??[]),l=c.drawDefinition,u=c.structureId,{existingDrawDefinition:s,positioningReports:r,drawDefinition:l,structureId:u,conflicts:a,entries:d})}({...e,isMock:e.isMock??!0,policyDefinitions:d,tournamentRecord:i,appliedPolicies:u,matchUpFormat:I,seedingProfile:f,participants:a,eventEntries:s,matchUpType:v,tieFormat:U,drawSize:c,drawType:p,event:n});if(y.error)return Sa({result:y,stack:r});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:T,structureId:P,conflicts:D,entries:b}=y;if(!T)return Sa({result:{error:Fn},stack:r});let M=function(e){var t,i,n;let{qualifyingPlaceholder:r,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:u,drawDefinition:d,seedingProfile:c,participants:p,structureId:m,entries:f,stack:h}=e,v=r&&!(null!=a&&a.length)&&!o,g=[];if(a){let r=(e,t)=>e.stageSequence-t.stageSequence,o=(e,t)=>e.roundTarget-t.roundTarget,m=[],v=1;a.sort(o);for(let I of a){if(!Array.isArray(I.structureProfiles))return Sa({info:Tv("structureProfiles"),result:{error:mi},stack:h});v=I.roundTarget||v;let a=(null==(t=I.structureProfiles)?void 0:t.sort(r))||[],o=1;for(let t of a){let{qualifyingRoundNumber:r,qualifyingPositions:a,seededParticipants:h,seedingScaleName:I,seedsCount:U=0,seedByRanking:y,placeByes:S,drawSize:w}=t,T=hP({...e,seedingProfile:t.seedingProfile??c,stageSequence:o,qualifyingRoundNumber:r,preparedStructureIds:m,qualifyingPositions:a,seededParticipants:h,stage:Ll,seedingScaleName:I,appliedPolicies:l,drawDefinition:d,qualifyingOnly:u,seedByRanking:y,participants:p,roundTarget:v,seedsCount:U,placeByes:S,drawSize:w,entries:f});if(T.error)return T;T.structureId&&m.push(T.structureId),o+=1,null!=(i=T.conflicts)&&i.length&&g.push(...T.conflicts),null!=(n=T.positioningReport)&&n.length&&s.push({[Ll]:T.positioningReport})}v+=1}}else if(m&&v){let e=Jh({structureName:Yh(Ll),stage:Ll}),{link:t}=Fg({sourceStructureId:e.structureId,targetStructureId:m,sourceRoundNumber:0,linkType:tu});d.structures||(d.structures=[]),d.structures.push(e),d.links||(d.links=[]),d.links.push(t)}return{qualifyingConflicts:g,error:void 0}}({...e,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:T,seedingProfile:f,participants:a,structureId:P,entries:b,params:e,stack:r});if(M.error)return M;let{qualifyingConflicts:N}=M;return T.drawName=e.drawName??(p&&Yh(p)),c&&"object"==typeof t&&c>=4&&Qh({...t,drawDefinition:T,matchUpType:v}),{existingDrawDefinition:!!S,qualifyingConflicts:N,positioningReports:w,drawDefinition:T,structureId:P,...Be,conflicts:D}}function Ib({scaleAttributes:e,scaledEntries:t,stageEntries:i,seedsCount:n,scaleName:r}){if(!e)return{error:mi,info:"missing scaleAttributes"};let a=Object.assign({},...(t||[]).slice(0,n).map((({participantId:e},t)=>({[e]:t+1}))));r=r||e.scaleName;let o=(new Date).toISOString();return{scaleItemsWithParticipantIds:i.map((({participantId:t})=>({scaleItems:[{scaleValue:a[t],eventType:e.eventType,scaleType:lo,scaleName:r,scaleDate:o}],participantId:t})))}}function Ub({tournamentRecord:e,drawDefinition:t,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:l,sortDescending:u,scaleSortMethod:d}){let c=MD({policyDefinitions:i,drawDefinition:t,drawSize:a,drawId:o,event:s,stage:l});if(c.error)return c;let{entries:p,seedsCount:m,stageEntries:f}=c;if(!f||!m)return{error:Fn};let h=fP({tournamentRecord:e,scaleAttributes:n,scaleSortMethod:d,sortDescending:u,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:v}=Ib({scaleAttributes:n,scaledEntries:h,stageEntries:f,seedsCount:m,scaleName:r});return{scaleItemsWithParticipantIds:v}}be(cb,{categoryCanContain:()=>tU,getCategoryAgeDetails:()=>XI,getEvent:()=>fb,getEventProperties:()=>pb,getEventStructures:()=>Gv,getEventTimeItem:()=>If,getEvents:()=>mb,getFlightProfile:()=>fm,getScaledEntries:()=>fP});var yb={};be(yb,{addDrawEntries:()=>Th,addEventEntries:()=>Nh,addEventEntryPairs:()=>Ab,destroyPairEntries:()=>qh,destroyPairEntry:()=>$h,getEntriesAndSeedsCount:()=>MD,getMaxEntryPosition:()=>ND,modifyEntriesStatus:()=>ih,modifyEventEntries:()=>Eb,mutate:()=>Sb,promoteAlternate:()=>Pb,promoteAlternates:()=>Db,query:()=>bD,removeDrawEntries:()=>Mb,removeEventEntries:()=>Dh,setEntryPosition:()=>wb,setEntryPositions:()=>Tb});var Sb={};function wb({tournamentRecord:e,drawDefinition:t,participantId:i,entryPosition:n,skipRefresh:r,event:a}){if(!e)return{error:We};if(!i)return Sa({result:{error:_i},stack:"setEntryPositions"});if(void 0!==n&&!Number.isSafeInteger(n))return{error:Fn,entryPosition:n};((null==a?void 0:a.entries)||[]).forEach((e=>{e.participantId===i&&(e.entryPosition=n)})),((null==t?void 0:t.entries)||[]).forEach((e=>{e.participantId===i&&(e.entryPosition=n)}));let o=e=>{e.entries.forEach((e=>{e.entryPosition===n&&e.participantId!==i&&(e.entryPosition+=.1)}))};return r||(null!=a&&a.entries&&(o(a),a.entries=eh({entries:a.entries})),null!=t&&t.entries&&(o(t),t.entries=eh({entries:t.entries}))),{...Be}}function Tb({tournamentRecord:e,entryPositions:t,drawDefinition:i,event:n}){if(!e)return{error:We};if(!Array.isArray(t))return{error:Fn};for(let r of t){let{participantId:t,entryPosition:a}=r,o=wb({skipRefresh:!0,tournamentRecord:e,drawDefinition:i,participantId:t,entryPosition:a,event:n});if(o.error)return o}return null!=n&&n.entries&&(n.entries=eh({entries:n.entries})),null!=i&&i.entries&&(i.entries=eh({entries:i.entries})),{...Be}}function Pb(e){let{participantId:t}=e;return t&&"string"!=typeof t?{error:Fn,participantId:t}:Db({...e,participantIds:[t].filter(Boolean)})}function Db({tournamentRecord:e,drawDefinition:t,participantIds:i,stageSequence:n,stage:r=xl,eventId:a,event:o}){if(!e)return{error:We};if(!Array.isArray(i))return{error:Fn,participantIds:i};if(!o)return{error:Et};if(o){let e=bb({element:o,participantIds:i,stageSequence:n,stage:r});if(e.error)return e}if(t){let e=bb({element:t,participantIds:i,stageSequence:n,stage:r});if(e.error)return a?Sa({context:{drawPromotionError:e.error,drawId:t.drawId},result:{...Be},stack:"promoteAlternates"}):e}return{...Be}}function bb({participantIds:e,stageSequence:t,element:i,stage:n}){let r=(i.entries||[]).filter((e=>e.entryStatus===oc)),a=(i.entries||[]).filter((t=>e.includes(t.participantId))),o=r.reduce(((e,t)=>{let{entryPosition:i}=t;return isNaN(i)&&e||(!e||i<e.entryPosition)&&t||e}),void 0),s=a.length?a:[o].filter(Boolean);if(null==s||!s.length)return{error:Ji};let l=s.filter((({entryStatus:e})=>e!==oc));if(l.length)return{error:Ki,invalidEntryStatus:l};let u=s.filter((({entryStage:e})=>e&&e!==n));if(u.length)return{error:Qi,invalidStage:u};let d=t&&s.filter((e=>e.stageSequence!==t));if(null!=d&&d.length)return{error:Zi,invalidStageSequence:d};for(let c of s){c.entryStatus=lc;let e=null==c?void 0:c.entryPosition;isNaN(e)||i.entries.forEach((t=>{t.entryStatus===oc&&t.entryPosition>e&&(t.entryPosition=t.entryPosition-1)}));let t=Math.max(...i.entries.filter((e=>e.entryStatus===lc&&!isNaN(e.entryPosition))).map((({entryPosition:e})=>rr(e||0))),0);c.entryPosition=t||0}return{...Be}}function Mb({autoEntryPositions:e=!0,participantIds:t,drawDefinition:i,drawId:n,stages:r,event:a}){var o;if(!a)return{error:Et};if(!n)return{error:mt};if(null==t||!t.length)return{error:Gi};if(Ar(Xf({drawDefinition:i,stages:r}).assignedParticipantIds??[],t))return{error:Hi};let s=e=>{let i=e.participantId;return!t.includes(i)},{flightProfile:l}=fm({event:a}),u=null==(o=null==l?void 0:l.flights)?void 0:o.find((e=>e.drawId===n));return null!=u&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),e&&(u.drawEntries=eh({entries:u.drawEntries}))),null!=i&&i.entries&&(i.entries=i.entries.filter(s),e&&(i.entries=eh({entries:i.entries}))),{...Be}}function Nb(e){var t,i,n,r,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:u,pairOverride:d,participant:c}=e,p=e.tournamentId?null==(t=e.tournamentRecords)?void 0:t[e.tournamentId]:e.tournamentRecord??(e.activeTournamentId&&(null==(i=e.tournamentRecords)?void 0:i[e.activeTournamentId]));if(!p)return{error:We};if(!c)return Sa({result:{error:xi},stack:o});c.participantId||(c.participantId=am()),p.participants||(p.participants=[]);let{participantId:m,individualParticipantIds:f}=c;if(p.participants.reduce(((e,t)=>t.participantId===m||e),!1))return{error:ji};let{participantType:h,participantRole:v}=c;if(!h||!Object.keys(tc).includes(h))return{error:ki,participantType:h};if(!v)return{error:Fi};let g=p.participants||[],I=g.filter((e=>e.participantType===Qd)).map((e=>e.participantId));if(h!==Qd&&c.person)return{error:Fn,person:c.person};if(f&&!Array.isArray(f))return{error:Fn,individualParticipantIds:f};if(h===Xd){if(c.person)return{error:Fn,person:c.person};if(!c.individualParticipantIds)return Sa({result:{error:Gi},stack:o});if(2!==c.individualParticipantIds.length&&!d)return Sa({info:"PAIR must be 2 individualParticipantIds",result:{error:Ci},stack:o});{let e=g.filter((e=>e.participantType===Qd)).map((e=>e.participantId));if(!Array.isArray(c.individualParticipantIds))return Sa({result:{error:Ci},stack:o});if(!c.individualParticipantIds.reduce(((t,i)=>e.includes(i)&&t),!0))return Sa({result:{error:Ci},stack:o})}let e=g.filter((e=>e.participantType===Xd)).map((e=>({individualParticipantIds:e.individualParticipantIds,participant:e}))),t=c.participantType===Xd&&e.find((e=>2===Nr(e.individualParticipantIds,c.individualParticipantIds).length));if(t&&!s)return{...Be,existingParticipant:!0,participant:l&&Wo(t.participant)};if(!c.participantName){let e=g.filter((e=>{var t;return null==(t=c.individualParticipantIds)?void 0:t.includes(e.participantId)})),t=e.map((e=>{var t;return null==(t=e.person)?void 0:t.standardFamilyName})).filter(Boolean).join("/");1===e.length&&(t+="/Unknown"),c.participantName=t}}else if(h===Qd){if(null==(n=c.person)||!n.standardFamilyName||null==(r=c.person)||!r.standardGivenName)return{error:Wi};if(!c.participantName){let e=`${c.person.standardFamilyName.toUpperCase()}, ${c.person.standardGivenName}`;c.participantName=e}}else{if(!h||![ec,Zd].includes(h))return{error:ki};if(f||(c.individualParticipantIds=[]),null==(a=c.individualParticipantIds)?void 0:a.length)for(let e of c.individualParticipantIds){if("string"!=typeof e)return Sa({result:{participantId:e,error:Fn},stack:o});if(!I.includes(e))return Sa({result:{participantId:e,error:Bi},stack:o})}}return p.participants.push(c),u||ia({payload:{tournamentId:p.tournamentId,participants:[c]},topic:Wu}),ya({participant:l&&Wo(c),...Be})}function Rb({allowDuplicateParticipantIdPairs:e,returnParticipants:t,tournamentRecord:i,participants:n=[]}){if(!i)return{error:We};i.participants||(i.participants=[]);let r=i.participants.map((e=>e.participantId))||[];n.forEach((e=>{e.participantId||(e.participantId=am())}));let a=n.filter((e=>!r.includes(e.participantId))),o=n.filter((e=>r.includes(e.participantId))),s=a.filter((e=>e.participantType===Qd)),l=a.filter((e=>e.participantType!==Qd)),u=s.concat(...l),d=[];if(u.length){for(let t of u){let n=Nb({allowDuplicateParticipantIdPairs:e,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:t});if(n.error)return n;n.success&&!n.existingParticipant&&d.push(n.participant)}d.length&&ia({topic:Wu,payload:{tournamentId:i.tournamentId,participants:d}});let n={participants:t&&Wo(d),addedCount:d.length,...Be};return o.length&&Object.assign(n,{notAdded:o,info:zi}),ya(n)}return{info:"No new participants to add",addedCount:0,...Be}}function Ab({allowDuplicateParticipantIdPairs:e,entryStage:t=xl,entryStatus:i=oc,participantIdPairs:n=[],tournamentRecord:r,drawDefinition:a,event:o,uuids:s}){if(!r)return{error:We};if(!o)return{error:Et};if(o.eventType!==Cd)return{error:At};let l=[],u=new Map;for(let v of r.participants??[]){let{participantType:e,participantId:t,person:i,individualParticipantIds:n}=v;e===Qd&&null!=i&&i.sex?u.set(t,i.sex):e===Xd&&n&&l.push(n)}let d=n.filter((e=>{if(2!==e.length||!u.has(e[0])||!u.has(e[1]))return!0;if(!o.gender||o.gender===Hm)return!1;let t=e.map((e=>u.get(e))),i=o.gender===zm&&(t[0]!==zm||t[1]!==zm)||o.gender===Jm&&(t[0]!==Jm||t[1]!==Jm);return o.gender===Ym&&(t.sort(sh),(t[0]!==Jm||t[1]!==zm)&&(i=!0)),i}));if(d.length)return{error:Ci,invalidParticipantIdPairs:d};let c,p=n.map((e=>({participantId:(null==s?void 0:s.pop())??am(),participantRole:Ah,individualParticipantIds:e,participantType:Xd}))),m=e?p:p.filter((e=>!l.find((t=>2===Nr(t,e.individualParticipantIds).length)))),f=[];if(m){let t=Rb({allowDuplicateParticipantIdPairs:e,participants:m,returnParticipants:!0,tournamentRecord:r});if(t.error)return t;f=t.participants||[],c=t.info}let h=Nh({participantIds:n.map((e=>{let t=f.find((t=>2===Nr(t.individualParticipantIds,e).length));if(t)return t;let{participant:i}=Pm({tournamentRecord:r,participantIds:e});return i})).map((e=>e.participantId)),tournamentRecord:r,drawDefinition:a,entryStatus:i,entryStage:t,event:o});return m.length&&ia({payload:{participants:m},topic:Wu}),{...h,info:c,newParticipantIds:m.map(sl)}}function Eb({entryStatus:e=lc,unpairedParticipantIds:t=[],participantIdPairs:i=[],entryStage:n=xl,tournamentRecord:r,event:a}){if(!r)return{error:We};if(!a)return{error:Et};let o=r.participants??[],s=o.filter((e=>e.participantType===Qd)).map((e=>e.participantId)),l=t.concat(...i).flat(1/0).filter((e=>!s.includes(e)));if(l.length)return{error:Ci,invalidParticipantIds:l};let u=i.filter((e=>2!==e.length));if(u.length)return{error:Ci,invalidParticipantIdPairs:u};let d=o.filter((e=>e.participantType===Xd)).map((e=>e.individualParticipantIds)),c=Rb({participants:i.filter((e=>!d.find((t=>2===Nr(t,e).length)))).map((e=>({participantType:Xd,participantRole:Ah,individualParticipantIds:e}))),tournamentRecord:r});if(c.error)return c;let p=i.map((e=>{let{participant:t}=Pm({tournamentRecord:r,participantIds:e});return t})).map((t=>({participantId:t,entryStatus:e,entryStage:n}))),m=t.map((e=>({entryStatus:hc,participantId:e,entryStage:n})));return a.entries=(a.entries??[]).filter((e=>e.entryStage===n)),a.entries=a.entries.concat(...p,...m),{...Be}}be(Sb,{addDrawEntries:()=>Th,addEventEntries:()=>Nh,addEventEntryPairs:()=>Ab,destroyPairEntries:()=>qh,destroyPairEntry:()=>$h,modifyEntriesStatus:()=>ih,modifyEventEntries:()=>Eb,promoteAlternate:()=>Pb,promoteAlternates:()=>Db,removeDrawEntries:()=>Mb,removeEventEntries:()=>Dh,setEntryPosition:()=>wb,setEntryPositions:()=>Tb});var Cb={};be(Cb,{addDrawDefinition:()=>iM,addEvent:()=>pM,addFlight:()=>dM,assignSeedPositions:()=>nM,attachFlightProfile:()=>rM,categoryCanContain:()=>tU,deleteDrawDefinitions:()=>jb,deleteEvents:()=>lM,deleteFlightAndFlightDraw:()=>eM,deleteFlightProfileAndFlightDraws:()=>Vb,getCategoryAgeDetails:()=>XI,getEvent:()=>fb,getEventProperties:()=>pb,getEventStructures:()=>Gv,getEventTimeItem:()=>If,getEvents:()=>mb,getFlightProfile:()=>fm,getScaledEntries:()=>fP,modifyEvent:()=>uM,modifyEventMatchUpFormatTiming:()=>Wb,modifyPairAssignment:()=>tM,mutate:()=>Ob,query:()=>cb,refreshEventDrawOrder:()=>Xb,removeEventMatchUpFormatTiming:()=>Hb,removeScaleValues:()=>aM,removeSeeding:()=>sM,setEventDates:()=>Jb,setEventDisplay:()=>oM,setEventEndDate:()=>Kb,setEventStartDate:()=>Yb,updateDrawIdsOrder:()=>Zb,validateCategory:()=>eU});var Ob={};function kb({removePriorValues:e=!0,status:t=gp,statusObject:i,event:n}){if(!Ce(i))return{error:Fn};let r=lh({event:n,status:t}),a=`${vp}.${Ip}`;return Tg({timeItem:{itemValue:{[t]:{...r,...i}},itemType:a},removePriorValues:e,event:n})}function Fb(e){var t,i,n,r,a,o,s;let{includePositionAssignments:l,removePriorValues:u,tournamentRecord:d,status:c=gp,event:p,drawIdsToRemove:m,drawIdsToAdd:f}=e;if(!d)return{error:We};if(!p)return{error:Et};let{appliedPolicies:h}=jc({tournamentRecord:d,event:p}),v={...h,...e.policyDefinitions},g=(null==(t=p.drawDefinitions)?void 0:t.map((({drawId:e})=>e)))??[],I=e.drawDetails?Object.keys(e.drawDetails):[],U=I.length?[]:e.drawIds,y=(f??[]).concat(...m??[],...U??[],...I),S=y.filter((e=>!g.includes(e)));if(S.length)return Sa({result:{error:Qe},context:{invalidDrawIds:S}});let w=lh({event:p,status:c}),T=Object.keys((null==w?void 0:w.drawDetails)||{}).filter((e=>g.includes(e))).reduce(((e,t)=>(e[t]=w.drawDetails[t],e)),{});for(let M of g)if((!y.length||y.includes(M))&&(null!=m&&m.includes(M)||null!=U&&U.length&&!U.includes(M)?T[M]={...T[M],publishingDetail:{published:!1}}:(null!=f&&f.includes(M)||null!=U&&U.includes(M)||!(null!=U&&U.length))&&(T[M]={...T[M],publishingDetail:{published:!0}})),null==(i=e.drawDetails)?void 0:i[M]){let t=e.drawDetails[M],i=t.structureDetails??T[M].structureDetails,s=t.stageDetails??T[M].stageDetails??{},{structureIdsToRemove:l=[],structureIdsToAdd:u=[],publishingDetail:d={},stagesToRemove:c=[],stagesToAdd:m=[]}=t;if((u||m)&&(d.published=!0),T[M]={publishingDetail:d,structureDetails:i,stageDetails:s},u.length||l.length){let e=((null==(r=null==(n=p.drawDefinitions)?void 0:n.find((e=>e.drawId===M)))?void 0:r.structures)??[]).map((({structureId:e})=>e)),t=(u??[]).concat(l??[]).filter((t=>!e.includes(t)));if(t.length)return Sa({result:{error:bt},context:{invalidStructureIds:t}});i=i??{};for(let n of e)l.includes(n)?i[n]={published:!1}:i[n]={published:!0};T[M].structureDetails=i}let f=((null==(o=null==(a=p.drawDefinitions)?void 0:a.find((e=>e.drawId===M)))?void 0:o.structures)??[]).map((({stage:e})=>e));if(m.length){for(let e of m)s[e]={published:!0};for(let e of f)s[e]||(s[e]={published:!1})}if(m.length||c.length){for(let e of c)s[e]={published:!1};for(let e of f)s[e]||(s[e]={published:!0})}(m.length||c.length)&&(T[M].stageDetails=s)}kb({statusObject:{drawDetails:T},removePriorValues:u,status:c,event:p});let{topics:P}=sa(),D=P.includes(ud),b=D||e.returnEventData?null==(s=cD({includePositionAssignments:l,usePublishState:!0,tournamentRecord:d,policyDefinitions:v,event:p}))?void 0:s.eventData:void 0;return D&&ia({payload:{eventData:b,tournamentId:d.tournamentId},topic:ud}),{...Be,eventData:b}}be(Ob,{addDrawDefinition:()=>iM,addEvent:()=>pM,addFlight:()=>dM,assignSeedPositions:()=>nM,attachFlightProfile:()=>rM,deleteDrawDefinitions:()=>jb,deleteEvents:()=>lM,deleteFlightAndFlightDraw:()=>eM,deleteFlightProfileAndFlightDraws:()=>Vb,modifyEvent:()=>uM,modifyEventMatchUpFormatTiming:()=>Wb,modifyPairAssignment:()=>tM,refreshEventDrawOrder:()=>Xb,removeEventMatchUpFormatTiming:()=>Hb,removeScaleValues:()=>aM,removeSeeding:()=>sM,setEventDates:()=>Jb,setEventDisplay:()=>oM,setEventEndDate:()=>Kb,setEventStartDate:()=>Yb,updateDrawIdsOrder:()=>Zb,validateCategory:()=>eU});var xb="deleteDrawDefinitions",Lb="autoSchedulingAudit",_b="deleteEvents",Bb={AUTO_SCHEDULING_AUDIT:Lb,DELETE_EVENTS:_b,DELETE_DRAW_DEFINITIONS:xb};function jb(e){var t,i,n;if(!e.tournamentRecord)return{error:We};let r="deleteDrawDefinitions",a=e.drawIds??[],o=e.event,{autoPublish:s=!0,tournamentRecord:l,auditData:u,eventId:d,force:c}=e,{appliedPolicies:p}=jc({tournamentRecord:l,event:o}),m={...p,...e.policyDefinitions},f=Array.isArray(a)?a[0]:void 0;if(!o){let e=hm({tournamentRecord:l,eventId:d,drawId:f});if(e.error)return e;o=e.event}let h=[],v=[],g=[];if(null==o||!o.drawDefinitions)return Sa({info:"event has no drawDefinition",result:{...Be},stack:r});let I=o.drawDefinitions.map((({drawId:e})=>e));if(a.length||(a=I),a=a.filter((e=>I.includes(e))),!a.length)return Sa({info:"nothing to do; no matching drawIds in event.",result:{...Be},stack:r});let U,y=Wo(fm({event:o}).flightProfile,!1,!0),S=({participantId:e,drawPosition:t,qualifier:i,bye:n})=>({bye:n,qualifier:i,drawPosition:t,participantId:e}),w=c??(null==(i=null==(t=null==p?void 0:p[rs])?void 0:t.allowDeletionWithScoresPresent)?void 0:i.drawDefinitions),T=lh({event:o})??{},P=T.drawIds??(T.drawDetails&&Object.keys(T.drawDetails))??[],D=[],b=o.drawDefinitions.filter((e=>{var t,i,n,r,s,c,p,m;if(a.includes(e.drawId)){let a=(null==(t=Cf({event:o,drawDefinition:e}))?void 0:t.matchUps)??[];if(a.some((({score:e})=>kf({score:e})))&&!w)return D.push(e.drawId),!0;let{drawId:f,drawType:I,drawName:T}=e,b=null==(i=null==y?void 0:y.flights)?void 0:i.find((t=>t.drawId===e.drawId));b&&(b.drawEntries=null==(n=b.drawEntries)?void 0:n.filter((e=>wc.includes(e.entryStatus)))),P.includes(f)&&(P=P.filter((e=>e!==f)),U=!0);let M=null==(s=null==(r=Bu({stageSequence:1,drawDefinition:e,stage:xl}))?void 0:r.structures)?void 0:s[0],N=null==(p=null==(c=M?$y({structureId:M.structureId,tournamentRecord:l,drawDefinition:e}):void 0)?void 0:c.positionAssignments)?void 0:p.map(S),R=null==(m=Bu({stage:Ll,drawDefinition:e}))?void 0:m.structures,A=null!=R&&R.length?R.map((t=>{var i;let n=t.stageSequence;return{positionAssignments:null==(i=$y({structureId:t.structureId,tournamentRecord:l,drawDefinition:e}))?void 0:i.positionAssignments.map(S),stageSequence:n}})):void 0,E={action:xb,payload:{drawDefinitions:[e],eventId:d??(null==o?void 0:o.eventId),auditData:u}};g.push(E),h.push(ya({tournamentId:l.tournamentId,eventId:d??(null==o?void 0:o.eventId),qualifyingPositionAssignments:A,positionAssignments:N,auditData:u,drawType:I,drawName:T,drawId:f})),null==a||a.forEach((({matchUpId:e})=>v.push(e)))}return!a.includes(e.drawId)}));if(D.length&&!c)return Sa({context:{drawIdsWithScoresPresent:D},result:{error:Qn},stack:r});if(o.drawDefinitions=b,y&&gs({event:o,extension:{name:Fs,value:y}}),UD({tournamentRecord:l}),U){let e={};for(let i of P)e[i]=(null==(n=T.drawDetails)?void 0:n[i])??{published:!0};let t=kb({statusObject:{drawDetails:e},event:o});if(t.error)return{error:t.error}}if(g.length&&ia({topic:Yu,payload:g}),v.length&&Ud({tournamentId:null==l?void 0:l.tournamentId,matchUpIds:v}),a.forEach((e=>{!function({tournamentId:e,eventId:t,drawId:i}){ia({payload:{drawId:i,tournamentId:e,eventId:t},topic:Qu,key:i}),aa({key:i})}({drawId:e})})),function({event:e,deletedDrawsDetail:t,auditData:i}){let{extension:n}=Ds({name:Os,element:e}),r={...i,deletedDrawsDetail:t},a={name:Os,value:Array.isArray(null==n?void 0:n.value)?null==n?void 0:n.value.concat(r):[r]};fs({element:e,extension:a})}({event:o,deletedDrawsDetail:h,auditData:u}),s&&U){let e=Fb({drawIdsToRemove:a,policyDefinitions:m,tournamentRecord:l,event:o});if(e.error)return{...Be,info:e.error}}return{...Be}}function Vb({autoPublish:e=!0,tournamentRecord:t,auditData:i,event:n,force:r}){var a;if(!t)return{error:We};if(!n)return{error:Et};let{flightProfile:o}=fm({event:n});if(o){let s=null==(a=o.flights)?void 0:a.map((({drawId:e})=>e)).filter(Boolean),l=jb({eventId:n.eventId,tournamentRecord:t,autoPublish:e,auditData:i,drawIds:s,event:n,force:r});return l.error?l:Ss({event:n,name:Fs})}return{...Be}}function Gb(e){let{matchUpFormat:t,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=e,o=(null==e?void 0:e.tournamentRecords)??((null==e?void 0:e.tournamentRecord)&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{};if(!Object.keys(o).length)return{error:qe};let s,l=Object.keys(o).filter((e=>!r||r===e));if(r&&!l.includes(r))return{error:Fn};for(let u of l){let e=o[u],{event:r}=hm({tournamentRecord:e,eventId:a});a&&r&&(s=!0);let l=$b({tournamentRecord:e,event:r,matchUpFormat:t,averageTimes:n,recoveryTimes:i});if(l.error)return l}return!a||s?{...Be}:{error:Ct}}function $b({tournamentRecord:e,recoveryTimes:t,matchUpFormat:i,averageTimes:n,event:r}){if(!e)return{error:We};if(n&&!Array.isArray(n))return{error:Fn};if(t&&!Array.isArray(t))return{error:Fn};let a=qs;if(r){let{extension:e}=Ds({element:r,name:a});fs({element:r,extension:{name:a,value:qb({...(null==e?void 0:e.value)||{},matchUpFormat:i,averageTimes:n,recoveryTimes:t})}})}else{let{extension:r}=Ds({element:e,name:a});fs({extension:{name:a,value:qb({...(null==r?void 0:r.value)||{},matchUpFormat:i,averageTimes:n,recoveryTimes:t})},element:e})}return{...Be}}function qb(e){let{matchUpRecoveryTimes:t=[],matchUpAverageTimes:i=[],matchUpFormat:n}=e,{averageTimes:r,recoveryTimes:a}=e;r=(r||[]).filter((e=>{var t,i;return(null==(t=null==e?void 0:e.categoryNames)?void 0:t.length)||(null==(i=null==e?void 0:e.categoryTypes)?void 0:i.length)}));let o=(null==r?void 0:r.length)&&i.map((e=>{var t;return null!=e&&e.matchUpFormatCodes.includes(n)?{...e,matchUpFormatCodes:null==(t=e.matchUpFormatCodes)?void 0:t.filter((e=>e!==n))}:e})).filter((({matchUpFormatCodes:e})=>null==e?void 0:e.length)).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter((e=>{var t,i;return(null==(t=null==e?void 0:e.categoryNames)?void 0:t.length)||(null==(i=null==e?void 0:e.categoryTypes)?void 0:i.length)}));let s=(null==a?void 0:a.length)&&t.map((e=>{var t;return null!=e&&e.matchUpFormatCodes.includes(n)?{...e,matchUpFormatCodes:null==(t=e.matchUpFormatCodes)?void 0:t.filter((e=>e!==n))}:e})).filter((({matchUpFormatCodes:e,averageTimes:t})=>(null==e?void 0:e.length)||t)).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(null==o?void 0:o.length)&&o||i,matchUpRecoveryTimes:(null==s?void 0:s.length)&&s||t}}function Wb(e){let{tournamentRecord:t,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:o,event:s}=e;if(!t)return{error:We};if(!JI({matchUpFormat:r}))return{error:Fn};if(!s)return{error:Et};let{averageTimes:l=[],recoveryTimes:u=[]}=_D({tournamentRecord:t,matchUpFormat:r,event:s}),d=s.category,c=(null==d?void 0:d.categoryName)||(null==d?void 0:d.ageCategoryCode)||(null==s?void 0:s.eventId),p={categoryNames:[c],minutes:{}},m={categoryNames:[c],minutes:{}},f=e=>{var t,i;if(null!=(t=e.categoryTypes)&&t.includes(a)&&console.log("encountered:",{categoryType:a}),null==(i=e.categoryNames)||!i.includes(c)||(e.categoryNames=e.categoryNames.filter((e=>e!==c)),p={minutes:e.minutes,categoryNames:[c]},e.categoryNames.length))return e},h=n&&!isNaN(rr(n)),v=i&&!isNaN(rr(i)),g=l.map(f).filter((e=>{var t;return null==(t=null==e?void 0:e.categoryNames)?void 0:t.length})),I=u.map(f).filter((e=>{var t;return null==(t=null==e?void 0:e.categoryNames)?void 0:t.length}));return h&&(Object.assign(p.minutes,{[(null==s?void 0:s.eventType)||Ad]:n}),g.push(p)),v&&(Object.assign(m.minutes,{[(null==s?void 0:s.eventType)||Ad]:i}),I.push(m)),h||v?Gb({averageTimes:h&&g,recoveryTimes:v&&I,tournamentRecord:t,matchUpFormat:r,eventId:o,event:s}):{error:Fn}}function Hb(e){if(e.event)return zb({event:e.event});{e.tournamentRecord&&!e.tournamentRecords&&(e.tournamentRecords={[e.tournamentRecord.tournamentId]:e.tournamentRecord});let t=io(e,[{[wa]:!0,[ja]:!0}]);if(t.error)return t;let{tournamentRecords:i,eventId:n}=e;for(let e of Object.values(i??{})){let{event:t}=hm({tournamentRecord:e,eventId:n});if(t)return zb({event:t})}}return{error:Ct}}function zb({event:e}){return Ss({event:e,name:qs})}function Yb({tournamentRecord:e,event:t,startDate:i}){if(!e)return{error:We};if(!t)return{error:Et};if(!ho.test(i))return{error:Ui};let n=Qb(e);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Co(i)).getTime();if(!r||!a||o<r||o>a)return{error:Ui};let s=t.endDate&&new Date(Co(t.endDate)).getTime();return s&&o>s&&(t.endDate=i),t.startDate=i,{...Be}}function Kb({tournamentRecord:e,event:t,endDate:i}){if(!e)return{error:We};if(!t)return{error:Et};if(!ho.test(i))return{error:Ui};let n=Qb(e);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Co(i)).getTime();if(!r||!a||o<r||o>a)return{error:Ui};let s=t.startDate&&new Date(Co(t.startDate)).getTime();return s&&o<s&&(t.startDate=i),t.endDate=i,{...Be}}function Jb({tournamentRecord:e,event:t,startDate:i,endDate:n}){if(!e)return{error:We};if(!t)return{error:Et};if(!i&&!n)return{error:mi,info:"missing date"};if(i&&!ho.test(i))return{error:Ui};if(n&&!ho.test(n))return{error:Ui};if(i&&n){if(new Date(Co(i)).getTime()>new Date(Co(n)).getTime())return{error:Fn}}if(i){let n=Yb({tournamentRecord:e,event:t,startDate:i});if(n.error)return n}if(n){let i=Kb({tournamentRecord:e,event:t,endDate:n});if(i.error)return i}return{...Be}}function Qb(e){let{startDate:t,endDate:i}=e;return ho.test(t)&&ho.test(i)?{tournamentStartDate:new Date(Co(t)).getTime(),tournamentEndDate:new Date(Co(i)).getTime()}:Sa({result:{error:Si},context:{startDate:t,endDate:i}})}function Zb({event:e,orderedDrawIdsMap:t}){var i,n;if("object"!=typeof e)return{error:Et};if(!t)return{error:mi,info:"Missing drawIdsOrderMap"};if("object"!=typeof t)return{error:Fn,info:"orderedDrawIdsMap must be an object"};let r=Object.values(t);if(!r.every((e=>!isNaN(e))))return{error:Fn,info:"drawOrder must be numeric"};if(hr(r).length!==r.length)return{error:Fn,info:"drawOrder values must be unique"};if(null!=(i=e.drawDefinitions)&&i.length){let i=(e.drawDefinitions||[]).map((({drawId:e})=>e)),n=Object.keys(t);if(null!=n&&n.length&&Nr(i,n).length!==i.length)return{error:Fn,info:"Missing drawIds"};e.drawDefinitions.forEach((e=>{e.drawOrder=t[e.drawId]}))}let{flightProfile:a}=fm({event:e});return null==(n=null==a?void 0:a.flights)||n.forEach((e=>{e.flightNumber=t[e.drawId]})),{...Be}}function Xb({tournamentRecord:e,event:t}){var i;if(!e)return{error:We};if(!t)return{error:Et};let{flightProfile:n}=fm({event:t}),r=(null==n?void 0:n.flights)&&Object.assign({},...n.flights.sort(((e,t)=>e.flightNumber-t.flightNumber)).map(((e,t)=>({[e.drawId]:t+1}))))||(null==(i=t.drawDefinitions)?void 0:i.length)&&Object.assign({},...t.drawDefinitions.sort(((e,t)=>e.drawOrder-t.drawOrder)).map(((e,t)=>({[e.drawId]:t+1}))))||void 0;return r?Zb({event:t,orderedDrawIdsMap:r}):{...Be}}function eM({autoPublish:e=!0,tournamentRecord:t,auditData:i,drawId:n,event:r,force:a}){var o,s;if(!t)return{error:We};if(!n)return{error:mt};if(!r)return{error:Et};let{flightProfile:l}=fm({event:r});if(l&&null!=(o=l.flights)&&o.find((e=>e.drawId===n))){let e=l.flights.filter((e=>e.drawId!==n));gs({event:r,extension:{name:Fs,value:{...l,flights:e}}})}if(null!=(s=r.drawDefinitions)&&s.find((e=>e.drawId===n))){let o=jb({drawIds:[n],eventId:r.eventId,tournamentRecord:t,autoPublish:e,auditData:i,event:r,force:a});if(o.error)return o}return Xb({tournamentRecord:t,event:r})}function tM({replacementIndividualParticipantId:e,existingIndividualParticipantId:t,tournamentRecord:i,drawDefinition:n,participantId:r,event:a,uuids:o}){var s,l;if(!a)return{error:Et};if((null==a?void 0:a.eventType)!==Vp)return{error:At};if(o&&!Array.isArray(o))return{error:Fn};if(!i)return{error:We};if(![e,t,r].every((e=>"string"==typeof e)))return{error:_i};if(!((null==(s=null==a?void 0:a.entries)?void 0:s.filter((({entryStatus:e})=>[hc,vc].includes(e))).map((({participantId:e})=>e)))||[]).includes(e))return{error:Ei};let u=(i.participants||[]).find((e=>e.participantId===r));if((null==u?void 0:u.participantType)!==Xd)return{error:Ai,participant:u};let d,c=u.individualParticipantIds,p=[e,...c.filter((e=>e!==t))],{participant:m}=Pm({participantIds:p,tournamentRecord:i});if(m)d=m.participantId;else{let e=Nb({participant:{participantId:null==o?void 0:o.pop(),participantRole:Ah,individualParticipantIds:p,participantType:Xd},returnParticipant:!0,tournamentRecord:i});if(e.error)return e;d=e.participant.participantId}let{flightProfile:f}=fm({event:a});if(n){let e=null==(l=null==f?void 0:f.flights)?void 0:l.find((({drawId:e})=>e===n.drawId));e&&(e.drawEntries=e.drawEntries.map((e=>e.participantId===r?{...e,participantId:d}:e))),n.entries=n.entries.map((e=>e.participantId===r?{...e,participantId:d}:e));for(let t of n.structures||[])if(t.positionAssignments)t.positionAssignments=t.positionAssignments.map((e=>e.participantId===r?{...e,participantId:d}:e));else if(t.structures)for(let e of t.structures)e.positionAssignments=e.positionAssignments.map((e=>e.participantId===r?{...e,participantId:d}:e))}a.entries=a.entries.map((i=>i.participantId===r&&{...i,participantId:d}||i.participantId===e&&{...i,participantId:t}||i));let h=i.events.some((({entries:e,eventId:t,drawDefinitions:i})=>a.eventId===t?i.some((({drawId:e,entries:t})=>e!==(null==n?void 0:n.drawId)&&(null==t?void 0:t.find((e=>e.participantId===r))))):null==e?void 0:e.find((e=>e.participantId===r))));if(!h){let e=jh({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(e.error)return e}return{...Be,participantOtherEntries:h,newPairParticipantId:d}}function iM(e){var t,i,n,r,a,o,s,l,u,d,c,p;let{flight:m,suppressNotifications:f,modifyEventEntries:h,existingDrawCount:v,allowReplacement:g,checkEntryStatus:I,tournamentRecord:U,drawDefinition:y,event:S}=e;if(!y)return{error:Ke};if(!S)return{error:Et};S.drawDefinitions||(S.drawDefinitions=[]);let{drawId:w,drawName:T,entries:P}=y,{entries:D}=S,b=0;if(void 0!==v&&v!==S.drawDefinitions.length)return{error:Fn,info:"drawDefintions count mismatch"};let{flightProfile:M}=fm({event:S}),N=m&&(null==(t=null==M?void 0:M.flights)?void 0:t.find((e=>e.flightNumber===m.flightNumber))),R=null==(r=null==(n=null==(i=null==M?void 0:M.links)?void 0:i.find((e=>{var t;return(null==(t=null==e?void 0:e.target)?void 0:t.drawId)===w})))?void 0:n.source)?void 0:r.drawId;if(R&&!S.drawDefinitions.find((e=>e.drawId===R)))return Sa({result:{error:Ke},info:{sourceDrawId:R}});if(N&&N.drawId!==y.drawId)return Sa({result:{error:Ye},info:{relevantFlight:N}});let A=null==P?void 0:P.every((({participantId:e,entryStatus:t})=>{let i=null==N?void 0:N.drawEntries.find((t=>t.participantId===e));return!t||(null==i?void 0:i.entryStatus)===t})),E=!I||D&&(null==P?void 0:P.every((({participantId:e,entryStatus:t,entryStage:i})=>{var n;return(null==(n=D.find((t=>t.participantId===e&&(!t.entryStage||t.entryStage===i))))?void 0:n.entryStatus)===t})));if(N&&!A)return Sa({result:{error:Ye},context:{drawEntriesPresentInFlight:A,matchingEventEntries:E,relevantFlight:N},info:"Draw entries are not present in flight or do not match entryStatuses"});if(h&&(null==P||P.filter(Boolean).forEach((e=>{if(null!=e&&e.entryStatus&&wc.includes(null==e?void 0:e.entryStatus)){let t=null==D?void 0:D.filter(Boolean).find((t=>t.participantId===e.participantId));t&&e.entryStatus&&(null==t?void 0:t.entryStatus)!==e.entryStatus&&(t.entryStatus=e.entryStatus,b+=1)}}))),D&&!E)return Sa({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:E,eventEntries:D},error:Ye}});let C,O=(null==(o=null==(a=null==M?void 0:M.flights)?void 0:a.map((({flightNumber:e})=>!isNaN(e)&&rr(e))))?void 0:o.filter(Boolean))||[],k=(null==(s=S.drawDefinitions.map((({drawOrder:e})=>e&&rr(e))))?void 0:s.filter(Boolean))||[],F=Math.max(0,...k,...O)+1,x=null==(l=null==M?void 0:M.flights)?void 0:l.find((e=>e.drawId===w));if(x){x.drawName=y.drawName,C={name:Fs,value:{...M,flights:M.flights}};let e=x.flightNumber;e&&!k.includes(e)?F=e:x.flightNumber=F}else{let e=(null==M?void 0:M.flights)||[];e.push({manuallyAdded:!0,flightNumber:F,drawEntries:P,drawName:T,drawId:w}),C={name:Fs,value:{...M||{},flights:e}}}gs({event:S,extension:C}),Object.assign(y,{drawOrder:F});let L=S.drawDefinitions.find((e=>e.drawId===w)),_=null==U?void 0:U.tournamentId,B=S.eventId;if(L){if(!g)return{error:ft};let e=(null==(d=null==(u=Cf({drawDefinition:L}))?void 0:u.matchUps)?void 0:d.map(ll))??[],t=null==(c=Cf({drawDefinition:y}))?void 0:c.matchUps;if(!f){null!=e&&e.length&&Ud({matchUpIds:e,action:"modifyDrawDefinition",tournamentId:_,eventId:B}),null!=t&&t.length&&Id({matchUps:t,tournamentId:_,eventId:B}),S.drawDefinitions=S.drawDefinitions.map((e=>e.drawId===w?y:e));let i=null==(p=y.structures)?void 0:p.map((({structureId:e})=>e));wd({drawDefinition:y,tournamentId:_,structureIds:i,eventId:B})}}else if(S.drawDefinitions.push(y),!f){let{matchUps:e}=Cf({drawDefinition:y,event:S});e&&Id({tournamentId:null==U?void 0:U.tournamentId,matchUps:e}),Sd({drawDefinition:y,tournamentId:_,eventId:B})}return{...Be,modifiedEventEntryStatusCount:b}}function nM(e){let{provisionalPositioning:t,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:u}=e,d=0;if(null==s||!s.length)return{error:xt};if(!n)return{error:We};if(!l)return{error:mt};let c=Nc({provisionalPositioning:t,drawDefinition:r,structureId:o});if(c.error)return c;let{seedAssignments:p,seedLimit:m}=c,f=Object.assign({},...(p??[]).filter((e=>e.seedNumber)).map((e=>({[e.seedNumber]:e}))));s.forEach((e=>{let{seedNumber:t}=e;m&&t<=m&&(!i||f[t])&&(f[t]=e)}));let h=Object.values(f),v=h.map((e=>null==e?void 0:e.participantId)).filter(Boolean);if(v.length!==Tr(v).length)return{error:ht};for(let g of h){let e=fv({...g,provisionalPositioning:t,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,event:u});if(null!=e&&e.error)return e;null!=e&&e.success&&d++}return d?{...Be,modifications:d}:{error:Mn}}function rM({deleteExisting:e,event:t,flightProfile:i}){var n;let r="attachFlightProfile";if(!i)return Sa({result:{error:mi},stack:r});if(!t)return Sa({result:{error:Et},stack:r});let{flightProfile:a}=fm({event:t});return a&&!e?Sa({result:{error:qn},stack:r}):null!=(n=t.drawDefinitions)&&n.length?Sa({result:{error:Je},stack:r}):(gs({event:t,extension:{name:Fs,value:i}}),{flightProfile:Wo(i,!1,!0),...Be})}function aM({tournamentRecord:e,scaleAttributes:t,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:o}){var s;if(!a)return{error:Et};if(n&&!Array.isArray(n))return Sa({result:{error:Fn},info:Tv("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(r){let{flightProfile:e}=fm({event:a}),t=null==(s=null==e?void 0:e.flights)?void 0:s.find((e=>e.drawId===r));l=t?t.drawEntries:null==i?void 0:i.entries}return function({tournamentRecord:e,scaleAttributes:t,participantIds:i}){var n;if(!e)return{error:We};if(!i)return{error:Gi};if(!t)return{error:mi,info:"scaleAttributes required"};let{scaleType:r,eventType:a,scaleName:o}=t,s=[pp,r,a,o].join(".");return null==(n=e.participants)||n.forEach((e=>{i.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter((e=>e&&(null==e?void 0:e.itemType)!==s)))})),{...Be}}({tournamentRecord:e,scaleAttributes:t,participantIds:(l||[]).filter((e=>(!o||!e.entryStage||e.entryStage===o)&&(!n||n.includes(e.entryStatus)))).map(sl)})}function oM({removePriorValues:e,tournamentRecord:t,displaySettings:i,status:n=gp,event:r}){if(!t)return Sa({result:{error:We}});if(!r)return Sa({result:{error:Et}});if(!Ce(i))return Sa({result:{error:mi}});if(Ce(i.draws))for(let o of Object.keys(i.draws)){let e=i.draws[o].scheduleDetails??[];if(e.length){let t=[];for(let i of e){let e=t.find((e=>Oe(e.attributes,i.attributes)));null!=e&&e.dates&&i.dates?e.dates.push(...i.dates):t.push(i)}i.draws[o].scheduleDetails=t}}let a=kb({statusObject:{displaySettings:i},removePriorValues:e,status:n,event:r});return a.error?a:{...Be}}function sM({tournamentRecord:e,drawDefinition:t,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:o}){var s,l;if(!e)return{error:We};if(!a)return{error:Et};return n=n||(null==(s=a.category)?void 0:s.categoryName)||(null==(l=a.category)?void 0:l.ageCategoryCode),aM({tournamentRecord:e,scaleAttributes:{eventType:a.eventType,scaleType:lo,scaleName:n},drawDefinition:t,entryStatuses:i,drawId:r,event:a,stage:o})}function lM({removePairParticipants:e,tournamentRecord:t,eventIds:i}){if(!t)return{error:We};if(!t.events)return{error:Ct};if(!Array.isArray(i))return{error:mi,info:Tv("drawIds")};let n=[],r=[],a=[],o=[];if(t.events=(t.events||[]).filter((e=>{if(i.includes(e.eventId)){let i={action:_b,payload:{events:[e]}};n.push(i),r.push({tournamentId:t.tournamentId,eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}let s=e.eventType===Vp?(e.entries||[]).map((({entryStatus:e,participantId:t})=>e!==hc&&t)).filter(Boolean):[],l=i.includes(e.eventId);return l?o.push(...s):a.push(...s),!l})),e){let e=o.filter((e=>!a.includes(e)));t.participants=t.participants.filter((({participantId:t})=>!e.includes(t)))}return UD({tournamentRecord:t}),n.length&&(ia({topic:Yu,payload:n}),wg({tournamentRecord:t,timeItem:{itemType:_b,itemValue:r}})),{...Be}}function uM({tournamentRecord:e,eventUpdates:t,eventId:i,event:n}){var r;let a="modifyEvent";if(!e)return Sa({result:{error:We},stack:a});if(!Ee(i))return Sa({result:{error:Et},context:{eventId:i},stack:a});if(!Ce(t))return Sa({result:{error:Fn},context:{eventUpdates:t},stack:a});let o=(null==(r=null==n?void 0:n.entries)?void 0:r.filter((({entryStatus:e})=>{let t=e;return[...wc,oc].includes(t)})).map((({participantId:e})=>e)))??[],s=o?vh({participantFilters:{participantIds:o},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[],l=[],u=s.reduce(((e,t)=>{var i,n;let r=null!=(i=t.person)&&i.sex?[t.person.sex]:(null==(n=t.individualParticpants)?void 0:n.map((e=>{var t;return null==(t=e.person)?void 0:t.sex})))||[];return l.push(...r),e.includes(t.participantType)?e:e.concat(t.participantType)}),[]),d=hr(l),c=!d.length||[Ym,Hm].includes(t.gender??"")||1===d.length&&d[0]===t.gender;if(t.gender&&!c)return Sa({context:{gender:t.gender,validGender:c},result:{error:Fn},stack:a});let p=(u.includes($p)&&[$p]||u.includes(Qd)&&[Bp]||u.includes(Xd)&&[Vp]||[Vp,Bp,$p]).includes(t.eventType??"");return t.eventType&&!p?Sa({context:{participantType:t.eventType,validEventType:p},result:{error:Fn},stack:a}):(t.eventType&&(n.eventType=t.eventType),t.eventName&&(n.eventName=t.eventName),t.gender&&(n.gender=t.gender),{...Be})}function dM({qualifyingPositions:e,drawEntries:t=[],drawName:i,drawId:n,event:r,stage:a}){var o,s,l;let u="addFlight";if(!r)return Sa({result:{error:Et},stack:u});if(!i)return Sa({result:{error:mi},stack:u});if(null!=t&&t.length){let e=(r.entries??[]).map(sl),i=t.map(sl);if(Nr(i,e).length!==i.length)return Sa({result:{error:Fn},stack:u})}let d=null==(o=fm({event:r}))?void 0:o.flightProfile,c=(null==(l=null==(s=null==d?void 0:d.flights)?void 0:s.map((({flightNumber:e})=>!isNaN(e)&&rr(e))))?void 0:l.filter(Boolean))||[],p=Math.max(0,...c)+1,m={drawId:n||am(),flightNumber:p,drawEntries:t,drawName:i};if(a&&(m.stage=a),e&&(m.qualifyingPositions=e),((null==d?void 0:d.flights)||[]).find((({drawId:e})=>e===m.drawId)))return Sa({result:{error:$n},stack:u});let f=((null==d?void 0:d.flights)||[]).concat(m);return gs({event:r,extension:{name:Fs,value:{...d||{},flights:f}}})}var cM={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:ET,DOMINANT_DUO_MIXED:MT,LAVER_CUP:xT,TEAM_DOUBLES_3_AGGREGATION:wT,TIME_TENNIS_DUAL:NT,TIME_TENNIS_PRO_CIRCUIT:bT,USTA_BREWER_CUP:RT,USTA_OZAKI_CUP:AT,USTA_COLLEGE:CT,USTA_GOLD_TEAM_CHALLENGE:ST,USTA_INTERSECTIONAL:DT,USTA_LEVEL_1:OT,USTA_SECTION_BATTLE:PT,USTA_SOUTHERN_LEVEL_5:TT,USTA_TOC:LT,USTA_WTT_ITT:kT,USTA_ZONAL:FT};function pM({suppressNotifications:e,tournamentRecord:t,internalUse:i,event:n}){var r,a,o,s;if(!t)return{error:We};if(t.events||(t.events=[]),!n)return{error:Et};let{startDate:l,endDate:u}=t;if(!i&&(null!=(r=n.entries)&&r.length||null!=(a=n.drawDefinitions)&&a.length)){let e=ya({drawDefinitions:!(null==(o=n.drawDefinitions)||!o.length),entries:!(null==(s=n.entries)||!s.length)});return{info:"entries/drawDefinitions cannot exist",error:Fn,context:e}}let d={eventType:jp,drawDefinitions:[],entries:[],startDate:l,endDate:u,...n};if(n.eventType===qp)if(n.tieFormat){let e=nU({tieFormat:n.tieFormat});if(e.error)return e}else if(n.tieFormatName){if(!cM[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Fn};let e=sP({isMock:null==t?void 0:t.isMock,namedFormat:n.tieFormatName,event:n});d.tieFormat=e}if(d.eventId||(d.eventId=am()),t.events.reduce(((e,t)=>e||t.eventId===d.eventId),void 0))return{error:Ot};{let i=d;if(t.events.push(i),!e){let{topics:e}=sa();if(e.includes(qu)){let e=Nf({event:n}).matchUps??[];Id({tournamentId:null==t?void 0:t.tournamentId,eventId:n.eventId,matchUps:e})}for(let t of n.drawDefinitions||[])Sd({drawDefinition:t})}return{...Be,event:d}}}var mM={};be(mM,{drawMatic:()=>pP,garman:()=>TM,generateAdHocMatchUps:()=>vS,generateAdHocRounds:()=>dP,generateAndPopulatePlayoffStructures:()=>cU,generateCourts:()=>wM,generateDrawDefinition:()=>gb,generateDrawMaticRound:()=>bS,generateDrawStructuresAndLinks:()=>eS,generateDrawTypeAndModifyDrawDefinition:()=>tS,generateFlightProfile:()=>gM,generateLineUps:()=>SM,generateQualifyingStructure:()=>Bg,generateSeedingScaleItems:()=>Ib,generateVoluntaryConsolation:()=>MS,roundRobinGroups:()=>tv});var fM="splitWaterfall",hM="splitShuttle",vM={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:fM,SPLIT_SHUTTLE:hM};function gM(e){let{drawNameRoot:t="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:u,splitMethod:d,uuids:c=[],event:p,stage:m}=e;if(!p)return{error:Et};let f=p.entries??[],{flightProfile:h}=fm({event:p});if(h&&i&&!o)return{error:qn};let v=e.scaledEntries??fP({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,g=v.map(sl),I=gr(f.filter((({participantId:e})=>!g.includes(e))).filter((e=>(!m||!e.entryStage||e.entryStage===m)&&(!e.entryStatus||Sc.includes(e.entryStatus))))),U=v.concat(...I),y=U.length,S=Or(U,Math.ceil(y/u));function w(e){return(e||[]).map((({participantId:e,scaleValue:t})=>{let i=f.find((t=>t.participantId===e));return null!=i&&i.scaleValue&&t&&(i.scaleValue=t),i})).sort(((e,t)=>e.scaleValue-t.scaleValue)).map(((e,t)=>(e.scaleValue&&(e.seedNumber=t+1),e)))}d===fM?S=Lr(U,u):d===hM&&(S=Lr(U,u,!0));let T={scaleAttributes:r,splitMethod:d,flights:br(0,u).map((e=>{let i=e+1;return{flightNumber:i,drawId:(null==c?void 0:c.pop())??am(),drawEntries:w(S[e]),drawName:(null==l?void 0:l.length)&&l[e]||`${t} ${i}`}}))};if(i){let e=rM({flightProfile:T,deleteExisting:o,event:p});return{splitEntries:$r()&&S||void 0,...e}}return{flightProfile:T,...Be}}var IM="ASC",UM="DESC",yM={ASC:"ASC",ASCENDING:IM,DESC:"DESC",DESCENDING:UM};function SM(e){var t,i,n,r,a;let{tieFormat:o}=e,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:u,scaleAccessor:d,singlesOnly:c,attach:p,event:m}=e;if((null==m?void 0:m.eventType)!==qp)return{error:At};if(!l)return{error:We};if(!o&&!u)return{error:Qe};if(o=o??(null==(t=Um({drawDefinition:u,event:m}))?void 0:t.tieFormat),nU({tieFormat:o}).error)return{error:Ht};if("object"!=typeof d&&!s)return{error:Fn,context:{scaleAccessor:d}};let f={},h=((null==u?void 0:u.entries)??(null==m?void 0:m.entries)??[]).filter((e=>(null==e?void 0:e.entryStatus)===lc)).map(sl),{participants:v=[]}=vh({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),g=v.filter((({participantId:e})=>h.includes(e))),I=(null==(i=null==m?void 0:m.category)?void 0:i.categoryName)??(null==(n=null==m?void 0:m.category)?void 0:n.ageCategoryCode),{scaleName:U=I,scaleType:y=ao,sortOrder:S,accessor:w}=d||{},T=y===ao?"rankings":"ratings",P=(e,t)=>{var i,n,r;let a=null==(i=e[T])?void 0:i[t];if(!a&&s&&(a=null==(n=e[T])?void 0:n[Rd]),Array.isArray(a)){let e=null==(r=a.find((e=>e.scaleName===U)))?void 0:r.scaleValue;if(ur(e))return e;if(w&&"object"==typeof e)return e[w]}return 0},D=(e,t,i)=>{let n=S===UM?e:t;return P(S===UM?t:e,i)-P(n,i)},b=(e,t)=>D(e,t,Rd),M=(e,t)=>D(e,t,Ed),N=[],R=(null==o?void 0:o.collectionDefinitions)??[];for(let E of g){let e=(null==(r=E.individualParticipants)?void 0:r.sort(b))??[],t=c?e:(null==(a=E.individualParticipants)?void 0:a.sort(M))??[],i={};for(let r of R){let n=[],{collectionId:a,matchUpCount:o,matchUpType:s,gender:l}=r,u=wp(Rd)(s);br(0,o).forEach((r=>{let o=u?e:t??[],s=r+1,d=[];br(0,u?1:2).forEach((e=>{var t;let r=null==(t=null==o?void 0:o.find((t=>{var i;let r=l&&([zm,Jm].includes(l)&&l||l===Ym&&[zm,Jm][e]);return!(r&&r!==(null==(i=t.person)?void 0:i.sex)||n.includes(t.participantId))})))?void 0:t.participantId;r&&(d.push(r),n.push(r),i[r]||(i[r]=[]),i[r].push({collectionPosition:s,collectionId:a}))})),u||N.push(d)}))}let n=Object.keys(i).map((e=>({collectionAssignments:i[e],participantId:e})));f[E.participantId]=n}let A=[];for(let E of N){let{participant:e}=Pm({tournamentParticipants:v,participantIds:E});if(!e){let e={individualParticipantIds:E,participantRole:Ah,participantType:Xd};A.push(e)}}if(p){for(;A.length;)Nb({participant:A.pop(),tournamentRecord:l});fs({element:u,extension:{name:Ls,value:f}})}return{...Be,lineUps:f,participantsToAdd:A}}function wM(e){if(!e)return{error:mi};let t=io(e,[{dates:!1,[Ya]:e=>Array.isArray(e)&&e.every(yo)},{uuids:!1,[Ya]:e=>Array.isArray(e)&&e.every(Ee)},{startTime:!1,endTime:!1,[Ya]:No},{idPrefix:!1,namePrefix:!1,[Ya]:Ee},{count:!0,[Ya]:ur}]);if(t.error)return t;let{startDate:i,endDate:n}=e.tournamentRecord??{},r=e.dates||i&&n&&Do(i,n)||[],a=br(1,e.count+1).map((t=>{var i,n;return ya({courtId:(null==(i=e.uuids)?void 0:i.pop())??(e.idPrefix&&`${e.idPrefix}-${t}`)??am(),courtName:(null==(n=e.courtNames)?void 0:n.pop())??(e.namePrefix&&`${e.namePrefix} ${t}`),dateAvailability:r.map((t=>({startTime:e.startTime??"08:00",endTime:e.endTime??"20:00",date:t})))})}));return{...Be,courts:a}}var TM={};function PM({court:e,date:t}){let i=t&&e.dateAvailability.find((e=>$o(e.date,t))),n=e.dateAvailability.find((e=>!e.date));return i||n}function DM(e){let t=io(e,[{courtDate:!0,_ofType:Ha}]);if(t.error)return t;let{includeBookingTypes:i=[],courtDate:n}=e,r=[],a=_o(n.startTime);(n.bookings||[]).filter((e=>!e.bookingType||!i.includes(e.bookingType))).sort(((e,t)=>Ao(e.startTime).localeCompare(Ao(t.startTime)))).forEach((e=>{let t={startTime:Eo(a.toISOString()),endTime:e.startTime};_o(e.startTime)>a&&r.push(t),_o(e.endTime)>a&&(a=_o(e.endTime))}));let o={startTime:Eo(a.toISOString()),endTime:n.endTime};return _o(n.endTime)>a&&r.push(o),{timeSlots:r}}function bM(e){let t=io(e,[{periodStart:!0,date:!0},{courts:!0,_ofType:za}]);if(t.error)return t;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=e,o=e.courts,s=_o(r),l=Vo(s,i),{enoughTime:u}=function({averageMatchUpMinutes:e,includeBookingTypes:t,periodStartTime:i,periodEndTime:n}){function r(t){let r=_o(t.startTime),a=_o(t.endTime);return!(r>i||a<n)&&Bo(i,a)>=e}return{enoughTime:e=>{var i;let{timeSlots:n}=DM({includeBookingTypes:t,courtDate:e});return!(null==(i=null==n?void 0:n.filter(r))||!i.length)}}}({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((null==o?void 0:o.filter((e=>{if(!Array.isArray(e.dateAvailability))return!1;let t=PM({date:a,court:e});return!(!t||!u(t))})))||[]).length,...Be}}function MM(e){var t;let{remainingScheduleTimes:i=[],clearScheduleDates:n,periodLength:r=30,scheduleDate:a,courts:o=[]}=e,{bookings:s=[]}=e;if(!Array.isArray(o)||!o.length)return{error:Fn,courts:o};if(!Array.isArray(s))return{error:vi};if(!yo(a))return{error:Ui};n&&(Array.isArray(n)?n.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:u}=s.reduce(((e,t)=>{let{courtId:i}=t;return i?e.courtBookings[i]?e.courtBookings[i].push(t):e.courtBookings[i]=[t]:e.unassignedBookings.push(t),e}),{courtBookings:{},unassignedBookings:[]}),d=o.map(((e,t)=>{let{courtId:n,courtName:r}=e,o=l[n]||[],s=PM({date:a,court:e})||{},{bookings:u=[],startTime:d,endTime:c,date:p}=s;return{courtId:n,courtName:r,dateAvailability:{bookings:[i[t]&&{startTime:d,endTime:i[t]},...Wo(u,!1,!0),...o].filter(Boolean),startTime:d,endTime:c,date:p}}}));u.sort(((e,t)=>Ro(e.startTime)-Ro(t.startTime)));let c=[];for(let p of u){let{startTime:e,endTime:i,averageMinutes:n,recoveryMinutes:a,matchUpId:o}=p,s=Ro(e),l=Ro(i),u=d.map((e=>{let t=e.dateAvailability,{timeSlots:i=[]}=DM({courtDate:t});return{courtName:e.courtName,courtId:e.courtId,timeSlots:i}})).flat().reduce(((e,{courtId:t,courtName:i,timeSlots:n})=>{let a;return n.find((({startTime:t,endTime:i})=>{a=Ro(t)-s;let n=s>=Ro(t);return l<=Ro(i)&&0!==e.startDifference&&((0===a||a+r>=0)&&(void 0===e.startDifference||a<e.startDifference)||n)}))?{courtName:i,courtId:t,startDifference:a}:e}),{});if(u.courtId){let r={averageMinutes:n,recoveryMinutes:a,matchUpId:o,startTime:e,endTime:i};c.push(r),null==(t=d.find((({courtId:e})=>e===u.courtId)))||t.dateAvailability.bookings.push(r)}else console.log({unassignedBooking:p})}return{virtualCourts:d.map((({courtId:e,courtName:t,dateAvailability:i})=>({dateAvailability:[i],courtName:t,courtId:e}))),assignedBookings:c}}function NM({averageMatchUpMinutes:e,periodLength:t=30,recoveryMinutes:i}){let n=(e||90)+(i||0);return t>n?n:t||30}function RM(e){let{startTime:t="8:00",endTime:i="20:30",count:n=10,date:r}=e??{};return br(0,n).map((()=>({dateAvailability:[{date:r,startTime:t,endTime:i}]})))}function AM({scheduleDate:e,startTime:t,endTime:i,courts:n}){let r=(t?"startTime":i&&"endTime")||void 0;return n.reduce(((n,a)=>{let o=PM({date:e,court:a}),s=r&&((null==o?void 0:o[r])||a[r]);return s&&(!n||t&&Ro(s)<Ro(n)||i&&Ro(s)>Ro(n))?s:n}),void 0)}function EM(e){let t=io(e,[{courts:!0,_ofType:za}]);if(t.error)return t;let{date:i=So(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:o}=e,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:u,clearScheduleDates:d,courtsCount:c,bookings:p}=e;a=a||NM({averageMatchUpMinutes:u}),i=Co(i),n=Eo(n),r=Eo(r);let m=0,f=0,h=0,v=0,g=0;!o&&c&&(o=RM({startTime:n,endTime:r,count:c,date:i}));let{virtualCourts:I}=MM({remainingScheduleTimes:l,clearScheduleDates:d,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:U}=function({averageMinutes:e,startTime:t,endTime:i,courts:n,date:r}){let a;if(t=t||AM({courts:n,scheduleDate:r,startTime:!0}),i=i||AM({courts:n,scheduleDate:r,endTime:!0}),t&&i){let o=_o(t),s=_o(i);for(let t of n||[]){if(!Array.isArray(t.dateAvailability))continue;let i=PM({court:t,date:r}),{timeSlots:n}=DM({courtDate:i});null==n||n.forEach((t=>{let i=_o(t.startTime),n=_o(t.endTime);if(i>s||i<o||n<o)return!1;if(Bo(i,n)>=e){let e=Eo(i.toISOString());(!a||e<a)&&(a=e)}}))}}return{firstTimeSlotStartTime:a}}({averageMinutes:u,courts:I,startTime:n,endTime:r,date:i});s&&U&&(n=U||n);let y=Ro(n),S=Ro(r)-y,w=br(0,Math.floor(S/a)+1).map((e=>{let t=function(e){let t=Math.floor(e/60),i=e-60*t;return t>23&&(t%=24),[Go(t),Go(i)].join(":")}(y+e*a),n=bM({courts:I??[],averageMatchUpMinutes:u,periodStart:t,date:i});if(n.error)return{error:n.error};let{availableToScheduleCount:r=0}=n,o=r>f?r-f:0;g+=e?r:0;let s=e?g/e:r,l=e?a*s/u*(e-1)+s:s,d=r?f&&l-m||o:0;m=l,f=r,h+=d;let c=rr(h)-v;return v+=c,{periodStart:t,add:c,availableToScheduleCount:r,newCourts:o,totalMatchUps:v}}));return{scheduleTimes:w.reduce(((e,t)=>{let i=br(0,t.add).map((()=>({scheduleTime:t.periodStart})));return e.concat(...i)}),[]).flat(),timingProfile:w,totalMatchUps:v}}be(TM,{default:()=>OM,garman:()=>CM});var CM={getCourtsAvailableAtPeriodStart:bM,generateTimeSlots:DM,getScheduleTimes:EM,courtGenerator:RM},OM=CM,kM={};be(kM,{isValid:()=>JI,isValidMatchUpFormat:()=>JI,parse:()=>xm,stringify:()=>WI});var FM={};be(FM,{allCompetitionMatchUps:()=>Af,allDrawMatchUps:()=>Cf,allEventMatchUps:()=>Nf,allTournamentMatchUps:()=>Rf,analyzeMatchUp:()=>sb,applyLineUps:()=>WN,assignMatchUpSideParticipant:()=>LM,assignTieMatchUpParticipantId:()=>zM,bulkMatchUpStatusUpdate:()=>_N,calculateWinCriteria:()=>ZD,checkInParticipant:()=>jM,checkMatchUpIsComplete:()=>Xm,checkOutParticipant:()=>BM,competitionScheduleMatchUps:()=>zD,disableTieAutoCalc:()=>ON,drawMatchUps:()=>lb,enableTieAutoCalc:()=>AN,eventMatchUps:()=>qD,findMatchUp:()=>XP,getAllDrawMatchUps:()=>uf,getAllStructureMatchUps:()=>Zm,getCheckedInParticipantIds:()=>yp,getCompetitionMatchUps:()=>HD,getEventMatchUpFormatTiming:()=>LD,getMatchUpCompetitiveProfile:()=>qc,getMatchUpContextIds:()=>XD,getMatchUpDailyLimits:()=>YD,getMatchUpDailyLimitsUpdate:()=>BD,getMatchUpDependencies:()=>Of,getMatchUpFormat:()=>ib,getMatchUpFormatTiming:()=>Hp,getMatchUpFormatTimingUpdate:()=>ED,getMatchUpScheduleDetails:()=>vm,getMatchUpType:()=>Em,getMatchUpsStats:()=>nb,getModifiedMatchUpFormatTiming:()=>_D,getParticipantResults:()=>hI,getPredictiveAccuracy:()=>KD,getRoundMatchUps:()=>jd,getRounds:()=>ob,isValidMatchUpFormat:()=>JI,matchUpActions:()=>_y,mutate:()=>xM,participantScheduledMatchUps:()=>VD,query:()=>RD,removeDelegatedOutcome:()=>EN,removeMatchUpSideParticipant:()=>JM,removeTieMatchUpParticipantId:()=>KM,replaceTieMatchUpParticipantId:()=>$M,resetAdHocMatchUps:()=>$N,resetMatchUpLineUps:()=>FN,resetScorecard:()=>GN,resetTieFormat:()=>VN,setDelegatedOutcome:()=>jN,setMatchUpFormat:()=>kN,setMatchUpStatus:()=>LN,setOrderOfFinish:()=>qN,substituteParticipant:()=>CN,tallyParticipantResults:()=>RI,toggleParticipantCheckInState:()=>VM,tournamentMatchUps:()=>WD,updateTieMatchUpScore:()=>uU,validMatchUp:()=>_d,validMatchUps:()=>Bd});var xM={};function LM({tournamentRecord:e,drawDefinition:t,participantId:i,sideNumber:n,matchUpId:r,event:a}){var o,s;if(i&&"string"!=typeof i)return{error:Ei};if(!t)return{error:Ke};if(!r)return{error:Qt};let l=void 0===n;if(l&&(n=1),![1,2].includes(n))return Sa({result:{error:Fn,context:{sideNumber:n}}});let{matchUp:u,structure:d}=OI({drawDefinition:t,matchUpId:r,event:a});if(!u)return{error:Xt};if(null!=d&&d.structures||t.drawType&&t.drawType!==au||null!=(o=null==d?void 0:d.matchUps)&&o.find((({roundPosition:e})=>!!e)))return{error:ut};if(!i&&(null!=(s=null==u?void 0:u.score)&&s.scoreStringSide1||Cl.includes(null==u?void 0:u.matchUpstatus)||null!=u&&u.matchUpStatus&&[Ul,Il].includes(u.matchUpStatus)))return{error:Ni,info:"matchUp has completed status or score"};if(u){if(u.sides=[1,2].map((e=>{var t;let r=(null==(t=u.sides)?void 0:t.find((t=>t.sideNumber===e)))??{sideNumber:e};return n===e?{...r,participantId:i}:r})),l)for(let e of u.sides)e.sideNumber&&(e.sideNumber=3-e.sideNumber);yd({tournamentId:null==e?void 0:e.tournamentId,context:"assignSideParticipant",drawDefinition:t,matchUp:u})}return{...Be,sidesSwapped:l}}function _M({removePriorValues:e,tournamentRecord:t,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=OI({drawDefinition:n,event:s,matchUpId:a});if(!l)return{error:Xt};let u=yg({removePriorValues:e,element:l,duplicateValues:i,timeItem:o});return r||yd({tournamentId:null==t?void 0:t.tournamentId,eventId:null==s?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),u}function BM(e){var t;let i=io(e,[{[Pa]:!0},{[Da]:!0},{[Ma]:!0},{[Oa]:!0}]);if(i.error)return i;let n=eb(e,[{[Wa]:Va,attr:{[ka]:!0}}]);if(n.error)return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=e,l=null==(t=null==n?void 0:n.matchUp)?void 0:t.matchUp,{matchUpStatus:u,score:d}=l??{};if(u&&Ol.includes(u)||u&&Cl.includes(u)||kf({score:d}))return{error:It};let c=yp({matchUp:l});if(null!=c&&c.error)return c;let{checkedInParticipantIds:p,allRelevantParticipantIds:m}=c??{};if(null==m||!m.includes(o))return{error:Ei};if(null==p||!p.includes(o))return{error:qi};let f=Wc({matchUp:l});if(null!=f&&f.error)return f;let{sideParticipantIds:h,nestedIndividualParticipantIds:v}=f??{},g=null==h?void 0:h.indexOf(o);return void 0!==g&&[0,1].includes(g)&&((null==v?void 0:v[g])??[]).forEach((e=>{_M({drawDefinition:a,matchUpId:s,timeItem:{itemType:zc,itemValue:e}})})),_M({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:zc}}),{...Be,checkedOut:!0}}function jM(e){var t;let i=io(e,[{[Pa]:!0},{[Da]:!0},{[Ma]:!0},{[Oa]:!0}]);if(i[$a])return i;let n=eb(e,[{[Wa]:Va,attr:{[ka]:!0}}]);if(n[$a])return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=e,l=yp({matchUp:null==(t=null==n?void 0:n.matchUp)?void 0:t.matchUp});if(null!=l&&l.error)return l;let{checkedInParticipantIds:u,allRelevantParticipantIds:d}=l??{};if(null==d||!d.includes(o))return{[$a]:Ei};let c={...Be,checkedIn:!0};return null!=u&&u.includes(o)||_M({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:Hc}}),c}function VM(e){var t,i;let n=io(e,[{[Ma]:!0,[Da]:!0,[Oa]:!0}]);if(n.error)return n;let r=e.tournamentId??e.activeTournamentId,a=e.tournamentRecord??(r&&(null==(t=e.tournamentRecords)?void 0:t[r]));if(!a)return{error:We};let o=null==(i=eb(e,[{[Wa]:Va,attr:{[ka]:!0},[$a]:Xt}]).matchUp)?void 0:i.matchUp;if(!o)return{error:Xt};let{checkedInParticipantIds:s=[]}=yp({matchUp:o}),{participantId:l,matchUpId:u,drawDefinition:d}=e;return l&&s.includes(l)?BM({tournamentRecord:a,drawDefinition:d,participantId:l,matchUpId:u,matchUp:o}):jM({tournamentRecord:a,drawDefinition:d,participantId:l,matchUpId:u,matchUp:o})}function GM({tournamentRecord:e,drawDefinition:t,tieMatchUpId:i,event:n}){var r,a;if(!e)return{error:We};if(!t)return{error:mt};if(!n)return{error:Ct};let o=Wd({drawDefinition:t}),{matchUp:s}=OI({matchUpId:i,drawDefinition:t,matchUpsMap:o});if(!s)return{error:Xt};let{matchUp:l,structure:u}=OI({tournamentParticipants:e.participants,matchUpId:i,inContext:!0,drawDefinition:t,matchUpsMap:o,event:n});if(!l)return{error:Xt};let{collectionPosition:d,drawPositions:c,collectionId:p,matchUpTieId:m,matchUpType:f}=l;if(f&&!$m([Ad,Cd],f))return{error:ii};let{positionAssignments:h}=Vu({structure:u}),v=null==h?void 0:h.filter((e=>null==c?void 0:c.includes(e.drawPosition))),{matchUp:g}=OI({matchUpId:m,drawDefinition:t,matchUpsMap:o}),I=[...(null==(r=null==g?void 0:g.sides)?void 0:r.map(sl))??[],...(null==v?void 0:v.map(sl))??[]],{participants:U}=vh({tournamentRecord:e,participantFilters:{participantTypes:[ec],participantIds:I}}),{matchUp:y}=OI({matchUpId:m,inContext:!0,drawDefinition:t,matchUpsMap:o});return{inContextDualMatchUp:y,inContextTieMatchUp:l,relevantAssignments:v,collectionPosition:d,teamParticipants:U,collectionId:p,matchUpType:f,dualMatchUp:g,tieMatchUp:s,tieFormat:null==(a=Um({matchUp:g,drawDefinition:t,structure:u,event:n}))?void 0:a.tieFormat,structure:u,...Be}}function $M(e){var t,i,n,r,a,o,s,l,u,d,c,p,m,f,h,v;let g=GM(e);if(g.error)return g;let I="replaceTieMatchUpParticipantid",{existingParticipantId:U,tournamentRecord:y,newParticipantId:S,drawDefinition:w,substitution:T,event:P}=e;if(!U||!S)return Sa({result:{error:_i},stack:I});if(U===S)return{...Be};let{inContextDualMatchUp:D,inContextTieMatchUp:b,collectionPosition:M,collectionId:N,dualMatchUp:R,tieMatchUp:A,tieFormat:E}=g,C=null==b?void 0:b.matchUpType,O=null==(t=null==b?void 0:b.sides)?void 0:t.find((e=>{var t,i,n;return(null==(t=e.participant)?void 0:t.participantId)===U||(null==(n=null==(i=e.participant)?void 0:i.individualParticipantIds)?void 0:n.includes(U))}));if(!O)return{error:Bi};let k=(null==(i=vh({tournamentRecord:y,participantFilters:{participantIds:[U,S]}}))?void 0:i.participants)??[];if(2!==k.length)return Sa({result:{error:_i},stack:I});if(k[0].participantType!==k[1].participantType)return Sa({result:{error:ki},stack:I});let{appliedPolicies:F}=jc({tournamentRecord:y,drawDefinition:w,event:P}),x=(null==(n=e.policyDefinitions)?void 0:n[Qo])??(null==F?void 0:F[Qo])??Mh[Qo],L=k.find((({participantId:e})=>e===S));if(!1!==(e.enforceGender??(null==(r=null==x?void 0:x.participants)?void 0:r.enforceGender))&&[zm,Jm].includes(null==b?void 0:b.gender)&&(null==b?void 0:b.gender)!==(null==(a=null==L?void 0:L.person)?void 0:a.sex))return{error:Ai,info:"Gender mismatch"};let _=null==(o=null==x?void 0:x.processCodes)?void 0:o.substitution;aU({tournamentId:y.tournamentId,eventId:P.eventId,inContextDualMatchUp:D,drawDefinition:w,dualMatchUp:R});let B=null==(s=null==R?void 0:R.sides)?void 0:s.find((({sideNumber:e})=>e===O.sideNumber));if(!B)return Sa({result:{sideNumber:O.sideNumber,existingParticipantId:U,error:Vn},stack:I});if(null!=(u=null==(l=null==b?void 0:b.sides)?void 0:l.flatMap((e=>{var t,i;return(null==(t=e.participant)?void 0:t.individualParticipantIds)||(null==(i=e.participant)?void 0:i.participantId)||[]})))&&u.includes(S))return Sa({result:{error:zi},stack:I});let j=null==(c=null==(d=null==D?void 0:D.sides)?void 0:d.find((({sideNumber:e})=>e===O.sideNumber)))?void 0:c.participantId,V=B.lineUp,G=null==V?void 0:V.find((({participantId:e})=>S===e)),$=null==V?void 0:V.reduce(((e,t)=>t.substitutionOrder>e?t.substitutionOrder:e),0),q=(null==V?void 0:V.map((e=>{var t;let i=Wo(e,!1,!0);if(![U,S].includes(i.participantId))return i;if(!T&&[U,S].includes(i.participantId)&&(i.collectionAssignments=null==(t=i.collectionAssignments)?void 0:t.filter((e=>!(e.collectionPosition===M&&e.collectionId===N)))),T&&U===i.participantId&&(i.collectionAssignments=i.collectionAssignments.map((e=>e.collectionPosition===M&&e.collectionId===N&&void 0===e.substitutionOrder?{...e,substitutionOrder:$}:e))),i.participantId===S){i.collectionAssignments||(i.collectionAssignments=[]);let e={collectionId:N,collectionPosition:M};T&&(e.previousParticipantId=U,e.substitutionOrder=($??0)+1),i.collectionAssignments.push(e)}return i})))??[];if(!G){let e={collectionId:N,collectionPosition:M};T&&(e.substitutionOrder=($??0)+1,e.previousParticipantId=U);let t={collectionAssignments:[e],participantId:S};q.push(t)}let W,H,z=C===Cd,{assignedParticipantIds:Y}=Tm({lineUp:V,collectionPosition:M,collectionId:N}),{assignedParticipantIds:K}=Tm({lineUp:q,collectionPosition:M,collectionId:N});if(B.lineUp=q,j&&E){let e=Dv({participantId:j,lineUp:q,drawDefinition:w,tieFormat:E});if(e.error)return Sa({result:e,stack:I})}else console.log("team participantId not found");if(z){let{tournamentRecord:t}=e,i=Pm({participantIds:K,tournamentRecord:t});if(!i.participant){let e=Nb({returnParticipant:!0,pairOverride:!0,tournamentRecord:t,participant:{participantRole:Ah,individualParticipantIds:K,participantType:Xd}});if(e.error)return Sa({result:e,stack:I});W=null==(p=e.participant)?void 0:p.participantId}i=Pm({participantIds:Y,tournamentRecord:t});let n=null==(m=i.participant)?void 0:m.participantId;n&&jh({participantIds:[n],tournamentRecord:t}).success&&(H=n)}if(T||1===(null==(f=O.substitutions)?void 0:f.length)){if(T)_&&A&&(A.processCodes=hr([...(null==A?void 0:A.processCodes)??[],..._]));else for(let e of _||[]){let t=null==(h=null==A?void 0:A.processCodes)?void 0:h.lastIndexOf(e);void 0!==t&&(null==(v=null==A?void 0:A.processCodes)||v.splice(t,1))}A&&yd({tournamentId:null==y?void 0:y.tournamentId,matchUp:A,context:I,drawDefinition:w})}return R&&yd({tournamentId:null==y?void 0:y.tournamentId,matchUp:R,context:I,drawDefinition:w}),{...Be,modifiedLineUp:q,participantRemoved:H,participantAdded:W}}function qM({collectionPosition:e,teamParticipantId:t,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var o;if(!a||!e||!Array.isArray(r))return{modifiedLineUp:(null==i?void 0:i.lineUp)||[],error:Fn};let s=(null==i?void 0:i.lineUp)||(null==(o=Dm({participantId:t,drawDefinition:n}))?void 0:o.lineUp),l=[],u=[];return{modifiedLineUp:(null==s?void 0:s.map((t=>{var i;if(!r.includes(t.participantId))return t;let n=null==(i=t.collectionAssignments)?void 0:i.filter((i=>{let n=i.collectionId===a&&i.collectionPosition===e;return n&&(i.previousParticipantId&&l.push(i.previousParticipantId),u.push({participantId:t.participantId,...i})),!n}));return{participantId:t.participantId,collectionAssignments:n}})).filter(Boolean))||[],assignmentsRemoved:u,previousParticipantIds:l}}function WM({individualParticipantIds:e,groupingParticipantId:t,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return Sa({result:{error:We},stack:r});if(!t||!e)return Sa({result:{error:mi},stack:r});let a=n.participants??[],o=a.find((e=>e.participantId===t));if(!o)return Sa({result:{error:Bi},stack:r});if(null!=o&&o.participantType&&![ec,Zd].includes(o.participantType))return Sa({context:{participantType:o.participantType},result:{error:ki},stack:r});let s=e.filter((e=>{var t;return(null==(t=a.find((t=>t.participantId===e)))?void 0:t.participantType)!==Qd}));if(s.length)return Sa({result:{error:Ci,invalidParticipantIds:s},stack:r});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,u=e.filter((e=>!l.includes(e)));u.length&&(i&&Bh({individualParticipantIds:u,tournamentRecord:n}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:d}=sa();if(d.includes(nd)){let e=a.find((({participantId:e})=>e===t));ia({topic:nd,payload:{participants:[e]}})}return function({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}){var n,r;let a=(i.events||[]).filter((e=>{var i;return(null==e?void 0:e.eventType)===$p&&(null==(i=null==e?void 0:e.entries)?void 0:i.some((e=>e.participantId===t)))})),o=t=>!e.includes(t.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:e}=fm({event:s});null==(n=null==e?void 0:e.flights)||n.forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter(o)})),null==(r=null==s?void 0:s.drawDefinitions)||r.forEach((e=>{e.entries=(e.entries||[]).filter(o)}))}}({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:n}),{groupingParticipant:Wo(o,!1,!0),added:u.length,...Be}}function HM(e){let{updateParticipantName:t=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:o}=e;if(!r)return{error:We};if(!o)return{error:xi};if(!o.participantId)return Nb({tournamentRecord:r,participant:o});let{participant:s}=hf({participantId:o.participantId,tournamentRecord:r});if(!s)return Nb({tournamentRecord:r,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:u,participantOtherName:d,participantName:c,participantRole:p,participantType:m,onlineResources:f,contacts:h,person:v}=o;if(m&&s.participantType!==m)return{error:Mi};let g={};if(h&&(g.contacts=h),f&&(g.onlineResources=f),c&&"string"==typeof c&&(g.participantName=c),d&&"string"==typeof d&&(g.participantOtherName=d),Array.isArray(u)){let{participants:e}=vh({participantFilters:{participantTypes:[Qd]},tournamentRecord:r}),i=null==e?void 0:e.map(sl);if(i){let n=u.filter((e=>"string"==typeof e&&i.includes(e)));([Zd,kd].includes(m||s.participantType)||m===Xd&&(2===n.length||a))&&(g.individualParticipantIds=n),s.participantType===tc.PAIR&&t&&(g.participantName=function({individualParticipants:e,newValues:t}){let i=t.individualParticipantIds,n=e.filter((({participantId:e})=>i.includes(e))).map((({person:e})=>null==e?void 0:e.standardFamilyName)).filter(Boolean).sort().join("/");return 1===i.length&&(n+="/Unknown"),n}({individualParticipants:e,newValues:g}))}}return Object.keys(xh).includes(p)&&(g.participantRole=p),Object.keys(tc).includes(m)&&(g.participantType=m),Array.isArray(l)&&(g.participantRoleResponsibilties=l),s.participantType===tc.INDIVIDUAL&&v&&function({updateParticipantName:e,existingParticipant:t,newValues:i,person:n}){let r,a={},{standardFamilyName:o,standardGivenName:s,nationalityCode:l,personId:u,sex:d}=n;if(d&&Object.keys(Qm).includes(d)&&(a.sex=d),u&&"string"==typeof u&&(a.personId=u),l&&"string"==typeof l&&(function(e){return mf.flatMap((({iso:e,ioc:t})=>[e,t])).filter(Boolean).includes(e)}(l)||""===l)&&(a.nationalityCode=l),o&&"string"==typeof o&&o.length>1&&(a.standardFamilyName=o,r=!0),s&&"string"==typeof s&&s.length>1&&(a.standardGivenName=s,r=!0),r&&e){let e=`${a.standardGivenName} ${a.standardFamilyName}`;i.participantName=e}Object.assign(t.person,a)}({updateParticipantName:t,existingParticipant:s,newValues:g,person:v}),Object.assign(s,ya(g)),i&&WM({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),ia({topic:nd,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:Wo(s),...Be}}function zM(e){var t,i,n,r,a,o,s,l,u,d,c,p,m,f,h,v,g,I,U,y;let S=GM(e);if(S.error)return S;let w="assignTieMatchUpParticipantId",T=e.teamParticipantId,{tournamentRecord:P,drawDefinition:D,participantId:b,event:M}=e;if(!b)return Sa({result:{error:_i},stack:w});if(e.sideNumber&&![1,2].includes(e.sideNumber))return Sa({result:{error:di},stack:w});let{inContextDualMatchUp:N,inContextTieMatchUp:R,relevantAssignments:A,collectionPosition:E,teamParticipants:C,collectionId:O,matchUpType:k,dualMatchUp:F,tieFormat:x}=S;if(null!=(i=null==(t=null==R?void 0:R.sides)?void 0:t.flatMap((e=>{var t,i;return(null==(t=e.participant)?void 0:t.individualParticipantIds)||(null==(i=e.participant)?void 0:i.participantId)||[]})))&&i.includes(b))return Sa({result:{...Be},stack:w});T=T??(e.sideNumber?null==(r=null==(n=null==N?void 0:N.sides)?void 0:n.find((t=>t.sideNumber===e.sideNumber)))?void 0:r.participantId:void 0);let L=null==(o=null==(a=vh({participantFilters:{participantIds:[b]},tournamentRecord:P}))?void 0:a.participants)?void 0:o[0];if(!L)return Sa({result:{error:Bi},stack:w});let{appliedPolicies:_}=jc({tournamentRecord:P,drawDefinition:D,event:M}),B=(null==(s=e.policyDefinitions)?void 0:s[Qo])??(null==_?void 0:_[Qo])??Mh[Qo];if(!1!==(e.enforceGender??(null==(l=null==B?void 0:B.participants)?void 0:l.enforceGender))&&[zm,Jm].includes(null==R?void 0:R.gender)&&(null==R?void 0:R.gender)!==(null==(u=L.person)?void 0:u.sex))return{error:Ai,info:"Gender mismatch"};let{individualParticipantIds:j,participantType:V}=L;if(wp(Ad)(k)&&V!==Qd)return{error:ki};let G=V===Qd?[b]:j,$=T&&(null==C?void 0:C.find((({participantId:e})=>e===T)))||(null==C?void 0:C.find((({individualParticipantIds:e})=>Ar(G,e))));if(!$)return{error:Ln};if(T||(T=$.participantId),!T)return{error:Bi};let q=null==(d=null==A?void 0:A.find((e=>e.participantId===(null==$?void 0:$.participantId))))?void 0:d.drawPosition,W=null==(p=null==(c=null==F?void 0:F.sides)?void 0:c.find((e=>e.participantId===T)))?void 0:p.sideNumber,H=null==(f=null==(m=null==R?void 0:R.sides)?void 0:m.find((e=>q&&e.drawPosition===q)))?void 0:f.sideNumber,z=W??H??e.sideNumber;if(!x)return{error:Jt};if(null==(h=x.collectionDefinitions)||!h.find((e=>e.collectionId===O)))return{error:Kt};aU({tournamentId:P.tournamentId,eventId:M.eventId,inContextDualMatchUp:N,drawDefinition:D,dualMatchUp:F});let Y=null==(v=null==F?void 0:F.sides)?void 0:v.find((e=>e.sideNumber===z)),K=null==(g=null==R?void 0:R.sides)?void 0:g.find((e=>e.sideNumber===z)),J=null==(y=null==(U=(null==Y?void 0:Y.lineUp)??(null==(I=Dm({participantId:T,drawDefinition:D}))?void 0:I.lineUp))?void 0:U.filter((e=>{var t;return null==(t=e.collectionAssignments)?void 0:t.find((e=>e.collectionPosition===E&&e.collectionId===O&&!e.previousParticipantId))})))?void 0:y.map((e=>null==e?void 0:e.participantId)),Q=(null==J?void 0:J.length)>1&&J||(V===Xd?L.individualParticipantIds:[b]),Z=qM({collectionPosition:E,teamParticipantId:T,dualMatchUpSide:Y,drawDefinition:D,participantIds:Q,collectionId:O});if(Z.error)return Sa({result:Z,stack:w});let X,{modifiedLineUp:ee}=Z;if(k===Cd){if(V!==Xd){let e=YM({collectionPosition:E,teamParticipantId:T,drawDefinition:D,modifiedLineUp:ee,participantId:b,collectionId:O,tieFormat:x});if(null!=e&&e.error)return Sa({result:e,stack:w});if(e=function({side:e}){let t;if(e.participant){let i=e.participant.individualParticipantIds||[];if(1===i.filter(Boolean).length){let{participant:e}=Pm({participantIds:i,tournamentRecord:P});i.push(b);let{participant:n}=Pm({participantIds:i,tournamentRecord:P});if(!n&&e){e.individualParticipantIds=i;let t=HM({pairOverride:!0,tournamentRecord:P,participant:e});if(t.error)return t}else t=null==e?void 0:e.participantId}}else{let e=Nb({participant:{individualParticipantIds:[b],participantRole:Ah,participantType:Xd},pairOverride:!0,tournamentRecord:P});if(e.error)return e}return{...Be,deletedParticipantId:t}}({side:K}),e.error)return e;X=e.deletedParticipantId,Y&&(Y.lineUp=ee),F&&yd({tournamentId:null==P?void 0:P.tournamentId,matchUp:F,context:w,drawDefinition:D})}else if(V===Xd)for(let te of Q)YM({collectionPosition:E,teamParticipantId:T,drawDefinition:D,modifiedLineUp:ee,participantId:te,collectionId:O,tieFormat:x})}else{let e=YM({collectionPosition:E,teamParticipantId:T,drawDefinition:D,modifiedLineUp:ee,participantId:b,collectionId:O,tieFormat:x});if(null!=e&&e.error)return e}if(Y&&(Y.lineUp=ee),F&&yd({tournamentId:null==P?void 0:P.tournamentId,matchUp:F,context:w,drawDefinition:D}),X){let{error:e}=jh({participantIds:[X],tournamentRecord:P});e&&console.log("cleanup")}return{...Be,modifiedLineUp:ee}}function YM({collectionPosition:e,teamParticipantId:t,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var s,l;let u=null==(s=Dm({participantId:t,drawDefinition:i}))?void 0:s.lineUp,d=null==(l=n||u)?void 0:l.find((e=>(null==e?void 0:e.participantId)===r)),c={collectionId:a,collectionPosition:e};if(d)d.collectionAssignments.push(c);else{let e={collectionAssignments:[c],participantId:r};n.push(e)}return Dv({participantId:t,lineUp:n,drawDefinition:i,tieFormat:o})}function KM(e){var t,i,n,r,a,o,s,l,u,d,c,p,m,f,h,v,g,I,U,y,S,w;let{tournamentRecord:T,drawDefinition:P,participantId:D,event:b}=e,M="removeTieMatchUpParticiapantId";if(!D)return Sa({result:{error:_i},stack:M});let N=GM(e);if(N.error)return N;let{appliedPolicies:R}=jc({tournamentRecord:T,drawDefinition:P,event:b}),A=null==(n=null==(i=(null==(t=e.policyDefinitions)?void 0:t[Qo])??(null==R?void 0:R[Qo])??Mh[Qo])?void 0:i.processCodes)?void 0:n.substitution,{inContextDualMatchUp:E,inContextTieMatchUp:C,relevantAssignments:O,collectionPosition:k,teamParticipants:F,collectionId:x,matchUpType:L,dualMatchUp:_,tieMatchUp:B,tieFormat:j}=N;if(!_)return Sa({result:{error:ti},stack:M});let V=null==(r=null==C?void 0:C.sides)?void 0:r.find((e=>{var t,i,n;return(null==(t=e.participant)?void 0:t.participantId)===D||(null==(n=null==(i=e.participant)?void 0:i.individualParticipantIds)?void 0:n.includes(D))}));if(!V)return Sa({result:{error:Bi},stack:M});if((null==(a=V.substitutions)||!a.length)&&(kf({score:null==C?void 0:C.score})||null!=C&&C.winningSide))return Sa({result:{error:Wn},stack:M});let G=null==(s=null==(o=null==E?void 0:E.sides)?void 0:o.find((({sideNumber:e})=>e===V.sideNumber)))?void 0:s.participantId;if(!G)return Sa({result:{error:Bi},stack:M});let $=null==(u=null==(l=vh({participantFilters:{participantIds:[D]},tournamentRecord:T}))?void 0:l.participants)?void 0:u[0];if(!$)return Sa({result:{error:Bi},stack:M});if(L===Ad&&$.participantType===Xd)return Sa({result:{error:Ai},stack:M});let q=$.participantType===Qd?[D]:$.individualParticipantIds;aU({tournamentId:T.tournamentId,eventId:b.eventId,inContextDualMatchUp:E,drawDefinition:P,dualMatchUp:_});let W=null==(d=_.sides)?void 0:d.find((({sideNumber:e})=>e===V.sideNumber));if(!W&&((null==(c=_.sides)?void 0:c.filter((({lineUp:e})=>!e)).length)||0)<2){let e=null==F?void 0:F.map((({participantId:e})=>{var t;return{drawPosition:null==(t=null==O?void 0:O.find((t=>t.participantId===e)))?void 0:t.drawPosition,teamParticipantId:e}}));W=null==(p=_.sides)?void 0:p.find((t=>{var i;return(null==(i=null==e?void 0:e.find((({drawPosition:e})=>e===t.drawPosition)))?void 0:i.teamParticipantId)===G}))}if(!W)return Sa({result:{error:Bi,context:{participantId:D}}});let{modifiedLineUp:H,previousParticipantIds:z}=qM({collectionPosition:k,teamParticipantId:G,dualMatchUpSide:W,participantIds:q,drawDefinition:P,collectionId:x});if(W.lineUp=H,G&&j&&Dv({participantId:G,lineUp:H,drawDefinition:P,tieFormat:j}),L===Cd&&$.participantType===Qd){let e=null==(m=null==C?void 0:C.sides)?void 0:m.find((e=>e.sideNumber===(null==W?void 0:W.sideNumber))),{participantId:t}=e??{},i=t&&(null==(h=null==(f=vh({participantFilters:{participantIds:[t]},tournamentRecord:T,withDraws:!0}))?void 0:f.participants)?void 0:h[0]);if(!i)return Sa({result:{error:Bi},stack:M});{let e=(null==(v=null==i?void 0:i.individualParticipantIds)?void 0:v.filter((e=>e!==D)))??[];if(z&&e.push(...z),e.length>2)return Sa({result:{error:Ci},stack:M});if(null!=(g=i.draws)&&g.length){if(1===e.length){let{participant:t}=Pm({participantIds:e,tournamentRecord:T});if(!t){let t=Nb({participant:{participantRole:Ah,individualParticipantIds:e,participantType:Xd},pairOverride:!0,tournamentRecord:T});if(t.error)return Sa({result:t,stack:M})}}}else if(e.length){i.individualParticipantIds=e;let t=HM({participant:i,pairOverride:!0,tournamentRecord:T});if(t.error)return Sa({result:t,stack:M})}else{let e=jh({participantIds:[t],tournamentRecord:T});e.error&&console.log("cleanup",{result:e})}}}if(1===(null==(I=V.substitutions)?void 0:I.length)&&(null==(S=null==(y=null==(U=null==C?void 0:C.sides)?void 0:U.find((e=>e.sideNumber!==V.sideNumber)))?void 0:y.substitutions)||!S.length)&&null!=(w=null==B?void 0:B.processCodes)&&w.length){for(let e of A||[]){let t=B.processCodes.lastIndexOf(e);B.processCodes.splice(t,1)}yd({tournamentId:null==T?void 0:T.tournamentId,matchUp:B,context:M,drawDefinition:P})}return yd({tournamentId:null==T?void 0:T.tournamentId,matchUp:_,context:M,drawDefinition:P}),{...Be,modifiedLineUp:H}}function JM(e){var t,i;let n=io(e,[{[Pa]:!0,[Da]:!0,[Oa]:!0}]);if(n.error)return n;let{drawDefinition:r,sideNumber:a,matchUpId:o,event:s}=e;if(a&&![1,2].includes(a))return{error:Fn,sideNumber:a};let{matchUp:l,structure:u}=OI({drawDefinition:r,matchUpId:o,event:s});return l?Nm({structure:u})?(null==(t=l.sides)||t.forEach((e=>{(!a||e.sideNumber===a)&&delete e.participantId})),yd({tournamentId:null==(i=e.tournamentRecord)?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:l}),{...Be}):{error:ut}:{error:Xt}}function QM({inContextDrawMatchUps:e,positionAssignments:t,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:u,event:d}){var c,p,m;if(s){let t=null==(p=null==(c=e.find((({matchUpId:e})=>u.matchUpId===e)).sides)?void 0:c.find((e=>e.drawPosition===n)))?void 0:p.sideNumber,i=null==(m=u.sides)?void 0:m.find((e=>e.sideNumber===t));i&&delete i.lineUp}u.drawPositions=(u.drawPositions||[]).map((e=>e===n?void 0:e)).filter(Boolean);let f=t.filter((({drawPosition:e})=>{var t;return null==(t=u.drawPositions)?void 0:t.includes(e)})).filter((e=>e.bye)).length;return u.matchUpStatus=f&&ml||[gl,bl].includes(u.matchUpStatus)&&u.matchUpStatus||Dl,[bl,gl].includes(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&Iv({inContextDrawMatchUps:e,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:u}),yd({tournamentId:null==r?void 0:r.tournamentId,eventId:null==d?void 0:d.eventId,context:`removeSubsequentDrawPosition-${n}`,drawDefinition:o,matchUp:u}),{...Be}}function ZM(e){let{dualWinningSideChange:t,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:u,structure:d,event:c}=e,p=!!e.matchUp.collectionId,m=Nm({structure:d}),{drawPositions:f,winningSide:h}=l.matchUp||{};if(!m&&!f)return{error:at};let v,{targetLinks:{loserTargetLink:g,winnerTargetLink:I,byeTargetLink:U},targetMatchUps:{loserMatchUp:y,winnerMatchUp:S,byeMatchUp:w}}=l,T=LI({...e,matchUpStatus:a||Dl,removeWinningSide:!0});if(T.error)return T;if(p){let{matchUpTieId:i,matchUpsMap:a}=e;if(v=uU({appliedPolicies:e.appliedPolicies,matchUpId:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,event:c}),!t&&!v.removeWinningSide)return{...Be}}if(m)return{...Be};let{matchUps:P}=Zm({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:o,structure:d}),{positionAssignments:D}=Gu({structure:d}),b=h-1,M=1-b,N=f[b],R=f[M],{winnerParticipantId:A,loserParticipantId:E}=(null==D?void 0:D.reduce(((e,t)=>(t.drawPosition===R&&(e.loserParticipantId=t.participantId),t.drawPosition===N&&(e.winnerParticipantId=t.participantId),e)),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},C=P.filter((e=>{var t;return null==(t=e.drawPositions)?void 0:t.includes(R)}));if(S&&XM({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:i,winningDrawPosition:N,winnerParticipantId:A,tournamentRecord:n,winnerTargetLink:I,drawDefinition:r,winnerMatchUp:S,dualMatchUp:s,matchUpsMap:o}),y){let{winnerHadMatchUpStatus:e}=function({matchUpStatuses:e=[ml,bl,gl],drawPositionMatchUps:t,loserDrawPosition:i,sourceMatchUps:n}){var r;let a=null==t?void 0:t.reduce(((e,t)=>!e||t.roundNumber>e.roundNumber?t:e),void 0),o=null==(r=null==a?void 0:a.drawPositions)?void 0:r.find((e=>e!==i)),s=n.filter((e=>{var t;return null==(t=null==e?void 0:e.drawPositions)?void 0:t.includes(o)})).map((e=>e.matchUpStatus)),l=n.filter((e=>{var t;return null==(t=null==e?void 0:e.drawPositions)?void 0:t.includes(i)})).map((e=>e.matchUpStatus));return{sourceMatchUp:a,winnerHadMatchUpStatus:Ar(s||[],e),winnerMatchUpStatuses:s,loserHadMatchUpStatus:Ar(l||[],e),loserMatchUpStatuses:l}}({drawPositionMatchUps:C,loserDrawPosition:R,sourceMatchUps:P}),t=g.linkCondition===ru;if(e&&t){eN({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:Math.min(...y.drawPositions),matchUpsMap:o,event:c})}let l=function({sourceMatchUpStatus:e,loserParticipantId:t,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:u}){var d,c,p;let m="removeDirectedLoser",f=n.target.structureId,{structure:h}=_u({drawDefinition:a,structureId:f});if(!h)return{error:bt};let{positionAssignments:v}=Gu({structure:h}),g=null==(d=null==v?void 0:v.find((e=>e.participantId===t)))?void 0:d.drawPosition;if(null==v||v.forEach((e=>{e.participantId===t&&delete e.participantId})),h.seedAssignments=(h.seedAssignments??[]).filter((e=>e.participantId!==t)),l){let e=null==o?void 0:o.sides.reduce(((e,t,i)=>t.drawPosition===g?i:e),void 0),t=null==(c=null==s?void 0:s.drawMatchUps)?void 0:c.find((({matchUpId:e})=>e===o.matchUpId)),n=null==(p=null==t?void 0:t.sides)?void 0:p[e];n&&(delete n.lineUp,yd({tournamentId:null==i?void 0:i.tournamentId,eventId:null==u?void 0:u.eventId,matchUp:t,context:m,drawDefinition:a}))}return{...Be}}({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:E,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:y,dualMatchUp:s,matchUpsMap:o,event:c});if(l.error)return l}if(w){eN({sourceMatchUpId:u,targetLink:U,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:Math.min(...w.drawPositions),matchUpsMap:o,event:c})}return{...Be,...v&&{tieMatchUpResult:v}}}function XM({inContextDrawMatchUps:e,winningDrawPosition:t,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:u,dualMatchUp:d,event:c}){var p,m;let{structureId:f,roundNumber:h}=l;if(a){let e=a.target.structureId,{structure:t}=_u({drawDefinition:s,structureId:e});if(!t)return{error:bt};let{positionAssignments:i}=Gu({structure:t});t.seedAssignments=(t.seedAssignments??[]).filter((e=>e.participantId!==n));let o=null==(p=null==i?void 0:i.find((e=>e.participantId===n)))?void 0:p.drawPosition,{matchUps:d}=Zm({drawDefinition:s,structure:t,event:c}),f=Ur(d.map((e=>e.drawPositions)).flat(1/0).filter(Boolean));if(1===(o?f[o]:void 0))null==i||i.forEach((e=>{e.participantId===n&&delete e.participantId}));else{let e=d.filter((({drawPositions:e})=>e.includes(o)));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:e,winnerTargetLink:a})}let h=null==(m=null==u?void 0:u.drawMatchUps)?void 0:m.find((({matchUpId:e})=>e===l.matchUpId));h&&yd({tournamentId:null==r?void 0:r.tournamentId,eventId:null==c?void 0:c.eventId,matchUp:h,context:"removeDirectedWinner",drawDefinition:s})}return h&&function({inContextDrawMatchUps:e,sourceMatchUpStatus:t,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:u,event:d}){let{structure:c}=_u({drawDefinition:a,structureId:o});if((null==c?void 0:c.structureType)===Jl)return{...Be};let p=((null==(u=u??Wd({drawDefinition:a}))?void 0:u.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=Bf({drawPosition:i,matchUps:p}),f=null==p?void 0:p.filter((e=>{var t;return e.roundNumber>=l&&e.roundNumber!==m&&(null==(t=e.drawPositions)?void 0:t.includes(i))})),{positionAssignments:h}=Vu({drawDefinition:a,structureId:o});for(let v of f??[])QM({inContextDrawMatchUps:e,sourceMatchUpStatus:t,positionAssignments:h,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:v,event:d})}({targetDrawPosition:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:d,matchUpsMap:u,roundNumber:h,structureId:f}),{...Be}}function eN({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:o}){return Jf({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:a.target.structureId,event:o}),{...Be}}function tN(e){var t;let{tournamentRecord:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:a,targetData:o,structure:s,event:l}=e,u="doubleExitAdvancement";if(s.structureType===Jl)return Sa({result:{...Be},stack:u});let{matchUp:d,targetMatchUps:c,targetLinks:p}=o,{loserMatchUp:m,winnerMatchUp:f,loserTargetDrawPosition:h}=c;if(m&&m.matchUpStatus!==ml){let{loserTargetLink:o}=p;if(null!=(t=null==n?void 0:n.progression)&&t.doubleExitPropagateBye){let e=nN({loserTargetDrawPosition:h,tournamentRecord:i,loserTargetLink:o,drawDefinition:r,loserMatchUp:m,matchUpsMap:a,event:l});if(e.error)return Sa({result:e,stack:u})}else{let{feedRound:t,drawPositions:n,matchUpId:r}=m,a=t?2:2-n.indexOf(h),o=iN({...e,targetMatchUp:m,walkoverWinningSide:a,tournamentRecord:i,sourceMatchUp:d,matchUpId:r});if(o.error)return Sa({result:o,stack:u})}}if(f){let t=iN({...e,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:i,sourceMatchUp:d});if(t.error)return Sa({result:t,stack:u})}return Sa({result:{...Be},stack:u})}function iN(e){var t,i,n;let{inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:u}=e,d=o.structures.find((({structureId:e})=>e===l.structureId)),c=e.matchUpStatus===Il?Il:Ul,p=e.matchUpStatus===Il?gl:bl,m="conditionallyAdvanceDrawPosition",f=u.drawMatchUps.find((e=>e.matchUpId===l.matchUpId));if(!f)return{error:ti};let h=(null==s?void 0:s.drawPositions)||[],v=null==(t=f.drawPositions)?void 0:t.filter(Boolean),g=(null==s?void 0:s.structureId)===l.structureId;if(g&&Ar(h,v)&&(v=v.filter((e=>!h.includes(e)))),g&&v.length>1)return Sa({result:{error:tt},stack:m});let{pairedPreviousMatchUpIsDoubleExit:I,pairedPreviousMatchUp:U}=vv(e),y=af({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:o}),{targetMatchUps:S,targetLinks:w}=y,{loserTargetDrawPosition:T,winnerMatchUp:P,loserMatchUp:D}=S;if(D){let{loserTargetLink:e}=w,t=nN({loserTargetDrawPosition:T,loserMatchUp:D,tournamentRecord:a,loserTargetLink:e,drawDefinition:o,matchUpsMap:u});if(t.error)return Sa({result:t,stack:m})}let b,M=(null==(i=f.drawPositions)?void 0:i.filter(Boolean))||[],N=1===M.length,R=e.walkoverWinningSide||N&&Uv({drawPosition:M[0],matchUpId:l.matchUpId,inContextDrawMatchUps:r})||void 0,A=[bl,gl].includes(f.matchUpStatus)&&!M.length,E=1===f.finishingRound,C=A&&!E?c:p,O=r.find((e=>e.matchUpId===U.matchUpId)),k=[];s&&((null==s?void 0:s.structureId)===(null==O?void 0:O.structureId)?b=s.roundPosition<(null==U?void 0:U.roundPosition)?1:2:l.feedRound?b=s.structureId===l.structureId?2:1:R&&(b=3-R));let F=e.matchUpStatus,x=null==U?void 0:U.matchUpStatus;1===b?k=[{matchUpStatus:rN(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:rN(x),previousMatchUpStatus:x,sideNumber:2}]:2===b&&(k=[{matchUpStatus:rN(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:rN(F),previousMatchUpStatus:F,sideNumber:2}]),k.length&&(k=k.map((e=>ya(e))));let L=LI({...e,winningSide:R,matchUp:f,matchUpStatusCodes:k,context:m,matchUpStatus:C});if(L.error)return Sa({result:L,stack:m});if(A)return tN({...e,matchUpStatus:C,targetData:y});if(!P)return Sa({result:{...Be},stack:m});let _=2===v.length?v[R-1]:v[0],{positionAssignments:B}=Vu({structure:d}),j=null==B?void 0:B.find((e=>e.drawPosition===_)),V=u.drawMatchUps.find((e=>e.matchUpId===P.matchUpId)),G=null==(n=null==V?void 0:V.drawPositions)?void 0:n.filter(Boolean),$=1===G.length;if(_){if(null!=j&&j.bye){let t=af({matchUpId:V.matchUpId,inContextDrawMatchUps:r,drawDefinition:o});if($){let t=G.filter(Boolean)[0],i=Uv({drawPosition:t,matchUpId:V.matchUpId,inContextDrawMatchUps:r}),n=LI({appliedPolicies:e.appliedPolicies,matchUpId:V.matchUpId,matchUp:V,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,winningSide:i});return n.error?Sa({result:n,stack:m}):zf({drawPositionToAdvance:t,matchUpId:V.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,matchUpsMap:u})}if([bl,gl].includes(P.matchUpStatus)){let i=tN({...e,matchUpId:V.matchUpId,matchUpStatus:C,targetData:t});if(i.error)return Sa({result:i,stack:m})}return Sa({result:{...Be},stack:m})}return yv({matchUpId:P.matchUpId,drawPosition:_,inContextDrawMatchUps:r,drawDefinition:o})}if(I){if(!V)return{error:ti};if($){let e=G[0],t=Uv({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawPosition:e});console.log("existing drawPosition is winningSide",{walkoverWinningSide:t})}let t=[bl,gl].includes(V.matchUpStatus)?p:c,i=LI({matchUpId:V.matchUpId,appliedPolicies:e.appliedPolicies,matchUp:V,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,matchUpStatus:t});if(i.error)return Sa({result:i,stack:m});if(t===c){let i=tN({...e,matchUpId:l.matchUpId,matchUpStatus:t,targetData:y});if(i.error)return i}}return Sa({result:{...Be},stack:m})}function nN(e){var t;let{loserTargetDrawPosition:i,tournamentRecord:n,loserTargetLink:r,drawDefinition:a,matchUpsMap:o,event:s}=e,l=null==(t=null==r?void 0:r.target)?void 0:t.structureId,{structure:u}=_u({drawDefinition:a,structureId:l});return u?qf({drawPosition:i,tournamentRecord:n,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:Nt}}function rN(e){return e===Ul?bl:e===Il?gl:e}function aN(e){let{tournamentRecord:t,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=e,o=!(!a.tieMatchUps||a.rondPosition||!e.inContextDrawMatchUps.find((e=>e.matchUpId===a.matchUpId)).containerStructureId),s=n===ml,l=a.winningSide,u=[Ul,Il].includes(n),d=Ff({matchUpStatus:n}),c=xf({matchUpStatus:n}),p=!d&&!c,m=e.matchUpTieId||l&&d&&!u,f=l&&u;return p&&{error:Gt}||m&&oN(e)||f&&function(e){let t=ZM(e);return t.error?t:tN(e)}(e)||l&&ZM(e)||c&&LI({...e,removeScore:[fl,bl].includes(n),matchUpStatus:n||Dl})||s&&function({tournamentRecord:e,drawDefinition:t,structure:i,matchUp:n}){var r;let a="attemptToSetMatchUpStatusBYE";if(null!=n&&n.winningSide)return Sa({result:{error:Wt},context:{matchUpStatus:ml},stack:a});let{positionAssignments:o}=Gu({structure:i}),s=null==o?void 0:o.filter((e=>e.bye)).map((e=>e.drawPosition));return null!=(r=n.drawPositions)&&r.some((e=>null==s?void 0:s.includes(e)))?(n.matchUpStatus=ml,n.matchUpStatusCodes=[],yd({tournamentId:null==e?void 0:e.tournamentId,context:a,drawDefinition:t,matchUp:n}),{...Be}):Sa({result:{error:Vt},info:"matchUp does not include BYE",stack:a})}({tournamentRecord:t,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:Gt}||u&&function(e){let t=oN({...e,removeScore:!0});return t.error?t:tN(e)}(e)||o&&oN(e)||Sa({result:{error:Wt},stack:"attemptToSetMatchUpStatus"})}function oN(e){var t;let i="scoreModification";if(e.isCollectionMatchUp&&null!=(t=e.dualMatchUp)&&t.winningSide&&!e.projectedWinningSide){let t=ZM(e);if(t.error)return Sa({result:t,stack:i})}let n=!!e.matchUp.collectionId,r=LI({...e,context:i});if(n){let{matchUpTieId:t,drawDefinition:n,matchUpsMap:a}=e,o=uU({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:t,event:e.event,drawDefinition:n,matchUpsMap:a});if(o.error)return Sa({result:o,stack:i});Object.assign(r,{tieMatchUpResult:o})}return Sa({result:r,stack:i})}function sN({drawDefinition:e,structure:t,matchUp:i}){let n=[];if(t.finishingPosition===Eu&&qv({drawDefinition:e,structure:t})){let{structureIds:r}=function({drawDefinition:e,structure:t,matchUp:i}){var n,r,a,o;let{drawPositions:s}=i,{positionAssignments:l}=Vu({drawDefinition:e,structure:t}),u=null==(n=null==l?void 0:l.filter((({drawPosition:e})=>null==s?void 0:s.includes(e))))?void 0:n.map((e=>{var t;let{extension:i}=Ds({element:e,name:zs});return null==(t=null==i?void 0:i.value)?void 0:t.groupOrder})),{containerStructures:d}=Nd({drawDefinition:e});return{structureIds:null==(o=null==(a=null==(r=nf({drawDefinition:e,structureId:d[t.structureId]}))?void 0:r.links)?void 0:a.source)?void 0:o.filter((e=>{var t;return Ar(u,(null==(t=e.source)?void 0:t.finishingPositions)||[])})).map((e=>e.source.structureId))}}({drawDefinition:e,structure:t,matchUp:i});null!=r&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function lN(e){var t,i;let n,r="attemptToSetWinningSide",{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:u,structure:d,matchUp:c}=e;if(null!=l&&l._disableAutoCalc&&!1!==o)return _I(e);if(c.winningSide&&c.winningSide!==u){let{connectedStructureIds:t}=sN({drawDefinition:s,structure:d,matchUp:c});t.length&&(console.log({connectedStructureIds:t}),n=!0);let i=ZM(e);if(i.error)return i}let p,m,f=dU(e);return f.error?Sa({result:f,stack:r}):(e.qualifierChanging&&null!=(t=null==a?void 0:a[ts])&&t.autoReplaceQualifiers&&(p=function(e){var t,i,n;let r,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=e,u=null==(t=e.targetData.targetLinks)?void 0:t.winnerTargetLink;if(u.target.feedProfile===Ql){let t=o.sides.find((({sideNumber:e})=>e!==l)).participantId,d=a.find((e=>e.structureId===u.target.structureId&&e.roundNumber===u.target.roundNumber&&e.sides.some((({participantId:e})=>e===t))));if((null==d?void 0:d.matchUpStatus)===Dl&&!dy({inContextDrawMatchUps:a,drawDefinition:s,targetData:af({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s})})){let{structure:a}=_u({structureId:d.structureId,drawDefinition:s}),u=Vu({structure:a}).positionAssignments;for(let d of u||[])if(d.participantId===t){let t=o.sides.find((({sideNumber:e})=>e===l)).participantId;if(d.participantId=t,null==a?void 0:a.positionAssignments)a.positionAssignments=u;else if(null!=a&&a.structures){let e=Object.assign({},...(u||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of a.structures)null==(i=t.positionAssignments)||i.forEach((t=>t.participantId=e[t.drawPosition]))}Pd({tournamentId:null==(n=e.tournamentRecord)?void 0:n.tournamentId,event:e.event,drawDefinition:s,structure:a}),r=!0}}}return{...Be,qualifierReplaced:r}}(e).qualifierReplaced),e.qualifierAdvancing&&null!=(i=null==a?void 0:a[ts])&&i.autoPlaceQualifiers&&(m=function(e){var t,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u,winningSide:d}=e,c=null==(t=e.targetData.targetLinks)?void 0:t.winnerTargetLink;if(c.target.feedProfile===Ql){let t=null==(i=l.sides.find((({sideNumber:e})=>e===d)))?void 0:i.participantId,p=Dr(s.filter((e=>e.structureId===c.target.structureId&&e.roundNumber===c.target.roundNumber&&e.sides.some((({participantId:e,qualifier:t})=>t&&!e)))));if((null==p?void 0:p.matchUpStatus)===Dl&&!dy({inContextDrawMatchUps:s,drawDefinition:u,targetData:af({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:u})})){let i=null==(n=p.sides.find((e=>e.qualifier&&!e.participantId)))?void 0:n.drawPosition,{structure:s}=_u({structureId:p.structureId,drawDefinition:u});if(!s)return{error:bt};let l=Vu({structure:s}).positionAssignments;for(let n of l||[])if(n.drawPosition===i&&!n.participantId){if(n.participantId=t,s.positionAssignments)s.positionAssignments=l;else if(s.structures){let e=Object.assign({},...(l||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of s.structures)null==(r=t.positionAssignments)||r.forEach((t=>t.participantId=e[t.drawPosition]))}Pd({tournamentId:null==(a=e.tournamentRecord)?void 0:a.tournamentId,event:e.event,drawDefinition:u,structure:s}),o=!0}}}return{...Be,qualifierPlaced:o}}(e).qualifierPlaced),Sa({result:ya({...Be,...f,connectedStructures:n,qualifierReplaced:p,qualifierPlaced:m}),stack:r}))}be(xM,{applyLineUps:()=>WN,assignMatchUpSideParticipant:()=>LM,assignTieMatchUpParticipantId:()=>zM,bulkMatchUpStatusUpdate:()=>_N,checkInParticipant:()=>jM,checkOutParticipant:()=>BM,disableTieAutoCalc:()=>ON,enableTieAutoCalc:()=>AN,findMatchUp:()=>XP,removeDelegatedOutcome:()=>EN,removeMatchUpSideParticipant:()=>JM,removeTieMatchUpParticipantId:()=>KM,replaceTieMatchUpParticipantId:()=>$M,resetAdHocMatchUps:()=>$N,resetMatchUpLineUps:()=>FN,resetScorecard:()=>GN,resetTieFormat:()=>VN,setDelegatedOutcome:()=>jN,setMatchUpFormat:()=>kN,setMatchUpStatus:()=>LN,setOrderOfFinish:()=>qN,substituteParticipant:()=>CN,toggleParticipantCheckInState:()=>VM,updateTieMatchUpScore:()=>uU});var uN={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function dN(e){var t;let{inContextDrawMatchUps:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:a,targetData:o,matchUp:s}=e,{iteration:l=0}=e;l+=1;let u="removeDoubleExit";Gf({method:u,color:"brightyellow",iteration:l,keyColors:uN});let{targetLinks:{loserTargetLink:d},targetMatchUps:{loserMatchUp:c,winnerMatchUp:p,loserTargetDrawPosition:m}}=o;if(p&&p.matchUpStatus!==ml){let{stage:t,roundNumber:i,roundPosition:n}=p;Gf({winner:"winner",stage:t,roundNumber:i,roundPosition:n,keyColors:uN}),cN({...e,targetMatchUp:p,sourceMatchUp:s,iteration:l})}if(c&&c.matchUpStatus!==ml){let o=i.find((({matchUpId:e})=>e===c.matchUpId)),{structure:s}=_u({drawDefinition:r,structureId:o.structureId}),{stage:p,roundNumber:f,roundPosition:h,feedRound:v}=c;if(Gf({loser:"loser",stage:p,roundNumber:f,roundPosition:h,keyColors:uN,feedRound:v}),null==(t=null==n?void 0:n.progression)?void 0:t.doubleExitPropagateBye)eN({drawPosition:m,targetLink:d,inContextDrawMatchUps:i,drawDefinition:r,matchUpsMap:a});else{let t=cN({...e,structure:s,targetMatchUp:c,iteration:l});if(t.error)return Sa({result:t,stack:u})}}return Sa({result:{...Be},stack:u})}function cN(e){var t,i,n,r,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,sourceMatchUp:d,targetMatchUp:c,matchUpsMap:p,structure:m,iteration:f}=e,h="conditionallyRemoveDrawPosition";Gf({method:h});let v,g,I,U=af({matchUpId:c.matchUpId,inContextDrawMatchUps:s,drawDefinition:u}),{targetMatchUps:{winnerMatchUp:y}}=U,S=null==p?void 0:p.drawMatchUps.find((e=>e.matchUpId===c.matchUpId)),w=[];if(c.feedRound)I=null==(i=null==(t=null==y?void 0:y.drawPositions)?void 0:t.filter(Boolean))?void 0:i.find((e=>c.drawPositions.includes(e)));else if(d){if(g=null==(r=gv({structureId:m.structureId,matchUp:d,matchUpsMap:p}))?void 0:r.pairedPreviousMatchUp,v=[Ul,Il].includes(null==g?void 0:g.matchUpStatus),w=(null==(a=null==g?void 0:g.drawPositions)?void 0:a.filter(Boolean))||[],[...Cl,ml].includes(null==g?void 0:g.matchUpStatus)||(null==g?void 0:g.winningSide)){let e=d.drawPositions||[],t=null==(o=c.drawPositions)?void 0:o.filter(Boolean);Ar(e,t)&&(t=null==t?void 0:t.filter((t=>!e.includes(t)))),I=e.concat(w).find((e=>null==t?void 0:t.includes(e)))}}else I=null==(n=Nr((null==c?void 0:c.drawPositions)||[],(null==y?void 0:y.drawPositions)||[]))?void 0:n[0];if(y&&I){let{stage:e,roundNumber:t,roundPosition:i}=y;Gf({method:"removeDirectedWinner",drawPositionToRemove:I,keyColors:uN,color:"brightgreen",stage:e,roundNumber:t,roundPosition:i}),XM({winningDrawPosition:I,winnerMatchUp:y,inContextDrawMatchUps:s,drawDefinition:u,matchUpsMap:p})}let T=dN({targetData:U,matchUp:c,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:u,matchUpsMap:p,structure:m,iteration:f});if(T.error)return Sa({result:T,stack:h});let P=function({pairedPreviousDoubleExit:e,noContextTargetMatchUp:t}){return t.matchUpStatus===ml?ml:e?[Il,gl].includes(null==t?void 0:t.matchUpStatus)?gl:bl:Dl}({pairedPreviousDoubleExit:v,noContextTargetMatchUp:S}),D=!v;return T=LI({...e,matchUpId:c.matchUpId,matchUp:S,removeWinningSide:!0,matchUpStatusCodes:[],context:h,matchUpStatus:P,removeScore:D,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),T.error?Sa({result:T,stack:h}):{...Be}}function pN(e){var t;let{matchUp:i,matchUpStatus:n,score:r,winningSide:a}=e,o="noDownStreamDependencies";if([Ul,Il].includes(null==i?void 0:i.matchUpStatus)&&![Ul,Il].includes(n)){let t=dN(e);if(t.error)return Sa({result:t,stack:o})}let s=n===Ul,l=kf({score:r})&&!s&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!a),u=(null==(t=null==e?void 0:e.inContextMatchUp)?void 0:t.collectionId)&&function(e){var t,i;let{matchUpFormat:n,score:r}=e,a=null==(t=null==r?void 0:r.sets)?void 0:t.length,o=n&&xm(n),{setFormat:s,finalSetFormat:l,bestOf:u}=o??{};return(null==(i=u&&a===u&&l||s)?void 0:i.timed)||!1}(e.inContextMatchUp),d=e.removeScore||!u&&![Sl,cl].includes(n||Sl),c=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||i.winningSide&&!a&&!kf({score:r}),p=n&&n!==Dl,m=t=>{var n,r;let a,{structure:o,drawDefinition:s,dualMatchUp:l,disableAutoCalc:u}=e;if(null!=l&&l._disableAutoCalc&&!1!==u)return _I(e);let{connectedStructureIds:d}=sN({drawDefinition:s,structure:o,matchUp:i});d.length&&(console.log({connectedStructureIds:d}),a=!0),Object.assign(e,{removeScore:t});let c=ZM(e);if(c.error)return c;if(e.removingQualifier&&null!=(r=null==(n=e.appliedPolicies)?void 0:n[ts])&&r.autoRemoveQualifiers){let t=function(e){var t,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:u}=e,d=null==(t=e.targetData.targetLinks)?void 0:t.winnerTargetLink;if(d.target.feedProfile===Ql){let t=null==(n=null==(i=l.sides)?void 0:i.find((({sideNumber:e})=>e===l.winningSide)))?void 0:n.participantId,c=s.find((e=>{var i;return e.structureId===d.target.structureId&&e.roundNumber===d.target.roundNumber&&(null==(i=e.sides)?void 0:i.some((({participantId:e})=>e===t)))}));if(c&&c.matchUpStatus===Dl&&!dy({inContextDrawMatchUps:s,drawDefinition:u,targetData:af({matchUpId:c.matchUpId,inContextDrawMatchUps:s,drawDefinition:u})})){let{structure:i}=_u({structureId:c.structureId,drawDefinition:u}),n=Vu({structure:i}).positionAssignments;for(let s of n||[])if(s.participantId===t){if(s.participantId=void 0,null==i?void 0:i.positionAssignments)i.positionAssignments=n;else if(null!=i&&i.structures){let e=Object.assign({},...(n||[]).map((e=>({[e.drawPosition]:e.participantId}))));for(let t of(null==i?void 0:i.structures)||[])null==(r=t.positionAssignments)||r.forEach((t=>t.participantId=e[t.drawPosition]))}Pd({tournamentId:null==(a=e.tournamentRecord)?void 0:a.tournamentId,event:e.event,drawDefinition:u,structure:i}),o=!0}}}return{qualifierRemoved:o}}(e);return{...Be,connectedStructures:a,...t}}return{...Be,connectedStructures:a}};if(c&&a&&e.isCollectionMatchUp)return mN(e);let f=[fl,cl].includes(n)&&e.dualWinningSideChange;return Sa({result:(a||f)&&lN(e)||l&&m(d)||p&&aN(e)||c&&m(d)||i&&mN({...e,removeScore:!0})||{...Be},stack:o})}function mN(e){var t;let i="scoreModification";if(e.isCollectionMatchUp&&null!=(t=e.dualMatchUp)&&t.winningSide&&!e.projectedWinningSide){let t=ZM(e);if(t.error)return t}let n=LI({...e,context:i});if(e.isCollectionMatchUp){let{matchUpTieId:t,drawDefinition:i,event:n,matchUpsMap:r}=e,{removeWinningSide:a}=uU({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:t,drawDefinition:i,matchUpsMap:r,event:n});a&&console.log("REMOVE WINNING SIDE")}return Sa({result:n,stack:i})}function fN(e){var t;let i="addMatchUpScheduledTime",n=e.matchUp,{removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:u}=e;if(!u)return Sa({result:{error:Qt},stack:i});if(!Uo(l))return Sa({result:{error:yi},stack:i});if(!n){let e=OI({drawDefinition:o,matchUpId:u});if(e.error)return Sa({result:e,stack:i});n=e.matchUp}let d=Co(l),c=Qp({matchUp:n}).scheduledDate,p=d&&!c;if(null!=(t=tm({matchUp:n}).timeModifiers||[])&&t.length){let e=hN({disableNotice:!0,removePriorValues:r,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:u,matchUp:n});if(null!=e&&e.error)return Sa({result:e,stack:i})}let m=Fo(l,!0,p);return _M({duplicateValues:!1,removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:u,timeItem:{itemType:ep,itemValue:m}})}function hN({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return Sa({result:{error:Qt},stack:s});if(void 0!==r&&!Array.isArray(r))return Sa({info:Tv("timeModifiers"),result:{error:Fn},stack:s});if(!o){let e=OI({drawDefinition:i,matchUpId:a});if(e.error)return Sa({result:e,stack:s});o=e.matchUp}let l=tm({matchUp:o}).timeModifiers||[],u=r.filter((e=>!l.includes(e)));if(r.length&&!u.length)return{...Be};if(u.some((e=>cp.includes(e)))){l=l.filter((e=>!cp.includes(e)));let n=fN({disableNotice:!0,removePriorValues:e,scheduledTime:"",tournamentRecord:t,drawDefinition:i,matchUpId:a});if(n.error)return Sa({result:n,stack:s})}let d=null!=r&&r.length?[...u,...l]:void 0;return _M({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:ap,itemValue:d}})}function vN({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtIds:s}){var l,u;if(!i&&!t)return{error:We};if(!o)return{error:Qt};let d,c=OI({drawDefinition:n,matchUpId:o});if(c.error)return c;if((null==(l=null==c?void 0:c.matchUp)?void 0:l.matchUpType)!==Od)return{error:ii};if(!(void 0===s||Array.isArray(s)&&s.length&&s.every((e=>"string"==typeof e))))return{error:Fn,context:{courtIds:s}};if(s){let e=oD({tournamentRecords:t||i&&{[i.tournamentId]:i}});if(e.error)return e;let n=null==(u=e.courts)?void 0:u.filter((e=>s.includes(e.courtId)));if((null==n?void 0:n.length)!==s.length)return{error:Fn,context:{courtIds:s}};d=null==n?void 0:n.map((e=>({venueId:e.venueId,courtId:e.courtId})))}return _M({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Kc,itemDate:a,itemValue:d}})}function gN({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:o}){if(!i)return{error:We};if(!a)return{error:Qt};if(o){let e=lm({tournamentRecords:t,tournamentRecord:i,venueId:o});if(e.error)return e}return _M({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Yc,itemValue:o}})}function IN({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!t)return{error:We};if(!o)return{error:Qt};if(s){let e=dm({tournamentRecords:t,tournamentRecord:i,courtId:s});if(e.error)return e;gN({tournamentRecords:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:null==(l=e.venue)?void 0:l.venueId})}return _M({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Jc,itemDate:a,itemValue:s}})}function UN(e,t){let i=fo.test(e)?e:Eo(e),n=Co(e)||Co(t)||wo(new Date);return new Date(`${n}T${i}`).getTime()}function yN({errorOnAnachronism:e=!1,checkChronology:t=!0,matchUpDependencies:i,inContextMatchUps:n,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,disableNotice:l,drawMatchUps:u,matchUpId:d,schedule:c,event:p}){var m;if(!c)return{error:mi,info:"Missing schedule"};if(!s)return{error:Ke};if(!d)return{error:Qt};let f,h,v="addMatchUpScheduleItems";if(u)f=u.find((e=>e.matchUpId===d));else{let e=OI({drawDefinition:s,event:p,matchUpId:d});if(e.error)return e;f=e.matchUp}let{endTime:g,courtId:I,courtIds:U,courtOrder:y,resumeTime:S,scheduledDate:w,scheduledTime:T,startTime:P,stopTime:D,timeModifiers:b,venueId:M}=c;t&&(!i||!n)&&({matchUpDependencies:i,matchUps:n}=Of({drawDefinition:s}));let N=null==(m=null==i?void 0:i[d])?void 0:m.matchUpIds;if(c.scheduledDate&&t&&N){let t=null==n?void 0:n.filter((e=>{var t,i;return((null==(t=e.schedule)?void 0:t.scheduledDate)||Co(null==(i=e.schedule)?void 0:i.scheduledTime))&&N.includes(e.matchUpId)})).map((({schedule:e})=>{let t=go(e);return new Date(t).getTime()}));if(null!=t&&t.length){let i=go(c),n=new Date(i).getTime();if(Math.max(...t)>=n){if(e)return Sa({result:{error:Ve},stack:v});h=Ve}}}if(void 0!==w){let e=SN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledDate:w,matchUpId:d});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{scheduledDate:w}})}if(void 0!==T){let e=fN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledTime:T,matchUpId:d,matchUp:f});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{scheduledTime:T}})}if(void 0!==P){let e=PN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:d,startTime:P,event:p});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{startTime:P}})}if(void 0!==D){let e=bN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:d,stopTime:D,event:p});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{stopTime:D}})}if(void 0!==S){let e=MN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,resumeTime:S,matchUpId:d,event:p});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{resumeTime:S}})}if(void 0!==g){let e=DN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:d,endTime:g,event:p});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{endTime:g}})}if(void 0!==U){let e=vN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:d,courtIds:U});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{courtIds:U}})}if(void 0!==I&&void 0!==w){let e=IN({courtDayDate:w,disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:d,courtId:I});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{courtId:I}})}if(void 0!==M){let e=gN({disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:d,venueId:M});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{venueId:M}})}if(void 0!==y&&mr(y)){let e=wN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,courtOrder:y,matchUpId:d});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{courtOrder:y}})}if(void 0!==b){let e=hN({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,timeModifiers:b,matchUpId:d,matchUp:f});if(null!=e&&e.error)return Sa({result:e,stack:v,context:{timeModifiers:b}})}return l||yd({tournamentId:null==o?void 0:o.tournamentId,eventId:null==p?void 0:p.eventId,context:v,drawDefinition:s,matchUp:f}),h?{...Be,warnings:[h]}:{...Be}}function SN({scheduledDate:e,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:Qt};let o=e&&ho.test(e);return e&&!o?{error:Ui}:_M({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemValue:Co(e),itemType:Zc}})}function wN({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:Qt};if(r&&!mr(r))return{error:Fn,info:"courtOrder must be numeric"};let o=r&&rr(r);return _M({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:Qc,itemValue:o}})}function TN({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:o}){if(!o)return{error:Qt};if(!r)return{error:_i};if(t){if(!us({tournamentParticipants:vh({tournamentRecord:t,participantFilters:{participantTypes:[Qd],participantRoles:[Oh]}}).participants??[],participantId:r}))return{error:Bi}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(s.itemSubTypes=[a]),_M({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:s})}function PN({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:o}){if(!r)return{error:Qt};if(!Uo(a))return{error:yi};let{matchUp:s}=OI({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Qp({matchUp:s}),u=((null==s?void 0:s.timeItems)??[]).filter((e=>[ip,np,rp].includes(null==e?void 0:e.itemType))).map((e=>UN(e.itemValue,l))).reduce(((e,t)=>!e||t<e?t:e),void 0);if(!u||UN(a,l)<u){null!=s&&s.timeItems&&(s.timeItems=s.timeItems.filter((e=>e.itemType!==tp)));let o=Fo(a,!0,!0);return _M({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:tp,itemValue:o}})}return{error:gn}}function DN({validateTimeSeries:e=!0,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:o,event:s}){if(!a)return{error:Qt};if(!Uo(o))return{error:yi};let{matchUp:l}=OI({drawDefinition:n,event:s,matchUpId:a}),{scheduledDate:u}=Qp({matchUp:l}),d=((null==l?void 0:l.timeItems)??[]).filter((e=>[tp,np,ip].includes(null==e?void 0:e.itemType))).map((e=>UN(e.itemValue,u))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(!e||!d||UN(o,u)>d){null!=l&&l.timeItems&&(l.timeItems=l.timeItems.filter((e=>e.itemType!==rp)));let e=Fo(o,!0,!0);return _M({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:rp,itemValue:e}})}return{error:fn}}function bN({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:o}){if(!r)return{error:Qt};if(!Uo(a))return{error:yi};let{matchUp:s}=OI({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Qp({matchUp:s}),u=(null==s?void 0:s.timeItems)??[];if(u.reduce(((e,t)=>t.itemType===rp||e),void 0))return{error:hn};let d=u.filter((e=>[tp,np,ip].includes(null==e?void 0:e.itemType))).sort(((e,t)=>UN(e.itemValue,l)-UN(t.itemValue,l))),c=d[d.length-1],p=c&&c.itemType===ip,m=d.filter((e=>!p||e.createdAt!==c.createdAt)).map((e=>UN(e.itemValue,l))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(UN(a,l)>m){if(null!=s&&s.timeItems&&p){let e=c.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return _M({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemValue:Fo(a,!0,!0),itemType:ip}})}return{error:vn}}function MN({removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:o}){if(!a)return{error:Qt};if(!Uo(r))return{error:yi};let{matchUp:s}=OI({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=Qp({matchUp:s}),u=(null==s?void 0:s.timeItems)??[];if(u.reduce(((e,t)=>t.itemType===rp||e),void 0))return{error:hn};let d=u.filter((e=>[tp,np,ip].includes(null==e?void 0:e.itemType))).sort(((e,t)=>UN(e.itemValue,l)-UN(t.itemValue,l))),c=d[d.length-1],p=c&&c.itemType===np,m=d.filter((e=>!p||e.createdAt!==c.createdAt)).map((e=>UN(e.itemValue,l))).reduce(((e,t)=>!e||t>e?t:e),void 0);if(UN(r,l)>m){if(null!=s&&s.timeItems&&p){let e=c.createdAt;s.timeItems=s.timeItems.filter((t=>t.createdAt!==e))}return _M({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemValue:Fo(r,!0,!0),itemType:np}})}return{error:In}}function NN(e){var t,i,n,r;let a="setMatchUpStatus";e.matchUpStatus&&[bl,Ul].includes(e.matchUpStatus)&&(e.score=void 0);let{allowChangePropagation:o,disableScoreValidation:s,tournamentRecords:l,tournamentRecord:u,disableAutoCalc:d,enableAutoCalc:c,drawDefinition:p,matchUpStatus:m,winningSide:f,matchUpId:h,event:v,score:g}=e;if(!p)return{error:Ke};if(m&&[fl,Sl,cl,Dl].includes(m)&&f)return{error:Fn,winningSide:f,matchUpStatus:m};if(![void 0,...Rl].includes(m))return Sa({result:{error:Wt},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let I=Wd({drawDefinition:p}),{matchUps:U}=uf({nextMatchUps:!0,tournamentRecord:u,inContext:!0,drawDefinition:p,matchUpsMap:I,event:v}),y=I.drawMatchUps.find((e=>e.matchUpId===h)),S=null==U?void 0:U.find((e=>e.matchUpId===h));if(!y||!U)return{error:Xt};if((y.winningSide||f)&&m===ml)return{context:"Cannot have Bye with winningSide",error:qt,matchUpStatus:m};let w,T=null==S?void 0:S.structureId,{structure:P}=_u({drawDefinition:p,structureId:T}),D=wp(kd)(y.matchUpType),b=null==(t=null==S?void 0:S.drawPositions)?void 0:t.filter(Boolean);if(D){if(d)fs({extension:{name:Cs,value:!0},element:y});else if(c){let t=y.winningSide;ps({name:Cs,element:y});let{winningSide:i,scoreStringSide1:n,scoreStringSide2:r,set:a}=rU({drawDefinition:p,matchUpsMap:I,structure:P,matchUp:y,event:v}),o={scoreStringSide1:n,scoreStringSide2:r,sets:a?[a]:[]};w=i!==t,Object.assign(e,{winningSide:i,dualWinningSideChange:w,projectedWinningSide:i,score:o})}aU({tournamentId:null==u?void 0:u.tournamentId,inContextDualMatchUp:S,eventId:null==v?void 0:v.eventId,dualMatchUp:y,drawDefinition:p})}if(D&&m&&[pl].includes(m))return{error:Fn,info:"Not supported for matchUpType: TEAM"};let M=null==S?void 0:S.matchUpTieId,N=af({matchUpId:M||h,inContextDrawMatchUps:U,drawDefinition:p});if(g&&!D&&!s){let e=y.matchUpFormat??(null==P?void 0:P.matchUpFormat)??(null==p?void 0:p.matchUpFormat)??(null==v?void 0:v.matchUpFormat),t=vT({existingMatchUpStatus:y.matchUpStatus,matchUpFormat:e,matchUpStatus:m,winningSide:f,score:g});if(t.error)return t}let R=null!=y&&y.sides?[]:Vu({drawDefinition:p,structureId:T}).positionAssignments,A=null==(i=null==S?void 0:S.sides)?void 0:i.map((e=>e.participantId)).filter(Boolean).length,E=A&&2===A||y.collectionId&&Nm({structure:P})&&A&&A>=1||2===(null==b?void 0:b.length)&&(null==R?void 0:R.filter((e=>b.includes(e.drawPosition))).every((e=>e.participantId)));if(m&&Nl.includes(m)&&!E)return Sa({info:"present in participantsRequiredMatchUpStatuses",context:{matchUpStatus:m,requiredParticipants:E},result:{error:Wt}});let C=(null==(n=jc({policyTypes:[ts,rs],tournamentRecord:u,drawDefinition:p,event:v}))?void 0:n.appliedPolicies)??{};"object"==typeof e.policyDefinitions&&Object.assign(C,e.policyDefinitions);let O=(null==S?void 0:S.stage)===Ll&&1===S.finishingRound,k=O&&f,F=O&&y.winningSide&&!f&&(!e.matchUpStatus||e.matchUpStatus&&xf({matchUpStatus:e.matchUpStatus}))&&(!e.outcome||!kf({outcome:e.outcome})),x=k&&f!==y.winningSide&&y.winningSide;if(Object.assign(e,{inContextDrawMatchUps:U,qualifierAdvancing:k,qualifierChanging:x,removingQualifier:F,inContextMatchUp:S,appliedPolicies:C,matchUpTieId:M,matchUpsMap:I,targetData:N,structure:P,matchUp:y}),M){let{matchUp:t}=OI({matchUpId:M,inContext:!0,drawDefinition:p,matchUpsMap:I,event:v});if(t){let i=null==(r=Um({matchUp:t,drawDefinition:p,structure:P,event:v}))?void 0:r.tieFormat,{projectedWinningSide:n}=function({drawDefinition:e,matchUpStatus:t,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:o,matchUp:s,event:l,score:u}){var d;let c=Wo(r,void 0,!0);for(let m of(null==c?void 0:c.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=n,m.score=u,kf({score:u})||t?t&&(m.matchUpStatus=t):Object.assign(m,{...xI}));a=a??(null==(d=Um({matchUp:s,structure:o,drawDefinition:e,event:l}))?void 0:d.tieFormat);let{winningSide:p}=rU({matchUp:c,drawDefinition:e,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}({drawDefinition:p,matchUpStatus:m,dualMatchUp:t,matchUpsMap:I,winningSide:f,tieFormat:i,structure:P,matchUp:y,event:v,score:g});w=n!==t.winningSide,Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:w,projectedWinningSide:n,matchUpTieId:M,dualMatchUp:t,tieFormat:i})}}let L=dy(e),_=Ff({matchUpStatus:m});if(!M){if(L&&!f&&(m&&xf({matchUpStatus:m})||m&&[Ul,Il].includes(m)))return{error:qt,activeDownstream:L,winningSide:f};if(f&&f===y.winningSide&&m&&!_)return{context:"winningSide must include directing matchUpStatus",error:qt,directingMatchUpStatus:_,matchUpStatus:m}}let{schedule:B}=e;if(B){let e=yN({disableNotice:!0,tournamentRecords:l,tournamentRecord:u,drawDefinition:p,matchUpId:h,schedule:B});if(e.error)return e}let j=!D&&!w&&f&&y.winningSide&&y.winningSide!==f;if(o&&j&&y.roundPosition)return function(e){var t;let{tournamentRecord:i,inContextMatchUp:n,structure:r,drawDefinition:a}=e,o=n.roundNumber,s=n.sides.find((e=>e.sideNumber===n.winningSide)),l=n.sides.find((e=>e.sideNumber!==n.winningSide)),{drawPosition:u,participantId:d}=s,{drawPosition:c,participantId:p}=l,m="swapWinnerLoser",{matchUps:f}=Zm(e),h=f.filter((({drawPositions:e,roundNumber:t})=>(null==e?void 0:e.includes(u))&&t>o));$r({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach((t=>{var n,r;t.drawPositions=(null==(n=t.drawPositions)?void 0:n.map((e=>e===u?c:e)))||[],yd({tournamentId:null==i?void 0:i.tournamentId,eventId:null==(r=e.event)?void 0:r.eventId,context:m,drawDefinition:a,matchUp:t})}));let{stage:v,stageSequence:g}=r,I=a.structures.filter((({stage:e,stageSequence:t})=>e===v&&t>g)).map((({structureId:e})=>e)),{targetLinks:{loserTargetLink:U,winnerTargetLink:y}}=e.targetData,S=[null==U?void 0:U.target.structureId,null==(t=null==y?void 0:y.target)?void 0:t.structureId].filter(Boolean);return a.structures.filter((({stage:e,structureId:t})=>e!==v&&S.includes(t))).forEach((({stage:e,stageSequence:t,structureId:i})=>{I.includes(i)||I.push(i),a.structures.filter((({stage:i,stageSequence:n})=>i===e&&n>t)).forEach((({structureId:e})=>{I.includes(e)||I.push(e)}))})),a.structures.filter((({structureId:e})=>I.includes(e))).forEach((e=>{let{positionAssignments:t}=Vu({structure:e}),i=null==t?void 0:t.find((({participantId:e})=>e===d)),n=null==t?void 0:t.find((({participantId:e})=>e===p));i&&(i.participantId=p),n&&(n.participantId=d)})),LI({...e,context:m})}(e);let V=f&&!M||e.projectedWinningSide;Gf({activeDownstream:L,matchUpWinner:V,method:a,winningSide:f});let G=!L&&pN(e)||V&&function(e){let{matchUp:t,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=e;return i===t.winningSide||n&&!r?RN(e):Sa({stack:"winningSideWithDownstreamDependencies",result:{error:Ri},context:{winningSide:i,matchUp:t}})}(e)||_&&RN(e)||{error:_n};return Sa({result:G,stack:a})}function RN(e){let{tournamentRecord:t,matchUp:i,event:n}=e,r=e.isCollectionMatchUp&&i.winningSide&&!e.winningSide&&!kf({score:e.score}),a=e.isCollectionMatchUp?e.matchUpStatus||r&&Dl||hl:e.matchUpStatus||hl,o=e.removeScore||[fl,bl].includes(a)&&![Sl,cl].includes(a),s=LI({...e,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:o});if(s.error)return s;if(e.isCollectionMatchUp){let{matchUpTieId:i,drawDefinition:r,matchUpsMap:a}=e,o=uU({appliedPolicies:e.appliedPolicies,matchUpId:i,tournamentRecord:t,drawDefinition:r,matchUpsMap:a,event:n});if(o.error)return o;Object.assign(s,{tieMatchUpResult:o})}return s}function AN({tournamentRecord:e,drawDefinition:t,matchUpId:i,event:n}){if(!t)return{error:Ke};let{matchUp:r}=OI({drawDefinition:t,matchUpId:i,event:n});return(null==r?void 0:r.matchUpType)!==Od?{error:ii}:NN({enableAutoCalc:!0,tournamentRecord:e,drawDefinition:t,matchUpId:i,event:n})}function EN({drawDefinition:e,event:t,matchUpId:i}){if(!e)return{error:Ke};if(!i)return{error:Qt};let{matchUp:n}=OI({drawDefinition:e,event:t,matchUpId:i});return n?ps({name:Rs,element:n}):{error:Xt}}function CN(e){return function({substituteParticipantId:e,existingParticipantId:t,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:o}){var s,l,u,d,c;let p="substituteParticipant";if(!n)return{error:Ke};if(!a)return{error:Qt};if(!t||!e)return Sa({result:{error:_i},stack:p});let{matchUp:m}=OI({drawDefinition:n,matchUpId:a,event:o});if(!m)return{error:Xt};if(!m.collectionId)return Sa({result:{error:ii},stack:p});let f=Wd({drawDefinition:n}),{matchUps:h}=uf({tournamentParticipants:null==i?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:f}),v=null==h?void 0:h.find((e=>e.matchUpId===a)),g=null==(l=null==(s=null==h?void 0:h.find((e=>e.matchUpId===(null==v?void 0:v.matchUpTieId))))?void 0:s.sides)?void 0:l.find((e=>e.participant.individualParticipants.some((({participantId:e})=>e===t))));return!g||r&&g.sideNumber!==r?{error:Ei}:null!=(c=null==(d=null==(u=g.participant)?void 0:u.individualParticipants)?void 0:d.map(sl).filter((e=>e!==t)))&&c.includes(e)?$M({newParticipantId:e,tieMatchUpId:a,existingParticipantId:t,substitution:!0,tournamentRecord:i,drawDefinition:n,event:o}):Sa({result:{error:Ei},stack:p})}(e)}function ON({drawDefinition:e,matchUpId:t,event:i}){if(!e)return{error:Ke};let{matchUp:n}=OI({drawDefinition:e,matchUpId:t,event:i});return fs({extension:{name:Cs,value:!0},element:n})}function kN(e){let t="setMatchUpFormat",i=io(e,[{tournamentRecord:!0},{[Ya]:e=>JI({matchUpFormat:e}),[Ja]:$t,matchUpFormat:!0}]);if(i.error)return Sa({result:i,stack:t});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:u,matchUpId:d,eventId:c,stages:p,drawId:m,event:f,force:h}=e;if(a&&!Array.isArray(a))return Sa({result:{error:Fn,scheduledDates:a},stack:t});if(u&&!$m([Bp,Vp],u))return Sa({result:{error:At},stack:t});let v=0,g=e.structureIds||l&&[l].filter(Boolean)||[],I=e.eventIds||c&&[c].filter(Boolean)||[],U=e.drawIds||m&&[m].filter(Boolean)||[];if((l||null!=g&&g.length)&&!r)return Sa({result:{error:Ke},stack:t});if(m&&d&&r){let e=IP({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:g,structureId:l,matchUpId:d});if(e.error)return e;v+=1}let y=e=>{let i=[];for(let r of e.structures||[]){if(Array.isArray(p)&&!p.includes(r.stage)||Array.isArray(o)&&!o.includes(r.stageSequence)||null!=g&&g.length&&!g.includes(r.structureId))continue;null!=g&&g.length&&r.matchUpFormat!==s&&(r.matchUpFormat=s,i.push(r.structureId),v+=1);let l=((h||a)&&Zm({matchUpFilters:{matchUpStatuses:[Dl]},structure:r}).matchUps)??[],u=(a&&Zm({matchUpFilters:{matchUpStatuses:[Dl]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:r}).matchUps)??[];if(null!=l&&l.length){let i=u?u.map(ll):l.map(ll);for(let r of l)i.includes(r.matchUpId)&&(r.matchUpFormat=null!=a&&a.length?s:void 0,yd({tournamentId:null==n?void 0:n.tournamentId,eventId:null==f?void 0:f.eventId,context:t,drawDefinition:e,matchUp:r}))}}return!i.length&&e.matchUpFormat!==s&&(e.matchUpFormat=s,v+=1),i};for(let S of(null==n?void 0:n.events)||[])if(!(null!=I&&I.length&&!I.includes(S.eventId)||u&&u!==S.eventType||u===$p))if(Array.isArray(o)||Array.isArray(p)||null!=g&&g.length||null!=U&&U.length)for(let e of S.drawDefinitions||[]){if(Array.isArray(U)&&!U.includes(e.drawId))continue;wd({structureIds:y(e),drawDefinition:e})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,v+=1);return v?{...Be,modificationsCount:v}:{...Be,info:Mn}}function FN({inheritance:e=!0,tournamentRecord:t,drawDefinition:i,matchUpId:n,event:r}){var a,o;if(!i)return{error:Ke};let s=null==(a=OI({drawDefinition:i,matchUpId:n}))?void 0:a.matchUp;if(null==s||!s.tieMatchUps)return{error:ii};let l=null==(o=OI({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))?void 0:o.matchUp,u=0;return((null==s?void 0:s.sides)||[]).forEach((e=>{e.lineUp&&delete e.lineUp})),((null==l?void 0:l.sides)||[]).forEach((n=>{if(u+=1,!1===e){let e=null==l?void 0:l.tieFormat,t=n.participantId;e&&t&&Dv({drawDefinition:i,participantId:t,lineUp:[],tieFormat:e})}yd({tournamentId:null==t?void 0:t.tournamentId,context:"resetMatchUpLineUps",eventId:null==r?void 0:r.eventId,drawDefinition:i,matchUp:s})})),{...Be,modificationsCount:u}}function xN(e){let{matchUpFormat:t,matchUpStatus:i,winningSide:n,score:r}=e;if(!r)return{sets:[]};let a=r.sets||[],o=AS({winnerFirst:!1,matchUpFormat:t,matchUpStatus:i,sets:a}),s=AS({winnerFirst:!1,reversed:!0,matchUpFormat:t,matchUpStatus:i,sets:a}),l=AS({matchUpFormat:t,matchUpStatus:i,winningSide:n,sets:a}),u=o===l?s:o;return n&&(o=1===n?l:u,s=2===n?l:u),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function LN(e){var t;let i=io(e,[{[Oa]:!0,[Da]:!0}]);if(i.error)return i;let n=Ld(e);if(!e.drawDefinition){let t=e.tournamentRecord??(e.tournamentId&&n[e.tournamentId]);e.tournamentRecord||(e.tournamentRecord=t);let i=hm({eventId:e.eventId,drawId:e.drawId,tournamentRecord:t});if(i.error)return i;i.drawDefinition&&(e.drawDefinition=i.drawDefinition),e.event=i.event}let{disableScoreValidation:r,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:u,matchUpFormat:d,matchUpId:c,schedule:p,event:m,notes:f}=e,{policy:h}=Gc({policyType:rs,tournamentRecord:o,event:m}),v=void 0!==e.allowChangePropagation&&e.allowChangePropagation||void 0!==(null==h?void 0:h.allowChangePropagation)&&h.allowChangePropagation||void 0,{outcome:g}=e;if(null!=g&&g.winningSide&&![1,2].includes(g.winningSide))return{error:Pi};if(d){let e=IP({tournamentRecord:o,drawDefinition:u,matchUpFormat:d,matchUpId:c,event:m});if(e.error)return e}if(null!=(t=null==g?void 0:g.score)&&t.sets&&!g.score.scoreStringSide1){let{score:e}=xN(g);g.score=e,g.score.sets=g.score.sets.filter((e=>e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore))}return NN({matchUpStatusCodes:null==g?void 0:g.matchUpStatusCodes,matchUpStatus:null==g?void 0:g.matchUpStatus,winningSide:null==g?void 0:g.winningSide,allowChangePropagation:v,disableScoreValidation:r,score:null==g?void 0:g.score,tournamentRecords:n,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:u,matchUpFormat:d,matchUpId:c,schedule:p,event:m,notes:f})}function _N(e){if(null==e||!e.outcomes)return{error:mi};if(!Array.isArray(e.outcomes))return{error:mi,info:{outcomes:e.outcomes}};let t=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},i=e.outcomes??[],n=i.reduce(((e,t)=>e.includes(t.tournamentId)?e:e.concat(t.tournamentId)),[]);for(let r of n){let e=t[r];if(!e)return{error:We};let n=i.filter((e=>e.tournamentId===r));if(n.length){let t=BN({outcomes:n,tournamentRecord:e});if(t.error)return t}}return{...Be}}function BN(e){var t;let{tournamentRecords:i,tournamentRecord:n,outcomes:r,policyDefinitions:a}=e,o={};r.forEach((e=>{let{eventId:t}=e;o[t]||(o[t]=[]),o[t].push(e)}));for(let s of Object.keys(o)){let{event:e}=hm({tournamentRecord:n,eventId:s});for(let r of o[s]){let{drawId:o}=r,s=null==(t=null==e?void 0:e.drawDefinitions)?void 0:t.find((e=>e.drawId===o));if(s&&o){let{matchUpFormat:t,matchUpId:l}=r,u=LN({schedule:null==r?void 0:r.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:n,drawDefinition:s,matchUpFormat:t,matchUpId:l,outcome:r,drawId:o,event:e});if(u.error)return u}}}return{...Be}}function jN(e){return function({drawDefinition:e,matchUpId:t,outcome:i,matchUp:n}){var r,a;if(!n&&!e)return{error:Ke};if(!i)return{error:mi,info:"missing outcome"};if(!n&&!t)return{error:ti};if(!n){let i=OI({drawDefinition:e,matchUpId:t});if(i.error)return i;n=i.matchUp}return"object"==typeof i&&null!=(r=i.score)&&r.scoreStringSide1&&null!=(a=i.score)&&a.scoreStringSide2?fs({element:n,extension:{name:Rs,value:i}}):{error:Fn}}(e)}function VN(e){var t,i;let n="resetTieFormat",{drawDefinition:r,event:a,uuids:o}=e,s=io(e,[{[Pa]:!0,[Oa]:!0}],n);if(s.error)return s;let l=eb(e,[{[Wa]:Va}]);if(l[$a])return l;let u=null==(t=e.tournamentRecord)?void 0:t.tournamentId,{matchUp:d,structure:c}=(null==l?void 0:l.matchUp)??{};if(null==d||!d.tieMatchUps)return Sa({result:{error:ii},info:"Must be a TEAM matchUp",stack:n});if(!d.tieFormat)return{...Be};let p=null==(i=Um({structure:c,drawDefinition:r,event:a}))?void 0:i.tieFormat;if(!p)return Sa({result:{error:Vn},info:"No inherited tieFormat",stack:n});let m=[],f=[],h=[],v=[];for(let g of p.collectionDefinitions){let{matchUpCount:e,collectionId:t}=g;f.push(t);let i=(d.tieMatchUps||[]).filter((e=>e.collectionId===t));if(i.length>e)i.sort(((e,t)=>(e.matchUpStatus===Dl?1:0)-(t.matchUpStatus===Dl?1:0))),h.push(...i.slice(0,e)),m.push(...i.slice(3).map(ll));else if(h.push(...i),i.length<e){let t=aI({collectionDefinition:g,matchUpsLimit:e-i.length,matchUp:d,uuids:o});v.push(...t)}}for(let g of(null==d?void 0:d.tieMatchUps)||[])g.collectionId&&!f.includes(g.collectionId)&&m.push(g.matchUpId);return v.length&&(h.push(...v),Id({eventId:null==a?void 0:a.eventId,matchUps:v,drawDefinition:r,tournamentId:u})),m.length&&Ud({matchUpIds:m,eventId:null==a?void 0:a.eventId,drawDefinition:r,tournamentId:u}),d&&(d.tieMatchUps=h,d.tieFormatId=void 0,d.tieFormat=void 0,yd({structureId:null==c?void 0:c.structureId,eventId:null==a?void 0:a.eventId,context:n,drawDefinition:r,tournamentId:u,matchUp:d})),{...Be,newMatchUps:v,deletedMatchUpIds:m}}function GN(e){var t,i,n;let{tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s}=e,l="resetScorecard";if(!a)return Sa({result:{error:Ke},stack:l});if(!o)return Sa({result:{error:Qt},stack:l});if(!Ee(o))return Sa({result:{error:Fn,matchUpId:o},stack:l});let u=Wd({drawDefinition:a}),{matchUps:d}=uf({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:u}),c=u.drawMatchUps.find((e=>e.matchUpId===o)),p=null==d?void 0:d.find((e=>e.matchUpId===o));if(!c||!d)return{error:Xt};if(c.matchUpType!==qp)return{error:ii};let m=af({inContextDrawMatchUps:d,drawDefinition:a,matchUpId:o}),f=null==p?void 0:p.structureId,{structure:h}=_u({drawDefinition:a,structureId:f});if(Object.assign(e,{inContextDrawMatchUps:d,inContextMatchUp:p,matchUpsMap:u,targetData:m,structure:h,matchUp:c}),dy(e))return{error:Ri};if(null!=(t=c.tieMatchUps)&&t.length)for(let I of c.tieMatchUps){let e=NN({matchUpId:I.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:a,event:s});if(e.error)return Sa({result:e,stack:l})}let v=null==(i=jc({tournamentRecord:r,drawDefinition:a,event:s}))?void 0:i.appliedPolicies,g=uU({event:e.event,removeScore:!0,tournamentRecord:r,appliedPolicies:v,drawDefinition:a,matchUpsMap:u,matchUpId:o});if(g.error)return Sa({result:g,stack:l});if(e.tiebreakReset&&!g.tieFormatRemoved){let e=null==(n=Um({drawDefinition:a,structure:h,event:s}))?void 0:n.tieFormat;if(c.tieFormat&&e){let{matchUpCountDifference:t,descendantDifferences:i,ancestorDifferences:n,valueDifference:l}=QP({descendant:c.tieFormat,ancestor:e});if(1===i.collectionIds.length&&!n.collectionIds.length&&!n.groupsCount&&1===t&&1===l){let e=VN({tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s});if(e.error)return e}}}return{...Be}}function $N(e){let t=io(e,[{[Da]:!0,[qa]:!0},{[Xa]:{[Ea]:!1,roundNumbers:!1},[Ka]:"At least one must be provided",[Qa]:za}]);if(t.error)return t;let i=PU(e);if(i.error)return i;let{matchUpIds:n}=i,r=wp(qp)(e.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=e;for(let l of n){if(r){let t=GN({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(t.error||e.removeAssignments&&FN({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return t}let t=NN({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(t.error)return t;if(e.removeAssignments){let t=JM({...e,matchUpId:l});if(t.error)return t}}return{...Be}}function qN(e){return function({drawDefinition:e,finishingOrder:t}){var i;if(!e)return{error:Ke};let n="setOrderOfFinish";if(!Array.isArray(t))return Sa({info:Tv("finishingOrder"),result:{error:Fn},stack:n});let{completedMatchUps:r,matchUpsMap:a}=df({inContext:!0,drawDefinition:e}),o=(null==r?void 0:r.map(ll))??[],s=t.map(ll),{matchUpTypes:l,roundNumbers:u,structureIds:d,matchUpTieIds:c}=(r??[]).filter((({matchUpId:e})=>s.includes(e))).reduce(((e,t)=>{let{matchUpTieId:i,matchUpType:n,roundNumber:r,structureId:a}=t;return e.matchUpTypes.includes(n)||e.matchUpTypes.push(n),e.roundNumbers.includes(r)||e.roundNumbers.push(r),e.structureIds.includes(a)||e.structureIds.push(a),e.matchUpTieIds.includes(i)||e.matchUpTieIds.push(i),e}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||c.length>1||u.length>1||d.length>1)return Sa({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Fn},stack:n});let p,m,f={},h=[],v=[];if(!t.every((({orderOfFinish:e,matchUpId:t})=>(h.push(t),e&&v.push(e),f[t]=e,p=o.includes(t),m=void 0===e||mr(e)&&Math.floor(e)>0,p&&m))))return Sa({result:{error:p?Fn:Wt},info:(p?!m&&"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed")||void 0,stack:n});let g=null==r?void 0:r.filter((e=>e.structureId===d[0]&&e.roundNumber===u[0]&&e.matchUpType===l[0]&&e.matchUpTieId===c[0]&&!h.includes(e.matchUpId)));for(let I of g??[]){let{orderOfFinish:e}=I||{};if(e){if(!mr(e))return Sa({context:{orderOfFinish:e,matchUp:I},result:{error:Fn},stack:n});v.push(e)}}if(Tr(v).length!==v.length||Math.max(...v)>v.length)return Sa({info:"Values not unique or greater than expected number of values",result:{error:Fn},stack:n});if(d.length){let t=ef({matchUpFilters:{matchUpIds:s},structureId:d[0],drawDefinition:e,matchUpsMap:a});if(t.error)return Sa({result:t,stack:n});null==(i=t.completedMatchUps)||i.forEach((e=>e.orderOfFinish=f[e.matchUpId]))}return{...Be}}(e)}function WN({tournamentRecord:e,drawDefinition:t,matchUpId:i,lineUps:n,event:r}){var a,o,s,l;if(!e)return{error:We};if(!t)return{error:Qe};if("string"!=typeof i)return{error:ii};if(!Array.isArray(n))return{error:Fn,lineUps:n};let u=e.participants||[],d=OI({tournamentParticipants:u,inContext:!0,drawDefinition:t,matchUpId:i});if(d.error)return d;if(!d.matchUp)return{error:Xt};let{matchUp:c,structure:p}=d,{drawPositions:m,matchUpType:f}=c;if(f!==kd)return{error:ii};if(null==m||!m.length)return{error:at};let h=null==(a=Um({matchUp:c,drawDefinition:t,structure:p,event:r}))?void 0:a.tieFormat,v={};for(let I of n){if(!Array.isArray(I))return{error:Fn,lineUp:I};let t={},i=[];for(let e of I){if("object"!=typeof e)return{error:Fn,lineUpAssignment:e};let{participantId:n,collectionAssignments:r=[]}=e;if(!Array.isArray(r))return{error:Fn,collectionAssignments:r};let a=u.find((e=>e.participantId===n));if(!a)return{error:Bi};if(a.participantType!==Qd)return{error:ki};let d=null==(s=null==(o=c.sides)?void 0:o.find((e=>{var t,i;return null==(i=null==(t=e.participant)?void 0:t.individualParticipantIds)?void 0:i.includes(n)})))?void 0:s.sideNumber;d&&i.push(d);for(let e of r){if("object"!=typeof e)return{error:Fn,collectionAssignment:e};let{collectionId:i,collectionPosition:r}=e,a=null==(l=null==h?void 0:h.collectionDefinitions)?void 0:l.find((e=>e.collectionId===i));if(!a)return{error:Fn,collectionId:i};let o=`${i}-${r}`;t[o]||(t[o]=[]);let s=t[o].length;if(wp(Ad)(a.matchUpType)&&s||a.matchUpType===Cd&&s>1)return{info:"Excessive collectionPosition assignments",error:Fn};t[o].push(n)}}let n=Object.values(t);for(let o of n)if(2===o.length){let{participant:t}=Pm({tournamentParticipants:u,participantIds:o});if(!t){let t=Nb({participant:{participantType:Xd,participantRole:Ah,individualParticipantIds:o},pairOverride:!0,tournamentRecord:e});if(t.error)return t}}let r=Ur(i),a=((r[1]||0)>(r[2]||0)?1:(r[2]||0)>(r[1]||0)&&2)||void 0,d=Object.keys(v).map((e=>parseInt(e)));a&&!d.includes(a)&&(v[a]=I)}if(!Object.keys(v).length)return{error:jn};if(d=OI({drawDefinition:t,matchUpId:i}),d.error)return d;if(!d.matchUp)return{error:Xt};let{matchUp:g}=d;g.sides||(g.sides=[]);for(let I of[1,2]){let e=g.sides.find((e=>e.sideNumber===I)),t=v[I];t&&(e?e.lineUp=t:g.sides.push({lineUp:t,sideNumber:I}))}return yd({tournamentId:null==e?void 0:e.tournamentId,context:"applyLineUps",drawDefinition:t,matchUp:g}),{...Be}}var HN={};be(HN,{anonymizeTournamentRecord:()=>cA,generate:()=>zN,generateEventWithDraw:()=>QR,generateOutcome:()=>jR,generateOutcomeFromScoreString:()=>YN,generateParticipants:()=>OR,generateTournamentRecord:()=>uA,modifyTournamentRecord:()=>pA,mutate:()=>dA});var zN={};function YN(e){let{matchUpFormat:t,matchUpStatus:i,winningSide:n,scoreString:r}=e;if(!r)return{outcome:{...xI,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Fn,winningSide:n};let a=r&&UT({scoreString:r}),o={},s=AS({sets:a,matchUpFormat:t}),l=AS({sets:a,reversed:!0,matchUpFormat:t});return 2===n?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=UT({scoreString:o.scoreStringSide1}),ya({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function KN({matchUpScheduleTimes:e,matchUpDependencies:t,allDateMatchUpIds:i,matchUp:n}){var r;let a=((null==(r=null==t?void 0:t[n.matchUpId])?void 0:r.matchUpIds)||[]).filter((e=>i.includes(e))).filter((t=>!e[t]));return{dependenciesScheduled:!(null!=a&&a.length),remainingDependencies:a}}function JN({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:t,timeAfterRecovery:i,matchUp:n}){var r,a,o,s;let{individualParticipantIds:l}=xd(n);i=i??(null==(r=n.schedule)?void 0:r.timeAfterRecovery);let u=t=>{e[t]||(e[t]=[]),e[t]=hr(e[t].concat(...l))},d=e=>{i&&(!t[e]||i>t[e])&&(t[e]=i)},c=(null==(a=n.winnerTo)?void 0:a.matchUpId)||n.winnerMatchUpId;c&&(i&&d(c),u(c));let p=(null==(o=n.loserTo)?void 0:o.matchUpId)||n.loserMatchUpId;p&&(i&&d(p),u(p)),null!=(s=n.sidesTo)&&s.length&&n.sidesTo.forEach((({matchUpId:e})=>{e&&(i&&d(e),u(e))}))}function QN({individualParticipantProfiles:e,participantId:t}){e[t]||(e[t]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function ZN({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var u,d;let c=Eo(null==(u=null==l?void 0:l.schedule)?void 0:u.endTime),p=c?jo(c,rr(o)):jo(s,rr(n)+rr(o)),m=i&&(c?jo(Eo(c),i):jo(s,rr(n)+rr(i))),f=(null==(d=null==a?void 0:a[l.matchUpId])?void 0:d.participantIds)||[],h=(l.roundPosition&&e[l.matchUpId]||[]).flat();f.forEach((e=>{QN({individualParticipantProfiles:t,participantId:e});let i=t[e].priorMatchUpType!==l.matchUpType&&m||p;h.includes(e)?function({individualParticipantProfiles:e,recoveryValue:t,participantId:i,scheduleTime:n,drawId:r}){e[i].potentialRecovery[r]||(e[i].potentialRecovery[r]=[]),e[i].potentialRecovery[r].push(t),e[i].potentialBookings[r]||(e[i].potentialBookings[r]=[]),e[i].potentialBookings[r].push({timeAfterRecovery:t,scheduleTime:n})}({individualParticipantProfiles:t,drawId:l.drawId,recoveryValue:i,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=i,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:i}))})),JN({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:l})}function XN({matchUpScheduleTimes:e,matchUpDependencies:t,scheduleTime:i,matchUpId:n,details:r}){var a,o,s,l,u;let d,c=null==(o=null==(a=r.minutesMap)?void 0:a[n])?void 0:o.recoveryMinutes,p=jo(i,((null==(l=null==(s=r.minutesMap)?void 0:s[n])?void 0:l.averageMinutes)||0)+(c||0)),m=(null==(u=null==t?void 0:t[n])?void 0:u.dependentMatchUpIds)||[];if(m.length){let t=m.reduce(((t,i)=>{let n=e[i];if(!n)return t;let r={scheduleTime:n,matchUpId:i};return n&&!t.matchUpId||Ro(n)<Ro(t.scheduleTime)?r:t}),{});t.scheduleTime&&Ro(p)>Ro(t.scheduleTime)&&(d=t)}return{scheduledDependent:d}}be(zN,{generateEventWithDraw:()=>QR,generateOutcome:()=>jR,generateOutcomeFromScoreString:()=>YN,generateParticipants:()=>OR,generateTournamentRecord:()=>uA});var eR="DO_NOT_SCHEDULE",tR={DO_NOT_SCHEDULE:eR};function iR({averageMatchUpMinutes:e=90,requestConflicts:t={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){let s=function(e){let{sides:t,matchUpType:i}=e||{};return(t||[]).map((e=>{var t;return i===Cd&&((null==(t=null==e?void 0:e.participant)?void 0:t.individualParticipants)||[])||(null==e?void 0:e.participant)&&[e.participant]||[]})).flat()}(o).map((({person:e})=>null==e?void 0:e.personId));if(i){let e=((null==o?void 0:o.potentialParticipants)||[]).flat().map((({person:e})=>null==e?void 0:e.personId));s.push(...e)}let l=s.map((e=>{var t;return null==(t=n[e])?void 0:t.map((t=>({...t,personId:e})))})).filter(Boolean).flat().filter((e=>e.requestType===eR&&$o(a,e.date))),u=[],d=null==o?void 0:o.matchUpId,c=_o(Eo(r),Co(a)),p=Eo(Vo(c,e).toISOString());for(let m of l){let{requestId:e,startTime:i,endTime:n}=m;(r>i&&r<n||p>i&&p<n)&&(u.push({matchUpId:d,request:m,scheduleTime:r}),t[e]?(t[e].scheduleTimes.includes(r)||t[e].scheduleTimes.push(r),t[e].matchUpIds.includes(d)||t[e].matchUpIds.push(d)):t[e]={request:m,scheduleTimes:[r],matchUpIds:[d]})}return{conflicts:u}}function nR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=xd(i),o=(e[i.matchUpId]||[]).filter((e=>!Ar(e,a))).flat();[...a,...o].forEach((e=>{if(QN({individualParticipantProfiles:t,participantId:e}),!t[e].potentialCounted[i.drawId]){let a=t[e].counters;a[r]?a[r]+=n:n>0&&(a[r]=n),a[Rp]?a[Rp]+=n:n>0&&(a[Rp]=n),o.includes(e)&&(t[e].potentialCounted[i.drawId]=!0)}}))}function rR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:u,minutesMap:d,matchUps:c}){var p,m;let f=[];i||(r=null==c?void 0:c.filter((e=>{let t=e.schedule||{},i=e.matchUpStatus===ml;return i&&f.push({tournamentId:e.tournamentId,matchUpId:e.matchUpId}),!i&&jD({schedule:t})&&(!u||e.schedule.scheduledDate===u)})),i=r.map(ll));let h=Array.isArray(l)?l.includes(u):l,v=h?[]:c.filter((({matchUpId:e})=>i.includes(e)));for(let g of v){nR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,value:1,matchUp:g});let i=null==(p=g.schedule)?void 0:p.scheduledTime;if(i){o[g.matchUpId]=i,ZN({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:null==(m=null==d?void 0:d[g.matchUpId])?void 0:m.recoveryMinutes,scheduleTime:i,matchUp:g})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:f,dateScheduledMatchUps:r,clearDate:h}}function aR({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:t,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(r),u=a.map((e=>s.find((t=>t.matchUpId===e)))).filter(Boolean).filter((e=>{let n=!o&&(i.includes(e.matchUpId)||l.includes(e.matchUpId)),r=[ml,gl,hl,cl,Tl,bl,Ul,Il].includes(null==e?void 0:e.matchUpStatus);return t||!n&&!e.winningSide&&!r})),{matchUpMap:d}=u.reduce(((t,i)=>{let{drawId:r,tournamentId:a}=i;return t.matchUpMap[a]||(t.matchUpMap[a]={}),t.matchUpMap[a][r]?t.matchUpMap[a][r].push(i):t.matchUpMap[a][r]=[i],JN({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:n,matchUp:i}),t}),{matchUpMap:{}});return{matchUpsToSchedule:u,matchUpMap:d}}function oR({defaultRecoveryMinutes:e=0,averageMatchUpMinutes:t=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:o,matchUps:s}){if("object"!=typeof n)return{error:qe};if(!Bd(s)&&!Array.isArray(i))return{error:ei};a=a??NM({recoveryMinutes:e,averageMatchUpMinutes:t});let l=Object.assign({},...Object.values(n).map((e=>(e.events??[]).map((t=>{let{scheduleTiming:i}=bp({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:i}}})))).flat()),u={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]};i||(i=null==s?void 0:s.filter((e=>{let t=e.schedule;return jD({schedule:t})&&(!o||e.schedule.scheduledDate===o)})));let d=null==i?void 0:i.filter((e=>(!r.length||r.includes(e.schedule.venueId))&&e.matchUpStatus!==ml));return{bookings:null==d?void 0:d.map((({eventId:e,schedule:t,matchUpFormat:i})=>{let{event:n,scheduleTiming:r}=l[e],o=null==n?void 0:n.eventType,s={...r,defaultTiming:u,matchUpFormat:i},{averageMinutes:d,recoveryMinutes:c}=zp({timingDetails:s,eventType:o}),{courtId:p,venueId:m}=t,f=Eo(t.scheduledTime),h=jo(f,d);return{recoveryMinutes:c,averageMinutes:d,periodLength:a,startTime:f,courtId:p,endTime:h,venueId:m}})).filter(Boolean),relevantMatchUps:d,dateScheduledMatchUps:i}}function sR({calculateStartTimeFromCourts:e=!0,remainingScheduleTimes:t,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:u,venueIds:d,matchUps:c,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),"object"!=typeof a||!Object.keys(a).length)return{error:qe};s=s??NM({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:m,venues:f}=oD({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),h=(null==m?void 0:m.filter((e=>!d||d.includes(e.venueId))))??[];u=u??AM({courts:h,scheduleDate:l,startTime:!0}),p=p??AM({courts:h,scheduleDate:l,endTime:!0});let{bookings:v,dateScheduledMatchUps:g}=oR({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:d,matchUps:c}),I={calculateStartTimeFromCourts:e,remainingScheduleTimes:t,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:u,bookings:v,endTime:p,courts:h},{scheduleTimes:U}=EM(I),y=1===(null==d?void 0:d.length)&&d[0]||1===(null==f?void 0:f.length)&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:null==g?void 0:g.map($d("matchUpId")),dateScheduledMatchUps:g,scheduleTimes:U,venueId:y}}function lR({scheduledRoundsDetails:e,greatestAverageMinutes:t,garmanSinglePass:i}){let n,r,a,o,s=[],l=[];for(let u of e.filter(Boolean))o||(o=u.hash),(u.hash===o||i)&&(l=l.concat(u.matchUpIds)),u.hash!==o&&!i&&(o=u.hash,s.push({averageMinutes:a,recoveryMinutes:r,roundPeriodLength:n,matchUpIds:l}),l=u.matchUpIds),a=i?t:u.averageMinutes,r=u.recoveryMinutes,n=u.roundPeriodLength;return l.length&&s.push({matchUpIds:l,roundPeriodLength:n,recoveryMinutes:r,averageMinutes:a}),{groupedRounds:s}}function uR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:u,scheduleDate:d,useGarman:c,matchUps:p,courts:m,venues:f}){var h;let v={},g=[],I=[],U=[];for(let y of f){let{rounds:f=[],venueId:S}=y,{scheduledRoundsDetails:w,greatestAverageMinutes:T,orderedMatchUpIds:P,minutesMap:D}=fD({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:u,matchUps:p,rounds:f});U.push(...P??[]);let b,M,{groupedRounds:N}=lR({scheduledRoundsDetails:w,greatestAverageMinutes:T,garmanSinglePass:!0}),R=[];c&&({scheduleTimes:R,dateScheduledMatchUpIds:b,dateScheduledMatchUps:M}=sR({averageMatchUpMinutes:null==(h=N[0])?void 0:h.averageMinutes,scheduleDate:Co(d),venueIds:[y.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:u,matchUps:p}));let A=rR({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:b,greatestAverageMinutes:T,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:d,minutesMap:D,matchUps:p});({dateScheduledMatchUpIds:b,dateScheduledMatchUps:M}=A);let{byeScheduledMatchUpDetails:E,clearDate:C}=A;null!=E&&E.length&&I.push(...E);let{matchUpsToSchedule:O,matchUpMap:k}=aR({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:b,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:C,matchUps:p}),F=m.filter((e=>e.venueId===S));v[S]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:w,dateScheduledMatchUps:M,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:N,venueCourts:F,minutesMap:D,matchUpMap:k},s||g.push(...b)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:v,allDateMatchUpIds:U}}function dR({individualParticipantProfiles:e,matchUpNotBeforeTimes:t,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var o,s,l,u,d;let c=((null==(o=null==i?void 0:i[r.matchUpId])?void 0:o.participantIds)||[]).flat(),p=(null==(l=null==(s=null==a?void 0:a.minutesMap)?void 0:s[r.matchUpId])?void 0:l.averageMinutes)||0,m=(null==(d=null==(u=null==a?void 0:a.minutesMap)?void 0:u[r.matchUpId])?void 0:d.recoveryMinutes)||0,f=c.every((t=>{var i;QN({individualParticipantProfiles:e,participantId:t});let a=e[t];if(!a.timeAfterRecovery)return!0;let o=Eo(null==(i=null==r?void 0:r.schedule)?void 0:i.endTime),s=o?jo(o,rr(m)):jo(n,rr(p)+rr(m));return![...Object.keys(a.potentialBookings).filter((e=>e!==r.drawId)).map((e=>a.potentialBookings[e])).flat(),...a.bookings].find((e=>function(e,t){let i=Ro(e.scheduleTime),n=Ro(e.timeAfterRecovery),r=Ro(t.scheduleTime),a=Ro(t.timeAfterRecovery),o=i>r&&i<a,s=r>i&&r<n,l=n>r&&n<a,u=a>i&&a<n;return ya({hasOverlap:i===r||n===a||o||l||s||u,startAisContained:o,endAisContained:l,startBisContained:s,endBisContained:u},!0)}({scheduleTime:n,timeAfterRecovery:s},e).hasOverlap))})),h=t[r.matchUpId],v=(h?Bo(_o(h),_o(n),!1):0)>=0;return{enoughTime:f&&v}}function cR({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=xd(n),{matchUpId:a,matchUpType:o}=n,s=(n.roundPosition&&t[a]||[]).flat(),l=hr(r.concat(...s));return l.forEach((t=>{QN({individualParticipantProfiles:e,participantId:t})})),{participantIdsAtLimit:l.filter((t=>{let n=e[t];if(n)return[o,Rp].find((e=>{var t;let r=(null==(t=n.counters)?void 0:t[e])||0,a=i[e]||0;return r&&a&&r>=a}))})),relevantParticipantIds:l}}function pR({scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:t=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:u,schedule:d}){var c,p,m;if(!s)return{error:We};if(!(l||u&&Array.isArray(u)))return{error:Zt};if(!(l||d&&"object"==typeof d))return{error:Pn};let f,h=[],v=0;if(n&&!r){let e=Of({tournamentRecords:o,tournamentRecord:s});r=e.matchUpDependencies,f=e.matchUps}f||(f=(null==(c=Rf({tournamentRecord:s}))?void 0:c.matchUps)??[]);let g=f.reduce(((i,n)=>{let{matchUpId:r,drawId:a,matchUpStatus:o}=n;return(t||o!==ml)&&(e||!Cl.includes(o))&&(i[a]?i[a].push(r):i[a]=[r]),i}),{}),I=null==l?void 0:l.map((e=>e.matchUpId));for(let U of Object.keys(g)){let{drawDefinition:e}=kU({tournamentRecord:s,drawId:U});if(!e)continue;let t=g[U].filter((e=>(null==u?void 0:u.includes(e))??(null==I?void 0:I.includes(e)))),c=Cf({inContext:!1,drawDefinition:e}).matchUps;for(let u of t){let t=yN({schedule:(null==(p=null==l?void 0:l.find((e=>e.matchUpId===u)))?void 0:p.schedule)||d,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:f,tournamentRecords:o,tournamentRecord:s,checkChronology:n,drawDefinition:e,drawMatchUps:c,matchUpId:u});if(null!=(m=null==t?void 0:t.warnings)&&m.length&&h.push(...t.warnings),null!=t&&t.success&&(v+=1),t.error)return t}}return h.length?{...Be,scheduled:v,warnings:h}:{...Be,scheduled:v}}function mR(e){var t;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:n=!1,errorOnAnachronism:r,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:u,schedule:d}=e;if(e.matchUpIds&&!a)return pR(e);let c=io(e,[{[wa]:!0},{[Xa]:{matchUpContextIds:!1,matchUpDetails:!1},[Ja]:Fn,[Qa]:za}]);if(c.error)return c;if((!u||a)&&!d)return{error:mi,info:"schedule is required"};let p=[],m=0,{matchUpDependencies:f}=Of({tournamentRecords:s});for(let h of Object.values(s)){let{tournamentId:e}=h,c=null==a?void 0:a.filter((t=>t.tournamentId===e)).map(ll),v=null==u?void 0:u.filter((t=>(null==t?void 0:t.tournamentId)===e));if(null!=c&&c.length||null!=v&&v.length){let e=pR({matchUpDetails:v,scheduleCompletedMatchUps:i,scheduleByeMatchUps:n,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:o,tournamentRecords:s,tournamentRecord:h,checkChronology:l,matchUpIds:c,schedule:d});if(null!=(t=e.warnings)&&t.length&&p.push(...e.warnings),e.scheduled&&(m+=e.scheduled),e.error)return e}}return p.length?{...Be,scheduled:m,warnings:p}:{...Be,scheduled:m}}function fR({autoSchedulingAudit:e,tournamentRecords:t}){var i;ia({topic:Yu,payload:e});let n=e=>e?Object.values(e).reduce(((e,t)=>e+t.length||0),0):0,r=((null==e?void 0:e.schedulingProfile)||[]).reduce(((e,t)=>e+t.venues.reduce(((e,t)=>e+t.rounds.length),0)),0),a={scheduledDatesCount:null==(i=e.scheduledDates)?void 0:i.length,noTimeMatchUpIdsCount:n(null==e?void 0:e.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(null==e?void 0:e.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(null==e?void 0:e.overLimitMatchUpIds),requestConflictsCount:n(null==e?void 0:e.requestConflicts),profileRoundsCount:r},o={itemType:Lb,itemValue:a};for(let s of Object.values(t))wg({tournamentRecord:s,timeItem:o})}function hR({averageMinutes:e,startTime:t,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:mi,stack:"getEarliestCourtTime"};let a=AM({scheduleDate:r,courts:[n],startTime:!0}),o=AM({scheduleDate:r,courts:[n],endTime:!0});t=t||a,i=i||o;let s=PM({court:n,date:r}),{timeSlots:l}=DM({courtDate:s}),u=_o(t),d=_o(i);return{earliestCourtTime:null==l?void 0:l.reduce(((t,i)=>{let n=_o(i.startTime),r=_o(i.endTime);if(n>d||r<u)return t;let a=u>n?u:n;if(Bo(a,r)>=e){let e=Eo(a.toISOString());(!t||e<t)&&(t=e)}return t}),void 0),courtStartTime:a,courtEndTime:o}}function vR(e){let{scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=Cl,scheduledDates:n,venueIds:r}=e,a=Ld(e),o=Ce(a)?Object.values(a).map((({tournamentId:e})=>e)).filter(Boolean):[];if(null==o||!o.length)return{error:qe};let s=0;for(let l of o){let e=gR({ignoreMatchUpStatuses:i,scheduleAttributes:t,tournamentRecord:a[l],scheduledDates:n,venueIds:r});if(e.error)return e;s+=e.clearedScheduleCount??0}return{...Be,clearedScheduleCount:s}}function gR({scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:t=Cl,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if("object"!=typeof i)return{error:We};if(!Array.isArray(t)||!Array.isArray(r))return{error:Fn};r.length&&e.push("venueId");let a=Rf({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],o={};a.forEach((({matchUpStatus:i,schedule:n,drawId:a,matchUpId:s})=>{(!i||!t.includes(i))&&jD({schedule:n,scheduleAttributes:e})&&(null==r||!r.length||r.includes(n.venueId))&&(o[a]||(o[a]=[]),o[a].push(s))}));let s=i.tournamentId,l=0;for(let u in o){let{event:e,drawDefinition:t}=hm({tournamentRecord:i,drawId:u}),n=Cf({drawDefinition:t,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let i of n){let n=!1;i.timeItems=(i.timeItems??[]).filter((e=>{let t=(null==e?void 0:e.itemType)&&![Kc,Jc,Yc,Zc,ep].includes(null==e?void 0:e.itemType);return t||(n=!0),t})),n&&(yd({context:"clear schedules",eventId:null==e?void 0:e.eventId,drawDefinition:t,tournamentId:s,matchUp:i}),l+=1)}}return{...Be,clearedScheduleCount:l}}function IR(e){let{checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:u}=e,d=io(e,[{[wa]:!0},{[Ya]:e=>!e||Array.isArray(e)&&e.every(yo),[Na]:!1,[Qa]:za}]);if(d.error)return d;let c=gD({tournamentRecords:a});if(c.error)return c;if(!c.schedulingProfile.length)return{...Be};let{modifications:p,issues:m=[],schedulingProfile:f=[]}=c,h=Object.assign({},...Object.values(a).map((e=>Nd({tournamentRecord:e}).containedStructures))),v=r.map((e=>{if(yo(e))return Co(e)})).filter(Boolean),g=f.map((e=>e.scheduleDate)).map((e=>yo(e)&&Co(e))).filter((e=>e&&(!r.length||v.includes(e))));if(!g.length)return{error:hi};if(n&&!l){vR({tournamentRecords:a,scheduledDates:Array.isArray(n)?n:[]})}let I=oD({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:U}=Af({matchUpFilters:{matchUpTypes:[Ad,Cd]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:y}=Of({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:U}),{matchUpDailyLimits:S}=YD({tournamentRecords:a}),{personRequests:w}=SD({requestType:eR,tournamentRecords:a}),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:f.filter((e=>{let t=Co(null==e?void 0:e.scheduleDate);return g.includes(t)})).sort(((e,t)=>new Date(e.scheduleDate).getTime()-new Date(t.scheduleDate).getTime())),containedStructureIds:h,matchUpDependencies:y,matchUpDailyLimits:S,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:o,useGarman:s,matchUps:U,dryRun:l,courts:I};return u?function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,periodLength:d=30,schedulingProfile:c,personRequests:p,matchUps:m=[],courts:f,dryRun:h}){var v,g;let I={},U={},y={},S={},w={},T={},P={},D={},b={};for(let R of r??[]){let e=Co(null==R?void 0:R.scheduleDate),n=(null==R?void 0:R.venues)||[],r={},c={},M=(e,t)=>{e.forEach((e=>{let i=c[e].counters;i[t]?i[t]+=1:i[t]=1,i[Rp]?i[Rp]+=1:i[Rp]=1}))};I[e]={},U[e]={},T[e]=[],P[e]=[],D[e]=[],b[e]=[];let N={};null==m||m.forEach((t=>{var i;null!=(i=t.schedule)&&i.scheduledDate&&$o(e,Co(t.schedule.scheduledDate))&&JN({matchUpPotentialParticipantIds:r,matchUpNotBeforeTimes:N,matchUp:t})}));let A,{allDateScheduledByeMatchUpDetails:E,allDateScheduledMatchUpIds:C,venueScheduledRoundDetails:O,allDateMatchUpIds:k}=uR({matchUpPotentialParticipantIds:r,individualParticipantProfiles:c,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:N,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,periodLength:d,scheduleDate:e,matchUps:m,courts:f,venues:n}),F=null==m?void 0:m.filter((({matchUpId:e})=>C.includes(e))),{bookings:x}=oR({dateScheduledMatchUps:F,tournamentRecords:u,scheduleDate:e,periodLength:d}),{virtualCourts:L}=MM({scheduleDate:e,periodLength:d,bookings:x,courts:f}),_=null==L?void 0:L.reduce(((t,i)=>{let{earliestCourtTime:n,courtEndTime:r}=hR({date:e,averageMinutes:0,court:i});return(!t.startTime||_o(n)<_o(t.startTime))&&(t.startTime=n),(!t.endTime||_o(r)>_o(t.endTime))&&(t.endTime=r),t}),{}),B=_.startTime,j=({courtId:e,booking:t})=>{var i;return null==(i=null==L?void 0:L.find((t=>t.courtId===e)))?void 0:i.dateAvailability[0].bookings.push(t)},V=10,G=0;for(;!A;){for(let{venueId:i}of n){let n,a=O[i],l=a.matchUpsToSchedule.length,u=[],m=[],f=0;for(;!n;){for(let l of a.matchUpsToSchedule){if(m.length===a.courtsCount||u.length===a.courtsCount){n=!0;break}let{matchUpId:f,matchUpType:h}=l,{participantIdsAtLimit:v,relevantParticipantIds:g}=cR({matchUpPotentialParticipantIds:r,individualParticipantProfiles:c,matchUpDailyLimits:s,matchUp:l});if(v.length){P[e].includes(f)||P[e].push(f);continue}let{dependenciesScheduled:T,remainingDependencies:D}=KN({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:k,matchUp:l});if(!T){U[e][f]||(U[e][f]=[]),U[e][f].push({remainingDependencies:D});continue}let R=[],A=null==L?void 0:L.reduce(((i,n)=>{var s,u,d,v;if(m.includes(n.courtId))return i;let{earliestCourtTime:U}=hR({averageMinutes:a.greatestAverageMinutes,startTime:B,date:e,court:n});if(i.scheduleTime&&Ro(U)>=Ro(i.scheduleTime))return i;let{scheduledDependent:y}=XN({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:U,matchUpId:f,details:a});if(y)return i;let{enoughTime:S}=dR({individualParticipantProfiles:c,matchUpNotBeforeTimes:N,matchUpDependencies:o,scheduleTime:U,details:a,matchUp:l});if(!S)return I[e][f]||(I[e][f]=[]),I[e][f].includes(U)||I[e][f].push(U),i;let T=(null==(u=null==(s=a.minutesMap)?void 0:s[f])?void 0:u.averageMinutes)||a.greatestAverageMinutes,{conflicts:P}=iR({potentials:t,averageMatchUpMinutes:T,requestConflicts:b,personRequests:p,scheduleTime:U,scheduleDate:e,matchUp:l});if(null!=P&&P.length)return R.push(...P),!1;M(g,h);let D=null==(v=null==(d=a.minutesMap)?void 0:d[f])?void 0:v.recoveryMinutes;return ZN({matchUpPotentialParticipantIds:r,individualParticipantProfiles:c,matchUpNotBeforeTimes:N,averageMatchUpMinutes:T,matchUpDependencies:o,recoveryMinutes:D,scheduleTime:U,matchUp:l}),(!i.scheduleTime||Ro(U)<Ro(i.scheduleTime))&&(i.averageMatchUpMinutes=T,i.recoveryMinutes=D,i.scheduleTime=U,i.courtName=n.courtName,i.courtId=n.courtId),i}),{});if(A.scheduleTime){let{averageMatchUpMinutes:e,recoveryMinutes:t,scheduleTime:n,courtId:r}=A;w[f]=n,S[f]=r,u.push(f),m.push(r);let o=n,s=jo(o,e);j({courtId:r,booking:{averageMatchUpMinutes:e,recoveryMinutes:t,periodLength:d,matchUpId:f,startTime:o,courtId:r,endTime:s,venueId:i}}),a.matchUpsToSchedule=a.matchUpsToSchedule.filter((e=>e.matchUpId!==f))}else null!=R&&R.length&&(y[e]||(y[e]=[]),y[e].push(...R))}(m.length===a.courtsCount||u.length===a.courtsCount||!a.matchUpsToSchedule.length)&&(n=!0),a.matchUpsToSchedule.length&&u<a.courtsCount&&(_o(B)<_o(_.endTime)?B=jo(B,d):(n=!0,a.complete=!0)),f+=1,!n&&f>=l&&(n=!0)}null!=(v=a.matchUpsToSchedule)&&v.length||(a.complete=!0)}G+=1,A=n.every((({venueId:e})=>O[e].complete))||G===V}for(let{venueId:t}of n){let i=O[t].matchUpMap;Object.keys(i).forEach((t=>{let n=u[t];n&&Object.keys(i[t]).forEach((r=>{let{drawDefinition:a}=kU({tournamentRecord:n,drawId:r});a&&i[t][r].forEach((({matchUpId:t})=>{let i=w[t],r=S[t];if(i){let o=i.split(":").map(Go).join(":"),s=`${Co(e)}T${o}`;h||(fN({drawDefinition:a,scheduledTime:s,matchUpId:t}),IN({courtDayDate:e,tournamentRecords:u,tournamentRecord:n,drawDefinition:a,matchUpId:t,courtId:r})),T[e].push(t)}}))}))})),D[e]=O[t].matchUpsToSchedule.map(ll)}!h&&null!=E&&E.length&&mR({matchUpDetails:E,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of R.venues)for(let i of t.rounds){let t=null==(g=(i.matchUps??[]).map((({matchUpId:e})=>e)))?void 0:g.filter((t=>T[e].includes(t)));i.canScheduledMatchUpIds=t;let n=Math.round(((null==t?void 0:t.length)||0)/i.matchUpsCount*1e4)/100;(n===1/0||isNaN(n))&&(n=void 0),i.possibleToSchedulePct=n,i.matchUpsCount===(null==t?void 0:t.length)&&(i.possibleToSchedule=!0)}}let M=(r??[]).map((({scheduleDate:e})=>e)),N={timeStamp:Date.now(),overLimitMatchUpIds:P,scheduledMatchUpIds:T,schedulingProfile:c,noTimeMatchUpIds:D,requestConflicts:b,scheduledDates:M};return fR({tournamentRecords:u,autoSchedulingAudit:N}),{...Be,schedulingProfileModifications:e,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:I,dependencyDeferredMatchUpIds:U,matchUpScheduleTimes:w,overLimitMatchUpIds:P,scheduledMatchUpIds:T,noTimeMatchUpIds:D,requestConflicts:b,scheduledDates:M}}(T):function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:u,schedulingProfile:d,personRequests:c,periodLength:p,matchUps:m,courts:f,dryRun:h}){var v,g,I,U,y,S,w;let T={},P={},D={},b={},M={},N={},R={},A={},E={},C={};for(let F of r){let e=Co(null==F?void 0:F.scheduleDate),n=(null==F?void 0:F.venues)||[],r={},d={},O=(e,t)=>{e.forEach((e=>{let i=d[e].counters;i[t]?i[t]+=1:i[t]=1,i[Rp]?i[Rp]+=1:i[Rp]=1}))};D[e]={},b[e]={},T[e]={},P[e]={},R[e]=[],A[e]=[],E[e]=[],C[e]=[];let k={};m.forEach((t=>{var i;null!=(i=t.schedule)&&i.scheduledDate&&$o(e,Co(t.schedule.scheduledDate))&&JN({matchUpPotentialParticipantIds:r,matchUpNotBeforeTimes:k,matchUp:t})}));let x,{allDateScheduledByeMatchUpDetails:L,venueScheduledRoundDetails:_,allDateMatchUpIds:B}=uR({matchUpPotentialParticipantIds:r,individualParticipantProfiles:d,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:k,matchUpScheduleTimes:N,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:e,matchUps:m,courts:f,venues:n}),j=10,V=0,G=10;for(;!x;){for(let{venueId:i}of n){let n=0,a=_[i];for(;a.courtsCount&&null!=(v=a.scheduleTimes)&&v.length&&null!=(g=a.matchUpsToSchedule)&&g.length&&n<=a.courtsCount;){let{scheduleTime:l,attempts:u=0}=a.scheduleTimes.shift(),p=a.matchUpsToSchedule.find((i=>{var n,u;let{matchUpId:p,matchUpType:m}=i,{participantIdsAtLimit:f,relevantParticipantIds:h}=cR({matchUpPotentialParticipantIds:r,individualParticipantProfiles:d,matchUpDailyLimits:s,matchUp:i});if(f.length)return A[e].includes(p)||A[e].push(p),!1;let{scheduledDependent:v}=XN({matchUpScheduleTimes:N,matchUpDependencies:o,scheduleTime:l,matchUpId:p,details:a});if(v)return!1;let{dependenciesScheduled:g,remainingDependencies:I}=KN({matchUpScheduleTimes:N,matchUpDependencies:o,allDateMatchUpIds:B,matchUp:i});if(!g)return b[e][p]||(b[e][p]=[]),b[e][p].push({scheduleTime:l,remainingDependencies:I}),!1;let{enoughTime:U}=dR({individualParticipantProfiles:d,matchUpNotBeforeTimes:k,matchUpDependencies:o,scheduleTime:l,details:a,matchUp:i});if(!U)return D[e][p]||(D[e][p]=[]),D[e][p].push({scheduleTime:l}),!1;let y=a.greatestAverageMinutes,{conflicts:S}=iR({potentials:t,averageMatchUpMinutes:y,requestConflicts:C,personRequests:c,scheduleTime:l,scheduleDate:e,matchUp:i});if(null!=S&&S.length)return M[e]||(M[e]=[]),M[e].push(...S),!1;O(h,m);let w=null==(u=null==(n=a.minutesMap)?void 0:n[p])?void 0:u.recoveryMinutes;return ZN({matchUpPotentialParticipantIds:r,individualParticipantProfiles:d,matchUpNotBeforeTimes:k,averageMatchUpMinutes:y,matchUpDependencies:o,recoveryMinutes:w,scheduleTime:l,matchUp:i}),N[p]=l,!0}));a.matchUpsToSchedule=a.matchUpsToSchedule.filter((({matchUpId:e})=>e!==(null==p?void 0:p.matchUpId))),p?n+=1:(P[e][i]||(P[e][i]=[]),P[e][i].push({scheduleTime:l,attempts:u+1}))}null!=(I=a.matchUpsToSchedule)&&I.length&&(P[e][i]=null==(U=P[e][i])?void 0:U.filter((e=>{let t=e.attempts<j;return t&&a.scheduleTimes.push(e),!t}))),(null==(y=a.scheduleTimes)||!y.length||null==(S=a.matchUpsToSchedule)||!S.length)&&(a.complete=!0)}V+=1,x=n.every((({venueId:e})=>_[e].complete))||V===G}for(let{venueId:t}of n){let i=_[t].matchUpMap;Object.keys(i).forEach((n=>{let r=u[n];r&&Object.keys(i[n]).forEach((a=>{let{drawDefinition:o}=kU({tournamentRecord:r,drawId:a});o&&i[n][a].forEach((({matchUpId:i})=>{let n=N[i];if(n){let a=n.split(":").map(Go).join(":"),s=`${Co(e)}T${a}`;h?R[e].push(i):(fN({drawDefinition:o,scheduledTime:s,matchUpId:i}).success&&R[e].push(i),t&&gN({tournamentRecord:r,drawDefinition:o,matchUpId:i,venueId:t}))}}))}))})),E[e]=_[t].matchUpsToSchedule.map(ll),T[e][t]=_[t].scheduleTimes.sort(((e,t)=>Ro(e.scheduleTime)-Ro(t.scheduleTime)))}!h&&null!=L&&L.length&&mR({matchUpDetails:L,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of F.venues)for(let i of t.rounds){let t=((null==(w=i.matchUps)?void 0:w.map((({matchUpId:e})=>e)))||[]).filter((t=>R[e].includes(t)));i.canScheduledMatchUpIds=t;let n=Math.round(t.length/i.matchUpsCount*1e4)/100;(n===1/0||isNaN(n))&&(n=0),i.possibleToSchedulePct=n,i.matchUpsCount===t.length&&(i.possibleToSchedule=!0)}}let O=r.map((({scheduleDate:e})=>e)),k={timeStamp:Date.now(),overLimitMatchUpIds:A,scheduledMatchUpIds:R,schedulingProfile:d,noTimeMatchUpIds:E,requestConflicts:C,scheduledDates:O};return fR({tournamentRecords:u,autoSchedulingAudit:k}),{...Be,schedulingProfileModifications:e,schedulingProfileIssues:n,scheduleTimesRemaining:T,dateSchedulingProfiles:r,skippedScheduleTimes:P,recoveryTimeDeferredMatchUpIds:D,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:N,overLimitMatchUpIds:A,scheduledMatchUpIds:R,noTimeMatchUpIds:E,requestConflicts:C,scheduledDates:O}}(T)}function UR(e){let t=e||{};return t.tournamentId||(t.tournamentId=am()),(!t.startDate||Mo(t.startDate)||mo.test(t.startDate))&&(!t.endDate||Mo(t.endDate)||mo.test(t.endDate))?(t.extensions&&(t.extensions=t.extensions.filter(ms)),{...t}):{error:Ui}}function yR({addParticipants:e=!0,participantAttribute:t,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:o}){var s,l;if(!i)return{error:We};let u={},d=(i.participants??[]).filter((({participantType:e,participantRole:t})=>e===Qd&&t===Ah)),c=0;for(let v of d){let e=a&&(null==(s=Vd({element:v,accessor:a}))?void 0:s.value)||n&&(null==(l=v.person)?void 0:l[n])||t&&v[t];if(e){if(!Object.keys(u).includes(e)){u[e]={participantName:(null==r?void 0:r[c])??e,participantId:(null==o?void 0:o.pop())??am(),individualParticipantIds:[],participantRole:Ah,participantType:ec};let i={value:n??t,name:xs};fs({element:u[e],extension:i}),c+=1}u[e].individualParticipantIds.push(v.participantId)}}let p=Object.keys(u),m=(i.participants??[]).map((e=>{if(e.participantType!==ec||e.participantRole!==Ah)return;let{extension:t}=Ds({name:xs,element:e}),i=null==t?void 0:t.value;return p.includes(i)?e.participantId:void 0})).filter(Boolean),f=0,h=[];return Object.keys(u).forEach((t=>{let n=u[t],{participantId:r}=n;m.includes(r)||(i.participants||(i.participants=[]),e&&i.participants.push(n),h.push(n),f++)})),e&&f?(ia({payload:{tournamentId:i.tournamentId,participants:h},topic:Wu}),{...Be,participantsAdded:f}):h.length?{...Be,newParticipants:h}:{error:Di}}var SR=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],wR=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function TR({count:e=1,participantsCount:t=32}={}){let i=gr(wR),n=i.slice(0,e);return{cities:br(0,t).map((t=>t<Math.min(e,i.length)?n[t]:Dr(n)))}}function PR({count:e=1,participantsCount:t=32}={}){let i=gr(SR),n=i.slice(0,e).map((e=>Object.keys(e))).flat();return{states:br(0,t).map((t=>t<Math.min(e,i.length)?n[t]:Dr(n)))}}function DR({count:e=1,participantsCount:t=32}={}){let i=br(0,e).map((()=>br(0,5).map((()=>pr(0,9))).join("")));return{postalCodes:br(0,t).map((t=>t<e?i[t]:Dr(i)))}}function bR(e){let{cities:t,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=e;return{postalCode:null==n?void 0:n[a],state:null==i?void 0:i[a],city:null==t?void 0:t[a],countryCode:r}}var MR={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function NR(e){let{count:t=100,sex:i}=e||{};if(!t||i&&![zm,Jm].includes(i))return{personData:[],error:Fn};let n=Math.ceil(1.3*t),{lastNames:r,firstFemale:a,firstMale:o}=MR,s=mf.map((({iso:e})=>e)).filter(Boolean),l=Math.ceil(n/r.length),u=Math.ceil(n/a.length),d=Math.ceil(n/o.length),c=br(0,l).flatMap((()=>{let e=Wo(r,!1,!0);return br(0,r.length).map((()=>Pr(e)))})),p=br(0,u).flatMap((()=>{let e=Wo(a,!1,!0);return br(0,a.length).map((()=>Pr(e)))})),m=br(0,d).flatMap((()=>{let e=Wo(o,!1,!0);return br(0,o.length).map((()=>Pr(e)))})),f={};for(let h=0;h<n;h++){let e=c.pop(),t=i||Dr([zm,Jm]),n=t===zm?m.pop():p.pop(),r=Dr(s);f[`${n}${e}`]={nationalityCode:r,sex:t,firstName:n,lastName:e}}return{personData:Object.values(f).slice(0,t)}}function RR(e){let t=(null==e?void 0:e.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:o,category:s,sex:l}=e||{};if(isNaN(t))return{error:Fn};let u=(null==a?void 0:a[zm])||l===zm&&t||0,d=(null==a?void 0:a[Jm])||l===Jm&&t||0;t=Math.max(t,u+d);let c=t-(u+d),p=[...u&&NR({count:u,sex:zm}).personData||[],...d&&NR({count:d,sex:Jm}).personData||[],...c&&NR({count:c}).personData||[]],m=p.filter((e=>!l||u&&d||e.sex===l)),f=[];if(Array.isArray(o)){let e=o.filter((e=>!("string"!=typeof e.firstName||"string"!=typeof e.lastName||e.sex&&![zm,Jm].includes(e.sex)||e.nationalityCode&&("string"!=typeof e.nationalityCode||e.nationalityCode.length>3||!mf.find((({iso:t,ioc:i})=>[t,i].includes(e.nationalityCode)))))&&(e.nationalityCode&&f.push(e.nationalityCode),!0)));if(!e.length)return{error:Fn};m=e}let h=o?m:gr(m);if(h.length<t){let{maleFirstNames:e,maleLastNames:i,femaleFirstNames:n,femaleLastNames:r,nationalityCodes:a}=p.reduce(((e,t)=>{let{firstName:i,lastName:n,nationalityCode:r}=t;return t.sex===zm?(e.maleFirstNames.includes(i)||e.maleFirstNames.push(i),e.maleLastNames.includes(n)||e.maleLastNames.push(n)):(e.femaleFirstNames.includes(i)||e.femaleFirstNames.push(i),e.femaleLastNames.includes(n)||e.femaleLastNames.push(n)),e.nationalityCodes.includes(r)||e.nationalityCodes.push(r),e}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});br(0,t-h.length).forEach((()=>{let t=l||Dr([zm,Jm]),o=Dr(a),s={firstName:Dr(t===zm?e:n),lastName:Dr(t===zm?i:r),sex:t,nationalityCode:o};h.push(s)}))}let{ageMinDate:v,ageMaxDate:g}=XI({consideredDate:n,category:s}),I=rr((null==v?void 0:v.slice(0,4))||0)||rr((null==g?void 0:g.slice(0,4))||0)-3,U=rr((null==g?void 0:g.slice(0,4))||0)||rr((null==v?void 0:v.slice(0,4))||0)+3,y=(v||g)&&[I,U],S=h.slice(0,t).map(((e,t)=>{let[n,a]=y||[],o=y&&Pr(br(n,a)),s=Pr(br(0,365)),l=o&&function(e,t,i){let n=new Date(e,0);return wo(new Date(n.setDate(t)),i)}(o,s);return Object.assign(ya({extensions:i||[{name:"regionCode",value:t+1}],birthDate:l,isMock:r}),e)}));return{persons:S.length&&S||h[0],nationalityCodes:f}}var AR=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function ER({nameRoot:e="TEAM",count:t=1}={}){let i=gr(AR).slice(0,t);return i.length<t&&br(0,t-i.length).forEach((t=>i.push(`${e} ${t+1}`))),{names:i}}function CR({idPrefix:e,participantType:t,index:i,uuids:n}){return e?`${e}-${t===Qd?"I":"P"}-${i}`:(null==n?void 0:n.pop())||am()}function OR(e){let{rankingRange:t,scaledParticipantsCount:i}=e,{ratingsParameters:n=cS,valuesInstanceLimit:r,consideredDate:a,category:o,nationalityCodesCount:s,nationalityCodeType:l,nationalityCodes:u,participantsCount:d=32,participantType:c,personIds:p,idPrefix:m,uuids:f,personExtensions:h,addressProps:v,gendersCount:g,matchUpType:I,personData:U,sex:y,inContext:S,withISO2:w,withIOC:T,scaleAllParticipants:P}=e,D=c===Xd||I===Ed,b=c===ec||I===ec;t&&(!Array.isArray(t)||!t.every((e=>ur(e)))||2!==t.length)&&(t=void 0),i=P?d:i;t=t||[1,i&&i>1e3?i:1e3],t[1]+=1;let M=d*(D?2:b?8:1),N=RR({count:M,personExtensions:h,consideredDate:a,gendersCount:g,personData:U,category:o,sex:y});if(N.error)return N;let{nationalityCodes:R,persons:A}=N,E=[],C=[],O=[],k=[];if("object"==typeof o){let{categoryName:e,ageCategoryCode:r,ratingType:a}=o;if((e||r)&&!a){let[e,n]=t||[];if(C=gr(br(e,n)).slice(0,i||pr(20,30)),[Xd,ec].includes(c)){let[e,n]=t||[];E=gr(br(e,n)).slice(0,i||pr(20,30))}}if(a&&n[a]){let{ratingMax:e,ratingMin:t,ratingAttributes:r}=o,s={...n[a],...r||{}},{attributes:l={},decimalsCount:u,accessors:d,range:p,step:m}=s,f=e=>{let t={},i=Object.keys(e||{});for(let n of i){let i=e[n];if("object"==typeof i&&i.generator){let{range:e}=i,[r,a]=e.slice().sort();t[n]=pr(r,a)}else t[n]=i}return t},h=p[0]>p[1]?2:.5,[v,g]=p.slice().sort(),I=()=>br(0,2e3).map((()=>fr(v,g,h,m,u))).filter((i=>(!e||i<=e)&&(!t||i>=t))).slice(0,i||pr(20,30)).map((e=>d?Object.assign({},...d.map((t=>({[t]:e}))),f(l)):e));O=I(),[Xd,ec].includes(c)&&(k=I())}}let F=mf.filter((e=>"IOC"===l&&e.ioc||e.iso));let{postalCodesProfile:x,postalCodesCount:L,statesProfile:_,citiesProfile:B,citiesCount:j,statesCount:V}=v||{},G=e=>Object.keys(e).map((e=>br(0,_[e]).map((()=>e)))).flat(),$={cities:B&&G(B)||(null==v?void 0:v.cities)||TR({count:j||M,participantsCount:M}).cities,states:_&&G(_)||(null==v?void 0:v.states)||PR({count:V||M,participantsCount:M}).states,postalCodes:x&&G(x)||(null==v?void 0:v.postalCodes)||DR({count:L||M,participantsCount:M}).postalCodes},q=function(e){let t=Math.ceil(M/e);return r&&t>r?Math.ceil(M/r):e}(s),W=q?gr(F).slice(0,s):u?F.filter((e=>u.includes(e.iso))):F,H=gr(br(0,Math.ceil(M/(q||1))).map((()=>W)).flat(1/0)),z=ER({count:d}).names;return{participants:br(0,d).map((e=>{let t=D?2:b?8:1,i=br(0,t).map((i=>function(e){let t=A[e],{nationalityCode:i,participantExtensions:n,participantTimeItems:r,extensions:a,firstName:s,birthDate:u,lastName:d,personId:c,sex:h}=t||{},v=s||"GivenName",g=d||"FamilyName",I=`${v} ${g}`,U=H[e],y=(null==R?void 0:R.length)&&i||U&&("IOC"===l?U.ioc||U.iso:U.iso||U.ioc)||i;null!=H&&H.length&&!y&&!i&&console.log("%c Invalid Nationality Code",{participantIndex:e,country:U});let S=bR({...$,participantIndex:e,nationalityCode:y}),P=ya({participantId:CR({participantType:Qd,index:e,idPrefix:m,uuids:f}),extensions:n,timeItems:r,participantRole:Ah,participantType:Qd,participantName:I,person:{addresses:[S],personId:c||(null==p?void 0:p.length)&&p[e]||am(),standardFamilyName:g,standardGivenName:v,nationalityCode:y,extensions:a,birthDate:yo(u)?u:void 0,sex:h}});if(T&&y){let e=mf.find((({iso:e})=>e===y));null!=e&&e.ioc&&(P.person.iocNationalityCode=e.ioc),null!=e&&e.label&&(P.person.countryName=e.label)}if(w&&y){let e=mf.find((({iso:e})=>e===y));null!=e&&e.iso2&&(P.person.iso2NationalityCode=e.iso2),null!=e&&e.label&&(P.person.countryName=e.label)}if(o){let t=C[e],i=E[e];kR({scaleValue:t,eventType:jp,scaleType:ao,participant:P,category:o}),kR({scaleValue:i,eventType:Gp,scaleType:ao,participant:P,category:o});let n=O[e],r=k[e];kR({scaleValue:n,eventType:jp,scaleType:oo,participant:P,category:o}),kR({scaleValue:r,eventType:Gp,scaleType:oo,participant:P,category:o})}return P}(e*t+i))),n=i.map((e=>e.participantId)),r=i.map((e=>e.person.standardFamilyName)).join("/"),a=D?Xd:ec,s={participantId:CR({participantType:a,idPrefix:m,index:e,uuids:f}),participantRole:Ah,participantName:D?r:z[e],individualParticipantIds:n,participantType:a};return S&&(s.individualParticipants=i),D||b?[s,...i]:i})).flat(),...Be}}function kR({scaleValue:e,participant:t,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,o={itemValue:e,itemType:[so,n,i,a].join(".")};a&&e&&(t.timeItems||(t.timeItems=[]),t.timeItems.push(o))}function FR({alternatesCount:e=0,tieFormatName:t,tieFormat:i,drawSize:n}){var r;let a=0,o=0,s=0,l=0,u={},d={[zm]:0,[Jm]:0,[Ym]:0,[Km]:0,[Hm]:0};null==(r=null==(i="object"==typeof i?i:sP({namedFormat:t}))?void 0:i.collectionDefinitions)||r.filter(Boolean).forEach((e=>{let{category:t,collectionId:i,matchUpType:n,matchUpCount:r,gender:c}=e;if([zm,Jm].includes(c)){let e=r*(n===Cd?2:1);d[c]<e&&(d[c]=e)}else c===Ym&&(d[zm]<r&&(d[zm]=r),d[Jm]<r&&(d[Jm]=r));if(t){let e=JSON.stringify(t);u[e]=t}if(i||(e.collectionId=am()),wp(Cd)(n)){let e=r;l+=r,a=Math.max(a,e)}if(wp(Ad)(n)){let e=r;s+=r,o=Math.max(o,e)}}));let c=Object.keys(u).length?Math.max(s,2*l):Math.max(o,2*a);return{maxDoublesDraw:a*(n+e),maxSinglesDraw:o*(n+e),teamSize:c,genders:d}}function xR({participantsProfile:e,tournamentRecord:t,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:u,gendersCount:d}=function({participantsProfile:e,eventProfiles:t,drawProfiles:i}){let{participantsCount:n,participantType:r=Qd}=e||{},a=n||0,o={[Jm]:0,[Ym]:0,[Km]:0,[zm]:0,[Hm]:0},s=0,l=0,u=0,d=0,c=0,p=({alternatesCount:e=0,uniqueParticipants:t,tieFormatName:i,drawSize:n=0,eventType:r,tieFormat:a,category:p,gender:m,stage:f})=>{let h=r===Vp,v=!!(t||f===Ll||p||m);if(r===$p){d=Math.max(d,n+e),a="object"==typeof a?a:sP({namedFormat:i});let{teamSize:t,maxDoublesDraw:r,maxSinglesDraw:c,genders:p}=FR({alternatesCount:e,tieFormatName:i,tieFormat:a,drawSize:n});u=Math.max(u,t),l=Math.max(l,c),v||(s=Math.max(s,r)),Object.keys(p).forEach((e=>o[e]+=p[e]))}else if(h)if(v){let t=2*(n+e);c+=t,m&&(o[m]+=t)}else n+e&&n+e>s&&(s=n+e);else if(v){let t=n+e;m&&(o[m]+=t),c+=t}else n&&n>l&&(l=n+e)};if(null==t||t.forEach((e=>{let{tieFormatName:t,tieFormat:i,drawProfiles:n,eventType:r,category:a,gender:o}=e;if(n)for(let s of n){let{tieFormatName:e,tieFormat:n}=s;p({...s,tieFormatName:e||t,tieFormat:n||i,eventType:r,category:a,gender:o})}})),Array.isArray(i))for(let f of i)p(f);let m=Math.max(d*u,2*s,l);return s&&(r=Xd),(n||a)<m&&(n=m),n&&s&&[Xd,$p].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||2*s>=l)&&(n=Math.ceil(n/2))),void 0===n&&(n=null!=t&&t.length||null!=i&&i.length?0:32),n<a&&(n=a),{uniqueParticipantsCount:c,participantsCount:n,largestTeamDraw:d,largestTeamSize:u,participantType:r,gendersCount:o}}({participantsProfile:e,eventProfiles:i,drawProfiles:n}),c=null==e?void 0:e.teamKey,p=OR({uuids:a,...e,consideredDate:r,participantsCount:o,participantType:s,gendersCount:d}).participants,m=0,f=Rb({tournamentRecord:t,participants:p});if(f.error)return f;if(m+=f.addedCount,c){let e=yR({tournamentRecord:t,...c});if(e.error)return e}let h=p.filter((({participantType:e})=>e===Qd)).map(sl),v=null!=e&&e.idPrefix?`${ec}-${e.idPrefix}`:void 0;return f=Rb({participants:br(0,l).map((e=>{let t=h.slice(e*u,(e+1)*u),i=CR({index:e,participantType:s,idPrefix:v,uuids:a});return{participantName:`Team ${e+1}`,participantRole:Ah,individualParticipantIds:t,participantType:ec,participantId:i}})),tournamentRecord:t}),f.error?f:(m+=f.addedCount,{addedCount:m,...Be})}function LR({drawProfiles:e,category:t,gender:i}){let n={},r=null==e?void 0:e.reduce(((e,r)=>{let{qualifyingPositions:a=0,participantsCount:o=0,uniqueParticipants:s,stage:l=xl,drawSize:u=0}=r||{};Object.keys(e).includes(l)||(e[l]=0);let d=(o||u)-a;return s||i||t||l===Ll?(Object.keys(n).includes(l)||(n[l]=0),n[l]+=d):e[l]=Math.max(e[l],d),e}),{}),a=Object.keys(n);return a.forEach((e=>r[e]+=n[e])),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function _R({allUniqueParticipantIds:e,stageParticipantsCount:t,eventParticipantType:i,targetParticipants:n}){let r=t[xl]||0,a=t[Ll]||0;return{stageParticipants:{QUALIFYING:n.filter((({participantType:e})=>e===i)).filter((({participantId:t})=>!e.includes(t))).slice(0,a),MAIN:n.filter((({participantType:e})=>e===i)).filter((({participantId:t})=>!e.includes(t))).slice(a,a+r)}}}var BR={[bl]:2,[Ul]:1,[Il]:1,[Tl]:1,[gl]:4};function jR(e){let{defaultWithScorePercent:t=2,winningSide:i}=e,{matchUpStatusProfile:n=BR,matchUpFormat:r=oI,pointsPerMinute:a=1,sideWeight:o=4}=e;if(!JI({matchUpFormat:r}))return{error:zt};if("object"!=typeof n)return{error:Fn};if(t>100&&(t=100),isNaN(t)||isNaN(a)||isNaN(o))return{error:Fn};let s=Object.keys(n).filter((e=>Object.keys(Fl).includes(e)&&e!==hl));if(Object.keys(s).reduce(((e,t)=>e+n[t]),0)>100)return{error:Fn,matchUpStatusProfile:n};let l=s.reduce(((e,t)=>(e.pointer=e.pointer+n[t],e.valueMap.push([e.pointer,t]),e)),{pointer:0,valueMap:[]}),u=pr(1,100),d=(l.valueMap.find((e=>u<=e[0]))??[100,hl])[1],c={sets:[],scoreStringSide1:"",side2ScoreString:""};if([bl,gl].includes(d)){i=i||pr(1,2);let e={score:c,winningSide:i,matchUpStatus:d};if(!(d===gl&&pr(1,100)>100-t))return{outcome:e}}else if([Ul,Il].includes(d))return{outcome:{score:c,matchUpStatus:d}};let p,m=xm(r),{bestOf:f,setFormat:h,finalSetFormat:v}=m??{},g=[],I=pr(0,1),U=i?[i-1]:[...br(0,o).map((()=>I)),1-I],y=[Tl,gl,Sl,Pl].includes(d)&&(Pr(br(1,f))||1);for(let P of br(1,(f??0)+1)){let e=P===f,{set:t,incomplete:i,winningSideNumber:n}=VR({incomplete:y===P,matchUpStatus:d,pointsPerMinute:a,setFormat:e&&v||h,setNumber:P,weightedRange:U});if(g.push(t),i){p=n;break}if(sb({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}let S=sb({matchUp:{score:{sets:g},matchUpFormat:r}}),w=p?i||p:S.calculatedWinningSide,{score:T}=xN({score:{sets:g},winningSide:w,matchUpStatus:d});return{outcome:{score:T,winningSide:w,matchUpStatus:d}}}function VR({weightedRange:e=[0,1],pointsPerMinute:t,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let o,s={setNumber:a},{setTo:l,tiebreakFormat:u,tiebreakAt:d,tiebreakSet:c,timed:p,minutes:m}=r,f=pr(0,e.length-1),h=e[f];if(p){let r=m*t,a=Math.round(.2*r),l=r+Pr([1,-1])*a,u=function(e=1,t=3,i=!0){let n=0;for(let r=0;r<t;r++)n+=Math.random()*(e/t);return i&&e>1?Math.round(n):n}(l,2),d=[u,l-u];h&&d.reverse(),o=e[f]+1;let c=(d[0]>d[1]?1:d[1]>d[0]&&2)||0;if(n){let[e,t]=d;return Object.assign(s,{side1Score:e,side2Score:t}),Cl.includes(i)?{set:s,incomplete:n,winningSideNumber:o}:{set:s,incomplete:n}}c||(d[pr(0,1)]+=1),c=d[0]>d[1]?1:2,c!==o&&d.reverse();let[p,v]=d;return Object.assign(s,{side1Score:p,side2Score:v,winningSide:o}),{set:s}}if(n)return s.side1Score=pr(0,d),s.side2Score=pr(0,d),Cl.includes(i)&&(o=e[f]+1),{set:s,incomplete:n,winningSideNumber:o};{let t=br(1,l+1).map((e=>br(0,l+2-e).map((()=>e)))).flat(),i=t[pr(0,t.length-1)],n=l&&gT({isSide1:!0,tiebreakAt:d,lowValue:i,setTo:l}),a=!n,o=1===e.length&&e[f]+1;if(!a){o?(n[0]>n[1]?1:2)!==o&&n.reverse():h&&n.reverse();let[e,t]=n;Object.assign(s,{side1Score:e,side2Score:t})}let p,m=yT({matchUpScoringFormat:{setFormat:r},setObject:s});if(m.hasTiebreakCondition||a){let{NoAD:e,tiebreakTo:t}=u||c||{},i=br(1,t+1).map((e=>br(0,t+2-e).map((()=>e)))).flat(),n=i[pr(0,i.length-1)],r=IT({isSide1:!0,tiebreakNoAd:e,tiebreakTo:t,lowValue:n});if(r)if(a){let e=r[0]>r[1]?1:2;o?e!==o&&r.reverse():h&&r.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=r,p=(r[0]>r[1]?1:r[1]>r[0]&&2)||void 0}else 2===m.leadingSide?[s.side1TiebreakScore,s.side2TiebreakScore]=r:[s.side2TiebreakScore,s.side1TiebreakScore]=r}s.winningSide=m.winningSide||m.leadingSide||o||p}return{set:s}}function GR(e){var t,i,n;let{matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:u,event:d}=e;if(!u)return{error:Ke};let c=e.matchUpFormat||u.matchUpFormat||(null==d?void 0:d.matchUpFormat),p=u.structures.slice().sort(xu),m=0,{matchUps:f,matchUpsMap:h}=uf({contextFilters:{stages:[xl,Ll]},matchUpFilters:{matchUpTypes:[kd],roundNumbers:[1]},inContext:!0,drawDefinition:u});if(null!=f&&f.length){let e=(null==(t=null==d?void 0:d.category)?void 0:t.ageCategoryCode)||(null==(i=null==d?void 0:d.category)?void 0:i.categoryName);if(e){let t=SM({singlesOnly:!0,tournamentRecord:s,drawDefinition:u,scaleAccessor:{scaleName:e,sortOrder:IM,scaleType:ao},event:d});if(t.error)return t;let{lineUps:i,participantsToAdd:n}=t;Rb({tournamentRecord:s,participants:n}),fs({element:u,extension:{name:Ls,value:i}})}else{let e=null==(n=f[0])?void 0:n.structureId,{positionAssignments:t}=Vu({drawDefinition:u,structureId:e});if(null!=t&&t.length){let{participants:e}=vh({participantFilters:{participantTypes:[kd]},tournamentRecord:s}),i=i=>{let n=i.tieMatchUps.filter(wp(Ad)),r=i.tieMatchUps.filter(wp(Cd));n.forEach(((i,n)=>{let r=i.matchUpId;i.sides.forEach((i=>{var a;let{drawPosition:o}=i,l=null==e?void 0:e.find((e=>{var i;let{participantId:n}=e;return(null==(i=t.find((e=>e.participantId===n)))?void 0:i.drawPosition)===o}));if(l){let e=null==(a=l.individualParticipantIds)?void 0:a[n];e&&zM({teamParticipantId:l.participantId,participantId:e,tournamentRecord:s,drawDefinition:u,tieMatchUpId:r,event:d})}}))})),r.forEach(((i,n)=>{let r=i.matchUpId;i.sides.forEach((i=>{var a,o;let{drawPosition:l}=i,c=null==e?void 0:e.find((e=>{var i;let{participantId:n}=e;return(null==(i=t.find((e=>e.participantId===n)))?void 0:i.drawPosition)===l}));c&&(null==(o=null==(a=c.individualParticipantIds)?void 0:a.slice(2*n,2*n+2))||o.forEach((e=>{zM({teamParticipantId:c.participantId,participantId:e,tournamentRecord:s,drawDefinition:u,tieMatchUpId:r,event:d})})))}))}))};f.forEach(i)}}}let v="string"==typeof a&&a,g=v&&hl;for(let I of p){if(m>=l)break;let{matchUps:e}=Zm({matchUpFilters:{matchUpTypes:[Cd,Ad]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:h,structure:I,event:d}),t=e.filter((({winningSide:e})=>!e)).sort(Ef).map(ll);for(let i of t){if(!isNaN(l)&&m>=l)break;let{matchUps:e}=Zm({matchUpFilters:{matchUpTypes:[Cd,Ad]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:u,matchUpsMap:h,structure:I,event:d}),t=e.find((e=>e.matchUpId===i)),n=[Ul,Il].includes(t.matchUpStatus);if(null!=t&&t.readyToScore&&!n){let e=qR({winningSide:!o&&1,matchUpStatusProfile:r,tournamentRecord:s,drawDefinition:u,targetMatchUp:t,matchUpFormat:c,matchUpStatus:g,scoreString:v,event:d});if(null!=e&&e.error)return e;m+=1}}}return{...Be,completedCount:m}}function $R(e){let{matchUpStatusCodes:t,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:u,event:d}=e;if(!a||a.matchUpStatus===ml)return;let{matchUpId:c}=a||{},{outcome:p}=YN({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:u});return t&&(p.matchUpStatusCodes=t),LN({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:c,outcome:p,event:d})}function qR(e){let{matchUpStatusProfile:t={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:u,event:d}=e;if(l||a)return $R(e);let{matchUpId:c}=s||{},{outcome:p}=jR({matchUpStatusProfile:t,matchUpFormat:o,winningSide:u});return LN({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:o,matchUpId:c,outcome:p,event:d})}function WR({matchUpStatusProfile:e,completeAllMatchUps:t,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:a}){var o,s,l,u;let d=fm({event:a}).flightProfile,{eventName:c,eventType:p,category:m}=a,{startDate:f}=n,h=[],v=(null==m?void 0:m.categoryName)||(null==m?void 0:m.ageCategoryCode)||(null==m?void 0:m.ratingType),g=null==(o=a.drawDefinitions)?void 0:o.map((({drawId:e})=>e));if(Array.isArray(null==d?void 0:d.flights))for(let[I,U]of d.flights.entries()){let{drawId:o,stage:d,drawName:m,drawEntries:y}=U;h.push(U.drawId);let S=r[I],{seedsCount:w,generate:T=!0}=S||{};if(T){let h=y.filter($d(Ma)).map($d(Ma)),U=v||c;if(n&&w&&w<=h.length&&br(1,w+1).forEach(((e,t)=>{let i={scaleValue:e,scaleName:U,scaleType:lo,eventType:p,scaleDate:f},r=h[t];nS({tournamentRecord:n,participantId:r,scaleItem:i})})),null==g?void 0:g.includes(o))break;let T=gb({...S,matchUpType:p,seedingScaleName:U,tournamentRecord:n,isMock:!0,drawEntries:y,drawName:m,drawId:o,event:a,stage:d});if(T.error)return{error:T.error,drawIds:[]};let{drawDefinition:P}=T;if(!P)return{error:Qe};let D=null==(s=r[I])?void 0:s.drawExtensions;if(Array.isArray(D)&&D.filter(ms).forEach((e=>fs({element:P,extension:e}))),T=iM({suppressNotifications:!0,tournamentRecord:n,drawDefinition:P,event:a}),T.error)return{error:T.error,drawIds:[]};if(null!=S&&S.withPlayoffs){let e=null==(l=P.structures)?void 0:l[0].structureId,t=hU({idPrefix:S.idPrefix,...S.withPlayoffs,tournamentRecord:n,drawDefinition:P,isMock:!0,structureId:e,event:a});if(null!=t&&t.error)return t}let b=null==S?void 0:S.completionGoal;if(!1!==(null==S?void 0:S.automated)&&(t||b)){let r=null==S?void 0:S.matchUpFormat,o=GR({completeAllMatchUps:!b&&t,matchUpStatusProfile:e,randomWinningSide:i,tournamentRecord:n,completionGoal:b,drawDefinition:P,matchUpFormat:r,event:a});if(o.error)return{error:o.error,drawIds:[]};let s=o.completedCount;if((null==S?void 0:S.drawType)===bu){let o=null==(u=P.structures)?void 0:u.find((e=>e.stage===xl));if(!o)return{error:bt};let l=vg({structureId:o.structureId,tournamentRecord:n,drawDefinition:P,event:a});if(l.error)return{error:l.error,drawIds:[]};if(l=GR({completeAllMatchUps:!b&&t,completionGoal:b?b?b-(s??0):void 0:void 0,matchUpStatusProfile:e,randomWinningSide:i,tournamentRecord:n,drawDefinition:P,matchUpFormat:r,event:a}),l.error)return{error:l.error,drawIds:[]}}}}}return{...Be,drawIds:h}}function HR(e){var t,i;let{participantsProfile:n={},uniqueParticipantsCount:r,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:u,uuids:d}=e,{category:c,gender:p,eventType:m}=u,f=wp(Bp)(m)&&Qd||wp(Vp)(m)&&Xd||m,h=r[xl]||0,v=r[Ll]||0,g=null!=(t=s.drawProfiles)&&t.length?h+v:(null==(i=s.participantsProfile)?void 0:i.participantsCount)??0,I=[zm,Jm].includes(p)?p:void 0,U=null!=n&&n.idPrefix?`E-${l}-${null==n?void 0:n.idPrefix}`:void 0,{participants:y}=OR({uuids:s.uuids||d,...n,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:null==o?void 0:o.startDate,rankingRange:s.rankingRange,participantType:f,participantsCount:g,ratingsParameters:a,category:c,idPrefix:U,sex:I}),S=Rb({tournamentRecord:o,participants:y});return S.error?S:{uniqueDrawParticipants:null==y?void 0:y.filter((({participantType:e})=>e===f)),uniqueParticipantIds:null==y?void 0:y.map(sl)}}function zR({autoEntryPositions:e,tournamentRecord:t,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=uu,qualifyingPositions:o=0,stage:s=xl,drawSize:l=0,drawName:u,drawId:d}=n,c=l-o,p=i.slice(0,c).map(sl);if(p.length){let i=Nh({participantIds:p,autoEntryPositions:e,entryStage:s,tournamentRecord:t,event:r});if(i.error)return i}let m=dM({drawName:u||a,qualifyingPositions:o,drawEntries:p.map((e=>({entryStatus:lc,entryStage:s,participantId:e}))),drawId:d,event:r,stage:s});return m.error?m:{...Be}}function YR({uniqueDrawParticipants:e,autoEntryPositions:t,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let l=0;for(let u of r){let{qualifyingPositions:r=0,uniqueParticipants:d,stage:c=xl,drawSize:p=0}=u,m=p-r,f=d||o||a||c===Ll,h=f?e.slice(l,l+m):i[c||xl]||[];f&&(l+=m);let v=zR({autoEntryPositions:t,drawParticipants:h,tournamentRecord:n,drawProfile:u,event:s});if(v.error)return v}return{...Be}}function KR(e){var t;let{allUniqueParticipantIds:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:u,tournamentRecord:d,eventProfile:c,eventIndex:p,publish:m,isMock:f,uuids:h}=e,v=c.gender,g=c.eventName,{eventType:I=Bp,policyDefinitions:U,drawProfiles:y=[],eventExtensions:S,surfaceCategory:w,tieFormatName:T,processCodes:P,discipline:D,eventLevel:b,timeItems:M,ballType:N,category:R}=c,A=c.eventId||am(),E=c.tieFormat||(I===$p?sP({namedFormat:T,event:{eventId:A,category:R,gender:v},hydrateCollections:s,isMock:f}):void 0),C=d.participants;for(let H of y)!v&&H.gender&&(v=null==H?void 0:H.gender);let{stageParticipantsCount:O,uniqueParticipantsCount:k,uniqueParticipantStages:F}=LR({drawProfiles:y,category:R,gender:v}),x=wp(Bp)(I)&&Qd||wp(Vp)(I)&&Xd||I,{uniqueDrawParticipants:L=[],uniqueParticipantIds:_=[]}=F?HR({event:{eventType:I,category:R,gender:v},uniqueParticipantsCount:k,participantsProfile:r,ratingsParameters:u,tournamentRecord:d,eventProfile:c,eventIndex:p,uuids:h}):{},{eventAttributes:B}=c;"object"!=typeof B&&(B={});let j=(null==R?void 0:R.categoryName)||(null==R?void 0:R.ageCategoryCode)||(null==R?void 0:R.ratingType);g=g||j||"Generated Event";let V={...B,surfaceCategory:w,processCodes:P,discipline:D,eventLevel:b,eventName:g,eventType:I,tieFormat:E,ballType:N,category:R,eventId:A,gender:v};if(null!=S&&S.length&&Array.isArray(S)){let e=S.filter(ms);null!=e&&e.length&&Object.assign(V,{extensions:e})}if(Array.isArray(M)&&M.forEach((e=>Tg({event:q,timeItem:e}))),"object"==typeof U)for(let H of Object.keys(U))vU({policyDefinitions:{[H]:U[H]},event:V});V.category&&(V.category.categoryName=j);let G,$=pM({suppressNotifications:!1,internalUse:!0,tournamentRecord:d,event:V});if($.error)return $;let q=null==$?void 0:$.event,{stageParticipants:W}=_R({allUniqueParticipantIds:i,stageParticipantsCount:O,eventParticipantType:x,targetParticipants:C});if(null!=y&&y.length){let e=YR({uniqueDrawParticipants:L,autoEntryPositions:o,stageParticipants:W,tournamentRecord:d,drawProfiles:y,category:R,gender:v,event:q});if(e.error)return e;let t=WR({matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:d,drawProfiles:y,event:q});if(t.error)return t;G=t.drawIds}else if(null!=(t=null==c?void 0:c.participantsProfile)&&t.participantsCount){let e=L.map(sl);if(e.length){let t=Nh({participantIds:e,autoEntryPositions:o,tournamentRecord:d,entryStage:xl,event:q});if(t.error)return t}}return m&&Fb({tournamentRecord:d,event:q}),{drawIds:G,eventId:A,uniqueParticipantIds:_}}function JR({tournamentRecords:e,scheduleDate:t,venueId:i,round:n}){if(!yo(t))return{error:Ui};let{extension:r}=Ds({name:Ws,tournamentRecords:e,discover:!0}),a=(null==r?void 0:r.value)||[],o=a.find((e=>$o(t,e.scheduleDate)));if(!o){let{startDate:i,endDate:n}=WP({tournamentRecords:e}),r=new Date(t);if(i&&r<new Date(i)||n&&r>new Date(n))return{error:Ui};o={scheduleDate:t,venues:[]},a.push(o)}let s=o.venues.find((e=>e.venueId===i));s||(s={venueId:i,rounds:[]},o.venues.push(s));let l=["notBeforeTime"],u=e=>Object.keys(e).filter((e=>!l.includes(e))).sort().map((t=>Ce(e[t])?u(e[t]):e[t])).flat().join("|");if(s.rounds.find((e=>u(e)===u(n))))return Sa({result:{error:Pt},stack:"addSchedulingProfileRound"});s.rounds.push(n);let d=ID({tournamentRecords:e,schedulingProfile:a});return d.error?d:{...Be}}function QR(e){var t,i,n;let r=io(e,[{drawProfile:!0,_ofType:Ha}]);if(r.error)return r;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:u,hydrateCollections:d,randomWinningSide:c,ratingsParameters:p,tournamentRecord:m,isMock:f=!0,drawProfile:h,startDate:v,drawIndex:g,uuids:I}=e,U=Wo(h,!1,!0),{excessParticipantAlternates:y=!0,matchUpFormat:S=oI,drawType:w=uu,tournamentAlternates:T=0,alternatesCount:P=0,qualifyingPositions:D,qualifyingProfiles:b,generate:M=!0,eventExtensions:N,drawExtensions:R,completionGoal:A,tieFormatName:E,seedsCount:C,timeItems:O,drawName:k,category:F,idPrefix:x,publish:L,gender:_,stage:B}=U,j=U.drawSize||(U.ignoreDefaults?void 0:32),V=U.eventId||am(),G=h.eventType||h.matchUpType||Bp,$=G===Vp?Xd:Qd,q="object"==typeof h.tieFormat&&h.tieFormat||G===ec&&sP({event:{eventId:V,category:F,gender:_},namedFormat:E,hydrateCollections:d,isMock:f})||void 0,W=(null==F?void 0:F.categoryName)||(null==F?void 0:F.ageCategoryCode)||(null==F?void 0:F.ratingType),H=h.eventName||W||`Generated ${G}`,z=(null==m?void 0:m.participants)||[],Y=((null==b?void 0:b.map((e=>e.structureProfiles||[])).flat().reduce(((e,t)=>e+(!t.participantsCount||t.participantsCount>t.drawSize?t.drawSize:t.participantsCount||0)),0))||0)*($===Xd?2:1),K=(!h.participantsCount||h.participantsCount>j?j:h.participantsCount)||0,J={eventName:H,eventType:G,tieFormat:q,category:F,eventId:V,gender:_};Array.isArray(O)&&O.forEach((e=>Tg({event:J,timeItem:e})));let{eventAttributes:Q}=h;if("object"!=typeof Q&&(Q={}),Object.assign(J,Q),(null==N?void 0:N.length)&&Array.isArray(N)){let e=N.filter(ms);null!=e&&e.length&&Object.assign(J,{extensions:e})}let Z=[];if(Y||h.uniqueParticipants||!m||_||F){let e,t,i=(K||0)+P+Y,n=i,r={[zm]:0,[Jm]:0};G===ec&&(({teamSize:e,genders:t}=FR({alternatesCount:P,tieFormatName:E,tieFormat:q,drawSize:j})),Object.keys(t).forEach((e=>{[zm,Jm].includes(e)&&t[e]&&(r[e]=j*t[e])})),n=e*((j||0)+Y));let a=null!=o&&o.idPrefix?`D-${g}-${null==o?void 0:o.idPrefix}`:void 0,s=OR({...o,scaledParticipantsCount:h.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:n,consideredDate:null==m?void 0:m.startDate,sex:_||(null==o?void 0:o.sex),rankingRange:h.rankingRange,uuids:h.uuids||I,ratingsParameters:p,participantType:$,gendersCount:r,idPrefix:a,category:F}).participants;if(J.category&&(J.category.categoryName=W),m){let e=Rb({participants:s,tournamentRecord:m});if(e.error)return e}if(s.forEach((({participantId:e})=>Z.push(e))),z=s,G===ec){let n=t[zm]?s.filter((({participantType:e,person:t})=>e===Qd&&(null==t?void 0:t.sex)===zm)).map(sl):[],r=t[Jm]?s.filter((({participantType:e,person:t})=>e===Qd&&(null==t?void 0:t.sex)===Jm)).map(sl):[],a=s.filter((({participantType:e})=>e===Qd)).map(sl).filter((e=>!n.includes(e)&&!r.includes(e))),o=e-(t[zm]+t[Jm]),l=0,u=0,d=0,c=br(0,i).map((e=>{let i=r.slice(l,l+t[Jm]),s=n.slice(u,u+t[zm]),c=a.slice(d,d+o);return l+=t[Jm],u+=t[zm],d+=o,{individualParticipantIds:[...i,...s,...c],participantOtherName:`TM${e+1}`,participantName:`Team ${e+1}`,participantRole:Ah,participantType:ec,participantId:am()}})),p=Rb({participants:c,tournamentRecord:m});if(!p.success)return p;z=c}}let X=e=>{let{participantType:t}=e;return!!(wp(Bp)(G)&&t===Qd||wp(Vp)(G)&&t===Xd)||G===ec&&t===ec},ee=e=>{var t,i;return!h.gender||(null==(t=e.person)?void 0:t.sex)===h.gender||(null==(i=e.individualParticipantIds)?void 0:i.some((e=>{let t=z.find((t=>t.participantId===e));return t&&ee(t)})))},te=z.filter(X).filter(ee).filter((({participantId:e})=>!a.includes(e))),ie=te.slice(0,K).map((e=>e.participantId));if(f&&null!=ie&&ie.length){let e=Nh({autoEntryPositions:u,entryStage:B,tournamentRecord:m,participantIds:ie,event:J});if(e.error)return e}let ne=Y?te.slice(K,K+Y).map((e=>e.participantId)):0;if(f&&null!=ne&&ne.length){let e=0,t=1,i=(e,t)=>e.stageSequence-t.stageSequence,n=(e,t)=>e.roundTarget-t.roundTarget;for(let r of b.sort(n)){t=r.roundTarget||t;let n,a=1;for(let o of r.structureProfiles.sort(i)){let i=(o.drawSize||sr(o.participantsCount))-(n||0),r=ne.slice(e,e+i),s=Nh({entryStage:Ll,entryStageSequence:a,autoEntryPositions:u,tournamentRecord:m,participantIds:r,roundTarget:t,event:J});if(s.error)return s;n=o.qualifyingPositions,e+=i,a+=1}t+=1}}let re=y&&(null==(t=null==m?void 0:m.participants)?void 0:t.filter((({participantId:e})=>!ie.includes(e))).filter(X).filter(ee).slice(0,P||j-K||T).map((e=>e.participantId)));if(f&&null!=re&&re.length){let e=Nh({participantIds:re,autoEntryPositions:!1,entryStatus:oc,tournamentRecord:m,event:J});if(e.error)return e.error}let ae=W||H;m&&C&&C<=ie.length&&br(1,C+1).forEach(((e,t)=>{let i={scaleName:ae,scaleDate:v,scaleType:hp,scaleValue:e,eventType:G},n=ie[t];nS({tournamentRecord:m,participantId:n,scaleItem:i})}));let oe=gb({...Wo(h,!1,!0),tournamentRecord:m,seedingScaleName:ae,matchUpFormat:S,eventId:V,isMock:f,event:J});if(oe.error)return oe;if(!oe.drawDefinition)return{error:Qe};let{drawDefinition:se}=oe,le=se.drawId;if(Array.isArray(R)&&R.filter(ms).forEach((e=>fs({element:se,extension:e}))),M){if(iM({drawDefinition:se,event:J,suppressNotifications:!0}),h.withPlayoffs){let e=null==(i=se.structures)?void 0:i[0].structureId,t=hU({...h.withPlayoffs,tournamentRecord:m,drawDefinition:se,structureId:e,idPrefix:x,isMock:f,event:J});if(null!=t&&t.error)return t}let e=!1===h.automated;if(f&&!e){let e=e=>{var t;let i=GR({completeAllMatchUps:e.completeAllMatchUps,completionGoal:e.completionGoal,matchUpStatusProfile:s,randomWinningSide:c,tournamentRecord:m,drawDefinition:se,matchUpFormat:S,event:J});if(i.error)return i;let n=i.completedCount;if(w===bu){let e=null==(t=se.structures)?void 0:t.find((e=>e.stage===xl));if(!e)return{error:bt};vg({structureId:e.structureId,tournamentRecord:m,drawDefinition:se,event:J});let i=GR({completionGoal:A?A?A-(n??0):void 0:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:c,tournamentRecord:m,drawDefinition:se,matchUpFormat:S,event:J});if(i.error)return i}};if(A&&e({completionGoal:A}),h.outcomes){let{matchUps:e}=Cf({inContext:!0,drawDefinition:se,event:J});for(let t of h.outcomes){let{matchUpStatus:i=hl,matchUpStatusCodes:r,stageSequence:a=1,matchUpIndex:o=0,structureOrder:s,matchUpFormat:l,drawPositions:u,roundPosition:d,stage:c=xl,roundNumber:p,winningSide:f,scoreString:h}=t,v=(null==e?void 0:e.reduce(((e,t)=>{let{structureId:i,matchUpId:n}=t;return e[i]?e[i].push(n):e[i]=[n],e}),{}))??[],g=Object.assign({},...Object.keys(v).map(((e,t)=>({[e]:t+1})))),I=null==(n=null==e?void 0:e.filter((e=>!(c&&e.stage!==c||a&&e.stageSequence!==a||p&&e.roundNumber!==p||d&&e.roundPosition!==d||s&&g[e.structureId]!==s||u&&2!==Nr(u,e.drawPositions).length))))?void 0:n[o],U=$R({matchUpStatusCodes:r,tournamentRecord:m,drawDefinition:se,targetMatchUp:I,matchUpFormat:l,matchUpStatus:i,scoreString:h,winningSide:f});if(null!=U&&U.error)return U}}l&&e({completeAllMatchUps:l})}L&&Fb({tournamentRecord:m,event:J})}else{let e=dM({drawEntries:se.entries,drawName:k||w,qualifyingPositions:D,drawId:le,event:J,stage:B});if(e.error)return e}return{...Be,event:ya(J),uniqueParticipantIds:Z,targetParticipants:z,drawDefinition:se,eventId:V,drawId:le}}var ZR=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),XR=ZR;function eA(e){return parseInt(e)}function tA({startTime:e="",endTime:t=""}={}){if(!(e&&t&&vo.test(e)&&vo.test(t)))return!1;let[i,n]=e.split(":").map(eA),[r,a]=t.split(":").map(eA);return!(r<i)&&!(i===r&&a<n)}function iA(e,t){let[i,n]=e.startTime.split(":").map(eA),[r,a]=t.startTime.split(":").map(eA);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function nA({dateAvailability:e}){if(!e)return{error:Ii};if(!Array.isArray(e))return{error:gi};let t="Times must be 24 hour => 00:00";for(let i of e){if("object"!=typeof i)return{error:gi};let{date:e,startTime:n,endTime:r,bookings:a=[]}=i;if(!n||!r)return{error:gi};if(e&&!ho.test(e))return{error:Ui,dateAvailability:{date:e},info:"Dates must be formated => YYYY-MM-DD"};if(!vo.test(n))return{error:yi,dateAvailability:{startTime:n},info:t};if(!vo.test(r))return{error:yi,dateAvailability:{endTime:r},info:t};if(n===r)return{error:yi,dateAvailability:{startTime:n,endTime:r},info:"startTime and endTime are equivalent"};if(!tA({startTime:n,endTime:r}))return{error:yi,dateAvailability:{startTime:n,endTime:r},info:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:vi};for(let e of a){if("object"!=typeof e)return{error:vi};let{startTime:i,endTime:n}=e;if(!vo.test(i))return{error:yi,booking:{startTime:i},info:t};if(!vo.test(n))return{error:yi,booking:{endTime:n},info:t};if(i===n)return{error:yi,dateAvailability:{startTime:i,endTime:n},info:"startTime and endTime are equivalent"};if(!tA({startTime:i,endTime:n}))return{error:yi,dateAvailability:{startTime:i,endTime:n},info:"endTime must be after startTime"}}}}return{valid:!0}}function rA({tournamentRecord:e,disableNotice:t,venueId:i,courtId:n,court:r}){let{venue:a}=lm({tournamentRecord:e,venueId:i});if(!a)return{error:pn};a.courts||(a.courts=[]);let o={...ZR(),venueId:i,courtId:n};if(o.courtId||(o.courtId=am()),a.courts.some((e=>e.courtId===o.courtId)))return{error:dn};{let n=((null==r?void 0:r.dateAvailability)||[]).map((e=>{var t;return{...e,date:Co(e.date),startTime:Eo(e.startTime),endTime:Eo(e.endTime),bookings:null==(t=e.bookings)?void 0:t.map((({startTime:e,endTime:t,bookingType:i})=>({startTime:Eo(e),endTime:Eo(t),bookingType:i})))}})),s=Object.keys(o);for(let e of s)if(null!=r&&r[e])if("dateAvailability"===e){let e=nA({dateAvailability:n});if(!e.valid&&e.error)return e;o.dateAvailability=n}else o[e]=r[e];let l=o;return a.courts.push(l),t||ia({payload:{venue:a,tournamentId:e.tournamentId},topic:sd,key:a.venueId}),{...Be,court:Wo(o),venueId:i}}}function aA(e){let{tournamentRecord:t,venueId:i}=e;if("string"!=typeof i||!i)return{error:mn};let n,r=e.tournamentRecords??(t&&{[t.tournamentId]:t})??{},a=[];for(let o of Object.values(r)){let{venue:t}=lm({tournamentRecord:o,venueId:i});if(t){let t=oA({...e,tournamentRecord:o});for(let e of(null==t?void 0:t.courts)??[])a.push(null==e?void 0:e.courtId);if(t.error)return t;n=!0}}return n?{...Be,courtIds:a}:{error:pn}}function oA({courtNameRoot:e="Court",dateAvailability:t=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:u,idPrefix:d,venueId:c,dates:p}){if(!c)return{error:mn};let m=lm({tournamentRecord:n,venueId:c});if(m.error)return m;let{venue:f}=m;if(!ur(o)||!r)return{error:ln};let h=br(0,o=o??r.length).map((n=>{let o=null==a?void 0:a[n],l=o?p.map((e=>({date:wo(e),startTime:s,endTime:u,...o}))):t;return o&&s&&u&&l.push({startTime:s,endTime:u}),{courtName:r[n]||i&&(null==f?void 0:f.venueAbbreviation)&&`${null==f?void 0:f.venueAbbreviation} ${n+1}`||`${e} ${n+1}`,dateAvailability:l}})).map(((e,t)=>{let i=(null==l?void 0:l.pop())||d&&`${d}-${t+1}`;return rA({disableNotice:!0,tournamentRecord:n,courtId:i,venueId:c,court:e})})).map((e=>e.court)).filter(Boolean);return h.length!==o?Sa({info:"not all courts could be generated",result:{error:Fn}}):(f&&ia({payload:{venue:f,tournamentId:n.tournamentId},topic:sd,key:f.venueId}),{...Be,courts:Wo(h)})}function sA({tournamentRecord:e,venueProfiles:t,uuids:i}){let{startDate:n,endDate:r}=e,a=[];for(let[o,s]of t.entries()){let{venueAbbreviation:t,venueId:l=(null==i?void 0:i.pop())??am(),dateAvailability:u,startTime:d="07:00",endTime:c="19:00",courtTimings:p,courtsCount:m,courtNames:f,venueName:h,idPrefix:v,courtIds:g}=s,I=om({tournamentRecord:e,venue:{venueName:h||`Venue ${o+1}`,venueAbbreviation:t,venueId:l}});if(I.error)return I;a.push(l);let U=Do(n,r),y=!Array.isArray(u)&&[{startTime:d,endTime:c}].concat(U.map((e=>({date:wo(e),startTime:d,endTime:c})))),S=aA({dateAvailability:u||y,tournamentRecord:e,courtTimings:p,courtsCount:m,courtNames:f,startTime:d,idPrefix:v,courtIds:g,endTime:c,venueId:l,dates:U});if(S.error)return S}return a}var lA=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function uA(e){let{tournamentAttributes:t,startDate:i,endDate:n}=e??{},{tournamentName:r=Pr(lA),ratingsParameters:a=cS,scheduleCompletedMatchUps:o,tournamentExtensions:s,matchUpStatusProfile:l,completeAllMatchUps:u,participantsProfile:d,autoEntryPositions:c,hydrateCollections:p,randomWinningSide:m,policyDefinitions:f,schedulingProfile:h,periodLength:v,autoSchedule:g,eventProfiles:I,venueProfiles:U,drawProfiles:y,uuids:S}=e??{};if(i&&!yo(i)||n&&!yo(n))return{error:Ui};if(I&&!Array.isArray(I))return{error:Fn};if(!i){let e=new Date;i=wo(n??e),n=wo(e.setDate(e.getDate()+7))}if(!n){let e=new Date(i);n=wo(e.setDate(e.getDate()+7))}"object"!=typeof t&&(t={});let w=UR({...t,tournamentName:r,isMock:!0,startDate:i,endDate:n});if(null!=s&&s.length&&Array.isArray(s)){let e=s.filter((e=>ms({extension:e})));null!=e&&e.length&&Object.assign(w,{extensions:e,isMock:!0})}if("object"==typeof f)for(let A of Object.keys(f))vU({policyDefinitions:{[A]:f[A]},tournamentRecord:w});let T=xR({participantsProfile:d,tournamentRecord:w,eventProfiles:I,drawProfiles:y,startDate:i,uuids:S});if(!T.success)return T;let P=[],D=[],b=[];if(Array.isArray(y)){let e=0;for(let t of y){let n=QR({allUniqueParticipantIds:P,matchUpStatusProfile:l,completeAllMatchUps:u,autoEntryPositions:c,hydrateCollections:p,participantsProfile:d,randomWinningSide:m,ratingsParameters:a,tournamentRecord:w,isMock:!0,drawProfile:t,startDate:i,drawIndex:e,uuids:S});if(n.error)return n;let{drawId:r,eventId:o,event:s,uniqueParticipantIds:f}=n;if(n=pM({suppressNotifications:!1,internalUse:!0,tournamentRecord:w,event:s}),n.error)return n;r&&b.push(r),D.push(o),null!=f&&f.length&&P.push(...f),e+=1}}if(I){let e=0;for(let t of I){let n=KR({allUniqueParticipantIds:P,matchUpStatusProfile:l,participantsProfile:d,completeAllMatchUps:u,autoEntryPositions:c,hydrateCollections:p,randomWinningSide:m,ratingsParameters:a,tournamentRecord:w,eventProfile:t,eventIndex:e,startDate:i,uuids:S});if(n.error)return n;let{eventId:r,drawIds:o,uniqueParticipantIds:s}=n;o&&b.push(...o),D.push(r),null!=s&&s.length&&P.push(...s),e+=1}}let M,N=null!=U&&U.length?sA({tournamentRecord:w,venueProfiles:U,uuids:S}):[],R={};if(h){let e=function({schedulingProfile:e,tournamentRecord:t}){if("object"!=typeof e)return{error:Fn};let i=Nd({tournamentRecord:t}).containedStructures,n=Rf({tournamentRecord:t}).matchUps??[],{tournamentId:r}=t,a=[];for(let o of e){let{scheduleDate:e,venues:s=[]}=o;for(let o of s){let{rounds:s,venueId:l}=o;for(let o of s){let{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,c=n.filter((e=>{var t;let i=(null==u?void 0:u.indexOf("-"))>0&&u.split("-").map((e=>+e)),n=null==(t=e.finishingPositionRange)?void 0:t.winner;return!(e.drawId!==s||o.roundNumber&&e.roundNumber!==o.roundNumber||n&&i&&2!==Nr(n,i).length&&(hr(n).length!==hr(i).length||Nr(n,i).length!==hr(n).length))}))[0];if(c){let{eventId:n,roundNumber:o,drawName:p,structureName:m,roundName:f}=c,h=c.structureId;o&&!u&&(h=Object.keys(i).find((e=>i[e].includes(h)))??h);let v={tournamentId:r,structureId:h,roundNumber:o,roundSegment:d,eventId:n,drawId:s},g=JR({tournamentRecords:{[r]:t},round:v,scheduleDate:e,venueId:l});if(g.error)return g;a.push({structureName:m,roundName:f,drawName:p,...v})}}}}return{scheduledRounds:a}}({schedulingProfile:h,tournamentRecord:w});if(e.error)return e;if(M=e.scheduledRounds,g){let{tournamentId:e}=w;R=IR({scheduleCompletedMatchUps:o,tournamentRecords:{[e]:w},periodLength:v})}}return ta(),ya({...Be,tournamentRecord:w,scheduledRounds:M,schedulerResult:R,eventIds:D,venueIds:N,drawIds:b})}var dA={};function cA({keepExtensions:e=[],anonymizeParticipantNames:t=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var o,s,l,u,d;if(!i)return{error:We};let c=Array.isArray(e)?Js.concat(...e):Js,p=t=>{var i;return Array.isArray(e)?null==(i=null==t?void 0:t.extensions)?void 0:i.filter((e=>c.includes(e.name))):null==t?void 0:t.extensions},m={};i.extensions=p(i);let f=a||am();m[i.tournamentId]=f,i.tournamentId=f,i.createdAt=(new Date).toISOString(),i.tournamentName=n||`Anonymized: ${wo(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){let e=am();m[L.participantId]=e,L.participantId=e}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map((e=>m[e])));let h=0;for(let L of i.venues||[]){L.extensions=p(L),L.venueName=`Venue #${h}`,L.venueAbbreviation=`V${h}`;let e=am();m[L.venueId]=e,L.isMock=!0,h+=1}let v=1;for(let L of i.events||[]){L.extensions=p(L),L.isMock=!0;let e=am();m[L.eventId]=e,L.eventId=e;let t=(null==(o=L.category)?void 0:o.categoryName)||(null==(s=L.category)?void 0:s.ageCategoryCode)||(null==(l=L.category)?void 0:l.ratingType)||L.gender;if(L.eventName=`Event ${v} ${t}`,Array.isArray(L.entries))for(let n of L.entries)n.participantId=m[n.participantId];for(let n of L.drawDefinitions||[]){n.extensions=p(n);let e=am();if(m[n.drawId]=e,n.drawId=e,n.isMock=!0,Array.isArray(n.entries))for(let i of n.entries)i.participantId=m[i.participantId];let t=e=>{e.extensions=p(e);let t=am();m[e.structureId]=t,e.structureId=t;for(let i of e.positionAssignments||[])i.participantId&&(i.participantId=m[i.participantId]);for(let i of e.seedAssignments||[])i.participantId&&(i.participantId=m[i.participantId]);for(let i of e.matchUps||[]){i.isMock=!0;for(let e of i.sides||[])e.lineUp&&(e.lineUp=e.lineUp.map((({participantId:e,collectionAssignments:t})=>({participantId:m[e],collectionAssignments:t}))))}};for(let i of n.structures||[])if(t(i),Array.isArray(i.structures))for(let e of i.structures)t(e);for(let i of n.links||[])i.source.structureId=m[i.source.structureId],i.target.structureId=m[i.target.structureId]}let{extension:i}=Ds({name:Fs,element:L});Array.isArray(null==(u=null==i?void 0:i.value)?void 0:u.flights)&&(null==(d=null==i?void 0:i.value.flights)||d.forEach((e=>{if(e.drawId=m[e.drawId],Array.isArray(e.drawEntries))for(let t of e.drawEntries)t.participantId=m[t.participantId]}))),v+=1}let g=i.startDate||wo(new Date),I=(i.participants||[]).filter((({participantType:e})=>e===Qd)),U=I.reduce(((e,t)=>{var i;let n=null==(i=t.person)?void 0:i.sex;return[zm,Jm].includes(n)?e[n]+=1:e[Km]+=1,e}),{[zm]:0,[Jm]:0,[Km]:0}),y=Object.assign({},...Object.keys(U).map((e=>{var t;return{[e]:(null==(t=RR({category:{ageCategoryCode:"O18"},count:U[e],addressProps:{citiesCount:10},personExtensions:[],consideredDate:g,sex:e}))?void 0:t.persons)||[]}}))),S={[zm]:0,[Jm]:0,[Km]:0},w=I.length,T=I.reduce(((e,t)=>{var i,n;let r=(null==(n=null==(i=t.person)?void 0:i.addresses)?void 0:n[0])||{},{city:a,state:o,postalCode:s}=r;return e.cities.includes(a)||e.cities.push(a),e.states.includes(o)||e.states.push(o),e.postalCodes.includes(s)||e.postalCodes.push(s),e}),{cities:[],postalCodes:[],states:[]}),P=T.postalCodes.length,D=T.cities.length,b=T.states.length,{cities:M}=TR({count:D||w,participantsCount:w}),{states:N}=PR({count:b||w,participantsCount:w}),{postalCodes:R}=DR({count:P||w,participantsCount:w}),A={cities:M,states:N,postalCodes:R};I.forEach(((e,i)=>{var n,a;let o=null==e?void 0:e.person,s=(null==o?void 0:o.sex)||Km,l=null==(n=Co(null==o?void 0:o.birthDate))?void 0:n.split("-")[0],u=S[s],d=y[s][u];if(S[s]+=1,l){let[,e,t]=(null==(a=null==d?void 0:d.birthDate)?void 0:a.split("-"))||[],i=[l,e,t].join("-");d.birthDate=i}if(null!=o&&o.addresses){let e=bR({...A,participantIndex:i,nationalityCode:d.nationalityCode});d.addresses=[e]}d.personId=(null==r?void 0:r[i])||am(),t?(d.standardFamilyName=d.lastName,d.standardGivenName=d.firstName,e.participantName=`${d.standardGivenName} ${d.standardFamilyName}`):(d.standardFamilyName=null==o?void 0:o.standardFamilyName,d.standardGivenName=null==o?void 0:o.standardGivenName),delete d.firstName,delete d.lastName,d.extensions=p(o),e.person=d,m[null==o?void 0:o.personId]=d.personId})),(i.participants||[]).filter((({participantType:e})=>e===Xd)).forEach((e=>{let{individualParticipantIds:t}=e;e.participantName=function({individualParticipantIds:e,individualParticipants:t}){let i=t.filter((({participantId:t})=>e.includes(t))).map((({person:e})=>null==e?void 0:e.standardFamilyName)).filter(Boolean).sort().join("/");return 1===e.length&&(i+="/Unknown"),i}({individualParticipantIds:t,individualParticipants:I})}));let E=(i.participants||[]).filter((({participantType:e})=>e===ec)),C=ER({count:E.length}).names;E.forEach(((e,t)=>{e.participantName=C[t]}));let O=(i.participants||[]).filter((({participantType:e})=>e===Zd)),k=ER({count:O.length,nameRoot:"Group"}).names;O.forEach(((e,t)=>{e.participantName=k[t]}));let{extension:F}=Ds({element:i,name:Ws});Array.isArray(null==F?void 0:F.value)&&(null==F||F.value.forEach((e=>{e.tournamentId=m[e.tournamentId],e.structureId=m[e.structureId],e.eventId=m[e.eventId],e.drawId=m[e.drawId]})));let{extension:x}=Ds({element:i,name:Vs});return Array.isArray(null==x?void 0:x.value)&&(null==x||x.value.forEach((e=>{e.personId=m[e.personId]}))),{...Be}}function pA(e){var t,i,n;let{ratingsParameters:r=cS,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:d,schedulingProfile:c,tournamentRecord:p,eventProfiles:m,periodLength:f,venueProfiles:h,autoSchedule:v,drawProfiles:g,uuids:I}=e;if(!p)return{error:We};let U=[],y=[],S=[];null==m||m.forEach((e=>{var t;let i=null==(t=p.events)?void 0:t.find(((t,i)=>void 0!==e.eventIndex&&i===e.eventIndex||e.eventName&&t.eventName===e.eventName||e.eventId&&t.eventId===e.eventId));null!=i&&i.gender&&(e.gender=i.gender)}));let w=(null==(t=p.participants)?void 0:t.length)||void 0;w&&null!=a&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${w}`);let T=xR({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:m,drawProfiles:g,uuids:I});if(!T.success)return T;if(m){let e=(null==(i=p.events)?void 0:i.length)||0;for(let t of m){let{ratingsParameters:i}=t,r=null==(n=p.events)?void 0:n.find(((e,i)=>void 0!==t.eventIndex&&i===t.eventIndex||t.eventName&&e.eventName===t.eventName||t.eventId&&e.eventId===t.eventId));if(r){let{gender:e,category:n,eventType:u}=r,{drawProfiles:c,publish:m}=t,f=wp(Bp)(u)&&Qd||wp(Vp)(u)&&Xd||u;if(c){let{stageParticipantsCount:m,uniqueParticipantsCount:h,uniqueParticipantStages:v}=LR({drawProfiles:c,category:n,gender:e}),{uniqueDrawParticipants:g=[],uniqueParticipantIds:y=[]}=v?HR({event:{eventType:u,category:n,gender:e},uniqueParticipantsCount:h,participantsProfile:a,ratingsParameters:i,tournamentRecord:p,eventProfile:t,uuids:I}):{};U.push(...y);let{stageParticipants:w}=_R({targetParticipants:p.participants||[],allUniqueParticipantIds:U,stageParticipantsCount:m,eventParticipantType:f}),T=YR({uniqueDrawParticipants:g,autoEntryPositions:l,stageParticipants:w,tournamentRecord:p,drawProfiles:c,category:n,gender:e,event:r});if(T.error||(T=WR({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:d,tournamentRecord:p,drawProfiles:c,event:r}),T.error))return T;S.push(...T.drawIds)}m&&Fb({tournamentRecord:p,event:r})}else{let n=KR({startDate:p.startDate,allUniqueParticipantIds:U,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:d,ratingsParameters:i,tournamentRecord:p,eventProfile:t,eventIndex:e,uuids:I});if(n.error)return n;let{eventId:r,drawIds:u,uniqueParticipantIds:c}=n;u&&S.push(...u),y.push(r),null!=c&&c.length&&U.push(...c),e+=1}}}if(g){let e=(p.events||[]).map((e=>{var t;return(null==(t=e.drawDefinitions)?void 0:t.map((()=>1)))||[]})).flat().reduce(((e,t)=>e+t),0);for(let t of g){let i=QR({startDate:p.startDate,allUniqueParticipantIds:U,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:u,randomWinningSide:d,ratingsParameters:r,tournamentRecord:p,drawProfile:t,drawIndex:e,uuids:I});if(i.error)return i;let{drawId:n,eventId:c,event:m,uniqueParticipantIds:f}=i;if(i=pM({tournamentRecord:p,event:m,internalUse:!0}),i.error)return i;n&&S.push(n),y.push(c),null!=f&&f.length&&U.push(...f),e+=1}}let P=null!=h&&h.length?sA({tournamentRecord:p,venueProfiles:h}):[],D={};if(null!=c&&c.length){let e=ID({tournamentRecords:{[p.tournamentId]:p},schedulingProfile:c});if(e.error)return e;if(v){let{tournamentId:e}=p;D=IR({tournamentRecords:{[e]:p},periodLength:f})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:undefined,schedulerResult:D,...Be,eventIds:y,venueIds:P,drawIds:S}}be(dA,{anonymizeTournamentRecord:()=>cA,modifyTournamentRecord:()=>pA});var mA={};be(mA,{addIndividualParticipantIds:()=>WM,addParticipant:()=>Nb,addParticipants:()=>Rb,addPenalty:()=>_A,addPersonRequests:()=>yA,addPersons:()=>jA,createGroupParticipant:()=>NA,createTeamsFromParticipantAttributes:()=>yR,deleteParticipants:()=>jh,filterParticipants:()=>fh,findParticipant:()=>MA,getCompetitionParticipants:()=>CP,getPairedParticipant:()=>Pm,getParticipantEventDetails:()=>OP,getParticipantMembership:()=>kP,getParticipantScaleItem:()=>iS,getParticipantSchedules:()=>FP,getParticipantSignInStatus:()=>xP,getParticipantTimeItem:()=>yf,getParticipants:()=>vh,getScaleValues:()=>co,mergeParticipants:()=>LA,modifyIndividualParticipantIds:()=>SA,modifyParticipant:()=>HM,modifyParticipantName:()=>RA,modifyParticipantOtherName:()=>TA,modifyParticipantsSignInStatus:()=>wA,modifyPenalty:()=>kA,modifyPersonRequests:()=>IA,mutate:()=>fA,participantScaleItem:()=>rh,query:()=>EP,regenerateParticipantNames:()=>bA,removeIndividualParticipantIds:()=>Lh,removeParticipantIdsFromAllTeams:()=>Bh,removePenalty:()=>EA,removePersonRequests:()=>UA,scaledTeamAssignment:()=>AA,setParticipantScaleItem:()=>nS,setParticipantScaleItems:()=>rS,validateLineUp:()=>Pv});var fA={};function hA(e=0){("number"!=typeof e||isNaN(e))&&(e=0);let t=new Date;return t.setHours(t.getHours()+e),t.getTime().toString(36).slice(-6).toUpperCase()}function vA({personRequests:e,personId:t,requests:i}){e[t]||(e[t]=[]);let n=i.filter((({requestType:e})=>e)).map((e=>{let{date:t,startTime:i,endTime:n}=e;return e.requestType===eR&&(t=Co(t),i=Eo(i),n=Eo(n),t&&i&&n)?{date:t,startTime:i,endTime:n,requestType:e.requestType}:e})).filter(Boolean);for(let r of n)r.requestId=hA(),e[t].push(r);return{mergeCount:n.length}}function gA(e){let{tournamentRecords:t,personRequests:i}=e,n=io(e,[{[wa]:!0}]);if(n.error)return n;if(!i)return{...Be};let r=Object.values(t);for(let a of r){let e=a.participants??[],t=[];for(let n of Object.keys(i))if(us({tournamentParticipants:e,personId:n})){let e=i[n];e.length&&t.push({personId:n,requests:e})}Object.keys(t).length&&fs({element:a,extension:{value:t,name:Vs}})}return{...Be}}function IA(e){let{tournamentRecords:t,requests:i,personId:n}=e,r=io(e,[{[wa]:!0},{requests:!0,[Qa]:za,[Ja]:Fn}]);if(r.error)return r;let a=i.map((({requestId:e})=>e)).filter(Boolean),{personRequests:o}=SD({tournamentRecords:t}),s=e=>{o&&(o[e]=o[e].map((e=>{if(!a.includes(e.requestId))return e;let t=i.find((t=>t.requestId===e.requestId));return t.requestType?Object.assign(e,t):void 0})).filter(Boolean))};if(n&&null!=o&&o[n])s(n);else if(o)for(let u of Object.keys(o))s(u);let l=i.filter((e=>!e.requestId));return l.length&&vA({personRequests:o,personId:n,requests:l}),gA({tournamentRecords:t,personRequests:o})}function UA(e){let{tournamentRecords:t,requestType:i,requestId:n,personId:r,date:a}=e,o=io(e,[{[wa]:!0}]);if(o.error)return o;let{personRequests:s}=SD({tournamentRecords:t}),l=e=>{var t;s&&(s[e]=s[e].filter((e=>!(i&&e.requestType===i||n&&e.requestId===n||a&&e.date===a))),null!=(t=null==s?void 0:s[e])&&t.length||delete s[e])},u=!(i||n||r||a);if(!u)if(r&&null!=s&&s[r])l(r);else if(s)for(let d of Object.keys(s))l(d);return!u&&s&&Object.keys(s).length?gA({tournamentRecords:t,personRequests:s}):ps({name:Vs,tournamentRecords:t,discover:!0})}function yA(e){let{tournamentRecords:t,personId:i,requests:n}=e,r=io(e,[{[wa]:!0,personId:!0},{requests:!0,[Qa]:za,[Ja]:Fn}]);if(r.error)return r;let{personRequests:a}=SD({tournamentRecords:t}),{mergeCount:o}=vA({personRequests:a,personId:i,requests:n});return o&&a?gA({tournamentRecords:t,personRequests:a}):{error:Fn}}function SA({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return Sa({result:{error:We},stack:n});if(!t||!e)return Sa({result:{error:mi},stack:n});let r=i.participants||[],a=r.find((e=>e.participantId===t));if(!a)return Sa({result:{error:Bi},stack:n});if(![ec,Zd].includes(a.participantType))return Sa({result:{error:ki},context:{participantType:a.participantType},stack:n});let o=e.filter((e=>{var t;return(null==(t=r.find((t=>t.participantId===e)))?void 0:t.participantType)!==Qd}));if(o.length)return Sa({result:{error:Ci,invalidParticipantIds:o},stack:n});let s=a.individualParticipantIds||[],l=e.filter((e=>!s.includes(e))),u=s.filter((t=>!e.includes(t))),d=WM({individualParticipantIds:l,groupingParticipantId:t,tournamentRecord:i});if(d.error)return Sa({result:d,stack:n});let c=Lh({individualParticipantIds:u,groupingParticipantId:t,tournamentRecord:i});if(c.error)return Sa({result:c,stack:n});let{topics:p}=sa();if(p.includes(nd)){let e=r.find((({participantId:e})=>e===t));ia({topic:nd,payload:{tournamentId:i.tournamentId,participants:[e]}})}return{...d,...c}}function wA({tournamentRecord:e,participantIds:t,signInState:i}){if(!e)return{error:We};if(!Array.isArray(t))return{error:mi};if(![Kd,Yd].includes(i))return{error:Fn,signInState:i};let n=e.participants||[];if(!n.length)return{error:Li};let r=n.map(sl),a=t.filter((e=>!r.includes(e)));if(a.length)return{error:Fn,context:{invalidParticipantIds:a}};let o=[],s=(new Date).toISOString();for(let u of n){let{participantId:n}=u;if(t.includes(n)){let t=Sg({duplicateValues:!1,tournamentRecord:e,participantId:n,timeItem:{itemType:zd,itemValue:i,createdAt:s}});if(t.error)return t;o.push(u)}}let{topics:l}=sa();return o.length&&l.includes(nd)&&ia({topic:nd,payload:{tournamentId:e.tournamentId,participants:o}}),{...Be}}function TA({tournamentRecord:e,participantId:t,participantOtherName:i}){if(!e)return{error:We};if(!t)return{error:_i};let{participant:n}=hf({tournamentRecord:e,participantId:t});if(!n)return{error:Bi};n.participantOtherName=i;let{topics:r}=sa();return r.includes(nd)&&ia({topic:nd,payload:{tournamentId:e.tournamentId,participants:[n]}}),{...Be}}function PA({personFormat:e,person:t}){let i=e=>e.replace(/\W/g,""),n=e=>e.toLowerCase().indexOf("l")<e.toLowerCase().indexOf("f"),r=e=>e.indexOf(",")>=0;if(!t)return;let a=e.indexOf(" ")>0?" ":"",o=zh((null==t?void 0:t.standardGivenName)??""),s=zh((null==t?void 0:t.standardFamilyName)??"");if(!e)return`${o}${a}${s}`;(e=>e.toLowerCase().indexOf("f.")>=0)(e)&&!r(e)&&!n(e)&&(o=`${o[0]}.`),(e=>/^[a-z]*$/.test(i(e)))(e)?(o=o.toLowerCase(),s=s.toLowerCase()):(e=>/^[A-Z]*$/.test(i(e)))(e)?(o=o.toUpperCase(),s=s.toUpperCase()):(e=>/^[LAST]{4}/.test(i(e)))(e)&&(s=s.toUpperCase());let l=`${o}${a}${s}`;return(e=>e.toLowerCase().indexOf("f")<0)(e)?l=s:n(e)&&(l=r(e)?`${s},${a}${o}`:`${s}${a}${o}`),l}function DA({participantMap:e,participant:t,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=t,o=n&&i[n];if(n!==Jd&&o){let{personFormat:i,doublesJoiner:s}=o;n===Qd&&(t.participantName=PA({person:a,personFormat:i})),n===Xd&&(t.participantName=null==r?void 0:r.map((t=>{var n;return PA({person:null==(n=e[t])?void 0:n.person,personFormat:i})})).filter(Boolean).join(s??"/"))}}function bA({tournamentRecord:e,formats:t}){if(!e)return{error:We};if(!Ce(t))return{error:mi};let i=e.participants??[],n=ke(i,"participantId");for(let r of i)DA({participant:r,participantMap:n,formats:t});return{...Be}}function MA(e){let t,i,{tournamentRecord:n,policyDefinitions:r,contextProfile:a,participantId:o,personId:s}=e,l=e.tournamentRecords||n&&{[n.tournamentId]:n}||{};if("string"!=typeof o&&"string"!=typeof s)return{error:mi,stack:"publicFindParticipant"};for(let u of Object.values(l)){if(i=u.tournamentId,t=us({tournamentParticipants:u.participants||[],internalUse:!0,policyDefinitions:r,contextProfile:a,participantId:o,personId:s}),t)break}return{participant:t,tournamentId:i,...Be}}function NA({individualParticipantIds:e=[],participantRoleResponsibilities:t,participantRole:i=kh,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:We};if(!a)return{error:mi,info:"Missing groupName"};if(!Array.isArray(e))return{info:"Invalid individualParticipantIds",error:Fn};let o=(vh({participantFilters:{participantTypes:[Qd]},tournamentRecord:n}).participants??[]).map((e=>e.participantId));for(let d of e)if(!o.includes(d))return{error:ki,participantId:d};let s=ya({participantId:r||am(),participantRoleResponsibilities:t,participantName:a,individualParticipantIds:e,participantType:Zd,participantRole:i}),l=Nb({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:u}=sa();return u.includes(Wu)&&ia({topic:Wu,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...Be,participant:Wo(s)}}function RA({tournamentRecord:e,participantName:t,participantId:i}){if(!e)return{error:We};if(!i)return{error:_i};if(!t)return{error:mi,info:"Missing participantName"};let{participant:n}=hf({tournamentRecord:e,participantId:i});if(!n)return{error:Bi};n.participantName=t;let{topics:r}=sa();return r.includes(nd)&&ia({topic:nd,payload:{tournamentId:e.tournamentId,participants:[n]}}),{...Be}}function AA({clearExistingAssignments:e=!0,individualParticipantIds:t,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:u,eventId:d,event:c}){var p,m,f,h,v;if(!o)return{error:We};if(!Array.isArray(a)&&!mr(u)&&!d||!mr(n)||r&&!Array.isArray(r)||s&&("object"!=typeof s||!Object.keys(s).length))return{error:Fn};if(!s&&!r.length||!r&&(!t||!s))return{error:mi,info:"Missing scaling details"};if(d&&!a){if((null==c?void 0:c.eventType)!==qp)return{error:At};a=null==(p=null==c?void 0:c.entries)?void 0:p.filter((({entryStatus:e})=>e===lc)).map(sl)}if(!(null!=a&&a.length||u))return{info:"Missing teamParticipantIds or teamsCount",error:mi};let g=t??r.map((({participantId:e})=>e));i&&(null==a||a.reverse(),n+=1),n>((null==a?void 0:a.length)||0)-1&&(n=0);let I=(null==a?void 0:a.slice(n).concat(...a.slice(0,n)))??[],U=[];for(let w of o.participants??[]){let{participantId:e,participantType:t}=w;if(I.includes(e)){if(t!==Jd)return{error:ki,participant:w};U.push(w)}}if(u&&U.length<u){let e=u-((null==U?void 0:U.length)||0),t=l??"Team",i=br(0,e).map((e=>({participantName:`${t} ${e+1}`,participantType:Jd,participantRole:Ah}))),{participants:n=[]}=Rb({participants:i,returnParticipants:!0,tournamentRecord:o}),r=n.map(sl),a=(null==(m=o.participants)?void 0:m.filter((({participantId:e})=>r.includes(e))))??[];U.push(...a)}if(!U.length)return{error:Ln};if(e)for(let w of U)w.individualParticipantIds=[];else{let e=U.map((e=>e)).flat();null!=t&&t.length?g=g.filter((t=>!e.includes(t))):r=null==r?void 0:r.filter((({participantId:t})=>!e.includes(t)))}if(!(null!=t&&t.length||null!=r&&r.length))return{error:Rn,info:"Nothing to be done"};if(!r.length){for(let e of o.participants??[]){let{participantId:t,participantType:i}=e;if(!g.includes(t))continue;if(i!==Qd)return{error:ki,participant:e};let n=null==(f=rh({scaleAttributes:s,participant:e}))?void 0:f.scaleItem,a={participantId:t,scaleValue:null!=s&&s.accessor?null==(h=null==n?void 0:n.scaleValue)?void 0:h[null==s?void 0:s.accessor]:null==n?void 0:n.scaleValue};r.push(a)}if(!r.length)return{error:Bi}}r.sort(((e,t)=>null!=s&&s.sortOrder?((null==t?void 0:t.scaleValue)||0)-((null==e?void 0:e.scaleValue)||0):((null==e?void 0:e.scaleValue)||1/0)-((null==t?void 0:t.scaleValue)||1/0)));for(let w of r)if(!w.participantId)return{error:Fn,scaledParticipant:w};let y=0;for(;y<r.length;){for(let e of U){if(y+1>r.length)break;let t=r[y];e.individualParticipantIds.push(t.participantId),y++}U.reverse()}let S=U.map(sl);for(let w of o.events??[]){if(w.eventType!==qp)continue;let e=(w.entries??[]).filter((e=>S.includes(e.participantId)));for(let t of e){let e=t.participantId,i=null==(v=U.find((t=>t.participantId===e)))?void 0:v.individualParticipantIds;w.entries=(w.entries??[]).filter((e=>!i.includes(e.participantId))),(w.drawDefinitions??[]).forEach((e=>{e.entries=(e.entries??[]).filter((e=>!i.includes(e.participantId)))}));let{flightProfile:n}=fm({event:w});((null==n?void 0:n.flights)||[]).forEach((e=>{e.drawEntries=(e.drawEntries||[]).filter((e=>!i.includes(e.participantId)))}))}}return{...Be,scaledParticipants:r}}function EA(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:qe};for(let i of Object.values(t)){let t=CA({...e,tournamentRecord:i});if(t.error&&t.error!==sn)return t}return{...Be}}function CA({tournamentRecord:e,penaltyId:t}){if(!e)return{error:We};if(!t)return{error:on};let i,n=(null==e?void 0:e.participants)??[],r=[],a=!1;return n.forEach((e=>{let n=!1;e.penalties=(e.penalties??[]).filter((o=>(o.penaltyId===t&&(n=!0,a||(i=o,a=!0)),n&&r.push(e),o.penaltyId!==t)))})),i&&ia({topic:nd,payload:{tournamentId:e.tournamentId,participants:r}}),i?{...Be,penalty:i}:{error:sn}}be(fA,{addIndividualParticipantIds:()=>WM,addParticipant:()=>Nb,addParticipants:()=>Rb,addPenalty:()=>_A,addPersonRequests:()=>yA,addPersons:()=>jA,createGroupParticipant:()=>NA,createTeamsFromParticipantAttributes:()=>yR,deleteParticipants:()=>jh,findParticipant:()=>MA,mergeParticipants:()=>LA,modifyIndividualParticipantIds:()=>SA,modifyParticipant:()=>HM,modifyParticipantName:()=>RA,modifyParticipantOtherName:()=>TA,modifyParticipantsSignInStatus:()=>wA,modifyPenalty:()=>kA,modifyPersonRequests:()=>IA,regenerateParticipantNames:()=>bA,removeIndividualParticipantIds:()=>Lh,removeParticipantIdsFromAllTeams:()=>Bh,removePenalty:()=>EA,removePersonRequests:()=>UA,scaledTeamAssignment:()=>AA,setParticipantScaleItem:()=>nS,setParticipantScaleItems:()=>rS});var OA=({penaltyId:e=am()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:e});function kA(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:qe};for(let i of Object.values(t)){let t=FA({...e,tournamentRecord:i});if(t.error&&t.error!==sn||t.success)return t}return{error:sn}}function FA({tournamentRecord:e,modifications:t,penaltyId:i}){if(!e)return{error:We};if(!t)return{error:Fn,modifications:t};if(!i)return{error:on};let n=(null==e?void 0:e.participants)??[],r=Object.keys(OA()).filter((e=>"penaltyId"!==e)),a=Object.keys(t).filter((e=>r.includes(e)));if(!a.length)return{error:Bn};let o,s=[];return n.forEach((e=>{let n=!1;e.penalties=(e.penalties??[]).map((e=>(e.penaltyId===i&&(n=!0,a.forEach((i=>Object.assign(e,{[i]:t[i]}))),o||(o=e)),e))),n&&s.push(e)})),o&&ia({topic:nd,payload:{tournamentId:e.tournamentId,participants:s}}),o?{...Be,penalty:o}:{error:sn}}function xA(e,t,i){return!e&&t?t:e&&!t||"object"!=typeof e||"object"!=typeof t?e:hr(Object.keys(e).concat(Object.keys(t))).reduce(((n,r)=>{if(t[r])if(e[r])if(typeof e[r]!=typeof t[r])n[r]=t[r];else if(Array.isArray(e[r]))if(!0===i||Array.isArray(i)&&i.includes(r)){let i=hr(e[r].map((e=>JSON.stringify(e))).concat(t[r].map((e=>JSON.stringify(e))))).map((e=>JSON.parse(e)));n[r]=i}else n[r]=t[r];else"object"==typeof e[r]?n[r]=xA(e[r],t[r],i):n[r]=t[r];else n[r]=t[r];else n[r]=e[r];return n}),{})}function LA({participants:e=[],tournamentRecord:t,arraysToMerge:i}){if(!t)return{error:We};t.participants||(t.participants=[]);let n=e.filter($d(Ma)).map((e=>({[e.participantId]:e}))),r=Object.assign({},...n),a=[];t.participants=t.participants.map((e=>{if(r[e.participantId]){let t=xA(e,r[e.participantId],i);return a.push(t),t}return e}));let o=t.participants.map($d(Ma))||[],s=e.filter((({participantId:e})=>!o.includes(e))),{topics:l}=sa();return s.length&&(t.participants=t.participants.concat(...s),l.includes(Wu)&&ia({topic:Wu,payload:{participants:s}})),a.length&&l.includes(nd)&&ia({topic:nd,payload:{tournamentId:t.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...Be}}function _A(e){var t;let i,{tournamentRecord:n,participantIds:r}=e,a=e.tournamentRecords??(n&&{[n.tournamentId]:n})??{};for(let o of Object.values(a)){let n=null==(t=vh({tournamentRecord:o}).participants??[])?void 0:t.map(sl).filter((e=>r.includes(e)));n.length&&(i=BA({...e,penaltyId:e.penaltyId??i,tournamentRecord:o,participantIds:n}).penaltyId)}return i?{...Be,penaltyId:i}:{error:Bi}}function BA({refereeParticipantId:e,tournamentRecord:t,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:u}){if(!t)return{error:We};if(!i)return{error:_i};if(!r)return{error:an};let d=((null==t?void 0:t.participants)??[]).filter((e=>i.includes(e.participantId)));if(!d.length)return{error:Bi};let c=(new Date).toISOString(),p=Object.assign(OA({penaltyId:o}),{refereeParticipantId:e,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:c,issuedAt:l,notes:u});return Array.isArray(a)&&a.forEach((e=>fs({element:p,extension:e}))),d.forEach((e=>{e.penalties||(e.penalties=[]),e.penalties.push(p)})),ia({topic:nd,payload:{tournamentId:t.tournamentId,participants:d}}),{...Be,penaltyId:p.penaltyId}}function jA({participantRole:e=Ah,tournamentRecord:t,persons:i}){var n;if(!t)return{error:We};if(!Array.isArray(i))return{error:Fn};if(!Object.keys(xh).includes(e))return{error:Oi};let r=(t.participants||[]).map((({person:e})=>null==e?void 0:e.personId)).filter(Boolean),a=[],o=i.filter((e=>e&&(!e.personId||!r.includes(e.personId)))).map((e=>(e.personId||(e.personId=am()),a.push(e.personId),e))),s=(e,t)=>Object.assign({},...Object.keys(e).filter((e=>!t.includes(e))).map((t=>({[t]:e[t]})))),l=0,u=0,d=Rb({participants:o.map((t=>ya({extensions:t.participantExtensions,timeItems:t.participantTimeItems,participantType:Qd,participantRole:e,person:s(t,["participantExtensions","participantTimeItems","pairedPersons"])}))),tournamentRecord:t});if(d.error)return d;u=d.addedCount||0;let c=[],p=(null==(n=vh({participantFilters:{participantTypes:[Qd]},tournamentRecord:t}))?void 0:n.participants)??[];if(e===Ah&&i.filter((({pairedPersons:e})=>e)).forEach((({personId:e,pairedPersons:t})=>{Array.isArray(t)&&t.forEach((t=>{let i=[e,t.personId].map((e=>us({tournamentParticipants:p,personId:e}))).filter(Boolean);if(2===i.length){let e=i.map(sl);c.push(ya({extensions:t.participantExtensions,timeItems:t.timeItems,participantRole:Ah,individualParticipantIds:e,participantType:Xd}))}}))})),c.length){if(d=Rb({participants:c,tournamentRecord:t}),d.error)return d;l=d.addedCount||0}let m=u+l;return{...Be,addedCount:m,newPersonIds:a}}var VA={};be(VA,{bulkUpdatePublishedEventIds:()=>nD,getAllEventData:()=>lD,getCourtInfo:()=>pm,getDrawData:()=>dD,getEventData:()=>cD,getEventPublishStatus:()=>lh,getPublishState:()=>dh,getVenueData:()=>mm,mutate:()=>GA,publishEvent:()=>Fb,publishEventSeeding:()=>$A,publishOrderOfPlay:()=>zA,query:()=>iD,setEventDisplay:()=>oM,unPublishEvent:()=>KA,unPublishEventSeeding:()=>qA,unPublishOrderOfPlay:()=>WA});var GA={};function $A({removePriorValues:e=!0,stageSeedingScaleNames:t,seedingScaleNames:i,tournamentRecord:n,status:r=gp,drawIds:a=[],event:o}){var s,l,u,d;if(!n)return{error:We};if(!o)return{error:Et};let c=lh({event:o,status:r}),p=((null==(s=null==c?void 0:c.seeding)?void 0:s.seedingScaleNames)||i)&&{...null==(l=null==c?void 0:c.seeding)?void 0:l.seedingScaleNames,...i};return kb({statusObject:{seeding:ya({stageSeedingScaleNames:((null==(u=null==c?void 0:c.seeding)?void 0:u.stageSeedingScaleNames)||t)&&{...null==(d=null==c?void 0:c.seeding)?void 0:d.stageSeedingScaleNames,...t},seedingScaleNames:p,published:!0,drawIds:a})},removePriorValues:e,status:r,event:o}),ia({topic:dd,payload:{tournamentId:n.tournamentId,eventId:o.eventId,drawIds:a}}),{...Be}}function qA({removePriorValues:e=!0,seedingScaleNames:t,tournamentRecord:i,status:n=gp,drawIds:r,stages:a,event:o}){var s,l;if(!i)return{error:We};if(!o)return{error:Et};let u=lh({event:o});if(u){let i=u.seeding;if(Array.isArray(a)&&i.stageSeedingScaleNames)for(let e of a)i.stageSeedingScaleNames[e]&&delete i.stageSeedingScaleNames[e];Array.isArray(t)&&null!=i&&i.seedingScaleNames&&(i.seedingScaleNames=i.seedingScaleNames.filter((e=>!t.includes(e)))),Array.isArray(r)&&null!=i&&i.drawIds&&(i.drawIds=i.drawIds.filter((e=>!r.includes(e)))),(Object.values(i.stageSeedingScaleNames??{}).length||null!=(s=i.seedingScaleNames)&&s.length||null!=(l=i.drawIds)&&l.length)&&(a||t||null!=r&&r.length)||(delete i.stageSeedingScaleNames,delete i.seedingScaleNames,delete i.drawIds,i.published=!1),kb({statusObject:{seeding:i},removePriorValues:e,status:n,event:o})}return ia({topic:md,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...Be}}function WA(e){let t=(null==e?void 0:e.tournamentRecords)??((null==e?void 0:e.tournamentRecord)&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{};if(!Object.keys(t).length)return{error:qe};for(let i of Object.values(t)){let t=HA({tournamentRecord:i,...e});if(t.error)return t}return{...Be}}function HA({removePriorValues:e=!0,tournamentRecord:t,status:i=gp}){if(!t)return{error:We};let n=`${vp}.${Ip}`,{timeItem:r}=vf({element:t,itemType:n}),a=(null==r?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,yg({timeItem:{itemValue:a,itemType:n},element:t,removePriorValues:e}),ia({topic:fd,payload:{tournamentId:t.tournamentId}}),{...Be}}function zA(e){let t=Ld(e);if(!Object.keys(t).length)return{error:qe};for(let i of Object.values(t)){let t=YA({tournamentRecord:i,...e});if(t.error)return t}return{...Be}}function YA({scheduledDates:e=[],removePriorValues:t,tournamentRecord:i,status:n=gp,eventIds:r=[]}){if(!i)return{error:We};let a=`${vp}.${Ip}`,{timeItem:o}=vf({element:i,itemType:a}),s=(null==o?void 0:o.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:e,eventIds:r},yg({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:t}),ia({topic:cd,payload:{tournamentId:i.tournamentId,scheduledDates:e,eventIds:r}}),{...Be}}function KA({removePriorValues:e=!0,tournamentRecord:t,status:i=gp,event:n}){if(!t)return{error:We};if(!n)return{error:Et};let r=`${vp}.${Ip}`,{timeItem:a}=If({itemType:r,event:n}),o=(null==a?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,Tg({event:n,timeItem:{itemValue:o,itemType:r},removePriorValues:e}),kb({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:e,status:i,event:n}),ia({topic:pd,payload:{tournamentId:t.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...Be}}be(GA,{publishEvent:()=>Fb,publishEventSeeding:()=>$A,publishOrderOfPlay:()=>zA,setEventDisplay:()=>oM,unPublishEvent:()=>KA,unPublishEventSeeding:()=>qA,unPublishOrderOfPlay:()=>WA});var JA={};function QA({withCompetitiveProfiles:e,opponentParticipantId:t,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,u,d,c,p;if(!r)return{error:We};if(s&&!Array.isArray(s))return{error:ii};if(null==(s=s??Rf({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps)||!s.length)return{error:ei};let m=[];t&&m.push(t),n&&m.push(n);let f=vh({participantFilters:m.length?{participantIds:m}:{participantTypes:[Jd]},tournamentRecord:r}).participants??[];if(!f.every((({participantType:e})=>e===Jd)))return{error:Ci};m.length||m.push(...f.map(sl));let h=new Map,v=new Map,g=new Map,I=new Map,U=(e,t="")=>v.get(e)||v.set(e,{participantName:t,participantId:e,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(e);for(let M of f){let{participantId:e,individualParticipantIds:t}=M;I.set(e,t??[]),U(e,M.participantName)}if(n&&!I.get(n))return Sa({result:{error:Bi},context:{teamParticipantId:n}});if(t&&!I.get(t))return Sa({result:{error:Bi},context:{opponentParticipantId:t}});let y=[],S=e=>{let r=[[],[]];for(let t of e){let e=t.participant;if(null!=e&&e.participantName){h.set(e.participantId,{participantName:e.participantName,ratings:e.ratings});let t=v.get(e.participantId);t&&(t.participantName=e.participantName)}}let a=({side:e,individualParticipantIds:t})=>{var i,n,r,a,o;return e.participantId&&(!(null!=t&&t.length)||t.includes(e.participantId))&&[e.participantId]||(null==(n=null==(i=e.participant)?void 0:i.individualParticipantIds)?void 0:n.length)&&(!(null!=t&&t.length)||Nr(t,null==(r=e.participant)?void 0:r.individualParticipantIds).length===(null==(o=null==(a=e.participant)?void 0:a.individualParticipantIds)?void 0:o.length))&&e.participant.individualParticipantIds};if(I.size){let o=(t,n)=>{for(let o of e){if(!o.participant)continue;let e=a({individualParticipantIds:n,side:o});if(null!=e&&e.length){let n=o.sideNumber;if(!n)continue;let a=[t];i&&a.push(...e),r[n-1]=a;let s=v.get(t);for(let t of e.filter(Boolean))s&&!s.competitorIds.includes(t)&&s.competitorIds.push(t)}}};if(n)(!t||e.every((e=>e.participant&&(a({individualParticipantIds:I.get(n),side:e})||a({individualParticipantIds:I.get(t),side:e})))))&&o(n,I.get(n));else for(let[e,t]of I)o(e,t)}else if(i)for(let t of e){if(!t.participant)continue;let e=a({individualParticipantIds:[],side:t}),i=t.sideNumber;i&&(r[i-1]=e)}return r};for(let M of s){if(!Ce(M))return{error:ii};let{matchUpStatus:t,matchUpFormat:i,matchUpType:n,winningSide:r,score:a,sides:s}=M;if(!s||!a||n===Od||t===ml)continue;let u=S(s);if(!u.filter(Boolean).length)continue;let d=e&&r&&(null==(l=qc({matchUp:M}))?void 0:l.competitiveness);y.push(M);let c=uI({matchUpStatus:t,matchUpFormat:i,tallyPolicy:o,winningSide:r,score:a}),p=dI({matchUpStatus:t,matchUpFormat:i,tallyPolicy:o,winningSide:r,score:a}),{pointsTally:m,tiebreaksTally:f}=cI({matchUpFormat:i,score:a});u.forEach(((e,i)=>{var n;for(let a of e){let e=null==(n=h.get(a))?void 0:n.participantName,o=U(a,e);if(o){let e=(e,t)=>t.forEach(((t,i)=>o[e][i]+=t)),n=i?[...f].reverse():f,a=i?[...m].reverse():m,s=i?[...p].reverse():p,l=i?[...c].reverse():c;if(e("tiebreaks",n),e("points",a),e("games",s),e("sets",l),r){let e=r-1===i?0:1;o.matchUps[e]+=1}if(d){let e=d.toLowerCase();o.competitiveness[e]||(o.competitiveness[e]=[0,0]),o.competitiveness[e][i]+=1}if(t){let e=t.toLowerCase();o.matchUpStatuses[e]||(o.matchUpStatuses[e]=0),o.matchUpStatuses[e]+=1}}}}))}let w=["tiebreaks","matchUps","points","games","sets"],T=["competitive","routine","decisive"],P=new Map,D=(e,t)=>(e??0)+(t??0);for(let[M,N]of v.entries()){for(let e of w){let t=N[e].reduce(D);if(t){let i=N[e][0]/t,n=`${e}Ratio`,r=parseFloat(i.toFixed(2));N[n]=r,g.set(M,!0),P.has(n)||P.set(n,[]),null==(u=P.get(n))||u.push(r)}}for(let e of T){let t=null==(c=null==(d=N.competitiveness)?void 0:d[e])?void 0:c.reduce(D);if(t){let i=N.competitiveness[e][0]/t,n=`${e}Ratio`,r=parseFloat(i.toFixed(2));N[n]=r}}}if(!n){let e=(e,t)=>t-e;for(let t of v.values())for(let i of w){let n=`${i}Ratio`;if("number"==typeof t[n]){let r=null==(p=P.get(n))?void 0:p.sort(e).indexOf(t[n]);if("number"==typeof r&&r>=0){t[`${i}Rank`]=r+1}}}}let b={relevantMatchUps:y,...Be};return n?(b.teamStats=v.get(n),t&&(b.opponentStats=v.get(t))):b.participatingTeamsCount=g.size,b.allParticipantStats=[...v.values()],b}function ZA({participant:e,eventType:t}){var i,n,r,a,o,s;let l=null==(i=null==e?void 0:e.person)?void 0:i.personId,u=null==(r=null==(n=null==e?void 0:e.person)?void 0:n.personOtherIds)?void 0:r[0],d=null==(a=null==e?void 0:e.person)?void 0:a.tennisId,c=null==(s=null==(o=null==e?void 0:e.ratings)?void 0:o[t])?void 0:s.find((({scaleName:e})=>e===uS)),p=null==c?void 0:c.scaleValue,{wtnRating:m,confidence:f}=p||{};return{timeStamp:null==c?void 0:c.scaleDate,personOtherId:u,confidence:f,wtnRating:m,personId:l,tennisId:d}}function XA({tournamentRecord:e}){if(!e)return{error:We};let t=e.tournamentId,{participantMap:i}=vh({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:e,withDraws:!0}),n=(Rf({matchUpFilters:{matchUpTypes:[Rd,Ed]},tournamentRecord:e}).matchUps??[]).flatMap((({sides:e,matchUpType:t})=>null==e?void 0:e.flatMap((e=>{var i,n;return t===Ed?null==(i=null==e?void 0:e.participant)?void 0:i.individualParticipantIds:(null==(n=null==e?void 0:e.participant)?void 0:n.participantId)||e.participantId})).filter(Boolean))).filter(Boolean),r=[],a={},o={},s={},l=0,u=({id:e,entry:n,eventId:o,eventType:s})=>{var l;let{qualifyingSeeding:u,mainSeeding:d,entryStatus:c,entryStage:p,drawId:m}=n;a[e]||(a[e]=[]);let{participant:f,events:h}=(null==i?void 0:i[e])??{},v=ZA({participant:f,eventType:s}),g=null==(l=null==h?void 0:h[o])?void 0:l.ranking;c===XU&&r.push(e),a[e].push({participantType:null==f?void 0:f.participantType,participantId:e,tournamentId:t,eventType:s,eventId:o,drawId:m,entryStatus:c,entryStage:p,...v,ranking:g,mainSeeding:d,qualifyingSeeding:u})};for(let m of e.events??[]){let e={},r=t=>{e[t]||(e[t]={count:0}),e[t].count+=1},{drawDefinitions:a=[],eventType:d,eventId:c}=m,p=a.flatMap((e=>{let{drawId:t,entries:n}=e;l+=1;let a=(e.structures??[]).filter((({stage:e,stageSequence:t})=>e===xl&&1===t||e===Ll)).flatMap((({positionAssignments:e})=>e)).filter(Boolean).map((({participantId:e})=>e));return null==n?void 0:n.filter((({participantId:e})=>a.includes(e))).map((e=>{var n,a,o,s,l,u,d,c;let{participantId:p,entryStatus:m,entryStage:f}=e;r(m);let h=null==(s=null==(o=null==(a=null==(n=null==i?void 0:i[p])?void 0:n.draws)?void 0:a[t])?void 0:o.seedAssignments)?void 0:s[xl];return{qualifyingSeeding:null==(c=null==(d=null==(u=null==(l=null==i?void 0:i[p])?void 0:l.draws)?void 0:u[t])?void 0:d.seedAssignments)?void 0:c[Ll],participantId:p,mainSeeding:h,entryStatus:m,entryStage:f,drawId:t}}))})),f=e=>{var t;let r=e.participantId,a=null==(t=null==i?void 0:i[r].participant.individualParticipantIds)?void 0:t.filter((e=>n.includes(e)));return r&&{[r]:{individualParticipantIds:a}}};d===Gp?(()=>{let e=Object.assign({},...p.map(f).filter(Boolean));p.forEach((t=>{e[t.participantId].individualParticipantIds.forEach((e=>{u({id:e,eventType:d,eventId:c,entry:t})}))}))})():p.forEach((e=>{u({id:null==e?void 0:e.participantId,eventType:d,eventId:c,entry:e})}));let h=Object.values(e).reduce(((e,t)=>e+t.count),0);Object.keys(e).forEach((t=>{e[t].pct=e[t].count/h*100})),s[c]={tournamentId:t,eventId:c,entries:p,entryStatuses:e};let v=Object.assign({},...wc.flatMap((t=>{var i,n;return[{[t+"_count"]:null==(i=e[t])?void 0:i.count},{[t+"_pct"]:null==(n=e[t])?void 0:n.pct}]})));o[c]={tournamentId:t,eventId:c,...v}}let d=Object.values(i??{}).filter((({participant:{participantType:e,participantRole:t}})=>e===Qd&&t===Ah)),c=d.filter((({participant:e})=>!n.includes(e.participantId))).map((({participant:e})=>e.participantId)),p={nonParticipatingEntriesCount:c.length,individualParticipantsCount:d.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:c,drawDefinitionsCount:l,tournamentId:t};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function eE({eventType:e,matchUps:t,eventId:i,drawId:n}){let r={},a=t.filter((e=>i?e.eventId===i:e.drawId===n)).reduce(((e,t)=>((e=>{let t=null==e?void 0:e.matchUpFormat;t&&(r[t]||(r[t]=0),r[t]+=1)})(t),(t.sides??[]).flatMap((e=>{var t;return((null==(t=null==e?void 0:e.participant)?void 0:t.individualParticipants)||[null==e?void 0:e.participant]).filter(Boolean)})).forEach((t=>e[t.participantId]=t)),e)),{}),o=Object.values(a),s=o.map((t=>ZA({participant:t,eventType:e}))).filter((({wtnRating:e})=>e)),l=(o.length-s.length)/o.length*100,u=s.reduce(((e,t)=>{let{wtnRating:i,confidence:n}=t;return e.totalWTN+=i,e.totalConfidence+=n,e}),{totalWTN:0,totalConfidence:0}),d=null!=s&&s.length?u.totalWTN/s.length:0,c=null!=s&&s.length?u.totalConfidence/s.length:0,p=Object.values(r).reduce(((e,t)=>e+(t||0)),0);return{matchUpFormatCounts:r,matchUpsCount:p,avgConfidence:c,pctNoRating:l,avgWTN:d}}function tE({firstFlightOnly:e=!0,extensionProfiles:t,tournamentRecord:i}){var n;if(!i)return{error:ze};let r={},a=Object.assign({},...(t??[]).map((({name:e,label:t,accessor:n})=>{var r,a,o;let s=null==(a=null==(r=Ds({element:i,name:e}))?void 0:r.extension)?void 0:a.value;return{[t||e]:n?null==(o=Vd({element:s,accessor:n}))?void 0:o.value:s}}))),o=null==i?void 0:i.tournamentId,s=Rf({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],l=e=>{var t,i,n;return null==(n=null==(i=null==(t=vf({itemType:Hu,itemSubTypes:[lo],element:{timeItems:e}}))?void 0:t.timeItem)?void 0:i.itemValue)?void 0:n.scaleBasis},u=null==(n=null==i?void 0:i.events)?void 0:n.flatMap((({timeItems:t,drawDefinitions:i=[],extensions:n,eventType:u,eventId:d,category:c})=>{var p,m,f,h,v;let g=null==(f=null==(m=null==(p=null==n?void 0:n.find((e=>e.name===Fs)))?void 0:p.value)?void 0:m.flights)?void 0:f.map((e=>({[e.drawId]:e.flightNumber}))),I=g&&Object.assign({},...g),U=(null==(v=null==(h=null==n?void 0:n.find((e=>e.name===Os)))?void 0:h.value)?void 0:v.length)||0,y=Object.values(I),S=I&&Math.min(...y),w=l(t);return r[d]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:U,seedingBasis:w?JSON.stringify(w):void 0,tournamentId:o,eventId:d},i.filter((t=>!e||!g||I[t.drawId]===S)).flatMap((e=>{let{matchUpFormat:t,tieFormat:i,timeItems:n,extensions:p,structures:m,drawType:f,drawId:h}=e,{matchUpFormatCounts:v,matchUpsCount:g,avgConfidence:U,pctNoRating:y,avgWTN:S}=eE({eventType:u,matchUps:s,drawId:h}),T=l(n)||w,P=function({extensions:e}){var t,i;return null==(i=null==(t=null==e?void 0:e.find((({name:e})=>e===Ms)))?void 0:t.value)?void 0:i.slice(1)}({extensions:p}),D=(null==P?void 0:P.length)||0;return r[d].totalPositionManipulations+=D,r[d].generatedDrawsCount+=1,D>r[d].maxPositionManipulations&&(r[d].maxPositionManipulations=D),null==m?void 0:m.filter((e=>1===e.stageSequence&&[Ll,xl,_l,jl].includes(e.stage))).map((e=>{var n,r,l;let p=[xl,jl].includes(e.stage)?s.find((t=>t.structureId===e.structureId&&1===t.finishingRound&&t.winningSide)):void 0,m=null==(r=null==(n=null==p?void 0:p.sides)?void 0:n.find((e=>e.sideNumber===p.winningSide)))?void 0:r.participant,w=(null==m?void 0:m.participantType)===Jd&&m.participantId,D=(null==m?void 0:m.participantType)===Xd?m.individualParticipants:[],b=ZA({participant:(null==D?void 0:D[0])||m,eventType:u}),{personId:M,personOtherId:N,tennisId:R,confidence:A,wtnRating:E}=b||{},C=ZA({participant:null==D?void 0:D[1],eventType:u}),{personId:O,personOtherId:k,tennisId:F,confidence:x,wtnRating:L}=C||{},{ageCategoryCode:_,categoryName:B,subType:j}=c??{},V=e.matchUpFormat||t,G=(v[V]||0)/g*100,{tieFormatName:$,tieFormatDesc:q}=JP(i),{tieFormatName:W,tieFormatDesc:H}=JP(e.tieFormat),z=q===H,Y=!z&&W,K=e.tieFormat&&!z&&H,J=(null==(l=null==P?void 0:P.filter((t=>t.structureId===e.structureId)))?void 0:l.length)||0;return{...a,tournamentId:o,eventId:d,structureId:e.structureId,drawId:h,eventType:u,category:j,categoryName:B,ageCategoryCode:_,flightNumber:I[h],drawType:f,stage:e.stage,seedingBasis:T?JSON.stringify(T):void 0,winningPersonId:M,winningPersonOtherId:N,winningPersonTennisId:R,winningPersonWTNrating:E,winningPersonWTNconfidence:A,winningPerson2Id:O,winningPerson2OtherId:k,winningPerson2TennisId:F,winningPerson2WTNrating:L,winningPerson2WTNconfidence:x,winningTeamId:w,positionManipulations:J,pctNoRating:y,matchUpFormat:V,pctInitialMatchUpFormat:G,matchUpsCount:g,drawTieFormatName:$,drawTieFormatDesc:q,tieFormatName:Y,tieFormatDesc:K,avgConfidence:U,avgWTN:S}}))}))}));return{eventStructureReports:Object.values(r),structureReports:u}}function iE({ignoreDisabled:e=!0,tournamentRecords:t,tournamentId:i,venueIds:n=[],dates:r=[]}){var a,o;if(!Array.isArray(r))return{error:Fn,dates:r};if(!Array.isArray(n))return{error:Fn,venueIds:n};if(!(t&&Object.keys(t).filter((e=>!i||e===i))||[]).length)return{error:qe};if(!r.every(yo))return{error:Ui};let s=oD({tournamentRecords:t,ignoreDisabled:e,dates:r});if(s.error)return s;let l=null==(a=null==s?void 0:s.venues)?void 0:a.filter((({venueId:e})=>!(null!=n&&n.length)||n.includes(e))),u=null==(o=s.courts)?void 0:o.reduce(((e,t)=>{var i;return null==(i=t.dateAvailability)||i.forEach((t=>{let i=t.date;e.includes(i)||e.push(i)})),e}),[]).filter((e=>!r.length||r.includes(e))),d={venueIds:null==l?void 0:l.map((({venueId:e})=>e))},{matchUps:c}=Af({afterRecoveryTimes:!0,tournamentRecords:t,matchUpFilters:d});return{venuesReport:null==l?void 0:l.map((e=>function(e,t,i){let{venueId:n,courts:r,venueName:a}=t,o={};return e.forEach((e=>{var t;let a=0,s=0,l=0;for(let i of r){let n=i.dateAvailability.find((t=>t.date===e)),r=null==(t=n&&DM({courtDate:n}).timeSlots)?void 0:t.reduce(((e,t)=>{let{startTime:i,endTime:n}=t;return e+(Ro(n)-Ro(i))}),0);r&&(l+=1),a+=r}let u=i.filter((({schedule:t})=>t.venueId===n&&$o(e,t.scheduledDate)));u.forEach((({schedule:e})=>{let t=Eo(e.scheduledTime),i=Ro(jo(t,e.averageMinutes))-Ro(t);s+=i}));let d=a?(s/a*100).toFixed(2):"100";o[e]={scheduledMatchUpsCount:u.length,availableCourts:l,availableMinutes:a,scheduledMinutes:s,percentUtilization:d}})),{venueId:n,venueName:a,venueReport:o}}(u,e,c)))}}be(JA,{getEntryStatusReports:()=>XA,getParticipantStats:()=>QA,getStructureReports:()=>tE,getVenuesReport:()=>iE});var nE={};be(nE,{addMatchUpCourtOrder:()=>wN,addMatchUpEndTime:()=>DN,addMatchUpOfficial:()=>TN,addMatchUpResumeTime:()=>MN,addMatchUpScheduleItems:()=>yN,addMatchUpScheduledDate:()=>SN,addMatchUpScheduledTime:()=>fN,addMatchUpStartTime:()=>PN,addMatchUpStopTime:()=>bN,addSchedulingProfileRound:()=>JR,allocateTeamMatchUpCourts:()=>vN,assignMatchUpCourt:()=>IN,assignMatchUpVenue:()=>gN,bulkRescheduleMatchUps:()=>pE,bulkScheduleMatchUps:()=>mR,bulkScheduleTournamentMatchUps:()=>pR,bulkUpdateCourtAssignments:()=>lE,calculateScheduleTimes:()=>aE,clearMatchUpSchedule:()=>hE,clearScheduledMatchUps:()=>vR,courtGridRows:()=>$D,findMatchUpFormatTiming:()=>mD,findVenue:()=>lm,generateBookings:()=>oR,generateVirtualCourts:()=>MM,getPersonRequests:()=>SD,getProfileRounds:()=>DD,getScheduledRoundsDetails:()=>fD,getSchedulingProfile:()=>gD,getSchedulingProfileIssues:()=>yD,matchUpScheduleChange:()=>fE,modifyMatchUpFormatTiming:()=>Gb,mutate:()=>rE,proAutoSchedule:()=>sE,proConflicts:()=>dE,publicFindCourt:()=>cm,query:()=>pD,removeEventMatchUpFormatTiming:()=>Hb,removeMatchUpCourtAssignment:()=>oE,reorderUpcomingMatchUps:()=>cE,scheduleMatchUps:()=>uE,scheduleProfileRounds:()=>IR,setMatchUpDailyLimits:()=>vE,setSchedulingProfile:()=>ID,toggleParticipantCheckInState:()=>VM,validateSchedulingProfile:()=>vD});var rE={};function aE({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:u,endTime:d}){if("object"!=typeof a||!Object.keys(a).length)return{error:qe};o=o??NM({recoveryMinutes:t,averageMatchUpMinutes:i});let{courts:c,venues:p}=oD({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=null==c?void 0:c.filter((e=>!u||u.includes(e.venueId)));l||(l=null==m?void 0:m.reduce(((e,t)=>{var i,n;let r=(null==(n=null==(i=t.dateAvailability)?void 0:i.find((e=>!e.date||$o(s,e.date))))?void 0:n.startTime)??t.startTime;return r&&(!e||Ro(r)<Ro(e))?r:e}),void 0)),d||(d=null==m?void 0:m.reduce(((e,t)=>{var i,n;let r=(null==(n=null==(i=t.dateAvailability)?void 0:i.find((e=>!e.date||$o(s,e.date))))?void 0:n.endTime)??t.endTime;return r&&(!e||Ro(r)>Ro(e))?r:e}),void 0));let f=Object.values(a),h=Object.assign({},...f.map((e=>(e.events??[]).map((t=>{let{scheduleTiming:i}=bp({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:i}}})))).flat()),v=zD({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),g=(null==v?void 0:v.dateMatchUps)??[],I=(null==v?void 0:v.completedMatchUps)??[],U=[];U.push(...g),U.push(...I);let y={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:t}}]},S=null==U?void 0:U.map((({eventId:e,schedule:t,matchUpFormat:i})=>{let{event:n,scheduleTiming:r}=h[e],a=null==n?void 0:n.eventType,s={...r,defaultTiming:y,matchUpFormat:i},{averageMinutes:l,recoveryMinutes:u}=zp({eventType:a,timingDetails:s}),{courtId:d,venueId:c}=t,p=Eo(t.scheduledTime),m=jo(p,l);return{recoveryMinutes:u,averageMinutes:l,periodLength:o,startTime:p,endTime:m,courtId:d,venueId:c}})),w={calculateStartTimeFromCourts:e,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:o,startTime:l,endTime:d,bookings:S,courts:m},{scheduleTimes:T}=EM(w);return{venueId:1===(null==u?void 0:u.length)&&u[0]||1===(null==p?void 0:p.length)&&p[0].venueId||void 0,scheduleTimes:T,dateScheduledMatchUpIds:U.map(ll)}}function oE(e){var t;let i=io(e,[{[wa]:!0}]);if(i.error)return i;let{removePriorValues:n,tournamentRecords:r,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:u}=e,d=r[a];if(!d)return{error:We};let{drawDefinition:c,event:p}=kU({tournamentRecord:d,drawId:u});if(!c)return{error:Ke};let m=OI({drawDefinition:c,event:p,matchUpId:s});if(m.error)return m;if((null==(t=null==m?void 0:m.matchUp)?void 0:t.matchUpType)===Od){let{itemValue:e}=Kp({timeItems:m.matchUp.timeItems??[],itemType:Kc}),t=l&&e.filter((e=>e.courtId!==l));return _M({duplicateValues:!1,removePriorValues:n,tournamentRecord:d,drawDefinition:c,matchUpId:s,timeItem:{itemType:Kc,itemValue:t}})}return IN({tournamentRecord:d,drawDefinition:c,courtDayDate:o,courtId:"",matchUpId:s})}function sE({scheduleCompletedMatchUps:e,tournamentRecords:t,scheduledDate:i,matchUps:n}){if(!Bd(n))return{error:Fn};if(n.some((({hasContext:e})=>!e)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Tn};let r=zD({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:t,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,o=[],s=e=>[(e.sides||[]).map((e=>{var t;return[e.participantId,null==(t=e.participant)?void 0:t.individualParticipantIds]})),(e.potentialParticipants||[]).flat().map((e=>[e.participantId,e.individualParticipantIds]))].flat(1/0).filter(Boolean),l=null==a?void 0:a.reduce(((e,t)=>{let i=[],n=[];Object.values(t).forEach((e=>{if(Ce(e)&&(e.matchUpId&&(i.push(e.matchUpId),o.push(e)),e.sides)){let t=s(e);n.push(...t)}}));let r=Object.values(t).filter((e=>Ce(e)&&!e.matchUpId));return e.concat({matchUpIds:i,availableCourts:r,rowId:t.rowId,participantIds:n})}),[]);n.filter((({matchUpStatus:t})=>t&&t!==ml&&(e||!Cl.includes(t)))).sort(Ef);let u=Of({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:t}).matchUpDependencies,d=[],c=[];for(;n.length&&l.length;){let e=l.shift(),t=[];for(;n.length&&e.availableCourts.length;){let i=n.concat(t).map((e=>e.matchUpId)),r=n.shift(),a=null==r?void 0:r.matchUpId,o=a&&u[a].matchUpIds.concat(u[a].dependentMatchUpIds),l=a&&i.some((e=>u[a].matchUpIds.includes(e))),p=a&&c.some((e=>u[a].dependentMatchUpIds.includes(e))),m=e.matchUpIds.some((e=>o.includes(e))),f=s(r),h=e.participantIds.some((e=>f.includes(e)));if(!r||m||l||h||p)r&&t.push(r);else{let t=e.availableCourts.shift();Object.assign(r.schedule,t.schedule),Object.assign(t,r),d.push(r),e.participantIds.push(...f),e.matchUpIds.push(a)}}n.push(...t),c.push(...e.matchUpIds)}return r=mR({tournamentRecords:t,matchUpDetails:d.map((({matchUpId:e,tournamentId:t,schedule:n,drawId:r})=>({tournamentId:t,matchUpId:e,drawId:r,schedule:{...n,scheduledDate:i}})))}),{...r,scheduled:d,notScheduled:n}}function lE(e){let{courtDayDate:t}=e,i=io(e,[{courtAssignments:!0,[Qa]:za,[Ja]:mi},{[wa]:!0}]);if(i.error)return i;let n,r=e.courtAssignments.reduce(((e,t)=>{let{tournamentId:i}=t;return e[i]||(e[i]=[]),e[i].push(t),e}),{});return Object.keys(r).every((i=>{let a=e[wa][i];if(!a)return n={error:We},!1;let o=r[i].reduce(((e,t)=>{let{drawId:i}=t;return e[i]||(e[i]=[]),e[i].push(t),e}),{});Object.keys(o).every((e=>{let{drawDefinition:i}=hm({tournamentRecord:a,drawId:e});return i?(o[e].every((e=>{let{matchUpId:r,courtId:o}=e,s=IN({tournamentRecord:a,drawDefinition:i,courtDayDate:t,matchUpId:r,courtId:o});if(s.success)return null==s?void 0:s.success;n={error:Nn}})),!0):(n={error:Ke},!1)}))})),n||Be}function uE(e){let{tournamentRecords:t,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:d=!0,remainingScheduleTimes:c,clearScheduleDates:p,periodLength:m=30,scheduleDate:f,matchUpIds:h,venueIds:v,startTime:g,endTime:I,dryRun:U}=e,y=io(e,[{[wa]:!0,[Ea]:!0},{[Ya]:yo,[Ja]:Ui,scheduleDate:!0},{[Ya]:e=>!e||!isNaN(e),averageMatchUpMinutes:!1,[Ja]:Fn,recoveryMinutes:!1,periodLength:!1}]);if(y.error)return y;let S=e.competitionMatchUps??Af({nextMatchUps:!0,tournamentRecords:t}).matchUps??[],w=e.matchUpDependencies??Of({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:t}).matchUpDependencies;S.forEach((e=>{var t;null!=(t=e.schedule)&&t.scheduledDate&&$o(f,Co(e.schedule.scheduledDate))&&JN({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:e})}));let T=h.map((e=>S.find((t=>t.matchUpId===e)))).filter(Boolean),{venueId:P,scheduleTimes:D,dateScheduledMatchUpIds:b}=aE({tournamentRecords:t,remainingScheduleTimes:c,startTime:Eo(g),endTime:Eo(I),scheduleDate:Co(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:m,venueIds:v}),M={},N=[],R={},A={},E={};S.filter((({matchUpId:e})=>null==b?void 0:b.includes(e))).forEach((e=>{var t;nR({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:e,value:1});let i=null==(t=e.schedule)?void 0:t.scheduledTime;if(i){R[e.matchUpId]=i,ZN({recoveryMinutes:(null==a?void 0:a[e.matchUpId])||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:i,matchUp:e})}}));let C=T.filter((e=>{let t=null==b?void 0:b.includes(e.matchUpId),i=[ml,gl,hl,cl,Tl,bl].includes(null==e?void 0:e.matchUpStatus);return!t&&!e.winningSide&&!i})),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:F}=C.reduce(((e,t)=>{let{drawId:i,tournamentId:n,matchUpType:r}=t,{participantIdsAtLimit:a,relevantParticipantIds:d}=cR({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:t});return null!=a&&a.length?(e.overLimitMatchUpIds.push(t.matchUpId),e.participantIdsAtLimit.push(...a),e):(d.forEach((e=>{QN({individualParticipantProfiles:s,participantId:e});let t=s[e].counters;t[r]?t[r]+=1:t[r]=1,t[Rp]?t[Rp]+=1:t[Rp]=1})),e.matchUpMap[n]||(e.matchUpMap[n]={}),e.matchUpMap[n][i]?e.matchUpMap[n][i].push(t):e.matchUpMap[n][i]=[t],JN({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:t}),e)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter((({matchUpId:e})=>!k.includes(e)));let x=0,L=(null==D?void 0:D.length)??0,{personRequests:_}=SD({tournamentRecords:t,requestType:eR});for(;null!=D&&D.length&&C.length&&x<=L;){x++;let{scheduleTime:e}=D.shift(),t=C.find((t=>{let{matchUpId:u}=t,{dependenciesScheduled:c,remainingDependencies:p}=KN({matchUpScheduleTimes:R,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:t});if(!c)return E[u]||(E[u]=[]),E[u].push({scheduleTime:e,remainingDependencies:p}),!1;let{enoughTime:m}=dR({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:e,matchUp:t});if(!m)return A[u]||(A[u]=[]),A[u].push({scheduleTime:e}),!1;let{conflicts:h}=iR({potentials:d,averageMatchUpMinutes:n,requestConflicts:M,personRequests:_,scheduleTime:e,scheduleDate:f,matchUp:t});return(null==h||!h.length)&&(ZN({recoveryMinutes:(null==a?void 0:a[t.matchUpId])||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:e,matchUp:t}),R[t.matchUpId]=e,!0)}));C=C.filter((({matchUpId:e})=>e!==(null==t?void 0:t.matchUpId))),t||N.push(e)}C.forEach((e=>{nR({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:e})}));let B=[];Object.keys(O).forEach((e=>{let i=t[e];i&&Object.keys(O[e]).forEach((n=>{let{drawDefinition:r}=kU({tournamentRecord:i,drawId:n});r&&O[e][n].forEach((({matchUpId:e})=>{let n=R[e];if(n){let a=n.split(":").map(Go).join(":"),o=`${Co(f)}T${a}`;U?B.push(e):(fN({drawDefinition:r,matchUpId:e,scheduledTime:o}).success&&B.push(e),P&&gN({tournamentRecords:t,tournamentRecord:i,drawDefinition:r,matchUpId:e,venueId:P}))}}))}))}));let j=al(C);return{...Be,requestConflicts:Object.values(M),remainingScheduleTimes:null==D?void 0:D.map((({scheduleTime:e})=>e)),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:N,overLimitMatchUpIds:k,scheduledMatchUpIds:B,noTimeMatchUpIds:j,recoveryTimeDeferred:A,dependencyDeferred:E}}function dE({tournamentRecords:e,matchUps:t}){if(!Bd(t))return{error:ei};if(t.some((({matchUpId:e,hasContext:t})=>e&&!t)))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Tn};let i=br(1,Math.max(...t.map((({schedule:e})=>(null==e?void 0:e.courtOrder)||1)).map((e=>rr(e))))+1).map((e=>t.filter((t=>{var i;return rr(null==(i=t.schedule)?void 0:i.courtOrder)===e})))),n={},r={},a={};i.flat().filter(Boolean).sort(Ef).forEach((({schedule:e})=>delete e[Lp]));let o=Of({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:hr(t.map((({drawId:e})=>e)))}).matchUpDependencies,s=i.map(((e,t)=>e.reduce(((e,i)=>{if(!i.matchUpId)return e;let{matchUpId:s,winnerMatchUpId:l,loserMatchUpId:u,schedule:d,sides:c,potentialParticipants:p}=i,m=null==d?void 0:d.courtId;n[s]=t,r[m]=[],e.matchUpIds.push(s),a[s]=i;let f=o[s].matchUpIds;f.length&&e.sourceMatchUpIds.push(...f);let h=(null==c?void 0:c.map((e=>{var t;return[null==(t=e.participant)?void 0:t.individualParticipantIds,e.participantId]})).flat().filter(Boolean))??[],v=(null==p?void 0:p.flat().map((({individualParticipantIds:e,participantId:t})=>[e,t])).flat().filter(Boolean))||[];return e.participantIds.push(...v,...h),l&&e.targetMatchUpIds.push(l),u&&e.targetMatchUpIds.push(u),e}),{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]}))),l=s.map((()=>[])),u=(e,t,i,o)=>{if(!a[e].schedule[Lp]){a[e].schedule[Lp]=t,a[e].schedule[Cp]=o,l[n[e]].push({matchUpId:e,issueType:i,issueIds:o,issue:t});let s=a[e].schedule.courtId;r[s]||(r[s]=[]),r[s].push({matchUpId:e,issue:t,issueType:i,issueIds:o})}};return s.forEach(((e,t)=>{let i=t?s[t-1]:void 0,n=s.slice(t+1),r={},l=Ur(e.participantIds),d=Object.keys(l).filter((e=>l[e]>1)),c=e.matchUpIds.filter((e=>o[e].participantIds.some((e=>d.includes(e)))));c.forEach((e=>{r[e]||(r[e]={}),r[e][Op]||(r[e][Op]=c.filter((t=>t!==e)))}));let p=i&&e.participantIds.filter((e=>i.participantIds.includes(e)));p&&p.forEach((t=>{let n=e.matchUpIds.concat(i.matchUpIds).filter((e=>o[e].participantIds.includes(t)));n.forEach((e=>{r[e]||(r[e]={}),r[e][kp]||(r[e][kp]=n.filter((t=>t!==e)))}))})),e.matchUpIds.forEach((t=>{var s,l,d,c;let p=o[t].matchUpIds;for(let e of n){let i=e.matchUpIds.filter((e=>p.includes(e)));null!=i&&i.length&&(i.forEach((e=>u(e,Fp,Ep,[t]))),u(t,Fp,Ep,i))}if(null!=(s=r[t])&&s[Op]&&u(t,Op,Ap,r[t][Op]),e.sourceMatchUpIds.includes(t)){let i=e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t)));u(t,Op,Ep,i),e.matchUpIds.filter((e=>o[e].matchUpIds.includes(t))).forEach((e=>u(e,Op,Ep,[t])))}let m=null==(l=null==i?void 0:i.matchUpIds)?void 0:l.filter((e=>((e,t)=>o[e].sources.reduce(((e,i,n)=>i.includes(t)&&n+1||e),0))(t,e)>1));if(null!=m&&m.length&&(u(t,xp,Ep,m),m.forEach((e=>u(e,xp,Ep,[t])))),null!=(d=r[t])&&d[kp]&&u(t,kp,Ap,r[t][kp]),null==(c=null==i?void 0:i.targetMatchUpIds)?void 0:c.includes(t)){let e=a[t].schedule.courtId,n=p.filter((e=>i.matchUpIds.includes(e)));n.some((t=>a[t].schedule.courtId===e))||(n.forEach((e=>u(e,kp,Ep,[t]))),u(t,kp,Ep,n))}}))})),{courtIssues:r,rowIssues:l}}function cE(e){let t="reorderUpcomingMatchUps",{tournamentRecords:i}=e;if("object"!=typeof i||!Object.keys(i).length)return Sa({result:{error:qe},stack:t});let{matchUpsContextIds:n,firstToLast:r}=e;if(!n)return Sa({result:{error:mi},stack:t});let a=null==n?void 0:n.length;if(!a)return{...Be};let o=0;return n.forEach(((e,t)=>{let{tournamentId:s,drawId:l,matchUpId:u}=e,d=t+(r?-1:1);d<0&&(d=a-1),d===a&&(d=0);let c=function({tournamentId:e,scheduledTime:t,matchUpId:n,drawId:r}){let a=i[e],{drawDefinition:o}=kU({tournamentRecord:a,drawId:r});return o?fN({drawDefinition:o,scheduledTime:t,matchUpId:n}):{error:Qe}}({tournamentId:s,scheduledTime:n[d].schedule.scheduledTime,matchUpId:u,drawId:l});if(!c.success)return c;o++})),o===a?Be:Sa({result:{error:bn},stack:t})}function pE(e){var t,i;let{scheduleChange:n,matchUpIds:r,dryRun:a}=e;if(!r||!Array.isArray(r))return{error:Zt};if("object"!=typeof n)return{error:Fn};let o=Ld(e),s=[],l=[];for(let d of Object.values(o)){let e=mE({tournamentRecord:d,scheduleChange:n,matchUpIds:r,dryRun:a});if(e.error)return e;Array.isArray(e.notRescheduled)&&l.push(...e.notRescheduled);let o=al(e.notRescheduled),u=[];null==(t=e.rescheduled)||t.forEach((e=>{let{matchUpId:t}=e;o.includes(t)&&u.push(t),s.push(e)})),u.length&&(l=(null==(i=null==e?void 0:e.notRescheduled)?void 0:i.filter((({matchUpId:e})=>!u.includes(e))))||[])}let u=!(!s.length||l.length);return{...Be,rescheduled:s,notRescheduled:l,allRescheduled:u}}function mE({tournamentRecord:e,scheduleChange:t,matchUpIds:i,dryRun:n}){var r;if(!e)return{error:We};if(!i||!Array.isArray(i))return{error:Zt};if("object"!=typeof t)return{error:Fn};let a=[],o=[],{minutesChange:s,daysChange:l}=t;if(!s&&!l)return{...Be};if(s&&isNaN(s))return{error:Fn};if(l&&isNaN(l))return{error:Fn};let{matchUps:u}=Rf({matchUpFilters:{matchUpIds:i},tournamentRecord:e}),d=null==u?void 0:u.filter((e=>jD({schedule:e.schedule}))).filter((e=>(({matchUpStatus:e})=>!Cl.includes(e))({matchUpStatus:e.matchUpStatus})));if(null==d||!d.length)return{...Be};let{tournamentInfo:c}=qP({tournamentRecord:e}),{startDate:p,endDate:m}=c,f=null==d?void 0:d.reduce(((e,t)=>{let{matchUpId:i,drawId:n}=t;return e[n]?e[n].push(i):e[n]=[i],e}),{});for(let U of Object.keys(f)){let t=kU({tournamentRecord:e,drawId:U});if(t.error)return t;let u=t.drawDefinition,c=f[U].filter((e=>i.includes(e)));for(let e of c)if(e&&u){let t,i,c,f=null==(r=d.find((t=>t.matchUpId===e)))?void 0:r.schedule,{scheduledTime:h,scheduledDate:v}=f;if(!t&&l&&v){c=Oo(Co(v),l),t=new Date(c)<new Date(p)||new Date(c)>new Date(m)}if(s&&h){let e=Co(h),n=Ro(Eo(h))+s;if(t=n<0||n>1440,!t){let t=jo(h,s),n=e&&c||v===e&&e;i=n?`${n}T${t}`:t}}if(t)o.push(e);else{if(!n){if(i){let t=fN({scheduledTime:i,drawDefinition:u,matchUpId:e});if(t.error)return t}if(c){let t=SN({scheduledDate:c,drawDefinition:u,matchUpId:e});if(t.error)return t}}(i||c)&&a.push(e)}}}let h=Rf({matchUpFilters:{matchUpIds:i},tournamentRecord:e}).matchUps??[],v=h.filter((({matchUpId:e})=>a.includes(e))),g=h.filter((({matchUpId:e})=>o.includes(e))),I=v.length&&!g.length;return{...Be,rescheduled:v,notRescheduled:g,allRescheduled:I}}function fE(e){let t="matchUpScheduleChange",{tournamentRecords:i}=e;if("object"!=typeof i||!Object.keys(i).length)return{error:qe};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=e||{},{drawId:l,matchUpId:u,tournamentId:d}=n||{},{drawId:c,matchUpId:p,tournamentId:m}=r||{};if(!u&&!p)return Sa({result:{error:mi},stack:t});let{matchUps:f}=Af({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[l,c].filter(Boolean)},tournamentRecords:e.tournamentRecords}),h=null==f?void 0:f.find((({matchUpId:e})=>e===u)),v=null==f?void 0:f.find((({matchUpId:e})=>e===p)),g=0;if(o&&u&&!p){let e=I({tournamentId:d,matchUpId:u,courtId:o,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(null!=e&&e.success&&g++,e.error)return Sa({result:e,stack:t})}else{if(!(a&&o&&u&&p))return{error:mi};{let e=I({tournamentId:d,matchUpId:u,courtId:o,matchUp:h,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(e.success&&g++,e.error)return Sa({result:e,stack:t,info:"source"});let n=I({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:v,courtId:a,drawId:c,tournamentRecords:i,courtDayDate:s});if(n.success&&g++,n.error)return Sa({result:n,stack:t,info:"target"})}}return g?Be:Sa({result:{error:Mn},stack:t});function I(e){let{tournamentRecords:t,tournamentId:i,matchUp:n,drawId:r}=e,a=t[i],{drawDefinition:o}=kU({tournamentRecord:a,drawId:r});return n.matchUpType===kd?function({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,sourceCourtId:r,courtDayDate:a,matchUpId:o,matchUp:s,courtId:l}){let u=[l].concat(s.schedule.allocatedCourts.map((({courtId:e})=>e)).filter((e=>e!==r)));return vN({removePriorValues:e,tournamentRecords:t,tournamentRecord:i,drawDefinition:n,courtDayDate:a,matchUpId:o,courtIds:u})}({...e,tournamentRecord:a,drawDefinition:o}):IN({...e,tournamentRecord:a,drawDefinition:o})}}function hE({scheduleAttributes:e=[Kc,Jc,Yc,Zc,ep,tp,rp,np,ip],tournamentRecord:t,drawDefinition:i,matchUpId:n}){var r,a;let o=i?null==(r=Cf({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)?void 0:r[0]:null==(a=Rf({matchUpFilters:{matchUpIds:[n]},tournamentRecord:t,inContext:!1}).matchUps)?void 0:a[0];if(!o)return{error:Xt};let s=(o.timeItems??[]).filter((t=>(null==t?void 0:t.itemType)&&!e.includes(null==t?void 0:t.itemType)));return o.timeItems=s,yd({tournamentId:t.tournamentId,context:"clearMatchUpSchedule",drawDefinition:i,matchUp:o}),{...Be}}function vE(e){let{tournamentRecord:t,tournamentId:i,dailyLimits:n}=e,r=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if("object"!=typeof r||!Object.keys(r).length)return{error:qe};if("object"!=typeof n)return{error:Cn};let a=Object.keys(r).filter((e=>!i||i===e));if(i&&!a.includes(i))return{error:Fn};for(let o of a){let e=fs({element:r[o],extension:{name:$s,value:{dailyLimits:n}}});if(e.error)return e}return{...Be}}be(rE,{addMatchUpCourtOrder:()=>wN,addMatchUpEndTime:()=>DN,addMatchUpOfficial:()=>TN,addMatchUpResumeTime:()=>MN,addMatchUpScheduleItems:()=>yN,addMatchUpScheduledDate:()=>SN,addMatchUpScheduledTime:()=>fN,addMatchUpStartTime:()=>PN,addMatchUpStopTime:()=>bN,addSchedulingProfileRound:()=>JR,allocateTeamMatchUpCourts:()=>vN,assignMatchUpCourt:()=>IN,assignMatchUpVenue:()=>gN,bulkRescheduleMatchUps:()=>pE,bulkScheduleMatchUps:()=>mR,bulkScheduleTournamentMatchUps:()=>pR,bulkUpdateCourtAssignments:()=>lE,calculateScheduleTimes:()=>aE,clearMatchUpSchedule:()=>hE,clearScheduledMatchUps:()=>vR,courtGridRows:()=>$D,findMatchUpFormatTiming:()=>mD,findVenue:()=>lm,generateBookings:()=>oR,generateVirtualCourts:()=>MM,matchUpScheduleChange:()=>fE,modifyMatchUpFormatTiming:()=>Gb,proAutoSchedule:()=>sE,proConflicts:()=>dE,publicFindCourt:()=>cm,removeEventMatchUpFormatTiming:()=>Hb,removeMatchUpCourtAssignment:()=>oE,reorderUpcomingMatchUps:()=>cE,scheduleMatchUps:()=>uE,scheduleProfileRounds:()=>IR,setMatchUpDailyLimits:()=>vE,setSchedulingProfile:()=>ID,toggleParticipantCheckInState:()=>VM,validateSchedulingProfile:()=>vD});var gE={};be(gE,{addCollectionDefinition:()=>kE,addCollectionGroup:()=>OE,aggregateTieFormats:()=>_E,compareTieFormats:()=>QP,getTieFormat:()=>tD,modifyCollectionDefinition:()=>PE,modifyTieFormat:()=>LE,mutate:()=>IE,orderCollectionDefinitions:()=>NE,query:()=>KP,removeCollectionDefinition:()=>CE,removeCollectionGroup:()=>bE,tieFormatGenderValidityCheck:()=>qI,validateCollectionDefinition:()=>iU});var IE={};function UE({drawDefinition:e,structureId:t,matchUpId:i,structure:n,matchUp:r,eventId:a,event:o}){var s;let l,u="getTieFormat";if(t=(null==n?void 0:n.structureId)??t,((i=(null==r?void 0:r.matchUpId)??i)||t)&&!e)return{error:Ke};if(a&&o)l=gm(o);else if(i){if(e&&(!r||!n)){let t=OI({drawDefinition:e,matchUpId:i});if(t.error)return t;if((null==(s=t.matchUp)?void 0:s.matchUpType)!==Od)return Sa({result:{error:ii},stack:u});n||(n=t.structure),r||(r=t.matchUp)}l=Im({item:r,drawDefinition:e,structure:n,event:o})||Im({item:n,drawDefinition:e,structure:n,event:o})||gm(e)||gm(o)}else if(e&&t){if(!n){let i=_u({drawDefinition:e,structureId:t});if(i.error)return i;n=null==i?void 0:i.structure}l=Im({item:n,drawDefinition:e,structure:n,event:o})||gm(e)||gm(o)}else l=gm(e)||gm(o);return l?{...Be,structure:n,tieFormat:l,matchUp:r}:Sa({result:{error:Jt},stack:u})}function yE({matchUp:e,updateInProgressMatchUps:t}){return!e.winningSide&&![Cl].includes(e.matchUpStatus)&&(t||e.matchUpStatus!==yl&&!kf(e))}function SE({from:e,to:t}){let i=Object.keys(e),n=Nr(i,Object.keys(t)).length===i.length,r=i.filter((i=>e[i]!==t[i])).map((i=>({countChange:t[i]-e[i],collectionId:i}))),a=i.every((i=>e[i]===t[i]));return{equivalent:n&&a,matchUpsCountChanges:r}}function wE({check:e,matchUp:t}){let i="",n=[];return{changesArePossible:e.matchUpsCountChanges.every((({collectionId:e,countChange:r})=>{let a=t.tieMatchUps.filter((t=>t.collectionId===e&&t.matchUpStatus===Dl)).map($d("matchUpId")),o=a.length+r>=0||r>0;return!o&&r<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:a,collectionId:e,countChange:r}),o})),changes:n,cannotChangeReaon:i}}function TE({drawDefinition:e,auditData:t}){let{extension:i}=Ds({name:Ys,element:e});fs({element:e,extension:{name:Ys,value:Array.isArray(null==i?void 0:i.value)?null==i?void 0:i.value.concat(t):[t]}})}function PE({updateInProgressMatchUps:e=!1,tournamentRecord:t,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:u,structureId:d,matchUpId:c,category:p,eventId:m,gender:f,event:h,collectionValueProfiles:v,collectionValue:g,matchUpValue:I,scoreValue:U,setValue:y}){var S;let w="modifyCollectionDefinition";if(o&&!JI({matchUpFormat:o}))return Sa({result:{error:Fn},context:{matchUpFormat:o},stack:w});if(n&&"string"!=typeof n)return Sa({result:{error:Fn},context:{collectionName:n},stack:w});if(f&&!Object.values(Qm).includes(f))return Sa({result:{error:Fn},context:{gender:f},stack:w});if(p&&"object"!=typeof p)return Sa({result:{error:Fn},context:{category:p},stack:w});let T={collectionValueProfiles:v,collectionValue:g,matchUpValue:I,scoreValue:U,setValue:y};if(!(Object.values(T).filter(Boolean).length||i||n||o||s||u))return Sa({result:{error:mi},stack:w});if(Object.values(T).filter(Boolean).length>1)return Sa({info:"Only one value assignment allowed per collectionDefinition",result:{error:Fn},stack:w});let P=UE({drawDefinition:a,structureId:d,matchUpId:c,eventId:m,event:h});if(P.error)return Sa({result:P,stack:w});let{matchUp:D,structure:b,tieFormat:M}=P,N=oU(M),R=null==M?void 0:M.collectionDefinitions.find((e=>e.collectionId===l)),A=null==N?void 0:N.collectionDefinitions.find((e=>e.collectionId===l));if(!R)return Sa({info:"source collectionDefinition",result:{error:Vn},context:{collectionId:l},stack:w});let E=g??I??U??y;if(v){let e=VI({matchUpCount:s??(null==R?void 0:R.matchUpCount)??0,collectionValueProfiles:v});if(e.errors)return Sa({result:{error:Fn},info:e.errors,stack:w})}else if(E&&!mr(E))return Sa({result:{error:Fn},info:"value is not an integer",context:{value:E},stack:w});let C=v&&(!R.collectionValueProfiles||(k=R.collectionValueProfiles,F=v,!(Nr(Object.keys(k),Object.keys(F)).length===Object.keys(k).length&&Nr(Object.values(k),Object.values(F)).length===Object.values(k).length))),O=[];var k,F;if((mr(g)&&R.collectionValue!==g||mr(I)&&R.matchUpValue!==I||mr(U)&&R.scoreValue!==U||mr(y)&&R.setValue!==y||C)&&(A.collectionValueProfiles=void 0,A.collectionValue=void 0,A.matchUpValue=void 0,A.scoreValue=void 0,A.setValue=void 0,Object.assign(A,T),O.push({collectionId:l,...ya(T)})),(mr(U)||mr(y))&&A.collectionGroupNumber){let e=A.collectionGroupNumber;N.collectionDefinitions=N.collectionDefinitions.map((t=>{let{collectionGroupNumber:i,...n}=t;return i===e?n:t})),N.collectionGroups=N.collectionGroups.filter((({groupNumber:t})=>t!==e)),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:L}=ZD(N),_=ya({aggregateValue:x,valueGoal:L});if((_.aggregateValue!==(null==M?void 0:M.winCriteria.aggregateValue)||_.valueGoal!==(null==M?void 0:M.winCriteria.valueGoal))&&(N.winCriteria=_,O.push({collectionId:l,winCriteria:_})),mr(i)&&R.collectionOrder!==i&&(A.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),n&&R.collectionName!==n&&(A.collectionName=n,O.push({collectionId:l,collectionName:n})),o&&R.matchUpFormat!==o&&(A.matchUpFormat=o,O.push({collectionId:l,matchUpFormat:o})),mr(s)&&R.matchUpCount!==s&&(A.matchUpCount=s,O.push({collectionId:l,matchUpCount:s})),u&&R.matchUpType!==u)return Sa({result:{error:Gn},context:{matchUpType:u},stack:w});p&&R.category!==p&&(A.category=p,O.push({collectionId:l,category:p})),f&&R.gender!==f&&(A.gender=f,O.push({collectionId:l,gender:f}));let B=ya(N);if(P=nU({tieFormat:B}),P.error)return Sa({result:P,stack:w});if(!O.length)return Sa({result:{...Be,modifications:O}});if((null==M?void 0:M.tieFormatName)!==r?(B.tieFormatName=r,O.push({tieFormatName:r})):O.length&&(delete B.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),P=function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:o,event:s,uuids:l}){var u,d,c,p;let m="updateTieFormat",f=null==t?void 0:t.tournamentId,h=0,v=0,g=0,I=0,U=null==r?void 0:r.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{}),y=({tieFormat:e})=>SE({from:null==e?void 0:e.collectionDefinitions.reduce(((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e)),{}),to:U}).equivalent,S=null==(u=UE({drawDefinition:i}))?void 0:u.tieFormat,w=null==(d=UE({event:s}))?void 0:d.tieFormat;if(s&&a){for(let e of s.drawDefinitions??[])T({drawDefinition:e});s.tieFormat=oU(r),I+=1}else if(o){if(!o.tieMatchUps)return Sa({result:{error:ii},stack:m});let t=Ur(null==(c=o.tieMatchUps)?void 0:c.map((({collectionId:e})=>e))),n=SE({to:U,from:t}),{changes:a,changesArePossible:u,cannotChangeReaon:d}=wE({matchUp:o,check:n});if(n.equivalent){if(!yE({matchUp:o,updateInProgressMatchUps:e}))return Sa({result:{error:bi},info:"matchUp is IN_PROGRESS or COMPLETE",stack:m});o.tieFormat=oU(r),I+=1}else{if(!u)return Sa({context:{collectionMap:U,matchUpMap:t},result:{error:Ht},info:d||"specified changes not possible",stack:m});D({tieFormat:r,matchUp:o,changes:a,uuids:l})}v+=1,yd({eventId:null==s?void 0:s.eventId,context:m,drawDefinition:i,tournamentId:f,matchUp:o})}else if(n){let e=null==(p=P({inheritedTieFormat:S??w,structure:n}))?void 0:p.modifiedMatchUpsCount;e&&(v+=e,h+=1,I+=1);let t=!n.tieFormat||QP({ancestor:n.tieFormat,descendant:r}).different;t&&(n.tieFormat=oU(r),h+=1,I+=1),(e||t)&&i&&wd({structureIds:[n.structureId],eventId:null==s?void 0:s.eventId,drawDefinition:i})}else{if(!i)return{error:Ke};T({drawDefinition:i}),i.tieFormat=oU(r),I+=1}return{modifiedStructuresCount:h,modifiedMatchUpsCount:v,addedMatchUpsCount:g,modifiedCount:I,...Be,tieFormat:r};function T({drawDefinition:e}){var t;let i=e.structures||[],n=[];for(let r of i){if(r.tieFormat)continue;let e=null==(t=P({inheritedTieFormat:w,structure:r}))?void 0:t.modifiedMatchUpsCount;if(e){h+=1,v+=e;let t=r.structureId;n.push(t)}}return wd({structureIds:n,eventId:null==s?void 0:s.eventId,drawDefinition:e}),n.length}function P({inheritedTieFormat:n,structure:o}){var s,u;let d=0,c=(null==(s=Zm({matchUpFilters:{matchUpTypes:[kd]},structure:o}))?void 0:s.matchUps)||[];for(let p of c){let o=yE({matchUp:p,updateInProgressMatchUps:e}),s=!1,c=SE({from:Ur(null==(u=p.tieMatchUps)?void 0:u.map((({collectionId:e})=>e))),to:U});if(c.equivalent)p.tieFormat&&y(p)&&o&&(p.tieFormat=oU(r),s=!0);else{let{changes:e,changesArePossible:t}=wE({matchUp:p,check:c});if(t&&!p.tieFormat)D({changes:e,matchUp:p,tieFormat:r,uuids:l});else{if(!n)return Sa({result:{error:Jt},stack:m});(!p.tieFormat||QP({ancestor:n,descendant:p.tieFormat}).different)&&(p.tieFormat=n,s=!0)}}s&&(d+=1,yd({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:i,context:m,eventId:a,matchUp:p}))}return{modifiedMatchUpsCount:d}}function D({uuids:e,matchUp:t,tieFormat:n,changes:r}){t.tieFormat=oU(n);let o=[],s=[];return r.forEach((i=>{if(i.countChange>0){let r=Math.max(0,...t.tieMatchUps.filter((e=>e.collectionId===i.collectionId)).map($d("collectionPosition"))),a=n.collectionDefinitions.find((e=>e.collectionId===i.collectionId)),o=aI({matchUpsLimit:i.countChange,collectionPositionOffset:r,collectionDefinition:a,matchUp:t,uuids:e});s.push(...Wo(o,!1,!0)),g+=s.length,t.tieMatchUps.push(...o)}else{let e=i.toBePlayedTieMatchUpIds.slice(0,Math.abs(i.countChange));console.log("remove",e.length),o.push(...e),t.tieMatchUps=t.tieMatchUps.filter((({matchUpId:t})=>!e.includes(t)))}})),s.length&&Id({matchUps:s,drawDefinition:i,tournamentId:f,eventId:a}),o.length&&Ud({matchUpIds:o,action:"updateTieFormat",drawDefinition:i,tournamentId:f,eventId:a}),{matchUpIdsRemoved:o,matchUpsAdded:s}}}({tieFormat:B,updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:a,structure:b,eventId:m,matchUp:D,event:h}),!P.error){let{appliedPolicies:e}=jc({tournamentRecord:t});if(null!=(S=null==e?void 0:e.audit)&&S[Ys]){TE({drawDefinition:a,auditData:ya({collectionDefinition:A,drawId:null==a?void 0:a.drawId,action:w,structureId:d,matchUpId:c,eventId:m})})}}return Sa({result:{...P,modifications:O},stack:w})}function DE({updateInProgressMatchUps:e,originalValueGoal:t,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:u,matchUp:d,eventId:c,event:p}){let{aggregateValue:m,valueGoal:f}=ZD(l);l.winCriteria=ya({aggregateValue:m,valueGoal:f}),(t&&t!==f||m&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:h}=function({updateInProgressMatchUps:e,drawDefinition:t,structureId:i,structure:n,matchUpId:r,matchUp:a}){var o,s;let l=[];return r&&a?l=[a]:i&&n?l=(null==(o=Zm({matchUpFilters:{matchUpTypes:[kd]},structure:n}))?void 0:o.matchUps)??[]:t&&(l=(null==(s=Cf({matchUpFilters:{matchUpTypes:[kd]},drawDefinition:t}))?void 0:s.matchUps)??[]),{targetMatchUps:l.filter((t=>!t.winningSide&&t.matchUpStatus!==hl&&(e||t.matchUpStatus!==yl&&!kf(t))))}}({updateInProgressMatchUps:e,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:d});!function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let o of n){let n,s=!!o.tieFormat;if(s&&(o.tieFormat=oU(r)),e){let e=jc({tournamentRecord:t,drawDefinition:i,event:a}).appliedPolicies,r=uU({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:t,appliedPolicies:e,drawDefinition:i,event:a});if(r.error)return r;n=r.score}s&&!n&&yd({tournamentId:null==t?void 0:t.tournamentId,context:"updateTargetTeamMatchUps",eventId:null==a?void 0:a.eventId,matchUp:o,drawDefinition:i})}}({updateInProgressMatchUps:e,tournamentRecord:i,targetMatchUps:h,drawDefinition:a,tieFormat:l,event:p});let v=ya(l),g=nU({tieFormat:v});if(g.error)return g;if(c&&p)p.tieFormat=v;else if(u&&d)d.tieFormat=l;else if(s)s.tieFormat=v;else if(a)a.tieFormat=v;else if(!d||!a)return{error:Ke};return wd({drawDefinition:a,eventId:null==p?void 0:p.eventId}),{...Be}}function bE({updateInProgressMatchUps:e=!0,collectionGroupNumber:t,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:u}){var d;if(!t)return{error:mi};if(isNaN(t))return{error:Fn};let c="removeCollectionGroup",p=s?void 0:UE({drawDefinition:n,structureId:a,matchUpId:o,eventId:l,event:u});if(null!=p&&p.error)return Sa({result:p,stack:c});let m=null==p?void 0:p.structure;s=s??(null==p?void 0:p.matchUp);let f=null==p?void 0:p.tieFormat,h=null==f?void 0:f.winCriteria.valueGoal,v=null==f?void 0:f.winCriteria.aggregateValue,g=oU(f);if(p=nU({tieFormat:g}),p.error)return Sa({result:p,stack:c});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map((e=>{let{collectionGroupNumber:i,...n}=e;return i!==t?e:(I.push(e.collectionId),n)})),g.collectionGroups=g.collectionGroups.filter((({groupNumber:e})=>e!==t)),p=DE({updateInProgressMatchUps:e,originalValueGoal:h,wasAggregateValue:v,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:m,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:u}),!p.error){let{appliedPolicies:e}=jc({tournamentRecord:i});if(null!=(d=null==e?void 0:e.audit)&&d[Ys]){TE({drawDefinition:n,auditData:ya({drawId:null==n?void 0:n.drawId,collectionGroupNumber:t,action:c,structureId:a,matchUpId:o,eventId:l})})}}return Sa({result:{...p,modifiedCollectionIds:I},stack:c})}function ME({tieFormat:e,orderMap:t}){let i=oU(e);return i.collectionDefinitions.forEach((e=>{let i=t[e.collectionId];i&&(e.collectionOrder=i)})),i.collectionDefinitions.sort(((e,t)=>Ir(e.collectionOrder)-Ir(t.collectionOrder))),i}function NE({tournamentRecord:e,drawDefinition:t,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:o,event:s}){if("object"!=typeof r||!Object.values(r).every((e=>mr(e))))return Sa({result:{error:Fn},context:{orderMap:r}});if(a&&null!=s&&s.tieFormat)RE({tournamentRecord:e,event:s,orderMap:r});else if(n){let i=t&&OI({drawDefinition:t,matchUpId:n});if(null!=i&&i.error)return i;if(!(o=i.matchUp))return{error:ti};null!=o&&o.tieFormat&&(o.tieFormat=ME({tieFormat:o.tieFormat,orderMap:r}),yd({tournamentId:null==e?void 0:e.tournamentId,eventId:null==s?void 0:s.eventId,drawDefinition:t,matchUp:o}))}else if(i){let n=_u({drawDefinition:t,structureId:i});if(n.error)return n;let a=n.structure;if(null!=a&&a.tieFormat)a.tieFormat=ME({tieFormat:a.tieFormat,orderMap:r}),EE({eventId:null==s?void 0:s.eventId,tournamentRecord:e,drawDefinition:t,structure:a,orderMap:r}),wd({drawDefinition:t,structureIds:[a.structureId]});else if(t.tieFormat)AE({structureIds:[i],tournamentRecord:e,drawDefinition:t,orderMap:r,event:s});else{if(null==s||!s.tieFormat)return{error:Vn};RE({structureIds:[i],tournamentRecord:e,orderMap:r,event:s})}}else{if(null==t||!t.tieFormat)return{error:Vn};AE({tournamentRecord:e,drawDefinition:t,orderMap:r,event:s})}return{...Be}}function RE({tournamentRecord:e,structureIds:t,orderMap:i,event:n}){let r=ME({tieFormat:n.tieFormat,orderMap:i});null!=t&&t.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])AE({tournamentRecord:e,drawDefinition:a,structureIds:t,orderMap:i,event:n})}function AE({tournamentRecord:e,drawDefinition:t,structureIds:i,orderMap:n,event:r}){let a=ME({tieFormat:t.tieFormat??(null==r?void 0:r.tieFormat),orderMap:n});null!=i&&i.length||(t.tieFormat=a);let o=[];for(let s of t.structures??[])null!=i&&i.length&&!i.includes(s.structureId)||((s.tieFormat||null!=i&&i.includes(s.structureId))&&(s.tieFormat=ME({tieFormat:s.tieFormat??t.tieFormat??(null==r?void 0:r.tieFormat),orderMap:n})),EE({eventId:null==r?void 0:r.eventId,tournamentRecord:e,drawDefinition:t,structure:s,orderMap:n}),o.push(s.structureId));wd({drawDefinition:t,structureIds:o})}function EE({tournamentRecord:e,drawDefinition:t,structure:i,orderMap:n,eventId:r}){var a;let o=null==(a=Zm({matchUpFilters:{matchUpTypes:[kd]},structure:i}))?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=ME({tieFormat:s.tieFormat,orderMap:n}),yd({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:t,eventId:r,matchUp:s}))}function CE({updateInProgressMatchUps:e=!0,tieFormatComparison:t,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:u,event:d}){var c,p,m,f,h,v;let g="removeCollectionDefinition",I=u?void 0:UE({drawDefinition:n,structureId:o,matchUpId:s,eventId:l,event:d});if(null!=I&&I.error)return Sa({result:I,stack:g});let U=null==I?void 0:I.structure;u=u??(null==I?void 0:I.matchUp);let y=null==I?void 0:I.tieFormat,S=oU(y);if(I=nU({tieFormat:S}),I.error)return Sa({result:I,stack:g});let w=null==(c=null==S?void 0:S.collectionDefinitions)?void 0:c.find((e=>e.collectionId===a));if(!w)return Sa({result:{error:Vn,collectionId:a}});S.collectionDefinitions=S.collectionDefinitions.filter((e=>e.collectionId!==a)),w.collectionGroupNumber&&(S.collectionDefinitions=S.collectionDefinitions.map((e=>{let{collectionGroupNumber:t,...i}=e;return i})),S.collectionGroups=S.collectionGroups.filter((({groupNumber:e})=>e!==w.collectionGroupNumber)));let{aggregateValue:T,valueGoal:P}=ZD(S);S.winCriteria=ya({aggregateValue:T,valueGoal:P});let D=null==y?void 0:y.winCriteria.valueGoal,b=null==y?void 0:y.winCriteria.aggregateValue;(D&&D!==P||T&&!b)&&(r?S.tieFormatName=r:delete S.tieFormatName);let M=[];s&&u?M=[u]:o&&U?M=(null==(p=Zm({matchUpFilters:{matchUpTypes:[kd]},structure:U}))?void 0:p.matchUps)??[]:n?M=(null==(m=Cf({matchUpFilters:{matchUpTypes:[kd]},drawDefinition:n}))?void 0:m.matchUps)??[]:d&&(M=(null==(f=Nf({matchUpFilters:{matchUpTypes:[kd]},drawDefinition:n}))?void 0:f.matchUps)??[]);let N=(M||[]).filter((i=>{var n,r,o;let s=null==(r=null==(n=i.tieMatchUps)?void 0:n.filter((e=>e.collectionId===a)))?void 0:r.some(kf),l=!(!t||!i.tieFormat)&&(null==(o=QP({descendant:i.tieFormat,ancestor:S}))?void 0:o.different);return e&&!s||!i.winningSide&&i.matchUpStatus!==hl&&(e||i.matchUpStatus!==yl&&!kf(i)&&!l)}));if(!N.length)return{error:Mn};let{appliedPolicies:R}=jc({tournamentRecord:i});if(s&&u&&e){let e=null==(h=u.tieMatchUps)?void 0:h.filter((e=>e.collectionId===a));for(let t of e??[]){let e=NN({matchUpId:t.matchUpId,tieMatchUpId:null==u?void 0:u.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:R,drawDefinition:n,event:d});if(e.error||(e=OI({drawDefinition:n,matchUpId:s}),e.error))return e;u=null==e?void 0:e.matchUp}}let A=[];for(let C of N){for(let e of(null==C?void 0:C.sides)??[])e.lineUp=(e.lineUp??[]).map((e=>({participantId:e.participantId,collectionAssignments:((null==e?void 0:e.collectionAssignments)??[]).filter((e=>e.collectionId!==a))})));if(C.tieMatchUps=(C.tieMatchUps??[]).filter((e=>{let t=e.collectionId===a;return t&&A.push(e.matchUpId),!t})),C.tieFormat&&(C.tieFormat=oU(S)),e){let e=uU({matchUpId:C.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:R,drawDefinition:n,event:d});if(e.error)return e}yd({tournamentId:null==i?void 0:i.tournamentId,eventId:null==d?void 0:d.eventId,drawDefinition:n,context:g,matchUp:C})}A.length&&Ud({tournamentId:null==i?void 0:i.tournamentId,matchUpIds:A,eventId:null==d?void 0:d.eventId,drawDefinition:n});let E=ya(S);if(I=nU({tieFormat:E}),I.error)return Sa({result:I,stack:g});if(l&&d)d.tieFormat=E;else if(s&&u)u.tieFormat=E;else if(U)U.tieFormat=E;else if(n)n.tieFormat=E;else if(!u||!n)return{error:Ke};if(wd({drawDefinition:n,eventId:null==d?void 0:d.eventId}),null==(v=null==R?void 0:R.audit)?void 0:v[Ys]){TE({drawDefinition:n,auditData:ya({drawId:null==n?void 0:n.drawId,action:g,collectionId:a,structureId:o,matchUpId:s,eventId:l})})}return{tieFormat:E,deletedMatchUpIds:A,targetMatchUps:N,...Be}}function OE({updateInProgressMatchUps:e=!0,tournamentRecord:t,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:u,event:d}){let c="addCollectionGroup";if(!Array.isArray(r))return Sa({result:{error:mi},stack:c});let p=l?void 0:UE({drawDefinition:n,structureId:o,matchUpId:s,eventId:u,event:d});if(null!=p&&p.error)return Sa({result:p,stack:c});let m=null==p?void 0:p.structure;l=l||(null==p?void 0:p.matchUp);let f=null==p?void 0:p.tieFormat,h=null==f?void 0:f.winCriteria.valueGoal,v=oU(f);if(p=nU({tieFormat:v}),p.error)return Sa({result:p,stack:c});for(let I of v.collectionDefinitions){let{collectionId:e,collectionGroupNumber:t}=I;if(t&&r.includes(e))return Sa({info:"collectionIds cannot be part of other collectionGroups",result:{error:Fn},stack:c})}let g=(v.collectionGroups||[]).reduce(((e,t)=>t.groupNumber>e?t.groupNumber:e),0)+1;return i.groupNumber=g,v.collectionDefinitions=v.collectionDefinitions.map((e=>r.includes(e.collectionId)?{...e,collectionGroupNumber:g}:e)),v.collectionGroups=[...v.collecitonGroups||[],i],DE({updateInProgressMatchUps:e,originalValueGoal:h,tournamentRecord:t,drawDefinition:n,tieFormatName:a,structureId:o,structure:m,tieFormat:v,matchUpId:s,matchUp:l,eventId:u,event:d})}function kE({updateInProgressMatchUps:e=!0,collectionDefinition:t,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:u,structureId:d,matchUpId:c,matchUp:p,eventId:m,uuids:f,event:h}){var v,g,I;let U="addCollectionDefinition",y=jc({tournamentRecord:n,drawDefinition:s,event:h}).appliedPolicies??{},S=(null==r?void 0:r[Qo])??(null==y?void 0:y[Qo]);a=a??(null==(v=null==S?void 0:S.participants)?void 0:v.enforceCategory);let w=!1!==(u??(null==(g=null==S?void 0:S.participants)?void 0:g.enforceGender)),T=!(!(i??(null==h?void 0:h.category))||!1===a),P=!(!(o??(null==h?void 0:h.gender))||!w),D=iU({referenceCategory:i??(null==h?void 0:h.category),collectionDefinition:t,referenceGender:o,checkCategory:T,checkGender:P,event:h});if(D.error)return Sa({result:D,stack:U});let b=null!=p&&p.tieFormat?void 0:UE({drawDefinition:s,structureId:d,matchUpId:c,eventId:m,event:h});if(null!=b&&b.error)return Sa({result:{error:b.error},stack:U});let M=null==b?void 0:b.structure,N=(null==(p=p??(null==b?void 0:b.matchUp))?void 0:p.tieFormat)??(null==b?void 0:b.tieFormat),R=oU(N);if(b=nU({tieFormat:R}),null==b?void 0:b.error)return Sa({result:{error:b.error},stack:U});if(t.collectionId){if(R.collectionDefinitions.map((({collectionId:e})=>e)).includes(t.collectionId))return Sa({context:{collectionId:t.collectionId},result:{error:xn}})}else t.collectionId=am();R.collectionDefinitions.push(t),R.collectionDefinitions.sort(((e,t)=>(e.collectionOrder||0)-(t.collectionOrder||0))).forEach(((e,t)=>e.collectionOrder=t+1));let{aggregateValue:A,valueGoal:E}=ZD(R);R.winCriteria=ya({aggregateValue:A,valueGoal:E});let C=null==N?void 0:N.winCriteria.valueGoal,O=null==N?void 0:N.winCriteria.aggregateValue;(C&&C!==E||A&&!O)&&(l?R.tieFormatName=l:delete R.tieFormatName);let k=[],F=[],x=[],L=ya(R);if(b=nU({tieFormat:L}),null==b?void 0:b.error)return Sa({result:{error:b.error},stack:U});if(m&&h){h.tieFormat=L;for(let i of h.drawDefinitions??[])if(!i.tieFormat)for(let n of i.structures??[]){if(n.tieFormat)continue;let i=FE({updateInProgressMatchUps:e,collectionDefinition:t,structure:n,uuids:f});F.push(...i.newMatchUps),x.push(...i.targetMatchUps),k.push(n.structureId)}xE({modifiedMatchUps:x,eventId:null==h?void 0:h.eventId,modifiedStructureIds:k,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:U})}else if(d&&M){M.tieFormat=L;let i=FE({updateInProgressMatchUps:e,collectionDefinition:t,structure:M,uuids:f});F.push(...i.newMatchUps),x=i.targetMatchUps,xE({modifiedMatchUps:x,eventId:null==h?void 0:h.eventId,modifiedStructureIds:k,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:U})}else if(c&&p){if(!yE({matchUp:p,updateInProgressMatchUps:e}))return Sa({result:{error:bi},stack:U});p.tieFormat=L;let i=aI({collectionDefinition:t,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...i),F.push(...i),xE({modifiedMatchUps:[p],eventId:null==h?void 0:h.eventId,modifiedStructureIds:k,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:U})}else{if(!s)return{error:Ke};s.tieFormat=L;for(let i of s.structures??[]){let n=FE({updateInProgressMatchUps:e,collectionDefinition:t,structure:i,uuids:f});k.push(i.structureId),F.push(...n.newMatchUps),x.push(...n.targetMatchUps)}xE({modifiedMatchUps:x,eventId:null==h?void 0:h.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:U})}if(null!=(I=null==y?void 0:y.audit)&&I[Ys]){TE({drawDefinition:s,auditData:ya({drawId:null==s?void 0:s.drawId,collectionDefinition:t,action:U,structureId:d,matchUpId:c,eventId:m})})}return{tieFormat:L,targetMatchUps:x,addedMatchUps:F,...Be}}function FE({updateInProgressMatchUps:e,collectionDefinition:t,structure:i,uuids:n}){var r;let a=[],o=(null==(r=Zm({matchUpFilters:{matchUpTypes:[kd]},structure:i}))?void 0:r.matchUps).filter((t=>yE({matchUp:t,updateInProgressMatchUps:e})&&!t.tieFormat));for(let s of o){let e=aI({collectionDefinition:t,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...e),a.push(...e)}return{newMatchUps:a,targetMatchUps:o}}function xE({modifiedStructureIds:e,tournamentRecord:t,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:o}){Id({tournamentId:null==t?void 0:t.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),null==i||i.forEach((e=>{yd({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:n,context:o,matchUp:e,eventId:a})})),wd({structureIds:e,drawDefinition:n,eventId:a})}function LE({updateInProgressMatchUps:e=!1,tieFormatComparison:t,modifiedTieFormat:i,tournamentRecord:n,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,uuids:l,event:u}){let d="modifyTieFormat";if(!nU({tieFormat:i}).valid)return Sa({result:{error:Ht},info:"falied validation",stack:d});let c=UE({drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:u});if(c.error)return Sa({result:c,stack:d});let{matchUp:p,tieFormat:m}=c,f=oU(m),h=QP({descendant:i,ancestor:f});if(h.invalid)return Sa({context:{invalid:h.invalid},result:{error:Ht},stack:d});if(null==h||!h.different)return Sa({result:{...Be},info:"Nothing to do",stack:d});let v,g=f.collectionDefinitions.map((({collectionId:e})=>e)),I=i.collectionDefinitions.map((({collectionId:e})=>e)),U=g.filter((e=>!I.includes(e))),y=i.collectionDefinitions.filter((({collectionId:e})=>!g.includes(e))),S=y.map($d("collectionId")),w=[],T=i.tieFormatName;for(let P of i.collectionDefinitions){if(S.includes(P.collectionId))continue;let t=PE({updateInProgressMatchUps:e,...P,tournamentRecord:n,tieFormatName:T,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:u});if(t.modifications&&w.push(...t.modifications),t.error)return Sa({result:t,stack:d});t.tieFormat&&(v=t.tieFormat)}for(let P of y){let t=kE({updateInProgressMatchUps:e,collectionDefinition:P,tournamentRecord:n,drawDefinition:r,tieFormatName:T,structureId:a,matchUpId:o,matchUp:p,eventId:s,uuids:l,event:u});if(t.error)return Sa({result:t,stack:d});t.tieFormat&&(v=t.tieFormat)}for(let P of U){let i=CE({updateInProgressMatchUps:e,tieFormatComparison:t,tournamentRecord:n,drawDefinition:r,tieFormatName:T,collectionId:P,structureId:a,matchUpId:o,eventId:s,matchUp:p,event:u});if(i.error)return Sa({result:i,stack:d});i.tieFormat&&(v=i.tieFormat)}return(null==m?void 0:m.tieFormatName)!==T?(v.tieFormatName=T,w.push({tieFormatName:T})):(w.length||S.length||U.length)&&(delete v.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),v.collectionDefinitions=v.collectionDefinitions.sort(((e,t)=>Ir(e.collectionOrder)-Ir(t.collectionOrder))).map(((e,t)=>({...e,collectionOrder:t+1}))),{processedTieFormat:oU(v),modifications:w,...Be}}function _E({tournamentRecord:e}){if(!e)return{error:We};let t=0;for(let i of e.events??[]){let n=i.tieFormats??[],r=e=>{if(!e.tieFormat)return;let i;for(let t of n)QP({descendant:e.tieFormat,ancestor:t}).different||(i=t.tieFormatId);if(i)e.tieFormatId=i,delete e.tieFormat;else{let i=Wo(e.tieFormat,void 0,!0);i.tieFormatId||(i.tieFormatId=am()),e.tieFormatId=i.tieFormatId,delete e.tieFormat,n.push(i),t+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let e of i.drawDefinitions??[]){r({tieFormat:e.tieFormat,eventType:a});for(let t of e.structures??[])r({tieFormat:t.tieFormat,eventType:a})}let o=(t,n)=>{var r;let a=null==(r=l.matchUps)?void 0:r.find((e=>e.matchUpId===t));a&&(a.tieFormatId=n,delete a.tieFormat,yd({tournamentId:null==e?void 0:e.tournamentId,eventId:i.eventId,matchUp:a}))},s=e=>{let i=Wo(e.tieFormat,void 0,!0);i.tieFormatId||(i.tieFormatId=am()),n.push(i),t+=1,o(e.matchUpId,i.tieFormatId)},l=Nf({matchUpFilters:{matchUpTypes:[Od]},event:i}),u=l.matchUps??[];for(let e of u){let t;for(let i of n)e.tieFormat&&QP({descendant:e.tieFormat,ancestor:i}).different||(t=i.tieFormatId);t?o(e.matchUpId,t):s(e)}n.length&&(i.tieFormats=n)}return{...Be,addedCount:t}}be(IE,{addCollectionDefinition:()=>kE,addCollectionGroup:()=>OE,aggregateTieFormats:()=>_E,modifyCollectionDefinition:()=>PE,modifyTieFormat:()=>LE,orderCollectionDefinitions:()=>NE,removeCollectionDefinition:()=>CE,removeCollectionGroup:()=>bE});var BE={};be(BE,{addDrawDefinitionExtension:()=>vs,addEventExtension:()=>gs,addEventTimeItem:()=>Tg,addExtension:()=>fs,addNotes:()=>kI,addOnlineResource:()=>$E,addParticipantExtension:()=>Is,addParticipantTimeItem:()=>Sg,addTimeItem:()=>yg,addTournamentExtension:()=>hs,addTournamentTimeItem:()=>wg,analyzeDraws:()=>SU,analyzeTournament:()=>YP,getAllowedDrawTypes:()=>BP,getAllowedMatchUpFormats:()=>_P,getAppliedPolicies:()=>jc,getCompetitionDateRange:()=>WP,getCompetitionPenalties:()=>VP,getPolicyDefinitions:()=>Vc,getTournamentInfo:()=>qP,getTournamentPenalties:()=>jP,getTournamentPersons:()=>HP,getTournamentStructures:()=>$v,getTournamentTimeItem:()=>Uf,mutate:()=>jE,query:()=>LP,removeDrawDefinitionExtension:()=>ys,removeEventExtension:()=>Ss,removeExtension:()=>ps,removeNotes:()=>FI,removeParticipantExtension:()=>ws,removeTournamentExtension:()=>Us,setTournamentCategories:()=>HE,setTournamentDates:()=>zE,setTournamentEndDate:()=>KE,setTournamentName:()=>qE,setTournamentNotes:()=>WE,setTournamentStartDate:()=>YE,setTournamentStatus:()=>GE});var jE={};be(jE,{addDrawDefinitionExtension:()=>vs,addEventExtension:()=>gs,addEventTimeItem:()=>Tg,addExtension:()=>fs,addNotes:()=>kI,addOnlineResource:()=>$E,addParticipantExtension:()=>Is,addParticipantTimeItem:()=>Sg,addTimeItem:()=>yg,addTournamentExtension:()=>hs,addTournamentTimeItem:()=>wg,removeDrawDefinitionExtension:()=>ys,removeEventExtension:()=>Ss,removeExtension:()=>ps,removeNotes:()=>FI,removeParticipantExtension:()=>ws,removeTournamentExtension:()=>Us,setTournamentCategories:()=>HE,setTournamentDates:()=>zE,setTournamentEndDate:()=>KE,setTournamentName:()=>qE,setTournamentNotes:()=>WE,setTournamentStartDate:()=>YE,setTournamentStatus:()=>GE});var VE={ABANDONED:"ABANDONED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};function GE({tournamentRecord:e,status:t}){return e?t&&!Object.keys(VE).includes(t)?{error:Fn,info:"Unknown status"}:(e.tournamentStatus=t,{...Be}):{error:We}}function $E({tournamentRecord:e,onlineResource:t,organisationId:i,participantId:n,personId:r,courtId:a,venueId:o}){var s,l,u;if(!e)return{error:We};if(!Ce(t))return{error:mi};if(3!==Nr(Object.keys(t),["resourceSubType","resourceType","identifier"]).length)return Sa({result:{error:Cn},context:{onlineResource:t}});if(i){if((null==(s=e.parentOrganisation)?void 0:s.parentOrganisationId)!==i)return Sa({result:{error:Vn}});e.parentOrganisation.onlineResources||(e.parentOrganisation.onlineResources=[]),e.parentOrganisation.onlineResources.push(t)}else if(n||r){let i=(e.participants??[]).find((e=>{var t;return r&&(null==(t=e.person)?void 0:t.personId)===r||e.participantId===n}));if(!i)return Sa(r?{result:{error:Vn}}:{result:{error:Bi}});if(r){if((null==(l=i.person)?void 0:l.personId)!==r)return Sa({result:{error:Ai}});i.person.onlineResources||(i.person.onlineResources=[]),i.person.onlineResources.push(t)}else i.onlineResources||(i.onlineResources=[]),i.onlineResources.push(t)}else if(a){let i=null==(u=(e.venues??[]).filter((e=>!o||e.venueId===o)).flatMap((e=>(e.courts??[]).filter((e=>e.courtId===a)))))?void 0:u[0];if(!i)return Sa({result:{error:un}});i.onlineResources||(i.onlineResources=[]),i.onlineResources.push(t)}else if(o){let i=(e.venues??[]).find((e=>e.venueId===o));if(!i)return Sa({result:{error:pn}});i.onlineResources||(i.onlineResources=[]),i.onlineResources.push(t)}else e.onlineResources||(e.onlineResources=[]),e.onlineResources.push(t);return{...Be}}function qE({tournamentRecord:e,promotionalName:t,tournamentName:i,formalName:n}){return e?(i&&(e.tournamentName=i),t&&(e.promotionalName=t),n&&(e.formalName=n),e.promotionalName===e.tournamentName&&delete e.promotionalName,e.formalName===e.tournamentName&&delete e.formalName,{...Be}):{error:We}}function WE({tournamentRecord:e,notes:t}){return e?kI({element:e,notes:t}):{error:We}}function HE({tournamentRecord:e,categories:t}){return e?(t=(t||[]).filter((e=>e.categoryName&&e.type)),e.tournamentCategories=t,{...Be}):{error:We}}function zE(e){var t;let i,{tournamentRecord:n,startDate:r,endDate:a}=e,o=io(e,[{tournamentRecord:!0},{[Za]:{startDate:!1,endDate:!1},[Ja]:Ui,[Ya]:e=>ho.test(e)}]);if(o.error)return o;if(a&&r&&new Date(a)<new Date(r))return{error:Fn};(r&&n.startDate&&new Date(r)>new Date(n.startDate)||a&&n.endDate&&new Date(a)<new Date(n.endDate))&&(i=!0);let s=Do(n.startDate,n.endDate);r&&(n.startDate=r),a&&(n.endDate=a);let l=Do(n.startDate,n.endDate),u=s.filter((e=>!l.includes(e))),d=l.filter((e=>!s.includes(e)));for(let p of n.events??[])r&&p.startDate&&new Date(r)>new Date(p.startDate)&&(p.startDate=r),a&&p.endDate&&new Date(a)<new Date(p.endDate)&&(p.endDate=a);r&&n.endDate&&new Date(r)>new Date(n.endDate)&&(n.endDate=r),a&&n.startDate&&new Date(a)<new Date(n.startDate)&&(n.startDate=a);let c=i&&(null==(t=function({tournamentRecord:e}){let t=Rf({tournamentRecord:e}).matchUps??[],i=e.startDate&&new Date(e.startDate),n=e.endDate&&new Date(e.endDate),r=[],a=[];for(let o of t){let{schedule:e,matchUpId:t}=o;if(e&&e.scheduledDate){let o=new Date(e.scheduledDate);(i&&o<i||n&&o>n)&&(a.push(t),r.includes(e.scheduledDate)||r.push(e.scheduledDate))}}return r.length&&!vR({scheduledDates:r,tournamentRecord:e}).clearedScheduleCount?{error:it}:{unscheduledMatchUpIds:a}}({tournamentRecord:n}))?void 0:t.unscheduledMatchUpIds);return function({tournamentRecord:e}){var t,i;if(!e)return{error:We};let{startDate:n,endDate:r}=e,a=Do(n,r),o=[];for(let s of e.venues||[])null!=(t=null==s?void 0:s.courts)&&t.length&&o.push(...s.courts);for(let s of o){let{startTime:e,endTime:t}=(s.dateAvailability??[]).reduce(((e,t)=>{let i=Ro(e.startTime),n=Ro(e.endTime);return t.startTime&&Ro(t.startTime)<i&&(e.startTime=t.startTime),t.endTime&&Ro(t.endTime)>n&&(e.endTime=t.endTime),e}),{startTime:"08:00",endTime:"18:00"}),n=a.map((i=>{var n;return(null==(n=s.dateAvailability)?void 0:n.find((e=>e.date===i)))??{date:i,startTime:e,endTime:t}})),r=null==(i=s.dateAvailability)?void 0:i.find((e=>!e.date));r&&n.unshift(r),s.dateAvailability=n}}({tournamentRecord:n}),ia({topic:od,payload:{startDate:r,endDate:a}}),{...Be,unscheduledMatchUpIds:c,datesAdded:d,datesRemoved:u}}function YE({tournamentRecord:e,startDate:t}){return zE({tournamentRecord:e,startDate:t})}function KE({tournamentRecord:e,endDate:t}){return zE({tournamentRecord:e,endDate:t})}var JE={};be(JE,{addCourt:()=>rA,addCourts:()=>aA,addVenue:()=>om,deleteCourt:()=>pC,deleteVenue:()=>nC,deleteVenues:()=>rC,disableCourts:()=>aC,disableVenues:()=>sC,enableCourts:()=>uC,enableVenues:()=>cC,generate:()=>QE,generateCourts:()=>wM,getCompetitionVenues:()=>sD,getCourts:()=>db,getVenuesAndCourts:()=>oD,modifyCourt:()=>fC,modifyCourtAvailability:()=>eC,modifyVenue:()=>gC,mutate:()=>ZE,publicFindVenue:()=>um,query:()=>ub});var QE={};be(QE,{generateCourts:()=>wM});var ZE={};function XE(e){if(!(null!=e&&e.tournamentRecord||Array.isArray(null==e?void 0:e.venueMatchUps)))return{error:We};if(null==e||!e.courtId)return{error:pi};let{scheduleVisibilityFilters:t,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=e,{schedulingProfile:o}=gD({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:s}=Rf({scheduleVisibilityFilters:t,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:e,courtId:t}){return GD({matchUps:e.filter((e=>{var i,n,r;let a=null==(n=null==(i=e.schedule)?void 0:i.allocatedCourts)?void 0:n.map((({courtId:e})=>e));return(null==(r=e.schedule)?void 0:r.courtId)===t||(null==a?void 0:a.includes(t))})),schedulingProfile:o})}}function eC({tournamentRecord:e,dateAvailability:t,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var o,s,l;if(!e)return{error:We};if(!r)return{error:pi};let u=nA({dateAvailability:t});if(u.error)return u;let{updatedDateAvailability:d,totalMergeCount:c}=function(e){let t=0,i=e.reduce(((e,t)=>{let{date:i,startTime:n,endTime:r,bookings:a}=t;return e[i]||(e[i]=[]),e[i].push({startTime:n,endTime:r,bookings:a}),e}),{}),n=[];return Object.keys(i).forEach((e=>{i[e].sort(iA);let{mergedAvailability:r,mergeCount:a}=function(e){let t,i,n,r=e.length,a=0,o=[];for(;e.length&&r;){let s=e.shift(),{startTime:l,endTime:u,bookings:d}=s;if(r-=1,t)if(Bo(_o(i),_o(l),!1)>0){let e={startTime:t,endTime:i};null!=n&&n.length&&(e.bookings=n),o.push(e),t=l,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,a+=1;else t=l,n=d,i=u}let s={startTime:t,endTime:i};return null!=n&&n.length&&(s.bookings=n),o.push(s),{mergedAvailability:o,mergeCount:a}}(i[e]);n.push(...r.map((t=>({date:e,...t})))),t+=a})),{updatedDateAvailability:n,totalMergeCount:t}}(t);t=d;let p=dm({tournamentRecord:e,courtId:r});if(p.error)return p;let{court:m,venue:f}=p,{matchUps:h}=XE({tournamentRecord:e,venueMatchUps:n,courtId:r});if(null!=h&&h.length){let t=null==(o=jc({tournamentRecord:e}))?void 0:o.appliedPolicies,i=a??(null==(l=null==(s=null==t?void 0:t[is])?void 0:s.allowDeletionWithScoresPresent)?void 0:l.courts),n=[];n.length&&(i||console.log("throw error: scheduled court matchUps",n.length))}return m&&(m.dateAvailability=t,!i&&f&&ia({payload:{venue:f,tournamentId:e.tournamentId},topic:sd,key:f.venueId})),{...Be,totalMergeCount:c}}function tC({matchUpsCount:e=0}){return{error:Jn,info:`Schedule would be deleted from ${e} ${1===e?"matchUp":"matchUps"}; use { force: true }`}}function iC({tournamentRecord:e,drawDefinition:t,matchUpId:i,drawId:n}){let r;if(!i)return{error:Qt};if(!t&&!n)return{error:mt};if(!t){if(!e)return{error:We};({drawDefinition:t}=hm({tournamentRecord:e,drawId:n}))}if(t)({matchUp:r}=OI({drawDefinition:t,matchUpId:i}));else{if(!e)return{error:We};let t=Rf({tournamentRecord:e,inContext:!1}).matchUps??[];({matchUp:r}=CI({matchUps:t,matchUpId:i}))}return r?(r.timeItems&&r.timeItems.find((e=>[Jc,Kc].includes(e.itemType)))&&(r.timeItems=r.timeItems.filter((({itemType:e})=>![Jc,Kc].includes(e))),yd({tournamentId:null==e?void 0:e.tournamentId,context:"removeCourtAssignment",drawDefinition:t,matchUp:r})),{...Be}):{error:Xt}}function nC(e){var t,i,n;if("string"!=typeof(null==e?void 0:e.venueId))return{error:mn};let{tournamentRecord:r,venueId:a,force:o}=e,s=e.tournamentRecords||r&&{[r.tournamentId]:r}||{};if(!Object.keys(s).length)return{error:We};let l=Af({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],u=null==(t=jc({tournamentRecord:r}))?void 0:t.appliedPolicies,d=o??(null==(n=null==(i=null==u?void 0:u[is])?void 0:i.allowDeletionWithScoresPresent)?void 0:n.venues);if(l.length&&!d)return tC({matchUpsCount:l.length});for(let c of Object.values(s)){for(let t of l){let e=iC({matchUpId:t.matchUpId,drawId:t.drawId,tournamentRecord:c});if(e.error)return e}let e;c.venues=(c.venues??[]).filter((t=>(null==t?void 0:t.venueId)!==a||(e=!0,!1))),e&&ia({payload:{venueId:a,tournamentId:c.tournamentId},topic:Ju,key:a})}return UD({tournamentRecords:s}),{...Be}}function rC({tournamentRecord:e,venueIds:t,force:i}){if(!e)return{error:We};if(!Array.isArray(t))return{error:Fn};for(let n of e.venues||[]){let{venueId:r}=n;if(t.includes(r)){let{venueId:t}=n,r=nC({tournamentRecord:e,venueId:t,force:i});if(r.error)return r}}return{...Be}}function aC(e){let{courtIds:t,dates:i}=e,n=Ld(e),r=io(e,[{[wa]:!0,[xa]:!0}]);if(r.error)return r;for(let a of Object.values(n))oC({tournamentRecord:a,courtIds:t,dates:i});return{...Be}}function oC({tournamentRecord:e,courtIds:t,dates:i}){let n=!Array.isArray(i)||!i.length||{dates:i},r=e=>fs({extension:{value:n,name:As},creationTime:!1,element:e});for(let a of e.venues||[])for(let e of a.courts||[])if(null!=t&&t.includes(e.courtId)){let t=r(e);if(t.error)return t}return{...Be}}function sC(e){let{tournamentRecords:t,tournamentId:i,venueIds:n}=e,r=io(e,[{[wa]:!0,[La]:!0}]);if(r.error)return r;let a=Object.keys(t).filter((e=>!i||e===i));for(let o of a){lC({tournamentRecord:t[o],venueIds:n})}return{...Be}}function lC({tournamentRecord:e,venueIds:t}){for(let i of e.venues||[])if(null!=t&&t.includes(i.venueId)){let e=fs({creationTime:!1,element:i,extension:{name:As,value:!0}});if(e.error)return e}return{...Be}}function uC(e){let t=Ld(e),i=[{[wa]:!0}];!e.enableAll&&i.push({[xa]:!0});let n=io(e,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:o}=e;for(let s of Object.values(t))dC({tournamentRecord:s,courtIds:a,enableAll:r,dates:o});return{...Be}}function dC({tournamentRecord:e,courtIds:t,enableAll:i,dates:n}){for(let r of e.venues||[])for(let e of r.courts||[])if(i||null!=t&&t.includes(e.courtId))if(Array.isArray(n)){let{extension:t}=Ds({element:e,name:As});if(t){let i=t.value;Array.isArray(i.dates)&&(i.dates=i.dates.filter((e=>!n.includes(e)))),fs({extension:{name:As,value:i},creationTime:!1,element:e})}}else ps({element:e,name:As});return{...Be}}function cC(e){let t=Ld(e),i=[{[wa]:!0}];!e.enableAll&&i.push({[La]:!0});let n=io(e,i);if(n.error)return n;let{venueIds:r,enableAll:a}=e;for(let o of Object.values(t))for(let e of o.venues||[])(a||null!=r&&r.includes(e.venueId))&&ps({element:e,name:As});return{...Be}}function pC(e){let t,i,{courtId:n,disableNotice:r,force:a}=e,o=Ld(e),s=io(e,[{[wa]:!0,[Ba]:!0}]);if(s.error)return s;for(let l of Object.values(o)){if(i=mC({tournamentRecord:l,disableNotice:r,courtId:n,force:a}),i.error&&i.error!==un)return i;i.success&&(t=!0)}return t?{...Be}:i}function mC({tournamentRecord:e,disableNotice:t,courtId:i,force:n}){var r,a,o;let s=dm({tournamentRecord:e,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:u}=XE({tournamentRecord:e,courtId:i}),d=null==(r=jc({tournamentRecord:e}))?void 0:r.appliedPolicies,c=n??(null==(o=null==(a=null==d?void 0:d[is])?void 0:a.allowDeletionWithScoresPresent)?void 0:o.courts);if(null!=u&&u.length&&!c)return tC({matchUpsCount:u.length});for(let p of u??[]){let t=iC({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:e});if(t.error)return t}return l&&(l.courts=(l.courts??[]).filter((e=>e.courtId!==i)),t||ia({payload:{venue:l,tournamentId:e.tournamentId},topic:sd,key:l.venueId})),{...Be}}function fC(e){let t,{disableNotice:i,modifications:n,courtId:r,force:a,venueMatchUps:o}=e,s=Ld(e);if(!Object.keys(s).length)return{error:qe};for(let l of Object.values(s)){let e=hC({tournamentRecord:l,disableNotice:i,venueMatchUps:o,modifications:n,courtId:r,force:a});if(null!=e&&e.error)return e;t=!0}return t?{...Be}:undefined}function hC({tournamentRecord:e,disableNotice:t,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!e)return{error:We};if(!r)return{error:pi};if(!n||"object"!=typeof n)return{error:Cn};let o=dm({tournamentRecord:e,courtId:r});if(o.error)return o;let{venue:s,court:l}=o,u=Object.keys(XR()).filter((e=>"courtId"!==e));if(!Object.keys(n).filter((e=>u.includes(e))).length)return{error:Bn};let d=u.filter((e=>!["dateAvailability"].includes(e))),c=Object.keys(n).filter((e=>d.includes(e)));if(l&&c.forEach((e=>Object.assign(l,{[e]:n[e]}))),n.dateAvailability){let o=eC({dateAvailability:n.dateAvailability,tournamentRecord:e,venueMatchUps:i,disableNotice:t,courtId:r,force:a});if(o.error)return o}return t||ia({payload:{venue:s,tournamentId:e.tournamentId},topic:sd,key:null==s?void 0:s.venueId}),{...Be,court:Wo(l)}}be(ZE,{addCourt:()=>rA,addCourts:()=>aA,addVenue:()=>om,deleteCourt:()=>pC,deleteVenue:()=>nC,deleteVenues:()=>rC,disableCourts:()=>aC,disableVenues:()=>sC,enableCourts:()=>uC,enableVenues:()=>cC,modifyCourt:()=>fC,modifyCourtAvailability:()=>eC,modifyVenue:()=>gC});var vC=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]});function gC(e){let t,i,{modifications:n,venueId:r,force:a}=e,o=Ld(e);if(!Object.keys(o).length)return{error:qe};if("string"!=typeof r)return{error:mn};for(let s of Object.values(o)){let e=IC({tournamentRecord:s,modifications:n,venueId:r,force:a});if(e.success&&(i=!0),e.error&&(t=e.error),e.error&&e.error!==pn)return e}return UD({tournamentRecords:o}),i?{...Be}:{error:t}}function IC({tournamentRecord:e,modifications:t,venueId:i,force:n}){var r,a,o,s,l,u,d,c;if(!e)return{error:We};if(!t||"object"!=typeof t)return{error:Cn};if(!i)return{error:mn};let p=null==(r=jc({tournamentRecord:e}))?void 0:r.appliedPolicies,m=n??(null==(o=null==(a=null==p?void 0:p[is])?void 0:a.allowDeletionWithScoresPresent)?void 0:o.venues),{matchUps:f}=function({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:i,venueId:n}){if(!t)return{error:We};if(!n)return{error:mn};let{schedulingProfile:r}=gD({tournamentRecord:t}),{matchUps:a}=Rf({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:i});return{matchUps:function({matchUps:e,venueId:t}){return GD({matchUps:e.filter((e=>{var i,n,r;let a=null==(n=null==(i=e.schedule)?void 0:i.allocatedCourts)?void 0:n.map((({venueId:e})=>e));return(null==(r=e.schedule)?void 0:r.venueId)===t||(null==a?void 0:a.includes(t))})),schedulingProfile:r})}({matchUps:a,venueId:n})}}({tournamentRecord:e,venueId:i}),h=lm({tournamentRecord:e,venueId:i});if(h.error)return h;let v=h.venue,g=Object.keys(vC()).filter((e=>"venueId"!==e));if(!Object.keys(t).filter((e=>g.includes(e))).length)return{error:Bn};let I=g.filter((e=>!["courts","onlineResources"].includes(e))),U=Object.keys(t).filter((e=>I.includes(e)));v&&U.forEach((e=>Object.assign(v,{[e]:t[e]})));let y=(null==(s=null==v?void 0:v.courts)?void 0:s.map((e=>e.courtId)))??[],S=(null==(l=t.courts)?void 0:l.map((e=>e.courtId)))||[],w=S.length?y.filter((e=>!S.includes(e))):(null==t?void 0:t.courts)&&y,T=[];if(null!=w&&w.length){let t=null==(d=null==(u=null==v?void 0:v.courts)?void 0:u.filter((e=>w.includes(e.courtId))))?void 0:d.map((t=>{var i;let n=XE({courtId:t.courtId,tournamentRecord:e,venueMatchUps:f});for(let e of n.matchUps??[])T.push({matchUpId:e.matchUpId,drawId:e.drawId});return(null==(i=n.matchUps)?void 0:i.length)??0})).reduce(((e,t)=>e+t));if(!v||t&&!m)return tC({matchUpsCount:t});v.courts=null==(c=v.courts)?void 0:c.filter((e=>S.includes(e.courtId))),pR({schedule:{courtId:"",scheduledDate:""},matchUpDetails:T,removePriorValues:!0,tournamentRecord:e})}if(t.courts)for(let P of t.courts){let{courtId:t}=P||{},r=fC({modifications:P,disableNotice:!0,tournamentRecord:e,venueMatchUps:f,courtId:t,force:n});if(r.error===un&&(r=rA({disableNotice:!0,tournamentRecord:e,venueId:i,court:P})),r.error)return r}return UD({tournamentRecord:e}),v&&ia({payload:{venue:v,tournamentId:e.tournamentId},topic:sd,key:null==v?void 0:v.venueId}),{...Be,venue:Wo(v)}}var UC={};function yC({scheduledMatchUps:e,showGlobalLog:t}){Vf.length=0;let i=null==e?void 0:e.reduce(((e,{structureId:t})=>e.includes(t)?e:e.concat(t)),[]),n=Array.isArray(i)&&{...i.map((t=>{let{structureName:i,matchUpType:n}=e.find((e=>e.structureId===t));return{[t]:`${i} ${n}`}}))};null==i||i.forEach((t=>{var i;Gf({color:"blue",method:"draw",structure:n[t],keyColors:{structure:"magenta"}},!0);let r=(null==(i=jd({matchUps:e.filter((e=>e.structureId===t))}))?void 0:i.roundMatchUps)||[];Object.keys(r).forEach((e=>{Gf({roundNumber:e,keyColors:{roundNumber:"brightcyan"}},!0),r[e].forEach((({matchUpId:e,schedule:t})=>{Gf({matchUpId:e,time:Eo(t.scheduledTime),date:t.scheduledDate,venue:t.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)}))}))})),t&&$f()}function SC({tournamentRecord:e}){if(!e)return{error:We};if("object"!=typeof e||!e.tournamentId)return{error:Fn};let{matchUps:t}=Rf({tournamentRecord:e,inContext:!1});if(null!=t&&t.length){let i=function({tournamentRecord:e}){let t={};for(let i of e.events||[]){i.matchUpFormat&&(t[i.eventId]=i.matchUpFormat);for(let e of i.drawDefinitions||[]){e.matchUpFormat&&(t[e.drawId]=e.matchUpFormat);for(let i of e.structures||[]){i.matchUpFormat&&(t[i.structureId]=i.matchUpFormat);for(let e of i.structures||[])e.matchUpFormat&&(t[e.structureId]=e.matchUpFormat)}}}return t}({tournamentRecord:e});!function(e,t={}){for(let i of e){let{structureId:e,drawId:n,eventId:r}=i,a=t[e]||t[n]||t[r],o=i.matchUpFormat===a?void 0:i.matchUpFormat;for(let t of Object.keys(i))wC.includes(t)||delete i[t];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,o&&(i.matchUpFormat=o)}}(t,i)}return{...Be}}be(UC,{JSON2CSV:()=>TC,UUID:()=>am,UUIDS:()=>rm,allNumeric:()=>Fr,attributeFilter:()=>po,chunkArray:()=>Or,chunkByNth:()=>Lr,chunkSizeProfile:()=>kr,constantToString:()=>Yh,countValues:()=>yr,createMap:()=>ke,dateTime:()=>qo,definedAttributes:()=>ya,dehydrateMatchUps:()=>SC,extractAttributes:()=>Gd,flattenJSON:()=>PC,generateDateRange:()=>Do,generateHashCode:()=>_e,generateRange:()=>br,generateTimeCode:()=>hA,groupValues:()=>Sr,hasAttributeValues:()=>Fe,instanceCount:()=>Ur,intersection:()=>Nr,isConvertableInteger:()=>mr,isNumeric:()=>ur,isOdd:()=>dr,isPowerOf2:()=>ar,makeDeepCopy:()=>Wo,matchUpSort:()=>Ef,nearestPowerOf2:()=>lr,nextPowerOf2:()=>cr,noNulls:()=>vr,noNumeric:()=>xr,numericSort:()=>nr,occurrences:()=>Er,overlap:()=>Ar,randomMember:()=>Dr,randomPop:()=>Pr,shuffleArray:()=>gr,structureSort:()=>xu,subSort:()=>Cr,undefinedToNull:()=>xe,unique:()=>hr,visualizeScheduledMatchUps:()=>yC});var wC=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function TC(e,t){if(t&&"object"!=typeof t)return{error:Fn};let{columnTransform:i={}}=t||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:u={},columnMap:d={},valuesMap:c={},context:p={},delimiter:m='"',columnJoiner:f=",",rowJoiner:h="\r\n",keyJoiner:v="."}=t||{};if(!Array.isArray(e)||!Array.isArray(l)||"object"!=typeof p||"object"!=typeof d||"object"!=typeof i||"object"!=typeof u||"object"!=typeof c||"string"!=typeof f||"string"!=typeof h||"string"!=typeof v||"string"!=typeof m)return{error:Fn};i=Object.assign({},...Object.keys(i).reverse().map((e=>({[e]:Array.isArray(i[e])?i[e]:["string"==typeof i[e]&&i[e]].filter(Boolean)}))));let g=e.filter(Boolean).map((e=>PC(e,v))),I=Object.values(i).flat();n&&l.push(...I);let U=g.reduce(((e,t)=>Object.keys(t).every((t=>!e.includes(t)&&e.push(t)||!0))&&e),[]).filter((e=>!(null!=l&&l.length)||l.includes(e))),y=Object.assign({},...Object.keys(i).reverse().map((e=>i[e].map((t=>({[t]:e}))).flat())).flat()),S=U.reduce(((e,t)=>{let i=y[t];return i?e.includes(i)||e.push(i):e.push(t),e}),[]).sort(((e,i)=>null!=t&&t.sortOrder?t.sortOrder.includes(e)&&t.sortOrder.includes(i)&&t.sortOrder.indexOf(e)-t.sortOrder.indexOf(i)||!t.sortOrder.includes(i)&&-1:0));Object.keys(d).forEach((e=>!S.includes(e)&&S.unshift(e))),Object.keys(i).forEach((e=>!S.includes(e)&&S.unshift(e))),"object"==typeof p&&Object.keys(p).forEach((e=>!S.includes(e)&&S.unshift(e)));let w=S.map((e=>d[e]||e));if(s)return[w];let T=e=>`${m}${e}${m}`,P=[],D=g.map((e=>Object.values(S.reduce(((t,n,r)=>{var a;let o=i[n],s=(null!=o&&o.length?e[o.find((t=>e[t]))]:e[n])||(null==p?void 0:p[n])||"",l=(null==(a=c[n])?void 0:a[s])||s,d=Ae(u[n])?u[n](l):l;return t[n]=T(d),d&&(P[r]=(P[r]||0)+1),t}),{})))),b=o&&[...P].map(((e,t)=>!e&&t)).filter(ur).reverse();if(b){let e=e=>e.filter(((e,t)=>!b.includes(t)));D=D.map(e),w=e(w)}let M=D.map((e=>e.join(f)));return a?M.map((e=>{let t=e.split(f);return Object.assign({},...t.map(((e,t)=>({[w[t]]:e}))))})):r?[w.map(T).join(f),...M].join(h):M.join(h)}function PC(e,t=".",i=[]){return"object"==typeof e&&Object.keys(e).reduce(((n,r)=>"object"!=typeof e[r]?(n[i.concat(r).join(t)]=e[r],n):Object.assign(n,PC(e[r],t,i.concat(r)))),{})}var{FACTORY:DC}=Ks;function bC({timeStamp:e}){let t=ca(),i=ta();return i&&Object.values(t).forEach((t=>{!function({tournamentRecord:e,value:t}){let{extension:i}=Ds({element:e,name:DC});fs({element:e,extension:{name:DC,value:{...null==i?void 0:i.value,...t}}})}({tournamentRecord:t,value:{version:"2.0.28",timeStamp:e}})})),i}function MC({engineType:e,methodName:t,elapsed:i,params:n,result:r}){var a,o;let s=$r();if("object"!=typeof s)return;let l={method:t},u=(null==r?void 0:r.error)&&(!0===s.errors||Array.isArray(s.errors)&&s.errors.includes(t)),d=Array.isArray(s.params)&&(null==(a=s.params)?void 0:a.includes(t)),c=s.params&&!Array.isArray(s.params)||d,p=Array.isArray(s.exclude)&&s.exclude.includes(t);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(u||c)&&(l.params=n),!p&&(u||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||d)||Array.isArray(s.result)&&null!=(o=s.result)&&o.includes(t))&&(l.result=r),Object.keys(l).length>1&&Ia(l,e)}function NC({methodName:e,params:t,start:i}){let n={error:Kn,methodName:e};return MC({result:n,methodName:e,elapsed:i?Date.now()-i:0,params:t,engineType:"sync"}),n}function RC(e,t,i,n,r){delete e.success,delete e.error;let a=Date.now(),o=ua();i&&(i.activeTournamentId=o);let s=(null==i?void 0:i.tournamentRecord)||da(o),l="object"==typeof(null==i?void 0:i.tournamentRecord)&&{[null==i?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||ca(),u=i?Wo(i,void 0,!0):void 0,d=i?function(e,t){var i;if(!1===t._middleware)return t;if(t.tournamentId&&!e[t.tournamentId])return{error:We};let n=t.drawId||(null==(i=t.matchUp)?void 0:i.drawId);if(n){let{event:i,drawDefinition:r,tournamentId:a}=hm({tournamentRecords:e,drawId:n});r&&(t.drawDefinition=r),a&&(t.tournamentId=a),i&&(t.event=i)}if(t.eventId&&!t.event){let{event:i,tournamentId:n}=hm({eventId:t.eventId,tournamentRecords:e});if(!i)return{error:Ct};t.tournamentId=n,t.event=i}let r=t.tournamentId??ua();if(!r&&t)return t;let a=e[r];return r&&!a?{error:We}:(a&&(t.tournamentRecord=a),t)}(l,i):void 0;if(null!=d&&d.error)return d;let c=function({tournamentRecords:e,tournamentRecord:t,params:i,methodName:n,method:r}){if($r())return r({tournamentRecords:e,tournamentRecord:t,...i});try{return r({tournamentRecords:e,tournamentRecord:t,...i})}catch(a){return ga({engineName:"engine",methodName:n,params:i,err:a})}}({params:d,tournamentRecords:l,tournamentRecord:s,methodName:n,method:t});return MC({result:c,methodName:n,elapsed:Date.now()-a,params:u,engineType:r}),c}function AC(e){let{mutationStatus:t,tournamentId:i,directives:n,timeStamp:r}=e||{},{topics:a}=sa();for(let o of[...a].sort(CC)){let e=ra({topic:o});null!=e&&e.length&&la({topic:o,notices:e})}t&&r&&a.includes(ld)&&la({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:ld})}var EC={[md]:5,[pd]:5,[fd]:5,[ad]:5,[rd]:5,[Xu]:5,[ed]:5,[td]:5,[id]:1,[hd]:1,[nd]:5,[sd]:5,[Zu]:4,[Ku]:4,[Ju]:4,[Qu]:4,[qu]:3,[$u]:2};function CC(e,t){return(EC[t]||0)-(EC[e]||0)}function OC(e,t=!0){return"object"!=typeof e||Array.isArray(e)?{error:Cn}:null!=e&&e.tournamentId?pa(t?Wo(e):e):{error:Fn}}function kC(e,t=!0){if("object"!=typeof e)return{error:Cn};if(fa(),Array.isArray(e)){if(e.filter((e=>null==e?void 0:e.tournamentId)).length!==e.length)return{error:$e};e=Object.assign({},...e.map((e=>({[e.tournamentId]:e}))))}else if(null!=e&&e.tournamentId)fa((e={[e.tournamentId]:e}).tournamentId);else if(!Object.keys(e).every((t=>e[t].tournamentId===t)))return{error:$e};return ma(t?Wo(e):e)}function FC(e,t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function xC(e,t){e.importMethods=(i,n,r,a)=>function(e,t,i,n,r,a){let o=Ua(i,n,r,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter((e=>Ae(s[e]))).forEach((i=>{e[i]=n=>{let r=()=>t(e,{[i]:s[i],...n});if($r())return r();try{return r()}catch(a){ga({engineName:"engine",methodName:i,params:n,err:a})}}})),{...Be,...e}}(e,t,i,n,r,a),e.getTournament=e=>function(e){let{convertExtensions:t=!1,removeExtensions:i=!1}=e??{},n=(null==e?void 0:e.tournamentId)??ua();return"string"!=typeof n?{}:{tournamentRecord:Wo(da(n),t,!1,i)}}(e),e.getState=e=>function({convertExtensions:e,removeExtensions:t}){let i=ca();return{tournamentId:ua(),tournamentRecords:Wo(i,e,!1,t)}}({convertExtensions:null==e?void 0:e.convertExtensions,removeExtensions:null==e?void 0:e.removeExtensions}),e.version=()=>"2.0.28",e.reset=()=>(ma({}),FC(e)),e.devContext=t=>(Hr(t),FC(e)),e.getDevContext=e=>$r(e),e.newTournamentRecord=(e={})=>{let t=UR(e),i=t.tournamentId;return t.error?t:(OC(t),fa(i),{...Be,tournamentId:i})},e.setState=(t,i,n)=>{Kr(i,n);let r=kC(t,i);return FC(e,r)},e.setTournamentId=e=>fa(e),e.getTournamentId=()=>ua(),e.setTournamentRecord=(t,i,n)=>{Kr(i,n);let r=OC(t,i);return FC(e,r)},e.removeTournamentRecord=t=>{let i=ha(t);return FC(e,i)},e.removeUnlinkedTournamentRecords=()=>{let t=function(){var e;let t=ca(),{extension:i}=Ds({name:_s,tournamentRecords:t,discover:!0}),n=(null==(e=null==i?void 0:i.value)?void 0:e.tournamentIds)||[];return Object.keys(t).forEach((e=>{n.includes(e)||delete t[e]})),ma(t)}();return FC(e,t)}}function LC(e,t){if(!Ce(t))return{error:Fn,message:"args must be an object"};let i=Object.values(t).filter(Ae).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Fn};let n=i?Object.keys(t).find((e=>Ae(t[e]))):Ee(t.method)&&t.method;if(!n)return{error:Kn};let{[n]:r,...a}=t,o=null!=t&&t.params?{...t.params}:{...a},s=o.rollbackOnError&&Wo(ca(),!1,!0),l=r||e[n]||ir()[n];if(!l)return NC({methodName:n,params:o});let u=RC(e,l,o,n,"sync")??{};null!=u&&u.error&&s&&kC(s);let d=Date.now(),c=bC({timeStamp:d}),p=(null==u?void 0:u.success)&&!0!==(null==o?void 0:o.delayNotify)&&!0!==(null==o?void 0:o.doNotNotify);return p&&AC({directives:[{method:l,params:o}],mutationStatus:c,timeStamp:d}),(p||!(null!=u&&u.success)||null!=o&&o.doNotNotify)&&oa(),u}var _C=(()=>{let e={executionQueue:(t,i)=>function(e,t,i){if(!Array.isArray(t))return{error:Fn,message:"directives must be an array"};let n=na(),r=Date.now(),a=i&&Wo(ca(),!1,!0),o=[];for(let l of t){if("object"!=typeof l)return{error:Fn,message:"directive must be an object"};if(l.params&&"object"!=typeof l.params)return{error:Fn,message:"params must be an object"};let{method:t,pipe:i}=l,s=l.params?{...l.params}:{};if(!n[t])return NC({methodName:t,start:r,params:s});if(i){let e=o[o.length-1],t=Object.keys(i);for(let i of t)e[i]&&(s[i]=e[i])}let u=RC(e,n[t],s,t,"sync");if(null!=u&&u.error)return a&&kC(a),{...u,rolledBack:!!a};o.push({...u,methodName:t})}let s=Date.now();return AC({directives:t,mutationStatus:bC({timeStamp:s}),timeStamp:s}),oa(),{success:o.every((e=>e.success)),results:o}}(e,t,i),execute:t=>LC(e,t)};return xC(e,LC),e})(),BC=_C;function jC(e,t){if(!Ce(t))return{error:Fn,message:"args must be an object"};let i=Object.values(t).filter(Ae).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Fn};let n=i?Object.keys(t).find((e=>Ae(t[e]))):Ee(t.method)&&t.method;if(!n)return{error:Kn};let{[n]:r,...a}=t,o=null!=t&&t.params?{...t.params}:{...a},s=r||e[n]||ir()[n];return s?RC(e,s,o,n,"ask"):NC({methodName:n,params:o})}(()=>{let e={execute:t=>jC(e,t)};xC(e,jC)})();var VC,GC={};function $C(e,t=!0){if(!e)return{error:mi};if("object"!=typeof e)return{error:Cn};if(e.matchUpId)VC=e.matchUpId,GC[VC]=t?Wo(e):e;else if(Array.isArray(e))for(let i of e.reverse())i.matchUpId&&(GC[i.matchUpId]=t?Wo(i):i,VC||(VC=i.matchUpId));else for(let i of Object.values(e))i.matchUpId&&(GC[i.matchUpId]=t?Wo(i):i,VC||(VC=i.matchUpId));return t?Wo(e):e}(()=>{let e={getState:e=>function(e){return Wo(GC[VC],null==e?void 0:e.convertExtensions,!1,null==e?void 0:e.removeExtensions)}(e),version:()=>"2.0.28",reset:()=>(VC=void 0,GC={},{...Be}),drawId:void 0,error:void 0,success:!1,devContext:t=>(Hr(t),e),setState:(t,i,n)=>(Kr(i,n),function(t){return null!=t&&t.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,e.drawId=t.drawId),e}($C(t)))};return[NS].forEach((i=>{Object.keys(i).forEach((n=>{e[n]=e=>{if($r())return t({params:e,governor:i,methodName:n});try{return t({params:e,governor:i,methodName:n})}catch(r){ga({engineName:"matchUpEngine",methodName:n,params:e,err:r})}}}))})),e;function t({params:t,governor:i,methodName:n}){e.error=void 0,e.success=!1;let r=(null==t?void 0:t.matchUp)||GC[VC],a=(null==t?void 0:t.matchUps)||Object.values(GC),o=(null==t?void 0:t.rollbackOnError)&&Wo(r,!1,!0);t={...t,matchUpId:null==r?void 0:r.matchUpId,matchUps:a,matchUp:r};let s=i[n](t);if(null!=s&&s.error)return o&&$C(o),{...s,rolledBack:!!o};let l=(null==s?void 0:s.success)&&!0!==(null==t?void 0:t.delayNotify)&&!0!==(null==t?void 0:t.doNotNotify);return l&&AC(),(l||!(null!=s&&s.success)||null!=t&&t.doNotNotify)&&oa(),s}})();var qC=!1;(()=>{let e={version:()=>"2.0.28",setDeepCopy:(t,i)=>(Kr(t,i),e),devContext:t=>(Hr(t),qC=!0,e)};[HN].forEach((t=>{Object.keys(t).forEach((i=>{e[i]=e=>{try{let n=function(e,t){let i=e({...t});return null!=i&&i.error||AC(),oa(),qC&&(Hr(!1),qC=!1),i}(t[i],e);return!(null!=n&&n.error)&&null!=e&&e.setState&&null!=n&&n.tournamentRecord&&kC(n.tournamentRecord),n}catch(n){let t;"string"==typeof n?t=n.toUpperCase():n instanceof Error&&(t=n.message),console.log("ERROR",{params:JSON.stringify(e),method:i,error:t})}}}))}))})(),BC.importMethods(Me,!0,1);var WC=BC;function HC(e,t){return e&&t&&Array.isArray(t)&&t[e-1]||"object"==typeof t&&t[e]}function zC(e){let{participation:t={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:o,category:s,endDate:l,level:u}=e,{participationOrder:d,flightNumber:c,rankingStage:p}=t;return{awardProfile:i.find((e=>{var t,i,m,f,h,v,g,I,U,y;return(e=>!n&&!l||!e.dateRanges||e.dateRanges.some((e=>{let t=!n||!e.startDate||new Date(n)>new Date(e.startDate),i=!l||!e.endDate||new Date(l)<=new Date(e.endDate);return t&&i})))(e)&&(!e.maxFlightNumber||c<=e.maxFlightNumber)&&(!(null!=(t=e.drawTypes)&&t.length)||(null==(i=e.drawTypes)?void 0:i.includes(o)))&&(!(null!=(m=e.drawSizes)&&m.length)||e.drawSizes.includes(a))&&(!(null!=(f=e.stages)&&f.length)||e.stages.includes(p))&&(!(null!=(h=e.levels)&&h.length)||e.levels.includes(u))&&(!e.maxDrawSize||a<=e.maxDrawSize)&&(!e.drawSize||e.drawSize===a)&&(!e.maxLevel||u<=e.maxLevel)&&(!c||!(null!=(g=null==(v=e.flights)?void 0:v.flightNumbers)&&g.length)||e.flights.flightNumbers.includes(c))&&(!e.participationOrder||e.participationOrder===d)&&(!(null!=(I=e.category)&&I.ageCategoryCodes)||e.category.ageCategoryCodes.includes(null==s?void 0:s.ageCategoryCode))&&(!(null!=(U=e.eventTypes)&&U.length)||(null==(y=e.eventTypes)?void 0:y.includes(r)))}))}}function YC({participantWon:e,flightNumber:t,valueObj:i,drawSize:n,flights:r,level:a}){var o,s;let l,u,d,c,p=(e,t)=>{if(e){if(Array.isArray(t)){let i=t.find((t=>t.flight===e||t.f===e));return i.value||i.v}if("object"==typeof t){let i=t.flights||t.f;if(Array.isArray(i))return i[e-1]}}},m=(e,t)=>{let i=(null==e?void 0:e.value)||(null==e?void 0:e.v)||(mr(e)?e:0),n=HC(a,null==e?void 0:e.level);return{value:p(t,n)||mr(n)&&n||i}},f=0,h=(e?"won":!1===e&&"lost")||void 0;if(Array.isArray(i)){let e=i.find((e=>{var t;return e.drawSize===n||(null==(t=e.drawSizes)?void 0:t.includes(n))})),r=i.find((e=>e.drawSize&&e.threshold&&n>e.drawSize)),a=i.find((e=>{var t;return!(e.drawSize||null!=(t=e.drawSizes)&&t.length)}));void 0!==h&&(e=null==e?void 0:e[h],r=null==r?void 0:r[h],a=null==a?void 0:a[h]),u=m(e,t).value,d=m(r,t).value,c=m(a,t).value,f=u||d||c,l=u&&e.requireWin||d&&r.requireWin||(null==a?void 0:a.requireWin)}else if("object"==typeof i){let e=null==(o=null==i?void 0:i.drawSizes)?void 0:o[n],r=i;void 0!==h&&(e=null==e?void 0:e[h],r=null==r?void 0:r[h]),u=m(e,t).value,c=m(r,t).value,f=u||c,l=u?e.requireWin:null==r?void 0:r.requireWin}else mr(i)&&void 0===h&&(f=i);return t&&null!=(s=null==r?void 0:r.pct)&&s[t]&&(f=Math.round(f*r.pct[t])),{awardPoints:f,requireWin:l}}var KC={getTournamentPoints:function({participantFilters:e,policyDefinitions:t,tournamentRecord:i,level:n}){var r;if(!i)return{error:We};let{policyDefinitions:a}=Vc({policyTypes:[Zo],tournamentRecord:i}),o=(null==t?void 0:t[Zo])??(null==a?void 0:a[Zo]);if(!o)return{error:ri};let s=o.awardProfiles,l=o.requireWinFirstRound,u=o.requireWinForPoints,{participants:d,derivedEventInfo:c,derivedDrawInfo:p,mappedMatchUps:m}=vh({withRankingProfile:!0,participantFilters:e,tournamentRecord:i}),f=null==d?void 0:d.filter((e=>{var t;return null==(t=e.draws)?void 0:t.length})),h={},v={},g={};for(let I of f??[]){let{participantType:e,participantId:t,person:a,draws:o}=I;for(let d of o){let o,{drawId:f,structureParticipation:U,eventId:y}=d,S=c[y],w=p[f],T=null==w?void 0:w.drawType,{category:P,eventType:D}=S||{},b=d.startDate||S.startDate||i.startDate,M=d.endDate||S.endDate||i.endDate;if((D!==qp||t===Jd)&&s){let i,d=u,c=0,p=0,y=0;for(let a of U){let{finishingPositionRange:u,participationOrder:f,participantWon:h,flightNumber:v,rankingStage:g,winCount:U}=a;c+=U||0;let S=null==w?void 0:w.drawSize,{awardProfile:N}=zC({awardProfiles:s,participation:a,eventType:D,startDate:b,category:P,drawSize:S,drawType:T,endDate:M,level:n});if(N){if(!S)continue;let e=Array.isArray(u)&&Math.max(...u),t=hr(u||[]).join("-"),a=e&&g!==Ll&&(null==u?void 0:u.includes(S));void 0!==N.requireWinForPoints&&(d=N.requireWinForPoints),void 0!==N.requireWinFirstRound&&(l=N.requireWinFirstRound);let o,{finishingPositionPoints:s={},finishingPositionRanges:c,finishingRound:m,pointsPerWin:I,flights:w}=N,T=Array.isArray(N.perWinPoints)?null==(r=N.perWinPoints)?void 0:r.find((e=>{var t;return null==(t=e.participationOrders)?void 0:t.includes(f)})):N.perWinPoints,P=s.participationOrders,D=0;if((!P||P.includes(f))&&c&&e){let t=c[e];t&&({awardPoints:D,requireWin:o}=YC({flightNumber:v,valueObj:t,drawSize:S,flights:w,level:n}))}if(!D&&m&&1===f&&e){let t=m[e];t&&({awardPoints:D,requireWin:o}=YC({participantWon:h,flightNumber:v,valueObj:t,drawSize:S,flights:w,level:n}))}if(a&&void 0!==l&&(d=l),void 0!==o&&(d=o),D>p&&(!d||U)&&(p=D,i=e),!D&&I&&U&&(y+=U*I,i=t),!D&&U&&T){let e=HC(n,null==T?void 0:T.level);e?y+=U*e:T.value&&(y+=U*T.value)}}if(o=p+y,e===Jd){let e=(I.matchUps||[]).filter((({structureId:e})=>e===a.structureId));for(let{matchUpId:i}of e){let e=m[i],n=e.sides.find((e=>e.participantId===t)).sideNumber;if(e.winningSice===n)for(let t of e.tieMatchUps)t.winningSide}}}if(y||p){let n={winCount:c,positionPoints:p,rangeAccessor:i,perWinPoints:y,eventType:D,drawId:f,points:o},r=null==a?void 0:a.personId;r?(h[r]||(h[r]=[]),h[r].push(n)):e===Xd?(g[t]||(g[t]=[]),g[t].push(n)):e===Jd&&(v[t]||(v[t]=[]),v[t].push(n))}}}}return{participantsWithOutcomes:f,personPoints:h,pairPoints:g,teamPoints:v,...Be}}},JC={...KC,...{calculateNewRatings:mS,generateDynamicRatings:hS}};BC.importMethods(JC);var QC={ratingsParameters:cS,matchUpFormats:lI,countryToFlag:pf,tieFormats:cM,countries:mf,policies:{POLICY_AVOIDANCE_COUNTRY:{[ns]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},POLICY_POSITION_ACTIONS_DEFAULT:cy,POLICY_POSITION_ACTIONS_DISABLED:{[Jo]:{policyName:"positionActionsDisabled",enabledStructures:!1}},POLICY_POSITION_ACTIONS_NO_MOVEMENT:{[Jo]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[oy,ay,sy],disabledActions:[]}]}},POLICY_POSITION_ACTIONS_UNRESTRICTED:{[Jo]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[oy,ny]}},POLICY_PRIVACY_DEFAULT:{[es]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},POLICY_ROUND_NAMING_DEFAULT:Rm,POLICY_SCHEDULING_DEFAULT:FD,POLICY_SCORING_DEFAULT:{[rs]:{defaultMatchUpFormat:oI,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[xl]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},POLICY_SCORING_USTA:{[rs]:{requireAllPositionsAssigned:!1,stage:{[xl]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:oI,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:oI,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},POLICY_SEEDING_ITF:{[as]:{seedingProfile:{positioning:zl},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},POLICY_SEEDING_DEFAULT:DP},flagIOC:function(e){return pf(Object.assign({},...mf.filter((e=>e.ioc)).map((e=>({[e.ioc]:e.iso}))))[e])}};be({},{activeMatchUpStatuses:()=>Ol,auditConstants:()=>Bb,completedMatchUpStatuses:()=>Cl,directingMatchUpStatuses:()=>Al,drawDefinitionConstants:()=>ku,entryStatusConstants:()=>Pc,errorConditionConstants:()=>Zn,eventConstants:()=>Wp,extensionConstants:()=>Ks,flightConstants:()=>vM,genderConstants:()=>Qm,keyValueConstants:()=>Ow,matchUpActionConstants:()=>Fy,matchUpStatusConstants:()=>Fl,matchUpTypes:()=>Fd,nonDirectingMatchUpStatuses:()=>El,particicipantsRequiredMatchUpStatuses:()=>Nl,participantConstants:()=>ic,participantRoles:()=>xh,participantTypes:()=>tc,penaltyConstants:()=>ZC,policyConstants:()=>ls,positionActionConstants:()=>uy,ratingConstants:()=>dS,recoveryTimeRequiredMatchUpStatuses:()=>Ml,requestConstants:()=>tR,resultConstants:()=>je,scaleConstants:()=>uo,scheduleConstants:()=>_p,sortingConstants:()=>yM,surfaceConstants:()=>XC,tieFormatConstants:()=>rP,timeItemConstants:()=>Up,topicConstants:()=>vd,tournamentConstants:()=>VE,upcomingMatchUpStatuses:()=>kl,validMatchUpStatuses:()=>Rl,venueConstants:()=>eO});var ZC={COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},XC={CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},eO={INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"};const tO=Z({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function iO({individualParticipant:e,composition:t,className:i,matchUp:n,spacer:r,side:a,type:o}){if("scale"===o)return function({individualParticipant:e,composition:t,className:i,matchUp:n,spacer:r}){var a,o,s,l,u,d,c;const p=null==t?void 0:t.configuration,m=(null==(a=null==p?void 0:p.scaleAttributes)?void 0:a.eventType)||(null==n?void 0:n.matchUpType)||"SINGLES",f=null==e?void 0:e.rankings,h=null==e?void 0:e.ratings,v=null==p?void 0:p.scaleAttributes,g=null==v?void 0:v.scaleType,I=null==v?void 0:v.scaleName,U=null==v?void 0:v.accessor,y="RATING"===g?h:f,S=null==(s=null==(o=null==y?void 0:y.SINGLES)?void 0:o.find((e=>(null==e?void 0:e.scaleName)===I)))?void 0:s.scaleValue,w=null==(u=null==(l=null==y?void 0:y.DOUBLES)?void 0:l.find((e=>(null==e?void 0:e.scaleName)===I)))?void 0:u.scaleValue,T=S&&U?S[U]:S||"",P=w&&U?w[U]:w||"",D="SINGLES"===m?T:P,b=null==(d=null==p?void 0:p.scaleAttributes)?void 0:d.fallback,M=!r&&(D||b&&(T||P)),N=document.createElement("span");return M&&(N.className=oe(i,Pe({color:null==(c=null==p?void 0:p.scaleAttributes)?void 0:c.scaleColor}))),N.innerHTML=M||"",N}({individualParticipant:e,composition:t,className:i,matchUp:n,spacer:r});const s=(null==t?void 0:t.configuration)||{},l=document.createElement("div");return"flag"===o&&s.flags&&function({matchUp:e,individualParticipant:t,spacer:i}){var n,r,a;const o=(null==(n=null==t?void 0:t.person)?void 0:n.iso2NationalityCode)||"",s=o?null==(r=QC.countryToFlag(o))?void 0:r.slice(0,4):"",l=document.createElement("span"),u=null==(a=null==e?void 0:e.matchUpType)?void 0:a.toLowerCase();return i||(l.className=tO({variant:u})),l.innerHTML=i?"":s,l}({className:i,matchUp:n,individualParticipant:e,spacer:r})||"seeding"===o&&function({className:e,composition:t,side:i}){const n=(null==i?void 0:i.seedValue)||(null==i?void 0:i.seedNumber);if(!n)return"";const r=(null==t?void 0:t.configuration)||{},{bracketedSeeds:a}=r,o="boolean"==typeof a&&["(",")"]||"square"===a&&["[","]"]||["",""],s=`${o[0]}${n}${o[1]}`,l="sup"===r.seedingElement?"sup":"span",u=document.createElement(l);return u.className=e,u.innerHTML=s,u}({className:i,composition:t,matchUp:n,side:a})||l}const nO="Qualifier",rO="BYE",aO="TBD";function oO(e){var t,i,n,r;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:u,composition:d}=e||{},c=a?"winner":void 0,p=e.eventHandlers||{},m=null==d?void 0:d.configuration,f={QUALIFIER:(null==(t=null==m?void 0:m.placeHolders)?void 0:t.qualifier)||nO,BYE:(null==(i=null==m?void 0:m.placeHolders)?void 0:i.bye)||rO,TBD:(null==(n=null==m?void 0:m.placeHolders)?void 0:n.tbd)||aO},h=null==l?void 0:l.participantName,v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",null==l?void 0:l.participantId),v.onclick=e=>{ve(null==p?void 0:p.participantClick)&&(e.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:e,matchUp:u,side:o}))};const g=document.createElement("div");g.className=X({variant:c});const I=(null==m?void 0:m.flags)&&iO({...e,type:"flag"});if(I)g.appendChild(I);else{const t=iO({type:"scale",...e});t&&g.appendChild(t)}const U=document.createElement("div");if(U.className=ee({variant:c}),h){const e=document.createElement("span");if(a&&null!=m&&m.winnerColor)e.style.color="string"==typeof m.winnerColor?m.winnerColor:"green";else if(null!=m&&m.genderColor){const t=null==(r=null==l?void 0:l.person)?void 0:r.sex,i=("MALE"===t?"#2E86C1":"FEMALE"===t&&"#AA336A")||"";e.style.color="string"==typeof m.genderColor?m.genderColor:i}e.innerHTML=h,U.appendChild(e)}else{const e=document.createElement("abbr");e.className=function({variant:e}){return Z({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:e})}({variant:m.showAddress?"showAddress":""}),e.innerHTML=(null==o?void 0:o.bye)&&f.BYE||(null==o?void 0:o.qualifier)&&f.QUALIFIER||f.TBD,U.appendChild(e)}const y=iO({...e,className:Te(),type:"seeding"});y&&U.appendChild(y),g.appendChild(U),v.appendChild(g);const S=we(e);return v.appendChild(S),{element:v}}const sO=Z({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});const lO=Z({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});const uO=Z({flexDirection:"column",position:"relative",display:"flex"}),dO=Z({alignItems:"stretch",display:"flex"}),cO=Z({marginInlineEnd:".25rem",color:"green"});function pO({initialRoundNumber:e=1,eventHandlers:t,sideContainer:i,composition:n,participant:r,placeholder:a,sideNumber:o,matchUp:s}){var l,u,d;const{winningSide:c,matchUpType:p,isRoundRobin:m,matchUpStatus:f}=s||{},h=null==n?void 0:n.configuration;let v;const g=o?null==(l=null==s?void 0:s.sides)?void 0:l.find((e=>e.sideNumber===o)):void 0;r||(r=null==g?void 0:g.participant,v=null!=h&&h.allDrawPositions||null!=h&&h.drawPositions&&null!=g&&g.drawPosition&&((null==s?void 0:s.roundNumber)===e||null!=g&&g.participantFed||m)?null==g?void 0:g.drawPosition:"");const I="DOUBLES"===p,U=I?null==(u=null==r?void 0:r.individualParticipants)?void 0:u[0]:r,y=I&&(null==(d=null==r?void 0:r.individualParticipants)?void 0:d[1]),S=o===c||"BYE"===f&&r,w=(null==h?void 0:h.winnerChevron)&&S,T=null==h?void 0:h.teamLogo,P=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(f)&&!S,D=null==h?void 0:h.gameScoreOnly,b=document.createElement("div");if(b.className=i&&function({drawPosition:e,sideNumber:t}){return Z({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:t,css:e&&{"&:before":{backgroundColor:"$backgroundColor",content:`${e}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}({drawPosition:v,sideNumber:o}),b.classList.add("tmx-p"),b.setAttribute("id",null==r?void 0:r.participantId),T){const e=function({teamLogo:e}){console.log({teamLogo:e});const t=document.createElement("div");return t.className=lO(),t}({teamLogo:T});b.appendChild(e)}const M=document.createElement("div");M.className=te({variant:I?"doubles":"singles"});const N=document.createElement("div");N.className=function({winnerChevron:e,isDoubles:t}){const i=2*(t?.4:.3);return Z({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:e?"winner":void 0})}({winnerChevron:w,isDoubles:I});const R=oO({individualParticipant:U,eventHandlers:t,isWinningSide:S,composition:n,sideNumber:o,matchUp:s,side:g}).element;if(N.appendChild(R),y){const e=oO({individualParticipant:y,eventHandlers:t,isWinningSide:S,composition:n,sideNumber:o,matchUp:s,side:g}).element;N.appendChild(e)}else I&&a&&function(e){return e instanceof Element||e}(a)&&N.appendChild(a);if(M.appendChild(N),b.appendChild(M),i){const e=document.createElement("div");if(S&&!D){const t=function({dim:e="20px"}={}){return`\n    <div style="line-height: 0;">\n      <svg height="${e}" viewBox="0 0 18 24" width="${e}" xmlns="http://www.w3.org/2000/svg" class="${cO()}" style="fill: currentcolor;">\n        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>\n      </svg>\n    </div>\n  `}();"string"==typeof t?e.innerHTML=t:e.appendChild(t)}else if(P){const t=function({matchUpStatus:e}){const t=null==e?void 0:e.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(e)?"WO":(null==e?void 0:e.slice(0,3))||"",n=document.createElement("div");n.className=sO({variant:t});const r=document.createElement("abbr");return r.setAttribute("title",e),r.style.textDecoration="none",r.style.borderBottom="none",r.innerHTML=i,n.appendChild(r),n}({matchUpStatus:f});e.appendChild(t)}b.appendChild(e)}return b}const mO=Z({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",width:"460px",height:"1.5em"});const fO=Z({flexDirection:"column",display:"flex"}),hO=Z({flexDirection:"row",display:"flex"}),vO=Z({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",width:"460px",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),gO=Z({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),IO=Z({fontWeight:"bold",color:"blue",height:"1em"}),UO=Z({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),yO=Z({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});const SO=Z({});const wO=Z({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),TO=Z({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),PO=Z({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function DO({eventHandlers:e,entryStatus:t,sideNumber:i,className:n,matchUp:r}){const a=document.createElement("div");ve(null==e?void 0:e.centerInfoClick)&&(a.onclick=t=>e.centerInfoClick({matchUp:r,sideNumber:i,pointerEvent:t})),a.className=oe(function({variant:e}){return Z({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:e})}({variant:i}),n),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=wO();const s=document.createElement("div");s.className=TO();const l=document.createElement("div");l.className=PO(),l.innerHTML=t?"Entry status:&nbsp;":"",s.appendChild(l);const u=document.createElement("div");return u.className=PO(),u.innerHTML=t||"",s.appendChild(u),o.appendChild(s),a.appendChild(o),{element:a}}const bO={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};const MO=e=>Z({display:"flex",alignItems:"center",height:e,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),NO=Z({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),RO=Z({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),AO=Z({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function EO({gameScoreOnly:e,scoreStripes:t,set:i,sideNumber:n}){const r=n===(null==i?void 0:i.winningSide)||null!=i&&i.winningSide?"loser":void 0,a=2===n?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=2===n?i.side2TiebreakScore:i.side1TiebreakScore,l=void 0===a&&s,u=l||a,d=t&&i.setNumber%2?"lightgray":"transparent";let c;if(i.editing?i.editing===n:void 0)c=function({value:e}={}){const t=document.createElement("input");return t.onclick=e=>e.target.select(),t.className=RO(),t.value=e,t}({value:u});else if(c=document.createElement("p"),c.className=RO({variant:r}),c.classList.add("tmx-st"),c.setAttribute("setNumber",i.setNumber),c.style.backgroundColor=d,c.innerHTML=isNaN(u)?"":u,!e){const e=document.createElement("span");e.className=NO(),e.innerHTML=o&&!l?s:"",c.appendChild(e)}return c}const CO=Z({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var OO={exports:{}};!function(e,t){e.exports=function(){var e=1e3,t=6e4,i=36e5,n="millisecond",r="second",a="minute",o="hour",s="day",l="week",u="month",d="quarter",c="year",p="date",m="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,v={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],i=e%100;return"["+e+(t[(i-20)%10]||t[i]||t[0])+"]"}},g=function(e,t,i){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(i)+e},I={s:g,z:function(e){var t=-e.utcOffset(),i=Math.abs(t),n=Math.floor(i/60),r=i%60;return(t<=0?"+":"-")+g(n,2,"0")+":"+g(r,2,"0")},m:function e(t,i){if(t.date()<i.date())return-e(i,t);var n=12*(i.year()-t.year())+(i.month()-t.month()),r=t.clone().add(n,u),a=i-r<0,o=t.clone().add(n+(a?-1:1),u);return+(-(n+(i-r)/(a?r-o:o-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:c,w:l,d:s,D:p,h:o,m:a,s:r,ms:n,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},U="en",y={};y[U]=v;var S="$isDayjsObject",w=function(e){return e instanceof b||!(!e||!e[S])},T=function e(t,i,n){var r;if(!t)return U;if("string"==typeof t){var a=t.toLowerCase();y[a]&&(r=a),i&&(y[a]=i,r=a);var o=t.split("-");if(!r&&o.length>1)return e(o[0])}else{var s=t.name;y[s]=t,r=s}return!n&&r&&(U=r),r||!n&&U},P=function(e,t){if(w(e))return e.clone();var i="object"==typeof t?t:{};return i.date=e,i.args=arguments,new b(i)},D=I;D.l=T,D.i=w,D.w=function(e,t){return P(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var b=function(){function v(e){this.$L=T(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[S]=!0}var g=v.prototype;return g.parse=function(e){this.$d=function(e){var t=e.date,i=e.utc;if(null===t)return new Date(NaN);if(D.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(f);if(n){var r=n[2]-1||0,a=(n[7]||"0").substring(0,3);return i?new Date(Date.UTC(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)):new Date(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)}}return new Date(t)}(e),this.init()},g.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},g.$utils=function(){return D},g.isValid=function(){return this.$d.toString()!==m},g.isSame=function(e,t){var i=P(e);return this.startOf(t)<=i&&i<=this.endOf(t)},g.isAfter=function(e,t){return P(e)<this.startOf(t)},g.isBefore=function(e,t){return this.endOf(t)<P(e)},g.$g=function(e,t,i){return D.u(e)?this[t]:this.set(i,e)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(e,t){var i=this,n=!!D.u(t)||t,d=D.p(e),m=function(e,t){var r=D.w(i.$u?Date.UTC(i.$y,t,e):new Date(i.$y,t,e),i);return n?r:r.endOf(s)},f=function(e,t){return D.w(i.toDate()[e].apply(i.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),i)},h=this.$W,v=this.$M,g=this.$D,I="set"+(this.$u?"UTC":"");switch(d){case c:return n?m(1,0):m(31,11);case u:return n?m(1,v):m(0,v+1);case l:var U=this.$locale().weekStart||0,y=(h<U?h+7:h)-U;return m(n?g-y:g+(6-y),v);case s:case p:return f(I+"Hours",0);case o:return f(I+"Minutes",1);case a:return f(I+"Seconds",2);case r:return f(I+"Milliseconds",3);default:return this.clone()}},g.endOf=function(e){return this.startOf(e,!1)},g.$set=function(e,t){var i,l=D.p(e),d="set"+(this.$u?"UTC":""),m=(i={},i[s]=d+"Date",i[p]=d+"Date",i[u]=d+"Month",i[c]=d+"FullYear",i[o]=d+"Hours",i[a]=d+"Minutes",i[r]=d+"Seconds",i[n]=d+"Milliseconds",i)[l],f=l===s?this.$D+(t-this.$W):t;if(l===u||l===c){var h=this.clone().set(p,1);h.$d[m](f),h.init(),this.$d=h.set(p,Math.min(this.$D,h.daysInMonth())).$d}else m&&this.$d[m](f);return this.init(),this},g.set=function(e,t){return this.clone().$set(e,t)},g.get=function(e){return this[D.p(e)]()},g.add=function(n,d){var p,m=this;n=Number(n);var f=D.p(d),h=function(e){var t=P(m);return D.w(t.date(t.date()+Math.round(e*n)),m)};if(f===u)return this.set(u,this.$M+n);if(f===c)return this.set(c,this.$y+n);if(f===s)return h(1);if(f===l)return h(7);var v=(p={},p[a]=t,p[o]=i,p[r]=e,p)[f]||1,g=this.$d.getTime()+n*v;return D.w(g,this)},g.subtract=function(e,t){return this.add(-1*e,t)},g.format=function(e){var t=this,i=this.$locale();if(!this.isValid())return i.invalidDate||m;var n=e||"YYYY-MM-DDTHH:mm:ssZ",r=D.z(this),a=this.$H,o=this.$m,s=this.$M,l=i.weekdays,u=i.months,d=i.meridiem,c=function(e,i,r,a){return e&&(e[i]||e(t,n))||r[i].slice(0,a)},p=function(e){return D.s(a%12||12,e,"0")},f=d||function(e,t,i){var n=e<12?"AM":"PM";return i?n.toLowerCase():n};return n.replace(h,(function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return D.s(t.$y,4,"0");case"M":return s+1;case"MM":return D.s(s+1,2,"0");case"MMM":return c(i.monthsShort,s,u,3);case"MMMM":return c(u,s);case"D":return t.$D;case"DD":return D.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return c(i.weekdaysMin,t.$W,l,2);case"ddd":return c(i.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(a);case"HH":return D.s(a,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return f(a,o,!0);case"A":return f(a,o,!1);case"m":return String(o);case"mm":return D.s(o,2,"0");case"s":return String(t.$s);case"ss":return D.s(t.$s,2,"0");case"SSS":return D.s(t.$ms,3,"0");case"Z":return r}return null}(e)||r.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(n,p,m){var f,h=this,v=D.p(p),g=P(n),I=(g.utcOffset()-this.utcOffset())*t,U=this-g,y=function(){return D.m(h,g)};switch(v){case c:f=y()/12;break;case u:f=y();break;case d:f=y()/3;break;case l:f=(U-I)/6048e5;break;case s:f=(U-I)/864e5;break;case o:f=U/i;break;case a:f=U/t;break;case r:f=U/e;break;default:f=U}return m?f:D.a(f)},g.daysInMonth=function(){return this.endOf(u).$D},g.$locale=function(){return y[this.$L]},g.locale=function(e,t){if(!e)return this.$L;var i=this.clone(),n=T(e,t,!0);return n&&(i.$L=n),i},g.clone=function(){return D.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},v}(),M=b.prototype;return P.prototype=M,[["$ms",n],["$s",r],["$m",a],["$H",o],["$W",s],["$M",u],["$y",c],["$D",p]].forEach((function(e){M[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),P.extend=function(e,t){return e.$i||(e(t,b,P),e.$i=!0),P},P.locale=T,P.isDayjs=w,P.unix=function(e){return P(1e3*e)},P.en=y[U],P.Ls=y,P.p={},P}()}(OO);const kO=ne(OO.exports);function FO({initialRoundNumber:e=1,eventHandlers:t,composition:i,sideNumber:n,className:r,matchUp:a}){var o,s;const l=(null==i?void 0:i.configuration)||{},u=null==l?void 0:l.scheduleInfo,d=null==(o=null==a?void 0:a.score)?void 0:o.scoreStringSide1,c=(null==(s=null==i?void 0:i.configuration)?void 0:s.scoreBox)&&d,p=(null==a?void 0:a.readyToScore)&&(null==t?void 0:t.scoreClick)&&!WC.checkScoreHasValue({matchUp:a}),m=document.createElement("div");if(m.className=oe(uO(),r),m.classList.add("tmx-sd"),m.setAttribute("sideNumber",n),u&&1===n){const e=function({matchUp:e,eventHandlers:t}){const{scheduledTime:i,scheduledDate:n,venueAbbreviation:r,courtName:a}=(null==e?void 0:e.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=UC,l=s(i);let u=o(n),d="ddd D MMMM";l&&(d+=", hh:mm A",u+=`T${l}`);const c=n?kO(u).format(d):"Not scheduled",p=r&&(null==a?void 0:a.toString().startsWith(r))&&a||r&&a&&`${r} ${a}`||a||r||"",m=document.createElement("div");m.className=CO(),m.classList.add("tmx-sch"),ve(null==t?void 0:t.scheduleClick)&&(m.onclick=i=>t.scheduleClick({matchUp:e,pointerEvent:i}));const f=document.createElement("div");f.innerHTML=c,m.append(f);const h=document.createElement("div");h.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=i=>{ve(null==t?void 0:t.venueClick)&&(i.stopPropagation(),t.venueClick({pointerEvent:i,matchUp:e}))},v.innerHTML=p,h.append(v),m.append(h),m.onclick){const e=document.createElement("div");e.innerHTML="\u22ee",h.append(e)}return m}({matchUp:a,eventHandlers:t});m.appendChild(e)}const f=document.createElement("div");f.className=dO();const h=pO({sideContainer:!0,initialRoundNumber:e,eventHandlers:t,composition:i,sideNumber:n,matchUp:a});if(f.appendChild(h),c){const e=document.createElement("div");e.style.border="1px solid lightgray",f.appendChild(e)}if(d){const e=function({participantHeight:e,eventHandlers:t,composition:i,sideNumber:n,matchUp:r}){var a,o,s,l;const u=null==(a=null==i?void 0:i.configuration)?void 0:a.winnerChevron,d=null==(o=null==i?void 0:i.configuration)?void 0:o.gameScoreOnly,c=(null==(s=null==r?void 0:r.score)?void 0:s.sets)||[],p=null==(l=null==i?void 0:i.configuration)?void 0:l.scoreBox,m=MO(2===n?e:e-1),f=document.createElement("div");f.className=m({sideNumber:!p&&n,fontSize:"5px"}),f.classList.add("sideScore"),f.classList.add("tmx-scr"),f.onclick=e=>{ve(null==t?void 0:t.scoreClick)&&(e.stopPropagation(),t.scoreClick({pointerEvent:e,matchUp:r}))};const h=document.createElement("div");h.className=AO();for(const v of c||[]){const e=EO({gameScoreOnly:d,scoreStripes:u,sideNumber:n,set:v});h.appendChild(e)}return f.appendChild(h),f}({eventHandlers:t,composition:i,sideNumber:n,matchUp:a});f.appendChild(e)}if(p){const e=MO(),i=e=>{ve(null==t?void 0:t.scoreClick)&&(event.stopPropagation(),t.scoreClick({pointerEvent:e,matchUp:a}))},r=document.createElement("div");r.className=e({sideNumber:!c&&n,fontSize:"small"}),r.onclick=i,r.innerHTML="[Score]",f.appendChild(r)}return m.appendChild(f),m}function xO(e){const{composition:t,initialRoundNumber:i=1,matchUp:n,moeity:r,selectedMatchUpId:a,searchActive:o}=e,{roundFactor:s,roundNumber:l,finishingRound:u,matchUpType:d,preFeedRound:c,stage:p}=n,m=e.isFinalRound||1===parseInt(u),f="QUALIFYING"===p&&m,h=m,v=parseInt(l)===i,g="DOUBLES"===d,I=(o||n.isRoundRobin||n.collectionId||e.isLucky||e.isAdHoc?"mr":h&&"noProgression")||(f||c)&&"m0"||r&&"m1"||"m2",U=function({composition:e,isDoubles:t,roundFactor:i=1}){const n=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),r=(null==e?void 0:e.configuration)||{},a=(null==r?void 0:r.connectorWidth)||16,o=r.centerInfo?bO.centerInfo*n:0,s=r.scheduleInfo?bO.scheduleInfo*n:0,l=(60+(r.showAddress?n:0))*(t?1.3:1)+o;return Z({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:l*i,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:(l+s)*i}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}({composition:t,isDoubles:g,roundFactor:s})({isFirstRound:v,link:I}),y=(null==t?void 0:t.configuration)||{},{resultsInfo:S,centerInfo:w}=y||{},T=e.eventHandlers||{},P=document.createElement("div");P.className=oe(t.theme,null==e?void 0:e.className,"matchup",SO()),P.classList.add("tmx-m"),P.setAttribute("id",null==n?void 0:n.matchUpId),P.onclick=e=>{ve(null==T?void 0:T.matchUpClick)&&T.matchUpClick({pointerEvent:e,matchUp:n})};const D=document.createElement("div");D.className=function({configuration:e}){const t={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(null!=e&&e.matchUpHover){const i="string"==typeof e.matchUpHover?e.matchUpHover:"cyan";t["&:hover"]={backgroundColor:i}}else t["&:hover"]={borderColor:"$borderHover"};return Z(t)}({configuration:y});const b=({sideNumber:e})=>{var t,i,r;const a=null==(r=null==(i=null==(t=null==n?void 0:n.sides.find((t=>t.sideNumber===e)))?void 0:t.participant)?void 0:i.entryStatus)?void 0:r.replace("_"," ");return DO({eventHandlers:T,entryStatus:a,sideNumber:e,className:2===e&&U,matchUp:n})},M=FO({initialRoundNumber:i,eventHandlers:T,sideNumber:1,composition:t,matchUp:n}),N=FO({className:!w&&U,initialRoundNumber:i,eventHandlers:T,sideNumber:2,composition:t,matchUp:n});if(D.appendChild(M),w){const e=b({sideNumber:1}),t=b({sideNumber:2});D.appendChild(e.element),D.appendChild(t.element)}if(D.appendChild(N),S){const e=function({score:e}){var t;const i=null==(t=null==e?void 0:e.sets)?void 0:t.filter(Boolean).sort(((e,t)=>(e.setNumber||0)-(t.setNumber||0))),n=null==i?void 0:i[i.length-1],r=(null==n?void 0:n.side1PointsScore)||(null==n?void 0:n.side2PointsScore),a=document.createElement("div");if(a.className=yO(),r){const e=document.createElement("div");e.className=UO({variant:"points"}),e.innerHTML="PTS",a.appendChild(e)}for(const o of i||[]){const e=document.createElement("div");e.setAttribute("key",o.setNumber),e.className=UO({variant:"set"}),e.innerHTML=o.setNumber,a.appendChild(e)}return a}({score:n.score});D.appendChild(e)}if(P.appendChild(D),a===n.matchUpId){const e=document.createElement("div");e.className=Z({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0}),P.appendChild(e)}return P}function LO({initialRoundNumber:e=1,selectedMatchUpId:t,eventHandlers:i,isFinalRound:n,isRoundRobin:r,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:u,matchUps:d,context:c,isLucky:p}){const m=d.filter((e=>e.roundNumber===l)).sort(((e,t)=>(e.roundPosition||0)-(t.roundPosition||0))),f=m.every((({roundPosition:e,drawPositions:t})=>!e&&!t)),h=(null==o?void 0:o.configuration)||{},v=document.createElement("div");if(v.className=fO(),v.classList.add("tmx-rd"),v.setAttribute("roundNumber",l),h.roundHeader){const e=function({eventHandlers:e,roundMatchUps:t,roundProfile:i,roundNumber:n,context:r}){var a;const o=document.createElement("div");o.className=mO(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",n);const s=ve(null==e?void 0:e.roundHeaderClick);s&&(o.onclick=a=>e.roundHeaderClick({roundNumber:n,roundProfile:i,roundMatchUps:t,context:r,pointerEvent:a}));const l=s?"\u22ee":"",u=null==(a=null==i?void 0:i[n])?void 0:a.roundName,d=u&&` <div style="display: flex; flex-direction: row; justify-content: space-between">\n        <div>${u}</div>\n        <div style="font-weight: bold">${l}</div>\n      </div>\n  `;return o.innerHTML=d||"",o}({roundProfile:u,roundMatchUps:m,roundNumber:l,eventHandlers:i,context:c});v.appendChild(e)}const g=document.createElement("div");let I,U,y;if(g.className=vO({variant:f?"adHoc":void 0}),r){const e=e=>e.reduce(((e,t)=>t+e),0);m.sort(((t,i)=>{const n=e(t.drawPositions)-e(i.drawPositions),r=Math.min(...t.drawPositions??[])-Math.min(...i.drawPositions??[]);return n||r}));const t=m.reduce(((e,t)=>(e[t.structureId]=t.structureName,e)),{});I=Object.values(t),U=Object.keys(t),y=Object.keys(UC.instanceCount(m.map((({structureId:e})=>e)))).length}else f&&m.sort(((e,t)=>(e.roundOrder??0)-(t.roundOrder??0)));const S=y&&m.length/y,w=Object.keys(u).map((e=>parseInt(e))),T=w.indexOf(l),P=0===T?"first":T===w.length-1&&"last";return m.forEach(((r,u)=>{const d=S&&!(u%S),c=S&&Math.floor(u/S),h=S&&I[c];if(d){const t=document.createElement("div");t.className=gO({variant:c,roundOrder:P}),g.appendChild(t);const n=document.createElement("div");if(n.className=IO(),ve(null==i?void 0:i.groupHeaderClick)){const{drawId:e,containerStructureId:t}=m[0];g.onclick=n=>i.groupHeaderClick({drawId:e,structureId:U[c],containerStructureId:t,pointerEvent:n})}l===e&&(n.innerHTML=h),g.appendChild(n)}const v=u%2==0;s?r.roundFactor=s:e>1&&(r.roundFactor=Math.pow(2,l-e));const y=xO({initialRoundNumber:e,selectedMatchUpId:t,eventHandlers:i,isFinalRound:n,searchActive:a,composition:o,isAdHoc:f,isLucky:p,matchUp:r,moeity:v});g.appendChild(y)})),v.appendChild(g),v}function _O({initialRoundNumber:e=1,selectedMatchUpId:t,eventHandlers:i,searchActive:n,composition:r,structureId:a,finalColumn:o,matchUps:s,context:l}){var u;const{roundNumbers:d,roundProfile:c,hasOddMatchUpsCount:p,isNotEliminationStructure:m}=WC.getRoundMatchUps({matchUps:s});a=a||(null==l?void 0:l.structureId)||(null==(u=null==s?void 0:s[0])?void 0:u.structureId);const f=s.some((({isRoundRobin:e})=>e)),h=p||m,v=document.createElement("div");v.className=hO(),v.classList.add("tmx-str"),v.setAttribute("id",a);const g=Math.max(...d);for(const I of d){if(I<e)continue;const a=LO({initialRoundNumber:e,selectedMatchUpId:t,eventHandlers:i,isFinalRound:I===g,isRoundRobin:f,searchActive:n,composition:r,roundNumber:I,roundProfile:c,matchUps:s,context:l,isLucky:h});v.appendChild(a)}if(o){const e=document.createElement("div");e.className=fO();const t=document.createElement("div");t.className=vO(),t.appendChild(o),e.appendChild(t),v.appendChild(e)}return v}Z({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});const{createTheme:BO}=Q({theme:{lineHeights:{scheduleInfo:`${bO.scheduleInfo}rem`,centerInfo:`${bO.centerInfo}rem`,gameScore:`${bO.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),jO=BO("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),VO=BO("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),GO=BO("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),$O=BO("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),qO=BO("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),WO=BO("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),HO={Australian:{configuration:{flags:!0},theme:jO},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:qO},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:qO},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:GO},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:VO},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:$O},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:BO("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}})},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:jO},Night:{configuration:{flags:!0},theme:WO}}}}]);