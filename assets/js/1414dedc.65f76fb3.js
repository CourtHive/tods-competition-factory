"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[1233],{2669(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"engines/engine-middleware","title":"Engine Middleware","description":"Engine middleware automatically resolves tournament structures from identifiers, eliminating the need to manually pass event, drawDefinition, and tournamentRecord objects. This significantly simplifies API calls and reduces boilerplate code.","source":"@site/docs/engines/engine-middleware.md","sourceDirName":"engines","slug":"/engines/engine-middleware","permalink":"/competition-factory/docs/engines/engine-middleware","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Engine Middleware"},"sidebar":"docs","previous":{"title":"Engine Logging","permalink":"/competition-factory/docs/engines/engine-logging"},"next":{"title":"Mutation Engines","permalink":"/competition-factory/docs/engines/mutation-engines"}}');var r=i(6070),a=i(8322);const s={title:"Engine Middleware"},o=void 0,d={},l=[{value:"Automatic Structure Resolution",id:"automatic-structure-resolution",level:2},{value:"Resolving Events from Draw IDs",id:"resolving-events-from-draw-ids",level:3},{value:"Resolving Draws from Structure IDs",id:"resolving-draws-from-structure-ids",level:3},{value:"Resolving Everything from Match ID",id:"resolving-everything-from-match-id",level:3},{value:"Multi-Competition Management",id:"multi-competition-management",level:2},{value:"Explicit Tournament ID",id:"explicit-tournament-id",level:3},{value:"Setting Active Tournament",id:"setting-active-tournament",level:3},{value:"Single Tournament (No ID Required)",id:"single-tournament-no-id-required",level:3},{value:"Resolution Examples",id:"resolution-examples",level:2},{value:"Event Operations",id:"event-operations",level:3},{value:"Draw Operations",id:"draw-operations",level:3},{value:"Structure Operations",id:"structure-operations",level:3},{value:"MatchUp Operations",id:"matchup-operations",level:3},{value:"Middleware Behavior",id:"middleware-behavior",level:2},{value:"Resolution Priority",id:"resolution-priority",level:3},{value:"Resolution Chain",id:"resolution-chain",level:3},{value:"Disabling Middleware",id:"disabling-middleware",level:2},{value:"Per-Call Disable",id:"per-call-disable",level:3},{value:"When to Disable",id:"when-to-disable",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Invalid IDs",id:"invalid-ids",level:3},{value:"Missing Tournament",id:"missing-tournament",level:3},{value:"Conflicting IDs",id:"conflicting-ids",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Middleware Overhead",id:"middleware-overhead",level:3},{value:"Optimization Tips",id:"optimization-tips",level:3},{value:"Best Practices",id:"best-practices",level:2}];function c(e){const n={code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Engine middleware automatically resolves tournament structures from identifiers, eliminating the need to manually pass ",(0,r.jsx)(n.code,{children:"event"}),", ",(0,r.jsx)(n.code,{children:"drawDefinition"}),", and ",(0,r.jsx)(n.code,{children:"tournamentRecord"})," objects. This significantly simplifies API calls and reduces boilerplate code."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Automatic resolution of tournament structures from IDs"}),"\n",(0,r.jsx)(n.li,{children:"Cleaner, more concise method calls"}),"\n",(0,r.jsx)(n.li,{children:"Reduced parameter verbosity"}),"\n",(0,r.jsx)(n.li,{children:"Automatic tournament selection in multi-tournament scenarios"}),"\n",(0,r.jsx)(n.li,{children:"Type-safe resolution with error handling"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"automatic-structure-resolution",children:"Automatic Structure Resolution"}),"\n",(0,r.jsx)(n.p,{children:"Middleware resolves complex objects from simple identifiers:"}),"\n",(0,r.jsx)(n.h3,{id:"resolving-events-from-draw-ids",children:"Resolving Events from Draw IDs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import { tournamentEngine } from 'tods-competition-factory';\n\ntournamentEngine.setState(tournamentRecord);\n\n// Without middleware (manual resolution)\nconst { drawDefinition } = tournamentEngine.getDrawDefinition({ drawId });\nconst { event } = tournamentEngine.findEvent({ drawId: drawDefinition.drawId });\ntournamentEngine.deleteDrawDefinitions({ event, drawIds: [drawId] });\n\n// With middleware (automatic resolution)\ntournamentEngine.getEvent({ drawId }); // \u2705 Event automatically resolved\n"})}),"\n",(0,r.jsx)(n.h3,{id:"resolving-draws-from-structure-ids",children:"Resolving Draws from Structure IDs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Middleware resolves drawDefinition from structureId\nconst result = tournamentEngine.getStructure({ structureId });\n// Equivalent to manually finding draw, then finding structure\n"})}),"\n",(0,r.jsx)(n.h3,{id:"resolving-everything-from-match-id",children:"Resolving Everything from Match ID"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Single ID resolves entire hierarchy\nconst { matchUp, event, drawDefinition, structure } = tournamentEngine.getMatchUp({ matchUpId });\n// All related objects automatically included\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"multi-competition-management",children:"Multi-Competition Management"}),"\n",(0,r.jsx)(n.p,{children:"When multiple tournaments are loaded, middleware requires tournament identification:"}),"\n",(0,r.jsx)(n.h3,{id:"explicit-tournament-id",children:"Explicit Tournament ID"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import { competitionEngine } from 'tods-competition-factory';\n\n// Load multiple tournaments\nawait competitionEngine.setState([tournament1, tournament2, tournament3]);\n\n// Specify which tournament for the operation\nconst { participants } = competitionEngine.getParticipants({\n  tournamentId: 'tournament-1',\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"setting-active-tournament",children:"Setting Active Tournament"}),"\n",(0,r.jsxs)(n.p,{children:["Avoid repeating ",(0,r.jsx)(n.code,{children:"tournamentId"})," by setting an active tournament:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import { tournamentEngine, globalState } from 'tods-competition-factory';\n\n// Method 1: Via globalState\nglobalState.setTournamentId('tournament-1');\n\n// Method 2: Via engine\ntournamentEngine.setTournamentId('tournament-1');\n\n// Now all operations use this tournament\nconst { participants } = tournamentEngine.getParticipants(); // Uses 'tournament-1'\nconst { events } = tournamentEngine.getEvents(); // Uses 'tournament-1'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"single-tournament-no-id-required",children:"Single Tournament (No ID Required)"}),"\n",(0,r.jsx)(n.p,{children:"When only one tournament is in state, middleware automatically uses it:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import { tournamentEngine } from 'tods-competition-factory';\n\n// Load single tournament\ntournamentEngine.setState(singleTournament);\n\n// No tournamentId needed\nconst { participants } = tournamentEngine.getParticipants();\nconst { events } = tournamentEngine.getEvents();\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"resolution-examples",children:"Resolution Examples"}),"\n",(0,r.jsx)(n.h3,{id:"event-operations",children:"Event Operations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Operation with eventId - middleware resolves event object\ntournamentEngine.addEventExtension({\n  eventId: 'event-1',\n  extension: { name: 'metadata', value: { key: 'value' } },\n});\n\n// Middleware handles:\n// 1. Find event from eventId\n// 2. Add extension to event\n// 3. Trigger notifications\n"})}),"\n",(0,r.jsx)(n.h3,{id:"draw-operations",children:"Draw Operations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Operation with drawId - middleware resolves drawDefinition\ntournamentEngine.automatedPositioning({\n  drawId: 'draw-1',\n  seedingScaleNames: ['WTN', 'SEEDING'],\n});\n\n// Middleware handles:\n// 1. Find drawDefinition from drawId\n// 2. Find event containing this draw\n// 3. Perform automated positioning\n// 4. Trigger draw modification notices\n"})}),"\n",(0,r.jsx)(n.h3,{id:"structure-operations",children:"Structure Operations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Operation with structureId - middleware resolves full hierarchy\ntournamentEngine.getPositionAssignments({\n  structureId: 'structure-1',\n});\n\n// Middleware handles:\n// 1. Find drawDefinition containing structure\n// 2. Find event containing draw\n// 3. Extract position assignments from structure\n"})}),"\n",(0,r.jsx)(n.h3,{id:"matchup-operations",children:"MatchUp Operations"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Operation with matchUpId - middleware resolves everything\ntournamentEngine.setMatchUpStatus({\n  matchUpId: 'match-1',\n  outcome: { winningSide: 1 },\n});\n\n// Middleware handles:\n// 1. Find structure containing matchUp\n// 2. Find drawDefinition containing structure\n// 3. Find event containing draw\n// 4. Update matchUp status\n// 5. Propagate changes through draw\n// 6. Trigger notifications\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"middleware-behavior",children:"Middleware Behavior"}),"\n",(0,r.jsx)(n.h3,{id:"resolution-priority",children:"Resolution Priority"}),"\n",(0,r.jsx)(n.p,{children:"When multiple identifiers are provided, middleware uses the most specific:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Both drawId and eventId provided - drawId takes precedence\ntournamentEngine.getEvent({\n  drawId: 'draw-1', // More specific\n  eventId: 'event-1', // Ignored\n});\n// Returns event containing draw-1 (may not be event-1)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"resolution-chain",children:"Resolution Chain"}),"\n",(0,r.jsx)(n.p,{children:"Middleware traverses up the tournament hierarchy:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"matchUpId \u2192 structure \u2192 drawDefinition \u2192 event \u2192 tournamentRecord\n           \u2193           \u2193                 \u2193       \u2193\n      structureId    drawId           eventId  tournamentId\n"})}),"\n",(0,r.jsx)(n.p,{children:"Any identifier resolves all parent structures."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"disabling-middleware",children:"Disabling Middleware"}),"\n",(0,r.jsx)(n.p,{children:"For debugging or special cases, middleware can be disabled:"}),"\n",(0,r.jsx)(n.h3,{id:"per-call-disable",children:"Per-Call Disable"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Bypass middleware for this call only\ntournamentEngine.getEvent({\n  drawId: 'draw-1',\n  _middleware: false, // Middleware disabled\n});\n// Error: event not provided (middleware didn't resolve it)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"when-to-disable",children:"When to Disable"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Debugging scenarios:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Testing function behavior without middleware"}),"\n",(0,r.jsx)(n.li,{children:"Verifying manual object passing"}),"\n",(0,r.jsx)(n.li,{children:"Performance profiling middleware overhead"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Direct object passing:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Manually provide resolved objects\nconst { event } = tournamentEngine.findEvent({ drawId });\nconst { drawDefinition } = tournamentEngine.getDrawDefinition({ drawId });\n\ntournamentEngine.someOperation({\n  event,\n  drawDefinition,\n  _middleware: false,\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.p,{children:"Middleware provides clear error messages for resolution failures:"}),"\n",(0,r.jsx)(n.h3,{id:"invalid-ids",children:"Invalid IDs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"tournamentEngine.getEvent({ drawId: 'nonexistent-draw' });\n// Error: DRAW_DEFINITION_NOT_FOUND\n"})}),"\n",(0,r.jsx)(n.h3,{id:"missing-tournament",children:"Missing Tournament"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"competitionEngine.setState([tournament1, tournament2]);\n\n// No tournamentId specified with multiple tournaments\ncompetitionEngine.getParticipants();\n// Error: MISSING_TOURNAMENT_ID (ambiguous which tournament to use)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"conflicting-ids",children:"Conflicting IDs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Providing conflicting identifiers\ntournamentEngine.getEvent({\n  drawId: 'draw-from-event-1',\n  eventId: 'event-2', // Different event\n});\n// Uses drawId, ignores eventId\n// Returns event containing draw-1 (not event-2)\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"middleware-overhead",children:"Middleware Overhead"}),"\n",(0,r.jsx)(n.p,{children:"Middleware adds minimal overhead (~1ms per call):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// Without middleware (direct object access)\nconst time1 = performance.now();\nsomeOperation({ event, drawDefinition });\nconst time2 = performance.now();\n// ~0.1ms\n\n// With middleware (ID resolution)\nconst time3 = performance.now();\nsomeOperation({ eventId, drawId });\nconst time4 = performance.now();\n// ~1.1ms (includes resolution time)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use specific IDs when available:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// \u274c Less efficient - more resolution steps\ntournamentEngine.getMatchUp({ matchUpId }); // Resolves full hierarchy\n\n// \u2705 More efficient - direct access\ntournamentEngine.getMatchUp({\n  matchUpId,\n  eventId,\n  drawId, // Helps narrow down search\n  structureId, // Even more specific\n});\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use middleware by default"})," - It handles complexity automatically"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Set active tournament early"})," - Avoid repeating tournamentId"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pass specific IDs"})," - More specific = faster resolution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cache for bulk ops"})," - Resolve once, reuse objects"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Handle errors"})," - Middleware errors indicate data integrity issues"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Disable only when needed"})," - For debugging, not production"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8322(e,n,i){i.d(n,{R:()=>s,x:()=>o});var t=i(758);const r={},a=t.createContext(r);function s(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);