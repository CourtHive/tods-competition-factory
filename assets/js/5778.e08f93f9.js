"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[5778],{5778(e,t,r){r.r(t),r.d(t,{DrawStateManager:()=>zq,MATCH_FORMATS:()=>jq,barButton:()=>QX,buildSetScore:()=>yj,burstChart:()=>_X,cModal:()=>Ue,calculateComplement:()=>fj,compositions:()=>EB,controlBar:()=>cQ,courthiveComponentsVersion:()=>Vq,destroyTipster:()=>Bq,drawer:()=>EG,dropDownButton:()=>YX,fromFactoryDrawData:()=>BX,fromLegacyDraw:()=>jX,getAgeCategoryModal:()=>V$,getCategoryModal:()=>G$,getFlightProfileModal:()=>uV,getMatchUpFormatModal:()=>v$,getMatchWinner:()=>mj,getMaxAllowedScore:()=>uj,getMockParticipantsModal:()=>OB,getScoringConfig:()=>qV,getSetFormatForIndex:()=>oj,getSetWinner:()=>dj,initDrawer:()=>MG,isMatchComplete:()=>pj,isSetComplete:()=>lj,isSetTiebreakOnly:()=>sj,isSetTimed:()=>cj,renderButtons:()=>Gq,renderContainer:()=>SB,renderField:()=>Cr,renderForm:()=>MB,renderMatchUp:()=>gB,renderMenu:()=>RG,renderOptions:()=>Ar,renderParticipant:()=>$L,renderParticipantInput:()=>Or,renderRound:()=>IB,renderRoundHeader:()=>jL,renderStructure:()=>yB,resetScoringConfig:()=>zV,scoringModal:()=>xj,selectItem:()=>XX,setScoringConfig:()=>HV,shouldApplySmartComplement:()=>hj,shouldCreateNextSet:()=>Ij,shouldShowTiebreak:()=>gj,tipster:()=>$q,toggleOverlay:()=>eQ,validator:()=>Mr,validators:()=>Hq});var i,n="colors",a="sizes",o="space",s={gap:o,gridGap:o,columnGap:o,gridColumnGap:o,rowGap:o,gridRowGap:o,inset:o,insetBlock:o,insetBlockEnd:o,insetBlockStart:o,insetInline:o,insetInlineEnd:o,insetInlineStart:o,margin:o,marginTop:o,marginRight:o,marginBottom:o,marginLeft:o,marginBlock:o,marginBlockEnd:o,marginBlockStart:o,marginInline:o,marginInlineEnd:o,marginInlineStart:o,padding:o,paddingTop:o,paddingRight:o,paddingBottom:o,paddingLeft:o,paddingBlock:o,paddingBlockEnd:o,paddingBlockStart:o,paddingInline:o,paddingInlineEnd:o,paddingInlineStart:o,top:o,right:o,bottom:o,left:o,scrollMargin:o,scrollMarginTop:o,scrollMarginRight:o,scrollMarginBottom:o,scrollMarginLeft:o,scrollMarginX:o,scrollMarginY:o,scrollMarginBlock:o,scrollMarginBlockEnd:o,scrollMarginBlockStart:o,scrollMarginInline:o,scrollMarginInlineEnd:o,scrollMarginInlineStart:o,scrollPadding:o,scrollPaddingTop:o,scrollPaddingRight:o,scrollPaddingBottom:o,scrollPaddingLeft:o,scrollPaddingX:o,scrollPaddingY:o,scrollPaddingBlock:o,scrollPaddingBlockEnd:o,scrollPaddingBlockStart:o,scrollPaddingInline:o,scrollPaddingInlineEnd:o,scrollPaddingInlineStart:o,fontSize:"fontSizes",background:n,backgroundColor:n,backgroundImage:n,borderImage:n,border:n,borderBlock:n,borderBlockEnd:n,borderBlockStart:n,borderBottom:n,borderBottomColor:n,borderColor:n,borderInline:n,borderInlineEnd:n,borderInlineStart:n,borderLeft:n,borderLeftColor:n,borderRight:n,borderRightColor:n,borderTop:n,borderTopColor:n,caretColor:n,color:n,columnRuleColor:n,fill:n,outline:n,outlineColor:n,stroke:n,textDecorationColor:n,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:a,minBlockSize:a,maxBlockSize:a,inlineSize:a,minInlineSize:a,maxInlineSize:a,width:a,minWidth:a,maxWidth:a,height:a,minHeight:a,maxHeight:a,flexBasis:a,gridTemplateColumns:a,gridTemplateRows:a,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},c=(e,t)=>"function"==typeof t?{"()":Function.prototype.toString.call(t)}:t,u=()=>{const e=Object.create(null);return(t,r,...i)=>{const n=(a=t,JSON.stringify(a,c));var a;return n in e?e[n]:e[n]=r(t,...i)}},l=Symbol.for("sxs.internal"),d=(e,t)=>Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)),p=e=>{for(const t in e)return!0;return!1},{hasOwnProperty:m}=Object.prototype,f=e=>e.includes("-")?e:e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),h=/\s+(?![^()]*\))/,g=e=>t=>e(..."string"==typeof t?String(t).split(h):[t]),I={appearance:e=>({WebkitAppearance:e,appearance:e}),backfaceVisibility:e=>({WebkitBackfaceVisibility:e,backfaceVisibility:e}),backdropFilter:e=>({WebkitBackdropFilter:e,backdropFilter:e}),backgroundClip:e=>({WebkitBackgroundClip:e,backgroundClip:e}),boxDecorationBreak:e=>({WebkitBoxDecorationBreak:e,boxDecorationBreak:e}),clipPath:e=>({WebkitClipPath:e,clipPath:e}),content:e=>({content:e.includes('"')||e.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(e)?e:`"${e}"`}),hyphens:e=>({WebkitHyphens:e,hyphens:e}),maskImage:e=>({WebkitMaskImage:e,maskImage:e}),maskSize:e=>({WebkitMaskSize:e,maskSize:e}),tabSize:e=>({MozTabSize:e,tabSize:e}),textSizeAdjust:e=>({WebkitTextSizeAdjust:e,textSizeAdjust:e}),userSelect:e=>({WebkitUserSelect:e,userSelect:e}),marginBlock:g((e,t)=>({marginBlockStart:e,marginBlockEnd:t||e})),marginInline:g((e,t)=>({marginInlineStart:e,marginInlineEnd:t||e})),maxSize:g((e,t)=>({maxBlockSize:e,maxInlineSize:t||e})),minSize:g((e,t)=>({minBlockSize:e,minInlineSize:t||e})),paddingBlock:g((e,t)=>({paddingBlockStart:e,paddingBlockEnd:t||e})),paddingInline:g((e,t)=>({paddingInlineStart:e,paddingInlineEnd:t||e}))},y=/([\d.]+)([^]*)/,v=(e,t)=>e.length?e.reduce((e,r)=>(e.push(...t.map(e=>e.includes("&")?e.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(e)?`:is(${r})`:r):r+" "+e)),e),[]):t,S=(e,t)=>e in b&&"string"==typeof t?t.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(t,r,i,n)=>r+("stretch"===i?`-moz-available${n};${f(e)}:${r}-webkit-fill-available`:`-moz-fit-content${n};${f(e)}:${r}fit-content`)+n):String(t),b={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},U=e=>e?e+"-":"",w=(e,t,r)=>e.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(e,i,n,a,o)=>"$"==a==!!n?e:(i||"--"==a?"calc(":"")+"var(--"+("$"===a?U(t)+(o.includes("$")?"":U(r))+o.replace(/\$/g,"-"):o)+")"+(i||"--"==a?"*"+(i||"")+(n||"1")+")":"")),T=/\s*,\s*(?![^()]*\))/,D=Object.prototype.toString,P=(e,t,r,i,n)=>{let a,o,s;const c=(e,t,r)=>{let u,l;const d=e=>{for(u in e){const h=64===u.charCodeAt(0),g=h&&Array.isArray(e[u])?e[u]:[e[u]];for(l of g){const e=/[A-Z]/.test(m=u)?m:m.replace(/-[^]/g,e=>e[1].toUpperCase()),g="object"==typeof l&&l&&l.toString===D&&(!i.utils[e]||!t.length);if(e in i.utils&&!g){const t=i.utils[e];if(t!==o){o=t,d(t(l)),o=null;continue}}else if(e in I){const t=I[e];if(t!==s){s=t,d(t(l)),s=null;continue}}if(h&&(p=u.slice(1)in i.media?"@media "+i.media[u.slice(1)]:u,u=p.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(e,t,r,i,n,a)=>{const o=y.test(t),s=.0625*(o?-1:1),[c,u]=o?[i,t]:[t,i];return"("+("="===r[0]?"":">"===r[0]===o?"max-":"min-")+c+":"+("="!==r[0]&&1===r.length?u.replace(y,(e,t,i)=>Number(t)+s*(">"===r?1:-1)+i):u)+(n?") and ("+(">"===n[0]?"min-":"max-")+c+":"+(1===n.length?a.replace(y,(e,t,r)=>Number(t)+s*(">"===n?-1:1)+r):a):"")+")"})),g){const e=h?r.concat(u):[...r],i=h?[...t]:v(t,u.split(T));void 0!==a&&n(N(...a)),a=void 0,c(l,i,e)}else void 0===a&&(a=[[],t,r]),u=h||36!==u.charCodeAt(0)?u:`--${U(i.prefix)}${u.slice(1).replace(/\$/g,"-")}`,l=g?l:"number"==typeof l?l&&e in E?String(l)+"px":String(l):w(S(e,l??""),i.prefix,i.themeMap[e]),a[0].push(`${h?`${u} `:`${f(u)}:`}${l}`)}}var p,m};d(e),void 0!==a&&n(N(...a)),a=void 0};c(e,t,r)},N=(e,t,r)=>`${r.map(e=>`${e}{`).join("")}${t.length?`${t.join(",")}{`:""}${e.join(";")}${t.length?"}":""}${Array(r.length?r.length+1:0).join("}")}`,E={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},M=e=>String.fromCharCode(e+(e>25?39:97)),R=e=>(e=>{let t,r="";for(t=Math.abs(e);t>52;t=t/52|0)r=M(t%52)+r;return M(t%52)+r})(((e,t)=>{let r=t.length;for(;r;)e=33*e^t.charCodeAt(--r);return e})(5381,JSON.stringify(e))>>>0),A=["themed","global","styled","onevar","resonevar","allvar","inline"],C=e=>{if(e.href&&!e.href.startsWith(location.origin))return!1;try{return!!e.cssRules}catch{return!1}},k=e=>{let t;const r=()=>{const{cssRules:e}=t.sheet;return[].map.call(e,(r,i)=>{const{cssText:n}=r;let a="";if(n.startsWith("--sxs"))return"";if(e[i-1]&&(a=e[i-1].cssText).startsWith("--sxs")){if(!r.cssRules.length)return"";for(const e in t.rules)if(t.rules[e].group===r)return`--sxs{--sxs:${[...t.rules[e].cache].join(" ")}}${n}`;return r.cssRules.length?`${a}${n}`:""}return n}).join("")},i=()=>{if(t){const{rules:e,sheet:r}=t;if(!r.deleteRule){for(;3===Object(Object(r.cssRules)[0]).type;)r.cssRules.splice(0,1);r.cssRules=[]}for(const t in e)delete e[t]}const n=Object(e).styleSheets||[];for(const e of n)if(C(e)){for(let n=0,a=e.cssRules;a[n];++n){const o=Object(a[n]);if(1!==o.type)continue;const s=Object(a[n+1]);if(4!==s.type)continue;++n;const{cssText:c}=o;if(!c.startsWith("--sxs"))continue;const u=c.slice(14,-3).trim().split(/\s+/),l=A[u[0]];l&&(t||(t={sheet:e,reset:i,rules:{},toString:r}),t.rules[l]={group:s,index:n,cache:new Set(u)})}if(t)break}if(!t){const n=(e,t)=>({type:t,cssRules:[],insertRule(e,t){this.cssRules.splice(t,0,n(e,{import:3,undefined:1}[(e.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return"@media{}"===e?`@media{${[].map.call(this.cssRules,e=>e.cssText).join("")}}`:e}});t={sheet:e?(e.head||e).appendChild(document.createElement("style")).sheet:n("","text/css"),rules:{},reset:i,toString:r}}const{sheet:a,rules:o}=t;for(let e=A.length-1;e>=0;--e){const t=A[e];if(!o[t]){const r=A[e+1],i=o[r]?o[r].index:a.cssRules.length;a.insertRule("@media{}",i),a.insertRule(`--sxs{--sxs:${e}}`,i),o[t]={group:a.cssRules[i+1],index:i,cache:new Set([e])}}x(o[t])}};return i(),t},x=e=>{const t=e.group;let r=t.cssRules.length;e.apply=e=>{try{t.insertRule(e,r),++r}catch{}}},O=Symbol(),F=u(),_=(e,t)=>F(e,()=>(...r)=>{let i={type:null,composers:new Set};for(const t of r)if(null!=t)if(t[l]){null==i.type&&(i.type=t[l].type);for(const e of t[l].composers)i.composers.add(e)}else t.constructor!==Object||t.$$typeof?null==i.type&&(i.type=t):i.composers.add(L(t,e));return null==i.type&&(i.type="span"),i.composers.size||i.composers.add(["PJLV",{},[],[],{},[]]),B(e,i,t)}),L=({variants:e,compoundVariants:t,defaultVariants:r,...i},n)=>{const a=`${U(n.prefix)}c-${R(i)}`,o=[],s=[],c=Object.create(null),u=[];for(const p in r)c[p]=String(r[p]);if("object"==typeof e&&e)for(const f in e){l=c,d=f,m.call(l,d)||(c[f]="undefined");const t=e[f];for(const e in t){const r={[f]:String(e)};"undefined"===String(e)&&u.push(f);const i=t[e],n=[r,i,!p(i)];o.push(n)}}var l,d;if("object"==typeof t&&t)for(const m of t){let{css:e,...t}=m;e="object"==typeof e&&e||{};for(const i in t)t[i]=String(t[i]);const r=[t,e,!p(e)];s.push(r)}return[a,i,o,s,c,u]},B=(e,t,r)=>{const[i,n,a,o]=$(t.composers),s="function"==typeof t.type||t.type.$$typeof?(e=>{function t(){for(let r=0;r<t[O].length;r++){const[i,n]=t[O][r];e.rules[i].apply(n)}return t[O]=[],null}return t[O]=[],t.rules={},A.forEach(e=>t.rules[e]={apply:r=>t[O].push([e,r])}),t})(r):null,c=(s||r).rules,u=`.${i}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,p=l=>{l="object"==typeof l&&l||j;const{css:d,...p}=l,m={};for(const e in a)if(delete p[e],e in l){let t=l[e];"object"==typeof t&&t?m[e]={"@initial":a[e],...t}:(t=String(t),m[e]="undefined"!==t||o.has(e)?t:a[e])}else m[e]=a[e];const f=new Set([...n]);for(const[i,n,a,o]of t.composers){r.rules.styled.cache.has(i)||(r.rules.styled.cache.add(i),P(n,[`.${i}`],[],e,e=>{c.styled.apply(e)}));const t=V(a,m,e.media),s=V(o,m,e.media,!0);for(const n of t)if(void 0!==n)for(const[t,a,o]of n){const n=`${i}-${R(a)}-${t}`;f.add(n);const s=(o?r.rules.resonevar:r.rules.onevar).cache,u=o?c.resonevar:c.onevar;s.has(n)||(s.add(n),P(a,[`.${n}`],[],e,e=>{u.apply(e)}))}for(const n of s)if(void 0!==n)for(const[t,a]of n){const n=`${i}-${R(a)}-${t}`;f.add(n),r.rules.allvar.cache.has(n)||(r.rules.allvar.cache.add(n),P(a,[`.${n}`],[],e,e=>{c.allvar.apply(e)}))}}if("object"==typeof d&&d){const t=`${i}-i${R(d)}-css`;f.add(t),r.rules.inline.cache.has(t)||(r.rules.inline.cache.add(t),P(d,[`.${t}`],[],e,e=>{c.inline.apply(e)}))}for(const e of String(l.className||"").trim().split(/\s+/))e&&f.add(e);const h=p.className=[...f].join(" ");return{type:t.type,className:h,selector:u,props:p,toString:()=>h,deferredInjector:s}};return d(p,{className:i,selector:u,[l]:t,toString:()=>(r.rules.styled.cache.has(i)||p(),i)})},$=e=>{let t="";const r=[],i={},n=[];for(const[a,,,,o,s]of e){""===t&&(t=a),r.push(a),n.push(...s);for(const e in o){const t=o[e];(void 0===i[e]||"undefined"!==t||s.includes(t))&&(i[e]=t)}}return[t,r,i,new Set(n)]},V=(e,t,r,i)=>{const n=[];e:for(let[a,o,s]of e){if(s)continue;let e,c=0,u=!1;for(e in a){const i=a[e];let n=t[e];if(n!==i){if("object"!=typeof n||!n)continue e;{let e,t,a=0;for(const o in n){if(i===String(n[o])){if("@initial"!==o){const e=o.slice(1);(t=t||[]).push(e in r?r[e]:o.replace(/^@media ?/,"")),u=!0}c+=a,e=!0}++a}if(t&&t.length&&(o={["@media "+t.join(", ")]:o}),!e)continue e}}}(n[c]=n[c]||[]).push([i?"cv":`${e}-${a[e]}`,o,u])}return n},j={},G=u(),W=(e,t)=>G(e,()=>(...r)=>{const i=()=>{for(let i of r){i="object"==typeof i&&i||{};let r=R(i);if(!t.rules.global.cache.has(r)){if(t.rules.global.cache.add(r),"@import"in i){let e=[].indexOf.call(t.sheet.cssRules,t.rules.themed.group)-1;for(let r of[].concat(i["@import"]))r=r.includes('"')||r.includes("'")?r:`"${r}"`,t.sheet.insertRule(`@import ${r};`,e++);delete i["@import"]}P(i,[],[],e,e=>{t.rules.global.apply(e)})}}return""};return d(i,{toString:i})}),q=u(),H=(e,t)=>q(e,()=>r=>{const i=`${U(e.prefix)}k-${R(r)}`,n=()=>{if(!t.rules.global.cache.has(i)){t.rules.global.cache.add(i);const n=[];P(r,[],[],e,e=>n.push(e));const a=`@keyframes ${i}{${n.join("")}}`;t.rules.global.apply(a)}return i};return d(n,{get name(){return n()},toString:n})}),z=class{constructor(e,t,r,i){this.token=null==e?"":String(e),this.value=null==t?"":String(t),this.scale=null==r?"":String(r),this.prefix=null==i?"":String(i)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+U(this.prefix)+U(this.scale)+this.token}toString(){return this.computedValue}},Y=u(),K=(e,t)=>Y(e,()=>(r,i)=>{i="object"==typeof r&&r||Object(i);const n=`.${r=(r="string"==typeof r?r:"")||`${U(e.prefix)}t-${R(i)}`}`,a={},o=[];for(const t in i){a[t]={};for(const r in i[t]){const n=`--${U(e.prefix)}${t}-${r}`,s=w(String(i[t][r]),e.prefix,t);a[t][r]=new z(r,s,t,e.prefix),o.push(`${n}:${s}`)}}const s=()=>{if(o.length&&!t.rules.themed.cache.has(r)){t.rules.themed.cache.add(r);const n=`${i===e.theme?":root,":""}.${r}{${o.join(";")}}`;t.rules.themed.apply(n)}return r};return{...a,get className(){return s()},selector:n,toString:s}}),X=u(),Q=e=>{let t=!1;const r=X(e,e=>{t=!0;const r="prefix"in(e="object"==typeof e&&e||{})?String(e.prefix):"",i="object"==typeof e.media&&e.media||{},n="object"==typeof e.root?e.root||null:globalThis.document||null,a="object"==typeof e.theme&&e.theme||{},o={prefix:r,media:i,theme:a,themeMap:"object"==typeof e.themeMap&&e.themeMap||{...s},utils:"object"==typeof e.utils&&e.utils||{}},c=k(n),u={css:_(o,c),globalCss:W(o,c),keyframes:H(o,c),createTheme:K(o,c),reset(){c.reset(),u.theme.toString()},theme:{},sheet:c,config:o,prefix:r,getCssText:c.toString,toString:c.toString};return String(u.theme=u.createTheme(a)),u});return t||r.reset(),r},J=(...e)=>(i||(i=Q())).css(...e);const Z=J({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),ee=J({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),te=J({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});const re=J({fontSize:"smaller",color:"gray"});function ie(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ne,ae={exports:{}};var oe,se=(ne||(ne=1,oe=ae,function(){var e={}.hasOwnProperty;function t(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=i(e,r(n)))}return e}function r(r){if("string"==typeof r||"number"==typeof r)return r;if("object"!=typeof r)return"";if(Array.isArray(r))return t.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var n="";for(var a in r)e.call(r,a)&&r[a]&&(n=i(n,a));return n}function i(e,t){return t?e?e+" "+t:e+t:e}oe.exports?(t.default=t,oe.exports=t):window.classNames=t}()),ae.exports);const ce=ie(se);const ue=J({position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),le=J({display:"block"}),de=J({position:"fixed",right:0,left:0}),pe=J({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),me=J({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),fe=J({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),he=J({fontWeight:"600",fontSize:"20px"}),ge=J({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),Ie="Nothing to see here";function ye(e){return"function"==typeof e}function ve(e){return"string"==typeof e}function Se(e){return Array.isArray(e)}function be(e){if(e)for(;e.firstChild;)e.firstChild.remove()}const Ue=(()=>{const e=de(),t={},r=".5",i=[];let n;const a=[];let o,s=[];const c=r=>{const c=s.length;if(r&&!1===t[c])return;const u=a.pop(),l=i.pop();ye(u)&&u({content:l}),document.querySelectorAll("[data-modal-popover]").forEach(e=>e.remove()),document.body.classList.remove(e),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),o&&(o.style.opacity="0",o.style.display="none"),(()=>{{const e=s.pop();e&&e.remove()}})()},u=({config:t})=>{n=window.scrollY,document.body.classList.add(e),document.body.style.top=`-${n}px`,o||(o=document.createElement("div"),o.className=ue(),o.id="cmdl-backdrop",o.onclick=()=>c(!0),document.body.appendChild(o)),o.style.display="",!1!==t?.backdrop&&(o.style.backgroundColor="rgba(0, 0, 0, 0.2)",o.style.transition="opacity 0.15s linear",o.style.opacity="1")},l=({config:e,attr:t,attrs:r,unit:i="em",value:n})=>{let a;return ve(t)?a=we({element:e,attr:t}):Se(r)&&(a=r.map(t=>we({element:e,attr:t})).find(Boolean)),void 0!==a&&(n=a),Number.isNaN(n)?n:`${n}${i}`},d=({buttons:e,config:t,modalNumber:n})=>{const a=document.createElement("div");a.className=ge(),a.style.padding=l({config:t,attrs:["footer.padding","padding"],value:r});const o={label:t?.dictionary?.close||"Close",onClick:()=>Ue.close(),intent:"is-info"};for(const r of e){if(r.hide)continue;const e={...o,...r},t=document.createElement("button");void 0!==e.disabled&&(t.disabled=e.disabled),e.id&&(t.id=e.id),t.className=e?.footer?.className||"button font-medium",e.intent&&"none"!==e.intent&&t.classList.add(e.intent);const s="margin-right: .5em;",c=e?.footer?.style||"";t.style.cssText=s+(c?" "+c:""),t.innerHTML=e.label||e.text||"",t.onclick=t=>{t.stopPropagation(),ye(e.onClick)&&e.onClick({e:t,content:i[n]}),!1!==e.close&&(ye(e.close)&&e.close(),Ue.close())},a.appendChild(t)}return a};return{close:c,open:({title:e="",content:n,buttons:o,footer:p,config:m,onClose:f}={})=>{u({config:m}),a.push(f);const h=s.length+1;t[h]=m?.clickAway;const g=document.createElement("section"),I=`cmdl-${h}`;g.className=le(),g.role="dialog",g.tabIndex=-1,g.id=I;const y=document.createElement("div");y.className=pe(),y.style.maxWidth=`${m?.maxWidth||450}px`,y.onclick=()=>c(!0);const v=document.createElement("div");v.className=me(),m?.className&&v.classList.add(m.className),m?.style&&Object.assign(v.style,m.style),v.onclick=e=>e.stopPropagation();const S=document.createElement("div"),b=document.createElement("div");let U,w;S.appendChild(b),m?.info&&(U=document.createElement("span"),U.innerHTML="?",U.style.cssText="\n        cursor: pointer;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        width: 20px;\n        height: 20px;\n        border-radius: 50%;\n        background-color: #3273dc;\n        color: white;\n        font-size: 14px;\n        font-weight: bold;\n        flex-shrink: 0;\n        user-select: none;\n      ",U.onclick=e=>{if(e.stopPropagation(),w&&document.body.contains(w))return w.remove(),void(w=void 0);w=document.createElement("div"),w.setAttribute("data-modal-popover","true"),w.style.cssText="\n          position: absolute;\n          z-index: 10000;\n          background-color: white;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n          padding: 1em;\n          max-width: 300px;\n          font-size: 14px;\n          font-weight: normal;\n          line-height: 1.5;\n          color: #363636;\n        ";const t=document.createElement("style");t.textContent="\n          [data-modal-popover] strong {\n            color: #000 !important;\n            font-weight: 600;\n          }\n        ",document.querySelector("[data-modal-popover-styles]")||(t.setAttribute("data-modal-popover-styles","true"),document.head.appendChild(t)),ve(m.info)?w.innerHTML=m.info:w.textContent=String(m.info),document.body.appendChild(w);const r=U.getBoundingClientRect();w.style.right=window.innerWidth-r.left+5+"px",w.style.top=`${r.bottom+5}px`,w.style.left="auto",setTimeout(()=>{const e=t=>{w&&!w.contains(t.target)&&t.target!==U&&(w.remove(),w=void 0,document.removeEventListener("click",e))};document.addEventListener("click",e)},100)},S.appendChild(U)),v.appendChild(S);const T=({title:e,config:t})=>{S.className=e?fe():"",S.style.padding=l({config:t,attrs:["title.padding","padding"],value:r}),S.style.display=e||t?.info?"flex":"",S.style.alignItems="center",S.style.justifyContent=e?"space-between":"flex-end",b.className=e?he():"",b.innerHTML=e,U&&(U.style.marginLeft=e?"auto":"0")};(e||m?.info)&&T({title:e,config:m});const D=document.createElement("div");v.appendChild(D);const P=({content:e,config:t})=>{D.style.fontSize=l({config:t,attr:"fontSize",value:"15px"}),D.style.position="relative",D.style.padding=l({config:t,attrs:["content.padding","padding"],value:r}),ye(e)?i[h]=e(D):e instanceof HTMLElement?D.appendChild(e):ve(e)?D.innerHTML=e:D.innerHTML=Ie};let N;if(P({content:n,config:m}),Se(o))N=d({buttons:o,config:m,modalNumber:h}),v.appendChild(N);else if(p){const e=document.createElement("div");e.className=ge(),e.style.padding=l({config:m,attrs:["footer.padding","padding"]}),p instanceof HTMLElement?e.appendChild(p):ve(p)?e.innerHTML=p:e.innerHTML=Ie,N=e,v.appendChild(e)}y.appendChild(v),g.appendChild(y),document.body.appendChild(g),s.push(g);const E=({content:e,config:t})=>{i[h]=void 0,be(D),P({content:e,config:t})},M=({buttons:e,config:t})=>{N&&N.remove(),N=d({buttons:e,config:t,modalNumber:h}),v.appendChild(N)};return{setContent:E,setButtons:M,update:({content:e,buttons:t,title:r,config:i,onClose:n})=>{m=i||m,e&&E({content:e,config:m}),t&&M({buttons:t,config:m}),n&&(({onClose:e})=>{a.length=0,a.push(e)})({onClose:n}),r&&T({title:r,config:m})}}}}})();function we({element:e,attr:t}){if(!ve(t))return;const r=t.split(".");for(const i of r)if(e=e?.[i],!e)return;return e}function Te(e){const t=e?.composition?.configuration?.participantDetail;if("TEAM"===t)return function({individualParticipant:e,className:t}){const r=e?.teams?.[0],i=r?.participantName||" ",n=document.createElement("div");return n.className=ce(re(),t),n.classList.add("tmx-tm"),n.setAttribute("id",r?.participantId||""),n.innerHTML=i,n}(e);if(e?.composition?.configuration?.showAddress??"ADDRESS"===t)return function({individualParticipant:e,className:t}){const{city:r,state:i,countryCode:n}=e?.person?.addresses?.[0]||{},a=[r,i,n].filter(Boolean).join(", ")||" ",o=document.createElement("div");return o.className=ce(re(),t),o.innerHTML=a,o}(e);if(t){const r=function({individualParticipant:e,attribute:t,className:r}){const i=e?.person,n=we({element:i,attr:t});if(!n)return"";const a=document.createElement("div");return a.className=ce(re(),r),a.innerHTML=n,a}({...e,attribute:t});if(r&&"string"!=typeof r)return r}return document.createElement("div")}function De(e){return"function"==typeof e}function Pe(e){return"object"==typeof e&&!Array.isArray(e)}var Ne,Ee={exports:{}};var Me=(Ne||(Ne=1,function(e){!function(){var t=function(e,r){var i=this;t.count=(t.count||0)+1,this.count=t.count,this.isOpened=!1,this.input=n(e),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-controls","awesomplete_list_"+this.count),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=r=r||{},function(e,t,r){for(var i in t){var n=t[i],a=e.input.getAttribute("data-"+i.toLowerCase());e[i]="number"==typeof n?parseInt(a):!1===n?null!==a:n instanceof Function?null:a,!e[i]&&0!==e[i]&&(e[i]=i in r?r[i]:n)}}(this,{minChars:2,maxItems:10,autoFirst:!1,data:t.DATA,filter:t.FILTER_CONTAINS,sort:!1!==r.sort&&t.SORT_BYLENGTH,container:t.CONTAINER,item:t.ITEM,replace:t.REPLACE,tabSelect:!1,listLabel:"Results List",statusNoResults:"No results found",statusXResults:"{0} results found",statusTypeXChar:"Type {0} or more characters for results"},r),this.index=-1,this.container=this.container(e),this.ul=n.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container,"aria-label":this.listLabel}),this.status=n.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:""}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(e){var t=e.keyCode;i.opened&&(13===t&&i.selected||9===t&&i.selected&&i.tabSelect?(e.preventDefault(),i.select(void 0,void 0,e)):27===t?i.close({reason:"esc"}):(38===t||40===t)&&(e.preventDefault(),i[38===t?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(e){e.preventDefault()},click:function(e){var t=e.target;if(t!==this){for(;t&&!/li/i.test(t.nodeName);)t=t.parentNode;t&&0===e.button&&(e.preventDefault(),i.select(t,e.target,e))}}}},n.bind(this.input,this._events.input),n.bind(this.input.form,this._events.form),n.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||r.list||[],t.all.push(this)};function r(e){var t=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=t.label||t.value,this.value=t.value}t.prototype={set list(e){if(Array.isArray(e))this._list=e;else if("string"==typeof e&&e.indexOf(",")>-1)this._list=e.split(/\s*,\s*/);else if((e=n(e))&&e.children){var t=[];i.apply(e.children).forEach(function(e){if(!e.disabled){var r=e.textContent.trim(),i=e.value||r,n=e.label||r;""!==i&&t.push({label:n,value:i})}}),this._list=t}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(e){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),this.input.setAttribute("aria-activedescendant",""),n.fire(this.input,"awesomplete-close",e||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&-1===this.index&&this.goto(0),n.fire(this.input,"awesomplete-open")},destroy:function(){if(n.unbind(this.input,this._events.input),n.unbind(this.input.form,this._events.form),!this.options.container){var e=this.container.parentNode;e.insertBefore(this.input,this.container),e.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete"),this.input.removeAttribute("aria-expanded"),this.input.removeAttribute("aria-controls"),this.input.removeAttribute("aria-owns"),this.input.removeAttribute("role");var r=t.all.indexOf(this);-1!==r&&t.all.splice(r,1)},next:function(){var e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)},previous:function(){var e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)},goto:function(e){var t=this.ul.children;this.selected&&t[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&t.length>0&&(t[e].setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=t[e].offsetTop-this.ul.clientHeight+t[e].clientHeight,n.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(e,t,r){if(e?this.index=n.siblingIndex(e):e=this.ul.children[this.index],e){var i=this.suggestions[this.index];n.fire(this.input,"awesomplete-select",{text:i,origin:t||e,originalEvent:r})&&(this.replace(i),this.close({reason:"select"}),n.fire(this.input,"awesomplete-selectcomplete",{text:i,originalEvent:r}))}},evaluate:function(){var e=this,t=this.input.value;t.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(i){return new r(e.data(i,t))}).filter(function(r){return e.filter(r,t)}),!1!==this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(r,i){e.ul.appendChild(e.item(r,t,i))}),0===this.ul.children.length?(this.status.textContent=this.statusNoResults,this.close({reason:"nomatches"})):(this.input.setAttribute("aria-activedescendant",""),this.open(),this.status.textContent=this.statusXResults.replaceAll("{0}",this.ul.children.length))):(this.close({reason:"nomatches"}),this.minChar<=1||t.length>=this.minChars?this.status.textContent=this.statusNoResults:this.status.textContent=this.statusTypeXChar.replaceAll("{0}",this.minChars))}},t.all=[],t.FILTER_CONTAINS=function(e,t){return RegExp(n.regExpEscape(t.trim()),"i").test(e)},t.FILTER_STARTSWITH=function(e,t){return RegExp("^"+n.regExpEscape(t.trim()),"i").test(e)},t.SORT_BYLENGTH=function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1},t.CONTAINER=function(e){return n.create("div",{className:"awesomplete",around:e})},t.ITEM=function(e,t,r){var i=""===t.trim()?e:e.replace(RegExp(n.regExpEscape(t.trim()),"gi"),"<mark>$&</mark>");return n.create("li",{innerHTML:i,role:"option","aria-selected":"false",tabindex:"-1",id:"awesomplete_list_"+this.count+"_item_"+r})},t.REPLACE=function(e){this.input.value=e.value},t.DATA=function(e){return e},Object.defineProperty(r.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),r.prototype.toString=r.prototype.valueOf=function(){return""+this.label};var i=Array.prototype.slice;function n(e,t){return"string"==typeof e?(t||document).querySelector(e):e||null}function a(e,t){return i.call((t||document).querySelectorAll(e))}function o(){a("input.awesomplete").forEach(function(e){new t(e)})}n.create=function(e,t){var r=document.createElement(e);for(var i in t){var a=t[i];if("inside"===i)n(a).appendChild(r);else if("around"===i){var o=n(a);o.parentNode.insertBefore(r,o),r.appendChild(o),null!=o.getAttribute("autofocus")&&o.focus()}else i in r?r[i]=a:r.setAttribute(i,a)}return r},n.bind=function(e,t){if(e)for(var r in t){var i=t[r];r.split(/\s+/).forEach(function(t){e.addEventListener(t,i)})}},n.unbind=function(e,t){if(e)for(var r in t){var i=t[r];r.split(/\s+/).forEach(function(t){e.removeEventListener(t,i)})}},n.fire=function(e,t,r){var i=document.createEvent("HTMLEvents");for(var n in i.initEvent(t,!0,!0),r)i[n]=r[n];return e.dispatchEvent(i)},n.regExpEscape=function(e){return e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},n.siblingIndex=function(e){for(var t=0;e=e.previousElementSibling;t++);return t},typeof self<"u"&&(self.Awesomplete=t),typeof Document<"u"&&("loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o)),t.$=n,t.$$=a,e.exports&&(e.exports=t)}()}(Ee)),Ee.exports);const Re=ie(Me);function Ae({list:e,element:t,callback:r,currentValue:i,withCatchTab:n,onChange:a,onSelectComplete:o,listProvider:s}){const c=new Re(t,{list:e});t.parentElement&&(t.parentElement.style.width="100%"),De(s)&&t.addEventListener("focus",()=>{const e=s();c.list=e});let u=!1;if(n){const e=e=>"Tab"===e.key&&e.preventDefault();t.addEventListener("keydown",e,!1),t.addEventListener("keyup",e,!1)}if("function"==typeof a&&t.addEventListener("change",a),t.setAttribute("autocomplete","off"),t.addEventListener("awesomplete-selectcomplete",e=>(e=>{u=!0,De(r)&&r(e.text.value),t.value=e.text.label,c.suggestions=[],De(o)&&setTimeout(()=>o(),0)})(e),!1),t.addEventListener("keyup",function(e){const i="Tab"===e.key&&e.shiftKey;if(("Enter"===e.key||"Tab"===e.key&&!i)&&!u){const i=""===t.value.trim();if("Enter"===e.key&&i)return De(r)&&r(""),t.value="",c.suggestions=[],void(De(o)&&setTimeout(()=>o(),0));c.suggestions?.length&&!i&&(c.next(),c.select(0))}u=!1}),i){const r=e.find(e=>e.value===i)?.label;r&&(t.value=r)}return{typeAhead:c}}function Ce(e){return e[e.length-1]}function ke(e,...t){return t.forEach(t=>{e.includes(t)||e.push(t)}),e}function xe(e,t){return e?e.split(t):[]}function Oe(e,t,r){return(void 0===t||e>=t)&&(void 0===r||e<=r)}function Fe(e,t,r){return e<t?t:e>r?r:e}function _e(e,t,r={},i=0,n=""){n+=`<${Object.keys(r).reduce((e,t)=>{let n=r[t];return"function"==typeof n&&(n=n(i)),`${e} ${t}="${n}"`},e)}></${e}>`;const a=i+1;return a<t?_e(e,t,r,a,n):n}function Le(e){return e.replace(/>\s+/g,">").replace(/\s+</,"<")}function Be(e){return new Date(e).setHours(0,0,0,0)}function $e(){return(new Date).setHours(0,0,0,0)}function Ve(...e){switch(e.length){case 0:return $e();case 1:return Be(e[0])}const t=new Date(0);return t.setFullYear(...e),t.setHours(0,0,0,0)}function je(e,t){const r=new Date(e);return r.setDate(r.getDate()+t)}function Ge(e,t){const r=new Date(e),i=r.getMonth()+t;let n=i%12;n<0&&(n+=12);const a=r.setMonth(i);return r.getMonth()!==n?r.setDate(0):a}function We(e,t){const r=new Date(e),i=r.getMonth(),n=r.setFullYear(r.getFullYear()+t);return 1===i&&2===r.getMonth()?r.setDate(0):n}function qe(e,t){return(e-t+7)%7}function He(e,t,r=0){const i=new Date(e).getDay();return je(e,qe(t,r)-qe(i,r))}function ze(e,t){return Math.round((e-t)/6048e5)+1}function Ye(e){const t=He(e,4,1);return ze(t,He(new Date(t).setMonth(0,4),4,1))}function Ke(e,t){const r=He(new Date(e).setMonth(0,1),t,t),i=He(e,t,t),n=ze(i,r);if(n<53)return n;return i===He(new Date(e).setDate(32),t,t)?1:n}function Xe(e){return Ke(e,0)}function Qe(e){return Ke(e,6)}function Je(e,t){const r=new Date(e).getFullYear();return Math.floor(r/t)*t}function Ze(e,t,r){if(1!==t&&2!==t)return e;const i=new Date(e);return 1===t?r?i.setMonth(i.getMonth()+1,0):i.setDate(1):r?i.setFullYear(i.getFullYear()+1,0,0):i.setMonth(0,1),i.setHours(0,0,0,0)}const et=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,tt=/[\s!-/:-@[-`{-~\u5e74\u6708\u65e5]+/;let rt={};const it={y:(e,t)=>new Date(e).setFullYear(parseInt(t,10)),m(e,t,r){const i=new Date(e);let n=parseInt(t,10)-1;if(isNaN(n)){if(!t)return NaN;const e=t.toLowerCase(),i=t=>t.toLowerCase().startsWith(e);if(n=r.monthsShort.findIndex(i),n<0&&(n=r.months.findIndex(i)),n<0)return NaN}return i.setMonth(n),i.getMonth()!==at(n)?i.setDate(0):i.getTime()},d:(e,t)=>new Date(e).setDate(parseInt(t,10))},nt={d:e=>e.getDate(),dd:e=>ot(e.getDate(),2),D:(e,t)=>t.daysShort[e.getDay()],DD:(e,t)=>t.days[e.getDay()],m:e=>e.getMonth()+1,mm:e=>ot(e.getMonth()+1,2),M:(e,t)=>t.monthsShort[e.getMonth()],MM:(e,t)=>t.months[e.getMonth()],y:e=>e.getFullYear(),yy:e=>ot(e.getFullYear(),2).slice(-2),yyyy:e=>ot(e.getFullYear(),4)};function at(e){return e>-1?e%12:at(e+12)}function ot(e,t){return e.toString().padStart(t,"0")}function st(e){if("string"!=typeof e)throw new Error("Invalid date format.");if(e in rt)return rt[e];const t=e.split(et),r=e.match(new RegExp(et,"g"));if(0===t.length||!r)throw new Error("Invalid date format.");const i=r.map(e=>nt[e]),n=Object.keys(it).reduce((e,t)=>(r.find(e=>"D"!==e[0]&&e[0].toLowerCase()===t)&&e.push(t),e),[]);return rt[e]={parser(e,t){const i=e.split(tt).reduce((e,t,i)=>{if(t.length>0&&r[i]){const n=r[i][0];"M"===n?e.m=t:"D"!==n&&(e[n]=t)}return e},{});return n.reduce((e,r)=>{const n=it[r](e,i[r],t);return isNaN(n)?e:n},$e())},formatter:(e,r)=>i.reduce((i,n,a)=>i+`${t[a]}${n(e,r)}`,"")+Ce(t)}}function ct(e,t,r){if(e instanceof Date||"number"==typeof e){const t=Be(e);return isNaN(t)?void 0:t}if(e){if("today"===e)return $e();if(t&&t.toValue){const i=t.toValue(e,t,r);return isNaN(i)?void 0:Be(i)}return st(t).parser(e,r)}}function ut(e,t,r){if(isNaN(e)||!e&&0!==e)return"";const i="number"==typeof e?new Date(e):e;return t.toDisplay?t.toDisplay(i,t,r):st(t).formatter(i,r)}const lt=document.createRange();function dt(e){return lt.createContextualFragment(e)}function pt(e){return e.parentElement||(e.parentNode instanceof ShadowRoot?e.parentNode.host:void 0)}function mt(e){return e.getRootNode().activeElement===e}function ft(e){"none"!==e.style.display&&(e.style.display&&(e.dataset.styleDisplay=e.style.display),e.style.display="none")}function ht(e){"none"===e.style.display&&(e.dataset.styleDisplay?(e.style.display=e.dataset.styleDisplay,delete e.dataset.styleDisplay):e.style.display="")}function gt(e){e.firstChild&&(e.removeChild(e.firstChild),gt(e))}const It=new WeakMap,{addEventListener:yt,removeEventListener:vt}=EventTarget.prototype;function St(e,t){let r=It.get(e);r||(r=[],It.set(e,r)),t.forEach(e=>{yt.call(...e),r.push(e)})}function bt(e){let t=It.get(e);t&&(t.forEach(e=>{vt.call(...e)}),It.delete(e))}if(!Event.prototype.composedPath){const e=(t,r=[])=>{let i;return r.push(t),t.parentNode?i=t.parentNode:t.host?i=t.host:t.defaultView&&(i=t.defaultView),i?e(i,r):r};Event.prototype.composedPath=function(){return e(this.target)}}function Ut(e,t,r){const[i,...n]=e;return t(i)?i:i!==r&&"HTML"!==i.tagName&&0!==n.length?Ut(n,t,r):void 0}function wt(e,t){const r="function"==typeof t?t:e=>e instanceof Element&&e.matches(t);return Ut(e.composedPath(),r,e.currentTarget)}const Tt={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},Dt={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"\xbb",orientation:"auto",pickLevel:0,prevArrow:"\xab",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:Pt,format:Nt,weekStart:Et}=Dt;function Mt(e,t){return e.length<6&&t>=0&&t<7?ke(e,t):e}function Rt(e,t){switch(4===e?6===t?3:!t+1:e){case 1:return Ye;case 2:return Xe;case 3:return Qe}}function At(e,t,r){return t.weekStart=e,t.weekEnd=(e+6)%7,4===r&&(t.getWeekNumber=Rt(4,e)),e}function Ct(e,t,r,i){const n=ct(e,t,r);return void 0!==n?n:i}function kt(e,t,r=3){const i=parseInt(e,10);return i>=0&&i<=r?i:t}function xt(e,t,r,i=void 0){t in e&&(r in e||(e[r]=i?i(e[t]):e[t]),delete e[t])}function Ot(e,t){const r=Object.assign({},e),i={},n=t.constructor.locales,a=!!t.rangeSideIndex;let{datesDisabled:o,format:s,language:c,locale:u,maxDate:l,maxView:d,minDate:p,pickLevel:m,startView:f,weekNumbers:h,weekStart:g}=t.config||{};if(xt(r,"calendarWeeks","weekNumbers",e=>e?1:0),xt(r,"clearBtn","clearButton"),xt(r,"todayBtn","todayButton"),xt(r,"todayBtnMode","todayButtonMode"),r.language){let e;if(r.language!==c&&(n[r.language]?e=r.language:(e=r.language.split("-")[0],n[e]||(e=!1))),delete r.language,e){c=i.language=e;const t=u||n[Pt];u=Object.assign({format:Nt,weekStart:Et},n[Pt]),c!==Pt&&Object.assign(u,n[c]),i.locale=u,s===t.format&&(s=i.format=u.format),g===t.weekStart&&(g=At(u.weekStart,i,h))}}if(r.format){const e="function"==typeof r.format.toDisplay,t="function"==typeof r.format.toValue,n=et.test(r.format);(e&&t||n)&&(s=i.format=r.format),delete r.format}let I=m;"pickLevel"in r&&(I=kt(r.pickLevel,m,2),delete r.pickLevel),I!==m&&(I>m&&("minDate"in r||(r.minDate=p),"maxDate"in r||(r.maxDate=l)),o&&!r.datesDisabled&&(r.datesDisabled=[]),m=i.pickLevel=I);let y=p,v=l;if("minDate"in r){const e=Ve(0,0,1);y=null===r.minDate?e:Ct(r.minDate,s,u,y),y!==e&&(y=Ze(y,m,!1)),delete r.minDate}if("maxDate"in r&&(v=null===r.maxDate?void 0:Ct(r.maxDate,s,u,v),void 0!==v&&(v=Ze(v,m,!0)),delete r.maxDate),v<y?(p=i.minDate=v,l=i.maxDate=y):(p!==y&&(p=i.minDate=y),l!==v&&(l=i.maxDate=v)),r.datesDisabled){const e=r.datesDisabled;if("function"==typeof e)i.datesDisabled=null,i.checkDisabled=(t,r)=>e(new Date(t),r,a);else{const t=i.datesDisabled=e.reduce((e,t)=>{const r=ct(t,s,u);return void 0!==r?ke(e,Ze(r,m,a)):e},[]);i.checkDisabled=e=>t.includes(e)}delete r.datesDisabled}if("defaultViewDate"in r){const e=ct(r.defaultViewDate,s,u);void 0!==e&&(i.defaultViewDate=e),delete r.defaultViewDate}if("weekStart"in r){const e=Number(r.weekStart)%7;isNaN(e)||(g=At(e,i,h)),delete r.weekStart}if(r.daysOfWeekDisabled&&(i.daysOfWeekDisabled=r.daysOfWeekDisabled.reduce(Mt,[]),delete r.daysOfWeekDisabled),r.daysOfWeekHighlighted&&(i.daysOfWeekHighlighted=r.daysOfWeekHighlighted.reduce(Mt,[]),delete r.daysOfWeekHighlighted),"weekNumbers"in r){let e=r.weekNumbers;if(e){const t="function"==typeof e?(t,r)=>e(new Date(t),r):Rt(e=parseInt(e,10),g);t&&(h=i.weekNumbers=e,i.getWeekNumber=t)}else h=i.weekNumbers=0,i.getWeekNumber=null;delete r.weekNumbers}if("maxNumberOfDates"in r){const e=parseInt(r.maxNumberOfDates,10);e>=0&&(i.maxNumberOfDates=e,i.multidate=1!==e),delete r.maxNumberOfDates}r.dateDelimiter&&(i.dateDelimiter=String(r.dateDelimiter),delete r.dateDelimiter);let S=d;"maxView"in r&&(S=kt(r.maxView,d),delete r.maxView),S=m>S?m:S,S!==d&&(d=i.maxView=S);let b=f;if("startView"in r&&(b=kt(r.startView,b),delete r.startView),b<m?b=m:b>d&&(b=d),b!==f&&(i.startView=b),r.prevArrow){const e=dt(r.prevArrow);e.childNodes.length>0&&(i.prevArrow=e.childNodes),delete r.prevArrow}if(r.nextArrow){const e=dt(r.nextArrow);e.childNodes.length>0&&(i.nextArrow=e.childNodes),delete r.nextArrow}if("disableTouchKeyboard"in r&&(i.disableTouchKeyboard="ontouchstart"in document&&!!r.disableTouchKeyboard,delete r.disableTouchKeyboard),r.orientation){const e=r.orientation.toLowerCase().split(/\s+/g);i.orientation={x:e.find(e=>"left"===e||"right"===e)||"auto",y:e.find(e=>"top"===e||"bottom"===e)||"auto"},delete r.orientation}if("todayButtonMode"in r){switch(r.todayButtonMode){case 0:case 1:i.todayButtonMode=r.todayButtonMode}delete r.todayButtonMode}return Object.entries(r).forEach(([e,t])=>{void 0!==t&&e in Dt&&(i[e]=t)}),i}const Ft={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};const _t=e=>e.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),Lt=Le(`<div class="datepicker">\n  <div class="datepicker-picker">\n    <div class="datepicker-header">\n      <div class="datepicker-title"></div>\n      <div class="datepicker-controls">\n        ${_t(["prev-button prev-btn","view-switch","next-button next-btn"])}\n      </div>\n    </div>\n    <div class="datepicker-main"></div>\n    <div class="datepicker-footer">\n      <div class="datepicker-controls">\n        ${_t(["today-button today-btn","clear-button clear-btn"])}\n      </div>\n    </div>\n  </div>\n</div>`),Bt=Le(`<div class="days">\n  <div class="days-of-week">${_e("span",7,{class:"dow"})}</div>\n  <div class="datepicker-grid">${_e("span",42)}</div>\n</div>`),$t=Le(`<div class="week-numbers calendar-weeks">\n  <div class="days-of-week"><span class="dow"></span></div>\n  <div class="weeks">${_e("span",6,{class:"week"})}</div>\n</div>`);class Vt{constructor(e,t){Object.assign(this,t,{picker:e,element:dt('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,t,r){this.disabled=[];const i=this.picker;i.setViewSwitchLabel(e),i.setPrevButtonDisabled(t),i.setNextButtonDisabled(r)}setDisabled(e,t){t.add("disabled"),ke(this.disabled,e)}performBeforeHook(e,t){let r=this.beforeShow(new Date(t));switch(typeof r){case"boolean":r={enabled:r};break;case"string":r={classes:r}}if(r){const i=e.classList;if(!1===r.enabled&&this.setDisabled(t,i),r.classes){const e=r.classes.split(/\s+/);i.add(...e),e.includes("disabled")&&this.setDisabled(t,i)}r.content&&function(e,t){gt(e),t instanceof DocumentFragment?e.appendChild(t):"string"==typeof t?e.appendChild(dt(t)):"function"==typeof t.forEach&&t.forEach(t=>{e.appendChild(t)})}(e,r.content)}}renderCell(e,t,r,i,{selected:n,range:a},o,s=[]){e.textContent=t,this.isMinView&&(e.dataset.date=i);const c=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,r<this.first?c.add("prev"):r>this.last&&c.add("next"),c.add(...s),(o||this.checkDisabled(i,this.id))&&this.setDisabled(i,c),a){const[e,t]=a;r>e&&r<t&&c.add("range"),r===e&&c.add("range-start"),r===t&&c.add("range-end")}n.includes(r)&&c.add("selected"),r===this.focused&&c.add("focused"),this.beforeShow&&this.performBeforeHook(e,i)}refreshCell(e,t,r,[i,n]){const a=e.classList;a.remove("range","range-start","range-end","selected","focused"),t>i&&t<n&&a.add("range"),t===i&&a.add("range-start"),t===n&&a.add("range-end"),r.includes(t)&&a.add("selected"),t===this.focused&&a.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(e=>{e.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}}class jt extends Vt{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,t=!0){if(t){const e=dt(Bt).firstChild;this.dow=e.firstChild,this.grid=e.lastChild,this.element.appendChild(e)}super.init(e)}setOptions(e){let t;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,t=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,t=!0),e.locale){const r=this.locale=e.locale;this.dayNames=r.daysMin,this.switchLabelFormat=r.titleFormat,t=!0}if("beforeShowDay"in e&&(this.beforeShow="function"==typeof e.beforeShowDay?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const e=dt($t).firstChild;this.weekNumbers={element:e,dow:e.firstChild,weeks:e.lastChild},this.element.insertBefore(e,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(ht(this.dow),this.weekNumbers&&ht(this.weekNumbers.dow)):(ft(this.dow),this.weekNumbers&&ft(this.weekNumbers.dow))),t&&Array.from(this.dow.children).forEach((e,t)=>{const r=(this.weekStart+t)%7;e.textContent=this.dayNames[r],e.className=this.daysOfWeekDisabled.includes(r)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),t=e.getFullYear(),r=e.getMonth(),i=Ve(t,r,1),n=He(i,this.weekStart,this.weekStart);this.first=i,this.last=Ve(t,r+1,0),this.start=n,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e,t&&(this.range=t.dates)}render(){if(this.today=this.todayHighlight?$e():void 0,this.prepareForRender(ut(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,t=He(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((r,i)=>{const n=function(e,t){return je(e,7*t)}(t,i);r.textContent=this.getWeekNumber(n,e),i>3&&r.classList[n>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,t)=>{const r=je(this.start,t),i=new Date(r),n=i.getDay(),a=[];this.today===r&&a.push("today"),this.daysOfWeekHighlighted.includes(n)&&a.push("highlighted"),this.renderCell(e,i.getDate(),r,r,this,r<this.minDate||r>this.maxDate||this.daysOfWeekDisabled.includes(n),a)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(t=>{this.refreshCell(t,Number(t.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function Gt(e,t){if(!e||!e[0]||!e[1])return;const[[r,i],[n,a]]=e;return r>t||n<t?void 0:[r===t?i:-1,n===t?a:12]}class Wt extends Vt{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,t=!0){t&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(dt(_e("span",12,{"data-month":e=>e}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(void 0===e.minDate)this.minYear=this.minMonth=this.minDate=void 0;else{const t=new Date(e.minDate);this.minYear=t.getFullYear(),this.minMonth=t.getMonth(),this.minDate=t.setDate(1)}if("maxDate"in e)if(void 0===e.maxDate)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const t=new Date(e.maxDate);this.maxYear=t.getFullYear(),this.maxMonth=t.getMonth(),this.maxDate=Ve(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||null===e.datesDisabled?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow="function"==typeof e.beforeShowMonth?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e.reduce((e,t)=>{const r=new Date(t),i=r.getFullYear(),n=r.getMonth();return void 0===e[i]?e[i]=[n]:ke(e[i],n),e},{}),t&&t.dates&&(this.range=t.dates.map(e=>{const t=new Date(e);return isNaN(t)?void 0:[t.getFullYear(),t.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],t=this.year<this.minYear||this.year>this.maxYear,r=this.year===this.minYear,i=this.year===this.maxYear,n=Gt(this.range,this.year);Array.from(this.grid.children).forEach((a,o)=>{const s=Ze(new Date(this.year,o,1),1,this.isRangeEnd);this.renderCell(a,this.monthNames[o],o,s,{selected:e,range:n},t||r&&o<this.minMonth||i&&o>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],t=Gt(this.range,this.year)||[];Array.from(this.grid.children).forEach((r,i)=>{this.refreshCell(r,i,e,t)})}refreshFocus(){this.changeFocusedCell(this.focused)}}class qt extends Vt{constructor(e,t){super(e,t)}init(e,t=!0){t&&(this.navStep=10*this.step,this.beforeShowOption=`beforeShow${function(e){return[...e].reduce((e,t,r)=>e+(r?t:t.toUpperCase()),"")}(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(dt(_e("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(void 0===e.minDate?this.minYear=this.minDate=void 0:(this.minYear=Je(e.minDate,this.step),this.minDate=Ve(this.minYear,0,1))),"maxDate"in e&&(void 0===e.maxDate?this.maxYear=this.maxDate=void 0:(this.maxYear=Je(e.maxDate,this.step),this.maxDate=Ve(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||null===e.datesDisabled?e.checkDisabled:()=>!1),this.beforeShowOption in e){const t=e[this.beforeShowOption];this.beforeShow="function"==typeof t?t:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),t=Je(e,this.navStep),r=t+9*this.step;this.first=t,this.last=r,this.start=t-this.step,this.focused=Je(e,this.step)}updateSelection(){const{dates:e,rangepicker:t}=this.picker.datepicker;this.selected=e.reduce((e,t)=>ke(e,Je(t,this.step)),[]),t&&t.dates&&(this.range=t.dates.map(e=>{if(void 0!==e)return Je(e,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,t)=>{const r=this.start+t*this.step,i=Ze(new Date(r,0,1),2,this.isRangeEnd);e.dataset.year=r,this.renderCell(e,r,r,i,this,r<this.minYear||r>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(t=>{this.refreshCell(t,Number(t.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function Ht(e,t){const r={bubbles:!0,cancelable:!0,detail:{date:e.getDate(),viewDate:new Date(e.picker.viewDate),viewId:e.picker.currentView.id,datepicker:e}};e.element.dispatchEvent(new CustomEvent(t,r))}function zt(e,t){const{config:r,picker:i}=e,{currentView:n,viewDate:a}=i;let o;switch(n.id){case 0:o=Ge(a,t);break;case 1:o=We(a,t);break;default:o=We(a,t*n.navStep)}o=Fe(o,r.minDate,r.maxDate),i.changeFocus(o).render()}function Yt(e){const t=e.picker.currentView.id;t!==e.config.maxView&&e.picker.changeView(t+1).render()}function Kt(e){e.setDate({clear:!0})}function Xt(e){const t=$e();1===e.config.todayButtonMode?e.setDate(t,{forceRefresh:!0,viewDate:t}):e.setFocusedDate(t,!0)}function Qt(e){const t=()=>{e.config.updateOnBlur?e.update({revert:!0}):e.refresh("input"),e.hide()},r=e.element;mt(r)?r.addEventListener("blur",t,{once:!0}):t()}function Jt(e,t){const r=e.picker,i=new Date(r.viewDate),n=r.currentView.id,a=1===n?Ge(i,t-i.getMonth()):We(i,t-i.getFullYear());r.changeFocus(a).changeView(n-1).render()}function Zt(e){Yt(e)}function er(e){zt(e,-1)}function tr(e){zt(e,1)}function rr(e,t){const r=wt(t,".datepicker-cell");if(!r||r.classList.contains("disabled"))return;const{id:i,isMinView:n}=e.picker.currentView,a=r.dataset;n?e.setDate(Number(a.date)):Jt(e,Number(1===i?a.month:a.year))}function ir(e){e.preventDefault()}const nr=["left","top","right","bottom"].reduce((e,t)=>(e[t]=`datepicker-orient-${t}`,e),{}),ar=e=>e&&`${e}px`;function or(e,t){if("title"in t&&(t.title?(e.controls.title.textContent=t.title,ht(e.controls.title)):(e.controls.title.textContent="",ft(e.controls.title))),t.prevArrow){const r=e.controls.prevButton;gt(r),t.prevArrow.forEach(e=>{r.appendChild(e.cloneNode(!0))})}if(t.nextArrow){const r=e.controls.nextButton;gt(r),t.nextArrow.forEach(e=>{r.appendChild(e.cloneNode(!0))})}if(t.locale&&(e.controls.todayButton.textContent=t.locale.today,e.controls.clearButton.textContent=t.locale.clear),"todayButton"in t&&(t.todayButton?ht(e.controls.todayButton):ft(e.controls.todayButton)),"minDate"in t||"maxDate"in t){const{minDate:t,maxDate:r}=e.datepicker.config;e.controls.todayButton.disabled=!Oe($e(),t,r)}"clearButton"in t&&(t.clearButton?ht(e.controls.clearButton):ft(e.controls.clearButton))}function sr(e){const{dates:t,config:r,rangeSideIndex:i}=e;return Fe(t.length>0?Ce(t):Ze(r.defaultViewDate,r.pickLevel,i),r.minDate,r.maxDate)}function cr(e,t){!("_oldViewDate"in e)&&t!==e.viewDate&&(e._oldViewDate=e.viewDate),e.viewDate=t;const{id:r,year:i,first:n,last:a}=e.currentView,o=new Date(t).getFullYear();switch(r){case 0:return t<n||t>a;case 1:return o!==i;default:return o<n||o>a}}function ur(e){return window.getComputedStyle(e).direction}function lr(e){const t=pt(e);if(t!==document.body&&t)return"visible"!==window.getComputedStyle(t).overflow?t:lr(t)}class dr{constructor(e){const{config:t,inputField:r}=this.datepicker=e,i=Lt.replace(/%buttonClass%/g,t.buttonClass),n=this.element=dt(i).firstChild,[a,o,s]=n.firstChild.children,c=a.firstElementChild,[u,l,d]=a.lastElementChild.children,[p,m]=s.firstChild.children,f={title:c,prevButton:u,viewSwitch:l,nextButton:d,todayButton:p,clearButton:m};this.main=o,this.controls=f;const h=r?"dropdown":"inline";n.classList.add(`datepicker-${h}`),or(this,t),this.viewDate=sr(e),St(e,[[n,"mousedown",ir],[o,"click",rr.bind(null,e)],[f.viewSwitch,"click",Zt.bind(null,e)],[f.prevButton,"click",er.bind(null,e)],[f.nextButton,"click",tr.bind(null,e)],[f.todayButton,"click",Xt.bind(null,e)],[f.clearButton,"click",Kt.bind(null,e)]]),this.views=[new jt(this),new Wt(this),new qt(this,{id:2,name:"years",cellClass:"year",step:1}),new qt(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[t.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),t.container?t.container.appendChild(this.element):r.after(this.element)}setOptions(e){or(this,e),this.views.forEach(t=>{t.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:t}=this,r=e.inputField;if(r){const i=ur(r);i!==ur(pt(t))?t.dir=i:t.dir&&t.removeAttribute("dir"),this.place(),t.classList.add("active"),e.config.disableTouchKeyboard&&r.blur()}else t.classList.add("active");this.active=!0,Ht(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,Ht(this.datepicker,"hide"))}place(){const{classList:e,style:t}=this.element;t.display="block";const{width:r,height:i}=this.element.getBoundingClientRect(),n=this.element.offsetParent;t.display="";const{config:a,inputField:o}=this.datepicker,{left:s,top:c,right:u,bottom:l,width:d,height:p}=o.getBoundingClientRect();let{x:m,y:f}=a.orientation,h=s,g=c;if(n!==document.body&&n){const e=n.getBoundingClientRect();h-=e.left-n.scrollLeft,g-=e.top-n.scrollTop}else h+=window.scrollX,g+=window.scrollY;const I=lr(o);let y=0,v=0,{clientWidth:S,clientHeight:b}=document.documentElement;if(I){const e=I.getBoundingClientRect();e.top>0&&(v=e.top),e.left>0&&(y=e.left),e.right<S&&(S=e.right),e.bottom<b&&(b=e.bottom)}let U=0;"auto"===m&&(s<y?(m="left",U=y-s):s+r>S?(m="right",S<u&&(U=S-u)):m="rtl"===ur(o)?u-r<y?"left":"right":"left"),"right"===m&&(h+=d-r),h+=U,"auto"===f&&(f=c-i>v&&l+i>b?"top":"bottom"),"top"===f?g-=i:g+=p,e.remove(...Object.values(nr)),e.add(nr[m],nr[f]),t.left=ar(h),t.top=ar(g)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const t=this.currentView;return e!==t.id&&(this._oldView||(this._oldView=t),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=cr(this,e)?"render":"refreshFocus",this.views.forEach(e=>{e.updateFocus()}),this}update(e=void 0){const t=void 0===e?sr(this.datepicker):e;return this._renderMethod=cr(this,t)?"render":"refresh",this.views.forEach(e=>{e.updateFocus(),e.updateSelection()}),this}render(e=!0){const{currentView:t,datepicker:r,_oldView:i}=this,n=new Date(this._oldViewDate),a=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,t[a](),i&&(this.main.replaceChild(t.element,i.element),Ht(r,"changeView")),!isNaN(n)){const e=new Date(this.viewDate);e.getFullYear()!==n.getFullYear()&&Ht(r,"changeYear"),e.getMonth()!==n.getMonth()&&Ht(r,"changeMonth")}}}function pr(e,t,r,i,n,a){if(Oe(e,n,a)){if(i(e)){return pr(t(e,r),t,r,i,n,a)}return e}}function mr(e,t,r){const i=e.picker,n=i.currentView,a=n.step||1;let o,s=i.viewDate;switch(n.id){case 0:s=je(s,r?7*t:t),o=je;break;case 1:s=Ge(s,r?4*t:t),o=Ge;break;default:s=We(s,t*(r?4:1)*a),o=We}s=pr(s,o,t<0?-a:a,e=>n.disabled.includes(e),n.minDate,n.maxDate),void 0!==s&&i.changeFocus(s).render()}function fr(e,t){const{config:r,picker:i,editMode:n}=e,a=i.active,{key:o,altKey:s,shiftKey:c}=t,u=t.ctrlKey||t.metaKey,l=()=>{t.preventDefault(),t.stopPropagation()};if("Tab"===o)return void Qt(e);if("Enter"===o){if(a)if(n)e.exitEditMode({update:!0,autohide:r.autohide});else{const t=i.currentView;t.isMinView?e.setDate(i.viewDate):(i.changeView(t.id-1).render(),l())}else e.update();return}const d=r.shortcutKeys,p={key:o,ctrlOrMetaKey:u,altKey:s,shiftKey:c},m=Object.keys(d).find(e=>{const t=d[e];return!Object.keys(t).find(e=>t[e]!==p[e])});if(m){let t;if("toggle"===m?t=m:n?"exitEditMode"===m&&(t=m):a?"hide"===m?t=m:"prevButton"===m?t=[zt,[e,-1]]:"nextButton"===m?t=[zt,[e,1]]:"viewSwitch"===m?t=[Yt,[e]]:r.clearButton&&"clearButton"===m?t=[Kt,[e]]:r.todayButton&&"todayButton"===m&&(t=[Xt,[e]]):"show"===m&&(t=m),t)return Array.isArray(t)?t[0].apply(null,t[1]):e[t](),void l()}if(!a||n)return;const f=(r,i)=>{c||u||s?e.enterEditMode():(mr(e,r,i),t.preventDefault())};"ArrowLeft"===o?f(-1,!1):"ArrowRight"===o?f(1,!1):"ArrowUp"===o?f(-1,!0):"ArrowDown"===o?f(1,!0):("Backspace"===o||"Delete"===o||o&&1===o.length&&!u)&&e.enterEditMode()}function hr(e){e.config.showOnFocus&&!e._showing&&e.show()}function gr(e,t){const r=t.target;(e.picker.active||e.config.showOnClick)&&(r._active=mt(r),r._clicking=setTimeout(()=>{delete r._active,delete r._clicking},2e3))}function Ir(e,t){const r=t.target;r._clicking&&(clearTimeout(r._clicking),delete r._clicking,r._active&&e.enterEditMode(),delete r._active,e.config.showOnClick&&e.show())}function yr(e,t){t.clipboardData.types.includes("text/plain")&&e.enterEditMode()}function vr(e,t){const{element:r,picker:i}=e;if(!i.active&&!mt(r))return;const n=i.element;wt(t,e=>e===r||e===n)||Qt(e)}function Sr(e,t){return e.map(e=>ut(e,t.format,t.locale)).join(t.dateDelimiter)}function br(e,t,r=!1){if(0===t.length)return r?[]:void 0;const{config:i,dates:n,rangeSideIndex:a}=e,{pickLevel:o,maxNumberOfDates:s}=i;let c=t.reduce((e,t)=>{let r=ct(t,i.format,i.locale);return void 0===r||(r=Ze(r,o,a),Oe(r,i.minDate,i.maxDate)&&!e.includes(r)&&!i.checkDisabled(r,o)&&(o>0||!i.daysOfWeekDisabled.includes(new Date(r).getDay()))&&e.push(r)),e},[]);return 0!==c.length?(i.multidate&&!r&&(c=c.reduce((e,t)=>(n.includes(t)||e.push(t),e),n.filter(e=>!c.includes(e)))),s&&c.length>s?c.slice(-1*s):c):void 0}function Ur(e,t=3,r=!0,i=void 0){const{config:n,picker:a,inputField:o}=e;if(2&t){const e=a.active?n.pickLevel:n.startView;a.update(i).changeView(e).render(r)}1&t&&o&&(o.value=Sr(e.dates,n))}function wr(e,t,r){const i=e.config;let{clear:n,render:a,autohide:o,revert:s,forceRefresh:c,viewDate:u}=r;void 0===a&&(a=!0),a?void 0===o&&(o=i.autohide):o=c=!1,u=ct(u,i.format,i.locale);const l=br(e,t,n);!l&&!s||(l&&l.toString()!==e.dates.toString()?(e.dates=l,Ur(e,a?3:1,!0,u),Ht(e,"changeDate")):Ur(e,c?3:1,!0,u),o&&e.hide())}function Tr(e,t){return t?r=>ut(r,t,e.config.locale):e=>new Date(e)}class Dr{constructor(e,t={},r=void 0){e.datepicker=this,this.element=e,this.dates=[];const i=this.config=Object.assign({buttonClass:t.buttonClass&&String(t.buttonClass)||"button",container:null,defaultViewDate:$e(),maxDate:void 0,minDate:void 0},Ot(Dt,this));let n;if("INPUT"===e.tagName?(n=this.inputField=e,n.classList.add("datepicker-input"),t.container&&(i.container=t.container instanceof HTMLElement?t.container:document.querySelector(t.container))):i.container=e,r){const e=r.inputs.indexOf(n),t=r.datepickers;if(e<0||e>1||!Array.isArray(t))throw Error("Invalid rangepicker object.");t[e]=this,this.rangepicker=r,this.rangeSideIndex=e}this._options=t,Object.assign(i,Ot(t,this)),i.shortcutKeys=function(e){return Object.keys(Ft).reduce((t,r)=>{const i=void 0===e[r]?Ft[r]:e[r],n=i&&i.key;if(!n||"string"!=typeof n)return t;const a={key:n,ctrlOrMetaKey:!!(i.ctrlOrMetaKey||i.ctrlKey||i.metaKey)};return n.length>1&&(a.altKey=!!i.altKey,a.shiftKey=!!i.shiftKey),t[r]=a,t},{})}(t.shortcutKeys||{});const a=xe(e.value||e.dataset.date,i.dateDelimiter);delete e.dataset.date;const o=br(this,a);o&&o.length>0&&(this.dates=o),n&&(n.value=Sr(this.dates,i));const s=this.picker=new dr(this),c=[e,"keydown",fr.bind(null,this)];n?St(this,[c,[n,"focus",hr.bind(null,this)],[n,"mousedown",gr.bind(null,this)],[n,"click",Ir.bind(null,this)],[n,"paste",yr.bind(null,this)],[document,"mousedown",vr.bind(null,this)],[window,"resize",s.place.bind(s)]]):(St(this,[c]),this.show())}static formatDate(e,t,r){return ut(e,t,r&&Tt[r]||Tt.en)}static parseDate(e,t,r){return ct(e,t,r&&Tt[r]||Tt.en)}static get locales(){return Tt}get active(){return!(!this.picker||!this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const t=Ot(e,this);Object.assign(this._options,e),Object.assign(this.config,t),this.picker.setOptions(t),Ur(this,3)}show(){if(this.inputField){const{config:e,inputField:t}=this;if(t.disabled||t.readOnly&&!e.enableOnReadonly)return;!mt(t)&&!e.disableTouchKeyboard&&(this._showing=!0,t.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),bt(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const t=Tr(this,e);return this.config.multidate?this.dates.map(t):this.dates.length>0?t(this.dates[0]):void 0}setDate(...e){const t=[...e],r={},i=Ce(e);i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&Object.assign(r,t.pop());wr(this,Array.isArray(t[0])?t[0]:t,r)}update(e=void 0){if(!this.inputField)return;const t=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0});wr(this,xe(this.inputField.value,this.config.dateDelimiter),t)}getFocusedDate(e=void 0){return Tr(this,e)(this.picker.viewDate)}setFocusedDate(e,t=!1){const{config:r,picker:i,active:n,rangeSideIndex:a}=this,o=r.pickLevel,s=ct(e,r.format,r.locale);void 0!==s&&(i.changeFocus(Ze(s,o,a)),n&&t&&i.changeView(o),i.render())}refresh(e=void 0,t=!1){let r;e&&"string"!=typeof e&&(t=e,e=void 0),r="picker"===e?2:"input"===e?1:3,Ur(this,r,!t)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const t=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),t.update&&this.update(t)}}function Pr(e){const t=Object.assign({},e);return delete t.inputs,delete t.allowOneSidedRange,delete t.maxNumberOfDates,t}function Nr(e,t){if(e._updating)return;e._updating=!0;const r=t.target;if(void 0===r.datepicker)return;const i=e.datepickers,[n,a]=i,o={render:!1},s=e.inputs.indexOf(r),c=0===s?1:0,u=i[s].dates[0],l=i[c].dates[0];void 0!==u&&void 0!==l?0===s&&u>l?(n.setDate(l,o),a.setDate(u,o)):1===s&&u<l&&(n.setDate(u,o),a.setDate(l,o)):e.allowOneSidedRange||(void 0!==u||void 0!==l)&&(o.clear=!0,i[c].setDate(i[s].dates,o)),i.forEach(e=>{e.picker.update().render()}),delete e._updating}class Er{constructor(e,t={}){let r=Array.isArray(t.inputs)?t.inputs:Array.from(e.querySelectorAll("input"));if(r.length<2)return;e.rangepicker=this,this.element=e,this.inputs=r=r.slice(0,2),Object.freeze(r),this.allowOneSidedRange=!!t.allowOneSidedRange;const i=Nr.bind(null,this),n=Pr(t),a=this.datepickers=[];r.forEach(e=>{!function(e,t,r,i){St(e,[[r,"changeDate",t]]),new Dr(r,i,e)}(this,i,e,n)}),Object.freeze(a),Object.defineProperty(this,"dates",{get:()=>a.map(e=>e.dates[0])}),a[0].dates.length>0?Nr(this,{target:r[0]}):a[1].dates.length>0&&Nr(this,{target:r[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const t=Pr(e);this.datepickers.forEach(e=>{e.setOptions(t)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),bt(this),delete this.element.rangepicker}getDates(e=void 0){const t=e?t=>ut(t,e,this.datepickers[0].config.locale):e=>new Date(e);return this.dates.map(e=>void 0===e?e:t(e))}setDates(e,t){const{datepickers:[r,i],inputs:[n,a],dates:[o,s]}=this;this._updating=!0,r.setDate(e),i.setDate(t),delete this._updating,i.dates[0]!==s?Nr(this,{target:a}):r.dates[0]!==o&&Nr(this,{target:n})}}function Mr(e,t,r,i,n){if(n){n(t.target.value)?(i.innerHTML="",i.classList.remove("is-danger"),r.classList.remove("is-danger"),r.classList.add("is-success")):(i.innerHTML=e.error||"Invalid",r.classList.remove("is-success"),r.classList.add("is-danger"),i.classList.add("is-danger"))}}const Rr="none";function Ar(e,t){for(const r of t.options){if(r.hide)continue;const i=document.createElement("option");i.className="font-medium",r.value&&i.setAttribute("value",r.value),(r.selected||t.value===r.value)&&i.setAttribute("selected","true"),r.disabled&&i.setAttribute("disabled","true"),i.innerHTML=r.label,e.appendChild(i)}}function Cr(e){const t=document.createElement("div");if(t.className="field font-medium",e.class&&t.classList.add(e.class),e.width?t.style.cssText=`width: ${e.width}`:t.style.cssText="flex-grow: 1",e.label&&!e.checkbox){const r=document.createElement("label");r.style.cssText=e.labelStyle||"font-weight: bold; font-size: larger;",r.innerHTML=e.label,t.appendChild(r)}let r,i,n=[];const a=document.createElement("div");if(a.className="control font-medium",!1===e.controlVisible&&(a.style.display=Rr),e.controlId&&(a.id=e.controlId),e.text){const t=document.createElement("div");e.id&&(t.id=e.id),t.className="content",t.innerHTML=e.text,a.appendChild(t)}else if(e.radio){const t=document.createElement("div");t.id=e.id,t.className="control";for(const r of e.options??[]){const i=document.createElement("label");i.className="radio";const a=document.createElement("input");r.field&&n.push({input:a,field:r.field}),r.id&&(a.id=r.id),a.name=e.id,a.type="radio",a.value=r.text,r.checked&&(a.checked=!0),i.appendChild(a),t.appendChild(i);const o=document.createElement("span");o.style.marginLeft=".25em",o.style.marginRight="1em",o.style.color="#000",o.innerHTML=r.text,t.appendChild(o)}a.appendChild(t),r=t}else if(e.options){const t=document.createElement("div");t.className="select font-medium",t.style.cssText="width: 100%",e.zIndex&&(t.style.zIndex=e.zIndex);const i=document.createElement("select");if(e.dataPlaceholder&&i.setAttribute("data-placeholder",e.dataPlaceholder),e.dataType&&i.setAttribute("data-type",e.dataType),e.multiple&&i.setAttribute("multiple","true"),e.disabled&&(i.disabled=!0),e.id&&(t.id=e.id),i.style.cssText="width: 100%",Ar(i,e),t.appendChild(i),a.appendChild(t),e.help){const t=document.createElement("p");t.className="help font-medium is-info",t.innerHTML=e.help?.text,t.style.display=e.help?.visible?"":Rr,a.appendChild(t)}r=i,De(e.onChange)&&i.addEventListener("change",t=>e.onChange(t,e))}else if(e.checkbox){const t=document.createElement("div");t.className="flexrow nowrap",t.style.display="inline-block";const i=document.createElement("input");De(e.onChange)&&i.addEventListener("change",t=>e.onChange(t,e)),r=i;const n=e.intent??"is-success";i.className=`is-checkradio ${n}`,i.type="checkbox",i.id=e.id,e.checked&&(i.checked=!0),t.appendChild(i);const o=document.createElement("label");o.setAttribute("for",e.id),e.color&&(o.style.color=e.color),o.innerHTML=e.label,t.appendChild(o),a.appendChild(t)}else{const t=document.createElement("input");if(t.className="input font-medium",e.class&&t.classList.add(e.class),t.setAttribute("type",e.type||"text"),t.setAttribute("autocomplete",e.autocomplete||"off"),t.setAttribute("placeholder",e.placeholder||""),e.disabled&&t.setAttribute("disabled","true"),e.id&&t.setAttribute("id",e.id),a.appendChild(t),e.iconLeft){a.classList.add("has-icons-left");const t=document.createElement("span");t.className="icon is-small is-left font-medium";const r=document.createElement("i");r.className=e.iconLeft,t.appendChild(r),a.appendChild(t)}if("password"===e.type){a.classList.add("has-icons-right");const t=document.createElement("span");t.className="icon is-small is-right font-medium";const r=document.createElement("i");r.className=e.iconRight,t.appendChild(r),a.appendChild(t)}r=t;const n=document.createElement("p");if(n.className="help font-medium",a.appendChild(n),e.validator&&t.addEventListener("input",r=>Mr(e,r,t,n,e.validator)),e.date){const r=e.maxNumberOfDates||1,n=!e.maxNumberOfDates||1===r;i=new Dr(t,{maxDate:e.maxDate,minDate:e.minDate,format:"yyyy-mm-dd",maxNumberOfDates:r,autohide:n})}else e.typeAhead&&Ae({...e.typeAhead,element:t});De(e.onKeyDown)&&t.addEventListener("keydown",t=>e.onKeyDown(t,e)),De(e.onChange)&&t.addEventListener("change",t=>e.onChange(t,e)),De(e.onInput)&&t.addEventListener("input",t=>e.onInput(t,e)),De(e.onKeyUp)&&t.addEventListener("keyup",t=>e.onKeyUp(t,e)),void 0!==e.value&&(t.value=e.value),e.selectOnFocus&&t.addEventListener("focus",()=>t.select())}return t.appendChild(a),!1===e.visible&&(t.style.display=Rr),{field:t,inputElement:r,datepicker:i,subFields:n}}const kr="__BYE__",xr="__QUALIFIER__";function Or({matchUp:e,side:t,sideNumber:r,eventHandlers:i,composition:n,position:a,currentParticipant:o}){const s=n?.configuration,c=t?.drawPosition,u=()=>{const e=ye(s?.participantProvider)?s.participantProvider():[],t=s?.persistInputFields;let r=e;t&&o&&(e.some(e=>e.participantId===o.participantId)||(r=[o,...e]));const i=r.map(e=>({label:e.participantName||e.participantId,value:e.participantId})),n=o?.participantId===kr,a=o?.participantId===xr,c=[];return n||c.push({label:"\u2014 BYE \u2014",value:kr}),s?.hasQualifying&&!a&&c.push({label:"\u2014 QUALIFIER \u2014",value:xr}),[...c,...i]},l=u();let d=!1;const p=`assign-${e.matchUpId}-side${r}${a?`-p${a}`:""}`,m=o?.participantId,{field:f}=Cr({typeAhead:{list:l,callback:n=>{if(!t)return;if(!n||""===n.trim())return void(ye(i?.removeAssignment)&&i.removeAssignment({matchUp:e,side:t,sideNumber:r||1}));if(n===kr)return void(ye(i?.assignBye)&&i.assignBye({matchUp:e,side:t,sideNumber:r||1}));if(n===xr)return void(ye(i?.assignQualifier)&&i.assignQualifier({matchUp:e,side:t,sideNumber:r||1}));const a=(ye(s?.participantProvider)?s.participantProvider():[]).find(e=>e.participantId===n);a&&ye(i?.assignParticipant)&&i.assignParticipant({matchUp:e,side:t,sideNumber:r||1,participant:a})},onSelectComplete:()=>{if(d)return void(d=!1);const e=Array.from(document.querySelectorAll(".participant-assignment-input input")),t=e.findIndex(e=>e.id===p);if(-1!==t&&t<e.length-1){const r=e[t+1];setTimeout(()=>{r.focus()},100)}},listProvider:u,currentValue:m},placeholder:a?`Partner ${a}`:"Type participant name...",field:p,id:p,class:"participant-assignment-input"});c&&(f.dataset.drawPosition=c.toString());const h=f.querySelector("input");h&&h.addEventListener("keydown",e=>{"Tab"===e.key&&(d=!0,setTimeout(()=>{d=!1},500))}),f.style.width="100%",f.style.margin="0";const g=s?.assignmentInputFontSize;return g&&(f.style.fontSize=g),setTimeout(()=>{const e=f.querySelector("input");if(e){let t=e.parentElement,r=0;for(;t&&r<15;){const e=window.getComputedStyle(t);("visible"!==e.overflow||"visible"!==e.overflowX||"visible"!==e.overflowY)&&(t.style.setProperty("overflow","visible","important"),t.style.setProperty("overflow-x","visible","important"),t.style.setProperty("overflow-y","visible","important")),t=t.parentElement,r++}}},100),f}const Fr=J({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});const _r=J({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});var Lr=Object.defineProperty,Br=(e,t)=>{for(var r in t)Lr(e,r,{get:t[r],enumerable:!0})};var $r={};Br($r,{competitionGovernor:()=>Vr,drawsGovernor:()=>Vm,entriesGovernor:()=>iA,eventGovernor:()=>hA,generationGovernor:()=>tC,matchUpFormatGovernor:()=>NC,matchUpGovernor:()=>EC,mocksGovernor:()=>jk,participantGovernor:()=>uO,policyGovernor:()=>ZE,publishingGovernor:()=>LO,queryGovernor:()=>cM,reportGovernor:()=>QO,scheduleGovernor:()=>nF,scoreGovernor:()=>ZD,tieFormatGovernor:()=>SF,tournamentGovernor:()=>jF,venueGovernor:()=>a_});var Vr={};Br(Vr,{getLinkedTournamentIds:()=>$m,getTournamentIds:()=>um,linkTournaments:()=>Fm,mutate:()=>jr,query:()=>Bm,unlinkTournament:()=>Lm,unlinkTournaments:()=>_m});var jr={};Br(jr,{linkTournaments:()=>Fm,unlinkTournament:()=>Lm,unlinkTournaments:()=>_m});var Gr="SINGLES",Wr="SINGLES",qr="DOUBLES",Hr="DOUBLES",zr="TEAM",Yr="TEAM",Kr={SINGLES_MATCHUP:Gr,SINGLES:Wr,DOUBLES_MATCHUP:qr,DOUBLES:Hr,TEAM_MATCHUP:zr,TEAM:Yr},Xr={[Wr]:[Wr,"S"],[Hr]:[Hr,"D"],[Yr]:[Yr,"T"],S:[Wr,"S"],D:[Hr,"D"],T:[Yr,"T"]};function Qr(e,t){return(e??0)-(t??0)}function Jr(e){return"number"==typeof e?parseInt(e.toString()):"string"==typeof e?parseInt(e):0}function Zr(e){return"function"==typeof e}function ei(e){return"string"==typeof e}function ti(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function ri(e,t){if(!ti(e)||!ti(t))return!1;let r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(let n of r)if(e[n]!==t[n])return!1;return!0}function ii(e,t){return Array.isArray(e)?Object.assign({},...(e??[]).filter(ti).map(e=>e[t]&&{[e[t]]:e}).filter(Boolean)):{}}var ni=e=>t=>Object.keys(e).every(r=>t[r]===e[r]);function ai(e,t){if(void 0===e)return null;if(!ti(e)||null===e)return e;let r=Object.keys(e),i=e=>void 0===e?null:e;return Object.assign({},...r.map(r=>Array.isArray(e[r])?{[r]:t?e[r]:e[r].map(e=>ai(e))}:{[r]:t?i(e[r]):ai(e[r])}))}function oi(e){return Array.isArray(e)?e.length+e.map(oi).reduce((e,t)=>e+t,0):ti(e)&&null!==e?Object.keys(e).length+Object.keys(e).map(t=>oi(e[t])).reduce((e,t)=>e+t,0):0}function si(e){if(null===e||"object"!=typeof e)return;let t=JSON.stringify(e),r=oi(e),i=t.split("").reduce((e,t)=>e+t.charCodeAt(0),0);return[t.length,r,i].map(e=>e.toString(36)).join("")}function ci(e){return!Number.isNaN(Number(e))&&(e>0&&!(e&e-1))}function ui(e){if(!e.length)return;let t=[...e].sort(Qr),r=Math.floor(t.length/2);return t.length%2?t[r]:(t[r-1]+t[r])/2}function li(e){return Number.isNaN(Number(e))?0:e%2&&e+1||e}function di(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function pi(e){return!Number.isNaN(Number.parseFloat(e))}function mi(e){let t=Jr(e);if(!Number.isNaN(t))return 0!==t&&1===(t&-t)}function fi(e){if(Number.isNaN(Number(e)))return!1;for(;!ci(e);)e++;return e}function hi(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function gi(e){return!(ei(e)&&!e.trim().length)&&Number.isSafeInteger("string"==typeof e?+e:e)}function Ii(e,t,r,i,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=Ii(e,t,r):(s=Math.pow(s,r),s*=t-e,s+=e),i&&(s=function(e,t){t||(t=1);let r=1/t;return Math.round(e*r)/r}(s,i)),Number.parseFloat(s.toFixed(n))}function yi(e,t=2){return Number.parseFloat(Number(Math.round(1e3*e)/1e3).toFixed(t))}function vi(e){return Array.isArray(e)?e?.filter((e,t,r)=>r.lastIndexOf(e)===t):[]}function Si(e){return Array.isArray(e)?e?.map(e=>null===e?void 0:e):e}function bi(e){return Array.isArray(e)?e.map(e=>[Math.random(),e]).sort((e,t)=>e[0]-t[0]).map(e=>e[1]):[]}function Ui(e){return gi(e)?e:1/0}function wi(e){return Array.isArray(e)?e.reduce((e,t)=>(e[t]||(e[t]=0),e[t]++,e),{}):{}}function Ti(e){return Di(wi(e))}function Di(e){return Object.keys(e).reduce((t,r)=>{let i=e[r];return t[i]?t[i].push(r):t[i]=[r],t},{})}function Pi(e,t,r){return r.indexOf(e)===t}function Ni(e){return e.filter(Pi)}function Ei(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function Mi(e){return e[Math.floor(Math.random()*e.length)]}function Ri(e,t){return Array.from({length:t-e},(t,r)=>r+e)}function Ai(e,t){return t.reduce((t,r,i)=>(r===e&&t.push(i),t),[])}function Ci(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter(e=>-1!==t.indexOf(e)).filter((e,t,r)=>r.indexOf(e)===t):[]}function ki(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter(e=>!t.includes(e)):[]}function xi(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some(e=>t.includes(e))}function Oi(e,t){return Array.isArray(t)&&t.reduce((e,t)=>(e[t]=1+e[t]||1,e),{})[e]||0}function Fi(e,t,r,i){return Array.isArray(e)?[].concat(...e.slice(0,t),...e.slice(t,t+r).sort(i),...e.slice(t+r,e.length)):[]}function _i(e,t){return Array.isArray(e)?e.reduce((e,r,i)=>{let n=Math.floor(i/t);return e[n]=[].concat(e[n]||[],r),e},[]):[]}function Li(e,[t,...r]){return e.length?[e.slice(0,t),...Li(e.slice(t),[...r,t])]:[]}function Bi(e){return!!Array.isArray(e)&&e.reduce((e,t)=>!isNaN(parseInt(t))&&e,!0)}function $i(e){return!!Array.isArray(e)&&e.reduce((e,t)=>isNaN(parseInt(t))&&e,!0)}function Vi(e,t,r){return Array.isArray(e)?e.reduce((e,i,n)=>{let a=!!r&&!!(Math.floor(n/t)%2),o=n%t,s=a?t-1-o:o;return e[s]||(e[s]=[]),e[s].push(i),e},[]):[]}function ji(e,t){return!(!Array.isArray(e)||!ei(t))&&Ci(e,Xr[t]).length}var Gi={success:!0},Wi="error",qi={SUCCESS:Gi,ERROR:Wi};function Hi({collectionValueProfiles:e,matchUpCount:t}){let r=[];if(!Array.isArray(e))return r.push(`collectionValueProfiles is not an array: ${e}`),{errors:r};if(e.length&&e.length!==t)return r.push("collectionValueProfiles do not align with matchUpsCount"),{errors:r};for(let n of e){if("object"!=typeof n)return r.push(`valueProfile is not type object: ${n}`),{errors:r};let{matchUpValue:e,collectionPosition:i}=n;if("number"!=typeof e||"number"!=typeof i||i>t||i<1)return r.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:r}}let i=e.map(e=>e.collectionPosition);return i.length!==vi(i).length?(r.push("collectionPositions are not unique"),{errors:r}):{...Gi}}Br({},{addNotice:()=>Bs,callListener:()=>Hs,createInstanceState:()=>Ds,cycleMutationStatus:()=>Ls,deepCopyEnabled:()=>ks,deleteNotice:()=>js,deleteNotices:()=>Gs,disableNotifications:()=>Rs,enableNotifications:()=>As,getDevContext:()=>Ps,getMethods:()=>$s,getNotices:()=>Vs,getProvider:()=>ec,getTopics:()=>Ws,getTournamentId:()=>zs,getTournamentRecord:()=>Ys,getTournamentRecords:()=>Ks,globalLog:()=>rc,handleCaughtError:()=>tc,hasTopic:()=>qs,removeTournamentRecord:()=>Zs,setDeepCopy:()=>Cs,setDevContext:()=>Ms,setGlobalLog:()=>Es,setGlobalMethods:()=>Fs,setGlobalSubscriptions:()=>xs,setMethods:()=>_s,setStateMethods:()=>ic,setStateProvider:()=>Ts,setSubscriptions:()=>Os,setTournamentId:()=>Js,setTournamentRecord:()=>Xs,setTournamentRecords:()=>Qs,timeKeeper:()=>Ns});var zi={message:"Chronological error; time violation.",code:"ANACHRONISM"},Yi={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},Ki={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},Xi={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Qi={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Ji={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Zi={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},en={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},tn={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},rn={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},nn={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},an={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},on={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},sn={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},cn={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},un={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},ln={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},dn={message:"Schedule conflict: court slot already occupied",code:"ERR_SCHEDULE_CONFLICT_DOUBLE_BOOKING"},pn={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},mn={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},fn={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},hn={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},gn={message:"drawPosition is occupied",code:"ERR_OCCUPIED_DRAW_POSITION"},In={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},yn={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},vn={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},Sn={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},bn={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Un={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},wn={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Tn={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Dn={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Pn={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Nn={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},En={message:"Invalid action",code:"ERR_INVALID_ACTION"},Mn={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Rn={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},An={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Cn={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},kn={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},xn={message:"Existing round",code:"ERR_EXISTING_ROUND"},On={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Fn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},_n={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Ln={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Bn={message:"Missing MAIN structure",code:"ERR_MISSING_MAIN_STRUCTURE"},$n={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Vn={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},jn={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Gn={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Wn={message:"Event exists",code:"ERR_EXISTING_EVENT"},qn={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Hn={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},zn={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Yn={message:"Missing stage",code:"ERR_MISSING_STAGE"},Kn={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Xn={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Qn={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Jn={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Zn={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},ea={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},ta={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},ra={message:"Propagated exits downstream",code:"ERR_PROPAGATED_EXITS_DOWNSTREAM"},ia={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},na={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},aa={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},oa={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},sa={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},ca={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},ua={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},la={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},da={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},pa={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},ma={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},fa={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},ha={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},ga={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Ia={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},ya={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},va={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},Sa={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},ba={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Ua={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},wa={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},Ta={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Da={message:"Missing value",code:"ERR_MISSING_VALUE"},Pa={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},Na={message:"Missing date",code:"ERR_MISSING_DATE"},Ea={message:"No valid dates",code:"ERR_NO_VALID_DATES"},Ma={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},Ra={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},Aa={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ca={message:"Invalid Date",code:"ERR_INVALID_DATE"},ka={message:"Invalid time",code:"ERR_INVALID_TIME"},xa={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},Oa={message:"Missing date range",info:"Event or tournament must have start and end dates",code:"ERR_MISSING_DATE_RANGE"},Fa={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},_a={message:"Invalid score",code:"ERR_INVALID_SCORE"},La={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Ba={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},$a={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Va={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},ja={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Ga={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},Wa={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},qa={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ha={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},za={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Ya={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Ka={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Xa={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Qa={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Ja={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},Za={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},eo={message:"Missing qualified participants",code:"ERR_MISSING_QUALIFIED_PARTICIPANTS"},to={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},ro={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},io={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},no={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},ao={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},oo={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},so={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},co={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},uo={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},lo={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},po={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},mo={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},fo={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},ho={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},go={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},Io={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},yo={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},vo={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},So={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},bo={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},Uo={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},wo={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},To={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Do={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},Po={message:"Court exists",code:"ERR_EXISTING_COURT"},No={message:"Booking not found",code:"ERR_NOT_FOUND_BOOKING"},Eo={message:"Existing matchUps conflict with booking",code:"ERR_EXISTING_MATCHUPS"},Mo={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Ro={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Ao={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},Co={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},ko={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},xo={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},Oo={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Fo={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},_o={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Lo={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},Bo={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},$o={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Vo={message:"Missing context",code:"ERR_MISSING_CONTEXT"},jo={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Go={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Wo={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},qo={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},Ho={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},zo={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Yo={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Ko={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Xo={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Qo={message:"Invalid gender",code:"ERR_INVALID_GENDER"},Jo={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Zo={message:"Invalid values",code:"ERR_INVALID_VALUES"},es={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},ts={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},rs={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},is={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},ns={message:"Value unchanged",code:"ABORT_UNCHANGED"},as={message:"Not found",code:"ERR_NOT_FOUND"},os={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},ss={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},cs={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},us={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},ls={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},ds={message:"Existing stage",code:"ERR_EXISTING_STAGE"},ps={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},ms={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},fs={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},hs={message:"Scores present",code:"ERR_SCORES_PRESENT"},gs={ANACHRONISM:zi,BOOKING_NOT_FOUND:No,CANNOT_CHANGE_WINNING_SIDE:Wa,CANNOT_MODIFY_TIEFORMAT:$a,CANNOT_MODIFY_PARTICIPANT_TYPE:Va,CANNOT_REMOVE_MAIN_STRUCTURE:Ki,CANNOT_REMOVE_PARTICIPANTS:ja,CATEGORY_MISMATCH:Ga,COURT_EXISTS:Po,COURT_NOT_FOUND:Do,EXISTING_MATCHUPS:Eo,DRAW_DEFINITION_NOT_FOUND:an,DRAW_ID_EXISTS:Tn,DRAW_POSITION_ACTIVE:hn,DRAW_POSITION_ASSIGNED:un,DRAW_POSITION_NOT_CLEARED:pn,DRAW_POSITION_NOT_FOUND:{message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},DRAW_SIZE_MISMATCH:bn,DUPLICATE_ENTRY:Yi,DUPLICATE_VALUE:es,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:Io,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:go,EVENT_EXISTS:Wn,EVENT_NOT_FOUND:Gn,EXISTING_DRAW_DEFINITIONS:nn,EXISTING_END_TIME:ko,EXISTING_FLIGHT:ss,EXISTING_MATCHUP_ID:ls,EXISTING_OUTCOME:us,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:co,EXISTING_PARTICIPANT:uo,EXISTING_POLICY_TYPE:Sa,EXISTING_PROFILE:cs,EXISTING_ROUND:xn,EXISTING_STAGE:ds,EXISTING_STRUCTURE:ps,INCOMPATIBLE_MATCHUP_STATUS:ta,INCOMPLETE_SOURCE_STRUCTURE:sn,INSUFFICIENT_DRAW_POSITIONS:So,INVALID_ACTION:En,INVALID_ASSIGNMENT:Mn,INVALID_BOOKINGS:Ma,INVALID_CATEGORY:Jo,INVALID_COLLECTION_DEFINITION:Ko,INVALID_CONFIGURATION:Yo,INVALID_DATE_AVAILABILITY:Ra,INVALID_DATE:Ca,INVALID_DRAW_DEFINITION:tn,INVALID_DRAW_POSITION_FOR_SEEDING:cn,INVALID_DRAW_POSITION:In,INVALID_DRAW_SIZE:Sn,INVALID_END_TIME:Co,INVALID_ENTRIES:Hn,INVALID_EVENT_TYPE:Vn,INVALID_GAME_SCORES:Fa,INVALID_GENDER:Qo,INVALID_MATCHUP_FORMAT:aa,INVALID_MATCHUP_STATUS:ia,INVALID_MATCHUP_STATUS_BYE:Jn,INVALID_MATCHUP:fa,INVALID_OBJECT:Xo,INVALID_PARTICIPANT_ID:Ha,INVALID_PARTICIPANT_IDS:za,INVALID_PARTICIPANT_ROLE:Ya,INVALID_PARTICIPANT_SEEDING:Dn,INVALID_PARTICIPANT_TYPE:Ka,INVALID_PARTICIPANT:qa,INVALID_POLICY_DEFINITION:va,INVALID_RECORDS:Xi,INVALID_SCALE_ITEM:Go,INVALID_SEED_NUMBER:An,INVALID_SEED_POSITION:Cn,INVALID_SET_NUMBER:{message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},INVALID_SIDE_NUMBER:Ua,INVALID_SCORE:_a,INVALID_STAGE:Kn,INVALID_START_TIME:Oo,INVALID_STRUCTURE:on,INVALID_STOP_TIME:xo,INVALID_TIE_FORMAT:na,INVALID_TIME:ka,INVALID_TIME_ITEM:_o,INVALID_TOURNAMENT_DATES:xa,INVALID_TOURNAMENT_RECORD:Zi,INVALID_VALUES:Zo,INVALID_WINNING_SIDE:La,MATCHUP_NOT_FOUND:da,METHOD_NOT_FOUND:ms,MISSING_ASSIGNMENTS:zn,MISSING_ASYNC_STATE_PROVIDER:Lo,MISSING_AVOIDANCE_POLICY:Ia,MISSING_BIRTH_DATE:Pa,MISSING_COLLECTION_DEFINITION:sa,MISSING_COURT_ID:Ta,MISSING_COURTS_INFO:To,MISSING_DATE_AVAILABILITY:Aa,MISSING_DATE:Na,MISSING_DRAW_DEFINITION:rn,MISSING_DRAW_ID:wn,MISSING_DRAW_POSITION:yn,MISSING_DRAW_POSITIONS:fn,MISSING_DRAW_SIZE:Un,MISSING_ENTRIES:qn,MISSING_EVENT:jn,MISSING_QUALIFIED_PARTICIPANTS:eo,MISSING_MATCHUP_FORMAT:oa,MISSING_MATCHUP_ID:ua,MISSING_MATCHUP_IDS:la,MISSING_MATCHUP:ma,MISSING_MATCHUPS:pa,MISSING_PARTICIPANT_COUNT:ao,MISSING_PARTICIPANT_ID:Za,MISSING_PARTICIPANT_IDS:no,MISSING_PARTICIPANT_ROLE:Xa,MISSING_PARTICIPANT:Qa,MISSING_PARTICIPANTS:Ja,MISSING_PENALTY_ID:Uo,MISSING_PENALTY_TYPE:bo,MISSING_PERSON_DETAILS:so,MISSING_POLICY_ATTRIBUTES:ya,MISSING_POLICY_DEFINITION:ga,MISSING_POLICY_TYPE:ha,MISSING_POSITION_ASSIGNMENTS:Qn,MISSING_ROUND_NUMBER:{message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},MISSING_SCHEDULE:jo,MISSING_SCORING_POLICY:{message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},MISSING_SEED_ASSIGNMENTS:Rn,MISSING_SEEDCOUNT_THRESHOLDS:Nn,MISSING_SEEDING_POLICY:{message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},MISSING_SET_NUMBER:{message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},MISSING_SET_OBJECT:wa,MISSING_SIDE_NUMBER:{message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},MISSING_STAGE:Yn,MISSING_STRUCTURE_ID:On,MISSING_STRUCTURE:Ln,MISSING_MAIN_STRUCTURE:Bn,MISSING_STRUCTURES:_n,MISSING_TARGET_LINK:kn,MISSING_TIE_FORMAT:ca,MISSING_TIME_ITEM:Bo,MISSING_TIME_ITEMS:$o,MISSING_TOURNAMENT_ID:en,MISSING_TOURNAMENT_RECORD:Ji,MISSING_TOURNAMENT_RECORDS:Qi,MISSING_VALUE:Da,MISSING_VENUE_ID:Ao,MODIFICATIONS_FAILED:Wo,NO_CANDIDATES:zo,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:vo,NO_MODIFICATIONS_APPLIED:qo,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:yo,NO_PARTICIPANT_REMOVED:io,NO_VALID_ACTIONS:rs,NO_VALID_ATTRIBUTES:is,NO_VALID_DATES:Ea,NOT_FOUND:as,NOT_IMPLEMENTED:os,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:lo,PARTICIPANT_ID_EXISTS:ro,PARTICIPANT_NOT_CHECKED_IN:oo,PARTICIPANT_NOT_FOUND:to,PARTICIPANT_PAIR_EXISTS:{message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},PENALTY_NOT_FOUND:wo,POLICY_NOT_ATTACHED:{message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},POLICY_NOT_FOUND:ba,SCHEDULE_NOT_CLEARED:ln,SCHEDULE_CONFLICT_DOUBLE_BOOKING:dn,SCHEDULED_MATCHUPS:fs,SCORES_PRESENT:hs,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Pn,STAGE_SEQUENCE_LIMIT:Xn,STRUCTURE_NOT_FOUND:Fn,TEAM_NOT_FOUND:ts,UNABLE_TO_ASSIGN_COURT:Ho,UNLINKED_STRUCTURES:$n,UNRECOGNIZED_DRAW_TYPE:mn,UNRECOGNIZED_MATCHUP_FORMAT:ea,UNRECOGNIZED_MATCHUP_STATUS:Zn,VALUE_UNCHANGED:ns,VENUE_EXISTS:Mo},Is={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},ys={addNotice:function({topic:e,payload:t,key:r},i){if("string"==typeof e&&"object"==typeof t&&(Is.disableNotifications||(Is.modified=!0),!Is.disableNotifications&&(Is.subscriptions[e]||i)))return r&&(Is.notices=Is.notices.filter(t=>!(t.topic===e&&t.key===r))),Is.notices.push({topic:e,payload:t,key:r}),{...Gi}},callListener:function({topic:e,notices:t},r){let i=Is.subscriptions[e];i&&"function"==typeof i&&i(t);let n=r?.[e];n&&"function"==typeof n&&n(t)},cycleMutationStatus:function(){let e=Is.modified;return Is.modified=!1,e},deleteNotice:function({topic:e,key:t}){Is.notices=Is.notices.filter(r=>(!e||r.topic===e)&&r.key!==t)},deleteNotices:function(){Is.notices=[]},disableNotifications:function(){Is.disableNotifications=!0},enableNotifications:function(){Is.disableNotifications=!1},getMethods:Ss,getNotices:function({topic:e}){return Is.notices.filter(t=>t.topic===e).map(e=>e.payload)},getTopics:function(){return{topics:Object.keys(Is.subscriptions)}},getTournamentId:vs,getTournamentRecord:function(e){return Is.tournamentRecords[e]},getTournamentRecords:function(){return Is.tournamentRecords},removeTournamentRecord:function(e){if("string"!=typeof e)return{error:Zo};if(!Is.tournamentRecords[e])return{error:as};delete Is.tournamentRecords[e];let t=Object.keys(Is.tournamentRecords);return 1===t.length?Is.tournamentId=t[0]:t.length||(Is.tournamentId=void 0),{success:!0}},setMethods:function(e){return"object"!=typeof e?{error:Zo}:(Object.keys(e).forEach(t=>{"function"==typeof e[t]&&(Is.methods[t]=e[t])}),{...Gi})},setSubscriptions:function(e){return null===e.subscriptions||0===Object.keys(e.subscriptions).length?(Is.subscriptions={},{...Gi}):"object"!=typeof e.subscriptions?{error:Zo}:(Object.keys(e.subscriptions).forEach(t=>{"function"==typeof e.subscriptions[t]?Is.subscriptions[t]=e.subscriptions[t]:delete Is.subscriptions[t]}),{...Gi})},setTournamentId:function(e){return e?Is.tournamentRecords[e]?(Is.tournamentId=e,{success:!0}):{error:Ji}:(Is.tournamentId=void 0,{success:!0})},setTournamentRecord:function(e){let t=e?.tournamentId;return t?(Is.tournamentRecords[t]=e,{success:!0}):{error:Zi}},setTournamentRecords:function(e){Is.tournamentRecords=e;let t=Object.keys(e);1===t.length?Is.tournamentId=t[0]:t.length||(Is.tournamentId=void 0)},handleCaughtError:function({engineName:e,methodName:t,params:r,err:i}){let n;return"string"==typeof i?n=i.toUpperCase():i instanceof Error&&(n=i.message),console.log("ERROR",{tournamentId:vs(),params:JSON.stringify(r),engine:e,methodName:t,error:n}),{error:n}}};function vs(){return Is.tournamentId}function Ss(){return Is.methods??{}}var bs={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Us=ys,ws=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function Ts(e){if("object"!=typeof e)throw new Error("Global state provider can not be undefined or null");if(Ci(Object.keys(e),ws).length!==ws.length)throw new Error("Global state provider is missing required methods");return Us=e,{success:!0}}function Ds(){if(Us.createInstanceState){try{Us.createInstanceState()}catch(oe){return{error:oe}}return{success:!0}}return{error:Lo}}function Ps(e){return e&&"object"==typeof e?"object"==typeof bs.devContext&&(Object.keys(e).every(t=>bs.devContext?.[t]===e[t])&&bs.devContext):bs.devContext??!1}function Ns(e="reset",t="default"){let r=Date.now();if("report"===e){if("allTimers"===t)return Object.keys(bs.timers).filter(e=>"default"!==e||bs.timers[e].startTime).map(e=>{let t=bs.timers[e],i="stopped"===t.state?0:(r-(t?.startTime??0))/1e3,n=t.elapsedTime+i;return{state:bs.timers[e].state,elapsedTime:n.toFixed(2),timer:e}});{let e="stopped"===bs.timers[t].state?0:(r-(bs.timers[t]?.startTime??0))/1e3,i=bs.timers[t].elapsedTime+e;return{state:bs.timers[t].state,elapsedTime:i.toFixed(2),timer:t}}}if(!bs.timers[t]||"reset"===e){if("allTimers"===t)return bs.timers={default:{elapsedTime:0}},!0;bs.timers[t]={startTime:r,state:"active",elapsedTime:0}}return bs.timers[t].elapsedTime||(bs.timers[t].elapsedTime=0),"stop"===e&&"stopped"!==bs.timers[t].state&&(bs.timers[t].state="stopped")&&(bs.timers[t].elapsedTime+=(r-(bs.timers[t]?.startTime??0))/1e3),"start"===e&&(bs.timers[t].startTime=r)&&(bs.timers[t].state="active"),bs.timers[t]}function Es(e){Zr(e)?bs.globalLog=e:delete bs.globalLog}function Ms(e){bs.devContext=e}function Rs(){Us.disableNotifications()}function As(){Us.enableNotifications()}function Cs(e,t){"boolean"==typeof e&&(bs.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(bs.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(bs.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(bs.deepCopyAttributes.stringify=t.stringify),t.threshold&&(bs.deepCopyAttributes.threshold=t.threshold))}function ks(){return{enabled:bs.deepCopy,...bs.deepCopyAttributes}}function xs(e){return e?.subscriptions?(Object.keys(e.subscriptions).forEach(t=>{bs.globalSubscriptions[t]=e.subscriptions[t]}),{...Gi}):{error:Da,info:"missing subscriptions"}}function Os(e){return e?.subscriptions?Us.setSubscriptions({subscriptions:e.subscriptions}):{error:Da,info:"missing subscriptions"}}function Fs(e){return e?"object"!=typeof e?{error:Zo}:(Object.keys(e).forEach(t=>{Zr(e[t])&&(bs.globalMethods[t]=e[t])}),{...Gi}):{error:Da,info:"missing method declarations"}}function _s(e){return e?"object"!=typeof e?{error:Zo}:Us.setMethods(e):{error:Da,info:"missing method declarations"}}function Ls(){return Us.cycleMutationStatus()}function Bs(e){if("string"!=typeof e?.topic)return;let t=bs.globalSubscriptions[e.topic];return Us.addNotice(e,t)}function $s(){return{...bs.globalMethods,...Us.getMethods()}}function Vs(e){return Us.getNotices(e)}function js({key:e,topic:t}){return Us.deleteNotice({key:e,topic:t})}function Gs(){return Us.deleteNotices()}function Ws(){return Us.getTopics()}function qs(e){return Ws()?.topics?.includes(e)}async function Hs(e){return Us.callListener(e,bs.globalSubscriptions)}function zs(){return Us.getTournamentId()}function Ys(e){return Us.getTournamentRecord(e)}function Ks(){return Us.getTournamentRecords()}function Xs(e){return Us.setTournamentRecord(e)}function Qs(e){return Us.setTournamentRecords(e)}function Js(e){return Us.setTournamentId(e)}function Zs(e){return Us.removeTournamentRecord(e)}function ec(){return Us}function tc({engineName:e,methodName:t,params:r,err:i}){let n=Zr(Us.handleCaughtError)&&Us.handleCaughtError||ys.handleCaughtError,{tournamentRecord:a,...o}=r;return n({params:o,engineName:e,methodName:t,err:i})}function rc(e,t){if(bs.globalLog)try{bs.globalLog({log:e,engine:t})}catch(r){console.log("globalLog error",r),console.log(t,e),Es()}else console.log(t,e)}function ic(e,t,r,i){if(!ti(e))return{error:Zo};pi||(r=1);let n=Array.isArray(t)?t:[],a={},o=(e,i=0)=>{Object.keys(e).forEach(s=>{Zr(e[s])?a[s]=e[s]:ti(e[s])&&(!0===t||n?.includes(s))&&(void 0===r||i<r)&&o(e[s],i+1)})};return o(e),i?Fs(a):_s(a),{methods:a}}function nc(e,t,r,i){if("object"!=typeof e||null===e)return e;ks()?.enabled||(i=!0);let n=["",void 0,null];t&&n.push(!1);let a=function(e,t,r){return Object.keys(e).filter(i=>!t.includes(e[i])&&(!r||!Array.isArray(e[i])||e[i].length))}(e,n,r);return Object.assign({},...a.map(t=>Array.isArray(e[t])?{[t]:i?e[t]:e[t].map(e=>nc(e))}:{[t]:i?e[t]:nc(e[t])}))}function ac({context:e,result:t,stack:r,info:i}){return t&&!Array.isArray(t?.stack)&&(t.stack=[]),t&&Array.isArray(t?.stack)&&"string"==typeof r&&t.stack.push(r),t&&i&&(t.info=i),t&&"object"==typeof e&&Object.keys(e).length&&(t.context||(t.context={}),Object.assign(t.context,nc(e))),t&&!t?.error&&!t?.success&&Object.assign(t,{...Gi}),t??{success:!0}}var oc="FEMALE",sc="OTHER",cc="MIXED",uc="MALE",lc={FEMALE_ABBR:"F",OTHER_ABBR:"O",MIXED_ABBR:"X",MALE_ABBR:"M",ANY_ABBR:"A",FEMALE:oc,MIXED:cc,OTHER:sc,MALE:uc,ANY:"ANY"};function dc(e){return[oc,"F"].includes(e)}function pc(e){return[uc,"M"].includes(e)}function mc(e){return[cc,"X"].includes(e)}function fc(e){return["ANY","A"].includes(e)}function hc(e){if(e){if(dc(e))return oc;if(mc(e))return cc;if(pc(e))return uc;if(fc(e))return"ANY"}return sc}function gc(e){return dc(e)||pc(e)}function Ic(e){let t="tieFormatGenderValidityCheck",{referenceGender:r,matchUpType:i,gender:n}=e;return r&&n&&gc(r)&&hc(r)!==hc(n)?ac({result:{valid:!1,error:Qo},context:{gender:n},stack:t}):mc(r)&&(fc(n)||mc(n)&&i!==Hr)?ac({result:{error:Qo,valid:!1},info:"MIXED events can not contain mixed singles or { gender: ANY } collections",stack:t}):fc(r)&&mc(n)&&i!==Hr?ac({result:{error:Qo,valid:!1},info:"events with { gender: ANY } can not contain MIXED singles collections",stack:t}):{valid:!0}}var yc="timed",vc="NOAD",Sc=["SET","HAL","QTR","PER","INN","RND","FRM","MAP","MAT"],bc="CONSECUTIVE",Uc="TRADITIONAL",wc={S:"normal",F:"final",G:"game"};function Tc(e,t){if(ti(e)&&(e?.bestOf||e?.exactly)&&e?.setFormat)return function(e,t){let r=Dc(e.bestOf)||void 0,i=Dc(e.exactly)||void 0,n=r||i;if(e.setFormat?.timed&&e.simplified&&1===n)return Pc(e.setFormat);let a=e.matchRoot||"SET",o=i&&1!==i?"X":"",s=e.aggregate?"A":"",c=n&&`${a}${n}${o}${s}`||"",u=Nc(e.setFormat,t),l=u&&`S:${u}`||"",d=Nc(e.finalSetFormat,t),p=n&&n>1&&d&&u!==d&&`F:${d}`||"",m=e.gameFormat?`G:${function(e){let t=e?.deuceAfter?`${e.deuceAfter}D`:"";if(e?.type===Uc)return`TN${t}`;if(e?.type===bc&&Number.isInteger(e.count))return`${e.count}C${t}`}(e.gameFormat)}`:"";if(c&&u)return[c,l,m,p].filter(Boolean).join("-")}(e,t)}function Dc(e){return!Number.isNaN(Number(e))&&Number(e)}function Pc(e){let t=`T${e.minutes}`;return"P"===e.based&&(t+="P"),e.tiebreakFormat?.tiebreakTo&&(t+=`/TB${e.tiebreakFormat.tiebreakTo}`),e.modifier&&(t+=`@${e.modifier}`),t}function Nc(e,t){if("object"==typeof e&&Object.keys(e).length){if(e.timed)return Pc(e);if(e.tiebreakSet)return Ec(e.tiebreakSet);let r=Dc(e.setTo);if(r){let i=e.NoAD&&vc||"",n=Ec(e.tiebreakFormat),a=n&&`/${n}`||"",o=Dc(e.tiebreakAt);if(!1!==n)return`${r}${i}${a}${o&&(o!==r||t)&&`@${o}`||""}`}}}function Ec(e){if(e){if("object"==typeof e&&!e.tiebreakTo)return"";if("object"==typeof e&&Dc(e.tiebreakTo)){let t=`TB${e.tiebreakTo}${e.NoAD?vc:""}`;return e.modifier&&(t+=`@${e.modifier}`),t}return!1}}function Mc(e){if(ei(e)){let t=e.startsWith("T")&&yc||Sc.some(t=>e.startsWith(t))&&"SET"||"";if(t===yc){let t=xc(e);if(t)return{simplified:!0,setFormat:t,bestOf:1}}if("SET"===t)return function(e){let t=e.split("-"),r=function(e){let t=Sc.find(t=>e.startsWith(t));if(!t)return;let r=e.slice(t.length),i=/^(\d+)([A-Z]*)$/.exec(r);if(!i)return;let n=Fc(i[1]);if(!n)return;let a=i[2],o=!1,s=!1,c=[];for(let u of a)"X"===u?o=!0:"A"===u?s=!0:c.push(u);return{matchRoot:t,count:n,exactly:o,aggregate:s,matchMods:c}}(t[0]);if(!r)return;let i,n,a,{matchRoot:o,count:s,exactly:c,aggregate:u,matchMods:l}=r,d=c&&1!==s?void 0:s,p=c&&1!==s?s:void 0,m=0,f=0,h=0;for(let y=1;y<t.length;y++){let e=t[y].indexOf(":");if(e<0)return;let r=t[y].slice(0,e),o=t[y].slice(e+1);if(!(r in wc))return;if("S"===r){if(m++,m>1)return;i=Ac(t[y],o)}else if("F"===r){if(f++,f>1)return;n=Ac(t[y],o)}else if("G"===r&&(h++,h>1||(a=Rc(o),!a)))return}let g=i&&i.timed||n&&n.timed;if("SET"===o&&!(d&&d<6||g&&p)||!i||n&&!n)return;let I=nc({setFormat:i,exactly:p,bestOf:d});return"SET"!==o&&(I.matchRoot=o),u&&(I.aggregate=!0),l.length>0&&(I.matchMods=l),n&&(I.finalSetFormat=n),a&&(I.gameFormat=a),I}(e)}}function Rc(e){let t=/^(.+?)(\d+D)$/.exec(e),r=t?t[1]:e,i=t?Number(t[2].slice(0,-1)):void 0;if(void 0!==i&&(i<1||!Number.isInteger(i)))return;if("TN"===r){let e={type:Uc};return i&&(e.deuceAfter=i),e}let n=/^([1-9]\d*)C$/.exec(r);if(n){let e={type:bc,count:Number(n[1])};return i&&(e.deuceAfter=i),e}}function Ac(e,t){return t.startsWith("TB")?function(e){let t=kc(e);return!1!==t&&("object"==typeof t?{tiebreakSet:t}:void 0)}(t):t.startsWith("T")?xc(t):function(e,t){let r=/^[FS]:(\d+)([A-Za-z]*)/.exec(e),i=r&&Oc(r[2])||!1,n=!r?.[2]||i,a=r?Fc(r[1]):void 0,o=Cc(t),s=!1!==o,c=s&&o||a,u=kc(t.split("/")[1]);return!!(a&&n&&!1!==u&&s)&&function(e,t,r,i){let n={setTo:e};return t&&(n.NoAD=!0),r?(n.tiebreakFormat=r,n.tiebreakAt=i):n.noTiebreak=!0,n}(a,i,u,c)}(e,t)}function Cc(e,t=!0){let r=e?.indexOf("@")>0&&e.split("@");if(r)return(t?Fc(r[1]):r[1])||!1}function kc(e){if(e)return!!e.startsWith("TB")&&function(e){let t=Cc(e,!1),r=/^TB(\d+)([A-Za-z]*)/.exec(e),i=r?.[1],n=r&&Oc(r[2]),a=!r?.[2]||n,o=Fc(i);if(!o||!a)return!1;let s={tiebreakTo:o};return t&&"string"==typeof t&&!gi(t)&&(s.modifier=t),n&&(s.NoAD=!0),s}(e)}function xc(e){let t=e.slice(1),r=/^(\d+)([PG])?(?:\/TB(\d+))?(@[A-Za-z]+)?$/.exec(t),i=Fc(r?.[1]);if(!i)return;let n={timed:!0,minutes:i},a=r?.[2];"P"===a?n.based="P":"G"===a&&(n.based="G");let o=r?.[3];if(o){let e=Fc(o);e&&(n.tiebreakFormat={tiebreakTo:e})}let s=r?.[4],c=[void 0,"P","G",""].includes(s);if(s&&!c){let e=/^(\d+)([PGA])?(?:\/TB\d+)?(@)([A-Za-z]+)$/.exec(t)?.[4];return e?(n.modifier=e,n):void 0}return s&&(n.based=s),n}function Oc(e){return e?.includes(vc)}function Fc(e){let t=Number(e);return Number.isNaN(t)?0:t}function _c({matchUpFormat:e}){if(!ei(e)||""===e)return!1;let t=Mc(e),r=/-S:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(e),i=r?.[1],n=r?.[2],a=r?.[3],o=/-F:(\d+)\/TB(\d{1,2})@?(\d?)/.exec(e),s=o?.[1],c=o?.[2],u=o?.[3];return Tc(t,!!(r&&n&&i===a||o&&c&&s===u))===function(e){return e.replaceAll(/T(\d+)G(?=\/TB|@|-|$)/g,"T$1")}(e)}var Lc=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1])$/,Bc=/^((0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)([.,]\d{3})?$/,$c=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))([ T](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/,Vc=/^(\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2]\d|3[0-1]))?([ T]?(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?)?([.,]\d{3})?Z?$/;function jc(e){let{scheduledDate:t}=e;if(!t&&e.scheduledTime&&(t=iu(e.scheduledTime)),!t)return;let r=ru(e.scheduledTime),i=iu(t);return i&&r&&(i+=`T${r}`),i}function Gc(e){return"object"==typeof e&&!Array.isArray(e)&&"[object Date]"===Object.prototype.toString.call(e)}function Wc(e){let t="string"==typeof e?e?.split(" "):[];if(e&&t?.length>1&&!["AM","PM"].includes(t[1].toUpperCase()))return!1;let r=ou(e,!0,!0);return!!(!e||r&&Vc.test(r))}function qc(e){return Jc(e)||Lc.test(e)}var Hc=e=>{let t=Kc(e)||Jc(e)?new Date(e):new Date,r=t.getUTCMonth()+1,i=r<10?`0${r}`:`${r}`;return`${t.getUTCFullYear()}-${mu(i)}-${mu(t.getUTCDate())}`};function zc(e,t="-",r="YMD"){if(!e)return"";"string"==typeof e&&!e.includes("T")&&(e+="T00:00");let i=new Date(e),n=""+(i.getMonth()+1),a=""+i.getDate(),o=i.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),"DMY"===r?[a,n,o].join(t):"MDY"===r?[n,a,o].join(t):"YDM"===r?[o,a,n].join(t):"DYM"===r?[a,o,n].join(t):"MYD"===r?[n,o,a].join(t):[o,n,a].join(t)}function Yc(e){let t=e?new Date(e):new Date,r=t.getTimezoneOffset();return new Date(t.getTime()-60*r*1e3)}function Kc(e){if("boolean"==typeof e)return!1;let t=e instanceof Date&&e||!Number.isNaN(Number(e))&&new Date(e)||!1;return t&&!Number.isNaN(Number(t.valueOf()))}function Xc(e,t){if(!qc(e)||!qc(t))return[];let r=iu(e)+"T00:00",i=iu(t)+"T00:00",n=new Date(r),a=new Date(i),o=Kc(a)&&Kc(n)&&function(e,t){return e<=t}(n,a),s=[],c=0;if(o){let e=n,t=e.getTime();for(;t<=a.getTime()&&c<300;)c+=1,s.push(new Date(e)),t=e.setDate(e.getDate()+1)}return s.map(e=>zc(e))}var Qc=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Jc(e){return"string"==typeof e&&Qc.test(e)}function Zc(e){if("string"!=typeof e)return!1;let t=e.split("Z")[0].split(":"),r=t.every(e=>!Number.isNaN(Number.parseInt(e)));return!(t.length<2||!r||Number.parseInt(t[0])>23||Number.parseInt(t[1])>60)}function eu(e){let t=ru(e);if(!t)return 0;let[r,i]=t.split(":").map(e=>Number.parseInt(e));return 60*r+i}function tu(e){return Zc(e)?e.split(":").slice(0,2).map(mu).join(":"):void 0}function ru(e){return Jc(e)&&e.indexOf("T")>0?tu(e.split("T").reverse()[0]):tu(e)}function iu(e){return Jc(e)||$c.test(e)?e.split("T")[0]:""}function nu(e,t){let r=new Date(e);return r.setDate(r.getDate()+t),iu(r.toISOString())}function au(e){e="string"==typeof e?e:"00:00";let t={},r={};return({0:t.time,1:t.ampm}=e.split(" ")||[]),({0:r.hours,1:r.minutes}=t.time.split(":")||[]),r.ampm=t.ampm,Number.isNaN(Number.parseInt(r.hours))||Number.isNaN(Number.parseInt(r.minutes))||r.ampm&&!["AM","PM"].includes(r.ampm.toUpperCase())?{}:r}function ou(e,t,r){let i=iu(e),n=ru(e),a=i?n:e;return e?t&&(i&&r&&e||function(e){let t=au(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&Number.parseInt(t.hours)<12&&(t.hours=(t.hours&&Number.parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),`${t.hours||"12"}:${t.minutes||"00"}`.split(":").map(mu).join(":")}(a))||function(e){let t=au(e);if("object"!=typeof t||Object.keys(t).length)return t.ampm?e:(t.hours>12?(t.hours-=12,t.ampm="PM"):"12"===t.hours?t.ampm="PM":("00"===t.hours&&(t.hours="12"),t.ampm="AM"),"0"===t.hours?.[0]&&(t.hours=t.hours.slice(1)),`${t.hours||"12"}:${t.minutes||"00"} ${t.ampm}`)}(a):void 0}function su(e,t){let r=au(e),i=au(t);if(Number.parseInt(r.hours)<Number.parseInt(i.hours))return-1;if(Number.parseInt(r.hours)>Number.parseInt(i.hours))return 1;if(r.hours===i.hours){if(Number.parseInt(r.minutes)<Number.parseInt(i.minutes))return-1;if(Number.parseInt(r.minutes)>Number.parseInt(i.minutes))return 1}return 0}function cu(e,t=7){let r=iu(e)+"T00:00",i=new Date(r);return zc(new Date(i.setDate(i.getDate()+t)))}function uu(e,t=void 0){let[r,i]=(e||"00:00").split(":").map(mu),n=Yc(t).setHours(r,i,0,0);return Yc(n)}function lu(e,t,r=!0){let i=new Date(e),n=(new Date(t).getTime()-i.getTime())/1e3/60;return r?Math.abs(Math.round(n)):Math.round(n)}function du(e,t){let r=ru(e);if(!r)return"00:00";let i=Number.isNaN(t)?0:t;return ru(pu(uu(r),i).toISOString())||"00:00"}function pu(e,t){let r=new Date(e);return new Date(r.getTime()+6e4*t)}function mu(e){return e.toString()[1]?e:"0"+e}function fu(e,t){let r=new Date(e),i=new Date(t);return r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth()&&r.getDate()===i.getDate()}var hu={addDays:cu,addWeek:function(e){return cu(e)},addMinutesToTimeString:du,convertTime:ou,getIsoDateString:jc,getUTCdateString:Hc,DateHHMM:function(e){let t=new Date(e);return function(e,t){let r=Number.parseInt(e,10),i=Math.floor(r/3600),n=Math.floor((r-3600*i)/60),a=r-3600*i-60*n;return(!t||t?.displaySeconds?i+":"+n+":"+a:i+":"+n).split(":").map(mu).join(":")}(t.getSeconds()+60*t.getMinutes()+3600*t.getHours(),{displaySeconds:!1})},extractDate:iu,extractTime:ru,formatDate:zc,getDateByWeek:function(e,t,r,i=!1){let n=new Date(t,0,1+7*(e-1)),a=i?0:1;return n.setDate(n.getDate()+(a-n.getDay())),zc(n,r)},isISODateString:Jc,isDate:Kc,isTimeString:Zc,offsetDate:Yc,offsetTime:function(e){return Yc(e).getTime()},sameDay:fu,timeStringMinutes:eu,timeToDate:uu,timeUTC:function(e){let t=Kc(e)||Jc(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},validTimeValue:Wc,validDateString:Lc,timeValidation:Vc,dateValidation:$c};function gu(e,t){return`${e}-${t}`}function Iu(e){let t=e.category;if("object"!=typeof t||!t)return{error:Jo};let r,{ageCategoryCode:i,ageMaxDate:n,ageMinDate:a,ageMax:o,ageMin:s}=t,c=t.categoryName;if(!(((e,t)=>e.filter(Boolean).every(e=>typeof e===t))([i,n,a,c],"string")&&(e=>e.filter(Boolean).every(pi))([o,s])&&[n,a].filter(Boolean).every(qc)))return{error:Jo};let u=e.consideredDate??iu((new Date).toLocaleDateString("sv"));if(!u||!qc(u))return{error:Ca};let[l]=u.split("-").slice(0,3).map(e=>Number.parseInt(e)),d=nu(u,-1);if(!d)return{error:Ca};let[p,m]=d.split("-").slice(1,3).map(e=>Number.parseInt(e)),f=`${mu(p)}-${mu(m)}`,h=nu(u,1);if(!h)return{error:Ca};let[g,I]=h.split("-").slice(1,3).map(e=>Number.parseInt(e)),y=`${mu(g)}-${mu(I)}`,v=s&&nu(u,-365*s),S=o&&nu(u,-365*o),b=[],U=e=>!b.includes(e)&&b.push(e);i=i??c;let w=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,D=i?.includes("-"),P=D&&i?.match(T),N=i?.match(w);function E(e){let r=gu(l-e-1,y);t.ageMin&&t.ageMin>e&&U(`Invalid submitted ageMin: ${s}`),t.ageMax&&t.ageMax>e&&U(`Invalid submitted ageMax: ${o}`),t.ageMinDate&&t.ageMinDate!==r&&U(`Invalid submitted ageMinDate: ${a}`),a=r,i&&(t.ageMax&&t.ageMax!==e&&(U(`Invalid submitted ageMax: ${o}`),v=void 0),o=e)}function M(e){let r=gu(l-e,f);t.ageMaxDate&&t.ageMaxDate!==r&&U(`Invalid submitted ageMaxDate: ${n}`),n=r,i&&(t.ageMin&&t.ageMin!==e+1&&(U(`Invalid submitted ageMin: ${s}`),v=void 0),s=e+1)}function R(e){let r=w.exec(e)||[],[c,u,d]=r.slice(1),p=Number.parseInt(u);"U"===c?(t.ageMaxDate&&t.ageMaxDate!==n&&U(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),function(e){let r=gu(l-e,y);t.ageMinDate&&t.ageMinDate!==r&&U(`Invalid submitted ageMinDate: ${a}`),a=r,i&&(t.ageMax&&t.ageMax!==e-1&&(U(`Invalid submitted ageMax: ${o}`),S=void 0),o=e-1)}(p)):"O"===c&&M(p),"U"===d?(t.ageMaxDate&&t.ageMaxDate!==n&&U(`Invalid submitted ageMaxDate: ${t.ageMaxDate}`),E(p)):"O"===d&&function(e){let r=gu(l-e-1,f);t.ageMaxDate&&t.ageMaxDate!==r&&U(`Invalid submitted ageMaxDate: ${n}`),n=r,i&&(t.ageMin&&t.ageMin!==e&&(U(`Invalid submitted ageMin: ${s}`),v=void 0),s=e)}(p),n=(n??v)||void 0,a=(a??S)||void 0}P?function(){if(n=void 0,a=void 0,o=void 0,s=void 0,t.ageMin){let e=l-t.ageMin;n=gu(e,f)}if(t.ageMax){let e=l-t.ageMax-1;a=gu(e,y)}let[e,c]=(i?.match(T)??[]).slice(1).map(e=>Number.parseInt(e));e<=c?(s=e,o=c,r=!0):U(`Invalid combined age range ${i}`)}():D?i?.split("-").forEach(R):N&&i?R(i):(s&&M(s),o&&E(o)),o&&t?.ageMin&&t?.ageMin>o&&(U(`Invalid submitted ageMin: ${t?.ageMin}`),s=void 0);let A=nc({consideredDate:u,combinedAge:r,ageMaxDate:n,ageMinDate:a,ageMax:o,ageMin:s});return b.length&&(A.errors=b),A}function yu({category:e}){if(!ti(e))return{error:Zo};let t=Iu({category:e});if(t.error)return{error:t};let{ratingMax:r,ratingMin:i}=e;return r&&!pi(r)?ac({result:{error:Zo},context:{ratingMax:r}}):i&&!pi(i)?ac({result:{error:Zo},context:{ratingMin:i}}):{...t}}function vu({childCategory:e,withDetails:t,category:r}){let i=yu({category:r}),n=yu({category:e}),a=n.ageMin&&(i.ageMin&&n.ageMin<i.ageMin||i.ageMax&&n.ageMin>i.ageMax),o=n.ageMax&&(i.ageMax&&n.ageMax>i.ageMax||i.ageMin&&n.ageMax<i.ageMin),s=n.ageMinDate&&i.ageMaxDate&&new Date(n.ageMinDate)>new Date(i.ageMaxDate),c=n.ageMaxDate&&i.ageMinDate&&new Date(n.ageMaxDate)<new Date(i.ageMinDate),u=r?.ratingType&&e?.ratingType&&r.ratingType===e.ratingType&&(r.ratingMin&&e.ratingMin&&e.ratingMin<r.ratingMin||r.ratingMax&&e.ratingMax&&e.ratingMax>r.ratingMax||r.ratingMin&&e.ratingMax&&e.ratingMax<r.ratingMin||r.ratingMax&&e.ratingMin&&e.ratingMin>r.ratingMax),l=r?.ballType&&e?.ballType&&r.ballType!==e.ballType,d=nc({invalidRatingRange:u,invalidAgeMinDate:s,invalidAgeMaxDate:c,invalidBallType:l,invalidAgeMax:o,invalidAgeMin:a,valid:!(u||s||c||l||o||a)},!0);return t&&Object.assign(d,{categoryDetails:i,childCategoryDetails:n}),d}function Su({checkCategory:e=!0,collectionDefinition:t,checkCollectionIds:r,checkGender:i=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??o?.gender;let s="validateCollectionDefinition",c=[];if("object"!=typeof t)return c.push(`collectionDefinition must be an object: ${t}`),ac({result:{errors:c,error:Xo},stack:s});let{collectionValueProfiles:u,collectionGroupNumber:l,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:f,matchUpValue:h,matchUpType:g,scoreValue:I,setValue:y,category:v,gender:S}=t;if(r&&"string"!=typeof p&&c.push(`collectionId is not type string: ${p}`),"number"!=typeof m&&c.push(`matchUpCount is not type number: ${m}`),g&&!ji([Wr,Hr],g)&&c.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),1!==[!!u?.length].concat([h,d,I,y].map(gi)).filter(Boolean).length&&c.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),h&&"number"!=typeof h&&c.push(`matchUpValue is not type number: ${h}`),d&&"number"!=typeof d&&c.push(`collectionValue is not type number: ${d}`),u&&m){let e=Hi({collectionValueProfiles:u,matchUpCount:m});e.errors&&c.push(...e.errors)}if(l&&"number"!=typeof l&&c.push(`collectionGroupNumber is not type number: ${d}`),f&&!_c({matchUpFormat:f})&&c.push(`Invalid matchUpFormat: ${f}`),i){let e=Ic({referenceGender:a,matchUpType:g,gender:S});if(e.error)return ac({context:{referenceGender:a,gender:S},result:e,stack:s})}if(e&&n&&v){let e=vu({category:n,childCategory:v});if(!e.valid)return ac({result:{error:Jo},context:e,stack:s})}return c.length?ac({result:{errors:c,error:Ko},stack:s}):{valid:!0}}function bu(e){let t=!(!1===e?.enforceCategory||!e?.category),r=!(!1===e?.enforceGender||!e?.gender),i=e?.checkCollectionIds,n=e?.tieFormat,a=e?.event,o="validateTieFormat",s=[],c=function(e){let{tieFormat:t,stack:r}=e;return e&&t&&ti(t)?ti(t.winCriteria)?Array.isArray(t.collectionDefinitions)?{...Gi}:ac({result:{error:na},context:{tieFormat:t,message:"collectionDefinitions must be an array"},stack:r}):ac({result:{error:na},context:{tieFormat:t,message:"tieformat.winCritiera must be an object"},stack:r}):ac({result:{error:na},context:{tieFormat:t,message:"tieformat must be an object"},stack:r})}({...e,stack:o});if(c?.error)return c;let u,l=n.collectionDefinitions.every(n=>{let{setValue:o,scoreValue:c,collectionValue:l}=n;(o||c)&&!l&&(u=!0);let{valid:d,errors:p}=Su({referenceCategory:e.category,referenceGender:e.gender,collectionDefinition:n,checkCollectionIds:i,checkCategory:t,checkGender:r,event:a});return!!d||(Array.isArray(p)&&s.push(...p),!1)}),d="number"==typeof n.winCriteria?.valueGoal&&n.winCriteria?.valueGoal>0&&!u||n.winCriteria?.aggregateValue;if(!d&&!n.winCriteria?.aggregateValue)return u?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ac({context:{tieFormat:n,errors:s,aggregateValueImperative:u},result:{error:na},stack:o});let p=n.collectionDefinitions.map(({collectionId:e})=>e),m=!i||p.length===vi(p).length,f=l&&d&&m;return f?{valid:f,errors:s}:ac({result:{error:na},context:{tieFormat:n,errors:s},stack:o})}var Uu="resourceSubType",wu="resourceType",Tu="identifier",Du="name",Pu={RESOURCE_SUB_TYPE:Uu,RESOURCE_TYPE:wu,IDENTIFIER:Tu,NAME:Du};function Nu(e,t,r,i,n=0){if(ec().makeDeepCopy)return ec().makeDeepCopy(e,t,r,i);let a=ks(),{stringify:o,toJSON:s,ignore:c,modulate:u}=a||{};if(!a?.enabled&&!r||"object"!=typeof e||Zr(e)||null===e||"number"==typeof a?.threshold&&n>=a.threshold)return e;let l=Array.isArray(e)?[]:{},d=Object.keys(e).filter(e=>!r||!c||Array.isArray(c)&&!c.includes(e)||Zr(c)&&!c(e)),p=(e,t)=>{l[e]=Zr(t?.toString)?t.toString():JSON.stringify(t)};for(let m of d){let a=e[m],c=Zr(u)?u(a):void 0;if(void 0!==c)l[m]=c;else if(t&&"extensions"===m&&Array.isArray(a)){let e=Eu(a);Object.assign(l,...e)}else i&&"extensions"===m?l[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,a):Array.isArray(s)&&s.includes(m)&&Zr(a?.toJSON)?l[m]=a.toJSON():null===a?l[m]=void 0:Gc(a)?l[m]=new Date(a).toISOString():l[m]=Nu(a,t,r,i,n+1)}return l}function Eu(e){return e?.map(e=>{let{name:t,value:r}=e;return t&&r&&{[`_${t}`]:r}}).filter(Boolean)}function Mu(e=1,t){return Ri(0,e).map(()=>Ru(t))}function Ru(e){let t=[];for(let s=0;s<256;s++)t[s]=(s<16?"0":"")+s.toString(16);let r=Math.trunc(4294967295*Math.random()),i=Math.trunc(4294967295*Math.random()),n=Math.trunc(4294967295*Math.random()),a=Math.trunc(4294967295*Math.random()),o=t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&a]+t[a>>8&255]+t[a>>16&255]+t[a>>24&255];return"string"==typeof e?`${e}_${o.replaceAll("-","")}`:o}var Au={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Cu={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},ku={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},xu={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Ou={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Fu={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},_u={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Lu={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},Bu={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},$u={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Vu="SET3-S:6/TB7",ju="SET3-S:6/TB7-F:TB10",Gu={FORMAT_STANDARD:Vu,FORMAT_STANDARD_NOAD:"SET3-S:6NOAD",FORMAT_ATP_DOUBLES:ju,FORMAT_SHORT_SETS:"SET3-S:4/TB7",FORMAT_FAST4:"SET3-S:4/TB5@3",FORMAT_PRO_SET:"SET1-S:8/TB7",FORMAT_COLLEGE_PRO_SET:"SET1-S:8/TB7@7",TIMED20:"SET1-S:T20"},Wu={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},qu={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Hu={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},zu={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Yu={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Ku={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Xu={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},Qu="COLLEGE_DEFAULT",Ju="COLLEGE_JUCO",Zu="COLLEGE_D3",el="DOMINANT_DUO",tl="DOMINANT_DUO_MIXED",rl="LAVER_CUP",il="TEAM_DOUBLES_3_AGGREGATION",nl="TIME_TENNIS_DUAL",al="TIME_TENNIS_PRO_CIRCUIT",ol="USTA_BREWER_CUP",sl="USTA_OZAKI_CUP",cl="USTA_COLLEGE",ul="USTA_GOLD_TEAM_CHALLENGE",ll="USTA_LEVEL_1",dl="USTA_INTERSECTIONAL",pl="USTA_SECTION_BATTLE",ml="USTA_SOUTHERN_LEVEL_5",fl="USTA_TOC",hl="USTA_WTT_ITT",gl="USTA_ZONAL",Il={COLLEGE_D3:Zu,COLLEGE_DEFAULT:Qu,COLLEGE_JUCO:Ju,DOMINANT_DUO:el,DOMINANT_DUO_MIXED:tl,LAVER_CUP:rl,TEAM_DOUBLES_3_AGGREGATION:il,TIME_TENNIS_DUAL:nl,TIME_TENNIS_PRO_CIRCUIT:al,USTA_BREWER_CUP:ol,USTA_OZAKI_CUP:sl,USTA_COLLEGE:cl,USTA_GOLD_TEAM_CHALLENGE:ul,USTA_INTERSECTIONAL:dl,USTA_LEVEL_1:ll,USTA_SECTION_BATTLE:pl,USTA_SOUTHERN_LEVEL_5:ml,USTA_TOC:fl,USTA_WTT_ITT:hl,USTA_ZONAL:gl},yl="STANDARD",vl={[yl]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[Zu]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Vu,matchUpCount:6,matchUpValue:1},tieFormatName:Zu,valueGoal:5},[Qu]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:Vu,matchUpCount:6,matchUpValue:1},tieFormatName:Qu,valueGoal:4},[Ju]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:Vu,matchUpCount:6,matchUpValue:1},tieFormatName:Ju,valueGoal:5},[rl]:Ku,[el]:Wu,[tl]:_u,[il]:Cu,[nl]:Lu,[al]:Fu,[ol]:Bu,[sl]:$u,[cl]:qu,[ul]:Au,[dl]:Ou,[ll]:Hu,[pl]:xu,[ml]:ku,[hl]:zu,[fl]:Xu,[gl]:Yu},Sl=e=>{let t,r=e?.namedFormat&&Object.keys(vl).includes(e.namedFormat)?e.namedFormat:yl,i=Array.isArray(e?.uuids)?e?.uuids:[],{category:n,gender:a}=e?.event??{},o=Nu(vl[r],!1,!0),s=t=>{if(!e?.isMock&&!e?.event?.isMock||!e.event)return i?.pop()??Ru();let r=e?.event?.eventId;return i.pop()??`${r}-COL-${t+1}`};return o.hydrate?(t={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:ju,collectionName:"Doubles",matchUpType:Hr,...o.doubles},{collectionId:s(1),matchUpFormat:Vu,collectionName:"Singles",matchUpType:Wr,...o.singles}]},o.tieFormatName&&(t.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((e,t)=>e.collectionId=s(t)),t=o),e?.hydrateCollections&&t.collectionDefinitions.forEach(e=>{n&&!e.category&&(e.category=n),a&&!e.gender&&(e.gender=a)}),t},bl="SINGLES",Ul="SINGLES",wl="DOUBLES",Tl="DOUBLES",Dl="TEAM",Pl="TEAM",Nl={AGE:"AGE",BOTH:"BOTH",DOUBLES:wl,DOUBLES_EVENT:Tl,RATING:"RATING",SINGLES:bl,SINGLES_EVENT:Ul,TEAM_EVENT:Pl,TEAM:Dl},El="MAIN",Ml="QUALIFYING",Rl="CONSOLATION",Al="VOLUNTARY_CONSOLATION",Cl="PLAY_OFF",kl=[El,Ml,Rl,Cl,Al],xl={[Ml]:1,[El]:2,[Cl]:3,[Rl]:3,[Al]:4},Ol="finishingPositions",Fl="aggregateEventStructures",_l={[El]:1,[Cl]:2,[Rl]:3,[Ml]:4,[Al]:5},Ll={[Cl]:1,[El]:2,[Rl]:3,[Ml]:4,[Al]:5},Bl="CLUSTER",$l="ADJACENT",Vl="SEPARATE",jl="WATERFALL",Gl="ITEM",Wl="CONTAINER",ql="DRAW",Hl="RANDOM",zl="TOP_DOWN",Yl="BOTTOM_UP",Kl="POSITION",Xl="WINNER",Ql="LOSER",Jl="FIRST_MATCHUP",Zl="AD_HOC",ed="FEED_IN",td="COMPASS",rd="OLYMPIC",id="SINGLE_ELIMINATION",nd="DOUBLE_ELIMINATION",ad="FIRST_MATCH_LOSER_CONSOLATION",od="FIRST_ROUND_LOSER_CONSOLATION",sd="LUCKY_DRAW",cd="CURTIS_CONSOLATION",ud="CURTIS_CONSOLATION",ld="FEED_IN_CHAMPIONSHIP_TO_SF",dd="FEED_IN_CHAMPIONSHIP_TO_SF",pd="FEED_IN_CHAMPIONSHIP_TO_QF",md="FEED_IN_CHAMPIONSHIP_TO_QF",fd="FEED_IN_CHAMPIONSHIP_TO_R16",hd="FEED_IN_CHAMPIONSHIP_TO_R16",gd="MODIFIED_FEED_IN_CHAMPIONSHIP",Id="MODIFIED_FEED_IN_CHAMPIONSHIP",yd="FEED_IN_CHAMPIONSHIP",vd="ROUND_ROBIN",Sd="ROUND_ROBIN_WITH_PLAYOFF",bd="DECIDER",Ud="BACKDRAW",wd={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Td={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Dd="WIN_RATIO",Pd="ROUND_OUTCOME",Nd=[td,cd,md,hd,dd,yd,pd,fd,ld,ad,od,sd,Id,rd,Cl,Sd],Ed={MAIN:El,QUALIFYING:Ml,CONSOLATION:Rl,ITEM:Gl,CONTAINER:Wl,FIRST_MATCHUP:Jl,WINNER:Xl,LOSER:Ql,AD_HOC:Zl,FEED_IN:ed,FLEX_ROUNDS:"AD_HOC",COMPASS:td,PLAY_OFF:Cl,OLYMPIC:rd,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:id,DOUBLE_ELIMINATION:nd,CURTIS:cd,FICSF:ld,FICQF:pd,FICR16:fd,MFIC:gd,VOLUNTARY_CONSOLATION:Al,FIRST_MATCH_LOSER_CONSOLATION:ad,FIRST_ROUND_LOSER_CONSOLATION:od,MODIFIED_FEED_IN_CHAMPIONSHIP:Id,FEED_IN_CHAMPIONSHIP_TO_R16:hd,FEED_IN_CHAMPIONSHIP_TO_QF:md,FEED_IN_CHAMPIONSHIP_TO_SF:dd,FEED_IN_CHAMPIONSHIP:yd,LUCKY_DRAW:sd,ROUND_ROBIN_WITH_PLAYOFF:Sd,ROUND_ROBIN:vd,DECIDER:bd,BACKDRAW:Ud,COMPASS_ATTRIBUTES:wd,OLYMPIC_ATTRIBUTES:Td,DRAW:ql,RANDOM:Hl,TOP_DOWN:zl,BOTTOM_UP:Yl,CLUSTER:Bl,ADJACENT:$l,SEPARATE:Vl,WATERFALL:jl,WIN_RATIO:Dd,ROUND_OUTCOME:Pd,MULTI_STRUCTURE_DRAWS:Nd,generatedDrawTypes:[Zl,td,cd,nd,md,hd,dd,yd,ed,ad,od,sd,Id,rd,Cl,vd,Sd,id],stageOrder:xl,finishOrder:_l,AGGREGATE_EVENT_STRUCTURES:Fl,FINISHING_POSITIONS:Ol},Md=Ed,Rd="tournamentRecords",Ad="policyDefinitions",Cd="tournamentRecord",kd="onlineResource",xd="drawDefinition",Od="tieFormatName",Fd="matchUpFormat",_d="participantId",Ld="scheduleDates",Bd="tournamentId",$d="scheduleDate",Vd="roundNumber",jd="structureId",Gd="participant",Wd="matchUpIds",qd="entryStage",Hd="policyType",zd="structures",Yd="eventType",Kd="matchUpId",Xd="tieFormat",Qd="inContext",Jd="structure",Zd="courtIds",ep="personId",tp="venueIds",rp="matchUps",ip="courtId",np="eventId",ap="matchUp",op="drawId",sp="error",cp="event",up="param",lp="uuids",dp="averageMatchUpMinutes",pp="recoveryMinutes",mp="periodLength",fp="object",hp="array",gp="_validate",Ip="_message",yp="_invalid",vp="_ofType",Sp="_anyOf",bp="_oneOf",Up={[kd]:e=>3===Ci(Object.keys(e),[Uu,wu,Tu]).length,[Od]:e=>e&&Sl({namedFormat:e}),[lp]:e=>!e||Array.isArray(e)&&e.every(ei),[Xd]:e=>!bu({tieFormat:e}).error,[Yd]:e=>[bl,wl,Dl].includes(e),[qd]:e=>kl.includes(e)},wp={[Rd]:Qi,[Cd]:Ji,[Ad]:ga,[xd]:rn,[_d]:Za,[Fd]:oa,[Bd]:en,[jd]:On,[Wd]:la,[Gd]:Qa,[kd]:Xo,[Yd]:Vn,[zd]:_n,[Kd]:ua,[Xd]:na,[Jd]:Ln,[ip]:Ta,[rp]:pa,[np]:Gn,[ap]:ma,[Zd]:Da,[tp]:Da,[op]:wn,[cp]:jn},Tp={[Rd]:fp,[Ad]:fp,[Cd]:fp,[xd]:fp,[kd]:fp,[Ld]:hp,[Gd]:fp,[Wd]:hp,[zd]:hp,[Xd]:fp,[Jd]:fp,[Zd]:hp,[tp]:hp,[rp]:hp,[ap]:fp,[cp]:fp,[lp]:hp};function Dp(e,t,r){if(!e&&!ti(e))return{error:Zo};if(!t?.length||e?._bypassParamCheck)return{valid:!0};if(!Array.isArray(t))return{error:Zo};let{paramError:i,errorParam:n}=function(e,t){let r,i;return{paramError:t.find(({_ofType:t,_oneOf:n,_anyOf:a,_validate:o,_info:s,...c})=>{let u=n&&function(e,t){if(!t)return;let r=Pp(e,t);return 1!==r.length?{error:Zo}:r.reduce((e,t)=>({...e,[t]:!0}),{})}(e,n);if(u?.error)return u.error;u&&Object.assign(c,u);let l=a&&function(e,t){if(!t)return;let r=Pp(e,t).filter(t=>e[t]);return r.length<1?{error:Zo}:r.reduce((e,t)=>({...e,[t]:!0}),{})}(e,a);if(l?.error)return l.error;l&&Object.assign(c,l);let d=Object.keys(c).filter(e=>"boolean"==typeof c[e]),p=d.find(n=>{let a=o&&!Zr(o),u=void 0!==e[n]&&!o&&function(e,t,r){return r=r||Tp[t]||"string","array"===r?!Array.isArray(e[t]):typeof e[t]!==r}(e,n,t),l=c[n]&&[void 0,null].includes(e[n]),d=a||u||l||o&&void 0!==e[n]&&!function(e,t){return!Zr(t)||t(e)}(e[n],o)||Up[n]&&!Up[n](e[n]);return d&&(r=n,i=s),d});return!d.length||p}),errorParam:r,paramInfo:i}}(e,t);if(!i)return{valid:!0};let a=i[gp]&&(i[sp]||i[yp])||void 0===e?.[n]&&(i[sp]||i[yp]||wp[n]||Zo)||Zo;return ac({info:{param:n??(i[bp]&&Object.keys(i[bp]).join(", ")),message:i[Ip]},result:{error:a},stack:r})}function Pp(e,t){return Ci(Object.keys(e),Object.keys(t))}var Np="DYNAMIC",Ep="RANKING",Mp="RATING",Rp="SCALE",Ap="SEEDING",Cp={RANKING:Ep,RATING:Mp,SCALE:Rp,SEEDING:Ap};function kp(e){let t=Dp(e,[{[Gd]:!0}]);if(t.error)return t;let r=e.participant.timeItems?.filter(({itemType:e})=>e?.startsWith(Rp)&&[Ep,Mp,Ap].includes(e.split(".")[1])),i={ratings:{},rankings:{},seedings:{}};if(r?.length){let e=e=>r.filter(t=>t?.itemType===e).sort((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime()).pop(),t=vi(r.map(({itemType:e})=>e));for(let r of t){let t=e(r);if(t){let[,e,r,n,a]=t.itemType.split("."),o=a?`${n}.${a}`:n,s=(e===Ap?"seedings":e===Ep&&"rankings")||"ratings";i[s][r]||(i[s][r]=[]),i[s][r].push({scaleValue:t.itemValue,scaleDate:t.itemDate,scaleName:o})}}}return{...Gi,...i}}function xp(e){if(null===e)return{};let{source:t,template:r}=e||{};if(!r)return t;let i={};return function e(t,r,i){if(!t||!r)return;let n=Object.keys(t),a=Object.keys(r),o=Object.assign({},...a.filter(e=>e.indexOf("||")).map(e=>e.split("||").map(t=>({[t]:e}))).flat()),s=a.concat(...Object.keys(o)),c=s.includes("*");for(let u of n)if(s.indexOf(u)>=0||c){let n=r[o[u]||u]||c,a=t[u];if("object"!=typeof n||"function"==typeof a||Array.isArray(n)){let e=t[u];if(Array.isArray(n)&&!n.includes(e))return!1;(r[u]||c&&!1!==r[u])&&(i[u]=e)}else if(Array.isArray(a)){let t=a.map(t=>{let r={};return!1!==e(t,n,r)?r:void 0}).filter(Boolean);i[u]=t}else a&&(i[u]={},e(a,n,i[u]))}}(t,r,i),i}var Op="voluntaryConsolation",Fp="competitiveBands",_p="roundRobinTally",Lp="positionActions",Bp="matchUpActions",$p="rankingPoints",Vp="roundNaming",jp="participant",Gp="progression",Wp="scheduling",qp="avoidance",Hp="scoring",zp="seeding",Yp="feedIn",Kp="draws",Xp={POLICY_TYPE_VOLUNTARY_CONSOLATION:Op,POLICY_TYPE_COMPETITIVE_BANDS:Fp,POLICY_TYPE_ROUND_ROBIN_TALLY:_p,POLICY_TYPE_POSITION_ACTIONS:Lp,POLICY_TYPE_MATCHUP_ACTIONS:Bp,POLICY_TYPE_RANKING_POINTS:$p,POLICY_TYPE_ROUND_NAMING:Vp,POLICY_TYPE_PARTICIPANT:jp,POLICY_TYPE_PROGRESSION:Gp,POLICY_TYPE_SCHEDULING:Wp,POLICY_TYPE_AVOIDANCE:qp,POLICY_TYPE_DISPLAY:"display",POLICY_TYPE_PRIVACY:"participant",POLICY_TYPE_FEED_IN:Yp,POLICY_TYPE_SCORING:Hp,POLICY_TYPE_SEEDING:zp,POLICY_TYPE_AUDIT:"audit",POLICY_TYPE_DRAWS:Kp};function Qp({tournamentParticipants:e=[],policyDefinitions:t={},contextProfile:r,participantId:i,internalUse:n,personId:a}){let o=Nu(e.find(e=>i&&e.participantId===i||a&&e.person&&e.person.personId===a),!1,n);if(o){let e=t?.[jp];if(r?.withScaleValues){let{ratings:e,rankings:t}=kp({participant:o});o.rankings=t,o.ratings=e}if(e?.participant)return xp({template:e.participant,source:o})}return o}function Jp(e){if(!e||"object"!=typeof e)return{error:Da};if(e.element&&"object"!=typeof e?.element)return{error:Zo};if(!e?.name)return{error:Da,info:"missing name"};if(!e?.element){if(e.discover&&e.tournamentRecords){for(let t of Object.keys(e.tournamentRecords)){let r=Jp({element:e.tournamentRecords[t],name:e.name});if(r.error)return ac({result:r,stack:"removeExtension"})}return{...Gi}}return{error:Da,info:"element required"}}return e?.element.extensions?(e.element.extensions=e.element.extensions.filter(t=>t?.name!==e.name),{...Gi}):{...Gi,info:as}}function Zp({requiredAttributes:e=["name","value"],extension:t}){if(!t||"object"!=typeof t||"string"!=typeof t.name)return!1;let r=Object.keys(t);return e.filter(e=>r.includes(e)).length===e.length}function em(e){if("object"!=typeof e)return{error:Da};let t="addExtension";if(e?.element&&"object"!=typeof e.element)return ac({result:{error:Zo},stack:t});if(!Zp({extension:e.extension}))return ac({result:{error:Zo,info:"invalid extension"},stack:t});if(!e.element){if(e.discover&&!e.tournamentId&&e.tournamentRecords){for(let r of Object.values(e.tournamentRecords)){let i=em({extension:e.extension,element:r});if(i.error)return ac({result:i,stack:t})}return{...Gi}}return ac({result:{error:Da},stack:t})}if(e.element.extensions||(e.element.extensions=[]),e?.creationTime??1){let t=(new Date).toISOString();Object.assign(e.extension,{createdAt:t})}let r=e.element.extensions.find(({name:t})=>t===e.extension.name);return r?r.value=e.extension.value:e.extension.value&&e.element.extensions.push(e.extension),{...Gi}}function tm(e){return e&&"object"==typeof e?e.tournamentRecord?em({creationTime:e.creationTime,element:e.tournamentRecord,extension:e.extension}):{error:Ji}:{error:Da}}function rm(e){return e&&"object"==typeof e?e.drawDefinition?em({creationTime:e.creationTime,element:e.drawDefinition,extension:e.extension}):{error:an}:{error:Da}}function im(e){return e&&"object"==typeof e?e.event?em({creationTime:e.creationTime,extension:e.extension,element:e.event}):{error:Gn}:{error:Da}}function nm(e){if(!e||"object"!=typeof e)return{error:Da};if(!e.participantId)return{error:Za};let t=e.tournamentRecord?.participants||[],r=Qp({participantId:e.participantId,tournamentParticipants:t});return r?em({creationTime:e.creationTime,extension:e.extension,element:r}):{error:to}}function am(e){return e&&"object"==typeof e?e.tournamentRecord?Jp({element:e.tournamentRecord,name:e.name}):{error:Ji}:{error:Da}}function om(e){return e&&"object"==typeof e?e.drawDefinition?Jp({element:e.drawDefinition,name:e.name}):{error:an}:{error:Da}}function sm(e){return e&&"object"==typeof e?e?.event?Jp({element:e.event,name:e.name}):{error:Gn}:{error:Da}}function cm(e){if(!e||"object"!=typeof e)return{error:Da};if(!e.participantId)return{error:Za};let t=e.tournamentRecord?.participants||[],r=Qp({participantId:e.participantId,tournamentParticipants:t});return r?Jp({element:r,name:e.name}):{error:to}}function um({tournamentRecords:e}){return{tournamentIds:ti(e)?Object.keys(e):[],...Gi}}function lm({discover:e,element:t,name:r,...i}){if(!t||!r){if(e&&i){let t=Object.keys(i).filter(t=>"boolean"==typeof e||Array.isArray(e)&&e.includes(t)).find(e=>!!Array.isArray(i[e]?.extensions)&&i[e].extensions.find(e=>e?.name===r)),n=t&&i[t];!n&&i.tournamentRecords&&(n=Object.values(i.tournamentRecords).find(e=>e.extensions?.length));let a=n?.extensions?.find(e=>e?.name===r);return{extension:a,info:a?void 0:as}}return ac({result:{error:Da},stack:"extensionQueries"})}if(!Array.isArray(t.extensions))return{info:"no extensions"};let n=t.extensions.find(e=>e?.name===r);return{extension:n,info:n?void 0:as}}var dm="appliedPolicies",pm="context",mm="delegatedOutcome",fm="disabled",hm="disableAutoCalc",gm="disableLinks",Im="display",ym="drawDeletions",vm="entryProfile",Sm="flightProfile",bm="groupingAttribute",Um="lineUps",wm="linkedTournamentsIds",Tm="participantRepresentatives",Dm="personRequests",Pm="positionActions",Nm="roundTarget",Em="scheduleLimits",Mm="scheduleTiming",Rm="schedulingProfile",Am="subOrder",Cm="tally",km="tieFormatModification",xm={ACTIVE_SUSPENSION:"activeSuspension",APPLIED_POLICIES:dm,CONTEXT:pm,DELEGATED_OUTCOME:mm,DISABLED:fm,DISABLE_LINKS:gm,DISABLE_AUTO_CALC:hm,DISPLAY:Im,DRAW_DELETIONS:ym,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:vm,EVENT_PROFILE:"eventProfile",EVENT_WITHDRAWAL_REQUESTS:"eventWithdrawalRequests",FLIGHT_PROFILE:Sm,GROUPING_ATTRIBUTE:bm,LINEUPS:Um,LINKED_TOURNAMENTS:wm,PARTICIPANT_REPRESENTATIVES:Tm,PERSON_REQUESTS:Dm,POSITION_ACTIONS:Pm,RANKING_POINTS:"rankingPoints",REGISTRATION:"registration",ROUND_TARGET:Nm,SCHEDULE_LIMITS:Em,SCHEDULE_TIMING:Mm,SCHEDULING_PROFILE:Rm,STATUS_DETAIL:"statusDetail",SUB_ORDER:Am,TALLY:Cm,TIE_FORMAT_MODIFICATIONS:km,FACTORY:"factory"},Om=[mm,fm,hm,gm,Sm,Um,wm,Tm,Dm,Nm,Em,Mm,Rm,Am,Cm,km];function Fm({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Qi};let t=um({tournamentRecords:e}),{tournamentIds:r}=t;return r?.length>1?em({tournamentRecords:e,discover:!0,extension:{name:wm,value:{tournamentIds:r}}}):{...Gi}}function _m({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Qi};return ac({result:Jp({name:wm,tournamentRecords:e,discover:!0}),stack:"unlinkTournaments"})}function Lm({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e)return{error:Zo};if(!t)return{error:en};let r,i=um({tournamentRecords:e}),{tournamentIds:n}=i;return n.includes(t)?(n.every(i=>{let n=e[i],{extension:a}=lm({element:n,name:wm});if(!a)return!0;let o=a?.value?.tournamentIds||[];if(!o?.length||1===o.length&&o.includes(t)||i===t){let e=am({name:wm,tournamentRecord:n});return e.error&&(r=e.error),e.success}let s=o.filter(e=>e!==t);a.value={tournamentIds:s};let c=tm({tournamentRecord:n,extension:a});return c.error&&(r=c.error),c.success}),r?{error:r}:{...Gi}):{error:en}}var Bm={};function $m({tournamentRecords:e}){return"object"==typeof e&&Object.keys(e).length?{linkedTournamentIds:Object.assign({},...Object.keys(e).map(t=>{let r=e[t],i=r?.tournamentId,{extension:n}=lm({element:r,name:wm}),a=(n?.value?.tournamentIds||[]).filter(e=>e!==i);return{[t]:a}}))}:{error:Qi}}Br(Bm,{getLinkedTournamentIds:()=>$m,getTournamentIds:()=>um});var Vm={};Br(Vm,{adHocPositionSwap:()=>dw,addAdHocMatchUps:()=>fT,addDrawDefinitionTimeItem:()=>EU,addFinishingRounds:()=>jy,addGoesTo:()=>Gy,addPlayoffStructures:()=>tT,addQualifyingStructure:()=>lw,addVoluntaryConsolationStage:()=>OU,addVoluntaryConsolationStructure:()=>tb,allPlayoffPositionsFilled:()=>qb,alternateDrawPositionAssignment:()=>$b,assignDrawPosition:()=>lT,assignDrawPositionBye:()=>iv,attachConsolationStructures:()=>Jw,attachPlayoffStructures:()=>Zw,attachQualifyingStructure:()=>PU,attachStructures:()=>eT,autoSeeding:()=>rA,automatedPlayoffPositioning:()=>yU,automatedPositioning:()=>IU,buildDrawHierarchy:()=>JR,checkValidEntries:()=>TD,deleteAdHocMatchUps:()=>pT,drawMatic:()=>qE,findDrawDefinition:()=>_T,generateAdHocMatchUps:()=>jD,generateAdHocRounds:()=>GE,generateAndPopulatePlayoffStructures:()=>Hw,generateDrawDefinition:()=>QR,generateDrawMaticRound:()=>QD,generateDrawStructuresAndLinks:()=>AD,generateDrawTypeAndModifyDrawDefinition:()=>CD,generateQualifyingStructure:()=>uw,generateVoluntaryConsolation:()=>JD,getAssignedParticipantIds:()=>pv,getAvailableMatchUpsCount:()=>yT,getAvailablePlayoffProfiles:()=>bw,getDrawDefinitionTimeItem:()=>Fh,getDrawParticipantRepresentativeIds:()=>vT,getDrawStructures:()=>Tf,getDrawTypeCoercion:()=>vD,getEligibleVoluntaryConsolationParticipants:()=>IT,getMatchUpsMap:()=>kg,getParticipantIdFinishingPositions:()=>OT,getPositionAssignments:()=>ST,getPositionsPlayedOff:()=>vw,getRandomQualifierList:()=>SD,getSeedingThresholds:()=>db,getSeedsCount:()=>wD,getStructureSeedAssignments:()=>Mg,getTeamLineUp:()=>Iy,getValidGroupSizes:()=>cb,isAdHoc:()=>jg,isCompletedStructure:()=>Wb,isValidForQualifying:()=>bD,luckyLoserDrawPositionAssignment:()=>xb,modifyDrawDefinition:()=>aT,modifyDrawName:()=>nT,modifySeedAssignment:()=>vU,mutate:()=>jm,positionActions:()=>yD,pruneDrawDefinition:()=>cT,qualifierDrawPositionAssignment:()=>SU,qualifierProgression:()=>UU,query:()=>gT,removeDrawPositionAssignment:()=>KS,removeRoundMatchUps:()=>mT,removeSeededParticipant:()=>rw,removeStructure:()=>MU,renameStructures:()=>NU,resetDrawDefinition:()=>oT,resetQualifyingStructure:()=>FU,resetVoluntaryConsolationStructure:()=>mh,setDrawParticipantRepresentativeIds:()=>Km,setPositionAssignments:()=>Lb,setStructureOrder:()=>wU,setSubOrder:()=>hT,shiftAdHocRounds:()=>_b,swapAdHocRounds:()=>Bb,swapDrawPositionAssignments:()=>ew,updateTeamLineUp:()=>Rb,withdrawParticipantAtDrawPosition:()=>XS});var jm={};Br(jm,{adHocPositionSwap:()=>dw,addAdHocMatchUps:()=>fT,addDrawDefinitionTimeItem:()=>EU,addPlayoffStructures:()=>tT,addQualifyingStructure:()=>lw,addVoluntaryConsolationStage:()=>OU,addVoluntaryConsolationStructure:()=>tb,alternateDrawPositionAssignment:()=>$b,assignDrawPosition:()=>lT,assignDrawPositionBye:()=>iv,attachConsolationStructures:()=>Jw,attachPlayoffStructures:()=>Zw,attachQualifyingStructure:()=>PU,attachStructures:()=>eT,automatedPlayoffPositioning:()=>yU,automatedPositioning:()=>IU,deleteAdHocMatchUps:()=>pT,luckyLoserDrawPositionAssignment:()=>xb,modifyDrawDefinition:()=>aT,modifyDrawName:()=>nT,modifySeedAssignment:()=>vU,pruneDrawDefinition:()=>cT,qualifierDrawPositionAssignment:()=>SU,qualifierProgression:()=>UU,removeDrawPositionAssignment:()=>KS,removeRoundMatchUps:()=>mT,removeSeededParticipant:()=>rw,removeStructure:()=>MU,renameStructures:()=>NU,resetDrawDefinition:()=>oT,resetQualifyingStructure:()=>FU,resetVoluntaryConsolationStructure:()=>mh,setDrawParticipantRepresentativeIds:()=>Km,setPositionAssignments:()=>Lb,setStructureOrder:()=>wU,setSubOrder:()=>hT,shiftAdHocRounds:()=>_b,swapAdHocRounds:()=>Bb,swapDrawPositionAssignments:()=>ew,updateTeamLineUp:()=>Rb,withdrawParticipantAtDrawPosition:()=>XS});var Gm=e=>t=>e[t],Wm=(e=[])=>e.map(zm).filter(Boolean),qm=(e=[])=>e.map(Hm).filter(Boolean),Hm=(e={})=>Gm(e)("participantId"),zm=(e={})=>Gm(e)("matchUpId"),Ym=(e={})=>Gm(e)("drawId");function Km({representativeParticipantIds:e,drawDefinition:t}){if(!t)return{error:an};if(!Array.isArray(e))return{error:Zo};let r=qm(t?.entries||[]);return e.length&&Ci(e,r).length<e.length?{error:Zo}:rm({drawDefinition:t,extension:{name:Tm,value:e}})}var Xm="ABANDONED",Qm="AWAITING_RESULT",Jm="CANCELLED",Zm="COMPLETED",ef="DEAD_RUBBER",tf="DEFAULTED",rf="DOUBLE_DEFAULT",nf="DOUBLE_WALKOVER",af="IN_PROGRESS",of="INCOMPLETE",sf="NOT_PLAYED",cf="RETIRED",uf="SUSPENDED",lf="TO_BE_PLAYED",df="WALKOVER",pf=[Qm,Zm,tf,af,of,cf,uf],mf=[Qm,Zm,tf,nf,rf,af,of,cf,uf,df],ff=[Xm,Qm,"BYE",Jm,Zm,ef,tf,nf,rf,af,of,sf,cf,uf,lf,df],hf=["BYE",nf,rf,Zm,tf,cf,df],gf=[Xm,Qm,Jm,ef,af,of,sf,uf,lf,void 0],If=[Jm,Xm,Zm,ef,tf,nf,rf,cf,df],yf=[Xm,Zm,tf,nf,rf,af,cf,df],vf=[af,of,uf,lf],Sf={ABANDONED:Xm,AWAITING_RESULT:Qm,BYE:"BYE",CANCELLED:Jm,COMPLETED:Zm,DEAD_RUBBER:ef,DEFAULTED:tf,DOUBLE_WALKOVER:nf,DOUBLE_DEFAULT:rf,IN_PROGRESS:af,INCOMPLETE:of,NOT_PLAYED:sf,RETIRED:cf,SUSPENDED:uf,TO_BE_PLAYED:lf,WALKOVER:df};function bf(e,t,r){let i=e=>lm({element:e,name:Nm})?.extension?.value,n=r?.deprioritizeCompleted,a=r?.mode===Fl&&Ll,o=r?.mode===Ol&&_l,s=o||a||xl,c=e=>(e=>e?.stage===El&&1===e?.stageSequence)(e)?-1:s[e?.stage],u=e=>e?.matchUps.every(({matchUpStatus:e})=>If.includes(e)?1:-1);return n&&u(e)-u(t)||a&&c(e)-c(t)||(e?.stage&&s[e.stage]||0)-(t?.stage&&s[t.stage]||0)||(i(e)||0)-(i(t)||0)||!o&&!a&&(t?.positionAssignments?.length??1/0)-(e?.positionAssignments?.length??1/0)||(e?.stageSequence??0)-(t?.stageSequence??0)||(Uf(e)||0)-(Uf(t)||0)}function Uf(e){return(e?.matchUps||[]).reduce((e,t)=>{let r=(t.finishingPositionRange?.winner||[]).reduce((e,t)=>e+t,0);return!e||r<e?r:e},void 0)}function wf(e){let t=Dp(e,[{[xd]:!0,[jd]:!0}]);if(t.error)return t;let{drawDefinition:r,structureId:i}=e,{structures:n}=Tf({drawDefinition:r}),a=n?.flatMap(e=>e.structures?[...e.structures].concat(e):e),o=a?.find(e=>e.structureId===i);return o?{structure:o,containingStructure:o.structureType===Gl?a?.find(e=>e.structures?.some(e=>e.structureId===i)):void 0}:{error:Fn}}function Tf({withStageGrouping:e,drawDefinition:t,stageSequences:r,stageSequence:i,roundTarget:n,sortConfig:a,stages:o,stage:s}){let c=!t&&rn||!t?.structures&&_n||void 0;if(c)return{error:c,structures:[],stageStructures:{}};let u=t?.structures?.filter(function(e){return!s&&!Array.isArray(o)||s&&e.stage===s||Array.isArray(o)&&o.includes(e.stage)}).filter(function(e){return!i&&!Array.isArray(r)||i&&e.stageSequence===i||Array.isArray(r)&&r.includes(e.stageSequence)}).filter(e=>{let t=lm({element:e,name:Nm})?.extension?.value;return!n||n===t}).sort((e,t)=>bf(e,t,a))??[],l=e?Object.assign({},...kl.map(e=>{let t=u?.filter(t=>t.stage===e);return t?.length&&{[e]:t}}).filter(Boolean)):{};return{structures:u,stageStructures:l}}function Df({drawDefinition:e}){if(!e)return{error:rn};let t={};return{allPositionedParticipantIds:(e.structures||[]).map(e=>{let r=e.stage;t[r]||(t[r]=[]);let{positionAssignments:i}=Pf({structure:e}),n=i?.map(Hm).filter(Boolean)??[];return t[r].push(...n),n}).flat(),stagePositionedParticipantIds:t}}function Pf({drawDefinition:e,structureId:t,structure:r}){let i,n=[];if(!r){if(!e)return{positionAssignments:n,error:rn};if(({structure:r,error:i}=wf({drawDefinition:e,structureId:t})),i)return{positionAssignments:n,error:i}}return r.structures?n=[].concat(...r.structures.map(e=>Pf({structure:e}).positionAssignments)):r.positionAssignments?n=r.positionAssignments:i=Qn,{positionAssignments:n,error:i}}function Nf({drawDefinition:e,structureId:t,structure:r}){let i=Pf({drawDefinition:e,structureId:t,structure:r})?.positionAssignments||[],n=i?.filter(e=>e.participantId??e.bye??e.qualifier),a=i&&i?.length===n?.length,o=i?.filter(e=>!e.participantId&&!e.bye&&!e.qualifier),s=i?.filter(e=>!e.participantId&&e.bye),c=i?.filter(e=>!e.participantId&&e.qualifier);return{allPositionsAssigned:a,positionAssignments:i,unassignedPositions:o,assignedPositions:n,qualifierPositions:c,byePositions:s}}var Ef="addDrawDefinition",Mf="addMatchUps",Rf="addParticipants",Af="addScaleItems",Cf="addEvent",kf="addVenue",xf="audit",Of="dataIssue",Ff="deleteParticipants",_f="deleteVenue",Lf="deletedDrawIds",Bf="deletedMatchUpIds",$f="modifyDrawDefinition",Vf="modifyDrawEntries",jf="modifyEventEntries",Gf="modifyMatchUp",Wf="modifyParticipants",qf="modifyPositionAssignments",Hf="modifySeedAssignments",zf="modifyTournamentDetail",Yf="modifyVenue",Kf="mutations",Xf="publishEvent",Qf="publishEventSeeding",Jf="publishOrderOfPlay",Zf="publishParticipants",eh="unPublishEvent",th="unPublishEventSeeding",rh="unPublishOrderOfPlay",ih="updateInContextMatchUp",nh={ADD_DRAW_DEFINITION:Ef,ADD_MATCHUPS:Mf,ADD_PARTICIPANTS:Rf,ADD_SCALE_ITEMS:Af,ADD_EVENT:Cf,ADD_VENUE:kf,AUDIT:xf,DATA_ISSUE:Of,DELETE_PARTICIPANTS:Ff,DELETE_VENUE:_f,DELETED_DRAW_IDS:Lf,DELETED_MATCHUP_IDS:Bf,MODIFY_DRAW_DEFINITION:$f,MODIFY_DRAW_ENTRIES:Vf,MODIFY_EVENT_ENTRIES:jf,MODIFY_MATCHUP:Gf,MODIFY_PARTICIPANTS:Wf,MODIFY_POSITION_ASSIGNMENTS:qf,MODIFY_SEED_ASSIGNMENTS:Hf,MODIFY_TOURNAMENT_DETAIL:zf,MODIFY_VENUE:Yf,MUTATIONS:Kf,PUBLISH_EVENT_SEEDING:Qf,PUBLISH_EVENT:Xf,PUBLISH_ORDER_OF_PLAY:Jf,PUBLISH_PARTICIPANTS:Zf,UNPUBLISH_EVENT_SEEDING:th,UNPUBLISH_EVENT:eh,UNPUBLISH_ORDER_OF_PLAY:rh,UPDATE_INCONTEXT_MATCHUP:ih};function ah(e,t){if(!e)return{error:rn};let r=Date.now();e.updatedAt&&r===new Date(e.updatedAt).getTime()&&(r+=1);let i=new Date(r).toISOString(),n=t?.filter(Boolean);return e.updatedAt=i,e.structures?.filter(Boolean).forEach(e=>{(!n?.length||n?.includes(e.structureId))&&(e.updatedAt=i)}),{...Gi}}function oh({drawDefinition:e,tournamentId:t,matchUps:r,eventId:i}){return e&&ah(e),Bs({payload:{matchUps:r,tournamentId:t,eventId:i},topic:Mf}),{...Gi}}function sh({drawDefinition:e,tournamentId:t,matchUpIds:r,eventId:i,action:n}){e&&ah(e),Bs({topic:Bf,payload:{tournamentId:t,matchUpIds:r,eventId:i,action:n}});for(let a of r)js({key:a});return{...Gi}}function ch({drawDefinition:e,tournamentId:t,structureId:r,context:i,eventId:n,matchUp:a}){return a?(e&&lh({drawDefinition:e,structureIds:r?[r]:void 0,tournamentId:t,eventId:n}),Bs({topic:Gf,payload:{matchUp:a,tournamentId:t,context:i},key:a.matchUpId}),{...Gi}):(console.log(ma),{error:ma})}function uh({tournamentId:e,eventId:t,drawDefinition:r}){return r?(ah(r),Bs({payload:{drawDefinition:r,tournamentId:e,eventId:t},topic:Ef,key:r.drawId}),{...Gi}):(console.log(rn),{error:rn})}function lh({drawDefinition:e,tournamentId:t,structureIds:r,eventId:i}){return e?(ah(e,r),Bs({payload:{tournamentId:t,eventId:i,drawDefinition:e},topic:$f,key:e.drawId}),{...Gi}):{error:rn}}function dh({drawDefinition:e,tournamentId:t,structure:r,eventId:i}){if(!e)return{error:rn};if(!r)return{error:Ln};let n=r.seedAssignments,a=r.structureId;return Bs({payload:{tournamentId:t,eventId:i,drawId:e.drawId,structureId:a,seedAssignments:n},topic:Hf,key:e.drawId}),lh({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:i}),{...Gi}}function ph({drawDefinition:e,tournamentId:t,structure:r,event:i}){if(!e)return{error:rn};if(!r)return{error:Ln};let n=Pf({structure:r}),a=r.structureId,o=e.drawId,s=i?.eventId;return Bs({topic:qf,payload:{positionAssignments:n,tournamentId:t,structureId:a,eventId:s,drawId:o},key:a}),lh({structureIds:[a],drawDefinition:e,tournamentId:t,eventId:s}),{...Gi}}function mh({tournamentRecord:e,drawDefinition:t,resetEntries:r,event:i}){if(!t)return{error:rn};let n=t.structures?.find(e=>e.stage===Al);if(!n)return{error:Fn};let a=n.matchUps?.map(({matchUpId:e})=>e)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],sh({tournamentId:e?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:t}),r&&(t.entries=t.entries.filter(e=>e.entryStage!==Al)),lh({tournamentId:e?.tournamentId,eventId:i?.eventId,drawDefinition:t,structureIds:[n.structureId]}),{...Gi}}function fh({drawPositions:e,structure:t}){if([Ml,El].includes(t.stage)&&1===t.stageSequence)return;let{positionAssignments:r}=Pf({structure:t});r?.filter(({drawPosition:t})=>e?.includes(t))?.forEach(e=>{em({element:e,extension:{name:gm,value:!0}})})}function hh(e){let{appliedPolicies:t,positionAction:r,drawDefinition:i}=e;if(!1===t?.audit?.[Pm])return;let{extension:n}=lm({name:Pm,element:i}),a=Array.isArray(n?.value)?n?.value??[]:[];if(!a?.length){let e=i.structures.find(e=>e.stage===El);if(e){let t=Pf({structure:e}).positionAssignments?.map(({drawPosition:e,participantId:t,bye:r,qualifier:i})=>({drawPosition:e,participantId:t,qualifier:i,bye:r}));a.push({name:"initialMainAssignments",initialAssignments:t})}}em({element:i,extension:{value:a.concat(r),name:Pm}})}function gh({tournamentRecord:e,drawDefinition:t,event:r}){let i=(e?.events||r&&[r])?.map(e=>e?.drawDefinitions).flat().filter(Boolean)||t&&[t]||[],n={},a={},o=i.map(e=>e?.structures?.filter(e=>e?.structures)).flat().filter(Boolean);for(let s of o){let{structures:e,structureId:t}=s??{};e&&t&&(n[t]=e?.map(e=>e.structureId))&&e.forEach(e=>a[e.structureId]=s?.structureId)}return{containedStructures:n,containerStructures:a}}function Ih(e){let{sides:t,matchUpType:r}=e||{},i=e.potentialParticipants?.length?e.potentialParticipants.flat().map(e=>r===Hr?e?.individualParticipantIds||[]:e.participantId).flat():[],n=(t||[]).map(e=>r===Hr&&(e?.participant?.individualParticipantIds||[])||e?.participantId&&[e.participantId]||[]).flat();return{individualParticipantIds:n.concat(i).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:i}}function yh(e){return e?.tournamentRecords??(e?.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{}}var vh="SIGN_IN_STATUS",Sh="SIGNED_OUT",bh="SIGNED_IN",Uh="TEAM",wh="INDIVIDUAL",Th="GROUP",Dh="PAIR",Ph="TEAM",Nh={TEAM_PARTICIPANT:Uh,INDIVIDUAL:wh,GROUP:Th,TEAM:Ph,PAIR:Dh},Eh={INDIVIDUAL:wh,GROUP:Th,PAIR:Dh,TEAM:Ph,SIGN_IN_STATUS:vh,SIGNED_OUT:Sh,SIGNED_IN:bh};function Mh({participantsProfile:e,participants:t=[],deepCopy:r}){let i=new Map,n=!1!==r?Nu(t,e?.convertExtensions,!0):t,a=n.filter(e=>e.participantType===Ph),o=n.filter(e=>e.participantType===Th),s=n.filter(e=>e.participantType===Dh);return n.forEach(e=>{if(e.participantType===wh){let{participantId:t}=e;e.groupParticipantIds=[],e.teamParticipantIds=[],e.pairParticipantIds=[],e.groups=[],e.teams=[],a.forEach(r=>{(r?.individualParticipantIds||[]).forEach(n=>{n===t&&!e.teamParticipantIds?.includes(r.participantId)&&(e.teamParticipantIds.push(r.participantId),i.get(r.participantId)||i.set(r.participantId,{participantName:r.participantName,participantId:r.participantId}),e.teams.push({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participantOtherName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}))})}),s.forEach(r=>{(r?.individualParticipantIds||[]).forEach(i=>{i===t&&!e.pairParticipantIds.includes(r.participantId)&&e.pairParticipantIds.push(r.participantId)})}),o.forEach(r=>{(r?.individualParticipantIds||[]).forEach(i=>{i===t&&!e.groupParticipantIds.includes(r.participantId)&&(e.groupParticipantIds.push(r.participantId),e.groups.push({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participantOtherName,participantName:r.participantName,participantId:r.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(i)}}function Rh(e){return e&&typeof String.fromCodePoint<"u"?e.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):e}var Ah=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Ch({participant:e,withISO2:t,withIOC:r}){let{person:i,individualParticipants:n}=e;[i,n?.map(({person:e})=>e)].flat().filter(Boolean).forEach(function(e){let{nationalityCode:i}=e||{};if(i){let n=Ah.find(({iso:e})=>e===i);r&&n?.ioc&&!e.iocNationalityCode&&(e.iocNationalityCode=n.ioc),t&&n?.iso2&&!e.iso2NationalityCode&&(e.iso2NationalityCode=n.iso2),n?.label&&!e.countryName&&(e.countryName=n.label)}})}function kh(e){let{tournamentRecord:t,participantId:r}=e,i=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};for(let n of Object.values(i)){let e=n.participants?.find(e=>e.participantId===r);if(e)return{participant:e,tournamentId:n.tournamentId}}return{error:to}}function xh(e){let{tournamentRecord:t,participantId:r}=e;if(r){let e=kh({tournamentRecord:t,participantId:r});return e.participant??e}return e.element||e.drawDefinition||e.event||e.tournamentRecord||{error:Da}}function Oh(e){let{returnPreviousValues:t,itemSubTypes:r,itemType:i}=e,n=xh(e);if(n.error)return n;if(r&&!Array.isArray(r))return{error:Zo,context:{itemSubTypes:r}};if(!Array.isArray(n.timeItems))return{error:$o};let a=n.timeItems.filter(e=>e?.itemType===i).filter(e=>!r?.length||r.some(t=>e?.itemSubTypes?.includes(t))).sort((e,t)=>new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime()),o=Nu(a.pop(),!1,!0);if(o){let e={timeItem:o,...Gi};return t&&Object.assign(e,{previousItems:a}),e}return{info:as}}function Fh({returnPreviousValues:e,drawDefinition:t,itemSubTypes:r,itemType:i}){if(!t)return{error:wn};if(!t.timeItems)return{info:as};let{timeItem:n,previousItems:a,info:o}=Oh({element:t,returnPreviousValues:e,itemSubTypes:r,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function _h({returnPreviousValues:e,itemSubTypes:t,itemType:r,event:i}){if(!i)return{error:jn};if(!i.timeItems)return{info:as};let{timeItem:n,previousItems:a,info:o}=Oh({returnPreviousValues:e,element:i,itemSubTypes:t,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Lh({returnPreviousValues:e,tournamentRecord:t,itemSubTypes:r,itemType:i}){if(!t)return{error:Ji};if(!t.timeItems)return{info:as};let{timeItem:n,previousItems:a,info:o}=Oh({element:t,returnPreviousValues:e,itemSubTypes:r,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function Bh({returnPreviousValues:e,tournamentRecord:t,participantId:r,itemSubTypes:i,itemType:n}){if(!t)return{error:Ji};if(!r)return{error:Za};let a=kh({tournamentRecord:t,participantId:r});if(a.error)return a;let{participant:o}=a;if(!o?.timeItems)return{info:as};let{timeItem:s,previousItems:c,info:u}=Oh({element:a.participant,returnPreviousValues:e,itemSubTypes:i,itemType:n});return s&&{timeItem:s,previousItems:c}||{info:u}}var $h={[Th]:"groupParticipantIds",[Dh]:"pairParticipantIds",[Ph]:"teamParticipantIds"},Vh={[Th]:"groups",[Ph]:"teams"};function jh({withIndividualParticipants:e,convertExtensions:t,tournamentRecord:r,withSignInStatus:i,withScaleValues:n,withGroupings:a,internalUse:o,withISO2:s,withIOC:c}){let u,l=[],d={};for(let p of r.participants??[]){let e=p?.participantId;e&&qh({participantMap:d,participantId:e})}for(let p of r.participants??[]){let e=Nu(p,t,o),{participantId:r,individualParticipantIds:a,participantType:u}=e;if(d[r]){if(Object.assign(d[r].participant,e),a){let t=Wh({individualParticipantIds:a,participantCopy:e,participantMap:d,participantType:u,participantId:r});t.missingParticipantIds.length&&l.push(...t.missingParticipantIds)}if(i&&(d[r].participant.signedIn=Gh(e)),n){let{ratings:t,rankings:i,seedings:n}=kp({participant:e});d[r].participant.seedings=n,d[r].participant.rankings=i,d[r].participant.ratings=t}(c||s)&&Ch({participant:d[r].participant,withISO2:s,withIOC:c})}else l.push(r)}if(e){!function({participantMap:e,template:t}){let r=Object.values(e);for(let i of r){let r=i.participant;if(r.individualParticipantIds?.length){r.individualParticipants=[];for(let i of r.individualParticipantIds){let n=e[i].participant;r.individualParticipants.push(t?xp({template:t,source:n}):n)}}}}({participantMap:d,template:ti(e)?e:void 0})}return a&&(u=Mh({participants:Object.values(d).map(({participant:e})=>e),participantsProfile:{convertExtensions:t},deepCopy:!1}).groupInfo),{missingParticipantIds:l,participantMap:d,groupInfo:u}}function Gh(e){let{timeItem:t}=Oh({itemType:vh,element:e});return t?.itemValue===bh}function Wh({individualParticipantIds:e,participantCopy:t,participantMap:r,participantType:i,participantId:n}){let a=[];for(let o of e){let s=r[o]?.participant;if(s){if(s[$h[i]].push(n),[Ph,Th].includes(i)){let{participantRoleResponsibilities:e,participantOtherName:r,participantName:n,participantId:a,teamId:o}=t;s[Vh[i]].push({participantRoleResponsibilities:e,participantOtherName:r,participantName:n,participantId:a,teamId:o})}if(i===Dh){let t=e.find(e=>e!==o);r[o].pairIdMap[n]=t,r[o].pairIdMap[t]=n}}else a.push(o)}return{missingParticipantIds:a}}function qh({participantMap:e,participantId:t}){if(e[t])return;let r={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};e[t]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Wr]:{...r},[Hr]:{...r},[Ph]:{...r},...r}}}function Hh({participantsProfile:e,useParticipantMap:t,tournamentRecord:r,contextProfile:i,inContext:n}){if(t)return jh({...e,...i,tournamentRecord:r});let a,o=Nu(r.participants,!1,!0)||[];if((e?.withIOC||e?.withISO2)&&o.forEach(t=>Ch({participant:t,...e})),(n||e?.withGroupings)&&o?.length&&({participantsWithGroupings:o,groupInfo:a}=Mh({participantsProfile:e,deepCopy:!1,participants:o})),e?.withScaleValues&&o?.length)for(let s of o){let{ratings:e,rankings:t}=kp({participant:s});s.rankings=t,s.ratings=e}return{participants:o,groupInfo:a}}function zh({onlySpecifiedPolicyTypes:e=!1,policyTypes:t=[],tournamentRecord:r,drawDefinition:i,structure:n,event:a}){if(!Array.isArray(t))return{error:ha};let o={};return r&&s(r),a&&s(a),i&&s(i),n&&s(n),{appliedPolicies:o,...Gi};function s(r){let i=r?.extensions?.find(e=>e.name===dm)?.value;if(i)for(let n of Object.keys(i))(e?t.includes(n):!t.length||t.includes(n))&&(o[n]=Nu(i[n],!1,!0))}}function Yh({policyTypes:e=[],tournamentRecord:t,drawDefinition:r,structure:i,event:n}){if(!Array.isArray(e))return{error:ha};let{appliedPolicies:a}=zh({tournamentRecord:t,drawDefinition:r,structure:i,event:n}),o={};for(let s of e){let e=a?.[s];e&&(o[s]=e)}return Object.keys(o).length?{policyDefinitions:o}:{info:ba.message}}var Kh="WALKOVER",Xh="RETIRED",Qh="COMPETITIVE",Jh="ROUTINE",Zh="DECISIVE",eg="winRatio",tg={[Fp]:{policyName:"Competitive Bands Default",profileBands:{[Zh]:20,[Jh]:50}}};function rg({policyDefinitions:e,tournamentRecord:t,contextProfile:r,drawDefinition:i,event:n}){let a={policies:{}};if(!r)return a;let o=Yh({tournamentRecord:t,drawDefinition:i,event:n}).policyDefinitions;if(r.withCompetitiveness){let t=e?.[Fp]??o?.[Fp]??tg[Fp];a.policies[Fp]=t}return a}function ig({tournamentRecord:e,drawDefinition:t,policyType:r,structure:i,event:n}){if(!e)return{error:Ji};let{appliedPolicies:a}=zh({tournamentRecord:e,drawDefinition:t,structure:i,event:n});return a?.[r]?{policy:a[r]}:{info:ba?.message}}function ng({tournamentRecord:e,categoryName:t,categoryType:r,event:i}){t=t??i?.category?.categoryName??i?.category?.ageCategoryCode,r=r??i?.category?.categoryType??i?.category?.subType;let{policy:n}=ig({policyType:Wp,tournamentRecord:e,event:i}),a=(e?lm({element:e,name:Mm}).extension:void 0)?.value,o=(i&&lm({name:Mm,element:i}).extension)?.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:t,categoryType:r,policy:n}}}function ag({drawDefinition:e,attributes:t}){let{extension:r}=lm({element:e,name:vm}),i=r?.value||{};return t.forEach(e=>{Object.keys(e).forEach(t=>{i[t]?Object.assign(i[t],e[t]):i[t]=e[t]})}),r={name:vm,value:i},rm({drawDefinition:e,extension:r}),{entryProfile:i}}function og({drawDefinition:e}){let{extension:t}=lm({element:e,name:vm});return{entryProfile:t?.value||{}}}var sg="ALTERNATE",cg="CONFIRMED",ug="DIRECT_ACCEPTANCE",lg="FEED_IN",dg="JUNIOR_EXEMPT",pg="LUCKY_LOSER",mg="ORGANISER_ACCEPTANCE",fg="QUALIFIER",hg="SPECIAL_EXEMPT",gg="UNGROUPED",Ig="UNPAIRED",yg="WILDCARD",vg="WITHDRAWN",Sg=[cg,ug,dg,mg,hg],bg=[lg,pg,fg],Ug=[cg,ug,lg,dg,mg,hg,yg],wg=[cg,ug,dg,pg,fg,mg,hg,yg],Tg=[sg,cg,ug,lg,dg,pg,mg,fg,"REGISTERED",hg,gg,Ig,yg,vg],Dg={ALTERNATE:sg,CONFIRMED:cg,DIRECT_ACCEPTANCE:ug,DIRECT_ENTRY_STATUSES:Ug,DRAW_SPECIFIC_STATUSES:bg,EQUIVALENT_ACCEPTANCE_STATUSES:Sg,FEED_IN:lg,JUNIOR_EXEMPT:dg,LUCKY_LOSER:pg,ORGANISER_ACCEPTANCE:mg,QUALIFIER:fg,SPECIAL_EXEMPT:hg,STRUCTURE_SELECTED_STATUSES:wg,UNGROUPED:gg,UNPAIRED:Ig,VALID_ENTRY_STATUSES:Tg,WILDCARD:yg,WITHDRAWN:vg};function Pg({stage:e,drawDefinition:t}){let{entryProfile:r}=og({drawDefinition:t}),i=Object.keys(r).includes(e);if(!i&&kl.includes(e)){return ag({drawDefinition:t,attributes:[{[e]:{drawSize:void 0,alternates:!0}}]}),!0}return i}function Ng({stage:e,drawDefinition:t,entryStatus:r}){return t.entries.reduce((t,i)=>i.entryStage===e&&i.entryStatus===r?t+1:t,0)}function Eg({provisionalPositioning:e,placementGroup:t,drawDefinition:r,stageSequence:i,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:c}){let u=r.entries?.reduce((e,t)=>{let r=lm({name:Nm,element:t})?.extension?.value,a=c&&t.entryStage===c||s?.length&&t.entryStage&&s.includes(t.entryStage),u=!n||t.entryStatus&&n.includes(t.entryStatus),l=t.entryStageSequence??1;return!a||i&&l!==i||!u||o&&r&&o!==r?e:e.concat(t)},[])??[];if(a&&c===Cl){let{playoffEntries:i,error:n}=function({provisionalPositioning:e,drawDefinition:t,structureId:r}){let i=[],n=(t.links??[]).find(e=>e.linkType===Kl&&e.target.structureId===r);if(n){let{finishingPositions:r,structureId:a}=n.source,{structure:o}=wf({drawDefinition:t,structureId:a});o?.structureType===Wl&&(o.structures??[]).forEach(t=>{let n=t.positionAssignments??[],{structureId:a}=t,o=a,s=Object.assign({},...n.map(e=>{let{participantId:t}=e,r=lm({element:e,name:Cm}).extension?.value;return r&&t?{[t]:r}:void 0}).filter(Boolean)),c=Object.keys(s).reduce((t,r)=>{let i=s[r],n=i.groupOrder||e&&i.provisionalOrder;return t.includes(n)||t.push(n),t},[]).length===Object.keys(s).length,u=Object.keys(s).filter(t=>{let i=s[t],n=i.groupOrder||e&&i.provisionalOrder;return r?.includes(n)});(!e||c)&&u.forEach(t=>{let n=s[t],{groupOrder:a,provisionalOrder:c,GEMscore:u}=n,l=a||e&&c,d=[...r??[]].sort(Qr).indexOf(l)+1;i.push({entryStage:Cl,entryStatus:lg,placementGroup:d,groupingValue:o,participantId:t,GEMscore:u})})})}return{playoffEntries:i}}({provisionalPositioning:e,drawDefinition:r,structureId:a});return n&&console.log("playoff entries error"),(i?.length?i:u).filter(e=>!t||e.placementGroup===t)}return u}function Mg({provisionalPositioning:e,returnAllProxies:t,drawDefinition:r,structureId:i,structure:n}){let a,o=[];n||({structure:n,error:a}=wf({drawDefinition:r,structureId:i}));let s=Pf({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Fn};i||(i=n.structureId);let{stage:c,stageSequence:u}=n,l=c===Cl&&r&&Eg({provisionalPositioning:e,drawDefinition:r,stageSequence:u,structureId:i,stage:c}),d=l?l.filter(e=>1===e.placementGroup).sort((e,t)=>(e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore&&-1)||0).map((e,t)=>{let r=t+1;return{participantId:e.participantId,seedValue:r,seedProxy:!0,seedNumber:r}}):[],p=d?.slice(0,t?d.length:s.length/2);return p.length?o=p:n.seedAssignments?o=n.seedAssignments:a=Rn,{seedAssignments:o,stageSequence:u,seedLimit:n.seedLimit??n?.positionAssignments?.length,stage:c,error:a}}function Rg(e){if(!e)return;let{tieFormatId:t,tieFormats:r}=e;return e.tieFormat?e.tieFormat:t&&Array.isArray(r)?r.find(e=>e.tieFormatId===t):void 0}function Ag({item:e,drawDefinition:t,structure:r,event:i}){if(e){if(e.tieFormat)return e.tieFormat;if(e.tieFormatId)return t.tieFormat?t.tieFormat:t.tieFormats?.find(t=>e.tieFormatId===t.tieFormatId)||(i.tieFormat?i.tieFormat:i.tieFormats?.find(t=>e.tieFormatId===t.tieFormatId));if(r?.tieFormat)return r.tieFormat;if(r?.tieFormatId){let e=t.tieFormats?.find(e=>r.tieFormatId===e.tieFormatId);if(e)return e}}}function Cg({drawDefinition:e,structure:t,matchUp:r,event:i}){return{tieFormat:Ag({item:r,drawDefinition:e,structure:t,event:i})||Ag({item:t,drawDefinition:e,structure:t,event:i})||Rg(e)||Rg(i)}}function kg({drawDefinition:e,structure:t}){let r={},i=[];return(e?.structures??[t]).filter(e=>e&&"object"==typeof e).forEach(e=>{if(!e)return;let{structureId:t,matchUps:n,structures:a}=e,o=Array.isArray(a);if(o)o&&a.forEach(e=>{let{structureName:n}=e,a=e.matchUps;r[e.structureId]={matchUps:a,itemStructureIds:[],structureName:n},a&&(i.push(...a),a.forEach(e=>{e.tieMatchUps&&i.push(...e.tieMatchUps)})),r[t]||(r[t]={itemStructureIds:[],matchUps:[]}),r[t].itemStructureIds||(r[t].itemStructureIds=[]),r[t].itemStructureIds.push(e.structureId)});else{let e=n;r[t]={matchUps:e,itemStructureIds:[]},e?.forEach(e=>{i.push(e),e.tieMatchUps&&i.push(...e.tieMatchUps)})}}),{mappedMatchUps:r,drawMatchUps:i}}function xg({mappedMatchUps:e,matchUpsMap:t,structureId:r,inContext:i}){let n=(e=t?.mappedMatchUps??e)[r],a=(n?.itemStructureIds||[]).map(t=>{let{matchUps:n,structureName:a}=e[t];return i?n.map(e=>Object.assign(Nu(e,!0,!0),{containerStructureId:r,structureId:t,structureName:a})):n}).flat();return(n?.matchUps||[]).concat(...a)}function Og({groupedOrder:e,roundPositionsCount:t}){if(!e||e?.length<=t)return e;let r=_i(e,e.length/t).map(e=>e.reduce((e,t)=>e+t)),i=r.slice().sort(Qr);return r.map(e=>i.indexOf(e)+1)}function Fg(e){if(!ti(e))return!1;let{matchUpId:t,drawPositions:r}=e,i="string"==typeof t,n=!r||Array.isArray(r)&&r.length<=2&&r.every(e=>gi(e)||null==e);return i&&n}function _g(e){return!!Array.isArray(e)&&e.every(Fg)}function Lg({matchUps:e=[],interpolate:t}){if(!_g(e))return{roundMatchUps:[],error:Zo};let r=e.reduce((e,t)=>{let r="string"==typeof t.roundNumber?Jr(t.roundNumber):t.roundNumber;return!t.roundNumber||e.includes(r)?e:e.concat(r)},[]).sort(Qr).map(t=>{let r=e.filter(e=>e.roundNumber===t),i=r.find(({matchUpType:e})=>e===Yr)?r.filter(({matchUpType:e})=>e===Yr):r;return{[t]:(n=i,n.sort((e,t)=>Qr(e.roundPosition,t.roundPosition)))};var n}),i=e.reduce((e,t)=>{let r="string"==typeof t.roundNumber?Jr(t.roundNumber):t.roundNumber;return e[r]||(e[r]=nc({abbreviatedRoundName:t.abbreviatedRoundName,finishingRound:t.finishingRound,roundName:t.roundName})),e},{}),n=Object.assign({},...r);if(t){let e=Math.max(...Object.keys(n).map(e=>Jr(e)).filter(e=>!Number.isNaN(e))),t=n[e]?.length;if(t>1&&ci(t)){let r=e+1;Ri(r,r+t/2).forEach((e,r)=>{n[e]=Ri(0,t/(2+2*r)).map(()=>({}))})}}let a=0,o=Object.assign({},...Object.keys(n).map(e=>{let t=n[e]?.length,r=n[e]?.filter(e=>!If.includes(e.matchUpStatus)&&!e.score?.scoreStringSide1)?.length,i=t&&t===r;return a=Math.max(a,t),{[e]:{matchUpsCount:t,inactiveCount:r,inactiveRound:i}}})),s=0,c=0,u=Object.keys(n).map(e=>Jr(e)).filter(e=>!Number.isNaN(e));u.forEach(e=>{let t=n[e].sort((e,t)=>e.roundPosition-t.roundPosition),r=t.flatMap(e=>e?.drawPositions||[]);if(o[e].roundNumber=e,o[e].roundFactor=o[e].matchUpsCount?a/o[e].matchUpsCount:1,o[e].finishingRound=i[e]?.finishingRound,o[e].roundName=i[e]?.roundName,o[e].abbreviatedRoundName=i[e]?.abbreviatedRoundName,o[e].finishingPositionRange=n[e]?.[0]?.finishingPositionRange,1!==e&&o[e-1]){let r=o[e-1],i=r.drawPositions,n=r.matchUpsCount/o[e].matchUpsCount,a=_i(i,n),s=t.map(t=>{let{roundPosition:r}=t,n=[...t.drawPositions||[],void 0,void 0].slice(0,2);if(!r)return n;let o=n?.filter(Boolean)||[];if(!o?.length)return[void 0,void 0];if(e<3&&2===o?.length)return n?.slice().sort(Qr);let s=Ci(i,o).length!==o?.length;if(o?.length&&s)return 1===o?.length?[o[0],void 0]:n?.slice().sort(Qr);let c=2*(r-1);return a.slice(c,c+2).map(e=>function(e,t){return t?.find(t=>e.includes(t))}(e,o))});o[e].drawPositions=s?.flat(),o[e].pairedDrawPositions=s}else{let t=r.sort(Qr),i=_i(t,2);o[e].drawPositions=t,o[e].pairedDrawPositions=i}o[e+1]?.matchUpsCount===o[e].matchUpsCount&&(o[e+1].feedRound=!0,o[e+1].feedRoundIndex=c,o[e].preFeedRound=!0,c+=1),o[e]&&!o[e].feedRound&&(o[e].roundIndex=s,s+=1)});let l=!!Object.values(o).some(({matchUpsCount:e})=>!ci(e));return{hasNoRoundPositions:e.some(e=>!e.roundPosition),roundsNotPowerOf2:l,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:u,roundProfile:o,...Gi}}function Bg(e){if(!Array.isArray(e))return"";let t=e.filter(pi);return t.length?vi([Math.min(...t),Math.max(...t)]).join("-"):""}function $g({drawDefinition:e}){if("object"!=typeof e)return{error:tn};let t={},{structures:r=[],links:i=[]}=e||{},n=r.reduce((e,t)=>{let{stage:r}=t;return e[r]?e[r].push(t):e[r]=[t],e},{});for(let o of Object.keys(n)){let e=n[o].find(({stageSequence:e})=>1===e);if(!e)continue;let{structureId:r}=e;a({aggregator:{},targetRound:0,exitProfiles:t,exitProfile:"0",structureId:r,stage:o})}return{exitProfiles:t};function a({exitProfiles:e,exitProfile:t,structureId:n,targetRound:o,aggregator:s,stage:c}){e[n]||(e[n]=[]),"0"===t&&[Rl,Cl].includes(c)||e[n].push(t);let u=i.filter(e=>e.source.structureId===n&&e.source.roundNumber>=o);for(let i of u){let n=i.source.roundNumber,o=i.target.roundNumber,c=i.target.structureId,u=r.find(e=>e.structureId===c).stage,l=[u,c,o,n].join("|");if(s[l])return;s[l]=!0,a({exitProfile:`${t}-${n}`,structureId:c,exitProfiles:e,targetRound:o,aggregator:s,stage:u})}}}function Vg({roundsNotPowerOf2:e,drawDefinition:t,structure:r,matchUps:i}){if(!r)return!1;i=i??r.matchUps??[],e=e??Lg({matchUps:i}).roundsNotPowerOf2;let n=!!r.positionAssignments?.find(({drawPosition:e})=>e)||!!i?.find(({drawPositions:e})=>e?.length);return(!t?.drawType||t.drawType!==sd)&&!r?.structures&&e&&n}function jg({structure:e}){if(!e)return!1;let t=e.matchUps||e.roundMatchUps&&Object.values(e.roundMatchUps).flat(),r=!!t?.find(e=>e?.roundPosition),i=!!t?.find(e=>e?.drawPositions?.length);return!(e?.structures||e?.stage===Al||t.length&&(r||i))}var Gg={[Vp]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[El]:"",[Cl]:"P",[Ml]:"Q",[Rl]:"C"}}},Wg=Gg;function qg({roundNamingPolicy:e,drawDefinition:t,structure:r,matchUps:i}){let{roundProfile:n,roundMatchUps:a}=Lg({matchUps:i}),{structureAbbreviation:o,stage:s}=r,c=jg({structure:r}),u=Vg({structure:r}),l=r.structures,d={},p=Gg[Vp],m=r.stage===Ml,f=m?Math.max(...(t?.structures??[]).filter(e=>e.stage===Ml).map(({stageSequence:e})=>e??1),0):0,h=(r.stageSequence??1)<f?r.stageSequence??1:"",g=h&&(e?.affixes?.preQualifying||p.affixes.preQualifying)||"",I=e?.roundNamingMap||p.roundNamingMap||{},y=e?.abbreviatedRoundNamingMap||p.abbreviatedRoundNamingMap||{},v=e?.affixes?.preFeedRound||p.affixes.preFeedRound,S=e?.affixes?.roundNumber||p.affixes.roundNumber,b=(e?.namingConventions||p.namingConventions).round,U=s&&s!==El?s[0]:"",w=e?.stageConstants||p.stageConstants,T=`${g}${s&&w?.[s]||U}${h}`,D=n?Object.keys(n):[],P=m&&w?.[Ml]?`${w?.[Ml]}-`:"";if(l||c||u)Object.assign(d,...D.map(e=>{let t=`${P}${b} ${e}`,r=`${S}${e}`;return{[e]:{roundName:t,abbreviatedRoundName:r}}}));else{let t=m&&(e?.qualifyingFinishMap||p?.qualifyingFinishMap||{});Object.assign(d,...D.map(e=>{if(!n?.[e])return;let{matchUpsCount:r,preFeedRound:i}=n[e],a=2*r,s=t?.[n?.[e].finishingRound]||t&&`${S}${a}`||I[r]||`${S}${a}`,c=i?`-${v}`:"",u=[T,o,`${s}${c}`].filter(Boolean).join("-"),l=`${y[r]||`${S}${a}`}${c}`,d=[T,o,l].filter(Boolean).join("-");return{[e]:{abbreviatedRoundName:d,roundName:u}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}var Hg=(e,t)=>(e||0)+(t||0);function zg(e,t){let r=Array.isArray(e)?e[0]:e;return Number.isNaN(r)&&Kh||r<=t[Zh]&&Zh||r<=t[Jh]&&Jh||Qh}function Yg({score:e}){let t=e?.sets||[],r=t.reduce((e,t)=>(e[0]+=t.side1Score||0,e[1]+=t.side2Score||0,e),[0,0]),i=t.reduce((e,t)=>(e[0]+=t.side1TiebreakScore||0,e[1]+=t.side2TiebreakScore||0,e),[0,0]);return i.reduce(Hg)&&(r[i[0]>i[1]?0:1]+=1),{sets:t,games:r,score:e}}function Kg(e){let t=Math.min(...e.games),r=Math.max(...e.games);return Math.round(t/r*100)}function Xg(e){return e.map(Kg).sort().map(e=>parseFloat(e.toFixed(2)))}function Qg({tournamentRecord:e,profileBands:t,matchUp:r}){if(!r)return{error:ma};let{score:i,winningSide:n}=r;if(!n)return{error:Zo};let a=!t&&e&&ig({policyType:Fp,tournamentRecord:e}).policy,o=t||a?.profileBands||tg[Fp].profileBands,s=Xg([Yg({score:i})]),c=zg(s,o),u=Array.isArray(s)?s[0]:s;return{...Gi,competitiveness:c,pctSpread:u}}function Jg({matchUp:e}){if(!e)return{error:ma};if(e&&!e.sides)return{error:fa};if(e&&!e.hasContext)return{error:Vo};let t=(e.sides??[])?.map(e=>e?.participantId).filter(Boolean),r=e.sides?.filter(e=>e.participant?.participantType===wh).map(e=>e.participantId).filter(Boolean)??[],i=((e.sides??[])?.map(e=>e.participant?.individualParticipants).filter(Boolean)??[]).map(e=>(e??[]).map(e=>e?.participantId).filter(Boolean)),n=[...r,...i.flat()].filter(Boolean)??[];return{nestedIndividualParticipantIds:i,allRelevantParticipantIds:vi(n.concat(t)).filter(Boolean)??[],individualParticipantIds:n,sideParticipantIds:t,...Gi}}var Zg="CHECK_IN",eI="CHECK_OUT",tI="SCHEDULE.ASSIGNMENT.VENUE",rI="SCHEDULE.ALLOCATION.COURTS",iI="SCHEDULE.ASSIGNMENT.COURT",nI="SCHEDULE.COURT.ORDER",aI="SCHEDULE.DATE",oI="HOME_PARTICIPANT_ID",sI="SCHEDULE.ASSIGN.OFFICIAL",cI="SCHEDULE.TIME.SCHEDULED",uI="SCHEDULE.TIME.START",lI="SCHEDULE.TIME.STOP",dI="SCHEDULE.TIME.RESUME",pI="SCHEDULE.TIME.END",mI="SCHEDULE.TIME.MODIFIERS",fI="TO_BE_ANNOUNCED",hI="NEXT_AVAILABLE",gI="FOLLOWED_BY",II="AFTER_REST",yI="RAIN_DELAY",vI=[fI,hI,gI,II,yI],SI="SCALE",bI="RATING",UI="RANKING",wI="SEEDING",TI="PUBLISH",DI="PUBLIC",PI="STATUS",NI={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:vI,AFTER_REST:II,ALLOCATE_COURTS:rI,ASSIGN_COURT:iI,ASSIGN_OFFICIAL:sI,ASSIGN_VENUE:tI,CHECK_IN:Zg,CHECK_OUT:eI,COMPLETED_DATE:"COMPLETED.DATE",COURT_ORDER:nI,ELIGIBILITY:"ELIGIBILITY",END_TIME:pI,FOLLOWED_BY:gI,MEDICAL:"MEDICAL",MODIFICATION:"MODIFICATION",NEXT_AVAILABLE:hI,NOT_BEFORE:"NOT_BEFORE",OTHER:"other",PENALTY:"PENALTY",PUBLIC:DI,PUBLISH:TI,RANKING:UI,RATING:bI,RAIN_DELAY:yI,REGISTRATION:"REGISTRATION",RESUME_TIME:dI,RETRIEVAL:"RETRIEVAL",SCALE:SI,SCHEDULE:"SCHEDULE",SCHEDULED_DATE:aI,SCHEDULED_TIME:cI,SEEDING:wI,START_TIME:uI,STATUS:PI,STOP_TIME:lI,SUSPENSION:"SUSPENSION",TIME_MODIFIERS:mI,TO_BE_ANNOUNCED:fI};function EI({matchUp:e}){if(!e)return{error:ma};if(!e.hasContext)return{error:Vo};if(!e.sides||2!==e?.sides.filter(Boolean).length)return{error:fa};let{nestedIndividualParticipantIds:t,allRelevantParticipantIds:r,sideParticipantIds:i}=Jg({matchUp:e}),n=(e.timeItems??[]).filter(e=>e?.itemType&&[Zg,eI].includes(e.itemType)).sort((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0)),a=n.map(e=>e.itemValue).filter(e=>n.filter(t=>t?.itemValue===e).reverse()[0].itemType===Zg);t?.forEach((e,t)=>{let r=i?.[t],n=e?.length&&e.every(e=>a.includes(e));r&&n&&!a.includes(r)&&a.push(r)}),i?.forEach((e,r)=>{a.includes(e)&&(t?.[r]??[]).forEach(e=>{e&&!a.includes(e)&&a.push(e)})});let o=i?.reduce((e,t)=>a.includes(t)&&e,!0);return{allRelevantParticipantIds:r,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...Gi}}var MI=e=>t=>{let r=ti(t)&&t?.matchUpType||ei(t)&&t;return r&&Xr[e].includes(r)};function RI(e){let{matchUpAverageTimes:t,matchUpFormat:r}=e||{},i=t?.map(({matchUpFormatCodes:e})=>e?.filter(e=>e===r)).flat().filter(Boolean).sort((e,t)=>(e?.length||0)-(t?.length||0))||[],n=i.includes(r)?r:i[0];return t?.find(({matchUpFormatCodes:e,averageTimes:t})=>e?.find(e=>n===e)&&t)?.averageTimes}function AI(e){let{matchUpRecoveryTimes:t,averageMinutes:r,matchUpFormat:i}=e||{};return t?.find(({matchUpFormatCodes:e,averageTimes:t,recoveryTimes:n})=>{if(t&&r){let{greaterThan:e=0,lessThan:i=360}=t;if(r>e&&r<i)return!0}return e?.find(e=>e===i)&&n})?.recoveryTimes}function CI({timesBlockArray:e,categoryName:t,categoryType:r}){return e.filter(e=>Array.isArray(e)).map(e=>e.sort((e,t)=>(t.categoryNames?.length||0)-(e.categoryNames?.length||0)).find(({categoryTypes:e,categoryNames:i})=>!i?.length&&!e?.length||i?.includes(t)||e?.includes(r))).find(Boolean)}var kI="DOUBLES_SINGLES",xI="SINGLES_DOUBLES",OI="total",FI="participantConflict",_I="matchUpConflict",LI="courtDoubleBooking",BI="ISSUE_IDS",$I="CONFLICT",VI="WARNING",jI="ERROR",GI="ISSUE",WI="STATE",qI={SINGLES_DOUBLES:xI,DOUBLES_SINGLES:kI,TOTAL:OI,CONFLICT_MATCHUP_ORDER:_I,CONFLICT_PARTICIPANTS:FI,CONFLICT_COURT_DOUBLE_BOOKING:LI,SCHEDULE_ISSUE_IDS:BI,SCHEDULE_CONFLICT:$I,SCHEDULE_WARNING:VI,SCHEDULE_ERROR:jI,SCHEDULE_ISSUE:GI,SCHEDULE_STATE:WI,BLOCKED:"BLOCKED",PRACTICE:"PRACTICE",MAINTENANCE:"MAINTENANCE"};function HI({defaultAverageMinutes:e=90,defaultRecoveryMinutes:t=0,tournamentRecord:r,matchUpFormat:i,categoryName:n,categoryType:a,eventType:o,event:s}){if(!r)return{error:Ji};o=o??s?.eventType??Ul;let c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},{scheduleTiming:u}=ng({tournamentRecord:r,categoryName:n,categoryType:a,event:s});return zI({eventType:o,timingDetails:{...u,matchUpFormat:i,categoryType:a,defaultTiming:c}})}function zI({timingDetails:e,eventType:t}){let r=function({matchUpFormat:e,categoryName:t,categoryType:r,defaultTiming:i,tournamentScheduling:n,eventScheduling:a,policy:o}){return CI({categoryName:t,categoryType:r,timesBlockArray:[a?.matchUpAverageTimes&&RI({...a,matchUpFormat:e}),n?.matchUpAverageTimes&&RI({...n,matchUpFormat:e}),o?.matchUpAverageTimes&&RI({...o,matchUpFormat:e}),o?.defaultTimes?.averageTimes,i?.averageTimes]})}(e),i=Object.keys(r?.minutes||{}),n=r?.minutes&&(i?.includes(t)&&r.minutes[t]||r.minutes.default),a=function({tournamentScheduling:e,eventScheduling:t,averageMinutes:r,defaultTiming:i,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){return CI({categoryName:a,categoryType:o,timesBlockArray:[t?.matchUpRecoveryTimes&&AI({...t,averageMinutes:r,matchUpFormat:n}),e?.matchUpRecoveryTimes&&AI({...e,averageMinutes:r,matchUpFormat:n}),s?.matchUpRecoveryTimes&&AI({...s,averageMinutes:r,matchUpFormat:n}),s?.defaultTimes?.recoveryTimes,i?.recoveryTimes]})}({...e,averageMinutes:n}),o=Object.keys(a?.minutes||{}),s=a?.minutes&&(o?.includes(t)&&a.minutes[t]||a.minutes.default),c=MI(Ul)(t)?xI:kI;return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:a?.minutes&&(o?.includes(c)&&a.minutes[c]||s)}}function YI(e){return e.createdAt?new Date(e.createdAt).getTime():0}function KI({timeItems:e,itemType:t}){let r=e.filter(e=>e&&e.itemType===t).sort((e,t)=>YI(e)-YI(t)).pop(),i=r&&YI(r);return{itemValue:r?.itemValue,timeStamp:i}}function XI({timeStamp:e,schedule:t,matchUp:r}){let{itemValue:i,timeStamp:n}=KI({timeItems:r?.timeItems||[],itemType:cI});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{scheduledTime:i}:t}function QI({timeStamp:e,schedule:t,matchUp:r}){let{itemValue:i,timeStamp:n}=KI({timeItems:r?.timeItems||[],itemType:aI});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{scheduledDate:i}:t}function JI(e){if(Bc.test(e)){let t=Hc();return new Date(`${t}T${e}`)}return new Date(e)}function ZI(e){let t=(e,t=2)=>("00"+e).slice(-t);return t(e/36e5|0)+":"+t(e%36e5/6e4|0)+":"+t(e%6e4/1e3|0)}function ey(e){return parseInt(e)}function ty({startTime:e="",endTime:t=""}={}){if(!(e&&t&&Vc.test(e)&&Vc.test(t)))return!1;let[r,i]=e.split(":").map(ey),[n,a]=t.split(":").map(ey);return!(n<r)&&!(r===n&&a<i)}function ry(e,t){let[r,i]=e.startTime.split(":").map(ey),[n,a]=t.startTime.split(":").map(ey);return r<n?-1:r>n?1:i<a?-1:i>a?1:0}function iy({dateAvailability:e}){if(!e)return{error:Aa};if(!Array.isArray(e))return{error:Ra};let t="Times must be 24 hour => 00:00";for(let r of e){if("object"!=typeof r)return{error:Ra};let{date:e,startTime:i,endTime:n,bookings:a=[]}=r;if(!i||!n)return{error:Ra};if(e&&!$c.test(e))return{error:Ca,dateAvailability:{date:e},info:"Dates must be formated => YYYY-MM-DD"};if(!Vc.test(i))return{error:ka,dateAvailability:{startTime:i},info:t};if(!Vc.test(n))return{error:ka,dateAvailability:{endTime:n},info:t};if(i===n)return{error:ka,dateAvailability:{startTime:i,endTime:n},info:"startTime and endTime are equivalent"};if(!ty({startTime:i,endTime:n}))return{error:ka,dateAvailability:{startTime:i,endTime:n},info:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:Ma};for(let e of a){if("object"!=typeof e)return{error:Ma};let{startTime:r,endTime:i}=e;if(!Vc.test(r))return{error:ka,booking:{startTime:r},info:t};if(!Vc.test(i))return{error:ka,booking:{endTime:i},info:t};if(r===i)return{error:ka,dateAvailability:{startTime:r,endTime:i},info:"startTime and endTime are equivalent"};if(!ty({startTime:r,endTime:i}))return{error:ka,dateAvailability:{startTime:r,endTime:i},info:"endTime must be after startTime"}}}}return{valid:!0}}function ny(e){let{disableNotice:t,venue:r,context:i}=e;if("object"!=typeof r)return{error:Zo};let n,a=yh(e);r.venueId||(r.venueId=Ru());for(let o of Object.values(a)){let e=ay({disableNotice:!0,tournamentRecord:o,context:i,venue:r});if(e?.error)return e;n=e.venue}return t||Bs({topic:kf,payload:{venue:r}}),nc({...Gi,venue:n})}function ay({tournamentRecord:e,disableNotice:t,context:r,venue:i}){if(!e)return{error:Ji};if(!i)return{error:Da,info:"missing venue"};if(e.venues||(e.venues=[]),i.venueId||(i.venueId=Ru()),e.venues.reduce((e,t)=>e||t.venueId===i.venueId,void 0))return{error:Mo};if(i.dateAvailability?.length){let e=iy({dateAvailability:i.dateAvailability});if(e.error)return e}if(i.defaultStartTime||i.defaultEndTime){if(!i.defaultStartTime||!i.defaultEndTime)return{error:Zo,info:"both defaultStartTime and defaultEndTime are required"};if(!ty({startTime:i.defaultStartTime,endTime:i.defaultEndTime}))return{error:Zo,info:"defaultEndTime must be after defaultStartTime"}}return r&&em({element:i,extension:{value:r,name:pm}}),e.venues.push(i),{...Gi,venue:Nu(i)}}function oy({tournamentRecords:e,tournamentRecord:t,venueId:r}){if(!t)return{error:Ji};if(!r)return{error:Ao};let i=(t.venues??[]).reduce((e,t)=>t.venueId===r?t:e,void 0);if(!i&&e){let n=($m({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let a of n){let n=oy({tournamentRecord:e[a],venueId:r});if(n.success&&n.venue)return ny({tournamentRecord:t,venue:n.venue}),{...Gi,venue:i}}}return i?{...Gi,venue:i}:{error:Ro}}function sy({convertExtensions:e,...t}){let{tournamentRecords:r,tournamentRecord:i,venueId:n}=t;return Nu(oy({tournamentRecords:r,tournamentRecord:i,venueId:n}),e,!0)}function cy({tournamentRecords:e,tournamentRecord:t,courtId:r}){if(!t)return{error:Ji};if(!r)return{error:Ta};let i,n;if((t.venues??[]).forEach(e=>{(e.courts??[]).forEach(t=>{t.courtId===r&&(i=t,n=e)})}),i)return{...Gi,court:i,venue:n};if(e){let a=($m({tournamentRecords:e}).linkedTournamentIds??[])[t.tournamentId];for(let o of a){let a=cy({tournamentRecord:e[o],courtId:r});if(a.success)return a.venue&&ny({tournamentRecord:t,venue:a.venue}),{...Gi,court:i,venue:n}}}return ac({result:{error:Do},stack:"findCourt"})}function uy(e){return Nu(cy(e),!1,!0)}function ly({tournamentRecord:e,internalUse:t,courtId:r}){if(!e)return{error:Ji};if(!r)return{error:Ta};let i=cy({tournamentRecord:e,courtId:r});if(i.error)return i;let n=i.court&&(({altitude:e,courtId:t,courtName:r,courtDimensions:i,latitude:n,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:c,pace:u,notes:l})=>({altitude:e,courtId:t,courtName:r,courtDimensions:i,latitude:n,longitude:a,surfaceCategory:o,surfaceType:s,surfacedDate:c,pace:u,notes:l}))(i.court);return{...Gi,courtInfo:Nu(n,!1,t)}}function dy(e){let t=Dp(e,[{[Cd]:!0},{venueId:!0,[sp]:Ao}]);if(t.error)return t;let{tournamentRecord:r,venueId:i}=e,n=oy({tournamentRecord:r,venueId:i});if(n.error)return n;let a=(n.venue?.courts??[]).map(e=>(({courtInfo:e})=>({...e}))(ly({courtId:e.courtId,internalUse:!0,tournamentRecord:r}))),o=n.venue&&(({venueId:e,venueName:t,venueAbbreviation:r})=>({venueAbbreviation:r,venueName:t,venueId:e}))(n.venue),s=o&&{...o,courtsInfo:a};return{...Gi,venueData:Nu(s,!1,!0)}}function py({event:e,eventId:t}){if(!e)return{error:jn};let r=lm({name:Sm,element:e})?.extension,i=t?Nu(r?.value,!1,!0):r?.value;return t&&e.drawDefinitions?.forEach(e=>{i?.flights?.forEach(t=>{t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})})}),{flightProfile:i}}function my(e){let t,{tournamentRecord:r,eventId:i,drawId:n}=e,a="findEvent",o={},s=e.tournamentRecords??(r&&{[r.tournamentId]:r})??{},c=Object.values(s).map(({events:e,tournamentId:t})=>(e&&e.forEach(e=>{o[e.eventId]={tournamentId:t}}),e??[])).flat();if(n){let e,r=c.find(r=>{let i=(r?.drawDefinitions??[]).find(e=>e.drawId===n);if(i)e=i,t=o[r.eventId].tournamentId;else{let e=(r&&py({event:r})?.flightProfile)?.flights?.find(e=>e.drawId===n);if(e)return t=o[r.eventId].tournamentId,{entries:e.drawEntries,drawName:e.drawName,tournamentId:t,drawId:n}}return i});if(r)return{event:r,drawDefinition:e,tournamentId:t}}if(i){let e=c.find(e=>e?.eventId===i);return e?(t=o[e.eventId].tournamentId,{event:e,drawDefinition:void 0,tournamentId:t}):{event:void 0,drawDefinition:void 0,...ac({result:{error:Gn},stack:a})}}return{event:void 0,drawDefinition:void 0,...ac({result:{error:an},context:{drawId:n,eventId:i},stack:a})}}function fy(e){let t=e.event,r=e.matchUpType,{scheduleVisibilityFilters:i,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:c,publishStatus:u,matchUp:l}=e;if(!l)return{error:ma};if(n&&!l.matchUpType&&!e.matchUpType&&(t||a)&&l.drawId){let i=e.drawDefinition||t?.drawDefinitions?.find(e=>e.drawId===l.drawId);!i&&a&&({drawDefinition:i,event:t}=my({drawId:l.drawId,tournamentRecord:a}));let n=l.structureId&&i?.structures?.find(({structureId:e})=>e===l.structureId);r=e.matchUpType||n?.matchUpType||i?.matchUpType||t?.eventType!==Dl&&t?.eventType}let d,{milliseconds:p,time:m}=function({matchUp:e}){if(!e)return{error:ma};if(!e.timeItems)return{error:$o};let t=e.timeItems.filter(e=>[uI,lI,dI,pI].includes(e?.itemType)).sort((e,t)=>JI(e.itemValue).getTime()-JI(t.itemValue).getTime()),r=t.reduce((e,t)=>{let r,i=t?.itemType?.split("."),n=`SCHEDULE.TIME.${t?.itemType?.startsWith("SCHEDULE.TIME")&&i[2]}`;switch(n){case uI:r=0;break;case pI:if(e.lastValue&&[uI,dI].includes(e.lastType)){let i=JI(t.itemValue).getTime()-JI(e.lastValue).getTime();r=e.milliseconds+i}else r=e.milliseconds;break;case lI:if([uI,"SCHECULE.TIME.RESUME"].includes(e.lastType)){let i=JI(t.itemValue).getTime()-JI(e.lastValue).getTime();r=e.milliseconds+i}else r=e.milliseconds;break;default:r=e.milliseconds}return{milliseconds:r,lastType:n,lastValue:t.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([uI,dI].includes(r.lastType)){let e=(new Date).getTime()-JI(r.lastValue).getTime();r.milliseconds+=e}return{milliseconds:r.milliseconds,time:ZI(r.milliseconds),relevantTimeItems:t}}({matchUp:l}),{startTime:f}=function({matchUp:e}){let t=e?.timeItems||[],r=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{startTime:t.reduce((e,t)=>{let i=t.itemType===uI&&t;return i&&(!e||r(i)<r(e))?i:e},void 0)?.itemValue}}({matchUp:l}),{endTime:h}=function({matchUp:e}){let t=e?.timeItems||[],r=e=>e.createdAt?new Date(e.createdAt).getTime():0;return{endTime:t.reduce((e,t)=>{let i=t.itemType===pI&&t;return i&&(!e||r(i)>r(e))?i:e},void 0)?.itemValue}}({matchUp:l}),{eventIds:g,drawIds:I}=i??{};if(g&&!g.includes(l.eventId)||I&&!I.includes(l.drawId))d=nc({milliseconds:p,startTime:f,endTime:h,time:m});else{let e=e=>e.createdAt?new Date(e.createdAt).getTime():0,t=new Map,i=l.timeItems?.toSorted((t,r)=>e(t)-e(r))??[];for(let r of i)t.set(r.itemType,r.itemValue);let o,u,g,I,y,v=t.get(oI),S=t.get(rI),b=t.get(cI),U=t.get(mI),w=t.get(aI),T=t.get(sI),D=t.get(nI),P=t.get(tI),N=t.get(iI),E=l.matchUpType??r;if(s&&b&&n&&E){let e={matchUpFormat:l.matchUpFormat??c,...s};({averageMinutes:u=0,recoveryMinutes:g=0,typeChangeRecoveryMinutes:I=0}=zI({timingDetails:e,eventType:E})),(u||g)&&(o=h?du(ru(h),g):du(b,u+g)),I&&(y=h?du(ru(h),I):du(b,u+I))}!w&&b&&(w=iu(b));let M=jc({scheduledDate:w,scheduledTime:b}),R={},A=(a&&P&&dy({tournamentRecord:a,venueId:P}))?.venueData||{};P&&(R[P]=A);let{venueName:C,venueAbbreviation:k,courtsInfo:x}=A,O=(N&&x?.find(e=>e.courtId===N))?.courtName;for(let r of S||[]){if(!a)break;r.venueId&&!R[r.venueid]&&(R[r.venueId]=dy({venueId:r.venueId,tournamentRecord:a})?.venueData);let e=R[r.venueId];r.venueName=e?.venueName;let t=e?.courtsInfo?.find(e=>e.courtId===r.courtId);r.courtName=t?.courtName}d=nc({typeChangeTimeAfterRecovery:y,timeAfterRecovery:o,scheduledDate:w,scheduledTime:b,isoDateString:M,homeParticipantId:v,venueAbbreviation:k,allocatedCourts:S,timeModifiers:U,venueName:C,venueId:P,courtOrder:D,courtName:O,courtId:N,official:T,typeChangeRecoveryMinutes:I,recoveryMinutes:g,averageMinutes:u,milliseconds:p,startTime:f,endTime:h,time:m})}let{scheduledDate:y}=QI({matchUp:l}),{scheduledTime:v}=XI({matchUp:l});if(o&&u?.displaySettings?.draws){let e=u.displaySettings.draws,t=(e?.[l.drawId]??e?.default)?.scheduleDetails;if(t){let e=(t.find(e=>y&&e.dates?.includes(y))??t.find(e=>!e.dates?.length))?.attributes;if(e){d=xp({source:d,template:Object.assign({},...Object.keys(d).map(e=>({[e]:!0})),e)})}}}return{schedule:d,endDate:l.matchUpStatus&&If.includes(l.matchUpStatus)&&(iu(h)||iu(y)||iu(v))||void 0}}function hy({collectionPosition:e,collectionId:t,lineUp:r}){let i=[],n=[];if(r){let a=e=>void 0===e?-1:e,o=r.map(r=>{let{collectionAssignments:i,participantId:n}=r,a=i?.find(r=>r.collectionPosition===e&&r.collectionId===t);return a&&{participantId:n,...a}}).filter(Boolean).sort((e,t)=>a(e.substitutionOrder)-a(t.substitutionOrder));for(let e of o){let{participantId:t,previousParticipantId:r,substitutionOrder:a}=e;i.includes(t)||(r&&n.push({previousParticipantId:r,substitutionOrder:a,participantId:t}),i=i.filter(e=>e!==r),i.push(t))}}return{assignedParticipantIds:i,substitutions:n}}function gy({tournamentParticipants:e,tournamentRecord:t,participantIds:r}){let i="getPairedParticipant";if(!e&&!t)return{error:Ji};if(!Array.isArray(r)||r.length>2)return{error:za};if(!r.length)return ac({result:{error:no},stack:i});let n=(e=e??t?.participants??[]).filter(e=>e.participantType===Dh&&Ci(r,e.individualParticipantIds).length===r.length&&e.individualParticipantIds.length===r.length),a=n[0];if(!a)return ac({result:{error:to},stack:i});let o=Nu(n.slice(1),!1,!0);return{participant:Nu(a),duplicatedPairParticipants:o,...Gi}}function Iy({drawDefinition:e,participantId:t}){if("object"!=typeof e)return{error:rn};if("string"!=typeof t)return{error:Za};let{extension:r}=lm({element:e,name:Um});return{lineUp:(r?.value||{})[t]}}function yy(e){let t=Dp(e,[{[ap]:!0}]);if(t.error)return t;let r=e?.matchUp,i=r?.matchUpType;if(!i&&r?.sides?.length){let e=r.sides.find(({participant:e})=>e)?.participant?.participantType;i=e===wh&&Wr||e===Dh&&Hr||e===Ph&&Ph||void 0}return{matchUpType:i}}function vy({drawPositionCollectionAssignment:e,sideNumberCollectionAssignment:t,positionAssignments:r,displaySideNumber:i,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){let c=r.find(e=>e.drawPosition&&e.drawPosition===a),u=a&&e,l=s&&t,d=u?u[a]?.participantId:c?.participantId,p=c?function({displaySideNumber:e,seedAssignments:t,participantId:r,assignment:i,sideNumber:n}){let a={drawPosition:i.drawPosition,displaySideNumber:e,sideNumber:n};if(r){let e=function({seedAssignments:e,participantId:t}){return e?.find(e=>!e.seedProxy&&e.participantId===t)}({seedAssignments:t,participantId:r});Object.assign(a,e,{participantId:r}),e?.seedNumber&&""===e?.seedValue&&(a.seedValue="~")}else i.bye&&Object.assign(a,{bye:!0});return i.qualifier&&Object.assign(a,{qualifier:!0}),a}({displaySideNumber:i,seedAssignments:n,participantId:d,assignment:c,sideNumber:s}):{...l?.[s]};if(o&&(1===s?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&u){let e=u[a]?.teamParticipant,t=u[a]?.participant,r=u[a]?.substitutions;t&&(p.participant=t),r&&(p.substitutions=r),e&&(p.teamParticipant=e)}return p}function Sy({scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,tournamentParticipants:r,positionAssignments:i,drawPositionsRanges:n,hydrateParticipants:a,afterRecoveryTimes:o,initialRoundOfPlay:s,additionalContext:c,roundNamingProfile:u,tournamentRecord:l,tieDrawPositions:d,appliedPolicies:p,isCollectionBye:m,seedAssignments:f,usePublishState:h,participantMap:g,contextContent:I,scheduleTiming:y,contextProfile:v,drawDefinition:S,publishStatus:b,scoringActive:U,matchUpTieId:w,isRoundRobin:T,roundProfile:D,sideLineUps:P,structure:N,context:E,matchUp:M,event:R}){c=c??{};let A=Cg({drawDefinition:S,structure:N,matchUp:M,event:R})?.tieFormat,{roundOffset:C,structureId:k,structureName:x,stage:O,stageSequence:F}=N,{drawId:_,drawName:L,drawType:B}=S??{},$=A?.collectionDefinitions,V=M.collectionId&&$?.find(e=>e.collectionId===M.collectionId),j=M.collectionId?V?.matchUpFormat:M.matchUpFormat??N?.matchUpFormat??S?.matchUpFormat??R?.matchUpFormat,G=M.matchUpType||V?.matchUpType||N?.matchUpType||S?.matchUpType||!MI(Dl)(R?.eventType)&&R?.eventType,W=m?"BYE":M.matchUpStatus,{schedule:q,endDate:H}=fy({scheduleVisibilityFilters:e,afterRecoveryTimes:o,tournamentRecord:l,usePublishState:h,scheduleTiming:y,drawDefinition:S,matchUpFormat:j,publishStatus:b,matchUpType:G,matchUp:M,event:R}),z=d??M.drawPositions??[],{collectionPosition:Y,collectionId:K,roundPosition:X}=M,Q=M.roundNumber??c.roundNumber,J=K?function({tournamentParticipants:e,positionAssignments:t,collectionPosition:r,drawPositions:i=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:c}){if(!o||!r)return{};let u=({attribute:t,lineUp:i,teamParticipant:a})=>{let{assignedParticipantIds:s,substitutions:u}=hy({collectionPosition:r,collectionId:o,lineUp:i});if(c!==Hr){let e=s?.[0];return e&&{[t]:{participantId:e,teamParticipant:a,substitutions:u}}}if(s?.length<=2){let r=n?.[s[0]]?.pairIdMap?.[s[1]],i=(r&&n[r]?.participant||gy({participantIds:s,tournamentParticipants:e}).participant)?.participantId;return{[t]:{participantId:i,teamParticipant:a,substitutions:u}}}if(s?.length>2)return{[t]:{teamParticipant:a,substitutions:u}}};if(!i?.length){let e=s?.map(e=>{let{teamParticipant:t,sideNumber:r}=e,i=e.lineUp||Iy({participantId:t.teamParticipantId,drawDefinition:a})?.lineUp;return u({attribute:r,lineUp:i,teamParticipant:t})}).filter(Boolean)||{};return{sideNumberCollectionAssignment:Object.assign({},...e)}}let l=i?.map(r=>{let i=t.find(e=>e.drawPosition===r)?.participantId,o=s?.find(e=>e?.drawPosition===r),c=o?.teamParticipant||i&&n?.[i]?.participant||e?.find(({participantId:e})=>e===i),l=o?.lineUp||Iy({participantId:i,drawDefinition:a})?.lineUp;return u({attribute:r,lineUp:l,teamParticipant:c})}).filter(Boolean)||{};return{drawPositionCollectionAssignment:Object.assign({},...l)}}({tournamentParticipants:r,positionAssignments:i,collectionPosition:Y,participantMap:g,drawDefinition:S,drawPositions:z,collectionId:K,sideLineUps:P,matchUpType:G}):void 0,Z=u?.[Q]?.roundName||c.roundName,ee=u?.[Q]?.abbreviatedRoundName||c.abbreviatedRoundName,te=D?.[Q]?.feedRound,re=D?.[Q]?.preFeedRound,ie=D?.[Q]?.roundFactor,ne=n?.[Q],ae=X?ne?.[X]:void 0,oe=t?.[Q],se=V?.category?{...E?.category,...V.category}:E?.category??R?.category,ce=M.processCodes?.length&&M.processCodes||V?.processCodes?.length&&V?.processCodes||N?.processCodes?.length&&N?.processCodes||S?.processCodes?.length&&S?.processCodes||R?.processCodes?.length&&R?.processCodes||l?.processCodes,ue=v?.withCompetitiveness&&Qg({...I,matchUp:M}),le=M.finishingPositionRange??c.finishingPositionRange,de=O!==Ml&&gi(s)&&s+(Q||0),pe=e=>nc(e,void 0,!0),me={...pe(E),...pe({matchUpFormat:G===Dl?void 0:j,tieFormat:G===Dl?A:void 0,gender:V?.gender??R?.gender,endDate:M.endDate??H,discipline:R?.discipline,category:se,finishingPositionRange:le,abbreviatedRoundName:ee,drawPositionsRange:ae,competitiveProfile:ue,structureName:x,stageSequence:F,drawPositions:z,matchUpStatus:W,processCodes:ce,isRoundRobin:T,matchUpTieId:w,preFeedRound:re,matchUpType:G,roundFactor:ie,roundOffset:C,structureId:k,roundNumber:Q,roundOfPlay:de,feedRound:te,roundName:Z,drawName:L,drawType:B,schedule:q,drawId:_,stage:O}),...Nu(pe(M),!0,!0)};if(j&&M.score?.scoreStringSide1){let e=Mc(j),{bestOf:t,finalSetFormat:r,setFormat:i}=e??{};(r?.tiebreakSet||i?.tiebreakSet||i?.timed)&&(me.score.sets=me.score.sets.sort((e,t)=>e.setNumber-t.setNumber).map((e,n)=>{let a=n+1===t&&r?r:i,o=a?.tiebreakSet&&!a?.timed,s=a?.timed;return o?(e.tiebreakSet=!0,[1,2].includes(e.winningSide)&&(e.side1Score=1===e.winningSide?1:0,e.side2Score=2===e.winningSide?1:0)):s&&(e.timed=!0),e}))}if(Array.isArray(z)){let{orderedDrawPositions:e,displayOrder:t}=function({drawPositions:e,roundProfile:t,roundNumber:r}){let i=[void 0,void 0];if($i(e))return{orderedDrawPositions:i,displayOrder:i};let n=t?.[r],a=n?.pairedDrawPositions?.find(t=>xi(t||[],e.filter(Boolean)))??i,o=n?.feedRound;if(Bi(e)){let t=[...e].sort(Qr);return{orderedDrawPositions:2===t.length?t:a,displayOrder:o?t:a}}if(o){let t=[e.find(e=>!isNaN(Jr(e))),void 0];return{orderedDrawPositions:t,displayOrder:t}}return{orderedDrawPositions:a,displayOrder:a}}({drawPositions:z,roundProfile:D,roundNumber:Q}),r=D?.[Q]?.feedRound,n=t[0]!==e[0],a=e.concat(void 0,void 0).slice(0,2).map((e,t)=>{let a=t+1,o=vy({...J,positionAssignments:i,displaySideNumber:n?3-a:a,seedAssignments:f,drawPosition:e,isFeedRound:r,sideNumber:a}),s=M.sides?.find(e=>e.sideNumber===a),c=X?2*(X-1)+t+1:void 0;return pe({sourceDrawPositionRange:c?oe?.[c]:void 0,...s,...o})});Object.assign(me,Nu({sides:a},!0,!0))}if(r&&me.sides){let e=p?.[jp],t=t=>{let r=g?.[t]?.participant;return r&&xp({template:e?.participant,source:r})};if(me.sides.filter(Boolean).forEach(e=>{if(e.participantId){let i=Nu(t(e.participantId)||(r?Qp({policyDefinitions:p,participantId:e.participantId,tournamentParticipants:r,internalUse:!0,contextProfile:v}):void 0),void 0,!0);if(i){let t,r;if(S?.entries){let n=S.entries.find(t=>t.participantId===e.participantId),a=R?.entries?.find(t=>t.participantId===e.participantId);t=n?.entryStatus||a?.entryStatus,i.entryStatus=t,n?.entryStage&&(r=n.entryStage,i.entryStage=r)}!1===a?Object.assign(e,{participant:{entryStage:r,entryStatus:t}}):Object.assign(e,{participant:i})}}if(e?.participant?.individualParticipantIds?.length&&!e.participant.individualParticipants?.length){let i=e.participant.individualParticipantIds.map(e=>t(e)||(r?Qp({policyDefinitions:p,tournamentParticipants:r,internalUse:!0,contextProfile:v,participantId:e}):void 0));!1!==a&&Object.assign(e.participant,{individualParticipants:i})}}),!me.matchUpType){let{matchUpType:e}=yy({matchUp:me});e&&Object.assign(me,{matchUpType:e})}if(v?.inferGender&&(!me.gender||me.gender===cc)&&2===me.sides?.length&&me.matchUpType!==Dl){let e=me.sides.map(e=>{if(MI(Wr)(me.matchUpType))return e.participant?.person?.sex;if(2===e.participant?.individualParticipants?.length){let t=vi(e.participant.individualParticipants.map(e=>e.person?.sex)).filter(Boolean);if(1===t.length)return t[0]}});if(2===e.filter(Boolean).length&&1===vi(e).length){let t=e[0];me.inferredGender=t}}}if(me.tieMatchUps){let a="BYE"===me.matchUpStatus,o=me.sides?.map(({participant:e,drawPosition:t,sideNumber:r,lineUp:i})=>{let n=e?.participantType===Dl&&e;return{teamParticipant:n&&nc({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participanOthertName,participantName:n.participantName,participantId:n.participantId,teamId:n.teamId}),drawPosition:t,sideNumber:r,lineUp:i}});me.tieMatchUps=me.tieMatchUps.map(c=>{let d=me.matchUpId,m={finishingPositionRange:me.finishingPositionRange,abbreviatedRoundName:ee,roundNumber:Q,roundName:Z};return Sy({tieDrawPositions:z,scheduleVisibilityFilters:e,sourceDrawPositionRanges:t,sideLineUps:o,drawPositionsRanges:n,initialRoundOfPlay:s,roundNamingProfile:u,additionalContext:m,appliedPolicies:p,isCollectionBye:a,usePublishState:h,publishStatus:b,matchUpTieId:d,isRoundRobin:T,roundProfile:D,matchUp:c,event:R,tournamentParticipants:r,positionAssignments:i,tournamentRecord:l,seedAssignments:f,participantMap:g,contextContent:I,scheduleTiming:y,contextProfile:v,drawDefinition:S,scoringActive:U,structure:N,context:E})})}let fe=2===me.sides?.filter(e=>e?.participantId).length,he=!me.winningSide;if(Object.assign(me,{readyToScore:U&&fe&&he,hasContext:!0}),fe){let{allParticipantsCheckedIn:e,checkedInParticipantIds:t}=EI({matchUp:me});Object.assign(me,{allParticipantsCheckedIn:e,checkedInParticipantIds:t})}return Array.isArray(v?.exclude)&&v?.exclude.forEach(e=>delete me[e]),me}function by(e){if(!Array.isArray(e.matchUps))return[];let{matchUps:t,excludeMatchUpStatuses:r,hasParticipantsCount:i,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:c,matchUpFormat:u,collectionIds:l,isMatchUpTie:d,roundNumbers:p,matchUpIds:m,roundNames:f,filterMatchUpTypes:h=!0,filterMatchUpIds:g=!0,stageSequences:I,scheduledDates:y,scheduledDate:v,participantIds:S,processContext:b,tournamentIds:U,matchUpTypes:w,structureIds:T,readyToScore:D,courtIds:P,eventIds:N,venueIds:E,drawIds:M,stages:R}=e,A=Array.isArray(S)?S.filter(Boolean):[],C=Array.isArray(a)?a.filter(Boolean):[],k=Array.isArray(r)?r.filter(Boolean):[],x=Array.isArray(R)?R.filter(Boolean):[],O=Array.isArray(I)?I.filter(Boolean):[],F=Array.isArray(l)?l.filter(Boolean):[],_=Array.isArray(f)?f.filter(Boolean):[],L=Array.isArray(p)?p.filter(Boolean):[],B=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(m)&&g?m.filter(Boolean):[],V=Array.isArray(w)&&h?w.filter(Boolean):[],j=Array.isArray(P)?P.filter(Boolean):[],G=Array.isArray(E)?E.filter(Boolean):[],W=Array.isArray(s)&&s.filter(Boolean)||"string"==typeof u&&[u]||[],q=Array.isArray(y)&&y.filter(Boolean)||"string"==typeof v&&v.length&&[v]||[],H=Array.isArray(U)?U.filter(Boolean):[],z=Array.isArray(N)?N.filter(Boolean):[],Y=Array.isArray(M)?M.filter(Boolean):[],K=Array.isArray(T)?T.filter(Boolean):[];return t.filter(e=>{if(D&&!MI(zr)(e)&&!e.readyToScore||e.winningSide&&o&&![1,2].includes(e.winningSide)||void 0!==d&&(d&&!e.tieMatchUps||!d&&e.tieMatchUps)||void 0!==n&&(n&&!e.collectionId||!n&&e.collectionId)||x.length&&!x.includes(e.stage)||O.length&&!O.includes(e.stageSequence)||F.length&&(!e.collectionId||!F.includes(e.collectionId))||_.length&&(!e.roundName||!_.includes(e.roundName))||L.length&&(!e.roundNumber||!L.includes(e.roundNumber))||B.length&&(!e.roundPosition||!B.includes(e.roundPosition))||C.length&&(!e.matchUpStatus||!C.includes(e.matchUpStatus))||k.length&&e.matchUpStatus&&k.includes(e.matchUpStatus)||$.length&&!$.includes(e.matchUpId)||V.length&&(!e.matchUpType||!ji(V,e.matchUpType))||W.length&&(!e.matchUpFormat||!W.includes(e.matchUpFormat)))return!1;if(q?.length){let{scheduledTime:t}=XI({matchUp:e}),{scheduledDate:r}=QI({matchUp:e}),i=iu(t)||r;if(!q.find(e=>fu(e,i)))return!1}if(j.length){let{courtId:t}=function({timeStamp:e,schedule:t,matchUp:r}){let{itemValue:i,timeStamp:n}=KI({timeItems:r?.timeItems||[],itemType:iI});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{courtId:i}:t}({matchUp:e}),{allocatedCourts:r}=function({timeStamp:e,schedule:t,matchUp:r}){let{itemValue:i,timeStamp:n}=KI({timeItems:r?.timeItems||[],itemType:rI});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{allocatedCourts:Nu(i,!1,!0)}:t}({matchUp:e}),i=r?.map(({courtId:e})=>e);if(!j.filter(Boolean).includes(t)||i?.includes(t))return!1}if(G.length){let{venueId:t}=function({timeStamp:e,schedule:t,matchUp:r}){let{itemValue:i,timeStamp:n}=KI({timeItems:r?.timeItems||[],itemType:tI});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{venueId:i}:t}({matchUp:e});if(!G.filter(Boolean).includes(t))return!1}if(b){if(H.length&&!H.includes(e.tournamentId)||z.length&&!z.includes(e.eventId)||Y.length&&!Y.includes(e.drawId)||K.length&&!K.includes(e.structureId))return!1;let t=e.sides?.map(({participantId:e})=>e).filter(Boolean)??[];if(i&&t.length<i||A.length&&!A.some(e=>t.includes(e)))return!1}return!0})}function Uy(e){let{provisionalPositioning:t,tournamentRecord:r,contextFilters:i,matchUpFilters:n,contextProfile:a,drawDefinition:o,context:s={},structure:c,inContext:u,event:l}=e,{seedAssignments:d,contextContent:p,exitProfiles:m,matchUpsMap:f}=e,h={},g={};if(!c)return{collectionPositionMatchUps:h,error:Ln,roundMatchUps:g,matchUps:[]};let I=Array.isArray(n?.eventIds)?n?.eventIds.filter(Boolean):[],y=Array.isArray(n?.structureIds)?n?.structureIds.filter(Boolean):[],v=Array.isArray(n?.drawIds)?n?.drawIds.filter(Boolean):[],S=!s?.eventId||!I?.length&&!i?.eventIds?.filter(Boolean).length||I?.includes(s.eventId)||i?.eventIds?.includes(s.eventId),b=!y?.length||y.includes(c.structureId),U=!o||!v?.length||v.includes(o.drawId);if(!S||!b||!U)return{collectionPositionMatchUps:h,roundMatchUps:g,matchUps:[]};a&&!p&&(p=rg({tournamentRecord:r,contextProfile:a,drawDefinition:o}));let{appliedPolicies:w}=zh({drawDefinition:o}),T={...e.tournamentAppliedPolicies,...w,...e.policyDefinitions},D=T?.scoring?.structures,P=c.stage&&D?.stage?.[c.stage],N=c.stageSequence&&P?.stageSequence?.[c.stageSequence],E=T?.scoring?.requireAllPositionsAssigned||P?.requireAllPositionsAssigned||N?.requireAllPositionsAssigned;f||(f=kg({drawDefinition:o,structure:c}));let{positionAssignments:M,allPositionsAssigned:R}=Nf({structure:c}),A=!E||R,{seedAssignments:C}=Mg({provisionalPositioning:t,drawDefinition:o,structure:c});d=d??C;let{structureId:k}=c;m=m||o&&$g({drawDefinition:o}).exitProfiles;let x=m?.[k],O=x?.length&&(x[0].split("-").map(e=>parseInt(e)).reduce((e,t)=>e+t)||0),F=!!c.structures,_=xg({matchUpsMap:f,structureId:k,inContext:u}),L=T?.[Vp],B=qg({roundNamingPolicy:L,drawDefinition:o,structure:c,matchUps:_}),{roundNamingProfile:$,roundProfile:V}=B;if(g=B?.roundMatchUps??[],n&&(_=by({matchUps:_,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),u){let{sourceDrawPositionRanges:t}=function({drawDefinition:e,structureId:t,matchUpsMap:r}){if(!e)return{error:rn};if(!t)return{error:On};let{structure:i}=wf({drawDefinition:e,structureId:t});if(i?.stage!==Rl)return{error:Kn,info:"Structure is not CONSOLATION stage"};let{links:n}=e,a=n?.filter(e=>e.target.structureId===t)||[],o=a?.reduce((e,t)=>{let{structureId:r}=t.source;return e.includes(r)?e:e.concat(r)},[])||[],s=Object.assign({},...o.map(e=>{let t=Lg({matchUps:xg({structureId:e,matchUpsMap:r})}).roundProfile;return{[e]:t}})),c=xg({matchUpsMap:r,structureId:t}),{roundProfile:u}=Lg({matchUps:c}),l={};return a?.forEach(e=>{let{structureId:t,roundNumber:r}=e.source,{feedProfile:i,groupedOrder:n,positionInterleave:a,roundNumber:o}=e.target,c=s[t],d=c[1]?.drawPositions,p=c[r]?.matchUpsCount;if(!p)return;let m=p?d.length/p:0,f=d.length/m,h=d.slice(),g=Og({roundPositionsCount:f,groupedOrder:n}),I=g?.length||1;if(I<=f){let e=_i(h,d.length/I);i===Yl&&e.forEach(e=>e.reverse()),h=g?.length&&g?.map(t=>e[t-1]).flat()||e.flat()}let y=_i(h,m);if(a){let e=Ri(0,a.interleave).map(()=>{}),t=Ri(0,a.offset).map(()=>{});y=y.map(t=>[t,...e]),y.unshift(t),y=y.flat(1);let r=y.length-a.offset;y=y.slice(0,r)}l[o]||(l[o]={});let v=u?.[o]?.feedRound?2:1;y.forEach((e,t)=>{let r=1+t*v;l[o][r]||(l[o][r]=Bg(e))})}),{sourceDrawPositionRanges:l}}({drawDefinition:o,matchUpsMap:f,structureId:k}),n=o?function({drawDefinition:e,roundProfile:t,structureId:r,matchUpsMap:i}){if(!e)return{error:rn};if(!r)return{error:On};if(!t){let e=xg({matchUpsMap:i,structureId:r});if(({roundProfile:t}=Lg({matchUps:e})),!t)return{error:Da}}let n=(Math.min(...t?.[1]?.drawPositions??[])||1)-1,a=Object.keys(t);return{drawPositionsRanges:Object.assign({},...(a||[]).map(e=>{let r=t?.[e]?.matchUpsCount,i=t?.[1]?.drawPositions??[],o=_i(i,i.length/r),s=o.map(Bg),c=o.map(e=>e.map(e=>e-n)).map(Bg),u=a.map(i=>{if(i>e)return;let n=t?.[i]?.drawPositions??[];return _i(n,n.length/r)}).filter(Boolean),l=Ri(0,r).map(e=>u.map(t=>t[e]).flat().filter(Boolean).sort(Qr)).map(e=>vi(e)),d=l.map(e=>function(e){return e.reduce((e,t)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==t-1)&&e.push([]),e[e.length-1].push(t),e},[])}(e).map(Bg).join(", ")),p=Object.assign({},...Ri(0,r).map(e=>({[e+1]:{firstRoundDrawPositionsRange:s[e],firstRoundOffsetDrawPositionsRange:c[e],possibleDrawPositions:l[e],drawPositionsRange:d[e]}})));return{[e]:p}}))}}({drawDefinition:o,roundProfile:V,matchUpsMap:f,structureId:k}).drawPositionsRanges:void 0,m=e.tournamentParticipants,h=e.participantMap;!m?.length&&!h&&r&&({participants:m=[],participantMap:h}=Hh({participantsProfile:e.participantsProfile,useParticipantMap:e.useParticipantMap,policyDefinitions:e.policyDefinitions,tournamentRecord:r,contextProfile:a,inContext:u})),_=_.map(i=>Sy({scheduleVisibilityFilters:e.scheduleVisibilityFilters,hydrateParticipants:e.hydrateParticipants,afterRecoveryTimes:e.afterRecoveryTimes,usePublishState:e.usePublishState,scheduleTiming:e.scheduleTiming,publishStatus:e.publishStatus,sourceDrawPositionRanges:t,tournamentParticipants:m,positionAssignments:M,drawPositionsRanges:n,initialRoundOfPlay:O,roundNamingProfile:$,tournamentRecord:r,appliedPolicies:T,seedAssignments:d,contextContent:p,participantMap:h,contextProfile:a,drawDefinition:o,scoringActive:A,isRoundRobin:F,roundProfile:V,structure:c,context:s,matchUp:i,event:l})),(_?.filter(e=>Array.isArray(e.tieMatchUps))).forEach(e=>{let t=e.tieMatchUps;_=_.concat(...t)}),i&&(_=by({processContext:!0,...i,matchUps:_}))}else(_?.filter(e=>Array.isArray(e.tieMatchUps))).forEach(e=>{let t=e.tieMatchUps;_=_.concat(...t)});return n&&(_=by({matchUps:_,...n,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(n?.matchUpTypes||n?.matchUpIds)&&(_=by({matchUpTypes:n.matchUpTypes,matchUpIds:n.matchUpIds,matchUps:_})),(n?.matchUpTypes||n?.matchUpIds||u)&&(g=Lg({matchUps:_}).roundMatchUps??[]),Cg({drawDefinition:o,structure:c,event:l})?.tieFormat&&({collectionPositionMatchUps:h}=function({matchUps:e}){let t=e.reduce((e,t)=>!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition),[]).map(t=>({[t]:e.filter(e=>e.collectionPosition===t)}));return{collectionPositionMatchUps:Object.assign({},...t)}}({matchUps:_})),{collectionPositionMatchUps:h,roundMatchUps:g,isRoundRobin:F,roundProfile:V,matchUpsMap:f,matchUps:_}}function wy({matchUp:e}){return!!e&&(If.includes(e?.matchUpStatus)||e?.winningSide)}function Ty({requireParticipants:e=!0,scheduleVisibilityFilters:t,tournamentAppliedPolicies:r,tournamentParticipants:i,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:c,matchUpFilters:u,contextFilters:l,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:f,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:y,structureId:v,inContext:S,structure:b,context:U,event:w}){!b&&v&&({structure:b}=wf({drawDefinition:g,structureId:v}));let T=Uy({tournamentAppliedPolicies:r,scheduleVisibilityFilters:t,tournamentParticipants:i,hydrateParticipants:n,afterRecoveryTimes:a,policyDefinitions:o,tournamentRecord:s,usePublishState:c,matchUpFilters:u,contextFilters:l,contextContent:d,participantMap:p,scheduleTiming:m,publishStatus:f,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:y,structure:b,inContext:S,context:U,event:w}),D=[],P=[],N=[],E=[],M=[];if(T.error)return T;let R,{matchUps:A}=T,{assignedPositions:C}=Nf({structure:b}),k=C?.filter(e=>e.participantId).map(e=>e.drawPosition);return A.filter(e=>{let t=1===u?.matchUpTypes?.length&&u.matchUpTypes[0]===Yr;return!(e.matchUpType!==Yr&&t)}).forEach(t=>{if(t.matchUpStatus===Xm)return void D.push(t);t.matchUpType===Yr&&(R=!0);let r=!!t.collectionId,i=r&&t.sides?.every(e=>e.participantId),n=!r&&2===t.drawPositions?.filter(Boolean).length,a=!r&&t.drawPositions?.every(e=>k?.includes(e)),o=C?.filter(e=>e.bye).map(e=>e.drawPosition),s=!r&&t.drawPositions?.find(e=>o?.includes(e)),c=vf.includes(t.matchUpStatus)&&(i||n&&(!e||a));return s?M.push(t):wy({matchUp:t})?P.push(t):c?N.push(t):E.push(t)}),{includesTeamMatchUps:R,abandonedMatchUps:D,completedMatchUps:P,upcomingMatchUps:N,pendingMatchUps:E,byeMatchUps:M,structure:b}}function Dy({finishingPositions:e,linkCondition:t,linkType:r,source:i}){let n=i.find(i=>{let n=!i.source?.finishingPositions||!e||xi(e,i.source?.finishingPositions);return t===i.linkCondition&&n&&i.linkType===r});return[Xl,Ql].includes(n?.linkType)&&!n?.source?.roundNumber?ac({result:{error:Zo},stack:"getTargetLink",context:n}):n}function Py({drawDefinition:e,structureId:t,roundNumber:r}){return e?t?{links:(e.links||[]).filter(Boolean).reduce((e,i)=>(i.source?.structureId===t&&(!r||i.source.roundNumber===r)&&(e.source=e.source.concat(i)),i.target?.structureId===t&&(!r||i.target.roundNumber===r)&&(e.target=e.target.concat(i)),e),{source:[],target:[]})}:{error:On}:{error:rn}}function Ny({sourceRoundMatchUpCount:e,inContextDrawMatchUps:t,sourceRoundPosition:r,drawDefinition:i,targetLink:n}){if(!n)return{error:kn};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:u}}=n,{structure:l}=wf({drawDefinition:i,structureId:a}),{positionAssignments:d}=Pf({structure:l}),p=(t?.filter(e=>e.structureId===l?.structureId)).filter(e=>e.roundNumber===c&&!e.matchUpTieId),m=p.length,f=Ri(1,m+1),h=m/e,g=Math.ceil(h*r),I=1-r%2;if(u?.interleave&&.5!==h){let e=r+(u.offset+(r-1)*u.interleave);g=Math.ceil(e/2),I=1-e%2}let y=f,v=f[g-1],S=Og({roundPositionsCount:f.length,groupedOrder:s}),b=S?.length||1;if(b<=f.length){let e=_i(f,m/b);o===Yl&&e.forEach(e=>e.reverse()),y=S?.length&&S?.map(t=>e[t-1]).flat()||y}o===zl?v=y[g-1]:o===Yl?((!S?.length||b>f.length)&&(g=p.length+1-g),v=y[g-1]):o===Hl&&Ps()&&console.log(os,{feedProfile:o});let U,w=v&&p.reduce((e,t)=>t.roundPosition===v?t:e,void 0);w?.feedRound?(I=0,U=Math.min(...(w.drawPositions||[]).filter(Boolean))):U=2===w?.drawPositions?.length&&w?.drawPositions[I];let T=d?.find(({drawPosition:e})=>e===U);if(T){let{extension:e}=lm({element:T,name:gm});if(e?.value)return{disabledDrawPosition:U}}return{matchUp:w,targetDrawPosition:U,matchUpDrawPositionIndex:I}}function Ey({inContextDrawMatchUps:e=[],useTargetMatchUpIds:t,inContextMatchUp:r,drawDefinition:i,matchUpId:n}){let a=r;e.length&&!a&&(a=e.find(e=>e.matchUpId===n));let{structure:o}=wf({structureId:a?.structureId,drawDefinition:i});return o?.finishingPosition===Pd?function({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:r,structure:i,matchUp:n}){let{winnerMatchUpId:a,loserMatchUpId:o}=n,{links:s}=function({drawDefinition:e,roundNumber:t,structureId:r}){if(!e)return{error:rn};if(!r)return{error:On};let{links:i}=Py({drawDefinition:e,structureId:r});return{links:{source:i.source.reduce((e,r)=>r.source.roundNumber&&r.source.roundNumber!==t?e:e.concat(r),[]),target:i.target.reduce((e,r)=>r.target.roundNumber&&r.target.roundNumber!==t?e:e.concat(r),[])}}}({roundNumber:n.roundNumber,structureId:i.structureId,drawDefinition:r}),c=s?.source,u=Dy({source:c,linkType:Xl}),l=Dy({linkCondition:Jl,linkType:Ql,source:c}),d=Dy({source:c,linkType:Ql}),p=l&&d;d||(d=l);let m,f,h,g,I,y,v,S,b,U,w=u?.target?.feedProfile,T=d?.target?.feedProfile,D=l?.target?.feedProfile;if(t&&(a||o)&&(v=a&&w!==ql&&e.find(({matchUpId:e})=>e===a),g=o&&T!==ql&&e.find(({matchUpId:e})=>e===o),v||g))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v}};let{roundPosition:P}=n;U=U||e.filter(e=>e.structureId===i.structureId);let N=U.reduce((e,t)=>t.roundNumber!==n.roundNumber||t.matchUpTieId?e:e+1,0);return d&&!g&&T!==ql&&({matchUpDrawPositionIndex:y,targetDrawPosition:I,matchUp:g}=Ny({targetLink:d,sourceRoundMatchUpCount:N,inContextDrawMatchUps:e,sourceRoundPosition:P,drawDefinition:r})),p&&D!==ql&&({matchUpDrawPositionIndex:h,targetDrawPosition:f,matchUp:m}=Ny({targetLink:l,sourceRoundMatchUpCount:N,inContextDrawMatchUps:e,sourceRoundPosition:P,drawDefinition:r})),u&&!v&&w!==ql&&({matchUpDrawPositionIndex:b,targetDrawPosition:S,matchUp:v}=Ny({targetLink:u,sourceRoundMatchUpCount:N,inContextDrawMatchUps:e,sourceRoundPosition:P,drawDefinition:r})),v||(U=U||e.filter(e=>e.structureId===i.structureId),({matchUp:v}=function({structureMatchUps:e,matchUp:t}){let{roundNumber:r,roundPosition:i}=t,n=e.filter(e=>e.roundNumber===r&&!e.matchUpTieId),a=e.filter(e=>e.roundNumber===r+1&&!e.matchUpTieId);if(a.length){let e;return a.length===n.length?e=a.find(e=>e.roundPosition===i):a.length===n.length/2&&(e=a.find(e=>e.roundPosition===Math.ceil(i/2))),{matchUp:e}}return{message:"no progression found"}}({structureMatchUps:U,matchUp:n}))),nc({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:u,byeTargetLink:l},targetMatchUps:{winnerMatchUpDrawPositionIndex:b,loserMatchUpDrawPositionIndex:y,byeMatchUpDrawPositionIndex:h,winnerTargetDrawPosition:S,loserTargetDrawPosition:I,byeTargetDrawPosition:f,winnerMatchUp:v,loserMatchUp:g,byeMatchUp:m},targetMatchUpIds:!(!a&&!o)})}({inContextDrawMatchUps:e,useTargetMatchUpIds:t,drawDefinition:i,structure:o,matchUp:a}):function({matchUp:e}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:e}}({matchUp:a})}function My({drawDefinition:e,inContextDrawMatchUps:t}){let r={};return t.forEach(i=>{let{matchUpId:n,structureId:a,drawPositions:o=[]}=i,{structure:s}=wf({drawDefinition:e,structureId:a});if(s?.finishingPosition===Dd){let{roundNumber:e}=i,t=e&&Jr(e)+1,r=s.matchUps??[],{roundMatchUps:n}=Lg({matchUps:r});if(t&&n?.[t]){let e=[...o].sort(Qr).map((e,r)=>{let i=n[t].find(t=>t.drawPositions?.includes(e));return{matchUpId:i?.matchUpId,roundNumber:t,schedule:i?.schedule,sideNumber:r+1,structureName:s.structureName}});Object.assign(i,{sidesTo:e})}}else{let a=Ey({useTargetMatchUpIds:!0,inContextDrawMatchUps:t,inContextMatchUp:i,drawDefinition:e,matchUpId:n}),{winnerMatchUp:o}=a.targetMatchUps,{loserMatchUp:s}=a.targetMatchUps;!i.winnerMatchUpId&&o&&(i.winnerMatchUpId=o.matchUpId),!i.loserMatchUpId&&s&&(i.loserMatchUpId=s.matchUpId);let c=Ay({upcomingMatchUp:o}),u=Ay({upcomingMatchUp:s});if("BYE"!==i.matchUpStatus&&"BYE"===s?.matchUpStatus){let{matchUp:r}=Ry({matchUp:s,drawDefinition:e,inContextDrawMatchUps:t})||{};u=r&&Ay({upcomingMatchUp:r})||u}let l=i.schedule?.timeAfterRecovery;if(l&&(c?.schedule?.scheduledTime&&eu(c.schedule.scheduledTime)<eu(l)&&(r[c.matchUpId]=i.matchUpId,c.schedule.scheduleConflict=i.matchUpId),u?.schedule?.scheduledTime&&eu(u.schedule.scheduledTime)<eu(l)&&(r[u.matchUpId]=i.matchUpId,u.schedule.scheduleConflict=i.matchUpId)),Object.assign(i,{winnerTo:c,loserTo:u}),i.drawPositions?.filter(Boolean).length){let e=a.targetLinks?.loserTargetLink?.linkCondition===Jl,r=function(e){return e?.sides?.map(({participant:e,participantId:t,qualifier:r})=>e||t&&{participantId:t}||r&&{qualifier:r}).filter(Boolean)||[]}(i);if(r.length){let i=qm(o?.sides),n=qm(s?.sides),c=r.find(({participantId:e})=>i.includes(e))?[]:r,u=r.find(({participantId:e})=>n.includes(e))?[]:r;s&&e&&u.length<2&&u.push({bye:!0,tbd:!0}),c?.length&&o&&(!a.targetMatchUpIds&&o&&(o=t.find(({matchUpId:e})=>e===o.matchUpId)),o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(c)),u?.length&&s&&(a.targetMatchUpIds||(o=t.find(({matchUpId:e})=>e===s.matchUpId)),s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(u))}}}}),Object.keys(r).length&&t.forEach(e=>{Object.keys(r).includes(e.matchUpId)&&(e.schedule.scheduleConflict=r[e.matchUpId])}),{scheduleConflictMatchUpIds:r}}function Ry({matchUp:e,drawDefinition:t,inContextDrawMatchUps:r}){let{matchUpId:i,matchUpStatus:n,structureId:a}=e||{};if(!e||!a||e?.matchUpStatus===lf)return{matchUp:e};if("BYE"===n){let n;return e.winnerMatchUpId?n=r.find(({matchUpId:t})=>t===e.winnerMatchUpId):({winnerMatchUp:n}=Ey({inContextDrawMatchUps:r,drawDefinition:t,matchUpId:i})?.targetMatchUps||{}),Ry({matchUp:n,drawDefinition:t,inContextDrawMatchUps:r})}return{matchUp:void 0}}function Ay(e){if(e?.upcomingMatchUp)return(({matchUpId:e,structureId:t,schedule:r,roundNumber:i,roundPosition:n,structureName:a})=>({matchUpId:e,structureId:t,schedule:r,roundNumber:i,roundPosition:n,structureName:a}))(e.upcomingMatchUp)}function Cy(e){Object.assign(e,{requireParticipants:!1});let t=ky(e);if(t.error)return ac({result:t,stack:"getAllDrawMatchUps"});let{abandonedMatchUps:r,completedMatchUps:i,upcomingMatchUps:n,pendingMatchUps:a,byeMatchUps:o,matchUpsMap:s}=t;return{matchUps:(r??[]).concat(...i??[],...n??[],...a??[],...o??[]),matchUpsMap:s}}function ky(e){if(!e?.drawDefinition)return{error:rn};let t,{tournamentParticipants:r,contextContent:i,matchUpsMap:n}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,requireParticipants:s,participantsProfile:c,afterRecoveryTimes:u,policyDefinitions:l,tournamentRecord:d,usePublishState:p,contextFilters:m,matchUpFilters:f,scheduleTiming:h,participantMap:g,publishStatus:I,contextProfile:y,drawDefinition:v,nextMatchUps:S,inContext:b,context:U,event:w}=e,T=[],D=[],P=[],N=[],E=[];y&&!i&&(i=rg({policyDefinitions:l,tournamentRecord:d,contextProfile:y,event:w})),!r?.length&&d&&(r=d?.participants,(b||c?.withGroupings)&&r?.length&&({participantsWithGroupings:r,groupInfo:t}=Mh({participants:r,participantsProfile:c})));let{structures:M}=Tf({drawDefinition:v});if(!M)return{error:Fn};n||(n=kg({drawDefinition:v}));let R=v&&$g({drawDefinition:v}).exitProfiles;M.forEach(t=>{let{byeMatchUps:c=[],pendingMatchUps:M=[],upcomingMatchUps:A=[],completedMatchUps:C=[],abandonedMatchUps:k=[]}=Ty({matchUpFilters:S?void 0:f,contextFilters:S?void 0:m,inContext:b||S||m,hydrateParticipants:e.hydrateParticipants,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:r,requireParticipants:s,afterRecoveryTimes:u,policyDefinitions:l,tournamentRecord:d,usePublishState:p,contextContent:i,participantMap:g,scheduleTiming:h,publishStatus:I,contextProfile:y,drawDefinition:v,exitProfiles:R,matchUpsMap:n,structure:t,context:U,event:w});T=T.concat(...k),D=D.concat(...C),P=P.concat(...A),N=N.concat(...M),E=E.concat(...c)});let A=e=>(!f&&!S&&!m||(f&&(e=by({matchUps:e,...f})),m&&(e=by({matchUps:e,...m,processContext:!0}))),e),C={abandonedMatchUps:A(T),completedMatchUps:A(D),upcomingMatchUps:A(P),pendingMatchUps:A(N),byeMatchUps:A(E),matchUpsMap:n,...Gi,groupInfo:t};if(S){let e="object"==typeof S||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:t,completed:r,upcoming:i,pending:n,bye:a}=e;My({inContextDrawMatchUps:[].concat(...t&&T||[],...r&&D||[],...i&&P||[],...n&&N||[],...a&&E||[]),drawDefinition:v})}return C}function xy(e){let{participants:t=[],contextContent:r,participantMap:i}=e,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:u,tournamentRecord:l,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:f,nextMatchUps:h,inContext:g,context:I,event:y}=e;if(!y)return{error:jn};let v,{eventId:S,eventName:b,endDate:U,eventType:w,category:T,gender:D,matchUpFormat:P}=y??{},N={...I,...nc({indoorOutDoor:y.indoorOutdoor??l?.indoorOutdoor,surfaceCategory:y.surfaceCategory??l?.surfaceCategory,endDate:y.endDate??l?.endDate,tournamentId:l?.tournamentId,matchUpFormat:P,eventName:b,eventType:w,category:T,eventId:S,gender:D})};if(U&&(N.endDate=U),f&&!r&&(r=rg({policyDefinitions:c,tournamentRecord:l,contextProfile:f,event:y})),!t?.length&&!i&&l){let e=Hh({participantsProfile:o,useParticipantMap:u,tournamentRecord:l,contextProfile:f,inContext:g});i=e.participantMap,t=e.participants??[],v=e.groupInfo}let E=y.drawDefinitions??[],M=ng({tournamentRecord:l,event:y}).scheduleTiming;return{matchUps:E.flatMap(e=>{let{matchUps:u}=Cy({tournamentParticipants:t,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:N,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:l,usePublishState:d,contextFilters:p,contextProfile:f,drawDefinition:e,contextContent:r,matchUpFilters:m,participantMap:i,scheduleTiming:M,nextMatchUps:h,inContext:g,event:y});return u??[]}),groupInfo:v}}function Oy(e){let t=Dp(e,[{tournamentRecord:!0}]);if(t.error)return t;if(!e?.tournamentRecord)return{error:Ji};let{participantMap:r,participants:i}=e,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:c,tournamentRecord:u,inContext:l=!0,usePublishState:d,contextProfile:p,matchUpFilters:m,contextFilters:f,nextMatchUps:h,context:g}=e,I=e.tournamentId??u.tournamentId,y=u?.events??[];i||({participants:i,participantMap:r}=Hh({participantsProfile:a,useParticipantMap:s,tournamentRecord:u,contextProfile:p,inContext:l}));let{appliedPolicies:v}=zh({tournamentRecord:u}),S={...g,tournamentId:I,indoorOutDoor:u.indoorOutdoor,surfaceCategory:u.surfaceCategory,endDate:u.endDate},b=rg({policyDefinitions:c,tournamentRecord:u,contextProfile:p});return{matchUps:y.flatMap(e=>(S.eventDrawsCount=e.drawDefinitions?.length??0,xy({context:S,scheduleVisibilityFilters:n,tournamentAppliedPolicies:v,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:b,contextFilters:f,contextProfile:p,matchUpFilters:m,participantMap:r,nextMatchUps:h,participants:i,inContext:l,event:e}).matchUps??[])).concat(...u.matchUps??[])}}function Fy({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:r,tournamentRecords:i,policyDefinitions:n,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:c,inContext:u}){if("object"!=typeof i||!Object.keys(i).length)return{error:Qi};let l=Object.keys(i).map(l=>{let d=i[l];return Oy({scheduleVisibilityFilters:e,afterRecoveryTimes:t,participantsProfile:r,policyDefinitions:n,tournamentRecord:d,usePublishState:a,matchUpFilters:o,contextFilters:s,nextMatchUps:c,inContext:u}).matchUps??[]}).flat();return{...Gi,matchUps:l}}function _y(e,t){return function(e,t){return(xl[e?.stage]||0)-(xl[t?.stage]||0)}(e,t)||(e?.stageSequence||0)-(t?.stageSequence||0)||e?.roundNumber&&t.roundNumber&&e?.roundNumber-t?.roundNumber||(e?.roundPosition??0)-(t?.roundPosition??0)}function Ly(e){let t,{participants:r,participantMap:i,contextContent:n}=e,{scheduleVisibilityFilters:a,tournamentAppliedPolicies:o,participantsProfile:s,afterRecoveryTimes:c,policyDefinitions:u,useParticipantMap:l,tournamentRecord:d,matchUpFilters:p,contextFilters:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,inContext:I,context:y,event:v}=e,{eventId:S,eventName:b,endDate:U,eventType:w,category:T,gender:D,matchUpFormat:P}=v??{},N={...y,surfaceCategory:v?.surfaceCategory??d?.surfaceCategory,indoorOutDoor:v?.indoorOutdoor??d?.indoorOutdoor,matchUpFormat:P,eventType:w,eventName:b,category:T,eventId:S,endDate:U,gender:D};return!r?.length&&!i&&d&&({participants:r=[],participantMap:i,groupInfo:t}=Hh({participantsProfile:s,useParticipantMap:l,tournamentRecord:d,contextProfile:f,inContext:I})),f&&!n&&(n=rg({policyDefinitions:u,tournamentRecord:d,contextProfile:f,drawDefinition:h,event:v})),{...Cy({context:N,tournamentAppliedPolicies:o,scheduleVisibilityFilters:a,tournamentParticipants:r,participantsProfile:s,afterRecoveryTimes:c,policyDefinitions:u,tournamentRecord:d,drawDefinition:h,contextContent:n,contextFilters:m,contextProfile:f,matchUpFilters:p,participantMap:i,nextMatchUps:g,inContext:I,event:v}),groupInfo:t}}function By({element:e,accessor:t}){if("string"!=typeof t)return{values:[]};let r,i=Nu(e),n=t.split("."),a=[];!function e({targetElement:t,attributes:i=[],significantCharacters:n}){for(let[s,c]of i.entries())if(t?.[c]){let n=i.slice(s+1);n.length?Array.isArray(t[c])?t[c].forEach(t=>e({targetElement:t,attributes:n})):o({targetElement:t=t[c],index:s}):(r||(r=t[c]),a.includes(t[c])||a.push(t[c]))}function o({targetElement:e,index:t}){if(e&&t===i.length-1&&["string","number"].includes(typeof e)){let t=n?e.slice(0,n):e;r?a.includes(t)||a.push(t):(r=t,a.push(t))}}}({targetElement:i,attributes:n});let o={value:r};return a.length&&(o.values=a),o}var $y=e=>t=>e&&"object"==typeof t?Array.isArray(e)&&e.map(e=>({[e]:By({element:t,accessor:e})?.value}))||"object"==typeof e&&Object.keys(e).map(e=>({[e]:By({element:t,accessor:e})?.value}))||("string"==typeof e&&By({element:t,accessor:e}))?.value:void 0,Vy=$y;function jy({finishingPositionOffset:e=0,finishingPositionLimit:t,positionsFed:r,roundsCount:i,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){if(!_g(a))return[];let{roundProfile:c,roundNumbers:u=[]}=Lg({interpolate:!0,matchUps:a});i=i??Math.max(...u,0);let l=n?i-n:0,d=l&&c?.[i-l]?.matchUpsCount,p=c&&Object.values(c).map(Vy("matchUpsCount")),m=(e,r)=>{let i=Math.min(...e);d&&r&&1===i&&(i=d);let n=Math.max(...e);return t&&n>t&&(n=t),[i,n]},f=c&&Object.assign({},...u.map(t=>{let n=(i??0)+1-t-l,a=c[t].matchUpsCount,u={finishingPositionRange:{},finishingRound:n},d=p?.slice(t-1).reduce((e,t)=>e+(t||0),0),f=1+e+(s&&1!==t?r??0:0),h=Ri(f,o?f+2*a:d+f+1),g=d+1-a,I=m(h.slice(g)),y=m(h.slice(0,g),!0);return u.finishingPositionRange={loser:I,winner:y},{[t]:u}})),h=Ps({finishingRound:!0});return a.filter(Boolean).forEach(e=>{let t=e.roundNumber&&f[e.roundNumber];h&&!t&&console.log({roundFinishingData:f,matchUp:e}),e.finishingRound=t?.finishingRound,e.finishingPositionRange=t?.finishingPositionRange}),a}function Gy({inContextDrawMatchUps:e,drawDefinition:t,matchUpsMap:r}){if(!t)return{error:rn};let i={loserMatchUpIds:{},winnerMatchUpIds:{}};if(e||({matchUps:e,matchUpsMap:r}=Cy({inContext:!0,drawDefinition:t,matchUpsMap:r})),!r?.drawMatchUps.some(e=>e.finishingPositionRange)&&1===t?.structures?.length&&!t?.structures[0].structures){jy({matchUps:r?.drawMatchUps??[]})}return(e??[]).filter(({collectionId:e})=>!e).forEach(n=>{let{matchUpId:a,structureId:o}=n,s=Ey({inContextDrawMatchUps:e,drawDefinition:t,matchUpId:a}),{winnerMatchUp:c,loserMatchUp:u}=s.targetMatchUps,l=c?.matchUpId,d=u?.matchUpId,p=xg({matchUpsMap:r,structureId:o}).find(e=>e.matchUpId===a);if(p&&(l&&(i.winnerMatchUpIds[p.matchUpId]=l,Object.assign(p,{winnerMatchUpId:l}),Object.assign(n,{winnerMatchUpId:l})),d&&(i.loserMatchUpIds[p.matchUpId]=d,n.loserMatchUpId=d,p.loserMatchUpId=d,n.finishingPositionRange))){let e=u.finishingPositionRange&&[...n.finishingPositionRange.loser,...u.finishingPositionRange.loser],t=e&&[Math.min(...e),Math.max(...e)];n.finishingPositionRange.loser=t,p.finishingPositionRange.loser=t}}),{inContextDrawMatchUps:e,goesToMap:i}}function Wy(e){let t=yh(e),r=e.matchUps??[],i=e.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:o}=e;if(!Array.isArray(r))return{error:pa};if(!Array.isArray(i))return{error:wn};let s=e.matchUpIds?.length?e.matchUpIds:r.map(e=>e.matchUpId);if(!Array.isArray(s))return{error:la};let c={},u={},l={},d={};a&&!Object.keys(t).length&&(t={[a.tournamentId]:a});let p=Object.values(t),m=p.reduce((e,t)=>e.concat(t.events??[]).map(e=>(e.drawDefinitions||[]).map(e=>e.links||[])).flat(1/0),[]).filter(({linkType:e})=>e===Kl),f=r;if(m.length){f=Fy({nextMatchUps:!0,tournamentRecords:t}).matchUps;let e=m.reduce((e,t)=>{let r=t.source?.structureId,i=t.target?.structureId;return r&&i&&(l[i]=r),r&&!e.includes(r)&&e.push(r),e},[]);for(let t of e)c[t]=[];for(let t of f??[]){let r=t.containerStructureId||t.structureId;e.includes(r)&&c[r].push(t.matchUpId)}}let h=e=>{u[e]||(u[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[e]=[])},g=(e,t)=>{u[e].matchUpIds.forEach(e=>{u[t].matchUpIds.push(e)}),u[t].matchUpIds.push(e),u[e].dependentMatchUpIds.push(t),n&&u[e].participantIds.forEach(e=>u[t].participantIds.push(e))},I=e=>{let t=Object.keys(c).length;for(let r of e||[]){let{matchUpId:e,winnerMatchUpId:i,loserMatchUpId:a}=r;if(!s.length||s.includes(e)){if(h(e),n){let{individualParticipantIds:t}=Ih(r);u[e].participantIds=t}i&&(h(i),g(e,i),d[i].push(e)),a&&(h(a),g(e,a),d[a].push(e)),u[e].sources.push(d[e]);let o=d[e].map(e=>u[e].sources[0]).flat(),s=d[e].map(e=>u[e].sources[1]).flat();if(u[e].sources.push(o,s),t){let t=r.containerStructureId||r.structureId,i=l[t];if(c[i])for(let r of c[i])h(r),g(r,e),d[r].push(e)}}}};if(o)Gy({drawDefinition:o}),f?.length||(f=Ly({drawDefinition:o}).matchUps),I(f);else{if(f?.length||(f=Fy({nextMatchUps:!0,tournamentRecords:t}).matchUps),!i.length){let e=p?.length?p.map(({events:e=[]})=>e.map(({drawDefinitions:e=[]})=>e.map(({drawId:e})=>e))).flat(1/0):[];e&&(i=e)}for(let e of i){let r=f?.filter(t=>t.drawId===e).sort(_y);if(!r?.find(({roundPosition:e})=>!e)){let i=r?.find(({tournamentId:e})=>e),{drawDefinition:n}=my({tournamentRecord:t[i?.tournamentId],drawId:e});n&&Gy({drawDefinition:n})}I(r)}}return{positionDependencies:c,matchUpDependencies:u,sourceMatchUpIds:d,matchUps:f,...Gi}}function qy(e){let t=e?.matchUp,r=e?.score||t?.score,i=r?.sets?.[0],{side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:c,side2PointScore:u}=i||{},l=n||a||o||s||c||u;return!!(r?.sets?.length>1||l)}function Hy({matchUpStatus:e}){return hf.includes(e)}function zy({matchUpStatus:e}){return gf.includes(e)}function Yy({matchUpStatus:e,winningSide:t,tieMatchUps:r,sides:i,score:n}){let a=i?.find(({participantId:e})=>e),o=r?.filter(Yy)?.length;return qy({score:n})||o||t&&a||e&&function({matchUpStatus:e}){return yf.includes(e)}({matchUpStatus:e})&&![tf,df,af].includes(e)}function Ky(e){let{drawDefinition:t,findContainer:r,structureId:i,event:n}=e,a=e.structure,{containedStructures:o}=gh({drawDefinition:t}),s=i&&o[i]||[];if(!a){let e=wf({drawDefinition:t,structureId:i});if(e.error)return e;a=r?e.containingStructure??e.structure:e.structure}if(jg({structure:a}))return{structure:a,isAdHoc:!0,error:In};let{matchUps:c}=Cy({inContext:!0,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:t,event:n}),u=c?.filter(e=>e.structureId===i||s.includes(e.structureId)),{matchUpDependencies:l}=Wy({drawIds:[t.drawId],matchUps:c,drawDefinition:t}),d=[],p=[],m={},f=[];for(let U of c??[]){if(U.structureId===i||s.includes(U.structureId)){p.push(...U.drawPositions??[]);let e=U.roundNumber;for(let t of(U.drawPositions??[]).filter(Boolean))(!m[t]||e&&m[t]>e)&&(m[t]=e)}Yy(U)&&(f.push(U),d.push(U.matchUpId,...l?.[U?.matchUpId]?.matchUpIds||[]))}let h=vi(p.filter(Boolean)).sort(Qr),g=vi(d),I=vi(u?.map(({matchUpId:e,drawPositions:t})=>g.includes(e)?t:[]).flat().filter(Boolean)).sort(Qr),{positionAssignments:y}=Pf({drawDefinition:t,structure:a}),v=y?.filter(e=>e.bye).map(e=>e.drawPosition),S=y?.filter(e=>e.qualifier).map(e=>e.drawPosition),b=h?.filter(e=>!I.includes(e))||[];return{allDrawPositions:h,inContextStructureMatchUps:u,drawPositionInitialRounds:m,activeDependentMatchUpIds:g,qualifyingDrawPositions:S,inactiveDrawPositions:b,positionAssignments:y,activeDrawPositions:I,byeDrawPositions:v,activeMatchUps:f,structure:a}}function Xy({drawPosition:e,matchUps:t=[]}){return{initialRoundNumber:t.filter(({drawPositions:t})=>e&&t?.includes(e)).map(({roundNumber:e})=>e).sort(Qr)[0]}}var Qy={reset:"\x1b[0m",bright:"\x1b[1m",dim:"\x1b[2m",red:"\x1b[31m",brightred:"\x1b[91m",green:"\x1b[32m",brightgreen:"\x1b[92m",yellow:"\x1b[33m",brightyellow:"\x1b[93m",blue:"\x1b[34m",brightblue:"\x1b[94m",lightblue:"\x1b[105m",magenta:"\x1b[35m",brightmagenta:"\x1b[95m",cyan:"\x1b[36m",brightcyan:"\x1b[96m",white:"\x1b[37m",brightwhite:"\x1b[97m"},Jy=[];function Zy(e,t){ei(e)&&(e={method:e}),(t||Ps())&&Jy.push(e)}function ev(e){let t=Jy.slice().map(e=>{let{color:t,keyColors:r,method:i,newline:n}=e,a=Object.keys(Qy).includes(t)?Qy[t]:Qy.cyan,o=Object.keys(e).filter(e=>!["color","keyColors","method","newline"].includes(e)).map(t=>{let i=r&&Object.keys(r).includes(t)&&Qy[r[t]]?Qy[r[t]]:Qy.brightwhite;return`${Qy.white}${t}: ${i}${e[t]}`}).join(", ");return[n?"\n":"",a,i,i?.length<15?"\t\t":"\t",Qy.white,o,Qy.reset,"\n"].join("")});t?.length&&console.log(...t)}function tv(e){let t=e.bye,r=e.qualifier,i=e.participantId;return{containsBye:t,containsQualifier:r,containsParticipant:i,filled:t||r||i}}function rv(e){return[tf,df,cf].includes(e)}function iv({provisionalPositioning:e,isPositionAction:t,tournamentRecord:r,drawDefinition:i,drawPosition:n,loserMatchUp:a,matchUpsMap:o,structureId:s,structure:c,event:u}){if(!i)return{error:rn};if(c||({structure:c}=wf({drawDefinition:i,structureId:s})),!c)return{error:Fn};s||({structureId:s}=c);let l="assignDrawPositionBye";Zy({method:l,color:"cyan",drawPosition:n}),o??=kg({drawDefinition:i});let{positionAssignments:d}=Pf({structure:c}),{activeDrawPositions:p}=Ky({drawDefinition:i,structureId:s});if(d?.find(e=>e.drawPosition===n)?.bye)return{...Gi};let m=!(!a||!o.drawMatchUps.some(e=>e.loserMatchUpId===a?.matchUpId&&rv(e.matchUpStatus)));if(p?.includes(n)&&!m)return{error:hn};let f=d?.find(e=>e.drawPosition===n);if(!f)return{error:In};let{filled:h,containsBye:g,containsParticipant:I}=tv(f);if(g)return{...Gi};if(h&&!g&&!m)return ac({result:{error:un},stack:l});let y=zh({tournamentRecord:r,drawDefinition:i,event:u}).appliedPolicies??{},v=Cy({inContext:!0,drawDefinition:i,matchUpsMap:o}).matchUps??[],{matchUps:S}=Uy({provisionalPositioning:e,drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:o,structure:c});if(d?.forEach(e=>{e.drawPosition===n&&(e.bye=!0,m&&(e.participantId=void 0))}),c.structureType===Wl)return function({tournamentRecord:e,drawDefinition:t,drawPosition:r,matchUps:i,event:n}){i.forEach(i=>{i.drawPositions?.includes(r)&&av({eventId:n?.eventId,tournamentRecord:e,drawDefinition:t,matchUp:i})})}({tournamentRecord:r,drawDefinition:i,drawPosition:n,matchUps:S}),ph({tournamentId:r?.tournamentId,drawDefinition:i,structure:c,event:u}),nv({assignedParticipantId:I,isPositionAction:t,appliedPolicies:y,drawDefinition:i,drawPosition:n,structureId:s,stack:l});let{roundProfile:b,roundMatchUps:U}=Lg({matchUps:S}),w=(b&&Object.keys(b).map(e=>Number.parseInt(e)).reverse())?.find(e=>b?.[e].drawPositions?.includes(n)),T=w?U?.[w].find(({drawPositions:e})=>e?.includes(n)):void 0;T&&av({tournamentRecord:r,drawDefinition:i,matchUp:T,event:u});let D=T?.drawPositions?.find(e=>e!==n);if(T&&D){let e=ov({sourceDrawPositions:T.drawPositions,matchUpId:T.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:D,tournamentRecord:r,drawDefinition:i,matchUpsMap:o});if(e.error)return e}return ph({tournamentId:r?.tournamentId,drawDefinition:i,structure:c,event:u}),nv({assignedParticipantId:I,isPositionAction:t,appliedPolicies:y,drawDefinition:i,drawPosition:n,structureId:s,stack:l})}function nv({assignedParticipantId:e,isPositionAction:t,appliedPolicies:r,drawDefinition:i,drawPosition:n,structureId:a,stack:o}){return t&&hh({appliedPolicies:r,drawDefinition:i,positionAction:{removedParticipantId:e,drawPosition:n,structureId:a,name:o}}),ac({result:{...Gi},stack:o})}function av({tournamentRecord:e,drawDefinition:t,eventId:r,matchUp:i,event:n}){Object.assign(i,{matchUpStatus:"BYE",score:void 0,winningSide:void 0}),ch({tournamentId:e?.tournamentId,eventId:r??n?.eventId,context:"setMatchUpStatusBye",drawDefinition:t,matchUp:i})}function ov({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:r,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){Zy({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:e});let c=a.drawMatchUps.find(e=>e.matchUpId===o),u=t.find(e=>e.matchUpId===o)?.structureId,{structure:l}=wf({drawDefinition:n,structureId:u}),{positionAssignments:d}=Pf({structure:l}),p=d?.filter(e=>e.bye).map(e=>e.drawPosition),m=c?.drawPositions?.find(t=>t!==e),f=m&&p?.includes(m),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:g,winnerMatchUp:I,loserTargetDrawPosition:y}}=Ey({inContextDrawMatchUps:t,drawDefinition:n,matchUpId:o});if(I&&I.structureId===l?.structureId&&function({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:r,tournamentRecord:i,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){let c="advanceWinner",u=o.drawMatchUps.find(e=>e.matchUpId===a.matchUpId),l=t.find(e=>e.matchUpId===a.matchUpId)?.structureId,{structure:d}=wf({drawDefinition:n,structureId:l}),{positionAssignments:p}=Pf({structure:d}),m=p?.find(({drawPosition:t})=>t===e)?.bye,f=u.drawPositions?.filter(Boolean),h=p?.filter(e=>f?.includes(e.drawPosition)),g=p?.find(({drawPosition:t})=>t===e),I=r?.find(t=>t!==e),y=(I&&h?.find(({drawPosition:e})=>e===I))?.bye,v=m&&y;if(v&&console.log({isByeAdvancedBye:v}),f?.length>1&&m&&!y)return ac({result:{error:un},stack:c});let S=f?.find(t=>t!==e),b=v,U=[...(u.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),w=U.map(t=>!t&&!b||t===e?(b=!0,e):t).sort(Qr);if(!b)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:e,existingAssignments:h}),ac({result:{error:un},stack:c});let T=p?.find(({drawPosition:e})=>e===S)?.bye,D=p?.find(({drawPosition:t})=>t===e)?.bye;Object.assign(u,{matchUpStatus:D||T?"BYE":lf,score:void 0,winningSide:void 0,drawPositions:w});let P=u.drawPositions.find(e=>!U.includes(e));Zy({method:c,color:"brightyellow",changedDrawPosition:P,pairedDrawPositionIsBye:T,drawPositionIsBye:D}),ch({tournamentId:i?.tournamentId,matchUp:u,eventId:s?.eventId,context:c,drawDefinition:n});let{targetLinks:{loserTargetLink:N},targetMatchUps:{loserMatchUp:E,loserTargetDrawPosition:M}}=Ey({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:n});if(T||D){let r=T?e:S;if(r)ov({drawPositionToAdvance:r,matchUpId:a.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o});else if(D&&N&&E)if(E.feedRound)sv({loserTargetDrawPosition:M,tournamentRecord:i,loserTargetLink:N,drawDefinition:n,loserMatchUp:E,matchUpsMap:o});else{let e=1-a.roundPosition%2,t=E.drawPositions[e],r=iv({structureId:N.target.structureId,drawPosition:t,tournamentRecord:i,drawDefinition:n,event:s});if(r.error);}}}({drawPositionToAdvance:e,inContextDrawMatchUps:t,sourceDrawPositions:r,tournamentRecord:i,drawDefinition:n,winnerMatchUp:I,matchUpsMap:a,event:s}),g&&f&&g.structureId!==l?.structureId){let{roundNumber:e}=g;if(1===e){let e=iv({structureId:h.target.structureId,drawPosition:y,tournamentRecord:i,drawDefinition:n,event:s});if(e.error)return e}else sv({loserTargetDrawPosition:y,tournamentRecord:i,loserTargetLink:h,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:s})}return{...Gi}}function sv({loserTargetDrawPosition:e,tournamentRecord:t,loserTargetLink:r,drawDefinition:i,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Zy({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:e});let c=(a?.mappedMatchUps||{})[n.structureId].matchUps,{initialRoundNumber:u}=Xy({drawPosition:e,matchUps:c});if(u===s){let n=iv({structureId:r.target.structureId,drawPosition:e,tournamentRecord:t,drawDefinition:i,event:o});if(n.error)return n}}function cv({positionAssignments:e,tournamentRecord:t,drawDefinition:r,matchUpsMap:i,structure:n,event:a}){let{matchUps:o}=Uy({drawDefinition:r,matchUpsMap:i,structure:n,event:a});o.forEach(i=>{let n=e.filter(({drawPosition:e})=>i.drawPositions?.includes(e)).filter(e=>e.bye).length;i.winningSide||(Object.assign(i,{matchUpStatus:n?"BYE":lf}),ch({tournamentId:t?.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a?.eventId,drawDefinition:r,matchUp:i}))})}function uv(e){let{inContextDrawMatchUps:t,participantId:r,drawPosition:i}=e,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:c}=e,{structure:u}=wf({drawDefinition:a,structureId:o}),l=(Nf({drawDefinition:a,structure:u}).positionAssignments||[]).find(e=>r&&e.participantId===r||i&&e.drawPosition===i);if(l&&r&&!i&&(i=l?.drawPosition),!i)return{error:yn};r||(r=l?.participantId);let{activeDrawPositions:d}=Ky({drawDefinition:a,structureId:o});return d.includes(i)?{error:hn}:(t||({matchUps:t}=Cy({inContext:!0,drawDefinition:a,matchUpsMap:s})),lv({inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:i,matchUpsMap:s,event:c}).drawPositionCleared?(ph({tournamentId:n?.tournamentId,drawDefinition:a,structure:u,event:c}),{...Gi,participantId:r}):{error:pn})}function lv({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,matchUpsMap:n,structureId:a,event:o}){let{structure:s}=wf({drawDefinition:r,structureId:a});if(!s)return{error:Fn};let c=Nf({drawDefinition:r,structure:s}).positionAssignments||[],u=c.some(e=>{if(e.drawPosition===i)return delete e.participantId,delete e.qualifier,delete e.bye,!0});if(s.structureType===Wl)return cv({positionAssignments:c,tournamentRecord:t,drawDefinition:r,matchUpsMap:n,structure:s}),{drawPositionCleared:u,...Gi};let{matchUps:l}=Uy({drawDefinition:r,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:s,event:o}),{roundProfile:d,roundMatchUps:p}=Lg({matchUps:l}),m=(d&&Object.keys(d))?.map(e=>Jr(e)),f=i,h=m?.map(e=>{let t=d?.[e]?.pairedDrawPositions?.find(e=>e.includes(f)),r=t?.find(e=>e!==f),i=c.find(e=>e.drawPosition===r),n=d?.[e+1],a=i?.bye,o=n?.pairedDrawPositions?.find(e=>e.includes(r)),s=a&&o&&n&&n.drawPositions?.includes(r),u=t&&{pairedDrawPositionByeAdvancedPair:!s&&o,pairedDrawPosition:r,targetDrawPosition:f,relevantPair:t,roundNumber:e};return s&&(f=r),u}).filter(e=>e?.targetDrawPosition)?.reduce((e,t)=>{let{roundNumber:r,relevantPair:i,targetDrawPosition:n,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=t,s=[{roundNumber:r,targetDrawPosition:n,relevantPair:i},o&&{roundNumber:r+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat(...s)},[]);return h?.forEach(({roundNumber:u,targetDrawPosition:l,relevantPair:d})=>{let m=p?.[u].find(e=>xi(e.drawPositions?.filter(Boolean),d.filter(Boolean)));m&&(function({inContextDrawMatchUps:e,targetDrawPosition:t,tournamentRecord:r,drawDefinition:i,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=wf({drawDefinition:i,structureId:o});if(!s)return{error:Fn};if(s.structureType===Wl)return;n=n||kg({drawDefinition:i});let c=(n?.mappedMatchUps||{})[o].matchUps,{initialRoundNumber:u}=Xy({drawPosition:t,matchUps:c}),l=c?.filter(e=>e.roundNumber>=a&&e.roundNumber!==u&&e.drawPositions?.includes(t)),d=Pf({drawDefinition:i,structureId:o}).positionAssignments??[];l?.forEach(a=>dv({drawPosition:t,targetMatchUp:a,inContextDrawMatchUps:e,positionAssignments:d,tournamentRecord:r,drawDefinition:i,matchUpsMap:n,structure:s}))}({inContextDrawMatchUps:e,targetDrawPosition:l,tournamentRecord:t,drawDefinition:r,structureId:a,roundNumber:u,matchUpsMap:n}),dv({inContextDrawMatchUps:e,positionAssignments:c,tournamentRecord:t,drawDefinition:r,targetMatchUp:m,drawPosition:i,matchUpsMap:n,structure:s,event:o}))}),{tasks:h,drawPositionCleared:u,positionAssignments:c}}function dv({inContextDrawMatchUps:e,positionAssignments:t,tournamentRecord:r,drawDefinition:i,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:c}){let u="removeDrawPosition",l=n.drawPositions?.slice(),d=n.matchUpStatus,p=n.winningSide,m=(o=o??kg({drawDefinition:i})).mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:f}=Xy({drawPosition:a,matchUps:m});if(n.roundNumber&&f&&n.roundNumber>f){let e=(n.drawPositions??[]).map(e=>e===a?void 0:e);n.drawPositions=e}if(n.matchUpType===Yr){let t=(e?.find(e=>e.matchUpId===n.matchUpId)?.sides??[]).reduce((e,t,r)=>t.drawPosition===a?r:e,void 0);void 0!==t&&n.sides?.[t]?.lineUp&&(delete n.sides?.[t].lineUp,ch({tournamentId:r?.tournamentId,context:`${u}-TEAM`,eventId:c?.eventId,matchUp:n,drawDefinition:i}))}let h=Ey({matchUpId:n.matchUpId,inContextDrawMatchUps:e,drawDefinition:i}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:I,winnerMatchUp:y,loserMatchUpDrawPositionIndex:v}}=h,S=t.filter(({drawPosition:e})=>n.drawPositions?.includes(e)).filter(e=>e.bye).length,b=(S?"BYE":n.matchUpStatus&&rv(n.matchUpStatus)&&n.matcHUpStatus)||lf;n.matchUpStatus=b,n.matchUpStatus&&rv(n.matchUpStatus)&&(n.winningSide=void 0);let U=l?.find(e=>!n.drawPositions?.includes(e));if(l?.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(U&&Zy({method:u,color:"brightyellow",removedDrawPosition:U}),ch({tournamentId:r?.tournamentId,context:`${u}-${a}`,eventId:c?.eventId,matchUp:n,drawDefinition:i})),I&&I.structureId!==h.matchUp.structureId&&!S){let{drawPositions:t,roundNumber:n}=I;if(1===n){let n=t[v];lv({structureId:I.structureId,drawPosition:n,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:i,matchUpsMap:o})}else{let n=Math.min(...t.filter(Boolean)),a=function({loserMatchUpDrawPosition:e,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,loserMatchUp:n,matchUpsMap:a,event:o}){let{structure:s}=wf({structureId:n.structureId,drawDefinition:i}),{positionAssignments:c}=Pf({structure:s});if(c?.find(t=>t.drawPosition===e)?.bye){let s=uv({drawPosition:e,structureId:n.structureId,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,matchUpsMap:a,event:o});if(s.error)return s}return{...Gi}}({loserMatchUpDrawPosition:n,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:i,loserMatchUp:I,matchUpsMap:o,event:c});if(a.error)return ac({result:a,stack:u});let s=(o?.mappedMatchUps||{})[I.structureId].matchUps,{initialRoundNumber:l}=Xy({drawPosition:n,matchUps:s});1===l&&(Zy({method:u,color:"brightyellow",loserMatchUpDrawPosition:n}),lv({structureId:I.structureId,drawPosition:n,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:i,matchUpsMap:o}))}}return y&&y.structureId!==h.matchUp.structureId&&g.target.feedProfile,{...Gi}}function pv({drawDefinition:e,stages:t}){if(!e)return{error:rn};let r=vi((e?.structures??[]).filter(e=>!t?.length||e.stage&&t.includes(e.stage)).map(e=>{let{positionAssignments:t}=Pf({structure:e});return t?t.map(Hm):[]}).flat().filter(Boolean));return{...Gi,assignedParticipantIds:r}}function mv(e){let t=(e?.entries??[]).filter(Boolean).reduce((e,t)=>{let{entryStage:r,entryStatus:i}=t,n=`_${r||El}${i||""}`;return e[n]||(e[n]=[]),e[n].push(t),e},{}),r=e=>isNaN(e)?1/0:e;return Object.keys(t).map(e=>t[e].sort((e,t)=>r(e.entryPosition)-r(t.entryPosition)).map((e,t)=>({...e,entryPosition:t+1}))).flat()}function fv(e){return[Ig,gg].includes(e)}function hv({autoEntryPositions:e=!0,ignoreAssignment:t,tournamentRecord:r,drawDefinition:i,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:c,drawId:u,stage:l,event:d}){if(!n||!Array.isArray(n))return{error:Ha,method:"modifyEntriesStatus",participantIds:n};if(!i&&!d)return{error:jn};if(a&&!Tg.includes(a))return{error:po};if(o&&!kl.includes(o))return{error:Kn};let p="modifyEntriesStatus",m=[];if(!a&&!s)return ac({result:{error:Da},info:"Missing entryStatus",stack:p});if(s&&!Zp({extension:s,requiredAttributes:["name"]}))return ac({result:{error:Zo},info:"Invalid extension",context:{extension:s},stack:p});let f=[];d?.drawDefinitions?.forEach(e=>{let t=pv({stages:l&&[l],drawDefinition:e}).assignedParticipantIds??[];f.push(...t)});let h=r?.participants??[];if(!n.every(e=>{let t=Qp({tournamentParticipants:h,participantId:e})?.participantType;return!(t&&[Dh,Uh].includes(t)&&fv(a)||a&&d?.eventType&&t===wh&&[wl,Pl].includes(d.eventType)&&[sg,...Sg].includes(a))}))return{error:po};let g=d&&py({event:d}).flightProfile,I=g?.flights?.find(e=>e.drawId===u),y=e=>{let r=(e||[]).filter(e=>!l||!e.entryStage||l===e.entryStage).filter(({participantId:e})=>n.includes(e));return r.every(e=>!((e=>a&&f.includes(e.participantId)&&!(Sg.includes(e.entryStatus)&&Sg.includes(a)))(e)&&!t)&&(a&&(e.entryStatus=a,delete e.entryPosition),o&&(e.entryStage=o,delete e.entryPosition),s&&(s.value?em({element:e,extension:s}):Jp({element:e,name:s.name})),!0))?{...Gi}:{error:co}},v=({flight:e,drawDefinition:t})=>{d&&(d.entries=mv({entries:d.entries??[]})),e&&(e.drawEntries=mv({entries:e.drawEntries})),t&&(t.entries=mv({entries:t.entries}))},S=e=>{let{flight:t,drawDefinition:r}=e,i="updateDrawEntries";if(t){let e=y(t.drawEntries);if(e.error)return ac({result:e,stack:i})}if(r){let e=y(r.entries);if(e.error)return ac({result:e,stack:i});m.includes(r.drawId)||m.push(r.drawId)}return{...Gi}},b=d?.entries?.find(({entryPosition:e})=>e)??(I?.drawEntries?.find(({entryPosition:e})=>e)||i?.entries?.find(({entryPosition:e})=>e));if(e&&!b&&v({flight:I,drawDefinition:i}),I||i){let e=S({flight:I,drawDefinition:i});if(e.error)return ac({result:e,stack:p})}let U=d?.drawDefinitions?.map(({drawId:e})=>e)??[],w=g?.flights?.filter(e=>!U.includes(e.drawId))||[];for(let D of w){let e=D&&S({flight:D});if(e?.error)return ac({result:e,stack:p})}let T=1===g?.flights?.length&&(d?.drawDefinitions?.length??0)<=g?.flights?.length;if(!I&&!i&&a&&bg.includes(a))return{error:Io};if(!I&&!i||a===vg||c&&T){let e,t=y(d?.entries);if(t?.error)return ac({result:t,stack:p});if(a===vg&&(g?.flights?.every(t=>{let r=y(t.drawEntries);return r.error?(e=r.error,!1):(t.drawEntries=t.drawEntries.filter(({participantId:e})=>!n.includes(e)),!0)}),d?.drawDefinitions?.every(t=>{let r=y(t.entries);return r.error?(e=r.error,!1):(t.entries=t.entries?.filter(({participantId:e})=>!n.includes(e)),!0)})),e)return ac({result:{error:e},stack:p})}e&&v({flight:I,drawDefinition:i});for(let D of d?.drawDefinitions??[])m.length&&!m.includes(D.drawId)||lh({tournamentId:r.tournamentId,eventId:d?.eventId,drawDefinition:D});return{...Gi}}function gv({value:e,sourceRange:t,targetRange:r}){if(!Array.isArray(t)||2!==t.length)return 0;let i=Math.min(...t),n=Math.max(...t),a=Math.min(...r);return(e-i)*(Math.max(...r)-a)/(n-i)+a}var Iv="NTRP",yv="DUPR",vv="UTR_P",Sv="UTPR",bv="SQUASH_LEVELS",Uv="US_SQUASH",wv="USATT",Tv="ITTF",Dv="USAR",Pv={ELO:"ELO",NTRP:Iv,TRN:"TRN",UTR:"UTR",WTN:"WTN",DUPR:yv,UTR_P:vv,UTPR:Sv,PSA:"PSA",SQUASH_LEVELS:bv,US_SQUASH:Uv,USATT:wv,ITTF:Tv,USAR:Dv,BWF:"BWF"},Nv={ELO:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!1},[Iv]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!1,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!1,range:[1,16]},WTN:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!0,decimalsCount:2,range:[40,1]},[yv]:{defaultInitialization:3.5,accessors:["duprRating","reliabilityScore"],accessor:"duprRating",attributes:{reliabilityScore:{generator:!0,range:[0,100]}},decimalsCount:3,ascending:!1,range:[2,8]},[vv]:{defaultInitialization:5,accessors:["utrpRating","verified"],accessor:"utrpRating",attributes:{verified:{type:"boolean"},provisional:{type:"string"}},decimalsCount:1,ascending:!1,range:[1,10]},[Sv]:{defaultInitialization:3.5,accessor:"utprRating",decimalsCount:1,ascending:!1,range:[2,5],deprecated:!0},PSA:{defaultInitialization:500,accessor:"psaPoints",decimalsCount:0,ascending:!1,range:[0,3e3],attributes:{tournaments:{generator:!0,range:[1,20]},divisor:{generator:!0,range:[10,20]}}},[bv]:{defaultInitialization:2e3,accessor:"squashLevel",decimalsCount:0,ascending:!1,range:[0,7e3]},[Uv]:{defaultInitialization:3.5,accessor:"usSquashRating",decimalsCount:1,ascending:!1,range:[2,6]},[wv]:{defaultInitialization:1e3,accessor:"usattRating",decimalsCount:0,ascending:!1,range:[200,3e3]},[Tv]:{defaultInitialization:500,accessor:"ittfPoints",decimalsCount:0,ascending:!1,range:[0,2e4]},[Dv]:{defaultInitialization:1e4,accessor:"usarRanking",decimalsCount:0,ascending:!0,range:[1,25e3]},BWF:{defaultInitialization:5e3,accessor:"bwfPoints",decimalsCount:0,ascending:!0,range:[0,15e4],attributes:{tournaments:{generator:!0,range:[1,10]}}}};function Ev(e){let t=Dp(e,[{ratings:!0,[vp]:fp}]);if(t.error)return t;let r=e.matchUpType&&[Wr,Hr].includes(e.matchUpType)?e.matchUpType:Wr,i=Object.keys(Nv),n=e.targetRatingType&&i.includes(e.targetRatingType)?e.targetRatingType:"ELO",a=e.ratings[r]?e.ratings[r].reduce((e,t)=>e.includes(t.scaleName)?e:e.concat(t.scaleName),[]):[];if(!a)return{error:as};let o=e.ratings[r]?.find(e=>e.scaleName===n)??e.ratings[r]?.[0];if(a[0]===n)return o;let s=o?.scaleName,c=Nv[o?.scaleName]?.accessor,u=c&&o.scaleValue[c]||o?.scaleValue,l=function({sourceRatingType:e,sourceRating:t}){let r=Nv[e]?.range,i=r?.[0]>r?.[1],n=Nv.ELO.range;return gv({value:i?r[0]-t:t,sourceRange:r,targetRange:n})}({sourceRatingType:s,sourceRating:u}),d=function({targetRatingType:e,sourceRating:t}){let r=Nv[e]?.decimalsCount||0,i=Nv[e]?.range,n=i?.[0]>i?.[1],a=Math.max(...i),o=Nv.ELO?.range,s=gv({targetRange:i,sourceRange:o,value:t}),c=Number.parseFloat(s?.toFixed(r))||0;return n?a-c:c}({targetRatingType:n,sourceRating:l});return d?{convertedRating:d,sourceRating:u}:{error:Zo}}function Mv({participantResults:e,sides:t,score:r}){let i=t?.find(({sideNumber:e})=>1===e),n=t?.find(({sideNumber:e})=>2===e),a=i?.participant?.ratings,o=n?.participant?.ratings;if(a?.[Wr]&&o?.[Wr]){let t="ELO",{convertedRating:s}=Ev({ratings:a,targetRatingType:t}),{convertedRating:c}=Ev({ratings:o,targetRatingType:t}),{side1pressure:u,side2pressure:l}=function({side1ConvertedRating:e,side2ConvertedRating:t,score:r}){let i=Math.max(e,t),n=Math.min(e,t),a=Math.abs(e-t),o=Nv.ELO.range,s=Math.max(...o),c=0*(s-i),u=(i+c)/s*a,l=r?.sets?.reduce((e,t)=>e+(t?.side1Score??0),0),d=r?.sets?.reduce((e,t)=>e+(t.side2Score??0),0),p=e>t?2:1,m=(l||0)*(n+(1===p?u:0)),f=(d||0)*(n+(2===p?u:0)),h=m+f,g=h?yi(m/h):0,I=h?yi(f/h):0;return{side1pressure:g,side2pressure:I}}({side1ConvertedRating:s,side2ConvertedRating:c,score:r});u&&e[i?.participantId].pressureScores.push(u),l&&e[n?.participantId].pressureScores.push(l);let d=Math.max(...Nv.ELO.range),p=yi((c-s)/d),m=yi((s-c)/d);e[i?.participantId].ratingVariation.push(p),e[n?.participantId].ratingVariation.push(m)}}function Rv({winningSide:e,matchUpFormat:t=Vu,matchUpStatus:r,tallyPolicy:i,score:n}){let a=[0,0],o=n?.sets,s="number"==typeof e&&e-1,c=Mc(t),u=kv(c?.bestOf??1);if("number"==typeof s&&(r===tf&&i?.setsCreditForDefaults||r===df&&i?.setsCreditForWalkovers))a[s]=u;else for(let l of o||[]){let{winningSide:e}=l;e&&(a[e-1]+=1)}return"number"==typeof s&&r===cf&&(+a[1-s]===u&&(a[1-s]-=1),i?.setsCreditForRetirements&&(a[s]=u)),a}function Av({matchUpFormat:e=Vu,winningSide:t,matchUpStatus:r,tallyPolicy:i,score:n}){let{sets:a}=n||{};if(!a)return[0,0];let o="number"==typeof t&&t-1,s=Mc(e),c=kv(s?.bestOf??1),u=s?.setFormat?.tiebreakAt||0,l=[[],[]];if("number"==typeof o&&(r===tf&&i?.gamesCreditForDefaults||r===df&&i?.gamesCreditForWalkovers)){let e=c*(s?.setFormat?.setTo||0);l[o].push(e)}else a.forEach((e,t)=>{let r=(e.setNumber||t+1)>c&&s?.finalSetFormat?"finalSetFormat":"setFormat",n=s?.[r]?.based,a=s?.[r].tiebreakSet,{side1Score:o,side2Score:u}=e;Ov(n)&&!a&&(l[0].push(Jr(o||0)),l[1].push(Jr(u||0))),a&&e.winningSide&&!1!==i?.gamesCreditForTiebreakSets&&l[e.winningSide-1].push(1)});if(r===cf&&"number"==typeof o){let n=a.length>c&&s?.finalSetFormat?"finalSetFormat":"setFormat",d=s?.[n];if(Ov(d.based)){let n=d?.setTo||0,p=e=>{if(s&&""!==e)return+e===u-1||+e===u?Jr(u||0)+1:+e<u?n:u},m=Rv({winningSide:t,score:{sets:a},matchUpStatus:r,matchUpFormat:e,tallyPolicy:i});if(l.map(e=>e[o]<=e[1-o]).reduce((e,t)=>e+(t?1:0),0)>m[1-o]){let e=l[o].length,t=p(l[1-o][e-1]);t&&(l[o][e-1]=t)}c>l[o].length&&i?.gamesCreditForRetirements&&l[o].push(n)}}return[l[0].reduce((e,t)=>e+t,0),l[1].reduce((e,t)=>e+t,0)]}function Cv({matchUpFormat:e,score:t}){let r=e?Mc(e):void 0,i=kv(r?.bestOf??1),n=[0,0],a=[0,0];return t?.sets?.forEach((e,t)=>{let o=(e.setNumber||t+1)>i&&r?.finalSetFormat?"finalSetFormat":"setFormat",s=r?.[o]?.based;if(xv(s)){let{side1Score:t,side2Score:r}=e;t&&(a[0]+=Jr(t||0)),r&&(a[1]+=Jr(r||0))}else e.side1TiebreakScore&&(a[0]+=Jr(e.side1TiebreakScore||0)),e.side2TiebreakScore&&(a[1]+=Jr(e.side2TiebreakScore||0)),(e.side1TiebreakScore||e.side2TiebreakScore)&&e.winningSide&&(n[e.winningSide-1]+=1)}),{pointsTally:a,tiebreaksTally:n}}function kv(e){return e&&Math.ceil(e/2)||1}function xv(e){return"P"===e}function Ov(e){return!xv(e)}function Fv({participantIds:e,pressureRating:t,groupingTotal:r,matchUpFormat:i,tallyPolicy:n,perPlayer:a,matchUps:o}){let s={},c=n?.excludeMatchUpStatuses||[],u=o?.filter(t=>(t.tieMatchUps||!c.includes(t.matchUpStatus))&&(!e?.length||2===Ci(e,[Bv(t,0),Bv(t,1)]).length)),l=u?.flatMap(({score:e,tieMatchUps:t})=>t?t.filter(({matchUpStatus:e})=>!c.includes(e)).flatMap(({score:e})=>e?.sets?.length??0):e?.sets?.length??0)?.reduce((e,t)=>e+t,0),d=e=>e?.sets?.reduce((e,t)=>e+(t?.side1Score??0)+(t?.side2Score??0),0)??0,p=u?.flatMap(({score:e,tieMatchUps:t})=>t?t.filter(({matchUpStatus:e})=>!c.includes(e)).flatMap(({score:e})=>d(e)):d(e))?.reduce((e,t)=>e+t,0);for(let m of u??[]){let{matchUpStatus:e,tieMatchUps:r,tieFormat:o,score:c,winningSide:u,sides:l}=m,d=o&&m._disableAutoCalc&&o.collectionDefinitions.every(({scoreValue:e})=>e),p=u&&_v(m),f=u&&Lv(m);if(p||f)if($v(s,p),$v(s,f),r?.length){a=0;for(let e of r){let{matchUpType:r}=e,i=MI(Hr)(r),a=MI(Wr)(r);e.winningSide&&(e.winningSide===u?(p&&(s[p].tieMatchUpsWon+=1,a&&(s[p].tieSinglesWon+=1),i&&(s[p].tieDoublesWon+=1)),f&&(s[f].tieMatchUpsLost+=1,a&&(s[f].tieSinglesLost+=1),i&&(s[f].tieDoublesLost+=1))):e.winningSide!==u&&(f&&(s[f].tieMatchUpsWon+=1,a&&(s[f].tieSinglesWon+=1),i&&(s[f].tieDoublesWon+=1)),p&&(s[p].tieMatchUpsLost+=1,a&&(s[p].tieSinglesLost+=1),i&&(s[p].tieDoublesLost+=1)))),jv({matchUpFormat:e.matchUpFormat,matchUpStatus:e.matchUpStatus,matchUpType:e.matchUpType,score:e.score,sides:e.sides,winningParticipantId:p,losingParticipantId:f,manualGamesOverride:d,participantResults:s,isTieMatchUp:!0,pressureRating:t,tallyPolicy:n,winningSide:u})}Gv({winningParticipantId:p,losingParticipantId:f,participantResults:s,matchUpStatus:e})}else jv({matchUpFormat:m.matchUpFormat??i,matchUpType:m.matchUpType,isTieMatchUp:void 0,winningParticipantId:p,manualGamesOverride:d,losingParticipantId:f,participantResults:s,pressureRating:t,matchUpStatus:e,tallyPolicy:n,winningSide:u,score:c,sides:l});else if(e&&If.includes(e)){let e=Bv(m,0),t=Bv(m,1);e&&($v(s,e),s[e].matchUpsCancelled+=1),t&&($v(s,t),s[t].matchUpsCancelled+=1)}else if(r?.length){a=0;for(let e of r){if(e.winningSide){let t=l?.find(({sideNumber:t})=>t===e.winningSide)?.participantId,r=l?.find(({sideNumber:t})=>t===e.winningSide)?.participantId;t&&r&&($v(s,t),$v(s,r),s[t].tieMatchUpsWon+=1,s[r].tieMatchUpsLost+=1,MI(Wr)(e.matchUpType)?(s[t].tieSinglesWon+=1,s[r].tieSinglesLost+=1):MI(Hr)(e.matchUpType)&&(s[t].tieDoublesWon+=1,s[r].tieDoublesLost+=1))}Vv({score:e.score,manualGamesOverride:d,participantResults:s,sides:l})}}else Vv({manualGamesOverride:d,participantResults:s,score:c,sides:l});if(d){let e=c?.sets?.reduce((e,t)=>e+(t?.side1Score??0),0),t=c?.sets?.reduce((e,t)=>e+(t.side2Score??0),0),r=l?.find(({sideNumber:e})=>1===e)?.participantId,i=l?.find(({sideNumber:e})=>2===e)?.participantId;$v(s,r),$v(s,i),r&&(s[r].gamesWon+=e,s[r].gamesLost+=t),i&&(s[i].gamesWon+=t,s[i].gamesLost+=e)}}return function({participantResults:e,groupingTotal:t,matchUpFormat:r,tallyPolicy:i,totalGames:n,perPlayer:a,totalSets:o}){let s=r&&Mc(r)||{},c=s.bestOf,u=c&&Math.ceil(c/2)||1,l=s.setFormat?.setTo,d=Math.pow(10,i?.precision||3);Object.keys(e).forEach(r=>{let s=e[r].setsWon,c=e[r].setsLost,p=i?.groupTotalSetsPlayed||"setsPct"===t?o:a*u||s+c,m=Math.round(s/p*d)/d;(m===1/0||Number.isNaN(m))&&(m=p);let f=e[r].tieMatchUpsWon,h=f+e[r].tieMatchUpsLost,g=Math.round(f/h*d)/d;(g===1/0||Number.isNaN(g))&&(g=f);let I=e[r].matchUpsWon,y=I+e[r].matchUpsLost,v=Math.round(I/y*d)/d;(v===1/0||Number.isNaN(v))&&(v=I);let S=e[r].gamesWon||0,b=e[r].gamesLost||0,U=(a||0)*u*(l||0),w=i?.groupTotalGamesPlayed||"gamesPct"===t?n:Math.max(U,S+b),T=Math.round(S/w*d)/d;(T===1/0||Number.isNaN(T))&&(T=0);let D=e[r].pointsWon+e[r].pointsLost,P=Math.round(e[r].pointsWon/D*d)/d;(P===1/0||Number.isNaN(P))&&(P=0),e[r].setsWon=s,e[r].setsLost=c,e[r].setsPct=m,e[r].tieMatchUpsWon=f,e[r].tieMatchUpsPct=g,e[r].matchUpsPct=v,e[r].gamesWon=S,e[r].gamesLost=b,e[r].gamesPct=T,e[r].pointsPct=P,e[r].result=`${e[r].matchUpsWon}/${e[r].matchUpsLost}`})}({participantResults:s,groupingTotal:r,matchUpFormat:i,tallyPolicy:n,totalGames:p,perPlayer:a,totalSets:l}),{participantResults:s}}function _v(e){return Bv(e,e.winningSide-1)}function Lv(e){return Bv(e,1-(e.winningSide-1))}function Bv(e,t){if(!e?.sides)return console.log("no sides:",{matchUp:e}),"foo";let r=e.sides[t];return r?r.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function $v(e,t){t&&!e[t]&&(e[t]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function Vv({manualGamesOverride:e,participantResults:t,score:r,sides:i}){let{sets:n}=r||{},a=[[],[]],o=[0,0];for(let c of n||[]){let{winningSide:e,side1Score:t,side2Score:r}=c;e&&(o[e-1]+=1),a[0].push(Jr(t||0)),a[1].push(Jr(r||0))}let s=[a[0].reduce((e,t)=>e+t,0),a[1].reduce((e,t)=>e+t,0)];i.forEach((r,i)=>{let{participantId:n}=r;n&&($v(t,n),t[n].setsWon+=o[i],t[n].setsLost+=o[1-i],e||(t[n].gamesWon+=s[i],t[n].gamesLost+=s[1-i]))})}function jv({winningParticipantId:e,manualGamesOverride:t,losingParticipantId:r,participantResults:i,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:c,tallyPolicy:u,winningSide:l,score:d,sides:p}){let m=l&&l-1,f=1-m;n&&c===Wr&&Mv({participantResults:i,sides:p,score:d}),s||Gv({winningParticipantId:e,losingParticipantId:r,participantResults:i,matchUpStatus:o});let h=Rv({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:l,score:d}),g=Av({matchUpStatus:o,matchUpFormat:a,tallyPolicy:u,winningSide:l,score:d}),{pointsTally:I}=Cv({score:d,matchUpFormat:a});e&&(i[e].setsWon+=h[m],i[e].setsLost+=h[f],t||(i[e].gamesWon+=g[m],i[e].gamesLost+=g[f]),i[e].pointsWon+=I[m],i[e].pointsLost+=I[f]),r&&(i[r].setsWon+=h[f],i[r].setsLost+=h[m],t||(i[r].gamesWon+=g[f],i[r].gamesLost+=g[m]),i[r].pointsWon+=I[f],i[r].pointsLost+=I[m])}function Gv({winningParticipantId:e,losingParticipantId:t,participantResults:r,matchUpStatus:i}){t&&(i===df&&(r[t].walkovers+=1),i===tf&&(r[t].defaults+=1),i===cf&&(r[t].retirements+=1),rv(i)&&(r[t].allDefaults+=1),r[t].matchUpsLost+=1),e&&(r[e].matchUpsWon+=1),t&&e&&(r[t].defeats.push(e),r[e].victories.push(t))}function Wv(e,t,r,i){if(e.excludedDirectives?.length){let t=e.excludedDirectives.map(({attribute:e})=>e).join(", "),r=`${t.length} directives were excluded due to participants limit}`;i.push(r);let n=`Excluded: ${t}`;i.push(n)}else{let n=(t,r)=>Number.parseFloat(e.reversed?t:r)-Number.parseFloat(e.reversed?r:t),a=e.groups?Object.values(e.groups).flat(1/0).length:e.participantIds?.length??0,o=e.reversed?" in reverse order":"",s=`Step ${t+1}: ${a} particiants were ${e.groups?"grouped":"separated"}${o} by ${e.attribute}`;if(i.push(s),e.idsFilter){let t=`${e.attribute} was calculated considering ONLY TIED PARTICIPANTS`;i.push(t)}!function(e,t,r,i){e.groups&&Object.keys(e.groups).sort(i).forEach(i=>{let n=e.groups[i].map(e=>t[e]).join(", "),a=`${i} ${e.attribute}: ${n}`;r.push(a)})}(e,r,i,n)}i.push("----------------------")}function qv({participantResults:e,participantIds:t,attribute:r}){return Hv({participantResults:e,participantIds:t}).reduce((e,t)=>{let{participantId:i,results:n}=t,a=n?.[r];return!isNaN(a)&&i&&(e[a]?e[a].push(i):e[a]=[i]),e},{})}function Hv(e){return(e.participantIds||Object.keys(e.participantResults)).reduce((t,r,i)=>(t.push({participantId:r,i:i,results:e.participantResults[r]}),t),[])}var zv=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],Yv={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function Kv(e){let{requireCompletion:t=!0,participantResults:r,subOrderMap:i,tallyPolicy:n}=e,a=[];if(t&&!function({participantResults:e,participantsCount:t}){let r=Hv({participantResults:e}).filter(e=>t-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled);return t===r.length}(e))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n?.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=qv({participantResults:r,attribute:o});a.push({attribute:o,groups:s});let c,u,l=Object.keys(s).map(e=>Number.parseFloat(e)).sort((e,t)=>t-e).map(e=>s[e]).map(t=>{let r=Xv({participantIds:t,...e});return a.push(...r.report??[]),r.order}).flatMap((e,t)=>e.map(e=>e.resolved?e:{...e,subGroup:[t].concat(...e.subGroup??[])})),d=0,p=1;l.forEach((e,t)=>{t&&(e.resolved||u&&!e.resolved)&&(p+=1),u=e.resolved;let r=Number.parseInt(e.subGroup?.join("")||0);e.resolved?(e.position=t+1,p=e.position):(c&&r>c&&(p+=d,d=0),e.position=p,d+=1),c=r});let m=wi(l.map(({position:e})=>e));return l.forEach(e=>{let{participantId:t,position:a}=e||{},o=r[t];e.GEMscore=function(e){return(Array.isArray(n?.GEMscore)?Object.keys(Yv).filter(e=>n.GEMscore.includes(e)):Object.keys(Yv)).map(t=>(e[t]||0)*Math.pow(10,Yv[t].toFixed(3))).reduce((e,t)=>e+t,0)}(o);let s=m[a];void 0!==e?.position&&(s>1&&(e.ties=s,i&&(e.subOrder=i[t])),e.rankOrder=a,e.groupOrder=a+(e.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)}}function Xv({participantResults:e,disableHeadToHead:t,participantIds:r,matchUpFormat:i,tallyPolicy:n,matchUps:a}){let o,s=[],c=[];if(1===r?.length)return{order:[{resolved:!0,participantId:r[0]}]};if(2===r?.length&&(!n?.headToHead||!n.headToHead.disabled&&!t)){let t=function({participantIds:e,participantResults:t}){if(e){if(t[e[0]].victories.includes(e[1]))return e.map(e=>({resolved:!0,participantId:e}));if(t[e[1]].victories.includes(e[0]))return e.reverse().map(e=>({resolved:!0,participantId:e}))}}({participantIds:r,participantResults:e});if(t){let e=t[0].participantId;return c.push({attribute:"head2Head",participantIds:r,headToHeadWinner:e}),{order:t,headToHeadWinner:e,report:c}}}let u=(n?.tallyDirectives||zv).filter(e=>{let t=!(pi(e.maxParticipants)&&r?.length>e.maxParticipants);return t||s.push(e),t});return s.length&&c.push({excludedDirectives:s,participantIds:r}),u.every(({attribute:e,reversed:t,idsFilter:s,groupTotals:u,disableHeadToHead:l})=>(o=function({disableHeadToHead:e,participantIds:t,matchUpFormat:r,groupTotals:i,tallyPolicy:n,attribute:a,idsFilter:o,matchUps:s,reversed:c}){let u,{participantResults:l}=Fv({participantIds:o&&t,groupingTotal:i&&a,matchUpFormat:r,tallyPolicy:n,matchUps:s}),d=qv({participantResults:l,participantIds:t,attribute:a}),p=[{attribute:a,reversed:c,groups:d,idsFilter:o,groupTotals:i}];return Object.keys(d).length>1&&t.length&&(u=Object.keys(d).map(e=>Number.parseFloat(e)).sort((e,t)=>c?e-t:t-e).map(e=>d[e]).map(t=>{let i=Xv({participantResults:l,disableHeadToHead:e,participantIds:t,matchUpFormat:r,tallyPolicy:n,matchUps:s});return p.push(...i.report??[]),i.order}).flatMap((e,t)=>e.map(e=>e.resolved?e:{...e,subGroup:[t].concat(...e.subGroup??[])}))),{order:u,report:p}}({disableHeadToHead:l,participantIds:r,matchUpFormat:i,groupTotals:u,tallyPolicy:n,attribute:e,idsFilter:s,matchUps:a,reversed:t}),c.push(o.report),!o.order)),o.order?{order:o.order,report:c}:{order:r?.map(e=>({participantId:e})),report:c}}function Qv({policyDefinitions:e,generateReport:t,pressureRating:r,matchUpFormat:i,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!n?.length||!_g(n))return{error:pa};let s=vi(n.map(({structureId:e})=>e));if(1!==s.length)return ac({result:{error:Zo,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let c=n.filter(e=>e&&"BYE"!==e.matchUpStatus),u=c.length&&vi(c.flatMap(({drawPositions:e})=>e)).length,l=c.filter(e=>wy({matchUp:e})).length===c.length;l||(o=0);let d,p,m=n.every(({matchUpType:e,tieMatchUps:t})=>e===Yr&&t?.every(e=>wy({matchUp:e}))),f=e?.[_p],h=n.filter(e=>wy({matchUp:e})??e.matchUpType===Yr),{participantResults:g}=Fv({matchUps:h,pressureRating:r,matchUpFormat:i,tallyPolicy:f,perPlayer:o}),{groupOrder:I,report:y}=Kv({matchUps:h,participantResults:g,participantsCount:u,matchUpFormat:i,subOrderMap:a,tallyPolicy:f});if(r&&function({participantResults:e}){let t=e=>e.reduce((e,t)=>e+parseFloat(t),0),r=e=>parseFloat((t(e)/e.length).toFixed(2)),i=Object.keys(e).map(t=>{let i=e[t],{pressureScores:n}=i;return{participantId:t,averagePressure:n?.length?r(n):0}}).sort((e,t)=>(t.averagePressure||0)-(e.averagePressure||0)).map((e,t)=>({...e,order:t+1}));for(let n of i)e[n.participantId].pressureOrder=n.order}({participantResults:g}),l&&I)d=y,p=I,I.forEach(e=>{let{participantId:t,groupOrder:r,rankOrder:i,subOrder:n,ties:a,GEMscore:o}=e,s=g[t];Object.assign(s,{groupOrder:r,rankOrder:i,GEMscore:o,subOrder:n,ties:a})});else{let{groupOrder:e,report:t}=Kv({requireCompletion:!1,participantResults:g,participantsCount:u,matchUpFormat:i,tallyPolicy:f,subOrderMap:a,matchUps:n});d=t,p=e,e&&e.forEach(e=>{let{participantId:t,groupOrder:r,GEMscore:i}=e,n=g[t];Object.assign(n,{provisionalOrder:r,GEMscore:i})})}let v={completedTieMatchUps:m,readableReport:"",participantResults:g,bracketComplete:l,order:[],report:d};if((l||m)&&(v.order=p),t||Ps({tally:!0})){let e=function({matchUps:e,order:t,report:r}){let i={};e.forEach(({sides:e})=>{e.forEach(e=>{e.participantId&&e.participant&&(i[e.participantId]=e.participant.participantName)})});let n=[];return Array.isArray(r)&&r.forEach((e,t)=>{Wv(e,t,i,n)}),n.push("Final Order:"),t.forEach(e=>{let{participantId:t,resolved:r}=e,a=e.groupOrder||e.provisionalOrder;n.push(`${a}: ${i[t]} => resolved: ${!!r}`)}),n.join("\r\n")}({matchUps:n,report:d,order:p});Ps({tally:!0})&&console.log(e),v.readableReport=e}return v}function Jv({requireTimeStamp:e,scaleAttributes:t,participant:r}){if(!r)return{error:Qa};if(!ti(t))return{error:Zo};if(r.timeItems??=[],Array.isArray(r.timeItems)){let{accessor:i,scaleType:n,eventType:a,scaleName:o}=t,s=[Rp,n,a,o].join("."),c=r.timeItems.filter(e=>e?.itemType===s).filter(t=>!e||t?.itemDate).sort((e,t)=>(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0)).pop();if(c){let[e,t,r,n]=c.itemType?.split(".")??[];if(e!==Rp)return{error:Go};let a=i&&By({element:c.itemValue,accessor:i}),o=a?.value||c.itemValue,s={rawValue:a&&c.itemValue,eventType:r,scaleDate:c.itemDate,scaleValue:o,scaleName:n,scaleType:t};return{...Gi,scaleItem:s}}}return{...Gi,scaleItem:void 0}}function Zv({publishedSeeding:e,usePublishState:t,withSeeding:r,participant:i,event:n}){let a={},o=e=>[Rp,Ap,n.eventType,e].join("."),s=Object.assign({},...(i.timeItems||[]).filter(({itemType:e})=>e.split(".")[1]===Ap).map(({itemType:e,itemValue:t})=>({[e]:t}))),c=(e?.stageSeedingScaleNames&&Object.values(e?.stageSeedingScaleNames)||Array.isArray(e?.seedingScaleNames)&&e.seedingScaleNames||[]).map(o),u=Ci(Object.keys(s),c);if(t&&(Object.keys(s).length||e?.drawIds?.length)&&!u.length||!u.length)if(t||"object"!=typeof r){let r,{categoryName:o,ageCategoryCode:s}=n.category||{},c=[s,n.eventId,o].filter(Boolean);for(let e of c){let t=Jv({scaleAttributes:{eventType:n.eventType,scaleType:Ap,scaleName:e},participant:i});if(t.scaleItem){r=t.scaleItem;break}}if(r&&(!t||e?.published&&!e?.published?.drawIds?.length)){let e=r.scaleValue;a.seedValue=e}}else{let e=Object.keys(r).map(e=>{let t=o(r[e]);return[e,s[t]]}).filter(e=>e[1]).map(e=>({[e[0]]:{seedValue:e[1]}})),t=Object.assign({},...e);a.seedAssignments=t}else if(e?.stageSeedingScaleNames){let t=Object.keys(e.stageSeedingScaleNames).map(t=>{let r=o(e.stageSeedingScaleNames[t]);return[t,s[r]]}).filter(e=>e[1]).map(e=>({[e[0]]:{seedValue:e[1]}})),r=Object.assign({},...t);a.seedAssignments=r}else if(u){let e=u.map(e=>s[e]);a.seedValue=e.pop()}return a}function eS({positionAssignments:e}){let t=(e||[]).filter(Vy(_d)).map(e=>{let{extension:t}=lm({element:e,name:Am}),r=Jr(t?.value),i=!isNaN(r)&&r;return i&&{participantId:e.participantId,subOrder:i}}).filter(Boolean),r=wi(t.map(({subOrder:e})=>e));return{subOrderMap:Object.assign({},...t.filter(({subOrder:e})=>1===r[e]).map(({participantId:e,subOrder:t})=>({[e]:t})))}}function tS({convertExtensions:e,seedAssignments:t,participant:r,withSeeding:i,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:c,entryStage:u,entryPosition:l,extensions:d}=s,p=d?.length&&e?Object.assign({},...Eu(d??[])):{},m=Object.assign(p,{entryPosition:l,entryStatus:c,entryStage:u,ranking:o,eventId:a});r.events[a]=nc(m,!1,!1,!0),i&&(t&&(r.events[a].seedAssignments=t),n&&(r.events[a].seedValue=n))}function rS(e){let t=Dp(e,[{[Cd]:!0}]);if(t.error)return t;let{tournamentRecord:r,status:i=DI}=e,n=`${TI}.${PI}`;return Nu(Lh({tournamentRecord:r,itemType:n})?.timeItem?.itemValue?.[i],!1,!0)}function iS({event:e,status:t=DI}){let r=`${TI}.${PI}`;return _h({itemType:r,event:e})?.timeItem?.itemValue?.[t]}function nS({drawDetails:e,drawId:t}){return e?.[t]?.publishingDetail?.published}function aS(e){let{tournamentRecord:t,drawDefinition:r,eventIds:i,eventId:n,drawIds:a,drawId:o,event:s}=e??{};if(t&&!function(e){let{tournamentId:t}=e??{};return!!t}(t))return{error:Zo};if(n&&!s)return{error:Gn};if(Array.isArray(i)&&i?.length){let e={};for(let r of i){if(!ei(r))return{error:Zo};let i=my({tournamentRecord:t,eventId:r})?.event;if(!i)return{error:Gn};let n=oS({event:i});e[r]=n}return{...Gi,publishState:e}}if(s){let e=oS({event:s}),t={};if(o)return r?{publishState:{status:{published:!!e.status.publishedDrawIds?.includes(o),drawDetail:e.status.drawDetails?.[o]},...Gi}}:{error:an};if(Array.isArray(a)&&a?.length){let r=s.drawDefinitions?.map(Ym)??[];for(let i of a){if(!ei(i))return{error:Zo};if(!r.includes(i))return{error:an};t[i]={status:{published:!!e.status.publishedDrawIds.includes(i),drawDetail:e.status.drawDetails?.[i]}}}}else t=e;return{...Gi,publishState:t}}let c=[],u=!1,l={};for(let d of t?.events??[]){let e=oS({event:d});l[d.eventId]=e,e.status.published&&(c.push(d.eventId),u=!0);for(let{drawId:t}of d.drawDefinitions??[]){let r=e.status?.publishedDrawIds?.includes(t);r&&(l[t]={status:{published:r}})}}if(t){let e=rS({tournamentRecord:t});l.tournament=e??{},(e?.orderOfPlay?.published||e?.participants?.published)&&(u=!0),l.tournament.status={published:u,publishedEventIds:c}}return{...Gi,publishState:l}}function oS({event:e}){let t=iS({event:e});if(!t)return{status:{published:!1}};let r={published:void 0,seedingScaleNames:[],drawIds:[]};t.seeding&&Object.assign(r,t.seeding);let i=t.drawDetails??{};for(let o of e.drawDefinitions?.map(Ym)||[])i[o]||(i[o]={publishingDetail:{published:!1}});let n=i&&Object.keys(i).length&&Object.keys(i).filter(e=>nS({drawDetails:i,drawId:e})),a=n?.length?n:t.drawIds??[];if(a?.length&&!n?.length)for(let o of a)i[o]={publishingDetail:{published:!0}};return{status:{publishedDrawIds:a,publishedSeeding:r,drawDetails:i,published:a?.length>0}}}function sS(e){let{participantMap:t,participantId:r,matchUpStatus:i,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:c,potential:u,schedule:l,drawId:d,score:p}=e;!l||!Object.keys(l).length||"BYE"===i||t[r].scheduleItems.push({...l,scheduledDate:iu(l?.scheduledDate),scheduledTime:ru(l?.scheduledTime),checkScoreHasValue:qy({score:p}),matchUpStatus:i,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:c,potential:u,drawId:d})}function cS({finishingPositionRange:e={winner:[],loser:[]},participantMap:t,finishingRound:r,participantWon:i,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:c,matchUpId:u,drawId:l,stage:d}){let p=t[a],m=e=>Math.abs(e[0]-e[1]);p.structureParticipation[c]||(p.structureParticipation[c]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:c,drawId:l});let f=p.structureParticipation[c],{winner:h,loser:g}=e,I=i?h:g;i&&(f.winCount+=1,n===df&&(f.walkoverWinCount+=1),n===tf&&(f.defaultWinCount+=1)),I&&(!f.finishingPositionRange||m(I)<m(f.finishingPositionRange))&&(f.finishingPositionRange=I),r&&((!f.finishingRound||r<f.finishingRound)&&(f.finishingMatchUpId=u,f.finishingRound=r,f.roundNumber=s),1===r&&(f.participantWon=i))}function uS(e){let{withScheduleItems:t,scheduleAnalysis:r,withTeamMatchUps:i,participantMap:n,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:c,finishingPositionRange:u,finishingRound:l,matchUpStatus:d,stageSequence:p,roundNumber:m,structureId:f,score:h,stage:g,withRankingProfile:I,tieWinningSide:y,roundPosition:v,matchUpTieId:S,matchUpSides:b,collectionId:U,matchUpType:w,winningSide:T,matchUpId:D,schedule:P,eventId:N,drawId:E,sides:M}=e,R=a&&2===M?.length&&Object.assign({},...M.map(({sideNumber:e},t)=>{let r=M[1-t].participantId;return e&&{[e]:r}}).filter(Boolean));for(let A of M){let{participantId:e,sideNumber:M,bye:C}=A;if(C)continue;let k=T===M,x=e=>{let t=n[e]?.participant,r=t?.participantType,i=[{participantId:e,participantType:r}];if(r!==Uh)for(let a of t?.individualParticipantIds||[]){let e=n[a]?.participant;i.push({participantType:e?.participantType,participantId:a})}return i},O=(e,i)=>{if(o){if(n[e].matchUps[D]={participantWon:k,matchUpType:w,structureId:f,sideNumber:M,matchUpId:D,eventId:N,drawId:E,stage:g},a){let t=x(i);n[e].matchUps[D].opponentParticipantInfo=t}U&&(n[e].matchUps[D].collectionId=U)}a&&i&&(n[e].opponents[i]={participantId:i,matchUpId:D,eventId:N,drawId:E}),I&&cS({finishingPositionRange:u,participantMap:n,participantWon:k,finishingRound:l,matchUpStatus:d,participantId:e,stageSequence:p,roundNumber:m,structureId:f,matchUpId:D,drawId:E,stage:g}),(r||t)&&sS({participantMap:n,participantId:e,matchUpStatus:d,roundPosition:v,matchUpType:w,roundNumber:m,structureId:f,matchUpId:D,schedule:P,drawId:E,score:h})},F=({participant:e,partnerParticipantId:t})=>{let r=(e,t)=>{e&&(e.partnerParticipantIds||(e.partnerParticipantIds=[]),e.partnerParticipantIds.includes(t)||e.partnerParticipantIds.push(t))};c&&r(e?.draws?.[E],t),s&&r(e?.events?.[N],t),o&&r(e?.matchUps?.[D],t)};if(e&&n[e]){let t=R?.[M];O(e,t);let r=n[e]?.participant.participantType===Dh,a=n[e]?.participant.individualParticipantIds||[];if(S){if(i){let t=e=>n[e].matchUps[S]={participantWon:y===M,matchUpId:S,matchUpType:Yr,sideNumber:M};t(e),a.forEach(t)}if(c&&!n[e].draws[E]){let t=b.find(e=>e.sideNumber===M)?.participant?.participantId,r=n[t]?.draws?.[E]?.entryStatus,i=e=>n[e].draws[E]={entryStatus:r,eventId:N,drawId:E};i(e),a.forEach(i)}}if(r&&(a.forEach(e=>n[e]&&O(e,t)),a.forEach((e,t)=>{let r=a[1-t],i=n[e];i&&F({participant:i,partnerParticipantId:r})}),s&&b)){let t=b.find(e=>e.sideNumber===M)?.participant?.participantId;if(t){let r=n[t]?.events[N];r?(n[e].events[N]={...r},a.forEach(e=>n[e].events[N]={...r})):console.log("Missing teamEntry",{eventId:N,teamParticipantId:t})}}if(T){let t=e=>{k?(n[e].counters[w].wins+=1,n[e].counters.wins+=1,d===df&&(n[e].counters[w].walkoverWins+=1,n[e].counters.walkoverWins+=1),d===tf&&(n[e].counters[w].defaultWins+=1,n[e].counters.defaultWins+=1)):(n[e].counters[w].losses+=1,n[e].counters.losses+=1,d===df&&(n[e].counters[w].walkovers+=1,n[e].counters.walkovers+=1),d===tf&&(n[e].counters[w].defaults+=1,n[e].counters.defaults+=1))};t(e),a.forEach(t)}}}}function lS(e,t){return(e||"").localeCompare(t||"")}function dS({participantFilters:e={},tournamentRecord:t,participants:r=[]}){if(!Object.keys(e).length)return r;let{accessorValues:i,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:c,participantTypes:u,participantIds:l,signInStatus:d,enableOrFiltering:p,eventIds:m,genders:f}=e,h=pS(m)&&t?.events?.filter(e=>m?.includes(e.eventId))||t?.events||[],g=n&&function({drawEntryStatuses:e,tournamentEvents:t}){let r=({entryStatus:t})=>!Array.isArray(e)||e.includes(t);return vi(t.reduce((e,t)=>{let{flightProfile:i}=py({event:t}),n=i?.flights?.flatMap(({drawEntries:e})=>Array.isArray(e)?e.filter(r).map(Hm):[])||[],a=t.drawDefinitions?.map(({entries:e})=>e?e.filter(r).map(Hm):[])||[];return e.concat(...n,...a)},[]))}({drawEntryStatuses:n,tournamentEvents:h}),I=o&&function({eventEntryStatuses:e,tournamentEvents:t}){return vi(t.reduce((t,r)=>{let i=(r.entries||[]).filter(({entryStatus:t})=>!Array.isArray(e)||e.includes(t)).map(Hm);return t.concat(...i)},[]))}({eventEntryStatuses:o,tournamentEvents:h}),y=void 0!==a&&[!0,!1].includes(a)&&h.reduce((e,t)=>e.concat(...(t.drawDefinitions||[]).map(e=>Df({drawDefinition:e}).allPositionedParticipantIds).filter(Boolean)),[]),v=e=>i?.reduce((t,r)=>{let{accessor:i,value:n}=r,{values:a}=By({element:e,accessor:i});return t&&a?.includes(n)},!0);if(r=r?.filter(e=>{let t=Oh({element:e,itemType:vh})?.timeItem?.itemValue,{participantRoleResponsibilities:r,participantType:n,participantRole:o,participantId:m,person:h}=e,S=Array.isArray(f)&&f?.length&&h?.sex&&f.includes(h.sex);return p?f&&S||a&&y.includes(m)||!1===a&&!y.includes(m)||g?.includes(m)||I?.includes(m)||l?.includes(m)||d&&t===d||u&&n&&pS(u)&&u.includes(n)||s&&o&&pS(s)&&s.includes(o)||c&&pS(r)&&pS(c)&&c.find(e=>r?.includes(e))||i?.length&&pS(i)&&v(e):(!f||S)&&(void 0===a||a&&y.includes(m)||!1===a&&!y.includes(m))&&(!g||g.includes(m))&&(!I||I.includes(m))&&(!l||l.includes(m))&&(!d||t===d)&&(!u||n&&pS(u)&&u.includes(n))&&(!s||o&&pS(s)&&s.includes(o))&&(!c||pS(r)&&pS(c)&&c.find(e=>r?.includes(e)))&&(!i?.length||pS(i)&&v(e))}),h.length&&m){let e=new Set(h.filter(e=>m.includes(e.eventId)).flatMap(e=>{let r=(e.entries||[]).map(e=>e.participantId);if(MI(bl)(e.eventType))return r;let i=(t?.participants??[]).filter(e=>r.includes(e.participantId)).flatMap(e=>e.individualParticipantIds);return r.concat(...i)}));r=r?.filter(t=>e.has(t.participantId))}return r}function pS(e){return e&&Array.isArray(e)&&e.length}function mS(e){let{withIndividualParticipants:t,participantFilters:r={},withPotentialMatchUps:i,withRankingProfile:n,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:c,scheduleAnalysis:u,withSignInStatus:l,withTeamMatchUps:d,withScaleValues:p,usePublishState:m,withStatistics:f,contextFilters:h,matchUpFilters:g,contextProfile:I,withOpponents:y,withMatchUps:v,internalUse:S,withSeeding:b,withEvents:U,withDraws:w,withISO2:T,withIOC:D}=e;if(!c)return ac({stack:"getParticipants",result:{error:Ji}});(v||n)&&Wy({tournamentRecord:c});let P=jh({convertExtensions:a,tournamentRecord:c,withSignInStatus:l,withScaleValues:p,internalUse:S,withISO2:T,withIOC:D}),{participantMap:N}=P,E=function(e){let{participantFilters:t,convertExtensions:r,policyDefinitions:i,tournamentRecord:n,usePublishState:a,contextFilters:o,matchUpFilters:s,participantMap:c,contextProfile:u,withPotentialMatchUps:l,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:m,withTeamMatchUps:f,withStatistics:h,withOpponents:g,withMatchUps:I,withSeeding:y,withEvents:v,withDraws:S}=e,b=t?.participantIds,U=e=>{let t=[e];return c[e]?.participant.individualParticipantIds?.forEach(e=>t.push(e)),t.some(e=>!b?.length||b.includes(e))?t:[]},w={withMatchUps:I||d,withEvents:v||d,withDraws:S||d,withPotentialMatchUps:l,withRankingProfile:d,withScheduleItems:p,scheduleAnalysis:m,withTeamMatchUps:f,withStatistics:h,participantMap:c,withOpponents:g,withSeeding:y},T=[],D={},P=[],N={},E={},M={},R={},A={},C=({eventType:e,scaleNames:t,participantId:r})=>c[r]?.participant?.rankings?.[e]?.find(e=>t.includes(e.scaleName))?.scaleValue;for(let x of n?.events||[]){if(t?.eventIds&&!t.eventIds.includes(x.eventId))continue;let{drawDefinitions:e=[],extensions:b=[],eventType:T,eventName:k,category:O,entries:F,eventId:_,gender:L}=x,{flightProfile:B}=py({event:x}),$=B?.flights??[],V=aS({event:x}).publishState;V&&(N[_]=V);let j=V?.status?.publishedSeeding;if(v||y||d){let e=r?Object.assign({},...Eu(b??[])):{};E[_]={...e,eventName:k,eventType:T,category:O,eventId:_,gender:L};let t=[O?.categoryName,O?.ageCategoryCode].filter(Boolean);for(let i of F){let{participantId:e}=i;if(!e||!c[e])continue;let n,o,s=C({eventType:T,scaleNames:t,participantId:e});if(y){let t=c[e].participant;({seedAssignments:n,seedValue:o}=Zv({publishedSeeding:j,usePublishState:a,withSeeding:y,participant:t,event:x}))}let u=e=>{if(c[e]?.events?.[_])return;let t=c[e];tS({convertExtensions:r,seedAssignments:n,participant:t,withSeeding:y,seedValue:o,eventId:_,ranking:s,entry:i})};u(e),(c[e].participant.individualParticipantIds||[]).forEach(u)}}let G=N?.[_]?.publishedSeeding;if(S||d||y){let t=e=>e?Object.assign({},...e.map(({participantId:e,seedValue:t,seedNumber:r})=>({[e]:{seedValue:t,seedNumber:r}}))):void 0,r=vi([...e.map(Ym),...$.map(Ym)]);for(let i of r){let r,n,o,s,u=e.find(e=>e.drawId===i),l=[O?.categoryName,O?.ageCategoryCode].filter(Boolean),{structures:p=[],drawOrder:m,drawName:f,drawType:h}=u??{},g=$?.find(e=>e.drawId===i),I=u?.entries||g?.drawEntries,v=g?.flightNumber,b=(u?.structures||[]).sort((e,t)=>bf(e,t)).map(({structureId:e,structures:t})=>[e,...(t||[]).map(({structureId:e})=>e)]).flat(1/0),U=0,w=new Set(p.filter(({stage:e,stageSequence:t})=>e===El&&1===t||e===Ml).flatMap(e=>{let{positionAssignments:t}=Pf({structure:e}),{seedAssignments:i,stageSequence:a,stage:c}=e;return c===El?(U=t?.length??0,o=t,s=i):1===a&&(r=t,n=i),t}).map(({participantId:e})=>e).filter(Boolean)),D=t(s),P=t(n),N=u?I.filter(({participantId:e})=>w.has(e)):I,E=!a||G?.published&&(0===G?.drawIds?.length||G?.drawIds?.includes(i));for(let e of N){if(!c[e.participantId])continue;let{entryStatus:t,entryStage:r,entryPosition:n,participantId:a}=e,o=C({participantId:a,scaleNames:l,eventType:T}),s=e=>{if(!c[e]||c[e].draws?.[i])return;let s=y&&E,u=s?{}:void 0,l=s?D?.[a]?.seedValue||D?.[a]?.seedNumber:void 0,p=l?D?.[a]:void 0,m=s?P?.[a]?.seedValue||P?.[a]?.seedNumber:void 0,f=m?P?.[a]:void 0;u&&l&&(u[El]=p),u&&m&&(u[Ml]=f);let h=l||m;h&&(c[e].participant.seedings[T]||(c[e].participant.seedings[T]=[]),p&&c[e].participant.seedings[T].push({...p,scaleName:i}),f&&c[e].participant.seedings[T].push({...f,scaleName:i}),u&&(c[e].events[_].seedAssignments||(c[e].events[_].seedAssignments={}),Object.keys(u).forEach(t=>c[e].events[_].seedAssignments[t]=u[t]))),(S||d)&&(c[e].draws[i]=nc({seedAssignments:u,entryPosition:n,entryStatus:t,entryStage:r,seedValue:h,eventId:_,ranking:o,drawId:i},!1,!1,!0))};[gg,Ig].includes(t)||(s(a),(c[a].participant.individualParticipantIds||[])?.forEach(s))}let R=(u?.structures??[]).reduce((e,t)=>(e.includes(t.stage)||e.push(t.stage),e),[]),A=(u?.links??[]).length;M[i]={qualifyingPositionAssignments:r,qualifyingSeedAssignments:n,mainPositionAssignments:o,qualifyingSeedingMap:P,mainSeedAssignments:s,orderedStructureIds:b,mainSeedingMap:D,flightNumber:v,linksCount:A,drawOrder:m,drawName:f,drawType:h,drawSize:U,drawId:i,stages:R}}}if(d||m||f||h||g||I||S){let t=!!m||l,r=xy({afterRecoveryTimes:!!m,policyDefinitions:i,tournamentRecord:n,inContext:!0,participantMap:c,contextFilters:o,matchUpFilters:s,contextProfile:u,nextMatchUps:t,event:x})?.matchUps??[];for(let i of r){let{finishingPositionRange:r,potentialParticipants:a,tieMatchUps:o=[],sides:s=[],winningSide:u,matchUpType:l,matchUpId:f,eventId:h,drawId:g,collectionId:I,containerStructureId:y,stageSequence:v,finishingRound:S,matchUpStatus:b,roundPosition:T,roundNumber:P,structureId:N,schedule:E,score:M,stage:C}=i;if(D[f]=i,d&&y&&N&&g&&(R[N]||(R[N]=[]),R[N].push(i),!A[y])){let t=e.find(e=>e.drawId===g);t&&(A[y]={drawDefinition:t,drawId:g})}let k={finishingPositionRange:r,containerStructureId:y,finishingRound:S,stageSequence:v,roundPosition:T,collectionId:I,roundNumber:P,structureId:N,schedule:E,eventId:h,drawId:g,score:M,stage:C};uS({...k,...w,matchUpStatus:b,winningSide:u,matchUpType:l,matchUpId:f,sides:s});for(let e of o){let{winningSide:t,sides:r=[],matchUpId:i,matchUpStatus:n,matchUpType:a}=e;uS({...k,...w,winningSide:t,tieWinningSide:u,matchUpTieId:f,matchUpId:i,sides:r,matchUpSides:s,matchUpStatus:n,matchUpType:a})}Array.isArray(a)&&(t||m||p)&&a.flat().map(Hm).filter(Boolean)?.forEach(e=>{U(e)?.forEach(e=>{c[e]&&(c[e].potentialMatchUps[f]=nc({tournamentId:n?.tournamentId,matchUpId:f,eventId:h,drawId:g}))}),(m||p)&&sS({potential:!0,participantMap:c,participantId:e,matchUpStatus:b,roundPosition:T,structureId:N,matchUpType:l,roundNumber:P,matchUpId:f,schedule:E,drawId:g,score:M})})}P.push(...r)}}let k={};if(d)for(let[x,O]of Object.entries(A)){let{drawDefinition:e,drawId:t}=O,r=e.structures?.find(e=>e.structureType===Wl&&e.stage===El&&1===e.stageSequence);if(!r?.structures)continue;let i=r.structures,n=i.length,a=i.reduce((e,t)=>e+(t.positionAssignments?.length||0),0),o=e.structures?.find(e=>e.stage===Cl);k[t]||(k[t]={});for(let s of i){let r=R[s.structureId];if(!r?.length)continue;let i=s.positionAssignments?.length,{subOrderMap:c}=eS({positionAssignments:s.positionAssignments}),u=Qv({matchUps:r,subOrderMap:c});if(u?.participantResults)for(let[s,l]of Object.entries(u.participantResults)){let r,{groupOrder:c,provisionalOrder:u}=l,d=c||u;if(d){if(a===i&&d)r=[d,d];else if(n>1&&d&&!o)r=[1,n];else if(n>1&&d&&o){let t=e.links?.find(e=>e.source.structureId===x)?.source?.finishingPositions;if(t){let e=t.length*n;r=t.includes(d)?[1,e]:[e+1,a-(i-d)*n]}}r&&(k[t][s]=r)}}}}if(h||d||m){let e=Object.values(c);for(let t of e){let{wins:e,losses:r,[Wr]:{wins:i,losses:n},[Hr]:{wins:a,losses:o}}=t.counters,s=(e,r,i)=>{let n=r+i,a=r,o=n&&a/n;t.statistics[e]={denominator:n,numerator:a,statValue:o,statCode:e}};if(h&&(s(eg,e,r),s(`${eg}.${Wr}`,i,n),s(`${eg}.${Hr}`,a,o)),d){let e=(e=[])=>Math.abs(e[0]-e[1]);for(let r of Object.keys(t.draws)){let{orderedStructureIds:i=[],flightNumber:n}=M[r]||{};if(t.structureParticipation&&i.length){let a,o=0,s=i.map(r=>{let i=t.structureParticipation[r];if(!i)return;a||(a=i?.finishingPositionRange),e(a)>e(i?.finishingPositionRange)&&(a=i?.finishingPositionRange);let s=i.stage!==Ml;return s&&(o+=1),nc({...i,participationOrder:s?o:void 0,flightNumber:n})}).filter(Boolean);if(t.draws[r]){let e=t.participant.participantId,i=k[r]?.[e];i&&(a=i),t.draws[r].finishingPositionRange=a,t.draws[r].structureParticipation=s}}}}if(m){let e=ti(m)?m.scheduledMinutesDifference:0,r=t.scheduleItems||[],i=t.potentialMatchUps||{},n=r.reduce((e,t)=>{let{scheduledDate:r,scheduledTime:i}=t;return e[r]||(e[r]=[]),i&&e[r].push(t),e},{});Object.values(n).forEach(e=>e.sort(su));for(let o of r){let{typeChangeTimeAfterRecovery:r,timeAfterRecovery:a,scheduledDate:s,scheduledTime:c}=o,u=n[s],l=eu(c);for(let n of u){if(n.matchUpId===o.matchUpId||rv(n.matchUpStatus)&&!n.checkScoreHasValue)continue;let s=o.matchUpType!==n.matchUpType&&r||a,c=o.drawId===n.drawId,u=i[o.matchUpId]&&i[n.matchUpId],d=eu(n.scheduledTime),p=Math.abs(d-l),m=d>=l;if((e&&!Number.isNaN(e)?p<=e:m&&eu(n.scheduledTime)<eu(s))&&(!u||!c)&&m){let e=[o.matchUpId,n.matchUpId].sort(lS).join("|");t.scheduleConflicts[e]={priorScheduledMatchUpId:o.matchUpId,matchUpIdWithConflict:n.matchUpId}}}}let a=t.participant.participantId;Object.keys(t.scheduleConflicts).length&&T.push(a),c[a].scheduleConflicts=t.scheduleConflicts}}}return{participantIdsWithConflicts:T,eventsPublishStatuses:N,derivedEventInfo:E,derivedDrawInfo:M,mappedMatchUps:D,participantMap:c,matchUps:P}}({withMatchUps:v??n,withEvents:U??n,withDraws:w??n,withPotentialMatchUps:i,participantFilters:r,withRankingProfile:n,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:c,scheduleAnalysis:u,withTeamMatchUps:d,usePublishState:m,withStatistics:f,contextFilters:h,matchUpFilters:g,participantMap:N,withOpponents:y,contextProfile:I,withSeeding:b}),{participantIdsWithConflicts:M,eventsPublishStatuses:R,derivedEventInfo:A,derivedDrawInfo:C,mappedMatchUps:k}=E,x=E.matchUps;N=E.participantMap;let O=u??i,F=({potentialMatchUps:e,scheduleConflicts:t,scheduleItems:r,participant:i,statistics:a,opponents:o,matchUps:c,events:l,draws:d})=>{let p=Object.values(d),m=Object.values(o);return y&&p?.forEach(e=>{e.opponents=m.filter(t=>t.drawId===e.drawId)}),nc({...i,scheduleConflicts:u?Object.values(t):void 0,draws:w||n?p:void 0,events:U||n?Object.values(l):void 0,matchUps:v||n?Object.values(c):void 0,opponents:y?m:void 0,potentialMatchUps:O?Object.values(e):void 0,statistics:f?Object.values(a):void 0,scheduleItems:s?r:void 0},!1,!1,!0)},_=new Map;for(let j of Object.keys(N))_.set(j,F(N[j]));let L=[..._.values()],B=o?.[jp]?.participant,$=dS({participants:L,participantFilters:r,tournamentRecord:c});if(t){let e=ti(t)?t:void 0;for(let t of $)for(let r of t.individualParticipantIds??[]){t.individualParticipants??=[];let i=_.get(r),n=e?xp({template:e,source:i}):i;t.individualParticipants.push(n)}}let V=B?$.map(e=>xp({source:e,template:B})):$;return{participantMap:!1!==e.returnParticipantMap?N:void 0,mappedMatchUps:!1!==e.returnMatchUps?k:void 0,matchUps:!1!==e.returnMatchUps?x:void 0,missingParticipantIds:P.missingParticipantIds,participantIdsWithConflicts:M,eventsPublishStatuses:R,derivedEventInfo:A,derivedDrawInfo:C,participants:V,...Gi}}function fS(e){let{tournamentRecord:t,scaleAttributes:r,participantId:i}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!i)return{error:Za};let{participant:a,tournamentId:o}=kh({tournamentRecords:n,tournamentRecord:t,participantId:i});return a?{...Jv({participant:a,scaleAttributes:r}),tournamentId:o}:{error:to}}function hS(e,t){let r=new Date(iu(e)),i=new Date(iu(t)),n=i.getFullYear()-r.getFullYear(),a=i.getMonth()-r.getMonth();return(a<0||0===a&&i.getDate()<r.getDate())&&n--,n}function gS(e,t,r){return!(void 0!==t&&e<t||void 0!==r&&e>r)}function IS(e){let t=e.person;return t&&[t.standardGivenName||t.passportGivenName,t.standardFamilyName||t.passportFamilyName].filter(Boolean).join(" ")||"Unknown"}function yS(e,t,r,i,n,a){let o=function(e,t,r,i){if(function(e){return/^C\d{1,2}-\d{1,2}$/.test(e.ageCategoryCode||"")}(t))return{valid:!0};let n=t.ageMin,a=t.ageMax;if(t.ageCategoryCode&&!n&&!a){let e=Iu({consideredDate:r,category:t});e.error||(n=e.ageMin,a=e.ageMax)}if(!n&&!a)return{valid:!0};let o=e.person?.birthDate;if(!o)return{valid:!1,reason:"Missing birthDate",details:{requiredMin:n,requiredMax:a}};let s=hS(o,r),c=hS(o,i),u=gS(s,n,a),l=gS(c,n,a);if(!u)return{valid:!1,reason:`Age ${s} at event start (${r}) outside range [${[void 0===n?null:`min: ${n}`,void 0===a?null:`max: ${a}`].filter(Boolean).join(", ")}]`,details:{birthDate:o,ageAtStart:s,ageAtEnd:c,requiredMin:n,requiredMax:a}};if(!l)return{valid:!1,reason:`Age ${c} at event end (${i}) outside range [${[void 0===n?null:`min: ${n}`,void 0===a?null:`max: ${a}`].filter(Boolean).join(", ")}]`,details:{birthDate:o,ageAtStart:s,ageAtEnd:c,requiredMin:n,requiredMax:a}};return{valid:!0}}(e,t,i,n),s=function(e,t,r,i){if(!t.ratingMin&&!t.ratingMax)return{valid:!0};if(!t.ratingType)return{valid:!0};let n,a={scaleType:"RATING",scaleName:t.ratingType,eventType:r.eventType},{scaleItem:o}=fS({tournamentRecord:i,participantId:e.participantId,scaleAttributes:a});if(!o?.scaleValue)return{valid:!1,reason:`Missing ${t.ratingType} rating`,details:{ratingType:t.ratingType,requiredMin:t.ratingMin,requiredMax:t.ratingMax}};if("object"==typeof o.scaleValue){let e=By({element:o.scaleValue,accessor:o.scaleValue?.accessor});if(void 0===e)return{valid:!1,reason:`Cannot extract rating value from ${t.ratingType} scale item`,details:{ratingType:t.ratingType,requiredMin:t.ratingMin,requiredMax:t.ratingMax}};n=e}else n=o.scaleValue;return void 0!==t.ratingMin&&n<t.ratingMin?{valid:!1,reason:`${t.ratingType} rating ${n} below minimum ${t.ratingMin}`,details:{ratingType:t.ratingType,ratingValue:n,requiredMin:t.ratingMin,requiredMax:t.ratingMax}}:void 0!==t.ratingMax&&n>t.ratingMax?{valid:!1,reason:`${t.ratingType} rating ${n} above maximum ${t.ratingMax}`,details:{ratingType:t.ratingType,ratingValue:n,requiredMin:t.ratingMin,requiredMax:t.ratingMax}}:{valid:!0}}(e,t,r,a);if(!o.valid||!s.valid){let t={participantId:e.participantId,participantName:IS(e),rejectionReasons:[]};return o.valid||t.rejectionReasons.push({type:"age",reason:o.reason,details:o.details||{}}),s.valid||t.rejectionReasons.push({type:"rating",reason:s.reason,details:s.details||{}}),t}return null}function vS({participantId:e,drawDefinition:t,entryStatus:r,entryStage:i}){if(!t)return{error:rn};let n=t.entries?.find(t=>!(t.participantId!==e||r&&r!==t.entryStatus||i&&i!==t.entryStage));return e&&n}function SS(e){let{provisionalPositioning:t,drawDefinition:r,stageSequence:i,structureId:n,stage:a}=e;if(!r)return{error:rn};let{entryProfile:o}=og({drawDefinition:r}),s=a&&i&&o?.[a]?.stageSequence?.[i]?.qualifiersCount||a&&o?.[a]?.qualifiersCount||0,c={};if(!n)return{qualifiersCount:s,roundQualifiersCounts:c};let{structure:u}=wf({drawDefinition:r,structureId:n}),l=r.links?.filter(e=>e?.target?.structureId===u?.structureId),d=0;l?.length&&(d=function({relevantLinks:e,drawDefinition:t,provisionalPositioning:r,roundQualifiersCounts:i}){let n=0;for(let a of e){let e=wf({structureId:a.source.structureId,drawDefinition:t})?.structure;if(e?.stage===Ml){let t,o=a.source.roundNumber,s=a.target.roundNumber;t=e.structureType===Wl?(e.structures?.length??0)*(a.source.finishingPositions?.length??0):Uy({matchUpFilters:{roundNumbers:[o]},structure:e,afterRecoveryTimes:!1,provisionalPositioning:r,inContext:!1}).matchUps?.length||0,i[s]||(i[s]=0),i[s]+=t,n+=t}}return n}({relevantLinks:l,drawDefinition:r,provisionalPositioning:t,roundQualifiersCounts:c}));let p=Object.keys(c);if(p.length<=1){let e=p[0]||1;c[e]=Math.max(c[e]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:c}}function bS({stage:e,drawDefinition:t}){let{entryProfile:r}=og({drawDefinition:t});return r?.[e]?.drawSize||0}function US({stage:e,drawDefinition:t}){return!!(e===Al||Pg({stage:e,drawDefinition:t})&&bS({stage:e,drawDefinition:t}))}function wS({entryStatus:e=ug,drawDefinition:t,stageSequence:r,stage:i}){if(e===sg)return function({stage:e,drawDefinition:t}){let{entryProfile:r}=og({drawDefinition:t});return r[e]?.alternates||0}({stage:i,drawDefinition:t})?{positionsAvailable:1/0,...Gi}:{error:go};let n=function(e){let{provisionalPositioning:t,drawDefinition:r,stageSequence:i,stage:n}=e,a=bS({stage:n,drawDefinition:r}),{qualifiersCount:o}=SS({provisionalPositioning:t,drawDefinition:r,stageSequence:i,stage:n});return a&&a-o}({drawDefinition:t,stageSequence:r,stage:i}),a=function({stage:e,drawDefinition:t}){let{entryProfile:r}=og({drawDefinition:t});return r[e]?.wildcardsCount||0}({drawDefinition:t,stage:i}),o=Ng({entryStatus:yg,drawDefinition:t,stage:i}),s=o+Ng({entryStatus:ug,drawDefinition:t,stage:i}),c=n-s;return i!==Al&&s>=n?{error:yo}:e===yg?o<a?{...Gi}:{error:yo}:{positionsAvailable:c,...Gi}}function TS(e){let t=Dp(e,[{[xd]:!0,[qd]:!0}]);if(t.error)return t;let{suppressDuplicateEntries:r=!0,entryStatus:i=ug,entryStageSequence:n,entryStage:a=El,ignoreStageSpace:o,drawDefinition:s,entryPosition:c,participant:u,roundTarget:l,extensions:d,extension:p,drawType:m,event:f}=e,h="addDrawEntry";if(m!==Zl&&!US({stage:a,drawDefinition:s}))return ac({result:{error:Kn},stack:h});let g=wS({stageSequence:n,stage:a,drawDefinition:s,entryStatus:i});if(!(o||g.success||m&&m===Zl))return{error:g.error};if(p&&!Zp({extension:p}))return ac({result:{error:Zo},info:"Invalid extension",context:{extension:p},stack:h});let I=e.participantId||u?.participantId;if(!I)return ac({result:{error:Za},stack:h});let y=i===pg&&vS({participantId:I,drawDefinition:s,entryStatus:i}),v=a===Al&&vS({participantId:I,drawDefinition:s,entryStage:a}),S=vS({participantId:I,drawDefinition:s}),b=i!==pg&&a!==Al&&S;if(b)return r?(Bs({payload:{drawId:s.drawId,eventId:f?.eventId,error:Yi,participantId:I},topic:Of}),{...Gi}):ac({result:{error:Yi},context:{participantId:I},stack:h});if(y||v)return ac({context:{invalidEntry:b,invalidLuckyLoser:y,invalidVoluntaryConsolation:v},result:{error:uo},stack:h});let U=nc({entryStageSequence:n,participantId:I,entryPosition:c,entryStatus:i,entryStage:a,extensions:d});return p&&em({element:U,extension:p}),l&&em({extension:{name:"roundEntry",value:l},element:U}),s.entries??=[],s.entries.push(U),lh({drawDefinition:s}),{...Gi}}function DS({suppressDuplicateEntries:e=!0,autoEntryPositions:t=!0,entryStageSequence:r,ignoreStageSpace:i,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,entryStage:c,extension:u,drawId:l,event:d}){if(!n?.length)return{error:no};if(!d)return{error:Gn};if(!l)return{error:wn};let p=(d.entries||[]).map(Hm);if(n.filter(e=>!p.includes(e)).length)return{error:qn};if(a){let l=function(e){let t="addDrawEntries",{suppressDuplicateEntries:r=!0,entryStatus:i=ug,autoEntryPositions:n=!0,ignoreStageSpace:a,participantIds:o,drawDefinition:s,stageSequence:c,stage:u=El,roundTarget:l,extension:d,event:p}=e,m=s.drawType===Zl;if(!u)return{error:Yn};if(!s)return{error:rn};if(!Array.isArray(o))return{error:za};if(!m&&!US({stage:u,drawDefinition:s}))return{error:Kn};if(d&&!Zp({extension:d}))return ac({result:{error:Zo},info:"Invalid extension",context:{extension:d},stack:t});let f=wS({drawDefinition:s,stageSequence:c,entryStatus:i,stage:u});if(!a&&!f.success&&!m)return{error:f.error};let h=f.positionsAvailable??0;if(!a&&!m&&u!==Al&&h<o.length)return{error:lo};let g=[],I=s.drawId,y=p?.eventId,v=o.reduce((e,t)=>{let n=i===pg&&vS({participantId:t,drawDefinition:s,entryStatus:i}),a=u===Al&&vS({entryStage:u,drawDefinition:s,participantId:t}),o=vS({participantId:t,drawDefinition:s});return i!==pg&&u!==Al&&o&&(g.push(t),r&&Bs({payload:{error:Yi,participantId:t,eventId:y,drawId:I},topic:Of})),n||a?e.concat(t):e},[]);return g.length&&!r?ac({context:{eventId:y,drawId:I,duplicateEntries:g},result:{error:Yi},stack:t}):(o.filter(e=>e&&!v.includes(e)).forEach(e=>{let t={entryStageSequence:c,entryStage:u,participantId:e,entryStatus:i};d&&em({element:t,extension:d}),l&&em({extension:{name:Nm,value:l},element:t}),s.entries??=[],s.entries.push(t)}),n&&(s.entries=mv({entries:s.entries})),lh({drawDefinition:s}),v?.length||g?.length?{info:"some participantIds could not be added",participantIdsNotAdded:v,duplicateEntries:g,...Gi}:{...Gi})}({stageSequence:r,suppressDuplicateEntries:e,autoEntryPositions:t,stage:c,ignoreStageSpace:i,participantIds:n,drawDefinition:a,entryStatus:o,roundTarget:s,extension:u});if(l.error)return l}let{flightProfile:m}=py({event:d}),f=m?.flights.find(e=>e.drawId===l);return f?.drawEntries&&(n.forEach(e=>{let t=o===pg&&PS({participantId:e,entryStatus:o,flight:f}),r=c===Al&&PS({participantId:e,entryStage:c,flight:f});(o===pg||c===Al||!PS({flight:f,participantId:e}))&&!t&&!r&&f.drawEntries.push({participantId:e,entryStatus:o,entryStage:c})}),t&&(f.drawEntries=mv({entries:f.drawEntries}))),{...Gi}}function PS({participantId:e,entryStatus:t,entryStage:r,flight:i}){let n=i.drawEntries?.find(i=>!(i.participantId!==e||t&&t!==i.entryStatus||r&&r!==i.entryStage));return e&&n}function NS({autoEntryPositions:e=!0,participantIds:t=[],entryStatuses:r,stage:i,event:n}){let a="removeEventEntries";if(!n?.eventId)return{error:jn};if(!Array.isArray(t)||t.some(e=>!ei(e)))return ac({result:{error:Ha},stack:a});let o=(n.drawDefinitions??[]).flatMap(e=>pv({drawDefinition:e}).assignedParticipantIds??[]),s=(r?.length&&n.entries?.filter(e=>e.entryStatus&&r.includes(e.entryStatus))||[]).map(Hm).filter(e=>!o.includes(e)),c=(i&&n.entries?.filter(e=>e.entryStage&&e.entryStage===i)||[]).map(Hm).filter(e=>!o.includes(e));if(t.length?t=t.filter(e=>(!r?.length||s.includes(e))&&(!i||c.includes(e))):s.length&&c.length?t=Ci(s,c):s.length?t=s:c.length&&(t=c),t?.length&&o.some(e=>t.includes(e)))return ac({result:{error:co},stack:a});if(!t?.length)return{...Gi,participantIdsRemoved:[]};let u=[];n.entries=(n.entries??[]).filter(e=>{let r=!t.includes(e?.participantId);return r||u.push(e.participantId),r}),e&&(n.entries=mv({entries:n.entries}));let{flightProfile:l}=py({event:n});return l?.flights?.forEach(e=>{e.drawEntries=(e.drawEntries||[]).filter(e=>!t.includes(e.participantId))}),n.drawDefinitions?.forEach(e=>{e.entries=(e.entries??[]).filter(e=>!t.includes(e.participantId))}),{...Gi,participantIdsRemoved:u}}var ES={[Bp]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},MS=ES;function RS({tournamentRecord:e,participantIds:t,event:r,entryStatus:i,genderEnforced:n,mismatchedGender:a}){function o(e,t,r){return MI(Wr)(t.eventType)&&e.participantType===wh&&!fv(r)}return e?.participants?.filter(e=>!!t.includes(e.participantId)&&(!!(o(e,r,i)&&(!r.gender||!n||mc(r.gender)||fc(r.gender)||hc(r.gender)===hc(e.person?.sex))||function(e,t,r){return t.eventType===Hr&&e.participantType===Dh&&!fv(r)}(e,r,i)||function(e,t,r,i,n){return!(t.eventType!==Hr||e.participantType!==wh||!fv(r)||t.gender&&i&&!mc(t.gender)&&!fc(t.gender)&&hc(t.gender)!==hc(e.person?.sex)&&(n.push({participantId:e.participantId,sex:e.person?.sex}),1))}(e,r,i,n,a))||!(o(e,r,i)&&!function(e,t,r,i){return!(t.gender&&r&&!mc(t.gender)&&!fc(t.gender)&&hc(t.gender)!==hc(e.person?.sex)&&(i.push({participantId:e.participantId,sex:e.person?.sex}),1))}(e,r,n,a))&&function(e,t,r){return t.eventType===Ph&&(e.participantType===Ph||fv(r)&&e.participantType===wh)}(e,r,i))).map(e=>e.participantId)??[]}function AS({enforceCategory:e,event:t,tournamentRecord:r,typedParticipantIds:i,categoryRejections:n}){if(e&&t.category&&r){let e=function(e,t){let r=e.startDate||t?.startDate,i=e.endDate||t?.endDate;return r&&i?qc(r)&&qc(i)?{startDate:r,endDate:i}:{error:Ca}:{error:Oa}}(t,r);if(!("error"in e)){let{startDate:a,endDate:o}=e;return function({typedParticipantIds:e,categoryRejections:t,tournamentRecord:r,startDate:i,endDate:n,event:a}){let o=[];for(let s of e){let e=r.participants?.find(e=>e.participantId===s);if(e)if(a.category){let c=yS(e,a.category,a,i,n,r);c?t.push(c):o.push(s)}else o.push(s)}return o}({typedParticipantIds:i,tournamentRecord:r,event:t,startDate:a,endDate:o,categoryRejections:n})}}return i}function CS(e){let{suppressDuplicateEntries:t=!0,entryStatus:r=ug,autoEntryPositions:i=!0,enforceCategory:n=!1,enforceGender:a=!0,entryStageSequence:o,policyDefinitions:s,entryStage:c=El,tournamentRecord:u,ignoreStageSpace:l,drawDefinition:d,roundTarget:p,extensions:m,extension:f,drawId:h,event:g}=e,I="addEventEntries",y=function(e,t){if(!Array.isArray(e.participantIds))return ac({result:{error:za},stack:t});let r=vi(e.participantIds??[]);return e.event?r?.length?e.event?.eventId?{participantIds:r}:{error:Gn}:ac({result:{error:no},stack:t}):{error:jn}}(e,I);if("error"in y)return y;let v="participantIds"in y?y.participantIds:[],S=function(e,t,r){return e&&(!Array.isArray(e)||!e.every(e=>Zp({extension:e})))||t&&!Zp({extension:t})?ac({context:nc({extension:t,extensions:e}),result:{error:Zo},info:"Invalid extension(s)",stack:r}):null}(m,f,I);if(S)return S;let b,{genderEnforced:U}=function({policyDefinitions:e,tournamentRecord:t,event:r,enforceGender:i}){let n=zh({tournamentRecord:t,event:r}).appliedPolicies??{},a=e?.[Bp]??n?.[Bp]??MS[Bp];return{matchUpActionsPolicy:a,genderEnforced:!1!==(i??a?.participants?.enforceGender)}}({policyDefinitions:s,tournamentRecord:u,event:g,enforceGender:a}),w=[],T=[],D=!!u,P=[],N=RS({tournamentRecord:u,participantIds:v,event:g,entryStatus:r,genderEnforced:U,mismatchedGender:P}),E=[];N=AS({enforceCategory:n,event:g,tournamentRecord:u,typedParticipantIds:N,categoryRejections:E});let M=function({participantIds:e,typedParticipantIds:t,checkTypedParticipants:r}){return e.filter(e=>!r||t.includes(e))}({participantIds:v,typedParticipantIds:N,checkTypedParticipants:D});if(g.entries??=[],function({validParticipantIds:e,existingIds:t,entryStatus:r,entryStage:i,extensions:n,extension:a,roundTarget:o,entryStageSequence:s,addedParticipantIdEntries:c,event:u}){e.forEach(e=>{if(!t.has(e)){let t=nc({participantId:e,entryStatus:r,entryStage:i,extensions:n});a&&em({element:t,extension:a}),o&&em({extension:{name:Nm,value:o},element:t}),s&&(t.entryStageSequence=s),c.push(t.participantId),u.entries?.push(t)}})}({validParticipantIds:M,existingIds:new Set(g.entries.map(e=>e.participantId||e.participant?.participantId)),entryStatus:r,entryStage:c,extensions:m,extension:f,roundTarget:p,entryStageSequence:o,addedParticipantIdEntries:w,event:g}),h&&!fv(c)){let e=DS({participantIds:M,suppressDuplicateEntries:t,autoEntryPositions:i,entryStageSequence:o,ignoreStageSpace:l,drawDefinition:d,entryStatus:r,roundTarget:p,entryStage:c,extension:f,drawId:h,event:g});e.error&&(b=e.error)}if(function({tournamentRecord:e,removedEntries:t,event:r}){if(r.eventType&&[Tl,Pl].includes(r.eventType)){let i=new Set((r.entries||[]).map(e=>e.participantId)),n=(r.entries||[]).filter(e=>fv(e.entryStatus)).map(e=>e.participantId),a=new Set((e?.participants??[]).filter(e=>i.has(e.participantId)&&e.participantType&&[Dh,Ph].includes(e.participantType)).map(e=>e.individualParticipantIds).flat(1/0)),o=n.filter(e=>a.has(e));o.length&&(t.push(...o),NS({participantIds:o,autoEntryPositions:!1,event:r}))}}({event:g,tournamentRecord:u,removedEntries:T}),M.length!==v.length)return ac({context:nc({categoryRejections:E.length?E:void 0,mismatchedGender:P.length?P:void 0,gender:g.gender}),result:{error:za},stack:I});i&&(g.entries=mv({entries:g.entries||[]}));let R=w.length,A=T.length;return ac({result:{...Gi,addedEntriesCount:R,removedEntriesCount:A,...E.length&&{context:nc({categoryRejections:E})}},stack:I,info:b})}var kS="ADMINISTRATION",xS="COMPETITOR",OS="MEDIA",FS="MEDICAL",_S="OFFICIAL",LS="OTHER",BS="SECURITY",$S={ADMINISTRATION:kS,CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR:xS,MEDIA:OS,MEDICAL:FS,OFFICIAL:_S,OTHER:LS,SECURITY:BS};function VS({addIndividualParticipantsToEvents:e,individualParticipantIds:t,groupingParticipantId:r,tournamentRecord:i,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!i)return ac({result:{error:Ji},stack:a});if(!r||!t)return ac({result:{error:Da},stack:a});let o=(i.participants??[]).find(e=>e.participantId===r);if(!o)return ac({result:{error:to},stack:a});if(![Ph,Th].includes(o.participantType))return ac({result:{participantType:o.participantType,error:Ka},stack:a});let s=jS({individualParticipantIds:t,groupingParticipant:o,tournamentRecord:i,suppressErrors:n}),{removed:c,error:u}=s;if(u)return ac({result:s,stack:a});if(e)for(let l of i.events??[]){let e=(l.entries??[]).map(({participantId:e})=>e).filter(Boolean);if(e.includes(r)){let t=c?.filter(t=>!e.includes(t));CS({participantIds:t,entryStatus:gg,tournamentRecord:i,event:l})}}return c&&Bs({topic:Wf,payload:{tournamentId:i.tournamentId,participants:[o]}}),{...Gi,...s}}function jS({individualParticipantIds:e=[],groupingParticipant:t,tournamentRecord:r,suppressErrors:i,mappedMatchUps:n,participants:a}){let o=[];if(!t)return{removed:o};let s=[],c=[];a||({participants:a,mappedMatchUps:n}=mS({withMatchUps:!0,tournamentRecord:r,withEvents:!0}));let u=a?.find(({participantId:e})=>e===t.participantId)?.events?.map(({eventId:e})=>e),l=(t.individualParticipantIds??[]).filter(i=>{let l=e?.includes(i),d=l&&a?.find(e=>e.participantId===i)?.matchUps.filter(({eventId:e})=>u.includes(e)).map(({matchUpId:e})=>n?.[e]).filter(({winningSide:e,score:t})=>e||qy({score:t})),p=l&&!d?.length;if(l&&!p&&c.push(i),p){o.push(i);for(let e of r.events??[])for(let n of e.drawDefinitions??[]){let{extension:e}=lm({element:n,name:Um}),a=e?.value[t.participantId];e&&a&&(e.value[t.participantId]=a.filter(e=>e.participantId!==i),em({element:n,extension:e}),uh({drawDefinition:n}));let o=Ly({drawDefinition:n,inContext:!1}).matchUps??[];for(let t of o){let e=t.sides??[];for(let a of e){let e=a.lineUp??[];e.find(e=>e.participantId===i)&&(a.lineUp=e.filter(e=>e.participantId!==i),ch({tournamentId:r?.tournamentId,drawDefinition:n,matchUp:t}))}}}}else s.push(i);return!p});t.individualParticipantIds=l;let d={groupingParticipantId:t.participantId,cannotRemove:c,notRemoved:s,removed:o};return c.length&&!i&&{...d,cannotRemove:c,error:ja}||d}function GS({participantRole:e=xS,individualParticipantIds:t=[],groupingTypes:r=[Uh,Th],tournamentRecord:i}){if(!i)return{error:Ji};let n=i.participants??[],{participants:a,mappedMatchUps:o}=mS({withMatchUps:!0,tournamentRecord:i,withEvents:!0}),s=0;return n.filter(t=>(t.participantRole===e||!t.participantRole)&&t.participantType&&r.includes(t.participantType)).forEach(e=>{let{removed:r}=jS({groupingParticipant:e,individualParticipantIds:t,tournamentRecord:i,mappedMatchUps:o,participants:a});r&&s++}),s?Gi:{error:io}}function WS(e){let t=Dp(e,[{[Cd]:!0},{participantIds:!0,[vp]:hp,[sp]:no}]);if(t.error)return t;let{addIndividualParticipantsToEvents:r,tournamentRecord:i,participantIds:n}=e,a=i.participants?.length||0;if(!a)return{...Gi};let o=(i.events||[])?.filter(({eventType:e})=>e===Dl).map(e=>e?.drawDefinitions?.map(({drawId:e})=>e)).flat(1/0),s=mS({participantFilters:{participantIds:n},tournamentRecord:i,withDraws:!0}).participants??[],c=o?.length?Ci((Oy({matchUpFilters:{drawIds:o,matchUpTypes:[Hr]},tournamentRecord:i}).matchUps??[]).flatMap(({sides:e})=>e?.map(({participantId:e})=>e||[])).filter(Boolean),n):[],u=s.filter(e=>e.draws?.filter(e=>(!o?.length||!o?.includes(e.drawId))&&e.positionAssignments).length);if(c?.length||u.length)return{error:co};let l={},d={};for(let m of i.events||[]){let e=NS({participantIds:n,event:m});if(e.error)return e;l[m.eventId]=e.participantIdsRemoved}i.participants=(i.participants??[]).filter(e=>{let t=n.includes(e.participantId)||e.participantType===Dh&&e.individualParticipantIds?.some(e=>n.includes(e));if(!t&&e.participantType===Dl&&e.individualParticipantIds?.some(e=>n.includes(e))&&(e.individualParticipantIds=e.individualParticipantIds.filter(e=>!n.includes(e))),t&&r&&e.participantType&&[Dh,Ph].includes(e.participantType))for(let r of e.individualParticipantIds||[])n.includes(r)||(d[e.participantId]||(d[e.participantId]=[]),d[e.participantId].push(r));return!t});let p=a-i.participants.length;if(GS({individualParticipantIds:n,tournamentRecord:i}),r)for(let m of i.events||[]){CS({participantIds:l[m.eventId].map(e=>d[e]||[]).flat(),entryStatus:gg,tournamentRecord:i,event:m})}return p&&Bs({payload:{participantIds:n,tournamentId:i.tournamentId},topic:Ff}),p?{...Gi,participantsRemovedCount:p}:{error:ja}}function qS({selected:e=!0,drawDefinition:t,entryStatuses:r,drawId:i,event:n,stage:a}){let o=n.entries??[];if(i){let{flightProfile:e}=py({event:n}),r=e?.flights?.find(e=>e.drawId===i);r?o=r.drawEntries:t.entries&&(o=t?.entries)}let s=o.filter(t=>(!r?.length||!t.entryStatus||r.includes(t.entryStatus))&&(!a||!t.entryStage||t.entryStage===a)&&(!e||t.entryStatus&&wg.includes(t.entryStatus)));return{entries:o,stageEntries:s}}function HS({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:r,participantId:i,drawId:n,stage:a,event:o}){let s="destroyGroupEntry";if(!t)return{error:Ji};if(!i)return ac({result:{error:Za},stack:s});if(!o)return{error:jn};if(!o.eventType||![Tl,Pl].includes(o.eventType))return ac({result:{error:Vn},stack:s});let c=t.participants??[],u=c.find(e=>e.participantId===i);if(!u)return ac({result:{error:to},stack:s});if(!u.participantType||![Dh,Uh].includes(u.participantType)||u.participantType===Uh&&o.eventType!==Pl||u.participantType===Dh&&o.eventType!==Tl)return{error:Ka};let l=(o.entries??[]).find(e=>e.participantId===i);if(!l)return{error:mo};let d,{stageEntries:p}=qS({selected:!1,drawDefinition:r,drawId:n,event:o,stage:a}),m=p.map(Hm),f=c.filter(({participantId:e})=>m.includes(e)).map(({individualParticipantIds:e})=>e).flat().filter(Boolean),h=u.individualParticipantIds?.filter(e=>1===Ai(e,f).length),g=NS({participantIds:[i],event:o});return g.error||h?.length&&(g=CS({participantIds:h,entryStatus:gg,entryStage:l.entryStage,tournamentRecord:t,drawDefinition:r,drawId:n,event:o}),g.error)?g:(e&&WS({participantIds:[i],tournamentRecord:t}).success&&(d=!0),{...Gi,participantRemoved:d})}function zS({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:r,participantId:i,drawId:n,event:a}){return HS({removeGroupParticipant:e,tournamentRecord:t,drawDefinition:r,participantId:i,drawId:n,event:a})}function YS(e){if(!e.tournamentRecord)return{error:Ji};let{participantIds:t,...r}=e,i=0,n=[];for(let a of t){let e=HS({participantId:a,...r});e.success&&(i+=1),e.error&&n.push(e.error)}return i?{destroyedCount:i,...Gi}:{error:n}}function KS(e){let{tournamentRecord:t,replaceWithBye:r,drawDefinition:i,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=e,c="removeDrawPositionAssignment",u=uv(e);if(u.error)return ac({result:u,stack:c});let{participantId:l}=u,{drawPosition:d,event:p,structureId:m}=e,f=zh({tournamentRecord:t,drawDefinition:i,event:p}).appliedPolicies??{};if([sg,vg].includes(a)&&l){let{tournamentRecord:t}=e,{participant:r}=kh({tournamentRecord:t,participantId:l}),{participantType:o,individualParticipantIds:u}=r??{};if(n&&o===Dh){let e=zS({tournamentRecord:t,drawDefinition:i,participantId:l,event:p});if(e.error)return ac({result:e,stack:c});u&&hv({participantIds:u,tournamentRecord:t,drawDefinition:i,entryStatus:a,drawId:s,event:p})}else hv({participantIds:[l],tournamentRecord:t,drawDefinition:i,entryStatus:a,drawId:s,event:p})}if(r){let e=iv({tournamentRecord:t,drawDefinition:i,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(e.error)return ac({result:e,stack:c})}let{structure:h}=wf({drawDefinition:i,structureId:m});return fh({structure:h,drawPositions:[d]}),hh({appliedPolicies:f,drawDefinition:i,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:r,drawPosition:d,entryStatus:a,structureId:m}}),u}function XS(e){return Object.assign(e,{entryStatus:vg}),KS(e)}var QS=({finishingPosition:e=Pd,hasExistingDrawDefinition:t,qualifyingRoundNumber:r,structureAbbreviation:i,seedAssignments:n=[],stageSequence:a=1,qualifyingOnly:o,structureOrder:s,seedingProfile:c,matchUpFormat:u,structureType:l,structureName:d,matchUps:p=[],matchUpType:m,structureId:f,roundOffset:h,roundLimit:g,stageOrder:I,structures:y,tieFormat:v,stage:S})=>{let b={structureId:f??Ru(),structureAbbreviation:i,finishingPosition:e,seedAssignments:n,matchUpFormat:u,stageSequence:a,structureName:d};(o||t&&v)&&(b.tieFormat=v),s&&(b.structureOrder=s),l&&(b.structureType=l),c&&("string"==typeof c?b.seedingProfile=c:"object"==typeof c&&"string"==typeof c.positioning&&(b.seedingProfile=c.positioning)),m&&(b.matchUpType=m),h&&(b.roundOffset=h),I&&(b.stageOrder=I),g&&(b.roundLimit=g),S&&(b.stage=S),r&&(b.qualifyingRoundNumber=r);let U=p.flatMap(({drawPositions:e})=>e).filter(Boolean);return y?b.structures=y:(b.matchUps=p,b.positionAssignments=vi(U).sort((e,t)=>e-t).map(e=>({drawPosition:e}))),b},JS=QS;function ZS(e){return ei(e)?e.split(" ").map(e=>e.split("").map((e,t)=>t?e.toLowerCase():e.toUpperCase()).join("")).join(" "):e}function eb(e){return ei(e)?ZS(e.replace(/_/g," ")):""}function tb({structureName:e=eb(Al),structureAbbreviation:t,drawDefinition:r,matchUpType:i,structureId:n}){if(!r)return{error:rn};let a=JS({stage:Al,structureAbbreviation:t,structureName:e,matchUps:[],structureId:n,matchUpType:i});return r.structures||(r.structures=[]),r.structures.push(a),lh({drawDefinition:r,structureIds:[a.structureId]}),{...Gi}}function rb({positioning:e,size:t}){let r=function({size:e}){let t=[e],r=e;for(;r/2===Math.floor(r/2);)r/=2,t.push(r);return t.includes(1)||t.push(1),t.sort(Qr),t.reverse(),t}({size:t}),i=[],n=[],a=e=>e[0],o=(t,r)=>(e&&[Bl,$l,jl].includes(e)&&r%2?(e=>e[e.length-1])(t):a(t))||a(t),s=(e,t)=>{if(e.every(e=>!n.includes(e))){let r=o(e,t);return n.push(r),r}},c=e=>{let t=e.filter(e=>!n.includes(e));if(t.length)return n.push(...t),t},u=(e,t)=>{let r=o(e,t);if(!n.includes(r))return n.push(r),r},l=Ri(1,t+1);for(let d of r)if(1===d){let e=_i(l,2),t=e.map(s).filter(Boolean);t.length&&i.push(t);let r=e.flatMap(c).filter(Boolean);r.length&&i.push(r)}else{let e=_i(l,d).map(u).filter(Boolean);e.length&&i.push(e)}return{divisions:r,divisionGroupings:i}}function ib({drawPositions:e}){if(!e?.length)return{error:fn};let t=[].concat(...(e??[]).map(t=>e.filter(e=>e!==t).map(e=>[t,e]))),r=vi(t.map(nb)).map(e=>e.split("|").map(e=>+e));return{groupMatchUps:t,uniqueMatchUpGroupings:r}}function nb(e=[]){return Array.isArray(e)&&e.length?[...e].sort(Qr).join("|"):""}function ab({groupSize:e,drawPositionOffset:t}){if(!e)return[];let r=e=>[...Array(e)].map((e,t)=>t),i=r(2*Math.round(e/2)+1).slice(1),n=r(i.length-1).map(()=>[]),a=i.slice(0,i.length/2),o=i.slice(i.length/2);i.slice(1).forEach((e,t)=>{a.forEach((e,r)=>{n[t].push([a[r],o[r]])});let r=a.shift(),i=a.pop(),s=o.shift();a=[r,s,...a].filter(Boolean),o=[...o,i].filter(Boolean)});let s=a.shift(),c=a.pop(),u=o.shift();a=[s,u,...a].filter(Boolean),o=[...o,c].filter(Boolean);let l=e=>e[0].reduce((e,t)=>e+t);return[...n].reverse().sort((e,t)=>l(e)-l(t)).map(r=>r.filter(t=>t.every(t=>t<=e)).map(e=>nb(e.map(e=>e+t))))}var ob={getRoundRobinGroupMatchUps:ib,determineRoundNumber:function({rounds:e,hash:t}){return e?.length?e?.reduce((e,r,i)=>r.includes(t)?i+1:e,void 0):{error:Da}},drawPositionsHash:nb,groupRounds:ab};function sb(e){let t,{hasExistingDrawDefinition:r,groupNameBase:i="Group",playoffAttributes:n,stageSequence:a=1,structureOptions:o,appliedPolicies:s,qualifyingOnly:c,seedingProfile:u,stage:l=El,matchUpType:d,roundTarget:p,structureId:m,groupNames:f,tieFormat:h,drawSize:g,idPrefix:I,isMock:y,uuids:v}=e,S=e.structureName??n?.[0]?.name??eb(El),{groupCount:b,groupSize:U}=function({appliedPolicies:e,structureOptions:t,drawSize:r}){let i=t?.groupSize,n=t?.groupSizeLimit||8,{validGroupSizes:a}=cb({groupSizeLimit:n,drawSize:r}),o=a&&Math.max(...a);i&&a?.includes(i)||(i=i&&i>4||!a?.includes(4)?o:4);let s=Math.ceil(r/i);return{groupSize:i,groupCount:s}}({structureOptions:o,appliedPolicies:s,drawSize:g}),w=Dd,T=Ri(1,b+1).map(e=>{let n=function({structureOrder:e,matchUpType:t,groupSize:r,drawSize:i,idPrefix:n,isMock:a,uuids:o}){let s=(e-1)*r,c=Ri(1+s,r+1+s),u=ib({drawPositions:c}).uniqueMatchUpGroupings??[],l=ab({groupSize:r,drawPositionOffset:s});return u.map(p).sort((e,t)=>(e.roundNumber??1/0)-(t.roundNumber??1/0));function d(e){return l.reduce((t,r,i)=>r.includes(e)?i+1:t,void 0)}function p(r){let s=d(nb(r)),c=[1,i],u=function({structureOrder:e,drawPositions:t,roundNumber:r,idPrefix:i,uuids:n}){return i?`${i}-${e}-${r}-DP-${t.join("-")}`:n?.pop()||Ru()}({structureOrder:e,drawPositions:r,roundNumber:s,idPrefix:n,uuids:o}),l={matchUpStatus:s?lf:"BYE",matchUpType:t,finishingPositionRange:{winner:c,loser:c},drawPositions:r,roundNumber:s,matchUpId:u};return a&&(l.isMock=!0),l}}({groupSize:U,structureOrder:e,matchUpType:d,drawSize:g,idPrefix:I,isMock:y});t=Array.isArray(n)?Math.max(...n.map(({roundNumber:e})=>e??0)):0;let a=f?.[e-1]??`${i} ${e}`;return QS({structureId:v?.pop(),hasExistingDrawDefinition:r,structureType:Gl,finishingPosition:w,qualifyingOnly:c,structureOrder:e,structureName:a,tieFormat:h,matchUps:n})}),D=QS({structureId:m??v?.pop(),hasExistingDrawDefinition:r,structureType:Wl,finishingPosition:w,seedingProfile:u,structureName:S,stageSequence:a,structures:T,tieFormat:h,stage:l});return p&&em({extension:{name:Nm,value:p},element:D}),{structures:[D],maxRoundNumber:t,groupCount:b,links:[],groupSize:U,...Gi}}function cb(e){let{groupSizeLimit:t=10,drawSize:r=0}=e??{},i=Ri(3,t+1).filter(e=>{let t=Math.ceil(r/e),i=t*e-r,n=Math.ceil(r/t),a=Math.ceil(i/t);return(!i||i<e)&&n===e&&n>=3&&a<2});return{...Gi,validGroupSizes:i}}function ub(e){let{roundRobinGroupsCount:t,participantsCount:r,cluster:i}=e;if(!gi(r))return{seedBlocks:void 0,...ac({result:{error:Zo},context:{participantsCount:r},stack:"getSeedBlocks"})};let n=fi(r);if(t){let e=Math.min(t,n),r=[],i=1;for(Ri(0,e).forEach(()=>{r.push([i]),i++});i<n;){let t=Ri(i,i+e);i+=e,r.push(t)}return{...Gi,seedBlocks:r}}let a=Ri(1,n+1),o=[],s=n/2;for(;s>1;){let e=_i(a,s),t=e.length;e.forEach((e,r)=>{let n,a=r<t/2,s=r%2==0,c=e[0],u=e[e.length-1];n=i&&t>4?8===t?a?u:c:s?c:u:a?c:u,xi(e,o)||o.push(n)}),s/=2}let c=a.filter(e=>!o.includes(e));for(;c.length;)c.length%2==0?o.push(c.pop()):o.push(c.shift());let u=Ri(0,20).map(e=>Math.pow(2,e));u.unshift(1);let l=u.indexOf(n),d=0,p=[];return Ri(0,l).forEach(e=>{p.push(o.slice(d,d+u[e])),d+=u[e]}),{...Gi,seedBlocks:p}}function lb({roundRobinGroupsCount:e,drawSize:t}){let r="getSeedGroups";if(!gi(t))return{seedGroups:void 0,...ac({result:{error:Zo},context:{drawSize:t},stack:r})};if(e){if(!gi(e))return{seedGroups:void 0,...ac({context:{roundRobinGroupsCount:e},result:{error:Zo},stack:r})};let i=1;return{seedGroups:Ri(0,Math.floor(t/e)).map(()=>{let t=Ri(i,i+e);return i+=e,t})}}{let{seedBlocks:r}=ub({participantsCount:t,roundRobinGroupsCount:e}),i=0;return{seedGroups:(r||[]).map(e=>(e||[]).map(()=>(i+=1,i)))}}}function db({roundRobinGroupsCount:e,participantsCount:t}){if(e){let{validGroupSizes:r}=cb({drawSize:t});if(!r?.map(e=>Math.ceil(t/e))?.includes(e))return ac({context:{roundRobinGroupsCount:e},result:{error:Zo}})}let{seedGroups:r}=lb({drawSize:t,roundRobinGroupsCount:e}),i=r?.map(e=>Math.min(...e))||[];return{...Gi,seedingThresholds:i}}function pb(e){if(!e)return 1/0;if(gi(e))return Jr(e);let t=e.split("-")[0];return gi(t)?Jr(t):1/0}function mb({provisionalPositioning:e,returnAllProxies:t,appliedPolicies:r,seedingProfile:i,drawDefinition:n,allPositions:a,structure:o}){let s=[];if(!o)return{error:Ln};let{matchUps:c,roundMatchUps:u}=Uy({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:e,structure:o}),{seedAssignments:l}=Mg({provisionalPositioning:e,returnAllProxies:t,drawDefinition:n,structure:o}),{positionAssignments:d}=Nf({structure:o}),p=d?.length,m=l?.length??0,f=[],h=Object.keys(u).map(e=>Number.parseInt(e)).sort((e,t)=>e-t).map(e=>{let t=u[e].map(e=>e.drawPositions).flat(1/0).filter(Boolean),r=t.filter(e=>!f.includes(e));return f=f.concat(...t),r}).filter(e=>e.length).reverse(),g=h.pop()??[],I=g&&Math.min(...g)-1||0;i=i??r?.seeding?.seedingProfile;let y=g?.length||0,v=h.filter(e=>e.filter(e=>e<=m).length),{stage:S,structureType:b,roundLimit:U}=o,w=b===Wl,T=!w&&h?.length,D=!w&&S===Ml&&U,P=v.flat(1/0),N=T?P?.length:0,E=a?p:m,M=Vg({drawDefinition:n,structure:o,matchUps:c}),R=M?0:!T&&E||E&&P.length<E&&E-P.length||0;if(D){let e=o?.matchUps?o.matchUps.filter(({roundNumber:e})=>e===o.roundLimit).length:0,t=g.length/e;if(!T){let e=yb(i),r=_i(g,t),n=1,a=Ri(0,r[0].length).map(()=>{let e=Ri(n,n+r.length);return n+=r.length,e});({validSeedBlocks:s}=fb({drawPositionBlocks:r,nonRandom:i?.nonRandom,positioning:e,seedGroups:a}))}}else w?({validSeedBlocks:s}=function({seedingProfile:e,structure:t,nonRandom:r}){let i=t.structures||[],n=i.length,a=Pf({structure:t})?.positionAssignments,o=yb(e),s=a?.length??0,{seedGroups:c}=lb({roundRobinGroupsCount:n,drawSize:s}),u=i.map(e=>Pf({structure:e}).positionAssignments?.map(e=>e.drawPosition));return fb({drawPositionBlocks:u,positioning:o,seedGroups:c,nonRandom:r})}({nonRandom:i?.nonRandom,seedingProfile:i,structure:o})):T?s=v.map(e=>({seedNumbers:e,drawPositions:e})):M&&_i(g,2).map((e,t)=>({drawPositions:[e[0]],seedNumbers:[t+1]})).forEach(e=>s.push(e));if(!w&&!M&&!D){let{blocks:e}=function(e){let t,{drawPositionOffset:r=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:a,seedCountGoal:o,baseDrawSize:s}=e,c=[],{seedBlocks:u}=ub({cluster:[Bl,$l].includes(yb(a)),participantsCount:s,roundRobinGroupsCount:i});t=0;for(let l of u){if(t+1>o)break;let e=l.map(e=>e+r),i=hb(t+1,l.length).map(e=>+e+n);t+=l.length,c.push({drawPositions:e,seedNumbers:i})}return{blocks:c}}({drawPositionOffset:I,seedNumberOffset:N,seedCountGoal:R,seedingProfile:i,baseDrawSize:y});e.forEach(e=>s.push(e))}let A=s.flatMap(e=>e.drawPositions).reduce((e,t)=>g?.includes(t)&&e,!0);return M||T||w||A?{isLuckyStructure:M,validSeedBlocks:s,isContainer:w,isFeedIn:T}:{error:Cn,validSeedBlocks:[],isContainer:w,isFeedIn:T}}function fb({drawPositionBlocks:e,positioning:t,seedGroups:r,nonRandom:i}){let n=[],{divisionGroupings:a}=rb({size:r.length,positioning:t}),o=[];return r.forEach((r,s)=>{let c=function({blockPattern:e,index:t}){let r=0;for(let i of e){if(r===t)return i;let e=0;for(;e<i.length;){if(r===t)return i;r+=1,e++}}}({blockPattern:a,index:s});r.forEach((r,a)=>{let u=s%2?e.length-a-1:a,l=e[u].slice().filter((e,t)=>c.includes(t+1)&&e);t!==jl?l=i?l:bi(l):s%2&&l.reverse();let d=l.find(e=>!o.includes(e));d&&(o.push(d),n.push({drawPositions:[d],seedNumbers:[r]}))})}),{validSeedBlocks:n}}function hb(e,t){return Array.from(new Array(t),(t,r)=>r+e)}function gb({appliedPolicies:e,drawDefinition:t,seedBlockInfo:r,drawPosition:i,structureId:n,seedNumber:a}){let{structure:o}=wf({drawDefinition:t,structureId:n});e??=zh({drawDefinition:t}).appliedPolicies;let s=r?.validSeedBlocks;return!s&&o&&(s=mb({appliedPolicies:e,drawDefinition:t,structure:o})?.validSeedBlocks),!!e?.seeding?.validSeedPositions?.ignore||(e?.seeding?.validSeedPositions?.strict?(s.find(e=>e.seedNumbers.includes(a))?.drawPositions||[]).includes(i):s.flatMap(e=>e.drawPositions).includes(i))}function Ib(e){let{provisionalPositioning:t,drawDefinition:r,seedingProfile:i,seedBlockInfo:n,structureId:a,randomize:o}=e,{structure:s}=wf({drawDefinition:r,structureId:a}),{seedAssignments:c}=Mg({returnAllProxies:e.returnAllProxies,provisionalPositioning:t,drawDefinition:r,structure:s}),{positionAssignments:u}=Nf({structure:s}),l=u?.filter(e=>e.participantId??e.bye??e.qualifier)?.map(e=>e.drawPosition).filter(Boolean),{appliedPolicies:d}=zh({drawDefinition:r}),p=(n?.validSeedBlocks||s&&mb({returnAllProxies:e.returnAllProxies,provisionalPositioning:t,appliedPolicies:d,drawDefinition:r,seedingProfile:i,structure:s})?.validSeedBlocks||[]).find(e=>e.drawPositions.filter(e=>!l?.includes(e)).length),m=c?.map(e=>e.participantId).filter(Boolean),f=u?.map(e=>e.participantId).filter(Boolean),h=m?.filter(e=>f?.includes(e)),g=m?.filter(e=>!f?.includes(e)),I=c?.filter(e=>g?.includes(e.participantId)),y=c?.filter(e=>!e.participantId),v=(I?.length&&I.length>0?I.length:y?.length??0)&&p?.drawPositions.filter(e=>!l?.includes(e))||[],S=o?bi(v):v,b=[],U=S.map(()=>{let e=function(e,t){let r=e.filter(e=>!t.includes(e.participantId)),i=Math.min(...r.map(e=>pb(e.seedValue)));return bi(r.filter(e=>pb(e.seedValue)===i)).pop()}(I,b)?.participantId;return e&&b.push(e),e}).filter(Boolean),w=c?.filter(e=>h?.includes(e.participantId)).map(e=>e.seedNumber),T=(p?.seedNumbers||[]).filter(e=>!w?.includes(e)),D=c?.filter(e=>T.includes(e.seedNumber)).map(e=>e.participantId),P=d?.seeding?.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:"boolean"!=typeof P||P?U:D,unplacedSeedNumbers:T,unfilledPositions:S,unplacedSeedAssignments:I}}function yb(e){return"string"==typeof e?e:"object"==typeof e?e.positioning:void 0}function vb({provisionalPositioning:e,tournamentRecord:t,drawDefinition:r,seedingProfile:i,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:c,eventId:u,event:l}){let d="assignSeed",{structure:p}=wf({drawDefinition:r,structureId:o}),{positionAssignments:m}=Nf({structure:p}),f=Mg({provisionalPositioning:e,drawDefinition:r,structure:p}).seedAssignments,h=f.map(e=>e.seedNumber),g=vS({drawDefinition:r,participantId:n});if(n&&!g)return ac({result:{error:Ha},context:{participantId:n},stack:d});let I,y=l?py({event:l}).flightProfile?.flights?.length:0,v=y&&y>1,S=m?.find(e=>e.participantId===n)?.drawPosition;return S&&!gb({drawPosition:S,drawDefinition:r,seedBlockInfo:a,structureId:o,seedNumber:s})?ac({result:{error:cn},context:{assignedDrawPosition:S},info:"invalid seed position",stack:d}):(h.includes(s)||f.push({seedNumber:s,seedValue:c}),f.forEach(e=>{e.participantId===n&&e.seedNumber!==s&&(e.participantId=void 0),e.seedNumber===s&&(e.participantId=n,!i?.groupSeedingThreshold&&!v&&(e.seedValue=c??s),I=!0)}),I?(dh({tournamentId:t?.tournamentId,drawDefinition:r,structure:p,eventId:u}),{...Gi}):ac({result:{error:An},stack:d}))}function Sb({inContextTargetMatchUp:e,drawPositionSideIndex:t,teamParticipantId:r,tournamentRecord:i,drawDefinition:n,matchUp:a,event:o}){let s=e?.sides?.[t]?.sideNumber,c=s&&a.sides?.find(e=>e.sideNumber===s),{extension:u}=lm({element:n,name:Um}),l=Nu((u?.value||{})[r],!1,!0);if(c)a?.sides?.forEach(e=>{e.sideNumber===s&&(e.lineUp=l)});else{a.sides=[1,2].map(e=>({...a.sides?.find(t=>t.sideNumber===e)??{},sideNumber:e}));let e=a.sides.find(e=>e.sideNumber===s);e&&(e.lineUp=l)}ch({tournamentId:i?.tournamentId,context:"updateSidLineUp",eventId:o?.eventId,drawDefinition:n,matchUp:a})}function bb(e){let{sourceMatchUp:t}=e,{targetMatchUp:r,structure:i,matchUpsMap:n,drawPosition:a}=e,o=r.roundNumber>1&&r.roundNumber-1,s=xg({structureId:i.structureId,matchUpsMap:n});Zy({method:"getPairedPreviousMatchUpIsDoubleExit",color:"brightcyan",keyColors:{structureId:"brightyellow",sourceMatchUpId:"brightmagenta"},structureId:i.structureId?.slice(0,8),targetMatchUpId:r.matchUpId,targetRound:[r.roundNumber,r.roundPosition],previousRoundNumber:o,sourceMatchUpId:t?.matchUpId,sourceStructureId:t?.structureId?.slice(0,8),sourceRound:t?[t.roundNumber,t.roundPosition]:void 0,drawPosition:a,structureMatchUpCount:s?.length}),t&&t.structureId!==i.structureId&&a?(Zy({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"cross_structure_sourceMatchUp_resolving_in_target",originalSourceId:t?.matchUpId,originalSourceStructure:t?.structureId?.slice(0,8),targetStructure:i.structureId?.slice(0,8)}),t=s.find(({drawPositions:e,roundNumber:t})=>t===o&&e?.includes(a)),Zy({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_cross_structure_sourceMatchUp",resolvedMatchUpId:t?.matchUpId,resolvedRound:t?[t.roundNumber,t.roundPosition]:void 0,resolvedStatus:t?.matchUpStatus})):!t&&a&&(t=s.find(({drawPositions:e,roundNumber:t})=>t===o&&e?.includes(a)),Zy({method:"getPairedPreviousMatchUpIsDoubleExit",color:"cyan",info:"resolved_sourceMatchUp_from_drawPosition",resolvedMatchUpId:t?.matchUpId,resolvedRound:t?[t.roundNumber,t.roundPosition]:void 0,resolvedStatus:t?.matchUpStatus}));let c=t?.roundPosition,u=c%2?1:-1,l=c+u,d=o&&s.find(({roundNumber:e,roundPosition:t})=>e===o&&t===l),p=d?.matchUpStatus,m=[nf,rf].includes(p);return Zy({method:"getPairedPreviousMatchUpIsDoubleExit",color:m?"brightred":"brightgreen",keyColors:{pairedMatchUpId:"brightcyan",isDoubleExit:m?"brightred":"brightgreen"},sourceRoundPosition:c,offset:u,pairedRoundPosition:l,pairedMatchUpId:d?.matchUpId,pairedRound:d?[d.roundNumber,d.roundPosition]:void 0,pairedStatus:p,isDoubleExit:m}),{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function Ub({structureId:e,matchUpsMap:t,matchUp:r}){let i=r?.roundPosition,n=i+(i%2?1:-1);return{pairedPreviousMatchUp:xg({matchUpsMap:t,structureId:e}).find(({roundNumber:e,roundPosition:t})=>e===r?.roundNumber&&t===n)}}function wb({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:r,matchUpsMap:i,matchUp:n}){let a=e.find(e=>e.matchUpId===r),{pairedPreviousMatchUp:o}=Ub({structureId:a?.structureId,matchUp:a,matchUpsMap:i});if(a&&o){let r=o?.matchUpId,i=e.find(e=>e.matchUpId===r),s=a?.structureId===i?.structureId?a?.roundPosition<i?.roundPosition?1:2:a.structureId===i?.structureId?2:1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(e=>{let r=ei(e)||!isNaN(e)?{code:e}:e;return r.sideNumber===s?{...r,previousMatchUpStatus:t}:r})}}function Tb({inContextDrawMatchUps:e,drawPosition:t,matchUpId:r}){let i=e.filter(({winnerMatchUpId:e,loserMatchUpId:t})=>t===r||e===r).sort((e,t)=>e.roundPosition-t.roundPosition);return e.find(e=>e.matchUpId===r).feedRound?1:i.reduce((e,r,i)=>r.drawPositions?.includes(t)?i+1:e,void 0)}function Db({inContextDrawMatchUps:e,sourceMatchUpStatus:t,tournamentRecord:r,sourceMatchUpId:i,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:c,event:u}){let l="assignMatchUpDrawPosition";s||(s=kg({drawDefinition:n})),e||(e=Cy({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let d=e.find(e=>e.matchUpId===c),p=d?.structureId,m=n?.structures?.find(e=>e.structureId===p);if(!m)return{error:Fn};let f=s?.drawMatchUps?.find(e=>e.matchUpId===c),h=f?.drawPositions??[],{positionAdded:g,positionAssigned:I,updatedDrawPositions:y}=function({drawPosition:e,drawPositions:t}){let r=!1,i=!!t?.includes(e);return{updatedDrawPositions:i?t||[]:[...t,void 0,void 0].slice(0,2).map(t=>t||i?t:(i=!0,r=!0,e)).sort(Qr).filter(Boolean),positionAdded:r,positionAssigned:i}}({drawPositions:h,drawPosition:o}),{positionAssignments:v}=Pf({drawDefinition:n,structure:m}),S=v?.filter(e=>y.includes(e.drawPosition))?.find(({bye:e})=>e),b=f?.matchUpStatus&&rv(f.matchUpStatus)&&y.filter(Boolean).length<2;a=(S?"BYE":a)||b&&f.matchUpStatus||f?.matchUpStatus&&[nf,rf].includes(f.matchUpStatus)&&f.matchUpStatus||lf;let U=!(!rv(f?.matchUpStatus)||!f?.winningSide);if(f&&g){e=Cy({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let u=b&&Tb({inContextDrawMatchUps:e,drawPosition:o,matchUpId:c})||U&&f.winningSide||void 0;f?.matchUpStatusCodes&&wb({inContextDrawMatchUps:e,sourceMatchUpStatus:t,sourceMatchUpId:i,matchUpsMap:s,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:u,matchUpStatus:U?f?.matchUpStatus:a}),ch({tournamentId:r?.tournamentId,eventId:d?.eventId,context:l,drawDefinition:n,matchUp:f})}let w=Ey({inContextDrawMatchUps:e,inContextMatchUp:d,drawDefinition:n,matchUpId:c}),{targetMatchUps:{winnerMatchUp:T,loserMatchUp:D,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:N}}=w,E=xg({structureId:m.structureId,matchUpsMap:s});if(I&&S){if(T)if(["BYE",nf,rf].includes(a)){let t=Db({matchUpId:T.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(t.error)return t}else{let{structureId:e}=T;e!==m.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(I&&U){if(T){let t=Db({matchUpId:T.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(t.error)return t}}else if(T&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:t}=bb({targetMatchUp:f,drawPosition:o,matchUpsMap:s,structure:m});if(t){let t=Db({matchUpId:T.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(t.error)return t}}if(f?.matchUpType===Yr){let t=e?.find(({matchUpId:e})=>e===f.matchUpId),i=(t?.sides??[]).reduce((e,t,r)=>t.drawPosition===o?r:e,void 0),a=v?.find(e=>e.drawPosition===o)?.participantId;a&&void 0!==i&&Sb({inContextTargetMatchUp:t,drawPositionSideIndex:i,teamParticipantId:a,tournamentRecord:r,drawDefinition:n,matchUp:f})}if(N?.linkCondition===Jl&&2===y.filter(Boolean).length&&!S&&E.filter(({drawPositions:e,roundNumber:t})=>1===t&&xi(e,y)).every(({matchUpStatus:e})=>[Zm,cf].includes(e))&&D){let{structureId:e}=D,t=iv({drawPosition:P,tournamentRecord:r,drawDefinition:n,structureId:e,matchUpsMap:s,event:u});if(t.error)return t}return I?{...Gi}:ac({result:{error:un},context:{drawPosition:o},stack:l})}function Pb({inContextDrawMatchUps:e,drawDefinition:t,assignments:r,matchUpsMap:i,structure:n}){let a=gh({drawDefinition:t})?.containedStructures?.[n.structureId]?.map(({structureId:e})=>e)||[];a.push(n?.structureId);let o=r?.map(({drawPosition:e})=>e)||[],s=e?.filter(e=>a.includes(e.structureId)&&Ci(e.drawPositions??[],o).length)??[],c=s.map(({matchUpId:e})=>e),u=i?.drawMatchUps?.filter(e=>c.includes(e.matchUpId))??[];return{drawPositions:o,matchUps:u,targetMatchUps:s}}function Nb({lineUp:e}){if(!Array.isArray(e))return;let t={};return vi(e.flatMap(({collectionAssignments:e})=>e?.map(({collectionId:e,collectionPosition:t})=>[e,t].join("|"))).filter(Boolean)).forEach(r=>{let[i,n]=r.split("|"),a=parseInt(n),{assignedParticipantIds:o}=hy({collectionPosition:a,collectionId:i,lineUp:e});o.forEach(e=>{t[e]||(t[e]=[]),t[e].push({collectionId:i,collectionPosition:a})})}),Object.keys(t).map(e=>({participantId:e,collectionAssignments:t[e]}))}function Eb(e){return`${e} must be an array`}function Mb({lineUp:e,tieFormat:t}){let r=[];if(!Array.isArray(e))return r.push(Eb("lineUp")),{valid:!1,errors:r,error:Zo};let i=e.every(e=>{if("object"!=typeof e)return r.push("lineUp entries must be objects"),!1;let{participantId:t,collectionAssignments:i}=e;return t?"string"!=typeof t?(r.push("participantIds must be strings"),!1):Array.isArray(i)?i.every(e=>{if("object"!=typeof e)return r.push("collectionAssignments must be objects"),!1;let{collectionPosition:t}=e;return"number"==typeof t||(r.push("collectionPosition must be a number"),!1)}):(r.push(Eb("collectionAssignments")),!1):(r.push("Missing participantId"),!1)}),n=vi(e.map(Hm)).length===e.length;return n||r.push("Duplicated participantId(s)"),{valid:i&&n,errors:r,error:r.length?Zo:void 0}}function Rb({drawDefinition:e,participantId:t,tieFormat:r,lineUp:i}){if("object"!=typeof e)return{error:rn};if("string"!=typeof t)return{error:Za};let n=Mb({lineUp:i,tieFormat:r});if(!n.valid)return n;let{extension:a}=lm({element:e,name:Um}),o=a?.value||{};return o[t]=Nb({lineUp:i}),em({element:e,extension:{name:Um,value:o}}),uh({drawDefinition:e}),{...Gi}}function Ab({inContextDrawMatchUps:e,inheritance:t=!0,tournamentRecord:r,drawDefinition:i,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!i)return{error:rn};let{drawPositions:c,matchUps:u,targetMatchUps:l}=Pb({inContextDrawMatchUps:e,matchUpsMap:n,assignments:a,structure:o});for(let d of l)d.matchUpType===zr&&(d.sides??[]).forEach((e,n)=>{if(e?.drawPosition&&c?.includes(e.drawPosition)){let a=u.find(({matchUpId:e})=>e===d.matchUpId);if(a?.sides?.[n]){if(delete a.sides[n].lineUp,!1===t){let t=d.tieFormat,r=e.participantId;t&&r&&Rb({drawDefinition:i,participantId:r,lineUp:[],tieFormat:t})}ch({tournamentId:r?.tournamentId,context:"resetLineUps",eventId:s?.eventId,drawDefinition:i,matchUp:a})}}});return{...Gi}}function Cb({provisionalPositioning:e,inContextDrawMatchUps:t,isQualifierPosition:r,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:c,drawPosition:u,matchUpsMap:l,structureId:d,event:p}){let m="assignDrawPosition";if(!s&&!r)return ac({result:{error:Za},stack:m});l=l??kg({drawDefinition:a}),t||({matchUps:t}=Cy({inContext:!0,drawDefinition:a,matchUpsMap:l}));let f=wf({drawDefinition:a,structureId:d});if(f.error)return ac({result:f,stack:m});let{structure:h}=f;if(!h)return{error:Fn};if(jg({structure:h}))return ac({result:{error:fa},stack:m});let{seedAssignments:g}=Mg({provisionalPositioning:e,drawDefinition:a,structure:h}),I=g?.find(e=>e.participantId===s)?.seedNumber,{appliedPolicies:y}=zh({tournamentRecord:n,drawDefinition:a,structure:h,event:p});if(I&&!gb({seedNumber:I,appliedPolicies:y,drawDefinition:a,seedBlockInfo:c,drawPosition:u,structureId:d}))return ac({result:{error:cn},context:{drawPosition:u},stack:m});let v=Nf({structure:h}).positionAssignments||[],S=v?.find(e=>e.drawPosition===u);if(!S)return ac({result:{error:In},context:{drawPosition:u},stack:m});if(v?.map(Hm).includes(s))return ac({result:{error:co},context:{drawPosition:u},stack:m});let{containsParticipant:b,containsBye:U}=tv(S);if(U){let e=uv({inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,drawPosition:u,structureId:d,matchUpsMap:l,event:p});if(e.error)return ac({result:e,stack:m})}if(b&&S.participantId!==s){let{activeDrawPositions:e}=Ky({drawDefinition:a,structureId:d});if(e.includes(u))return ac({result:{error:hn},stack:m});Ab({assignments:[S],inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:a,matchUpsMap:l,structure:h})}if(S.participantId=s,r&&(S.qualifier=!0),h.stage===El&&(!h.stageSequence||h.stageSequence>1)||h.stage&&[Rl,Cl].includes(h.stage)){let t=h.stage===Ml?Ml:El,r=(a.structures?.find(e=>e?.stage===t&&1===e?.stageSequence)?.seedAssignments??[]).find(e=>e.participantId===s);if(r?.participantId){let{participantId:t,seedNumber:i,seedValue:s}=r;vb({eventId:p?.eventId,provisionalPositioning:e,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:t,seedNumber:i,seedValue:s,structureId:d,event:p})}}if(h.structureType===Wl){cv({positionAssignments:v,tournamentRecord:n,drawDefinition:a,matchUpsMap:l,structure:h});let{drawPositions:e,matchUps:r,targetMatchUps:i}=Pb({assignments:[S],inContextDrawMatchUps:t,drawDefinition:a,matchUpsMap:l,structure:h});if(e&&1===r?.length&&r[0].matchUpType===Yr){let t=(i?.[0].sides??[]).reduce((t,r,i)=>e?.includes(r.drawPosition)?i:t,void 0);Sb({inContextTargetMatchUp:i[0],teamParticipantId:s,matchUp:r[0],drawPositionSideIndex:t,tournamentRecord:n,drawDefinition:a})}}else!function({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:i,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:c}){let u={isCollectionMatchUp:!1},{matchUps:l}=Uy({provisionalPositioning:e,matchUpFilters:u,drawDefinition:n,matchUpsMap:o,structure:s,event:c}),{roundMatchUps:d}=Lg({matchUps:l}),{initialRoundNumber:p}=Xy({drawPosition:a,matchUps:l}),m=p&&d?.[p].find(e=>e.drawPositions?.includes(a));if(m){let e=Db({matchUpId:m.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:r,tournamentRecord:i,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(e.error)return ac({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:e})}}({provisionalPositioning:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:a,drawPosition:u,matchUpsMap:l,structure:h,event:p});let w=a.entries?.find(e=>e.participantId===s),T=p?.entries?.find(e=>e.participantId===s);return!w&&T&&TS({entryStatus:T.entryStatus,entryStage:h.stage,ignoreStageSpace:!0,drawDefinition:a,participantId:s,event:p}),ph({tournamentId:n?.tournamentId,drawDefinition:a,structure:h,event:p}),{positionAssignments:v,...Gi}}function kb(e){let{participantIdAttributeName:t="participantId",isQualifierPosition:r,positionActionName:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,event:u}=e,l="positionParticipantAction";if(!a)return{error:rn};let d=zh({tournamentRecord:n,drawDefinition:a,event:u}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=e;m||(m=kg({drawDefinition:a}),Object.assign(e,{matchUpsMap:m})),p||(({matchUps:p}=Cy({inContext:!0,drawDefinition:a,matchUpsMap:m})),Object.assign(e,{inContextDrawMatchUps:p}));let{positionAssignments:f}=Pf({drawDefinition:a,structureId:c}),h=f?.find(e=>e.drawPosition===s);if(h?.participantId){let e=h.participantId,t=Cb({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,matchUpsMap:m,event:u});return t.success?v({appliedPolicies:d,removedParticipantId:e}):ac({result:t,stack:l})}let g=uv({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:c,matchUpsMap:m,event:u});if(g.error)return ac({result:g,stack:l});let I=g.participantId,y=Cb({inContextDrawMatchUps:p,isQualifierPosition:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:c,matchUpsMap:m,event:u});return y.success?v({appliedPolicies:d,removedParticipantId:I}):ac({result:y,stack:l});function v({appliedPolicies:e,removedParticipantId:r}){let{structure:n}=wf({drawDefinition:a,structureId:c});return fh({drawPositions:[s],structure:n}),hh({appliedPolicies:e,drawDefinition:a,positionAction:{[t]:o,name:i,drawPosition:s,structureId:c}}),ac({context:{removedParticipantId:r},result:{...Gi},stack:l})}}function xb(e){return function({luckyLoserParticipantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n}){return kb({positionActionName:"luckyLoserDrawPositionAssignment",participantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n})}(e)}function Ob({params:e,modMap:t,structure:r}){let{tournamentRecord:i,drawDefinition:n,event:a}=e;for(let o of r.matchUps)t[o.matchUpId]&&(o.roundNumber=t[o.matchUpId],ch({tournamentId:i?.tournamentId,eventId:a?.eventId,drawDefinition:n,matchUp:o}))}function Fb(e,t){let r=[{drawDefinition:!0,structureId:!0}];Array.isArray(t)&&r.push(...t);let i=Dp(e,r);if(i.error)return i;let n=wf(e);if(n.error)return n;let a=n.structure;if(!jg({structure:a}))return ac({result:{error:on,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Lg({matchUps:a?.matchUps});return s?.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:pa}}function _b(e){let t=Fb(e,[{targetRoundNumber:!0,roundNumber:!0,[vp]:"number"}]);if(t.error)return t;let{structure:r,roundMatchUps:i,roundNumbers:n}=t,{targetRoundNumber:a,roundNumber:o}=e;if(!n?.includes(o)||!n?.includes(a))return ac({result:{error:Zo},info:"roundNumbers must be valid rounds"});let s=a>o,c=s?Ri(o+1,a+1):Ri(a,o),u={};return c.forEach(e=>(i?.[e]??[]).forEach(({matchUpId:t})=>{u[t]=e-(s?1:-1)})),i?.[o]?.forEach(({matchUpId:e})=>u[e]=a),Ob({params:e,modMap:u,structure:r}),{...Gi}}function Lb({structurePositionAssignments:e,provisionalPositioning:t,tournamentRecord:r,drawDefinition:i,event:n}){if(!i)return{error:rn};if(!Array.isArray(e))return{error:Zo};for(let o of e){let{structureId:e,positionAssignments:a}=o;if(!a)continue;let s=wf({drawDefinition:i,structureId:e});if(s.error)return s;let c=s.structure;if(!c)return{error:Fn};let u=Pf({structure:c}).positionAssignments?.map(({drawPosition:e})=>e),l=a?.map(({drawPosition:e})=>e);if(Ci(u,l).length!==u?.length)return ac({result:{error:Zo},info:"drawPositions do not match",stack:"setPositionAssignments"});let d=kg({drawDefinition:i}),{matchUps:p}=Cy({inContext:!0,drawDefinition:i,matchUpsMap:d});for(let o of a||[]){let{drawPosition:s,participantId:u,bye:l,qualifier:m}=o;if(l){let t=iv({tournamentRecord:r,drawDefinition:i,drawPosition:s,matchUpsMap:d,structureId:e,structure:c,event:n});if(t?.error)return t}else if(m)a.forEach(e=>{e.drawPosition===s&&(e.qualifier=!0,delete e.participantId,delete e.bye)});else if(u){let a=Cb({provisionalPositioning:t,inContextDrawMatchUps:p,tournamentRecord:r,drawDefinition:i,participantId:u,drawPosition:s,matchUpsMap:d,structureId:e,event:n});if(a?.error)return a}}ph({tournamentId:r?.tournamentId,drawDefinition:i,structure:c,event:n})}let a=e.map(({structureId:e})=>e);return lh({tournamentId:r?.tournamentId,eventId:n?.eventId,drawDefinition:i,structureIds:a}),{...Gi}}function Bb(e){let t=Fb(e,[{roundNumbers:!0,[vp]:hp,[gp]:e=>2===e.length&&e.every(pi)}]);if(t.error)return t;let{structure:r,roundMatchUps:i,roundNumbers:n}=t;if(!e.roundNumbers.every(e=>n?.includes(e)))return ac({result:{error:Zo,message:"roundNumbers must be valid rounds"}});let a={};return e.roundNumbers.forEach((t,r)=>(i?.[t]??[]).forEach(({matchUpId:t})=>{a[t]=e.roundNumbers[1-r]})),Ob({params:e,modMap:a,structure:r}),{...Gi}}function $b({alternateParticipantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n,event:a}){return kb({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n,event:a})}function Vb({drawDefinition:e,structureId:t}){if(!e)return{error:rn};let{structure:r}=wf({drawDefinition:e,structureId:t}),i=(e?.links||[]).filter(e=>e.source?.structureId===t).map(e=>e.target?.structureId);return{playoffStructures:(e?.structures||[]).filter(e=>i.includes(e.structureId)),structure:r}}function jb({withStageGrouping:e,stageSequences:t,stageSequence:r,roundTarget:i,stages:n,event:a,stage:o}){if(!a)return{error:jn};let s={},c=[];for(let u of a.drawDefinitions||[]){let{structures:a,stageStructures:l}=Tf({withStageGrouping:e,stageSequences:t,drawDefinition:u,stageSequence:r,roundTarget:i,stages:n,stage:o});if(c.push(...a),l)for(let e of Object.keys(l))s[e]||(s[e]=[]),s[e].push(...l[e])}return{structures:c,stageStructures:s}}function Gb({withStageGrouping:e,tournamentRecord:t,stageSequences:r,stageSequence:i,roundTarget:n,stages:a,stage:o}){if(!t)return{error:Ji};let s={},c=[];for(let u of t.events||[]){let{structures:t,stageStructures:l}=jb({withStageGrouping:e,stageSequences:r,stageSequence:i,roundTarget:n,stages:a,event:u,stage:o});if(t&&c.push(...t),l)for(let e of Object.keys(l))s[e]||(s[e]=[]),s[e].push(...l[e])}return{structures:c,stageStructures:s}}function Wb(e){if(!e?.drawDefinition)return!1;let t=Ty(e),r=t?.includesTeamMatchUps,{completedMatchUps:i,pendingMatchUps:n,upcomingMatchUps:a}=t||{};return r&&(i=i?.filter(({matchUpType:e})=>e===Yr),n=n?.filter(({matchUpType:e})=>e===Yr),a=a?.filter(({matchUpType:e})=>e===Yr)),!(!i?.length||n?.length||a?.length)}function qb(e){let{drawDefinition:t,structureId:r}=e;if(!t)return{error:rn};let{playoffStructures:i}=Vb({drawDefinition:t,structureId:r});if(!i?.length)return!1;let n=t?.entries?.filter(e=>e?.entryStatus&&wg.includes(e.entryStatus))?.length??0,a=0;return(i||[]).reduce((e,t)=>!(!(Pf({structure:t}).positionAssignments??[])?.filter(e=>(e.participantId&&a++,e?.bye??e?.participantId)).length||!e),!!i.length)||a===n}function Hb({significantCharacters:e,accessors:t=[],value:r}){let i=[],n=t[0];if(r?.[n]){let a=t.slice(1);if(Array.isArray(r[n]))r[n].forEach(t=>{let r=Hb({accessors:a,significantCharacters:e,value:t});i.push(...r)});else if(r=r[n],a.length){let t=Hb({accessors:a,significantCharacters:e,value:r});i.push(...t)}else!function({value:t}){if(t&&["string","number"].includes(typeof t)){let r=e?t.slice(0,e):t;i.push(r)}}({value:r})}return i}function zb({policyAttributes:e,idCollections:t,participants:r,participant:i}){if(!Array.isArray(e))return{error:ya};if(!i)return{error:Qa};let n=[];return e.forEach(e=>{let{directive:a,groupings:o,key:s,significantCharacters:c}=e||{};if(s){let e=s.split(".");n.push(...Hb({significantCharacters:c,value:i,accessors:e}))}else if(a){let o=e?.includeIds,s=(t?.[a]||[]).filter(e=>!o||o.includes(e));s?.length&&r?.length&&s.forEach(e=>{let t=r.find(t=>t.participantId===e);if(t?.individualParticipantIds?.includes(i.participantId)){let e=t?.participantId;n.push(e)}})}else o&&Object.keys(o).forEach(e=>{o[e].includes(i.participantId)&&n.push(e)})}),{values:vi(n)}}function Yb({candidatePositionAssignments:e,participantsWithGroupings:t,policyAttributes:r,idCollections:i}){let n=Object.assign({},...t.map(e=>({[e.participantId]:e})));return e.map(e=>{let a=n[e.participantId],{values:o}=zb({participants:t,policyAttributes:r,idCollections:i,participant:a});return{...e,values:o}})}function Kb({participantIdGroups:e,positionAssignments:t,groupsToAvoid:r}){return Object.assign({},...t.filter(e=>e?.participantId).map(t=>{let{drawPosition:i,participantId:n}=t,a=e&&e[n]||[],o=!!r.some(e=>a.includes(e));return{[i]:{participantGroups:a,includesGroupsToAvoid:o}}}))}function Xb(e){let{unfilledPositions:t,chunkedDrawPositions:r}=e,i=Kb(e);return r.map(e=>{let r=t.filter(t=>e.includes(t)),n=function(e){return e.filter(e=>!t(e));function t(t){let r=Qb(t);return!e.includes(r)}}(r),a=r.filter(e=>!n.includes(e)).filter(e=>{let t=Qb(e);return!i[t]?.includesGroupsToAvoid});return{unassigned:r,unpaired:n,pairedNoConflict:a}})}function Qb(e){return Number(e%2?e+1:e-1)}function Jb({selectedParticipantGroups:e,participantIdGroups:t,positionAssignments:r,drawPositionChunks:i,unfilledPositions:n,isRoundRobin:a}){let o=i.map(i=>a?function(e){let{unfilledPositions:t,chunkedDrawPositions:r}=e,i=Kb(e);return r.map(e=>{let r=t.filter(t=>e.includes(t)),n=r.length===e.length?r:[],a=e.filter(e=>i[e]?.includesGroupsToAvoid).length;return{unassigned:r,unpaired:n,pairedNoConflict:a?[]:r,conflictsCount:a}})}({groupsToAvoid:e,chunkedDrawPositions:i,participantIdGroups:t,positionAssignments:r,unfilledPositions:n}):Xb({groupsToAvoid:e,chunkedDrawPositions:i,participantIdGroups:t,positionAssignments:r,unfilledPositions:n}));if(a){return{unassigned:o.map(e=>e.map(e=>e.unassigned).filter(e=>e?.length)).filter(e=>e?.length).sort((e,t)=>(t.length||0)-(e.length||0)),unpaired:o.map(e=>e.map(e=>e.unpaired).filter(e=>e?.length)).filter(e=>e?.length),pairedNoConflict:o.map(e=>e.map(e=>e.pairedNoConflict).filter(e=>e?.length)).filter(e=>e?.length).sort((e,t)=>(t.length||0)-(e.length||0))}}return{unassigned:o.map(e=>e.map(e=>e.unassigned).filter(e=>e?.length)).filter(e=>e?.length),unpaired:o.map(e=>e.map(e=>e.unpaired).filter(e=>e?.length)).filter(e=>e?.length),pairedNoConflict:o.map(e=>e.map(e=>e.pairedNoConflict).filter(e=>e?.length)).filter(e=>e?.length)}}function Zb({positionAssignments:e,participantIds:t}){let r=e.map(e=>e.participantId);return t.filter(e=>!r.includes(e))}function eU({candidatePositionAssignments:e,unseededParticipantIds:t,participantIdGroups:r,drawPositionChunks:i,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let c,u=n.reduce((e,t)=>t.length>e?t.length:e,0)<=2,l=Zb({positionAssignments:e,participantIds:t}),d=function({drawPositionGroups:e,positionAssignments:t}){let r=Object.assign({},...t.map(e=>({[e.drawPosition]:e})));return e.map(e=>e.filter(Boolean).map(e=>r[e]).filter(Boolean).filter(e=>!e.participantId&&!e.bye).map(e=>e.drawPosition)).flat().filter(Boolean)}({positionAssignments:e,drawPositionGroups:n}),{participantId:p,groupKey:m}=function({useSpecifiedGroupKey:e=!1,targetParticipantIds:t,largestFirst:r=!0,allGroups:i,groupKey:n}){let a=Object.assign({},...Object.keys(i).map(e=>[e,i[e].filter(e=>t.includes(e))]).filter(e=>e[1].length).map(([e,t])=>({[e]:t}))),o=Object.keys(a).reduce((e,t)=>a[t].length>e?a[t].length:e,0),s=Object.keys(a).filter(e=>a[e].length===o),c=Mi(r?s:Object.keys(a));return{participantId:(n=e&&a[n]?.length?n:c)&&a[n]?Mi(a[n]):Mi(t),groupKey:n}}({targetParticipantIds:l,useSpecifiedGroupKey:u,allGroups:o,groupKey:s}),f=function({allGroups:e,participantId:t}){return Object.keys(e).filter(r=>e[r].includes(t))}({participantId:p,allGroups:o}),h=Jb({positionAssignments:e,isRoundRobin:u,selectedParticipantGroups:f,participantIdGroups:r,drawPositionChunks:i,unfilledPositions:d}),{unassigned:g,unpaired:I,pairedNoConflict:y}=h,v=y?.length&&y[0],S=I?.length&&I[0],b=a&&v?v:S,U=a?S:v,w=b?.length&&b||U?.length&&U;if(w?.length){let e=Ei(w);c=Ei(e)}else{let e=Ei(g[0]);c=Ei(e)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:c}}function tU({isRoundRobin:e,groupedParticipants:t}){let r=[];return e?t.forEach(e=>{let t=ib({drawPositions:e.map(e=>e.drawPosition)}).uniqueMatchUpGroupings??[],i=Object.assign({},...e.map(e=>({[e.drawPosition]:e})));t.forEach(t=>{xi(i[t[0]].values||[],i[t[1]].values||[])&&(r.push(t),e.conflict=!0)})}):t.forEach(e=>{xi(e[0]?.values||[],e[1]?.values||[])&&(r.push(e),e.conflict=!0)}),r}function rU(e,t){return e.find(e=>e.drawPosition===t)}function iU({positionedParticipants:e,potentialDrawPositions:t,drawPositionGroups:r,avoidanceConflicts:i,isRoundRobin:n}){return i.flatMap(i=>{let a=i.map(e=>e.drawPosition);return i.filter(e=>t.includes(e.drawPosition)).map(i=>{let o=t.filter(e=>!a?.includes(e)).filter(t=>function({moveableParticipant:e,possibleDrawPosition:t,positionedParticipants:r,drawPositionGroups:i,isRoundRobin:n,getAvoidanceConflicts:a}){let o=function(e,t){let r=e.find(e=>e.includes(t));if(r)return r.find(e=>e!==t)}(i,t),s=rU(r,o),c=a({isRoundRobin:n,groupedParticipants:[[e,s]]}),u=a({isRoundRobin:n,groupedParticipants:[[rU(r,t),s]]});return!c.length&&!u.length}({moveableParticipant:i,possibleDrawPosition:t,positionedParticipants:e,drawPositionGroups:r,isRoundRobin:n,getAvoidanceConflicts:tU}));if(o.length)return{drawPosition:i.drawPosition,possibleDrawPositions:o}}).filter(Boolean)})}function nU(e){let t,{initialPositionAssignments:r,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:a,drawPositionGroups:o,policyAttributes:s,idCollections:c,allGroups:u}=e,l=[],d=Math.min(...(o||[]).map(e=>e?.length).filter(Boolean)),p=d>2,m=Nu(r,!1,!0).filter(e=>!e.qualifier),f=r.filter(e=>!e.participantId&&(!e.bye||a?.includes(e.drawPosition))).map(e=>e.drawPosition);Ri(0,n).forEach(()=>{let{newGroupKey:r,selectedParticipantId:i,targetDrawPosition:n}=eU({...e,candidatePositionAssignments:m,allGroups:u,groupKey:t});t=r,m.forEach(e=>{e.drawPosition===n&&(e.participantId=i)})});let h=Yb({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:s,idCollections:c}),g=_i(h,d),I=tU({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&I.length;){let e=iU({positionedParticipants:h,potentialDrawPositions:f,avoidanceConflicts:I,drawPositionGroups:o,isRoundRobin:p});if(e.length){let t=aU({candidatePositionAssignments:m,swapOptions:e});t.error&&console.log({result:t}),h=Yb({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:s,idCollections:c}),g=_i(h,d),I=tU({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return m.forEach(e=>{if(e.bye&&e.participantId){let e=Mn;l.push(e)}if(e.qualifier&&e.participantId){let e=Mn;l.push(e)}}),{positionAssignments:m,conflicts:I.length,groupedParticipants:g,errors:l}}function aU({candidatePositionAssignments:e,swapOptions:t}){let r=Ei(t);if(!r)return{error:{message:"No swap options"}};let i=r.drawPosition,n=Ei(r.possibleDrawPositions),a=e.find(e=>e.drawPosition===i),o=e.find(e=>e.drawPosition===n)??{},s={participantId:o?.participantId,qualifier:o?.qualifier,bye:o?.bye},c={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,c),{...Gi}}function oU({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:r,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,avoidance:l,drawSize:d,event:p}){if(!l)return{error:Ia};let{candidatesCount:m=1,policyAttributes:f,targetDivisions:h}=l,{roundsToSeparate:g}=l,I="randomUnseededSeparation",{structure:y}=wf({drawDefinition:a,structureId:u}),{matchUps:v}=Uy({provisionalPositioning:e,matchUpsMap:c,structure:y,event:p});if(h&&ci(h)&&!g){let e=function(e){if(1===e||Number.isNaN(Number(e))||!ci(e))return!1;let t=e,r=1;for(;2!==t;)r+=1,t/=2;return r}(h)||0,t=v.reduce((e,t)=>t.roundNumber>e?t.roundNumber:e,0);g=t<e?1:t-e+1}let{positionAssignments:S}=Nf({structure:y}),b=Mh({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,U=S?.filter(e=>!e.participantId),w=S?.map(e=>e.drawPosition),T=y?.structureType===Wl,D=T?{structure:y,matchUps:v,allDrawPositions:w,roundsToSeparate:g}:{matchUps:v,allDrawPositions:w,roundsToSeparate:g},{drawPositionGroups:P,drawPositionChunks:N}=T?function(e){let{structure:{structures:t}}=e,r=t.map(e=>e.positionAssignments.map(e=>e.drawPosition));return{drawPositionGroups:r,drawPositionChunks:[r]}}(D):function({allDrawPositions:e,roundsToSeparate:t,matchUps:r}){let i=r.filter(e=>1===e.roundNumber).map(e=>e.drawPositions),n=i.flat().sort(Qr),a=Math.max(...n),o=e.filter(e=>e>a),s=n.length,c=Ri(2===s?1:2,s).filter(e=>e===di(e)),u=c.slice(0,t||c.length).reverse().map(e=>_i(n,e));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:i,drawPositionChunks:u}}(D),E={groupParticipants:s.filter(e=>e.participantType===Th).map(e=>e.participantId),teamParticipants:s.filter(e=>e.participantType===Ph).map(e=>e.participantId),pairParticipants:s.filter(e=>e.participantType===Dh).map(e=>e.participantId)},M=function({targetParticipantIds:e,policyAttributes:t,idCollections:r,participants:i}){if(!Array.isArray(t))return{error:ya};if(!Array.isArray(i))return{error:Ja};let n={};return e.forEach(e=>{let a=i.find(t=>t.participantId===e),{values:o}=zb({policyAttributes:t,idCollections:r,participants:i,participant:a});o&&o.forEach(t=>{n[t]||(n[t]=[]),n[t].includes(e)||n[t].push(e)})}),n}({targetParticipantIds:t,policyAttributes:f,idCollections:E,participants:s});if(M.error)return ac({result:M,stack:I});let R=Object.assign({},...t.map(e=>{let t=Object.keys(M).filter(t=>(M[t]??[]).includes(e));return{[e]:t}})),A=Zb({participantIds:t,positionAssignments:S});if(A.length>(U?.length||0))return{error:So};let C,k=A.length,x=Ri(0,m).map(()=>nU({initialPositionAssignments:S,participantsWithGroupings:b,unseededParticipantIds:t,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:i,participantIdGroups:R,drawPositionChunks:N,drawPositionGroups:P,policyAttributes:f,idCollections:E,allGroups:M,drawSize:d}));if(C=x.reduce((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e,void 0),!C||C.conflicts){let e=Ri(0,m).map(()=>nU({initialPositionAssignments:S,participantsWithGroupings:b,unseededParticipantIds:t,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:i,participantIdGroups:R,drawPositionChunks:N,drawPositionGroups:P,policyAttributes:f,idCollections:E,allGroups:M,drawSize:d}));C=x.concat(...e).filter(e=>!e.errors?.length).reduce((e,t)=>!e||(t.conflicts||0)<(e.conflicts||0)?t:e,void 0)}if(!C)return{error:zo};let O=(Pf({structure:y})?.positionAssignments??[]).filter(e=>e.participantId).map(e=>e.participantId),F=C.positionAssignments.filter(e=>!O.includes(e.participantId));for(let _ of F)if(_.bye){let e=iv({tournamentRecord:n,drawDefinition:a,structureId:u,matchUpsMap:c,event:p,..._});if(e.error)return ac({result:e,stack:I})}else if(_.participantId){let e=Cb({inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:c,event:p,..._});if(e.error)return ac({result:e,stack:I,context:{assignment:_}})}return{...Gi}}function sU({provisionalPositioning:e,inContextDrawMatchUps:t,unseededByePositions:r,multipleStructures:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,structure:l,drawSize:d,event:p}){l||({structure:l}=wf({drawDefinition:a,structureId:u})),u||({structureId:u}=l);let{positionAssignments:m}=Nf({structure:l}),{seedAssignments:f}=Mg({provisionalPositioning:e,drawDefinition:a,structure:l}),h=f?.map(e=>e.participantId).filter(Boolean),{stage:g,stageSequence:I}=l,y=g===Ml?lm({element:l,name:Nm})?.extension?.value:void 0,v=Eg({provisionalPositioning:e,drawDefinition:a,stageSequence:I,entryStatuses:Ug,structureId:u,roundTarget:y,stage:g}),S=v.filter(e=>!h?.includes(e.participantId)).map(e=>e.participantId),b=m?.filter(e=>!e.participantId&&!e.bye&&!e.qualifier).map(e=>e.drawPosition);if(!i&&S.length>(b?.length||0))return ac({result:{error:So},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:b?.length},stack:"positionUnseededParticipants"});let{appliedPolicies:U}=zh({tournamentRecord:n,drawDefinition:a,event:p}),w=U?.[qp];if(l.stage===Cl){let e=v.reduce((e,t)=>(e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e),{});Object.keys(e).length&&(w||(w={policyName:"Playoff Avoidance"}),w.policyAttributes||(w.policyAttributes=[]),w.policyAttributes.push({groupings:e}))}return w&&s?oU({provisionalPositioning:e,unseededParticipantIds:S,inContextDrawMatchUps:t,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:u,avoidance:w,drawSize:d}):function({provisionalPositioning:e,unseededParticipantIds:t,inContextDrawMatchUps:r,unfilledDrawPositions:i,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:c,structureId:u,drawSize:l,event:d}){let p=l>2?bi(i):i.reverse();for(let m of t){let t=p.pop();if(!n||t){let i=Cb({provisionalPositioning:e,inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:t,matchUpsMap:c,structureId:u,event:d});if(i?.error&&console.log("!!!!!",{result:i}),i?.error)return ac({result:i,stack:"randomUnseededDistribution"})}}return{...Gi}}({provisionalPositioning:e,unseededParticipantIds:S,inContextDrawMatchUps:t,unfilledDrawPositions:b,multipleStructures:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:u,matchUpsMap:c,drawSize:d,event:p})}function cU(e){let t=e.structure??wf(e).structure,r="positionQualifiers",i=[];if(t.stage===Rl)return ac({result:{error:Kn},stack:r});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=function({drawDefinition:e,structure:t,structureId:r}){t||({structure:t}=wf({drawDefinition:e,structureId:r})),r||({structureId:r}=t);let{positionAssignments:i}=Nf({structure:t}),{stage:n,stageSequence:a}=t,{qualifiersCount:o,roundQualifiersCounts:s}=SS({drawDefinition:e,stageSequence:a,structureId:r,stage:n}),c=(s?Object.keys(s):[]).map(e=>Jr(e)),{matchUps:u}=Uy({structure:t}),{roundProfile:l}=Lg({matchUps:u}),d=Object.assign({},...c.filter(e=>l?.[e]).map(e=>({[e]:l?.[e]?.drawPositions?.filter(Boolean)??[]}))),p=i?.filter(e=>e.qualifier).map(e=>e.drawPosition),m=o-(p?.length??0),f=p?.length;return{unplacedRoundQualifierCounts:Object.assign({},...c.map(e=>{let t=i?.filter(t=>t.qualifier&&d[e]?.drawPositions?.includes(t.drawPosition)).map(e=>e.drawPosition);return{[e]:(s?.[e]??0)-(t?.length??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:i,roundDrawPositions:d,qualifiersCount:o}}(e);for(let s of Object.keys(n)){let e=a?.filter(e=>o[s].includes(e.drawPosition)&&!e.participantId&&!e.qualifier&&!e.bye).map(e=>e.drawPosition);if(n[s]>(e||0))return ac({result:{error:vo},context:{unfilledDrawPositions:e},stack:r});Ri(0,n[s]).forEach(()=>{let t=Ei(e);i.push(t),a?.forEach(e=>{e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)})})}return{...Gi,qualifierDrawPositions:i}}function uU({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:r,appliedPolicies:i,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:c,groupsCount:u,structureId:l,matchUpsMap:d,structure:p,event:m}){let f=[],h=[],g=0;if(p||({structure:p}=wf({drawDefinition:a,structureId:l})),l||(l=p?.structureId),i||(i=zh({drawDefinition:a}).appliedPolicies),!n){let t=p&&mb({provisionalPositioning:e,appliedPolicies:i,drawDefinition:a,seedingProfile:o,structure:p});t?.error&&h.push(t.error),n=t?.validSeedBlocks}return Ri(0,u=u??n?.length??0).forEach(()=>{if(g<(u||0)){let i=function({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:c,event:u}){let{unplacedSeedParticipantIds:l,unfilledPositions:d}=Ib({provisionalPositioning:e,randomize:!0,drawDefinition:i,seedingProfile:n,seedBlockInfo:a,structureId:s}),{appliedPolicies:p}=zh({drawDefinition:i}),{avoidance:m}=p??{};let f=[];for(let h of l){let o=d.pop();if(!o)return{error:yn};f.push(o);let l=Cb({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,seedingProfile:n,participantId:h,seedBlockInfo:a,drawPosition:o,matchUpsMap:c,structureId:s,event:u});if(!l.success)return l}return{...Gi,seedPositions:f}}({provisionalPositioning:e,inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:c,structureId:l,matchUpsMap:d,event:m});i?.success&&(g++,f.push(...i.seedPositions??[])),i.error&&h.push({seedPositionError:i.error})}}),h.length?{error:h}:{...Gi,seedPositions:f}}function lU({orderedSortedFirstRoundSeededDrawPositions:e,validSeedBlocks:t,byesToPlace:r}){let i=[];t.forEach(t=>function(e,t,r,i){if(t-r.length>e.drawPositions.length)r.push(...e.drawPositions);else{!function(e,t,r){let i,n=r[t.length];for(;i=dU(e,n);)t.push(i),n=r[t.length]}(pU(_i(e.drawPositions,2)),r,i)}}(t,r,i,e));let n=i.map(e=>Array.isArray(e)?bi(e):e).flat(1/0);return mi(r)&&t.map(e=>e.seedNumbers[0]).includes(r)?e:n}function dU(e,t){return Array.isArray(e)&&2!==e.length?e.pop():Array.isArray(e[0])?function(e,t){let r=e[0].flat(1/0).length,i=e[1].flat(1/0).length;if(r===i){let r=e[0].flat(1/0).includes(t)?e[0]:e[1];return dU(t?r:e[Math.round(Math.random())],t)}return dU(r<i?e[1]:e[0],t)}(e,t):function(e,t){return e.includes(t)?e.indexOf(t)?e.pop():e.shift():Math.round(Math.random())?e.pop():e.shift()}(e,t)}function pU(e){let t=Math.floor(e.length/2);return e.length>2?[pU(e.slice(0,t)),pU(e.slice(t))]:e}function mU({provisionalPositioning:e,relevantMatchUps:t,appliedPolicies:r,drawDefinition:i,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){a||(a=mb({provisionalPositioning:e,appliedPolicies:r,drawDefinition:i,seedingProfile:n,structure:s}));let{isFeedIn:c,isLuckyStructure:u,isContainer:l}=a,{validSeedBlocks:d}=a;r?.seeding?.containerByesIgnoreSeeding&&(d=[]);let p=function({provisionalPositioning:e,drawDefinition:t,structure:r}){let{positionAssignments:i}=Nf({structure:r}),{seedAssignments:n}=Mg({provisionalPositioning:e,drawDefinition:t,structure:r}),a=Object.assign({},...(n||[]).filter(e=>e.participantId).map(e=>({[e.participantId]:e})));return i?.map(e=>a[e.participantId]?{...e,seedNumber:a[e.participantId].seedNumber,seedValue:a[e.participantId].seedValue}:"").filter(Boolean)}({provisionalPositioning:e,drawDefinition:i,structure:s})??[],m=vi([].concat(...t.map(e=>e.drawPositions))),f=p.filter(e=>m.includes(e.drawPosition)),h=(e,t)=>pb(e.seedValue)-pb(t.seedValue),g=d.reduce((e,t)=>{let r=f.filter(e=>t.drawPositions?.includes(e.drawPosition)).sort(h);return e.concat(...r)},[]).map(e=>e.drawPosition),I=lU({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:o});return{strictSeedOrderByePositions:fU({orderedSeedDrawPositions:g,relevantMatchUps:t}).slice(0,o),blockSeedOrderByePositions:fU({orderedSeedDrawPositions:I,relevantMatchUps:t}).slice(0,o),isLuckyStructure:u,positionedSeeds:p,isContainer:l,isFeedIn:c}}function fU({orderedSeedDrawPositions:e,relevantMatchUps:t}){let r=t.map(e=>e.drawPositions).map(e=>e?.sort((e,t)=>e-t)).filter(e=>e?.[0]+1===e?.[1]);return e.map(e=>r.find(t=>t?.includes(e))).filter(Boolean).map(t=>t?.reduce((t,r)=>e.includes(r)?t:r,void 0)).filter(Boolean)}function hU({provisionalPositioning:e,tournamentRecord:t,appliedPolicies:r,drawDefinition:i,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:c,seedLimit:u,seedsOnly:l,event:d}){c||({structure:c}=wf({drawDefinition:i,structureId:s})),s||(s=c?.structureId);let p=!(c?.structures??c?.stage===Ml),{byesCount:m,placedByes:f,relevantMatchUps:h}=function({provisionalPositioning:e,drawDefinition:t,matchUpsMap:r,structure:i,event:n}){let{matchUps:a,roundMatchUps:o}=Uy({afterRecoveryTimes:!1,provisionalPositioning:e,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:i,event:n}),s=o?.[1]||[],c=i?.structureType===Wl,u=c?a:s,l=c?i?.structures?.length||0:a.length,{structureId:d,stage:p,stageSequence:m}=i,f=Eg({entryStatuses:wg,provisionalPositioning:e,drawDefinition:t,stageSequence:m,structureId:d,stage:p}),{qualifiersCount:h}=SS({provisionalPositioning:e,drawDefinition:t,stageSequence:m,structureId:d,stage:p}),g=f.length+h,{positionAssignments:I,unassignedPositions:y}=Nf({structure:i}),v=y?.map(e=>e.drawPosition),S=I?.filter(e=>e.bye).length,b=I?.filter(e=>e.bye).map(e=>e.drawPosition),U=u.map(e=>e.drawPositions).filter(e=>e?.reduce((e,t)=>!b?.includes(t)&&e,!0)).flat(1/0).filter(e=>v?.includes(e)),w=I?.length,T=w?w-g:0;return T>l&&1===i.stageSequence&&i.stage!==Rl&&(T=l),{placedByes:S,byesCount:T,relevantMatchUps:u,placedByePositions:b,roundMatchUps:o,positionsToAvoidDoubleBye:U}}({provisionalPositioning:e,drawDefinition:i,matchUpsMap:o,structure:c,event:d}),g=m-(f||0);if(g<=0)return{...Gi};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:y,isLuckyStructure:v,isFeedIn:S}=mU({provisionalPositioning:e,relevantMatchUps:h,appliedPolicies:r,drawDefinition:i,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:c}),b=c?.structureType&&[Wl,Gl].includes(c.structureType)&&r?.seeding?.containerByesIgnoreSeeding,U=p&&y?.length?y:I,{unseededByePositions:w}=function({provisionalPositioning:e,seedOrderByePositions:t,isLuckyStructure:r,appliedPolicies:i,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){let c,u=i?.seeding?.seedingProfile,l=o.stage===Ml,{positionAssignments:d}=Nf({structure:o}),p=d?.filter(e=>e.participantId).map(e=>e.drawPosition),{matchUps:m,roundMatchUps:f}=Uy({provisionalPositioning:e,matchUpFilters:{isCollectionMatchUp:!1},structure:o}),h=f?.[1]||[],g=o.structureType===Wl?m:h,I=vi([].concat(...g.map(e=>e.drawPositions))),y=Math.min(...I)-1,v=p?.filter(e=>I.includes(e)),S=e=>{let t=Math.ceil(e.length/2),r=[e.slice(0,t),e.slice(t)],i=r.map(e=>[].concat(...e.flat(1/0)).length),n=Math.min(...i.flat(1/0)),a=Math.max(...i.flat(1/0)),o=i.indexOf(a),s=n!==a,c=bi(r),[u,l]=!n||s?[r[o],r[1-o]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:l}},b=e=>{let{greaterHalf:t,lesserHalf:r}=S(e),{greaterHalf:i,lesserHalf:n}=S(t),a=bi(i.flat(1/0)).pop();return{newlyFilteredChunks:[...r,...n,i.flat().filter(e=>e!==a)],drawPosition:a}},U=e=>!v?.includes(e),w=e=>{let t=_i(e.sort(Qr),Math.ceil(e.length/4)).map(e=>e.filter(U)),r=[].concat(...t.flat(1/0)).length,i=[];for(let n=0;n<r;n++){let{newlyFilteredChunks:e,drawPosition:r}=b(t);i.push(r),t=e}return i},{validSeedBlocks:T}=mb({provisionalPositioning:e,allPositions:!0,appliedPolicies:i,drawDefinition:n,structure:o}),D=T?.map(e=>e.drawPositions?.map(e=>e+y));if(s){let e=I.length,{seedBlocks:t}=ub({cluster:[Bl,$l].includes(yb(u)),participantsCount:e});c=t.map(e=>e.map(e=>e+y)).map(w).filter(e=>e.length)}else c=l?D?.map(e=>e.filter(U)):D?.map(w).filter(e=>e.length);let P=g.map(e=>e.drawPositions).map(e=>e?.sort((e,t)=>e-t)).filter(e=>e?.[0]+1===e?.[1]),N=e=>P.reduce((t,r)=>r.includes(e)?r.reduce((t,r)=>r!==e?r:t,void 0):t,void 0),E=c.map(e=>e.map(N)).flat(1/0).filter(U).filter(e=>!t.includes(e)).filter(Boolean);if(l&&!o.structures){let e=a%4,t=E.slice(0,e),r=f[o.roundLimit]?.length,i=_i(E.slice(e),r).map(bi).flat();E=t.concat(i)}return{unseededByePositions:E}}({provisionalPositioning:e,seedOrderByePositions:U,isLuckyStructure:v,appliedPolicies:r,drawDefinition:i,seedLimit:u,structure:c,isFeedIn:S}),T=(e,t)=>(e||[]).every(e=>(e=>e%2)(e)?t!==e+1:t!==e-1),D=[].concat(...U);if(!l)for(;w.length;){let e=w.find(e=>T(D,e));e?(D.push(e),w=w.filter(t=>t!==e)):(D.push(...w),w=[])}b&&(D=bi(D),Ps({ignoreSeededByes:b})&&console.log({byePositions:D}));let P=D.slice(0,g);for(let N of P){let r=iv({provisionalPositioning:e,tournamentRecord:t,drawDefinition:i,drawPosition:N,matchUpsMap:o,structureId:s,structure:c,event:d});if(r?.error)return r}return{...Gi,unseededByePositions:w,byeDrawPositions:P}}function gU(e,t){return t||As(),ac({result:e,stack:"automatedPositioning"})}function IU(e){let{drawDefinition:t}=e,{applyPositioning:r=!0,provisionalPositioning:i,multipleStructures:n,placeByes:a=!0,tournamentRecord:o,seedingProfile:s,structureId:c,seedLimit:u,seedsOnly:l,drawType:d,drawSize:p,event:m}=e,f=[];r||(Rs(),t=Nu(t,!1,!0));let{structure:h,appliedPolicies:g,qualifiersCount:I,entries:y,error:v}=function(e,t,r,i){let n=wf({drawDefinition:t,structureId:r});if(n.error)return{error:n.error};let a=n.structure;if(!a)return{error:Fn};let o=e.appliedPolicies||zh({drawDefinition:t,structure:a,event:i})?.appliedPolicies,{qualifiersCount:s}=SS({stageSequence:a.stageSequence,provisionalPositioning:e.provisionalPositioning,stage:a.stage,drawDefinition:t,structureId:r}),c=Ug;return{structure:a,appliedPolicies:o,qualifiersCount:s,entries:Eg({stageSequence:a.stageSequence,provisionalPositioning:e.provisionalPositioning,stage:a.stage,placementGroup:e.placementGroup,drawDefinition:t,entryStatuses:c,structureId:r})}}(e,t,c,m);if(v)return gU(v,r);if(!y?.length&&!I)return function(e,t){return t||As(),e}({...Gi},r);let S=e.matchUpsMap??kg({drawDefinition:t}),b=e.inContextDrawMatchUps??Cy({inContext:!0,drawDefinition:t,matchUpsMap:S})?.matchUps,U=mb({provisionalPositioning:i,appliedPolicies:g,drawDefinition:t,seedingProfile:s,structure:h});if(U.error)return gU(U,r);let{validSeedBlocks:w}=U;f.push({validSeedBlocks:w});let T,D=e.participants||(o?mS({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o})?.participants:[]);if(yb(h.seedingProfile||s)===jl){let e=function({placeByes:e,provisionalPositioning:t,tournamentRecord:r,appliedPolicies:i,drawDefinition:n,seedBlockInfo:a,matchUpsMap:o,structure:s,seedLimit:c,seedsOnly:u,event:l,structureSeedingProfile:d,seedingProfile:p,inContextDrawMatchUps:m,participants:f,positioningReport:h}){let g=e?hU({provisionalPositioning:t,tournamentRecord:r,appliedPolicies:i,drawDefinition:n,seedBlockInfo:a,matchUpsMap:o,structure:s,seedLimit:c,seedsOnly:u,event:l}):void 0;if(g?.error)return{error:g.error};let I=g?.unseededByePositions;return h.push({action:"positionByes",unseededByePositions:I}),g=uU({seedingProfile:d?{positioning:d}:p,provisionalPositioning:t,inContextDrawMatchUps:m,tournamentRecord:r,appliedPolicies:i,validSeedBlocks:a.validSeedBlocks,drawDefinition:n,seedBlockInfo:a,participants:f,matchUpsMap:o,structure:s,event:l}),g.error?{error:g.error}:(h.push({seedPositions:g.seedPositions,action:"positionSeedBlocks"}),{unseededByePositions:I})}({placeByes:a,provisionalPositioning:i,tournamentRecord:o,appliedPolicies:g,drawDefinition:t,seedBlockInfo:U,matchUpsMap:S,structure:h,seedLimit:u,seedsOnly:l,event:m,structureSeedingProfile:h.seedingProfile,seedingProfile:s,inContextDrawMatchUps:b,participants:D,positioningReport:f});if(e?.error)return gU(e.error,r);T=e.unseededByePositions}else{let e=function({drawType:e,LUCKY_DRAW:t,structureSeedingProfile:r,seedingProfile:i,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:o,appliedPolicies:s,validSeedBlocks:c,drawDefinition:u,seedBlockInfo:l,participants:d,matchUpsMap:p,structure:m,event:f,placeByes:h,seedLimit:g,seedsOnly:I,positioningReport:y}){let v;if(e!==t){let e=uU({seedingProfile:r?{positioning:r}:i,provisionalPositioning:n,inContextDrawMatchUps:a,tournamentRecord:o,appliedPolicies:s,validSeedBlocks:c,drawDefinition:u,seedBlockInfo:l,participants:d,matchUpsMap:p,structure:m,event:f});if(e.error)return{error:e.error};y.push({action:"positionSeedBlocks",seedPositions:e.seedPositions})}let S=h?hU({provisionalPositioning:n,tournamentRecord:o,appliedPolicies:s,drawDefinition:u,seedBlockInfo:l,matchUpsMap:p,structure:m,seedLimit:g,seedsOnly:I,event:f}):void 0;return S?.error?{error:S.error}:(v=S?.unseededByePositions,y.push({action:"positionByes",byeDrawPositions:S?.byeDrawPositions,unseededByePositions:v}),{unseededByePositions:v})}({drawType:d,LUCKY_DRAW:sd,structureSeedingProfile:h.seedingProfile,seedingProfile:s,provisionalPositioning:i,inContextDrawMatchUps:b,tournamentRecord:o,appliedPolicies:g,validSeedBlocks:w,drawDefinition:t,seedBlockInfo:U,participants:D,matchUpsMap:S,structure:h,event:m,placeByes:a,seedLimit:u,seedsOnly:l,positioningReport:f});if(e?.error)return gU(e.error,r);T=e.unseededByePositions}let P={},N=function({seedsOnly:e,inContextDrawMatchUps:t,tournamentRecord:r,appliedPolicies:i,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structure:u,positionQualifiers:l,positionUnseededParticipants:d,provisionalPositioning:p,unseededByePositions:m,multipleStructures:f,structureId:h,drawSize:g,event:I,positioningReport:y,conflicts:v}){if(e)return{};let S=l({inContextDrawMatchUps:t,tournamentRecord:r,appliedPolicies:i,validSeedBlocks:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structure:u});return S.error?{error:S.error}:(S.conflicts&&(v.qualifierConflicts=S.conflicts),y.push({action:"positionQualifiers",qualifierDrawPositions:S.qualifierDrawPositions}),S=d({provisionalPositioning:p,inContextDrawMatchUps:t,unseededByePositions:m,multipleStructures:f,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:c,structureId:h,structure:u,drawSize:g,event:I}),S.error?{error:S.error}:(S.conflicts&&(v.unseededConflicts=S.conflicts),y.push({action:"positionUnseededParticipants"}),{}))}({seedsOnly:l,inContextDrawMatchUps:b,tournamentRecord:o,appliedPolicies:g,validSeedBlocks:w,drawDefinition:t,seedBlockInfo:U,participants:D,matchUpsMap:S,structure:h,positionQualifiers:cU,positionUnseededParticipants:sU,provisionalPositioning:i,unseededByePositions:T,multipleStructures:n,structureId:c,drawSize:p,event:m,positioningReport:f,conflicts:P});if(N?.error)return gU(N.error,r);let{positionAssignments:E}=Pf({drawDefinition:t,structure:h});return lh({drawDefinition:t,structureIds:[c]}),r||As(),{positionAssignments:E,conflicts:P,...Gi,positioningReport:f}}function yU(e){let{applyPositioning:t=!0,provisionalPositioning:r,tournamentRecord:i,drawDefinition:n,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:c}=e;if(!n)return{error:an};if(!Wb({drawDefinition:n,structureId:o})&&!r)return{error:sn};let u=Vb({drawDefinition:n,structureId:o}).playoffStructures?.sort((e,t)=>Uf(e)-Uf(t)),l=[],d=[];if(u)for(let p of u){let{structureId:e}=p,o=IU({structureId:e,provisionalPositioning:r,applyPositioning:t,tournamentRecord:i,drawDefinition:n,seedingProfile:a,placeByes:s,seedsOnly:c});if(o.error)return o;o.positionAssignments&&l.push({positionAssignments:o.positionAssignments,structureId:e}),o.positioningReport&&d.push(o.positioningReport)}return{...Gi,structurePositionAssignments:l,positioningReports:d}}function vU({validation:e=!0,tournamentRecord:t,drawDefinition:r,participantId:i,structureId:n,seedValue:a,event:o}){if(!r)return{error:rn};if(!n)return{error:On};let s=(t?.participants??[]).find(e=>e.participantId===i);if(t&&!s)return{error:Ha};let{structure:c}=wf({drawDefinition:r,structureId:n});if(!c)return{error:Fn};if(!(!e||pi(a)||void 0===a||""===a||"string"==typeof a&&a.split("-").every(e=>pi(e)&&Jr(e)>0)))return{error:Zo};let{seedAssignments:u}=Mg({drawDefinition:r,structure:c}),l=u?.map(e=>e.seedNumber),d=u?.find(e=>e.participantId===i);if(d){let e="string"==typeof a?a.includes("-")&&a.split("-").map(e=>parseInt(e)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=e}else{let e={seedNumber:Math.max(0,...l||[])+1,participantId:i};a&&(e.seedValue=a),c.seedAssignments||(c.seedAssignments=[]),c.seedAssignments.push(e)}return dh({tournamentId:t?.tournamentId,eventId:o?.eventId,drawDefinition:r,structure:c}),{...Gi}}function SU({qualifyingParticipantId:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n}){return kb({positionActionName:"qualifierDrawPositionAssignment",participantId:e,isQualifierPosition:!0,tournamentRecord:t,drawDefinition:r,drawPosition:i,structureId:n})}function bU({targetRoundNumber:e,finishingPosition:t,drawDefinition:r,structureId:i,linkType:n}){let{links:a}=Py({drawDefinition:r,structureId:i})||{},o=(a?.target||[]).filter(({linkType:e})=>e===n).filter(({target:t})=>!e||e===t.roundNumber).map(e=>{let i=e.source.structureId,{structure:n}=wf({structureId:i,drawDefinition:r});if(!t||n?.finishingPosition===t)return e}).filter(Boolean);return{sourceStructureIds:o.map(({source:e})=>e.structureId),relevantLinks:o}}function UU({targetRoundNumber:e=1,tournamentRecord:t,drawDefinition:r,event:i,randomList:n}){let a=Dp({drawDefinition:r,event:i,tournamentRecord:t},[{[xd]:!0,[cp]:!0,[Cd]:!0}]);if(a.error)return a;let o=[],s=[],c=r.structures?.find(e=>e.stage===El&&1===e.stageSequence);if(!c)return ac({result:{error:Bn}});let u=(zh({tournamentRecord:t,drawDefinition:r,structure:c,event:i}).appliedPolicies??{})[Lp]?.requireCompletedStructures,{qualifierPositions:l,positionAssignments:d}=Nf({structure:c});if(!l.length)return ac({result:{error:vo}});let p=Ri(0,l.length);n&&(p=((e,t)=>{let r=[...new Set(t.slice(0,e.length))],i=[...r].sort((e,t)=>e-t),n=new Set,a=[];r.forEach(t=>{let r=e.indexOf(t);if(-1===r||n.has(r)){let r=i.indexOf(t),o=e.findIndex((e,t)=>!n.has(t));for(;n.has(o)&&-1===o&&n.size<e.length;)o=e.findIndex((e,t)=>!n.has(t)&&t>o);a.push(r),n.add(r)}else a.push(r),n.add(r)});let o=e.filter((e,t)=>!n.has(t));return[...a,...o]})(p,n));let m=d.map(e=>e.participantId).filter(Boolean),{relevantLinks:f}=bU({structureId:c.structureId,targetRoundNumber:e,linkType:Xl,drawDefinition:r})||{},{relevantLinks:h}=bU({structureId:c.structureId,targetRoundNumber:e,linkType:Kl,drawDefinition:r})||{};for(let g of f){let e=r.structures?.find(e=>e.structureId===g.source.structureId);if(e?.stage!==Ml)continue;let t=Wb({structureId:g.source.structureId,drawDefinition:r});if(!u||t){let t=e.qualifyingRoundNumber,{matchUps:r}=Uy({matchUpFilters:{...t&&{roundNumbers:[t]},isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,inContext:!0,structure:e});for(let e of r){let t="BYE"===e.matchUpStatus&&e.sides?.find(({participantId:e})=>e),r=e.sides.find(t=>t?.sideNumber===e.winningSide);if(r||t){let{participantId:e}=r||t||{};e&&!m.includes(e)&&s.push(e)}}}}for(let g of h){let e=r?.structures?.find(e=>e.structureId===g.source.structureId);if(e?.stage===Ml&&Wb({structureId:g.source.structureId,drawDefinition:r})){let{positionAssignments:t}=Pf({structure:e}),r=t?.map(e=>{let t=e.participantId,r=lm({element:e,name:Cm}).extension?.value;return r?{participantId:t,groupOrder:r?.groupOrder}:{}}).filter(({groupOrder:e,participantId:t})=>1===e&&!m.includes(t)).map(({participantId:e})=>e)??[];r&&s.push(...r)}}return s.length?(p.forEach((e,i)=>{let n=s[i],a=l[e].drawPosition;n&&SU({qualifyingParticipantId:n,structureId:c.structureId,drawPosition:a,tournamentRecord:t,drawDefinition:r})?.success&&o.push({participantId:n,drawPosition:a})}),ac({result:nc({...Gi,assignedParticipants:o})})):ac({result:{error:eo}})}function wU({drawDefinition:e,orderMap:t}){return e?(("object"!=typeof t||!Object.values(t).every(e=>gi(e)))&&ac({result:{error:Zo},context:{orderMap:t}}),e.structures||(e.structures=[]),e.structures.forEach(e=>{let r=t[e.structureId];r&&(e.structureOrder=r)}),e.structures.sort((e,t)=>Ui(e.structureOrder)-Ui(t.structureOrder)),{...Gi}):{error:rn}}function TU({drawDefinition:e}){let t=e.structures??[],r=e.links??[],i=new Map,n=e=>{let r=i.get(e)||i.set(e,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&i.get(e);if(r&&!r?.stage){let i=t.find(t=>t.structureId===e);r.stage=i?.stage}return r},a={},o={},s=r.map(e=>{let t=e.source.structureId,r=e.target.structureId,i=n(t),s=n(r);return[Yl,zl,Hl,jl].includes(e.target.feedProfile)?(i?.targets.push(r),s?.sources.push(t)):e.target.feedProfile===ql&&(s?.drawSources.push(t),i?.drawTargets.push(r)),o[r]=o[r]||e.target.feedProfile===ql,a[r]=vi([...a[r]||[],t]).filter(Boolean),[e.source.structureId,e.target.structureId]});for(let h of i.keys()){let e=i.get(h);if(e){let t=e.targets??[];for(;t.length;){let r=t.pop(),n=r&&i[r];n?.targets?.length?t.push(...n.targets):n&&(e.rootStage=n.stage)}if(e.rootStage||(e.rootStage=e.stage),!e.targets?.length){let t=e.sources??[];for(;t.length;){let r=t.pop(),n=r&&i[r];if(n?.sources?.length){for(let t of n.sources)e.progeny?.includes(t)||e.progeny?.push(t);t.push(...n.sources)}}}}}let c=0;for(let h of i.keys()){let e=i.get(h);if(e&&e.rootStage===Ml){let t=[e.drawTargets?.[0]],r=0;for(;t.length;){r+=1;let e=t.pop(),n=e?i.get(e):void 0;n?.drawTargets?.length&&t.push(n.drawTargets[0])}e.distanceFromMain=r,r>c&&(c=r)}}let u=s.length;Ri(0,Math.ceil(u/2)).forEach(()=>{s=Ri(0,u).map(e=>{let t=s[e],r=s.reduce((e,r)=>xi(t,r)?e.concat(...r):e,[])||[];return vi(t.concat(...r))})});let l=s[0],d=s.slice(1).reduce((e,t)=>e&&((e,t)=>Ci(e,t).length===e.length)(t,l),!0),p=[l].filter(Boolean),m=[l].filter(Boolean);t.forEach(e=>{let{structureId:t,stage:r}=e;p.find(e=>e.includes(t))||(p.push([t]),r!==Al&&m.push([t]))});let f=d&&1===m.length;return!r?.length&&1===t.length&&n(t[0].structureId),{structureProfiles:Object.fromEntries(i),allStructuresLinked:f,maxQualifyingDepth:c,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:p}}function DU({drawDefinition:e}){let{maxQualifyingDepth:t,structureProfiles:r}=TU({drawDefinition:e});for(let i of e.structures){let e=r[i.structureId];e.distanceFromMain&&(i.stageSequence=t+1-e.distanceFromMain)}return{...Gi}}function PU(e){let t=Dp(e,[{[Cd]:!0,[xd]:!0}]);if(t.error)return t;let{tournamentRecord:r,drawDefinition:i,structure:n,link:a}=e;return function(e){let t=Dp(e,[{[xd]:!0,[Jd]:!0},{link:!0,[vp]:fp,[Wi]:kn}]);if(t.error)return t;let{drawDefinition:r,tournamentId:i,structure:n,eventId:a,link:o}=e,s=o.target.structureId,c=wf({drawDefinition:r,structureId:s});if(c.error)return ac({stack:"attachQualifyingStructure",context:{targetStructureId:s},result:c});r.structures||(r.structures=[]),r.links||(r.links=[]),r.structures.push(n),r.links.push(o),DU({drawDefinition:r});let u=Uy({structure:n})?.matchUps||[];return oh({drawDefinition:r,tournamentId:i,matchUps:u,eventId:a}),lh({drawDefinition:r,structureIds:[n.structureId]}),{...Gi}}({tournamentId:r.tournamentId,drawDefinition:i,structure:n,link:a})}function NU({drawDefinition:e,structureDetails:t}){if(!Array.isArray(t))return{error:Zo};if(!e)return{error:rn};let r=Object.assign({},...t.map(e=>{if(!ti(e))return;let{structureId:t,structureName:r}=e||{};return t&&r?{[t]:r}:void 0}).filter(Boolean));if(!Object.values(r).length)return{error:Da};for(let i of e.structures||[]){let e=r[i.structureId];if(e&&(i.structureName=e),i.structures)for(let t of i.structures){let e=r[t.structureId];e&&(t.structureName=e)}}return{...Gi}}function EU({drawDefinition:e,timeItem:t}){if(!e)return{error:an};if(!t)return{error:Bo};let r=t&&Object.keys(t),i=["itemType","itemValue"];if(i.filter(e=>r.includes(e)).length!==i.length)return{error:_o};e.timeItems||(e.timeItems=[]);let n=(new Date).toISOString();return Object.assign(t,{createdAt:n}),e.timeItems.push(t),uh({drawDefinition:e}),{...Gi}}function MU(e){let{tournamentRecord:t,drawDefinition:r,structureId:i,event:n}=e,a=Dp(e,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=r.structures??[],s=o.find(e=>e.structureId===i);if(!s)return{error:Fn};let c=o.find(({stage:e,stageSequence:t})=>e===El&&1===t),u=i===c?.structureId,l=o.filter(({stage:e})=>e===Ml).map(Vy("structureId"));if(u&&!l.length)return{error:Ki};let d=l.includes(i),p=function({isQualifyingStructure:e,tournamentRecord:t,drawDefinition:r,structureId:i,structure:n,event:a,force:o}){let s=[i];if(e){let e=e=>r.links?.find(t=>t.target.structureId===e),t=e(i)?.source.structureId;for(;t;)s.push(t),t=e(t)?.source.structureId}if(Cy({matchUpFilters:{structureIds:s},drawDefinition:r}).matchUps?.some(({score:e})=>qy({score:e}))){let e=zh({tournamentRecord:t,drawDefinition:r,structure:n,event:a})?.appliedPolicies;if(!(o??e?.[Hp]?.allowDeletionWithScoresPresent?.structures))return{error:hs}}return{...Gi}}({isQualifyingStructure:d,structure:s,...e});if(p?.error)return p;let{structureIdsToRemove:m,relatedStructureIdsMap:f}=function({qualifyingStructureIds:e,isQualifyingStructure:t,isMainStageSequence1:r,mainStageSequence1:i,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(Vy("structureId")),s=e=>n.links?.map(t=>t.source.structureId===e&&t.target.structureId!==i?.structureId&&t.target.structureId).filter(Boolean)??[],c=t=>n.links?.map(r=>e.includes(r.source.structureId)&&r.target.structureId===t&&r.source.structureId).filter(Boolean)??[],u=new Map;return o.forEach(e=>u.set(e,t?c(e):s(e))),{structureIdsToRemove:r?u.get(a):[a],relatedStructureIdsMap:u}}({qualifyingStructureIds:l,isQualifyingStructure:d,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:r,structureId:i}),{removedMatchUpIds:h,removedStructureIds:g}=function({relatedStructureIdsMap:e,qualifyingStructureIds:t,isMainStageSequence1:r,mainStageSequence1:i,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],c=[];for(;a?.length;){let u=a.pop();c.push(...CU({idBeingRemoved:u,drawDefinition:n}));let l=AU({qualifyingStructureIds:t,isMainStageSequence1:r,idBeingRemoved:u,drawDefinition:n,structureId:o});s.push(...l.removedStructureIds);let d=RU({relatedStructureIdsMap:e,mainStageSequence1:i,idBeingRemoved:u,structureId:o});d?.length&&a.push(...d)}return{removedMatchUpIds:c,removedStructureIds:s}}({relatedStructureIdsMap:f,qualifyingStructureIds:l,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:r,structureIdsToRemove:m,structureId:i});if(function({removedMatchUpIds:e,drawDefinition:t}){let{matchUps:r}=Cy({drawDefinition:t});r?.forEach(t=>{t.winnerMatchUpId&&e.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,t.loserMatchUpId&&e.includes(t.loserMatchUpId)&&delete t.loserMatchUpId})}({removedMatchUpIds:h,drawDefinition:r}),u){let e=(c.matchUps??[])?.map(Vy("matchUpId"));h.push(...e),c.positionAssignments=[],c.seedAssignments=[],c.matchUps=[],c.extensions&&(c.extensions=[])}return d&&DU({drawDefinition:r}),sh({tournamentId:t?.tournamentId,matchUpIds:h,action:"removeStructure",eventId:n?.eventId,drawDefinition:r}),lh({drawDefinition:r,eventId:n?.eventId}),{...Gi,removedMatchUpIds:h,removedStructureIds:g}}function RU({idBeingRemoved:e,relatedStructureIdsMap:t,mainStageSequence1:r,structureId:i}){return e&&t.get(e)?.filter(e=>e!==r?.structureId||i===r.structureId)}function AU({qualifyingStructureIds:e,isMainStageSequence1:t,idBeingRemoved:r,drawDefinition:i,structureId:n}){let a=[];return i.links=i.links?.filter(e=>e.source.structureId!==r&&e.target.structureId!==r)??[],(!t||t&&e.length||r!==n)&&(i.structures=(i.structures??[]).filter(e=>(r&&r===e.structureId&&a.push(r),e.structureId!==r))),{removedStructureIds:a}}function CU({idBeingRemoved:e,drawDefinition:t}){let{structure:r}=wf({structureId:e,drawDefinition:t}),i=Uy({structure:r}).matchUps;return Wm(i)}function kU({stageSequence:e=1,drawDefinition:t,drawSize:r,stage:i}){if(!t)return{error:rn};if(!Pg({drawDefinition:t,stage:i}))return{error:Kn};let n=function({stage:e,drawDefinition:t}){return Ug.reduce((r,i)=>(Ng({drawDefinition:t,entryStatus:i,stage:e})||0)+r,0)}({drawDefinition:t,stage:i}),{qualifiersCount:a}=SS({drawDefinition:t,stageSequence:e,stage:i});if(r<n+a)return{error:bn};let{entryProfile:o}=ag({attributes:[{[i]:{drawSize:r}}],drawDefinition:t});return lh({drawDefinition:t}),{...Gi,entryProfile:o}}function xU({qualifiersCount:e=0,drawDefinition:t,stage:r}){return t?Pg({drawDefinition:t,stage:r})?(ag({attributes:[{[r]:{qualifiersCount:e}}],drawDefinition:t}),lh({drawDefinition:t}),{...Gi}):{error:Kn}:{error:rn}}function OU(e){return function({drawDefinition:e,drawSize:t}){if(!e)return{error:rn};let r=kU({stage:Al,stageSequence:1,drawDefinition:e,drawSize:t});return r.error?r:(lh({drawDefinition:e}),{...Gi})}(e)}function FU({tournamentRecord:e,drawDefinition:t,event:r,structureId:i}){if(!t)return{error:rn};let n=t.structures?.find(e=>e.stage===Ml&&e.structureId===i);if(!n)return{error:Fn};if(n.matchUps?.some(({matchUpStatus:e,score:t})=>qy({score:t})??If.includes(e)))return{error:hs};let a=n.matchUps?.map(({matchUpId:e})=>e)||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],sh({tournamentId:e?.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:t}),lh({tournamentId:e?.tournamentId,eventId:r?.eventId,drawDefinition:t,structureIds:[n.structureId]}),{...Gi}}var _U="removeDrawPositionAssignment",LU="swapDrawPositionAssignments",BU="assignDrawPosition",$U="addPenalty",VU="MODIFY_PAIR",jU="QUALIFIER",GU="ALTERNATE",WU="WITHDRAW",qU="ASSIGN",HU="REMOVE",zU="LUCKY",YU="REMOVE_SEED",KU="SWAP",XU="NICKNAME",QU="SEED_VALUE",JU="PENALTY",ZU={MODIFY_PAIR_ASSIGNMENT:VU,QUALIFYING_PARTICIPANT:jU,ALTERNATE_PARTICIPANT:GU,WITHDRAW_PARTICIPANT:WU,ASSIGN_PARTICIPANT:qU,LUCKY_PARTICIPANT:zU,REMOVE_ASSIGNMENT:HU,SWAP_PARTICIPANTS:KU,ADD_NICKNAME:XU,REMOVE_SEED:YU,ADD_PENALTY:JU,ASSIGN_BYE:"BYE",SEED_VALUE:QU};function ew({tournamentRecord:e,drawDefinition:t,drawPositions:r,structureId:i,event:n}){if(!t)return{error:rn};if(!i)return{error:On};if(2!==r?.length)return{error:Zo,drawPositions:r};let a=kg({drawDefinition:t}),{matchUps:o}=Cy({inContext:!0,drawDefinition:t,matchUpsMap:a}),{structure:s}=wf({drawDefinition:t,structureId:i});if(!s)return{error:Fn};let c,u=zh({tournamentRecord:e,drawDefinition:t,event:n}).appliedPolicies??{};if(c=s.structureType===Wl?function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPositions:i,matchUpsMap:n,structure:a,event:o}){let s=a.structures?.reduce((e,t)=>{let r=t?.positionAssignments.filter(e=>i?.includes(e.drawPosition));return r&&e.push(...r),e},[]);if(2===s.filter(({bye:e})=>e).length)return{...Gi};if(2===s.filter(({qualifier:e})=>e).length)return{...Gi};Ab({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,matchUpsMap:n,assignments:s,structure:a,event:o});let c=s.some(({qualifier:e})=>e);if(s.some(({bye:e})=>e)&&!c)tw({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:s,matchUpsMap:n,structure:a,event:o});else{let e=Nu(s,!1,!0);s.forEach((t,r)=>{let i=e[1-r].participantId;t.qualifier=e[1-r].qualifier,t.participantId=i})}return{...Gi}}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:r,matchUpsMap:a,structure:s,event:n}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPositions:i,matchUpsMap:n,structure:a,event:o}){let s=a?.positionAssignments.filter(e=>i?.includes(e.drawPosition));if(!s)return{error:Zo,structure:a,info:"Missing positionAssignments"};if(2===s.filter(({bye:e})=>e).length)return{...Gi};if(2===s.filter(({qualifier:e})=>e).length)return{...Gi};let c=s.some(({qualifier:e})=>e);return s.some(({bye:e})=>e)&&!c?tw({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:s,matchUpsMap:n,structure:a,event:o}):function({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:i,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...i.map((e,t)=>{let{drawPosition:r}=e,n={...i[1-t],drawPosition:r};return{[r]:n}}));return a.positionAssignments=a.positionAssignments.map(e=>s[e.drawPosition]||e),Ab({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,matchUpsMap:n,assignments:i,structure:a,event:o}),{...Gi}}({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:s,matchUpsMap:n,structure:a,event:o})}({inContextDrawMatchUps:o,tournamentRecord:e,drawDefinition:t,drawPositions:r,matchUpsMap:a,structure:s,event:n}),c.error)return c;if(fh({structure:s,drawPositions:r}),hh({appliedPolicies:u,drawDefinition:t,positionAction:{name:LU,drawPositions:r,structureId:i}}),ph({tournamentId:e?.tournamentId,drawDefinition:t,structure:s,event:n}),n.eventType===Pl){let i=Uy({matchUpFilters:{matchUpTypes:[zr]},inContext:!0,structure:s}).matchUps.filter(e=>e.drawPositions?.some(e=>r.includes(e))),a=Uy({matchUpFilters:{matchUpTypes:[zr]},structure:s}).matchUps;i.forEach(i=>{(i.sides||[]).forEach(o=>{let s=o?.drawPosition;if(r.includes(s)){let r=o.participantId,c=a.find(({matchUpId:e})=>e===i.matchUpId),u=i?.sides?.reduce((e,t,r)=>t.drawPosition===s?r:e,void 0);Sb({inContextTargetMatchUp:i,drawPositionSideIndex:u,teamParticipantId:r,tournamentRecord:e,drawDefinition:t,matchUp:c,event:n})}})})}return lh({drawDefinition:t,structureIds:[i]}),{...Gi}}function tw({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,assignments:i,matchUpsMap:n,structure:a,event:o}){let s=i.find(({bye:e})=>e),c=i.find(({participantId:e})=>e),u=s.drawPosition,{participantId:l,drawPosition:d}=c,{structureId:p}=a,m=KS({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,structureId:p,matchUpsMap:n});return m.error||(m=KS({drawPosition:d,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,structureId:p,matchUpsMap:n}),m.error)||(iv({drawPosition:d,tournamentRecord:t,drawDefinition:r,structureId:p,matchUpsMap:n,event:o}),m=Cb({drawPosition:u,inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,structureId:p,participantId:l,matchUpsMap:n,event:o}),m.error)?m:{...Gi}}function rw({tournamentRecord:e,drawDefinition:t,participantId:r,structureId:i}){let n="removeSeededParticipant";if(!e)return{error:Ji};if(!t)return{error:rn};let a=(t.structures??[]).find(e=>e.structureId===i);return a?!a.stage||![El,Ml].includes(a.stage)||a.stage===El&&1!==a.stageSequence?ac({result:{error:on},stack:n}):a.seedAssignments?.find(e=>e.participantId===r)?{...Gi}:ac({info:"participant not seeded",result:{error:as},context:{participantId:r}}):ac({result:{error:Fn},stack:n})}function iw({targetEntryRound:e=1,finishingPositions:t,sourceRoundNumber:r,sourceStructureId:i,targetStructureId:n,linkType:a=Xl}){return i&&n?{link:nc({linkType:a,source:{roundNumber:r,structureId:i,finishingPositions:t},target:{feedProfile:ql,roundNumber:e,structureId:n}})}:{error:On}}function nw({matchUp:e,tieFormat:t,isMock:r,uuids:i}){let{collectionDefinitions:n}=t??{};return{tieMatchUps:(n??[]).map(t=>aw({matchUp:e,collectionDefinition:t,uuids:i,isMock:r})).filter(Boolean).flat()}}function aw({collectionPositionOffset:e=0,collectionDefinition:t,matchUpsLimit:r,matchUp:i,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:c,processCodes:u}=t||{},l=e=>{if(!n&&!i?.isMock)return a?.pop()??Ru();let r=t?.collectionId;return a?.pop()??`${i?.matchUpId}-${r}-TMU-${e+1}`};return Ri(0,r??o??0).map(t=>{let r=e+t+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:l(t),matchUpStatus:lf,collectionPosition:r,collectionId:c,processCodes:u,matchUpType:s,isMock:n}})}function ow({roundPosition:e,roundNumber:t,idPrefix:r,uuids:i}){return r?`${r}-${t}-${e}`:i?.pop()||Ru()}function sw({includeMatchUpType:e,matchUpType:t,roundNumber:r,matchUps:i,idPrefix:n,isMock:a,uuids:o,nodes:s}){let c=0,u=[],l=1,d=r-1,p=s?.length;for(;c<(p||0);){let p=s?.[c],m=s?.[c+1];d&&(p.roundNumber=d),m&&d&&(m.roundNumber=d);let f={roundPosition:l,children:[p,m],matchUpId:ow({roundPosition:l,roundNumber:r,idPrefix:n,uuids:o})};u.push(f);let h={drawPositions:f.children.map(e=>e?.drawPosition).filter(Boolean),matchUpStatus:lf,matchUpId:f.matchUpId,roundPosition:l,roundNumber:r};e&&t&&(h.matchUpType=t),a&&(h.isMock=!0),i.push(h),l++,c+=2}return{roundNodes:u,matchUps:i}}function cw({finishingPositionOffset:e,finishingPositionLimit:t,qualifyingRoundNumber:r,qualifyingPositions:i,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:c,uuids:u}){if(isNaN(s)||s<2||i&&s<=i)return{matchUps:[],roundsCount:0};if(i&&(!ci(s)||s%i)){let e=i;for(;e<s;)e*=2;s=e}let l=i&&!(s%2)&&(!isNaN(i)||r&&!isNaN(r))&&(s/i===Math.round(s/i)||r&&s/r===Math.round(s/r));if(!ci(s)&&!l)return{matchUps:[],roundsCount:0};let d,p=Ri(1,s+1).map(e=>({drawPosition:e})),m=[],f=1;for(({roundNodes:d,matchUps:m}=sw({matchUpType:n,roundNumber:f,idPrefix:o,matchUps:m,isMock:c,nodes:p,uuids:u})),f++,a=a??r;d.length>1;)i&&d.length===i&&(a=f-1),({roundNodes:d,matchUps:m}=sw({nodes:d,matchUpType:n,roundNumber:f,idPrefix:o,matchUps:m,isMock:c,uuids:u})),f++;let h=f-1;return m=jy({finishingPositionOffset:e,finishingPositionLimit:t,roundsCount:h,roundLimit:a,matchUps:m}),a?m=m.filter(e=>a&&(e.roundNumber??0)<=a):a=f-1,{drawSize:s,matchUps:m,roundsCount:h,roundLimit:a}}function uw(e){let t="generateQualifyingStructure",r=function(e,t){return e.drawDefinition?e.drawSize&&!gi(e.drawSize)||e.participantsCount&&!gi(e.participantsCount)||e.qualifyingPositions&&!gi(e.qualifyingPositions)?ac({result:{error:Zo},stack:t}):e.drawSize?e.qualifyingPositions&&e.qualifyingPositions>=e.drawSize?ac({result:{error:Zo},context:{drawSize:e.drawSize,qualifyingPositions:e.qualifyingPositions},stack:t}):null:ac({result:{error:Un},context:{drawSize:e.drawSize},stack:t}):ac({result:{error:rn},stack:t})}(e,t);if(r)return r;let i=e.drawSize??li(e.participantsCount),{hasExistingDrawDefinition:n,qualifyingRoundNumber:a,qualifyingPositions:o,targetStructureId:s,structureOptions:c,appliedPolicies:u,qualifyingOnly:l,drawDefinition:d,matchUpFormat:p,structureName:m,structureId:f,roundTarget:h,tieFormat:g,drawType:I,idPrefix:y,isMock:v,uuids:S}=e,b=function(e,t,r){let{structureProfiles:i}=TU({drawDefinition:e});return i[t]||ac({result:{error:Fn},context:{targetStructureId:t},stack:r})}(d,s,t);if(b?.error)return b;let U,w,T,D,P,N=d.matchUpType,E=h?`${h}-`:"",M="object"==typeof b&&"stage"in b&&b.stage===Ml,R=u?.[Vp]?.namingConventions?.pre??Wg[Vp]?.namingConventions?.pre,A=M&&R?`${R}-`:"",C=m??(E?`${A}${eb(Ml)} ${E}`:`${A}${eb(Ml)}`);if(I===vd){let e=function(e){let{maxRoundNumber:t,structures:r,groupCount:i}=sb(e);return{qualifiersCount:i,roundLimit:t,structure:r[0],finishingPositions:[1]}}({structureName:m??C,structureId:f??S?.pop(),hasExistingDrawDefinition:n,stage:Ml,structureOptions:c,appliedPolicies:u,qualifyingOnly:l,stageSequence:1,matchUpType:N,roundTarget:h,tieFormat:g,idPrefix:y,drawSize:i,isMock:v,uuids:S});D=e.qualifiersCount,T=e.roundLimit,U=e.structure,P=e.finishingPositions}else{let e=function(e){let{drawSize:t,matchUps:r,roundLimit:i,roundsCount:n}=cw(e);i||(i=n);let a=JS({structureName:e.structureName,structureId:e.structureId,qualifyingRoundNumber:i,stage:Ml,matchUpFormat:e.matchUpFormat,stageSequence:e.stageSequence,matchUpType:e.matchUpType,roundLimit:i,matchUps:r});e.roundTarget&&em({extension:{name:Nm,value:e.roundTarget},element:a});let o=r?.filter(e=>e.roundNumber===i)?.length??0;return{drawSize:t,structure:a,matchUps:r,roundLimit:i,qualifiersCount:o}}({qualifyingRoundNumber:a,qualifyingPositions:o,matchUpType:N,idPrefix:y,drawSize:i,isMock:v,uuids:S,structureName:m??C,structureId:f??S?.pop(),matchUpFormat:p,stageSequence:1,roundTarget:h});i=e.drawSize,U=e.structure,T=e.roundLimit,D=e.qualifiersCount}let k=I===vd?Kl:Xl,x=U&&T&&iw({sourceStructureId:U.structureId,sourceRoundNumber:T,targetStructureId:s,finishingPositions:P,linkType:k})?.link;return g&&(w=Uy({structure:U})?.matchUps||[],w?.forEach(e=>{let{tieMatchUps:t}=nw({tieFormat:g,matchUp:e,isMock:v});Object.assign(e,{tieMatchUps:t,matchUpType:N})})),{qualifyingDrawPositionsCount:i,qualifiersCount:D,...Gi,structure:U,link:x}}function lw(e){if(!e.tournamentRecord)return{error:Ji};let t=function(e){if(!e.drawDefinition)return{error:rn};if(!e.targetStructureId)return{error:On};let t=uw(e);if(t.error)return t;let{structure:r,link:i}=t;return r&&i?PU({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,structure:r,link:i}):{error:Zo}}(e);return t.error,t}function dw(e){let t=Dp(e,[{[xd]:!0,[jd]:!0,[Kd]:!0},{[Vd]:!0,[gp]:e=>Number.isInteger(e)&&e>0},{[gp]:e=>Array.isArray(e)&&2===e.length&&e.every(ei),[yp]:za,participantIds:!0}]);if(t.error)return t;let{drawDefinition:r,structureId:i,tournamentRecord:n,event:a}=e,{structure:o}=wf({drawDefinition:r,structureId:i});if(!o)return{error:Fn};if(!jg({structure:o}))return{error:on};let s=(o?.matchUps??[]).filter(t=>t.roundNumber===e.roundNumber).filter(e=>!qy(e)).filter(t=>t.sides?.map(e=>e.participantId).some(t=>e.participantIds.includes(t)));if(2!==s.length)return{error:za};for(let c of s){let t=c?.sides?.find(t=>e.participantIds.includes(t?.participantId));if(t){let i=e.participantIds.find(e=>e!==t?.participantId);t.participantId=i,ch({tournamentId:n?.tournamentId,eventId:a?.eventId,drawDefinition:r,matchUp:c})}}return lh({drawDefinition:r,structureIds:[i]}),{...Gi}}function pw({includeMatchUpType:e,drawPosition:t,roundNumber:r,matchUpType:i,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:c,fed:u}){let l=c.length,d=t?t-l:void 0,p=Ri(0,l).map(e=>d?d+e:void 0),m=[];for(let f=0;f<l;f++){let t=p.shift(),l={drawPosition:t,fed:u+1,feed:!0},d=c[f];d.roundNumber=r-1;let h=ow({roundPosition:d.roundPosition,roundNumber:r,idPrefix:n,uuids:s}),g={roundPosition:d.roundPosition,drawPositions:[t],matchUpStatus:lf,roundNumber:r,matchUpId:h};e&&(g.matchUpType=i),o&&(g.isMock=!0),a.push(g);let I={children:[d,l]};m.push(I)}return{roundNodes:m,matchUps:a,drawPosition:t?t-l:void 0}}function mw(e){let t=e.drawSize,{feedRoundsProfile:r,feedRounds:i=0,skipRounds:n=0,baseDrawSize:a}=e,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:c,feedsFromFinal:u,isConsolation:l,matchUpType:d,idPrefix:p,isMock:m,uuids:f,fmlc:h}=e;a=a??function(e){let t=di(e);return t>e?t/2:t}(t);let g=function({drawSize:e}){let t=Math.ceil(Math.log(e)/Math.log(2));return Ri(0,t).reverse().map(e=>Math.pow(2,e))}({drawSize:a}),I=g.length,y=0;if(r?.length)y=r.reduce((e,t)=>e+t,0);else if(t){let e=t-a;r=g.filter(t=>t<=e&&(e-=t,!0)),y=r.reduce((e,t)=>e+t,0),i=r.length}else n>=I?i=0:u&&(i=I-u,n=0),r=g.filter((e,t)=>u&&!i||i&&t>=n+i||t<n?0:e),y=r.reduce((e,t)=>e+t,0),i=r.length;let v=[...g,...r].sort((e,t)=>t-e),S=v.length,b=[...(c??[]).map(e=>e-1),...(o??[]).map(e=>S-e)].map(e=>v[e]).reduce((e,t)=>e+t,0);y-=b;let U,w=0,T=[],D=1,P=Ri(0,a).map((e,t)=>({drawPosition:t+1+y})),N=y+1;for(let M of g){if(({roundNodes:U,matchUps:T}=sw({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:T,isMock:m,nodes:P,uuids:f})),D++,r.includes(M)){let e=Ri(0,wi(r)[M]),t=S+1-D,i=o?.includes(t)??c?.includes(D);e.forEach(()=>{({roundNodes:U,matchUps:T,drawPosition:N}=pw({drawPosition:!i&&N||void 0,nodes:U,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:T,isMock:m,uuids:f,fed:w})),D++,w+=1})}P=U}S!==D-1&&console.log("ERROR"),T=jy({finishingPositionOffset:l?a-y:s,positionsFed:y,roundsCount:S,matchUps:T,fmlc:h});let E=U?.length?U[0]:U;return E&&(E.roundNumber=D-1,E.matchUps=T),{draw:E,matchUps:T,roundsCount:S}}function fw(e){let{finishingPositionOffset:t=0,addNameBaseToAttributeName:r,playoffStructureNameBase:i,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:c="0",exitProfileLimit:u,roundOffsetLimit:l,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:f,stage:h=El,drawSize:g,idPrefix:I,isMock:y,uuids:v}=e;if(o&&u&&!o?.[c]||g<2||f&&s>f)return{};let S=[],b=[],U=[],w=e.matchUpType??p?.matchUpType,T=t+1,D=`${T}-${t+g}`,P=o?.[c],N=i&&`${i} `||"",E=o?.[D]??n?.[D],M=e.structureName||E?.name||P?.name&&(r?`${N}${P?.name}`:P.name)||`${N}${D}`,R=E?.abbreviation??P?.abbreviation,A=e.structureId??P?.structureId??v?.pop(),C={idPrefix:I&&`${I}-${M}-RP`,finishingPositionOffset:t,matchUpType:w,drawSize:g,isMock:y,uuids:v},{matchUps:k}=m?mw(C):cw(C),x=JS({structureAbbreviation:R,stageSequence:s,structureName:M,matchUpType:w,roundOffset:d,structureId:A,matchUps:k,stage:h});S.push(...k),b.push(x);let O=Math.ceil(Math.log(g)/Math.log(2)),F=l?Math.min(l-d,O):(!a||T<a)&&O||0;return g>2&&Ri(1,F+1).forEach(e=>function(e){let m=g/Math.pow(2,e);if(m<2)return;let y=g/Math.pow(2,e)+t;if(a&&y+1>a)return;let{structures:T,structureId:D,matchUps:P,links:N}=fw({finishingPositionOffset:y,exitProfile:`${c}-${e}`,roundOffset:d+e,stageSequence:s+1,drawSize:m,addNameBaseToAttributeName:r,playoffStructureNameBase:i,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:u,roundOffsetLimit:l,drawDefinition:p,sequenceLimit:f,matchUpType:w,idPrefix:I,uuids:v,stage:h});if(x.structureId&&D){let t={linkType:Ql,source:{roundNumber:e,structureId:x.structureId},target:{roundNumber:1,feedProfile:zl,structureId:D}};N&&x&&N.push(t),N?.length&&U.push(...N)}return T?.length&&b.push(...T),P?.length&&S.push(...P),{structureId:D,childLinks:N,structures:b}}(e)),{structureId:x.structureId,matchUps:S,structureName:M,structures:b,links:U,...Gi}}function hw({drawDefinition:e,matchUpsMap:t,structureId:r}){let i=wf({drawDefinition:e,structureId:r});if(i.error)return ac({result:i});let{matchUps:n}=Uy({structure:i.structure,matchUpsMap:t});return{...Lg({matchUps:n}),matchUps:n,matchUpsMap:t}}function gw({finishingPositions:e,drawDefinition:t,structureId:r}){let{roundProfile:i}=hw({drawDefinition:t,structureId:r});return(i&&Object.keys(i))?.reduce((t,r)=>(Iw(i?.[r]).forEach(i=>{e.forEach(e=>{(function({position:e,rangeDefinition:t}){if(!Array.isArray(t)||t.reduce((e,t)=>e||isNaN(t),!1))return!1;let[r,i]=t;return Ri(r,(i||r)+1).includes(e)})({position:e,rangeDefinition:i})&&(t[e]={roundNumber:r})})}),t),{})}function Iw(e){return[vi(e?.finishingPositionRange?.loser||[]),vi(e?.finishingPositionRange?.winner||[])]}function yw(e){return Iw(e).map(e=>Ri(e[0],e[1]&&e[1]+1||e[0]+1))}function vw({drawDefinition:e,structureIds:t,matchUpsMap:r}){if(t&&!Array.isArray(t))return{error:Zo,context:{structureIds:t}};if(!e)return{error:rn};let i=(t=t??(e.structures??[]).filter(e=>e.stage!==Ml).map(({structureId:e})=>e)).map(t=>{let{roundProfile:i}=hw({drawDefinition:e,matchUpsMap:r,structureId:t});return(i&&Object.values(i))?.map(yw).flat()}).flat(),n=i.filter(e=>1===e?.length).sort(Qr).flat();return{positionsNotPlayedOff:vi(i.flat()).filter(e=>!n.includes(e)),positionsPlayedOff:n}}function Sw({excludeRoundNumbers:e=[],playoffPositions:t=[],drawDefinition:r,structureId:i}){if(!r)return{error:rn};if(!i)return{error:On};if(!t)return{error:Da,info:"missing playoffPositions"};let n=vw({drawDefinition:r});if(n.error)return n;let a=n.positionsPlayedOff,o=gw({finishingPositions:t.filter(e=>!a.includes(e)),drawDefinition:r,structureId:i}),s=Object.values(o).reduce((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber),[]).map(e=>Jr(e)).filter(t=>!e.includes(t)),c=gw({finishingPositions:a,drawDefinition:r,structureId:i}),u=c?Object.values(c):[],l=c?u.reduce((e,t)=>e.includes(t.roundNumber)?e:e.concat(t.roundNumber),[]).map(e=>Jr(e)):[],d=s.filter(e=>!l.includes(e)).sort(Qr),{roundProfile:p}=hw({drawDefinition:r,structureId:i}),m=d.map(e=>{let t=p?.[e].finishingPositionRange.loser,[r,i]=t??[0,0];return Ri(r,(i||r)+1)}).flat().sort(Qr),{playoffRoundsRanges:f}=function({playoffSourceRounds:e,roundProfile:t}){return{playoffRoundsRanges:e.map(e=>{let r=t[e].finishingPositionRange.loser,[i,n]=r,a=Ri(i,(n||i)+1);return{finishingPositionRange:r.join("-"),finishingPositions:a,roundNumber:e}})}}({playoffSourceRounds:d,roundProfile:p}),h=[...d,...l];return{playoffPositionsReturned:m,playedOffSourceRounds:l,playoffRoundsRanges:f,playoffSourceRounds:d,sourceRounds:h,roundProfile:p}}function bw({drawDefinition:e,structureId:t}){if(!e)return{error:rn};let{matchUps:r,matchUpsMap:i}=Ly({inContext:!0,drawDefinition:e}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=vw({drawDefinition:e,matchUpsMap:i}),{structures:o}=Tf({drawDefinition:e}),s=o.filter(e=>!t&&e.stage!==Al||e.structureId===t),c={};for(let u of s){let t=u?.structureId,i=Uw({playoffPositions:n,drawDefinition:e,structure:u,matchUps:r}),{error:a,...o}=i;if(a)return i;c[t]={structureId:t,...o}}return t?{positionsPlayedOff:a,...c[t]}:{availablePlayoffProfiles:Object.values(c),availablePlayoffRounds:Object.values(c),positionsPlayedOff:a}}function Uw({playoffPositions:e,drawDefinition:t,structure:r,matchUps:i}){let n=r?.structureId,{links:a}=Py({drawDefinition:t,structureId:n});if(r.structureType===Wl||r.structures){let e=Pf({structure:r})?.positionAssignments?.length,o=r.structures.length,s=(e??0)/o,c=a.source?.flatMap(({source:e})=>e?.finishingPositions||[])||[],u=Ri(1,s+1).filter(e=>!c.includes(e)),l=i.find(e=>e.containerStructureId===n&&e.finishingPositionRange)?.finishingPositionRange?.winner||[0,1],d=a?.source.map(({target:e})=>e.structureId),{positionsPlayedOff:p=[],positionsNotPlayedOff:m=[]}=vw({structureIds:d,drawDefinition:t}),f=new Set([...p,...m]),h=Ri(l[0],l[1]+1).filter(e=>!f.has(e)),g=_i(h,h.length/u.length);return{positionsNotPlayedOff:h,playoffFinishingPositionRanges:u.map((e,t)=>{let r=g[t];return{finishingPosition:e,finishingPositions:r,finishingPositionRange:[Math.min(...r||[]),Math.max(...r||[])].join("-")}}),finishingPositionsAvailable:u,finishingPositionsPlayedOff:c,positionsPlayedOff:p,groupCount:o,groupSize:s}}let o=a?.source?.filter(e=>e.linkCondition!==Jl).map(e=>e.source?.roundNumber)||[],s=a?.source?.filter(e=>e.linkCondition===Jl).map(e=>e.source?.roundNumber)||[],c=Sw({excludeRoundNumbers:o,playoffPositions:e,drawDefinition:t,structureId:n}),u=c?.playoffSourceRounds?[...c?.playoffSourceRounds||[]]:void 0,l=[...c?.playoffRoundsRanges||[]],{roundProfile:d,error:p}=c;for(let m of s){let e=a?.source.find(e=>e.source.roundNumber===m),t=e?.target.roundNumber,r=e?.target.structureId,n=i.filter(({roundNumber:e,structureId:i})=>i===r&&e===t),o=n.filter(({sides:e})=>e.find(e=>e.participantFed&&!e.participantId)).length;if(u&&o===n.length){u.push(m);let e=d?.[m]?.finishingPositionRange?.loser;if(e){let t=Math.min(...e),r=t+o,i=Ri(t,r),n={finishingPositionRange:[t,r-1].join("-"),finishingPositions:i,roundNumber:m};l.push(n)}}}return u&&u.sort(Qr),l.sort((e,t)=>e.roundNumber-t.roundNumber),{playoffRounds:u,playoffRoundsRanges:l,error:p}}function ww(e){let{finishingPositionOffset:t=0,playoffAttributes:r,stageSequence:i=1,staggeredEntry:n,structureName:a,stage:o=El,matchUpType:s,structureId:c,idPrefix:u,drawSize:l,isMock:d,uuids:p}=e,m={finishingPositionOffset:t,matchUpType:s,drawSize:l,idPrefix:u,isMock:d,uuids:p},{matchUps:f}=n?mw(m):cw(m),h=JS({structureName:a||r?.[0]?.name||eb(El),structureId:c||p?.pop(),stageSequence:i,matchUpType:s,matchUps:f,stage:o}),g=[h],I=[];if(l>2){let i=l/2,{matchUps:n}=cw({finishingPositionOffset:t+i,idPrefix:u&&`${u}-c`,drawSize:i,matchUpType:s,isMock:d}),o=eb(Rl),c=r?.["0-1"]?.name??e.consolationStructureName??(a?`${a} ${o}`:o),m=JS({structureName:c,matchUps:n,structureId:p?.pop(),stage:Rl,stageSequence:1,matchUpType:s});g.push(m);let f={linkType:Ql,source:{roundNumber:1,structureId:h.structureId},target:{roundNumber:1,feedProfile:zl,structureId:m.structureId}};I.push(f)}return{...Gi,structures:g,links:I}}function Tw({consolationStructure:e,roundOffset:t=0,mainStructure:r,roundsCount:i,feedPolicy:n,fmlc:a}){let o=e.matchUps.reduce((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e,[]),s=n?.roundGroupedOrder||[],c=n?.roundFeedProfiles;return Ri(1+t,i+1+t).map(i=>{let n=c?.[i-1]?c[i-1]:i%2&&zl||Yl,u=i-t<=2?i-t:2*(i-t-2)+2,l={linkType:Ql,source:{roundNumber:i,structureId:r.structureId},target:{feedProfile:n,roundNumber:u,structureId:e.structureId}},d=s[i-1];return d&&(l.target.groupedOrder=d),Ps()&&(l.source.structureName=r.structureName,l.target.structureName=e.structureName),2===i&&a&&(l.linkCondition=Jl,l.target.feedProfile=zl),o.includes(u)?l:void 0}).filter(Boolean)}function Dw(e){let{playoffStructureNameBase:t,finishingPositionOffset:r,stageSequence:i=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:o,stage:s=El,matchUpType:c,structureId:u,drawSize:l,idPrefix:d,isMock:p,uuids:m}=e,f={finishingPositionOffset:r,matchUpType:c,drawSize:l,idPrefix:d,isMock:p,uuids:m},{matchUps:h,roundsCount:g}=o?mw(f):cw(f),I=e.structureName??n?.[0]?.name??eb(El),y=QS({structureId:u||m?.pop(),structureName:I,stageSequence:i,matchUpType:c,matchUps:h,stage:s}),v=[y],S=[];if(l>2){let e=[0,2].slice(0,l/16).map((e,r)=>{let i=r+1,{consolationStructure:o}=function({playoffStructureNameBase:e,stageSequence:t=1,playoffAttributes:r,structureNameMap:i,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:c,isMock:u,index:l,uuids:d}){let p=c/(2*Math.pow(2,n)),{matchUps:m,roundsCount:f}=mw({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:u,uuids:d}),h=0===l&&r?.["0-1"]?.name||1===l&&r?.["0-3"]?.name||`${eb(Rl)} ${l+1}`,g=i?.[h]||h,I=e?`${e} ${g}`:g;return{consolationStructure:QS({matchUps:m,stage:Rl,structureName:I,stageSequence:t,matchUpType:a,structureId:o}),consolationRoundsCount:f}}({idPrefix:d&&`${d}-c${r}`,structureId:m?.pop(),playoffStructureNameBase:t,playoffAttributes:n,structureNameMap:a,stageSequence:i,roundOffset:e,matchUpType:c,drawSize:l,isMock:p,index:r,uuids:m});return v.push(o),{consolationStructure:o,links:Tw({consolationStructure:o,roundsCount:2,mainStructure:y,roundOffset:e})}}).map(e=>e.links).flat();if(S.push(...e),l>=4&&l<=16||l>32){let{matchUps:e}=cw({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:c,isMock:p}),r=n?.["3-4"]?.name??eb(Cl),i=a?.[r]||r,o=t?`${t} ${i}`:i,s=QS({structureId:m?.pop(),matchUps:e,stageSequence:2,stage:Cl,structureName:o,matchUpType:c}),u={linkType:Ql,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:s.structureId,feedProfile:zl,roundNumber:1}};v.push(s),S.push(u)}}return{structures:v,links:S,...Gi}}function Pw(e){let{finishingPositionOffset:t,stageSequence:r=1,playoffAttributes:i,feedsFromFinal:n,staggeredEntry:a,structureName:o,stage:s=El,structureId:c,matchUpType:u,skipRounds:l,feedRounds:d,idPrefix:p,drawSize:m,isMock:f,uuids:h,fmlc:g}=e,I=e.feedPolicy||e.policyDefinitions?.[Yp]||e.appliedPolicies?.[Yp],y={finishingPositionOffset:t,matchUpType:u,skipRounds:l,drawSize:m,idPrefix:p,isMock:f,uuids:h},{matchUps:v}=a?mw(y):cw(y),S=JS({structureName:o||i?.[0]?.name||eb(El),structureId:c||h?.pop(),stageSequence:r,matchUpType:u,matchUps:v,stage:s}),b=[S],U=[],w=m/2,{matchUps:T,roundsCount:D}=mw({finishingPositionOffset:w,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:w,matchUpType:u,feedRounds:d,skipRounds:l,isMock:f,uuids:h,fmlc:g});if(m>2){let t=i?.["0-1"]?.name??eb(Rl),r=e.playoffStructureNameBase?`${e.playoffStructureNameBase} ${t}`:t,n=JS({matchUps:T,structureId:h?.pop(),stage:Rl,stageSequence:1,structureName:r,matchUpType:u});b.push(n);let a=Tw({consolationStructure:n,mainStructure:S,roundsCount:D,feedPolicy:I,fmlc:g});U.push(...a)}return{...Gi,structures:b,links:U}}function Nw({requireSequential:e=!0,playoffMatchUpFormat:t,playoffAttributes:r,sourceStructureId:i,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:c,feedPolicy:u,groupCount:l,idPrefix:d,isMock:p,uuids:m}){u=u||n?.[Yp];let f="processPlayoffGroups",h=0,g=[],I=[],y=[],{error:v,positionRangeMap:S}=function({playoffGroups:e,drawDefinition:t,structureId:r}){if(!t)return{error:rn};if(!ei(r)||!Array.isArray(e))return{error:Zo};let i=e.map(({finishingPositions:e})=>e).flat();return{positionRangeMap:bw({drawDefinition:t,structureId:r}).playoffFinishingPositionRanges?.filter(e=>i.includes(e.finishingPosition))?.reduce((e,t)=>(e[t.finishingPosition]=t,e),{})}}({structureId:i,drawDefinition:o,playoffGroups:s});if(v)return ac({result:{error:v},stack:f});if(S&&!s?.every(t=>{let{finishingPositions:r=[]}=t;if(!r.length)return!1;let i=[...r].sort(Qr).map((e,t)=>(r[t+1]||e)-e).every(e=>e<2);return(!e||i)&&r.every(e=>S[e])}))return ac({context:{validFinishingPositions:Object.values(S)},result:{error:Zo},stack:f});for(let b of s){let e=b.finishingPositions,o=S&&e.flatMap(e=>S[e]?.finishingPositions??[]),s=l*e.length,f=fi(s),v=2===f&&id||b.drawType||id;o&&(h=Math.min(...o)-1);let U=o&&`${Math.min(...o)}-${Math.max(...o)}`,w=b.structureName||U&&b.playoffAttributes?.[U]?.name||b.playoffAttributes?.[0]?.name,T={addNameBaseToAttributeName:b.addNameBaseToAttributeName,playoffStructureNameBase:b.playoffStructureNameBase,finishingPositionNaming:b.finishingPositionNaming,finishingPositionLimit:b.finishingPositionLimit,structureId:b.structureId??m?.pop(),playoffAttributes:b.playoffAttributes,structureNameMap:b.structureNameMap,sequenceLimit:b.sequenceLimit,structureName:w,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:h,stage:Cl,stageSequence:a,matchUpType:c,drawSize:f,isMock:p,uuids:m},D=({playoffStructures:t,playoffLinks:r})=>{let[n]=t,a=Ew({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:i});y.push(a,...r),I.push(...t),g.push({structureId:n.structureId,finishingPositions:e}),h+=s};if(v===id){let{matchUps:r}=cw({finishingPositionLimit:h+s,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,matchUpType:c,drawSize:f,isMock:p,uuids:m}),n=JS({structureId:b.structureId??m?.pop(),matchUpFormat:t,stage:Cl,structureName:w,stageSequence:a,matchUps:r});I.push(n);let o=Ew({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:i});y.push(o),h+=s,g.push({structureId:n.structureId,finishingPositions:e})}else if([td,rd,Cl].includes(v)){let t={playoffAttributes:b.playoffAttributes??r,playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??m?.pop(),structureName:b.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:h,stage:Cl,roundOffset:0,stageSequence:a,drawSize:f,isMock:p,uuids:m};v===td?Object.assign(t,{playoffAttributes:b?.playoffAttributes??r??wd,roundOffsetLimit:3}):v===rd&&Object.assign(t,{playoffAttributes:b?.playoffAttributes??r??Td,roundOffsetLimit:2});let n=fw(t);if(n.error)return n;if(n.links?.length&&y.push(...n.links),n.structures?.length&&I.push(...n.structures),I.sort(bf),n.structureId){let t=Ew({playoffStructureId:n.structureId,finishingPositions:e,sourceStructureId:i});y.push(t),g.push({structureId:n.structureId,finishingPositions:e})}h+=s}else if([ad,yd,hd,md,dd,Id].includes(v)){let t=[m?.pop(),m?.pop()],r={playoffStructureNameBase:b.playoffStructureNameBase,structureId:b.structureId??m?.pop(),playoffAttributes:b.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:h,uuids:t,stage:Cl,structureName:w,matchUpType:c,feedPolicy:u,drawSize:f,isMock:p},n={[ad]:{fmlc:!0,feedRounds:1},[Id]:{feedRounds:1},[hd]:{feedsFromFinal:3},[md]:{feedsFromFinal:2},[dd]:{feedsFromFinal:1}};Object.assign(r,n[v]||{});let{structures:a,links:o}=Pw(r),[l]=a,S=Ew({playoffStructureId:l.structureId,finishingPositions:e,sourceStructureId:i});y.push(S,...o),I.push(...a),g.push({structureId:l.structureId,finishingPositions:e}),h+=s}else if([vd].includes(v)){let{structures:e,links:t}=sb({...T,structureOptions:b.structureOptions||{groupSize:4}});D({playoffStructures:e,playoffLinks:t})}else if([od].includes(v)){let{structures:e,links:t}=ww(T);D({playoffStructures:e,playoffLinks:t})}else if([ud].includes(v)){let{structures:e,links:t}=Dw(T);D({playoffStructures:e,playoffLinks:t})}else if([Zl].includes(v)){D({playoffStructures:[JS({structureId:b.structureId??m?.pop(),structureName:b.structureName,finishingPosition:eg,stage:Cl,stageSequence:a,matchUps:[]})],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:S,structures:I,links:y}}function Ew({playoffStructureId:e,finishingPositions:t,sourceStructureId:r}){return{linkType:Kl,source:{structureId:r,finishingPositions:t},target:{structureId:e,feedProfile:ql,roundNumber:1}}}function Mw({positionAssignments:e,tournamentRecord:t,drawDefinition:r,matchUpFormat:i,matchUps:n,event:a}){if(!_g(n))return{error:Zo};if(!e)return{error:Zo};let{policyDefinitions:o}=Yh({policyTypes:[_p],tournamentRecord:t,drawDefinition:r,event:a}),{subOrderMap:s}=eS({positionAssignments:e}),c=n.length?Qv({policyDefinitions:o,matchUpFormat:i,subOrderMap:s,matchUps:n}):void 0;if(c?.error)return c;let{participantResults:u={},bracketComplete:l,report:d}=c??{},p=Object.keys(u);return e.forEach(e=>{let{participantId:t}=e;if(p.includes(t)){em({element:e,extension:{value:u[t],name:Cm}}),u[t].ties||Jp({element:e,name:Am})}else Jp({element:e,name:Cm}),Jp({element:e,name:Am})}),lh({drawDefinition:r}),{...Gi,participantResults:u,bracketComplete:l,report:d}}function Rw({matchUps:e,matchUpId:t}){return{matchUp:(e||[]).find(e=>e.matchUpId===t)}}function Aw(e){let t=Dp(e,[{[xd]:!0,[Kd]:!0}]);if(t.error)return t;let{tournamentParticipants:r,afterRecoveryTimes:i,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:c,context:u,event:l}=e,{structures:d=[]}=Tf({drawDefinition:a}),p=e.contextContent||n&&rg({contextProfile:n,drawDefinition:a});for(let m of d){let{matchUps:e}=Uy({tournamentParticipants:r,afterRecoveryTimes:i,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:c,structure:m,context:u,event:l}),{matchUp:t}=Rw({matchUps:e,matchUpId:s});if(t)return{matchUp:t,structure:m}}return{error:da}}function Cw(e){return ti(e)&&e.notes?ti(e.element)&&(ei(e.notes)||e.notes?.testing)?(Object.assign(e.element,{notes:e.notes}),{...Gi}):{error:Zo}:{error:Da}}function kw(e){return ti(e)?ti(e.element)?(e.element.notes&&delete e.element.notes,{...Gi}):{error:Zo}:{error:Da}}var xw={matchUpStatus:lf,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Ow(e){let t,r="modifyMatchUpScore",i=e.matchUpFormat,n=e.matchUp,{matchUpStatusCodes:a,tournamentRecord:o,drawDefinition:s,matchUpStatus:c,removeScore:u,winningSide:l,matchUpId:d,event:p,notes:m,score:f}=e,h=e.appliedPolicies&&Object.keys(e.appliedPolicies).length?e.appliedPolicies:zh({policyTypes:[Hp],tournamentRecord:o,drawDefinition:s,structure:t,event:p})?.appliedPolicies,g=n.matchUpType===Yr;if(g&&s){if(d&&n.matchUpId!==d){let e=Aw({drawDefinition:s,matchUpId:d,event:p});if(!e.matchUp)return{error:da};({matchUp:n,structure:t}=e)}}else n.matchUpId!==d&&console.log("!!!!!");c&&[df,nf].includes(c)||u?Object.assign(n,{...xw}):f&&(n.score=f);let I,y=c&&n?.matchUpStatus===tf&&c!==tf;if(c&&(n.matchUpStatus=c),i&&(n.matchUpFormat=i),a&&(n.matchUpStatusCodes=a),l&&(n.winningSide=l),e.removeWinningSide&&(n.winningSide=void 0),!t&&s&&({structure:t}=Aw({drawDefinition:s,matchUpId:d,event:p})),c&&!n.winningSide&&qy(n)&&!If.includes(c)&&![Qm,uf,of].includes(c)&&(n.matchUpStatus=af),(y&&n?.processCodes?.length||c===tf)&&(I=h?.[Hp]?.processCodes?.incompleteAssignmentsOnDefault),!n.collectionId){let e=t?.structureType===Wl,a=jg({structure:t});if(Vg({drawDefinition:s,structure:t})||a||e){let c=(e=>{i=g?"SET1-S:T100":i??n.matchUpFormat??e?.matchUpFormat??s?.matchUpFormat??p?.matchUpFormat;let t=g?{matchUpTypes:[Yr]}:void 0,{matchUps:r}=Uy({afterRecoveryTimes:!1,tournamentRecord:o,inContext:!0,matchUpFilters:t,drawDefinition:s,structure:e,event:p});return a&&(e.positionAssignments=vi(r.flatMap(e=>(e.sides??[]).map(e=>e.participantId)).filter(Boolean)).map(e=>({participantId:e}))),Mw({positionAssignments:e.positionAssignments,tournamentRecord:o,drawDefinition:s,matchUpFormat:i,matchUps:r,event:p})})(e&&t.structures.find(e=>e?.matchUps.find(e=>e.matchUpId===d))||t);if(c.error)return ac({result:c,stack:r})}}if(m){let e=Cw({element:n,notes:m});if(e.error)return ac({result:e,stack:r})}let v=o?.tournamentId,S=Ws().topics.includes(ih),b=(S||I)&&kg({drawDefinition:s}),U=b&&Cy({matchUpFilters:{matchUpIds:[d]},nextMatchUps:!0,tournamentRecord:o,inContext:!0,drawDefinition:s,matchUpsMap:b}).matchUps?.[0];if(S&&U&&function({tournamentId:e,inContextMatchUp:t}){t&&Bs({payload:{inContextMatchUp:t,tournamentId:e},topic:ih,key:t.matchUpId})}({tournamentId:v,inContextMatchUp:U}),Array.isArray(I)&&U&&!U.sides?.every(({participantId:e})=>e))if(c===tf)n.processCodes=vi([...n.processCodes??[],...I]);else for(let w of I||[]){let e=w&&n?.processCodes?.lastIndexOf(w);n?.processCodes?.splice(e,1)}return ch({eventId:p?.eventId,context:r,drawDefinition:s,tournamentId:v,matchUp:n}),{...Gi}}function Fw(e){let{propagateExitStatus:t,matchUpStatusCodes:r,autoCalcDisabled:i,inContextMatchUp:n,matchUpStatus:a,dualMatchUp:o,structure:s,matchUp:c}=e,u=Hy({matchUpStatus:a})||[Jm,Xm].includes(a)&&o||i,l=c?.sides?.map(e=>e.participantId).filter(Boolean).length||n?.sides?.map(e=>e.participantId).filter(Boolean).length,d="attemptToModifyScore";if(!(jg({structure:s})&&1===l||a===tf&&l||function({structure:e,matchUp:t,inContextMatchUp:r}){let{drawPositions:i}=t,{positionAssignments:n}=Nf({structure:e}),a=n?.filter(e=>i?.includes(e.drawPosition)&&e.participantId),o=r?.sides?.every(e=>e.participantId);return 2===a?.length||o}({structure:s,matchUp:c,inContextMatchUp:n})||!1===e.appliedPolicies?.[Hp]?.requireParticipantsForScoring||rv(a)&&1===l&&t))return ac({result:{error:zn},stack:d});let p=[df].includes(a),m=u?a:e.winningSide&&Zm||of;return ac({result:Ow({...e,winningSide:e.winningSide,matchUpStatusCodes:u&&r||[],matchUpStatus:m,removeScore:p}),stack:d})}function _w({collectionGroups:e=[]}){let t=Object.assign({},...e.filter(e=>gi(e?.groupValue)&&e?.groupNumber).map(e=>({[e.groupNumber]:{...e,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}})));return{groupValueGroups:t,groupValueNumbers:Object.keys(t).map(e=>Jr(e))}}function Lw({collectionDefinition:e,groupValueNumbers:t,groupValueGroups:r,sideTieValues:i,tieMatchUps:n}){let a=n.filter(t=>t.collectionId===e.collectionId),o=[0,0],s=[0,0],c=a.every(e=>If.includes(e.matchUpStatus)),{collectionValueProfiles:u,collectionGroupNumber:l,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:f,setValue:h}=e,g=l&&t.includes(l),I=[0,0];if(a.forEach(e=>{e.winningSide&&(I[e.winningSide-1]+=1)}),gi(p)?a.forEach(e=>{e.winningSide&&(o[e.winningSide-1]+=p)}):gi(h)?a.forEach(e=>{e.score?.sets?.forEach(e=>{e.winningSide&&(o[e.winningSide-1]+=h)})}):gi(f)?a.forEach(e=>{e.score?.sets?.forEach(t=>{let{side1TiebreakScore:r=0,side2TiebreakScore:i=0,side1Score:n=0,side2Score:a=0}=t;(e.matchUpStatus===Zm||e.winningSide||t.winningSide)&&(n||a?(o[0]+=n,o[1]+=a):(r||i)&&t.winningSide&&(o[t.winningSide-1]+=1))})}):Array.isArray(u)&&a.forEach(t=>{if(t.winningSide){let r=t.collectionPosition,i=function({collectionDefinition:e,collectionPosition:t}){return(e.collectionValueProfiles||[])?.find(e=>e.collectionPosition===t)?.matchUpValue}({collectionDefinition:e,collectionPosition:r});gi(i)&&(o[t.winningSide-1]+=i)}}),gi(d)){let t;if(m?.aggregateValue)c&&(gi(p||h||f)&&o[0]!==o[1]?t=o[0]>o[1]?1:2:I[0]!==I[1]&&(t=I[0]>I[1]?1:2));else if(m?.valueGoal)t=o.reduce((e,t,r)=>t>=m.valueGoal?r+1:e,0);else{let r=Math.floor(e.matchUpCount/2)+1;t=I.reduce((e,t,i)=>t>=r?i+1:e,0)}t&&(g?r[l].values[t-1]+=d:s[t-1]+=d)}else g?(r[l].values[0]+=o[0]||0,r[l].values[1]+=o[1]||0):s=o;g?(r[l].sideWins[0]+=I[0]||0,r[l].sideWins[1]+=I[1]||0,r[l].allGroupMatchUpsCompleted=r[l].allGroupMatchUpsCompleted&&c,r[l].matchUpsCount+=a.length):s.forEach((e,t)=>i[t]+=e||0)}function Bw(e){let{sideAdjustments:t=[0,0],separator:r="-",drawDefinition:i,matchUpsMap:n,structure:a,matchUp:o,event:s}=e;if(!Array.isArray(t)||2!==t.length||Number.isNaN(t.reduce((e,t)=>e+t)))return{error:Zo};if(!o)return{error:ma};let c=Cg({matchUp:o,drawDefinition:i,structure:a,event:s})?.tieFormat||e?.tieFormat;if(!c)return{error:ca};let u=bu({tieFormat:c});if(u.error)return u;let l=c?.collectionDefinitions||[],d=o?.tieMatchUps??[],p=[0,0],{groupValueGroups:m,groupValueNumbers:f}=_w(c);for(let S of l)Lw({collectionDefinition:S,groupValueNumbers:f,groupValueGroups:m,sideTieValues:p,tieMatchUps:d});for(let S of f){let e,t=m[S],{allGroupMatchUpsCompleted:r,matchUpCount:i,winCriteria:n,groupValue:a,sideWins:o,values:s}=t;if(n?.aggregateValue)r&&s[0]!==s[1]&&(e=s[0]>s[1]?1:2);else if(n?.valueGoal)e=s.reduce((e,t,r)=>t>=n.valueGoal?r+1:e,void 0);else{let t=Math.floor(i/2)+1;e=o.reduce((e,r,i)=>r>=t?i+1:e,void 0)}e&&(p[e-1]+=a||0)}let h,g=p.map((e,r)=>(e||0)+t[r]),I={side1Score:g[0],side2Score:g[1],winningSide:void 0},y=g.join(r),v=g.slice().reverse().join(r);if(c?.winCriteria){let{valueGoal:e,aggregateValue:t,tallyDirectives:r}=c.winCriteria;if(e?h=g.map((e,t)=>({sideNumber:t+1,points:e})).find(({points:t})=>t>=e)?.sideNumber:t&&d.every(e=>e.matchUpStatus&&If.includes(e.matchUpStatus)||e.winningSide)&&g[0]!==g[1]&&(h=g[0]>g[1]?1:2),!h&&r){let e=o.matchUpId,t=o.hasContext?o:n?.drawMatchUps?.[e]||i&&Aw({inContext:!0,drawDefinition:i,matchUpId:e})?.matchUp;if(t){let{completedTieMatchUps:e,order:r}=Qv({matchUps:[t]});if(e&&r?.length){let e=r[0].participantId;h=t.sides.find(({participantId:t})=>t===e)?.sideNumber}}}}return h&&(I.winningSide=h),{scoreStringSide1:y,scoreStringSide2:v,winningSide:h,set:I}}function $w({inContextDualMatchUp:e,drawDefinition:t,tournamentId:r,dualMatchUp:i,eventId:n}){if(i){e||(e=Aw({matchUpId:i.matchUpId,inContext:!0,drawDefinition:t})?.matchUp);let{extension:a}=lm({element:t,name:Um}),o=Nu(a?.value||{},!1,!0),s=({displaySideNumber:e,drawPosition:t,sideNumber:r})=>({drawPosition:t,sideNumber:r,displaySideNumber:e});i.sides=e?.sides?.map(e=>{let t=e.participantId,r=t&&o[t]||void 0,{lineUp:n,...a}=i.sides?.find(({sideNumber:t})=>t===e.sideNumber)??{},c=n?.length?n:r;return{...s(e),...a,lineUp:c}}),ch({context:"ensureSidLineUps",matchUp:i,drawDefinition:t,tournamentId:r,eventId:n})}}function Vw(e){if(e)return Nu(e,!1,!0)}function jw(e){let t=Dp(e,[{[Rd]:!0}]);return t.error?t:Object.keys(e.tournamentRecords).reduce((t,r)=>{t.tournamentIdMap[r]=[];let i=e.tournamentRecords[r].events??[],n=i.map(({eventId:e})=>e),a=i.map(e=>(e.drawDefinitions??[]).map(({drawId:e})=>e)).flat();return t.tournamentIdMap[r].push(...n,...a),t.eventIds.push(...n),t.drawIds.push(...a),t},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Gw({tournamentRecords:e,eventId:t,drawId:r}){let{tournamentIdMap:i}=jw({tournamentRecords:e});return(i?Object.keys(i):[]).find(e=>t&&i?.[e].includes(t)||r&&i?.[e].includes(r))}function Ww(e){let{exitWhenNoValues:t,drawDefinition:r,matchUpStatus:i,removeScore:n,matchUpsMap:a,matchUpId:o,event:s}=e,c=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord?.tournamentId]:e.tournamentRecord}||{},u=e.tournamentId||e.tournamentRecord?.tournamentId;c&&Gw({tournamentRecords:c,...e});let l=u&&c[u];if(!l)return{error:Ji};let d=Aw({drawDefinition:r,event:s,matchUpId:o});if(d.error)return d;if(!d.matchUp)return{error:da};let{matchUp:p,structure:m}=d;if(!p.tieMatchUps)return{error:fa};$w({tournamentId:l?.tournamentId,eventId:s?.eventId,dualMatchUp:p,drawDefinition:r});let{extension:f}=lm({name:hm,element:p});if(f?.value){if(!n)return{...Gi,score:p.score};Jp({element:p,name:hm})}let h=Cg({drawDefinition:r,structure:m,matchUp:p,event:s})?.tieFormat;p.tieFormat=Vw(h);let g=Bw({drawDefinition:r,matchUpsMap:a,structure:m,matchUp:p,event:s}),{winningSide:I,set:y,scoreStringSide1:v,scoreStringSide2:S}=g,b=y?.side1Score||y?.side2Score;if(t&&!p.score&&!b)return{...Gi};let U,w={scoreStringSide1:v,scoreStringSide2:S,sets:y?[y]:[]},T=I&&[1,2].includes(I),D=T&&Zm||Yy({matchUpStatus:i??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&af||lf,P=!(!p.winningSide||T),N=p.tieMatchUps.find(({score:e,winningSide:t,matchUpStatus:r})=>e?.sets?.length&&(e.sets[0].side1Score||e.sets[0].side2Score)||r&&If.includes(r)||t);if(p.tieFormat&&!T&&!N){let e=Cg({drawDefinition:r,structure:m,event:s})?.tieFormat;e&&JSON.stringify(h)===JSON.stringify(e)&&(p.tieFormatId=void 0,p.tieFormat=void 0,U=!0)}return Ow({appliedPolicies:e.appliedPolicies,matchUpStatus:D,score:w,removeWinningSide:P,tournamentRecord:l,drawDefinition:r,removeScore:n,winningSide:I,matchUpId:o,matchUp:p,event:s}),{...Gi,score:w,removeWinningSide:P,tieFormatRemoved:U,winningSide:I}}function qw(e){let t="directParticipants",r=Fw(e);if(r.error)return ac({result:r,stack:t});let i,n=Hy({matchUpStatus:e.matchUpStatus}),{dualWinningSideChange:a,inContextDrawMatchUps:o,projectedWinningSide:s,propagateExitStatus:c,matchUpStatusCodes:u,tournamentRecord:l,drawDefinition:d,matchUpStatus:p,dualMatchUp:m,matchUpsMap:f,winningSide:h,targetData:g,matchUpId:I,structure:y,matchUp:v,event:S}=e,b=!!v.collectionId,U=jg({structure:y}),w=v.drawPositions;if(b){let{matchUpTieId:r,matchUpsMap:n}=e,s=Ww({appliedPolicies:e.appliedPolicies,matchUpId:r,tournamentRecord:l,drawDefinition:d,matchUpsMap:n,event:S});if(i=s&&{tieMatchUpResult:s},w=o.find(({matchUpId:e})=>e===r)?.drawPositions,!a)return ac({result:{...Gi,...i},stack:t})}if(U)return ac({result:{...Gi,...i},stack:t});if(w){let e=s?s-1:h-1,r=1-e,a=w[e],y=w[r],v={},{targetLinks:{loserTargetLink:b,winnerTargetLink:U,byeTargetLink:T},targetMatchUps:{winnerMatchUpDrawPositionIndex:D,loserMatchUpDrawPositionIndex:P,winnerMatchUp:N,loserMatchUp:E,byeMatchUp:M}}=g;if(N){let e=function({winnerMatchUpDrawPositionIndex:e,inContextDrawMatchUps:t,projectedWinningSide:r,sourceMatchUpStatus:i,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:c,winnerMatchUp:u,dualMatchUp:l,matchUpsMap:d,event:p}){let m="directWinner";if(o){let r=u.drawPositions||[],l=r[e],f=o.source.structureId,h=wf({structureId:f,drawDefinition:c});if(h.error)return h;let{structure:g}=h,{positionAssignments:I}=Nf({structureId:f,drawDefinition:c}),y=I?.find(e=>e.drawPosition===n)?.participantId,v=o.target.structureId,{positionAssignments:S}=Nf({structureId:v,drawDefinition:c}),b=S?.find(e=>e.participantId===y)?.drawPosition,U=S?.filter(e=>{let t=r.includes(e.drawPosition),i=!e.participantId&&!e.bye&&!e.qualifier;return t&&i}).map(e=>e.drawPosition),w=U?.includes(l);if(y&&1===o.target.roundNumber&&w)Cb({drawPosition:l,participantId:y,structureId:v,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:a,drawDefinition:c,matchUpsMap:d,event:p});else if(y&&U?.length){let e=U.pop();e&&Cb({participantId:y,structureId:v,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:a,drawDefinition:c,drawPosition:e,matchUpsMap:d,event:p})}else if(b){let e=Db({drawPosition:b,matchUpId:u.matchUpId,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:c,matchUpsMap:d});if(e.error)return ac({result:e,stack:m})}else if(g?.stage!==Ml){let e="winner target position unavaiallble";console.log(e),ac({stack:m,result:{error:e}})}if(g?.seedAssignments&&g.structureId!==v){let e=g.seedAssignments.find(({participantId:e})=>e===y),t=e?.participantId;e&&t&&vb({eventId:u?.eventId,structureId:v,...e,tournamentRecord:a,drawDefinition:c,participantId:t})}}else{let e=Db({matchUpId:u.matchUpId,drawPosition:n,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:c,matchUpsMap:d});if(e.error)return e}if(l&&r){let e=l.sides?.find(e=>e.sideNumber===r);if(e?.lineUp){let t=l.roundPosition,r=u.roundPosition,i=t===r&&1!==t||Math.floor(t/2)===r?2:1,n=d?.drawMatchUps?.find(({matchUpId:e})=>e===u.matchUpId),o=[1,2].map(e=>({...n.sides?.find(t=>t.sideNumber===e)||{},sideNumber:e}));n.sides=o;let s=n.sides.find(e=>e.sideNumber===i);if(s){let t=e.lineUp?.filter(e=>e?.participantId);s.lineUp=Nb({lineUp:t}),ch({tournamentId:a?.tournamentId,eventId:u?.eventId,matchUp:n,context:m,drawDefinition:c})}}}return{...Gi}}({sourceMatchUpStatus:n&&p||Zm,winnerMatchUpDrawPositionIndex:D,sourceMatchUpId:I,inContextDrawMatchUps:o,projectedWinningSide:s,winningDrawPosition:a,tournamentRecord:l,winnerTargetLink:U,drawDefinition:d,winnerMatchUp:N,dualMatchUp:m,matchUpsMap:f,event:S});if(e.error)return ac({result:e,stack:t})}if(E){let e=function(e){let{loserMatchUpDrawPositionIndex:t,inContextDrawMatchUps:r,projectedWinningSide:i,propagateExitStatus:n,sourceMatchUpStatus:a,loserDrawPosition:o,tournamentRecord:s,loserTargetLink:c,drawDefinition:u,loserMatchUp:l,dualMatchUp:d,matchUpsMap:p,event:m}=e,f="directLoser",h=c.linkCondition,g=l.drawPositions||[],I=h===Jl&&2===l.roundNumber&&Math.min(...g.filter(Boolean)),y=I||g[t],v=I||g[1-t],S=c.source.structureId,{structure:b}=wf({structureId:S,drawDefinition:u}),{matchUps:U}=Uy({afterRecoveryTimes:!1,inContext:!0,drawDefinition:u,structure:b,event:m}),w=U.filter(e=>e.drawPositions?.includes(o)).filter(e=>{let t=e.sides.find(e=>e.drawPosition===o),r=e.matchUpStatus===df||e.matchUpStatus===tf&&!qy(e);return t?.sideNumber===e.winningSide&&!r}),T=h===Jl&&0===w.length,{positionAssignments:D}=Nf({structureId:S,drawDefinition:u}),P=D?.find(e=>e.drawPosition===o)?.participantId,N={loserParticipantId:P},E=c.target.structureId,{positionAssignments:M}=Nf({structureId:E,drawDefinition:u}),R=M?.filter(({drawPosition:e})=>g.includes(e)),A=R?.some(e=>e.participantId&&P&&e.participantId===P),C=n&&[cf,df,tf].includes(a||"");if(A)return{...Gi,stack:f};let k=R?.filter(e=>{let t=g.includes(e.drawPosition),r=!e.participantId&&!e.bye&&!e.qualifier;return t&&r}).map(e=>e.drawPosition),x=k?.includes(y),O=c.target.roundNumber>1&&k?.length,F=1===c.target.roundNumber&&x;if(I){let e=function(){let e="loserLinkFedFMLC";return ac(T?{result:L(),stack:e}:{result:_(),stack:e})}();if(e.context&&Object.assign(N,e.context),e.error)return ac({result:e,stack:f})}else if(F){let e=L();if(e.context&&Object.assign(N,e.context),e.error)return ac({result:e,stack:f})}else{if(!P||!O)return ac({context:{loserDrawPosition:o,loserTargetLink:c,targetDrawPositionIsUnfilled:x},result:{error:x?In:gn},stack:f});{k.sort(Qr);let e=k[0],t=Cb({participantId:P,structureId:E,drawPosition:e,inContextDrawMatchUps:r,sourceMatchUpStatus:a,tournamentRecord:s,drawDefinition:u,matchUpsMap:p,event:m});if(t.error)return ac({result:t,stack:f});if(!t.error&&C&&n)return{stack:f,context:{progressExitStatus:!0,loserParticipantId:P}}}}if(b?.seedAssignments&&b.structureId!==E){let e=b.seedAssignments.find(({participantId:e})=>e===P),t=e?.participantId;e&&t&&vb({eventId:l?.eventId,structureId:E,...e,tournamentRecord:s,drawDefinition:u,participantId:t})}if(d&&i){let e=d.sides?.find(e=>e.sideNumber===3-i);if(e?.lineUp){let{roundNumber:t,eventId:r}=l,{roundPosition:i}=d,n=1===t?2-i%2:1,a=p?.drawMatchUps?.find(({matchUpId:e})=>e===l.matchUpId),o=[1,2].map(e=>({...a.sides?.find(t=>t.sideNumber===e)||{},sideNumber:e}));a.sides=o;let c=a.sides.find(e=>e.sideNumber===n);c&&(c.lineUp=Nb({lineUp:e.lineUp}),ch({tournamentId:s?.tournamentId,matchUp:a,context:f,drawDefinition:u,eventId:r}))}}return ac({result:{...Gi},stack:f,context:N});function _(){return ac({result:iv({drawPosition:v,structureId:E,tournamentRecord:s,drawDefinition:u,event:m}),stack:"assignLoserPositionBye"})}function L(){let e=P?Cb({drawPosition:y,participantId:P,structureId:E,inContextDrawMatchUps:r,sourceMatchUpStatus:a,tournamentRecord:s,drawDefinition:u,matchUpsMap:p,event:m}):{error:Za};return!e.error&&C&&n?{stack:f,context:{progressExitStatus:!0}}:ac({result:e,stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:n&&p||Zm,loserMatchUpDrawPositionIndex:P,inContextDrawMatchUps:o,projectedWinningSide:s,propagateExitStatus:c,loserDrawPosition:y,tournamentRecord:l,loserTargetLink:b,drawDefinition:d,loserMatchUp:E,matchUpsMap:f,dualMatchUp:m,event:S});if(e.context?.progressExitStatus&&Object.assign(v,e.context,{sourceMatchUpStatus:n&&p||Zm,sourceMatchUpStatusCodes:u||[],loserMatchUp:E,matchUpsMap:f}),e.error)return ac({result:e,stack:t})}if(M){let e=M.drawPositions||[],r=iv({drawPosition:Math.min(...e.filter(Boolean)),structureId:T.target.structureId,tournamentRecord:l,drawDefinition:d,event:S});if(r.error)return ac({result:r,stack:t})}return ac({result:{...Gi,...i},stack:t,context:v})}return ac({result:{error:fn},stack:t})}function Hw(e){let t="genPlayoffStructure";if(!e.drawDefinition)return ac({result:{error:rn},stack:t});let r=bw(e);if(r.error)return ac({result:r,stack:t});let{structureId:i,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:c,playoffPositions:u,roundOffsetLimit:l,tournamentRecord:d,exitProfileLimit:p,roundProfiles:m,roundNumbers:f,idPrefix:h,isMock:g,event:I,uuids:y}=e,v=Nu(e.drawDefinition,!1,!0),{structure:S}=wf({structureId:i,drawDefinition:v});if(!S)return ac({result:{error:Fn},stack:t});if(S.structureType===Wl||S.structures)return function(e){let t="generateAndPopulateRRplayoffStructures";if(!e.playoffGroups)return ac({result:{error:Da},info:"playoffGroups required",stack:t});let{sourceStructureId:r,requireSequential:i,tournamentRecord:n,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:c,event:u}=e,l=Nw({requireSequential:i,sourceStructureId:r,playoffGroups:o,groupCount:s,...e});if(l.error)return ac({result:l,stack:t});let{structures:d=[],links:p=[],finishingPositionTargets:m,positionRangeMap:f}=l,h=m?.flatMap(({finishingPositions:e})=>e).flatMap(e=>f[e].finishingPositions);a.structures.push(...d),a.links.push(...p);let{matchUps:g,matchUpsMap:I}=Cy({inContext:!0,drawDefinition:a}),y=new Set(d.map(({structureId:e})=>e)),v=g?.filter(({structureId:e})=>y.has(e)).map(zm),S=I?.drawMatchUps?.filter(({matchUpId:e})=>v?.includes(e));if(S?.length){let t=Cg({drawDefinition:a,event:u})?.tieFormat;t&&S.forEach(r=>{let{tieMatchUps:i}=nw({isMock:e.isMock,tieFormat:t,matchUp:r});Object.assign(r,{tieMatchUps:i,matchUpType:zr})})}let{positionAssignments:b}=Pf({structureId:r,drawDefinition:a}),U={};b?.forEach(e=>{let t=lm({element:e,name:Cm})?.extension?.value?.groupOrder;t&&(U[t]||(U[t]=[]),U[t].push(e.participantId))});let w=yU({provisionalPositioning:e.provisionalPositioning,structureId:r,applyPositioning:!0,event:e.event,tournamentRecord:n,drawDefinition:a});return w.error&&w.error?.code!==sn.code?ac({result:w,stack:t}):{structures:d,links:p,positionsPlayedOff:h,drawDefinition:a,...Gi}}({sourceStructureId:S.structureId,...e,...r,drawDefinition:v});let{playoffRoundsRanges:b,playoffRounds:U}=r,{playoffPositionsReturned:w,error:T,playoffSourceRounds:D,playoffRoundsRanges:P}=Sw(e);if(T)return ac({result:{error:T},stack:t});let N=m?.length&&Object.assign({},...m),E=f||"object"==typeof m&&m.map(e=>Object.keys(e)).flat(),M=Array.isArray(E)&&E.map(e=>!isNaN(e)&&Jr(e)).filter(Boolean);if(M){if(!Array.isArray(M))return ac({result:{error:Zo},context:{validRoundNumbers:M},stack:t});M.forEach(e=>{if(!U?.includes(e))return ac({result:{error:Zo},context:{roundNumber:e},stack:t})})}u&&u.forEach(e=>{if(!w?.includes(e))return ac({result:{error:Zo},context:{playoffPosition:e},stack:t})});let R=M||D,A=M?b:P,C=[],k=[];for(let G of R??[]){let e=A?.find(e=>e.roundNumber===G);if(!e)return ac({result:{error:Zo},context:{roundNumber:G},stack:t});let r=e.finishingPositions.length,u=Math.min(...e.finishingPositions)-1,d=2,m=G&&N?.[G]&&d+N[G]-1,f=fw({exitProfile:`0-${G}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:u,playoffAttributes:c,exitProfileLimit:p,stage:Cl,roundOffset:0,drawDefinition:v,sequenceLimit:m,stageSequence:d,drawSize:r,idPrefix:h,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:l});if(f.error)return ac({result:f,stack:t});let{structures:I,links:S}=f;if(I?.length&&C.push(...I),S?.length&&k.push(...S),f.structureId&&G){let e={linkType:Ql,source:{structureId:i,roundNumber:G},target:{structureId:f.structureId,feedProfile:zl,roundNumber:1}};k.push(e)}}if(!C.length)return ac({result:{error:Zo},info:"No structures generated",stack:t});v.structures.push(...C),v.links.push(...k);let{matchUps:x,matchUpsMap:O}=Cy({inContext:!0,drawDefinition:v}),F=C.map(({structureId:e})=>e),_=x?.filter(({structureId:e})=>F.includes(e)).map(zm),L=O?.drawMatchUps?.filter(({matchUpId:e})=>_?.includes(e));if(L?.length){let e=Cg({drawDefinition:v,event:I})?.tieFormat;e&&L.forEach(t=>{let{tieMatchUps:r}=nw({matchUp:t,tieFormat:e,isMock:g});Object.assign(t,{tieMatchUps:r,matchUpType:Yr})})}x?.filter(e=>wy({matchUp:e})&&e.structureId===i)?.forEach(e=>{let{matchUpId:t,score:r,winningSide:i}=e,n=Ey({inContextDrawMatchUps:x,drawDefinition:v,matchUpId:t}),a=qw({inContextDrawMatchUps:x,tournamentRecord:d,drawDefinition:v,matchUpsMap:O,winningSide:i,targetData:n,matchUpId:t,structure:S,matchUp:e,score:r,event:I});a.error&&console.log(a.error)}),x?.filter(e=>"BYE"===e.matchUpStatus&&e.structureId===i)?.forEach(e=>{let{matchUpId:t}=e,r=Ey({inContextDrawMatchUps:x,drawDefinition:v,matchUpId:t}),{targetLinks:{loserTargetLink:i},targetMatchUps:{loserMatchUpDrawPositionIndex:n,loserMatchUp:a}}=r;if(i&&a){let e=i.target.structureId,t=iv({drawPosition:a.drawPositions[n],structureId:e,tournamentRecord:d,drawDefinition:v,event:I});t.error&&console.log(t.error)}});let B=[],$=Gy({inContextDrawMatchUps:x,drawDefinition:v,matchUpsMap:O}).goesToMap,{structure:V}=wf({drawDefinition:e.drawDefinition,structureId:i}),{matchUps:j}=Uy({structure:V});return j.forEach(r=>{let i=$?.loserMatchUpIds[r.matchUpId];if(i&&r.loserMatchUpId!==i){r.loserMatchUpId=i;let n={tournamentId:d?.tournamentId,eventId:e.event?.eventId,context:t,matchUp:r};B.push(n)}let n=$?.winnerMatchUpIds[r.matchUpId];if(n&&r.winnerMatchUpId!==n){r.winnerMatchUpId=n;let i={tournamentId:d?.tournamentId,eventId:e.event?.eventId,context:t,matchUp:r};B.push(i)}}),{structures:C,matchUpModifications:B,links:k,drawDefinition:v,...Gi}}function zw({element:e}){if(!e)return{error:Zo};if(!e.timeItems)return{};if(!Array.isArray(e.timeItems))return{error:Zo};return e.timeItems.reduce((t="itemType",r="itemValue",(e,i)=>(i[t]&&(e[i[t]]=i[r]),e)),{});var t,r}function Yw(e){let{duplicateValues:t=!0,creationTime:r=!0,removePriorValues:i,timeItem:n}=e;if(!n)return{error:Bo};let a=xh(e);if(a.error)return a;if(!(ti(n)&&ei(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:_o};if(a.timeItems){if(function({element:e,duplicateValues:t,timeItem:r}){let{itemType:i,itemSubTypes:n,itemValue:a}=r,o=i&&Oh({itemSubTypes:n,itemType:i,element:e})?.timeItem;return o&&JSON.stringify(o?.itemValue)===JSON.stringify(a)&&!t}({element:a,duplicateValues:t,timeItem:n}))return{...Gi}}else a.timeItems=[];if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,r){let e=(new Date).toISOString();Object.assign(n,{createdAt:e})}return i&&(a.timeItems=a.timeItems.filter(({itemType:e})=>n.itemType!==e)),i&&!n.itemValue||a.timeItems.push(n),{...Gi}}function Kw({creationTime:e=!0,removePriorValues:t,tournamentRecord:r,duplicateValues:i,participantId:n,timeItem:a}){if(!r)return{error:Ji};if(!n)return{error:Za};let o=kh({tournamentRecord:r,participantId:n});return o.error?o:Yw({element:o.participant,removePriorValues:t,duplicateValues:i,creationTime:e,timeItem:a})}function Xw(e){let{removePriorValues:t,tournamentRecord:r,duplicateValues:i,creationTime:n,timeItem:a}=e;if(!r)return{error:Ji};let o=Yw({element:r,removePriorValues:t,duplicateValues:i,creationTime:n,timeItem:a});if(o.error)return o;let s=zw({element:r});return Bs({payload:{parentOrganisation:r.parentOrganisation,tournamentId:r.tournamentId,timeItemValues:s},topic:zf}),o}function Qw(e){let{removePriorValues:t,duplicateValues:r,creationTime:i,timeItem:n,event:a}=e;return a?Yw({removePriorValues:t,duplicateValues:r,element:a,creationTime:i,timeItem:n}):{error:Gn}}function Jw(e){return eT({...e,itemType:"attachConsolationStructures"})}function Zw(e){return eT({...e,itemType:"attachPlayoffStructures"})}function eT({itemType:e="attachStructures",matchUpModifications:t,tournamentRecord:r,drawDefinition:i,structures:n,links:a=[],event:o}){let s="attachStructures";if(!i)return{error:rn};if(!Array.isArray(n)||!Array.isArray(a))return ac({result:{error:Zo},stack:s});let c=e=>[e.source.structureId,e.source.roundNumber||e.source.finishingPositions?.join("|"),e.target.roundNumber].join("|"),u=i.links?.map(c);if(a.some(e=>{let t=c(e);return u?.includes(t)}))return ac({result:{error:ps},info:"playoff structure exists",stack:s});a.length&&i.links?.push(...a);let l=n.map(({structureId:e})=>e),d=i.structures?.map(({structureId:e})=>e);i.structures=(i.structures??[]).map(e=>l.includes(e.structureId)?n.find(({structureId:t})=>t===e.structureId):e);let p=n?.filter(({structureId:e})=>!d?.includes(e));p.length&&i.structures.push(...p),Gy({drawDefinition:i});let m=n.map(e=>Uy({structure:e})?.matchUps||[]).flat();oh({tournamentId:r?.tournamentId,eventId:o?.eventId,drawDefinition:i,matchUps:m});let f=n.map(({structureId:e})=>e);if(lh({drawDefinition:i,structureIds:f}),t?.length){let e={};t.forEach(t=>{let r=t.matchUp?.matchUpId;r&&(e[r]=t)});let r=t=>{t.matchUps.forEach(t=>{if(e[t.matchUpId]){let{tieMatchUps:r,...i}=e[t.matchUpId].matchUp;if(Object.assign(t,i),r?.length){let i={};r.forEach(t=>e[t.matchUpId]=t),t.tieMatchUps.forEach(e=>Object.assign(e,i[e.matchUpId]))}e[t.matchUpId].matchUp=t,ch(e[t.matchUpId])}})};i.structures.forEach(e=>{if(d?.includes(e.structureId))if(e.structures)for(let t of e.structures)r(t);else r(e)})}let h=p.map(Vy("structureId"));if(r){Yw({element:r,timeItem:{itemValue:{structureIds:f,drawId:i.drawId},itemType:e}})}return{...Gi,addedStructureIds:h}}function tT(e){let{structures:t,links:r,matchUpModifications:i,error:n}=Hw(e);if(n)return{error:n};let a=e.drawDefinition;return Zw({tournamentId:e.tournamentRecord?.tournamentId,eventId:e.event?.eventId||e.eventId,matchUpModifications:i,drawDefinition:a,structures:t,links:r})}function rT(e){let t=Dp(e,[{_anyOf:{[Rd]:!1,[Cd]:!1,[xd]:!1,[cp]:!1},[Ad]:!0}]);if(t.error)return t;let r=[],i=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(i){let t=iT(e,i);if(t.error)return t;r.push(...t?.applied??[]),e.drawDefinition&&lh({drawDefinition:e.drawDefinition,tournamentId:e.tournamentId})}else{if(!e.tournamentRecords)return{error:Ji};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:Ji};for(let i of t){let t=iT(e,e.tournamentRecords[i]);if(t.error)return t;r.push(...t?.applied??[])}}}return r.length?{...Gi,applied:r}:{error:Sa}}function iT(e,t){let r=zh(e).appliedPolicies??{};t.extensions||(t.extensions=[]);let i=[],n=Object.keys(e.policyDefinitions);if(!n.length)return{error:ga};for(let a of n)if(!r[a]||e.allowReplacement){let t=e.policyDefinitions[a];if(!t)continue;if(!ti(t))return{error:Zo};let{policyName:n,...o}=t;if(!o||!Object.keys(o).length||n&&!ei(n))return{error:Zo};r[a]=e.policyDefinitions[a],i.push(a)}return i?.length?{...em({element:t,extension:{name:dm,value:r}}),applied:i}:{applied:i,error:Sa}}function nT({tournamentRecord:e,drawDefinition:t,flightProfile:r,drawName:i,drawId:n,event:a}){if(!i||"string"!=typeof i)return ac({result:{error:Zo},context:{drawName:i}});r||(r=py({event:a}).flightProfile);let o=r?.flights?.find(e=>e.drawId===n);if(o){o.drawName=i,im({event:a,extension:{name:Sm,value:{...r,flights:r.flights}}})}return t&&(t.drawName=i,lh({tournamentId:e?.tournamentId,drawDefinition:t})),o||t?{...Gi,flight:o}:{error:rn}}function aT({tournamentRecord:e,drawDefinition:t,drawUpdates:r,drawId:i,event:n}){if(!ti(r))return{error:Zo};let a=py({event:n}).flightProfile,o=r.drawName&&nT({drawName:r.drawName,tournamentRecord:e,drawDefinition:t,flightProfile:a,drawId:i,event:n});if(o?.error)return o?.error;let s=o?.flight||a?.flights?.find(e=>e.drawId===i);if(!s&&!t)return{error:rn};if(s){im({event:n,extension:{name:Sm,value:{...a,flights:a.flights}}})}return t&&(r.policyDefinitions&&rT({policyDefinitions:r.policyDefinitions,drawDefinition:t}),lh({tournamentId:e?.tournamentId,drawDefinition:t})),{...Gi}}function oT({tournamentRecord:e,removeScheduling:t,drawDefinition:r}){if(!r)return{error:rn};let i=kg({drawDefinition:r}),n=e=>i?.drawMatchUps?.find(t=>t.matchUpId===e);for(let a of r.structures||[]){let{positionAssignments:o,stage:s,stageSequence:c}=a;o&&(1!==c||![Ml,El].includes(s))&&(a.positionAssignments=o.map(e=>(delete e.participantId,e)),a.seedAssignments=[]);let{matchUps:u,isRoundRobin:l}=Uy({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:i,structure:a});for(let i of u){let{matchUpId:a,roundNumber:o}=i,s=i.sides||[],c=n(a);if(c){if(delete c.extensions,delete c.notes,"BYE"!==c.matchUpStatus&&Object.assign(c,xw),o&&o>1&&c.drawPositions?.length&&!l){let e=s?.map(({drawPosition:e,participantFed:t})=>!t&&e).filter(Boolean),t=c.drawPositions.map(t=>e.includes(t)?void 0:t);c.drawPositions=t}t?delete c.timeItems:c.timeItems?.length&&(c.timeItems=c.timeItems.filter(e=>e.itemType&&![rI,iI,tI,sI,aI,cI].includes(e.itemType))),ch({tournamentId:e?.tournamentId,context:"resetDrawDefiniton",drawDefinition:r,matchUp:c})}}}return r.extensions=r.extensions.filter(e=>e.name!==Pm),lh({drawDefinition:r,structureIds:(r.structures||[]).map(({structureId:e})=>e)}),{...Gi}}function sT({tournamentRecord:e}){if(!e)return{error:Ji};let t={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},r={};return(e.events?.flatMap(e=>{let t=e.eventId;return r[t]=e,(e?.drawDefinitions||[]).map(e=>({drawDefinition:e,eventId:t}))}).filter(Boolean)).forEach(({drawDefinition:e,eventId:i})=>{let n=0,a=0,o=0,{allStructuresLinked:s}=TU({drawDefinition:e}),c=r[i],u=(e?.structures||[]).map(t=>{let{stage:r,stageSequence:i,structureId:s}=t,u=xl[r],{inContextStructureMatchUps:l}=Ky({drawDefinition:e,structureId:s,structure:t,event:c}),d=l?.filter(({winningSide:e})=>e),p=d.filter(Boolean).length||0;a+=p,o+=l.length-a;let m=Math.max(d.filter(({roundNumber:e})=>1===e).map(({roundPosition:e})=>e)),{positionAssignments:f}=Pf({structure:t}),h=f?.filter(({participantId:e})=>e);n+=h?.length??0;let g=(f?.length??0)-(h?.length??0),{roundMatchUps:I,roundProfile:y,roundNumbers:v,maxMatchUpsCount:S}=Lg({matchUps:l}),b=y&&Object.keys(y).filter(e=>!y[e].inactiveRound).map(e=>Number.parseInt(e)),U=y&&Object.keys(y).filter(e=>y[e].inactiveRound).map(e=>Number.parseInt(e)),w=y&&Object.values(y).every(e=>e.inactiveRound);return{positionsAssignedCount:h?.length??0,maxWinningSideFirstRoundPosition:m,unassignedPositionsCount:g,inactiveStructure:w,maxMatchUpsCount:S,inactiveRounds:U,roundMatchUps:I,activeRounds:b,roundNumbers:v,roundProfile:y,structureId:s,stageSequence:i,orderNumber:u,stage:r}}),l=u.find(e=>2===e.orderNumber&&1===e.stageSequence),d=u.filter(({inactiveStructure:e})=>!e).length,{links:p}=Py({structureId:l.structureId,drawDefinition:e}),m=1===Jr(l.activeRounds[0])&&1===l.activeRounds.length&&1===d,f=u?.every(({inactiveStructure:e})=>e),h=!p.length&&l.activeRounds.length&&(l.roundProfile[1].inactiveCount||l.inactiveRounds.length),g=e.drawId;n&&!a&&t.positionsNoOutcomes.push(g),f&&t.inactive.push(g),m&&t.matchPlay.push(g),h&&t.canBePruned.push(g);let I={matchUpsWithWinningSideCount:a,matchUpsNoOutcomeCount:o,positionsAssignedCount:n,allStructuresLinked:s,structuresData:u,inactiveDraw:f,isMatchPlay:m,drawId:g};t.drawAnalysis[g]=I}),{...Gi,drawsAnalysis:t}}function cT({matchPlayDrawPositions:e=!0,tournamentRecord:t,drawDefinition:r,drawId:i}){if(!t)return{error:Ji};if(!r)return{error:rn};let n=[],{drawsAnalysis:a}=sT({tournamentRecord:t});if(a.canBePruned.includes(i)){let o=a.matchPlay.includes(i),s=a.drawAnalysis[i],{structures:[c]}=Tf({stageSequence:1,drawDefinition:r,stage:El}),u=s.structuresData.find(({structureId:e})=>c.structureId===e),l=(c.matchUps??[]).sort((e,t)=>e.roundPosition-t.roundPosition);n=l.filter(({roundNumber:e})=>!u.inactiveRounds.includes(e));let d=n.map(zm),p=l.map(zm).filter(e=>!d.includes(e));if(o){let t=n.filter(({roundNumber:e})=>!u.inactiveRounds.includes(e)).filter(({winningSide:e})=>e),r=t.map(zm),i=d.filter(e=>!r.includes(e));p.push(...i);let a=t.flatMap(e=>e.drawPositions??[]).filter(Boolean).flat(),o=Object.assign({},...a.map((e,t)=>({[e]:t+1})));if(t.forEach(t=>{e?t.drawPositions=t.drawPositions.map(e=>o[e]):delete t.drawPositions}),e){let e=c?.positionAssignments?.filter(e=>a.includes(e.drawPosition)).map(e=>(e.drawPosition=o[e.drawPosition],e));c.positionAssignments=e}else c.positionAssignments=[];c.matchUps=t,n=t}sh({tournamentId:t?.tournamentId,matchUpIds:p,drawDefinition:r}),lh({drawDefinition:r})}return{...Gi,matchUps:n}}function uT({isPositionAction:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,loserMatchUp:n,matchUpsMap:a,structureId:o,structure:s,event:c}){if(!r)return{error:rn};if(s||({structure:s}=wf({drawDefinition:r,structureId:o})),!s)return{error:Fn};o||({structureId:o}=s);let u="assignDrawPositionQualifier";Zy({method:u,color:"cyan",drawPosition:i}),a??=kg({drawDefinition:r});let{positionAssignments:l}=Pf({structure:s}),{activeDrawPositions:d}=Ky({drawDefinition:r,structureId:o});if(l?.find(e=>e.drawPosition===i)?.qualifier)return{...Gi};let p=!(!n||!a.drawMatchUps.some(e=>e.loserMatchUpId===n?.matchUpId&&rv(e.matchUpStatus)));if(d?.includes(i)&&!p)return{error:hn};let m=l?.find(e=>e.drawPosition===i);if(!m)return{error:In};let{containsQualifier:f,containsParticipant:h}=tv(m);if(f)return{...Gi};let g=zh({tournamentRecord:t,drawDefinition:r,event:c}).appliedPolicies??{};return l?.forEach(e=>{e.drawPosition===i&&(e.qualifier=!0,p&&(e.participantId=void 0,console.log("oddity: invalid participantId on qualifier position cleared")))}),ph({tournamentId:t?.tournamentId,drawDefinition:r,structure:s,event:c}),function({assignedParticipantId:e,isPositionAction:t,appliedPolicies:r,drawDefinition:i,drawPosition:n,structureId:a,stack:o}){return t&&hh({appliedPolicies:r,drawDefinition:i,positionAction:{removedParticipantId:e,drawPosition:n,structureId:a,name:o}}),ac({result:{...Gi},stack:o})}({assignedParticipantId:h,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:i,structureId:o,stack:u})}function lT({tournamentRecord:e,drawDefinition:t,participantId:r,drawPosition:i,structureId:n,qualifier:a,event:o,bye:s}){if(!t)return{error:rn};if(!i)return{error:yn};if(!n)return{error:On};if(s){let r=iv({tournamentRecord:e,drawDefinition:t,drawPosition:i,structureId:n,event:o});if(r.error)return r}else if(a){let r=uT({tournamentRecord:e,drawDefinition:t,drawPosition:i,structureId:n,event:o});if(r.error)return r}else{let a=Cb({participantId:r,tournamentRecord:e,drawDefinition:t,drawPosition:i,structureId:n,event:o});if(a.error)return a}return{...Gi}}function dT(e){let t=e.matchUpIds??[],{drawDefinition:r}=e,i=e.structureId??r?.structures?.find(e=>e.matchUps?.some(({matchUpId:e})=>t.includes(e)))?.structureId??r?.structures?.[0]?.structureId;if(!i)return{error:Fn};let n=r.structures?.find(e=>e.structureId===i);if(!n)return{error:Fn};let a=n?.matchUps,o=a?.find(e=>!!e.roundPosition);if(n.structures||o||n.finishingPosition===Pd)return{error:on};let s=a.filter(({roundNumber:t})=>e.roundNumbers?.includes(t)).map(zm);return t=t.filter(e=>!s.includes(e)),e.roundNumbers&&!t.length&&(t=s),{existingMatchUps:a,matchUpIds:t,structureId:i,structure:n}}function pT(e){let t=Dp(e,[{[xd]:!0},{[bp]:{[Wd]:!1,roundNumbers:!1},[yp]:Zo,[vp]:hp}]);if(t.error)return t;let{removeIncomplete:r=!1,removeUnAssigned:i=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=e,c=dT(e);if(c.error)return c;let{structure:u,structureId:l,existingMatchUps:d,matchUpIds:p}=c,m=[],f=d?.filter(({matchUpId:e,score:t,winningSide:a})=>{if(a&&!n)return!1;if(a||qy({score:t})){if(!a&&!r)return!1;m.push(e)}else if(!i)return!1;return p?.includes(e)})??[],h=f.map(zm),g=f.map(({tieMatchUps:e})=>e?.map(zm)).filter(Boolean).flat();if(h.length){u.matchUps=(u.matchUps??[]).filter(({matchUpId:e})=>!h.includes(e)),sh({tournamentId:a?.tournamentId,matchUpIds:[...g,...h],action:"deleteAdHocMatchUps",eventId:s?.eventId,drawDefinition:o});let e=function(e,t=1){return Array.isArray(e)&&e.every(gi)?Ri(Math.min(...e,t),Math.max(...e)+1).filter(t=>!e.includes(t)):[]}(vi(u.matchUps.map(Vy("roundNumber"))));if(e.length){e.reverse();for(let t of e)u.matchUps.forEach(e=>{e.roundNumber&&e.roundNumber>t&&(e.roundNumber-=1,ch({tournamentId:a?.tournamentId,context:["adHoc round deletion"],eventId:s?.eventId,drawDefinition:o,matchUp:e}))})}if(m.length){u.positionAssignments=vi(u.matchUps.flatMap(e=>(e.sides??[]).map(e=>e.participantId)).filter(Boolean)).map(e=>({participantId:e}));let e=u?.matchUpFormat??o?.matchUpFormat??s?.matchUpFormat,t=c.existingMatchUps.some(e=>e.matchUpType===zr)?{matchUpTypes:[zr]}:void 0,{matchUps:r}=Uy({afterRecoveryTimes:!1,inContext:!0,matchUpFilters:t,structure:u,event:s});jg({structure:u})&&(u.positionAssignments=vi(r.flatMap(e=>(e.sides??[]).map(e=>e.participantId)).filter(Boolean)).map(e=>({participantId:e})));let i=Mw({positionAssignments:u.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:e,matchUps:r,event:s});i.error&&console.log(i)}lh({structureIds:[l],eventId:s?.eventId,drawDefinition:o})}return!h.length&&p.length?{error:hs}:{...Gi,deletedMatchUpsCount:[...h,...g].length}}function mT({removeCompletedMatchUps:e,tournamentRecord:t,drawDefinition:r,structureId:i,roundNumber:n,event:a}){if(!t)return{error:Ji};if(!r)return{error:rn};if(!n)return ac({result:{error:Da},info:"roundNumber required"});let o=wf({drawDefinition:r,structureId:i});if(o.error)return o;let s=o.structure;return s?.structures?{error:on}:jg({structure:s})?function({removeCompletedMatchUps:e,drawDefinition:t,tournamentId:r,roundNumber:i,structure:n,eventId:a}){let o=n?.matchUps??[],s=[],c=[],u=!1;if(o.reduce((e,t)=>{let r=t?.roundNumber;return r?e.includes(r)?e:e.concat(r):e},[]).sort(Qr).includes(i)){let l=o.filter(t=>{let r=t.roundNumber===i&&(!If.includes(t.matchUpStatus)||e);return r&&(c.push(t.matchUpId),t.tieMatchUps&&s.push(...t.tieMatchUps.map(zm))),!r});c.length&&(sh({matchUpIds:[...s,...c],drawDefinition:t,tournamentId:r,eventId:a}),l.some(e=>e.roundNumber===i)||(l.forEach(e=>{e.roundNumber>i&&(e.roundNumber-=1,ch({drawDefinition:t,tournamentId:r,eventId:a,matchUp:e}))}),u=!0),n.matchUps=l)}return{deletedMatchUpsCount:c.length,roundRemoved:u,...Gi}}({tournamentId:t.tournamentId,removeCompletedMatchUps:e,eventId:a.eventId,drawDefinition:r,roundNumber:n,structure:s}):(console.log("not implemented"),{...Gi})}function fT(e){let{suppressNotifications:t,tournamentRecord:r,drawDefinition:i,matchUps:n,event:a}=e;if("object"!=typeof i)return{error:rn};let o=e?.structureId;if(!o&&1===i.structures?.length&&(o=i.structures?.[0]?.structureId),"string"!=typeof o)return{error:On};if(!_g(n))return{error:Zo,info:Eb("matchUps")};let s=i.structures?.find(e=>e.structureId===o);if(!s)return{error:Fn};let c=(s?.matchUps).find(e=>!!e.roundPosition);if(s.structures||c||s.finishingPosition===Pd)return{error:on};if(xi(Oy({tournamentRecord:r,inContext:!1})?.matchUps?.map(zm)??[],n.map(zm)))return{error:ls,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...n);let u=n.map(({tieMatchUps:e})=>e).filter(Boolean).flat();return t||(oh({tournamentId:r?.tournamentId,matchUps:[...u,...n],eventId:a?.eventId,drawDefinition:i}),lh({drawDefinition:i,structureIds:[o]})),{...Gi}}function hT({tournamentRecord:e,drawDefinition:t,drawPosition:r,structureId:i,subOrder:n,event:a}){if(!t)return{error:rn};if(!i)return{error:On};if(!r)return{error:yn};let{structure:o}=wf({drawDefinition:t,structureId:i});if(!o)return{error:Fn};let s=o;o.structures&&o.structureType===Wl&&(s=o.structures?.find(e=>e.positionAssignments?.find(e=>e.drawPosition===r)));let c=s?.positionAssignments,u=c?.find(e=>e.drawPosition===r);u&&em({element:u,extension:{name:Am,value:n}});let l=(a?.eventType===Yr||t.matchUpType===Yr||(a?.tieFormat??t?.tieFormat??o?.tieFormat))&&{matchUpTypes:[Yr]},{matchUps:d}=Uy({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:l,event:a});return Mw({positionAssignments:c,tournamentRecord:e,drawDefinition:t,matchUpFormat:o?.matchUpFormat??t.matchUpFormat,matchUps:d,event:a}),lh({drawDefinition:t,structureIds:[i]}),{...Gi}}var gT={};function IT({excludedMatchUpStatuses:e=[],includeEventParticipants:t,includeQualifyingStage:r,finishingRoundLimit:i,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:c,requirePlay:u,requireLoss:l,allEntries:d,winsLimit:p,event:m}){if(!s)return{error:rn};let f=[El,Cl];r&&f.push(Ml);let h=m?.eventType?{matchUpTypes:[m.eventType]}:void 0,g=s?.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,I=t&&m?xy({contextFilters:{stages:f},matchUpFilters:h,tournamentRecord:o,inContext:!0,event:m})?.matchUps??[]:Ly({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s})?.matchUps??[],y=Eg({stage:Al,drawDefinition:s}),v=new Set(y.map(({participantId:e})=>e)),S={},b={},U={},w={};n??=Yh({policyTypes:[Op],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions;let T=n?.[Op];e=e.length&&e||T?.excludedMatchUpStatuses||[],t=t??T?.includeEventParticipants,d=d??T?.allEntries,i=i??T?.finishingRoundLimit,a=a??T?.roundNumberLimit,c=c??T?.matchUpsLimit,u??=T?.requirePlay??!0,l??=T?.requireLoss??!0,p=p??T?.winsLimit;for(let R of I){if(u&&R.winningSide&&![1,2].includes(R.winningSide)&&R.matchUpStatus!==nf||R.finishingRound&&i&&R.finishingRound>=i||R.finishingRound&&a&&R.finishingRound<=a)continue;let t=R.sides?.find(({sideNumber:e})=>R.winningSide&&e===3-R.winningSide),r=R.sides?.find(({sideNumber:e})=>R.winningSide&&e===R.winningSide);if(R.sides?.forEach(t=>{let r=t?.participant?.participantId;r&&(U[r]=t.participant,R.matchUpStatus===nf&&!u&&(b[r]=t.participant,S[r]||(S[r]=0),(!R.matchUpStatus||!e.includes(R.matchUpStatus))&&(S[r]+=1)))}),t?.participant){let r=t.participant.participantId;b[r]=t.participant,S[r]||(S[r]=0),R.matchUpStatus&&!e.includes(R.matchUpStatus)&&(S[r]+=1)}if(r?.participant){let t=r.participant.participantId;w[t]||(w[t]=0),w[t]+=1,S[t]||(S[t]=0),R.matchUpStatus&&!e.includes(R.matchUpStatus)&&(S[t]+=1)}}let D,P=o?.participants&&!u&&!l&&d;D=t&&m?m.entries:s.entries;let N=P?(D??[]).filter(e=>![vg,gg].includes(e.entryStatus)).map(({participantId:e})=>e):[],E=Object.keys(b),M=P?(o?.participants??[]).filter(({participantId:e})=>N.includes(e)):l&&Object.values(b)||Object.values(U);return{eligibleParticipants:M.filter(e=>(e=>!l||E.includes(e))(e.participantId)&&(e=>!u||(S[e]||0)>=0)(e.participantId)&&(e=>!p||(w[e]||0)<=p)(e.participantId)&&(e=>!c||S[e]<=c)(e.participantId)&&(e=>!v.has(e))(e.participantId)).map(e=>({...e,individualParticipants:e.individualParticipantIds?.map(e=>o?.participants?.find(t=>t.participantId===e))})),losingParticipantIds:E,...Gi}}function yT(e){let t=Dp(e,[{drawDefinition:!0}]);if(t.error)return t;let{drawDefinition:r,roundNumber:i}=e,n=e.structureId??(1===r.structures?.length&&r.structures?.[0]?.structureId);if("string"!=typeof n)return{error:On};let a=r.structures?.find(e=>e.structureId===n);if(!a)return{error:Fn};let o,s=(a.matchUps??[])?.reduce((e,t)=>(t.roundPosition&&(o=!0),(t?.roundNumber||0)>e?t.roundNumber:e),0);if(a.structures||o||a.finishingPosition===Pd)return{error:on};let c=r?.entries?.filter(e=>{let t=e.entryStatus;return wg.includes(t)})??[],u=Math.floor(c?.length/2)||1,l=i??s??1,d=u-(a.matchUps?.filter(e=>e.roundNumber===l)?.length??0),p=d>0?d:0;return{...Gi,availableMatchUpsCount:p,lastRoundNumber:s,roundMatchUpsCount:u}}function vT({drawDefinition:e}){let t=lm({name:"participantRepresentatives",element:e});return t.error?t:{representativeParticipantIds:t.extension?.value||[]}}function ST({tournamentRecord:e,drawDefinition:t,stage:r=El,structureId:i,structure:n}){if(!e)return{error:Ji};if(!n&&!t)return{error:rn};if(!n&&!i&&1===t?.structures?.filter(e=>e.stage===r).length&&(n=t.structures.find(e=>e.stage===r)),!n&&!i)return{error:On};let{error:a,positionAssignments:o}=Pf({drawDefinition:t,structureId:i,structure:n});return{positionAssignments:o??[],structureId:n?.structureId,error:a}}function bT({dates:e=[],extension:t}){if(!t)return!1;if("boolean"==typeof t.value&&t.value)return!0;if(!e.length)return!1;let r=ti(t.value)?t.value?.dates:void 0;return Array.isArray(r)?!!r?.length&&!!r.filter(t=>!e.length||e.includes(t)).length:void 0}function UT({convertExtensions:e,ignoreDisabled:t,venue:r,court:i}){let n={...Nu(i,e,!0),venueId:r.venueId},{extension:a}=lm({name:fm,element:i});if(t&&a){let e=ti(a.value)?a.value?.dates:void 0,t=!0===a?.value?[]:n.dateAvailability.map(t=>{let r=t.date;if(r&&!e.includes(r))return t}).filter(Boolean);n.dateAvailability=t}return function({inContextCourt:e,venue:t}){let{defaultStartTime:r,defaultEndTime:i,dateAvailability:n}=t;if(!(r||i||n?.length))return;let a=e.dateAvailability;a?.length?e.dateAvailability=a.map(e=>{let t=function({date:e,venueDateAvailability:t,defaultStartTime:r,defaultEndTime:i}){if(t?.length){if(e){let r=t.find(t=>t.date===e);if(r)return r}let r=t.find(e=>!e.date);if(r)return r}if(r||i)return{startTime:r,endTime:i}}({date:e.date,venueDateAvailability:n,defaultStartTime:r,defaultEndTime:i});if(!t)return e;let a=function(e,t){return e?t?e>t?e:t:e:t}(e.startTime,t.startTime),o=function(e,t){return e?t?e<t?e:t:e:t}(e.endTime,t.endTime),s=function(e,t){let r=[];return e?.length&&r.push(...e),t?.length&&r.push(...t),r}(e.bookings,t.bookings);return{...e,startTime:a,endTime:o,...s.length?{bookings:s}:{}}}):n?.length?e.dateAvailability=n.map(e=>({...e})):r&&i&&(e.dateAvailability=[{startTime:r,endTime:i}])}({inContextCourt:n,venue:r}),{inContextCourt:n}}function wT(e,t,r){if(t.length&&!t.includes(e.venueId))return!1;if(r){let{extension:t}=lm({name:fm,element:e});if(t?.value)return!1}return!0}function TT({venue:e,convertExtensions:t,ignoreDisabled:r,dates:i,uniqueVenueIds:n,venues:a,uniqueCourtIds:o,courts:s}){n.includes(e.venueId)||(a.push(Nu(e,t,!0)),n.push(e.venueId));for(let c of e.courts??[])if(!o.includes(c.courtId)){if(r){let{extension:e}=lm({name:fm,element:c});if(bT({extension:e,dates:i}))continue}let{inContextCourt:n}=UT({convertExtensions:t,ignoreDisabled:r,venue:e,court:c});s.push(n),o.push(c.courtId)}}function DT(e){let{convertExtensions:t,ignoreDisabled:r,venueIds:i=[],dates:n}=e,a=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},o=[],s=[],c=[],u=[];return Object.keys(a).filter(t=>!e.tournamentId||t===e.tournamentId).forEach(e=>{let l=a[e];for(let a of l.venues??[])wT(a,i,!!r)&&TT({venue:a,convertExtensions:t,ignoreDisabled:r,dates:n,uniqueVenueIds:o,venues:u,uniqueCourtIds:s,courts:c})}),{courts:c,venues:u,...Gi}}function PT({tournamentRecords:e,requireCourts:t,dates:r}){return"object"==typeof e&&Object.keys(e).length?Object.keys(e).reduce((i,n)=>{let a=e[n],{venues:o}=function({convertExtensions:e,tournamentRecord:t,ignoreDisabled:r,dates:i}){if(!t)return{error:Qi};let n=Nu(t.venues??[],e).filter(e=>{if(!r)return e;let{extension:t}=lm({name:fm,element:e});return!t?.value&&e}).filter(Boolean),a=n.reduce((t,n)=>{let a=(n?.courts||[]).filter(e=>{if(!r&&!i?.length)return e;let{extension:t}=lm({name:fm,element:e});return bT({extension:t,dates:i})}).filter(Boolean).map(t=>{let{inContextCourt:i}=UT({convertExtensions:e,ignoreDisabled:r,venue:n,court:t});return i});return a.length?t.concat(a):t},[]);return{venues:n,courts:a}}({tournamentRecord:a,dates:r});return o?.forEach(e=>{let{venueId:r,courts:n}=e;(!t||n?.length)&&!i.venueIds.includes(r)&&(i.venues.push(e),i.venueIds.push(r))}),i},{venues:[],venueIds:[]}):{error:Qi}}function NT({event:e}){return{eventInfo:(({eventId:e,eventName:t,eventType:r,eventLevel:i,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:l,discipline:d,onlineResources:p,notes:m})=>({eventId:e,eventName:t,eventType:r,eventLevel:i,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:l,discipline:d,onlineResources:p,notes:m}))(e)}}Br(gT,{addGoesTo:()=>Gy,allPlayoffPositionsFilled:()=>qb,checkValidEntries:()=>TD,findDrawDefinition:()=>_T,getAssignedParticipantIds:()=>pv,getAvailableMatchUpsCount:()=>yT,getAvailablePlayoffProfiles:()=>bw,getDrawDefinitionTimeItem:()=>Fh,getDrawParticipantRepresentativeIds:()=>vT,getDrawStructures:()=>Tf,getDrawTypeCoercion:()=>vD,getEligibleVoluntaryConsolationParticipants:()=>IT,getMatchUpsMap:()=>kg,getParticipantIdFinishingPositions:()=>OT,getPositionAssignments:()=>ST,getPositionsPlayedOff:()=>vw,getRandomQualifierList:()=>SD,getSeedingThresholds:()=>db,getSeedsCount:()=>wD,getStructureSeedAssignments:()=>Mg,getTeamLineUp:()=>Iy,getValidGroupSizes:()=>cb,isAdHoc:()=>jg,isCompletedStructure:()=>Wb,isValidForQualifying:()=>bD,positionActions:()=>yD});var ET={[jp]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}};function MT(e){let{tournamentRecord:t,withMatchUpStats:r,withStructureDetails:i,withVenueData:n}=e??{};if(!t)return{error:Ji};let a=(({tournamentId:e,tournamentRank:t,tournamentStatus:r,formalName:i,tournamentName:n,promotionalName:a,onlineResources:o,localTimeZone:s,activeDates:c,startDate:u,endDate:l,hostCountryCode:d,venues:p,notes:m,updatedAt:f})=>({tournamentId:e,tournamentRank:t,tournamentStatus:r,formalName:i,tournamentName:n,promotionalName:a,onlineResources:o,localTimeZone:s,activeDates:c,startDate:u,endDate:l,hostCountryCode:d,venues:p,notes:m,updatedAt:f}))(t),o=mS({participantFilters:{participantRoles:[kS,_S,OS,FS,BS]},policyDefinitions:ET,tournamentRecord:t})?.participants??[];o&&(a.tournamentContacts=o);let s=aS({tournamentRecord:t})?.publishState,c=s?.tournament?.status?.publishedEventIds||[],u=[];for(let l of t.events??[])if(!e?.usePublishState||c.includes(l.eventId)){let e=NT({event:l}).eventInfo;e&&u.push(e)}if(a.timeItemValues=zw({element:t}),a.publishState=s?.tournament,a.eventInfo=u,r){let e=t.participants?.filter(e=>e.participantType===wh).length??0,r=t.events?.length??0,{matchUps:i=[]}=Oy({tournamentRecord:t}),n=i.filter(e=>"BYE"!==e.matchUpStatus),o=n.length,s=n.filter(e=>If.includes(e.matchUpStatus)||e.winningSide).length,c=n.filter(e=>e.schedule?.scheduledDate||e.schedule?.scheduledTime).length,u=o>0?Math.round(s/o*100):0;a.participantCount=e,a.eventCount=r,a.matchUpStats={total:o,completed:s,scheduled:c,percentComplete:u}}if(i){let e=[];for(let r of t.events??[])for(let t of r.drawDefinitions??[])for(let i of t.structures??[])[vd,Wl].includes(i?.structureType||"")||e.push(nc({eventId:r.eventId,eventName:r.eventName,eventType:r.eventType,drawId:t.drawId,drawName:t.drawName,drawType:t.drawType,structureId:i.structureId,structureName:i.structureName,stage:i.stage,stageSequence:i.stageSequence,positionAssignments:i.positionAssignments,seedAssignments:i.seedAssignments,matchUpFormat:i.matchUpFormat}));a.structures=e}if(n){let{venues:e}=DT({tournamentRecord:t});a.venues=e??[]}return{tournamentInfo:Nu(nc(a),!1,!0),...Gi}}function RT({publishStatus:e,drawId:t}){return e?.drawDetails?e.drawDetails?.[t]?.publishingDetail?.published:!e?.drawIds||e.drawIds.includes(t)}var AT="PUBLIC",CT={PUBLIC_DISPLAY:AT,ADMIN_DISPLAY:"ADMIN"};function kT(e){let{tournamentParticipants:t=[],includePositionAssignments:r,policyDefinitions:i,tournamentRecord:n,inContext:a=!0,usePublishState:o,status:s=DI,pressureRating:c,refreshResults:u,contextProfile:l,drawDefinition:d,noDeepCopy:p,sortConfig:m,context:f,event:h}=e;if(!d)return{error:rn};let{matchUpFormat:g,updatedAt:I,drawType:y,drawName:v,drawId:S}=d,b={matchUpFormat:g,updatedAt:I,drawName:v,drawType:y,drawId:S};b.display=lm({element:d,name:Im}).extension?.value;let U,w,T={},{allStructuresLinked:D,sourceStructureIds:P,hasDrawFeedProfile:N,structureGroups:E}=TU({drawDefinition:d});if(!D)return{error:$n};let M=e?.eventPublishState??aS({event:h}).publishState,R=e?.publishStatus??iS({event:h,status:s}),A=M?.status?.drawDetails?.[d.drawId],C=!!M?.status?.published,k=A?.structureDetails,x=!1,O=!1,F=E.map(s=>{let p={},g=s.map(e=>{let{structure:t}=wf({drawDefinition:d,structureId:e}),{seedAssignments:r}=Mg({drawDefinition:d,structure:t});return t?.stage===El&&1===t.stageSequence&&(U=r),t?.stage===Ml&&(T[t.stageSequence??0]=r),t}).sort((e,t)=>bf(e,t,m)).map(r=>{if(!r)return;let s=r?.structureId,m=[];r.stage&&[El,Rl,Cl].includes(r.stage)&&(m=U),r?.stage===Ml&&(m=T[r.stageSequence??0]);let{matchUps:g,roundMatchUps:I,roundProfile:y}=Uy({seedAssignments:r?.seedAssignments?.length?void 0:m,context:{drawId:b.drawId,...f},hydrateParticipants:e.hydrateParticipants,participantsProfile:e.participantsProfile,tournamentParticipants:t,policyDefinitions:i,tournamentRecord:n,usePublishState:o,publishStatus:R,contextProfile:l,drawDefinition:d,inContext:a,structure:r,event:h}),{positionAssignments:v}=Pf({structure:r}),S=v?.filter(Vy(_d)).map(e=>{let t=lm({element:e,name:Cm})?.extension?.value,{drawPosition:r,participantId:i}=e;return O=!0,{participantResult:t,participantId:i,drawPosition:r}});if(g.length&&(!S?.length&&e.allParticipantResults||u&&!r.structures)){let{subOrderMap:e}=eS({positionAssignments:v}),t=g.some(e=>e.matchUpType===zr)?g.filter(e=>e.matchUpType===zr):g,n=Qv({matchUpFormat:r.matchUpFormat,matchUps:t,policyDefinitions:i,pressureRating:c,subOrderMap:e});w=n?.report,S=v?.filter(Vy(_d)).map(e=>{let{drawPosition:t,participantId:r}=e;return O=!0,{participantResult:r&&n?.participantResults?.[r],participantId:r,drawPosition:t}})}let D=r?{stageSequence:r.stageSequence,structureName:r.structureName,structureType:r.structureType,matchUpFormat:r.matchUpFormat,stage:r.stage}:{},E=lm({element:r,name:Im}).extension?.value;D.display=E?.[AT]??E,D.sourceStructureIds=P[s],D.hasDrawFeedProfile=N[s],D.positionAssignments=v,D.structureActive=g.reduce((e,t)=>{let r=[nf,rf,af,Zm,Jm,tf,cf,df].includes(t.matchUpStatus);return e||r||!!t.winningSide||!!t.score?.scoreStringSide1},!1);let M=g.every(e=>[...If,"BYE"].includes(e.matchUpStatus));return D.structureCompleted=M,p[s]=M,D.structureActive&&(x=!0),{...D,participantResults:S,seedAssignments:m,roundMatchUps:I,roundProfile:y,structureId:s,report:w}});return g.forEach(e=>{r||delete e.positionAssignments,e.sourceStructuresComplete=e.sourceStructureIds?.every(e=>p[e])}),g}).flat().filter(e=>!o||k?.[e?.structureId]?.published||!0);return b.drawActive=x,b.participantPlacements=O,b.drawGenerated=F?.reduce((e,t)=>e||!!t?.roundMatchUps,!1),b.drawCompleted=F?.reduce((e,t)=>e&&t.structureCompleted,!0),b.drawPublished=o?C&&RT({publishStatus:R,drawId:b.drawId}):void 0,{structures:!o||b.drawPublished?p&&F||Nu(F,!1,!0):void 0,drawInfo:p?b:Nu(b,!1,!0),...Gi}}function xT(e){let{includePositionAssignments:t,participantsProfile:r,policyDefinitions:i,usePublishState:n,status:a=DI,contextProfile:o,sortConfig:s}=e,c=Dp(e,[{tournamentRecord:!0},{[Sp]:{event:!1,eventId:!1}}]);if(c.error)return c;let u=Nu(e.tournamentRecord,!1,!0),l=null==e.event?my({tournamentRecord:u,eventId:e.eventId}).event:void 0,d=e.event?Nu(e.event,!1,!0):l&&Nu(l,!1,!0)||void 0;if(!d)return{error:Gn};let{eventId:p}=d,{tournamentId:m,endDate:f}=u,h=iS({event:d,status:a}),g=aS({event:d}).publishState??{},I=!!g?.status?.published,{participants:y}=mS({participantFilters:e.participantFilters,withEvents:!1,withDraws:!1,policyDefinitions:i,...r,tournamentRecord:u}),v=d.drawDefinitions||[],S=!n||I?v.filter(({drawId:e})=>!n||RT({publishStatus:h,drawId:e})).map(r=>(({drawInfo:e,structures:t})=>({...e,structures:t}))(kT({allParticipantResults:e.allParticipantResults,hydrateParticipants:e.hydrateParticipants,context:{eventId:p,tournamentId:m,endDate:f},pressureRating:e.pressureRating,refreshResults:e.refreshResults,includePositionAssignments:t,tournamentParticipants:y,eventPublishState:g,noDeepCopy:!0,policyDefinitions:i,tournamentRecord:u,usePublishState:n,contextProfile:o,drawDefinition:r,publishStatus:h,sortConfig:s,event:d}))).map(({structures:e,...t})=>{let r=e?.filter(({stage:e,structureId:r})=>(({structureId:e,drawId:t})=>{if(!n)return!0;let r=h?.drawDetails?.[t]?.structureDetails;return!r||!Object.keys(r).length||r[e]?.published})({structureId:r,drawId:t.drawId})&&(({stage:e,drawId:t})=>{if(!n)return!0;let r=h?.drawDetails?.[t]?.stageDetails;return!r||!Object.keys(r).length||r[e]?.published})({stage:e,drawId:t.drawId})).map(e=>(({drawId:e,structure:t})=>{if(!n)return t;let r=h?.drawDetails?.[e]?.structureDetails?.[t.structureId]?.roundLimit;if(gi(r)){let e=Ri(1,r+1),i={},n={};for(let r of e)t.roundMatchUps[r]&&(i[r]=t.roundMatchUps[r],n[r]=t.roundProfile[r]);t.roundMatchUps=i,t.roundProfile=n}return t})({drawId:t.drawId,structure:e}));return{...t,structures:r}}).filter(e=>e.structures?.length):void 0,b=(Array.isArray(u.venues)?u.venues:[]).map(e=>{let{venueData:t}=dy({venueId:e.venueId,tournamentRecord:u});return{...t}}),U=(({eventId:e,eventName:t,eventType:r,eventLevel:i,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:l,discipline:d})=>({eventId:e,eventName:t,eventType:r,eventLevel:i,surfaceCategory:n,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:l,discipline:d}))(d);U.display=lm({element:d,name:Im}).extension?.value;let{tournamentInfo:w}=MT({tournamentRecord:u}),T={tournamentInfo:w,venuesData:b,eventInfo:U,drawsData:S};return T.eventInfo.publishState=g,T.eventInfo.published=g?.status?.published,{...Gi,eventData:T,participants:y}}function OT({byeAdvancements:e=!1,tournamentRecord:t,drawDefinition:r,event:i}){if(!r)return{error:rn};let{participantIds:n,participantIdMatchUps:a}=function({tournamentParticipants:e,drawDefinition:t,event:r}){if(!t)return{error:rn};let i=Nu(Cy({tournamentParticipants:e,inContext:!0,drawDefinition:t,event:r}).matchUps,!1,!0),n=vi(i.reduce((e,t)=>e.concat(...t.sides.map(e=>e.participantId).filter(Boolean)),[])),a=Object.assign({},...n.map(e=>{let t=i.filter(t=>t.sides.map(e=>e.participantId).filter(Boolean).includes(e));return{[e]:t}}));return{participantIds:n,participantIdMatchUps:a}}({tournamentParticipants:t?.participants,drawDefinition:r}),o=Object.values(a).some(e=>e.some(e=>e.containerStructureId)),s=(o&&xT({tournamentRecord:t,event:i}))?.eventData?.drawsData?.find(e=>e.drawId===r.drawId)?.structures,c=r?.structures?.find(e=>e.stage===El&&1===e.stageSequence),u=c?.structureType===Wl&&c.structures,l=(o?ST({tournamentRecord:t,drawDefinition:r,structureId:c?.structureId})?.positionAssignments:void 0)?.length||0,d=n?.map(t=>{let i=a[t].filter(e=>[Zm,"BYE"].includes(e.matchUpStatus)||e.winningSide),n=i.map(i=>{let n=i.sides.find(e=>e.bye),a=i.sides.find(e=>e.participantId===t).sideNumber;if(i.containerStructureId){let e=function({containedStructures:e,drawPositionsCount:t,drawDataStructures:r,drawDefinition:i,participantId:n,matchUp:a}){let o=e?.find(e=>e.structureId===a.structureId)?.positionAssignments?.length,s=r.find(e=>e.structureId===a.containerStructureId)?.participantResults?.find(e=>e.participantId===n)?.participantResult,{ties:c,groupOrder:u,provisionalOrder:l}=s||{},d=e?.length,p=i.structure?.find(e=>e.stage===Cl);if(Ps()&&console.log({drawPositionsCount:t,provisionalOrder:l,bracketsCount:d,bracketSize:o,groupOrder:u,ties:c}),t===o&&u)return[u,u];if(d>1&&u&&!p)return[1,d];if(d>1&&u&&p){let e=i.links?.find(e=>e.source.structureId===a.containerStructureId)?.source?.finishingPositions,r=e.length*d;if(u in e)return[1,r];return[r+1,t-(o-u)*d]}}({containedStructures:u,drawPositionsCount:l,drawDataStructures:s,drawDefinition:r,participantId:t,matchUp:i});if(e)return e}return(i.winningSide||e&&n&&a)===a?i.finishingPositionRange.winner:i.finishingPositionRange.loser}),o=e=>Math.abs(e[0]-e[1]),c=n.reduce((e,t)=>e&&o(e)<o(t)?e:t,void 0);return{[t]:{finishingPositionRanges:n,finishingPositionRange:c,relevantMatchUps:i}}})||[];return Object.assign({},...d)}function FT({tournamentRecords:e,tournamentRecord:t,tournamentId:r,drawId:i}){if(!t&&!e)return{error:Ji};if(!i)return{error:wn};if(!t&&e){if("string"!=typeof r&&!(r=Gw({tournamentRecords:e,drawId:i})))return{error:en};if(!(t=e[r]))return{error:Ji}}let n=t&&my({tournamentRecord:t,drawId:i});return n?.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:t,...Gi}:ac({result:{error:an},stack:"findDrawDefinition"})}function _T(e){let{drawDefinition:t,error:r}=FT(e);return r?{error:r}:{drawDefinition:Nu(t)}}function LT({tournamentParticipants:e,returnParticipants:t,drawPosition:r,participant:i,drawId:n,event:a}){let o=a?.entries?.filter(({entryStatus:e})=>[gg,Ig].includes(e)).map(({participantId:e})=>e)||[];if(o.length){let a=i.individualParticipantIds,s=t?e.filter(({participantId:e})=>o.includes(e)):void 0,c=t?e.filter(({participantId:e})=>a.includes(e)):void 0;return{validModifyAssignedPairAction:nc({payload:{participantId:i.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:r,drawId:n},method:"modifyPairAssignment",availableIndividualParticipantIds:o,availableIndividualParticipants:s,existingIndividualParticipantIds:a,existingIndividualParticipants:c,type:VU},!1,!1,!0)}}return{}}function BT(e){let{inContextDrawMatchUps:t,targetData:r,drawDefinition:i,relevantLink:n}=e;if(n?.linkCondition===Jl&&"BYE"===r?.matchUp?.matchUpStatus)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=r,c=a&&Ey({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:i}),u=c?.targetMatchUps?.loserMatchUp,l=c?.targetMatchUps?.loserMatchUpDrawPositionIndex,d=u?.sides[l]?.participant,p=rv(a?.matchUpStatus),m=p&&!d,f=a?.sides?.filter(e=>e?.participant).length??0,h=a?.winningSide&&p&&1===f,g=o?.drawPositions?.filter(Boolean).length||0;if(!h&&(a?.winningSide&&!m||o?.winningSide&&2===g&&(!o.feedRound||!rv(o?.matchUpStatus))))return!0;let I=o&&Ey({matchUpId:o.matchUpId,inContextDrawMatchUps:t,drawDefinition:i}),y=c&&BT({relevantLink:s?.loserTargetLink,targetData:c,inContextDrawMatchUps:t,drawDefinition:i});return!!(I&&BT({targetData:I,inContextDrawMatchUps:t,drawDefinition:i})||y)}var $T={[Lp]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Ml,El],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[XU,JU,jU,QU],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},VT="positionAction",jT="matchUpAction";function GT({actionType:e=VT,appliedPolicies:t,drawDefinition:r,structure:i}){let n=e===VT&&Lp||e===jT&&Bp,a=e===VT&&$T||e===jT&&ES,o=n&&(t?.[n]||a?.[n]),s=r.links?.filter(e=>e?.target?.structureId===i?.structureId)?.map(({target:e})=>e.feedProfile)??[],{enabledStructures:c,disabledStructures:u}=o||{},l=u?.find(e=>{let{stages:t,stageSequences:r,structureTypes:n,feedProfiles:a}=e;return(!a?.length||Array.isArray(a)&&a.some(e=>s.includes(e)))&&(!t?.length||Array.isArray(t)&&t?.includes(i?.stage))&&(!n?.length||Array.isArray(n)&&n?.includes(i?.structureType))&&(!r?.length||Array.isArray(r)&&r.includes(i?.stageSequence))});return{enabledStructures:c,actionsDisabled:l,actionsPolicy:o}}function WT({activePositionOverrides:e,activeDrawPositions:t,action:r}){return!(!r||!e.includes(r))||!t.length}function qT({enabledStructures:e,drawDefinition:t,structure:r}){if(!1===e)return{};if(!e?.length)return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:i,stageSequence:n,structureType:a}=r||{},o=t.links?.filter(e=>e?.target?.structureId===r?.structureId)?.map(({target:e})=>e.feedProfile)||[];return{policyActions:e.find(e=>{let{stages:t,stageSequences:r,structureTypes:s,feedProfiles:c}=e||{},u=!t?.length||Array.isArray(t)&&t.includes(i),l=!r?.length||Array.isArray(r)&&r.includes(n),d=!s?.length||Array.isArray(s)&&s.includes(a),p=!c?.length||Array.isArray(c)&&c.some(e=>o.includes(e));return l&&d&&p&&e&&u})}}function HT({action:e,policyActions:t}){let r=!t?.enabledActions||t?.disabledActions?.length&&t.disabledActions.includes(e);return!r&&((0===t?.enabledActions.length||t?.enabledActions.includes(e))&&!r)}var zT="replaceTieMatchUpParticipantId",YT="assignTieMatchUpParticipantId",KT="removeTieMatchUpParticipantId",XT="assignMatchUpSideParticipant",QT="substituteParticipant",JT="REMOVE_SUBSTITUTION",ZT="REPLACE_PARTICIPANT",eD="REMOVE_PARTICIPANT",tD="setMatchUpStatus",rD="SUBSTITUTION",iD="SCHEDULE",nD="REFEREE",aD="STATUS",oD="START",sD="SCORE",cD={REPLACE_TEAM_POSITION_METHOD:zT,ASSIGN_TEAM_POSITION_METHOD:YT,REMOVE_TEAM_POSITION_METHOD:KT,REPLACE_PARTICIPANT:ZT,SUBSTITUTION_METHOD:QT,REMOVE_SUBSTITUTION:JT,REMOVE_PARTICIPANT:eD,SCHEDULE_METHOD:tD,SUBSTITUTION:rD,SCHEDULE:iD,PENALTY:"PENALTY",REFEREE:nD,STATUS:aD,SCORE:sD,START:oD,END:"END"};function uD({tournamentParticipants:e=[],possiblyDisablingAction:t,activeDrawPositions:r,positionAssignments:i,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:c,structureId:u,structure:l,drawId:d,event:p}){if(r.includes(s))return{};let m=c.find(e=>e.type===qU)?.availableParticipantIds,f=a?.[Lp]?.otherFlightEntries,h=a?.[Lp]?.restrictQualifyingAlternates,g=(o.entries??[]).filter(({entryStage:e})=>!h||(l.stage===Ml?e===Ml:e!==Ml)).sort((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0)).map(({participantId:e})=>e).filter(Boolean),{allPositionedParticipantIds:I}=Df({drawDefinition:o}),y=i.map(e=>e.participantId).filter(Boolean),v=g.filter(e=>l.stage&&[Ml,El,Cl].includes(l.stage)?!I?.includes(e):!y.includes(e)),S=(p?.entries??[]).filter(e=>e.entryStatus===sg&&lD({restrictQualifyingAlternates:h,structure:l,entry:e})&&(l.stage&&[Ml,El,Cl].includes(l.stage)?!I?.includes(e.participantId):!y.includes(e.participantId))).sort((e,t)=>(e.entryPosition??1/0)-(t.entryPosition??1/0)).map(e=>e.participantId),b=vi(v.concat(S));if(f){let e=(p?py({event:p}).flightProfile:void 0)?.flights?.filter(e=>e.drawId!==d).map(e=>e.drawEntries.filter(e=>e.participantId&&![vg,gg,Ig].includes(e.entryStatus)&&!g.includes(e.participantId)).map(({participantId:e})=>e)).flat().filter(Boolean);e?.length&&b.push(...e)}m?.length&&(b=b.filter(e=>!m.includes(e)));let U=n?e?.filter(e=>b.includes(e.participantId)):void 0;return U?.forEach(e=>{let t=(o.entries??[]).find(t=>t.participantId===e.participantId);e.entryPosition=t?.entryPosition}),U?.sort((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0)),b.length?{validAlternatesAction:nc({payload:{drawId:d,structureId:u,drawPosition:s},willDisableLinks:t,method:"alternateDrawPositionAssignment",availableAlternatesParticipantIds:b,type:GU,availableAlternates:U})}:{}}function lD({restrictQualifyingAlternates:e,structure:t,entry:r}){let{stage:i}=t;if(!r.entryStage||r.entryStage===i||i===Ml&&!e||r.entryStage===El&&i===Rl)return!0}function dD({restrictAdHocRoundParticipants:e,tournamentParticipants:t,matchUpParticipantIds:r,otherFlightEntries:i,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:c,matchUp:u,drawId:l,event:d}){let p=[],m=c?.matchUps??[],f=u.sides?.find(e=>e.sideNumber===o)?.participantId,h=m.filter(({roundNumber:e})=>e===u.roundNumber),g=n?.entries?.filter(({entryStatus:e})=>e&&Ug.includes(e)).map(Hm)??[],I=h.map(e=>(e.sides??[]).flatMap(Hm)).flat().filter(Boolean),y=g.filter(t=>!(r.includes(t)||e&&I.includes(t))),v=t?.filter(e=>y?.includes(e.participantId)).map(e=>Nu(e,void 0,!0));v?.forEach(e=>{let t=(n.entries??[]).find(t=>t.participantId===e.participantId);e.entryPosition=t?.entryPosition}),y.length&&p.push({payload:{drawId:l,matchUpId:s,structureId:a,sideNumber:o},method:XT,type:qU,availableParticipantIds:y,participantsAvailable:v});let S=function({eventEntries:e,structure:t}){return e.filter(e=>e.entryStatus===sg&&lD({structure:t,entry:e})).sort((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0)).map(Hm)}({eventEntries:d?.entries??[],structure:c}),b=vi(g.concat(S));if(i){let e=(d?py({event:d}):void 0)?.flights?.filter(e=>e.drawId!==l).flatMap(e=>e.drawEntries.filter(e=>e.participantId&&![vg,gg,Ig].includes(e.entryStatus)).map(({participantId:e})=>e)).filter(Boolean);e?.length&&b.push(...e)}b=b.filter(t=>!(r.includes(t)||y.includes(t)||e&&I.includes(t)));let U=t?.filter(e=>b.includes(e.participantId)).map(e=>Nu(e,void 0,!0));if(U?.forEach(e=>{let t=(n.entries??[]).find(t=>t.participantId===e.participantId);e.entryPosition=t?.entryPosition}),U?.sort((e,t)=>(e.entryPosition||1/0)-(t.entryPosition||1/0)),b.length&&p.push({payload:{drawId:l,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:b,participantsAvailable:U,method:XT,type:sg}),!qy(u)&&o&&f){p.push({payload:{drawId:l,matchUpId:s,structureId:a,sideNumber:o},method:"removeMatchUpSideParticipant",type:eD});let e=e=>e.sides.map(Hm),r=({matchUpId:e})=>e!==u.matchUpId,i=e=>!qy(e),n=u.sides?.find(e=>e.sideNumber!==o)?.participantId,c=[n,...m.filter(({roundNumber:e})=>e!==u.roundNumber).filter(r).map(e).filter(e=>e.includes(f)).flat()].filter(Boolean),d=e=>!c.flat().includes(e),g=h.filter(i).filter(r).map(e).flat().filter(d);if(g.length){let e=t?.filter(e=>g.includes(e.participantId)).map(e=>Nu(e,void 0,!0));p.push({payload:{participantIds:[f],roundNumber:u.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:l},swappableParticipantIds:g,method:"adHocPositionSwap",type:KU,swappableParticipants:e})}}return p}function pD(e){if(!e)return{error:Zo};let{drawDefinition:t,event:r}=e,{restrictAdHocRoundParticipants:i=!0,policyDefinitions:n,enforceGender:a,participantId:o,sideNumber:s,matchUpId:c}=e,u=e.tournamentRecord??(e.tournamentId&&ei(e.tournamentId)&&e.tournamentRecords?.[e.tournamentId]);if(!u)return{error:Ji};if(!c||!ei(c))return{error:ua};if(s&&![1,2].includes(s))return ac({result:{error:Zo},context:{sideNumber:s}});if(!t){let e=(Oy({tournamentRecord:u}).matchUps??[]).find(e=>e.matchUpId===c);r=(u?.events??[]).find(t=>t.eventId===e?.eventId);let i=(r?.drawDefinitions??[]).find(t=>t.drawId===e?.drawId);i&&(t=i)}if(!t)return{error:rn};let l=mS({withIndividualParticipants:!0,tournamentRecord:u}).participants,{drawId:d}=t,{matchUp:p,structure:m}=Aw({drawDefinition:t,matchUpId:c,event:r});if(!p)return{error:da};let f=zh({tournamentRecord:u,drawDefinition:t,structure:m,event:r}).appliedPolicies??{};Object.assign(f,n??{});let h=f?.[Lp]?.otherFlightEntries,g=f?.[Bp]??MS[Bp],{enabledStructures:I}=GT({actionType:jT,appliedPolicies:f,drawDefinition:t,structure:m}),{policyActions:y}=qT({enabledStructures:I,drawDefinition:t,structure:m}),v=e.matchUpsMap??kg({drawDefinition:t}),S=e.inContextDrawMatchUps??Cy({tournamentParticipants:l,inContext:!0,drawDefinition:t,matchUpsMap:v,event:r}).matchUps,b=S?.find(e=>e.matchUpId===c),U=s&&b?.sides?.find(e=>e.sideNumber===s),w=b?.sides?.map(e=>e.participantId||e.participant?.participantid).filter(Boolean)??[],{assignedPositions:T,allPositionsAssigned:D}=Nf({structure:m}),{structureId:P}=m??{},N=[];if(!P)return{validActions:N};let E=jg({structure:m}),M=!!p.collectionId;if(E&&!M){let e=dD({restrictAdHocRoundParticipants:i,tournamentParticipants:l,matchUpParticipantIds:w,otherFlightEntries:h,drawDefinition:t,structureId:P,sideNumber:s,matchUpId:c,structure:m,matchUp:p,drawId:d,event:r});N.push(...e)}let R=Wb({drawDefinition:t,structure:m}),A=T?.filter(e=>e.participantId).map(e=>e.drawPosition),C=T?.filter(e=>e.bye).map(e=>e.drawPosition),k="BYE"===p.matchUpStatus||!M&&p.drawPositions?.reduce((e,t)=>C?.includes(t)||e,!1);if(k)return{validActions:N,isByeMatchUp:k};HT({policyActions:y,action:nD})&&N.push({type:nD,payload:{matchUpId:c}});let x=!Hy({matchUpStatus:p.matchUpStatus}),O=f?.scoring?.structures,F=m?.stage&&O?.stage?.[m.stage],_=m?.stageSequence&&F?.stageSequence?.[m.stageSequence],L=!(f?.scoring?.requireAllPositionsAssigned||F?.requireAllPositionsAssigned||_?.requireAllPositionsAssigned)||D,B=2===p.sides?.filter(e=>e?.participantId).length,$=p.matchUpStatus&&[nf,rf].includes(p.matchUpStatus),V=BT({inContextDrawMatchUps:S,drawDefinition:t,targetData:Ey({inContextDrawMatchUps:S,drawDefinition:t,matchUpId:c})}),j=(2===b?.drawPositions?.length&&b.drawPositions.every(e=>A?.includes(e))&&2===b?.sides?.length&&b.sides.every(({participantId:e})=>e)||B)&&!($&&V),G={method:$U,type:JU,payload:{drawId:d,matchUpId:c,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(x&&N.push({payload:{drawId:d,matchUpId:c,schedule:{}},method:tD,type:iD}),HT({policyActions:y,action:JU})&&(U?.participant||!s&&w?.length)&&N.push(G),x&&j&&N.push({type:aD}),L&&j){let{matchUpId:e,matchUpFormat:t}=p,r={drawId:d,matchUpId:e,matchUpFormat:t,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};N.push({info:"set outcome and winningSide",method:tD,type:sD,payload:r}),HT({policyActions:y,action:oD})&&N.push({type:oD}),HT({policyActions:y,action:"END"})&&N.push({type:"END"})}if(M&&b){let e=function({specifiedPolicyDefinitions:e,inContextDrawMatchUps:t,matchUpParticipantIds:r,matchUpActionsPolicy:i,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:c,matchUpId:u,matchUp:l,drawId:d,side:p}){let m=[],f=n.sides?.find(e=>e.participant),h=mc(n.gender)&&n.sideNumber&&1===n.sides?.filter(e=>e.particiapntId).length&&f?.participant?.person?.sex,g=n.matchUpType,I=!1!==(o??i?.participants?.enforceGender)?n.gender:void 0,y=n.sides?.flatMap(e=>e.participant?.individualParticipants||e.participant).filter(Boolean)?.map(Hm),v=n.sides?.filter(e=>!c||e.sideNumber===c).flatMap(e=>e.participant?.individualParticipants||e.participant).filter(Boolean),S=v?.map(Hm),b=t?.find(e=>e.matchUpId===n.matchUpTieId)?.sides?.map(e=>e?.participant?.individualParticipants?.filter(({participantId:e,person:t})=>!S?.includes(e)&&(!I||fc(I)||t.sex===I||mc(I)&&!h||h&&t.sex!==h))),U=c?b?.[c-1]:b?.map((e,t)=>({participants:e,sideNumber:t+1})),w=c?b?.[c-1]?.map(Hm):b?.map((e,t)=>({participants:e?.map(Hm),sideNumber:t+1})),T=c&&(MI(Gr)(g)&&!S?.length||MI(qr)(g)&&(S?.length??0)<2)||!c&&(MI(Gr)(g)&&(S?.length??0)<2||MI(qr)(g)&&(S?.length??0)<4),D=w?.filter(e=>!y?.includes(e)),P=U?.filter(({participantId:e})=>D.includes(e));if(T&&D?.length&&m.push({availableParticipantIds:D,method:YT,availableParticipants:P,type:qU,payload:{participantId:void 0,tieMatchUpId:u,sideNumber:c,drawId:d}}),S?.length&&(!qy(l)||p?.substitutions?.length)&&m.push({method:KT,type:eD,existingParticipantIds:S,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}}),P?.length&&(!c&&S?.length||c&&p?.participant)&&m.push({availableParticipantIds:D,method:zT,availableParticipants:P,type:ZT,existingParticipantIds:S,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:u,drawId:d}}),HT({policyActions:a,action:JT})&&p?.substitutions?.length){let e=p.participant?.participantType===wh&&[p.participantId]||p.participant?.participantType===Dh&&p.participant.individualParticipantIds||[],t=p.substitutions.map(e=>e.participantId).filter(t=>e.includes(t));(!s||t.includes(s))&&m.push({method:KT,type:JT,substitutedParticipantIds:t,payload:{participantId:void 0,tieMatchUpId:u,drawId:d}})}let N=e?.[Bp],E=N?.substituteWithoutScore,M=N?.substituteAfterCompleted;if(HT({policyActions:a,action:rD})&&2===r.length&&(!c&&S?.length||c&&p?.participant)&&(E||qy(l))&&(M||l.matchUpStatus&&!If.includes(l.matchUpStatus))&&v?.length&&U.length){let e=v.map(Hm);m.push({info:"list of team players available for substitution",method:QT,availableParticipantIds:w,existingParticipantIds:e,availableParticipants:U,existingParticipants:v,type:rD,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:c,matchUpId:u,drawId:d}})}return m}({specifiedPolicyDefinitions:n,inContextDrawMatchUps:S,matchUpParticipantIds:w,matchUpActionsPolicy:g,inContextMatchUp:b,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:c,matchUp:p,drawId:d,side:U});N.push(...e)}return{structureIsComplete:R,validActions:N,isDoubleExit:$,...Gi}}function mD({tournamentParticipants:e=[],sourceStructuresComplete:t,possiblyDisablingAction:r,isWinRatioFedStructure:i,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:c,structure:u,drawId:l,event:d}){if(n.includes(s)||i&&!t)return{};let{sourceStructureIds:p,targetStructureIds:m}=o.links?.reduce((e,t)=>{let r=t.source?.structureId,i=t.target?.structureId;return e.sourceStructureIds.includes(r)||e.sourceStructureIds.push(r),e.targetStructureIds.includes(i)||e.targetStructureIds.push(i),e},{sourceStructureIds:[],targetStructureIds:[]})||{},f=[],h=o.links?.filter(e=>e.target?.structureId===u.structureId)??[];for(let I of h){let e=I?.source?.structureId,{structure:t}=wf({structureId:e,drawDefinition:o}),r={};if(t?.finishingPosition===Pd&&(1!==p?.length||1!==m?.length)){let{matchUps:e}=Uy({drawDefinition:o,structure:u,event:d}),{initialRoundNumber:t}=Xy({drawPosition:s,matchUps:e}),i=o.links?.find(e=>e.target?.structureId===u?.structureId&&e.target.roundNumber===t)?.source?.roundNumber;r.roundNumbers=[i]}let{completedMatchUps:i}=Ty({structureId:e,inContext:!0,matchUpFilters:r,drawDefinition:o}),n=a.map(e=>e.participantId).filter(Boolean);i?.filter(({matchUpType:e,winningSide:t})=>t&&(d?.eventType!==Dl||e===Dl)).map(({winningSide:e,sides:t})=>e&&t?.[1-(e-1)]).map(Hm).filter(e=>e&&!n.includes(e))?.forEach(e=>{f.includes(e)||f.push(e)})}let g=e?.filter(e=>f?.includes(e.participantId));return g?.forEach(e=>{let t=(o.entries??[]).find(t=>t.participantId===e.participantId);e.entryPosition=t?.entryPosition}),f?.length?{validLuckyLosersAction:{type:zU,method:"luckyLoserDrawPositionAssignment",availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:r,payload:{drawId:l,structureId:c,drawPosition:s}}}:{}}function fD({positionSourceStructureIds:e,unassignedParticipantIds:t,possiblyDisablingAction:r,provisionalPositioning:i,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:c,drawDefinition:u,seedingProfile:l,isByePosition:d,drawPosition:p,structureId:m,event:f}){let h,g,{drawId:I}=u,y=[],v=[],S=c?.[zp]?.validSeedPositions?.ignore;if(S||({unplacedSeedParticipantIds:h,unplacedSeedAssignments:g,unfilledPositions:v}=Ib({provisionalPositioning:i,returnAllProxies:!0,randomize:!0,drawDefinition:u,seedingProfile:l,structureId:m})),v?.length||(v=o.filter(e=>!e.participantId&&!e.bye&&!e.qualifier).map(e=>e.drawPosition)),d||y.push({payload:{drawId:I,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:r,method:"assignDrawPositionBye",type:"BYE"}),a&&S){let t=o.map(e=>e.participantId).filter(Boolean),i={structureIds:e},{completedMatchUps:a}=ky({inContext:!0,matchUpFilters:i,drawDefinition:u}),c=vi((a??[]).filter(({matchUpType:e})=>f?.eventType!==Dl||e===Dl)?.map(({sides:e})=>e?.map(Hm)).flat().filter(e=>e&&!t.includes(e))),l=s?n?.filter(e=>c?.includes(e.participantId)).map(e=>Nu(e,void 0,!0)):void 0;return l?.forEach(e=>{let t=(u.entries??[]).find(t=>t.participantId===e.participantId);e.entryPosition=t?.entryPosition}),l?.length&&y.push(nc({payload:{drawId:I,structureId:m,drawPosition:p},willDisableLinks:r,method:BU,type:qU,availableParticipantIds:c,participantsAvailable:l})),{validAssignmentActions:y}}if(v.includes(p)||d){let e;if(g?.length){let t=g.filter(e=>h?.includes(e.participantId));t.sort(hD),e=t.map(e=>e.participantId)}else e=t;let i=s?n?.filter(t=>e.includes(t.participantId)).map(e=>Nu(e,void 0,!0)):void 0;i?.length&&y.push(nc({payload:{drawId:I,structureId:m,drawPosition:p},willDisableLinks:r,method:BU,type:qU,availableParticipantIds:e,participantsAvailable:i}))}return{validAssignmentActions:y}}function hD(e,t){return e.bye||pb(e.seedValue)<pb(t.seedValue)||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function gD({drawPositionInitialRounds:e,tournamentParticipants:t,positionAssignments:r,returnParticipants:i,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:c}){let u=[],l=[],d=[],p=[],m=new Set(r.map(e=>e.participantId).filter(Boolean)),f=n?.[Lp],h=!f?.disableRoundRestrictions&&e[o],g=f?.requireCompletedStructures,{sourceStructureIds:I,relevantLinks:y}=bU({targetRoundNumber:h,linkType:Xl,drawDefinition:a,structureId:s})||{};I?.length&&p.push(...I);let{sourceStructureIds:v,relevantLinks:S}=bU({targetRoundNumber:h,linkType:Kl,drawDefinition:a,structureId:s})||{};v?.length&&p.push(...v);for(let b of y){let e=a.structures?.find(e=>e.structureId===b.source.structureId);if(e?.stage!==Ml)continue;let r=Wb({structureId:b.source.structureId,drawDefinition:a});if(!g||r){let r=e.qualifyingRoundNumber,{matchUps:n}=Uy({matchUpFilters:{roundNumbers:[r],isCollectionMatchUp:!1,hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:t,inContext:!0,structure:e});for(let e of n){let t=e.sides.find(t=>t?.sideNumber===e.winningSide),r="BYE"===e.matchUpStatus&&e.sides?.find(({participantId:e})=>e);if(t||r){let{participantId:e,participant:n}=t||r||{};e&&!m.has(e)&&(n&&i&&u.push(n),l.push(e))}}}}for(let b of S){let e=a.structures?.find(e=>e.structureId===b.source.structureId);if(e?.stage!==Ml)continue;let r=Wb({structureId:b.source.structureId,drawDefinition:a});if(!g||r){let{positionAssignments:r}=Pf({structure:e}),n=r?.map(e=>{let t=e.participantId,r=lm({element:e,name:Cm}).extension?.value;return r?{participantId:t,groupOrder:r?.groupOrder}:{}}).filter(({groupOrder:e,participantId:t})=>1===e&&!m.has(t)).map(({participantId:e})=>e)??[];if(n&&l.push(...n),i){let e=t.filter(({participantId:e})=>n.includes(e));u.push(...e)}}}return l.length&&d.push(nc({qualifyingParticipants:i?u:void 0,method:"qualifierDrawPositionAssignment",type:jU,qualifyingParticipantIds:l,payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:c}})),{validAssignmentActions:d,sourceStructureIds:p}}function ID({onlyAssignedPositions:e=!0,possiblyDisablingAction:t,tournamentParticipants:r,inactiveDrawPositions:i,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:c,isByePosition:u,drawPosition:l,structureId:d,structure:p,drawId:m,event:f}){if(n.includes(l))return{};let h=i?.filter(e=>e!==l&&!(u&&s.includes(e))),g=a?.filter(t=>(t=>!e||t.participantId||t.qualifier||t.bye)(t)&&h?.includes(t.drawPosition))??[],I=g.map(({drawPosition:e})=>e),{matchUps:y}=Uy({afterRecoveryTimes:!1,inContext:!0,drawDefinition:c,structure:p,event:f}),v=y.filter(({drawPositions:e})=>xi(e,I)),S=Object.assign({},...v.map(e=>e.sides?.filter(({sourceDrawPositionRange:e})=>e).map(({drawPosition:e,sourceDrawPositionRange:t})=>({[e]:t}))).flat()),b=g.map(e=>e.participantId).filter(Boolean),U=(r??[]).filter(e=>b.includes(e.participantId)),w=Object.assign({},...U.map(e=>({[e.participantId]:e}))),T=g.map(e=>{let t=w?.[e.participantId],r=S[e.drawPosition];return nc({...e,participant:o?Nu(t,!1,!0):void 0,sourceDrawPositionRange:r})});return T.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[l]},willDisableLinks:t,method:LU,type:KU,availableAssignments:T}}:{}}function yD(e){return function(e){let t=Dp(e,[{event:!0,drawDefinition:!0,structureId:!0}]);if(t.error)return t;let{policyDefinitions:r,returnParticipants:i=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:c}=e,u=e.tournamentParticipants??(a&&mS({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],l=wf({structureId:e.structureId,drawDefinition:o});if(l.error)return l;let d=l.containingStructure||l.structure;if(!d)return{error:Fn};let p=d.structureId;if(l=Ky({drawDefinition:o,structureId:p}),void 0===s&&!l.isAdHoc)return{error:yn};if(l.isAdHoc)return pD(e);if(l.error)return l;let{drawPositionInitialRounds:m,inactiveDrawPositions:f,activeDrawPositions:h,byeDrawPositions:g}=l,I=zh({tournamentRecord:a,drawDefinition:o,structure:d,event:c}).appliedPolicies??{};Object.assign(I,r??{});let y,{actionsPolicy:v,enabledStructures:S,actionsDisabled:b}=GT({actionType:VT,appliedPolicies:I,drawDefinition:o,structure:d}),U=v?.activePositionOverrides||[],{sourceStructureIds:w}=bU({finishingPosition:Dd,targetRoundNumber:1,linkType:Kl,drawDefinition:o,structureId:p})||{};w?.length&&(y=w.every(e=>Wb({structureId:e,drawDefinition:o})));let T=w.length,D=w.length&&!y,{policyActions:P}=qT({enabledStructures:S,drawDefinition:o,structure:d}),N=![Ml,El].includes(d.stage)||1!==d.stageSequence,{drawId:E}=o,M=[],{assignedPositions:R,positionAssignments:A}=Nf({structure:d}),C=R?.find(e=>e.drawPosition===s),k=!!C;if(!A?.map(e=>e.drawPosition)?.includes(s))return{error:In};let{stage:x,stageSequence:O}=d,F=[x];x===Rl&&F.push(El),x===El&&F.push(Rl);let _=Eg({entryStatuses:Ug,provisionalPositioning:n,drawDefinition:o,stageSequence:O,structureId:p,stages:F}),L=pv({drawDefinition:o,stages:F}).assignedParticipantIds??[],B=function(e,t){return e.filter(e=>!t.includes(e.participantId)).map(e=>e.participantId)}(_,L),$=g.includes(s),V=h.includes(s);if(b)return{info:"Actions Disabled for structure",isActiveDrawPosition:V,isDrawPosition:!0,hasPositionAssigned:k,validActions:[],isByePosition:$};(function({validActions:e,policyActions:t,isActiveDrawPosition:r,positionAssignments:i,disablePlacementActions:n,positionAssignment:a,isByePosition:o,getValidAssignmentActions:s,positionSourceStructureIds:c,unassignedParticipantIds:u,possiblyDisablingAction:l,isWinRatioFedStructure:d,tournamentParticipants:p,returnParticipants:m,appliedPolicies:f,drawDefinition:h,drawPosition:g,structureId:I,event:y}){if(HT({policyActions:t,action:qU})&&!r&&i&&!n&&(!a||o)){let{validAssignmentActions:t}=s({positionSourceStructureIds:c,unassignedParticipantIds:u,possiblyDisablingAction:l,isWinRatioFedStructure:d,tournamentParticipants:p,positionAssignments:i,returnParticipants:m,appliedPolicies:f,drawDefinition:h,isByePosition:o,drawPosition:g,structureId:I,event:y});t?.forEach(t=>e.push(t))}})({validActions:M,policyActions:P,isActiveDrawPosition:V,positionAssignments:A,disablePlacementActions:D,positionAssignment:C,isByePosition:$,getValidAssignmentActions:fD,positionSourceStructureIds:w,unassignedParticipantIds:B,possiblyDisablingAction:N,isWinRatioFedStructure:T,tournamentParticipants:u,returnParticipants:i,appliedPolicies:I,drawDefinition:o,drawPosition:s,structureId:p,event:c}),function({validActions:e,policyActions:t,isActiveDrawPosition:r,getValidQualifiersAction:i,drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:o,returnParticipants:s,appliedPolicies:c,drawDefinition:u,drawPosition:l,structureId:d,drawId:p}){if(HT({policyActions:t,action:jU})&&!r){let{validAssignmentActions:t}=i({drawPositionInitialRounds:n,tournamentParticipants:a,positionAssignments:o,returnParticipants:s,appliedPolicies:c,drawDefinition:u,drawPosition:l,structureId:d,drawId:p});t?.forEach(t=>e.push(t))}}({validActions:M,policyActions:P,isActiveDrawPosition:V,getValidQualifiersAction:gD,drawPositionInitialRounds:m,tournamentParticipants:u,positionAssignments:A,returnParticipants:i,appliedPolicies:I,drawDefinition:o,drawPosition:s,structureId:p,drawId:E});let{participantId:j}=C||{},G=j&&u.find(e=>e.participantId===j);return C&&(function({validActions:e,policyActions:t,isActiveDrawPosition:r,drawId:i,structureId:n,drawPosition:a,possiblyDisablingAction:o,isByePosition:s}){HT({policyActions:t,action:HU})&&!r&&(e.push({type:HU,method:_U,payload:{drawId:i,structureId:n,drawPosition:a},willDisableLinks:o}),s||e.push({type:WU,method:"withdrawParticipantAtDrawPosition",payload:{drawId:i,structureId:n,drawPosition:a},willDisableLinks:o}),HT({policyActions:t,action:"BYE"})&&!s&&e.push({type:"BYE",method:_U,payload:{drawId:i,structureId:n,drawPosition:a,replaceWithBye:!0},willDisableLinks:o}))}({validActions:M,policyActions:P,isActiveDrawPosition:V,drawId:E,structureId:p,drawPosition:s,possiblyDisablingAction:N,isByePosition:$}),function({validActions:e,policyActions:t,activePositionsCheck:r,activePositionOverrides:i,activeDrawPositions:n,drawDefinition:a,structureId:o,drawPosition:s,structure:c,isByePosition:u,participantId:l,participant:d,drawId:p}){let m=c.stage===Ml||c.stage===El&&1===c.stageSequence;if(!u&&r({activePositionOverrides:i,activeDrawPositions:n,action:QU})&&HT({policyActions:t,action:QU})&&gb({drawDefinition:a,structureId:o,drawPosition:s})&&m){let{seedAssignments:t}=Mg({returnAllProxies:!0,drawDefinition:a,structure:c}),{seedNumber:r,seedValue:i}=t?.find(e=>e.participantId===l)??{};e.push({type:QU,method:"modifySeedAssignment",participant:d,seedNumber:r,payload:{drawId:p,structureId:o,participantId:l,seedValue:i}})}if(!u&&r({activePositionOverrides:i,activeDrawPositions:n,action:YU})&&HT({policyActions:t,action:YU})&&gb({drawDefinition:a,structureId:o,drawPosition:s})&&m){let{seedAssignments:t}=Mg({returnAllProxies:!0,drawDefinition:a,structure:c}),{seedNumber:r}=t?.find(e=>e.participantId===l)??{};e.push({method:"removeSeededParticipant",type:YU,participant:d,seedNumber:r,payload:{participantId:l,structureId:o,drawId:p}})}}({validActions:M,policyActions:P,activePositionsCheck:WT,activePositionOverrides:U,activeDrawPositions:h,drawDefinition:o,structureId:p,drawPosition:s,structure:d,isByePosition:$,participantId:j,participant:G,drawId:E}),function({validActions:e,policyActions:t,isByePosition:r,participantId:i,participant:n,drawId:a}){if(!r&&i){if(HT({policyActions:t,action:JU})){let t={type:JU,method:$U,participant:n,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:a}};e.push(t)}if(HT({policyActions:t,action:XU})){let t={type:XU,method:"modifyParticipantOtherName",participant:n,payload:{participantId:i,otherName:void 0}};e.push(t)}}}({validActions:M,policyActions:P,isByePosition:$,participantId:j,participant:G,drawId:E}),function({validActions:e,policyActions:t,getValidSwapAction:r,possiblyDisablingAction:i,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:o,positionAssignments:s,returnParticipants:c,byeDrawPositions:u,drawDefinition:l,isByePosition:d,drawPosition:p,structureId:m,structure:f,drawId:h}){if(HT({policyActions:t,action:KU})){let{validSwapAction:t}=r({possiblyDisablingAction:i,tournamentParticipants:n,inactiveDrawPositions:a,activeDrawPositions:o,positionAssignments:s,returnParticipants:c,byeDrawPositions:u,drawDefinition:l,isByePosition:d,drawPosition:p,structureId:m,structure:f,drawId:h});t&&e.push(t)}}({validActions:M,policyActions:P,getValidSwapAction:ID,possiblyDisablingAction:N,tournamentParticipants:u,inactiveDrawPositions:f,activeDrawPositions:h,positionAssignments:A,returnParticipants:i,byeDrawPositions:g,drawDefinition:o,isByePosition:$,drawPosition:s,structureId:p,structure:d,drawId:E})),function({validActions:e,policyActions:t,getValidAlternatesAction:r,possiblyDisablingAction:i,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:o,returnParticipants:s,appliedPolicies:c,drawDefinition:u,drawPosition:l,structureId:d,structure:p,drawId:m,event:f,disablePlacementActions:h}){if(HT({policyActions:t,action:GU})&&!h){let{validAlternatesAction:t}=r({possiblyDisablingAction:i,tournamentParticipants:n,positionAssignments:a,activeDrawPositions:o,returnParticipants:s,appliedPolicies:c,drawDefinition:u,drawPosition:l,validActions:e,structureId:d,structure:p,drawId:m,event:f});t&&e.push(t)}}({validActions:M,policyActions:P,getValidAlternatesAction:uD,possiblyDisablingAction:N,tournamentParticipants:u,positionAssignments:A,activeDrawPositions:h,returnParticipants:i,appliedPolicies:I,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:E,event:c,disablePlacementActions:D}),function({validActions:e,policyActions:t,getValidLuckyLosersAction:r,sourceStructuresComplete:i,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:o,activeDrawPositions:s,positionAssignments:c,drawDefinition:u,drawPosition:l,structureId:d,structure:p,drawId:m,disablePlacementActions:f,isActiveDrawPosition:h}){if(HT({policyActions:t,action:zU})&&!f&&!h&&c){let{validLuckyLosersAction:t}=r({sourceStructuresComplete:i,possiblyDisablingAction:n,isWinRatioFedStructure:a,tournamentParticipants:o,activeDrawPositions:s,positionAssignments:c,drawDefinition:u,drawPosition:l,structureId:d,structure:p,drawId:m});t&&e.push(t)}}({validActions:M,policyActions:P,getValidLuckyLosersAction:mD,sourceStructuresComplete:y,possiblyDisablingAction:N,isWinRatioFedStructure:T,tournamentParticipants:u,activeDrawPositions:h,positionAssignments:A,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:E,disablePlacementActions:D,isActiveDrawPosition:V}),function({validActions:e,policyActions:t,getValidModifyAssignedPairAction:r,participant:i,tournamentParticipants:n,returnParticipants:a,drawPosition:o,drawId:s,event:c}){if(i?.participantType===Dh&&HT({policyActions:t,action:VU})){let{validModifyAssignedPairAction:t}=r({tournamentParticipants:n,returnParticipants:a,drawPosition:o,participant:i,drawId:s,event:c});t&&e.push(t)}}({validActions:M,policyActions:P,getValidModifyAssignedPairAction:LT,participant:G,tournamentParticipants:u,returnParticipants:i,drawPosition:s,drawId:E,event:c}),{isActiveDrawPosition:V,isDrawPosition:!0,hasPositionAssigned:k,isByePosition:$,validActions:M,...Gi}}(e)}function vD({policyDefinitions:e,appliedPolicies:t,drawType:r}){let i=e?.[Kp]?.drawTypeCoercion,n=t?.[Kp]?.drawTypeCoercion;return("boolean"==typeof i?i:void 0)??(r&&i?.[r])??("boolean"==typeof n?n:void 0)??(r&&n?.[r])??!0}var SD=({drawDefinition:e})=>{let t=Dp({drawDefinition:e},[{[xd]:!0}]);if(t.error)return t;let r=e.structures?.find(e=>e.stage===El&&1===e.stageSequence);if(!r)return ac({result:{error:Bn}});let{qualifierPositions:i}=Nf({structure:r});return Ri(0,i.length).sort(()=>Math.random()-.5)};function bD({structureId:e,drawDefinition:t}){if(!t)return{error:rn};if(!ei(e))return{error:Zo};let r=Py({drawDefinition:t,structureId:e});if(r.error)return r;let i=r.links.target.flatMap(e=>e.target.feedProfile).filter(Boolean),n=!Ci([Yl,zl,Hl,jl],i).length;return{...Gi,valid:n}}function UD({participantsCount:e,participantCount:t}){if(!(e=e??t))return{error:Zo};let r=fi(e);return r?{drawSize:r}:ac({result:{error:Zo},stack:"getEliminationDrawSize",context:{participantsCount:e}})}function wD(e){let{drawSizeProgression:t=!1,policyDefinitions:r,drawSize:i}=e||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=e||{},c="getSeedsCount",u=e?.participantsCount??e?.participantCount;if(!r){let e=Yh({tournamentRecord:a,drawDefinition:o,event:s});if(e.error)return ac({result:e,stack:c});r=e.policyDefinitions}let l=gi(u);if(u&&!l)return ac({result:{error:Zo},context:{participantsCount:u},stack:c});if(n&&!l)return ac({result:{error:ao},stack:c});if(Number.isNaN(Number(i))){if(!u)return ac({result:{error:Un},stack:c});({drawSize:i}=UD({participantsCount:u}))}let d=n&&u||i;if(d&&d>i)return{error:lo};let p=r?.[zp];if(!p)return{error:va};let m=p.seedsCountThresholds;return m?(void 0!==p.drawSizeProgression&&(t=p.drawSizeProgression),{seedsCount:m.filter(e=>t?e.drawSize<=i:i===e.drawSize).reduce((e,t)=>u&&u>=t.minimumParticipantCount?t.seedsCount:e,0)}):{error:Nn}}function TD({consideredEntries:e,policyDefinitions:t,tournamentRecord:r,appliedPolicies:i,participantMap:n,enforceGender:a,participants:o,event:s}){if((!o||!n)&&r&&({participants:o,participantMap:n}=mS({tournamentRecord:r})),!o)return{error:Ja};if(!Array.isArray(o))return{error:Zo};if(!s)return{error:jn};let c=t?.[Bp]??i?.[Bp]??MS[Bp],u=!1!==(a??c?.participants?.enforceGender),{eventType:l,gender:d}=s,p=l===Tl,m=l===Pl&&Ph||p&&Dh||wh,f=Object.assign({},...(e??s.entries??[]).map(e=>({[e.participantId]:e.entryStatus}))),h=Object.keys(f),g=o.filter(e=>h.includes(e.participantId)).filter(e=>{let t=function({participant:e,participantType:t,eventType:r,entryStatusMap:i}){let n=i[e.participantId],a=r&&[Tl,Pl].includes(r)&&e.participantType===wh&&(fv(n)||n===vg);return e.participantType!==t&&!a}({participant:e,participantType:m,eventType:l,entryStatusMap:f}),r=function(e){let{participant:t,participantMap:r,eventGender:i,mismatch:n,isDoubles:a,genderEnforced:o}=e,s=!n&&a&&vi(t?.individualParticipantIds?.map(e=>r?.[e]?.participant?.person?.sex).filter(Boolean)??[])||[],c=!i||!s?.length||fc(i)||gc(i)&&hc(s[0])===hc(i)||mc(i)&&(1===s.length&&1===t.individualParticipantIds?.length||2===s.length),u=t?.person?.sex,l=!t?.person||!i||mc(i)||fc(i)||gc(i)&&hc(u)===hc(i);return!o||c&&l}({genderEnforced:u,participantMap:n,eventGender:d,participant:e,isDoubles:p,mismatch:t});return t||!r});if(g.length){let e=g.map(e=>e.participantId);return{error:Hn,invalidParticipantIds:e}}return{...Gi,valid:!0}}function DD({hasExistingDrawDefinition:e,qualifyingProfiles:t,appliedPolicies:r,qualifyingOnly:i,tieFormat:n,idPrefix:a,isMock:o,uuids:s}){let c,u=[],l=[],d=[],p=(e,t)=>e.stageSequence-t.stageSequence,m=(e,t)=>e.roundTarget-t.roundTarget,f=0,h=0,g=1;for(let I of t.sort(m)){let m=I.structureProfiles||[];g=I.roundTarget||g;let y,v,S,b=1,U=0;for(let u of(m||[]).sort(p)){let p,h,I,w=li(u.drawSize||u.participantsCount),{qualifyingRoundNumber:T,structureOptions:D,matchUpFormat:P,structureName:N,structureId:E,drawType:M}=u,R=u.matchUpType,A=u.qualifyingPositions||PD({drawSize:w,qualifyingRoundNumber:T});if(!gi(w))return ac({result:{error:Un},stack:"generateQualifyingSTructures"});let C=t.length>1?`${g}-`:"",k=m.length>1||C?b:"",x=N||(C||k?`${eb(Ml)} ${C}${k}`:eb(Ml));if(M===vd){let{structures:t,groupCount:l,maxRoundNumber:d}=sb({structureName:u.structureName||x,structureId:E||s?.pop(),hasExistingDrawDefinition:e,stage:Ml,structureOptions:D,appliedPolicies:r,qualifyingOnly:i,stageSequence:b,matchUpType:R,roundTarget:g,tieFormat:n,drawSize:w,idPrefix:a,isMock:o,uuids:s});U=l,p=d,h=t[0],c=[1]}else({drawSize:w,matchUps:I,roundLimit:p}=cw({qualifyingRoundNumber:T,qualifyingPositions:A,matchUpType:R,drawSize:w,idPrefix:a,isMock:o,uuids:s})),h=JS({structureName:u.structureName||x,structureId:E||s?.pop(),qualifyingRoundNumber:p,hasExistingDrawDefinition:e,stage:Ml,qualifyingOnly:i,matchUpFormat:P,stageSequence:b,matchUpType:R,roundLimit:p,tieFormat:n,matchUps:I}),g&&em({extension:{name:Nm,value:g},element:h}),U=I?.filter(e=>e.roundNumber===p)?.length||0;if(b>1){let{link:e}=iw({sourceStructureId:v,sourceRoundNumber:y,targetStructureId:h.structureId,finishingPositions:S===Kl?[1]:void 0,linkType:S});d.push(e),f+=(w||0)-U}else f+=w||0;S=M===vd?Kl:Xl,v=h.structureId,y=p,n&&(I=Uy({structure:h})?.matchUps||[],I?.forEach(e=>{let{tieMatchUps:t}=nw({tieFormat:n,matchUp:e,isMock:o});Object.assign(e,{tieMatchUps:t,matchUpType:R})})),l.push(h),b+=1}h+=U,u.push({qualifiersCount:U,finalQualifyingRoundNumber:y,finalQualifyingStructureId:v,finishingPositions:c,roundTarget:g,linkType:S}),g+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:f,qualifyingDetails:u,structures:l,...Gi,links:d}}function PD({drawSize:e,qualifyingRoundNumber:t}){let r=e,i=0;for(;i<t;)r=Math.floor(r/2),i+=1;return r}function ND(e){let{drawTypeCoercion:t,enforceMinimumDrawSize:r}=e,i=Jr(e.drawSize),n=t&&e.drawType!==Zl&&("boolean"==typeof t||t<=2)&&2===i&&id||e.drawType||id,a=Nd.includes(n);if(i&&a)if(t&&("boolean"==typeof t&&i<4||i<=t))n=id;else if(i<4&&r)return{...ac({context:{enforceMinimumDrawSize:r,drawSize:i,drawType:n},result:{error:Sn},stack:"getCoercedDrawType"}),drawType:n};return{drawType:n}}function ED({structureName:e,matchUpType:t,idPrefix:r,drawSize:i,isMock:n,uuids:a}){let o=[],{matchUps:s}=mw({linkFedFinishingRoundNumbers:[1],drawSize:i+1,matchUpType:t,idPrefix:r,isMock:n}),c=QS({structureName:e||eb(El),structureId:a?.pop(),stageSequence:1,stage:El,matchUpType:t,matchUps:s});o.push(c);let u=i/2,{matchUps:l}=mw({finishingPositionOffset:u,idPrefix:r&&`${r}-c`,drawSize:i-1,isConsolation:!0,matchUpType:t,isMock:n,uuids:a}),d=QS({structureName:eb(Ud),matchUps:l,structureId:a?.pop(),stage:Rl,stageSequence:2,matchUpType:t});o.push(d);let{matchUps:p}=cw({idPrefix:r&&`${r}-p1t2`,drawSize:2,matchUpType:t,isMock:n}),m=QS({structureName:eb(bd),matchUps:p,structureId:a?.pop(),stageSequence:3,stage:Cl,matchUpType:t});o.push(m);let f=function({mainStructure:e,consolationStructure:t,deciderStructure:r}){let i=t.matchUps.reduce((e,t)=>(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e,[]),n=e.matchUps.reduce((e,t)=>!e||t.roundNumber>e?t.roundNumber:e,void 0),a=t.matchUps.reduce((e,t)=>!e||t.roundNumber>e?t.roundNumber:e,void 0);return[...i.map((r,n)=>{let a=i.indexOf(r)%2?zl:Yl;return{linkType:Ql,source:{roundNumber:1+n,structureId:e.structureId},target:{feedProfile:a,roundNumber:r,structureId:t.structureId}}}),{linkType:Xl,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:zl,roundNumber:n,structureId:e.structureId}},{linkType:Xl,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:zl,roundNumber:1,structureId:r.structureId}},{linkType:Ql,source:{roundNumber:n,structureId:e.structureId},target:{feedProfile:zl,roundNumber:1,structureId:r.structureId}}]}({mainStructure:c,consolationStructure:d,deciderStructure:m});return{structures:o,links:f,...Gi}}function MD(e){let{qualifyingRoundNumber:t,finishingPositionOffset:r,qualifyingPositions:i,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:c}=e;if(!gi(o)||o<2)return{matchUps:[],roundsCount:0};if(ci(o))return cw(e);let u=function(e){let t=Jr(e),r=t%2?t+1:t,i=!!(Math.ceil(r/2)%2),n=[{participantsCount:r,preFeedRound:i}];for(;r>2;){let e=Math.ceil(r/2),t=1===e,i=!(t||!(e%2));r=!t&&i?e+1:e;let a=!!(2!==r&&Math.ceil(r/2)%2);n.push({participantsCount:r,preFeedRound:a,feedRound:i})}return n}(o),l=u.shift(),d=Ri(1,(l?.participantsCount||0)+1).map(e=>({drawPosition:e})),p=[],m=1;({matchUps:p}=sw({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:c})),m++;let f=e.roundLimit||t;for(let g of u){let e=g.participantsCount/2,t=Ri(1,e+1);i&&e===i&&(f=m-1);let r=t.map(e=>{let t=ow({roundPosition:e,roundNumber:m,idPrefix:a,uuids:c});return{roundPosition:e,roundNumber:m,matchUpId:t}});p.push(...r),m++}let h=m-1;return p=jy({finishingPositionOffset:r,lucky:!0,roundsCount:h,roundLimit:f,matchUps:p}),f&&(p=p.filter(e=>e.roundNumber<=f)),{matchUps:p,roundsCount:h,roundLimit:f}}function RD(e){let{playoffAttributes:t,stageSequence:r=1,stage:i=El,tieFormat:n,matchUpType:a,drawSize:o,uuids:s}=e,c=e.structureId||(e.isMock||e.idPrefix?`${e.drawDefinition.drawId}-s-0`:void 0)||s?.pop(),u=e.appliedPolicies??zh(e),l=e.policyDefinitions?.[Yp]||u?.[Yp];e.skipRounds=e.skipRounds||o<=4&&(l?.feedFromMainFinal?0:1)||0;let d=e.structureName??t?.[0]?.name??eb(El);return{generators:{[Zl]:()=>({structures:[JS({finishingPosition:Dd,stageSequence:r,structureName:d,matchUps:[],matchUpType:a,structureId:c,stage:i})],links:[],...Gi}),[sd]:()=>{let{matchUps:t}=MD(e);return{structures:[JS({stageSequence:r,structureName:d,matchUpType:a,structureId:c,matchUps:t,stage:i})],links:[],...Gi}},[id]:()=>(()=>{let{matchUps:t}=cw(e);return{structures:[JS({stageSequence:r,structureName:d,matchUpType:a,structureId:c,tieFormat:n,matchUps:t,stage:i})],links:[],...Gi}})(),[nd]:()=>ED(e),[td]:()=>fw({...e,roundOffsetLimit:3,playoffAttributes:t??wd}),[rd]:()=>fw({...e,roundOffsetLimit:2,playoffAttributes:t??Td}),[Cl]:()=>fw(e),[ed]:()=>{let{matchUps:e}=mw({drawSize:o,uuids:s,matchUpType:a});return{structures:[JS({stageSequence:r,structureName:d,matchUpType:a,structureId:c,stage:El,tieFormat:n,matchUps:e})],links:[],...Gi}},[od]:()=>ww(e),[ad]:()=>Pw({...e,feedRounds:1,fmlc:!0}),[gd]:()=>Pw({...e,feedRounds:1}),[ld]:()=>Pw({...e,feedsFromFinal:1}),[pd]:()=>Pw({...e,feedsFromFinal:2}),[fd]:()=>Pw({...e,feedsFromFinal:3}),[yd]:()=>Pw(e),[cd]:()=>Dw(e),[vd]:()=>sb(e),[Sd]:()=>function(e){let{drawDefinition:t,structureOptions:r,requireSequential:i}=e,n={structureName:eb(El),...e,stage:El},{structures:a,groupCount:o}=sb(n);if(o<1)return{error:Yo};let s=r?.playoffGroups||[{finishingPositions:[1],structureName:eb(Cl)}],[c]=a,{structures:u,links:l}=Nw({sourceStructureId:c.structureId,requireSequential:i,drawDefinition:t,playoffGroups:s,groupCount:o,...e});return u&&a.push(...u),{...Gi,structures:a,links:l}}(e)}}}function AD(e){let{enforceMinimumDrawSize:t=!0,overwriteExisting:r,appliedPolicies:i,qualifyingOnly:n,staggeredEntry:a,drawDefinition:o,tieFormat:s,isMock:c,uuids:u}=e||{},l=Jr(e.drawSize),d=e.drawTypeCoercion??vD({appliedPolicies:i,drawType:e.drawType}),p=ND({drawType:e.drawType,enforceMinimumDrawSize:t,drawTypeCoercion:d,drawSize:l});if(p.error)return p;let m=p.drawType,f=[],h=[],g=e?.matchUpType??Wr,I=o?.structures?.filter(({stage:e})=>e===Ml);I&&f.push(...I);let y=I?.map(({structureId:e})=>e),v=o?.structures?.find(({stage:e,stageSequence:t})=>e===El&&1===t),S=o?.links?.filter(e=>e.target.structureId===v?.structureId&&y?.includes(e.source.structureId)),b=(e,t)=>{if(e.linkType===Kl&&t?.structures){let r=e.source.finishingPositions||[];return t.structures.length*r.length}if(e.linkType===Xl&&t?.matchUps?.length){let r=e.source.roundNumber;return t.matchUps.filter(({roundNumber:e})=>e===r).length}},U=I?.map(e=>{let t=S?.find(t=>t.target.structureId===e.structureId),r=Pf({structure:e})?.positionAssignments?.length??0;if(!t)return r;let i=t?.source.structureId,n=o.structures?.find(e=>e.structureId===i);return r-(b(t,n)||0)}).filter(Boolean).reduce((e,t)=>e+t,0),w=S?.map(e=>{let t=e.source.structureId,r=I?.find(e=>e.structureId===t);return b(e,r)}).filter(Boolean).reduce((e,t)=>e+t,0),T=!(!v||v?.matchUps?.length);if(I?.length&&!T)return{error:ds};let D=!I?.length&&e.qualifyingProfiles,P=D?.length&&DD({idPrefix:e.idPrefix,qualifyingProfiles:D,appliedPolicies:i,qualifyingOnly:n,tieFormat:s,isMock:c,uuids:u});if(P?.error)return P;let{qualifyingDrawPositionsCount:N,qualifyingDetails:E,qualifiersCount:M}=P||{qualifyingDrawPositionsCount:U,qualifiersCount:w};N&&(P?.structures&&f.push(...P.structures),P?.links&&h.push(...P.links)),Object.assign(e,nc({drawSize:l,matchUpType:g,tieFormat:s}));let R=m!==Zl&&(!l||l<2||!a&&![ed,sd].includes(m)&&([Sd,vd].includes(m)&&l<3||![vd,Sd].includes(m)&&!ci(l)));if(R&&!N)return ac({context:{drawSize:l,invalidDrawSize:R},result:{error:Sn},stack:"generateDrawStructuresAndLinks"});let{generators:A,error:C}=RD(e);if(C)return{error:C};let k=A[m];if(!k)return{error:mn};let x=k?.();if(x.error)return x;let{structures:O,links:F}=x;if(O?.length){let e=O.find(({stage:e,stageSequence:t})=>e===El&&1===t);if(v&&e)if(T){let t=e.structureId;if(e.structureId=v.structureId,F?.length)for(let e of F)e.source.structureId===t&&(e.source.structureId=v.structureId),e.target.structureId===t&&(e.target.structureId=v.structureId)}else if(!r)return{error:ds};f.push(...O)}f.sort(bf),F?.length&&h.push(...F);let _=x.structures.find(({stage:e,stageSequence:t})=>e===El&&1===t);for(let L of E||[]){let{finalQualifyingRoundNumber:e,finalQualifyingStructureId:t,roundTarget:r,finishingPositions:i,linkType:n}=L,a=_&&iw({targetStructureId:_.structureId,sourceStructureId:t,sourceRoundNumber:e,finishingPositions:i,targetEntryRound:r,linkType:n})?.link;if(a?.error)return a;a&&h.push(a)}return S&&h.push(...S),{...Gi,qualifyingResult:{qualifyingDrawPositionsCount:N,qualifiersCount:M},structures:f,links:h}}function CD(e){let{modifyOriginal:t=!0,stageSequence:r=1,isMock:i}=e||{},n="generateDrawTypeAndModifyDrawDefinition";if(!e.drawDefinition)return ac({result:{error:rn},stack:n});let a=t?e.drawDefinition:Nu(e.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=e;if(o){let e=bu({tieFormat:o});if(e.error)return e}o=Vw(o??Cg({drawDefinition:a})?.tieFormat),s=s??(a.matchUpType||Wr),e.tieFormat=o,e.matchUpType=s;let c=bS({drawDefinition:a,stage:El});e.drawSize=e.drawSize??c,!c&&e.drawSize&&kU({drawSize:e.drawSize,drawDefinition:a,stageSequence:r,stage:El});let u=kg({drawDefinition:a}).drawMatchUps.map(zm),l=AD(e);if(l.error)return ac({result:l,stack:n});let{structures:d,links:p,qualifyingResult:m}=l;a.structures=d,a.links=p;let f=Math.max(e.qualifiersCount??0,m?.qualifiersCount||0);if(m?.qualifyingDrawPositionsCount&&!bS({stage:Ml,drawDefinition:a})){let e=kU({drawSize:m.qualifyingDrawPositionsCount,stage:Ml,drawDefinition:a});if(e.error)return e}if(f){let e=xU({qualifiersCount:f,drawDefinition:a,stage:El});if(e.error)return e}let h=e.drawSize??c;Object.assign(e,nc({drawSize:h,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:I}=Cy({drawDefinition:a});o&&g?.forEach(e=>{if(!u.includes(e.matchUpId)){let{tieMatchUps:t}=nw({tieFormat:o,matchUp:e,isMock:i});Object.assign(e,{tieMatchUps:t,matchUpType:s})}});let{inContextDrawMatchUps:y}=Gy({drawDefinition:a,matchUpsMap:I});return lh({tournamentId:e.tournamentRecord?.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:I,...Gi,structures:d,matchUps:g,links:p}}function kD(e){let t,r,{removePriorValues:i,tournamentRecord:n,participantId:a,scaleItem:o}=e;if(!OD({scaleItem:o}))return{error:Go};if(a&&Array.isArray(n.participants)&&(r=n.participants.find(e=>e.participantId===a),r)){if(r.participantType===Uh&&o?.eventType!==Pl)return{error:Go};let e=FD({removePriorValues:i,participant:r,scaleItem:o});if(e.error)return e;t=!e.valueChanged;let{topics:a}=Ws();a.includes(Wf)&&Bs({topic:Wf,payload:{tournamentId:n.tournamentId,participants:[r]}})}return t&&{...Gi,info:ns,existingValue:o?.scaleValue}||r&&{...Gi,newValue:o?.scaleValue}||{error:to}}function xD(e){let{scaleItemsWithParticipantIds:t=[],removePriorValues:r,tournamentRecord:i,auditData:n,context:a}=e;if(!i)return{error:Ji};if(!i.participants)return{error:Ja};let o=0,s={},c=[];for(let d of t){let e=d?.participantId;if(Array.isArray(d?.scaleItems))for(let t of d.scaleItems){if(!OD({scaleItem:t}))return{error:Go};Array.isArray(s[e])||(s[e]=[]),s[e].push(t)}}for(let d of i.participants){let{participantId:e}=d||{};if(Array.isArray(s[e]))for(let t of s[e]){if(d.participantType===Uh&&t?.eventType!==Pl)return ac({context:{participantId:e,scaleItem:t,participantType:d.participantType},info:"Invalid participantType for eventType",result:{error:Go}});FD({participant:d,scaleItem:t,removePriorValues:r}),c.push(d),o++}}let u=o?void 0:qo,{topics:l}=Ws();if(l.includes(Wf)&&o&&Bs({topic:Wf,payload:{tournamentId:i.tournamentId,participants:c}}),a){let{eventId:e,drawId:t,...r}=a,n=r.scaleAttributes?.scaleType&&[r.scaleAttributes.scaleType];if(Object.keys(r).length){let a={itemType:Af,itemValue:r};if(n&&(a.itemSubTypes=n),t||e){let{drawDefinition:r,event:n}=my({tournamentRecord:i,eventId:e,drawId:t});t&&EU({drawDefinition:r,timeItem:a}),e&&Qw({event:n,timeItem:a})}else Xw({tournamentRecord:i,timeItem:a})}}return n&&l.includes(xf)&&Bs({topic:xf,payload:n}),nc({...Gi,modificationsApplied:o,info:u})}function OD({scaleItem:e}){let t=e&&Object.keys(e),r=["scaleType","eventType","scaleName"];return r.filter(e=>t?.includes(e)).length===r.length}function FD({removePriorValues:e,participant:t,scaleItem:r}){if(!t)return{error:Qa};let i=r&&Object.keys(r),n=["scaleType","eventType","scaleName"];if(n.filter(e=>i.includes(e)&&r[e]).length!==n.length)return{error:Go};let a=(new Date).toISOString();t.timeItems||(t.timeItems=[]);let{scaleItem:o}=Jv({scaleAttributes:r,participant:t}),s=e=>[void 0,null,""].includes(e),c=!(s(o?.scaleValue)&&s(r.scaleValue))&&JSON.stringify(o?.scaleValue)!==JSON.stringify(r.scaleValue);if(c){let{scaleType:i,eventType:n,scaleName:o}=r,s=[Rp,i,n,o].join("."),c=nc({itemValue:r.scaleValue,itemDate:r.scaleDate,createdAt:a,itemType:s});r.scaleId&&(c.itemSubTypes=[r.scaleId]),e&&(t.timeItems=t.timeItems.filter(e=>e.itemType!==s)),t.timeItems.push(c)}return{...Gi,valueChanged:c,newValue:r.scaleValue}}function _D(e){let{tournamentRecord:t,modifiedScaleValues:r,removePriorValues:i}=e,n=Dp(e,[{[Cd]:!0},{modifiedScaleValues:!0,[vp]:fp}]);if(n.error)return n;for(let a in r){let e=kD({scaleItem:r[a],removePriorValues:i,tournamentRecord:t,participantId:a});if(e.error)return e}return{...Gi}}var LD={nSpread:400,diffThreshold:.125,kCalc:(e=0)=>250/Math.pow(e+5,.4),kMultiplier:function(e=3,t=2){let r=e/t;return Number.isNaN(r)?LD.kDefault():r},kDefault:()=>1};function BD(e){let{winnerRating:t,loserRating:r}=e,{ratings:i=Nv,winnerCountables:n=1,loserCountables:a=0,ratingType:o="ELO",maxCountables:s,countables:c}=e||{},u=i?.[o];if(!u)return{error:Da};let l=u.range||e.ratingRange;t=t||u.defaultInitialization,r=r||u.defaultInitialization;let d=l[0]>l[1],p=u.decimalsCount||0,m=d?l.slice().reverse():l,f=(e,t)=>Number.parseFloat(t)>=Math.min(...e)&&Number.parseFloat(t)<=Math.max(...e);(!f(l,t)||!f(l,r))&&(f(l,t)||(t=u.defaultInitialization),f(l,r)||(r=u.defaultInitialization));let h=gv({targetRange:Nv.ELO.range,sourceRange:m,value:d?l[0]-t:t}),g=gv({targetRange:Nv.ELO.range,sourceRange:m,value:d?l[0]-r:r}),I=(e,t)=>1/(1+Math.pow(10,(t-e)/LD.nSpread)),y=I(h,g),v=I(g,h),S=LD.kCalc(n),b=LD.kCalc(a),U=LD.kMultiplier(s,c),w=h+U*S*(1-y),T=g+U*b*(0-v),D=gv({sourceRange:Nv.ELO.range,value:w,targetRange:m}),P=gv({sourceRange:Nv.ELO.range,value:T,targetRange:m}),N=d?l[0]-D:D,E=Number.parseFloat(N.toFixed(p)),M=d?l[0]-P:P,R=Number.parseFloat(M.toFixed(p)),A=Math.max(...l)?Math.abs(t-r)/Math.max(...l):0;return(D>P&&A>LD.diffThreshold||E<0||R<0)&&(E=t,R=r),{newWinnerRating:E,newLoserRating:R}}var $D=e=>e?.reduce((e,t)=>(t.winningSide&&(e[t.winningSide-1]+=1),e),[0,0])||[0,0];function VD(e){let t=Dp(e,[{[Cd]:!0},{matchUpIds:!0,[vp]:hp,[sp]:la},{ratingType:!1,[gp]:e=>Nv[e]}]);if(t.error)return t;let{updateParticipantRatings:r,removePriorValues:i=!0,tournamentRecord:n,ratingType:a="ELO",refreshDynamic:o,considerGames:s,drawDefinition:c,matchUpIds:u,asDynamic:l}=e,d=Nv[a],{accessor:p}=d,m={},f=(e.matchUps||o&&Ly({drawDefinition:c,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:If}}).matchUps||Oy({matchUpFilters:{matchUpIds:u,matchUpStatuses:If},tournamentRecord:n,inContext:!0}).matchUps)??[],h=`${a}.${Np}`,g=l?h:a;f.sort(_y);for(let y of f){let{endDate:e,matchUpFormat:t,score:c,sides:u,winningSide:l}=y,d=y.matchUpType,f={eventType:d,scaleName:a,scaleType:Mp},I={scaleName:h,eventType:d,scaleType:Mp},v=Object.assign({},...(u??[]).map(e=>{let{sideNumber:t,participant:r}=e;return t&&{[t]:[r?.participantId,...r?.individualParticipantIds??[]].filter(Boolean).flat()}})),S=Object.assign({},...Object.values(v).flat().map(t=>{let r=!o||m[t]?fS({scaleAttributes:I,tournamentRecord:n,participantId:t}).scaleItem:void 0,i=fS({tournamentRecord:n,scaleAttributes:f,participantId:t}).scaleItem,a=p?{[p]:void 0}:void 0;return t&&{[t]:r??i??{scaleName:g,eventType:d,scaleDate:e,scaleType:Mp,scaleValue:a}}})),b=t?Mc(t):{},U=b?.bestOf||1,w=s?U&(b?.setsTo||1):U,T=c?.sets&&$D(c.sets)||1===l&&[1,0]||[0,1],D=l?v[l]:[],P=l?v[3-l]:[];for(let r of D){let e=S[r]?.scaleValue,t="object"==typeof e?e[p]:e;for(let i of P){let n=S[i]?.scaleValue,o="object"==typeof n?n[p]:n,s=l?T[l]:[0,0],c=l?T[3-l]:[0,0],{newWinnerRating:u,newLoserRating:d}=BD({winnerCountables:s,loserCountables:c,maxCountables:w,winnerRating:t,loserRating:o,ratingType:a}),m=p?{...e,[p]:u}:u,f=p?{...n,[p]:d}:d;S[r].scaleValue=m,S[i].scaleValue=f,S[r].scaleName=g,S[i].scaleName=g}}Object.assign(m,S),r&&_D({tournamentRecord:n,modifiedScaleValues:m,removePriorValues:i})}let I=f.map(({matchUpId:e})=>e);return{...Gi,modifiedScaleValues:m,outputScaleName:g,processedMatchUpIds:I}}function jD(e){let{matchUpIds:t=[],drawDefinition:r,roundNumber:i,newRound:n,isMock:a,event:o}=e;if("object"!=typeof r)return{error:rn};let{participantIdPairings:s,matchUpsCount:c}=e,u=yT(e);if(u.error)return ac({result:u});let{lastRoundNumber:l,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=u;if(c){if(c>p&&!1!==e.restrictMatchUpsCount)return ac({result:{error:Zo,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}})}else n?c=p:d>0&&(c=d);if(s&&!Array.isArray(s)||c&&!gi(c)||t&&!Array.isArray(t)||!s&&!c)return{error:Zo,info:"matchUpsCount or pairings error"};if(c&&!1!==e.restrictMatchUpsCount&&c>32)return{error:Zo,info:"matchUpsCount must be less than 33"};if(i&&!e.ignoreLastRoundNumber&&i-1>(l||0))return{error:Zo,info:"roundNumber error"};let m=i??(n&&(l??0)+1||l||1);s=s??Ri(0,c).map(()=>({participantIds:[void 0,void 0]}));let f=s?.map((i,n)=>{let a=i?.participantIds??[void 0,void 0];a.push(void 0,void 0);let o=a.slice(0,2).map((e,t)=>nc({sideNumber:t+1,participantId:e})),s=t[n]??(t=>{if(!e.idPrefix)return;return`${r.drawId}-${e.idPrefix??"ah"}-${m}-${t}`})(n)??Ru();return{roundNumber:m,matchUpStatus:lf,matchUpId:s,sides:o}});if(f?.length){let e=Cg({drawDefinition:r,event:o})?.tieFormat;e&&f.forEach(t=>{let{tieMatchUps:r}=nw({tieFormat:e,matchUp:t,isMock:a});Object.assign(t,{tieMatchUps:r,matchUpType:Yr})})}return{roundNumber:m,matchUpsCount:f?.length??0,matchUps:f,...Gi}}function GD(e){return e.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function WD({valueSortedPairings:e,stipulated:t=[],pairingValueMap:r,deltaObjects:i,valueObjects:n,actorsCount:a}){let o=t.flat(),s=[],c=0;t.filter(Boolean).forEach(e=>{let[t,i]=e,n=qD(t,i),a=r[n];s.push({participantIds:e,value:a}),c+=r[n]}),_i(e,a).flatMap(e=>bi(e).map(e=>({...e,value:e.value+Math.random()*Math.round(Math.random())}))).forEach(e=>{let t=e.pairing.split("|");if(!t.reduce((e,t)=>o.includes(t)||e,!1)){o.push(...t);let r=e.value;c+=r,s.push({participantIds:t,value:r})}}),s.sort((e,t)=>e.value-t.value);let u=s.reduce((e,t)=>{let[r,n]=t.participantIds,a=qD(r,n),o=i[a];return Math.max(o,e)},0),l=s.reduce((e,t)=>{let[r,i]=t.participantIds,a=qD(r,i),o=n[a];return Math.max(o,e)},0);return{value:c,participantIdPairings:s,maxDelta:u,maxDiff:l}}function qD(e,t){return[e,t].sort(lS).join("|")}function HD({participantIds:e}){let t={},r=[];e.forEach(i=>{t[i]=e.filter(e=>e!==i),t[i].forEach(e=>{let t=qD(e,i);r.includes(t)||r.push(t)})});let i=Object.assign({},...r.map(e=>({[e]:0})));return{uniquePairings:r,possiblePairings:t,deltaObjects:i}}function zD(e){let{tournamentParticipants:t,adHocRatings:r={},possiblePairings:i,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:c,eventType:u,scaleName:l,salted:d}=e;n.forEach(e=>{let i=function({tournamentParticipants:e,adHocRatings:t,eventType:r,scaleName:i,pairing:n}){let a=Nv[i]?.defaultInitialization??0;return n.split("|").map(i=>{if(r===wl){let r=e?.find(e=>e.participantId===i)?.individualParticipantIds;return r?r?.map(e=>t[e]||a):2*a}return t[i]||a})}({tournamentParticipants:t,adHocRatings:r,scaleName:l,eventType:u,pairing:e}),n="number"==typeof d&&d||.5,a=d&&(Math.round(Math.random())?n:-1*n)||0,o=Math.abs(i[0]-i[1])+a,p=Math.abs(i[0]-i[1]);s[e]=p,c[e]||(c[e]=0),c[e]+=o?Math.pow(o,2):0});let p=n.map(e=>({pairing:e,value:c[e]})).sort((e,t)=>e.value-t.value),{pairingValues:m}=function({possiblePairings:e,valueObjects:t}){let r={};for(let n of Object.keys(e)){let t=e[n].map(e=>i(n,e));r[n]=t.sort((e,t)=>e.value-t.value)}function i(e,r){let i=qD(e,r);return{opponent:r,value:t[i]}}return{pairingValues:r}}({possiblePairings:i,valueObjects:c}),{candidate:f,candidatesCount:h,deltaCandidate:g,iterations:I}=function({maxIterations:e=4e3,valueSortedPairings:t,pairingValues:r,valueObjects:i,deltaObjects:n}){let a=Object.assign({},...t.map(e=>({[e.pairing]:e.value}))),o=Object.keys(r),s=[],c=WD({actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:n,valueObjects:i}),u=[GD(c)];s.push(c);let l,d=c.value,p=c,m=1,f=0,h=o.length;do{h-=1,l=o.length*r[o[0]].length}while(l>e&&h>5);let g=[];o.forEach(e=>{r[e].slice(0,h).forEach(r=>{f+=1;let c=qD(e,r.opponent);if(!g.includes(c)){let l=WD({stipulated:[[e,r.opponent]],actorsCount:o.length,valueSortedPairings:t,pairingValueMap:a,deltaObjects:n,valueObjects:i});if(!u.includes(GD(l))){u.push(GD(l)),s.push(l);let{maxDelta:e,value:t}=l;e<p.maxDelta&&(p=l),(t<d||t===d&&Math.round(Math.random()))&&(d=t),g.push(c),m+=1}}}),s=s.filter(e=>Math.abs(e.value-d)<5)}),s.sort((e,t)=>e.maxDiff-t.maxDiff);let I=Ei(s);return{candidatesCount:m,deltaCandidate:p,maxIterations:e,iterations:f,candidate:I}}({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:c}),{participantIdPairings:y}=o?g:f;return{participantIdPairings:y,candidatesCount:h,deltaCandidate:g,iterations:I,candidate:f}}var YD=100,KD=100,XD=4e3;function QD(e){let{encounterValue:t=YD,sameTeamValue:r=KD,maxIterations:i=XD,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:o,iterationMatchUps:s,tournamentRecord:c,dynamicRatings:u,refreshDynamic:l,participantIds:d,drawDefinition:p,roundNumber:m,structureId:f,matchUpIds:h,eventType:g,scaleName:I,idPrefix:y,isMock:v,salted:S,event:b}=e;if(!p)return{error:rn};if(!e.structure&&!f)return{error:Fn};let U=e.structure||wf({drawDefinition:p,structureId:f}).structure;if(!ti(U))return{error:Ln};if(!d?.length)return{error:no};let w=[...s??[],...U?.matchUps??[]],{encounters:T}=function({matchUps:e}){let t=[];for(let r of e){let e=r.sides.map(Hm);if(2===e.length){let[r,i]=e,n=qD(r,i);t.includes(n)||t.push(n)}}return{encounters:t}}({matchUps:w}),D=c?.participants??[],P={};if(u){let e=vi(U?.matchUps?U.matchUps.map(({roundNumber:e})=>e):[]),t=Math.max(...e,0);if(t){let e=U?.matchUps?.filter(({roundNumber:e})=>e===t).map(({matchUpId:e})=>e),r=VD({ratingType:I??b?.category?.ratingType,updateParticipantRatings:n,tournamentRecord:c,asDynamic:!0,refreshDynamic:l,drawDefinition:p,matchUpIds:e});if(r.error)return r;r.modifiedScaleValues&&(P=r.modifiedScaleValues)}}let N,E,{valueObjects:M}=function({encounters:e,tournamentParticipants:t,encounterValue:r,sameTeamValue:i}){let n={};for(let o of e)n[o]||(n[o]=0),n[o]+=r;let a=t?.filter(({participantType:e})=>e===Ph);if(a)for(let o of a){let e=o.individualParticipantIds??[],{uniquePairings:t}=HD({participantIds:e});for(let r of t)n[r]||(n[r]=0),n[r]+=i}return{valueObjects:n}}({tournamentParticipants:D,encounterValue:t,sameTeamValue:r,encounters:T}),{uniquePairings:R,possiblePairings:A,deltaObjects:C}=HD({participantIds:d}),k={tournamentParticipants:D,possiblePairings:A,uniquePairings:R,maxIterations:i,adHocRatings:Object.values(P).length?P:e.adHocRatings,deltaObjects:C,valueObjects:M,eventType:g,scaleName:I,salted:S},{candidatesCount:x,participantIdPairings:O,deltaCandidate:F,iterations:_,candidate:L}=zD(k);if(!x)return{error:zo};if(a){let e=jD({structureId:U?.structureId,ignoreLastRoundNumber:o,participantIdPairings:O,newRound:!0,drawDefinition:p,roundNumber:m,matchUpIds:h,idPrefix:y,isMock:v,event:b});if(e.error)return e;N=e.roundNumber,E=e.matchUps}let{maxDelta:B,maxDiff:$}=L;return{roundNumber:N,participantIdPairings:O,modifiedScaleValues:P,candidatesCount:x,deltaCandidate:F,...Gi,iterations:_,matchUps:E,maxDelta:B,maxDiff:$}}function JD(e){let{drawType:t=id,attachConsolation:r=!0,applyPositioning:i=!0,tournamentRecord:n,staggeredEntry:a,automated:o,placeByes:s,isMock:c,event:u}=e,l=e?.drawDefinition;if(!l)return{error:rn};let d=Al,p=Eg({stageSequence:1,drawDefinition:l,stage:d}),m=[vd,nd,Sd].includes(t)?p.length:fi(p.length);if(!a&&t===ed&&p.length<2||t===vd&&p.length<3)return{error:Sn};let{tieFormat:f,matchUpType:h}=e;if(f){let e=bu({tieFormat:f});if(e.error)return e}f=Vw(f??Cg({drawDefinition:l})?.tieFormat),h=h??l.matchUpType;let{structures:g}=Tf({stageSequence:1,drawDefinition:l,stage:d});if(g.length>1)return{error:Xn};if(g?.[0]?.matchUps?.length)return{error:ps};let I=g?.[0]?.structureId;Object.assign(e,nc({structureName:e.structureName??eb(Al),structureId:I,matchUpType:h,tieFormat:f,drawSize:m,stage:d}));let y=RD(e);if(y.error)return y;let v=y.generators[t];if(!v)return{error:mn};let S=v?.();if(S.error)return S;let{structures:b,links:U}=S,w=b.flatMap(e=>Uy({structure:e}).matchUps);f&&w.forEach(e=>{let{tieMatchUps:t}=nw({matchUp:e,tieFormat:f,isMock:c});Object.assign(e,{tieMatchUps:t,matchUpType:h})}),(!i||!r)&&(l=Nu(l,!1,!0)),l.links??=[],U.length&&l.links.push(...U);let T=new Set(b.map(({structureId:e})=>e));l.structures??=[];let D=new Set(l.structures.map(({structureId:e})=>e));l.structures=l.structures.map(e=>T.has(e.structureId)?b.find(({structureId:t})=>t===e.structureId):e);let P=b.filter(({structureId:e})=>!D.has(e));return P.length&&l.structures.push(...P),o&&IU({seedingProfile:e.seedingProfile,applyPositioning:i,tournamentRecord:n,drawDefinition:l,structureId:I,placeByes:s,drawSize:m,event:u}),r&&lh({drawDefinition:l}),{links:U,structures:b,...Gi}}var ZD={};Br(ZD,{ScoringEngine:()=>GP,addPoint:()=>yP,analyzeScore:()=>aE,analyzeSequence:()=>RE,analyzeSet:()=>dE,calculateMatchStatistics:()=>FP,calculatePointsTo:()=>uP,checkScoreHasValue:()=>qy,checkSetIsComplete:()=>TN,createMatchUp:()=>nP,deduceMatchUpFormat:()=>mE,enrichPointHistory:()=>_P,exportMatchUpJSON:()=>$E,generate:()=>eP,generateScoreString:()=>tP,generateTieMatchUpScore:()=>Bw,getEpisodes:()=>EP,getQuickStats:()=>LP,getScore:()=>TP,getScoreboard:()=>DP,getSetComplement:()=>sE,getSetScoreString:()=>hE,getTiebreakComplement:()=>cE,getWinner:()=>PP,groupByMatch:()=>FE,helpers:()=>qP,inferServeSide:()=>gP,isComplete:()=>NP,isValidMatchUpFormat:()=>_c,keyValueScore:()=>MN,mcpValidator:()=>BE,mutate:()=>WP,parseCSV:()=>OE,parseMCPPoint:()=>xE,parseMatchUpFormat:()=>Mc,parseScoreString:()=>lE,pbpValidator:()=>IE,pointParser:()=>AE,query:()=>ZN,resolvePointValue:()=>IP,reverseScore:()=>iP,shotParser:()=>CE,shotSplitter:()=>NE,stringifyMatchUpFormat:()=>Tc,tidyScore:()=>JN,toStatObjects:()=>jP,validateMCPMatch:()=>_E,validateMatchUp:()=>fE,validateMatchUpScore:()=>rE,validateScore:()=>oE,validateSet:()=>gE,validateSetScore:()=>tE,validateTieFormat:()=>bu});var eP={};function tP(e){let{winnerFirst:t=!0,setTBlast:r=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:a,matchUpFormat:o,autoComplete:s,winningSide:c,sets:u}=e;if(!u)return{error:Da,info:"missing sets"};let l=o&&Mc(o),{bestOf:d,finalSetFormat:p,setFormat:m}=l??{},f=n||!(!t||!c||1===c),h=i?function({matchUpStatus:e}){let t={[cf]:"RET",[df]:"WO",[rf]:"DF/DF",[nf]:"WO/WO",[uf]:"SUS",[Xm]:"ABN",[tf]:"DEF",[ef]:"DR"};return e&&t[e]||""}({matchUpStatus:a}):"",g=u?.sort(rP).map(function(e){let t=d&&e.setNumber===d&&p?p:m,i=e=>pi(e?.side1Score)||pi(e?.side2Score),n=(I=e,pi(I?.side1TiebreakScore)||pi(I?.side2TiebreakScore)),a=t?.tiebreakSet||!i(e)&&n,{side1Score:o,side2Score:c,side1TiebreakScore:u,side2TiebreakScore:l}=e,h=u||(pi(u)||n&&s?0:""),g=l||(pi(l)||n&&s?0:"");var I;if(a){let t=i(e)&&!n,r=t?o:h,a=t?c:g;return`[${(f?[a,r]:[r,a]).join("-")}]`}let y=n?Math.min(h,g):"",v=y===h?1:2,S=pi(y)?`(${y})`:"",b=o||(pi(o)||s?0:""),U=c||(pi(c)||s?0:""),w=e=>r||v!==e?"":S,T=`${b}${w(1)}`,D=`${U}${w(2)}`,P=r&&n?`(${y})`:"",N=f?`${[D,T].join("-")}${P}`:`${[T,D].join("-")}${P}`;return["-"," "].includes(N)&&(N=""),N}).filter(Boolean).join(" ")||"";return h?2===c?`${h} ${g}`:`${g} ${h}`:g}function rP(e,t){return e.setNumber-t.setNumber}function iP(e){if(!e?.score)return{error:Da};let{sets:t}=e.score,r=t.map(e=>{let{side1TiebreakScore:t,side2TiebreakScore:r,winningSide:i,side1Score:n,side2Score:a,setNumber:o}=e;return nc({winningSide:i?3-i:void 0,side1TiebreakScore:r,side2TiebreakScore:t,side1Score:a,side2Score:n,setNumber:o})}),i=e?.setTBlast;return{reversedScore:{sets:r,scoreStringSide1:tP({setTBlast:i,sets:r}),scoreStringSide2:tP({sets:r,reversed:!0,setTBlast:i})},...Gi}}function nP(e){let{matchUpId:t=Ru(),matchUpFormat:r,participants:i=[],isDoubles:n=!1,matchUpType:a}=e,o=a||(n?"DOUBLES":"SINGLES"),s=i.map((e,t)=>({sideNumber:t+1,participantId:e.participantId,participant:e}));return 0===s.length&&s.push({sideNumber:1},{sideNumber:2}),{matchUpId:t,matchUpFormat:r,matchUpStatus:"TO_BE_PLAYED",matchUpType:o,sides:s,score:{sets:[]},createdAt:(new Date).toISOString()}}Br(eP,{ScoringEngine:()=>GP,generateScoreString:()=>tP,generateTieMatchUpScore:()=>Bw,reverseScore:()=>iP});var aP={"3_6a_7":"SET3-S:6/TB7","3_6n_7":"SET3-S:6NOAD/TB7","3_4n_10":"SET3-S:4NOAD/TB7-F:TB10","1_4n_7":"SET1-S:4NOAD/TB7@3","3_6n_10":"SET3-S:6NOAD/TB7-F:TB10","5_6a_7":"SET5-S:6/TB7","5_6a_7_long":"SET5-S:6/TB7-F:6","3_6a_7_long":"SET3-S:6/TB7-F:6","1_8a_7":"SET1-S:8/TB7"};function oP(e){let t=Mc(e);if(t)return t.setFormat&&!t.setFormat.gameFormat&&(t.setFormat.gameFormat=t.setFormat.NoAD?{NoAD:!0}:{}),t.finalSetFormat&&!t.finalSetFormat.tiebreakSet&&!t.finalSetFormat.gameFormat&&(t.finalSetFormat.gameFormat=t.finalSetFormat.NoAD?{NoAD:!0}:{}),{format:t,type:"factory",code:e,isValid:!0};let r=function(e){return aP[e]}(e);if(r){let t=Mc(r);if(t)return t.setFormat&&!t.setFormat.gameFormat&&(t.setFormat.gameFormat=t.setFormat.NoAD?{NoAD:!0}:{}),t.finalSetFormat&&!t.finalSetFormat.tiebreakSet&&!t.finalSetFormat.gameFormat&&(t.finalSetFormat.gameFormat=t.finalSetFormat.NoAD?{NoAD:!0}:{}),{format:t,type:"legacy",code:e,factoryCode:r,isValid:!0}}return{format:void 0,type:"unknown",code:e,isValid:!1}}function sP(e){return!!e&&!!e.aggregate}function cP(e,t){let r=e.bestOf||e.exactly||3,i=Math.ceil(r/2);if(t[0]===i-1&&t[1]===i-1&&e.finalSetFormat){let t=e.finalSetFormat;return t.tiebreakSet?"matchTiebreak":t.timed?"timed":"standard"}let n=e.setFormat;return n?n.tiebreakSet?"tiebreakOnly":n.timed?"timed":"standard":"standard"}function uP(e,t,r,i,n){if("timed"===r||!i)return;let a=function(e){let t=e.score.sets;if(0===t.length)return;let r=t.at(-1);return void 0===r?.winningSide?r:void 0}(e),o=function(e){let t=[0,0];return e.score.sets.forEach(e=>{1===e.winningSide&&t[0]++,2===e.winningSide&&t[1]++}),t}(e),s=t.exactly||t.bestOf||3,c=Math.ceil(s/2),{side1Points:u,side2Points:l}=function(e){if(!e)return{side1Points:0,side2Points:0};let t=e.side1GameScores||[],r=e.side2GameScores||[];if(0===t.length&&0===r.length)return{side1Points:0,side2Points:0};let i=Math.max(t.length,r.length)-1;return{side1Points:t[i]??0,side2Points:r[i]??0}}(a),d=function(e,t,r,i,n,a){if("tiebreakOnly"===i){return dP(e,t,r.tiebreakSet?.tiebreakTo||11,r.tiebreakSet?.NoAD||!1)}if("matchTiebreak"===i){return dP(e,t,n.finalSetFormat?.tiebreakSet?.tiebreakTo||10,n.finalSetFormat?.tiebreakSet?.NoAD||!1)}if(a){let i=a.side1Score||0,n=a.side2Score||0,o=r.setTo||6,s=("number"==typeof r.tiebreakAt?r.tiebreakAt:void 0)??o;if(!r.noTiebreak&&i===s&&n===s){return dP(e,t,r.tiebreakFormat?.tiebreakTo||7,r.tiebreakFormat?.NoAD||!1)}}if("CONSECUTIVE"===n.gameFormat?.type){let e=n.gameFormat.count||3;return[e,e]}return function(e,t,r){let i=r.gameFormat?.NoAD||r.NoAD||!1,n=4;return[lP(e,t,n,i),lP(t,e,n,i)]}(e,t,r)}(u,l,i,r,t,a),p=function(e,t,r){if("tiebreakOnly"===r||"matchTiebreak"===r)return e&&e.winningSide,[1,1];let i=e?.side1Score||0,n=e?.side2Score||0,a=t.setTo||6,o=("number"==typeof t.tiebreakAt?t.tiebreakAt:void 0)??a,s=t.noTiebreak||!1,c=t.winBy||2;return[mP(i,n,a,o,s,c),mP(n,i,a,o,s,c)]}(a,i,r),m=function(e,t,r,i){if("tiebreakOnly"===i||"matchTiebreak"===i)return[...e];let n=4;return[fP(e[0],t[0],n),fP(e[1],t[1],n)]}(d,p,0,r),f=function(e,t,r,i){let n=i.setFormat,a=function(e,t){if(!e)return 24;if(e.tiebreakSet)return e.tiebreakSet.tiebreakTo||11;if(e.timed)return 0;let r=e.setTo||6,i="CONSECUTIVE"===t.gameFormat?.type?t.gameFormat?.count||3:4;return r*i}(n,i);return[hP(e[0],t[0],r,a),hP(e[1],t[1],r,a)]}(m,o,c,t),h=function(e,t){if(void 0===t)return!1;let r=1-t;return 1===e[r]}(d,n);return{pointsToGame:d,pointsToSet:m,pointsToMatch:f,gamesToSet:p,isBreakpoint:h}}function lP(e,t,r,i){if(e>=r-1&&t>=r-1){if(i)return e>t?0:e===t?1:2;let r=e-t;return r>=2?0:1===r?1:2}return e>=r?0:r-e}function dP(e,t,r,i){return[pP(e,t,r,i),pP(t,e,r,i)]}function pP(e,t,r,i){if(e>=r&&(e-t>=2||i&&e>t))return 0;if(e>=r-1&&t>=r-1){if(i)return e>t?0:e===t?1:2;let r=e-t;return r>=2?0:1===r?1:2}return e>=r?0:r-e}function mP(e,t,r,i,n,a){if(!n&&e===i&&t===i)return 1;if(e>=r){let r=e-t;return r>=a?0:a-r}let o=r-e;if(t>=r-1&&e>=r-1){if(!n)return Math.max(1,r-e);let i=e-t;return i>=a?0:a-i}return o}function fP(e,t,r){if(t<=0)return 0;return e+Math.max(0,t-1)*r}function hP(e,t,r,i){if(t>=r)return 0;return e+Math.max(0,r-t-1)*i}function gP(e,t,r){if("timed"===r)return;let i=function(e){let t=e.score.sets;if(0===t.length)return;let r=t[t.length-1];return void 0===r.winningSide?r:void 0}(e);return sP(t)?function(e,t){let r=0;for(let i of e.score.sets)void 0!==i.winningSide&&(void 0!==i.side1TiebreakScore?r+=(i.side1TiebreakScore??0)+(i.side2TiebreakScore??0):r+=(i.side1Score??0)+(i.side2Score??0));if(t&&void 0===t.winningSide){let e=t.side1GameScores||[],i=t.side2GameScores||[];if(e.length>0||i.length>0){let t=Math.max(e.length,i.length)-1;r+=(e[t]??0)+(i[t]??0)}else r+=(t.side1Score??0)+(t.side2Score??0)}return r%2==0?"deuce":"ad"}(e,i):"tiebreakOnly"===r||"matchTiebreak"===r?function(e){if(!e)return"deuce";let t=e.side1GameScores||[],r=e.side2GameScores||[];return 0===t.length&&0===r.length||((t[0]??0)+(r[0]??0))%2==0?"deuce":"ad"}(i):function(e,t,r){if(!r)return"deuce";let i=r.side1GameScores||[],n=r.side2GameScores||[];if(0===i.length&&0===n.length)return"deuce";let a=Math.max(i.length,n.length)-1;return((i[a]??0)+(n[a]??0))%2==0?"deuce":"ad"}(0,0,i)}function IP(e,t){if(!t.length)return 1;for(let{condition:r,value:i}of t)if(r.results&&e.result&&r.results.includes(e.result)||r.strokes&&e.stroke&&r.strokes.includes(e.stroke))return i;return 1}function yP(e,t,r){if(!ti(t)||void 0===t.winner||null===t.winner)return e;let i=e,{winner:n,server:a,timestamp:o}=t;i.history??={points:[]};let s=oP(e.matchUpFormat);if(!s.isValid||!s.format)throw new Error(`Invalid matchUpFormat: ${e.matchUpFormat}`);let c=s.format,u=c.exactly||c.bestOf||3,l=Math.ceil(u/2),d=i.history.points.length+1,p=i.history.points.length,m=[0,0];i.score.sets.forEach(e=>{1===e.winningSide&&m[0]++,2===e.winningSide&&m[1]++});let f=cP(c,m),h=m[0]===l-1&&m[1]===l-1,g=h&&c.finalSetFormat?c.finalSetFormat:c.setFormat;void 0===a&&!("RALLY"===g?.tiebreakSet?.modifier||"RALLY"===g?.modifier)&&(a=UP(i,c,f));let I=t.code;!I&&void 0!==n&&void 0!==a&&(I=n===a?"S":"R");let y={...t,pointNumber:d,winner:n,server:a,timestamp:o||(new Date).toISOString()};I&&(y.code=I),y.index=p;let v=uP(i,c,f,g,a);v&&(y.pointsToGame=v.pointsToGame,y.pointsToSet=v.pointsToSet,y.pointsToMatch=v.pointsToMatch,y.gamesToSet=v.gamesToSet,y.isBreakpoint=v.isBreakpoint);let S=gP(i,c,f);void 0!==S&&(y.serveSide=S);let b=IP(y,r?.pointMultipliers||[]);switch(1!==b&&(y.scoreValue=b),i.history.points.push(y),"TO_BE_PLAYED"===i.matchUpStatus&&(i.matchUpStatus="IN_PROGRESS"),f){case"tiebreakOnly":!function(e,t,r,i,n,a,o,s=1){let c=vP(e,!0,!1),u=e.score.sets.indexOf(c),l=n.tiebreakSet.tiebreakTo||11,d=n.tiebreakSet.NoAD||!1,p=c.side1GameScores||[],m=c.side2GameScores||[];0===p.length&&0===m.length&&(p.push(0),m.push(0),c.side1GameScores=p,c.side2GameScores=m);let f=p[0]||0,h=m[0]||0;t.set=u,t.game=0,t.number=f+h,0===r?(f+=s,p[0]=f):(h+=s,m[0]=h),c.side1GameScores=p,c.side2GameScores=m;let g=bP(f,h,l,d);t.score=void 0===g?`${f}-${h}`:"0-0",void 0!==g&&(c.winningSide=g+1,c.side1TiebreakScore=f,c.side2TiebreakScore=h,c.side1Score=0===g?1:0,c.side2Score=0===g?0:1,SP(e,i,o))}(i,y,n,c,g,0,l,b);break;case"matchTiebreak":!function(e,t,r,i,n,a,o=1){let s=i.finalSetFormat?.tiebreakSet?.tiebreakTo||10,c=i.finalSetFormat?.tiebreakSet?.NoAD||!1,u=vP(e,!1,!1),l=e.score.sets.indexOf(u),d=u.side1GameScores||[],p=u.side2GameScores||[];0===d.length&&0===p.length&&(d.push(0),p.push(0),u.side1GameScores=d,u.side2GameScores=p);let m=d[0]||0,f=p[0]||0;t.set=l,t.game=0,t.number=m+f,0===r?(m+=o,d[0]=m):(f+=o,p[0]=f),u.side1GameScores=d,u.side2GameScores=p;let h=bP(m,f,s,c);t.score=void 0===h?`${m}-${f}`:"0-0",void 0!==h&&(u.side1TiebreakScore=m,u.side2TiebreakScore=f,u.side1Score=0===h?1:0,u.side2Score=0===h?0:1,u.winningSide=h+1,SP(e,i,a))}(i,y,n,c,0,l,b);break;case"timed":!function(e,t,r,i,n=1){let a=vP(e,!1,!0),o=e.score.sets.indexOf(a);t.set=o,t.game=0,t.number=(a.side1Score||0)+(a.side2Score||0),0===r?a.side1Score=(a.side1Score||0)+n:a.side2Score=(a.side2Score||0)+n;let s=a.side1Score||0,c=a.side2Score||0;t.score=`${s}-${c}`}(i,y,n,0,b);break;default:!function(e,t,r,i,n,a,o,s){let c=vP(e,!1,!1),u=e.score.sets.indexOf(c),l=c.side1Score||0,d=c.side2Score||0,p=c.side1GameScores||[],m=c.side2GameScores||[];0===p.length&&0===m.length&&(p.push(0),m.push(0));let f=Math.max(p.length,m.length)-1,h=f>=0?p[f]??0:0,g=f>=0?m[f]??0:0;t.set=u,t.game=f,t.number=h+g;let I=n.setTo||6,y=("number"==typeof n.tiebreakAt?n.tiebreakAt:void 0)??I,v=s&&i.finalSetFormat?.noTiebreak;0===r?(h++,p[p.length-1]=h):(g++,m[m.length-1]=g),c.side1GameScores=p,c.side2GameScores=m;let S="CONSECUTIVE"===i.gameFormat?.type,b=i.gameFormat?.count||3;if(S){let e=c.currentStreak;e&&e.side===r?c.currentStreak={side:r,count:e.count+1}:c.currentStreak={side:r,count:1}}let U,w=!v&&l===y&&d===y;U=S&&!w?c.currentStreak.count>=b?c.currentStreak.side:void 0:function(e,t,r,i){let n=r.gameFormat?.NoAD||r.NoAD||!1;if(i){return bP(e,t,r.tiebreakFormat?.tiebreakTo||7,r.tiebreakFormat?.NoAD||!1)}let a=4,o=Math.abs(e-t);if(n)return e>=a||t>=a?e>t?0:1:void 0;if((e>=a||t>=a)&&o>=2)return e>t?0:1}(h,g,n,w);let T=void 0===U?wP(h,g,w,S&&!w):"0-0";if(t.score=T,void 0!==U){S&&(c.currentStreak=void 0),0===U?c.side1Score=l+1:c.side2Score=d+1,w&&(c.side1TiebreakScore=h,c.side2TiebreakScore=g);let t=function(e,t,r,i,n){let a=r.setTo||6,o=("number"==typeof r.tiebreakAt?r.tiebreakAt:void 0)??a,s=i&&n?.noTiebreak;if(1===a)return e>=1||t>=1?e>t?0:1:void 0;let c=(i&&n?n:r).winBy||2;if(!s&&(e===o+1||t===o+1)||(e>=a||t>=a)&&Math.abs(e-t)>=c)return e>t?0:1}(c.side1Score||0,c.side2Score||0,n,s,i.finalSetFormat);"number"==typeof t?(c.winningSide=t+1,SP(e,i,o)):(c.side1GameScores.push(0),c.side2GameScores.push(0))}}(i,y,n,c,g,0,l,h)}return i}function vP(e,t,r){let i=e.score.sets.length-1;if(i>=0&&void 0===e.score.sets[i].winningSide)return e.score.sets[i];let n={setNumber:e.score.sets.length+1,side1Score:0,side2Score:0,side1GameScores:[],side2GameScores:[]};return t&&(n.isTiebreakOnly=!0),r&&(n.isTimed=!0),e.score.sets.push(n),n}function SP(e,t,r){let i=[0,0];e.score.sets.forEach(e=>{1===e.winningSide&&i[0]++,2===e.winningSide&&i[1]++});let n=sP(t),a=t.exactly;if(n){let r=a||t.bestOf||3;if(e.score.sets.filter(e=>void 0!==e.winningSide).length<r)return;let i=e.score.sets.reduce((e,t)=>(void 0!==t.side1TiebreakScore&&void 0!==t.side2TiebreakScore?(e[0]+=t.side1TiebreakScore,e[1]+=t.side2TiebreakScore):(e[0]+=t.side1Score??0,e[1]+=t.side2Score??0),e),[0,0]);return void(i[0]!==i[1]&&(e.matchUpStatus="COMPLETED",e.winningSide=i[0]>i[1]?1:2,e.endTime=(new Date).toISOString()))}if(!(i[0]>=r||i[1]>=r)||a&&e.score.sets.filter(e=>void 0!==e.winningSide).length<a)return;let o=i[0]>=r?0:1;e.matchUpStatus="COMPLETED",e.winningSide=o+1,e.endTime=(new Date).toISOString()}function bP(e,t,r,i=!1){let n=Math.abs(e-t);if((e>=r||t>=r)&&n>=(i?1:2))return e>t?0:1}function UP(e,t,r){let i=function(e,t,r){let i=e.score.sets.length-1,n=i>=0?e.score.sets[i]:void 0;if("tiebreakOnly"===r||"matchTiebreak"===r){let t=n?.side1GameScores||[],r=n?.side2GameScores||[],i=(t[0]||0)+(r[0]||0),a=0;for(let n=0;n<e.score.sets.length-1;n++){let t=e.score.sets[n];a+=(t.side1Score||0)+(t.side2Score||0)}return(a%2+Math.floor(i/2)%2)%2}if("timed"===r)return((n?.side1Score||0)+(n?.side2Score||0))%2;let a=n?.side1Score||0,o=n?.side2Score||0,s=t.setFormat?.setTo||6,c=("number"==typeof t.setFormat?.tiebreakAt?t.setFormat.tiebreakAt:void 0)??s;if(!t.finalSetFormat?.noTiebreak&&a===c&&o===c){let e=n?.side1GameScores||[],t=n?.side2GameScores||[],r=(e.at(-1)||0)+(t.at(-1)||0);return((a+o)%2+Math.floor(r/2)%2)%2}return(a+o)%2}(e,t,r);return 1===e.history?.points?.[0]?.server?1-i:i}function wP(e,t,r,i){if(r||i)return`${e}-${t}`;let n=["0","15","30","40"];if(e<4&&t<4)return`${n[e]}-${n[t]}`;if(e>=3&&t>=3&&e===t)return"40-40";if(e>=3&&t>=3){let r=e-t;if(1===r)return"A-40";if(-1===r)return"40-A";if(r>=2)return"G-40";if(r<=-2)return"40-G"}return e>=3?`40-${t<4?n[t]:"40"}`:t>=3?`${e<4?n[e]:"40"}-40`:`${e<4?n[e]:"0"}-${t<4?n[t]:"0"}`}function TP(e,t){let r=e.score.sets,i=function(e,t=!1){let r=e.score.sets;return 0===r.length?"0-0":r.map(e=>{let r=e.side1Score||0,i=e.side2Score||0;if(void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore){let n=e.side1TiebreakScore||0,a=e.side2TiebreakScore||0;return t&&(0===r&&1===i||1===r&&0===i)?`[${n}-${a}]`:r>i?`${r}-${i}(${a})`:`${r}(${n})-${i}`}return`${r}-${i}`}).join(", ")}(e,t?.useBracketNotation),n=r.length>0?r.at(-1):null,a=n&&void 0===n.winningSide?[n.side1Score||0,n.side2Score||0]:[0,0],o=[0,0];if(n?.side1GameScores&&n.side2GameScores){let e=Math.max(n.side1GameScores.length,n.side2GameScores.length)-1;e>=0&&(o=[n.side1GameScores[e]||0,n.side2GameScores[e]||0])}let s=function(e,t){if("COMPLETED"===e.matchUpStatus||"TO_BE_PLAYED"===e.matchUpStatus)return;let r=oP(e.matchUpFormat);if(!r.isValid||!r.format)return;let i=r.format,n=e.score.sets.at(-1);if(!n||void 0!==n.winningSide)return;let a=[0,0];e.score.sets.forEach(e=>{1===e.winningSide&&a[0]++,2===e.winningSide&&a[1]++});let o=cP(i,a),s="tiebreakOnly"===o||"matchTiebreak"===o,c="CONSECUTIVE"===i.gameFormat?.type,u=s;if(!u&&"standard"===o){let e=i.exactly||i.bestOf||3,t=Math.ceil(e/2),r=a[0]===t-1&&a[1]===t-1,o=r&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(o){let e=n.side1Score||0,t=n.side2Score||0,a=o.setTo||6,s=("number"==typeof o.tiebreakAt?o.tiebreakAt:void 0)??a,c=o.noTiebreak||!1,l=r&&i.finalSetFormat?.noTiebreak;u=!c&&!l&&e===s&&t===s}}let l=wP(t[0],t[1],u,c&&!u).split("-");return 2===l.length?[l[0],l[1]]:[String(t[0]),String(t[1])]}(e,o),c=function(e){if("COMPLETED"===e.matchUpStatus||"TO_BE_PLAYED"===e.matchUpStatus)return;let t=oP(e.matchUpFormat);if(!t.isValid||!t.format)return;let r=t.format,i=r.exactly||r.bestOf||3,n=Math.ceil(i/2),a=[0,0];e.score.sets.forEach(e=>{1===e.winningSide&&a[0]++,2===e.winningSide&&a[1]++});let o,s=cP(r,a),c=a[0]===n-1&&a[1]===n-1,u=c&&r.finalSetFormat?r.finalSetFormat:r.setFormat,l="RALLY"===u?.tiebreakSet?.modifier||"RALLY"===u?.modifier;l||(o=UP(e,r,s));let d=uP(e,r,s,u,o);if(!d)return{isBreakPoint:!1,isGamePoint:!1,isSetPoint:!1,isMatchPoint:!1,isGoldenPoint:!1,isTiebreak:!1,server:o};let{pointsToGame:p,pointsToSet:m,pointsToMatch:f,isBreakpoint:h}=d,g="tiebreakOnly"===s||"matchTiebreak"===s;if(!g&&"standard"===s&&u){let t=e.score.sets.at(-1);if(t){let e=t.side1Score||0,i=t.side2Score||0,n=u.setTo||6,a=("number"==typeof u.tiebreakAt?u.tiebreakAt:void 0)??n,o=u.noTiebreak||!1,s=c&&r.finalSetFormat?.noTiebreak;g=!o&&!s&&e===a&&i===a}}let I=!!(u?.NoAD||u?.gameFormat?.NoAD||g&&(u?.tiebreakFormat?.NoAD||u?.tiebreakSet?.NoAD||r.finalSetFormat?.tiebreakSet?.NoAD))&&1===p[0]&&1===p[1],y=void 0!==o&&1===p[o],v=1===Math.min(m[0],m[1]),S=1===Math.min(f[0],f[1]);return{isBreakPoint:h,isGamePoint:y,isSetPoint:v,isMatchPoint:S,isGoldenPoint:I,isTiebreak:g,server:o}}(e);return{sets:r,scoreString:i,games:a,points:o,pointDisplay:s,situation:c}}function DP(e,t){let r=e.score.sets;if(0===r.length)return"0-0";let i=t?.perspective,n=r.map(e=>{let t=e.side1Score||0,r=e.side2Score||0;if(1===i&&([t,r]=[r,t]),void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore){let n=e.side1TiebreakScore||0,a=e.side2TiebreakScore||0;return 1===i&&([n,a]=[a,n]),t>r?`${t}-${r}(${a})`:`${t}(${n})-${r}`}return`${t}-${r}`}),a=r.at(-1);if("IN_PROGRESS"===e.matchUpStatus&&a&&!a.winningSide){let t=a.side1GameScores||[],r=t.length-1;if(r>=0&&t.length>0){let o=t[r]||0,s=(a.side2GameScores||[])[r]||0;if(0===o&&0===s)return n.join(", ");1===i&&([o,s]=[s,o]);let c=a.side1Score||0,u=a.side2Score||0,l=e.matchUpFormat?oP(e.matchUpFormat):void 0,d=l?.format?.setFormat?.setTo||6,p=("number"==typeof l?.format?.setFormat?.tiebreakAt?l.format.setFormat.tiebreakAt:void 0)??d,m=c===p&&u===p,f="CONSECUTIVE"===l?.format?.gameFormat?.type,h=n.at(-1),g=`${n.slice(0,-1).join(", ")}${n.length>1?", ":""}${h}`;if(m||f)return`${g} (${o}-${s})`;{let e=function(e,t){let r=["0","15","30","40"];if(e<=3&&t<=3)return`${r[e]||"40"}-${r[t]||"40"}`;if(3===e&&3===t)return"40-40";if(e>=3&&t>=3){let r=e-t;if(0===r)return"40-40";if(1===r)return"A-40";if(-1===r)return"40-A";if(r>=2)return"G-40";if(r<=-2)return"40-G"}return e>=3?e-t>=2?"G-40":`40-${r[t]||"40"}`:t>=3?t-e>=2?"40-G":`${r[e]||"40"}-40`:`${r[e]||"0"}-${r[t]||"0"}`}(o,s);return`${g} (${e})`}}}return n.join(", ")}function PP(e){if("COMPLETED"===e.matchUpStatus)return e.winningSide}function NP(e){return"COMPLETED"===e.matchUpStatus}function EP(e){if(!e)return[];let t=e.history?.points;if(!t||0===t.length)return[];let r=[];for(let i=0;i<t.length;i++){let n,a,o=t[i],s=i<t.length-1?t[i+1]:void 0,c=o.set??0,u=o.game??0,l=o.number??0,d=s?s.set??0:void 0,p=s?s.game??0:void 0,m=i===t.length-1,f=m?"COMPLETED"===e.matchUpStatus||void 0===d&&void 0===p:d!==c||p!==u,h=m?"COMPLETED"===e.matchUpStatus||!1:void 0!==s&&d!==c;if(f&&(n=o.winner),h){let t=e.score.sets[c];void 0!==t?.winningSide&&(a=t.winningSide-1)}let g={};o.pointsToGame&&(g.pointsToGame=o.pointsToGame),o.pointsToSet&&(g.pointsToSet=o.pointsToSet),o.pointsToMatch&&(g.pointsToMatch=o.pointsToMatch),o.gamesToSet&&(g.gamesToSet=o.gamesToSet),void 0!==o.isBreakpoint&&(g.isBreakpoint=o.isBreakpoint);let I=s?.server??o.server??0,y=e.score.sets[c],v=!!(y?.isTiebreakOnly||u>0&&y&&void 0!==y.side1Score&&void 0!==y.side2Score&&!y.isTiebreakOnly),S={action:"addPoint",point:{index:i,number:l,winner:o.winner,server:o.server,score:o.score,result:o.result},game:{index:u,isTiebreak:v,complete:f,winner:n},set:{index:c,complete:h,winner:a},needed:g,nextService:I,result:o.result,complete:m&&"COMPLETED"===e.matchUpStatus};r.push(S)}return r}Object.fromEntries(Object.entries(aP).map(([e,t])=>[t,e]));var MP={A:"Ace",D:"Double Fault",S:"Serve Winner",R:"Return Winner",W:"Winner",E:"Unforced Error",F:"Forced Error"},RP=new Set(["A","S"]),AP=new Set(["D","R","E","F"]);function CP(e,t){let r={...e};return r.server=t.server,r.index=t.index,r.set=t.set,r.game=t.game,r.code&&!r.winner&&(r.winner=function(e,t){return RP.has(e)?t:AP.has(e)?1-t:t}(r.code,t.server)),r.code&&!r.result&&(r.result=MP[r.code]),r.first_serve?r.serve=2:r.serve||(r.serve=1),r}function kP(e,t){let r={players:{},teams:{}};for(let a=0;a<2;a++)r.players[a]={},r.teams[a]={};let i,n=e;return void 0!==t?.setFilter&&(n=e.filter(e=>e.set===t.setFilter)),n.forEach((e,t)=>{if(void 0===e.winner)return void console.warn("Point missing winner:",e);let{winner:n,loser:a}=function(e){let t=[],r=[],i=e.result?.toLowerCase()||"";return i.includes("ace")&&t.push("aces"),(i.includes("winner")||i.includes("ace"))&&t.push("winners"),i.includes("double fault")&&r.push("doubleFaults"),i.includes("unforced error")&&r.push("unforcedErrors"),i.includes("forced error")&&r.push("forcedErrors"),e.winner===e.server?(t.push("servesWon"),1===e.serve?t.push("serves1stWon"):2===e.serve&&t.push("serves2ndWon")):(t.push("returns"),1===e.serve?t.push("received1stWon"):2===e.serve&&t.push("received2ndWon")),t.push("pointsWon"),{winner:t,loser:r}}(e),o=e.winner,s=1-o;if(n.forEach(t=>{r.teams[o][t]||(r.teams[o][t]=[]),r.teams[o][t].push(e),r.players[o][t]||(r.players[o][t]=[]),r.players[o][t].push(e)}),a.forEach(t=>{r.teams[s][t]||(r.teams[s][t]=[]),r.teams[s][t].push(e),r.players[s][t]||(r.players[s][t]=[]),r.players[s][t].push(e)}),void 0!==e.server){let t=e.server;r.teams[t].pointsServed||(r.teams[t].pointsServed=[]),r.teams[t].pointsServed.push(e),1===e.serve?(r.teams[t].serves1stIn||(r.teams[t].serves1stIn=[]),r.teams[t].serves1stIn.push(e)):2===e.serve&&(r.teams[t].serves2ndIn||(r.teams[t].serves2ndIn=[]),r.teams[t].serves2ndIn.push(e))}if(e.hand){let i=e.hand;r.teams[o][i]||(r.teams[o][i]=[]),r.teams[o][i].push({point:e,index:t})}if(function(e,t){return!(!t||void 0===e.game||void 0===t.game)&&e.game!==t.game}(e,i)&&void 0!==i?.winner){let e=i.winner;r.teams[e].gamesWon||(r.teams[e].gamesWon=[]),r.teams[e].gamesWon.push(i),r.players[e].gamesWon||(r.players[e].gamesWon=[]),r.players[e].gamesWon.push(i)}if(e.breakpoint){let t=e.server;r.teams[t].breakpointsFaced||(r.teams[t].breakpointsFaced=[]),r.teams[t].breakpointsFaced.push(e),o===t&&(r.teams[t].breakpointsSaved||(r.teams[t].breakpointsSaved=[]),r.teams[t].breakpointsSaved.push(e))}i=e}),r}function xP(e,t,r){switch(e.calc){case"number":return function(e,t,r){let i=OP(e.numerators,t,r);return{value:i,display:String(i),numerators:e.numerators}}(e,t,r);case"percentage":return function(e,t,r){let i=OP(e.numerators,t,r),n=OP(e.denominators||[],t,r);if(!n)return{value:0,display:"0",numerators:e.numerators};let a=Math.round(i/n*100);return{value:a,display:`${a}% (${i}/${n})`,numerators:e.numerators}}(e,t,r);case"maxConsecutive":return function(e,t,r){let i=e.numerators[0],n=e.attribute||"index";if(!t[r][i])return{value:0,display:"0"};let a,o=t[r][i],s=0,c=o.length?1:0;return o.forEach(e=>{let t=e[n];void 0!==a&&t===a+1?c++:(c>s&&(s=c),c=1),a=t}),c>s&&(s=c),{value:s,display:String(s)}}(e,t,r);case"difference":return function(e,t,r){let i=OP(e.numerators,t,r),n=OP(e.denominators||[],t,r);if(!n)return{value:0,display:"0",numerators:e.numerators};let a=Math.abs(n-i),o=Math.round(a/n*100);return{value:o,display:`${o}% (${a}/${n})`,numerators:e.numerators}}(e,t,r);case"aggressiveMargin":return function(e,t,r){let i=OP(e.denominators||[],t,r),n=OP(e.numerators,t,r),a=i-n;return{value:a,display:String(a)}}(e,t,r);default:return{value:0,display:"0"}}}function OP(e,t,r){return e?e.reduce((e,i)=>{let n=i.startsWith("-");i.includes("*");let a=i.replace("-","").replace("*",""),o=n?1-r:r,s=t[o]?.[a];return s?e+s.length:e},0):0}function FP(e,t,r){let i=kP(t||[],r),n=function(e){if(!e?.teams)return[];let t=[];return Object.values({Aces:{category:"Aces",numerators:["aces"],calc:"number"},"Double Faults":{category:"Double Faults",numerators:["doubleFaults"],calc:"number"},Winners:{category:"Winners",numerators:["winners"],calc:"number"},"Unforced Errors":{category:"Unforced Errors",numerators:["unforcedErrors"],calc:"number"},"Forced Errors":{category:"Forced Errors",numerators:["forcedErrors"],calc:"number"},"Total Points Won":{category:"Total Points Won",numerators:["pointsWon"],calc:"number"},"Max Pts/Row":{category:"Max Pts/Row",numerators:["pointsWon"],calc:"maxConsecutive",attribute:"index"},"Max Games/Row":{category:"Max Games/Row",numerators:["gamesWon"],calc:"maxConsecutive",attribute:"game"},"First Serve %":{category:"First Serve %",numerators:["serves1stIn"],denominators:["pointsServed"],calc:"percentage"},"Points Won 1st":{category:"Points Won 1st",numerators:["serves1stWon"],denominators:["serves1stIn"],calc:"percentage"},"Points Won 2nd":{category:"Points Won 2nd",numerators:["serves2ndWon"],denominators:["serves2ndIn"],calc:"percentage"},"Points Won Receiving":{category:"Points Won Receiving",numerators:["received1stWon","received2ndWon"],denominators:["-pointsServed"],calc:"percentage"},"Breakpoints Saved":{category:"Breakpoints Saved",numerators:["breakpointsSaved"],denominators:["breakpointsFaced"],calc:"percentage"},"Breakpoints Converted":{category:"Breakpoints Converted",numerators:["-breakpointsSaved"],denominators:["-breakpointsFaced"],calc:"difference"},"Games Won":{category:"Games Won",numerators:["gamesWon"],calc:"number"},"Service Points Won":{category:"Service Points Won",numerators:["servesWon"],denominators:["pointsServed"],calc:"percentage"},"Aggressive Margin":{category:"Aggressive Margin",numerators:["*doubleFaults","*unforcedErrors"],denominators:["*aces","*winners","-*forcedErrors"],calc:"aggressiveMargin"}}).forEach(r=>{let i=[xP(r,e.teams,0),xP(r,e.teams,1)];(0!==i[0].value||0!==i[1].value)&&t.push({category:r.category,teams:i})}),t}(i),a=function(e){let t={totalPoints:0,byTeam:[0,0],byCategory:{}};for(let i=0;i<2;i++)if(e.teams[i].pointsWon){let r=e.teams[i].pointsWon.length;t.byTeam[i]=r,t.totalPoints+=r}let r=new Set;for(let i=0;i<2;i++)Object.keys(e.teams[i]).forEach(e=>r.add(e));return r.forEach(r=>{t.byCategory[r]=0;for(let i=0;i<2;i++)e.teams[i][r]&&(t.byCategory[r]+=e.teams[i][r].length)}),t}(i);return{counters:i,calculated:n,summary:a}}function _P(e){if(!e)return[];let t=[],r=0,i=0,n=0;return e.forEach((e,a)=>{let o=CP(e,{server:r,index:a,set:i,game:n});t.push(o),void 0!==o.game&&o.game!==n&&(n=o.game,r=1-r),void 0!==o.set&&o.set!==i&&(i=o.set)}),t}function LP(e,t){let r=kP(e||[],t);return{aces:[r.teams[0].aces?.length||0,r.teams[1].aces?.length||0],doubleFaults:[r.teams[0].doubleFaults?.length||0,r.teams[1].doubleFaults?.length||0],winners:[r.teams[0].winners?.length||0,r.teams[1].winners?.length||0],unforcedErrors:[r.teams[0].unforcedErrors?.length||0,r.teams[1].unforcedErrors?.length||0],totalPoints:[r.teams[0].pointsWon?.length||0,r.teams[1].pointsWon?.length||0]}}function BP(e,t,r){return e.teams[t]?.[r]?.length??0}function $P(e,t){return t&&e?Number.parseFloat((e/t*100).toFixed(2)):0}function VP(e,t,r){return e.find(e=>e.category===t)?.teams[r]?.value??0}function jP(e){if(!e?.counters?.teams)return[];let{counters:t,calculated:r}=e,i=[];i.push({name:"Aces",numerator:[BP(t,0,"aces"),BP(t,1,"aces")],default:"numerator"},{name:"Double Faults",numerator:[BP(t,0,"doubleFaults"),BP(t,1,"doubleFaults")],default:"numerator"});let n=[BP(t,0,"serves1stWon"),BP(t,1,"serves1stWon")],a=[BP(t,0,"servesWon"),BP(t,1,"servesWon")];if(n[0]+n[1]>0&&(a[0]!==n[0]||a[1]!==n[1])){let e=[BP(t,0,"pointsServed"),BP(t,1,"pointsServed")],r=[BP(t,0,"serves1stIn"),BP(t,1,"serves1stIn")],a=[BP(t,0,"serves2ndWon"),BP(t,1,"serves2ndWon")],o=[BP(t,0,"serves2ndIn"),BP(t,1,"serves2ndIn")];i.push({name:"1st Serve In",numerator:r,denominator:e,pct:[$P(r[0],e[0]),$P(r[1],e[1])]},{name:"1st Serve Points Won",numerator:n,denominator:r,pct:[$P(n[0],r[0]),$P(n[1],r[1])]},{name:"2nd Serve Points Won",numerator:a,denominator:o,pct:[$P(a[0],o[0]),$P(a[1],o[1])]})}i.push({name:"Total Points Won",numerator:[BP(t,0,"pointsWon"),BP(t,1,"pointsWon")],default:"numerator"});let o=BP(t,0,"received1stWon")+BP(t,0,"received2ndWon"),s=BP(t,1,"received1stWon")+BP(t,1,"received2ndWon"),c=BP(t,1,"pointsServed"),u=BP(t,0,"pointsServed");i.push({name:"Receiving Points Won",numerator:[o,s],denominator:[c,u],pct:[$P(o,c),$P(s,u)]});let l=BP(t,1,"breakpointsFaced")-BP(t,1,"breakpointsSaved"),d=BP(t,0,"breakpointsFaced")-BP(t,0,"breakpointsSaved"),p=BP(t,1,"breakpointsFaced"),m=BP(t,0,"breakpointsFaced");i.push({name:"Break Points Won",numerator:[l,d],denominator:[p,m],pct:[$P(l,p),$P(d,m)]});let f=BP(t,0,"breakpointsSaved"),h=BP(t,1,"breakpointsSaved"),g=BP(t,0,"breakpointsFaced"),I=BP(t,1,"breakpointsFaced");i.push({name:"Break Points Saved",numerator:[f,h],denominator:[g,I],pct:[$P(f,g),$P(h,I)]},{name:"Winners",numerator:[BP(t,0,"winners"),BP(t,1,"winners")],default:"numerator"},{name:"Unforced Errors",numerator:[BP(t,0,"unforcedErrors"),BP(t,1,"unforcedErrors")],default:"numerator"},{name:"Forced Errors",numerator:[BP(t,0,"forcedErrors"),BP(t,1,"forcedErrors")],default:"numerator"});let y=a,v=[BP(t,0,"pointsServed"),BP(t,1,"pointsServed")];return i.push({name:"Service Points Won",numerator:y,denominator:v,pct:[$P(y[0],v[0]),$P(y[1],v[1])]},{name:"Games Won",numerator:[BP(t,0,"gamesWon"),BP(t,1,"gamesWon")]},{name:"Most Consecutive Points Won",numerator:[VP(r,"Max Pts/Row",0),VP(r,"Max Pts/Row",1)]},{name:"Most Consecutive Games Won",numerator:[VP(r,"Max Games/Row",0),VP(r,"Max Games/Row",1)]}),i}var GP=class{constructor(e={}){this.redoStack=[],this.pointMultipliers=[],e.competitionFormat?(this.competitionFormat=e.competitionFormat,this.matchUpFormat=e.matchUpFormat||e.competitionFormat.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=e.pointMultipliers||e.competitionFormat.pointMultipliers||[]):(this.matchUpFormat=e.matchUpFormat||"SET3-S:6/TB7",this.pointMultipliers=e.pointMultipliers||[]),this.matchUpId=e.matchUpId,this.isDoubles=e.isDoubles||!1,this.eventHandlers=e.eventHandlers,this.state=nP({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.cacheFormatStructure()}setState(e){this.state=e,this.matchUpFormat=e.matchUpFormat,this.matchUpId=e.matchUpId,this.isDoubles="DOUBLES"===e.matchUpType,this.redoStack=[],this.initialScore=void 0,this.cacheFormatStructure()}getState(){return this.state}addPoint(e){let t=this.state.history?.points.length||0,r=this.state.score.sets.reduce((e,t)=>e+(t.side1Score||0)+(t.side2Score||0),0),i=this.state.score.sets.filter(e=>void 0!==e.winningSide).length,n="COMPLETED"===this.state.matchUpStatus,a=this.hasLineUp()?this.getActivePlayers():void 0;if(this.state=yP(this.state,e,{pointMultipliers:this.pointMultipliers}),a){let e=this.state.history.points[this.state.history.points.length-1];this.isDoubles?e.activePlayers=[a.side1,a.side2]:e.activePlayers=[a.side1[0]||"",a.side2[0]||""]}if(e.penaltyType){this.state.history.points[this.state.history.points.length-1].penaltyType=e.penaltyType}if(this.ensureHistory(),this.state.history.entries.push({type:"point",data:{winner:e.winner,server:e.server,timestamp:e.timestamp,rallyLength:e.rallyLength,result:e.result,penaltyType:e.penaltyType},timestamp:e.timestamp||(new Date).toISOString(),pointIndex:t}),this.redoStack=[],this.eventHandlers){let t=this.buildEventContext();if(this.eventHandlers.onPoint?.(t),this.state.score.sets.reduce((e,t)=>e+(t.side1Score||0)+(t.side2Score||0),0)>r&&this.eventHandlers.onGameComplete?.({...t,gameWinner:e.winner}),this.state.score.sets.filter(e=>void 0!==e.winningSide).length>i){let e=1===this.state.score.sets.findLast(e=>void 0!==e.winningSide)?.winningSide?0:1;this.eventHandlers.onSetComplete?.({...t,setWinner:e})}if(!n&&"COMPLETED"===this.state.matchUpStatus){let e=1===this.state.winningSide?0:1;this.eventHandlers.onMatchComplete?.({...t,matchWinner:e})}}}addSet(e){this.applyAddSet(e),this.ensureHistory();let t=this.state.score.sets.at(-1)?.winningSide;this.state.history.entries.push({type:"set",data:{...e,winningSide:t},timestamp:e.timestamp||(new Date).toISOString()}),this.redoStack=[]}addGame(e){this.applyAddGame(e),this.ensureHistory(),this.state.history.entries.push({type:"game",data:e,timestamp:e.timestamp||(new Date).toISOString()}),this.redoStack=[]}endSegment(e){this.applyEndSegment(e),this.ensureHistory();let t=(e?.setNumber??this.state.score.sets.length)-1;this.state.history.entries.push({type:"endSegment",data:{setNumber:t+1,...e},timestamp:e?.timestamp||(new Date).toISOString()})}setInitialScore(e){this.initialScore=e,this.redoStack=[],this.applyInitialScore(this.state,e),this.ensureHistory(),this.state.history.entries.push({type:"setInitialScore",data:e,timestamp:(new Date).toISOString()}),"TO_BE_PLAYED"===this.state.matchUpStatus&&(this.state.matchUpStatus="IN_PROGRESS")}undo(e=1){let t=this.state.history?.entries;if(t&&t.length>0){let r=Math.min(e,t.length);for(let e=0;e<r;e++){let e=t.pop();this.redoStack.push(e),"point"===e.type&&this.state.history.points.pop()}return this.rebuildFromEntries(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}let r=this.state.history?.points||[];if(0===r.length)return!1;let i=Math.min(e,r.length);for(let n=0;n<i;n++){let e=r.pop();this.redoStack.push({type:"point",data:{winner:e.winner,server:e.server,timestamp:e.timestamp,rallyLength:e.rallyLength},timestamp:e.timestamp||""})}return this.rebuildState(),this.eventHandlers?.onUndo?.(this.buildEventContext()),!0}redo(e=1){if(0===this.redoStack.length)return!1;let t=Math.min(e,this.redoStack.length);for(let r=0;r<t;r++){let e=this.redoStack.pop();this.ensureHistory(),this.state.history.entries.push(e),e.type}return this.rebuildFromEntries(),this.eventHandlers?.onRedo?.(this.buildEventContext()),!0}canUndo(){let e=this.state.history?.entries;return!!(e&&e.length>0)||(this.state.history?.points.length||0)>0}canRedo(){return this.redoStack.length>0}getUndoDepth(){let e=this.state.history?.entries;return e&&e.length>0?e.length:this.state.history?.points.length||0}getRedoDepth(){return this.redoStack.length}getScore(){return TP(this.state)}getScoreboard(e){return DP(this.state,e)}getWinner(){return PP(this.state)}isComplete(){return NP(this.state)}getPointCount(){return this.state.history?.points.length||0}getFormat(){return this.state.matchUpFormat}getStatistics(e){let t=this.state.history?.points||[];return FP(this.state,t,e)}getStatObjects(e){return jP(this.getStatistics(e))}getNextServer(){if("WINNER_SERVES"===this.competitionFormat?.serverRule){let e=this.state.history?.points.at(-1);return e?e.winner:0}if(!this.cachedFormatStructure)return 0;let e=[0,0];this.state.score.sets.forEach(t=>{1===t.winningSide&&e[0]++,2===t.winningSide&&e[1]++});let t=cP(this.cachedFormatStructure,e);return UP(this.state,this.cachedFormatStructure,t)}getEpisodes(){return EP(this.state)}isNoAd(){return!(!this.cachedFormatStructure?.setFormat?.NoAD&&!this.cachedFormatStructure?.setFormat?.gameFormat?.NoAD)}getSetsToWin(){if(!this.cachedFormatStructure)return 2;let e=this.cachedFormatStructure.exactly||this.cachedFormatStructure.bestOf||3;return Math.ceil(e/2)}getTiebreakAt(){let e=this.cachedFormatStructure?.setFormat;if(!e||e.tiebreakSet||e.timed||e.noTiebreak)return null;let t=e.setTo||6;return("number"==typeof e.tiebreakAt?e.tiebreakAt:void 0)??t}hasFinalSetTiebreak(){let e=this.cachedFormatStructure?.finalSetFormat;return e?!!e.tiebreakSet||!e.noTiebreak&&!(!e.tiebreakFormat&&void 0===e.tiebreakAt):null!==this.getTiebreakAt()}getFormatStructure(){return this.cachedFormatStructure}getInputMode(){let e=this.state.history?.entries||[];if(0===e.length)return(this.state.history?.points.length||0)>0?"points":"none";let t=new Set(e.filter(e=>"setInitialScore"!==e.type&&"endSegment"!==e.type).map(e=>e.type));if(0===t.size)return"none";if(1===t.size){let e=t.values().next().value;if("point"===e)return"points";if("game"===e)return"games";if("set"===e)return"sets"}return"mixed"}setLineUp(e,t){let r=this.state.sides.find(t=>t.sideNumber===e);r&&(r.lineUp=t),this.initialLineUps??={},this.initialLineUps[e]=t.map(e=>({...e}))}substitute(e){let t=this.state.sides.find(t=>t.sideNumber===e.sideNumber);if(!t?.lineUp)return;let r=t.lineUp.findIndex(t=>t.participantId===e.outParticipantId);if(-1===r)return;this.ensureHistory(),this.state.history.substitutions??=[];let i={sideNumber:e.sideNumber,outParticipantId:e.outParticipantId,inParticipantId:e.inParticipantId,beforePointIndex:this.state.history.points.length,timestamp:e.timestamp};this.state.history.substitutions.push(i),t.lineUp[r]={...t.lineUp[r],participantId:e.inParticipantId},this.state.history.entries.push({type:"substitution",data:i,timestamp:e.timestamp||(new Date).toISOString()}),this.redoStack=[]}getActivePlayers(){let e=this.state.sides.find(e=>1===e.sideNumber),t=this.state.sides.find(e=>2===e.sideNumber);return{side1:e?.lineUp?.map(e=>e.participantId)||[],side2:t?.lineUp?.map(e=>e.participantId)||[]}}hasLineUp(){return this.state.sides.some(e=>e.lineUp&&e.lineUp.length>0)}setPointMultipliers(e){this.pointMultipliers=e}getPointMultipliers(){return this.pointMultipliers}getSupplementaryState(){return{redoStack:[...this.redoStack],initialLineUps:this.initialLineUps?Object.fromEntries(Object.entries(this.initialLineUps).map(([e,t])=>[e,t.map(e=>({...e}))])):void 0}}loadSupplementaryState(e){e.redoStack&&(this.redoStack=[...e.redoStack]),e.initialLineUps&&(this.initialLineUps=Object.fromEntries(Object.entries(e.initialLineUps).map(([e,t])=>[e,t.map(e=>({...e}))])))}getPenaltyProfile(){return this.competitionFormat?.penaltyProfile}getPointProfile(){return this.competitionFormat?.pointProfile}getTimerProfile(){return this.competitionFormat?.timerProfile}getTimeoutRules(){return this.competitionFormat?.timeoutRules}getSubstitutionRules(){return this.competitionFormat?.substitutionRules}getPlayerRules(){return this.competitionFormat?.playerRules}setEventHandlers(e){this.eventHandlers=e}getEventHandlers(){return this.eventHandlers}decoratePoint(e,t){let r=this.state.history?.points[e];r&&Object.assign(r,t)}markHardBoundary(e){let t=this.state.score.sets[e.setIndex];t&&(t.hardBoundaries??=[],t.hardBoundaries.includes(e.gameIndex)||(t.hardBoundaries.push(e.gameIndex),t.hardBoundaries.sort((e,t)=>e-t)))}editPoint(e,t,r){let i=this.state.history?.points;if(!i||e<0||e>=i.length)return;let n=!1!==r?.recalculate,a=i[e];if(void 0!==t.winner&&(a.winner=t.winner),void 0!==t.server&&(a.server=t.server),void 0!==t.timestamp&&(a.timestamp=t.timestamp),void 0!==t.rallyLength&&(a.rallyLength=t.rallyLength),void 0!==t.wrongSide&&(a.wrongSide=t.wrongSide),void 0!==t.wrongServer&&(a.wrongServer=t.wrongServer),void 0!==t.penaltyPoint&&(a.penaltyPoint=t.penaltyPoint),!n)return;let o=this.state.history?.entries;if(o){let r=o.find(t=>"point"===t.type&&t.pointIndex===e);r&&(void 0!==t.winner&&(r.data.winner=t.winner),void 0!==t.server&&(r.data.server=t.server))}o&&o.length>0?this.rebuildFromEntries():this.rebuildState(),this.redoStack=[]}reset(){this.state=nP({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles}),this.redoStack=[],this.initialScore=void 0,this.initialLineUps=void 0,this.eventHandlers?.onReset?.(this.buildEventContext())}ensureHistory(){this.state.history??={points:[]},this.state.history.entries??=[]}buildEventContext(){return{state:this.state,score:TP(this.state)}}cacheFormatStructure(){let e=oP(this.matchUpFormat);this.cachedFormatStructure=e.isValid?e.format:void 0}getInitialLineUps(){return this.initialLineUps}applyAddSet(e){let{side1Score:t,side2Score:r,side1TiebreakScore:i,side2TiebreakScore:n}=e,a=e.winningSide;void 0===a&&(t>r?a=1:r>t&&(a=2));let o={setNumber:this.state.score.sets.length+1,side1Score:t,side2Score:r,winningSide:a};void 0!==i&&(o.side1TiebreakScore=i),void 0!==n&&(o.side2TiebreakScore=n),this.state.score.sets.push(o),"TO_BE_PLAYED"===this.state.matchUpStatus&&(this.state.matchUpStatus="IN_PROGRESS"),void 0!==a&&this.checkMatchCompletion()}applyAddGame(e){let{winner:t,tiebreakScore:r}=e,i=this.state.score.sets.length>0?this.state.score.sets.at(-1):void 0;(!i||void 0!==i.winningSide)&&(i={setNumber:this.state.score.sets.length+1,side1Score:0,side2Score:0},this.state.score.sets.push(i)),0===t?i.side1Score=(i.side1Score||0)+1:i.side2Score=(i.side2Score||0)+1,r&&(i.side1TiebreakScore=r[0],i.side2TiebreakScore=r[1]),"TO_BE_PLAYED"===this.state.matchUpStatus&&(this.state.matchUpStatus="IN_PROGRESS"),this.checkSetCompletion(i),void 0!==i.winningSide&&this.checkMatchCompletion()}applySubstitution(e){let t=this.state.sides.find(t=>t.sideNumber===e.sideNumber);if(!t?.lineUp)return;let r=t.lineUp.findIndex(t=>t.participantId===e.outParticipantId);-1!==r&&(t.lineUp[r]={...t.lineUp[r],participantId:e.inParticipantId},this.state.history??={points:[]},this.state.history.substitutions??=[],this.state.history.substitutions.push(e))}applyEndSegment(e){let t=(e?.setNumber??this.state.score.sets.length)-1,r=this.state.score.sets[t];if(!r||void 0!==r.winningSide)return;let i=r.side1Score||0,n=r.side2Score||0;i>n?r.winningSide=1:n>i&&(r.winningSide=2),this.checkMatchCompletion()}checkSetCompletion(e){let t=oP(this.state.matchUpFormat);if(!t.isValid||!t.format)return;let r=t.format,i=r.exactly||r.bestOf||3,n=Math.ceil(i/2),a=[0,0];this.state.score.sets.forEach(e=>{1===e.winningSide&&a[0]++,2===e.winningSide&&a[1]++});let o=a[0]===n-1&&a[1]===n-1&&r.finalSetFormat?r.finalSetFormat:r.setFormat;if(!o)return;let s=e.side1Score||0,c=e.side2Score||0;if(o.tiebreakSet){let t=o.tiebreakSet.tiebreakTo||11,r=o.tiebreakSet.NoAD?1:2;(s>=t||c>=t)&&Math.abs(s-c)>=r&&(e.winningSide=s>c?1:2)}else if(!o.timed){let t=o.setTo||6,r=("number"==typeof o.tiebreakAt?o.tiebreakAt:void 0)??t,i=o.noTiebreak||!1,n=o.winBy||2;(!i&&void 0!==e.side1TiebreakScore&&(s===r+1||c===r+1)||(s>=t||c>=t)&&Math.abs(s-c)>=n)&&(e.winningSide=s>c?1:2)}}checkMatchCompletion(){let e=oP(this.state.matchUpFormat);if(!e.isValid||!e.format)return;let t=e.format,r=t.exactly||t.bestOf||3,i=Math.ceil(r/2),n=sP(t),a=t.exactly;if(n){let e=a||r;if(this.state.score.sets.filter(e=>void 0!==e.winningSide).length>=e){let e=this.state.score.sets.reduce((e,t)=>(void 0===t.side1TiebreakScore?(e[0]+=t.side1Score??0,e[1]+=t.side2Score??0):(e[0]+=t.side1TiebreakScore,e[1]+=t.side2TiebreakScore??0),e),[0,0]);e[0]!==e[1]&&(this.state.matchUpStatus="COMPLETED",this.state.winningSide=e[0]>e[1]?1:2,this.state.endTime=(new Date).toISOString())}}else{let e=[0,0];if(this.state.score.sets.forEach(t=>{1===t.winningSide&&e[0]++,2===t.winningSide&&e[1]++}),(e[0]>=i||e[1]>=i)&&(!a||this.state.score.sets.filter(e=>void 0!==e.winningSide).length>=a)){let t=e[0]>=i?0:1;this.state.matchUpStatus="COMPLETED",this.state.winningSide=t+1,this.state.endTime=(new Date).toISOString()}}}rebuildFromEntries(){let e=this.state.history?.entries||[],t=this.getInitialLineUps(),r=nP({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});if(t)for(let i of r.sides)t[i.sideNumber]&&(i.lineUp=t[i.sideNumber].map(e=>({...e})));this.initialScore&&(this.applyInitialScore(r,this.initialScore),"TO_BE_PLAYED"===r.matchUpStatus&&(r.matchUpStatus="IN_PROGRESS")),r.history={points:[],entries:[...e]},this.state=r;for(let i of e)switch(i.type){case"point":this.state=yP(this.state,i.data,{pointMultipliers:this.pointMultipliers}),this.state.history.entries=r.history.entries;break;case"set":this.applyAddSet(i.data);break;case"game":this.applyAddGame(i.data);break;case"endSegment":this.applyEndSegment(i.data);break;case"substitution":this.applySubstitution(i.data)}}rebuildState(){let e=this.state.history?.points||[],t=nP({matchUpFormat:this.matchUpFormat,matchUpId:this.matchUpId,isDoubles:this.isDoubles});this.initialScore&&(this.applyInitialScore(t,this.initialScore),"TO_BE_PLAYED"===t.matchUpStatus&&(t.matchUpStatus="IN_PROGRESS"));for(let r of e)t=yP(t,{winner:r.winner,server:r.server,timestamp:r.timestamp,rallyLength:r.rallyLength,result:r.result},{pointMultipliers:this.pointMultipliers});this.state=t}applyInitialScore(e,t){e.score.sets=[];for(let r=0;r<t.sets.length;r++){let i=t.sets[r],n={setNumber:r+1,side1Score:i.side1Score,side2Score:i.side2Score};void 0!==i.side1TiebreakScore&&(n.side1TiebreakScore=i.side1TiebreakScore),void 0!==i.side2TiebreakScore&&(n.side2TiebreakScore=i.side2TiebreakScore),void 0!==i.winningSide?n.winningSide=i.winningSide:i.side1Score>i.side2Score?n.winningSide=1:i.side2Score>i.side1Score&&(n.winningSide=2),e.score.sets.push(n)}if(t.currentSetScore){let r={setNumber:e.score.sets.length+1,side1Score:t.currentSetScore.side1Score,side2Score:t.currentSetScore.side2Score,side1GameScores:[],side2GameScores:[]};t.currentGameScore?(r.side1GameScores=[t.currentGameScore.side1Points],r.side2GameScores=[t.currentGameScore.side2Points]):(r.side1GameScores=[0],r.side2GameScores=[0]),e.score.sets.push(r)}}},WP={};Br(WP,{addPoint:()=>yP,calculatePointsTo:()=>uP,createMatchUp:()=>nP,inferServeSide:()=>gP,resolvePointValue:()=>IP});var qP={};Br(qP,{keyValueScore:()=>MN,parseMatchUpFormat:()=>Mc,stringifyMatchUpFormat:()=>Tc,tidyScore:()=>JN});var HP=["RET","DEF","WO","WO/WO","ABN","SUS","INT"],zP="DEFAULTED",YP="WALKOVER",KP="ABANDONED",XP="SUSPENDED",QP="RETIRED",JP="INTERRUPTED",ZP=[QP,zP,YP],eN="()",tN="[]",rN=["up","left","shift+tab"],iN=["enter","down","tab","right"],nN="backspace",aN=["r","d","w","a","s","i"],oN="space",sN=["[","("],cN=[...rN,...iN,oN,"]"],uN="-",lN="-",dN=["/"],pN=["0","1","2","3","4","5","6","7","8","9"].concat(aN),mN=pN.map(e=>`shift+${e}`),fN=[uN,nN].concat(cN,dN),hN=[pN,mN,fN].join(","),gN=[hN,rN,iN,["=","+","num_1","num_2","shift+=","shift+-"]].join(","),IN={OUTCOMEKEYS:aN,SIDE1KEYS:pN,SIDE2KEYS:mN,MODIFIERS:fN,PROMPT:"Enter Score",MOVEUP:rN,MOVEDOWN:iN,HOTKEYS:gN};function yN({scoreString:e,lowSide:t,outcome:r}){if(({scoreString:e}=vN({scoreString:e})),2===t){return e+(" "!==(e&&e[e.length-1])?" ":"")+r}return r+" "+e}function vN({scoreString:e}){if(!e)return{scoreString:""};let t=!1;for(let r of HP){let i=e?.indexOf(r);0===i?e=e.slice(r.length+1).trim()+" ":i>0&&(e=e.slice(0,i)),i>=0&&(t=!0)}return e?.trim()||(e=""),{scoreString:e,removed:t}}function SN({analysis:e,scoreString:t,sets:r,lowSide:i}){let n,a;if(!t)return{scoreString:t,sets:r};let{scoreString:o,removed:s}=vN({scoreString:t});if(t=o,s)return{scoreString:t,sets:r,outcomeRemoved:!0};let c=r[r.length-1]||{},u=Object.values(c).filter(e=>void 0!==e).length;c.setNumber&&1===u&&(c=(r=r.slice(0,r.length-1))[r.length-1]||{});let{tiebreakSet:l}=e.setFormat,{tiebreakTo:d,NoAD:p}=l||{},{isTiebreakEntry:m}=bN({brackets:tN,scoreString:t}),f=function(e){return e.split("").reduce((e,t,r)=>(t.match(/\d+/g)&&e.push(r),e),[]).pop()}(t);if(f>=0){n=t.slice(0,f);let{isTiebreakEntry:o}=bN({brackets:eN,scoreString:n}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=bN({brackets:tN,scoreString:n}),l=n&&n[n.length-1].trim(),h=n&&!isNaN(l),g=e.isIncompleteSetScore;if(m&&u){let e=n.slice(s+1).split(lN),r=e?.length>0&&void 0!==e[0]&&!isNaN(parseInt(e[0]))&&parseInt(e[0])||void 0,a=e?.length>1&&void 0!==e[1]&&parseInt(e[1])||void 0,o=[r,a];if(a){let e=1===i?1:0;o[e]=(o?.[1-e]||0)+(p?1:2),(o[e]||0)<d&&(o[e]=d),n=t.slice(0,s+1),n+=o.join(lN)}else void 0!==r?(n=t.slice(0,s+1),n+=r):(n=t.slice(0,s),g=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(n.length||(n=void 0),g){let t=c.side1Score?.toString();if(t){let e=t?.slice(0,t.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}e.isTimedSet?(a=c.side1Score?r:r?.slice(0,r.length-1)||[],a[r.length-1]=c):a=r?.slice(0,r.length-1)||[]}else if(h){let t=c.side2Score?.toString(),i=c.side1Score?.toString();if(!e.isTiebreakEntry&&!e.isMatchTiebreak)if(c.side2Score){let e=t?.slice(0,t.length-1);c.side2Score=!isNaN(e)&&parseInt(e)||void 0}else{let e=i?.slice(0,i.length-1);c.side1Score=!isNaN(e)&&parseInt(e)||void 0}e.isTimedSet?c.side1Score?(a=r||[],a[r.length-1]=c):a=r?.slice(0,r.length-1)||[]:(a=r||[],a[r.length-1]=c),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else o?(a=r||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(m&&!u?a=r?.slice(0,r.length-1)||[]:(a=r,a[r.length-1]=c),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:t,sets:r}}function bN({brackets:e=eN,scoreString:t}){if(!t)return{};let[r,i]=e.split(""),n=t.split(""),a=Math.max(...Ai(r,n));return{isTiebreakEntry:a>Math.max(...Ai(i,n)),lastOpenBracketIndex:a}}function UN(e){let{lowValue:t=0,NoAD:r=!1,tiebreakTo:i}=e||{};return t+1>=i?t+(r?1:2):parseInt(i)}function wN({matchUpFormat:e,matchUpStatus:t,winningSide:r,sets:i}){let n=Mc(e),{bestOf:a}=n,o=Math.ceil(a/2),s=i?.reduce((e,t)=>{let{winningSide:r}=t;return r&&e[r-1]++,e},[0,0])?.indexOf(o)+1||void 0;return ZP.includes(t)&&r&&(s=r),{matchUpWinningSide:s}}function TN({ignoreTiebreak:e=!1,matchUpScoringFormat:t,matchUpFormat:r,isTiebreakSet:i,isDecidingSet:n,isTimedSet:a,set:o}){if(!o)return{error:Da,info:"missing set"};t=t||r&&Mc(r);let s=n&&t.finalSetFormat||t?.setFormat||{},{side1Score:c,side2Score:u}=o,{setTo:l,tiebreakAt:d}=s,p=c||u,m=DN({set:o}),f=Math.abs(c-u),h=c>=l||u>=l,g=i||c>=l&&u>=l||d&&d<l&&(c===d||u===d),I=e||g&&(1===m&&o.side1TiebreakScore>o.side2TiebreakScore||2===m&&o.side2TiebreakScore>o.side1TiebreakScore),y=!g&&s.NoAD||g||i&&s.tiebreakFormat?.NoAD?1:2;return!(!(a&&p||h&&(f>=y||g)||i)||g&&!I)}function DN({set:e}){if(e.side1Score||e.side2Score){if(e.side1Score>e.side2Score)return 1;if(e.side2Score>e.side1Score)return 2}else if(e.side1TiebreakScore||e.side2TiebreakScore){if(e.side1TiebreakScore>e.side2TiebreakScore)return 1;if(e.side2TiebreakScore>e.side1TiebreakScore)return 2}}function PN({analysis:e,set:t}){let r=DN({set:t}),{isDecidingSet:i,isTiebreakSet:n,matchUpScoringFormat:a}=e;return TN({matchUpScoringFormat:a,isDecidingSet:i,isTiebreakSet:n,set:t})&&r}function NN({lowSide:e,value:t,sets:r,scoreString:i,winningSide:n,matchUpStatus:a}){let o;return"r"===t?i?(o=!0,i=yN({scoreString:i,lowSide:e,outcome:"RET"}),n=2===e?1:2,a=QP):(o=!0,i=yN({scoreString:i,lowSide:e,outcome:"DEF"}),n=2===e?1:2,a=zP):"d"===t?(o=!0,i=yN({scoreString:i,lowSide:e,outcome:"DEF"}),n=2===e?1:2,a=zP):"w"===t?(o=!0,r=[],i="WO",n=2===e?1:2,a=YP):"s"===t&&i?(o=!0,i=yN({scoreString:i,lowSide:e,outcome:"SUS"}),a=XP,n=void 0):"a"===t?(o=!0,i=yN({scoreString:i,lowSide:e,outcome:"ABN"}),a=KP,n=void 0):"i"===t&&i&&(o=!0,i=yN({scoreString:i,lowSide:e,outcome:"INT"}),a=JP,n=void 0),{updated:o,sets:r,scoreString:i,matchUpStatus:a,winningSide:n}}function EN({matchUpFormat:e,scoreString:t,winningSide:r,value:i,sets:n}){let a=(n?.filter(e=>e?.winningSide)?.length||0)+(r?0:1),o=Mc(e),s=a===o?.bestOf,c=s&&o?.finalSetFormat||o?.setFormat||{},u=c?.timed,l=s&&n[o?.bestOf-1],d=l?.winningSide,{isTiebreakEntry:p}=bN({brackets:eN,scoreString:t}),{isTiebreakEntry:m}=bN({brackets:tN,scoreString:t}),f=p||m,h=!!c.tiebreakSet,g=t?.[t.length-1]?.trim(),I=t&&!isNaN(g),y=!f&&g===uN,v=p&&sN.includes(g),S=m&&sN.includes(g),b=m&&g===lN,U=t?.split(""),[w]=tN.split(""),T=U&&Math.max(...Ai(w,U)),D=U&&Math.max(...Ai(lN,U)),P=U&&D>T,N=n[n.length-1]?.winningSide,E=n?.length&&!N,M=HP.find(e=>t?.indexOf(e)>=0),R=!isNaN(i),A=i===oN,C=cN.includes(i),k=t?.split("").find(e=>sN.includes(e)),x=C&&m&&!S&&(b||!function({scoreString:e}){if(!e)return!1;let t=e&&e[e.length-1].trim(),r=e&&!isNaN(t),[i,n]=tN.split(""),a=e.split(""),o=Math.max(...Ai(i,a)),s=Math.max(...Ai(n,a)),c=Math.max(...Ai(lN,a));return r&&o>s&&c>o}({scoreString:t}));return{isTiebreakSetValue:h&&R,matchUpScoringFormat:o,setNumber:a,setFormat:c,matchTiebreakHasJoiner:P,isGameScoreEntry:E,isSpace:A,isCloser:C,isTiebreakCloser:C&&k&&f&&I,isDecidingSet:s,isTiebreakSet:h,isTimedSet:u,isNumericEnding:I,isNumericValue:R,hasOpener:k,hasOutcome:M,finalSet:l,finalSetIsComplete:d,lastSetIsComplete:N,isInvalidSetTiebreakValue:A&&f&&v,isInvalidMatchTiebreakValue:x,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:m,isIncompleteSetScore:y,isIncompleteSetTiebreak:v,isIncompleteMatchTiebreak:S,isPartialMatchTiebreakValue:b}}function MN(e){let t,r,{lowSide:i=1,value:n}=e,{scoreString:a,sets:o,winningSide:s,matchUpStatus:c}=e,{matchUpFormat:u,shiftFirst:l,auto:d=!0}=e,p=l&&2===i||!l&&1===i;if(!hN.includes(n))return{updated:!1,info:"invalid key"};l&&(i=3-i);let{matchUpWinningSide:m}=wN({sets:o,winningSide:s,matchUpStatus:c,matchUpFormat:u});s=m;let f=EN({value:n,winningSide:s,scoreString:a,sets:o,matchUpFormat:u});if(dN.includes(n)&&(n=uN),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===Jr(n)&&(f.isTiebreakCloser=!0),cN.includes(n)&&f.hasOpener&&(n=""),cN.includes(n)&&(n=oN),f.lastSetIsComplete){let e=a?.length&&a[a.length-1];a&&" "!==e&&(a+=" ")}if(f.isTimedSet)({info:r,sets:o,scoreString:a,updated:t,matchUpStatus:c,winningSide:s}=function(e){let t,r,{sets:i,info:n,scoreString:a,winningSide:o,matchUpStatus:s}=e,{analysis:c,lowSide:u,value:l}=e;!i?.length&&l!==nN&&(i=[{setNumber:1}]);let d=i.length-1;if(aN.includes(l)){let e=i[i.length-1]||{},{side1Score:r,side2Score:d}=e;r&&!d?n="missing side2Score":c.finalSetIsComplete||o?n="final set is already complete":c.isIncompleteSetScore?n="incomplete set scoreString":c.isIncompleteSetScore||({sets:i,scoreString:a,winningSide:o,matchUpStatus:s,updated:t}=NN({lowSide:u,value:l,sets:i,scoreString:a,matchUpStatus:s,winningSide:o}))}else if(l===nN){if(({scoreString:a,sets:i,outcomeRemoved:r}=SN({analysis:c,scoreString:a,sets:i})),""===a?.trim()&&(a=a.trim()),a||(i=[]),r){let e=i[i.length-1]||{},{side1Score:t,side2Score:r}=e;if(t&&r){let n=(t>r?1:r>t&&2)||void 0;n&&(e.winningSide=n,i.push({setNumber:i.length+1}))}}s=void 0,o=void 0,t=!0}else if(c.hasOutcome)n="has outcome";else{if(o)return{sets:i,scoreString:a,winningSide:o,matchUpStatus:s,updated:!1,info:"matchUp is complete"};if(l===oN){let e=i[i.length-1]||{},{side1Score:r,side2Score:n}=e,s=(r>n?1:n>r&&2)||void 0;s&&!o&&!c.isIncompleteSetScore&&(i[i.length-1].winningSide=s,i.push({setNumber:i.length+1}),a+=" ",t=!0)}else if(l===uN&&void 0!==i[d].side1Score&&void 0===i[d].side2Score&&a&&c.isNumericEnding)a+="-",i[d].side2Score=0,s=void 0,o=void 0,t=!0;else if(!isNaN(l)){let e;if(void 0===i[d].side2Score){let r=Jr((i[d].side1Score||0).toString()+l).toString().slice(0,2);i[d].side1Score=Jr(r),e=i[d].side1Score.toString(),t=!0}else{let r=Jr((i[d].side2Score||0).toString()+l).toString().slice(0,2);i[d].side2Score=Jr(r),e=[i[d].side1Score,i[d].side2Score].join("-"),t=!0}if(t){let t=(i.slice(0,d)||[]).filter(e=>e).map(e=>{let{side1Score:t,side2Score:r}=e;return[t,r].join("-")}).join(" ");a=t?t+" "+e:e}}}return{sets:i,scoreString:a,winningSide:o,matchUpStatus:s,info:n,updated:t}}({analysis:f,lowSide:i,scoreString:a,sets:o,matchUpStatus:c,winningSide:s,value:n}));else if(aN.includes(n))f.finalSetIsComplete||s?r="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?r="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:n}):({sets:o,scoreString:a,matchUpStatus:c,winningSide:s,updated:t}=NN({lowSide:i,sets:o,scoreString:a,matchUpStatus:c,winningSide:s,value:n}));else if(n===nN)t=!0,({scoreString:a,sets:o}=SN({analysis:f,scoreString:a,sets:o,lowSide:i})),a||(o=[]),c=void 0,s=void 0;else if(f.hasOutcome)r="has outcome";else if(n!==uN||f.isMatchTiebreakEntry)if(n===lN&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?r="existing joiner":f.isNumericEnding&&(t=!0,a+=lN);else if([uN,lN].includes(n))r="invalid location for joiner";else{if(s)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:o,scoreString:a,updated:t}=function({analysis:e,scoreString:t,sets:r,value:i}){let n;if(!r?.length)return{sets:[]};let a=r[r.length-1];i=Jr(i);let{validSide2Score:o,requiresTiebreak:s}=function({analysis:e,set:t={},value:r}){let i,n,a=e.isDecidingSet&&e.matchUpScoringFormat.finalSetFormat||e.matchUpScoringFormat.setFormat,{tiebreakAt:o,setTo:s,NoAD:c}=a,{side1Score:u}=t;return i=o&&o<s?u===o?r<=s:r<=o:u===s?c?r<s:r<=s+1:u===s-1?c?r<=s:r<=s+1:u===s+1?r===s||r===s-1:r<=s,i&&(n=o&&o<s?u===s&&r===o||u===o&&r===s:u>=s&&r>=s&&u!==r),{validSide2Score:i,requiresTiebreak:n}}({analysis:e,set:a,value:i});if(o){n=!0,t=(t||"")+i,a.side2Score=i;let o=PN({analysis:e,set:r[r.length-1]});a.winningSide=o||void 0,s?t+=eN.split("")[0]:e.isDecidingSet||(t+=" ")}return{sets:r,scoreString:t,updated:n}}({analysis:f,scoreString:a,sets:o,value:n}));else if(f.isInvalidMatchTiebreakValue)r="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)r="invalid set tiebreak character";else if(f.isTiebreakCloser){let e=f.isSetTiebreakEntry?eN:tN,r=e.split("").reverse()[0],i=e.split("")[0],n=o[o.length-1],{tiebreakFormat:s}=f.setFormat,{tiebreakTo:c,NoAD:u}=s||{},l=DN({set:n});if(!f.isTiebreakSet){let e=Number.parseInt(a.split(i).reverse()[0]),t=UN({lowValue:e,tiebreakTo:c,NoAD:u});1===l?(n.side1TiebreakScore=t,n.side2TiebreakScore=e):(n.side1TiebreakScore=e,n.side2TiebreakScore=t)}a=(a||"")+r,f.isDecidingSet||(a+=" ");let d=PN({analysis:f,set:n});n.winningSide=d||void 0,t=!0}else if(f.isTiebreakSetValue)({info:r,scoreString:a,sets:o,updated:t}=function({analysis:e,auto:t,lowSide:r,scoreString:i="",sets:n,value:a}){let o,s,{tiebreakSet:{tiebreakTo:c,NoAD:u}}=e.setFormat,[l]=tN.split("");if(e.isMatchTiebreakEntry||(i+=l),n[e.setNumber-1]){let{lastOpenBracketIndex:e}=bN({brackets:tN,scoreString:i}),l=(i.slice((e??0)+1)+(t?"":a)).split(lN);if((l[r-1]?.length||0)>=2)s="tiebreak digit limit";else if(t){1===r&&(l[0]=(l[0]||"")+a),2===r&&(l[1]=(l[1]||"")+a);let t=[l[0]||0,l[1]||0].map(e=>Jr(e)),s=1===r?1:0;t[s]=t[1-s]+(u?1:2),t[s]<c&&(t[s]=c);let d=n[n.length-1];d.side1TiebreakScore=t[0],d.side2TiebreakScore=t[1],i=i.slice(0,(e??0)+1),i+=t.join(lN),o=!0}else{let e=[l[0]||0,l[1]||0].map(e=>Jr(e)),t=n[n.length-1];t.side1TiebreakScore=e[0],t.side2TiebreakScore=e[1],i+=a,o=!0}}else{let e=UN({lowValue:Jr(a||0),tiebreakTo:c,NoAD:u}),t=[Jr(a),e];2===r&&t.reverse();let s={side1TiebreakScore:t[0],side2TiebreakScore:t[1],setNumber:n?.length+1||1};n.push(s),i+=t.join(lN),o=!0}return{info:s,scoreString:i,sets:n,updated:o}}({analysis:f,auto:d,lowSide:i,scoreString:a,sets:o,value:n}));else if(f.isSetTiebreakEntry){let[e]=eN.split(""),i=Math.max(...Ai(e,a.split(""))),o=a.slice(i+1),s=o&&0===Jr(o),c=Jr(o?o+n:n),{tiebreakFormat:u}=f.setFormat,{tiebreakTo:l,NoAD:d}=u||{};!s&&o.length<2?d&&c>l-1?r="invalid low value for NoAD tiebreak":(t=!0,a=(a||"")+n):r=s?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)r=`invalid key: ${n}`;else if(f.isGameScoreEntry)r="game scoreString entry";else if(f.lastSetIsComplete||!o.length){t=!0;let{scoreString:e,set:r}=function({analysis:e,lowSide:t,scoreString:r,value:i}){let{setTo:n,tiebreakAt:a,NoAD:o}=e?.setFormat||{},s=i===parseInt(a||n);if(a&&a<n&&i>a)return{scoreString:r};if(o&&i===n||i>n)return{scoreString:r};let c=[i,s?i+1:i+1===n?i+(o?1:2):n];2===t&&c.reverse();let u=eN.split("")[0];r=(r||"")+(c.join(uN)+(s?u:" "));let l={side1Score:c[0],side2Score:c[1]},d=PN({analysis:e,set:l});return l.winningSide=d||void 0,{scoreString:r,set:l}}({analysis:f,lowSide:i,scoreString:a,value:Jr(n)});r&&(r.setNumber=o?.length+1||1),o=o?.concat(r).filter(Boolean)||[r],a=e||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(t=!0,({scoreString:a,sets:o}=SN({analysis:f,scoreString:a,sets:o,lowSide:i})),c=void 0);if(t){o=o?.filter(Boolean);let{matchUpWinningSide:e}=wN({sets:o,winningSide:s,matchUpStatus:c,matchUpFormat:u});return s=e,!e||c&&![lf,of].includes(c)?a&&!s&&![XP,KP,JP].includes(c)&&(c=void 0):(c="COMPLETED",o=o.filter(e=>{let{side1Score:t,side2Score:r,side1TiebreakScore:i,side2TiebreakScore:n}=e;return t||r||i||n})),{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:c,info:r}}return{updated:t,scoreString:a,sets:o,winningSide:s,matchUpStatus:c,info:r}}var RN="\\d+-\\d+",AN="\\d+-\\d+\\(\\d+\\)",CN="\\[\\d+-\\d+\\]",kN=new RegExp(`(${RN}),`,"g"),xN=new RegExp(`(${AN}),`,"g"),ON=[RN,AN,CN,"\\d+-\\d+\\(\\d+-\\d+\\)"],FN=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map(e=>{let t=e.split("").map(e=>ON[e]).join(" ");return new RegExp(`^${t}$`)});function _N(e){return!e||FN.some(t=>t.test(e))}function LN(e){return/^\(\d+\)$/.test(e)||/^\(\d+$/.test(e)}function BN(e){let t=(r=e,r?.split("-").join("").split("/").join(""));var r;if(/^\d+$/.test(t)&&2===t.length){let e=t.split("");return 1===Math.abs(e.reduce((e,t)=>+e-+t))}return!1}function $N(e,t){let r=[e.slice(t,t+2),t?e.slice(0,1):e.slice(2)].map(e=>parseInt(e.join("")));t&&r.reverse();let i=r;if(Math.abs(i.reduce((e,t)=>+e-+t))>=2)return i.join("-")}function VN(e){return 2===e.length?e.split("").join("-"):([", ",",","/"," "].forEach(t=>e=e.split(t).join("-")),e=e.replace(/-{2,}/,"-"))}function jN(e){return e.startsWith("(")&&e.endsWith(")")}function GN(e){if(!/^[\d-]+(\(\d\))*$/.test(e))return e;let t=Ai("-",e.split(""));if(!t.length)return e;let r=e.split("-"),i=!(r.length%2),n=!!(t.length%2);return i&&n&&t.length>r.length/2&&t.filter((e,t)=>t%2).forEach(t=>{e=e.substring(0,t)+" "+e.substring(t+1)}),e}function WN({score:e}){let t,r=e.split(""),i=[],n=()=>t=[void 0,void 0,void 0],a=()=>{let e=`${t[0]}-${t[1]}`;return t[2]&&(e+=` (${t[2]})`),n(),t.push(t),e};n();let o=()=>void 0!==t[0]&&void 0!==t[1]&&Math.abs(parseInt(t[0])-parseInt(t[1]));for(;r.length;){let e=r.shift(),n=pi(e)&&parseInt(e),s=void 0!==t[0]&&void 0!==t[1];if(pi(n)){if(void 0===t[0]){t[0]=n;continue}if(void 0===t[1]&&(t[1]=n,o())){i.push(a()),t=[void 0,void 0];continue}if(s&&1===r.length&&pi(r[0])){let e=r.pop();t[0]=t[0].toString()+t[1].toString(),t[1]=e,i.push(a()),t=[void 0,void 0]}s&&o()}}return{sets:i}}function qN(e){let t=e.indexOf("1"),r=e.split(""),i=r.every(e=>!isNaN(e));if(i&&3===e.length&&0===t){let e=$N(r,t);if(e)return e}if(i&&7===e.length&&t>3){let e=$N(r.slice(4),t-4);if(e)return`${r[0]}-${r[1]} ${r[2]}-${r[3]} ${e}`}}function HN(e){let{score:t}=e,{applied:r,matchUpStatus:i}=e,n=t?.toString().split(""),a=n?.every(e=>pi(e)),o=e=>Math.abs(e[0]-e[1]);if("number"==typeof t||a){t=t.toString().toLowerCase(),a&&(t=n.join(""));let e=a?n.map(e=>parseInt(e)):t.split("").map(e=>parseInt(e)),{sets:i}=WN({score:t});if(e.length,3===t.length&&1===o(e.slice(0,2))){let[i,n,a]=e;t=`${i}-${n}(${a})`,r.push("numericTiebreakPattern1")}else if(3===t.length&&1===e[0]){let[i,n,a]=e;t=`[${i}${n}-${a}]`,r.push("numericTiebreakPattern2")}else if(4===t.length&&1===o(e.slice(0,2))&&"987654".split("").includes(e[0].toString())){let[i,n,a,o]=e;t=`${i}-${n}(${Math.min(a,o)})`,r.push("numericTiebreakPattern3")}else if(4===t.length&&1===e[0]&&1===e[2]){let[i,n,a,o]=e;t=`[${i}${n}-${a}${o}]`,r.push("bigSuper")}else if(4===t.length){let[i,n,a,o]=e;t=`${i}${n} ${a}${o}`,r.push("split4")}else if(5===t.length&&1===o(e.slice(0,2))){let[i,n,a,o,s]=e;t=`${i}-${n}(${a}) ${o}-${s}`,r.push("numericTiebreakPattern4")}else if(5===t.length&&1===o(e.slice(3))){let[i,n,a,o,s]=e;t=`${i}-${n} ${a}-${o}(${s})`,r.push("numericTiebreakPattern5")}else if(7===e.length)if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===e[4]){let[i,n,a,o,s,c,u]=e;t=`${i}-${n} ${a}-${o} [${s}${c}-${u}]`,r.push("numericTiebreakPattern6")}else if(1===o(e.slice(0,2))&&o(e.slice(3,5))>1&&o(e.slice(5,7))>1){let[i,n,a,o,s,c,u]=e;t=`${i}-${n}(${a}) ${o}-${s} ${c}-${u}`,r.push("numericTiebreakPattern7")}else if(o(e.slice(0,2))>1&&1===o(e.slice(2,4))&&o(e.slice(5,7))>1){let[i,n,a,o,s,c,u]=e;t=`${i}-${n} ${a}-${o}(${s}) ${c}-${u}`,r.push("numericTiebreakPattern8")}else if(o(e.slice(0,2))>1&&o(e.slice(2,4))>1&&1===o(e.slice(4,6))){let[i,n,a,o,s,c,u]=e;t=`${i}-${n} ${a}-${o} ${s}-${c}(${u})`,r.push("numericTiebreakPattern9")}else t=t.slice(0,2)+" "+t.slice(2,4)+" "+t.slice(4),r.push("numericMatchTiebreakPattern");else if(t.length%2){let e=qN(t);e&&t!==e&&r.push("parsedSuperPattern"),t=e??t}else{let i=_i(t.split(""),2).map(e=>e.join("")),n=i.map(e=>{let[t,r]=e.split("").map(e=>parseInt(e)),i=t>r?1:2;return Math.abs(t-r)>1&&i||-1*i}),a=n.reduce((e,t)=>e>0&&t>0,1),o=wi(n),s=wi(n.map(e=>Math.abs(e))),c=n[0]<0,u=!c&&n[1]<0;if(n[0]>0&&n[1]>0&&n[0]!==n[1])t=[i.slice(0,2).join(" "),i.slice(2).join("-")].join(" "),r.push("numeric3rdSetTiebreakPattern");else if(a)t=i.join(" "),r.push("chunkSplit");else if(6===e.length){if(2===o[1]||2===o[2])if(Object.values(s).includes(3)){let[i,a,o,s,c,u]=e,l=n.reduce((e,t,r)=>t<0?r:e,void 0);if(0===l){t=`${i}-${a}(${Math.min(o,s)}) ${c}-${u}`,r.push("chunkSplitTiebreak1")}else if(1===l){t=`${i}-${a} ${o}-${s}(${Math.min(c,u)})`,r.push("chunkSplitTiebreak2")}else t=`${i}-${a} ${o}-${s}`,r.push("chunkSplitTrimExtraneous")}else t=i.join(" "),r.push("chunkSplit")}else if(8===e.length){let[r,i,a,o,s,l,d,p]=e;c||u?1===e[5]&&(t=c?`${r}-${i}(${a}) ${o}-${s} [${l}${d}-${p}]`:`${r}-${i} ${a}-${o}(${s}) [${l}${d}-${p}]`):(n[0],n[1])}}}return{score:t,applied:r,matchUpStatus:i}}function zN(e){let t=[0,0],r=[],i=e.split(" "),n=/(\d+)-(\d+)/;i.forEach(e=>{if(n.test(e)){let i=e.match(n).slice(1).map(e=>Number.parseInt(e)),a=i[0]>i[1]?1:i[1]>i[0]&&2;a&&(t[a-1]+=1,r.push(a))}});let a=t[0]>t[1]?1:t[1]>t[0]&&2,o=t[0]>0&&t[0]===t[1],s=t.reduce((e,t)=>e+t,0);return{setsWon:t,setsTied:o,setWinners:r,totalSets:s,winningSide:a}}var YN={handleTiebreakSlashSeparation:function({score:e}){let t=new RegExp(/\(\d+\/\d+\)/g),r=e.match(t);for(let i of r||[]){let t=i.replace("/","-");e=e.replace(i,t)}return{score:e}},handleSetSlashSeparation:function({score:e}){return new RegExp(/-\d+\/\d+-/).test(e)&&(e=e.split("/").join(" ")),{score:e}},punctuationAdjustments:function({score:e,applied:t}){e=function(e){let t="[];()",r=["[","("],i=Object.assign({},...t.split("").map(e=>({[e]:0}))),n="",a=e.split("").map(e=>{let a=t.includes(e)&&e,o=r.includes(a);if(o&&a)return i[a]+=1,n=a,e;if(!o&&a&&n&&a!==n){i[n]-=1;let e=("[];".includes(n)?"[];":"()".includes(n)&&"()")||"",t=e.split("").find(e=>e!==n);if(!e.includes(a))return i[a]||(n=""),t;i[n]||(n="")}return e}).join("");return e!==a?a:e}(e);let r=/\)(\d+)/g;if(r.test(e))for(let S of e.match(r)){let t=S.replace(")",") ");e=e.replace(S,t)}let i=/\(([\d- ]+)\)/,n=(e=(e=e.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);for(let S of n||[]){let[t]=S.match(i).slice(1),r=t.replace(/ /g,"");e=e.replace(S,`(${r})`)}let a=/\(\(\d-\d\)\)/g;if(a.test(e)){let t=e.match(a);t.length&&t.forEach(t=>{let r=t.match(/\((\(\d-\d\))\)/).slice(1)[0];e=e.replace(t,r)})}if(a=/\(\((\d)\)\)/g,a.test(e)){let t=e.match(a);t.length&&t.forEach(t=>{let r=t.match(/\((\(\d\))\)/).slice(1)[0];e=e.replace(t,r)})}/(^|\s)6-,/.test(e)&&(e=e.replace(/(^|\s)6-,/g,"6-0,"));let o=new RegExp(/[-,]{2,}/g);e=e.replace(o,"-"),["- "," -"].forEach(t=>{let r=new RegExp(`(\\d+)${t}(\\d+)`,"g"),i=e.match(r);i&&i.forEach(r=>e=e.replace(r,r.split(t).join("-")))}),/^[(-/,]+$/.test(e)&&(e=""),/\)[-/,]+$/.test(e)&&(e=e.slice(0,e.length-1)),/\d \/\d/.test(e)&&(e=e.replace(/ \//g,"/")),e.includes(" /")&&(e=e.replace(/ \//g," "));let s=/\(\d+, \)/g;s.test(e)&&e.match(s).forEach(t=>{let[r]=t.match(/\((\d+), \)/).slice(1);2===r.length?e=e.replace(t,`(${r})`):1===r.length&&"6"===r&&(e=e.replace(t,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(e)&&e.match(c).forEach(t=>{let[r]=t.match(/\((\d+)\/\)/).slice(1);e=2===r.length?e.replace(t,`(${r})`):1===r.length&&"6"===r?e.replace(t,"(6-0)"):e.replace(t,`(${r})`)});let u=/\d\/\d\/,/g;u.test(e)&&e.match(u).forEach(r=>{let[i]=r.match(/(\d\/\d)\/,/).slice(1);e=e.replace(r,`${i},`),t.push("slashComma")});let l=/\(\/(\d+)\)/g;l.test(e)&&e.match(l).forEach(t=>{let[r]=t.match(/\(\/(\d+)\)/).slice(1);e=2===r.length?e.replace(t,`(${r})`):1===r.length&&parseInt(r)<6?e.replace(t,`(6-${r})`):e.replace(t,`(${r})`)});let d,p,m,f,h,g=()=>{h=wi(e.split("")),p=h["("]===(h[")"]||0)+1,d=(h["("]||0)+1===h[")"],m=h["["]===h["]"]+1,f=p&&!m};g();let I=/(\d+-\d+\(\d+)0,/;if(I.test(e)){let[t]=e.match(I).slice(1);e=e.replace(I,t+")")}if(h["("]===h[")"]&&h["("]>1){let t=e.split(")(").join(") (").split(" ");e=t.every(jN)?t.map(e=>{let t=e.slice(1,e.length-1);return t.length>2?t:e}).join(" "):t.join(" ")}g();let y=/[A-Za-z]+/.test(e),v=/\d+/.test(e);if(!y&&!v)return{score:""};if(/^\[.+\]$/.test(e)&&"()/,- ".split("").some(e=>h[e])&&(e=e.slice(1,e.length-1)),/^\(.+\)$/.test(e)&&1===h["("]&&1===h[")"]&&"[]/,".split("").some(e=>h[e]>1)&&(e=e.slice(1,e.length-1)),e.startsWith("(")&&e.endsWith("))")&&(e=e.slice(1,e.length-1)),h["("]>(h[")"]||0)&&"("===e[e.length-1]&&(e=e.slice(0,e.length-1)+")",g()),1===h["("]&&!h[")"]&&"("===e[0]&&(e+=")",g()),h["("]>(h[")"]||0)&&"(("===e.slice(0,2)&&(e=e.slice(1)),d){if(/^9\d/.test(e))e="("+e.slice(1);else if("("!==e[0])e="("+e;else{let t=[],r=0;for(let i of e.split("").reverse())")"===i&&(r?t.push("("):r+=1),"("===i&&(r-=1),t.push(i);t.reverse(),e=t.join("")}g()}if(h[")"]>(h["("]||0)&&")"===e[0]&&(e="("+e.slice(1),g()),f&&(e.endsWith(9)||/\d+0$/.test(e))&&(e=e.slice(0,e.length-1)+")",g()),f&&(!e.endsWith(")")||e.startsWith("(("))&&(e+=")",g()),f){let t="",r=0;for(let i of e.split(""))"("===i&&(r?t+=")":r+=1),")"===i&&(r-=1),t+=i;e=t}if(g(),m&&!p&&(e+="]"),e.includes("([")&&e.includes("])")&&(e=e.split("([").join("[").split("])").join("]"),g()),/\(\d+0$/.test(e)&&(e=e.slice(0,e.length-1)+")"),g(),1===h[")"]&&!h["("]&&e.endsWith(")")&&(e=e.slice(0,e.length-1)),e.startsWith("(")&&e.endsWith(")")&&1===h["("]&&1===h[")"]&&(e=e.slice(1,e.length-1),g()),/^\([\d ]+.*[\d ]+\)$/.test(e)&&h["("]===h[")"]){let t=e.slice(1,e.length-1);(e=>{let t=e.indexOf("("),r=e.indexOf(")");return t>=0&&r>=0&&t<r})(t)&&(e=t,g())}return{score:e,applied:t}},handleGameSeparation:function({score:e}){let t=new RegExp(/^\d+\/\d+/),r=e.split(" ");r.some(e=>t.test(e))&&(e=r.map(e=>t.test(e)?e.replace("/","-"):e).join(" "));let i=/^(\d+), *(\d+)$/;if(i.test(e)){let[t,r]=e.match(i).slice(1);e=[t,r].join("-")}return{score:e}},joinFloatingTiebreak:function({score:e}){if("string"!=typeof e)return{score:e};let t=e=>e?.split("-").join("").split("/").join(""),r=e=>e.split("[").join("(").split("]").join(")"),i=(e=e.split(", ").join(" ")).split(" ");e=i.map(e=>{let t=/^-(\d+)$/;if(t.test(e)){let[r]=e.match(t).slice(1);if(2===r.length)return r.split("").join("-")}return e}).join(" "),i=e.split(" ");let n=i.filter(LN),a=0,o="";for(let p of n){let e=Ai(p,i).find(e=>!a||e>a),r=i.slice(a,e-1),n=i[e-1],s=t(n);if(/^\d+$/.test(s)&&2===s.length){let t=s.split(""),i=Math.abs(t.reduce((e,t)=>+e-+t));if(1===i){o+=[r.join(" "),[n,p].join("")].join(" "),a=e+1}else if(0===i){let i=Math.max(...t);if([4,5,6,7,8,9].includes(i)){let t=[i,[6,4].includes(i)?i+1:i-1].sort().reverse().join("-");o+=[r.join(" "),[t,p].join("")].join(" "),a=e+1}}}}if(n.length&&o.length){return o=[o,i.slice(a).join(" ")].join(" "),{score:o.trim()}}if(2===i.length&&["(","["].some(e=>i[1].includes(e))){let e=t(i[0]).split("");if(1===Math.abs(e.reduce((e,t)=>+e-+t,0)))return i[1]=r(i[1]),{score:i.join("")}}let s=i.map(e=>function(e){return/^\(\d+-\d+\)$/.test(e)||/^\[\d+-\d+\]$/.test(e)}(e)?"bracket":BN(e)&&"set");if(s.includes("set")&&s.includes("bracket")){let e,t="";return i.forEach((i,n)=>{"bracket"===s[n]&&"set"===e?(i=r(i),t+=i):t+=` ${i}`,e=s[n]}),{score:t.trim()}}i=e.split(" ");let c,u=i.map(e=>{let t=new RegExp(/^(\d+)-(\d+)$/);if(t.test(e)){let[r,i]=e.match(t).slice(1),n=Math.abs([r,i].reduce((e,t)=>+e-+t,0)),a=Math.max(r,i);if(1===n)return c="tiebreakSet",c;if(n>=2&&a>=7&&"tiebreakSet"===c)return c="tiebreak",c}}),l=Ai("tiebreak",u);if(l.length){let t="";i.forEach((e,r)=>{l.includes(r)?t+=`(${e}) `:l.includes(r+1)?t+=`${e}`:t+=`${e} `}),e=t.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(e)){let[t,r,i]=e.match(d).slice(1),n=Math.max(r,i)>=10;!BN(t)&&n&&(e=e.replace(d,`${t} [${r}-${i}]`))}return u=[],{score:e=e.split(" ").map(e=>{let t=/^\((.*)\)$/,r=t.test(e),i=(new RegExp(CN).test(e)?"super":new RegExp(AN).test(e)&&"tiebreak")||new RegExp(RN).test(e)&&"standard"||"unknown";return u.push(i),"standard"===i&&r?e.match(t)[1]:e}).join(" ")}},handleBracketSpacing:function({score:e,applied:t}){return e.includes("( ")&&(t.push("removeParenSpacingAfterOpen"),e=e.split("( ").map(e=>e.trim()).join("(")),e.includes(" )")&&(t.push("removeParenSpacingBeforeClose"),e=e.split(" )").map(e=>e.trim()).join(")")),[kN,xN].forEach(r=>{let i=e.match(r);i?.length&&(i.forEach(t=>{e=e.replace(t,t.slice(0,t.length-1)+" ")}),t.push("setsEndComma"))}),{score:e=e.split(" ").filter(Boolean).map(GN).join(" "),applied:t}},handleSpaceSeparator:function({score:e}){if(e.includes(",")){let t=e.split(",").map(e=>e.trim()),r=e=>/\d \d/.test(e);t.every(r)&&(e=t.map(e=>{let t=/\d+ \d+/g;for(let r of e.match(t)){let[t,i]=r.match(/(\d+) (\d+)/).slice(1);e=e.replace(r,`${t}-${i}`)}return e}).join(" "))}if(e.includes(" ")){let t=e.replace(/[ ,]/g,"");t.split("").every(e=>pi(e))&&4===t.length&&(e=t)}return{score:e}},separateScoreBlocks:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:{score:e=e.toLowerCase().split(" ").map(e=>{if(/^\d+$/.test(e)&&e.length>2){let r=e.indexOf("1");if(e.length%2){if(3===e.length&&0===r){let i=$N(e.split(""),r);return t.push("getSuper"),i}}else{let{score:r,applied:i}=HN({score:e,applied:[]});r!==e&&(e=r,t.push(...i))}}return e}).join(" "),applied:t}},matchKnownPatterns:function({score:e,applied:t}){for(let w of[".",","," ","/"]){let r=new RegExp(`^(\\d+)\\${w}(\\d+)$`);if(r.test(e)){let i=e.match(r).slice(1).map(e=>parseInt(e)),n=Math.abs(i[0]-i[1]);n<=10&&n>=2&&(e=e.split(w).join("-"),t.push("variedJoinerPattern"))}}e.includes(";")&&(e=e.split(";").join(" "),t.push("semicolon set separation"));let r=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(r.test(e)){let[i,n,a,o,s,c]=e.match(r).slice(1);e=e.replace(r,`${i}${n}-${a} ${o}-${s}${c}`),t.push("smashSlashPattern")}/.*\s6[/-]+$/.test(e)&&(e+="0",t.push("incompleteFinalSetPattern"));let i=/\(6,\)/g;i.test(e)&&(e=e.replace(i,"(6, 0)"),t.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{e=e.split(" ").map(e=>(n.test(e)&&(e=e.replace("("," (")),a.test(e)&&(e=e.replace(")",") ")),e)).join(" "),t.push("spaceConsiderationPatterns")});let o=GN(e);o!==e&&(e=o,t.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(e)){let[r,i,n]=e.match(s).slice(1),[a,o]=i.split("");e=`${r}-${a} ${o}-${n}`,t.push("smashSetPattern")}let c=/^(\d+)[ -](\d+)$/,u=/^([\d -]+)\/([\d -]+)$/;if(u.test(e)){let[r,i]=e.match(u).slice(1),n=r.trim(),a=i.trim();if(c.test(n)&&c.test(a)){let r=n.match(c).slice(1,3).join("-"),i=a.match(c).slice(1,3).join("-");e=`${r} ${i}`,t.push("slashSeparationPattern")}}let l=/^([\d -]+),([\d -]+)$/;if(l.test(e)){let[r,i]=e.match(l).slice(1),n=r.trim(),a=i.trim();if(c.test(n)&&c.test(a)){let r=n.match(c).slice(1,3).join("-"),i=a.match(c).slice(1,3).join("-");e=`${r} ${i}`,t.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(e)){let r=e.match(d)[0],i=r.slice(0,r.length-1).split(" ").join("-");e=e.replace(r,i),t.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(e)&&p<3;){let[r,i,n]=e.match(m).slice(1),a=i.split(""),o=`${r}-${a[0]} ${a[1]}-${n}`;e=e.replace(m,o),t.push("noSetSeparationPattern"),p+=1}let f=e.match(/(^|\s)7-6\s(\d+)\s/g);if(f?.length){let r=/(^|\s)7-6\s(\d+)\s/;f.forEach(i=>{let n=i.match(r).slice(2)[0];e=e.replace(i,`7-6(${n}) `),t.push("floatingTiebreakPattern1")})}let h=e.match(/\d \d /);h?.forEach(r=>{let i=r.slice(0,r.length-1).split(" ").join("-");e=e.replace(r,i),t.push("spaceSeparatedSetPattern1")}),h=e.match(/ \d \d$/),h?.forEach(r=>{let i=" "+r.slice(1).split(" ").join("-");e=e.replace(r,i),t.push("spaceSeparatedSetPattern2")});let g=/^\d, *\d\/\d, *\d/;if(g.test(e)){let r=e.match(g)[0],i=r.split("/").map(e=>`(${e})`).join(" ")+" ";e=e.replace(r,i),t.push("slashCommaSetPattern")}let I=/\(6-\)/g;I.test(e)&&(e=e.replace(I,"(6-0)"),t.push("missingZeroPattern2"));let y=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(y.test(e)){let r=e.match(y),i=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),n=e;r.forEach(e=>{let[t,r]=e.match(i).slice(1),a=`${t}-${r}`;n=n.replace(e,a)}),e=n,t.push("slashSetPattern")}let v=/(.*)\s(1\d)\s(\d+)$/;if(v.test(e)){let[r,i,n]=e.match(v).slice(1);r.replace(/\D/g,"").length>=4&&(e=r+` ${i}${n}`,t.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let w of e.match(S)||[]){let[r,i,n,a]=w.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[o,s]=i.split("-").map(e=>parseInt(e));1===Math.abs(o-s)&&(e=e.replace(w,`${r}${i}(${n})${a}`),t.push("spaceSeparatedSetPattern"))}let b=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let w of e.match(b)||[]){let r=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[i,n,a]=w.match(r).slice(1),[o,s]=i.split("-").map(e=>parseInt(e));1===Math.abs(o-s)&&(e=e.replace(w,`${i}(${n})${a}`),t.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let w of e.match(U)||[]){let r=/(^|\s)(\d \d)\(/,[i,n]=w.match(r).slice(1);e=e.replace(w,`${i}${n.split(" ").join("-")}(`),t.push("spacedTiebreakPattern")}return{score:e,applied:t}},removeDanglingBits:function({score:e,attributes:t}){(e.endsWith(" am")||e.endsWith(" pm"))&&(e=""),e=e.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(t=>e.endsWith(t))&&(e=e.slice(0,e.length-1));let r="()/-".split("").some(t=>e.includes(t));/ \d$/.test(e)&&r&&(t={removed:e.slice(e.length-2).trim()},e=e.slice(0,e.length-2));let i=/(.*)[A-Za-z]+$/;return i.test(e)&&(e=e.match(i).slice(1)[0].trim()),{score:e,attributes:t}},removeErroneous:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:[3,4].includes(e.length)&&qN(e)?{score:qN(e)}:{score:e=e.toLowerCase().split(" ").map(e=>{if(!/^\d+$/.test(e)||1!==e.length)return e;t.push("removeErroneous1")}).filter(Boolean).join(" "),applied:t}},handleDefaulted:function({score:e,profile:t,applied:r}){e=e?.toString().toLowerCase();let i=/^(.*\d+.*)(def|defaulted)+[A-Za-z ]*$/;if(i.test(e)){let[t]=e.match(i).slice(1);return r.push("handleDefaulted"),{score:t.trim(),matchUpStatus:"defaulted",applied:r}}let n=t?.matchUpStatuses?.defaulted,a=["dft",...Array.isArray(n)?n:[n].filter(Boolean)].find(t=>e?.endsWith(t));return a?(r.push("handleDefaulted"),{matchUpStatus:"defaulted",score:e?.replace(a,"").trim(),applied:r}):{score:e}},handleWalkover:function({score:e,applied:t}){return["walkover","wo","w/o","w-o"].includes(e?.toString().toLowerCase())?(t.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:t}):{score:e}},properTiebreak:function({score:e,matchUpStatus:t}){let r=e?.split(" ");e=r.map(e=>{if(e.endsWith("]")){let t=e.split("[");if(BN(t[0]))return t[0]+`(${t[1].slice(0,-1)})`}return e}).join(" ");let i=new RegExp(/(\([\d ]+\))/g);if(i.test(e))for(let s of e.match(i)){let t=s.replace(" ","-").match(/\((.*)\)/)?.[1];if(pi(t)&&t?.[0]>2)if([2,4].includes(t.length))t=t.split("").join("-");else if(3===t.length){let e=t.indexOf("1");t=$N(t.split(""),e)}e=e.replace(s,`(${t})`)}r=e?.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=r.length-1;e=r.map((e,r)=>{let i=[void 0,"","COMPLETED"].includes(t)||r!==a;if(n.test(e)&&i){let[t,r,i]=Array.from(e.match(n)).slice(1);return`${t}(${Math.min(r,i)})`}return e}).join(" "),r=e?.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),e=r.map(e=>{if(n.test(e)){let[t,r]=Array.from(e.match(n)).slice(1),i=t.split("");return`${i[0]}-${i[1]}(${r})`}return e}).join(" "),r=e?.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),e=r.map(e=>{if(n.test(e)){let[t,r]=Array.from(e.match(n)).slice(1);return BN(t)?`${t}(${r})`:t}return e}).join(" "),r=e?.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),e=r.map(e=>{if(n.test(e)){let[t]=e.match(n).slice(1);return`[${t<9?10:Number.parseInt(t)+2}-${t}]`}return e}).join(" ");let o=/\((\d)+0 /;if(o.test(e)){let t=e.match(o)[1];e=e.replace(o,`(${t}) `)}return{score:e}},handleNumeric:HN,handleRetired:function({score:e,profile:t,applied:r}){e=e?.toString().toLowerCase();let i=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(i.test(e)){let[t]=e.match(i).slice(1);return r.push("handleRetired"),{score:t.trim(),matchUpStatus:"retired",applied:r}}let n=t?.matchUpStatuses?.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(t=>e?.endsWith(t));return a?(r.push("handleRetired"),{matchUpStatus:"retired",score:e?.replace(a,"").trim(),applied:r}):{score:e}},containedSets:function({score:e,attributes:t,identifier:r}){if("string"!=typeof e)return{score:e,identifier:r};let i=new RegExp(/\([\d,/ ]+\)/g),n=e.match(i);for(let c of n||[]){let t=c.match(/^\((.*)\)$/)?.slice(1)?.[0],r=e.split(c)[0].split(")").reverse()[0].replace(/\D/g,"");if(2===t?.length&&r?.length>=2){let e=r.slice(r.length-2).split("").map(e=>parseInt(e));if(1===Math.abs(e[0]-e[1]))continue}let i=GN(VN(t));e=e.replace(c,`(${i})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);if(e.match(a)?.forEach(t=>{let r=VN(t.match(/^\[(.*)\]$/)[1]);e=e.replace(t,`(${r}) `).trim()}),e.startsWith("(")&&[")","]"].some(t=>e.endsWith(t))&&[")(","), (",") (",")[",") [","](","] ("].some(t=>e.includes(t))){let t="",r=e.split(/[)\]]/).filter(Boolean).map(e=>(e.startsWith(",")&&(e=e.slice(1)),e.trim())),i=r.every(e=>e.includes(",")||LN(e)),n=r.every(e=>e.includes("/")||LN(e)),a=r.every(e=>e.includes("-")||LN(e)),o=(i?",":a&&"-")||n&&"/";if(o){let i;r.forEach(e=>{if(e.startsWith("("))if("set"===i&&(t+=" "),e.includes(o))t+=e.slice(1).split(o).map(e=>e.trim()).join("-"),i="set";else{let r=e.slice(1);t+=`(${r}) `,i="tiebreak"}else if(e.startsWith("[")){let r=e.slice(1).split(o).map(e=>parseInt(e.trim())),n=Math.min(...r);t+="set"===i?`(${n}) `:`[${r.join("-")}] `,i="tiebreak"}}),e=t.trim()}}let o=wi(e.split(""));1===o["("]&&1===o[")"]&&e.startsWith("(")&&e.endsWith(")")&&(e=e.slice(1,e.length-1),1===o["-"]&&BN(e)&&pi(t?.removed)&&(e+=`(${t.removed})`,t.removed=void 0));let s=/\(\)/g;return s.test(e)&&(e=e.replace(s,"").trim()),{score:e}},sensibleSets:function({score:e,matchUpStatus:t,attributes:r}){let i,n=[],a=e.split(" "),o=a.length;e=a.map((e,r)=>{if(new RegExp(AN).test(e)){let r=e.slice(3),i=e.slice(0,3),n=i.split("-");if(!BN(i)&&!t){let e=Math.max(...n),t=[e,e-1];return i.indexOf(e)&&t.reverse(),t.join("-")+r}}else if(2===e.length&&pi(e))return e.split("").join("-");e=GN(e);let a=(new RegExp(`^${CN}$`).test(e)?"super":new RegExp(`^${AN}$`).test(e)&&"tiebreak")||new RegExp(`^${RN}$`).test(e)&&"standard"||"unknown";if(n.push(a),o>1&&"standard"===a&&r<2){let[t,n]=e.split("-"),a=Math.abs(parseInt(t)-parseInt(n)),o=Math.max(t,n),s=Math.min(t,n),c=[parseInt(t),parseInt(n)].indexOf(s);if(o>9&&a>2){let t=o.toString().split(""),n=t.find(e=>parseInt(e)>s||r&&parseInt(e)<=i)??t[0];n&&(e=c?[n,s].join("-"):[s,n].join("-"))}o>(i||0)&&(i=o)}if("standard"===a){let[r,i]=e.split("-");if(!Math.abs(parseInt(r)-parseInt(i))&&"RETIRED"!==t)return""}return e}).filter(Boolean).join(" ");let{setsWon:s,setWinners:c,totalSets:u}=zN(e);if(1===u&&"6"===r?.removed&&(e+=" 6-0"),e.split(" ").length>2&&Math.max(...s)>=2&&c[0]===c[1]&&(e=e.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let t=[0,0];e=e.split(" ").map((e,r)=>(t[c[r]]+=1,Math.max(...t)>2?void 0:e)).filter(Boolean).join(" ")}return{score:e,profile:n}},stringScore:function({score:e}){return{score:e=e?.toString().toLowerCase()||""}},superSquare:function({score:e}){let{setsTied:t,winningSide:r}=zN(e),i=/\s\((\d+)\)$/;if(!r&&t&&i.test(e)){let t=e.match(i).slice(1)[0],r=t<=8?10:t+2;e=e.replace(i,` [${r}-${t}]`)}let n=e.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:e};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(e=>pi(e)))return{score:e};if("76"===o[0]){let t=2===o[1].length?Math.min(...o[1].split("").map(e=>parseInt(e))):o[1];e=[...n.slice(0,n.length-1),`7-6(${t})`].join(" ")}else{o=o.map(e=>parseInt(e));let t=Math.max(...o),r=Math.abs(o[0]-o[1]);if(t>=10){if(r>2&&o.every(e=>+e>=10)){let e=o.map(e=>e===t?e-10:10).sort();r=Math.abs(e[0]-e[1]),r>2&&(o=e)}e=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else 3===n.length&&t>=7&&r>2&&(e=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:e}},setBuilder:WN,excisions:function({score:e}){let t=new RegExp(/^\[\d+\](.*)$/);t.test(e)&&(e=e.match(t).slice(1)[0].trim());let r=/\(,/g;return r.test(e)&&(e=e.replace(r,"(")),{score:e}},replaceOh:function({score:e,applied:t}){return"string"!=typeof e?{score:e}:(e.toLowerCase().includes("o")&&(e=e.toLowerCase().split(" ").map(e=>e.split("o").join("0")).join(" "),t.push("replaceOh")),{score:e,applied:t})}},KN={},XN=["handleNumeric","handleWalkover","handleRetired","handleDefaulted","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],QN=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function JN(e){if(!e.score)return{error:Zo};let t,r,i,{score:n,sheetName:a,identifier:o,fileName:s,stepLog:c,fullLog:u,profile:l}=e,d=[],p=[],m=n,f=e=>{e.forEach(e=>{i=YN[e]({profile:l,identifier:o,matchUpStatus:t,attributes:r,applied:p,score:m});let n=i.score!==m;n&&d.push({method:e,score:i.score}),c&&(u||n||i.matchUpStatus!==t)&&console.log(t?{score:i.score,matchUpStatus:t}:{score:i.score},e),i.matchUpStatus&&(t=i.matchUpStatus),i.attributes&&(r=i.attributes),i.applied&&(p=i.applied),m=i.score})};f(XN);let h=_N(m);return h||(m=n.toString().replaceAll(/\D/g,""),r?.removed&&(r.removed=void 0),f(QN),h=_N(m),h||(m="")),p.forEach(e=>{KN[e]||(KN[e]=0),KN[e]+=1}),{matchUpStatus:t?.toUpperCase(),modifications:d,attributes:r,isValid:h,score:m}}var ZN={};function eE(e,t,r,i,n,a,o){if(r&&i){let n=function(e,t,r,i){let n=i===r?r+1:r;return e!==n?{isValid:!1,error:`Tiebreak set winner must have ${n} games, got ${e}`}:t!==i?{isValid:!1,error:`Tiebreak set loser must have ${i} games, got ${t}`}:{isValid:!0}}(e,t,r,i);if(!n.isValid)return n}return void 0===n&&void 0===a||!o?{isValid:!0}:function(e,t,r){let i=Math.max(e||0,t||0),n=Math.min(e||0,t||0),a=i-n,o=r.tiebreakTo||7;return i<o?{isValid:!1,error:`Tiebreak winner must reach ${o} points, got ${i}`}:a<2?{isValid:!1,error:`Tiebreak must be won by 2 points, got ${i}-${n}`}:n>=o-1&&a>2?{isValid:!1,error:`Tiebreak score ${i}-${n} is invalid`}:{isValid:!0}}(n,a,o)}function tE(e,t,r,i){if(!t)return{isValid:!0};let n=Mc(t);if(!n)return{isValid:!0};let a=r&&n.finalSetFormat?n.finalSetFormat:n.setFormat;if(!a)return{isValid:!0};if(a.timed){if(!i){let t=e.side1Score??0,r=e.side2Score??0;if(0===t&&0===r)return{isValid:!1,error:"Timed set requires at least one side to have scored"};if("P"===a.based&&t===r&&t>0&&a.tiebreakFormat&&void 0===e.side1TiebreakScore&&void 0===e.side2TiebreakScore)return{isValid:!1,error:"Tied timed set requires tiebreak"}}return{isValid:!0}}let{setTo:o,tiebreakAt:s,tiebreakFormat:c,tiebreakSet:u}=a,l=u?.tiebreakTo,d=!!l&&!o,p=void 0!==e.side1TiebreakScore&&void 0!==e.side2TiebreakScore,{side1Score:m,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:g}=function(e,t,r){let i=e.side1TiebreakScore,n=e.side2TiebreakScore;return{side1Score:t&&r?i:e.side1Score||e.side1||0,side2Score:t&&r?n:e.side2Score||e.side2||0,side1TiebreakScore:i,side2TiebreakScore:n}}(e,d,p),I=Math.max(m,f),y=Math.min(m,f),v=I-y;if(d){return function(e,t,r,i,n,a=!1){return n?{isValid:!0}:0===e&&0===t?{isValid:!1,error:"Tiebreak-only set requires both scores"}:e<i?{isValid:!1,error:`Tiebreak-only set winner must reach at least ${i}, got ${e}`}:r<(a?1:2)?{isValid:!1,error:a?`Tiebreak-only set (NoAD) must be won by at least 1 point, got ${e}-${t}`:`Tiebreak-only set must be won by at least 2 points, got ${e}-${t}`}:a?{isValid:!0}:e===i&&t>i-2?{isValid:!1,error:`Tiebreak-only set at ${i}-${t} requires playing past ${i}`}:e>i&&2!==r?{isValid:!1,error:`Tiebreak-only set past ${i} must be won by exactly 2 points, got ${e}-${t}`}:{isValid:!0}}(I,y,v,l,i??!1,e.NoAD??a.tiebreakSet?.NoAD??!1)}return void 0!==h||void 0!==g||o&&I===o+1&&y===o?eE(I,y,o,s,h,g,c):function(e,t,r){let{side1:i,side2:n,winner:a,loser:o,diff:s}=e,{setTo:c,tiebreakAt:u}=t;if(c&&u){let e=function(e,t,r,i){return i?e===r+1&&t<r-1?{isValid:!1,error:`With tiebreak format, if side 1 has ${r+1} games, side 2 must be at least ${r-1}, got ${t}`}:t===r+1&&e<r-1?{isValid:!1,error:`With tiebreak format, if side 2 has ${r+1} games, side 1 must be at least ${r-1}, got ${e}`}:{isValid:!0}:{isValid:!0}}(i,n,c,u);if(!e.isValid)return e}return r?function(e,t,r){return r&&(e>r+10||t>r+10)?{isValid:!1,error:`Set score ${e}-${t} exceeds expected range for ${r}-game sets`}:{isValid:!0}}(a,o,c):c?function(e,t,r,i,n){if(e<i)return{isValid:!1,error:`Set winner must reach ${i} games, got ${e}`};let a=n&&e===i&&t===n&&1===r;if(r<2&&!a)return{isValid:!1,error:`Set must be won by at least 2 games, got ${e}-${t}`};if(n){if(t>=n&&!a)return{isValid:!1,error:`When tied at ${n}-${n}, must play tiebreak. Use format like ${n+1}-${n}(5)`};let r=n===i?i+1:i;if(e>r)return{isValid:!1,error:`With tiebreak format, set score cannot exceed ${r}-${n}. Got ${e}-${t}`}}else if(e>i+10)return{isValid:!1,error:`Set score ${e}-${t} exceeds reasonable limits`};return{isValid:!0}}(a,o,s,c,u):{isValid:!0}}({side1:m,side2:f,winner:I,loser:y,diff:v},{setTo:o,tiebreakAt:s},i)}function rE(e,t,r){if(!e||0===e.length)return{isValid:!0};let i=t?.match(/SET(\d+)/)?.[1],n=i?Number.parseInt(i):3,a=[cf,df,tf].includes(r||"");for(let o=0;o<e.length;o++){let i=e[o],s=o+1===n,c=void 0!==i.winningSide,u=tE(i,t,s,a||void 0===r&&!c);if(!u.isValid)return{isValid:!1,error:`Set ${o+1}: ${u.error}`}}return{isValid:!0}}function iE(e){return!!e?.aggregate}function nE(e,t,r,i,n,a){let o=t+1===i,{side1Score:s,side2Score:c,side1TiebreakScore:u,side2TiebreakScore:l,winningSide:d}=e,p=Math.max(s??0,c??0),m=u??l,{finalSetFormat:f,setFormat:h}=r,g=o&&f||h;return!(m&&!function(e,t,r,i,n,a){let{tiebreakTo:o,NoAD:s}=e||{},c=Math.max(t??0,r??0);return!(s&&c>o||c<o&&i&&(n&&!a||!n))}(g?.tiebreakFormat,u,l,d,n,a))&&(!g.setTo||!(!g.noTiebreak&&p>g.setTo+1))}function aE({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:r,winningSide:i,score:n}){let a=n?.sets??[],o=(a?.filter(e=>e?.winningSide)||[]).reduce((e,t)=>{let{winningSide:r}=t;return r?(e[r-1]++,e):e},[0,0]),s=i?i-1:void 0,c=void 0!==s&&[0,1].includes(s)?1-s:void 0,u=void 0!==s&&o[s],l=void 0!==c&&o[c],d=t?Mc(t):void 0,p=Math.max(...o),m=wi(o)[p],f=d?.setFormat?.timed||d?.finalSetFormat?.timed,h=d?.bestOf||d?.exactly,g=h&&Math.ceil(h/2)||1,I=r??e,y=!(!I||![tf,cf,df].includes(I)),v=!d||!a.length||a.every((e,t)=>nE(e,t,d,h??0,t===a.length-1,y)),S=d?.exactly,b=!S||!I||I!==Zm||y||a.length>=S,U=iE(d),w=U&&a.length>0?function(e){let t=e.reduce((e,t)=>((void 0!==t.side1Score||void 0!==t.side2Score)&&(e[0]+=t.side1Score??0,e[1]+=t.side2Score??0),e),[0,0]);return t[0]>t[1]?1:t[1]>t[0]?2:e.find(e=>void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore)?.winningSide}(a):function(e,t,r,i,n){return(!n||e===t)&&1===r&&i.indexOf(e)+1||void 0}(p,g,m,o,t);return{valid:!!(v&&b&&(i&&U&&i===w||i&&!U&&u>l&&i===w||i&&y||!i&&!w&&(![Zm,tf,cf,df].includes(I)||f&&I===Zm)))}}function oE({existingMatchUpStatus:e,matchUpFormat:t,matchUpStatus:r,winningSide:i,score:n}){if("object"!=typeof n)return{error:Zo};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,c="scoreString must be a string!";if(void 0!==o&&"string"!=typeof o)return{error:Zo,info:c};if(void 0!==s&&"string"!=typeof s)return{error:Zo,info:c};if(void 0!==a&&!Array.isArray(a))return{error:Zo,info:Eb("sets")};if(a?.length){let o=a.map(e=>e?.setNumber).filter(Boolean);if(o.length!==vi(o).length)return{error:Zo,info:"setNumbers not unique"};for(let e of a){let{side1Score:t,side2Score:r,side1TiebreakScore:i,side2TiebreakScore:n,side1PointScore:a,side2PointScore:o,winningSide:s,setNumber:c}=e;if(![[t,r],[i,n],[a,o]].filter(e=>e.some(e=>![void 0,null].includes(e))).every(e=>e.every(e=>gi(e))))return{error:Zo,info:"non-numeric values"};if(![c,s].filter(e=>![void 0,null].includes(e)).every(e=>gi(e)))return{error:Zo,info:"non-numeric values"};if(s&&![1,2].includes(s))return{error:Zo,info:"winningSide must be 1 or 2"}}let{valid:s}=aE({existingMatchUpStatus:e,matchUpStatus:r,matchUpFormat:t,winningSide:i,score:n});if(!s)return{error:_a,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}Br(ZN,{analyzeScore:()=>aE,analyzeSet:()=>dE,calculateMatchStatistics:()=>FP,checkScoreHasValue:()=>qy,checkSetIsComplete:()=>TN,deduceMatchUpFormat:()=>mE,enrichPointHistory:()=>_P,getEpisodes:()=>EP,getQuickStats:()=>LP,getScore:()=>TP,getScoreboard:()=>DP,getSetComplement:()=>sE,getTiebreakComplement:()=>cE,getWinner:()=>PP,isComplete:()=>NP,isValidMatchUpFormat:()=>_c,parseScoreString:()=>lE,toStatObjects:()=>jP,validateMatchUpScore:()=>rE,validateScore:()=>oE,validateSetScore:()=>tE,validateTieFormat:()=>bu});var sE=e=>{let{isSide1:t,lowValue:r,setTo:i,tiebreakAt:n,NoAD:a}=e;if(void 0===r)return!1;let o,s=Jr(r);return s?.toString().length>2&&(s=Number.parseInt(s.toString().slice(0,2))),n&&n<i&&s>n&&(s=n),o=a&&!n?s>i||s<i?i:i-1:s+1<i&&i||n&&n<i&&s===n&&i||!n&&s+2||i+1,[t?s:o,t?o:s]},cE=e=>{let{isSide1:t,lowValue:r,tiebreakTo:i,tiebreakNoAd:n}=e;if(void 0===r)return!1;let a="string"==typeof r?Number.parseInt(r):r;a?.toString().length>2&&(a=Number.parseInt(a.toString().slice(0,2))),n&&a>i-1&&(a=i-1);let o=function(e){let{lowValue:t,NoAD:r,tiebreakTo:i}=e,n=r?1:2;return t+1>=i?t+n:i}({lowValue:a,NoAD:n,tiebreakTo:i});return[t?a:o,t?o:a]};function uE(e,t){return(e>t?1:e<t&&2)||void 0}function lE({tiebreakTo:e=7,scoreString:t="",matchUpFormat:r}){let i,n=3;if(r)try{i=Mc(r);let e=/SET(\d+)/.exec(r)?.[1];n=e?Number.parseInt(e):3}catch{}return t?.split(" ").filter(Boolean).map((e,t)=>function({set:e,setNumber:t}){let r,o=/\[([^\]]+)\]/,s=/\(([^)]+)\)/.exec(e),c=o.exec(e),u=e?.startsWith("[")&&c,l=function(e,t){if(!i||!t)return!1;let r=e===n&&i.finalSetFormat?i.finalSetFormat:i.setFormat;if(!r)return!1;let a=r.tiebreakSet?.tiebreakTo,o=r.setTo;return!!a&&!o}(t,!!u),d=a(t),p=l&&1===d;if(u){r=function(e,t){return t?{side1Score:e[0],side2Score:e[1],winningSide:uE(e[0],e[1])}:{side1TiebreakScore:e[0],side2TiebreakScore:e[1],winningSide:uE(e[0],e[1])}}(c[1].split("-").map(e=>Number.parseInt(e)),l)}else r=function(e,t,r,i){let n,o,s=(t&&e.replace(t[0],"")||r&&e.replace(r[0],"")||e).split("-").map(e=>Number.parseInt(e)),c=s[0],u=s[1],l=uE(c,u);if(t&&([n,o]=function(e,t,r){let i=e[1],n=a(r),o=cE({lowValue:i,isSide1:2===t,tiebreakTo:n});return Array.isArray(o)?[o[0],o[1]]:[void 0,void 0]}(t,l,i)),r){let e=r[1].split("-").map(e=>Number.parseInt(e));n=e[0],o=e[1]}return{side1Score:c,side2Score:u,side1TiebreakScore:n,side2TiebreakScore:o,winningSide:l}}(e,s,c,t);return{side1Score:r.side1Score,side2Score:r.side2Score,side1TiebreakScore:r.side1TiebreakScore,side2TiebreakScore:r.side2TiebreakScore,winningSide:r.winningSide,setNumber:t,...p&&{NoAD:!0},...l&&{tiebreakSet:!0}}}({set:e,setNumber:t+1}));function a(t){if(!i)return e;let r=t===n&&i.finalSetFormat?i.finalSetFormat:i.setFormat;return r?.tiebreakSet?.tiebreakTo??r?.tiebreakFormat?.tiebreakTo??e}}function dE(e){let{setObject:t,matchUpScoringFormat:r}=e;if(!t)return{error:wa};let{setNumber:i}=t||{},{bestOf:n,exactly:a}=r||{},o=n||a,s=!(!i||!o||i!==o),c=s&&r?.finalSetFormat||r?.setFormat,u=!!c?.tiebreakSet,l=!!c?.timed,d=!u&&!l,p=!!(i&&o&&i<=o),m=[t?.side1Score,t?.side2Score],f=[t?.side1PointScore,t?.side2PointScore],h=[t?.side1TiebreakScore,t?.side2TiebreakScore],g=m.filter(e=>void 0!==e).length,I=f.filter(e=>void 0!==e).length,y=h.filter(e=>void 0!==e).length,v=m?.filter(e=>!isNaN(e)).length,S=h?.filter(e=>!isNaN(e)).length,{tiebreakAt:b}=c||{},U=b&&2===m.filter(e=>e>=b).length,w=U&&((m[0]>m[1]?1:m[1]>m[0]&&2)||void 0),T=!(!S||v),D=!!t?.winningSide,{error:P,result:N}=function({setObject:e,setFormat:t,sideGameScores:r,sideTiebreakScores:i}){if(!e)return{result:!1,error:wa};let n=!!t?.tiebreakSet,a=!!t?.timed;if(!t||n||a)return{result:!1,error:Zo};if(2!==r?.filter(e=>!isNaN(e)).length)return{result:!1,error:Fa};let{setTo:o,tiebreakAt:s,tiebreakFormat:c,NoAD:u}=t||{};if(!o||!r?.find(e=>e>=o))return{result:!1,error:Fa};let l=[1,2].includes(e?.winningSide);if(!e||!l)return{result:!1,error:La};let d=e?.winningSide-1,p=1-d,m=r[d],f=r[p],h=m-f;if(!(m>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&c,I=2===i?.filter(e=>!isNaN(e)).length,y=i?.[d],v=i?.[p],S=s&&2===r.filter(e=>e>=s).length;if(g){let{NoAD:e,tiebreakTo:t}=c;if(S){if(h>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!I)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(t))return{result:!1,error:{message:"tiebreakTo error"}};if(!t||!i?.find(e=>e>=t))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(m>(s<o?o:o+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!v||y<v)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let r=y-v;if(r&&v>=t-1&&r<(e?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!S)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let b=u?1:2,U=f>=o-1;return h&&U&&!S&&h<b?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:h>b&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}({sideTiebreakScores:h,sideGameScores:m,setFormat:c,setObject:t}),{error:E,result:M}=function({setObject:e,setFormat:t,sideTiebreakScores:r}){if(!e)return{result:!1,error:wa};let i=!!t?.tiebreakSet,n=!!t?.timed;if(!t||!i||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(e?.winningSide);if(!e||!a)return{result:!1,error:La};let{tiebreakSet:o}=t||{},{NoAD:s,tiebreakTo:c}=o||{};if(2!==r?.filter(e=>!isNaN(e)).length)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(c))return{result:!1,error:{message:"tiebreakTo error"}};if(!r?.find(e=>e>=c))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let u=e?.winningSide-1,l=1-u,d=r[u],p=r[l];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,f=d-p,h=p>=c-1;return f&&h&&f<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}({sideTiebreakScores:h,setObject:t,setFormat:c}),R=d&&!T&&N||u&&T&&M||l,A=p&&!(u&&!T)&&!(d&&T)&&(!D||R),C=function({matchUpScoringFormat:e,isDecidingSet:t,isTiebreakSet:r,isTimedSet:i,setObject:n}){if(!n)return;let a=DN({set:n});return TN({matchUpScoringFormat:e,set:n,isDecidingSet:t,isTiebreakSet:r,isTimedSet:i})&&a||void 0}({isTimedSet:l,matchUpScoringFormat:r,isDecidingSet:s,isTiebreakSet:T,setObject:t}),k={expectTiebreakSet:u,expectTimedSet:l,hasTiebreakCondition:U,isCompletedSet:D,isDecidingSet:s,isTiebreakSet:T,isValidSet:A,isValidSetNumber:p,isValidSetOutcome:R,leadingSide:w,setFormat:c,sideGameScores:m,sideGameScoresCount:g,sidePointScores:f,sidePointScoresCount:I,sideTiebreakScores:h,sideTiebreakScoresCount:y,winningSide:C};return void 0!==t?.winningSide&&(T?(k.isValidTiebreakSetOutcome=M,M||(k.tiebreakSetError=E)):(k.isValidStandardSetOutcome=N,N||(k.standardSetError=P))),k}var pE="SET3-S:6/TB7";function mE(e){let t,r=e.split(/[\s,]+/).filter(e=>e.length>0);if(0===r.length)return pE;t=1===r.length?1:2===r.length?3:5;for(let s of r){let e=s.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(e=>Number.parseInt(e,10))||[];if(2===e.length){let r=Math.max(...e),i=Math.min(...e);if(10===r||r>10&&r-i<=2)return`SET${t}-S:TB10`}}let i,n=null;for(let s of r)if(/\(/.test(s)){n=s;break}if(n){let e=n.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(e=>parseInt(e,10))||[];if(0===e.length)return pE;let t=Math.max(...e),r=Math.min(...e);i=t===r+1?r:t-1}else{let e=[];for(let i of r){let t=i.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(e=>parseInt(e,10))||[];t.length>0&&e.push(Math.max(...t))}if(0===e.length)return pE;let t=Math.max(...e);i=t>=6?6:t}let a,o=!1;if(r.length>=3){let e=r.at(-1);if(!e)return`SET${t}-S:${i}/TB7`;let n=e.replace(/\([^)]*\)/g,"").match(/(\d+)/g)?.map(e=>Number.parseInt(e,10))||[];if(2===n.length){let e=Math.max(...n),t=Math.min(...n);e>i+1&&e-t===2&&(o=!0)}}return a=6===i?`SET${t}-S:6/TB7`:4===i?`SET${t}-S:4/TB7`:10===i?`SET${t}-S:10/TB7`:`SET${t}-S:${i}/TB7`,o&&(a+=`-F:${i}`),a}function fE(e){let{matchUp:t,expectedScore:r}=e;if(!t)return{isValid:!1,errors:["No matchUp provided"],warnings:[],actual:{sets:[],scoreString:""},expected:{sets:r?.sets,scoreString:r?.scoreString},pointsProcessed:0,pointsRejected:0};let i=[],n=[],a=nP({matchUpFormat:t?.matchUpFormat,matchUpId:t?.matchUpId,participants:t?.sides?.map(e=>e.participant).filter(e=>void 0!==e)}),o=t?.history?.points||[];0===o.length&&n.push("No points found to validate");let s=0,c=0;for(let d of o)try{a=yP(a,{winner:d.winner,server:d.server}),s++}catch(l){c++;let e=l instanceof Error?l.message:String(l);i.push(`Point ${d.pointNumber||s+1}: ${e}`)}let u=TP(a);return r&&(r.sets&&(u.sets.length!==r.sets.length&&i.push(`Set count mismatch: expected ${r.sets.length}, got ${u.sets.length}`),r.sets.forEach((e,t)=>{let r=u.sets[t];r?(void 0!==e.side1Score&&r.side1Score!==e.side1Score&&i.push(`Set ${t+1} side1Score: expected ${e.side1Score}, got ${r.side1Score}`),void 0!==e.side2Score&&r.side2Score!==e.side2Score&&i.push(`Set ${t+1} side2Score: expected ${e.side2Score}, got ${r.side2Score}`),void 0!==e.side1TiebreakScore&&r.side1TiebreakScore!==e.side1TiebreakScore&&i.push(`Set ${t+1} side1TiebreakScore: expected ${e.side1TiebreakScore}, got ${r.side1TiebreakScore}`),void 0!==e.side2TiebreakScore&&r.side2TiebreakScore!==e.side2TiebreakScore&&i.push(`Set ${t+1} side2TiebreakScore: expected ${e.side2TiebreakScore}, got ${r.side2TiebreakScore}`)):i.push(`Missing set ${t+1}`)})),r.scoreString&&u.scoreString!==r.scoreString&&i.push(`Score string mismatch: expected "${r.scoreString}", got "${u.scoreString}"`)),{isValid:0===i.length,errors:i,warnings:n,actual:{sets:u.sets,scoreString:u.scoreString},expected:{sets:r?.sets,scoreString:r?.scoreString},pointsProcessed:s,pointsRejected:c}}function hE(e){let t=e?.side1Score||0,r=e?.side2Score||0;if(void 0!==e?.side1TiebreakScore||void 0!==e?.side2TiebreakScore){let i=e?.side1TiebreakScore||0;return t>r?`${t}-${r}(${e?.side2TiebreakScore||0})`:`${t}(${i})-${r}`}return`${t}-${r}`}function gE(e){let{points:t,matchUpFormat:r,expectedGames:i,expectedTiebreak:n}=e;return fE({matchUp:{matchUpId:"validation",matchUpFormat:r,matchUpStatus:"TO_BE_PLAYED",matchUpType:"SINGLES",sides:[{sideNumber:1},{sideNumber:2}],score:{sets:[]},history:{points:t?.map((e,t)=>({...e,pointNumber:t+1,timestamp:"",winner:e.winner,server:e.server}))}},expectedScore:{sets:[{side1Score:i?.[0],side2Score:i?.[1],side1TiebreakScore:n?.[0],side2TiebreakScore:n?.[1]}]}})}function IE(e){let t,{points:r,expectedScore:i,matchUpFormat:n,allowExtraPoints:a=!1,debug:o=!1}=e,s=[],c=[],u=[],l=!1;n?t=n:i?(t=mE(i),l=!0,o&&console.log(`Deduced format: ${t} from score: ${i}`)):(t="SET3-S:6/TB7",l=!0,c.push("No format provided, using default SET3-S:6/TB7"));let d=nP({matchUpFormat:t}),p=r?.split("").map(e=>{let t=Number.parseInt(e,10);return Number.isNaN(t)||0!==t&&1!==t?null:t}).filter(e=>null!==e);if(0===p?.length)return s.push("No valid points found in point string"),{valid:!1,errors:s,warnings:c,pointsProcessed:0,pointsRejected:[],actualScore:"0-0",matchUpFormat:t,formatDeduced:l,sets:[]};let m=0;for(let v=0;v<p?.length;v++){let e=p[v];if("COMPLETED"!==d.matchUpStatus||a)try{if(d=yP(d,{winner:e}),m++,o){let t=TP(d);console.log(`Point ${v+1}: ${e} \u2192 ${t.scoreString}`)}}catch(y){u.push(e);let t=y instanceof Error?y.message:String(y);s.push(`Point ${v+1}: ${t}`),o&&console.log(`Point ${v+1}: Error - ${t}`)}else u.push(e),o&&console.log(`Point ${v+1}: Rejected (match complete)`)}let f=TP(d),h=f.scoreString,g=f.sets.map(e=>{let t=[e.side1Score||0,e.side2Score||0],r=void 0===e.side1TiebreakScore?void 0:[e.side1TiebreakScore,e.side2TiebreakScore||0],i=`${t[0]}-${t[1]}`;return r&&(i=t[0]>t[1]?`${t[0]}-${t[1]}(${r[1]})`:`${t[0]}(${r[0]})-${t[1]}`),{games:t,tiebreak:r,scoreString:i}}),I=!0;if(i){yE(i)!==yE(h)&&(I=!1,s.push(`Score mismatch: expected "${i}", got "${h}"`))}return u.length>0&&c.push(`${u.length} excess points after match complete`),s.length>0&&(I=!1),{valid:I,errors:s,warnings:c,pointsProcessed:m,pointsRejected:u,expectedScore:i,actualScore:h,matchUpFormat:t,formatDeduced:l,sets:g}}function yE(e){return e.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}var vE={4:"Wide",5:"Body",6:"T"},SE={f:"Forehand",r:"Forehand Slice",v:"Forehand Volley",o:"Overhead Smash",u:"Forehand Drop Shot",l:"Forehand Lob",h:"Forehand Half-volley",j:"Forehand Drive Volley"},bE={b:"Backhand",s:"Backhand Slice",z:"Backhand Volley",p:"Backhand Overhead Smash",y:"Backhand Drop Shot",m:"Backhand Lob",i:"Backhand Half-volley",k:"Backhand Drive Volley"},UE={...SE,...bE,t:"Trick Shot",q:"Unknown Shot"},wE={7:"shallow",8:"deep",9:"very deep"},TE={1:1,2:2,3:3},DE={"+":"approach","-":"net","=":"baseline"},PE={n:"Net",w:"Out Wide",d:"Out Long",x:"Out Wide and Long",g:"Foot Fault",e:"Unknown","!":"Shank"};function NE(e){let t=[],r="";for(let i=0;i<e.length;i++){let n=e[i];n&&("fbrsvzouymlhijkpqt".includes(n)||"456".includes(n)?(r&&t.push(r),r=n):r+=n)}return r&&t.push(r),t}function EE(e){return e.includes("*")?"*":e.includes("#")?"#":e.includes("@")?"@":void 0}function ME(e){if(e)for(let t of Object.keys(PE))if(e.includes(t))return t}function RE(e){if(!ei(e))return{serves:[],rally:[]};let t,r,i,n=e.split("c").length-1,a=NE(e=e.split("c").join("")),o=a;for(let l=a.length-1;l>=0;l--){let e=a[l];if(e&&(r=EE(e),r)){o=a.slice(0,l+1),i=a.slice(l+1),t=e;break}}let s=function(e){let t=[];for(let r of e){if(!r)continue;let e=r[0];if(!e||!/[456]/.test(e))break;t.push(r)}return t}(o),c=s.length?o.slice(s.length):o;if(!r&&!s.length&&1===c.length){let e=c[0];e&&["S","P","Q","R"].includes(e)&&(t=e,c.length=0)}let u={serves:s,rally:c};return n&&(u.lets=n),r&&(u.terminator=r),t&&(u.result=t),u}function AE(e){let t=e.join("|"),r=CE(e[0],1);if("S"===r.winner||!e[1])return r.serve=1,r.code=t,r;let i=CE(e[1],2);return i.serve=2,i.first_serve={serves:r.serves},r.lets&&(i.first_serve.lets=r.lets),r.error&&(i.first_serve.error=r.error),r.parse_notes&&(i.first_serve.parse_notes=r.parse_notes),i.code=t,i}function CE(e,t){let r=RE(e);if(["Q","S"].includes(r.result||""))return r.winner="S",r;if(["P","R"].includes(r.result||"")||!r.terminator&&!ME(r.serves[0])&&r.serves.length>2)return r.winner="R",r;let i,n=(r.serves.length+r.rally.length)%2==0?"R":"S";if(r.rally.length>0?i=r.rally[r.rally.length-1]:r.serves.length>0&&(i=r.serves[r.serves.length-1]),!i)return{...r,winner:void 0};if(!r.rally.length){if("*"===r.terminator)r.result="Ace",r.winner="S";else if("#"===r.terminator)r.result="Serve Winner",r.winner="S";else{let e=ME(r.serves[0]);e?(r.error=PE[e],2===t&&(r.result="Double Fault",r.winner="R")):(r.parse_notes="treated as a fault",2===t&&(r.result="Double Fault",r.winner="R"))}return r}if(1===r.rally.length&&i.includes("#")){r.result="Serve Winner",r.winner="S";let e=ME(i);return e&&(r.error=PE[e]),r}return i.includes("#")?(r.result="Forced Error",r.error=PE[ME(i)],r.winner="R"===n?"S":"R"):i.includes("*")?(r.result="Winner",r.winner=n):i.includes("@")?(r.result="Unforced Error",r.error=PE[ME(i)],r.winner="R"===n?"S":"R"):ME(r.serves[0])?1===r.rally.length&&ME(i)&&(r.error=PE[ME(i)],r.winner="R"===n?"S":"R"):r.serves.length&&r.rally.length?(r.parse_notes="no terminator: receiver wins point",r.result="Unknown",r.winner="R"):1===r.rally.length&&ME(i)&&(r.error=PE[ME(i)],r.winner="R"===n?"S":"R"),r}function kE(e){if(e)for(let t of e){let e=UE[t];if(e)return e}}function xE(e,t){let r=function(e,t){return e.PtWinner===e.Svr?t:1-t}(e,t),i=e["1st"]||"",n=e["2nd"]||"";if(!i&&!n)return{winner:r,server:t,result:"Unknown"};let a=AE([i,n]),o={winner:r,server:t};a.result&&(o.result=a.result),a.serve&&(o.serve=a.serve);let s=function(e){if(e)for(let t of e){let e=vE[t];if(e)return e}}(1===a.serve?i:n);s&&(o.serveLocation=s);let c=a.rally[a.rally.length-1];if(c){let e=kE(c);e&&(o.stroke=e,Object.values(SE).includes(e)?o.hand="Forehand":Object.values(bE).includes(e)&&(o.hand="Backhand"))}let u=function(e,t,r){let i=[],n=1,a=r;if(e.length>0&&!ME(e[e.length-1])){let t=e[e.length-1],r=kE(t)||"Forehand";i.push({shotNumber:n++,player:a,stroke:r,code:t}),a=1-a}for(let o of t){let e=kE(o);if(!e)continue;let t={shotNumber:n++,player:a,stroke:e,code:o};for(let r of o){let e=TE[r];void 0!==e&&(t.direction=e)}for(let r of o){let e=wE[r];e&&(t.depth=e)}for(let r of o){let e=DE[r];e&&(t.position=e)}i.push(t),a=1-a}return i}(a.serves,a.rally,t);return u.length>0&&(o.rally=u,o.rallyLength=u.length),a.code&&(o.code=a.code),o}function OE(e){if(!e||!ei(e))return[];let t=e.trim().split("\n");if(t.length<2)return[];let r=t[0]?.split(",")||[],i=[];for(let n=1;n<t.length;n++){let e=t[n];if(!e)continue;let a=e.split(","),o={};for(let t=0;t<r.length;t++){let e=r[t];e&&(o[e]=a[t]||"")}i.push(o)}return i}function FE(e){if(!Array.isArray(e))return[];let t=new Map;for(let r of e){let e=r.match_id;t.has(e)||t.set(e,[]),t.get(e).push(r)}return Array.from(t.entries()).map(([e,t])=>({match_id:e,points:t}))}function _E(e,t={}){let r,{matchUpFormat:i,validateScore:n=!0,debug:a=!1}=t,o=[],s=[],c=function(e){let t=e?.split("-")||[];if(t.length<6)return{player1:"Player 1",player2:"Player 2"};let r=t[0],i=t[2]?.replace(/_/g," ");return{player1:t[4]?.replace(/_/g," ")||"Player 1",player2:t[5]?.replace(/_/g," ")||"Player 2",date:r,tournament:i}}(e.match_id),u=function(e){if(!e||0===e.length)return;let t=e.at(-1);if(!t)return;let r=t.Set1,i=t.Set2,n=t.Set3,a=t.Set4,o=t.Set5,s=[];return r&&s.push(`${r}-${i}`),n&&s.push(`${n}-${i||"0"}`),a&&s.push(`${a}-${i||"0"}`),o&&s.push(`${o}-${i||"0"}`),s.length>0?s.join(", "):void 0}(e.points),l=!1;i?r=i:u?(r=mE(u),l=!0,a&&console.log(`Deduced format: ${r} from score: ${u}`)):(r="SET3-S:6/TB7",l=!0,s.push("No format provided, using default SET3-S:6/TB7")),a&&(console.log(`Validating match: ${c.player1} vs ${c.player2}`),console.log(`Format: ${r}`),console.log(`Total points: ${e.points.length}`),u&&console.log(`Expected score: ${u}`));let d=nP({matchUpFormat:r,matchUpId:e.match_id});d.sides[0]&&(d.sides[0].participant={participantId:"player1",participantName:c.player1,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"}),d.sides[1]&&(d.sides[1].participant={participantId:"player2",participantName:c.player2,participantType:"INDIVIDUAL",participantRole:"COMPETITOR"});let p,m=0,f=0,h=0,g=0,I=0,y=0;for(let w=0;w<e.points?.length;w++){let t=e.points[w];if(t){p="1"===t.Svr?0:1;try{let r=xE(t,p);if(d=yP(d,{winner:r.winner,server:r.server}),d.history?.points&&d.history.points.length>0){let e=d.history.points[d.history.points.length-1];e&&(r.result&&(e.result=r.result),r.stroke&&(e.stroke=r.stroke),r.hand&&(e.hand=r.hand),r.serve&&(e.serve=r.serve),r.serveLocation&&(e.serveLocation=r.serveLocation),r.rally&&(e.rally=r.rally),r.rallyLength&&(e.rallyLength=r.rallyLength),r.code&&(e.code=r.code))}if(y++,"Ace"===r.result&&m++,"Double Fault"===r.result&&f++,"Winner"===r.result&&h++,"Unforced Error"===r.result&&g++,"Forced Error"===r.result&&I++,a&&(w<5||w===e.points.length-1)){let e=TP(d);console.log(`Point ${w+1}: ${r.result||"Rally"} \u2192 ${e.scoreString}`)}}catch(U){let e=U instanceof Error?U.message:String(U);o.push(`Point ${w+1}: ${e}`),a&&console.error(`Point ${w+1} failed:`,e)}}}let v,S=TP(d).scoreString,b="COMPLETED"===d.matchUpStatus;if(b||s.push(`Match not complete. Final score: ${S}`),n&&u){let e=LE(u),t=LE(S);v=e===t,v||o.push(`Score mismatch: expected "${u}", got "${S}"`),a&&(console.log(`Expected: ${u} \u2192 ${e}`),console.log(`Actual: ${S} \u2192 ${t}`),console.log(`Score matches: ${v}`))}return a&&(console.log(`Final score: ${S}`),console.log(`Match complete: ${b}`),console.log(`Stats: ${m} aces, ${f} DFs, ${h} winners, ${g} UEs, ${I} FEs`)),{valid:0===o.length,errors:o,warnings:s,matchUp:d,pointsProcessed:y,expectedScore:u,actualScore:S,scoreMatches:v,formatDeduced:l,aces:m,doubleFaults:f,winners:h,unforcedErrors:g,forcedErrors:I}}function LE(e){return e.replace(/\s+/g,"").replace(/,/g,", ").toLowerCase()}function BE(e){let t,{csvData:r,matchId:i,matchUpFormat:n,debug:a=!1}=e,o=[],s=[],c=[];try{t=OE(r)}catch(I){let e=I instanceof Error?I.message:String(I);return o.push(`Failed to parse CSV: ${e}`),{valid:!1,errors:o,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0}}let u=FE(t);a&&console.log(`Parsed ${t.length} points from ${u.length} matches`);let l=i?u.filter(e=>e.match_id===i):u;if(0===l.length)return o.push(i?`Match ID not found: ${i}`:"No matches found in CSV data"),{valid:!1,errors:o,warnings:s,matchesProcessed:0,pointsProcessed:0,matchUps:[],totalAces:0,totalDoubleFaults:0,totalWinners:0,totalUnforcedErrors:0,totalForcedErrors:0};let d=0,p=0,m=0,f=0,h=0,g=0;for(let y of l){let e=_E(y,{matchUpFormat:n,debug:a});e.valid||o.push(...e.errors),s.push(...e.warnings),c.push(e.matchUp),d+=e.pointsProcessed,p+=e.aces,m+=e.doubleFaults,f+=e.winners,h+=e.unforcedErrors,g+=e.forcedErrors}return{valid:0===o.length,errors:o,warnings:s,matchesProcessed:l.length,pointsProcessed:d,matchUps:c,totalAces:p,totalDoubleFaults:m,totalWinners:f,totalUnforcedErrors:h,totalForcedErrors:g}}function $E(e){return JSON.stringify(e,null,2)}function VE(e){let t=e.drawDefinition,{existingQualifyingPlaceholderStructureId:r,appliedPolicies:i,qualifyingOnly:n,drawEntries:a,structureId:o,tieFormat:s,idPrefix:c,isMock:u,event:l}=e,d=e.qualifyingProfiles,p=d?.length?DD({hasExistingDrawDefinition:!0,uuids:e.uuids,qualifyingProfiles:d,appliedPolicies:i,qualifyingOnly:n,tieFormat:s,idPrefix:c,isMock:u}):void 0;if(p?.error)return p;t.structures=t.structures?.filter(({structureId:e})=>e!==r),t.links=t.links?.filter(({source:e})=>e.structureId!==r);let{qualifiersCount:m,qualifyingDrawPositionsCount:f,qualifyingDetails:h}=p??{};f&&(p?.structures&&t.structures?.push(...p.structures),p?.links&&t.links?.push(...p.links));let g=t.structures?.find(({stage:e,stageSequence:t})=>e===El&&1===t),{qualifiersCount:I}=SS({stageSequence:1,drawDefinition:t,structureId:o,stage:El}),y=xU({qualifiersCount:Math.max(m??0,I??0),drawDefinition:t,stage:El});if(y.error||(y=kU({drawSize:f,stage:Ml,drawDefinition:t}),y.error))return y;!function({drawDefinition:e,drawEntries:t,event:r}){for(let i of(t??[]).filter(({entryStage:e})=>e===Ml)){TS({...i,entryStage:i.entryStage??El,drawDefinition:e,event:r})}}({drawDefinition:t,drawEntries:a,event:l});let v=function({mainStructure:e,qualifyingDetails:t,drawDefinition:r}){for(let i of t||[]){let{finalQualifyingRoundNumber:t,finalQualifyingStructureId:n,roundTarget:a,finishingPositions:o,linkType:s}=i,c=e&&iw({targetStructureId:e.structureId,sourceStructureId:n,sourceRoundNumber:t,finishingPositions:o,targetEntryRound:a,linkType:s})?.link;if(c?.error)return c;c&&(r.links||(r.links=[]),r.links.push(c))}return{error:void 0}}({mainStructure:g,qualifyingDetails:h,drawDefinition:t});return v.error?v:{drawDefinition:t,structureId:o}}function jE(e){let{participantIds:t}=e,r=e.drawDefinition?.entries?.filter(t=>{let r=t.entryStatus;return!e.restrictEntryStatus||wg.includes(r)}).map(Hm)??[];if(t){let e=t.filter(e=>!r?.includes(e));if(e?.length)return ac({result:{error:Ha},info:{invalidParticipantIds:e}})}else t=r;return e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>t.length-1&&(!e.enableDoubleRobin||e.roundsCount>2*(t.length-1))?{error:Zo,info:"Not enough participants for roundsCount"}:e.roundsCount&&!1!==e.restrictRoundsCount&&e.roundsCount>31?{error:Zo,info:"roundsCount must be less than 32"}:{participantIds:t}}function GE(e){let t,r=[],{roundsCount:i=1,drawDefinition:n,matchUpsCount:a,structureId:o,idPrefix:s,isMock:c,event:u}=e,l=jE(e);if(l.error)return l;for(let d of Ri(1,i+1)){let i=jD({restrictMatchUpsCount:e.restrictMatchUpsCount,ignoreLastRoundNumber:!!t,newRound:!t,drawDefinition:n,matchUpsCount:a,structureId:o,roundNumber:t,idPrefix:s,isMock:c,event:u});if(i.error)return ac({result:i,info:{iteration:d}});i.matchUps?.length&&r.push(...i.matchUps),t=(i?.roundNumber??1)+1}return{matchUps:r}}function WE({scaleType:e=Mp,scaleAccessor:t,participant:r,scaleName:i,eventType:n}){let a=(r&&Jv({scaleAttributes:{eventType:n??Ul,scaleType:e,scaleName:i},participant:r}))?.scaleItem?.scaleValue;return t&&ti(a)?a[t]:a}function qE(e){let t=function(e){return e.roundsCount&&"number"!=typeof e.roundsCount?{error:Zo,info:"roundsCount must be a number"}:"object"!=typeof e.drawDefinition||e.drawDefinition.drawType&&e.drawDefinition.drawType!==Zl?{error:tn}:Array.isArray(e.drawDefinition?.entries)||!e.participantIds||Array.isArray(e.participantIds)?{error:void 0}:{error:Zo,info:"Missing Entries"}}(e);if(t?.error)return t;let r=jE(e);if(r.error)return r;let i=function(e){if(e.structureId)return e.structureId;let t=e.drawDefinition,r=t?.structures?.filter(e=>1===e.stageSequence)?.reduce((e,t)=>{let r=t.stage&&xl[t.stage];return jg({structure:t})&&r>(xl[e?.stage]||1)?t:e},void 0),i=t?.structures?.find(e=>e.structureId===r?.structureId);return i?jg({structure:i})?{structure:i}:{error:tn}:{error:Fn}}(e);if(i.error)return i;let n,a=function(e){let{tournamentRecord:t,participantIds:r,scaleName:i,eventType:n,adHocRatings:a={}}=e,o=e.scaleAccessor??Nv[i]?.accessor,s=t.participants??[];for(let c of r??[]){let e=s?.find(e=>e.participantId===c),t=WE({scaleName:`${i}.${Np}`,participant:e,eventType:n});!t&&i&&(t=WE({scaleAccessor:o,participant:e,scaleName:i,eventType:n})),t&&!a[c]&&(a[c]=t)}return a}(e),o=e.tournamentRecord?.isMock??e.isMock,s=e.eventType??e.event?.eventType,c=[],u=[];for(let l of Ri(1,(e.roundsCount??1)+1)){let t=QD({...e,participantIds:r.participantIds,structure:i.structure,ignoreLastRoundNumber:!0,iterationMatchUps:c,adHocRatings:a,roundNumber:n,eventType:s,isMock:o});if(t.error)return t;let{matchUps:d,...p}=t;p.modifiedScaleValues&&(a=p.modifiedScaleValues),u.push({...p,iteration:l,matchUpsCount:d?.length}),n=(p?.roundNumber??1)+1,d?.length&&c.push(...d)}return{...Gi,matchUps:c,roundResults:u}}function HE(e){let{tournamentRecord:t,drawDefinition:r,structureId:i,idPrefix:n,isMock:a,event:o}=e,s=o?.entries?.filter(({entryStage:e,entryStatus:t})=>(!e||e===El)&&t&&wg.includes(t)),c=s?.map(Hm),u=s?Math.floor(s.length/2):0;if(e.automated)return function(e){let{restrictEntryStatus:t,generateMatchUps:r,structureId:i,matchUpIds:n,scaleName:a,scaleAccessor:o}=e.drawMatic??{},s=qE({...e,eventType:e.drawMatic?.eventType??e.matchUpType,generateMatchUps:r??!0,scaleAccessor:o??e.scaleAccessor,scaleName:a??e.scaleName,participantIds:e.participantIds,roundsCount:e.roundsCount,restrictEntryStatus:t,structureId:i,matchUpIds:n});return s.error?s:(s?.matchUps?.length&&fT({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:e.event,structureId:i}),{...Gi})}({...e,participantIds:c});{let s=GE({roundsCount:e.roundsCount,drawDefinition:r,matchUpsCount:u,idPrefix:n,isMock:a,event:o});if(s.error)return s;s.matchUps?.length&&fT({matchUps:s.matchUps,suppressNotifications:!0,tournamentRecord:t,drawDefinition:r,structureId:i,event:o})}return{...Gi}}function zE({sortDescending:e=!1,tournamentRecord:t,scaleAttributes:r,scaleSortMethod:i,stageSequence:n,entries:a,event:o,stage:s}){if(!t)return{error:Ji};let c=(a=a??o?.entries??[]).filter(e=>(!s||!e.entryStage||e.entryStage===s)&&(!n||!e.entryStageSequence||e.entryStageSequence===n)&&wg.includes(e.entryStatus)),u={...r};return{scaledEntries:c.map(e=>{let{participantId:i}=e,{scaleItem:n}=fS({tournamentRecord:t,scaleAttributes:r,participantId:i});return{...e,...n}}).filter(e=>{let t=e.scaleValue;return!!(i||!Number.isNaN(t)&&Number.parseFloat(t))&&t}).sort(i||(e||!1===u?.ascending?function(e,t){return l(t)-l(e)}:function(e,t){return l(e)-l(t)}))};function l(t){return Number.parseFloat(t.scaleValue||(e?-1:1e5))}}function YE(e){let t="prepareStage",{drawDefinition:r}=e,{structures:i}=Tf({stageSequence:e.stageSequence||1,roundTarget:e.roundTarget,stage:e.stage,drawDefinition:r}),n=e.preparedStructureIds||[],a=i?.find(({structureId:e})=>!n.includes(e));if(!a)return ac({result:{error:Fn},stack:t});let o=a?.structureId,{seedsCount:s,stageEntries:c,seedLimit:u}=function(e){let{seedsCount:t}=e;e.seededParticipants&&(t=e.seededParticipants.length),t>e.drawSize&&(t=e.drawSize);let r=function({entries:e,stage:t,stageSequence:r,roundTarget:i}){return e.filter(e=>{let n=lm({name:Nm,element:e})?.extension?.value;return(!e.entryStage||e.entryStage===t)&&(!r||!e.entryStageSequence||e.entryStageSequence===r)&&(!i||!n||n===i)&&Ug.includes(e.entryStatus)})}(e);t>r.length&&(t=r.length);let{seedLimit:i}=function({requireParticipantCount:e=!0,enforcePolicyLimits:t=!0,drawSizeProgression:r,participantsCount:i,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:c,seedsCount:u}){i=i??n;let l=wf({drawDefinition:o,structureId:c});if(l.error)return l;let d=l.structure;if(!d)return{error:Fn};let{positionAssignments:p}=Nf({structure:d}),m=p?.length||0;if(u>m)return{error:Pn};let f=d.structures?.length,h=gi(s?.groupSeedingThreshold)&&s?.groupSeedingThreshold,g=lb({roundRobinGroupsCount:f,drawSize:m})?.seedGroups,{seedsCount:I}=wD({policyDefinitions:a,requireParticipantCount:e,drawSizeProgression:r,participantsCount:i,drawSize:m});return I&&a?.[zp]&&u>I&&t&&(u=I),d.seedLimit=u,d.seedAssignments=Ri(1,u+1).map(e=>{let t=g?.find(t=>t.includes(e)),r=t&&Math.min(...t);return{participantId:void 0,seedNumber:e,seedValue:h&&e>=h?r:e}}),lh({drawDefinition:o,structureIds:[c]}),{...Gi,seedLimit:u}}({enforcePolicyLimits:e.enforcePolicyLimits??!0,appliedPolicies:e.appliedPolicies,participantsCount:r.length,seedingProfile:e.seedingProfile,drawDefinition:e.drawDefinition,structureId:e.structureId,seedsCount:t});return i&&i<t&&(t=i),{seedsCount:t,stageEntries:r,seedLimit:i}}({...e,structureId:o});(e.seededParticipants||e.event||e.seedingScaleName)&&function(e){let{seededParticipants:t,seedingScaleName:r,entries:i,event:n}=e,a=i.map(Hm);t?function(e){let{provisionalPositioning:t,enteredParticipantIds:r,seededParticipants:i,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:c,structure:u,event:l}=e,d=u?mb({provisionalPositioning:t,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:u}):void 0;i.filter(({participantId:e})=>r.includes(e)).filter(e=>!e.seedNumber||e.seedNumber<=i.length).sort((e,t)=>e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0).forEach(e=>{let{participantId:r,seedNumber:i,seedValue:a}=e;vb({provisionalPositioning:t,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:r,seedBlockInfo:d,structureId:c,seedNumber:i,seedValue:a,event:l})})}({...e,enteredParticipantIds:a}):(n||r)&&function(e){let t=e.seedsCount,{provisionalPositioning:r,enteredParticipantIds:i,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:c,seedingProfile:u,structureId:l,event:d}=e,{categoryName:p,ageCategoryCode:m}=d?.category||{};let f=function(e){let{tournamentRecord:t,seedingScaleName:r,stageSequence:i,entries:n,stage:a,event:o}=e,{categoryName:s,ageCategoryCode:c}=o?.category||{},u=o?.eventType,l={scaleName:r||s||c||o.eventId,scaleType:Ap,eventType:u};return zE({scaleAttributes:l,tournamentRecord:t,stageSequence:i,entries:n,stage:a}).scaledEntries}({...e})||c&&function(e){let{tournamentRecord:t,stageSequence:r,event:i,entries:n,stage:a}=e,{categoryName:o,ageCategoryCode:s}=i?.category||{},c=i?.eventType;return zE({scaleAttributes:{scaleName:o||s,scaleType:Ep,eventType:c},tournamentRecord:t,stageSequence:r,entries:n,stage:a}).scaledEntries}({...e}),h=f?.length??0;h<t&&(t=h),f?.filter(({participantId:e})=>i.includes(e)).slice(0,a||t).forEach((e,t)=>{let i=t+1,{participantId:a,scaleValue:c}=e;vb({provisionalPositioning:r,tournamentRecord:o,drawDefinition:s,seedingProfile:u,participantId:a,structureId:l,seedNumber:i,seedValue:n?.[i]||c||i,event:d})})}({...e,enteredParticipantIds:a})}({...e,seedsCount:s,structure:a,structureId:o});let l=!1!==e.automated&&e.drawType!==Zl&&!(e.qualifyingOnly&&e.stage!==Ml),d=(i?.length||0)>1,p=l?function(e){let t="object"==typeof e.automated&&e.automated.seedsOnly,r=IU({...e,seedsOnly:t});if(r.error)return r;let i=r?.positionAssignments,n=r?.positioningReport;return{conflicts:r.conflicts,positionAssignments:i,positioningReport:n}}({...e,multipleStructures:d,seedLimit:u,structureId:o}):{};return p?.error?ac({result:p,stack:t}):{...p,stageEntries:c,structureId:o,seedsCount:s}}function KE(e){let t=CD({...e,modifyOriginal:!1});if(t.error)return t;let r=t.drawDefinition,{suppressDuplicateEntries:i=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:c,drawEntries:u,placeByes:l,drawSize:d,drawType:p,entries:m}=e,f=[],h=[],g=function(e){let{ignoreStageSpace:t,drawDefinition:r,drawEntries:i,drawType:n,entries:a}=e;for(let o of a){if(i&&o.entryStage&&o.entryStage!==El)continue;let a=TS({...o,ignoreStageSpace:t??n===Zl,entryStage:o.entryStage??El,event:e.event,drawDefinition:r,drawType:n});if(i&&a.error)return a}return{error:void 0}}({ignoreStageSpace:n,drawDefinition:r,drawEntries:u,drawType:p,entries:m});if(g.error)return g;let I=p===sd?0:Jr(e.seedsCount??0),y=YE({...e,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:r,seedingProfile:s,participants:c,stage:El,seedsCount:I,placeByes:l,drawSize:d,entries:m});if(y.error&&!y.conflicts)return y;y.positioningReport?.length&&f.push({[El]:y.positioningReport});let v=y.structureId;return y.conflicts&&(h=y.conflicts),p===Zl&&e.roundsCount&&HE({...e,drawDefinition:r,structureId:v}),{drawDefinition:r,positioningReports:f,conflicts:h,structureId:v}}var XE=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]});function QE(e){let t=e.structureIds,{tournamentRecord:r,drawDefinition:i,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=e,c=Dp(e,[{[xd]:!0,[Fd]:!0}]);if(c.error)return c;if(!_c({matchUpFormat:n}))return{error:ea};if(o){let e=Aw({drawDefinition:i,matchUpId:o,event:s});if(e.error)return e;let t=e.matchUp;if(t?.matchUpType===Dl)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:fa};t&&(t.matchUpFormat=n,ch({tournamentId:r?.tournamentId,eventId:s?.eventId,context:"setMatchUpFormat",drawDefinition:i,matchUp:t}))}else if(Array.isArray(t)){if(s?.eventType===Dl)return{error:Vn};for(let e of t){let t=wf({drawDefinition:i,structureId:e});if(t.error)return t;t.structure&&(t.structure.matchUpFormat=n)}}else if(a){if(s?.eventType===Dl)return{error:Vn};let e=wf({drawDefinition:i,structureId:a});if(e.error)return e;e.structure&&(e.structure.matchUpFormat=n)}else i&&(i.matchUpFormat=n);return t=t??(a?[a]:void 0),lh({drawDefinition:i,structureIds:t}),{...Gi}}function JE({existingQualifyingStructures:e,tournamentRecord:t,drawDefinition:r,matchUpFormat:i,matchUpType:n,tieFormat:a,event:o}){if((i||a)&&!(i&&o?.matchUpFormat===i||o?.tieFormat&&a&&JSON.stringify(o.tieFormat)===JSON.stringify(a))){if(a){let t=function({tieFormat:e}){let t=bu({checkCollectionIds:!1,tieFormat:e});if(t.error)return t;for(let r of e.collectionDefinitions)r.collectionId||(r.collectionId=Ru());return{tieFormat:e}}({tieFormat:a});if(t.error)return t;let i=e?.every(e=>e.tieFormat);(!e?.length||i)&&(r.tieFormat=t.tieFormat??a)}else if(i){let e=QE({tournamentRecord:t,drawDefinition:r,matchUpFormat:i,event:o});if(e.error)return{info:"matchUpFormat or tieFormat error",error:e.error}}n&&(r.matchUpType=n)}return{error:void 0}}var ZE={};Br(ZE,{attachPolicies:()=>rT,findPolicy:()=>ig,getAppliedPolicies:()=>zh,getPolicyDefinitions:()=>Yh,mutate:()=>eM,query:()=>iM,removePolicy:()=>tM});var eM={};function tM(e){let t=Dp(e,[{[Hd]:!0,_anyOf:{[Rd]:!1,[Cd]:!1,[xd]:!1,[cp]:!1}}]);if(t.error)return t;let r,i=e.drawDefinition??e.event??((e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord);if(i)return rM(e,i);if(!e.tournamentRecords)return{error:Ji};{let t=Object.keys(e.tournamentRecords);if(!t.length)return{error:Ji};for(let i of t){let t=rM(e,e.tournamentRecords[i]);if(t.error)return t;r=!0}}return r?{...Gi}:{error:ba}}function rM(e,t){let r=zh(e).appliedPolicies??{};return r[e.policyType]?(delete r[e.policyType],Object.keys(r).length?em({element:t,extension:{name:dm,value:r}}):Jp({element:t,name:dm}),{...Gi}):{error:ba}}Br(eM,{attachPolicies:()=>rT,removePolicy:()=>tM});var iM={};Br(iM,{findPolicy:()=>ig,getAppliedPolicies:()=>zh,getPolicyDefinitions:()=>Yh});var nM={[zp]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Sd]:{positioning:jl},[vd]:{positioning:jl}},positioning:Vl},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},aM=nM;function oM({appliedPolicies:e,policyDefinitions:t,drawDefinition:r,stack:i}){if(t&&"object"!=typeof t)return ac({info:"policyDefinitions must be an object",result:{error:Zo},stack:i});let n={[qp]:e?.[qp]};return t?function({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}){for(let n of Object.keys(e))JSON.stringify(t?.[n])!==JSON.stringify(e[n])&&(r[n]=e[n]);Object.keys(r).length&&(rT({policyDefinitions:r,drawDefinition:i}),t&&Object.assign(t,r))}({policyDefinitions:t,appliedPolicies:e,policiesToAttach:n,drawDefinition:r}):n.avoidance&&rT({drawDefinition:r,policyDefinitions:n}),!e?.[zp]&&!t?.[zp]&&(rT({policyDefinitions:aM,drawDefinition:r}),e&&Object.assign(e,aM)),{error:void 0}}function sM(e){let{tournamentRecord:t,policyDefinitions:r,appliedPolicies:i,matchUpFormat:n,matchUpType:a,tieFormat:o,drawType:s,stack:c,event:u}=e,l=e.drawId?u?.drawDefinitions?.find(t=>t.drawId===e.drawId):void 0,d=l?.structures?.find(e=>e.stage===El&&1===e.stageSequence)?.structureId,p=l?l.structures?.filter(e=>e.stage===Ml):[],m=1===p?.length&&!p[0].matchUps?.length&&p[0].structureId;l&&s!==l.drawType&&(l.drawType=s);let f=l??function(e){let{drawId:t=Ru(),processCodes:r,matchUpType:i,drawType:n}=e??{},a=XE();return Object.assign(a,{processCodes:r,matchUpType:i,drawType:n,drawId:t})}({processCodes:e.processCodes,drawId:e.drawId,drawType:s}),h=JE({existingQualifyingStructures:p,tournamentRecord:t,drawDefinition:f,matchUpFormat:n,matchUpType:a,tieFormat:o,event:u});if(h.error)return ac({result:h,stack:c});let g=oM({appliedPolicies:i,policyDefinitions:r,drawDefinition:f,stack:c});return g.error?g:{drawDefinition:f,structureId:d,existingDrawDefinition:l,existingQualifyingPlaceholderStructureId:m}}var cM={};function uM(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Miro, Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}Br(cM,{addGoesTo:()=>Gy,allCompetitionMatchUps:()=>Fy,allDrawMatchUps:()=>Ly,allEventMatchUps:()=>xy,allPlayoffPositionsFilled:()=>qb,allTournamentMatchUps:()=>Oy,analyzeDraws:()=>sT,analyzeMatchUp:()=>$R,analyzeTournament:()=>DM,bulkUpdatePublishedEventIds:()=>LM,calculateWinCriteria:()=>RR,categoryCanContain:()=>vu,checkMatchUpIsComplete:()=>wy,checkValidEntries:()=>TD,compareTieFormats:()=>CM,competitionScheduleMatchUps:()=>TR,courtGridRows:()=>iR,credits:()=>uM,drawMatchUps:()=>VR,eventMatchUps:()=>bR,filterMatchUps:()=>by,filterParticipants:()=>dS,findDrawDefinition:()=>_T,findExtension:()=>lm,findVenue:()=>oy,getAggregateTeamResults:()=>wM,getAllDrawMatchUps:()=>Cy,getAllEventData:()=>BM,getAllStructureMatchUps:()=>Uy,getAllowedDrawTypes:()=>yM,getAllowedMatchUpFormats:()=>IM,getAppliedPolicies:()=>zh,getAssignedParticipantIds:()=>pv,getAvailableMatchUpsCount:()=>yT,getAvailablePlayoffProfiles:()=>bw,getCategoryAgeDetails:()=>Iu,getCheckedInParticipantIds:()=>EI,getCompetitionDateRange:()=>bM,getCompetitionMatchUps:()=>wR,getCompetitionParticipants:()=>dM,getCompetitionPenalties:()=>SM,getCompetitionVenues:()=>PT,getCourtInfo:()=>ly,getCourts:()=>GR,getDrawData:()=>kT,getDrawDefinitionTimeItem:()=>Fh,getDrawParticipantRepresentativeIds:()=>vT,getDrawStructures:()=>Tf,getDrawTypeCoercion:()=>vD,getEligibleVoluntaryConsolationParticipants:()=>IT,getEntriesAndSeedsCount:()=>aR,getEvent:()=>zR,getEventData:()=>xT,getEventMatchUpFormatTiming:()=>hR,getEventProperties:()=>qR,getEventPublishStatus:()=>iS,getEventStructures:()=>jb,getEventTimeItem:()=>_h,getEvents:()=>HR,getFlightProfile:()=>py,getHomeParticipantId:()=>AR,getLinkedTournamentIds:()=>$m,getMatchUpCompetitiveProfile:()=>Qg,getMatchUpContextIds:()=>CR,getMatchUpDailyLimits:()=>DR,getMatchUpDailyLimitsUpdate:()=>IR,getMatchUpDependencies:()=>Wy,getMatchUpFormat:()=>OR,getMatchUpFormatTiming:()=>HI,getMatchUpFormatTimingUpdate:()=>uR,getMatchUpScheduleDetails:()=>fy,getMatchUpType:()=>yy,getMatchUpsMap:()=>kg,getMatchUpsStats:()=>FR,getMatchUpsToSchedule:()=>jM,getMaxEntryPosition:()=>oR,getModifiedMatchUpFormatTiming:()=>gR,getPairedParticipant:()=>gy,getParticipantEventDetails:()=>pM,getParticipantIdFinishingPositions:()=>OT,getParticipantMembership:()=>mM,getParticipantResults:()=>Fv,getParticipantScaleItem:()=>fS,getParticipantSchedules:()=>fM,getParticipantSignInStatus:()=>hM,getParticipantTimeItem:()=>Bh,getParticipants:()=>mS,getPersonRequests:()=>QM,getPolicyDefinitions:()=>Yh,getPositionAssignments:()=>ST,getPositionsPlayedOff:()=>vw,getPredictiveAccuracy:()=>PR,getProfileRounds:()=>tR,getPublishState:()=>aS,getRandomQualifierList:()=>SD,getRoundMatchUps:()=>Lg,getRounds:()=>BR,getScaleValues:()=>kp,getScaledEntries:()=>zE,getScheduledRoundsDetails:()=>WM,getSchedulingProfile:()=>zM,getSchedulingProfileIssues:()=>XM,getSeedingThresholds:()=>db,getSeedsCount:()=>wD,getStructureSeedAssignments:()=>Mg,getTeamLineUp:()=>Iy,getTieFormat:()=>FM,getTimeItem:()=>Oh,getTournamentIds:()=>um,getTournamentInfo:()=>MT,getTournamentPenalties:()=>vM,getTournamentPersons:()=>UM,getTournamentPoints:()=>MM,getTournamentPublishStatus:()=>rS,getTournamentStructures:()=>Gb,getTournamentTimeItem:()=>Lh,getValidGroupSizes:()=>cb,getVenueData:()=>dy,getVenuesAndCourts:()=>DT,isAdHoc:()=>jg,isCompletedStructure:()=>Wb,isValidForQualifying:()=>bD,isValidMatchUpFormat:()=>_c,matchUpActions:()=>pD,participantScaleItem:()=>Jv,participantScheduledMatchUps:()=>vR,positionActions:()=>yD,publicFindCourt:()=>uy,publicFindVenue:()=>sy,tallyParticipantResults:()=>Qv,tieFormatGenderValidityCheck:()=>Ic,tournamentMatchUps:()=>UR,validMatchUp:()=>Fg,validMatchUps:()=>_g,validateCollectionDefinition:()=>Su,validateLineUp:()=>Mb});var lM={};function dM(e){let{tournamentRecords:t}=e||{};if("object"!=typeof t||!Object.keys(t).length)return{error:Qi};let r=[],i={},n={},a={},o=[],s={},c=[];for(let u of Object.values(t)){let{participantIdsWithConflicts:t,mappedMatchUps:l,participantMap:d,participants:p,matchUps:m,derivedEventInfo:f,derivedDrawInfo:h}=mS({...e,tournamentRecord:u});Object.assign(s,l),Object.assign(i,d),Object.assign(n,f),Object.assign(a,h),r.push(...p??[]),o.push(...m??[]),t?.forEach(e=>{c.includes(e)||c.push(e)})}return{participantIdsWithConflicts:c,derivedEventInfo:n,derivedDrawInfo:a,participantMap:i,mappedMatchUps:s,participants:r,...Gi,matchUps:o}}function pM({tournamentRecord:e,participantId:t}){if(!e)return{error:Ji};if(!t)return{error:Za};let r=[t].concat((e.participants??[]).filter(e=>e?.participantType&&[Ph,Dh].includes(e.participantType)&&e.individualParticipantIds?.includes(t)).map(e=>e.participantId));return{eventDetails:(e.events??[]).filter(e=>xi((e?.entries??[]).map(e=>e.participantId),r)).map(e=>({eventName:e.eventName,eventId:e.eventId}))}}function mM({tournamentRecord:e,participantId:t}){if(!e)return{error:Ji};if(!t)return{error:Za};let{participants:r}=mS({participantFilters:{participantTypes:[Ph,Dh,Th]},tournamentRecord:e});return(r??[]).filter(e=>e.individualParticipantIds?.includes(t)).reduce((e,t)=>{let r=t.participantType;return r&&(e[r]||(e[r]=[]),e[r].push(t)),e},{})}function fM({participantFilters:e={},tournamentRecord:t}){if(!t)return{error:Ji};if("object"!=typeof e)return{error:Xo,context:{participantFilters:e}};let r=Oy({tournamentRecord:t,contextFilters:{eventIds:e.eventIds}}).matchUps??[],i=Object.assign({},...r.map(e=>({[e.matchUpId]:e}))),n=r.filter(({schedule:e})=>e&&Object.keys(e).length),a=Wy({tournamentRecord:t,matchUps:r}).sourceMatchUpIds??[],o={};for(let s of n){let e,{sides:t}=s,r=t?.map(t=>{if(t.participant)return[t.participant].concat(...t.participant.individualParticipants||[]);a[s.matchUpId]&&!e&&(e=(a[s.matchUpId]||[]).map(e=>i[e]).filter(({winningSide:e,bye:t})=>!e&&!t))}).filter(Boolean).flat()??[];for(let i of r){let{participantId:e}=i;o[e]||(o[e]={potentialMatchUps:[],participant:i,matchUps:[]}),o[e].matchUps.push(s)}let n=e?.map(({sides:e})=>e).flat().map(({participant:e})=>e&&[e].concat(...e.individualParticipants||[])).filter(Boolean).flat()||[];for(let i of n){let{participantId:e}=i;o[e]||(o[e]={potentialMatchUps:[],participant:i,matchUps:[]}),o[e].potentialMatchUps.push(s)}}return{participantSchedules:Object.values(o).filter(({participant:t})=>!(e.participantIds&&!e.participantIds.includes(t.participantId)||e.participantTypes&&!e.participantTypes.includes(t.participantType))),...Gi}}function hM({tournamentRecord:e,participantId:t}){if(!e)return{error:Ji};if(!t)return{error:Za};let{participant:r}=kh({tournamentRecord:e,participantId:t});if(!r)return{error:to};let{timeItem:i}=Oh({itemType:vh,element:r});return i&&i.itemValue===bh&&bh}Br(lM,{filterParticipants:()=>dS,getCompetitionParticipants:()=>dM,getPairedParticipant:()=>gy,getParticipantEventDetails:()=>pM,getParticipantMembership:()=>mM,getParticipantScaleItem:()=>fS,getParticipantSchedules:()=>fM,getParticipantSignInStatus:()=>hM,getParticipantTimeItem:()=>Bh,getParticipants:()=>mS,getScaleValues:()=>kp,participantScaleItem:()=>Jv,validateLineUp:()=>Mb});var gM={};function IM({tournamentRecord:e,categoryName:t,categoryType:r}){if(!e)return{error:Ji};let{appliedPolicies:i}=zh({tournamentRecord:e});return(i?.[Hp]?.matchUpFormats||[]).filter(({categoryNames:e,categoryTypes:i})=>!t&&!i||t&&e?.includes(t)||r&&i?.includes(r))}function yM({tournamentRecord:e,categoryName:t,categoryType:r}){if(!e)return{error:Ji};let{appliedPolicies:i}=zh({tournamentRecord:e});return(i?.[Kp]?.allowedDrawTypes||[]).filter(({categoryNames:e,categoryTypes:i})=>!t&&!i||t&&e?.includes(t)||r&&i?.includes(r))}function vM({tournamentRecord:e}){if(!e)return{error:Ji};let t=(e?.participants??[]).reduce((e,t)=>{let{participantId:r}=t;return(t.penalties??[]).forEach(t=>{let{penaltyId:i}=t||{};e[i]?e[i].participants.push(r):e[i]={...t,participantIds:[r]}}),e},{});return{penalties:Object.values(t)}}function SM({tournamentRecords:e}){if("object"!=typeof e||!Object.keys(e).length)return{error:Qi};let t=[];for(let r of Object.values(e)){let{penalties:e}=vM({tournamentRecord:r});t.push(...e??[])}return{penalties:t}}function bM({tournamentRecords:e}){if(!ti(e))return{error:Qi};let t=Object.keys(e??{}).reduce((t,r)=>{let i=e[r],{tournamentInfo:{startDate:n,endDate:a}}=MT({tournamentRecord:i}),o=n&&iu(n),s=o&&new Date(o);(!t.startDate||s&&s<t.startDate)&&(t.startDate=s);let c=a&&iu(a),u=c&&new Date(c);return(!t.endDate||u&&u>t.endDate)&&(t.endDate=u),t},{startDate:void 0,endDate:void 0}),r=t.startDate&&iu(t.startDate.toISOString()),i=t.endDate&&iu(t.endDate.toISOString());return r&&i?{startDate:r,endDate:i}:{error:Na}}function UM({tournamentRecord:e,participantFilters:t}){if(!e)return{error:Ji};let r=e.participants||[];t&&(r=dS({participants:r,participantFilters:t,tournamentRecord:e}));let i={};return r.forEach(e=>{e.person&&(e=>{if(e.person){let{personId:t}=e.person;i[t]?i[t].participantIds.push(e.participantId):i[t]={...e.person,participantIds:[e.participantId]}}})(e)}),{tournamentPersons:Object.values(i)}}function wM(e){let t=Dp(e,[{[Cd]:!0}]);if(t.error)return t;let r=e.finishingPositionRangeBounsPoints||{},i={},n=e=>{let t=e?.individualParticipants?.map(e=>1===e.teams?.length&&e.teams[0]);return 1===e?.teams?.length&&e?.teams?.[0]||t?.[0].participantId===t?.[1].participantId&&t?.[0]},{matchUps:a,participants:o}=mS({participantFilters:{participantTypes:[wh]},withRankingProfile:!0,withStatistics:!0,...e});for(let d of o??[]){if(d.participantType===Uh)continue;"draw-0-3"===d.draws?.[0]?.drawId&&console.log(d.participantType,d.draws[0].finishingPositionRange);let e=n(d);if(e)for(let t of d?.draws??[]){let n=t?.finishingPositionRange?.join("-");if(n&&r?.[n]){let a=e?.participantId,o=t?.drawId;i[`${a}|${o}|${n}`]=r[n]}}}let s=e=>({teamName:e,standingPoints:0,pointsPlayed:0,pointsPct:0,points:0,bonus:0,diff:0,loss:0,win:0}),c=(e,t,r)=>{void 0===e[t]&&(e[t]=0),e[t]+=r},u={},l={};for(let d of a??[]){let{sides:e,matchUpFormat:t}=d,r=t&&Mc(t);if(2===e?.length&&r.setFormat?.timed&&(!r.finalSetFormat||r.finalSetFormat?.timed))for(let i of e){let e=n(i.participant),t=e?.participantId,r=i.participant?.participantId,a=e?.participantName,o=i.sideNumber,p=i.participant?.individualParticipantIds||r&&[r]||[];if(p.forEach(e=>{e&&!u[e]&&(u[e]=s(a))}),t&&o){l[t]||(l[t]=s(a));let e=[...p.map(e=>u[e]),l[t]];d.winningSide&&(o===d.winningSide?e.forEach(e=>c(e,"win",1)):e.forEach(e=>c(e,"loss",1)));let r=d.score?.sets||[];for(let t of r){let r=t?.[`side${3-o}Score`]||0,i=t?.[`side${o}Score`]||0,n=i-r;e.forEach(e=>c(e,"pointsPlayed",i+r)),e.forEach(e=>c(e,"points",i)),e.forEach(e=>c(e,"diff",n))}}}}for(let d of Object.keys(i)){let[e]=d.split("|");l[e]&&(l[e].bonus+=i[d],l[e].pointsPct=parseFloat((l[e].points/l[e].pointsPlayed).toFixed(2)),l[e].standingPoints=l[e].win+l[e].bonus)}for(let d of Object.keys(u))u[d].pointsPct=parseFloat((u[d].points/u[d].pointsPlayed).toFixed(2));return{...Gi,individualResults:u,teamResults:l}}function TM(e){let t=2===e.participants?.filter(({participantType:e})=>e===Ph)?.length,r=1===e.events?.length&&e.events[0],i=1===r?.drawDefinitions?.length&&r.drawDefinitions[0],n=2===(1===i?.structures?.length&&i.structures[0])?.positionAssignments?.length;return!!(r.tieFormat&&t&&n)}function DM({tournamentRecord:e}){if(!e)return{error:Ji};let{drawsAnalysis:t}=sT({tournamentRecord:e}),r={isDual:TM(e),drawsAnalysis:t},i=mS({tournamentRecord:e});return i.missingParticipantIds?.length&&(r.missingParticipantIds=i.missingParticipantIds),{...Gi,analysis:r}}function PM(e,t){return e&&t&&Array.isArray(t)&&t[e-1]||"object"==typeof t&&t[e]}function NM(e){let{participation:t={},awardProfiles:r,startDate:i,eventType:n,drawSize:a,drawType:o,category:s,endDate:c,level:u}=e,{participationOrder:l,flightNumber:d,rankingStage:p}=t;return{awardProfile:r.find(e=>(e=>!i&&!c||!e.dateRanges||e.dateRanges.some(e=>{let t=!i||!e.startDate||new Date(i)>new Date(e.startDate),r=!c||!e.endDate||new Date(c)<=new Date(e.endDate);return t&&r}))(e)&&(!e.maxFlightNumber||d<=e.maxFlightNumber)&&(!e.drawTypes?.length||e.drawTypes?.includes(o))&&(!e.drawSizes?.length||e.drawSizes.includes(a))&&(!e.stages?.length||e.stages.includes(p))&&(!e.levels?.length||e.levels.includes(u))&&(!e.maxDrawSize||a<=e.maxDrawSize)&&(!e.drawSize||e.drawSize===a)&&(!e.maxLevel||u<=e.maxLevel)&&(!d||!e.flights?.flightNumbers?.length||e.flights.flightNumbers.includes(d))&&(!e.participationOrder||e.participationOrder===l)&&(!e.category?.ageCategoryCodes||e.category.ageCategoryCodes.includes(s?.ageCategoryCode))&&(!e.eventTypes?.length||e.eventTypes?.includes(n)))}}function EM({participantWon:e,flightNumber:t,valueObj:r,drawSize:i,flights:n,level:a}){let o,s,c,u,l=(e,t)=>{if(e){if(Array.isArray(t)){let r=t.find(t=>t.flight===e||t.f===e);return r.value||r.v}if("object"==typeof t){let r=t.flights||t.f;if(Array.isArray(r))return r[e-1]}}},d=(e,t)=>{let r=e?.value||e?.v||(gi(e)?e:0),i=PM(a,e?.level);return{value:l(t,i)||gi(i)&&i||r}},p=0,m=(e?"won":!1===e&&"lost")||void 0;if(Array.isArray(r)){let e=r.find(e=>e.drawSize===i||e.drawSizes?.includes(i)),n=r.find(e=>e.drawSize&&e.threshold&&i>e.drawSize),a=r.find(e=>!e.drawSize&&!e.drawSizes?.length);void 0!==m&&(e=e?.[m],n=n?.[m],a=a?.[m]),s=d(e,t).value,c=d(n,t).value,u=d(a,t).value,p=s||c||u,o=s&&e.requireWin||c&&n.requireWin||a?.requireWin}else if("object"==typeof r){let e=r?.drawSizes?.[i],n=r;void 0!==m&&(e=e?.[m],n=n?.[m]),s=d(e,t).value,u=d(n,t).value,p=s||u,o=s?e.requireWin:n?.requireWin}else gi(r)&&void 0===m&&(p=r);return t&&n?.pct?.[t]&&(p=Math.round(p*n.pct[t])),{awardPoints:p,requireWin:o}}function MM({participantFilters:e,policyDefinitions:t,tournamentRecord:r,level:i}){if(!r)return{error:Ji};let{policyDefinitions:n}=Yh({policyTypes:[$p],tournamentRecord:r}),a=t?.[$p]??n?.[$p];if(!a)return{error:ga};let o=a.awardProfiles,s=a.requireWinFirstRound,c=a.requireWinForPoints,{participants:u,derivedEventInfo:l,derivedDrawInfo:d,mappedMatchUps:p}=mS({withRankingProfile:!0,participantFilters:e,tournamentRecord:r}),m=u?.filter(e=>e.draws?.length),f={},h={},g={};for(let I of m??[]){let{participantType:e,participantId:t,person:n,draws:a}=I;for(let u of a){let a,{drawId:m,structureParticipation:y,eventId:v}=u,S=l[v],b=d[m],U=b?.drawType,{category:w,eventType:T}=S||{},D=u.startDate||S.startDate||r.startDate,P=u.endDate||S.endDate||r.endDate;if((T!==Pl||t===Uh)&&o){let r,u=c,l=0,d=0,v=0;for(let n of y){let{finishingPositionRange:c,participationOrder:m,participantWon:f,flightNumber:h,rankingStage:g,winCount:y}=n;l+=y||0;let S=b?.drawSize,{awardProfile:N}=NM({awardProfiles:o,participation:n,eventType:T,startDate:D,category:w,drawSize:S,drawType:U,endDate:P,level:i});if(N){if(!S)continue;let e=Array.isArray(c)&&Math.max(...c),t=vi(c||[]).join("-"),n=e&&g!==Ml&&c?.includes(S);void 0!==N.requireWinForPoints&&(u=N.requireWinForPoints),void 0!==N.requireWinFirstRound&&(s=N.requireWinFirstRound);let a,{finishingPositionPoints:o={},finishingPositionRanges:l,finishingRound:p,pointsPerWin:I,flights:b}=N,U=Array.isArray(N.perWinPoints)?N.perWinPoints?.find(e=>e.participationOrders?.includes(m)):N.perWinPoints,w=o.participationOrders,T=0;if((!w||w.includes(m))&&l&&e){let t=l[e];t&&({awardPoints:T,requireWin:a}=EM({flightNumber:h,valueObj:t,drawSize:S,flights:b,level:i}))}if(!T&&p&&1===m&&e){let t=p[e];t&&({awardPoints:T,requireWin:a}=EM({participantWon:f,flightNumber:h,valueObj:t,drawSize:S,flights:b,level:i}))}if(n&&void 0!==s&&(u=s),void 0!==a&&(u=a),T>d&&(!u||y)&&(d=T,r=e),!T&&I&&y&&(v+=y*I,r=t),!T&&y&&U){let e=PM(i,U?.level);e?v+=y*e:U.value&&(v+=y*U.value)}}if(a=d+v,e===Uh){let e=(I.matchUps||[]).filter(({structureId:e})=>e===n.structureId);for(let{matchUpId:r}of e){let e=p[r],i=e.sides.find(e=>e.participantId===t).sideNumber;if(e.winningSice===i)for(let t of e.tieMatchUps)t.winningSide}}}if(v||d){let i={winCount:l,positionPoints:d,rangeAccessor:r,perWinPoints:v,eventType:T,drawId:m,points:a},o=n?.personId;o?(f[o]||(f[o]=[]),f[o].push(i)):e===Dh?(g[t]||(g[t]=[]),g[t].push(i)):e===Uh&&(h[t]||(h[t]=[]),h[t].push(i))}}}}return{participantsWithOutcomes:m,personPoints:f,pairPoints:g,teamPoints:h,...Gi}}Br(gM,{analyzeDraws:()=>sT,analyzeTournament:()=>DM,getAggregateTeamResults:()=>wM,getAllowedDrawTypes:()=>yM,getAllowedMatchUpFormats:()=>IM,getAppliedPolicies:()=>zh,getCompetitionDateRange:()=>bM,getCompetitionPenalties:()=>SM,getPolicyDefinitions:()=>Yh,getTournamentInfo:()=>MT,getTournamentPenalties:()=>vM,getTournamentPersons:()=>UM,getTournamentPoints:()=>MM,getTournamentStructures:()=>Gb,getTournamentTimeItem:()=>Lh});var RM={};function AM(e){if(!e)return{};let t=[],r=e.tieFormatName,i=e.collectionDefinitions?.map(e=>{let{matchUpType:r,matchUpFormat:i,matchUpCount:n,category:a,gender:o}=e;t.includes(i)||t.push(i);let s=a?.ageCategoryCode;return[n,r===qr?"D":"S",s,i,o].join(";")}).join("|");return{tieFormatName:e&&r||"UNNAMED",matchUpFormats:t,tieFormatDesc:i}}function CM({considerations:e={},descendant:t,ancestor:r}){let i={},n={},{matchUpFormats:a,tieFormatDesc:o}=AM(t),{matchUpFormats:s,tieFormatDesc:c}=AM(r),u=vi((a??[]).filter(e=>!(s??[]).includes(e)).concat((s??[]).filter(e=>!(a??[]).includes(e)))),l=!(!e?.collectionName||t.collectionDefinitions.map(({collectionName:e})=>e).join("|")===r.collectionDefinitions.map(({collectionName:e})=>e).join("|")),d=!(!e?.collectionOrder||t.collectionDefinitions.map(({collectionOrder:e})=>e).join("|")===r.collectionDefinitions.map(({collectionOrder:e})=>e).join("|")),p=Object.assign({},...(t?.collectionDefinitions||[]).map(e=>({[e.collectionId]:e}))),m=Object.assign({},...(r?.collectionDefinitions||[]).map(e=>({[e.collectionId]:e})));i.collectionIds=ki(Object.keys(p),Object.keys(m)),n.collectionIds=ki(Object.keys(m),Object.keys(p)),i.collectionsValue=kM(p),n.collectionsValue=kM(m),i.groupsCount=r?.collectionGroups?.length??(0-(t?.collectionGroups?.length??0)||0),n.groupsCount=i.groupsCount?-1*i.groupsCount:0;let f=i.collectionsValue.totalValue-n.collectionsValue.totalValue,h=i.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==i.collectionsValue.assignmentValues.length,I=n.collectionsValue.assignmentValues.some((e,t)=>{let r=i.collectionsValue.assignmentValues[t];return!r||e.valueKey!==r.valueKey||e.value!==r.value||!!Array.isArray(e.value)&&e.value.every((e,t)=>r.value[t]===e)}),y=l||d||c!==o||g||I||0!==f,v=[...n.collectionsValue.invalidValues,...i.collectionsValue.invalidValues],S=v.length&&v;return{matchUpFormatDifferences:u,matchUpCountDifference:h,descendantDifferences:i,ancestorDifferences:n,orderDifference:d,valueDifference:f,nameDifference:l,descendantDesc:o,ancestorDesc:c,...Gi,different:y,invalid:S}}function kM(e){let t=[],r=[],i=0;return{totalValue:Object.keys(e).sort(lS).reduce((n,a)=>{let o=e[a],{collectionValueProfiles:s,collectionValue:c,matchUpCount:u,matchUpValue:l,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:c,matchUpValue:l,scoreValue:d,setValue:p},f=Object.keys(m).filter(e=>![void 0,null].includes(m[e])&&(!Array.isArray(m[e])||m[e].length>0));1!==f.length&&t.push({collectionId:a});let h=f[0];if(h){let e="collectionValueProfiles"===h?Object.values(s):m[h];r.push({valueKey:h,value:e})}return i+=u,s?.length?n+s.reduce((e,t)=>e+t.value,0):u?gi(l)?n+l*u:gi(d)?n+d*u:gi(p)?n+p*u:n+c:n},0),totalMatchUps:i,invalidValues:t,assignmentValues:r}}function xM(e){Object.assign(e,{inContext:!0});let{matchUp:t,error:r}=OM(e);return{matchUp:Nu(t,!0,!0),error:r}}function OM({participantsProfile:e,afterRecoveryTimes:t,tournamentRecord:r,contextContent:i,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:c,eventId:u,drawId:l,event:d}){if(!r)return{error:Ji};if("string"!=typeof s)return{error:ua};if(!a||!d){let e=(Oy({tournamentRecord:r,nextMatchUps:o}).matchUps??[]).find(e=>e.matchUpId===s);if(!e)return{error:da};({eventId:u,drawId:l}=e),({event:d,drawDefinition:a}=my({tournamentRecord:r,eventId:u,drawId:l}))}if(!a)return{error:an};n&&!i&&(i=rg({tournamentRecord:r,contextProfile:n}));let p={surfaceCategory:d?.surfaceCategory??r.surfaceCategory,indoorOutDoor:d?.indoorOutdoor??r.indoorOutdoor,endDate:d?.endDate??r.endDate,tournamentId:r.tournamentId,eventId:u??d?.eventId,drawId:l},{participants:m=[]}=Hh({participantsProfile:e,tournamentRecord:r,contextProfile:n,inContext:c});if(o){let e=(Ly({context:c?p:void 0,participants:m,afterRecoveryTimes:t,contextContent:i,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:c,event:d}).matchUps??[]).find(e=>e.matchUpId===s);if(!e)return{error:da};let r=a?.structures?.find(t=>t.structureId===e.structureId);return{drawDefinition:a,structure:r,matchUp:e}}{let{matchUp:e,structure:r}=Aw({context:c?p:void 0,tournamentParticipants:m,afterRecoveryTimes:t,contextContent:i,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:c,event:d});return{matchUp:e,structure:r,drawDefinition:a}}}function FM({tournamentRecord:e,drawDefinition:t,structureId:r,matchUpId:i,structure:n,eventId:a,drawId:o,event:s}){if(!e)return{error:Ji};if(!(o||s||r||i))return ac({result:{error:Da},stack:"getTieFormat"});a&&!s&&(s=e.events?.find(e=>e.eventId===a));let c=xM({tournamentRecord:e,drawDefinition:t,matchUpId:i,drawId:o,event:s});if(i&&c?.error)return c;if(!t&&c?.drawDefinition&&(t=c?.drawDefinition),!(n=n??c?.structure)&&r&&!i){if(!t)return{error:wn};let e=wf({drawDefinition:t,structureId:r});if(e.error)return e;n=e.structure}let u=(n?.tieFormat||n?.tieFormatId)&&Cg({structure:n,drawDefinition:t,event:s})?.tieFormat,l=(t?.tieFormat||t?.tieFormatId)&&Cg({drawDefinition:t,event:s})?.tieFormat,d=Cg({event:s})?.tieFormat,p=Cg({matchUp:c?.matchUp,drawDefinition:t,structure:n,event:s})?.tieFormat;return{...Gi,matchUp:c?.matchUp,structureDefaultTieFormat:Vw(u),eventDefaultTieFormat:Vw(d),drawDefaultTieFormat:Vw(l),tieFormat:Vw(p),structure:n}}Br(RM,{compareTieFormats:()=>CM,getTieFormat:()=>FM,tieFormatGenderValidityCheck:()=>Ic,validateCollectionDefinition:()=>Su});var _M={};function LM({tournamentRecord:e,outcomes:t}){if(!e)return{error:Ji};if(!t?.length)return{error:Da,info:"Missing outcomes"};let r=t.reduce((e,t)=>{let{drawId:r,eventId:i}=t;return i&&r&&(e[i]?e[i].includes(r)||e[i].push(r):e[i]=[r]),e},{}),i=Object.keys(r);return{publishedEventIds:(e.events?.filter(e=>i.includes(e.eventId))).filter(e=>{let t=iS({event:e}),{drawDetails:i,drawIds:n}=t??{},{eventId:a}=e;return r[a].filter(e=>{let r=i?Object.keys(t.drawDetails).filter(e=>nS({drawId:e,drawDetails:i})):[];return n?.includes(e)||r.includes(e)}).length}).map(e=>e.eventId),eventIdPublishedDrawIdsMap:r}}function BM({tournamentRecord:e,policyDefinitions:t}){if(!e)return{error:Ji};let r=e.events||[],i=e?.participants||[],{tournamentInfo:n}=MT({tournamentRecord:e}),{venues:a}=DT({tournamentRecord:e});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:r.map(r=>{let{eventId:n}=r,a=NT({event:r}).eventInfo,o=ng({tournamentRecord:e,event:r}).scheduleTiming,s=(r.drawDefinitions||[]).map(a=>{let{drawId:s,drawName:c,matchUpFormat:u,updatedAt:l}=a,d={drawId:s,drawName:c,matchUpFormat:u,updatedAt:l},{abandonedMatchUps:p,completedMatchUps:m,upcomingMatchUps:f,pendingMatchUps:h}=ky({requireParticipants:!0,tournamentParticipants:i,context:{eventId:n},policyDefinitions:t,tournamentRecord:e,inContext:!0,scheduleTiming:o,drawDefinition:a,event:r});return{drawInfo:d,matchUps:{abandonedMatchUps:p,completedMatchUps:m,upcomingMatchUps:f,pendingMatchUps:h}}}),c=iS({event:r});return Object.assign(a,{drawsData:s,publish:c}),a})}}}Br(_M,{bulkUpdatePublishedEventIds:()=>LM,getAllEventData:()=>BM,getCourtInfo:()=>ly,getDrawData:()=>kT,getEventData:()=>xT,getEventPublishStatus:()=>iS,getPublishState:()=>aS,getTournamentPublishStatus:()=>rS,getVenueData:()=>dy});var $M={};function VM({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:t,timeAfterRecovery:r,matchUp:i}){let{individualParticipantIds:n}=Ih(i);r=r??i.schedule?.timeAfterRecovery;let a=t=>{e[t]||(e[t]=[]),e[t]=vi(e[t].concat(...n))},o=e=>{r&&(!t[e]||r>t[e])&&(t[e]=r)},s=i.winnerTo?.matchUpId||i.winnerMatchUpId;s&&(r&&o(s),a(s));let c=i.loserTo?.matchUpId||i.loserMatchUpId;c&&(r&&o(c),a(c)),i.sidesTo?.length&&i.sidesTo.forEach(({matchUpId:e})=>{e&&(r&&o(e),a(e))})}function jM(e){let t=Dp(e,[{[rp]:!0}]);if(t.error)return t;let{matchUpPotentialParticipantIds:r,dateScheduledMatchUpIds:i=[],scheduleCompletedMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,orderedMatchUpIds:s,clearDate:c,matchUps:u}=e,l=o?Object.keys(o):[],d=(s??[]).map(e=>u.find(t=>t.matchUpId===e)).filter(Boolean).filter(e=>{let t=!c&&(i.includes(e.matchUpId)||l.includes(e.matchUpId)),r=["BYE",tf,Zm,Xm,cf,df,nf,rf].includes(e?.matchUpStatus);return n||!t&&!e.winningSide&&!r}),p=r&&a?d.reduce((e,t)=>{let{drawId:i,tournamentId:n}=t;return e.matchUpMap[n]||(e.matchUpMap[n]={}),e.matchUpMap[n][i]?e.matchUpMap[n][i].push(t):e.matchUpMap[n][i]=[t],VM({matchUpPotentialParticipantIds:r,matchUpNotBeforeTimes:a,matchUp:t}),e},{matchUpMap:{}}).matchUpMap:{};return{matchUpsToSchedule:d,matchUpMap:p}}function GM({defaultRecoveryMinutes:e=0,defaultAverageMinutes:t,tournamentRecords:r,matchUpFormat:i,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:c}){if(!_c({matchUpFormat:i}))return{error:ea};let u;return Object.keys(r).filter(e=>!o||e===o).forEach(e=>{if(u)return;let t=r[e],o=c?my({tournamentRecord:t,eventId:c})?.event:void 0;return u=HI({tournamentRecord:t,matchUpFormat:i,categoryName:n,categoryType:a,eventType:s,event:o}),u?.averageMinutes||u?.recoveryMinutes}),{recoveryMinutes:u?.recoveryMinutes||e,averageMinutes:u?.averageMinutes||t,typeChangeRecoveryMinutes:u?.typeChangeRecoveryMinutes||u?.recoveryMinutes||e}}function WM(e){let t=Dp(e,[{[Sp]:{tournamentRecords:!1,tournamentRecord:!1}},{rounds:!0,[vp]:hp}]);if(t.error)return t;let{scheduleCompletedMatchUps:r,periodLength:i=30}=e,n=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{};if("object"!=typeof n)return{error:Qi};let a={},o=[],s=e.rounds.toSorted((e,t)=>(e.sortOrder??0)-(t.sortOrder??0)),c=e.containedStructureIds??Object.assign({},...Object.values(n).map(e=>gh({tournamentRecord:e}).containedStructures)),u=e.matchUps??Fy({nextMatchUps:!0,tournamentRecords:n}).matchUps,l=0,d={},p={},m={};return{scheduledRoundsDetails:s.flatMap(e=>{let t=e.periodLength||i,s=[];c?.[e.structureId]?s.push(...c[e.structureId]):s.push(e.structureId);let f=u?by({tournamentIds:[e.tournamentId],roundNumbers:[e.roundNumber],matchUpIds:e.matchUpIds,eventIds:[e.eventId],drawIds:[e.drawId],processContext:!0,structureIds:s,matchUps:u}).sort(_y):[],{segmentNumber:h,segmentsCount:g}=e.roundSegment||{};if(gi(h)&&ci(f?.length)&&ci(g)&&h>0&&h<=g&&g<f?.length&&!e.matchUpIds?.length){let e=f.length/g,t=e*(h-1);f=f.slice(t,t+e)}let I=n[e.tournamentId],y=my({drawId:e.drawId,tournamentRecord:I}).event,v=[];for(let r of f){let e=r.matchUpFormat;e&&(a[e]||(a[e]=[],a[e].push(r)),v.push(e))}for(let i of v){let{eventType:a,category:s}=y??{},{categoryName:c,ageCategoryCode:u}=s??{},{typeChangeRecoveryMinutes:h,recoveryMinutes:g,averageMinutes:I,error:v}=GM({categoryName:c??u,categoryType:s?.categoryType,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:n,matchUpFormat:i,eventType:a});if(v)return{error:v,round:e};let S=f.filter(e=>(r||!If.includes(e.matchUpStatus))&&"BYE"!==e.matchUpStatus).map(zm);return S.forEach(e=>{m[e]={typeChangeRecoveryMinutes:h,recoveryMinutes:g,averageMinutes:I},d[e]=g,p[e]=I}),o.push(...S),l=Math.max(I||0,l),{roundPeriodLength:t,recoveryMinutes:g,averageMinutes:I,matchUpIds:S,hash:`${I}|${t}`}}}),greatestAverageMinutes:l,matchUpFormatCohorts:a,recoveryMinutesMap:d,averageMinutesMap:p,orderedMatchUpIds:o,minutesMap:m,...Gi}}function qM({schedulingProfile:e,venueIds:t,eventIds:r,drawIds:i}){let n=[],a=e?.map(e=>{let a=iu(e?.scheduleDate);if(!a)return void n.push(`Invalid date: ${e?.scheduledDate}`);let o=(e?.venues||[]).map(e=>{let{rounds:a,venueId:o}=e;if(!t?.includes(o))return void n.push(`Missing venueId: ${o}`);let s=a.filter(e=>{let t=r.includes(e.eventId)&&i.includes(e.drawId);return t||n.push(`Invalid eventId: ${e.eventId} or drawId: ${e.drawId}`),t});return s.length?{venueId:o,rounds:s}:void 0}).filter(Boolean);return o.length&&a&&{...e,venues:o}}).filter(Boolean);return{updatedSchedulingProfile:a,modifications:n.length,issues:n}}function HM({tournamentRecords:e,schedulingProfile:t}){if(!t)return{valid:!0};if(!Array.isArray(t))return{valid:!1,error:Zo};let r,i,{venueIds:n,tournamentsMap:a}=function(e){let t=e?.tournamentRecords&&Object.values(e?.tournamentRecords)||[],r={},{venueIds:i,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=t.reduce((e,t)=>{let{tournamentIds:i,tournamentMap:n,structureIds:a,venueIds:o,eventIds:s,drawIds:c}=function(e){let{tournamentRecord:t={},tournamentMap:r={},requireCourts:i}=e,n=[],a=[],o=[],s=[],c=(t?.venues||[]).map(({venueId:e,courts:t})=>(!i||t?.length)&&e),u=t?.tournamentId;if(u){n.push(u),r[u]={};let e=t?.events||[];for(let t of e){let e=t.eventId;o.push(e),r[u][e]={};let i=e=>parseInt(e);for(let n of t.drawDefinitions||[]){let t=n.drawId;s.push(t),r[u][e][t]={};let{structures:o}=Tf({drawDefinition:n});for(let n of o||[]){let o=n.structureId,{matchUps:s}=Uy({structure:n}),{roundMatchUps:c}=Lg({matchUps:s}),l=c&&Object.keys(c).map(i);if(r[u][e][t][o]=l,a.push(o),n.structures?.length)for(let i of n.structures)a.push(i.structureId),r[u][e][t][i.structureId]=l}}}}return{tournamentMap:r,tournamentIds:n,structureIds:a,venueIds:c,eventIds:o,drawIds:s}}({tournamentRecord:t});return o.forEach(t=>{e.venueIds.includes(t)||e.venueIds.push(t)}),e.tournamentIds.push(...i),e.structureIds.push(...a),e.eventIds.push(...s),e.drawIds.push(...c),Object.assign(r,n),e},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:r,tournamentIds:s,structureIds:o,venueIds:i,eventIds:n,drawIds:a}}({tournamentRecords:e}),o=t.every(e=>{let{scheduleDate:t,venues:o}=e;return!!qc(t)&&o.every(e=>{let{venueId:t,rounds:o}=e;return"string"!=typeof t?(i="venueId should be a string",!1):Array.isArray(o)?n.includes(t)?!!o.every(e=>{if(!e)return i="empty round",!1;let{roundSegment:t,tournamentId:r,structureId:n,roundNumber:o,eventId:s,drawId:c}=e,u=a?.[r]?.[s]?.[c]?.[n]?.includes(o);u||(i="Invalid rounds");let{segmentNumber:l,segmentsCount:d}=t||{},p=!t||gi(l)&&ci(d)&&l<=d;return p||(i="Invalid segment"),u&&p}):(r=Ro,!1):(i="rounds should be an array",!1)})});return!o&&!r&&(r=Zo),{valid:!!o,error:r,info:i}}function zM({tournamentRecords:e,tournamentRecord:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Qi};let{extension:r}=lm({element:t,name:Rm,tournamentRecords:e,discover:!0}),i=r?.value||[];if(i.length){let{venueIds:r}=PT({requireCourts:!0,tournamentRecords:e}),{eventIds:n,drawIds:a}=jw({tournamentRecords:e}),{updatedSchedulingProfile:o,modifications:s,issues:c}=qM({schedulingProfile:i,venueIds:r,eventIds:n,drawIds:a});if(s){i=o;let r=YM({tournamentRecords:e,tournamentRecord:t,schedulingProfile:i});return r.error?r:{schedulingProfile:i,modifications:s,issues:c}}}return{schedulingProfile:i,modifications:0}}function YM({tournamentRecords:e,tournamentRecord:t,schedulingProfile:r}){let i=HM({tournamentRecords:e,schedulingProfile:r});return i.error?i:r?em({tournamentRecords:e,discover:!0,extension:{name:Rm,value:r}}):Jp({element:t,name:Rm,tournamentRecords:e,discover:!0})}function KM(e){let{tournamentRecord:t}=e,r=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!e.schedulingProfile){let{modifications:e,issues:i}=zM({tournamentRecords:r,tournamentRecord:t});return{success:!e,modifications:e,issues:i}}let{venueIds:i}=PT({tournamentRecords:r}),{eventIds:n,drawIds:a}=jw({tournamentRecords:r}),{updatedSchedulingProfile:o,modifications:s,issues:c}=qM({schedulingProfile:e.schedulingProfile,venueIds:i,eventIds:n,drawIds:a});return s?{...YM({schedulingProfile:o,tournamentRecords:r}),modifications:s,issues:c}:{...Gi,modifications:s,issues:c}}function XM(e){let{scheduleDates:t=[],tournamentRecords:r,periodLength:i=30}=e??{};if("object"!=typeof r)return{error:Zi};if(!Array.isArray(t))return{error:Zo};if(!t.every(qc))return{error:Ca};let n=[],a=0,o={},{schedulingProfile:s}=zM({tournamentRecords:r});if(!s)return{issues:n,...Gi};let{matchUps:c}=Fy({nextMatchUps:!0,tournamentRecords:r});for(let u of s){let{scheduleDate:e,venues:s=[]}=u;if(!t?.length||t.includes(e))for(let t of s||[])if(t){let{rounds:s}=t,u=[],{orderedMatchUpIds:l,scheduledRoundsDetails:d}=WM({tournamentRecords:r,periodLength:i,matchUps:c,rounds:s}),{matchUpDependencies:p}=Wy({tournamentRecords:r,matchUps:c}),m=e=>{let t;return d?.find((r,i)=>{let n=r.matchUpIds.includes(e);return n&&(t=i),n}),t};if(l?.forEach((e,t)=>{let r=Ci(l.slice(t+1),p?.[e]?.matchUpIds||[]);r.length&&u.push({matchUpId:e,shouldBeAfter:r})}),u.length){a+=u.length;let t=u.map(({matchUpId:t,shouldBeAfter:r})=>{let i=m(t),n=vi(r.map(m));return o[e]||(o[e]={}),o[e][i]||(o[e][i]=[]),n.forEach(t=>{o[e][i].includes(t)||o[e][i].push(t)}),{matchUpId:t,matchUpRoundIndex:i,earlierRoundIndices:n,shouldBeAfter:r}});n.push(...t)}}}return{issuesCount:a,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...n.map(e=>{let{matchUpId:t,shouldBeAfter:r,earlierRoundIndices:i}=e;return{[t]:{earlierRoundIndices:i,shouldBeAfter:r}}}))},roundIndexShouldBeAfter:o,...Gi}}function QM(e){let{tournamentRecords:t,requestType:r}=e,i=Dp(e,[{[Rd]:!0}]);if(i.error)return i;let n={};for(let a of Object.values(t)){let{extension:e}=lm({element:a,name:Dm}),t=e?.value||[];for(let i of t){let{personId:e,requests:t}=i||{};n[e]||(n[e]=[]);for(let i of t)r&&i.requestType!==r||n[e].push(i)}}return{personRequests:n,...Gi}}function JM(e){let{containerStructureId:t,roundSegment:r,isRoundRobin:i,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:c}=e,u=i?t:o,l=[n,s,c,u,a].join("|");return nc({structureId:u,roundSegment:r,tournamentId:n,roundNumber:a,eventId:s,drawId:c,id:l})}function ZM({round:e,matchUps:t,events:r,tournamentRecords:i}){let n=r.find(t=>t.eventId===e.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:c,ageCategoryCode:u}=o||{},l=wi(t.map(({matchUpFormat:e})=>e)),d=0;return Object.keys(l).forEach(t=>{let r=l[t],n=GM({categoryName:c||u,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:i,matchUpFormat:t,categoryType:s,eventType:a});if(n.error)return n;let o=n.averageMinutes*r;isNaN(d)||(d+=o)}),{roundMinutes:d}}function eR(e){let t=e.length,r=e.filter(({sides:e})=>e?.some(({bye:e})=>e)).length||0,i=e.filter(({winningSide:e,matchUpStatus:t})=>e||If.includes(t)).length||0,n=e.filter(({schedule:e,matchUpStatus:t})=>e?.scheduledDate&&e?.scheduledTime&&"BYE"!==t).length||0,a=t-r;return{unscheduledCount:a-n,incompleteCount:a-n,scheduledCount:n,completedCount:i,matchUpsCount:t,isScheduled:a===n,isComplete:a===i,byeCount:r}}function tR({tournamentRecords:e,schedulingProfile:t,tournamentRecord:r,withRoundId:i}){if(r&&!e){if("object"!=typeof r)return{error:Zi};e={[r.tournamentId]:r}}if(t){let r=HM({tournamentRecords:e,schedulingProfile:t});if(r.error)return r}if(!t&&e){let r=zM({tournamentRecords:e});if(r.error)return r;t=r.schedulingProfile}if(!t)return{error:as};let n={};return{profileRounds:t.map(({venues:e,scheduleDate:t})=>e.map(({rounds:e})=>e.map(e=>{let r=JM(e);return r.roundSegment?.segmentsCount&&(n[r.id]=r.roundSegment.segmentsCount),nc({id:i?r.id:void 0,scheduleDate:t,...r})}))).flat(1/0),segmentedRounds:n}}function rR({court:e,date:t}){let r=t&&e.dateAvailability?.find(e=>fu(e.date,t)),i=e.dateAvailability?.find(e=>!e.date);return r||i}function iR({courtPrefix:e="C|",minRowsCount:t,courtsData:r,scheduledDate:i}){if(!Array.isArray(r))return{error:Zo};let n=r?.reduce((e,t)=>{let r=t.matchUps||[],i=Math.max(0,...r.map(e=>e.schedule.courtOrder||0));return Math.max(i,e)},1),a=Ri(0,Math.max(t||0,n)).map(e=>({matchUps:Ri(0,r.length).map(t=>{let n=r[t],{courtId:a,venueId:o}=n;if(i){let{gridBookings:t}=function({court:e,date:t}){let r=rR({court:e,date:t}),i=new Map,n=[];return(r?.bookings||[]).forEach(e=>{if("number"==typeof e.courtOrder){let t=e.rowCount||1;for(let r=0;r<t;r++)i.set(e.courtOrder+r,e)}else n.push(e)}),{gridBookings:i,timeBookings:n}}({court:n,date:i});if(t.has(e+1)){let r=t.get(e+1);return{schedule:{courtOrder:e+1,venueId:o,courtId:a},isBlocked:!0,booking:r}}}return{schedule:{courtOrder:e+1,venueId:o,courtId:a}}})}));return r.forEach((e,t)=>{for(let r of e.matchUps){let e=r.schedule?.courtOrder;e&&(a[e-1].matchUps[t]=r)}}),{courtPrefix:e,rows:a.map((t,r)=>Object.assign({rowId:`rowId-${r+1}`},...t.matchUps.map((t,r)=>({[`${e}${r}`]:t}))))}}Br($M,{courtGridRows:()=>iR,findVenue:()=>oy,getMatchUpsToSchedule:()=>jM,getPersonRequests:()=>QM,getProfileRounds:()=>tR,getScheduledRoundsDetails:()=>WM,getSchedulingProfile:()=>zM,getSchedulingProfileIssues:()=>XM,publicFindCourt:()=>uy});var nR={};function aR({policyDefinitions:e,drawDefinition:t,drawSize:r,drawId:i,event:n,stage:a}){if(!n)return{error:jn};let{entries:o,stageEntries:s}=qS({drawDefinition:t,drawId:i,stage:a,event:n}),c=s.length,{drawSize:u}=UD({participantsCount:c}),l=wD({drawSize:r??u,participantsCount:c,policyDefinitions:e});if(l.error)return ac({result:l,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=l;return{entries:o,seedsCount:d,stageEntries:s}}function oR(e){let{entries:t=[],entryStatus:r,stage:i}=e;return Math.max(...t.filter(e=>!(i&&i!==e.entryStage||r&&e.entryStatus!==r||isNaN(e.entryPosition))).map(({entryPosition:e})=>Jr(e||0)),0)}Br(nR,{getEntriesAndSeedsCount:()=>aR,getMaxEntryPosition:()=>oR});var sR={};function cR({tournamentRecords:e,extensionName:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Qi};let r,i=[];for(let n of Object.values(e)){let{extension:e}=lm({element:n,name:t});e&&!r&&(i.push({params:{extension:e,discover:!0},method:"addExtension"}),r=!0);let a=n.events??[];for(let r of a){let{eventId:e}=r,{extension:n}=lm({name:t,element:r});n&&i.push({params:{eventId:e,extension:n},method:"addEventExtension"})}}return{methods:i}}function uR({tournamentRecords:e}){return cR({extensionName:Mm,tournamentRecords:e})}Br(sR,{allCompetitionMatchUps:()=>Fy,allDrawMatchUps:()=>Ly,allEventMatchUps:()=>xy,allTournamentMatchUps:()=>Oy,analyzeMatchUp:()=>$R,calculateWinCriteria:()=>RR,checkMatchUpIsComplete:()=>wy,competitionScheduleMatchUps:()=>TR,drawMatchUps:()=>VR,eventMatchUps:()=>bR,filterMatchUps:()=>by,getAllDrawMatchUps:()=>Cy,getAllStructureMatchUps:()=>Uy,getCheckedInParticipantIds:()=>EI,getCompetitionMatchUps:()=>wR,getEventMatchUpFormatTiming:()=>hR,getHomeParticipantId:()=>AR,getMatchUpCompetitiveProfile:()=>Qg,getMatchUpContextIds:()=>CR,getMatchUpDailyLimits:()=>DR,getMatchUpDailyLimitsUpdate:()=>IR,getMatchUpDependencies:()=>Wy,getMatchUpFormat:()=>OR,getMatchUpFormatTiming:()=>HI,getMatchUpFormatTimingUpdate:()=>uR,getMatchUpScheduleDetails:()=>fy,getMatchUpType:()=>yy,getMatchUpsStats:()=>FR,getModifiedMatchUpFormatTiming:()=>gR,getParticipantResults:()=>Fv,getPredictiveAccuracy:()=>PR,getRoundMatchUps:()=>Lg,getRounds:()=>BR,isValidMatchUpFormat:()=>_c,matchUpActions:()=>pD,participantScheduledMatchUps:()=>vR,tallyParticipantResults:()=>Qv,tournamentMatchUps:()=>UR,validMatchUp:()=>Fg,validMatchUps:()=>_g});var lR="ADULT",dR="JUNIOR",pR="WHEELCHAIR",mR={[Wp]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Hr]:30,default:60}}]},defaultDailyLimits:{[Wr]:2,[Hr]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Vu],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[pR],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[lR,pR],minutes:{default:60,[Hr]:30}},{categoryTypes:[dR],minutes:{default:60,[Hr]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[lR,pR],minutes:{default:30}},{categoryTypes:[dR],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[lR,dR],minutes:{default:30}},{categoryTypes:[pR],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},fR=mR;function hR({tournamentRecord:e,matchUpFormats:t,categoryType:r,event:i}){if(!i)return{error:jn};let n,a;if(t?.length){let e=[];n=t.map(t=>{let r="string"==typeof t?{matchUpFormat:t}:t;if(!e.includes(r?.matchUpFormat)&&_c({matchUpFormat:r?.matchUpFormat}))return e.push(r.matchUpFormat),r}).filter(Boolean)}else{let{policy:t}=ig({policyType:Hp,tournamentRecord:e,event:i});if(t?.matchUpFormats)n=t?.matchUpFormats;else{let e,t,{extension:r}=lm({name:Mm,element:i});({matchUpAverageTimes:e,matchUpRecoveryTimes:t}=r?.value?r.value:fR[Wp]),n=vi([...(e||[]).map(e=>e.matchUpFormatCodes),...(t||[]).map(e=>e.matchUpFormatCodes)].flat()).map(e=>({matchUpFormat:e})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:c}=i,u=c?.categoryName??c?.ageCategoryCode??s;return s?nc({eventMatchUpFormatTiming:n.map(({matchUpFormat:t,description:n})=>({matchUpFormat:t,description:n,...HI({tournamentRecord:e,matchUpFormat:t,categoryName:u,categoryType:r,eventType:o,event:i})})),info:a}):{error:jn}}function gR(e){let t=Dp(e,[{[Cd]:!0},{[gp]:e=>_c({matchUpFormat:e}),[yp]:ea,[Fd]:!0}]);if(t.error)return t;let{tournamentRecord:r,matchUpFormat:i,event:n}=e,{extension:a}=lm({name:Mm,element:n}),o=a?.value,{extension:s}=lm({element:r,name:Mm}),c=s?.value,u=[o?.matchUpAverageTimes&&RI({...o,matchUpFormat:i}),c?.matchUpAverageTimes&&RI({...c,matchUpFormat:i})].find(e=>e);return{matchUpFormat:i,recoveryTimes:[o?.matchUpRecoveryTimes&&AI({...o,matchUpFormat:i}),c?.matchUpRecoveryTimes&&AI({...c,matchUpFormat:i})].find(e=>e),averageTimes:u}}function IR({tournamentRecords:e}){return cR({extensionName:Em,tournamentRecords:e})}var yR=({scheduleAttributes:e=["scheduledDate","scheduledTime"],schedule:t={}})=>!!Object.keys(t).filter(t=>e.includes(t)).filter(e=>t[e]).length;function vR({scheduleAttributes:e=["scheduledDate","scheduledTime"],matchUps:t=[]}){if(!_g(t))return{error:pa};if(!Array.isArray(e))return{error:Zo};let r=t.filter(Boolean).filter(({schedule:t})=>yR({schedule:t,scheduleAttributes:e})).reduce((e,t)=>{let{schedule:r}=t,i=iu(r?.scheduledDate),n=ru(r?.scheduledTime);return i&&n&&(e[i]?e[i].push(t):e[i]=[t]),e},{});return Object.keys(r).forEach(e=>{r[e].sort((e,t)=>su(ru(e.schedule?.scheduledTime),ru(t.schedule?.scheduledTime)))}),{...Gi,scheduledMatchUps:r}}function SR({schedulingProfile:e,matchUps:t=[]}){let r={},i=({eventId:e,drawId:t,structureId:r,roundNumber:i})=>`${e}|${t}|${r}${i}`;e?.length&&e.flatMap(({venues:e})=>e.map(({rounds:e})=>e)).forEach(e=>{e.sort((e,t)=>(e.sortOrder||0)-(t.sortOrder||0)).forEach(({eventId:e,drawId:t,structureId:n,roundNumber:a},o)=>{let s=i({eventId:e,drawId:t,structureId:n,roundNumber:a});r[s]=o})});let n=[],a={noScheduledDate:[]};for(let s of t){let e=s.schedule||{},t=e.scheduledDate&&iu(e.scheduledDate)||e.scheduledTime&&iu(e.scheduledTime)||"noScheduledDate";a[t]||(a[t]=[]),a[t].push(s)}let o=Object.keys(a).sort((e,t)=>e.localeCompare(t));for(let s of o){let e=a[s],t={noScheduledTime:[]};for(let r of e){let e=r.schedule||{},i=e.scheduledTime&&ru(e.scheduledTime)||"noScheduledTime";t[i]||(t[i]=[]),t[i].push(r)}for(let r of Object.keys(t)){let e=t[r].sort((e,t)=>(e.roundNumber||0)-(t.roundNumber||0));t[r]=e}let o=Object.keys(t).sort((e,t)=>e.localeCompare(t));for(let a of o){let e=t[a];e.sort((e,t)=>(r[i(e)]||0)-(r[i(t)]||0)),n.push(...e)}}return n}function bR(e){let{participants:t,contextContent:r,participantMap:i}=e,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,useParticipantMap:u,tournamentRecord:l,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:f,nextMatchUps:h,tournamentId:g,inContext:I,context:y,event:v}=e;if(!v)return{error:jn};let S,{eventId:b,eventName:U,endDate:w,eventType:T,category:D,gender:P}=v??{},N={...y,...nc({surfaceCategory:v.surfaceCategory??l?.surfaceCategory,indoorOutDoor:v.indoorOutdoor??l?.indoorOutdoor,tournamentId:g??l?.tournamentId,endDate:w??l?.endDate,eventName:U,eventType:T,category:D,eventId:b,gender:P})};!t&&l&&({participants:t,participantMap:i,groupInfo:S}=Hh({participantsProfile:o,useParticipantMap:u,tournamentRecord:l,contextProfile:f,inContext:I})),f&&!r&&(r=rg({policyDefinitions:c,tournamentRecord:l,contextProfile:f,event:v}));let E=iS({event:v});return{...(v.drawDefinitions??[]).reduce((u,g)=>{let y=ky({hydrateParticipants:e.hydrateParticipants,context:N,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:t,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:c,tournamentRecord:l,usePublishState:d,contextContent:r,contextFilters:p,matchUpFilters:m,participantMap:i,publishStatus:E,contextProfile:f,drawDefinition:g,nextMatchUps:h,inContext:I,event:v});return Object.keys(y)?.forEach(e=>{Array.isArray(y[e])&&(u[e]||(u[e]=[]),u[e]=u[e].concat(y[e]))}),u},{}),...Gi,groupInfo:S}}function UR(e){if(!e?.tournamentRecord)return{error:Ji};let t=e.contextContent,{scheduleVisibilityFilters:r,participantsProfile:i,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:c,contextFilters:u,matchUpFilters:l,contextProfile:d,nextMatchUps:p,context:m}=e,f=e.tournamentId??o.tournamentId,h=o?.events??[],{participants:g,participantMap:I,groupInfo:y}=Hh({participantsProfile:i,tournamentRecord:o,contextProfile:d,inContext:s});d&&!t&&(t=rg({policyDefinitions:a,tournamentRecord:o,contextProfile:d}));let{appliedPolicies:v}=zh({tournamentRecord:o}),S=u?.eventIds??[];return{...h.filter(e=>!S.includes(e.eventId)).map(h=>{let y={eventDrawsCount:py({event:h}).flightProfile?.flights?.length||h.drawDefinitions?.length||0,...m};return bR({hydrateParticipants:e.hydrateParticipants,context:y,tournamentAppliedPolicies:v,scheduleVisibilityFilters:r,participantsProfile:i,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:c,contextFilters:u,contextProfile:d,contextContent:t,matchUpFilters:l,participantMap:I,participants:g,tournamentId:f,nextMatchUps:p,inContext:s,event:h})}).reduce((e,t)=>((t&&Object.keys(t).filter(e=>!["success","matchUpsMap"].includes(e)))?.forEach(r=>{Array.isArray(t[r])&&(e[r]||(e[r]=[]),e[r]=e[r].concat(t[r]),void 0!==e.matchUpsCount?e.matchUpsCount+=t[r].length:e.matchUpsCount=t[r].length)}),e),{matchUpsCount:0}),groupInfo:y,participants:g}}function wR({scheduleVisibilityFilters:e,hydrateParticipants:t,participantsProfile:r,tournamentRecords:i,useParticipantMap:n,policyDefinitions:a,usePublishState:o,matchUpFilters:s,contextFilters:c,nextMatchUps:u,inContext:l}){if("object"!=typeof i||!Object.keys(i).length)return{error:Qi};let d=Object.keys(i).map(n=>{let d=i[n];return UR({scheduleVisibilityFilters:e,hydrateParticipants:t,participantsProfile:r,policyDefinitions:a,tournamentRecord:d,usePublishState:o,matchUpFilters:s,contextFilters:c,nextMatchUps:u,inContext:l})}),p={},m={};return{...d.reduce((e,t)=>(Object.keys(t).forEach(r=>{if("groupInfo"===r)Object.assign(m,t[r]);else if("participants"===r)for(let e of t[r]??[])p[e.participantId]=e;else Array.isArray(t[r])&&(e[r]||(e[r]=[]),e[r]=e[r].concat(t[r]))}),e),{}),groupInfo:m,mappedParticipants:p}}function TR(e){if("object"!=typeof e?.tournamentRecords||!Object.keys(e?.tournamentRecords).length)return{error:Qi};let t,r,{courts:i,venues:n}=DT(e),a=zM(e).schedulingProfile,{sortDateMatchUps:o=!0,courtCompletedMatchUps:s,alwaysReturnCompleted:c,activeTournamentId:u,tournamentRecords:l,withCourtGridRows:d,minCourtGridRows:p,usePublishState:m,status:f=DI,sortCourtsData:h}=e,g=u??zs()??Object.keys(l)[0],I=m?rS({tournamentRecord:l[g],status:f}):void 0,y=c?wR({...e,matchUpFilters:{...e.matchUpFilters,matchUpStatuses:[Zm]},contextFilters:e.contextFilters}).completedMatchUps:[];if(m&&!I?.orderOfPlay?.published)return{completedMatchUps:y,dateMatchUps:[],courtsData:[],venues:n};m&&({drawIds:t,detailsMap:r}=function({tournamentRecords:e}){let t={},r=[];for(let i of Object.values(e))for(let e of i.events??[]){let i=iS({event:e}),n=i?.drawDetails;ti(n)?(Object.assign(t,n),r.push(...Object.keys(n).filter(e=>nS({drawId:e,drawDetails:n})))):i?.drawIds?.length&&r.push(...i.drawIds)}return{drawIds:r,detailsMap:t}}({tournamentRecords:l})),t?.length&&(e.contextFilters??={},e.contextFilters.drawIds?e.contextFilters.drawIds=e.contextFilters.drawIds.filter(e=>t.includes(e)):e.contextFilters.drawIds=t),I?.eventIds?.length&&(e.matchUpFilters??={},e.matchUpFilters?.eventIds&&e.matchUpFilters.eventIds.length?e.matchUpFilters.eventIds=e.matchUpFilters.eventIds.filter(e=>I.eventIds.includes(e)):e.matchUpFilters.eventIds=I.eventIds),I?.scheduledDates?.length&&(e.matchUpFilters??={},e.matchUpFilters.scheduledDates&&e.matchUpFilters.scheduledDates.length?e.matchUpFilters.scheduledDates=e.matchUpFilters.scheduledDates.filter(e=>I.scheduledDates.includes(e)):e.matchUpFilters.scheduledDates=I.scheduledDates),c&&(e.matchUpFilters??={},e.matchUpFilters?.excludeMatchUpStatuses?.length?e.matchUpFilters.excludeMatchUpStatuses.includes(Zm)||e.matchUpFilters.excludeMatchUpStatuses.push(Zm):e.matchUpFilters.excludeMatchUpStatuses=[Zm]);let{completedMatchUps:v,upcomingMatchUps:S,pendingMatchUps:b,abandonedMatchUps:U,groupInfo:w,mappedParticipants:T}=wR({...e,matchUpFilters:e.matchUpFilters,contextFilters:e.contextFilters}),D=[...S??[],...b??[]];r&&(!t?.length||Object.keys(r).length)&&(D=D.filter(e=>{let{drawId:t,structureId:i,stage:n}=e;if(!r?.[t]?.publishingDetail?.published)return!1;let a=Object.keys(r[t].stageDetails??{});if(a.length){let e=a.filter(e=>!r[t].stageDetails[e].published),i=a.filter(e=>r[t].stageDetails[e].published);return(!e.length||!e.includes(n))&&(!(!i.length||!i.includes(n))||e.length&&!e.includes(n)&&!i.length)}let o=Object.keys(r[t].structureDetails??{});if(o.length){let e=o.filter(e=>!r[t].structureDetails[e].published),n=o.filter(e=>r[t].structureDetails[e].published);return(!e.length||!e.includes(i))&&(!(!n.length||!n.includes(i))||e.length&&!e.includes(i)&&!n.length)}return!0}));let P=o?SR({matchUps:D,schedulingProfile:a}):D,N=i?.map(e=>{let t=function({courtId:e}){let t=(s?P.concat(v??[],U??[]):P).filter(t=>t.schedule?.courtId===e||t.schedule?.allocatedCourts?.map(({courtId:e})=>e).includes(e));return h?SR({matchUps:t,schedulingProfile:a}):t}(e);return{surfaceCategory:e?.surfaceCategory??"",matchUps:t,...e}}),E={completedMatchUps:c?y:v,mappedParticipants:e.hydrateParticipants?void 0:T,dateMatchUps:P,courtsData:N,groupInfo:w,venues:n};if(d){let t=e.matchUpFilters?.scheduledDate,{rows:r,courtPrefix:i}=iR({minRowsCount:Math.max(p||0,P.length||0),scheduledDate:t,courtsData:N});E.courtPrefix=i,E.rows=r}return{...E,...Gi}}function DR({tournamentRecords:e,tournamentId:t}){if("object"!=typeof e||!Object.keys(e).length)return{error:Qi};let r;return Object.keys(e).filter(e=>!t||e===t).forEach(t=>{let i=e[t],{matchUpDailyLimits:n}=function(e){let t=Dp(e,[{[Cd]:!0}]);if(t.error)return t;let{tournamentRecord:r}=e,{policy:i}=ig({policyType:Wp,tournamentRecord:r}),{extension:n}=lm({element:r,name:Em}),a=n?.value?.dailyLimits,o=i?.defaultDailyLimits;return{matchUpDailyLimits:a||o}}({tournamentRecord:i});r=n}),{matchUpDailyLimits:r}}function PR(e){let{matchUps:t}=e,{singlesForDoubles:r,tournamentRecord:i,drawDefinition:n,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:c,scaleName:u,eventId:l,zonePct:d,drawId:p,event:m}=e;if(!i&&!t)return{error:Ji};if(c&&![Wr,Hr].includes(c))return{error:Zo,info:{matchUpType:c}};if(t&&!_g(t))return{error:Zo,context:{matchUps:t}};let f=Nv[u],h=f?.ascending??e.ascending??!1,g=f?.accessor??e.valueAccessor,I=Array.isArray(f?.range)?Math.abs(f.range[0]-f.range[1]):0,y=gi(d)&&I?(d??0)*I:e.zoneMargin??I,v={withScaleValues:!0,withCompetitiveness:!0},S={matchUpTypes:c?[c]:[Wr,Hr]},b=i?.participants;t?.[0]?.hasContext?p?t=t.filter(e=>e.drawId===p):l&&(t=t.filter(e=>e.eventId===l)):t??=p&&!n&&[]||!p&&l&&!m&&[]||p&&Ly({inContext:!0,drawDefinition:n,contextFilters:S,contextProfile:v,participants:b})?.matchUps||!p&&l&&xy({inContext:!0,contextFilters:S,contextProfile:v,participants:b,event:m})?.matchUps||Oy({tournamentRecord:i,contextFilters:S,contextProfile:v})?.matchUps||[],c&&(t=t.filter(e=>e.matchUpType===c));let U=t.filter(({winningSide:e,score:t,sides:r,matchUpStatus:i})=>![cf,tf,df,ef,Xm].includes(i??"")&&qy({score:t})&&2===r?.length&&e),w=function({excludeMargin:e,exclusionRule:t,valueAccessor:r,ascending:i,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let u of a)MR({matchUp:u,accuracy:o,excludeMargin:e,exclusionRule:t,valueAccessor:r,ascending:i,scaleName:n});let s=o.affirmative.length+o.negative.length,c=s&&o.affirmative.length/s*100;return o.percent=c?Math.round(100*c)/100:0,o}({matchUps:U,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:h,scaleName:u}),T=!s||MI(Wr)(c)?y:2*(y||0),D=y?U.map(({competitiveProfile:e,matchUpType:t,score:i,sides:n})=>{let a=NR({singlesForDoubles:r,valueAccessor:g,matchUpType:t,scaleName:u,sides:n}),o=Math.abs(a[0].value-a[1].value);return{competitiveness:e?.competitiveness,valuesGap:o,score:i}}).filter(({valuesGap:e})=>e<=T):[],P=function({zoneData:e}){let t={[Qh]:[],[Jh]:[],[Zh]:[]};for(let r of e){let{competitiveness:e,score:i,valuesGap:n}=r;t[e]&&t[e].push({score:i,valuesGap:n})}return t}({zoneData:D}),N=P&&Object.values(P).flat().length,E=N&&Object.assign({},...Object.keys(P).map(e=>({[e]:Math.round(1e4*P[e].length/N)/100}))),M=U.length-(D?.length||0);return{...Gi,relevantMatchUps:U,zoneDistribution:E,zoneData:D,accuracy:w,nonZone:M}}function NR({singlesForDoubles:e,exclusionRule:t,valueAccessor:r,matchUpType:i,scaleName:n,sides:a}){let o=t?.range.sort(),s=e=>{let r=e?.[t?.valueAccessor];return{exclude:t&&r>=o[0]&&r<=o[1],exclusionValue:r}};return a.sort((e,t)=>e.sideNumber-t.sideNumber).map(({participant:t})=>{let a=[],o=t?.individualParticipants;if(o?.length){let c=[],u=0;for(let t of o){let{scaleValue:o,value:l}=ER({singlesForDoubles:e,valueAccessor:r,participant:t,matchUpType:i,scaleName:n}),{exclude:d,exclusionValue:p}=s(o);d&&a.push(p),c.push(o),l&&!Number.isNaN(Number(u))?u+=l:u=void 0}return{participantName:t.participantName,exclusionValues:a,scaleValues:c,value:u}}if(t){let{scaleValue:o,value:c}=ER({singlesForDoubles:e,valueAccessor:r,matchUpType:i,participant:t,scaleName:n}),{exclude:u,exclusionValue:l}=s(o);return u&&a.push(l),{participantName:t.participantName,exclusionValues:a,scaleValue:o,value:c}}return{}})}function ER({singlesForDoubles:e,valueAccessor:t,matchUpType:r,participant:i,scaleName:n}){let a=e?Wr:r,o=i?.rankings?.[a]?.find(e=>e.scaleName===n),s=(i?.ratings?.[a]?.find(e=>e.scaleName===n)||o)?.scaleValue;return{scaleValue:s,value:t?s?.[t]:s}}function MR({matchUp:e,accuracy:t,excludeMargin:r,exclusionRule:i,valueAccessor:n,ascending:a,scaleName:o}){let{matchUpType:s,sides:c,score:u,winningSide:l}=e;if(!l)return;if(i&&(!i.valueAccessor||!i.range))return void(t.error={info:"exclusionRule requires valueAccessor and range",error:Da});let d=l-1,p=NR({exclusionRule:i,valueAccessor:n,matchUpType:s,scaleName:o,sides:c});if(function({exclusionRule:e,sideValues:t,accuracy:r,score:i,winningSide:n}){if(e){let e=t.flatMap(({exclusionValues:e})=>e);if(e.length)return r.excluded.push({scoreString:i?.scoreStringSide1,exclusionValues:e,winningSide:n,sideValues:t}),!0}return!1}({exclusionRule:i,sideValues:p,accuracy:t,score:u,winningSide:l}))return;if(function(e){return e.filter(e=>![void 0,"",null].includes(e.value)).length<2}(p))return void t.excluded.push({scoreString:u?.scoreStringSide1,missingValues:!0,winningSide:l,sideValues:p});let m=p[d].value-p[1-d].value;if(function({excludeMargin:e,valuesGap:t}){let r=Number.parseFloat(e||0);return r&&Math.abs(t)<r}({excludeMargin:r,valuesGap:m}))return void t.excluded.push({scoreString:u?.scoreStringSide1,excludeMargin:r,winningSide:l,excludeGap:!0,sideValues:p,valuesGap:m});let f=a?m:-1*m,h=1===l?u?.scoreStringSide1:u?.scoreStringSide2;f>0?t.affirmative.push({winningScoreString:h,winningSide:l,sideValues:p,valuesGap:m,score:u}):t.negative.push({winningScoreString:h,winningSide:l,sideValues:p,valuesGap:m,score:u})}function RR({collectionDefinitions:e=[],collectionGroups:t=[]}){let r,i=0,{groupValueNumbers:n}=_w({collectionGroups:t});for(let a of e||[]){let{collectionValueProfiles:e,collectionGroupNumber:t,collectionValue:o,matchUpCount:s,matchUpValue:c,scoreValue:u,setValue:l}=a,d=t&&n.includes(t);if(gi(l||u))r=!0;else{if(d)continue;if("number"==typeof o&&gi(o))i+=o;else if(Array.isArray(e)&&e?.length)for(let t of e)i+=t.matchUpValue;else"number"==typeof c&&gi(c)&&(i+=(s??0)*c)}}for(let a of t)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...Gi}:{valueGoal:Math.floor(i/2)+1,...Gi}}function AR(e){let{timeStamp:t,schedule:r,matchUp:i}=e,n=Dp(e,[{[ap]:!0}]);if(n.error)return n;let{itemValue:a,timeStamp:o}=KI({timeItems:i?.timeItems||[],itemType:oI});return!r||o&&t&&new Date(o).getTime()>new Date(t).getTime()?{homeParticipantId:a}:r}function CR({matchUps:e,matchUpId:t}){if(!_g(e))return{error:Zo};let r=e.find(e=>e.matchUpId===t),{drawId:i,eventId:n,structureId:a,tournamentId:o}=r||{};return{matchUpId:t,drawId:i,eventId:n,structureId:a,tournamentId:o}}function kR(e,t){if(!ti(e))return{error:Zo};if(!Array.isArray(t))return{error:Zo};let r={};for(let{param:i,error:n,attr:a}of t){let t=xR({params:e,param:i,attr:a,error:n});if(t?.error)return t;r[i]=t}return r}function xR({params:e,param:t,attr:r,error:i}){if(t===Jd&&ti(e.drawDefinition)&&ei(e.structureId)){let t=(e.drawDefinition.structures??[]).find(({structureId:t})=>t===e.structureId);return!t.length&&i?{error:i}:{structure:t}}if(t===ap){let t=OM({...e,...r});return t.error&&i?{...t,error:i}:t}return{error:as,info:{param:t}}}function OR(e){let{structureId:t,matchUpId:r,event:i}=e,n=e.drawDefinition,a=Dp(e,[{[Cd]:!0},{[Sp]:{[jd]:!1,[Kd]:!1,[op]:!1,[cp]:!1}}]);if(a[sp])return a;let o=kR(e,[{[up]:ap,[sp]:Da}])?.matchUp;if(r&&o?.error)return o;!n&&o?.drawDefinition&&(n=o?.drawDefinition);let s=o?.structure;if(!s&&t&&!r){if(!n)return{error:wn};let e=wf({drawDefinition:n,structureId:t});if(e.error)return e;s=e.structure}let c=s?.matchUpFormat,u=n?.matchUpFormat,l=i?.matchUpFormat;return{structureDefaultMatchUpFormat:c,eventDefaultMatchUpFormat:l,drawDefaultMatchUpFormat:u,matchUpFormat:o?.matchUp?.matchUpFormat||c||u||l}}function FR({profileBands:e,tournamentRecord:t,matchUps:r}){if(!_g(r))return{error:pa};let i=!e&&ig({policyType:Fp,tournamentRecord:t}).policy,n=e||i?.profileBands||tg[Fp].profileBands,a=r.filter(({winningSide:e})=>e),o=a.map(Yg),s=Xg(o).reduce((e,t)=>((e,t)=>(e[zg(t,n)]+=1,e))(e,t),{[Qh]:0,[Jh]:0,[Zh]:0,[Kh]:0}),c=Object.keys(s).reduce((e,t)=>(s[t]||0)+e,0),u=Object.keys(s).map(e=>{let t=Number.parseFloat((s[e]/c).toFixed(4));return{[e]:100*t}}),l=a.filter(({matchUpStatus:e})=>e===Xh).length;return u.push({[Xh]:100*Number.parseFloat((l/c).toFixed(4))}),{competitiveBands:Object.assign({},...u),...Gi}}var{stageOrder:_R}=Md;function LR(e,t){return e.eventName.localeCompare(t.eventName)||e.eventId.localeCompare(t.eventId)||(_R[e?.stage]||0)-(_R[t?.stage]||0)||t.matchUpsCount-e.matchUpsCount||`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`.localeCompare(`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`)}function BR({excludeScheduleDateProfileRounds:e,excludeScheduledRounds:t,excludeCompletedRounds:r,inContextMatchUps:i,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:c,scheduleDate:u,withRoundId:l,venueId:d,context:p}){if(i&&!Array.isArray(i||"object"!=typeof i[0]))return{error:Zo,inContextMatchUps:i};if(o&&!n){if("object"!=typeof o)return{error:Zi};n={[o.tournamentId]:o}}let m="object"!=typeof n||!Object.keys(n).length;if((d||u||!i||!a&&(e||r||a||s))&&m)return{error:Qi};let f=Object.assign({},...Object.values(n??{}).map(({venues:e=[],tournamentId:t})=>({[t]:e?.map(({venueId:e})=>e)}))),h=Object.values(n??{}).map(({events:e=[],tournamentId:t,startDate:r,endDate:i})=>e.map(e=>({...e,validVenueIds:f[t],startDate:e.startDate??r,endDate:e.endDate??i}))).flat(),{segmentedRounds:g,profileRounds:I}=n&&(e||r||a||s)&&tR({tournamentRecords:n,schedulingProfile:a})||{},y=e&&Object.assign({},...I.map(e=>({[e.id]:e}))),v=i||n&&Fy({tournamentRecords:n,matchUpFilters:c})?.matchUps||[],S=[],b=v&&Object.values(v.reduce((e,t)=>{let r=JM(t).id,i=g?.[r],n=[...e[r]?.matchUps??[],t],{containerStructureId:a,stageSequence:o,structureName:s,tournamentId:c,isRoundRobin:u,matchUpType:d,roundNumber:p,roundOffset:m,structureId:f,eventName:h,roundName:I,drawName:y,eventId:v,drawId:S}=t,b=u?a:f;return{...e,[r]:{id:l?r:void 0,structureId:b,stageSequence:o,segmentsCount:i,structureName:s,tournamentId:c,matchUpType:d,roundNumber:p,roundOffset:m,eventName:h,roundName:I,drawName:y,matchUps:n,eventId:v,drawId:S}}},{})).map(e=>{let{minFinishingSum:t,winnerFinishingPositionRange:r}=function(e){return(e||[]).reduce((e,t)=>{let r=(t.finishingPositionRange?.winner||[]).reduce((e,t)=>e+t,0),i=(t.finishingPositionRange?.winner||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:i}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}(e.matchUps),i=e.segmentsCount;if(i){let a=e.matchUps.length/i;return _i(e.matchUps.sort((e,t)=>e.roundPosition-t.roundPosition),a).map((a,o)=>{let{unscheduledCount:s,incompleteCount:c,matchUpsCount:u,isScheduled:l,isComplete:d,byeCount:m}=eR(a),f=ZM({matchUps:e.matchUps,tournamentRecords:n,events:h,round:e});return nc({...e,...p,roundSegment:{segmentsCount:i,segmentNumber:o+1},winnerFinishingPositionRange:r,unscheduledCount:s,incompleteCount:c,minFinishingSum:t,matchUpsCount:u,isScheduled:l,roundTiming:f,isComplete:d,byeCount:m,matchUps:a})})}let{unscheduledCount:a,incompleteCount:o,matchUpsCount:s,isScheduled:c,isComplete:u,byeCount:l}=eR(e.matchUps),d=ZM({matchUps:e.matchUps,tournamentRecords:n,events:h,round:e});return nc({...e,...p,winnerFinishingPositionRange:r,unscheduledCount:a,incompleteCount:o,minFinishingSum:t,matchUpsCount:s,isScheduled:c,roundTiming:d,isComplete:u,byeCount:l})}).flat().filter(i=>{if(e){let t=iu(e),r=l?i.id:JM(i).id;if(t&&y[r]&&iu(y[r].scheduleDate)===t)return!1}let{isComplete:n,isScheduled:a}=i,s=!r||!n,c=!t||!a,p=d||u?h?.find(({eventId:e})=>e===i.eventId):void 0,m=p?.startDate??o?.startDate,f=p?.endDate??o?.endDate,g=!u||!m||new Date(u)>=new Date(m),I=!u||!f||new Date(u)<=new Date(f),v=g&&I,b=!d||p?.validVenueIds.includes(d),U=s&&c&&b&&v;return U||S.push(i),U}).sort(LR)||[];return{...Gi,rounds:b,excludedRounds:S}}function $R(e){let{matchUp:t,sideNumber:r,setNumber:i,isTiebreakValue:n,isPointValue:a}=e||{},{matchUpFormat:o}=e||{};if(!t)return{error:ma};o=o||t?.matchUpFormat;let s=Mc(o),c=!!t?.winningSide,u=t.score?.sets,l=u?.length,d=i&&i-1,p=!!u?.find((e,t)=>e.setNumber===i&&t===d),m=u?.filter(e=>e?.winningSide)||[],f=m?.length||0,h=i&&u?.slice(i)||[],g=!!(l&&i&&h?.reduce((e,t)=>(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e,!0)),I=i<=l&&u.find(e=>e.setNumber===i),y=I&&dE({setObject:I,matchUpScoringFormat:s}),{isCompletedSet:v,sideGameScores:S,sideTiebreakScores:b}=y||{},U=!!(I&&!v&&g||i&&i===l+1&&!c),w=[1,2].includes(r),T=w?r-1:0,D=I&&w&&(!n&&!a&&void 0!==S[T]&&S[T]||n&&void 0!==b[T]&&b[T]),P=!!D,N=m?.map(e=>dE({setObject:e,matchUpScoringFormat:s}).isValidSetOutcome).reduce((e,t)=>e&&t,!0),E=m.reduce((e,t)=>{let{winningSide:r}=t;return e[r-1]++,e},[0,0]),M=t?.winningSide,R=M&&M-1,A=1-R,C=E[R],k=E[A],x=Math.max(...E),O=wi(E)[x],{bestOf:F,exactly:_}=s??{},L=x===Math.ceil((F||_||1)/2)&&1===O&&E.indexOf(x)+1||void 0,B=C>k&&M===L;return{completedSetsHaveValidOutcomes:N,validMatchUpWinningSide:B,calculatedWinningSide:L,matchUpScoringFormat:s,validMatchUpOutcome:L&&N&&B,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:c,isValidSideNumber:w,hasExistingValue:P,existingValue:D,isExistingSet:p,isActiveSet:U,...y}}function VR({participants:e,tournamentAppliedPolicies:t,scheduleVisibilityFilters:r,participantsProfile:i,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:c,contextFilters:u,contextContent:l,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,tournamentId:I,inContext:y,context:v,event:S}){let b,{eventId:U,eventName:w,endDate:T,eventType:D,category:P,gender:N}=S??{},E={...v,...nc({surfaceCategory:S?.surfaceCategory??s?.surfaceCategory,indoorOutDoor:S?.indoorOutdoor??s?.indoorOutdoor,endDate:T??S?.endDate??s?.endDate,tournamentId:I??s?.tournamentId,eventName:w,eventType:D,category:P,eventId:U,gender:N})};return!e?.length&&s&&({participants:e,participantMap:p,groupInfo:b}=Hh({participantsProfile:i,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:y})),S&&f&&!l&&(l=rg({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:h,event:S})),{...ky({context:E,tournamentAppliedPolicies:t,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:i,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:c,participantMap:p,contextContent:l,contextFilters:u,matchUpFilters:d,publishStatus:m,contextProfile:f,drawDefinition:h,nextMatchUps:g,inContext:y,event:S}),groupInfo:b}}var jR={};function GR({tournamentRecord:e,venueId:t,venueIds:r}){return e?{courts:(e.venues||[]).filter(e=>t?e.venueId===t:!r||r.includes(e.venueId)).map(e=>{let{venueId:t}=e,r=Nu(e.courts||[]);return r.forEach(e=>Object.assign(e,{venueId:t})),r}).flat()}:{error:Ji}}Br(jR,{getCompetitionVenues:()=>PT,getCourts:()=>GR,getVenuesAndCourts:()=>DT,publicFindVenue:()=>sy});var WR={};function qR({tournamentRecord:e,event:t}){if(!e)return{error:Ji};if(!t)return{error:jn};let r,i,n,a=t.entries||[],o=e.participants||[],s=t.category?.categoryName||t.category?.ageCategoryCode,{eventType:c}=t,u=new Set(a.map(e=>e.participantId));return{entryScaleAttributes:o.filter(e=>u.has(e.participantId)).map(e=>{let{participantId:t,participantName:a,name:o}=e,u={scaleType:wI,eventType:c,scaleName:s},l=Jv({participant:e,scaleAttributes:u})?.scaleItem?.scaleValue;u={scaleType:UI,eventType:c,scaleName:s};let d=Jv({participant:e,scaleAttributes:u})?.scaleItem?.scaleValue;u={scaleType:bI,eventType:c,scaleName:s};let p=Jv({participant:e,scaleAttributes:u})?.scaleItem?.scaleValue;return r=!(!r&&!l),i=!(!i&&!d),n=!(!n&&!p),{participantId:t,participantName:a||o,seed:l,ranking:d,rating:p}}),hasSeededParticipants:r,hasRankedParticipants:i,hasRatedParticipants:n}}function HR({tournamentRecord:e,withScaleValues:t,scaleEventType:r,inContext:i,eventIds:n,drawIds:a,context:o}){if(!e)return{error:Ji};let{tournamentId:s}=e,c=(e.events??[]).filter(({eventId:e})=>!n||Array.isArray(n)&&n.includes(e)).map(e=>{let t=e.drawDefinitions?.map(Ym);if(a?.length&&!Ci(a,t).length)return;let r=Nu(e);return i&&Object.assign(r,{tournamentId:s}),o&&Object.assign(r,o),r}).filter(Boolean),u={};if(t){let t=mS({withScaleValues:!0,tournamentRecord:e}).participantMap,i=e=>e.reduce((e,t)=>e+Number.parseFloat(t),0);for(let e of c){let n=r??e.eventType,o=e.eventId;u[o]||(u[o]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let s=(e.entries??[]).filter(({entryStatus:e})=>wg.includes(e)).map(Hm),c=e=>{if(e?.ratings?.[n])for(let t of e?.ratings?.[n]??[]){let e=t.scaleName;u[o].ratings[e]||(u[o].ratings[e]=[]);let r=Nv[e]?.accessor;if(r){let i=Number.parseFloat(t.scaleValue?.[r]);i&&u[o].ratings[e].push(i)}}if(e?.rankings?.[n])for(let t of e?.rankings?.[n]??[]){let e=t.scaleName;u[o].ranking[e]||(u[o].ranking[e]=[]),t.scaleValue&&u[o].ranking[e].push(t.scaleValue)}};for(let e of s){let r=t?.[e]?.participant;if(r?.participantType===wh)c(r);else for(let e of r?.individualParticipantIds??[]){let r=t?.[e]?.participant;c(r)}}let l=u[o].ratings;for(let e of Object.keys(l)){let t=l[e];if(!t.length)continue;let r=ui(t)?.toFixed(2);u[o].ratingsStats[e]={avg:Number.parseFloat((i(t)/t.length).toFixed(2)),median:r?Number.parseFloat(r):void 0,max:Math.max(...t),min:Math.min(...t)}}let d=(e,r)=>{let i=t=>{if(u[o].draws?.[e]&&t?.ratings?.[n])for(let r of t?.ratings?.[n]??[]){let t=r.scaleName;u[o].draws[e]?.ratings[t]||(u[o].draws[e].ratings[t]=[]);let i=Nv[t]?.accessor;if(i){let n=Number.parseFloat(r.scaleValue?.[i]);n&&u[o].draws[e].ratings[t].push(n)}}if(u[o].draws?.[e]&&t?.rankings?.[n])for(let r of t?.rankings?.[n]??[]){let t=r.scaleName;u[o].draws[e]?.ranking[t]||(u[o].draws[e].ranking[t]=[]);let i=r.scaleValue;i&&u[o].draws[e].ranking[t].push(i)}};for(let n of r.filter(Boolean)){let e=t?.[n]?.participant;if(e?.participantType===wh)i(e);else for(let r of e?.individualParticipantIds??[]){let e=t?.[r]?.participant;i(e)}}},p=[],m=e=>a?.length&&a.includes(e)||p.includes(e);for(let t of e.drawDefinitions??[]){let e=t.drawId;if(m(e))continue;let r=pv({drawDefinition:t}).assignedParticipantIds??[];u[o].draws[e]||(u[o].draws[e]={ratingsStats:{},ratings:{},ranking:{}}),p.push(e),d(e,r)}let f=py({event:e}).flightProfile;for(let e of f?.flights??[]){let t=e.drawId;m(t)||d(t,e.drawEntries.map(Hm))}for(let e of p){let t=u[o].draws[e].ratings;for(let r of Object.keys(t)){let n=t[r];if(!n.length)continue;let a=ui(n)?.toFixed(2);u[o].draws[e].ratingsStats[r]={avg:Number.parseFloat((i(n)/n.length).toFixed(2)),median:a?Number.parseFloat(a):void 0,max:Math.max(...n),min:Math.min(...n)}}}}}return nc({eventScaleValues:u,events:c,...Gi})}function zR({tournamentRecord:e,drawDefinition:t,context:r,event:i}){if(!e)return{error:Ji};if(!i)return{error:jn};let n=Nu(i);return r&&Object.assign(n,r),nc({drawDefinition:t&&n.drawDefinitions?.find(({drawId:e})=>t.drawId===e),event:n})}function YR(e){let t="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:i}=function(e){let{tournamentRecord:t,event:r}=e,i={...e?.appliedPolicies,...zh({tournamentRecord:t,event:r}).appliedPolicies??{}},n=Nu(e.policyDefinitions??{},!1,!0);return{appliedPolicies:i,policyDefinitions:n}}(e),n=function({enforceGender:e,policyDefinitions:t,appliedPolicies:r}){return e??t?.[Bp]?.participants?.enforceGender??r?.[Bp]?.participants?.enforceGender}({...e,policyDefinitions:i,appliedPolicies:r}),a=function({considerEventEntries:e=!0,drawEntries:t,eventEntries:r,qualifyingOnly:i}){return(i&&[]||KR(t)||(e?r:[])).filter(({entryStage:e})=>!e||e===El)}(e),o=function(e){let{consideredEntries:t,appliedPolicies:r,policyDefinitions:i,enforceGender:n,participantMap:a,participants:o,event:s}=e;return s&&o&&TD({consideredEntries:t,policyDefinitions:i,appliedPolicies:r,participantMap:a,enforceGender:n,participants:o,event:s})}({...e,consideredEntries:a,appliedPolicies:r});if(o?.error)return ac({result:o,stack:t});let s=function(e){return!e.drawSize&&e.consideredEntries.length&&![Zl,nd,ed,vd,Sd].includes(e.drawType??"")&&fi(e.consideredEntries.length)||e.drawSize&&Jr(e.drawSize)||!1}({...e,consideredEntries:a}),c=function(e){let{policyDefinitions:t,appliedPolicies:r,enforceMinimumDrawSize:i=!0,drawSize:n}=e,a=e.drawTypeCoercion??vD({drawType:e.drawType,policyDefinitions:t,appliedPolicies:r}),o=ND({drawType:e.drawType,enforceMinimumDrawSize:i,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}({...e,appliedPolicies:r,policyDefinitions:i,drawSize:s});if(c.error)return ac({result:c,stack:t});let u=c.drawType;if(isNaN(s)&&u!==Zl)return ac({result:{error:Un},stack:t});let l=i?.[zp]??r?.[zp],d=e.seedingProfile??l?.seedingProfile?.drawTypes?.[u??""]??l?.seedingProfile;e.seedingProfile&&(i[zp]||(i[zp]={...aM[zp]}),i[zp].seedingProfile=d);let p=function(e){let{tournamentRecord:t,event:r,ignoreAllowedDrawTypes:i,drawType:n}=e,a=!i&&t&&yM({tournamentRecord:t,categoryType:r?.category?.categoryType,categoryName:r?.category?.categoryName});return a?.length&&!a.includes(n)?{error:vn}:{...Gi}}({...e,drawType:u});return p?.error?ac({result:p,stack:t}):{drawSize:s,drawType:u,enforceGender:n,seedingProfile:d,appliedPolicies:r,policyDefinitions:i}}function KR(e){return e?.filter(e=>e.entryStatus&&[...wg,fg].includes(e.entryStatus))}function XR(e){let{drawDefinition:t,appliedPolicies:r}=e,i=r?.[Vp],n=kg({drawDefinition:t});return t.structures?.forEach(e=>{let r=xg({structureId:e.structureId,matchUpsMap:n}),a=qg({roundNamingPolicy:i,drawDefinition:t,structure:e,matchUps:r}),{roundNamingProfile:o,roundProfile:s}=a;(e.structures||[e]).forEach(e=>{(e.matchUps??[]).forEach(e=>{let t=e?.roundNumber?.toString();if(t){let r=o?.[t]?.roundName,i=o?.[t]?.abbreviatedRoundName,n=s?.[t]?.feedRound;Object.assign(e,{abbreviatedRoundName:i,feedRound:n,roundName:r})}})})}),{drawDefinition:t}}function QR(e){let{voluntaryConsolation:t,tournamentRecord:r,event:i}=e,n="generateDrawDefinition",{participants:a,participantMap:o}=mS({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:r}),s=KR(i?.entries)??[],c=YR({...e,participantMap:o,participants:a,eventEntries:s});if(c.error)return ac({result:c,stack:n});let{appliedPolicies:u,policyDefinitions:l,drawSize:d,drawType:p,enforceGender:m,seedingProfile:f}=c,h=i?.eventType,g=e.matchUpType??h,I=function(e){let{existingDrawDefinition:t,hydrateCollections:r,enforceGender:i,tieFormatName:n,matchUpType:a,eventType:o,isMock:s,event:c}=e,{tieFormat:u,matchUpFormat:l}=e;if(a===Dl&&o===Dl){let e=t?.structures?.find(({stage:e})=>e===El)?.tieFormat;u=u||e||n&&c?.tieFormat?.tieFormatName===n&&c.tieFormat||n&&Sl({namedFormat:n,hydrateCollections:r,isMock:s,event:c})||c?.tieFormat||Sl({event:c,isMock:s,hydrateCollections:r}),l=void 0}else l||(u=void 0,c?.matchUpFormat||(l=Vu));if(u){let e=bu({gender:c?.gender,enforceGender:i,tieFormat:u});if(e.error)return e}return{tieFormat:u,matchUpFormat:l}}({...e,enforceGender:m,eventType:h,matchUpType:g});if(I.error)return ac({result:I,stack:n});let{matchUpFormat:y,tieFormat:v}=I;if(e.drawId&&"string"!=typeof e.drawId)return ac({result:{error:Zo},stack:n});let S=function(e){let t="generateOrGetExisting",r=[],i=[],n=sM(e);if(n.error)return ac({result:n,stack:t});let a,o,s=n.existingDrawDefinition,c=e.drawEntries??e.eventEntries??[],u=n.existingQualifyingPlaceholderStructureId&&VE({...e,...n})||KE({...e,...n,entries:c});return u.error?ac({result:u,stack:t}):(u.positioningReports?.length&&r.push(...u.positioningReports??[]),u.conflicts?.length&&i.push(...u.conflicts??[]),a=u.drawDefinition,o=u.structureId,{existingDrawDefinition:s,positioningReports:r,drawDefinition:a,structureId:o,conflicts:i,entries:c})}({...e,policyDefinitions:l,tournamentRecord:r,appliedPolicies:u,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:s,matchUpType:g,tieFormat:v,drawSize:d,drawType:p,event:i});if(S.error)return ac({result:S,stack:n});let{existingDrawDefinition:b,positioningReports:U,drawDefinition:w,structureId:T,conflicts:D,entries:P}=S;if(!w)return ac({result:{error:Zo},stack:n});let N=function(e){let{qualifyingPlaceholder:t,existingDrawDefinition:r,positioningReports:i,qualifyingProfiles:n,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:c,participants:u,structureId:l,tieFormat:d,entries:p,stack:m}=e,f=t&&!n?.length&&!r,h=[];if(n){let t=(e,t)=>e.stageSequence-t.stageSequence,r=(e,t)=>e.roundTarget-t.roundTarget,l=[],d=1;n.sort(r);for(let f of n){if(!Array.isArray(f.structureProfiles))return ac({info:Eb("structureProfiles"),result:{error:Da},stack:m});d=f.roundTarget||d;let r=f.structureProfiles?.sort(t)||[],n=1;for(let t of r){let{qualifyingRoundNumber:r,qualifyingPositions:m,seededParticipants:f,seedingScaleName:g,seedsCount:I=0,seedByRanking:y,placeByes:v,drawSize:S}=t,b=YE({...e,seedingProfile:t.seedingProfile??c,stageSequence:n,qualifyingRoundNumber:r,preparedStructureIds:l,qualifyingPositions:m,seededParticipants:f,stage:Ml,seedingScaleName:g,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:y,participants:u,roundTarget:d,seedsCount:I,placeByes:v,drawSize:S,entries:p});if(b.error)return b;b.structureId&&l.push(b.structureId),n+=1,b.conflicts?.length&&h.push(...b.conflicts),b.positioningReport?.length&&i.push({[Ml]:b.positioningReport})}d+=1}}else if(l&&f){let e=JS({structureName:eb(Ml),stage:Ml,qualifyingOnly:o,tieFormat:d}),{link:t}=iw({sourceStructureId:e.structureId,targetStructureId:l,sourceRoundNumber:0,linkType:Kl});s.structures||(s.structures=[]),s.structures.push(e),s.links||(s.links=[]),s.links.push(t)}return{qualifyingConflicts:h,error:void 0}}({...e,existingDrawDefinition:b,positioningReports:U,appliedPolicies:u,drawDefinition:w,seedingProfile:f,participants:a,structureId:T,entries:P,params:e,stack:n});if(N.error)return N;let{qualifyingConflicts:E}=N;return w.drawName=e.drawName??(p&&eb(p)),d&&"object"==typeof t&&d>=4&&tb({...t,drawDefinition:w,matchUpType:g}),e.hydrateRoundNames&&u?.[Vp]&&XR({drawDefinition:w,appliedPolicies:u}),{existingDrawDefinition:!!b,qualifyingConflicts:E,positioningReports:U,drawDefinition:w,structureId:T,...Gi,conflicts:D}}function JR({matchUps:e,matchUpType:t}){if(!e)return{error:pa};let r=[],i=[],n=0;t&&(e=e.filter(e=>e.matchUpType===t));let a=vi(e.map(({matchUpType:e})=>e));if(a.length>1)if(ji(a,Yr))e=e.filter(MI(Yr));else if(ji(a,Wr))e=e.filter(MI(Wr));else{if(!ji(a,Hr))return{};e=e.filter(MI(Hr))}if(!_g(e)||!e.length)return{};let o=(e,t)=>Jr(e)-Jr(t),s=vi(e.flatMap(e=>e.drawPositions).filter(Boolean)).sort(o),c=Ri(1,Math.max(...s)+1).filter(e=>!s.includes(e)).sort(o),{roundMatchUps:u}=Lg({matchUps:e}),l=u?.[1],d=u?.[2]??[],p=l?.[0],m=p?.drawId,f=p?.structureId,h=u?Object.keys(u).map(e=>Jr(e)):[],g=Math.max(...h),I=u?.[g]?.length??0,y=Math.ceil(Math.log(I)/Math.log(2)),v=Ri(1,y+1).map(e=>{let t=Math.pow(2,e-1),r=g+y-e+1;return Ri(1,t+1).map(t=>({drawId:m,structureId:f,matchUpId:Ru(),drawPositions:[],sides:[],roundNumber:r,roundPosition:t,finishingRound:e}))});y&&(e=e.concat(...v.flat()));let S=l?.map(e=>e.drawPositions)?.flat(1/0),b=d.map(e=>e.drawPositions).flat(1/0).filter(e=>!S?.includes(e)).sort(o),U=d.filter(e=>e.drawPositions?.find(e=>b.includes(e))).map(e=>{let t=e.drawPositions?.find(e=>b.includes(e)),r=t&&e.drawPositions?.indexOf(t),i=void 0!==r&&e.sides?.[r];return t&&{[t]:i}});if(c?.length&&b?.length===c?.length){let t=b.map((e,t)=>[e,c[t]].sort(o)),r=Object.assign({},...U),n=Nu(l?.[0].finishingRound,!1,!0),a=Nu(l?.[0].finishingPositionRange,!1,!0);i=t.map((e,t)=>{let i=Math.max(...e||[])/2,o=e?.map(e=>r[e]||{bye:!0,drawPosition:e});return{finishingPositionRange:a,sideNumber:t+1,matchUpStatus:"BYE",matchUpId:Ru(),finishingRound:n,roundNumber:1,drawPositions:e,roundPosition:i,structureId:f,drawId:m,sides:o}}),e=e.concat(...i)}let w=g+y;return Ri(1,w+1).forEach(t=>{let i=[],a=ZR({matchUps:e,roundNumber:t}),o=ZR({matchUps:e,roundNumber:t-1}),s=new Set(o.map(eA).filter(Boolean)),c=a?.length===r?.length,u=a?.length===r?.length/2;1===t&&a.forEach(e=>{let t=e.drawPositions||[],{matchUpId:r,structureId:n}=e,a=[{...e.sides[0],drawPosition:t[0],matchUpId:r,structureId:n},{...e.sides[1],drawPosition:t[1],matchUpId:r,structureId:n}],o={...e,children:a};i.push(o)}),c?(n++,a.forEach((e,t)=>{let a=e.drawPositions||[],{matchUpId:o,structureId:c}=e,u=a.filter(Boolean).reduce((e,t)=>S?.includes(t)?e:t,void 0),l=[{...e.sides.filter(Boolean).reduce((e,t)=>t.participantId&&!s.has(t.participantId)?t:e,void 0),drawPosition:u,feedRoundNumber:n,sides:e.sides,matchUpId:o,structureId:c},r[t]],d={...e,children:l};i.push(d)})):u&&a.forEach((e,t)=>{let n={...e,children:[r[2*t],r[2*t+1]]};i.push(n)}),r=i}),{hierarchy:r[0],missingMatchUps:i,maxRound:g,finalRound:w,matchUps:e}}function ZR({matchUps:e,roundNumber:t}){return e.filter(e=>e.roundNumber===t).sort((e,t)=>e.roundPosition-t.roundPosition)}function eA(e){return"BYE"===e.matchUpStatus?e.sides.reduce((e,t)=>t.participantId||e,void 0):e.winningSide?e.sides.reduce((t,r)=>r.sideNumber===e.winningSide?r.participantId:t,void 0):void 0}function tA({scaleAttributes:e,scaledEntries:t,stageEntries:r,seedsCount:i,scaleName:n}){if(!e)return{error:Da,info:"missing scaleAttributes"};let a=Object.assign({},...(t||[]).slice(0,i).map(({participantId:e},t)=>({[e]:t+1})));n=n||e.scaleName;let o=(new Date).toISOString();return{scaleItemsWithParticipantIds:r.map(({participantId:t})=>({scaleItems:[{scaleValue:a[t],eventType:e.eventType,scaleType:Ap,scaleName:n,scaleDate:o}],participantId:t}))}}function rA({tournamentRecord:e,drawDefinition:t,policyDefinitions:r,scaleAttributes:i,scaleName:n,drawSize:a,drawId:o,event:s,stage:c,sortDescending:u,scaleSortMethod:l}){let d=aR({policyDefinitions:r,drawDefinition:t,drawSize:a,drawId:o,event:s,stage:c});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:f}=d;if(!f||!m)return{error:Zo};let h=zE({tournamentRecord:e,scaleAttributes:i,scaleSortMethod:l,sortDescending:u,entries:p,stage:c}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=tA({scaleAttributes:i,scaledEntries:h,stageEntries:f,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}Br(WR,{categoryCanContain:()=>vu,getCategoryAgeDetails:()=>Iu,getEvent:()=>zR,getEventProperties:()=>qR,getEventStructures:()=>jb,getEventTimeItem:()=>_h,getEvents:()=>HR,getFlightProfile:()=>py,getScaledEntries:()=>zE});var iA={};Br(iA,{addDrawEntries:()=>DS,addEventEntries:()=>CS,addEventEntryPairs:()=>mA,destroyPairEntries:()=>YS,destroyPairEntry:()=>zS,getEntriesAndSeedsCount:()=>aR,getMaxEntryPosition:()=>oR,modifyEntriesStatus:()=>hv,modifyEventEntries:()=>fA,mutate:()=>nA,promoteAlternate:()=>sA,promoteAlternates:()=>cA,query:()=>nR,removeDrawEntries:()=>lA,removeEventEntries:()=>NS,setEntryPosition:()=>aA,setEntryPositions:()=>oA});var nA={};function aA({tournamentRecord:e,drawDefinition:t,participantId:r,entryPosition:i,skipRefresh:n,event:a}){if(!e)return{error:Ji};if(!r)return ac({result:{error:Za},stack:"setEntryPositions"});if(void 0!==i&&!Number.isSafeInteger(i))return{error:Zo,entryPosition:i};(a?.entries||[]).forEach(e=>{e.participantId===r&&(e.entryPosition=i)}),(t?.entries||[]).forEach(e=>{e.participantId===r&&(e.entryPosition=i)});let o=e=>{e.entries.forEach(e=>{e.entryPosition===i&&e.participantId!==r&&(e.entryPosition+=.1)})};return n||(a?.entries&&(o(a),a.entries=mv({entries:a.entries})),t?.entries&&(o(t),t.entries=mv({entries:t.entries}))),{...Gi}}function oA({tournamentRecord:e,entryPositions:t,drawDefinition:r,event:i}){if(!e)return{error:Ji};if(!Array.isArray(t))return{error:Zo};for(let n of t){let{participantId:t,entryPosition:a}=n,o=aA({skipRefresh:!0,tournamentRecord:e,drawDefinition:r,participantId:t,entryPosition:a,event:i});if(o.error)return o}return i?.entries&&(i.entries=mv({entries:i.entries})),r?.entries&&(r.entries=mv({entries:r.entries})),{...Gi}}function sA(e){let{participantId:t}=e;return t&&"string"!=typeof t?{error:Zo,participantId:t}:cA({...e,participantIds:[t].filter(Boolean)})}function cA({tournamentRecord:e,drawDefinition:t,participantIds:r,stageSequence:i,stage:n=El,eventId:a,event:o}){if(!e)return{error:Ji};if(!Array.isArray(r))return{error:Zo,participantIds:r};if(!o)return{error:jn};if(o){let e=uA({element:o,participantIds:r,stageSequence:i,stage:n});if(e.error)return e}if(t){let e=uA({element:t,participantIds:r,stageSequence:i,stage:n});if(e.error)return a?ac({context:{drawPromotionError:e.error,drawId:t.drawId},result:{...Gi},stack:"promoteAlternates"}):e}return{...Gi}}function uA({participantIds:e,stageSequence:t,element:r,stage:i}){let n=(r.entries||[]).filter(e=>e.entryStatus===sg),a=(r.entries||[]).filter(t=>e.includes(t.participantId)),o=n.reduce((e,t)=>{let{entryPosition:r}=t;return isNaN(r)&&e||(!e||r<e.entryPosition)&&t||e},void 0),s=a.length?a:[o].filter(Boolean);if(!s?.length)return{error:mo};let c=s.filter(({entryStatus:e})=>e!==sg);if(c.length)return{error:po,invalidEntryStatus:c};let u=s.filter(({entryStage:e})=>e&&e!==i);if(u.length)return{error:fo,invalidStage:u};let l=t&&s.filter(e=>e.stageSequence!==t);if(l?.length)return{error:ho,invalidStageSequence:l};for(let d of s){d.entryStatus=ug;let e=d?.entryPosition;isNaN(e)||r.entries.forEach(t=>{t.entryStatus===sg&&t.entryPosition>e&&(t.entryPosition=t.entryPosition-1)});let t=Math.max(...r.entries.filter(e=>e.entryStatus===ug&&!isNaN(e.entryPosition)).map(({entryPosition:e})=>Jr(e||0)),0);d.entryPosition=t||0}return{...Gi}}function lA({autoEntryPositions:e=!0,participantIds:t,drawDefinition:r,drawId:i,stages:n,event:a}){if(!a)return{error:jn};if(!i)return{error:wn};if(!t?.length)return{error:no};if(xi(pv({drawDefinition:r,stages:n}).assignedParticipantIds??[],t))return{error:co};let o=e=>{let r=e.participantId;return!t.includes(r)},{flightProfile:s}=py({event:a}),c=s?.flights?.find(e=>e.drawId===i);return c?.drawEntries&&(c.drawEntries=c.drawEntries.filter(o),e&&(c.drawEntries=mv({entries:c.drawEntries}))),r?.entries&&(r.entries=r.entries.filter(o),e&&(r.entries=mv({entries:r.entries}))),{...Gi}}function dA(e){let t="addParticipant",{allowDuplicateParticipantIdPairs:r,returnParticipant:i,disableNotice:n,pairOverride:a,participant:o}=e,s=e.tournamentId?e.tournamentRecords?.[e.tournamentId]:e.tournamentRecord??(e.activeTournamentId&&e.tournamentRecords?.[e.activeTournamentId]);if(!s)return{error:Ji};if(!o)return ac({result:{error:Qa},stack:t});o.participantId||(o.participantId=Ru()),s.participants||(s.participants=[]);let{participantId:c,individualParticipantIds:u}=o;if(s.participants.reduce((e,t)=>t.participantId===c||e,!1))return{error:ro};let{participantType:l,participantRole:d}=o;if(!l||!Object.keys(Nh).includes(l))return{error:Ka,participantType:l};if(!d)return{error:Xa};let p=s.participants||[],m=p.filter(e=>e.participantType===wh).map(e=>e.participantId);if(l!==wh&&o.person)return{error:Zo,person:o.person};if(u&&!Array.isArray(u))return{error:Zo,individualParticipantIds:u};if(l===Dh){if(o.person)return{error:Zo,person:o.person};if(!o.individualParticipantIds)return ac({result:{error:no},stack:t});if(2!==o.individualParticipantIds.length&&!a)return ac({info:"PAIR must be 2 individualParticipantIds",result:{error:za},stack:t});{let e=p.filter(e=>e.participantType===wh).map(e=>e.participantId);if(!Array.isArray(o.individualParticipantIds))return ac({result:{error:za},stack:t});if(!o.individualParticipantIds.reduce((t,r)=>e.includes(r)&&t,!0))return ac({result:{error:za},stack:t})}let e=p.filter(e=>e.participantType===Dh).map(e=>({individualParticipantIds:e.individualParticipantIds,participant:e})),n=o.participantType===Dh&&e.find(e=>2===Ci(e.individualParticipantIds,o.individualParticipantIds).length);if(n&&!r)return{...Gi,existingParticipant:!0,participant:i&&Nu(n.participant)};if(!o.participantName){let e=p.filter(e=>o.individualParticipantIds?.includes(e.participantId)),t=e.map(e=>e.person?.standardFamilyName).filter(Boolean).join("/");1===e.length&&(t+="/Unknown"),o.participantName=t}}else if(l===wh){if(!o.person?.standardFamilyName||!o.person?.standardGivenName)return{error:so};if(!o.participantName){let e=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=e}}else{if(!l||![Ph,Th].includes(l))return{error:Ka};if(u||(o.individualParticipantIds=[]),o.individualParticipantIds?.length)for(let e of o.individualParticipantIds){if("string"!=typeof e)return ac({result:{participantId:e,error:Zo},stack:t});if(!m.includes(e))return ac({result:{participantId:e,error:to},stack:t})}}return s.participants.push(o),n||Bs({payload:{tournamentId:s.tournamentId,participants:[o]},topic:Rf}),nc({participant:i&&Nu(o),...Gi})}function pA({allowDuplicateParticipantIdPairs:e,returnParticipants:t,tournamentRecord:r,participants:i=[]}){if(!r)return{error:Ji};r.participants||(r.participants=[]);let n=r.participants.map(e=>e.participantId)||[];i.forEach(e=>{e.participantId||(e.participantId=Ru())});let a=i.filter(e=>!n.includes(e.participantId)),o=i.filter(e=>n.includes(e.participantId)),s=a.filter(e=>e.participantType===wh),c=a.filter(e=>e.participantType!==wh),u=s.concat(...c),l=[];if(u.length){for(let t of u){let i=dA({allowDuplicateParticipantIdPairs:e,returnParticipant:!0,disableNotice:!0,tournamentRecord:r,participant:t});if(i.error)return i;i.success&&!i.existingParticipant&&l.push(i.participant)}l.length&&Bs({topic:Rf,payload:{tournamentId:r.tournamentId,participants:l}});let i={participants:t&&Nu(l),addedCount:l.length,...Gi};return o.length&&Object.assign(i,{notAdded:o,info:uo}),nc(i)}return{info:"No new participants to add",addedCount:0,...Gi}}function mA(e){let t=Dp(e,[{[Cd]:!0,[cp]:!0}]);if(t.error)return t;let{allowDuplicateParticipantIdPairs:r,entryStatus:i=sg,participantIdPairs:n=[],entryStage:a=El,tournamentRecord:o,drawDefinition:s,event:c,uuids:u}=e;if(c.eventType!==Hr)return{error:Vn};let l=[],d=new Map;for(let y of o.participants??[]){let{participantType:e,participantId:t,person:r,individualParticipantIds:i}=y;e===wh&&r?.sex?d.set(t,r.sex):e===Dh&&i&&l.push(i)}let p=n.filter(e=>{if(2!==e.length)return!0;if(!c.gender||fc(c.gender))return!1;if(!d.has(e[0])||!d.has(e[1]))return!0;let t=e.map(e=>d.get(e)),r=pc(c.gender)&&(!pc(t[0])||!pc(t[1]))||dc(c.gender)&&(!dc(t[0])||!dc(t[1]));return mc(c.gender)&&(t.sort(lS),(!dc(t[0])||!pc(t[1]))&&(r=!0)),r});if(p.length)return{error:za,invalidParticipantIdPairs:p};let m,f=n.map(e=>({participantId:u?.pop()??Ru(),participantRole:xS,individualParticipantIds:e,participantType:Dh})),h=r?f:f.filter(e=>!l.find(t=>2===Ci(t,e.individualParticipantIds).length)),g=[];if(h){let e=pA({allowDuplicateParticipantIdPairs:r,participants:h,returnParticipants:!0,tournamentRecord:o});if(e.error)return e;g=e.participants||[],m=e.info}let I=CS({participantIds:n.map(e=>{let t=g.find(t=>2===Ci(t.individualParticipantIds,e).length);if(t)return t;let{participant:r}=gy({tournamentRecord:o,participantIds:e});return r}).map(e=>e.participantId),tournamentRecord:o,drawDefinition:s,entryStatus:i,entryStage:a,event:c});return h.length&&Bs({payload:{participants:h},topic:Rf}),{...I,info:m,newParticipantIds:h.map(Hm)}}function fA({entryStatus:e=ug,unpairedParticipantIds:t=[],participantIdPairs:r=[],entryStage:i=El,tournamentRecord:n,event:a}){if(!n)return{error:Ji};if(!a)return{error:jn};let o=n.participants??[],s=o.filter(e=>e.participantType===wh).map(e=>e.participantId),c=t.concat(...r).flat(1/0).filter(e=>!s.includes(e));if(c.length)return{error:za,invalidParticipantIds:c};let u=r.filter(e=>2!==e.length);if(u.length)return{error:za,invalidParticipantIdPairs:u};let l=o.filter(e=>e.participantType===Dh).map(e=>e.individualParticipantIds),d=pA({participants:r.filter(e=>!l.find(t=>2===Ci(t,e).length)).map(e=>({participantType:Dh,participantRole:xS,individualParticipantIds:e})),tournamentRecord:n});if(d.error)return d;let p=r.map(e=>{let{participant:t}=gy({tournamentRecord:n,participantIds:e});return t}).map(t=>({participantId:t,entryStatus:e,entryStage:i})),m=t.map(e=>({entryStatus:gg,participantId:e,entryStage:i}));return a.entries=(a.entries??[]).filter(e=>e.entryStage===i),a.entries=a.entries.concat(...p,...m),{...Gi}}Br(nA,{addDrawEntries:()=>DS,addEventEntries:()=>CS,addEventEntryPairs:()=>mA,destroyPairEntries:()=>YS,destroyPairEntry:()=>zS,modifyEntriesStatus:()=>hv,modifyEventEntries:()=>fA,promoteAlternate:()=>sA,promoteAlternates:()=>cA,removeDrawEntries:()=>lA,removeEventEntries:()=>NS,setEntryPosition:()=>aA,setEntryPositions:()=>oA});var hA={};Br(hA,{addDrawDefinition:()=>qA,addEvent:()=>yA,addFlight:()=>eC,assignSeedPositions:()=>HA,attachFlightProfile:()=>zA,categoryCanContain:()=>vu,deleteDrawDefinitions:()=>NA,deleteEvents:()=>QA,deleteFlightAndFlightDraw:()=>GA,deleteFlightProfileAndFlightDraws:()=>EA,generate:()=>gA,generateEventsFromTieFormat:()=>vA,getCategoryAgeDetails:()=>Iu,getEvent:()=>zR,getEventProperties:()=>qR,getEventStructures:()=>jb,getEventTimeItem:()=>_h,getEvents:()=>HR,getFlightProfile:()=>py,getScaledEntries:()=>zE,modifyEvent:()=>JA,modifyEventMatchUpFormatTiming:()=>CA,modifyPairAssignment:()=>WA,mutate:()=>SA,query:()=>WR,refreshEventDrawOrder:()=>jA,removeEventMatchUpFormatTiming:()=>kA,removeScaleValues:()=>YA,removeSeeding:()=>XA,setEventDates:()=>BA,setEventDisplay:()=>KA,setEventEndDate:()=>LA,setEventStartDate:()=>_A,updateDrawIdsOrder:()=>VA,validateCategory:()=>yu});var gA={};Br(gA,{generateEventsFromTieFormat:()=>vA});var IA={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:Wu,DOMINANT_DUO_MIXED:_u,LAVER_CUP:Ku,TEAM_DOUBLES_3_AGGREGATION:Cu,TIME_TENNIS_DUAL:Lu,TIME_TENNIS_PRO_CIRCUIT:Fu,USTA_BREWER_CUP:Bu,USTA_OZAKI_CUP:$u,USTA_COLLEGE:qu,USTA_GOLD_TEAM_CHALLENGE:Au,USTA_INTERSECTIONAL:Ou,USTA_LEVEL_1:Hu,USTA_SECTION_BATTLE:xu,USTA_SOUTHERN_LEVEL_5:ku,USTA_TOC:Xu,USTA_WTT_ITT:zu,USTA_ZONAL:Yu};function yA({suppressNotifications:e,tournamentRecord:t,internalUse:r,event:i}){if(!t)return{error:Ji};if(t.events||(t.events=[]),!i)return{error:jn};let{startDate:n,endDate:a}=t;if(!r&&(i.entries?.length||i.drawDefinitions?.length)){let e=nc({drawDefinitions:!!i.drawDefinitions?.length,entries:!!i.entries?.length});return{info:"entries/drawDefinitions cannot exist",error:Zo,context:e}}let o={eventType:Ul,drawDefinitions:[],entries:[],startDate:n,endDate:a,...i};if(i.eventType===Pl)if(i.tieFormat){let e=bu({tieFormat:i.tieFormat});if(e.error)return e}else if(i.tieFormatName){if(!IA[i.tieFormatName])return{context:{tieFormatName:i.tieFormatName},error:Zo};let e=Sl({isMock:t?.isMock,namedFormat:i.tieFormatName,event:i});o.tieFormat=e}if(o.eventId||(o.eventId=Ru()),t.events.reduce((e,t)=>e||t.eventId===o.eventId,void 0))return{error:Wn};{let r=o;if(t.events.push(r),!e){let{topics:e}=Ws();if(e.includes(Mf)){let e=xy({event:i}).matchUps??[];oh({tournamentId:t?.tournamentId,eventId:i.eventId,matchUps:e})}let{drawDefinitions:r,...n}=i;for(let t of r||[])uh({drawDefinition:t});!function({tournamentId:e,event:t}){t&&Bs({payload:{tournamentId:e,event:t},key:t.eventId,topic:Cf})}({tournamentId:t?.tournamentId,event:n})}return{...Gi,event:o}}}function vA(e){let t=Dp(e,[{[bp]:{[Xd]:!0,[Od]:!0}},{[Cd]:!0}]);if(t.error)return t;let r=e.tieFormat||Sl({namedFormat:e.tieFormatName}),i=e.uuids||[Mu(r.collectionDefinitions.length)],n={[uc]:[],[oc]:[]};if(e.addEntriesFromTeams){let t=e.tournamentRecord.participants?.filter(e=>e.participantType===Uh)?.flatMap(e=>e.individualParticipantIds??[]);for(let r of e.tournamentRecord.participants??[])if(t?.includes(r.participantId)){let e=r.person?.sex;if(e&&gc(e)){let t=hc(e);t&&n[t].push(r.participantId)}}}let a=[];for(let o of r.collectionDefinitions??[]){let t=i?.pop()?.toString()||Ru(),r=o.matchUpType,s=o.gender,c={matchUpFormat:o.matchUpFormat,eventName:o.collectionName,category:o.category,gender:s,eventType:r,eventId:t};if(e.addEntriesFromTeams){let t=r===Tl?gg:e.entryStatus||ug,i=mc(s)?[...n[uc],...n[oc]]:n[hc(s)||sc]??[];if(i.length){let e=CS({participantIds:i,entryStatus:t,event:c});if(e.error)return e}}if(a.push(c),!1!==e.addEvents){let t=yA({internalUse:!0,tournamentRecord:e.tournamentRecord,event:c});if(t.error)return t}}return{...Gi,events:a}}var SA={};function bA({removePriorValues:e=!0,status:t=DI,statusObject:r,event:i}){if(!ti(r))return{error:Zo};let n=iS({event:i,status:t}),a=`${TI}.${PI}`;return Qw({timeItem:{itemValue:{[t]:{...n,...r}},itemType:a},removePriorValues:e,event:i})}function UA(e){let t=Dp(e,[{[Cd]:!0,[cp]:!0},{eventDataParams:!1,[vp]:fp}]);if(t.error)return t;let{includePositionAssignments:r,removePriorValues:i,tournamentRecord:n,status:a=DI,event:o,drawIdsToRemove:s,drawIdsToAdd:c}=e,{appliedPolicies:u}=zh({tournamentRecord:n,event:o}),l={...u,...e.policyDefinitions},d=o?.drawDefinitions?.map(({drawId:e})=>e)??[],p=e.drawDetails?Object.keys(e.drawDetails):[],m=p.length?[]:e.drawIds,f=(c??[]).concat(...s??[],...m??[],...p),h=f.filter(e=>!d.includes(e));if(h.length)return ac({result:{error:an},context:{invalidDrawIds:h}});let g=iS({event:o,status:a}),I=Object.keys(g?.drawDetails||{}).filter(e=>d.includes(e)).reduce((e,t)=>(e[t]=g.drawDetails[t],e),{});for(let b of d)if((!f.length||f.includes(b))&&(s?.includes(b)||m?.length&&!m.includes(b)?I[b]={...I[b],publishingDetail:{published:!1}}:(c?.includes(b)||m?.includes(b)||!m?.length)&&(I[b]={...I[b],publishingDetail:{published:!0}})),e.drawDetails?.[b]){let t=e.drawDetails[b],r=t.structureDetails??I[b].structureDetails,i=t.stageDetails??I[b].stageDetails??{},{structureIdsToRemove:n=[],structureIdsToAdd:a=[],publishingDetail:s={},stagesToRemove:c=[],stagesToAdd:u=[]}=t;if((a||u)&&(s.published=!0),I[b]={publishingDetail:s,structureDetails:r,stageDetails:i},a.length||n.length){let e=(o?.drawDefinitions?.find(e=>e.drawId===b)?.structures??[]).map(({structureId:e})=>e),t=(a??[]).concat(n??[]).filter(t=>!e.includes(t));if(t.length)return ac({result:{error:Fn},context:{invalidStructureIds:t}});r=r??{};for(let i of e)n.includes(i)?r[i]={published:!1}:r[i]={published:!0};I[b].structureDetails=r}let l=(o?.drawDefinitions?.find(e=>e.drawId===b)?.structures??[]).map(({stage:e})=>e);if(u.length){for(let e of u)i[e]={published:!0};for(let e of l)i[e]||(i[e]={published:!1})}if(u.length||c.length){for(let e of c)i[e]={published:!1};for(let e of l)i[e]||(i[e]={published:!0})}(u.length||c.length)&&(I[b].stageDetails=i)}bA({statusObject:{drawDetails:I},removePriorValues:i,status:a,event:o});let{topics:y}=Ws(),v=y.includes(Xf),S=v||e.returnEventData?xT({includePositionAssignments:r,...e.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:l,event:o})?.eventData:void 0;return v&&Bs({payload:{eventData:S,tournamentId:n.tournamentId},topic:Xf}),{...Gi,eventData:S}}Br(SA,{addDrawDefinition:()=>qA,addEvent:()=>yA,addFlight:()=>eC,assignSeedPositions:()=>HA,attachFlightProfile:()=>zA,deleteDrawDefinitions:()=>NA,deleteEvents:()=>QA,deleteFlightAndFlightDraw:()=>GA,deleteFlightProfileAndFlightDraws:()=>EA,modifyEvent:()=>JA,modifyEventMatchUpFormatTiming:()=>CA,modifyPairAssignment:()=>WA,refreshEventDrawOrder:()=>jA,removeEventMatchUpFormatTiming:()=>kA,removeScaleValues:()=>YA,removeSeeding:()=>XA,setEventDates:()=>BA,setEventDisplay:()=>KA,setEventEndDate:()=>LA,setEventStartDate:()=>_A,updateDrawIdsOrder:()=>VA,validateCategory:()=>yu});var wA="deleteDrawDefinitions",TA="autoSchedulingAudit",DA="deleteEvents",PA={AUTO_SCHEDULING_AUDIT:TA,DELETE_EVENTS:DA,DELETE_DRAW_DEFINITIONS:wA};function NA(e){if(!e.tournamentRecord)return{error:Ji};let t="deleteDrawDefinitions",r=e.drawIds??[],i=e.event,{autoPublish:n=!0,tournamentRecord:a,auditData:o,eventId:s,force:c}=e,{appliedPolicies:u}=zh({tournamentRecord:a,event:i}),l={...u,...e.policyDefinitions},d=Array.isArray(r)?r[0]:void 0;if(!i){let e=my({tournamentRecord:a,eventId:s,drawId:d});if(e.error)return e;i=e.event}let p=[],m=[],f=[];if(!i?.drawDefinitions)return ac({info:"event has no drawDefinition",result:{...Gi},stack:t});let h=i.drawDefinitions.map(({drawId:e})=>e);if(r.length||(r=h),r=r.filter(e=>h.includes(e)),!r.length)return ac({info:"nothing to do; no matching drawIds in event.",result:{...Gi},stack:t});let g,I=Nu(py({event:i}).flightProfile,!1,!0),y=({participantId:e,drawPosition:t,qualifier:r,bye:i})=>({bye:i,qualifier:r,drawPosition:t,participantId:e}),v=c??u?.[Hp]?.allowDeletionWithScoresPresent?.drawDefinitions,S=iS({event:i})??{},b=S.drawIds??(S.drawDetails&&Object.keys(S.drawDetails))??[],U=[],w=i.drawDefinitions.filter(e=>{if(r.includes(e.drawId)){let t=Ly({event:i,drawDefinition:e})?.matchUps??[];if(t.some(({score:e})=>qy({score:e}))&&!v)return U.push(e.drawId),!0;let{drawId:r,drawType:n,drawName:c}=e,u=I?.flights?.find(t=>t.drawId===e.drawId);u&&(u.drawEntries=u.drawEntries?.filter(e=>wg.includes(e.entryStatus))),b.includes(r)&&(b=b.filter(e=>e!==r),g=!0);let l=Tf({stageSequence:1,drawDefinition:e,stage:El})?.structures?.[0],d=(l?ST({structureId:l.structureId,tournamentRecord:a,drawDefinition:e}):void 0)?.positionAssignments?.map(y),h=Tf({stage:Ml,drawDefinition:e})?.structures,S=h?.length?h.map(t=>{let r=t.stageSequence;return{positionAssignments:ST({structureId:t.structureId,tournamentRecord:a,drawDefinition:e})?.positionAssignments.map(y),stageSequence:r}}):void 0,w={action:wA,payload:{drawDefinitions:[e],eventId:s??i?.eventId,auditData:o}};f.push(w),p.push(nc({tournamentId:a.tournamentId,eventId:s??i?.eventId,qualifyingPositionAssignments:S,positionAssignments:d,auditData:o,drawType:n,drawName:c,drawId:r})),t?.forEach(({matchUpId:e})=>m.push(e))}return!r.includes(e.drawId)});if(U.length&&!c)return ac({context:{drawIdsWithScoresPresent:U},result:{error:hs},stack:t});if(i.drawDefinitions=w,I&&im({event:i,extension:{name:Sm,value:I}}),KM({tournamentRecord:a}),g){let e={};for(let r of b)e[r]=S.drawDetails?.[r]??{published:!0};let t=bA({statusObject:{drawDetails:e},event:i});if(t.error)return{error:t.error}}if(f.length)if(qs(xf)){let e=a.tournamentId;Bs({topic:xf,payload:{tournamentId:e,detail:f}});let t=(Oh({element:i,itemType:ym})?.timeItem?.itemValue||0)+1;Yw({element:i,timeItem:{itemType:ym,itemValue:t},removePriorValues:!0})}else!function({appliedPolicies:e,event:t,deletedDrawsDetail:r,auditData:i}){if(!1===e?.audit?.[ym])return;let{extension:n}=lm({name:ym,element:t}),a={...i,deletedDrawsDetail:r},o={value:Array.isArray(n?.value)?n?.value.concat(a):[a],name:ym};em({element:t,extension:o})}({appliedPolicies:u,event:i,deletedDrawsDetail:p,auditData:o});if(m.length&&sh({tournamentId:a?.tournamentId,matchUpIds:m}),r.forEach(e=>function({tournamentId:e,eventId:t,drawId:r}){return Bs({payload:{drawId:r,tournamentId:e,eventId:t},topic:Lf,key:r}),js({key:r}),{...Gi}}({drawId:e})),n&&g){let t=UA({...e.eventDataParams,drawIdsToRemove:r,policyDefinitions:l,tournamentRecord:a,event:i});if(t.error)return{...Gi,info:t.error}}return{...Gi}}function EA({autoPublish:e=!0,tournamentRecord:t,auditData:r,event:i,force:n}){if(!t)return{error:Ji};if(!i)return{error:jn};let{flightProfile:a}=py({event:i});if(a){let o=a.flights?.map(({drawId:e})=>e).filter(Boolean),s=NA({eventId:i.eventId,tournamentRecord:t,autoPublish:e,auditData:r,drawIds:o,event:i,force:n});return s.error?s:sm({event:i,name:Sm})}return{...Gi}}function MA(e){let{matchUpFormat:t,recoveryTimes:r,averageTimes:i,tournamentId:n,eventId:a}=e,o=e?.tournamentRecords??(e?.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Qi};let s,c=Object.keys(o).filter(e=>!n||n===e);if(n&&!c.includes(n))return{error:Zo};for(let u of c){let e=o[u],{event:n}=my({tournamentRecord:e,eventId:a});a&&n&&(s=!0);let c=RA({tournamentRecord:e,event:n,matchUpFormat:t,averageTimes:i,recoveryTimes:r});if(c.error)return c}return!a||s?{...Gi}:{error:Gn}}function RA({tournamentRecord:e,recoveryTimes:t,matchUpFormat:r,averageTimes:i,event:n}){if(!e)return{error:Ji};if(i&&!Array.isArray(i))return{error:Zo};if(t&&!Array.isArray(t))return{error:Zo};let a=Mm;if(n){let{extension:e}=lm({element:n,name:a});em({element:n,extension:{name:a,value:AA({...e?.value||{},matchUpFormat:r,averageTimes:i,recoveryTimes:t})}})}else{let{extension:n}=lm({element:e,name:a});em({extension:{name:a,value:AA({...n?.value||{},matchUpFormat:r,averageTimes:i,recoveryTimes:t})},element:e})}return{...Gi}}function AA(e){let{matchUpRecoveryTimes:t=[],matchUpAverageTimes:r=[],matchUpFormat:i}=e,{averageTimes:n,recoveryTimes:a}=e;n=(n||[]).filter(e=>e?.categoryNames?.length||e?.categoryTypes?.length);let o=n?.length&&r.map(e=>e?.matchUpFormatCodes.includes(i)?{...e,matchUpFormatCodes:e.matchUpFormatCodes?.filter(e=>e!==i)}:e).filter(({matchUpFormatCodes:e})=>e?.length).concat({matchUpFormatCodes:[i],averageTimes:n});a=(a||[]).filter(e=>e?.categoryNames?.length||e?.categoryTypes?.length);let s=a?.length&&t.map(e=>e?.matchUpFormatCodes.includes(i)?{...e,matchUpFormatCodes:e.matchUpFormatCodes?.filter(e=>e!==i)}:e).filter(({matchUpFormatCodes:e,averageTimes:t})=>e?.length||t).concat({matchUpFormatCodes:[i],recoveryTimes:a});return{matchUpAverageTimes:o?.length&&o||r,matchUpRecoveryTimes:s?.length&&s||t}}function CA(e){let{tournamentRecord:t,recoveryMinutes:r,averageMinutes:i,matchUpFormat:n,categoryType:a,eventId:o,event:s}=e;if(!t)return{error:Ji};if(!_c({matchUpFormat:n}))return{error:Zo};if(!s)return{error:jn};let{averageTimes:c=[],recoveryTimes:u=[]}=gR({tournamentRecord:t,matchUpFormat:n,event:s}),l=s.category,d=l?.categoryName||l?.ageCategoryCode||s?.eventId,p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},f=e=>{if(e.categoryTypes?.includes(a)&&console.log("encountered:",{categoryType:a}),!e.categoryNames?.includes(d)||(e.categoryNames=e.categoryNames.filter(e=>e!==d),p={minutes:e.minutes,categoryNames:[d]},e.categoryNames.length))return e},h=i&&!isNaN(Jr(i)),g=r&&!isNaN(Jr(r)),I=c.map(f).filter(e=>e?.categoryNames?.length),y=u.map(f).filter(e=>e?.categoryNames?.length);return h&&(Object.assign(p.minutes,{[s?.eventType||Wr]:i}),I.push(p)),g&&(Object.assign(m.minutes,{[s?.eventType||Wr]:r}),y.push(m)),h||g?MA({averageTimes:h&&I,recoveryTimes:g&&y,tournamentRecord:t,matchUpFormat:n,eventId:o}):{error:Zo}}function kA(e){if(e.event)return xA({event:e.event});{e.tournamentRecord&&!e.tournamentRecords&&(e.tournamentRecords={[e.tournamentRecord.tournamentId]:e.tournamentRecord});let t=Dp(e,[{[Rd]:!0,[np]:!0}]);if(t.error)return t;let{tournamentRecords:r,eventId:i}=e;for(let e of Object.values(r??{})){let{event:t}=my({tournamentRecord:e,eventId:i});if(t)return xA({event:t})}}return{error:Gn}}function xA({event:e}){return sm({event:e,name:Mm})}var OA={MON:"MON",TUE:"TUE",WED:"WED",THU:"THU",FRI:"FRI",SAT:"SAT",SUN:"SUN"};function FA(e){return!(!Array.isArray(e)||vi(e).length!==e.length)&&e.every(e=>Object.keys(OA).includes(e))}function _A({tournamentRecord:e,event:t,startDate:r}){if(!e)return{error:Ji};if(!t)return{error:jn};if(!$c.test(r))return{error:Ca};let i=$A(e),n="setEventStartDate";if(i.error)return ac({result:i,stack:n});let{tournamentStartDate:a,tournamentEndDate:o}=i,s=new Date(iu(r)).getTime();if(!a||!o||s<a||s>o)return ac({result:{error:Ca},stack:n,info:"startDate must be within tournament start and end dates"});let c=t.endDate&&new Date(iu(t.endDate)).getTime();return c&&s>c&&(t.endDate=r),t.startDate=r,{...Gi}}function LA(e){let{tournamentRecord:t,event:r,endDate:i}=e;if(!t)return{error:Ji};if(!r)return{error:jn};if(!$c.test(i))return{error:Ca};let n=$A(t);if(n.error)return n;let{tournamentStartDate:a,tournamentEndDate:o}=n,s=new Date(iu(i)).getTime();if(!a||!o||s<a||s>o)return{error:Ca};let c=r.startDate&&new Date(iu(r.startDate)).getTime();return c&&s<c&&(r.startDate=i),r.endDate=i,{...Gi}}function BA(e){let t="setEventDates",r=Dp(e,[{tournamentRecord:!0,event:!0},{[gp]:e=>$c.test(e),[yp]:Ca,startDate:!1,endDate:!1},{[gp]:e=>e.filter(Boolean).every(e=>$c.test(e)),[yp]:Ca,activeDates:!1},{[gp]:FA,weekdays:!1}]);if(r.error)return r;let{tournamentRecord:i,weekdays:n,event:a,startDate:o,endDate:s}=e,c=e.activeDates?.filter(Boolean);if(o&&s){if(new Date(iu(o)).getTime()>new Date(iu(s)).getTime())return ac({result:{error:Zo},stack:t,info:"startDate cannot be after endDate"})}if(c){let e=o||i.startDate,r=s||i.endDate,n=!e||c.every(t=>new Date(t)>=new Date(e)),a=!r||c.every(e=>new Date(e)<=new Date(r));if(!n||!a)return ac({result:{error:Ca},stack:t})}if(o){let e=_A({tournamentRecord:i,event:a,startDate:o});if(e.error)return ac({result:e,stack:t})}if(s){let e=LA({tournamentRecord:i,event:a,endDate:s});if(e.error)return ac({result:e,stack:t})}return c&&(a.activeDates=c),n&&(a.weekdays=n),{...Gi}}function $A(e){let{startDate:t,endDate:r}=e;return $c.test(t)&&$c.test(r)?{tournamentStartDate:new Date(iu(t)).getTime(),tournamentEndDate:new Date(iu(r)).getTime()}:ac({result:{error:xa},context:{startDate:t,endDate:r}})}function VA({event:e,orderedDrawIdsMap:t}){if("object"!=typeof e)return{error:jn};if(!t)return{error:Da,info:"Missing drawIdsOrderMap"};if("object"!=typeof t)return{error:Zo,info:"orderedDrawIdsMap must be an object"};let r=Object.values(t);if(!r.every(e=>!Number.isNaN(Number(e))))return{error:Zo,info:"drawOrder must be numeric"};if(vi(r).length!==r.length)return{info:"drawOrder values must be unique",error:Zo};if(e.drawDefinitions?.length){let r=(e.drawDefinitions||[]).map(({drawId:e})=>e),i=Object.keys(t);if(i?.length&&Ci(r,i).length!==r.length)return{error:Zo,info:"Missing drawIds"};e.drawDefinitions.forEach(e=>{e.drawOrder=t[e.drawId]})}let{flightProfile:i}=py({event:e});return i?.flights?.forEach(e=>{e.flightNumber=t[e.drawId]}),{...Gi}}function jA({tournamentRecord:e,event:t}){if(!e)return{error:Ji};if(!t)return{error:jn};let{flightProfile:r}=py({event:t}),i=r?.flights?.sort((e,t)=>e.flightNumber-t.flightNumber).map(e=>e.drawId).filter(Boolean),n=t.drawDefinitions?.sort((e,t)=>e.drawOrder-t.drawOrder).map(e=>e.drawId).filter(Boolean).filter(e=>!i?.includes(e)),a=Object.assign({},...[...i||[],...n||[]].map((e,t)=>({[e]:t+1})));return a?VA({event:t,orderedDrawIdsMap:a}):{...Gi}}function GA({autoPublish:e=!0,tournamentRecord:t,auditData:r,drawId:i,event:n,force:a}){if(!t)return{error:Ji};if(!i)return{error:wn};if(!n)return{error:jn};let{flightProfile:o}=py({event:n});if(o&&o.flights?.find(e=>e.drawId===i)){let e=o.flights.filter(e=>e.drawId!==i);im({event:n,extension:{name:Sm,value:{...o,flights:e}}})}if(n.drawDefinitions?.find(e=>e.drawId===i)){let o=NA({drawIds:[i],eventId:n.eventId,tournamentRecord:t,autoPublish:e,auditData:r,event:n,force:a});if(o.error)return o}return jA({tournamentRecord:t,event:n})}function WA(e){let t=Dp(e,[{[cp]:!0,[Cd]:!0,[lp]:!1},{replacementIndividualParticipantId:!0,[gp]:e=>ei(e),existingIndividualParticipantId:!0,[sp]:Za,participantId:!0}]),{replacementIndividualParticipantId:r,existingIndividualParticipantId:i,tournamentRecord:n,drawDefinition:a,participantId:o,event:s,uuids:c}=e;if(t.error)return t;if(s?.eventType!==wl)return{error:Vn};if(!(s?.entries?.filter(({entryStatus:e})=>[gg,Ig].includes(e)).map(({participantId:e})=>e)||[]).includes(r))return{error:Ha};let u=(n.participants||[]).find(e=>e.participantId===o);if(u?.participantType!==Dh)return{error:qa,participant:u};let l,d=u.individualParticipantIds,p=[r,...d.filter(e=>e!==i)],{participant:m}=gy({participantIds:p,tournamentRecord:n});if(m)l=m.participantId;else{let e=dA({participant:{participantId:c?.pop(),participantRole:xS,individualParticipantIds:p,participantType:Dh},returnParticipant:!0,tournamentRecord:n});if(e.error)return e;l=e.participant.participantId}let{flightProfile:f}=py({event:s});if(a){let e=f?.flights?.find(({drawId:e})=>e===a.drawId);e&&(e.drawEntries=e.drawEntries.map(e=>e.participantId===o?{...e,participantId:l}:e)),a.entries=a.entries.map(e=>e.participantId===o?{...e,participantId:l}:e);for(let t of a.structures||[])if(t.structures){t.positionAssignments=void 0;for(let e of t.structures)e.positionAssignments=e.positionAssignments.map(e=>e.participantId===o?{...e,participantId:l}:e)}else t.positionAssignments&&(t.positionAssignments=t.positionAssignments.map(e=>e.participantId===o?{...e,participantId:l}:e))}s.entries=s.entries.map(e=>e.participantId===o&&{...e,participantId:l}||e.participantId===r&&{...e,participantId:i}||e);let h=n.events.some(({entries:e,eventId:t,drawDefinitions:r})=>s.eventId===t?r.some(({drawId:e,entries:t})=>e!==a?.drawId&&t?.find(e=>e.participantId===o)):e?.find(e=>e.participantId===o));if(!h){let e=WS({addIndividualParticipantsToEvents:!1,participantIds:[o],tournamentRecord:n});if(e.error)return e}return{...Gi,participantOtherEntries:h,newPairParticipantId:l}}function qA(e){let{flight:t,suppressNotifications:r,modifyEventEntries:i,existingDrawCount:n,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:c,event:u}=e;if(!c)return{error:rn};if(!u)return{error:jn};u.drawDefinitions||(u.drawDefinitions=[]);let{drawId:l,drawName:d,entries:p}=c,{entries:m}=u,f=0;if(void 0!==n&&n!==u.drawDefinitions.length)return{error:Zo,info:"drawDefintions count mismatch"};let{flightProfile:h}=py({event:u}),g=t&&h?.flights?.find(e=>e.flightNumber===t.flightNumber),I=h?.links?.find(e=>e?.target?.drawId===l)?.source?.drawId;if(I&&!u.drawDefinitions.find(e=>e.drawId===I))return ac({result:{error:rn},info:{sourceDrawId:I}});if(g&&g.drawId!==c.drawId)return ac({result:{error:tn},info:{relevantFlight:g}});let y=p?.every(({participantId:e,entryStatus:t})=>{let r=g?.drawEntries.find(t=>t.participantId===e);return!t||r?.entryStatus===t}),v=!o||m&&p?.every(({participantId:e,entryStatus:t,entryStage:r})=>m.find(t=>t.participantId===e&&(!t.entryStage||t.entryStage===r))?.entryStatus===t);if(g&&!y)return ac({result:{error:tn},context:{drawEntriesPresentInFlight:y,matchingEventEntries:v,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(i&&p?.filter(Boolean).forEach(e=>{if(e?.entryStatus&&wg.includes(e?.entryStatus)){let t=m?.filter(Boolean).find(t=>t.participantId===e.participantId);t&&e.entryStatus&&t?.entryStatus!==e.entryStatus&&(t.entryStatus=e.entryStatus,f+=1)}}),m&&!v)return ac({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:v,eventEntries:m},error:tn}});let S,b=h?.flights?.map(({flightNumber:e})=>!isNaN(e)&&Jr(e))?.filter(Boolean)||[],U=u.drawDefinitions.map(({drawOrder:e})=>e&&Jr(e))?.filter(Boolean)||[],w=Math.max(0,...U,...b)+1,T=h?.flights?.find(e=>e.drawId===l);if(T){T.drawName=c.drawName,S={name:Sm,value:{...h,flights:h.flights}};let e=T.flightNumber;e&&!U.includes(e)?w=e:T.flightNumber=w}else{let e=h?.flights||[];e.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:l}),S={name:Sm,value:{...h||{},flights:e}}}im({event:u,extension:S}),Object.assign(c,{drawOrder:w});let D=u.drawDefinitions.find(e=>e.drawId===l),P=s?.tournamentId,N=u.eventId;if(D){if(!a)return{error:Tn};let e=Ly({drawDefinition:D})?.matchUps?.map(zm)??[],t=Ly({drawDefinition:c})?.matchUps;if(!r){e?.length&&sh({matchUpIds:e,action:"modifyDrawDefinition",tournamentId:P,eventId:N}),t?.length&&oh({matchUps:t,tournamentId:P,eventId:N}),u.drawDefinitions=u.drawDefinitions.map(e=>e.drawId===l?c:e);let r=c.structures?.map(({structureId:e})=>e);lh({drawDefinition:c,tournamentId:P,structureIds:r,eventId:N})}}else if(u.drawDefinitions.push(c),!r){let{matchUps:e}=Ly({drawDefinition:c,event:u});e&&oh({tournamentId:s?.tournamentId,matchUps:e}),uh({drawDefinition:c,tournamentId:P,eventId:N})}return{...Gi,modifiedEventEntryStatusCount:f}}function HA(e){let{provisionalPositioning:t,useExistingSeedLimit:r,tournamentRecord:i,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:c,event:u}=e,l=0;if(!s?.length)return{error:zn};if(!i)return{error:Ji};if(!c)return{error:wn};let d=Mg({provisionalPositioning:t,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,f=Object.assign({},...(p??[]).filter(e=>e.seedNumber).map(e=>({[e.seedNumber]:e})));s.forEach(e=>{let{seedNumber:t}=e;m&&t<=m&&(!r||f[t])&&(f[t]=e)});let h=Object.values(f),g=h.map(e=>e?.participantId).filter(Boolean);if(g.length!==Ni(g).length)return{error:Dn};for(let I of h){let e=vb({...I,provisionalPositioning:t,tournamentRecord:i,drawDefinition:n,seedingProfile:a,structureId:o,event:u});if(e?.error)return e;e?.success&&l++}return l?{...Gi,modifications:l}:{error:qo}}function zA({deleteExisting:e,event:t,flightProfile:r}){let i="attachFlightProfile";if(!r)return ac({result:{error:Da},stack:i});if(!t)return ac({result:{error:jn},stack:i});let{flightProfile:n}=py({event:t});return n&&!e?ac({result:{error:cs},stack:i}):t.drawDefinitions?.length?ac({result:{error:nn},stack:i}):(im({event:t,extension:{name:Sm,value:r}}),{flightProfile:Nu(r,!1,!0),...Gi})}function YA({tournamentRecord:e,scaleAttributes:t,drawDefinition:r,entryStatuses:i,drawId:n,event:a,stage:o}){if(!a)return{error:jn};if(i&&!Array.isArray(i))return ac({result:{error:Zo},info:Eb("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(n){let{flightProfile:e}=py({event:a}),t=e?.flights?.find(e=>e.drawId===n);s=t?t.drawEntries:r?.entries}return function({tournamentRecord:e,scaleAttributes:t,participantIds:r}){if(!e)return{error:Ji};if(!r)return{error:no};if(!t)return{error:Da,info:"scaleAttributes required"};let{scaleType:i,eventType:n,scaleName:a}=t,o=[SI,i,n,a].join(".");return e.participants?.forEach(e=>{r.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter(e=>e&&e?.itemType!==o))}),{...Gi}}({tournamentRecord:e,scaleAttributes:t,participantIds:(s||[]).filter(e=>(!o||!e.entryStage||e.entryStage===o)&&(!i||i.includes(e.entryStatus))).map(Hm)})}function KA({removePriorValues:e,tournamentRecord:t,displaySettings:r,status:i=DI,event:n}){if(!t)return ac({result:{error:Ji}});if(!n)return ac({result:{error:jn}});if(!ti(r))return ac({result:{error:Da}});if(ti(r.draws))for(let o of Object.keys(r.draws)){let e=r.draws[o].scheduleDetails??[];if(e.length){let t=[];for(let r of e){let e=t.find(e=>ri(e.attributes,r.attributes));e?.dates&&r.dates?e.dates.push(...r.dates):t.push(r)}r.draws[o].scheduleDetails=t}}let a=bA({statusObject:{displaySettings:r},removePriorValues:e,status:i,event:n});return a.error?a:{...Gi}}function XA({tournamentRecord:e,drawDefinition:t,entryStatuses:r,scaleName:i,drawId:n,event:a,stage:o}){if(!e)return{error:Ji};if(!a)return{error:jn};return i=i||a.category?.categoryName||a.category?.ageCategoryCode,YA({tournamentRecord:e,scaleAttributes:{eventType:a.eventType,scaleType:Ap,scaleName:i},drawDefinition:t,entryStatuses:r,drawId:n,event:a,stage:o})}function QA(e){let t=Dp(e,[{[Cd]:!0},{eventIds:!0,[vp]:hp}]);if(t.error)return t;let{removePairParticipants:r,tournamentRecord:i,eventIds:n}=e,a=[],o=[],s=[],c=[];if(i.events=(i.events||[]).filter(e=>{if(n.includes(e.eventId)){let t={action:DA,payload:{events:[e]}};a.push(t),o.push({tournamentId:i.tournamentId,eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}let t=e.eventType===wl?(e.entries||[]).map(({entryStatus:e,participantId:t})=>e!==gg&&t).filter(Boolean):[],r=n.includes(e.eventId);return r?c.push(...t):s.push(...t),!r}),r){let e=c.filter(e=>!s.includes(e));i.participants=i.participants.filter(({participantId:t})=>!e.includes(t))}if(KM({tournamentRecord:i}),a.length)if(qs(xf)){let e=i.tournamentId;Bs({topic:xf,payload:{type:DA,tournamentId:e,detail:a}})}else Xw({tournamentRecord:i,timeItem:{itemValue:o,itemType:DA}});return{...Gi}}function JA(e){let t=Dp(e,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:fp}]);if(t.error)return t;let{eventUpdates:r,event:i}=e,n="modifyEvent",a=function(e){let{tournamentRecord:t,event:r}=e,i=r?.entries?.filter(({entryStatus:e})=>{let t=e;return[...wg,sg].includes(t)}).map(({participantId:e})=>e)??[];return i?mS({participantFilters:{participantIds:i},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[]}(e),o=function({enteredParticipants:e}){let t=[],r=e.reduce((e,r)=>{let i=r.person?.sex?[r.person.sex]:r.individualParticpants?.map(e=>e.person?.sex)||[];return t.push(...i),e.includes(r.participantType)?e:e.concat(r.participantType)},[]),i=vi(t);return{enteredParticipantTypes:r,enteredParticipantGenders:i}}({enteredParticipants:a}),{enteredParticipantGenders:s,enteredParticipantTypes:c}=o,u=py({event:i})?.flightProfile?.flights,l=function({noFlightsNoDraws:e,enteredParticipantGenders:t,eventUpdates:r,stack:i}){let n=!t.length||!r.gender||fc(r.gender)||1===t.length&&t[0]===r.gender||e&&mc(r.gender);return r.gender&&!n?ac({context:{gender:r.gender,validGender:n},result:{error:Qo},stack:i}):{...Gi}}({noFlightsNoDraws:!i.drawDefinitions?.length&&!u?.length,enteredParticipantGenders:s,eventUpdates:r,stack:n});if(l.error)return l;let d=function({enteredParticipantTypes:e,eventUpdates:t,stack:r}){let i=(e.includes(Dl)&&[Dl]||e.includes(wh)&&[bl]||e.includes(Dh)&&[wl]||[wl,bl,Dl]).includes(t.eventType??"");return t.eventType&&!i?ac({context:{participantType:t.eventType,validEventType:i},result:{error:Vn},stack:r}):{...Gi}}({enteredParticipantTypes:c,eventUpdates:r,stack:n});if(d.error)return d;let p=function(e){let t=e.eventUpdates?.category;if(!t)return{...Gi};let r=yu({category:t});if(r.error)return r;if(e.event.eventType===Dl){let t=function(e){let t=e.event?.drawDefinitions?.map(e=>Rg(e))??[],r=Rg(e.event),i=(xy(e)?.matchUps??[]).map(e=>Rg(e))??[];return[r,...t,...i].filter(Boolean).every(t=>t.collectionDefinitions.every(t=>!t.category||vu({category:e.eventUpdates.category,childCategory:t.category})))?{...Gi}:ac({result:{error:Jo},stack:e.stack})}(e);if(t.error)return t}if(e.enteredParticipants?.length){let r=function(e,t){let r=e.eventUpdates.startDate||e.event.startDate||e.tournamentRecord.startDate,i=e.eventUpdates.endDate||e.event.endDate||e.tournamentRecord.endDate,n=e.enteredParticipants.flatMap(e=>e.participantType===wh?[e]:e.individualParticpants??[]),a=Iu({category:t,consideredDate:r}),o=Iu({category:t,consideredDate:i});if(a?.ageMinDate||a?.ageMaxDate||o?.ageMinDate||o?.ageMaxDate)for(let s of n){let t=s.person?.birthDate;if(!t)return ac({result:{error:Pa},stack:e.stack});let r=new Date(t).getTime(),i=ZA(r,a,e.stack);if(i)return i;let n=ZA(r,o,e.stack);if(n)return n}return{...Gi}}(e,t);if(r.error)return r}return{...Gi}}({...e,...o,enteredParticipants:a,stack:n});if(p.error)return p;let m=function(e){let{tournamentRecord:t,eventUpdates:r,event:i,stack:n}=e;if(r.startDate||r.endDate){let e=BA({startDate:r.startDate||i.startDate||t.startDate,endDate:r.endDate||i.endDate||t.endDate,tournamentRecord:t,event:i});if(e.error)return ac({result:e,stack:n})}return{...Gi}}({...e,stack:n});return m.error?m:(r.eventType&&(i.eventType=r.eventType),r.eventName&&(i.eventName=r.eventName),r.gender&&(i.gender=r.gender),{...Gi})}function ZA(e,t,r){if(!t)return null;if(t.ageMinDate||t.ageMaxDate){let i=new Date(t.ageMinDate).getTime(),n=new Date(t.ageMaxDate).getTime();if(e<i||e>n)return ac({result:{error:Ga},stack:r})}return null}function eC({qualifyingPositions:e,drawEntries:t=[],drawName:r,drawId:i,event:n,stage:a}){let o="addFlight";if(!n)return ac({result:{error:jn},stack:o});if(!r)return ac({result:{error:Da},stack:o});if(t?.length){let e=(n.entries??[]).map(Hm),r=t.map(Hm);if(Ci(r,e).length!==r.length)return ac({result:{error:Zo},stack:o})}let s=py({event:n})?.flightProfile,c=s?.flights?.map(({flightNumber:e})=>!isNaN(e)&&Jr(e))?.filter(Boolean)||[],u=Math.max(0,...c)+1,l={drawId:i||Ru(),flightNumber:u,drawEntries:t,drawName:r};if(a&&(l.stage=a),e&&(l.qualifyingPositions=e),(s?.flights||[]).find(({drawId:e})=>e===l.drawId))return ac({result:{error:ss},stack:o});let d=(s?.flights||[]).concat(l);return im({event:n,extension:{name:Sm,value:{...s||{},flights:d}}})}var tC={};Br(tC,{drawMatic:()=>qE,garman:()=>IC,generateAdHocMatchUps:()=>jD,generateAdHocRounds:()=>GE,generateAndPopulatePlayoffStructures:()=>Hw,generateCourts:()=>gC,generateDrawDefinition:()=>QR,generateDrawMaticRound:()=>QD,generateDrawStructuresAndLinks:()=>AD,generateDrawTypeAndModifyDrawDefinition:()=>CD,generateFlightProfile:()=>aC,generateLineUps:()=>hC,generateQualifyingStructure:()=>uw,generateSeedingScaleItems:()=>tA,generateStatCrew:()=>cC,generateVoluntaryConsolation:()=>JD,roundRobinGroups:()=>ob});var rC="splitWaterfall",iC="splitShuttle",nC={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:rC,SPLIT_SHUTTLE:iC};function aC(e){let{drawNameRoot:t="Flight",attachFlightProfile:r,tournamentRecord:i,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:c=[],flightsCount:u,splitMethod:l,uuids:d=[],event:p,stage:m}=e;if(!p)return{error:jn};let f=p.entries??[],{flightProfile:h}=py({event:p});if(h&&r&&!o)return{error:cs};let g=e.scaledEntries??zE({tournamentRecord:i,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,I=new Set(g.map(Hm)),y=bi(f.filter(({participantId:e})=>!I.has(e)).filter(e=>(!m||!e.entryStage||e.entryStage===m)&&(!e.entryStatus||Ug.includes(e.entryStatus)))),v=g.concat(...y),S=v.length,b=_i(v,Math.ceil(S/u));function U(e){return(e||[]).map(({participantId:e,scaleValue:t})=>{let r=f.find(t=>t.participantId===e);return r?.scaleValue&&t&&(r.scaleValue=t),r}).sort((e,t)=>e.scaleValue-t.scaleValue).map((e,t)=>(e.scaleValue&&(e.seedNumber=t+1),e))}l===rC?b=Vi(v,u):l===iC&&(b=Vi(v,u,!0));let w={scaleAttributes:n,splitMethod:l,flights:Ri(0,u).map(e=>{let r=e+1;return{flightNumber:r,drawId:d?.pop()??Ru(),drawEntries:U(b[e]),drawName:c?.length&&c[e]||`${t} ${r}`}})};if(r){let e=zA({flightProfile:w,deleteExisting:o,event:p});return{splitEntries:Ps()&&b||void 0,...e}}return{flightProfile:w,...Gi}}function oC({json:e,tagName:t}){let r=Object.keys(e).filter(t=>Array.isArray(e[t])).map(t=>({key:t,value:e[t].filter(e=>"object"==typeof e&&1===Object.keys(e).length)})),i=Object.keys(e).filter(t=>"object"==typeof e[t]&&!Array.isArray(e[t])).map(t=>({key:t,value:e[t]}));return sC({tagName:t,attributes:Object.keys(e).filter(t=>["string","number"].includes(typeof e[t])).map(t=>({key:t,value:e[t]})),childArrays:r,childObjects:i})}function sC(e){let{tagName:t,attributes:r=[],childArrays:i=[],childObjects:n}=e,a="\r\n",o=e=>{let t=Object.keys(e)[0];return{key:t,value:e[t]}},s=i?.map(({key:e,value:t})=>sC({tagName:e,childObjects:t.map(o)})).join("\r\n"),c=n?.map(({key:e,value:t})=>oC({tagName:e,json:t??[]})).join("\r\n"),u=r?.map(({key:e,value:t})=>`${e}="${t}"`).join(" ");return"childArray"===t?c:`<${t}${u?` ${u}`:""}>${c?.length?`${a}${c}${a}`:""}${s?.length?`${a}${s}${a}`:""}</${t}>`}function cC(e){let t=Dp(e,[{[Cd]:!0}]);if(t.error)return t;let{tournamentRecord:r}=e,{startDate:i,tournamentId:n,tournamentName:a}=r,{participantMap:o,matchUps:s,mappedMatchUps:c}=mS({withMatchUps:!0,withEvents:!0,tournamentRecord:r}),u=r.participants.filter(e=>e.participantType===Ph),l=s?.filter(e=>e.matchUpType===Ph)??[],d=l?.reduce((e,t)=>{let r=t?.tieMatchUps??[];return r&&[...e,...r]},[])??[],p=s?.filter(e=>e.matchUpType===Wr)??[],m=s?.filter(e=>e.matchUpType===Hr)??[],f=d.length===p.length+m.length,h=1===l.length&&f,g={mappedMatchUps:c,participantMap:o,tournamentName:a,tournamentId:n,tournament:f?"N":"Y",startDate:i},I=[],y=[];if(h){let e=l[0],{json:t,xml:r}=uC({teamParticipants:u,teamMatchUp:e,...g,doubles:m,singles:p});y.push(t),I.push(r)}else for(let v of l){let e=v?.sides?.map(({participant:e})=>e?.participantId).filter(Boolean);if(2!==e?.length)continue;let t=e.map(e=>e&&o?.[e]?.participant),{xml:r,json:i}=uC({doubles:v.tieMatchUps?.filter(e=>e.matchUpType===Hr),singles:v.tieMatchUps?.filter(e=>e.matchUpType===Wr),teamParticipants:t,teamMatchUp:v,...g});y.push(i),I.push(r)}return{json:y,xml:I,...Gi}}function uC({teamParticipants:e,mappedMatchUps:t,participantMap:r,tournamentName:i,tournamentId:n,teamMatchUp:a,tournament:o,startDate:s,doubles:c,singles:u}){let l=e?.find(e=>e.participantRoleResponsibilities?.includes("Home")),d=e?.filter(e=>e.participantId!==l?.participantId),p=zc(s,"/","MDY"),m=l?.participantName||d?.[1]?.participantName,f=l?.participantId||d?.[1]?.participantId,h=d?.[0]?.participantName,g=d?.[0]?.participantId,I={},y=e.map(e=>({team:{...dC({teamParticipant:e,teamMatchUp:a,uniValues:I,participantMap:r,mappedMatchUps:t,homeid:f})}})),v=nc({venue:{tournamentname:o?i:void 0,neutralgame:l?"N":"Y",gameid:n,officials:{},tournament:o,rules:{},homename:m,visname:h,homeid:f,visid:g,date:p},childArray:y,singles_matches:u?.map(e=>pC({matchUp:e,homeid:f,uniValues:I})),doubles_matches:c?.map(e=>pC({matchUp:e,homeid:f,uniValues:I}))});return{json:v,xml:oC({json:v,tagName:"tngame"})}}function lC({homeid:e,uniValues:t,participant:r}){if(!r)return{};let i=2===r.individualParticipants?.length,n=i?vi(r.individualParticipants?.map(e=>e.teams?.[0]?.participantId)):[],a=i?vi(r.individualParticipants?.map(e=>e.teams?.[0]?.teamId)):[],o=!i&&r.teams?.[0]?.participantId||1===n?.length&&n[0]||void 0,s=!i&&r.teams?.[0]?.teamId||1===a?.length&&a[0]||o,c=i?void 0:r.participantName,u=r.individualParticipants?.[0]?.participantName,l=r.individualParticipants?.[1]?.participantName;return nc({vh:e&&(o===e?"H":"V")||"",uni:i?void 0:t[o][r.participantId],uni_1:t[o][r.individualParticipants?.[0]?.participantId],uni_2:t[o][r.individualParticipants?.[1]?.participantId],team:s,name:c,name_1:u,name_2:l})}function dC({teamParticipant:e,teamMatchUp:t,participantMap:r,mappedMatchUps:i,homeid:n,uniValues:a}){let{participantId:o,participantName:s}=e,c=n&&(o===n?"H":"V")||"",u=r?.[o]?.matchUps,l=u&&Object.keys(u),d=t?.sides?.find(({participant:e})=>e.participantId===o)?.sideNumber,p=t?.score?.sets?.[0]?.[`side${d}Score`]??0;a[o]={};let m={SINGLES:{w:0,l:0},DOUBLES:{w:0,l:0}},f=[],h=[],g=0;for(let S of l??[]){let e=i?.[S],t=e.sides.find(({participant:e})=>e.participantId===o)?.sideNumber;g+=e.score?.sets?.[0]?.[`side${t}Score`]??0;for(let r of e.tieMatchUps??[]){let{matchUpType:e,winningSide:i}=r,n=i&&(i===t?"w":"l")||"";n&&(m[e][n]+=1);let a="w"===n?"1":"0",o="l"===n?"1":"0";if(e===Wr){let e=h.length+1;h.push({singles_pair:{pair:e,won:a,lost:o,tied:"0"}})}else if(e===Hr){let e=f.length+1;f.push({doubles_pair:{pair:e,won:a,lost:o,tied:"0"}})}}}let I=[{singles:{childArray:h,won:m.SINGLES.w,lost:m.SINGLES.l}},{doubles:{childArray:f,won:m.DOUBLES.w,lost:m.DOUBLES.l}}],y=[],v=1;for(let S of e.individualParticipantIds){let e=r?.[S];if(e){let{participant:t,counters:r}=e,i={won:r?.DOUBLES?.wins||0,lost:r?.DOUBLES?.losses||0},n={won:r?.SINGLES?.wins||0,lost:r?.SINGLES?.losses||0},{participantName:s,participantId:c}=t;a[o][c]=v,y.push({player:{name:s,uni:v,singles:n,doubles:i}})}v+=1}return{vh:c,id:o,name:s,score:p||g,totals:I,childArray:y}}function pC({matchUp:e,homeid:t,uniValues:r}){let{collectionPosition:i,orderOfFinish:n,matchUpType:a,sides:o}=e??{},s=o?.map(i=>{let{sideNumber:n,participant:o}=i,s=function({sets:e,sideNumber:t}){return Object.assign({},...e?.map(e=>{let{setNumber:r,side1Score:i,side2Score:n,side1TiebreakScore:a,side2TiebreakScore:o}=e,s=`set_${r}`,c=`tie_${r}`,u=1===t?i:n,l=1===t?a:o;return{[s]:u,[c]:l}})??[])}({sets:e.score?.sets,sideNumber:n});return{[a===Wr?"singles_score":"doubles_score"]:{...lC({homeid:t,uniValues:r,participant:o}),...s}}});return{[a===Wr?"singles_match":"doubles_match"]:{match:i,order:n,childArray:s}}}var mC="DESC",fC={ASC:"ASC",ASCENDING:"ASC",DESC:"DESC",DESCENDING:mC};function hC(e){let{tieFormat:t}=e,{useDefaultEventRanking:r,tournamentRecord:i,drawDefinition:n,scaleAccessor:a,singlesOnly:o,attach:s,event:c}=e;if(c?.eventType!==Pl)return{error:Vn};if(!i)return{error:Ji};if(!t&&!n)return{error:an};if(t=t??Cg({drawDefinition:n,event:c})?.tieFormat,bu({tieFormat:t}).error)return{error:na};if("object"!=typeof a&&!r)return{error:Zo,context:{scaleAccessor:a}};let u={},l=(n?.entries??c?.entries??[]).filter(e=>e?.entryStatus===ug).map(Hm),{participants:d=[]}=mS({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:i}),p=d.filter(({participantId:e})=>l.includes(e)),m=c?.category?.categoryName??c?.category?.ageCategoryCode,{scaleName:f=m,scaleType:h=Ep,sortOrder:g,accessor:I}=a||{},y=h===Ep?"rankings":"ratings",v=(e,t)=>{let i=e[y]?.[t];if(!i&&r&&(i=e[y]?.[Gr]),Array.isArray(i)){let e=i.find(e=>e.scaleName===f)?.scaleValue;if(pi(e))return e;if(I&&"object"==typeof e)return e[I]}return 0},S=(e,t,r)=>{let i=g===mC?e:t;return v(g===mC?t:e,r)-v(i,r)},b=(e,t)=>S(e,t,Gr),U=(e,t)=>S(e,t,qr),w=[],T=t?.collectionDefinitions??[];for(let P of p){let e=P.individualParticipants?.sort(b)??[],t=o?e:P.individualParticipants?.sort(U)??[],r={};for(let n of T){let i=[],{collectionId:a,matchUpCount:o,matchUpType:s,gender:c}=n,u=MI(Gr)(s);Ri(0,o).forEach(n=>{let o=u?e:t??[],s=n+1,l=[];Ri(0,u?1:2).forEach(e=>{let t=o?.find(t=>{let r=hc(c),n=r&&(gc(c)&&r||mc(c)&&[uc,oc][e]);return!(n&&n!==t.person?.sex||i.includes(t.participantId))})?.participantId;t&&(l.push(t),i.push(t),r[t]||(r[t]=[]),r[t].push({collectionPosition:s,collectionId:a}))}),u||w.push(l)})}let i=Object.keys(r).map(e=>({collectionAssignments:r[e],participantId:e}));u[P.participantId]=i}let D=[];for(let P of w){let{participant:e}=gy({tournamentParticipants:d,participantIds:P});if(!e){let e={individualParticipantIds:P,participantRole:xS,participantType:Dh};D.push(e)}}if(s){for(;D.length;)dA({participant:D.pop(),tournamentRecord:i});em({element:n,extension:{name:Um,value:u}})}return{...Gi,lineUps:u,participantsToAdd:D}}function gC(e){if(!e)return{error:Da};let t=Dp(e,[{dates:!1,[gp]:e=>Array.isArray(e)&&e.every(qc)},{uuids:!1,[gp]:e=>Array.isArray(e)&&e.every(ei)},{startTime:!1,endTime:!1,[gp]:Zc},{idPrefix:!1,namePrefix:!1,[gp]:ei},{count:!0,[gp]:pi}]);if(t.error)return t;let{startDate:r,endDate:i}=e.tournamentRecord??{},n=e.dates||r&&i&&Xc(r,i)||[],a=Ri(1,e.count+1).map(t=>nc({courtId:e.uuids?.pop()??(e.idPrefix&&`${e.idPrefix}-${t}`)??Ru(),courtName:e.courtNames?.pop()??(e.namePrefix&&`${e.namePrefix} ${t}`),dateAvailability:n.map(t=>({startTime:e.startTime??"08:00",endTime:e.endTime??"20:00",date:t}))}));return{...Gi,courts:a}}var IC={};function yC(e){let t=Dp(e,[{courtDate:!0,_ofType:fp}]);if(t.error)return t;let{includeBookingTypes:r=[],courtDate:i}=e,n=[],a=uu(i.startTime);(i.bookings||[]).filter(e=>!e.bookingType||!r.includes(e.bookingType)).sort((e,t)=>(tu(e.startTime)||"").localeCompare(tu(t.startTime)||"")).forEach(e=>{let t={startTime:ru(a.toISOString()),endTime:e.startTime};uu(e.startTime)>a&&n.push(t),uu(e.endTime)>a&&(a=uu(e.endTime))});let o={startTime:ru(a.toISOString()),endTime:i.endTime};return uu(i.endTime)>a&&n.push(o),{timeSlots:n}}function vC(e){let t=Dp(e,[{periodStart:!0,date:!0},{courts:!0,_ofType:hp}]);if(t.error)return t;let{averageMatchUpMinutes:r,includeBookingTypes:i,periodStart:n,date:a}=e,o=e.courts,s=uu(n),c=pu(s,r),{enoughTime:u}=function({averageMatchUpMinutes:e,includeBookingTypes:t,periodStartTime:r,periodEndTime:i}){function n(t){let n=uu(t.startTime),a=uu(t.endTime);return!(n>r||a<i)&&lu(r,a)>=e}return{enoughTime:e=>{let{timeSlots:r}=yC({includeBookingTypes:t,courtDate:e});return!!r?.filter(n)?.length}}}({averageMatchUpMinutes:r,includeBookingTypes:i,periodStartTime:s,periodEndTime:c});return{availableToScheduleCount:(o?.filter(e=>{if(!Array.isArray(e.dateAvailability))return!1;let t=rR({date:a,court:e});return!(!t||!u(t))})||[]).length,...Gi}}function SC(e){let{remainingScheduleTimes:t=[],clearScheduleDates:r,periodLength:i=30,scheduleDate:n,courts:a=[]}=e,{bookings:o=[]}=e;if(!Array.isArray(a)||!a.length)return{error:Zo,courts:a};if(!Array.isArray(o))return{error:Ma};if(!qc(n))return{error:Ca};r&&(Array.isArray(r)?r.includes(n)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:c}=o.reduce((e,t)=>{let{courtId:r}=t;return r?e.courtBookings[r]?e.courtBookings[r].push(t):e.courtBookings[r]=[t]:e.unassignedBookings.push(t),e},{courtBookings:{},unassignedBookings:[]}),u=a.map((e,r)=>{let{courtId:i,courtName:a}=e,o=s[i]||[],c=rR({date:n,court:e})||{},{bookings:u=[],startTime:l,endTime:d,date:p}=c;return{courtId:i,courtName:a,dateAvailability:{bookings:[t[r]&&{startTime:l,endTime:t[r]},...Nu(u,!1,!0),...o].filter(Boolean),startTime:l,endTime:d,date:p}}});c.sort((e,t)=>eu(e.startTime)-eu(t.startTime));let l=()=>u.flatMap(e=>{let t=e.dateAvailability,{timeSlots:r=[]}=yC({courtDate:t});return{courtName:e.courtName,courtId:e.courtId,timeSlots:r}}),d=[];for(let p of c){let{startTime:e,endTime:t,averageMinutes:r,recoveryMinutes:n,matchUpId:a}=p,o=eu(e),s=eu(t),c=l().reduce((e,{courtId:t,courtName:r,timeSlots:n})=>{let a;return n.find(({startTime:t,endTime:r})=>{a=eu(t)-o;let n=o>=eu(t);return s<=eu(r)&&0!==e.startDifference&&((0===a||a+i>=0)&&(void 0===e.startDifference||a<e.startDifference)||n)})?{courtName:r,courtId:t,startDifference:a}:e},{});if(c.courtId){let i={averageMinutes:r,recoveryMinutes:n,matchUpId:a,startTime:e,endTime:t};d.push(i),u.find(({courtId:e})=>e===c.courtId)?.dateAvailability.bookings.push(i)}else console.log({unassignedBooking:p})}return{virtualCourts:u.map(({courtId:e,courtName:t,dateAvailability:r})=>({dateAvailability:[r],courtName:t,courtId:e})),assignedBookings:d}}function bC({averageMatchUpMinutes:e,periodLength:t=30,recoveryMinutes:r}){let i=(e||90)+(r||0);return t>i?i:t||30}function UC(e){let{startTime:t="8:00",endTime:r="20:30",count:i=10,date:n}=e??{};return Ri(0,i).map(()=>({dateAvailability:[{date:n,startTime:t,endTime:r}]}))}function wC({scheduleDate:e,startTime:t,endTime:r,courts:i}){let n=(t?"startTime":r&&"endTime")||void 0;return i.reduce((i,a)=>{let o=rR({date:e,court:a}),s=n&&(o?.[n]||a[n]);return s&&(!i||t&&eu(s)<eu(i)||r&&eu(s)>eu(i))?s:i},void 0)}function TC(e){let t=Dp(e,[{courts:!0,_ofType:hp}]);if(t.error)return t;let{date:r=Hc(),startTime:i="08:00",endTime:n="19:00",periodLength:a,courts:o}=e,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:c,averageMatchUpMinutes:u,clearScheduleDates:l,courtsCount:d,bookings:p}=e;a=a||bC({averageMatchUpMinutes:u}),r=iu(r),i=ru(i),n=ru(n);let m=0,f=0,h=0,g=0,I=0;!o&&d&&(o=UC({startTime:i,endTime:n,count:d,date:r}));let{virtualCourts:y}=SC({remainingScheduleTimes:c,clearScheduleDates:l,scheduleDate:r,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:v}=function({averageMinutes:e,startTime:t,endTime:r,courts:i,date:n}){let a;if(t=t||wC({courts:i,scheduleDate:n,startTime:!0}),r=r||wC({courts:i,scheduleDate:n,endTime:!0}),t&&r){let o=uu(t),s=uu(r);for(let t of i||[]){if(!Array.isArray(t.dateAvailability))continue;let r=rR({court:t,date:n}),{timeSlots:i}=yC({courtDate:r});i?.forEach(t=>{let r=uu(t.startTime),i=uu(t.endTime);if(r>s||r<o||i<o)return!1;if(lu(r,i)>=e){let e=ru(r.toISOString());e&&(!a||e<a)&&(a=e)}})}}return{firstTimeSlotStartTime:a}}({averageMinutes:u,courts:y,startTime:i,endTime:n,date:r});s&&v&&(i=v??i);let S=eu(i),b=eu(n)-S,U=Ri(0,Math.floor(b/a)+1).map(e=>{let t=function(e){let t=Math.floor(e/60),r=e-60*t;return t>23&&(t%=24),[mu(t),mu(r)].join(":")}(S+e*a),i=vC({courts:y??[],averageMatchUpMinutes:u,periodStart:t,date:r});if(i.error)return{error:i.error};let{availableToScheduleCount:n=0}=i,o=n>f?n-f:0;I+=e?n:0;let s=e?I/e:n,c=e?a*s/u*(e-1)+s:s,l=n?f&&c-m||o:0;m=c,f=n,h+=l;let d=Jr(h)-g;return g+=d,{periodStart:t,add:d,availableToScheduleCount:n,newCourts:o,totalMatchUps:g}});return{scheduleTimes:U.reduce((e,t)=>{let r=Ri(0,t.add).map(()=>({scheduleTime:t.periodStart}));return e.concat(...r)},[]).flat(),timingProfile:U,totalMatchUps:g}}Br(IC,{default:()=>PC,garman:()=>DC});var DC={getCourtsAvailableAtPeriodStart:vC,generateTimeSlots:yC,getScheduleTimes:TC,courtGenerator:UC},PC=DC,NC={};Br(NC,{isAggregateFormat:()=>iE,isValid:()=>_c,isValidMatchUpFormat:()=>_c,parse:()=>Mc,stringify:()=>Tc});var EC={};Br(EC,{allCompetitionMatchUps:()=>Fy,allDrawMatchUps:()=>Ly,allEventMatchUps:()=>xy,allTournamentMatchUps:()=>Oy,analyzeMatchUp:()=>$R,applyLineUps:()=>Vk,assignMatchUpSideParticipant:()=>RC,assignTieMatchUpParticipantId:()=>$C,bulkMatchUpStatusUpdate:()=>xk,calculateWinCriteria:()=>RR,checkInParticipant:()=>kC,checkMatchUpIsComplete:()=>wy,checkOutParticipant:()=>CC,competitionScheduleMatchUps:()=>TR,disableTieAutoCalc:()=>Ek,drawMatchUps:()=>VR,enableTieAutoCalc:()=>Dk,eventMatchUps:()=>bR,filterMatchUps:()=>by,findMatchUp:()=>xM,getAllDrawMatchUps:()=>Cy,getAllStructureMatchUps:()=>Uy,getCheckedInParticipantIds:()=>EI,getCompetitionMatchUps:()=>wR,getEventMatchUpFormatTiming:()=>hR,getHomeParticipantId:()=>AR,getMatchUpCompetitiveProfile:()=>Qg,getMatchUpContextIds:()=>CR,getMatchUpDailyLimits:()=>DR,getMatchUpDailyLimitsUpdate:()=>IR,getMatchUpDependencies:()=>Wy,getMatchUpFormat:()=>OR,getMatchUpFormatTiming:()=>HI,getMatchUpFormatTimingUpdate:()=>uR,getMatchUpScheduleDetails:()=>fy,getMatchUpType:()=>yy,getMatchUpsStats:()=>FR,getModifiedMatchUpFormatTiming:()=>gR,getParticipantResults:()=>Fv,getPredictiveAccuracy:()=>PR,getRoundMatchUps:()=>Lg,getRounds:()=>BR,isValidMatchUpFormat:()=>_c,matchUpActions:()=>pD,mutate:()=>MC,participantScheduledMatchUps:()=>vR,query:()=>sR,removeDelegatedOutcome:()=>Pk,removeMatchUpSideParticipant:()=>GC,removeTieMatchUpParticipantId:()=>jC,replaceTieMatchUpParticipantId:()=>FC,resetAdHocMatchUps:()=>Bk,resetMatchUpLineUps:()=>Rk,resetScorecard:()=>Lk,resetTieFormat:()=>_k,setDelegatedOutcome:()=>Fk,setMatchUpFormat:()=>Mk,setMatchUpState:()=>wk,setMatchUpStatus:()=>kk,setOrderOfFinish:()=>$k,substituteParticipant:()=>Nk,tallyParticipantResults:()=>Qv,toggleParticipantCheckInState:()=>xC,tournamentMatchUps:()=>UR,updateTieMatchUpScore:()=>Ww,validMatchUp:()=>Fg,validMatchUps:()=>_g});var MC={};function RC({tournamentRecord:e,drawDefinition:t,participantId:r,sideNumber:i,matchUpId:n,event:a}){if(r&&"string"!=typeof r)return{error:Ha};if(!t)return{error:rn};if(!n)return{error:ua};let o=void 0===i;if(o&&(i=1),![1,2].includes(i))return ac({result:{error:Zo,context:{sideNumber:i}}});let{matchUp:s,structure:c}=Aw({drawDefinition:t,matchUpId:n,event:a});if(!s)return{error:da};if(c?.structures||t.drawType&&t.drawType!==Zl||c?.matchUps?.find(({roundPosition:e})=>!!e))return{error:vn};if(!r&&(s?.score?.scoreStringSide1||If.includes(s?.matchUpstatus)||s?.matchUpStatus&&[nf,rf].includes(s.matchUpStatus)))return{error:ja,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(e=>{let t=s.sides?.find(t=>t.sideNumber===e)??{sideNumber:e};return i===e?{...t,participantId:r}:t}),o)for(let e of s.sides)e.sideNumber&&(e.sideNumber=3-e.sideNumber);ch({tournamentId:e?.tournamentId,context:"assignSideParticipant",drawDefinition:t,matchUp:s})}return{...Gi,sidesSwapped:o}}function AC({removePriorValues:e,tournamentRecord:t,duplicateValues:r,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:c}=Aw({drawDefinition:i,event:s,matchUpId:a});if(!c)return{error:da};let u=Yw({removePriorValues:e,element:c,duplicateValues:r,timeItem:o});return n||ch({tournamentId:t?.tournamentId,eventId:s?.eventId,context:"addTimeItem",drawDefinition:i,matchUp:c}),u}function CC(e){let t=Dp(e,[{[Cd]:!0},{[xd]:!0},{[_d]:!0},{[Kd]:!0}]);if(t.error)return t;let r=kR(e,[{[up]:ap,attr:{[Qd]:!0}}]);if(r.error)return r;let{tournamentRecord:i,drawDefinition:n,participantId:a,matchUpId:o}=e,s=r?.matchUp?.matchUp,{matchUpStatus:c,score:u}=s??{};if(c&&yf.includes(c)||c&&If.includes(c)||qy({score:u}))return{error:En};let l=EI({matchUp:s});if(l?.error)return l;let{checkedInParticipantIds:d,allRelevantParticipantIds:p}=l??{};if(!p?.includes(a))return{error:Ha};if(!d?.includes(a))return{error:oo};let m=Jg({matchUp:s});if(m?.error)return m;let{sideParticipantIds:f,nestedIndividualParticipantIds:h}=m??{},g=f?.indexOf(a);return void 0!==g&&[0,1].includes(g)&&(h?.[g]??[]).forEach(e=>{AC({drawDefinition:n,matchUpId:o,timeItem:{itemType:eI,itemValue:e}})}),AC({tournamentRecord:i,drawDefinition:n,matchUpId:o,timeItem:{itemValue:a,itemType:eI}}),{...Gi,checkedOut:!0}}function kC(e){let t=Dp(e,[{[Cd]:!0},{[xd]:!0},{[_d]:!0},{[Kd]:!0}]);if(t[sp])return t;let r=kR(e,[{[up]:ap,attr:{[Qd]:!0}}]);if(r[sp])return r;let{tournamentRecord:i,drawDefinition:n,participantId:a,matchUpId:o}=e,s=EI({matchUp:r?.matchUp?.matchUp});if(s?.error)return s;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=s??{};if(!u?.includes(a))return{[sp]:Ha};let l={...Gi,checkedIn:!0};return c?.includes(a)||AC({tournamentRecord:i,drawDefinition:n,matchUpId:o,timeItem:{itemValue:a,itemType:Zg}}),l}function xC(e){let t=Dp(e,[{[_d]:!0,[xd]:!0,[Kd]:!0}]);if(t.error)return t;let r=e.tournamentId??e.activeTournamentId,i=e.tournamentRecord??(r&&e.tournamentRecords?.[r]);if(!i)return{error:Ji};let n=kR(e,[{[up]:ap,attr:{[Qd]:!0},[sp]:da}]).matchUp?.matchUp;if(!n)return{error:da};let{checkedInParticipantIds:a=[]}=EI({matchUp:n}),{participantId:o,matchUpId:s,drawDefinition:c}=e;return o&&a.includes(o)?CC({tournamentRecord:i,drawDefinition:c,participantId:o,matchUpId:s,matchUp:n}):kC({tournamentRecord:i,drawDefinition:c,participantId:o,matchUpId:s,matchUp:n})}function OC({tournamentRecord:e,drawDefinition:t,tieMatchUpId:r,event:i}){if(!e)return{error:Ji};if(!t)return{error:wn};if(!i)return{error:Gn};let n=kg({drawDefinition:t}),{matchUp:a}=Aw({matchUpId:r,drawDefinition:t,matchUpsMap:n});if(!a)return{error:da};let{matchUp:o,structure:s}=Aw({tournamentParticipants:e.participants,matchUpId:r,inContext:!0,drawDefinition:t,matchUpsMap:n,event:i});if(!o)return{error:da};let{collectionPosition:c,drawPositions:u,collectionId:l,matchUpTieId:d,matchUpType:p}=o;if(p&&!ji([Wr,Hr],p))return{error:fa};let{positionAssignments:m}=Pf({structure:s}),f=m?.filter(e=>u?.includes(e.drawPosition)),{matchUp:h}=Aw({matchUpId:d,drawDefinition:t,matchUpsMap:n}),g=[...h?.sides?.map(Hm)??[],...f?.map(Hm)??[]],{participants:I}=mS({tournamentRecord:e,participantFilters:{participantTypes:[Ph],participantIds:g}}),{matchUp:y}=Aw({matchUpId:d,inContext:!0,drawDefinition:t,matchUpsMap:n}),v=Cg({matchUp:h,drawDefinition:t,structure:s,event:i})?.tieFormat;return{inContextDualMatchUp:y,inContextTieMatchUp:o,relevantAssignments:f,collectionPosition:c,teamParticipants:I,collectionId:l,matchUpType:p,dualMatchUp:h,tieMatchUp:a,tieFormat:v,structure:s,...Gi}}function FC(e){let t=OC(e);if(t.error)return t;let r="replaceTieMatchUpParticipantid",{existingParticipantId:i,tournamentRecord:n,newParticipantId:a,drawDefinition:o,substitution:s,event:c}=e;if(!i||!a)return ac({result:{error:Za},stack:r});if(i===a)return{...Gi};let{inContextDualMatchUp:u,inContextTieMatchUp:l,collectionPosition:d,collectionId:p,dualMatchUp:m,tieMatchUp:f,tieFormat:h}=t,g=l?.matchUpType,I=l?.sides?.find(e=>e.participant?.participantId===i||e.participant?.individualParticipantIds?.includes(i));if(!I)return{error:to};let y=mS({tournamentRecord:n,participantFilters:{participantIds:[i,a]}})?.participants??[];if(2!==y.length)return ac({result:{error:Za},stack:r});if(y[0].participantType!==y[1].participantType)return ac({result:{error:Ka},stack:r});let{appliedPolicies:v}=zh({tournamentRecord:n,drawDefinition:o,event:c}),S=e.policyDefinitions?.[Bp]??v?.[Bp]??MS[Bp],b=y.find(({participantId:e})=>e===a);if(!1!==(e.enforceGender??S?.participants?.enforceGender)&&gc(l?.gender)&&hc(l?.gender)!==hc(b?.person?.sex))return{error:qa,info:"Gender mismatch"};let U=S?.processCodes?.substitution;$w({tournamentId:n.tournamentId,eventId:c.eventId,inContextDualMatchUp:u,drawDefinition:o,dualMatchUp:m});let w=m?.sides?.find(({sideNumber:e})=>e===I.sideNumber);if(!w)return ac({result:{sideNumber:I.sideNumber,existingParticipantId:i,error:as},stack:r});if(l?.sides?.flatMap(e=>e.participant?.individualParticipantIds||e.participant?.participantId||[])?.includes(a))return ac({result:{error:uo},stack:r});let T=u?.sides?.find(({sideNumber:e})=>e===I.sideNumber)?.participantId,D=w.lineUp,P=D?.find(({participantId:e})=>a===e),N=D?.reduce((e,t)=>t.substitutionOrder>e?t.substitutionOrder:e,0),E=D?.map(e=>{let t=Nu(e,!1,!0);if(![i,a].includes(t.participantId))return t;if(!s&&[i,a].includes(t.participantId)&&(t.collectionAssignments=t.collectionAssignments?.filter(e=>!(e.collectionPosition===d&&e.collectionId===p))),s&&i===t.participantId&&(t.collectionAssignments=t.collectionAssignments.map(e=>e.collectionPosition===d&&e.collectionId===p&&void 0===e.substitutionOrder?{...e,substitutionOrder:N}:e)),t.participantId===a){t.collectionAssignments||(t.collectionAssignments=[]);let e={collectionId:p,collectionPosition:d};s&&(e.previousParticipantId=i,e.substitutionOrder=(N??0)+1),t.collectionAssignments.push(e)}return t})??[];if(!P){let e={collectionId:p,collectionPosition:d};s&&(e.substitutionOrder=(N??0)+1,e.previousParticipantId=i);let t={collectionAssignments:[e],participantId:a};E.push(t)}let M,R,A=g===Hr,{assignedParticipantIds:C}=hy({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:k}=hy({lineUp:E,collectionPosition:d,collectionId:p});if(w.lineUp=E,T&&h){let e=Rb({participantId:T,lineUp:E,drawDefinition:o,tieFormat:h});if(e.error)return ac({result:e,stack:r})}else console.log("team participantId not found");if(A){let{tournamentRecord:t}=e,i=gy({participantIds:k,tournamentRecord:t});if(!i.participant){let e=dA({returnParticipant:!0,pairOverride:!0,tournamentRecord:t,participant:{participantRole:xS,individualParticipantIds:k,participantType:Dh}});if(e.error)return ac({result:e,stack:r});M=e.participant?.participantId}i=gy({participantIds:C,tournamentRecord:t});let n=i.participant?.participantId;n&&WS({participantIds:[n],tournamentRecord:t}).success&&(R=n)}if(s||1===I.substitutions?.length){if(s)U&&f&&(f.processCodes=vi([...f?.processCodes??[],...U]));else for(let e of U||[]){let t=f?.processCodes?.lastIndexOf(e);void 0!==t&&f?.processCodes?.splice(t,1)}f&&ch({tournamentId:n?.tournamentId,matchUp:f,context:r,drawDefinition:o})}return m&&ch({tournamentId:n?.tournamentId,matchUp:m,context:r,drawDefinition:o}),{...Gi,modifiedLineUp:E,participantRemoved:R,participantAdded:M}}function _C({collectionPosition:e,teamParticipantId:t,dualMatchUpSide:r,drawDefinition:i,participantIds:n,collectionId:a}){if(!a||!e||!Array.isArray(n))return{modifiedLineUp:r?.lineUp||[],error:Zo};let o=r?.lineUp||Iy({participantId:t,drawDefinition:i})?.lineUp,s=[],c=[];return{modifiedLineUp:o?.map(t=>{if(!n.includes(t.participantId))return t;let r=t.collectionAssignments?.filter(r=>{let i=r.collectionId===a&&r.collectionPosition===e;return i&&(r.previousParticipantId&&s.push(r.previousParticipantId),c.push({participantId:t.participantId,...r})),!i});return{participantId:t.participantId,collectionAssignments:r}}).filter(Boolean)||[],assignmentsRemoved:c,previousParticipantIds:s}}function LC({individualParticipantIds:e,groupingParticipantId:t,removeFromOtherTeams:r,tournamentRecord:i}){let n="addIndividualParticipantIds";if(!i)return ac({result:{error:Ji},stack:n});if(!t||!e)return ac({result:{error:Da},stack:n});let a=i.participants??[],o=a.find(e=>e.participantId===t);if(!o)return ac({result:{error:to},stack:n});if(o?.participantType&&![Ph,Th].includes(o.participantType))return ac({context:{participantType:o.participantType},result:{error:Ka},stack:n});let s=e.filter(e=>a.find(t=>t.participantId===e)?.participantType!==wh);if(s.length)return ac({result:{error:za,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let c=o.individualParticipantIds,u=e.filter(e=>!c.includes(e));u.length&&(r&&GS({individualParticipantIds:u,tournamentRecord:i}),o.individualParticipantIds=o.individualParticipantIds.concat(...u));let{topics:l}=Ws();if(l.includes(Wf)){let e=a.find(({participantId:e})=>e===t);Bs({topic:Wf,payload:{participants:[e]}})}return function({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:r}){let i=(r.events||[]).filter(e=>e?.eventType===Dl&&e?.entries?.some(e=>e.participantId===t)),n=t=>!e.includes(t.participantId);for(let a of i){a.entries=(a.entries||[]).filter(n);let{flightProfile:e}=py({event:a});e?.flights?.forEach(e=>{e.drawEntries=(e.drawEntries||[]).filter(n)}),a?.drawDefinitions?.forEach(e=>{e.entries=(e.entries||[]).filter(n)})}}({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:i}),{groupingParticipant:Nu(o,!1,!0),added:u.length,...Gi}}function BC(e){let{updateParticipantName:t=!0,groupingParticipantId:r,removeFromOtherTeams:i,tournamentRecord:n,pairOverride:a,participant:o}=e;if(!n)return{error:Ji};if(!o)return{error:Qa};if(!o.participantId)return dA({tournamentRecord:n,participant:o});let{participant:s}=kh({participantId:o.participantId,tournamentRecord:n});if(!s)return dA({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:c,individualParticipantIds:u,participantOtherName:l,participantName:d,participantRole:p,participantType:m,onlineResources:f,contacts:h,person:g}=o;if(m&&s.participantType!==m)return{error:Va};let I={};if(h&&(I.contacts=h),f&&(I.onlineResources=f),l&&ei(l)&&(I.participantOtherName=l),d&&ei(d)&&(I.participantName=d),Array.isArray(u)){let{participants:e}=mS({participantFilters:{participantTypes:[wh]},tournamentRecord:n}),r=e?.map(Hm);if(r){let i=u.filter(e=>ei(e)&&r.includes(e));([Th,Yr].includes(m||s.participantType)||m===Dh&&(2===i.length||a))&&(I.individualParticipantIds=i),s.participantType===Nh.PAIR&&t&&(I.participantName=function({individualParticipants:e,newValues:t}){let r=t.individualParticipantIds,i=e.filter(({participantId:e})=>r.includes(e)).map(({person:e})=>e?.standardFamilyName).filter(Boolean).sort().join("/");return 1===r.length&&(i+="/Unknown"),i}({individualParticipants:e,newValues:I}))}}return Object.keys($S).includes(p)&&(I.participantRole=p),Object.keys(Nh).includes(m)&&(I.participantType=m),Array.isArray(c)&&(I.participantRoleResponsibilties=c),s.participantType===Nh.INDIVIDUAL&&g&&function({updateParticipantName:e,existingParticipant:t,newValues:r,person:i}){let n,a={},{standardFamilyName:o,standardGivenName:s,nationalityCode:c,personId:u,birthdate:l,tennisId:d,sex:p}=i;if(p&&Object.keys(lc).includes(p)&&(a.sex=p),ei(u)&&(a.personId=u),c&&ei(c)&&(function(e){return Ah.flatMap(({iso:e,ioc:t})=>[e,t]).filter(Boolean).includes(e)}(c)||""===c)&&(a.nationalityCode=c),o&&typeof ei(o)&&o.length>1&&(a.standardFamilyName=o,n=!0),s&&typeof ei(s)&&s.length>1&&(a.standardGivenName=s,n=!0),n&&e){let e=`${a.standardGivenName} ${a.standardFamilyName}`;r.participantName=e}l&&qc(l)&&(a.birthdate=l),d&&ei(d)&&(a.tennisId=d),Object.assign(t.person,a)}({updateParticipantName:t,existingParticipant:s,newValues:I,person:g}),Object.assign(s,nc(I)),r&&LC({individualParticipantIds:[s.participantId],groupingParticipantId:r,removeFromOtherTeams:i,tournamentRecord:n}),Bs({topic:Wf,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Nu(s),...Gi}}function $C(e){let t=OC(e);if(t.error)return t;let r="assignTieMatchUpParticipantId",i=e.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:o,event:s}=e;if(!o)return ac({result:{error:Za},stack:r});if(e.sideNumber&&![1,2].includes(e.sideNumber))return ac({result:{error:Ua},stack:r});let{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:l,collectionPosition:d,teamParticipants:p,collectionId:m,matchUpType:f,dualMatchUp:h,tieFormat:g}=t;if(u?.sides?.flatMap(e=>e.participant?.individualParticipantIds||e.participant?.participantId||[])?.includes(o))return ac({result:{...Gi},stack:r});i=i??(e.sideNumber?c?.sides?.find(t=>t.sideNumber===e.sideNumber)?.participantId:void 0);let I=mS({participantFilters:{participantIds:[o]},tournamentRecord:n})?.participants?.[0];if(!I)return ac({result:{error:to},stack:r});let{appliedPolicies:y}=zh({tournamentRecord:n,drawDefinition:a,event:s}),v=e.policyDefinitions?.[Bp]??y?.[Bp]??MS[Bp];if(!1!==(e.enforceGender??v?.participants?.enforceGender)&&gc(u?.gender)&&hc(u?.gender)!==hc(I.person?.sex))return{error:qa,info:"Gender mismatch"};let{individualParticipantIds:S,participantType:b}=I;if(MI(Wr)(f)&&b!==wh)return{error:Ka};let U=b===wh?[o]:S,w=i&&p?.find(({participantId:e})=>e===i)||p?.find(({individualParticipantIds:e})=>xi(U,e));if(!w)return{error:ts};if(i||(i=w.participantId),!i)return{error:to};let T=l?.find(e=>e.participantId===w?.participantId)?.drawPosition,D=h?.sides?.find(e=>e.participantId===i)?.sideNumber,P=u?.sides?.find(e=>T&&e.drawPosition===T)?.sideNumber,N=D??P??e.sideNumber;if(!g)return{error:ca};if(!g.collectionDefinitions?.find(e=>e.collectionId===m))return{error:sa};$w({tournamentId:n.tournamentId,eventId:s.eventId,inContextDualMatchUp:c,drawDefinition:a,dualMatchUp:h});let E=h?.sides?.find(e=>e.sideNumber===N),M=u?.sides?.find(e=>e.sideNumber===N),R=(E?.lineUp??Iy({participantId:i,drawDefinition:a})?.lineUp)?.filter(e=>e.collectionAssignments?.find(e=>e.collectionPosition===d&&e.collectionId===m&&!e.previousParticipantId))?.map(e=>e?.participantId),A=R?.length>1&&R||(b===Dh?I.individualParticipantIds:[o]),C=_C({collectionPosition:d,teamParticipantId:i,dualMatchUpSide:E,drawDefinition:a,participantIds:A,collectionId:m});if(C.error)return ac({result:C,stack:r});let k,{modifiedLineUp:x}=C;if(f===Hr){if(b!==Dh){let e=VC({collectionPosition:d,teamParticipantId:i,drawDefinition:a,modifiedLineUp:x,participantId:o,collectionId:m,tieFormat:g});if(e?.error)return ac({result:e,stack:r});if(e=function({side:e}){let t;if(e.participant){let r=e.participant.individualParticipantIds||[];if(1===r.filter(Boolean).length){let{participant:e}=gy({participantIds:r,tournamentRecord:n});r.push(o);let{participant:i}=gy({participantIds:r,tournamentRecord:n});if(!i&&e){e.individualParticipantIds=r;let t=BC({pairOverride:!0,tournamentRecord:n,participant:e});if(t.error)return t}else t=e?.participantId}}else{let e=dA({participant:{individualParticipantIds:[o],participantRole:xS,participantType:Dh},pairOverride:!0,tournamentRecord:n});if(e.error)return e}return{...Gi,deletedParticipantId:t}}({side:M}),e.error)return e;k=e.deletedParticipantId,E&&(E.lineUp=x),h&&ch({tournamentId:n?.tournamentId,matchUp:h,context:r,drawDefinition:a})}else if(b===Dh)for(let O of A)VC({collectionPosition:d,teamParticipantId:i,drawDefinition:a,modifiedLineUp:x,participantId:O,collectionId:m,tieFormat:g})}else{let e=VC({collectionPosition:d,teamParticipantId:i,drawDefinition:a,modifiedLineUp:x,participantId:o,collectionId:m,tieFormat:g});if(e?.error)return e}if(E&&(E.lineUp=x),h&&ch({tournamentId:n?.tournamentId,matchUp:h,context:r,drawDefinition:a}),k){let{error:e}=WS({participantIds:[k],tournamentRecord:n});e&&console.log("cleanup")}return{...Gi,modifiedLineUp:x}}function VC({collectionPosition:e,teamParticipantId:t,drawDefinition:r,modifiedLineUp:i,participantId:n,collectionId:a,tieFormat:o}){let s=Iy({participantId:t,drawDefinition:r})?.lineUp,c=(i||s)?.find(e=>e?.participantId===n),u={collectionId:a,collectionPosition:e};if(c)c.collectionAssignments.push(u);else{let e={collectionAssignments:[u],participantId:n};i.push(e)}return Rb({participantId:t,lineUp:i,drawDefinition:r,tieFormat:o})}function jC(e){let{tournamentRecord:t,drawDefinition:r,participantId:i,event:n}=e,a="removeTieMatchUpParticiapantId";if(!i)return ac({result:{error:Za},stack:a});let o=OC(e);if(o.error)return o;let{appliedPolicies:s}=zh({tournamentRecord:t,drawDefinition:r,event:n}),c=(e.policyDefinitions?.[Bp]??s?.[Bp]??MS[Bp])?.processCodes?.substitution,{inContextDualMatchUp:u,inContextTieMatchUp:l,relevantAssignments:d,collectionPosition:p,teamParticipants:m,collectionId:f,matchUpType:h,dualMatchUp:g,tieMatchUp:I,tieFormat:y}=o;if(!g)return ac({result:{error:ma},stack:a});let v=l?.sides?.find(e=>e.participant?.participantId===i||e.participant?.individualParticipantIds?.includes(i));if(!v)return ac({result:{error:to},stack:a});let S=e.policyDefinitions?.[Hp]??s?.[Hp];if(!v.substitutions?.length&&(qy({score:l?.score})||l?.winningSide)&&!1!==S?.requireParticipantsForScoring)return ac({result:{error:us},stack:a});let b=u?.sides?.find(({sideNumber:e})=>e===v.sideNumber)?.participantId;if(!b)return ac({result:{error:to},stack:a});let U=mS({participantFilters:{participantIds:[i]},tournamentRecord:t})?.participants?.[0];if(!U)return ac({result:{error:to},stack:a});if(h===Wr&&U.participantType===Dh)return ac({result:{error:qa},stack:a});let w=U.participantType===wh?[i]:U.individualParticipantIds;$w({tournamentId:t.tournamentId,eventId:n.eventId,inContextDualMatchUp:u,drawDefinition:r,dualMatchUp:g});let T=g.sides?.find(({sideNumber:e})=>e===v.sideNumber);if(!T&&(g.sides?.filter(({lineUp:e})=>!e).length||0)<2){let e=m?.map(({participantId:e})=>({drawPosition:d?.find(t=>t.participantId===e)?.drawPosition,teamParticipantId:e}));T=g.sides?.find(t=>e?.find(({drawPosition:e})=>e===t.drawPosition)?.teamParticipantId===b)}if(!T)return ac({result:{error:to,context:{participantId:i}}});let{modifiedLineUp:D,previousParticipantIds:P}=_C({collectionPosition:p,teamParticipantId:b,dualMatchUpSide:T,participantIds:w,drawDefinition:r,collectionId:f});if(T.lineUp=D,b&&y&&Rb({participantId:b,lineUp:D,drawDefinition:r,tieFormat:y}),h===Hr&&U.participantType===wh){let e=l?.sides?.find(e=>e.sideNumber===T?.sideNumber),{participantId:r}=e??{},n=r&&mS({participantFilters:{participantIds:[r]},tournamentRecord:t,withDraws:!0})?.participants?.[0];if(!n)return ac({result:{error:to},stack:a});{let e=n?.individualParticipantIds?.filter(e=>e!==i)??[];if(P&&e.push(...P),e.length>2)return ac({result:{error:za},stack:a});if(n.draws?.length){if(1===e.length){let{participant:r}=gy({participantIds:e,tournamentRecord:t});if(!r){let r=dA({participant:{participantRole:xS,individualParticipantIds:e,participantType:Dh},pairOverride:!0,tournamentRecord:t});if(r.error)return ac({result:r,stack:a})}}}else if(e.length){n.individualParticipantIds=e;let r=BC({participant:n,pairOverride:!0,tournamentRecord:t});if(r.error)return ac({result:r,stack:a})}else{let e=WS({participantIds:[r],tournamentRecord:t});e.error&&console.log("cleanup",{result:e})}}}if(1===v.substitutions?.length&&!l?.sides?.find(e=>e.sideNumber!==v.sideNumber)?.substitutions?.length&&I?.processCodes?.length){for(let e of c||[]){let t=I.processCodes.lastIndexOf(e);I.processCodes.splice(t,1)}ch({tournamentId:t?.tournamentId,matchUp:I,context:a,drawDefinition:r})}return ch({tournamentId:t?.tournamentId,matchUp:g,context:a,drawDefinition:r}),{...Gi,modifiedLineUp:D}}function GC(e){let t=Dp(e,[{[Cd]:!0,[xd]:!0,[Kd]:!0}]);if(t.error)return t;let{drawDefinition:r,sideNumber:i,matchUpId:n,event:a}=e;if(i&&![1,2].includes(i))return{error:Zo,sideNumber:i};let{matchUp:o,structure:s}=Aw({drawDefinition:r,matchUpId:n,event:a});return o?jg({structure:s})?(o.sides?.forEach(e=>{(!i||e.sideNumber===i)&&delete e.participantId}),ch({tournamentId:e.tournamentRecord?.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:o}),{...Gi}):{error:vn}:{error:da}}function WC({inContextDrawMatchUps:e,positionAssignments:t,sourceMatchUpStatus:r,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:c,matchUp:u,event:l}){if(s){let t=e.find(({matchUpId:e})=>u.matchUpId===e).sides?.find(e=>e.drawPosition===i)?.sideNumber,r=u.sides?.find(e=>e.sideNumber===t);r&&delete r.lineUp}u.drawPositions=(u.drawPositions||[]).map(e=>e===i?void 0:e).filter(Boolean);let d=t.filter(({drawPosition:e})=>u.drawPositions?.includes(e)).filter(e=>e.bye).length;return u.matchUpStatus=(d?"BYE":rv(u.matchUpStatus)&&u.matchUpStatus)||lf,rv(u.matchUpStatus)&&(u.winningSide=void 0),u.matchUpStatusCodes&&wb({inContextDrawMatchUps:e,sourceMatchUpStatus:r,sourceMatchUpId:a,matchUpsMap:c,matchUp:u}),ch({tournamentId:n?.tournamentId,eventId:l?.eventId,context:`removeSubsequentDrawPosition-${i}`,drawDefinition:o,matchUp:u}),{...Gi}}function qC(e){let{dualWinningSideChange:t,inContextDrawMatchUps:r,tournamentRecord:i,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:c,matchUpId:u,structure:l,event:d}=e,p=!!e.matchUp.collectionId,m=jg({structure:l}),{drawPositions:f,winningSide:h}=c.matchUp||{};if(!m&&!f)return{error:fn};let g,{targetLinks:{loserTargetLink:I,winnerTargetLink:y,byeTargetLink:v},targetMatchUps:{loserMatchUp:S,winnerMatchUp:b,byeMatchUp:U}}=c,w=Ow({...e,matchUpStatus:a||lf,removeWinningSide:!0});if(w.error)return w;if(p){let{matchUpTieId:r,matchUpsMap:a}=e;if(g=Ww({appliedPolicies:e.appliedPolicies,matchUpId:r,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:d}),!t&&!g.removeWinningSide)return{...Gi}}if(m)return{...Gi};let{matchUps:T}=Uy({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:l}),{positionAssignments:D}=Nf({structure:l}),P=h-1,N=1-P,E=f[P],M=f[N],{winnerParticipantId:R,loserParticipantId:A}=D?.reduce((e,t)=>(t.drawPosition===M&&(e.loserParticipantId=t.participantId),t.drawPosition===E&&(e.winnerParticipantId=t.participantId),e),{winnerParticipantId:void 0,loserParticipantId:void 0})||{},C=T.filter(e=>e.drawPositions?.includes(M));if(b&&HC({sourceMatchUpStatus:a,sourceMatchUpId:u,inContextDrawMatchUps:r,winningDrawPosition:E,winnerParticipantId:R,tournamentRecord:i,winnerTargetLink:y,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),S){let{winnerHadMatchUpStatus:e}=function({matchUpStatuses:e=["BYE",df,tf],drawPositionMatchUps:t,loserDrawPosition:r,sourceMatchUps:i}){let n=t?.reduce((e,t)=>!e||t.roundNumber>e.roundNumber?t:e,void 0),a=n?.drawPositions?.find(e=>e!==r),o=i.filter(e=>e?.drawPositions?.includes(a)).map(e=>e.matchUpStatus),s=i.filter(e=>e?.drawPositions?.includes(r)).map(e=>e.matchUpStatus);return{sourceMatchUp:n,winnerHadMatchUpStatus:xi(o||[],e),winnerMatchUpStatuses:o,loserHadMatchUpStatus:xi(s||[],e),loserMatchUpStatuses:s}}({drawPositionMatchUps:C,loserDrawPosition:M,sourceMatchUps:T}),t=I.linkCondition===Jl;if(e&&t){zC({targetLink:I,inContextDrawMatchUps:r,drawDefinition:n,drawPosition:Math.min(...S.drawPositions),matchUpsMap:o,event:d})}let c=function({sourceMatchUpStatus:e,loserParticipantId:t,tournamentRecord:r,loserTargetLink:i,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:c,event:u}){let l="removeDirectedLoser",d=i.target.structureId,{structure:p}=wf({drawDefinition:a,structureId:d});if(!p)return{error:Fn};let{positionAssignments:m}=Nf({structure:p}),f=m?.find(e=>e.participantId===t)?.drawPosition;if(m?.forEach(e=>{e.participantId===t&&delete e.participantId}),n&&e){let t=s?.drawMatchUps?.find(({matchUpId:e})=>e===o.matchUpId);t.matchUpStatusCodes=e===nf?["WO","WO"]:[]}if(p.seedAssignments=(p.seedAssignments??[]).filter(e=>e.participantId!==t),c){let e=o?.sides.reduce((e,t,r)=>t.drawPosition===f?r:e,void 0),t=s?.drawMatchUps?.find(({matchUpId:e})=>e===o.matchUpId),i=t?.sides?.[e];i&&(delete i.lineUp,ch({tournamentId:r?.tournamentId,eventId:u?.eventId,matchUp:t,context:l,drawDefinition:a}))}return{...Gi}}({sourceMatchUpStatus:a,sourceMatchUpId:u,loserParticipantId:A,tournamentRecord:i,loserTargetLink:I,drawDefinition:n,loserMatchUp:S,dualMatchUp:s,matchUpsMap:o,event:d});if(c.error)return c}if(U){zC({targetLink:v,inContextDrawMatchUps:r,drawDefinition:n,drawPosition:Math.min(...U.drawPositions),matchUpsMap:o,event:d})}return{...Gi,...g&&{tieMatchUpResult:g}}}function HC({inContextDrawMatchUps:e,winningDrawPosition:t,sourceMatchUpStatus:r,winnerParticipantId:i,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:c,matchUpsMap:u,dualMatchUp:l,event:d}){let{structureId:p,roundNumber:m}=c;if(a){let e=a.target.structureId,{structure:t}=wf({drawDefinition:s,structureId:e});if(!t)return{error:Fn};let{positionAssignments:r}=Nf({structure:t});t.seedAssignments=(t.seedAssignments??[]).filter(e=>e.participantId!==i);let o=r?.find(e=>e.participantId===i)?.drawPosition,{matchUps:l}=Uy({drawDefinition:s,structure:t,event:d}),p=wi(l.map(e=>e.drawPositions).flat(1/0).filter(Boolean));if(1===(o?p[o]:void 0))r?.forEach(e=>{e.participantId===i&&delete e.participantId});else{let e=l.filter(({drawPositions:e})=>e.includes(o));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:e,winnerTargetLink:a})}let m=u?.drawMatchUps?.find(({matchUpId:e})=>e===c.matchUpId);m&&ch({tournamentId:n?.tournamentId,eventId:d?.eventId,matchUp:m,context:"removeDirectedWinner",drawDefinition:s})}return m&&function({inContextDrawMatchUps:e,sourceMatchUpStatus:t,targetDrawPosition:r,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:c,matchUpsMap:u,event:l}){let{structure:d}=wf({drawDefinition:a,structureId:o});if(d?.structureType===Wl)return{...Gi};u=u??kg({drawDefinition:a});let p=(u?.mappedMatchUps||{})[o].matchUps,{initialRoundNumber:m}=Xy({drawPosition:r,matchUps:p}),f=p?.filter(e=>e.roundNumber>=c&&e.roundNumber!==m&&e.drawPositions?.includes(r)),{positionAssignments:h}=Pf({drawDefinition:a,structureId:o});for(let g of f??[])WC({inContextDrawMatchUps:e,sourceMatchUpStatus:t,positionAssignments:h,targetDrawPosition:r,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:u,matchUp:g,event:l})}({targetDrawPosition:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:l,matchUpsMap:u,roundNumber:m,structureId:p}),{...Gi}}function zC({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId,c="removeDirectedBye";return Zy({color:"brightyellow",method:c,drawPosition:i}),ac({result:uv({inContextDrawMatchUps:e,tournamentRecord:t,drawDefinition:r,drawPosition:i,matchUpsMap:n,structureId:s,event:o}),stack:c})}function YC(e){let{tournamentRecord:t,appliedPolicies:r,drawDefinition:i,matchUpsMap:n,targetData:a,structure:o,event:s}=e,c="doubleExitAdvancement";if(o.structureType===Wl)return ac({result:{...Gi},stack:c});let{matchUp:u,targetMatchUps:l,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:m,loserTargetDrawPosition:f}=l,h=rv(p?.matchUpStatus)&&!p.sides?.map(e=>e.participantId??e.participant).filter(Boolean).length,g=p?.matchUpStatus===nf;if(Zy({method:c,newline:!0,color:"brightyellow",keyColors:{sourceMatchUpId:"brightcyan",loserMatchUpId:"brightmagenta",winnerMatchUpId:"brightgreen"},sourceMatchUpId:u?.matchUpId,sourceStatus:e.matchUpStatus,sourceDP:JSON.stringify(u?.drawPositions),loserMatchUpId:p?.matchUpId,loserStatus:p?.matchUpStatus,loserDP:JSON.stringify(p?.drawPositions),loserTargetDP:f,loserIsEmptyExit:h,loserIsDoubleExit:g,loserSides:JSON.stringify(p?.sides?.map(e=>({sn:e.sideNumber,pid:e.participantId?.slice(0,8),fed:e.participantFed}))),winnerMatchUpId:m?.matchUpId,winnerStatus:m?.matchUpStatus,winnerDP:JSON.stringify(m?.drawPositions)}),p&&"BYE"!==p.matchUpStatus){let{loserTargetLink:a}=d,o=r?.progression?.doubleExitPropagateBye,l=p.feedRound&&p.sides?.[0]?.participantFed;if(o||l){Zy({method:c,color:"cyan",decision:"advanceByeToLoserMatchUp",propagateBye:o,targetFedIn:!!l});let e=XC({loserTargetDrawPosition:f,tournamentRecord:t,loserTargetLink:a,drawDefinition:i,loserMatchUp:p,matchUpsMap:n,event:s});if(e.error)return ac({result:e,stack:c})}else if(h){let t=e.matchUpStatus===rf?rf:nf,r=e.matchUpStatus===rf?tf:df,i=n.drawMatchUps.find(e=>e.matchUpId===p.matchUpId);if(Zy({method:c,color:"brightred",decision:"EMPTY_EXIT_converting_to_DOUBLE_EXIT",loserMatchUpId:p.matchUpId,currentStatus:p.matchUpStatus,newStatus:t}),i){let n=[{matchUpStatus:r,previousMatchUpStatus:t,sideNumber:1},{matchUpStatus:r,previousMatchUpStatus:e.matchUpStatus,sideNumber:2}].map(e=>nc(e)),a=Ow({...e,matchUp:i,matchUpId:p.matchUpId,matchUpStatus:t,matchUpStatusCodes:n,winningSide:void 0,removeScore:!0});if(a.error)return ac({result:a,stack:c})}}else if(g)Zy({method:c,color:"brightyellow",decision:"SKIP_loserMatchUp_already_doubleExit",loserMatchUpId:p.matchUpId});else{let{feedRound:r,drawPositions:i,matchUpId:n}=p,a=r?2:2-i.indexOf(f);Zy({method:c,color:"cyan",decision:"conditionallyAdvanceLoser",feedRound:r,walkoverWinningSide:a,loserMatchUpId:n});let o=KC({...e,targetMatchUp:p,walkoverWinningSide:a,tournamentRecord:t,sourceMatchUp:u,matchUpId:n});if(o.error)return ac({result:o,stack:c})}}if(m){Zy({method:c,color:"cyan",decision:"conditionallyAdvanceWinner",winnerMatchUpId:m.matchUpId});let r=KC({...e,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:t,sourceMatchUp:u});if(r.error)return ac({result:r,stack:c})}return ac({result:{...Gi},stack:c})}function KC(e){let{inContextDrawMatchUps:t,tournamentRecord:r,drawDefinition:i,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o}=e,s=i.structures.find(({structureId:e})=>e===a.structureId),c=e.matchUpStatus===rf?rf:nf,u=e.matchUpStatus===rf?tf:df,l="conditionallyAdvanceDrawPosition",d=o.drawMatchUps.find(e=>e.matchUpId===a.matchUpId);if(!d)return{error:ma};let p=n?.drawPositions||[],m=d.drawPositions?.filter(Boolean),f=n?.structureId===a.structureId;if(Zy({method:l,newline:!0,color:"magenta",keyColors:{targetMatchUpId:"brightcyan",sourceMatchUpId:"brightyellow"},targetMatchUpId:a.matchUpId,targetStructureId:a.structureId?.slice(0,8),targetRound:[a.roundNumber,a.roundPosition],targetDP:JSON.stringify(d.drawPositions),targetStatus:d.matchUpStatus,targetFeedRound:a.feedRound,sourceMatchUpId:n?.matchUpId,sourceStructureId:n?.structureId?.slice(0,8),sourceRound:n?[n.roundNumber,n.roundPosition]:void 0,sourceDP:JSON.stringify(p),sameStructure:f,paramMatchUpStatus:e.matchUpStatus,EXIT:u,DOUBLE_EXIT:c}),f&&xi(p,m)&&(m=m.filter(e=>!p.includes(e))),f&&m.length>1)return ac({result:{error:un},stack:l});let{pairedPreviousMatchUpIsDoubleExit:h,pairedPreviousMatchUp:g}=bb({...e,structure:s});Zy({method:l,color:"magenta",keyColors:{pairedMatchUpId:"brightcyan"},pairedMatchUpId:g?.matchUpId,pairedRound:g?[g.roundNumber,g.roundPosition]:void 0,pairedStatus:g?.matchUpStatus,pairedStructureId:g?.structureId?.slice(0,8),pairedIsDoubleExit:h});let I=Ey({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:i}),{targetMatchUps:y,targetLinks:v}=I,{loserTargetDrawPosition:S,winnerMatchUp:b,loserMatchUp:U}=y;if(U){let{loserTargetLink:e}=v,t=XC({loserTargetDrawPosition:S,loserMatchUp:U,tournamentRecord:r,loserTargetLink:e,drawDefinition:i,matchUpsMap:o});if(t.error)return ac({result:t,stack:l})}let w=d.drawPositions?.filter(Boolean)||[],T=1===w.length,D=e.walkoverWinningSide||T&&Tb({drawPosition:w[0],matchUpId:a.matchUpId,inContextDrawMatchUps:t})||void 0,P=rv(d.matchUpStatus)&&!w.length,N=P?c:u;Zy({method:l,color:"brightyellow",keyColors:{matchUpStatus:"brightgreen",existingExit:"brightred"},existingExit:P,matchUpStatus:N,targetCurrentStatus:d.matchUpStatus,targetDP:JSON.stringify(w),hasDrawPosition:T,walkoverWinningSide:D});let E,M=t.find(e=>e.matchUpId===g.matchUpId),R=[];n&&(n?.structureId===M?.structureId?E=n.roundPosition<g?.roundPosition?1:2:a.feedRound?E=n.structureId===a.structureId?2:1:D&&(E=3-D),Zy({method:l,color:"cyan",keyColors:{sourceSideNumber:"brightgreen"},sourceSideNumber:E,sourceStructureId:n.structureId?.slice(0,8),pairedStructureId:M?.structureId?.slice(0,8),targetStructureId:a.structureId?.slice(0,8),sameStructureAsPaired:n?.structureId===M?.structureId,targetFeedRound:a.feedRound,sourceRP:n.roundPosition,pairedRP:g?.roundPosition}));let A=e.matchUpStatus,C=g?.matchUpStatus;1===E?R=[{matchUpStatus:QC(A),previousMatchUpStatus:A,sideNumber:1},{matchUpStatus:QC(C),previousMatchUpStatus:C,sideNumber:2}]:2===E&&(R=[{matchUpStatus:QC(C),previousMatchUpStatus:C,sideNumber:1},{matchUpStatus:QC(A),previousMatchUpStatus:A,sideNumber:2}]),R.length&&(R=R.map(e=>nc(e))),Zy({method:l,color:"brightgreen",keyColors:{matchUpStatus:"brightcyan",winningSide:"brightyellow"},action:"modifyMatchUpScore",targetMatchUpId:d.matchUpId,matchUpStatus:N,winningSide:D,matchUpStatusCodes:JSON.stringify(R),sourceStatus:A,pairedStatus:C});let k=Ow({...e,winningSide:D,matchUp:d,matchUpStatusCodes:R,matchUpStatus:N});if(k.error)return ac({result:k,stack:l});if(P)return Zy({method:l,color:"brightred",decision:"EXISTING_EXIT_triggers_recursive_doubleExitAdvancement",targetMatchUpId:d.matchUpId,matchUpStatus:N}),YC({...e,matchUpStatus:N,targetData:I});if(!b)return ac({result:{...Gi},stack:l});let x=2===m.length?m[D-1]:m[0],{positionAssignments:O}=Pf({structure:s}),F=O?.find(e=>e.drawPosition===x),_=o.drawMatchUps.find(e=>e.matchUpId===b.matchUpId),L=_?.drawPositions?.filter(Boolean),B=1===L.length;if(x){if(F?.bye){let r=Ey({matchUpId:_.matchUpId,inContextDrawMatchUps:t,drawDefinition:i});if(B){let r=L.filter(Boolean)[0],n=Tb({drawPosition:r,matchUpId:_.matchUpId,inContextDrawMatchUps:t}),a=Ow({appliedPolicies:e.appliedPolicies,matchUpId:_.matchUpId,matchUp:_,matchUpStatus:u,matchUpStatusCodes:[],removeScore:!0,drawDefinition:i,winningSide:n});return a.error?ac({result:a,stack:l}):ov({drawPositionToAdvance:r,matchUpId:_.matchUpId,inContextDrawMatchUps:t,drawDefinition:i,matchUpsMap:o})}if(rv(b.matchUpStatus)){let t=YC({...e,matchUpId:_.matchUpId,matchUpStatus:N,targetData:r});if(t.error)return ac({result:t,stack:l})}return ac({result:{...Gi},stack:l})}return Db({matchUpId:b.matchUpId,drawPosition:x,inContextDrawMatchUps:t,drawDefinition:i})}if(h){if(!_)return{error:ma};if(B){let e=L[0],r=Tb({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawPosition:e});console.log("existing drawPosition is winningSide",{walkoverWinningSide:r})}let r=rv(_.matchUpStatus)?u:c,n=Ow({matchUpId:_.matchUpId,appliedPolicies:e.appliedPolicies,matchUp:_,matchUpStatusCodes:[],removeScore:!0,drawDefinition:i,matchUpStatus:r});if(n.error)return ac({result:n,stack:l});if(r===c){let t=YC({...e,matchUpId:a.matchUpId,matchUpStatus:r,targetData:I});if(t.error)return t}}return ac({result:{...Gi},stack:l})}function XC(e){let{loserTargetDrawPosition:t,tournamentRecord:r,loserTargetLink:i,drawDefinition:n,matchUpsMap:a,event:o,loserMatchUp:s}=e,c=i?.target?.structureId,{structure:u}=wf({drawDefinition:n,structureId:c});return u?iv({drawPosition:t,tournamentRecord:r,drawDefinition:n,structureId:c,matchUpsMap:a,loserMatchUp:s,event:o}):{error:Ln}}function QC(e){return e===nf?df:e===rf?tf:e}function JC(e){let{tournamentRecord:t,drawDefinition:r,matchUpStatus:i,structure:n,matchUp:a}=e,o=!(!a.tieMatchUps||a.rondPosition||!e.inContextDrawMatchUps.find(e=>e.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",c="BYE"===i,u=a.winningSide,l=[nf,rf].includes(i),d=Hy({matchUpStatus:i}),p=zy({matchUpStatus:i}),m=!d&&!p,f=e.matchUpTieId||u&&d&&!l,h=u&&l;Zy({method:s,newline:!0,color:"brightyellow",keyColors:{matchUpStatus:"brightcyan",matchUpId:"brightmagenta"},matchUpId:a.matchUpId,matchUpStatus:i,existingStatus:a.matchUpStatus,existingWinningSide:u,isDoubleExit:l,isBYE:c,directing:d,nonDirecting:p,unrecognized:m,onlyModifyScore:f,changeCompletedToDoubleExit:h,propagateExitStatus:e.propagateExitStatus,teamRoundRobinContext:o});return Zy({method:s,color:"brightgreen",keyColors:{route:"brightcyan"},route:(m?"unrecognized":f&&"onlyModifyScore")||h&&"changeCompletedToDoubleExit"||u&&"existingWinningSide_removeDirected"||p&&"nonDirecting_clearScore"||c&&"isBYE"||!d&&"notDirecting_error"||l&&"isDoubleExit_modifyAndAdvance"||o&&"teamRoundRobinContext"||e.propagateExitStatus&&"propagateExitStatus"||"fallthrough_error",matchUpId:a.matchUpId}),m&&{error:Zn}||f&&ZC(e)||h&&function(e){let t=qC(e);return t.error?t:YC(e)}(e)||u&&qC(e)||p&&Ow({...e,removeScore:[Jm,df].includes(i),matchUpStatus:i||lf})||c&&function({tournamentRecord:e,drawDefinition:t,structure:r,matchUp:i}){let n="attemptToSetMatchUpStatusBYE";if(i?.winningSide)return ac({result:{error:ia},context:{matchUpStatus:"BYE"},stack:n});let{positionAssignments:a}=Nf({structure:r}),o=a?.filter(e=>e.bye).map(e=>e.drawPosition);return i.drawPositions?.some(e=>o?.includes(e))?(i.matchUpStatus="BYE",i.matchUpStatusCodes=[],ch({tournamentId:e?.tournamentId,context:n,drawDefinition:t,matchUp:i}),{...Gi}):ac({result:{error:Jn},info:"matchUp does not include BYE",stack:n})}({tournamentRecord:t,drawDefinition:r,structure:n,matchUp:a})||!d&&{error:Zn}||l&&function(e){let t=ZC({...e,removeScore:!0});return t.error?t:YC(e)}(e)||o&&ZC(e)||e.propagateExitStatus&&ZC(e)||ac({result:{error:ia,info:"matchUpStatus: "+i},stack:s})}function ZC(e){let t="scoreModification";if(e.isCollectionMatchUp&&e.dualMatchUp?.winningSide&&!e.projectedWinningSide){let r=qC(e);if(r.error)return ac({result:r,stack:t})}let r=!!e.matchUp.collectionId,i=Ow({...e});if(r){let{matchUpTieId:r,drawDefinition:n,matchUpsMap:a}=e,o=Ww({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:r,event:e.event,drawDefinition:n,matchUpsMap:a});if(o.error)return ac({result:o,stack:t});Object.assign(i,{tieMatchUpResult:o})}return ac({result:i,stack:t})}function ek({drawDefinition:e,structure:t,matchUp:r}){let i=[];if(t.finishingPosition===Dd&&Wb({drawDefinition:e,structure:t})){let{structureIds:n}=function({drawDefinition:e,structure:t,matchUp:r}){let{drawPositions:i}=r,{positionAssignments:n}=Pf({drawDefinition:e,structure:t}),a=n?.filter(({drawPosition:e})=>i?.includes(e))?.map(e=>{let{extension:t}=lm({element:e,name:Cm});return t?.value?.groupOrder}),{containerStructures:o}=gh({drawDefinition:e}),s=o[t.structureId];return{structureIds:Py({drawDefinition:e,structureId:s})?.links?.source?.filter(e=>xi(a,e.source?.finishingPositions||[])).map(e=>e.source.structureId)}}({drawDefinition:e,structure:t,matchUp:r});n?.length&&i.push(...n)}return{connectedStructureIds:i}}function tk(e){let t,r="attemptToSetWinningSide",i={},{appliedPolicies:n,disableAutoCalc:a,drawDefinition:o,dualMatchUp:s,winningSide:c,structure:u,matchUp:l}=e;if(s?._disableAutoCalc&&!1!==a)return Fw(e);if(l.winningSide&&l.winningSide!==c){let{connectedStructureIds:r}=ek({drawDefinition:o,structure:u,matchUp:l});r.length&&(console.log({connectedStructureIds:r}),t=!0);let i=qC(e);if(i.error)return i}let d,p,m=qw(e);return m.context?.progressExitStatus&&Object.assign(i,m.context),m.error?ac({result:m,stack:r}):(e.qualifierChanging&&n?.[Gp]?.autoReplaceQualifiers&&(d=function(e){let t,{inContextDrawMatchUps:r,inContextMatchUp:i,drawDefinition:n,winningSide:a}=e,o=e.targetData.targetLinks?.winnerTargetLink;if(o.target.feedProfile===ql){let s=i.sides.find(({sideNumber:e})=>e!==a).participantId,c=r.find(e=>e.structureId===o.target.structureId&&e.roundNumber===o.target.roundNumber&&e.sides.some(({participantId:e})=>e===s));if(c?.matchUpStatus===lf&&!BT({inContextDrawMatchUps:r,drawDefinition:n,targetData:Ey({matchUpId:c.matchUpId,inContextDrawMatchUps:r,drawDefinition:n})})){let{structure:r}=wf({structureId:c.structureId,drawDefinition:n}),o=Pf({structure:r}).positionAssignments;for(let c of o||[])if(c.participantId===s){let s=i.sides.find(({sideNumber:e})=>e===a).participantId;if(c.participantId=s,r?.positionAssignments)r.positionAssignments=o;else if(r?.structures){let e=Object.assign({},...(o||[]).map(e=>({[e.drawPosition]:e.participantId})));for(let t of r.structures)t.positionAssignments?.forEach(t=>t.participantId=e[t.drawPosition])}ph({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:r}),t=!0}}}return{...Gi,qualifierReplaced:t}}(e).qualifierReplaced),e.qualifierAdvancing&&n?.[Gp]?.autoPlaceQualifiers&&(p=function(e){let t,{inContextDrawMatchUps:r,inContextMatchUp:i,drawDefinition:n,winningSide:a}=e,o=e.targetData.targetLinks?.winnerTargetLink;if(o.target.feedProfile===ql){let s=i.sides.find(({sideNumber:e})=>e===a)?.participantId,c=Mi(r.filter(e=>e.structureId===o.target.structureId&&e.roundNumber===o.target.roundNumber&&e.sides.some(({participantId:e,qualifier:t})=>t&&!e)));if(c?.matchUpStatus===lf&&!BT({inContextDrawMatchUps:r,drawDefinition:n,targetData:Ey({matchUpId:c.matchUpId,inContextDrawMatchUps:r,drawDefinition:n})})){let r=c.sides.find(e=>e.qualifier&&!e.participantId)?.drawPosition,{structure:i}=wf({structureId:c.structureId,drawDefinition:n});if(!i)return{error:Fn};let a=Pf({structure:i}).positionAssignments;for(let o of a||[])if(o.drawPosition===r&&!o.participantId){if(o.participantId=s,i.positionAssignments)i.positionAssignments=a;else if(i.structures){let e=Object.assign({},...(a||[]).map(e=>({[e.drawPosition]:e.participantId})));for(let t of i.structures)t.positionAssignments?.forEach(t=>t.participantId=e[t.drawPosition])}ph({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:i}),t=!0}}}return{...Gi,qualifierPlaced:t}}(e).qualifierPlaced),ac({result:nc({...Gi,...m,connectedStructures:t,qualifierReplaced:d,qualifierPlaced:p,context:i}),stack:r}))}Br(MC,{applyLineUps:()=>Vk,assignMatchUpSideParticipant:()=>RC,assignTieMatchUpParticipantId:()=>$C,bulkMatchUpStatusUpdate:()=>xk,checkInParticipant:()=>kC,checkOutParticipant:()=>CC,disableTieAutoCalc:()=>Ek,enableTieAutoCalc:()=>Dk,findMatchUp:()=>xM,removeDelegatedOutcome:()=>Pk,removeMatchUpSideParticipant:()=>GC,removeTieMatchUpParticipantId:()=>jC,replaceTieMatchUpParticipantId:()=>FC,resetAdHocMatchUps:()=>Bk,resetMatchUpLineUps:()=>Rk,resetScorecard:()=>Lk,resetTieFormat:()=>_k,setDelegatedOutcome:()=>Fk,setMatchUpFormat:()=>Mk,setMatchUpState:()=>wk,setMatchUpStatus:()=>kk,setOrderOfFinish:()=>$k,substituteParticipant:()=>Nk,toggleParticipantCheckInState:()=>xC,updateTieMatchUpScore:()=>Ww});var rk={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function ik(e){let{inContextDrawMatchUps:t,appliedPolicies:r,drawDefinition:i,matchUpsMap:n,targetData:a,matchUp:o}=e,{matchUpId:s}=o,{iteration:c=0}=e;c+=1;let u="removeDoubleExit";Zy({color:"brightyellow",method:u,matchUpId:s,iteration:c,keyColors:rk});let{targetMatchUps:{loserMatchUp:l,winnerMatchUp:d,loserTargetDrawPosition:p},targetLinks:{loserTargetLink:m}}=a;if(d&&"BYE"!==d.matchUpStatus){let{stage:t,roundNumber:r,roundPosition:i,structureName:n}=d;Zy({winner:"winner",roundPosition:i,structureName:n,roundNumber:r,keyColors:rk,stage:t}),nk({...e,targetMatchUp:d,sourceMatchUp:o,iteration:c})}let f="BYE"===l?.matchUpStatus&&(l?.feedRound||1===l?.roundNumber);if(f&&a?.targetLinks?.loserTargetLink?.linkCondition===Jl){let e=t.filter(({roundNumber:e,structureId:t})=>t===o.structureId&&1===e),r=_i(e.map(({roundPosition:e})=>e).sort(),2).find(e=>e.includes(o.roundPosition));if((e.filter(({roundPosition:e})=>r.includes(e))?.map(({matchUpStatus:e})=>e)).every(e=>[rf,nf].includes(e)))return ac({result:{...Gi},stack:u})}if(l&&("BYE"!==l.matchUpStatus||f)){let a=t.find(({matchUpId:e})=>e===l.matchUpId),{structure:o}=wf({drawDefinition:i,structureId:a.structureId}),{stage:s,roundNumber:d,roundPosition:h,feedRound:g,structureName:I}=l;if(Zy({loser:"loser",roundPosition:h,structureName:I,roundNumber:d,keyColors:rk,feedRound:g,stage:s}),r?.progression?.doubleExitPropagateBye||f)zC({drawPosition:p,targetLink:m,inContextDrawMatchUps:t,drawDefinition:i,matchUpsMap:n});else{let t=nk({...e,targetMatchUp:l,structure:o,iteration:c});if(t.error)return ac({result:t,stack:u})}}return ac({result:{...Gi},stack:u})}function nk(e){let{inContextDrawMatchUps:t,appliedPolicies:r,drawDefinition:i,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:c}=e,u="conditionallyRemoveDrawPosition";Zy({method:u,structureName:s?.structureName,iteration:c});let l,d,p,m=Ey({matchUpId:a.matchUpId,inContextDrawMatchUps:t,drawDefinition:i}),{targetMatchUps:{winnerMatchUp:f}}=m,h=o?.drawMatchUps.find(e=>e.matchUpId===a.matchUpId);if(a.feedRound)p=f?.drawPositions?.filter(Boolean)?.find(e=>a.drawPositions.includes(e));else if(null==n)p=Ci(a?.drawPositions||[],f?.drawPositions||[])?.[0];else{d=Ub({structureId:s.structureId,matchUp:n,matchUpsMap:o})?.pairedPreviousMatchUp,l=[nf,rf].includes(d?.matchUpStatus);let e=d?.drawPositions?.filter(Boolean)||[];if([...If,"BYE"].includes(d?.matchUpStatus)||d?.winningSide){let t=n.drawPositions||[],r=a.drawPositions?.filter(Boolean);xi(t,r)&&(r=r?.filter(e=>!t.includes(e))),p=t.concat(e).find(e=>r?.includes(e))}}if(f&&p){let{stage:e,roundNumber:r,roundPosition:n,structureName:a}=f;Zy({method:"removeDirectedWinner",drawPositionToRemove:p,color:"brightgreen",roundPosition:n,structureName:a,roundNumber:r,keyColors:rk,stage:e}),HC({winningDrawPosition:p,winnerMatchUp:f,inContextDrawMatchUps:t,drawDefinition:i,matchUpsMap:o})}let g=ik({targetData:m,matchUp:a,inContextDrawMatchUps:t,appliedPolicies:r,drawDefinition:i,matchUpsMap:o,structure:s,iteration:c});if(g.error)return ac({result:g,stack:u});let I=function({pairedPreviousDoubleExit:e,noContextTargetMatchUp:t}){return"BYE"===t.matchUpStatus?"BYE":e?[rf,tf].includes(t?.matchUpStatus)?tf:df:lf}({pairedPreviousDoubleExit:l,noContextTargetMatchUp:h}),y=!l;return g=Ow({...e,matchUpId:a.matchUpId,matchUp:h,removeWinningSide:!0,matchUpStatusCodes:[],matchUpStatus:I,removeScore:y,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),g.error?ac({result:g,stack:u}):{...Gi}}function ak(e){let{matchUp:t,matchUpStatus:r,score:i,winningSide:n}=e,a="noDownStreamDependencies";if([nf,rf].includes(t?.matchUpStatus)&&![nf,rf].includes(r)){let t=ik(e);if(t.error)return ac({result:t,stack:a})}let o=r===nf,s=qy({score:i})&&!o&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!n),c=e?.inContextMatchUp?.collectionId&&function(e){let{matchUpFormat:t,score:r}=e,i=r?.sets?.length,n=t&&Mc(t),{setFormat:a,finalSetFormat:o,bestOf:s}=n??{};return(s&&i===s&&o||a)?.timed||!1}(e.inContextMatchUp),u=e.removeScore||!c&&![of,Xm].includes(r||of),l=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||t.winningSide&&!n&&!qy({score:i}),d=r=>{let i,{structure:n,drawDefinition:a,dualMatchUp:o,disableAutoCalc:s}=e;if(o?._disableAutoCalc&&!1!==s)return Fw({...e,removeWinningSide:l});let{connectedStructureIds:c}=ek({drawDefinition:a,structure:n,matchUp:t});c.length&&(console.log({connectedStructureIds:c}),i=!0),Object.assign(e,{removeScore:r});let u=qC(e);if(u.error)return u;if(e.removingQualifier&&e.appliedPolicies?.[Gp]?.autoRemoveQualifiers){let t=function(e){let t,{inContextDrawMatchUps:r,inContextMatchUp:i,drawDefinition:n}=e,a=e.targetData.targetLinks?.winnerTargetLink;if(a.target.feedProfile===ql){let o=i.sides?.find(({sideNumber:e})=>e===i.winningSide)?.participantId,s=r.find(e=>e.structureId===a.target.structureId&&e.roundNumber===a.target.roundNumber&&e.sides?.some(({participantId:e})=>e===o));if(s&&s.matchUpStatus===lf&&!BT({inContextDrawMatchUps:r,drawDefinition:n,targetData:Ey({matchUpId:s.matchUpId,inContextDrawMatchUps:r,drawDefinition:n})})){let{structure:r}=wf({structureId:s.structureId,drawDefinition:n}),i=Pf({structure:r}).positionAssignments;for(let a of i||[])if(a.participantId===o){if(a.participantId=void 0,r?.positionAssignments)r.positionAssignments=i;else if(r?.structures){let e=Object.assign({},...(i||[]).map(e=>({[e.drawPosition]:e.participantId})));for(let t of r?.structures||[])t.positionAssignments?.forEach(t=>t.participantId=e[t.drawPosition])}ph({tournamentId:e.tournamentRecord?.tournamentId,event:e.event,drawDefinition:n,structure:r}),t=!0}}}return{qualifierRemoved:t}}(e);return{...Gi,connectedStructures:i,...t}}return{...Gi,connectedStructures:i}};if(l&&n&&e.isCollectionMatchUp)return ok(e);let p=[Jm,Xm].includes(r)&&e.dualWinningSideChange,m=r&&r!==lf,f=e.propagateExitStatus&&rv(r);return ac({result:(n||p||f)&&tk(e)||s&&d(u)||m&&JC(e)||l&&d(u)||t&&ok({...e,removeScore:!0})||{...Gi},stack:a})}function ok(e){if(e.isCollectionMatchUp&&e.dualMatchUp?.winningSide&&!e.projectedWinningSide&&!e.autoCalcDisabled){let t=qC(e);if(t.error)return t}let t=Ow({...e});if(e.isCollectionMatchUp){let{matchUpTieId:t,drawDefinition:r,event:i,matchUpsMap:n}=e,{removeWinningSide:a}=Ww({tournamentRecord:e.tournamentRecord,appliedPolicies:e.appliedPolicies,matchUpId:t,drawDefinition:r,matchUpsMap:n,event:i});a&&console.log("REMOVE WINNING SIDE")}return ac({result:t,stack:"ndd:scoreModification"})}function sk(e){let t=Dp(e,[{[Cd]:!0,[xd]:!0,[Kd]:!0},{homeParticipantId:!0,[sp]:Za}]);if(t.error)return t;let r=kR(e,[{[up]:ap,attr:{[Qd]:!0}}]);if(r.error)return r;let i=r?.matchUp?.matchUp?.sides?.map(e=>e?.participantId);if(e.homeParticipantId&&!i?.includes(e.homeParticipantId))return{error:Ha};let{disableNotice:n,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:c,matchUpId:u}=e;return AC({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:c,disableNotice:n,matchUpId:u,timeItem:{itemType:oI,itemValue:a}})}function ck({timeStamp:e,schedule:t,matchUp:r}){let{itemValue:i,timeStamp:n}=KI({timeItems:r?.timeItems||[],itemType:mI});return!t||n&&e&&new Date(n).getTime()>new Date(e).getTime()?{timeModifiers:i}:t}function uk(e){let t="addMatchUpScheduledTime",r=e.matchUp,{removePriorValues:i,tournamentRecord:n,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:c}=e;if(!c)return ac({result:{error:ua},stack:t});if(!Wc(s))return ac({result:{error:ka},stack:t});if(!r){let e=Aw({drawDefinition:a,matchUpId:c});if(e.error)return ac({result:e,stack:t});r=e.matchUp}let u=iu(s),l=QI({matchUp:r}).scheduledDate,d=u&&!l;if((ck({matchUp:r}).timeModifiers||[])?.length){let e=lk({disableNotice:!0,removePriorValues:i,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:c,matchUp:r});if(e?.error)return ac({result:e,stack:t})}let p=ou(s,!0,d);return AC({duplicateValues:!1,removePriorValues:i,tournamentRecord:n,drawDefinition:a,disableNotice:o,matchUpId:c,timeItem:{itemType:cI,itemValue:p}})}function lk({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return ac({result:{error:ua},stack:s});if(void 0!==n&&!Array.isArray(n))return ac({info:Eb("timeModifiers"),result:{error:Zo},stack:s});if(!o){let e=Aw({drawDefinition:r,matchUpId:a});if(e.error)return ac({result:e,stack:s});o=e.matchUp}let c=ck({matchUp:o}).timeModifiers||[],u=n.filter(e=>!c.includes(e));if(n.length&&!u.length)return{...Gi};if(u.some(e=>vI.includes(e))){c=c.filter(e=>!vI.includes(e));let i=uk({disableNotice:!0,removePriorValues:e,scheduledTime:"",tournamentRecord:t,drawDefinition:r,matchUpId:a});if(i.error)return ac({result:i,stack:s})}let l=n?.length?[...u,...c]:void 0;return AC({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemType:mI,itemValue:l}})}function dk({scheduledDate:e,removePriorValues:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a}){if(!a)return{error:ua};let o=e&&$c.test(e);return e&&!o?{error:Ca}:AC({duplicateValues:!1,removePriorValues:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemValue:iu(e),itemType:aI}})}function pk({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){if(!r&&!t)return{error:Ji};if(!o)return{error:ua};let c,u=Aw({drawDefinition:i,matchUpId:o});if(u.error)return u;if(u?.matchUp?.matchUpType!==zr)return{error:fa};if(!(void 0===s||Array.isArray(s)&&s.length&&s.every(e=>"string"==typeof e)))return{error:Zo,context:{courtIds:s}};if(s){let e=DT({tournamentRecords:t||r&&{[r.tournamentId]:r}});if(e.error)return e;let i=e.courts?.filter(e=>s.includes(e.courtId));if(i?.length!==s.length)return{error:Zo,context:{courtIds:s}};c=i?.map(e=>({venueId:e.venueId,courtId:e.courtId}))}return AC({duplicateValues:!1,removePriorValues:e,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemType:rI,itemDate:a,itemValue:c}})}function mk({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,venueId:o}){if(!r)return{error:Ji};if(!a)return{error:ua};if(o){let e=oy({tournamentRecords:t,tournamentRecord:r,venueId:o});if(e.error)return e}return AC({duplicateValues:!1,removePriorValues:e,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:tI,itemValue:o}})}function fk({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){if(!r&&!t)return{error:Ji};if(!o)return{error:ua};if(s){let e=cy({tournamentRecords:t,tournamentRecord:r,courtId:s});if(e.error)return e;let a=e.venue?.venueId;mk({tournamentRecords:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:o,venueId:a})}return AC({duplicateValues:!1,removePriorValues:e,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemType:iI,itemDate:a,itemValue:s}})}function hk(e,t){let r=Bc.test(e)?e:ru(e),i=iu(e)||iu(t)||zc(new Date);return new Date(`${i}T${r}`).getTime()}function gk(e){let t="addMatchUpScheduleItems",r=Dp(e,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[vp]:fp}],t);if(r.error)return r;let i,n,{matchUpDependencies:a,inContextMatchUps:o}=e,{proConflictDetection:s=!1,errorOnAnachronism:c=!1,checkChronology:u=!0,removePriorValues:l,tournamentRecords:d,tournamentRecord:p,drawDefinition:m,disableNotice:f,drawMatchUps:h,matchUpId:g,schedule:I,event:y}=e;if(h)i=h.find(e=>e.matchUpId===g);else{let e=Aw({drawDefinition:m,event:y,matchUpId:g});if(e.error)return e;i=e.matchUp}let{endTime:v,courtId:S,courtIds:b,courtOrder:U,resumeTime:w,homeParticipantId:T,scheduledDate:D,scheduledTime:P,startTime:N,stopTime:E,timeModifiers:M,venueId:R}=I;u&&(!a||!o)&&({matchUpDependencies:a,matchUps:o}=Wy({drawDefinition:m}));let A=a?.[g]?.matchUpIds;if(I.scheduledDate&&u&&A){let e=o?.filter(e=>(e.schedule?.scheduledDate||iu(e.schedule?.scheduledTime))&&A.includes(e.matchUpId)).map(({schedule:e})=>{let t=jc(e);return new Date(t??"").getTime()});if(e?.length){let r=jc(I),i=new Date(r??"").getTime();if(Math.max(...e)>=i){if(c)return ac({result:{error:zi},stack:t});n=zi}}}if(void 0!==D){let e=dk({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,scheduledDate:D,matchUpId:g});if(e?.error)return ac({result:e,stack:t,context:{scheduledDate:D}})}if(void 0!==P){let e=uk({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,scheduledTime:P,matchUpId:g,matchUp:i});if(e?.error)return ac({result:e,stack:t,context:{scheduledTime:P}})}if(void 0!==N){let e=vk({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,matchUpId:g,startTime:N,event:y});if(e?.error)return ac({result:e,stack:t,context:{startTime:N}})}if(void 0!==E){let e=bk({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,matchUpId:g,stopTime:E,event:y});if(e?.error)return ac({result:e,stack:t,context:{stopTime:E}})}if(void 0!==w){let e=Uk({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,resumeTime:w,matchUpId:g,event:y});if(e?.error)return ac({result:e,stack:t,context:{resumeTime:w}})}if(void 0!==v){let e=Sk({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,matchUpId:g,endTime:v,event:y});if(e?.error)return ac({result:e,stack:t,context:{endTime:v}})}if(void 0!==b){let e=pk({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,matchUpId:g,courtIds:b});if(e?.error)return ac({result:e,stack:t,context:{courtIds:b}})}if(s&&void 0!==S&&void 0!==D&&void 0!==U&&gi(U)){let e=Jr(U),r=(Oy({tournamentRecord:p})?.matchUps??[]).find(t=>{if(t.matchUpId===g)return!1;let r=t.schedule?.courtOrder?Jr(t.schedule.courtOrder):void 0;return t.schedule?.courtId===S&&r===e&&t.schedule?.scheduledDate===D});if(r)return ac({result:{error:dn,info:`Court slot already occupied by matchUp ${r.matchUpId}`},stack:t,context:{courtId:S,courtOrder:U,scheduledDate:D}})}if(void 0!==S&&void 0!==D){let e=fk({courtDayDate:D,disableNotice:!0,removePriorValues:l,tournamentRecords:d,tournamentRecord:p,drawDefinition:m,matchUpId:g,courtId:S});if(e?.error)return ac({result:e,stack:t,context:{courtId:S}})}if(void 0!==R){let e=mk({disableNotice:!0,removePriorValues:l,tournamentRecords:d,tournamentRecord:p,drawDefinition:m,matchUpId:g,venueId:R});if(e?.error)return ac({result:e,stack:t,context:{venueId:R}})}if(void 0!==U&&gi(U)){let e=Ik({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,courtOrder:U,matchUpId:g});if(e?.error)return ac({result:e,stack:t,context:{courtOrder:U}})}if(void 0!==M){let e=lk({disableNotice:!0,removePriorValues:l,tournamentRecord:p,drawDefinition:m,timeModifiers:M,matchUpId:g,matchUp:i});if(e?.error)return ac({result:e,stack:t,context:{timeModifiers:M}})}return ei(T)&&sk({disableNotice:!0,homeParticipantId:T,removePriorValues:l,tournamentRecord:p,drawDefinition:m,matchUpId:g}),f||ch({tournamentId:p?.tournamentId,eventId:y?.eventId,context:t,drawDefinition:m,matchUp:i}),n?{...Gi,warnings:[n]}:{...Gi}}function Ik({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,courtOrder:n,matchUpId:a}){if(!a)return{error:ua};if(n&&!gi(n))return{error:Zo,info:"courtOrder must be numeric"};let o=n&&Jr(n);return AC({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemType:nI,itemValue:o}})}function yk({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:ua};if(!n)return{error:Za};if(t){if(!Qp({tournamentParticipants:mS({tournamentRecord:t,participantFilters:{participantTypes:[wh],participantRoles:[_S]}}).participants??[],participantId:n}))return{error:to}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),AC({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:o,timeItem:s})}function vk({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:n,startTime:a,event:o}){if(!n)return{error:ua};if(!Wc(a))return{error:ka};let{matchUp:s}=Aw({drawDefinition:r,event:o,matchUpId:n}),{scheduledDate:c}=QI({matchUp:s}),u=(s?.timeItems??[]).filter(e=>[lI,dI,pI].includes(e?.itemType)).map(e=>hk(e.itemValue,c)).reduce((e,t)=>!e||t<e?t:e,void 0);if(!u||hk(a,c)<u){s?.timeItems&&(s.timeItems=s.timeItems.filter(e=>e.itemType!==uI));let o=ou(a,!0,!0);return AC({duplicateValues:!1,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:n,timeItem:{itemType:uI,itemValue:o}})}return{error:Oo}}function Sk({validateTimeSeries:e=!0,removePriorValues:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:ua};if(!Wc(o))return{error:ka};let{matchUp:c}=Aw({drawDefinition:i,event:s,matchUpId:a}),{scheduledDate:u}=QI({matchUp:c}),l=(c?.timeItems??[]).filter(e=>[uI,dI,lI].includes(e?.itemType)).map(e=>hk(e.itemValue,u)).reduce((e,t)=>!e||t>e?t:e,void 0);if(!e||!l||hk(o,u)>l){c?.timeItems&&(c.timeItems=c.timeItems.filter(e=>e.itemType!==pI));let e=ou(o,!0,!0);return AC({duplicateValues:!1,removePriorValues:t,tournamentRecord:r,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:pI,itemValue:e}})}return{error:Co}}function bk({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:ua};if(!Wc(a))return{error:ka};let{matchUp:s}=Aw({drawDefinition:r,event:o,matchUpId:n}),{scheduledDate:c}=QI({matchUp:s}),u=s?.timeItems??[];if(u.reduce((e,t)=>t.itemType===pI||e,void 0))return{error:ko};let l=u.filter(e=>[uI,dI,lI].includes(e?.itemType)).sort((e,t)=>hk(e.itemValue,c)-hk(t.itemValue,c)),d=l.at(-1),p=d?.itemType===lI,m=l.filter(e=>!p||e.createdAt!==d.createdAt).map(e=>hk(e.itemValue,c)).reduce((e,t)=>!e||t>e?t:e,void 0);if(hk(a,c)>m){if(s?.timeItems&&p){let e=d.createdAt;s.timeItems=s.timeItems.filter(t=>t.createdAt!==e)}return AC({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:n,timeItem:{itemValue:ou(a,!0,!0),itemType:lI}})}return{error:xo}}function Uk({removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:ua};if(!Wc(n))return{error:ka};let{matchUp:s}=Aw({drawDefinition:r,event:o,matchUpId:a}),{scheduledDate:c}=QI({matchUp:s}),u=s?.timeItems??[];if(u.reduce((e,t)=>t.itemType===pI||e,void 0))return{error:ko};let l=u.filter(e=>[uI,dI,lI].includes(e?.itemType)).sort((e,t)=>hk(e.itemValue,c)-hk(t.itemValue,c)),d=l.at(-1),p=d?.itemType===dI,m=l.filter(e=>!p||e.createdAt!==d.createdAt).map(e=>hk(e.itemValue,c)).reduce((e,t)=>!e||t>e?t:e,void 0);if(hk(n,c)>m){if(s?.timeItems&&p){let e=d.createdAt;s.timeItems=s.timeItems.filter(t=>t.createdAt!==e)}return AC({duplicateValues:!0,removePriorValues:e,tournamentRecord:t,drawDefinition:r,disableNotice:i,matchUpId:a,timeItem:{itemValue:ou(n,!0,!0),itemType:dI}})}return{error:Fo}}function wk(e){let t="setMatchUpStatus";e.matchUpStatus&&[df,nf].includes(e.matchUpStatus)&&(e.score=void 0);let{allowChangePropagation:r,disableScoreValidation:i,propagateExitStatus:n,tournamentRecords:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:c,drawDefinition:u,matchUpStatus:l,winningSide:d,matchUpId:p,event:m,score:f}=e;if(!u)return{error:rn};if(l&&[Jm,of,Xm,lf].includes(l)&&d)return{error:Zo,winningSide:d,matchUpStatus:l};if(![void 0,...ff].includes(l))return ac({result:{error:ia},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=kg({drawDefinition:u}),{matchUps:g}=Cy({nextMatchUps:!0,tournamentRecord:o,inContext:!0,drawDefinition:u,matchUpsMap:h,event:m}),I=h.drawMatchUps.find(e=>e.matchUpId===p),y=g?.find(e=>e.matchUpId===p);if(!I||!g)return{error:da};if((I.winningSide||d)&&"BYE"===l)return{context:"Cannot have Bye with winningSide",error:ta,matchUpStatus:l};let v=y?.structureId,{structure:S}=wf({drawDefinition:u,structureId:v}),b=MI(Yr)(I.matchUpType),U=y?.drawPositions?.filter(Boolean),w=y?.matchUpTieId,T=Ey({matchUpId:w||p,inContextDrawMatchUps:g,drawDefinition:u});Object.assign(e,{inContextDrawMatchUps:g,inContextMatchUp:y,matchUpTieId:w,matchUpsMap:h,targetData:T,structure:S,matchUp:I});let D=l===lf&&""===f?.scoreStringSide1&&""===f?.scoreStringSide2&&!d;if(function(e){let{targetData:t,matchUpsMap:r}=e,{targetMatchUps:{loserMatchUp:i}}=t,n=rv(i?.matchUpStatus),a=!!r?.drawMatchUps.find(e=>e.loserMatchUpId===i?.matchUpId&&rv(e.matchUpStatus));return a&&i?.matchUpStatus===nf||a&&n}(e)&&D)return{error:ra};let P,N=BT(e);if(b){if(s)em({extension:{name:hm,value:!0},element:I});else if(c){let t=I.winningSide,{winningSide:r,scoreStringSide1:i,scoreStringSide2:n,set:a}=Bw({drawDefinition:u,matchUpsMap:h,structure:S,matchUp:I,event:m}),o={scoreStringSide1:i,scoreStringSide2:n,sets:a?[a]:[]};if(P=r!==t,N&&P)return ac({stack:"winningSideWithDownstreamDependencies",result:{error:Wa},context:{winningSide:d,matchUp:I}});Jp({name:hm,element:I}),Object.assign(e,{winningSide:r,dualWinningSideChange:P,projectedWinningSide:r,score:o})}$w({tournamentId:o?.tournamentId,inContextDualMatchUp:y,eventId:m?.eventId,dualMatchUp:I,drawDefinition:u})}if(b&&l&&[Qm].includes(l))return{info:"Not supported for matchUpType: TEAM",error:Zo};if(f&&!b&&!i){let e=I.matchUpFormat??S?.matchUpFormat??u?.matchUpFormat??m?.matchUpFormat,t=oE({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:e,matchUpStatus:l,winningSide:d,score:f});if(t.error)return t}let E=zh({policyTypes:[Gp,Hp],tournamentRecord:o,drawDefinition:u,event:m})?.appliedPolicies??{};ti(e.policyDefinitions)&&Object.assign(E,e.policyDefinitions);let M=function({assignedDrawPositions:e,propagateExitStatus:t,inContextMatchUp:r,appliedPolicies:i,drawDefinition:n,matchUpStatus:a,structure:o,matchUp:s}){if(!1===i?.[Hp]?.requireParticipantsForScoring)return{...Gi};let c=r?.sides?.map(e=>e.participantId).filter(Boolean).length,u=s?.sides?[]:Pf({structureId:o?.structureId,drawDefinition:n}).positionAssignments,l=c&&2===c||s.collectionId&&jg({structure:o})&&c&&c>=1||2===e?.length&&u?.filter(t=>e.includes(t.drawPosition)).every(e=>e.participantId);return a&&[df,tf,nf].includes(a)&&1===c&&t?{...Gi}:a&&mf.includes(a)&&!l?ac({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:a,requiredParticipants:l},result:{error:ia}}):{...Gi}}({assignedDrawPositions:U,propagateExitStatus:n,inContextMatchUp:y,appliedPolicies:E,drawDefinition:u,matchUpStatus:l,structure:S,matchUp:I});if(M?.error)return M;let R=y?.stage===Ml&&1===y.finishingRound,A=R&&d,C=R&&I.winningSide&&!d&&(!e.matchUpStatus||e.matchUpStatus&&zy({matchUpStatus:e.matchUpStatus}))&&(!e.outcome||!qy({outcome:e.outcome})),k=A&&d!==I.winningSide&&I.winningSide;if(Object.assign(e,{qualifierAdvancing:A,qualifierChanging:k,removingQualifier:C,appliedPolicies:E}),w){let{matchUp:t}=Aw({matchUpId:w,inContext:!0,drawDefinition:u,matchUpsMap:h,event:m});if(t){let r=Cg({matchUp:t,drawDefinition:u,structure:S,event:m})?.tieFormat,{projectedWinningSide:i}=function({drawDefinition:e,matchUpStatus:t,matchUpsMap:r,winningSide:i,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:c,score:u}){let l=Nu(n,void 0,!0);for(let p of l?.tieMatchUps||[])p.matchUpId===s.matchUpId&&(p.winningSide=i,p.score=u,qy({score:u})||t?t&&(p.matchUpStatus=t):Object.assign(p,{...xw}));a=a??Cg({matchUp:s,structure:o,drawDefinition:e,event:c})?.tieFormat;let{winningSide:d}=Bw({matchUp:l,drawDefinition:e,matchUpsMap:r,structure:o,tieFormat:a,event:c});return{projectedWinningSide:d}}({drawDefinition:u,matchUpStatus:l,dualMatchUp:t,matchUpsMap:h,winningSide:d,tieFormat:r,structure:S,matchUp:I,event:m,score:f});P=i!==t.winningSide;let n=t._disableAutoCalc;Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:P,projectedWinningSide:i,autoCalcDisabled:n,matchUpTieId:w,dualMatchUp:t,tieFormat:r})}}let x=Hy({matchUpStatus:l});if(!w){if(N&&!d&&(l&&zy({matchUpStatus:l})||l&&[nf,rf].includes(l)))return{error:ta,activeDownstream:N,winningSide:d};if(d&&d===I.winningSide&&l&&!x)return{context:"winningSide must include directing matchUpStatus",error:ta,directingMatchUpStatus:x,matchUpStatus:l}}let{schedule:O}=e;if(O){let e=gk({disableNotice:!0,tournamentRecords:a,tournamentRecord:o,drawDefinition:u,matchUpId:p,schedule:O});if(e.error)return e}let F=!b&&!P&&d&&I.winningSide&&I.winningSide!==d;if(r&&F&&I.roundPosition)return function(e){let{tournamentRecord:t,inContextMatchUp:r,structure:i,drawDefinition:n}=e,a=r.roundNumber,o=r.sides.find(e=>e.sideNumber===r.winningSide),s=r.sides.find(e=>e.sideNumber!==r.winningSide),{drawPosition:c,participantId:u}=o,{drawPosition:l,participantId:d}=s,{matchUps:p}=Uy(e),m=p.filter(({drawPositions:e,roundNumber:t})=>e?.includes(c)&&t>a);Ps({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(r=>{r.drawPositions=r.drawPositions?.map(e=>e===c?l:e)||[],ch({tournamentId:t?.tournamentId,eventId:e.event?.eventId,context:"swapWinnerLoser",drawDefinition:n,matchUp:r})});let{stage:f,stageSequence:h}=i,g=n.structures.filter(({stage:e,stageSequence:t})=>e===f&&t>h).map(({structureId:e})=>e),{targetLinks:{loserTargetLink:I,winnerTargetLink:y}}=e.targetData,v=[I?.target.structureId,y?.target?.structureId].filter(Boolean);return n.structures.filter(({stage:e,structureId:t})=>e!==f&&v.includes(t)).forEach(({stage:e,stageSequence:t,structureId:r})=>{g.includes(r)||g.push(r),n.structures.filter(({stage:r,stageSequence:i})=>r===e&&i>t).forEach(({structureId:e})=>{g.includes(e)||g.push(e)})}),n.structures.filter(({structureId:e})=>g.includes(e)).forEach(e=>{let{positionAssignments:t}=Pf({structure:e}),r=t?.find(({participantId:e})=>e===u),i=t?.find(({participantId:e})=>e===d);r&&(r.participantId=d),i&&(i.participantId=u)}),Ow({...e})}(e);let _=d&&!w||e.projectedWinningSide;Zy({activeDownstream:N,matchUpWinner:_,method:t,winningSide:d});let L=!N&&ak(e)||_&&function(e){let{matchUp:t,winningSide:r,matchUpTieId:i,dualWinningSideChange:n}=e;return r===t.winningSide||i&&!n?Tk(e):ac({stack:"winningSideWithDownstreamDependencies",result:{error:Wa},context:{winningSide:r,matchUp:t}})}(e)||(x||e.autoCalcDisabled)&&Tk(e)||{error:rs};return ac({result:L,stack:t})}function Tk(e){let{tournamentRecord:t,matchUp:r,event:i}=e,n=e.isCollectionMatchUp&&r.winningSide&&!e.winningSide&&!qy({score:e.score}),a=e.isCollectionMatchUp?e.matchUpStatus||n&&lf||e.winningSide&&Zm||of:e.matchUpStatus||Zm,o=e.removeScore||[Jm,df].includes(a)&&![of,Xm].includes(a),s=Ow({...e,matchUpStatus:a,removeWinningSide:n,removeScore:o});if(s.error)return s;if(e.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:n,matchUpsMap:a}=e,o=Ww({appliedPolicies:e.appliedPolicies,matchUpId:r,tournamentRecord:t,drawDefinition:n,matchUpsMap:a,event:i});if(o.error)return o;Object.assign(s,{tieMatchUpResult:o})}return s}function Dk({tournamentRecord:e,drawDefinition:t,matchUpId:r,event:i}){if(!t)return{error:rn};let{matchUp:n}=Aw({drawDefinition:t,matchUpId:r,event:i});return n?.matchUpType!==zr?{error:fa}:wk({enableAutoCalc:!0,tournamentRecord:e,drawDefinition:t,matchUpId:r,event:i})}function Pk({drawDefinition:e,event:t,matchUpId:r}){if(!e)return{error:rn};if(!r)return{error:ua};let{matchUp:i}=Aw({drawDefinition:e,event:t,matchUpId:r});return i?Jp({name:mm,element:i}):{error:da}}function Nk(e){return function({substituteParticipantId:e,existingParticipantId:t,tournamentRecord:r,drawDefinition:i,sideNumber:n,matchUpId:a,event:o}){let s="substituteParticipant";if(!i)return{error:rn};if(!a)return{error:ua};if(!t||!e)return ac({result:{error:Za},stack:s});let{matchUp:c}=Aw({drawDefinition:i,matchUpId:a,event:o});if(!c)return{error:da};if(!c.collectionId)return ac({result:{error:fa},stack:s});let u=kg({drawDefinition:i}),{matchUps:l}=Cy({tournamentParticipants:r?.participants,inContext:!0,drawDefinition:i,matchUpsMap:u}),d=l?.find(e=>e.matchUpId===a),p=l?.find(e=>e.matchUpId===d?.matchUpTieId)?.sides?.find(e=>e.participant.individualParticipants.some(({participantId:e})=>e===t));return!p||n&&p.sideNumber!==n?{error:Ha}:p.participant?.individualParticipants?.map(Hm).filter(e=>e!==t)?.includes(e)?FC({newParticipantId:e,tieMatchUpId:a,existingParticipantId:t,substitution:!0,tournamentRecord:r,drawDefinition:i,event:o}):ac({result:{error:Ha},stack:s})}(e)}function Ek({drawDefinition:e,matchUpId:t,event:r}){if(!e)return{error:rn};let{matchUp:i}=Aw({drawDefinition:e,matchUpId:t,event:r});return em({extension:{name:hm,value:!0},element:i})}function Mk(e){let t="setMatchUpFormat",r=Dp(e,[{tournamentRecord:!0},{[gp]:e=>_c({matchUpFormat:e}),[yp]:ea,matchUpFormat:!0}]);if(r.error)return ac({result:r,stack:t});let{tournamentRecord:i,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:c,eventType:u,matchUpId:l,eventId:d,stages:p,drawId:m,event:f,force:h}=e;if(a&&!Array.isArray(a))return ac({result:{error:Zo,scheduledDates:a},stack:t});if(u&&!ji([bl,wl],u))return ac({result:{error:Vn},stack:t});let g=0,I=e.structureIds||c&&[c].filter(Boolean)||[],y=e.eventIds||d&&[d].filter(Boolean)||[],v=e.drawIds||m&&[m].filter(Boolean)||[];if((c||I?.length)&&!n)return ac({result:{error:rn},stack:t});if(m&&l&&n){let e=QE({tournamentRecord:i,drawDefinition:n,matchUpFormat:s,structureIds:I,structureId:c,matchUpId:l});if(e.error)return e;g+=1}let S=e=>{let r=[];for(let n of e.structures||[]){if(Array.isArray(p)&&!p.includes(n.stage)||Array.isArray(o)&&!o.includes(n.stageSequence)||I?.length&&!I.includes(n.structureId))continue;I?.length&&n.matchUpFormat!==s&&(n.matchUpFormat=s,r.push(n.structureId),g+=1);let c=((h||a)&&Uy({matchUpFilters:{matchUpStatuses:[lf]},structure:n}).matchUps)??[],u=(a&&Uy({matchUpFilters:{matchUpStatuses:[lf]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:n}).matchUps)??[];if(c?.length){let r=u?u.map(zm):c.map(zm);for(let n of c)r.includes(n.matchUpId)&&(n.matchUpFormat=a?.length?s:void 0,ch({tournamentId:i?.tournamentId,eventId:f?.eventId,context:t,drawDefinition:e,matchUp:n}))}}return!r.length&&e.matchUpFormat!==s&&(e.matchUpFormat=s,g+=1),r};for(let b of i?.events||[])if(!(y?.length&&!y.includes(b.eventId)||u&&u!==b.eventType||u===Dl))if(Array.isArray(o)||Array.isArray(p)||I?.length||v?.length)for(let e of b.drawDefinitions||[]){if(Array.isArray(v)&&!v.includes(e.drawId))continue;lh({structureIds:S(e),drawDefinition:e})}else b.matchUpFormat!==s&&(b.matchUpFormat=s,g+=1);return g?{...Gi,modificationsCount:g}:{...Gi,info:qo}}function Rk({inheritance:e=!0,tournamentRecord:t,drawDefinition:r,matchUpId:i,event:n}){if(!r)return{error:rn};let a=Aw({drawDefinition:r,matchUpId:i})?.matchUp;if(!a?.tieMatchUps)return{error:fa};let o=Aw({inContext:!0,drawDefinition:r,matchUpId:i,event:n})?.matchUp,s=0;return(a?.sides||[]).forEach(e=>{e.lineUp&&delete e.lineUp}),(o?.sides||[]).forEach(i=>{if(s+=1,!1===e){let e=o?.tieFormat,t=i.participantId;e&&t&&Rb({drawDefinition:r,participantId:t,lineUp:[],tieFormat:e})}ch({tournamentId:t?.tournamentId,context:"resetMatchUpLineUps",eventId:n?.eventId,drawDefinition:r,matchUp:a})}),{...Gi,modificationsCount:s}}function Ak(e){let{matchUpFormat:t,matchUpStatus:r,winningSide:i,score:n,setTBlast:a}=e;if(!n)return{sets:[]};let o=n.sets||[],s=tP({winnerFirst:!1,matchUpFormat:t,matchUpStatus:r,setTBlast:a,sets:o}),c=tP({winnerFirst:!1,reversed:!0,matchUpFormat:t,matchUpStatus:r,setTBlast:a,sets:o}),u=tP({matchUpFormat:t,matchUpStatus:r,winningSide:i,setTBlast:a,sets:o}),l=s===u?c:s;return i&&(s=1===i?u:l,c=2===i?u:l),{score:{sets:o,scoreStringSide1:s,scoreStringSide2:c}}}function Ck({sourceMatchUpStatusCodes:e,propagateExitStatus:t,sourceMatchUpStatus:r,loserParticipantId:i,tournamentRecord:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,event:c}){let u="progressExitStatus";Zy({method:u,newline:!0,color:"magenta",keyColors:{loserMatchUpId:"brightcyan",sourceMatchUpStatus:"brightyellow"},loserMatchUpId:o?.matchUpId,loserMatchUpStatus:o?.matchUpStatus,sourceMatchUpStatus:r,sourceMatchUpStatusCodes:JSON.stringify(e),loserParticipantId:i?.slice(0,8),propagateExitStatus:t});let l=rv(r)&&r!==cf&&r||df,d=Cy({inContext:!0,drawDefinition:a,matchUpsMap:s})?.matchUps,p=l,m=d?.find(e=>e.matchUpId===o?.matchUpId);if(Zy({method:u,color:"magenta",carryOverMatchUpStatus:l,updatedLoserMatchUpId:m?.matchUpId,updatedLoserStatus:m?.matchUpStatus,updatedLoserSides:JSON.stringify(m?.sides?.map(e=>({sn:e.sideNumber,pid:e.participantId?.slice(0,8),bye:e.bye}))),updatedLoserDP:JSON.stringify(m?.drawPositions),existingStatusCodes:JSON.stringify(m?.matchUpStatusCodes)}),m?.matchUpId&&p){let r,s=m.matchUpStatusCodes?.map(e=>"string"==typeof e?e:"WO")??[],l=m.sides?.find(e=>e.participantId===i);if(l?.sideNumber){let t=m?.sides?.reduce((e,t)=>t?.participantId?e+1:e,0);if(Zy({method:u,color:"brightyellow",keyColors:{decision:"brightgreen"},loserSideNumber:l.sideNumber,participantsCount:t,statusCodesLength:s.length,existingStatusCodes:JSON.stringify(s),loserMatchUpIsExit:rv(o.matchUpStatus),loserMatchUpOriginalStatus:o.matchUpStatus}),1===t&&0===s.length)r=1===l.sideNumber?2:1,s[0]=e[0],Zy({method:u,color:"brightgreen",decision:"SINGLE_PARTICIPANT_no_existing_codes",winningSide:r,statusCodes:JSON.stringify(s)});else if(rv(o.matchUpStatus)){let t=s[0];s[l.sideNumber-1]=e[0],s[(1===l.sideNumber?2:1)-1]=t,p=nf,r=void 0,Zy({method:u,color:"brightred",decision:"BOTH_EXITS_converting_to_DOUBLE_WALKOVER",loserMatchUpStatus:p,winningSide:r,statusCodes:JSON.stringify(s)})}else r=1===l.sideNumber?2:1,s[0]=e[0],Zy({method:u,color:"brightgreen",decision:"TWO_PARTICIPANTS_not_exit",winningSide:r,statusCodes:JSON.stringify(s)})}else Zy({method:u,color:"brightyellow",decision:"NO_LOSER_PARTICIPANT_SIDE_FOUND",loserParticipantId:i?.slice(0,8),availableSides:JSON.stringify(m.sides?.map(e=>({sn:e.sideNumber,pid:e.participantId?.slice(0,8)})))});return Zy({method:u,color:"brightmagenta",keyColors:{finalStatus:"brightgreen",finalWinningSide:"brightyellow"},action:"calling_setMatchUpState",loserMatchUpId:o.matchUpId,finalStatus:p,finalWinningSide:r,finalStatusCodes:JSON.stringify(s)}),ac({result:wk({matchUpStatus:p,matchUpId:o.matchUpId,matchUpStatusCodes:s,allowChangePropagation:!0,propagateExitStatus:t,tournamentRecord:n,drawDefinition:a,winningSide:r,event:c}),stack:u,context:{progressExitStatus:!0}})}return ac({result:{error:ma},stack:u})}function kk(e){let t=Dp(e,[{[Kd]:!0,[xd]:!0}]);if(t.error)return t;let r=yh(e);if(!e.drawDefinition){let t=e.tournamentRecord??(e.tournamentId&&r[e.tournamentId]);e.tournamentRecord||(e.tournamentRecord=t);let i=my({eventId:e.eventId,drawId:e.drawId,tournamentRecord:t});if(i.error)return i;i.drawDefinition&&(e.drawDefinition=i.drawDefinition),e.event=i.event}let{disableScoreValidation:i,propagateExitStatus:n,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:c,drawDefinition:u,matchUpId:l,schedule:d,event:p,notes:m}=e,f=e.matchUpFormat||e.outcome?.matchUpFormat,{policy:h}=ig({policyType:Hp,tournamentRecord:o,event:p}),g=void 0!==e.allowChangePropagation&&e.allowChangePropagation||void 0!==h?.allowChangePropagation&&h.allowChangePropagation||void 0,{outcome:I,setTBlast:y}=e;if(I?.winningSide&&![1,2].includes(I.winningSide))return{error:La};if(f){let e=QE({tournamentRecord:o,drawDefinition:u,matchUpFormat:f,matchUpId:l,event:p});if(e.error)return e}if(I?.score?.sets&&!I.score.scoreStringSide1){let{score:e}=Ak({...I,setTBlast:y});I.score=e,I.score.sets=I.score.sets.filter(e=>e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore)}let v=wk({matchUpStatusCodes:I?.matchUpStatusCodes,matchUpStatus:I?.matchUpStatus,winningSide:I?.winningSide,allowChangePropagation:g,disableScoreValidation:i,score:I?.score,propagateExitStatus:n,tournamentRecords:r,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:c,drawDefinition:u,matchUpFormat:f,matchUpId:l,schedule:d,event:p,notes:m});if(v.context?.progressExitStatus){let t=!0,r=0;for(;t&&r<10;){t=!1,r+=1;let i=Ck({sourceMatchUpStatusCodes:v.context.sourceMatchUpStatusCodes,sourceMatchUpStatus:v.context.sourceMatchUpStatus,loserParticipantId:v.context.loserParticipantId,propagateExitStatus:e.propagateExitStatus,tournamentRecord:e.tournamentRecord,loserMatchUp:v.context.loserMatchUp,matchUpsMap:v.context.matchUpsMap,drawDefinition:e.drawDefinition,event:e.event});i.context?.loserMatchUp&&(Object.assign(v.context,i.context),t=!0)}}return ac({result:v,stack:"setMatchUpStatus"})}function xk(e){if(!e?.outcomes)return{error:Da};if(!Array.isArray(e.outcomes))return{error:Da,info:{outcomes:e.outcomes}};let t=e.tournamentRecords||e.tournamentRecord&&{[e.tournamentRecord.tournamentId]:e.tournamentRecord}||{},r=e.outcomes??[],i=r.reduce((e,t)=>e.includes(t.tournamentId)?e:e.concat(t.tournamentId),[]);for(let n of i){let e=t[n];if(!e)return{error:Ji};let i=r.filter(e=>e.tournamentId===n);if(i.length){let t=Ok({outcomes:i,tournamentRecord:e});if(t.error)return t}}return{...Gi}}function Ok(e){let{tournamentRecords:t,tournamentRecord:r,outcomes:i,policyDefinitions:n}=e,a={};i.forEach(e=>{let{eventId:t}=e;a[t]||(a[t]=[]),a[t].push(e)});for(let o of Object.keys(a)){let{event:e}=my({tournamentRecord:r,eventId:o});for(let i of a[o]){let{drawId:a}=i,o=e?.drawDefinitions?.find(e=>e.drawId===a);if(o&&a){let{matchUpFormat:s,matchUpId:c}=i,u=kk({schedule:i?.schedule,tournamentRecords:t,policyDefinitions:n,tournamentRecord:r,drawDefinition:o,matchUpFormat:s,matchUpId:c,outcome:i,drawId:a,event:e});if(u.error)return u}}}return{...Gi}}function Fk(e){return function({drawDefinition:e,matchUpId:t,outcome:r,matchUp:i}){if(!i&&!e)return{error:rn};if(!r)return{error:Da,info:"missing outcome"};if(!i&&!t)return{error:ma};if(!i){let r=Aw({drawDefinition:e,matchUpId:t});if(r.error)return r;i=r.matchUp}return"object"==typeof r&&r.score?.scoreStringSide1&&r.score?.scoreStringSide2?em({element:i,extension:{name:mm,value:r}}):{error:Zo}}(e)}function _k(e){let t="resetTieFormat",{drawDefinition:r,event:i,uuids:n}=e,a=Dp(e,[{[Cd]:!0,[Kd]:!0}],t);if(a.error)return a;let o=kR(e,[{[up]:ap}]);if(o[sp])return o;let s=e.tournamentRecord?.tournamentId,{matchUp:c,structure:u}=o?.matchUp??{};if(!c?.tieMatchUps)return ac({result:{error:fa},info:"Must be a TEAM matchUp",stack:t});if(!c.tieFormat)return{...Gi};let l=Cg({structure:u,drawDefinition:r,event:i})?.tieFormat;if(!l)return ac({result:{error:as},info:"No inherited tieFormat",stack:t});let d=[],p=[],m=[],f=[];for(let h of l.collectionDefinitions){let{matchUpCount:e,collectionId:t}=h;p.push(t);let r=(c.tieMatchUps||[]).filter(e=>e.collectionId===t);if(r.length>e)r.sort((e,t)=>(e.matchUpStatus===lf?1:0)-(t.matchUpStatus===lf?1:0)),m.push(...r.slice(0,e)),d.push(...r.slice(3).map(zm));else if(m.push(...r),r.length<e){let t=aw({collectionDefinition:h,matchUpsLimit:e-r.length,matchUp:c,uuids:n});f.push(...t)}}for(let h of c?.tieMatchUps||[])h.collectionId&&!p.includes(h.collectionId)&&d.push(h.matchUpId);return f.length&&(m.push(...f),oh({eventId:i?.eventId,matchUps:f,drawDefinition:r,tournamentId:s})),d.length&&sh({matchUpIds:d,eventId:i?.eventId,drawDefinition:r,tournamentId:s}),c&&(c.tieMatchUps=m,c.tieFormatId=void 0,c.tieFormat=void 0,ch({structureId:u?.structureId,eventId:i?.eventId,context:t,drawDefinition:r,tournamentId:s,matchUp:c})),{...Gi,newMatchUps:f,deletedMatchUpIds:d}}function Lk(e){let{tournamentRecord:t,drawDefinition:r,matchUpId:i,event:n}=e,a="resetScorecard";if(!r)return ac({result:{error:rn},stack:a});if(!i)return ac({result:{error:ua},stack:a});if(!ei(i))return ac({result:{error:Zo,matchUpId:i},stack:a});let o=kg({drawDefinition:r}),{matchUps:s}=Cy({nextMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:o}),c=o.drawMatchUps.find(e=>e.matchUpId===i),u=s?.find(e=>e.matchUpId===i);if(!c||!s)return{error:da};if(c.matchUpType!==Pl)return{error:fa};let l=Ey({inContextDrawMatchUps:s,drawDefinition:r,matchUpId:i}),d=u?.structureId,{structure:p}=wf({drawDefinition:r,structureId:d});if(Object.assign(e,{inContextDrawMatchUps:s,inContextMatchUp:u,matchUpsMap:o,targetData:l,structure:p,matchUp:c}),BT(e))return{error:Wa};if(c.tieMatchUps?.length)for(let h of c.tieMatchUps){let e=wk({matchUpId:h.matchUpId,matchUpTieId:i,winningSide:void 0,removeScore:!0,tournamentRecord:t,drawDefinition:r,event:n});if(e.error)return ac({result:e,stack:a})}let m=zh({tournamentRecord:t,drawDefinition:r,event:n})?.appliedPolicies,f=Ww({event:e.event,removeScore:!0,tournamentRecord:t,appliedPolicies:m,drawDefinition:r,matchUpsMap:o,matchUpId:i});if(f.error)return ac({result:f,stack:a});if(e.tiebreakReset&&!f.tieFormatRemoved){let e=Cg({drawDefinition:r,structure:p,event:n})?.tieFormat;if(c.tieFormat&&e){let{matchUpCountDifference:a,descendantDifferences:o,ancestorDifferences:s,valueDifference:u}=CM({descendant:c.tieFormat,ancestor:e});if(1===o.collectionIds.length&&!s.collectionIds.length&&!s.groupsCount&&1===a&&1===u){let e=_k({tournamentRecord:t,drawDefinition:r,matchUpId:i,event:n});if(e.error)return e}}}return{...Gi}}function Bk(e){let t=Dp(e,[{[xd]:!0,[cp]:!0},{[bp]:{[Wd]:!1,roundNumbers:!1},[Ip]:"At least one must be provided",[vp]:hp}]);if(t.error)return t;let r=dT(e);if(r.error)return r;let{matchUpIds:i}=r,n=MI(Pl)(e.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=e;for(let c of i){if(n){let t=Lk({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:c,event:s});if(t.error||e.removeAssignments&&Rk({inheritance:!1,drawDefinition:o,matchUpId:c}).error)return t}let t=wk({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:c,event:s});if(t.error)return t;if(e.removeAssignments){let t=GC({...e,matchUpId:c});if(t.error)return t}}return{...Gi}}function $k(e){return function({tournamentRecord:e,drawDefinition:t,finishingOrder:r}){if(!t)return{error:rn};let i="setOrderOfFinish";if(!Array.isArray(r))return ac({info:Eb("finishingOrder"),result:{error:Zo},stack:i});let{completedMatchUps:n,matchUpsMap:a}=ky({inContext:!0,drawDefinition:t}),o=n?.map(zm)??[],s=r.map(zm),{matchUpTypes:c,roundNumbers:u,structureIds:l,matchUpTieIds:d}=(n??[]).filter(({matchUpId:e})=>s.includes(e)).reduce((e,t)=>{let{matchUpTieId:r,matchUpType:i,roundNumber:n,structureId:a}=t;return e.matchUpTypes.includes(i)||e.matchUpTypes.push(i),e.roundNumbers.includes(n)||e.roundNumbers.push(n),e.structureIds.includes(a)||e.structureIds.push(a),e.matchUpTieIds.includes(r)||e.matchUpTieIds.push(r),e},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(c.length>1||d.length>1||u.length>1||l.length>1)return ac({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Zo},stack:i});let p,m,f={},h=[],g=[];if(!r.every(({orderOfFinish:e,matchUpId:t})=>(h.push(t),e&&g.push(e),f[t]=e,p=o.includes(t),m=void 0===e||gi(e)&&Math.floor(e)>0,p&&m)))return ac({result:{error:p?Zo:ia},info:(p?!m&&"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed")||void 0,stack:i});let I=n?.filter(e=>e.structureId===l[0]&&e.roundNumber===u[0]&&e.matchUpType===c[0]&&e.matchUpTieId===d[0]&&!h.includes(e.matchUpId));for(let y of I??[]){let{orderOfFinish:e}=y||{};if(e){if(!gi(e))return ac({context:{orderOfFinish:e,matchUp:y},result:{error:Zo},stack:i});g.push(e)}}if(Ni(g).length!==g.length||Math.max(...g)>g.length)return ac({info:"Values not unique or greater than expected number of values",result:{error:Zo},stack:i});if(l.length){let r=Ty({matchUpFilters:{matchUpIds:s},structureId:l[0],drawDefinition:t,matchUpsMap:a});if(r.error)return ac({result:r,stack:i});r.completedMatchUps?.forEach(r=>{r.orderOfFinish=f[r.matchUpId],ch({tournamentId:e.tournamentId,context:"setOrderOfFinish",drawDefinition:t,matchUp:r})})}return{...Gi}}(e)}function Vk(e){let{tournamentRecord:t,drawDefinition:r,matchUpId:i,lineUps:n,event:a}=e,o="applyLineUps",s=Dp(e,[{[Cd]:!0,[xd]:!0,[Kd]:!0},{lineUps:!0,[vp]:hp}],o);if(s.error)return s;let c=t.participants||[],u=Aw({tournamentParticipants:c,inContext:!0,drawDefinition:r,matchUpId:i});if(u.error)return u;if(!u.matchUp)return{error:da};let{matchUp:l,structure:d}=u,{drawPositions:p,matchUpType:m}=l;if(m!==Yr)return{error:fa};if(!p?.length)return{error:fn};let f=Cg({matchUp:l,drawDefinition:r,structure:d,event:a})?.tieFormat,h={};for(let I of n){if(!Array.isArray(I))return{error:Zo,lineUp:I};let e={},r=[];for(let t of I){if("object"!=typeof t)return{error:Zo,lineUpAssignment:t};let{participantId:i,collectionAssignments:n=[]}=t;if(!Array.isArray(n))return{error:Zo,collectionAssignments:n};let a=c.find(e=>e.participantId===i);if(!a)return{error:to};if(a.participantType!==wh)return{error:Ka};let o=l.sides?.find(e=>e.participant?.individualParticipantIds?.includes(i))?.sideNumber;o&&r.push(o);for(let t of n){if("object"!=typeof t)return{error:Zo,collectionAssignment:t};let{collectionId:r,collectionPosition:n}=t,a=f?.collectionDefinitions?.find(e=>e.collectionId===r);if(!a)return{error:Zo,collectionId:r};let o=`${r}-${n}`;e[o]||(e[o]=[]);let s=e[o].length;if(MI(Wr)(a.matchUpType)&&s||a.matchUpType===Hr&&s>1)return{info:"Excessive collectionPosition assignments",error:Zo};e[o].push(i)}}let i=Object.values(e);for(let s of i)if(2===s.length){let{participant:e}=gy({tournamentParticipants:c,participantIds:s});if(!e){let e=dA({participant:{participantType:Dh,participantRole:xS,individualParticipantIds:s},pairOverride:!0,tournamentRecord:t});if(e.error)return e}}let n=wi(r),a=((n[1]||0)>(n[2]||0)?1:(n[2]||0)>(n[1]||0)&&2)||void 0,o=Object.keys(h).map(e=>parseInt(e));a&&!o.includes(a)&&(h[a]=I)}if(!Object.keys(h).length)return{error:ns};if(u=Aw({drawDefinition:r,matchUpId:i}),u.error)return u;if(!u.matchUp)return{error:da};let{matchUp:g}=u;g.sides??=[];for(let I of[1,2]){let e=g.sides.find(e=>e.sideNumber===I),t=h[I];t&&(e?e.lineUp=t:g.sides.push({lineUp:t,sideNumber:I}))}return ch({tournamentId:t?.tournamentId,context:o,drawDefinition:r,matchUp:g}),{...Gi}}var jk={};Br(jk,{anonymizeTournamentRecord:()=>nO,generate:()=>Gk,generateEventWithDraw:()=>Yx,generateOutcome:()=>Ox,generateOutcomeFromScoreString:()=>Wk,generateParticipants:()=>Nx,generateTournamentRecord:()=>rO,modifyTournamentRecord:()=>cO,mutate:()=>iO});var Gk={};function Wk(e){let{matchUpFormat:t,matchUpStatus:r,winningSide:i,scoreString:n,setTBlast:a,preserveSideOrder:o=!1}=e;if(!n)return{outcome:{...xw,winningSide:i,matchUpStatus:r}};if(i&&![1,2,void 0].includes(i))return{error:Zo,winningSide:i};let s=n&&lE({scoreString:n,matchUpFormat:t}),c=n?.trim().startsWith("["),u=function(e,t,r){return!e&&t&&r?iE(Mc(t))?function(e){let t=e.reduce((e,t)=>((void 0!==t.side1Score||void 0!==t.side2Score)&&(e.side1+=t.side1Score??0,e.side2+=t.side2Score??0),e),{side1:0,side2:0});return t.side1>t.side2?1:t.side2>t.side1?2:e.find(e=>void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore)?.winningSide}(r):function(e){let t={side1:0,side2:0};return e.forEach(e=>{1===e.winningSide?t.side1++:2===e.winningSide&&t.side2++}),t.side1>t.side2?1:t.side2>t.side1?2:void 0}(r):e}(i,t,s),l=Mc(t),d=o||c||iE(l)?function(e,t,r){let i=lE({scoreString:e,matchUpFormat:t});return{sets:i,scoreStringSide1:tP({sets:i,matchUpFormat:t,setTBlast:r}),scoreStringSide2:tP({sets:i,reversed:!0,matchUpFormat:t,setTBlast:r})}}(n,t,a):function(e,t,r,i){let n=tP({sets:e,matchUpFormat:r,setTBlast:i}),a=tP({sets:e,reversed:!0,matchUpFormat:r,setTBlast:i});if("string"!=typeof n)return n;if("string"!=typeof a)return a;let o=2===t?a:n,s=2===t?n:a;return{sets:lE({scoreString:o,matchUpFormat:r}),scoreStringSide1:o,scoreStringSide2:s}}(s,u,t,a);return nc({outcome:{matchUpStatus:r,winningSide:u,score:d}})}function qk({matchUpScheduleTimes:e,matchUpDependencies:t,allDateMatchUpIds:r,matchUp:i}){let n=(t?.[i.matchUpId]?.matchUpIds||[]).filter(e=>r.includes(e)).filter(t=>!e[t]);return{dependenciesScheduled:!n?.length,remainingDependencies:n}}function Hk({individualParticipantProfiles:e,participantId:t}){e[t]||(e[t]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function zk({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,typeChangeRecoveryMinutes:r,averageMatchUpMinutes:i=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){let u=ru(c?.schedule?.endTime),l=u?du(u,Jr(o)):du(s,Jr(i)+Jr(o)),d=r&&(u?du(ru(u),r):du(s,Jr(i)+Jr(r))),p=a?.[c.matchUpId]?.participantIds||[],m=(c.roundPosition&&e[c.matchUpId]||[]).flat();p.forEach(e=>{Hk({individualParticipantProfiles:t,participantId:e});let r=t[e].priorMatchUpType!==c.matchUpType&&d||l;m.includes(e)?function({individualParticipantProfiles:e,recoveryValue:t,participantId:r,scheduleTime:i,drawId:n}){e[r].potentialRecovery[n]||(e[r].potentialRecovery[n]=[]),e[r].potentialRecovery[n].push(t),e[r].potentialBookings[n]||(e[r].potentialBookings[n]=[]),e[r].potentialBookings[n].push({timeAfterRecovery:t,scheduleTime:i})}({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:r,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=r,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:r}))}),VM({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:n,timeAfterRecovery:l,matchUp:c})}function Yk({matchUpScheduleTimes:e,matchUpDependencies:t,scheduleTime:r,matchUpId:i,details:n}){let a,o=n.minutesMap?.[i]?.recoveryMinutes,s=du(r,(n.minutesMap?.[i]?.averageMinutes||0)+(o||0)),c=t?.[i]?.dependentMatchUpIds||[];if(c.length){let t=c.reduce((t,r)=>{let i=e[r];if(!i)return t;let n={scheduleTime:i,matchUpId:r};return i&&!t.matchUpId||eu(i)<eu(t.scheduleTime)?n:t},{});t.scheduleTime&&eu(s)>eu(t.scheduleTime)&&(a=t)}return{scheduledDependent:a}}Br(Gk,{generateEventWithDraw:()=>Yx,generateOutcome:()=>Ox,generateOutcomeFromScoreString:()=>Wk,generateParticipants:()=>Nx,generateTournamentRecord:()=>rO});var Kk="DO_NOT_SCHEDULE",Xk={DO_NOT_SCHEDULE:Kk};function Qk({averageMatchUpMinutes:e=90,requestConflicts:t={},potentials:r=!0,personRequests:i,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=function(e){let{sides:t,matchUpType:r}=e||{};return(t||[]).map(e=>r===Hr&&(e?.participant?.individualParticipants||[])||e?.participant&&[e.participant]||[]).flat()}(o).map(({person:e})=>e?.personId);if(r){let e=(o?.potentialParticipants||[]).flat().map(({person:e})=>e?.personId);s.push(...e)}let c=s.map(e=>i[e]?.map(t=>({...t,personId:e}))).filter(Boolean).flat().filter(e=>e.requestType===Kk&&fu(a,e.date)),u=[],l=o?.matchUpId,d=uu(ru(n),iu(a)),p=ru(pu(d,e).toISOString());for(let m of c){let{requestId:e,startTime:r,endTime:i}=m;(n>r&&n<i||p&&p>r&&p<i)&&(u.push({matchUpId:l,request:m,scheduleTime:n}),t[e]?(t[e].scheduleTimes.includes(n)||t[e].scheduleTimes.push(n),t[e].matchUpIds.includes(l)||t[e].matchUpIds.push(l)):t[e]={request:m,scheduleTimes:[n],matchUpIds:[l]})}return{conflicts:u}}function Jk({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUp:r,value:i}){let{matchUpType:n}=r,{individualParticipantIds:a}=Ih(r),o=(e[r.matchUpId]||[]).filter(e=>!xi(e,a)).flat();[...a,...o].forEach(e=>{if(Hk({individualParticipantProfiles:t,participantId:e}),!t[e].potentialCounted[r.drawId]){let a=t[e].counters;a[n]?a[n]+=i:i>0&&(a[n]=i),a[OI]?a[OI]+=i:i>0&&(a[OI]=i),o.includes(e)&&(t[e].potentialCounted[r.drawId]=!0)}})}function Zk({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:r,greatestAverageMinutes:i,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:c,scheduleDate:u,minutesMap:l,matchUps:d}){let p=[];r||(n=d?.filter(e=>{let t=e.schedule||{},r="BYE"===e.matchUpStatus;return r&&p.push({tournamentId:e.tournamentId,matchUpId:e.matchUpId}),!r&&yR({schedule:t})&&(!u||e.schedule.scheduledDate===u)}),r=n.map(zm));let m=Array.isArray(c)?c.includes(u):c,f=m?[]:d.filter(({matchUpId:e})=>r.includes(e));for(let h of f){Jk({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,value:1,matchUp:h});let r=h.schedule?.scheduledTime;if(r){o[h.matchUpId]=r;let n=l?.[h.matchUpId]?.recoveryMinutes;zk({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:i,recoveryMinutes:n,scheduleTime:r,matchUp:h})}}return{dateScheduledMatchUpIds:r,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:m}}function ex({defaultRecoveryMinutes:e=0,averageMatchUpMinutes:t=90,dateScheduledMatchUps:r,tournamentRecords:i,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if("object"!=typeof i)return{error:Qi};if(!_g(s)&&!Array.isArray(r))return{error:pa};a=a??bC({recoveryMinutes:e,averageMatchUpMinutes:t});let c=Object.assign({},...Object.values(i).flatMap(e=>(e.events??[]).map(t=>{let{scheduleTiming:r}=ng({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:r}}}))),u={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]};r??=s?.filter(e=>{let t=e.schedule;return yR({schedule:t})&&(!o||e.schedule.scheduledDate===o)});let l=r?.filter(e=>(!n.length||n.includes(e.schedule.venueId))&&"BYE"!==e.matchUpStatus);return{bookings:l?.map(({eventId:e,schedule:t,matchUpFormat:r})=>{let{event:i,scheduleTiming:n}=c[e],o=i?.eventType,s={...n,defaultTiming:u,matchUpFormat:r},{averageMinutes:l,recoveryMinutes:d}=zI({timingDetails:s,eventType:o}),{courtId:p,venueId:m}=t,f=ru(t.scheduledTime),h=du(f,l);return{recoveryMinutes:d,averageMinutes:l,periodLength:a,startTime:f,courtId:p,endTime:h,venueId:m}}).filter(Boolean),relevantMatchUps:l,dateScheduledMatchUps:r}}function tx({calculateStartTimeFromCourts:e=!0,remainingScheduleTimes:t,defaultRecoveryMinutes:r,averageMatchUpMinutes:i,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:c,startTime:u,venueIds:l,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),"object"!=typeof a||!Object.keys(a).length)return{error:Qi};s=s??bC({recoveryMinutes:r,averageMatchUpMinutes:i});let{courts:m,venues:f}=DT({dates:[c],ignoreDisabled:!0,tournamentRecords:a}),h=m?.filter(e=>!l||l.includes(e.venueId))??[];u=u??wC({courts:h,scheduleDate:c,startTime:!0}),p=p??wC({courts:h,scheduleDate:c,endTime:!0});let{bookings:g,dateScheduledMatchUps:I}=ex({defaultRecoveryMinutes:r,averageMatchUpMinutes:i,tournamentRecords:a,scheduleDate:c,periodLength:s,venueIds:l,matchUps:d}),y={calculateStartTimeFromCourts:e,remainingScheduleTimes:t,averageMatchUpMinutes:i,clearScheduleDates:n,date:c,periodLength:s,startTime:u,bookings:g,endTime:p,courts:h},{scheduleTimes:v}=TC(y),S=1===l?.length&&l[0]||1===f?.length&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:I?.map(Vy("matchUpId")),dateScheduledMatchUps:I,scheduleTimes:v,venueId:S}}function rx({scheduledRoundsDetails:e,greatestAverageMinutes:t,garmanSinglePass:r}){let i,n,a,o,s=[],c=[];for(let u of e.filter(Boolean))o||(o=u.hash),(u.hash===o||r)&&(c=c.concat(u.matchUpIds)),u.hash,a=t,n=u.recoveryMinutes,i=u.roundPeriodLength;return c.length&&s.push({matchUpIds:c,roundPeriodLength:i,recoveryMinutes:n,averageMinutes:a}),{groupedRounds:s}}function ix({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,scheduleCompletedMatchUps:r,containedStructureIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:c,periodLength:u,scheduleDate:l,useGarman:d,matchUps:p,courts:m,venues:f}){let h={},g=[],I=[],y=[];for(let v of f){let{rounds:f=[],venueId:S}=v,{scheduledRoundsDetails:b,greatestAverageMinutes:U,orderedMatchUpIds:w,minutesMap:T}=WM({scheduleCompletedMatchUps:r,containedStructureIds:i,tournamentRecords:c,periodLength:u,matchUps:p,rounds:f});y.push(...w??[]);let D,{groupedRounds:P}=rx({scheduledRoundsDetails:b,greatestAverageMinutes:U,garmanSinglePass:!0}),N=[];d&&({scheduleTimes:N,dateScheduledMatchUpIds:D}=tx({averageMatchUpMinutes:P[0]?.averageMinutes,scheduleDate:iu(l),venueIds:[v.venueId],clearScheduleDates:s,tournamentRecords:c,periodLength:u,matchUps:p}));let E=Zk({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,dateScheduledMatchUpIds:D,greatestAverageMinutes:U,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:l,minutesMap:T,matchUps:p});({dateScheduledMatchUpIds:D}=E);let M=E,{byeScheduledMatchUpDetails:R,clearDate:A}=E;R?.length&&I.push(...R);let{matchUpsToSchedule:C,matchUpMap:k}=jM({matchUpPotentialParticipantIds:e,scheduleCompletedMatchUps:r,dateScheduledMatchUpIds:D,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:w,clearDate:A,matchUps:p}),x=m.filter(e=>e.venueId===S);h[S]={previousRemainingScheduleTimes:[],courtsCount:x.length,greatestAverageMinutes:U,scheduledRoundsDetails:b,dateScheduledMatchUps:M,matchUpsToSchedule:C,scheduleTimes:N,groupedRounds:P,venueCourts:x,minutesMap:T,matchUpMap:k},s||g.push(...D)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:h,allDateMatchUpIds:y}}function nx({individualParticipantProfiles:e,matchUpNotBeforeTimes:t,matchUpDependencies:r,scheduleTime:i,matchUp:n,details:a}){let o=(r?.[n.matchUpId]?.participantIds||[]).flat(),s=a?.minutesMap?.[n.matchUpId]?.averageMinutes||0,c=a?.minutesMap?.[n.matchUpId]?.recoveryMinutes||0,u=o.every(t=>{Hk({individualParticipantProfiles:e,participantId:t});let r=e[t];if(!r.timeAfterRecovery)return!0;let a=ru(n?.schedule?.endTime),o=a?du(a,Jr(c)):du(i,Jr(s)+Jr(c));return![...Object.keys(r.potentialBookings).filter(e=>e!==n.drawId).map(e=>r.potentialBookings[e]).flat(),...r.bookings].find(e=>function(e,t){let r=eu(e.scheduleTime),i=eu(e.timeAfterRecovery),n=eu(t.scheduleTime),a=eu(t.timeAfterRecovery),o=r>n&&r<a,s=n>r&&n<i,c=i>n&&i<a,u=a>r&&a<i;return nc({hasOverlap:r===n||i===a||o||c||s||u,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:i,timeAfterRecovery:o},e).hasOverlap)}),l=t[n.matchUpId],d=(l?lu(uu(l),uu(i),!1):0)>=0;return{enoughTime:u&&d}}function ax({autoSchedulingAudit:e,tournamentRecords:t}){Bs({topic:xf,payload:e});let r=e=>e?Object.values(e).reduce((e,t)=>e+t.length||0,0):0,i=(e?.schedulingProfile||[]).reduce((e,t)=>e+t.venues.reduce((e,t)=>e+t.rounds.length,0),0),n={scheduledDatesCount:e.scheduledDates?.length,noTimeMatchUpIdsCount:r(e?.noTimeMatchUpIds),scheduledMatchUpIdsCount:r(e?.scheduledMatchUpIds),overLimitMatchUpIdsCount:r(e?.overLimitMatchUpIds),requestConflictsCount:r(e?.requestConflicts),profileRoundsCount:i},a={itemType:TA,itemValue:n};for(let o of Object.values(t)){let e=o.tournamentId;qs(xf)?Bs({payload:{type:TA,tournamentId:e,detail:n},topic:xf}):Xw({tournamentRecord:o,timeItem:a})}}function ox({matchUpPotentialParticipantIds:e,individualParticipantProfiles:t,matchUpDailyLimits:r={},matchUp:i}){let{enteredIndividualParticipantIds:n}=Ih(i),{matchUpId:a,matchUpType:o}=i,s=(i.roundPosition&&e[a]||[]).flat(),c=vi(n.concat(...s));return c.forEach(e=>{Hk({individualParticipantProfiles:t,participantId:e})}),{participantIdsAtLimit:c.filter(e=>{let i=t[e];if(i)return[o,OI].find(e=>{let t=i.counters?.[e]||0,n=r[e]||0;return t&&n&&t>=n})}),relevantParticipantIds:c}}function sx({scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:t=!1,errorOnAnachronism:r=!1,checkChronology:i=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:c,matchUpIds:u,schedule:l}){if(!s)return{error:Ji};if(!(c||u&&Array.isArray(u)))return{error:la};if(!(c||l&&"object"==typeof l))return{error:jo};let d,p=[],m=0;if(i&&!n){let e=Wy({tournamentRecords:o,tournamentRecord:s});n=e.matchUpDependencies,d=e.matchUps}d||(d=Oy({tournamentRecord:s})?.matchUps??[]);let f=d.reduce((r,i)=>{let{matchUpId:n,drawId:a,matchUpStatus:o}=i;return(t||"BYE"!==o)&&(e||!If.includes(o))&&(r[a]?r[a].push(n):r[a]=[n]),r},{}),h=c?.map(e=>e.matchUpId);for(let g of Object.keys(f)){let{drawDefinition:e}=FT({tournamentRecord:s,drawId:g});if(!e)continue;let t=f[g].filter(e=>u?.includes(e)??h?.includes(e)),I=Ly({inContext:!1,drawDefinition:e}).matchUps;for(let u of t){let t=gk({schedule:c?.find(e=>e.matchUpId===u)?.schedule||l,matchUpDependencies:n,errorOnAnachronism:r,removePriorValues:a,inContextMatchUps:d,tournamentRecords:o,tournamentRecord:s,checkChronology:i,drawDefinition:e,drawMatchUps:I,matchUpId:u});if(t?.warnings?.length&&p.push(...t.warnings),t?.success&&(m+=1),t.error)return t}}return p.length?{...Gi,scheduled:m,warnings:p}:{...Gi,scheduled:m}}function cx(e){let{scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:r=!1,errorOnAnachronism:i,matchUpContextIds:n,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:c,schedule:u}=e;if(e.matchUpIds&&!n)return sx(e);let l=Dp(e,[{[Rd]:!0},{[bp]:{matchUpContextIds:!1,matchUpDetails:!1},[yp]:Zo,[vp]:hp}]);if(l.error)return l;if((!c||n)&&!u)return{error:Da,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:m}=Wy({tournamentRecords:o});for(let f of Object.values(o)){let{tournamentId:e}=f,l=n?.filter(t=>t.tournamentId===e).map(zm),h=c?.filter(t=>t?.tournamentId===e);if(l?.length||h?.length){let e=sx({matchUpDetails:h,scheduleCompletedMatchUps:t,scheduleByeMatchUps:r,matchUpDependencies:m,errorOnAnachronism:i,removePriorValues:a,tournamentRecords:o,tournamentRecord:f,checkChronology:s,matchUpIds:l,schedule:u});if(e.warnings?.length&&d.push(...e.warnings),e.scheduled&&(p+=e.scheduled),e.error)return e}}return d.length?{...Gi,scheduled:p,warnings:d}:{...Gi,scheduled:p}}function ux({averageMinutes:e,startTime:t,endTime:r,court:i,date:n}){if(!Array.isArray(i.dateAvailability))return{error:Da,stack:"getEarliestCourtTime"};let a=wC({scheduleDate:n,courts:[i],startTime:!0}),o=wC({scheduleDate:n,courts:[i],endTime:!0});t=t||a,r=r||o;let s=rR({court:i,date:n}),{timeSlots:c}=yC({courtDate:s}),u=uu(t),l=uu(r);return{earliestCourtTime:c?.reduce((t,r)=>{let i=uu(r.startTime),n=uu(r.endTime);if(i>l||n<u)return t;let a=u>i?u:i;if(lu(a,n)>=e){let e=ru(a.toISOString());e&&(!t||e<t)&&(t=e)}return t},void 0),courtStartTime:a,courtEndTime:o}}function lx(e){let{scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:r=If,scheduledDates:i,venueIds:n}=e,a=yh(e),o=ti(a)?Object.values(a).map(({tournamentId:e})=>e).filter(Boolean):[];if(!o?.length)return{error:Qi};let s=0;for(let c of o){let e=dx({ignoreMatchUpStatuses:r,scheduleAttributes:t,tournamentRecord:a[c],scheduledDates:i,venueIds:n});if(e.error)return e;s+=e.clearedScheduleCount??0}return{...Gi,clearedScheduleCount:s}}function dx({scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:t=If,tournamentRecord:r,scheduledDates:i,venueIds:n=[]}){if("object"!=typeof r)return{error:Ji};if(!Array.isArray(t)||!Array.isArray(n))return{error:Zo};n.length&&e.push("venueId");let a=Oy({matchUpFilters:{scheduledDates:i},tournamentRecord:r}).matchUps??[],o={};a.forEach(({matchUpStatus:r,schedule:i,drawId:a,matchUpId:s})=>{(!r||!t.includes(r))&&yR({schedule:i,scheduleAttributes:e})&&(!n?.length||n.includes(i.venueId))&&(o[a]||(o[a]=[]),o[a].push(s))});let s=r.tournamentId,c=0;for(let u in o){let{event:e,drawDefinition:t}=my({tournamentRecord:r,drawId:u}),i=Ly({drawDefinition:t,matchUpFilters:{matchUpIds:o[u]}}).matchUps??[];for(let r of i){let i=!1;r.timeItems=(r.timeItems??[]).filter(e=>{let t=e?.itemType&&![rI,iI,tI,nI,aI,cI].includes(e?.itemType);return t||(i=!0),t}),i&&(ch({context:"clear schedules",eventId:e?.eventId,drawDefinition:t,tournamentId:s,matchUp:r}),c+=1)}}return{...Gi,clearedScheduleCount:c}}function px(e){let{checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:r,clearScheduleDates:i,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:c,pro:u}=e,l=Dp(e,[{[Rd]:!0},{[gp]:e=>!e||Array.isArray(e)&&e.every(qc),[Ld]:!1,[vp]:hp}]);if(l.error)return l;let d=zM({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...Gi};let{modifications:p,issues:m=[],schedulingProfile:f=[]}=d,h=Object.assign({},...Object.values(a).map(e=>gh({tournamentRecord:e}).containedStructures)),g=new Set(n.map(e=>{if(qc(e))return iu(e)}).filter(Boolean)),I=f.map(e=>e.scheduleDate).map(e=>qc(e)&&iu(e)).filter(e=>e&&(!n.length||g.has(e)));if(!I.length)return{error:Ea};if(i&&!c){lx({tournamentRecords:a,scheduledDates:Array.isArray(i)?i:[]})}let y=DT({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:v}=Fy({matchUpFilters:{matchUpTypes:[Wr,Hr]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:S}=Wy({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:v}),{matchUpDailyLimits:b}=DR({tournamentRecords:a}),{personRequests:U}=QM({requestType:Kk,tournamentRecords:a}),w={schedulingProfileModifications:p,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:r,schedulingProfileIssues:m,dateSchedulingProfiles:f.filter(e=>{let t=iu(e?.scheduleDate);return I.includes(t)}).sort((e,t)=>new Date(e.scheduleDate).getTime()-new Date(t.scheduleDate).getTime()),containedStructureIds:h,matchUpDependencies:S,matchUpDailyLimits:b,clearScheduleDates:i,tournamentRecords:a,schedulingProfile:f,personRequests:U,periodLength:o,matchUps:v,dryRun:c,courts:y};return u?function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:r,schedulingProfileIssues:i,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:c,tournamentRecords:u,periodLength:l=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:f,dryRun:h}){let g={},I={},y={},v={},S={},b={},U={},w={},T={};for(let N of n??[]){let e=iu(N?.scheduleDate),i=N?.venues||[],n={},d={},D=(e,t)=>{e.forEach(e=>{let r=d[e].counters;r[t]?r[t]+=1:r[t]=1,r[OI]?r[OI]+=1:r[OI]=1})};g[e]={},I[e]={},b[e]=[],U[e]=[],w[e]=[],T[e]=[];let P={};m?.forEach(t=>{t.schedule?.scheduledDate&&fu(e,iu(t.schedule.scheduledDate))&&VM({matchUpPotentialParticipantIds:n,matchUpNotBeforeTimes:P,matchUp:t})});let E,{allDateScheduledByeMatchUpDetails:M,allDateScheduledMatchUpIds:R,venueScheduledRoundDetails:A,allDateMatchUpIds:C}=ix({matchUpPotentialParticipantIds:n,individualParticipantProfiles:d,scheduleCompletedMatchUps:r,containedStructureIds:a,matchUpNotBeforeTimes:P,matchUpScheduleTimes:S,matchUpDependencies:o,clearScheduleDates:c,tournamentRecords:u,periodLength:l,scheduleDate:e,matchUps:m,courts:f,venues:i}),k=m?.filter(({matchUpId:e})=>R.includes(e)),{bookings:x}=ex({dateScheduledMatchUps:k,tournamentRecords:u,scheduleDate:e,periodLength:l}),{virtualCourts:O}=SC({scheduleDate:e,periodLength:l,bookings:x,courts:f}),F=O?.reduce((t,r)=>{let{earliestCourtTime:i,courtEndTime:n}=ux({date:e,averageMinutes:0,court:r});return(!t.startTime||uu(i)<uu(t.startTime))&&(t.startTime=i),(!t.endTime||uu(n)>uu(t.endTime))&&(t.endTime=n),t},{}),_=F.startTime,L=({courtId:e,booking:t})=>O?.find(t=>t.courtId===e)?.dateAvailability[0].bookings.push(t),B=10,$=0;for(;!E;){for(let{venueId:r}of i){let i,a=A[r],c=a.matchUpsToSchedule.length,u=[],m=[],f=0;for(;!i;){for(let c of a.matchUpsToSchedule){if(m.length===a.courtsCount||u.length===a.courtsCount){i=!0;break}let{matchUpId:f,matchUpType:h}=c,{participantIdsAtLimit:b,relevantParticipantIds:w}=ox({matchUpPotentialParticipantIds:n,individualParticipantProfiles:d,matchUpDailyLimits:s,matchUp:c});if(b.length){U[e].includes(f)||U[e].push(f);continue}let{dependenciesScheduled:N,remainingDependencies:E}=qk({matchUpScheduleTimes:S,matchUpDependencies:o,allDateMatchUpIds:C,matchUp:c});if(!N){I[e][f]||(I[e][f]=[]),I[e][f].push({remainingDependencies:E});continue}let M=[],R=O?.reduce((r,i)=>{if(m.includes(i.courtId))return r;let{earliestCourtTime:s}=ux({averageMinutes:a.greatestAverageMinutes,startTime:_,date:e,court:i});if(r.scheduleTime&&eu(s)>=eu(r.scheduleTime))return r;let{scheduledDependent:u}=Yk({matchUpScheduleTimes:S,matchUpDependencies:o,scheduleTime:s,matchUpId:f,details:a});if(u)return r;let{enoughTime:l}=nx({individualParticipantProfiles:d,matchUpNotBeforeTimes:P,matchUpDependencies:o,scheduleTime:s,details:a,matchUp:c});if(!l)return g[e][f]||(g[e][f]=[]),g[e][f].includes(s)||g[e][f].push(s),r;let I=a.minutesMap?.[f]?.averageMinutes||a.greatestAverageMinutes,{conflicts:y}=Qk({potentials:t,averageMatchUpMinutes:I,requestConflicts:T,personRequests:p,scheduleTime:s,scheduleDate:e,matchUp:c});if(y?.length)return M.push(...y),!1;D(w,h);let v=a.minutesMap?.[f]?.recoveryMinutes;return zk({matchUpPotentialParticipantIds:n,individualParticipantProfiles:d,matchUpNotBeforeTimes:P,averageMatchUpMinutes:I,matchUpDependencies:o,recoveryMinutes:v,scheduleTime:s,matchUp:c}),(!r.scheduleTime||eu(s)<eu(r.scheduleTime))&&(r.averageMatchUpMinutes=I,r.recoveryMinutes=v,r.scheduleTime=s,r.courtName=i.courtName,r.courtId=i.courtId),r},{});if(R.scheduleTime){let{averageMatchUpMinutes:e,recoveryMinutes:t,scheduleTime:i,courtId:n}=R;S[f]=i,v[f]=n,u.push(f),m.push(n);let o=i,s=du(o,e);L({courtId:n,booking:{averageMatchUpMinutes:e,recoveryMinutes:t,periodLength:l,matchUpId:f,startTime:o,courtId:n,endTime:s,venueId:r}}),a.matchUpsToSchedule=a.matchUpsToSchedule.filter(e=>e.matchUpId!==f)}else M?.length&&(y[e]||(y[e]=[]),y[e].push(...M))}(m.length===a.courtsCount||u.length===a.courtsCount||!a.matchUpsToSchedule.length)&&(i=!0),a.matchUpsToSchedule.length&&u<a.courtsCount&&(uu(_)<uu(F.endTime)?_=du(_,l):(i=!0,a.complete=!0)),f+=1,!i&&f>=c&&(i=!0)}a.matchUpsToSchedule?.length||(a.complete=!0)}$+=1,E=i.every(({venueId:e})=>A[e].complete)||$===B}for(let{venueId:t}of i){let r=A[t].matchUpMap;Object.keys(r).forEach(t=>{let i=u[t];i&&Object.keys(r[t]).forEach(n=>{let{drawDefinition:a}=FT({tournamentRecord:i,drawId:n});a&&r[t][n].forEach(({matchUpId:t})=>{let r=S[t],n=v[t];if(r){let o=r.split(":").map(mu).join(":"),s=`${iu(e)}T${o}`;h||(uk({drawDefinition:a,scheduledTime:s,matchUpId:t}),fk({courtDayDate:e,tournamentRecords:u,tournamentRecord:i,drawDefinition:a,matchUpId:t,courtId:n})),b[e].push(t)}})})}),w[e]=A[t].matchUpsToSchedule.map(zm)}!h&&M?.length&&cx({matchUpDetails:M,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of N.venues)for(let r of t.rounds){let t=(r.matchUps??[]).map(({matchUpId:e})=>e)?.filter(t=>b[e].includes(t));r.canScheduledMatchUpIds=t;let i=Math.round((t?.length||0)/r.matchUpsCount*1e4)/100;(i===1/0||isNaN(i))&&(i=void 0),r.possibleToSchedulePct=i,r.matchUpsCount===t?.length&&(r.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:e})=>e),P={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:b,schedulingProfile:d,noTimeMatchUpIds:w,requestConflicts:T,scheduledDates:D};return ax({tournamentRecords:u,autoSchedulingAudit:P}),{...Gi,schedulingProfileModifications:e,schedulingProfileIssues:i,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:S,overLimitMatchUpIds:U,scheduledMatchUpIds:b,noTimeMatchUpIds:w,requestConflicts:T,scheduledDates:D}}(w):function({schedulingProfileModifications:e,checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:r,schedulingProfileIssues:i,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:c,tournamentRecords:u,schedulingProfile:l,personRequests:d,periodLength:p,matchUps:m,courts:f,dryRun:h}){let g={},I={},y={},v={},S={},b={},U={},w={},T={},D={};for(let E of n){let e=iu(E?.scheduleDate),i=E?.venues||[],n={},l={},P=(e,t)=>{e.forEach(e=>{let r=l[e].counters;r[t]?r[t]+=1:r[t]=1,r[OI]?r[OI]+=1:r[OI]=1})};y[e]={},v[e]={},g[e]={},I[e]={},U[e]=[],w[e]=[],T[e]=[],D[e]=[];let N={};m.forEach(t=>{t.schedule?.scheduledDate&&fu(e,iu(t.schedule.scheduledDate))&&VM({matchUpPotentialParticipantIds:n,matchUpNotBeforeTimes:N,matchUp:t})});let M,{allDateScheduledByeMatchUpDetails:R,venueScheduledRoundDetails:A,allDateMatchUpIds:C}=ix({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,scheduleCompletedMatchUps:r,containedStructureIds:a,matchUpNotBeforeTimes:N,matchUpScheduleTimes:b,matchUpDependencies:o,clearScheduleDates:c,tournamentRecords:u,useGarman:!0,periodLength:p,scheduleDate:e,matchUps:m,courts:f,venues:i}),k=10,x=0,O=10;for(;!M;){for(let{venueId:r}of i){let i=0,a=A[r];for(;a.courtsCount&&a.scheduleTimes?.length&&a.matchUpsToSchedule?.length&&i<=a.courtsCount;){let{scheduleTime:c,attempts:u=0}=a.scheduleTimes.shift(),p=a.matchUpsToSchedule.find(r=>{let{matchUpId:i,matchUpType:u}=r,{participantIdsAtLimit:p,relevantParticipantIds:m}=ox({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,matchUpDailyLimits:s,matchUp:r});if(p.length)return w[e].includes(i)||w[e].push(i),!1;let{scheduledDependent:f}=Yk({matchUpScheduleTimes:b,matchUpDependencies:o,scheduleTime:c,matchUpId:i,details:a});if(f)return!1;let{dependenciesScheduled:h,remainingDependencies:g}=qk({matchUpScheduleTimes:b,matchUpDependencies:o,allDateMatchUpIds:C,matchUp:r});if(!h)return v[e][i]||(v[e][i]=[]),v[e][i].push({scheduleTime:c,remainingDependencies:g}),!1;let{enoughTime:I}=nx({individualParticipantProfiles:l,matchUpNotBeforeTimes:N,matchUpDependencies:o,scheduleTime:c,details:a,matchUp:r});if(!I)return y[e][i]||(y[e][i]=[]),y[e][i].push({scheduleTime:c}),!1;let U=a.greatestAverageMinutes,{conflicts:T}=Qk({potentials:t,averageMatchUpMinutes:U,requestConflicts:D,personRequests:d,scheduleTime:c,scheduleDate:e,matchUp:r});if(T?.length)return S[e]||(S[e]=[]),S[e].push(...T),!1;P(m,u);let E=a.minutesMap?.[i]?.recoveryMinutes;return zk({matchUpPotentialParticipantIds:n,individualParticipantProfiles:l,matchUpNotBeforeTimes:N,averageMatchUpMinutes:U,matchUpDependencies:o,recoveryMinutes:E,scheduleTime:c,matchUp:r}),b[i]=c,!0});a.matchUpsToSchedule=a.matchUpsToSchedule.filter(({matchUpId:e})=>e!==p?.matchUpId),p?i+=1:(I[e][r]||(I[e][r]=[]),I[e][r].push({scheduleTime:c,attempts:u+1}))}a.matchUpsToSchedule?.length&&(I[e][r]=I[e][r]?.filter(e=>{let t=e.attempts<k;return t&&a.scheduleTimes.push(e),!t})),(!a.scheduleTimes?.length||!a.matchUpsToSchedule?.length)&&(a.complete=!0)}x+=1,M=i.every(({venueId:e})=>A[e].complete)||x===O}for(let{venueId:t}of i){let r=A[t].matchUpMap;Object.keys(r).forEach(i=>{let n=u[i];n&&Object.keys(r[i]).forEach(a=>{let{drawDefinition:o}=FT({tournamentRecord:n,drawId:a});o&&r[i][a].forEach(({matchUpId:r})=>{let i=b[r];if(i){let a=i.split(":").map(mu).join(":"),s=`${iu(e)}T${a}`;h?U[e].push(r):(uk({drawDefinition:o,scheduledTime:s,matchUpId:r}).success&&U[e].push(r),t&&mk({tournamentRecord:n,drawDefinition:o,matchUpId:r,venueId:t}))}})})}),T[e]=A[t].matchUpsToSchedule.map(zm),g[e][t]=A[t].scheduleTimes.sort((e,t)=>eu(e.scheduleTime)-eu(t.scheduleTime))}!h&&R?.length&&cx({matchUpDetails:R,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:u,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let t of E.venues)for(let r of t.rounds){let t=(r.matchUps?.map(({matchUpId:e})=>e)||[]).filter(t=>U[e].includes(t));r.canScheduledMatchUpIds=t;let i=Math.round(t.length/r.matchUpsCount*1e4)/100;(i===1/0||isNaN(i))&&(i=0),r.possibleToSchedulePct=i,r.matchUpsCount===t.length&&(r.possibleToSchedule=!0)}}let P=n.map(({scheduleDate:e})=>e),N={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:U,schedulingProfile:l,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P};return ax({tournamentRecords:u,autoSchedulingAudit:N}),{...Gi,schedulingProfileModifications:e,schedulingProfileIssues:i,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:I,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:b,overLimitMatchUpIds:w,scheduledMatchUpIds:U,noTimeMatchUpIds:T,requestConflicts:D,scheduledDates:P}}(w)}function mx(e){let{tournamentRecord:t,tournamentRecords:r,activeTournamentId:i,...n}=e||{};return n.tournamentId||(n.tournamentId=Ru()),(!n.startDate||Jc(n.startDate)||Lc.test(n.startDate))&&(!n.endDate||Jc(n.endDate)||Lc.test(n.endDate))?(n.extensions&&(n.extensions=n.extensions.filter(Zp)),{...n}):{error:Ca}}function fx({addParticipants:e=!0,participantAttribute:t,tournamentRecord:r,personAttribute:i,teamNames:n,accessor:a,uuids:o}){if(!r)return{error:Ji};let s={},c=(r.participants??[]).filter(({participantType:e,participantRole:t})=>e===wh&&t===xS),u=0;for(let f of c){let e=a&&By({element:f,accessor:a})?.value||i&&f.person?.[i]||t&&f[t];if(e){if(!Object.keys(s).includes(e)){s[e]={participantName:n?.[u]??e,participantId:o?.pop()??Ru(),individualParticipantIds:[],participantRole:xS,participantType:Ph};let r={value:i??t,name:bm};em({element:s[e],extension:r}),u+=1}s[e].individualParticipantIds.push(f.participantId)}}let l=Object.keys(s),d=(r.participants??[]).map(e=>{if(e.participantType!==Ph||e.participantRole!==xS)return;let{extension:t}=lm({name:bm,element:e}),r=t?.value;return l.includes(r)?e.participantId:void 0}).filter(Boolean),p=0,m=[];return Object.keys(s).forEach(t=>{let i=s[t],{participantId:n}=i;d.includes(n)||(r.participants||(r.participants=[]),e&&r.participants.push(i),m.push(i),p++)}),e&&p?(Bs({payload:{tournamentId:r.tournamentId,participants:m},topic:Rf}),{...Gi,participantsAdded:p}):m.length?{...Gi,newParticipants:m}:{error:Ba}}var hx=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],gx=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Ix({count:e=1,participantsCount:t=32}={}){let r=bi(gx),i=r.slice(0,e);return{cities:Ri(0,t).map(t=>t<Math.min(e,r.length)?i[t]:Mi(i))}}function yx({count:e=1,participantsCount:t=32}={}){let r=bi(hx),i=r.slice(0,e).map(e=>Object.keys(e)).flat();return{states:Ri(0,t).map(t=>t<Math.min(e,r.length)?i[t]:Mi(i))}}function vx({count:e=1,participantsCount:t=32}={}){let r=Ri(0,e).map(()=>Ri(0,5).map(()=>hi(0,9)).join(""));return{postalCodes:Ri(0,t).map(t=>t<e?r[t]:Mi(r))}}function Sx({idPrefix:e,participantType:t,index:r,uuids:i}){let n=ei(t)?t[0]:"X";return e?`${e}-${n}-${r}`:i?.pop()||Ru()}function bx(e){let{cities:t,states:r,postalCodes:i,nationalityCode:n,participantIndex:a}=e;return{postalCode:i?.[a],state:r?.[a],city:t?.[a],countryCode:n}}var Ux={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carlin","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Ellul","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood","Zecic"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","Jacques","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Miro","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function wx(e){let{count:t=100,sex:r}=e||{};if(!t||r&&!gc(r))return{personData:[],error:Zo};let i=Math.ceil(1.3*t),{lastNames:n,firstFemale:a,firstMale:o}=Ux,s=Ah.map(({iso:e})=>e).filter(Boolean),c=Math.ceil(i/n.length),u=Math.ceil(i/a.length),l=Math.ceil(i/o.length),d=Ri(0,c).flatMap(()=>{let e=Nu(n,!1,!0);return Ri(0,n.length).map(()=>Ei(e))}),p=Ri(0,u).flatMap(()=>{let e=Nu(a,!1,!0);return Ri(0,a.length).map(()=>Ei(e))}),m=Ri(0,l).flatMap(()=>{let e=Nu(o,!1,!0);return Ri(0,o.length).map(()=>Ei(e))}),f={};for(let h=0;h<i;h++){let e=d.pop(),t=r||Mi([uc,oc]),i=t===uc?m.pop():p.pop(),n=Mi(s);f[`${i}${e}`]={nationalityCode:n,sex:t,firstName:i,lastName:e}}return{personData:Object.values(f).slice(0,t)}}function Tx(e){let t=e?.count||1,{personExtensions:r,consideredDate:i,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:c}=e||{};if(Number.isNaN(Number(t)))return{error:Zo};let u=a?.[uc]||pc(c)&&t||0,l=a?.[oc]||dc(c)&&t||0;t=Math.max(t,u+l);let d=t-(u+l),p=[...u&&wx({count:u,sex:uc}).personData||[],...l&&wx({count:l,sex:oc}).personData||[],...d&&wx({count:d}).personData||[]],m=p.filter(e=>!c||u&&l||e.sex===c),f=[];if(Array.isArray(o)){let e=o.filter(e=>!("string"!=typeof e.firstName||"string"!=typeof e.lastName||e.sex&&![uc,oc].includes(e.sex)||e.nationalityCode&&("string"!=typeof e.nationalityCode||e.nationalityCode.length>3||!Ah.some(({iso:t,ioc:r})=>[t,r].includes(e.nationalityCode))))&&(e.nationalityCode&&f.push(e.nationalityCode),!0));if(!e.length)return{error:Zo};m=e}let h=o?m:bi(m);if(h.length<t){let{maleFirstNames:e,maleLastNames:r,femaleFirstNames:i,femaleLastNames:n,nationalityCodes:a}=p.reduce((e,t)=>{let{firstName:r,lastName:i,nationalityCode:n}=t;return t.sex===uc?(e.maleFirstNames.includes(r)||e.maleFirstNames.push(r),e.maleLastNames.includes(i)||e.maleLastNames.push(i)):(e.femaleFirstNames.includes(r)||e.femaleFirstNames.push(r),e.femaleLastNames.includes(i)||e.femaleLastNames.push(i)),e.nationalityCodes.includes(n)||e.nationalityCodes.push(n),e},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Ri(0,t-h.length).forEach(()=>{let t=c||Mi([uc,oc]),o=Mi(a),s={firstName:Mi(t===uc?e:i),lastName:Mi(t===uc?r:n),sex:t,nationalityCode:o};h.push(s)})}let{ageMinDate:g,ageMaxDate:I}=Iu({consideredDate:i,category:s}),y=Jr(g?.slice(0,4)||0)||Jr(I?.slice(0,4)||0)-3,v=Jr(I?.slice(0,4)||0)||Jr(g?.slice(0,4)||0)+3,S=(g||I)&&[y,v],b=h.slice(0,t).map((e,t)=>{let[i,a]=S||[],o=S&&Ei(Ri(i,a)),s=Ei(Ri(0,365)),c=o&&function(e,t,r){let i=new Date(e,0);return zc(new Date(i.setDate(t)),r)}(o,s);return Object.assign(nc({extensions:r||[{name:"regionCode",value:t+1}],birthDate:c,isMock:n}),e)});return{persons:b.length&&b||h[0],nationalityCodes:f}}var Dx=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function Px({nameRoot:e="TEAM",count:t=1}={}){let r=bi(Dx).slice(0,t);return r.length<t&&Ri(0,t-r.length).forEach(t=>r.push(`${e} ${t+1}`)),{names:r}}function Nx(e){let{scaledParticipantsCount:t,rankingRange:r}=e,{ratingsParameters:i=Nv,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:c,nationalityCodesCount:u,nationalityCodeType:l,nationalityCodes:d,participantsCount:p=32,participantType:m,teamSize:f=8,personIds:h,idPrefix:g,uuids:I,personExtensions:y,addressProps:v,gendersCount:S,matchUpType:b,personData:U,sex:w,inContext:T,withISO2:D,withIOC:P,scaleAllParticipants:N}=e,E=m===Dh||b===qr,M=m===Ph||b===Ph;r&&(!Array.isArray(r)||!r.every(e=>pi(e))||2!==r.length)&&(r=void 0),t=N?p:t;r=r||[1,t&&t>1e3?t:1e3],r[1]+=1;let R=p*((E?2:M&&(f??8))||1),A=Tx({count:R,personExtensions:y,consideredDate:o,gendersCount:S,personData:U,category:c,sex:w});if(A.error)return A;let{nationalityCodes:C,persons:k}=A,x={},O={},F={},_={},L=e=>{Object.assign(x,e.doublesRankings),Object.assign(O,e.singlesRankings),Object.assign(_,e.doublesRatings),Object.assign(F,e.singlesRatings)};if(ti(c)){let e=Mx({scaledParticipantsCount:t,ratingsParameters:i,participantType:m,ratingsValues:a,rankingRange:r,category:c});L(e)}Array.isArray(s)&&s.forEach(e=>{let n=Mx({scaledParticipantsCount:t,ratingsParameters:i,participantType:m,ratingsValues:a,rankingRange:r,category:e});L(n)});let B=Ah.filter(e=>"IOC"===l&&e.ioc||e.iso);let{postalCodesProfile:$,postalCodesCount:V,statesProfile:j,citiesProfile:G,citiesCount:W,statesCount:q}=v||{},H=e=>Object.keys(e).flatMap(e=>Ri(0,j[e]).map(()=>e)),z={cities:G&&H(G)||v?.cities||Ix({count:W||R,participantsCount:R}).cities,states:j&&H(j)||v?.states||yx({count:q||R,participantsCount:R}).states,postalCodes:$&&H($)||v?.postalCodes||vx({count:V||R,participantsCount:R}).postalCodes},Y=function(e){let t=Math.ceil(R/e);return n&&t>n?Math.ceil(R/n):e}(u),K=Y?bi(B).slice(0,u):d&&B.filter(e=>d.includes(e.iso))||B,X=bi(Ri(0,Math.ceil(R/(Y||1))).map(()=>K).flat(1/0)),Q=Px({count:p}).names;return{participants:Ri(0,p).flatMap(e=>{let t=(E?2:M&&(f??8))||1,r=Ri(0,t).map(r=>function(e){let t=k[e],{nationalityCode:r,participantExtensions:i,participantTimeItems:n,extensions:a,firstName:o,birthDate:u,lastName:d,personId:p,sex:m}=t||{},f=o||"GivenName",y=d||"FamilyName",v=`${f} ${y}`,S=X[e],b=C?.length&&r||S&&("IOC"===l?S.ioc||S.iso:S.iso||S.ioc)||r;X?.length&&!b&&!r&&console.log("%c Invalid Nationality Code",{participantIndex:e,country:S});let U=bx({...z,participantIndex:e,nationalityCode:b}),w=nc({participantId:Sx({participantType:wh,index:e,idPrefix:g,uuids:I}),extensions:i,timeItems:n,participantRole:xS,participantType:wh,participantName:v,person:{personId:p||h?.length&&h[e]||Ru(),birthDate:qc(u)?u:void 0,addresses:[U],standardFamilyName:y,standardGivenName:f,nationalityCode:b,extensions:a,sex:m}});if(P&&b){let e=Ah.find(({iso:e})=>e===b);e?.ioc&&(w.person.iocNationalityCode=e.ioc),e?.label&&(w.person.countryName=e.label)}if(D&&b){let e=Ah.find(({iso:e})=>e===b);e?.iso2&&(w.person.iso2NationalityCode=e.iso2),e?.label&&(w.person.countryName=e.label)}let T=t=>{let r=t.categoryName||t.ratingType||t.ageCategoryCode,i=O[r]?.[e],n=x[r]?.[e];Ex({scaleValue:i,eventType:Ul,scaleType:Ep,participant:w,category:t}),Ex({scaleValue:n,eventType:Tl,scaleType:Ep,participant:w,category:t});let a=F[r]?.[e],o=_[r]?.[e];Ex({scaleValue:a,eventType:Ul,scaleType:Mp,participant:w,category:t}),Ex({scaleValue:o,eventType:Tl,scaleType:Mp,participant:w,category:t})};return Array.isArray(s)?s.forEach(e=>T(e)):c&&T(c),w}(e*t+r)),i=r.map(e=>e.participantId),n=r.map(e=>e.person.standardFamilyName).join("/"),a=E?Dh:Ph,o={participantId:Sx({participantType:a,index:e,idPrefix:g,uuids:I}),participantName:E?n:Q[e],participantRole:xS,individualParticipantIds:i,participantType:a};return T&&(o.individualParticipants=r),E||M?[o,...r]:r}),...Gi}}function Ex({scaleValue:e,participant:t,eventType:r,scaleType:i,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o={itemValue:e,itemType:[Rp,i,r,a].join(".")};a&&e&&(t.timeItems||(t.timeItems=[]),t.timeItems.push(o))}function Mx(e){let{category:t,scaledParticipantsCount:r,ratingsParameters:i,participantType:n,ratingsValues:a=[]}=e,o=t.rankingRange||e.rankingRange||[1,1e3],s={},c={},u={},l={},{categoryName:d,ageCategoryCode:p,ratingType:m}=t,f=t.categoryName||t.ratingType||t.ageCategoryCode;if((d||p)&&!m){let[e,t]=o||[];if(c[f]=bi(Ri(e,t)).slice(0,r||hi(20,30)),[Dh,Ph].includes(n)){let[e,t]=o||[];s[f]=bi(Ri(e,t)).slice(0,r||hi(20,30))}}if(m&&i[m]){let{ratingMax:e,ratingMin:o,ratingAttributes:s}=t,c={...i[m],...s||{}},{attributes:d={},decimalsCount:p,accessors:h,range:g,step:I}=c,y=e=>{let t={},r=Object.keys(e||{});for(let i of r){let r=e[i];if("object"==typeof r&&r.generator){let{range:e}=r,[n,a]=e.slice().sort();t[i]=hi(n,a)}else t[i]=r}return t},v=g[0]>g[1]?2:.7,[S,b]=g.slice().sort(),U=Ri(0,2e3).map(()=>Ii(S,b,v,I,p)).filter(t=>(!e||t<=e)&&(!o||t>=o)).slice(0,r||hi(20,30)).map(e=>h?Object.assign({},...h.map(t=>({[t]:e})),y(d)):e);u[f]=[...a,...U],[Dh,Ph].includes(n)&&(l[f]=[...a,...U])}return{singlesRankings:c,doublesRankings:s,singlesRatings:u,doublesRatings:l}}function Rx(e){let{alternatesCount:t=0,tieFormatName:r,drawSize:i}=e,n=0,a=0,o=0,s=0,c={},u={[uc]:0,[oc]:0,[cc]:0,[sc]:0,ANY:0};(ti(e.tieFormat)?e.tieFormat:Sl({namedFormat:r}))?.collectionDefinitions?.filter(Boolean).forEach(e=>{let{category:t,collectionId:r,matchUpType:i,matchUpCount:l,gender:d}=e;if(gc(d)){let e=hc(d),t=l*(i===Hr?2:1);e&&u[e]<t&&(u[e]=t)}else mc(d)&&(u[uc]<l&&(u[uc]=l),u[oc]<l&&(u[oc]=l));if(t){let e=JSON.stringify(t);c[e]=t}if(r||(e.collectionId=Ru()),MI(Hr)(i)){let e=l;s+=l,n=Math.max(n,e)}if(MI(Wr)(i)){let e=l;o+=l,a=Math.max(a,e)}});let l=Object.keys(c).length?Math.max(o,2*s):Math.max(a,2*n);return{maxDoublesDraw:n*(i+t),maxSinglesDraw:a*(i+t),teamSize:l,genders:u}}function Ax({participantsProfile:e,tournamentRecord:t,eventProfiles:r,drawProfiles:i,startDate:n,uuids:a}){if(0===e?.participantsCount)return{addedCount:0,...Gi};let{participantsCount:o,participantType:s,largestTeamDraw:c,largestTeamSize:u,gendersCount:l}=function({participantsProfile:e,eventProfiles:t,drawProfiles:r}){let{participantsCount:i,participantType:n=wh}=e||{},a=i||0,o={[oc]:0,[cc]:0,[sc]:0,[uc]:0,ANY:0},s=0,c=0,u=0,l=0,d=0,p=({alternatesCount:e=0,uniqueParticipants:t,tieFormatName:r,drawSize:i=0,eventType:n,tieFormat:a,category:p,gender:m,stage:f})=>{let h=n===wl,g=!!(t||f===Ml||p||m);if(n===Dl){l=Math.max(l,i+e),a="object"==typeof a?a:Sl({namedFormat:r});let{teamSize:t,maxDoublesDraw:n,maxSinglesDraw:d,genders:p}=Rx({alternatesCount:e,tieFormatName:r,tieFormat:a,drawSize:i});u=Math.max(u,t),c=Math.max(c,d),g||(s=Math.max(s,n)),Object.keys(p).forEach(e=>o[e]+=p[e])}else if(h)if(g){let t=2*(i+e);d+=t,m&&(o[m]+=t)}else i+e&&i+e>s&&(s=i+e);else if(g){let t=i+e;m&&(o[m]+=t),d+=t}else i&&i>c&&(c=i+e)};if(t?.forEach(e=>{let{tieFormatName:t,tieFormat:r,drawProfiles:i,eventType:n,category:a,gender:o}=e;if(i)for(let s of i){let{tieFormatName:e,tieFormat:i}=s;p({...s,tieFormatName:e||t,tieFormat:i||r,eventType:n,category:a,gender:o})}}),Array.isArray(r))for(let f of r)p(f);let m=Math.max(l*u,2*s,c);return s&&(n=Dh),(i||a)<m&&(i=m),i&&s&&[Dh,Dl].includes(n)&&(c&&Math.floor(c/2)>s?i=Math.floor(c/2):(!c||2*s>=c)&&(i=Math.ceil(i/2))),void 0===i&&(i=t?.length||r?.length?0:32),i<a&&(i=a),{uniqueParticipantsCount:d,participantsCount:i,largestTeamDraw:l,largestTeamSize:u,participantType:n,gendersCount:o}}({participantsProfile:e,eventProfiles:r,drawProfiles:i}),d=e?.teamKey,p=Nx({consideredDate:n,...e,participantsCount:o,participantType:s,gendersCount:l,uuids:a}).participants,m=0,f=pA({tournamentRecord:t,participants:p});if(f.error)return f;if(m+=f.addedCount,d){let e=fx({tournamentRecord:t,...d});if(e.error)return e}let h=p.filter(({participantType:e})=>e===wh).map(Hm),g=e?.idPrefix?`${Ph}-${e.idPrefix}`:void 0;return f=pA({participants:Ri(0,c).map(e=>{let t=h.slice(e*u,(e+1)*u),r=Sx({index:e,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${e+1}`,participantRole:xS,individualParticipantIds:t,participantType:Ph,participantId:r}}),tournamentRecord:t}),f.error?f:(m+=f.addedCount,{addedCount:m,...Gi})}function Cx({drawProfiles:e,category:t,gender:r}){let i={},n=e?.reduce((e,n)=>{let{qualifyingPositions:a=0,participantsCount:o=0,uniqueParticipants:s,stage:c=El,drawSize:u=0}=n||{};Object.keys(e).includes(c)||(e[c]=0);let l=(o||u)-a;return s||r||t||c===Ml?(Object.keys(i).includes(c)||(i[c]=0),i[c]+=l):e[c]=Math.max(e[c],l),e},{}),a=Object.keys(i);return a.forEach(e=>n[e]+=i[e]),{stageParticipantsCount:n,uniqueParticipantsCount:i,uniqueParticipantStages:a}}function kx({allUniqueParticipantIds:e,stageParticipantsCount:t,eventParticipantType:r,targetParticipants:i}){let n=t[El]||0,a=t[Ml]||0;return{stageParticipants:{QUALIFYING:i?.filter(({participantType:e})=>e===r).filter(({participantId:t})=>!e.includes(t)).slice(0,a),MAIN:i?.filter(({participantType:e})=>e===r).filter(({participantId:t})=>!e.includes(t)).slice(a,a+n)}}}var xx={[df]:2,[nf]:1,[rf]:1,[cf]:1,[tf]:4};function Ox(e){let{defaultWithScorePercent:t=2,winningSide:r}=e,{matchUpStatusProfile:i=xx,matchUpFormat:n=Vu,pointsPerMinute:a=1,sideWeight:o=4}=e;if(!_c({matchUpFormat:n}))return{error:aa};if("object"!=typeof i)return{error:Zo};if(t>100&&(t=100),Number.isNaN(Number(t))||Number.isNaN(Number(a))||Number.isNaN(Number(o)))return{error:Zo};let s=Object.keys(i).filter(e=>Object.keys(Sf).includes(e)&&e!==Zm);if(Object.keys(s).reduce((e,t)=>e+i[t],0)>100)return{error:Zo,matchUpStatusProfile:i};let c=s.reduce((e,t)=>(e.pointer=e.pointer+i[t],e.valueMap.push([e.pointer,t]),e),{pointer:0,valueMap:[]}),u=hi(1,100),l=(c.valueMap.find(e=>u<=e[0])??[100,Zm])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if(rv(l)){r=r||hi(1,2);let e={score:d,matchUpStatus:l,winningSide:r};if(!(l===tf&&hi(1,100)>100-t))return{outcome:e}}else if([nf,rf].includes(l))return{outcome:{score:d,matchUpStatus:l}};let p,m=Mc(n),{bestOf:f=1,exactly:h,setFormat:g,finalSetFormat:I}=m??{},y=[],v=hi(0,1),S=r?[r-1]:[...Ri(0,o).map(()=>v),1-v],b=[cf,tf,of,uf].includes(l)&&(Ei(Ri(1,h||f))||1),U=Ri(1,(h??f)+1);for(let P of U){let e=P===(h??f),{set:t,incomplete:r,winningSideNumber:i}=Fx({setFormat:e&&I||g,incomplete:b===P,pointsPerMinute:a,matchUpStatus:l,weightedRange:S,setNumber:P});if(y.push(t),r){p=i;break}if($R({matchUp:{score:{sets:y},matchUpFormat:n}}).calculatedWinningSide)break}let w=$R({matchUp:{score:{sets:y},matchUpFormat:n,winningSide:r}}),T=p?r||p:w.calculatedWinningSide,{score:D}=Ak({winningSide:T,score:{sets:y},matchUpStatus:l});return{outcome:{winningSide:T,matchUpStatus:l,score:D}}}function Fx({weightedRange:e=[0,1],pointsPerMinute:t,matchUpStatus:r,incomplete:i,setFormat:n,setNumber:a}){let o,s={setNumber:a},{setTo:c,tiebreakFormat:u,tiebreakAt:l,tiebreakSet:d,timed:p,minutes:m}=n,f=hi(0,e.length-1),h=e[f];if(p){let n=m*t,a=Math.round(.2*n),c=n+Ei([1,-1])*a,u=function(e=1,t=3,r=!0){let i=0;for(let n=0;n<t;n++)i+=Math.random()*(e/t);return r&&e>1?Math.round(i):i}(c,2),l=[u,c-u];h&&l.reverse(),o=e[f]+1;let d=(l[0]>l[1]?1:l[1]>l[0]&&2)||0;if(i){let[e,t]=l;return Object.assign(s,{side1Score:e,side2Score:t}),If.includes(r)?{set:s,incomplete:i,winningSideNumber:o}:{set:s,incomplete:i}}d||(l[hi(0,1)]+=1),d=l[0]>l[1]?1:2,d!==o&&l.reverse();let[p,g]=l;return Object.assign(s,{side1Score:p,side2Score:g,winningSide:o}),{set:s}}if(i)return s.side1Score=hi(0,l),s.side2Score=hi(0,l),If.includes(r)&&(o=e[f]+1),{set:s,incomplete:i,winningSideNumber:o};{let t=Ri(1,c+1).flatMap(e=>Ri(0,c+2-e).map(()=>e)),r=t[hi(0,t.length-1)],i=c&&sE({isSide1:!0,tiebreakAt:l,lowValue:r,setTo:c}),a=!i,o=1===e.length&&e[f]+1;if(!a){o?(i[0]>i[1]?1:2)!==o&&i.reverse():h&&i.reverse();let[e,t]=i;Object.assign(s,{side1Score:e,side2Score:t})}let p,m=dE({matchUpScoringFormat:{setFormat:n},setObject:s});if(m.hasTiebreakCondition||a){let{NoAD:e,tiebreakTo:t}=u||d||{},r=Ri(1,t+1).flatMap(e=>Ri(0,t+2-e).map(()=>e)),i=r[hi(0,r.length-1)],n=cE({isSide1:!0,tiebreakNoAd:e,tiebreakTo:t,lowValue:i});if(n)if(a){let e=n[0]>n[1]?1:2;o?e!==o&&n.reverse():h&&n.reverse(),[s.side1TiebreakScore,s.side2TiebreakScore]=n,p=(n[0]>n[1]?1:n[1]>n[0]&&2)||void 0}else 2===m.leadingSide?[s.side1TiebreakScore,s.side2TiebreakScore]=n:[s.side2TiebreakScore,s.side1TiebreakScore]=n}s.winningSide=m.winningSide||m.leadingSide||o||p}return{set:s}}function _x({firstRoundDualMatchUps:e,event:t,tournamentRecord:r,drawDefinition:i}){let n=t?.category?.ageCategoryCode||t?.category?.categoryName;if(n){let e=hC({singlesOnly:!0,tournamentRecord:r,drawDefinition:i,scaleAccessor:{scaleName:n,sortOrder:"ASC",scaleType:Ep},event:t});if(e.error)return e;let{lineUps:a,participantsToAdd:o}=e;return pA({tournamentRecord:r,participants:o}),void em({element:i,extension:{name:Um,value:a}})}let a=e[0]?.structureId,{positionAssignments:o}=Pf({drawDefinition:i,structureId:a});if(!o?.length)return;let{participants:s}=mS({participantFilters:{participantTypes:[Yr]},tournamentRecord:r});function c(e){return s?.find(t=>{let{participantId:r}=t;return o.find(e=>e.participantId===r)?.drawPosition===e})}e.forEach(e=>{let n=e.tieMatchUps.filter(MI(Wr)),a=e.tieMatchUps.filter(MI(Hr));n.forEach((e,n)=>{!function(e,n,a){e.sides.forEach(e=>{let{drawPosition:o}=e,s=c(o);if(s){let e=s.individualParticipantIds?.[n];return void(e&&$C({teamParticipantId:s.participantId,participantId:e,tournamentRecord:r,drawDefinition:i,tieMatchUpId:a,event:t}))}})}(e,n,e.matchUpId)}),a.forEach((e,n)=>{!function(e,n,a){e.sides.forEach(e=>{let{drawPosition:o}=e,s=c(o);s&&s.individualParticipantIds?.slice(2*n,2*n+2)?.forEach(e=>{$C({teamParticipantId:s.participantId,participantId:e,tournamentRecord:r,drawDefinition:i,tieMatchUpId:a,event:t})})})}(e,n,e.matchUpId)})})}function Lx({structure:e,matchUpsMap:t,drawDefinition:r,tournamentRecord:i,event:n,matchUpStatusProfile:a,matchUpFormat:o,matchUpStatus:s,scoreString:c,randomWinningSide:u,completionGoal:l,completedCount:d}){let p=Uy({contextFilters:{matchUpTypes:[Hr,Wr]},afterRecoveryTimes:!1,tournamentRecord:i,inContext:!0,drawDefinition:r,matchUpsMap:t,structure:e,event:n}).matchUps.filter(({winningSide:e})=>!e).sort(_y).map(zm);for(let m of p){if(!Number.isNaN(Number(l))&&d.value>=l)break;let{matchUps:p}=Uy({matchUpFilters:{matchUpTypes:[Hr,Wr]},afterRecoveryTimes:!1,tournamentRecord:i,inContext:!0,drawDefinition:r,matchUpsMap:t,structure:e,event:n}),f=p.find(e=>e.matchUpId===m),h=[nf,rf].includes(f.matchUpStatus);if(f?.readyToScore&&!h){let e=Vx({matchUpStatusProfile:a,tournamentRecord:i,drawDefinition:r,targetMatchUp:f,matchUpFormat:o,matchUpStatus:s,scoreString:c,winningSide:!u&&1,event:n});if(e?.error)return e;d.value+=1}}}function Bx(e){let{matchUpStatusProfile:t,completeAllMatchUps:r,randomWinningSide:i,tournamentRecord:n,completionGoal:a,drawDefinition:o,event:s}=e;if(!o)return{error:rn};let c=e.matchUpFormat||o.matchUpFormat||s?.matchUpFormat,u=o.structures.slice().sort(bf),l={value:0},{matchUps:d,matchUpsMap:p}=Cy({matchUpFilters:{matchUpTypes:[Yr],roundNumbers:[1]},contextFilters:{stages:[El,Ml]},inContext:!0,drawDefinition:o});if(d?.length){let e=_x({firstRoundDualMatchUps:d,event:s,tournamentRecord:n,drawDefinition:o});if(e?.error)return e}let m="string"==typeof r&&r,f=m&&Zm,h=2===u.length&&u[0].finishingPosition===Dd&&2===Ci(u.map(({stage:e})=>e),[El,Cl]).length,g=u.map(({structureId:e})=>e);for(let I of g){if(l.value>=a)break;let r=o.structures.find(e=>e.structureId===I),u=Lx({structure:r,matchUpsMap:p,drawDefinition:o,tournamentRecord:n,event:s,matchUpStatusProfile:t,matchUpFormat:c,matchUpStatus:f,scoreString:m,randomWinningSide:i,completionGoal:a,completedCount:l});if(u?.error)return u;h&&r.finishingPosition===Dd&&e.completeRoundRobinPlayoffs&&yU({structureId:r.structureId,applyPositioning:!0,drawDefinition:o})}return{...Gi,completedCount:l.value}}function $x(e){let{matchUpStatusCodes:t,policyDefinitions:r,tournamentRecord:i,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:c,winningSide:u,event:l}=e;if(!a||"BYE"===a.matchUpStatus)return;let{matchUpId:d}=a||{},{outcome:p}=Wk({matchUpFormat:s,matchUpStatus:o,scoreString:c,winningSide:u});return t&&(p.matchUpStatusCodes=t),kk({tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:l})}function Vx(e){let{matchUpStatusProfile:t={},tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:c,winningSide:u,event:l}=e;if(c||a)return $x(e);let{matchUpId:d}=s||{},{outcome:p}=Ox({matchUpStatusProfile:t,matchUpFormat:o,winningSide:u});return kk({policyDefinitions:i,tournamentRecord:r,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:l})}function jx({matchUpStatusProfile:e,completeAllMatchUps:t,randomWinningSide:r,tournamentRecord:i,drawProfiles:n,isMock:a,event:o}){let s=py({event:o}).flightProfile,{eventName:c,eventType:u,category:l}=o,{startDate:d}=i,p=[],m=l?.categoryName||l?.ageCategoryCode||l?.ratingType,f=o.drawDefinitions?.map(({drawId:e})=>e);if(Array.isArray(s?.flights))for(let[h,g]of s.flights.entries()){let{drawId:s,stage:l,drawName:I,drawEntries:y}=g;p.push(g.drawId);let v=n[h],{seedsCount:S,generate:b=!0}=v||{};if(b){let p=y.filter(Vy(_d)).map(Vy(_d)),g=m||c;if(i&&S&&S<=p.length&&Ri(1,S+1).forEach((e,t)=>{let r={scaleValue:e,scaleName:g,scaleType:Ap,eventType:u,scaleDate:d},n=p[t];kD({tournamentRecord:i,participantId:n,scaleItem:r})}),f?.includes(s))break;let b=QR({...v,matchUpType:u,seedingScaleName:g,tournamentRecord:i,drawEntries:y,drawName:I,drawId:s,isMock:a,event:o,stage:l});if(b.error)return{error:b.error,drawIds:[]};let{drawDefinition:U}=b;if(!U)return{error:an};let w=n[h]?.drawExtensions;if(Array.isArray(w)&&w.filter(Zp).forEach(e=>em({element:U,extension:e})),b=qA({suppressNotifications:!0,tournamentRecord:i,drawDefinition:U,event:o}),b.error)return{error:b.error,drawIds:[]};if(v?.withPlayoffs){let e=U.structures?.[0].structureId,t=tT({idPrefix:v.idPrefix,...v.withPlayoffs,tournamentRecord:i,drawDefinition:U,structureId:e,isMock:a,event:o});if(t?.error)return t}let T=v?.completionGoal;if(!1!==v?.automated&&(t||T)){let n=v?.matchUpFormat,a=Bx({completeAllMatchUps:!T&&t,matchUpStatusProfile:e,randomWinningSide:r,tournamentRecord:i,completionGoal:T,drawDefinition:U,matchUpFormat:n,event:o});if(a.error)return{error:a.error,drawIds:[]};let s=a.completedCount;if(v?.drawType===Sd){let a=U.structures?.find(e=>e.stage===El);if(!a)return{error:Fn};let c=yU({structureId:a.structureId,tournamentRecord:i,drawDefinition:U});if(c.error)return{error:c.error,drawIds:[]};if(c=Bx({completeAllMatchUps:!T&&t,completionGoal:T?T?T-(s??0):void 0:void 0,matchUpStatusProfile:e,randomWinningSide:r,tournamentRecord:i,drawDefinition:U,matchUpFormat:n,event:o}),c.error)return{error:c.error,drawIds:[]}}}}}return{...Gi,drawIds:p}}function Gx(e){let{participantsProfile:t={},uniqueParticipantsCount:r,ratingsParameters:i,tournamentRecord:n,eventProfile:a,eventIndex:o,event:s,uuids:c}=e,{category:u,gender:l,eventType:d}=s,p=MI(bl)(d)&&wh||MI(wl)(d)&&Dh||d,m=r[El]||0,f=r[Ml]||0,h=a.drawProfiles?.length?m+f:a.participantsProfile?.participantsCount??0,g=gc(l)?l:void 0,I=t?.idPrefix?`E-${o}-${t?.idPrefix}`:void 0,{participants:y}=Nx({uuids:a.uuids||c,...t,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n?.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:h,ratingsParameters:i,category:u,idPrefix:I,sex:g}),v=pA({tournamentRecord:n,participants:y});if(v.error)return v;let S=y?.filter(({participantType:e})=>e===p),b=y?.map(Hm);return{uniqueDrawParticipants:S,uniqueParticipantIds:b}}function Wx({autoEntryPositions:e,tournamentRecord:t,drawParticipants:r,drawProfile:i,event:n}){let{drawType:a=id,qualifyingPositions:o=0,stage:s=El,drawSize:c=0,drawName:u,drawId:l}=i,d=c-o,p=r.slice(0,d).map(Hm);if(p.length){let r=CS({participantIds:p,autoEntryPositions:e,entryStage:s,tournamentRecord:t,event:n});if(r.error)return r}let m=eC({drawName:u||a,qualifyingPositions:o,drawEntries:p.map(e=>({entryStatus:ug,entryStage:s,participantId:e})),drawId:l,event:n,stage:s});return m.error?m:{...Gi}}function qx({uniqueDrawParticipants:e,autoEntryPositions:t,stageParticipants:r,tournamentRecord:i,drawProfiles:n,category:a,gender:o,event:s}){let c=0;for(let u of n){let{qualifyingPositions:n=0,uniqueParticipants:l,stage:d=El,drawSize:p=0}=u,m=p-n,f=l||o||a||d===Ml,h=f?e.slice(c,c+m):r[d||El]||[];f&&(c+=m);let g=Wx({autoEntryPositions:t,drawParticipants:h,tournamentRecord:i,drawProfile:u,event:s});if(g.error)return g}return{...Gi}}function Hx(e){let{allUniqueParticipantIds:t,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:c,tournamentRecord:u,eventProfile:l,eventIndex:d,publish:p,isMock:m,uuids:f}=e,h=l.gender,g=l.eventName,{eventType:I=bl,policyDefinitions:y,drawProfiles:v=[],eventExtensions:S,surfaceCategory:b,tieFormatName:U,processCodes:w,discipline:T,eventLevel:D,timeItems:P,ballType:N,category:E}=l,M=l.eventId||Ru(),R=l.tieFormat||(I===Dl?Sl({namedFormat:U,event:{eventId:M,category:E,gender:h},hydrateCollections:o,isMock:m}):void 0),A=u.participants;for(let q of v)!h&&q.gender&&(h=q?.gender);let{stageParticipantsCount:C,uniqueParticipantsCount:k,uniqueParticipantStages:x}=Cx({drawProfiles:v,category:E,gender:h}),O=MI(bl)(I)&&wh||MI(wl)(I)&&Dh||I,{uniqueDrawParticipants:F=[],uniqueParticipantIds:_=[]}=x?Gx({event:{eventType:I,category:E,gender:h},uniqueParticipantsCount:k,participantsProfile:i,ratingsParameters:c,tournamentRecord:u,eventProfile:l,eventIndex:d,uuids:f}):{},{eventAttributes:L}=l;"object"!=typeof L&&(L={});let B=E?.categoryName||E?.ageCategoryCode||E?.ratingType;g=g||B||"Generated Event";let $={...L,surfaceCategory:b,processCodes:w,discipline:T,eventLevel:D,eventName:g,eventType:I,tieFormat:R,ballType:N,category:E,eventId:M,gender:h};if(S?.length&&Array.isArray(S)){let e=S.filter(Zp);e?.length&&Object.assign($,{extensions:e})}if(Array.isArray(P)&&P.forEach(e=>Qw({event:G,timeItem:e})),"object"==typeof y)for(let q of Object.keys(y))rT({policyDefinitions:{[q]:y[q]},event:$});$.category&&($.category.categoryName=B);let V,j=yA({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:$});if(j.error)return j;let G=j?.event,{stageParticipants:W}=kx({allUniqueParticipantIds:t,stageParticipantsCount:C,eventParticipantType:O,targetParticipants:A});if(v?.length){let e=qx({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:W,tournamentRecord:u,drawProfiles:v,category:E,gender:h,event:G});if(e.error)return e;let t=jx({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:u,drawProfiles:v,isMock:m,event:G});if(t.error)return t;V=t.drawIds}else if(l?.participantsProfile?.participantsCount){let e=F.map(Hm);if(e.length){let t=CS({participantIds:e,autoEntryPositions:a,tournamentRecord:u,entryStage:El,event:G});if(t.error)return t}}return p&&UA({tournamentRecord:u,event:G}),{drawIds:V,eventId:M,uniqueParticipantIds:_}}function zx({tournamentRecords:e,scheduleDate:t,venueId:r,round:i}){if(!qc(t))return{error:Ca};let{extension:n}=lm({name:Rm,tournamentRecords:e,discover:!0}),a=n?.value||[],o=a.find(e=>fu(t,e.scheduleDate));if(!o){let{startDate:r,endDate:i}=bM({tournamentRecords:e}),n=new Date(t);if(r&&n<new Date(r)||i&&n>new Date(i))return{error:Ca};o={scheduleDate:t,venues:[]},a.push(o)}let s=o.venues.find(e=>e.venueId===r);s||(s={venueId:r,rounds:[]},o.venues.push(s));let c=["notBeforeTime"],u=e=>Object.keys(e).filter(e=>!c.includes(e)).sort().map(t=>ti(e[t])?u(e[t]):e[t]).flat().join("|");if(s.rounds.find(e=>u(e)===u(i)))return ac({result:{error:xn},stack:"addSchedulingProfileRound"});s.rounds.push(i);let l=YM({tournamentRecords:e,schedulingProfile:a});return l.error?l:{...Gi}}function Yx(e){let t=Dp(e,[{drawProfile:!0,_ofType:fp}]);if(t.error)return t;let{allUniqueParticipantIds:r=[],participantsProfile:i={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:c,ratingsParameters:u,tournamentRecord:l,isMock:d=!0,drawProfile:p,startDate:m,drawIndex:f,uuids:h}=e,g=Nu(p,!1,!0),{excessParticipantAlternates:I=!0,matchUpFormat:y=Vu,drawType:v=id,tournamentAlternates:S=0,alternatesCount:b=0,qualifyingPositions:U,qualifyingProfiles:w,generate:T=!0,eventExtensions:D,drawExtensions:P,completionGoal:N,tieFormatName:E,buildTeams:M,seedsCount:R,timeItems:A,drawName:C,category:k,idPrefix:x,publish:O,gender:F,stage:_}=g,L=g.drawSize||(g.ignoreDefaults?void 0:32),B=g.eventId||Ru(),$=p.eventType||p.matchUpType||bl,V=$===wl?Dh:wh,j=ti(p.tieFormat)&&p.tieFormat||$===Ph&&Sl({event:{eventId:B,category:k,gender:F},namedFormat:E,hydrateCollections:s,isMock:d})||void 0,G=k?.categoryName||k?.ageCategoryCode||k?.ratingType,W=p.eventName||G||`Generated ${$}`,q=l?.participants||[],H=(w?.flatMap(e=>e.structureProfiles||[]).reduce((e,t)=>e+(!t.participantsCount||t.participantsCount>t.drawSize?t.drawSize:t.participantsCount||0),0)||0)*(V===Dh?2:1),z=(!p.participantsCount||p.participantsCount>L?L:p.participantsCount)||0,Y={eventName:W,eventType:$,tieFormat:j,category:k,eventId:B,gender:F};Array.isArray(A)&&A.forEach(e=>Qw({event:Y,timeItem:e}));let{eventAttributes:K}=p;if("object"!=typeof K&&(K={}),Object.assign(Y,K),D?.length&&Array.isArray(D)){let e=D.filter(Zp);e?.length&&Object.assign(Y,{extensions:e})}let X=[];if(0===i?.participantsCount||p.uniqueParticipants||H||!l||F||k){let e,t,r=(z||0)+b+H,n=r,a={[uc]:0,[oc]:0};$===Ph&&(({teamSize:e,genders:t}=Rx({alternatesCount:b,tieFormatName:E,tieFormat:j,drawSize:L})),Object.keys(t).forEach(e=>{let r=hc(e);r&&gc(e)&&t[r]&&(a[r]=L*t[r])}),n=e*((L||0)+H));let o=i?.idPrefix?`D-${f}-${i?.idPrefix}`:void 0,s=Nx({...i,scaledParticipantsCount:p.scaledParticipantsCount||i.scaledParticipantsCount,participantsCount:n,consideredDate:l?.startDate,sex:F||i?.sex,rankingRange:p.rankingRange,uuids:p.uuids||h,ratingsParameters:u,participantType:V,gendersCount:a,idPrefix:o,category:k}).participants;if(Y.category&&(Y.category.categoryName=G),l){let e=pA({participants:s,tournamentRecord:l});if(e.error)return e}if(s.forEach(({participantId:e})=>X.push(e)),q=s,$===Ph){let i=t[uc]?s.filter(({participantType:e,person:t})=>e===wh&&t?.sex===uc).map(Hm):[],n=t[oc]?s.filter(({participantType:e,person:t})=>e===wh&&dc(t?.sex)).map(Hm):[],a=s.filter(({participantType:e})=>e===wh).map(Hm).filter(e=>!i.includes(e)&&!n.includes(e)),o=[...g.teamNames??[],...Px({count:r}).names],c=e-(t[uc]+t[oc]),u=0,d=0,p=0,m=Ri(0,r).map(e=>{let r=n.slice(u,u+t[oc]),s=i.slice(d,d+t[uc]),l=a.slice(p,p+c);u+=t[oc],d+=t[uc],p+=c;let m=!1!==M?[...r,...s,...l]:[];return{participantName:o[e]||`Team ${e+1}`,participantOtherName:`TM${e+1}`,participantRole:xS,individualParticipantIds:m,participantType:Ph,participantId:Ru()}}),f=pA({participants:m,tournamentRecord:l});if(!f.success)return f;q=m}}let Q=e=>{let{participantType:t}=e;return!!(MI(bl)($)&&t===wh||MI(wl)($)&&t===Dh)||$===Ph&&t===Ph},J=e=>!p.gender||e.person?.sex===p.gender||e.individualParticipantIds?.some(e=>{let t=q.find(t=>t.participantId===e);return t&&J(t)}),Z=q.filter(Q).filter(J).filter(({participantId:e})=>!r.includes(e)),ee=Z.slice(0,z).map(e=>e.participantId);if(d&&ee?.length){let e=CS({autoEntryPositions:o,entryStage:_,tournamentRecord:l,participantIds:ee,event:Y});if(e.error)return e}let te=H?Z.slice(z,z+H).map(e=>e.participantId):0;if(d&&te?.length){let e=0,t=1,r=(e,t)=>e.stageSequence-t.stageSequence,i=(e,t)=>e.roundTarget-t.roundTarget;for(let n of w.sort(i)){t=n.roundTarget||t;let i,a=1;for(let s of n.structureProfiles.sort(r)){let r=(s.drawSize||li(s.participantsCount))-(i||0),n=te.slice(e,e+r),c=CS({entryStage:Ml,entryStageSequence:a,autoEntryPositions:o,tournamentRecord:l,participantIds:n,roundTarget:t,event:Y});if(c.error)return c;i=s.qualifyingPositions,e+=r,a+=1}t+=1}}let re=I&&l?.participants?.filter(({participantId:e})=>!ee.includes(e)).filter(Q).filter(J).slice(0,b||L-z||S).map(e=>e.participantId);if(d&&re?.length){let e=CS({participantIds:re,autoEntryPositions:!1,entryStatus:sg,tournamentRecord:l,event:Y});if(e.error)return e.error}let ie=G||W;l&&R&&R<=ee.length&&Ri(1,R+1).forEach((e,t)=>{let r={scaleName:ie,scaleDate:m,scaleType:wI,scaleValue:e,eventType:$},i=ee[t];kD({tournamentRecord:l,participantId:i,scaleItem:r})});let ne=QR({...Nu(p,!1,!0),tournamentRecord:l,seedingScaleName:ie,matchUpFormat:y,eventId:B,isMock:d,event:Y});if(ne.error)return ne;if(!ne.drawDefinition)return{error:an};let{drawDefinition:ae}=ne,oe=ae.drawId;if(Array.isArray(P)&&P.filter(Zp).forEach(e=>em({element:ae,extension:e})),T){if(qA({drawDefinition:ae,event:Y,suppressNotifications:!0}),p.withPlayoffs){let e=ae.structures?.[0].structureId,t=tT({...p.withPlayoffs,tournamentRecord:l,drawDefinition:ae,structureId:e,idPrefix:x,isMock:d,event:Y});if(t?.error)return t}let e=!1===p.automated;if(d&&!e){let e=e=>{let t=Bx({completeAllMatchUps:e.completeAllMatchUps,completionGoal:e.completionGoal,matchUpStatusProfile:n,randomWinningSide:c,tournamentRecord:l,drawDefinition:ae,matchUpFormat:y,event:Y});if(t.error)return t;let r=t.completedCount;if(v===Sd){let e=ae.structures?.find(e=>e.stage===El);if(!e)return{error:Fn};yU({structureId:e.structureId,tournamentRecord:l,drawDefinition:ae});let t=Bx({completionGoal:N?N?N-(r??0):void 0:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:c,tournamentRecord:l,drawDefinition:ae,matchUpFormat:y,event:Y});if(t.error)return t}};if(N&&e({completionGoal:N}),p.outcomes){let{matchUps:e}=Ly({inContext:!0,drawDefinition:ae,event:Y});for(let t of p.outcomes){let{matchUpStatus:r=Zm,matchUpStatusCodes:i,stageSequence:n=1,matchUpIndex:a=0,structureOrder:o,matchUpFormat:s,drawPositions:c,roundPosition:u,stage:d=El,roundNumber:p,winningSide:m,scoreString:f}=t,h=e?.reduce((e,t)=>{let{structureId:r,matchUpId:i}=t;return e[r]?e[r].push(i):e[r]=[i],e},{})??[],g=Object.assign({},...Object.keys(h).map((e,t)=>({[e]:t+1}))),I=e?.filter(e=>!(d&&e.stage!==d||n&&e.stageSequence!==n||p&&e.roundNumber!==p||u&&e.roundPosition!==u||o&&g[e.structureId]!==o||c&&2!==Ci(c,e.drawPositions).length))?.[a],y=$x({matchUpStatusCodes:i,tournamentRecord:l,drawDefinition:ae,targetMatchUp:I,matchUpFormat:s,matchUpStatus:r,scoreString:f,winningSide:m});if(y?.error)return y}}a&&e({completeAllMatchUps:a})}O&&UA({tournamentRecord:l,event:Y})}else{let e=eC({drawEntries:ae.entries,drawName:C||v,qualifyingPositions:U,drawId:oe,event:Y,stage:_});if(e.error)return e}return{...Gi,event:nc(Y),uniqueParticipantIds:X,targetParticipants:q,drawDefinition:ae,eventId:B,drawId:oe}}var Kx=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),Xx=Kx;function Qx({tournamentRecord:e,disableNotice:t,venueId:r,courtId:i,court:n}){let{venue:a}=oy({tournamentRecord:e,venueId:r});if(!a)return{error:Ro};a.courts||(a.courts=[]);let o={altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,indoorOutdoor:void 0,floodlit:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0,venueId:r,courtId:i};if(o.courtId||(o.courtId=Ru()),a.courts.some(e=>e.courtId===o.courtId))return{error:Po};{let i=(n?.dateAvailability||[]).map(e=>({...e,date:iu(e.date),startTime:ru(e.startTime),endTime:ru(e.endTime),bookings:e.bookings?.map(({startTime:e,endTime:t,bookingType:r})=>({startTime:ru(e),endTime:ru(t),bookingType:r}))})),s=Object.keys(o);for(let e of s)if(n?.[e])if("dateAvailability"===e){let e=iy({dateAvailability:i});if(!e.valid&&e.error)return e;o.dateAvailability=i}else o[e]=n[e];let c=o;return a.courts.push(c),t||Bs({payload:{venue:a,tournamentId:e.tournamentId},topic:Yf,key:a.venueId}),{...Gi,court:Nu(o),venueId:r}}}function Jx(e){let{tournamentRecord:t,venueId:r}=e;if("string"!=typeof r||!r)return{error:Ao};let i,n=e.tournamentRecords??(t&&{[t.tournamentId]:t})??{},a=[];for(let o of Object.values(n)){let{venue:t}=oy({tournamentRecord:o,venueId:r});if(t){let t=Zx({...e,tournamentRecord:o});for(let e of t?.courts??[])a.push(e?.courtId);if(t.error)return t;i=!0}}return i?{...Gi,courtIds:a}:{error:Ro}}function Zx({courtNameRoot:e="Court",dateAvailability:t=[],venueAbbreviationRoot:r,tournamentRecord:i,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:c,endTime:u,idPrefix:l,venueId:d,dates:p}){if(!d)return{error:Ao};let m=oy({tournamentRecord:i,venueId:d});if(m.error)return m;let{venue:f}=m;if(!pi(o)||!n)return{error:To};let h=Ri(0,o=o??n.length).map(i=>{let o=a?.[i],c=o?p.map(e=>({date:zc(e),startTime:s,endTime:u,...o})):t;return o&&s&&u&&c.push({startTime:s,endTime:u}),{courtName:n[i]||r&&f?.venueAbbreviation&&`${f?.venueAbbreviation} ${i+1}`||`${e} ${i+1}`,dateAvailability:c}}).map((e,t)=>{let r=c?.pop()||l&&`${l}-${t+1}`;return Qx({disableNotice:!0,tournamentRecord:i,courtId:r,venueId:d,court:e})}).map(e=>e.court).filter(Boolean);return h.length!==o?ac({info:"not all courts could be generated",result:{error:Zo}}):(f&&Bs({payload:{venue:f,tournamentId:i.tournamentId},topic:Yf,key:f.venueId}),{...Gi,courts:Nu(h)})}function eO({tournamentRecord:e,ignoreExistingVenues:t,venueProfiles:r,uuids:i}){let{startDate:n,endDate:a}=e,o=[];for(let[s,c]of r.entries()){let{venueAbbreviation:r,venueId:u=i?.pop()??Ru(),dateAvailability:l,venueDateAvailability:d,defaultStartTime:p,defaultEndTime:m,startTime:f="07:00",endTime:h="19:00",courtTimings:g,courtsCount:I,courtNames:y,venueName:v,idPrefix:S,courtIds:b}=c,U={venueName:v||`Venue ${s+1}`,venueAbbreviation:r,venueId:u};p&&(U.defaultStartTime=p),m&&(U.defaultEndTime=m),d&&(U.dateAvailability=d);let w=ny({tournamentRecord:e,venue:U});if(w.error){if(t)continue;return w}o.push(u);let T=Xc(n,a),D=!Array.isArray(l)&&[{startTime:f,endTime:h}].concat(T.map(e=>({date:zc(e),startTime:f,endTime:h})));if(I||y){let t=Jx({dateAvailability:l||D,tournamentRecord:e,courtTimings:g,courtsCount:I,courtNames:y,startTime:f,idPrefix:S,courtIds:b,endTime:h,venueId:u,dates:T});if(t.error)return t}}return o}var tO=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function rO(e){let{startDate:t,endDate:r}=e??{},{tournamentName:i=Ei(tO),ratingsParameters:n=Nv,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:c,uuids:u}=e??{},l=!1!==e?.isMock||void 0;if(t&&!qc(t)||r&&!qc(r))return{error:Ca};if(e.leagueProfiles&&!Array.isArray(e.leagueProfiles)||e.eventProfiles&&!Array.isArray(e.eventProfiles)||e.drawProfiles&&!Array.isArray(e.drawProfiles))return{error:Zo};if(!t){let e=new Date;t=zc(r??e),r=zc(e.setDate(e.getDate()+7))}if(!r){let e=new Date(t);r=zc(e.setDate(e.getDate()+7))}let d=mx({...e.tournamentAttributes??{},tournamentName:i,startDate:t,endDate:r,isMock:l}),p=c?.length?eO({tournamentRecord:d,venueProfiles:c,uuids:u}):[];if(a?.length&&Array.isArray(a)){let e=a.filter(e=>Zp({extension:e}));e?.length&&Object.assign(d,{extensions:e,isMock:l})}if("object"==typeof o)for(let y of Object.keys(o))rT({policyDefinitions:{[y]:o[y]},tournamentRecord:d});if(!e?.leagueProfiles?.length||e.eventProfiles?.length||e.drawProfiles?.length||e.participantsProfile){let t=Ax({tournamentRecord:d,...e});if(!t.success)return t}let m=[],f=[],h=[];if(e.leagueProfiles){let t=function(e){let{tournamentRecord:t,leagueProfiles:r,eventIds:i,venueIds:n,drawIds:a,allUniqueParticipantIds:o,uuids:s}=e,c=0;for(let u of r){let r=[],{tieFormatName:l=Qu,teamProfiles:d=[],teamsCount:p=0,category:m,idPrefix:f,gender:h}=u,g=u.leagueName??u.eventName??`League ${c+1}`,I=u.leagueId??u.eventId??s?.pop()??Ru();i.push(I);let y=ti(u.tieFormat)&&u.tieFormat||Sl({event:{eventId:I,category:m,gender:h},namedFormat:l,isMock:e.isMock})||void 0;if(!y)return{error:ca};let v=Math.max(p,d.length),S=Ri(0,v),{genders:b,teamSize:U}=Rx({tieFormat:y,drawSize:v}),w={[oc]:0,[cc]:0,[sc]:0,[uc]:0,ANY:0};Object.keys(b).forEach(e=>w[e]+=b[e]);for(let i of S){let a=d?.[i]?.teamName??`Team ${i+1}`,c=d?.[i]?.teamId||s?.pop()||Ru(),l=u.startDate??e.startDate,p=Nx({...u?.participantsProfile,participantsCount:U,consideredDate:l,gendersCount:w,category:m,uuids:s}).participants,h=p.map(e=>e.participantId),g=Ph,I=c??Sx({participantType:g,idPrefix:f,index:i,uuids:s});r.push({participantId:I,entryStatus:ug,entryStage:El});let y=d?.[i]?.venueIds??[],v={participantId:I,participantRole:xS,participantName:a,individualParticipantIds:h,participantType:g,homeVenueIds:y};y.forEach(e=>!n.includes(e)&&n.push(e)),o.push(...h,I);let S=pA({participants:[v,...p],tournamentRecord:t});if(S.error)return S}let T={eventName:g,entries:r,eventType:Ph,tieFormat:y,category:m,eventId:I,gender:h};if(t.events||(t.events=[]),t.events.push(T),r.length){let e=(pi(u.roundsCount)&&u.roundsCount)??"DOUBLE_ROUND_ROBIN"===u.roundsCount?2*(v-1):v-1,r=QR({automated:u.automated,tournamentRecord:t,drawType:Zl,roundsCount:e,drawSize:v,event:T});if(r.error)return r;let{drawDefinition:i}=r;if(i){let e=i?.drawId;qA({drawDefinition:i,event:T,suppressNotifications:!0}),a.push(e)}}c++}eO({tournamentRecord:t,ignoreExistingVenues:!0,venueProfiles:n.map(e=>({venueId:e})),uuids:s})}({allUniqueParticipantIds:m,tournamentRecord:d,...e,eventIds:f,venueIds:p,drawIds:h});if(t?.error)return t}if(e.drawProfiles){let t=function(e){let{tournamentRecord:t,drawProfiles:r,allUniqueParticipantIds:i,eventIds:n,drawIds:a}=e,o=0;for(let s of r){let r=Yx({allUniqueParticipantIds:i,tournamentRecord:t,drawProfile:s,drawIndex:o,...e});if(r.error)return r;let{drawId:c,eventId:u,event:l,uniqueParticipantIds:d}=r;if(!1!==s?.addEvent){if(r=yA({suppressNotifications:!1,internalUse:!0,tournamentRecord:t,event:l}),r.error)return r;c&&a.push(c),n.push(u)}d?.length&&i.push(...d),o+=1}}({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...e,eventIds:f,drawIds:h});if(t?.error)return t}if(e.eventProfiles){let t=function(e){let{eventProfiles:t,allUniqueParticipantIds:r,eventIds:i,drawIds:n}=e,a=0;for(let o of t){let t=Hx({...e,eventIndex:a,eventProfile:o});if(t.error)return t;let{eventId:s,drawIds:c,uniqueParticipantIds:u}=t;c&&n.push(...c),i.push(s),u?.length&&r.push(...u),a+=1}}({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...e,eventIds:f,drawIds:h});if(t?.error)return t}let{scheduledRounds:g,schedulerResult:I={}}=s?function(e){let{schedulingProfile:t,tournamentRecord:r,autoSchedule:i,periodLength:n,scheduleCompletedMatchUps:a}=e,o=function({schedulingProfile:e,tournamentRecord:t}){if("object"!=typeof e)return{error:Zo};let r=gh({tournamentRecord:t}).containedStructures,i=Oy({tournamentRecord:t}).matchUps??[],{tournamentId:n}=t,a=[];for(let o of e){let{scheduleDate:e,venues:s=[]}=o;for(let o of s){let{rounds:s,venueId:c}=o;for(let o of s){let{drawId:s,winnerFinishingPositionRange:u,roundSegment:l}=o,d=i.filter(e=>{let t=u?.indexOf("-")>0&&u.split("-").map(e=>+e),r=e.finishingPositionRange?.winner;return!(e.drawId!==s||o.roundNumber&&e.roundNumber!==o.roundNumber||r&&t&&2!==Ci(r,t).length&&(vi(r).length!==vi(t).length||Ci(r,t).length!==vi(r).length))})[0];if(d){let{eventId:i,roundNumber:o,drawName:p,structureName:m,roundName:f}=d,h=d.structureId;o&&!u&&(h=Object.keys(r).find(e=>r[e].includes(h))??h);let g={tournamentId:n,structureId:h,roundNumber:o,roundSegment:l,eventId:i,drawId:s},I=zx({tournamentRecords:{[n]:t},round:g,scheduleDate:e,venueId:c});if(I.error)return I;a.push({structureName:m,roundName:f,drawName:p,...g})}}}}return{scheduledRounds:a}}({schedulingProfile:t,tournamentRecord:r});if(o.error)return o;let s=o.scheduledRounds;if(i){let{tournamentId:e}=r;return{schedulerResult:px({scheduleCompletedMatchUps:a,tournamentRecords:{[e]:r},periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}({...e,tournamentRecord:d}):{};return Ls(),nc({...Gi,tournamentRecord:d,scheduledRounds:g,schedulerResult:I,eventIds:f,venueIds:p,drawIds:h})}var iO={};function nO({keepExtensions:e=[],anonymizeParticipantNames:t=!0,tournamentRecord:r,tournamentName:i,personIds:n=[],tournamentId:a}){if(!r)return{error:Ji};let o=Array.isArray(e)?Om.concat(...e):Om,s=t=>Array.isArray(e)?t?.extensions?.filter(e=>o.includes(e.name)):t?.extensions,c={};r.extensions=s(r);let u=a||Ru();c[r.tournamentId]=u,r.tournamentId=u,r.createdAt=(new Date).toISOString(),r.tournamentName=i||`Anonymized: ${zc(new Date)}`,r.isMock=!0,delete r.parentOrganisation;for(let C of r.participants||[]){C.extensions=s(C),C.onlineResources=[];let e=Ru();c[C.participantId]=e,C.participantId=e}for(let C of r.participants||[])Array.isArray(C.individualParticipantIds)&&(C.individualParticipantIds=C.individualParticipantIds.map(e=>c[e]));let l=0;for(let C of r.venues||[]){C.venueAbbreviation=`V${l}`,C.extensions=s(C),C.venueName=`Venue #${l}`,C.onlineResources=[],C.addresses=[];let e=Ru();c[C.venueId]=e,C.isMock=!0,l+=1;let t=0;for(let r of C.courts||[])r.courtName=`V${l}C${t}`,r.extensions=s(r),r.onlineResources=[],r.isMock=!0,t+=1}let d=1;for(let C of r.events||[]){C.extensions=s(C),C.onlineResources=[],C.isMock=!0;let e=Ru();c[C.eventId]=e,C.eventId=e;let t=C.category?.categoryName||C.category?.ageCategoryCode||C.category?.ratingType||C.gender;if(C.eventName=`Event ${d} ${t}`,Array.isArray(C.entries))for(let i of C.entries)i.participantId=c[i.participantId];for(let i of C.drawDefinitions||[]){i.extensions=s(i);let e=Ru();if(c[i.drawId]=e,i.drawId=e,i.isMock=!0,Array.isArray(i.entries))for(let r of i.entries)r.participantId=c[r.participantId];let t=e=>{e.extensions=s(e);let t=Ru();c[e.structureId]=t,e.structureId=t;for(let r of e.positionAssignments||[])r.participantId&&(r.participantId=c[r.participantId]);for(let r of e.seedAssignments||[])r.participantId&&(r.participantId=c[r.participantId]);for(let r of e.matchUps||[]){r.isMock=!0;for(let e of r.sides||[])e.lineUp&&(e.lineUp=e.lineUp.map(({participantId:e,collectionAssignments:t})=>({participantId:c[e],collectionAssignments:t})))}};for(let r of i.structures||[])if(t(r),Array.isArray(r.structures))for(let e of r.structures)t(e);for(let r of i.links||[])r.source.structureId=c[r.source.structureId],r.target.structureId=c[r.target.structureId]}let{extension:r}=lm({name:Sm,element:C});Array.isArray(r?.value?.flights)&&r?.value.flights?.forEach(e=>{if(e.drawId=c[e.drawId],Array.isArray(e.drawEntries))for(let t of e.drawEntries)t.participantId=c[t.participantId]}),d+=1}let p=r.startDate||zc(new Date),m=(r.participants||[]).filter(({participantType:e})=>e===wh),f=m.reduce((e,t)=>{let r=t.person?.sex,i=hc(r);return i&&gc(r)?e[i]+=1:e[sc]+=1,e},{[uc]:0,[oc]:0,[sc]:0}),h=Object.assign({},...Object.keys(f).map(e=>({[e]:Tx({category:{ageCategoryCode:"O18"},count:f[e],personExtensions:[],consideredDate:p,sex:e})?.persons||[]}))),g={[uc]:0,[oc]:0,[sc]:0},I=m.length,y=m.reduce((e,t)=>{let r=t.person?.addresses?.[0]||{},{city:i,state:n,postalCode:a}=r;return e.cities.includes(i)||e.cities.push(i),e.states.includes(n)||e.states.push(n),e.postalCodes.includes(a)||e.postalCodes.push(a),e},{cities:[],postalCodes:[],states:[]}),v=y.postalCodes.length,S=y.cities.length,b=y.states.length,{cities:U}=Ix({count:S||I,participantsCount:I}),{states:w}=yx({count:b||I,participantsCount:I}),{postalCodes:T}=vx({count:v||I,participantsCount:I}),D={cities:U,states:w,postalCodes:T};m.forEach((e,r)=>{let i=e?.person,a=i?.sex||sc,o=iu(i?.birthDate)?.split("-")[0],u=g[a],l=h[a][u];if(g[a]+=1,o){let[,e,t]=l?.birthDate?.split("-")||[],r=[o,e,t].join("-");l.birthDate=r}if(i?.addresses){let e=bx({...D,participantIndex:r,nationalityCode:l.nationalityCode});l.addresses=[e]}l.personId=n?.[r]||Ru(),t?(l.standardFamilyName=l.lastName,l.standardGivenName=l.firstName,e.participantName=`${l.standardGivenName} ${l.standardFamilyName}`):(l.standardFamilyName=i?.standardFamilyName,l.standardGivenName=i?.standardGivenName),delete l.firstName,delete l.lastName,l.extensions=s(i),e.person=l,c[i?.personId]=l.personId}),(r.participants||[]).filter(({participantType:e})=>e===Dh).forEach(e=>{let{individualParticipantIds:t}=e;e.participantName=function({individualParticipantIds:e,individualParticipants:t}){let r=t.filter(({participantId:t})=>e.includes(t)).map(({person:e})=>e?.standardFamilyName).filter(Boolean).sort().join("/");return 1===e.length&&(r+="/Unknown"),r}({individualParticipantIds:t,individualParticipants:m})});let P=(r.participants||[]).filter(({participantType:e})=>e===Ph),N=Px({count:P.length}).names;P.forEach((e,t)=>{e.participantName=N[t]});let E=(r.participants||[]).filter(({participantType:e})=>e===Th),M=Px({count:E.length,nameRoot:"Group"}).names;E.forEach((e,t)=>{e.participantName=M[t]});let{extension:R}=lm({element:r,name:Rm});Array.isArray(R?.value)&&R?.value.forEach(e=>{e.tournamentId=c[e.tournamentId],e.structureId=c[e.structureId],e.eventId=c[e.eventId],e.drawId=c[e.drawId]});let{extension:A}=lm({element:r,name:Dm});return Array.isArray(A?.value)&&A?.value.forEach(e=>{e.personId=c[e.personId]}),{...Gi}}function aO(e,t){return e?.find((e,r)=>void 0!==t.eventIndex&&r===t.eventIndex||t.eventName&&e.eventName===t.eventName||t.eventId&&e.eventId===t.eventId)}function oO({event:e,eventProfile:t,tournamentRecord:r,allUniqueParticipantIds:i,drawIds:n,params:a}){return function({event:e,eventProfile:t,tournamentRecord:r,allUniqueParticipantIds:i,drawIds:n}){let{gender:a,category:o,eventType:s}=e,{drawProfiles:c,publish:u}=t,l=MI(bl)(s)&&wh||MI(wl)(s)&&Dh||s;if(c){let{stageParticipantsCount:u,uniqueParticipantsCount:d,uniqueParticipantStages:p}=Cx({drawProfiles:c,category:o,gender:a}),{uniqueDrawParticipants:m=[],uniqueParticipantIds:f=[]}=p?Gx({event:{eventType:s,category:o,gender:a},uniqueParticipantsCount:d,participantsProfile:t.participantsProfile,ratingsParameters:t.ratingsParameters,tournamentRecord:r,eventProfile:t,uuids:t.uuids}):{};i.push(...f);let{stageParticipants:h}=kx({targetParticipants:r.participants||[],allUniqueParticipantIds:i,stageParticipantsCount:u,eventParticipantType:l}),g=qx({uniqueDrawParticipants:m,autoEntryPositions:t.autoEntryPositions,stageParticipants:h,tournamentRecord:r,drawProfiles:c,category:o,gender:a,event:e});if(g.error||(g=jx({matchUpStatusProfile:t.matchUpStatusProfile,completeAllMatchUps:t.completeAllMatchUps,randomWinningSide:t.randomWinningSide,tournamentRecord:r,drawProfiles:c,isMock:t.isMock,event:e}),g.error))return g;n.push(...g.drawIds)}return u&&UA({tournamentRecord:r,event:e}),Gi}({event:e,eventProfile:{...t,...a},tournamentRecord:r,allUniqueParticipantIds:i,drawIds:n})}function sO({eventProfile:e,tournamentRecord:t,allUniqueParticipantIds:r,eventIds:i,drawIds:n,params:a,eventIndex:o}){let s=Hx({startDate:t.startDate,allUniqueParticipantIds:r,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,randomWinningSide:a.randomWinningSide,ratingsParameters:e.ratingsParameters,tournamentRecord:t,eventProfile:e,eventIndex:o,uuids:a.uuids});if(s.error)return s;let{eventId:c,drawIds:u,uniqueParticipantIds:l}=s;return u&&n.push(...u),i.push(c),l?.length&&r.push(...l),{eventIndexIncrement:1}}function cO(e){let{participantsProfile:t={},schedulingProfile:r,tournamentRecord:i,autoSchedule:n,eventProfiles:a,periodLength:o,venueProfiles:s,drawProfiles:c,uuids:u}=e;if(!i)return{error:Ji};let l=[],d=[],p=[];a?.forEach(e=>{let t=aO(i.events,e);t?.gender&&(e.gender=t.gender)});let m=i.participants?.length||void 0;m&&t?.idPrefix&&(t.idPrefix=`${t.idPrefix}-${m}`);let f=Ax({startDate:i.startDate,participantsProfile:t,tournamentRecord:i,eventProfiles:a,drawProfiles:c,uuids:u});if(!f.success)return f;if(a){let t=function({eventProfiles:e,tournamentRecord:t,allUniqueParticipantIds:r,eventIds:i,drawIds:n,params:a}){let o=t.events?.length||0;for(let s of e){let e=aO(t.events,s);if(e){let i=oO({event:e,eventProfile:s,tournamentRecord:t,allUniqueParticipantIds:r,drawIds:n,params:a});if(i?.error)return i}else{let e=sO({eventProfile:s,tournamentRecord:t,allUniqueParticipantIds:r,eventIds:i,drawIds:n,params:a,eventIndex:o});if(e?.error)return e;o+=e?.eventIndexIncrement||1}}return Gi}({eventProfiles:a,tournamentRecord:i,allUniqueParticipantIds:l,eventIds:d,drawIds:p,params:e});if(t.error)return t}if(c){let t=function({drawProfiles:e,tournamentRecord:t,allUniqueParticipantIds:r,eventIds:i,drawIds:n,params:a}){let o=(t.events||[]).flatMap(e=>e.drawDefinitions?.map(()=>1)||[]).reduce((e,t)=>e+t,0);for(let s of e){let e=Yx({startDate:t.startDate,allUniqueParticipantIds:r,matchUpStatusProfile:a.matchUpStatusProfile,participantsProfile:a.participantsProfile,completeAllMatchUps:a.completeAllMatchUps,autoEntryPositions:a.autoEntryPositions,hydrateCollections:a.hydrateCollections,randomWinningSide:a.randomWinningSide,ratingsParameters:a.ratingsParameters,tournamentRecord:t,drawProfile:s,drawIndex:o,uuids:a.uuids});if(e.error)return e;let{drawId:c,eventId:u,event:l,uniqueParticipantIds:d}=e;if(e=yA({tournamentRecord:t,event:l,internalUse:!0}),e.error)return e;c&&n.push(c),i.push(u),d?.length&&r.push(...d),o+=1}return Gi}({drawProfiles:c,tournamentRecord:i,allUniqueParticipantIds:l,eventIds:d,drawIds:p,params:e});if(t.error)return t}let h=s?.length?eO({tournamentRecord:i,venueProfiles:s}):[],g=function({schedulingProfile:e,autoSchedule:t,periodLength:r,tournamentRecord:i}){let n={};if(e?.length){let a=YM({tournamentRecords:{[i.tournamentId]:i},schedulingProfile:e});if(a.error)return a;if(t){let{tournamentId:e}=i;n=px({tournamentRecords:{[e]:i},periodLength:r})}}return{scheduledRounds:[],schedulerResult:n}}({tournamentRecord:i,schedulingProfile:r,autoSchedule:n,periodLength:o});if(g.error)return g;let{scheduledRounds:I,schedulerResult:y}=g;return{totalParticipantsCount:i.participants.length,scheduledRounds:I,schedulerResult:y,...Gi,eventIds:d,venueIds:h,drawIds:p}}Br(iO,{anonymizeTournamentRecord:()=>nO,modifyTournamentRecord:()=>cO});var uO={};Br(uO,{addDynamicRatings:()=>_D,addIndividualParticipantIds:()=>LC,addParticipant:()=>dA,addParticipants:()=>pA,addPenalty:()=>OO,addPersonRequests:()=>gO,addPersons:()=>_O,createGroupParticipant:()=>TO,createTeamsFromParticipantAttributes:()=>fx,deleteParticipants:()=>WS,filterParticipants:()=>dS,findParticipant:()=>wO,getCompetitionParticipants:()=>dM,getPairedParticipant:()=>gy,getParticipantEventDetails:()=>pM,getParticipantMembership:()=>mM,getParticipantScaleItem:()=>fS,getParticipantSchedules:()=>fM,getParticipantSignInStatus:()=>hM,getParticipantTimeItem:()=>Bh,getParticipants:()=>mS,getScaleValues:()=>kp,mergeParticipants:()=>xO,modifyIndividualParticipantIds:()=>IO,modifyParticipant:()=>BC,modifyParticipantName:()=>DO,modifyParticipantOtherName:()=>vO,modifyParticipantsSignInStatus:()=>yO,modifyPenalty:()=>AO,modifyPersonRequests:()=>fO,mutate:()=>lO,participantScaleItem:()=>Jv,query:()=>lM,regenerateParticipantNames:()=>UO,removeIndividualParticipantIds:()=>VS,removeParticipantIdsFromAllTeams:()=>GS,removePenalty:()=>EO,removePersonRequests:()=>hO,removeRatings:()=>NO,scaledTeamAssignment:()=>PO,setParticipantScaleItem:()=>kD,setParticipantScaleItems:()=>xD,validateLineUp:()=>Mb});var lO={};function dO(e=0){("number"!=typeof e||isNaN(e))&&(e=0);let t=new Date;return t.setHours(t.getHours()+e),t.getTime().toString(36).slice(-6).toUpperCase()}function pO({personRequests:e,personId:t,requests:r}){e[t]||(e[t]=[]);let i=r.filter(({requestType:e})=>e).map(e=>{let{date:t,startTime:r,endTime:i}=e;return e.requestType===Kk&&(t=iu(t),r=ru(r),i=ru(i),t&&r&&i)?{date:t,startTime:r,endTime:i,requestType:e.requestType}:e}).filter(Boolean);for(let n of i)n.requestId=dO(),e[t].push(n);return{mergeCount:i.length}}function mO(e){let{tournamentRecords:t,personRequests:r}=e,i=Dp(e,[{[Rd]:!0}]);if(i.error)return i;if(!r)return{...Gi};let n=Object.values(t);for(let a of n){let e=a.participants??[],t=[];for(let i of Object.keys(r))if(Qp({tournamentParticipants:e,personId:i})){let e=r[i];e.length&&t.push({personId:i,requests:e})}Object.keys(t).length&&em({element:a,extension:{value:t,name:Dm}})}return{...Gi}}function fO(e){let{tournamentRecords:t,requests:r,personId:i}=e,n=Dp(e,[{[Rd]:!0},{requests:!0,[vp]:hp,[yp]:Zo}]);if(n.error)return n;let a=r.map(({requestId:e})=>e).filter(Boolean),{personRequests:o}=QM({tournamentRecords:t}),s=e=>{o&&(o[e]=o[e].map(e=>{if(!a.includes(e.requestId))return e;let t=r.find(t=>t.requestId===e.requestId);return t.requestType?Object.assign(e,t):void 0}).filter(Boolean))};if(i&&o?.[i])s(i);else if(o)for(let u of Object.keys(o))s(u);let c=r.filter(e=>!e.requestId);return c.length&&pO({personRequests:o,personId:i,requests:c}),mO({tournamentRecords:t,personRequests:o})}function hO(e){let{tournamentRecords:t,requestType:r,requestId:i,personId:n,date:a}=e,o=Dp(e,[{[Rd]:!0}]);if(o.error)return o;let{personRequests:s}=QM({tournamentRecords:t}),c=e=>{s&&(s[e]=s[e].filter(e=>!(r&&e.requestType===r||i&&e.requestId===i||a&&e.date===a)),s?.[e]?.length||delete s[e])},u=!(r||i||n||a);if(!u)if(n&&s?.[n])c(n);else if(s)for(let l of Object.keys(s))c(l);return!u&&s&&Object.keys(s).length?mO({tournamentRecords:t,personRequests:s}):Jp({name:Dm,tournamentRecords:t,discover:!0})}function gO(e){let{tournamentRecords:t,personId:r,requests:i}=e,n=Dp(e,[{[Rd]:!0,[ep]:!0},{requests:!0,[vp]:hp,[yp]:Zo}]);if(n.error)return n;let{personRequests:a}=QM({tournamentRecords:t}),{mergeCount:o}=pO({personRequests:a,personId:r,requests:i});return o&&a?mO({tournamentRecords:t,personRequests:a}):{error:Zo}}function IO({individualParticipantIds:e,groupingParticipantId:t,tournamentRecord:r}){let i="modifyIndividualParticipantIds";if(!r)return ac({result:{error:Ji},stack:i});if(!t||!e)return ac({result:{error:Da},stack:i});let n=r.participants||[],a=n.find(e=>e.participantId===t);if(!a)return ac({result:{error:to},stack:i});if(![Ph,Th].includes(a.participantType))return ac({result:{error:Ka},context:{participantType:a.participantType},stack:i});let o=e.filter(e=>n.find(t=>t.participantId===e)?.participantType!==wh);if(o.length)return ac({result:{error:za,invalidParticipantIds:o},stack:i});let s=a.individualParticipantIds||[],c=e.filter(e=>!s.includes(e)),u=s.filter(t=>!e.includes(t)),l=LC({individualParticipantIds:c,groupingParticipantId:t,tournamentRecord:r});if(l.error)return ac({result:l,stack:i});let d=VS({individualParticipantIds:u,groupingParticipantId:t,tournamentRecord:r});if(d.error)return ac({result:d,stack:i});let{topics:p}=Ws();if(p.includes(Wf)){let e=n.find(({participantId:e})=>e===t);Bs({topic:Wf,payload:{tournamentId:r.tournamentId,participants:[e]}})}return{...l,...d}}function yO({tournamentRecord:e,participantIds:t,signInState:r}){if(!e)return{error:Ji};if(!Array.isArray(t))return{error:Da};if(![bh,Sh].includes(r))return{error:Zo,signInState:r};let i=e.participants||[];if(!i.length)return{error:Ja};let n=i.map(Hm),a=t.filter(e=>!n.includes(e));if(a.length)return{error:Zo,context:{invalidParticipantIds:a}};let o=[],s=(new Date).toISOString();for(let u of i){let{participantId:i}=u;if(t.includes(i)){let t=Kw({duplicateValues:!1,tournamentRecord:e,participantId:i,timeItem:{itemType:vh,itemValue:r,createdAt:s}});if(t.error)return t;o.push(u)}}let{topics:c}=Ws();return o.length&&c.includes(Wf)&&Bs({topic:Wf,payload:{tournamentId:e.tournamentId,participants:o}}),{...Gi}}function vO({tournamentRecord:e,participantId:t,participantOtherName:r}){if(!e)return{error:Ji};if(!t)return{error:Za};let{participant:i}=kh({tournamentRecord:e,participantId:t});if(!i)return{error:to};i.participantOtherName=r;let{topics:n}=Ws();return n.includes(Wf)&&Bs({topic:Wf,payload:{tournamentId:e.tournamentId,participants:[i]}}),{...Gi}}function SO({personFormat:e,person:t}){let r=e=>e.replace(/\W/g,""),i=e=>e.toLowerCase().indexOf("l")<e.toLowerCase().indexOf("f"),n=e=>e.indexOf(",")>=0;if(!t)return;let a=e.indexOf(" ")>0?" ":"",o=ZS(t?.standardGivenName??""),s=ZS(t?.standardFamilyName??"");if(!e)return`${o}${a}${s}`;(e=>e.toLowerCase().indexOf("f.")>=0)(e)&&!n(e)&&!i(e)&&(o=`${o[0]}.`),(e=>/^[a-z]*$/.test(r(e)))(e)?(o=o.toLowerCase(),s=s.toLowerCase()):(e=>/^[A-Z]*$/.test(r(e)))(e)?(o=o.toUpperCase(),s=s.toUpperCase()):(e=>/^[LAST]{4}/.test(r(e)))(e)&&(s=s.toUpperCase());let c=`${o}${a}${s}`;return(e=>e.toLowerCase().indexOf("f")<0)(e)?c=s:i(e)&&(c=n(e)?`${s},${a}${o}`:`${s}${a}${o}`),c}function bO({participantMap:e,participant:t,formats:r}){let{participantType:i,individualParticipantIds:n,person:a}=t,o=i&&r[i];if(i!==Uh&&o){let{personFormat:r,doublesJoiner:s}=o;i===wh&&(t.participantName=SO({person:a,personFormat:r})),i===Dh&&(t.participantName=n?.map(t=>{let i=e[t]?.person;return SO({person:i,personFormat:r})}).filter(Boolean).join(s??"/"))}}function UO({tournamentRecord:e,formats:t}){if(!e)return{error:Ji};if(!ti(t))return{error:Da};let r=e.participants??[],i=ii(r,"participantId");for(let n of r)bO({participant:n,participantMap:i,formats:t});return{...Gi}}function wO(e){let t,r,{tournamentRecord:i,policyDefinitions:n,contextProfile:a,participantId:o,personId:s}=e,c=e.tournamentRecords||i&&{[i.tournamentId]:i}||{};if("string"!=typeof o&&"string"!=typeof s)return{error:Da,stack:"publicFindParticipant"};for(let u of Object.values(c)){if(r=u.tournamentId,t=Qp({tournamentParticipants:u.participants||[],internalUse:!0,policyDefinitions:n,contextProfile:a,participantId:o,personId:s}),t)break}return{participant:t,tournamentId:r,...Gi}}function TO({individualParticipantIds:e=[],participantRoleResponsibilities:t,participantRole:r=LS,tournamentRecord:i,participantId:n,groupName:a}){if(!i)return{error:Ji};if(!a)return{error:Da,info:"Missing groupName"};if(!Array.isArray(e))return{info:"Invalid individualParticipantIds",error:Zo};let o=(mS({participantFilters:{participantTypes:[wh]},tournamentRecord:i}).participants??[]).map(e=>e.participantId);for(let l of e)if(!o.includes(l))return{error:Ka,participantId:l};let s=nc({participantId:n||Ru(),participantRoleResponsibilities:t,participantName:a,individualParticipantIds:e,participantType:Th,participantRole:r}),c=dA({participant:s,tournamentRecord:i});if(c.error)return c;let{topics:u}=Ws();return u.includes(Rf)&&Bs({topic:Rf,payload:{tournamentId:i.tournamentId,participants:[s]}}),{...Gi,participant:Nu(s)}}function DO({tournamentRecord:e,participantName:t,participantId:r}){if(!e)return{error:Ji};if(!r)return{error:Za};if(!t)return{error:Da,info:"Missing participantName"};let{participant:i}=kh({tournamentRecord:e,participantId:r});if(!i)return{error:to};i.participantName=t;let{topics:n}=Ws();return n.includes(Wf)&&Bs({topic:Wf,payload:{tournamentId:e.tournamentId,participants:[i]}}),{...Gi}}function PO({clearExistingAssignments:e=!0,individualParticipantIds:t,reverseAssignmentOrder:r,initialTeamIndex:i=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:c,teamsCount:u,eventId:l,event:d}){if(!o)return{error:Ji};if(!Array.isArray(a)&&!gi(u)&&!l||!gi(i)||n&&!Array.isArray(n)||s&&("object"!=typeof s||!Object.keys(s).length))return{error:Zo};if(!s&&!n.length||!n&&(!t||!s))return{error:Da,info:"Missing scaling details"};if(l&&!a){if(d?.eventType!==Pl)return{error:Vn};a=d?.entries?.filter(({entryStatus:e})=>e===ug).map(Hm)}if(!a?.length&&!u)return{info:"Missing teamParticipantIds or teamsCount",error:Da};let p=t??n.map(({participantId:e})=>e);r&&(a?.reverse(),i+=1),i>(a?.length||0)-1&&(i=0);let m=a?.slice(i).concat(...a.slice(0,i))??[],f=[];for(let I of o.participants??[]){let{participantId:e,participantType:t}=I;if(m.includes(e)){if(t!==Uh)return{error:Ka,participant:I};f.push(I)}}if(u&&f.length<u){let e=c??"Team",t=Ri(0,u-(f?.length||0)).map(t=>({participantName:`${e} ${t+1}`,participantType:Uh,participantRole:xS})),{participants:r=[]}=pA({participants:t,returnParticipants:!0,tournamentRecord:o}),i=r.map(Hm),n=o.participants?.filter(({participantId:e})=>i.includes(e))??[];f.push(...n)}if(!f.length)return{error:ts};if(e)for(let I of f)I.individualParticipantIds=[];else{let e=f.map(e=>e).flat();t?.length?p=p.filter(t=>!e.includes(t)):n=n?.filter(({participantId:t})=>!e.includes(t))}if(!t?.length&&!n?.length)return{error:zo,info:"Nothing to be done"};if(!n.length){for(let e of o.participants??[]){let{participantId:t,participantType:r}=e;if(!p.includes(t))continue;if(r!==wh)return{error:Ka,participant:e};let i=Jv({scaleAttributes:s,participant:e})?.scaleItem,a={participantId:t,scaleValue:s?.accessor?i?.scaleValue?.[s?.accessor]:i?.scaleValue};n.push(a)}if(!n.length)return{error:to}}n.sort((e,t)=>s?.sortOrder?(t?.scaleValue||0)-(e?.scaleValue||0):(e?.scaleValue||1/0)-(t?.scaleValue||1/0));for(let I of n)if(!I.participantId)return{error:Zo,scaledParticipant:I};let h=0;for(;h<n.length;){for(let e of f){if(h+1>n.length)break;let t=n[h];e.individualParticipantIds.push(t.participantId),h++}f.reverse()}let g=f.map(Hm);for(let I of o.events??[]){if(I.eventType!==Pl)continue;let e=(I.entries??[]).filter(e=>g.includes(e.participantId));for(let t of e){let e=t.participantId,r=f.find(t=>t.participantId===e)?.individualParticipantIds;I.entries=(I.entries??[]).filter(e=>!r.includes(e.participantId)),(I.drawDefinitions??[]).forEach(e=>{e.entries=(e.entries??[]).filter(e=>!r.includes(e.participantId))});let{flightProfile:i}=py({event:I});(i?.flights||[]).forEach(e=>{e.drawEntries=(e.drawEntries||[]).filter(e=>!r.includes(e.participantId))})}}return{...Gi,scaledParticipants:n}}function NO(e){let t=Dp(e,[{[Cd]:!0,[Yd]:!0},{ratingType:!1,[gp]:e=>Nv[e]}]);if(t.error)return t;let r=`${e.ratingType}.${Np}`,i=e.asDynamic?r:e.ratingType,n=[Rp,Mp,e.eventType,i].join("."),a=e.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(e=>e.itemType!==n));return{...Gi}}function EO(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:Qi};for(let r of Object.values(t)){let t=MO({...e,tournamentRecord:r});if(t.error&&t.error!==wo)return t}return{...Gi}}function MO({tournamentRecord:e,penaltyId:t}){if(!e)return{error:Ji};if(!t)return{error:Uo};let r,i=[],n=!1;return(e?.participants??[]).forEach(e=>{let a=!1;e.penalties=(e.penalties??[]).filter(o=>(o.penaltyId===t&&(a=!0,n||(r=o,n=!0)),a&&i.push(e),o.penaltyId!==t))}),r&&Bs({topic:Wf,payload:{tournamentId:e.tournamentId,participants:i}}),r?{...Gi,penalty:r}:{error:wo}}Br(lO,{addDynamicRatings:()=>_D,addIndividualParticipantIds:()=>LC,addParticipant:()=>dA,addParticipants:()=>pA,addPenalty:()=>OO,addPersonRequests:()=>gO,addPersons:()=>_O,createGroupParticipant:()=>TO,createTeamsFromParticipantAttributes:()=>fx,deleteParticipants:()=>WS,findParticipant:()=>wO,mergeParticipants:()=>xO,modifyIndividualParticipantIds:()=>IO,modifyParticipant:()=>BC,modifyParticipantName:()=>DO,modifyParticipantOtherName:()=>vO,modifyParticipantsSignInStatus:()=>yO,modifyPenalty:()=>AO,modifyPersonRequests:()=>fO,regenerateParticipantNames:()=>UO,removeIndividualParticipantIds:()=>VS,removeParticipantIdsFromAllTeams:()=>GS,removePenalty:()=>EO,removePersonRequests:()=>hO,removeRatings:()=>NO,scaledTeamAssignment:()=>PO,setParticipantScaleItem:()=>kD,setParticipantScaleItems:()=>xD});var RO=({penaltyId:e=Ru()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:e});function AO(e){let{tournamentRecords:t}=e;if("object"!=typeof t||!Object.keys(t).length)return{error:Qi};for(let r of Object.values(t)){let t=CO({...e,tournamentRecord:r});if(t.error&&t.error!==wo||t.success)return t}return{error:wo}}function CO({tournamentRecord:e,modifications:t,penaltyId:r}){if(!e)return{error:Ji};if(!t)return{error:Zo,modifications:t};if(!r)return{error:Uo};let i=e?.participants??[],n=Object.keys(RO()).filter(e=>"penaltyId"!==e),a=Object.keys(t).filter(e=>n.includes(e));if(!a.length)return{error:is};let o,s=[];return i.forEach(e=>{let i=!1;e.penalties=(e.penalties??[]).map(e=>(e.penaltyId===r&&(i=!0,a.forEach(r=>Object.assign(e,{[r]:t[r]})),o||(o=e)),e)),i&&s.push(e)}),o&&Bs({topic:Wf,payload:{tournamentId:e.tournamentId,participants:s}}),o?{...Gi,penalty:o}:{error:wo}}function kO(e,t,r){return!e&&t?t:e&&!t||"object"!=typeof e||"object"!=typeof t?e:vi(Object.keys(e).concat(Object.keys(t))).reduce((i,n)=>{if(t[n])if(e[n])if(typeof e[n]!=typeof t[n])i[n]=t[n];else if(Array.isArray(e[n]))if(!0===r||Array.isArray(r)&&r.includes(n)){let r=vi(e[n].map(e=>JSON.stringify(e)).concat(t[n].map(e=>JSON.stringify(e)))).map(e=>JSON.parse(e));i[n]=r}else i[n]=t[n];else"object"==typeof e[n]?i[n]=kO(e[n],t[n],r):i[n]=t[n];else i[n]=t[n];else i[n]=e[n];return i},{})}function xO({participants:e=[],tournamentRecord:t,arraysToMerge:r}){if(!t)return{error:Ji};t.participants||(t.participants=[]);let i=e.filter(Vy(_d)).map(e=>({[e.participantId]:e})),n=Object.assign({},...i),a=[];t.participants=t.participants.map(e=>{if(n[e.participantId]){let t=kO(e,n[e.participantId],r);return a.push(t),t}return e});let o=t.participants.map(Vy(_d))||[],s=e.filter(({participantId:e})=>!o.includes(e)),{topics:c}=Ws();return s.length&&(t.participants=t.participants.concat(...s),c.includes(Rf)&&Bs({topic:Rf,payload:{participants:s}})),a.length&&c.includes(Wf)&&Bs({topic:Wf,payload:{tournamentId:t.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...Gi}}function OO(e){let t,{tournamentRecord:r,participantIds:i}=e,n=e.tournamentRecords??(r&&{[r.tournamentId]:r})??{};for(let a of Object.values(n)){let r=(mS({tournamentRecord:a}).participants??[])?.map(Hm).filter(e=>i.includes(e));r.length&&(t=FO({...e,penaltyId:e.penaltyId??t,tournamentRecord:a,participantIds:r}).penaltyId)}return t?{...Gi,penaltyId:t}:{error:to}}function FO({refereeParticipantId:e,tournamentRecord:t,participantIds:r,penaltyCode:i,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:c,notes:u}){if(!t)return{error:Ji};if(!r)return{error:Za};if(!n)return{error:bo};let l=(t?.participants??[]).filter(e=>r.includes(e.participantId));if(!l.length)return{error:to};let d=(new Date).toISOString(),p=Object.assign(RO({penaltyId:o}),{refereeParticipantId:e,penaltyCode:i,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:c,notes:u});return Array.isArray(a)&&a.forEach(e=>em({element:p,extension:e})),l.forEach(e=>{e.penalties??=[],e.penalties.push(p)}),Bs({topic:Wf,payload:{tournamentId:t.tournamentId,participants:l}}),{...Gi,penaltyId:p.penaltyId}}function _O({participantRole:e=xS,tournamentRecord:t,persons:r}){if(!t)return{error:Ji};if(!Array.isArray(r))return{error:Zo};if(!Object.keys($S).includes(e))return{error:Ya};let i,n=new Set((t.participants||[]).map(({person:e})=>e?.personId).filter(Boolean)),a=[],o=r.filter(e=>e&&(!e.personId||!n.has(e.personId))).map(e=>(e.personId||(e.personId=Ru()),a.push(e.personId),e)),s=(e,t)=>Object.assign({},...Object.keys(e).filter(e=>!t.includes(e)).map(t=>({[t]:e[t]}))),c=0,u=pA({participants:o.map(t=>nc({extensions:t.participantExtensions,timeItems:t.participantTimeItems,participantType:wh,participantRole:e,person:s(t,["participantExtensions","participantTimeItems","pairedPersons"])})),tournamentRecord:t});if(u.error)return u;i=u.addedCount||0;let l=[],d=mS({participantFilters:{participantTypes:[wh]},tournamentRecord:t})?.participants??[];if(e===xS&&r.filter(({pairedPersons:e})=>e).forEach(({personId:e,pairedPersons:t})=>{Array.isArray(t)&&t.forEach(t=>{let r=[e,t.personId].map(e=>Qp({tournamentParticipants:d,personId:e})).filter(Boolean);if(2===r.length){let e=r.map(Hm);l.push(nc({extensions:t.participantExtensions,timeItems:t.timeItems,participantRole:xS,individualParticipantIds:e,participantType:Dh}))}})}),l.length){if(u=pA({participants:l,tournamentRecord:t}),u.error)return u;c=u.addedCount||0}let p=i+c;return{...Gi,addedCount:p,newPersonIds:a}}var LO={};Br(LO,{bulkUpdatePublishedEventIds:()=>LM,getAllEventData:()=>BM,getCourtInfo:()=>ly,getDrawData:()=>kT,getEventData:()=>xT,getEventPublishStatus:()=>iS,getPublishState:()=>aS,getTournamentPublishStatus:()=>rS,getVenueData:()=>dy,mutate:()=>BO,publishEvent:()=>UA,publishEventSeeding:()=>$O,publishOrderOfPlay:()=>YO,publishParticipants:()=>HO,query:()=>_M,setEventDisplay:()=>KA,unPublishEvent:()=>XO,unPublishEventSeeding:()=>VO,unPublishOrderOfPlay:()=>WO,unPublishParticipants:()=>jO});var BO={};function $O({removePriorValues:e=!0,stageSeedingScaleNames:t,seedingScaleNames:r,tournamentRecord:i,status:n=DI,drawIds:a=[],event:o}){if(!i)return{error:Ji};if(!o)return{error:jn};let s=iS({event:o,status:n}),c=(s?.seeding?.seedingScaleNames||r)&&{...s?.seeding?.seedingScaleNames,...r};return bA({statusObject:{seeding:nc({stageSeedingScaleNames:(s?.seeding?.stageSeedingScaleNames||t)&&{...s?.seeding?.stageSeedingScaleNames,...t},seedingScaleNames:c,published:!0,drawIds:a})},removePriorValues:e,status:n,event:o}),Bs({topic:Qf,payload:{tournamentId:i.tournamentId,eventId:o.eventId,drawIds:a}}),{...Gi}}function VO({removePriorValues:e=!0,seedingScaleNames:t,tournamentRecord:r,status:i=DI,drawIds:n,stages:a,event:o}){if(!r)return{error:Ji};if(!o)return{error:jn};let s=iS({event:o});if(s){let r=s.seeding;if(Array.isArray(a)&&r.stageSeedingScaleNames)for(let e of a)r.stageSeedingScaleNames[e]&&delete r.stageSeedingScaleNames[e];Array.isArray(t)&&r?.seedingScaleNames&&(r.seedingScaleNames=r.seedingScaleNames.filter(e=>!t.includes(e))),Array.isArray(n)&&r?.drawIds&&(r.drawIds=r.drawIds.filter(e=>!n.includes(e))),(!Object.values(r.stageSeedingScaleNames??{}).length&&!r.seedingScaleNames?.length&&!r.drawIds?.length||!a&&!t&&!n?.length)&&(delete r.stageSeedingScaleNames,delete r.seedingScaleNames,delete r.drawIds,r.published=!1),bA({statusObject:{seeding:r},removePriorValues:e,status:i,event:o})}return Bs({topic:th,payload:{tournamentId:r.tournamentId,eventId:o.eventId}}),{...Gi}}function jO(e){let t=yh(e);if(!Object.keys(t).length)return{error:Qi};for(let r of Object.values(t)){let t=GO({tournamentRecord:r,...e});if(t.error)return t}return{...Gi}}function GO({removePriorValues:e=!0,tournamentRecord:t,status:r=DI}){if(!t)return{error:Ji};let i=`${TI}.${PI}`,{timeItem:n}=Oh({element:t,itemType:i}),a=n?.itemValue||{[r]:{}};return a[r]&&delete a[r].participants,Yw({timeItem:{itemValue:a,itemType:i},element:t,removePriorValues:e}),Bs({payload:{tournamentId:t.tournamentId},topic:"unPublishParticipants"}),{...Gi}}function WO(e){let t=yh(e);if(!Object.keys(t).length)return{error:Qi};for(let r of Object.values(t)){let t=qO({tournamentRecord:r,...e});if(t.error)return t}return{...Gi}}function qO({removePriorValues:e=!0,tournamentRecord:t,status:r=DI}){if(!t)return{error:Ji};let i=`${TI}.${PI}`,{timeItem:n}=Oh({element:t,itemType:i}),a=n?.itemValue||{[r]:{}};return a[r]&&delete a[r].orderOfPlay,Yw({timeItem:{itemValue:a,itemType:i},element:t,removePriorValues:e}),Bs({topic:rh,payload:{tournamentId:t.tournamentId}}),{...Gi}}function HO(e){let t=yh(e);if(!Object.keys(t).length)return{error:Qi};for(let r of Object.values(t)){let t=zO({tournamentRecord:r,...e});if(t.error)return t}return{...Gi}}function zO({removePriorValues:e,tournamentRecord:t,status:r=DI}){if(!t)return{error:Ji};let i=`${TI}.${PI}`,{timeItem:n}=Oh({element:t,itemType:i}),a=n?.itemValue||{[r]:{}};return a[r].participants={published:!0},Yw({timeItem:{itemValue:a,itemType:i},element:t,removePriorValues:e}),Bs({payload:{tournamentId:t.tournamentId},topic:Zf}),{...Gi}}function YO(e){let t=yh(e);if(!Object.keys(t).length)return{error:Qi};for(let r of Object.values(t)){let t=KO({tournamentRecord:r,...e});if(t.error)return t}return{...Gi}}function KO({scheduledDates:e=[],removePriorValues:t,tournamentRecord:r,status:i=DI,eventIds:n=[]}){if(!r)return{error:Ji};let a=`${TI}.${PI}`,{timeItem:o}=Oh({element:r,itemType:a}),s=o?.itemValue||{[i]:{}};return s[i].orderOfPlay={published:!0,scheduledDates:e,eventIds:n},Yw({timeItem:{itemValue:s,itemType:a},element:r,removePriorValues:t}),Bs({topic:Jf,payload:{tournamentId:r.tournamentId,scheduledDates:e,eventIds:n}}),{...Gi}}function XO({removePriorValues:e=!0,tournamentRecord:t,status:r=DI,event:i}){if(!t)return{error:Ji};if(!i)return{error:jn};let n=`${TI}.${PI}`,{timeItem:a}=_h({itemType:n,event:i}),o=a?.itemValue||{[r]:{}};return delete o[r].structureIds,delete o[r].drawDetails,delete o[r].drawIds,Qw({event:i,timeItem:{itemValue:o,itemType:n},removePriorValues:e}),bA({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:e,status:r,event:i}),Bs({topic:eh,payload:{tournamentId:t.tournamentId,eventId:i.eventId}}),{eventId:i.eventId,...Gi}}Br(BO,{publishEvent:()=>UA,publishEventSeeding:()=>$O,publishOrderOfPlay:()=>YO,publishParticipants:()=>HO,setEventDisplay:()=>KA,unPublishEvent:()=>XO,unPublishEventSeeding:()=>VO,unPublishOrderOfPlay:()=>WO,unPublishParticipants:()=>jO});var QO={};function JO({withCompetitiveProfiles:e,opponentParticipantId:t,withIndividualStats:r,teamParticipantId:i,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){if(!n)return{error:Ji};if(s&&!Array.isArray(s))return{error:fa};if(s=s??Oy({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!s?.length)return{error:pa};let c=[];t&&c.push(t),i&&c.push(i);let u=mS({participantFilters:c.length?{participantIds:c}:{participantTypes:[Uh]},tournamentRecord:n}).participants??[];if(!u.every(({participantType:e})=>e===Uh))return{error:za};c.length||c.push(...u.map(Hm));let l=new Map,d=new Map,p=new Map,m=new Map,f=(e,t="")=>d.get(e)||d.set(e,{participantName:t,participantId:e,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&d.get(e);for(let U of u){let{participantId:e,individualParticipantIds:t}=U;m.set(e,t??[]),f(e,U.participantName)}if(i&&!m.get(i))return ac({result:{error:to},context:{teamParticipantId:i}});if(t&&!m.get(t))return ac({result:{error:to},context:{opponentParticipantId:t}});let h=[],g=e=>{let n=[[],[]];for(let t of e){let e=t.participant;if(e?.participantName){l.set(e.participantId,{participantName:e.participantName,ratings:e.ratings});let t=d.get(e.participantId);t&&(t.participantName=e.participantName)}}let a=({side:e,individualParticipantIds:t})=>e.participantId&&(!t?.length||t.includes(e.participantId))&&[e.participantId]||e.participant?.individualParticipantIds?.length&&(!t?.length||Ci(t,e.participant?.individualParticipantIds).length===e.participant?.individualParticipantIds?.length)&&e.participant.individualParticipantIds;if(m.size){let o=(t,i)=>{for(let o of e){if(!o.participant)continue;let e=a({individualParticipantIds:i,side:o});if(e?.length){let i=o.sideNumber;if(!i)continue;let a=[t];r&&a.push(...e),n[i-1]=a;let s=d.get(t);for(let t of e.filter(Boolean))s&&!s.competitorIds.includes(t)&&s.competitorIds.push(t)}}};if(i)(!t||e.every(e=>e.participant&&(a({individualParticipantIds:m.get(i),side:e})||a({individualParticipantIds:m.get(t),side:e}))))&&o(i,m.get(i));else for(let[e,t]of m)o(e,t)}else if(r)for(let t of e){if(!t.participant)continue;let e=a({individualParticipantIds:[],side:t}),r=t.sideNumber;r&&(n[r-1]=e)}return n};for(let U of s){if(!ti(U))return{error:fa};let{matchUpStatus:t,matchUpFormat:r,matchUpType:i,winningSide:n,score:a,sides:s}=U;if(!s||!a||i===zr||"BYE"===t)continue;let c=g(s);if(!c.filter(Boolean).length)continue;let u=e&&n&&Qg({matchUp:U})?.competitiveness;h.push(U);let d=Rv({matchUpStatus:t,matchUpFormat:r,tallyPolicy:o,winningSide:n,score:a}),p=Av({matchUpStatus:t,matchUpFormat:r,tallyPolicy:o,winningSide:n,score:a}),{pointsTally:m,tiebreaksTally:I}=Cv({matchUpFormat:r,score:a});c.forEach((e,r)=>{for(let i of e){let e=l.get(i)?.participantName,a=f(i,e);if(a){let e=(e,t)=>t.forEach((t,r)=>a[e][r]+=t),i=r?[...I].reverse():I,o=r?[...m].reverse():m,s=r?[...p].reverse():p,c=r?[...d].reverse():d;if(e("tiebreaks",i),e("points",o),e("games",s),e("sets",c),n){let e=n-1===r?0:1;a.matchUps[e]+=1}if(u){let e=u.toLowerCase();a.competitiveness[e]||(a.competitiveness[e]=[0,0]),a.competitiveness[e][r]+=1}if(t){let e=t.toLowerCase();a.matchUpStatuses[e]||(a.matchUpStatuses[e]=0),a.matchUpStatuses[e]+=1}}}})}let I=["tiebreaks","matchUps","points","games","sets"],y=["competitive","routine","decisive"],v=new Map,S=(e,t)=>(e??0)+(t??0);for(let[U,w]of d.entries()){for(let e of I){let t=w[e].reduce(S);if(t){let r=w[e][0]/t,i=`${e}Ratio`,n=parseFloat(r.toFixed(2));w[i]=n,p.set(U,!0),v.has(i)||v.set(i,[]),v.get(i)?.push(n)}}for(let e of y){let t=w.competitiveness?.[e]?.reduce(S);if(t){let r=w.competitiveness[e][0]/t,i=`${e}Ratio`,n=parseFloat(r.toFixed(2));w[i]=n}}}if(!i){let e=(e,t)=>t-e;for(let t of d.values())for(let r of I){let i=`${r}Ratio`;if("number"==typeof t[i]){let n=v.get(i)?.sort(e).indexOf(t[i]);if("number"==typeof n&&n>=0){t[`${r}Rank`]=n+1}}}}let b={relevantMatchUps:h,...Gi};return i?(b.teamStats=d.get(i),t&&(b.opponentStats=d.get(t))):b.participatingTeamsCount=p.size,b.allParticipantStats=[...d.values()],b}function ZO({participant:e,eventType:t}){let r=e?.person?.personId,i=e?.person?.personOtherIds?.[0],n=e?.person?.tennisId,a=e?.ratings?.[t]?.find(({scaleName:e})=>"WTN"===e),o=a?.scaleValue,{wtnRating:s,confidence:c}=o||{};return{timeStamp:a?.scaleDate,personOtherId:i,confidence:c,wtnRating:s,personId:r,tennisId:n}}function eF({tournamentRecord:e}){if(!e)return{error:Ji};let t=e.tournamentId,{participantMap:r}=mS({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:e,withDraws:!0}),i=(Oy({matchUpFilters:{matchUpTypes:[Gr,qr]},tournamentRecord:e}).matchUps??[]).flatMap(({sides:e,matchUpType:t})=>e?.flatMap(e=>t===qr?e?.participant?.individualParticipantIds:e?.participant?.participantId||e.participantId).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},c=0,u=({id:e,entry:i,eventId:o,eventType:s})=>{let{qualifyingSeeding:c,mainSeeding:u,entryStatus:l,entryStage:d,drawId:p}=i;a[e]||(a[e]=[]);let{participant:m,events:f}=r?.[e]??{},h=ZO({participant:m,eventType:s}),g=f?.[o]?.ranking;l===WU&&n.push(e),a[e].push({participantType:m?.participantType,participantId:e,tournamentId:t,eventType:s,eventId:o,drawId:p,entryStatus:l,entryStage:d,...h,ranking:g,mainSeeding:u,qualifyingSeeding:c})};for(let m of e.events??[]){let e={},n=t=>{e[t]||(e[t]={count:0}),e[t].count+=1},{drawDefinitions:a=[],eventType:l,eventId:d}=m,p=a.flatMap(e=>{let{drawId:t,entries:i}=e;c+=1;let a=(e.structures??[]).filter(({stage:e,stageSequence:t})=>e===El&&1===t||e===Ml).flatMap(({positionAssignments:e})=>e).filter(Boolean).map(({participantId:e})=>e);return i?.filter(({participantId:e})=>a.includes(e)).map(e=>{let{participantId:i,entryStatus:a,entryStage:o}=e;n(a);let s=r?.[i]?.draws?.[t]?.seedAssignments?.[El];return{qualifyingSeeding:r?.[i]?.draws?.[t]?.seedAssignments?.[Ml],participantId:i,mainSeeding:s,entryStatus:a,entryStage:o,drawId:t}})}),f=e=>{let t=e.participantId,n=r?.[t].participant.individualParticipantIds?.filter(e=>i.includes(e));return t&&{[t]:{individualParticipantIds:n}}};l===Tl?(()=>{let e=Object.assign({},...p.map(f).filter(Boolean));p.forEach(t=>{e[t.participantId].individualParticipantIds.forEach(e=>{u({id:e,eventType:l,eventId:d,entry:t})})})})():p.forEach(e=>{u({id:e?.participantId,eventType:l,eventId:d,entry:e})});let h=Object.values(e).reduce((e,t)=>e+t.count,0);Object.keys(e).forEach(t=>{e[t].pct=e[t].count/h*100}),s[d]={tournamentId:t,eventId:d,entries:p,entryStatuses:e};let g=Object.assign({},...wg.flatMap(t=>[{[t+"_count"]:e[t]?.count},{[t+"_pct"]:e[t]?.pct}]));o[d]={tournamentId:t,eventId:d,...g}}let l=Object.values(r??{}).filter(({participant:{participantType:e,participantRole:t}})=>e===wh&&t===xS),d=l.filter(({participant:e})=>!i.includes(e.participantId)).map(({participant:e})=>e.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:l.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:c,tournamentId:t};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function tF({eventType:e,matchUps:t,eventId:r,drawId:i}){let n={},a=t.filter(e=>r?e.eventId===r:e.drawId===i).reduce((e,t)=>((e=>{let t=e?.matchUpFormat;t&&(n[t]||(n[t]=0),n[t]+=1)})(t),(t.sides??[]).flatMap(e=>(e?.participant?.individualParticipants||[e?.participant]).filter(Boolean)).forEach(t=>e[t.participantId]=t),e),{}),o=Object.values(a),s=o.map(t=>ZO({participant:t,eventType:e})).filter(({wtnRating:e})=>e),c=(o.length-s.length)/o.length*100,u=s.reduce((e,t)=>{let{wtnRating:r,confidence:i}=t;return e.totalWTN+=r,e.totalConfidence+=i,e},{totalWTN:0,totalConfidence:0}),l=s?.length?u.totalWTN/s.length:0,d=s?.length?u.totalConfidence/s.length:0,p=Object.values(n).reduce((e,t)=>e+(t||0),0);return{matchUpFormatCounts:n,matchUpsCount:p,avgConfidence:d,pctNoRating:c,avgWTN:l}}function rF(e){let{tournamentRecord:t,extensionProfiles:r,firstFlightOnly:i,firstStageSequenceOnly:n=!0}=e;if(!t)return{error:en};let a=[],o={},s={},c=[],u=Object.assign({},...(r??[]).map(({name:e,label:r,accessor:i})=>{let n=lm({element:t,name:e})?.extension?.value,a=i?By({element:n,accessor:i})?.value:n;return{[r??e]:a}})),l=t?.tournamentId,d=Oy({participantsProfile:{withScaleValues:!0},tournamentRecord:t}).matchUps??[],p=e=>Oh({itemType:Af,itemSubTypes:[Ap],element:{timeItems:e}})?.timeItem?.itemValue?.scaleBasis,m=t?.events?.flatMap(({timeItems:e,drawDefinitions:t=[],extensions:r,eventType:c,eventName:m,eventId:f,category:h})=>{let g=r?.find(e=>e.name===Sm)?.value?.flights?.map(e=>({[e.drawId]:e.flightNumber})),I=g&&Object.assign({},...g),y=r?.find(e=>e.name===ym),v=e?.find(e=>e.itemType===ym),S=y?.value?.length??v?.itemValue??0,b=Object.values(I??{}),U=I&&Math.min(...b),w=p(e);return s[f]={seedingBasis:w?JSON.stringify(w):void 0,totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:S,tournamentId:l,eventId:f},t.filter(e=>!i||!g||I[e.drawId]===U).flatMap(e=>{let{matchUpFormat:t,tieFormat:r,timeItems:i,extensions:g,structures:y,drawName:v,drawType:S,drawId:b}=e,{matchUpFormatCounts:U,matchUpsCount:T,avgConfidence:D,pctNoRating:P,avgWTN:N}=tF({eventType:c,matchUps:d,drawId:b}),E=p(i)??w,M=function({extensions:e}){return e?.find(({name:e})=>e===Pm)?.value?.slice(1)}({extensions:g}),R=M?.length??0;return(({positionManipulations:e})=>{e?.forEach(e=>{let{structureId:t,name:r}=e,i=e.drawPositions??[e.drawPosition];o[t]??=[],o[t].push(`${r}: ${i.join("/")}`)})})({positionManipulations:M}),s[f].totalPositionManipulations+=R,s[f].generatedDrawsCount+=1,R>s[f].maxPositionManipulations&&(s[f].maxPositionManipulations=R),y?.filter(e=>(1===e.stageSequence||!n)&&[Ml,El,Rl,Cl].includes(e.stage)).map(e=>{let i=[El,Cl].includes(e.stage)?function(e,t){return e.find(e=>e.structureId===t&&1===e.finishingRound&&e.winningSide)}(d,e.structureId):void 0;e.stage===El&&a.push({eventName:m,drawName:v,structureId:e.structureId});let n=function(e){if(e?.sides)return e.sides.find(t=>t.sideNumber===e.winningSide)}(i)?.participant,o=function(e){return e?.participantType===Uh?e.participantId:void 0}(n),s=function(e){return e?.participantType===Dh?e.individualParticipants??[]:[]}(n),p=ZO({participant:s?.[0]??n,eventType:c}),{personId:g,personOtherId:y,tennisId:w,confidence:R,wtnRating:A}=p||{},C=ZO({participant:s?.[1],eventType:c}),{personId:k,personOtherId:x,tennisId:O,confidence:F,wtnRating:_}=C||{},{ageCategoryCode:L,categoryName:B,subType:$}=h??{},V=e.matchUpFormat??t,j=(U[V]??0)/T*100,{tieFormatName:G,tieFormatDesc:W}=AM(r),{tieFormatName:q,tieFormatDesc:H}=AM(e.tieFormat),z=W===H,Y=!z&&q,K=e.tieFormat&&!z&&H,X=M?.filter((e=>t=>t.structureId===e)(e.structureId))?.length??0;return{...u,tournamentId:l,eventId:f,structureId:e.structureId,drawId:b,eventType:c,category:$,categoryName:B,ageCategoryCode:L,flightNumber:I?.[b],drawType:S,stage:e.stage,seedingBasis:E?JSON.stringify(E):void 0,winningPersonId:g,winningPersonOtherId:y,winningPersonTennisId:w,winningPersonWTNrating:A,winningPersonWTNconfidence:R,winningPerson2Id:k,winningPerson2OtherId:x,winningPerson2TennisId:O,winningPerson2WTNrating:_,winningPerson2WTNconfidence:F,winningTeamId:o,positionManipulations:X,pctNoRating:P,matchUpFormat:V,pctInitialMatchUpFormat:j,matchUpsCount:T,drawTieFormatName:G,drawTieFormatDesc:W,tieFormatName:Y,tieFormatDesc:K,avgConfidence:D,avgWTN:N}})})});return a.forEach(({eventName:e,drawName:t,structureId:r})=>{o[r]?.length&&c.push({eventName:e,drawName:t,actions:o[r]})}),{eventStructureReports:Object.values(s),structureReports:m,flightReports:c}}function iF({ignoreDisabled:e=!0,tournamentRecords:t,tournamentId:r,venueIds:i=[],dates:n=[]}){if(!Array.isArray(n))return{error:Zo,dates:n};if(!Array.isArray(i))return{error:Zo,venueIds:i};if(!(t&&Object.keys(t).filter(e=>!r||e===r)||[]).length)return{error:Qi};if(!n.every(qc))return{error:Ca};let a=DT({tournamentRecords:t,ignoreDisabled:e,dates:n});if(a.error)return a;let o=a?.venues?.filter(({venueId:e})=>!i?.length||i.includes(e)),s=a.courts?.reduce((e,t)=>(t.dateAvailability?.forEach(t=>{let r=t.date;e.includes(r)||e.push(r)}),e),[]).filter(e=>!n.length||n.includes(e)),c={venueIds:o?.map(({venueId:e})=>e)},{matchUps:u}=Fy({afterRecoveryTimes:!0,tournamentRecords:t,matchUpFilters:c});return{venuesReport:o?.map(e=>function(e,t,r){let{venueId:i,courts:n,venueName:a}=t,o={};return e.forEach(e=>{let t=0,a=0,s=0;for(let r of n){let i=r.dateAvailability.find(t=>t.date===e),n=(i&&yC({courtDate:i}).timeSlots)?.reduce((e,t)=>{let{startTime:r,endTime:i}=t;return e+(eu(i)-eu(r))},0);n&&(s+=1),t+=n}let c=r.filter(({schedule:t})=>t.venueId===i&&fu(e,t.scheduledDate));c.forEach(({schedule:e})=>{let t=ru(e.scheduledTime),r=eu(du(t,e.averageMinutes))-eu(t);a+=r});let u=t?(a/t*100).toFixed(2):"100";o[e]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:t,scheduledMinutes:a,percentUtilization:u}}),{venueId:i,venueName:a,venueReport:o}}(s,e,u))}}Br(QO,{getEntryStatusReports:()=>eF,getParticipantStats:()=>JO,getStructureReports:()=>rF,getVenuesReport:()=>iF});var nF={};Br(nF,{addCourtGridBooking:()=>yF,addMatchUpCourtOrder:()=>Ik,addMatchUpEndTime:()=>Sk,addMatchUpOfficial:()=>yk,addMatchUpResumeTime:()=>Uk,addMatchUpScheduleItems:()=>gk,addMatchUpScheduledDate:()=>dk,addMatchUpScheduledTime:()=>uk,addMatchUpStartTime:()=>vk,addMatchUpStopTime:()=>bk,addSchedulingProfileRound:()=>zx,allocateTeamMatchUpCourts:()=>pk,assignMatchUpCourt:()=>fk,assignMatchUpVenue:()=>mk,bulkRescheduleMatchUps:()=>mF,bulkScheduleMatchUps:()=>cx,bulkScheduleTournamentMatchUps:()=>sx,bulkUpdateCourtAssignments:()=>uF,calculateScheduleTimes:()=>oF,clearMatchUpSchedule:()=>gF,clearScheduledMatchUps:()=>lx,courtGridRows:()=>iR,findMatchUpFormatTiming:()=>GM,findVenue:()=>oy,generateBookings:()=>ex,generateVirtualCourts:()=>SC,getMatchUpsToSchedule:()=>jM,getPersonRequests:()=>QM,getProfileRounds:()=>tR,getScheduledRoundsDetails:()=>WM,getSchedulingProfile:()=>zM,getSchedulingProfileIssues:()=>XM,matchUpScheduleChange:()=>hF,modifyMatchUpFormatTiming:()=>MA,mutate:()=>aF,proAutoSchedule:()=>cF,proConflicts:()=>dF,publicFindCourt:()=>uy,query:()=>$M,removeCourtGridBooking:()=>vF,removeEventMatchUpFormatTiming:()=>kA,removeMatchUpCourtAssignment:()=>sF,reorderUpcomingMatchUps:()=>pF,scheduleMatchUps:()=>lF,scheduleProfileRounds:()=>px,setMatchUpDailyLimits:()=>IF,setMatchUpHomeParticipantId:()=>sk,setSchedulingProfile:()=>YM,toggleParticipantCheckInState:()=>xC,validateSchedulingProfile:()=>HM});var aF={};function oF({calculateStartTimeFromCourts:e=!0,defaultRecoveryMinutes:t=0,averageMatchUpMinutes:r=90,remainingScheduleTimes:i,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:c,venueIds:u,endTime:l}){if("object"!=typeof a||!Object.keys(a).length)return{error:Qi};o=o??bC({recoveryMinutes:t,averageMatchUpMinutes:r});let{courts:d,venues:p}=DT({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d?.filter(e=>!u||u.includes(e.venueId));c||(c=m?.reduce((e,t)=>{let r=t.dateAvailability?.find(e=>!e.date||fu(s,e.date))?.startTime??t.startTime;return r&&(!e||eu(r)<eu(e))?r:e},void 0)),l||(l=m?.reduce((e,t)=>{let r=t.dateAvailability?.find(e=>!e.date||fu(s,e.date))?.endTime??t.endTime;return r&&(!e||eu(r)>eu(e))?r:e},void 0));let f=Object.values(a),h=Object.assign({},...f.map(e=>(e.events??[]).map(t=>{let{scheduleTiming:r}=ng({tournamentRecord:e,event:t});return{[t.eventId]:{event:t,scheduleTiming:r}}})).flat()),g=TR({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:u}}),I=g?.dateMatchUps??[],y=g?.completedMatchUps??[],v=[];v.push(...I),v.push(...y);let S={averageTimes:[{minutes:{default:r}}],recoveryTimes:[{minutes:{default:t}}]},b=v?.map(({eventId:e,schedule:t,matchUpFormat:r})=>{let{event:i,scheduleTiming:n}=h[e],a=i?.eventType,s={...n,defaultTiming:S,matchUpFormat:r},{averageMinutes:c,recoveryMinutes:u}=zI({eventType:a,timingDetails:s}),{courtId:l,venueId:d}=t,p=ru(t.scheduledTime),m=du(p,c);return{recoveryMinutes:u,averageMinutes:c,periodLength:o,startTime:p,endTime:m,courtId:l,venueId:d}}),U={calculateStartTimeFromCourts:e,remainingScheduleTimes:i,averageMatchUpMinutes:r,date:s,clearScheduleDates:n,periodLength:o,startTime:c,endTime:l,bookings:b,courts:m},{scheduleTimes:w}=TC(U);return{venueId:1===u?.length&&u[0]||1===p?.length&&p[0].venueId||void 0,scheduleTimes:w,dateScheduledMatchUpIds:v.map(zm)}}function sF(e){let t=Dp(e,[{[Rd]:!0}]);if(t.error)return t;let{removePriorValues:r,tournamentRecords:i,tournamentId:n,courtDayDate:a,matchUpId:o,courtId:s,drawId:c}=e,u=i[n];if(!u)return{error:Ji};let{drawDefinition:l,event:d}=FT({tournamentRecord:u,drawId:c});if(!l)return{error:rn};let p=Aw({drawDefinition:l,event:d,matchUpId:o});if(p.error)return p;if(p?.matchUp?.matchUpType===zr){let{itemValue:e}=KI({timeItems:p.matchUp.timeItems??[],itemType:rI}),t=s&&e.filter(e=>e.courtId!==s);return AC({duplicateValues:!1,removePriorValues:r,tournamentRecord:u,drawDefinition:l,matchUpId:o,timeItem:{itemType:rI,itemValue:t}})}return fk({tournamentRecord:u,drawDefinition:l,courtDayDate:a,courtId:"",matchUpId:o})}function cF({scheduleCompletedMatchUps:e,minCourtGridRows:t=10,tournamentRecords:r,scheduledDate:i,matchUps:n}){if(!_g(n))return{error:Zo};if(n.some(({hasContext:e})=>!e))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Vo};let a=TR({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:t,tournamentRecords:r,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(a.error)return a;let{rows:o}=a,s=[],c=e=>[(e.sides||[]).map(e=>[e.participantId,e.participant?.individualParticipantIds]),(e.potentialParticipants||[]).flat().map(e=>[e.participantId,e.individualParticipantIds])].flat(1/0).filter(Boolean),u=o?.reduce((e,t)=>{let r=[],i=[];Object.values(t).forEach(e=>{if(ti(e)&&(e.matchUpId&&(r.push(e.matchUpId),s.push(e)),e.sides)){let t=c(e);i.push(...t)}});let n=Object.values(t).filter(e=>ti(e)&&!e.matchUpId&&!e.isBlocked);return e.concat({matchUpIds:r,availableCourts:n,rowId:t.rowId,participantIds:i})},[]);n.filter(({matchUpStatus:t})=>t&&"BYE"!==t&&(e||!If.includes(t))).sort(_y);let l=Wy({matchUps:n.concat(s),includeParticipantDependencies:!0,tournamentRecords:r}).matchUpDependencies,d=[],p=[];for(;n.length&&u.length;){let e=u.shift(),t=[];for(;n.length&&e.availableCourts.length;){let r=n.concat(t).map(e=>e.matchUpId),i=n.shift(),a=i?.matchUpId,o=a&&l[a].matchUpIds.concat(l[a].dependentMatchUpIds),s=a&&r.some(e=>l[a].matchUpIds.includes(e)),u=a&&p.some(e=>l[a].dependentMatchUpIds.includes(e)),m=e.matchUpIds.some(e=>o.includes(e)),f=c(i),h=e.participantIds.some(e=>f.includes(e));if(!i||m||s||h||u)i&&t.push(i);else{let t=e.availableCourts.shift();Object.assign(i.schedule,t.schedule),Object.assign(t,i),d.push(i),e.participantIds.push(...f),e.matchUpIds.push(a)}}n.push(...t),p.push(...e.matchUpIds)}return a=cx({tournamentRecords:r,matchUpDetails:d.map(({matchUpId:e,tournamentId:t,schedule:r,drawId:n})=>({tournamentId:t,matchUpId:e,drawId:n,schedule:{...r,scheduledDate:i}}))}),{...a,scheduled:d,notScheduled:n}}function uF(e){let{courtDayDate:t}=e,r=Dp(e,[{courtAssignments:!0,[vp]:hp,[yp]:Da},{[Rd]:!0}]);if(r.error)return r;let i,n=e.courtAssignments.reduce((e,t)=>{let{tournamentId:r}=t;return e[r]||(e[r]=[]),e[r].push(t),e},{});return Object.keys(n).every(r=>{let a=e[Rd][r];if(!a)return i={error:Ji},!1;let o=n[r].reduce((e,t)=>{let{drawId:r}=t;return e[r]||(e[r]=[]),e[r].push(t),e},{});Object.keys(o).every(e=>{let{drawDefinition:r}=my({tournamentRecord:a,drawId:e});return r?(o[e].every(e=>{let{matchUpId:n,courtId:o}=e,s=fk({tournamentRecord:a,drawDefinition:r,courtDayDate:t,matchUpId:n,courtId:o});if(s.success)return s?.success;i={error:Ho}}),!0):(i={error:rn},!1)})}),i||Gi}function lF(e){let{tournamentRecords:t,allDateMatchUpIds:r=[],averageMatchUpMinutes:i=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:c={},matchUpDailyLimits:u={},checkPotentialRequestConflicts:l=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:f,matchUpIds:h,venueIds:g,startTime:I,endTime:y,dryRun:v}=e,S=Dp(e,[{[Rd]:!0,[Wd]:!0},{[gp]:qc,[yp]:Ca,[$d]:!0},{[gp]:e=>!e||!isNaN(e),[dp]:!1,[yp]:Zo,[pp]:!1,[mp]:!1}]);if(S.error)return S;let b=e.competitionMatchUps??Fy({nextMatchUps:!0,tournamentRecords:t}).matchUps??[],U=e.matchUpDependencies??Wy({includeParticipantDependencies:!0,matchUps:b,tournamentRecords:t}).matchUpDependencies;b.forEach(e=>{e.schedule?.scheduledDate&&fu(f,iu(e.schedule.scheduledDate))&&VM({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:c,matchUp:e})});let w=h.map(e=>b.find(t=>t.matchUpId===e)).filter(Boolean),{venueId:T,scheduleTimes:D,dateScheduledMatchUpIds:P}=oF({tournamentRecords:t,remainingScheduleTimes:d,startTime:ru(I),endTime:ru(y),scheduleDate:iu(f),averageMatchUpMinutes:i,clearScheduleDates:p,periodLength:m,venueIds:g}),N={},E=[],M={},R={},A={};b.filter(({matchUpId:e})=>P?.includes(e)).forEach(e=>{Jk({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:e,value:1});let t=e.schedule?.scheduledTime;if(t){M[e.matchUpId]=t;let r=a?.[e.matchUpId];zk({recoveryMinutes:r||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:c,averageMatchUpMinutes:i,matchUpDependencies:U,scheduleTime:t,matchUp:e})}});let C=w.filter(e=>{let t=P?.includes(e.matchUpId),r=["BYE",tf,Zm,Xm,cf,df].includes(e?.matchUpStatus);return!t&&!e.winningSide&&!r}),{matchUpMap:k,overLimitMatchUpIds:x,participantIdsAtLimit:O}=C.reduce((e,t)=>{let{drawId:r,tournamentId:i,matchUpType:n}=t,{participantIdsAtLimit:a,relevantParticipantIds:l}=ox({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:u,matchUp:t});return a?.length?(e.overLimitMatchUpIds.push(t.matchUpId),e.participantIdsAtLimit.push(...a),e):(l.forEach(e=>{Hk({individualParticipantProfiles:s,participantId:e});let t=s[e].counters;t[n]?t[n]+=1:t[n]=1,t[OI]?t[OI]+=1:t[OI]=1}),e.matchUpMap[i]||(e.matchUpMap[i]={}),e.matchUpMap[i][r]?e.matchUpMap[i][r].push(t):e.matchUpMap[i][r]=[t],VM({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:c,matchUp:t}),e)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter(({matchUpId:e})=>!x.includes(e));let F=0,_=D?.length??0,{personRequests:L}=QM({tournamentRecords:t,requestType:Kk});for(;D?.length&&C.length&&F<=_;){F++;let{scheduleTime:e}=D.shift(),t=C.find(t=>{let{matchUpId:u}=t,{dependenciesScheduled:d,remainingDependencies:p}=qk({matchUpScheduleTimes:M,matchUpDependencies:U,allDateMatchUpIds:r,matchUp:t});if(!d)return A[u]||(A[u]=[]),A[u].push({scheduleTime:e,remainingDependencies:p}),!1;let{enoughTime:m}=nx({individualParticipantProfiles:s,matchUpNotBeforeTimes:c,matchUpDependencies:U,scheduleTime:e,matchUp:t});if(!m)return R[u]||(R[u]=[]),R[u].push({scheduleTime:e}),!1;let{conflicts:h}=Qk({potentials:l,averageMatchUpMinutes:i,requestConflicts:N,personRequests:L,scheduleTime:e,scheduleDate:f,matchUp:t});if(h?.length)return!1;let g=a?.[t.matchUpId];return zk({recoveryMinutes:g||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:c,averageMatchUpMinutes:i,matchUpDependencies:U,scheduleTime:e,matchUp:t}),M[t.matchUpId]=e,!0});C=C.filter(({matchUpId:e})=>e!==t?.matchUpId),t||E.push(e)}C.forEach(e=>{Jk({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:e})});let B=[];Object.keys(k).forEach(e=>{let r=t[e];r&&Object.keys(k[e]).forEach(i=>{let{drawDefinition:n}=FT({tournamentRecord:r,drawId:i});n&&k[e][i].forEach(({matchUpId:e})=>{let i=M[e];if(i){let a=i.split(":").map(mu).join(":"),o=`${iu(f)}T${a}`;v?B.push(e):(uk({drawDefinition:n,matchUpId:e,scheduledTime:o}).success&&B.push(e),T&&mk({tournamentRecords:t,tournamentRecord:r,drawDefinition:n,matchUpId:e,venueId:T}))}})})});let $=Wm(C);return{...Gi,requestConflicts:Object.values(N),remainingScheduleTimes:D?.map(({scheduleTime:e})=>e),individualParticipantProfiles:s,matchUpNotBeforeTimes:c,participantIdsAtLimit:O,skippedScheduleTimes:E,overLimitMatchUpIds:x,scheduledMatchUpIds:B,noTimeMatchUpIds:$,recoveryTimeDeferred:R,dependencyDeferred:A}}function dF({tournamentRecords:e,matchUps:t}){if(!_g(t))return{error:pa};if(t.some(({matchUpId:e,hasContext:t})=>e&&!t))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Vo};let r=Ri(1,Math.max(...t.map(({schedule:e})=>e?.courtOrder||1).map(e=>Jr(e)))+1).map(e=>t.filter(t=>Jr(t.schedule?.courtOrder)===e)),i={},n={},a={};r.flat().filter(Boolean).sort(_y).forEach(({schedule:e})=>delete e[WI]);let o=Wy({includeParticipantDependencies:!0,tournamentRecords:e,drawIds:vi(t.map(({drawId:e})=>e))}).matchUpDependencies,s=r.map((e,t)=>e.reduce((e,r)=>{if(!r.matchUpId)return e;let{matchUpId:s,winnerMatchUpId:c,loserMatchUpId:u,schedule:l,sides:d,potentialParticipants:p}=r,m=l?.courtId;i[s]=t,n[m]=[],e.matchUpIds.push(s),a[s]=r;let f=o[s].matchUpIds;f.length&&e.sourceMatchUpIds.push(...f);let h=d?.flatMap(e=>[e.participant?.individualParticipantIds,e.participantId]).flat().filter(Boolean)??[],g=p?.flat().flatMap(({individualParticipantIds:e,participantId:t})=>[e,t]).flat().filter(Boolean)||[];return e.participantIds.push(...g,...h),c&&e.targetMatchUpIds.push(c),u&&e.targetMatchUpIds.push(u),e},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),c=s.map(()=>[]),u=(e,t,r)=>{t.participantIds.filter(t=>e.participantIds.includes(t)).forEach(i=>{let n=t.matchUpIds.concat(e.matchUpIds).filter(e=>o[e].participantIds.includes(i));n.forEach(e=>{((e,t,r)=>{r[e]||(r[e]={}),r[e][VI]||(r[e][VI]=t.filter(t=>t!==e))})(e,n,r)})})},l=e=>{let t={},r=wi(e.participantIds),i=new Set(Object.keys(r).filter(e=>r[e]>1)),n=e.matchUpIds.filter(e=>o[e].participantIds.some(e=>i.has(e)));return n.forEach(e=>{((e,t,r)=>{r[e]||(r[e]={}),r[e][$I]||(r[e][$I]=t.filter(t=>t!==e))})(e,n,t)}),t},d=(e,t,r,o)=>{if(!a[e].schedule[WI]){a[e].schedule[WI]=t,a[e].schedule[BI]=o,c[i[e]].push({matchUpId:e,issueType:r,issueIds:o,issue:t});let s=a[e].schedule.courtId;n[s]||(n[s]=[]),n[s].push({matchUpId:e,issue:t,issueType:r,issueIds:o})}};return s.forEach((e,t)=>{let i=t?s[t-1]:void 0,n=s.slice(t+1),c=l(e),p=(e=>{let t={},r={};return e.forEach(e=>{let{matchUpId:t,schedule:i}=e;if(!t||!i?.courtId||!i?.scheduledDate)return;let n=`${i.courtId}|${i.scheduledDate}`;r[n]||(r[n]=[]),r[n].push(t)}),Object.values(r).forEach(e=>{e.length>1&&e.forEach(r=>{t[r]=e.filter(e=>e!==r)})}),t})(r[t].filter(t=>e.matchUpIds.includes(t.matchUpId)));i&&u(i,e,c),e.matchUpIds.forEach(t=>{let r=o[t].matchUpIds;for(let e of n){let i=e.matchUpIds.filter(e=>r.includes(e));i?.length&&(i.forEach(e=>d(e,jI,_I,[t])),d(t,jI,_I,i))}if(p[t]&&d(t,$I,LI,p[t]),c[t]?.[$I]&&d(t,$I,FI,c[t][$I]),e.sourceMatchUpIds.includes(t)){let r=e.matchUpIds.filter(e=>o[e].matchUpIds.includes(t));d(t,$I,_I,r),e.matchUpIds.filter(e=>o[e].matchUpIds.includes(t)).forEach(e=>d(e,$I,_I,[t]))}let s=i?.matchUpIds?.filter(e=>((e,t)=>o[e].sources.reduce((e,r,i)=>r.includes(t)&&i+1||e,0))(t,e)>1);if(s?.length&&(d(t,GI,_I,s),s.forEach(e=>d(e,GI,_I,[t]))),c[t]?.[VI]&&d(t,VI,FI,c[t][VI]),i?.targetMatchUpIds?.includes(t)){let e=a[t].schedule.courtId,n=r.filter(e=>i.matchUpIds.includes(e));n.some(t=>a[t].schedule.courtId===e)||(n.forEach(e=>d(e,VI,_I,[t])),d(t,VI,_I,n))}})}),{courtIssues:n,rowIssues:c}}function pF(e){let t="reorderUpcomingMatchUps",{tournamentRecords:r}=e;if("object"!=typeof r||!Object.keys(r).length)return ac({result:{error:Qi},stack:t});let{matchUpsContextIds:i,firstToLast:n}=e;if(!i)return ac({result:{error:Da},stack:t});let a=i?.length;if(!a)return{...Gi};let o=0;return i.forEach((e,t)=>{let{tournamentId:s,drawId:c,matchUpId:u}=e,l=t+(n?-1:1);l<0&&(l=a-1),l===a&&(l=0);let d=function({tournamentId:e,scheduledTime:t,matchUpId:i,drawId:n}){let a=r[e],{drawDefinition:o}=FT({tournamentRecord:a,drawId:n});return o?uk({drawDefinition:o,scheduledTime:t,matchUpId:i}):{error:an}}({tournamentId:s,scheduledTime:i[l].schedule.scheduledTime,matchUpId:u,drawId:c});if(!d.success)return d;o++}),o===a?Gi:ac({result:{error:Wo},stack:t})}function mF(e){let{scheduleChange:t,matchUpIds:r,dryRun:i}=e;if(!r||!Array.isArray(r))return{error:la};if("object"!=typeof t)return{error:Zo};let n=yh(e),a=[],o=[];for(let c of Object.values(n)){let e=fF({tournamentRecord:c,scheduleChange:t,matchUpIds:r,dryRun:i});if(e.error)return e;Array.isArray(e.notRescheduled)&&o.push(...e.notRescheduled);let n=Wm(e.notRescheduled),s=[];e.rescheduled?.forEach(e=>{let{matchUpId:t}=e;n.includes(t)&&s.push(t),a.push(e)}),s.length&&(o=e?.notRescheduled?.filter(({matchUpId:e})=>!s.includes(e))||[])}let s=!(!a.length||o.length);return{...Gi,rescheduled:a,notRescheduled:o,allRescheduled:s}}function fF({tournamentRecord:e,scheduleChange:t,matchUpIds:r,dryRun:i}){if(!e)return{error:Ji};if(!r||!Array.isArray(r))return{error:la};if("object"!=typeof t)return{error:Zo};let n=[],a=[],{minutesChange:o,daysChange:s}=t;if(!o&&!s)return{...Gi};if(o&&isNaN(o))return{error:Zo};if(s&&isNaN(s))return{error:Zo};let{matchUps:c}=Oy({matchUpFilters:{matchUpIds:r},tournamentRecord:e}),u=c?.filter(e=>yR({schedule:e.schedule})).filter(e=>(({matchUpStatus:e})=>!If.includes(e))({matchUpStatus:e.matchUpStatus}));if(!u?.length)return{...Gi};let{tournamentInfo:l}=MT({tournamentRecord:e}),{startDate:d,endDate:p}=l,m=u?.reduce((e,t)=>{let{matchUpId:r,drawId:i}=t;return e[i]?e[i].push(r):e[i]=[r],e},{});for(let y of Object.keys(m)){let t=FT({tournamentRecord:e,drawId:y});if(t.error)return t;let c=t.drawDefinition,l=m[y].filter(e=>r.includes(e));for(let e of l)if(e&&c){let t,r,l,m=u.find(t=>t.matchUpId===e)?.schedule,{scheduledTime:f,scheduledDate:h}=m;if(!t&&s&&h){l=nu(iu(h),s),t=new Date(l)<new Date(d)||new Date(l)>new Date(p)}if(o&&f){let e=iu(f),i=eu(ru(f))+o;if(t=i<0||i>1440,!t){let t=du(f,o),i=e&&l||h===e&&e;r=i?`${i}T${t}`:t}}if(t)a.push(e);else{if(!i){if(r){let t=uk({scheduledTime:r,drawDefinition:c,matchUpId:e});if(t.error)return t}if(l){let t=dk({scheduledDate:l,drawDefinition:c,matchUpId:e});if(t.error)return t}}(r||l)&&n.push(e)}}}let f=Oy({matchUpFilters:{matchUpIds:r},tournamentRecord:e}).matchUps??[],h=f.filter(({matchUpId:e})=>n.includes(e)),g=f.filter(({matchUpId:e})=>a.includes(e)),I=h.length&&!g.length;return{...Gi,rescheduled:h,notRescheduled:g,allRescheduled:I}}function hF(e){let t="matchUpScheduleChange",{tournamentRecords:r}=e;if("object"!=typeof r||!Object.keys(r).length)return{error:Qi};let{sourceMatchUpContextIds:i,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=e||{},{drawId:c,matchUpId:u,tournamentId:l}=i||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!u&&!p)return ac({result:{error:Da},stack:t});let{matchUps:f}=Fy({matchUpFilters:{matchUpIds:[u,p].filter(Boolean),drawIds:[c,d].filter(Boolean)},tournamentRecords:e.tournamentRecords}),h=f?.find(({matchUpId:e})=>e===u),g=f?.find(({matchUpId:e})=>e===p),I=0;if(o&&u&&!p){let e=y({tournamentId:l,matchUpId:u,courtId:o,matchUp:h,drawId:c,tournamentRecords:r,sourceCourtId:a,courtDayDate:s});if(e?.success&&I++,e.error)return ac({result:e,stack:t})}else{if(!(a&&o&&u&&p))return{error:Da};{let e=y({tournamentId:l,matchUpId:u,courtId:o,matchUp:h,drawId:c,tournamentRecords:r,sourceCourtId:a,courtDayDate:s});if(e.success&&I++,e.error)return ac({result:e,stack:t,info:"source"});let i=y({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:r,courtDayDate:s});if(i.success&&I++,i.error)return ac({result:i,stack:t,info:"target"})}}return I?Gi:ac({result:{error:qo},stack:t});function y(e){let{tournamentRecords:t,tournamentId:r,matchUp:i,drawId:n}=e,a=t[r],{drawDefinition:o}=FT({tournamentRecord:a,drawId:n});return i.matchUpType===Yr?function({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,sourceCourtId:n,courtDayDate:a,matchUpId:o,matchUp:s,courtId:c}){let u=[c].concat(s.schedule.allocatedCourts.map(({courtId:e})=>e).filter(e=>e!==n));return pk({removePriorValues:e,tournamentRecords:t,tournamentRecord:r,drawDefinition:i,courtDayDate:a,matchUpId:o,courtIds:u})}({...e,tournamentRecord:a,drawDefinition:o}):fk({...e,tournamentRecord:a,drawDefinition:o})}}function gF({scheduleAttributes:e=[rI,iI,tI,aI,cI,uI,pI,dI,lI],tournamentRecord:t,drawDefinition:r,matchUpId:i}){let n=r?Ly({matchUpFilters:{matchUpIds:[i]},inContext:!1,drawDefinition:r}).matchUps?.[0]:Oy({matchUpFilters:{matchUpIds:[i]},tournamentRecord:t,inContext:!1}).matchUps?.[0];if(!n)return{error:da};let a=(n.timeItems??[]).filter(t=>t?.itemType&&!e.includes(t?.itemType));return n.timeItems=a,ch({tournamentId:t.tournamentId,context:"clearMatchUpSchedule",drawDefinition:r,matchUp:n}),{...Gi}}function IF(e){let{tournamentRecord:t,tournamentId:r,dailyLimits:i}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if("object"!=typeof n||!Object.keys(n).length)return{error:Qi};if("object"!=typeof i)return{error:Xo};let a=Object.keys(n).filter(e=>!r||r===e);if(r&&!a.includes(r))return{error:Zo};for(let o of a){let e=n[o],t=em({extension:{name:Em,value:{dailyLimits:i}},element:e});if(t.error)return t}return{...Gi}}function yF(e){let{tournamentRecord:t,disableNotice:r,scheduledDate:i,bookingType:n,courtOrder:a,rowCount:o=1,courtId:s,notes:c}=e;if(!t)return ac({result:{error:Zo},info:"tournamentRecord is required"});if(!s)return{error:Do};if(!i)return ac({result:{error:Zo},info:"scheduledDate is required"});if(!n)return ac({result:{error:Zo},info:"bookingType is required"});if(null==a)return ac({result:{error:Zo},info:"courtOrder is required"});if(!Number.isInteger(a)||a<1)return ac({result:{error:Zo},info:"courtOrder must be a positive integer"});if(!Number.isInteger(o)||o<1)return ac({result:{error:Zo},info:"rowCount must be a positive integer"});let{court:u,venue:l}=cy({tournamentRecord:t,courtId:s});if(!u)return{error:Do};if(!rR({court:u,date:i})){u.dateAvailability||(u.dateAvailability=[]);let e={date:i,bookings:[]};u.dateAvailability.push(e)}let d=rR({court:u,date:i});if(d.bookings)for(let m of d.bookings)if("number"==typeof m.courtOrder){let e=m.courtOrder,t=e+(m.rowCount||1)-1;if(a<=t&&a+o-1>=e)return ac({result:{error:Eo},info:`Booking conflicts with existing booking at rows ${e}-${t}`})}let p={courtOrder:a,rowCount:o,bookingType:n,notes:c,createdAt:(new Date).toISOString()};return d.bookings||(d.bookings=[]),d.bookings.push(p),!r&&l&&Bs({payload:{venue:l,tournamentId:t.tournamentId},topic:Yf,key:l.venueId}),{...Gi,booking:p}}function vF(e){let{tournamentRecord:t,disableNotice:r,scheduledDate:i,courtOrder:n,courtId:a}=e;if(!t)return ac({result:{error:Zo},info:"tournamentRecord is required"});if(!a)return{error:Do};if(!i)return ac({result:{error:Zo},info:"scheduledDate is required"});if(null==n)return ac({result:{error:Zo},info:"courtOrder is required"});let{court:o,venue:s}=cy({tournamentRecord:t,courtId:a});if(!o)return{error:Do};let c=rR({court:o,date:i});if(!c?.bookings)return ac({result:{error:No},info:"No bookings found for this date"});let u=c.bookings.findIndex(e=>e.courtOrder===n);if(-1===u)return ac({result:{error:No},info:`No booking found at row ${n}`});let l=c.bookings.splice(u,1)[0];return!r&&s&&Bs({payload:{venue:s,tournamentId:t.tournamentId},topic:Yf,key:s.venueId}),{...Gi,booking:l}}Br(aF,{addCourtGridBooking:()=>yF,addMatchUpCourtOrder:()=>Ik,addMatchUpEndTime:()=>Sk,addMatchUpOfficial:()=>yk,addMatchUpResumeTime:()=>Uk,addMatchUpScheduleItems:()=>gk,addMatchUpScheduledDate:()=>dk,addMatchUpScheduledTime:()=>uk,addMatchUpStartTime:()=>vk,addMatchUpStopTime:()=>bk,addSchedulingProfileRound:()=>zx,allocateTeamMatchUpCourts:()=>pk,assignMatchUpCourt:()=>fk,assignMatchUpVenue:()=>mk,bulkRescheduleMatchUps:()=>mF,bulkScheduleMatchUps:()=>cx,bulkScheduleTournamentMatchUps:()=>sx,bulkUpdateCourtAssignments:()=>uF,calculateScheduleTimes:()=>oF,clearMatchUpSchedule:()=>gF,clearScheduledMatchUps:()=>lx,findMatchUpFormatTiming:()=>GM,generateBookings:()=>ex,generateVirtualCourts:()=>SC,matchUpScheduleChange:()=>hF,modifyMatchUpFormatTiming:()=>MA,proAutoSchedule:()=>cF,proConflicts:()=>dF,removeCourtGridBooking:()=>vF,removeEventMatchUpFormatTiming:()=>kA,removeMatchUpCourtAssignment:()=>sF,reorderUpcomingMatchUps:()=>pF,scheduleMatchUps:()=>lF,scheduleProfileRounds:()=>px,setMatchUpDailyLimits:()=>IF,setMatchUpHomeParticipantId:()=>sk,setSchedulingProfile:()=>YM,toggleParticipantCheckInState:()=>xC,validateSchedulingProfile:()=>HM});var SF={};Br(SF,{addCollectionDefinition:()=>_F,addCollectionGroup:()=>FF,aggregateTieFormats:()=>VF,compareTieFormats:()=>CM,getTieFormat:()=>FM,modifyCollectionDefinition:()=>NF,modifyTieFormat:()=>$F,mutate:()=>bF,orderCollectionDefinitions:()=>AF,query:()=>RM,removeCollectionDefinition:()=>OF,removeCollectionGroup:()=>MF,tieFormatGenderValidityCheck:()=>Ic,validateCollectionDefinition:()=>Su});var bF={};function UF({drawDefinition:e,structureId:t,matchUpId:r,structure:i,matchUp:n,eventId:a,event:o}){let s,c="getTieFormat";if(t=i?.structureId??t,((r=n?.matchUpId??r)||t)&&!e)return{error:rn};if(a&&o)s=Rg(o);else if(r){if(e&&(!n||!i)){let t=Aw({drawDefinition:e,matchUpId:r});if(t.error)return t;if(t.matchUp?.matchUpType!==zr)return ac({result:{error:fa},stack:c});i||(i=t.structure),n||(n=t.matchUp)}s=Ag({item:n,drawDefinition:e,structure:i,event:o})||Ag({item:i,drawDefinition:e,structure:i,event:o})||Rg(e)||Rg(o)}else if(e&&t){if(!i){let r=wf({drawDefinition:e,structureId:t});if(r.error)return r;i=r?.structure}s=Ag({item:i,drawDefinition:e,structure:i,event:o})||Rg(e)||Rg(o)}else s=Rg(e)||Rg(o);return s?{...Gi,structure:i,tieFormat:s,matchUp:n}:ac({result:{error:ca},stack:c})}function wF({matchUp:e,updateInProgressMatchUps:t}){return!e.winningSide&&![If].includes(e.matchUpStatus)&&(t||e.matchUpStatus!==af&&!qy(e))}function TF({from:e,to:t}){let r=Object.keys(e),i=Ci(r,Object.keys(t)).length===r.length,n=r.filter(r=>e[r]!==t[r]).map(r=>({countChange:t[r]-e[r],collectionId:r})),a=r.every(r=>e[r]===t[r]);return{equivalent:i&&a,matchUpsCountChanges:n}}function DF({check:e,matchUp:t}){let r="",i=[];return{changesArePossible:e.matchUpsCountChanges.every(({collectionId:e,countChange:n})=>{let a=t.tieMatchUps.filter(t=>t.collectionId===e&&t.matchUpStatus===lf).map(Vy("matchUpId")),o=a.length+n>=0||n>0;return!o&&n<0&&(r="Insufficient TO_BE_PLAYED matchUps"),i.push({toBePlayedTieMatchUpIds:a,collectionId:e,countChange:n}),o}),changes:i,cannotChangeReaon:r}}function PF({appliedPolicies:e,drawDefinition:t,auditData:r}){if(!e?.audit?.[km])return;let{extension:i}=lm({name:km,element:t});em({element:t,extension:{value:Array.isArray(i?.value)?i?.value.concat(r):[r],name:km}})}function NF({updateInProgressMatchUps:e=!1,tournamentRecord:t,collectionOrder:r,collectionName:i,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:c,matchUpType:u,structureId:l,matchUpId:d,category:p,eventId:m,gender:f,event:h,collectionValueProfiles:g,collectionValue:I,matchUpValue:y,scoreValue:v,setValue:S}){let b="modifyCollectionDefinition";if(o&&!_c({matchUpFormat:o}))return ac({result:{error:Zo},context:{matchUpFormat:o},stack:b});if(i&&"string"!=typeof i)return ac({result:{error:Zo},context:{collectionName:i},stack:b});if(f&&!Object.values(lc).includes(f))return ac({result:{error:Zo},context:{gender:f},stack:b});if(p&&"object"!=typeof p)return ac({result:{error:Zo},context:{category:p},stack:b});let U={collectionValueProfiles:g,collectionValue:I,matchUpValue:y,scoreValue:v,setValue:S};if(!(Object.values(U).filter(Boolean).length||r||i||o||s||u))return ac({result:{error:Da},stack:b});if(Object.values(U).filter(Boolean).length>1)return ac({info:"Only one value assignment allowed per collectionDefinition",result:{error:Zo},stack:b});let w=UF({drawDefinition:a,structureId:l,matchUpId:d,eventId:m,event:h});if(w.error)return ac({result:w,stack:b});let{matchUp:T,structure:D,tieFormat:P}=w,N=Vw(P),E=P?.collectionDefinitions.find(e=>e.collectionId===c),M=N?.collectionDefinitions.find(e=>e.collectionId===c);if(!E)return ac({info:"source collectionDefinition",result:{error:as},context:{collectionId:c},stack:b});let R=I??y??v??S;if(g?.length){let e=Hi({matchUpCount:s??E?.matchUpCount??0,collectionValueProfiles:g});if(e.errors)return ac({result:{error:Zo},info:e.errors,stack:b})}else if(R&&!gi(R))return ac({result:{error:Zo},info:"value is not an integer",context:{value:R},stack:b});let A=g&&(!E.collectionValueProfiles||(k=E.collectionValueProfiles,x=g,!(Ci(Object.keys(k),Object.keys(x)).length===Object.keys(k).length&&Ci(Object.values(k),Object.values(x)).length===Object.values(k).length))),C=[];var k,x;if((gi(I)&&E.collectionValue!==I||gi(y)&&E.matchUpValue!==y||gi(v)&&E.scoreValue!==v||gi(S)&&E.setValue!==S||A)&&(M.collectionValueProfiles=void 0,M.collectionValue=void 0,M.matchUpValue=void 0,M.scoreValue=void 0,M.setValue=void 0,Object.assign(M,U),C.push({collectionId:c,...nc(U)})),(gi(v)||gi(S))&&M.collectionGroupNumber){let e=M.collectionGroupNumber;N.collectionDefinitions=N.collectionDefinitions.map(t=>{let{collectionGroupNumber:r,...i}=t;return r===e?i:t}),N.collectionGroups=N.collectionGroups.filter(({groupNumber:t})=>t!==e),C.push({collectionId:c,change:"collectionGroupNumber removed"})}let{aggregateValue:O,valueGoal:F}=RR(N),_=nc({aggregateValue:O,valueGoal:F});if((_.aggregateValue!==P?.winCriteria.aggregateValue||_.valueGoal!==P?.winCriteria.valueGoal)&&(N.winCriteria=_,C.push({collectionId:c,winCriteria:_})),gi(r)&&E.collectionOrder!==r&&(M.collectionOrder=r,C.push({collectionId:c,collectionOrder:r})),i&&E.collectionName!==i&&(M.collectionName=i,C.push({collectionId:c,collectionName:i})),o&&E.matchUpFormat!==o&&(M.matchUpFormat=o,C.push({collectionId:c,matchUpFormat:o})),gi(s)&&E.matchUpCount!==s&&(M.matchUpCount=s,C.push({collectionId:c,matchUpCount:s})),u&&E.matchUpType!==u)return ac({result:{error:os},context:{matchUpType:u},stack:b});p&&E.category!==p&&(M.category=p,C.push({collectionId:c,category:p})),f&&E.gender!==f&&(M.gender=f,C.push({collectionId:c,gender:f}));let L=nc(N);if(w=bu({tieFormat:L}),w.error)return ac({result:w,stack:b});if(!C.length)return ac({result:{...Gi,modifications:C}});if(P?.tieFormatName!==n?(L.tieFormatName=n,C.push({tieFormatName:n})):C.length&&(delete L.tieFormatName,C.push("tieFormatName removed: modifications without new tieFormatName")),w=function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:r,structure:i,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:c}){let u="updateTieFormat",l=t?.tournamentId,d=0,p=0,m=0,f=0,h=n?.collectionDefinitions.reduce((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e),{}),g=({tieFormat:e})=>{let t=e?.collectionDefinitions.reduce((e,t)=>(e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e),{});return TF({from:t,to:h}).equivalent},I=UF({drawDefinition:r})?.tieFormat,y=UF({event:s})?.tieFormat;if(s&&a){for(let e of s.drawDefinitions??[])v({drawDefinition:e});s.tieFormat=Vw(n),f+=1}else if(o){if(!o.tieMatchUps)return ac({result:{error:fa},stack:u});let t=wi(o.tieMatchUps?.map(({collectionId:e})=>e)),i=TF({to:h,from:t}),{changes:a,changesArePossible:d,cannotChangeReaon:m}=DF({matchUp:o,check:i});if(i.equivalent){if(!wF({matchUp:o,updateInProgressMatchUps:e}))return ac({result:{error:$a},info:"matchUp is IN_PROGRESS or COMPLETE",stack:u});o.tieFormat=Vw(n),f+=1}else{if(!d)return ac({context:{collectionMap:h,matchUpMap:t},result:{error:na},info:m||"specified changes not possible",stack:u});b({tieFormat:n,matchUp:o,changes:a,uuids:c})}p+=1,ch({eventId:s?.eventId,context:u,drawDefinition:r,tournamentId:l,matchUp:o})}else if(i){let e=S({inheritedTieFormat:I??y,structure:i})?.modifiedMatchUpsCount;e&&(p+=e,d+=1,f+=1);let t=!i.tieFormat||CM({ancestor:i.tieFormat,descendant:n}).different;t&&(i.tieFormat=Vw(n),d+=1,f+=1),(e||t)&&r&&lh({structureIds:[i.structureId],eventId:s?.eventId,drawDefinition:r})}else{if(!r)return{error:rn};v({drawDefinition:r}),r.tieFormat=Vw(n),f+=1}return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:m,modifiedCount:f,...Gi,tieFormat:n};function v({drawDefinition:e}){let t=e.structures||[],r=[];for(let i of t){if(i.tieFormat)continue;let e=S({inheritedTieFormat:y,structure:i})?.modifiedMatchUpsCount;if(e){d+=1,p+=e;let t=i.structureId;r.push(t)}}return lh({structureIds:r,eventId:s?.eventId,drawDefinition:e}),r.length}function S({inheritedTieFormat:i,structure:o}){let s=0,l=Uy({matchUpFilters:{matchUpTypes:[Yr]},structure:o})?.matchUps||[];for(let d of l){let o=wF({matchUp:d,updateInProgressMatchUps:e}),l=!1,p=TF({from:wi(d.tieMatchUps?.map(({collectionId:e})=>e)),to:h});if(p.equivalent)d.tieFormat&&g(d)&&o&&(d.tieFormat=Vw(n),l=!0);else{let{changes:e,changesArePossible:t}=DF({matchUp:d,check:p});if(t&&!d.tieFormat)b({changes:e,matchUp:d,tieFormat:n,uuids:c});else{if(!i)return ac({result:{error:ca},stack:u});(!d.tieFormat||CM({ancestor:i,descendant:d.tieFormat}).different)&&(d.tieFormat=i,l=!0)}}l&&(s+=1,ch({tournamentId:t?.tournamentId,drawDefinition:r,context:u,eventId:a,matchUp:d}))}return{modifiedMatchUpsCount:s}}function b({uuids:e,matchUp:t,tieFormat:i,changes:n}){t.tieFormat=Vw(i);let o=[],s=[];return n.forEach(r=>{if(r.countChange>0){let n=Math.max(0,...t.tieMatchUps.filter(e=>e.collectionId===r.collectionId).map(Vy("collectionPosition"))),a=i.collectionDefinitions.find(e=>e.collectionId===r.collectionId),o=aw({matchUpsLimit:r.countChange,collectionPositionOffset:n,collectionDefinition:a,matchUp:t,uuids:e});s.push(...Nu(o,!1,!0)),m+=s.length,t.tieMatchUps.push(...o)}else{let e=r.toBePlayedTieMatchUpIds.slice(0,Math.abs(r.countChange));console.log("remove",e.length),o.push(...e),t.tieMatchUps=t.tieMatchUps.filter(({matchUpId:t})=>!e.includes(t))}}),s.length&&oh({matchUps:s,drawDefinition:r,tournamentId:l,eventId:a}),o.length&&sh({matchUpIds:o,action:"updateTieFormat",drawDefinition:r,tournamentId:l,eventId:a}),{matchUpIdsRemoved:o,matchUpsAdded:s}}}({tieFormat:L,updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:a,structure:D,eventId:m,matchUp:T,event:h}),!w.error){let{appliedPolicies:e}=zh({tournamentRecord:t});PF({appliedPolicies:e,drawDefinition:a,auditData:nc({collectionDefinition:M,drawId:a?.drawId,action:b,structureId:l,matchUpId:d,eventId:m})})}return ac({result:{...w,modifications:C},stack:b})}function EF({updateInProgressMatchUps:e,originalValueGoal:t,tournamentRecord:r,wasAggregateValue:i,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:c,matchUpId:u,matchUp:l,eventId:d,event:p}){let{aggregateValue:m,valueGoal:f}=RR(c);c.winCriteria=nc({aggregateValue:m,valueGoal:f}),(t&&t!==f||m&&!i)&&(n?c.tieFormatName=n:delete c.tieFormatName);let{targetMatchUps:h}=function({updateInProgressMatchUps:e,drawDefinition:t,structureId:r,structure:i,matchUpId:n,matchUp:a}){let o=[];return n&&a?o=[a]:r&&i?o=Uy({matchUpFilters:{matchUpTypes:[Yr]},structure:i})?.matchUps??[]:t&&(o=Ly({matchUpFilters:{matchUpTypes:[Yr]},drawDefinition:t})?.matchUps??[]),{targetMatchUps:o.filter(t=>!t.winningSide&&t.matchUpStatus!==Zm&&(e||t.matchUpStatus!==af&&!qy(t)))}}({updateInProgressMatchUps:e,drawDefinition:a,structureId:o,structure:s,matchUpId:u,matchUp:l});!function({updateInProgressMatchUps:e,tournamentRecord:t,drawDefinition:r,targetMatchUps:i,tieFormat:n,event:a}){for(let o of i){let i,s=!!o.tieFormat;if(s&&(o.tieFormat=Vw(n)),e){let e=zh({tournamentRecord:t,drawDefinition:r,event:a}).appliedPolicies,n=Ww({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:t,appliedPolicies:e,drawDefinition:r,event:a});if(n.error)return n;i=n.score}s&&!i&&ch({tournamentId:t?.tournamentId,context:"updateTargetTeamMatchUps",eventId:a?.eventId,matchUp:o,drawDefinition:r})}}({updateInProgressMatchUps:e,tournamentRecord:r,targetMatchUps:h,drawDefinition:a,tieFormat:c,event:p});let g=nc(c),I=bu({tieFormat:g});if(I.error)return I;if(d&&p)p.tieFormat=g;else if(u&&l)l.tieFormat=c;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!l||!a)return{error:rn};return lh({drawDefinition:a,eventId:p?.eventId}),{...Gi}}function MF({updateInProgressMatchUps:e=!0,collectionGroupNumber:t,tournamentRecord:r,drawDefinition:i,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:c,event:u}){if(!t)return{error:Da};if(isNaN(t))return{error:Zo};let l="removeCollectionGroup",d=s?void 0:UF({drawDefinition:i,structureId:a,matchUpId:o,eventId:c,event:u});if(d?.error)return ac({result:d,stack:l});let p=d?.structure;s=s??d?.matchUp;let m=d?.tieFormat,f=m?.winCriteria.valueGoal,h=m?.winCriteria.aggregateValue,g=Vw(m);if(d=bu({tieFormat:g}),d.error)return ac({result:d,stack:l});let I=[];if(g.collectionDefinitions=g.collectionDefinitions.map(e=>{let{collectionGroupNumber:r,...i}=e;return r!==t?e:(I.push(e.collectionId),i)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:e})=>e!==t),d=EF({updateInProgressMatchUps:e,originalValueGoal:f,wasAggregateValue:h,tournamentRecord:r,drawDefinition:i,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:c,event:u}),!d.error){let{appliedPolicies:e}=zh({tournamentRecord:r});PF({appliedPolicies:e,drawDefinition:i,auditData:nc({drawId:i?.drawId,collectionGroupNumber:t,action:l,structureId:a,matchUpId:o,eventId:c})})}return ac({result:{...d,modifiedCollectionIds:I},stack:l})}function RF({tieFormat:e,orderMap:t}){let r=Vw(e);return r.collectionDefinitions?.forEach(e=>{let r=t[e.collectionId];r&&(e.collectionOrder=r)}),r.collectionDefinitions?.sort((e,t)=>Ui(e.collectionOrder)-Ui(t.collectionOrder)),r}function AF({tournamentRecord:e,drawDefinition:t,structureId:r,matchUpId:i,orderMap:n,eventId:a,matchUp:o,event:s}){if("object"!=typeof n||!Object.values(n).every(e=>gi(e)))return ac({result:{error:Zo},context:{orderMap:n}});let c=r?wf({drawDefinition:t,structureId:r}):void 0;if(c?.error)return c;let u=c?.structure;if(a&&s?.tieFormat)CF({tournamentRecord:e,event:s,orderMap:n});else if(i){let r=t&&Aw({drawDefinition:t,matchUpId:i});if(r?.error)return r;if(!(o=r.matchUp))return{error:ma};let a=FM({tournamentRecord:e,matchUpId:i,structure:u,drawDefinition:t,event:s})?.tieFormat;o.tieFormat=RF({tieFormat:a,orderMap:n}),ch({tournamentId:e?.tournamentId,eventId:s?.eventId,drawDefinition:t,matchUp:o})}else if(r)if(u?.tieFormat)u.tieFormat=RF({tieFormat:u.tieFormat,orderMap:n}),xF({eventId:s?.eventId,tournamentRecord:e,drawDefinition:t,structure:u,orderMap:n}),lh({drawDefinition:t,structureIds:[u.structureId]});else if(t.tieFormat)kF({structureIds:[r],tournamentRecord:e,drawDefinition:t,orderMap:n,event:s});else{if(!s?.tieFormat)return{error:as};CF({structureIds:[r],tournamentRecord:e,orderMap:n,event:s})}else{if(!t?.tieFormat)return{error:as};kF({tournamentRecord:e,drawDefinition:t,orderMap:n,event:s})}return{...Gi}}function CF({tournamentRecord:e,structureIds:t,orderMap:r,event:i}){let n=RF({tieFormat:i.tieFormat,orderMap:r});t?.length||(i.tieFormat=n);for(let a of i.drawDefinitions??[])kF({tournamentRecord:e,drawDefinition:a,structureIds:t,orderMap:r,event:i})}function kF({tournamentRecord:e,drawDefinition:t,structureIds:r,orderMap:i,event:n}){let a=RF({tieFormat:t.tieFormat??n?.tieFormat,orderMap:i});r?.length||(t.tieFormat=a);let o=[];for(let s of t.structures??[])r?.length&&!r.includes(s.structureId)||((s.tieFormat||r?.includes(s.structureId))&&(s.tieFormat=RF({tieFormat:s.tieFormat??t.tieFormat??n?.tieFormat,orderMap:i})),xF({eventId:n?.eventId,tournamentRecord:e,drawDefinition:t,structure:s,orderMap:i}),o.push(s.structureId));lh({drawDefinition:t,structureIds:o})}function xF({tournamentRecord:e,drawDefinition:t,structure:r,orderMap:i,eventId:n}){let a=Uy({matchUpFilters:{matchUpTypes:[Yr]},structure:r})?.matchUps;for(let o of a)o.tieFormat&&(o.tieFormat=RF({tieFormat:o.tieFormat,orderMap:i}),ch({tournamentId:e?.tournamentId,drawDefinition:t,eventId:n,matchUp:o}))}function OF({updateInProgressMatchUps:e=!0,tieFormatComparison:t,tournamentRecord:r,drawDefinition:i,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:c,matchUp:u,event:l}){let d="removeCollectionDefinition",p=u?void 0:UF({drawDefinition:i,structureId:o,matchUpId:s,eventId:c,event:l});if(p?.error)return ac({result:p,stack:d});let m=p?.structure;u=u??p?.matchUp;let f=p?.tieFormat,h=Vw(f);if(p=bu({tieFormat:h}),p.error)return ac({result:p,stack:d});let g=h?.collectionDefinitions?.find(e=>e.collectionId===a);if(!g)return ac({result:{error:as,collectionId:a}});h.collectionDefinitions=h.collectionDefinitions.filter(e=>e.collectionId!==a),g.collectionGroupNumber&&(h.collectionDefinitions=h.collectionDefinitions.map(e=>{let{collectionGroupNumber:t,...r}=e;return r}),h.collectionGroups=h.collectionGroups.filter(({groupNumber:e})=>e!==g.collectionGroupNumber));let{aggregateValue:I,valueGoal:y}=RR(h);h.winCriteria=nc({aggregateValue:I,valueGoal:y});let v=f?.winCriteria.valueGoal,S=f?.winCriteria.aggregateValue;(v&&v!==y||I&&!S)&&(n?h.tieFormatName=n:delete h.tieFormatName);let b=[];s&&u?b=[u]:o&&m?b=Uy({matchUpFilters:{matchUpTypes:[Yr]},structure:m})?.matchUps??[]:i?b=Ly({matchUpFilters:{matchUpTypes:[Yr]},drawDefinition:i})?.matchUps??[]:l&&(b=xy({matchUpFilters:{matchUpTypes:[Yr]}})?.matchUps??[]);let U=(b||[]).filter(r=>{let i=r.tieMatchUps?.filter(e=>e.collectionId===a)?.some(qy),n=!(!t||!r.tieFormat)&&CM({descendant:r.tieFormat,ancestor:h})?.different;return e&&!i||!r.winningSide&&r.matchUpStatus!==Zm&&(e||r.matchUpStatus!==af&&!qy(r)&&!n)});if(!U.length)return{error:qo};let{appliedPolicies:w}=zh({tournamentRecord:r});if(s&&u&&e){let e=u.tieMatchUps?.filter(e=>e.collectionId===a);for(let t of e??[]){let e=wk({matchUpId:t.matchUpId,tieMatchUpId:u?.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:r,appliedPolicies:w,drawDefinition:i,event:l});if(e.error||(e=Aw({drawDefinition:i,matchUpId:s}),e.error))return e;u=e?.matchUp}}let T=[];for(let P of U){for(let e of P?.sides??[])e.lineUp=(e.lineUp??[]).map(e=>({participantId:e.participantId,collectionAssignments:(e?.collectionAssignments??[]).filter(e=>e.collectionId!==a)}));if(P.tieMatchUps=(P.tieMatchUps??[]).filter(e=>{let t=e.collectionId===a;return t&&T.push(e.matchUpId),!t}),P.tieFormat&&(P.tieFormat=Vw(h)),e){let e=Ww({matchUpId:P.matchUpId,exitWhenNoValues:!0,tournamentRecord:r,appliedPolicies:w,drawDefinition:i,event:l});if(e.error)return e}ch({tournamentId:r?.tournamentId,eventId:l?.eventId,drawDefinition:i,context:d,matchUp:P})}T.length&&sh({tournamentId:r?.tournamentId,matchUpIds:T,eventId:l?.eventId,drawDefinition:i});let D=nc(h);if(p=bu({tieFormat:D}),p.error)return ac({result:p,stack:d});if(c&&l)l.tieFormat=D;else if(s&&u)u.tieFormat=D;else if(m)m.tieFormat=D;else if(i)i.tieFormat=D;else if(!u||!i)return{error:rn};return lh({drawDefinition:i,eventId:l?.eventId}),PF({appliedPolicies:w,drawDefinition:i,auditData:nc({drawId:i?.drawId,action:d,collectionId:a,structureId:o,matchUpId:s,eventId:c})}),{tieFormat:D,deletedMatchUpIds:T,targetMatchUps:U,...Gi}}function FF({updateInProgressMatchUps:e=!0,tournamentRecord:t,groupDefinition:r,drawDefinition:i,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:c,eventId:u,event:l}){let d="addCollectionGroup";if(!Array.isArray(n))return ac({result:{error:Da},stack:d});let p=c?void 0:UF({drawDefinition:i,structureId:o,matchUpId:s,eventId:u,event:l});if(p?.error)return ac({result:p,stack:d});let m=p?.structure;c=c||p?.matchUp;let f=p?.tieFormat,h=f?.winCriteria.valueGoal,g=Vw(f);if(p=bu({tieFormat:g}),p.error)return ac({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:e,collectionGroupNumber:t}=y;if(t&&n.includes(e))return ac({info:"collectionIds cannot be part of other collectionGroups",result:{error:Zo},stack:d})}let I=(g.collectionGroups||[]).reduce((e,t)=>t.groupNumber>e?t.groupNumber:e,0)+1;return r.groupNumber=I,g.collectionDefinitions=g.collectionDefinitions.map(e=>n.includes(e.collectionId)?{...e,collectionGroupNumber:I}:e),g.collectionGroups=[...g.collecitonGroups||[],r],EF({updateInProgressMatchUps:e,originalValueGoal:h,tournamentRecord:t,drawDefinition:i,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:c,eventId:u,event:l})}function _F({updateInProgressMatchUps:e=!0,collectionDefinition:t,referenceCategory:r,tournamentRecord:i,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:c,enforceGender:u,structureId:l,matchUpId:d,matchUp:p,eventId:m,uuids:f,event:h}){let g="addCollectionDefinition",I=zh({tournamentRecord:i,drawDefinition:s,event:h}).appliedPolicies??{},y=n?.[Bp]??I?.[Bp];a=a??y?.participants?.enforceCategory;let v=!1!==(u??y?.participants?.enforceGender),S=!(!(r??h?.category)||!1===a),b=!(!(o??h?.gender)||!v),U=Su({referenceCategory:r??h?.category,collectionDefinition:t,referenceGender:o,checkCategory:S,checkGender:b,event:h});if(U.error)return ac({result:U,stack:g});let w=p?.tieFormat?void 0:UF({drawDefinition:s,structureId:l,matchUpId:d,eventId:m,event:h});if(w?.error)return ac({result:{error:w.error},stack:g});let T=w?.structure;p=p??w?.matchUp;let D=p?.tieFormat??w?.tieFormat,P=Vw(D);if(w=bu({tieFormat:P}),w?.error)return ac({result:{error:w.error},stack:g});if(t.collectionId){if(P.collectionDefinitions.map(({collectionId:e})=>e).includes(t.collectionId))return ac({context:{collectionId:t.collectionId},result:{error:es}})}else t.collectionId=Ru();P.collectionDefinitions.push(t),P.collectionDefinitions.sort((e,t)=>(e.collectionOrder||0)-(t.collectionOrder||0)).forEach((e,t)=>e.collectionOrder=t+1);let{aggregateValue:N,valueGoal:E}=RR(P);P.winCriteria=nc({aggregateValue:N,valueGoal:E});let M=D?.winCriteria.valueGoal,R=D?.winCriteria.aggregateValue;(M&&M!==E||N&&!R)&&(c?P.tieFormatName=c:delete P.tieFormatName);let A=[],C=[],k=[],x=nc(P);if(w=bu({tieFormat:x}),w?.error)return ac({result:{error:w.error},stack:g});if(m&&h){h.tieFormat=x;for(let r of h.drawDefinitions??[])if(!r.tieFormat)for(let i of r.structures??[]){if(i.tieFormat)continue;let r=LF({updateInProgressMatchUps:e,collectionDefinition:t,structure:i,uuids:f});C.push(...r.newMatchUps),k.push(...r.targetMatchUps),A.push(i.structureId)}BF({modifiedMatchUps:k,eventId:h?.eventId,modifiedStructureIds:A,tournamentRecord:i,drawDefinition:s,addedMatchUps:C,stack:g})}else if(l&&T){T.tieFormat=x;let r=LF({updateInProgressMatchUps:e,collectionDefinition:t,structure:T,uuids:f});C.push(...r.newMatchUps),k=r.targetMatchUps,BF({modifiedMatchUps:k,eventId:h?.eventId,modifiedStructureIds:A,tournamentRecord:i,drawDefinition:s,addedMatchUps:C,stack:g})}else if(d&&p){if(!wF({matchUp:p,updateInProgressMatchUps:e}))return ac({result:{error:$a},stack:g});p.tieFormat=x;let r=aw({collectionDefinition:t,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...r),C.push(...r),BF({modifiedMatchUps:[p],eventId:h?.eventId,modifiedStructureIds:A,tournamentRecord:i,drawDefinition:s,addedMatchUps:C,stack:g})}else{if(!s)return{error:rn};s.tieFormat=x;for(let r of s.structures??[]){let i=LF({updateInProgressMatchUps:e,collectionDefinition:t,structure:r,uuids:f});A.push(r.structureId),C.push(...i.newMatchUps),k.push(...i.targetMatchUps)}BF({modifiedMatchUps:k,eventId:h?.eventId,tournamentRecord:i,drawDefinition:s,addedMatchUps:C,stack:g})}return PF({appliedPolicies:I,drawDefinition:s,auditData:nc({drawId:s?.drawId,collectionDefinition:t,action:g,structureId:l,matchUpId:d,eventId:m})}),{tieFormat:x,targetMatchUps:k,addedMatchUps:C,...Gi}}function LF({updateInProgressMatchUps:e,collectionDefinition:t,structure:r,uuids:i}){let n=[],a=(Uy({matchUpFilters:{matchUpTypes:[Yr]},structure:r})?.matchUps).filter(t=>wF({matchUp:t,updateInProgressMatchUps:e})&&!t.tieFormat);for(let o of a){let e=aw({collectionDefinition:t,matchUp:o,uuids:i});Array.isArray(o.tieMatchUps)||(o.tieMatchUps=[]),o.tieMatchUps.push(...e),n.push(...e)}return{newMatchUps:n,targetMatchUps:a}}function BF({modifiedStructureIds:e,tournamentRecord:t,modifiedMatchUps:r,drawDefinition:i,addedMatchUps:n,eventId:a,stack:o}){oh({tournamentId:t?.tournamentId,matchUps:n,drawDefinition:i,eventId:a}),r?.forEach(e=>{ch({tournamentId:t?.tournamentId,drawDefinition:i,context:o,matchUp:e,eventId:a})}),lh({structureIds:e,drawDefinition:i,eventId:a})}function $F({updateInProgressMatchUps:e=!1,tieFormatComparison:t,modifiedTieFormat:r,tournamentRecord:i,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:c,uuids:u,event:l}){let d="modifyTieFormat";if(!bu({tieFormat:r}).valid)return ac({result:{error:na},info:"falied validation",stack:d});let p=UF({drawDefinition:a,structureId:o,matchUpId:s,eventId:c,event:l});if(p.error)return ac({result:p,stack:d});let{matchUp:m,tieFormat:f}=p,h=Vw(f),g=CM({descendant:r,ancestor:h,considerations:n});if(g.invalid)return ac({context:{invalid:g.invalid},result:{error:na},stack:d});if(!g?.different)return ac({result:{...Gi},info:"Nothing to do",stack:d});let I,y=h.collectionDefinitions.map(({collectionId:e})=>e),v=r.collectionDefinitions.map(({collectionId:e})=>e),S=y.filter(e=>!v.includes(e)),b=r.collectionDefinitions.filter(({collectionId:e})=>!y.includes(e)),U=b.map(Vy("collectionId")),w=[],T=r.tieFormatName;for(let D of r.collectionDefinitions){if(U.includes(D.collectionId))continue;let t=NF({updateInProgressMatchUps:e,...D,tournamentRecord:i,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:c,event:l});if(t.modifications&&w.push(...t.modifications),t.error)return ac({result:t,stack:d});t.tieFormat&&(I=t.tieFormat)}for(let D of b){let t=_F({updateInProgressMatchUps:e,collectionDefinition:D,tournamentRecord:i,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:c,uuids:u,event:l});if(t.error)return ac({result:t,stack:d});t.tieFormat&&(I=t.tieFormat)}for(let D of S){let r=OF({updateInProgressMatchUps:e,tieFormatComparison:t,tournamentRecord:i,drawDefinition:a,tieFormatName:T,collectionId:D,structureId:o,matchUpId:s,eventId:c,matchUp:m,event:l});if(r.error)return ac({result:r,stack:d});r.tieFormat&&(I=r.tieFormat)}return f?.tieFormatName!==T?(I.tieFormatName=T,w.push({tieFormatName:T})):(w.length||U.length||S.length)&&(delete I.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),I.collectionDefinitions=I.collectionDefinitions.sort((e,t)=>Ui(e.collectionOrder)-Ui(t.collectionOrder)).map((e,t)=>({...e,collectionOrder:t+1})),{processedTieFormat:Vw(I),modifications:w,...Gi}}function VF({tournamentRecord:e}){if(!e)return{error:Ji};let t=0;for(let r of e.events??[]){let i=r.tieFormats??[],n=e=>{if(!e.tieFormat)return;let r;for(let t of i)CM({descendant:e.tieFormat,ancestor:t}).different||(r=t.tieFormatId);if(r)e.tieFormatId=r,delete e.tieFormat;else{let r=Nu(e.tieFormat,void 0,!0);r.tieFormatId||(r.tieFormatId=Ru()),e.tieFormatId=r.tieFormatId,delete e.tieFormat,i.push(r),t+=1}};r.eventType,n({tieFormat:r.tieFormat});for(let e of r.drawDefinitions??[]){n({tieFormat:e.tieFormat});for(let t of e.structures??[])n({tieFormat:t.tieFormat})}let a=(t,i)=>{let n=s.matchUps?.find(e=>e.matchUpId===t);n&&(n.tieFormatId=i,delete n.tieFormat,ch({tournamentId:e?.tournamentId,eventId:r.eventId,matchUp:n}))},o=e=>{let r=Nu(e.tieFormat,void 0,!0);r.tieFormatId||(r.tieFormatId=Ru()),i.push(r),t+=1,a(e.matchUpId,r.tieFormatId)},s=xy({matchUpFilters:{matchUpTypes:[zr]},event:r}),c=s.matchUps??[];for(let e of c){let t;for(let r of i)e.tieFormat&&CM({descendant:e.tieFormat,ancestor:r}).different||(t=r.tieFormatId);t?a(e.matchUpId,t):o(e)}i.length&&(r.tieFormats=i)}return{...Gi,addedCount:t}}Br(bF,{addCollectionDefinition:()=>_F,addCollectionGroup:()=>FF,aggregateTieFormats:()=>VF,modifyCollectionDefinition:()=>NF,modifyTieFormat:()=>$F,orderCollectionDefinitions:()=>AF,removeCollectionDefinition:()=>OF,removeCollectionGroup:()=>MF});var jF={};Br(jF,{addDrawDefinitionExtension:()=>rm,addEventExtension:()=>im,addEventTimeItem:()=>Qw,addExtension:()=>em,addNotes:()=>Cw,addOnlineResource:()=>QF,addParticipantExtension:()=>nm,addParticipantTimeItem:()=>Kw,addTimeItem:()=>Yw,addTournamentExtension:()=>tm,addTournamentTimeItem:()=>Xw,analyzeDraws:()=>sT,analyzeTournament:()=>DM,copyTournamentRecord:()=>WF,createTournamentRecord:()=>mx,generate:()=>GF,getAggregateTeamResults:()=>wM,getAllowedDrawTypes:()=>yM,getAllowedMatchUpFormats:()=>IM,getAppliedPolicies:()=>zh,getCompetitionDateRange:()=>bM,getCompetitionPenalties:()=>SM,getPolicyDefinitions:()=>Yh,getTournamentInfo:()=>MT,getTournamentPenalties:()=>vM,getTournamentPersons:()=>UM,getTournamentPoints:()=>MM,getTournamentStructures:()=>Gb,getTournamentTimeItem:()=>Lh,hydrateTournamentRecord:()=>HF,mutate:()=>qF,query:()=>gM,removeDrawDefinitionExtension:()=>om,removeEventExtension:()=>sm,removeExtension:()=>Jp,removeNotes:()=>kw,removeOnlineResource:()=>KF,removeParticipantExtension:()=>cm,removeTournamentExtension:()=>am,setTournamentCategories:()=>t_,setTournamentDates:()=>r_,setTournamentEndDate:()=>n_,setTournamentName:()=>ZF,setTournamentNotes:()=>e_,setTournamentStartDate:()=>i_,setTournamentStatus:()=>YF});var GF={};function WF(e){let t=Dp(e,[{tournamentRecord:!0,startDate:!0,endDate:!1,tournamentName:!0}]);if(t.error)return t;let{startDate:r,endDate:i}=e.tournamentRecord,n=(r&&i?new Date(iu(i)).getTime()-new Date(iu(r)).getTime():0)/864e5,a=e.endDate||cu(e.startDate,n),o=t=>t?.filter(({itemType:t})=>e.itemTypeList?.includes(t)),s=t=>t?.filter(({name:t})=>e.extensionList?.includes(t)),c={participants:e.copyParticipants?e.tournamentRecord.participants?.map(e=>{let{timeItems:t,extensions:r,...i}=e;return Nu({...i,timeItems:o(t),extensions:s(r)},!1,!0)})??[]:[],parentOrganisation:Nu({...e.tournamentRecord.parentOrganisation},!1,!0),venues:Nu(e.tournamentRecord.venues??[],!1,!0),extensions:s(e.tournamentRecord.extensions),timeItems:o(e.tournamentRecord.timeItems),events:e.tournamentRecord.events?.map(t=>{let{drawDefinitions:r,timeItems:i,extensions:n,startDate:c,endDate:u,...l}=t;return Nu({extensions:s(n),timeItems:o(i),startDate:e.startDate,endDate:a,...l},!1,!0)})??[],weekdays:[...e.tournamentRecord.weekdays??[]],tournamentName:e.tournamentName,startDate:e.startDate,tournamentId:Ru(),endDate:a};return{...Gi,tournamentRecord:c}}Br(GF,{copyTournamentRecord:()=>WF,createTournamentRecord:()=>mx});var qF={};function HF(e){let{tournamentRecord:t,eventProfiles:r=[],directives:i,policyDefinitions:n}=e;return t?((t.events||[]).forEach(e=>{let t=r.find(t=>t.eventId&&t.eventId===e.eventId);(t?.directives?.hydrateRoundNames||i?.hydrateRoundNames)&&e.drawDefinitions?.forEach(e=>{(t?.policyDefinitions?.[Vp]||n?.[Vp])&&XR({drawDefinition:e,appliedPolicies:n})})}),{tournamentRecord:t}):{error:Ji}}Br(qF,{addDrawDefinitionExtension:()=>rm,addEventExtension:()=>im,addEventTimeItem:()=>Qw,addExtension:()=>em,addNotes:()=>Cw,addOnlineResource:()=>QF,addParticipantExtension:()=>nm,addParticipantTimeItem:()=>Kw,addTimeItem:()=>Yw,addTournamentExtension:()=>tm,addTournamentTimeItem:()=>Xw,hydrateTournamentRecord:()=>HF,removeDrawDefinitionExtension:()=>om,removeEventExtension:()=>sm,removeExtension:()=>Jp,removeNotes:()=>kw,removeOnlineResource:()=>KF,removeParticipantExtension:()=>cm,removeTournamentExtension:()=>am,setTournamentCategories:()=>t_,setTournamentDates:()=>r_,setTournamentEndDate:()=>n_,setTournamentName:()=>ZF,setTournamentNotes:()=>e_,setTournamentStartDate:()=>i_,setTournamentStatus:()=>YF});var zF={ABANDONED:"ABANDONED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};function YF({tournamentRecord:e,status:t}){return e?t&&!Object.keys(zF).includes(t)?{error:Zo,info:"Unknown status"}:(e.tournamentStatus=t,{...Gi}):{error:Ji}}function KF(e){let t=Dp(e,[{tournamentRecord:!0,onlineResource:!0}]);if(t.error)return t;let{tournamentRecord:r,onlineResource:i,organisationId:n,participantId:a,personId:o,courtId:s,venueId:c}=e;if(n){if(r.parentOrganisation?.parentOrganisationId!==n)return ac({result:{error:as}});XF({element:r.parentOrganisation,onlineResource:i})}else if(a||o){let e=(r.participants??[]).find(e=>o&&e.person?.personId===o||e.participantId===a);if(!e)return ac(o?{result:{error:as}}:{result:{error:to}});if(o){if(e.person?.personId!==o)return ac({result:{error:qa}});XF({element:e.person,onlineResource:i})}else XF({element:e,onlineResource:i})}else if(s){let e=(r.venues??[]).filter(e=>!c||e.venueId===c).flatMap(e=>(e.courts??[]).filter(e=>e.courtId===s))?.[0];if(!e)return ac({result:{error:Do}});XF({element:e,onlineResource:i})}else if(c){let e=(r.venues??[]).find(e=>e.venueId===c);if(!e)return ac({result:{error:Ro}});XF({element:e,onlineResource:i})}else XF({element:r,onlineResource:i}),Bs({payload:{parentOrganisation:r.parentOrganisation,onlineResources:r.onlineResources,tournamentId:r.tournamentId},topic:zf});return{...Gi}}function XF({element:e,onlineResource:t}){let r=(e.onlineResources??[]).filter(e=>!(e?.[Uu]===t[Uu]&&e?.[wu]===t[wu]&&e?.[Tu]===t[Tu]));e.onlineResources=r}function QF(e){let t=Dp(e,[{tournamentRecord:!0,onlineResource:!0}]);if(t.error)return t;let{tournamentRecord:r,onlineResource:i,organisationId:n,participantId:a,personId:o,courtId:s,venueId:c}=e;if(n){if(r.parentOrganisation?.parentOrganisationId!==n)return ac({result:{error:as}});JF({element:r.parentOrganisation,onlineResource:i})}else{if(a&&o&&a!==o)return ac({result:{error:qa}});if(a||o){let e=(r.participants??[]).find(e=>o&&e.person?.personId===o||e.participantId===a);if(!e)return ac(o?{result:{error:as}}:{result:{error:to}});if(o){if(e.person?.personId!==o)return ac({result:{error:qa}});JF({element:e.person,onlineResource:i})}else JF({element:e,onlineResource:i})}else if(s){let e=(r.venues??[]).filter(e=>!c||e.venueId===c).flatMap(e=>(e.courts??[]).filter(e=>e.courtId===s))?.[0];if(!e)return ac({result:{error:Do}});JF({element:e,onlineResource:i})}else if(c){let e=(r.venues??[]).find(e=>e.venueId===c);if(!e)return ac({result:{error:Ro}});JF({element:e,onlineResource:i})}else JF({element:r,onlineResource:i}),Bs({payload:{parentOrganisation:r.parentOrganisation,onlineResources:r.onlineResources,tournamentId:r.tournamentId},topic:zf})}return{...Gi}}function JF({element:e,onlineResource:t}){let r=(e.onlineResources??[]).filter(e=>e?.[Du]!==t[Du]&&e?.[Tu]!==t[Tu]);return r.push(t),e.onlineResources=r,{...Gi}}function ZF({tournamentRecord:e,promotionalName:t,tournamentName:r,formalName:i}){if(!e)return{error:Ji};let n=e.tournamentId,a={tournamentId:n};return r&&r!==e.tournamentName&&(e.tournamentName=r,a.tournamentName=r),t&&t!==e.promotionalName&&(e.promotionalName=t,a.promotionalName=t),i&&i!==e.formalName&&(e.formalName=i,a.formalName=i),e.promotionalName===e.tournamentName&&(delete e.promotionalName,a.promotionalName=""),e.formalName===e.tournamentName&&(delete e.formalName,a.formalName=""),Object.keys(a).length>1&&Bs({topic:zf,payload:{parentOrganisation:e.parentOrganisation,tournamentId:n,...a}}),{...Gi}}function e_({tournamentRecord:e,notes:t}){if(!e)return{error:Ji};let r=t?Cw({element:e,notes:t}):kw({element:e});return r.error?r:(Bs({topic:zf,payload:{parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,notes:t??""}}),{...Gi})}function t_({tournamentRecord:e,categories:t}){return e?(t=(t||[]).filter(e=>e.categoryName&&e.type),e.tournamentCategories=t,Bs({topic:zf,payload:{parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,categories:t}}),{...Gi}):{error:Ji}}function r_(e){let t,{tournamentRecord:r,startDate:i,endDate:n,weekdays:a}=e,o=e.activeDates?.filter(Boolean),s=Dp(e,[{tournamentRecord:!0},{[gp]:e=>$c.test(e),[yp]:Ca,startDate:!1,endDate:!1},{[gp]:e=>e.filter(Boolean).every(e=>$c.test(e)),[yp]:Ca,activeDates:!1},{[gp]:FA,weekdays:!1}]);if(s.error)return s;if(n&&i&&new Date(n)<new Date(i))return{error:Zo};if(n&&i&&new Date(i)>new Date(n))return{error:Zo};if(o?.length){let e=i||r.startDate,t=n||r.endDate,a=!e||o.every(t=>new Date(t)>=new Date(e)),s=!t||o.every(e=>new Date(e)<=new Date(t));if(!a||!s)return{error:Ca}}(i&&r.startDate&&new Date(i)>new Date(r.startDate)||n&&r.endDate&&new Date(n)<new Date(r.endDate))&&(t=!0);let c=Xc(r.startDate,r.endDate);i&&(r.startDate=i),n&&(r.endDate=n);let u=Xc(r.startDate,r.endDate),l=c.filter(e=>!u.includes(e)),d=u.filter(e=>!c.includes(e));for(let m of r.events??[])i&&m.startDate&&new Date(m.startDate)<new Date(i)&&(m.startDate=i),n&&m.startDate&&new Date(m.startDate)>new Date(n)&&(m.startDate=i??n),n&&m.endDate&&new Date(m.endDate)>new Date(n)&&(m.endDate=n),i&&m.endDate&&new Date(m.endDate)<new Date(i)&&(m.endDate=n??i);i&&r.endDate&&new Date(i)>new Date(r.endDate)&&(r.endDate=i),n&&r.startDate&&new Date(n)<new Date(r.startDate)&&(r.startDate=n),o&&(r.activeDates=o),a&&(r.weekdays=a);let p=t&&function({tournamentRecord:e}){let t=Oy({tournamentRecord:e}).matchUps??[],r=e.startDate&&new Date(e.startDate),i=e.endDate&&new Date(e.endDate),n=[],a=[];for(let o of t){let{schedule:e,matchUpId:t}=o;if(e&&e.scheduledDate){let o=new Date(e.scheduledDate);(r&&o<r||i&&o>i)&&(a.push(t),n.includes(e.scheduledDate)||n.push(e.scheduledDate))}}return n.length&&!lx({scheduledDates:n,tournamentRecord:e}).clearedScheduleCount?{error:ln}:{unscheduledMatchUpIds:a}}({tournamentRecord:r})?.unscheduledMatchUpIds;return function({tournamentRecord:e}){if(!e)return{error:Ji};let{startDate:t,endDate:r}=e,i=Xc(t,r),n=[];for(let a of e.venues||[])a?.courts?.length&&n.push(...a.courts);for(let a of n){let{startTime:e,endTime:t}=(a.dateAvailability??[]).reduce((e,t)=>{let r=eu(e.startTime),i=eu(e.endTime);return t.startTime&&eu(t.startTime)<r&&(e.startTime=t.startTime),t.endTime&&eu(t.endTime)>i&&(e.endTime=t.endTime),e},{startTime:"08:00",endTime:"18:00"}),r=i.map(r=>a.dateAvailability?.find(e=>e.date===r)??{date:r,startTime:e,endTime:t}),n=a.dateAvailability?.find(e=>!e.date);n&&r.unshift(n),a.dateAvailability=r}}({tournamentRecord:r}),Bs({payload:nc({parentOrganisation:r.parentOrganisation,tournamentId:r.tournamentId,activeDates:o,startDate:i,weekdays:a,endDate:n}),topic:zf}),{...Gi,unscheduledMatchUpIds:p,datesAdded:d,datesRemoved:l}}function i_({tournamentRecord:e,startDate:t}){return t?r_({tournamentRecord:e,startDate:t}):{error:Ca}}function n_({tournamentRecord:e,endDate:t}){return t?r_({tournamentRecord:e,endDate:t}):{error:Ca}}var a_={};Br(a_,{addCourt:()=>Qx,addCourts:()=>Jx,addVenue:()=>ny,deleteCourt:()=>b_,deleteVenue:()=>p_,deleteVenues:()=>m_,disableCourts:()=>f_,disableVenues:()=>g_,enableCourts:()=>y_,enableVenues:()=>S_,generate:()=>o_,generateCourts:()=>gC,getCompetitionVenues:()=>PT,getCourts:()=>GR,getVenuesAndCourts:()=>DT,modifyCourt:()=>w_,modifyCourtAvailability:()=>u_,modifyVenue:()=>P_,mutate:()=>s_,publicFindVenue:()=>sy,query:()=>jR});var o_={};Br(o_,{generateCourts:()=>gC});var s_={};function c_(e){if(!e?.tournamentRecord&&!Array.isArray(e?.venueMatchUps))return{error:Ji};if(!e?.courtId)return{error:Ta};let{scheduleVisibilityFilters:t,tournamentRecord:r,matchUpFilters:i,venueMatchUps:n,courtId:a}=e,{schedulingProfile:o}=zM({tournamentRecord:r});if(Array.isArray(n))return{matchUps:c({matchUps:n,courtId:a})};let{matchUps:s}=Oy({scheduleVisibilityFilters:t,tournamentRecord:r,matchUpFilters:i});return{matchUps:c({matchUps:s,courtId:a})};function c({matchUps:e,courtId:t}){return SR({matchUps:e.filter(e=>{let r=e.schedule?.allocatedCourts?.map(({courtId:e})=>e);return e.schedule?.courtId===t||r?.includes(t)}),schedulingProfile:o})}}function u_({tournamentRecord:e,dateAvailability:t,disableNotice:r,venueMatchUps:i,courtId:n,force:a}){if(!e)return{error:Ji};if(!n)return{error:Ta};let o=iy({dateAvailability:t});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:c}=function(e){let t=0,r=e.reduce((e,t)=>{let{date:r,startTime:i,endTime:n,bookings:a}=t;return e[r]||(e[r]=[]),e[r].push({startTime:i,endTime:n,bookings:a}),e},{}),i=[];return Object.keys(r).forEach(e=>{r[e].sort(ry);let{mergedAvailability:n,mergeCount:a}=function(e){let t,r,i,n=e.length,a=0,o=[];for(;e.length&&n;){let s=e.shift(),{startTime:c,endTime:u,bookings:l}=s;if(n-=1,t)if(lu(uu(r),uu(c),!1)>0){let e={startTime:t,endTime:r};i?.length&&(e.bookings=i),o.push(e),t=c,i=l,r=u}else l&&(i?i.push(l):i=l),r=u,a+=1;else t=c,i=l,r=u}let s={startTime:t,endTime:r};return i?.length&&(s.bookings=i),o.push(s),{mergedAvailability:o,mergeCount:a}}(r[e]);i.push(...n.map(t=>({date:e,...t}))),t+=a}),{updatedDateAvailability:i,totalMergeCount:t}}(t);t=s;let u=cy({tournamentRecord:e,courtId:n});if(u.error)return u;let{court:l,venue:d}=u,{matchUps:p}=c_({tournamentRecord:e,venueMatchUps:i,courtId:n});if(p?.length){let t=zh({tournamentRecord:e})?.appliedPolicies,r=a??t?.[Wp]?.allowDeletionWithScoresPresent?.courts,i=[];i.length&&(r||console.log("throw error: scheduled court matchUps",i.length))}return l&&(l.dateAvailability=t,!r&&d&&Bs({payload:{venue:d,tournamentId:e.tournamentId},topic:Yf,key:d.venueId})),{...Gi,totalMergeCount:c}}function l_({matchUpsCount:e=0}){return{error:fs,info:`Schedule would be deleted from ${e} ${1===e?"matchUp":"matchUps"}; use { force: true }`}}function d_({tournamentRecord:e,drawDefinition:t,matchUpId:r,drawId:i}){let n;if(!r)return{error:ua};if(!t&&!i)return{error:wn};if(!t){if(!e)return{error:Ji};({drawDefinition:t}=my({tournamentRecord:e,drawId:i}))}if(t)({matchUp:n}=Aw({drawDefinition:t,matchUpId:r}));else{if(!e)return{error:Ji};let t=Oy({tournamentRecord:e,inContext:!1}).matchUps??[];({matchUp:n}=Rw({matchUps:t,matchUpId:r}))}return n?(n.timeItems&&n.timeItems.find(e=>[iI,rI].includes(e.itemType))&&(n.timeItems=n.timeItems.filter(({itemType:e})=>![iI,rI].includes(e)),ch({tournamentId:e?.tournamentId,context:"removeCourtAssignment",drawDefinition:t,matchUp:n})),{...Gi}):{error:da}}function p_(e){if("string"!=typeof e?.venueId)return{error:Ao};let{tournamentRecord:t,venueId:r,force:i}=e,n=e.tournamentRecords||t&&{[t.tournamentId]:t}||{};if(!Object.keys(n).length)return{error:Ji};let a=Fy({tournamentRecords:n,contextFilters:{venueIds:[r]}}).matchUps??[],o=zh({tournamentRecord:t})?.appliedPolicies,s=i??o?.[Wp]?.allowDeletionWithScoresPresent?.venues;if(a.length&&!s)return l_({matchUpsCount:a.length});for(let c of Object.values(n)){for(let t of a){let e=d_({matchUpId:t.matchUpId,drawId:t.drawId,tournamentRecord:c});if(e.error)return e}let e;c.venues=(c.venues??[]).filter(t=>t?.venueId!==r||(e=!0,!1)),e&&Bs({payload:{venueId:r,tournamentId:c.tournamentId},topic:_f,key:r})}return KM({tournamentRecords:n}),{...Gi}}function m_({tournamentRecord:e,venueIds:t,force:r}){if(!e)return{error:Ji};if(!Array.isArray(t))return{error:Zo};for(let i of e.venues||[]){let{venueId:n}=i;if(t.includes(n)){let{venueId:t}=i,n=p_({tournamentRecord:e,venueId:t,force:r});if(n.error)return n}}return{...Gi}}function f_(e){let{courtIds:t,dates:r}=e,i=yh(e),n=Dp(e,[{[Rd]:!0,[Zd]:!0}]);if(n.error)return n;for(let a of Object.values(i))h_({tournamentRecord:a,courtIds:t,dates:r});return{...Gi}}function h_({tournamentRecord:e,courtIds:t,dates:r}){let i=!Array.isArray(r)||!r.length||{dates:r},n=e=>em({extension:{value:i,name:fm},creationTime:!1,element:e});for(let a of e.venues||[])for(let e of a.courts||[])if(t?.includes(e.courtId)){let t=n(e);if(t.error)return t}return{...Gi}}function g_(e){let{tournamentRecords:t,tournamentId:r,venueIds:i}=e,n=Dp(e,[{[Rd]:!0,[tp]:!0}]);if(n.error)return n;let a=Object.keys(t).filter(e=>!r||e===r);for(let o of a){I_({tournamentRecord:t[o],venueIds:i})}return{...Gi}}function I_({tournamentRecord:e,venueIds:t}){for(let r of e.venues||[])if(t?.includes(r.venueId)){let e=em({creationTime:!1,element:r,extension:{name:fm,value:!0}});if(e.error)return e}return{...Gi}}function y_(e){let t=yh(e),r=[{[Rd]:!0}];!e.enableAll&&r.push({[Zd]:!0});let i=Dp(e,r);if(i.error)return i;let{enableAll:n,courtIds:a,dates:o}=e;for(let s of Object.values(t))v_({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...Gi}}function v_({tournamentRecord:e,courtIds:t,enableAll:r,dates:i}){for(let n of e.venues||[])for(let e of n.courts||[])if(r||t?.includes(e.courtId))if(Array.isArray(i)){let{extension:t}=lm({element:e,name:fm});if(t){let r=t.value;Array.isArray(r.dates)&&(r.dates=r.dates.filter(e=>!i.includes(e))),em({extension:{name:fm,value:r},creationTime:!1,element:e})}}else Jp({element:e,name:fm});return{...Gi}}function S_(e){let t=yh(e),r=[{[Rd]:!0}];!e.enableAll&&r.push({[tp]:!0});let i=Dp(e,r);if(i.error)return i;let{venueIds:n,enableAll:a}=e;for(let o of Object.values(t))for(let e of o.venues||[])(a||n?.includes(e.venueId))&&Jp({element:e,name:fm});return{...Gi}}function b_(e){let t,r,{courtId:i,disableNotice:n,force:a}=e,o=yh(e),s=Dp(e,[{[Rd]:!0,[ip]:!0}]);if(s.error)return s;for(let c of Object.values(o)){if(r=U_({tournamentRecord:c,disableNotice:n,courtId:i,force:a}),r.error&&r.error!==Do)return r;r.success&&(t=!0)}return t?{...Gi}:r}function U_({tournamentRecord:e,disableNotice:t,courtId:r,force:i}){let n=cy({tournamentRecord:e,courtId:r});if(n.error)return n;let a=n.venue,{matchUps:o}=c_({tournamentRecord:e,courtId:r}),s=zh({tournamentRecord:e})?.appliedPolicies,c=i??s?.[Wp]?.allowDeletionWithScoresPresent?.courts;if(o?.length&&!c)return l_({matchUpsCount:o.length});for(let u of o??[]){let t=d_({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:e});if(t.error)return t}return a&&(a.courts=(a.courts??[]).filter(e=>e.courtId!==r),t||Bs({payload:{venue:a,tournamentId:e.tournamentId},topic:Yf,key:a.venueId})),{...Gi}}function w_(e){let t,{disableNotice:r,modifications:i,courtId:n,force:a,venueMatchUps:o}=e,s=yh(e);if(!Object.keys(s).length)return{error:Qi};for(let c of Object.values(s)){let e=T_({tournamentRecord:c,disableNotice:r,venueMatchUps:o,modifications:i,courtId:n,force:a});if(e?.error)return e;t=!0}return t?{...Gi}:void 0}function T_({tournamentRecord:e,disableNotice:t,venueMatchUps:r,modifications:i,courtId:n,force:a}){if(!e)return{error:Ji};if(!n)return{error:Ta};if(!i||"object"!=typeof i)return{error:Xo};let o=cy({tournamentRecord:e,courtId:n});if(o.error)return o;let{venue:s,court:c}=o,u=Object.keys(Xx()).filter(e=>"courtId"!==e);if(!Object.keys(i).filter(e=>u.includes(e)).length)return{error:is};let l=new Set(u.filter(e=>!["dateAvailability"].includes(e))),d=Object.keys(i).filter(e=>l.has(e));if(c&&d.forEach(e=>Object.assign(c,{[e]:i[e]})),i.dateAvailability){let o=u_({dateAvailability:i.dateAvailability,tournamentRecord:e,venueMatchUps:r,disableNotice:t,courtId:n,force:a});if(o.error)return o}return t||Bs({payload:{venue:s,tournamentId:e.tournamentId},topic:Yf,key:s?.venueId}),{...Gi,court:Nu(c)}}Br(s_,{addCourt:()=>Qx,addCourts:()=>Jx,addVenue:()=>ny,deleteCourt:()=>b_,deleteVenue:()=>p_,deleteVenues:()=>m_,disableCourts:()=>f_,disableVenues:()=>g_,enableCourts:()=>y_,enableVenues:()=>S_,modifyCourt:()=>w_,modifyCourtAvailability:()=>u_,modifyVenue:()=>P_});var D_=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,defaultStartTime:void 0,defaultEndTime:void 0,dateAvailability:[],addresses:[],contacts:[],courts:[],roles:[]});function P_(e){let t,r,{modifications:i,venueId:n,force:a}=e,o=yh(e);if(!Object.keys(o).length)return{error:Qi};if("string"!=typeof n)return{error:Ao};for(let s of Object.values(o)){let e=N_({tournamentRecord:s,modifications:i,venueId:n,force:a});if(e.success&&(r=!0),e.error&&(t=e.error),e.error&&e.error!==Ro)return e}return KM({tournamentRecords:o}),r?{...Gi}:{error:t}}function N_({tournamentRecord:e,modifications:t,venueId:r,force:i}){if(!e)return{error:Ji};if(!t||"object"!=typeof t)return{error:Xo};if(!r)return{error:Ao};let n=zh({tournamentRecord:e})?.appliedPolicies,a=i??n?.[Wp]?.allowDeletionWithScoresPresent?.venues,{matchUps:o}=function({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:r,venueId:i}){if(!t)return{error:Ji};if(!i)return{error:Ao};let{schedulingProfile:n}=zM({tournamentRecord:t}),{matchUps:a}=Oy({scheduleVisibilityFilters:e,tournamentRecord:t,matchUpFilters:r});return{matchUps:function({matchUps:e,venueId:t}){return SR({matchUps:e.filter(e=>{let r=e.schedule?.allocatedCourts?.map(({venueId:e})=>e);return e.schedule?.venueId===t||r?.includes(t)}),schedulingProfile:n})}({matchUps:a,venueId:i})}}({tournamentRecord:e,venueId:r}),s=oy({tournamentRecord:e,venueId:r});if(s.error)return s;let c=s.venue,u=Object.keys(D_()).filter(e=>"venueId"!==e);if(!Object.keys(t).filter(e=>u.includes(e)).length)return{error:is};let l=new Set(u.filter(e=>!["courts","onlineResources","dateAvailability"].includes(e))),d=Object.keys(t).filter(e=>l.has(e));if(!c)return{error:Ro};let p=t.defaultStartTime??c.defaultStartTime,m=t.defaultEndTime??c.defaultEndTime;if(p||m){if(!p||!m)return{error:Zo,info:"both defaultStartTime and defaultEndTime are required"};if(!ty({startTime:p,endTime:m}))return{error:Zo,info:"defaultEndTime must be after defaultStartTime"}}if(d.forEach(e=>Object.assign(c,{[e]:t[e]})),void 0!==t.dateAvailability){if(Array.isArray(t.dateAvailability)&&t.dateAvailability.length){let e=iy({dateAvailability:t.dateAvailability});if(e.error)return e}c.dateAvailability=t.dateAvailability}let f=function({venue:e,modifications:t,tournamentRecord:r,venueMatchUps:i,allowModificationWhenMatchUpsScheduled:n}){let a=e?.courts?.map(e=>e.courtId)??[],o=t.courts?.map(e=>e.courtId)||[],s=o.length?a.filter(e=>!o.includes(e)):t?.courts&&a,c=[];if(s?.length){let t=e?.courts?.filter(e=>s.includes(e.courtId))?.map(e=>{let t=c_({courtId:e.courtId,tournamentRecord:r,venueMatchUps:i});for(let r of t.matchUps??[])c.push({matchUpId:r.matchUpId,drawId:r.drawId});return t.matchUps?.length??0}).reduce((e,t)=>e+t);return!e||t&&!n?l_({matchUpsCount:t}):(e.courts=e.courts?.filter(e=>o.includes(e.courtId)),sx({schedule:{courtId:"",scheduledDate:""},matchUpDetails:c,removePriorValues:!0,tournamentRecord:r}),{success:!0})}return{success:!0}}({venue:c,modifications:t,tournamentRecord:e,venueMatchUps:o,allowModificationWhenMatchUpsScheduled:a});if("error"in f&&f.error)return f;let h=function({modifications:e,tournamentRecord:t,venueMatchUps:r,venueId:i,force:n}){if(e.courts)for(let a of e.courts){let{courtId:e}=a||{},o=w_({modifications:a,disableNotice:!0,tournamentRecord:t,venueMatchUps:r,courtId:e,force:n});if(o?.error===Do&&(o=Qx({disableNotice:!0,tournamentRecord:t,venueId:i,court:a})),o?.error)return o}return{success:!0}}({modifications:t,tournamentRecord:e,venueMatchUps:o,venueId:r,force:i});return h?.error?h:(KM({tournamentRecord:e}),c&&Bs({payload:{venue:c,tournamentId:e.tournamentId},topic:Yf,key:c?.venueId}),{...Gi,venue:Nu(c)})}var E_={};function M_({scheduledMatchUps:e,showGlobalLog:t}){Jy.length=0;let r=e?.reduce((e,{structureId:t})=>e.includes(t)?e:e.concat(t),[]),i=Array.isArray(r)&&{...r.map(t=>{let{structureName:r,matchUpType:i}=e.find(e=>e.structureId===t);return{[t]:`${r} ${i}`}})};r?.forEach(t=>{Zy({color:"blue",method:"draw",structure:i[t],keyColors:{structure:"magenta"}},!0);let r=e.filter(e=>e.structureId===t),n=Lg({matchUps:r})?.roundMatchUps||[];Object.keys(n).forEach(e=>{Zy({roundNumber:e,keyColors:{roundNumber:"brightcyan"}},!0),n[e].forEach(({matchUpId:e,schedule:t})=>{Zy({matchUpId:e,time:ru(t.scheduledTime),date:t.scheduledDate,venue:t.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),t&&ev()}Br(E_,{JSON2CSV:()=>O_,UUID:()=>Ru,UUIDS:()=>Mu,allNumeric:()=>Bi,attributeFilter:()=>xp,chunkArray:()=>_i,chunkByNth:()=>Vi,chunkSizeProfile:()=>Li,constantToString:()=>eb,countValues:()=>Ti,createMap:()=>ii,dateTime:()=>hu,definedAttributes:()=>nc,dehydrateMatchUps:()=>k_,extractAttributes:()=>$y,flattenJSON:()=>F_,generateDateRange:()=>Xc,generateHashCode:()=>si,generateRange:()=>Ri,generateTimeCode:()=>dO,groupValues:()=>Di,hasAttributeValues:()=>ni,instanceCount:()=>wi,intersection:()=>Ci,isConvertableInteger:()=>gi,isNumeric:()=>pi,isOdd:()=>mi,isPowerOf2:()=>ci,makeDeepCopy:()=>Nu,matchUpScheduleSort:()=>C_,matchUpSort:()=>_y,nearestPowerOf2:()=>di,nextPowerOf2:()=>fi,noNulls:()=>Si,noNumeric:()=>$i,numericSort:()=>Qr,occurrences:()=>Oi,overlap:()=>xi,randomMember:()=>Mi,randomPop:()=>Ei,shuffleArray:()=>bi,structureSort:()=>bf,subSort:()=>Fi,undefinedToNull:()=>ai,unique:()=>vi,visualizeScheduledMatchUps:()=>M_});var{extractTime:R_,timeStringMinutes:A_}=hu;function C_(e,t){let r=e.schedule??{},i=t.schedule??{};if(r.scheduledDate&&!i.scheduledDate)return 1;if(i.scheduledDate&&!r.scheduledDate)return-1;if(r.scheduledDate&&i.scheduledDate){if(r.scheduledDate===i.scheduledDate){if(r.scheduledTime&&!i.scheduledTime)return 1;if(i.scheduledTime&&!r.scheduledTime)return-1;if(r.scheduledTime&&i.scheduledTime){return A_(R_(r.scheduledTime))-A_(R_(i.scheduledTime))}}return new Date(r.scheduledDate).getTime()-new Date(i.scheduledDate).getTime()}return 0}function k_({tournamentRecord:e}){if(!e)return{error:Ji};if("object"!=typeof e||!e.tournamentId)return{error:Zo};let{matchUps:t}=Oy({tournamentRecord:e,inContext:!1});if(t?.length){let r=function({tournamentRecord:e}){let t={};for(let r of e.events||[]){r.matchUpFormat&&(t[r.eventId]=r.matchUpFormat);for(let e of r.drawDefinitions||[]){e.matchUpFormat&&(t[e.drawId]=e.matchUpFormat);for(let r of e.structures||[]){r.matchUpFormat&&(t[r.structureId]=r.matchUpFormat);for(let e of r.structures||[])e.matchUpFormat&&(t[e.structureId]=e.matchUpFormat)}}}return t}({tournamentRecord:e});!function(e,t={}){for(let r of e){let{structureId:e,drawId:i,eventId:n}=r,a=t[e]||t[i]||t[n],o=r.matchUpFormat===a?void 0:r.matchUpFormat;for(let t of Object.keys(r))x_.includes(t)||delete r[t];r.sides&&r.drawPositions&&!r.tieMatchUps&&delete r.sides,o&&(r.matchUpFormat=o)}}(t,r)}return{...Gi}}var x_=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function O_(e,t){if(t&&"object"!=typeof t)return{error:Zo};let{columnTransform:r={}}=t||{},{includeTransformAccessors:i,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:c=[],functionMap:u={},columnMap:l={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:f=",",rowJoiner:h="\r\n",keyJoiner:g="."}=t||{};if(!Array.isArray(e)||!Array.isArray(c)||"object"!=typeof p||"object"!=typeof l||"object"!=typeof r||"object"!=typeof u||"object"!=typeof d||"string"!=typeof f||"string"!=typeof h||"string"!=typeof g||"string"!=typeof m)return{error:Zo};r=Object.assign({},...Object.keys(r).reverse().map(e=>({[e]:Array.isArray(r[e])?r[e]:["string"==typeof r[e]&&r[e]].filter(Boolean)})));let I=e.filter(Boolean).map(e=>F_(e,g)),y=Object.values(r).flat();i&&c.push(...y);let v=I.reduce((e,t)=>Object.keys(t).every(t=>!e.includes(t)&&e.push(t)||!0)&&e,[]).filter(e=>!c?.length||c.includes(e)),S=Object.assign({},...Object.keys(r).reverse().map(e=>r[e].map(t=>({[t]:e})).flat()).flat()),b=v.reduce((e,t)=>{let r=S[t];return r?e.includes(r)||e.push(r):e.push(t),e},[]).sort((e,r)=>t?.sortOrder?t.sortOrder.includes(e)&&t.sortOrder.includes(r)&&t.sortOrder.indexOf(e)-t.sortOrder.indexOf(r)||!t.sortOrder.includes(r)&&-1:0);Object.keys(l).forEach(e=>!b.includes(e)&&b.unshift(e)),Object.keys(r).forEach(e=>!b.includes(e)&&b.unshift(e)),"object"==typeof p&&Object.keys(p).forEach(e=>!b.includes(e)&&b.unshift(e));let U=b.map(e=>l[e]||e);if(s)return[U];let w=e=>`${m}${e}${m}`,T=[],D=I.map(e=>Object.values(b.reduce((t,i,n)=>{let a=r[i],o=(a?.length?e[a.find(t=>e[t])]:e[i])||p?.[i]||"",s=d[i]?.[o]||o,c=Zr(u[i])?u[i](s):s;return t[i]=w(c),c&&(T[n]=(T[n]||0)+1),t},{}))),P=o&&[...T].map((e,t)=>!e&&t).filter(pi).reverse();if(P){let e=e=>e.filter((e,t)=>!P.includes(t));D=D.map(e),U=e(U)}let N=D.map(e=>e.join(f));return a?N.map(e=>{let t=e.split(f);return Object.assign({},...t.map((e,t)=>({[U[t]]:e})))}):n?[U.map(w).join(f),...N].join(h):N.join(h)}function F_(e,t=".",r=[]){return"object"==typeof e&&Object.keys(e).reduce((i,n)=>"object"!=typeof e[n]?(i[r.concat(n).join(t)]=e[n],i):Object.assign(i,F_(e[n],t,r.concat(n))),{})}var{FACTORY:__}=xm;function L_({timeStamp:e}){let t=Ks(),r=Ls();return r&&Object.values(t).forEach(t=>{!function({tournamentRecord:e,value:t}){let{extension:r}=lm({element:e,name:__});em({element:e,extension:{name:__,value:{...r?.value,...t}}})}({tournamentRecord:t,value:{version:"2.4.3",timeStamp:e}})}),r}function B_({engineType:e,methodName:t,elapsed:r,params:i,result:n}){let a=Ps();if("object"!=typeof a)return;let o={method:t},s=n?.error&&(!0===a.errors||Array.isArray(a.errors)&&a.errors.includes(t)),c=Array.isArray(a.params)&&a.params?.includes(t),u=a.params&&!Array.isArray(a.params)||c,l=Array.isArray(a.exclude)&&a.exclude.includes(t);!l&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&r>=a.perf&&(o.elapsed=r),!l&&(s||u)&&(o.params=i),!l&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||c)||Array.isArray(a.result)&&a.result?.includes(t))&&(o.result=n),Object.keys(o).length>1&&rc(o,e)}function $_({methodName:e,params:t,start:r}){let i={error:ms,methodName:e};return B_({result:i,methodName:e,elapsed:r?Date.now()-r:0,params:t,engineType:"sync"}),i}function V_(e,t,r,i,n){delete e.success,delete e.error;let a=Date.now(),o=zs();r&&(r.activeTournamentId=o);let s=r?.tournamentRecord||Ys(o),c="object"==typeof r?.tournamentRecord&&{[r?.tournamentRecord.tournamentId]:r.tournamentRecord}||Ks(),u=r?Nu(r,void 0,!0):void 0,l=r?function(e,t){if(!1===t._middleware)return t;if(t.tournamentId&&!e[t.tournamentId])return{error:Ji};let r=t.drawId||t.matchUp?.drawId;if(r){let{event:i,drawDefinition:n,tournamentId:a}=my({tournamentRecords:e,drawId:r});n&&(t.drawDefinition=n),a&&(t.tournamentId=a),i&&(t.event=i)}if(t.eventId&&!t.event){let{event:r,tournamentId:i}=my({eventId:t.eventId,tournamentRecords:e});if(!r)return{error:Gn};t.tournamentId=i,t.event=r}let i=t.tournamentId??zs();if(!i&&t)return t;let n=e[i];return i&&!n?{error:Ji}:(n&&(t.tournamentRecord=n),t)}(c,r):void 0;if(l?.error)return l;let d=function({tournamentRecords:e,tournamentRecord:t,params:r,methodName:i,method:n}){if(Ps())return n({tournamentRecords:e,tournamentRecord:t,...r});try{return n({tournamentRecords:e,tournamentRecord:t,...r})}catch(a){return tc({engineName:"engine",methodName:i,params:r,err:a})}}({params:l,tournamentRecords:c,tournamentRecord:s,methodName:i,method:t});return B_({result:d,methodName:i,elapsed:Date.now()-a,params:u,engineType:n}),d}function j_(e){let{mutationStatus:t,tournamentId:r,directives:i,timeStamp:n}=e||{},{topics:a}=Ws();for(let o of[...a].sort(W_)){let e=Vs({topic:o});e?.length&&Hs({topic:o,notices:e})}t&&n&&a.includes(Kf)&&Hs({notices:[{tournamentId:r,directives:i,timeStamp:n}],topic:Kf})}var G_={[th]:5,[eh]:5,[rh]:5,[Hf]:5,[qf]:5,[$f]:5,[Vf]:5,[jf]:5,[Gf]:1,[ih]:1,[Wf]:5,[Yf]:5,[Bf]:4,[Ff]:4,[_f]:4,[Lf]:4,[Mf]:3,[Ef]:2};function W_(e,t){return(G_[t]||0)-(G_[e]||0)}function q_(e,t=!0){return"object"!=typeof e||Array.isArray(e)?{error:Xo}:e?.tournamentId?Xs(t?Nu(e):e):{error:Zo}}function H_(e,t=!0){if("object"!=typeof e)return{error:Xo};if(Js(),Array.isArray(e)){if(e.filter(e=>e?.tournamentId).length!==e.length)return{error:Xi};e=Object.assign({},...e.map(e=>({[e.tournamentId]:e})))}else if(e?.tournamentId)Js((e={[e.tournamentId]:e}).tournamentId);else if(!Object.keys(e).every(t=>e[t].tournamentId===t))return{error:Xi};return Qs(t?Nu(e):e)}function z_(e,t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function Y_(e,t){e.importMethods=(r,i,n,a)=>function(e,t,r,i,n,a){let o=ic(r,i,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(e=>Zr(s[e])).forEach(r=>{e[r]=i=>{let n=()=>t(e,{[r]:s[r],...i});if(Ps())return n();try{return n()}catch(a){tc({engineName:"engine",methodName:r,params:i,err:a})}}}),{...Gi,...e}}(e,t,r,i,n,a),e.getTournament=e=>function(e){let{convertExtensions:t=!1,removeExtensions:r=!1}=e??{},i=e?.tournamentId??zs();return"string"!=typeof i?{}:{tournamentRecord:Nu(Ys(i),t,!1,r)}}(e),e.getState=e=>function({convertExtensions:e,removeExtensions:t}){let r=Ks();return{tournamentId:zs(),tournamentRecords:Nu(r,e,!1,t)}}({convertExtensions:e?.convertExtensions,removeExtensions:e?.removeExtensions}),e.version=()=>"2.4.3",e.reset=()=>(Qs({}),z_(e)),e.devContext=t=>(Ms(t),z_(e)),e.getDevContext=e=>Ps(e),e.newTournamentRecord=(e={})=>{let t=mx(e),r=t.tournamentId;return t.error?t:(q_(t),Js(r),{...Gi,tournamentId:r})},e.setState=(t,r,i)=>{Cs(r,i);let n=H_(t,r);return z_(e,n)},e.setTournamentId=e=>Js(e),e.getTournamentId=()=>zs(),e.setTournamentRecord=(t,r,i)=>{Cs(r,i);let n=q_(t,r);return z_(e,n)},e.removeTournamentRecord=t=>{let r=Zs(t);return z_(e,r)},e.removeUnlinkedTournamentRecords=()=>{let t=function(){let e=Ks(),{extension:t}=lm({name:wm,tournamentRecords:e,discover:!0}),r=t?.value?.tournamentIds||[];return Object.keys(e).forEach(t=>{r.includes(t)||delete e[t]}),Qs(e)}();return z_(e,t)}}function K_(e,t){if(!ti(t))return{error:Zo,message:"args must be an object"};let r=Object.values(t).filter(Zr).length;if(r>1)return{message:"there must be only one arg with typeof function",error:Zo};let i=r?Object.keys(t).find(e=>Zr(t[e])):ei(t.method)&&t.method;if(!i)return{error:ms};let{[i]:n,...a}=t,o=t?.params?{...t.params}:{...a},s=o.rollbackOnError&&Nu(Ks(),!1,!0),c=n||e[i]||Ss()[i];if(!c)return $_({methodName:i,params:o});let u=V_(e,c,o,i,"sync")??{};u?.error&&s&&H_(s);let l=Date.now(),d=L_({timeStamp:l}),p=u?.success&&!0!==o?.delayNotify&&!0!==o?.doNotNotify;return p&&j_({directives:[{method:c,params:o}],mutationStatus:d,timeStamp:l}),(p||!u?.success||o?.doNotNotify)&&Gs(),u}var X_=(()=>{let e={executionQueue:(t,r)=>function(e,t,r){if(!Array.isArray(t))return{error:Zo,message:"directives must be an array"};let i=$s(),n=Date.now(),a=r&&Nu(Ks(),!1,!0),o=[];for(let c of t){if("object"!=typeof c)return{error:Zo,message:"directive must be an object"};if(c.params&&"object"!=typeof c.params)return{error:Zo,message:"params must be an object"};let{method:t,pipe:r}=c,s=c.params?{...c.params}:{};if(!i[t])return $_({methodName:t,start:n,params:s});if(r){let e=o.at(-1),t=Object.keys(r);for(let r of t)e[r]&&(s[r]=e[r])}let u=V_(e,i[t],s,t,"sync");if(u?.error)return a&&H_(a),{...u,rolledBack:!!a};o.push({...u,methodName:t})}let s=Date.now();return j_({directives:t,mutationStatus:L_({timeStamp:s}),timeStamp:s}),Gs(),{success:o.every(e=>e.success),results:o}}(e,t,r),execute:t=>K_(e,t)};return Y_(e,K_),e})(),Q_=X_;function J_(e,t){if(!ti(t))return{error:Zo,message:"args must be an object"};let r=Object.values(t).filter(Zr).length;if(r>1)return{message:"there must be only one arg with typeof function",error:Zo};let i=r?Object.keys(t).find(e=>Zr(t[e])):ei(t.method)&&t.method;if(!i)return{error:ms};let{[i]:n,...a}=t,o=t?.params?{...t.params}:{...a},s=n||e[i]||Ss()[i];return s?V_(e,s,o,i,"ask"):$_({methodName:i,params:o})}(()=>{let e={execute:t=>J_(e,t)};Y_(e,J_)})();var Z_,eL={};function tL(e,t=!0){if(!e)return{error:Da};if("object"!=typeof e)return{error:Xo};if(e.matchUpId)Z_=e.matchUpId,eL[Z_]=t?Nu(e):e;else if(Array.isArray(e))for(let r of e.reverse())r.matchUpId&&(eL[r.matchUpId]=t?Nu(r):r,Z_||(Z_=r.matchUpId));else for(let r of Object.values(e))r.matchUpId&&(eL[r.matchUpId]=t?Nu(r):r,Z_||(Z_=r.matchUpId));return t?Nu(e):e}function rL(e,{params:t,governor:r,methodName:i}){e.error=void 0,e.success=!1;let n=t?.matchUp||eL[Z_],a=t?.matchUps||Object.values(eL),o=t?.rollbackOnError&&Nu(n,!1,!0);t={...t,matchUpId:n?.matchUpId,matchUps:a,matchUp:n};let s=r[i](t);if(s?.error)return o&&tL(o),{...s,rolledBack:!!o};let c=s?.success&&!0!==t?.delayNotify&&!0!==t?.doNotNotify;return c&&j_(),(c||!s?.success||t?.doNotNotify)&&Gs(),s}(()=>{let e={getState:e=>function(e){return Nu(eL[Z_],e?.convertExtensions,!1,e?.removeExtensions)}(e),version:()=>"2.4.3",reset:()=>(Z_=void 0,eL={},{...Gi}),drawId:void 0,error:void 0,success:!1,devContext:t=>(Ms(t),e),setState:(t,r,i)=>(Cs(r,i),function(t){return t?.error?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,e.drawId=t.drawId),e}(tL(t)))};(function(e,t){t.forEach(t=>{Object.keys(t).forEach(r=>{e[r]=i=>{if(Ps())return rL(e,{params:i,governor:t,methodName:r});try{return rL(e,{params:i,governor:t,methodName:r})}catch(n){tc({engineName:"matchUpEngine",methodName:r,params:i,err:n})}}})})})(e,[ZD])})();var iL=!1,nL=(()=>{let e={version:()=>"2.4.3",setDeepCopy:(t,r)=>(Cs(t,r),e),devContext:t=>(Ms(t),iL=!0,e)};return[jk].forEach(r=>{Object.keys(r).forEach(i=>{e[i]=function(e,r){return i=>{if(Ps()){let n=t(e[r],i);return!n?.error&&i?.setState&&n?.tournamentRecord&&H_(n.tournamentRecord),n}try{let n=t(e[r],i);return!n?.error&&i?.setState&&n?.tournamentRecord&&H_(n.tournamentRecord),n}catch(n){let e;"string"==typeof n?e=n.toUpperCase():n instanceof Error&&(e=n.message),console.log("ERROR",{params:JSON.stringify(i),method:r,error:e})}}}(r,i)})}),e;function t(e,t){let r=e({...t});return r?.error||j_(),Gs(),iL&&(Ms(!1),iL=!1),r}})();Q_.importMethods($r,!0,1);var aL=Q_,oL={...{getTournamentPoints:MM},...{calculateNewRatings:BD,generateDynamicRatings:VD}};Q_.importMethods(oL);var sL={INTENNSE_STANDARD:{competitionFormatName:"INTENNSE_STANDARD",matchUpFormat:"SET7XA-S:T10P",sport:"INTENNSE",timerProfile:{shotClockSeconds:14,segmentTimers:[{segmentType:"set",direction:"down",minutes:10}],changeoverSeconds:0,setBreakSeconds:120},timeoutRules:{count:5,per:"MATCHUP",durationSeconds:60},substitutionRules:{allowed:!0,allowedMatchUpTypes:["SINGLES","DOUBLES"],timing:"BETWEEN_POINTS"},playerRules:{maxMinutesPerSegment:6,matchUpTypes:["SINGLES"]},penaltyProfile:{sport:"INTENNSE",penaltyTypes:[{penaltyType:"UNSPORTSMANLIKE_CONDUCT",label:"Unsportsmanlike",category:"conduct"},{penaltyType:"BALL_ABUSE",label:"Ball Abuse",category:"conduct"},{penaltyType:"RACKET_ABUSE",label:"Racket Abuse",category:"conduct"}],escalation:[{step:1,consequence:"warning"},{step:2,consequence:"point"},{step:3,consequence:"game"},{step:4,consequence:"default"}]},pointProfile:{sport:"INTENNSE",pointResults:[{result:"Ace",label:"Ace",isServe:!0},{result:"Winner",label:"Winner"},{result:"Serve Winner",label:"Serve Winner",isServe:!0},{result:"Forced Error",label:"Forced Error",isError:!0},{result:"Unforced Error",label:"Unforced Error",isError:!0},{result:"Double Fault",label:"Double Fault",isServe:!0,isError:!0},{result:"Touch",label:"Touch"},{result:"Penalty",label:"Penalty"}]},pointMultipliers:[{condition:{results:["Ace"]},value:2},{condition:{results:["Winner"]},value:2}]},TENNIS_STANDARD:{competitionFormatName:"TENNIS_STANDARD",matchUpFormat:"SET3-S:6/TB7",sport:"TENNIS",timerProfile:{changeoverSeconds:90,setBreakSeconds:120},timeoutRules:{count:0,per:"MATCHUP"},substitutionRules:{allowed:!1},penaltyProfile:{sport:"TENNIS",penaltyTypes:[{penaltyType:"TIME_VIOLATION",label:"Time Violation",category:"time_violation"},{penaltyType:"COACHING",label:"Coaching",category:"code_violation"},{penaltyType:"UNSPORTSMANLIKE_CONDUCT",label:"Unsportsmanlike",category:"conduct"},{penaltyType:"BALL_ABUSE",label:"Ball Abuse",category:"conduct"},{penaltyType:"RACKET_ABUSE",label:"Racket Abuse",category:"conduct"},{penaltyType:"VERBAL_ABUSE",label:"Verbal Abuse",category:"conduct"},{penaltyType:"AUDIBLE_OBSCENITY",label:"Audible Obscenity",category:"conduct"},{penaltyType:"VISIBLE_OBSCENITY",label:"Visible Obscenity",category:"conduct"}],escalation:[{step:1,consequence:"warning"},{step:2,consequence:"point"},{step:3,consequence:"game"},{step:4,consequence:"default"}]},pointProfile:{sport:"TENNIS",pointResults:[{result:"Ace",label:"Ace",isServe:!0},{result:"Winner",label:"Winner"},{result:"Serve Winner",label:"Serve Winner",isServe:!0},{result:"Forced Error",label:"Forced Error",isError:!0},{result:"Unforced Error",label:"Unforced Error",isError:!0},{result:"Double Fault",label:"Double Fault",isServe:!0,isError:!0},{result:"Penalty",label:"Penalty"}]},pointMultipliers:[]}},cL={[qp]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},uL={[Lp]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[QU,YU]}},lL={[Lp]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[QU,XU,JU],disabledActions:[]}]}},dL="Personal circumstance",pL={competitionFormats:sL,ratingsParameters:Nv,matchUpFormats:Gu,countryToFlag:Rh,tieFormats:IA,countries:Ah,policies:{POLICY_AVOIDANCE_COUNTRY:cL,POLICY_POSITION_ACTIONS_DEFAULT:$T,POLICY_POSITION_ACTIONS_DISABLED:{[Lp]:{policyName:"positionActionsDisabled",enabledStructures:!1}},POLICY_POSITION_ACTIONS_NO_MOVEMENT:lL,POLICY_POSITION_ACTIONS_UNRESTRICTED:uL,POLICY_PRIVACY_DEFAULT:{[jp]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,rankings:!0,ratings:!0,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},POLICY_ROUND_NAMING_DEFAULT:Gg,POLICY_SCHEDULING_DEFAULT:mR,POLICY_SCORING_DEFAULT:{[Hp]:{processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},defaultMatchUpFormat:Vu,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireParticipantsForScoring:!1,requireAllPositionsAssigned:void 0,allowChangePropagation:!1,stage:{[El]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},matchUpFormats:[],matchUpStatusCodes:{[Xm]:[],[Jm]:[],[tf]:[],[of]:[],[cf]:[],[df]:[]}}},POLICY_SCORING_USTA:{[Hp]:{requireAllPositionsAssigned:!1,stage:{[El]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Vu,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Vu,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}],matchUpStatusCodes:{[Xm]:[{matchUpStatusCodeDisplay:"Abandoned",label:"Abandoned match",matchUpStatusCode:"OA"}],[Jm]:[{matchUpStatusCodeDisplay:"Unplayed or Cancelled",label:"Cancelled match",matchUpStatusCode:"OC"}],[of]:[{matchUpStatusCodeDisplay:"Incomplete",label:"Incomplete match",matchUpStatusCode:"OI"}],[tf]:[{description:"Disqualification for cause or ineligibility",label:"Disqualification (ineligibility)",matchUpStatusCodeDisplay:"Def [dq]",matchUpStatusCode:"DQ"},{description:"Misconduct before or between matches",label:"Misconduct",matchUpStatusCodeDisplay:"Def [cond]",matchUpStatusCode:"DM"},{description:"Failure to start match because of adult discipline",label:"Fail. (adult discipline)",matchUpStatusCodeDisplay:"Def [ad]",matchUpStatusCode:"D5"},{description:"Refusal to start match for reason other than adult discipline, injury, illness, or personal circumstance. (After the Referee has conclusively confirmed that a player refuses to play a match, the Referee need not wait until the scheduled time of the match to records the result.)",label:"Refusal to start match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D4"},{label:"Not showing up",matchUpStatusCodeDisplay:"Def [ns]",matchUpStatusCode:"D6"},{description:"Lateness for match including, but not limited to, intending to play but mistakenly arriving at the wrong time, location, or without proper equipment",label:"Lateness for match",matchUpStatusCodeDisplay:"Score + Def [late]",matchUpStatusCode:"D7"},{label:"Double default",matchUpStatusCodeDisplay:"Def/Def",matchUpStatusCode:"DD"},{description:"Refusal to continue playing a match for reason other than injury, illness, personal circumstance, or adult discipline",label:"Refusal to continue match",matchUpStatusCodeDisplay:"Def [refsl]",matchUpStatusCode:"D9"},{description:"Default for receiving an injection, IV, or supplemental oxygen",label:"Default (PEDs)",matchUpStatusCodeDisplay:"Def [med]",matchUpStatusCode:"DI"},{description:"Default under Point Penalty System",label:"Default (Point Penalty System)",matchUpStatusCodeDisplay:"Def [pps]",matchUpStatusCode:"DP"}],[df]:[{matchUpStatusCodeDisplay:"Wo [inj]",matchUpStatusCode:"W1",label:"Injury"},{matchUpStatusCodeDisplay:"Wo [ill]",matchUpStatusCode:"W2",label:"Illness"},{matchUpStatusCodeDisplay:"Wo [pc]",label:dL,matchUpStatusCode:"W3"},{matchUpStatusCodeDisplay:"Wo/Wo",matchUpStatusCode:"WOWO",label:"Double walkover"},{matchUpStatusCodeDisplay:"Wo [Tae]",label:"Tournament Administrative Error",matchUpStatusCode:"W4"},{matchUpStatusCodeDisplay:"Wo/Withdrawn",matchUpStatusCode:"W5",label:"Withdrawn"}],[cf]:[{matchUpStatusCodeDisplay:"Ret [inj]",matchUpStatusCode:"RJ",label:"Injury"},{matchUpStatusCodeDisplay:"Ret [ill]",matchUpStatusCode:"RI",label:"Illness"},{matchUpStatusCodeDisplay:"Ret [pc]",label:dL,matchUpStatusCode:"RC"},{description:"Retirement because of adult discipline",label:"Ret. (adult discipline)",matchUpStatusCodeDisplay:"Ret [ad]",matchUpStatusCode:"RD"},{description:"A player who retires from a match remains eligible for consolations, place playoffs, doubles and subsequent round robin matches",matchUpStatusCodeDisplay:"Ret [elg]",label:"Ret. (eligible)",matchUpStatusCode:"RU"}],[vg]:[{matchUpStatusCodeDisplay:"Wd [inj]",matchUpStatusCode:"WD.INJ",label:"Injury"},{matchUpStatusCodeDisplay:"Wd [ill]",matchUpStatusCode:"WD.ILL",label:"Illness"},{matchUpStatusCodeDisplay:"Wd [pc]",label:dL,matchUpStatusCode:"WD.PC"},{matchUpStatusCodeDisplay:"Wd/Wd",matchUpStatusCode:"WD.WD",label:"Double withdrawal"},{label:"Tournament Administrative Error",matchUpStatusCodeDisplay:"Wd [Tae]",matchUpStatusCode:"WD.TAE"}]}}},POLICY_SEEDING_ITF:{[zp]:{seedingProfile:{positioning:Bl},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},POLICY_SEEDING_DEFAULT:nM},flagIOC:function(e){return Rh(Object.assign({},...Ah.filter(e=>e.ioc).map(e=>({[e.ioc]:e.iso})))[e])}},mL={};Br(mL,{activeMatchUpStatuses:()=>yf,auditConstants:()=>PA,competitionFormatConstants:()=>fL,completedMatchUpStatuses:()=>If,directingMatchUpStatuses:()=>hf,displayConstants:()=>CT,drawDefinitionConstants:()=>Ed,entryStatusConstants:()=>Dg,errorConditionConstants:()=>gs,eventConstants:()=>Nl,extensionConstants:()=>xm,flightConstants:()=>nC,genderConstants:()=>lc,keyValueConstants:()=>IN,matchUpActionConstants:()=>cD,matchUpStatusConstants:()=>Sf,matchUpTypes:()=>Kr,nonDirectingMatchUpStatuses:()=>gf,particicipantsRequiredMatchUpStatuses:()=>mf,participantConstants:()=>Eh,participantRoles:()=>$S,participantTypes:()=>Nh,penaltyConstants:()=>hL,policyConstants:()=>Xp,positionActionConstants:()=>ZU,ratingConstants:()=>Pv,recoveryTimeRequiredMatchUpStatuses:()=>pf,requestConstants:()=>Xk,resourceContants:()=>Pu,resultConstants:()=>qi,scaleConstants:()=>Cp,scheduleConstants:()=>qI,sortingConstants:()=>fC,surfaceConstants:()=>gL,tieFormatConstants:()=>Il,timeItemConstants:()=>NI,topicConstants:()=>nh,tournamentConstants:()=>zF,upcomingMatchUpStatuses:()=>vf,validMatchUpStatuses:()=>ff,venueConstants:()=>IL,weekdayConstants:()=>OA});var fL={INTENNSE_STANDARD:"INTENNSE_STANDARD",TENNIS_STANDARD:"TENNIS_STANDARD",MATCHUP:"MATCHUP",SET:"SET",HALF:"HALF",SEGMENT:"SEGMENT",BETWEEN_GAMES:"BETWEEN_GAMES",BETWEEN_POINTS:"BETWEEN_POINTS",ANY:"ANY"},hL={COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},gL={CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},IL={INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"};const yL=J({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function vL({individualParticipant:e,composition:t,className:r,matchUp:i,spacer:n,side:a,type:o}){if("scale"===o)return function({individualParticipant:e,composition:t,className:r,matchUp:i,spacer:n}){const a=t?.configuration,o=a?.scaleAttributes?.eventType||i?.matchUpType||"SINGLES",s=e?.rankings,c=e?.ratings,u=a?.scaleAttributes,l=u?.scaleType,d=u?.scaleName,p=u?.accessor,m="RATING"===l?c:s,f=m?.SINGLES?.find(e=>e?.scaleName===d)?.scaleValue,h=m?.DOUBLES?.find(e=>e?.scaleName===d)?.scaleValue,g=f&&p?f[p]:f||"",I=h&&p?h[p]:h||"",y="SINGLES"===o?g:I,v=a?.scaleAttributes?.fallback,S=!n&&(y||v&&(g||I)),b=document.createElement("span"),U=a?.scaleAttributes?.scaleColor,w="green"===U||"red"===U?U:void 0;return S&&(b.className=ce(r,_r(w?{color:w}:{}))),b.innerHTML=S||"",b}({individualParticipant:e,composition:t,className:r,matchUp:i,spacer:n});const s=t?.configuration||{},c=document.createElement("div");if("flag"===o&&s.flags)return function({matchUp:e,individualParticipant:t,spacer:r}){const i=t?.person?.iso2NationalityCode||"",n=i?pL.countryToFlag(i)?.slice(0,4):"",a=document.createElement("span"),o=e?.matchUpType?.toLowerCase();return r||(a.className=yL({variant:o})),a.innerHTML=r?"":n,a}({matchUp:i,individualParticipant:e,spacer:n});if("seeding"===o){const e=function({className:e,composition:t,side:r}){const i="~"===r?.seedValue?"":void 0!==r?.seedValue&&r.seedValue||r?.seedNumber;if(!i)return"";const n=t?.configuration||{},{bracketedSeeds:a}=n,o="boolean"==typeof a&&["(",")"]||"square"===a&&["[","]"]||["",""],s=`${o[0]}${i}${o[1]}`,c="sup"===n.seedingElement?"sup":"span",u=document.createElement(c);return u.className=e||"",u.innerHTML=s,u}({className:r,composition:t,side:a});return"string"==typeof e?c:e}return c}function SL(e){const{isWinningSide:t,side:r,sideNumber:i,individualParticipant:n,matchUp:a,composition:o}=e||{},s=t?"winner":void 0,c=e.eventHandlers||{},u=o?.configuration,l={QUALIFIER:u?.placeHolders?.qualifier||"Qualifier",BYE:u?.placeHolders?.bye||"BYE",TBD:u?.placeHolders?.tbd||"TBD"},d=n?.participantName,p=document.createElement("div");p.classList.add("tmx-i"),p.setAttribute("sideNumber",String(i)),p.setAttribute("id",n?.participantId),p.onclick=e=>{ye(c?.participantClick)&&(e.stopPropagation(),c.participantClick({individualParticipant:n,pointerEvent:e,matchUp:a,side:r}))};const m=document.createElement("div");m.className=Z({variant:s});const f=u?.flags&&vL({...e,type:"flag"});if(f)m.appendChild(f);else{const t=vL({type:"scale",...e});t&&m.appendChild(t)}const h=document.createElement("div");h.className=ee({variant:s});const g=1===a?.roundNumber||"FEED_IN"===a?.drawType&&a?.roundNumber>1&&r?.drawPosition&&!r?.sourceMatchUp,I=u?.persistInputFields;if(u?.inlineAssignment&&ye(c?.assignParticipant)&&ye(u?.participantProvider)&&g&&(!r?.bye||I)&&(!r?.qualifier||I)&&a&&(!d||r?.bye||r?.qualifier||I)){let e;e=r?.bye?{participantId:"__BYE__",participantName:"\u2014 BYE \u2014"}:r?.qualifier?{participantId:"__QUALIFIER__",participantName:"\u2014 QUALIFIER \u2014"}:n;const t=Or({matchUp:a,side:r,sideNumber:i,eventHandlers:c,composition:o,currentParticipant:e});h.appendChild(t)}else if(d){const e=document.createElement("span");if(t&&u?.winnerColor)e.style.color="string"==typeof u.winnerColor?u.winnerColor:"green";else if(u?.genderColor){const t=n?.person?.sex,r=("MALE"===t?"#2E86C1":"FEMALE"===t&&"#AA336A")||"";e.style.color="string"==typeof u.genderColor?u.genderColor:r}e.innerHTML=d,h.appendChild(e)}else{const e=document.createElement("abbr");e.className=function({variant:e}){return J({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:e})}({variant:u?.showAddress?"showAddress":""}),e.innerHTML=r?.bye&&l.BYE||r?.qualifier&&l.QUALIFIER||l.TBD,h.appendChild(e)}const y=vL({...e,className:Fr(),type:"seeding"});y&&h.appendChild(y),m.appendChild(h),p.appendChild(m);const v=Te(e);return p.appendChild(v),{element:p}}const bL=J({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{in_progress:{backgroundColor:"#199f01ff"},awaiting_result:{backgroundColor:"#199f01ff"},defaulted:{backgroundColor:"#df164c"},dead_rubber:{backgroundColor:"#df164c"},cancelled:{backgroundColor:"#df164c"},incomplete:{backgroundColor:"#f7ae04ff"},suspended:{backgroundColor:"#f7ae04ff"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"},double_default:{backgroundColor:"#df164c"},abandoned:{backgroundColor:"black"}}}}),{WALKOVER:UL,DEFAULTED:wL,DOUBLE_WALKOVER:TL,DOUBLE_DEFAULT:DL,ABANDONED:PL}=Sf;const NL=J({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});const EL=J({flexDirection:"column",position:"relative",display:"flex"}),ML=J({alignItems:"stretch",display:"flex"}),RL=J({marginInlineEnd:".25rem",color:"green"});const{WALKOVER:AL,DEFAULTED:CL,DOUBLE_WALKOVER:kL,DOUBLE_DEFAULT:xL,RETIRED:OL,SUSPENDED:FL,CANCELLED:_L,IN_PROGRESS:LL,ABANDONED:BL}=Sf;function $L({initialRoundNumber:e=1,eventHandlers:t,sideContainer:r,composition:i,participant:n,placeholder:a,sideNumber:o,matchUp:s}){const{winningSide:c,matchUpType:u,isRoundRobin:l,matchUpStatus:d}=s||{},p=i?.configuration;let m;const f=o?s?.sides?.find(e=>e.sideNumber===o):void 0;n||(n=f?.participant,m=p?.allDrawPositions||p?.drawPositions&&f?.drawPosition&&(s?.roundNumber===e||f?.participantFed||l)?f?.drawPosition:"");const h="DOUBLES"===u,g=h?n?.individualParticipants?.[0]:n,I=h&&n?.individualParticipants?.[1],y=!!(o===c||"BYE"===d&&n),v=p?.winnerChevron&&y,S=p?.teamLogo,b=[OL,AL,CL,kL,xL,FL,_L,LL,BL].includes(d)&&!y,U=p?.gameScoreOnly,w=document.createElement("div");if(r&&(w.className=function({drawPosition:e,sideNumber:t}){return J({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:t,css:e&&{"&:before":{backgroundColor:"$backgroundColor",content:`${e}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}({drawPosition:m,sideNumber:o})),w.classList.add("tmx-p"),w.setAttribute("id",n?.participantId||""),S){const e=function({teamLogo:e}){console.log({teamLogo:e});const t=document.createElement("div");return t.className=NL(),t}({teamLogo:S});w.appendChild(e)}const T=document.createElement("div");T.className=te(h?{variant:"doubles"}:{});const D=document.createElement("div");D.className=function({winnerChevron:e,isDoubles:t}){const r=2*(t?.4:.3);return J({variants:{variant:{winner:{"&::before":{borderTop:`${r}rem solid transparent`,borderBottom:`${r}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:e?"winner":void 0})}({winnerChevron:v,isDoubles:h});const P=SL({individualParticipant:g,eventHandlers:t,isWinningSide:y,composition:i,sideNumber:o,matchUp:s,side:f}).element;if(D.appendChild(P),I){const e=SL({individualParticipant:I,eventHandlers:t,isWinningSide:y,composition:i,sideNumber:o,matchUp:s,side:f}).element;D.appendChild(e)}else h&&a&&function(e){return e instanceof Element||e}(a)&&D.appendChild(a);if(T.appendChild(D),w.appendChild(T),r){const e=document.createElement("div");if(y&&!U){const t=function({dim:e="20px"}={}){return`\n    <div style="line-height: 0;">\n      <svg height="${e}" viewBox="0 0 18 24" width="${e}" xmlns="http://www.w3.org/2000/svg" class="${RL()}" style="fill: currentcolor;">\n        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>\n      </svg>\n    </div>\n  `}();"string"==typeof t?e.innerHTML=t:e.appendChild(t)}else if(b){const t=function({matchUpStatus:e}){const t=e?.toLowerCase(),r=["defaulted","retired","walkover","defaulted","double_walkover","double_default","cancelled","in_progress","awaiting_result","dead_rubber","incomplete","suspended","abandoned"].includes(t)?t:void 0,i=[UL,TL].includes(e||"")?"WO":[wL,DL].includes(e||"")?"DEF":e===PL?"ABD":e?.split("_").join("").slice(0,3)||"",n=document.createElement("div");n.className=bL(r?{variant:r}:{});const a=document.createElement("abbr");return a.setAttribute("title",e||""),a.style.textDecoration="none",a.style.borderBottom="none",a.innerHTML=i,n.appendChild(a),n}({matchUpStatus:d});e.appendChild(t)}w.appendChild(e)}return w}const VL=J({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",height:"1.5em"});function jL({eventHandlers:e,roundMatchUps:t,roundProfile:r,roundNumber:i,context:n}){const a=document.createElement("div");a.className=VL(),a.classList.add("tmx-rh"),a.setAttribute("roundNumber",String(i));const o=ye(e?.roundHeaderClick);o&&(a.onclick=a=>e.roundHeaderClick({roundNumber:i,roundProfile:r,roundMatchUps:t,context:n,pointerEvent:a}));const s=o?"\u22ee":"",c=r?.[i]?.roundName,u=c&&` <div style="display: flex; flex-direction: row; justify-content: space-between">\n        <div>${c}</div>\n        <div style="font-weight: bold">${s}</div>\n      </div>\n  `;return a.innerHTML=u||"",a}const GL=J({flexDirection:"column",display:"flex"}),WL=J({flexDirection:"row",display:"flex"}),qL=J({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),HL=J({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),zL=J({fontWeight:"bold",color:"blue",height:"1em"}),YL=J({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),KL=J({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});const XL=J({});const QL=J({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),JL=J({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),ZL=J({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function eB({eventHandlers:e,entryStatus:t,sideNumber:r,className:i,matchUp:n}){const a=document.createElement("div");ye(e?.centerInfoClick)&&(a.onclick=t=>e.centerInfoClick({matchUp:n,sideNumber:r,pointerEvent:t})),a.className=ce(function({variant:e}){return J({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:e})}({variant:r}),i),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",String(r));const o=document.createElement("div");o.className=QL();const s=document.createElement("div");s.className=JL();const c=document.createElement("div");c.className=ZL(),c.innerHTML=t?"Entry status:&nbsp;":"",s.appendChild(c);const u=document.createElement("div");return u.className=ZL(),u.innerHTML=t||"",s.appendChild(u),o.appendChild(s),a.appendChild(o),{element:a}}const tB=1.8,rB=1.5,iB=2;const nB=e=>J({display:"flex",alignItems:"center",height:e,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),aB=J({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),oB=J({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),sB=J({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function cB({gameScoreOnly:e,scoreStripes:t,set:r,sideNumber:i}){const n=i===r?.winningSide||r?.winningSide?"loser":void 0,a=2===i?r.side2Score:r.side1Score,o=r.side2TiebreakScore||r.side1TiebreakScore,s=2===i?r.side2TiebreakScore:r.side1TiebreakScore,c=void 0===a&&s,u=c||a,l=t&&r.setNumber%2?"lightgray":"transparent";let d;if(r.editing?r.editing===i:void 0)d=function({value:e}={}){const t=document.createElement("input");return t.onclick=e=>e.target.select(),t.className=oB(),t.value=String(e||""),t}({value:u});else if(d=document.createElement("p"),d.className=oB({variant:n}),d.classList.add("tmx-st"),d.setAttribute("setNumber",r.setNumber),d.style.backgroundColor=l,d.innerHTML=isNaN(u)?"":u,!e){const e=document.createElement("span");e.className=aB(),e.innerHTML=o&&!c?String(s):"",d.appendChild(e)}return d}const uB=J({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var lB,dB={exports:{}};var pB=(lB||(lB=1,function(e){e.exports=function(){var e=1e3,t=6e4,r=36e5,i="millisecond",n="second",a="minute",o="hour",s="day",c="week",u="month",l="quarter",d="year",p="date",m="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||t[0])+"]"}},I=function(e,t,r){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(r)+e},y={s:I,z:function(e){var t=-e.utcOffset(),r=Math.abs(t),i=Math.floor(r/60),n=r%60;return(t<=0?"+":"-")+I(i,2,"0")+":"+I(n,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var i=12*(r.year()-t.year())+(r.month()-t.month()),n=t.clone().add(i,u),a=r-n<0,o=t.clone().add(i+(a?-1:1),u);return+(-(i+(r-n)/(a?n-o:o-n))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:d,w:c,d:s,D:p,h:o,m:a,s:n,ms:i,Q:l}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},v="en",S={};S[v]=g;var b="$isDayjsObject",U=function(e){return e instanceof P||!(!e||!e[b])},w=function e(t,r,i){var n;if(!t)return v;if("string"==typeof t){var a=t.toLowerCase();S[a]&&(n=a),r&&(S[a]=r,n=a);var o=t.split("-");if(!n&&o.length>1)return e(o[0])}else{var s=t.name;S[s]=t,n=s}return!i&&n&&(v=n),n||!i&&v},T=function(e,t){if(U(e))return e.clone();var r="object"==typeof t?t:{};return r.date=e,r.args=arguments,new P(r)},D=y;D.l=w,D.i=U,D.w=function(e,t){return T(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var P=function(){function g(e){this.$L=w(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[b]=!0}var I=g.prototype;return I.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(D.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(f);if(i){var n=i[2]-1||0,a=(i[7]||"0").substring(0,3);return r?new Date(Date.UTC(i[1],n,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)):new Date(i[1],n,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)}}return new Date(t)}(e),this.init()},I.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},I.$utils=function(){return D},I.isValid=function(){return this.$d.toString()!==m},I.isSame=function(e,t){var r=T(e);return this.startOf(t)<=r&&r<=this.endOf(t)},I.isAfter=function(e,t){return T(e)<this.startOf(t)},I.isBefore=function(e,t){return this.endOf(t)<T(e)},I.$g=function(e,t,r){return D.u(e)?this[t]:this.set(r,e)},I.unix=function(){return Math.floor(this.valueOf()/1e3)},I.valueOf=function(){return this.$d.getTime()},I.startOf=function(e,t){var r=this,i=!!D.u(t)||t,l=D.p(e),m=function(e,t){var n=D.w(r.$u?Date.UTC(r.$y,t,e):new Date(r.$y,t,e),r);return i?n:n.endOf(s)},f=function(e,t){return D.w(r.toDate()[e].apply(r.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(t)),r)},h=this.$W,g=this.$M,I=this.$D,y="set"+(this.$u?"UTC":"");switch(l){case d:return i?m(1,0):m(31,11);case u:return i?m(1,g):m(0,g+1);case c:var v=this.$locale().weekStart||0,S=(h<v?h+7:h)-v;return m(i?I-S:I+(6-S),g);case s:case p:return f(y+"Hours",0);case o:return f(y+"Minutes",1);case a:return f(y+"Seconds",2);case n:return f(y+"Milliseconds",3);default:return this.clone()}},I.endOf=function(e){return this.startOf(e,!1)},I.$set=function(e,t){var r,c=D.p(e),l="set"+(this.$u?"UTC":""),m=(r={},r[s]=l+"Date",r[p]=l+"Date",r[u]=l+"Month",r[d]=l+"FullYear",r[o]=l+"Hours",r[a]=l+"Minutes",r[n]=l+"Seconds",r[i]=l+"Milliseconds",r)[c],f=c===s?this.$D+(t-this.$W):t;if(c===u||c===d){var h=this.clone().set(p,1);h.$d[m](f),h.init(),this.$d=h.set(p,Math.min(this.$D,h.daysInMonth())).$d}else m&&this.$d[m](f);return this.init(),this},I.set=function(e,t){return this.clone().$set(e,t)},I.get=function(e){return this[D.p(e)]()},I.add=function(i,l){var p,m=this;i=Number(i);var f=D.p(l),h=function(e){var t=T(m);return D.w(t.date(t.date()+Math.round(e*i)),m)};if(f===u)return this.set(u,this.$M+i);if(f===d)return this.set(d,this.$y+i);if(f===s)return h(1);if(f===c)return h(7);var g=(p={},p[a]=t,p[o]=r,p[n]=e,p)[f]||1,I=this.$d.getTime()+i*g;return D.w(I,this)},I.subtract=function(e,t){return this.add(-1*e,t)},I.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||m;var i=e||"YYYY-MM-DDTHH:mm:ssZ",n=D.z(this),a=this.$H,o=this.$m,s=this.$M,c=r.weekdays,u=r.months,l=r.meridiem,d=function(e,r,n,a){return e&&(e[r]||e(t,i))||n[r].slice(0,a)},p=function(e){return D.s(a%12||12,e,"0")},f=l||function(e,t,r){var i=e<12?"AM":"PM";return r?i.toLowerCase():i};return i.replace(h,function(e,i){return i||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return D.s(t.$y,4,"0");case"M":return s+1;case"MM":return D.s(s+1,2,"0");case"MMM":return d(r.monthsShort,s,u,3);case"MMMM":return d(u,s);case"D":return t.$D;case"DD":return D.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(r.weekdaysMin,t.$W,c,2);case"ddd":return d(r.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(a);case"HH":return D.s(a,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return f(a,o,!0);case"A":return f(a,o,!1);case"m":return String(o);case"mm":return D.s(o,2,"0");case"s":return String(t.$s);case"ss":return D.s(t.$s,2,"0");case"SSS":return D.s(t.$ms,3,"0");case"Z":return n}return null}(e)||n.replace(":","")})},I.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},I.diff=function(i,p,m){var f,h=this,g=D.p(p),I=T(i),y=(I.utcOffset()-this.utcOffset())*t,v=this-I,S=function(){return D.m(h,I)};switch(g){case d:f=S()/12;break;case u:f=S();break;case l:f=S()/3;break;case c:f=(v-y)/6048e5;break;case s:f=(v-y)/864e5;break;case o:f=v/r;break;case a:f=v/t;break;case n:f=v/e;break;default:f=v}return m?f:D.a(f)},I.daysInMonth=function(){return this.endOf(u).$D},I.$locale=function(){return S[this.$L]},I.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),i=w(e,t,!0);return i&&(r.$L=i),r},I.clone=function(){return D.w(this.$d,this)},I.toDate=function(){return new Date(this.valueOf())},I.toJSON=function(){return this.isValid()?this.toISOString():null},I.toISOString=function(){return this.$d.toISOString()},I.toString=function(){return this.$d.toUTCString()},g}(),N=P.prototype;return T.prototype=N,[["$ms",i],["$s",n],["$m",a],["$H",o],["$W",s],["$M",u],["$y",d],["$D",p]].forEach(function(e){N[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),T.extend=function(e,t){return e.$i||(e(t,P,T),e.$i=!0),T},T.locale=w,T.isDayjs=U,T.unix=function(e){return T(1e3*e)},T.en=S[v],T.Ls=S,T.p={},T}()}(dB)),dB.exports);const mB=ie(pB);const{completedMatchUpStatuses:fB}=mL;function hB({initialRoundNumber:e=1,eventHandlers:t,composition:r,sideNumber:i,className:n,matchUp:a}){const o=(r?.configuration||{})?.scheduleInfo,s=a?.score?.scoreStringSide1,c=r?.configuration?.scoreBox&&s,u=a?.matchUpStatus&&fB.includes(a.matchUpStatus),l=a?.readyToScore&&t?.scoreClick&&!aL.checkScoreHasValue({matchUp:a})&&!u,d=document.createElement("div");if(d.className=ce(EL(),n),d.classList.add("tmx-sd"),d.setAttribute("sideNumber",String(i)),o&&1===i){const e=function({matchUp:e,eventHandlers:t}){const{scheduledTime:r,scheduledDate:i,venueAbbreviation:n,courtName:a}=e?.schedule||{},{dateTime:{extractDate:o,extractTime:s}}=E_,c=s(r);let u=o(i),l="ddd D MMMM";c&&(l+=", hh:mm A",u+=`T${c}`);const d=i?mB(u).format(l):"Not scheduled",p=n&&a?.toString().startsWith(n)&&a||n&&a&&`${n} ${a}`||a||n||"",m=document.createElement("div");m.className=uB(),m.classList.add("tmx-sch"),ye(t?.scheduleClick)&&(m.onclick=r=>t.scheduleClick({matchUp:e,pointerEvent:r}));const f=document.createElement("div");f.innerHTML=d,m.append(f);const h=document.createElement("div");h.style="display: flex; flex-direction: row";const g=document.createElement("div");if(g.style.paddingRight=".2rem",g.onclick=r=>{ye(t?.venueClick)&&(r.stopPropagation(),t.venueClick({pointerEvent:r,matchUp:e}))},g.innerHTML=p,h.append(g),m.append(h),m.onclick){const e=document.createElement("div");e.innerHTML="\u22ee",h.append(e)}return m}({matchUp:a,eventHandlers:t});d.appendChild(e)}const p=document.createElement("div");p.className=ML();const m=$L({sideContainer:!0,initialRoundNumber:e,eventHandlers:t,composition:r,sideNumber:i,matchUp:a});if(p.appendChild(m),c){const e=document.createElement("div");e.style.border="1px solid lightgray",p.appendChild(e)}if(s){const e=function({participantHeight:e,eventHandlers:t,composition:r,sideNumber:i,matchUp:n}){const a=r?.configuration?.winnerChevron,o=r?.configuration?.gameScoreOnly,s=n?.score?.sets||[],c=r?.configuration?.scoreBox,u=e?2===i?e:e-1:void 0,l=document.createElement("div");l.className=nB(u)({...!c&&1===i&&{sideNumber:1},fontSize:"small"}),l.classList.add("sideScore"),l.classList.add("tmx-scr"),l.onclick=e=>{ye(t?.scoreClick)&&(e.stopPropagation(),t.scoreClick({pointerEvent:e,matchUp:n}))};const d=document.createElement("div");d.className=sB();for(const p of s||[]){const e=cB({gameScoreOnly:o,scoreStripes:a,sideNumber:i,set:p});d.appendChild(e)}return l.appendChild(d),l}({eventHandlers:t,composition:r,sideNumber:i,matchUp:a});p.appendChild(e)}if(l){const e=e=>{ye(t?.scoreClick)&&(e.stopPropagation(),t.scoreClick({pointerEvent:e,matchUp:a}))},r=document.createElement("div");r.className=nB(void 0)({...!c&&1===i&&{sideNumber:1},fontSize:"small"}),r.onclick=e,r.innerHTML="[Score]",p.appendChild(r)}return d.appendChild(p),d}function gB(e){const{composition:t,initialRoundNumber:r=1,matchUp:i,moiety:n,selectedMatchUpId:a,searchActive:o}=e,{roundFactor:s,roundNumber:c,finishingRound:u,matchUpType:l,preFeedRound:d,stage:p}=i,m=e.isFinalRound||!!u&&1===Number.parseInt(String(u)),f="QUALIFYING"===p&&m,h=m,g=!!c&&Number.parseInt(String(c))===r,I="DOUBLES"===l,y=(o||i.isRoundRobin||i.collectionId||e.isLucky||e.isAdHoc?"mr":h&&"noProgression")||(f||d)&&"m0"||n&&"m1"||"m2",v=function({composition:e,isDoubles:t,roundFactor:r=1}){const i=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=e?.configuration||{},a=n?.connectorWidth||16,o=n.centerInfo?rB*i:0,s=n.scheduleInfo?tB*i:0,c=(60+(n.showAddress?i:0))*(t?1.3:1)+o;return J({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c*r,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:(c+s)*r}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}({composition:t,isDoubles:I,roundFactor:s})({isFirstRound:g,link:y}),S=t?.configuration||{},{resultsInfo:b,centerInfo:U}=S||{},w=e.eventHandlers||{},T=document.createElement("div");T.className=ce(t?.theme,e?.className,"matchup",XL()),T.classList.add("tmx-m"),T.setAttribute("id",i?.matchUpId),T.onclick=e=>{ye(w?.matchUpClick)&&w.matchUpClick({pointerEvent:e,matchUp:i})};const D=document.createElement("div");D.className=function({configuration:e}){const t={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(e?.matchUpHover){const r="string"==typeof e.matchUpHover?e.matchUpHover:"cyan";t["&:hover"]={backgroundColor:r}}else t["&:hover"]={borderColor:"$borderHover"};return J(t)()}({configuration:S});const P=({sideNumber:e})=>{const t=i?.sides?.find(t=>t.sideNumber===e)?.participant?.entryStatus?.replace("_"," ");return eB({eventHandlers:w,entryStatus:t,sideNumber:e,className:2===e?v:void 0,matchUp:i})},N=hB({initialRoundNumber:r,eventHandlers:w,sideNumber:1,composition:t,matchUp:i}),E=hB({className:!U&&v,initialRoundNumber:r,eventHandlers:w,sideNumber:2,composition:t,matchUp:i});if(D.appendChild(N),U){const e=P({sideNumber:1}),t=P({sideNumber:2});D.appendChild(e.element),D.appendChild(t.element)}if(D.appendChild(E),b){const e=function({score:e}){const t=e?.sets?.filter(Boolean).sort((e,t)=>(e.setNumber||0)-(t.setNumber||0)),r=t?.at(-1),i=r?.side1PointsScore||r?.side2PointsScore,n=document.createElement("div");if(n.className=KL(),i){const e=document.createElement("div");e.className=YL({variant:"points"}),e.innerHTML="PTS",n.appendChild(e)}for(const a of t||[]){const e=document.createElement("div");e.setAttribute("key",String(a.setNumber)),e.className=YL({variant:"set"}),e.innerHTML=String(a.setNumber),n.appendChild(e)}return n}({score:i.score});D.appendChild(e)}if(T.appendChild(D),a===i.matchUpId){const e=document.createElement("div");e.className=J({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})(),T.appendChild(e)}return T}function IB({initialRoundNumber:e=1,selectedMatchUpId:t,eventHandlers:r,isFinalRound:i,isRoundRobin:n,searchActive:a,composition:o,roundFactor:s,roundNumber:c,roundProfile:u,minWidth:l,matchUps:d,context:p,isLucky:m}){const f=d.filter(e=>e.roundNumber===c).sort((e,t)=>(e.roundPosition||0)-(t.roundPosition||0)),h=f.every(({roundPosition:e,drawPositions:t})=>!e&&!t),g=o?.configuration||{},I=document.createElement("div");if(I.className=GL(),I.classList.add("tmx-rd"),I.setAttribute("roundNumber",String(c)),g.roundHeader){const e=jL({roundProfile:u,roundMatchUps:f,roundNumber:c,eventHandlers:r,context:p});I.appendChild(e)}const y=document.createElement("div");let v,S,b;if(y.className=qL({variant:h?"adHoc":void 0}),l&&(y.style.minWidth=l),n){const e=e=>(e||[]).reduce((e,t)=>t+e,0);f.sort((t,r)=>{const i=e(t.drawPositions)-e(r.drawPositions),n=t.drawPositions||[],a=r.drawPositions||[],o=(n.length?Math.min.apply(null,n):0)-(a.length?Math.min.apply(null,a):0);return i||o});const t=f.reduce((e,t)=>(e[t.structureId]=t.structureName,e),{});v=Object.values(t),S=Object.keys(t),b=Object.keys(E_.instanceCount(f.map(({structureId:e})=>e))).length}else h&&f.sort((e,t)=>(e.roundOrder??0)-(t.roundOrder??0));const U=b&&f.length/b,w=Object.keys(u).map(e=>parseInt(e)),T=w.indexOf(c),D=0===T?"first":T===w.length-1&&"last";return f.forEach((n,u)=>{const l=U&&!(u%U),d=U&&Math.floor(u/U),p=U&&v[d];if(l){const t=document.createElement("div");t.className=HL({...0===d&&{variant:0},...D&&{roundOrder:D}}),y.appendChild(t);const i=document.createElement("div");if(i.className=zL(),ye(r?.groupHeaderClick)){const{drawId:e,containerStructureId:t}=f[0];y.onclick=i=>r.groupHeaderClick({structureId:S[d],containerStructureId:t,pointerEvent:i,drawId:e})}c===e&&(i.innerHTML=p),y.appendChild(i)}const g=u%2==0;s?n.roundFactor=s:e>1&&(n.roundFactor=Math.pow(2,c-e));const I=gB({initialRoundNumber:e,selectedMatchUpId:t,eventHandlers:r,isFinalRound:i,searchActive:a,composition:o,isAdHoc:h,isLucky:m,matchUp:n,moiety:g});y.appendChild(I)}),I.appendChild(y),I}function yB({initialRoundNumber:e=1,selectedMatchUpId:t,eventHandlers:r,searchActive:i,composition:n,structureId:a,finalColumn:o,matchUps:s,minWidth:c,context:u}){const{roundNumbers:l,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:m}=aL.getRoundMatchUps({matchUps:s});a=a||u?.structureId||s?.[0]?.structureId;const f=s.some(({isRoundRobin:e})=>e),h=p||m,g=document.createElement("div");g.className=WL(),g.classList.add("tmx-str"),g.setAttribute("id",a||"");const I=l.length?Math.max.apply(null,l):0;for(const y of l){if(y<e)continue;const a=IB({initialRoundNumber:e,selectedMatchUpId:t,eventHandlers:r,isFinalRound:y===I,isRoundRobin:f,searchActive:i,composition:n,roundNumber:y,roundProfile:d,matchUps:s,minWidth:c,context:u,isLucky:h});g.appendChild(a)}if(o&&"boolean"!=typeof o){const e=document.createElement("div");e.className=GL();const t=document.createElement("div");t.className=qL(),t.appendChild(o),e.appendChild(t),g.appendChild(e)}return g}const vB=J({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function SB({content:e,theme:t}){const r=document.createElement("div");return r.className=t?ce(vB(),t):vB(),t&&r.classList.add(t),"string"==typeof e?r.innerHTML=e:r.appendChild(e),r}const{createTheme:bB}=Q({theme:{lineHeights:{scheduleInfo:`${tB}rem`,centerInfo:`${rB}rem`,gameScore:`${iB}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),UB=bB("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),wB=bB("wimbledon-theme",{borderWidths:{},colors:{connector:"transparent",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),TB=bB("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),DB=bB("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),PB=bB("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),NB=bB("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),EB={Australian:{configuration:{flags:!0},theme:UB},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:PB},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:PB},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:TB},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:wB},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:DB},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:bB("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}})},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:UB},Night:{configuration:{flags:!0},theme:NB}};function MB(e,t,r){const i=document.createElement("div");i.style.cssText="display: flex; flex-direction: column; width: 100%;",i.classList.add("flexcol");const n={},a={};let o;for(const s of t){if((s.text||s.html)&&!s.field){const e=s.fieldPair&&document.createElement("div");e&&(e.className="flexrow");const t=document.createElement("div");t.className="flexaligncenter",t.style.cssText=s.style||s.header&&"font-weight: bold; font-size: larger;"||"height: 2.5em; padding-right: 1em;";const r=document.createElement("div");if(s.id&&(r.id=s.id),r.className="content",r.innerHTML=s.text,t.appendChild(r),e){e.appendChild(t);const{field:r,inputElement:c,datepicker:u}=Cr(s.fieldPair);u&&(n[`${s.field}.date`]=u),c&&(n[s.fieldPair.field]=c,s.fieldPair.focus&&(o=c)),a[s.fieldPair.field]=r,e.appendChild(r),i.appendChild(e)}else i.appendChild(t);continue}if(s.divider){const e=document.createElement("hr");e.classList.add("dropdown-divider"),i.appendChild(e);continue}if(s.spacer){const e=document.createElement("div"),t="number"==typeof s.spacer&&`${s.spacer}em`||"string"==typeof s.spacer&&s.spacer||"1em";e.style.marginBlockEnd=t,i.appendChild(e);continue}if((s.label||s.field)&&!s.hide&&s.field){const e=s.fieldPair&&document.createElement("div");e&&(e.className="flexrow");const{field:t,inputElement:r,datepicker:c,subFields:u}=Cr(s);if(u&&u.forEach(e=>n[e.field]=e.input),c&&(n[`${s.field}.date`]=c),s.focus&&(o=r),n[s.field]=r,a[s.field]=t,e){e.appendChild(t);const{field:r,inputElement:c,datepicker:u}=Cr(s.fieldPair);u&&(n[`${s.field}.date`]=u),c&&(n[s.fieldPair.field]=c,s.fieldPair.focus&&(o=c)),a[s.fieldPair.field]=r,e.appendChild(r),i.appendChild(e)}else i.appendChild(t)}}if(o&&setTimeout(()=>o.focus(),200),e.appendChild(i),r?.length)for(const s of r){if(s.dateRange&&Array.isArray(s.fields)){const[e,t]=s.fields;if(n[e]&&n[t]){const r=new Er(n[e],{inputs:[n[e],n[t]],minDate:s.minDate,maxDate:s.maxDate,format:"yyyy-mm-dd",autohide:!0});n[`${e}.date`]=r}}s.control&&(De(s.onChange)&&n[s.control].addEventListener("change",e=>s.onChange({e:e,inputs:n,fields:a})),De(s.onInput)&&n[s.control]&&n[s.control].addEventListener("input",e=>s.onInput({e:e,inputs:n,fields:a})),De(s.onFocusOut)&&n[s.control]&&n[s.control].addEventListener("focusout",e=>s.onFocusOut({e:e,inputs:n,fields:a})))}return n}const{WTN:RB,UTR:AB}=mL.ratingConstants,{FEMALE:CB,MALE:kB,ANY:xB}=lc;function OB(e={}){const{callback:t,consideredDate:r,title:i="Generate mock players",labels:n={},defaults:a={}}=e;let o;const s={gender:n.gender||"Participant gender",count:n.count||"Participant count",ageRange:n.ageRange||"Participant Age Range",minAge:n.minAge||"Minimum Age",maxAge:n.maxAge||"Maximum Age",ratings:n.ratings||"Generate Ratings",wtn:n.wtn||"WTN",utr:n.utr||"UTR"},c={gender:a.gender||xB,participantsCount:a.participantsCount||32,ageMin:a.ageMin,ageMax:a.ageMax,wtnRating:a.wtnRating||!1,utrRating:a.utrRating||!1},u=[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const e=o.participantsCount.value,i=o.wtnRating.checked,n=o.utrRating.checked,a=o.gender.value,s=a===xB?void 0:a,c=o.ageMin?.value?Number.parseInt(o.ageMin.value):void 0,u=o.ageMax?.value?Number.parseInt(o.ageMax.value):void 0,l=[i&&{ratingType:RB,ratingMin:14,ratingMax:19.99},n&&{ratingType:AB,ratingMin:8,ratingMax:10}].filter(Boolean),d=c||u?{ageMin:c,ageMax:u}:void 0,{participants:p}=nL.generateParticipants({participantsCount:Number.parseInt(e),scaleAllParticipants:!0,consideredDate:r,categories:l,category:d,sex:s});t&&t(p)}}],l=[{control:"ageMin",onChange:({inputs:e})=>{const t=Number.parseInt(e.ageMin.value)||0,r=Number.parseInt(e.ageMax.value)||0;t>r&&r>0&&(e.ageMax.value=t)}},{control:"ageMax",onChange:({inputs:e})=>{const t=Number.parseInt(e.ageMin.value)||0,r=Number.parseInt(e.ageMax.value)||0;r<t&&t>0&&r>0&&(e.ageMin.value=r)}}];Ue.open({title:i,content:e=>o=MB(e,[{options:[{label:"Any",value:xB,selected:c.gender===xB},{label:"Female",value:CB,selected:c.gender===CB},{label:"Male",value:kB,selected:c.gender===kB}],label:s.gender,field:"gender",value:c.gender},{options:[{label:"8",value:8,selected:8===c.participantsCount},{label:"16",value:16,selected:16===c.participantsCount},{label:"32",value:32,selected:32===c.participantsCount},{label:"64",value:64,selected:64===c.participantsCount},{label:"128",value:128,selected:128===c.participantsCount},{label:"256",value:256,selected:256===c.participantsCount}],label:s.count,field:"participantsCount",value:c.participantsCount},{text:s.ageRange,header:!0},{label:s.minAge,field:"ageMin",placeholder:"e.g., 10",type:"number",value:c.ageMin},{label:s.maxAge,field:"ageMax",placeholder:"e.g., 18",type:"number",value:c.ageMax},{text:s.ratings,header:!0},{label:s.wtn,field:"wtnRating",id:"wtnRating",checkbox:!0,value:c.wtnRating},{label:s.utr,field:"utrRating",id:"utrRating",checkbox:!0,value:c.utrRating}],l),buttons:u})}const FB="Timed set",_B="Tiebreak",LB="Set",BB={SET:"Set",HAL:"Half",QTR:"Quarter",PER:"Period",INN:"Inning",RND:"Round",FRM:"Frame",MAP:"Map"};function $B(e){return e&&"SET"!==e?[1,2,3,4,5,6,7,8,9,10,11,12]:[1,3,5]}function VB(e=!1){return{descriptor:e?"Final set":"Best of",bestOf:e?void 0:3,advantage:"Ad",what:LB,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}}function jB(e){return!(!e?.tiebreakSet?.tiebreakTo||e?.setTo)}function GB(e){return e<=1?[]:[e-1,e]}function WB(e){if(e)return e.tiebreakSet?.modifier||e.tiebreakFormat?.modifier||e.modifier||void 0}function qB(e,t){const r=t(e);if(!r)return{matchRoot:void 0,aggregate:void 0,gameFormat:void 0,setFormat:VB(!1),finalSetFormat:VB(!0)};const i=VB(!1),n=VB(!0),a={matchRoot:r.matchRoot||void 0,aggregate:r.aggregate||void 0,gameFormat:r.gameFormat||void 0,setFormat:{...i,...r.setFormat},finalSetFormat:{...n,...r.finalSetFormat}};r.setFormat?.based&&(a.setFormat.based=r.setFormat.based),r.finalSetFormat?.based&&(a.finalSetFormat.based=r.finalSetFormat.based);const o=WB(r.setFormat);o&&(a.setFormat.modifier=o);const s=WB(r.finalSetFormat);return s&&(a.finalSetFormat.modifier=s),r.exactly?(a.setFormat.exactly=r.exactly,a.setFormat.descriptor="Exactly",delete a.setFormat.bestOf,a.setFormat.timed&&(a.setFormat.what=FB)):(a.setFormat.bestOf=r.bestOf||3,a.setFormat.descriptor="Best of",delete a.setFormat.exactly),jB(r.setFormat)&&(a.setFormat.what=_B,a.setFormat.tiebreakTo=r.setFormat.tiebreakSet.tiebreakTo,a.setFormat.winBy=r.setFormat.tiebreakSet.NoAD?1:2),r.setFormat?.timed&&(a.setFormat.what=FB,a.setFormat.minutes=r.setFormat.minutes),jB(r.finalSetFormat)&&(a.finalSetFormat.what=_B,a.finalSetFormat.tiebreakTo=r.finalSetFormat.tiebreakSet.tiebreakTo,a.finalSetFormat.winBy=r.finalSetFormat.tiebreakSet.NoAD?1:2),r.finalSetFormat?.timed&&(a.finalSetFormat.what=FB,a.finalSetFormat.minutes=r.finalSetFormat.minutes),a}const HB=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"},{key:"1pointslam",name:"1 Point Slam",format:"SET1-S:TB1NOAD"},{key:"pickleball",name:"Pickleball Standard",format:"SET3-S:TB11",desc:"Best of 3 games to 11"},{key:"pickleballRally",name:"Pickleball Rally",format:"SET3-S:TB11@RALLY",desc:"Best of 3 games to 11, rally scoring"},{key:"mlp",name:"MLP Format",format:"SET5-S:TB21@RALLY-F:TB15@RALLY",desc:"Best of 5 to 21, final to 15, rally scoring"},{key:"padel",name:"Padel Standard",format:"SET3-S:6NOAD/TB7",desc:"Best of 3 sets to 6, golden point"},{key:"padelStarPoint",name:"Padel Star Point (2026)",format:"SET3-S:6NOAD/TB7-G:TN3D",desc:"Best of 3 sets to 6, golden point, Star Point deuce"},{key:"squash",name:"Squash PAR-11",format:"SET5-S:TB11",desc:"Best of 5 games to 11"},{key:"badminton",name:"Badminton BWF",format:"SET3-S:TB21",desc:"Best of 3 games to 21"},{key:"volleyball",name:"Volleyball Indoor",format:"SET5-S:TB25-F:TB15",desc:"Best of 5 sets to 25, final to 15"},{key:"beachVolleyball",name:"Beach Volleyball",format:"SET3-S:TB21-F:TB15",desc:"Best of 3 sets to 21, final to 15"},{key:"soccer",name:"Soccer",format:"HAL2A-S:T45",desc:"2 halves of 45 minutes, aggregate"},{key:"basketball",name:"Basketball NBA",format:"QTR4A-S:T12",desc:"4 quarters of 12 minutes, aggregate"},{key:"iceHockey",name:"Ice Hockey",format:"PER3A-S:T20",desc:"3 periods of 20 minutes, aggregate"},{key:"boxing",name:"Boxing Championship",format:"RND12A-S:T3",desc:"12 rounds of 3 minutes, aggregate"},{key:"mma",name:"MMA Standard",format:"RND3A-S:T5",desc:"3 rounds of 5 minutes, aggregate"},{key:"typti",name:"TYPTI Standard",format:"SET5-S:5-G:3C",desc:"Best of 5 sets to 5, 3 consecutive points/game"},{key:"intennse",name:"INTENNSE",format:"SET7XA-S:T10P",desc:"Exactly 7 timed sets, aggregate, points-based"}],zB="none",YB="\u25be";function KB(e){return"function"==typeof e}const XB={labels:{title:"Match format",setFormatLabel:"Set format",finalSetLabel:"Final set",tiebreakLabel:"Tiebreak",finalSetToggleLabel:"Final set",standardFormatsLabel:"Standard formats",descriptors:{bestOf:"Best of",exactly:"Exactly"},what:{sets:"Set",tiebreaks:"Tiebreak",timedSets:"Timed set"},advantage:{ad:"Ad",noAd:"No-Ad"}},options:{bestOf:[1,3,5],exactly:[1,2,3,4,5,6,7,8,9,10,11,12],setTo:[1,2,3,4,5,6,7,8,9],tiebreakTo:[1,3,5,7,9,10,11,12,13,15,21,25],tiebreakToExactly:[1,3],tiebreakAt:[3,4,5,6,7,8],minutes:[3,5,8,10,12,15,20,25,30,45,60,90,120],winBy:[1,2],matchRoots:["SET","HAL","QTR","PER","INN","RND","FRM","MAP"],gameFormats:["None","TN","2C","3C","4C"],modifiers:["None","RALLY"]}};let QB,JB,ZB=XB,e$={};function t$(e){return e$[e]||document.getElementById(e)||null}const r$="Timed set",i$="Tiebreak",n$="No-Ad",a$="Set",o$="Ad",s$={G:"Games",P:"Points"},c$={Games:"G",Points:"P"},u$={None:"None",TN:"Traditional","2C":"2 consecutive","3C":"3 consecutive","4C":"4 consecutive"},l$={None:"None","1D":"Golden point","3D":"Star point"};function d$(e){if(!e)return"None";let t="";if("TRADITIONAL"===e.type)t="Traditional";else{if("CONSECUTIVE"!==e.type)return"None";t=u$[`${e.count}C`]||`${e.count} consecutive`}return e.deuceAfter&&(t+=` + ${l$[`${e.deuceAfter}D`]||`${e.deuceAfter}D`}`),t}const p$={matchRoot:void 0,aggregate:void 0,gameFormat:void 0,setFormat:{descriptor:"Best of",bestOf:3,advantage:o$,what:a$,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:o$,what:a$,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function m$(e){return function(e,t){const{what:r,setTo:i,tiebreakAt:n,tiebreakTo:a,winBy:o,minutes:s,advantage:c,based:u,modifier:l}=e,d={setTo:i};return r===LB&&"No-Ad"===c&&(d.NoAD=!0),t&&r===LB&&(d.tiebreakAt=n,d.tiebreakFormat={tiebreakTo:a},1===o&&(d.tiebreakFormat.NoAD=!0),l&&(d.tiebreakFormat.modifier=l)),r===FB&&(d.minutes=s,d.timed=!0,u&&(d.based=u),l&&(d.modifier=l)),r===_B&&(d.tiebreakSet={tiebreakTo:a},1===o&&(d.tiebreakSet.NoAD=!0),l&&(d.tiebreakSet.modifier=l)),d}(p$[e?"finalSetFormat":"setFormat"],t$(e?"finalSetTiebreak":"setTiebreak")?.checked||!1)}function f$(){JB={setFormat:m$()},p$.matchRoot&&"SET"!==p$.matchRoot&&(JB.matchRoot=p$.matchRoot),p$.aggregate&&(JB.aggregate=!0),p$.gameFormat&&(JB.gameFormat=p$.gameFormat);const e=p$.setFormat.descriptor,t=p$.setFormat.exactly??p$.setFormat.bestOf??3;"Exactly"===e?(JB.exactly=t,delete JB.bestOf):(JB.bestOf=t,delete JB.exactly),t$("finalSetOption")?.checked&&(JB.finalSetFormat=m$(1));const r=$r.scoreGovernor.stringifyMatchUpFormat(JB),i=(ZB.preDefinedFormats?ZB.preDefinedFormats.map(e=>({value:e.code,label:e.text,format:e.code})):HB).some(e=>e.format===r),n=t$("matchUpFormatSelector");if(n){const e=n.value,t=i?r:"Custom";if(e!==t){const e=n.onchange;n.onchange=null,n.value=t,n.onchange=e}}return r}function h$(e){const t=e||f$();QB=t;const r=t$("matchUpFormatString");r&&(r.innerHTML=t)}const g$=(e,t)=>t&&e.finalSetFormat||e.setFormat,I$=[{getValue:e=>e.exactly?ZB.labels?.descriptors?.exactly||"Exactly":ZB.labels?.descriptors?.bestOf||"Best of",options:()=>[ZB.labels?.descriptors?.bestOf||"Best of",ZB.labels?.descriptors?.exactly||"Exactly"],id:"descriptor",value:ZB.labels?.descriptors?.bestOf||"Best of",finalSet:!1,onChange:"changeDescriptor"},{getValue:e=>e.bestOf||e.exactly,finalSet:!1,id:"bestOf",options:()=>p$.setFormat.descriptor===(ZB.labels?.descriptors?.exactly||"Exactly")?ZB.options?.exactly||XB.options.exactly:$B(p$.matchRoot),onChange:"pluralize",onChangeCallback:"updateFinalSetVisibility",value:3},{getValue:(e,t)=>{const r=g$(e,t),i=r?.NoAD?n$:o$;return r?.timed||r?.tiebreakSet?void 0:i},options:[o$,n$],onChange:"changeAdvantage",defaultValue:o$,id:"advantage",whats:[a$]},{getValue:(e,t)=>{const r=g$(e,t);return r||console.log({pmf:e}),r?.timed?r$:r?.tiebreakSet?i$:a$},options:[a$,i$,r$],finalSetLabel:`${a$}${YB}`,onChange:"changeWhat",onChangeCallback:"updateWhatValue",pluralize:!0,id:"what"},{getValue:(e,t)=>g$(e,t).setTo,options:()=>ZB.options?.setTo||XB.options.setTo,onChange:"changeCount",defaultValue:6,whats:[a$],prefix:"to ",id:"setTo"},{getValue:(e,t)=>{const r=g$(e,t);return r.tiebreakFormat?.tiebreakTo||r.tiebreakSet?.tiebreakTo},options:e=>{const t=p$.setFormat.descriptor,r=ZB.options?.tiebreakTo||XB.options.tiebreakTo,i=ZB.options?.tiebreakToExactly||XB.options.tiebreakToExactly;return e&&"Exactly"===t?[...i,...r]:r},onChange:"changeTiebreakTo",whats:[a$,i$],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(e,t)=>g$(e,t).tiebreakAt,options:e=>GB(p$[e?"finalSetFormat":"setFormat"].setTo),onChange:"changeTiebreakAt",id:"tiebreakAt",defaultValue:6,whats:[a$],prefix:"@",value:6,tb:!0},{getValue:(e,t)=>{const r=g$(e,t);return r.tiebreakFormat||r.tiebreakSet?r.tiebreakFormat?.NoAD||r.tiebreakSet?.NoAD?1:2:void 0},whats:[a$,i$],onChange:"changeWinBy",prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(e,t)=>{const r=g$(e,t);return r.timed&&r.minutes||void 0},options:()=>ZB.options?.minutes||XB.options.minutes,onChange:"changeMinutes",whats:[r$],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0},{getValue:(e,t)=>{const r=g$(e,t);if(!r?.timed)return;const i=r.based||"G";return s$[i]||i},options:()=>["Games","Points"],onChange:"changeBased",whats:[r$],defaultValue:"Games",id:"based",timed:!0},{getValue:(e,t)=>{const r=g$(e,t);return r?.tiebreakSet?.modifier||r?.tiebreakFormat?.modifier||r?.modifier||void 0},options:()=>ZB.options?.modifiers||XB.options.modifiers,onChange:"changeModifier",whats:[i$,r$],prefix:"@",defaultValue:"None",id:"modifier",tb:!0}],y$={changeDescriptor:(e,t,r)=>{p$.setFormat.descriptor=r;const i=p$.setFormat.bestOf||p$.setFormat.exactly||3;if("Exactly"===r){if(p$.setFormat.what!==r$){delete p$.setFormat.setTo,delete p$.setFormat.tiebreakAt,delete p$.setFormat.tiebreakTo,delete p$.setFormat.winBy,delete p$.setFormat.tiebreakFormat,delete p$.setFormat.NoAD,p$.setFormat.what=r$,p$.setFormat.minutes||(p$.setFormat.minutes=10),y$.changeWhat(new Event("click"),void 0,r$);const e=t$("what");if(e){const t=i>1?"s":"";e.innerHTML=`${r$}${t}${YB}`}const t=t$("minutes");t&&(t.innerHTML=`${p$.setFormat.minutes} Minutes${YB}`,t.style.display="");const r=t$("based");if(r){const e=p$.setFormat.based||"G";r.innerHTML=`${s$[e]||e}${YB}`,r.style.display=""}}p$.setFormat.exactly=i,delete p$.setFormat.bestOf}else{const e=i%2==0?i+1:i;p$.setFormat.bestOf=e,delete p$.setFormat.exactly;const t=t$("bestOf");t&&(t.innerHTML=`${e}${YB}`),e!==i&&y$.pluralize(new Event("click"),void 0,e)}const n=t$("tiebreakTo-1");if(n&&n.style.display!==zB){const e=p$.finalSetFormat.tiebreakTo||7,t=I$.find(e=>"tiebreakTo"===e.id);if(t){const{prefix:r="",suffix:i=""}=t,a=(KB(t.options)?t.options(1):t.options).includes(e)?e:7;a!==e&&(p$.finalSetFormat.tiebreakTo=a),n.innerHTML=`${r}${a}${i}${YB}`}}h$()},changeWhat:(e,t,r)=>{const i=r===a$,n=t$(t?"finalSetTiebreakToggle":"setTiebreakToggle");if(n&&(n.style.display=i?"":zB),!t&&r!==r$&&"Exactly"===p$.setFormat.descriptor){p$.setFormat.descriptor="Best of";const e=p$.setFormat.exactly||3,t=e%2==0?e+1:e;p$.setFormat.bestOf=t,delete p$.setFormat.exactly;const r=t$("descriptor");r&&(r.innerHTML=`Best of${YB}`);const i=t$("bestOf");i&&(i.innerHTML=`${t}${YB}`)}I$.forEach(e=>{if(e.whats){const{prefix:i="",suffix:n="",pluralize:a}=e,o=e.whats.includes(r),s=t$(t?`${e.id}-${t}`:e.id);if(!s)return;if(s.style.display===zB&&o){const r=JB.bestOf||JB.exactly,o=!t&&a&&r>1?"s":"",c=e.defaultValue;s.innerHTML=`${i}${c}${o}${n}${YB}`;let u=c;if("modifier"===e.id&&"None"===c&&(u=void 0),"based"===e.id){const e=c$[c]||c;u="G"===e?void 0:e}p$[t?"finalSetFormat":"setFormat"][e.id]=u}s.style.display=o?"":zB}}),h$()},changeCount:(e,t,r)=>{const i=t?"finalSetFormat":"setFormat";p$[i].setTo=r;const n=p$[i].tiebreakAt,a=function(e,t){return GB(e).includes(t)?t:e}(r,n);if(a!==n){p$[i].tiebreakAt=a;const e=t$(t?`tiebreakAt-${t}`:"tiebreakAt");e&&(e.innerHTML=`@${a}${YB}`)}h$()},changeTiebreakAt:(e,t,r)=>{p$[t?"finalSetFormat":"setFormat"].tiebreakAt=r,h$()},updateWhatValue:(e,t,r)=>{p$[t?"finalSetFormat":"setFormat"].what=r},changeAdvantage:(e,t,r)=>{p$[t?"finalSetFormat":"setFormat"].advantage=r,h$()},changeTiebreakTo:(e,t,r)=>{p$[t?"finalSetFormat":"setFormat"].tiebreakTo=r,h$()},changeWinBy:(e,t,r)=>{p$[t?"finalSetFormat":"setFormat"].winBy=r,h$()},changeMinutes:(e,t,r)=>{p$[t?"finalSetFormat":"setFormat"].minutes=r,h$()},changeBased:(e,t,r)=>{const i=c$[r]||r;if(p$[t?"finalSetFormat":"setFormat"].based="G"===i?void 0:i,!t){const e=t$("gameFormat");e&&("P"===i?(p$.gameFormat=void 0,e.style.display=zB):e.style.display="")}h$()},changeModifier:(e,t,r)=>{p$[t?"finalSetFormat":"setFormat"].modifier="None"===r?void 0:r,h$()},changeMatchRoot:(e,t,r)=>{const i=p$.matchRoot||"SET";if(p$.matchRoot="SET"===r?void 0:r,i!==r){const e=$B(p$.matchRoot),t=p$.setFormat.bestOf;if(t&&!e.includes(t)){const r=e[e.length-1]>=t?e.reduce((e,r)=>r<=t?r:e,e[0]):e[e.length-1];p$.setFormat.bestOf=r;const i=t$("bestOf");i&&(i.innerHTML=`${r}${YB}`)}}h$()},changeAggregate:(e,t,r)=>{const i=t$("aggregateOption");p$.aggregate=i?.checked||void 0,h$()},changeGameFormat:(e,t,r)=>{p$.gameFormat=r,h$()},pluralize:(e,t,r)=>{const i=p$[t?"finalSetFormat":"setFormat"].what,n=t$(t?`what-${t}`:"what"),a=r>1?"s":"";n&&(n.innerHTML=`${i}${a}${YB}`),t||("Exactly"===p$.setFormat.descriptor?(p$.setFormat.exactly=r,delete p$.setFormat.bestOf):(p$.setFormat.bestOf=r,delete p$.setFormat.exactly)),h$()},updateFinalSetVisibility:(e,t,r)=>{const i=r>1,n=t$("finalSetOption"),a=t$("finalSetOptionLabel");n&&a&&(i?(n.style.display="",a.style.display=""):(n.checked&&(n.checked=!1,n.dispatchEvent(new Event("change"))),n.style.display="none",a.style.display="none"))}};function v$({existingMatchUpFormat:e="SET3-S:6/TB7",callback:t,config:r,modalConfig:i}={}){ZB=r?{labels:{...XB.labels,...r.labels},options:{...XB.options,...r.options},preDefinedFormats:r.preDefinedFormats||XB.preDefinedFormats}:XB,QB=e,e$={},JB=NC.parse(QB),JB||(console.warn("Invalid matchUpFormat:",QB),QB="SET3-S:6/TB7",JB=NC.parse(QB));const n=qB(QB,NC.parse);p$.matchRoot=n.matchRoot,p$.aggregate=n.aggregate,p$.gameFormat=n.gameFormat,p$.setFormat={...n.setFormat},p$.finalSetFormat={...n.finalSetFormat};const a=[{onClick:()=>{w$(),t?.("")},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{label:"Select",intent:"is-info",close:!0,onClick:()=>{w$(),(()=>{const e=t$("matchUpFormatSelector"),r=e?.value&&"Custom"!==e.value?QB:f$();KB(t)&&t(r)})()}}],o="switch is-rounded is-danger",s=document.createElement("div");s.addEventListener("click",e=>{const t=e.target;!t.closest(".dropdown")&&!t.classList.contains("mfcButton")&&w$()});const c=document.createElement("div");c.id="matchUpFormatString",c.innerHTML=QB,c.style.fontSize="1.5em",c.style.color="blue",c.style.marginBottom="1em",e$.matchUpFormatString=c,s.appendChild(c);const u=document.createElement("div");u.style.marginBlockEnd="1em";const l=[{value:"Custom",label:"Custom",selected:!1},...(ZB.preDefinedFormats?ZB.preDefinedFormats.map(e=>({value:e.code,label:e.text,format:e.code})):HB).filter(e=>e.format).map(e=>({selected:e.format===QB,value:e.format,label:("label"in e?e.label:e.name)||""}))],d=document.createElement("select");d.id="matchUpFormatSelector",d.className="input",d.style.width="100%",d.style.backgroundColor="#ffffff",d.style.color="#363636",d.style.border="1px solid #b5b5b5";for(const O of l){const e=document.createElement("option");e.value=O.value||"",e.text=O.label||"",e.style.backgroundColor="#ffffff",e.style.color="#363636",O.selected&&(e.selected=!0),d.appendChild(e)}e$.matchUpFormatSelector=d,d.onchange=e=>{if(QB=e.target.value,h$(QB),JB=NC.parse(QB),!JB)return void console.warn("Invalid matchUpFormat selected:",QB);const t=qB(QB,NC.parse);p$.matchRoot=t.matchRoot,p$.aggregate=t.aggregate,p$.gameFormat=t.gameFormat,p$.setFormat={...t.setFormat},p$.finalSetFormat={...t.finalSetFormat};const r=t$("matchRoot");if(r){const e=p$.matchRoot||"SET";r.innerHTML=`${BB[e]||e}${YB}`}const i=t$("aggregateOption");i&&(i.checked=!!p$.aggregate);const n=t$("gameFormat");n&&(n.innerHTML=`Game: ${d$(p$.gameFormat)}${YB}`,n.style.display="P"===p$.setFormat.based?zB:"");const a=JB.bestOf||JB.exactly;y$.updateFinalSetVisibility(null,0,a);const o=JB.finalSetFormat;P.style.display=o?"":zB,N.style.display=o?"":zB,T.checked=!!o;const s=o?.tiebreakSet?.tiebreakTo&&!o?.setTo;M.checked=!!o?.tiebreakFormat,M.style.display=s?zB:"";const c=t$("finalSetTiebreakToggle");c&&(c.style.display=s?zB:"");const u=p$.setFormat.what,l=!!JB.setFormat.tiebreakFormat;b.checked=l;const d=u===a$;b.style.display=d?"":zB;const p=t$("setTiebreakToggle");p&&(p.style.display=d?"":zB),I$.forEach(e=>{if(e.getValue){const t=e.getValue(JB),r=t$(e.id);if(r&&null!=t){const{prefix:i="",suffix:n="",pluralize:a}=e,o=JB.bestOf||JB.exactly,s=a&&o>1?"s":"";r.innerHTML=`${i}${t}${s}${n}${YB}`,r.style.display=""}else r&&(r.style.display=zB);if(e.tb&&u===a$){const t=t$(e.id);t&&(t.style.display=l?t.style.display:zB)}if(o){const t=e.getValue(JB,!0),r=t$(`${e.id}-1`);if(r&&null!=t){const{prefix:i="",suffix:n="",pluralize:a}=e,o=JB.bestOf||JB.exactly,s=a&&o>1?"s":"";r.innerHTML=`${i}${t}${s}${n}${YB}`,r.style.display=""}else r&&(r.style.display=zB)}}})},u.appendChild(d),s.appendChild(u);const p=document.createElement("div");p.style.display="flex",p.style.flexWrap="wrap",p.style.gap="0.5em",p.style.marginBottom="0.5em",p.style.alignItems="center";const m=p$.matchRoot||"SET",f=document.createElement("button");f.className="mfcButton",f.id="matchRoot",f.innerHTML=`${BB[m]||m}${YB}`,f.style.transition="all .2s ease-in-out",f.style.backgroundColor="inherit",f.style.border="none",f.style.color="inherit",f.style.padding=".3em",f.style.textAlign="center",f.style.textDecoration="none",f.style.fontSize="1em",f.style.cursor="pointer",f.onclick=e=>{const t=(ZB.options?.matchRoots||XB.options.matchRoots).map(t=>({text:`${BB[t]||t}`,onClick:()=>{f.innerHTML=`${BB[t]||t}${YB}`,y$.changeMatchRoot(e,void 0,t)}}));T$(e,t)},p.appendChild(f);const h=document.createElement("input");h.type="checkbox",h.className="switch is-rounded is-warning",h.id="aggregateOption",h.name="aggregateOption",h.checked=!!p$.aggregate,h.onchange=()=>{y$.changeAggregate(new Event("change"),void 0,void 0)},p.appendChild(h);const g=document.createElement("label");g.setAttribute("for","aggregateOption"),g.innerHTML="Aggregate",g.style.marginRight="1em",p.appendChild(g);const I=d$(p$.gameFormat),y=document.createElement("button");y.className="mfcButton",y.id="gameFormat",y.innerHTML=`Game: ${I}${YB}`,y.style.transition="all .2s ease-in-out",y.style.backgroundColor="inherit",y.style.border="none",y.style.color="inherit",y.style.padding=".3em",y.style.textAlign="center",y.style.textDecoration="none",y.style.fontSize="1em",y.style.cursor="pointer","P"===p$.setFormat.based&&(y.style.display=zB),y.onclick=e=>{!function(e,t,r){w$();const i=document.createElement("div");i.className="dropdown is-active",i.style.position="absolute",i.style.zIndex="10000";const n=document.createElement("div");n.className="dropdown-menu",n.style.backgroundColor="white",n.style.border="1px solid #ddd",n.style.borderRadius="4px",n.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)",n.style.padding="0.25em 0",n.style.minWidth="180px";let a="none",o="none";function s(e,t){if("none"===e&&"none"===t)return;const r={};return"TN"===e?r.type="TRADITIONAL":/^\d+C$/.test(e)?(r.type="CONSECUTIVE",r.count=Number(e.slice(0,-1))):r.type="TRADITIONAL","none"!==t&&(r.deuceAfter=Number(t.slice(0,-1))),r}function c(){const e=i.querySelector('input[name="gameType"]:checked'),t=i.querySelector('input[name="deuceRule"]:checked');r(s(e?.value||"none",t?.value||"none"))}"TRADITIONAL"===t?.type?a="TN":"CONSECUTIVE"===t?.type&&(a=`${t.count}C`),t?.deuceAfter&&(o=`${t.deuceAfter}D`);const u="padding: 0.4em 1em; cursor: pointer; background-color: white; color: #363636; font-size: 1rem;",l="padding: 0.3em 1em; font-weight: bold; font-size: 0.85rem; color: #888; text-transform: uppercase; letter-spacing: 0.5px;",d="border-top: 1px solid #eee; margin: 0.25em 0;",p=document.createElement("div");function m(e,t,r,i){const n=document.createElement("label");n.style.cssText="display: flex; align-items: center; padding: 0.3em 1em; cursor: pointer; gap: 0.4em; font-size: 1rem; color: #363636;",n.onmouseenter=()=>{n.style.backgroundColor="#f5f5f5"},n.onmouseleave=()=>{n.style.backgroundColor="white"};const a=document.createElement("input");a.type="radio",a.name=e,a.value=t,a.checked=i,a.style.margin="0",a.onchange=()=>c();const o=document.createElement("span");return o.textContent=r,n.appendChild(a),n.appendChild(o),n}p.textContent="None",p.style.cssText=u,p.onmouseenter=()=>{p.style.backgroundColor="#f5f5f5"},p.onmouseleave=()=>{p.style.backgroundColor="white"},p.onclick=e=>{e.preventDefault(),e.stopPropagation(),r(void 0),w$()},n.appendChild(p);const f=document.createElement("div");f.style.cssText=d,n.appendChild(f);const h=document.createElement("div");h.style.cssText=l,h.textContent="Game type",n.appendChild(h);const g=[{value:"none",label:"None"},{value:"TN",label:"Traditional"},{value:"2C",label:"2 consecutive"},{value:"3C",label:"3 consecutive"},{value:"4C",label:"4 consecutive"}];for(const b of g)n.appendChild(m("gameType",b.value,b.label,a===b.value));const I=document.createElement("div");I.style.cssText=d,n.appendChild(I);const y=document.createElement("div");y.style.cssText=l,y.textContent="Deuce rule",n.appendChild(y);const v=[{value:"none",label:"None"},{value:"1D",label:"Golden point"},{value:"3D",label:"Star point"}];for(const b of v)n.appendChild(m("deuceRule",b.value,b.label,o===b.value));i.appendChild(n);const S=e.target.getBoundingClientRect();i.style.left=`${S.left}px`,i.style.top=`${S.bottom}px`,document.body.appendChild(i),b$=i,setTimeout(()=>{U$=e=>{i.contains(e.target)||w$()},document.addEventListener("click",U$)},100)}(e,p$.gameFormat,e=>{p$.gameFormat=e,y.innerHTML=`Game: ${d$(p$.gameFormat)}${YB}`,h$()})},p.appendChild(y),e$.matchRoot=f,e$.aggregateOption=h,e$.gameFormat=y,s.appendChild(p);const v=document.createElement("div");v.style.display="flex",v.style.flexWrap="wrap",v.style.gap="0.5em",v.style.marginBottom="1em",I$.map(e=>{const t=e.getValue?e.getValue(JB):void 0,r=S$({...e,value:t});return e$[e.id]=r,r}).forEach(e=>v.appendChild(e)),v.id="setFormat",s.appendChild(v);const S=document.createElement("div");S.className="field",S.style.fontSize="1em";const b=document.createElement("input");b.className=o,b.name="setTiebreak",b.id="setTiebreak",b.type="checkbox",b.checked=!!JB.setFormat.tiebreakFormat,e$.setTiebreak=b,b.onchange=e=>{const t=e.target.checked;I$.filter(({tb:e})=>e).forEach(e=>{const r=t$(e.id);if(r){if(r.style.display===zB&&t){const{prefix:t="",suffix:i="",pluralize:n,defaultValue:a}=e,o=JB.bestOf||JB.exactly,s=n&&o>1?"s":"";r.innerHTML=`${t}${a}${s}${i}${YB}`}r.style.display=t?"":zB}}),h$()},S.appendChild(b);const U=document.createElement("label");U.setAttribute("for","setTiebreak"),U.id="setTiebreakToggle",U.innerHTML="Tiebreak",U.style.marginRight="1em",e$.setTiebreakToggle=U,S.appendChild(U);const w=(JB.bestOf||JB.exactly)>1,T=document.createElement("input");T.className="switch is-rounded is-info",T.type="checkbox",T.name="finalSetOption",T.checked=!!JB.finalSetFormat,T.id="finalSetOption",e$.finalSetOption=T,T.style.display=w?"":"none",T.onchange=e=>{const t=e.target.checked;if(t){p$.finalSetFormat={...p$.setFormat,descriptor:"Final set"};const e=p$.setFormat.what,t=p$.setFormat.bestOf||p$.setFormat.exactly||3,r=t$("what-1");if(r){const i=t>1?"s":"";r.innerHTML=`${e}${i}${YB}`}I$.forEach(t=>{const r=t$(`${t.id}-1`);if(r)if(!t.whats||t.whats.includes(e)){const e=p$.finalSetFormat[t.id];if(void 0!==e){const{prefix:i="",suffix:n=""}=t;r.innerHTML=`${i}${e}${n}${YB}`}r.style.display=""}else r.style.display=zB});const i=t$("finalSetTiebreakToggle");if(i&&(i.style.display=e===a$?"":zB),e===a$){const e=t$("setTiebreak"),t=t$("finalSetTiebreak");e&&t&&(t.checked=e.checked)}}P.style.display=t?"":zB,N.style.display=t?"":zB,h$()},S.appendChild(T);const D=document.createElement("label");D.setAttribute("for","finalSetOption"),D.innerHTML="Final set",D.style.display=w?"":"none",e$.finalSetOptionLabel=D,S.appendChild(D),s.appendChild(S);const P=document.createElement("div");P.style.display=JB.finalSetFormat?"flex":zB,P.style.flexWrap="wrap",P.style.gap="0.5em",P.style.marginBottom="1em",P.id="finalSetFormat",e$.finalSetFormatDiv=P,[{label:"<div style='font-weight: bold'>Final set</div>",options:[],finalSet:!0}].concat(I$.map(e=>{const t=e.getValue?e.getValue(JB,!0):void 0;return{...e,value:t}})).filter(e=>!1!==e.finalSet).map(e=>{const t=S$({...e,index:1});return e.id&&(e$[`${e.id}-1`]=t),t}).forEach(e=>P.appendChild(e)),s.appendChild(P);const N=document.createElement("div");N.id="finalSetConfig",e$.finalSetConfigDiv=N,N.style.display=JB.finalSetFormat?"":zB,N.className="field",N.style.fontSize="1em";const E=JB.finalSetFormat?.tiebreakSet?.tiebreakTo&&!JB.finalSetFormat?.setTo,M=document.createElement("input");M.className=o,M.name="finalSetTiebreak",M.id="finalSetTiebreak",e$.finalSetTiebreak=M,M.type="checkbox",M.checked=JB.finalSetFormat?!!JB.finalSetFormat.tiebreakFormat:!!JB.setFormat.tiebreakFormat,M.style.display=E?zB:"",N.onchange=e=>{const t=e.target.checked;I$.filter(({tb:e})=>e).forEach(e=>{const r=t$(`${e.id}-1`);if(r){if(r.style.display===zB&&t){const{prefix:t="",suffix:i="",pluralize:n,defaultValue:a}=e,o=JB.bestOf||JB.exactly,s=n&&o>1?"s":"";r.innerHTML=`${t}${a}${s}${i}${YB}`}r.style.display=t?"":zB}}),h$()},N.appendChild(M);const R=document.createElement("label");R.setAttribute("for","finalSetTiebreak"),R.id="finalSetTiebreakToggle",R.innerHTML="Tiebreak",R.style.marginRight="1em",R.style.display=E?zB:"",e$.finalSetTiebreakToggle=R,N.appendChild(R),s.appendChild(N);const A={content:{padding:"1.5"},maxWidth:480,fontSize:"14px",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 8px 16px rgba(0, 102, 204, 0.2)"}},C=i?.fontSize||i?.style?.fontSize||A.fontSize,k={...A,...i,fontSize:C,style:{...A.style,...r?.style||{},...i?.style||{}}},x=Ue.open({title:"Score format",content:s,buttons:a,config:k});return setTimeout(()=>{if(JB.finalSetFormat?.tiebreakSet?.tiebreakTo&&!JB.finalSetFormat?.setTo){const e=t$("what-1");e&&(e.innerHTML=`${i$}${YB}`),y$.changeWhat(new Event("click"),1,i$)}const e=document.querySelector(".modal.is-active");if(e){const t=new MutationObserver(r=>{r.forEach(r=>{r.removedNodes.forEach(r=>{r===e&&(w$(),t.disconnect())})})});t.observe(document.body,{childList:!0})}},0),x}function S$(e){const{id:t,initiallyHidden:r,index:i,value:n}=e,a=document.createElement("button");return a.className="mfcButton",a.id=i?`${t}-${i}`:t,a.innerHTML=function({index:e,finalSetLabel:t,label:r,prefix:i="",suffix:n="",value:a,pluralize:o}){const s=p$.setFormat.bestOf||p$.setFormat.exactly||1;return r||e&&t||`${i}${a}${!e&&o&&s>1?"s":""}${n}${YB}`}(e),a.onclick=t=>function(e){const{e:t,id:r,button:i,pluralize:n,options:a,onChange:o,onChangeCallback:s,index:c,prefix:u="",suffix:l=""}=e,d=p$.setFormat.bestOf||p$.setFormat.exactly||1,p=!c&&n&&d>1?"s":"",m=(KB(a)?a(c):a).map(e=>({text:`${e}${p}`,onClick:()=>{i.innerHTML=`${u}${e}${p}${l}${YB}`,p$[c?"finalSetFormat":"setFormat"][r]=e,o&&KB(y$[o])&&y$[o](t,c,e),s&&KB(y$[s])&&y$[s](t,c,e),h$()}}));T$(t,m)}({e:t,button:a,...e}),a.style.display=n||e.label?"":zB,r&&(a.style.display=zB),a.style.transition="all .2s ease-in-out",a.style.backgroundColor="inherit",a.style.border="none",a.style.color="inherit",a.style.padding=".3em",a.style.textAlign="center",a.style.textDecoration="none",a.style.fontSize="1em",a.style.cursor="pointer",a}let b$=null,U$=null;function w$(){b$&&document.body.contains(b$)&&b$.remove(),U$&&(document.removeEventListener("click",U$),U$=null),b$=null}function T$(e,t){w$();const r=document.createElement("div");r.className="dropdown is-active",r.style.position="absolute",r.style.zIndex="10000";const i=document.createElement("div");i.className="dropdown-menu",i.style.backgroundColor="white",i.style.border="1px solid #ddd",i.style.borderRadius="4px",i.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)";const n=()=>{w$()};t.forEach(e=>{const t=document.createElement("div");t.style.padding="0.5em 1em",t.style.cursor="pointer",t.style.backgroundColor="white",t.style.color="#363636",t.style.fontSize="1rem",t.style.lineHeight="1.5",t.textContent=e.text,t.onclick=t=>{t.preventDefault(),t.stopPropagation(),n(),e.onClick()},t.onmouseenter=()=>{t.style.backgroundColor="#f5f5f5",t.style.color="#363636"},t.onmouseleave=()=>{t.style.backgroundColor="white",t.style.color="#363636"},i.appendChild(t)}),r.appendChild(i);const a=e.target.getBoundingClientRect();r.style.left=`${a.left}px`,r.style.top=`${a.bottom}px`,document.body.appendChild(r),b$=r,setTimeout(()=>{U$=e=>{r.contains(e.target)||n()},document.addEventListener("click",U$)},100)}const D$=Object.freeze(Object.defineProperty({__proto__:null,getMatchUpFormatModal:v$},Symbol.toStringTag,{value:"Module"}));function P$(e){if(!e)return null;const t=e.trim().toUpperCase();if("OPEN"===t)return{type:"open"};const r=t.match(/^C(\d{1,2})-(\d{1,2})$/);if(r){const[,e,t]=r;return{type:"combined",ageMin:parseInt(e,10),ageMax:parseInt(t,10),isCombined:!0}}if(t.includes("-")){const e=t.split("-");if(2===e.length){const t=e[0],r=e[1];let i,n,a,o,s;const c=t.match(/^U?(\d{1,2})U?$/),u=t.match(/^O?(\d{1,2})O?$/),l=r.match(/^U?(\d{1,2})U?$/),d=r.match(/^O?(\d{1,2})O?$/);if(t.startsWith("U")||t.endsWith("U")?s="max-min":(t.startsWith("O")||t.endsWith("O"))&&(s="min-max"),t.startsWith("U")||t.endsWith("U")){if(c){const e=parseInt(c[1],10);n=t.startsWith("U")?e-1:e,a=t.startsWith("U")?"pre":"post"}}else if((t.startsWith("O")||t.endsWith("O"))&&u){const e=parseInt(u[1],10);i=t.startsWith("O")?e+1:e,o=t.startsWith("O")?"pre":"post"}if(r.startsWith("U")||r.endsWith("U")){if(l){const e=parseInt(l[1],10);n=r.startsWith("U")?e-1:e,a=r.startsWith("U")?"pre":"post"}}else if((r.startsWith("O")||r.endsWith("O"))&&d){const e=parseInt(d[1],10);i=r.startsWith("O")?e+1:e,o=r.startsWith("O")?"pre":"post"}if(void 0!==i||void 0!==n)return{type:"range",ageMin:i,ageMax:n,uPosition:a,oPosition:o,rangeOrder:s}}}const i=t.match(/^U(\d{1,2})$|^(\d{1,2})U$/);if(i){return{type:"under",ageValue:parseInt(i[1]||i[2],10),uPosition:i[1]?"pre":"post"}}const n=t.match(/^O(\d{1,2})$|^(\d{1,2})O$/);if(n){return{type:"over",ageValue:parseInt(n[1]||n[2],10),oPosition:n[1]?"pre":"post"}}return null}function N$(e){const{type:t,ageValue:r,ageMin:i,ageMax:n,uPosition:a="post",oPosition:o="post",rangeOrder:s="min-max"}=e;if("open"===t)return"OPEN";if("combined"===t&&void 0!==i&&void 0!==n)return`C${i}-${n}`;if("under"===t&&void 0!==r)return"pre"===a?`U${r}`:`${r}U`;if("over"===t&&void 0!==r)return"pre"===o?`O${r}`:`${r}O`;if("range"===t&&(void 0!==i||void 0!==n)){const e=void 0!==n&&a?(()=>{const e="pre"===a?n+1:n;return"pre"===a?`U${e}`:`${e}U`})():null,t=void 0!==i&&o?(()=>{const e="pre"===o?i-1:i;return"pre"===o?`O${e}`:`${e}O`})():null;return"max-min"===s?[e,t].filter(Boolean).join("-"):[t,e].filter(Boolean).join("-")}return""}function E$(e){switch(e){case"under":return"Simple Under";case"over":return"Simple Over";case"range":return"Range";case"combined":return"Combined";default:return"Open"}}const M$={labels:{title:"Age Category",consideredDateLabel:"Considered Date",typeLabel:"Category Type",ageLabel:"Age",standardCodesLabel:"Standard Categories"},options:{ages:[8,10,12,14,16,18,21,30,35,40,45,50,55,60,65,70,75,80,85,90],categoryTypes:["Simple Under","Simple Over","Range","Combined","Open"]},defaultConsideredDate:(new Date).toISOString().split("T")[0]};let R$,A$,C$=M$;const k$={type:"open"};let x$={};function O$(){const e=N$(k$);R$=e;const t=document.getElementById("ageCategoryCodeString");t&&(t.innerHTML=e||"Invalid"),function(){const e=N$(k$);if(e&&"OPEN"!==e)try{const t=hA.getCategoryAgeDetails({category:{ageCategoryCode:e},consideredDate:A$});if(t.error)return void(x$={errors:["string"==typeof t.error?t.error:t.error.message||"Invalid category or date"]});x$={ageMin:t.ageMin,ageMax:t.ageMax,ageMinDate:t.ageMinDate,ageMaxDate:t.ageMaxDate,errors:t.errors}}catch(t){x$={errors:[`Failed to calculate age details: ${t instanceof Error?t.message:"Unknown error"}`]}}else x$={}}(),function(){const e=document.getElementById("calculatedDetailsPanel");if(!e)return;if("open"===k$.type||!R$)return void(e.style.display="none");e.style.display="";const{ageMin:t,ageMax:r,ageMinDate:i,ageMaxDate:n,errors:a}=x$;let o='<div style="margin-top: 1em; padding: 0.75em; background: #f5f5f5; border-radius: 4px; color: #000;">';a&&a.length>0&&(o+='<div style="color: red; margin-bottom: 0.5em;"><strong style="color: #000;">Errors:</strong><ul style="margin: 0; padding-left: 1.5em; color: #000;">',a.forEach(e=>{o+=`<li style="color: red;">${e}</li>`}),o+="</ul></div>"),(void 0!==t||void 0!==r)&&(o+='<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Age Range:</strong> ',void 0!==t&&void 0!==r?o+=`${t} - ${r}`:void 0!==t?o+=`${t} and over`:void 0!==r&&(o+=`${r} and under`),o+="</div>"),i&&(o+=`<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Min Birth Date:</strong> ${i}</div>`),n&&(o+=`<div style="margin-bottom: 0.5em; color: #000;"><strong style="color: #000;">Max Birth Date:</strong> ${n}</div>`),o+="</div>",e.innerHTML=o}()}function F$(){const{type:e}=k$,t=document.getElementById("ageValue"),r="under"===e||"over"===e;t&&(t.style.display=r?"":"none");const i=document.getElementById("positionToggle"),n="under"===e||"over"===e;i&&(i.style.display=n?"":"none");const a=document.getElementById("ageMin"),o="range"===e||"combined"===e;a&&(a.style.display=o?"":"none");const s=document.getElementById("ageMax"),c="range"===e||"combined"===e;s&&(s.style.display=c?"":"none");const u=document.getElementById("combinedLabel");u&&(u.style.display="combined"===e?"":"none")}function _$(e){const{id:t,label:r,onClick:i,initiallyHidden:n}=e,a=document.createElement("button");return a.className="accButton",a.id=t,a.innerHTML=r,i&&(a.onclick=i),n&&(a.style.display="none"),a.style.transition="all .2s ease-in-out",a.style.backgroundColor="inherit",a.style.border="none",a.style.color="#000",a.style.padding=".3em",a.style.textAlign="center",a.style.textDecoration="none",a.style.fontSize="1em",a.style.cursor="pointer",a}let L$=null,B$=null;function $$(){L$&&document.body.contains(L$)&&L$.remove(),B$&&(document.removeEventListener("click",B$),B$=null),L$=null}function V$({existingAgeCategoryCode:e,existingCategory:t={},editorConfig:r,consideredDate:i,callback:n,config:a,modalConfig:o}={}){const s=r||a;C$=s?{labels:{...M$.labels,...s.labels},options:{...M$.options,...s.options},preDefinedCodes:s.preDefinedCodes||[{code:"OPEN",text:"Open (No age limit)"},{code:"8U",text:"8 and Under"},{code:"10U",text:"10 and Under"},{code:"12U",text:"12 and Under"},{code:"14U",text:"14 and Under"},{code:"16U",text:"16 and Under"},{code:"18U",text:"18 and Under"},{code:"21U",text:"21 and Under"},{code:"30O",text:"30 and Over"},{code:"35O",text:"35 and Over"},{code:"40O",text:"40 and Over"},{code:"45O",text:"45 and Over"},{code:"50O",text:"50 and Over"},{code:"55O",text:"55 and Over"},{code:"60O",text:"60 and Over"},{code:"65O",text:"65 and Over"},{code:"70O",text:"70 and Over"},{code:"75O",text:"75 and Over"},{code:"80O",text:"80 and Over"}],defaultConsideredDate:s.defaultConsideredDate||M$.defaultConsideredDate}:{...M$,preDefinedCodes:[{code:"OPEN",text:"Open (No age limit)"},{code:"8U",text:"8 and Under"},{code:"10U",text:"10 and Under"},{code:"12U",text:"12 and Under"},{code:"14U",text:"14 and Under"},{code:"16U",text:"16 and Under"},{code:"18U",text:"18 and Under"},{code:"21U",text:"21 and Under"},{code:"30O",text:"30 and Over"},{code:"35O",text:"35 and Over"},{code:"40O",text:"40 and Over"},{code:"45O",text:"45 and Over"},{code:"50O",text:"50 and Over"},{code:"55O",text:"55 and Over"},{code:"60O",text:"60 and Over"},{code:"65O",text:"65 and Over"},{code:"70O",text:"70 and Over"},{code:"75O",text:"75 and Over"},{code:"80O",text:"80 and Over"}]},A$=i||C$.defaultConsideredDate||(new Date).toISOString().split("T")[0];const c=e||t.ageCategoryCode||"OPEN";R$=c;const u=P$(c);u?Object.assign(k$,u):Object.assign(k$,{type:"open"});const l=[{onClick:()=>{$$(),n?.({...t,ageCategoryCode:""})},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{label:"Select",intent:"is-info",close:!0,onClick:()=>{$$(),(()=>{const e=N$(k$);(function(e){return"function"==typeof e})(n)&&n({...t,ageCategoryCode:e})})()}}],d=document.createElement("div");d.addEventListener("click",e=>{const t=e.target;!t.closest(".dropdown")&&!t.classList.contains("accButton")&&$$()});const p=document.createElement("div");p.id="ageCategoryCodeString",p.innerHTML=R$,p.style.fontSize="1.5em",p.style.color="blue",p.style.marginBottom="1em",p.style.fontWeight="bold",d.appendChild(p);const m=document.createElement("div");m.style.marginBottom="1em",MB(m,[{label:C$.labels?.standardCodesLabel||"Standard Categories",field:"standardCategory",id:"ageCategorySelector",options:[{label:"Custom",value:"Custom",selected:!C$.preDefinedCodes?.some(e=>e.code===R$)},...(C$.preDefinedCodes||[]).map(e=>({selected:e.code===R$,value:e.code,label:e.text}))],onChange:e=>{const t=e.target.value;if("Custom"===t)return;R$=t;const r=P$(t);r&&(Object.assign(k$,r),F$(),E(),O$())}},{label:C$.labels?.consideredDateLabel||"Considered Date",field:"consideredDate",id:"consideredDateInput",value:A$,date:!0,onChange:e=>{A$=e.target.value,O$()}}]),d.appendChild(m);const f=_$({id:"categoryType",label:`${E$(k$.type)}\u25be`,onClick:e=>{const t=(C$.options?.categoryTypes||["Simple Under","Simple Over","Range","Combined","Open"]).map(e=>({text:e,onClick:()=>{const t=function(e){switch(e){case"Simple Under":return"under";case"Simple Over":return"over";case"Range":return"range";case"Combined":return"combined";default:return"open"}}(e);k$.type=t,k$.ageValue=void 0,k$.ageMin=void 0,k$.ageMax=void 0,"under"===t||"over"===t?(k$.ageValue=18,k$.uPosition="post",k$.oPosition="post"):("range"===t||"combined"===t)&&(k$.ageMin=10,k$.ageMax=18,k$.uPosition="post",k$.oPosition="post",k$.rangeOrder="min-max"),k$.isCombined="combined"===t,f.innerHTML=`${e}\u25be`,F$(),E(),O$()}}));!function(e,t){$$();const r=document.createElement("div");r.className="dropdown is-active",r.style.position="absolute",r.style.zIndex="10000";const i=document.createElement("div");i.className="dropdown-menu",i.style.backgroundColor="white",i.style.border="1px solid #ddd",i.style.borderRadius="4px",i.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)";const n=()=>{$$()};t.forEach(e=>{const t=document.createElement("div");t.style.padding="0.5em 1em",t.style.cursor="pointer",t.style.backgroundColor="white",t.style.color="#363636",t.style.fontSize="1rem",t.style.lineHeight="1.5",t.textContent=e.text,t.onclick=t=>{t.preventDefault(),t.stopPropagation(),n(),setTimeout(()=>{e.onClick()},0)},t.onmouseenter=()=>{t.style.backgroundColor="#f5f5f5"},t.onmouseleave=()=>{t.style.backgroundColor="white"},i.appendChild(t)}),r.appendChild(i);const a=e.target.getBoundingClientRect();r.style.left=`${a.left}px`,r.style.top=`${a.bottom}px`,document.body.appendChild(r),L$=r,setTimeout(()=>{B$=e=>{r.contains(e.target)||n()},document.addEventListener("click",B$)},100)}(e,t)}}),h=document.createElement("div");h.style.display="flex",h.style.flexWrap="wrap",h.style.gap="0.5em",h.style.marginBottom="1em",h.appendChild(f);const g=document.createElement("div");g.id="ageValue",g.style.display="under"!==k$.type&&"over"!==k$.type?"none":"";const I=document.createElement("input");I.type="number",I.min="1",I.max="120",I.value=String(k$.ageValue||18),I.style.width="80px",I.style.padding="0.3em",I.style.border="1px solid #ddd",I.style.borderRadius="4px",I.oninput=()=>{const e=Number.parseInt(I.value,10);!Number.isNaN(e)&&e>=1&&e<=120&&(k$.ageValue=e,O$())},g.appendChild(I),h.appendChild(g);const y=_$({id:"positionToggle",label:N(),onClick:()=>{"under"===k$.type?k$.uPosition="pre"===k$.uPosition?"post":"pre":"over"===k$.type&&(k$.oPosition="pre"===k$.oPosition?"post":"pre"),y.innerHTML=N(),O$()},initiallyHidden:"under"!==k$.type&&"over"!==k$.type});h.appendChild(y);const v=document.createElement("div");v.id="ageMin",v.style.display="range"!==k$.type&&"combined"!==k$.type?"none":"",v.style.display="flex",v.style.alignItems="center",v.style.gap="0.5em";const S=document.createElement("span");S.textContent="Min:",S.style.color="#000";const b=document.createElement("input");b.type="number",b.min="1",b.max="120",b.value=String(k$.ageMin||10),b.style.width="80px",b.style.padding="0.3em",b.style.border="1px solid #ddd",b.style.borderRadius="4px",b.oninput=()=>{const e=Number.parseInt(b.value,10);!Number.isNaN(e)&&e>=1&&e<=120&&(k$.ageMin=e,void 0!==k$.ageMax&&k$.ageMax<e&&(k$.ageMax=e,T.value=String(e)),O$())},v.appendChild(S),v.appendChild(b),h.appendChild(v),"range"!==k$.type&&"combined"!==k$.type&&(v.style.display="none");const U=document.createElement("div");U.id="ageMax",U.style.display="range"!==k$.type&&"combined"!==k$.type?"none":"",U.style.display="flex",U.style.alignItems="center",U.style.gap="0.5em";const w=document.createElement("span");w.textContent="Max:",w.style.color="#000";const T=document.createElement("input");T.type="number",T.min="1",T.max="120",T.value=String(k$.ageMax||18),T.style.width="80px",T.style.padding="0.3em",T.style.border="1px solid #ddd",T.style.borderRadius="4px",T.oninput=()=>{const e=Number.parseInt(T.value,10);!Number.isNaN(e)&&e>=1&&e<=120&&(k$.ageMax=e,void 0!==k$.ageMin&&k$.ageMin>e&&(k$.ageMin=e,b.value=String(e)),O$())},U.appendChild(w),U.appendChild(T),h.appendChild(U),"range"!==k$.type&&"combined"!==k$.type&&(U.style.display="none");const D=document.createElement("div");D.id="combinedLabel",D.innerHTML='<em style="color: #888;">Combined age range</em>',D.style.display="combined"===k$.type?"":"none",D.style.padding="0.3em",h.appendChild(D),d.appendChild(h);const P=document.createElement("div");function N(){if("under"===k$.type){const e=k$.ageValue||18;return"pre"===k$.uPosition?`U${e}`:`${e}U`}if("over"===k$.type){const e=k$.ageValue||10;return"pre"===k$.oPosition?`O${e}`:`${e}O`}return""}function E(){const e=document.getElementById("categoryType");e&&(e.innerHTML=`${E$(k$.type)}\u25be`),void 0!==k$.ageValue&&(I.value=String(k$.ageValue));const t=document.getElementById("positionToggle");t&&(t.innerHTML=N()),void 0!==k$.ageMin&&(b.value=String(k$.ageMin)),void 0!==k$.ageMax&&(T.value=String(k$.ageMax))}P.id="calculatedDetailsPanel",d.appendChild(P);const M={content:{padding:"1.5"},maxWidth:480,fontSize:"14px",style:{backgroundColor:"#f8f9fa",borderRadius:"8px",boxShadow:"0 8px 16px rgba(0, 102, 204, 0.2)"}},R=o?.fontSize||o?.style?.fontSize||M.fontSize,A={...M,...o,fontSize:R,style:{...M.style,...a?.style||{},...o?.style}},C=Ue.open({title:C$.labels?.title||"Age Category",content:d,buttons:l,config:A});return setTimeout(()=>{F$(),E(),O$()},0),setTimeout(()=>{const e=document.querySelector(".modal.is-active");if(e){const t=new MutationObserver(r=>{r.forEach(r=>{r.removedNodes.forEach(r=>{r===e&&($$(),t.disconnect())})})});t.observe(document.body,{childList:!0})}},0),C}const j$={labels:{title:"Category",categoryNameLabel:"Category Name",typeLabel:"Category Type",ageCategoryCodeLabel:"Age Category Code",ratingTypeLabel:"Rating Type",ratingMinLabel:"Minimum Rating",ratingMaxLabel:"Maximum Rating",ballTypeLabel:"Ball Type",notesLabel:"Notes"},options:{types:["AGE","RATING","BOTH"],ratingTypes:["WTN","UTR","TRN","NTRP","DUPR"],ballTypes:["HIGH_ALTITUDE","STAGE1GREEN","STAGE2ORANGE","STAGE3RED","T2STANDARD_PRESSURELESS","T2STANDARD_PRESSURISED","TYPE1FAST","TYPE3SLOW"]},defaultConsideredDate:(new Date).toISOString().split("T")[0]};function G$(e){const{existingCategory:t,editorConfig:r,callback:i}=e,n={labels:{...j$.labels,...r?.labels},options:{...j$.options,...r?.options},defaultConsideredDate:r?.defaultConsideredDate||j$.defaultConsideredDate,modalConfig:r?.modalConfig||{}},a={categoryName:t?.categoryName||"",type:t?.type,ageCategoryCode:t?.ageCategoryCode,ratingType:t?.ratingType,ratingMin:t?.ratingMin,ratingMax:t?.ratingMax,ballType:t?.ballType,notes:t?.notes||"",ageMin:t?.ageMin,ageMax:t?.ageMax,ageMinDate:t?.ageMinDate,ageMaxDate:t?.ageMaxDate},o=n.defaultConsideredDate,s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",s.style.gap="1em",s.style.minWidth="400px";const c=()=>{const e=s.querySelector("#ageDetailsPanel");if(e){if(!a.ageCategoryCode||"OPEN"===a.ageCategoryCode)return void(e.style.display="none");try{const t=hA.getCategoryAgeDetails({category:{ageCategoryCode:a.ageCategoryCode},consideredDate:o});if(t.error)return e.style.display="block",void(e.innerHTML=`\n          <div style="padding: 0.75em; background-color: #ffe8e8; border-left: 4px solid #ff4444; border-radius: 4px; color: #000;">\n            <strong style="color: #000;">Error:</strong> ${"string"==typeof t.error?t.error:t.error.message||"Invalid category"}\n          </div>\n        `);a.ageMin=t.ageMin,a.ageMax=t.ageMax,a.ageMinDate=t.ageMinDate,a.ageMaxDate=t.ageMaxDate,e.style.display="block",e.innerHTML=`\n        <div style="padding: 0.75em; background-color: #e8f5e9; border-left: 4px solid #4caf50; border-radius: 4px; color: #000;">\n          <strong style="color: #000;">Age Range:</strong> ${t.ageMin||"N/A"} - ${t.ageMax||"N/A"}<br>\n          <strong style="color: #000;">Min Birth Date:</strong> ${t.ageMinDate||"N/A"}<br>\n          <strong style="color: #000;">Max Birth Date:</strong> ${t.ageMaxDate||"N/A"}\n        </div>\n      `}catch(m){e.style.display="block",e.innerHTML=`\n        <div style="padding: 0.75em; background-color: #ffe8e8; border-left: 4px solid #ff4444; border-radius: 4px; color: #000;">\n          <strong style="color: #000;">Error:</strong> ${m?.message||"Failed to calculate age details"}\n        </div>\n      `}}},u=document.createElement("div"),l=e=>{const t=document.getElementById("categoryOkButton");t&&(t.disabled=!(e=>{if((e.categoryName?.value||"").trim().length<5)return!1;const t=e.type?.value;if(!t)return!1;const r="AGE"===t||"BOTH"===t,i="RATING"===t||"BOTH"===t;return r&&!i?!!a.ageCategoryCode:!r&&i?!!a.ratingType:!(!r||!i||!a.ageCategoryCode&&!a.ratingType)})(e))},d=MB(u,[{label:n.labels?.categoryNameLabel||"Category Name",validator:(p=5,e=>e?.trim().length>=p&&(!m||e?.trim().length<=m)),error:"Minimum 5 characters",field:"categoryName",placeholder:"e.g., Boys U18, Open Singles, 3.5-4.0",value:a.categoryName,focus:!0,onChange:e=>{a.categoryName=e.target.value}},{label:n.labels?.typeLabel||"Category Type",field:"type",options:[{label:"Select type...",value:"",selected:!a.type},...(n.options?.types||[]).map(e=>({label:e,value:e,selected:e===a.type}))],onChange:e=>{const t=e.target.value;a.type=t,U()}},{label:n.labels?.ballTypeLabel||"Ball Type",field:"ballType",options:[{label:"None",value:"",selected:!a.ballType},...(n.options?.ballTypes||[]).map(e=>({label:e,value:e,selected:e===a.ballType}))],onChange:e=>{const t=e.target.value;a.ballType=t||void 0}},{label:n.labels?.notesLabel||"Notes",field:"notes",placeholder:"Additional information...",value:a.notes,onChange:e=>{a.notes=e.target.value}}],[{control:"categoryName",onInput:({inputs:e})=>{l(e)}},{control:"type",onInput:({inputs:e})=>{l(e)}},{control:"ballType",onInput:({inputs:e})=>{l(e)}},{control:"notes",onInput:({inputs:e})=>{l(e)}}]);var p,m;s.appendChild(u);const f=document.createElement("div");f.id="ageCategorySection",f.style.display="AGE"===a.type||"BOTH"===a.type?"block":"none";const h=document.createElement("label");h.textContent=n.labels?.ageCategoryCodeLabel||"Age Category Code",h.style.display="block",h.style.marginBottom="0.5em",h.style.fontWeight="bold",h.style.fontSize="0.9em",h.style.color="#000",f.appendChild(h);const g=document.createElement("div");g.style.display="flex",g.style.alignItems="center",g.style.gap="0.5em";const I=document.createElement("div");I.id="ageCategoryValue",I.style.padding="0.5em",I.style.border="1px solid #b5b5b5",I.style.borderRadius="4px",I.style.backgroundColor="#f5f5f5",I.style.flex="1",I.style.minHeight="2.5em",I.style.display="flex",I.style.alignItems="center",I.style.color="#000",I.textContent=a.ageCategoryCode||"Not set",g.appendChild(I);const y=document.createElement("button");y.className="button is-info is-small",y.textContent=a.ageCategoryCode?"Edit":"Set",y.onclick=()=>{V$({existingAgeCategoryCode:a.ageCategoryCode,editorConfig:{defaultConsideredDate:o},callback:e=>{a.ageCategoryCode=e.ageCategoryCode,I.textContent=e.ageCategoryCode||"Not set",y.textContent=e.ageCategoryCode?"Edit":"Set",c(),l(d)}})},g.appendChild(y),f.appendChild(g);const v=document.createElement("div");v.id="ageDetailsPanel",v.style.marginTop="0.5em",v.style.display="none",f.appendChild(v),s.appendChild(f);const S=document.createElement("div");S.id="ratingSection",S.style.display="RATING"===a.type||"BOTH"===a.type?"block":"none";const b=document.createElement("div");MB(b,[{label:n.labels?.ratingTypeLabel||"Rating Type",field:"ratingType",options:[{label:"Select rating type...",value:"",selected:!a.ratingType},...(n.options?.ratingTypes||[]).map(e=>({label:e,value:e,selected:e===a.ratingType}))],onChange:e=>{const t=e.target.value;a.ratingType=t||void 0}},{label:n.labels?.ratingMinLabel||"Minimum Rating",field:"ratingMin",type:"number",placeholder:"Min",value:a.ratingMin?.toString()||"",onChange:e=>{const t=e.target.value;a.ratingMin=t?Number.parseFloat(t):void 0},fieldPair:{label:n.labels?.ratingMaxLabel||"Maximum Rating",field:"ratingMax",type:"number",placeholder:"Max",value:a.ratingMax?.toString()||"",onChange:e=>{const t=e.target.value;a.ratingMax=t?Number.parseFloat(t):void 0}}}],[{control:"ratingType",onInput:()=>{l(d)}},{control:"ratingMin",onInput:()=>{l(d)}},{control:"ratingMax",onInput:()=>{l(d)}}]),S.appendChild(b),s.appendChild(S);const U=()=>{const e="AGE"===a.type||"BOTH"===a.type,t="RATING"===a.type||"BOTH"===a.type;f.style.display=e?"block":"none",S.style.display=t?"block":"none",e&&c()};setTimeout(()=>{U(),c()},0);const w=[{label:"Cancel",close:!0},{label:"OK",id:"categoryOkButton",intent:"is-success",close:!0,disabled:!0,onClick:()=>{(function(e){return"function"==typeof e})(i)&&i(a)}}],T={...n.modalConfig},D=Ue.open({title:n.labels?.title||"Category",content:s,buttons:w,config:T});return setTimeout(()=>{l(d)},0),D}const W$=(e,t)=>r=>function(e){if(""===e||null==e)return!1;const t=Number(e);return!isNaN(t)&&Number.isInteger(t)&&t>=0}(r)&&Number(r)>=e&&Number(r)<=t,{WTN:q$,UTR:H$,TRN:z$,NTRP:Y$,DUPR:K$}=mL.ratingConstants,{RATING:X$}=mL.scaleConstants,Q$=["Blue","Red","Green","Orange","Purple","Yellow","Pink","Gold","Silver","Bronze"],J$=[q$,H$,z$,Y$,K$],Z$=[{value:"WATERFALL",label:"Waterfall",description:"Distributes evenly: 1\u21922\u21923\u21921\u21922\u21923 (like dealing cards)"},{value:"LEVEL_BASED",label:"Level Based",description:"Groups by skill tiers: [1-5], [6-10], [11-15]"},{value:"SHUTTLE",label:"Shuttle",description:"Alternating direction: 1\u21922\u21923\u21923\u21922\u21921\u21921\u21922\u21923 (like a loom shuttle)"}];const eV="flightsCount",tV="namingType",rV="customName",iV="suffixType",nV="scaleType",aV="scaleName";const oV="none";function sV(){return[{onInput:({inputs:e})=>{(({inputs:e})=>{const t=document.getElementById("flightProfileOk");if(!t)return;const r=e[eV]?.value,i=W$(2,10)(r);t.disabled=!i,t.style.opacity=i?"1":"0.5",t.style.cursor=i?"pointer":"not-allowed"})({inputs:e})},control:eV},{onChange:({e:e,fields:t})=>{const r=e.target.value;if(t){const e="custom"===r;t[rV].style.display=e?"":oV,t[iV].style.display=e?"":oV}},control:tV},{onChange:({e:e,fields:t})=>{const r=e.target.value;if(t){const e="RATING"===r;t[aV].style.display=e?"":oV}},control:nV}]}function cV(e){return"function"==typeof e}function uV(e){const{existingFlightProfile:t,editorConfig:r={},callback:i}=e,n=!!t;let a;const o=[{label:"Cancel",close:!0},{label:"OK",id:"flightProfileOk",intent:"is-success",close:!0,onClick:()=>{if(n)return cV(i)&&i({flights:t.flights}),!0;{const e={flightsCount:Number.parseInt(a.flightsCount?.value||"0"),namingType:a.namingType?.value||"colors",customName:a.customName?.value||"Flight",suffixType:a.suffixType?.value||"numbers",scaleType:a.scaleType?.value||"RATING",scaleName:a.scaleName?.value,splitMethod:a.splitMethod?.value||"LEVEL_BASED"},t=function(e){const t=[];return!e.flightsCount||Number.isNaN(e.flightsCount)||e.flightsCount<=0?t.push("Number of flights must be a valid number greater than 0"):e.flightsCount<2?t.push("Must have at least 2 flights"):e.flightsCount>10&&t.push("Maximum 10 flights allowed"),e.scaleType===X$&&!e.scaleName&&t.push("Rating system must be selected"),t}(e);if(t.length>0)return alert(t.join("\n")),!1;const r=function(e){const{flightsCount:t,namingType:r,customName:i,suffixType:n}=e,a=[];for(let o=0;o<t;o++)if("colors"===r)a.push(Q$[o]||`Flight ${o+1}`);else{const e="letters"===n?String.fromCodePoint(65+o):(o+1).toString();a.push(`${i||"Flight"} ${e}`)}return a}(e),n=function(e){const t={scaleType:e.scaleType};return e.eventType&&(t.eventType=e.eventType),e.scaleType===X$&&e.scaleName&&(t.scaleName=e.scaleName,pL.ratingsParameters[e.scaleName]?(t.ascending=pL.ratingsParameters[e.scaleName].ascending,t.accessor=pL.ratingsParameters[e.scaleName].accessor):(delete t.ascending,delete t.accessor)),t}(e),o=function(e){return{WATERFALL:"splitWaterfall",LEVEL_BASED:"splitLevelBased",SHUTTLE:"splitShuttle"}[e]||"splitLevelBased"}(e.splitMethod);return cV(i)&&i({flightsCount:e.flightsCount,drawNames:r,scaleAttributes:n,splitMethod:o}),!0}}}],s={modalSize:"is-medium"};return n||(s.info='\n      <div style="color: #000;">\n        <div style="margin-bottom: 1em;">\n          <strong style="color: #000;">Waterfall:</strong><br>\n          <span style="color: #666;">Distributes evenly like dealing cards: 1\u21922\u21923\u21921\u21922\u21923</span>\n        </div>\n        <div style="margin-bottom: 1em;">\n          <strong style="color: #000;">Level Based:</strong><br>\n          <span style="color: #666;">Groups by skill tiers: [1-5], [6-10], [11-15]</span>\n        </div>\n        <div>\n          <strong style="color: #000;">Shuttle:</strong><br>\n          <span style="color: #666;">Alternating direction like a loom shuttle: 1\u21922\u21923\u21923\u21922\u21921\u21921\u21922\u21923</span>\n        </div>\n      </div>\n    '),Ue.open({title:r.labels?.title||"Flight Profile",content:e=>{if(n){const t=document.createElement("div");t.className="notification is-info is-light",t.innerHTML='<strong style="color: #000;">Note:</strong> Flight split has already been performed. You can only rename the flights.',e.appendChild(t)}const i=function({existingProfile:e,editorConfig:t={}}={}){const r=!!e,i={flightsCount:2,namingType:"colors",customName:"Flight",suffixType:"numbers",scaleType:"RATING",scaleName:"WTN",splitMethod:"LEVEL_BASED"};if(r&&e){const{flights:t,scaleAttributes:r,splitMethod:n}=e;if(t&&t.length>0){i.flightsCount=t.length;const e=t[0].drawName;if(Q$.includes(e))i.namingType="colors";else{const t=e.match(/^(.+?)\s+([A-Z]|\d+)$/);t&&(i.namingType="custom",i.customName=t[1],i.suffixType=/[A-Z]/.test(t[2])?"letters":"numbers")}}if(r&&(i.scaleType=r.scaleType||"RATING",i.scaleName=r.scaleName),n){const e={splitWaterfall:"WATERFALL",splitLevelBased:"LEVEL_BASED",splitShuttle:"SHUTTLE"};i.splitMethod=e[n]||"LEVEL_BASED"}}return[{error:"Must be in range 2-10",placeholder:"2",validator:W$(2,10),value:i.flightsCount,label:t.labels?.flightsCountLabel||"Number of Flights (2-10)",field:eV,selectOnFocus:!0,hide:r,type:"number",focus:!0},{options:[{label:"Color Names",value:"colors",selected:"colors"===i.namingType},{label:"Root Word",value:"custom",selected:"custom"===i.namingType}],label:t.labels?.namingTypeLabel||"Naming Strategy",value:i.namingType,field:tV,hide:r},{placeholder:"Flight",label:t.labels?.customNameLabel||"Root Word",visible:"custom"===i.namingType,value:i.customName,selectOnFocus:!0,field:rV,hide:r,fieldPair:{options:[{label:"Letters (A, B, C)",value:"letters",selected:"letters"===i.suffixType},{label:"Numbers (1, 2, 3)",value:"numbers",selected:"numbers"===i.suffixType}],label:t.labels?.suffixTypeLabel||"Suffix Style",visible:"custom"===i.namingType,value:i.suffixType,field:iV}},{options:[{label:"Rating",value:"RATING",selected:"RATING"===i.scaleType},{label:"Ranking",value:"RANKING",selected:"RANKING"===i.scaleType}],label:t.labels?.scaleTypeLabel||"Flighting Strategy",field:nV,value:i.scaleType,hide:r},{options:J$.map(e=>({label:e,value:e,selected:e===i.scaleName})),label:t.labels?.scaleNameLabel||"Rating System",field:aV,value:i.scaleName,visible:"RATING"===i.scaleType,hide:r},{label:t.labels?.splitMethodLabel||"Split Method",field:"splitMethod",value:i.splitMethod,radio:!0,options:Z$.map(e=>({text:e.label,value:e.value,checked:e.value===i.splitMethod})),hide:r}]}({existingProfile:t,editorConfig:r}),o=sV(),s=document.createElement("div");if(e.appendChild(s),a=MB(s,i,o),n&&t?.flights){const i=document.createElement("div");i.className="field",i.innerHTML=`\n        <label class="label">${r.labels?.flightNamesLabel||"Flight Names"}</label>\n      `,t.flights.forEach((e,r)=>{const n=document.createElement("div");n.className="field",n.innerHTML=`\n          <div class="control">\n            <input \n              type="text" \n              class="input" \n              id="flightName_${r}"\n              value="${e.drawName}"\n              placeholder="Flight ${r+1}"\n            />\n          </div>\n        `,n.querySelector("input").addEventListener("input",e=>{t.flights[r].drawName=e.target.value}),i.appendChild(n)}),e.appendChild(i)}},buttons:o,config:s})}const{RETIRED:lV,WALKOVER:dV,DEFAULTED:pV,SUSPENDED:mV,CANCELLED:fV,INCOMPLETE:hV,DEAD_RUBBER:gV,IN_PROGRESS:IV,AWAITING_RESULT:yV}=Sf;function vV(e,t){return t===(e.bestOf||3)-1&&e.finalSetFormat?e.finalSetFormat:e.setFormat}function SV(e){return!!e?.tiebreakSet?.tiebreakTo&&!e?.setTo}function bV(e){const t=e?.tiebreakSet,r=e?.tiebreakFormat;return t?t.tiebreakTo||10:r&&r.tiebreakTo||7}function UV(e){return e>="0"&&e<="9"}function wV(e){for(const t of e)if(!UV(t))return!1;return!0}function TV(e){return"("===e||"["===e}function DV(e){return")"===e||"]"===e}function PV(e,t,r){const i=r?.tiebreakAt||r?.setTo||6;return e===i&&t===i}function NV(e,t){const r="1-0"===e?1:0,i="0-1"===e?1:0;return{side1TiebreakScore:r,side2TiebreakScore:i,setNumber:t,winningSide:r>i?1:2}}function EV(e,t,r){const i=e.indexOf("-");if(-1===i)return r.push({position:0,message:`Set ${t}: Invalid format "${e}". Expected "#-#" (e.g., "5-3")`,expected:"#-#",got:e}),null;const n=e.slice(0,i),a=e.slice(i+1);if(!(n&&a&&wV(n)&&wV(a)))return r.push({position:0,message:`Set ${t}: Invalid format "${e}". Expected "#-#" (e.g., "5-3")`,expected:"#-#",got:e}),null;return{side1Score:Number.parseInt(n,10),side2Score:Number.parseInt(a,10),setNumber:t}}function MV(e,t,r){const i=e.indexOf("-");if(-1===i)return r.push({position:0,message:`Final set: Invalid format "${e}". Expected TB format "1-0" or "0-1", or regular "#-#"`,expected:"1-0, 0-1, or #-#",got:e}),null;const n=e.slice(0,i),a=e.slice(i+1);if(!(n&&a&&wV(n)&&wV(a)))return r.push({position:0,message:`Final set: Invalid format "${e}". Expected TB format "1-0" or "0-1", or regular "#-#"`,expected:"1-0, 0-1, or #-#",got:e}),null;return{side1Score:Number.parseInt(n,10),side2Score:Number.parseInt(a,10),setNumber:t}}function RV(e,t,r,i,n){if(!e)return[];if(t){const e=r-i;return[`Enter ${e} more timed set${1===e?"":"s"} (or final TB if aggregate tied)`]}const a=n-i;return[`Need ${a} more set${1===a?"":"s"}`]}function AV(e,t){const r=t.exactly||t.bestOf||1,i=e.trim(),n=!!t?.aggregate,a=void 0!==t.finalSetFormat?.tiebreakSet?.tiebreakTo,o=n&&a;if(!i)return function(e,t){return{valid:!1,formattedScore:"",sets:[],confidence:1,errors:[],warnings:[],ambiguities:[],suggestions:e?[`Enter ${t-1} timed sets (final TB only if tied)`]:[`Enter ${t} sets in format: #-# #-# ...`],incomplete:!0,matchComplete:!1}}(o,r);const s=[],c=o?r-1:r,u=function(e,t,r,i){const n=[];for(let a=0;a<e.length;a++){const o=e[a],s=a+1,c=s===r,u="1-0"===o||"0-1"===o;if(t&&c&&u)n.push(NV(o,s));else if(t&&c&&!u){const e=MV(o,s,i);e&&n.push(e)}else{const e=EV(o,s,i);e&&n.push(e)}}return n}(i.split(/\s+/),o,r,s);o&&0===s.length&&function(e,t,r){const i=e.filter(e=>void 0!==e.side1Score),n=e.some(e=>void 0!==e.side1TiebreakScore);if(i.length<t)return;const a=function(e,t){return e.slice(0,t).reduce((e,t)=>(e.side1+=t.side1Score||0,e.side2+=t.side2Score||0,e),{side1:0,side2:0})}(i,t),o=a.side1===a.side2,s=i.length>t;if(o&&!n)if(s){const e=i[t];r.push({position:0,message:`Aggregate tied (${a.side1}-${a.side2}). Final set score "${e.side1Score}-${e.side2Score}" invalid. TB1 only accepts "1-0" or "0-1"`})}else r.push({position:0,message:`Aggregate tied (${a.side1}-${a.side2}), final TB required`});else!o&&n?r.push({position:0,message:`Aggregate not tied (${a.side1}-${a.side2}), final TB not allowed`}):!o&&s&&r.push({position:0,message:`Aggregate not tied (${a.side1}-${a.side2}), extra sets not allowed`})}(u,c,s);const l=o?c:r,d=r;!function(e,t,r,i,n){if(e>r){const a=i?`${t}-${r}`:`${r}`;n.push({position:0,message:`Too many sets: got ${e}, expected ${a}`})}}(u.length,l,d,o,s);const p=u.length<l&&0===s.length,m=(u.length===r||o&&u.length===c)&&0===s.length,f=function(e){return e.map(e=>void 0!==e.side1TiebreakScore?`${e.side1TiebreakScore}-${e.side2TiebreakScore}`:`${e.side1Score}-${e.side2Score}`).join(" ")}(u);return{valid:0===s.length&&(u.length===l||u.length===d),formattedScore:f,sets:u,confidence:0===s.length?1:0,errors:s,warnings:[],ambiguities:[],suggestions:RV(p,o,l,u.length,r),incomplete:p,matchComplete:m}}function CV(e,t){const r="string"==typeof t?NC.parse(t):t;if(!r)return{valid:!1,formattedScore:"",sets:[],confidence:0,errors:[{position:0,message:"Invalid matchUpFormat"}],warnings:[],ambiguities:[],suggestions:[],incomplete:!1,matchComplete:!1};const i=!(!r.setFormat?.timed&&!r.finalSetFormat?.timed),n=!!r.exactly||1===r.bestOf;if(i&&n)return AV(e,r);const a={input:e,position:0,setIndex:0,currentSide1Buffer:"",currentSide2Buffer:"",currentTiebreakSide1Buffer:"",currentTiebreakSide2Buffer:"",sets:[],parsedFormat:r,state:"START",inTiebreak:!1,expectingTiebreakOnly:!1,isValid:!0,errors:[],warnings:[],confidence:1,ambiguities:[],suggestions:[]};for(SV(vV(r,0))?(a.expectingTiebreakOnly=!0,a.inTiebreak=!0,a.state="PARSING_TIEBREAK_SIDE1"):a.state="PARSING_SIDE1";a.position<e.length&&a.isValid;)kV(a);!function(e){(e.currentSide1Buffer||e.currentSide2Buffer||e.currentTiebreakSide1Buffer||e.currentTiebreakSide2Buffer)&&_V(e)}(a);let o,s=a.sets;a.irregularEnding&&(o=a.irregularEnding,(a.irregularEnding===dV||a.irregularEnding===fV||a.irregularEnding===gV)&&(s=[]));const c=!a.irregularEnding&&function(e){const t=e.parsedFormat.bestOf||3,r=Math.ceil(t/2),i=e.sets.filter(e=>1===e.winningSide).length,n=e.sets.filter(e=>2===e.winningSide).length;return i>=r||n>=r}(a),u=function(e){const t=[];for(const r of e.sets)if(r.side1Score&&0!==r.side1Score||r.side2Score&&0!==r.side2Score||void 0===r.side1TiebreakScore&&void 0===r.side2TiebreakScore){let e=`${r.side1Score||0}-${r.side2Score||0}`;if(void 0!==r.side1TiebreakScore||void 0!==r.side2TiebreakScore){const t=r.side1TiebreakScore??0,i=r.side2TiebreakScore??0;e+=`(${1===r.winningSide?i:t})`}t.push(e)}else{const e=r.side1TiebreakScore??0,i=r.side2TiebreakScore??0;t.push(`[${e}-${i}]`)}return t.join(" ")}(a);return{valid:a.isValid&&0===a.errors.length,formattedScore:u,sets:s,confidence:a.confidence,errors:a.errors,warnings:a.warnings,ambiguities:a.ambiguities,suggestions:a.suggestions,incomplete:!c&&s.length>0,matchComplete:c,matchUpStatus:o}}function kV(e){const t=e.input[e.position];if(!UV(t)&&!TV(t)&&!DV(t)){const t=function(e,t){const r=e.substring(t).trim().toLowerCase();return/^in(\s+p(rog(ress)?)?)?$/i.exec(r)?{ending:IV,endPos:e.length}:/^inc(omp(lete?)?)?/i.exec(r)?{ending:hV,endPos:e.length}:/^(dr|dead(\s*r(ubber)?)?)/i.exec(r)?{ending:gV,endPos:e.length}:/^r(et(ired?)?)?/i.exec(r)?{ending:lV,endPos:e.length}:/^(w(\/o|o|alk(over?)?)?)/i.exec(r)?{ending:dV,endPos:e.length}:/^d(ef(aulted?)?)?/i.exec(r)?{ending:pV,endPos:e.length}:/^s(usp(ended?)?)?/i.exec(r)?{ending:mV,endPos:e.length}:/^c(anc(ell?ed?)?)?/i.exec(r)?{ending:fV,endPos:e.length}:/^a(wait(ing(\s*r(esult)?)?)?)?/i.exec(r)?{ending:yV,endPos:e.length}:{endPos:t}}(e.input,e.position);if(t.ending)return e.irregularEnding=t.ending,e.irregularEndingPosition=e.position,void(e.position=t.endPos)}!function(e){return!UV(e)&&!TV(e)&&!DV(e)}(t)?TV(t)?function(e){const t=vV(e.parsedFormat,e.setIndex);if(SV(t))return e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",void e.position++;if(e.currentSide1Buffer&&e.currentSide2Buffer){if(PV(Number.parseInt(e.currentSide1Buffer),Number.parseInt(e.currentSide2Buffer),t))return e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",void e.position++}e.warnings.push(`Tiebreak indicator at position ${e.position} may be ambiguous`),e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",e.position++}(e):DV(t)?function(e){if(e.inTiebreak)return function(e){_V(e)}(e),e.inTiebreak=!1,void e.position++;e.warnings.push(`Unexpected tiebreak closer at position ${e.position}`),e.position++}(e):UV(t)?function(e,t){const r=vV(e.parsedFormat,e.setIndex);e.inTiebreak?function(e,t,r){if("PARSING_TIEBREAK_SIDE1"===e.state)return void function(e,t){e.currentTiebreakSide1Buffer+=t,e.position++}(e,t);if("PARSING_TIEBREAK_SIDE2"===e.state)return void function(e,t,r){e.currentTiebreakSide2Buffer+=t;const i=Number.parseInt(e.currentTiebreakSide2Buffer),n=e.position+1;if(n<e.input.length&&UV(e.input[n])){const t=e.input[n],a=Number.parseInt(e.currentTiebreakSide2Buffer+t),o=Number.parseInt(e.currentTiebreakSide1Buffer);if(a>999){const t=i;(function(e,t,r){const i=bV(r),n=Math.max(e,t),a=Math.min(e,t);return r?.tiebreakSet?.NoAD||r?.tiebreakFormat?.NoAD?n>=i:!(n<i)&&n-a>=2})(o,t,r)||e.warnings.push(`Tiebreak may be incomplete: ${o}-${t}`),_V(e)}}e.position++}(e,t,r);e.position++}(e,t,r):function(e,t,r){const i=function(e){return SV(e)?0:(e?.setTo||6)+1}(r);if("PARSING_SIDE1"===e.state||"START"===e.state)return void function(e,t,r){e.state="PARSING_SIDE1",e.currentSide1Buffer+=t;const i=Number.parseInt(e.currentSide1Buffer),n=e.position+1;if(n<e.input.length&&UV(e.input[n])){const t=e.input[n];xV(e.currentSide1Buffer,t,r)&&(e.warnings.push(`Potential score issue: "${e.currentSide1Buffer}${t}" would exceed max game score ${r}`),e.state="PARSING_SIDE2")}else e.state="PARSING_SIDE2";i>r&&e.warnings.push(`Score ${i} exceeds max ${r} at position ${e.position}`),e.position++}(e,t,i);if("PARSING_SIDE2"===e.state)return void function(e,t,r,i){e.currentSide2Buffer+=t;const n=Number.parseInt(e.currentSide1Buffer),a=Number.parseInt(e.currentSide2Buffer);if(FV(n,a,r))return e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",void e.position++;const o=e.position+1;if(o<e.input.length&&UV(e.input[o])){const t=e.input[o];xV(e.currentSide2Buffer,t,i)&&(function(e,t,r){const i=r?.setTo||6,n=Math.max(e,t),a=Math.min(e,t);return!(n<i)&&n-a>=2}(n,a,r)||PV(n,a,r)||e.warnings.push(`Set ${e.setIndex+1} may be incomplete: ${n}-${a}`),_V(e))}e.position++}(e,t,r,i);e.position++}(e,t,r)}(e,t):(e.errors.push({position:e.position,message:`Unexpected character '${t}'`,got:t,context:LV(e)}),e.isValid=!1):function(e){if("PARSING_SIDE1"===e.state&&e.currentSide1Buffer)return e.state="PARSING_SIDE2",void e.position++;if("PARSING_SIDE2"===e.state&&e.currentSide2Buffer){return FV(Number.parseInt(e.currentSide1Buffer),Number.parseInt(e.currentSide2Buffer),vV(e.parsedFormat,e.setIndex))?(e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1",void e.position++):(_V(e),void e.position++)}if("PARSING_TIEBREAK_SIDE1"===e.state&&e.currentTiebreakSide1Buffer)return e.currentSide1Buffer&&e.currentSide2Buffer?(_V(e),void e.position++):(e.state="PARSING_TIEBREAK_SIDE2",void e.position++);e.position++}(e)}function xV(e,t,r){return Number.parseInt(e+t)>r}function OV(e,t,r){const i=t.currentTiebreakSide1Buffer,n=t.currentTiebreakSide2Buffer;i&&n?(e.side1TiebreakScore=Number.parseInt(i),e.side2TiebreakScore=Number.parseInt(n)):(i||n)&&function(e,t,r,i){const n=Number.parseInt(t||r),a=bV(i),o=i?.tiebreakFormat?.NoAD?a:Math.max(a,n+2);e.side1Score>e.side2Score?(e.side1TiebreakScore=o,e.side2TiebreakScore=n):(e.side1TiebreakScore=n,e.side2TiebreakScore=o)}(e,i,n,r)}function FV(e,t,r){const i=r.tiebreakAt||r.setTo||6;return e===i&&t===i+1||t===i&&e===i+1}function _V(e){const t=vV(e.parsedFormat,e.setIndex);let r=null;r=SV(t)?function(e){if(!e.currentTiebreakSide1Buffer||!e.currentTiebreakSide2Buffer)return null;const t=Number.parseInt(e.currentTiebreakSide1Buffer),r=Number.parseInt(e.currentTiebreakSide2Buffer);return{side1Score:0,side2Score:0,side1TiebreakScore:t,side2TiebreakScore:r,setNumber:e.setIndex+1,winningSide:t>r?1:2}}(e):function(e,t){if(!e.currentSide1Buffer||!e.currentSide2Buffer)return null;const r=Number.parseInt(e.currentSide1Buffer),i=Number.parseInt(e.currentSide2Buffer);if(FV(r,i,t)&&!e.currentTiebreakSide1Buffer&&!e.currentTiebreakSide2Buffer)return null;const n={side1Score:r,side2Score:i,setNumber:e.setIndex+1};return(e.currentTiebreakSide1Buffer||e.currentTiebreakSide2Buffer)&&OV(n,e,t),r>i?n.winningSide=1:i>r&&(n.winningSide=2),n}(e,t),r&&e.sets.push(r),function(e){e.currentSide1Buffer="",e.currentSide2Buffer="",e.currentTiebreakSide1Buffer="",e.currentTiebreakSide2Buffer="",e.setIndex++,e.inTiebreak=!1,e.state="PARSING_SIDE1",SV(vV(e.parsedFormat,e.setIndex))&&(e.expectingTiebreakOnly=!0,e.inTiebreak=!0,e.state="PARSING_TIEBREAK_SIDE1")}(e)}function LV(e){const t=Math.max(0,e.position-5),r=Math.min(e.input.length,e.position+5),i=e.input.substring(t,e.position),n=e.input.substring(e.position+1,r);return`...${i}[${e.input[e.position]}]${n}...`}const{COMPLETED:BV}=Sf,{validateMatchUpScore:$V,validateSetScore:VV}=$r.scoreGovernor;function jV(e,t,r){const{WALKOVER:i,CANCELLED:n,DEAD_RUBBER:a}=Sf,o=[i,n,a];if(!e?.trim())return r&&o.includes(r)?{isValid:!0,sets:[],matchUpStatus:r,scoreObject:void 0}:{isValid:!1,sets:[],error:"Score is required"};try{const{outcome:i,error:n}=aL.generateOutcomeFromScoreString({scoreString:e.trim(),matchUpFormat:t,preserveSideOrder:!0});if(n||!i?.score?.sets)return{isValid:!1,sets:[],error:n||"Invalid score format"};const a=i.score.sets,o=i.score,s=e.trim().split(/\s+/).filter(e=>e.length>0),c=NC.parse(t),u=c?.exactly||c?.bestOf||3,l=function(e,t,r,i,n){const a=r?.finalSetFormat?.tiebreakSet?.tiebreakTo&&!r?.finalSetFormat?.setTo,o=r?.setFormat?.tiebreakSet?.tiebreakTo&&!r?.setFormat?.setTo,s=1===r?.finalSetFormat?.tiebreakSet?.tiebreakTo,c=1===r?.setFormat?.tiebreakSet?.tiebreakTo;for(let u=0;u<e.length;u++){const r=e[u],l=u+1,d=l===t,p=r.startsWith("[")&&r.endsWith("]"),m=o||d&&a;if(!m&&p)return{isValid:!1,sets:i,scoreObject:n,error:`Set ${l}: Format expects regular set (e.g., 6-4), but got tiebreak-only set ${r}`};if(m&&!p&&("1-0"!==r&&"0-1"!==r||!(d&&s||c)))return{isValid:!1,sets:i,scoreObject:n,error:`Set ${l}: Format expects tiebreak-only set (e.g., [10-8]), but got regular set ${r}`}}return null}(s,u,c,a,o);if(l)return l;let d=!1;const p=a.map((e,r)=>{if(!VV(e,t,r+1===u,!1).isValid){d=!0;const{...t}=e;return t}return e}),m={...o,sets:p},f=$V(p,t,r);if(!f.isValid)return{isValid:!1,sets:p,scoreObject:m,error:f.error};const h=Math.ceil(u/2),g=d?void 0:i.winningSide;return function(e,t,r,i,n){if(e||void 0===t)return!1;const a=!!n?.aggregate,o=!!n?.exactly;if(a)return r.filter(e=>void 0!==e.side1Score&&void 0!==e.side2Score).length>=i;{const e=Math.ceil(i/2),t={side1:0,side2:0};return r.forEach(e=>{1===e.winningSide?t.side1++:2===e.winningSide&&t.side2++}),!(!(t.side1>=e||t.side2>=e)||o&&r.length<i)}}(d,g,p,u,c)?{isValid:!0,sets:p,scoreObject:m,winningSide:g,matchUpStatus:BV,matchUpFormat:t,score:e.trim()}:{isValid:!1,sets:p,scoreObject:m,error:`Incomplete match - need ${h} sets to win`}}catch(s){return{isValid:!1,sets:[],error:s instanceof Error?s.message:"Invalid score format"}}}const GV={scoringApproach:"dynamicSets",smartComplements:!0,composition:"Australian",idiom:"en",dateFormat:"YYYY-MM-DD",timeFormat:"HH:mm"};let WV={...GV};function qV(){return{...WV}}function HV(e){WV={...WV,...e}}function zV(){WV={...GV}}const{RETIRED:YV,WALKOVER:KV,DEFAULTED:XV,SUSPENDED:QV,CANCELLED:JV,INCOMPLETE:ZV,DEAD_RUBBER:ej,IN_PROGRESS:tj,AWAITING_RESULT:rj,DOUBLE_WALKOVER:ij,DOUBLE_DEFAULT:nj}=Sf;function aj(e){if(!e)return{bestOf:3,setsToWin:2,isTimed:!1,isExactlyFormat:!1};const t=NC.parse(e);if(!t)return{bestOf:3,setsToWin:2,isTimed:!1,isExactlyFormat:!1};const r=!(!t.setFormat?.timed&&!t.finalSetFormat?.timed),i=!!t.exactly||1===t.bestOf,n=t.exactly||t.bestOf||3,a=Math.ceil(n/2);return{bestOf:t.bestOf||n,exactly:t.exactly,setsToWin:a,isTimed:r,isExactlyFormat:i}}function oj(e,t){return 1!==t.bestOf&&e+1!==t.bestOf||!t.finalSetFormat?t.setFormat:t.finalSetFormat}function sj(e){return void 0!==e?.tiebreakSet?.tiebreakTo}function cj(e){return!0===e?.timed&&void 0!==e?.minutes}function uj(e,t,r,i){const n=oj(e,i);if(cj(n))return 1/0;const a=n?.setTo||6,o=n?.tiebreakAt||a,s=1===t?r.side2:r.side1,c=o===a?a+1:a;return 0===s?c:s<o-1?a:s===o-1?o===a?a+1:a:s===o?c:s>o&&s<a?a:s===a?o===a?a+2:o:s>a?s+2:c}function lj(e,t,r){const i=oj(e,r);if(cj(i))return void 0!==t.side1&&null!==t.side1&&void 0!==t.side2&&null!==t.side2;if(sj(i))return t.side1>0&&t.side2>0&&t.side1!==t.side2;const n=i?.setTo||6,a=i?.tiebreakAt||n,o=Math.max(t.side1,t.side2),s=Math.min(t.side1,t.side2),c=Math.abs(t.side1-t.side2);return o>=n&&c>=2||(a===n?o===a+1&&s===a:o===n&&s===a)&&void 0!==t.tiebreak}function dj(e,t,r){if(lj(e,t,r)){if(t.side1>t.side2)return 1;if(t.side2>t.side1)return 2}}function pj(e,t,r){const i=Math.ceil(t/2),n=e.filter(e=>1===e.winningSide).length,a=e.filter(e=>2===e.winningSide).length;return(n>=i||a>=i)&&(!r||e.filter(e=>void 0!==e.side1Score&&void 0!==e.side2Score).length>=r)}function mj(e,t,r){if(!pj(e,t,r))return;const i=Math.ceil(t/2),n=e.filter(e=>1===e.winningSide).length,a=e.filter(e=>2===e.winningSide).length;return n>=i?1:a>=i?2:void 0}function fj(e,t){const r=t?.setTo||6;if(e>=r)return null;return e<r-1?r:(t?.tiebreakAt||r)===r?r+1:r}function hj(e,t,r,i,n,a,o){if(!o)return{field1Value:e,field2Value:0,shouldApply:!1,reason:"Feature disabled in settings"};if(a.has(r))return{field1Value:e,field2Value:0,shouldApply:!1,reason:"Already used for this set"};if(pj(i,n.bestOf,n.exactly))return{field1Value:e,field2Value:0,shouldApply:!1,reason:"Match already complete"};const s=oj(r,n);if(sj(s))return{field1Value:e,field2Value:0,shouldApply:!1,reason:"Tiebreak-only set"};const c=fj(e,s);return null===c?{field1Value:e,field2Value:0,shouldApply:!1,reason:"No predictable complement for this digit"}:t?{field1Value:c,field2Value:e,shouldApply:!0}:{field1Value:e,field2Value:c,shouldApply:!0}}function gj(e,t,r){const i=oj(e,r);if(cj(i)||sj(i))return!1;const n=i?.setTo||6,a=i?.tiebreakAt||n,o=Math.max(t.side1,t.side2),s=Math.min(t.side1,t.side2);return a===n?o===a+1&&s===a:o===n&&s===a}function Ij(e,t,r){if(e+1>=r.bestOf||pj(t,r.bestOf,r.exactly))return!1;const i=t[e];return!!i&&void 0!==i.winningSide}function yj(e,t,r,i,n){const a=Number.parseInt(t)||0,o=Number.parseInt(r)||0,s=i?Number.parseInt(i):void 0,c=oj(e,n);if(sj(c)){return{setNumber:e+1,side1Score:0,side2Score:0,side1TiebreakScore:a,side2TiebreakScore:o,winningSide:a>0&&o>0&&a!==o?a>o?1:2:void 0}}const u={setNumber:e+1,side1Score:a,side2Score:o,winningSide:dj(e,{side1:a,side2:o,tiebreak:s},n)};if(void 0!==s){const e=c?.tiebreakFormat?.tiebreakTo||7,t=c?.tiebreakFormat?.noAd;let r;r=s<e-1?e:t?s+1:s+2,a>o?(u.side1TiebreakScore=r,u.side2TiebreakScore=s):(u.side1TiebreakScore=s,u.side2TiebreakScore=r)}return u}const{COMPLETED:vj,RETIRED:Sj,WALKOVER:bj,DEFAULTED:Uj,DOUBLE_WALKOVER:wj,DOUBLE_DEFAULT:Tj}=Sf;function Dj(e){const{matchUp:t,container:r,onScoreChange:i}=e;r.innerHTML="",r.style.display="flex",r.style.flexDirection="column",r.style.gap="1em";let n=t.matchUpFormat||"SET3-S:6/TB7";const a=()=>{const e=aj(n),t=NC.parse(n);return{bestOf:e.bestOf,exactly:t?.exactly,setFormat:t?.setFormat,finalSetFormat:t?.finalSetFormat}};let o=a();const s=()=>o.bestOf,c=()=>o.exactly,u=document.createElement("div");if(u.style.marginBottom="0.5em",r.appendChild(u),t.matchUpFormat){const e=document.createElement("div");e.style.fontSize="0.9em",e.style.marginBottom="0.5em",e.style.display="flex",e.style.alignItems="center",e.style.gap="0.5em";const i=document.createElement("span");i.textContent="Format:",i.style.color="#666",e.appendChild(i);const s=document.createElement("button");s.textContent=t.matchUpFormat,s.className="button is-small is-white",s.style.fontSize="0.75em",s.style.padding="0.2em 0.5em",s.style.cursor="pointer",s.title="Click to edit format",s.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:e}=await Promise.resolve().then(()=>D$);e({existingMatchUpFormat:t.matchUpFormat,callback:e=>{e&&e!==t.matchUpFormat&&(t.matchUpFormat=e,n=e,s.textContent=e,o=a(),globalThis.resetDynamicSets&&globalThis.resetDynamicSets())},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(e){console.error("[DynamicSets] Error opening format selector:",e)}}),e.appendChild(s),r.appendChild(e)}let l,d=vj;const p=new Set;let m=t.score?{...t.score}:void 0,f=t.winningSide,h=t.matchUpStatus;const g=document.createElement("div");g.style.marginBottom="0.8em";const I=document.createElement("div");I.textContent="Irregular Ending:",I.style.fontSize="0.75em",I.style.fontWeight="500",I.style.marginBottom="0.3em",I.style.color="#444",g.appendChild(I);const y=document.createElement("div");y.style.display="flex",y.style.gap="0.5em",y.style.flexWrap="wrap",[{value:Sj,label:"Retired"},{value:bj,label:"Walkover"},{value:Uj,label:"Defaulted"}].forEach(e=>{const t=document.createElement("label");t.style.display="flex",t.style.alignItems="center",t.style.gap="0.3em",t.style.cursor="pointer";const r=document.createElement("input");r.type="radio",r.name="matchOutcome",r.value=e.value,r.checked=!1,r.addEventListener("change",e=>{if(d=e.target.value,d===bj||d===Sj||d===Uj){D.querySelectorAll("input").forEach(e=>{e.value=""});const e=D.querySelectorAll(".set-row");for(let t=e.length-1;t>0;t--)e[t].remove();P=[],m=void 0}S.style.display="block",setTimeout(()=>{"function"==typeof R&&R()},0)});const i=document.createElement("span");i.textContent=e.label,i.style.fontSize="0.75em",t.appendChild(r),t.appendChild(i),y.appendChild(t)});const v=document.createElement("button");v.textContent="Clear",v.className="button",v.style.fontSize="0.7em",v.style.padding="0.2em 0.5em",v.addEventListener("click",()=>{g.querySelectorAll('input[name="matchOutcome"]').forEach(e=>e.checked=!1),d=vj,l=void 0,S.style.display="none",g.querySelectorAll('input[name="irregularWinner"]').forEach(e=>e.checked=!1),setTimeout(()=>{"function"==typeof R&&R()},0)}),y.appendChild(v),g.appendChild(y);const S=document.createElement("div");S.style.display="none",S.style.marginTop="0.3em",S.style.paddingLeft="1em",S.style.borderLeft="3px solid #ffeb3b";const b=document.createElement("div");b.textContent="Winner:",b.style.fontSize="0.75em",b.style.fontWeight="500",b.style.marginBottom="0.2em",b.style.color="#444",S.appendChild(b);const U=document.createElement("div");U.style.display="flex",U.style.gap="0.5em";const w=t.sides?.[0],T=t.sides?.[1];[1,2].forEach(e=>{const t=document.createElement("label");t.style.display="flex",t.style.alignItems="center",t.style.gap="0.3em",t.style.cursor="pointer";const r=document.createElement("input");r.type="radio",r.name="irregularWinner",r.value=e.toString(),r.addEventListener("change",()=>{l=e,setTimeout(()=>{"function"==typeof R&&R()},0)});const i=document.createElement("span"),n=1===e?w:T;i.textContent=n?.participant?.participantName||`Side ${e}`,i.style.fontSize="0.75em",t.appendChild(r),t.appendChild(i),U.appendChild(t)}),S.appendChild(U),g.appendChild(S),r.appendChild(g);const D=document.createElement("div");D.style.display="flex",D.style.flexDirection="column",D.style.gap="0.5em",r.appendChild(D);let P=[];globalThis.resetDynamicSets=()=>{D.innerHTML="",P=[],p.clear(),d=vj,l=void 0,m=void 0,f=void 0,h=void 0,g.querySelectorAll('input[name="matchOutcome"]').forEach(e=>e.checked=!1),g.querySelectorAll('input[name="irregularWinner"]').forEach(e=>e.checked=!1),g.style.display="none",S.style.display="none";const e=E(0);D.appendChild(e),e.querySelectorAll("input").forEach(e=>{e.addEventListener("input",x),e.addEventListener("keydown",F)}),N({clearAll:!0}),i({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"});const t=D.querySelector("input");t&&t.focus()};const N=e=>{let r;u.innerHTML="",e?.clearAll?(r=void 0,m=void 0):e?.scoreObject?(r=e.scoreObject,m=e.scoreObject):P.length>0?(r={sets:P},m={sets:P}):r=m,e?.clearAll?(f=void 0,h=void 0):(void 0!==e?.winningSide&&(f=e.winningSide),e?.matchUpStatus&&(h=e.matchUpStatus,[bj,Sj,Uj,wj,Tj].includes(h)&&0===P.length&&(r=void 0,m=void 0)));const i={...t,score:r,winningSide:f,matchUpStatus:h},n=qV().composition||"Australian",a=gB({matchUp:i,isLucky:!0,composition:EB[n]||EB.Australian});u.appendChild(a)},E=e=>{const t=document.createElement("div");t.className="set-row",t.style.display="flex",t.style.alignItems="center",t.style.gap="0.5em",t.style.marginBottom="0.25em";const r=document.createElement("div");r.textContent=`Set ${e+1}:`,r.style.width="3.5em",r.style.fontSize="0.9em",r.style.fontWeight="500",r.style.color="#444",t.appendChild(r);const i=document.createElement("input");i.type="text",i.className="input",i.style.width="3em",i.style.textAlign="center",i.placeholder="0",i.dataset.setIndex=e.toString(),i.dataset.side="1";const n=document.createElement("input");n.type="text",n.className="input",n.style.width="3em",n.style.textAlign="center",n.placeholder="0",n.dataset.setIndex=e.toString(),n.dataset.side="2";const a=document.createElement("span");a.textContent="-",a.style.fontWeight="bold",a.style.color="#666",t.appendChild(i),t.appendChild(a),t.appendChild(n);const o=document.createElement("span");o.className="tiebreak-container",o.style.display="none",o.style.marginLeft="0.5em";const s=document.createElement("span");s.textContent="(",s.style.color="#666";const c=document.createElement("input");c.type="text",c.className="input tiebreak-input",c.style.width="2.5em",c.style.textAlign="center",c.dataset.setIndex=e.toString(),c.dataset.type="tiebreak";const u=document.createElement("span");u.textContent=")",u.style.color="#666",o.appendChild(s),o.appendChild(c),o.appendChild(u),t.appendChild(o);const l=document.createElement("span");return l.className="set-indicator",l.style.fontSize="1.2em",l.style.minWidth="1.5em",t.appendChild(l),t},M=e=>{const t=D.querySelector(`input[data-set-index="${e}"][data-side="1"]`),r=D.querySelector(`input[data-set-index="${e}"][data-side="2"]`),i=D.querySelector(`input[data-set-index="${e}"][data-type="tiebreak"]`);if(!t||!r)return!1;const n=t.value.trim(),a=r.value.trim();if(""===n||""===a)return!1;return lj(e,{side1:Number.parseInt(n)||0,side2:Number.parseInt(a)||0,tiebreak:i?.value.trim()?Number.parseInt(i.value):void 0},o)},R=()=>{d===vj&&(S.style.display="none");const e=[];for(let t=0;t<s();t++){const r=D.querySelector(`input[data-set-index="${t}"][data-side="1"]`),i=D.querySelector(`input[data-set-index="${t}"][data-side="2"]`),n=D.querySelector(`input[data-set-index="${t}"][data-type="tiebreak"]`);if(!r||!i)break;const a=r.value.trim(),s=i.value.trim();if(""===a&&""===s)break;const c=n?.value.trim(),u=yj(t,a,s,c,o);e.push(u)}P=e;const r=D.querySelectorAll(".set-row");let n;if(pj(P,s(),c())){const e=P.filter(e=>void 0!==e.winningSide).length;n=Math.max(1,e)}else{const e=P.length-1;n=e>=0&&void 0!==P[e].winningSide&&P.length<s()?P.length+1:Math.max(1,P.length)}for(let t=r.length-1;t>=n;t--)r[t].remove();if(P.length>0||d!==vj){const e=P.some(e=>void 0===e.winningSide),r=function(e,t,r){if(!e||0===e.length)return{isValid:!1,sets:[],error:"At least one set is required"};const i=e.map(e=>{const t=e.side1??"",r=e.side2??"";if(!(t&&0!==t||r&&0!==r||void 0===e.side1TiebreakScore||void 0===e.side2TiebreakScore))return`[${e.side1TiebreakScore}-${e.side2TiebreakScore}]`;if(""===t||""===r)return"";if(void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore){const i=e.side1TiebreakScore??0,n=e.side2TiebreakScore??0;return`${t}-${r}(${Number(t)>Number(r)?n:i})`}return`${t}-${r}`}).filter(e=>""!==e).join(" ");return i?jV(i,t,r?void 0:BV):{isValid:!1,sets:[],error:"At least one complete set is required"}}((d!==vj||e?P:P.filter(e=>void 0!==e.winningSide)).map(e=>{if(0!==e.side1Score||0!==e.side2Score||void 0===e.side1TiebreakScore&&void 0===e.side2TiebreakScore){const t={side1:e.side1Score,side2:e.side2Score};return void 0!==e.side1TiebreakScore&&(t.side1TiebreakScore=e.side1TiebreakScore),void 0!==e.side2TiebreakScore&&(t.side2TiebreakScore=e.side2TiebreakScore),void 0!==e.winningSide&&(t.winningSide=e.winningSide),t}{const t={side1TiebreakScore:e.side1TiebreakScore,side2TiebreakScore:e.side2TiebreakScore};return void 0!==e.winningSide&&(t.winningSide=e.winningSide),t}}),t.matchUpFormat,d!==vj),n=r.isValid&&void 0!==r.winningSide;d!==vj?(g.style.display="block",S.style.display="block"):(S.style.display="none",g.style.display=n?"none":"block"),d!==vj&&(l?(r.matchUpStatus=d,r.winningSide=l,r.isValid=!0):d===bj?(r.matchUpStatus=wj,r.isValid=!0):d===Uj?(r.matchUpStatus=Tj,r.isValid=!0):(r.matchUpStatus=d,r.isValid=!1)),N(r),i(r)}else g.style.display="block",N(),i({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"})},A=()=>{const e=document.getElementById("clearScoreV2");if(e){const t=D.querySelectorAll(".set-row"),r=D.querySelector('input[data-set-index="0"][data-side="1"]'),i=D.querySelector('input[data-set-index="0"][data-side="2"]'),n=t.length>1||""!==r?.value.trim()||""!==i?.value.trim();e.disabled=!n}},C=e=>{const t=D.querySelector(`input[data-set-index="${e}"][data-side="1"]`),r=D.querySelector(`input[data-set-index="${e}"][data-side="2"]`),i=D.querySelector(`.set-row:nth-child(${e+1}) .tiebreak-container`),n=D.querySelector(`input[data-set-index="${e}"][data-type="tiebreak"]`);if(!t||!r||!i)return;gj(e,{side1:Number.parseInt(t.value)||0,side2:Number.parseInt(r.value)||0},o)?i.style.display="inline":(i.style.display="none",n&&(n.value=""))},k=(e,t)=>{const r="1"===t?"2":"1",i=D.querySelector(`input[data-set-index="${e}"][data-side="${r}"]`),n=D.querySelector(`input[data-set-index="${e}"][data-side="${t}"]`),a=Number.parseInt(n?.value)||0,s=Number.parseInt(i?.value)||0;return uj(e,"1"===t?1:2,{side1:"1"===t?a:s,side2:"2"===t?a:s},o)},x=e=>{const r=e.target,i="tiebreak"===r.dataset.type;d!==vj&&r.value&&(d=vj,l=void 0,g.querySelectorAll('input[name="matchOutcome"]').forEach(e=>e.checked=!1),S.style.display="none");const n=r.value.replace(/\D/g,"");n!==r.value&&(r.value=n);const a=Number.parseInt(r.dataset.setIndex||"0"),u=r.dataset.side||"1",p=void 0!==(e=>oj(e,o))(a)?.tiebreakSet?.tiebreakTo;if(i)r.value.length>2&&(r.value=r.value.slice(0,2));else if(p)r.value.length>3&&(r.value=r.value.slice(0,3));else{const e=k(a,u);(Number.parseInt(r.value)||0)>e&&(r.value=e.toString())}if(!i&&(C(a),!p)){const e="1"===u?"2":"1",t=D.querySelector(`input[data-set-index="${a}"][data-side="${e}"]`);if(t?.value.trim()){const r=Number.parseInt(t.value)||0,i=k(a,e);r>i&&(t.value=i.toString())}}if(R(),A(),M(a)&&!pj(P,s(),c())&&function(e,t){if(!e||0===e.length)return!0;const r=aj(t),{bestOf:i,isExactlyFormat:n,setsToWin:a}=r,o=r.exactly||i;if(n){if(e.length>=o)return!1;const i=NC.parse(t);if(i?.aggregate&&void 0!==i?.finalSetFormat?.tiebreakSet?.tiebreakTo&&r.isTimed){const t=o-1;if(e.length<t)return!0;if(e.length===t){const t=e.reduce((e,t)=>(void 0!==t.side1Score&&null!==t.side1Score&&(e.side1+=t.side1Score),void 0!==t.side2Score&&null!==t.side2Score&&(e.side2+=t.side2Score),e),{side1:0,side2:0});return t.side1===t.side2}return!1}return!0}const s={side1:0,side2:0};return e.forEach(e=>{const t=e.side1Score??0,r=e.side2Score??0;t>r?s.side1++:r>t&&s.side2++}),!(s.side1>=a||s.side2>=a||e.length>=i)&&e.every(e=>void 0!==e.side1Score&&void 0!==e.side2Score&&null!==e.side1Score&&null!==e.side2Score)}(P,t.matchUpFormat)){const e=P.length,t=D.querySelector(`input[data-set-index="${e}"]`);if(e<s()&&!t){const t=E(e);D.appendChild(t),t.querySelectorAll("input").forEach(e=>{e.addEventListener("input",x),e.addEventListener("keydown",F)}),A()}}},O=e=>{e.focus(),e.select()},F=e=>{const t=e.target,r=Number.parseInt(t.dataset.setIndex||"0"),i=t.dataset.side||"1",n="tiebreak"===t.dataset.type,a=!0===[WV.scoringApproach,WV.smartComplements,WV.composition][1];if("1"===i&&!n){const i=e.code.match(/^Digit(\d)$/);if(i){const n=Number.parseInt(i[1]);if(""===t.value){const i=hj(n,e.shiftKey,r,P,o,p,a);if(i.shouldApply){e.preventDefault(),t.value=i.field1Value.toString();const n=D.querySelector(`input[data-set-index="${r}"][data-side="2"]`);return n&&(n.value=i.field2Value.toString()),p.add(r),t.dispatchEvent(new Event("input",{bubbles:!0})),void setTimeout(()=>{if(R(),pj(P,s(),c()))return;const e=D.querySelector(`input[data-set-index="${r+1}"][data-side="1"]`);if(e)O(e);else if(r+1<s()){const e=E(r+1);D.appendChild(e);const t=e.querySelectorAll("input");t.forEach(e=>{e.addEventListener("input",x),e.addEventListener("keydown",F)});const i=t[0];i instanceof HTMLInputElement&&O(i),A()}},10)}}}}if("Tab"===e.key)if(e.preventDefault(),e.shiftKey){if(n){const e=D.querySelector(`input[data-set-index="${r}"][data-side="2"]`);e&&O(e)}else if("2"===i){const e=D.querySelector(`input[data-set-index="${r}"][data-side="1"]`);e&&O(e)}else if(r>0){const e=D.querySelector(`input[data-set-index="${r-1}"][data-type="tiebreak"]`),t=D.querySelector(`input[data-set-index="${r-1}"][data-side="2"]`),i=e?.closest(".tiebreak-container");e&&i&&"none"!==i.style.display?O(e):t&&O(t)}}else if(n){const e=D.querySelector(`input[data-set-index="${r+1}"][data-side="1"]`);if(e)O(e);else if(r+1<s()){if(!M(r)||(R(),pj(P,s(),c())))return;const e=E(r+1);D.appendChild(e);const t=e.querySelectorAll("input");t.forEach(e=>{e.addEventListener("input",x),e.addEventListener("keydown",F)});const i=t[0];i instanceof HTMLInputElement&&O(i),A()}}else if("1"===i){const e=D.querySelector(`input[data-set-index="${r}"][data-side="2"]`);e&&O(e)}else if("2"===i){R();const e=D.querySelector(`input[data-set-index="${r}"][data-type="tiebreak"]`),t=e?.closest(".tiebreak-container");if(e&&t&&"none"!==t.style.display)O(e);else{const e=D.querySelector(`input[data-set-index="${r+1}"][data-side="1"]`);if(e)O(e);else if(r+1<s()){if(!M(r)||pj(P,s(),c()))return;const e=E(r+1);D.appendChild(e);const t=e.querySelectorAll("input");t.forEach(e=>{e.addEventListener("input",x),e.addEventListener("keydown",F)}),O(t[0]),A()}}}if("Enter"===e.key){const e=document.getElementById("submitScoreV2");e&&!e.disabled&&e.click()}if("Backspace"===e.key&&""===t.value)if(e.preventDefault(),n){const e=D.querySelector(`input[data-set-index="${r}"][data-side="2"]`);e&&O(e)}else if("2"===i){const e=D.querySelector(`input[data-set-index="${r}"][data-side="1"]`);e&&O(e)}else if(r>0){const e=D.querySelector(`input[data-set-index="${r-1}"][data-type="tiebreak"]`),t=D.querySelector(`input[data-set-index="${r-1}"][data-side="2"]`),i=e?.closest(".tiebreak-container");e&&i&&"none"!==i.style.display?O(e):t&&O(t)}},_=E(0);if(D.appendChild(_),_.querySelectorAll("input").forEach(e=>{e.addEventListener("input",x),e.addEventListener("keydown",F)}),m?.sets&&m.sets.length>0){const e=Math.ceil(s()/2);let t=0,r=0,i=!1;m.sets.forEach((n,a)=>{if(i)return;if(a>0){const e=E(a);D.appendChild(e),e.querySelectorAll("input").forEach(e=>{e.addEventListener("input",x),e.addEventListener("keydown",F)})}const o=D.querySelector(`input[data-set-index="${a}"][data-side="1"]`),s=D.querySelector(`input[data-set-index="${a}"][data-side="2"]`),u=D.querySelector(`input[data-set-index="${a}"][data-type="tiebreak"]`);o&&s&&(o.value=n.side1Score?.toString()||"",s.value=n.side2Score?.toString()||"",C(a),u&&(void 0!==n.side1TiebreakScore||void 0!==n.side2TiebreakScore)&&(1===n.winningSide&&void 0!==n.side2TiebreakScore?u.value=n.side2TiebreakScore.toString():2===n.winningSide&&void 0!==n.side1TiebreakScore||void 0!==n.side1TiebreakScore?u.value=n.side1TiebreakScore.toString():void 0!==n.side2TiebreakScore&&(u.value=n.side2TiebreakScore.toString()))),1===n.winningSide&&t++,2===n.winningSide&&r++,i=(t>=e||r>=e)&&(!c()||a+1>=c())})}else N();t.matchUpStatus&&t.matchUpStatus!==vj&&[Sj,bj,Uj,wj,Tj].includes(t.matchUpStatus)&&(t.matchUpStatus===wj?(d=bj,l=void 0):t.matchUpStatus===Tj?(d=Uj,l=void 0):(d=t.matchUpStatus,l=t.winningSide),g.querySelectorAll('input[name="matchOutcome"]').forEach(e=>{e.value===d&&(e.checked=!0)}),l&&(g.querySelectorAll('input[name="irregularWinner"]').forEach(e=>{Number.parseInt(e.value)===l&&(e.checked=!0)}),S.style.display="block")),m?.sets&&m.sets.length>0?R():d!==vj?N():(g.style.display="none",S.style.display="none"),setTimeout(()=>{const e=D.querySelector("input");e&&e.focus()},100)}function Pj(e,t){const{matchUpFormat:r}=t;if(!e)return"";const i=NC.parse(r),n=i?.setFormat?.bestOf||3,a=e=>e===n&&i?.finalSetFormat?i.finalSetFormat:i?.setFormat;let o="",s=0,c=0;const u=e.split(/[\s/]+|--+/).filter(e=>e.length>0);for(const l of u){s=0;const e=l;for(;s<e.length&&c<n&&!(c>=n);){const t=a(c+1),r=t?.tiebreakSet?.tiebreakTo,i=t?.setTo,n=!!r&&!i,u=!0===t?.timed,l=u?999:r||i||6,d=t?.tiebreakAt||l;let p="",m="",f="";for(;s<e.length;){const t=e[s];if("-"===t){s++;break}if(n||u){p+=t,s++;continue}const r=p+t,i=u?999:l+1;if(Number.parseInt(r)>i||p.length>0&&p.length>=2)break;p+=t,s++;const a=Number.parseInt(p);if(1===p.length&&1!==a&&i<10){if(s<e.length&&"-"===e[s])continue;break}}for(;s<e.length;){const t=e[s];if("-"===t){if(u&&m.length>0){s++;break}break}if(n||u){m+=t,s++;continue}const r=m+t,i=u?999:l+1;if(Number.parseInt(r)>l+3||m.length>0&&m.length>=2)break;m+=t,s++;const a=Number.parseInt(m);if(1===m.length&&1!==a&&i<10)break}if(!m){o&&(o+=" "),o+=p;break}let h=Number.parseInt(p),g=Number.parseInt(m),I=!1;!n&&!u&&(h>l+1&&(h=l,p=l.toString(),I=!0),g>l+1&&(g=l,m=l.toString(),I=!0),h===l+1&&g<l-1?(h=l,p=l.toString(),I=!0):g===l+1&&h<l-1&&(g=l,m=l.toString(),I=!0));const y=Math.abs(h-g),v=Math.max(h,g),S=u||v>=l&&y>=2,b=s<e.length;if(!I&&(h===d&&g===d||(h===d+1&&g===d||g===d+1&&h===d)&&b)){for(;s<e.length;){const t=e[s];if("-"===t){s++;break}f+=t,s++}o&&(o+=" "),f?(o+=`${p}-${m}(${f})`,c++):o+=`${p}-${m}(`}else if(o&&(o+=" "),o+=n?`[${p}-${m}]`:`${p}-${m}`,S)c++;else if(s<e.length)break}}return o}const{COMPLETED:Nj,RETIRED:Ej,WALKOVER:Mj,DEFAULTED:Rj,DOUBLE_WALKOVER:Aj,DOUBLE_DEFAULT:Cj}=Sf;function kj(e){const{matchUp:t,container:r,onScoreChange:i}=e;try{r.innerHTML="",r.style.display="flex",r.style.flexDirection="column",r.style.gap="1em";const e=NC.parse(t.matchUpFormat||"SET3-S:6/TB7"),n=e?.setFormat?.setTo||6,a=e?.setFormat?.tiebreakAt||n;let o=t.score?{...t.score}:void 0,s=t.winningSide,c=t.matchUpStatus;const u={digits:"",setTo:n,tiebreakAt:a,isMatchComplete:!1};if(o){u.digits=function(e){if(!e?.sets||0===e.sets.length)return"";const t=[];return e.sets.forEach((e,r)=>{if(r>0&&t.push(" "),t.push(e.side1Score?.toString()||"0"),t.push(e.side2Score?.toString()||"0"),void 0!==e.side1TiebreakScore||void 0!==e.side2TiebreakScore){const r=1===e.winningSide?e.side2TiebreakScore:e.side1TiebreakScore;void 0!==r&&(t.push("-"),t.push(r.toString()))}}),t.join("")}(o);const e=Pj(u.digits,{matchUpFormat:t.matchUpFormat||"SET3-S:6/TB7"});if(e&&e.includes("-")){const r=jV(e,t.matchUpFormat);u.isMatchComplete=r.isValid&&void 0!==r.winningSide&&(r.matchUpStatus===Nj||void 0===r.matchUpStatus)}}const l=document.createElement("div");if(l.style.marginBottom="0.5em",r.appendChild(l),e?.aggregate){const e=document.createElement("div");e.style.fontSize="0.75em",e.style.color="#666",e.style.marginTop="0.25em",e.style.marginBottom="0.5em",e.style.padding="0.25em 0.5em",e.style.backgroundColor="#fff3cd",e.style.border="1px solid #ffc107",e.style.borderRadius="3px",e.textContent="\u26a0\ufe0f Aggregate Scoring: Winner determined by total points across all sets",r.appendChild(e)}if(t.matchUpFormat){const e=document.createElement("div");e.style.fontSize="0.9em",e.style.marginBottom="0.5em",e.style.display="flex",e.style.alignItems="center",e.style.gap="0.5em";const n=document.createElement("span");n.textContent="Format:",n.style.color="#666",e.appendChild(n);const a=document.createElement("button");a.textContent=t.matchUpFormat,a.className="button is-small is-white",a.style.fontSize="0.75em",a.style.padding="0.2em 0.5em",a.style.cursor="pointer",a.title="Click to edit format",a.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:e}=await Promise.resolve().then(()=>D$);e({existingMatchUpFormat:t.matchUpFormat,callback:e=>{e&&e!==t.matchUpFormat&&(t.matchUpFormat=e,a.textContent=e,u.digits="",r.innerHTML="",kj({matchUp:t,container:r,onScoreChange:i}))},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(e){console.error("Error opening format selector:",e)}}),e.appendChild(a),r.appendChild(e)}const d=document.createElement("div");d.style.fontSize="1.2em",d.style.color="#64B5F6",d.style.textAlign="center",d.style.padding="0.25em 0.5em",d.style.fontWeight="bold",d.style.minHeight="1.5em",d.style.maxWidth="300px",d.style.margin="0 auto",d.textContent="-",r.appendChild(d);let p,m=Nj;const f=document.createElement("div");f.style.display="none",f.style.marginBottom="0.8em",f.style.padding="0.6em",f.style.backgroundColor="#fff3cd",f.style.border="2px solid #ffc107",f.style.borderRadius="4px";const h=document.createElement("div");h.textContent="Irregular Ending:",h.style.fontSize="0.8em",h.style.fontWeight="600",h.style.marginBottom="0.3em",h.style.color="#856404",f.appendChild(h);const g=document.createElement("div");g.style.display="none",g.style.marginTop="0.3em";const I=document.createElement("div");I.textContent="Winner:",I.style.fontSize="0.75em",I.style.fontWeight="500",I.style.marginBottom="0.2em",I.style.color="#856404",g.appendChild(I);const y=document.createElement("div");y.style.display="flex",y.style.gap="0.5em",y.style.flexWrap="wrap";const v=t.sides?.[0],S=t.sides?.[1];[1,2].forEach(e=>{const t=document.createElement("label");t.style.display="flex",t.style.alignItems="center",t.style.gap="0.3em",t.style.cursor="pointer";const r=document.createElement("input");r.type="radio",r.name="irregularWinner",r.value=e.toString(),r.addEventListener("change",()=>{r.checked&&(p=e,T())});const i=document.createElement("span"),n=1===e?v:S;i.textContent=n?.participant?.participantName||`Side ${e}`,i.style.fontSize="0.75em",i.style.color="#856404",t.appendChild(r),t.appendChild(i),y.appendChild(t)}),g.appendChild(y),f.appendChild(g),r.appendChild(f);const b=document.createElement("div");b.style.display="grid",b.style.gridTemplateColumns="repeat(4, 1fr)",b.style.gap="8px",b.style.width="100%",b.style.maxWidth="320px",b.style.margin="0 auto",r.appendChild(b);const U=e=>Pj(e,{matchUpFormat:t.matchUpFormat||"SET3-S:6/TB7"}),w=e=>{l.innerHTML="";const r=e?.scoreObject?.sets?.length>0;e?.clearAll?(o=void 0,s=void 0,c=void 0):null!=e&&(r&&(o=e?.scoreObject),"winningSide"in e&&(s=e?.winningSide),"matchUpStatus"in e&&(c=e?.matchUpStatus));const i={...t,score:e?.clearAll?void 0:r?o:void 0,winningSide:s,matchUpStatus:c},n=qV().composition||"Australian",a=gB({matchUp:i,isLucky:!0,composition:EB[n]||EB.Australian});a&&l.appendChild(a)},T=(e=!1)=>{const r=U(u.digits);if(r?(d.style.display="block",d.textContent=r):(d.style.display="block",d.textContent="-"),m===Ej||m===Mj||m===Rj?(f.style.display="block",g.style.display="block"):(f.style.display="none",g.style.display="none"),e)return void w({clearAll:!0});let n=jV(r,t.matchUpFormat);u.isMatchComplete=n.isValid&&void 0!==n.winningSide&&(n.matchUpStatus===Nj||void 0===n.matchUpStatus),m!==Nj&&(p?(n.matchUpStatus=m,n.winningSide=p,n.isValid=!0):m===Mj?(n.matchUpStatus=Aj,n.isValid=!0):m===Rj?(n.matchUpStatus=Cj,n.isValid=!0):(n.matchUpStatus=m,n.isValid=!1),u.isMatchComplete=!1),w(n),i(n);const a=document.getElementById("clearScoreV2");a&&(a.disabled=0===u.digits.length&&m===Nj),E(),M()},D=e=>{m!==Nj&&"number"==typeof e&&(m=Nj,p=void 0,f.querySelectorAll('input[name="matchOutcome"]').forEach(e=>e.checked=!1),g.style.display="none"),"number"==typeof e&&""===u.digits&&e>n&&(e=n);const r=U(u.digits),i=r.includes("(")&&!r.includes(")"),a=u.digits.includes("-"),o=(u.digits.match(/-/g)||[]).length,s=r.includes("[")&&a&&1===o,c=(r?jV(r,t.matchUpFormat):null)?.sets?.length||0,l=NC.parse(t.matchUpFormat),d=l?.setFormat?.bestOf||3,h=e=>{const t=e===d&&l?.finalSetFormat?l.finalSetFormat:l?.setFormat,r=t?.tiebreakSet?.tiebreakTo,i=t?.setTo;return!!r&&!i},I=c<d&&h(c+1),y=c>0&&h(c),v=i||s||I||y,S="-"===e?u.digits+"-":u.digits+e.toString(),b=U(S);if(r){const i=jV(r,t.matchUpFormat),n=i.sets?.[i.sets.length-1],a=r.includes("("),o=b.includes("("),s=a&&o&&b!==r&&b.startsWith(r.substring(0,r.lastIndexOf(")"))),c=n&&(void 0===n.side1TiebreakScore&&void 0===n.side2TiebreakScore||null==n.side1TiebreakScore&&null==n.side2TiebreakScore||s)&&void 0!==n.side1Score&&void 0!==n.side2Score&&(n.side1Score===n.side2Score||1===Math.abs(n.side1Score-n.side2Score));if(i.isValid&&i.winningSide&&!v&&!c||!v&&"-"!==e&&b===r)return}"-"===e?u.digits.endsWith("-")||(u.digits+="-"):u.digits+=e.toString(),T()},P=()=>{u.digits.length>0&&(u.digits=u.digits.slice(0,-1),T())},N=()=>{u.digits="",u.isMatchComplete=!1,m=Nj,p=void 0,o=void 0,s=void 0,c=void 0,f.querySelectorAll('input[name="irregularWinner"]').forEach(e=>e.checked=!1),f.querySelectorAll('input[name="matchOutcome"]').forEach(e=>e.checked=!1),f.style.display="none",g.style.display="none",d.style.display="block",d.textContent="-",w({clearAll:!0}),M(),i({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"})};globalThis.resetDialPad=N;const E=()=>{const e=b.querySelector('[data-button="retired"]'),t=b.querySelector('[data-button="defaulted"]'),r=U(u.digits),i=!(r.includes("-")&&r.length>2)||u.isMatchComplete;e&&(e.disabled=i),t&&(t.disabled=i)},M=()=>{const e=m!==Nj&&void 0!==p||u.isMatchComplete;b.querySelectorAll("button").forEach(t=>{const r=t.textContent||"";(r.match(/^[0-9]$/)||"-"===r)&&(t.disabled=e)})};[{label:"1",value:1},{label:"2",value:2},{label:"3",value:3},{label:"RET",value:"retired",isSpecial:!0,requiresScore:!0},{label:"4",value:4},{label:"5",value:5},{label:"6",value:6},{label:"WO",value:"walkover",isSpecial:!0},{label:"7",value:7},{label:"8",value:8},{label:"9",value:9},{label:"DEF",value:"defaulted",isSpecial:!0,requiresScore:!0},{label:"\u232b",value:"delete",isSpecial:!0},{label:"0",value:0},{label:"-",value:"minus",isSpecial:!0},{label:"",value:"empty",isSpecial:!0,disabled:!0}].forEach(e=>{const t=document.createElement("button");t.className="button is-white",t.textContent=e.label,t.style.cssText="\n        height: 55px !important;\n        width: 100% !important;\n        padding: 0.5em !important;\n        color: #000 !important;\n        border: 1px solid #dbdbdb !important;\n      ",e.label.length>1&&!e.isSpecial?t.style.fontSize="1.3em":e.isSpecial&&["RET","WO","DEF"].includes(e.label)?(t.style.fontSize="0.95em",t.style.backgroundColor="#ffe0b2"):e.isSpecial?(t.style.fontSize="1.3em",t.style.backgroundColor="#f0f0f0"):t.style.fontSize="1.3em",("retired"===e.value||"defaulted"===e.value)&&(t.dataset.button=e.value),e.disabled&&(t.disabled=!0,t.style.visibility="hidden"),e.requiresScore&&(t.disabled=!0),t.onclick=()=>{"delete"===e.value?P():"minus"===e.value?D("-"):"retired"===e.value?(m=Ej,p=void 0,f.querySelectorAll('input[name="irregularWinner"]').forEach(e=>e.checked=!1),T()):"walkover"===e.value?(m=Mj,p=void 0,u.digits="",f.querySelectorAll('input[name="irregularWinner"]').forEach(e=>e.checked=!1),T(),M()):"defaulted"===e.value?(m=Rj,p=void 0,f.querySelectorAll('input[name="irregularWinner"]').forEach(e=>e.checked=!1),T()):"empty"===e.value||D(e.value)},b.appendChild(t)});const R=e=>{if(e.key>="0"&&e.key<="9")e.preventDefault(),D(Number.parseInt(e.key));else if("Backspace"===e.key||"Delete"===e.key)e.preventDefault(),P();else if("-"===e.key||" "===e.key||"/"===e.key)e.preventDefault(),D("-");else if(")"===e.key){e.preventDefault();const t=U(u.digits);t.includes("(")&&!t.includes(")")&&(u.digits+="-",T())}};r.setAttribute("tabindex","-1"),r.style.outline="none",r.addEventListener("keydown",R),setTimeout(()=>r.focus(),100);const A=()=>{r.removeEventListener("keydown",R)};globalThis.cleanupDialPad=A;const C=c===Ej||c===Mj||c===Rj||c===Aj||c===Cj;C?(c===Aj?(m=Mj,p=void 0):c===Cj?(m=Rj,p=void 0):(m=c,p=s),f.querySelectorAll('input[name="matchOutcome"]').forEach(e=>{e.value===m&&(e.checked=!0)}),p&&(f.querySelectorAll('input[name="irregularWinner"]').forEach(e=>{Number.parseInt(e.value)===p&&(e.checked=!0)}),g.style.display="block")):!o&&(!c||"TO_BE_PLAYED"===c)&&N(),u.digits||C?(T(),setTimeout(()=>{const e=document.getElementById("clearScoreV2");e&&(e.disabled=!1),M()},0)):(w(null),M())}catch(n){console.error("Error rendering dial pad:",n),r.innerHTML=`<p style="color: red;">Error: ${n instanceof Error?n.message:"Unknown error"}</p>`}}function xj(e){const{matchUp:t,callback:r}=e,i=qV().scoringApproach||"dynamicSets",n=document.createElement("div");n.style.padding="1em";const a=!(!t.score?.sets?.length&&!t.matchUpStatus);let o=null,s=!1;const c=e=>{o=e,s&&(e.sets?.length>0||e.score)&&(s=!1);const t=document.getElementById("submitScoreV2");if(t){const r=e.isValid||s&&a;t.disabled=!r}const r=document.getElementById("clearScoreV2");if(r){const t=document.getElementById("scoreInputV2");if(t)r.disabled=!t.value.trim();else{const t=e.sets&&e.sets.length>0,i=e.matchUpStatus&&"COMPLETED"!==e.matchUpStatus&&"TO_BE_PLAYED"!==e.matchUpStatus,n=t||i;r.disabled=!n}}},u=()=>{window.cleanupDialPad&&(window.cleanupDialPad(),window.cleanupDialPad=void 0),window.resetDialPad&&(window.resetDialPad=void 0),window.resetDynamicSets&&(window.resetDynamicSets=void 0)};"freeScore"===i?function(e){const{matchUp:t,container:r,onScoreChange:i}=e;r.innerHTML="",r.style.display="flex",r.style.flexDirection="column",r.style.gap="1em";const n=t?.sides?.find(e=>1===e.sideNumber),a=t?.sides?.find(e=>2===e.sideNumber);let o=t.score?{...t.score}:void 0,s=t.winningSide,c=t.matchUpStatus;const u=document.createElement("div");u.style.marginBottom="0.25em",r.appendChild(u);const l=document.createElement("div");l.style.display="none",l.style.marginTop="0.25em",l.style.padding="0.35em 0.5em",l.style.backgroundColor="#f5f5f5",l.style.borderRadius="4px",l.style.flexDirection="column",l.style.gap="0.35em";const d=document.createElement("label");d.style.display="flex",d.style.alignItems="center",d.style.gap="0.4em",d.style.cursor="pointer";const p=document.createElement("input");p.type="radio",p.name="winnerSelection",p.value="1";const m=document.createElement("span");m.textContent=n?.participant?.participantName||"Side 1",m.style.fontSize="0.75em",d.appendChild(p),d.appendChild(m);const f=document.createElement("label");f.style.display="flex",f.style.alignItems="center",f.style.gap="0.4em",f.style.cursor="pointer";const h=document.createElement("input");h.type="radio",h.name="winnerSelection",h.value="2";const g=document.createElement("span");g.textContent=a?.participant?.participantName||"Side 2",g.style.fontSize="0.75em",f.appendChild(h),f.appendChild(g),l.appendChild(d),l.appendChild(f),r.appendChild(l);const I=e=>{const{WALKOVER:r,CANCELLED:i,DEAD_RUBBER:n}=Sf,a=[r,i,n],l=e?.matchUpStatus&&a.includes(e.matchUpStatus);let d;e?.clearAll||l?(d=void 0,o=void 0):e?.scoreObject?(d=e.scoreObject,o=e.scoreObject):d=o,e?.clearAll?(s=void 0,c=void 0):null!=e&&("winningSide"in e&&(s=e.winningSide),"matchUpStatus"in e&&(c=e.matchUpStatus));const p={...t,score:d,winningSide:s,matchUpStatus:c};u.innerHTML="";const m=qV().composition||"Australian",f=gB({matchUp:p,isLucky:!0,composition:EB[m]||EB.Australian});u.appendChild(f)};if(I(),t.matchUpFormat){const e=document.createElement("div");e.style.fontSize="0.9em",e.style.marginBottom="0.5em",e.style.display="flex",e.style.alignItems="center",e.style.gap="0.5em";const i=document.createElement("span");i.textContent="Format:",i.style.color="#666",e.appendChild(i);const n=document.createElement("button");n.textContent=t.matchUpFormat,n.className="button is-small is-white",n.style.fontSize="0.75em",n.style.padding="0.2em 0.5em",n.style.cursor="pointer",n.title="Click to edit format",n.addEventListener("click",async()=>{try{const{getMatchUpFormatModal:e}=await Promise.resolve().then(()=>D$);e({existingMatchUpFormat:t.matchUpFormat,callback:e=>{if(e&&e!==t.matchUpFormat){t.matchUpFormat=e,n.textContent=e;const r=document.getElementById("scoreInputV2");r&&(r.value="",r.dispatchEvent(new Event("input",{bubbles:!0}))),U.textContent="Score cleared - format changed",U.style.color="#999"}},modalConfig:{style:{fontSize:"12px",border:"3px solid #0066cc"}}})}catch(e){console.error("[FreeScore] Error opening format selector:",e)}}),e.appendChild(n),r.appendChild(e)}const y=document.createElement("div");y.style.display="flex",y.style.alignItems="center",y.style.gap="0.5em";const v=document.createElement("input");if(v.type="text",v.className="input",v.placeholder="",v.style.flex="1",v.id="scoreInputV2",o){const e=function(e,t){let r="";if(e&&(r=(e.sets||[]).map(e=>{let t=`${e.side1Score||0}-${e.side2Score||0}`;return void 0===e.side1TiebreakScore&&void 0===e.side2TiebreakScore||(t+=`(${1===e.winningSide?e.side2TiebreakScore:e.side1TiebreakScore})`),t}).join(" ")),t&&"COMPLETED"!==t&&"TO_BE_PLAYED"!==t){const e=function(e){return{RETIRED:"ret",WALKOVER:"wo",DEFAULTED:"def",DOUBLE_WALKOVER:"wo",DOUBLE_DEFAULT:"def",SUSPENDED:"susp",CANCELLED:"canc",INCOMPLETE:"inc",DEAD_RUBBER:"dr",IN_PROGRESS:"in",AWAITING_RESULT:"await"}[e]||""}(t);if(e)return r?`${r} ${e}`:e}return r}(o,c);v.value=e}const S=document.createElement("span");S.style.fontSize="1.2em",S.style.minWidth="1.5em",y.appendChild(v),y.appendChild(S),r.appendChild(y);const b=document.createElement("div");b.style.fontSize="0.9em",b.style.color="#0066cc",b.style.fontFamily="monospace",b.style.minHeight="1.5em",b.style.padding="0.25em",r.appendChild(b);const U=document.createElement("div");U.style.fontSize="0.9em",U.style.minHeight="1.5em",r.appendChild(U);let w=s;const T=()=>{p.checked?(w=1,d.style.fontWeight="bold",d.style.color="#22c55e",f.style.fontWeight="",f.style.color=""):h.checked&&(w=2,f.style.fontWeight="bold",f.style.color="#22c55e",d.style.fontWeight="",d.style.color=""),D()};p.addEventListener("change",T),h.addEventListener("change",T);const D=()=>{const e=v.value.trim();if(!e)return S.textContent="",b.textContent="",U.textContent="",U.style.color="",l.style.display="none",p.checked=!1,h.checked=!1,d.style.fontWeight="",d.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,I({clearAll:!0}),void i({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"});const r=CV(e,t.matchUpFormat);r.formattedScore?b.textContent=r.formattedScore:b.textContent="";const n=r.matchUpStatus&&[YV,KV,XV,QV,JV,ZV,ej,tj,rj].includes(r.matchUpStatus),a=r.formattedScore?jV(r.formattedScore,t.matchUpFormat,r.matchUpStatus):{isValid:!1,sets:[],error:"No score to validate"},o=a.sets&&a.sets.length>0,s=w||a.winningSide;if((o&&a.scoreObject||n)&&I({scoreObject:a.scoreObject,winningSide:s,matchUpStatus:a.matchUpStatus||r.matchUpStatus}),a.isValid||n){S.textContent="\u2713",S.style.color="green";let t,o="Valid score";a.matchUpStatus===YV?o="Valid score - RETIRED":a.matchUpStatus===KV?o="Valid score - WALKOVER":a.matchUpStatus===XV?o="Valid score - DEFAULTED":a.matchUpStatus===QV?o="Valid score - SUSPENDED":a.matchUpStatus===JV?o="Valid score - CANCELLED":a.matchUpStatus===ZV?o="Valid score - INCOMPLETE":a.matchUpStatus===ej?o="Valid score - DEAD RUBBER":a.matchUpStatus===tj?o="Valid score - IN PROGRESS":a.matchUpStatus===rj&&(o="Valid score - AWAITING RESULT"),U.textContent=o,U.style.color="green";const s=n&&[YV,KV,XV].includes(a.matchUpStatus||r.matchUpStatus),c=n&&[JV,ej,rj,ZV,tj,QV].includes(a.matchUpStatus||r.matchUpStatus);if(s){if(l.style.display="flex",t=w,!t){const t=a.matchUpStatus||r.matchUpStatus;return t===KV?void i({...a,isValid:!0,matchUpStatus:ij,score:r.formattedScore||e}):t===XV?void i({...a,isValid:!0,matchUpStatus:nj,score:r.formattedScore||e}):void i({...a,isValid:!1,error:"Winner must be selected for irregular ending",matchUpStatus:t,score:r.formattedScore||e})}}else c?(l.style.display="none",p.checked=!1,h.checked=!1,d.style.fontWeight="",d.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,t=void 0):(l.style.display="none",p.checked=!1,h.checked=!1,d.style.fontWeight="",d.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,t=a.winningSide);i({...a,isValid:!0,winningSide:t,matchUpStatus:a.matchUpStatus||r.matchUpStatus,score:r.formattedScore||e})}else!a.isValid&&o?(S.textContent="\u22ef",S.style.color="orange",U.textContent=a.error||"Score incomplete - continue typing",U.style.color="orange",l.style.display="none",p.checked=!1,h.checked=!1,d.style.fontWeight="",d.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,i(a)):(S.textContent="\u2717",S.style.color="red",U.textContent=a.error||"Invalid score",U.style.color="red",l.style.display="none",p.checked=!1,h.checked=!1,d.style.fontWeight="",d.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,I({scoreObject:void 0,winningSide:void 0,matchUpStatus:void 0}),i(a))};let P=!1;v.addEventListener("input",()=>{D();const e=v.value,r=e.trim();if(!P&&r){const i=CV(r,t.matchUpFormat),n=i.formattedScore?jV(i.formattedScore,t.matchUpFormat,i.matchUpStatus):{isValid:!1,winningSide:void 0},a=n.isValid&&void 0!==n.winningSide,o=e.length>0&&/[\s-]$/.test(e),s=NC.parse(t.matchUpFormat),c=!!s?.exactly||1===s?.bestOf,u=s?.exactly||s?.bestOf||3,l=i.sets?.length>=u;a&&o&&(!c||l)&&(P=!0)}else if(P){const t=e.length>0&&/[\s-]$/.test(e);(0===r.length||!t)&&(P=!1)}}),v.addEventListener("keydown",e=>{P&&!["Backspace","Delete","ArrowLeft","ArrowRight","Tab"].includes(e.key)&&e.preventDefault()}),v.addEventListener("keyup",e=>{if("Enter"===e.key){const e=document.getElementById("submitScoreV2");e&&!e.disabled&&e.click()}}),1===s?(p.checked=!0,d.style.fontWeight="bold",d.style.color="#22c55e"):2===s&&(h.checked=!0,f.style.fontWeight="bold",f.style.color="#22c55e"),setTimeout(()=>{v.focus(),c===ij||c===nj?(I({scoreObject:o,winningSide:s,matchUpStatus:c}),i({isValid:!0,sets:o?.sets||[],scoreObject:o,winningSide:s,matchUpStatus:c})):(v.value||c&&"TO_BE_PLAYED"!==c&&"COMPLETED"!==c)&&D()},100),globalThis.resetFreeScore=()=>{v.value="",o=void 0,s=void 0,c=void 0,S.textContent="",b.textContent="",U.textContent="",U.style.color="",l.style.display="none",p.checked=!1,h.checked=!1,d.style.fontWeight="",d.style.color="",f.style.fontWeight="",f.style.color="",w=void 0,P=!1,I({clearAll:!0}),i({isValid:!1,sets:[],matchUpStatus:"TO_BE_PLAYED"}),v.focus()}}({matchUp:t,container:n,onScoreChange:c}):"dynamicSets"===i?Dj({matchUp:t,container:n,onScoreChange:c}):"dialPad"===i?kj({matchUp:t,container:n,onScoreChange:c}):n.innerHTML="<p>Unknown scoring approach...</p>",Ue.open({title:"Score Entry",content:n,config:"freeScore"===i?{info:'\n    <strong>Score Entry Tips:</strong><br><br>\n    <strong>Set Scores:</strong> Enter space or dash-separated (e.g., "6-4 6-3")<br><br>\n    <strong>Tiebreaks:</strong> Auto-detected from digits (e.g., "67 3" becomes "6-7(3)")<br><br>\n    <strong>Match Tiebreaks:</strong> Use dash separator (e.g., "10-7")<br><br>\n    <strong>Irregular Endings:</strong><br>\n    <strong>r</strong> = Retired<br>\n    <strong>w</strong> = Walkover<br>\n    <strong>d</strong> = Defaulted<br>\n    <strong>s</strong> = Suspended<br>\n    <strong>c</strong> = Cancelled<br>\n    <strong>a</strong> = Awaiting Result<br>\n    <strong>in</strong> = In Progress<br>\n    <strong>inc</strong> = Incomplete<br>\n    <strong>dr</strong> = Dead Rubber\n  '}:void 0,buttons:[{onClick:()=>{u()},label:"Cancel",intent:"none",footer:{className:"button",style:"background-color: white; color: #363636; border: 1px solid #dbdbdb;"},close:!0},{id:"clearScoreV2",label:"Clear",intent:"none",disabled:!0,close:!1,onClick:()=>{if(s=!0,"freeScore"===i){const e=document.getElementById("scoreInputV2");e&&(e.value="",e.dispatchEvent(new Event("input",{bubbles:!0})),e.focus())}else"dynamicSets"===i&&window.resetDynamicSets?window.resetDynamicSets():"dialPad"===i&&window.resetDialPad&&window.resetDialPad()}},{id:"submitScoreV2",label:"Submit Score",intent:"is-primary",disabled:!0,onClick:()=>{o&&(o.isValid||s&&a)&&(u(),r(o))},close:!0}]}),setTimeout(()=>{const e=document.getElementById("clearScoreV2");e&&(e.style.backgroundColor="#ffeb3b",e.style.color="#333",a&&(e.disabled=!1),o&&c(o))},0)}var Oj=["input:not([inert]):not([inert] *)","select:not([inert]):not([inert] *)","textarea:not([inert]):not([inert] *)","a[href]:not([inert]):not([inert] *)","button:not([inert]):not([inert] *)","[tabindex]:not(slot):not([inert]):not([inert] *)","audio[controls]:not([inert]):not([inert] *)","video[controls]:not([inert]):not([inert] *)",'[contenteditable]:not([contenteditable="false"]):not([inert]):not([inert] *)',"details>summary:first-of-type:not([inert]):not([inert] *)","details:not([inert]):not([inert] *)"],Fj=Oj.join(","),_j=typeof Element>"u",Lj=_j?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Bj=!_j&&Element.prototype.getRootNode?function(e){var t;return null==e||null===(t=e.getRootNode)||void 0===t?void 0:t.call(e)}:function(e){return e?.ownerDocument},$j=function(e,t){var r;void 0===t&&(t=!0);var i=null==e||null===(r=e.getAttribute)||void 0===r?void 0:r.call(e,"inert");return""===i||"true"===i||t&&e&&("function"==typeof e.closest?e.closest("[inert]"):$j(e.parentNode))},Vj=function(e,t,r){if($j(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(Fj));return t&&Lj.call(e,Fj)&&i.unshift(e),i=i.filter(r)},jj=function(e,t,r){for(var i=[],n=Array.from(e);n.length;){var a=n.shift();if(!$j(a,!1))if("SLOT"===a.tagName){var o=a.assignedElements(),s=o.length?o:a.children,c=jj(s,!0,r);r.flatten?i.push.apply(i,c):i.push({scopeParent:a,candidates:c})}else{Lj.call(a,Fj)&&r.filter(a)&&(t||!e.includes(a))&&i.push(a);var u=a.shadowRoot||"function"==typeof r.getShadowRoot&&r.getShadowRoot(a),l=!$j(u,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(a));if(u&&l){var d=jj(!0===u?a.children:u.children,!0,r);r.flatten?i.push.apply(i,d):i.push({scopeParent:a,candidates:d})}else n.unshift.apply(n,a.children)}}return i},Gj=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Wj=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||function(e){var t,r=null==e||null===(t=e.getAttribute)||void 0===t?void 0:t.call(e,"contenteditable");return""===r||"true"===r}(e))&&!Gj(e)?0:e.tabIndex},qj=function(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex},Hj=function(e){return"INPUT"===e.tagName},zj=function(e){return function(e){return Hj(e)&&"radio"===e.type}(e)&&!function(e){if(!e.name)return!0;var t,r=e.form||Bj(e),i=function(e){return r.querySelectorAll('input[type="radio"][name="'+e+'"]')};if(typeof window<"u"&&typeof window.CSS<"u"&&"function"==typeof window.CSS.escape)t=i(window.CSS.escape(e.name));else try{t=i(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var n=function(e,t){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===t)return e[r]}(t,e.form);return!n||n===e}(e)},Yj=function(e){var t=e.getBoundingClientRect(),r=t.width,i=t.height;return 0===r&&0===i},Kj=function(e,t){var r=t.displayCheck,i=t.getShadowRoot;if("full-native"===r&&"checkVisibility"in e)return!e.checkVisibility({checkOpacity:!1,opacityProperty:!1,contentVisibilityAuto:!0,visibilityProperty:!0,checkVisibilityCSS:!0});if("hidden"===getComputedStyle(e).visibility)return!0;var n=Lj.call(e,"details>summary:first-of-type")?e.parentElement:e;if(Lj.call(n,"details:not([open]) *"))return!0;if(r&&"full"!==r&&"full-native"!==r&&"legacy-full"!==r){if("non-zero-area"===r)return Yj(e)}else{if("function"==typeof i){for(var a=e;e;){var o=e.parentElement,s=Bj(e);if(o&&!o.shadowRoot&&!0===i(o))return Yj(e);e=e.assignedSlot?e.assignedSlot:o||s===e.ownerDocument?o:s.host}e=a}if(function(e){var t,r,i,n,a=e&&Bj(e),o=null===(t=a)||void 0===t?void 0:t.host,s=!1;if(a&&a!==e)for(s=!!(null!==(r=o)&&void 0!==r&&null!==(i=r.ownerDocument)&&void 0!==i&&i.contains(o)||null!=e&&null!==(n=e.ownerDocument)&&void 0!==n&&n.contains(e));!s&&o;){var c,u,l;s=!(null===(u=o=null===(c=a=Bj(o))||void 0===c?void 0:c.host)||void 0===u||null===(l=u.ownerDocument)||void 0===l||!l.contains(o))}return s}(e))return!e.getClientRects().length;if("legacy-full"!==r)return!0}return!1},Xj=function(e,t){return!(t.disabled||function(e){return Hj(e)&&"hidden"===e.type}(t)||Kj(t,e)||function(e){return"DETAILS"===e.tagName&&Array.prototype.slice.apply(e.children).some(function(e){return"SUMMARY"===e.tagName})}(t)||function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var t=e.parentElement;t;){if("FIELDSET"===t.tagName&&t.disabled){for(var r=0;r<t.children.length;r++){var i=t.children.item(r);if("LEGEND"===i.tagName)return!!Lj.call(t,"fieldset[disabled] *")||!i.contains(e)}return!0}t=t.parentElement}return!1}(t))},Qj=function(e,t){return!(zj(t)||Wj(t)<0||!Xj(e,t))},Jj=function(e){var t=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(t)||t>=0)},Zj=function(e){var t=[],r=[];return e.forEach(function(e,i){var n=!!e.scopeParent,a=n?e.scopeParent:e,o=function(e,t){var r=Wj(e);return r<0&&t&&!Gj(e)?0:r}(a,n),s=n?Zj(e.candidates):a;0===o?n?t.push.apply(t,s):t.push(a):r.push({documentOrder:i,tabIndex:o,item:e,isScope:n,content:s})}),r.sort(qj).reduce(function(e,t){return t.isScope?e.push.apply(e,t.content):e.push(t.content),e},[]).concat(t)},eG=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return!1!==Lj.call(e,Fj)&&Qj(t,e)},tG=Oj.concat("iframe:not([inert]):not([inert] *)").join(","),rG=function(e,t){if(t=t||{},!e)throw new Error("No node provided");return!1!==Lj.call(e,tG)&&Xj(t,e)};function iG(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function nG(e,t,r,i,n,a,o){try{var s=e[a](o),c=s.value}catch(u){return void r(u)}s.done?t(c):Promise.resolve(c).then(i,n)}function aG(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var a=e.apply(t,r);function o(e){nG(a,i,n,o,s,"next",e)}function s(e){nG(a,i,n,o,s,"throw",e)}o(void 0)})}}function oG(e,t){var r=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=mG(e))||t){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function sG(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function uG(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cG(Object(r),!0).forEach(function(t){sG(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cG(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function lG(){var e,t,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",n=r.toStringTag||"@@toStringTag";function a(r,i,n,a){var c=i&&i.prototype instanceof s?i:s,u=Object.create(c.prototype);return dG(u,"_invoke",function(r,i,n){var a,s,c,u=0,l=n||[],d=!1,p={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,r){return a=t,s=0,c=e,p.n=r,o}};function m(r,i){for(s=r,c=i,t=0;!d&&u&&!n&&t<l.length;t++){var n,a=l[t],m=p.p,f=a[2];r>3?(n=f===i)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=m&&((n=r<2&&m<a[1])?(s=0,p.v=i,p.n=a[1]):m<f&&(n=r<3||a[0]>i||i>f)&&(a[4]=r,a[5]=i,p.n=f,s=0))}if(n||r>1)return o;throw d=!0,i}return function(n,l,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&m(l,f),s=l,c=f;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(p.n=-1),m(s,c)):p.n=c:p.v=c);try{if(u=2,a){if(s||(n="next"),t=a[n]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+n+"' method"),s=1);a=e}else if((t=(d=p.n<0)?c:r.call(i,p))!==o)break}catch(h){a=e,s=1,c=h}finally{u=1}}return{value:t,done:d}}}(r,n,a),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][i]?t(t([][i]())):(dG(t={},i,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,dG(e,n,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,dG(d,"constructor",u),dG(u,"constructor",c),c.displayName="GeneratorFunction",dG(u,n,"GeneratorFunction"),dG(d),dG(d,n,"Generator"),dG(d,i,function(){return this}),dG(d,"toString",function(){return"[object Generator]"}),(lG=function(){return{w:a,m:p}})()}function dG(e,t,r,i){var n=Object.defineProperty;try{n({},"",{})}catch{n=0}(dG=function(e,t,r,i){function a(t,r){dG(e,t,function(e){return this._invoke(t,r,e)})}t?n?n(e,t,{value:r,enumerable:!i,configurable:!i,writable:!i}):e[t]=r:(a("next",0),a("throw",1),a("return",2))})(e,t,r,i)}function pG(e){return function(e){if(Array.isArray(e))return iG(e)}(e)||function(e){if(typeof Symbol<"u"&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||mG(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mG(e,t){if(e){if("string"==typeof e)return iG(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?iG(e,t):void 0}}var fG={getActiveTrap:function(e){return e?.length>0?e[e.length-1]:null},activateTrap:function(e,t){t!==fG.getActiveTrap(e)&&fG.pauseTrap(e);var r=e.indexOf(t);-1===r||e.splice(r,1),e.push(t)},deactivateTrap:function(e,t){var r=e.indexOf(t);-1!==r&&e.splice(r,1),fG.unpauseTrap(e)},pauseTrap:function(e){var t=fG.getActiveTrap(e);t?._setPausedState(!0)},unpauseTrap:function(e){var t=fG.getActiveTrap(e);t&&!t._isManuallyPaused()&&t._setPausedState(!1)}},hG=function(e){return"Tab"===e?.key||9===e?.keyCode},gG=function(e){return hG(e)&&!e.shiftKey},IG=function(e){return hG(e)&&e.shiftKey},yG=function(e){return setTimeout(e,0)},vG=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];return"function"==typeof e?e.apply(void 0,r):e},SG=function(e){return e.target.shadowRoot&&"function"==typeof e.composedPath?e.composedPath()[0]:e.target},bG=[],UG=function(e,t){var r,i=document,n=bG,a=uG({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isolateSubtrees:!1,isKeyForward:gG,isKeyBackward:IG},t),o={containers:[],containerGroups:[],tabbableGroups:[],adjacentElements:new Set,alreadySilent:new Set,nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,manuallyPaused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},s=function(e,t,r){return e&&void 0!==e[t]?e[t]:a[r||t]},c=function(e,t){var r="function"==typeof t?.composedPath?t.composedPath():void 0;return o.containerGroups.findIndex(function(t){var i=t.container,n=t.tabbableNodes;return i.contains(e)||r?.includes(i)||n.find(function(t){return t===e})})},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.hasFallback,n=void 0!==r&&r,o=t.params,s=void 0===o?[]:o,c=a[e];if("function"==typeof c&&(c=c.apply(void 0,pG(s))),!0===c&&(c=void 0),!c){if(void 0===c||!1===c)return c;throw new Error("`".concat(e,"` was specified but was not a node, or did not return a node"))}var u=c;if("string"==typeof c){try{u=i.querySelector(c)}catch(l){throw new Error("`".concat(e,'` appears to be an invalid selector; error="').concat(l.message,'"'))}if(!u&&!n)throw new Error("`".concat(e,"` as selector refers to no known node"))}return u},l=function(){var e=u("initialFocus",{hasFallback:!0});if(!1===e)return!1;if(void 0===e||e&&!rG(e,a.tabbableOptions))if(c(i.activeElement)>=0)e=i.activeElement;else{var t=o.tabbableGroups[0];e=t&&t.firstTabbableNode||u("fallbackFocus")}else null===e&&(e=u("fallbackFocus"));if(!e)throw new Error("Your focus-trap needs to have at least one focusable element");return e},d=function(){if(o.containerGroups=o.containers.map(function(e){var t=function(e,t){var r;return r=(t=t||{}).getShadowRoot?jj([e],t.includeContainer,{filter:Qj.bind(null,t),flatten:!1,getShadowRoot:t.getShadowRoot,shadowRootFilter:Jj}):Vj(e,t.includeContainer,Qj.bind(null,t)),Zj(r)}(e,a.tabbableOptions),r=function(e,t){return(t=t||{}).getShadowRoot?jj([e],t.includeContainer,{filter:Xj.bind(null,t),flatten:!0,getShadowRoot:t.getShadowRoot}):Vj(e,t.includeContainer,Xj.bind(null,t))}(e,a.tabbableOptions),i=t.length>0?t[0]:void 0,n=t.length>0?t[t.length-1]:void 0,o=r.find(function(e){return eG(e)}),s=r.slice().reverse().find(function(e){return eG(e)}),c=!!t.find(function(e){return Wj(e)>0});return{container:e,tabbableNodes:t,focusableNodes:r,posTabIndexesFound:c,firstTabbableNode:i,lastTabbableNode:n,firstDomTabbableNode:o,lastDomTabbableNode:s,nextTabbableNode:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t.indexOf(e);return n<0?i?r.slice(r.indexOf(e)+1).find(function(e){return eG(e)}):r.slice(0,r.indexOf(e)).reverse().find(function(e){return eG(e)}):t[n+(i?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function(e){return e.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function(e){return e.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},p=function(e){var t=e.activeElement;if(t)return t.shadowRoot&&null!==t.shadowRoot.activeElement?p(t.shadowRoot):t},m=function(e){if(!1!==e&&e!==p(document)){if(!e||!e.focus)return void m(l());e.focus({preventScroll:!!a.preventScroll}),o.mostRecentlyFocusedNode=e,function(e){return e.tagName&&"input"===e.tagName.toLowerCase()&&"function"==typeof e.select}(e)&&e.select()}},f=function(e){var t=u("setReturnFocus",{params:[e]});return t||!1!==t&&e},h=function(e){var t=e.target,r=e.event,i=e.isBackward,n=void 0!==i&&i;t=t||SG(r),d();var s=null;if(o.tabbableGroups.length>0){var l=c(t,r),p=l>=0?o.containerGroups[l]:void 0;if(l<0)s=n?o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:o.tabbableGroups[0].firstTabbableNode;else if(n){var m=o.tabbableGroups.findIndex(function(e){var r=e.firstTabbableNode;return t===r});if(m<0&&(p.container===t||rG(t,a.tabbableOptions)&&!eG(t,a.tabbableOptions)&&!p.nextTabbableNode(t,!1))&&(m=l),m>=0){var f=0===m?o.tabbableGroups.length-1:m-1,h=o.tabbableGroups[f];s=Wj(t)>=0?h.lastTabbableNode:h.lastDomTabbableNode}else hG(r)||(s=p.nextTabbableNode(t,!1))}else{var g=o.tabbableGroups.findIndex(function(e){var r=e.lastTabbableNode;return t===r});if(g<0&&(p.container===t||rG(t,a.tabbableOptions)&&!eG(t,a.tabbableOptions)&&!p.nextTabbableNode(t))&&(g=l),g>=0){var I=g===o.tabbableGroups.length-1?0:g+1,y=o.tabbableGroups[I];s=Wj(t)>=0?y.firstTabbableNode:y.firstDomTabbableNode}else hG(r)||(s=p.nextTabbableNode(t))}}else s=u("fallbackFocus");return s},g=function(e){var t=SG(e);if(!(c(t,e)>=0)){if(vG(a.clickOutsideDeactivates,e))return void r.deactivate({returnFocus:a.returnFocusOnDeactivate});vG(a.allowOutsideClick,e)||e.preventDefault()}},I=function(e){var t=SG(e),r=c(t,e)>=0;if(r||t instanceof Document)r&&(o.mostRecentlyFocusedNode=t);else{e.stopImmediatePropagation();var i,n=!0;if(o.mostRecentlyFocusedNode)if(Wj(o.mostRecentlyFocusedNode)>0){var s=c(o.mostRecentlyFocusedNode),u=o.containerGroups[s].tabbableNodes;if(u.length>0){var d=u.findIndex(function(e){return e===o.mostRecentlyFocusedNode});d>=0&&(a.isKeyForward(o.recentNavEvent)?d+1<u.length&&(i=u[d+1],n=!1):d-1>=0&&(i=u[d-1],n=!1))}}else o.containerGroups.some(function(e){return e.tabbableNodes.some(function(e){return Wj(e)>0})})||(n=!1);else n=!1;n&&(i=h({target:o.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(o.recentNavEvent)})),m(i||o.mostRecentlyFocusedNode||l())}o.recentNavEvent=void 0},y=function(e){(a.isKeyForward(e)||a.isKeyBackward(e))&&function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];o.recentNavEvent=e;var r=h({event:e,isBackward:t});r&&(hG(e)&&e.preventDefault(),m(r))}(e,a.isKeyBackward(e))},v=function(e){(function(e){return"Escape"===e?.key||"Esc"===e?.key||27===e?.keyCode})(e)&&!1!==vG(a.escapeDeactivates,e)&&(e.preventDefault(),r.deactivate())},S=function(e){var t=SG(e);c(t,e)>=0||vG(a.clickOutsideDeactivates,e)||vG(a.allowOutsideClick,e)||(e.preventDefault(),e.stopImmediatePropagation())},b=function(){return o.active?(fG.activateTrap(n,r),a.delayInitialFocus?e=new Promise(function(e){o.delayInitialFocusTimer=yG(function(){m(l()),e()})}):(e=Promise.resolve(),m(l())),i.addEventListener("focusin",I,!0),i.addEventListener("mousedown",g,{capture:!0,passive:!1}),i.addEventListener("touchstart",g,{capture:!0,passive:!1}),i.addEventListener("click",S,{capture:!0,passive:!1}),i.addEventListener("keydown",y,{capture:!0,passive:!1}),i.addEventListener("keydown",v),e):Promise.resolve();var e},U=function(){if(o.active)return i.removeEventListener("focusin",I,!0),i.removeEventListener("mousedown",g,!0),i.removeEventListener("touchstart",g,!0),i.removeEventListener("click",S,!0),i.removeEventListener("keydown",y,!0),i.removeEventListener("keydown",v),r},w=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(function(e){e.some(function(e){return Array.from(e.removedNodes).some(function(e){return e===o.mostRecentlyFocusedNode})})&&m(l())}):void 0,T=function(){w&&(w.disconnect(),o.active&&!o.paused&&o.containers.map(function(e){w.observe(e,{subtree:!0,childList:!0})}))};return r={get active(){return o.active},get paused(){return o.paused},activate:function(e){if(o.active)return this;var t,a=s(e,"onActivate"),c=s(e,"onPostActivate"),u=s(e,"checkCanFocusTrap"),l=fG.getActiveTrap(n),m=!1;l&&!l.paused&&(null===(t=l._setSubtreeIsolation)||void 0===t||t.call(l,!1),m=!0);try{u||d(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=p(i),a?.();var f=function(){var e=aG(lG().m(function e(){return lG().w(function(e){for(;;)switch(e.n){case 0:return u&&d(),e.n=1,b();case 1:r._setSubtreeIsolation(!0),T(),c?.();case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();if(u)return u(o.containers.concat()).then(f,f),this;f()}catch(g){var h;if(l===fG.getActiveTrap(n)&&m)null===(h=l._setSubtreeIsolation)||void 0===h||h.call(l,!0);throw g}return this},deactivate:function(e){if(!o.active)return this;var t=uG({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},e);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,o.paused||r._setSubtreeIsolation(!1),o.alreadySilent.clear(),U(),o.active=!1,o.paused=!1,T(),fG.deactivateTrap(n,r);var i=s(t,"onDeactivate"),c=s(t,"onPostDeactivate"),u=s(t,"checkCanReturnFocus"),l=s(t,"returnFocus","returnFocusOnDeactivate");i?.();var d=function(){yG(function(){l&&m(f(o.nodeFocusedBeforeActivation)),c?.()})};return l&&u?(u(f(o.nodeFocusedBeforeActivation)).then(d,d),this):(d(),this)},pause:function(e){return o.active?(o.manuallyPaused=!0,this._setPausedState(!0,e)):this},unpause:function(e){return o.active?(o.manuallyPaused=!1,n[n.length-1]!==this?this:this._setPausedState(!1,e)):this},updateContainerElements:function(e){var t=[].concat(e).filter(Boolean);return o.containers=t.map(function(e){return"string"==typeof e?i.querySelector(e):e}),a.isolateSubtrees&&function(e){o.active&&!o.paused&&r._setSubtreeIsolation(!1),o.adjacentElements.clear(),o.alreadySilent.clear();var t,i=new Set,n=new Set,a=oG(e);try{for(a.s();!(t=a.n()).done;){var s=t.value;i.add(s);for(var c=typeof ShadowRoot<"u"&&s.getRootNode()instanceof ShadowRoot,u=s;u;){i.add(u);var l=u.parentElement,d=[];l?d=l.children:!l&&c&&(d=u.getRootNode().children,l=u.getRootNode().host,c=typeof ShadowRoot<"u"&&l.getRootNode()instanceof ShadowRoot);var p,m=oG(d);try{for(m.s();!(p=m.n()).done;){var f=p.value;n.add(f)}}catch(h){m.e(h)}finally{m.f()}u=l}}}catch(h){a.e(h)}finally{a.f()}i.forEach(function(e){n.delete(e)}),o.adjacentElements=n}(o.containers),o.active&&(d(),o.paused||r._setSubtreeIsolation(!0)),T(),this}},Object.defineProperties(r,{_isManuallyPaused:{value:function(){return o.manuallyPaused}},_setPausedState:{value:function(e,t){if(o.paused===e)return this;if(o.paused=e,e){var i=s(t,"onPause"),n=s(t,"onPostPause");i?.(),U(),r._setSubtreeIsolation(!1),T(),n?.()}else{var a=s(t,"onUnpause"),c=s(t,"onPostUnpause");a?.();var u=function(){var e=aG(lG().m(function e(){return lG().w(function(e){for(;;)switch(e.n){case 0:return d(),e.n=1,b();case 1:r._setSubtreeIsolation(!0),T(),c?.();case 2:return e.a(2)}},e)}));return function(){return e.apply(this,arguments)}}();u()}return this}},_setSubtreeIsolation:{value:function(e){a.isolateSubtrees&&o.adjacentElements.forEach(function(t){var r;e?"aria-hidden"===a.isolateSubtrees?(("true"===t.ariaHidden||"true"===(null===(r=t.getAttribute("aria-hidden"))||void 0===r?void 0:r.toLowerCase()))&&o.alreadySilent.add(t),t.setAttribute("aria-hidden","true")):((t.inert||t.hasAttribute("inert"))&&o.alreadySilent.add(t),t.setAttribute("inert",!0)):o.alreadySilent.has(t)||("aria-hidden"===a.isolateSubtrees?t.removeAttribute("aria-hidden"):t.removeAttribute("inert"))})}}}),r.updateContainerElements(e),r};const wG="courthive-drawer",TG=e=>"function"==typeof e,DG=e=>{for(;e.firstChild;)e.firstChild.remove()};let PG=null,NG=!1;const EG=(e=wG)=>{if(PG)return PG;const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},r={};let i,n,a,o=!1,s=!1;const c=()=>{TG(n)&&(n?.(),n=void 0);const r=document.getElementById(e);r&&(r.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){i?(r.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",TG(i?.callback)&&i.callback()):(r.classList.remove(t.activeClass),o=!1),i=!1,a?.deactivate()},t.speedClose))},u=t=>{const r=document.getElementById(e)?.querySelector(".drawer__title");r&&(r.innerHTML=t)},l=t=>{const i=document.getElementById(e)?.querySelector(".drawer__footer");i&&(DG(i),TG(t)?r.footer=t(i,c):i.innerHTML=t||"")},d=t=>{const i=document.getElementById(e)?.querySelector(".drawer__content");i&&(DG(i),TG(t)?r.content=t(i,c):i.innerHTML=t)},p=(e,r,i)=>{o=!0,s=!0,e.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",r&&(a=UG(e),a.activate()),TG(i)&&i&&i(),setTimeout(function(){e.classList.add(t.visibleClass),setTimeout(()=>{s=!1},100)},t.speedOpen)};return NG||(document.addEventListener("click",function(t){if(!e||!o||s)return;const r=t.target,i=document.querySelector(".drawer__wrapper");if(!i)return;const n=r.classList.contains("drawer__close")||r.closest(".drawer__close")||"drawerClose"in r.dataset||r.closest("[data-drawer-close]");(!function(e,t){let r=t.parentNode;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}(i,r)||n)&&c()},!1),document.addEventListener("keydown",e=>{"Escape"===e.key&&o&&c()},!1),NG=!0),PG={settings:t,open:(r={})=>{const{title:a,content:s,side:c,width:m,footer:f,callback:h,onClose:g}=r;if(s&&d(s),g&&(e=>{n=e})(g),a&&u(a),m&&(t=>{const r=document.getElementById(e)?.querySelector(".drawer__wrapper");r&&(r.style.width=t)})(m),l(f),o)i={callback:h};else if(c){if("right"===c)return(r=>{const i=document.getElementById(e);i&&(i.classList.remove(t.leftAlignment),p(i,!1,r))})(h);if("left"===c)return(r=>{if(!e)return;const i=document.getElementById(e);i&&(i.classList.contains(t.leftAlignment)||i.classList.add(t.leftAlignment),p(i,!1,r))})(h)}else{const t=document.getElementById(e);t&&p(t,f,h)}},close:c,setTitle:u,setContent:d,setFooter:l,attributes:r},PG};function MG(e=wG){if(document.getElementById(e))return;const t=`\n    <div id="${e}" class="drawer" aria-hidden="true">\n      <div class="drawer__overlay" tabindex="-1" data-drawer-close></div>\n      <div class="drawer__wrapper" role="dialog" aria-modal="true">\n        <div class="drawer__header">\n          <div class="drawer__title"></div>\n          <button class="drawer__close" aria-label="Close drawer" data-drawer-close>\n            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <line x1="18" y1="6" x2="6" y2="18"></line>\n              <line x1="6" y1="6" x2="18" y2="18"></line>\n            </svg>\n          </button>\n        </div>\n        <div class="drawer__content"></div>\n        <div class="drawer__footer"></div>\n      </div>\n    </div>\n  `;document.body.insertAdjacentHTML("beforeend",t)}function RG(e,t,r){if(!e)return{};const i=document.createElement("aside");i.classList.add("menu");const n={};let a=0;const o=e=>e?.heading||e?.text||e?.label||`Item ${a+=1,a}`,s=e=>{const t=document.createElement("li");if(t.className="font-medium",e.style&&(t.style.cssText=e.style),e.onClick){const i=e.fontSize||"1em";if(e.divider){const e=document.createElement("hr");e.classList.add("dropdown-divider"),t.appendChild(e)}else{const n=document.createElement("a"),a=e.disabled?"0.4":"1";n.style.cssText=`text-decoration: none; opacity: ${a}; font-size: ${i}`,e.class&&n.classList.add(e.class),e.color&&(n.style.color=e.color),e.heading&&(n.style.fontWeight="bold"),e.disabled||(n.onclick=(e=>r&&!1!==e.close?t=>{t.stopPropagation(),r(),e.onClick()}:t=>{t.stopPropagation(),e.onClick()})(e)),n.innerHTML=o(e),t.appendChild(n)}}else t.innerHTML=o(e),e.disabled||(t.onclick=e.onClick);return t};let c;for(const u of t||[])if(!u.hide)if(u.items){if(u.text){const e=document.createElement("p");e.className="menu-label font-medium",e.innerHTML=u.text,i.appendChild(e)}const e=document.createElement("ul");e.className="menu-list";for(const t of u.items)t.hide||e.appendChild(s(t));i.appendChild(e)}else if("input"===u.type){const{field:e,inputElement:t}=Cr(u);u.focus&&(c=t),n[u.field]=t,i.appendChild(e)}else if("divider"===u.type){const e=document.createElement("hr");e.classList.add("dropdown-divider"),i.appendChild(e)}return e.appendChild(i),{focusElement:c}}var AG="top",CG="bottom",kG="right",xG="left",OG="auto",FG=[AG,CG,kG,xG],_G="start",LG="end",BG="viewport",$G="popper",VG=FG.reduce(function(e,t){return e.concat([t+"-"+_G,t+"-"+LG])},[]),jG=[].concat(FG,[OG]).reduce(function(e,t){return e.concat([t,t+"-"+_G,t+"-"+LG])},[]),GG=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function WG(e){return e?(e.nodeName||"").toLowerCase():null}function qG(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function HG(e){return e instanceof qG(e).Element||e instanceof Element}function zG(e){return e instanceof qG(e).HTMLElement||e instanceof HTMLElement}function YG(e){return!(typeof ShadowRoot>"u")&&(e instanceof qG(e).ShadowRoot||e instanceof ShadowRoot)}const KG={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach(function(e){var r=t.styles[e]||{},i=t.attributes[e]||{},n=t.elements[e];!zG(n)||!WG(n)||(Object.assign(n.style,r),Object.keys(i).forEach(function(e){var t=i[e];!1===t?n.removeAttribute(e):n.setAttribute(e,!0===t?"":t)}))})},effect:function(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach(function(e){var i=t.elements[e],n=t.attributes[e]||{},a=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:r[e]).reduce(function(e,t){return e[t]="",e},{});!zG(i)||!WG(i)||(Object.assign(i.style,a),Object.keys(n).forEach(function(e){i.removeAttribute(e)}))})}},requires:["computeStyles"]};function XG(e){return e.split("-")[0]}var QG=Math.max,JG=Math.min,ZG=Math.round;function eW(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function tW(){return!/^((?!chrome|android).)*safari/i.test(eW())}function rW(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var i=e.getBoundingClientRect(),n=1,a=1;t&&zG(e)&&(n=e.offsetWidth>0&&ZG(i.width)/e.offsetWidth||1,a=e.offsetHeight>0&&ZG(i.height)/e.offsetHeight||1);var o=(HG(e)?qG(e):window).visualViewport,s=!tW()&&r,c=(i.left+(s&&o?o.offsetLeft:0))/n,u=(i.top+(s&&o?o.offsetTop:0))/a,l=i.width/n,d=i.height/a;return{width:l,height:d,top:u,right:c+l,bottom:u+d,left:c,x:c,y:u}}function iW(e){var t=rW(e),r=e.offsetWidth,i=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-i)<=1&&(i=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:i}}function nW(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&YG(r)){var i=t;do{if(i&&e.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function aW(e){return qG(e).getComputedStyle(e)}function oW(e){return["table","td","th"].indexOf(WG(e))>=0}function sW(e){return((HG(e)?e.ownerDocument:e.document)||window.document).documentElement}function cW(e){return"html"===WG(e)?e:e.assignedSlot||e.parentNode||(YG(e)?e.host:null)||sW(e)}function uW(e){return zG(e)&&"fixed"!==aW(e).position?e.offsetParent:null}function lW(e){for(var t=qG(e),r=uW(e);r&&oW(r)&&"static"===aW(r).position;)r=uW(r);return r&&("html"===WG(r)||"body"===WG(r)&&"static"===aW(r).position)?t:r||function(e){var t=/firefox/i.test(eW());if(/Trident/i.test(eW())&&zG(e)&&"fixed"===aW(e).position)return null;var r=cW(e);for(YG(r)&&(r=r.host);zG(r)&&["html","body"].indexOf(WG(r))<0;){var i=aW(r);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return r;r=r.parentNode}return null}(e)||t}function dW(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function pW(e,t,r){return QG(e,JG(t,r))}function mW(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function fW(e,t){return t.reduce(function(t,r){return t[r]=e,t},{})}const hW={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,r=e.state,i=e.name,n=e.options,a=r.elements.arrow,o=r.modifiersData.popperOffsets,s=XG(r.placement),c=dW(s),u=[xG,kG].indexOf(s)>=0?"height":"width";if(a&&o){var l=function(e,t){return mW("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:fW(e,FG))}(n.padding,r),d=iW(a),p="y"===c?AG:xG,m="y"===c?CG:kG,f=r.rects.reference[u]+r.rects.reference[c]-o[c]-r.rects.popper[u],h=o[c]-r.rects.reference[c],g=lW(a),I=g?"y"===c?g.clientHeight||0:g.clientWidth||0:0,y=f/2-h/2,v=l[p],S=I-d[u]-l[m],b=I/2-d[u]/2+y,U=pW(v,b,S),w=c;r.modifiersData[i]=((t={})[w]=U,t.centerOffset=U-b,t)}},effect:function(e){var t=e.state,r=e.options.element,i=void 0===r?"[data-popper-arrow]":r;null!=i&&("string"==typeof i&&!(i=t.elements.popper.querySelector(i))||nW(t.elements.popper,i)&&(t.elements.arrow=i))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function gW(e){return e.split("-")[1]}var IW={top:"auto",right:"auto",bottom:"auto",left:"auto"};function yW(e){var t,r=e.popper,i=e.popperRect,n=e.placement,a=e.variation,o=e.offsets,s=e.position,c=e.gpuAcceleration,u=e.adaptive,l=e.roundOffsets,d=e.isFixed,p=o.x,m=void 0===p?0:p,f=o.y,h=void 0===f?0:f,g="function"==typeof l?l({x:m,y:h}):{x:m,y:h};m=g.x,h=g.y;var I=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),v=xG,S=AG,b=window;if(u){var U=lW(r),w="clientHeight",T="clientWidth";if(U===qG(r)&&("static"!==aW(U=sW(r)).position&&"absolute"===s&&(w="scrollHeight",T="scrollWidth")),n===AG||(n===xG||n===kG)&&a===LG)S=CG,h-=(d&&U===b&&b.visualViewport?b.visualViewport.height:U[w])-i.height,h*=c?1:-1;if(n===xG||(n===AG||n===CG)&&a===LG)v=kG,m-=(d&&U===b&&b.visualViewport?b.visualViewport.width:U[T])-i.width,m*=c?1:-1}var D,P=Object.assign({position:s},u&&IW),N=!0===l?function(e,t){var r=e.x,i=e.y,n=t.devicePixelRatio||1;return{x:ZG(r*n)/n||0,y:ZG(i*n)/n||0}}({x:m,y:h},qG(r)):{x:m,y:h};return m=N.x,h=N.y,c?Object.assign({},P,((D={})[S]=y?"0":"",D[v]=I?"0":"",D.transform=(b.devicePixelRatio||1)<=1?"translate("+m+"px, "+h+"px)":"translate3d("+m+"px, "+h+"px, 0)",D)):Object.assign({},P,((t={})[S]=y?h+"px":"",t[v]=I?m+"px":"",t.transform="",t))}const vW={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,r=e.options,i=r.gpuAcceleration,n=void 0===i||i,a=r.adaptive,o=void 0===a||a,s=r.roundOffsets,c=void 0===s||s,u={placement:XG(t.placement),variation:gW(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,yW(Object.assign({},u,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,yW(Object.assign({},u,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var SW={passive:!0};const bW={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,r=e.instance,i=e.options,n=i.scroll,a=void 0===n||n,o=i.resize,s=void 0===o||o,c=qG(t.elements.popper),u=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&u.forEach(function(e){e.addEventListener("scroll",r.update,SW)}),s&&c.addEventListener("resize",r.update,SW),function(){a&&u.forEach(function(e){e.removeEventListener("scroll",r.update,SW)}),s&&c.removeEventListener("resize",r.update,SW)}},data:{}};var UW={left:"right",right:"left",bottom:"top",top:"bottom"};function wW(e){return e.replace(/left|right|bottom|top/g,function(e){return UW[e]})}var TW={start:"end",end:"start"};function DW(e){return e.replace(/start|end/g,function(e){return TW[e]})}function PW(e){var t=qG(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function NW(e){return rW(sW(e)).left+PW(e).scrollLeft}function EW(e){var t=aW(e),r=t.overflow,i=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+n+i)}function MW(e){return["html","body","#document"].indexOf(WG(e))>=0?e.ownerDocument.body:zG(e)&&EW(e)?e:MW(cW(e))}function RW(e,t){var r;void 0===t&&(t=[]);var i=MW(e),n=i===(null==(r=e.ownerDocument)?void 0:r.body),a=qG(i),o=n?[a].concat(a.visualViewport||[],EW(i)?i:[]):i,s=t.concat(o);return n?s:s.concat(RW(cW(o)))}function AW(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function CW(e,t,r){return t===BG?AW(function(e,t){var r=qG(e),i=sW(e),n=r.visualViewport,a=i.clientWidth,o=i.clientHeight,s=0,c=0;if(n){a=n.width,o=n.height;var u=tW();(u||!u&&"fixed"===t)&&(s=n.offsetLeft,c=n.offsetTop)}return{width:a,height:o,x:s+NW(e),y:c}}(e,r)):HG(t)?function(e,t){var r=rW(e,!1,"fixed"===t);return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}(t,r):AW(function(e){var t,r=sW(e),i=PW(e),n=null==(t=e.ownerDocument)?void 0:t.body,a=QG(r.scrollWidth,r.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=QG(r.scrollHeight,r.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),s=-i.scrollLeft+NW(e),c=-i.scrollTop;return"rtl"===aW(n||r).direction&&(s+=QG(r.clientWidth,n?n.clientWidth:0)-a),{width:a,height:o,x:s,y:c}}(sW(e)))}function kW(e,t,r,i){var n="clippingParents"===t?function(e){var t=RW(cW(e)),r=["absolute","fixed"].indexOf(aW(e).position)>=0&&zG(e)?lW(e):e;return HG(r)?t.filter(function(e){return HG(e)&&nW(e,r)&&"body"!==WG(e)}):[]}(e):[].concat(t),a=[].concat(n,[r]),o=a[0],s=a.reduce(function(t,r){var n=CW(e,r,i);return t.top=QG(n.top,t.top),t.right=JG(n.right,t.right),t.bottom=JG(n.bottom,t.bottom),t.left=QG(n.left,t.left),t},CW(e,o,i));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function xW(e){var t,r=e.reference,i=e.element,n=e.placement,a=n?XG(n):null,o=n?gW(n):null,s=r.x+r.width/2-i.width/2,c=r.y+r.height/2-i.height/2;switch(a){case AG:t={x:s,y:r.y-i.height};break;case CG:t={x:s,y:r.y+r.height};break;case kG:t={x:r.x+r.width,y:c};break;case xG:t={x:r.x-i.width,y:c};break;default:t={x:r.x,y:r.y}}var u=a?dW(a):null;if(null!=u){var l="y"===u?"height":"width";switch(o){case _G:t[u]=t[u]-(r[l]/2-i[l]/2);break;case LG:t[u]=t[u]+(r[l]/2-i[l]/2)}}return t}function OW(e,t){void 0===t&&(t={});var r=t,i=r.placement,n=void 0===i?e.placement:i,a=r.strategy,o=void 0===a?e.strategy:a,s=r.boundary,c=void 0===s?"clippingParents":s,u=r.rootBoundary,l=void 0===u?BG:u,d=r.elementContext,p=void 0===d?$G:d,m=r.altBoundary,f=void 0!==m&&m,h=r.padding,g=void 0===h?0:h,I=mW("number"!=typeof g?g:fW(g,FG)),y=p===$G?"reference":$G,v=e.rects.popper,S=e.elements[f?y:p],b=kW(HG(S)?S:S.contextElement||sW(e.elements.popper),c,l,o),U=rW(e.elements.reference),w=xW({reference:U,element:v,placement:n}),T=AW(Object.assign({},v,w)),D=p===$G?T:U,P={top:b.top-D.top+I.top,bottom:D.bottom-b.bottom+I.bottom,left:b.left-D.left+I.left,right:D.right-b.right+I.right},N=e.modifiersData.offset;if(p===$G&&N){var E=N[n];Object.keys(P).forEach(function(e){var t=[kG,CG].indexOf(e)>=0?1:-1,r=[AG,CG].indexOf(e)>=0?"y":"x";P[e]+=E[r]*t})}return P}const FW={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,i=e.name;if(!t.modifiersData[i]._skip){for(var n=r.mainAxis,a=void 0===n||n,o=r.altAxis,s=void 0===o||o,c=r.fallbackPlacements,u=r.padding,l=r.boundary,d=r.rootBoundary,p=r.altBoundary,m=r.flipVariations,f=void 0===m||m,h=r.allowedAutoPlacements,g=t.options.placement,I=XG(g),y=c||(I===g||!f?[wW(g)]:function(e){if(XG(e)===OG)return[];var t=wW(e);return[DW(e),t,DW(t)]}(g)),v=[g].concat(y).reduce(function(e,r){return e.concat(XG(r)===OG?function(e,t){void 0===t&&(t={});var r=t,i=r.placement,n=r.boundary,a=r.rootBoundary,o=r.padding,s=r.flipVariations,c=r.allowedAutoPlacements,u=void 0===c?jG:c,l=gW(i),d=l?s?VG:VG.filter(function(e){return gW(e)===l}):FG,p=d.filter(function(e){return u.indexOf(e)>=0});0===p.length&&(p=d);var m=p.reduce(function(t,r){return t[r]=OW(e,{placement:r,boundary:n,rootBoundary:a,padding:o})[XG(r)],t},{});return Object.keys(m).sort(function(e,t){return m[e]-m[t]})}(t,{placement:r,boundary:l,rootBoundary:d,padding:u,flipVariations:f,allowedAutoPlacements:h}):r)},[]),S=t.rects.reference,b=t.rects.popper,U=new Map,w=!0,T=v[0],D=0;D<v.length;D++){var P=v[D],N=XG(P),E=gW(P)===_G,M=[AG,CG].indexOf(N)>=0,R=M?"width":"height",A=OW(t,{placement:P,boundary:l,rootBoundary:d,altBoundary:p,padding:u}),C=M?E?kG:xG:E?CG:AG;S[R]>b[R]&&(C=wW(C));var k=wW(C),x=[];if(a&&x.push(A[N]<=0),s&&x.push(A[C]<=0,A[k]<=0),x.every(function(e){return e})){T=P,w=!1;break}U.set(P,x)}if(w)for(var O=function(e){var t=v.find(function(t){var r=U.get(t);if(r)return r.slice(0,e).every(function(e){return e})});if(t)return T=t,"break"},F=f?3:1;F>0;F--){if("break"===O(F))break}t.placement!==T&&(t.modifiersData[i]._skip=!0,t.placement=T,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function _W(e,t,r){return void 0===r&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function LW(e){return[AG,kG,CG,xG].some(function(t){return e[t]>=0})}const BW={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,r=e.name,i=t.rects.reference,n=t.rects.popper,a=t.modifiersData.preventOverflow,o=OW(t,{elementContext:"reference"}),s=OW(t,{altBoundary:!0}),c=_W(o,i),u=_W(s,n,a),l=LW(c),d=LW(u);t.modifiersData[r]={referenceClippingOffsets:c,popperEscapeOffsets:u,isReferenceHidden:l,hasPopperEscaped:d},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":d})}};const $W={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,r=e.options,i=e.name,n=r.offset,a=void 0===n?[0,0]:n,o=jG.reduce(function(e,r){return e[r]=function(e,t,r){var i=XG(e),n=[xG,AG].indexOf(i)>=0?-1:1,a="function"==typeof r?r(Object.assign({},t,{placement:e})):r,o=a[0],s=a[1];return o=o||0,s=(s||0)*n,[xG,kG].indexOf(i)>=0?{x:s,y:o}:{x:o,y:s}}(r,t.rects,a),e},{}),s=o[t.placement],c=s.x,u=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=u),t.modifiersData[i]=o}};const VW={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,r=e.name;t.modifiersData[r]=xW({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})},data:{}};const jW={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,r=e.options,i=e.name,n=r.mainAxis,a=void 0===n||n,o=r.altAxis,s=void 0!==o&&o,c=r.boundary,u=r.rootBoundary,l=r.altBoundary,d=r.padding,p=r.tether,m=void 0===p||p,f=r.tetherOffset,h=void 0===f?0:f,g=OW(t,{boundary:c,rootBoundary:u,padding:d,altBoundary:l}),I=XG(t.placement),y=gW(t.placement),v=!y,S=dW(I),b=function(e){return"x"===e?"y":"x"}(S),U=t.modifiersData.popperOffsets,w=t.rects.reference,T=t.rects.popper,D="function"==typeof h?h(Object.assign({},t.rects,{placement:t.placement})):h,P="number"==typeof D?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),N=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,E={x:0,y:0};if(U){if(a){var M,R="y"===S?AG:xG,A="y"===S?CG:kG,C="y"===S?"height":"width",k=U[S],x=k+g[R],O=k-g[A],F=m?-T[C]/2:0,_=y===_G?w[C]:T[C],L=y===_G?-T[C]:-w[C],B=t.elements.arrow,$=m&&B?iW(B):{width:0,height:0},V=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},j=V[R],G=V[A],W=pW(0,w[C],$[C]),q=v?w[C]/2-F-W-j-P.mainAxis:_-W-j-P.mainAxis,H=v?-w[C]/2+F+W+G+P.mainAxis:L+W+G+P.mainAxis,z=t.elements.arrow&&lW(t.elements.arrow),Y=z?"y"===S?z.clientTop||0:z.clientLeft||0:0,K=null!=(M=N?.[S])?M:0,X=k+H-K,Q=pW(m?JG(x,k+q-K-Y):x,k,m?QG(O,X):O);U[S]=Q,E[S]=Q-k}if(s){var J,Z="x"===S?AG:xG,ee="x"===S?CG:kG,te=U[b],re="y"===b?"height":"width",ie=te+g[Z],ne=te-g[ee],ae=-1!==[AG,xG].indexOf(I),oe=null!=(J=N?.[b])?J:0,se=ae?ie:te-w[re]-T[re]-oe+P.altAxis,ce=ae?te+w[re]+T[re]-oe-P.altAxis:ne,ue=m&&ae?function(e,t,r){var i=pW(e,t,r);return i>r?r:i}(se,te,ce):pW(m?se:ie,te,m?ce:ne);U[b]=ue,E[b]=ue-te}t.modifiersData[i]=E}},requiresIfExists:["offset"]};function GW(e,t,r){void 0===r&&(r=!1);var i=zG(t),n=zG(t)&&function(e){var t=e.getBoundingClientRect(),r=ZG(t.width)/e.offsetWidth||1,i=ZG(t.height)/e.offsetHeight||1;return 1!==r||1!==i}(t),a=sW(t),o=rW(e,n,r),s={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(i||!i&&!r)&&(("body"!==WG(t)||EW(a))&&(s=function(e){return e!==qG(e)&&zG(e)?function(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}(e):PW(e)}(t)),zG(t)?((c=rW(t,!0)).x+=t.clientLeft,c.y+=t.clientTop):a&&(c.x=NW(a))),{x:o.left+s.scrollLeft-c.x,y:o.top+s.scrollTop-c.y,width:o.width,height:o.height}}function WW(e){var t=new Map,r=new Set,i=[];function n(e){r.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach(function(e){if(!r.has(e)){var i=t.get(e);i&&n(i)}}),i.push(e)}return e.forEach(function(e){t.set(e.name,e)}),e.forEach(function(e){r.has(e.name)||n(e)}),i}function qW(e){var t;return function(){return t||(t=new Promise(function(r){Promise.resolve().then(function(){t=void 0,r(e())})})),t}}var HW={placement:"bottom",modifiers:[],strategy:"absolute"};function zW(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(e){return!(e&&"function"==typeof e.getBoundingClientRect)})}function YW(e){void 0===e&&(e={});var t=e,r=t.defaultModifiers,i=void 0===r?[]:r,n=t.defaultOptions,a=void 0===n?HW:n;return function(e,t,r){void 0===r&&(r=a);var n={placement:"bottom",orderedModifiers:[],options:Object.assign({},HW,a),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},o=[],s=!1,c={state:n,setOptions:function(r){var s="function"==typeof r?r(n.options):r;u(),n.options=Object.assign({},a,n.options,s),n.scrollParents={reference:HG(e)?RW(e):e.contextElement?RW(e.contextElement):[],popper:RW(t)};var l=function(e){var t=WW(e);return GG.reduce(function(e,r){return e.concat(t.filter(function(e){return e.phase===r}))},[])}(function(e){var t=e.reduce(function(e,t){var r=e[t.name];return e[t.name]=r?Object.assign({},r,t,{options:Object.assign({},r.options,t.options),data:Object.assign({},r.data,t.data)}):t,e},{});return Object.keys(t).map(function(e){return t[e]})}([].concat(i,n.options.modifiers)));return n.orderedModifiers=l.filter(function(e){return e.enabled}),n.orderedModifiers.forEach(function(e){var t=e.name,r=e.options,i=void 0===r?{}:r,a=e.effect;if("function"==typeof a){var s=a({state:n,name:t,instance:c,options:i}),u=function(){};o.push(s||u)}}),c.update()},forceUpdate:function(){if(!s){var e=n.elements,t=e.reference,r=e.popper;if(zW(t,r)){n.rects={reference:GW(t,lW(r),"fixed"===n.options.strategy),popper:iW(r)},n.reset=!1,n.placement=n.options.placement,n.orderedModifiers.forEach(function(e){return n.modifiersData[e.name]=Object.assign({},e.data)});for(var i=0;i<n.orderedModifiers.length;i++)if(!0!==n.reset){var a=n.orderedModifiers[i],o=a.fn,u=a.options,l=void 0===u?{}:u,d=a.name;"function"==typeof o&&(n=o({state:n,options:l,name:d,instance:c})||n)}else n.reset=!1,i=-1}}},update:qW(function(){return new Promise(function(e){c.forceUpdate(),e(n)})}),destroy:function(){u(),s=!0}};if(!zW(e,t))return c;function u(){o.forEach(function(e){return e()}),o=[]}return c.setOptions(r).then(function(e){!s&&r.onFirstUpdate&&r.onFirstUpdate(e)}),c}}var KW=YW({defaultModifiers:[bW,VW,vW,KG,$W,FW,jW,hW,BW]}),XW="tippy-content",QW="tippy-arrow",JW="tippy-svg-arrow",ZW={passive:!0,capture:!0},eq=function(){return document.body};function tq(e,t,r){return Array.isArray(e)?e[t]??(Array.isArray(r)?r[t]:r):e}function rq(e,t){var r={}.toString.call(e);return 0===r.indexOf("[object")&&r.indexOf(t+"]")>-1}function iq(e,t){return"function"==typeof e?e.apply(void 0,t):e}function nq(e,t){return 0===t?e:function(i){clearTimeout(r),r=setTimeout(function(){e(i)},t)};var r}function aq(e){return[].concat(e)}function oq(e,t){-1===e.indexOf(t)&&e.push(t)}function sq(e){return[].slice.call(e)}function cq(e){return Object.keys(e).reduce(function(t,r){return void 0!==e[r]&&(t[r]=e[r]),t},{})}function uq(){return document.createElement("div")}function lq(e){return["Element","Fragment"].some(function(t){return rq(e,t)})}function dq(e){return lq(e)?[e]:function(e){return rq(e,"NodeList")}(e)?sq(e):Array.isArray(e)?e:sq(document.querySelectorAll(e))}function pq(e,t){e.forEach(function(e){e&&(e.style.transitionDuration=t+"ms")})}function mq(e,t){e.forEach(function(e){e&&e.setAttribute("data-state",t)})}function fq(e,t,r){var i=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(t){e[i](t,r)})}function hq(e,t){for(var r=t;r;){var i;if(e.contains(r))return!0;r=null==r.getRootNode||null==(i=r.getRootNode())?void 0:i.host}return!1}var gq={isTouch:!1},Iq=0;function yq(){gq.isTouch||(gq.isTouch=!0,window.performance&&document.addEventListener("mousemove",vq))}function vq(){var e=performance.now();e-Iq<20&&(gq.isTouch=!1,document.removeEventListener("mousemove",vq)),Iq=e}function Sq(){var e=document.activeElement;if(function(e){return!(!e||!e._tippy||e._tippy.reference!==e)}(e)){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var bq=!!(typeof window<"u"&&typeof document<"u")&&!!window.msCrypto;var Uq={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},wq=Object.assign({appendTo:eq,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Uq,{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),Tq=Object.keys(wq);function Dq(e){var t=(e.plugins||[]).reduce(function(t,r){var i,n=r.name,a=r.defaultValue;n&&(t[n]=void 0!==e[n]?e[n]:null!=(i=wq[n])?i:a);return t},{});return Object.assign({},e,t)}function Pq(e,t){var r=Object.assign({},t,{content:iq(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(Dq(Object.assign({},wq,{plugins:t}))):Tq).reduce(function(t,r){var i=(e.getAttribute("data-tippy-"+r)||"").trim();if(!i)return t;if("content"===r)t[r]=i;else try{t[r]=JSON.parse(i)}catch{t[r]=i}return t},{})}(e,t.plugins));return r.aria=Object.assign({},wq.aria,r.aria),r.aria={expanded:"auto"===r.aria.expanded?t.interactive:r.aria.expanded,content:"auto"===r.aria.content?t.interactive?null:"describedby":r.aria.content},r}function Nq(e,t){e.innerHTML=t}function Eq(e){var t=uq();return!0===e?t.className=QW:(t.className=JW,lq(e)?t.appendChild(e):Nq(t,e)),t}function Mq(e,t){lq(t.content)?(Nq(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?Nq(e,t.content):e.textContent=t.content)}function Rq(e){var t=e.firstElementChild,r=sq(t.children);return{box:t,content:r.find(function(e){return e.classList.contains(XW)}),arrow:r.find(function(e){return e.classList.contains(QW)||e.classList.contains(JW)}),backdrop:r.find(function(e){return e.classList.contains("tippy-backdrop")})}}function Aq(e){var t=uq(),r=uq();r.className="tippy-box",r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var i=uq();function n(r,i){var n=Rq(t),a=n.box,o=n.content,s=n.arrow;i.theme?a.setAttribute("data-theme",i.theme):a.removeAttribute("data-theme"),"string"==typeof i.animation?a.setAttribute("data-animation",i.animation):a.removeAttribute("data-animation"),i.inertia?a.setAttribute("data-inertia",""):a.removeAttribute("data-inertia"),a.style.maxWidth="number"==typeof i.maxWidth?i.maxWidth+"px":i.maxWidth,i.role?a.setAttribute("role",i.role):a.removeAttribute("role"),(r.content!==i.content||r.allowHTML!==i.allowHTML)&&Mq(o,e.props),i.arrow?s?r.arrow!==i.arrow&&(a.removeChild(s),a.appendChild(Eq(i.arrow))):a.appendChild(Eq(i.arrow)):s&&a.removeChild(s)}return i.className=XW,i.setAttribute("data-state","hidden"),Mq(i,e.props),t.appendChild(r),r.appendChild(i),n(e.props,e.props),{popper:t,onUpdate:n}}Aq.$$tippy=!0;var Cq=1,kq=[],xq=[];function Oq(e,t){var r,i,n,a,o,s,c,u=Pq(e,Object.assign({},wq,Dq(cq(t)))),l=!1,d=!1,p=!1,m=!1,f=[],h=nq(H,u.interactiveDebounce),g=Cq++,I=function(e){return e.filter(function(t,r){return e.indexOf(t)===r})}(u.plugins),y={id:g,reference:e,popper:uq(),popperInstance:null,props:u,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:I,clearDelayTimeouts:function(){clearTimeout(r),clearTimeout(i),cancelAnimationFrame(n)},setProps:function(t){if(!y.state.isDestroyed){C("onBeforeUpdate",[y,t]),W();var r=y.props,i=Pq(e,Object.assign({},r,cq(t),{ignoreAttributes:!0}));y.props=i,G(),r.interactiveDebounce!==i.interactiveDebounce&&(O(),h=nq(H,i.interactiveDebounce)),r.triggerTarget&&!i.triggerTarget?aq(r.triggerTarget).forEach(function(e){e.removeAttribute("aria-expanded")}):i.triggerTarget&&e.removeAttribute("aria-expanded"),x(),A(),b&&b(r,i),y.popperInstance&&(X(),J().forEach(function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)})),C("onAfterUpdate",[y,t])}},setContent:function(e){y.setProps({content:e})},show:function(){var e=y.state.isVisible,t=y.state.isDestroyed,r=!y.state.isEnabled,i=gq.isTouch&&!y.props.touch,n=tq(y.props.duration,0,wq.duration);if(!(e||t||r||i||N().hasAttribute("disabled")||(C("onShow",[y],!1),!1===y.props.onShow(y)))){if(y.state.isVisible=!0,P()&&(S.style.visibility="visible"),A(),B(),y.state.isMounted||(S.style.transition="none"),P()){var a=M();pq([a.box,a.content],0)}s=function(){var e;if(y.state.isVisible&&!m){if(m=!0,S.offsetHeight,S.style.transition=y.props.moveTransition,P()&&y.props.animation){var t=M(),r=t.box,i=t.content;pq([r,i],n),mq([r,i],"visible")}k(),x(),oq(xq,y),null==(e=y.popperInstance)||e.forceUpdate(),C("onMount",[y]),y.props.animation&&P()&&function(e,t){V(e,t)}(n,function(){y.state.isShown=!0,C("onShown",[y])})}},function(){var e,t=y.props.appendTo,r=N();e=y.props.interactive&&t===eq||"parent"===t?r.parentNode:iq(t,[r]),e.contains(S)||e.appendChild(S),y.state.isMounted=!0,X()}()}},hide:function(){var e=!y.state.isVisible,t=y.state.isDestroyed,r=!y.state.isEnabled,i=tq(y.props.duration,1,wq.duration);if(!(e||t||r)&&(C("onHide",[y],!1),!1!==y.props.onHide(y))){if(y.state.isVisible=!1,y.state.isShown=!1,m=!1,l=!1,P()&&(S.style.visibility="hidden"),O(),$(),A(!0),P()){var n=M(),a=n.box,o=n.content;y.props.animation&&(pq([a,o],i),mq([a,o],"hidden"))}k(),x(),y.props.animation?P()&&function(e,t){V(e,function(){!y.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&t()})}(i,y.unmount):y.unmount()}},hideWithInteractivity:function(e){E().addEventListener("mousemove",h),oq(kq,h),h(e)},enable:function(){y.state.isEnabled=!0},disable:function(){y.hide(),y.state.isEnabled=!1},unmount:function(){y.state.isVisible&&y.hide(),y.state.isMounted&&(Q(),J().forEach(function(e){e._tippy.unmount()}),S.parentNode&&S.parentNode.removeChild(S),xq=xq.filter(function(e){return e!==y}),y.state.isMounted=!1,C("onHidden",[y]))},destroy:function(){!y.state.isDestroyed&&(y.clearDelayTimeouts(),y.unmount(),W(),delete e._tippy,y.state.isDestroyed=!0,C("onDestroy",[y]))}};if(!u.render)return y;var v=u.render(y),S=v.popper,b=v.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+y.id,y.popper=S,e._tippy=y,S._tippy=y;var U=I.map(function(e){return e.fn(y)}),w=e.hasAttribute("aria-expanded");return G(),x(),A(),C("onCreate",[y]),u.showOnCreate&&Z(),S.addEventListener("mouseenter",function(){y.props.interactive&&y.state.isVisible&&y.clearDelayTimeouts()}),S.addEventListener("mouseleave",function(){y.props.interactive&&y.props.trigger.indexOf("mouseenter")>=0&&E().addEventListener("mousemove",h)}),y;function T(){var e=y.props.touch;return Array.isArray(e)?e:[e,0]}function D(){return"hold"===T()[0]}function P(){var e;return!(null==(e=y.props.render)||!e.$$tippy)}function N(){return c||e}function E(){var e=N().parentNode;return e?function(e){var t,r=aq(e)[0];return null!=r&&null!=(t=r.ownerDocument)&&t.body?r.ownerDocument:document}(e):document}function M(){return Rq(S)}function R(e){return y.state.isMounted&&!y.state.isVisible||gq.isTouch||a&&"focus"===a.type?0:tq(y.props.delay,e?0:1,wq.delay)}function A(e){void 0===e&&(e=!1),S.style.pointerEvents=y.props.interactive&&!e?"":"none",S.style.zIndex=""+y.props.zIndex}function C(e,t,r){var i;(void 0===r&&(r=!0),U.forEach(function(r){r[e]&&r[e].apply(r,t)}),r)&&(i=y.props)[e].apply(i,t)}function k(){var t=y.props.aria;if(t.content){var r="aria-"+t.content,i=S.id;aq(y.props.triggerTarget||e).forEach(function(e){var t=e.getAttribute(r);if(y.state.isVisible)e.setAttribute(r,t?t+" "+i:i);else{var n=t&&t.replace(i,"").trim();n?e.setAttribute(r,n):e.removeAttribute(r)}})}}function x(){!w&&y.props.aria.expanded&&aq(y.props.triggerTarget||e).forEach(function(e){y.props.interactive?e.setAttribute("aria-expanded",y.state.isVisible&&e===N()?"true":"false"):e.removeAttribute("aria-expanded")})}function O(){E().removeEventListener("mousemove",h),kq=kq.filter(function(e){return e!==h})}function F(t){if(!gq.isTouch||!p&&"mousedown"!==t.type){var r=t.composedPath&&t.composedPath()[0]||t.target;if(!y.props.interactive||!hq(S,r)){if(aq(y.props.triggerTarget||e).some(function(e){return hq(e,r)})){if(gq.isTouch||y.state.isVisible&&y.props.trigger.indexOf("click")>=0)return}else C("onClickOutside",[y,t]);!0===y.props.hideOnClick&&(y.clearDelayTimeouts(),y.hide(),d=!0,setTimeout(function(){d=!1}),y.state.isMounted||$())}}}function _(){p=!0}function L(){p=!1}function B(){var e=E();e.addEventListener("mousedown",F,!0),e.addEventListener("touchend",F,ZW),e.addEventListener("touchstart",L,ZW),e.addEventListener("touchmove",_,ZW)}function $(){var e=E();e.removeEventListener("mousedown",F,!0),e.removeEventListener("touchend",F,ZW),e.removeEventListener("touchstart",L,ZW),e.removeEventListener("touchmove",_,ZW)}function V(e,t){var r=M().box;function i(e){e.target===r&&(fq(r,"remove",i),t())}if(0===e)return t();fq(r,"remove",o),fq(r,"add",i),o=i}function j(t,r,i){void 0===i&&(i=!1),aq(y.props.triggerTarget||e).forEach(function(e){e.addEventListener(t,r,i),f.push({node:e,eventType:t,handler:r,options:i})})}function G(){D()&&(j("touchstart",q,{passive:!0}),j("touchend",z,{passive:!0})),function(e){return e.split(/\s+/).filter(Boolean)}(y.props.trigger).forEach(function(e){if("manual"!==e)switch(j(e,q),e){case"mouseenter":j("mouseleave",z);break;case"focus":j(bq?"focusout":"blur",Y);break;case"focusin":j("focusout",Y)}})}function W(){f.forEach(function(e){var t=e.node,r=e.eventType,i=e.handler,n=e.options;t.removeEventListener(r,i,n)}),f=[]}function q(e){var t,r=!1;if(y.state.isEnabled&&!K(e)&&!d){var i="focus"===(null==(t=a)?void 0:t.type);a=e,c=e.currentTarget,x(),!y.state.isVisible&&function(e){return rq(e,"MouseEvent")}(e)&&kq.forEach(function(t){return t(e)}),"click"===e.type&&(y.props.trigger.indexOf("mouseenter")<0||l)&&!1!==y.props.hideOnClick&&y.state.isVisible?r=!0:Z(e),"click"===e.type&&(l=!r),r&&!i&&ee(e)}}function H(e){var t=e.target,r=N().contains(t)||S.contains(t);"mousemove"===e.type&&r||function(e,t){var r=t.clientX,i=t.clientY;return e.every(function(e){var t=e.popperRect,n=e.popperState,a=e.props.interactiveBorder,o=function(e){return e.split("-")[0]}(n.placement),s=n.modifiersData.offset;if(!s)return!0;var c="bottom"===o?s.top.y:0,u="top"===o?s.bottom.y:0,l="right"===o?s.left.x:0,d="left"===o?s.right.x:0,p=t.top-i+c>a,m=i-t.bottom-u>a,f=t.left-r+l>a,h=r-t.right-d>a;return p||m||f||h})}(J().concat(S).map(function(e){var t,r=null==(t=e._tippy.popperInstance)?void 0:t.state;return r?{popperRect:e.getBoundingClientRect(),popperState:r,props:u}:null}).filter(Boolean),e)&&(O(),ee(e))}function z(e){if(!(K(e)||y.props.trigger.indexOf("click")>=0&&l)){if(y.props.interactive)return void y.hideWithInteractivity(e);ee(e)}}function Y(e){y.props.trigger.indexOf("focusin")<0&&e.target!==N()||y.props.interactive&&e.relatedTarget&&S.contains(e.relatedTarget)||ee(e)}function K(e){return!!gq.isTouch&&D()!==e.type.indexOf("touch")>=0}function X(){Q();var t=y.props,r=t.popperOptions,i=t.placement,n=t.offset,a=t.getReferenceClientRect,o=t.moveTransition,c=P()?Rq(S).arrow:null,u=a?{getBoundingClientRect:a,contextElement:a.contextElement||N()}:e,l=[{name:"offset",options:{offset:n}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(P()){var r=M().box;["placement","reference-hidden","escaped"].forEach(function(e){"placement"===e?r.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?r.setAttribute("data-"+e,""):r.removeAttribute("data-"+e)}),t.attributes.popper={}}}}];P()&&c&&l.push({name:"arrow",options:{element:c,padding:3}}),l.push.apply(l,r?.modifiers||[]),y.popperInstance=KW(u,S,Object.assign({},r,{placement:i,onFirstUpdate:s,modifiers:l}))}function Q(){y.popperInstance&&(y.popperInstance.destroy(),y.popperInstance=null)}function J(){return sq(S.querySelectorAll("[data-tippy-root]"))}function Z(e){y.clearDelayTimeouts(),e&&C("onTrigger",[y,e]),B();var t=R(!0),i=T(),n=i[0],a=i[1];gq.isTouch&&"hold"===n&&a&&(t=a),t?r=setTimeout(function(){y.show()},t):y.show()}function ee(e){if(y.clearDelayTimeouts(),C("onUntrigger",[y,e]),y.state.isVisible){if(!(y.props.trigger.indexOf("mouseenter")>=0&&y.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&l)){var t=R(!1);t?i=setTimeout(function(){y.state.isVisible&&y.hide()},t):n=requestAnimationFrame(function(){y.hide()})}}else $()}}function Fq(e,t){void 0===t&&(t={});var r=wq.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",yq,ZW),window.addEventListener("blur",Sq);var i=Object.assign({},t,{plugins:r}),n=dq(e).reduce(function(e,t){var r=t&&Oq(t,i);return r&&e.push(r),e},[]);return lq(e)?n[0]:n}function _q(e){return"function"==typeof e}let Lq;function Bq(e){Lq&&(Lq?.destroy(!0),Lq=void 0),e?.remove&&e.remove()}function $q(e){const{title:t,options:r,menuItems:i=[],coords:n,callback:a,config:o}=e;let{target:s,items:c}=e;if(!r?.length&&!c?.length&&!i)return;Bq();const u=document.createElement("div");let l;return s=s||n?.evt?.target,s&&(Lq=Fq(s,{content:()=>{c=c?.filter(e=>!e.hide&&!e.disabled).map(e=>({...e,onClick:()=>{Bq(u),_q(e.onClick)&&e.onClick()}}))||r?.filter(e=>!e.hide&&!e.disabled).map(e=>({text:"object"==typeof e?e.option:e,style:e.style,onClick:()=>{e.subMenu?Lq.setContent("IMPLEMENT SUB MENU"):_q(e.onClick)?(Bq(u),e.onClick()):_q(a)&&a&&(Bq(u),a("object"==typeof e?{...e,coords:n}:e))}}));const e=[{text:t,items:c},...i];return l=RG(u,e).focusElement,u},theme:"light-border",trigger:"click",onShown:()=>{l&&setTimeout(()=>l?.focus(),0)},...o}),Lq.show(),Lq.setProps({interactive:!0})),Lq}function Vq(){return"0.9.27"}Fq.defaultProps=wq,Fq.setDefaultProps=function(e){Object.keys(e).forEach(function(t){wq[t]=e[t]})},Fq.currentInput=gq,Object.assign({},KG,{effect:function(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow)}}),Fq.setDefaultProps({render:Aq});const jq={SET3_S6_TB7:"SET3-S:6/TB7",SET3_S6_TB7_F_TB10:"SET3-S:6/TB7-F:TB10",SET3_S6_TB10:"SET3-S:6/TB10",SET3_S6_F_TB10:"SET3-S:6-F:TB10",SET3_S6_TB7_NOAD:"SET3-S:6/TB7NOAD",SET3_S8_TB7:"SET3-S:8/TB7",SET3_S8_TB7_AT7:"SET3-S:8/TB7@7",SET3_S4_TB7:"SET3-S:4/TB7",SET3_S4_TB7_F_TB10:"SET3-S:4/TB7-F:TB10",SET3_S4_TB5_AT3_F_TB10:"SET3-S:4/TB5@3-F:TB10",SET5_S6_TB7:"SET5-S:6/TB7",SET5_S6_TB7_F_TB10:"SET5-S:6/TB7-F:TB10",SET1_S6_TB7:"SET1-S:6/TB7",SET1_S6_TB10:"SET1-S:6/TB10",SET1_S6_TB7_AT5:"SET1-S:6/TB7@5",SET1_S8_TB7:"SET1-S:8/TB7",SET1_S4_TB7:"SET1-S:4/TB7",SET1_S5_TB9_AT4:"SET1-S:5/TB9@4",SET1_S_TB7:"SET1-S:T7",SET1_S_TB10:"SET1-S:TB10",SET1_S_TB21:"SET1-S:T21",SET1_S8:"SET1-S:8",SET1_S10:"SET1-S:10",FAST4:"SET5-S:4/NOAD",SET3X_T10A_TB1:"SET3XA-S:T10-F:TB1",SET3X_T10A_TB1_NOAD:"SET3XA-S:T10-F:TB1NOAD",SET4X_T10A_TB1:"SET4XA-S:T10-F:TB1"};function Gq(e,t,r){if(!e)return{elements:{}};const i={};for(const n of t||[]){if(!n?.label||n.hide)continue;const t=document.createElement("button");n.id&&(i[n.id]=t,t.id=n.id),t.style.marginRight=".5em",t.className="button font-medium",n.intent&&t.classList.add(n.intent),t.innerHTML=n.label,n.disabled&&(t.disabled=!0),t.onclick=e=>{e.stopPropagation(),!e.target.disabled&&De(n.onClick)&&n.onClick(),r&&De(r)&&r()},e.appendChild(t)}return{elements:i}}function Wq(e){return E_.isConvertableInteger(e)&&parseInt(e.toString())>=0}const qq=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,Hq=Object.freeze(Object.defineProperty({__proto__:null,dateValidator:function(e){return E_.dateTime.dateValidation.test(e)},emailValidator:e=>qq.exec(e),nameValidator:(e,t)=>r=>r?.trim().length>=e&&(!t||r?.trim().length<=t),numericRange:(e,t)=>r=>Wq(r)&&Number(r)>=e&&Number(r)<=t,numericValidator:Wq,passwordValidator:e=>/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?\d)(?=.*?[#?!@$%^&*-]).{8,12}$/.test(e),wordValidator:(e,t)=>r=>{const i=(r||"").trim().split(" ").length;return i>=e&&(!t||i<=t)}},Symbol.toStringTag,{value:"Module"}));class zq{constructor({tournamentRecord:e,drawId:t,structureId:r,eventId:i}){this.tournamentRecord=e,this.drawId=t,this.structureId=r,this.eventId=i||e.events?.[0]?.eventId,aL.setState(e)}setRenderCallback(e){this.renderCallback=e}getAllParticipants(){aL.setState(this.tournamentRecord);const{participants:e=[]}=aL.getParticipants()||{};return e.map(e=>({participantId:e.participantId,participantName:e.participantName,participantType:e.participantType,person:e.person,individualParticipants:e.individualParticipants}))}getAvailableParticipants(){aL.setState(this.tournamentRecord);const e=this.getAllParticipants(),{assignedParticipantIds:t=[]}=aL.getAssignedParticipantIds({drawId:this.drawId})||{};return e.filter(e=>!t.includes(e.participantId))}removeAssignment({drawPosition:e}){aL.setState(this.tournamentRecord);const t=!0===this.getMatchUps().find(t=>t.sides?.some(t=>t.drawPosition===e))?.sides?.find(t=>t.drawPosition===e)?.bye,r=aL.removeDrawPositionAssignment({drawId:this.drawId,structureId:this.structureId,drawPosition:e});if(r.error)return{success:!1,error:r.error};const{tournamentRecord:i}=aL.getState()||{};return this.tournamentRecord=i,t&&this.renderCallback&&this.renderCallback(),{success:!0}}assignParticipant({drawPosition:e,participantId:t}){aL.setState(this.tournamentRecord);const r=aL.assignDrawPosition({drawId:this.drawId,structureId:this.structureId,drawPosition:e,participantId:t});if(r.error)return{success:!1,error:r.error};const{tournamentRecord:i}=aL.getState()||{};return this.tournamentRecord=i,this.focusDrawPosition=e+1,this.renderCallback&&this.renderCallback(),{success:!0}}getAndClearFocusDrawPosition(){const e=this.focusDrawPosition;return this.focusDrawPosition=void 0,e}assignBye({drawPosition:e}){aL.setState(this.tournamentRecord);const t=aL.assignDrawPositionBye({drawId:this.drawId,structureId:this.structureId,drawPosition:e});if(t.error)return{success:!1,error:t.error};const{tournamentRecord:r}=aL.getState()||{};return this.tournamentRecord=r,this.focusDrawPosition=e+1,this.renderCallback&&this.renderCallback(),{success:!0}}assignQualifier({drawPosition:e}){aL.setState(this.tournamentRecord);const t=aL.assignDrawPosition({drawId:this.drawId,structureId:this.structureId,drawPosition:e,qualifier:!0});if(t.error)return{success:!1,error:t.error};const{tournamentRecord:r}=aL.getState()||{};return this.tournamentRecord=r,this.focusDrawPosition=e+1,this.renderCallback&&this.renderCallback(),{success:!0}}getMatchUps(){aL.setState(this.tournamentRecord);const{eventData:e}=aL.getEventData({eventId:this.eventId})||{},t=e?.drawsData?.find(e=>e.drawId===this.drawId)?.structures?.find(e=>e.structureId===this.structureId)?.roundMatchUps;return t?Object.values(t).flat():[]}getState(){return this.tournamentRecord}getContext(){return{drawId:this.drawId,structureId:this.structureId}}}function Yq(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Kq(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Xq(e){let t,r,i;function n(e,i,n=0,a=e.length){if(n<a){if(0!==t(i,i))return a;do{const t=n+a>>>1;r(e[t],i)<0?n=t+1:a=t}while(n<a)}return n}return 2!==e.length?(t=Yq,r=(t,r)=>Yq(e(t),r),i=(t,r)=>e(t)-r):(t=e===Yq||e===Kq?e:Qq,r=e,i=e),{left:n,center:function(e,t,r=0,a=e.length){const o=n(e,t,r,a-1);return o>r&&i(e[o-1],t)>-i(e[o],t)?o-1:o},right:function(e,i,n=0,a=e.length){if(n<a){if(0!==t(i,i))return a;do{const t=n+a>>>1;r(e[t],i)<=0?n=t+1:a=t}while(n<a)}return n}}}function Qq(){return 0}const Jq=Xq(Yq).right;Xq(function(e){return null===e?NaN:+e}).center;const Zq=Math.sqrt(50),eH=Math.sqrt(10),tH=Math.sqrt(2);function rH(e,t,r){const i=(t-e)/Math.max(0,r),n=Math.floor(Math.log10(i)),a=i/Math.pow(10,n),o=a>=Zq?10:a>=eH?5:a>=tH?2:1;let s,c,u;return n<0?(u=Math.pow(10,-n)/o,s=Math.round(e*u),c=Math.round(t*u),s/u<e&&++s,c/u>t&&--c,u=-u):(u=Math.pow(10,n)*o,s=Math.round(e/u),c=Math.round(t/u),s*u<e&&++s,c*u>t&&--c),c<s&&.5<=r&&r<2?rH(e,t,2*r):[s,c,u]}function iH(e,t,r){return rH(e=+e,t=+t,r=+r)[2]}function nH(e,t,r){e=+e,t=+t,r=(n=arguments.length)<2?(t=e,e=0,1):n<3?1:+r;for(var i=-1,n=0|Math.max(0,Math.ceil((t-e)/r)),a=new Array(n);++i<n;)a[i]=e+i*r;return a}var aH={value:()=>{}};function oH(){for(var e,t=0,r=arguments.length,i={};t<r;++t){if(!(e=arguments[t]+"")||e in i||/[\s.]/.test(e))throw new Error("illegal type: "+e);i[e]=[]}return new sH(i)}function sH(e){this._=e}function cH(e,t){for(var r,i=0,n=e.length;i<n;++i)if((r=e[i]).name===t)return r.value}function uH(e,t,r){for(var i=0,n=e.length;i<n;++i)if(e[i].name===t){e[i]=aH,e=e.slice(0,i).concat(e.slice(i+1));break}return null!=r&&e.push({name:t,value:r}),e}sH.prototype=oH.prototype={constructor:sH,on:function(e,t){var r,i=this._,n=function(e,t){return e.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");if(i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:r}})}(e+"",i),a=-1,o=n.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<o;)if(r=(e=n[a]).type)i[r]=uH(i[r],e.name,t);else if(null==t)for(r in i)i[r]=uH(i[r],e.name,null);return this}for(;++a<o;)if((r=(e=n[a]).type)&&(r=cH(i[r],e.name)))return r},copy:function(){var e={},t=this._;for(var r in t)e[r]=t[r].slice();return new sH(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var r,i,n=new Array(r),a=0;a<r;++a)n[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(a=0,r=(i=this._[e]).length;a<r;++a)i[a].value.apply(t,n)},apply:function(e,t,r){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],n=0,a=i.length;n<a;++n)i[n].value.apply(t,r)}};var lH="http://www.w3.org/1999/xhtml";const dH={svg:"http://www.w3.org/2000/svg",xhtml:lH,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function pH(e){var t=e+="",r=t.indexOf(":");return r>=0&&"xmlns"!==(t=e.slice(0,r))&&(e=e.slice(r+1)),dH.hasOwnProperty(t)?{space:dH[t],local:e}:e}function mH(e){return function(){var t=this.ownerDocument,r=this.namespaceURI;return r===lH&&t.documentElement.namespaceURI===lH?t.createElement(e):t.createElementNS(r,e)}}function fH(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function hH(e){var t=pH(e);return(t.local?fH:mH)(t)}function gH(){}function IH(e){return null==e?gH:function(){return this.querySelector(e)}}function yH(){return[]}function vH(e){return null==e?yH:function(){return this.querySelectorAll(e)}}function SH(e){return function(){return function(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}function bH(e){return function(){return this.matches(e)}}function UH(e){return function(t){return t.matches(e)}}var wH=Array.prototype.find;function TH(){return this.firstElementChild}var DH=Array.prototype.filter;function PH(){return Array.from(this.children)}function NH(e){return new Array(e.length)}function EH(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function MH(e,t,r,i,n,a){for(var o,s=0,c=t.length,u=a.length;s<u;++s)(o=t[s])?(o.__data__=a[s],i[s]=o):r[s]=new EH(e,a[s]);for(;s<c;++s)(o=t[s])&&(n[s]=o)}function RH(e,t,r,i,n,a,o){var s,c,u,l=new Map,d=t.length,p=a.length,m=new Array(d);for(s=0;s<d;++s)(c=t[s])&&(m[s]=u=o.call(c,c.__data__,s,t)+"",l.has(u)?n[s]=c:l.set(u,c));for(s=0;s<p;++s)u=o.call(e,a[s],s,a)+"",(c=l.get(u))?(i[s]=c,c.__data__=a[s],l.delete(u)):r[s]=new EH(e,a[s]);for(s=0;s<d;++s)(c=t[s])&&l.get(m[s])===c&&(n[s]=c)}function AH(e){return e.__data__}function CH(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function kH(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function xH(e){return function(){this.removeAttribute(e)}}function OH(e){return function(){this.removeAttributeNS(e.space,e.local)}}function FH(e,t){return function(){this.setAttribute(e,t)}}function _H(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function LH(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttribute(e):this.setAttribute(e,r)}}function BH(e,t){return function(){var r=t.apply(this,arguments);null==r?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,r)}}function $H(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function VH(e){return function(){this.style.removeProperty(e)}}function jH(e,t,r){return function(){this.style.setProperty(e,t,r)}}function GH(e,t,r){return function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,r)}}function WH(e,t){return e.style.getPropertyValue(t)||$H(e).getComputedStyle(e,null).getPropertyValue(t)}function qH(e){return function(){delete this[e]}}function HH(e,t){return function(){this[e]=t}}function zH(e,t){return function(){var r=t.apply(this,arguments);null==r?delete this[e]:this[e]=r}}function YH(e){return e.trim().split(/^|\s+/)}function KH(e){return e.classList||new XH(e)}function XH(e){this._node=e,this._names=YH(e.getAttribute("class")||"")}function QH(e,t){for(var r=KH(e),i=-1,n=t.length;++i<n;)r.add(t[i])}function JH(e,t){for(var r=KH(e),i=-1,n=t.length;++i<n;)r.remove(t[i])}function ZH(e){return function(){QH(this,e)}}function ez(e){return function(){JH(this,e)}}function tz(e,t){return function(){(t.apply(this,arguments)?QH:JH)(this,e)}}function rz(){this.textContent=""}function iz(e){return function(){this.textContent=e}}function nz(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function az(){this.innerHTML=""}function oz(e){return function(){this.innerHTML=e}}function sz(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function cz(){this.nextSibling&&this.parentNode.appendChild(this)}function uz(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function lz(){return null}function dz(){var e=this.parentNode;e&&e.removeChild(this)}function pz(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function mz(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function fz(e){return function(){var t=this.__on;if(t){for(var r,i=0,n=-1,a=t.length;i<a;++i)r=t[i],e.type&&r.type!==e.type||r.name!==e.name?t[++n]=r:this.removeEventListener(r.type,r.listener,r.options);++n?t.length=n:delete this.__on}}}function hz(e,t,r){return function(){var i,n=this.__on,a=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(n)for(var o=0,s=n.length;o<s;++o)if((i=n[o]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=r),void(i.value=t);this.addEventListener(e.type,a,r),i={type:e.type,name:e.name,value:t,listener:a,options:r},n?n.push(i):this.__on=[i]}}function gz(e,t,r){var i=$H(e),n=i.CustomEvent;"function"==typeof n?n=new n(t,r):(n=i.document.createEvent("Event"),r?(n.initEvent(t,r.bubbles,r.cancelable),n.detail=r.detail):n.initEvent(t,!1,!1)),e.dispatchEvent(n)}function Iz(e,t){return function(){return gz(this,e,t)}}function yz(e,t){return function(){return gz(this,e,t.apply(this,arguments))}}EH.prototype={constructor:EH,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},XH.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var vz=[null];function Sz(e,t){this._groups=e,this._parents=t}function bz(){return new Sz([[document.documentElement]],vz)}function Uz(e){return"string"==typeof e?new Sz([[document.querySelector(e)]],[document.documentElement]):new Sz([[e]],vz)}function wz(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Tz(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function Dz(){}Sz.prototype=bz.prototype={constructor:Sz,select:function(e){"function"!=typeof e&&(e=IH(e));for(var t=this._groups,r=t.length,i=new Array(r),n=0;n<r;++n)for(var a,o,s=t[n],c=s.length,u=i[n]=new Array(c),l=0;l<c;++l)(a=s[l])&&(o=e.call(a,a.__data__,l,s))&&("__data__"in a&&(o.__data__=a.__data__),u[l]=o);return new Sz(i,this._parents)},selectAll:function(e){e="function"==typeof e?SH(e):vH(e);for(var t=this._groups,r=t.length,i=[],n=[],a=0;a<r;++a)for(var o,s=t[a],c=s.length,u=0;u<c;++u)(o=s[u])&&(i.push(e.call(o,o.__data__,u,s)),n.push(o));return new Sz(i,n)},selectChild:function(e){return this.select(null==e?TH:function(e){return function(){return wH.call(this.children,e)}}("function"==typeof e?e:UH(e)))},selectChildren:function(e){return this.selectAll(null==e?PH:function(e){return function(){return DH.call(this.children,e)}}("function"==typeof e?e:UH(e)))},filter:function(e){"function"!=typeof e&&(e=bH(e));for(var t=this._groups,r=t.length,i=new Array(r),n=0;n<r;++n)for(var a,o=t[n],s=o.length,c=i[n]=[],u=0;u<s;++u)(a=o[u])&&e.call(a,a.__data__,u,o)&&c.push(a);return new Sz(i,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,AH);var r=t?RH:MH,i=this._parents,n=this._groups;"function"!=typeof e&&(e=function(e){return function(){return e}}(e));for(var a=n.length,o=new Array(a),s=new Array(a),c=new Array(a),u=0;u<a;++u){var l=i[u],d=n[u],p=d.length,m=CH(e.call(l,l&&l.__data__,u,i)),f=m.length,h=s[u]=new Array(f),g=o[u]=new Array(f);r(l,d,h,g,c[u]=new Array(p),m,t);for(var I,y,v=0,S=0;v<f;++v)if(I=h[v]){for(v>=S&&(S=v+1);!(y=g[S])&&++S<f;);I._next=y||null}}return(o=new Sz(o,i))._enter=s,o._exit=c,o},enter:function(){return new Sz(this._enter||this._groups.map(NH),this._parents)},exit:function(){return new Sz(this._exit||this._groups.map(NH),this._parents)},join:function(e,t,r){var i=this.enter(),n=this,a=this.exit();return"function"==typeof e?(i=e(i))&&(i=i.selection()):i=i.append(e+""),null!=t&&((n=t(n))&&(n=n.selection())),null==r?a.remove():r(a),i&&n?i.merge(n).order():n},merge:function(e){for(var t=e.selection?e.selection():e,r=this._groups,i=t._groups,n=r.length,a=i.length,o=Math.min(n,a),s=new Array(n),c=0;c<o;++c)for(var u,l=r[c],d=i[c],p=l.length,m=s[c]=new Array(p),f=0;f<p;++f)(u=l[f]||d[f])&&(m[f]=u);for(;c<n;++c)s[c]=r[c];return new Sz(s,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,r=e.length;++t<r;)for(var i,n=e[t],a=n.length-1,o=n[a];--a>=0;)(i=n[a])&&(o&&4^i.compareDocumentPosition(o)&&o.parentNode.insertBefore(i,o),o=i);return this},sort:function(e){function t(t,r){return t&&r?e(t.__data__,r.__data__):!t-!r}e||(e=kH);for(var r=this._groups,i=r.length,n=new Array(i),a=0;a<i;++a){for(var o,s=r[a],c=s.length,u=n[a]=new Array(c),l=0;l<c;++l)(o=s[l])&&(u[l]=o);u.sort(t)}return new Sz(n,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],n=0,a=i.length;n<a;++n){var o=i[n];if(o)return o}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,r=0,i=t.length;r<i;++r)for(var n,a=t[r],o=0,s=a.length;o<s;++o)(n=a[o])&&e.call(n,n.__data__,o,a);return this},attr:function(e,t){var r=pH(e);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((null==t?r.local?OH:xH:"function"==typeof t?r.local?BH:LH:r.local?_H:FH)(r,t))},style:function(e,t,r){return arguments.length>1?this.each((null==t?VH:"function"==typeof t?GH:jH)(e,t,r??"")):WH(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?qH:"function"==typeof t?zH:HH)(e,t)):this.node()[e]},classed:function(e,t){var r=YH(e+"");if(arguments.length<2){for(var i=KH(this.node()),n=-1,a=r.length;++n<a;)if(!i.contains(r[n]))return!1;return!0}return this.each(("function"==typeof t?tz:t?ZH:ez)(r,t))},text:function(e){return arguments.length?this.each(null==e?rz:("function"==typeof e?nz:iz)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?az:("function"==typeof e?sz:oz)(e)):this.node().innerHTML},raise:function(){return this.each(cz)},lower:function(){return this.each(uz)},append:function(e){var t="function"==typeof e?e:hH(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function(e,t){var r="function"==typeof e?e:hH(e),i=null==t?lz:"function"==typeof t?t:IH(t);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})},remove:function(){return this.each(dz)},clone:function(e){return this.select(e?mz:pz)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,r){var i,n,a=function(e){return e.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}(e+""),o=a.length;if(!(arguments.length<2)){for(s=t?hz:fz,i=0;i<o;++i)this.each(s(a[i],t,r));return this}var s=this.node().__on;if(s)for(var c,u=0,l=s.length;u<l;++u)for(i=0,c=s[u];i<o;++i)if((n=a[i]).type===c.type&&n.name===c.name)return c.value},dispatch:function(e,t){return this.each(("function"==typeof t?yz:Iz)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i,n=e[t],a=0,o=n.length;a<o;++a)(i=n[a])&&(yield i)}};var Pz=.7,Nz=1/Pz,Ez="\\s*([+-]?\\d+)\\s*",Mz="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Rz="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Az=/^#([0-9a-f]{3,8})$/,Cz=new RegExp(`^rgb\\(${Ez},${Ez},${Ez}\\)$`),kz=new RegExp(`^rgb\\(${Rz},${Rz},${Rz}\\)$`),xz=new RegExp(`^rgba\\(${Ez},${Ez},${Ez},${Mz}\\)$`),Oz=new RegExp(`^rgba\\(${Rz},${Rz},${Rz},${Mz}\\)$`),Fz=new RegExp(`^hsl\\(${Mz},${Rz},${Rz}\\)$`),_z=new RegExp(`^hsla\\(${Mz},${Rz},${Rz},${Mz}\\)$`),Lz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Bz(){return this.rgb().formatHex()}function $z(){return this.rgb().formatRgb()}function Vz(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Az.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?jz(t):3===r?new qz(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?Gz(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?Gz(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Cz.exec(e))?new qz(t[1],t[2],t[3],1):(t=kz.exec(e))?new qz(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=xz.exec(e))?Gz(t[1],t[2],t[3],t[4]):(t=Oz.exec(e))?Gz(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Fz.exec(e))?Qz(t[1],t[2]/100,t[3]/100,1):(t=_z.exec(e))?Qz(t[1],t[2]/100,t[3]/100,t[4]):Lz.hasOwnProperty(e)?jz(Lz[e]):"transparent"===e?new qz(NaN,NaN,NaN,0):null}function jz(e){return new qz(e>>16&255,e>>8&255,255&e,1)}function Gz(e,t,r,i){return i<=0&&(e=t=r=NaN),new qz(e,t,r,i)}function Wz(e,t,r,i){return 1===arguments.length?function(e){return e instanceof Dz||(e=Vz(e)),e?new qz((e=e.rgb()).r,e.g,e.b,e.opacity):new qz}(e):new qz(e,t,r,i??1)}function qz(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}function Hz(){return`#${Xz(this.r)}${Xz(this.g)}${Xz(this.b)}`}function zz(){const e=Yz(this.opacity);return`${1===e?"rgb(":"rgba("}${Kz(this.r)}, ${Kz(this.g)}, ${Kz(this.b)}${1===e?")":`, ${e})`}`}function Yz(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Kz(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Xz(e){return((e=Kz(e))<16?"0":"")+e.toString(16)}function Qz(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Zz(e,t,r,i)}function Jz(e){if(e instanceof Zz)return new Zz(e.h,e.s,e.l,e.opacity);if(e instanceof Dz||(e=Vz(e)),!e)return new Zz;if(e instanceof Zz)return e;var t=(e=e.rgb()).r/255,r=e.g/255,i=e.b/255,n=Math.min(t,r,i),a=Math.max(t,r,i),o=NaN,s=a-n,c=(a+n)/2;return s?(o=t===a?(r-i)/s+6*(r<i):r===a?(i-t)/s+2:(t-r)/s+4,s/=c<.5?a+n:2-a-n,o*=60):s=c>0&&c<1?0:o,new Zz(o,s,c,e.opacity)}function Zz(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}function eY(e){return(e=(e||0)%360)<0?e+360:e}function tY(e){return Math.max(0,Math.min(1,e||0))}function rY(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}wz(Dz,Vz,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Bz,formatHex:Bz,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Jz(this).formatHsl()},formatRgb:$z,toString:$z}),wz(qz,Wz,Tz(Dz,{brighter(e){return e=null==e?Nz:Math.pow(Nz,e),new qz(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Pz:Math.pow(Pz,e),new qz(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new qz(Kz(this.r),Kz(this.g),Kz(this.b),Yz(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Hz,formatHex:Hz,formatHex8:function(){return`#${Xz(this.r)}${Xz(this.g)}${Xz(this.b)}${Xz(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:zz,toString:zz})),wz(Zz,function(e,t,r,i){return 1===arguments.length?Jz(e):new Zz(e,t,r,i??1)},Tz(Dz,{brighter(e){return e=null==e?Nz:Math.pow(Nz,e),new Zz(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Pz:Math.pow(Pz,e),new Zz(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,n=2*r-i;return new qz(rY(e>=240?e-240:e+120,n,i),rY(e,n,i),rY(e<120?e+240:e-120,n,i),this.opacity)},clamp(){return new Zz(eY(this.h),tY(this.s),tY(this.l),Yz(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Yz(this.opacity);return`${1===e?"hsl(":"hsla("}${eY(this.h)}, ${100*tY(this.s)}%, ${100*tY(this.l)}%${1===e?")":`, ${e})`}`}}));const iY=e=>()=>e;function nY(e){return 1==(e=+e)?aY:function(t,r){return r-t?function(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(i){return Math.pow(e+i*t,r)}}(t,r,e):iY(isNaN(t)?r:t)}}function aY(e,t){var r=t-e;return r?function(e,t){return function(r){return e+r*t}}(e,r):iY(isNaN(e)?t:e)}const oY=function e(t){var r=nY(t);function i(e,t){var i=r((e=Wz(e)).r,(t=Wz(t)).r),n=r(e.g,t.g),a=r(e.b,t.b),o=aY(e.opacity,t.opacity);return function(t){return e.r=i(t),e.g=n(t),e.b=a(t),e.opacity=o(t),e+""}}return i.gamma=e,i}(1);function sY(e,t){t||(t=[]);var r,i=e?Math.min(t.length,e.length):0,n=t.slice();return function(a){for(r=0;r<i;++r)n[r]=e[r]*(1-a)+t[r]*a;return n}}function cY(e,t){var r,i=t?t.length:0,n=e?Math.min(i,e.length):0,a=new Array(n),o=new Array(i);for(r=0;r<n;++r)a[r]=hY(e[r],t[r]);for(;r<i;++r)o[r]=t[r];return function(e){for(r=0;r<n;++r)o[r]=a[r](e);return o}}function uY(e,t){var r=new Date;return e=+e,t=+t,function(i){return r.setTime(e*(1-i)+t*i),r}}function lY(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function dY(e,t){var r,i={},n={};for(r in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)r in e?i[r]=hY(e[r],t[r]):n[r]=t[r];return function(e){for(r in i)n[r]=i[r](e);return n}}var pY=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,mY=new RegExp(pY.source,"g");function fY(e,t){var r,i,n,a=pY.lastIndex=mY.lastIndex=0,o=-1,s=[],c=[];for(e+="",t+="";(r=pY.exec(e))&&(i=mY.exec(t));)(n=i.index)>a&&(n=t.slice(a,n),s[o]?s[o]+=n:s[++o]=n),(r=r[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,c.push({i:o,x:lY(r,i)})),a=mY.lastIndex;return a<t.length&&(n=t.slice(a),s[o]?s[o]+=n:s[++o]=n),s.length<2?c[0]?function(e){return function(t){return e(t)+""}}(c[0].x):function(e){return function(){return e}}(t):(t=c.length,function(e){for(var r,i=0;i<t;++i)s[(r=c[i]).i]=r.x(e);return s.join("")})}function hY(e,t){var r,i=typeof t;return null==t||"boolean"===i?iY(t):("number"===i?lY:"string"===i?(r=Vz(t))?(t=r,oY):fY:t instanceof Vz?oY:t instanceof Date?uY:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?sY:Array.isArray(t)?cY:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?dY:lY)(e,t)}function gY(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}var IY,yY=180/Math.PI,vY={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function SY(e,t,r,i,n,a){var o,s,c;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(c=e*r+t*i)&&(r-=e*c,i-=t*c),(s=Math.sqrt(r*r+i*i))&&(r/=s,i/=s,c/=s),e*i<t*r&&(e=-e,t=-t,c=-c,o=-o),{translateX:n,translateY:a,rotate:Math.atan2(t,e)*yY,skewX:Math.atan(c)*yY,scaleX:o,scaleY:s}}function bY(e,t,r,i){function n(e){return e.length?e.pop()+" ":""}return function(a,o){var s=[],c=[];return a=e(a),o=e(o),function(e,i,n,a,o,s){if(e!==n||i!==a){var c=o.push("translate(",null,t,null,r);s.push({i:c-4,x:lY(e,n)},{i:c-2,x:lY(i,a)})}else(n||a)&&o.push("translate("+n+t+a+r)}(a.translateX,a.translateY,o.translateX,o.translateY,s,c),function(e,t,r,a){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),a.push({i:r.push(n(r)+"rotate(",null,i)-2,x:lY(e,t)})):t&&r.push(n(r)+"rotate("+t+i)}(a.rotate,o.rotate,s,c),function(e,t,r,a){e!==t?a.push({i:r.push(n(r)+"skewX(",null,i)-2,x:lY(e,t)}):t&&r.push(n(r)+"skewX("+t+i)}(a.skewX,o.skewX,s,c),function(e,t,r,i,a,o){if(e!==r||t!==i){var s=a.push(n(a)+"scale(",null,",",null,")");o.push({i:s-4,x:lY(e,r)},{i:s-2,x:lY(t,i)})}else(1!==r||1!==i)&&a.push(n(a)+"scale("+r+","+i+")")}(a.scaleX,a.scaleY,o.scaleX,o.scaleY,s,c),a=o=null,function(e){for(var t,r=-1,i=c.length;++r<i;)s[(t=c[r]).i]=t.x(e);return s.join("")}}}var UY,wY,TY=bY(function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?vY:SY(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),DY=bY(function(e){return null!=e&&(IY||(IY=document.createElementNS("http://www.w3.org/2000/svg","g")),IY.setAttribute("transform",e),e=IY.transform.baseVal.consolidate())?SY((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):vY},", ",")",")"),PY=0,NY=0,EY=0,MY=0,RY=0,AY=0,CY="object"==typeof performance&&performance.now?performance:Date,kY="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function xY(){return RY||(kY(OY),RY=CY.now()+AY)}function OY(){RY=0}function FY(){this._call=this._time=this._next=null}function _Y(e,t,r){var i=new FY;return i.restart(e,t,r),i}function LY(){RY=(MY=CY.now())+AY,PY=NY=0;try{!function(){xY(),++PY;for(var e,t=UY;t;)(e=RY-t._time)>=0&&t._call.call(void 0,e),t=t._next;--PY}()}finally{PY=0,function(){for(var e,t,r=UY,i=1/0;r;)r._call?(i>r._time&&(i=r._time),e=r,r=r._next):(t=r._next,r._next=null,r=e?e._next=t:UY=t);wY=e,$Y(i)}(),RY=0}}function BY(){var e=CY.now(),t=e-MY;t>1e3&&(AY-=t,MY=e)}function $Y(e){PY||(NY&&(NY=clearTimeout(NY)),e-RY>24?(e<1/0&&(NY=setTimeout(LY,e-CY.now()-AY)),EY&&(EY=clearInterval(EY))):(EY||(MY=CY.now(),EY=setInterval(BY,1e3)),PY=1,kY(LY)))}function VY(e,t,r){var i=new FY;return t=null==t?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,r),i}FY.prototype=_Y.prototype={constructor:FY,restart:function(e,t,r){if("function"!=typeof e)throw new TypeError("callback is not a function");r=(null==r?xY():+r)+(null==t?0:+t),!this._next&&wY!==this&&(wY?wY._next=this:UY=this,wY=this),this._call=e,this._time=r,$Y()},stop:function(){this._call&&(this._call=null,this._time=1/0,$Y())}};var jY=oH("start","end","cancel","interrupt"),GY=[];function WY(e,t,r,i,n,a){var o=e.__transition;if(o){if(r in o)return}else e.__transition={};!function(e,t,r){var i,n=e.__transition;function a(e){r.state=1,r.timer.restart(o,r.delay,r.time),r.delay<=e&&o(e-r.delay)}function o(a){var u,l,d,p;if(1!==r.state)return c();for(u in n)if((p=n[u]).name===r.name){if(3===p.state)return VY(o);4===p.state?(p.state=6,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete n[u]):+u<t&&(p.state=6,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete n[u])}if(VY(function(){3===r.state&&(r.state=4,r.timer.restart(s,r.delay,r.time),s(a))}),r.state=2,r.on.call("start",e,e.__data__,r.index,r.group),2===r.state){for(r.state=3,i=new Array(d=r.tween.length),u=0,l=-1;u<d;++u)(p=r.tween[u].value.call(e,e.__data__,r.index,r.group))&&(i[++l]=p);i.length=l+1}}function s(t){for(var n=t<r.duration?r.ease.call(null,t/r.duration):(r.timer.restart(c),r.state=5,1),a=-1,o=i.length;++a<o;)i[a].call(e,n);5===r.state&&(r.on.call("end",e,e.__data__,r.index,r.group),c())}function c(){for(var i in r.state=6,r.timer.stop(),delete n[t],n)return;delete e.__transition}n[t]=r,r.timer=_Y(a,0,r.time)}(e,r,{name:t,index:i,group:n,on:jY,tween:GY,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:0})}function qY(e,t){var r=zY(e,t);if(r.state>0)throw new Error("too late; already scheduled");return r}function HY(e,t){var r=zY(e,t);if(r.state>3)throw new Error("too late; already running");return r}function zY(e,t){var r=e.__transition;if(!r||!(r=r[t]))throw new Error("transition not found");return r}function YY(e,t){var r,i;return function(){var n=HY(this,e),a=n.tween;if(a!==r)for(var o=0,s=(i=r=a).length;o<s;++o)if(i[o].name===t){(i=i.slice()).splice(o,1);break}n.tween=i}}function KY(e,t,r){var i,n;if("function"!=typeof r)throw new Error;return function(){var a=HY(this,e),o=a.tween;if(o!==i){n=(i=o).slice();for(var s={name:t,value:r},c=0,u=n.length;c<u;++c)if(n[c].name===t){n[c]=s;break}c===u&&n.push(s)}a.tween=n}}function XY(e,t,r){var i=e._id;return e.each(function(){var e=HY(this,i);(e.value||(e.value={}))[t]=r.apply(this,arguments)}),function(e){return zY(e,i).value[t]}}function QY(e,t){var r;return("number"==typeof t?lY:t instanceof Vz?oY:(r=Vz(t))?(t=r,oY):fY)(e,t)}function JY(e){return function(){this.removeAttribute(e)}}function ZY(e){return function(){this.removeAttributeNS(e.space,e.local)}}function eK(e,t,r){var i,n,a=r+"";return function(){var o=this.getAttribute(e);return o===a?null:o===i?n:n=t(i=o,r)}}function tK(e,t,r){var i,n,a=r+"";return function(){var o=this.getAttributeNS(e.space,e.local);return o===a?null:o===i?n:n=t(i=o,r)}}function rK(e,t,r){var i,n,a;return function(){var o,s,c=r(this);return null==c?void this.removeAttribute(e):(o=this.getAttribute(e))===(s=c+"")?null:o===i&&s===n?a:(n=s,a=t(i=o,c))}}function iK(e,t,r){var i,n,a;return function(){var o,s,c=r(this);return null==c?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local))===(s=c+"")?null:o===i&&s===n?a:(n=s,a=t(i=o,c))}}function nK(e,t){var r,i;function n(){var n=t.apply(this,arguments);return n!==i&&(r=(i=n)&&function(e,t){return function(r){this.setAttributeNS(e.space,e.local,t.call(this,r))}}(e,n)),r}return n._value=t,n}function aK(e,t){var r,i;function n(){var n=t.apply(this,arguments);return n!==i&&(r=(i=n)&&function(e,t){return function(r){this.setAttribute(e,t.call(this,r))}}(e,n)),r}return n._value=t,n}function oK(e,t){return function(){qY(this,e).delay=+t.apply(this,arguments)}}function sK(e,t){return t=+t,function(){qY(this,e).delay=t}}function cK(e,t){return function(){HY(this,e).duration=+t.apply(this,arguments)}}function uK(e,t){return t=+t,function(){HY(this,e).duration=t}}var lK=bz.prototype.constructor;function dK(e){return function(){this.style.removeProperty(e)}}var pK=0;function mK(e,t,r,i){this._groups=e,this._parents=t,this._name=r,this._id=i}function fK(){return++pK}var hK=bz.prototype;mK.prototype={constructor:mK,select:function(e){var t=this._name,r=this._id;"function"!=typeof e&&(e=IH(e));for(var i=this._groups,n=i.length,a=new Array(n),o=0;o<n;++o)for(var s,c,u=i[o],l=u.length,d=a[o]=new Array(l),p=0;p<l;++p)(s=u[p])&&(c=e.call(s,s.__data__,p,u))&&("__data__"in s&&(c.__data__=s.__data__),d[p]=c,WY(d[p],t,r,p,d,zY(s,r)));return new mK(a,this._parents,t,r)},selectAll:function(e){var t=this._name,r=this._id;"function"!=typeof e&&(e=vH(e));for(var i=this._groups,n=i.length,a=[],o=[],s=0;s<n;++s)for(var c,u=i[s],l=u.length,d=0;d<l;++d)if(c=u[d]){for(var p,m=e.call(c,c.__data__,d,u),f=zY(c,r),h=0,g=m.length;h<g;++h)(p=m[h])&&WY(p,t,r,h,m,f);a.push(m),o.push(c)}return new mK(a,o,t,r)},selectChild:hK.selectChild,selectChildren:hK.selectChildren,filter:function(e){"function"!=typeof e&&(e=bH(e));for(var t=this._groups,r=t.length,i=new Array(r),n=0;n<r;++n)for(var a,o=t[n],s=o.length,c=i[n]=[],u=0;u<s;++u)(a=o[u])&&e.call(a,a.__data__,u,o)&&c.push(a);return new mK(i,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,r=e._groups,i=t.length,n=r.length,a=Math.min(i,n),o=new Array(i),s=0;s<a;++s)for(var c,u=t[s],l=r[s],d=u.length,p=o[s]=new Array(d),m=0;m<d;++m)(c=u[m]||l[m])&&(p[m]=c);for(;s<i;++s)o[s]=t[s];return new mK(o,this._parents,this._name,this._id)},selection:function(){return new lK(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,r=fK(),i=this._groups,n=i.length,a=0;a<n;++a)for(var o,s=i[a],c=s.length,u=0;u<c;++u)if(o=s[u]){var l=zY(o,t);WY(o,e,r,u,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new mK(i,this._parents,e,r)},call:hK.call,nodes:hK.nodes,node:hK.node,size:hK.size,empty:hK.empty,each:hK.each,on:function(e,t){var r=this._id;return arguments.length<2?zY(this.node(),r).on.on(e):this.each(function(e,t,r){var i,n,a=function(e){return(e+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e})}(t)?qY:HY;return function(){var o=a(this,e),s=o.on;s!==i&&(n=(i=s).copy()).on(t,r),o.on=n}}(r,e,t))},attr:function(e,t){var r=pH(e),i="transform"===r?DY:QY;return this.attrTween(e,"function"==typeof t?(r.local?iK:rK)(r,i,XY(this,"attr."+e,t)):null==t?(r.local?ZY:JY)(r):(r.local?tK:eK)(r,i,t))},attrTween:function(e,t){var r="attr."+e;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;var i=pH(e);return this.tween(r,(i.local?nK:aK)(i,t))},style:function(e,t,r){var i="transform"==(e+="")?TY:QY;return null==t?this.styleTween(e,function(e,t){var r,i,n;return function(){var a=WH(this,e),o=(this.style.removeProperty(e),WH(this,e));return a===o?null:a===r&&o===i?n:n=t(r=a,i=o)}}(e,i)).on("end.style."+e,dK(e)):"function"==typeof t?this.styleTween(e,function(e,t,r){var i,n,a;return function(){var o=WH(this,e),s=r(this),c=s+"";return null==s&&(this.style.removeProperty(e),c=s=WH(this,e)),o===c?null:o===i&&c===n?a:(n=c,a=t(i=o,s))}}(e,i,XY(this,"style."+e,t))).each(function(e,t){var r,i,n,a,o="style."+t,s="end."+o;return function(){var c=HY(this,e),u=c.on,l=null==c.value[o]?a||(a=dK(t)):void 0;(u!==r||n!==l)&&(i=(r=u).copy()).on(s,n=l),c.on=i}}(this._id,e)):this.styleTween(e,function(e,t,r){var i,n,a=r+"";return function(){var o=WH(this,e);return o===a?null:o===i?n:n=t(i=o,r)}}(e,i,t),r).on("end.style."+e,null)},styleTween:function(e,t,r){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(null==t)return this.tween(i,null);if("function"!=typeof t)throw new Error;return this.tween(i,function(e,t,r){var i,n;function a(){var a=t.apply(this,arguments);return a!==n&&(i=(n=a)&&function(e,t,r){return function(i){this.style.setProperty(e,t.call(this,i),r)}}(e,a,r)),i}return a._value=t,a}(e,t,r??""))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=t??""}}(XY(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,r;function i(){var i=e.apply(this,arguments);return i!==r&&(t=(r=i)&&function(e){return function(t){this.textContent=e.call(this,t)}}(i)),t}return i._value=e,i}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var r in this.__transition)if(+r!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var r=this._id;if(e+="",arguments.length<2){for(var i,n=zY(this.node(),r).tween,a=0,o=n.length;a<o;++a)if((i=n[a]).name===e)return i.value;return null}return this.each((null==t?YY:KY)(r,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?oK:sK)(t,e)):zY(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?cK:uK)(t,e)):zY(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){HY(this,e).ease=t}}(t,e)):zY(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var r=t.apply(this,arguments);if("function"!=typeof r)throw new Error;HY(this,e).ease=r}}(this._id,e))},end:function(){var e,t,r=this,i=r._id,n=r.size();return new Promise(function(a,o){var s={value:o},c={value:function(){0===--n&&a()}};r.each(function(){var r=HY(this,i),n=r.on;n!==e&&((t=(e=n).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(c)),r.on=t}),0===n&&a()})},[Symbol.iterator]:hK[Symbol.iterator]};var gK={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function IK(e,t){for(var r;!(r=e.__transition)||!(r=r[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return r}bz.prototype.interrupt=function(e){return this.each(function(){!function(e,t){var r,i,n,a=e.__transition,o=!0;if(a){for(n in t=null==t?null:t+"",a)(r=a[n]).name===t?(i=r.state>2&&r.state<5,r.state=6,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete a[n]):o=!1;o&&delete e.__transition}}(this,e)})},bz.prototype.transition=function(e){var t,r;e instanceof mK?(t=e._id,e=e._name):(t=fK(),(r=gK).time=xY(),e=null==e?null:e+"");for(var i=this._groups,n=i.length,a=0;a<n;++a)for(var o,s=i[a],c=s.length,u=0;u<c;++u)(o=s[u])&&WY(o,e,t,u,s,r||IK(o,t));return new mK(i,this._parents,e,t)};const yK=Math.PI,vK=2*yK,SK=1e-6,bK=vK-SK;function UK(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}class wK{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?UK:function(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return UK;const r=10**t;return function(e){this._+=e[0];for(let t=1,i=e.length;t<i;++t)this._+=Math.round(arguments[t]*r)/r+e[t]}}(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,r,i){this._append`Q${+e},${+t},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,t,r,i,n,a){this._append`C${+e},${+t},${+r},${+i},${this._x1=+n},${this._y1=+a}`}arcTo(e,t,r,i,n){if(e=+e,t=+t,r=+r,i=+i,(n=+n)<0)throw new Error(`negative radius: ${n}`);let a=this._x1,o=this._y1,s=r-e,c=i-t,u=a-e,l=o-t,d=u*u+l*l;if(null===this._x1)this._append`M${this._x1=e},${this._y1=t}`;else if(d>SK)if(Math.abs(l*s-c*u)>SK&&n){let p=r-a,m=i-o,f=s*s+c*c,h=p*p+m*m,g=Math.sqrt(f),I=Math.sqrt(d),y=n*Math.tan((yK-Math.acos((f+d-h)/(2*g*I)))/2),v=y/I,S=y/g;Math.abs(v-1)>SK&&this._append`L${e+v*u},${t+v*l}`,this._append`A${n},${n},0,0,${+(l*p>u*m)},${this._x1=e+S*s},${this._y1=t+S*c}`}else this._append`L${this._x1=e},${this._y1=t}`}arc(e,t,r,i,n,a){if(e=+e,t=+t,a=!!a,(r=+r)<0)throw new Error(`negative radius: ${r}`);let o=r*Math.cos(i),s=r*Math.sin(i),c=e+o,u=t+s,l=1^a,d=a?i-n:n-i;null===this._x1?this._append`M${c},${u}`:(Math.abs(this._x1-c)>SK||Math.abs(this._y1-u)>SK)&&this._append`L${c},${u}`,r&&(d<0&&(d=d%vK+vK),d>bK?this._append`A${r},${r},0,1,${l},${e-o},${t-s}A${r},${r},0,1,${l},${this._x1=c},${this._y1=u}`:d>SK&&this._append`A${r},${r},0,${+(d>=yK)},${l},${this._x1=e+r*Math.cos(n)},${this._y1=t+r*Math.sin(n)}`)}rect(e,t,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function TK(e,t){if(!isFinite(e)||0===e)return null;var r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"),i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function DK(e){return(e=TK(Math.abs(e)))?e[1]:NaN}var PK,NK=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function EK(e){if(!(t=NK.exec(e)))throw new Error("invalid format: "+e);var t;return new MK({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function MK(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function RK(e,t){var r=TK(e,t);if(!r)return e+"";var i=r[0],n=r[1];return n<0?"0."+new Array(-n).join("0")+i:i.length>n+1?i.slice(0,n+1)+"."+i.slice(n+1):i+new Array(n-i.length+2).join("0")}EK.prototype=MK.prototype,MK.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const AK={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>RK(100*e,t),r:RK,s:function(e,t){var r=TK(e,t);if(!r)return PK=void 0,e.toPrecision(t);var i=r[0],n=r[1],a=n-(PK=3*Math.max(-8,Math.min(8,Math.floor(n/3))))+1,o=i.length;return a===o?i:a>o?i+new Array(a-o+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+TK(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function CK(e){return e}var kK,xK,OK,FK=Array.prototype.map,_K=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function LK(e){var t=void 0===e.grouping||void 0===e.thousands?CK:function(e,t){return function(r,i){for(var n=r.length,a=[],o=0,s=e[0],c=0;n>0&&s>0&&(c+s+1>i&&(s=Math.max(1,i-c)),a.push(r.substring(n-=s,n+s)),!((c+=s+1)>i));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}(FK.call(e.grouping,Number),e.thousands+""),r=void 0===e.currency?"":e.currency[0]+"",i=void 0===e.currency?"":e.currency[1]+"",n=void 0===e.decimal?".":e.decimal+"",a=void 0===e.numerals?CK:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(FK.call(e.numerals,String)),o=void 0===e.percent?"%":e.percent+"",s=void 0===e.minus?"\u2212":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function u(e,u){var l=(e=EK(e)).fill,d=e.align,p=e.sign,m=e.symbol,f=e.zero,h=e.width,g=e.comma,I=e.precision,y=e.trim,v=e.type;"n"===v?(g=!0,v="g"):AK[v]||(void 0===I&&(I=12),y=!0,v="g"),(f||"0"===l&&"="===d)&&(f=!0,l="0",d="=");var S=(u&&void 0!==u.prefix?u.prefix:"")+("$"===m?r:"#"===m&&/[boxX]/.test(v)?"0"+v.toLowerCase():""),b=("$"===m?i:/[%p]/.test(v)?o:"")+(u&&void 0!==u.suffix?u.suffix:""),U=AK[v],w=/[defgprs%]/.test(v);function T(e){var r,i,o,u=S,m=b;if("c"===v)m=U(e)+m,e="";else{var T=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:U(Math.abs(e),I),y&&(e=function(e){e:for(var t,r=e.length,i=1,n=-1;i<r;++i)switch(e[i]){case".":n=t=i;break;case"0":0===n&&(n=i),t=i;break;default:if(!+e[i])break e;n>0&&(n=0)}return n>0?e.slice(0,n)+e.slice(t+1):e}(e)),T&&0==+e&&"+"!==p&&(T=!1),u=(T?"("===p?p:s:"-"===p||"("===p?"":p)+u,m=("s"!==v||isNaN(e)||void 0===PK?"":_K[8+PK/3])+m+(T&&"("===p?")":""),w)for(r=-1,i=e.length;++r<i;)if(48>(o=e.charCodeAt(r))||o>57){m=(46===o?n+e.slice(r+1):e.slice(r))+m,e=e.slice(0,r);break}}g&&!f&&(e=t(e,1/0));var D=u.length+e.length+m.length,P=D<h?new Array(h-D+1).join(l):"";switch(g&&f&&(e=t(P+e,P.length?h-m.length:1/0),P=""),d){case"<":e=u+e+m+P;break;case"=":e=u+P+e+m;break;case"^":e=P.slice(0,D=P.length>>1)+u+e+m+P.slice(D);break;default:e=P+u+e+m}return a(e)}return I=void 0===I?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,I)):Math.max(0,Math.min(20,I)),T.toString=function(){return e+""},T}return{format:u,formatPrefix:function(e,t){var r=3*Math.max(-8,Math.min(8,Math.floor(DK(t)/3))),i=Math.pow(10,-r),n=u(((e=EK(e)).type="f",e),{suffix:_K[8+r/3]});return function(e){return n(i*e)}}}}function BK(e){var t=0,r=e.children,i=r&&r.length;if(i)for(;--i>=0;)t+=r[i].value;else t=1;e.value=t}function $K(e,t){e instanceof Map?(e=[void 0,e],void 0===t&&(t=jK)):void 0===t&&(t=VK);for(var r,i,n,a,o,s=new qK(e),c=[s];r=c.pop();)if((n=t(r.data))&&(o=(n=Array.from(n)).length))for(r.children=n,a=o-1;a>=0;--a)c.push(i=n[a]=new qK(n[a])),i.parent=r,i.depth=r.depth+1;return s.eachBefore(WK)}function VK(e){return e.children}function jK(e){return Array.isArray(e)?e[1]:null}function GK(e){void 0!==e.data.value&&(e.value=e.data.value),e.data=e.data.data}function WK(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function qK(e){this.data=e,this.depth=this.height=0,this.parent=null}function HK(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function zK(){var e=1,t=1,r=0,i=!1;function n(n){var a=n.height+1;return n.x0=n.y0=r,n.x1=e,n.y1=t/a,n.eachBefore(function(e,t){return function(i){i.children&&function(e,t,r,i,n){for(var a,o=e.children,s=-1,c=o.length,u=e.value&&(i-t)/e.value;++s<c;)(a=o[s]).y0=r,a.y1=n,a.x0=t,a.x1=t+=a.value*u}(i,i.x0,e*(i.depth+1)/t,i.x1,e*(i.depth+2)/t);var n=i.x0,a=i.y0,o=i.x1-r,s=i.y1-r;o<n&&(n=o=(n+o)/2),s<a&&(a=s=(a+s)/2),i.x0=n,i.y0=a,i.x1=o,i.y1=s}}(t,a)),i&&n.eachBefore(HK),n}return n.round=function(e){return arguments.length?(i=!!e,n):i},n.size=function(r){return arguments.length?(e=+r[0],t=+r[1],n):[e,t]},n.padding=function(e){return arguments.length?(r=+e,n):r},n}function YK(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function KK(e){return+e}!function(e){kK=LK(e),xK=kK.format,OK=kK.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]}),qK.prototype=$K.prototype={constructor:qK,count:function(){return this.eachAfter(BK)},each:function(e,t){let r=-1;for(const i of this)e.call(t,i,++r,this);return this},eachAfter:function(e,t){for(var r,i,n,a=this,o=[a],s=[],c=-1;a=o.pop();)if(s.push(a),r=a.children)for(i=0,n=r.length;i<n;++i)o.push(r[i]);for(;a=s.pop();)e.call(t,a,++c,this);return this},eachBefore:function(e,t){for(var r,i,n=this,a=[n],o=-1;n=a.pop();)if(e.call(t,n,++o,this),r=n.children)for(i=r.length-1;i>=0;--i)a.push(r[i]);return this},find:function(e,t){let r=-1;for(const i of this)if(e.call(t,i,++r,this))return i},sum:function(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,i=t.children,n=i&&i.length;--n>=0;)r+=i[n].value;t.value=r})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var t=this,r=function(e,t){if(e===t)return e;var r=e.ancestors(),i=t.ancestors(),n=null;for(e=r.pop(),t=i.pop();e===t;)n=e,e=r.pop(),t=i.pop();return n}(t,e),i=[t];t!==r;)t=t.parent,i.push(t);for(var n=i.length;e!==r;)i.splice(n,0,e),e=e.parent;return i},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){return Array.from(this)},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t},copy:function(){return $K(this).eachBefore(GK)},[Symbol.iterator]:function*(){var e,t,r,i,n=this,a=[n];do{for(e=a.reverse(),a=[];n=e.pop();)if(yield n,t=n.children)for(r=0,i=t.length;r<i;++r)a.push(t[r])}while(a.length)}};var XK=[0,1];function QK(e){return e}function JK(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:function(e){return function(){return e}}(isNaN(t)?NaN:.5)}function ZK(e,t,r){var i=e[0],n=e[1],a=t[0],o=t[1];return n<i?(i=JK(n,i),a=r(o,a)):(i=JK(i,n),a=r(a,o)),function(e){return a(i(e))}}function eX(e,t,r){var i=Math.min(e.length,t.length)-1,n=new Array(i),a=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)n[o]=JK(e[o],e[o+1]),a[o]=r(t[o],t[o+1]);return function(t){var r=Jq(e,t,1,i)-1;return a[r](n[r](t))}}function tX(){var e,t,r,i,n,a,o=XK,s=XK,c=hY,u=QK;function l(){var e=Math.min(o.length,s.length);return u!==QK&&(u=function(e,t){var r;return e>t&&(r=e,e=t,t=r),function(r){return Math.max(e,Math.min(t,r))}}(o[0],o[e-1])),i=e>2?eX:ZK,n=a=null,d}function d(t){return null==t||isNaN(t=+t)?r:(n||(n=i(o.map(e),s,c)))(e(u(t)))}return d.invert=function(r){return u(t((a||(a=i(s,o.map(e),lY)))(r)))},d.domain=function(e){return arguments.length?(o=Array.from(e,KK),l()):o.slice()},d.range=function(e){return arguments.length?(s=Array.from(e),l()):s.slice()},d.rangeRound=function(e){return s=Array.from(e),c=gY,l()},d.clamp=function(e){return arguments.length?(u=!!e||QK,l()):u!==QK},d.interpolate=function(e){return arguments.length?(c=e,l()):c},d.unknown=function(e){return arguments.length?(r=e,d):r},function(r,i){return e=r,t=i,l()}}function rX(e,t,r,i){var n,a=function(e,t,r){r=+r;const i=(t=+t)<(e=+e),n=i?iH(t,e,r):iH(e,t,r);return(i?-1:1)*(n<0?1/-n:n)}(e,t,r);switch((i=EK(i??",f")).type){case"s":var o=Math.max(Math.abs(e),Math.abs(t));return null==i.precision&&!isNaN(n=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(DK(t)/3)))-DK(Math.abs(e)))}(a,o))&&(i.precision=n),OK(i,o);case"":case"e":case"g":case"p":case"r":null==i.precision&&!isNaN(n=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,DK(t)-DK(e))+1}(a,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=n-("e"===i.type));break;case"f":case"%":null==i.precision&&!isNaN(n=function(e){return Math.max(0,-DK(Math.abs(e)))}(a))&&(i.precision=n-2*("%"===i.type))}return xK(i)}function iX(e){var t=e.domain;return e.ticks=function(e){var r=t();return function(e,t,r){if(!((r=+r)>0))return[];if((e=+e)===(t=+t))return[e];const i=t<e,[n,a,o]=i?rH(t,e,r):rH(e,t,r);if(!(a>=n))return[];const s=a-n+1,c=new Array(s);if(i)if(o<0)for(let u=0;u<s;++u)c[u]=(a-u)/-o;else for(let u=0;u<s;++u)c[u]=(a-u)*o;else if(o<0)for(let u=0;u<s;++u)c[u]=(n+u)/-o;else for(let u=0;u<s;++u)c[u]=(n+u)*o;return c}(r[0],r[r.length-1],e??10)},e.tickFormat=function(e,r){var i=t();return rX(i[0],i[i.length-1],e??10,r)},e.nice=function(r){null==r&&(r=10);var i,n,a=t(),o=0,s=a.length-1,c=a[o],u=a[s],l=10;for(u<c&&(n=c,c=u,u=n,n=o,o=s,s=n);l-- >0;){if((n=iH(c,u,r))===i)return a[o]=c,a[s]=u,t(a);if(n>0)c=Math.floor(c/n)*n,u=Math.ceil(u/n)*n;else{if(!(n<0))break;c=Math.ceil(c*n)/n,u=Math.floor(u*n)/n}i=n}return e},e}function nX(){var e=tX()(QK,QK);return e.copy=function(){return function(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}(e,nX())},YK.apply(e,arguments),iX(e)}function aX(e){return function(){return e}}const oX=Math.abs,sX=Math.atan2,cX=Math.cos,uX=Math.max,lX=Math.min,dX=Math.sin,pX=Math.sqrt,mX=1e-12,fX=Math.PI,hX=fX/2,gX=2*fX;function IX(e){return e>=1?hX:e<=-1?-hX:Math.asin(e)}function yX(e){return e.innerRadius}function vX(e){return e.outerRadius}function SX(e){return e.startAngle}function bX(e){return e.endAngle}function UX(e){return e&&e.padAngle}function wX(e,t,r,i,n,a,o){var s=e-r,c=t-i,u=(o?a:-a)/pX(s*s+c*c),l=u*c,d=-u*s,p=e+l,m=t+d,f=r+l,h=i+d,g=(p+f)/2,I=(m+h)/2,y=f-p,v=h-m,S=y*y+v*v,b=n-a,U=p*h-f*m,w=(v<0?-1:1)*pX(uX(0,b*b*S-U*U)),T=(U*v-y*w)/S,D=(-U*y-v*w)/S,P=(U*v+y*w)/S,N=(-U*y+v*w)/S,E=T-g,M=D-I,R=P-g,A=N-I;return E*E+M*M>R*R+A*A&&(T=P,D=N),{cx:T,cy:D,x01:-l,y01:-d,x11:T*(n/b-1),y11:D*(n/b-1)}}function TX(){var e=yX,t=vX,r=aX(0),i=null,n=SX,a=bX,o=UX,s=null,c=function(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(null==r)t=null;else{const e=Math.floor(r);if(!(e>=0))throw new RangeError(`invalid digits: ${r}`);t=e}return e},()=>new wK(t)}(u);function u(){var u,l,d=+e.apply(this,arguments),p=+t.apply(this,arguments),m=n.apply(this,arguments)-hX,f=a.apply(this,arguments)-hX,h=oX(f-m),g=f>m;if(s||(s=u=c()),p<d&&(l=p,p=d,d=l),p>mX)if(h>gX-mX)s.moveTo(p*cX(m),p*dX(m)),s.arc(0,0,p,m,f,!g),d>mX&&(s.moveTo(d*cX(f),d*dX(f)),s.arc(0,0,d,f,m,g));else{var I,y,v=m,S=f,b=m,U=f,w=h,T=h,D=o.apply(this,arguments)/2,P=D>mX&&(i?+i.apply(this,arguments):pX(d*d+p*p)),N=lX(oX(p-d)/2,+r.apply(this,arguments)),E=N,M=N;if(P>mX){var R=IX(P/d*dX(D)),A=IX(P/p*dX(D));(w-=2*R)>mX?(b+=R*=g?1:-1,U-=R):(w=0,b=U=(m+f)/2),(T-=2*A)>mX?(v+=A*=g?1:-1,S-=A):(T=0,v=S=(m+f)/2)}var C=p*cX(v),k=p*dX(v),x=d*cX(U),O=d*dX(U);if(N>mX){var F,_=p*cX(S),L=p*dX(S),B=d*cX(b),$=d*dX(b);if(h<fX)if(F=function(e,t,r,i,n,a,o,s){var c=r-e,u=i-t,l=o-n,d=s-a,p=d*c-l*u;if(!(p*p<mX))return[e+(p=(l*(t-a)-d*(e-n))/p)*c,t+p*u]}(C,k,B,$,_,L,x,O)){var V=C-F[0],j=k-F[1],G=_-F[0],W=L-F[1],q=1/dX(function(e){return e>1?0:e<-1?fX:Math.acos(e)}((V*G+j*W)/(pX(V*V+j*j)*pX(G*G+W*W)))/2),H=pX(F[0]*F[0]+F[1]*F[1]);E=lX(N,(d-H)/(q-1)),M=lX(N,(p-H)/(q+1))}else E=M=0}T>mX?M>mX?(I=wX(B,$,C,k,p,M,g),y=wX(_,L,x,O,p,M,g),s.moveTo(I.cx+I.x01,I.cy+I.y01),M<N?s.arc(I.cx,I.cy,M,sX(I.y01,I.x01),sX(y.y01,y.x01),!g):(s.arc(I.cx,I.cy,M,sX(I.y01,I.x01),sX(I.y11,I.x11),!g),s.arc(0,0,p,sX(I.cy+I.y11,I.cx+I.x11),sX(y.cy+y.y11,y.cx+y.x11),!g),s.arc(y.cx,y.cy,M,sX(y.y11,y.x11),sX(y.y01,y.x01),!g))):(s.moveTo(C,k),s.arc(0,0,p,v,S,!g)):s.moveTo(C,k),d>mX&&w>mX?E>mX?(I=wX(x,O,_,L,d,-E,g),y=wX(C,k,B,$,d,-E,g),s.lineTo(I.cx+I.x01,I.cy+I.y01),E<N?s.arc(I.cx,I.cy,E,sX(I.y01,I.x01),sX(y.y01,y.x01),!g):(s.arc(I.cx,I.cy,E,sX(I.y01,I.x01),sX(I.y11,I.x11),!g),s.arc(0,0,d,sX(I.cy+I.y11,I.cx+I.x11),sX(y.cy+y.y11,y.cx+y.x11),g),s.arc(y.cx,y.cy,E,sX(y.y11,y.x11),sX(y.y01,y.x01),!g))):s.arc(0,0,d,U,b,g):s.lineTo(x,O)}else s.moveTo(0,0);if(s.closePath(),u)return s=null,u+""||null}return u.centroid=function(){var r=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,i=(+n.apply(this,arguments)+ +a.apply(this,arguments))/2-fX/2;return[cX(i)*r,dX(i)*r]},u.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:aX(+t),u):e},u.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:aX(+e),u):t},u.cornerRadius=function(e){return arguments.length?(r="function"==typeof e?e:aX(+e),u):r},u.padRadius=function(e){return arguments.length?(i=null==e?null:"function"==typeof e?e:aX(+e),u):i},u.startAngle=function(e){return arguments.length?(n="function"==typeof e?e:aX(+e),u):n},u.endAngle=function(e){return arguments.length?(a="function"==typeof e?e:aX(+e),u):a},u.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:aX(+e),u):o},u.context=function(e){return arguments.length?(s=e??null,u):s},u}function DX(e,t,r){this.k=e,this.x=t,this.y=r}DX.prototype={constructor:DX,scale:function(e){return 1===e?this:new DX(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new DX(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},DX.prototype;const PX="text-anchor",NX="dominant-baseline",EX="fill-opacity",MX=Object.assign({},...pL.countries.filter(e=>e.ioc).map(e=>({[e.ioc]:e.iso2})),...pL.countries.filter(e=>e.iso).map(e=>({[e.iso]:e.iso2})));function RX(e){const t=Math.floor(e.length/2);return[...e.slice(0,t),...e.slice(t).reverse()]}function AX(e){if(e)switch(e){case"WILDCARD":return"WC";case"QUALIFIER":return"Q";case"LUCKY_LOSER":return"LL";default:return e}}function CX(e,t,r,i){return e.map((e,n)=>{const a=2*n,o=[t[a],t[a+1]].filter(Boolean),{winnerName:s,winnerSide:c,winnerLookup:u}=function(e,t){const r=void 0!==e.winningSide&&null!==e.winningSide?e.sides.find(t=>t.sideNumber===e.winningSide):void 0,i=r?.participantName;return{winnerName:i,winnerSide:r,winnerLookup:i?t.get(i):void 0}}(e,i);return{name:s||"",participantName:s,drawPosition:u?.drawPosition??c?.drawPosition,seedNumber:c?.seedNumber??u?.seedNumber,entryStatus:AX(c?.entryStatus)??u?.entryStatus,nationalityCode:c?.nationalityCode??u?.nationalityCode,scoreString:e.scoreString,matchUpStatus:e.matchUpStatus,matchUp:e,depth:r,children:o.length>0?o:void 0}})}function kX(e){const{roundMatchUps:t}=e,r=Object.keys(t).map(Number).sort((e,t)=>e-t);if(0===r.length)throw new Error("No round data found in draw");const i=t[r[0]],n=function(e,t){const r=[];for(const i of e)for(const e of i.sides){const n="BYE"===i.matchUpStatus&&!e.participantName;r.push({name:e.participantName||(n?"BYE":""),participantName:e.participantName||(n?"BYE":void 0),drawPosition:e.drawPosition,seedNumber:e.seedNumber,entryStatus:AX(e.entryStatus),nationalityCode:e.nationalityCode,matchUp:i,depth:t,value:1})}return r}(i,r.length),a=RX(n),o=new Map;for(const c of a)c.participantName&&"BYE"!==c.participantName&&o.set(c.participantName,c);let s=CX(RX(i),a,r.length-1,o);for(let c=1;c<r.length;c++){s=CX(RX(t[r[c]]),s,r.length-1-c,o)}return 1===s.length?s[0]:{name:"Tournament",depth:0,children:s}}function xX(e,t){if(!e)return;const{seedNumber:r,entryStatus:i,drawPosition:n,participantName:a}=e;let o;if("BYE"===a?.trim().toUpperCase())o="#B0BEC5";else if(r){const e=Number(r),t=nX().domain([1,32]).range(["0","1"]);o=nX().domain(nH(0,1,1/7)).range(["#81D4FA","#42A5F5","#1E88E5","#1565C0","#5C6BC0","#673AB7","#9C27B0"])(Number(t(e)))}else if("WC"===i?.toUpperCase())o="red";else if(!i||"Q"!==i&&"LL"!==i){const e=["#C8E6C9","#81C784","#66BB6A","#4CAF50","#43A047","#388E3C","#2E7D32","#1B5E20","#A5D6A7","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1976D2","#1565C0"];o=nX().domain(nH(0,1,1/e.length)).range(e)(t(n))}else o=nX().domain(nH(0,1,.3333333333333333)).range(["#FFF176","#FBC02D","#FF9800"])(t(n));e.color=o,e.children&&e.children.forEach(r=>{r.participantName===e.participantName&&(r.color=o),xX(r,t)})}function OX(e,t,r,i,n,a,o){r&&(n?(t.flagsGroup.selectAll("text").remove(),t.winningFlagsGroup.selectAll("text").remove(),t.losingFlagsGroup.selectAll("text").remove()):e.selectAll("text").remove(),e.append("text").attr("font-size",`${o}px`).attr(PX,"middle").attr(NX,"middle").attr("transform",`translate(0, ${i*a})`).text(LX(r)))}function FX(e,t,r,i={}){const n=i.width||800,a=i.height||800,o=Math.min(n,a)/800*(i.textScaleFactor??1),s=28*o,c=24*o,u=30*o,l=r||i.title||"Tournament",d=Object.assign({},...pL.countries.filter(e=>e.label).map(e=>({[e.ioc]:e.label}))),p=kX(t),m=$K(p,e=>e.children).sum(e=>e.value||0),f=Math.min(n,a)/2,h=f/2,g=e=>e*f/200;zK().size([2*Math.PI,f-h])(m);xX(p,nX().domain([0,t.drawSize||128]).range([0,1]));const I=m.descendants(),y=TX().startAngle(e=>e.x0).endAngle(e=>e.x1).innerRadius(e=>e.y0+h).outerRadius(e=>e.y1+h),{svg:v,g:S,flagsGroup:b,winningFlagsGroup:U,losingFlagsGroup:w}=function(e,t,r){const i=Uz(e).append("svg").attr("width",t).attr("height",r).style("display","block"),n=i.append("g").attr("transform",`translate(${t/2}, ${r/2})`),a=n.append("g").attr("class","flags-group"),o=n.append("g").attr("class","winning-flags-group"),s=n.append("g").attr("class","losing-flags-group");return{svg:i,g:n,flagsGroup:a,winningFlagsGroup:o,losingFlagsGroup:s}}(e,n,a),T=new Set,D=e=>{e.nationalityCode&&T.add(e.nationalityCode),e.children&&e.children.forEach(D)};D(p);const P=Array.from(T),{centerText:N,centerText2:E}=function(e,t,r,i,n){const a=i+.5*n;return{centerText:e.append("text").attr("x",t/2).attr("y",r/2).attr(PX,"middle").attr(NX,"middle").attr("font-size",`${i}px`).attr("font-weight","bold").attr("fill","#333").attr("pointer-events","none"),centerText2:e.append("text").attr("x",t/2).attr("y",r/2+a).attr(PX,"middle").attr(NX,"middle").attr("font-size",`${n}px`).attr("fill","#666").attr("pointer-events","none")}}(v,n,a,s,c);function M(){const e=function(e,t=15){const r=e.split(" "),i=[];let n=[],a=0;return r.forEach(e=>{a+e.length>t?(n.length&&i.push(n.join(" ")),n=[e],a=e.length):(n.push(e),a+=e.length+(n.length>0?1:0))}),n.length&&i.push(n.join(" ")),i}(l,15);N.text(""),N.selectAll("tspan").remove(),E.text(""),E.selectAll("tspan").remove(),N.selectAll("tspan").data(e).join("tspan").attr("x",n/2).attr("dy",(e,t)=>0===t?0:u).text(e=>e);const t=-e.length*u/2+u/2;N.attr("y",a/2+t),N.style("display","block"),E.style("display","none")}function R(){if(b.selectAll("text").remove(),U.selectAll("text").remove(),w.selectAll("text").remove(),0===P.length)return;const e=nX().domain([0,P.length]).range([0,2*Math.PI]),t=g(20),r=h-t+10;b.selectAll("text").data(P).join("text").attr("font-size",`${t}px`).attr(PX,"middle").attr(NX,"middle").attr("transform",(t,i)=>{const n=e(i);return`translate(${Math.cos(n)*r}, ${Math.sin(n)*r})`}).text(e=>LX(e)).style("cursor","pointer").on("mouseover",function(e,t){const r=d[t]||t;N.selectAll("tspan").remove(),N.attr("y",a/2),N.text(r).style("display","block"),E.selectAll("tspan").remove(),E.text("").style("display","none"),C||S.selectAll("path").attr(EX,e=>e.data.nationalityCode===t?.9:.3)}).on("mouseout",function(){C||S.selectAll("path").attr(EX,.8),M()})}R(),M();let A,C=!1;const k=i.eventHandlers?.clickSegment;const x=S.selectAll("path").data(I).join("path").attr("d",e=>y(e)).attr("fill",e=>e.data.color||"#ccc").attr(EX,.8).attr("stroke","#fff").attr("stroke-width",1).on("mouseover",function(e,t){const r=t.data;if(r.participantName){const{messageLines:e,opponentData:i}=function(e,t){const r=[e.participantName];let i;if(t.children&&t.children.length>0)e.scoreString&&r.push(e.scoreString),i=function(e,t){const r=e.find(e=>e.data.participantName&&e.data.participantName!==t);return r?.data.participantName?r.data:void 0}(t.children,e.participantName),i&&r.push(i.participantName);else{const i=function(e,t){const r=[];return e.seedNumber&&r.push(`Seed ${e.seedNumber}`),e.entryStatus&&r.push(e.entryStatus),7===t&&e.drawPosition&&r.push(`Draw ${e.drawPosition}`),r.length>0?r.join(" \u2022 "):void 0}(e,t.depth);i&&r.push(i)}return{messageLines:r,opponentData:i}}(r,t);i&&(r.opponent=i),N.selectAll("tspan").remove(),N.text(""),N.selectAll("tspan").data(e).join("tspan").attr("x",n/2).attr("dy",(e,t)=>0===t?0:u).text(e=>e);const o=function(e,t){return-e*t/2+t/2}(e.length,u);N.attr("y",a/2+o),N.style("display","block"),E.style("display","none")}C?r.participantName?.toLowerCase()===A?.toLowerCase()||Uz(e.currentTarget).attr(EX,.9):S.selectAll("path").attr(EX,e=>e.data.participantName===t.data.participantName?.9:.3);const i=g(30),o=h-i-10,s={flagsGroup:b,winningFlagsGroup:U,losingFlagsGroup:w};OX(U,s,r.nationalityCode,-1,!0,o,i),r.opponent&&OX(w,s,r.opponent.nationalityCode,1,!1,o,i)}).on("mouseout",function(e,t){if(C){const r=t.data.participantName?.toLowerCase()===A?.toLowerCase();Uz(e.currentTarget).attr(EX,r?1:.2)}else S.selectAll("path").attr(EX,.8);R(),M()});return k&&x.style("cursor","pointer").on("click",function(e,t){if(!k)return;const r=t.data;k({participantName:r.participantName,drawPosition:r.drawPosition,seedNumber:r.seedNumber,entryStatus:r.entryStatus,nationalityCode:r.nationalityCode,scoreString:r.scoreString,matchUpStatus:r.matchUpStatus,roundName:r.roundName,depth:r.depth,matchUp:r.matchUp})}),x.append("title").text(e=>{const t=e.data;return t.participantName?`${t.participantName}\nDraw: ${t.drawPosition||"N/A"}`:`${t.name}\nDepth: ${e.depth}`}),{highlightPlayer:function(e){let t=0;return C=!!e,A=e,S.selectAll("path").attr(EX,r=>e?r.data.participantName?.toLowerCase()===e.toLowerCase()?(t+=1,1):.2:.8),t},hide:function(e){v.style("display",e?"none":"block")}}}function _X(e={}){return{render:(t,r,i)=>FX(t,r,i,e)}}function LX(e){return function(e){return 2!==e?.length?"":e&&void 0!==String.fromCodePoint?e.toUpperCase().replaceAll(/./g,e=>String.fromCodePoint((e.codePointAt(0)??0)+127397)):e}(MX[e]||e)}function BX(e){const t={};for(const[r,i]of Object.entries(e.roundMatchUps))t[Number(r)]=i.map(e=>({...e,winningSide:e.winningSide,drawPositions:e.drawPositions||[],scoreString:1===e.winningSide?e.score?.scoreStringSide1:2===e.winningSide?e.score?.scoreStringSide2:void 0,sides:(e.sides||[]).map(e=>({sideNumber:e.sideNumber,drawPosition:e.drawPosition,participantName:e.participant?.participantName,nationalityCode:e.participant?.person?.nationalityCode,seedNumber:e.seedNumber,entryStatus:e.participant?.entryStatus}))}));return{drawSize:2*(t[1]?.length||0),roundMatchUps:t,seedAssignments:e.seedAssignments}}const $X={LL:"LUCKY_LOSER",WC:"WILDCARD",Q:"QUALIFIER"},VX=["R128","R64","R32","R16","QF","SF","F"];function jX(e){const t=[];let r=!1;for(const l of VX){const i=e[l];i&&i.length>0&&(r=!0),r&&i&&i.length>0&&t.push({key:l,data:i})}if(0===t.length)return{drawSize:0,roundMatchUps:{}};const i=t[0].data,n=i.length,a=new Map;i.forEach((e,t)=>{const r=GX(e.player);r&&"BYE"!==r&&a.set(r,{drawPosition:e.Draw??t+1,country:e.country,seed:e.seed,entry:e.entry})});const o=new Map;for(let l=0;l<t.length;l++){const r=l+1<t.length?t[l+1].data:e.W||[],i=new Set;for(const e of r){const t=GX(e.player);t&&i.add(t)}o.set(t[l].key,i)}const s={},c=[],u=o.get(t[0].key)||new Set;for(let l=0;l<i.length;l+=2){const e=i[l],r=i[l+1],n=GX(e?.player),a=GX(r?.player),o="BYE"===n||"BYE"===a,s=o?"BYE"===n?2:1:u.has(n)?1:u.has(a)?2:void 0;let d;if(!o&&t.length>1){const e=t[1].data,r=1===s?n:a;d=e.find(e=>GX(e.player)===r)?.score}const p=o?"BYE":s?"COMPLETED":"TO_BE_PLAYED";c.push({roundNumber:1,matchUpStatus:p,winningSide:s,drawPositions:[e?.Draw??l+1,r?.Draw??l+2],scoreString:d,sides:[qX(1,e,l+1),qX(2,r,l+2)]})}s[1]=c;for(let l=1;l<t.length;l++){const e=l+1,r=t[l].data,i=o.get(t[l].key)||new Set,n=[];for(let t=0;t<r.length;t+=2){const o=r[t],s=r[t+1],c=GX(o?.player),u=GX(s?.player),l=i.has(c)?1:i.has(u)?2:void 0,d=(1===l?o:2===l?s:void 0)?.score,p=l?"COMPLETED":"TO_BE_PLAYED";n.push({roundNumber:e,matchUpStatus:p,winningSide:l,drawPositions:[a.get(c)?.drawPosition??0,a.get(u)?.drawPosition??0],scoreString:d,sides:[HX(1,o,a),HX(2,s,a)]})}s[e]=n}return{drawSize:n,roundMatchUps:s}}function GX(e){if(!e)return"";const t=e.trim();return"BYE"===t.toUpperCase()?"BYE":t}function WX(e){if(e)return $X[e.toUpperCase()]||e}function qX(e,t,r){if(!t)return{sideNumber:e,drawPosition:r};const i=GX(t.player);return{sideNumber:e,drawPosition:t.Draw??r,participantName:i||void 0,nationalityCode:t.country||void 0,seedNumber:t.seed?Number(t.seed):void 0,entryStatus:WX(t.entry)}}function HX(e,t,r){if(!t)return{sideNumber:e,drawPosition:0};const i=GX(t.player),n=r.get(i);return{sideNumber:e,drawPosition:n?.drawPosition??0,participantName:i||void 0,nationalityCode:t.country||n?.country||void 0,seedNumber:t.seed?Number(t.seed):n?.seed?Number(n.seed):void 0,entryStatus:WX(t.entry||n?.entry)}}const zX="font-medium";function YX({target:e,button:t,stateChange:r}){let i=0;const n=()=>(i+=1,`Item${i}`),a=document.createElement("div");t.class&&a.classList.add(t.class),a.classList.add("dropdown"),t.id&&(a.id=t.id),"right"===t.align?(a.classList.add("is-right"),a.style.cssText="margin-left: 1em"):a.style.cssText="margin-right: 1em";const o=e=>e.classList.contains("is-active"),s=()=>{o(a)&&a.classList.remove("is-active")},c=e=>o(e)?(e.classList.remove("is-active"),!1):(e.classList.add("is-active"),!0);a.onmouseleave=s,a.onclick=()=>c(a);const u=document.createElement("div");u.classList.add("dropdown-trigger");const l=document.createElement("button");l.className="button font-medium",t.intent&&l.classList.add(t.intent),l.setAttribute("aria-haspopup","true");const d=document.createElement("span");De(t.onClick)&&(d.onclick=t.onClick),d.style.cssText="margin-right: 1em",d.innerHTML=t.label,l.appendChild(d);const p=document.createElement("span");De(t.onClick)&&(p.onclick=t.onClick),p.innerHTML='\n      <span class="icon is-small font-medium">\n        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>\n      </span>\n  ',l.appendChild(p),u.appendChild(l),a.appendChild(u);const m=document.createElement("div");m.classList.add("dropdown-menu"),m.setAttribute("z-index","99998");const f=document.createElement("div");f.classList.add("dropdown-content");const h=e=>{const i=document.createElement("a");i.className=zX;const u=e.disabled?"0.4":"1";return i.style.cssText=`text-decoration: none; opacity: ${u};`,e.color&&(i.style.color=e.color),i.classList.add("dropdown-item"),e.isActive&&i.classList.add("is-active"),e.value&&(i.value=e.value),e.class&&i.classList.add(e.class),i.onclick=u=>{if(e.disabled)return;e.value&&(l.value=e.value,a.value=e.value),u.stopPropagation(),De(e.onClick)&&(De(r)&&r(),e.onClick(u)),e.close&&s();const p=o(i);(()=>{const e=m.querySelectorAll(".dropdown-item");for(const t of Array.from(e))t.classList.remove("is-active")})(),p?d.innerHTML=t.label:(t.selection&&c(i),t.modifyLabel&&!1!==e.modifyLabel&&(d.innerHTML=`${t.append?t.label+": ":""}${e?.label||n()}`))},i.innerHTML=e?.label||n(),i};for(const g of t.options||[])if(g.heading){const e=document.createElement("div");e.style.cssText="font-weight: bold",e.classList.add("dropdown-item",zX),e.innerHTML=g.heading,f.appendChild(e)}else if(g.divider){const e=document.createElement("hr");e.classList.add("dropdown-divider",zX),f.appendChild(e)}else g.hide||f.appendChild(h(g));return t.options?.length&&(t.options[0].value&&(a.value=t.options[0].value),m.appendChild(f)),a.appendChild(m),e&&e.appendChild(a),a}const KX="left";function XX(e){const{title:t,placeholder:r,options:i,selectionLimit:n,createTable:a,createFilter:o}=e,s="selectionControl",c="selectionTable";let u,l;const d=`\n    <div style='min-height: 420px'>\n      <div id='${s}'></div>\n      <div id='${c}'></div>\n    </div>\n  `;Ue.open({title:t,content:d,buttons:[{label:"Cancel",intent:"is-none",close:!0}],onClose:()=>{l?l():u?.destroy&&u.destroy(),u=void 0}});const p=e=>{e?.[0]?.onClick&&(e[0].onClick(),Ue.close())};if(a){const e=a({anchorId:c,data:i,selectionLimit:n,onSelected:p});u=e.table,l=e.destroy;const t=o?o(u):()=>{},d=[{onKeyDown:e=>8===e.keyCode&&1===e.target.value.length&&t(""),onChange:e=>t(e.target.value),onKeyUp:e=>t(e.target.value),clearSearch:()=>t(""),placeholder:r||"Search",location:KX,search:!0}],m=document.getElementById(s)||void 0;cQ({table:u,target:m,items:d})}else{const e=document.getElementById(c);if(e){!function({container:e,options:t,onSelected:r}){const i=document.createElement("div");i.style.cssText="max-height: 380px; overflow-y: auto; padding: 0.5em 0;";for(const n of t){const e=document.createElement("a");e.setAttribute("data-select-item",""),e.className="panel-block font-medium",e.style.cssText="cursor: pointer; padding: 0.5em 1em; display: block; text-decoration: none; color: inherit;",e.innerHTML=n.label,e.onmouseenter=()=>e.style.backgroundColor="#f5f5f5",e.onmouseleave=()=>e.style.backgroundColor="",e.onclick=e=>{e.stopPropagation(),r([n])},i.appendChild(e)}e.appendChild(i)}({container:e,options:i,onSelected:p});const t=t=>{const r=e.querySelectorAll("[data-select-item]"),i=t.toLowerCase();r.forEach(e=>{const r=e.textContent?.toLowerCase()||"";e.style.display=!t||r.includes(i)?"":"none"})},n=[{onKeyUp:e=>t(e.target.value),clearSearch:()=>t(""),placeholder:r||"Search",location:KX,search:!0}];cQ({target:document.getElementById(s)||void 0,items:n})}}}function QX(e){const t=document.createElement("button");return t.className="button font-medium",e.disabled&&(t.disabled=!0),e.class&&t.classList.add(e.class),e.id&&(t.id=e.id),"right"===e.location?t.style.marginLeft="1em":t.style.marginRight="1em",e.intent&&t.classList.add(e.intent),e.toolTip?.content&&Fq(t,e.toolTip),t.innerHTML=e.label,!1===e.visible&&(t.style.display="none"),t}const JX="flex",ZX="none",eQ=({target:e})=>(t=[])=>{e.style.backgroundColor=t?.length?"lightgray":"";const r=(r,i,n)=>{const a=e.getElementsByClassName(`options_${r}`)[0];a&&(a.style.display=t?.length?i:n)};r("overlay",JX,ZX),r("left",ZX,JX),r("center",ZX,JX),r("right",ZX,JX)},tQ="center",rQ="header",iQ="left",nQ="none",aQ="overlay",oQ="right",sQ="buttonBar";function cQ(e){const{table:t,targetClassName:r,items:i=[],onSelection:n,selectItemFn:a}=e;let{target:o}=e;const s=!!o;if(!o&&r&&(o=document.getElementsByClassName(r)?.[0]),!o)return{elements:{},inputs:{}};let c=0,u=0;const l={},d={};let p;if(s){be(o);const e=function(){const e=document.createElement("div");e.className="panel_container flexcol flexcenter";const t=document.createElement("div");t.className="panelHeader options_header",t.style.display=nQ,e.appendChild(t);const r=document.createElement("div");r.className=sQ;const i={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};i.optionsOverlay.className="options_overlay",i.optionsCenter.className="options_center",i.optionsRight.className="options_right",i.optionsLeft.className="options_left";for(const n of Object.values(i))r.appendChild(n);return e.appendChild(r),{elements:i,anchor:e,header:t}}();Object.assign(l,e.elements),o.appendChild(e.anchor)}const m=Object.assign({},...[aQ,iQ,tQ,oQ,rQ].map(e=>{const t=o.getElementsByClassName(`options_${e}`)?.[0];return be(t),{[e]:t}}).filter(Boolean)),f=eQ({target:o}),h=(e,r)=>{De(r.onClick)&&(e.stopPropagation(),r.disabled||r.onClick(e,t),r.stateChange&&f())},g={onClick:()=>{},location:oQ};for(const y of i){const e={...g};Pe(y)&&Object.assign(e,y);const t=m[e.location];if(t){if(e.location===aQ&&(c+=1),e.location===rQ){if(De(e.headerClick)){const t=o.getElementsByClassName("panelHeader")[0];t&&(t.onclick=e.headerClick)}u+=1}if(!e.hide&&(e.input||e.placeholder||e.search)){const r=document.createElement("p");r.style.cssText="margin-right: 1em",r.className="control "+(e.search?"has-icons-left has-icons-right":"");const i=document.createElement("input");if(e.focus&&(p=i),i.className="input font-medium",i.setAttribute("type","text"),i.setAttribute("autocomplete","off"),i.setAttribute("placeholder",y.placeholder||""),e.id&&(d[e.id]=i),e.id&&i.setAttribute("id",e.id),e.onKeyDown&&i.addEventListener("keydown",t=>e.onKeyDown(t,e)),e.onChange&&i.addEventListener("change",t=>e.onChange(t,e)),e.onKeyUp&&i.addEventListener("keyup",t=>{e.clearSearch&&"Escape"===t.key&&(t.stopPropagation(),i.value="",e.clearSearch()),e.onKeyUp(t,e)}),e.class&&i.classList.add(e.class),!1===e.visible&&(r.style.display=nQ),e.value&&(i.value=e.value),r.appendChild(i),e.search){const t=document.createElement("span");if(t.className="icon is-small is-left font-medium",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16" fill="currentColor"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"/></svg>',r.appendChild(t),De(e.clearSearch)){const t=document.createElement("span");t.className="icon is-small is-right font-medium",t.style.pointerEvents="all",t.style.cursor="pointer",t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="16" height="16" fill="#dddada"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM175 175c9.4-9.4 24.6-9.4 33.9 0l47 47 47-47c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-47 47 47 47c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-47-47-47 47c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l47-47-47-47c-9.4-9.4-9.4-24.6 0-33.9z"/></svg>',t.onclick=t=>{t.stopPropagation(),i.value="",e.clearSearch()},r.appendChild(t)}}if(y.validator){const e=document.createElement("p");e.className="help font-medium",r.appendChild(e),i.addEventListener("input",t=>Mr(y,t,i,e,y.validator))}e.id&&(l[e.id]=r,r.id=e.id),t?.appendChild(r);continue}if(!e.hide&&e.text){const r=document.createElement("div");r.className="font-medium",e.id&&(l[e.id]=r,r.id=e.id),r.innerHTML=e.text,r.onclick=t=>h(t,e),t?.appendChild(r);continue}if(e.id||e?.label&&!e.hide){if(e.options){const r=YX({target:t,button:e,stateChange:f});!1===e.visible&&(r.style.display=nQ),e.id&&(l[e.id]=r)}else if(Pe(e.selection)){const{selection:{options:r,actions:i},actionPlacement:n,threshold:o=8,...s}=e;if(r?.length<o){r.length&&("top"===n?r.unshift({divider:!0}):r.push({divider:!0})),i.forEach(e=>{const{label:t,...i}=e,a={...i,label:`<p style="font-weight: bold">${t}</p>`};"top"===n?r.unshift(a):r.push(a)});const a={...s,options:r},o=YX({target:t,button:a,stateChange:f});!1===a.visible&&(o.style.display=nQ),a.id&&(l[e.id]=o)}else{const i=QX(e),n=a||XX;i.onclick=t=>{t.stopPropagation(),n({title:e.selectionTitle||"Select",options:r})},e.id&&(l[e.id]=i),t?.appendChild(i)}}else if(e.tabs){const r=document.createElement("div");r.className="tabs is-toggle is-toggle-rounded";const i=document.createElement("ul");r.appendChild(i),e.tabs.forEach(t=>{const r=document.createElement("li");t.active&&r.classList.add("is-active");const n=document.createElement("a");r.appendChild(n),n.onclick=n=>{i.querySelectorAll("li").forEach(e=>e.classList.remove("is-active")),r.classList.add("is-active"),De(t.onClick)&&t.onClick(n,e)};const a=document.createElement("span");a.innerHTML=t.label,n.appendChild(a),i.appendChild(r)}),e.id&&(l[e.id]=r),t.appendChild(r)}else{const r=QX(e);r.onclick=t=>h(t,e),e.id&&(l[e.id]=r),t?.appendChild(r)}(!e?.label&&!e.tabs||e.hide)&&l[e.id]&&(l[e.id].style.display=nQ)}}else console.log(e.location,m)}const I=o.getElementsByClassName("panelHeader")[0];return I&&(I.style.display=u?"":nQ),t?.on("rowSelectionChanged",(e,t)=>{De(n)&&n(t),c&&f(t)}),f(),p&&setTimeout(()=>p.focus(),200),{elements:l,inputs:d}}}}]);