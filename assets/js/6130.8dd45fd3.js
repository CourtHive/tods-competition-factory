(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6130],{3905:function(t,e,n){"use strict";n.d(e,{Zo:function(){return d},kt:function(){return m}});var i=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},a=Object.keys(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(i=0;i<a.length;i++)n=a[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var c=i.createContext({}),u=function(t){var e=i.useContext(c),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},d=function(t){var e=u(t.components);return i.createElement(c.Provider,{value:e},t.children)},l={inlineCode:"code",wrapper:function(t){var e=t.children;return i.createElement(i.Fragment,{},e)}},p=i.forwardRef((function(t,e){var n=t.components,r=t.mdxType,a=t.originalType,c=t.parentName,d=s(t,["components","mdxType","originalType","parentName"]),p=u(n),m=r,f=p["".concat(c,".").concat(m)]||p[m]||l[m]||a;return n?i.createElement(f,o(o({ref:e},d),{},{components:n})):i.createElement(f,o({ref:e},d))}));function m(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var a=n.length,o=new Array(a);o[0]=p;var s={};for(var c in e)hasOwnProperty.call(e,c)&&(s[c]=e[c]);s.originalType=t,s.mdxType="string"==typeof t?t:r,o[1]=s;for(var u=2;u<a;u++)o[u]=n[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5936:function(t,e,n){"use strict";n.d(e,{aX:function(){return ad},y1:function(){return fp},SX:function(){return mf},C9:function(){return v},QO:function(){return pf},_3:function(){return Ba},M6:function(){return Em},hC:function(){return ff}});const i={S:"normal",F:"final"};function r(t,e){if(t&&"object"==typeof t){if(t.timed&&!isNaN(t.minutes))return o(t);if(t.bestOf&&t.setFormat)return function(t,e){const n=a(t.bestOf),i=n&&`SET${n}`||"",r=s(t.setFormat,e),o=r&&`S:${r}`||"",c=s(t.finalSetFormat,e),u=n>1&&c&&!c.invalid&&r!==c&&`F:${c}`||"";if(i&&r&&!r.invalid&&(!c||!c.invalid))return[i,o,u].filter((t=>t)).join("-")}(t,e)}}function a(t){return!isNaN(Number(t))&&Number(t)}function o(t){return`T${t.minutes}`}function s(t,e){if(t&&"object"==typeof t){if(t.timed)return o(t);if(t.tiebreakSet)return c(t.tiebreakSet);const n=a(t.setTo);if(n){const i=t.NoAD?"NOAD":"",r=c(t.tiebreakFormat),o=r&&!r.invalid&&`/${r}`||"",s=a(t.tiebreakAt),u=s&&(s!==n||e)&&`@${s}`||"";return r&&r.invalid?{invalid:!0}:`${n}${i}${o}${u}`}return{invalid:!0}}}function c(t){if(t)return"object"!=typeof t||t.tiebreakTo?"object"==typeof t&&a(t.tiebreakTo)?`TB${t.tiebreakTo}${t.NoAD?"NOAD":""}`:{invalid:!0}:""}function u(t){if(t&&"string"==typeof t){const e=0===t.indexOf("T")?"timed":0===t.indexOf("SET")?"SET":"";if("timed"===e){const e={bestOf:1,setFormat:p(t)};if(e.setFormat)return e}if("SET"===e)return function(t){const e=t.split("-"),n=f(e[0].slice(3)),i=e&&d(e[1]),r=e&&d(e[2]),a=n&&n<6,o=!e[2]||r&&!r.invalid,s=i&&!i.invalid,c={bestOf:n,setFormat:i};if(r&&(c.finalSetFormat=r),a&&s&&o)return c}(t)}}function d(t){if(t&&":"===t[1]){const e=t.split(":"),n=i[e[0]],r=e[1];if(n&&r){if(0===r.indexOf("TB"))return{tiebreakSet:l(r)};if(0===r.indexOf("T"))return p(r);const e=t.match(/^[FS]{1}:(\d+)([A-Za-z]*)/),n=e&&m(e[2])||!1,i=!e||!e[2]||n,a=e&&f(e[1]),o=function(t){const e=t&&t.indexOf("@")>0&&t.split("@");if(e)return f(e[1])||{invalid:!0}}(r),s=!o||o&&!o.invalid,c=s&&o||a,u=l(r.split("/")[1]),d=!u||!u.invalid,h={setTo:a};return n&&(h.NoAD=!0),u?(h.tiebreakFormat=u,h.tiebreakAt=c):h.noTiebreak=!0,a&&i&&d&&s&&h||{invalid:!0}}}}function l(t){if(t){if(0===t.indexOf("TB")){const e=t.match(/^TB(\d+)([A-Za-z]*)/),n=e&&e[1],i=e&&m(e[2]),r=!e||!e[2]||i,a=f(n);if(a&&r){const t={tiebreakTo:a};return i&&(t.NoAD=!0),t}return{invalid:!0}}return{invalid:!0}}}function p(t){const e=f(t.slice(1));if(e)return{timed:!0,minutes:e}}function m(t){return t&&t.indexOf("NOAD")>=0}function f(t){return!isNaN(Number(t))&&Number(t)}function h(t){var e;if("string"!=typeof t)return!1;const n=u(t);if(null!=n&&null!==(e=n.setFormat)&&void 0!==e&&e.timed&&1===(null==n?void 0:n.bestOf)&&t.indexOf("SET1-S:")<1&&0===t.indexOf("T"))return r(n).slice(7)===t;const i=t.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),a=null==i?void 0:i[0],o=null==i?void 0:i[2],s=t.match(/-S(\d+)+:TB(\d+)@(\d*)([A-Za-z]*)/),c=null==s?void 0:s[0],d=null==s?void 0:s[2];return r(n,i&&a===o||s&&c===d)===t}const v={isValidMatchUpFormat:h,stringify:r,isValid:h,parse:u};function I(t){return!isNaN(t)&&t&&0==(t&t-1)}function g(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function U(t){return!isNaN(parseFloat(t))}function y(t){if(isNaN(t))return!1;for(;!I(t);)t++;return t}function S(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function w(t){return Number.isSafeInteger("string"==typeof t?+t:t)}function N(t,e,n,i=2,r){const a=1-Math.random(),o=1-Math.random();let s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=N(t,e,n):(s=Math.pow(s,n),s*=e-t,s+=t),r&&(s=function(t,e){e||(e=1);var n=1/e;return Math.round(t*n)/n}(s,r)),parseFloat(s.toFixed(i))}function D(t){if(null===t)return{};const{source:e,template:n}=t||{},i={};return function t(e,n,i){if(!e||!n)return;const r=Object.keys(e),a=Object.keys(n);for(let o=0;o<r.length;o++)if(a.indexOf(r[o])>=0){const a=n[r[o]],s=e[r[o]];a&&"object"==typeof a&&"function"!=typeof s?Array.isArray(s)?i[r[o]]=s.map((e=>{const n={};return t(e,a,n),n})):s&&(i[r[o]]={},t(s,a,i[r[o]])):n[r[o]]&&(i[r[o]]=e[r[o]])}}(e,n,i),i}function P(t=0){const e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function T(t){return t.filter(((t,e,n)=>n.lastIndexOf(t)===e))}function M(t){return t.map((t=>[Math.random(),t])).sort(((t,e)=>t[0]-e[0])).map((t=>t[1]))}function A(t){return t.reduce(((t,e)=>(t[e]||(t[e]=0),t[e]++,t)),{})}function E(t,e,n){return n.indexOf(t)===e}function b(t){return t.filter(E)}function R(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function C(t){return t[Math.floor(Math.random()*t.length)]}function O(t,e){return Array.from({length:e-t},((e,n)=>n+t))}function L(t,e){return e.reduce(((e,n,i)=>(n===t&&e.push(i),e)),[])}function F(t,e){return Array.isArray(t)&&Array.isArray(e)?t.filter((t=>-1!==e.indexOf(t))).filter(((t,e,n)=>n.indexOf(t)===e)):0}function x(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.some((t=>e.includes(t)))}function k(t,e){return t.reduce(((t,n,i)=>{const r=Math.floor(i/e);return t[r]=[].concat(t[r]||[],n),t}),[])}function _(t,e,n){return t.reduce(((t,i,r)=>{const a=!!n&&!!(Math.floor(r/e)%2),o=r%e,s=a?e-1-o:o;return t[s]||(t[s]=[]),t[s].push(i),t}),[])}const B={success:!0},j={SUCCESS:B,ERROR:"error"},V="records must be an object with tournamentId keys",G="Missing tournamentRecord",q="Missing drawDefinition",H="drawPosition already assigned",W="Missing event / eventId",z="Missing value",K="Invalid Date",Y="Participant Not Found",$="Invalid values",J="Not found",Z={CANNOT_CHANGE_WINNINGSIDE:"Cannot change winningSide",CANNOT_REMOVE_PARTICIPANTS:"Cannot remove participants",COURT_EXISTS:"Court exists",COURT_NOT_FOUND:"Court not found",DRAW_DEFINITION_NOT_FOUND:"drawDefinition not found",DRAW_ID_EXISTS:"drawId exists",DRAW_POSITION_ACTIVE:"drawPosition is active",DRAW_POSITION_ASSIGNED:"drawPosition already assigned",DRAW_POSITION_NOT_CLEARED:"drawPosition not cleared",DRAW_POSITION_NOT_FOUND:"drawPosition not found",DUPLICATE_VALUE:"Duplicate value",ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:"entryStatus not allowed for event",ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:"entryStatus not allowed in stage",EVENT_EXISTS:"Event exists",EVENT_NOT_FOUND:"Event not found",EXISTING_DRAW_DEFINITIONS:"Existing drawDefinition(s)",EXISTING_END_TIME:"Existing endTime",EXISTING_FLIGHT:"Existing flight",EXISTING_OUTCOME:"Existing outcome",EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:"Existing participant drawPosition assignment",EXISTING_PARTICIPANT:"Existing participant",EXISTING_POLICY_TYPE:"existing policyType",EXISTING_PROFILE:"Existing profile",EXISTING_ROUND:"Existing round",INCOMPATIBLE_MATCHUP_STATUS:"Incompatible matchUpStatus",INCOMPLETE_SOURCE_STRUCTURE:"Incomplete source structure",INVALID_BOOKINGS:"Invalid bookings",INVALID_CONFIGURATION:"Invalid configuration",INVALID_DATE_AVAILABILITY:"Invalid dateAvailability",INVALID_DATE:K,INVALID_DRAW_DEFINITION:"Invalid drawDefinition",INVALID_DRAW_POSITION_FOR_SEEDING:"Invalid drawPosition for seedAssignment",INVALID_DRAW_POSITION:"Invlid drawPosition",INVALID_DRAW_SIZE:"Invalid drawSize",INVALID_END_TIME:"Invalid endTime",INVALID_ENTRIES:"Invalid entries",INVALID_EVENT_TYPE:"Invalie eventType",INVALID_GAME_SCORES:"Invalid game scores",INVALID_MATCHUP_FORMAT:"Invalid matchUpFormat",INVALID_MATCHUP_STATUS:"Invalid matchUpStatus",INVALID_MATCHUP:"Invalid matchUp",INVALID_OBJECT:"Invalid object",INVALID_PARTICIPANT_ID:"Invalid participantId",INVALID_PARTICIPANT_IDS:"Invalid participantIds",INVALID_PARTICIPANT_ROLE:"Invalid participantRole",INVALID_PARTICIPANT_TYPE:"Invalid participantType",INVALID_PARTICIPANT:"Invalid participant",INVALID_POLICY_DEFINITION:"Invalid policyDefinitions",INVALID_RECORDS:V,INVALID_SCALE_ITEM:"Invalid scaleItem",INVALID_SEED_NUMBER:"Invalid seedNumber",INVALID_SEED_POSITION:"Invalid seedPosition",INVALID_SET_NUMBER:"Invalid setNumber",INVALID_SIDE_NUMBER:"Invalid sideNumber",INVALID_STAGE:"Invalid stage",INVALID_START_TIME:"Invalid startTime",INVALID_STRUCTURE:"Invalid structure",INVALID_STOP_TIME:"Invalid stopTime",INVALID_TIE_FORMAT:"Invalid tieFormat",INVALID_TIME:"Invalid time",INVALID_TIME_ITEM:"Invalid timeItem",INVALID_TOURNAMENT_DATES:"Invalid tournament dates",INVALID_TOURNAMENT_RECORD:"Invalid tournamentRecord",INVALID_VALUES:$,INVALID_WINNING_SIDE:"Invalid winningSide",MATCHUP_NOT_FOUND:"matchUp not found",METHOD_NOT_FOUND:"Method not found",MISSING_ASSIGNMENTS:"Missing assignments",MISSING_AVOIDANCE_POLICY:"Missing avoidance policy",MISSING_COLLECTION_DEFINITION:"Missing collectionDefinition",MISSING_COURT_ID:"Missing courtId",MISSING_COURTS_INFO:"Missing courtsCount/courtNames",MISSING_DATE_AVAILABILITY:"Missing dateAvailability",MISSING_DATE:"Missing date",MISSING_DRAW_DEFINITION:q,MISSING_DRAW_ID:"Missing drawId",MISSING_DRAW_POSITION:"Missing drawPosition",MISSING_DRAW_POSITIONS:"Missing drawPositions",MISSING_DRAW_SIZE:"Missing drawSize",MISSING_ENTRIES:"Missing entries",MISSING_EVENT:W,MISSING_MATCHUP_FORMAT:"Missing matchUpFormat",MISSING_MATCHUP_ID:"Missing matchUpId",MISSING_MATCHUP_IDS:"Missing matchUpIds",MISSING_MATCHUP:"Missing matchUp",MISSING_MATCHUPS:"Missing matchUps",MISSING_PARTICIPANT_COUNT:"Missing participantCount",MISSING_PARTICIPANT_ID:"Missing participantId",MISSING_PARTICIPANT_IDS:"Missing participantIds",MISSING_PARTICIPANT_ROLE:"Missing participantRole",MISSING_PARTICIPANT:"Missing participant",MISSING_PARTICIPANTS:"Missing participants",MISSING_PENALTY_ID:"Missing penaltyId",MISSING_PENALTY_TYPE:"Missing penaltyType",MISSING_PERSON_DETAILS:"Missing person details",MISSING_POLICY_ATTRIBUTES:"Missing policy attributes",MISSING_POLICY_DEFINITION:"Missing policyDefinitions",MISSING_POLICY_TYPE:"Missing policyType",MISSING_POSITION_ASSIGNMENTS:"Missing positionAssignments",MISSING_ROUND_NUMBER:"Missing roundNumber",MISSING_SCHEDULE:"Missing schedule",MISSING_SCORING_POLICY:"Missing scoring policy / matchUpFormats",MISSING_SEED_ASSIGNMENTS:"Missing seedAssignments",MISSING_SEED_BLOCKS:"Missing seedBlocks",MISSING_SEEDCOUNT_THRESHOLDS:"Missing seedCountThresholds",MISSING_SEEDING_POLICY:"Missing seeding policy",MISSING_SET_NUMBER:"Missing setNumber",MISSING_SET_OBJECT:"Missing setObject",MISSING_SIDE_NUMBER:"Missing sideNumber",MISSING_STAGE:"Missing stage",MISSING_STRUCTURE_ID:"Missing structureId",MISSING_STRUCTURE:"Missing structure",MISSING_STRUCTURES:"Missing structures",MISSING_TARGET_LINK:"Missing targetLink",MISSING_TIE_FORMAT:"Missing tieFormat",MISSING_TIME_ITEM:"Missing timeItem",MISSING_TIME_ITEMS:"Missing timeItems",MISSING_TOURNAMENT_ID:"Missing tournamentId",MISSING_TOURNAMENT_RECORD:G,MISSING_TOURNAMENT_RECORDS:"Missing tournamentRecords",MISSING_VALUE:z,MISSING_VENUE_ID:"Missing venueId",MODIFICATIONS_FAILED:"Modifications failed",MORE_PARTICIPANTS_THAN_DRAW_POSITIONS:"More Participants than Draw Positions",NO_MODIFICATIONS_APPLIED:"No modifications applied",NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:"No stage space available for entryStatus",NO_PARTICIPANT_REMOVED:"No participant removed",NO_VALID_ACTIONS:"No valid actions",NO_VALID_ATTRIBUTES:"No valid attributes",NO_VALID_DATES:"No valid dates",NOT_FOUND:J,NOT_IMPLEMENTED:"Not implemented",PARTICIPANT_ASSIGNED_DRAW_POSITION:"Participant has assigned drawPosition",PARTICIPANT_ALREADY_CHECKED_IN:"Participant already checked in",PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:"participantCount exceeds drawSize",PARTICIPANT_ID_EXISTS:"participantId exists",PARTICIPANT_NOT_CHECKED_IN:"Participant not checked in",PARTICIPANT_NOT_FOUND:Y,PARTICIPANT_PAIR_EXISTS:"participant pair exists",PENALTY_NOT_FOUND:"Penalty not found",POLICY_NOT_ATTACHED:"Policy not attached",POLICY_NOT_FOUND:"Policy not found",SCALE_ITEM_NOT_FOUND:"No scaleItem found",SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:"seedsCount greater than drawSize",STAGE_SEQUENCE_LIMIT:"stageSequence limit",STRUCTURE_NOT_FOUND:"structure not found",TEAM_NOT_FOUND:"Team not found",UNRECOGNIZED_DRAW_TYPE:"Unrecognized drawType",UNRECOGNIZED_MATCHUP_FORMAT:"Unrecognized matchUpFormat",UNRECOGNIZED_MATCHUP_STATUS:"Unrecognized matchUpStatus",VALUE_UNCHANGED:"Value unchanged",VENUE_EXISTS:"Venue exists"},Q={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},notices:[]},X={timers:{default:{elapsedTime:0}},devContext:void 0,deepCopyAttributes:{threshold:void 0,stringify:[],ignore:[],toJSON:[]},deepCopy:!0};let tt={addNotice:function({topic:t,payload:e,key:n}){"string"==typeof t&&"object"==typeof e&&!Q.disableNotifications&&Q.subscriptions[t]&&(n&&(Q.notices=Q.notices.filter((e=>!(e.topic===t&&e.key===n)))),Q.notices.push({topic:t,payload:e,key:n}))},callListener:function({topic:t,notices:e}){const n=Q.subscriptions[t];n&&"function"==typeof n&&n(e)},deleteNotices:function(){Q.notices=[]},disableNotifications:function(){Q.disableNotifications=!0},enableNotifications:function(){Q.disableNotifications=!1},getNotices:function({topic:t}){const e=Q.notices.filter((e=>e.topic===t)).map((t=>t.payload));return e.length&&e},getTopics:function(){return{topics:Object.keys(Q.subscriptions)}},getTournamentId:function(){return Q.tournamentId},getTournamentRecord:function(t){return Q.tournamentRecords[t]},getTournamentRecords:function(){return Q.tournamentRecords},removeTournamentRecord:function(t){if("string"!=typeof t)return{error:$};if(!Q.tournamentRecords[t])return{error:J};delete Q.tournamentRecords[t];const e=Object.keys(Q.tournamentRecords);return 1===e.length?Q.tournamentId=e[0]:e.length||(Q.tournamentId=void 0),{success:!0}},setSubscriptions:function({subscriptions:t={}}={}){return"object"!=typeof t?{error:$}:(Object.keys(t).forEach((e=>{Q.subscriptions[e]=t[e]})),{...B})},setTournamentId:function(t){return Q.tournamentRecords[t]?(Q.tournamentId=t,{success:!0}):{error:G}},setTournamentRecord:function(t){const e=null==t?void 0:t.tournamentId;return e?(Q.tournamentRecords[e]=t,{success:!0}):{error:"Invalid tournamentRecord"}},setTournamentRecords:function(t){Q.tournamentRecords=t;const e=Object.keys(t);1===e.length?Q.tournamentId=e[0]:e.length||(Q.tournamentId=void 0)}};function et(t){return t&&"object"==typeof t?"object"==typeof X.devContext&&Object.keys(t).every((e=>X.devContext[e]===t[e]))&&X.devContext:X.devContext||!1}function nt(t){X.devContext=t}function it(){tt.enableNotifications()}function rt(t,e){"boolean"==typeof t&&(X.deepCopy=t),"object"==typeof e&&(Array.isArray(e.ignore)&&(X.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(X.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(X.deepCopyAttributes.stringify=e.stringify),e.threshold&&(X.deepCopyAttributes.threshold=e.threshold))}function at(t){return tt.addNotice(t)}function ot(t){return tt.getNotices(t)}function st(){return tt.deleteNotices()}function ct(){return tt.getTopics()}async function ut(t){return tt.callListener(t)}function dt(){return tt.getTournamentId()}function lt(t){return tt.getTournamentRecord(t)}function pt(){return tt.getTournamentRecords()}function mt(t){return tt.setTournamentRecord(t)}function ft(t){return tt.setTournamentRecords(t)}function ht(t){return tt.setTournamentId(t)}function vt(t){return tt.removeTournamentRecord(t)}const It=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])$/,gt=/^((0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)([.,][0-9]{3})?$/,Ut=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))([ T](0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/,yt=/^([0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1]))?([ T]?(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9](:[0-5][0-9])?)?([.,][0-9]{3})?Z?$/;function St(t){return"object"==typeof t&&!Array.isArray(t)&&"[object Date]"===Object.prototype.toString.call(t)}function wt(t){return Et(t)||It.test(t)}const Nt=t=>{const e=Tt(t)||Et(t)?new Date(t):new Date,n=e.getUTCMonth()+1,i=n<10?`0${n}`:`${n}`;return`${e.getUTCFullYear()}-${Vt(i)}-${Vt(e.getUTCDate())}`};function Dt(t,e="-",n="YMD"){if(!t)return"";"string"==typeof t&&t.indexOf("T")<0&&(t+="T00:00");const i=new Date(t);let r=""+(i.getMonth()+1),a=""+i.getDate();const o=i.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),"DMY"===n?[a,r,o].join(e):"MDY"===n?[r,a,o].join(e):"YDM"===n?[o,a,r].join(e):"DYM"===n?[a,o,r].join(e):"MYD"===n?[r,o,a].join(e):[o,r,a].join(e)}function Pt(t){const e=t?new Date(t):new Date,n=e.getTimezoneOffset();return new Date(e.getTime()-60*n*1e3)}function Tt(t){if("boolean"==typeof t)return!1;const e=t instanceof Date?t:!isNaN(t)&&new Date(t);return e&&!isNaN(e.valueOf())}function Mt(t,e){if(!wt(t)||!wt(e))return[];const n=Lt(t)+"T00:00",i=Lt(e)+"T00:00",r=new Date(n),a=new Date(i);const o=[];let s=0;if(Tt(a)&&Tt(r)&&r<=a){const t=r,e=a;for(;t<=e&&s<300;)s+=1,o.push(new Date(t)),t.setDate(t.getDate()+1)}return o.map((t=>Dt(t)))}const At=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Et(t){return"string"==typeof t&&At.test(t)}function bt(t){if("string"!=typeof t)return!1;const e=t.split("Z")[0].split(":"),n=e.every((t=>!isNaN(t)));return!(e.length<2||!n||parseInt(e[0])>23||parseInt(e[1])>60)}function Rt(t){const e=Ot(t);if(!e)return 0;const[n,i]=e.split(":").map((t=>parseInt(t)));return 60*n+i}function Ct(t){return bt(t)?t.split(":").slice(0,2).map(Vt).join(":"):void 0}function Ot(t){return Et(t)&&t.indexOf("T")>0?Ct(t.split("T").reverse()[0]):Ct(t)}function Lt(t){return Et(t)||Ut.test(t)?t.split("T")[0]:void 0}function Ft(t,e){const n=new Date(t);return n.setDate(n.getDate()+e),Lt(n.toISOString())}function xt(t){t="string"!=typeof t?"00:00":t;const e={},n={};return({0:e.time,1:e.ampm}=t.split(" ")||[]),({0:n.hours,1:n.minutes}=e.time.split(":")||[]),n.ampm=e.ampm,isNaN(n.hours)||isNaN(n.minutes)||n.ampm&&!["AM","PM"].includes(n.ampm.toUpperCase())?{}:n}function kt(t,e){const[n,i]=(t||"00:00").split(":").map(Vt),r=Pt(e).setHours(n,i,0,0);return Pt(r)}function _t(t,e,n=!0){const i=new Date(t),r=(new Date(e).getTime()-i.getTime())/1e3/60;return n?Math.abs(Math.round(r)):Math.round(r)}function Bt(t,e){const n=Ot(t);if(!n)return"00:00";const i=isNaN(e)?0:e;return Ot(jt(kt(n),i).toISOString())}function jt(t,e){const n=new Date(t);return new Date(n.getTime()+6e4*e)}function Vt(t){return t.toString()[1]?t:"0"+t}function Gt(t,e){const n=new Date(t),i=new Date(e);return n.getFullYear()===i.getFullYear()&&n.getMonth()===i.getMonth()&&n.getDate()===i.getDate()}const qt={addMinutesToTimeString:Bt,convertTime:function(t,e){return e?function(t){const e=xt(t);return e.ampm&&e.hours&&("pm"===e.ampm.toLowerCase()&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),"am"===e.ampm.toLowerCase()&&"12"===e.hours&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Vt).join(":")}(t):function(t){const e=xt(t);return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):"12"===e.hours?e.ampm="PM":"00"===e.hours?(e.hours="12",e.ampm="AM"):e.ampm="AM","0"===e.hours[0]&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}(t)},getUTCdateString:Nt,DateHHMM:function(t){const e=new Date(t);return function(t,e){const n=parseInt(t,10),i=Math.floor(n/3600),r=Math.floor((n-3600*i)/60);return(!e||e&&e.displaySeconds?i+":"+r+":"+(n-3600*i-60*r):i+":"+r).split(":").map(Vt).join(":")}(e.getSeconds()+60*e.getMinutes()+3600*e.getHours(),{displaySeconds:!1})},extractDate:Lt,extractTime:Ot,formatDate:Dt,getDateByWeek:function(t,e,n,i=!1){let r=new Date(e,0,1+7*(t-1));const a=i?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Dt(r,n)},isISODateString:Et,isTimeString:bt,offsetDate:Pt,offsetTime:function(t){return Pt(t).getTime()},sameDay:Gt,timeStringMinutes:Rt,timeToDate:kt,timeUTC:function(t){const e=Tt(t)||Et(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}};function Ht(t,e,n,i,r=0){const a={enabled:X.deepCopy,...X.deepCopyAttributes};if((null==a||!a.enabled)&&!n||"object"!=typeof t||"function"==typeof t||null===t||"number"==typeof(null==a?void 0:a.threshold)&&r>=a.threshold)return t;const o=et({makeDeepCopy:!0});o&&r>(o.iterations||15)&&console.log(r,t,{devContext:o});const s=Array.isArray(t)?[]:{},c=Object.keys(t).filter((t=>!n||!(null!=a&&a.ignore.includes(t))));for(const d of c){const o=t[d];if(e&&"extensions"===d&&Array.isArray(o)){const t=null==(u=o)?void 0:u.map((t=>{const{name:e,value:n}=t;return e&&n&&{[`_${e}`]:n}})).filter(Boolean);Object.assign(s,...t)}else i&&"extensions"===d?s[d]=[]:n&&null!=a&&a.stringify.includes(d)?s[d]="function"==typeof(null==o?void 0:o.toString)?o.toString():JSON.stringify(o):n&&null!=a&&a.toJSON.includes(d)&&"function"==typeof(null==o?void 0:o.toJSON)?s[d]=o.toJSON():null===o?s[d]=void 0:St(o)?s[d]=new Date(o).toISOString():s[d]=Ht(o,e,n,i,r+1)}var u;return s}function Wt(t,e,n){if("object"!=typeof t||null===t)return t;const i=["",void 0,null];e&&i.push(!1);const r=Object.keys(t).filter((e=>!i.includes(t[e])&&(!n||!Array.isArray(t[e])||t[e].length)));return Object.assign({},...r.map((e=>Array.isArray(t[e])?{[e]:t[e].map((t=>Wt(t)))}:{[e]:Wt(t[e])})))}function zt(t){return Array.isArray(t)?t.length+t.map(zt).reduce(((t,e)=>t+e),0):"object"==typeof t&&null!==t?Object.keys(t).length+Object.keys(t).map((e=>zt(t[e]))).reduce(((t,e)=>t+e),0):0}function Kt(t,e){return t-e}function Yt(){const t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);const e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&n]+t[n>>8&255]+"-"+t[n>>16&15|64]+t[n>>24&255]+"-"+t[63&i|128]+t[i>>8&255]+"-"+t[i>>16&255]+t[i>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}const $t="SINGLES",Jt="DOUBLES",Zt="TEAM",Qt={SINGLES:$t,DOUBLES:Jt,TEAM:Zt};function Xt({checkCollectionIds:t=!0,tieFormat:e}={}){var n,i,r,a;const o=[];if("object"!=typeof e)return o.push("tieformat must be an object"),{error:"Invalid tieFormat",errors:o};if("object"!=typeof e.winCriteria)return o.push("tieFormat.winCriteria must be an object"),{error:"Invalid tieFormat",errors:o};if(!Array.isArray(e.collectionDefinitions))return o.push("tieFormat.collectionDefinitiosn must be an array of objects"),{error:"Invalid tieFormat",errors:o};const s="number"==typeof(null===(n=e.winCriteria)||void 0===n?void 0:n.valueGoal)&&(null===(i=e.winCriteria)||void 0===i?void 0:i.valueGoal)>0||(null===(r=e.winCriteria)||void 0===r?void 0:r.aggregateValue);if(!(s||null!==(a=e.winCriteria)&&void 0!==a&&a.aggregateValue))return o.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),{error:"Invalid tieFormat",errors:o};const c=e.collectionDefinitions.every((e=>{const{valid:n,errors:i}=te({collectionDefinition:e,checkCollectionIds:t});return!!n||(o.push(...i),!1)})),u=e.collectionDefinitions.map((({collectionId:t})=>t)),d=!t||u.length===T(u).length,l=c&&s&&d,p={valid:l,errors:o};return l||(p.error="Invalid tieFormat"),p}function te({checkValueDefinition:t=!0,collectionDefinition:e,checkCollectionIds:n}){const i=[];if("object"!=typeof e)return i.push(`collectionDefinition must be an object: ${e}`),{errors:i};const{collectionValueProfile:r,collectionGroupNumber:a,collectionValue:o,collectionId:s,matchUpCount:c,matchUpFormat:u,matchUpValue:d,matchUpType:l,scoreValue:p,setValue:m}=e;if(n&&"string"!=typeof s)return i.push(`collectionId is not type string: ${s}`),{errors:i};if("number"!=typeof c)return i.push(`matchUpCount is not type number: ${c}`),{errors:i};if(![$t,Jt].includes(l))return i.push(`matchUpType must be SINGLES or DOUBLES: ${l}`),{errors:i};if(t&&!d&&!o&&!r&&!p&&!m)return i.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfile"),{errors:i};if(d&&"number"!=typeof d)return i.push(`matchUpValue is not type number: ${d}`),{errors:i};if(o&&"number"!=typeof o)return i.push(`collectionValue is not type number: ${o}`),{errors:i};if(r){if(!Array.isArray(r))return i.push(`collectionValueProfile is not an array: ${r}`),{errors:i};if(r.length!==c)return i.push("collectionValueProfile does not align with matchUpsCount"),{errors:i};for(const e of r){if("object"!=typeof e)return i.push(`valueProfile is not type object: ${e}`),{errors:i};const{value:t,collectionPosition:n}=e;if("number"!=typeof t||"number"!=typeof n||n>c||n<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}const t=r.map((t=>t.collectionPosition));if(t.length!==T(t).length)return i.push("collectionPositions are not unique"),{errors:i}}return a&&"number"!=typeof a?(i.push(`collectionValue is not type number: ${o}`),{errors:i}):u&&!v.isValid(u)?(i.push(`Invalid matchUpFormat: ${u}`),{errors:i}):{valid:!0}}const ee="ABANDONED",ne="BYE",ie="CANCELLED",re="COMPLETED",ae="DEFAULTED",oe="DOUBLE_WALKOVER",se="IN_PROGRESS",ce="INCOMPLETE",ue="RETIRED",de="SUSPENDED",le="TO_BE_PLAYED",pe="WALKOVER",me=["AWAITING_RESULT",re,ae,se,ce,ue,de],fe=["AWAITING_RESULT",re,ae,oe,se,ce,ue,de,pe],he=[ee,"AWAITING_RESULT",ne,ie,re,"DEAD_RUBBER",ae,oe,se,ce,"NOT_PLAYED",ue,de,le,pe],ve=[ne,re,ae,oe,ue,pe],Ie=[ee,"AWAITING_RESULT",ie,"DEAD_RUBBER",se,ce,"NOT_PLAYED",de,le,void 0],ge=[ie,ee,re,"DEAD_RUBBER",ae,oe,ue,pe],Ue=[ee,re,ae,oe,se,ue,pe],ye=[se,ce,de,le],Se={ABANDONED:ee,AWAITING_RESULT:"AWAITING_RESULT",BYE:ne,CANCELLED:ie,COMPLETED:re,DEAD_RUBBER:"DEAD_RUBBER",DEFAULTED:ae,DOUBLE_WALKOVER:oe,IN_PROGRESS:se,INCOMPLETE:ce,NOT_PLAYED:"NOT_PLAYED",RETIRED:ue,SUSPENDED:de,TO_BE_PLAYED:le,WALKOVER:pe};function we({sideAdjustments:t=[0,0],separator:e="-",tieFormat:n,matchUp:i}){var r,a,o;if(!Array.isArray(t)||2!==t.length||isNaN(t.reduce(((t,e)=>t+e))))return{error:$};if(!i)return{error:"Missing matchUp"};if(!(n=i.tieFormat||n))return{error:"Missing tieFormat"};const s=Xt({tieFormat:n});if(!s.valid)return{error:$,errors:s.errors};const c=[0,0],u=(null==i?void 0:i.tieMatchUps)||[],d=(null===(r=n)||void 0===r?void 0:r.collectionDefinitions)||[],l=(null===(a=n)||void 0===a?void 0:a.collectionGroups)||[],p=Object.assign({},...l.filter((t=>(null==t?void 0:t.groupValue)&&(null==t?void 0:t.groupNumber))).map((t=>({[t.groupNumber]:{...t,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}})))),m=Object.keys(p).map((t=>parseInt(t)));for(const U of d){const t=u.filter((t=>t.collectionId===U.collectionId)),e=[0,0];let n=[0,0];const i=t.every((t=>ge.includes(t.matchUpStatus))),{collectionValueProfiles:r,collectionGroupNumber:a,collectionValue:o,matchUpValue:s,winCriteria:d,scoreValue:l,setValue:f}=U,h=a&&m.includes(a);s?t.forEach((t=>{t.winningSide&&(e[t.winningSide-1]+=s)})):f?t.forEach((t=>{var n,i;null===(n=t.score)||void 0===n||null===(i=n.sets)||void 0===i||i.forEach((t=>{t.winningSide&&(e[t.winningSide-1]+=f)}))})):l?t.forEach((t=>{var n,i;null===(n=t.score)||void 0===n||null===(i=n.sets)||void 0===i||i.forEach((t=>{const{side1Score:n=0,side2Score:i=0}=t;e[0]+=n,e[1]+=i}))})):Array.isArray(r)&&t.forEach((t=>{if(t.winningSide){const n=t.collectionPosition,i=Ne({collectionDefinition:U,collectionPosition:n});e[t.winningSide-1]+=i}}));const v=[0,0];if(t.forEach((t=>{t.winningSide&&(v[t.winningSide-1]+=1)})),o){let t;if(null!=d&&d.aggregateValue)i&&e[0]!==e[1]&&(t=e[0]>e[1]?1:2);else if(null!=d&&d.valueGoal)t=e.reduce(((t,e,n)=>e>=d.valueGoal?n+1:t),void 0);else{const e=Math.floor(U.matchUpCount/2)+1;t=v.reduce(((t,n,i)=>n>=e?i+1:t),void 0)}t&&(h?p[a].values[t-1]+=o:n[t-1]+=o)}else h?(p[a].values[0]+=e[0]||0,p[a].values[1]+=e[1]||0):n=e;h?(p[a].sideWins[0]+=v[0]||0,p[a].sideWins[1]+=v[1]||0,p[a].allGroupMatchUpsCompleted=p[a].allGroupMatchUpsCompleted&&i,p[a].matchUpsCount+=t.length):n.forEach(((t,e)=>c[e]+=t))}for(const U of m){const t=p[U];let e,{allGroupMatchUpsCompleted:n,groupValue:i,matchUpCount:r,sideWins:a,winCriteria:o,values:s}=t;if(null!=o&&o.aggregateValue)n&&s[0]!==s[1]&&(e=s[0]>s[1]?1:2);else if(null!=o&&o.valueGoal)e=s.reduce(((t,e,n)=>e>=o.valueGoal?n+1:t),void 0);else{const t=Math.floor(r/2)+1;e=a.reduce(((e,n,i)=>n>=t?i+1:e),void 0)}e&&(c[e-1]+=i)}const f=c.map(((e,n)=>e+t[n])),h={side1Score:f[0],side2Score:f[1]},v=f.join(e),I=f.slice().reverse().join(e);let g;if(null!==(o=n)&&void 0!==o&&o.winCriteria){const{valueGoal:t,aggregateValue:e}=n.winCriteria;if(t){const e=f.map(((t,e)=>({sideNumber:e+1,points:t}))).find((({points:e})=>e>=t));g=null==e?void 0:e.sideNumber}else if(e){u.every((t=>ge.includes(t.matchUpStatus)||t.winningSide))&&f[0]!==f[1]&&(g=f[0]>f[1]?1:2)}}return{scoreStringSide1:v,scoreStringSide2:I,winningSide:g,set:h}}function Ne({collectionDefinition:t,collectionPosition:e}){const n=t.collectionValueProfiles||[],i=null==n?void 0:n.find((t=>t.collectionPosition===e));return null==i?void 0:i.matchUpValue}const De="SET3-S:6/TB7";function Pe({winningSide:t,matchUpFormat:e=De,matchUpStatus:n,tallyPolicy:i,score:r}){const a=[0,0],{sets:o}=r||{},s=t-1,c=u(e),d=Te((null==c?void 0:c.bestOf)||1);return n===ae&&null!=i&&i.setsCreditForDefaults||n===pe&&null!=i&&i.setsCreditForWalkovers?a[s]=d:o&&o.forEach((t=>{const{winningSide:e}=t;e&&(a[e-1]+=1)})),n===ue&&(+a[1-s]===d&&(a[1-s]-=1),a[s]=d),a}function Te(t){return t&&Math.ceil(t/2)||1}function Me({participantIds:t,matchUpFormat:e,tallyPolicy:n,perPlayer:i,matchUps:r}){const a={};function o(t){a[t]||(a[t]={allDefaults:0,defaults:0,retirements:0,walkovers:0,matchUpsWon:0,matchUpsLost:0,victories:[],defeats:[],matchUpsCancelled:0,setsWon:0,setsLost:0,gamesWon:0,gamesLost:0,pointsWon:0,pointsLost:0})}return r.filter((e=>!(null!=t&&t.length)||2===F(t,[Ae(e,0),Ae(e,1)]).length)).forEach((t=>{const{matchUpStatus:i,score:r,winningSide:s}=t,c=s&&function(t){return Ae(t,t.winningSide-1)}(t),d=s&&function(t){return Ae(t,1-(t.winningSide-1))}(t);if(!c||!d){const e=Ae(t,0),n=Ae(t,1);return e&&(o(e),a[e].matchUpsCancelled+=1),void(n&&(o(n),a[n].matchUpsCancelled+=1))}const l=s&&s-1,p=1-l;o(c),o(d),i===pe&&(a[d].walkovers+=1),i===ae&&(a[d].defaults+=1),i===ue&&(a[d].retirements+=1),[ae,ue,pe].includes(i)&&(a[d].allDefaults+=1),a[c].matchUpsWon+=1,a[d].matchUpsLost+=1,a[d].defeats.push(c),a[c].victories.push(d);const m=Pe({score:r,matchUpStatus:i,matchUpFormat:e,tallyPolicy:n,winningSide:s});a[c].setsWon+=m[l],a[c].setsLost+=m[p],a[d].setsWon+=m[p],a[d].setsLost+=m[l];const f=function({winningSide:t,matchUpFormat:e=De,matchUpStatus:n,tallyPolicy:i,score:r}){var a,o;const{sets:s}=r||{},c=t-1,d=u(e);let l=0,p=0;const m=Te((null==d?void 0:d.bestOf)||1),f=(null==d||null===(a=d.setFormat)||void 0===a?void 0:a.setTo)||0,h=(null==d||null===(o=d.setFormat)||void 0===o?void 0:o.tiebreakAt)||0;if(!s)return[l,p];const v=m*f,I=[[],[]];if(n===ae&&null!=i&&i.gamesCreditForDefaults||n===pe&&null!=i&&i.gamesCreditForWalkovers?I[c].push(v):s&&s.forEach((t=>{({side1Score:l,side2Score:p}=t),I[0].push(parseInt(l||0)),I[1].push(parseInt(p||0))})),n===ue){const i=Pe({winningSide:t,matchUpStatus:n,matchUpFormat:e,sets:s}),r=i.reduce(((t,e)=>t+e),0);if(I.map((t=>t[c]<=t[1-c])).reduce(((t,e)=>t+e),0)>i[1-c]){const t=I[c].length,e=function(t){if(d&&""!==t)return+t==h-1||+t===h?parseInt(h||0)+1:+t<h?f:h}(I[1-c][t-1]);e&&(I[c][t-1]=e)}r>I[c].length&&I[c].push(f)}const g=[I[0].reduce(((t,e)=>t+e),0),I[1].reduce(((t,e)=>t+e),0)];return[ue,pe,ae].includes(n)&&g[c]<v&&(g[c]=v),g}({score:r,matchUpStatus:i,matchUpFormat:e,tallyPolicy:n,winningSide:s});a[c].gamesWon+=f[l],a[c].gamesLost+=f[p],a[d].gamesWon+=f[p],a[d].gamesLost+=f[l];const h=function({score:t}){var e;const n=[0,0];return null==t||null===(e=t.sets)||void 0===e||e.forEach((t=>{t.side1TiebreakScore&&(n[0]+=parseInt(t.side1TiebreakScore)),t.side2TiebreakScore&&(n[1]+=parseInt(t.side2TiebreakScore))})),n}({score:r,tallyPolicy:n});a[c].pointsWon+=h[l],a[c].pointsLost+=h[p],a[d].pointsWon+=h[p],a[d].pointsLost+=h[l]})),function({participantResults:t,matchUpFormat:e,perPlayer:n}){var i;const r=e&&u(e)||{},a=r.bestOf,o=a&&Math.ceil(a/2)||1,s=null===(i=r.setFormat)||void 0===i?void 0:i.setTo;Object.keys(t).forEach((e=>{const i=t[e].setsWon,r=t[e].setsLost,a=n*(o||0)||i;let c=Math.round(i/r*1e3)/1e3;(c===1/0||isNaN(c))&&(c=a);const u=t[e].matchUpsWon,d=t[e].matchUpsLost;let l=Math.round(u/d*1e3)/1e3;(l===1/0||isNaN(l))&&(l=u);const p=t[e].gamesWon||0,m=t[e].gamesLost||0,f=(n||0)*(o||0)*(s||0),h=Math.max(f,p+m);let v=Math.round(p/h*1e3)/1e3;(v===1/0||isNaN(v))&&(v=0);let I=Math.round(t[e].pointsWon/t[e].pointsLost*1e3)/1e3;(I===1/0||isNaN(I))&&(I=0),t[e].setsRatio=c,t[e].matchUpsRatio=l,t[e].gamesRatio=v,t[e].pointsRatio=I,t[e].result=`${t[e].matchUpsWon}/${t[e].matchUpsLost}`,t[e].games=`${t[e].gamesWon}/${t[e].gamesLost}`}))}({participantResults:a,perPlayer:i,matchUpFormat:e}),{participantResults:a}}function Ae(t,e){if(!t||!t.sides)return console.log("no sides:",{matchUp:t}),"foo";const n=t.sides[e];return n?n.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Ee(t){return ge.includes(null==t?void 0:t.matchUpStatus)||(null==t?void 0:t.winningSide)}const be=[{attribute:"matchUpsRatio",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsRatio",idsFilter:!1},{attribute:"gamesRatio",idsFilter:!1},{attribute:"pointsRatio",idsFilter:!1},{attribute:"matchUpsRatio",idsFilter:!0},{attribute:"setsRatio",idsFilter:!0},{attribute:"gamesRatio",idsFilter:!0},{attribute:"pointsRatio",idsFilter:!0}],Re={matchUpsRatio:16,setsRatio:12,gamesRatio:8,pointsRatio:4};function Ce(t){const{participantResults:e,subOrderMap:n,tallyPolicy:i}=t;if(!function({participantResults:t,participantsCount:e}){let n=Fe({participantResults:t}).filter((t=>e-1===t.results.matchUpsWon+t.results.matchUpsLost+t.results.matchUpsCancelled));return e===n.length}(t))return;const r=["matchUpsWon","pointsWon","gamesWon","setsWon","gamesRatio","setsRatio","pointsRatio","matchUpsRatio"].includes(null==i?void 0:i.groupOrderKey)?i.groupOrderKey:"matchUpsWon",a=Le({participantResults:e,attribute:r}),o=Object.keys(a).map((t=>parseFloat(t))).sort(((t,e)=>e-t)).map((t=>a[t])).map((e=>Oe({participantIds:e,...t}))).flat(1/0);let s,c=1;o.forEach(((t,e)=>{e&&(t.resolved||s&&!t.resolved)&&(c+=1),s=t.resolved,t.resolved?(t.position=e+1,c=t.position):t.position=c}));const u=A(o.map((({position:t})=>t)));return o.forEach((t=>{const r=e[t.participantId],a=u[t.position];void 0!==t&&void 0!==t.position&&(a>1&&(r.ties=a,n&&(r.subOrder=n[t.participantId])),t.groupOrder=t.position+(r.subOrder||1)-1,r.rankOrder=t.position),r.GEMscore=function(t){return(Array.isArray(null==i?void 0:i.GEMscore)?Object.keys(Re).filter((t=>i.GEMscore.includes(t))):Object.keys(Re)).map((e=>(t[e]||0)*Math.pow(10,Re[e]))).reduce(((t,e)=>t+e),0)}(r)})),o}function Oe({participantResults:t,disableHeadToHead:e,participantIds:n,matchUpFormat:i,tallyPolicy:r,matchUps:a}){if(1===n.length)return{resolved:!0,participantId:n[0]};if(2===n.length&&(null==r||!r.headToHead||!r.headToHead.disabled&&!e)){const e=function({participantIds:t,participantResults:e}){return e[t[0]].victories.includes(t[1])?t.map((t=>({resolved:!0,participantId:t}))):e[t[1]].victories.includes(t[0])?t.reverse().map((t=>({resolved:!0,participantId:t}))):void 0}({participantIds:n,participantResults:t});if(e)return e}let o;return((null==r?void 0:r.tallyDirectives)||be).every((({attribute:t,reversed:e,idsFilter:s,disableHeadToHead:c})=>(o=function({disableHeadToHead:t,participantIds:e,matchUpFormat:n,tallyPolicy:i,attribute:r,idsFilter:a,matchUps:o,reversed:s}){const{participantResults:c}=Me({participantIds:a&&e,matchUpFormat:n,tallyPolicy:i,matchUps:o}),u=Le({participantResults:c,participantIds:e,attribute:r});if(Object.keys(u).length>1)return Object.keys(u).map((t=>parseFloat(t))).sort(((t,e)=>s?t-e:e-t)).map((t=>u[t])).map((e=>Oe({participantResults:c,disableHeadToHead:t,participantIds:e,matchUpFormat:n,tallyPolicy:i,matchUps:o}))).flat(1/0)}({disableHeadToHead:c,participantIds:n,matchUpFormat:i,tallyPolicy:r,attribute:t,idsFilter:s,matchUps:a,reversed:e}),!o))),o||n.map((t=>({participantId:t})))}function Le({participantResults:t,participantIds:e,attribute:n}){return Fe({participantResults:t,participantIds:e}).reduce(((t,e)=>{const{participantId:i,results:r}=e,a=r[n];return t[a]?t[a].push(i):t[a]=[i],t}),{})}function Fe({participantResults:t,participantIds:e}){return(e=e||Object.keys(t)).reduce(((e,n,i)=>(e.push({participantId:n,i:i,results:t[n]}),e)),[])}function xe({policyDefinitions:t,matchUpFormat:e,matchUps:n=[],subOrderMap:i,perPlayer:r}){if(!Array.isArray(n))return{error:"Missing matchUps"};if(1!==n.reduce(((t,{structureId:e})=>t.includes(e)?t:t.concat(e)),[]).length)return{error:$};const a=n.filter((t=>t&&t.matchUpStatus!==ne)),o=a.length&&T(a.map((({drawPositions:t})=>t)).flat()).length,s=a.filter(Ee).length===a.length;s||(r=0);const c=t&&t.roundRobinTally,u=n.filter(Ee),{participantResults:d}=Me({matchUps:u,matchUpFormat:e,tallyPolicy:c,perPlayer:r}),l=Ce({matchUps:u,participantResults:d,participantsCount:o,matchUpFormat:e,tallyPolicy:c,subOrderMap:i});return s&&l&&l.forEach((t=>{d[t.participantId].groupOrder=t.groupOrder})),{participantResults:d}}const ke=t=>{var e;const{isSide1:n,lowValue:i,setTo:r,tiebreakAt:a,NoAD:o}=t;if(void 0===i)return{error:z};let s,c=parseInt(i);return(null===(e=c)||void 0===e?void 0:e.toString().length)>2&&(c=parseInt(c.toString().slice(0,2))),a&&a<r&&c>a&&(c=a),s=o&&!a?c<r?r:r-1:c+1<r||a&&a<r&&c===a?r:a?r+1:c+2,[n?c:s,n?s:c]},_e=t=>{var e;const{isSide1:n,lowValue:i,tiebreakTo:r,tiebreakNoAd:a}=t;if(void 0===i)return{error:z};let o=parseInt(i);(null===(e=o)||void 0===e?void 0:e.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),a&&o>r-1&&(o=r-1);const s=function(t){const{lowValue:e,NoAD:n,tiebreakTo:i}=t;return e+1>=i?e+(n?1:2):i}({lowValue:o,NoAD:a,tiebreakTo:r});return[n?o:s,n?s:o]};function Be({analysis:t,set:e}){const n=Ve({set:e}),{isDecidingSet:i,isTiebreakSet:r,matchUpScoringFormat:a}=t;return je({matchUpScoringFormat:a,isDecidingSet:i,isTiebreakSet:r,set:e})&&n}function je({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:n,isTiebreakSet:i,isDecidingSet:r,set:a}){var o;if(!a)return{error:z};e=e||n;const s=r&&e.finalSetFormat||(null===(o=e)||void 0===o?void 0:o.setFormat)||{},{side1Score:c,side2Score:u}=a,{NoAD:d,setTo:l,tiebreakAt:p,tiebreakFormat:m}=s,f=null==m?void 0:m.NoAd,h=Ve({set:a}),v=Math.abs(c-u),I=c>=l||u>=l,g=i||c>=l&&u>=l||p&&p<l&&(c===p||u===p),U=t||g&&(1===h&&a.side1TiebreakScore>a.side2TiebreakScore||2===h&&a.side2TiebreakScore>a.side1TiebreakScore);return(I&&(v>=(d||g&&(p&&!i||i&&f)?1:2)||g)||i)&&(!g||U)}function Ve({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}const Ge=["RET","DEF","WO","WO/WO","ABN","SUS","INT"],qe="ABANDONED",He="SUSPENDED",We="INTERRUPTED",ze=["RETIRED","DEFAULTED","WALKOVER"],Ke=["up","left","shift+tab"],Ye=["enter","down","tab","right"],$e="backspace",Je=["r","d","w","a","s","i"],Ze=["[","("],Qe=[...Ke,...Ye,"space","]"],Xe="-",tn="-",en=["/"],nn=["0","1","2","3","4","5","6","7","8","9"].concat(Je),rn=nn.map((t=>`shift+${t}`)),an=[Xe,$e].concat(Qe,en),on=[nn,rn,an].join(","),sn=[on,Ke,Ye,["=","+","num_1","num_2","shift+=","shift+-"]].join(",");[].concat(...nn,...nn,...an,...nn,...nn,...nn,...nn,...nn,...nn);const cn={SIDE1KEYS:nn,SIDE2KEYS:rn,MODIFIERS:an,PROMPT:"Enter Score",MOVEUP:Ke,MOVEDOWN:Ye,HOTKEYS:sn};function un({scoreString:t,lowSide:e,outcome:n}){return({scoreString:t}=dn({scoreString:t})),2===e?t+(" "!==(t&&t[t.length-1])?" ":"")+n:n+" "+t}function dn({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(const i of Ge){var n;const r=null===(n=t)||void 0===n?void 0:n.indexOf(i);0===r?t=t.slice(i.length+1).trim()+" ":r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t&&t.trim()||(t=""),{scoreString:t,removed:e}}function ln({analysis:t,scoreString:e,sets:n,lowSide:i}){let r,a;if(!e)return{scoreString:e,sets:n};const{scoreString:o,removed:s}=dn({scoreString:e});if(e=o,s)return{scoreString:e,sets:n,outcomeRemoved:!0};let c=n[n.length-1]||{};const u=Object.values(c).filter((t=>void 0!==t)).length;c.setNumber&&1===u&&(c=(n=n.slice(0,n.length-1))[n.length-1]||{});const{tiebreakSet:d}=t.setFormat,{tiebreakTo:l,NoAD:p}=d||{},{isTiebreakEntry:m}=pn({scoreString:e,brackets:"[]"}),f=function(t){return t.split("").reduce(((t,e,n)=>(e.match(/\d+/g)&&t.push(n),t)),[]).pop()}(e);if(f>=0){r=e.slice(0,f);const{isTiebreakEntry:o}=pn({scoreString:r,brackets:"()"}),{lastOpenBracketIndex:s,isTiebreakEntry:u}=pn({scoreString:r,brackets:"[]"}),d=r&&r[r.length-1].trim(),w=r&&!isNaN(d);let N=t.isIncompleteSetScore;if(m&&u){const t=r.slice(s+1).split(tn),n=(null==t?void 0:t.length)>0&&void 0!==t[0]&&!isNaN(parseInt(t[0]))&&parseInt(t[0])||void 0,a=(null==t?void 0:t.length)>1&&void 0!==t[1]&&parseInt(t[1])||void 0,o=[n,a];if(a){const t=1===i?1:0;o[t]=o[1-t]+(p?1:2),o[t]<l&&(o[t]=l),r=e.slice(0,s+1),r+=o.join(tn)}else void 0!==n?(r=e.slice(0,s+1),r+=n):(r=e.slice(0,s),N=!0);c.side1TiebreakScore=o[0]||0,c.side2TiebreakScore=o[1]||0}if(r.length||(r=void 0),N){var h;const e=null===(h=c.side1Score)||void 0===h?void 0:h.toString();if(e){const t=null==e?void 0:e.slice(0,e.length-1);c.side1Score=!isNaN(t)&&parseInt(t)||void 0,void 0===c.side1Score&&(c.side2Score=void 0)}var v,I;t.isTimedSet?(a=c.side1Score?n:(null===(v=n)||void 0===v?void 0:v.slice(0,n.length-1))||[],a[n.length-1]=c):a=(null===(I=n)||void 0===I?void 0:I.slice(0,n.length-1))||[]}else if(w){var g,U;const e=null===(g=c.side2Score)||void 0===g?void 0:g.toString(),i=null===(U=c.side1Score)||void 0===U?void 0:U.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(c.side2Score){const t=null==e?void 0:e.slice(0,e.length-1);c.side2Score=!isNaN(t)&&parseInt(t)||void 0}else{const t=null==i?void 0:i.slice(0,i.length-1);c.side1Score=!isNaN(t)&&parseInt(t)||void 0}var y;t.isTimedSet?c.side1Score?(a=n||[],a[n.length-1]=c):a=(null===(y=n)||void 0===y?void 0:y.slice(0,n.length-1))||[]:(a=n||[],a[n.length-1]=c),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else if(o)a=n||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0});else{var S;m&&!u?a=(null===(S=n)||void 0===S?void 0:S.slice(0,n.length-1))||[]:(a=n,a[n.length-1]=c),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0)}return{scoreString:r,sets:a}}return{scoreString:e,sets:n}}function pn({scoreString:t,brackets:e="()"}){if(!t)return!1;const[n,i]=e.split(""),r=t.split(""),a=Math.max(...L(n,r));return{isTiebreakEntry:a>Math.max(...L(i,r)),lastOpenBracketIndex:a}}function mn({lowValue:t=0,NoAD:e=!1,tiebreakTo:n}={}){return t+1>=n?t+(e?1:2):parseInt(n)}function fn({matchUpFormat:t,matchUpStatus:e,winningSide:n,sets:i}){const r=u(t),{bestOf:a}=r,o=Math.ceil(a/2),s=i&&i.reduce(((t,e)=>{const{winningSide:n}=e;return n&&t[n-1]++,t}),[0,0]);let c=(null==s?void 0:s.indexOf(o))+1||void 0;return ze.includes(e)&&n&&(c=n),{matchUpWinningSide:c}}function hn({lowSide:t,value:e,sets:n,scoreString:i,winningSide:r,matchUpStatus:a}){let o;return"r"===e?i?(o=!0,i=un({scoreString:i,lowSide:t,outcome:"RET"}),r=2===t?1:2,a="RETIRED"):(o=!0,i=un({scoreString:i,lowSide:t,outcome:"DEF"}),r=2===t?1:2,a="DEFAULTED"):"d"===e?(o=!0,i=un({scoreString:i,lowSide:t,outcome:"DEF"}),r=2===t?1:2,a="DEFAULTED"):"w"===e?(o=!0,n=[],i="WO",r=2===t?1:2,a="WALKOVER"):"s"===e&&i?(o=!0,i=un({scoreString:i,lowSide:t,outcome:"SUS"}),a=He,r=void 0):"a"===e?(o=!0,i=un({scoreString:i,lowSide:t,outcome:"ABN"}),a=qe,r=void 0):"i"===e&&i&&(o=!0,i=un({scoreString:i,lowSide:t,outcome:"INT"}),a=We,r=void 0),{updated:o,sets:n,scoreString:i,matchUpStatus:a,winningSide:r}}function vn({sets:t,scoreString:e,winningSide:n,matchUpFormat:i,value:r}){var a,o;const s=((null==t||null===(a=t.filter((t=>null==t?void 0:t.winningSide)))||void 0===a?void 0:a.length)||0)+(n?0:1),c=u(i),d=s===(null==c?void 0:c.bestOf),l=d&&c.finalSetFormat||c.setFormat||{},p=(null==l?void 0:l.timed)||c.timed,m=d&&t[(null==c?void 0:c.bestOf)-1],f=m&&m.winningSide,{isTiebreakEntry:h}=pn({scoreString:e,brackets:"()"}),{isTiebreakEntry:v}=pn({scoreString:e,brackets:"[]"}),I=h||v,g=!!l.tiebreakSet,U=e&&e[e.length-1].trim(),y=e&&!isNaN(U),S=!I&&U===Xe,w=h&&Ze.includes(U),N=v&&Ze.includes(U),D=v&&U===tn,P=e&&e.split(""),[T]="[]".split(""),M=P&&Math.max(...L(T,P)),A=P&&Math.max(...L(tn,P)),E=P&&A>M,b=null===(o=t[t.length-1])||void 0===o?void 0:o.winningSide,R=(null==t?void 0:t.length)&&!b,C=Ge.find((t=>(null==e?void 0:e.indexOf(t))>=0)),O=!isNaN(r),F="space"===r,x=Qe.includes(r),k=null==e?void 0:e.split("").find((t=>Ze.includes(t)));return{isTiebreakSetValue:g&&O,matchUpScoringFormat:c,setNumber:s,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:R,isSpace:F,isCloser:x,isTiebreakCloser:x&&k&&I&&y,isDecidingSet:d,isTiebreakSet:g,isTimedSet:p,isNumericEnding:y,isNumericValue:O,hasOpener:k,hasOutcome:C,finalSet:m,finalSetIsComplete:f,lastSetIsComplete:b,isInvalidSetTiebreakValue:F&&I&&w,isInvalidMatchTiebreakValue:x&&v&&!N&&(D||!function({scoreString:t}){if(!t)return!1;const e=t&&t[t.length-1].trim(),n=t&&!isNaN(e),[i,r]="[]".split(""),a=t.split(""),o=Math.max(...L(i,a)),s=Math.max(...L(r,a)),c=Math.max(...L(tn,a));return n&&o>s&&c>o}({scoreString:e})),isTiebreakEntry:I,isSetTiebreakEntry:h,isMatchTiebreakEntry:v,isIncompleteSetScore:S,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:N,isPartialMatchTiebreakValue:D}}function In(t){const{sets:e,winningSide:n,autoComplete:i,matchUpStatus:r,reversed:a=!1,winnerFirst:o=!0,addOutcomeString:s}=t;if(!e)return{error:z};const c=a||!(!o||!n||1===n),u=s?function({matchUpStatus:t}){return t&&{[ue]:"RET",[pe]:"WO",[oe]:"WO/WO",[de]:"SUS",[ee]:"ABN",[ae]:"DEF",DEAD_RUBBER:"DR"}[t]||""}({matchUpStatus:r}):"",d=(null==e?void 0:e.sort(gn).map((function(t){const e=!(U(null==(d=t)?void 0:d.side1Score)||U(null==d?void 0:d.side2Score))&&(t=>U(null==t?void 0:t.side1TiebreakScore)||U(null==t?void 0:t.side2TiebreakScore))(t),{side1Score:n,side2Score:r,side1TiebreakScore:a,side2TiebreakScore:o}=t,s=a||(U(a)||i?0:""),u=o||(U(o)||i?0:"");var d;if(e)return`[${(c?[u,s]:[s,u]).join("-")}]`;const l=Math.min(s,u),p=l?`(${l})`:"",m=n||(U(n)||i?0:""),f=r||(U(r)||i?0:"");let h=c?`${[f,m].join("-")}${p}`:`${[m,f].join("-")}${p}`;return["-"," "].includes(h)&&(h=""),h})).filter(Boolean).join(" "))||"";return u?2===n?`${u} ${d}`:`${d} ${u}`:d}function gn(t,e){return t.setNumber-e.setNumber}function Un({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:n,setObject:i}){if(!i)return;const r=yn({set:i});return function({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:n,isTiebreakSet:i,isDecidingSet:r,set:a}){var o;if(!a)return{error:z};e=e||n;const s=r&&e.finalSetFormat||(null===(o=e)||void 0===o?void 0:o.setFormat)||{},{side1Score:c,side2Score:u}=a,{setTo:d,tiebreakAt:l,tiebreakFormat:p}=s,m=null==p?void 0:p.NoAd,f=yn({set:a}),h=Math.abs(c-u),v=c>=d||u>=d,I=i||c>=d&&u>=d||l&&l<d&&(c===l||u===l),g=t||I&&(1===f&&a.side1TiebreakScore>a.side2TiebreakScore||2===f&&a.side2TiebreakScore>a.side1TiebreakScore);return(v&&(h>=(I&&(l&&!i||i&&m)?1:2)||I)||i)&&(!I||g)}({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:n,set:i})&&r||void 0}function yn({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function Sn(t){const{setObject:e,matchUpScoringFormat:n}=t;if(!e)return{error:"Missing setObject"};const{setNumber:i}=e||{},{bestOf:r}=n||{},a=!(!i||!r||i!==r),o=a&&(null==n?void 0:n.finalSetFormat)||(null==n?void 0:n.setFormat),s=!(null==o||!o.tiebreakSet),c=!(null==o||!o.timed),u=!s&&!c,d=!!(i&&r&&i<=r),l=[null==e?void 0:e.side1Score,null==e?void 0:e.side2Score],p=[null==e?void 0:e.side1PointScore,null==e?void 0:e.side2PointScore],m=[null==e?void 0:e.side1TiebreakScore,null==e?void 0:e.side2TiebreakScore],f=l.filter((t=>void 0!==t)).length,h=p.filter((t=>void 0!==t)).length,v=m.filter((t=>void 0!==t)).length,I=null==l?void 0:l.filter((t=>!isNaN(t))).length,g=null==m?void 0:m.filter((t=>!isNaN(t))).length,{tiebreakAt:U}=o||{},y=U&&2===l.filter((t=>t>=U)).length,S=y&&(l[0]>l[1]?1:l[1]>l[0]?2:void 0),w=!(!g||I),N=!(!e||null==e||!e.winningSide),{error:D,result:P}=function({setObject:t,setFormat:e,sideGameScores:n,sideTiebreakScores:i}){if(!t)return{result:!1,error:"Missing setObject"};const r=!(null==e||!e.tiebreakSet),a=!(null==e||!e.timed);if(!e||r||a)return{result:!1,error:"not standard set"};if(2!==(null==n?void 0:n.filter((t=>!isNaN(t))).length))return{result:!1,error:"Invalid game scores"};const{setTo:o,tiebreakAt:s,tiebreakFormat:c,NoAD:u}=e||{};if(!o||null==n||!n.find((t=>t>=o)))return{result:!1,error:"Invalid game scores"};const d=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!d)return{result:!1,error:"Invalid winningSide"};const l=(null==t?void 0:t.winningSide)-1,p=1-l,m=n[l],f=n[p],h=m-f;if(!(m>f))return{result:!1,error:"winningSide game scoreString is not high"};const v=s&&c,I=2===(null==i?void 0:i.filter((t=>!isNaN(t))).length),g=i&&i[l],U=i&&i[p],y=s&&2===n.filter((t=>t>=s)).length;if(v){const{NoAD:t,tiebreakTo:e}=c;if(y){if(h>1)return{result:!1,error:"invalid winning game scoreString (5)"};if(!I)return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(e))return{result:!1,error:"tiebreakTo error"};if(!e||null==i||!i.find((t=>t>=e)))return{result:!1,error:"invalid tiebreak scores (2)"};if(m>(s<o?o:o+1))return{result:!1,error:"invalid winning game scoreString (1)"};if(!g||!U||g<U)return{result:!1,error:"winningSide tiebreak value is not high"};const n=t?1:2,r=g-U,a=U>=e-1;if(r&&a&&r<n)return{result:!1,error:"invalid tiebreak scores (3)"}}if(m>o&&(!v||!y))return{result:!1,error:"invalid winning game scoreString (2)"}}const S=u?1:2;return h&&f>=o-1&&!y&&h<S?{result:!1,error:"invalid winning game scoreString (3)"}:h>S&&m>o?{result:!1,error:"invalid winning game scoreString (4)"}:{result:!0}}({setObject:e,setFormat:o,sideGameScores:l,sideTiebreakScores:m}),{error:T,result:M}=function({setObject:t,setFormat:e,sideTiebreakScores:n}){if(!t)return{result:!1,error:"Missing setObject"};const i=!(null==e||!e.tiebreakSet),r=!(null==e||!e.timed);if(!e||!i||r)return{result:!1,error:"not tiebreak set"};const a=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!a)return{result:!1,error:"Invalid winningSide"};const{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:c}=o||{};if(2!==(null==n?void 0:n.filter((t=>!isNaN(t))).length))return{result:!1,error:"invalid tiebreak scores (1)"};if(isNaN(c))return{result:!1,error:"tiebreakTo error"};if(null==n||!n.find((t=>t>=c)))return{result:!1,error:"invalid tiebreak scores (2)"};const u=(null==t?void 0:t.winningSide)-1,d=1-u,l=n[u],p=n[d];if(!l||!p||l<p)return{result:!1,error:"winningSide tiebreak value is not high"};const m=l-p;return m&&p>=c-1&&m<(s?1:2)?{result:!1,error:"invalid tiebreak scores (3)"}:{result:!0}}({setObject:e,setFormat:o,sideTiebreakScores:m}),A=u&&!w&&P||s&&w&&M,E={expectTiebreakSet:s,expectTimedSet:c,hasTiebreakCondition:y,isCompletedSet:N,isDecidingSet:a,isTiebreakSet:w,isValidSet:d&&!(s&&!w)&&!(u&&w)&&(!N||A),isValidSetNumber:d,isValidSetOutcome:A,leadingSide:S,setFormat:o,sideGameScores:l,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:h,sideTiebreakScores:m,sideTiebreakScoresCount:v,winningSide:Un({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:n,setObject:e})};return void 0!==(null==e?void 0:e.winningSide)&&(w?(E.isValidTiebreakSetOutcome=M,M||(E.tiebreakSetError=T)):(E.isValidStandardSetOutcome=P,P||(E.standardSetError=D))),E}function wn(t){var e;const{matchUp:n,sideNumber:i,setNumber:r,isTiebreakValue:a,isPointValue:o}=t||{};let{matchUpFormat:s}=t||{};if(!n)return{error:"Missing matchUp"};s=s||(null==n?void 0:n.matchUpFormat);const c=u(s),d=!(null==n||!n.winningSide),l=null===(e=n.score)||void 0===e?void 0:e.sets,p=null==l?void 0:l.length,m=r&&r-1,f=!(null==l||!l.find(((t,e)=>t.setNumber===r&&e===m))),h=(null==l?void 0:l.filter((t=>null==t?void 0:t.winningSide)))||[],v=(null==h?void 0:h.length)||0,I=r&&(null==l?void 0:l.slice(r))||[],g=!!(p&&r&&null!=I&&I.reduce(((t,e)=>(!e||!e.side1Score&&!e.side2Score&&!e.side1TiebreakScore&&!e.side2TiebreakScore&&!e.side1PointScore&&!e.side2PointScore)&&t),!0)),U=r<=p&&l.find((t=>t.setNumber===r)),y=U&&Sn({setObject:U,matchUpScoringFormat:c}),{isCompletedSet:S,sideGameScores:w,sideTiebreakScores:N}=y||{},D=!!(U&&!S&&g||r&&r===p+1&&!d),P=[1,2].includes(i),T=P?i-1:0,M=U&&P&&(!a&&!o&&void 0!==w[T]&&w[T]||a&&void 0!==N[T]&&N[T]),E=!!M,b=h&&h.map((t=>Sn({setObject:t,matchUpScoringFormat:c}).isValidSetOutcome)).reduce(((t,e)=>t&&e),!0),R=h.reduce(((t,e)=>{const{winningSide:n}=e;return t[n-1]++,t}),[0,0]),C=null==n?void 0:n.winningSide,O=C&&C-1,L=1-O,F=R[O],x=R[L],k=Math.max(...R),_=A(R)[k],{bestOf:B}=c||{},j=k===(B&&Math.ceil(B/2)||1)&&1===_&&R.indexOf(k)+1||void 0,V=F>x&&C===j;return{isActiveSet:D,isExistingSet:f,existingValue:M,hasExistingValue:E,isValidSideNumber:P,completedSetsCount:v,isCompletedMatchUp:d,isLastSetWithValues:g,validMatchUpOutcome:j&&b&&V,matchUpScoringFormat:c,calculatedWinningSide:j,validMatchUpWinningSide:V,completedSetsHaveValidOutcomes:b,...y}}function Nn({categoryName:t,categoryType:e,timesBlockArray:n}){return n.filter((t=>Array.isArray(t))).map((n=>n.sort(((t,e)=>{var n,i;return((null===(n=e.categoryNames)||void 0===n?void 0:n.length)||0)-((null===(i=t.categoryNames)||void 0===i?void 0:i.length)||0)})).find((({categoryTypes:n,categoryNames:i})=>!(null!=i&&i.length)&&!(null!=n&&n.length)||(null==i?void 0:i.includes(t))||(null==n?void 0:n.includes(e)))))).find(Boolean)}function Dn({matchUpAverageTimes:t,matchUpFormat:e}={}){const n=(null==t?void 0:t.map((({matchUpFormatCodes:t})=>null==t?void 0:t.filter((t=>t===e)))).flat().filter(Boolean).sort(((t,e)=>((null==t?void 0:t.length)||0)-((null==e?void 0:e.length)||0))))||[],i=n.includes(e)?e:n[0],r=null==t?void 0:t.find((({matchUpFormatCodes:t,averageTimes:e})=>(null==t?void 0:t.find((t=>i===t)))&&e));return null==r?void 0:r.averageTimes}function Pn({matchUpRecoveryTimes:t,averageMinutes:e,matchUpFormat:n}={}){var i;return null==t||null===(i=t.find((({matchUpFormatCodes:t,averageTimes:i,recoveryTimes:r})=>{if(i&&e){const{greaterThan:t=0,lessThan:n=360}=i;if(e>t&&e<n)return!0}return(null==t?void 0:t.find((t=>t===n)))&&r})))||void 0===i?void 0:i.recoveryTimes}const Tn={APPLIED_POLICIES:"appliedPolicies",DELEGATED_OUTCOME:"delegatedOutcome",DISABLE_LINKS:"disableLinks",DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:"entryProfile",FLIGHT_PROFILE:"flightProfile",GROUPING_ATTRIBUTE:"groupingAttribute",LINEUPS:"lineUps",LINKED_TOURNAMENTS:"linkedTournamentsIds",PARTICIPANT_REPRESENTATIVES:"participantRepresentatives",PERSON_REQUESTS:"personRequests",SCHEDULE_LIMITS:"scheduleLimits",SCHEDULE_TIMING:"scheduleTiming",SCHEDULING_PROFILE:"schedulingProfile",SUB_ORDER:"subOrder",TALLY:"tally"};function Mn({tournamentRecord:t}){return En({extensions:(null==t?void 0:t.extensions)||[]})}function An({event:t}){return t?En({extensions:t.extensions||[]}):{error:W}}function En({extensions:t}){const e=t.find((t=>"appliedPolicies"===t.name));return{appliedPolicies:(null==e?void 0:e.value)||{}}}function bn({tournamentRecord:t,event:e,policyType:n}){if(!t)return{error:G};if(e){const{appliedPolicies:t}=An({event:e});if(t&&t[n])return{policy:t[n]}}const{appliedPolicies:i}=Mn({tournamentRecord:t});return null!=i&&i[n]?{policy:i[n]}:{error:"Policy not found"}}function Rn({tournamentParticipants:t=[],policyDefinitions:e={},participantId:n,personId:i}){const r=t.find((t=>n&&t.participantId===n||i&&t.person&&t.person.personId===i)),a=null==e?void 0:e.participant;return null!=a&&a.participant?D({template:a.participant,source:r}):Ht(r)}function Cn({tournamentRecord:t,participantId:e}){return{participant:(t.participants||[]).reduce(((t,n)=>n.participantId===e?n:t),void 0)}}function On({element:t,name:e}){if(!t||!e)return{error:z};if(!Array.isArray(t.extensions))return{message:J};const n=t.extensions.find((t=>(null==t?void 0:t.name)===e));return{extension:n,message:n?void 0:J}}function Ln({tournamentRecord:t,name:e}){return On({element:t,name:e})}function Fn({event:t,name:e}){return t?On({element:t,name:e}):{error:W}}function xn({drawDefinition:t,name:e}){return t?On({element:t,name:e}):{error:q}}function kn({tournamentRecord:t,categoryName:e,categoryType:n,event:i}){var r,a,o;e=e||(null==i||null===(r=i.category)||void 0===r?void 0:r.categoryName)||(null==i||null===(a=i.category)||void 0===a?void 0:a.ageCategoryCode),n=n||(null==i||null===(o=i.category)||void 0===o?void 0:o.categoryType);const{policy:s}=bn({policyType:"scheduling",tournamentRecord:t,event:i}),{extension:c}=Ln({tournamentRecord:t,name:"scheduleTiming"}),u=null==c?void 0:c.value,{extension:d}=Fn({event:i,name:"scheduleTiming"});return{scheduleTiming:{categoryName:e,categoryType:n,eventScheduling:null==d?void 0:d.value,tournamentScheduling:u,policy:s}}}const _n="total",Bn={TOTAL:_n,SINGLES_DOUBLES:"SINGLES_DOUBLES",DOUBLES_SINGLES:"DOUBLES_SINGLES"};function jn({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:n,matchUpFormat:i,categoryName:r,categoryType:a,eventType:o,event:s}){if(!n)return{error:G};o=o||(null==s?void 0:s.eventType);const c={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:u}=kn({tournamentRecord:n,categoryName:r,categoryType:a,event:s});return Vn({eventType:o,timingDetails:{...u,matchUpFormat:i,categoryType:a,defaultTiming:c}})}function Vn({eventType:t,timingDetails:e}){const n=function({matchUpFormat:t,categoryName:e,categoryType:n,defaultTiming:i,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;return Nn({categoryName:e,categoryType:n,timesBlockArray:[(null==a?void 0:a.matchUpAverageTimes)&&Dn({...a,matchUpFormat:t}),(null==r?void 0:r.matchUpAverageTimes)&&Dn({...r,matchUpFormat:t}),(null==o?void 0:o.matchUpAverageTimes)&&Dn({...o,matchUpFormat:t}),null==o||null===(s=o.defaultTimes)||void 0===s?void 0:s.averageTimes,null==i?void 0:i.averageTimes]})}(e),i=Object.keys((null==n?void 0:n.minutes)||{}),r=(null==n?void 0:n.minutes)&&((null==i?void 0:i.includes(t))&&n.minutes[t]||n.minutes.default),a=function({matchUpFormat:t,categoryName:e,categoryType:n,averageMinutes:i,defaultTiming:r,tournamentScheduling:a,eventScheduling:o,policy:s}){var c;return Nn({categoryName:e,categoryType:n,timesBlockArray:[(null==o?void 0:o.matchUpRecoveryTimes)&&Pn({...o,averageMinutes:i,matchUpFormat:t}),(null==a?void 0:a.matchUpRecoveryTimes)&&Pn({...a,averageMinutes:i,matchUpFormat:t}),(null==s?void 0:s.matchUpRecoveryTimes)&&Pn({...s,averageMinutes:i,matchUpFormat:t}),null==s||null===(c=s.defaultTimes)||void 0===c?void 0:c.recoveryTimes,null==r?void 0:r.recoveryTimes]})}({...e,averageMinutes:r}),o=Object.keys((null==a?void 0:a.minutes)||{}),s=(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(t))&&a.minutes[t]||a.minutes.default),c=t===$t?"SINGLES_DOUBLES":"DOUBLES_SINGLES";return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:(null==a?void 0:a.minutes)&&((null==o?void 0:o.includes(c))&&a.minutes[c]||s)}}function Gn({tournamentRecord:t}){if(!t)return{error:G};const e=Ht(t.venues||[]),n=e.reduce(((t,e)=>{var n;return null!=e&&null!==(n=e.courts)&&void 0!==n&&n.length?t.concat(e.courts):t}),[]);return{venues:e,courts:n}}function qn({tournamentRecord:t,venueId:e}){if(!t)return{error:G};if(!e)return{error:"Missing venueId"};const n=(t.venues||[]).reduce(((t,n)=>n.venueId===e?n:t),void 0);return n&&{venue:n}||{error:"Venue not found"}}function Hn({tournamentRecord:t,courtId:e}){if(!t)return{error:G};if(!e)return{error:"Missing courtId"};let n,i;return(t.venues||[]).forEach((t=>{(t.courts||[]).forEach((r=>{r.courtId===e&&(n=r,i=t)}))})),n&&{court:n,venue:i}||{error:"Court not found"}}function Wn({tournamentRecord:t,venueId:e,venueIds:n}){return t?{courts:(t.venues||[]).filter((t=>e?t.venueId===e:n?n.includes(t.venueId):!e&&!n)).map((t=>{const{venueId:e}=t,n=Ht(t.courts||[]);return n.forEach((t=>Object.assign(t,{venueId:e}))),n})).flat()}:{error:G}}function zn({tournamentRecord:t,courtId:e}){if(!t)return{error:G};if(!e)return{error:"Missing courtId"};const{court:n,error:i}=Hn({tournamentRecord:t,courtId:e});if(i)return{error:i};const r=(({altitude:t,courtId:e,courtName:n,courtDimensions:i,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d})=>({altitude:t,courtId:e,courtName:n,courtDimensions:i,latitude:r,longitude:a,surfaceCategory:o,surfaceType:s,surfaceDate:c,pace:u,notes:d}))(n);return{...B,courtInfo:Ht(r)}}function Kn({tournamentRecord:t,venueId:e}){if(!t)return{error:G};if(!e)return{error:"Missing venueId"};const{venue:n,error:i}=qn({tournamentRecord:t,venueId:e});if(i)return{error:i};const r=(n.courts||[]).map((e=>(({courtInfo:t})=>({...t}))(zn({tournamentRecord:t,courtId:e.courtId})))),a={...(({venueId:t,venueName:e,venueAbbreviation:n})=>({venueId:t,venueName:e,venueAbbreviation:n}))(n),courtsInfo:r};return{...B,venueData:Ht(a)}}function Yn({tournamentRecord:t,eventId:e,drawId:n}){if(!t)return{error:G};const i=(null==t?void 0:t.events)||[];if(n){let t;const e=i.find((e=>{const i=((null==e?void 0:e.drawDefinitions)||[]).find((t=>t.drawId===n));return i&&(t=i),i}));if(e)return{event:e,drawDefinition:t}}if(e){const t=i.find((t=>t.eventId===e));return t?{event:t}:{error:"Event not found"}}return{error:z}}function $n({tournamentRecord:t,drawId:e}){if(!t)return{error:G};if(!e)return{error:"Missing drawId"};const n=(t.events||[]).reduce(((t,n)=>{const i=(n.drawDefinitions||[]).reduce(((t,n)=>n.drawId===e?n:t),void 0);return i&&i.drawId===e?{event:n,drawDefinition:i}:t}),void 0);return n?{...n,SUCCESS:B}:{error:"drawDefinition not found"}}function Jn(t,e,n){const i=t=>t.createdAt?new Date(t.createdAt).getTime():0,r=t.filter((t=>t&&t.itemType===e&&(!n||i(t)<n))).sort(((t,e)=>i(t)-i(e))).pop();return r&&r.itemValue}const Zn="CHECK_IN",Qn="CHECK_OUT",Xn="SCHEDULE.ASSIGNMENT.COURT",ti="SCHEDULE.ASSIGNMENT.VENUE",ei="SCHEDULE.DATE",ni="SCHEDULE.ASSIGN.OFFICIAL",ii="SCHEDULE.TIME.SCHEDULED",ri="SCHEDULE.TIME.START",ai="SCHEDULE.TIME.STOP",oi="SCHEDULE.TIME.RESUME",si="SCHEDULE.TIME.END",ci="SCALE",ui="PUBLIC",di={ASSIGN_COURT:Xn,ASSIGN_OFFICIAL:ni,ASSIGN_VENUE:ti,CHECK_IN:Zn,CHECK_OUT:Qn,END_TIME:si,MEDICAL:"MEDICAL",OTHER:"other",PENALTY:"PENALTY",PUBLIC:ui,PUBLISH:"PUBLISH",RANKING:"RANKING",RATING:"RATING",RESUME_TIME:oi,RETRIEVAL:"RETRIEVAL",SCALE:ci,SCHEDULED_DATE:ei,SCHEDULED_TIME:ii,SEEDING:"SEEDING",START_TIME:ri,STATUS:"STATUS",STOP_TIME:ai,SUSPENSION:"SUSPENSION"};function li({matchUp:t,visibilityThreshold:e}){return{scheduledTime:Jn((null==t?void 0:t.timeItems)||[],ii,e)}}function pi({matchUp:t,visibilityThreshold:e}){return{scheduledDate:Jn((null==t?void 0:t.timeItems)||[],ei,e)}}function mi({matchUp:t,visibilityThreshold:e}){return{courtId:Jn((null==t?void 0:t.timeItems)||[],Xn,e)}}function fi({matchUp:t,visibilityThreshold:e}){return{venueId:Jn((null==t?void 0:t.timeItems)||[],ti,e)}}function hi(t){if(gt.test(t)){const e=Nt();return new Date(`${e}T${t}`)}return new Date(t)}function vi({matchUp:t}){if(!t)return{error:"Missing matchUp"};if(!t.timeItems)return{error:"Missing timeItems"};const e=t.timeItems.filter((t=>[ri,ai,oi,si].includes(null==t?void 0:t.itemType))).sort(((t,e)=>hi(t.itemValue)-hi(e.itemValue))),n=e.reduce(((t,e)=>{var n,i;let r;const a=null==e||null===(n=e.itemType)||void 0===n?void 0:n.split("."),o=`SCHEDULE.TIME.${(null==e||null===(i=e.itemType)||void 0===i?void 0:i.startsWith("SCHEDULE.TIME"))&&a[2]}`;switch(o){case ri:r=0;break;case si:if(t.lastValue&&[ri,oi].includes(t.lastType)){const n=hi(e.itemValue)-hi(t.lastValue);r=t.milliseconds+n}else r=t.milliseconds;break;case ai:if([ri,"SCHECULE.TIME.RESUME"].includes(t.lastType)){const n=hi(e.itemValue)-hi(t.lastValue);r=t.milliseconds+n}else r=t.milliseconds;break;default:r=t.milliseconds}return{milliseconds:r,lastType:o,lastValue:e.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([ri,oi].includes(n.lastType)){const t=new Date-hi(n.lastValue);n.milliseconds+=t}return{milliseconds:n.milliseconds,time:Ii(n.milliseconds),relevantTimeItems:e}}function Ii(t){const e=(t,e=2)=>("00"+t).slice(-e);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}const gi="SINGLES",Ui="DOUBLES",yi="TEAM",Si={SINGLES:gi,DOUBLES:Ui,TEAM:yi,AGE:"AGE",RATING:"RATING",BOTH:"BOTH"};function wi({scheduleVisibilityFilters:t,afterRecoveryTimes:e=!0,tournamentRecord:n,scheduleTiming:i,matchUpFormat:r,matchUpType:a,matchUp:o,event:s}){if(!o)return{error:"Missing matchUp"};if(!o.matchUpType&&!a&&(s||n)&&o.drawId){var c,u,d,l,p,m;let t=null===(c=s)||void 0===c?void 0:c.drawDefinitions.find((t=>t.drawId===o.drawId));!t&&n&&({drawDefinition:t,event:s}=Yn({tournamentRecord:n,drawId:o.drawId}));const e=o.structureId&&(null===(u=t)||void 0===u||null===(d=u.structures)||void 0===d?void 0:d.find((({structureId:t})=>t===o.structureId)));a=(null==e?void 0:e.matchUpType)||(null===(l=t)||void 0===l?void 0:l.matchUpType)||(null===(p=s)||void 0===p?void 0:p.eventType)!==yi&&(null===(m=s)||void 0===m?void 0:m.eventType)}const{milliseconds:f,time:h}=vi({matchUp:o}),{startTime:v}=function({matchUp:t}){const e=(null==t?void 0:t.timeItems)||[],n=t=>t.createdAt?new Date(t.createdAt).getTime():0,i=e.reduce(((t,e)=>{const i=e.itemType===ri&&e;return i&&(!t||n(i)<n(t))?i:t}),void 0);return{startTime:i&&i.itemValue}}({matchUp:o}),{endTime:I}=function({matchUp:t}){const e=(null==t?void 0:t.timeItems)||[],n=t=>t.createdAt?new Date(t.createdAt).getTime():0,i=e.reduce(((t,e)=>{const i=e.itemType===si&&e;return i&&(!t||n(i)>n(t))?i:t}),void 0);return{endTime:i&&i.itemValue}}({matchUp:o});let g;const{visibilityThreshold:U,eventIds:y,drawIds:S}=t||{};if(y&&!y.includes(o.eventId)||S&&!S.includes(o.drawId))g=Wt({time:h,startTime:v,endTime:I,milliseconds:f});else{var w;const t={matchUp:o,visibilityThreshold:U};let{scheduledDate:s}=pi(t);const{scheduledTime:c}=li(t),{courtId:u}=mi(t),{venueId:d}=fi(t);let l,p,m,y,S;if(null!=i&&i.policy&&c&&e){const t={matchUpFormat:o.matchUpFormat||r,...i};({averageMinutes:p=0,recoveryMinutes:m=0,typeChangeRecoveryMinutes:y=0}=Vn({eventType:o.matchUpType||a,timingDetails:t})),(p||m)&&(l=I?Bt(Ot(I),m):Bt(c,p+m)),y&&(S=I?Bt(Ot(I),y):Bt(c,p+y))}!s&&c&&(s=Lt(c));const N=Ot(c);let D=Lt(s);D&&N&&(D+=`T${N}`);const P=(null===(w=n&&d&&Kn({tournamentRecord:n,venueId:d}))||void 0===w?void 0:w.venueData)||{},{venueName:T,venueAbbreviation:M,courtsInfo:A}=P,E=u&&(null==A?void 0:A.find((t=>t.courtId===u)));g=Wt({typeChangeTimeAfterRecovery:S,timeAfterRecovery:l,scheduledDate:s,scheduledTime:c,isoDateString:D,venueAbbreviation:M,venueName:T,venueId:d,courtName:null==E?void 0:E.courtName,courtId:u,typeChangeRecoveryMinutes:y,recoveryMinutes:m,averageMinutes:p,milliseconds:f,startTime:v,endTime:I,time:h})}const N=ge.includes(o.matchUpStatus),{scheduledDate:D}=pi({matchUp:o}),{scheduledTime:P}=li({matchUp:o});return{schedule:g,endDate:N&&(Lt(I)||Lt(D)||Lt(P))||void 0}}const Ni="INDIVIDUAL",Di="TEAM",Pi="PAIR",Ti="GROUP",Mi={INDIVIDUAL:Ni,TEAM:Di,PAIR:Pi,GROUP:Ti};function Ai({tournamentParticipants:t,tournamentRecord:e,participantIds:n}){if(!t&&!e)return{error:G};if(!Array.isArray(n)||n.length>2)return{error:"Invalid participantIds"};if(!n.length)return{error:"Missing participantIds"};const i=(t=t||(null==e?void 0:e.participants)||[]).filter((t=>t.participantType===Pi&&F(n,t.individualParticipantIds).length===n.length&&t.individualParticipantIds.length===n.length)),r=i[0];if(!r)return{error:Y};const a=Ht(i.slice(1));return{participant:Ht(r),duplicatedPairParticipants:a,...B}}function Ei({drawDefinition:t,participantId:e}){if("object"!=typeof t)return{error:q};if("string"!=typeof e)return{error:"Missing participantId"};const{extension:n}=On({element:t,name:"lineUps"});return{lineUp:((null==n?void 0:n.value)||{})[e]}}const bi=t=>e=>t[e],Ri=(t=[])=>t.map(Fi).filter(Boolean),Ci=(t=[])=>t.map(Oi).filter(Boolean),Oi=(t={})=>bi(t)("participantId"),Li=(t={})=>bi(t)("drawPosition"),Fi=(t={})=>bi(t)("matchUpId");function xi({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find((t=>t.matchUpId===e))}}function ki({drawDefinition:t}){if(!t)return{error:q};const e=(t.extensions||[]).find((t=>"appliedPolicies"===t.name));return{appliedPolicies:(null==e?void 0:e.value)||{}}}function _i({matchUps:t=[]}){if(!Array.isArray(t))return{error:$};const e=t.reduce(((t,e)=>!e.roundNumber||t.includes(e.roundNumber)?t:t.concat(parseInt(e.roundNumber))),[]).sort(Kt).map((e=>{const n=t.filter((t=>t.roundNumber===e)),i=n.find((({matchUpType:t})=>t===Zt))?n.filter((({matchUpType:t})=>t===Zt)):n;return{[e]:i.sort(((t,e)=>Kt(t.roundPosition,e.roundPosition)))}})),n=t.reduce(((t,e)=>(t[e.roundNumber]||(t[e.roundNumber]=Wt({finishingRound:e.finishingRound,abbreviatedRoundName:e.abbreviatedRoundName,roundName:e.roundName})),t)),{}),i=Object.assign({},...e);let r=0;const a=Object.assign({},...Object.keys(i).map((t=>{var e,n,a;const o=null===(e=i[t])||void 0===e?void 0:e.length,s=null===(n=i[t])||void 0===n||null===(a=n.filter((t=>{var e;return!(ge.includes(t.matchUpStatus)||null!==(e=t.score)&&void 0!==e&&e.scoreStringSide1)})))||void 0===a?void 0:a.length,c=o&&o===s;return r=Math.max(r,o),{[t]:{matchUpsCount:o,inactiveCount:s,inactiveRound:c}}})));let o=0,s=0;const c=Object.keys(i).map((t=>parseInt(t))).filter((t=>!isNaN(t)));return c.forEach((t=>{const e=i[t].sort(((t,e)=>t.roundPosition-e.roundPosition)),c=e.map((t=>(null==t?void 0:t.drawPositions)||[])).flat();if(a[t].roundNumber=t,a[t].roundFactor=a[t].matchUpsCount?r/a[t].matchUpsCount:1,a[t].finishingRound=n[t].finishingRound,a[t].roundName=n[t].roundName,a[t].abbreviatedRoundName=n[t].abbreviatedRoundName,a[t].finishingPositionRange=i[t][0].finishingPositionRange,1!==t&&a[t-1]){const n=a[t-1],i=n.drawPositions,r=n.matchUpsCount/a[t].matchUpsCount,o=k(i,r),s=e.map((e=>{const{roundPosition:n}=e,r=[].concat(...e.drawPositions||[],void 0,void 0).slice(0,2);if(!n)return r;const a=(null==r?void 0:r.filter(Boolean))||[];if(null==a||!a.length)return[void 0,void 0];if(t<3&&2===(null==a?void 0:a.length))return null==r?void 0:r.slice().sort(Kt);const s=F(i,a).length!==(null==a?void 0:a.length);if(null!=a&&a.length&&s)return 1===(null==a?void 0:a.length)?[a[0],void 0]:null==r?void 0:r.slice().sort(Kt);const c=2*(n-1);return o.slice(c,c+2).map((t=>null==a?void 0:a.find((e=>t.includes(e)))))}));a[t].drawPositions=null==s?void 0:s.flat(),a[t].pairedDrawPositions=s}else{const e=c.sort(Kt),n=k(e,2);a[t].drawPositions=e,a[t].pairedDrawPositions=n}a[t+1]&&a[t+1].matchUpsCount===a[t].matchUpsCount&&(a[t+1].feedRound=!0,a[t+1].feedRoundIndex=s,a[t].preFeedRound=!0,s+=1),a[t]&&!a[t].feedRound&&(a[t].roundIndex=o,o+=1)})),{hasOddMatchUpsCount:!!Object.values(a).find((({matchUpsCount:t})=>!I(t))),maxMatchUpsCount:r,roundMatchUps:i,roundNumbers:c,roundProfile:a}}function Bi({drawDefinition:t,structure:e}){const n={},i=[];return((null==t?void 0:t.structures)||[e]).filter((t=>t&&"object"==typeof t)).forEach((t=>{const{structureId:e,matchUps:r,structures:a}=t,o=Array.isArray(a);if(o)o&&a.forEach((t=>{const{structureName:r}=t,a=t.matchUps;n[t.structureId]={matchUps:a,structureName:r},i.push(...a),a.forEach((t=>{i.push(t),t.tieMatchUps&&i.push(...t.tieMatchUps)})),n[e]||(n[e]={}),n[e].itemStructureIds||(n[e].itemStructureIds=[]),n[e].itemStructureIds.push(t.structureId)}));else{const t=r;n[e]={matchUps:t},t.forEach((t=>{i.push(t),t.tieMatchUps&&i.push(...t.tieMatchUps)}))}})),{mappedMatchUps:n,drawMatchUps:i}}function ji({mappedMatchUps:t,matchUpsMap:e,structureId:n,inContext:i}){let r=(t=(null==e?void 0:e.mappedMatchUps)||t)[n];const a=((null==r?void 0:r.itemStructureIds)||[]).map((e=>{const{matchUps:r,structureName:a}=t[e];return i?r.map((t=>Object.assign(Ht(t,!0,!0),{containerStructureId:n,structureId:e,structureName:a}))):r})).flat();return((null==r?void 0:r.matchUps)||[]).concat(...a)}const Vi="MAIN",Gi="QUALIFYING",qi="CONSOLATION",Hi="PLAY_OFF",Wi=[Vi,Gi,qi,Hi,"VOLUNTARY_CONSOLATION"],zi={[Gi]:1,[Vi]:2,[Hi]:3,[qi]:3,VOLUNTARY_CONSOLATION:4},Ki="CONTAINER",Yi="TOP_DOWN",$i="LOSER",Ji="AD_HOC",Zi="FEED_IN",Qi="COMPASS",Xi="OLYMPIC",tr="SINGLE_ELIMINATION",er="DOUBLE_ELIMINATION",nr="LUCKY_DRAW",ir="CURTIS_CONSOLATION",rr="FEED_IN_CHAMPIONSHIP_TO_SF",ar="FEED_IN_CHAMPIONSHIP_TO_QF",or="FEED_IN_CHAMPIONSHIP_TO_R16",sr="MODIFIED_FEED_IN_CHAMPIONSHIP",cr="ROUND_ROBIN",ur="ROUND_ROBIN_WITH_PLAYOFF",dr={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-3":{name:"NORTHEAST",abbreviation:"NE"},"0-1-1":{name:"SOUTH",abbreviation:"S"},"0-1-2":{name:"SOUTHWEST",abbreviation:"SW"},"0-2-1":{name:"NORTHWEST",abbreviation:"NW"},"0-1-1-1":{name:"SOUTHEAST",abbreviation:"SE"}},lr={0:{name:"EAST",abbreviation:"E"},"0-1":{name:"WEST",abbreviation:"W"},"0-2":{name:"NORTH",abbreviation:"N"},"0-1-1":{name:"SOUTH",abbreviation:"S"}},pr=[Qi,ir,"FEED_IN_CHAMPIONSHIP_TO_QF","FEED_IN_CHAMPIONSHIP_TO_R16","FEED_IN_CHAMPIONSHIP_TO_SF","FEED_IN_CHAMPIONSHIP",ar,or,rr,"FIRST_MATCH_LOSER_CONSOLATION","FIRST_ROUND_LOSER_CONSOLATION",nr,"MODIFIED_FEED_IN_CHAMPIONSHIP",Xi,Hi,ur],mr={MAIN:Vi,QUALIFYING:Gi,CONSOLATION:qi,ITEM:"ITEM",CONTAINER:Ki,FIRST_MATCHUP:"FIRST_MATCHUP",WINNER:"WINNER",LOSER:$i,AD_HOC:Ji,FEED_IN:Zi,COMPASS:Qi,PLAY_OFF:Hi,OLYMPIC:Xi,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:tr,DOUBLE_ELIMINATION:er,CURTIS:ir,FICSF:rr,FICQF:ar,FICR16:or,MFIC:sr,VOLUNTARY_CONSOLATION:"VOLUNTARY_CONSOLATION",FIRST_MATCH_LOSER_CONSOLATION:"FIRST_MATCH_LOSER_CONSOLATION",FIRST_ROUND_LOSER_CONSOLATION:"FIRST_ROUND_LOSER_CONSOLATION",MODIFIED_FEED_IN_CHAMPIONSHIP:"MODIFIED_FEED_IN_CHAMPIONSHIP",FEED_IN_CHAMPIONSHIP_TO_R16:"FEED_IN_CHAMPIONSHIP_TO_R16",FEED_IN_CHAMPIONSHIP_TO_QF:"FEED_IN_CHAMPIONSHIP_TO_QF",FEED_IN_CHAMPIONSHIP_TO_SF:"FEED_IN_CHAMPIONSHIP_TO_SF",FEED_IN_CHAMPIONSHIP:"FEED_IN_CHAMPIONSHIP",ROUND_ROBIN_WITH_PLAYOFF:ur,ROUND_ROBIN:cr,DECIDER:"DECIDER",BACKDRAW:"BACKDRAW",COMPASS_ATTRIBUTES:dr,OLYMPIC_ATTRIBUTES:lr,DRAW:"DRAW",RANDOM:"RANDOM",TOP_DOWN:Yi,BOTTOM_UP:"BOTTOM_UP",WATERFALL:"WATERFALL",WIN_RATIO:"WIN_RATIO",ROUND_OUTCOME:"ROUND_OUTCOME",MULTI_STRUCTURE_DRAWS:pr,generatedDrawTypes:[Ji,Qi,ir,er,"FEED_IN_CHAMPIONSHIP_TO_QF","FEED_IN_CHAMPIONSHIP_TO_R16","FEED_IN_CHAMPIONSHIP_TO_SF","FEED_IN_CHAMPIONSHIP",Zi,"FIRST_MATCH_LOSER_CONSOLATION","FIRST_ROUND_LOSER_CONSOLATION",nr,"MODIFIED_FEED_IN_CHAMPIONSHIP",Xi,Hi,cr,ur,tr],stageOrder:zi};function fr(t,e){var n,i;return(zi[null==t?void 0:t.stage]||0)-(zi[null==e?void 0:e.stage]||0)||((null==e||null===(n=e.positionAssignments)||void 0===n?void 0:n.length)||9999)-((null==t||null===(i=t.positionAssignments)||void 0===i?void 0:i.length)||9999)||((null==t?void 0:t.stageSequence)||0)-((null==e?void 0:e.stageSequence)||0)}function hr({drawDefinition:t,structureId:e}){if(!t)return{error:q};if(!e)return{error:"Missing structureId"};const{structures:n}=vr({drawDefinition:t}),i=n.map((t=>t.structures?[].concat(...t.structures,t):t)).flat().find((t=>t.structureId===e));return i?{structure:i}:{error:"structure not found"}}function vr({stage:t,stageSequence:e,drawDefinition:n}){var i;const r=n?n.structures?void 0:"Missing structures":q;return r?{error:r}:{structures:null===(i=n.structures)||void 0===i?void 0:i.filter((function(e){return!t||e.stage===t})).filter((function(t){return!e||t.stageSequence===e})).sort(fr)}}function Ir(t){if(!t||"object"!=typeof t)return!1;if("string"!=typeof t.name)return!1;const e=Object.keys(t),n=["name","value"];return n.filter((t=>e.includes(t))).length===n.length}function gr({element:t,extension:e}={}){if(!t)return{error:z};if("object"!=typeof t)return{error:$};if(!Ir(e))return{error:$};t.extensions||(t.extensions=[]);const n=(new Date).toISOString();Object.assign(e,{createdAt:n});const i=t.extensions.find((({name:t})=>t===e.name));return i?i.value=e.value:e.value&&t.extensions.push(e),{...B}}function Ur({element:t,name:e}={}){return t?"object"!=typeof t?{error:$}:e?t.extensions?(t.extensions=t.extensions.filter((t=>(null==t?void 0:t.name)!==e)),{...B}):{...B,message:J}:{error:z,message:"Missing name"}:{error:z}}function yr({tournamentRecord:t,extension:e}={}){return t?gr({element:t,extension:e}):{error:G}}function Sr({drawDefinition:t,extension:e}={}){return t?gr({element:t,extension:e}):{error:"drawDefinition not found"}}function wr({event:t,extension:e}={}){return t?gr({element:t,extension:e}):{error:W}}function Nr({tournamentRecord:t,name:e}={}){return t?Ur({element:t,name:e}):{error:G}}function Dr({event:t,name:e}={}){return t?Ur({element:t,name:e}):{error:"Event not found"}}function Pr({drawDefinition:t,attributes:e}){var n;let{extension:i}=xn({name:"entryProfile",drawDefinition:t});const r=(null===(n=i)||void 0===n?void 0:n.value)||t.entryProfile||{};return e.forEach((t=>{Object.keys(t).forEach((e=>{r[e]?Object.assign(r[e],t[e]):r[e]=t[e]}))})),i={name:"entryProfile",value:r},Sr({drawDefinition:t,extension:i}),{entryProfile:r}}function Tr({drawDefinition:t}){let{extension:e}=xn({name:"entryProfile",drawDefinition:t});return{entryProfile:(null==e?void 0:e.value)||t.entryProfile||{}}}var Mr;!function(t){t.CONFIRMED="CONFIRMED",t.DIRECT_ACCEPTANCE="DIRECT_ACCEPTANCE",t.ORGANISER_ACCEPTANCE="ORGANISER_ACCEPTANCE",t.ALTERNATE="ALTERNATE",t.WITHDRAWN="WITHDRAWN",t.UNPAIRED="UNPAIRED",t.UNGROUPED="UNGROUPED",t.LUCKY_LOSER="LUCKY_LOSER",t.FEED_IN="FEED_IN",t.QUALIFIER="QUALIFIER",t.WILDCARD="WILDCARD"}(Mr||(Mr={}));var Ar=Mr.ALTERNATE,Er=Mr.FEED_IN,br=Mr.QUALIFIER,Rr=Mr.WILDCARD,Cr=Mr.DIRECT_ACCEPTANCE,Or=Mr.CONFIRMED,Lr=Mr.LUCKY_LOSER,Fr=Mr.ORGANISER_ACCEPTANCE,xr=Mr.WITHDRAWN,kr=Mr.UNPAIRED,_r=Mr.UNGROUPED,Br=[Or,Cr,Fr],jr=[Lr,Er,br,Rr],Vr=[Er,br,Lr,Rr,Or,Cr,Fr],Gr=[Ar,xr,Er,kr,_r,br,Rr,Cr,Or,Lr,Fr],qr={FEED_IN:Er,WILDCARD:Rr,UNPAIRED:kr,UNGROUPED:_r,ALTERNATE:Ar,CONFIRMED:Or,QUALIFIER:br,WITHDRAWN:xr,LUCKY_LOSER:Lr,DIRECT_ACCEPTANCE:Cr,ORGANISER_ACCEPTANCE:Fr,DRAW_SPECIFIC_STATUSES:jr,EQUIVALENT_ACCEPTANCE_STATUSES:Br,VALID_ENTERED_TYPES:Gr,VALID_ENTRY_STATUSES:Gr,STRUCTURE_ENTERED_TYPES:Vr,STRUCTURE_SELECTED_STATUSES:Vr};function Hr({stage:t,drawDefinition:e}){const{entryProfile:n}=Tr({drawDefinition:e}),i=Object.keys(n).includes(t);return!i&&Wi.includes(t)?(Pr({drawDefinition:e,attributes:[{[t]:{drawSize:void 0,alternates:!0}}]}),!0):i}function Wr({stage:t,drawDefinition:e,entryStatus:n}){return e.entries.reduce(((e,i)=>i.entryStage===t&&i.entryStatus===n?e+1:e),0)}function zr({drawDefinition:t,stageSequence:e,entryStatuses:n,structureId:i,stages:r,stage:a}){var o;const s=(null===(o=t.entries)||void 0===o?void 0:o.reduce(((t,i)=>{const o=a&&i.entryStage===a||(null==r?void 0:r.length)&&r.includes(i.entryStage),s=!n||n.includes(i.entryStatus),c=i.entryStageSequence||1;return!o||e&&c!==e||!s?t:t.concat(i)}),[]))||[];if(i&&a===Hi){const e=function({drawDefinition:t,structureId:e}){const n=[],i=(t.links||[]).find((t=>"POSITION"===t.linkType&&t.target.structureId===e));if(i){const{finishingPositions:e,structureId:r}=i.source,{structure:a}=hr({drawDefinition:t,structureId:r});a.structureType===Ki&&(a.structures||[]).forEach((t=>{const{positionAssignments:i}=t,{structureId:r}=t,a=r,o=Object.assign({},...i.map((t=>{var e;const{participantId:n}=t,i=null===(e=On({element:t,name:"tally"}).extension)||void 0===e?void 0:e.value;return i?{[n]:i}:void 0})).filter(Boolean));Object.keys(o).filter((t=>{const n=o[t];return e.includes(n.groupOrder)})).forEach((t=>{const i=o[t],{groupOrder:r,GEMscore:s}=i,c=e.sort().indexOf(r)+1;n.push({GEMscore:s,groupingValue:a,participantId:t,placementGroup:c,entryStage:Hi,entryStatus:Er})}))}))}return n}({drawDefinition:t,structureId:i});return null!=e&&e.length?e:s}return s}function Kr({stage:t,drawDefinition:e}){return Wr({entryStatus:Cr,drawDefinition:e,stage:t})}function Yr({stage:t,drawDefinition:e}){return Wr({entryStatus:Rr,drawDefinition:e,stage:t})}function $r({drawDefinition:t,matchUpsMap:e,structureId:n,structure:i}){var r,a;let o,s=[];if(i||({structure:i,error:o}=hr({drawDefinition:t,structureId:n})),!i)return{seedAssignments:[],error:"structure not found"};n||(n=i.structureId);const{stage:c,stageSequence:u}=i;return o||(c===Hi&&t?s=zr({drawDefinition:t,stageSequence:u,matchUpsMap:e,structureId:n,stage:c}).filter((t=>1===t.placementGroup)).sort(((t,e)=>t.GEMscore<e.GEMscore?1:t.GEMscore>e.GEMscore?-1:0)).map(((t,e)=>({participantId:t.participantId,seedNumber:e+1,seedValue:e+1,seedProxy:!0}))):i.seedAssignments?s=i.seedAssignments:o="Missing seedAssignments"),{seedAssignments:s,seedLimit:i.seedLimit||(null===(r=i)||void 0===r||null===(a=r.positionAssignments)||void 0===a?void 0:a.length),stage:c,stageSequence:u,error:o}}function Jr({groupedOrder:t,roundPositionsCount:e}){if(!t||(null==t?void 0:t.length)<=e)return t;const n=k(t,t.length/e).map((t=>t.reduce(((t,e)=>t+e)))),i=n.slice().sort(Kt);return n.map((t=>i.indexOf(t)+1))}function Zr(t){if(!Array.isArray(t))return"";const e=t.filter(U);return e.length?T([Math.min(...e),Math.max(...e)]).join("-"):""}function Qr({drawDefinition:t,structureId:e,structure:n}){let i,r=[];if(!n){if(!t)return{positionAssignments:r,error:q};if(({structure:n,error:i}=hr({drawDefinition:t,structureId:e})),i)return{positionAssignments:r,error:i}}return n.structures?r=[].concat(...n.structures.map((t=>Qr({structure:t}).positionAssignments))):n.positionAssignments?r=n.positionAssignments:i="Missing positionAssignments",{positionAssignments:r,error:i}}function Xr({drawDefinition:t,structureId:e,structure:n}){const{positionAssignments:i}=Qr({drawDefinition:t,structureId:e,structure:n}),r=i.filter((t=>t.participantId||t.bye||t.qualifier)),a=i.length===r.length,o=i.filter((t=>!t.participantId&&!t.bye&&!t.qualifier));return{byePositions:i.filter((t=>!t.participantId&&t.bye)),assignedPositions:r,qualifierPositions:i.filter((t=>!t.participantId&&t.qualifier)),unassignedPositions:o,positionAssignments:i,allPositionsAssigned:a}}function ta({drawPositions:t,roundProfile:e,roundNumber:n}){const i=[void 0,void 0];if(t.reduce(((t,e)=>isNaN(parseInt(e))&&t),!0))return{orderedDrawPositions:i,displayOrder:i};const r=e[n],a=null==r?void 0:r.pairedDrawPositions,o=(null==a?void 0:a.find((e=>x(e||[],t.filter(Boolean)))))||i,s=null==r?void 0:r.feedRound;if(function(t){return t.reduce(((t,e)=>!isNaN(parseInt(e))&&t),!0)}(t)){const e=t.sort(Kt);return et({sideNumbers:!0})&&t.length<2&&console.log({drawPositions:t,pairedDrawPositions:a,orderedDrawPositions:e,displayOrder:o}),{orderedDrawPositions:2===e.length?e:o,displayOrder:s?e:o}}if(s){const e=[t.find((t=>!isNaN(parseInt(t)))),void 0];return{orderedDrawPositions:e,displayOrder:e}}return{orderedDrawPositions:o,displayOrder:o}}function ea({drawDefinition:t,structure:e}){return!!e&&!(null!=e&&e.structures||null!=t&&t.drawType&&t.drawType!==Ji||null!=e&&e.matchUps.find((({roundPosition:t})=>!!t)))}const na={roundNaming:{policyName:"Round Naming Default",abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q"},stageConstants:{[Vi]:"",[Hi]:"P",[Gi]:"Q",[qi]:"C"}}};function ia({matchUp:t}){let e,n=[],i=[],r=[],a=[];if(t||(e="Missing matchUp"),t&&!t.sides&&(e="Invalid matchUp"),t&&!t.hasContext&&(e="Missing context"),!e){n=t.sides.map((t=>t.participantId));const e=t.sides.filter((t=>t.participantType===Ni)).map((t=>t.participantId)).filter(Boolean);a=t.sides.map((t=>t.participant&&t.participant.individualParticipants)).filter(Boolean).map((t=>t.map((t=>null==t?void 0:t.participantId)).filter(Boolean))),i=[].concat(...e,...a.flat()).filter(Boolean),r=T(i.concat(n)).filter(Boolean)}return{error:e,sideParticipantIds:n,individualParticipantIds:i,allRelevantParticipantIds:r,nestedIndividualParticipantIds:a}}function ra({matchUp:t}){if(!t)return{error:"Missing matchUp"};if(!t.hasContext)return{error:"Missing context"};if(!t.sides||2!==t.sides.filter(Boolean).length)return{error:"Invalid matchUp"};const{sideParticipantIds:e,nestedIndividualParticipantIds:n,allRelevantParticipantIds:i}=ia({matchUp:t}),r=(t.timeItems||[]).filter((t=>[Zn,Qn].includes(null==t?void 0:t.itemType))).sort(((t,e)=>new Date(t.createdAt)-new Date(e.createdAt))),a=r.map((t=>t.itemValue)).filter((t=>r.filter((e=>(null==e?void 0:e.itemValue)===t)).reverse()[0].itemType===Zn));return null==n||n.forEach(((t,n)=>{const i=e[n],r=(null==t?void 0:t.length)&&t.reduce(((t,e)=>t&&e&&a.includes(e)),!0);i&&r&&!a.includes(i)&&a.push(i)})),e.forEach(((t,e)=>{a.includes(t)&&(n[e]||[]).forEach((t=>{t&&!a.includes(t)&&a.push(t)}))})),{allParticipantsCheckedIn:e.reduce(((t,e)=>a.includes(e)&&t),!0),checkedInParticipantIds:a,allRelevantParticipantIds:i}}function aa(t){const{matchUps:e,isCollectionMatchUp:n,matchUpStatuses:i,matchUpFormats:r,roundPositions:a,matchUpFormat:o,collectionIds:s,isMatchUpTie:c,matchUpTypes:u,roundNumbers:d,matchUpIds:l,scheduledDates:p,scheduledDate:m,processContext:f,tournamentIds:h,structureIds:v,courtIds:I,eventIds:g,venueIds:U,drawIds:y,stages:S,filterMatchUpIds:w=!0,filterMatchUpTypes:N=!0}=t,D=Array.isArray(i)?i.filter(Boolean):[],P=Array.isArray(S)?S.filter(Boolean):[],T=Array.isArray(s)?s.filter(Boolean):[],M=Array.isArray(d)?d.filter(Boolean):[],A=Array.isArray(a)?a.filter(Boolean):[],E=Array.isArray(l)&&w?l.filter(Boolean):[],b=Array.isArray(u)&&N?u.filter(Boolean):[],R=Array.isArray(I)?I.filter(Boolean):[],C=Array.isArray(U)?U.filter(Boolean):[],O=Array.isArray(r)?r.filter(Boolean):"string"==typeof o?[o]:[],L=Array.isArray(p)?p.filter(Boolean):"string"==typeof m&&m.length?[m]:[],F=Array.isArray(h)?h.filter(Boolean):[],x=Array.isArray(g)?g.filter(Boolean):[],k=Array.isArray(y)?y.filter(Boolean):[],_=Array.isArray(v)?v.filter(Boolean):[];return e.filter((t=>{if(void 0!==c){if(c&&!t.tieMatchUps)return!1;if(!c&&t.tieMatchUps)return!1}if(void 0!==n){if(n&&!t.collectionId)return!1;if(!n&&t.collectionId)return!1}if(P.length&&!P.includes(t.stage))return!1;if(T.length&&!T.includes(t.collectionId))return!1;if(M.length&&!d.includes(t.roundNumber))return!1;if(A.length&&!a.includes(t.roundPosition))return!1;if(D.length&&!D.includes(t.matchUpStatus))return!1;if(E.length&&!E.includes(t.matchUpId))return!1;if(b.length&&!b.includes(t.matchUpType))return!1;if(O.length&&!O.includes(t.matchUpFormat))return!1;if(null!=L&&L.length){const{scheduledTime:e}=li({matchUp:t}),{scheduledDate:n}=pi({matchUp:t}),i=Lt(e)||n;if(!L.find((t=>Gt(t,i))))return!1}if(R.length){const{courtId:e}=mi({matchUp:t});if(!I.filter(Boolean).includes(e))return!1}if(C.length){const{venueId:e}=fi({matchUp:t});if(!U.filter(Boolean).includes(e))return!1}if(f){if(F.length&&!F.includes(t.tournamentId))return!1;if(x.length&&!x.includes(t.eventId))return!1;if(k.length&&!k.includes(t.drawId))return!1;if(_.length&&!_.includes(t.structureId))return!1}return!0}))}function oa({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:n,policyDefinitions:i,tournamentRecord:r,seedAssignments:a,drawDefinition:o,contextFilters:s,contextProfile:c,matchUpFilters:d,scheduleTiming:l,context:p={},matchUpsMap:m,roundFilter:f,structure:h,inContext:v,event:I}){var g,U,y,S,w;let N={},D={};if(n=n||(null==r?void 0:r.participants),!h)return{collectionPositionMatchUps:N,error:"Missing structure",roundMatchUps:D,matchUps:[]};const P=Array.isArray(null==d?void 0:d.eventIds)?d.eventIds.filter(Boolean):[],M=Array.isArray(null==d?void 0:d.structureIds)?d.structureIds.filter(Boolean):[],A=Array.isArray(null==d?void 0:d.drawIds)?d.drawIds.filter(Boolean):[],E=!(null!=p&&p.eventId)||!P.length&&!(null!=s&&null!==(g=s.eventIds)&&void 0!==g&&g.filter(Boolean).length)||P.includes(p.eventId)||(null==s||null===(U=s.eventIds)||void 0===U?void 0:U.includes(p.eventId)),b=!M.length||M.includes(h.structureId),R=!o||!A.length||A.includes(o.drawId);if(!E||!b||!R)return{collectionPositionMatchUps:N,roundMatchUps:D,matchUps:[]};const{appliedPolicies:C}=ki({drawDefinition:o}),L=Object.assign({},e,C,i),F=null==L||null===(y=L.scoring)||void 0===y?void 0:y.structures,x=(null==F?void 0:F.stage)&&(null==F?void 0:F.stage[h.stage]),_=(null==x?void 0:x.stageSequence)&&x.stageSequence[h.stageSequence],B=(null==L||null===(S=L.scoring)||void 0===S?void 0:S.requireAllPositionsAssigned)||(null==x?void 0:x.requireAllPositionsAssigned)||(null==_?void 0:_.requireAllPositionsAssigned);m||(m=Bi({drawDefinition:o,structure:h}));const{positionAssignments:j,allPositionsAssigned:V}=Xr({structure:h}),G=!B||V,{seedAssignments:H}=$r({drawDefinition:o,matchUpsMap:m,structure:h});a=a||H;const{structureId:W,structureName:z,stage:K,stageSequence:Y,exitProfile:$}=h,{drawId:J,drawName:Z}=o||{},Q=!!h.structures;let X=ji({matchUpsMap:m,structureId:W,inContext:v});const tt=function({roundNamingPolicy:t,structure:e,matchUps:n}){const{hasOddMatchUpsCount:i,roundProfile:r,roundMatchUps:a}=_i({matchUps:n}),{structureAbbreviation:o,stage:s}=e,c=ea({structure:e}),u=function({hasOddMatchUpsCount:t,drawDefinition:e,roundMatchUps:n,structure:i}){var r,a,o,s;if(!i)return!1;n||({hasOddMatchUpsCount:t,roundMatchUps:n}=_i({matchUps:i.matchUps||[]}));const c=!(null===(r=n)||void 0===r||null===(a=r[1])||void 0===a||!a.find((({drawPositions:t})=>t))),u=!(null!==(o=n)&&void 0!==o&&null!==(s=o[2])&&void 0!==s&&s.find((({drawPositions:t})=>t)));return t&&!(null!=i&&i.structures)&&c&&u&&!(null!=e&&e.drawType&&e.drawType!==nr)}({hasOddMatchUpsCount:i,roundMatchUps:a,structure:e}),d=e.structures,l={},p=na.roundNaming,m=(null==t?void 0:t.roundNamingMap)||p.roundNamingMap||{},f=(null==t?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},h=(null==t?void 0:t.affixes)||p.affixes,v=s&&s!==Vi&&s[0],I=null==t?void 0:t.stageConstants,g=I&&I[s]||v;return d||c||u?Object.assign(l,...Object.keys(r).map((t=>({[t]:{roundName:`Round ${t}`,abbreviatedRoundName:`R${t}`}})))):Object.assign(l,...Object.keys(r).map((t=>{const{matchUpsCount:e,preFeedRound:n}=r[t],i=2*e,a=m[e]||`${h.roundNumber}${i}`,s=n?`-${h.preFeedRound}`:"",c=[g,o,`${a}${s}`].filter(Boolean).join("-"),u=f[e]||`${h.roundNumber}${i}`;return{[t]:{abbreviatedRoundName:[g,o,`${u}${s}`].filter(Boolean).join("-"),roundName:c}}}))),{roundNamingProfile:l,roundProfile:r,roundMatchUps:a}}({roundNamingPolicy:L&&L.roundNaming,drawDefinition:o,structure:h,matchUps:X}),{roundNamingProfile:et,roundProfile:nt}=tt;if(D=tt.roundMatchUps,d&&(X=aa({matchUps:X,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),v){var it;const{sourceDrawPositionRanges:e}=function({drawDefinition:t,structureId:e,matchUpsMap:n}){if(!t)return{error:q};if(!e)return{error:"Missing structureId"};const{structure:i}=hr({drawDefinition:t,structureId:e});if(i.stage!==qi)return{message:"Structure is not CONSOLATION stage"};const{links:r}=t,a=(null==r?void 0:r.filter((t=>t.target.structureId===e)))||[],o=(null==a?void 0:a.reduce(((t,e)=>{const{structureId:n}=e.source;return t.includes(n)?t:t.concat(n)}),[]))||[],s=Object.assign({},...o.map((t=>{const e=ji({matchUpsMap:n,structureId:t}),{roundProfile:i}=_i({matchUps:e});return{[t]:i}}))),c=ji({matchUpsMap:n,structureId:e}),{roundProfile:u}=_i({matchUps:c}),d={};return null==a||a.forEach((t=>{const{structureId:e,roundNumber:n}=t.source,{feedProfile:i,groupedOrder:r,positionInterleave:a,roundNumber:o}=t.target,c=s[e],l=c[1]&&c[1].drawPositions,p=c[n],m=null==p?void 0:p.matchUpsCount;if(!m)return;const f=m?l.length/m:0,h=l.length/f;let v=l.slice();const I=Jr({groupedOrder:r,roundPositionsCount:v.length}),g=(null==I?void 0:I.length)||1;if(g<=h){const t=k(v,l.length/g);"BOTTOM_UP"===i&&t.forEach((t=>t.reverse())),v=(null==I?void 0:I.length)&&(null==I?void 0:I.map((e=>t[e-1])).flat())||v}let U=k(v,f);if(null!=I&&I.length||"BOTTOM_UP"===i&&U.reverse(),a){const t=O(0,a.interleave).map((()=>{})),e=O(0,a.offset).map((()=>{}));U=U.map((e=>[e,...t])),U.unshift(e),U=U.flat(1);const n=U.length-a.offset;U=U.slice(0,n)}d[o]||(d[o]={});const y=u[o],S=null!=y&&y.feedRound?2:1;U.forEach(((t,e)=>{const n=1+e*S;d[o][n]||(d[o][n]=Zr(t))}))})),{sourceDrawPositionRanges:d}}({drawDefinition:o,matchUpsMap:m,structureId:W}),{drawPositionsRanges:n}=function({drawDefinition:t,roundProfile:e,structureId:n,matchUpsMap:i}){var r;if(!t)return{error:q};if(!n)return{error:"Missing structureId"};if(!e){const t=ji({matchUpsMap:i,structureId:n});({roundProfile:e}=_i({matchUps:t}))}const a=(Math.min(...(null===(r=e[1])||void 0===r?void 0:r.drawPositions)||[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map((t=>{var n;const{matchUpsCount:i}=e[t],r=(null===(n=e[1])||void 0===n?void 0:n.drawPositions)||[],s=k(r,r.length/i),c=s.map(Zr),u=s.map((t=>t.map((t=>t-a)))).map(Zr),d=o.map((n=>{if(n>t)return;const{drawPositions:r}=e[n];return k(r,r.length/i)})).filter(Boolean),l=O(0,i).map((t=>d.map((e=>e[t])).flat().filter(Boolean).sort(Kt))).map((t=>T(t))),p=l.map((t=>{return(e=t,e.reduce(((t,e)=>{const n=t[t.length-1];return n&&n[n.length-1]===e-1||t.push([]),t[t.length-1].push(e),t}),[])).map(Zr).join(", ");var e})),m=Object.assign({},...O(0,i).map((t=>({[t+1]:{firstRoundDrawPositionsRange:c[t],firstRoundOffsetDrawPositionsRange:u[t],possibleDrawPositions:l[t],drawPositionsRange:p[t]}}))));return{[t]:m}})))}}({drawDefinition:o,roundProfile:nt,matchUpsMap:m,structureId:W});X=X.map((i=>at({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,drawPositionsRanges:n,roundNamingProfile:et,appliedPolicies:L,isRoundRobin:Q,roundProfile:nt,matchUp:i,event:I}))),(null===(it=X)||void 0===it?void 0:it.filter((t=>Array.isArray(t.tieMatchUps)))).forEach((t=>{const e=t.tieMatchUps;X=X.concat(...e)})),s&&(X=aa({processContext:!0,...s,matchUps:X}))}else{var rt;(null===(rt=X)||void 0===rt?void 0:rt.filter((t=>Array.isArray(t.tieMatchUps)))).forEach((t=>{const e=t.tieMatchUps;X=X.concat(...e)}))}return(null!=d&&d.matchUpTypes||null!=d&&d.matchUpIds)&&(X=aa({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:X})),(null!=d&&d.matchUpTypes||null!=d&&d.matchUpIds||v)&&({roundMatchUps:D}=_i({matchUps:X})),(h.tieFormat||null!=o&&o.tieFormat||null!=I&&I.tieFormat)&&({collectionPositionMatchUps:N}=function({matchUps:t}){const e=t.reduce(((t,e)=>!e.collectionPosition||t.includes(e.collectionPosition)?t:t.concat(e.collectionPosition)),[]).map((e=>({[e]:t.filter((t=>t.collectionPosition===e))})));return{collectionPositionMatchUps:Object.assign({},...e)}}({matchUps:X})),f&&(X=null===(w=X)||void 0===w?void 0:w.filter((t=>t.roundNumber===f))),{matchUps:X,roundMatchUps:D,collectionPositionMatchUps:N};function at({scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,additionalContext:i={},drawPositionsRanges:s,roundNamingProfile:d,tieDrawPositions:m,appliedPolicies:f,isCollectionBye:v,matchUpTieId:I,isRoundRobin:g,roundProfile:U,sideLineUps:y,matchUp:S,event:w}){var N,D,P,T,M,A;const E=S.tieFormat||h.tieFormat||(null==o?void 0:o.tieFormat)||(null==w?void 0:w.tieFormat)||void 0,b=null==E?void 0:E.collectionDefinitions,R=S.collectionId&&(null==b?void 0:b.find((t=>t.collectionId===S.collectionId))),C=S.collectionId?R&&R.matchUpFormat:S.matchUpFormat||h.matchUpFormat||(null==o?void 0:o.matchUpFormat)||(null==w?void 0:w.matchUpFormat),O=S.matchUpType||(null==R?void 0:R.matchUpType)||h.matchUpType||(null==o?void 0:o.matchUpType)||(null==w?void 0:w.eventType)!==yi&&(null==w?void 0:w.eventType),L=v?ne:S.matchUpStatus,{schedule:F,endDate:x}=wi({scheduleVisibilityFilters:t,tournamentRecord:r,scheduleTiming:l,matchUpFormat:C,matchUpType:O,matchUp:S,event:w}),k=m||S.drawPositions,{collectionPosition:_,collectionId:B,roundPosition:V}=S,q=S.roundNumber||i.roundNumber,H=function({tournamentParticipants:t,positionAssignments:e,collectionPosition:n,drawPositions:i=[],drawDefinition:r,collectionId:a,sideLineUps:o,matchUpType:s}){if(!a||!n)return;const c=(null==i?void 0:i.map((i=>{var c,u;const d=null===(c=e.find((t=>t.drawPosition===i)))||void 0===c?void 0:c.participantId,l=null==o?void 0:o.find((t=>(null==t?void 0:t.drawPosition)===i)),p=(null==l?void 0:l.teamParticipant)||(null==t?void 0:t.find((({participantId:t})=>t===d))),m=(null==l?void 0:l.lineUp)||(null===(u=Ei({participantId:d,drawDefinition:r}))||void 0===u?void 0:u.lineUp),f=null==m?void 0:m.filter((t=>t.collectionAssignments.find((t=>t.collectionId===a&&t.collectionPosition===n))));if(s!==Jt){var h;const t=null==f||null===(h=f[0])||void 0===h?void 0:h.participantId;return t&&{[i]:{participantId:t,teamParticipant:p}}}if((null==f?void 0:f.length)<=2){const e=null==f?void 0:f.map(Oi),{participant:n}=Ai({tournamentParticipants:t,participantIds:e}),r=null==n?void 0:n.participantId;return{[i]:{participantId:r,teamParticipant:p}}}if((null==f?void 0:f.length)>2)return console.log("ERROR: Too many assignments for",{collectionId:a,collectionPosition:n,assignmentsCount:f.length}),{[i]:{teamParticipant:p}}})).filter(Boolean))||{};return Object.assign({},...c)}({tournamentParticipants:n,positionAssignments:j,collectionPosition:_,drawDefinition:o,drawPositions:k,collectionId:B,sideLineUps:y,matchUpType:O}),Q=d&&(null===(N=d[q])||void 0===N?void 0:N.roundName)||i.roundName,X=d&&(null===(D=d[q])||void 0===D?void 0:D.abbreviatedRoundName)||i.abbreviatedRoundName,tt=null==U||null===(P=U[q])||void 0===P?void 0:P.feedRound,et=null==U||null===(T=U[q])||void 0===T?void 0:T.preFeedRound,nt=null==U||null===(M=U[q])||void 0===M?void 0:M.roundFactor,it=s&&s[q],rt=it&&it[V],ot=e&&e[q],st=null!=R&&R.category?Object.assign({},(null==p?void 0:p.category)||{},R.category):null==p?void 0:p.category,ct=S.processCodes||(null==R?void 0:R.processCodes)||h.processCodes||(null==o?void 0:o.processCodes)||(null==w?void 0:w.processCodes),ut=t=>Wt(t,void 0,!0),dt=Object.assign({},ut(p),ut({matchUpFormat:S.matchUpType===yi?void 0:C,tieFormat:S.matchUpType!==yi?void 0:E,endDate:S.endDate||x,category:st,abbreviatedRoundName:X,drawPositionsRange:rt,structureName:z,stageSequence:Y,drawPositions:k,matchUpStatus:L,processCodes:ct,isRoundRobin:g,matchUpTieId:I,preFeedRound:et,roundFactor:nt,matchUpType:O,exitProfile:$,structureId:W,roundNumber:q,feedRound:tt,roundName:Q,drawName:Z,schedule:F,drawId:J,stage:K}),Ht(ut(S),!0,!0));if(C&&null!==(A=S.score)&&void 0!==A&&A.scoreStringSide1){const t=u(C),{bestOf:e,finalSetFormat:n,setFormat:i}=t||{};(null!=n&&n.tiebreakSet||null!=i&&i.tiebreakSet||null!=i&&i.timed)&&(dt.score.sets=dt.score.sets.sort(((t,e)=>t.setNumber-e.setNumber)).map(((t,r)=>(r+1===e?(null!=n&&n.tiebreakSet||null!=n&&n.timed)&&(t.tiebreakSet=!0):(null!=i&&i.tiebreakSet||null!=i&&i.timed)&&(t.tiebreakSet=!0),t))))}if(Array.isArray(k)){const{orderedDrawPositions:t,displayOrder:e}=ta({drawPositions:k,roundPosition:V,roundProfile:U,roundNumber:q}),n=U[q]&&U[q].feedRound,i=e[0]!==t[0],r=t.concat(void 0,void 0).slice(0,2).map(((t,e)=>{var r;const o=e+1,s=function({drawPositionCollectionAssignment:t,positionAssignments:e,displaySideNumber:n,seedAssignments:i,drawPosition:r,isFeedRound:a,sideNumber:o}){var s,c,u;const d=e.find((t=>t.drawPosition===r)),l=t?null===(s=t[r])||void 0===s?void 0:s.participantId:null==d?void 0:d.participantId,p=d?function({displaySideNumber:t,seedAssignments:e,participantId:n,assignment:i,sideNumber:r}){const a={drawPosition:i.drawPosition,displaySideNumber:t,sideNumber:r};if(n){const t=function({seedAssignments:t,participantId:e}){return t.find((t=>!t.seedProxy&&t.participantId===e))}({seedAssignments:e,participantId:n});Object.assign(a,t,{participantId:n})}else i.bye?Object.assign(a,{bye:!0}):i.qualifier&&Object.assign(a,{qualifier:!0});return a}({displaySideNumber:n,seedAssignments:i,participantId:l,assignment:d,sideNumber:o}):{};a&&(1===o?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0}));const m=null==t||null===(c=t[r])||void 0===c?void 0:c.teamParticipant,f=null==t||null===(u=t[r])||void 0===u?void 0:u.participant;return f&&Object.assign(p,{participant:f}),m&&Object.assign(p,{teamParticipant:m}),p}({drawPositionCollectionAssignment:H,positionAssignments:j,displaySideNumber:i?3-o:o,seedAssignments:a,drawPosition:t,isFeedRound:n,sideNumber:o}),c=null===(r=S.sides)||void 0===r?void 0:r.find((t=>t.sideNumber===o)),u=ot&&ot[2*(V-1)+e+1];return ut({sourceDrawPositionRange:u,...c,...s})}));Object.assign(dt,Ht({sides:r},!0,!0))}if(n&&dt.sides&&(dt.sides.filter(Boolean).forEach((t=>{var e,i;if(t.participantId){const e=Rn({policyDefinitions:f,participantId:t.participantId,tournamentParticipants:n});if(e){if(null!=o&&o.entries){const n=o.entries.find((e=>e.participantId===t.participantId));null!=n&&n.entryStatus&&(e.entryStatus=n.entryStatus||Ar)}Object.assign(t,{participant:e})}}if(null!=t&&null!==(e=t.participant)&&void 0!==e&&null!==(i=e.individualParticipantIds)&&void 0!==i&&i.length){const e=t.participant.individualParticipantIds.map((t=>Rn({policyDefinitions:f,tournamentParticipants:n,participantId:t})));Object.assign(t.participant,{individualParticipants:e})}})),!dt.matchUpType)){const{matchUpType:t}=function({matchUp:t={}}={}){var e;let n=t.matchUpType;if(!n&&null!==(e=t.sides)&&void 0!==e&&e.length){const e=t.sides.find((({participant:t})=>t)),i=null==e?void 0:e.participant,r=null==i?void 0:i.participantType;n=r===Ni?$t:r===Pi?Jt:r===Di?Di:void 0}return{matchUpType:n}}({matchUp:dt});t&&Object.assign(dt,{matchUpType:t})}if(dt.tieMatchUps){var lt;const n=dt.matchUpStatus===ne,i=null===(lt=dt.sides)||void 0===lt?void 0:lt.map((({participant:t,drawPosition:e,sideNumber:n,lineUp:i})=>{const r=(null==t?void 0:t.participantType)===yi&&t;return{teamParticipant:r&&Wt({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participanOthertName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}),drawPosition:e,sideNumber:n,lineUp:i}}));dt.tieMatchUps=dt.tieMatchUps.map((r=>{const a=dt.matchUpId;return at({tieDrawPositions:k,scheduleVisibilityFilters:t,sourceDrawPositionRanges:e,sideLineUps:i,drawPositionsRanges:s,roundNamingProfile:d,additionalContext:{abbreviatedRoundName:X,roundNumber:q,roundName:Q},appliedPolicies:f,isCollectionBye:n,matchUpTieId:a,isRoundRobin:g,roundProfile:U,matchUp:r,event:w})}))}const pt=dt.sides&&2===dt.sides.filter((t=>t&&t.participantId)).length,mt=!dt.winningSide,ft=G&&pt&&mt;if(Object.assign(dt,{readyToScore:ft,hasContext:!0}),pt){const{allParticipantsCheckedIn:t,checkedInParticipantIds:e}=ra({matchUp:dt});Object.assign(dt,{allParticipantsCheckedIn:t,checkedInParticipantIds:e})}return Array.isArray(null==c?void 0:c.exclude),dt}}function sa({participants:t=[]}){const e=Ht(t,!0,!0),n=e.filter((t=>t.participantType===Di)),i=e.filter((t=>t.participantType===Ti)),r=e.filter((t=>t.participantType===Pi));return e.forEach((t=>{if(t.participantType===Ni){const{participantId:e}=t;t.groupParticipantIds=[],t.teamParticipantIds=[],t.pairParticipantIds=[],t.groups=[],t.teams=[],n.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==e||t.teamParticipantIds.includes(n.participantId)||(t.teamParticipantIds.push(n.participantId),t.teams.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId,teamId:n.teamId}))}))})),r.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==e||t.pairParticipantIds.includes(n.participantId)||t.pairParticipantIds.push(n.participantId)}))})),i.forEach((n=>{((null==n?void 0:n.individualParticipantIds)||[]).forEach((i=>{i!==e||t.groupParticipantIds.includes(n.participantId)||(t.groupParticipantIds.push(n.participantId),t.groups.push({participantRoleResponsibilities:n.participantRoleResponsibilities,participantOtherName:n.participantOtherName,participantName:n.participantName,participantId:n.participantId}))}))}))}})),e}function ca({tournamentParticipants:t,drawDefinition:e,contextProfile:n,matchUpsMap:i,matchUpId:r,inContext:a,context:o,event:s}){if(!e)return{error:q};if(!r)return{error:"Missing matchUpId"};if("string"!=typeof r)return{error:$};const{structures:c}=vr({drawDefinition:e});for(const u of c){const{matchUps:c}=oa({tournamentParticipants:t,drawDefinition:e,contextProfile:n,matchUpsMap:i,inContext:a,structure:u,context:o,event:s}),{matchUp:d}=xi({matchUps:c,matchUpId:r});if(d)return{matchUp:d,structure:u}}return{error:"matchUp not found"}}const ua=[{ioc:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso:"AD",label:"Andorra",phone:"376"},{ioc:"UAE",iso:"AE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso:"AF",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso:"AG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso:"AI",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso:"AL",label:"Albania",phone:"355"},{ioc:"ARM",iso:"AM",label:"Armenia",phone:"374"},{ioc:"ANG",iso:"AO",label:"Angola",phone:"244"},{ioc:"",iso:"AQ",label:"Antarctica",phone:"672"},{ioc:"ARG",iso:"AR",label:"Argentina",phone:"54"},{ioc:"ASA",iso:"AS",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso:"AT",label:"Austria",phone:"43"},{ioc:"AUS",iso:"AU",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso:"AW",label:"Aruba",phone:"297"},{ioc:"",iso:"AX",label:"Alland Islands",phone:"358"},{ioc:"AZE",iso:"AZ",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso:"BA",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso:"BB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso:"BD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso:"BE",label:"Belgium",phone:"32"},{ioc:"BUR",iso:"BF",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso:"BG",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso:"BH",label:"Bahrain",phone:"973"},{ioc:"BDI",iso:"BI",label:"Burundi",phone:"257"},{ioc:"BEN",iso:"BJ",label:"Benin",phone:"229"},{ioc:"",iso:"BL",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso:"BM",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso:"BN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso:"BO",label:"Bolivia",phone:"591"},{ioc:"BRA",iso:"BR",label:"Brazil",phone:"55"},{ioc:"BAH",iso:"BS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso:"BT",label:"Bhutan",phone:"975"},{ioc:"",iso:"BV",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso:"BW",label:"Botswana",phone:"267"},{ioc:"BLR",iso:"BY",label:"Belarus",phone:"375"},{ioc:"BIZ",iso:"BZ",label:"Belize",phone:"501"},{ioc:"CAN",iso:"CA",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso:"CC",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso:"CD",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso:"CF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso:"CG",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso:"CH",label:"Switzerland",phone:"41"},{ioc:"CIV",iso:"CI",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso:"CK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso:"CL",label:"Chile",phone:"56"},{ioc:"CMR",iso:"CM",label:"Cameroon",phone:"237"},{ioc:"CHN",iso:"CN",label:"China",phone:"86"},{ioc:"COL",iso:"CO",label:"Colombia",phone:"57"},{ioc:"CRC",iso:"CR",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso:"CU",label:"Cuba",phone:"53"},{ioc:"CPV",iso:"CV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso:"CW",label:"Curacao",phone:"599"},{ioc:"CXR",iso:"CX",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso:"CY",label:"Cyprus",phone:"357"},{ioc:"CZE",iso:"CZ",label:"Czech Republic",phone:"420"},{ioc:"GER",iso:"DE",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso:"DJ",label:"Djibouti",phone:"253"},{ioc:"DEN",iso:"DK",label:"Denmark",phone:"45"},{ioc:"DMA",iso:"DM",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso:"DO",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso:"DZ",label:"Algeria",phone:"213"},{ioc:"ECU",iso:"EC",label:"Ecuador",phone:"593"},{ioc:"EST",iso:"EE",label:"Estonia",phone:"372"},{ioc:"EGY",iso:"EG",label:"Egypt",phone:"20"},{ioc:"",iso:"EH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso:"ER",label:"Eritrea",phone:"291"},{ioc:"ESP",iso:"ES",label:"Spain",phone:"34"},{ioc:"ETH",iso:"ET",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso:"FI",label:"Finland",phone:"358"},{ioc:"FIJ",iso:"FJ",label:"Fiji",phone:"679"},{ioc:"FLK",iso:"FK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso:"FM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso:"FO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso:"FR",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso:"GA",label:"Gabon",phone:"241"},{ioc:"GBR",iso:"GB",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso:"GD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso:"GE",label:"Georgia",phone:"995"},{ioc:"FGU",iso:"GF",label:"French Guiana",phone:"594"},{ioc:"",iso:"GG",label:"Guernsey",phone:"44"},{ioc:"",iso:"GH",label:"Ghana",phone:"233"},{ioc:"GIB",iso:"GI",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso:"GL",label:"Greenland",phone:"299"},{ioc:"GAM",iso:"GM",label:"Gambia",phone:"220"},{ioc:"GUI",iso:"GN",label:"Guinea",phone:"224"},{ioc:"GUD",iso:"GP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso:"GQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso:"GR",label:"Greece",phone:"30"},{ioc:"",iso:"GS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso:"GT",label:"Guatemala",phone:"502"},{ioc:"GUM",iso:"GU",label:"Guam",phone:"1-671"},{ioc:"GBS",iso:"GW",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso:"GY",label:"Guyana",phone:"592"},{ioc:"HKG",iso:"HK",label:"Hong Kong",phone:"852"},{ioc:"",iso:"HM",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso:"HN",label:"Honduras",phone:"504"},{ioc:"CRO",iso:"HR",label:"Croatia",phone:"385"},{ioc:"HAI",iso:"HT",label:"Haiti",phone:"509"},{ioc:"HUN",iso:"HU",label:"Hungary",phone:"36"},{ioc:"INA",iso:"ID",label:"Indonesia",phone:"62"},{ioc:"IRL",iso:"IE",label:"Ireland",phone:"353"},{ioc:"ISR",iso:"IL",label:"Israel",phone:"972"},{ioc:"",iso:"IM",label:"Isle of Man",phone:"44"},{ioc:"IND",iso:"IN",label:"India",phone:"91"},{ioc:"",iso:"IO",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso:"IQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso:"IR",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso:"IS",label:"Iceland",phone:"354"},{ioc:"ITA",iso:"IT",label:"Italy",phone:"39"},{ioc:"",iso:"JE",label:"Jersey",phone:"44"},{ioc:"JAM",iso:"JM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso:"JO",label:"Jordan",phone:"962"},{ioc:"JPN",iso:"JP",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso:"KE",label:"Kenya",phone:"254"},{ioc:"KGZ",iso:"KG",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso:"KH",label:"Cambodia",phone:"855"},{ioc:"KIR",iso:"KI",label:"Kiribati",phone:"686"},{ioc:"COM",iso:"KM",label:"Comoros",phone:"269"},{ioc:"SKN",iso:"KN",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso:"KP",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso:"KR",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso:"KW",label:"Kuwait",phone:"965"},{ioc:"CAY",iso:"KY",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso:"KZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso:"LA",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso:"LB",label:"Lebanon",phone:"961"},{ioc:"LCA",iso:"LC",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso:"LI",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso:"LK",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso:"LR",label:"Liberia",phone:"231"},{ioc:"LES",iso:"LS",label:"Lesotho",phone:"266"},{ioc:"LTU",iso:"LT",label:"Lithuania",phone:"370"},{ioc:"LUX",iso:"LU",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso:"LV",label:"Latvia",phone:"371"},{ioc:"LBA",iso:"LY",label:"Libya",phone:"218"},{ioc:"MAR",iso:"MA",label:"Morocco",phone:"212"},{ioc:"MON",iso:"MC",label:"Monaco",phone:"377"},{ioc:"MDA",iso:"MD",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso:"ME",label:"Montenegro",phone:"382"},{ioc:"",iso:"MF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso:"MG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso:"MH",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso:"MK",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso:"ML",label:"Mali",phone:"223"},{ioc:"MYA",iso:"MM",label:"Myanmar",phone:"95"},{ioc:"MGL",iso:"MN",label:"Mongolia",phone:"976"},{ioc:"MAC",iso:"MO",label:"Macao",phone:"853"},{ioc:"NMA",iso:"MP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso:"MQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso:"MR",label:"Mauritania",phone:"222"},{ioc:"MNT",iso:"MS",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso:"MT",label:"Malta",phone:"356"},{ioc:"MRI",iso:"MU",label:"Mauritius",phone:"230"},{ioc:"MDV",iso:"MV",label:"Maldives",phone:"960"},{ioc:"MAW",iso:"MW",label:"Malawi",phone:"265"},{ioc:"MEX",iso:"MX",label:"Mexico",phone:"52"},{ioc:"MAS",iso:"MY",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso:"MZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso:"NA",label:"Namibia",phone:"264"},{ioc:"NCL",iso:"NC",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso:"NE",label:"Niger",phone:"227"},{ioc:"NFI",iso:"NF",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso:"NG",label:"Nigeria",phone:"234"},{ioc:"NCA",iso:"NI",label:"Nicaragua",phone:"505"},{ioc:"NED",iso:"NL",label:"Netherlands",phone:"31"},{ioc:"NOR",iso:"NO",label:"Norway",phone:"47"},{ioc:"NEP",iso:"NP",label:"Nepal",phone:"977"},{ioc:"NRU",iso:"NR",label:"Nauru",phone:"674"},{ioc:"NIU",iso:"NU",label:"Niue",phone:"683"},{ioc:"NZL",iso:"NZ",label:"New Zealand",phone:"64"},{ioc:"OMA",iso:"OM",label:"Oman",phone:"968"},{ioc:"PAN",iso:"PA",label:"Panama",phone:"507"},{ioc:"PER",iso:"PE",label:"Peru",phone:"51"},{ioc:"FPO",iso:"PF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso:"PG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso:"PH",label:"Philippines",phone:"63"},{ioc:"PAK",iso:"PK",label:"Pakistan",phone:"92"},{ioc:"POL",iso:"PL",label:"Poland",phone:"48"},{ioc:"SPM",iso:"PM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso:"PN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso:"PR",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso:"PS",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso:"PT",label:"Portugal",phone:"351"},{ioc:"PlW",iso:"PW",label:"Palau",phone:"680"},{ioc:"PAR",iso:"PY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso:"QA",label:"Qatar",phone:"974"},{ioc:"REU",iso:"RE",label:"Reunion",phone:"262"},{ioc:"ROU",iso:"RO",label:"Romania",phone:"40"},{ioc:"SRB",iso:"RS",label:"Serbia",phone:"381"},{ioc:"RUS",iso:"RU",label:"Russia",phone:"7"},{ioc:"RWA",iso:"RW",label:"Rwanda",phone:"250"},{ioc:"KSA",iso:"SA",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso:"SB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso:"SC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso:"SD",label:"Sudan",phone:"249"},{ioc:"SWE",iso:"SE",label:"Sweden",phone:"46"},{ioc:"SIN",iso:"SG",label:"Singapore",phone:"65"},{ioc:"HEL",iso:"SH",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso:"SI",label:"Slovenia",phone:"386"},{ioc:"",iso:"SJ",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso:"SK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso:"SL",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso:"SM",label:"San Marino",phone:"378"},{ioc:"SEN",iso:"SN",label:"Senegal",phone:"221"},{ioc:"SOM",iso:"SO",label:"Somalia",phone:"252"},{ioc:"SUR",iso:"SR",label:"Suriname",phone:"597"},{ioc:"",iso:"SS",label:"South Sudan",phone:"211"},{ioc:"STP",iso:"ST",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso:"SV",label:"El Salvador",phone:"503"},{ioc:"",iso:"SX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso:"SY",label:"Syria",phone:"963"},{ioc:"",iso:"SZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso:"TC",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso:"TD",label:"Chad",phone:"235"},{ioc:"",iso:"TF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso:"TG",label:"Togo",phone:"228"},{ioc:"THA",iso:"TH",label:"Thailand",phone:"66"},{ioc:"TJK",iso:"TJ",label:"Tajikistan",phone:"992"},{ioc:"",iso:"TK",label:"Tokelau",phone:"690"},{ioc:"TLS",iso:"TL",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso:"TM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso:"TN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso:"TO",label:"Tonga",phone:"676"},{ioc:"TUR",iso:"TR",label:"Turkey",phone:"90"},{ioc:"TTO",iso:"TT",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso:"TV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso:"TW",label:"Taiwan",phone:"886"},{ioc:"TAN",iso:"TZ",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso:"UA",label:"Ukraine",phone:"380"},{ioc:"UGA",iso:"UG",label:"Uganda",phone:"256"},{ioc:"USA",iso:"US",label:"United States",phone:"1",suggested:!0},{ioc:"URU",iso:"UY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso:"UZ",label:"Uzbekistan",phone:"998"},{ioc:"",iso:"VA",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso:"VC",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso:"VE",label:"Venezuela",phone:"58"},{ioc:"IVB",iso:"VG",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso:"VI",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso:"VN",label:"Vietnam",phone:"84"},{ioc:"VAN",iso:"VU",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso:"WF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso:"WS",label:"Samoa",phone:"685"},{ioc:"KOS",iso:"XK",label:"Kosovo",phone:"383"},{ioc:"YEM",iso:"YE",label:"Yemen",phone:"967"},{ioc:"MAY",iso:"YT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso:"ZA",label:"South Africa",phone:"27"},{ioc:"ZAM",iso:"ZM",label:"Zambia",phone:"260"},{ioc:"ZIM",iso:"ZW",label:"Zimbabwe",phone:"263"}];function da(t){const{nationalityCode:e}=t||{};if(e){const n=ua.find((({ioc:t})=>t===e));null!=n&&n.iso&&!t.isoNationalityCode&&(t.isoNationalityCode=n.iso),null!=n&&n.label&&!t.countryName&&(t.countryName=n.label)}}function la({participant:t}){const{person:e,individualParticipants:n}=t;[e,null==n?void 0:n.map((({person:t})=>t))].flat().filter(Boolean).forEach(da)}function pa({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:n,drawDefinition:i,targetLink:r}){if(!r)return{error:"Missing targetLink"};const{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:c,positionInterleave:u}}=r,{structure:d}=hr({drawDefinition:i,structureId:a}),{positionAssignments:l}=Qr({structure:d}),p=(null==e?void 0:e.filter((t=>t.structureId===d.structureId))).filter((t=>t.roundNumber===c)),m=p.length,f=O(1,m+1),h=m/t;let v=Math.ceil(h*n),I=1-n%2;if(null!=u&&u.interleave&&.5!==h){const t=n+(u.offset+(n-1)*u.interleave);v=Math.ceil(t/2),I=1-t%2}let g=f,U=f[v-1];const y=Jr({groupedOrder:s,roundPositionsCount:f.length}),S=(null==y?void 0:y.length)||1;if(S<=f.length){const t=k(f,m/S);"BOTTOM_UP"===o&&t.forEach((t=>t.reverse())),g=(null==y?void 0:y.length)&&(null==y?void 0:y.map((e=>t[e-1])).flat())||g}o===Yi?U=g[v-1]:"BOTTOM_UP"===o?((null==y||!y.length||S>f.length)&&(v=p.length+1-v),U=g[v-1]):"RANDOM"===o&&et()&&console.log("Not implemented",{feedProfile:o});const w=U&&p.reduce(((t,e)=>e.roundPosition===U?e:t),void 0);let N;var D;null!=w&&w.feedRound?(I=0,N=Math.min(...(w.drawPositions||[]).filter(Boolean))):N=2===(null==w||null===(D=w.drawPositions)||void 0===D?void 0:D.length)&&(null==w?void 0:w.drawPositions[I]);const P=l.find((({drawPosition:t})=>t===N));if(P){const{extension:t}=On({element:P,name:"disableLinks"});if(null!=t&&t.value)return{disabledDrawPosition:N}}return{matchUp:w,targetDrawPosition:N,matchUpDrawPositionIndex:I}}function ma({source:t,linkType:e,finishingPositions:n}){return t.reduce(((t,i)=>{var r,a;return null!==(r=i.source)&&void 0!==r&&r.finishingPositions&&n&&!x(n,null===(a=i.source)||void 0===a?void 0:a.finishingPositions)||i.linkType!==e?t:i}),void 0)}function fa({drawDefinition:t,structureId:e,roundNumber:n}){return t?e?{links:(t.links||[]).filter(Boolean).reduce(((t,i)=>{var r,a;return(null===(r=i.source)||void 0===r?void 0:r.structureId)!==e||n&&i.source.roundNumber!==n||(t.source=t.source.concat(i)),(null===(a=i.target)||void 0===a?void 0:a.structureId)!==e||n&&i.target.roundNumber!==n||(t.target=t.target.concat(i)),t}),{source:[],target:[]})}:{error:"Missing structureId"}:{error:q}}function ha({matchUpId:t,drawDefinition:e,inContextDrawMatchUps:n=[],inContextMatchUp:i,useTargetMatchUpIds:r=!1}){let a=i;n.length&&!a&&(a=n.find((e=>e.matchUpId===t)));const{structure:o}=hr({drawDefinition:e,structureId:a.structureId}),{finishingPosition:s}=o;return"ROUND_OUTCOME"===s?function({matchUp:t,structure:e,drawDefinition:n,inContextDrawMatchUps:i,useTargetMatchUpIds:r}){const{links:{source:a}}=function({drawDefinition:t,roundNumber:e,structureId:n}){if(!t)return{error:q};if(!n)return{error:"Missing structureId"};const{links:i}=fa({drawDefinition:t,structureId:n});return{links:{source:i.source.reduce(((t,n)=>n.source.roundNumber&&n.source.roundNumber!==e?t:t.concat(n)),[]),target:i.target.reduce(((t,n)=>n.target.roundNumber&&n.target.roundNumber!==e?t:t.concat(n)),[])}}}({drawDefinition:n,roundNumber:t.roundNumber,structureId:e.structureId}),o=ma({source:a,linkType:"WINNER"}),s=ma({source:a,linkType:$i}),{winnerMatchUpId:c,loserMatchUpId:u}=t;let d,l,p,m,f,h,v;if(r&&(m=c&&i.find((({matchUpId:t})=>t===c)),d=u&&i.find((({matchUpId:t})=>t===u))),o&&!m||s&&!d){const{roundPosition:r}=t;v=v||i.filter((t=>t.structureId===e.structureId));const a=v.reduce(((e,n)=>n.roundNumber===t.roundNumber?e+1:e),0);s&&({matchUp:d,matchUpDrawPositionIndex:p,targetDrawPosition:l}=pa({drawDefinition:n,inContextDrawMatchUps:i,sourceRoundPosition:r,sourceRoundMatchUpCount:a,targetLink:s})),o&&({matchUp:m,matchUpDrawPositionIndex:h,targetDrawPosition:f}=pa({drawDefinition:n,inContextDrawMatchUps:i,sourceRoundPosition:r,sourceRoundMatchUpCount:a,targetLink:o}))}return m||(v=v||i.filter((t=>t.structureId===e.structureId)),({matchUp:m}=function({structureMatchUps:t,matchUp:e}){const{roundNumber:n,roundPosition:i}=e,r=t.filter((t=>t.roundNumber===n)),a=t.filter((t=>t.roundNumber===n+1));if(a.length){let t;return a.length===r.length?t=a.find((t=>t.roundPosition===i)):a.length===r.length/2&&(t=a.find((t=>t.roundPosition===Math.ceil(i/2)))),{matchUp:t}}return{error:"no progression found"}}({structureMatchUps:v,matchUp:t}))),{matchUp:t,targetLinks:{loserTargetLink:s,winnerTargetLink:o},targetMatchUps:{loserMatchUp:d,winnerMatchUp:m,loserTargetDrawPosition:l,winnerTargetDrawPosition:f,loserMatchUpDrawPositionIndex:p,winnerMatchUpDrawPositionIndex:h}}}({drawDefinition:e,inContextDrawMatchUps:n,structure:o,matchUp:a,useTargetMatchUpIds:r}):function({matchUp:t}){return{matchUp:t,targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0}}}({drawDefinition:e,matchUp:a,structure:o})}function va({drawDefinition:t,inContextDrawMatchUps:e}){const n={};return e.forEach((i=>{const{matchUpId:r,structureId:a,drawPositions:o=[]}=i,{structure:s}=hr({drawDefinition:t,structureId:a});if("WIN_RATIO"===(null==s?void 0:s.finishingPosition)){const{roundNumber:t}=i,e=t&&parseInt(t)+1,n=s.matchUps||[],{roundMatchUps:r}=_i({matchUps:n});if(e&&r[e]){const t=o.sort().map(((t,n)=>{const i=r[e].find((e=>{var n;return null===(n=e.drawPositions)||void 0===n?void 0:n.includes(t)}));return{matchUpId:null==i?void 0:i.matchUpId,roundNumber:e,schedule:null==i?void 0:i.schedule,sideNumber:n+1,structureName:s.structureName}}));Object.assign(i,{sidesTo:t})}}else{var c,u;const a=ha({matchUpId:r,drawDefinition:t,inContextMatchUp:i,inContextDrawMatchUps:e,useTargetMatchUpIds:!0}),{winnerMatchUp:o,loserMatchUp:s}=a.targetMatchUps;!i.winnerMatchUpId&&o&&(i.winnerMatchUpId=o.matchUpId),!i.loserMatchUpId&&s&&(i.loserMatchUpId=s.matchUpId);const v=ga({upcomingMatchUp:o});let I=ga({upcomingMatchUp:s});if(i.matchUpStatus!==ne&&(null==s?void 0:s.matchUpStatus)===ne){const{matchUp:n}=Ia({matchUp:s,drawDefinition:t,inContextDrawMatchUps:e})||{};I=n&&ga({upcomingMatchUp:n})||I}const g=null===(c=i.schedule)||void 0===c?void 0:c.timeAfterRecovery;var d,l,p;if(g)null!=v&&null!==(d=v.schedule)&&void 0!==d&&d.scheduledTime&&Rt(v.schedule.scheduledTime)<Rt(g)&&(n[v.matchUpId]=i.matchUpId,v.schedule.scheduleConflict=i.matchUpId),null!==(l=I)&&void 0!==l&&null!==(p=l.schedule)&&void 0!==p&&p.scheduledTime&&Rt(I.schedule.scheduledTime)<Rt(g)&&(n[I.matchUpId]=i.matchUpId,I.schedule.scheduleConflict=i.matchUpId);if(Object.assign(i,{winnerTo:v,loserTo:I}),null!==(u=i.drawPositions)&&void 0!==u&&u.filter(Boolean).length){var m;const t=null===(m=a.targetLinks)||void 0===m?void 0:m.loserTargetLink,e="FIRST_MATCHUP"===(null==t?void 0:t.linkCondition),n=(null==(f=i)||null===(h=f.sides)||void 0===h?void 0:h.map((({participant:t,participantId:e,qualifier:n})=>t||e&&{participantId:e}||n&&{qualifier:n})).filter(Boolean))||[];if(n.length){const t=Ci(null==o?void 0:o.sides),i=Ci(null==s?void 0:s.sides),r=n.find((({participantId:e})=>t.includes(e)))?[]:n,a=n.find((({participantId:t})=>i.includes(t)))?[]:n;s&&e&&a.length<2&&a.push({bye:!0,tbd:!0}),null!=r&&r.length&&o&&(o.potentialParticipants||(o.potentialParticipants=[]),o.potentialParticipants.push(r)),null!=a&&a.length&&s&&(s.potentialParticipants||(s.potentialParticipants=[]),s.potentialParticipants.push(a))}}}var f,h})),Object.keys(n).length&&e.forEach((t=>{Object.keys(n).includes(t.matchUpId)&&(t.schedule.scheduleConflict=n[t.matchUpId])})),{scheduleConflictMatchUpIds:n}}function Ia({matchUp:t,drawDefinition:e,inContextDrawMatchUps:n}){const{matchUpId:i,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||(null==t?void 0:t.matchUpStatus)===le)return{matchUp:t};if(r===ne){let r;if(t.winnerMatchUpId)r=n.find((({matchUpId:e})=>e===t.winnerMatchUpId));else{const t=ha({matchUpId:i,drawDefinition:e,inContextDrawMatchUps:n});({winnerMatchUp:r}=(null==t?void 0:t.targetMatchUps)||{})}return Ia({matchUp:r,drawDefinition:e,inContextDrawMatchUps:n})}return{matchUp:void 0}}function ga({upcomingMatchUp:t}={}){if(t)return(({matchUpId:t,structureId:e,schedule:n,roundNumber:i,roundPosition:r,structureName:a})=>({matchUpId:t,structureId:e,schedule:n,roundNumber:i,roundPosition:r,structureName:a}))(t)}function Ua({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:n,tournamentParticipants:i,policyDefinitions:r,tournamentRecord:a,drawDefinition:o,matchUpFilters:s,contextFilters:c,contextProfile:u,scheduleTiming:d,matchUpsMap:l,roundFilter:p,structureId:m,inContext:f,structure:h,context:v,event:I}){!h&&m&&({structure:h}=hr({drawDefinition:o,structureId:m}));const{matchUps:g,error:U}=oa({tournamentAppliedPolicies:n,scheduleVisibilityFilters:e,tournamentParticipants:i,policyDefinitions:r,tournamentRecord:a,drawDefinition:o,matchUpFilters:s,contextFilters:c,contextProfile:u,scheduleTiming:d,matchUpsMap:l,structure:h,inContext:f,context:v,event:I});if(U)return{error:U};const{assignedPositions:y}=Xr({structure:h}),S=y.filter((t=>t.participantId)).map((t=>t.drawPosition)),w=[],N=[],D=[],P=[],T=[];let M;return g.filter((t=>{var e;const n=1===(null==s||null===(e=s.matchUpTypes)||void 0===e?void 0:e.length)&&s.matchUpTypes[0]===Zt;return t.matchUpType===Zt||!n})).forEach((e=>{var n,i,r;if(e.matchUpStatus===ee)return void P.push(e);e.matchUpType===Zt&&(M=!0);const a=e.collectionId,o=a&&e.sides.every((t=>t.participantId)),s=e.roundNumber===p,c=!a&&2===(null===(n=e.drawPositions)||void 0===n?void 0:n.filter(Boolean).length),u=!a&&(null===(i=e.drawPositions)||void 0===i?void 0:i.every((t=>S.includes(t)))),d=y.filter((t=>t.bye)).map((t=>t.drawPosition)),l=!a&&(null===(r=e.drawPositions)||void 0===r?void 0:r.find((t=>d.includes(t)))),m=ye.includes(e.matchUpStatus)&&(o||c&&(!p||s)&&(!t||u));return l?w.push(e):Ee(e)?T.push(e):m?D.push(e):N.push(e)})),{includesTeamMatchUps:M,abandonedMatchUps:P,completedMatchUps:T,upcomingMatchUps:D,pendingMatchUps:N,byeMatchUps:w,structure:h}}function ya(t){if(!t.drawDefinition)return{error:q};Object.assign(t,{requireParticipants:!1});const{abandonedMatchUps:e,completedMatchUps:n,upcomingMatchUps:i,pendingMatchUps:r,byeMatchUps:a,matchUpsMap:o}=Sa(t);return{matchUps:[].concat(...e,...n,...i,...r,...a),matchUpsMap:o}}function Sa({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,tournamentParticipants:n,requireParticipants:i,participantsProfile:r,includeByeMatchUps:a,policyDefinitions:o,tournamentRecord:s,drawDefinition:c,matchUpFilters:u,contextFilters:d,contextProfile:l,scheduleTiming:p,nextMatchUps:m,roundFilter:f,matchUpsMap:h,inContext:v,context:I,event:g}){var U;if(!c)return{error:q};let y=[],S=[],w=[],N=[],D=[];var P;null!==(U=n)&&void 0!==U&&U.length||!s||(n=null==s?void 0:s.participants,(v||null!=r&&r.withGroupings)&&null!==(P=n)&&void 0!==P&&P.length&&(n=sa({participants:n})));const{structures:T}=vr({drawDefinition:c});h||(h=Bi({drawDefinition:c})),T.forEach((r=>{const{byeMatchUps:U=[],pendingMatchUps:P,upcomingMatchUps:T,completedMatchUps:M,abandonedMatchUps:A}=Ua({inContext:v||m,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,tournamentParticipants:n,requireParticipants:i,includeByeMatchUps:a,policyDefinitions:o,tournamentRecord:s,drawDefinition:c,matchUpFilters:u,contextFilters:d,contextProfile:l,scheduleTiming:p,matchUpsMap:h,roundFilter:f,structure:r,context:I,event:g});y=y.concat(...A),S=S.concat(...M),w=w.concat(...T),N=N.concat(...P),D=D.concat(...U)}));const M={abandonedMatchUps:y,completedMatchUps:S,upcomingMatchUps:w,pendingMatchUps:N,byeMatchUps:D,matchUpsMap:h,...B};if(m){const t="object"==typeof m&&m||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:e,completed:n,upcoming:i,pending:r,bye:a}=t,o=[].concat(...e&&M.abandonedMatchUps||[],...n&&M.completedMatchUps||[],...i&&M.upcomingMatchUps||[],...r&&M.pendingMatchUps||[],...a&&M.byeMatchUps||[]);va({drawDefinition:c,inContextDrawMatchUps:o})}return M}function wa({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:i,inContext:r=!0,contextProfile:a,matchUpFilters:o,contextFilters:s,nextMatchUps:c,context:u}){var d;if(!i)return{error:G};const l=(null===(d=i.unifiedTournamentId)||void 0===d?void 0:d.tournamentId)||i.tournamentId,p=(null==i?void 0:i.events)||[],m=Ma({participantsProfile:e,tournamentRecord:i,inContext:r}),{appliedPolicies:f}=Mn({tournamentRecord:i}),h={...u,tournamentId:l,indoorOutDoor:i.indoorOutDoor,surfaceCategory:i.surfaceCategory,endDate:i.endDate};return{matchUps:p.map((u=>Da({context:h,scheduleVisibilityFilters:t,tournamentAppliedPolicies:f,participantsProfile:e,policyDefinitions:n,tournamentRecord:i,matchUpFilters:o,contextFilters:s,contextProfile:a,nextMatchUps:c,participants:m,inContext:r,event:u}).matchUps)).flat(1/0).concat(...i.matchUps||[])}}function Na({participants:t,scheduleVisibilityFilters:e,tournamentAppliedPolicies:n,participantsProfile:i,policyDefinitions:r,tournamentRecord:a,matchUpFilters:o,contextFilters:s,drawDefinition:c,contextProfile:u,nextMatchUps:d,inContext:l,context:p,event:m}){var f;const{eventId:h,eventName:v,eventType:I,category:g,gender:U,matchUpFormat:y}=m||{},S={...p,eventId:h,eventType:I,eventName:v,category:g,gender:U,matchUpFormat:y,indoorOutDoor:(null==m?void 0:m.indoorOutDoor)||(null==a?void 0:a.indoorOutDoor),surfaceCategory:(null==m?void 0:m.surfaceCategory)||(null==a?void 0:a.surfaceCategory),endDate:null==m?void 0:m.endDate};return null!==(f=t)&&void 0!==f&&f.length||!a||(t=Ma({inContext:l,tournamentRecord:a,participantsProfile:i})||[]),ya({context:S,tournamentAppliedPolicies:n,scheduleVisibilityFilters:e,tournamentParticipants:t,participantsProfile:i,policyDefinitions:r,tournamentRecord:a,drawDefinition:c,matchUpFilters:o,contextFilters:s,contextProfile:u,nextMatchUps:d,inContext:l,event:m})}function Da({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,participantsProfile:n,policyDefinitions:i,participants:r=[],tournamentRecord:a,matchUpFilters:o,contextFilters:s,contextProfile:c,nextMatchUps:u,inContext:d,context:l,event:p}){var m;if(!p)return{error:W};const{eventId:f,eventName:h,endDate:v,category:I,gender:g,matchUpFormat:U}=p,y={...l,...Wt({indoorOutDoor:p.indoorOutDoor||(null==a?void 0:a.indoorOutDoor),surfaceCategory:p.surfaceCategory||(null==a?void 0:a.surfaceCategory),endDate:p.endDate||(null==a?void 0:a.endDate),tournamentId:null==a?void 0:a.tournamentId,matchUpFormat:U,eventName:h,category:I,gender:g,eventId:f})};v&&(y.endDate=v),null!==(m=r)&&void 0!==m&&m.length||!a||(r=Ma({participantsProfile:n,tournamentRecord:a,inContext:d}));const S=p.drawDefinitions||[],w=kn({tournamentRecord:a,event:p}).scheduleTiming;return{matchUps:S.map((l=>{const{matchUps:m}=ya({tournamentParticipants:r,tournamentAppliedPolicies:e,scheduleVisibilityFilters:t,context:y,participantsProfile:n,policyDefinitions:i,tournamentRecord:a,drawDefinition:l,matchUpFilters:o,contextFilters:s,contextProfile:c,scheduleTiming:w,nextMatchUps:u,inContext:d,event:p});return m})).flat(1/0)}}function Pa({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:i,inContext:r=!0,matchUpFilters:a,contextFilters:o,contextProfile:s,nextMatchUps:c,context:u}){var d;if(!i)return{error:G};const l=(null===(d=i.unifiedTournamentId)||void 0===d?void 0:d.tournamentId)||i.tournamentId,p=i&&i.events||[],m=Ma({participantsProfile:e,tournamentRecord:i,inContext:r}),{appliedPolicies:f}=Mn({tournamentRecord:i}),h=o&&o.eventIds||[];return p.filter((t=>!h.includes(t.eventId))).map((d=>Ta({tournamentAppliedPolicies:f,scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:i,matchUpFilters:a,contextFilters:o,contextProfile:s,participants:m,tournamentId:l,nextMatchUps:c,inContext:r,context:u,event:d}))).reduce(((t,e)=>{const n=e&&Object.keys(e).filter((t=>!["success","matchUpsMap"].includes(t)));return null==n||n.forEach((n=>{t[n]||(t[n]=[]),t[n]=t[n].concat(e[n]),t.matchUpsCount+=e[n].length})),t}),{matchUpsCount:0})}function Ta({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:n,participantsProfile:i,policyDefinitions:r,tournamentRecord:a,matchUpFilters:o,contextFilters:s,contextProfile:c,nextMatchUps:u,tournamentId:d,inContext:l,context:p,event:m}){if(!m)return{error:W};const{eventId:f,eventName:h,endDate:v}=m,I={...p,...Wt({eventId:f,eventName:h,endDate:v||(null==a?void 0:a.endDate),tournamentId:d||(null==a?void 0:a.tournamentId),indoorOutDoor:m.indoorOutDoor||(null==a?void 0:a.indoorOutDoor),surfaceCategory:m.surfaceCategory||(null==a?void 0:a.surfaceCategory)})};!t&&a&&(t=Ma({participantsProfile:i,tournamentRecord:a,inContext:l}));return(m.drawDefinitions||[]).reduce(((d,p)=>{const f=Sa({context:I,tournamentAppliedPolicies:e,scheduleVisibilityFilters:n,tournamentParticipants:t,participantsProfile:i,policyDefinitions:r,tournamentRecord:a,drawDefinition:p,matchUpFilters:o,contextFilters:s,contextProfile:c,nextMatchUps:u,inContext:l,event:m}),h=Object.keys(f);return null==h||h.forEach((t=>{d[t]||(d[t]=[]),d[t]=d[t].concat(f[t])})),d}),{})}function Ma({inContext:t,tournamentRecord:e,participantsProfile:n}){var i;let r=e.participants||[];return null!=n&&n.withISO&&r.forEach((t=>la({participant:t}))),(t||null!=n&&n.withGroupings)&&null!==(i=r)&&void 0!==i&&i.length&&(r=sa({participants:r})),r}function Aa({participantsProfile:t,tournamentRecord:e,contextProfile:n,nextMatchUps:i,matchUpId:r,inContext:a}){if(!e)return{error:G};if("string"!=typeof r)return{error:"Missing matchUpId"};const{matchUps:o}=wa({tournamentRecord:e}),s=o.find((t=>t.matchUpId===r));if(!s)return{error:"matchUp not found"};const{eventId:c,drawId:u}=s,{event:d,drawDefinition:l}=Yn({tournamentRecord:e,eventId:c,drawId:u}),p={surfaceCategory:d.surfaceCategory||e.surfaceCategory,indoorOutDoor:d.indoorOutDoor||e.indoorOutDoor,endDate:d.endDate||e.endDate,tournamentId:e.tournamentId,eventId:c,drawId:u},m=e.participants||[],{matchUp:f,structure:h}=ca({context:a&&p,tournamentParticipants:m,participantsProfile:t,drawDefinition:l,contextProfile:n,nextMatchUps:i,matchUpId:r,inContext:a,event:d});return{matchUp:f,structure:h,drawDefinition:l}}function Ea({collectionDefinitions:t}){let e=0;for(const n of t){const{collectionValueProfiles:t,collectionValue:i,matchUpCount:r,matchUpValue:a}=n;if(i)e+=i;else if(t)for(const n of t)e+=n.matchUpValue;else a&&(e+=r*a)}return e?{valueGoal:Math.floor(e/2)+1}:{aggregateValue:!0}}function ba({drawDefinition:t,structureId:e,matchUpId:n,eventId:i,event:r}){if((n||e)&&!t)return{error:q};let a,o,s,c;if(i&&null!=r&&r.tieFormat)c=r.tieFormat;else if(n){var u;if(({error:a,matchUp:o,structure:s}=ca({drawDefinition:t,matchUpId:n})),a)return{error:a};c=o.tieFormat||(null===(u=s)||void 0===u?void 0:u.tieFormat)||(null==t?void 0:t.tieFormat)}else if(t&&e){var d,l;s=null===(d=hr({drawDefinition:t,structureId:e}))||void 0===d?void 0:d.structure,c=(null===(l=s)||void 0===l?void 0:l.tieFormat)||t.tieFormat}else c=null==t?void 0:t.tieFormat;return{tieFormat:c,matchUp:o,structure:s}}function Ra(t,e){var n;if(!t)return;let i=Date.now();i===t.updatedAt&&(i+=1);const r=null==e?void 0:e.filter(Boolean);t.updatedAt=i,null===(n=t.structures)||void 0===n||n.forEach((t=>{(null==r||!r.length||null!=r&&r.includes(t.structureId))&&(t.updatedAt=i)}))}function Ca({drawDefinition:t,matchUps:e,tournamentId:n}){Ra(t),at({topic:"addMatchUps",payload:{matchUps:e,tournamentId:n}})}function Oa({drawDefinition:t,tournamentId:e,matchUpIds:n,action:i}){Ra(t),at({topic:"deletedMatchUpIds",payload:{tournamentId:e,matchUpIds:n,action:i}})}function La({drawDefinition:t,matchUp:e,tournamentId:n}){xa({drawDefinition:t,structureIds:[e.structureId]}),at({topic:"modifyMatchUp",payload:{matchUp:e,tournamentId:n},key:e.matchUpId})}function Fa({drawDefinition:t}){Ra(t),at({topic:"addDrawDefinition",payload:{drawDefinition:t},key:t.drawId})}function xa({drawDefinition:t,structureIds:e}){Ra(t,e),at({topic:"modifyDrawDefinition",payload:{drawDefinition:t},key:t.drawId})}function ka({tournamentRecord:t,drawDefinition:e,tieFormatName:n,collectionId:i,structureId:r,matchUpId:a,eventId:o,event:s}){var c;let u=ba({drawDefinition:e,structureId:r,matchUpId:a,eventId:o,event:s});if(u.error)return u;const{matchUp:d,structure:l,tieFormat:p}=u;if(u=Xt({tieFormat:p}),!u.valid)return{error:$,errors:u.errors};const m=p.winCriteria.valueGoal;if(!(null==p||null===(c=p.collectionDefinitions)||void 0===c?void 0:c.find((t=>t.collectionId===i))))return{error:J,collectionId:i};let f=[];if(a&&d)f=[d];else if(r&&l){var h;f=null===(h=oa({matchUpFilters:{matchUpTypes:[Zt]},structure:l}))||void 0===h?void 0:h.matchUps}else{var v;f=null===(v=Na({matchUpFilters:{matchUpTypes:[Zt]},drawDefinition:e}))||void 0===v?void 0:v.matchUps}const I=[];for(const y of f){for(const t of(null==y?void 0:y.sides)||[])t.lineUp=(t.lineUp||[]).map((t=>((null==t?void 0:t.collectionAssignments)||[]).filter((t=>t.collectionId!==i))));y.tieMatchUps=(y.tieMatchUps||[]).filter((t=>{const e=t.collectionId===i;return e&&I.push(t.matchUpId),!e}))}I.length&&Oa({tournamentId:null==t?void 0:t.tournamentId,matchUpIds:I,drawDefinition:e}),p.collectionDefinitions=p.collectionDefinitions.filter((t=>t.collectionId!==i));const{aggregateValue:g,valueGoal:U}=Ea({collectionDefinitions:p.collectionDefinitions});if(p.winCriteria={aggregateValue:g,valueGoal:U},m&&m!==U&&(n?p.tieFormatName=n:delete p.tieFormatName),o)s.tieFormat=p;else if(d)d.tieFormat=p,La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUp:d});else if(l)l.tieFormat=p;else{if(!e)return{error:q};e.tieFormat=p}return xa({drawDefinition:e}),{...B,tieFormat:p}}function _a({collectionDefinition:t,drawDefinition:e,tieFormatName:n,structureId:i,matchUpId:r,eventId:a,event:o}){const{valid:s,errors:c}=te({collectionDefinition:t});if(!s)return{error:$,errors:c};let u=ba({drawDefinition:e,structureId:i,matchUpId:r,eventId:a,event:o});if(u.error)return u;const{matchUp:d,structure:l,tieFormat:p}=u;if(u=Xt({tieFormat:p}),!u.valid)return{error:$,errors:u.errors};const m=p.winCriteria.valueGoal;if(t.collectionId){if(p.collectionDefinitions.map((({collectionId:t})=>t)).includes(t.collectionId))return{error:"Duplicate value",collectionId:t.collectionId}}else t.collectionId=Yt();p.collectionDefinitions.push(t),p.collectionDefinitions.sort(((t,e)=>(t.collectionOrder||0)-(e.collectionOrder||0))).forEach(((t,e)=>t.collectionOrder=e+1));const{aggregateValue:f,valueGoal:h}=Ea({collectionDefinitions:p.collectionDefinitions});if(p.winCriteria={aggregateValue:f,valueGoal:h},m&&m!==h&&(n?p.tieFormatName=n:delete p.tieFormatName),a)o.tieFormat=p;else if(d)d.tieFormat=p;else if(l)l.tieFormat=p;else{if(!e)return{error:q};e.tieFormat=p}return{...B,tieFormat:p}}const Ba={stringifyMatchUpFormat:r,isValidMatchUpFormat:h,removeCollectionDefinition:ka,parseMatchUpFormat:u,generateTieMatchUpScore:we,tallyParticipantResults:xe,addCollectionDefinition:_a,getTiebreakComplement:_e,generateScoreString:In,checkSetIsComplete:je,validateTieFormat:Xt,getSetComplement:ke,analyzeMatchUp:wn,keyValueScore:function(t){let{lowSide:e=1,value:n}=t,{scoreString:i,sets:r,winningSide:a,matchUpStatus:o}=t;const{matchUpFormat:s,shiftFirst:c,auto:u=!0}=t;let d,l;const p=c&&2===e||!c&&1===e;if(!on.includes(n))return{updated:!1,message:"invalid key"};c&&(e=3-e);const{matchUpWinningSide:m}=fn({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;const f=vn({value:n,winningSide:a,scoreString:i,sets:r,matchUpFormat:s});if(en.includes(n)&&(n=Xe),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&0===parseInt(n)&&(f.isTiebreakCloser=!0),Qe.includes(n)&&f.hasOpener&&(n=""),Qe.includes(n)&&(n="space"),f.lastSetIsComplete){var h;const t=(null===(h=i)||void 0===h?void 0:h.length)&&i[i.length-1];i&&" "!==t&&(i+=" ")}if(f.isTimedSet)({message:l,sets:r,scoreString:i,updated:d,matchUpStatus:o,winningSide:a}=function({analysis:t,lowSide:e,scoreString:n,sets:i,winningSide:r,matchUpStatus:a,message:o,value:s}){var c;let u,d;null!==(c=i)&&void 0!==c&&c.length||s===$e||(i=[{setNumber:1}]);const l=i.length-1;if(Je.includes(s)){const c=i[i.length-1]||{},{side1Score:d,side2Score:l}=c;d&&!l?o="missing side2Score":t.finalSetIsComplete||r?o="final set is already complete":t.isIncompleteSetScore?o="incomplete set scoreString":t.isIncompleteSetScore||({sets:i,scoreString:n,winningSide:r,matchUpStatus:a,updated:u}=hn({lowSide:e,value:s,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(s===$e){var p;if(({scoreString:n,sets:i,outcomeRemoved:d}=ln({analysis:t,scoreString:n,sets:i})),""===(null===(p=n)||void 0===p?void 0:p.trim())&&(n=n.trim()),n||(i=[]),d){const t=i[i.length-1]||{},{side1Score:e,side2Score:n}=t;if(e&&n){const r=e>n?1:n>e?2:void 0;r&&(t.winningSide=r,i.push({setNumber:i.length+1}))}}a=void 0,r=void 0,u=!0}else if(t.hasOutcome)o="has outcome";else{if(r)return{sets:i,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,message:"matchUp is complete"};if("space"===s){const e=i[i.length-1]||{},{side1Score:a,side2Score:o}=e,s=a>o?1:o>a?2:void 0;!s||r||t.isIncompleteSetScore||(i[i.length-1].winningSide=s,i.push({setNumber:i.length+1}),n+=" ",u=!0)}else if(s===Xe&&void 0!==i[l].side1Score&&void 0===i[l].side2Score&&n&&t.isNumericEnding)n+="-",i[l].side2Score=0,a=void 0,r=void 0,u=!0;else if(!isNaN(s)){let t;if(void 0===i[l].side2Score){const e=parseInt((i[l].side1Score||0).toString()+s).toString().slice(0,2);i[l].side1Score=parseInt(e),t=i[l].side1Score.toString(),u=!0}else{const e=parseInt((i[l].side2Score||0).toString()+s).toString().slice(0,2);i[l].side2Score=parseInt(e),t=[i[l].side1Score,i[l].side2Score].join("-"),u=!0}if(u){const e=(i.slice(0,l)||[]).filter((t=>t)).map((t=>{const{side1Score:e,side2Score:n}=t;return[e,n].join("-")})).join(" ");n=e?e+" "+t:t}}}return{sets:i,scoreString:n,winningSide:r,matchUpStatus:a,message:o,updated:u}}({analysis:f,lowSide:e,scoreString:i,sets:r,matchUpStatus:o,winningSide:a,value:n}));else if(Je.includes(n))f.finalSetIsComplete||a?l="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?l="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:n}):({sets:r,scoreString:i,matchUpStatus:o,winningSide:a,updated:d}=hn({lowSide:e,sets:r,scoreString:i,matchUpStatus:o,winningSide:a,value:n}));else if(n===$e)d=!0,({scoreString:i,sets:r}=ln({analysis:f,scoreString:i,sets:r,lowSide:e,auto:u})),i||(r=[]),o=void 0,a=void 0;else if(f.hasOutcome)l="has outcome";else if(n!==Xe||f.isMatchTiebreakEntry)if(n===tn&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?l="existing joiner":f.isNumericEnding&&(d=!0,i+=tn);else if([Xe,tn].includes(n))l="invalid location for joiner";else{if(a)return{updated:!1,message:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:i,updated:d}=function({analysis:t,scoreString:e,sets:n,value:i}){let r;if(null==n||!n.length)return{sets:[]};const a=n[n.length-1];i=parseInt(i);const{validSide2Score:o,requiresTiebreak:s}=function({analysis:t,set:e={},value:n}){const i=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=i,{side1Score:s}=e;let c,u;return c=r&&r<a?s===r?n<=a:n<=r:s===a?o?n<a:n<=a+1:s===a-1?o?n<=a:n<=a+1:s===a+1?n===a||n===a-1:n<=a,c&&(u=r&&r<a?s===a&&n===r||s===r&&n===a:s>=a&&n>=a&&s!==n),{validSide2Score:c,requiresTiebreak:u}}({analysis:t,set:a,value:i});if(o){r=!0,e=(e||"")+i,a.side2Score=i;const o=Be({analysis:t,set:n[n.length-1]});a.winningSide=o||void 0,s?e+="()".split("")[0]:t.isDecidingSet||(e+=" ")}return{sets:n,scoreString:e,updated:r}}({analysis:f,scoreString:i,sets:r,value:n}));else if(f.isInvalidMatchTiebreakValue)l="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)l="invalid set tiebreak character";else if(f.isTiebreakCloser){const t=f.isSetTiebreakEntry?"()":"[]",e=t.split("").reverse()[0],n=t.split("")[0],a=r[r.length-1],{tiebreakFormat:o}=f.setFormat,{tiebreakTo:s,NoAD:c}=o||{},u=Ve({set:a});if(!f.isTiebreakSet){const t=parseInt(i.split(n).reverse()[0]),e=mn({lowValue:t,tiebreakTo:s,NoAD:c});1===u?(a.side1TiebreakScore=e,a.side2TiebreakScore=t):(a.side1TiebreakScore=t,a.side2TiebreakScore=e)}i=(i||"")+e,f.isDecidingSet||(i+=" ");const l=Be({analysis:f,set:a});a.winningSide=l||void 0,d=!0}else if(f.isTiebreakSetValue)({message:l,scoreString:i,sets:r,updated:d}=function({analysis:t,auto:e,lowSide:n,scoreString:i="",sets:r,value:a}){let o,s;const{tiebreakSet:{tiebreakTo:c,NoAD:u}}=t.setFormat,[d]="[]".split("");if(t.isMatchTiebreakEntry||(i+=d),r[t.setNumber-1]){var l;const{lastOpenBracketIndex:t}=pn({scoreString:i,brackets:"[]"}),d=(i.slice(t+1)+(e?"":a)).split(tn);if(((null===(l=d[n-1])||void 0===l?void 0:l.length)||0)>=2)s="tiebreak digit limit";else if(e){1===n&&(d[0]=(d[0]||"")+a),2===n&&(d[1]=(d[1]||"")+a);const e=[d[0]||0,d[1]||0].map((t=>parseInt(t))),s=1===n?1:0;e[s]=e[1-s]+(u?1:2),e[s]<c&&(e[s]=c);const l=r[r.length-1];l.side1TiebreakScore=e[0],l.side2TiebreakScore=e[1],i=i.slice(0,t+1),i+=e.join(tn),o=!0}else{const t=[d[0]||0,d[1]||0].map((t=>parseInt(t))),e=r[r.length-1];e.side1TiebreakScore=t[0],e.side2TiebreakScore=t[1],i+=a,o=!0}}else{const t=mn({lowValue:parseInt(a||0),tiebreakTo:c,NoAD:u}),e=[parseInt(a),t];2===n&&e.reverse();const s={side1TiebreakScore:e[0],side2TiebreakScore:e[1],setNumber:(null==r?void 0:r.length)+1||1};r.push(s),i+=e.join(tn),o=!0}return{message:s,scoreString:i,sets:r,updated:o}}({analysis:f,auto:u,lowSide:e,scoreString:i,sets:r,value:n}));else if(f.isSetTiebreakEntry){const[t]="()".split(""),e=Math.max(...L(t,i.split(""))),r=i.slice(e+1),a=r&&0===parseInt(r),o=parseInt(r?r+n:n),{tiebreakFormat:s}=f.setFormat,{tiebreakTo:c,NoAD:u}=s||{};!a&&r.length<2?u&&o>c-1?l="invalid low value for NoAD tiebreak":(d=!0,i=(i||"")+n):l=a?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)l=`invalid key: ${n}`;else if(f.isGameScoreEntry)l="game scoreString entry";else if(f.lastSetIsComplete||!r.length){var v,I;d=!0;const{scoreString:t,set:a}=function({analysis:t,lowSide:e,scoreString:n,value:i}){const{setTo:r,tiebreakAt:a,NoAD:o}=null==t?void 0:t.setFormat,s=i===parseInt(a||r);if(a&&a<r&&i>a)return{scoreString:n};if(o&&i===r||i>r)return{scoreString:n};const c=[i,s?i+1:i+1===r?i+(o?1:2):r];2===e&&c.reverse();const u="()".split("")[0];n=(n||"")+(c.join(Xe)+(s?u:" "));const d={side1Score:c[0],side2Score:c[1]},l=Be({analysis:t,set:d});return d.winningSide=l||void 0,{scoreString:n,set:d}}({analysis:f,lowSide:e,scoreString:i,value:parseInt(n)});a&&(a.setNumber=(null===(v=r)||void 0===v?void 0:v.length)+1||1),r=(null===(I=r)||void 0===I?void 0:I.concat(a).filter(Boolean))||[a],i=t||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(d=!0,({scoreString:i,sets:r}=ln({analysis:f,scoreString:i,sets:r,lowSide:e,auto:u})),o=void 0);if(d){var g;r=null===(g=r)||void 0===g?void 0:g.filter(Boolean);const{matchUpWinningSide:t}=fn({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=t,!t||o&&![le,ce].includes(o)?!i||a||[He,qe,We].includes(o)||(o=void 0):(o="COMPLETED",r=r.filter((t=>{const{side1Score:e,side2Score:n,side1TiebreakScore:i,side2TiebreakScore:r}=t;return e||n||i||r}))),{updated:d,scoreString:i,sets:r,winningSide:a,matchUpStatus:o,message:l}}return{updated:d,scoreString:i,sets:r,winningSide:a,matchUpStatus:o,message:l}},analyzeSet:Sn};var ja={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Va={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Boys Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Girls Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Ga={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},qa={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},Ha={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},Wa={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},za={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",gender:"MALE",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",gender:"MALE",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",gender:"FEMALE",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",gender:"FEMALE",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",gender:"MALE",matchUpCount:2,matchUpFormat:"SET1-S:8NOAD/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",gender:"MALE",matchUpCount:2,matchUpFormat:"SET1-S:8NOAD/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",gender:"FEMALE",matchUpCount:2,matchUpFormat:"SET1-S:8NOAD/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",gender:"FEMALE",matchUpCount:2,matchUpFormat:"SET1-S:8NOAD/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Ka={collectionDefinitions:[{collectionName:"Boys Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Girls Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Boys Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Girls Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Ya={collectionDefinitions:[{collectionName:"Boys Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Girls Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Boys Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Girls Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},$a={collectionDefinitions:[{collectionName:"Boys Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Girls Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Ja={collectionDefinitions:[{collectionGroupNumber:1,collectionName:"Boys Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionGroupNumber:1,collectionName:"Girls Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionGroupNumber:2,collectionName:"Boys Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionGroupNumber:2,collectionName:"Girls Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionGroupNumber:3,collectionName:"Mixed Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles"},{groupNumber:2,groupName:"Singles"},{groupNumber:3,groupName:"Mixed Doubles"}],tieFormatName:"USTA_WTT",winCriteria:{valueGoal:3}},Za={collectionDefinitions:[{collectionName:"Boys Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Girls Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Boys Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Girls Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}};const Qa={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:ja,DOMINANT_DUO_MIXED:Va,LAVER_CUP:Ga,TEAM_DOUBLES_3_AGGREGATION:qa,USTA_BREWER_CUP:Ha,USTA_COLLEGE:Wa,USTA_GOLD_TEAM_CHALLENGE:za,USTA_INTERSECTIONAL:Ka,USTA_LEVEL_1:Ya,USTA_SOUTHERN_LEVEL_5:$a,USTA_WTT:Ja,USTA_ZONAL:Za},Xa={positionActions:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Gi,Vi],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:["SEED_VALUE","NICKNAME","PENALTY"],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1}},to={seeding:{policyName:"USTA",seedingProfile:"SEPARATE",duplicateSeedNumbers:!0,drawSizeProgression:!0,validSeedPositions:{ignore:!0},seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function eo({court:t,date:e}){const n=e&&t.dateAvailability.find((t=>Gt(t.date,e))),i=t.dateAvailability.find((t=>!t.date));return n||i}function no({courtDate:t,includeBookingTypes:e=[]}){const n=[];let i=kt(t.startTime);(t.bookings||[]).filter((t=>!t.bookingType||!e.includes(t.bookingType))).sort(((t,e)=>Ct(t.startTime).localeCompare(Ct(e.startTime)))).forEach((t=>{const e={startTime:Ot(i.toISOString()),endTime:t.startTime};kt(t.startTime)>i&&n.push(e),kt(t.endTime)>i&&(i=kt(t.endTime))}));const r={startTime:Ot(i.toISOString()),endTime:t.endTime};return kt(t.endTime)>i&&n.push(r),n}function io({includeBookingTypes:t,averageMatchUpMinutes:e,periodLength:n,periodStart:i,courts:r,date:a}){const o=kt(i),s=jt(o,e),{enoughTime:c}=function({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:n,periodEndTime:i,periodLength:r}){function a(t){const r=kt(t.startTime),a=kt(t.endTime);return!(r>n)&&!(a<i)&&_t(n,a)>=e}return{enoughTime:e=>!!no({courtDate:e,periodLength:r,includeBookingTypes:t}).filter(a).length}}({includeBookingTypes:t,averageMatchUpMinutes:e,periodStartTime:o,periodEndTime:s,periodLength:n});return{availableToScheduleCount:r.filter((t=>{if(!Array.isArray(t.dateAvailability))return!1;const e=eo({date:a,court:t});return!(!e||!c(e))})).length}}function ro({remainingScheduleTimes:t=[],clearScheduleDates:e,periodLength:n=30,bookings:i=[],scheduleDate:r,courts:a=[]}){if(!Array.isArray(a)||!a.length)return{error:$,courts:a};if(!Array.isArray(i))return{error:"Invalid bookings"};if(!wt(r))return{error:K};e&&(Array.isArray(e)?e.includes(r)&&(i=[]):i=[]);const{courtBookings:o,unassignedBookings:s}=i.reduce(((t,e)=>{const{courtId:n}=e;return n?t.courtBookings[n]?t.courtBookings[n].push(e):t.courtBookings[n]=[e]:t.unassignedBookings.push(e),t}),{courtBookings:{},unassignedBookings:[]}),c=a.map(((e,n)=>{const{courtId:i}=e,a=o[i]||[],s=eo({date:r,court:e})||{},{date:c,startTime:u,endTime:d,bookings:l=[]}=s;return{courtId:i,dateAvailability:{date:c,startTime:u,endTime:d,bookings:[t[n]&&{startTime:u,endTime:t[n]},...Ht(l,!1,!0),...a].filter(Boolean)}}}));s.sort(((t,e)=>Rt(t.startTime)-Rt(e.startTime)));for(const u of s){const{startTime:t,endTime:e,averageMinutes:i,recoveryMinutes:r,matchUpId:a}=u,o=Rt(t),s=Rt(e),d=c.map((t=>{const e=no({courtDate:t.dateAvailability});return{courtId:t.courtId,timeSlots:e}})).flat().reduce(((t,{courtId:e,timeSlots:i})=>{let r;return i.find((({startTime:e,endTime:i})=>{r=Rt(e)-o;const a=o>=Rt(e);return s<=Rt(i)&&0!==t.startDifference&&((0===r||r+n>=0)&&(void 0===t.startDifference||r<t.startDifference)||a)}))?{courtId:e,startDifference:r}:t}),{courtId:void 0,startDifference:void 0});if(d.courtId){const n={averageMinutes:i,recoveryMinutes:r,matchUpId:a,startTime:t,endTime:e};c.find((({courtId:t})=>t===d.courtId)).dateAvailability.bookings.push(n)}else console.log({unassignedBooking:u})}return{virtualCourts:c.map((({courtId:t,dateAvailability:e})=>({courtId:t,dateAvailability:[e]})))}}function ao({startTime:t="8:00",endTime:e="20:30",count:n=10,date:i}={}){return O(0,n).map((()=>({dateAvailability:[{date:i,startTime:t,endTime:e}]})))}function oo({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,averageMatchUpMinutes:n=90,date:i=Nt(),clearScheduleDates:r,periodLength:a=30,startTime:o="08:00",endTime:s="19:00",courtsCount:c,bookings:u,courts:d}={}){i=Lt(i),o=Ot(o),s=Ot(s);let l=0,p=0,m=0,f=0,h=0;!d&&c&&(d=ao({startTime:o,endTime:s,count:c,date:i}));const{virtualCourts:v}=ro({remainingScheduleTimes:e,scheduleDate:i,clearScheduleDates:r,periodLength:a,bookings:u,courts:d}),{firstTimeSlotStartTime:I}=function({averageMinutes:t,startTime:e,endTime:n,courts:i,date:r}){let a;if(e&&n){const o=kt(e),s=kt(n);for(const e of i){if(!Array.isArray(e.dateAvailability))return!1;no({courtDate:eo({court:e,date:r})}).find((e=>{const n=kt(e.startTime),i=kt(e.endTime);if(n>s||n<o)return!1;if(i<o)return!1;const r=_t(n,i)>=t;if(r){const t=Ot(n.toISOString());(!a||t<a)&&(a=t)}return r}))}}return{firstTimeSlotStartTime:a}}({averageMinutes:n,courts:v,startTime:o,endTime:s,date:i});t&&I&&(o=I||o);const g=Rt(o),U=Rt(s)-g,y=O(0,Math.floor(U/a)+1).map((t=>{const e=function(t){let e=Math.floor(t/60);const n=t-60*e;return e>23&&(e%=24),[Vt(e),Vt(n)].join(":")}(g+t*a),{availableToScheduleCount:r}=io({courts:v,averageMatchUpMinutes:n,periodLength:a,periodStart:e,period:t,date:i}),o=r>p?r-p:0;h+=t?r:0;const s=t?h/t:r,c=t?a*s/n*(t-1)+s:s,u=r?p?c-l:o:0;l=c,p=r,m+=u;const d=parseInt(m)-f;return f+=d,{periodStart:e,add:d,availableToScheduleCount:r,newCourts:o,totalMatchUps:f}}));return{scheduleTimes:y.reduce(((t,e)=>t.concat(...O(0,e.add).map((()=>({scheduleTime:e.periodStart}))))),[]).flat(),timingProfile:y,totalMatchUps:f}}const so={getCourtsAvailableAtPeriodStart:io,generateTimeSlots:no,getScheduleTimes:oo,courtGenerator:ao};function co({consideredDate:t,category:e}={}){var n,i,r;const a={error:$};if("object"!=typeof e||!wt(t))return a;const o=parseInt(t.split("-")[0]),s=[];let c,{ageCategoryCode:u,categoryName:d,ageMaxDate:l,ageMinDate:p,ageMax:m,ageMin:f}=e;if("string",![u,l,p,d].filter(Boolean).every((t=>"string"==typeof t))||!(t=>t.filter(Boolean).every(U))([m,f]))return a;u=u||d;const h=/^([UO]?)(\d{1,2})([UO]?)$/,v=/^C(\d{1,2})-(\d{1,2})$/,I=(null===(n=u)||void 0===n?void 0:n.indexOf("-"))>0,g=I&&(null===(i=u)||void 0===i?void 0:i.match(v)),y=null===(r=u)||void 0===r?void 0:r.match(h),S=(t,e,n)=>wt(e)?e:e&&e.match(/^\d{2}-\d{2}$/)?`${t}-${e}`:`${t}-${n}`,w=t=>{const[e,n,i]=(t.match(h)||[]).slice(1),r=parseInt(n);"U"===e&&({ageMinDate:p,ageMax:m}=(t=>(p=S(o-t,p,"01-01"),m&&m!==t-1&&s.push(`Invalid ageMax: ${m}`),m||(m=t-1),{ageMinDate:p,ageMax:m}))(r)),"U"===i&&({ageMinDate:p,ageMax:m}=(t=>(p=S(o-t-1,p,"01-01"),m&&m!==t&&s.push(`Invalid ageMax: ${m}`),m||(m=t),{ageMinDate:p,ageMax:m}))(r)),"O"===e&&({ageMaxDate:l,ageMin:f}=(t=>(l=S(o-t-2,l,"12-31"),f&&f!==t+1&&s.push(`Invalid ageMin: ${f}`),f||(f=t+1),{ageMaxDate:l,ageMin:f}))(r)),"O"===i&&({ageMaxDate:l,ageMin:f}=(t=>(l=S(o-t-1,l,"12-31"),f&&f!==t&&s.push(`Invalid ageMin: ${f}`),f||(f=t),{ageMaxDate:l,ageMin:f}))(r))};if(g){const[t,e]=u.match(v).slice(1).map((t=>parseInt(t)));t<=e?(f=f||t,m=m||e,c=!0):s.push(`Invalid combined age range ${u}`)}else I?u.split("-").forEach(w):y&&w(u);return s.length?{error:s}:Wt({combinedAge:c,ageMaxDate:l,ageMinDate:p,ageMax:m,ageMin:f})}function uo(t,e,n=[]){return"object"==typeof t&&Object.keys(t).reduce(((i,r)=>"object"!=typeof t[r]?(i[n.concat(r).join(e)]=t[r],i):Object.assign(i,uo(t[r],e,n.concat(r)))),{})}function lo({element:t,itemType:e,itemSubTypes:n,returnPreviousValues:i}){if(!t)return{error:z};if(!Array.isArray(t.timeItems))return{error:"Missing timeItems"};const r=t.timeItems.filter((t=>(null==t?void 0:t.itemType)===e)).filter((t=>{var e;return!(null!=n&&n.length)||(null==t||null===(e=t.itemSubTypes)||void 0===e?void 0:e.includes(n))})).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))),a=r.pop();if(a){const t={timeItem:a,...B};return i&&Object.assign(t,{previousItems:r}),t}return{message:J}}function po({event:t,itemType:e,itemSubTypes:n,returnPreviousValues:i}){if(!t)return{error:W};if(!t.timeItems)return{message:J};const{timeItem:r,previousItems:a,message:o}=lo({element:t,itemType:e,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:a}||{message:o}}function mo({element:t,timeItem:e,duplicateValues:n=!0}){if(!t)return{error:z};if(!e)return{error:"Missing timeItem"};const i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter((t=>i.includes(t))).length!==r.length)return{error:"Invalid timeItem"};if(t.timeItems){const{itemType:i,itemSubTypes:r,itemValue:a}=e,{timeItem:o}=lo({element:t,itemType:i,itemSubTypes:r});if(JSON.stringify(null==o?void 0:o.itemValue)===JSON.stringify(a)&&!n)return B}else t.timeItems=[];e.itemSubTypes&&!e.itemSubTypes.length&&delete e.itemSubTypes;const a=(new Date).toISOString();return Object.assign(e,{createdAt:a}),t.timeItems.push(e),B}function fo({tournamentRecord:t,duplicateValues:e,participantId:n,timeItem:i}){if(!t)return{error:G};if(!n)return{error:"Missing participantId"};const r=Cn({tournamentRecord:t,participantId:n});return r.error?r:mo({element:r.participant,duplicateValues:e,timeItem:i})}function ho({tournamentRecord:t,duplicateValues:e,timeItem:n}){return t?mo({element:t,timeItem:n,duplicateValues:e}):{error:G}}function vo({event:t,timeItem:e,duplicateValues:n}){return t?mo({element:t,timeItem:e,duplicateValues:n}):{error:"Event not found"}}function Io({tournamentRecord:t,duplicateValues:e,drawDefinition:n,disableNotice:i,matchUpId:r,timeItem:a,event:o}){const{matchUp:s}=ca({drawDefinition:n,event:o,matchUpId:r});if(!s)return{error:"matchUp not found"};const c=mo({element:s,timeItem:a,duplicateValues:e});return i||La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:n,matchUp:s}),c}function go({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,venueId:r}){if(!t)return{error:G};if(!i)return{error:"Missing matchUpId"};if(r){const{error:e}=qn({tournamentRecord:t,venueId:r});if(e)return{error:e}}return Io({duplicateValues:!1,tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,timeItem:{itemType:ti,itemValue:r}})}function Uo({tournamentRecord:t,drawDefinition:e,disableNotice:n,courtDayDate:i,matchUpId:r,courtId:a}){if(!t)return{error:G};if(!r)return{error:"Missing matchUpId"};if(a){const{venue:i,error:o}=Hn({tournamentRecord:t,courtId:a});if(o)return{error:o};go({tournamentRecord:t,drawDefinition:e,matchUpId:r,venueId:null==i?void 0:i.venueId,disableNotice:n})}return Io({duplicateValues:!1,tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:r,timeItem:{itemType:Xn,itemDate:i,itemValue:a}})}function yo(t,e){const n=gt.test(t)?t:Ot(t),i=Lt(t)||Lt(e)||Dt(new Date);return new Date(`${i}T${n}`)}function So(t){return!(void 0!==t&&!yt.test(t))}function wo({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,schedule:r,event:a}){if(!e)return{error:q};if(!i)return{error:"Missing matchUpId"};if(!r)return{error:z};const{endTime:o,courtId:s,resumeTime:c,scheduledDate:u,scheduledTime:d,startTime:l,stopTime:p,venueId:m}=r;if(void 0!==u){const n=No({tournamentRecord:t,disableNotice:!0,drawDefinition:e,scheduledDate:u,matchUpId:i});if(null!=n&&n.error)return{error:n.error,scheduledDate:u}}if(void 0!==d){const n=Do({disableNotice:!0,tournamentRecord:t,drawDefinition:e,scheduledTime:d,matchUpId:i});if(null!=n&&n.error)return{error:n.error,scheduledTime:d}}if(void 0!==l){const n=To({disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,startTime:l,event:a});if(null!=n&&n.error)return{error:n.error,startTime:l}}if(void 0!==p){const n=Ao({disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,stopTime:p,event:a});if(null!=n&&n.error)return{error:n.error,stopTime:p}}if(void 0!==c){const n=Eo({disableNotice:!0,tournamentRecord:t,drawDefinition:e,resumeTime:c,matchUpId:i,event:a});if(null!=n&&n.error)return{error:n.error,resumeTime:c}}if(void 0!==o){const n=Mo({disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,endTime:o,event:a});if(null!=n&&n.error)return{error:n.error,endTime:o}}if(void 0!==s&&void 0!==u){const n=Uo({courtDayDate:u,disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,courtId:s,event:a});if(null!=n&&n.error)return{error:n.error,courtId:s}}else if(void 0!==m){const n=go({disableNotice:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,venueId:m,event:a});if(null!=n&&n.error)return{error:n.error,venueId:m}}if(!n){const{matchUp:n}=ca({drawDefinition:e,event:a,matchUpId:i});if(!n)return{error:"matchUp not found"};La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUp:n})}return{...B}}function No({tournamentRecord:t,drawDefinition:e,disableNotice:n,scheduledDate:i,matchUpId:r}){if(!r)return{error:"Missing matchUpId"};const a=Ut.test(i);return i&&!a?{error:K}:Io({duplicateValues:!1,tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:r,timeItem:{itemType:ei,itemValue:i}})}function Do({tournamentRecord:t,drawDefinition:e,disableNotice:n,scheduledTime:i,matchUpId:r}){return r?So(i)?Io({duplicateValues:!1,tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:r,timeItem:{itemType:ii,itemValue:i}}):{error:"Invalid time"}:{error:"Missing matchUpId"}}function Po({tournamentRecord:t,drawDefinition:e,disableNotice:n,participantId:i,officialType:r,matchUpId:a}){return a?Io({duplicateValues:!1,tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:a,timeItem:{itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemSubTypes:[r],itemValue:i}}):{error:"Missing matchUpId"}}function To({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,startTime:r,event:a}){if(!i)return{error:"Missing matchUpId"};if(!So(r))return{error:"Invalid time"};const{matchUp:o}=ca({drawDefinition:e,event:a,matchUpId:i}),{scheduledDate:s}=pi({matchUp:o}),c=(o.timeItems||[]).filter((t=>[ai,oi,si].includes(null==t?void 0:t.itemType))).map((t=>yo(t.itemValue,s))).reduce(((t,e)=>!t||e<t?e:t),void 0);return!c||yo(r,s)<c?(o.timeItems&&(o.timeItems=o.timeItems.filter((t=>t.itemType!==ri))),Io({duplicateValues:!1,tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,timeItem:{itemType:ri,itemValue:r}})):{error:"Invalid startTime"}}function Mo({validateTimeSeries:t=!0,tournamentRecord:e,drawDefinition:n,disableNotice:i,matchUpId:r,endTime:a,event:o}){if(!r)return{error:"Missing matchUpId"};if(!So(a))return{error:"Invalid time"};const{matchUp:s}=ca({drawDefinition:n,event:o,matchUpId:r}),{scheduledDate:c}=pi({matchUp:s}),u=(s.timeItems||[]).filter((t=>[ri,oi,ai].includes(null==t?void 0:t.itemType))).map((t=>yo(t.itemValue,c))).reduce(((t,e)=>!t||e>t?e:t),void 0);return!t||!u||yo(a,c)>u?(s.timeItems&&(s.timeItems=s.timeItems.filter((t=>t.itemType!==si))),Io({duplicateValues:!1,tournamentRecord:e,drawDefinition:n,disableNotice:i,matchUpId:r,timeItem:{itemType:si,itemValue:a}})):{error:"Invalid endTime"}}function Ao({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,stopTime:r,event:a}){if(!i)return{error:"Missing matchUpId"};if(!So(r))return{error:"Invalid time"};const{matchUp:o}=ca({drawDefinition:e,event:a,matchUpId:i}),{scheduledDate:s}=pi({matchUp:o}),c=o.timeItems||[];if(c.reduce(((t,e)=>e.itemType===si||t),void 0))return{error:"Existing endTime"};const u=c.filter((t=>[ri,oi,ai].includes(null==t?void 0:t.itemType))).sort(((t,e)=>yo(t.itemValue,s)-yo(e.itemValue,s))),d=u[u.length-1],l=d&&d.itemType===ai,p=u.filter((t=>!l||t.createdAt!==d.createdAt)).map((t=>yo(t.itemValue,s))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(yo(r,s)>p){if(o.timeItems&&l){const t=d.createdAt;o.timeItems=o.timeItems.filter((e=>e.createdAt!==t))}return Io({duplicateValues:!0,tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,timeItem:{itemType:ai,itemValue:r}})}return{error:"Invalid stopTime"}}function Eo({tournamentRecord:t,drawDefinition:e,disableNotice:n,resumeTime:i,matchUpId:r,event:a}){if(!r)return{error:"Missing matchUpId"};if(!So(i))return{error:"Invalid time"};const{matchUp:o}=ca({drawDefinition:e,event:a,matchUpId:r}),{scheduledDate:s}=pi({matchUp:o}),c=o.timeItems||[];if(c.reduce(((t,e)=>e.itemType===si||t),void 0))return{error:"Existing endTime"};const u=c.filter((t=>[ri,oi,ai].includes(null==t?void 0:t.itemType))).sort(((t,e)=>yo(t.itemValue,s)-yo(e.itemValue,s))),d=u[u.length-1],l=d&&d.itemType===oi,p=u.filter((t=>!l||t.createdAt!==d.createdAt)).map((t=>yo(t.itemValue,s))).reduce(((t,e)=>!t||e>t?e:t),void 0);if(yo(i,s)>p){if(o.timeItems&&l){const t=d.createdAt;o.timeItems=o.timeItems.filter((e=>e.createdAt!==t))}return Io({duplicateValues:!0,tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:r,timeItem:{itemType:oi,itemValue:i}})}return{error:"Invalid resumeTime"}}function bo({tournamentRecord:t,matchUpIds:e,schedule:n}){if(!t)return{error:G};if(!e||!Array.isArray(e))return{error:"Missing matchUpIds"};if(!n||"object"!=typeof n)return{error:"Missing schedule"};const{matchUps:i}=wa({tournamentRecord:t}),r=i.reduce(((t,e)=>{const{matchUpId:n,drawId:i}=e;return t[i]?t[i].push(n):t[i]=[n],t}),{});for(const a of Object.keys(r)){const{drawDefinition:i}=$n({tournamentRecord:t,drawId:a}),o=r[a].filter((t=>e.includes(t)));for(const e of o){const r=wo({tournamentRecord:t,drawDefinition:i,matchUpId:e,schedule:n});if(r.error)return r}}return{...B}}function Ro({tournamentRecords:t}){return t?Object.keys(t).reduce(((e,n)=>{e.tournamentIdMap[n]=[];const i=t[n].events||[],r=i.map((({eventId:t})=>t)),a=i.map((t=>(t.drawDefinitions||[]).map((({drawId:t})=>t)))).flat();return e.tournamentIdMap[n].push(...r,...a),e.eventIds.push(...r),e.drawIds.push(...a),e}),{eventIds:[],drawIds:[],tournamentIdMap:{}}):{error:"Missing tournamentRecords"}}function Co({drawId:t,eventId:e,tournamentRecords:n}){const{tournamentIdMap:i}=Ro({tournamentRecords:n});return Object.keys(i).find((n=>i[n].includes(e)||i[n].includes(t)))}function Oo({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:n,winningSide:i,score:r}){if("object"!=typeof r)return{error:$};const{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r;if(void 0!==o&&"string"!=typeof o)return{error:$,message:"scoreString must be a string!"};if(void 0!==s&&"string"!=typeof s)return{error:$,message:"scoreString must be a string!"};if(void 0!==a&&!Array.isArray(a))return{error:$,message:"sets must be an array"};if(null!=a&&a.length){const o=a.map((t=>null==t?void 0:t.setNumber)).filter(Boolean);if(o.length!==T(o).length)return{error:$,message:"setNumbers not unique"};for(const t of a){const{side1Score:e,side2Score:n,side1TiebreakScore:i,side2TiebreakScore:r,side1PointScore:a,side2PointScore:o,winningSide:s,setNumber:c}=t;if(![[e,n],[i,r],[a,o]].filter((t=>t.some((t=>void 0!==t)))).every((t=>t.every((t=>w(t))))))return{error:$,message:"non-numeric values"};if(![c,s].filter((t=>void 0!==t)).every((t=>w(t))))return{error:$,message:"non-numeric values"};if(s&&![1,2].includes(s))return{error:$,message:"winningSide must be 1 or 2"}}if(!function({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:n,winningSide:i,score:r}){const a=null==r?void 0:r.sets,o=((null==a?void 0:a.filter((t=>null==t?void 0:t.winningSide)))||[]).reduce(((t,e)=>{const{winningSide:n}=e;return t[n-1]++,t}),[0,0]),s=i&&i-1,c=1-s,d=o[s],l=o[c],p=u(e),m=Math.max(...o),f=A(o)[m],{bestOf:h}=p||{},v=h&&Math.ceil(h/2)||1,I=[ae,ue,pe].includes(n||t),g=(!e||m===v)&&1===f&&o.indexOf(m)+1||void 0;return i&&d>l&&i===g||!i&&!g||I}({existingMatchUpStatus:t,matchUpStatus:n,matchUpFormat:e,winningSide:i,score:r}))return{error:"Invalid winningSide",message:"winningSide does not match analyzed score"}}return{valid:!0}}function Lo({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter((({drawPositions:e})=>t&&(null==e?void 0:e.includes(t)))).map((({roundNumber:t})=>parseInt(t))).sort(Kt)[0]}}function Fo({inContextDrawMatchUps:t,positionAssignments:e,targetDrawPosition:n,tournamentRecord:i,drawDefinition:r,dualMatchUp:a,matchUp:o}){if(a){var s,c,u;const e=null===(s=t.find((({matchUpId:t})=>o.matchUpId===t)).sides)||void 0===s||null===(c=s.find((t=>t.drawPosition===n)))||void 0===c?void 0:c.sideNumber,i=null===(u=o.sides)||void 0===u?void 0:u.find((t=>t.sideNumber===e));i&&delete i.lineUp}o.drawPositions=(o.drawPositions||[]).map((t=>t===n?void 0:t));const d=e.filter((({drawPosition:t})=>o.drawPositions.includes(t))).filter((t=>t.bye)).length;return o.matchUpStatus=d?ne:o.matchUpStatus===pe?pe:le,o.matchUpStatus===pe&&(o.winningSide=void 0),La({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:r,matchUp:o}),{...B}}function xo({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:n}){return t||({matchUps:t,matchUpsMap:n}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:n})),(t||[]).filter((({collectionId:t})=>!t)).forEach((i=>{const{matchUpId:r,structureId:a}=i,o=ha({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:r}),{winnerMatchUp:s,loserMatchUp:c}=o.targetMatchUps,u=null==s?void 0:s.matchUpId,d=null==c?void 0:c.matchUpId,l=ji({matchUpsMap:n,structureId:a}).find((t=>t.matchUpId===r));l&&(u&&(Object.assign(l,{winnerMatchUpId:u}),Object.assign(i,{winnerMatchUpId:u})),d&&(Object.assign(l,{loserMatchUpId:d}),Object.assign(i,{loserMatchUpId:d})))})),{inContextDrawMatchUps:t}}function ko(t){var e;const{sides:n,matchUpType:i}=t||{},r=null!==(e=t.potentialParticipants)&&void 0!==e&&e.length?t.potentialParticipants.flat().map((t=>i===Jt?(null==t?void 0:t.individualParticipantIds)||[]:t.participantId)).flat():[],a=(n||[]).map((t=>{var e;return i===Jt?(null==t||null===(e=t.participant)||void 0===e?void 0:e.individualParticipantIds)||[]:null!=t&&t.participantId?[t.participantId]:[]})).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function _o({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:$};const{venueIds:n,tournamentsMap:i}=function({tournamentRecords:t={}}={}){const e=t&&Object.values(t)||[],n={},{venueIds:i,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce(((t,e)=>{const{venueIds:i,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s,tournamentMap:c}=Bo({tournamentRecord:e});return i.forEach((e=>{t.venueIds.includes(e)||t.venueIds.push(e)})),t.tournamentIds.push(...s),t.structureIds.push(...o),t.eventIds.push(...r),t.drawIds.push(...a),Object.assign(n,c),t}),{venueIds:[],eventIds:[],drawIds:[],structureIds:[],tournamentIds:[]});return{venueIds:i,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s,tournamentsMap:n}}({tournamentRecords:t});let r,a;const o=e.every((t=>{const{scheduleDate:e,venues:o}=t;return!!wt(e)&&o.every((t=>{const{venueId:e,rounds:o}=t;if("string"!=typeof e)return a="venueId should be a string",!1;if(!Array.isArray(o))return a="rounds should be an array",!1;if(!n.includes(e))return r="Venue not found",!1;return!!o.every((t=>{if(!t)return a="empty round",!1;const{tournamentId:e,eventId:n,drawId:r,structureId:o,roundNumber:s,roundSegment:c}=t,u=i[e]&&i[e][n]&&i[e][n][r]&&i[e][n][r][o],d=null==u?void 0:u.includes(s);d||(a="Invalid rounds");const{segmentNumber:l,segmentsCount:p}=c||{},m=!c||w(l)&&I(p)&&l<=p;return m||(a="Invalid segment"),d&&m}))}))}));return o||r||(r=$),{valid:!!o,error:r,message:a}}function Bo({tournamentRecord:t={},tournamentMap:e={},requireCourts:n}={}){const i=[],r=[],a=[],o=[],s=((null==t?void 0:t.venues)||[]).map((({venueId:t,courts:e})=>(!n||(null==e?void 0:e.length))&&t)),c=null==t?void 0:t.tournamentId;return c&&(o.push(c),e[c]={},((null==t?void 0:t.events)||[]).forEach((t=>{const n=t.eventId;r.push(n),e[c][n]={},(t.drawDefinitions||[]).forEach((t=>{const r=t.drawId;i.push(r),e[c][n][r]={};const{structures:o}=vr({drawDefinition:t});(o||[]).forEach((t=>{var i;const o=t.structureId,{matchUps:s}=oa({structure:t}),{roundMatchUps:u}=_i({matchUps:s}),d=u&&Object.keys(u).map((t=>parseInt(t)));e[c][n][r][o]=d,a.push(o),null!==(i=t.structures)&&void 0!==i&&i.length&&t.structures.forEach((t=>{a.push(t.structureId),e[c][n][r][t.structureId]=d}))}))}))}))),{tournamentIds:o,venueIds:s,eventIds:r,drawIds:i,structureIds:a,tournamentMap:e}}function jo({tournamentRecord:t}){if(!t)return{error:G};const e=(({tournamentId:t,tournamentRank:e,formalName:n,tournamentName:i,promotionalName:r,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l})=>({tournamentId:t,tournamentRank:e,formalName:n,tournamentName:i,promotionalName:r,onlineResources:a,localTimeZone:o,startDate:s,endDate:c,hostCountryCode:u,tournamentContacts:d,tournamentAddresses:l}))(t);return{...B,tournamentInfo:Ht(e)}}function Vo({tournamentRecords:t}){const e=Object.keys(t).reduce(((e,n)=>{const i=t[n],{tournamentInfo:{startDate:r,endDate:a}}=jo({tournamentRecord:i}),o=r&&new Date(Lt(r));(!e.startDate||o&&o<e.startDate)&&(e.startDate=o);const s=a&&new Date(Lt(a));return(!e.endDate||s&&s>e.endDate)&&(e.endDate=s),e}),{startDate:void 0,endDate:void 0}),n=e.startDate&&Lt(e.startDate.toISOString()),i=e.endDate&&Lt(e.endDate.toISOString());return n&&i?{startDate:n,endDate:i}:{error:"Missing date"}}function Go({tournamentRecords:t,venueIds:e=[]}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const n=[],i=[],r=[],a=[];return Object.keys(t).forEach((o=>{var s;null===(s=t[o].venues)||void 0===s||s.filter((({venueId:t})=>!e.length||e.includes(t))).forEach((t=>{var e;r.includes(t.venueId)||(n.push(Ht(t)),r.push(t.venueId)),null===(e=t.courts)||void 0===e||e.forEach((e=>{if(!a.includes(e.courtId)){const n={...Ht(e,!1,!0),venueId:t.venueId};i.push(n),a.push(e.courtId)}}))}))})),{courts:i,venues:n}}function qo({tournamentRecords:t,requireCourts:e}){return"object"==typeof t&&Object.keys(t).length?Object.keys(t).reduce(((n,i)=>{const r=t[i],{venues:a}=Gn({tournamentRecord:r});return a.forEach((t=>{const{venueId:i,courts:r}=t;(!e||(null==r?void 0:r.length))&&!n.venueIds.includes(i)&&(n.venues.push(t),n.venueIds.push(i))})),n}),{venues:[],venueIds:[]}):{error:"Missing tournamentRecords"}}function Ho({tournamentRecords:t,extension:e}){if(!Ir(e))return{error:$};for(const n of Object.values(t)){const t=yr({tournamentRecord:n,extension:e});if(t.error)return t}return{...B}}function Wo({tournamentRecords:t,name:e}){if(!e)return{error:z,message:"Missing name"};let n;return Object.keys(t).find((i=>{const r=t[i],{extension:a}=Ln({tournamentRecord:r,name:e});return n=a,!!a}))?{extension:n}:{error:J}}function zo({tournamentRecords:t,name:e}){if(!e)return{error:z,message:"Missing name"};let n=0;for(const i of Object.keys(t)){const r=Nr({tournamentRecord:t[i],name:e});if(r.error)return r;r.message!==J&&n++}return{...B,removed:n}}function Ko({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const{extension:e}=Wo({tournamentRecords:t,name:"schedulingProfile"});let n=(null==e?void 0:e.value)||[];if(n.length){const{venueIds:e}=qo({tournamentRecords:t,requireCourts:!0}),{eventIds:i,drawIds:r}=Ro({tournamentRecords:t}),{updatedSchedulingProfile:a,modifications:o,issues:s}=Jo({schedulingProfile:n,venueIds:e,eventIds:i,drawIds:r});if(o){n=a;const e=Yo({tournamentRecords:t,schedulingProfile:n});return e.error?e:{schedulingProfile:n,modifications:o,issues:s}}}return{schedulingProfile:n,modifications:0}}function Yo({tournamentRecords:t,schedulingProfile:e}){const n=_o({tournamentRecords:t,schedulingProfile:e});return n.error?n:e?Ho({tournamentRecords:t,extension:{name:"schedulingProfile",value:e}}):zo({tournamentRecords:t,name:"schedulingProfile"})}function $o({tournamentRecords:t,scheduleDate:e,venueId:n,round:i}){if(!wt(e))return{error:K};const{extension:r}=Wo({tournamentRecords:t,name:"schedulingProfile"}),a=(null==r?void 0:r.value)||[];let o=a.find((t=>Gt(e,t.scheduleDate)));if(!o){const{startDate:n,endDate:i}=Vo({tournamentRecords:t}),r=new Date(e);if(r<new Date(n)||r>new Date(i))return{error:K};o={scheduleDate:e,venues:[]},a.push(o)}let s=o.venues.find((t=>t.venueId===n));s||(s={venueId:n,rounds:[]},o.venues.push(s));const c=["notBeforeTime"],u=t=>Object.keys(t).filter((t=>!c.includes(t))).sort().map((e=>t[e])).join("|");if(s.rounds.find((t=>u(t)===u(i))))return{error:"Existing round"};s.rounds.push(i);const d=Yo({tournamentRecords:t,schedulingProfile:a});return d.error?d:B}function Jo({schedulingProfile:t,venueIds:e,eventIds:n,drawIds:i}){const r=[];return{updatedSchedulingProfile:null==t?void 0:t.map((t=>{const a=Lt(null==t?void 0:t.scheduleDate);if(!a)return void r.push(`Invalid date: ${null==t?void 0:t.scheduledDate}`);const o=((null==t?void 0:t.venues)||[]).map((t=>{const{rounds:a,venueId:o}=t;if(!e.includes(o))return void r.push(`Missing venueId: ${o}`);const s=a.filter((t=>{const e=n.includes(t.eventId)&&i.includes(t.drawId);return e||r.push(`Invalid eventId: ${t.eventId} or drawId: ${t.drawId}`),e}));return s.length?{venueId:o,rounds:s}:void 0})).filter(Boolean);return o.length&&a&&{...t,venues:o}})).filter(Boolean),modifications:r.length,issues:r}}function Zo({tournamentRecords:t}){const{schedulingProfile:e}=Ko({tournamentRecords:t,requireCourts:!0});if(e){const{venueIds:n}=qo({tournamentRecords:t}),{eventIds:i,drawIds:r}=Ro({tournamentRecords:t}),{updatedSchedulingProfile:a,modifications:o}=Jo({schedulingProfile:e,venueIds:n,eventIds:i,drawIds:r});if(o)return Yo({tournamentRecords:t,schedulingProfile:a})}return B}function Qo({matchUps:t=[],schedulingProfile:e}){const n={},i=({eventId:t,drawId:e,structureId:n,roundNumber:i})=>`${t}|${e}|${n}${i}`;null!=e&&e.length&&e.map((({venues:t})=>t.map((({rounds:t})=>t)))).flat().forEach((t=>{t.sort(((t,e)=>(t.sortOrder||0)-(e.sortOrder||0))).forEach((({eventId:t,drawId:e,structureId:r,roundNumber:a},o)=>{const s=i({eventId:t,drawId:e,structureId:r,roundNumber:a});n[s]=o}))}));const r=[],a={noScheduledDate:[]};for(const s of t){const t=s.schedule||{},e=t.scheduledDate&&Lt(t.scheduledDate)||t.scheduledTime&&Lt(t.scheduledTime)||"noScheduledDate";a[e]||(a[e]=[]),a[e].push(s)}const o=Object.keys(a).sort();for(const s of o){const t=a[s],e={noScheduledTime:[]};for(const n of t){const t=n.schedule||{},i=t.scheduledTime&&Ot(t.scheduledTime)||"noScheduledTime";e[i]||(e[i]=[]),e[i].push(n)}const o=Object.keys(e).sort();for(const a of o){const t=e[a];t.sort(((t,e)=>(n[i(t)]||0)-(n[i(e)]||0))),r.push(...t)}}return r}function Xo({scheduleVisibilityFilters:t,tournamentRecords:e,matchUpFilters:n,contextFilters:i,nextMatchUps:r}){return"object"==typeof e&&Object.keys(e).length?{matchUps:Object.keys(e).map((a=>{const o=e[a],{matchUps:s}=wa({scheduleVisibilityFilters:t,tournamentRecord:o,matchUpFilters:n,contextFilters:i,nextMatchUps:r});return s})).flat()}:{error:"Missing tournamentRecords"}}function ts(t){if("object"!=typeof(null==t?void 0:t.tournamentRecords)||!Object.keys(null==t?void 0:t.tournamentRecords).length)return{error:"Missing tournamentRecords"};const{courts:e,venues:n}=Go(t),{sortCourtsData:i,sortDateMatchUps:r=!0}=t,a=Ko(t).schedulingProfile,{completedMatchUps:o,upcomingMatchUps:s,pendingMatchUps:c}=es(t),u=[...s||[],...c||[]],d=r?Qo({matchUps:u,schedulingProfile:a}):u;return{courtsData:e.map((t=>{const e=function({courtId:t}){const e=d.filter((e=>{var n;return(null===(n=e.schedule)||void 0===n?void 0:n.courtId)===t}));return i?Qo({matchUps:e,schedulingProfile:a}):e}(t);return{...t,matchUps:e,surfaceCategory:(null==t?void 0:t.surfaceCategory)||""}})),completedMatchUps:o,dateMatchUps:d,venues:n}}function es({scheduleVisibilityFilters:t,tournamentRecords:e,matchUpFilters:n,contextFilters:i}){return"object"==typeof e&&Object.keys(e).length?Object.keys(e).map((r=>{const a=e[r];return Pa({scheduleVisibilityFilters:t,tournamentRecord:a,matchUpFilters:n,contextFilters:i})})).reduce(((t,e)=>(Object.keys(e).forEach((n=>{t[n]||(t[n]=[]),t[n]=t[n].concat(e[n])})),t)),{}):{error:"Missing tournamentRecords"}}function ns(t,e){return function(t,e){return(zi[null==t?void 0:t.stage]||0)-(zi[null==e?void 0:e.stage]||0)}(t,e)||((null==t?void 0:t.stageSequence)||0)-((null==e?void 0:e.stageSequence)||0)||(null==t?void 0:t.roundNumber)-(null==e?void 0:e.roundNumber)||((null==t?void 0:t.roundPosition)||0)-((null==e?void 0:e.roundPosition)||0)}function is({includeParticipantDependencies:t,tournamentRecords:e={},drawDefinition:n,matchUps:i=[],drawIds:r=[]}){if(!Array.isArray(i))return{error:"Missing matchUps"};if(!Array.isArray(r))return{error:"Missing drawId"};const a={},o=t=>{a[t]||(a[t]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[]})},s=(e,n)=>{a[e].matchUpIds.forEach((t=>a[n].matchUpIds.push(t))),a[n].matchUpIds.push(e),a[e].dependentMatchUpIds.push(n),t&&a[e].participantIds.forEach((t=>a[n].participantIds.push(t)))},c=e=>{for(const n of e){const{matchUpId:e,winnerMatchUpId:i,loserMatchUpId:r}=n;if(o(e),t){const{individualParticipantIds:t}=ko(n);a[e].participantIds=t}i&&(o(i),s(e,i)),r&&(o(r),s(e,r))}};if(n)xo({drawDefinition:n}),i.length||({matchUps:i}=Na({drawDefinition:n})),c(i);else{i.length||({matchUps:i}=Xo({tournamentRecords:e,nextMatchUps:!0})),r.length||(r=e?Object.values(e).map((({events:t=[]})=>t.map((({drawDefinitions:t=[]})=>t.map((({drawId:t})=>t)))))).flat(1/0):[]);for(const t of r){let n=i.filter((e=>e.drawId===t)).sort(ns);if(!n.find((({winnerMatchUpId:t,loserMatchUpId:e})=>t||e))&&!n.find((({roundPosition:t})=>t))){const i=n.find((({tournamentId:t})=>t)),{drawDefinition:r}=Yn({tournamentRecord:e[null==i?void 0:i.tournamentId],drawId:t});r&&xo({drawDefinition:r})}c(n)}}return{matchUpDependencies:a,...B}}function rs({matchUpStatus:t}){return ve.includes(t)}function as({matchUpStatus:t}){return Ie.includes(t)}function os({matchUpStatus:t,winningSide:e,tieMatchUps:n,score:i}){var r,a,o;const s=null==i||null===(r=i.sets)||void 0===r?void 0:r[0],{side1Score:c,side2Score:u,side1TiebreakScore:d,side2TiebreakScore:l,side1PointScore:p,side2PointScore:m}=s||{},f=c||u||d||l||p||m,h=(null==i||null===(a=i.sets)||void 0===a?void 0:a.length)>1||f,v=null==n||null===(o=n.filter(os))||void 0===o?void 0:o.length;return h||e||v||function({matchUpStatus:t}){return Ue.includes(t)}({matchUpStatus:t})}function ss({drawDefinition:t,structureId:e,structure:n}){if(!n){const i=hr({drawDefinition:t,structureId:e});if(i.error)return i;n=i.structure}const{matchUps:i}=oa({inContext:!0,drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},structure:n}),r=T([].concat(...i.map((t=>t.drawPositions||[]))).filter(Boolean)).sort(Kt),{matchUpDependencies:a}=is({matchUps:i,drawIds:[t.drawId],drawDefinition:t}),o=T(i.filter(os).map((t=>{var e;return[].concat(...(null===(e=a[t.matchUpId])||void 0===e?void 0:e.matchUpIds)||[],t.matchUpId)})).flat()),s=T(i.map((({matchUpId:t,drawPositions:e})=>o.includes(t)?e:[])).flat().filter(Boolean)).sort(Kt),{positionAssignments:c}=Qr({drawDefinition:t,structure:n}),u=c.filter((t=>t.bye)).map((t=>t.drawPosition)),d=(null==r?void 0:r.filter((t=>!s.includes(t))))||[];return{allDrawPositions:r,inContextStructureMatchUps:i,activeDependentMatchUpIds:o,inactiveDrawPositions:d,positionAssignments:c,activeDrawPositions:s,byeDrawPositions:u,structure:n}}function cs({positionAssignments:t,tournamentRecord:e,drawDefinition:n,matchUpsMap:i,structure:r,event:a}){const{matchUps:o}=oa({drawDefinition:n,matchUpsMap:i,structure:r,event:a});o.forEach((i=>{const r=t.filter((({drawPosition:t})=>{var e;return null===(e=i.drawPositions)||void 0===e?void 0:e.includes(t)})).filter((t=>t.bye)).length;if(!i.winningSide){const t=r?ne:le;Object.assign(i,{matchUpStatus:t}),La({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:n,matchUp:i})}}))}function us({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,matchUpsMap:r,structureId:a,event:o}){const{structure:s}=hr({drawDefinition:n,structureId:a}),{positionAssignments:c}=Xr({drawDefinition:n,structure:s}),u=c.some((t=>{if(t.drawPosition===i)return delete t.participantId,delete t.qualifier,delete t.bye,!0}));if(s.structureType===Ki)return cs({positionAssignments:c,tournamentRecord:e,drawDefinition:n,matchUpsMap:r,structure:s}),{drawPositionCleared:u};const{matchUps:d}=oa({drawDefinition:n,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:s,event:o}),{roundProfile:l,roundMatchUps:p}=_i({matchUps:d}),m=Object.keys(l).map((t=>parseInt(t)));let f=i;const h=m.map((t=>{const e=l[t].pairedDrawPositions.find((t=>t.includes(f))),n=null==e?void 0:e.find((t=>t!==f)),i=c.find((t=>t.drawPosition===n)),r=l[t+1],a=null==i?void 0:i.bye,o=r&&r.pairedDrawPositions.find((t=>t.includes(n))),s=a&&o&&r&&r.drawPositions.includes(n),u=e&&{roundNumber:t,relevantPair:e,pairedDrawPosition:n,pairedDrawPositionByeAdvancedPair:!s&&o,targetDrawPosition:f};return s&&(f=n),u})).filter((t=>null==t?void 0:t.targetDrawPosition)).reduce(((t,e)=>{const{roundNumber:n,relevantPair:i,targetDrawPosition:r,pairedDrawPosition:a,pairedDrawPositionByeAdvancedPair:o}=e,s=[{roundNumber:n,targetDrawPosition:r,relevantPair:i},o&&{roundNumber:n+1,targetDrawPosition:a,relevantPair:o,subsequentRoundRemoval:!0}].filter(Boolean);return t.concat(...s)}),[]);return h.forEach((({roundNumber:o,targetDrawPosition:u,relevantPair:d})=>{const l=p[o].find((t=>x(t.drawPositions.filter(Boolean),d.filter(Boolean))));l&&(function({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:n,drawDefinition:i,matchUpsMap:r,roundNumber:a,structureId:o}){var s;const{structure:c}=hr({drawDefinition:i,structureId:o});if(c.structureType===Ki)return;const u=((null===(s=r=r||Bi({drawDefinition:i}))||void 0===s?void 0:s.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:d}=Lo({drawPosition:e,matchUps:u}),l=null==u?void 0:u.filter((t=>t.roundNumber>=a&&t.roundNumber!==d&&t.drawPositions.includes(e))),{positionAssignments:p}=Qr({drawDefinition:i,structureId:o});null==l||l.forEach((a=>ds({drawPosition:e,targetMatchUp:a,inContextDrawMatchUps:t,positionAssignments:p,tournamentRecord:n,drawDefinition:i,matchUpsMap:r,structure:c})))}({inContextDrawMatchUps:t,targetDrawPosition:u,tournamentRecord:e,drawDefinition:n,structureId:a,roundNumber:o,matchUpsMap:r}),ds({inContextDrawMatchUps:t,positionAssignments:c,drawDefinition:n,targetMatchUp:l,drawPosition:i,matchUpsMap:r,structure:s}))})),{tasks:h,drawPositionCleared:u}}function ds({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:n,drawDefinition:i,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s}){const c=(o=o||Bi({drawDefinition:i})).mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:u}=Lo({drawPosition:a,matchUps:c});if(r.roundNumber>u&&(r.drawPositions=(r.drawPositions||[]).map((t=>t===a?void 0:t))),r.matchUpType===Zt){var d,l,p;const e=null==t?void 0:t.find((t=>t.matchUpId===r.matchUpId)),o=null==e||null===(d=e.sides)||void 0===d?void 0:d.reduce(((t,e,n)=>e.drawPosition===a?n:t),void 0);var m;void 0!==o&&null!==(l=r.sides)&&void 0!==l&&null!==(p=l[o])&&void 0!==p&&p.lineUp&&(null===(m=r.sides)||void 0===m||delete m[o].lineUp,La({tournamentId:null==n?void 0:n.tournamentId,matchUp:r,drawDefinition:i}))}const f=ha({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:i,structure:s}),{targetLinks:{winnerTargetLink:h},targetMatchUps:{loserMatchUp:v,winnerMatchUp:I,loserMatchUpDrawPositionIndex:g,winnerMatchUpDrawPositionIndex:U}}=f,y=e.filter((({drawPosition:t})=>r.drawPositions.includes(t))).filter((t=>t.bye)).length;if(r.matchUpStatus=y?ne:r.matchUpStatus===pe?pe:le,r.matchUpStatus===pe&&(r.winningSide=void 0),La({tournamentId:null==n?void 0:n.tournamentId,matchUp:r,drawDefinition:i}),v&&v.structureId!==f.matchUp.structureId&&!y){const{drawPositions:e,roundNumber:r}=v;if(1===r){const r=e[g];us({structureId:v.structureId,drawPosition:r,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:i,matchUpsMap:o})}else{var S;const a=Math.min(...e.filter(Boolean)),s=((null===(S=o)||void 0===S?void 0:S.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:c}=Lo({drawPosition:a,matchUps:s});c===r&&us({structureId:v.structureId,drawPosition:a,inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:i,matchUpsMap:o})}}I&&I.structureId!==f.matchUp.structureId&&console.log("linked structure winnerMatchUp removal",{winnerTargetLink:h,winnerMatchUpDrawPositionIndex:U})}function ls({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,participantId:r,structureId:a,matchUpsMap:o}){const{structure:s}=hr({drawDefinition:n,structureId:a}),{positionAssignments:c}=Xr({drawDefinition:n,structure:s}),u=c.find((t=>r&&t.participantId===r||i&&t.drawPosition===i));if(r&&!i&&(i=null==u?void 0:u.drawPosition),!i)return{error:"Missing drawPosition"};r||(r=null==u?void 0:u.participantId);const{activeDrawPositions:d}=ss({drawDefinition:n,structureId:a});if(d.includes(i))return{error:"drawPosition is active"};t||({matchUps:t}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:o}));const{drawPositionCleared:l,error:p}=us({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,structureId:a,drawPosition:i,matchUpsMap:o});return p?{error:p}:l?(xa({drawDefinition:n,structureIds:[a]}),{...B,participantId:r}):{error:"drawPosition not cleared"}}function ps({element:t,notes:e}={}){return"object"!=typeof t?{error:$}:e?"string"==typeof e||null!=e&&e.testing?(Object.assign(t,{notes:e}),B):{error:$}:{error:z}}function ms({tournamentRecord:t,drawDefinition:e,policyTypes:n=[],event:i}){if(!Array.isArray(n))return{error:"Missing policyType"};const r={},a=t=>{for(const e of n){const n=t[e];n&&!r[e]&&(r[e]=n)}};if(e){const{appliedPolicies:t}=ki({drawDefinition:e})||{};a(t)}if(i){const{appliedPolicies:t}=An({event:i})||{};a(t)}if(t){const{appliedPolicies:e}=Mn({tournamentRecord:t})||{};a(e)}return Object.keys(r).length?{policyDefinitions:r}:{error:"Policy not found"}}const fs=t=>null==t?void 0:t.participantId;function hs({positionAssignments:t,tournamentRecord:e,drawDefinition:n,matchUpFormat:i,matchUps:r,event:a}){if(!Array.isArray(r))return{error:$};if(!t)return{error:$};const{policyDefinitions:o}=ms({tournamentRecord:e,drawDefinition:n,event:a,policyTypes:["roundRobinTally"]}),{subOrderMap:s}=function({positionAssignments:t}){const e=(t||[]).filter(fs).map((t=>{const{extension:e}=On({element:t,name:"subOrder"}),n=parseInt(null==e?void 0:e.value),i=!isNaN(n)&&n;return i&&{participantId:t.participantId,subOrder:i}})).filter(Boolean),n=A(e.map((({subOrder:t})=>t)));return{subOrderMap:Object.assign({},...e.filter((({subOrder:t})=>1===n[t])).map((({participantId:t,subOrder:e})=>({[t]:e}))))}}({positionAssignments:t}),c=xe({policyDefinitions:o,matchUpFormat:i,subOrderMap:s,matchUps:r});if(c.error)return c;const{participantResults:u}=c,d=Object.keys(u);return t.forEach((t=>{const{participantId:e}=t;d.includes(e)?(gr({element:t,extension:{name:"tally",value:u[e]}}),u[e].ties||Ur({element:t,name:"subOrder"})):(Ur({element:t,name:"tally"}),Ur({element:t,name:"subOrder"}))})),xa({drawDefinition:n}),{...B,participantResults:u}}function vs({event:t,eventId:e}){if(!t)return{error:W};const{extension:n}=Fn({event:t,name:"flightProfile"}),i=e?Ht(null==n?void 0:n.value,!1,!0):null==n?void 0:n.value;var r;return e&&(null===(r=t.drawDefinitions)||void 0===r||r.forEach((t=>{var e;null==i||null===(e=i.flights)||void 0===e||e.forEach((e=>{e.drawId===t.drawId&&Object.assign(e,{drawDefinition:t})}))}))),{flightProfile:i}}const Is={matchUpStatus:le,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function gs({matchUpStatusCodes:t,removeWinningSide:e,tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpStatus:a,removeScore:o,winningSide:s,matchUpId:c,matchUp:u,event:d,notes:l,score:p}){var m;let f;const h=u.matchUpType===Zt;if(h?c&&u.matchUpId!==c&&({matchUp:u,structure:f}=ca({drawDefinition:i,matchUpId:c,event:d})):u.matchUpId!==c&&console.log("!!!!!"),o?Object.assign(u,Is):p&&(u.score=p),a&&(u.matchUpStatus=a),r&&(u.matchUpFormat=r),t&&(u.matchUpStatusCodes=t),s&&(u.winningSide=s),e&&(u.winningSide=void 0),f||({structure:f}=ca({drawDefinition:i,matchUpId:c,event:d})),(null===(m=f)||void 0===m?void 0:m.structureType)===Ki&&!u.collectionId){var v;r=h?"SET1-S:T100":r||u.matchUpFormat||(null===(v=f)||void 0===v?void 0:v.matchUpFormat)||i.matchUpFormat||(null==d?void 0:d.matchUpFormat);const t=f.structures.find((t=>null==t?void 0:t.matchUps.find((t=>t.matchUpId===c)))),e=h&&{matchUpTypes:[Zt]},{matchUps:a}=oa({structure:t,inContext:!0,matchUpFilters:e,event:d}),o=hs({positionAssignments:t.positionAssignments,tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUps:a,event:d});if(o.error)return o}if(s!==u.winningSide){var I;const{flightProfile:t}=vs({event:d}),e=null==t||null===(I=t.flights)||void 0===I?void 0:I.find((t=>t.drawId===i.drawId));null!=e&&e.matchUpValue&&console.log("recalculate team point tallies")}if(l){const t=ps({element:u,notes:l});if(t.error)return t}return La({tournamentId:null==n?void 0:n.tournamentId,drawDefinition:i,matchUp:u}),B}function Us({tournamentRecord:t,drawDefinition:e,matchUpId:n,structure:i,event:r}){const a=ca({drawDefinition:e,event:r,matchUpId:n});if(a.error)return a;const o=a.matchUp,s=o.tieFormat||(null==i?void 0:i.tieFormat)||(null==e?void 0:e.tieFormat)||(null==r?void 0:r.tieFormat)||void 0;o.tieFormat=s;const{winningSide:c,set:u,scoreStringSide1:d,scoreStringSide2:l}=we({matchUp:o}),p=[1,2].includes(c),m=p?re:d?se:le,f=o.winningSide&&!p;return gs({tournamentRecord:t,score:{scoreStringSide1:d,scoreStringSide2:l,sets:[u]},removeWinningSide:f,drawDefinition:e,matchUpStatus:m,winningSide:c,matchUpId:n,matchUp:o,event:r}),{...B,removeWinningSide:f}}function ys(t){const{dualWinningSideChange:e,inContextDrawMatchUps:n,tournamentRecord:i,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:c,structure:u,event:d}=t,l=Boolean(t.matchUp.collectionId),p=ea({drawDefinition:r,structure:u}),{drawPositions:m,winningSide:f}=c.matchUp||{};if(!p&&!m)return{error:"Missing drawPositions"};const{targetLinks:{loserTargetLink:h,winnerTargetLink:v},targetMatchUps:{loserMatchUp:I,winnerMatchUp:g}}=c,U=gs({...t,matchUpStatus:a||le,removeWinningSide:!0});if(U.error)return U;if(l){const{matchUpTieId:n}=t,{removeWinningSide:a}=Us({matchUpId:n,tournamentRecord:i,drawDefinition:r,structure:u,event:d});if(!e&&!a)return{...B}}if(p)return{...B};const{matchUps:y}=oa({inContext:!0,drawDefinition:r,matchUpsMap:o,structure:u}),{positionAssignments:S}=Xr({structure:u}),w=f-1,N=1-w,D=m[w],P=m[N],{winnerParticipantId:T,loserParticipantId:M}=S.reduce(((t,e)=>(e.drawPosition===P&&(t.loserParticipantId=e.participantId),e.drawPosition===D&&(t.winnerParticipantId=e.participantId),t)),{winnerParticipantId:void 0,loserParticipantId:void 0}),A=y.filter((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.includes(P)}));if(g){const t=Ss({inContextDrawMatchUps:n,winningDrawPosition:D,winnerParticipantId:T,tournamentRecord:i,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:g,dualMatchUp:s,matchUpsMap:o});if(t.error)return t}if(I){const{winnerHadMatchUpStatus:t}=function({sourceMatchUps:t,loserDrawPosition:e,drawPositionMatchUps:n,matchUpStatuses:i=[ne,pe,ae]}){var r;const a=null==n?void 0:n.reduce(((t,e)=>!t||e.roundNumber>t.roundNumber?e:t),void 0),o=null==a||null===(r=a.drawPositions)||void 0===r?void 0:r.find((t=>t!==e)),s=t.filter((t=>{var e;return null==t||null===(e=t.drawPositions)||void 0===e?void 0:e.includes(o)})).map((t=>t.matchUpStatus)),c=t.filter((t=>{var n;return null==t||null===(n=t.drawPositions)||void 0===n?void 0:n.includes(e)})).map((t=>t.matchUpStatus));return{sourceMatchUp:a,winnerHadMatchUpStatus:x(s||[],i),winnerMatchUpStatuses:s,loserHadMatchUpStatus:x(c||[],i),loserMatchUpStatuses:c}}({drawPositionMatchUps:A,loserDrawPosition:P,sourceMatchUps:y}),e="FIRST_MATCHUP"===h.linkCondition;if(t&&e){const t=ws({targetLink:h,inContextDrawMatchUps:n,drawDefinition:r,drawPosition:Math.min(...I.drawPositions),matchUpsMap:o});if(t.error)return t}const a=function({loserParticipantId:t,tournamentRecord:e,loserTargetLink:n,drawDefinition:i,loserMatchUp:r,matchUpsMap:a,dualMatchUp:o}){var s;const c=n.target.structureId,{structure:u}=hr({drawDefinition:i,structureId:c}),{positionAssignments:d}=Xr({structure:u}),l=null===(s=d.find((e=>e.participantId===t)))||void 0===s?void 0:s.drawPosition;if(d.forEach((e=>{e.participantId===t&&delete e.participantId})),et({lineUp:!0})&&console.log("removedDirectedLoser",{dualMatchUp:o}),o){var p,m;const t=null==r?void 0:r.sides.reduce(((t,e,n)=>e.drawPosition===l?n:t),void 0),n=null==a||null===(p=a.drawMatchUps)||void 0===p?void 0:p.find((({matchUpId:t})=>t===r.matchUpId)),s=null==n||null===(m=n.sides)||void 0===m?void 0:m[t];et({lineUp:!0})&&console.log("removedDirectedLoser",{targetSide:s,dualMatchUp:o,loserMatchUp:r,targetMatchUp:n,relevantDrawPosition:l,drawPositionSideIndex:t}),s&&(delete s.lineUp,La({tournamentId:null==e?void 0:e.tournamentId,matchUp:n,drawDefinition:i}))}return{...B}}({inContextDrawMatchUps:n,loserParticipantId:M,tournamentRecord:i,loserTargetLink:h,drawDefinition:r,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o});if(a)return a}return{...B}}function Ss({inContextDrawMatchUps:t,winningDrawPosition:e,winnerParticipantId:n,tournamentRecord:i,winnerTargetLink:r,drawDefinition:a,winnerMatchUp:o,matchUpsMap:s,dualMatchUp:c,event:u}){const{structureId:d,roundNumber:l}=o;if(r){const t=r.target.structureId,{structure:e}=hr({drawDefinition:a,structureId:t}),{positionAssignments:i}=Xr({structure:e}),o=i.find((t=>t.participantId===n)),s=null==o?void 0:o.drawPosition,{matchUps:c}=oa({drawDefinition:a,structure:e,event:u});1===A(c.map((t=>t.drawPositions)).flat(1/0).filter(Boolean))[s]?i.forEach((t=>{t.participantId===n&&delete t.participantId})):console.log("not removing from position assignments since instances > 1")}const p=function({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:n,drawDefinition:i,structureId:r,dualMatchUp:a,roundNumber:o,matchUpsMap:s}){var c;const{structure:u}=hr({drawDefinition:i,structureId:r});if(u.structureType===Ki)return;const d=((null===(c=s=s||Bi({drawDefinition:i}))||void 0===c?void 0:c.mappedMatchUps)||{})[r].matchUps,{initialRoundNumber:l}=Lo({drawPosition:e,matchUps:d}),p=null==d?void 0:d.filter((t=>{var n;return t.roundNumber>=o&&t.roundNumber!==l&&(null===(n=t.drawPositions)||void 0===n?void 0:n.includes(e))})),{positionAssignments:m}=Qr({drawDefinition:i,structureId:r});for(const f of p){const r=Fo({inContextDrawMatchUps:t,positionAssignments:m,targetDrawPosition:e,tournamentRecord:n,drawDefinition:i,dualMatchUp:a,matchUpsMap:s,matchUp:f});if(r.error)return r}return{...B}}({targetDrawPosition:e,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:a,dualMatchUp:c,matchUpsMap:s,roundNumber:l,structureId:d});return p.error?p:{...B}}function ws({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,matchUpsMap:r,targetLink:a}){return ls({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,matchUpsMap:r,drawPosition:i,structureId:a.target.structureId}),{...B}}function Ns(t){var e;let{sourceMatchUp:n}=t;const{winnerMatchUp:i,structure:r,matchUpsMap:a,drawPosition:o}=t,s=i.roundNumber>1&&i.roundNumber-1,c=ji({structureId:r.structureId,matchUpsMap:a});!n&&o&&(n=c.find((({drawPositions:t,roundNumber:e})=>e===s&&(null==t?void 0:t.includes(o)))));const u=null===(e=n)||void 0===e?void 0:e.roundPosition,d=u+(u%2?1:-1),l=s&&c.find((({roundNumber:t,roundPosition:e})=>t===s&&e===d)),p=null==l?void 0:l.matchUpStatus;return{pairedPreviousMatchUp:l,pairedPreviousMatchUpisWOWO:[oe].includes(p)}}function Ds({tournamentRecord:t,drawDefinition:e,drawPosition:n,matchUpsMap:i,structureId:r,structure:a}){var o;if(!e)return{error:q};if(a||({structure:a}=hr({drawDefinition:e,structureId:r})),!a)return{error:"structure not found"};r||({structureId:r}=a),i||(i=Bi({drawDefinition:e}));const{positionAssignments:s}=Qr({structure:a}),{activeDrawPositions:c}=ss({drawDefinition:e,structureId:r});if(s.find((t=>t.drawPosition===n)).bye)return{...B};if(c.includes(n))return{error:"drawPosition is active"};const u=s.find((t=>t.drawPosition===n));if(!u)return{error:"Invlid drawPosition"};const{filled:d,containsBye:l}=function(t){const e=t.bye,n=t.qualifier,i=t.participantId;return{containsBye:e,containsQualifier:n,containsParticipant:i,filled:e||n||i}}(u);if(l)return{...B};if(d&&!l)return{error:"drawPosition already assigned"};const{matchUps:p}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:i}),{matchUps:m}=oa({drawDefinition:e,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:a});if(s.forEach((t=>{t.drawPosition===n&&(t.bye=!0)})),a.structureType===Ki)return function({tournamentRecord:t,drawDefinition:e,drawPosition:n,matchUps:i}){i.forEach((i=>{i.drawPositions.includes(n)&&Ps({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUp:i})}))}({tournamentRecord:t,drawDefinition:e,drawPosition:n,matchUps:m}),{...B};const{roundProfile:f,roundMatchUps:h}=_i({matchUps:m}),v=h[Object.keys(f).map((t=>parseInt(t))).reverse().find((t=>f[t].drawPositions.includes(n)))].find((({drawPositions:t})=>t.includes(n)));Ps({drawDefinition:e,matchUp:v});const I=null===(o=v.drawPositions)||void 0===o?void 0:o.find((t=>t!==n));if(I){const n=Ts({sourceDrawPositions:v.drawPositions,matchUpId:v.matchUpId,inContextDrawMatchUps:p,drawPositionToAdvance:I,tournamentRecord:t,drawDefinition:e,matchUpsMap:i});if(n.error)return n}return xa({drawDefinition:e,structureIds:[r]}),{...B}}function Ps({tournamentRecord:t,drawDefinition:e,matchUp:n}){Object.assign(n,{matchUpStatus:ne,score:void 0,winningSide:void 0}),La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUp:n})}function Ts({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:n,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,matchUpId:o}){const s=a.drawMatchUps.find((t=>t.matchUpId===o)),c=e.find((t=>t.matchUpId===o)),u=null==c?void 0:c.structureId,{structure:d}=hr({drawDefinition:r,structureId:u}),{positionAssignments:l}=Qr({structure:d}),p=l.filter((t=>t.bye)).map((t=>t.drawPosition)),m=s.drawPositions.find((e=>e!==t)),f=p.includes(m),{targetLinks:{loserTargetLink:h},targetMatchUps:{loserMatchUp:v,winnerMatchUp:I,loserTargetDrawPosition:g}}=ha({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:o,structure:d});if(I&&I.structureId===d.structureId&&function({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:n,tournamentRecord:i,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o}){var s,c,u;const d=o.drawMatchUps.find((t=>t.matchUpId===a.matchUpId)),l=e.find((t=>t.matchUpId===a.matchUpId)),p=null==l?void 0:l.structureId,{structure:m}=hr({drawDefinition:r,structureId:p}),{positionAssignments:f}=Qr({structure:m}),h=f.find((({drawPosition:e})=>e===t)).bye,v=null===(s=d.drawPositions)||void 0===s?void 0:s.filter(Boolean),I=f.filter((t=>null==v?void 0:v.includes(t.drawPosition))),g=f.find((({drawPosition:e})=>e===t)),U=null==n?void 0:n.find((e=>e!==t)),y=U&&I.find((({drawPosition:t})=>t===U)),S=null==y?void 0:y.bye,w=h&&S;if(w&&console.log({isByeAdvancedBye:w}),(null==v?void 0:v.length)>1&&h&&!S)return{error:H};const N=null==v?void 0:v.find((e=>e!==t));let D=w;const P=[].concat(...(d.drawPositions||[]).filter(Boolean),void 0,void 0).slice(0,2).map((e=>e||D?e===t?(D=!0,t):e:(D=!0,t)));if(!D)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:I}),{error:H};const T=null===(c=f.find((({drawPosition:t})=>t===N)))||void 0===c?void 0:c.bye,M=null===(u=f.find((({drawPosition:e})=>e===t)))||void 0===u?void 0:u.bye,A=M||T?ne:le;if(Object.assign(d,{matchUpStatus:A,score:void 0,winningSide:void 0,drawPositions:P}),La({tournamentId:null==i?void 0:i.tournamentId,matchUp:d,drawDefinition:r}),T||M){const n=T?t:N;if(n)Ts({drawPositionToAdvance:n,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:o});else if(M){const{targetLinks:{loserTargetLink:t},targetMatchUps:{loserMatchUp:n,loserTargetDrawPosition:s}}=ha({matchUpId:a.matchUpId,structure:m,drawDefinition:r,inContextDrawMatchUps:e});if(t&&n)if(n.feedRound)Ms({loserTargetDrawPosition:s,tournamentRecord:i,loserTargetLink:t,drawDefinition:r,loserMatchUp:n,matchUpsMap:o});else{const e=1-a.roundPosition%2,o=n.drawPositions[e];Ds({structureId:t.target.structureId,drawPosition:o,loserTargetDrawPosition:s,iterative:"brightgreen",tournamentRecord:i,drawDefinition:r}).error}}}}({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:n,tournamentRecord:i,drawDefinition:r,winnerMatchUp:I,matchUpsMap:a}),v&&f&&v.structureId!==d.structureId){const{roundNumber:t}=v;if(1===t){const t=Ds({structureId:h.target.structureId,drawPosition:g,iterative:"brightyellow",tournamentRecord:i,drawDefinition:r});if(t.error)return t}else Ms({loserTargetDrawPosition:g,tournamentRecord:i,loserTargetLink:h,drawDefinition:r,loserMatchUp:v,matchUpsMap:a})}return{...B}}function Ms({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:n,drawDefinition:i,loserMatchUp:r,matchUpsMap:a}){const{roundNumber:o}=r,s=((null==a?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=Lo({drawPosition:t,matchUps:s});if(c===o){const r=Ds({structureId:n.target.structureId,drawPosition:t,tournamentRecord:e,iterative:"red",drawDefinition:i});if(r.error)return r}}function As({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:n,tournamentRecord:i,drawDefinition:r,matchUp:a}){var o,s,c;const u=null==t||null===(o=t.sides)||void 0===o||null===(s=o[e])||void 0===s?void 0:s.sideNumber,d=u&&(null===(c=a.sides)||void 0===c?void 0:c.find((t=>t.sideNumber===u))),{extension:l}=On({element:r,name:"lineUps"}),p=((null==l?void 0:l.value)||{})[n];if(et({lineUp:!0})&&console.log("updateSideLineUp",{sideExists:d,drawPositionSideIndex:e,drawPositionSideNumber:u}),d)a.sides.forEach((t=>{t.sideNumber===u&&(t.lineUp=p)}));else{a.sides=[1,2].map((t=>{var e;return{...(null===(e=a.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));const t=a.sides.find((t=>t.sideNumber===u));t&&(t.lineUp=p,et({lineUp:!0})&&console.log("updateSideLineUp",{teamParticipantId:n,targetSide:t,matchUp:a}))}La({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:r,matchUp:a})}function Es({inContextDrawMatchUps:t,drawPosition:e,matchUpId:n}){const i=t.filter((({winnerMatchUpId:t,loserMatchUpId:e})=>e===n||t===n)).sort(((t,e)=>t.roundPosition-e.roundPosition));return t.find((t=>t.matchUpId===n)).feedRound?1:i.reduce(((t,n,i)=>{var r;return null!==(r=n.drawPositions)&&void 0!==r&&r.includes(e)?i+1:t}),void 0)}function bs({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,matchUpStatus:i,drawPosition:r,matchUpsMap:a,matchUpId:o}){var s,c,u;a||(a=Bi({drawDefinition:n})),t||({matchUps:t}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:a}));const d=t.find((t=>t.matchUpId===o)),l=null==d?void 0:d.structureId,p=null==n||null===(s=n.structures)||void 0===s?void 0:s.find((t=>t.structureId===l)),m=null===(c=a)||void 0===c||null===(u=c.drawMatchUps)||void 0===u?void 0:u.find((t=>t.matchUpId===o)),f=m.drawPositions||[],{positionAdded:h,positionAssigned:v,updatedDrawPositions:I}=function({drawPosition:t,drawPositions:e}){let n,i=null==e?void 0:e.includes(t);return{updatedDrawPositions:i?e||[]:[].concat(...e,void 0,void 0).slice(0,2).map((e=>e||i?e:(i=!0,n=!0,t))).sort(Kt).filter(Boolean),positionAdded:n,positionAssigned:i}}({drawPosition:r,drawPositions:f}),{positionAssignments:g}=Qr({drawDefinition:n,structure:p}),U=g.filter((t=>I.includes(t.drawPosition))).find((({bye:t})=>t)),y=m.matchUpStatus===pe&&I.filter(Boolean).length<2;if(i=U?ne:i||(y?pe:m.matchUpStatus===oe?oe:le),h){({matchUps:t}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:a}));const s=y&&Es({inContextDrawMatchUps:t,drawPosition:r,matchUpId:o})||void 0;Object.assign(m,{drawPositions:I,winningSide:s,matchUpStatus:i}),La({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:n,matchUp:m})}const S=ha({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:o}),{targetMatchUps:{winnerMatchUp:w,loserMatchUp:N,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:P}}=S,T=ji({structureId:p.structureId,matchUpsMap:a});if(v&&U){if(w)if([ne,oe].includes(i)){const i=bs({matchUpId:w.matchUpId,iterative:"brightmagenta",inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,drawPosition:r,matchUpsMap:a});if(i.error)return i}else{const{structureId:t}=w;t!==p.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(w&&!d.feedRound){const{pairedPreviousMatchUpisWOWO:i}=Ns({winnerMatchUp:m,drawPosition:r,matchUpsMap:a,structure:p});if(i){const i=bs({matchUpId:w.matchUpId,iterative:"brightred",inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,drawPosition:r,matchUpsMap:a});if(i.error)return i}}if(m.matchUpType===Zt){var M,A,E;const i=null===(M=t)||void 0===M?void 0:M.find((({matchUpId:t})=>t===m.matchUpId)),a=null==i||null===(A=i.sides)||void 0===A?void 0:A.reduce(((t,e,n)=>e.drawPosition===r?n:t),void 0),o=null===(E=g.find((t=>t.drawPosition===r)))||void 0===E?void 0:E.participantId;et({lineUp:!0})&&console.log("assignMatchUpDrawPosition",{inContextTargetMatchUp:i,drawPositionSideIndex:a,teamParticipantId:o}),o&&void 0!==a&&As({inContextTargetMatchUp:i,drawPositionSideIndex:a,teamParticipantId:o,tournamentRecord:e,drawDefinition:n,matchUp:m})}if("FIRST_MATCHUP"===(null==P?void 0:P.linkCondition)&&2===I.filter(Boolean).length&&!U){if(T.filter((({drawPositions:t,roundNumber:e})=>1===e&&x(t,I))).every((({matchUpStatus:t})=>[re,ue].includes(t)))&&N){const{structureId:t}=N,i=Ds({drawPosition:D,tournamentRecord:e,drawDefinition:n,structureId:t,matchUpsMap:a});if(i.error)return i}}return v?B:{error:H,drawPosition:r}}function Rs(t){const{tournamentRecord:e,drawDefinition:n,matchUpsMap:i,targetData:r,structure:a}=t;if(a.structureType===Ki)return B;const{matchUp:o,targetMatchUps:s,targetLinks:c}=r,{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:l}=s;if(u){const{loserTargetLink:t}=c,r=Cs({loserTargetDrawPosition:l,tournamentRecord:e,loserTargetLink:t,drawDefinition:n,loserMatchUp:u,matchUpsMap:i});if(r.error)return r}if(d){const n=function(t){var e,n,i;const{inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,winnerMatchUp:c,matchUpsMap:u,structure:d}=t,l=u.drawMatchUps.find((t=>t.matchUpId===c.matchUpId));if(!l)return{error:"Missing matchUp"};const p=(null==s?void 0:s.drawPositions)||[];let m=null===(e=l.drawPositions)||void 0===e?void 0:e.filter(Boolean);if(x(p,m)&&(m=m.filter((t=>!p.includes(t)))),m.length>1)return{error:H};const{pairedPreviousMatchUpisWOWO:f}=Ns(t),h=ha({matchUpId:c.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,structure:d}),{targetMatchUps:v,targetLinks:I}=h,{loserTargetDrawPosition:g,winnerMatchUp:U,loserMatchUp:y}=v;if(y){const{loserTargetLink:t}=I,e=Cs({loserTargetDrawPosition:g,loserMatchUp:y,tournamentRecord:a,loserTargetLink:t,drawDefinition:o,matchUpsMap:u});if(e.error)return e}const S=(null===(n=l.drawPositions)||void 0===n?void 0:n.filter(Boolean))||[],w=1===S.length&&Es({drawPosition:S[0],matchUpId:c.matchUpId,inContextDrawMatchUps:r})||void 0,N=l.matchUpStatus===pe&&!S.length,D=1===l.finishingRound,P=N&&!D?oe:pe,T=gs({...t,matchUp:l,winningSide:w,matchUpStatus:P});if(T.error)return T;if(N)return Rs({...t,targetData:h});if(!U)return{...B};const M=m[0],{positionAssignments:A}=Qr({structure:d}),E=A.find((t=>t.drawPosition===M)),b=u.drawMatchUps.find((t=>t.matchUpId===U.matchUpId)),R=null==b||null===(i=b.drawPositions)||void 0===i?void 0:i.filter(Boolean),C=1===R.length;if(M){if(E.bye){const e=ha({matchUpId:b.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,structure:d});if(C){const t=R.filter(Boolean)[0],e=Es({drawPosition:t,matchUpId:b.matchUpId,inContextDrawMatchUps:r}),n=gs({matchUpId:b.matchUpId,matchUp:b,matchUpStatus:pe,removeScore:!0,drawDefinition:o,winningSide:e});return n.error?n:Ts({drawPositionToAdvance:t,matchUpId:b.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,matchUpsMap:u})}if(U.matchUpStatus===pe){const n=Rs({...t,targetData:e,matchUpId:b.matchUpId});if(n.error)return n}return{...B}}return bs({matchUpId:U.matchUpId,drawPosition:M,inContextDrawMatchUps:r,drawDefinition:o})}if(f){if(!b)return{error:"Missing matchUp"};if(C){const t=R[0],e=Es({matchUpId:c.matchUpId,inContextDrawMatchUps:r,drawPosition:t});console.log("existing drawPosition is winningSide",{walkoverWinningSide:e})}const e=b.matchUpStatus===pe?pe:oe,n=gs({matchUpId:b.matchUpId,matchUp:b,removeScore:!0,drawDefinition:o,matchUpStatus:e});if(n.error)return n;if(e===oe){const e=Rs({...t,targetData:h,matchUpId:c.matchUpId});if(e.error)return e}}return B}({...t,matchUpId:d.matchUpId,tournamentRecord:e,sourceMatchUp:o,winnerMatchUp:d});if(n.error)return n}return B}function Cs(t){var e;const{loserTargetDrawPosition:n,tournamentRecord:i,loserTargetLink:r,drawDefinition:a,matchUpsMap:o}=t,s=null==r||null===(e=r.target)||void 0===e?void 0:e.structureId,{structure:c}=hr({drawDefinition:a,structureId:s});return c?Ds({drawPosition:n,tournamentRecord:i,drawDefinition:a,structureId:s,matchUpsMap:o}):{error:"Missing structure"}}function Os(t){var e;const n=t.isCollectionMatchUp&&(null===(e=t.dualMatchUp)||void 0===e?void 0:e.winningSide)&&t.projectedWinningSide,i=Boolean(t.matchUp.collectionId),r=gs(t);if(i){const{matchUpTieId:e,drawDefinition:i}=t,{removeWinningSide:r}=Us({tournamentRecord:t.tournamentRecord,matchUpId:e,drawDefinition:i});console.log("atsms",{removeWinningSide:r,removeDirected:n})}return r}function Ls({tournamentRecord:t,drawDefinition:e,event:n}){const i=(null==t?void 0:t.events)||n&&[n],r=(null==i?void 0:i.map((t=>null==t?void 0:t.drawDefinitions)).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=r.map((({structures:t})=>null==t?void 0:t.filter((t=>null==t?void 0:t.structures)))).flat().filter(Boolean);for(const c of s){const{structures:t,structureId:e}=c||{};t&&(a[e]=null==t?void 0:t.map((t=>t.structureId)))&&t.forEach((t=>o[t.structureId]=c.structureId))}return{containedStructures:a,containerStructures:o}}function Fs({drawDefinition:t,structureId:e}){if(!t)return{error:q};const{structure:n}=hr({drawDefinition:t,structureId:e}),i=((null==t?void 0:t.links)||[]).filter((t=>{var n;return(null===(n=t.source)||void 0===n?void 0:n.structureId)===e})).map((t=>{var e;return null===(e=t.target)||void 0===e?void 0:e.structureId}));return{playoffStructures:((null==t?void 0:t.structures)||[]).filter((t=>i.includes(t.structureId)&&t.stage===Hi)),structure:n}}function xs(t){var e,n;if(null==t||!t.drawDefinition)return{error:q};const i=Ua(t);let{includesTeamMatchUps:r,completedMatchUps:a,pendingMatchUps:o,upcomingMatchUps:s}=i||{};return r&&(a=a.filter((({matchUpType:t})=>t===Zt)),o=o.filter((({matchUpType:t})=>t===Zt)),s=s.filter((({matchUpType:t})=>t===Zt))),!(!(null===(e=a)||void 0===e?void 0:e.length)||null!==(n=o)&&void 0!==n&&n.length||s.length)}function ks(t){var e,n;const{drawDefinition:i,structureId:r}=t;if(!i)return{error:q};const{playoffStructures:a}=Fs({drawDefinition:i,structureId:r});if(null==a||!a.length)return!1;const o=(null==i||null===(e=i.entries)||void 0===e||null===(n=e.filter((t=>Vr.includes(null==t?void 0:t.entryStatus))))||void 0===n?void 0:n.length)||0;let s=0;return(a||[]).reduce(((t,e)=>{var n;return!(null!=e&&null!==(n=e.positionAssignments)&&void 0!==n&&n.filter((t=>(t.participantId&&s++,!(null!=t&&t.bye||null!=t&&t.participantId)))).length)&&t}),!0)||s===o}function _s({drawDefinition:t,structure:e,matchUp:n}){const i=[];if("WIN_RATIO"===e.finishingPosition&&xs({drawDefinition:t,structure:e})){const{structureIds:r}=function({drawDefinition:t,structure:e,matchUp:n}){const{drawPositions:i}=n,{positionAssignments:r}=Qr({drawDefinition:t,structure:e}),a=r.filter((({drawPosition:t})=>i.includes(t))).map((t=>{var e;const{extension:n}=On({element:t,name:"tally"});return null==n||null===(e=n.value)||void 0===e?void 0:e.groupOrder})),{containerStructures:o}=Ls({drawDefinition:t}),s=o[e.structureId],{links:{source:c}}=fa({drawDefinition:t,structureId:s});return{structureIds:null==c?void 0:c.filter((t=>{var e;return x(a,(null===(e=t.source)||void 0===e?void 0:e.finishingPositions)||[])})).map((t=>t.source.structureId))}}({drawDefinition:t,structure:e,matchUp:n});null!=r&&r.length&&i.push(...r)}return{connectedStructureIds:i}}function Bs({drawPositions:t,structure:e}){if([Gi,Vi].includes(e.stage)&&1===e.stageSequence)return;const{positionAssignments:n}=Qr({structure:e});n.filter((({drawPosition:e})=>t.includes(e))).forEach((t=>{gr({element:t,extension:{name:"disableLinks",value:!0}})}))}function js({drawDefinition:t,positionAction:e}){const{extension:n}=On({element:t,name:"positionActions"});gr({element:t,extension:{name:"positionActions",value:Array.isArray(null==n?void 0:n.value)?n.value.concat(e):[e]}})}function Vs({participantsCount:t,cluster:e}){const n=y(t),i=O(1,n+1);let r=[],a=n/2;for(;a>1;){const t=k(i,a),n=t.length;t.forEach(((t,i)=>{let a;const o=i<n/2,s=i%2==0,c=t[0],u=t[t.length-1];a=e&&n>4?8===n?o?u:c:s?c:u:o?c:u,x(t,r)||r.push(a)})),a/=2}const o=i.filter((t=>!r.includes(t)));for(;o.length;)o.length%2==0?r.push(o.pop()):r.push(o.shift());const s=O(0,20).map((t=>Math.pow(2,t)));s.unshift(1);const c=s.indexOf(n);let u=0;const d=[];return O(0,c).forEach((t=>{d.push(r.slice(u,u+s[t])),u+=s[t]})),{seedBlocks:d}}function Gs({appliedPolicies:t,drawDefinition:e,allPositions:n,structure:i}){var r;let a,o,s,c,u,d=0,l=[];if(!i)return{error:"Missing structure"};const{roundMatchUps:p}=oa({roundFilter:1,structure:i}),{seedAssignments:m}=$r({drawDefinition:e,structure:i}),{positionAssignments:f}=Xr({structure:i}),h=f.length,v=(null==m?void 0:m.length)||0;let g=[];const U=Object.keys(p).sort(((t,e)=>t-e)).map((t=>{const e=p[t].map((t=>t.drawPositions)).flat(1/0).filter(Boolean),n=e.filter((t=>!g.includes(t)));return g=g.concat(...e),n})).filter((t=>t.length)).reverse(),y=U.pop(),S=y&&Math.min(...y)-1||0,w=null==t||null===(r=t.seeding)||void 0===r?void 0:r.seedingProfile,N=(null==y?void 0:y.length)||0,D=U.filter((t=>t.filter((t=>t<=v)).length)),P=n?h:v;if(i.structureType===Ki){if(o=!0,({validSeedBlocks:l,error:u}=function({seedingProfile:t,structure:e,seedBlocks:n}){const i=e.structures||[],r=[];for(const l of i){const{positionAssignments:e}=Xr({structure:l}),i=Math.min(...e.map((t=>t.drawPosition)))-1,a=e.length;let o,s;if(I(a)?({blocks:o,error:s}=qs({seedBlocks:n,baseDrawSize:a,seedingProfile:t,drawPositionOffset:i,seedCountGoal:a})):({blocks:o,error:s}=Hs({baseDrawSize:a,drawPositionOffset:i,seedCountGoal:a})),s)return{error:s};r.push(o)}const a=r.map((t=>t.map((t=>t.seedNumbers.map(((e,n)=>({seedNumber:e,drawPosition:t.drawPositions[n]}))))))).flat(1/0).sort(((t,e)=>t.seedNumber-e.seedNumber)).reduce(((t,e)=>{const n=e.seedNumber;return t[n]||(t[n]=[]),t[n].push(e.drawPosition),t}),{});let o=1,s=[];a[1]&&a[1].forEach(((t,e)=>{s.push({seedNumbers:[e+1],drawPositions:[t]}),o++})),[[2],[3,4],[5,6,7,8],O(9,17)].forEach((t=>{const e=[].concat(...t.map((t=>a[t]||[]))),n=e.map(((t,e)=>o+e)),i={seedNumbers:n,drawPositions:e};s.push(i),o+=n.length}));const c=(t,e)=>t-e,u=(t,e)=>e-t,d=Object.keys(a).map(((t,e)=>a[t].sort(e%2?u:c))).flat().map(((t,e)=>({seedNumbers:[e+1],drawPositions:[t]})));return"WATERFALL"===e.seedingProfile&&(s=d),{validSeedBlocks:s}}({seedingProfile:w,structure:i})),u)return{error:u}}else if(U.length){s=!0,l=D.map((t=>({seedNumbers:t,drawPositions:t})));const t=D.flat(1/0);a=t.length<P?P-t.length:0,d=t.length}else y&&!I(N)?(a=0,c=!0):a=P;if(!o&&!c){const{blocks:t,error:e}=qs({drawPositionOffset:S,seedNumberOffset:d,seedCountGoal:a,seedingProfile:w,baseDrawSize:N});if(e)return{validSeedBlocks:[],isContainer:o,isFeedIn:s,error:e};t.forEach((t=>l.push(t)))}c&&k(y,2).map(((t,e)=>({drawPositions:[t[0]],seedNumbers:[e+1]}))).forEach((t=>l.push(t)));const T=[].concat(...l.map((t=>t.drawPositions))).reduce(((t,e)=>(null==y?void 0:y.includes(e))&&t),!0);return c||s||o||T?{validSeedBlocks:l,isContainer:o,isFeedIn:s,isLucky:c}:{error:"Invalid seedPosition",validSeedBlocks:[],isContainer:o,isFeedIn:s}}function qs({drawPositionOffset:t=0,seedNumberOffset:e=0,seedingProfile:n,seedCountGoal:i,baseDrawSize:r}){let a=1;const o=[],{seedBlocks:s}=Vs({participantsCount:r,cluster:"CLUSTER"===n});a=0;for(const u of s){if(a+1>i)break;const n=u.map((e=>e+t)),r=c(a+1,u.length).map((t=>+t+e));a+=u.length,o.push({drawPositions:n,seedNumbers:r})}return{blocks:o};function c(t,e){return Array.from(new Array(e),((e,n)=>n+t))}}function Hs({baseDrawSize:t,seedCountGoal:e,drawPositionOffset:n=0}){let i=1;const r=[],a=O(n+1,n+t+1);return[[1],[2],[3,4],[5,6,7,8],O(9,17),O(17,33),O(33,65)].forEach((t=>{const n=t.map((()=>a.reverse().pop())).filter(Boolean),o={seedNumbers:t=t.slice(0,n.length),drawPositions:n};i<=e&&r.push(o),i+=n.length})),{blocks:r}}function Ws({seedNumber:t,drawDefinition:e,structureId:n,drawPosition:i}){var r,a,o,s;const{structure:c}=hr({drawDefinition:e,structureId:n}),{appliedPolicies:u}=ki({drawDefinition:e}),{validSeedBlocks:d}=Gs({structure:c,drawDefinition:e,appliedPolicies:u});if(null!=u&&null!==(r=u.seeding)&&void 0!==r&&null!==(a=r.validSeedPositions)&&void 0!==a&&a.ignore)return!0;if(null!=u&&null!==(o=u.seeding)&&void 0!==o&&null!==(s=o.validSeedPositions)&&void 0!==s&&s.strict){const e=d.find((e=>e.seedNumbers.includes(t)));return((null==e?void 0:e.drawPositions)||[]).includes(i)}return[].concat(...d.map((t=>t.drawPositions))).includes(i)}function zs({drawDefinition:t,structureId:e,randomize:n}){var i;const{structure:r}=hr({drawDefinition:t,structureId:e}),{seedAssignments:a}=$r({drawDefinition:t,structure:r}),{positionAssignments:o}=Xr({structure:r}),s=o.filter((t=>t.participantId||t.bye||t.qualifier)).map((t=>t.drawPosition)).filter(Boolean),{appliedPolicies:c}=ki({drawDefinition:t}),{validSeedBlocks:u}=Gs({structure:r,drawDefinition:t,appliedPolicies:c}),d=(u||[]).filter((t=>t.drawPositions.filter((t=>!s.includes(t))).length))[0],l=a.map((t=>t.participantId)).filter(Boolean),p=o.map((t=>t.participantId)).filter(Boolean),m=l.filter((t=>p.includes(t))),f=l.filter((t=>!p.includes(t))),h=a.filter((t=>f.includes(t.participantId))),v=a.filter((t=>!t.participantId)),I=(h.length||v.length)&&(null==d?void 0:d.drawPositions.filter((t=>!s.includes(t))))||[],g=n?M(I):I,U=[],y=g.map((()=>{const t=function(t,e){const n=t.filter((t=>!e.includes(t.participantId))),i=Math.min(...n.map((t=>t.seedValue)));return M(n.filter((t=>t.seedValue===i))).pop()}(h,U),e=t&&t.participantId;return e&&U.push(e),e})).filter(Boolean),S=a.filter((t=>m.includes(t.participantId))).map((t=>t.seedNumber)),w=(d&&d.seedNumbers||[]).filter((t=>!S.includes(t))),N=a.filter((t=>w.includes(t.seedNumber))).map((t=>t.participantId)),D=null==c||null===(i=c.seeding)||void 0===i?void 0:i.duplicateSeedNumbers;return{nextSeedBlock:d,unplacedSeedParticipantIds:void 0===D||D?y:N,unplacedSeedNumbers:w,unfilledPositions:g,unplacedSeedAssignments:h}}function Ks({inContextDrawMatchUps:t,drawDefinition:e,assignments:n,matchUpsMap:i,structure:r}){var a,o,s;const c=null===(a=Ls({drawDefinition:e}))||void 0===a?void 0:a.containedStructures,u=(null==c||null===(o=c[r.structureId])||void 0===o?void 0:o.map((({structureId:t})=>t)))||[];u.push(null==r?void 0:r.structureId);const d=(null==n?void 0:n.map((({drawPosition:t})=>t)))||[],l=(null==t?void 0:t.filter((t=>u.includes(t.strucuteId)&&F(t.drawPositions||[],d).length)))||[],p=l.map((({matchUpId:t})=>t)),m=(null==i||null===(s=i.drawMatchUps)||void 0===s?void 0:s.filter((t=>p.includes(t.matchUpId))))||[];return{drawPositions:d,matchUps:m,targetMatchUps:l}}function Ys({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,matchUpsMap:i,assignments:r,structure:a}){const{drawPositions:o,matchUps:s,targetMatchUps:c}=Ks({inContextDrawMatchUps:t,matchUpsMap:i,assignments:r,structure:a});for(const u of c)(u.sides||[]).forEach(((t,i)=>{if(null!=t&&t.drawPosition&&o.includes(t.drawPosition)){var r;const t=s.find((({matchUpId:t})=>t===u.matchUpId));null!==(r=t.sides)&&void 0!==r&&r[i]&&(delete t.sides[i].lineUp,La({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:n,matchUp:t}))}}));return{...B}}function $s({inContextDrawMatchUps:t,automaticPlacement:e,tournamentRecord:n,drawDefinition:i,participantId:r,drawPosition:a,matchUpsMap:o,structureId:s,event:c}){o=o||Bi({drawDefinition:i}),t||({matchUps:t}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}));const{structure:u,error:d}=hr({drawDefinition:i,structureId:s});if(d)return{error:d};if(ea({drawDefinition:i,structure:u}))return{error:"Invalid matchUp"};const{positionAssignments:l}=Xr({structure:u}),{seedAssignments:p}=$r({drawDefinition:i,structure:u}),m=p.find((t=>t.participantId===r)),f=null==m?void 0:m.seedNumber;if(f&&!Ws({seedNumber:f,drawDefinition:i,structureId:s,drawPosition:a}))return{error:"Invalid drawPosition for seedAssignment"};const h=l.find((t=>t.drawPosition===a));if(!h)return{error:"Invlid drawPosition"};if(!r)return{error:"Missing participantId"};if(l.map(Oi).includes(r))return{error:"Existing participant drawPosition assignment"};const{containsParticipant:v,containsBye:I}=function(t){const e=t.bye,n=t.qualifier,i=t.participantId;return{containsBye:e,containsQualifier:n,containsParticipant:i,filled:e||n||i}}(h);if(I){let e=ls({inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:i,drawPosition:a,structureId:s,matchUpsMap:o});if(e.error)return e}if(v&&h.participantId!==r){const{activeDrawPositions:e}=ss({drawDefinition:i,structureId:s});if(e.includes(a))return{error:"drawPosition is active"};Ys({assignments:[h],inContextDrawMatchUps:t,tournamentRecord:n,drawDefinition:i,matchUpsMap:o,structure:u})}if(h.participantId=r,u.structureType!==Ki)!function({inContextDrawMatchUps:t,automaticPlacement:e,tournamentRecord:n,drawDefinition:i,drawPosition:r,matchUpsMap:a,structure:o,event:s}){et({lineUp:!0})&&console.log("assignDrawPositionToMatchUps",{drawPosition:r});const{matchUps:c}=oa({inContextDrawMatchUps:t,drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:a,structure:o,event:s}),{roundMatchUps:u}=_i({matchUps:c}),{initialRoundNumber:d}=Lo({drawPosition:r,matchUps:c}),l=u[d].find((t=>t.drawPositions.includes(r)));if(et({lineUp:!0})&&console.log("assignDrawPositionToMatchUps",{matchUp:l}),l){bs({matchUpId:l.matchUpId,inContextDrawMatchUps:t,automaticPlacement:e,tournamentRecord:n,drawDefinition:i,drawPosition:r,matchUpsMap:a}).error}}({inContextDrawMatchUps:t,positionAssignments:l,automaticPlacement:e,tournamentRecord:n,drawDefinition:i,matchUpsMap:o,drawPosition:a,structure:u,event:c});else{cs({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:n,drawDefinition:i,matchUpsMap:o,structure:u});const{drawPositions:e,matchUps:a,targetMatchUps:s}=Ks({assignments:[h],inContextDrawMatchUps:t,drawDefinition:i,matchUpsMap:o,structure:u});if(1===(null==a?void 0:a.length)&&a[0].matchUpType===Zt){var g;const t=null==s||null===(g=s[0])||void 0===g?void 0:g.sides.reduce(((t,n,i)=>e.includes(n.drawPosition)?i:t),void 0);As({inContextTargetMatchUp:s[0],teamParticipantId:r,matchUp:a[0],drawPositionSideIndex:t,tournamentRecord:n,drawDefinition:i})}}return e||(Bs({drawPositions:[a],structure:u}),js({drawDefinition:i,positionAction:{name:"positionAssignment",drawPosition:a,structureId:s,participantId:r}})),xa({drawDefinition:i,structureIds:[s]}),Object.assign({positionAssignments:l},B)}function Js(t){const{dualWinningSideChange:e,projectedWinningSide:n,inContextDrawMatchUps:i,matchUpStatusCodes:r,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:l,targetData:p,matchUpId:m,structure:f,matchUp:h,event:v,score:I}=t,g=Boolean(h.collectionId),U=ea({drawDefinition:o,structure:f});if(!(g||U||function({structure:t,matchUp:e}){const{drawPositions:n}=e,{positionAssignments:i}=Xr({structure:t});return 2===i.filter((t=>n.includes(t.drawPosition)&&t.participantId)).length}({structure:f,matchUp:h})))return{error:"Missing assignments"};const y=rs({matchUpStatus:c}),S=[pe].includes(c),w=gs({matchUpStatusCodes:y&&r||[],matchUpStatus:y&&c||re,tournamentRecord:a,drawDefinition:o,matchUpFormat:s,removeScore:S,winningSide:l,matchUpId:m,matchUp:h,event:v,score:I});if(w.error)return w;let N=h.drawPositions;if(g){const{matchUpTieId:n}=t;Us({matchUpId:n,tournamentRecord:a,drawDefinition:o,structure:f,event:v});const r=i.find((({matchUpId:t})=>t===n));if(N=null==r?void 0:r.drawPositions,!e)return{...B}}if(U)return{...B};if(!N)return{error:"Missing drawPositions"};{const t=l-1,e=1-t,r=N[t],s=N[e],{targetLinks:{loserTargetLink:m,winnerTargetLink:f},targetMatchUps:{winnerMatchUpDrawPositionIndex:h,loserMatchUpDrawPositionIndex:I,winnerMatchUp:g,loserMatchUp:U}}=p;if(g){const t=function({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:n,winningDrawPosition:i,tournamentRecord:r,winnerTargetLink:a,drawDefinition:o,winnerMatchUp:s,dualMatchUp:c,matchUpsMap:u}){if(a){const n=s.drawPositions||[],c=n[t],d=a.source.structureId,{positionAssignments:l}=Xr({structureId:d,drawDefinition:o}),p=l.find((t=>t.drawPosition===i)),m=null==p?void 0:p.participantId,f=a.target.structureId,{positionAssignments:h}=Xr({structureId:f,drawDefinition:o}),v=h.find((t=>t.participantId===m)),I=null==v?void 0:v.drawPosition,g=h.filter((t=>{const e=n.includes(t.drawPosition),i=!t.participantId&&!t.bye&&!t.qualifier;return e&&i})).map((t=>t.drawPosition)),U=g.includes(c);if(1===a.target.roundNumber&&U)$s({drawPosition:c,participantId:m,structureId:f,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,matchUpsMap:u});else if(g.length){const t=g.pop();$s({participantId:m,structureId:f,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,drawPosition:t,matchUpsMap:u})}else if(I){const t=bs({drawPosition:I,matchUpId:s.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,matchUpsMap:u});if(t.error)return t}else{const{structure:t,error:e}=hr({structureId:d,drawDefinition:o});if(e)return{error:e};if(t.stage!==Gi){const t="winner target position unavaiallble";return console.log(t),{error:t}}}}else{const t=bs({matchUpId:s.matchUpId,drawPosition:i,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,matchUpsMap:u});if(t.error)return t}if(c&&n){var d;const t=null===(d=c.sides)||void 0===d?void 0:d.find((t=>t.sideNumber===n));if(null!=t&&t.lineUp){var l;const e=c.roundPosition,i=s.roundPosition,a=e===i&&1!==e||Math.floor(e/2)===i?2:1,d=null==u||null===(l=u.drawMatchUps)||void 0===l?void 0:l.find((({matchUpId:t})=>t===s.matchUpId)),p=[1,2].map((t=>{var e;return{...(null===(e=d.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));d.sides=p;const m=d.sides.find((t=>t.sideNumber===a));m&&(m.lineUp=t.lineUp,et({lineUp:!0})&&console.log("directWinner",{side:t,targetSide:m,targetMatchUp:d,winnerMatchUp:s,projectedWinningSide:n,targetSideNumber:a}),La({tournamentId:null==r?void 0:r.tournamentId,matchUp:d,drawDefinition:o}))}}return{...B}}({winnerMatchUpDrawPositionIndex:h,inContextDrawMatchUps:i,projectedWinningSide:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:f,drawDefinition:o,winnerMatchUp:g,dualMatchUp:u,matchUpsMap:d,event:v});if(t.error)return t}if(U){const t=function(t){const{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:n,projectedWinningSide:i,loserDrawPosition:r,tournamentRecord:a,loserTargetLink:o,drawDefinition:s,loserMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:l}=t,p=o.linkCondition,m=c.drawPositions||[],f="FIRST_MATCHUP"===p&&2===c.roundNumber&&Math.min(...m.filter(Boolean)),h=f||m[e],v=f||m[1-e],I=o.source.structureId,{structure:g}=hr({structureId:I,drawDefinition:s}),{matchUps:U}=oa({inContext:!0,drawDefinition:s,structure:g,event:l}),y=U.filter((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.includes(r)})).filter((t=>{var e;const n=t.sides.find((t=>t.drawPosition===r)),i=t.matchUpStatus===pe||t.matchUpStatus===ae&&!(null===(e=t.score)||void 0===e||!e.scoreStringSide1);return(null==n?void 0:n.sideNumber)===t.winningSide&&!i})),S="FIRST_MATCHUP"===p&&0===y.length,{positionAssignments:w}=Xr({drawDefinition:s,structureId:I}),N=w.find((t=>t.drawPosition===r)),D=null==N?void 0:N.participantId,P=o.target.structureId,{positionAssignments:T}=Xr({drawDefinition:s,structureId:P}),M=T.filter((({drawPosition:t})=>m.includes(t)));if(M.some((t=>t.participantId===D)))return B;const A=M.filter((t=>{const e=m.includes(t.drawPosition),n=!t.participantId&&!t.bye&&!t.qualifier;return e&&n})).map((t=>t.drawPosition)),E=A.includes(h),b=o.target.roundNumber>1&&A.length,R=1===o.target.roundNumber&&E;if(f){const t=S?L():Ds({drawPosition:v,structureId:P,tournamentRecord:a,drawDefinition:s});if(t.error)return t}else if(R){const t=L();if(t.error)return t}else{if(!b)return{error:"Invlid drawPosition"};{const t=A.sort(Kt)[0],e=$s({participantId:D,structureId:P,drawPosition:t,automaticPlacement:!0,inContextDrawMatchUps:n,tournamentRecord:a,drawDefinition:s,matchUpsMap:d});if(e.error)return e}}if(u&&i){var C;const t=null===(C=u.sides)||void 0===C?void 0:C.find((t=>t.sideNumber===3-i));if(null!=t&&t.lineUp){var O;const{roundNumber:e}=c,{roundPosition:n}=u,r=1===e?2-n%2:1,o=null==d||null===(O=d.drawMatchUps)||void 0===O?void 0:O.find((({matchUpId:t})=>t===c.matchUpId)),l=[1,2].map((t=>{var e;return{...(null===(e=o.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{},sideNumber:t}}));o.sides=l;const p=o.sides.find((t=>t.sideNumber===r));p&&(p.lineUp=t.lineUp,et({lineUp:!0})&&console.log("directLoser",{side:t,targetSide:p,targetMatchUp:o,loserMatchUp:c,projectedWinningSide:i,targetSideNumber:r,roundNumber:e,roundPosition:n}),La({tournamentId:null==a?void 0:a.tournamentId,matchUp:o,drawDefinition:s}))}}return{...B};function L(){return $s({drawPosition:h,participantId:D,structureId:P,automaticPlacement:!0,inContextDrawMatchUps:n,tournamentRecord:a,drawDefinition:s,matchUpsMap:d})}}({loserMatchUpDrawPositionIndex:I,inContextDrawMatchUps:i,projectedWinningSide:n,loserDrawPosition:s,tournamentRecord:a,loserTargetLink:m,drawDefinition:o,matchUpStatus:c,loserMatchUp:U,winningSide:l,matchUpsMap:d,dualMatchUp:u,event:v});if(t.error)return t}}return B}function Zs(t){const{inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:i,targetData:r,structure:a,matchUp:o}=t,{targetLinks:{loserTargetLink:s},targetMatchUps:{loserMatchUp:c,winnerMatchUp:u,loserTargetDrawPosition:d}}=r;if(c){const t=ws({targetLink:s,drawPosition:d,drawDefinition:n,inContextDrawMatchUps:e,matchUpsMap:i});if(t.error)return t}if(u){const r=ha({matchUpId:u.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:{winnerMatchUp:s}}=r,c=null==i?void 0:i.drawMatchUps.find((t=>t.matchUpId===u.matchUpId));let d,h,v=[];if(u.feedRound){var l;v=null==s||null===(l=s.drawPositions)||void 0===l?void 0:l.filter(Boolean),d=!0}else{var p;const{pairedPreviousMatchUp:t}=function({structureId:t,matchUpsMap:e,matchUp:n}){const i=null==n?void 0:n.roundPosition,r=i+(i%2?1:-1);return{pairedPreviousMatchUp:ji({matchUpsMap:e,structureId:t}).find((({roundNumber:t,roundPosition:e})=>t===n.roundNumber&&e===r))}}({structureId:a.structureId,matchUpsMap:i,matchUp:o});h=(null==t?void 0:t.matchUpStatus)===oe,v=(null==t||null===(p=t.drawPositions)||void 0===p?void 0:p.filter(Boolean))||[],d=[...ge,ne].includes(null==t?void 0:t.matchUpStatus)||(null==t?void 0:t.winningSide)}if(d){var m;const t=o.drawPositions||[];let r=null===(m=u.drawPositions)||void 0===m?void 0:m.filter(Boolean);var f;x(t,r)&&(r=null===(f=r)||void 0===f?void 0:f.filter((e=>!t.includes(e))));const a=t.concat(v).find((t=>{var e;return null===(e=r)||void 0===e?void 0:e.includes(t)}));if(s&&a){const t=Ss({winningDrawPosition:a,winnerMatchUp:s,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:i});if(t.error)return t}}Zs({targetData:r,matchUp:u,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:i,structure:a});let I=[pe,oe].includes(null==c?void 0:c.matchUpStatus)&&h?pe:le;const g=!h;let U=gs({...t,matchUpStatus:I,removeScore:g,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:c,matchUpId:u.matchUpId});if(U.error)return U}return{...B}}function Qs({score:t}={}){const{sets:e,scoreStringSide1:n,scoreStringSide2:i}=t||{};return!!t&&(!(!n&&!i)||!(null==e||!e.length)&&Object.values(e[0]).some((t=>t)))}function Xs(t){const{matchUp:e,matchUpStatus:n,score:i,winningSide:r}=t;if((null==e?void 0:e.matchUpStatus)===oe&&n!==oe){const e=Zs(t);if(e.error)return e}const a=n===oe,o=Qs({score:i})&&!a&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),s=![ce,ee].includes(n||ce),c=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!Qs({score:i}),u=n&&n!==le,d=({removeScore:n}={})=>{let i;const{structure:r,drawDefinition:a}=t,{connectedStructureIds:o}=_s({drawDefinition:a,structure:r,matchUp:e});o.length&&(console.log({connectedStructureIds:o}),i=!0),Object.assign(t,{removeScore:n});const s=ys(t);return s.error?s:{...B,connectedStructures:i}};return r&&function(t){const{drawDefinition:e,winningSide:n,structure:i,matchUp:r}=t;let a;if(r.winningSide&&r.winningSide!==n){const{connectedStructureIds:n}=_s({drawDefinition:e,structure:i,matchUp:r});n.length&&(console.log({connectedStructureIds:n}),a=!0);const o=ys(t);if(o.error)return o}const o=Js(t);return o.error?o:{...B,connectedStructures:a}}(t)||o&&d({removeScore:s})||u&&function(t){const{tournamentRecord:e,drawDefinition:n,matchUpStatus:i,structure:r,matchUp:a}=t,o=i===ne,s=a.winningSide,c=i===oe,u=rs({matchUpStatus:i}),d=as({matchUpStatus:i}),l=s&&c;return!u&&!d&&{error:"Unrecognized matchUpStatus"}||s&&u&&!c&&Os(t)||l&&function(t){let e=ys(t);return e.error?e:Rs(t)}(t)||s&&ys(t)||d&&gs({...t,removeScore:[ie,pe].includes(i),matchUpStatus:i||le})||o&&function({tournamentRecord:t,drawDefinition:e,structure:n,matchUp:i}){var r;if(null!=i&&i.winningSide)return{error:"Invalid matchUpStatus",matchUpStatus:ne};const{positionAssignments:a}=Xr({structure:n}),o=a.filter((t=>t.bye)).map((t=>t.drawPosition));return(null===(r=i.drawPositions)||void 0===r?void 0:r.some((t=>o.includes(t))))?(i.matchUpStatus=ne,i.matchUpStatusCodes=[],La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUp:i}),B):{error:"Cannot Assign BYE status if no assignment: { bye: true }"}}({tournamentRecord:e,drawDefinition:n,structure:r,matchUp:a})||!u&&{error:"Unrecognized matchUpStatus"}||c&&function(t){const e=Os({...t,removeScore:!0});return e.error?e:Rs(t)}(t)||{error:"Invalid matchUpStatus"}}(t)||c&&d()||e&&function(t){var e;const n=Boolean(t.matchUp.collectionId),i=t.isCollectionMatchUp&&(null===(e=t.dualMatchUp)||void 0===e?void 0:e.winningSide)&&t.projectedWinningSide,r=gs({...t,removeScore:!0});if(n){const{matchUpTieId:e,drawDefinition:n,structure:r,event:a}=t,{removeWinningSide:o}=Us({tournamentRecord:t.tournamentRecord,matchUpId:e,drawDefinition:n,structure:r,event:a});console.log("ndd",{removeWinningSide:o,removeDirected:i})}return r}({...t,removeScore:!0})||console.log("unknown condition")&&{...B}}function tc(t){var e,n;const{inContextDrawMatchUps:i,targetData:r,drawDefinition:a,relevantLink:o}=t;if("FIRST_MATCHUP"===(null==o?void 0:o.linkCondition)&&(null==r||null===(e=r.matchUp)||void 0===e?void 0:e.matchUpStatus)===ne)return!1;const{targetMatchUps:{loserMatchUp:s,winnerMatchUp:c},targetLinks:u}=r,d=[pe].includes(null==s?void 0:s.matchUpStatus),l=(null==c||null===(n=c.drawPositions)||void 0===n?void 0:n.filter(Boolean).length)||0;if(null!=s&&s.winningSide&&!d||2===l&&null!=c&&c.winningSide)return!0;let p=s&&ha({matchUpId:s.matchUpId,inContextDrawMatchUps:i,drawDefinition:a}),m=c&&ha({matchUpId:c.matchUpId,inContextDrawMatchUps:i,drawDefinition:a});const f=p&&tc({relevantLink:null==u?void 0:u.loserTargetLink,targetData:p,inContextDrawMatchUps:i,drawDefinition:a});return!!(m&&tc({targetData:m,inContextDrawMatchUps:i,drawDefinition:a})||f)}function ec(t){var e,n;[pe,oe].includes(t.matchUpStatus)&&(t.score=void 0);const{allowChangePropagation:i,tournamentRecord:r,drawDefinition:a,matchUpStatus:o,winningSide:s,matchUpId:c,event:u,score:d}=t;if(!a)return{error:q};if([ie,ce,ee,le].includes(o)&&s)return{error:$,winningSide:s,matchUpStatus:o};if(![void 0,...he].includes(o))return{error:"Invalid matchUpStatus"};const l=Bi({drawDefinition:a});let{matchUps:p}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:l});p.find((({winnerMatchUpId:t,loserMatchUpId:e})=>t||e))||({inContextDrawMatchUps:p}=xo({inContextDrawMatchUps:p,drawDefinition:a,matchUpsMap:l}));const m=l.drawMatchUps.find((t=>t.matchUpId===c)),f=p.find((t=>t.matchUpId===c));if(!m||!p)return{error:"matchUp not found"};if((m.winningSide||s)&&o===ne)return{error:"Incompatible matchUpStatus",matchUpStatus:o};const h=null===(e=f.drawPositions)||void 0===e?void 0:e.filter(Boolean);if(m.matchUpType===Zt)return{error:"DIRECT SCORING of TEAM matchUp not implemented"};const v=f.matchUpTieId,I=ha({matchUpId:v||c,inContextDrawMatchUps:p,drawDefinition:a}),g=f.structureId,{structure:U}=hr({drawDefinition:a,structureId:g});if(d&&m.matchUpType!==Zt&&!m.collectionId){const t=m.matchUpFormat||(null==U?void 0:U.matchUpFormat)||(null==a?void 0:a.matchUpFormat)||(null==u?void 0:u.matchUpFormat),e=Oo({existingMatchUpStatus:m.matchUpStatus,matchUpFormat:t,matchUpStatus:o,winningSide:s,score:d});if(e.error)return e}const y=2===(null===(n=m.sides)||void 0===n?void 0:n.map((t=>t.participantId)).filter(Boolean).length)||2===(null==h?void 0:h.length);if(o&&fe.includes(o)&&!y)return{error:"Invalid matchUpStatus"};let S;if(Object.assign(t,{inContextDrawMatchUps:p,inContextMatchUp:f,matchUpTieId:v,matchUpsMap:l,targetData:I,structure:U,matchUp:m}),v){const{matchUp:e}=ca({matchUpId:v,inContext:!0,drawDefinition:a,matchUpsMap:l,event:u}),n=(null==e?void 0:e.tieFormat)||(null==U?void 0:U.tieFormat)||(null==a?void 0:a.tieFormat)||(null==u?void 0:u.tieFormat)||void 0,{projectedWinningSide:i}=function({drawDefinition:t,winningSide:e,dualMatchUp:n,tieFormat:i,structure:r,matchUp:a,event:o,score:s}){const c=Ht(n,void 0,!0);for(const d of(null==c?void 0:c.tieMatchUps)||[])d.matchUpId===a.matchUpId&&(d.winningSide=e,d.score=s);i=i||(null==a?void 0:a.tieFormat)||(null==r?void 0:r.tieFormat)||(null==t?void 0:t.tieFormat)||(null==o?void 0:o.tieFormat);const{winningSide:u}=we({matchUp:c,tieFormat:i});return{projectedWinningSide:u}}({winningSide:s,dualMatchUp:e,tieFormat:n,structure:U,matchUp:m,event:u,score:d});S=i!==e.winningSide,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:S,projectedWinningSide:i,matchUpTieId:v,dualMatchUp:e,tieFormat:n})}const w=tc(t),N=rs({matchUpStatus:o});if(!v){if(w&&!s&&as({matchUpStatus:o}))return{error:"Incompatible matchUpStatus",activeDownstream:w,winningSide:s};if(s&&s===m.winningSide&&o&&!N)return{error:"Incompatible matchUpStatus",directingMatchUpStatus:N,matchUpStatus:o}}const{schedule:D}=t;if(D){const t=wo({disableNotice:!0,tournamentRecord:r,drawDefinition:a,matchUpId:c,schedule:D});if(t.error)return t}const P=m.matchUpType!==Zt&&!S&&s&&m.winningSide&&m.winningSide!==s;if(i&&P&&m.roundPosition)return function(t){var e;const{tournamentRecord:n,inContextMatchUp:i,structure:r,drawDefinition:a}=t,o=i.roundNumber,s=i.sides.find((t=>t.sideNumber===i.winningSide)),c=i.sides.find((t=>t.sideNumber!==i.winningSide)),{drawPosition:u,participantId:d}=s,{drawPosition:l,participantId:p}=c,{matchUps:m}=oa(t),f=m.filter((({drawPositions:t,roundNumber:e})=>(null==t?void 0:t.includes(u))&&e>o));et({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach((t=>{var e;t.drawPositions=(null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>t===u?l:t)))||[],La({tournamentId:null==n?void 0:n.tournamentId,drawDefinition:a,matchUp:t})}));const{stage:h,stageSequence:v}=r,I=a.structures.filter((({stage:t,stageSequence:e})=>t===h&&e>v)).map((({structureId:t})=>t)),{targetLinks:{loserTargetLink:g,winnerTargetLink:U}}=t.targetData,y=[null==g?void 0:g.target.structureId,null==U||null===(e=U.target)||void 0===e?void 0:e.structureId].filter(Boolean);return a.structures.filter((({stage:t,structureId:e})=>t!==h&&y.includes(e))).forEach((({stage:t,stageSequence:e,structureId:n})=>{I.includes(n)||I.push(n),a.structures.filter((({stage:n,stageSequence:i})=>n===t&&i>e)).forEach((({structureId:t})=>{I.includes(t)||I.push(t)}))})),a.structures.filter((({structureId:t})=>I.includes(t))).forEach((t=>{const{positionAssignments:e}=Qr({structure:t}),n=e.find((({participantId:t})=>t===d)),i=e.find((({participantId:t})=>t===p));n&&(n.participantId=p),i&&(i.participantId=d)})),gs(t)}(t);const T=s&&!v||t.projectedWinningSide;return!w&&Xs(t)||T&&function(t){const{matchUp:e,winningSide:n,matchUpTieId:i,dualWinningSideChange:r}=t;return n===e.winningSide||i&&!r?nc(t):{error:"Cannot change winningSide"}}(t)||N&&nc(t)||{error:"No valid actions"}}function nc(t){const{tournamentRecord:e,matchUp:n,event:i}=t,r=t.isCollectionMatchUp&&n.winningSide&&!t.winningSide&&!Qs({score:t.score}),a=t.isCollectionMatchUp?t.machUpStatus||r&&le:t.matchUpStatus||re,o=[ie,pe].includes(a)&&![ce,ee].includes(a),s=gs({...t,matchUpStatus:a,removeWinningSide:r,removeScore:o});if(t.isCollectionMatchUp){const{matchUpTieId:n,drawDefinition:r,structure:a}=t,{removeWinningSide:o}=Us({matchUpId:n,tournamentRecord:e,drawDefinition:r,structure:a,event:i});console.log("sms",{removeWinningSide:o})}return s}function ic(t){const{tournamentRecord:e,drawDefinition:n,matchUpFormat:i,structureId:r,matchUpId:a,event:o}=t;let{tieFormat:s}=t;if(!n)return{error:q};if(!i&&!s)return{error:"Missing matchUpFormat"};if(i&&!h(i))return{error:"Unrecognized matchUpFormat"};if(s){const t=function(t){const e=Xt({tieFormat:t,checkCollectionIds:!1});if(e.error)return e;for(const n of t.collectionDefinitions)n.collectionId||(n.collectionId=Yt());return{tieFormat:t}}(s);if(t.error)return t;s=t.tieFormat}if(a){const{matchUp:t,error:r}=ca({drawDefinition:n,matchUpId:a,event:o});if(r)return{error:r};if(i&&t.matchUpType!==Di)t.matchUpFormat=i;else{if(!s||t.matchUpType!==Di)return{error:$};t.tieFormat=s}La({tournamentId:null==e?void 0:e.tournamentId,drawDefinition:n,matchUp:t})}else if(r){const{structure:t,error:e}=hr({drawDefinition:n,structureId:r});if(e)return{error:e};if(!t)return{error:"structure not found"};i&&t.matchUpType!==Di?t.matchUpFormat=i:s&&(t.tieFormat=s)}else n&&(i?n.matchUpFormat=i:s&&(n.tieFormat=s));return xa({drawDefinition:n,structureIds:r?[r]:void 0}),{...B,tieFormat:s}}function rc({score:t,winningSide:e,matchUpStatus:n}={}){if(!t)return{sets:[]};const i=t.sets||[];let r=In({winnerFirst:!1,matchUpStatus:n,sets:i}),a=In({winnerFirst:!1,matchUpStatus:n,reversed:!0,sets:i}),o=In({winningSide:e,matchUpStatus:n,sets:i}),s=r===o?a:r;return e&&(r=1===e?o:s,a=2===e?o:s),{score:{sets:i,scoreStringSide1:r,scoreStringSide2:a}}}function ac(t){var e;const{tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpId:a,schedule:o,event:s,notes:c}=t;if(!i)return{error:"Missing drawId"};if(!a)return{error:"Missing matchUpId"};const{policy:u}=bn({policyType:"scoring",tournamentRecord:n,event:s}),d=void 0!==t.allowChangePropagation?t.allowChangePropagation:void 0!==(null==u?void 0:u.allowChangePropagation)?u.allowChangePropagation:void 0;let{outcome:l}=t;if(r){const t=ic({tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpId:a,event:s});if(t.error)return t}if(null!=l&&null!==(e=l.score)&&void 0!==e&&e.sets&&!l.score.scoreStringSide1){const{score:t}=rc(l);l.score=t,l.score.sets=l.score.sets.filter((t=>t.side1Score||t.side2Score||t.side1TiebreakScore||t.side2TiebreakScore))}return ec({matchUpStatusCodes:null==l?void 0:l.matchUpStatusCodes,matchUpStatus:null==l?void 0:l.matchUpStatus,winningSide:null==l?void 0:l.winningSide,allowChangePropagation:d,score:null==l?void 0:l.score,tournamentRecord:n,drawDefinition:i,matchUpFormat:r,matchUpId:a,schedule:o,event:s,notes:c})}function oc(t){if(!t.tournamentRecord)return{error:G};const{tournamentRecord:e,outcomes:n}=t,i={};n.forEach((t=>{const{eventId:e}=t;i[e]||(i[e]=[]),i[e].push(t)}));for(const r of Object.keys(i)){const{event:t}=Yn({tournamentRecord:e,eventId:r});for(const n of i[r]){const{drawId:i}=n,r=t.drawDefinitions.find((t=>t.drawId===i));if(r){const{matchUpFormat:a,matchUpId:o}=n,s=ac({schedule:null==n?void 0:n.schedule,tournamentRecord:e,drawDefinition:r,matchUpFormat:a,matchUpId:o,outcome:n,drawId:i,event:t});if(s.error)return s}}}return{...B}}function sc({tournamentRecord:t}){if(!t)return{error:G};const e=t.tournamentId,{extension:n}=Ln({tournamentRecord:t,name:"schedulingProfile"});let i=(null==n?void 0:n.value)||[];if(i.length){const n=t.venues.map((({venueId:t,courts:e})=>(null==e?void 0:e.length)&&t)),{eventIds:r,drawIds:a}=Ro({tournamentRecords:{[e]:t}}),{updatedSchedulingProfile:o,modifications:s,issues:c}=Jo({schedulingProfile:i,venueIds:n,eventIds:r,drawIds:a});if(s){i=o;const e=function({tournamentRecord:t,schedulingProfile:e}){return yr({tournamentRecord:t,extension:{name:"schedulingProfile",value:e}})}({tournamentRecord:t,schedulingProfile:i});return e.error?e:{schedulingProfile:i,modifications:s,issues:c}}}return{schedulingProfile:i,modifications:0}}function cc({tournamentRecord:t,schedulingProfile:e,requireCourts:n=!0}){if(!e){const{modifications:e,issues:n}=sc({tournamentRecord:t});return{success:!e,modifications:e,issues:n}}const{venueIds:i,eventIds:r,drawIds:a}=Bo({tournamentRecord:t,requireCourts:n}),{modifications:o,issues:s}=Jo({schedulingProfile:e,venueIds:i,eventIds:r,drawIds:a});return{success:!o,modifications:o,issues:s}}function uc({tournamentRecord:t,courtId:e,scheduleVisibilityFilters:n,matchUpFilters:i}){if(!t)return{error:G};if(!e)return{error:"Missing courtId"};const{schedulingProfile:r}=sc({tournamentRecord:t}),{matchUps:a}=wa({tournamentRecord:t,scheduleVisibilityFilters:n,matchUpFilters:i});return{matchUps:function({matchUps:t,courtId:e}){return Qo({matchUps:t.filter((t=>{var n;return(null===(n=t.schedule)||void 0===n?void 0:n.courtId)===e})),schedulingProfile:r})}({matchUps:a,courtId:e})}}function dc({matchUpsCount:t=0}){const e=`Schedule would be deleted from ${t} ${1===t?"matchUp":"matchUps"}; use { force: true }`;return{message:e,error:e}}function lc({startTime:t,endTime:e}={}){if(!yt.test(t)||!yt.test(e))return!1;const[n,i]=t.split(":"),[r,a]=e.split(":");return!(r<n||n===r&&a<i)}function pc({dateAvailability:t}){if(!t)return{error:"Missing dateAvailability"};if(!Array.isArray(t))return{error:"Invalid dateAvailability"};const e="Times must be 24 hour => 00:00";for(const n of t){if("object"!=typeof n)return{error:"Invalid dateAvailability"};const{date:t,startTime:i,endTime:r,bookings:a=[]}=n;if(!i||!r)return{error:"Invalid dateAvailability"};if(t&&!Ut.test(t))return{error:K,dateAvailability:{date:t},message:"Dates must be formated => YYYY-MM-DD"};if(!yt.test(i))return{error:"Invalid time",dateAvailability:{startTime:i},message:e};if(!yt.test(r))return{error:"Invalid time",dateAvailability:{endTime:r},message:e};if(i===r)return{error:"Invalid time",dateAvailability:{startTime:i,endTime:r},message:"startTime and endTime are equivalent"};if(!lc({startTime:i,endTime:r}))return{error:"Invalid time",dateAvailability:{startTime:i,endTime:r},message:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:"Invalid bookings"};for(const t of a){if("object"!=typeof t)return{error:"Invalid bookings"};const{startTime:n,endTime:i}=t;if(!yt.test(n))return{error:"Invalid time",booking:{startTime:n},message:e};if(!yt.test(i))return{error:"Invalid time",booking:{endTime:i},message:e};if(n===i)return{error:"Invalid time",dateAvailability:{startTime:n,endTime:i},message:"startTime and endTime are equivalent"};if(!lc({startTime:n,endTime:i}))return{error:"Invalid time",dateAvailability:{startTime:n,endTime:i},message:"endTime must be after startTime"}}}}return{valid:!0}}function mc({tournamentRecord:t,dateAvailability:e,disableNotice:n,courtId:i,force:r}){if(!t)return{error:G};if(!i)return{error:"Missing courtId"};const a=pc({dateAvailability:e});if(a.error)return a;const{court:o,venue:s,error:c}=Hn({tournamentRecord:t,courtId:i});return c?{error:c}:(o.dateAvailability=e,n||at({topic:"modifyVenue",payload:{venue:s},key:s.venueId}),B)}function fc({tournamentRecord:t,modifications:e,disableNotice:n,courtId:i,force:r}){if(!t)return{error:G};if(!i)return{error:"Missing courtId"};if(!e||"object"!=typeof e)return{error:"Invalid object"};const{court:a,venue:o,error:s}=Hn({tournamentRecord:t,courtId:i});if(s)return{error:s};const c=Object.keys({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}).filter((t=>"courtId"!==t));if(!Object.keys(e).filter((t=>c.includes(t))).length)return{error:"No valid attributes"};const u=c.filter((t=>!["dateAvailability"].includes(t)));if(Object.keys(e).filter((t=>u.includes(t))).forEach((t=>Object.assign(a,{[t]:e[t]}))),e.dateAvailability){const a=mc({tournamentRecord:t,dateAvailability:e.dateAvailability,disableNotice:n,courtId:i,force:r});if(a.error)return a}return n||at({topic:"modifyVenue",payload:{venue:o},key:o.venueId}),{...B,court:Ht(a)}}function hc({tournamentRecord:t,disableNotice:e,returnDetails:n,venueId:i,courtId:r,court:a}){const{venue:o}=qn({tournamentRecord:t,venueId:i});if(!o)return{error:"Venue not found"};o.courts||(o.courts=[]);const s={altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfaceDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0,venueId:i,courtId:r};if(s.courtId||(s.courtId=Yt()),o.courts.reduce(((t,e)=>t||e.courtId===s.courtId),void 0))return{error:"Court exists"};{const t=((null==a?void 0:a.dateAvailability)||[]).map((t=>{var e;return{...t,date:Lt(t.date),startTime:Ot(t.startTime),endTime:Ot(t.endTime),bookings:null===(e=t.bookings)||void 0===e?void 0:e.map((({startTime:t,endTime:e,bookingType:n})=>({startTime:Ot(t),endTime:Ot(e),bookingType:n})))}}));for(const e of Object.keys(s))if(a[e])if("dateAvailability"===e){const e=pc({dateAvailability:t}),{valid:n,error:i}=e;if(n)s.dateAvailability=t;else if(i)return{error:i}}else s[e]=a[e];return o.courts.push(s),e||at({topic:"modifyVenue",payload:{venue:o},key:o.venueId}),et()||n?{...B,court:Ht(s),venueId:i}:{...B}}}function vc({dateAvailability:t=[],tournamentRecord:e,courtNames:n=[],courtTimings:i,courtsCount:r,startTime:a,courtIds:o,endTime:s,venueId:c,dates:u}){if(!c)return{error:"Missing venueId"};if(!U(r)||!n)return{error:"Missing courtsCount/courtNames"};const d=O(0,r=r||n.length).map((e=>{const r=null==i?void 0:i[e],o=r?u.map((t=>({date:Dt(t),startTime:a,endTime:s,...r}))):t;return r&&a&&s&&o.push({startTime:a,endTime:s}),{courtName:n[e]||`Court ${e+1}`,dateAvailability:o}})).map((t=>{const n=null==o?void 0:o.pop();return hc({disableNotice:!0,returnDetails:!0,tournamentRecord:e,courtId:n,venueId:c,court:t})})),l=d.map((t=>t.court)).filter(Boolean);if(l.length===r){const{venue:t}=qn({tournamentRecord:e,venueId:c});return at({topic:"modifyVenue",payload:{venue:t},key:t.venueId}),{...B,courts:Ht(l)}}return Object.assign({},{courts:Ht(l)},{error:d})}function Ic({tournamentRecord:t,modifications:e,venueId:n,force:i}){var r,a;if(!t)return{error:G};if(!e||"object"!=typeof e)return{error:"Invalid object"};if(!n)return{error:"Missing venueId"};const{venue:o,error:s}=qn({tournamentRecord:t,venueId:n});if(s)return{error:s};const c=Object.keys({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}).filter((t=>"venueId"!==t));if(!Object.keys(e).filter((t=>c.includes(t))).length)return{error:"No valid attributes"};const u=c.filter((t=>!["courts"].includes(t)));Object.keys(e).filter((t=>u.includes(t))).forEach((t=>Object.assign(o,{[t]:e[t]})));const d=(null==o||null===(r=o.courts)||void 0===r?void 0:r.map((t=>t.courtId)))||[],l=(null===(a=e.courts)||void 0===a?void 0:a.map((t=>t.courtId)))||[],p=d.filter((t=>!l.includes(t)));if(p.length){const e=o.courts.filter((t=>p.includes(t.courtId))).map((e=>{const{matchUps:n}=uc({tournamentRecord:t,courtId:e.courtId});return n.length})).reduce(((t,e)=>t+e));if(e&&!i)return{error:dc({matchUpsCount:e})};o.courts=o.courts.filter((t=>l.includes(t.courtId)))}if(e.courts)for(const m of e.courts){const{courtId:e}=m||{};let r=fc({tournamentRecord:t,modifications:m,disableNotice:!0,courtId:e,force:i});if("Court not found"===r.error&&(r=hc({tournamentRecord:t,venueId:n,court:m,disableNotice:!0})),r.error)return r}return cc({tournamentRecord:t}),at({topic:"modifyVenue",payload:{venue:o},key:o.venueId}),{...B,venue:Ht(o)}}function gc({tournamentRecord:t,drawDefinition:e,drawId:n,matchUpId:i}){if(!i)return{error:"Missing matchUpId"};if(!e&&!n)return{error:"Missing drawId"};let r;if(!e){if(!t)return{error:G};({drawDefinition:e}=Yn({tournamentRecord:t,drawId:n}))}if(e)({matchUp:r}=ca({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:G};const{matchUps:e}=Pa({tournamentRecord:t});({matchUp:r}=xi({matchUps:e,matchUpId:i}))}if(!r)return{error:"matchUp not found"};if(r.timeItems&&r.timeItems.reduce(((t,e)=>e.itemType===Xn||t),void 0)){const n={itemType:Xn,itemValue:"",itemDate:""};r.timeItems.push(n),La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUp:r})}return B}function Uc({tournamentRecord:t,venueId:e,force:n}){if(!t)return{error:G};if("string"!=typeof e)return{error:"Missing venueId"};const{courts:i}=Wn({tournamentRecord:t,venueId:e}),r={courtIds:i.map((t=>t.courtId))},{matchUps:a}=wa({tournamentRecord:t,contextFilters:r});if(a.length&&!n)return dc({matchUpsCount:a.length});for(const s of a){const e=gc({tournamentRecord:t,drawId:s.drawId,matchUpId:s.matchUpId});if(e.error)return e}let o;return t.venues=(t.venues||[]).filter((t=>{if(t.venueId!==e)return!0;o=!0})),o&&at({topic:"deleteVenue",payload:{venueId:e}}),B}function yc({flight:t,checkEntryStatus:e=!0,modifyEventEntries:n,existingDrawCount:i,tournamentRecord:r,drawDefinition:a,event:o}){var s,c,u,d,l,p,m,f;if(!a)return{error:"Missing drawId"};if(!o)return{error:W};o.drawDefinitions||(o.drawDefinitions=[]);const{drawId:h,drawName:v,entries:I}=a,{entries:g}=o;let U=0;if(void 0!==i&&i!==o.drawDefinitions.length)return{error:$,message:"drawDefintions count mismatch"};if(!!o.drawDefinitions.find((t=>t.drawId===h)))return{error:"drawId exists"};const{flightProfile:y}=vs({event:o}),S=t&&(null==y||null===(s=y.flights)||void 0===s?void 0:s.find((e=>e.flightNumber===t.flightNumber))),w=null==y||null===(c=y.links)||void 0===c||null===(u=c.find((t=>{var e;return(null==t||null===(e=t.target)||void 0===e?void 0:e.drawId)===h})))||void 0===u||null===(d=u.source)||void 0===d?void 0:d.drawId;if(w&&!o.drawDefinitions.find((t=>t.drawId===w)))return{error:q,sourceDrawId:w};if(S&&S.drawId!==a.drawId)return{error:"Invalid drawDefinition",relevantFlight:S};const N=null==S?void 0:S.drawEntries.every((({participantId:t,entryStatus:e})=>{const n=I.find((e=>e&&e.participantId===t));return!e||(null==n?void 0:n.entryStatus)===e})),D=!e||g&&(null==I?void 0:I.every((({participantId:t,entryStatus:e,entryStage:n})=>{const i=g.find((e=>e.participantId===t));return"VOLUNTARY_CONSOLATION"===(null==S?void 0:S.stage)&&"VOLUNTARY_CONSOLATION"===n||(null==i?void 0:i.entryStatus)===e})));if(S&&!N)return{error:"Invalid drawDefinition",matchingEventEntries:D,relevantFlight:S};if(n&&I.filter(Boolean).forEach((t=>{if(Vr.includes(null==t?void 0:t.entryStatus)){const e=g.filter(Boolean).find((e=>e.participantId===t.participantId));t.entryStatus&&e.entryStatus!==t.entryStatus&&(e.entryStatus=t.entryStatus,U+=1)}})),g&&!D)return{error:"Invalid drawDefinition",matchingEventEntries:D,eventEntries:g};const P=(null==y||null===(l=y.flights)||void 0===l||null===(p=l.map((({flightNumber:t})=>!isNaN(t)&&parseInt(t))))||void 0===p?void 0:p.filter(Boolean))||[],T=(null===(m=o.drawDefinitions.map((({drawOrder:t})=>!isNaN(t)&&parseInt(t))))||void 0===m?void 0:m.filter(Boolean))||[];let M=Math.max(0,...T,...P)+1;const A=null==y||null===(f=y.flights)||void 0===f?void 0:f.find((t=>t.drawId===h));let E;if(A){A.drawName=a.drawName,E={name:"flightProfile",value:{...y,flights:y.flights}};const t=A.flightNumber;t&&!T.includes(t)?M=t:A.flightNumber=M}else{const t=(null==y?void 0:y.flights)||[];t.push({manuallyAdded:!0,flightNumber:M,drawEntries:I,drawName:v,drawId:h}),E={name:"flightProfile",value:{...y||{},flights:t}}}wr({event:o,extension:E}),Object.assign(a,{drawOrder:M}),o.drawDefinitions.push(a);const{topics:b}=ct();if(b.includes("addMatchUps")){const{matchUps:t}=Na({drawDefinition:a,event:o});Ca({tournamentId:null==r?void 0:r.tournamentId,drawDefinition:a,matchUps:t})}return Fa({drawDefinition:a}),{...B,modifiedEventEntryStatusCount:U}}function Sc({tournamentRecord:t,returnDetails:e,disableNotice:n,venue:i}){return t?i?(t.venues||(t.venues=[]),i.venueId||(i.venueId=Yt()),t.venues.reduce(((t,e)=>t||e.venueId===i.venueId),void 0)?{error:"Venue exists"}:(t.venues.push(i),n||at({topic:"addVenue",payload:{venue:i}}),et({addVenue:!0})?{...B,venue:Ht(i)}:e?i:{...B})):{error:z}:{error:G}}function wc({allowDuplicateParticipantIdPairs:t,returnParticipant:e,tournamentRecord:n,disableNotice:i,pairOverride:r,participant:a}){if(!n)return{error:G};if(!a)return{error:"Missing participant"};a.participantId||(a.participantId=Yt()),n.participants||(n.participants=[]);const{participantId:o,individualParticipantIds:s}=a;if(n.participants.reduce(((t,e)=>e.participantId===o||t),!1))return{error:"participantId exists"};const{participantType:c,participantRole:u}=a;if(!Object.keys(Mi).includes(c))return{error:"Invalid participantType",participantType:c};if(!u)return{error:"Missing participantRole"};const d=n.participants||[],l=d.filter((t=>t.participantType===Ni)).map((t=>t.participantId));if(c!==Ni&&a.person)return{error:$,person:a.person};if(s&&!Array.isArray(s))return{error:$,individualParticipantIds:s};if(c===Pi){if(a.person)return{error:$,person:a.person};if(!a.individualParticipantIds)return{error:"Missing participantIds"};if(2!==a.individualParticipantIds.length&&!r)return{error:"Invalid participantIds",message:"PAIR must be 2 individualParticipantIds"};{const t=d.filter((t=>t.participantType===Ni)).map((t=>t.participantId));if(!Array.isArray(a.individualParticipantIds))return{error:"Invalid participantIds"};if(!a.individualParticipantIds.reduce(((e,n)=>t.includes(n)&&e),!0))return{error:"Invalid participantIds"}}const n=d.filter((t=>t.participantType===Pi)).map((t=>({individualParticipantIds:t.individualParticipantIds,participant:t}))),i=a.participantType===Pi&&n.find((t=>2===F(t.individualParticipantIds,a.individualParticipantIds).length));if(i&&!t)return{...B,existingParticipant:!0,participant:e&&Ht(i.participant)};if(!a.participantName){const t=d.filter((t=>a.individualParticipantIds.includes(t.participantId)));let e=t.map((t=>{var e;return null===(e=t.person)||void 0===e?void 0:e.standardFamilyName})).filter(Boolean).join("/");1===t.length&&(e+="/Unknown"),a.participantName=e}}else if(c===Ni){if(!a.person||!a.person.standardFamilyName||!a.person.standardGivenName)return{error:"Missing person details"};if(!a.participantName){const t=`${a.person.standardFamilyName.toUpperCase()}, ${a.person.standardGivenName}`;a.participantName=t,a.name=t}}else{if(![Di,Ti].includes(c))return{error:"Invalid participantType"};if(s||(a.individualParticipantIds=[]),a.individualParticipantIds.length)for(const t of a.individualParticipantIds){if("string"!=typeof t)return{error:$,participantId:t};if(!l.includes(t))return{error:Y,participantId:t}}}return n.participants.push(a),i||at({topic:"addParticipants",payload:{participants:[a]}}),{participant:e&&Ht(a),...B}}function Nc({allowDuplicateParticipantIdPairs:t,returnParticipants:e,participants:n=[],tournamentRecord:i}){if(!i)return{error:G};i.participants||(i.participants=[]);const r=i.participants.map((t=>t.participantId))||[];n.forEach((t=>{t.participantId||(t.participantId=Yt())}));const a=n.filter((t=>!r.includes(t.participantId))),o=n.filter((t=>r.includes(t.participantId))),s=a.filter((t=>t.participantType===Ni)),c=a.filter((t=>t.participantType!==Ni)),u=s.concat(...c),d=[];if(u.length){for(const e of u){const n=wc({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:e});if(n.error)return n;n.success&&!n.existingParticipant&&d.push(n.participant)}d.length&&at({topic:"addParticipants",payload:{participants:d}});const n={participants:e&&Ht(d),addedCount:d.length,...B};return o.length&&Object.assign(n,{notAdded:o,message:"Existing participant"}),n}return{message:"No new participants to add",addedCount:0,...B}}const Dc=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter((e=>t.includes(e))).filter((t=>e[t])).length;function Pc({matchUps:t=[],scheduleAttributes:e=["scheduledDate","scheduledTime"]}){if(!Array.isArray(t))return{error:"Missing matchUps"};if(!Array.isArray(e))return{error:$};const n=t.filter(Boolean).filter((({schedule:t})=>Dc({schedule:t,scheduleAttributes:e}))).reduce(((t,e)=>{const{schedule:n}=e,i=Lt(null==n?void 0:n.scheduledDate),r=Ot(null==n?void 0:n.scheduledTime);return i&&r&&(t[i]?t[i].push(e):t[i]=[e]),t}),{});return Object.keys(n).forEach((t=>{n[t].sort(((t,e)=>{var n,i;return function(t,e){const n=xt(t),i=xt(e);if(parseInt(n.hours)<parseInt(i.hours))return-1;if(parseInt(n.hours)>parseInt(i.hours))return 1;if(n.hours===i.hours){if(parseInt(n.minutes)<parseInt(i.minutes))return-1;if(parseInt(n.minutes)>parseInt(i.minutes))return 1}return 0}(Ot(null===(n=t.schedule)||void 0===n?void 0:n.scheduledTime),Ot(null===(i=e.schedule)||void 0===i?void 0:i.scheduledTime))}))})),{scheduledMatchUps:n}}var Tc;!function(t){t.INDIVIDUAL="INDIVIDUAL",t.PAIR="PAIR",t.TEAM="TEAM"}(Tc||(Tc={}));var Mc,Ac=Tc.INDIVIDUAL,Ec=Tc.PAIR,bc=Tc.TEAM;!function(t){t.SIGNED_IN="SIGNED_IN",t.SIGNED_OUT="SIGNED_OUT"}(Mc||(Mc={}));var Rc=Mc.SIGNED_IN,Cc=Mc.SIGNED_OUT,Oc={INDIVIDUAL:Ac,PAIR:Ec,TEAM:bc,SIGNED_IN:Rc,SIGNED_OUT:Cc,SIGN_IN_STATUS:"SIGN_IN_STATUS"};function Lc({element:t,accessor:e}){if("string"!=typeof e)return{values:[]};const n=Ht(t),i=e.split(".");let r,a=[];!function t({targetElement:e,attributes:n=[],significantCharacters:i}){for(const[r,a]of n.entries())if(e&&e[a])if(Array.isArray(e[a])){const i=e[a],o=n.slice(r);i.forEach((e=>t({targetElement:e,attributes:o})))}else o({targetElement:e=e[a],index:r});function o({targetElement:t,index:e}){if(t&&e===n.length-1&&["string","number"].includes(typeof t)){const e=i?t.slice(0,i):t;r?a.includes(e)||a.push(e):(r=e,a.push(e))}}}({targetElement:n,attributes:i});const o={value:r};return a.length&&(o.values=a),o}const Fc="SCALE",xc="RATING",kc="RANKING",_c={SCALE:Fc,RATING:xc,RANKING:kc,SEEDING:"SEEDING"};function Bc({requireTimeStamp:t,scaleAttributes:e,participant:n}){if(!n)return{error:"Missing participant"};if("object"!=typeof e)return{error:$};if(n.timeItems||(n.timeItems=[]),n&&Array.isArray(n.timeItems)){const{accessor:i,scaleType:r,eventType:a,scaleName:o}=e,s=[Fc,r,a,o].join("."),c=n.timeItems.filter((t=>(null==t?void 0:t.itemType)===s)).filter((e=>!t||(null==e?void 0:e.itemDate))).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))).pop();if(c){const[t,e,n,r]=c.itemType.split(".");if(t!==Fc)return{error:"Invalid scaleItem"};const a=i&&Lc({element:c.itemValue,accessor:i}),o=i?a.value:c.itemValue;return{scaleItem:{scaleDate:c.itemDate,scaleName:r,scaleType:e,eventType:n,scaleValue:o}}}return{error:"No scaleItem found"}}return{error:"Missing participant"}}function jc({participant:t,drawId:e,event:n}){let i;const{categoryName:r,ageCategoryCode:a}=(null==n?void 0:n.category)||{},o=[e,r||a,null==n?void 0:n.eventId].filter(Boolean);for(const s of o){let e=Bc({scaleAttributes:{eventType:null==n?void 0:n.eventType,scaleType:"SEEDING",scaleName:s},participant:t});if(null!=e&&e.scaleItem){i=e.scaleItem.scaleValue;break}}return{seedValue:i}}function Vc({tournamentRecord:t,participantFilters:e,participants:n}){var i,r;let{eventIds:a}=e;const{accessorValues:o,drawEntryStatuses:s,positionedParticipants:c,eventEntryStatuses:u,participantRoles:d,participantRoleResponsibilities:l,participantTypes:p,participantIds:m,signInStatus:f,enableOrFiltering:h}=e,v=Gc(a)&&(null===(i=t.events)||void 0===i?void 0:i.filter((t=>a.includes(t.eventId))))||t.events||[],I=s&&function({drawEntryStatuses:t,tournamentEvents:e}){const n=({entryStatus:e})=>!Array.isArray(t)||t.includes(e);return T(e.reduce(((t,e)=>{var i,r;const{flightProfile:a}=vs({event:e}),o=(null==a||null===(i=a.flights)||void 0===i?void 0:i.map((({drawEntries:t})=>Array.isArray(t)?t.filter(n).map(Oi):[])).flat())||[],s=(null===(r=e.drawDefinitions)||void 0===r?void 0:r.map((({entries:t})=>t?t.filter(n).map(Oi):[])))||[];return t.concat(...o,...s)}),[]))}({drawEntryStatuses:s,tournamentEvents:v}),g=u&&function({eventEntryStatuses:t,tournamentEvents:e}){return T(e.reduce(((e,n)=>{const i=(n.entries||[]).filter((({entryStatus:e})=>!Array.isArray(t)||t.includes(e))).map(Oi);return e.concat(...i)}),[]))}({eventEntryStatuses:u,tournamentEvents:v}),U=[!0,!1].includes(c)&&v.reduce(((t,e)=>t.concat(...(e.drawDefinitions||[]).map((t=>function({drawDefinition:t}){return t?(t.structures||[]).map((t=>{const{positionAssignments:e}=Qr({structure:t});return Ci(e)})).flat():{error:q}}({drawDefinition:t}))).filter(Boolean))),[]),y=t=>o.reduce(((e,n)=>{const{accessor:i,value:r}=n,{values:a}=Lc({element:t,accessor:i});return e&&(null==a?void 0:a.includes(r))}),!0);if(n=null===(r=n)||void 0===r?void 0:r.filter((t=>{const e=lo({element:t,itemType:"SIGN_IN_STATUS"}),{participantId:n,participantType:i,participantRole:r,participantRoleResponsibilities:a}=t;return h?c&&U.includes(n)||!1===c&&!U.includes(n)||I&&I.includes(n)||g&&g.includes(n)||m&&m.includes(n)||f&&e===f||p&&Gc(p)&&p.includes(i)||d&&Gc(d)&&d.includes(r)||l&&Gc(a)&&Gc(l)&&l.find((t=>a.includes(t)))||(null==o?void 0:o.length)&&Gc(o)&&y(t):(void 0===c||c&&U.includes(n)||!1===c&&!U.includes(n))&&(!I||I.includes(n))&&(!g||g.includes(n))&&(!m||m.includes(n))&&(!f||e===f)&&(!p||Gc(p)&&p.includes(i))&&(!d||Gc(d)&&d.includes(r))&&(!l||Gc(a)&&Gc(l)&&l.find((t=>a.includes(t))))&&(!(null!=o&&o.length)||Gc(o)&&y(t))})),v.length&&a){var S;const e=v.filter((t=>a.includes(t.eventId))).map((e=>{const n=(e.entries||[]).map((t=>t.participantId));if(e.eventType===gi)return n;const i=(t.participants||[]).filter((t=>n.includes(t.participantId))).map((t=>t.individualParticipantIds)).flat(1);return n.concat(...i)})).flat(1);n=null===(S=n)||void 0===S?void 0:S.filter((t=>e.includes(t.participantId)))}return n}function Gc(t){return t&&Array.isArray(t)&&t.length}function qc({participantFilters:t={},withSignInStatus:e,convertExtensions:n,policyDefinitions:i,withScheduleItems:r,tournamentRecord:a,scheduleAnalysis:o,usePublishState:s,withStatistics:c,withGroupings:u,withOpponents:d,withMatchUps:l,withEvents:p,withDraws:m,inContext:f,withISO:h}){if(!a)return{error:G};if(!a.participants)return{error:"Missing participants"};let v=a.participants.map((t=>Ht(t,n)));if("object"!=typeof t)return{error:"Invalid object",participantFilters:t};var I;let g,U;if(f&&(null===(I=v)||void 0===I||I.forEach((t=>{var e;[Pi,Di,Ti].includes(t.participantType)&&(t.individualParticipants=null===(e=t.individualParticipantIds)||void 0===e?void 0:e.map((t=>Ht(a.participants.find((e=>e.participantId===t)),n,!0))))}))),t&&(v=Vc({tournamentRecord:a,participantFilters:t,participants:v})),e||r||o||c||u||d||l||p||m||h){const n=function(t){var e;const n=[],i={},r={},a={},{tournamentRecord:o,participantFilters:s}=t,c=(null==o?void 0:o.participants)||[],{relevantParticipantIdsMap:u}=function({tournamentRecord:t,tournamentRecords:e,processParticipantId:n}){if("object"!=typeof t&&"object"!=typeof e)return{error:G};const i=e?Object.values(e).map((({participants:t=[]})=>t)).flat():t.participants||[];return{relevantParticipantIdsMap:Object.assign({},...i.map((({participantId:t,participantType:e,individualParticipantIds:i})=>("function"==typeof n&&n(t),{[t]:(i||[]).map((t=>({relevantParticipantId:t,participantType:Ac}))).concat({relevantParticipantId:t,participantType:e})}))))}}({processParticipantId:t=>{a[t]||(a[t]={groupParticipantIds:[],teamParticipantIds:[],pairParticipantIds:[],potentialMatchUps:{},scheduleItems:[],opponents:{},matchUps:{},events:{},groups:[],teams:[],draws:{},losses:0,wins:0})},tournamentRecord:o}),d=null==s?void 0:s.participantIds,l=t=>{const e=t&&u[t]||[];return e.some((t=>!d||d.includes(t.relevantParticipantId)))?e:[]};var p;return t.withGroupings&&c.forEach((t=>{if(t.participantType===Ti){var e;const n=t.participantId;null==t||null===(e=t.individualParticipantIds)||void 0===e||e.forEach((e=>{a[e].groupParticipantIds.includes(n)||(a[e].groupParticipantIds.push(n),a[e].groups.push({participantRoleResponsibilities:t.participantRoleResponsibilities,participantOtherName:t.participantOtherName,participantName:t.participantName,participantId:t.participantId}))}))}if(t.participantType===Zt){var n;const e=t.participantId;null==t||null===(n=t.individualParticipantIds)||void 0===n||n.forEach((n=>{a[n].teamParticipantIds.includes(e)||(a[n].teamParticipantIds.push(e),a[n].teams.push({participantRoleResponsibilities:t.participantRoleResponsibilities,participantOtherName:t.participantOtherName,participantName:t.participantName,participantId:t.participantId,teamId:t.teamId}))}))}if(t.participantType===Pi){var i;const e=t.participantId;null==t||null===(i=t.individualParticipantIds)||void 0===i||i.forEach((t=>{a[t].pairParticipantIds.includes(e)||a[t].pairParticipantIds.push(e)}))}})),(t.withScheduleItems||t.scheduleAnalysis||t.withStatistics||t.withOpponents||t.withMatchUps||t.withEvents||t.withDraws)&&(null===(p=t.tournamentEvents)||void 0===p||p.forEach((e=>{var n,s,d,p;const m=Ht(e,!0,!0);(null==m?void 0:m.eventType)===Zt&&(m.drawDefinitions||[]).forEach(((t,n)=>{const{extension:i}=On({element:e.drawDefinitions[n],name:"lineUps"});i&&(t.extensions=[i])}));const{eventId:f,eventName:h,eventType:v,category:I}=m,g={eventId:f,eventName:h,eventType:v,category:I},U=m&&Object.keys(m).filter((t=>"_"===t[0]));null==U||U.forEach((t=>g[t]=m[t]));const y=m.entries||[],{timeItem:S}=po({itemType:"PUBLISH.STATUS",event:m});if(null!=S&&null!==(n=S.itemValue)&&void 0!==n&&n.PUBLIC){const{drawIds:t=[],seeding:e}=S.itemValue.PUBLIC||{},n={published:void 0,drawIds:[]};e&&Object.assign(n,S.itemValue.PUBLIC.seeding),i[f]={publishedDrawIds:t,publishedSeeding:n}}const w=[].concat(...Object.values(Tn)).map((t=>`_${t}`)),N=g&&Object.keys(g).filter((t=>!w.includes(t))).reduce(((t,e)=>(t[e]=g[e],t)),{});null==y||y.filter((t=>null==t?void 0:t.participantId)).forEach((t=>{const{participantId:e,entryStage:n,entryStatus:i,entryPosition:r}=t,o=l(e);null==o||o.forEach((({relevantParticipantId:t})=>{a[t].events[f]={...N,partnerParticipantIds:[],entryPosition:r,entryStatus:i,entryStage:n,drawIds:[]}}))}));const D=(null===(s=m.drawDefinitions)||void 0===s?void 0:s.map((({drawId:t})=>t)))||[];null===(d=g._flightProfile)||void 0===d||null===(p=d.flights)||void 0===p||p.forEach((t=>{const{drawId:e,drawEntries:n}=t;D.includes(e)||null==n||n.forEach((t=>(({drawId:t,drawEntry:e,drawName:n,drawType:i})=>{const{participantId:o,entryStage:s,entryStatus:c,entryPosition:u}=e,d=l(o);null==d||d.forEach((({relevantParticipantId:e})=>{var o,d;a[e].events[f]||(a[e].events[f]={...N,partnerParticipantIds:[],entryPosition:u,entryStatus:c,entryStage:s,drawIds:[]}),a[e].draws[t]||(a[e].draws[t]={qualifyingDrawSize:null===(o=r[t])||void 0===o?void 0:o.qualifyingDrawSize,drawSize:null===(d=r[t])||void 0===d?void 0:d.drawSize,partnerParticipantIds:[],entryPosition:u,entryStatus:c,entryStage:s,drawName:n,drawType:i,eventId:f,drawId:t});const l=a[e].events[f].drawIds;!l||null!=l&&l.includes(t)||a[e].events[f].drawIds.push(t)}))})({drawId:e,drawEntry:t})))}));const P=Object.assign({},...(m.drawDefinitions||[]).map((t=>{var e,n,i,a;const o=Object.assign({},...y.filter((t=>t.participantId)).map((t=>({[t.participantId]:t}))),...t.entries.filter((t=>t.participantId)).map((t=>({[t.participantId]:t})))),s=Object.values(o),c=vr({stageSequence:1,drawDefinition:t,stage:Vi}),u=c&&(null===(e=Qr({structure:c}))||void 0===e||null===(n=e.positionAssignments)||void 0===n?void 0:n.length),d=vr({stageSequence:1,drawDefinition:t,stage:Gi}),l=c&&(null===(i=Qr({structure:d}))||void 0===i||null===(a=i.positionAssignments)||void 0===a?void 0:a.length);return r[t.drawId]={drawSize:u,qualifyingDrawSize:l},{[t.drawId]:{drawType:t.drawType,drawEntries:s}}})));if(m.eventType===Zt||t.withScheduleItems||t.scheduleAnalysis||t.withStatistics||t.withOpponents||t.withMatchUps){const{matchUps:t}=Da({participants:c,nextMatchUps:!0,tournamentRecord:o,inContext:!0,event:m});null==t||t.forEach((t=>function({matchUp:t,drawDetails:e,eventType:n}){const{collectionId:i,collectionPosition:o,drawId:s,drawName:c,eventId:d,eventName:p,finishingPositionRange:m,loserTo:f,matchUpId:h,matchUpType:v,matchUpFormat:I,matchUpStatus:g,roundName:U,roundNumber:y,roundPosition:S,score:w,sides:N,schedule:D,structureName:P,structureId:T,tieFormat:M,tieMatchUps:A,tournamentId:E,winnerTo:b,winningSide:R}=t,{winner:C,loser:O}=m||{},L=(null==A?void 0:A.length)&&A.filter((({matchUpType:t})=>t===Jt)).map((({sides:t})=>t.map((({sideNumber:t,participantId:e})=>t&&e&&{sideNumber:t,participantId:e})))).flat().filter(Boolean);if(null==N||N.forEach((({participantId:m,sideNumber:A}={})=>{if(!m)return;const{drawType:F,drawEntries:x}=e[s],k=1===A?null==w?void 0:w.scoreStringSide1:null==w?void 0:w.scoreStringSide2,_=R&&A===R,B=t.sides.find((({sideNumber:t}={})=>t===3-A)),j=null==B?void 0:B.participantId,V=j&&u[j]||[],G=R&&(_?C:O),q=x.find((t=>t.participantId===m)),H=l(m).filter((t=>n!==Zt||n===Zt&&v===Jt||t.participantType!==Pi));null==L||L.filter((t=>t.sideNumber===A)).forEach((({participantId:t})=>{t&&!H.includes(t)&&H.push({relevantParticipantId:t,participantType:Pi})})),null==H||H.forEach((({relevantParticipantId:t,participantType:e})=>{const{entryStage:u,entryStatus:l,entryPosition:m}=q||{};var A,C;a[t].draws[s]||(a[t].draws[s]={qualifyingDrawSize:null===(A=r[s])||void 0===A?void 0:A.qualifyingDrawSize,drawSize:null===(C=r[s])||void 0===C?void 0:C.drawSize,partnerParticipantIds:[],entryPosition:m,entryStatus:l,entryStage:u,drawName:c,drawType:F,eventId:d,drawId:s}),a[t].events[d]||(a[t].events[d]={partnerParticipantIds:[],drawIds:[],eventName:p,eventId:d});const O=a[t].events[d].drawIds;let L;if(!O||null!=O&&O.includes(s)||a[t].events[d].drawIds.push(s),e===Ni&&v===Jt){const e=H.find((e=>e.relevantParticipantId!==t&&e.participantType===Ni));L=null==e?void 0:e.relevantParticipantId}null==V||V.filter((t=>e===Ni||t.participantType===e)).forEach((({relevantParticipantId:e,participantType:n})=>{a[t].opponents[e]?a[t].opponents[e].push({eventId:d,drawId:s,matchUpId:h,participantType:n,participantId:e}):a[t].opponents[e]=[{eventId:d,drawId:s,matchUpId:h,participantType:n,participantId:e}]}));const x=V.map((({relevantParticipantId:t,participantType:e})=>({participantId:t,participantType:e})));a[t].matchUps[h]=Wt({collectionId:i,collectionPosition:o,drawId:s,eventId:d,eventType:n,finishingPositionRange:G,loserTo:f,matchUpId:h,matchUpType:v,matchUpFormat:I,matchUpStatus:g,opponentParticipantInfo:x,participantWon:_,partnerParticipantId:L,perspectiveScoreString:k,roundName:U,roundNumber:y,roundPosition:S,schedule:D,score:w,sides:N,structureName:P,structureId:T,tieFormat:M,tournamentId:E,winnerTo:b,winningSide:R}),L&&(a[t].events[d].partnerParticipantIds.push(L),a[t].draws[s].partnerParticipantIds.push(L),a[t].events[d].partnerParticipantId=L,a[t].draws[s].partnerParticipantId=L),R&&(_?a[t].wins++:a[t].losses++)}))})),Array.isArray(t.potentialParticipants)){const e=Ci(t.potentialParticipants.flat());null==e||e.forEach((t=>{const e=l(t);null==e||e.forEach((({relevantParticipantId:t})=>{a[t].potentialMatchUps[h]=Wt({drawId:s,eventId:d,eventType:n,matchUpId:h,matchUpType:v,matchUpFormat:I,roundName:U,roundNumber:y,roundPosition:S,schedule:D,tieFormat:M,structureName:P,potential:!0})}))}))}}({matchUp:t,drawDetails:P,eventType:v})))}}))),null===(e=t.tournamentParticipants)||void 0===e||e.forEach((e=>{const{scheduleConflicts:r,scheduleItems:o}=function({eventsPublishStatuses:t,withEvents:e=!0,withDraws:n=!0,participantIdMap:i,scheduleAnalysis:r,usePublishState:a,withStatistics:o,withOpponents:s,withMatchUps:c,participant:u,withISO:d}){var l;const p=[],m=[];d&&la({participant:u});const f=null===(l=u.timeItems)||void 0===l?void 0:l.filter((({itemType:t})=>t.startsWith(Fc)&&[kc,xc].includes(t.split(".")[1])));if(null!=f&&f.length){const t=t=>f.filter((e=>(null==e?void 0:e.itemType)===t)).sort(((t,e)=>new Date(t.createdAt||void 0)-new Date(e.createdAt||void 0))).pop(),e=T(f.map((({itemType:t})=>t)));u.rankings=void 0,u.ratings=void 0;for(const n of e){const e=t(n);if(e){const[,t,n,i]=e.itemType.split("."),r=t===kc?"rankings":"ratings";u[r]||(u[r]={}),u[r][n]||(u[r][n]=[]),u[r][n].push({scaleValue:e.itemValue,scaleName:i})}}}const h=null==u?void 0:u.participantId;if(!h||!i[h])return{};const{wins:v,losses:I,matchUps:g,potentialMatchUps:U,events:y,draws:S,opponents:w}=i[h],N=v+I,D={statCode:"winRatio",numerator:v,denominator:N,statValue:N&&v/N},P=Object.values(S),M=Object.values(y);if(n&&P){u.draws=P;for(const e of P){const n=null==M?void 0:M.find((t=>t.eventId===e.eventId)),{seedValue:i}=jc({drawId:e.drawId,participant:u,event:n});if(i){var A,E,b;const n=null===(A=t[e.eventId])||void 0===A?void 0:A.publishedSeeding;(!a||(null==n?void 0:n.published)&&(0===(null==n||null===(E=n.drawIds)||void 0===E?void 0:E.length)||(null==n||null===(b=n.drawIds)||void 0===b?void 0:b.includes(e.drawId))))&&(e.seedValue=i)}}}if(e&&M){u.events=M;for(const e of M){const{categoryName:n,ageCategoryCode:i}=e.category||{},r=Bc({scaleAttributes:{scaleType:"SEEDING",scaleName:n||i,eventType:e.eventType},participant:u}),{scaleItem:o}=r;if(o){var R,C,O;const n=o.scaleValue,i=null===(R=t[e.eventId])||void 0===R?void 0:R.publishedSeeding;(!a||(null==i?void 0:i.published)&&(0===(null==i||null===(C=i.drawIds)||void 0===C?void 0:C.length)||(null==i||null===(O=i.drawIds)||void 0===O?void 0:O.includes(e.drawId))))&&(e.seedValue=n)}}}const L=Object.values(w).flat();s&&null!=L&&L.length&&(u.opponents=L,null==P||P.forEach((t=>{t.opponents=L.filter((e=>e.drawId===t.drawId))})));const F=Object.values(U),x=Object.values(g);c&&(u.potentialMatchUps=F,u.matchUps=x);const k=x.concat(F),{scheduledMatchUps:_}=Pc({matchUps:k}),{scheduledMinutesDifference:B}=r||{};return Object.keys(_).forEach((t=>{_[t].filter(Boolean).forEach(((e,n)=>{var i;const{schedule:{scheduledTime:r,timeAfterRecovery:a,typeChangeTimeAfterRecovery:o},matchUpStatus:s,matchUpId:c,roundNumber:u,roundPosition:d,structureName:l,matchUpType:f,drawId:h}=e;if(p.push({drawId:h,matchUpType:f,matchUpId:c,structureName:l,roundNumber:u,roundPosition:d,...e.schedule,scheduledTime:Ot(null===(i=e.schedule)||void 0===i?void 0:i.scheduledTime)}),r&&s!==ne){const i=Rt(r),u=_[t].slice(n+1);for(const t of u){var v;if(s!==ne&&null!==(v=t.schedule)&&void 0!==v&&v.scheduledTime){var I,g;const n=e.matchUpType!==t.matchUpType&&o||a,r=e.drawId===t.drawId,s=e.potential&&t.potential,u=Rt(null===(I=t.schedule)||void 0===I?void 0:I.scheduledTime)-i;!(B&&!isNaN(B)?u<=B:Rt(n)>Rt(null===(g=t.schedule)||void 0===g?void 0:g.scheduledTime))||s&&r||m.push({priorScheduledMatchUpId:t.matchUpId,matchUpIdWithConflict:c})}}}}))})),null==P||P.forEach((t=>{const e=g&&x.filter((e=>e.drawId===t.drawId))||[],n=t=>Math.abs(t[0]-t[1]),i=e.reduce(((t,e)=>t?t&&e.finishingPositionRange&&n(t)>n(e.finishingPositionRange)?e.finishingPositionRange:t:e.finishingPositionRange),void 0);t.finishingPositionRange=i})),o&&(u.statistics=[D]),{scheduleConflicts:m,scheduleItems:p}}({...t,eventsPublishStatuses:i,participantIdMap:a,participant:e});if(t.withSignInStatus){const{timeItem:t}=lo({itemType:"SIGN_IN_STATUS",element:e});e.signedIn=!((null==t?void 0:t.itemValue)!==Rc)}if(t.withScheduleItems&&(e.scheduleItems=o),t.scheduleAnalysis&&(e.scheduleConflicts=r,null!=r&&r.length&&(n.includes(e.participantId)||n.push(e.participantId))),!1!==t.withGroupings){const t=a[e.participantId];e.groupParticipantIds=t.groupParticipantIds,e.pairParticipantIds=t.pairParticipantIds,e.teamParticipantIds=t.teamParticipantIds,e.groups=t.groups,e.teams=t.teams}})),{participantIdsWithConflicts:n,eventsPublishStatuses:i}}({tournamentEvents:a.events,tournamentParticipants:v,participantFilters:t,withScheduleItems:r,withSignInStatus:e,tournamentRecord:a,scheduleAnalysis:o,usePublishState:s,withStatistics:c,withGroupings:u,withOpponents:d,withMatchUps:l,withEvents:p,withDraws:m,withISO:h});g=null==n?void 0:n.participantIdsWithConflicts,U=null==n?void 0:n.eventsPublishStatuses}const y=null==i?void 0:i.participant;return null!=y&&y.participant&&(v=v.map((t=>D({source:t,template:y.participant})))),{participantIdsWithConflicts:g,tournamentParticipants:v,eventsPublishStatuses:U}}function Hc(t,e,n){return!t&&e?e:t&&!e||"object"!=typeof t||"object"!=typeof e?t:T(Object.keys(t).concat(Object.keys(e))).reduce(((i,r)=>{if(e[r])if(t[r])if(typeof t[r]!=typeof e[r])i[r]=e[r];else if(Array.isArray(t[r]))if(!0===n||Array.isArray(n)&&n.includes(r)){const n=T(t[r].map((t=>JSON.stringify(t))).concat(e[r].map((t=>JSON.stringify(t))))).map((t=>JSON.parse(t)));i[r]=n}else i[r]=e[r];else"object"==typeof t[r]?i[r]=Hc(t[r],e[r],n):i[r]=e[r];else i[r]=e[r];else i[r]=t[r];return i}),{})}function Wc(t){return{tournamentIds:Object.keys(t).filter(Boolean)}}const zc=({penaltyId:t=Yt()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t});function Kc({tournamentRecord:t,participantIds:e,penaltyCode:n,penaltyType:i,penaltyId:r,matchUpId:a,notes:o,extensions:s,issuedAt:c,refereeParticipantId:u}){if(!t)return{error:G};if(!e)return{error:"Missing participantId"};if(!i)return{error:"Missing penaltyType"};const d=((null==t?void 0:t.participants)||[]).filter((t=>e.includes(t.participantId)));if(!d.length)return{error:Y};const l=(new Date).toISOString(),p=Object.assign(zc({penaltyId:r}),{refereeParticipantId:u,penaltyCode:n,penaltyType:i,matchUpId:a,notes:o,issuedAt:c,createdAt:l});return Array.isArray(s)&&s.forEach((t=>gr({element:p,extension:t}))),d.forEach((t=>{t.penalties||(t.penalties=[]),t.penalties.push(p)})),at({topic:"modifyParticipants",payload:{participants:d}}),{...B,penaltyId:p.penaltyId}}function Yc({tournamentRecord:t,penaltyId:e}){if(!t)return{error:G};if(!e)return{error:"Missing penaltyId"};const n=(null==t?void 0:t.participants)||[],i=[];let r,a=!1;return n.forEach((t=>{let n=!1;t.penalties=(t.penalties||[]).filter((o=>(o.penaltyId===e&&(n=!0,a||(r=o,a=!0)),n&&i.push(t),o.penaltyId!==e)))})),r&&at({topic:"modifyParticipants",payload:{participants:i}}),r?{...B,penalty:r}:{error:"Penalty not found"}}function $c({tournamentRecord:t}){if(!t)return{error:G};const e=((null==t?void 0:t.participants)||[]).reduce(((t,e)=>{const{participantId:n}=e;return(e.penalties||[]).forEach((e=>{const{penaltyId:i}=e||{};t[i]?t[i].participants.push(n):t[i]={...e,participantIds:[n]}})),t}),{});return{penalties:Object.values(e)}}function Jc({tournamentRecord:t,penaltyId:e,modifications:n}){if(!t)return{error:G};if(!n)return{error:$,modifications:n};if(!e)return{error:"Missing penaltyId"};const i=(null==t?void 0:t.participants)||[],r=Object.keys(zc()).filter((t=>"penaltyId"!==t)),a=Object.keys(n).filter((t=>r.includes(t)));if(!a.length)return{error:"No valid attributes"};let o;const s=[];return i.forEach((t=>{let i=!1;t.penalties=(t.penalties||[]).map((t=>(t.penaltyId===e&&(i=!0,a.forEach((e=>Object.assign(t,{[e]:n[e]}))),o||(o=t)),t))),i&&s.push(t)})),o&&at({topic:"modifyParticipants",payload:{participants:s}}),o?{...B,penalty:o}:{error:"Penalty not found"}}const Zc={addExtension:Ho,findExtension:Wo,removeExtension:zo,addEventExtension:function({tournamentRecords:t,eventId:e,extension:n}){if("string"!=typeof e)return{error:W};if(!Ir(n))return{error:$};for(const i of Object.values(t)){const{event:t}=Yn({tournamentRecord:i,eventId:e});if(t)return wr({event:t,extension:n})}return{error:"Event not found"}},linkTournaments:function({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const{tournamentIds:e,error:n}=Wc(t);return n?{error:n}:(null==e?void 0:e.length)>1?Ho({tournamentRecords:t,extension:{name:"linkedTournamentsIds",value:{tournamentIds:e}}}):B},unlinkTournament:function({tournamentRecords:t,tournamentId:e}){if("object"!=typeof t)return{error:$};if(!e)return{error:"Missing tournamentId"};const{tournamentIds:n,error:i}=Wc(t);if(i)return{error:i};if(!n.includes(e))return{error:"Missing tournamentId"};let r;return n.every((n=>{var i;const a=t[n],{extension:o}=Ln({tournamentRecord:a,name:"linkedTournamentsIds"});if(!o)return!0;let s=(null==o||null===(i=o.value)||void 0===i?void 0:i.tournamentIds)||[];if(null==s||!s.length||1===s.length&&s.includes(e)||n===e){const t=Nr({tournamentRecord:a,name:"linkedTournamentsIds"});return t.error&&(r=t.error),t.success}const c=s.filter((t=>t!==e));o.value={tournamentIds:c};const u=yr({tournamentRecord:a,extension:o});return u.error&&(r=u.error),u.success})),r?{error:r}:{...B}},unlinkTournaments:function({tournamentRecords:t}){return"object"==typeof t&&Object.keys(t).length?zo({tournamentRecords:t,name:"linkedTournamentsIds"}):{error:"Missing tournamentRecords"}},getLinkedTournamentIds:function({tournamentRecords:t}){return"object"==typeof t&&Object.keys(t).length?{linkedTournamentIds:Object.assign({},...Object.keys(t).map((e=>{var n;const i=t[e],r=null==i?void 0:i.tournamentId,{extension:a}=Ln({tournamentRecord:i,name:"linkedTournamentsIds"});return{[e]:((null==a||null===(n=a.value)||void 0===n?void 0:n.tournamentIds)||[]).filter((t=>t!==r))}})))}:{error:"Missing tournamentRecords"}},addDrawDefinition:function({tournamentRecords:t,drawDefinition:e,tournamentId:n,eventId:i,flight:r,existingDrawCount:a}){if(!i)return{error:W};if(!(n=n||Co({tournamentRecords:t,eventId:i})))return{error:"Missing tournamentId"};const o=t[n];if(!o)return{error:G};const{event:s,error:c}=Yn({tournamentRecord:o,eventId:i});return c?{error:c}:yc({drawDefinition:e,event:s,flight:r,existingDrawCount:a})},getCompetitionParticipants:function(t){const{tournamentRecords:e}=t||{};if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};let n=[];const i=[],r=[];for(const a of Object.values(e)){const{tournamentParticipants:e,participantIdsWithConflicts:o}=qc({tournamentRecord:a,...t});for(const t of e){const{participantId:e}=t;i.includes(e)?n=n.map((n=>n.participantId!==e?n:Hc(n,t,!0))):(i.push(e),n.push(t))}o&&o.forEach((t=>{r.includes(t)||r.push(t)}))}return{competitionParticipants:n,participantIdsWithConflicts:r}},addParticipant:function({tournamentRecords:t,returnParticipant:e,pairOverride:n,tournamentId:i,participant:r}){if("string"!=typeof i)return{error:"Missing tournamentId"};const a=t[i];return a?wc({returnParticipant:e,tournamentRecord:a,pairOverride:n,participant:r}):{error:G}},setMatchUpStatus:function(t){const e=t.tournamentRecords,n=t.tournamentId||Co(t);if("string"!=typeof n)return{error:"Missing tournamentId"};const i=e[n];if(!i)return{error:G};const{drawDefinition:r,event:a}=Yn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:i});return ac({tournamentRecord:i,...t,drawDefinition:r,event:a})},bulkMatchUpStatusUpdate:function(t){const{tournamentRecords:e,outcomes:n}=t;if(!Array.isArray(n))return{error:z};const i=n.reduce(((t,e)=>t.includes(e.tournamentId)?t:t.concat(e.tournamentId)),[]);for(const r of i){const t=e[r];if(!t)return{error:G};const i=n.filter((t=>t.tournamentId===r));if(i.length){const e=oc({tournamentRecord:t,outcomes:i});if(e.error)return e}}return{...B}},bulkScheduleMatchUps:function({tournamentRecords:t,matchUpContextIds:e,schedule:n}){if(!t)return{error:"Missing tournamentRecords"};if(!Array.isArray(e))return{error:$};for(const i of Object.values(t)){const{tournamentId:t}=i,r=e.filter((e=>e.tournamentId===t)).map(Fi);if(null!=r&&r.length){const t=bo({tournamentRecord:i,matchUpIds:r,schedule:n});if(t.error)return t}}return B},addVenue:function({tournamentRecords:t,venue:e,disableNotice:n}){if("object"!=typeof e)return{error:$};e.venueId||(e.venueId=Yt());for(const i of Object.values(t)){const t=Sc({tournamentRecord:i,returnDetails:!0,disableNotice:!0,venue:e});if(null!=t&&t.error)return t}return n||at({topic:"addVenue",payload:{venue:e}}),B},deleteVenue:function({tournamentRecords:t,venueId:e,force:n}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e)return{error:"Missing venueId"};let i;for(const r of Object.values(t)){const t=Uc({tournamentRecord:r,venueId:e,force:n});if(t.error&&"Venue not found"!==t.error)return t;i=!0}return Zo({tournamentRecords:t}),i?B:{error:"Venue not found"}},modifyVenue:function({tournamentRecords:t,modifications:e,venueId:n,force:i}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof n)return{error:"Missing venueId"};let r,a;for(const o of Object.values(t)){const t=Ic({tournamentRecord:o,modifications:e,venueId:n,force:i});if(t.success&&(a=!0),t.error&&(r=t.error),t.error&&"Venue not found"!==t.error)return t}return Zo({tournamentRecords:t}),a?{...B}:{error:r}},addCourts:function(t){const{tournamentRecords:e,venueId:n}=t;if("string"!=typeof n||!n)return{error:"Missing venueId"};let i;for(const r of Object.values(e)){const{venue:e}=qn({tournamentRecord:r,venueId:n});if(e){const e=vc({tournamentRecord:r,...t});if(e.error)return e;i=!0}}return i?B:{error:"Venue not found"}},addPenalty:function(t){const{tournamentRecords:e,participantIds:n}=t;let i;for(const r of Object.values(e)){const{tournamentParticipants:e}=qc({tournamentRecord:r}),a=Ci(e).filter((t=>n.includes(t)));a.length&&(i=Kc({...t,penaltyId:t.penaltyId||i,tournamentRecord:r,participantIds:a}).penaltyId)}return i?{...B,penaltyId:i}:{error:Y}},removePenalty:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};for(const n of Object.values(e)){const e=Yc({tournamentRecord:n,...t});if(e.error&&"Penalty not found"!==e.error)return e}return{...B}},modifyPenalty:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};for(const n of Object.values(e)){const e=Jc({tournamentRecord:n,...t});if(e.error&&"Penalty not found"!==e.error)return e}return{...B}},getCompetitionPenalties:function({tournamentRecords:t}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const e=[];for(const n of Object.values(t)){const{penalties:t}=$c({tournamentRecord:n});e.push(...t)}return{penalties:e}},findParticipant:function({tournamentRecords:t,participantId:e,personId:n,policyDefinitions:i,inContext:r}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e&&"string"!=typeof n)return{error:z};let a;for(const o of Object.values(t)){const{tournamentParticipants:t}=qc({tournamentRecord:o,policyDefinitions:i,inContext:r});if(a=Rn({tournamentParticipants:t,participantId:e,personId:n,policyDefinitions:i}),a)break}return{participant:Ht(a,!1,!0)}}};function Qc(){const{topics:t}=ct();for(const e of t){const t=ot({topic:e});t&&ut({topic:e,notices:t})}}function Xc({tournamentRecord:t,matchUpFormat:e,event:n}){if(!t)return{error:G};if(!h(e))return{error:"Unrecognized matchUpFormat"};const{extension:i}=Fn({event:n,name:"scheduleTiming"}),r=null==i?void 0:i.value,{extension:a}=Ln({tournamentRecord:t,name:"scheduleTiming"}),o=null==a?void 0:a.value;return{matchUpFormat:e,averageTimes:[(null==r?void 0:r.matchUpAverageTimes)&&Dn({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpAverageTimes)&&Dn({...o,matchUpFormat:e})].find((t=>t)),recoveryTimes:[(null==r?void 0:r.matchUpRecoveryTimes)&&Pn({...r,matchUpFormat:e}),(null==o?void 0:o.matchUpRecoveryTimes)&&Pn({...o,matchUpFormat:e})].find((t=>t))}}function tu({tournamentRecord:t,matchUpFormat:e,averageTimes:n,recoveryTimes:i,event:r}){if(!t)return{error:G};if(n&&!Array.isArray(n))return{error:$};if(i&&!Array.isArray(i))return{error:$};const a="scheduleTiming";if(r){const{extension:t}=Fn({event:r,name:a});wr({event:r,extension:{name:a,value:eu({...(null==t?void 0:t.value)||{},matchUpFormat:e,averageTimes:n,recoveryTimes:i})}})}else{const{extension:r}=Ln({tournamentRecord:t,name:a});yr({tournamentRecord:t,extension:{name:a,value:eu({...(null==r?void 0:r.value)||{},matchUpFormat:e,averageTimes:n,recoveryTimes:i})}})}return B}function eu({matchUpAverageTimes:t=[],matchUpRecoveryTimes:e=[],averageTimes:n,recoveryTimes:i,matchUpFormat:r}){var a,o;const s=(null===(a=n=(n||[]).filter((t=>{var e,n;return(null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length)||(null==t||null===(n=t.categoryTypes)||void 0===n?void 0:n.length)})))||void 0===a?void 0:a.length)&&t.map((t=>{var e;return null!=t&&t.matchUpFormatCodes.includes(r)?{...t,matchUpFormatCodes:null===(e=t.matchUpFormatCodes)||void 0===e?void 0:e.filter((t=>t!==r))}:t})).filter((({matchUpFormatCodes:t})=>null==t?void 0:t.length)).concat({matchUpFormatCodes:[r],averageTimes:n}),c=(null===(o=i=(i||[]).filter((t=>{var e,n;return(null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length)||(null==t||null===(n=t.categoryTypes)||void 0===n?void 0:n.length)})))||void 0===o?void 0:o.length)&&e.map((t=>{var e;return null!=t&&t.matchUpFormatCodes.includes(r)?{...t,matchUpFormatCodes:null===(e=t.matchUpFormatCodes)||void 0===e?void 0:e.filter((t=>t!==r))}:t})).filter((({matchUpFormatCodes:t,averageTimes:e})=>(null==t?void 0:t.length)||e)).concat({matchUpFormatCodes:[r],recoveryTimes:i});return{matchUpAverageTimes:(null==s?void 0:s.length)&&s||t,matchUpRecoveryTimes:(null==c?void 0:c.length)&&c||e}}function nu({tournamentRecord:t,event:e,categoryType:n,matchUpFormat:i,averageMinutes:r,recoveryMinutes:a}){if(!t)return{error:G};if(!h(i))return{error:$};if(!e)return{error:W};const{averageTimes:o=[],recoveryTimes:s=[]}=Xc({tournamentRecord:t,matchUpFormat:i,event:e}),c=e.category,u=(null==c?void 0:c.categoryName)||(null==c?void 0:c.ageCategoryCode),d="DOUBLES"===e.eventType;let l={categoryNames:[u],minutes:{}},p={categoryNames:[u],minutes:{}};const m=t=>{var e,i;if(null!==(e=t.categoryTypes)&&void 0!==e&&e.includes(n)&&console.log("encountered:",{categoryType:n}),null===(i=t.categoryNames)||void 0===i||!i.includes(u)||(t.categoryNames=t.categoryNames.filter((t=>t!==u)),l={minutes:t.minutes,categoryNames:[u]},t.categoryNames.length))return t},f=!isNaN(parseInt(r)),v=!isNaN(parseInt(a)),I=o.map(m).filter((t=>{var e;return null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length})),g=s.map(m).filter((t=>{var e;return null==t||null===(e=t.categoryNames)||void 0===e?void 0:e.length}));return f&&(Object.assign(l.minutes,{[d?Ui:$t]:r}),I.push(l)),v&&(Object.assign(p.minutes,{[d?Ui:$t]:a}),g.push(p)),f||v?tu({tournamentRecord:t,event:e,matchUpFormat:i,averageTimes:f&&I,recoveryTimes:v&&g}):{error:$}}function iu({tournamentRecords:t,extensionName:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const n=[];let i;for(const r of Object.values(t)){const{extension:t}=Ln({tournamentRecord:r,name:e});t&&!i&&(n.push({method:"addExtension",params:{extension:t}}),i=!0);const a=r.events||[];for(const i of a){const{eventId:t}=i,{extension:r}=Fn({event:i,name:e});r&&n.push({method:"addEventExtension",params:{eventId:t,extension:r}})}}return{methods:n}}function ru({tournamentRecord:t,matchUpFormats:e,categoryType:n,event:i}){if(!t)return{error:G};if(!i)return{error:W};let r=[];if(null!=e&&e.length){const t=[];r=e.map((e=>{let n="string"==typeof e?{matchUpFormat:e}:e;if(!t.includes(null==n?void 0:n.matchUpFormat)&&h(null==n?void 0:n.matchUpFormat))return t.push(n.matchUpFormat),n})).filter(Boolean)}else{const{policy:e}=bn({policyType:"scoring",tournamentRecord:t,event:i});if(null!=e&&e.matchUpFormats)r=null==e?void 0:e.matchUpFormats;else{const{extension:t}=Fn({name:"scheduleTiming",event:i});if(null==t||!t.value)return{error:"Missing scoring policy / matchUpFormats"};r=T([...(t.value.matchUpAverageTimes||[]).map((t=>t.matchUpFormatCodes)),...(t.value.matchUpRecoveryTimes||[]).map((t=>t.matchUpFormatCodes))].flat()).map((t=>({matchUpFormat:t})))}}const{eventType:a,eventId:o,category:s}=i,c=null==s?void 0:s.categoryName;return o?{eventMatchUpFormatTiming:r.map((({matchUpFormat:e,description:r})=>{const o=jn({tournamentRecord:t,matchUpFormat:e,categoryName:c,categoryType:n,eventType:a,event:i});return Object.assign({},{...o,description:r,matchUpFormat:e})}))}:{error:W}}function au({tournamentRecord:t,drawDefinition:e,structureId:n,matchUpId:i,drawId:r,event:a}){var o,s,c;if(!t)return{error:G};if(!(r||a||n||i))return{error:z};const u=Aa({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r,event:a});if(i&&null!=u&&u.error)return u;!e&&null!=u&&u.drawDefinition&&(e=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&n&&!i){if(!e)return{error:"Missing drawId"};const t=hr({drawDefinition:e,structureId:n});if(t.error)return t;d=t.structure}const l=null===(o=d)||void 0===o?void 0:o.matchUpFormat,p=null===(s=e)||void 0===s?void 0:s.matchUpFormat,m=null==a?void 0:a.matchUpFormat;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:m,drawDefaultMatchUpFormat:p,matchUpFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.matchUpFormat)||l||p||m}}function ou({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:n,tournamentId:i,matchUpFormat:r,categoryName:a,categoryType:o,eventType:s,eventId:c}){var u,d,l,p;if(!h(r))return{error:"Unrecognized matchUpFormat"};let m;return Object.keys(n).filter((t=>!i||t===i)).find((t=>{var e,i,u;const d=n[t],l=c&&(null===(e=Yn({tournamentRecord:d,eventId:c}))||void 0===e?void 0:e.event);return m=jn({tournamentRecord:d,event:l,matchUpFormat:r,categoryName:a,categoryType:o,eventType:s}),(null===(i=m)||void 0===i?void 0:i.averageMinutes)||(null===(u=m)||void 0===u?void 0:u.recoveryMinutes)})),{averageMinutes:(null===(u=m)||void 0===u?void 0:u.averageMinutes)||e,recoveryMinutes:(null===(d=m)||void 0===d?void 0:d.recoveryMinutes)||t,typeChangeRecoveryMinutes:(null===(l=m)||void 0===l?void 0:l.typeChangeRecoveryMinutes)||(null===(p=m)||void 0===p?void 0:p.recoveryMinutes)||t}}function su({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:n,periodLength:i=30,matchUps:r,rounds:a}){if("object"!=typeof n)return{error:"Missing tournamentRecords"};if(!Array.isArray(a))return{error:z};const o=[],s=a.sort(((t,e)=>(t.sortOrder||0)-(e.sortOrder||0)));e=e||Object.assign({},...Object.values(n).map((t=>Ls({tournamentRecord:t}).containedStructures))),r||({matchUps:r}=Xo({tournamentRecords:n,nextMatchUps:!0}));const c={},u={},d={};let l=0;return{scheduledRoundsDetails:s.map((a=>{var s,p,m;const f=a.periodLength||i,h=e[a.structureId]||[a.structureId],v={tournamentIds:[a.tournamentId],roundNumbers:[a.roundNumber],matchUpIds:a.matchUpIds,eventIds:[a.eventId],drawIds:[a.drawId],structureIds:h};let g=aa({matchUps:r,processContext:!0,...v}).sort(ns);const{segmentNumber:U,segmentsCount:y}=a.roundSegment||{};if(w(U)&&I(null===(s=g)||void 0===s?void 0:s.length)&&I(y)&&U>0&&U<=y&&y<(null===(p=g)||void 0===p?void 0:p.length)&&(null===(m=a.matchUpIds)||void 0===m||!m.length)){const t=g.length/y,e=t*(U-1);g=g.slice(e,e+t)}const S=n[a.tournamentId],{drawDefinition:N,event:D}=Yn({drawId:a.drawId,tournamentRecord:S}),{matchUpFormat:P}=au({structureId:a.structureId,tournamentRecord:S,drawDefinition:N,event:D}),{eventType:T,category:M}=D||{},{categoryName:A,ageCategoryCode:E}=M||{},{typeChangeRecoveryMinutes:b,recoveryMinutes:R,averageMinutes:C,error:O}=ou({tournamentRecords:n,categoryName:A||E,tournamentId:a.tournamentId,eventId:a.eventId,matchUpFormat:P,eventType:T});if(O)return{error:O,round:a};const L=g.filter((({matchUpStatus:e})=>(t||!ge.includes(e))&&e!==ne)).map(Fi);return L.forEach((t=>{c[t]={typeChangeRecoveryMinutes:b,recoveryMinutes:R,averageMinutes:C},u[t]=R,d[t]=C})),o.push(...L),l=Math.max(C||0,l),{roundPeriodLength:f,recoveryMinutes:R,averageMinutes:C,matchUpIds:L,hash:`${C}|${f}`}})),greatestAverageMinutes:l,recoveryMinutesMap:u,averageMinutesMap:d,orderedMatchUpIds:o,minutesMap:c,...B}}function cu({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=60,averageMatchUpMinutes:n=90,remainingScheduleTimes:i,clearScheduleDates:r,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,endTime:d}){if("object"!=typeof o||!Object.keys(o).length)return{error:"Missing tournamentRecords"};const{courts:l,venues:p}=Go({tournamentRecords:o}),m=l.filter((t=>!u||u.includes(t.venueId)));c||(c=m.reduce(((t,e)=>{var n;const i=null===(n=e.dateAvailability)||void 0===n?void 0:n.find((t=>!t.date||Gt(s,t.date))),r=(null==i?void 0:i.startTime)||e.startTime;return r&&(!t||Rt(r)<Rt(t))?r:t}),void 0)),d||(d=m.reduce(((t,e)=>{var n;const i=null===(n=e.dateAvailability)||void 0===n?void 0:n.find((t=>!t.date||Gt(s,t.date))),r=(null==i?void 0:i.endTime)||e.endTime;return r&&(!t||Rt(r)>Rt(t))?r:t}),void 0));const f=Object.assign({},...Object.values(o).map((t=>(t.events||[]).map((e=>{const{scheduleTiming:n}=kn({tournamentRecord:t,event:e});return{[e.eventId]:{event:e,scheduleTiming:n}}})))).flat()),h=ts({tournamentRecords:o,sortDateMatchUps:!1,matchUpFilters:{scheduledDate:s,venueIds:u}}),v=[].concat(...h.dateMatchUps||[],...h.completedMatchUps||[]),I={averageTimes:[{minutes:{default:n}}],recoveryTimes:[{minutes:{default:e}}]},g=null==v?void 0:v.map((({eventId:t,schedule:e,matchUpFormat:n})=>{const{event:i,scheduleTiming:r}=f[t],o=null==i?void 0:i.eventType,s={...r,defaultTiming:I,matchUpFormat:n},{averageMinutes:c,recoveryMinutes:u}=Vn({eventType:o,timingDetails:s}),{courtId:d,venueId:l}=e,p=Ot(e.scheduledTime),m=Bt(p,c);return{averageMinutes:c,recoveryMinutes:u,periodLength:a,startTime:p,endTime:m,courtId:d,venueId:l}})),U={calculateStartTimeFromCourts:t,remainingScheduleTimes:i,averageMatchUpMinutes:n,date:s,clearScheduleDates:r,periodLength:a,startTime:c,endTime:d,bookings:g,courts:m},{scheduleTimes:y}=oo(U);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==p?void 0:p.length)?p[0].venueId:void 0,scheduleTimes:y,dateScheduledMatchUpIds:v.map(Fi)}}function uu({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function du({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:n,value:i}){const{matchUpType:r}=n,{individualParticipantIds:a}=ko(n),o=(t[n.matchUpId]||[]).filter((t=>!x(t,a))).flat();[...a,...o].forEach((t=>{if(uu({individualParticipantProfiles:e,participantId:t}),!e[t].potentialCounted[n.drawId]){const a=e[t].counters;a[r]?a[r]+=i:i>0&&(a[r]=i),a[_n]?a[_n]+=i:i>0&&(a[_n]=i),o.includes(t)&&(e[t].potentialCounted[n.drawId]=!0)}}))}function lu({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:n,matchUp:i}){var r;const a=((null==e||null===(r=e[i.matchUpId])||void 0===r?void 0:r.matchUpIds)||[]).filter((t=>n.includes(t))).filter((e=>!t[e]));return{dependenciesScheduled:!(null!=a&&a.length),remainingDependencies:a}}function pu({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:n,matchUp:i}){var r,a,o,s;const{individualParticipantIds:c}=ko(i);n=n||(null===(r=i.schedule)||void 0===r?void 0:r.timeAfterRecovery);const u=e=>{t[e]||(t[e]=[]),t[e]=T(t[e].concat(...c))},d=t=>{(!e[t]||n>e[t])&&(e[t]=n)},l=(null===(a=i.winnerTo)||void 0===a?void 0:a.matchUpId)||i.winnerMatchUpId;l&&(n&&d(l),u(l));const p=(null===(o=i.loserTo)||void 0===o?void 0:o.matchUpId)||i.loserMatchUpId;p&&(n&&d(p),u(p)),null!==(s=i.sidesTo)&&void 0!==s&&s.length&&i.sidesTo.forEach((({matchUpId:t})=>{t&&(n&&d(t),u(t))}))}function mu({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:n,matchUpDependencies:i,averageMatchUpMinutes:r=0,typeChangeRecoveryMinutes:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:c}){var u,d;const l=Ot(null==c||null===(u=c.schedule)||void 0===u?void 0:u.endTime),p=l?Bt(l,parseInt(o)):Bt(s,parseInt(r)+parseInt(o)),m=a&&(l?Bt(Ot(l),a):Bt(s,parseInt(r)+parseInt(a))),f=(null==i||null===(d=i[c.matchUpId])||void 0===d?void 0:d.participantIds)||[],h=(c.roundPosition&&e[c.matchUpId]||[]).flat();f.forEach((e=>{uu({individualParticipantProfiles:t,participantId:e});const n=t[e].priorMatchUpType!==c.matchUpType&&m||p;h.includes(e)?function({individualParticipantProfiles:t,recoveryValue:e,participantId:n,scheduleTime:i,drawId:r}){t[n].potentialRecovery[r]||(t[n].potentialRecovery[r]=[]),t[n].potentialRecovery[r].push(e),t[n].potentialBookings[r]||(t[n].potentialBookings[r]=[]),t[n].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:i})}({individualParticipantProfiles:t,drawId:c.drawId,recoveryValue:n,participantId:e,scheduleTime:s}):(t[e].timeAfterRecovery=n,t[e].bookings.push({scheduleTime:s,timeAfterRecovery:n}))})),pu({matchUpPotentialParticipantIds:e,matchUpNotBeforeTimes:n,timeAfterRecovery:p,matchUp:c})}function fu({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:n,matchUpId:i,details:r}){var a,o,s,c,u;let d;const l=null===(a=r.minutesMap)||void 0===a||null===(o=a[i])||void 0===o?void 0:o.recoveryMinutes,p=Bt(n,((null===(s=r.minutesMap)||void 0===s||null===(c=s[i])||void 0===c?void 0:c.averageMinutes)||0)+(l||0)),m=(null==e||null===(u=e[i])||void 0===u?void 0:u.dependentMatchUpIds)||[];if(m.length){const e=m.reduce(((e,n)=>{const i=t[n];if(!i)return e;const r={scheduleTime:i,matchUpId:n};return i&&!e.matchUpId||Rt(i)<Rt(e.scheduleTime)?r:e}),{});e.scheduleTime&&Rt(p)>Rt(e.scheduleTime)&&(d=e)}return{scheduledDependent:d}}function hu({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:n=!0,personRequests:i,scheduleTime:r,scheduleDate:a,matchUp:o}){const s=function(t){const{sides:e,matchUpType:n}=t||{};return(e||[]).map((t=>{var e;return n===Jt?(null==t||null===(e=t.participant)||void 0===e?void 0:e.individualParticipants)||[]:null!=t&&t.participant?[t.participant]:[]})).flat()}(o).map((({person:t})=>null==t?void 0:t.personId));if(n){const t=((null==o?void 0:o.potentialParticipants)||[]).flat().map((({person:t})=>null==t?void 0:t.personId));s.push(...t)}const c=s.map((t=>{var e;return null===(e=i[t])||void 0===e?void 0:e.map((e=>({...e,personId:t})))})).filter(Boolean).flat().filter((t=>"DO_NOT_SCHEDULE"===t.requestType&&Gt(a,t.date))),u=[],d=null==o?void 0:o.matchUpId,l=kt(Ot(r),Lt(a)),p=Ot(jt(l,t).toISOString());for(const m of c){const{requestId:t,startTime:n,endTime:i}=m;(r>n&&r<i||p>n&&p<i)&&(u.push({matchUpId:d,request:m,scheduleTime:r}),e[t]?(e[t].scheduleTimes.includes(r)||e[t].scheduleTimes.push(r),e[t].matchUpIds.includes(d)||e[t].matchUpIds.push(d)):e[t]={request:m,scheduleTimes:[r],matchUpIds:[d]})}return{conflicts:u}}function vu({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:n,scheduleTime:i,matchUp:r,details:a}){var o,s,c,u,d;const l=((null==n||null===(o=n[r.matchUpId])||void 0===o?void 0:o.participantIds)||[]).flat(),p=(null==a||null===(s=a.minutesMap)||void 0===s||null===(c=s[r.matchUpId])||void 0===c?void 0:c.averageMinutes)||0,m=(null==a||null===(u=a.minutesMap)||void 0===u||null===(d=u[r.matchUpId])||void 0===d?void 0:d.recoveryMinutes)||0,f=l.every((e=>{var n;uu({individualParticipantProfiles:t,participantId:e});let a=t[e];if(!a.timeAfterRecovery)return!0;const o=Ot(null==r||null===(n=r.schedule)||void 0===n?void 0:n.endTime),s=o?Bt(o,parseInt(m)):Bt(i,parseInt(p)+parseInt(m));return![...Object.keys(a.potentialBookings).filter((t=>t!==r.drawId)).map((t=>a.potentialBookings[t])).flat(),...a.bookings].find((t=>function(t,e){const n=Rt(t.scheduleTime),i=Rt(t.timeAfterRecovery),r=Rt(e.scheduleTime),a=Rt(e.timeAfterRecovery),o=n>r&&n<a,s=r>n&&r<i,c=i>r&&i<a,u=a>n&&a<i;return Wt({hasOverlap:n===r||i===a||o||c||s||u,startAisContained:o,endAisContained:c,startBisContained:s,endBisContained:u},!0)}({scheduleTime:i,timeAfterRecovery:s},t).hasOverlap))})),h=e[r.matchUpId],v=h?_t(kt(h),kt(i),!1):0;return{enoughTime:f&&v>=0}}function Iu({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:n}){let i,r,a,o,s=[],c=[];for(const u of t)i||(i=u.hash),(u.hash===i||n)&&(s=s.concat(u.matchUpIds)),u.hash===i||n||(i=u.hash,c.push({averageMinutes:r,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),s=u.matchUpIds),r=n?e:u.averageMinutes,a=u.recoveryMinutes,o=u.roundPeriodLength;return s.length&&c.push({averageMinutes:r,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:s}),{groupedRounds:c}}function gu({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:n={},matchUp:i}){const{matchUpId:r,matchUpType:a}=i,{enteredIndividualParticipantIds:o}=ko(i),s=(i.roundPosition&&e[r]||[]).flat(),c=T(o.concat(...s));return c.forEach((e=>{uu({individualParticipantProfiles:t,participantId:e})})),{participantIdsAtLimit:c.filter((e=>{const i=t[e];if(i)return[a,_n].find((t=>{const e=i.counters&&i.counters[t]||0,r=n[t]||0;return e&&r&&e>=r}))})),relevantParticipantIds:c}}function Uu({tournamentRecords:t,requestType:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const n={};for(const i of Object.values(t)){const{extension:t}=Ln({tournamentRecord:i,name:"personRequests"}),r=(null==t?void 0:t.value)||[];for(const i of r){const{personId:t,requests:r}=i||{};n[t]||(n[t]=[]);for(const i of r)e&&i.requestType!==e||n[t].push(i)}}return{personRequests:n}}function yu({tournamentRecords:t,personRequests:e}){if(!t)return{error:"Missing tournamentRecords"};for(const n of Object.values(t)){const{participants:t}=n,i=[];for(const n of Object.keys(e))if(Rn({tournamentParticipants:t,personId:n})){const t=e[n];t.length&&i.push({personId:n,requests:t})}Object.keys(i).length&&yr({tournamentRecord:n,extension:{name:"personRequests",value:i}})}return B}function Su({personRequests:t,personId:e,requests:n}){t[e]||(t[e]=[]);const i=n.filter((({requestType:t})=>t)).map((t=>{let{date:e,requestType:n,startTime:i,endTime:r}=t;return"DO_NOT_SCHEDULE"===n&&(e=Lt(e),i=Ot(i),r=Ot(r),e&&i&&r)?{date:e,startTime:i,endTime:r,requestType:n}:t})).filter(Boolean);for(const r of i)r.requestId=P(),t[e].push(r);return{mergeCount:i.length}}function wu({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=ge,tournamentRecord:n,scheduledDates:i,venueIds:r=[]}){if("object"!=typeof n)return{error:G};if(!Array.isArray(e)||!Array.isArray(r))return{error:$};r.length&&t.push("venueId");const{matchUps:a}=wa({matchUpFilters:{scheduledDates:i},tournamentRecord:n}),o=a.filter((n=>!e.includes(n.matchUpStatus)&&Dc({schedule:n.schedule,scheduleAttributes:t})&&(!(null!=r&&r.length)||r.includes(n.schedule.venueId)))).map(Fi),{matchUps:s}=wa({tournamentRecord:n,inContext:!1});let c=0;for(const u of s)o.includes(u.matchUpId)&&(u.timeItems=(u.timeItems||[]).filter((t=>![Xn,ti,ei,ii].includes(null==t?void 0:t.itemType))),c+=1);return{...B,clearedScheduleCount:c}}function Nu({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=ge,tournamentRecords:n,scheduledDates:i,venueIds:r}){const a="object"==typeof n&&Object.values(n).map((({tournamentId:t})=>t)).filter(Boolean);if(null==a||!a.length)return{error:"Missing tournamentRecords"};for(const o of a){const a=wu({ignoreMatchUpStatuses:e,scheduleAttributes:t,tournamentRecord:n[o],scheduledDates:i,venueIds:r});if(a.error)return a}return{...B}}function Du({tournamentRecord:t}){var e;if(!t)return{error:G};const{policy:n}=bn({policyType:"scheduling",tournamentRecord:t}),{extension:i}=Ln({tournamentRecord:t,name:"scheduleLimits"}),r=null==i||null===(e=i.value)||void 0===e?void 0:e.dailyLimits,a=null==n?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:r||a}}function Pu({tournamentRecords:t,tournamentId:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};let n;return Object.keys(t).filter((t=>!e||t===e)).find((e=>{const i=t[e],{matchUpDailyLimits:r}=Du({tournamentRecord:i});return n=r,!0})),{matchUpDailyLimits:n}}function Tu({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,periodLength:n=30,tournamentRecords:i,venueIds:r=[],scheduleDate:a,matchUps:o}){if("object"!=typeof i)return{error:"Missing tournamentRecords"};if(!Array.isArray(o))return{error:"Missing matchUps"};const s=Object.assign({},...Object.values(i).map((t=>(t.events||[]).map((e=>{const{scheduleTiming:n}=kn({tournamentRecord:t,event:e});return{[e.eventId]:{event:e,scheduleTiming:n}}})))).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]},u=null==o?void 0:o.filter((t=>Dc(t)&&(!a||t.schedule.scheduledDate===a))),d=null==u?void 0:u.filter((t=>!r.length||r.includes(t.schedule.venueId)));return{bookings:null==d?void 0:d.map((({eventId:t,schedule:e,matchUpFormat:i})=>{const{event:r,scheduleTiming:a}=s[t],o=null==r?void 0:r.eventType,u={...a,defaultTiming:c,matchUpFormat:i},{averageMinutes:d,recoveryMinutes:l}=Vn({eventType:o,timingDetails:u}),{courtId:p,venueId:m}=e,f=Ot(e.scheduledTime),h=Bt(f,d);return{averageMinutes:d,recoveryMinutes:l,periodLength:n,startTime:f,endTime:h,courtId:p,venueId:m}})).filter(Boolean),relevantMatchUps:d,dateScheduledMatchUps:u}}function Mu({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=60,averageMatchUpMinutes:n=90,remainingScheduleTimes:i,clearScheduleDates:r,periodLength:a=30,tournamentRecords:o,scheduleDate:s,startTime:c,venueIds:u,matchUps:d,endTime:l}){if("object"!=typeof o||!Object.keys(o).length)return{error:"Missing tournamentRecords"};const{courts:p,venues:m}=Go({tournamentRecords:o}),f=p.filter((t=>!u||u.includes(t.venueId)));c||(c=f.reduce(((t,e)=>{var n;const i=null===(n=e.dateAvailability)||void 0===n?void 0:n.find((t=>!t.date||Gt(s,t.date))),r=(null==i?void 0:i.startTime)||e.startTime;return r&&(!t||Rt(r)<Rt(t))?r:t}),void 0)),l||(l=f.reduce(((t,e)=>{var n;const i=null===(n=e.dateAvailability)||void 0===n?void 0:n.find((t=>!t.date||Gt(s,t.date))),r=(null==i?void 0:i.endTime)||e.endTime;return r&&(!t||Rt(r)>Rt(t))?r:t}),void 0));const{bookings:h,dateScheduledMatchUps:v}=Tu({defaultRecoveryMinutes:e,averageMatchUpMinutes:n,tournamentRecords:o,scheduleDate:s,periodLength:a,venueIds:u,matchUps:d}),I={calculateStartTimeFromCourts:t,remainingScheduleTimes:i,averageMatchUpMinutes:n,clearScheduleDates:r,date:s,periodLength:a,startTime:c,endTime:l,bookings:h,courts:f},{scheduleTimes:g}=oo(I);return{venueId:1===(null==u?void 0:u.length)?u[0]:1===(null==m?void 0:m.length)?m[0].venueId:void 0,scheduleTimes:g,dateScheduledMatchUpIds:v.map(Fi)}}function Au({checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:e,clearScheduleDates:n,scheduleDates:i=[],tournamentRecords:r,periodLength:a,dryRun:o}){return function({checkPotentialRequestConflicts:t=!0,scheduleCompletedMatchUps:e,clearScheduleDates:n,scheduleDates:i=[],tournamentRecords:r,periodLength:a,dryRun:o}){if(!r)return{error:"Missing tournamentRecords"};if(!Array.isArray(i))return{error:$};const{schedulingProfile:s=[],issues:c=[],modifications:u}=Ko({tournamentRecords:r}),d=Object.assign({},...Object.values(r).map((t=>Ls({tournamentRecord:t}).containedStructures))),l=i.map((t=>{if(wt(t))return Lt(t)})).filter(Boolean),p=s.map((t=>t.scheduleDate)).map((t=>wt(t)&&Lt(t))).filter((t=>t&&(!i.length||l.includes(t))));if(!p.length)return{error:"No valid dates"};if(n&&!o){const t=Array.isArray(n)?n:void 0;Nu({tournamentRecords:r,scheduledDates:t})}const{courts:m}=Go({tournamentRecords:r}),{matchUps:f}=Xo({nextMatchUps:!0,tournamentRecords:r}),{matchUpDependencies:h}=is({includeParticipantDependencies:!0,tournamentRecords:r,matchUps:f}),{matchUpDailyLimits:v}=Pu({tournamentRecords:r}),{personRequests:I}=Uu({requestType:"DO_NOT_SCHEDULE",tournamentRecords:r}),g=s.filter((t=>{const e=Lt(null==t?void 0:t.scheduleDate);return p.includes(e)})).sort(((t,e)=>{new Date(t.scheduleDate).getTime(),new Date(e.scheduleDate).getTime()})),U={},y={},S={},w={},N={},D={},P={},T={},M={},A={};for(const B of g){const i=Lt(null==B?void 0:B.scheduleDate),s=(null==B?void 0:B.venues)||[],c={},u={},l={},p=(t,e)=>{t.forEach((t=>{const n=l[t].counters;n[e]?n[e]+=1:n[e]=1,n[_n]?n[_n]+=1:n[_n]=1}))};S[i]={},w[i]={},U[i]={},y[i]={},P[i]=[],T[i]=[],M[i]=[],A[i]=[];const g={};f.forEach((t=>{var e;null!==(e=t.schedule)&&void 0!==e&&e.scheduledDate&&Gt(i,Lt(t.schedule.scheduledDate))&&pu({matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:g,matchUp:t})}));const _=[];for(const t of s){var E;const{rounds:o=[],venueId:s}=t,{scheduledRoundsDetails:p,greatestAverageMinutes:v,orderedMatchUpIds:I,minutesMap:U}=su({scheduleCompletedMatchUps:e,containedStructureIds:d,tournamentRecords:r,periodLength:a,matchUps:f,rounds:o});_.push(...I);const{groupedRounds:y}=Iu({scheduledRoundsDetails:p,greatestAverageMinutes:v,garmanSinglePass:!0}),{scheduleTimes:S,dateScheduledMatchUpIds:w}=Mu({averageMatchUpMinutes:null===(E=y[0])||void 0===E?void 0:E.averageMinutes,scheduleDate:Lt(i),venueIds:[t.venueId],clearScheduleDates:n,tournamentRecords:r,periodLength:a,matchUps:f}),N=Array.isArray(n)?n.includes(i):n,P=N?[]:f.filter((({matchUpId:t})=>w.includes(t)));for(const t of P){var b;du({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,scheduleDate:i,matchUp:t,value:1});const e=null===(b=t.schedule)||void 0===b?void 0:b.scheduledTime;if(e){var R;D[t.matchUpId]=e;const n=null==U||null===(R=U[t.matchUpId])||void 0===R?void 0:R.recoveryMinutes;mu({individualParticipantProfiles:l,matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:g,matchUpDependencies:h,recoveryMinutes:n,averageMatchUpMinutes:v,scheduleDate:i,scheduleTime:e,matchUp:t})}}let T=I.map((t=>f.find((e=>e.matchUpId===t)))).filter(Boolean).filter((t=>{const n=!N&&w.includes(t.matchUpId),i=[ne,ae,re,ee,ue,pe].includes(null==t?void 0:t.matchUpStatus);return e||!n&&!t.winningSide&&!i}));const{matchUpMap:M}=T.reduce(((t,e)=>{const{drawId:n,tournamentId:i}=e;return t.matchUpMap[i]||(t.matchUpMap[i]={}),t.matchUpMap[i][n]?t.matchUpMap[i][n].push(e):t.matchUpMap[i][n]=[e],pu({matchUpPotentialParticipantIds:c,matchUpNotBeforeTimes:g,matchUp:e}),t}),{matchUpMap:{}});u[s]={courtsCount:m.filter((t=>t.venueId===s)).length,previousRemainingScheduleTimes:[],greatestAverageMinutes:v,scheduledRoundsDetails:p,matchUpsToSchedule:T,scheduleTimes:S,groupedRounds:y,minutesMap:U,matchUpMap:M}}const j=10;let V,G=0,q=10;for(;!V;){for(const{venueId:e}of s){var C,O,L;let n=0;const r=u[e];for(;r.courtsCount&&null!==(F=r.scheduleTimes)&&void 0!==F&&F.length&&null!==(x=r.matchUpsToSchedule)&&void 0!==x&&x.length&&n<=r.courtsCount;){var F,x;const{scheduleTime:a,attempts:o=0}=r.scheduleTimes.shift(),s=r.matchUpsToSchedule.find((e=>{var n,o;const{matchUpId:s,matchUpType:u}=e,{participantIdsAtLimit:d,relevantParticipantIds:m}=gu({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,matchUpDailyLimits:v,matchUp:e});if(d.length)return T[i].includes(s)||T[i].push(s),!1;const{scheduledDependent:U}=fu({matchUpScheduleTimes:D,matchUpDependencies:h,scheduleTime:a,matchUpId:s,details:r});if(U)return!1;const{dependenciesScheduled:y,remainingDependencies:P}=lu({matchUpScheduleTimes:D,matchUpDependencies:h,allDateMatchUpIds:_,matchUps:f,matchUp:e});if(!y)return w[i][s]||(w[i][s]=[]),w[i][s].push({scheduleTime:a,remainingDependencies:P}),!1;const{enoughTime:M}=vu({individualParticipantProfiles:l,matchUpNotBeforeTimes:g,matchUpDependencies:h,scheduleTime:a,details:r,matchUp:e});if(!M)return S[i][s]||(S[i][s]=[]),S[i][s].push({scheduleTime:a}),!1;const E=r.greatestAverageMinutes,{conflicts:b}=hu({potentials:t,averageMatchUpMinutes:E,requestConflicts:A,personRequests:I,scheduleTime:a,scheduleDate:i,matchUp:e});if(null!=b&&b.length)return N[i]||(N[i]=[]),N[i].push(...b),!1;p(m,u);const R=null===(n=r.minutesMap)||void 0===n||null===(o=n[s])||void 0===o?void 0:o.recoveryMinutes;return mu({matchUpPotentialParticipantIds:c,individualParticipantProfiles:l,matchUpNotBeforeTimes:g,averageMatchUpMinutes:E,matchUpDependencies:h,recoveryMinutes:R,scheduleDate:i,scheduleTime:a,matchUp:e}),D[s]=a,!0}));r.matchUpsToSchedule=r.matchUpsToSchedule.filter((({matchUpId:t})=>t!==(null==s?void 0:s.matchUpId))),s?n+=1:(y[i][e]||(y[i][e]=[]),y[i][e].push({scheduleTime:a,attempts:o+1}))}var k;null!==(C=r.matchUpsToSchedule)&&void 0!==C&&C.length&&(y[i][e]=null===(k=y[i][e])||void 0===k?void 0:k.filter((t=>{const e=t.attempts<q;return e&&r.scheduleTimes.push(t),!e}))),null!==(O=r.scheduleTimes)&&void 0!==O&&O.length&&null!==(L=r.matchUpsToSchedule)&&void 0!==L&&L.length||(r.complete=!0)}G+=1,V=s.every((({venueId:t})=>u[t].complete))||G===j}for(const{venueId:t}of s){const e=u[t].matchUpMap;Object.keys(e).forEach((n=>{const a=r[n];a&&Object.keys(e[n]).forEach((r=>{const{drawDefinition:s}=$n({tournamentRecord:a,drawId:r});s&&e[n][r].forEach((({matchUpId:e})=>{const n=D[e];if(n){const r=n.split(":").map(Vt).join(":"),c=`${Lt(i)}T${r}`;o?P[i].push(e):(Do({drawDefinition:s,scheduledTime:c,matchUpId:e}).success&&P[i].push(e),t&&go({tournamentRecord:a,drawDefinition:s,matchUpId:e,venueId:t}))}}))}))})),M[i]=u[t].matchUpsToSchedule.map(Fi),U[i][t]=u[t].scheduleTimes.sort(((t,e)=>Rt(t.scheduleTime)-Rt(e.scheduleTime)))}}const _=g.map((({scheduleDate:t})=>t)),j={timeStamp:Date.now(),schedulingProfile:s,scheduledDates:_,noTimeMatchUpIds:M,scheduledMatchUpIds:P,overLimitMatchUpIds:T,requestConflicts:A},{topics:V}=ct();if(V.includes("audit"))at({topic:"audit",payload:j});else{const t={itemType:"autoSchedulingAudit",itemValue:j};for(const e of Object.values(r))ho({tournamentRecord:e,timeItem:t})}return{...B,schedulingProfileModifications:u,schedulingProfileIssues:c,scheduleTimesRemaining:U,dateSchedulingProfiles:g,skippedScheduleTimes:y,recoveryTimeDeferredMatchUpIds:S,dependencyDeferredMatchUpIds:w,matchUpScheduleTimes:D,scheduledMatchUpIds:P,overLimitMatchUpIds:T,noTimeMatchUpIds:M,requestConflicts:A,scheduledDates:_}}({checkPotentialRequestConflicts:t,scheduleCompletedMatchUps:e,clearScheduleDates:n,tournamentRecords:r,scheduleDates:i,periodLength:a,dryRun:o})}function Eu({event:t}){return t?Dr({event:t,name:"scheduleTiming"}):{error:W}}function bu({tournamentParticipants:t,tournamentRecord:e,drawDefinition:n,participantId:i,matchUpId:r,event:a}){if(!i)return{error:"Missing participantId"};if(!r)return{error:"Missing matchUp"};if(t&&t.length){const{matchUp:e}=ca({tournamentParticipants:t,inContext:!0,drawDefinition:n,matchUpId:r,event:a});if(!e)return{error:"matchUp not found"};const{error:o,checkedInParticipantIds:s,allRelevantParticipantIds:c}=ra({matchUp:e});if(!c.includes(i))return{error:"Invalid participantId"};if(o)return{error:o};if(s.includes(i))return{error:"Participant already checked in"}}return Io({tournamentRecord:e,drawDefinition:n,matchUpId:r,timeItem:{itemType:Zn,itemValue:i}})}function Ru({tournamentParticipants:t,tournamentRecord:e,drawDefinition:n,participantId:i,matchUpId:r,event:a}){if(!i)return{error:"Missing participantId"};if(!r)return{error:"Missing matchUpId"};if(t&&t.length){const{matchUp:e}=ca({tournamentParticipants:t,inContext:!0,drawDefinition:n,matchUpId:r,event:a}),{checkedInParticipantIds:o,allRelevantParticipantIds:s}=ra({matchUp:e});if(!s.includes(i))return{error:"Invalid participantId"};if(!o.includes(i))return{error:"Participant not checked in"};const{sideParticipantIds:c,nestedIndividualParticipantIds:u}=ia({matchUp:e}),d=c.indexOf(i);[0,1].includes(d)&&(u[d]||[]).forEach((t=>{Io({drawDefinition:n,matchUpId:r,timeItem:{itemType:Qn,itemValue:t}})}))}return Io({tournamentRecord:e,drawDefinition:n,matchUpId:r,timeItem:{itemType:Qn,itemValue:i}})}function Cu(t){if(null==t||!t.tournamentRecord)return{error:G};const{tournamentRecord:e,participantId:n,matchUpId:i,drawDefinition:r}=t,a=e.participants||[],{matchUp:o}=Aa({tournamentRecord:e,drawDefinition:r,matchUpId:i,inContext:!0});if(!o)return{error:"matchUp not found"};const{checkedInParticipantIds:s=[]}=ra({matchUp:o});return s.includes(n)?Ru({tournamentParticipants:a,tournamentRecord:e,drawDefinition:r,participantId:n,matchUpId:i}):bu({tournamentParticipants:a,tournamentRecord:e,drawDefinition:r,participantId:n,matchUpId:i})}function Ou(t){const{tournamentRecords:e}=t;if(!e)return{error:"Missing tournamentRecords"};const{tournamentId:n,drawId:i,matchUpId:r,courtDayDate:a}=t,o=e[n];if(!o)return{error:G};const{drawDefinition:s}=$n({tournamentRecord:o,drawId:i});return Uo({tournamentRecord:o,drawDefinition:s,courtDayDate:a,courtId:"",matchUpId:r})}const Lu="COMPETITOR",Fu={OTHER:"OTHER",COACH:"COACH",MEDIA:"MEDIA",CAPTAIN:"CAPTAIN",MEDICAL:"MEDICAL",OFFICIAL:"OFFICIAL",SECURITY:"SECURITY",COMPETITOR:Lu,ADMINISTRATION:"ADMINISTRATION"};function xu(t){return wo(t)}function ku({tournamentRecord:t,drawDefinition:e,disableNotice:n,scheduledDate:i,matchUpId:r}){return No({tournamentRecord:t,drawDefinition:e,disableNotice:n,scheduledDate:i,matchUpId:r})}function _u({tournamentRecord:t,drawDefinition:e,scheduledTime:n,disableNotice:i,matchUpId:r}){return Do({tournamentRecord:t,drawDefinition:e,scheduledTime:n,disableNotice:i,matchUpId:r})}function Bu({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,startTime:r}){return To({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,startTime:r})}function ju({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,endTime:r}){return Mo({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,endTime:r})}function Vu({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,stopTime:r}){return Ao({tournamentRecord:t,drawDefinition:e,disableNotice:n,matchUpId:i,stopTime:r})}function Gu({tournamentRecord:t,drawDefinition:e,disableNotice:n,resumeTime:i,matchUpId:r}){return Eo({tournamentRecord:t,drawDefinition:e,disableNotice:n,resumeTime:i,matchUpId:r})}function qu({tournamentRecord:t,drawDefinition:e,participantId:n,officialType:i,matchUpId:r,disableNotice:a}){if(!n)return{error:"Missing participantId"};const{tournamentParticipants:o}=qc({tournamentRecord:t,participantFilters:{participantTypes:[Ni],participantRoles:["OFFICIAL"]}});return Rn({tournamentParticipants:o,participantId:n})?Po({drawDefinition:e,participantId:n,officialType:i,matchUpId:r,disableNotice:a}):{error:Y}}function Hu({tournamentRecord:t,scheduleChange:e,matchUpIds:n,dryRun:i}){if(!t)return{error:G};if(!n||!Array.isArray(n))return{error:"Missing matchUpIds"};if("object"!=typeof e)return{error:$};const r=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...B};if(o&&isNaN(o))return{error:$};if(s&&isNaN(s))return{error:$};const{matchUps:c}=wa({matchUpFilters:{matchUpIds:n},tournamentRecord:t}),u=null==c?void 0:c.filter(Dc).filter((({matchUpStatus:t})=>!ge.includes(t)));if(!u.length)return{...B};const{tournamentInfo:d}=jo({tournamentRecord:t}),{startDate:l,endDate:p}=d,m=u.reduce(((t,e)=>{const{matchUpId:n,drawId:i}=e;return t[i]?t[i].push(n):t[i]=[n],t}),{});for(const g of Object.keys(m)){const{drawDefinition:e,error:c}=$n({tournamentRecord:t,drawId:g});if(c)return{error:c};const d=m[g].filter((t=>n.includes(t)));for(const t of d)if(t&&e){const n=u.find((e=>e.matchUpId===t)).schedule,{scheduledTime:c,scheduledDate:d}=n;let m,f,h;if(o&&c){const t=Lt(c),e=Rt(Ot(c))+o;if(m=e<0||e>1440,!m){let e=Bt(c,o);f=t?`${t}T${e}`:e}}if(!m&&s&&d&&(h=Ft(Lt(d),s),m=new Date(h)<new Date(l)||new Date(h)>new Date(p)),m)a.push(t);else{if(!i){if(f){const n=_u({scheduledTime:f,drawDefinition:e,matchUpId:t});if(n.error)return n}if(h){const n=ku({scheduledDate:h,drawDefinition:e,matchUpId:t});if(n.error)return n}}(f||h)&&r.push(t)}}}const{matchUps:f}=wa({matchUpFilters:{matchUpIds:n},tournamentRecord:t}),h=f.filter((({matchUpId:t})=>r.includes(t))),v=f.filter((({matchUpId:t})=>a.includes(t))),I=h.length&&!v.length;return{...B,rescheduled:h,notRescheduled:v,allRescheduled:I}}function Wu({tournamentRecord:t,dailyLimits:e}){return t?"object"!=typeof e?{error:"Invalid object"}:yr({tournamentRecord:t,extension:{name:"scheduleLimits",value:{dailyLimits:e}}}):{error:G}}function zu({tournamentRecords:t,tournamentId:e,drawId:n}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e&&!(e=Co({tournamentRecords:t,drawId:n})))return{error:"Missing tournamentId"};const i=t[e];if(!i)return{error:G};const{drawDefinition:r,error:a}=Yn({tournamentRecord:i,drawId:n});return{drawDefinition:r,error:a,tournamentRecord:i}}const Ku={scheduleMatchUps:function({tournamentRecords:t,competitionMatchUps:e,matchUpDependencies:n,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:a=0,recoveryMinutesMap:o,matchUpPotentialParticipantIds:s={},individualParticipantProfiles:c={},matchUpNotBeforeTimes:u={},matchUpDailyLimits:d={},checkPotentialRequestConflicts:l=!0,remainingScheduleTimes:p,clearScheduleDates:m,periodLength:f=30,scheduleDate:h,matchUpIds:v,venueIds:I,startTime:g,endTime:U,dryRun:y}){if(!t)return{error:"Missing tournamentRecords"};if(!v)return{error:"Missing matchUpIds"};if(!wt(h))return{error:K};if(isNaN(f)||isNaN(r)||isNaN(a))return{error:$};e||({matchUps:e}=Xo({tournamentRecords:t,nextMatchUps:!0})),n||({matchUpDependencies:n}=is({tournamentRecords:t,includeParticipantDependencies:!0,matchUps:e})),e.forEach((t=>{var e;null!==(e=t.schedule)&&void 0!==e&&e.scheduledDate&&Gt(h,Lt(t.schedule.scheduledDate))&&pu({matchUp:t,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s})}));const S=v.map((t=>e.find((e=>e.matchUpId===t)))).filter(Boolean),{venueId:w,scheduleTimes:N,dateScheduledMatchUpIds:D}=cu({tournamentRecords:t,remainingScheduleTimes:p,startTime:Ot(g),endTime:Ot(U),scheduleDate:Lt(h),averageMatchUpMinutes:r,clearScheduleDates:m,periodLength:f,venueIds:I}),P={},T=[],M={},A={},E={};e.filter((({matchUpId:t})=>D.includes(t))).forEach((t=>{var e;du({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,scheduleDate:h,matchUp:t,value:1});const i=null===(e=t.schedule)||void 0===e?void 0:e.scheduledTime;if(i){M[t.matchUpId]=i;const e=null==o?void 0:o[t.matchUpId];mu({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpNotBeforeTimes:u,matchUpDependencies:n,recoveryMinutes:e||a,averageMatchUpMinutes:r,scheduleDate:h,scheduleTime:i,matchUp:t})}}));let b=S.filter((t=>{const e=D.includes(t.matchUpId),n=[ne,ae,re,ee,ue,pe].includes(null==t?void 0:t.matchUpStatus);return!e&&!t.winningSide&&!n}));const{matchUpMap:R,overLimitMatchUpIds:C,participantIdsAtLimit:O}=b.reduce(((t,e)=>{const{drawId:n,tournamentId:i,matchUpType:r}=e,{participantIdsAtLimit:a,relevantParticipantIds:o}=gu({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,matchUpDailyLimits:d,matchUp:e});return null!=a&&a.length?(t.overLimitMatchUpIds.push(e.matchUpId),t.participantIdsAtLimit.push(...a),t):(o.forEach((t=>{uu({individualParticipantProfiles:c,participantId:t});const e=c[t].counters;e[r]?e[r]+=1:e[r]=1,e[_n]?e[_n]+=1:e[_n]=1})),t.matchUpMap[i]||(t.matchUpMap[i]={}),t.matchUpMap[i][n]?t.matchUpMap[i][n].push(e):t.matchUpMap[i][n]=[e],pu({matchUp:e,matchUpNotBeforeTimes:u,matchUpPotentialParticipantIds:s}),t)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});b=b.filter((({matchUpId:t})=>!C.includes(t)));let L=0;const F=(null==N?void 0:N.length)||0,{personRequests:x}=Uu({tournamentRecords:t,requestType:"DO_NOT_SCHEDULE"});for(;null!=N&&N.length&&b.length&&L<=F;){L++;const{scheduleTime:t}=N.shift(),d=b.find((d=>{const{matchUpId:p}=d,{dependenciesScheduled:m,remainingDependencies:f}=lu({matchUps:e,matchUpScheduleTimes:M,matchUpDependencies:n,allDateMatchUpIds:i,matchUp:d});if(!m)return E[p]||(E[p]=[]),E[p].push({scheduleTime:t,remainingDependencies:f}),!1;const{enoughTime:v}=vu({individualParticipantProfiles:c,matchUpNotBeforeTimes:u,matchUpDependencies:n,scheduleTime:t,matchUp:d});if(!v)return A[p]||(A[p]=[]),A[p].push({scheduleTime:t}),!1;const{conflicts:I}=hu({potentials:l,averageMatchUpMinutes:r,requestConflicts:P,personRequests:x,scheduleTime:t,scheduleDate:h,matchUp:d});if(null!=I&&I.length)return!1;const g=null==o?void 0:o[d.matchUpId];return mu({matchUpPotentialParticipantIds:s,individualParticipantProfiles:c,matchUpNotBeforeTimes:u,averageMatchUpMinutes:r,matchUpDependencies:n,recoveryMinutes:g||a,scheduleDate:h,scheduleTime:t,matchUp:d}),M[d.matchUpId]=t,!0}));b=b.filter((({matchUpId:t})=>t!==(null==d?void 0:d.matchUpId))),d||T.push(t)}b.forEach((t=>{du({individualParticipantProfiles:c,matchUpPotentialParticipantIds:s,scheduleDate:h,value:-1,matchUp:t})}));let k=[];Object.keys(R).forEach((e=>{const n=t[e];n?Object.keys(R[e]).forEach((t=>{const{drawDefinition:i}=$n({tournamentRecord:n,drawId:t});i&&R[e][t].forEach((({matchUpId:t})=>{const e=M[t];if(e){const r=e.split(":").map(Vt).join(":"),a=`${Lt(h)}T${r}`;y?k.push(t):(Do({drawDefinition:i,matchUpId:t,scheduledTime:a}).success&&k.push(t),w&&go({tournamentRecord:n,drawDefinition:i,matchUpId:t,venueId:w}))}}))})):et()&&console.log("Missing tournamentId")}));const _=Ri(b);return{...B,requestConflicts:Object.values(P),remainingScheduleTimes:N.map((({scheduleTime:t})=>t)),individualParticipantProfiles:c,matchUpNotBeforeTimes:u,participantIdsAtLimit:O,skippedScheduleTimes:T,overLimitMatchUpIds:C,scheduledMatchUpIds:k,noTimeMatchUpIds:_,recoveryTimeDeferred:A,dependencyDeferred:E}},scheduleProfileRounds:Au,clearScheduledMatchUps:Nu,bulkRescheduleMatchUps:function({tournamentRecords:t,scheduleChange:e,matchUpIds:n,dryRun:i}){if(!n||!Array.isArray(n))return{error:"Missing matchUpIds"};if("object"!=typeof e)return{error:$};const r=[];let a=[];for(const u of Object.values(t)){var o;const t=Hu({tournamentRecord:u,scheduleChange:e,matchUpIds:n,dryRun:i});if(t.error)return t;Array.isArray(t.notRescheduled)&&a.push(...t.notRescheduled);const c=Ri(t.notRescheduled),d=[];var s;null===(o=t.rescheduled)||void 0===o||o.forEach((t=>{const{matchUpId:e}=t;c.includes(e)&&d.push(e),r.push(t)})),d.length&&(a=(null==t||null===(s=t.notRescheduled)||void 0===s?void 0:s.filter((({matchUpId:t})=>!d.includes(t))))||[])}const c=r.length&&!a.length;return{...B,rescheduled:r,notRescheduled:a,allRescheduled:c}},getScheduledRoundsDetails:su,getMatchUpDependencies:is,generateVirtualCourts:ro,generateBookings:Tu,matchUpScheduleChange:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const{sourceMatchUpContextIds:n,targetMatchUpContextIds:i,sourceCourtId:r,targetCourtId:a,courtDayDate:o}=t||{},{drawId:s,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:l,tournamentId:p}=i||{};if(!c&&!l)return{error:z};let m=0;if(a&&c&&!l){const t=f({tournamentId:u,matchUpId:c,courtId:a,drawId:s,courtDayDate:o});if(null!=t&&t.success&&m++,t.error)return t}else if(r&&a&&c&&l){const t=f({tournamentId:u,matchUpId:c,courtId:a,drawId:s,courtDayDate:o});if(t.success&&m++,t.error)return t;const e=f({tournamentId:p,matchUpId:l,courtId:r,drawId:d,courtDayDate:o});if(e.success&&m++,e.error)return e}return m?B:{error:"No modifications applied"};function f({tournamentId:t,courtDayDate:n,matchUpId:i,courtId:r,drawId:a}){const o=e[t],{drawDefinition:s}=$n({tournamentRecord:o,drawId:a});return Uo({tournamentRecord:o,drawDefinition:s,courtDayDate:n,matchUpId:i,courtId:r})}},calculateScheduleTimes:cu,reorderUpcomingMatchUps:function(t){const{tournamentRecords:e}=t;if("object"!=typeof e||!Object.keys(e).length)return{error:"Missing tournamentRecords"};const{matchUpsContextIds:n,firstToLast:i}=t;if(!n)return{error:z};const r=null==n?void 0:n.length;if(!r)return B;let a=0;return n.forEach(((t,o)=>{const{tournamentId:s,drawId:c,matchUpId:u}=t;let d=o+(i?-1:1);d<0&&(d=r-1),d===r&&(d=0);const l=function({tournamentId:t,drawId:n,matchUpId:i,scheduledTime:r}){const a=e[t],{drawDefinition:o}=$n({tournamentRecord:a,drawId:n});return Do({drawDefinition:o,matchUpId:i,scheduledTime:r})}({tournamentId:s,drawId:c,matchUpId:u,scheduledTime:n[d].schedule.scheduledTime});if(!l.success)return l;a++})),a===r?B:{error:"Modifications failed"}},bulkUpdateCourtAssignments:function({tournamentRecords:t,courtAssignments:e,courtDayDate:n}){if(!t)return{error:"Missing tournamentRecords"};if(!Array.isArray(e))return{error:z};const i=e.reduce(((t,e)=>{const{tournamentId:n}=e;return t[n]||(t[n]=[]),t[n].push(e),t}),{});let r;return Object.keys(i).every((e=>{const a=t[e];if(!a)return r={error:G},!1;const o=i[e].reduce(((t,e)=>{const{drawId:n}=e;return t[n]||(t[n]=[]),t[n].push(e),t}),{});Object.keys(o).every((t=>{const{drawDefinition:e}=Yn({tournamentRecord:a,drawId:t});return e?(o[t].every((t=>{const{matchUpId:i,courtId:o}=t,s=Uo({tournamentRecord:a,drawDefinition:e,courtDayDate:n,matchUpId:i,courtId:o});if(s.success)return null==s?void 0:s.success;r={error:"Unable to assign court"}})),!0):(r={error:q},!1)}))})),r||B},removeMatchUpCourtAssignment:Ou,toggleParticipantCheckInState:function(t){const{tournamentRecords:e}=t,{participantId:n,tournamentId:i,matchUpId:r,drawId:a}=t;if(!(e&&i&&n&&r))return{error:z};const o=e[i],{drawDefinition:s}=$n({tournamentRecord:o,drawId:a});return Object.assign(t,{drawDefinition:s,tournamentRecord:o}),Cu(t)},findMatchUpFormatTiming:ou,modifyMatchUpFormatTiming:function({tournamentRecords:t,matchUpFormat:e,recoveryTimes:n,averageTimes:i,tournamentId:r,eventId:a}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const o=Object.keys(t).filter((t=>!r||r===t));if(r&&!o.includes(r))return{error:$};let s;for(const c of o){const r=t[c],{event:o}=Yn({tournamentRecord:r,eventId:a});a&&o&&(s=!0);const u=tu({tournamentRecord:r,event:o,matchUpFormat:e,averageTimes:i,recoveryTimes:n});if(u.error)return u}return!a||s?{...B}:{error:"Event not found"}},modifyEventMatchUpFormatTiming:function({tournamentRecords:t,tournamentId:e,eventId:n,categoryType:i,matchUpFormat:r,averageMinutes:a,recoveryMinutes:o}){if(!n)return{error:W};const s=Object.keys(t).filter((t=>!e||e===t));if(e&&!s.includes(e))return{error:$};for(const c of s){const e=t[c],{event:s}=Yn({tournamentRecord:e,eventId:n});if(s)return nu({tournamentRecord:e,event:s,categoryType:i,matchUpFormat:r,averageMinutes:a,recoveryMinutes:o})}return{error:"Event not found"}},getMatchUpFormatTimingUpdate:function({tournamentRecords:t}){return iu({tournamentRecords:t,extensionName:"scheduleTiming"})},getEventMatchUpFormatTiming:function({tournamentRecords:t,matchUpFormats:e,categoryType:n,tournamentId:i,eventId:r}){if(!r)return{error:W};const a=Object.keys(t).filter((t=>!i||t===i));if(i&&!a.length)return{error:$};let o,s,c;return a.find((i=>{const a=t[i],{event:u}=Yn({tournamentRecord:a,eventId:r});if(!u)return!1;c=!0;const{eventMatchUpFormatTiming:d,error:l}=ru({tournamentRecord:a,matchUpFormats:e,categoryType:n,event:u});return l&&(s=l),o=d,!0})),c?s?{error:s}:{eventMatchUpFormatTiming:o}:{error:"Event not found"}},removeEventMatchUpFormatTiming:function({tournamentRecords:t,eventId:e}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e)return{error:z};for(const n of Object.values(t)){const{event:t}=Yn({tournamentRecord:n,eventId:e});if(t)return Eu({event:t})}return{error:"Event not found"}},getMatchUpDailyLimits:Pu,setMatchUpDailyLimits:function({tournamentRecords:t,tournamentId:e,dailyLimits:n}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const i=Object.keys(t).filter((t=>!e||e===t));if(e&&!i.includes(e))return{error:$};for(const r of i){const e=Wu({tournamentRecord:t[r],dailyLimits:n});if(e.error)return e}return B},getMatchUpDailyLimitsUpdate:function({tournamentRecords:t}){return iu({tournamentRecords:t,extensionName:"scheduleLimits"})},assignMatchUpVenue:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{matchUpId:r,venueId:a,disableNotice:o}=t;return go({tournamentRecord:e,drawDefinition:n,disableNotice:o,matchUpId:r,venueId:a})},assignMatchUpCourt:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{matchUpId:r,courtId:a,courtDayDate:o,disableNotice:s}=t;return Uo({tournamentRecord:e,drawDefinition:n,disableNotice:s,courtDayDate:o,matchUpId:r,courtId:a})},addMatchUpScheduleItems:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);return i?{error:i}:xu({...t,tournamentRecord:e,drawDefinition:n})},addMatchUpScheduledDate:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{disableNotice:r,scheduledDate:a,matchUpId:o}=t;return ku({tournamentRecord:e,drawDefinition:n,disableNotice:r,scheduledDate:a,matchUpId:o})},addMatchUpScheduledTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{disableNotice:r,scheduledTime:a,matchUpId:o}=t;return _u({tournamentRecord:e,drawDefinition:n,disableNotice:r,scheduledTime:a,matchUpId:o})},addMatchUpStartTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{disableNotice:r,startTime:a,matchUpId:o}=t;return Bu({tournamentRecord:e,drawDefinition:n,disableNotice:r,startTime:a,matchUpId:o})},addMatchUpStopTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{disableNotice:r,stopTime:a,matchUpId:o}=t;return Vu({tournamentRecord:e,drawDefinition:n,disableNotice:r,stopTime:a,matchUpId:o})},addMatchUpResumeTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{disableNotice:r,resumeTime:a,matchUpId:o}=t;return Gu({tournamentRecord:e,drawDefinition:n,disableNotice:r,resumeTime:a,matchUpId:o})},addMatchUpEndTime:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{disableNotice:r,endTime:a,matchUpId:o}=t;return ju({tournamentRecord:e,drawDefinition:n,disableNotice:r,endTime:a,matchUpId:o})},addMatchUpOfficial:function(t){const{tournamentRecord:e,drawDefinition:n,error:i}=zu(t);if(i)return{error:i};const{disableNotice:r,participantId:a,officialType:o,matchUpId:s}=t;return qu({tournamentRecord:e,drawDefinition:n,disableNotice:r,participantId:a,officialType:o,matchUpId:s})},getSchedulingProfile:Ko,setSchedulingProfile:Yo,addSchedulingProfileRound:$o,validateSchedulingProfile:_o,addPersonRequests:function({tournamentRecords:t,personId:e,requests:n}){if(!t)return{error:"Missing tournamentRecords"};if("string"!=typeof e)return{error:$};if(!Array.isArray(n))return{error:$};const{personRequests:i}=Uu({tournamentRecords:t}),{mergeCount:r}=Su({personRequests:i,personId:e,requests:n});return r?yu({tournamentRecords:t,personRequests:i}):{error:$}},getPersonRequests:Uu,modifyPersonRequests:function({tournamentRecords:t,requests:e,personId:n}){if(!t)return{error:"Missing tournamentRecords"};if(!Array.isArray(e))return{error:$};const i=e.map((({requestId:t})=>t)).filter(Boolean),{personRequests:r}=Uu({tournamentRecords:t}),a=t=>{r[t]=r[t].map((t=>{if(!i.includes(t.requestId))return t;const n=e.find((e=>e.requestId===t.requestId));return n.requestType?Object.assign(t,n):void 0})).filter(Boolean)};if(n&&r[n])a(n);else for(const s of Object.keys(r))a(s);const o=e.filter((t=>!t.requestId));return o.length&&Su({personRequests:r,personId:n,requests:o}),yu({tournamentRecords:t,personRequests:r})},removePersonRequests:function({tournamentRecords:t,requestType:e,requestId:n,personId:i,date:r}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};const{personRequests:a}=Uu({tournamentRecords:t}),o=t=>{a[t]=a[t].filter((t=>!(e&&t.requestType===e||n&&t.requestId===n||r&&t.date===r))),a[t].length||delete a[t]},s=!(e||n||i||r);if(!s)if(i&&a[i])o(i);else for(const c of Object.keys(a))o(c);return s||!Object.keys(a).length?zo({tournamentRecords:t,name:"personRequests"}):yu({tournamentRecords:t,personRequests:a})}};function Yu({tournamentRecord:t,policyDefinitions:e,allowReplacement:n}){if(!t)return{error:G};if(!e||"object"!=typeof e)return{error:"Missing policyDefinitions"};t.extensions||(t.extensions=[]);const{appliedPolicies:i}=Mn({tournamentRecord:t}),r=Object.keys(e).map((t=>{if(!i[t]||n)return i[t]=e[t],t})).filter(Boolean);if(null!=r&&r.length){const e=yr({tournamentRecord:t,extension:{name:"appliedPolicies",value:i}});if(e.error)return e}return null!=r&&r.length?{...B,applied:r}:{error:"existing policyType"}}function $u({policyDefinitions:t,allowReplacement:e,event:n}){if(!n)return{error:W};if(!t)return{error:"Missing policyDefinitions"};let i=0;n.extensions||(n.extensions=[]);const{appliedPolicies:r}=An({event:n});return Object.keys(t).forEach((n=>{r[n]&&!e||(r[n]=t[n],i++)})),i&&wr({event:n,extension:{name:"appliedPolicies",value:r}}),i?B:{error:"Policy not attached"}}const Ju={attachPolicies:function({tournamentRecords:t,policyDefinitions:e}){if("object"!=typeof t||!Object.keys(t).length)return{error:"Missing tournamentRecords"};for(const n of Object.values(t)){const t=Yu({tournamentRecord:n,policyDefinitions:e,allowReplacement:!0});if(t.error)return t}return B}};function Zu(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antoina, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and challenging me.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}function Qu({tournamentParticipants:t=[],inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:i,matchUpId:r,event:a}){var o,s,c;if(!n)return{error:q};if(!r)return{error:"Missing matchUpId"};const{drawId:u}=n,{matchUp:d,structure:l}=ca({drawDefinition:n,matchUpId:r,event:a}),{assignedPositions:p,allPositionsAssigned:m}=Xr({structure:l}),{drawPositions:f}=d||{},{structureId:h}=l||{},v=[];if(!h)return{validActions:v};if(ea({drawDefinition:n,structure:l})){const e=(l.matchUps||[]).filter((({roundNumber:t})=>t===d.roundNumber)),i=(null==n?void 0:n.entries.filter((({entryStatus:t})=>[Cr,Fr,Rr].includes(t))).map(Oi))||[],a=e.map((t=>(t.sides||[]).map((t=>t.participantId)))).flat().filter(Boolean),o=i.filter((t=>!a.includes(t))),s=null==t?void 0:t.filter((t=>null==o?void 0:o.includes(t.participantId)));null==s||s.forEach((t=>{const e=(n.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),o.length&&v.push({type:"ASSIGN",availableParticipantIds:o,participantsAvailable:s,method:"assignMatchUpSideParticipant",payload:{drawId:u,matchUpId:r,structureId:h}}),v.push({type:"ALTERNATE"})}const I=xs({drawDefinition:n,structure:l}),g=p.filter((t=>t.participantId)).map((t=>t.drawPosition)),U=p.filter((t=>t.bye)).map((t=>t.drawPosition)),y=d.collectionId,S=d.matchUpStatus===ne||!y&&(null===(o=d.drawPositions)||void 0===o?void 0:o.reduce(((t,e)=>U.includes(e)||t),!1));if(S)return{validActions:v,isByeMatchUp:S};const w=null==f?void 0:f.reduce(((t,e)=>g.includes(e)&&t),2===(null==f?void 0:f.length));v.push({type:"REFEREE"});const N=!rs({matchUpStatus:d.matchUpStatus}),{appliedPolicies:D}=ki({drawDefinition:n}),P=null==D||null===(s=D.scoring)||void 0===s?void 0:s.structures,T=(null==P?void 0:P.stage)&&(null==P?void 0:P.stage[l.stage]),M=(null==T?void 0:T.stageSequence)&&T.stageSequence[l.stageSequence],A=!((null==D||null===(c=D.scoring)||void 0===c?void 0:c.requireAllPositionsAssigned)||(null==T?void 0:T.requireAllPositionsAssigned)||(null==M?void 0:M.requireAllPositionsAssigned))||m,E=d.sides&&2===d.sides.filter((t=>t&&t.participantId)).length;let b;const R=d.matchUpStatus===oe;if(R){i=i||Bi({drawDefinition:n}),e||({matchUps:e}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:i}));const t=ha({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:r});b=tc({inContextDrawMatchUps:e,drawDefinition:n,targetData:t})}const C=(w||E)&&!(R&&b),O={type:"PENALTY",method:"addPenalty",payload:{drawId:u,matchUpId:r,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(N&&v.push({type:"SCHEDULE"}),C&&v.push(O),N&&C&&v.push({type:"STATUS"}),A&&C){const{matchUpId:t,matchUpFormat:e}=d,n={drawId:u,matchUpId:t,matchUpFormat:e,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};v.push({type:"SCORE",method:"setMatchUpStatus",message:"set outcome and winningSide",payload:n}),v.push({type:"START"}),v.push({type:"END"})}return{validActions:v,isDoubleWalkover:R,structureIsComplete:I}}function Xu({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:i}){if(!t)return{error:G};if(!i){const{matchUps:r}=wa({tournamentRecord:t});i=r.reduce(((t,e)=>e.matchUpId===n?e.drawId:t),void 0),e=(t.events||[]).map((t=>t.drawDefinitions||[])).flat().reduce(((t,e)=>e.drawId===i?e:t),void 0)}return i?Qu({drawDefinition:e,matchUpId:n}):{error:"drawDefinition not found"}}const td={getCompetitionDateRange:Vo,getTournamentIds:function({tournamentRecords:t}){const e=Object.keys(t);return{...B,tournamentIds:e}},competitionScheduleMatchUps:ts,getSchedulingProfileIssues:function({tournamentRecords:t,scheduleDates:e=[]}={}){if("object"!=typeof t)return{error:"Invalid tournamentRecord"};if(!Array.isArray(e))return{error:$};if(!e.every(wt))return{error:K};const n=[];let i=0;const r={},{schedulingProfile:a}=Ko({tournamentRecords:t});if(!a)return{issues:n,...B};const{matchUps:o}=Xo({tournamentRecords:t,nextMatchUps:!0});for(const s of a){const{scheduleDate:a,venues:c=[]}=s;if(null==e||!e.length||e.includes(a))for(const e of c||[])if(e){const{rounds:s}=e,c=[];let{orderedMatchUpIds:u,scheduledRoundsDetails:d}=su({tournamentRecords:t,periodLength:30,matchUps:o,rounds:s});const{matchUpDependencies:l}=is({tournamentRecords:t,matchUps:o}),p=t=>{let e;return d.find(((n,i)=>{const r=n.matchUpIds.includes(t);return r&&(e=i),r})),e};if(u.forEach(((t,e)=>{var n;const i=F(u.slice(e+1),(null==l||null===(n=l[t])||void 0===n?void 0:n.matchUpIds)||[]);i.length&&c.push({matchUpId:t,shouldBeAfter:i})})),c.length){i+=c.length;const t=c.map((({matchUpId:t,shouldBeAfter:e})=>{const n=p(t),i=T(e.map(p));return r[a]||(r[a]={}),r[a][n]||(r[a][n]=[]),i.forEach((t=>{r[a][n].includes(t)||r[a][n].push(t)})),{matchUpId:t,matchUpRoundIndex:n,earlierRoundIndices:i,shouldBeAfter:e}}));n.push(...t)}}}return{issuesCount:i,profileIssues:{matchUpIdShouldBeAfter:Object.assign({},...n.map((t=>{const{matchUpId:e,shouldBeAfter:n,earlierRoundIndices:i}=t;return{[e]:{earlierRoundIndices:i,shouldBeAfter:n}}})))},roundIndexShouldBeAfter:r,...B}},allCompetitionMatchUps:Xo,competitionMatchUps:es,matchUpActions:function({tournamentRecords:t,tournamentId:e,matchUpId:n,eventId:i,drawId:r}={}){if("object"!=typeof t||"string"!=typeof e||"string"!=typeof n||"string"!=typeof r)return{error:$};const a=t[e];if(!a)return{error:G};const{drawDefinition:o,error:s}=Yn({tournamentRecord:a,eventId:i,drawId:r});return s?{error:s}:Xu({tournamentRecord:a,drawDefinition:o,drawId:r,matchUpId:n})},getCompetitionVenues:qo,getVenuesAndCourts:Go,getVenuesReport:function({tournamentRecords:t,venueIds:e=[],dates:n=[]}){if(!Array.isArray(n))return{error:$,dates:n};if(!Array.isArray(e))return{error:$,venueIds:e};if(!n.every(wt))return{error:K};const i=Go({tournamentRecords:t});if(i.error)return i;const r=i.venues.filter((({venueId:t})=>!(null!=e&&e.length)||e.includes(t))),a=i.courts.reduce(((t,e)=>(e.dateAvailability.forEach((({date:e})=>{t.includes(e)||t.push(e)})),t)),[]).filter((t=>!n.length||n.includes(t))),o={venueIds:r.map((({venueId:t})=>t))},{matchUps:s}=Xo({tournamentRecords:t,matchUpFilters:o});return{venuesReport:r.map((t=>function(t,e,n){const{venueId:i,courts:r,venueName:a}=e,o={};return t.forEach((t=>{let e=0,a=0,s=0;for(const n of r){const i=n.dateAvailability.find((e=>e.date===t)),r=i&&no({courtDate:i}),a=null==r?void 0:r.reduce(((t,e)=>{const{startTime:n,endTime:i}=e;return t+(Rt(i)-Rt(n))}),0);a&&(s+=1),e+=a}const c=n.filter((({schedule:e})=>e.venueId===i&&Gt(t,e.scheduledDate)));c.forEach((({schedule:t})=>{const e=Ot(t.scheduledTime),n=Rt(Bt(e,t.averageMinutes))-Rt(e);a+=n}));const u=e?(a/e*100).toFixed(2):"100";o[t]={scheduledMatchUpsCount:c.length,availableCourts:s,availableMinutes:e,scheduledMinutes:a,percentUtilization:u}})),{venueId:i,venueName:a,venueReport:o}}(a,t,s)))}},credits:Zu};function ed({convertExtensions:t,removeExtensions:e}){const n=pt();return{tournamentId:dt(),tournamentRecords:Ht(n,t,!1,e)}}function nd(){var t;const e=pt(),{extension:n}=Wo({tournamentRecords:e,name:"linkedTournamentsIds"}),i=(null==n||null===(t=n.value)||void 0===t?void 0:t.tournamentIds)||[];return Object.keys(e).forEach((t=>{i.includes(t)||delete e[t]})),ft(e)}function id(t,e=!0){return"object"!=typeof t||Array.isArray(t)?{error:"Invalid object"}:null!=t&&t.tournamentId?mt(e?Ht(t):t):{error:$}}function rd(t,e=!0){var n;if("object"!=typeof t)return{error:"Invalid object"};if(Array.isArray(t)){if(t.filter((t=>null==t?void 0:t.tournamentId)).length!==t.length)return{error:V};t=Object.assign({},...t.map((t=>({[t.tournamentId]:t}))))}else if(null!==(n=t)&&void 0!==n&&n.tournamentId)t={[t.tournamentId]:t};else if(!Object.keys(t).every((e=>t[e].tournamentId===e)))return{error:V};return ft(e?Ht(t):t)}const ad=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>ed({convertExtensions:t,removeExtensions:e}),version:()=>"0.117.10",reset:()=>(ft({}),e())};return[Zc,Ju,td,Ku].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{if(et())return i(e[n],t,n);try{return i(e[n],t,n)}catch(e){const r=e.toString();console.log("ERROR",{error:r,methodName:n,params:JSON.stringify(t)}),console.log(e)}}}))})),t.devContext=t=>(nt(t),e()),t.getDevContext=t=>et(t),t.setState=(t,n,i)=>(rt(n,i),e(rd(t,n))),t.setTournamentRecord=(t,n,i)=>(rt(n,i),e(id(t,n))),t.removeTournamentRecord=t=>e(vt(t)),t.removeUnlinkedTournamentRecords=()=>e(nd()),t.executionQueue=(e,i)=>function(e,i){if(!Array.isArray(e))return{error:$};const r=pt(),a=i&&Ht(r,!1,!0),o=[];for(const s of e){if("object"!=typeof s)return{error:$};const{method:e,params:i}=s;if(!t[e])return{error:"Method not found"};const c=n(r,t[e],i,e);if(null!=c&&c.error)return a&&rd(a),{...c,rolledBack:!!a};o.push(c)}return Qc(),st(),{results:o}}(e,i),t;function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function n(e,n,i,r){delete t.success,delete t.error;const a=Date.now(),o=n({tournamentRecords:e,...i}),s=Date.now()-a,c=et();return c.perf&&(isNaN(c.perf)||s>c.perf)&&console.log("ce:",{methodName:r,elapsed:s}),c.params&&console.log({params:i}),o}function i(t,e,i){const r=pt(),a=(null==e?void 0:e.rollbackOnError)&&Ht(r,!1,!0),o=n(r,t,e,i);null!=o&&o.error&&a&&rd(a);const s=(null==o?void 0:o.success)&&!0!==(null==e?void 0:e.delayNotify)&&!0!==(null==e?void 0:e.doNotNotify);return s&&Qc(),(s||null==o||!o.success||null!=e&&e.doNotNotify)&&st(),o}}();const od=({finishingPosition:t="ROUND_OUTCOME",structureAbbreviation:e,seedAssignments:n=[],stageSequence:i=1,qualifyingRoundNumber:r,seedingProfile:a,matchUpFormat:o,structureType:s,structureName:c,matchUps:u=[],structureId:d,exitProfile:l,roundOffset:p,roundLimit:m,stageOrder:f,structures:h,stage:v})=>{const I={structureId:d||Yt(),structureAbbreviation:e,finishingPosition:t,seedAssignments:n,matchUpFormat:o,stageSequence:i,structureName:c};v&&(I.stage=v),f&&(I.stageOrder=f),m&&(I.roundLimit=m),p&&(I.roundOffset=p),s&&(I.structureType=s),a&&(I.seedingProfile=a),r&&(I.qualifyingRoundNumber=r),l&&(I.exitProfile=l);const g=[].concat(...u.map((t=>t.drawPositions))).filter(Boolean);return h?I.structures=h:(I.matchUps=u,I.positionAssignments=T(g).sort(((t,e)=>t-e)).map((t=>({drawPosition:t})))),I};function sd({finishingPositionOffset:t=0,positionsFed:e,roundsCount:n,roundLimit:i,matchUps:r,lucky:a,fmlc:o}){const{roundProfile:s,roundNumbers:c}=_i({matchUps:r}),u=Object.values(s).map((({matchUpsCount:t})=>t)),d=t=>[Math.min(...t),Math.max(...t)],l=i?n-i:0,p=Object.assign({},...c.map((i=>{const r=n+1-i-l,c=s[i].matchUpsCount,p={finishingRound:r},m=u.slice(i-1).reduce(((t,e)=>t+e),0),f=1+t+(o&&1!==i?e:0),h=O(f,a?f+2*c:m+f+1),v=m+1-c,I=d(h.slice(v)),g=d(h.slice(0,v));return p.finishingPositionRange={loser:I,winner:g},{[i]:p}})));return r.forEach((t=>{const e=p[t.roundNumber];t.finishingRound=e.finishingRound,t.finishingPositionRange=e.finishingPositionRange})),r}function cd({idPrefix:t,roundNumber:e,roundPosition:n,uuids:i}){return t?`${t}-${e}-${n}`:(null==i?void 0:i.pop())||Yt()}function ud({includeMatchUpType:t,drawPosition:e,matchUpType:n,roundNumber:i,idPrefix:r,matchUps:a,uuids:o,nodes:s,fed:c}){const u=s.length,d=e?e-u:void 0,l=O(0,u).map((t=>d?d+t:void 0)),p=[];for(let m=0;m<u;m++){const e=l.shift(),u={feed:!0,fed:c+1,drawPosition:e},d=s[m];d.roundNumber=i-1;const f={roundNumber:i,matchUpId:cd({roundPosition:d.roundPosition,roundNumber:i,idPrefix:r,uuids:o}),roundPosition:d.roundPosition,drawPositions:[void 0,e]};t&&(f.matchUpType=n),a.push(f);const h={children:[d,u]};p.push(h)}return{roundNodes:p,matchUps:a,drawPosition:e?e-u:void 0}}function dd({includeMatchUpType:t,matchUpType:e,roundNumber:n,matchUps:i,idPrefix:r,isMock:a,uuids:o,nodes:s}){let c=0;const u=[];let d=1;const l=n-1,p=s.length;for(;c<p;){const p=s[c],m=s[c+1];l&&(p.roundNumber=l),m&&l&&(m.roundNumber=l);const f={roundPosition:d,children:[p,m],matchUpId:cd({roundPosition:d,roundNumber:n,idPrefix:r,uuids:o})};u.push(f);const h={matchUpId:f.matchUpId,roundNumber:n,roundPosition:d,matchUpStatus:le,drawPositions:f.children.map((t=>t.drawPosition)).filter(Boolean)};t&&(h.matchUpType=e),a&&(h.isMock=!0),i.push(h),d++,c+=2}return{roundNodes:u,matchUps:i}}function ld({linkFedFinishingRoundNumbers:t=[],linkFedRoundNumbers:e=[],finishingPositionOffset:n,feedRoundsProfile:i=[],feedRounds:r=0,skipRounds:a=0,feedsFromFinal:o,isConsolation:s,baseDrawSize:c,matchUpType:u,idPrefix:d,drawSize:l,isMock:p,uuids:m,fmlc:f}){const h=function({drawSize:t}){return O(0,Math.ceil(Math.log(t)/Math.log(2))).reverse().map((t=>Math.pow(2,t)))}({drawSize:c=c||function(t){const e=g(t);return e>t?e/2:e}(l)}),v=h.length;let I=0;if(i.length)I=i.reduce(((t,e)=>t+e),0);else if(l){let t=l-c;i=h.filter((e=>e<=t&&(t-=e,!0))),I=i.reduce(((t,e)=>t+e),0),r=i.length}else a>=v&&(r=0),o&&(r=v-o,a=0),i=h.filter(((t,e)=>o&&!r||r&&e>=a+r||e<a?0:t)),I=i.reduce(((t,e)=>t+e),0),l=c+I,r=i.length;const U=[...h,...i].sort(((t,e)=>e-t)),y=U.length,S=[...e.map((t=>t-1)),...t.map((t=>y-t))].map((t=>U[t])).reduce(((t,e)=>t+e),0);I-=S;let w,N=0,D=[],P=1,T=O(0,c).map(((t,e)=>({drawPosition:e+1+I}))),M=I+1;for(const g of h){if(({roundNodes:w,matchUps:D}=dd({roundNumber:P,matchUpType:u,idPrefix:d,matchUps:D,isMock:p,nodes:T,uuids:m})),P++,i.includes(g)){const n=O(0,A(i)[g]),r=y+1-P,a=t.includes(r)||e.includes(P);for(const t of n){const e=!a&&M||void 0;({roundNodes:w,matchUps:D,drawPosition:M}=ud({drawPosition:e,nodes:w,roundIteration:t,roundNumber:P,matchUpType:u,idPrefix:d,matchUps:D,uuids:m,fed:N})),P++,N+=1}}T=w}y!==P-1&&console.log("ERROR"),D=sd({finishingPositionOffset:s?c-I:n,positionsFed:I,roundsCount:y,matchUps:D,fmlc:f});const E=w&&w.length?w[0]:w;return E&&(E.roundNumber=P-1,E.matchUps=D),{draw:E,matchUps:D,roundsCount:y}}function pd({qualifyingRoundNumber:t,finishingPositionOffset:e,qualifyingPositions:n,matchUpType:i,roundLimit:r,idPrefix:a,drawSize:o,isMock:s,uuids:c}){if(isNaN(o)||!I(o)||o<2)return{matchUps:[],roundsCount:0};const u=O(1,parseInt(o)+1).map((t=>({drawPosition:t})));let d,l=[],p=1;for(({roundNodes:d,matchUps:l}=dd({roundNumber:p,matchUpType:i,idPrefix:a,matchUps:l,isMock:s,nodes:u,uuids:c})),p++,r=r||t;d.length>1;)n&&d.length===n&&(r=p-1),({roundNodes:d,matchUps:l}=dd({nodes:d,roundNumber:p,matchUpType:i,idPrefix:a,matchUps:l,isMock:s,uuids:c})),p++;const m=p-1;return l=sd({finishingPositionOffset:e,roundsCount:m,roundLimit:r,matchUps:l}),r&&(l=l.filter((t=>t.roundNumber<=r))),{matchUps:l,roundsCount:m,roundLimit:r}}function md(t){var e;const{matchUps:n,structures:i,structureId:r,links:a}=fd(t);null!=a&&a.length&&t.drawDefinition.links.push(...a),null!=i&&i.length&&t.drawDefinition.structures.push(...i);const o=(null==i?void 0:i.map((({structureId:t})=>t)))||[];return t.drawDefinition.structures.sort(fr),Ca({tournamentId:null===(e=t.tournamentRecord)||void 0===e?void 0:e.tournamentId,drawDefinition:t.drawDefinition,matchUps:n}),xa({drawDefinition:t.drawDefinition,structureIds:o}),Object.assign({structureId:r},B)}function fd({finishingPositionOffset:t=0,addNameBaseToAttributeName:e,playoffStructureNameBase:n,finishingPositionNaming:i,finishingPositionLimit:r,playoffAttributes:a,stageSequence:o=1,exitProfile:s="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:l,staggeredEntry:p,sequenceLimit:m,stage:f=Vi,matchUpType:h,idPrefix:v,drawSize:I,isMock:g,uuids:U}){if(a&&c&&(!a||!a[s])||I<2||m&&o>m)return{};const y=[],S=[],w=[];h=h||(null==l?void 0:l.matchUpType);const N=t+1,D=`${N}-${t+I}`,P=a&&a[s],T=n&&`${n} `||"",M=i&&i[D],A=(null==M?void 0:M.name)||(null==P?void 0:P.name)&&(e?`${T}${null==P?void 0:P.name}`:P.name)||`${T}${D}`,E=(null==M?void 0:M.abbreviation)||(null==P?void 0:P.abbreviation),b={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:t,matchUpType:h,drawSize:I,isMock:g,uuids:U},{matchUps:R}=p?ld(b):pd(b),C=od({structureId:null==U?void 0:U.pop(),structureAbbreviation:E,stageSequence:o,structureName:A,matchUpType:h,roundOffset:d,exitProfile:s,matchUps:R,stage:f});y.push(...R),S.push(C);const L=Math.ceil(Math.log(I)/Math.log(2));return O(1,(u?Math.min(u-d,L):!r||N<r?L:0)+1).forEach((p=>function(p){const g=I/Math.pow(2,p);if(g<2)return;const N=I/Math.pow(2,p)+t;if(N+1>r)return;const{structures:D,structureId:P,structureName:T,matchUps:M,links:E}=fd({finishingPositionOffset:N,exitProfile:`${s}-${p}`,roundOffset:d+p,stageSequence:o+1,drawSize:g,addNameBaseToAttributeName:e,playoffStructureNameBase:n,finishingPositionNaming:i,finishingPositionLimit:r,playoffAttributes:a,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:l,sequenceLimit:m,matchUpType:h,idPrefix:v,uuids:U,stage:f}),b={linkType:$i,source:{roundNumber:p,structureName:A,structureId:null==C?void 0:C.structureId},target:{roundNumber:1,feedProfile:Yi,structureName:T,structureId:P}};return C&&P&&E.push(b),null!=E&&E.length&&w.push(...E),null!=D&&D.length&&S.push(...D),null!=M&&M.length&&y.push(...M),{structureId:P,childLinks:E,structures:S}}(p))),{structureId:C.structureId,matchUps:y,structureName:A,structures:S,links:w}}function hd({drawDefinition:t,structureId:e}){const{structure:n,error:i}=hr({drawDefinition:t,structureId:e});if(i)return{error:i};const{matchUps:r}=oa({structure:n});return _i({matchUps:r})}function vd({drawDefinition:t,structureId:e,finishingPositions:n}){const{roundProfile:i}=hd({drawDefinition:t,structureId:e});return Object.keys(i).reduce(((t,e)=>(Id(i[e]).forEach((i=>{n.forEach((n=>{(function({position:t,rangeDefinition:e}){if(!Array.isArray(e))return!1;if(e.reduce(((t,e)=>t||isNaN(e)),!1))return!1;const[n,i]=e;return O(n,(i||n)+1).includes(t)})({position:n,rangeDefinition:i})&&(t[n]={roundNumber:e})}))})),t)),{})}function Id(t){var e,n;return[T((null==t||null===(e=t.finishingPositionRange)||void 0===e?void 0:e.loser)||[]),T((null==t||null===(n=t.finishingPositionRange)||void 0===n?void 0:n.winner)||[])]}function gd({drawDefinition:t}){if(!t)return{error:q};const e=(t.structures||[]).filter((t=>t.structureType!==Gi)).map((({structureId:e})=>{const{roundProfile:n}=hd({drawDefinition:t,structureId:e});return Object.values(n).map(Id).flat()})).flat(),n=e.filter((t=>1===t.length)).sort(Kt).flat(),i=e.flat();return{positionsNotPlayedOff:O(Math.min(...i),Math.max(...i)+1).filter((t=>!n.includes(t))),positionsPlayedOff:n}}function Ud({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:n,structureId:i}){if(!n)return{error:q};if(!i)return{error:"Missing structureId"};if(!e)return{error:z,message:"missing playoffPositions"};const{positionsPlayedOff:r,error:a}=gd({drawDefinition:n});if(a)return{error:a};const o=vd({finishingPositions:e.filter((t=>!r.includes(t))),drawDefinition:n,structureId:i}),s=Object.values(o).reduce(((t,e)=>t.includes(e.roundNumber)?t:t.concat(e.roundNumber)),[]).map((t=>parseInt(t))).filter((e=>!t.includes(parseInt(e)))),c=vd({drawDefinition:n,structureId:i,finishingPositions:r}),u=Object.values(c).reduce(((t,e)=>t.includes(e.roundNumber)?t:t.concat(e.roundNumber)),[]).map((t=>parseInt(t))),d=s.filter((t=>!u.includes(t))).sort(Kt),{roundProfile:l}=hd({drawDefinition:n,structureId:i}),p=d.map((t=>{const e=l[t].finishingPositionRange.loser,[n,i]=e;return O(n,(i||n)+1)})).flat().sort(Kt),m=d.map((t=>{const e=l[t].finishingPositionRange.loser,[n,i]=e;return{roundNumber:t,finishingPositions:O(n,(i||n)+1),finishingPositionRange:e.join("-")}}));return{sourceRounds:[...d,...u],playoffRoundsRanges:m,playoffSourceRounds:d,playedOffSourceRounds:u,playoffPositionsReturned:p}}function yd({drawDefinition:t,structureId:e}){if(!t)return{error:q};let{structures:n}=vr({stageSeqence:1,drawDefinition:t,stage:Vi});const{positionsNotPlayedOff:i,positionsPlayedOff:r}=gd({drawDefinition:t});({structures:n}=vr({drawDefinition:t}));const a=n.filter((t=>!e||t.structureId===e)),o={};for(const s of a){const e=null==s?void 0:s.structureId,{playoffSourceRounds:n,playoffRoundsRanges:r,error:a}=Sd({playoffPositions:i,drawDefinition:t,structure:s});if(a)return{error:a};o[e]={playoffRoundsRanges:r,playoffRounds:n,structureId:e}}return e?{positionsPlayedOff:r,...o[e]}:{positionsPlayedOff:r,availablePlayoffRounds:Object.values(o)}}function Sd({playoffPositions:t,drawDefinition:e,structure:n}){var i;if(n.structureType===Ki)return{playoffSourceRounds:[],playoffRoundsRanges:[]};const r=null==n?void 0:n.structureId,{links:a}=fa({drawDefinition:e,structureId:r});return Ud({excludeRoundNumbers:(null==a||null===(i=a.source)||void 0===i?void 0:i.filter((t=>"FIRST_MATCHUP"!==t.linkCondition)).map((t=>{var e;return null===(e=t.source)||void 0===e?void 0:e.roundNumber})))||[],playoffPositions:t,drawDefinition:e,structureId:r})}function wd({tieFormat:t,uuids:e,isMock:n}){const{collectionDefinitions:i}=t||{};return{tieMatchUps:(i||[]).map((t=>{const{matchUpCount:i,matchUpFormat:r,matchUpType:a,collectionId:o}=t||{};return O(0,i||0).map((t=>{const i=t+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:(null==e?void 0:e.pop())||Yt(),collectionPosition:i,matchUpFormat:r,collectionId:o,matchUpType:a,isMock:n}}))})).filter(Boolean).flat()}}function Nd(t){var e;if(!t.drawDefinition)return{error:q};const{playoffRoundsRanges:n,playoffRounds:i,error:r}=yd(t);if(r)return{error:r};const{playoffSourceRounds:a,playoffRoundsRanges:o,playoffPositionsReturned:s,error:c}=Ud(t);if(c)return{error:c};const{structureId:u,addNameBaseToAttributeName:d,playoffStructureNameBase:l,tournamentRecord:p,playoffAttributes:m,playoffPositions:f,exitProfileLimit:h,roundProfiles:v,roundNumbers:I,idPrefix:g,isMock:U,event:y,uuids:S}=t,w=Ht(t.drawDefinition,!1,!0),N=(null==v?void 0:v.length)&&Object.assign({},...v),D=I||"object"==typeof v&&v.map((t=>Object.keys(t))).flat(),P=D&&D.map((t=>!isNaN(t)&&parseInt(t))).filter(Boolean);if(P){if(!Array.isArray(P))return{error:$,validRoundNumbers:P};P.forEach((t=>{if(!i.includes(t))return{error:$,roundNumber:t}}))}f&&f.forEach((t=>{if(!s.includes(t))return{error:$,playoffPosition:t}}));const{structure:T}=hr({structureId:u,drawDefinition:w}),M=P||a,A=P?n:o,E=[],b=[];for(const x of M){const t=A.find((t=>t.roundNumber===x));if(!t)return{error:$,message:{roundNumber:x}};const e=t.finishingPositions.length,n=Math.min(...t.finishingPositions)-1,i=2,r=N&&N[x]&&i+N[x]-1,a=fd({exitProfile:`0-${x}`,addNameBaseToAttributeName:d,playoffStructureNameBase:l,finishingPositionOffset:n,playoffAttributes:m,exitProfileLimit:h,stage:Hi,drawDefinition:w,roundOffset:0,sequenceLimit:r,stageSequence:i,drawSize:e,idPrefix:g,isMock:U,uuids:S});if(a.error)return a;const{structures:o,links:s}=a;if(null!=o&&o.length&&E.push(...o),null!=s&&s.length&&b.push(...s),a.structureId){const t={linkType:$i,source:{structureId:u,roundNumber:x},target:{structureId:a.structureId,feedProfile:Yi,roundNumber:1}};b.push(t)}}if(!E.length)return{error:$};w.structures.push(...E),w.links.push(...b);const{matchUps:R,matchUpsMap:C}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:w}),O=E.map((({structureId:t})=>t)),L=R.filter((({structureId:t})=>O.includes(t))).map(Fi),F=null==C||null===(e=C.drawMatchUps)||void 0===e?void 0:e.filter((({matchUpId:t})=>L.includes(t)));if(F.length){const t=w.tieFormat||(null==y?void 0:y.tieFormat)||void 0;t&&F.forEach((e=>{const{tieMatchUps:n}=wd({tieFormat:t,isMock:U});Object.assign(e,{tieMatchUps:n,matchUpType:Zt})}))}return R.filter((t=>Ee(t)&&t.structureId===u)).forEach((t=>{const{matchUpId:e,score:n,winningSide:i}=t,r=ha({inContextDrawMatchUps:R,drawDefinition:w,matchUpId:e,structure:T}),a=Js({inContextDrawMatchUps:R,tournamentRecord:p,drawDefinition:w,matchUpsMap:C,winningSide:i,targetData:r,matchUpId:e,structure:T,matchUp:t,score:n});a.error&&console.log(a.error)})),t.goesTo&&xo({inContextDrawMatchUps:R,drawDefinition:w,matchUpsMap:C}),{structures:E,links:b,...B}}function Dd({policyAttributes:t,idCollections:e,participants:n,participant:i}){if(!Array.isArray(t))return{error:"Missing policy attributes"};if(!i)return{error:"Missing participant"};const r=[];return t.forEach((t=>{const{directive:o,groupings:s,key:c,significantCharacters:u}=t||{};if(c){const t=c.split(".");a({value:i,keys:t,significantCharacters:u})}else if(o){const a=null==t?void 0:t.includeIds,s=(e&&e[o]||[]).filter((t=>!a||a.includes(t)));null!=s&&s.length&&null!=n&&n.length&&s.forEach((t=>{var e;const a=n.find((e=>e.participantId===t));if(null!=a&&null!==(e=a.individualParticipantIds)&&void 0!==e&&e.includes(i.participantId)){const t=null==a?void 0:a.participantId;r.push(t)}}))}else s&&Object.keys(s).forEach((t=>{s[t].includes(i.participantId)&&r.push(t)}))})),{values:T(r)};function a({value:t,keys:e=[],significantCharacters:n}){for(const[r,o]of e.entries())if(t&&t[o])if(Array.isArray(t[o])){const i=t[o],s=e.slice(r);i.forEach((t=>a({value:t,keys:s,significantCharacters:n})))}else i({value:t=t[o],index:r});function i({value:t,index:i}){if(t&&i===e.length-1&&["string","number"].includes(typeof t)){const e=n?t.slice(0,n):t;r.push(e)}}}}function Pd({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:n,idCollections:i}){const r=Object.assign({},...e.map((t=>({[t.participantId]:t}))));return t.map((t=>{const a=r[t.participantId],{values:o}=Dd({participants:e,policyAttributes:n,idCollections:i,participant:a});return{...t,values:o}}))}function Td({participantIdGroups:t,positionAssignments:e,groupsToAvoid:n}){return Object.assign({},...e.filter((t=>null==t?void 0:t.participantId)).map((e=>{const{drawPosition:i,participantId:r}=e,a=t&&t[r]||[],o=!!n.some((t=>a.includes(t)));return{[i]:{participantGroups:a,includesGroupsToAvoid:o}}})))}function Md(t){return t%2?t+1:t-1}function Ad({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:n,drawPositionChunks:i,unfilledPositions:r,isRoundRobin:a}){const o=i.map((i=>a?function(t){const{unfilledPositions:e,chunkedDrawPositions:n}=t,i=Td(t);return n.map((t=>{const n=e.filter((e=>t.includes(e))),r=n.length===t.length?n:[],a=t.filter((t=>{var e;return null===(e=i[t])||void 0===e?void 0:e.includesGroupsToAvoid})).length;return{unassigned:n,unpaired:r,pairedNoConflict:a?[]:n,conflictsCount:a}}))}({groupsToAvoid:t,chunkedDrawPositions:i,participantIdGroups:e,positionAssignments:n,unfilledPositions:r}):function(t){const{unfilledPositions:e,chunkedDrawPositions:n}=t,i=Td(t);return n.map((t=>{const n=e.filter((e=>t.includes(e))),r=function(t){return t.filter((t=>!e(t)));function e(e){const n=Md(e);return!t.includes(n)}}(n),a=n.filter((t=>!r.includes(t))).filter((t=>{var e;const n=Md(t);return!(null!==(e=i[n])&&void 0!==e&&e.includesGroupsToAvoid)}));return{unassigned:n,unpaired:r,pairedNoConflict:a}}))}({groupsToAvoid:t,chunkedDrawPositions:i,participantIdGroups:e,positionAssignments:n,unfilledPositions:r})));return a?{unassigned:o.map((t=>t.map((t=>t.unassigned)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)).sort(((t,e)=>(e.length||0)-(t.length||0))),unpaired:o.map((t=>t.map((t=>t.unpaired)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),pairedNoConflict:o.map((t=>t.map((t=>t.pairedNoConflict)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)).sort(((t,e)=>(e.length||0)-(t.length||0)))}:{unassigned:o.map((t=>t.map((t=>t.unassigned)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),unpaired:o.map((t=>t.map((t=>t.unpaired)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length)),pairedNoConflict:o.map((t=>t.map((t=>t.pairedNoConflict)).filter((t=>null==t?void 0:t.length)))).filter((t=>null==t?void 0:t.length))}}function Ed({participantIds:t,positionAssignments:e}){const n=e.map((t=>t.participantId));return t.filter((t=>!n.includes(t)))}function bd({drawPositions:t}){const e=[].concat(...t.map((e=>t.filter((t=>t!==e)).map((t=>[e,t]))))),n=T(e.map(Rd)).map((t=>t.split("|").map((t=>+t))));return{groupMatchUps:e,uniqueMatchUpGroupings:n}}function Rd(t){return t.sort(Kt).join("|")}function Cd({isRoundRobin:t,groupedParticipants:e}){const n=[];return t?e.forEach((t=>{const e=t.map((t=>t.drawPosition)),{uniqueMatchUpGroupings:i}=bd({drawPositions:e}),r=Object.assign({},...t.map((t=>({[t.drawPosition]:t}))));i.forEach((e=>{x(r[e[0]].values||[],r[e[1]].values||[])&&(n.push(e),t.conflict=!0)}))})):e.forEach((t=>{x(t[0].values||[],t[1].values||[])&&(n.push(t),t.conflict=!0)})),n}function Od({isRoundRobin:t,avoidanceConflicts:e,drawPositionGroups:n,positionedParticipants:i,potentialDrawPositions:r}){return e.map((e=>{const a=e.map((t=>t.drawPosition));return e.filter((t=>r.includes(t.drawPosition))).map((e=>{const o=r.filter((t=>!a.includes(t))).filter((r=>{const a=n.find((t=>t.includes(r))).find((t=>t!==r)),o=i.find((t=>t.drawPosition===a)),s=Cd({isRoundRobin:t,groupedParticipants:[[e,o]]}),c=i.find((t=>t.drawPosition===r)),u=Cd({isRoundRobin:t,groupedParticipants:[[c,o]]});return!s.length&&!u.length}));if(o.length)return{drawPosition:e.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function Ld(t){const{initialPositionAssignments:e,participantsWithGroupings:n,opponentsToPlaceCount:i,drawPositionGroups:r,policyAttributes:a,idCollections:o,allGroups:s}=t,c=[];let u;const d=Math.min(...(r||[]).map((t=>null==t?void 0:t.length)).filter(Boolean)),l=d>2,p=Ht(e,!1,!0),m=e.filter((t=>!t.participantId)).map((t=>t.drawPosition));O(0,i).forEach((()=>{const{newGroupKey:e,selectedParticipantId:n,targetDrawPosition:i}=function({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:n,drawPositionChunks:i,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){const c=r.reduce(((t,e)=>e.length>t?e.length:t),0),u=!!(c>2),d=Ed({participantIds:e,positionAssignments:t}),l=function({drawPositionGroups:t,positionAssignments:e}){const n=Object.assign({},...e.map((t=>({[t.drawPosition]:t}))));return t.map((t=>t.filter(Boolean).map((t=>n[t])).filter((t=>!t.participantId&&!t.bye)).map((t=>t.drawPosition)))).flat().filter(Boolean)}({drawPositionGroups:r,positionAssignments:t}),{participantId:p,groupKey:m}=function({groupKey:t,allGroups:e,largestFirst:n=!0,targetParticipantIds:i,useSpecifiedGroupKey:r=!1}){var a;const o=Object.assign({},...Object.keys(e).map((t=>[t,e[t].filter((t=>i.includes(t)))])).filter((t=>t[1].length)).map((([t,e])=>({[t]:e})))),s=Object.keys(o).reduce(((t,e)=>o[e].length>t?o[e].length:t),0),c=Object.keys(o).filter((t=>o[t].length===s)),u=C(n?c:Object.keys(o));return{participantId:(t=r&&null!==(a=o[t])&&void 0!==a&&a.length?t:u)&&o[t]?C(o[t]):C(i),groupKey:t}}({groupKey:s,allGroups:o,targetParticipantIds:d,useSpecifiedGroupKey:u}),f=function({allGroups:t,participantId:e}){return Object.keys(t).filter((n=>t[n].includes(e)))}({allGroups:o,participantId:p}),h=Ad({positionAssignments:t,isRoundRobin:u,selectedParticipantGroups:f,participantIdGroups:n,drawPositionChunks:i,unfilledPositions:l,largestGroupSize:c,allGroups:o}),{unassigned:v,unpaired:I,pairedNoConflict:g}=h,U=(null==g?void 0:g.length)&&g[0],y=(null==I?void 0:I.length)&&I[0],S=a&&U?U:y,w=a?y:U,N=(null==S?void 0:S.length)&&S||(null==w?void 0:w.length)&&w;let D;if(null!=N&&N.length){const t=R(N);D=R(t)}else{const t=R(v[0]);D=R(t)}return{newGroupKey:m,selectedParticipantId:p,targetDrawPosition:D}}({...t,groupKey:u,allGroups:s,candidatePositionAssignments:p});u=e,p.forEach((t=>{t.drawPosition===i&&(t.participantId=n)}))}));let f=Pd({candidatePositionAssignments:p,participantsWithGroupings:n,policyAttributes:a,idCollections:o}),h=k(f,d),v=Cd({groupedParticipants:h,isRoundRobin:l}),I=0;for(;I<20&&v.length;){const t=Od({positionedParticipants:f,potentialDrawPositions:m,avoidanceConflicts:v,drawPositionGroups:r,isRoundRobin:l});t.length?(Fd({candidatePositionAssignments:p,swapOptions:t}),f=Pd({candidatePositionAssignments:p,participantsWithGroupings:n,policyAttributes:a,idCollections:o}),h=k(f,d),v=Cd({isRoundRobin:l,groupedParticipants:h}),I++):I=20}return p.forEach((t=>{t.bye&&t.participantId&&c.push({error:"Invalid Assignment",assignment:t})})),{positionAssignments:p,conflicts:v.length,groupedParticipants:h,errors:c}}function Fd({candidatePositionAssignments:t,swapOptions:e}){const n=R(e);if(!n)return{error:"No swap options"};const i=n.drawPosition,r=R(n.possibleDrawPositions),a=t.find((t=>t.drawPosition===i)).participantId,o=t.find((t=>t.drawPosition===r)).participantId;return t.forEach((t=>{t.drawPosition===i&&(t.participantId=o),t.drawPosition===r&&(t.participantId=a)})),B}function xd({unseededParticipantIds:t,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:i,participants:r,matchUpsMap:a,structureId:o,avoidance:s,entries:c,event:u}){if(!s)return{error:"Missing avoidance policy"};const{policyAttributes:d,roundsToSeparate:l,candidatesCount:p=1}=s,{structure:m}=hr({drawDefinition:i,structureId:o}),{matchUps:f}=oa({matchUpsMap:a,structure:m,event:u}),{positionAssignments:h}=Xr({structure:m}),v=sa({participants:r}),I=h.filter((t=>!t.participantId)),U=h.map((t=>t.drawPosition)),y=m.structureType===Ki,S=y?{structure:m,matchUps:f,allDrawPositions:U,roundsToSeparate:l}:{matchUps:f,allDrawPositions:U,roundsToSeparate:l},{drawPositionGroups:w,drawPositionChunks:N}=y?function(t){const{structure:{structures:e}}=t,n=e.map((t=>t.positionAssignments.map((t=>t.drawPosition))));return{drawPositionGroups:n,drawPositionChunks:[n]}}(S):function({matchUps:t,allDrawPositions:e,roundsToSeparate:n}){const i=t.filter((t=>1===t.roundNumber)).map((t=>t.drawPositions)),r=i.flat().sort(Kt),a=Math.max(...r),o=e.filter((t=>t>a)),s=O(2,r.length).filter((t=>t===g(t))),c=s.slice(0,n||s.length).reverse().map((t=>k(r,t)));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:i,drawPositionChunks:c}}(S),D={};D.groupParticipants=r.filter((t=>t.participantType===Ti)).map((t=>t.participantId)),D.teamParticipants=r.filter((t=>t.participantType===Di)).map((t=>t.participantId)),D.pairParticipants=r.filter((t=>t.participantType===Pi)).map((t=>t.participantId));const P=function({targetParticipantIds:t,policyAttributes:e,idCollections:n,participants:i}){if(!Array.isArray(e))return{error:"Missing policy attributes"};if(!Array.isArray(i))return{error:"Missing participants"};const r={};return t.forEach((t=>{const a=i.find((e=>e.participantId===t)),{values:o}=Dd({policyAttributes:e,idCollections:n,participants:i,participant:a});o&&o.forEach((e=>{r[e]||(r[e]=[]),r[e].includes(t)||r[e].push(t)}))})),r}({targetParticipantIds:t,policyAttributes:d,idCollections:D,participants:r}),T=Object.assign({},...t.map((t=>{const e=Object.keys(P).filter((e=>P[e].includes(t)));return{[t]:e}}))),M=Ed({participantIds:t,positionAssignments:h});if(M.length>I.length)return{error:"More participantIds than unpaired positions"};let A;const E=[],b=M.length,R=O(0,p).map((()=>Ld({initialPositionAssignments:h,participantsWithGroupings:v,unseededParticipantIds:t,opponentsToPlaceCount:b,pairedPriority:!1,participantIdGroups:T,drawPositionChunks:N,drawPositionGroups:w,policyAttributes:d,idCollections:D,allGroups:P})));if(A=R.reduce(((t,e)=>!t||(e.conflicts||0)<(t.conflicts||0)?e:t),void 0),!A||A.conflicts){const e=O(0,p).map((()=>Ld({initialPositionAssignments:h,participantsWithGroupings:v,unseededParticipantIds:t,opponentsToPlaceCount:b,pairedPriority:!0,participantIdGroups:T,drawPositionChunks:N,drawPositionGroups:w,policyAttributes:d,idCollections:D,allGroups:P,entries:c})));A=R.concat(...e).filter((t=>{var e;return!(null!==(e=t.errors)&&void 0!==e&&e.length)})).reduce(((t,e)=>!t||(e.conflicts||0)<(t.conflicts||0)?e:t),void 0)}if(!A)return{error:"Could not produce candidate"};const C=(m.positionAssignments||[]).filter((t=>t.participantId)).map((t=>t.participantId));return A.positionAssignments.filter((t=>!C.includes(t.participantId))).forEach((t=>{if(t.participantId&&!t.bye){const r=$s({automaticPlacement:!0,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:i,structureId:o,matchUpsMap:a,...t});null!=r&&r.success||E.push(r)}})),E.length?{error:E,conflicts:A.conflicts}:Object.assign({positionAssignments:A.positionAssignments,conflicts:A.conflicts},B)}function kd({orderedSeedDrawPositions:t,relevantMatchUps:e}){const n=e.map((t=>t.drawPositions)).map((t=>null==t?void 0:t.sort(((t,e)=>t-e)))).filter((t=>(null==t?void 0:t[0])+1===(null==t?void 0:t[1])));return t.map((t=>n.find((e=>null==e?void 0:e.includes(t))))).filter(Boolean).map((e=>null==e?void 0:e.reduce(((e,n)=>t.includes(n)?e:n),void 0))).filter(Boolean)}function _d({drawDefinition:t,stageSequence:e,structureId:n,stage:i}){var r,a,o,s,c;if(!t)return{error:q};const{structure:u}=hr({drawDefinition:t,structureId:n}),d=null===(r=t.links)||void 0===r?void 0:r.find((t=>{var e,n;return"POSITION"!==(null==t?void 0:t.linkType)&&(null==t||null===(e=t.target)||void 0===e?void 0:e.structureId)===(null==u?void 0:u.structureId)&&1===(null==t||null===(n=t.target)||void 0===n?void 0:n.roundNumber)}));if(d&&u.stage===Gi){var l;const e=null===(l=hr({structureId:d.source.structureId,drawDefinition:t}))||void 0===l?void 0:l.structure,n=oa({roundFilter:d.source.roundNumber,structure:e,inContext:!1}).matchUps;if(null!=n&&n.length)return n.length}const{entryProfile:p}=Tr({drawDefinition:t});return(null==p||null===(a=p[i])||void 0===a||null===(o=a.stageSequence)||void 0===o||null===(s=o[e])||void 0===s?void 0:s.qualifiersCount)||(null==p||null===(c=p[i])||void 0===c?void 0:c.qualifiersCount)||0}function Bd({blockOrdered:t=!1,tournamentRecord:e,drawDefinition:n,matchUpsMap:i,structureId:r,structure:a,seedsOnly:o,event:s}){a||({structure:a}=hr({drawDefinition:n,structureId:r})),r||({structureId:r}=a);const{byesCount:c,placedByes:u,relevantMatchUps:d}=function({drawDefinition:t,event:e,matchUpsMap:n,structure:i}){var r;const{matchUps:a,roundMatchUps:o}=oa({drawDefinition:t,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:n,structure:i,event:e}),s=o&&o[1]||[],c=(null==i?void 0:i.structureType)===Ki,u=c?a:s,d=c?(null==i||null===(r=i.structures)||void 0===r?void 0:r.length)||0:a.length,{structureId:l,stage:p,stageSequence:m}=i,f=zr({drawDefinition:t,stageSequence:m,entryStatuses:[Cr,Rr],structureId:l,stage:p}),h=_d({drawDefinition:t,stageSequence:m,structureId:l,stage:p}),v=f.length+h,{positionAssignments:I,unassignedPositions:g}=Xr({structure:i}),U=g.map((t=>t.drawPosition)),y=I.filter((t=>t.bye)).length,S=I.filter((t=>t.bye)).map((t=>t.drawPosition)),w=u.map((t=>t.drawPositions)).filter((t=>t&&(null==t?void 0:t.reduce(((t,e)=>!S.includes(e)&&t),!0)))).flat(1/0).filter((t=>U.includes(t)));let N=I.length-v;return N>d&&1===i.stageSequence&&i.stage!==qi&&(N=d),{placedByes:y,byesCount:N,relevantMatchUps:u,placedByePositions:S,roundMatchUps:o,positionsToAvoidDoubleBye:w}}({drawDefinition:n,matchUpsMap:i,structure:a,event:s}),l=c-u;if(l<=0)return B;const{appliedPolicies:p}=ki({drawDefinition:n}),{strictSeedOrderByePositions:m,blockSeedOrderByePositions:f,isFeedIn:h,isLucky:v}=function({relevantMatchUps:t,appliedPolicies:e,drawDefinition:n,structure:i}){const{validSeedBlocks:r,isFeedIn:a,isLucky:o,isContainer:s}=Gs({appliedPolicies:e,drawDefinition:n,structure:i}),c=function({drawDefinition:t,structure:e}){const{positionAssignments:n}=Xr({structure:e}),{seedAssignments:i}=$r({drawDefinition:t,structure:e}),r=Object.assign({},...i.filter((t=>t.participantId)).map((t=>({[t.participantId]:t}))));return n.map((t=>r[t.participantId]?{...t,seedNumber:r[t.participantId].seedNumber,seedValue:r[t.participantId].seedValue}:"")).filter(Boolean)}({drawDefinition:n,structure:i}),u=T([].concat(...t.map((t=>t.drawPositions)))),d=c.filter((t=>u.includes(t.drawPosition))),l=[].concat(...r.map((t=>M(t.drawPositions)))).filter((t=>u.includes(t))),p=(t,e)=>t.seedValue-e.seedValue;return{strictSeedOrderByePositions:kd({orderedSeedDrawPositions:r.reduce(((t,e)=>{const n=d.filter((t=>{var n;return null===(n=e.drawPositions)||void 0===n?void 0:n.includes(t.drawPosition)})).sort(p);return t.concat(...n)}),[]).map((t=>t.drawPosition)),relevantMatchUps:t}).slice(0,c.length),blockSeedOrderByePositions:kd({orderedSeedDrawPositions:l,relevantMatchUps:t}).slice(0,c.length),isContainer:s,isFeedIn:a,isLucky:o}}({relevantMatchUps:d,appliedPolicies:p,drawDefinition:n,structure:a}),I=t?f:m,{unseededByePositions:g}=function({appliedPolicies:t,structure:e,isFeedIn:n,isLucky:i}){var r;const a=null==t||null===(r=t.seeding)||void 0===r?void 0:r.seedingProfile,{positionAssignments:o}=Xr({structure:e}),s=o.filter((t=>t.participantId)).map((t=>t.drawPosition)),{matchUps:c,roundMatchUps:u}=oa({matchUpFilters:{isCollectionMatchUp:!1},structure:e}),d=u&&u[1]||[],l=e.structureType===Ki?c:d,p=T([].concat(...l.map((t=>t.drawPositions)))),m=Math.min(...p)-1,f=s.filter((t=>p.includes(t))),h=t=>{const e=Math.ceil(t.length/2),n=[t.slice(0,e),t.slice(e)],i=n.map((t=>[].concat(...t.flat(1/0)).length)),r=Math.min(...i.flat(1/0)),a=Math.max(...i.flat(1/0)),o=i.indexOf(a),s=r!==a,c=M(n),[u,d]=!r||s?[n[o],n[1-o]]:[c[0],c[1]];return{greaterHalf:u,lesserHalf:d}},v=t=>{const{greaterHalf:e,lesserHalf:n}=h(t),{greaterHalf:i,lesserHalf:r}=h(e),a=M(i.flat(1/0)).pop();return{newlyFilteredChunks:[...n,...r,i.flat().filter((t=>t!==a))],drawPosition:a}},I=t=>!f.includes(t),g=t=>{let e=k(t.sort(Kt),Math.ceil(t.length/4)).map((t=>t.filter(I)));const n=[].concat(...e.flat(1/0)).length,i=[];for(let r=0;r<n;r++){const{newlyFilteredChunks:t,drawPosition:n}=v(e);i.push(n),e=t}return i},{validSeedBlocks:U}=Gs({allPositions:!0,appliedPolicies:t,structure:e});let y=U.map((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>t+m))})).map(g).filter((t=>t.length));if(n){const t=p.length,{seedBlocks:e}=Vs({participantsCount:t,cluster:"CLUSTER"===a});y=e.map((t=>t.map((t=>t+m)))).map(g).filter((t=>t.length))}const S=l.map((t=>t.drawPositions)).map((t=>null==t?void 0:t.sort(((t,e)=>t-e)))).filter((t=>(null==t?void 0:t[0])+1===(null==t?void 0:t[1]))),w=t=>S.reduce(((e,n)=>n.includes(t)?n.reduce(((e,n)=>n!==t?n:e),void 0):e),void 0);return{unseededByePositions:y.map((t=>t.map(w))).flat(1/0).filter(Boolean)}}({appliedPolicies:p,structure:a,isFeedIn:h,isLucky:v}),U=[].concat(...I,...o?[]:g).slice(0,l);for(const y of U){const t=Ds({tournamentRecord:e,drawDefinition:n,drawPosition:y,matchUpsMap:i,structureId:r,structure:a});if(null!=t&&t.error)return t}return B}function jd({drawDefinition:t,structure:e,structureId:n}){e||({structure:e}=hr({drawDefinition:t,structureId:n})),n||({structureId:n}=e);const{positionAssignments:i}=Xr({structure:e}),r=i.filter((t=>t.qualifier)).map((t=>t.drawPosition)),{stage:a,stageSequence:o}=e,s=_d({drawDefinition:t,stageSequence:o,structureId:n,stage:a});return{unplacedQualifiersCount:s-r.length,placedQualifiersCount:r.length,positionAssignments:i,qualifiersCount:s}}function Vd({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,participants:i,groupsCount:r,structureId:a,matchUpsMap:o,structure:s}){const c=[];let u=0;s||({structure:s}=hr({drawDefinition:n,structureId:a})),a||({structureId:a}=s);const{appliedPolicies:d}=ki({drawDefinition:n}),{validSeedBlocks:l,error:p}=Gs({structure:s,drawDefinition:n,appliedPolicies:d});return p&&c.push(p),O(0,r=r||l.length).forEach((()=>{if(u<r){const r=function({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,structureId:i,participants:r,matchUpsMap:a}){const{unplacedSeedParticipantIds:o,unfilledPositions:s}=zs({drawDefinition:n,structureId:i,randomize:!0}),{appliedPolicies:c}=ki({drawDefinition:n}),{avoidance:u}=c||{};u&&r&&(null==o||o.length);for(const d of o){const r=s.pop();if(!r)return{error:"Missing drawPosition"};const o=$s({automaticPlacement:!0,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,participantId:d,drawPosition:r,matchUpsMap:a,structureId:i});if(!o.success)return o}return B}({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,participants:i,structureId:a,matchUpsMap:o});r&&r.success&&u++,r.error&&c.push({seedPositionError:r.error})}})),{errors:c}}function Gd({applyPositioning:t=!0,inContextDrawMatchUps:e,tournamentRecord:n,candidatesCount:i,drawDefinition:r,participants:a,structureId:o,matchUpsMap:s,seedsOnly:c,drawType:u,event:d}){t||(tt.disableNotifications(),r=Ht(r,!1,!0));const l=e=>(t||it(),e),{structure:p,error:m}=hr({drawDefinition:r,structureId:o});if(m)return l({error:m});const f=[Cr,Rr],h=zr({stageSequence:p.stageSequence,stage:p.stage,drawDefinition:r,entryStatuses:f,structureId:o});if(null==h||!h.length)return v={...B},t||it(),v;var v;const{seedingProfile:I}=p;if(s=s||Bi({drawDefinition:r}),e||({matchUps:e}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:s})),"WATERFALL"===I){let t=Bd({tournamentRecord:n,drawDefinition:r,matchUpsMap:s,structure:p,seedsOnly:c,event:d});if(t.error)return l(t);if(t=Vd({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,participants:a,matchUpsMap:s,structure:p}),t.error)return l(t)}else{if(u!==nr){let t=Vd({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,participants:a,matchUpsMap:s,structure:p});if(t.error)return l(t)}const t=Bd({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:s,structure:p,seedsOnly:c,event:d});if(t.error)return l(t)}const g={};if(!c){let t=function({inContextDrawMatchUps:t,tournamentRecord:e,candidatesCount:n,drawDefinition:i,participants:r,matchUpsMap:a,structureId:o,structure:s}){s||({structure:s}=hr({drawDefinition:i,structureId:o})),o||({structureId:o}=s);const{positionAssignments:c}=Xr({structure:s}),{seedAssignments:u}=$r({drawDefinition:i,structure:s}),d=u.map((t=>t.participantId)).filter(Boolean),{stage:l,stageSequence:p}=s,m=zr({drawDefinition:i,stageSequence:p,entryStatuses:[Cr,Rr],structureId:o,stage:l}),f=m.filter((t=>!d.includes(t.participantId))).map((t=>t.participantId)),h=c.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));if(f.length>h.length)return{error:"Insufficient drawPositions to accommodate entries"};const{appliedPolicies:v}=ki({drawDefinition:i});let{avoidance:I}=v||{};if(s.stage===Hi){const t=m.reduce(((t,e)=>(t[e.groupingValue]||(t[e.groupingValue]=[]),t[e.groupingValue].push(e.participantId),t)),{});Object.keys(t).length&&(I||(I={policyName:"Playoff Avoidance"}),I.policyAttributes||(I.policyAttributes=[]),I.policyAttributes.push({groupings:t}))}return I&&r?xd({unseededParticipantIds:f,inContextDrawMatchUps:t,tournamentRecord:e,candidatesCount:n,drawDefinition:i,participants:r,matchUpsMap:a,structureId:o,avoidance:I,entries:m}):function({unseededParticipantIds:t,inContextDrawMatchUps:e,unfilledDrawPositions:n,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,structureId:o}){const s=M(n);for(const c of t){const t=$s({automaticPlacement:!0,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,participantId:c,drawPosition:s.pop(),matchUpsMap:a,structureId:o});if(t&&t.error)return t}return B}({unseededParticipantIds:f,inContextDrawMatchUps:t,unfilledDrawPositions:h,tournamentRecord:e,drawDefinition:i,structureId:o,matchUpsMap:a})}({inContextDrawMatchUps:e,tournamentRecord:n,candidatesCount:i,drawDefinition:r,participants:a,matchUpsMap:s,structure:p});if(t.error)return l(t);if(t.conflicts&&(g.unseededConflicts=t.conflicts),t=function(t){let{structure:e,structureId:n}=t;if(e||({structure:e}=hr(t)),n||({structureId:n}=e),e.stage===qi)return console.log("Consolation Stage: No Qualifiers"),{error:"Consolation Stage: No Qualifiters"};const{positionAssignments:i,unplacedQualifiersCount:r}=jd(t),a=i.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));return r>a.length?{error:"Insufficient drawPositions to accommodate qualifiers"}:(O(0,r).forEach((()=>{const t=a.pop();i.forEach((e=>{e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)}))})),B)}({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,participants:a,matchUpsMap:s,structure:p}),t.error)return l(t);t.conflicts&&(g.qualifierConflicts=t.conflicts)}const{positionAssignments:U}=Qr({drawDefinition:r,structure:p});return xa({drawDefinition:r,structureIds:[o]}),t||it(),{positionAssignments:U,conflicts:g,...B}}function qd({structureName:t="VOLUNTARY_CONSOLATION",structureAbbreviation:e,tournamentRecord:n,drawDefinition:i,participants:r,matchUpType:a,structureId:o,automated:s,drawSize:c,event:u}){if(!i)return{error:q};a=a||i.matchUpType;const{matchUps:d}=pd({matchUpType:a,drawSize:c}),l=od({structureAbbreviation:e,structureName:t,structureId:o,matchUpType:a,matchUps:d,stage:"VOLUNTARY_CONSOLATION"});return i.structures.push(l),s&&Gd({structureId:o||l.structureId,tournamentRecord:n,drawDefinition:i,participants:r,event:u}),xa({drawDefinition:i,structureIds:[o]}),{...B}}function Hd({targetEntryRound:t=1,sourceRoundNumber:e,sourceStructureId:n,targetStructureId:i,drawDefinition:r}){if(!r)return{error:q};const a={linkType:"WINNER",source:{roundNumber:e,structureId:n},target:{feedProfile:"DRAW",roundNumber:t,structureId:i}};r.links.push(a),xa({drawDefinition:r})}function Wd({participantIdPairings:t,tournamentRecord:e,matchUpIds:n=[],drawDefinition:i,matchUpsCount:r,roundNumber:a,structureId:o,newRound:s}){var c;if("object"!=typeof i)return{error:q};if("string"!=typeof o)return{error:"Missing structureId"};if(t&&!Array.isArray(t)||r&&!w(r)||n&&!Array.isArray(n)||!t&&!r)return{error:$};const u=null==i||null===(c=i.structures)||void 0===c?void 0:c.find((t=>t.structureId===o));let d;const l=(null==u?void 0:u.matchUps).reduce(((t,e)=>(e.roundPosition&&(d=!0),e.roundNumber>t?e.roundNumber:t)),0);if(u.structures||d||"ROUND_OUTCOME"===u.finishingPosition)return{error:"Invalid structure"};if(a&&a-1>l)return{error:$};const p=a||(s?l+1:l||1),m=(t=t||O(0,r).map((()=>({participantIds:[]})))).map((t=>{const e=((null==t?void 0:t.participantIds)||[]).concat([void 0,void 0]).slice(0,2).map(((t,e)=>Wt({sideNumber:e+1,participantId:t})));return{matchUpId:n.pop()||Yt(),roundNumber:p,matchUpStatus:le,sides:e}})),f=function({tournamentRecord:t,drawDefinition:e,structureId:n,matchUps:i}){var r;if("object"!=typeof e)return{error:q};if("string"!=typeof n)return{error:"Missing structureId"};if(!Array.isArray(i))return{error:$};const a=null===(r=e.structures)||void 0===r?void 0:r.find((t=>t.structureId===n));if(!a)return{error:"structure not found"};const o=(null==a?void 0:a.matchUps).find((t=>!!t.roundPosition));return a.structures||o||"ROUND_OUTCOME"===a.finishingPosition?{error:"Invalid structure"}:(a.matchUps.push(...i),Ca({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUps:i}),xa({drawDefinition:e,structureIds:[n]}),{...B})}({tournamentRecord:e,drawDefinition:i,structureId:o,matchUps:m});return f.error?f:{matchUpsCount:m.length,...B}}function zd({event:t,drawId:e,drawDefinition:n,drawName:i}){var r;if(!i||"string"!=typeof i)return{error:$,drawName:i};const{flightProfile:a}=vs({event:t}),o=null==a||null===(r=a.flights)||void 0===r?void 0:r.find((t=>t.drawId===e));return o&&(o.drawName=i,wr({event:t,extension:{name:"flightProfile",value:{...a,flights:a.flights}}})),n&&(n.drawName=i),o||n?B:{error:q}}function Kd({stage:t,drawDefinition:e}){var n;const{entryProfile:i}=Tr({drawDefinition:e});return i&&(null===(n=i[t])||void 0===n?void 0:n.drawSize)||0}function Yd({stageSequence:t=1,drawDefinition:e,drawSize:n,stage:i}){if(!e)return{error:q};if(!Hr({drawDefinition:e,stage:i}))return{error:"Invalid stage"};if(n<Kr({drawDefinition:e,stage:i})+_d({drawDefinition:e,stageSequence:t,stage:i}))return{error:"Cannot set drawSize to be less than existing entries"};const{entryProfile:r}=Pr({attributes:[{[i]:{drawSize:n}}],drawDefinition:e});return xa({drawDefinition:e}),{...B,entryProfile:r}}function $d({qualifiersCount:t=0,drawDefinition:e,stage:n}){if(!e)return{error:q};if(!Hr({drawDefinition:e,stage:n}))return{error:"Invalid stage"};if(n!==Vi)return{error:"qualifiersCount can only be set for main stage"};const i=Kd({drawDefinition:e,stage:n}),r=Yr({drawDefinition:e,stage:n});return Kr({drawDefinition:e,stage:n})+r+t>i?{error:"Total stage Entries cannot be greater than drawPositions"}:(Pr({attributes:[{[n]:{qualifiersCount:t}}],drawDefinition:e}),xa({drawDefinition:e}),{...B})}function Jd({drawDefinition:t,drawSize:e}){if(!t)return{error:q};const n=Yd({stage:"VOLUNTARY_CONSOLATION",stageSequence:1,drawDefinition:t,drawSize:e});return n.error?n:(zd({drawDefinition:t}),B)}function Zd({tournamentRecord:t,drawDefinition:e,structures:n,links:i}){if(!e)return{error:q};if(!Array.isArray(n)||!Array.isArray(i))return{error:$};const r=n.map((({structureId:t})=>t));e.structures.push(...n),e.links.push(...i);const a=n.map((t=>{var e;return(null===(e=oa({structure:t}))||void 0===e?void 0:e.matchUps)||[]})).flat();return Ca({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUps:a}),xa({drawDefinition:e,structureIds:r}),{...B}}function Qd(t){return t.matchUpStatus===ne?t.sides.reduce(((t,e)=>e.participantId||t),void 0):t.winningSide?t.sides.reduce(((e,n)=>n.sideNumber===t.winningSide?n.participantId:e),void 0):void 0}function Xd(t){var e;const{structures:n,links:i}=Nd(t),r=t.drawDefinition;return Zd({tournamentId:null===(e=t.tournamentRecord)||void 0===e?void 0:e.tournamentId,drawDefinition:r,structures:n,links:i})}function tl({tournamentRecord:t,drawDefinition:e,structureId:n,matchUpIds:i=[]}){var r;if("object"!=typeof e)return{error:q};if("string"!=typeof n)return{error:"Missing structureId"};if(!Array.isArray(i))return{error:$};const a=null===(r=e.structures)||void 0===r?void 0:r.find((t=>t.structureId===n));if(!a)return{error:"structure not found"};const o=null==a?void 0:a.matchUps,s=o.find((t=>!!t.roundPosition));if(a.structures||s||"ROUND_OUTCOME"===a.finishingPosition)return{error:"Invalid structure"};const c=o.filter((({matchUpId:t})=>i.includes(t))),u=Ri(c),d=c.map((({drawPositions:t})=>t)).flat();if(d.length){a.positionAssignments=a.positionAssignments.filter((({drawPosition:t})=>!d.includes(t))).sort(((t,e)=>t.drawPosition-e.drawPosition)),a.matchUps=a.matchUps.filter((({matchUpId:t})=>!u.includes(t)));const i=Object.assign({},...a.positionAssignments.map((({drawPosition:t},e)=>({[t]:e+1}))));a.positionAssignments=a.positionAssignments.map((t=>({...t,drawPosition:i[t.drawPosition]})));const r=t=>{var e;return t.drawPositions=(null===(e=t.drawPositions)||void 0===e?void 0:e.map((t=>i[t])))||[]};a.matchUps.forEach(r),Oa({tournamentId:null==t?void 0:t.tournamentId,matchUpIds:u,action:"deleteAdHocMatchUps",drawDefinition:e}),xa({drawDefinition:e,structureIds:[n]})}return{...B}}function el({consolationStructure:t,roundOffset:e=0,mainStructure:n,roundsCount:i,feedPolicy:r,fmlc:a}){const o=t.matchUps.reduce(((t,e)=>(e.drawPositions||[]).filter(Boolean).length&&!t.includes(e.roundNumber)?t.concat(e.roundNumber):t),[]),s=(null==r?void 0:r.roundGroupedOrder)||[],c=null==r?void 0:r.roundFeedProfiles;return O(1+e,i+1+e).map((i=>{const r=c&&c[i-1]?c[i-1]:i%2?Yi:"BOTTOM_UP",u=i-e<=2?i-e:2*(i-e-2)+2,d={linkType:$i,source:{roundNumber:i,structureId:n.structureId},target:{feedProfile:r,roundNumber:u,structureId:t.structureId}},l=s[i-1];return l&&(d.target.groupedOrder=l),et()&&(d.source.structureName=n.structureName,d.target.structureName=t.structureName),2===i&&a&&(d.linkCondition="FIRST_MATCHUP",d.target.feedProfile=Yi),o.includes(u)?d:void 0})).filter(Boolean)}function nl(t={}){const{finishingPositionOffset:e,stageSequence:n=1,feedsFromFinal:i,staggeredEntry:r,drawDefinition:a,structureName:o,matchUpType:s,feedPolicy:c,feedRounds:u,idPrefix:d,drawSize:l,isMock:p,uuids:m,fmlc:f}=t,h={finishingPositionOffset:e,matchUpType:s,drawSize:l,idPrefix:d,isMock:p,uuids:m},{matchUps:v}=r?ld(h):pd(h),I=od({structureName:o||Vi,structureId:null==m?void 0:m.pop(),stageSequence:n,stage:Vi,matchUpType:s,matchUps:v});a.structures.push(I);const g=l/2,{matchUps:U,roundsCount:y}=ld({finishingPositionOffset:g,idPrefix:d&&`${d}-c`,isConsolation:!0,feedsFromFinal:i,baseDrawSize:g,matchUpType:s,feedRounds:u,isMock:p,uuids:m,fmlc:f}),S=od({matchUps:U,structureId:null==m?void 0:m.pop(),structureName:qi,stage:qi,stageSequence:1,matchUpType:s});a.structures.push(S);const w=el({consolationStructure:S,mainStructure:I,roundsCount:y,feedPolicy:c,fmlc:f});return a.links=a.links.concat(...w),Object.assign({structures:[I,S],links:a.links},{...B})}function il({structureName:t=Vi,stageSequence:e=1,structureOptions:n,seedingProfile:i,drawDefinition:r,stage:a=Vi,matchUpType:o,drawSize:s,idPrefix:c,isMock:u,uuids:d}){const{groupCount:l,groupSize:p}=function({structureOptions:t,drawSize:e}){let n=null==t?void 0:t.groupSize;const i=function({drawSize:t,groupSizeLimit:e=10}){return O(3,e+1).filter((e=>Math.ceil(t/e)*e-t<e))}({drawSize:e,groupSizeLimit:(null==t?void 0:t.groupSizeLimit)||8}),r=Math.max(...i);n&&i.includes(n)||(n=n&&n>4||!i.includes(4)?r:4);return{groupSize:n,groupCount:Math.ceil(e/n)}}({structureOptions:n,drawSize:s}),m="WIN_RATIO",f=O(1,l+1).map((t=>od({structureName:`Group ${t}`,matchUps:al({groupSize:p,structureOrder:t,matchUpType:o,drawSize:s,idPrefix:c,isMock:u}),structureId:null==d?void 0:d.pop(),structureType:"ITEM",finishingPosition:m,structureOrder:t,matchUpType:o}))),h=od({structureId:null==d?void 0:d.pop(),structureType:Ki,finishingPosition:m,seedingProfile:i,structureName:t,stageSequence:e,matchUpType:o,structures:f,stage:a});return r.structures.push(h),Object.assign({structures:[h],groupCount:l,groupSize:p},{...B})}function rl({playoffStructureId:t,mainStructureId:e,finishingPositions:n}){return{linkType:"POSITION",source:{finishingPositions:n,structureId:e},target:{roundNumber:1,feedProfile:"DRAW",structureId:t}}}function al({structureOrder:t,matchUpType:e,groupSize:n,idPrefix:i,drawSize:r,isMock:a,uuids:o}){const s=(t-1)*n,c=O(1+s,n+1+s),{uniqueMatchUpGroupings:u}=bd({drawPositions:c}),d=function({groupSize:t,drawPositionOffset:e}){const n=t=>[...Array(t)].map(((t,e)=>e)),i=n(2*Math.round(t/2)+1).slice(1),r=n(i.length-1).map((()=>[]));let a=i.slice(0,i.length/2),o=i.slice(i.length/2);i.slice(1).forEach(((t,e)=>{a.forEach(((t,n)=>{r[e].push([a[n],o[n]])}));const n=a.shift(),i=a.pop(),s=o.shift();a=[].concat(n,s,...a),o=[].concat(...o,i)}));const s=a.shift(),c=a.pop(),u=o.shift();a=[].concat(s,u,...a),o=[].concat(...o,c);const d=t=>t[0].reduce(((t,e)=>t+e));return r.reverse().sort(((t,e)=>d(t)-d(e))).map((n=>n.filter((e=>e.every((e=>e<=t)))).map((t=>Rd(t.map((t=>t+e)))))))}({groupSize:n,drawPositionOffset:s});return u.map((function(n){const s=function(t){return d.reduce(((e,n,i)=>n.includes(t)?i+1:e),void 0)}(Rd(n)),c=[1,r],u=function({structureOrder:t,drawPositions:e,roundNumber:n,idPrefix:i,uuids:r}){return i?`${i}-${t}-${n}-DP-${e.join("-")}`:(null==r?void 0:r.pop())||Yt()}({structureOrder:t,drawPositions:n,roundNumber:s,idPrefix:i,uuids:o}),l={matchUpStatus:s?le:ne,matchUpType:e,finishingPositionRange:{winner:c,loser:c},drawPositions:n,roundNumber:s,matchUpId:u};return a&&(l.isMock=!0),l})).sort(((t,e)=>(t.roundNumber||9999)-(e.roundNumber||9999)))}function ol(t={}){var e,n;const{drawType:i=tr,stageSequence:r=1,drawDefinition:a,staggeredEntry:o,structureName:s,goesTo:c=!0,stage:u=Vi,isMock:d,uuids:l}=t;if(!a)return{error:q};let{tieFormat:p,matchUpType:m}=t;p=p||a.tieFormat||void 0,m=m||a.matchUpType||$t;const f=Kd({drawDefinition:a,stage:Vi});"VOLUNTARY_CONSOLATION"===u?Yd({drawSize:t.drawSize,drawDefinition:a,stageSequence:r,stage:u}):f||Yd({drawSize:t.drawSize,drawDefinition:a,stageSequence:r,stage:Vi});const h=(null===(e=t.qualifyingProfiles)||void 0===e?void 0:e.length)&&function({qualifyingProfiles:t,drawDefinition:e,matchUpType:n,idPrefix:i,isMock:r,uuids:a}){const o=[],s=(t,e)=>t.stageSequence-e.stageSequence;let c,u,d=0,l=0,p=0;for(const f of t.sort(s)){var m;const{qualifyingRoundNumber:s,qualifyingPositions:h,structureName:v,drawSize:I}=f;if(!I||!w(I))return{error:"Missing drawSize"};const{matchUps:g,roundLimit:U}=pd({qualifyingRoundNumber:s,qualifyingPositions:h,idPrefix:i,drawSize:I,isMock:r,uuids:a});p+=1;const y=v||(t.length>1?`${Gi} ${p}`:Gi),S=od({structureName:y,qualifyingRoundNumber:U,structureId:null==a?void 0:a.pop(),stage:Gi,stageSequence:p,matchUpType:n,roundLimit:U,matchUps:g});p>1?(Hd({sourceStructureId:u,targetStructureId:S.structureId,sourceRoundNumber:c,drawDefinition:e}),d+=I-l):d+=I,l=null===(m=g.filter((t=>t.roundNumber===U)))||void 0===m?void 0:m.length,u=S.structureId,c=U,o.push(S)}return{qualifyingDrawPositionsCount:d,finalQualifyingRoundNumber:c,finalQualifyingStructureId:u,qualifiersCount:l,structures:o,...B}}({qualifyingProfiles:t.qualifyingProfiles,idPrefix:t.idPrefix,drawDefinition:a,matchUpType:m,isMock:d,uuids:l});if(null!=h&&h.error)return h;const{qualifiersCount:v=0,qualifyingDrawPositionsCount:g}=h||{};if(g){if(a.structures.push(...h.structures),!Kd({stage:Gi,drawDefinition:a})){const t=Yd({drawSize:g,stage:Gi,drawDefinition:a});if(t.error)return t}const t=$d({drawDefinition:a,qualifiersCount:v,stage:Vi});if(t.error)return t}const U=t.drawSize||f;Object.assign(t,Wt({drawSize:U,matchUpType:m,tieFormat:p}));const S=I(2*U/3);if(U<2||!o&&![Zi,Ji,nr].includes(i)&&(i===cr&&U<3||i===er&&!S||![cr,er,ur].includes(i)&&!I(U)))return{error:"Invalid drawSize",drawSize:U};const N=pr.includes(i);if(parseInt(U)<4&&N)return{error:"Invalid drawSize"};const D=1===r?1:void 0,{structures:P}=vr({drawDefinition:a,stageSequence:r,stage:u});if(P.length>=D)return{error:"stageSequence limit"};const T={[Ji]:()=>{const t=od({structureName:s||Vi,finishingPosition:"WIN_RATIO",structureId:null==l?void 0:l.pop(),stageSequence:r,matchUps:[],matchUpType:m,stage:u});return a.structures.push(t),Object.assign({structures:[t]},B)},[nr]:()=>{const{matchUps:e}=function(t){const{qualifyingRoundNumber:e,finishingPositionOffset:n,qualifyingPositions:i,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:c}=t;if(!w(o)||o<2)return{matchUps:[],roundsCount:0};if(I(o))return pd(t);const u=function(t){const e=parseInt(t);let n=e%2?e+1:e;const i=[{participantsCount:n,preFeedRound:!!(Math.ceil(n/2)%2)}];for(;n>2;){const t=Math.ceil(n/2),e=1===t,r=!(e||!(t%2));n=!e&&r?t+1:t;const a=!!(2!==n&&Math.ceil(n/2)%2);i.push({participantsCount:n,preFeedRound:a,feedRound:r})}return i}(o),d=O(1,u.shift().participantsCount+1).map((t=>({drawPosition:t})));let l=[],p=1;({matchUps:l}=dd({roundNumber:p,matchUpType:r,idPrefix:a,matchUps:l,isMock:s,nodes:d,uuids:c})),p++;let m=t.roundLimit||e;for(const h of u){const t=h.participantsCount/2,e=O(1,t+1);i&&t===i&&(m=p-1);const n=e.map((t=>{const e=cd({roundPosition:t,roundNumber:p,idPrefix:a,uuids:c});return{roundPosition:t,roundNumber:p,matchUpId:e}}));l.push(...n),p++}const f=p-1;return l=sd({finishingPositionOffset:n,lucky:!0,roundsCount:f,roundLimit:m,matchUps:l}),m&&(l=l.filter((t=>t.roundNumber<=m))),{matchUps:l,roundsCount:f,roundLimit:m}}(t),n=od({structureName:s||Vi,structureId:null==l?void 0:l.pop(),stageSequence:r,matchUpType:m,matchUps:e,stage:u});return a.structures.push(n),Object.assign({structures:[n]},B)},[tr]:()=>{const{matchUps:e}=pd(t),n=od({structureName:s||Vi,structureId:null==l?void 0:l.pop(),stageSequence:r,matchUpType:m,matchUps:e,stage:u});return a.structures.push(n),Object.assign({structures:[n]},B)},[er]:()=>function({drawDefinition:t,structureName:e,matchUpType:n,idPrefix:i,drawSize:r,isMock:a,uuids:o}){const{matchUps:s}=ld({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:n,idPrefix:i,isMock:a}),c=od({structureName:e||Vi,structureId:null==o?void 0:o.pop(),stageSequence:1,stage:Vi,matchUpType:n,matchUps:s});t.structures.push(c);const u=r/2,{matchUps:d}=ld({finishingPositionOffset:u,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:n,isMock:a,uuids:o}),l=od({matchUps:d,structureId:null==o?void 0:o.pop(),structureName:"BACKDRAW",stageSequence:2,matchUpType:n,stage:Vi});t.structures.push(l);const{matchUps:p}=pd({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:n,isMock:a}),m=od({matchUps:p,structureId:null==o?void 0:o.pop(),structureName:"DECIDER",stageSequence:3,stage:Vi,matchUpType:n});t.structures.push(m);const f=function({mainStructure:t,consolationStructure:e,deciderStructure:n}){const i=e.matchUps.reduce(((t,e)=>(e.drawPositions||[]).filter(Boolean).length&&!t.includes(e.roundNumber)?t.concat(e.roundNumber):t),[]),r=t.matchUps.reduce(((t,e)=>!t||e.roundNumber>t?e.roundNumber:t),void 0),a=e.matchUps.reduce(((t,e)=>!t||e.roundNumber>t?e.roundNumber:t),void 0);return[...[1,2].map((n=>{const i=n%2?Yi:"BOTTOM_UP";return{linkType:$i,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:i,roundNumber:1,positionInterleave:{offset:n-1,interleave:1},structureId:e.structureId}}})),...i.slice(1).map(((n,r)=>{const a=i.indexOf(n)%2?Yi:"BOTTOM_UP";return{linkType:$i,source:{roundNumber:3+r,structureId:t.structureId},target:{feedProfile:a,roundNumber:n,structureId:e.structureId}}})),{linkType:"WINNER",source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:Yi,roundNumber:r,structureId:t.structureId}},{linkType:"WINNER",source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Yi,roundNumber:1,structureId:n.structureId}},{linkType:$i,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Yi,roundNumber:1,structureId:n.structureId}}]}({mainStructure:c,consolationStructure:l,deciderStructure:m});return t.links=t.links.concat(...f),Object.assign({structures:t.structures,links:t.links},B)}(t),[Qi]:()=>md(Object.assign(t,{roundOffsetLimit:3,playoffAttributes:dr})),[Xi]:()=>md(Object.assign(t,{roundOffsetLimit:2,playoffAttributes:lr})),[Hi]:()=>md(t),[Zi]:()=>{const{matchUps:t}=ld({drawSize:U,uuids:l,matchUpType:m}),e=od({structureName:s||Vi,structureId:null==l?void 0:l.pop(),stageSequence:r,matchUpType:m,stage:Vi,matchUps:t});return a.structures.push(e),Object.assign({structures:[e]},B)},FIRST_ROUND_LOSER_CONSOLATION:()=>function(t){const{finishingPositionOffset:e=0,stageSequence:n=1,drawDefinition:i,staggeredEntry:r,structureName:a,stage:o=Vi,matchUpType:s,idPrefix:c,drawSize:u,isMock:d,uuids:l}=t,p={finishingPositionOffset:e,matchUpType:s,drawSize:u,idPrefix:c,isMock:d,uuids:l},{matchUps:m}=r?ld(p):pd(p),f=od({structureName:a||Vi,structureId:null==l?void 0:l.pop(),stageSequence:n,matchUpType:s,matchUps:m,stage:o});i&&i.structures.push(f);const h=u/2,{matchUps:v}=pd({finishingPositionOffset:e+h,idPrefix:c&&`${c}-c`,drawSize:h,matchUpType:s,isMock:d}),I=t.consolationStructureName||(a?`${a} ${qi}`:qi),g=od({structureName:I,matchUps:v,structureId:null==l?void 0:l.pop(),stage:qi,stageSequence:1,matchUpType:s});i&&i.structures.push(g);const U={linkType:$i,source:{roundNumber:1,structureId:f.structureId},target:{roundNumber:1,feedProfile:Yi,structureId:g.structureId}};return i&&i.links.push(U),Object.assign({structures:[f,g],links:null==i?void 0:i.links},B)}(t),FIRST_MATCH_LOSER_CONSOLATION:()=>nl(Object.assign(t,{feedRounds:1,fmlc:!0})),[sr]:()=>nl(Object.assign(t,{feedRounds:1})),[ar]:()=>nl(Object.assign(t,{feedsFromFinal:2})),[rr]:()=>nl(Object.assign(t,{feedsFromFinal:1})),[or]:()=>nl(Object.assign(t,{feedsFromFinal:3})),FEED_IN_CHAMPIONSHIP:()=>nl(t),[ir]:()=>function({finishingPositionOffset:t,structureName:e=Vi,stageSequence:n=1,staggeredEntry:i,drawDefinition:r,matchUpType:a,idPrefix:o,drawSize:s,isMock:c,uuids:u}){const d={finishingPositionOffset:t,matchUpType:a,drawSize:s,idPrefix:o,isMock:c,uuids:u},{matchUps:l,roundsCount:p}=i?ld(d):pd(d),m=od({matchUps:l,matchUpType:a,stage:Vi,structureName:e,stageSequence:n,structureId:null==u?void 0:u.pop()});r.structures.push(m);const f=[0,2].slice(0,s/16).map(((t,e)=>{const n=e+1,{consolationStructure:i}=function({stageSequence:t=1,roundOffset:e=0,matchUpType:n,structureId:i,idPrefix:r,drawSize:a,isMock:o,index:s,uuids:c}){const u=a/(2*Math.pow(2,e)),{matchUps:d,roundsCount:l}=ld({finishingPositionOffset:u,baseDrawSize:u,isConsolation:!0,feedRounds:1,matchUpType:n,idPrefix:r,isMock:o,uuids:c});return{consolationStructure:od({matchUps:d,stage:qi,structureName:`${qi} ${s+1}`,stageSequence:t,matchUpType:n,structureId:i}),consolationRoundsCount:l}}({structureId:null==u?void 0:u.pop(),idPrefix:o&&`${o}-c${e}`,stageSequence:n,roundOffset:t,matchUpType:a,drawSize:s,isMock:c,index:e,uuids:u});return r.structures.push(i),{consolationStructure:i,links:el({mainStructure:m,consolationStructure:i,roundsCount:2,roundOffset:t})}})).map((t=>t.links));if(r.links=r.links.concat(...f),s>=4&&s<=16||s>32){const{matchUps:t}=pd({finishingPositionOffset:2,idPrefix:o&&`${o}-p3t4`,drawSize:2,matchUpType:a,isMock:c}),e=od({structureId:null==u?void 0:u.pop(),matchUps:t,structureName:Hi,stageSequence:2,matchUpType:a,stage:Vi}),n={linkType:$i,source:{roundNumber:p-1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Yi,structureId:e.structureId}};r.structures.push(e),r.links.push(n)}return Object.assign({structures:r.structures,links:r.links},B)}(t),[cr]:()=>il(t),[ur]:()=>function(t){const{playoffMatchUpFormat:e,stageSequence:n=1,structureOptions:i,drawDefinition:r,matchUpType:a,idPrefix:o,isMock:s,uuids:c}=t,u=Object.assign({structureName:Vi},t,{stage:Vi}),{structures:[d],groupCount:l,groupSize:p}=il(u);l<1&&console.log("Invalid configuration");const m=i&&i.playoffGroups||[{finishingPositions:[1],structureName:Hi}];let f=0;const h=m.map(((t,i)=>{const u=i+1,m=O(1,p+1),h=t.finishingPositions;if(!h.reduce(((t,e)=>m.includes(e)&&t),!0))return;const v=t.drawType||tr,I=l*h.length,g=y(I);if(v===tr){const{matchUps:i}=pd({idPrefix:o&&`${o}-po`,finishingPositionOffset:f,matchUpType:a,drawSize:g}),s=od({structureName:t.structureName,matchUpFormat:e,structureId:null==c?void 0:c.pop(),stage:Hi,stageSequence:n,matchUpType:a,stageOrder:u,matchUps:i});r.structures.push(s);const l=rl({playoffStructureId:s.structureId,mainStructureId:d.structureId,finishingPositions:h});return r.links.push(l),f+=I,[s]}if([Qi,Xi,Hi].includes(v)){const{structureName:e}=t,i={playoffStructureNameBase:e,addNameBaseToAttributeName:!0,finishingPositionOffset:f,stage:Hi,drawDefinition:r,roundOffset:0,stageSequence:n,drawSize:g,idPrefix:o,isMock:s,uuids:c};v===Qi?Object.assign(i,{roundOffsetLimit:3,playoffAttributes:dr}):v===Xi&&Object.assign(i,{roundOffsetLimit:2,playoffAttributes:lr});const a=fd(i);if(a.error)return a;const{structures:u,links:l}=a;if(null!=l&&l.length&&r.links.push(...l),null!=u&&u.length&&r.structures.push(...u),r.structures.sort(fr),a.structure){const t=rl({mainStructureId:d.structureId,playoffStructureId:a.structureId,finishingPositions:h});r.links.push(t)}return f+=I,u}if("FIRST_MATCH_LOSER_CONSOLATION"===v){console.log("RRw/PO FIRST_MATCH_LOSER_CONSOLATION");const e=[null==c?void 0:c.pop(),null==c?void 0:c.pop()],{mainStructure:n,consolationStructure:i,link:s}=nl({structureName:t.structureName,idPrefix:o&&`${o}-po`,finishingPositionOffset:f,uuids:e,stage:Hi,feedRounds:1,matchUpType:a,fmlc:!0,drawSize:g}),u=rl({playoffStructureId:n.structureId,mainStructureId:d.structureId,finishingPositions:h});return r.links.push(u),r.structures.push(n),r.structures.push(i),r.links.push(s),f+=I,[n,i]}})).filter(Boolean);return Object.assign({structures:[d,...null==h?void 0:h.flat()],links:r.links},{...B})}(t)}[i],M=T&&T();if(null==M||!M.success)return{error:"Unrecognized drawType"};if(null!=h&&null!==(n=h.structures)&&void 0!==n&&n.length){const{finalQualifyingRoundNumber:t,finalQualifyingStructureId:e}=h;Hd({sourceStructureId:e,sourceRoundNumber:t,targetStructureId:M.structures.find((({stage:t,stageSequence:e})=>t===Vi&&1===e)).structureId,drawDefinition:a})}const{matchUps:A,matchUpsMap:E}=ya({drawDefinition:a});let b;return p&&A.forEach((t=>{const{tieMatchUps:e}=wd({tieFormat:p,isMock:d});Object.assign(t,{tieMatchUps:e,matchUpType:m})})),c&&({inContextDrawMatchUps:b}=xo({drawDefinition:a,matchUpsMap:E})),xa({drawDefinition:a}),{structures:a.structures,links:a.links,inContextDrawMatchUps:b,matchUpsMap:E,...B,matchUps:A}}function sl({tournamentRecord:t,drawDefinition:e,structureId:n}){var i;if(!e)return{error:q};if(!n)return{error:"Missing structureId"};const r=[],a=[n],o=t=>{var n;return null===(n=e.links)||void 0===n?void 0:n.map((e=>e.source.structureId===t&&e.target.structureId)).filter(Boolean)},s=(null===(i=e.structures)||void 0===i?void 0:i.map((({structureId:t})=>t)))||[],c=Object.assign({},...s.map((t=>({[t]:o(t)}))));for(;a.length;){var u;const t=a.pop(),{structure:n}=hr({drawDefinition:e,structureId:t}),{matchUps:i}=oa({structure:n}),o=Ri(i);r.push(...o),e.links=(null===(u=e.links)||void 0===u?void 0:u.filter((e=>e.source.structureId!==t&&e.target.structureId!==t)))||[],e.structures=(e.structures||[]).filter((e=>e.structureId!==t));const s=c[t];null!=s&&s.length&&a.push(...s)}const{matchUps:d}=ya({drawDefinition:e});return d.forEach((t=>{r.includes(t.winnerMatchUpId)&&delete t.winnerMatchUpId,r.includes(t.loserMatchUpId)&&delete t.loserMatchUpId})),Oa({tournamentId:null==t?void 0:t.tournamentId,matchUpIds:r,action:"removeStructure",drawDefinition:e}),xa({drawDefinition:e}),{...B,removedMatchUpIds:r}}const cl={generateAndPopulatePlayoffStructures:Nd,attachPlayoffStructures:Zd,getSourceRounds:Ud,getDrawStructures:vr,getPositionsPlayedOff:gd,getQualifiersCount:_d,getAvailablePlayoffRounds:yd,addPlayoffStructures:Xd,removeStructure:sl,generateQualifyingLink:Hd,generateAdHocMatchUps:Wd,deleteAdHocMatchUps:tl,structureSort:fr,generateDrawType:ol,addVoluntaryConsolationStage:Jd,generateVoluntaryConsolationStructure:qd,buildDrawHierarchy:function({matchUps:t,matchUpType:e}){var n;if(!t)return{error:"Missing matchUps"};let i=0,r=[],a=[];e&&(t=t.filter((t=>t.matchUpType===e)));const o=T(t.map((({matchUpType:t})=>t)));if(o.length>1)if(o.includes(Zt))t=t.filter((t=>t.matchUpType===Zt));else if(o.includes($t))t=t.filter((t=>t.matchUpType===$t));else{if(!o.includes(Jt))return{};t=t.filter((t=>t.matchUpType===Jt))}if(!Array.isArray(t)||!t.length)return{};const s=(t,e)=>parseInt(t)-parseInt(e),c=T(t.map((t=>t.drawPositions)).flat().filter(Boolean)).sort(s),u=O(1,Math.max(...c)+1).filter((t=>!c.includes(t))).sort(s),{roundMatchUps:d}=_i({matchUps:t}),l=d[1],p=d[2]||[],[m]=l||[{}],f=m.drawId,h=m.structureId,v=Math.max(...Object.keys(d)),I=(null===(n=d[v])||void 0===n?void 0:n.length)||0,g=Math.ceil(Math.log(I)/Math.log(2)),U=O(1,g+1).map((t=>{const e=Math.pow(2,t-1),n=v+g-t+1;return O(1,e+1).map((e=>({drawId:f,structureId:h,matchUpId:Yt(),drawPositions:[],sides:[],roundNumber:n,roundPosition:e,finishingRound:t})))}));g&&(t=t.concat(...U.flat()));const y=l.map((t=>t.drawPositions)).flat(1/0),S=p.map((t=>t.drawPositions)).flat(1/0).filter((t=>!y.includes(t))).sort(s),w=p.filter((t=>{var e;return null===(e=t.drawPositions)||void 0===e?void 0:e.reduce(((t,e)=>S.includes(e)||t),void 0)})).map((t=>{var e,n;const i=null===(e=t.drawPositions)||void 0===e?void 0:e.reduce(((t,e)=>S.includes(e)?e:t),void 0),r=null===(n=t.drawPositions)||void 0===n?void 0:n.indexOf(i);return{[i]:t.sides[r]}}));if(null!=u&&u.length&&(null==S?void 0:S.length)===(null==u?void 0:u.length)){const e=S.map(((t,e)=>[t,u[e]].sort(s))),n=Object.assign({},...w),i=Ht(l[0].finishingRound,!1,!0),r=Ht(l[0].finishingPositionRange);a=e.map(((t,e)=>{const a=Math.max(...t||[])/2;return{sides:null==t?void 0:t.map((t=>n[t]||{bye:!0,drawPosition:t})),drawId:f,structureId:h,roundPosition:a,drawPositions:t,roundNumber:1,finishingRound:i,matchUpId:Yt(),matchUpStatus:"BYE",sideNumber:e+1,finishingPositionRange:r}})),t=t.concat(...a)}const N=v+g;return O(1,N+1).forEach((e=>{var n,a;const o=[],s=D({matchUps:t,roundNumber:e}),c=D({matchUps:t,roundNumber:e-1}).map(Qd).filter(Boolean),u=(null==s?void 0:s.length)===(null===(n=r)||void 0===n?void 0:n.length),d=(null==s?void 0:s.length)===(null===(a=r)||void 0===a?void 0:a.length)/2;1===e&&s.forEach((t=>{const e=t.drawPositions||[],{matchUpId:n,structureId:i}=t,r=[{...t.sides[0],drawPosition:e[0],matchUpId:n,structureId:i},{...t.sides[1],drawPosition:e[1],matchUpId:n,structureId:i}],a={...t,children:r};o.push(a)})),u?(i++,s.forEach(((t,e)=>{const n=t.drawPositions||[],{matchUpId:a,structureId:s}=t,u=n.filter(Boolean).reduce(((t,e)=>y.includes(e)?t:e),void 0),d=[{...t.sides.filter(Boolean).reduce(((t,e)=>e.participantId&&!c.includes(e.participantId)?e:t),void 0),drawPosition:u,feedRoundNumber:i,sides:t.sides,matchUpId:a,structureId:s},r[e]],l={...t,children:d};o.push(l)}))):d&&s.forEach(((t,e)=>{const n={...t,children:[r[2*e],r[2*e+1]]};o.push(n)})),r=o})),{hierarchy:r[0],missingMatchUps:a,maxRound:v,finalRound:N,matchUps:t};function D({matchUps:t,roundNumber:e}){return t.filter((t=>t.roundNumber===e)).sort(((t,e)=>t.roundPosition-e.roundPosition))}}};function ul({participantCount:t}){return isNaN(t)?{error:$}:{drawSize:[0,2,4,8,16,32,64,128,256,512,1024].find((e=>e>=t))||0}}function dl({tournamentRecord:t,drawDefinition:e,event:n,requireParticipantCount:i=!0,drawSizeProgression:r=!1,policyDefinitions:a,participantCount:o,drawSize:s}={}){if(!a){const i=ms({tournamentRecord:t,drawDefinition:e,event:n});if(i.error)return i;a=i.policyDefinitions}if(o&&isNaN(o))return{error:$};if(i&&isNaN(o))return{error:"Missing participantCount"};if(!s){if(!o)return{error:"Missing drawSize"};({drawSize:s}=ul({participantCount:o}))}if((i&&o||s)>s)return{error:"participantCount exceeds drawSize"};const c=a.seeding;if(!c)return{error:"Invalid policyDefinitions"};const u=c.seedsCountThresholds;return u?(void 0!==c.drawSizeProgression&&(r=c.drawSizeProgression),{seedsCount:u.filter((t=>r?t.drawSize<=s:s===t.drawSize)).reduce(((t,e)=>o>=e.minimumParticipantCount?e.seedsCount:t),0)}):{error:"Missing seedCountThresholds"}}function ll({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:n,tournamentRecord:i,participantCount:r,drawDefinition:a,structureId:o,seedsCount:s,event:c}){const{structure:u,error:d}=hr({drawDefinition:a,structureId:o});if(d)return{error:d};const{positionAssignments:l}=Xr({structure:u}),p=l.length;if(s>p)return{error:"seedsCount greater than drawSize"};const{policyDefinitions:m}=ms({policyTypes:["seeding"],tournamentRecord:i,drawDefinition:a,event:c}),{seedsCount:f}=dl({requireParticipantCount:t,drawSizeProgression:n,policyDefinitions:m,participantCount:r,drawSize:p});return m&&f&&s>f&&e&&(s=f),u.seedLimit=s,u.seedAssignments=O(1,s+1).map((t=>({seedNumber:t,seedValue:t,participantId:void 0}))),xa({drawDefinition:a,structureIds:[o]}),{...B,seedLimit:s}}function pl({participantPreferences:t,drawPositionResolutions:e={}}){const n=Object.keys(t).reduce(((e,n)=>{const i=t[n].preferences[0];return i&&(e[i]||(e[i]=[]),e[i].push(n)),e}),{}),i=Math.min(...Object.values(n).filter((t=>t.length)).map((t=>t.length))),r=Object.keys(n).filter((t=>n[t].length&&i&&n[t].length===i));let a;return r.forEach((i=>{const r=R(n[i]);e[i]=r,delete t[r]})),Object.values(t).forEach((t=>{t.preferences=t.preferences.filter((t=>{const e=!r.includes(t.toString());return e&&(a=!0),e}))})),{drawPositionResolutions:e,remainingPreferences:a,participantPreferences:t}}function ml(t){const{participantIdAttributeName:e="participantId",positionActionName:n,tournamentRecord:i,drawDefinition:r,participantId:a,drawPosition:o,structureId:s}=t;if(!r)return{error:q};let{inContextDrawMatchUps:c,matchUpsMap:u}=t;u||(u=Bi({drawDefinition:r}),Object.assign(t,{matchUpsMap:u})),c||(({matchUps:c}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:u})),Object.assign(t,{inContextDrawMatchUps:c}));const{positionAssignments:d}=Qr({drawDefinition:r,structureId:s}),l=d.find((t=>t.drawPosition===o));if(null!=l&&l.participantId){let t=$s({inContextDrawMatchUps:c,tournamentRecord:i,drawDefinition:r,participantId:a,drawPosition:o,structureId:s,matchUpsMap:u});return t.success||console.log({result:t}),f({removedParticipantId:l.participantId})}let p=ls({inContextDrawMatchUps:c,tournamentRecord:i,drawDefinition:r,drawPosition:o,structureId:s,matchUpsMap:u});if(p.error)return p;const m=p.participantId;return p=$s({inContextDrawMatchUps:c,tournamentRecord:i,drawDefinition:r,participantId:a,drawPosition:o,structureId:s,matchUpsMap:u}),p.success?f({removedParticipantId:m}):p;function f({removedParticipantId:t}){const{structure:i}=hr({drawDefinition:r,structureId:s});return Bs({drawPositions:[o],structure:i}),js({drawDefinition:r,positionAction:{[e]:a,name:n,drawPosition:o,structureId:s}}),{...B,removedParticipantId:t}}}function fl({alternateParticipantId:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,structureId:r}){return ml({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,structureId:r})}function hl({structurePositionAssignments:t,tournamentRecord:e,drawDefinition:n}){if(!n)return{error:q};if(!Array.isArray(t))return{error:$};for(const r of t){var i;const{structureId:t,positionAssignments:a}=r,o=hr({drawDefinition:n,structureId:t});if(o.error)return o;const s=o.structure;if(!s)return{error:"structure not found"};if(s.structures)return{error:"Invalid structure",message:"cannot be Round Robin group container"};const c=null===(i=s.positionAssignments)||void 0===i?void 0:i.map((({drawPosition:t})=>t));if(F(c,a.map((({drawPosition:t})=>t))).length!==c.length)return{error:$,message:"drawPositions do not match"};const u=Bi({drawDefinition:n}),{matchUps:d}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:n,matchUpsMap:u});for(const i of a){const{drawPosition:r,participantId:o,bye:c,qualifier:l}=i;if(c){const i=Ds({tournamentRecord:e,drawDefinition:n,drawPosition:r,matchUpsMap:u,structureId:t,structure:s});if(null!=i&&i.error)return i}else if(l)a.forEach((t=>{t.drawPosition===r&&(t.qualifier=!0,delete t.participantId,delete t.bye)}));else if(o){const i=$s({automaticPlacement:!0,inContextDrawMatchUps:d,tournamentRecord:e,drawDefinition:n,participantId:o,drawPosition:r,matchUpsMap:u,structureId:t});if(null!=i&&i.error)return i}}}return xa({drawDefinition:n,structureIds:t.map((({structureId:t})=>t))}),{...B}}function vl({drawDefinition:t,stages:e}){return((null==t?void 0:t.structures)||[]).filter((t=>!(null!=e&&e.length)||e.includes(t.stage))).map((t=>{const{positionAssignments:e}=Qr({structure:t});return Ci(e)})).flat()}function Il({entries:t=[]}={}){const e=t.filter(Boolean).reduce(((t,e)=>{const{entryStage:n,entryStatus:i}=e,r=`_${n||Vi}${i||""}`;return t[r]||(t[r]=[]),t[r].push(e),t}),{}),n=t=>isNaN(t)?9999:t;return Object.keys(e).map((t=>e[t].sort(((t,e)=>n(t.entryPosition)-n(e.entryPosition))).map(((t,e)=>{const n=e;return Object.assign(t,{entryPosition:n})})))).flat()}function gl(t){return[kr,_r].includes(t)}function Ul({autoEntryPositions:t=!0,tournamentRecord:e,drawDefinition:n,participantIds:i,entryStatus:r,eventSync:a,drawId:o,stage:s,event:c}){var u,d,l,p,m,f,h,v,I,g;if(!i||!Array.isArray(i))return{error:"Invalid participantId",method:"modifyEntriesStatus",participantIds:i};if(!Gr.includes(r))return{error:"Invalid entry status"};if(!n&&!c)return{error:W};const U=[];null===(u=c.drawDefinitions)||void 0===u||u.forEach((t=>{const e=vl({drawDefinition:t});U.push(...e)}));const y=(null==e?void 0:e.participants)||[];if(!i.every((t=>{const{participantType:e}=Rn({tournamentParticipants:y,participantId:t});return!(e===Pi&&gl(r))})))return{error:"Invalid entry status"};const{flightProfile:S}=vs({event:c}),w=null==S||null===(d=S.flights)||void 0===d?void 0:d.find((t=>t.drawId===o)),N=(t=[])=>t.filter((t=>!s||!t.entryStage||s===t.entryStage)).filter((({participantId:t})=>i.includes(t))).every((t=>!(t=>U.includes(t.participantId)&&!(Br.includes(t.entryStatus)&&Br.includes(r)))(t)&&(t.entryStatus=r,delete t.entryPosition,!0)))?B:{error:"Participant has assigned drawPosition"},D=({flight:t,drawDefinition:e})=>{c.entries=Il({entries:c.entries||[]}),t&&(t.drawEntries=Il({entries:t.drawEntries})),e&&(e.entries=Il({entries:e.entries}))},P=({flight:t,drawDefinition:e})=>{if(t){const e=N(t.drawEntries);if(e.error)return e}if(e){const t=N(e.entries);if(t.error)return t}return{...B}},T=(null===(l=c.entries)||void 0===l?void 0:l.find((({entryPosition:t})=>!isNaN(t))))||(null==w||null===(p=w.drawEntries)||void 0===p?void 0:p.find((({entryPosition:t})=>!isNaN(t))))||(null==n||null===(m=n.entries)||void 0===m?void 0:m.find((({entryPosition:t})=>!isNaN(t))));if(t&&!T&&D({flight:w,drawDefinition:n}),w||n){const t=P({flight:w,drawDefinition:n});if(t.error)return t}const M=(null===(f=c.drawDefinitions)||void 0===f?void 0:f.map((({drawId:t})=>t)))||[],A=(null==S||null===(h=S.flights)||void 0===h?void 0:h.filter((t=>!M.includes(t.drawId))))||[];for(const C of A){const t=P({flight:C});if(t.error)return t}const E=1===(null==S||null===(v=S.flights)||void 0===v?void 0:v.length)&&(null===(I=c.drawDefinitions)||void 0===I?void 0:I.length)<=(null==S||null===(g=S.flights)||void 0===g?void 0:g.length);if(!w&&!n&&jr.includes(r))return{error:"entryStatus not allowed for event"};if(!w&&!n||r===xr||a&&E){const t=N(c.entries);if(t.error)return t;let e;var b,R;if(r===xr&&(null==S||null===(b=S.flights)||void 0===b||b.every((t=>{const n=N(t.drawEntries);return n.error?(e=n.error,!1):(t.drawEntries=t.drawEntries.filter((({participantId:t})=>!i.includes(t))),!0)})),null===(R=c.drawDefinitions)||void 0===R||R.every((t=>{var n;const r=N(t.entries);return r.error?(e=r.error,!1):(t.entries=null===(n=t.entries)||void 0===n?void 0:n.filter((({participantId:t})=>!i.includes(t))),!0)}))),e)return{error:e}}return t&&D({flight:w,drawDefinition:n}),B}function yl({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:n}){if(!t)return{error:G};if(!e||!n)return{error:z};const i=(t.participants||[]).find((t=>t.participantId===e));if(!i)return{error:Y};if(![Di,Ti].includes(i.participantType))return{error:"Invalid participantType",participantType:i.participantType};const{removed:r,error:a}=Sl({groupingParticipant:i,individualParticipantIds:n});return a?{error:a}:(r&&at({topic:"modifyParticipants",payload:{participants:[i]}}),{...B,removed:r})}function Sl({groupingParticipant:t,individualParticipantIds:e=[]}){let n=0,i=[];return t?(t.individualParticipantIds||(t.individualParticipantIds=[]),t.individualParticipantIds=t.individualParticipantIds.filter((t=>{const i=null==e?void 0:e.includes(t);return i&&n++,!i})),i.length?{error:"Participants not removed",notRemoved:i}:{groupingParticipant:t,removed:n}):{removed:n}}function wl({groupingType:t=Di,participantRole:e=Lu,tournamentRecord:n,individualParticipantIds:i=[]}){if(!n)return{error:G};const r=n.participants||[];let a=0;return r.filter((n=>(n.participantRole===e||!n.participantRole)&&n.participantType===t)).forEach((t=>{const{removed:e}=Sl({groupingParticipant:t,individualParticipantIds:i});e&&a++})),a?B:{error:"No participant removed"}}function Nl({tournamentRecord:t,participantIds:e}){var n,i;if(!t)return{error:G};if(null==e||!e.length)return{error:"Missing participantIds"};const r=(null===(n=t.participants)||void 0===n?void 0:n.length)||0;if(!r)return B;const a=null===(i=t.events)||void 0===i?void 0:i.filter((({eventType:t})=>t===yi)).map((t=>{var e;return null==t||null===(e=t.drawDefinitions)||void 0===e?void 0:e.map((({drawId:t})=>t))})).flat(1/0),{tournamentParticipants:o}=qc({participantFilters:{participantIds:e},withStatistics:!0,tournamentRecord:t}),s=(null==a?void 0:a.length)&&(()=>{const{matchUps:n}=wa({matchUpFilters:{drawIds:a,matchUpTypes:[Jt]},tournamentRecord:t});return F(n.map((({sides:t})=>t.map((({participantId:t})=>t)))).flat().filter(Boolean),e)})(),c=o.filter((t=>{var e;return null===(e=t.draws)||void 0===e?void 0:e.filter((({drawId:t})=>!(null!=a&&a.length&&null!=a&&a.includes(t)))).length}));if(null!=s&&s.length||c.length)return{error:"Participant has assigned drawPosition"};t.participants=t.participants.filter((t=>!e.includes(t.participantId)));const u=r-t.participants.length;return wl({tournamentRecord:t,individualParticipantIds:e}),u&&at({topic:"deleteParticipants",payload:{participantIds:e}}),u?B:{error:"Cannot remove participants"}}function Dl({selected:t=!0,drawDefinition:e,entryStatuses:n,drawId:i,event:r,stage:a}){let o=r.entries||[];if(i){var s;const{flightProfile:t}=vs({event:r}),n=null==t||null===(s=t.flights)||void 0===s?void 0:s.find((t=>t.drawId===i));o=n?n.drawEntries:null==e?void 0:e.entries}const c=o.filter((e=>(!(null!=n&&n.length)||!e.entryStatus||n.includes(e.entryStatus))&&(!a||!e.entryStage||e.entryStage===a)&&(!t||Vr.includes(e.entryStatus))));return{entries:o,stageEntries:c}}function Pl({autoEntryPositions:t=!0,tournamentRecord:e,participantIds:n,event:i}){var r,a,o,s;if(null==i||!i.eventId)return{error:W};if(!Array.isArray(n))return{error:"Missing participantIds"};if(null===(a=n=null===(r=n)||void 0===r?void 0:r.filter(Boolean))||void 0===a||!a.length)return{error:"Missing participantIds"};const{eventId:c}=i,{tournamentParticipants:u}=qc({participantFilters:{participantIds:n},withStatistics:!0,tournamentRecord:e});if(null==u?void 0:u.every((t=>{var e;const n=t.events.find((t=>t.eventId===c));return null==n||null===(e=n.drawIds)||void 0===e?void 0:e.length})))return{error:"Existing participant drawPosition assignment"};i.entries=(i.entries||[]).filter((t=>!n.includes(null==t?void 0:t.participantId))),t&&(i.entries=Il({entries:i.entries}));const{flightProfile:d}=vs({event:i});return null==d||null===(o=d.flights)||void 0===o||o.forEach((t=>{t.drawEntries=(t.drawEntries||[]).filter((t=>!n.includes(t.participantId)))})),null===(s=i.drawDefinitions)||void 0===s||s.forEach((t=>{t.entries=(t.entries||[]).filter((t=>!n.includes(t.participantId)))})),B}function Tl({participantId:t,drawDefinition:e,entryStatus:n,entryStage:i}){var r;if(!e)return{error:q};const a=null===(r=e.entries)||void 0===r?void 0:r.find((e=>!(e.participantId!==t||n&&n!==e.entryStatus||i&&i!==e.entryStage)));return t&&a}function Ml({stage:t,drawDefinition:e}){return Boolean(Hr({stage:t,drawDefinition:e})&&Kd({stage:t,drawDefinition:e}))}function Al({entryStatus:t=Cr,drawDefinition:e,stageSequence:n,stage:i}){if(t===Ar)return function({stage:t,drawDefinition:e}){var n;const{entryProfile:i}=Tr({drawDefinition:e});return(null===(n=i[t])||void 0===n?void 0:n.alternates)||0}({stage:i,drawDefinition:e})?Object.assign({positionsAvailable:1/0},B):{error:"entryStatus not allowed in stage"};const r=function({drawDefinition:t,stageSequence:e,stage:n}){const i=Kd({stage:n,drawDefinition:t}),r=_d({drawDefinition:t,stageSequence:e,stage:n});return i&&i-r}({drawDefinition:e,stageSequence:n,stage:i}),a=function({stage:t,drawDefinition:e}){const{entryProfile:n}=Tr({drawDefinition:e});return n[t].wildcardsCount||0}({drawDefinition:e,stageSequence:n,stage:i}),o=Wr({entryStatus:Rr,drawDefinition:e,stageSequence:n,stage:i}),s=o+Wr({entryStatus:Cr,drawDefinition:e,stageSequence:n,stage:i}),c=r-s;return s>=r?{error:"No stage space available for entryStatus"}:t===Rr?o<a?B:{error:"No stage space available for entryStatus"}:Object.assign({positionsAvailable:c},B)}function El({entryStatus:t=Cr,entryStageSequence:e,entryStage:n=Vi,drawDefinition:i,entryPosition:r,participantId:a,participant:o}){if(!i)return{error:q};if(!n)return{error:"Missing stage"};if(!Ml({stage:n,drawDefinition:i}))return{error:"Invalid stage"};const s=Al({stageSequence:e,stage:n,drawDefinition:i,entryStatus:t});if(!s.success)return{error:s.error};if(!(a=a||(null==o?void 0:o.participantId)))return{error:"Missing participantId"};const c=t===Lr&&Tl({participantId:a,drawDefinition:i,entryStatus:t}),u="VOLUNTARY_CONSOLATION"===n&&Tl({participantId:a,drawDefinition:i,entryStage:n});if(t!==Lr&&"VOLUNTARY_CONSOLATION"!==n&&Tl({drawDefinition:i,participantId:a})||c||u)return{error:"Existing participant"};const d=Wt({...o,entryStageSequence:e,participantId:a,entryPosition:r,entryStatus:t,entryStage:n});return i.entries.push(d),xa({drawDefinition:i}),{...B}}function bl({entryStatus:t=Cr,autoEntryPositions:e=!0,drawDefinition:n,participantIds:i,stageSequence:r,stage:a=Vi}){if(!a)return{error:"Missing stage"};if(!n)return{error:q};if(!Array.isArray(i))return{error:"Invalid participantIds"};if(!Ml({stage:a,drawDefinition:n}))return{error:"Invalid stage"};const o=Al({stageSequence:r,drawDefinition:n,entryStatus:t,stage:a});if(!o.success)return{error:o.error};if((o.positionsAvailable||0)<i.length)return{error:"More Participants than Draw Positions"};const s=i.reduce(((e,i)=>{const r=t===Lr&&Tl({participantId:i,drawDefinition:n,entryStatus:t}),o="VOLUNTARY_CONSOLATION"===a&&Tl({entryStage:a,drawDefinition:n,participantId:i});return t!==Lr&&"VOLUNTARY_CONSOLATION"!==a&&Tl({drawDefinition:n,participantId:i})||r||o?e.concat(i):e}),[]);return i.filter((t=>t&&!s.includes(t))).forEach((e=>{const i=Object.assign({participantId:e},{entryStage:a,entryStatus:t,entryStageSequence:r});n.entries.push(i)})),e&&(n.entries=Il({entries:n.entries})),xa({drawDefinition:n}),null!=s&&s.length?{message:"some participantIds could not be added",participantIdsNotAdded:s,...B}:{...B}}function Rl({autoEntryPositions:t=!0,entryStageSequence:e,drawDefinition:n,participantIds:i,entryStatus:r,entryStage:a,drawId:o,event:s}){if(!o)return{error:"Missing drawId"};if(!s)return{error:"Event not found"};const c=(s.entries||[]).map(Oi);if(i.filter((t=>!c.includes(t))).length)return{error:"Missing entries"};if(n){const o=bl({stageSequence:e,autoEntryPositions:t,stage:a,drawDefinition:n,participantIds:i,entryStatus:r});if(o.error)return o}const{flightProfile:u}=vs({event:s}),d=null==u?void 0:u.flights.find((t=>t.drawId===o));return null!=d&&d.drawEntries&&(i.forEach((t=>{const e=r===Lr&&Cl({participantId:t,entryStatus:r,flight:d}),n="VOLUNTARY_CONSOLATION"===a&&Cl({participantId:t,entryStage:a,flight:d});r!==Lr&&"VOLUNTARY_CONSOLATION"!==a&&Cl({flight:d,participantId:t})||e||n||d.drawEntries.push({participantId:t,entryStatus:r,entryStage:a})})),t&&(d.drawEntries=Il({entries:d.drawEntries}))),B}function Cl({participantId:t,entryStatus:e,entryStage:n,flight:i}){var r;const a=null===(r=i.drawEntries)||void 0===r?void 0:r.find((i=>!(i.participantId!==t||e&&e!==i.entryStatus||n&&n!==i.entryStage)));return t&&a}function Ol(t){var e;const{entryStatus:n=Cr,autoEntryPositions:i=!0,participantIds:r=[],entryStageSequence:a,entryStage:o=Vi,tournamentRecord:s,drawDefinition:c,drawId:u,event:d}=t;if(!d)return{error:W};if(!r||!r.length)return{error:"Missing participantIds"};if(!d||!d.eventId)return{error:"Event not found"};const l=(null==s||null===(e=s.participants)||void 0===e?void 0:e.filter((t=>d.eventType===$t&&t.participantType===Ni||d.eventType===Jt&&t.participantType===Pi||!(d.eventType!==Jt||t.participantType!==Ni||!gl(n))||!(d.eventType!==Di||!(t.participantType===Di||gl(n)&&t.participantType===Ni)))).map((t=>t.participantId)))||[],p=r.filter((t=>!l.length||l.includes(t)));d.entries||(d.entries=[]);const m=d.entries.map((t=>t.participantId||t.participant&&t.participant.participantId));let f;if(p.forEach((t=>{if(!m.includes(t)){const e={participantId:t,entryStatus:n,entryStage:o};a&&(e.entryStageSequence=a),d.entries.push(e)}})),u&&!gl(o)){const t=Rl({participantIds:p,autoEntryPositions:i,entryStageSequence:a,drawDefinition:c,entryStatus:n,entryStage:o,drawId:u,event:d});t.error&&(f=t.error)}if(d.eventType===Jt){const t=(d.entries||[]).map((t=>t.participantId)),e=(d.entries||[]).filter((t=>gl(t.entryStatus))).map((t=>t.participantId)),n=((null==s?void 0:s.participants)||[]).filter((e=>t.includes(e.participantId)&&e.participantType===Pi)).map((t=>t.individualParticipantIds)).flat(1/0),i=e.filter((t=>n.includes(t)));i.length&&Pl({tournamentRecord:s,participantIds:i,autoEntryPositions:!1,event:d})}const h=!(p.length===r.length);return i&&(d.entries=Il({entries:d.entries||[]})),h?{error:"Invalid participantIds"}:Object.assign({message:f},B)}function Ll({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:n,participantId:i,entryStatus:r,drawId:a,event:o}){return function({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:n,participantId:i,entryStatus:r,drawId:a,stage:o,event:s}){if(!e)return{error:G};if(!i)return{error:"Missing participantId"};if(!s)return{error:W};if(![Ui,yi].includes(s.eventType))return{error:"Invalie eventType"};const c=e.participants||[],u=c.find((t=>t.participantId===i));if(!u)return{error:Y};if(![Pi,yi].includes(u.participantType)||u.participantType===yi&&s.eventType!==yi||u.participantType===Pi&&s.eventType!==Ui)return{error:"Invalid participantType"};const d=_r,l=(s.entries||[]).find((t=>t.participantId===i));if(!l)return{error:"Participant Entry Not Found"};const{stageEntries:p}=Dl({entryStatusees:[Cr,Ar,Rr],selected:!1,drawDefinition:n,drawId:a,event:s,stage:o}),m=p.map(Oi),f=c.filter((({participantId:t})=>m.includes(t))).map((({individualParticipantIds:t})=>t)).flat().filter(Boolean),h=u.individualParticipantIds.filter((t=>1===L(t,f).length));let v,I=Pl({event:s,drawId:a,drawDefinition:n,tournamentRecord:e,participantIds:[i]});return I.error||h.length&&(I=Ol({event:s,drawId:a,drawDefinition:n,tournamentRecord:e,entryStage:l.entryStage,entryStatus:r||d,participantIds:h}),I.error)?I:(t&&Nl({tournamentRecord:e,participantIds:[i]}).success&&(v=!0),{...B,participantRemoved:v})}({removeGroupParticipant:t,individualEntryStatus:_r,tournamentRecord:e,drawDefinition:n,participantId:i,entryStatus:r,drawId:a,event:o})}function Fl(t){const{tournamentRecord:e,replaceWithBye:n,drawDefinition:i,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=t,c=ls(t);if(c.error)return c;const{participantId:u}=c,{drawPosition:d,event:l,structureId:p}=t;if([Ar,xr].includes(a)&&u){const{tournamentRecord:e}=t,{participant:n}=Cn({tournamentRecord:e,participantId:u}),{participantType:o,individualParticipantIds:c}=n||{};if(r&&o===Pi){const t=Ll({tournamentRecord:e,drawDefinition:i,participantId:u,event:l});if(t.error)return t;Ul({participantIds:c,tournamentRecord:e,drawDefinition:i,entryStatus:a,drawId:s,event:l})}else Ul({participantIds:[u],tournamentRecord:e,drawDefinition:i,entryStatus:a,drawId:s,event:l})}if(n){const t=Ds({tournamentRecord:e,drawDefinition:i,drawPosition:d,structureId:p,matchUpsMap:o});if(t.error)return t}const{structure:m}=hr({drawDefinition:i,structureId:p});return Bs({structure:m,drawPositions:[d]}),js({drawDefinition:i,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:n,drawPosition:d,entryStatus:a,structureId:p}}),c}function xl({tournamentRecord:t,drawDefinition:e,drawPositions:n,structureId:i}){if(!e)return{error:q};if(!i)return{error:"Missing structureId"};if(2!==(null==n?void 0:n.length))return{error:$,drawPositions:n};const r=Bi({drawDefinition:e}),{matchUps:a}=ya({includeByeMatchUps:!0,inContext:!0,drawDefinition:e,matchUpsMap:r}),{structure:o}=hr({drawDefinition:e,structureId:i});if(!o)return{error:"structure not found"};let s;return s=o.structureType===Ki?function({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,drawPositions:i,matchUpsMap:r,structure:a}){var o;const s=null===(o=a.structures)||void 0===o?void 0:o.reduce(((t,e)=>{const n=null==e?void 0:e.positionAssignments.filter((t=>i.includes(t.drawPosition)));return n&&t.push(...n),t}),[]);if(2===s.filter((({bye:t})=>t)).length)return{...B};if(Ys({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,matchUpsMap:r,assignments:s,structure:a}),s.some((({bye:t})=>t)))kl({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,assignments:s,matchUpsMap:r,structure:a});else{const t=s.map(Oi);s.forEach(((e,n)=>e.participantId=t[1-n]))}return{...B}}({inContextDrawMatchUps:a,tournamentRecord:t,drawDefinition:e,drawPositions:n,matchUpsMap:r,structure:o}):function({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,drawPositions:i,matchUpsMap:r,structure:a}){const o=null==a?void 0:a.positionAssignments.filter((t=>null==i?void 0:i.includes(t.drawPosition)));return o?2===o.filter((({bye:t})=>t)).length?{...B}:o.some((({bye:t})=>t))?kl({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,assignments:o,matchUpsMap:r,structure:a}):function({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,assignments:i,matchUpsMap:r,structure:a}){const o=Object.assign({},...i.map(((t,e)=>{const{drawPosition:n}=t;return{[n]:{...i[1-e],drawPosition:n}}})));return a.positionAssignments=a.positionAssignments.map((t=>o[t.drawPosition]||t)),Ys({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,matchUpsMap:r,assignments:i,structure:a}),{...B}}({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,assignments:o,matchUpsMap:r,structure:a}):{error:$,structure:a,message:"Missing positionAssignments"}}({inContextDrawMatchUps:a,tournamentRecord:t,drawDefinition:e,drawPositions:n,matchUpsMap:r,structure:o}),s.error?s:(Bs({structure:o,drawPositions:n}),js({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:n,structureId:i}}),xa({drawDefinition:e,structureIds:[i]}),{...B})}function kl({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,assignments:i,matchUpsMap:r,structure:a}){const o=i.find((({bye:t})=>t)),s=i.find((({participantId:t})=>t)),c=o.drawPosition,{participantId:u,drawPosition:d}=s,{structureId:l}=a;let p=Fl({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,structureId:l,matchUpsMap:r});return p.error?p:(p=Fl({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,structureId:l,matchUpsMap:r}),p.error?p:(p=Ds({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,structureId:l,matchUpsMap:r}),p=$s({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:n,structureId:l,participantId:u,matchUpsMap:r}),p.error?p:{...B}))}function _l({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:i,subOrder:r,event:a}){if(!e)return{error:q};if(!i)return{error:"Missing structureId"};if(!n)return{error:"Missing drawPosition"};const{structure:o}=hr({drawDefinition:e,structureId:i});let s=o;o.structureType===Ki&&(s=o.structures.find((t=>t.positionAssignments.find((t=>t.drawPosition===n)))));const c=s.positionAssignments,u=c.find((t=>t.drawPosition===n));u&&gr({element:u,extension:{name:"subOrder",value:r}});const{matchUps:d}=oa({structure:s,inContext:!0});return hs({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:(null==o?void 0:o.matchUpFormat)||e.matchUpFormat,matchUps:d,event:a}),xa({drawDefinition:e,structureIds:[i]}),{...B}}const Bl={setSubOrder:_l,clearDrawPosition:ls,assignDrawPosition:$s,setPositionAssignments:hl,automatedPositioning:Gd,assignDrawPositionBye:Ds,swapDrawPositionAssignments:xl,alternateDrawPositionAssignment:fl,resolveDrawPositions:function({participantFactors:t,positionAssignments:e}){if(!t||!e)return{error:z};let n=Ht(t,!1,!0);const i=e.map((({drawPosition:t})=>t)),r=e.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map(Li);let a,o=!0;for(;o;)({drawPositionResolutions:a,remainingPreferences:o,participantPreferences:n}=pl({participantPreferences:n,drawPositionResolutions:a}));const s=Object.keys(a).map((t=>parseInt(t)));let c=r.filter((t=>!s.includes(t))),u=Object.keys(n);const d=O(1,(2,l=(null==i?void 0:i.length)||0,Math.log(l)/Math.log(2)+1)).map((t=>Math.pow(2,t)));var l;const p={};for(const f of d){const e=k(i,f).filter((t=>x(t,c))),n={};if(u.forEach((i=>{e.forEach((e=>{const r=e.join("|");x(e,t[i].preferences)&&(n[r]||(n[r]=[]),n[r].push(i))}))})),M(Object.keys(n)).forEach((t=>{const e=n[t].filter((t=>u.includes(t)));for(;e.length;){const n=R(e),i=t.split("|").map((t=>parseInt(t))).filter((t=>c.includes(parseInt(t))));if(i.length){const e=R(i);c=c.filter((t=>t!==e)),u=u.filter((t=>t!==n)),a[e]=n;const r=t.split("|").length;p[r]||(p[r]=0),p[r]+=1}}})),!c.length)break}const m={chunkResolution:p};return u.length&&(u.forEach((t=>{const e=R(c);e&&(a[e]=t)})),m.randomAssignment=u.length),{drawPositionResolutions:a,report:m}},initializeStructureSeedAssignments:ll,getNextSeedBlock:zs};function jl({drawDefinition:t,event:e,matchUpId:n}){if(!t)return{error:q};if(!n)return{error:"Missing matchUpId"};const{matchUp:i}=ca({drawDefinition:t,event:e,matchUpId:n});return i?Ur({element:i,name:"delegatedOutcome"}):{error:"matchUp not found"}}function Vl({rankedMatchUpValues:t,valueSortedPairings:e,stipulated:n=[],deltaObjects:i}){const r=[].concat(...n),a=[];let o=0;n.filter(Boolean).forEach((e=>{const n=Gl(...e),i=t[n];a.push({participantIds:e,value:i}),o+=t[n]})),e.forEach((t=>{const e=t.pairing.split("|");if(!e.reduce(((t,e)=>r.includes(e)||t),!1)){r.push(...e);let n=t.value;o+=n,a.push({participantIds:e,value:n})}})),a.sort(((t,e)=>t.value-e.value));const s=a.reduce(((t,e)=>{const n=Gl(...e.participantIds),r=i[n];return r>t?r:t}),0);return{value:o,participantIdPairings:a,maxDelta:s}}function Gl(t,e){return[t,e].sort().join("|")}function ql({participantIds:t}){const e={},n=[];t.forEach((i=>{e[i]=t.filter((t=>t!==i)),e[i].forEach((t=>{const e=Gl(t,i);n.includes(e)||n.push(e)}))}));const i=Object.assign({},...n.map((t=>({[t]:0}))));return{uniquePairings:n,possiblePairings:e,deltaObjects:i}}function Hl({tournamentParticipants:t,restrictEntryStatus:e,tournamentRecord:n,generateMatchUps:i,drawDefinition:r,participantIds:a,maxIterations:o,structureId:s,matchUpIds:c,scaleName:u,event:d}){var l;if("object"!=typeof r||r.drawType&&r.drawType!==Ji)return{error:"Invalid drawDefinition"};if(!Array.isArray(r.entries)||a&&!Array.isArray(a))return{error:$};const{eventType:p}=d||{},m=r.entries.filter((({entryStatus:t})=>!e||[Cr,Fr,Rr].includes(t))).map(Oi);if(a){const t=a.filter((t=>!m.includes(t)));if(null!=t&&t.length)return{error:"Invalid participantId",invalidParticipantIds:t}}else a=m;if(!s){var f,h;const t=null===(f=r.structures)||void 0===f||null===(h=f.filter((t=>1===t.stageSequence)))||void 0===h?void 0:h.reduce(((t,e)=>{const n=zi[e.stage];return ea({drawDefinition:r,structure:e})&&n>(zi[null==t?void 0:t.stage]||1)?e:t}),void 0);s=null==t?void 0:t.structureId}const v=null===(l=r.structures)||void 0===l?void 0:l.find((t=>t.structureId===s));if(!v)return{error:"structure not found"};if(!ea({drawDefinition:r,structure:v}))return{error:"Invalid drawDefinition"};const I={};for(const S of a){const e=null==t?void 0:t.find((t=>t.participantId===S));let n=Wl({eventType:p,participant:e});!n&&u&&(n=Wl({scaleValue:n,eventType:p,participant:e})),n&&(I[S]=n)}const{candidatesCount:g,iterations:U,participantIdPairings:y}=function({maxIterations:t=5e3,tournamentParticipants:e,tournamentRecord:n,generateMatchUps:i,drawDefinition:r,participantIds:a,adHocRatings:o,structureId:s,matchUpIds:c,eventType:u,structure:d}){const{encounters:l}=function({matchUps:t}){let e=[];for(const n of t){const t=n.sides.map(Oi);if(2===t.length){const n=Gl(...t);e.includes(n)||e.push(n)}}return{encounters:e}}({matchUps:d.matchUps}),p={};for(const S of l)p[S]||(p[S]=0),p[S]+=50;const m=null==e?void 0:e.filter((({participantType:t})=>t===Di));if(m)for(const S of m){const t=S.individualParticipantIds||[],{uniquePairings:e}=ql({participantIds:t});for(const n of e)p[n]||(p[n]=0),p[n]+=60}const{uniquePairings:f,possiblePairings:h,deltaObjects:v}=ql({participantIds:a}),I={tournamentParticipants:e,possiblePairings:h,drawDefinition:r,participantIds:a,uniquePairings:f,maxIterations:t,adHocRatings:o,deltaObjects:v,valueObjects:p,eventType:u,structure:d},{candidatesCount:g,participantIdPairings:U,iterations:y}=function({tournamentParticipants:t,adHocRatings:e={},possiblePairings:n,uniquePairings:i,maxIterations:r,deltaObjects:a,valueObjects:o,eventType:s}){i.forEach((n=>{const i=function({tournamentParticipants:t,adHocRatings:e,eventType:n,pairing:i}){return i.split("|").map((i=>{if(n===Ui){var r;const n=null==t||null===(r=t.find((t=>t.participantId===i)))||void 0===r?void 0:r.individualParticipantIds;return n?null==n?void 0:n.map((t=>e[t||0])):0}return e[i]||0}))}({tournamentParticipants:t,adHocRatings:e,eventType:s,pairing:n}),r=Math.abs(i[0]-i[1])+1;a[n]=Math.abs(i[0]-i[1]),o[n]||(o[n]=0),o[n]+=Math.pow(r,2)}));const c=i.map((t=>({pairing:t,value:o[t]}))).sort(((t,e)=>t.value-e.value)),{pairingValues:u}=function({possiblePairings:t,valueObjects:e}){let n={};for(const r of Object.keys(t)){let e=t[r].map((t=>i(r,t)));n[r]=e.sort(((t,e)=>t.value-e.value))}function i(t,n){let i=Gl(t,n);return{opponent:n,value:e[i]}}return{pairingValues:n}}({possiblePairings:n,valueObjects:o}),{candidate:d,candidatesCount:l,iterations:p}=function({maxIterations:t=5e3,valueSortedPairings:e,pairingValues:n,deltaObjects:i}){const r=Object.assign({},...e.map((t=>({[t.pairing]:t.value}))));let a=Vl({rankedMatchUpValues:r,valueSortedPairings:e,deltaObjects:i}),o=a;const s=Object.keys(n);let c,u=0,d=s.length;do{d-=1,c=s.length*d*e.length/2}while(c>t&&d>2);let l=[];return s.forEach((t=>{n[t].slice(0,d).forEach((n=>{const s=Gl(t,n.opponent);if(!l.includes(s)){const c=Vl({stipulated:[[t,n.opponent]],rankedMatchUpValues:r,valueSortedPairings:e,deltaObjects:i});c.maxDelta<o.maxDelta&&(o=c),c.value<a.value&&(a=c),l.push(s),u+=1}}))})),{candidate:a,deltaCandidate:o,candidatesCount:u,iterations:c}}({valueSortedPairings:c,maxIterations:r,pairingValues:u,deltaObjects:a}),{participantIdPairings:m}=d;return{candidatesCount:l,participantIdPairings:m,iterations:p}}(I);if(!g)return{error:"No Candidates"};if(i){const t=Wd({participantIdPairings:U,tournamentRecord:n,drawDefinition:r,newRound:!0,structureId:s,matchUpIds:c});if(t.error)return t}return{...B,participantIdPairings:U,candidatesCount:g,iterations:y}}({tournamentParticipants:t,tournamentRecord:n,generateMatchUps:i,drawDefinition:r,participantIds:a,maxIterations:o,adHocRatings:I,matchUpIds:c,structureId:s,structure:v,eventType:p});return{...B,candidatesCount:g,iterations:U,participantIdPairings:y}}function Wl({scaleName:t="dynamic",eventType:e,participant:n}){var i;const r=n&&Bc({scaleAttributes:{eventType:e||gi,scaleType:xc,scaleName:t},participant:n});return null==r||null===(i=r.scaleItem)||void 0===i?void 0:i.scaleValue}function zl({drawDefinition:t,matchUpId:e,outcome:n,matchUp:i}){var r,a;if(!i&&!t)return{error:q};if(!i&&!e)return{error:"Missing matchUp"};if(!n)return{error:z};if(!i){const{error:n,matchUp:r}=ca({drawDefinition:t,matchUpId:e});if(n)return{error:n};i=r}return"object"==typeof n&&null!==(r=n.score)&&void 0!==r&&r.scoreStringSide1&&null!==(a=n.score)&&void 0!==a&&a.scoreStringSide2?gr({element:i,extension:{name:"delegatedOutcome",value:n}}):{error:$}}function Kl(t){return null!==t&&(void 0===t||!isNaN(t))}function Yl({drawDefinition:t,finishingOrder:e}){if(!t)return{error:q};if(!Array.isArray(e))return{error:$,message:"finishingOrder must be an array"};const{completedMatchUps:n,matchUpsMap:i}=Sa({inContext:!0,drawDefinition:t}),r=n.map(Fi),a=e.map(Fi),{matchUpTypes:o,roundNumbers:s,structureIds:c,matchUpTieIds:u}=n.filter((({matchUpId:t})=>a.includes(t))).reduce(((t,e)=>{const{matchUpTieId:n,matchUpType:i,roundNumber:r,structureId:a}=e;return t.matchUpTypes.includes(i)||t.matchUpTypes.push(i),t.roundNumbers.includes(r)||t.roundNumbers.push(r),t.structureIds.includes(a)||t.structureIds.push(a),t.matchUpTieIds.includes(n)||t.matchUpTieIds.push(n),t}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(o.length>1||u.length>1||s.length>1||c.length>1)return{error:$,message:"matchUpType, structureId and roundNumber must be equivalent"};let d,l;const p={},m=[],f=[];if(!e.every((({orderOfFinish:t,matchUpId:e})=>(m.push(e),t&&f.push(t),p[e]=t,d=r.includes(e),l=void 0===t||w(t)&&Math.floor(t)>0,d&&l))))return{error:d?$:"Invalid matchUpStatus",message:d?l?void 0:"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed"};const h=n.filter((t=>t.structureId===c[0]&&t.roundNumber===s[0]&&t.matchUpType===o[0]&&t.matchUpTieId===u[0]&&!m.includes(t.matchUpId)));for(const I of h){const{orderOfFinish:t}=I||{};if(t){if(!w(t))return{error:$,message:"Existing value",matchUp:I};f.push(t)}}if(b(f).length!==f.length||Math.max(...f)>f.length)return{error:$,message:"Values not unique or greater than expected number of values"};if(c.length){var v;const e=Ua({matchUpFilters:{matchUpIds:a},structureId:c[0],drawDefinition:t,matchUpsMap:i});if(e.error)return e;null===(v=e.completedMatchUps)||void 0===v||v.forEach((t=>t.orderOfFinish=p[t.matchUpId]))}return{...B}}const $l={setMatchUpStatus:ec,setMatchUpFormat:ic,isValidMatchUpFormat:h,addMatchUpTimeItem:Io,resetMatchUpTimeItems:function({tournamentRecord:t,drawDefinition:e,matchUpId:n,event:i}){const{matchUp:r}=ca({drawDefinition:e,event:i,matchUpId:n});return r?(r.timeItems=[],La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUp:r}),{...B}):{error:"matchUp not found"}},checkInParticipant:bu,checkOutParticipant:Ru,getCheckedInParticipantIds:ra,addMatchUpScheduleItems:wo,addMatchUpScheduledDate:No,addMatchUpScheduledTime:Do,addMatchUpStartTime:To,addMatchUpEndTime:Mo,addMatchUpStopTime:Ao,addMatchUpResumeTime:Eo,setOrderOfFinish:Yl,setDelegatedOutcome:zl,removeDelegatedOutcome:jl,drawMatic:Hl,matchUpSort:ns,addMatchUpOfficial:Po,findMatchUp:function(t){return Object.assign(t,{inContext:!0}),{matchUp:Ht(ca(t).matchUp,!1,!0)}},getRoundMatchUps:_i,validDrawPositions:function({matchUps:t}){if(!t)return{error:"Missing matchUps"};const e=t.map((t=>t.drawPositions)).flat();et()&&t.forEach((t=>{var e;Array.isArray(t.drawPositions)?null===(e=t.drawPositions)||void 0===e||e.forEach((e=>{Kl(e)||console.log("invalid drawPosition",t)})):console.log("drawPositions not an array",t)}));const n=null==e?void 0:e.every(Kl),i=t.find((t=>!Array.isArray(t.drawPositions)));return n&&!i}};function Jl({drawDefinition:t,policyDefinitions:e}){if(!t)return{error:q};if(!e||"object"!=typeof e)return{error:"Missing policyDefinitions"};t.extensions||(t.extensions=[]);const{appliedPolicies:n}=ki({drawDefinition:t}),i=Object.keys(e).every((t=>!n[t]&&(n[t]=e[t],!0)));if(i){const e=gr({element:t,extension:{name:"appliedPolicies",value:n}});if(e.error)return e}return xa({drawDefinition:t}),i?{...B}:{error:"existing policyType"}}const Zl={attachPolicies:Jl};function Ql({tournamentParticipants:t,drawDefinition:e,event:n}){if(!e)return{error:q};const i=Ht(ya({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:n}).matchUps,!1,!0),r=T(i.reduce(((t,e)=>t.concat(...e.sides.map((t=>t.participantId)).filter(Boolean))),[])),a=Object.assign({},...r.map((t=>{const e=i.filter((e=>e.sides.map((t=>t.participantId)).filter(Boolean).includes(t)));return{[t]:e}})));return{participantIds:r,participantIdMatchUps:a}}function Xl({byeAdvancements:t=!1,tournamentParticipants:e,drawDefinition:n}){if(!n)return{error:q};const{participantIds:i,participantIdMatchUps:r}=Ql({tournamentParticipants:e,drawDefinition:n}),a=i.map((e=>{const n=r[e].filter((t=>[re,ne].includes(t.matchUpStatus)||t.winningSide)),i=n.map((n=>{const i=n.sides.find((t=>t.bye)),r=n.sides.find((t=>t.participantId===e)).sideNumber;return(n.winningSide||t&&i&&r)===r?n.finishingPositionRange.winner:n.finishingPositionRange.loser})),a=t=>Math.abs(t[0]-t[1]),o=i.reduce(((t,e)=>t&&a(t)<a(e)?t:e),void 0);return{[e]:{relevantMatchUps:n,finishingPositionRanges:i,finishingPositionRange:o}}}));return Object.assign({},...a)}function tp(t,e){return t.bye||t.seedValue<e.seedValue||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function ep({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:n,inactiveDrawPositions:i,activeDrawPositions:r,positionAssignments:a,byeDrawPositions:o,drawDefinition:s,isByePosition:c,drawPosition:u,structureId:d,structure:l,drawId:p,event:m}){if(r.includes(u))return{};const f=null==i?void 0:i.filter((t=>t!==u&&!(c&&o.includes(t)))),h=(null==a?void 0:a.filter((e=>(e=>!t||e.participantId||e.qualifier||e.bye)(e)&&(null==f?void 0:f.includes(e.drawPosition)))))||[],v=h.map((({drawPosition:t})=>t)),{matchUps:I}=oa({inContext:!0,drawDefinition:s,structure:l,event:m}),g=I.filter((({drawPositions:t})=>x(t,v))),U=Object.assign({},...g.map((t=>{var e;return null===(e=t.sides)||void 0===e?void 0:e.filter((({sourceDrawPositionRange:t})=>t)).map((({drawPosition:t,sourceDrawPositionRange:e})=>({[t]:e})))})).flat()),y=h.map((t=>t.participantId)).filter(Boolean),S=(n||[]).filter((t=>y.includes(t.participantId))),w=Object.assign({},...S.map((t=>({[t.participantId]:t})))),N=h.map((t=>{const e=w&&w[t.participantId],n=U[t.drawPosition];return{...t,participant:Ht(e,!1,!0),sourceDrawPositionRange:n}}));return N.length?{validSwapAction:{type:"SWAP",method:"swapDrawPositionAssignments",availableAssignments:N,willDisableLinks:e,payload:{drawId:p,structureId:d,drawPositions:[u]}}}:{}}function np({action:t,policyActions:e}){var n;const i=!(null!=e&&e.enabledActions)||(null==e||null===(n=e.disabledActions)||void 0===n?void 0:n.length)&&e.disabledActions.includes(t);return!i&&!(0!==(null==e?void 0:e.enabledActions.length)&&!(null==e?void 0:e.enabledActions.includes(t))||i)}function ip({policyDefinitions:t,tournamentParticipants:e=[],overrideAttachedPolicies:n,tournamentRecord:i,drawDefinition:r,drawPosition:a,structureId:o,event:s}){if(!s)return{error:W};if(!r)return{error:q};if(void 0===a)return{error:"Missing drawPosition"};if(!o)return{error:"Missing structureId"};const{activeDrawPositions:c,byeDrawPositions:u,inactiveDrawPositions:d,structure:l,error:p}=ss({tournamentRecord:i,drawDefinition:r,structureId:o});if(p)return{error:p};const{policyDefinitions:m}=ms({policyTypes:["positionActions"],tournamentRecord:i,drawDefinition:r,event:s}),f=n?t:m?Object.assign(m,t||{}):t,{enabledStructures:h,actionsDisabled:v}=function({policyDefinitions:t,tournamentRecord:e,drawDefinition:n,structure:i,event:r}){const{policyDefinitions:a}=ms({policyTypes:["positionActions"],tournamentRecord:e,drawDefinition:n,event:r}),o=(t=t||a||Xa).positionActions,{enabledStructures:s,disabledStructures:c}=o||{};return{enabledStructures:s,actionsDisabled:null==c?void 0:c.find((t=>{var e,n;return(null===(e=t.stages)||void 0===e?void 0:e.includes(i.stage))&&(!(null!==(n=t.stageSequences)&&void 0!==n&&n.length)||t.stageSequences.includes(i.stageSequence))}))}}({policyDefinitions:f,tournamentRecord:i,drawDefinition:r,structure:l,event:s}),{sourceStructureIds:I}=function({finishingPosition:t,drawDefinition:e,structureId:n,linkType:i}){const{links:r}=fa({drawDefinition:e,structureId:n})||{};return{sourceStructureIds:((null==r?void 0:r.target)||[]).filter((({linkType:t})=>t===i)).map((({source:t})=>t.structureId)).map((t=>{const{structure:n}=hr({drawDefinition:e,structureId:t});return{sourceStructureId:t,sourceFinishingPosition:n.finishingPosition}})).filter((({sourceFinishingPosition:e})=>e===t)).map((({sourceStructureId:t})=>t))}}({finishingPosition:"WIN_RATIO",linkType:"POSITION",drawDefinition:r,structureId:o})||{};let g;null!=I&&I.length&&(g=I.reduce(((t,e)=>xs({drawDefinition:r,structureId:e})&&t),!0));const U=I.length,y=I.length&&!g,{policyActions:S}=function({enabledStructures:t,structure:e}){if(!1===t)return{};if(null==t||!t.length)return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:n,stageSequence:i}=e||{};return{policyActions:t.find((t=>{var e,r;const a=!(null!==(e=t.stages)&&void 0!==e&&e.length)||t.stages.includes(n),o=!(null!==(r=t.stageSequences)&&void 0!==r&&r.length)||t.stageSequences.includes(i);if(t&&a&&o)return!0}))}}({enabledStructures:h,structure:l}),w=![Gi,Vi].includes(l.stage)||1!==l.stageSequence,N=[],{drawId:D}=r,{assignedPositions:P,positionAssignments:M}=Xr({structure:l}),A=P.find((t=>t.drawPosition===a)),E=M.map((t=>t.drawPosition));if(null==E||!E.includes(a))return{error:"Invlid drawPosition"};const{stage:b,stageSequence:R}=l,C=[Cr,Rr],O=[b];b===qi&&O.push(Vi),b===Vi&&O.push(qi);const L=zr({drawDefinition:r,stageSequence:R,entryStatuses:C,structureId:o,stages:O}),F=vl({drawDefinition:r,stages:O}),x=L.filter((t=>!F.includes(t.participantId))).map((t=>t.participantId)),k=u.includes(a),_=c.includes(a);if(v)return{message:"Actions Disabled for structure",isByePosition:k,isActiveDrawPosition:_,isDrawPosition:!0,hasPositionAssigned:!!A,validActions:[]};if(np({policyActions:S,action:"ASSIGN"})&&!_&&!y&&(!A||k)){const{validAssignmentActions:t}=function({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:n,tournamentParticipants:i,isWinRatioFedStructure:r,positionAssignments:a,policyDefinitions:o,drawDefinition:s,isByePosition:c,drawPosition:u,structureId:d,structure:l}){var p,m,f;const{drawId:h}=s,v=[];let I,g,U=[];const y=null==o||null===(p=o.seeding)||void 0===p||null===(m=p.validSeedPositions)||void 0===m?void 0:m.ignore;if(!y){const t=zs({randomize:!0,drawDefinition:s,structureId:d});({unplacedSeedParticipantIds:I,unplacedSeedAssignments:g,unfilledPositions:U}=t)}if(null!==(f=U)&&void 0!==f&&f.length||(U=a.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition))),c||v.push({type:"BYE",method:"assignDrawPositionBye",willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}}),r&&y){var S;const e=a.map((t=>t.participantId)).filter(Boolean),r={structureIds:t},{completedMatchUps:o}=Sa({inContext:!0,matchUpFilters:r,drawDefinition:s}),c=T(null===(S=o||[])||void 0===S?void 0:S.map((({sides:t})=>t.map(Oi))).flat().filter((t=>!e.includes(t)))),l=null==i?void 0:i.filter((t=>null==c?void 0:c.includes(t.participantId)));return null==l||l.forEach((t=>{const e=(s.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),null!=l&&l.length&&v.push({type:"ASSIGN",method:"assignDrawPosition",availableParticipantIds:c,participantsAvailable:l,willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}}),{validAssignmentActions:v}}if(U.includes(u)||c){var w;let t;if(null!==(w=g)&&void 0!==w&&w.length){const e=g.filter((t=>{var e;return null===(e=I)||void 0===e?void 0:e.includes(t.participantId)}));e.sort(tp),t=e.map((t=>t.participantId))}else{t=e;const{unplacedQualifiersCount:n}=jd({drawDefinition:s,structureId:d,structure:l});n&&console.log({unplacedQualifiersCount:n})}const r=null==i?void 0:i.filter((e=>t.includes(e.participantId)));null!=r&&r.length&&v.push({type:"ASSIGN",method:"assignDrawPosition",availableParticipantIds:t,participantsAvailable:r,willDisableLinks:n,payload:{drawId:h,structureId:d,drawPosition:u}})}return{validAssignmentActions:v}}({positionSourceStructureIds:I,unassignedParticipantIds:x,possiblyDisablingAction:w,isWinRatioFedStructure:U,tournamentParticipants:e,positionAssignments:M,activeDrawPositions:c,policyDefinitions:f,drawDefinition:r,isByePosition:k,drawPosition:a,structureId:o,structure:l});null==t||t.forEach((t=>N.push(t)))}const{participantId:B}=A||{},j=B&&e.find((t=>t.participantId===B));if(A){np({policyActions:S,action:"REMOVE"})&&!_&&(N.push({type:"REMOVE",method:"removeDrawPositionAssignment",payload:{drawId:D,structureId:o,drawPosition:a},willDisableLinks:w}),k||N.push({type:"WITHDRAW",method:"withdrawParticipantAtDrawPosition",payload:{drawId:D,structureId:o,drawPosition:a},willDisableLinks:w}),np({policyActions:S,action:"BYE"})&&!k&&N.push({type:"BYE",method:"removeDrawPositionAssignment",payload:{drawId:D,structureId:o,drawPosition:a,replaceWithBye:!0},willDisableLinks:w}));const t=l.stage===Gi||l.stage===Vi&&1===l.stageSequence;if(!k&&np({policyActions:S,action:"SEED_VALUE"})&&Ws({drawDefinition:r,structureId:o,drawPosition:a})&&t){const{seedAssignments:t}=$r({drawDefinition:r,structure:l}),{seedNumber:e,seedValue:n}=t.find((t=>t.participantId===B))||{};N.push({type:"SEED_VALUE",method:"modifySeedAssignment",participant:j,seedNumber:e,payload:{drawId:D,structureId:o,participantId:B,seedValue:n}})}if(!k&&B){if(np({policyActions:S,action:"PENALTY"})){const t={type:"PENALTY",method:"addPenalty",participant:j,payload:{drawId:D,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};N.push(t)}if(np({policyActions:S,action:"NICKNAME"})){const t={type:"NICKNAME",method:"modifyParticipantOtherName",participant:j,payload:{participantId:B,otherName:void 0}};N.push(t)}}if(np({policyActions:S,action:"SWAP"})){const{validSwapAction:t}=ep({drawId:D,structure:l,structureId:o,drawPosition:a,isByePosition:k,drawDefinition:r,byeDrawPositions:u,positionAssignments:M,activeDrawPositions:c,inactiveDrawPositions:d,tournamentParticipants:e,possiblyDisablingAction:w});t&&N.push(t)}}if(np({policyActions:S,action:"ALTERNATE"})&&!y){const{validAlternatesAction:t}=function({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:n,positionAssignments:i,policyDefinitions:r,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l;if(n.includes(o))return{};const p=null==r||null===(l=r.positionActions)||void 0===l?void 0:l.otherFlightEntries,m=(a.entries||[]).sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))).map((({participantId:t})=>t)).filter(Boolean),f=i.map((t=>t.participantId)).filter(Boolean),h=m.filter((t=>!f.includes(t))),v=(d.entries||[]).filter((t=>t.entryStatus===Ar&&function({structure:t,entry:e}){const{stage:n}=t;if(!e.entryStage||e.entryStage===n||e.entryStage===Vi&&n===qi)return!0}({structure:c,entry:t})&&!f.includes(t.participantId))).sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))).map((t=>t.participantId)),I=T(h.concat(v));if(p){var g;const{flightProfile:t}=vs({event:d}),e=null==t||null===(g=t.flights)||void 0===g?void 0:g.filter((t=>t.drawId!==u)).map((t=>t.drawEntries.filter((t=>t.participantId&&![xr,_r,kr].includes(t.entryStatus)&&!m.includes(t.participantId))).map((({participantId:t})=>t)))).flat().filter(Boolean);null!=e&&e.length&&I.push(...e)}const U=null==t?void 0:t.filter((t=>I.includes(t.participantId)));return U.forEach((t=>{const e=(a.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),U.sort(((t,e)=>(t.entryPosition||9999)-(e.entryPosition||9999))),I.length?{validAlternatesAction:{type:"ALTERNATE",method:"alternateDrawPositionAssignment",availableAlternates:U,availableAlternatesParticipantIds:I,willDisableLinks:e,payload:{drawId:u,structureId:s,drawPosition:o}}}:{}}({possiblyDisablingAction:w,tournamentParticipants:e,positionAssignments:M,activeDrawPositions:c,policyDefinitions:f,drawDefinition:r,drawPosition:a,structureId:o,structure:l,drawId:D,event:s});t&&N.push(t)}if(np({policyActions:S,action:"LUCKY"})&&!y){const{validLuckyLosersAction:t}=function({tournamentParticipants:t=[],possiblyDisablingAction:e,isWinRatioFedStructure:n,activeDrawPositions:i,positionAssignments:r,drawDefinition:a,drawPosition:o,structureId:s,structure:c,drawId:u,event:d}){var l,p,m,f;if(i.includes(o)||n)return{};const{sourceStructureIds:h,targetStructureIds:v}=(null===(l=a.links)||void 0===l?void 0:l.reduce(((t,e)=>{var n,i;const r=null===(n=e.source)||void 0===n?void 0:n.structureId,a=null===(i=e.target)||void 0===i?void 0:i.structureId;return t.sourceStructureIds.includes(r)||t.sourceStructureIds.push(r),t.targetStructureIds.includes(a)||t.targetStructureIds.push(a),t}),{sourceStructureIds:[],targetStructureIds:[]}))||{};let I=null===(p=a.links)||void 0===p?void 0:p.find((t=>{var e;return(null===(e=t.target)||void 0===e?void 0:e.structureId)===c.structureId}));const g=null===(m=I)||void 0===m||null===(f=m.source)||void 0===f?void 0:f.structureId,{structure:U}=hr({drawDefinition:a,structureId:g}),y={};if("ROUND_OUTCOME"===(null==U?void 0:U.finishingPosition)&&(1!==(null==h?void 0:h.length)||1!==(null==v?void 0:v.length))){var S,w,N;const{matchUps:t}=oa({drawDefinition:a,structure:c,event:d}),{initialRoundNumber:e}=Lo({drawPosition:o,matchUps:t});I=null===(S=a.links)||void 0===S?void 0:S.find((t=>{var n;return(null===(n=t.target)||void 0===n?void 0:n.structureId)===(null==c?void 0:c.structureId)&&t.target.roundNumber===e}));const n=null===(w=I)||void 0===w||null===(N=w.source)||void 0===N?void 0:N.roundNumber;y.roundNumbers=[n]}const{completedMatchUps:D}=Ua({structureId:g,inContext:!0,matchUpFilters:y,drawDefinition:a}),P=r.map((t=>t.participantId)).filter(Boolean),T=null==D?void 0:D.map((({winningSide:t,sides:e})=>e[1-(t-1)])).map(Oi).filter((t=>!P.includes(t))),M=null==t?void 0:t.filter((t=>null==T?void 0:T.includes(t.participantId)));return null==M||M.forEach((t=>{const e=(a.entries||[]).find((e=>e.participantId===t.participantId));t.entryPosition=null==e?void 0:e.entryPosition})),null!=T&&T.length?{validLuckyLosersAction:{type:"LUCKY",method:"luckyLoserDrawPositionAssignment",availableLuckyLosers:M,availableLuckyLoserParticipantIds:T,willDisableLinks:e,payload:{drawId:u,structureId:s,drawPosition:o}}}:{}}({drawId:D,structure:l,structureId:o,drawPosition:a,drawDefinition:r,activeDrawPositions:c,positionAssignments:M,isWinRatioFedStructure:U,tournamentParticipants:e,possiblyDisablingAction:w});t&&N.push(t)}return{isByePosition:k,isActiveDrawPosition:_,isDrawPosition:!0,hasPositionAssigned:!!A,validActions:N}}const rp={allPlayoffPositionsFilled:ks,isCompletedStructure:xs,getStructureMatchUps:Ua,allStructureMatchUps:function(t){const{structure:e}=hr(t);return Object.assign(t,{structure:e,inContext:!0}),oa(t)},allDrawMatchUps:function(t){return Object.assign(t,{inContext:!0}),ya(t)},drawMatchUps:function(t){return Object.assign(t,{inContext:!0}),Sa(t)},getEliminationDrawSize:ul,getParticipantIdMatchUps:Ql,getParticipantIdFinishingPositions:Xl,structureActions:function(t){return null!=t&&t.drawDefinition?{actions:[],state:{isComplete:xs(t),hasPlayoffPositionsFilled:ks(t)}}:{error:q}},matchUpActions:Qu,positionActions:ip,getStructureSeedAssignments:$r,getNextUnfilledDrawPositions:function({drawDefinition:t,structureId:e}){if(!t)return{error:q,nextUnfilledDrawPositions:[]};if(!e)return{error:"Missing structureId",nextUnfilledDrawPositions:[]};const{structure:n,error:i}=hr({drawDefinition:t,structureId:e});if(i)return{error:i};const r=Xr({structure:n}),a=(null==r?void 0:r.positionAssignments)||[],{unfilledPositions:o}=zs({drawDefinition:t,structureId:e,randomize:!0}),s=a.filter((t=>!t.participantId&&!t.bye&&!t.qualifier)).map((t=>t.drawPosition));return null!=o&&o.length?{nextUnfilledDrawPositions:o}:{nextUnfilledDrawPositions:s}},getExitProfiles:function({drawDefinition:t}){if("object"!=typeof t)return{error:"Invalid drawDefinition"};const e={},{structures:n=[],links:i=[]}=t||{},r=n.reduce(((t,e)=>{const{stage:n}=e;return t[n]?t[n].push(e):t[n]=[e],t}),{});for(const o of Object.keys(r)){const t=r[o].find((({stageSequence:t})=>1===t)),{structureId:n}=t;a(e,"0",o,n,0)}return{exitProfiles:e};function a(t,e,r,o,s){t[o]||(t[o]=[]),"0"===e&&[qi,Hi].includes(r)||t[o].push(e);const c=i.filter((t=>t.source.structureId===o&&t.source.roundNumber>=s));for(const i of c){const r=i.source.roundNumber,o=i.target.roundNumber,s=i.target.structureId;a(t,`${e}-${r}`,n.find((t=>t.structureId===s)).stage,s,o)}}},getMatchUpContextIds:function({matchUps:t,matchUpId:e}){if(!Array.isArray(t))return{error:$};const n=t.find((t=>t.matchUpId===e)),{drawId:i,eventId:r,structureId:a,tournamentId:o}=n||{};return{matchUpId:e,drawId:i,eventId:r,structureId:a,tournamentId:o}},getMatchUpParticipantIds:ia,getMatchUpScheduleDetails:wi,generateTieMatchUpScore:we,matchUpDuration:vi,credits:Zu};function ap({validation:t=!0,drawDefinition:e,participantId:n,structureId:i,seedValue:r}){if(!e)return{error:q};if(!i)return{error:"Missing structureId"};const{structure:a}=hr({drawDefinition:e,structureId:i});if(!a)return{error:"structure not found"};if(!(!t||U(r)||[void 0,""].includes(r)||"string"==typeof r&&r.split("-").every((t=>U(t)&&t>0))))return{error:$};const{seedAssignments:o}=$r({drawDefinition:e,structure:a}),s=o.map((t=>t.seedNumber)),c=o.find((t=>t.participantId===n));if(c){const t="string"==typeof r&&r.includes("-")?r.split("-").map((t=>parseInt(t))).join("-"):r>0?parseInt(r):"";c.seedValue=t}else{const t=Math.max(0,...s)+1;a.seedAssignments.push({seedNumber:t,seedValue:r,participantId:n})}return xa({drawDefinition:e,structureIds:[i]}),B}function op({drawDefinition:t,participantId:e,structureId:n,seedNumber:i,seedValue:r}){const{structure:a}=hr({drawDefinition:t,structureId:n}),{positionAssignments:o}=Xr({structure:a}),{seedAssignments:s}=$r({drawDefinition:t,structure:a}),c=s.map((t=>t.seedNumber)),u=Tl({drawDefinition:t,participantId:e});if(e&&!u)return{error:"Invalid participantId",participantId:e,method:"assignSeed"};const d=o.find((t=>t.participantId===e)),l=null==d?void 0:d.drawPosition;if(l&&!Ws({seedNumber:i,drawDefinition:t,structureId:n,drawPosition:l}))return{error:"Invalid drawPosition for seedAssignment"};if(c.includes(i)){let a;if(s.forEach((t=>{t.participantId===e&&t.seedNumber!==i&&(t.participantId=void 0),t.seedNumber===i&&(t.participantId=e,t.seedValue=r||i,a=!0)})),a)return xa({drawDefinition:t,structureIds:[n]}),{...B}}return{error:"Invalid seedNumber"}}const sp={addDrawEntry:El,addDrawEntries:bl,assignSeed:op,removeEntry:function({participantId:t,drawDefinition:e,autoEntryPositions:n=!0}){return e?t?vl({drawDefinition:e}).includes(t)?{error:"Existing participant drawPosition assignment"}:(null!=e&&e.entries&&(e.entries=e.entries.filter((e=>e.participantId!==t))),n&&(e.entries=Il({entries:e.entries})),xa({drawDefinition:e}),{...B}):{error:"Missing participantId"}:{error:q}},setStageDrawSize:Yd,setStageAlternatesCount:function({drawDefinition:t,stage:e,alternatesCount:n}){return t?Hr({drawDefinition:t,stage:e})?(Pr({attributes:[{[e]:{alternates:n}}],drawDefinition:t}),n||(t.entries=(null===(i=t.entries)||void 0===i?void 0:i.filter((t=>t.entryStatus!==Ar)))||[]),xa({drawDefinition:t}),{...B}):{error:"Invalid stage"}:{error:q};var i},setStageWildcardsCount:function({wildcardsCount:t=0,drawDefinition:e,stageSequence:n,stage:i}){if(!e)return{error:q};if(!Hr({drawDefinition:e,stage:i}))return{error:"Invalid stage"};const r=Kd({drawDefinition:e,stage:i}),a=_d({drawDefinition:e,stageSequence:n,stage:i}),o=Yr({drawDefinition:e,stage:i}),s=Kr({drawDefinition:e,stage:i});return t<o?{error:"Number of Wildcards cannot be less than number of Wildcards already entered"}:s+t+a>r?{error:"Total stage Entries cannot be greater than drawPositions"}:(Pr({attributes:[{[i]:{wildcardsCount:t}}],drawDefinition:e}),xa({drawDefinition:e}),{...B})},setStageQualifiersCount:$d,modifySeedAssignment:ap},cp={generateQualifyingLink:function({qualifyingStructureId:t,mainStructureId:e,qualifyingRoundNumber:n,mainEntryRound:i=1,drawDefinition:r}){if(!r)return{error:q};const a={linkType:"WINNER",source:{roundNumber:n,structureId:t},target:{feedProfile:"DRAW",roundNumber:i,structureId:e}};r.links.push(a),xa({drawDefinition:r})}},up=["drawId","structures"];function dp(t,e=!0){return t?"object"!=typeof t?{error:"Invalid object"}:t.drawId?function(t){const e=Object.keys(t);return up.reduce(((t,n)=>!!e.includes(n)&&t),!0)}(t)?e?Ht(t):t:{error:"Invalid drawDefinition"}:{error:"Missing drawId",method:"setState"}:{error:q}}function lp({drawId:t=Yt(),matchUpType:e,drawType:n}={}){return Object.assign({drawId:void 0,drawName:void 0,matchUpType:void 0,entries:[],links:[],structures:[]},{drawId:t,drawType:n,matchUpType:e})}let pp,mp=[];const fp=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>({drawDefinition:Ht(pp,t,!1,e)}),version:()=>"0.117.10",reset:()=>(pp=void 0,B),newDrawDefinition:({drawId:t,drawType:e}={})=>(pp=lp({drawId:t,drawType:e}),Object.assign({drawId:pp.drawId,drawDefinition:Ht(pp)},B)),setDrawDescription:({description:t}={})=>pp?(pp.description=t,xa({drawDefinition:pp}),Object.assign({drawId:pp.drawId},B)):{error:q}};return[cp,rp,Ba,sp,Zl,$l,Bl,cl].forEach((n=>{Object.keys(n).forEach((i=>{t[i]=t=>{if(et())return e({params:t,governor:n,governorMethod:i});try{return e({params:t,governor:n,governorMethod:i})}catch(e){const r=e.toString();console.log("ERROR",{error:r,method:i,params:JSON.stringify(t)}),console.log(e)}}}))})),t.devContext=e=>(nt(e),t),t.setParticipants=(e=[])=>(mp=e,t),t.setState=(e,n,i)=>(rt(n,i),function(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0,pp=e,t.drawId=e.drawId),t}(dp(e))),t;function e({params:e,governor:n,governorMethod:i}){var r,a,o,s;delete t.success,delete t.error;const c=(null===(r=e)||void 0===r?void 0:r.rollbackOnError)&&Ht(pp,!1,!0);e={...e,tournamentParticipants:mp,drawDefinition:pp};const u=n[i](e);if(null!=u&&u.error)return c&&dp(c),{...u,rolledBack:!!c};const d=(null==u?void 0:u.success)&&!0!==(null===(a=e)||void 0===a?void 0:a.delayNotify)&&!0!==(null===(o=e)||void 0===o?void 0:o.doNotNotify);return d&&Qc(),(d||null==u||!u.success||null!==(s=e)&&void 0!==s&&s.doNotNotify)&&st(),u}}();function hp(t,e){var n;if("object"!=typeof t)return{error:"Invalid object"};const i=(null===(n=t.unifiedTournamentId)||void 0===n?void 0:n.tournamentId)||t.tournamentId;if(!i)return{error:"Missing tournamentId"};const r=!1!==e?Ht(t):t;return ft({[i]:r}),ht(i),r}function vp({convertExtensions:t,removeExtensions:e,tournamentId:n}={}){return"string"!=typeof n?{}:{tournamentRecord:Ht(lt(n),t,!1,e)}}function Ip(t,e){return e&&e.someParam&&(e={...e}),e}const gp={getTournamentPoints:function({tournamentRecord:t,policyDefinition:e}){if(!t)return{error:G};const{policyDefinitions:n}=ms({policyTypes:["rankingPoints"],tournamentRecord:t}),i=(null==e?void 0:e.rankingPoints)||(null==n?void 0:n.rankingPoints);if(!i)return{error:"Missing policyDefinitions"};const{tournamentParticipants:r}=qc({tournamentRecord:t,withDraws:!0}),a=r.filter((t=>{var e;return null===(e=t.draws)||void 0===e?void 0:e.length})),o={};for(const s of a){const{events:t,draws:e,person:n,individualParticipants:r}=s,a=null==n?void 0:n.personId;r&&console.log("individualParticipants"),e.forEach((e=>{var n,r,s,c;const{drawSize:u,eventId:d,finishingPositionRange:l,drawName:p}=e,m=T(l).join("-"),f=null==t?void 0:t.find((t=>t.eventId===d)),{category:h,eventType:v}=f||{},I=(null===(n=i.categories)||void 0===n||null===(r=n[h])||void 0===r?void 0:r.finishingPositionRanges)||i.finishingPositionRanges,g=null==I?void 0:I[m],U=(null==g?void 0:g.value)||(null==g||null===(s=g.drawSizes)||void 0===s||null===(c=s[u])||void 0===c?void 0:c.value)||g;a&&g&&(o[a]||(o[a]=[]),o[a].push({drawName:p,eventType:v,rangeAccessor:m,points:U}))}))}return{personPoints:o,...B}}},Up="ELO",yp={ELO:Up,NTRP:"NTRP",TRN:"TRN",UTR:"UTR",WTN:"WTN"},Sp={[Up]:{range:[0,3e3],decimalsCount:0,defaultInitialization:1500},NTRP:{range:[1,7],decimalsCount:1,defaultInitialization:3,accessor:"dntrpRatingHundredths",accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""}},UTR:{range:[1,16],decimalsCount:2,defaultInitialization:6},WTN:{range:[40,1],decimalsCount:2,defaultInitialization:23,accessor:"wtnRating",accessors:["wtnRating"],attributes:{confidence:90}}},wp={nSpread:400,diffThreshold:.125,kCalc:t=>250/Math.pow(t+5,.4),kMultiplier:function(t=3,e=2){let n=t/e;return isNaN(n)?wp.kDefault():n},kDefault:()=>1};function Np({ratings:t=Sp,winnerCountables:e=1,loserCountables:n=0,ratingType:i=Up,maxCountables:r,winnerRating:a,loserRating:o,ratingRange:s,countables:c}={}){const u=null==t?void 0:t[i];if(!u)return{error:z};s=u.range||s,a=a||u.defaultInitialization,o=o||u.defaultInitialization;const d=s[0]>s[1],l=u.decimalsCount||0,p=d?s.slice().reverse():s,m=(t,e)=>parseFloat(e)>=Math.min(...t)&&parseFloat(e)<=Math.max(...t);m(s,a)&&m(s,o)||(m(s,a)||(a=u.defaultInitialization),m(s,o)||(o=u.defaultInitialization));const f=({value:t,sourceRange:e,targetRange:n})=>(t-e[0])*(n[1]-n[0])/(e[1]-e[0])+n[0],h=f({targetRange:Sp.ELO.range,sourceRange:p,value:d?s[0]-a:a}),v=f({targetRange:Sp.ELO.range,sourceRange:p,value:d?s[0]-o:o}),I=(t,e)=>1/(1+Math.pow(10,(e-t)/wp.nSpread));let g=I(h,v),U=I(v,h),y=wp.kCalc(e),S=wp.kCalc(n),w=wp.kMultiplier(r,c),N=h+w*y*(1-g),D=v+w*S*(0-U),P=f({sourceRange:Sp.ELO.range,value:N,targetRange:p}),T=f({sourceRange:Sp.ELO.range,value:D,targetRange:p});const M=d?s[0]-P:P;let A=parseFloat(M).toFixed(l);const E=d?s[0]-T:T;let b=parseFloat(E).toFixed(l);const R=Math.max(...s)?Math.abs(a-o)/Math.max(...s):0;return(P>T&&R>wp.diffThreshold||A<0||b<0)&&(A=a,b=o),{newWinnerRating:A,newLoserRating:b}}function Dp({tournamentRecord:t,scaleAttributes:e,participantId:n}){if(!t)return{error:G};if(!n)return{error:"Missing participantId"};const{participant:i}=Cn({tournamentRecord:t,participantId:n});return i?Bc({participant:i,scaleAttributes:e}):{error:Y}}function Pp({tournamentRecord:t,participantId:e,scaleItem:n}){let i,r;const a=n&&Object.keys(n)||[],o=["scaleType","eventType","scaleName"],s=o.filter((t=>a.includes(t))).length===o.length;if(!s)return{error:"Invalid scaleItem"};if(e&&s&&Array.isArray(t.participants)&&(r=t.participants.find((t=>t.participantId===e)),r)){const{valueChanged:t,error:e}=Mp({participant:r,scaleItem:n});if(e)return{error:e};i=!t;const{topics:a}=ct();a.includes("modifyParticipants")&&at({topic:"modifyParticipants",payload:{participants:[r]}})}return i?{...B,message:"Value unchanged",existingValue:n.scaleValue}:r?{...B,newValue:n.scaleValue}:{error:Y}}function Tp({scaleItem:t}){const e=t&&Object.keys(t),n=["scaleType","eventType","scaleName"];return!(n.filter((t=>e.includes(t))).length!==n.length)}function Mp({participant:t,scaleItem:e}){if(!t)return{error:"Missing participant"};const n=e&&Object.keys(e),i=["scaleType","eventType","scaleName"];if(i.filter((t=>n.includes(t)&&e[t])).length!==i.length)return{error:"Invalid scaleItem"};const r=(new Date).toISOString();t.timeItems||(t.timeItems=[]);const{scaleItem:a}=Bc({scaleAttributes:e,participant:t}),o=t=>[void 0,null,""].includes(t),s=!(o(null==a?void 0:a.scaleValue)&&o(e.scaleValue))&&(null==a?void 0:a.scaleValue)!==e.scaleValue;if(s){const{scaleType:n,eventType:i,scaleName:a}=e,o=[Fc,n,i,a].join("."),s={itemValue:e.scaleValue,itemDate:e.scaleDate,createdAt:r,itemType:o};e.scaleId&&(s.itemSubTypes=[e.scaleId]),t.timeItems.push(s)}return Object.assign({valueChanged:s,newValue:e.scaleValue},B)}const Ap={calculateNewRatings:Np,processMatchUps:function({tournamentRecord:t,ratingType:e=Up,considerGames:n,matchUpIds:i,asDynamic:r}){if(!t)return{error:G};if(!Array.isArray(i))return{error:"Missing matchUps"};if("string"!=typeof e)return{error:$,ratingType:e};if(!Sp[e])return{error:$};const a=Sp[e],{accessor:o}=a,s={},{matchUps:c}=wa({matchUpFilters:{matchUpIds:i,matchUpStatuses:ge},tournamentRecord:t,inContext:!0});for(const f of c.sort(ns)){const{endDate:i,matchUpFormat:a,matchUpType:c,score:m,sides:h,winningSide:v}=f,I={scaleType:xc,eventType:c,scaleName:e},g=`${e}.DYNAMIC`,U={scaleType:xc,eventType:c,scaleName:g},y=Object.assign({},...h.map((({sideNumber:t,participant:e})=>({[t]:[null==e?void 0:e.participantId,...(null==e?void 0:e.individualParticipantIds)||[]].filter(Boolean).flat()})))),S=r?g:e,w=Object.assign({},...Object.values(y).flat().map((e=>{const{scaleItem:n}=Dp({scaleAttributes:U,tournamentRecord:t,participantId:e}),{scaleItem:r}=Dp({tournamentRecord:t,scaleAttributes:I,participantId:e});return{[e]:n||r||{scaleName:S,scaleType:xc,eventType:c,scaleDate:i,scaleValue:o?{[o]:void 0}:void 0}}}))),N=u(a)||{},D=(null==N?void 0:N.bestOf)||1,P=(null==N?void 0:N.setsTo)||1,T=n?D&P:D,M=null!=m&&m.sets?(null==(p=m.sets)?void 0:p.reduce(((t,e)=>(e.winningSide&&(t[e.winningSide-1]+=1),t)),[0,0]))||[0,0]:1===v?[1,0]:[0,1],A=y[v],E=y[3-v];for(const n of A){var d;const i=null===(d=w[n])||void 0===d?void 0:d.scaleValue,r="object"==typeof i?i[o]:i;for(const a of E){var l;const s=null===(l=w[a])||void 0===l?void 0:l.scaleValue,c="object"==typeof s?s[o]:s,u=M[v],d=M[3-v],{newWinnerRating:p,newLoserRating:m}=Np({winnerCountables:u,loserCountables:d,maxCountables:T,winnerRating:r,loserRating:c,ratingType:e}),f=o?{...i,[o]:p}:p,h=o?{...s,[o]:m}:m;w[n].scaleValue=f,w[a].scaleValue=h;let I=Pp({scaleItem:{...w[n],scaleName:S},participantId:n,tournamentRecord:t});if(I.error)return I;if(I=Pp({scaleItem:{...w[a],scaleName:S},participantId:a,tournamentRecord:t}),I.error)return I}}Object.assign(s,w)}var p;const m=c.map((({matchUpId:t})=>t));return{...B,modifiedScaleValues:s,processedMatchUpIds:m}}};!function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>vp({convertExtensions:t,removeExtensions:e,tournamentId:dt()}),setTournamentId:t=>ht(t)};function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}return t.version=()=>"0.117.10",t.reset=()=>e(vt(dt())),t.setState=(t,n,i)=>(rt(n,i),e(hp(t,n))),[gp,Ap].forEach((e=>{Object.keys(e).forEach((i=>{t[i]=t=>{if(et())return n(e[i],t);try{return n(e[i],t)}catch(e){const r=e.toString();console.log("ERROR",{error:r,method:i,params:JSON.stringify(t)}),console.log(e)}}}))})),t;function n(e,n){const i=(null==n?void 0:n.sandBoxRecord)||(null==n?void 0:n.sandboxRecord)||(null==n?void 0:n.sandboxTournament)||lt(dt()),r=(null==n?void 0:n.rollbackOnError)&&Ht(i,!1,!0),a=function(e,n,i){return delete t.success,delete t.error,n({...Ip(0,i),tournamentRecord:e})}(i,e,n);null!=a&&a.error&&r&&hp(r);const o=(null==a?void 0:a.success)&&!0!==(null==n?void 0:n.delayNotify)&&!0!==(null==n?void 0:n.doNotNotify);return o&&Qc(),(o||null==a||!a.success||null!=n&&n.doNotNotify)&&st(),a}}();function Ep(t={}){return t.tournamentId||Object.assign(t,{tournamentId:Yt()}),t.startDate&&!Et(t.startDate)&&!It.test(t.startDate)||t.endDate&&!Et(t.endDate)&&!It.test(t.endDate)?{error:K}:(t.extensions&&(t.extensions=t.filter(Ir)),{...t})}function bp(t,e){var n;if("object"!=typeof t)return{error:"Invalid object"};const i=(null===(n=t.unifiedTournamentId)||void 0===n?void 0:n.tournamentId)||t.tournamentId;if(!i)return{error:"Missing tournamentId"};const r=!1!==e?Ht(t):t;return ft({[i]:r}),ht(i),r}function Rp({convertExtensions:t,removeExtensions:e,tournamentId:n}={}){return"string"!=typeof n?{}:{tournamentRecord:Ht(lt(n),t,!1,e)}}function Cp(t,e,n){if(e){const{drawId:i}=e||e.matchUp&&e.matchUp.drawId;if(i){const{event:r,drawDefinition:a}=Yn({tournamentRecord:t,drawId:i});if(e={...e,event:r,drawDefinition:a},n){const t=Bi({drawDefinition:a}),{matchUps:n}=ya({drawDefinition:a,inContext:!0,includeByeMatchUps:!0,matchUpsMap:t});e.matchUpsMap=t,e.inContextDrawMatchUps=n}}if(e.eventId&&!e.event){const{event:n}=Yn({tournamentRecord:t,eventId:e.eventId});n&&(e={...e,event:n})}}return e}function Op({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:n,tournamentRecord:i}){if(!i)return{error:G};if(!e||!t)return{error:z};const r=i.participants||[],a=r.find((t=>t.participantId===e));if(!a)return{error:Y};if(![Di,Ti].includes(a.participantType))return{error:"Invalid participantType",participantType:a.participantType};const o=t.filter((t=>{const e=r.find((e=>e.participantId===t));return(null==e?void 0:e.participantType)!==Ni}));if(o.length)return{error:"Invalid participantIds",invalidParticipantIds:o};a.individualParticipantIds||(a.individualParticipantIds=[]);const s=a.individualParticipantIds,c=t.filter((t=>!s.includes(t)));c.length&&(n&&wl({tournamentRecord:i,individualParticipantIds:c}),a.individualParticipantIds=a.individualParticipantIds.concat(...c));const{topics:u}=ct();return u.includes("modifyParticipants")&&at({topic:"modifyParticipants",payload:{participants:[r.find((({participantId:t})=>t===e))]}}),function({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}){const i=(n.events||[]).filter((t=>{var n;return(null==t?void 0:t.eventType)===yi&&(null==t||null===(n=t.entries)||void 0===n?void 0:n.some((t=>t.participantId===e)))})),r=e=>!t.includes(e.participantId);for(const s of i){var a,o;s.entries=(s.entries||[]).filter(r);const{flightProfile:t}=vs({event:s});null==t||null===(a=t.flights)||void 0===a||a.forEach((t=>{t.drawEntries=(t.drawEntries||[]).filter(r)})),null==s||null===(o=s.drawDefinitions)||void 0===o||o.forEach((t=>{t.entries=(t.entries||[]).filter(r)}))}}({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}),{groupingParticipant:Ht(a),added:c.length,...B}}function Lp({participantAttribute:t,tournamentRecord:e,personAttribute:n,teamNames:i,accessor:r,uuids:a}){if(!e)return{error:G};const o={},s=(e.participants||[]).filter((({participantType:t,participantRole:e})=>t===Ni&&e===Lu));let c=0;for(const m of s){const{value:e}=Lc({element:m,accessor:r}),s=e||(n?m.person[n]:m[t]);if(s){if(!Object.keys(o).includes(s)){o[s]={participantName:(null==i?void 0:i[c])||s,participantId:(null==a?void 0:a.pop())||Yt(),participantType:Di,participantRole:Lu,individualParticipantIds:[]};const e={name:"groupingAttribute",value:n||t};gr({element:o[s],extension:e}),c+=1}o[s].individualParticipantIds.push(m.participantId)}}const u=Object.keys(o),d=(e.participants||[]).map((t=>{if(t.participantType!==Di)return;if(t.participantRole!==Lu)return;const{extension:e}=On({element:t,name:"groupingAttribute"}),n=null==e?void 0:e.value;return u.includes(n)?t.participantId:void 0})).filter(Boolean),l=[];let p=0;return Object.keys(o).forEach((t=>{const n=o[t],{participantId:i}=n;d.includes(i)||(e.participants.push(n),l.push(n),p++)})),p&&at({topic:"addParticipants",payload:{participants:l}}),p?{...B,participantsAdded:p}:{error:"No matching participants found"}}const Fp="MALE",xp="FEMALE",kp={ANY:"ANY",MALE:Fp,FEMALE:xp,MIXED:"MIXED",OTHER:"OTHER"};function _p({updateParticipantName:t=!0,groupingParticipantId:e,removeFromOtherTeams:n,tournamentRecord:i,pairOverride:r,participant:a}){if(!i)return{error:G};if(!a)return{error:"Missing participant"};if(!a.participantId)return wc({tournamentRecord:i,participant:a});const{participant:o}=Cn({tournamentRecord:i,participantId:a.participantId});if(!o)return wc({tournamentRecord:i,participant:a});const{participantRoleResponsibilties:s,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:l,participantType:p,onlineProfiles:m,contacts:f,person:h}=a,v={};if(f&&(v.contacts=f),m&&(v.onlineProfiles=m),d&&"string"==typeof d&&(v.participantName=d),u&&"string"==typeof u&&(v.participantOtherName=u),Array.isArray(c)){const{tournamentParticipants:e}=qc({tournamentRecord:i,participantFilters:{participantTypes:[Mi.INDIVIDUAL]}}),n=null==e?void 0:e.map(Oi);if(n){const i=c.filter((t=>"string"==typeof t&&n.includes(t)));([Ti,Zt].includes(p)||p===Pi&&(2===i.length||r))&&(v.individualParticipantIds=i),o.participantType===Mi.PAIR&&t&&(v.participantName=function({individualParticipants:t,newValues:e}){const n=e.individualParticipantIds;let i=t.filter((({participantId:t})=>n.includes(t))).map((({person:t})=>null==t?void 0:t.standardFamilyName)).filter(Boolean).sort().join("/");return 1===n.length&&(i+="/Unknown"),i}({individualParticipants:e,newValues:v}))}}return Object.keys(Fu).includes(l)&&(v.participantRole=l),Object.keys(Mi).includes(p)&&(v.participantType=p),Array.isArray(s)&&(v.participantRoleResponsibilties=s),o.participantType===Mi.INDIVIDUAL&&h&&function({updateParticipantName:t,existingParticipant:e,newValues:n,person:i}){const r={},{sex:a,personId:o,nationalityCode:s,standardFamilyName:c,standardGivenName:u}=i;let d;if(a&&Object.keys(kp).includes(a)&&(r.sex=a),o&&"string"==typeof o&&(r.personId=o),s&&"string"==typeof s&&s.length<4&&(r.nationalityCode=s),c&&"string"==typeof c&&c.length>1&&(r.standardFamilyName=c,d=!0),u&&"string"==typeof u&&u.length>1&&(r.standardGivenName=u,d=!0),d&&t){const t=`${r.standardGivenName} ${r.standardFamilyName}`;n.participantName=t}Object.assign(e.person,r)}({updateParticipantName:t,existingParticipant:o,newValues:v,person:h}),Object.assign(o,Wt(v)),e&&Op({tournamentRecord:i,groupingParticipantId:e,individualParticipantIds:[o.participantId],removeFromOtherTeams:n}),at({topic:"modifyParticipants",payload:{participants:[o]}}),et()?{...B,participant:Ht(o)}:{...B}}const Bp={addPenalty:Kc,modifyPenalty:Jc,removePenalty:Yc,getTournamentPenalties:$c,addPersons:function({participantRole:t=Lu,tournamentRecord:e,persons:n}){var i;if(!e)return{error:G};if(!Array.isArray(n))return{error:$};if(!Object.keys(Fu).includes(t))return{error:"Invalid participantRole"};const r=(e.participants||[]).map((({person:t})=>null==t?void 0:t.personId)).filter(Boolean),a=[];let o=0,s=0,c=Nc({participants:n.filter((t=>t&&(!t.personId||!r.includes(t.personId)))).map((t=>(t.personId||(t.personId=Yt()),a.push(t.personId),t))).map((e=>{return Wt({extensions:e.participantExtensions,timeItems:e.participantTimeItems,participantType:Ni,participantRole:t,person:(n=e,i=["participantExtensions","participantTimeItems","pairedPersons"],Object.assign({},...Object.keys(n).filter((t=>!i.includes(t))).map((t=>({[t]:n[t]})))))});var n,i})),tournamentRecord:e});if(c.error)return c;s=c.addedCount||0;const u=[],d=(null===(i=qc({participantFilters:{participantTypes:[Ni]},tournamentRecord:e}))||void 0===i?void 0:i.tournamentParticipants)||[];if(t===Lu&&n.filter((({pairedPersons:t})=>t)).forEach((({personId:t,pairedPersons:e})=>{Array.isArray(e)&&e.forEach((e=>{const n=[t,e.personId].map((t=>Rn({tournamentParticipants:d,personId:t}))).filter(Boolean);if(2===n.length){const t=n.map(Oi);u.push(Wt({extensions:e.participantExtensions,timeItems:e.timeItems,participantRole:Lu,individualParticipantIds:t,participantType:Pi}))}}))})),u.length){if(c=Nc({participants:u,tournamentRecord:e}),c.error)return c;o=c.addedCount||0}const l=s+o;return{...B,addedCount:l}},addParticipant:wc,addParticipants:Nc,deleteParticipants:Nl,createGroupParticipant:function({tournamentRecord:t,participantId:e,individualParticipantIds:n=[],participantRoleResponsibilities:i,participantRole:r="OTHER",groupName:a}){if(!t)return{error:G};if(!a)return{error:z,message:"Missing groupName"};if(!Array.isArray(n))return{error:$,message:"Invalid individualParticipantIds"};const{tournamentParticipants:o}=qc({tournamentRecord:t,participantFilters:{participantTypes:[Ni]}}),s=o.map((t=>t.participantId));for(const l of n)if(!s.includes(l))return{error:"Invalid participantType",participantId:l};const c=Wt({participantId:e||Yt(),participantType:Ti,participantRole:r,participantName:a,individualParticipantIds:n,participantRoleResponsibilities:i}),u=wc({tournamentRecord:t,participant:c});if(u.error)return u;const{topics:d}=ct();return d.includes("addParticipants")&&at({topic:"addParticipants",payload:{participants:[c]}}),{...B,participant:Ht(c)}},addIndividualParticipantIds:Op,removeIndividualParticipantIds:yl,modifyIndividualParticipantIds:function({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:n}){if(!t)return{error:G};if(!e||!n)return{error:z};const i=t.participants||[],r=i.find((t=>t.participantId===e));if(!r)return{error:Y};if(![Di,Ti].includes(r.participantType))return{error:"Invalid participantType",participantType:r.participantType};const a=n.filter((t=>{const e=i.find((e=>e.participantId===t));return(null==e?void 0:e.participantType)!==Ni}));if(a.length)return{error:"Invalid participantIds",invalidParticipantIds:a};const o=r.individualParticipantIds||[],s=n.filter((t=>!o.includes(t))),c=o.filter((t=>!n.includes(t))),u=Op({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:s});if(u.error)return u;const d=yl({tournamentRecord:t,groupingParticipantId:e,individualParticipantIds:c});if(d.error)return d;const{topics:l}=ct();return l.includes("modifyParticipants")&&at({topic:"modifyParticipants",payload:{participants:[i.find((({participantId:t})=>t===e))]}}),{...u,...d}},removeParticipantIdsFromAllTeams:wl,getParticipantMembership:function({tournamentRecord:t,participantId:e}){if(!t)return{error:G};if(!e)return{error:"Missing participantId"};const{tournamentParticipants:n}=qc({tournamentRecord:t,participantFilters:{participantTypes:[Di,Pi,Ti]}});return(n||[]).filter((t=>{var n;return null===(n=t.individualParticipantIds)||void 0===n?void 0:n.includes(e)})).reduce(((t,e)=>{const{participantType:n}=e;return t[n]||(t[n]=[]),t[n].push(e),t}),{})},generateTeamsFromParticipantAttribute:Lp,getParticipantIdFinishingPositions:function({tournamentRecord:t,drawDefinition:e,byeAdvancements:n=!1}){return t?Xl({tournamentParticipants:t.participants,byeAdvancements:n,drawDefinition:e}):{error:G}},modifyParticipant:_p,modifyParticipantName:function({tournamentRecord:t,participantId:e,participantName:n}){if(!t)return{error:G};if(!e)return{error:"Missing participantId"};if(!n)return{error:z,message:"Missing participantName"};const{participant:i}=Cn({tournamentRecord:t,participantId:e});if(!i)return{error:Y};i.participantName=n;const{topics:r}=ct();return r.includes("modifyParticipants")&&at({topic:"modifyParticipants",payload:{participants:[i]}}),B},modifyParticipantOtherName:function({tournamentRecord:t,participantId:e,participantOtherName:n}){if(!t)return{error:G};if(!e)return{error:"Missing participantId"};const{participant:i}=Cn({tournamentRecord:t,participantId:e});if(!i)return{error:Y};i.participantOtherName=n;const{topics:r}=ct();return r.includes("modifyParticipants")&&at({topic:"modifyParticipants",payload:{participants:[i]}}),B},mergeParticipants:function({tournamentRecord:t,participants:e=[],arraysToMerge:n}){if(!t)return{error:G};t.participants||(t.participants=[]);const i=Object.assign(...e.filter(fs).map((t=>({[t.participantId]:t})))),r=[];t.participants=t.participants.map((t=>{if(i[t.participantId]){const e=Hc(t,i[t.participantId],n);return r.push(e),e}return t}));const a=t.participants.map(Oi),o=e.filter((({participantId:t})=>!a.includes(t))),{topics:s}=ct();return o.length&&(t.participants=t.participants.concat(...o),s.includes("addParticipants")&&at({topic:"addParticipants",payload:{participants:o}})),r.length&&s.includes("modifyParticipants")&&at({topic:"modifyParticipants",payload:{participants:r}}),o.length||r.length?B:void 0},getPairedParticipant:Ai,setParticipantScaleItem:Pp,setParticipantScaleItems:function({scaleItemsWithParticipantIds:t=[],tournamentRecord:e}){if(!e)return{error:G};if(!e.participants)return{error:"Missing participants"};let n=0;const i={},r=[];for(const s of t){const t=null==s?void 0:s.participantId;Array.isArray(null==s?void 0:s.scaleItems)&&s.scaleItems.forEach((e=>{if(!Tp({scaleItem:e}))return{error:"Invalid scaleItem"};Array.isArray(i[t])||(i[t]=[]),i[t].push(e)}))}e.participants.forEach((t=>{const{participantId:e}=t||{};Array.isArray(i[e])&&i[e].forEach((e=>{Mp({participant:t,scaleItem:e}),r.push(t),n++}))}));const a=n?void 0:"No modifications applied",{topics:o}=ct();return o.includes("modifyParticipants")&&n&&at({topic:"modifyParticipants",payload:{participants:r}}),Wt({...B,modificationsApplied:n,message:a})},modifyParticipantsSignInStatus:function({tournamentRecord:t,participantIds:e,signInState:n}){if(!t)return{error:G};if(!Array.isArray(e))return{error:z};if(![Rc,Cc].includes(n))return{error:$,signInState:n};const i=t.participants||[];if(!i.length)return{error:"Missing participants"};const r=[],a=(new Date).toISOString();for(const s of i){const{participantId:i}=s;if(e.includes(i)){const e=fo({tournamentRecord:t,duplicateValues:!1,participantId:i,timeItem:{itemType:"SIGN_IN_STATUS",itemValue:n,createdAt:a}});if(e.error)return e;r.push(s)}}const{topics:o}=ct();return r.length&&o.includes("modifyParticipants")&&at({topic:"modifyParticipants",payload:{participants:r}}),{...B}},getParticipantEventDetails:function({tournamentRecord:t,participantId:e}){if(!t)return{error:G};if(!e)return{error:"Missing participantId"};const n=[e].concat((t.participants||[]).filter((t=>{var n;return[Di,Pi].includes(t.participantType)&&(null===(n=t.individualParticipantIds)||void 0===n?void 0:n.includes(e))})).map((t=>t.participantId)));return{eventDetails:(t.events||[]).filter((t=>x(((null==t?void 0:t.entries)||[]).map((t=>t.participantId)),n))).map((t=>({eventName:t.eventName,eventId:t.eventId})))}},findParticipant:function({tournamentRecord:t,policyDefinitions:e,convertExtensions:n,participantId:i,inContext:r,personId:a}){return t?"string"!=typeof i&&"string"!=typeof a?{error:z}:{participant:Ht(Rn({tournamentParticipants:t.participants||[],policyDefinitions:e,participantId:i,personId:a,inContext:r}),n,!0)}:{error:G}},getTournamentParticipants:qc,getTournamentPersons:function({tournamentRecord:t,participantFilters:e}){if(!t)return{error:G};let n=t.participants||[];e&&(n=Vc({tournamentRecord:t,participantFilters:e,participants:n}));const i={},r=t=>{if(t.person){const{personId:e}=t.person;i[e]?i[e].participantIds.push(t.participantId):i[e]={...t.person,participantIds:[t.participantId]}}};return n.forEach((t=>{t.person&&r(t),t.individualParticipants&&t.individualParticipants.forEach(r)})),{tournamentPersons:Object.values(i)}}};function jp({tournamentParticipants:t=[],policyDefinitions:e,tournamentRecord:n,inContext:i=!0,drawDefinition:r,context:a,event:o}){if(!r)return{error:q};const s=(({drawId:t,drawName:e,matchUpFormat:n,updatedAt:i})=>({matchUpFormat:n,updatedAt:i,drawName:e,drawId:t}))(r);let c,u;const{structureGroups:d}=function({drawDefinition:t}){let e=(t.links||[]).map((t=>[t.source.structureId,t.target.structureId]));const n=e.length;O(0,Math.ceil(n/2)).forEach((()=>{e=O(0,n).map((t=>{const n=e[t],i=e.reduce(((t,e)=>x(n,e)?t.concat(...e):t),[])||[];return T(n.concat(...i))}))}));const i=e[0],r=e.slice(1).reduce(((t,e)=>t&&((t,e)=>F(t,e).length===t.length)(e,i)),!0),a=[i].filter(Boolean);(t.structures||[]).forEach((t=>{const{structureId:e}=t;a.find((t=>t.includes(e)))||a.push([e])}));const o=r&&1===a.length;return{structureGroups:a,allStructuresLinked:o}}({drawDefinition:r});let l=!1,p=!1;const m=d.map((d=>{const m=d.map((t=>{const{structure:e}=hr({drawDefinition:r,structureId:t}),{seedAssignments:n}=$r({drawDefinition:r,structure:e});return e.stage===Vi&&1===e.stageSequence&&(c=n),e.stage===Gi&&1===e.stageSequence&&(u=n),e})).sort(fr).map((d=>{const{structureId:m}=d;let f=[];[Vi,qi,Hi].includes(d.stage)&&(f=c),d.stage===Gi&&(f=u);const{matchUps:h,roundMatchUps:v}=oa({context:{drawId:s.drawId,...a},tournamentParticipants:t,policyDefinitions:e,tournamentRecord:n,seedAssignments:f,drawDefinition:r,structure:d,inContext:i,event:o}),{positionAssignments:I}=Qr({structure:d}),g=I.filter(fs).map((t=>{p=!0;const{drawPosition:e,participantId:n}=t,{extension:i}=On({element:t,name:"tally"});return i&&{drawPosition:e,participantId:n,participantResult:i.value}})).filter((t=>null==t?void 0:t.participantResult)),U=(({stage:t,stageSequence:e,structureName:n,structureType:i,matchUpFormat:r,positionAssignments:a})=>({stage:t,stageSequence:e,structureName:n,structureType:i,matchUpFormat:r,positionAssignments:a}))(d);return U.structureActive=h.reduce(((t,e)=>{var n;const i=[re,ie,ae,ue,pe,se,oe].includes(e.matchUpStatus);return t||i||!!e.winningSide||!(null===(n=e.score)||void 0===n||!n.scoreStringSide1)}),!1),U.structureCompleted=h.reduce(((t,e)=>t&&[ne,re,ue,pe,ae,ee].includes(e.matchUpStatus)),!0),U.structureActive&&(l=!0),{...U,structureId:m,roundMatchUps:v,seedAssignments:f,participantResults:g}}));return m.forEach((t=>delete t.positionAssignments)),m}));if(m.length>1){const t={error:"drawDefinition contains unlinked structures"};return et()&&console.log(t),t}const f=m.flat();return s.drawActive=l,s.participantPlacements=p,s.drawGenerated=null==f?void 0:f.reduce(((t,e)=>t||!(null==e||!e.roundMatchUps)),!1),s.drawCompleted=null==f?void 0:f.reduce(((t,e)=>t&&e.structureCompleted),!0),{...B,drawInfo:Ht(s),structures:Ht(f)}}function Vp({participantsProfile:t,policyDefinitions:e,tournamentRecord:n,usePublishState:i,status:r=ui,event:a}){var o;if(!n)return{error:G};if(!a)return{error:W};const{eventId:s}=a,{tournamentId:c,endDate:u}=n,{timeItem:d}=po({itemType:"PUBLISH.STATUS",event:a}),l=null==d||null===(o=d.itemValue)||void 0===o?void 0:o[r],{tournamentParticipants:p}=qc({withGroupings:!0,withEvents:!1,withDraws:!1,withISO:!0,...t,tournamentRecord:n}),m=(a.drawDefinitions||[]).filter((t=>{var e,n;return!i||0===(null==l||null===(e=l.drawIds)||void 0===e?void 0:e.length)||(null==l||null===(n=l.drawIds)||void 0===n?void 0:n.includes(t.drawId))})).map((t=>(({drawInfo:t,structures:e})=>({...t,structures:e}))(jp({context:{eventId:s,tournamentId:c,endDate:u},tournamentParticipants:p,policyDefinitions:e,tournamentRecord:n,drawDefinition:t,event:a})))),{tournamentInfo:f}=jo({tournamentRecord:n}),h=(n.venues||[]).map((t=>(({venueData:t})=>({...t}))(Kn({tournamentRecord:n,venueId:t.venueId})))),v={eventInfo:(({eventId:t,eventName:e,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:t,eventName:e,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(a),drawsData:m,venuesData:h,tournamentInfo:f};return v.eventInfo.publish={state:null==d?void 0:d.itemValue,createdAt:null==d?void 0:d.createdAt},{...B,eventData:Ht(v)}}function Gp({policyDefinitions:t,tournamentRecord:e,status:n=ui,drawIdsToRemove:i,drawIdsToAdd:r,drawIds:a,structureIdsToRemove:o,structureIdsToAdd:s,structureIds:c,event:u}){var d,l,p;if(!e)return{error:G};if(!u)return{error:W};const m="PUBLISH.STATUS",f=(null===(d=u.drawDefinitions)||void 0===d?void 0:d.map((({drawId:t})=>t)))||[],{timeItem:h}=po({itemType:m,event:u});var v,I,g,U;a||r||i?!a&&(null!=r&&r.length||null!=i&&i.length)&&(a=(null==h||null===(v=h.itemValue)||void 0===v||null===(I=v.PUBLIC)||void 0===I?void 0:I.drawIds)||[]):a=f;a=(a||[]).filter((t=>!(null!=i&&i.length&&i.includes(t)))),null!=r&&r.length&&(a=T(a.concat(...r.filter((t=>f.includes(t)))))),!c&&(null!=s&&s.length||null!=o&&o.length)&&(c=(null==h||null===(g=h.itemValue)||void 0===g||null===(U=g.PUBLIC)||void 0===U?void 0:U.drawIds)||[]),c=(c||[]).filter((t=>!(null!=o&&o.length&&o.includes(t)))),null!=s&&s.length&&(c=T(c.push(...s))),vo({event:u,timeItem:{itemValue:{[n]:{drawIds:a,structureIds:c}},itemType:m}});const{eventData:y}=Vp({usePublishState:!0,policyDefinitions:t,tournamentRecord:e,event:u}),S=null==y||null===(l=y.eventInfo)||void 0===l||null===(p=l.publish)||void 0===p?void 0:p.state;return y.drawsData=y.drawsData.filter((({drawId:t})=>{var e;return null==S||null===(e=S.PUBLIC)||void 0===e?void 0:e.drawIds.includes(t)})),at({topic:"publishEvent",payload:{eventData:y}}),{...B,eventData:y}}const qp={getTournamentInfo:jo,getVenueData:Kn,getCourtInfo:zn,getAllEventData:function({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:G};const n=t.events||[],i=(null==t?void 0:t.participants)||[],{tournamentInfo:r}=jo({tournamentRecord:t}),{venues:a}=Gn({tournamentRecord:t});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:n.map((n=>{const{eventId:r}=n,a=(({eventId:t,eventName:e,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l})=>({eventId:t,eventName:e,eventType:n,eventLevel:i,surfaceCategory:r,matchUpFormat:a,category:o,gender:s,startDate:c,endDate:u,ballType:d,discipline:l}))(n),o=kn({tournamentRecord:t,event:n}).scheduleTiming,s=(n.drawDefinitions||[]).map((a=>{const s=(({drawId:t,drawName:e,matchUpFormat:n,updatedAt:i})=>({drawId:t,drawName:e,matchUpFormat:n,updatedAt:i}))(a),{pendingMatchUps:c,completedMatchUps:u,upcomingMatchUps:d,abandonedMatchUps:l}=Sa({includeByeMatchUps:!1,requireParticipants:!0,tournamentParticipants:i,context:{eventId:r},policyDefinitions:e,tournamentRecord:t,inContext:!0,drawDefinition:a,scheduleTiming:o,event:n});return{drawInfo:s,matchUps:{abandonedMatchUps:l,completedMatchUps:u,upcomingMatchUps:d,pendingMatchUps:c}}})),{timeItem:c}=po({event:n,itemType:"PUBLISH.STATUS"});return Object.assign(a,{publish:null==c?void 0:c.itemValue,drawsData:s}),a}))}}},getEventData:Vp,getDrawData:jp,unPublishEventSeeding:function({tournamentRecord:t,status:e=ui,event:n}){if(!t)return{error:G};if(!n)return{error:W};const i="PUBLISH.STATUS",{timeItem:r}=po({itemType:i,event:n}),a=(null==r?void 0:r.itemValue)||{[e]:{}};return a[e]&&delete a[e].seeding,vo({event:n,timeItem:{itemValue:a,itemType:i}}),at({topic:"unPublishEventSeeding",payload:{eventId:n.eventId}}),{...B}},publishEventSeeding:function({tournamentRecord:t,status:e=ui,drawIds:n=[],event:i}){if(!t)return{error:G};if(!i)return{error:W};const r="PUBLISH.STATUS",{timeItem:a}=po({itemType:r,event:i}),o=(null==a?void 0:a.itemValue)||{[e]:{}};return o[e].seeding={published:!0,drawIds:n},vo({event:i,timeItem:{itemValue:o,itemType:r}}),at({topic:"publishEventSeeding",payload:{eventId:i.eventId,drawIds:n}}),{...B}},unPublishEvent:function({tournamentRecord:t,event:e,status:n=ui}){if(!t)return{error:G};if(!e)return{error:W};const i="PUBLISH.STATUS",{timeItem:r}=po({itemType:i,event:e}),a=(null==r?void 0:r.itemValue)||{[n]:{}};return delete a[n].drawIds,delete a[n].structureIds,vo({event:e,timeItem:{itemValue:a,itemType:i}}),at({topic:"unPublishEvent",payload:{eventId:e.eventId}}),Object.assign({eventId:e.eventId},B)},publishEvent:Gp};function Hp({tournamentRecord:t}){var e;if(!t)return{error:G};const n={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}};return(null===(e=t.events)||void 0===e?void 0:e.map((t=>null==t?void 0:t.drawDefinitions)).flat().filter(Boolean)).forEach((t=>{let e=0,i=0,r=0;const a=((null==t?void 0:t.structures)||[]).map((n=>{const{stage:a,stageSequence:o,structureId:s}=n,c=zi[a],{inContextStructureMatchUps:u}=ss({drawDefinition:t,structure:n}),d=null==u?void 0:u.filter((({winningSide:t})=>t)),l=d.filter(Boolean).length||0;i+=l,r+=u.length-i;const p=Math.max(d.filter((({roundNumber:t})=>1===t)).map((({roundPosition:t})=>t))),{positionAssignments:m}=Qr({structure:n}),f=null==m?void 0:m.filter((({participantId:t})=>t));e+=f.length;const h=((null==m?void 0:m.length)||0)-((null==f?void 0:f.length)||0),{roundMatchUps:v,roundProfile:I,roundNumbers:g,maxMatchUpsCount:U}=_i({matchUps:u}),y=Object.keys(I).filter((t=>!I[t].inactiveRound)).map((t=>parseInt(t))),S=Object.keys(I).filter((t=>I[t].inactiveRound)).map((t=>parseInt(t))),w=Object.values(I).every((t=>t.inactiveRound));return{positionsAssignedCount:(null==f?void 0:f.length)||0,maxWinningSideFirstRoundPosition:p,unassignedPositionsCount:h,inactiveStructure:w,maxMatchUpsCount:U,inactiveRounds:S,roundMatchUps:v,activeRounds:y,roundNumbers:g,roundProfile:I,structureId:s,stageSequence:o,orderNumber:c,stage:a}})),o=a.find((t=>2===t.orderNumber&&1===t.stageSequence)),s=a.filter((({inactiveStructure:t})=>!t)).length,{links:c}=fa({drawDefinition:t,structureId:o.structureId}),u=1===parseInt(o.activeRounds[0])&&1===o.activeRounds.length&&1===s,d=null==a?void 0:a.every((({inactiveStructure:t})=>t)),l=!c.length&&o.activeRounds.length&&(o.roundProfile[1].inactiveCount||o.inactiveRounds.length),p=t.drawId;e&&!i&&n.positionsNoOutcomes.push(p),d&&n.inactive.push(p),u&&n.matchPlay.push(p),l&&n.canBePruned.push(p);const m={matchUpsWithWinningSideCount:i,matchUpsNoOutcomeCount:r,positionsAssignedCount:e,structuresData:a,inactiveDraw:d,isMatchPlay:u,drawId:p};n.drawAnalysis[p]=m})),{...B,drawsAnalysis:n}}function Wp(t){var e,n,i,r,a;const o=null===(e=t.participants)||void 0===e?void 0:e.filter((({participantType:t})=>t===Di)),s=2===(null==o?void 0:o.length),c=1===(null===(n=t.events)||void 0===n?void 0:n.length)&&t.events[0],u=1===(null==c||null===(i=c.drawDefinitions)||void 0===i?void 0:i.length)&&c.drawDefinitions[0],d=1===(null==u||null===(r=u.structures)||void 0===r?void 0:r.length)&&u.structures[0],l=2===(null==d||null===(a=d.positionAssignments)||void 0===a?void 0:a.length);return!!(c.tieFormat&&s&&l)}function zp({tournamentRecord:t,startDate:e,endDate:n}){var i;if(!t)return{error:G};if(e&&!Ut.test(e)||n&&!Ut.test(n))return{error:K};if(!e&&!n)return{error:"Missing date"};if(n&&e&&new Date(n)<new Date(e))return{error:$};let r;(e&&t.startDate&&new Date(e)>new Date(t.startDate)||n&&t.endDate&&new Date(n)<new Date(t.endDate))&&(r=!0),e&&(t.startDate=e),n&&(t.endDate=n),e&&t.endDate&&new Date(e)>new Date(t.endDate)&&(t.endDate=e),n&&t.startDate&&new Date(n)<new Date(t.startDate)&&(t.startDate=n);const a=r&&(null===(i=function({tournamentRecord:t}){const{matchUps:e}=wa({tournamentRecord:t}),n=t.startDate&&new Date(t.startDate),i=t.endDate&&new Date(t.endDate),r=[],a=[];for(const o of e){const{schedule:t,matchUpId:e}=o;if(t&&t.scheduledDate){const o=new Date(t.scheduledDate);(n&&o<n||i&&o>i)&&(a.push(e),r.includes(t.scheduledDate)||r.push(t.scheduledDate))}}return r.length&&!wu({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:"schedule not cleared"}:{unscheduledMatchUpIds:a}}({tournamentRecord:t}))||void 0===i?void 0:i.unscheduledMatchUpIds);return function({tournamentRecord:t}){if(!t)return{error:G};const{startDate:e,endDate:n}=t,i=Mt(e,n),r=[];for(const o of t.venues||[]){var a;null!=o&&null!==(a=o.courts)&&void 0!==a&&a.length&&r.push(...o.courts)}for(const o of r){const{startTime:t,endTime:e}=o.dateAvailability.reduce(((t,e)=>{const n=Rt(t.startTime),i=Rt(t.endTime);return e.startTime&&Rt(e.startTime)<n&&(t.startTime=e.startTime),e.endTime&&Rt(e.endTime)>i&&(t.endTime=e.endTime),t}),{startTime:"08:00",endTime:"18:00"}),n=i.map((n=>o.dateAvailability.find((t=>t.date===n))||{date:n,startTime:t,endTime:e}));o.dateAvailability=n}}({tournamentRecord:t}),{...B,unscheduledMatchUpIds:a}}const Kp={addNotes:ps,removeNotes:function({element:t}={}){return"object"!=typeof t?{error:$}:(t.notes&&delete t.notes,B)},analyzeTournament:function({tournamentRecord:t}){if(!t)return{error:G};const{drawsAnalysis:e}=Hp({tournamentRecord:t}),n={isDual:Wp(t),drawsAnalysis:e};return{...B,analysis:n}},analyzeDraws:Hp,setTournamentName:function({tournamentRecord:t,tournamentName:e,promotionalName:n,formalName:i}){return t?(e&&(t.tournamentName=e),n&&(t.promotionalName=n),i&&(t.formalName=i),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,B):{error:G}},setTournamentNotes:function({tournamentRecord:t,notes:e}){return t?ps({element:t,notes:e}):{error:G}},setTournamentDates:zp,setTournamentEndDate:function({tournamentRecord:t,endDate:e}){return zp({tournamentRecord:t,endDate:e})},setTournamentStartDate:function({tournamentRecord:t,startDate:e}){return zp({tournamentRecord:t,startDate:e})},setTournamentCategories:function({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter((t=>t.categoryName&&t.type)),t.tournamentCategories=e,B):{error:G}},addEventTimeItem:vo,addTournamentTimeItem:ho,addParticipantTimeItem:fo,addEventExtension:wr,removeEventExtension:Dr,addTournamentExtension:yr,removeTournamentExtension:Nr,addParticipantExtension:function({tournamentRecord:t,participantId:e,extension:n}={}){if(!e)return{error:"Missing participantId"};const i=Rn({tournamentParticipants:(null==t?void 0:t.participants)||[],participantId:e});return i?gr({element:i,extension:n}):{error:Y}},removeParticipantExtension:function({tournamentRecord:t,participantId:e,name:n}={}){if(!e)return{error:"Missing participantId"};const i=Rn({tournamentParticipants:(null==t?void 0:t.participants)||[],participantId:e});return i?Ur({element:i,name:n}):{error:Y}},addDrawDefinitionExtension:Sr,removeDrawDefinitionExtension:function({drawDefinition:t,name:e}={}){return t?Ur({element:t,name:e}):{error:"drawDefinition not found"}}},Yp={assignMatchUpCourt:Uo,assignMatchUpVenue:go,addMatchUpScheduleItems:xu,addMatchUpScheduledDate:ku,addMatchUpScheduledTime:_u,addMatchUpStartTime:Bu,addMatchUpEndTime:ju,addMatchUpStopTime:Vu,addMatchUpResumeTime:Gu,addMatchUpOfficial:qu,getMatchUpFormatTiming:jn,modifyMatchUpFormatTiming:tu,getModifiedMatchUpFormatTiming:Xc,getEventMatchUpFormatTiming:ru,modifyEventMatchUpFormatTiming:nu,removeEventMatchUpFormatTiming:Eu,getMatchUpFormatTimingUpdate:function({tournamentRecord:t}){if(!t)return{error:G};const e=[],{extension:n}=Ln({tournamentRecord:t,name:"scheduleTiming"});n&&e.push({method:"addTournamentExtension",params:{extension:n}});const i=t.events||[];for(const r of i){const{eventId:t}=r,{extension:n}=Fn({event:r,name:"scheduleTiming"});n&&e.push({method:"addEventExtension",params:{eventId:t,extension:n}})}return{methods:e}},getMatchUpDailyLimits:Du,setMatchUpDailyLimits:Wu,getMatchUpDailyLimitsUpdate:function({tournamentRecord:t}){if(!t)return{error:G};const e=[],{extension:n}=Ln({tournamentRecord:t,name:"scheduleLimits"});n&&e.push({method:"addTournamentExtension",params:{extension:n}});const i=t.events||[];for(const r of i){const{eventId:t}=r,{extension:n}=Fn({event:r,name:"scheduleLimits"});n&&e.push({method:"addEventExtension",params:{eventId:t,extension:n}})}return{methods:e}},validateSchedulingProfile:_o,setSchedulingProfile:function({tournamentRecord:t,schedulingProfile:e}){return t?Array.isArray(e)?cc({tournamentRecord:t,schedulingProfile:e}):{error:$}:{error:G}},getSchedulingProfile:sc,removeMatchUpCourtAssignment:function({drawDefinition:t,matchUpId:e,courtDayDate:n}){return Ou({drawDefinition:t,matchUpId:e,courtDayDate:n})},clearScheduledMatchUps:wu,bulkScheduleMatchUps:bo,bulkRescheduleMatchUps:Hu};function $p({tournamentRecord:t,categoryName:e,categoryType:n}){if(!t)return{error:G};const{appliedPolicies:i}=Mn({tournamentRecord:t}),r=null==i?void 0:i.draws;return((null==r?void 0:r.allowedDrawTypes)||[]).filter((({categoryNames:t,categoryTypes:i})=>!e&&!i||e&&(null==t?void 0:t.includes(e))||n&&(null==i?void 0:i.includes(n))))}function Jp({policyDefinitions:t,drawDefinition:e,drawSize:n,drawId:i,event:r,stage:a}){if(!r)return{error:W};const{entries:o,stageEntries:s}=Dl({drawDefinition:e,drawId:i,stage:a,event:r}),c=s.length,{drawSize:u}=ul({participantCount:c}),{seedsCount:d,error:l}=dl({drawSize:n||u,policyDefinitions:t,participantCount:c});return l?{error:l}:{entries:o,seedsCount:d,stageEntries:s}}const Zp={attachPolicies:Yu,attachEventPolicies:$u,removeEventPolicy:function({event:t,policyType:e}){if(!e)return{error:z};if(!t)return{error:W};let n;if(t.extensions){const{appliedPolicies:i}=An({event:t});i&&i[e]&&(delete i[e],n=!0,Object.keys(i).length?wr({event:t,extension:{name:"appliedPolicies",value:i}}):Dr({event:t,name:"appliedPolicies"}))}return n?B:{error:"Policy not found"}},findPolicy:bn,getSeedsCount:dl,getEntriesAndSeedsCount:Jp,getAllowedDrawTypes:$p,getAllowedMatchUpFormats:function({tournamentRecord:t,categoryName:e,categoryType:n}){if(!t)return{error:G};const{appliedPolicies:i}=Mn({tournamentRecord:t}),r=null==i?void 0:i.scoring;return((null==r?void 0:r.matchUpFormats)||[]).filter((({categoryNames:t,categoryTypes:i})=>!e&&!i||e&&(null==t?void 0:t.includes(e))||n&&(null==i?void 0:i.includes(n))))},getEventAppliedPolicies:An};function Qp({event:t,participants:e,ignoreGender:n}){if(!e)return{error:"Missing participants"};if(!Array.isArray(e))return{error:$};if(!t)return{error:W};const{eventType:i,gender:r}=t,a=i===$t?Ni:i===Jt?Pi:Zt,o=Object.assign({},...(t.entries||[]).map((t=>({[t.participantId]:t.entryStatus})))),s=Object.keys(o),c=e.filter((t=>s.includes(t.participantId))).filter((t=>{const e=o[t.participantId],s=[Jt,Zt].includes(i)&&t.participantType===Ni&&(gl(e)||e===xr),c=t.participantType!==a&&!s,u=!n&&i===Ni&&[Fp,xp].includes(r)&&t.sex!==r;return c||u}));return c.length?{error:"Invalid entries",invalidParticipantIds:c.map((t=>t.participantId))}:B}function Xp({element:t,participantId:e,stage:n,stageSequence:i}){const r=(t.entries||[]).filter((t=>t.entryStatus===Ar)),a=(t.entries||[]).find((t=>t.participantId===e))||r.reduce(((t,e)=>{const{entryPosition:n}=e;return isNaN(n)?t:!t||n<t.entryPosition?e:t}),void 0);if(!a)return{error:"Participant Entry Not Found"};if(a.entryStatus!==Ar)return{error:"Invalid entry status"};if(a.stage&&a.entryStage!==n)return{error:"Participant not entered in stage"};if(i&&a.stageSequence!==i)return{error:"Participant not found in stageSequence"};a.entryStatus=Cr;const o=null==a?void 0:a.entryPosition;isNaN(o)||t.entries.forEach((t=>{t.entryStatus===Ar&&t.entryPosition>o&&(t.entryPosition=t.entryPosition-1)}));let s=Math.max(...t.entries.filter((t=>t.entryStatus===Cr&&!isNaN(t.entryPosition))).map((({entryPosition:t})=>parseInt(t||0))),0);return a.entryPosition=s||0,B}const tm={STANDARD:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},COLLEGE_D3:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_D3",valueGoal:5},COLLEGE_DEFAULT:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:"SET1-S:6/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_DEFAULT",valueGoal:4},COLLEGE_JUCO:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:"SET3-S:6/TB7"},tieFormatName:"COLLEGE_JUCO",valueGoal:5},LAVER_CUP:Ga,DOMINANT_DUO:ja,DOMINANT_DUO_MIXED:Va,TEAM_DOUBLES_3_AGGREGATION:qa,USTA_BREWER_CUP:Ha,USTA_COLLEGE:Wa,USTA_GOLD_TEAM_CHALLENGE:za,USTA_INTERSECTIONAL:Ka,USTA_LEVEL_1:Ya,USTA_SOUTHERN_LEVEL_5:$a,USTA_WTT:Ja,USTA_ZONAL:Za},em=({namedFormat:t,uuids:e=[]}={})=>{var n,i;Object.keys(tm).includes(t)||(t="STANDARD"),Array.isArray(e)||(e=[]);const r=tm[t];if(!r.hydrate)return r.collectionDefinitions.forEach((t=>t.collectionId=Yt())),r;const a={winCriteria:{valueGoal:r.valueGoal},collectionDefinitions:[{collectionId:(null===(n=e)||void 0===n?void 0:n.pop())||Yt(),collectionName:"Doubles",matchUpType:Jt,matchUpFormat:"SET3-S:6/TB7-F:TB10",...r.doubles},{collectionId:(null===(i=e)||void 0===i?void 0:i.pop())||Yt(),collectionName:"Singles",matchUpType:$t,matchUpFormat:"SET3-S:6/TB7",...r.singles}]};return r.tieFormatName&&(a.tieFormatName=r.tieFormatName),a};function nm({tournamentRecord:t,event:e}){if(!t)return{error:G};t.events||(t.events=[]);const{startDate:n,endDate:i}=t,r=Object.assign({},{startDate:n,endDate:i,eventType:gi},e);e.eventType===yi&&e.tieFormatName&&Qa[e.tieFormatName]&&(r.tieFormat=em({namedFormat:e.tieFormatName})),r.eventId||(r.eventId=Yt());return t.events.reduce(((t,e)=>t||e.eventId===r.eventId),void 0)?{error:"Event exists"}:(t.events.push(r),{...B,event:r})}function im({applyPositioning:t=!0,candidatesCount:e=1,tournamentRecord:n,drawDefinition:i,structureId:r,seedsOnly:a,event:o}){if(!o)return{error:"Event not found"};if(!i)return{error:"drawDefinition not found"};if(!xs({drawDefinition:i,structureId:r}))return{error:"Incomplete source structure"};const{playoffStructures:s}=Fs({drawDefinition:i,structureId:r}),c=[],u=null==n?void 0:n.participants;if(s)for(const d of s){const{structureId:n}=d,r=Gd({structureId:n,applyPositioning:t,candidatesCount:e,drawDefinition:i,participants:u,seedsOnly:a});if(r.error)return r;c.push({positionAssignments:r.positionAssignments,structureId:n})}return{...B,structurePositionAssignments:c}}function rm({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:n,drawDefinition:i,participantIds:r,collectionId:a}){var o;if(!a||!t||!Array.isArray(r))return{error:$,modifiedLineUp:(null==n?void 0:n.lineUp)||[]};const s=(null==n?void 0:n.lineUp)||(null===(o=Ei({participantId:e,drawDefinition:i}))||void 0===o?void 0:o.lineUp),c=[];return{modifiedLineUp:(null==s?void 0:s.map((e=>{var n;if(!r.includes(e.participantId))return e;const i=null===(n=e.collectionAssignments)||void 0===n?void 0:n.filter((n=>{const i=n.collectionId===a&&n.collectionPosition===t;return i&&c.push({participantId:e.participantId,...n}),!i}));return{participantId:e.participantId,collectionAssignments:i}})).filter(Boolean))||[],assignmentsRemoved:c}}function am({lineUp:t,tieFormat:e}){var n;let i=[];if(!Array.isArray(t))return i.push("lineUp must be an array of objects"),{valid:!1,errors:i,error:$};const r=(null==e||null===(n=e.collectionDefinitions)||void 0===n?void 0:n.map((({collectionId:t})=>t)))||[],a=t.every((t=>{if("object"!=typeof t)return i.push("lineUp entries must be objects"),!1;const{participantId:e,collectionAssignments:n}=t;return e?"string"!=typeof e?(i.push("participantIds must be strings"),!1):Array.isArray(n)?n.every((t=>{if("object"!=typeof t)return i.push("collectionAssignments must be objects"),!1;const{collectionPosition:e,collectionId:n}=t;return"number"!=typeof e?(i.push("collectionPosition must be a number"),!1):!!r.includes(n)||(i.push("Invalid collectionId"),!1)})):(i.push("collectionAssignments must be an array"),!1):(i.push("Missing participantId"),!1)})),o=T(t.map(Oi)).length===t.length;return o||i.push("Duplicated participantId(s)"),{valid:a&&o,errors:i,error:i.length?$:void 0}}function om({drawDefinition:t,participantId:e,tieFormat:n,lineUp:i}){if("object"!=typeof t)return{error:q};if("string"!=typeof e)return{error:"Missing participantId"};const r=am({lineUp:i,tieFormat:n});if(!r.valid)return r;const{extension:a}=On({element:t,name:"lineUps"}),o=(null==a?void 0:a.value)||{};return o[e]=i,gr({element:t,extension:{name:"lineUps",value:o}}),Fa({drawDefinition:t}),{...B}}function sm({tournamentRecord:t,drawDefinition:e,tieMatchUpId:n,event:i}){if(!t)return{error:G};if(!e)return{error:"Missing drawId"};if(!i)return{error:"Event not found"};const r=Bi({drawDefinition:e}),{matchUp:a,structure:o}=ca({tournamentParticipants:t.participants,matchUpId:n,inContext:!0,drawDefinition:e,matchUpsMap:r,event:i});if(!a)return{error:"matchUp not found"};const{collectionPosition:s,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:l}=a;if(![$t,Jt].includes(l))return{error:"Invalid matchUp"};const{positionAssignments:p}=Qr({structure:o}),m=null==p?void 0:p.filter((t=>null==c?void 0:c.includes(t.drawPosition))),f=Ci(m),{tournamentParticipants:h}=qc({tournamentRecord:t,participantFilters:{participantTypes:[Di],participantIds:f}}),{matchUp:v}=ca({matchUpId:d,drawDefinition:e,matchUpsMap:r});return{relevantAssignments:m,collectionPosition:s,teamParticipants:h,collectionId:u,matchUpType:l,dualMatchUp:v,tieMatchUp:a,tieFormat:v.tieFormat||o.tieFormat||e.tieFormat||i.tieFormat||void 0,structure:o,...B}}function cm(t){var e,n,i,r,a;const o=sm(t);if(o.error)return o;let s=t.teamParticipantId;const{tournamentRecord:c,drawDefinition:u,participantId:d}=t;if(!d)return{error:"Missing participantId"};const{relevantAssignments:l,collectionPosition:p,teamParticipants:m,collectionId:f,matchUpType:h,dualMatchUp:v,tieMatchUp:I,tieFormat:g}=o,{tournamentParticipants:[U]}=qc({tournamentRecord:c,participantFilters:{participantIds:[d]}});if(!U)return{error:Y};const{individualParticipantIds:y,participantType:S}=U;if(h===$t&&S!==Ni)return{error:"Invalid participantType"};const w=S===Ni?[d]:y,N=s?m.find((({participantId:t})=>t===s)):m.find((({individualParticipantIds:t})=>x(w,t)));if(!N)return{error:"Team not found"};if(s||(s=N.participantId),!s)return{error:Y};const D=l.find((t=>t.participantId===(null==N?void 0:N.participantId))),P=null==D?void 0:D.drawPosition,T=I.sides.find((({drawPosition:t})=>t===P)),M=null==T?void 0:T.sideNumber;if(!g)return{error:"Missing tieFormat"};if(!(null===(e=g.collectionDefinitions)||void 0===e?void 0:e.find((t=>t.collectionId===f))))return{error:"Missing collectionDefinition"};if(null===(n=v.sides)||void 0===n||!n.length){const t=({displaySideNumber:t,drawPosition:e,sideNumber:n})=>({drawPosition:e,sideNumber:n,displaySideNumber:t});v.sides=[{...t(I.sides[0]),lineUp:[]},{...t(I.sides[1]),lineUp:[]}]}const A=v.sides.find((t=>t.sideNumber===M)),E=I.sides.find((t=>t.sideNumber===M)),b=(null==A?void 0:A.lineUp)||(null===(i=Ei({participantId:s,drawDefinition:u}))||void 0===i?void 0:i.lineUp),R=null==b||null===(r=b.filter((t=>t.collectionAssignments.find((t=>t.collectionId===f&&t.collectionPosition===p)))))||void 0===r?void 0:r.map((t=>null==t?void 0:t.participantId)),C=(null==R?void 0:R.length)>1?R:S===Pi?U.individualParticipantIds:[d],O=null===(a=rm({participantIds:C,collectionPosition:p,teamParticipantId:s,dualMatchUpSide:A,drawDefinition:u,collectionId:f}))||void 0===a?void 0:a.modifiedLineUp;let L;if(h===Jt){if(S!==Pi){var F;let t=um({collectionPosition:p,teamParticipantId:s,drawDefinition:u,modifiedLineUp:O,participantId:d,collectionId:f,tieFormat:g});if(null!==(F=t)&&void 0!==F&&F.error)return t;if(t=function({side:t}){let e;if(t.participant){const n=t.participant.individualParticipantIds||[];if(1===n.filter(Boolean).length){const{participant:t}=Ai({participantIds:n,tournamentRecord:c});n.push(d);const{participant:i}=Ai({participantIds:n,tournamentRecord:c});if(i)e=t.participantId;else{t.individualParticipantIds=n;const e=_p({individualParticipantIds:n,pairOverride:!0,tournamentRecord:c,participant:t});if(e.error)return e}}}else{const t=wc({participant:{participantType:Pi,participantRole:Lu,individualParticipantIds:[d]},pairOverride:!0,tournamentRecord:c});if(t.error)return t}return{...B,deleteParticipantId:e}}({side:E}),t.error)return t;L=t.deleteParticipantId,A.lineUp=O,La({tournamentId:null==c?void 0:c.tournamentId,matchUp:v,drawDefinition:u})}else if(S===Pi)for(const x of C)um({collectionPosition:p,teamParticipantId:s,drawDefinition:u,modifiedLineUp:O,participantId:x,collectionId:f,tieFormat:g})}else{const t=um({collectionPosition:p,teamParticipantId:s,drawDefinition:u,modifiedLineUp:O,participantId:d,collectionId:f,tieFormat:g});if(null!=t&&t.error)return t}if(A.lineUp=O,La({tournamentId:null==c?void 0:c.tournamentId,matchUp:v,drawDefinition:u}),L){const{error:t}=Nl({participantIds:[L],tournamentRecord:c});t&&console.log("cleanup")}return{...B,modifiedLineUp:O}}function um({collectionPosition:t,teamParticipantId:e,drawDefinition:n,modifiedLineUp:i,participantId:r,collectionId:a,tieFormat:o}){var s,c;const u=null===(s=Ei({participantId:e,drawDefinition:n}))||void 0===s?void 0:s.lineUp,d=null===(c=i||u)||void 0===c?void 0:c.find((t=>(null==t?void 0:t.participantId)===r)),l={collectionId:a,collectionPosition:t};if(d)d.collectionAssignments.push(l);else{const t={collectionAssignments:[l],participantId:r};i.push(t)}return om({participantId:e,lineUp:i,drawDefinition:n,tieFormat:o})}function dm({drawDefinition:t,participantIds:e}){if("object"!=typeof t)return{error:q};if(!Array.isArray(e))return{error:"Invalid participantIds"};const{extension:n}=On({element:t,name:"lineUps"}),i=(null==n?void 0:n.value)||{},r=Object.keys(i).find((t=>i[t].map(Oi).some((t=>e.includes(t)))));return{lineUp:i[r],teamParticipantId:r}}function lm({tournamentRecord:t,drawIds:e=[],auditData:n,eventId:i}){var r;if(!t)return{error:G};const a=Array.isArray(e)&&e[0],{event:o,error:s}=Yn({tournamentRecord:t,eventId:i,drawId:a});if(s)return{error:s};const c=[],u=[],d=[];if(!o.drawDefinitions)return{error:"drawDefinition not found"};const l=o.drawDefinitions.map((({drawId:t})=>t));e.length||(e=l);if(!(e.length&&e.every((t=>l.includes(t)))))return{error:"drawDefinition not found"};o.drawDefinitions=o.drawDefinitions.filter((t=>{if(e.includes(t.drawId)){const e={action:"deleteDrawDefinitions",payload:{drawDefinitions:[t],eventId:o.eventId,auditData:n}};c.push(e);const{drawId:i,drawType:r,drawName:a}=t;d.push({auditData:n,drawId:i,drawType:r,drawName:a,eventId:o.eventId});const{matchUps:s}=Na({event:o,drawDefinition:t});s.forEach((({matchUpId:t})=>u.push(t)))}return!e.includes(t.drawId)})),cc({tournamentRecord:t});const{timeItem:p}=lo({element:o,itemType:"PUBLISH.STATUS"}),m=null==p||null===(r=p.itemValue)||void 0===r?void 0:r.PUBLIC;for(const v of e){var f;if(null==m||null===(f=m.drawIds)||void 0===f?void 0:f.includes(v)){var h;const t=(null===(h=m.drawIds)||void 0===h?void 0:h.filter((t=>t!==v)))||[],e=vo({event:o,timeItem:{itemType:"PUBLISH.STATUS",itemValue:{[ui]:{drawIds:t}}}});if(e.error)return{error:e.error}}}if(c.length){at({topic:"audit",payload:c});const t=vo({event:o,timeItem:{itemType:"deleteDrawDefinitions",itemValue:d}});if(t.error)return t}return u.length&&Oa({tournamentId:null==t?void 0:t.tournamentId,matchUpIds:u}),e.forEach((t=>{!function({drawId:t}){at({topic:"deletedDrawIds",payload:{drawId:t}})}({drawId:t})})),B}function pm({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:n,scaleSortMethod:i,stageSequence:r,entries:a,event:o,stage:s}){return e?{scaledEntries:(a=a||(null==o?void 0:o.entries)||[]).filter((t=>(!s||!t.entryStage||t.entryStage===s)&&(!r||!t.entryStageSequence||t.entryStageSequence===r)&&Vr.includes(t.entryStatus))).map((t=>{const{participantId:i}=t,{scaleItem:r}=Dp({tournamentRecord:e,scaleAttributes:n,participantId:i});return{...t,...r}})).filter((t=>{const e=t.scaleValue;return!!(i||!isNaN(e)&&parseFloat(e))&&e})).sort(i||function(e,n){return t?c(n)-c(e):c(e)-c(n)})}:{error:G};function c(e){return parseFloat(e.scaleValue||(t?-1:1e5))}}function mm({inContextDrawMatchUps:t,matchUpsMap:e,participants:n,tournamentRecord:i,drawDefinition:r,automated:a,drawType:o,drawSize:s,entries:c,event:u,enforcePolicyLimits:d=!0,seedAssignmentProfile:l,seedByRanking:p=!0,seededParticipants:m,assignSeedsCount:f,seedingScaleName:h,seedsCount:v,stageSequence:I=1,stage:g}){const U=null==u?void 0:u.eventType,y=c.filter((t=>(!t.entryStage||t.entryStage===g)&&(!I||!t.entryStageSequence||t.entryStageSequence===I)&&Vr.includes(t.entryStatus)));m&&(v=m.length),v>s&&(v=s),v>y.length&&(v=y.length);const{structures:S}=vr({drawDefinition:r,stageSequence:I,stage:g}),[w]=S,{structureId:N}=w||{},{seedLimit:D}=ll({participantCount:y.length,enforcePolicyLimits:d,tournamentRecord:i,drawDefinition:r,structureId:N,seedsCount:v,event:u});D&&D<v&&(v=D);const P=c.map(Oi);if(m)m.filter((({participantId:t})=>P.includes(t))).filter((t=>!t.seedNumber||t.seedNumber<=m.length)).sort(((t,e)=>t.seedNumber<e.seedNumber?-1:t.seedNumber<e.seedNumber?1:0)).forEach((t=>{const{participantId:e,seedNumber:n,seedValue:i}=t;op({drawDefinition:r,participantId:e,structureId:N,seedNumber:n,seedValue:i})}));else if(u||h){var T,M;const{categoryName:t,ageCategoryCode:e}=(null==u?void 0:u.category)||{},n={scaleType:"SEEDING",scaleName:h||t||e||u.eventId,eventType:U};let{scaledEntries:a}=pm({scaleAttributes:n,tournamentRecord:i,stageSequence:I,entries:c,stage:g});if((null===(T=a)||void 0===T||!T.length)&&p){const n={scaleType:kc,scaleName:t||e,eventType:U};({scaledEntries:a}=pm({scaleAttributes:n,tournamentRecord:i,stageSequence:I,entries:c,stage:g}))}const o=(null===(M=a)||void 0===M?void 0:M.length)||0;o<v&&(v=o),a&&a.filter((({participantId:t})=>P.includes(t))).slice(0,f||v).forEach(((t,e)=>{const n=e+1,i=(null==l?void 0:l[n])||n,{participantId:a}=t;op({drawDefinition:r,participantId:a,structureId:N,seedNumber:n,seedValue:i})}))}let A,E=[];if(!1!==a){const s="object"==typeof a&&a.seedsOnly,c=Gd({inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,participants:n,structureId:N,matchUpsMap:e,seedsOnly:s,drawType:o,event:u});if(E=null==c?void 0:c.conflicts,A=null==c?void 0:c.positionAssignments,c.error)return c}return{positionAssignments:A,stageEntries:y,structureId:N,seedsCount:v,conflicts:E}}function fm(t){const{drawType:e=tr,ignoreAllowedDrawTypes:n,policyDefinitions:i,tournamentRecord:r,tieFormatName:a,stage:o=Vi,drawEntries:s,drawId:c,event:u}=t,{tournamentParticipants:d}=qc({tournamentRecord:r,inContext:!0}),l=u&&d&&Qp({event:u,participants:d});if(null!=l&&l.error)return l;const p=!n&&r&&$p({tournamentRecord:r,categoryType:null==u?void 0:u.categoryType,categoryName:null==u?void 0:u.categoryName});if(null!=p&&p.length&&!p.includes(e))return{error:"Invalid drawType"};let m="number"!=typeof t.drawSize?parseInt(t.drawSize||32):t.drawSize||32,f="number"!=typeof t.seedsCount?parseInt(t.seedsCount||0):t.seedsCount||0;const h=null==u?void 0:u.eventType,v=t.matchUpType||h;let{tieFormat:I,matchUpFormat:g}=t;v===Zt&&h===Zt?(I=I||null!=u&&u.tieFormat||a?"object"==typeof I?I:a?em({namedFormat:a}):"object"==typeof(null==u?void 0:u.tieFormat)&&u.tieFormat:em(),g=void 0):g||(I=void 0,g="SET3-S:6/TB7");const U=lp({drawType:e,drawId:c});if((g||I)&&!(g&&(null==u?void 0:u.matchUpFormat)===g||(null==u?void 0:u.tieFormat)&&I&&JSON.stringify(u.tieFormat)===JSON.stringify(I))){let t=ic({tournamentRecord:r,drawDefinition:U,matchUpFormat:g,tieFormat:I,event:u});if(t.error)return{error:t.error,message:"matchUpFormat or tieFormat error"};v&&(U.matchUpType=v),I&&(U.tieFormat=I),t.tieFormat&&(I=t.tieFormat)}let y=ol({...t,tournamentRecord:r,drawDefinition:U,matchUpFormat:g,matchUpType:v,tieFormat:I,drawSize:m});if(y.error)return y;"object"==typeof i&&Jl({policyDefinitions:i,drawDefinition:U});const{policyDefinitions:S}=ms({policyTypes:["seeding"],tournamentRecord:r,drawDefinition:U,event:u})||{};null!=S&&S.seeding||Jl({drawDefinition:U,policyDefinitions:to});const{policyDefinitions:w}=ms({policyTypes:["avoidance"],tournamentRecord:r,drawDefinition:U,event:u})||{};null!=i&&i.avoidance||null==w||!w.avoidance||Jl({drawDefinition:U,policyDefinitions:w});const N=s||(null==u?void 0:u.entries)||[];for(const E of N){const t=El({...E,entryStage:E.entryStage||Vi,drawDefinition:U});if(s&&t.error)return t}e===nr&&(f=0);const D=mm({...y,...t,drawDefinition:U,participants:d,seedsCount:f,drawSize:m,entries:N,stage:o}),P=D.structureId,T=D.conflicts,M=[];if(t.qualifyingProfiles){let e=1;for(const n of t.qualifyingProfiles){var A;const{qualifyingRoundNumber:i,qualifyingPositions:r,seedsCount:a=0,drawSize:o}=n,s=mm({...y,...t,qualifyingRoundNumber:i,qualifyingPositions:r,stage:Gi,drawDefinition:U,stageSequence:e,participants:d,seedsCount:a,drawSize:o,entries:N});e+=1,null!==(A=s.conflicts)&&void 0!==A&&A.length&&M.push(...s.conflicts)}}return U.drawName=t.drawName||e,{qualifyingConflicts:M,drawDefinition:U,structureId:P,...B,conflicts:T}}function hm({tournamentRecord:t,drawDefinition:e,participantId:n,entryPosition:i,event:r}){return t?n?void 0===i||Number.isSafeInteger(i)?(((null==r?void 0:r.entries)||[]).forEach((t=>{t.participantId===n&&(t.entryPosition=i)})),((null==e?void 0:e.entries)||[]).forEach((t=>{t.participantId===n&&(t.entryPosition=i)})),B):{error:$,entryPosition:i}:{error:"Missing participantId"}:{error:G}}function vm({scaleAttributes:t,scaledEntries:e,stageEntries:n,seedsCount:i,scaleName:r}){if(!t)return{error:z};const a=Object.assign({},...(e||[]).slice(0,i).map((({participantId:t},e)=>({[t]:e+1}))));r=r||t.scaleName;const o=(new Date).toISOString();return{scaleItemsWithParticipantIds:n.map((({participantId:e})=>({participantId:e,scaleItems:[{scaleValue:a[e],eventType:t.eventType,scaleType:"SEEDING",scaleName:r,scaleDate:o}]})))}}function Im({tournamentRecord:t,drawDefinition:e,scaleAttributes:n,drawId:i,event:r,stage:a}){if(!r)return{error:W};let o=r.entries;if(i){var s;const{flightProfile:t}=vs({event:r}),n=null==t||null===(s=t.flights)||void 0===s?void 0:s.find((t=>t.drawId===i));o=n?n.drawEntries:null==e?void 0:e.entries}return function({tournamentRecord:t,participantIds:e,scaleAttributes:n}){var i;if(!t)return{error:G};if(!e)return{error:"Missing participantIds"};if(!n)return{error:z,message:"scaleAttributes required"};const{scaleType:r,eventType:a,scaleName:o}=n,s=[ci,r,a,o].join(".");return null===(i=t.participants)||void 0===i||i.forEach((t=>{e.includes(t.participantId)&&t.timeItems&&(t.timeItems=t.timeItems.filter((t=>t&&(null==t?void 0:t.itemType)!==s)))})),B}({tournamentRecord:t,participantIds:(o||[]).filter((t=>(!a||!t.entryStage||t.entryStage===a)&&Vr.includes(t.entryStatus))).map(Oi),scaleAttributes:n})}function gm({event:t,orderedDrawIdsMap:e}){var n,i;if("object"!=typeof t)return{error:W};if(!e)return{error:z,message:"Missing drawIdsOrderMap"};if("object"!=typeof e)return{error:$,message:"orderedDrawIdsMap must be an object"};const r=Object.values(e);if(!r.every((t=>!isNaN(t))))return{error:$,message:"drawOrder must be numeric"};if(T(r).length!==r.length)return{error:$,message:"drawOrder values must be unique"};if(null!==(n=t.drawDefinitions)&&void 0!==n&&n.length){const n=(t.drawDefinitions||[]).map((({drawId:t})=>t));if(F(n,Object.keys(e)).length!==n.length)return{error:$,message:"Missing drawIds"};t.drawDefinitions.forEach((t=>{t.drawOrder=e[t.drawId]}))}const{flightProfile:a}=vs({event:t});return null==a||null===(i=a.flights)||void 0===i||i.forEach((t=>{t.flightNumber=e[t.drawId]})),B}function Um({tournamentRecord:t,event:e}){var n;if(!t)return{error:G};if(!e)return{error:W};const{flightProfile:i}=vs({event:e}),r=null!=i&&i.flights?Object.assign({},...i.flights.sort(((t,e)=>t.flightNumber-e.flightNumber)).map(((t,e)=>({[t.drawId]:e+1})))):null!==(n=e.drawDefinitions)&&void 0!==n&&n.length?Object.assign({},...e.drawDefinitions.sort(((t,e)=>t.drawOrder-e.drawOrder)).map(((t,e)=>({[t.drawId]:e+1})))):void 0;return r?gm({event:e,orderedDrawIdsMap:r}):{...B}}function ym({deleteExisting:t,event:e,flightProfile:n}){var i;if(!n)return{error:z};if(!e)return{error:W};const{flightProfile:r}=vs({event:e});return r&&ym&&!t?{error:"Existing profile"}:null!==(i=e.drawDefinitions)&&void 0!==i&&i.length?{error:"Existing drawDefinition(s)"}:(wr({event:e,extension:{name:"flightProfile",value:n}}),{flightProfile:Ht(n,!1,!0),...B})}function Sm(t){var e;const n=null===(e=t.tournamentRecord)||void 0===e?void 0:e.participants;return Object.assign(t,{tournamentParticipants:n}),Hl(t)}function wm({qualifyingPositions:t,drawEntries:e=[],matchUpValue:n,sourceDrawId:i,drawName:r,drawId:a,event:o,stage:s}){var c,u,d,l;if(!o)return{error:W};if(!r)return{error:z};if(null!=e&&e.length){const t=Ci(o.entries||[]),n=Ci(e);if(F(n,t).length!==n.length)return{error:$}}const p=null===(c=vs({event:o}))||void 0===c?void 0:c.flightProfile;if("VOLUNTARY_CONSOLATION"===s&&!i)return{error:z};if(i&&(null==p||null===(u=p.flights)||void 0===u||!u.find((({drawId:t})=>t===i))))return{error:"Missing drawId"};const m=(null==p||null===(d=p.flights)||void 0===d||null===(l=d.map((({flightNumber:t})=>!isNaN(t)&&parseInt(t))))||void 0===l?void 0:l.filter(Boolean))||[],f=Math.max(0,...m)+1,h=a||Yt(),v={drawId:h,flightNumber:f,matchUpValue:n,drawEntries:e,drawName:r};s&&(v.stage=s),t&&(v.qualifyingPositions=t);if(((null==p?void 0:p.flights)||[]).find((({drawId:t})=>t===v.drawId)))return{error:"Existing flight"};const I={name:"flightProfile",value:{...p||{},flights:((null==p?void 0:p.flights)||[]).concat(v)}};if(i){const t=(null==p?void 0:p.links)||[];"VOLUNTARY_CONSOLATION"===s&&t.push({linkType:$i,source:{drawId:i},target:{drawId:h}}),I.value.links=t}return wr({event:o,extension:I})}function Nm({tournamentRecord:t,event:e,startDate:n}){if(!t)return{error:G};if(!e)return{error:W};if(!Ut.test(n))return{error:K};const{tournamentStartDate:i,tournamentEndDate:r,error:a}=Pm(t);if(a)return{error:a};const o=new Date(Lt(n));if(o<i||o>r)return{error:K};const s=e.endDate&&new Date(Lt(e.endDate));return s&&o>s&&(e.endDate=n),e.startDate=n,B}function Dm({tournamentRecord:t,event:e,endDate:n}){if(!t)return{error:G};if(!e)return{error:W};if(!Ut.test(n))return{error:K};const{tournamentStartDate:i,tournamentEndDate:r,error:a}=Pm(t);if(a)return{error:a};const o=new Date(Lt(n));if(o<i||o>r)return{error:K};const s=e.startDate&&new Date(Lt(e.startDate));return s&&o<s&&(e.startDate=n),e.endDate=n,B}function Pm(t){const{startDate:e,endDate:n}=t;return Ut.test(e)&&Ut.test(n)?{tournamentStartDate:new Date(Lt(e)),tournamentEndDate:new Date(Lt(n))}:{error:"Invalid tournament dates"}}const Tm={removeCollectionDefinition:ka,addCollectionDefinition:_a,addEvent:nm,deleteEvents:function({tournamentRecord:t,eventIds:e}){if(!t)return{error:G};if(!t.events)return{error:"Event not found"};if(!Array.isArray(e))return{error:z};const n=[],i=[];return t.events=(t.events||[]).filter((t=>{if(e.includes(t.eventId)){const e={action:"deleteEvents",payload:{events:[t]}};n.push(e),i.push({eventName:t.eventName,eventType:t.eventType,category:t.category,eventId:t.eventId,gender:t.gender})}return!e.includes(t.eventId)})),cc({tournamentRecord:t}),n.length&&(at({topic:"audit",payload:n}),ho({tournamentRecord:t,timeItem:{itemType:"deleteEvents",itemValue:i}})),B},setEventDates:function({tournamentRecord:t,event:e,startDate:n,endDate:i}){if(!t)return{error:G};if(!e)return{error:W};if(!n&&!i)return{error:z};if(n&&!Ut.test(n))return{error:K};if(i&&!Ut.test(i))return{error:K};if(n&&i&&new Date(Lt(n))>new Date(Lt(i)))return{error:$};if(n){const{error:i}=Nm({tournamentRecord:t,event:e,startDate:n});if(i)return{error:i}}if(i){const{error:n}=Dm({tournamentRecord:t,event:e,endDate:i});if(n)return{error:n}}return B},setEventStartDate:Nm,setEventEndDate:Dm,autoSeeding:function({tournamentRecord:t,drawDefinition:e,policyDefinitions:n,scaleAttributes:i,scaleName:r,drawSize:a,drawId:o,event:s,stage:c,sortDescending:u,scaleSortMethod:d}){const{error:l,entries:p,seedsCount:m,stageEntries:f}=Jp({drawDefinition:e,drawId:o,event:s,policyDefinitions:n,drawSize:a,stage:c});if(l)return{error:l};const{scaledEntries:h}=pm({scaleAttributes:i,tournamentRecord:t,scaleSortMethod:d,sortDescending:u,entries:p,stage:c}),{scaleItemsWithParticipantIds:v}=vm({scaledEntries:h,seedsCount:m,scaleAttributes:i,scaleName:r,stageEntries:f});return{scaleItemsWithParticipantIds:v}},removeSeeding:function({tournamentRecord:t,drawDefinition:e,scaleName:n,drawId:i,event:r,stage:a}){var o,s;return t?r?(n=n||(null===(o=r.category)||void 0===o?void 0:o.categoryName)||(null===(s=r.category)||void 0===s?void 0:s.ageCategoryCode),Im({tournamentRecord:t,scaleAttributes:{eventType:r.eventType,scaleType:"SEEDING",scaleName:n},drawDefinition:e,drawId:i,event:r,stage:a})):{error:W}:{error:G}},removeScaleValues:Im,addDrawEntries:Rl,checkValidEntries:Qp,modifyDrawName:zd,addDrawDefinition:yc,addPlayoffStructures:function({playoffStructureNameBase:t,playoffAttributes:e,playoffPositions:n,exitProfileLimit:i,tournamentRecord:r,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l}){if(!r)return{error:G};const p=Xd({playoffStructureNameBase:t,playoffAttributes:e,playoffPositions:n,exitProfileLimit:i,tournamentRecord:r,drawDefinition:a,roundProfiles:o,roundNumbers:s,structureId:c,idPrefix:u,event:d,uuids:l});return p.error||ho({tournamentRecord:r,timeItem:{itemType:"addPlayoffStructures",itemValue:{playoffStructureNameBase:t,playoffPositions:n,roundNumbers:s,structureId:c}}}),p},deleteDrawDefinitions:lm,getAvailablePlayoffRounds:function({drawDefinition:t,structureId:e}){return yd({drawDefinition:t,structureId:e})},removeStructure:sl,generateAndPopulatePlayoffStructures:Nd,attachPlayoffStructures:function({tournamentRecord:t,drawDefinition:e,structures:n,links:i}){if(!t)return{error:G};if(!e)return{error:q};const r=Zd({tournamentRecord:t,drawDefinition:e,structures:n,links:i});return r.error||ho({tournamentRecord:t,timeItem:{itemType:"attachPlayoffStructures",itemValue:{structureIds:null==n?void 0:n.map((({structureId:t})=>t)),drawId:e.drawId}}}),r},generateSeedingScaleItems:vm,setSubOrder:_l,addEventEntries:Ol,promoteAlternate:function({tournamentRecord:t,drawDefinition:e,event:n,participantId:i,stage:r=Vi,stageSequence:a}){if(!t)return{error:G};if(!n)return{error:W};if(n){const t=Xp({element:n,participantId:i,stageSequence:a,stage:r});if(t.error)return t}if(e){const t=Xp({element:e,participantId:i,stageSequence:a,stage:r});if(t.error)return t}return B},destroyPairEntry:Ll,setEntryPosition:hm,setEntryPositions:function({tournamentRecord:t,entryPositions:e,drawDefinition:n,event:i}){if(!t)return{error:G};if(!Array.isArray(e))return{error:$};for(const r of e){const{participantId:e,entryPosition:a}=r,o=hm({tournamentRecord:t,drawDefinition:n,participantId:e,entryPosition:a,event:i});if(o.error)return o}return{...B}},addEventEntryPairs:function({allowDuplicateParticipantIdPairs:t,entryStatus:e=Ar,participantIdPairs:n=[],entryStage:i=Vi,tournamentRecord:r,drawDefinition:a,event:o,uuids:s}){if(!r)return{error:G};if(!o)return{error:W};if(o.eventType!==Jt)return{error:"Invalie eventType"};const c=r.participants||[],u=c.filter((t=>t.participantType===Ni)).map((t=>t.participantId)),d=u.filter((t=>!u.includes(t)));if(d.length)return{error:"Invalid participantIds",invalidParticipantIds:d};const l=n.filter((t=>2!==t.length));if(l.length)return{error:"Invalid participantIds",invalidParticipantIdPairs:l};const p=c.filter((t=>t.participantType===Pi)).map((t=>t.individualParticipantIds)),m=n.map((t=>({participantId:(null==s?void 0:s.pop())||Yt(),participantType:Pi,participantRole:Lu,individualParticipantIds:t}))),f=t?m:m.filter((t=>!p.find((e=>2===F(e,t.individualParticipantIds).length))));let h,v=[];if(f){const e=Nc({allowDuplicateParticipantIdPairs:t,participants:f,returnParticipants:!0,tournamentRecord:r});if(e.error)return e;v=e.participants||[],h=e.message}const I=n.map((t=>{const e=v.find((e=>2===F(e.individualParticipantIds,t).length));if(e)return e;const{participant:n}=Ai({tournamentRecord:r,participantIds:t});return n})).map((t=>t.participantId)),g=Ol({event:o,entryStage:i,entryStatus:e,drawDefinition:a,tournamentRecord:r,participantIds:I});return f.length&&at({topic:"addParticipants",participants:f}),{...g,message:h,newParticipantIds:f.map(Oi)}},removeEventEntries:Pl,removeDrawEntries:function({participantIds:t,drawDefinition:e,drawId:n,event:i,autoEntryPositions:r=!0}){var a;if(!i)return{error:W};if(!n)return{error:"Missing drawId"};if(!t||!t.length)return{error:"Missing participantIds"};const o=vl({drawDefinition:e});if(x(t,o))return{error:"Existing participant drawPosition assignment"};const s=e=>{const n=e.participantId;return!t.includes(n)},{flightProfile:c}=vs({event:i}),u=null==c||null===(a=c.flights)||void 0===a?void 0:a.find((t=>t.drawId===n));return null!=u&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(s),r&&(u.drawEntries=Il({entries:u.drawEntries}))),null!=e&&e.entries&&(e.entries=e.entries.filter(s),r&&(e.entries=Il({entries:e.entries}))),B},modifyEventEntries:function({event:t,tournamentRecord:e,entryStage:n=Vi,participantIdPairs:i=[],unpairedParticipantIds:r=[],entryStatus:a=Cr}){if(!e)return{error:G};if(!t)return{error:W};const o=e.participants||[],s=o.filter((t=>t.participantType===Ni)).map((t=>t.participantId)),c=r.concat(...i).flat(1/0).filter((t=>!s.includes(t)));if(c.length)return{error:"Invalid participantIds",invalidParticipantIds:c};const u=i.filter((t=>2!==t.length));if(u.length)return{error:"Invalid participantIds",invalidParticipantIdPairs:u};const d=o.filter((t=>t.participantType===Pi)).map((t=>t.individualParticipantIds)),l=i.filter((t=>!d.find((e=>2===F(e,t).length)))).map((t=>({participantType:Pi,participantRole:Lu,individualParticipantIds:t}))),p=Nc({tournamentRecord:e,participants:l});if(p.error)return p;const m=i.map((t=>{const{participant:n}=Ai({tournamentRecord:e,participantIds:t});return n})).map((t=>({participantId:t,entryStatus:a,entryStage:n}))),f=r.map((t=>({entryStatus:_r,participantId:t,entryStage:n})));return t.entries=(t.entries||[]).filter((t=>t.entryStage===n)),t.entries=t.entries.concat(...m,...f),B},modifyEntriesStatus:Ul,modifySeedAssignment:function({tournamentRecord:t,drawDefinition:e,participantId:n,structureId:i,seedValue:r}){return t?(t.participants||[]).find((t=>t.participantId===n))?ap({drawDefinition:e,participantId:n,structureId:i,seedValue:r}):{error:"Invalid participantId"}:{error:G}},deleteFlightProfileAndFlightDraws:function({tournamentRecord:t,event:e}){if(!t)return{error:G};if(!e)return{error:W};const{flightProfile:n}=vs({event:e});if(n){var i;const r=null===(i=n.flights)||void 0===i?void 0:i.map((({drawId:t})=>t)).filter(Boolean),a=lm({tournamentRecord:t,eventId:e.eventId,drawIds:r});return a.error?a:Dr({event:e,name:"flightProfile"})}return B},deleteFlightAndFlightDraw:function({tournamentRecord:t,auditData:e,drawId:n,event:i}){var r,a,o;if(!t)return{error:G};if(!n)return{error:"Missing drawId"};if(!i)return{error:W};const{flightProfile:s}=vs({event:i}),c=(null==s||null===(r=s.links)||void 0===r||null===(a=r.filter((t=>{var e;return(null===(e=t.source)||void 0===e?void 0:e.drawId)===n})))||void 0===a||null===(o=a.map((t=>{var e;return null===(e=t.target)||void 0===e?void 0:e.drawId})))||void 0===o?void 0:o.filter(Boolean))||[];var u;if(s&&((null===(u=s.flights)||void 0===u?void 0:u.find((t=>t.drawId===n)))||c.length)){const t=s.flights.filter((t=>{const e=c.includes(t.drawId);return t.drawId!==n&&!e})),e={name:"flightProfile",value:{...s,flights:t}};if(c.length&&s.links){const t=s.links.filter((t=>{var e;return!c.includes(null===(e=t.target)||void 0===e?void 0:e.drawId)}));e.value.links=t}wr({event:i,extension:e})}return lm({tournamentRecord:t,eventId:i.eventId,drawIds:[n,...c],auditData:e}),Um({tournamentRecord:t,event:i})},generateFlightProfile:function({drawNameRoot:t="Flight",attachFlightProfile:e,tournamentRecord:n,scaleAttributes:i,scaleSortMethod:r,deleteExisting:a,sortDescending:o,drawNames:s=[],scaledEntries:c,flightsCount:u,flightValues:d,splitMethod:l,uuids:p=[],event:m,stage:f}){if(!m)return{error:W};const h=m.entries||[],{flightProfile:v}=vs({event:m});if(v&&e&&!a)return{error:"Existing profile"};c||({scaledEntries:c}=pm({tournamentRecord:n,scaleAttributes:i,scaleSortMethod:r,sortDescending:o,event:m,stage:f}));const I=c.map(Oi),g=h.filter((({participantId:t})=>!I.includes(t))).filter((t=>(!f||!t.entryStage||t.entryStage===f)&&Vr.includes(t.entryStatus))),U=c.concat(...g),y=U.length;let S=k(U,Math.ceil(y/u));"splitWaterfall"===l?S=_(U,u):"splitShuttle"===l&&(S=_(U,u,!0));const w={scaleAttributes:i,splitMethod:l,flights:O(0,u).map((e=>{var n;const i=e+1,r={flightNumber:i,drawId:(null==p?void 0:p.pop())||Yt(),drawEntries:(a=S[e],(a||[]).map((({participantId:t})=>h.find((e=>e.participantId===t))))),drawName:(null==s?void 0:s.length)&&s[e]||`${t} ${i}`};var a;const o=null==d||null===(n=d.find((t=>t.flightNumber===i)))||void 0===n?void 0:n.matchUpValue;return o&&(r.matchUpValue=o),r}))};if(e){const t=ym({flightProfile:w,deleteExisting:a,event:m});return{splitEntries:et()&&S||void 0,...t}}return{flightProfile:w,...B}},refreshEventDrawOrder:Um,attachFlightProfile:ym,resetDrawDefinition:function({tournamentRecord:t,removeScheduling:e,drawDefinition:n}){if(!n)return{error:q};const i=Bi({drawDefinition:n}),r=t=>{var e;return null==i||null===(e=i.drawMatchUps)||void 0===e?void 0:e.find((e=>e.matchUpId===t))};for(const o of n.structures||[]){const{positionAssignments:s,stage:c,stageSequence:u}=o;!s||1===u&&[Gi,Vi].includes(c)||(o.positionAssignments=s.map((t=>(delete t.participantId,t))),o.seedAssignments=[]);const{matchUps:d}=oa({inContext:!0,matchUpsMap:i,structure:o});for(const i of d){var a;const{matchUpId:o,roundNumber:s,sides:c}=i,u=r(o);if(delete u.extensions,delete u.notes,u.matchUpStatus!==ne&&(u.matchUpStatus=le,delete u.matchUpStatusCodes,delete u.matchUpFormat,delete u.winningSide,delete u.score),s&&s>1&&u.drawPositions){const t=null==c?void 0:c.map((({drawPosition:t,participantFed:e})=>!e&&t)).filter(Boolean);u.drawPositions=u.drawPositions.map((e=>t.includes(e)?void 0:e))}e?delete u.timeItems:null!==(a=u.timeItems)&&void 0!==a&&a.length&&(u.timeItems=u.timeItems.filter((t=>![Xn,ti,ni,ei,ii].includes(t.itemType)))),La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:n,matchUp:u})}}return xa({drawDefinition:n,structureIds:(n.structures||[]).map((({structureId:t})=>t))}),{...B}},pruneDrawDefinition:function({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:n,drawId:i}){if(!e)return{error:G};if(!n)return{error:q};let r=[];const{drawsAnalysis:a}=Hp({tournamentRecord:e});if(a.canBePruned.includes(i)){const o=a.matchPlay.includes(i),s=a.drawAnalysis[i],{structures:[c]}=vr({stageSequence:1,drawDefinition:n,stage:Vi}),u=s.structuresData.find((({structureId:t})=>c.structureId===t)),d=c.matchUps||[];r=d.sort(((t,e)=>t.roundPosition-e.roundPosition)).filter((({roundNumber:t})=>!u.inactiveRounds.includes(t)));const l=r.map(Fi),p=d.map(Fi).filter((t=>!l.includes(t)));if(o){const e=r.sort(((t,e)=>t.roundPosition-e.roundPosition)).filter((({roundNumber:t})=>!u.inactiveRounds.includes(t))).filter((({winningSide:t})=>!o||t)),n=e.map(Fi),i=l.filter((t=>!n.includes(t)));p.push(...i);const a=e.map((({drawPositions:t})=>t)).flat(),s=Object.assign({},...a.map(((t,e)=>({[t]:e+1}))));if(e.forEach((e=>{t?e.drawPositions=e.drawPositions.map((t=>s[t])):delete e.drawPositions})),t){const t=c.positionAssignments.filter((t=>a.includes(t.drawPosition))).map((t=>(t.drawPosition=s[t.drawPosition],t)));c.positionAssignments=t}else c.positionAssignments=[];c.matchUps=e,r=e}Oa({tournamentId:null==e?void 0:e.tournamentId,matchUpIds:p,drawDefinition:n}),xa({drawDefinition:n})}return{...B,matchUps:r}},updateDrawIdsOrder:gm,getFlightProfile:vs,getScaledEntries:pm,addFlight:wm,generateAdHocMatchUps:function(t){return Wd(t)},deleteAdHocMatchUps:function(t){return tl(t)},drawMatic:Sm,setOrderOfFinish:function(t){return Yl(t)},setDelegatedOutcome:function(t){return zl(t)},removeDelegatedOutcome:function(t){return jl(t)},addVoluntaryConsolationStage:function({drawDefinition:t,drawSize:e}){return Jd({drawDefinition:t,drawSize:e})},generateVoluntaryConsolationStructure:function(t){const{tournamentRecord:e}=t;return e?qd({participants:e.participants,...t}):{error:G}},setMatchUpStatus:ac,bulkMatchUpStatusUpdate:oc,setDrawDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:n}){return t?e?n?ic({tournamentRecord:t,drawDefinition:e,matchUpFormat:n}):{error:"Missing matchUpFormat"}:{error:q}:{error:G}},setEventDefaultMatchUpFormat:function({tournamentRecord:t,event:e,matchUpFormat:n}){return t?n?e?h(n)?(e.matchUpFormat=n,B):{error:"Unrecognized matchUpFormat"}:{error:W}:{error:"Missing matchUpFormat"}:{error:G}},setStructureDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:n,structureId:i,event:r}){return t?e?n?i?ic({tournamentRecord:t,drawDefinition:e,matchUpFormat:n,structureId:i,event:r}):{error:"Missing structureId"}:{error:"Missing matchUpFormat"}:{error:q}:{error:G}},setCollectionDefaultMatchUpFormat:function({tournamentRecord:t,drawDefinition:e,matchUpFormat:n}){return t?e?n?h(n)?{error:"Not implemented"}:{error:"Unrecognized matchUpFormat"}:{error:"Missing matchUpFormat"}:{error:q}:{error:G}},assignDrawPosition:function({tournamentRecord:t,drawDefinition:e,participantId:n,drawPosition:i,structureId:r,qualifier:a,bye:o}){if(!e)return{error:q};if(!i)return{error:"Missing drawPosition"};if(!r)return{error:"Missing structureId"};if(o){const n=Ds({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r});if(n.error)return n}else{if(a)return{error:"Not implemented"};{const a=$s({tournamentRecord:t,drawDefinition:e,participantId:n,structureId:r,drawPosition:i});if(a.error)return a}}return{...B}},assignSeedPositions:function(t){const{useExistingSeedLimit:e,tournamentRecord:n,drawDefinition:i,structureId:r,assignments:a,drawId:o}=t;let s=0;if(null==a||!a.length)return{error:"Missing assignments"};if(!n)return{error:G};if(!o)return{error:"Missing drawId"};const{seedAssignments:c,seedLimit:u,error:d}=$r({drawDefinition:i,structureId:r});if(d)return{error:d};const l=Object.assign({},...c.filter((t=>t.seedNumber)).map((t=>({[t.seedNumber]:t}))));a.forEach((t=>{const{seedNumber:n}=t;n<=u&&(!e||l[n])&&(l[n]=t)}));const p=Object.values(l),m=p.map((t=>null==t?void 0:t.participantId)).filter(Boolean);if(m.length!==b(m).length)return{error:"participantId cannot be assigned to multiple seedNumbers"};for(const f of p){const t=op({...f,drawDefinition:i,structureId:r});if(null!=t&&t.error)return t;null!=t&&t.success&&s++}return s?{...B,modifications:s}:{error:"No modifications applied"}},assignDrawPositionBye:function({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:i}){return Ds({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:i})},assignMatchUpSideParticipant:function({tournamentRecord:t,drawDefinition:e,participantId:n,sideNumber:i,matchUpId:r,event:a}){var o;if(n&&"string"!=typeof n)return{error:"Invalid participantId"};if(!e)return{error:q};if(!i)return{error:"Missing sideNumber"};if(!r)return{error:"Missing matchUpId"};if(![1,2].includes(i))return{error:$,sideNumber:i};const{matchUp:s,structure:c}=ca({drawDefinition:e,matchUpId:r,event:a});return null!=c&&c.structures||e.drawType&&e.drawType!==Ji||null!=c&&c.matchUps.find((({roundPosition:t})=>!!t))?{error:"Invalid drawType"}:!n&&(null!==(o=s.score)&&void 0!==o&&o.scoreStringSide1||ge.includes(s.matchUpstatus)||s.matchUpStatus===oe)?{error:"Cannot remove participants",message:"matchUp has completed status or score"}:(s.sides=[1,2].map((t=>{var e;const r=(null===(e=s.sides)||void 0===e?void 0:e.find((e=>e.sideNumber===t)))||{sideNumber:t};return i===t?{...r,participantId:n}:r})),Ca({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUps:[s]}),{...B})},swapDrawPositionAssignments:function(t){return xl(t)},removeDrawPositionAssignment:Fl,alternateDrawPositionAssignment:function(t){return fl(t)},withdrawParticipantAtDrawPosition:function(t){return Object.assign(t,{entryStatus:xr}),Fl(t)},setDrawParticipantRepresentativeIds:function({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:"drawDefinition not found"};if(!Array.isArray(t))return{error:$};const n=Ci((null==e?void 0:e.entries)||[]);return t.length&&F(t,n).length<t.length?{error:$}:Sr({drawDefinition:e,extension:{name:"participantRepresentatives",value:t}})},getDrawParticipantRepresentativeIds:function({drawDefinition:t}){const{extension:e,error:n}=xn({drawDefinition:t,name:"participantRepresentatives"});return n?{error:n}:{representativeParticipantIds:(null==e?void 0:e.value)||[]}},luckyLoserDrawPositionAssignment:function(t){return function({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,structureId:r}){return ml({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,structureId:r})}(t)},setPositionAssignments:function(t){return hl(t)},automatedPositioning:function({applyPositioning:t=!0,tournamentRecord:e,drawDefinition:n,structureId:i,seedsOnly:r,event:a}){return a?n?Gd({tournamentRecord:e,applyPositioning:t,drawDefinition:n,participants:null==e?void 0:e.participants,structureId:i,seedsOnly:r}):{error:"drawDefinition not found"}:{error:"Event not found"}},automatedPlayoffPositioning:im,checkInParticipant:function({tournamentRecord:t,participantId:e,matchUpId:n,matchUp:i,drawId:r}){i&&!r&&({drawId:r}=i),i&&!n&&({matchUpId:n}=i);const{event:a,drawDefinition:o}=Yn({tournamentRecord:t,drawId:r});if(!a)return{error:"Event not found"};{const i=bu({tournamentParticipants:t.participants,drawDefinition:o,participantId:e,matchUpId:n});if(i.error&&"Participant already checked in"!==i.error)return i}return B},checkOutParticipant:function({tournamentRecord:t,participantId:e,matchUpId:n,matchUp:i,drawId:r}){i&&!r&&({drawId:r}=i),i&&!n&&({matchUpId:n}=i);const{event:a,drawDefinition:o}=Yn({tournamentRecord:t,drawId:r});if(!a)return{error:"Event not found"};{const i=Ru({drawDefinition:o,tournamentParticipants:t.participants,matchUpId:n,participantId:e});if(i.error)return i}return B},toggleParticipantCheckInState:Cu,generateDrawDefinition:fm,addDrawDefinitionTimeItem:function({drawDefinition:t,timeItem:e}){if(!t)return{error:"drawDefinition not found"};if(!e)return{error:"Missing timeItem"};const n=e&&Object.keys(e),i=["itemType","itemValue"];if(i.filter((t=>n.includes(t))).length!==i.length)return{error:"Invalid timeItem"};t.timeItems||(t.timeItems=[]);const r=(new Date).toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),Fa({drawDefinition:t}),B},applyLineUps:function({tournamentRecord:t,drawDefinition:e,matchUpId:n,lineUps:i,event:r}){if(!t)return{error:G};if(!e)return{error:"drawDefinition not found"};if("string"!=typeof n)return{error:"Invalid matchUp"};if(!Array.isArray(i))return{error:$,lineUps:i};const a=t.participants||[];let o=ca({tournamentParticipants:a,inContext:!0,drawDefinition:e,matchUpId:n});if(o.error)return o;const{matchUp:s,structure:c}=o,{drawPositions:u,matchUpType:d}=s;if(d!==Zt)return{error:"Invalid matchUp"};if(null==u||!u.length)return{error:"Missing drawPositions"};const l=s.tieFormat||c.tieFormat||e.tieFormat||r.tieFormat||t.tieFormat,p={};for(const I of i){if(!Array.isArray(I))return{error:$,lineUp:I};const e={},n=[];for(const t of I){var m,f;if("object"!=typeof t)return{error:$,lineUpAssignment:t};const{participantId:i,collectionAssignments:r=[]}=t;if(!Array.isArray(r))return{error:$,collectionAssignments:r};const o=a.find((t=>t.participantId===i));if(!o)return{error:Y};if(!o.participantType===Ni)return{error:"Invalid participantType"};const c=null===(m=s.sides)||void 0===m||null===(f=m.find((t=>{var e,n;return null===(e=t.participant)||void 0===e||null===(n=e.individualParticipantIds)||void 0===n?void 0:n.includes(i)})))||void 0===f?void 0:f.sideNumber;c&&n.push(c);for(const t of r){var h;if("object"!=typeof t)return{error:$,collectionAssignment:t};const{collectionId:n,collectionPosition:r}=t,a=null==l||null===(h=l.collectionDefinitions)||void 0===h?void 0:h.find((t=>t.collectionId===n));if(!a)return{error:$,collectionId:n};const o=`${n}-${r}`;e[o]||(e[o]=[]);const s=e[o].length;if(a.matchUpType===$t&&s||a.matchUpType===Jt&&s>1)return{message:"Excessive collectionPosition assignments",error:$};e[o].push(i)}}for(const o of Object.values(e))if(2===o.length){const{pairedParticipant:e}=Ai({tournamentParticipants:a,participantIds:o});if(!e){const e=wc({participant:{participantType:Pi,participantRole:Lu,individualParticipantIds:o},pairOverride:!0,tournamentRecord:t});if(e.error)return e}}const i=A(n),r=(i[1]||0)>(i[2]||0)?1:(i[2]||0)>(i[1]||0)?2:void 0;r&&!Object.keys(p).includes(r)&&(p[r]=I)}if(!Object.keys(p).length)return{error:"Value unchanged"};if(o=ca({drawDefinition:e,matchUpId:n}),o.error)return o;const{matchUp:v}=o;v.sides||(v.sides=[]);for(const I of[1,2]){const t=v.sides.find((t=>t.sideNumber===I)),e=p[I];e&&(t?t.lineUp=e:v.sides.push({lineUp:e,sideNumber:I}))}return La({tournamentId:null==t?void 0:t.tournamentId,drawDefinition:e,matchUp:v}),{...B}},assignTieMatchUpParticipantId:cm,removeTieMatchUpParticipantId:function(t){var e,n,i,r;const{tournamentRecord:a,drawDefinition:o,participantId:s}=t;if(!s)return{error:"Missing participantId"};const c=sm(t);if(c.error)return c;const{relevantAssignments:u,collectionPosition:d,teamParticipants:l,collectionId:p,matchUpType:m,dualMatchUp:f,tieMatchUp:h,tieFormat:v}=c;if(Qs({score:h.score})||h.winningSide)return{error:"Existing outcome"};const I=null===(e=h.sides)||void 0===e?void 0:e.find((t=>{var e,n,i;return(null===(e=t.participant)||void 0===e?void 0:e.participantId)===s||(null===(n=t.participant)||void 0===n||null===(i=n.individualParticipantIds)||void 0===i?void 0:i.includes(s))}));if(!I)return{error:Y};const{tournamentParticipants:[g]}=qc({tournamentRecord:a,participantFilters:{participantIds:[s]}});if(!g)return{error:Y};if(m===$t&&g.participantType===Pi)return{error:"Invalid participant"};const U=g.participantType===Ni?[s]:g.individualParticipantIds;f.sides||(f.sides=[{sideNumber:1},{sideNumber:2}]);let y=null===(n=f.sides)||void 0===n?void 0:n.find((({sideNumber:t})=>t===I.sideNumber));const S=dm({drawDefinition:o,participantIds:U}),w=(null==S?void 0:S.teamParticipantId)||(null==l||null===(i=l.find((t=>F((null==t?void 0:t.individualParticipantIds)||[],U).length===U.length)))||void 0===i?void 0:i.participantId);if(!w)return{error:Y};if(!y&&((null===(r=f.sides)||void 0===r?void 0:r.filter((({lineUp:t})=>!t)).length)||0)<2){var N;const t=l.map((({participantId:t})=>{var e;return{drawPosition:null===(e=u.find((e=>e.participantId===t)))||void 0===e?void 0:e.drawPosition,teamParticipantId:t}}));console.log({drawPositionMap:t}),y=null===(N=f.sides)||void 0===N?void 0:N.find((e=>{var n;return(null===(n=t.find((({drawPosition:t})=>t===e.drawPosition)))||void 0===n?void 0:n.teamParticipantId)===w}))}if(!y)return{error:J,participantId:s};const{modifiedLineUp:D}=rm({collectionPosition:d,teamParticipantId:w,dualMatchUpSide:y,participantIds:U,drawDefinition:o,collectionId:p});if(y.lineUp=D,w&&om({participantId:w,lineUp:D,drawDefinition:o,tieFormat:v}),m===Jt&&g.participantType===Ni){var P;const t=null===(P=h.sides)||void 0===P?void 0:P.find((t=>t.sideNumber===y.sideNumber)),{participantId:e}=t||{},{tournamentParticipants:[n]}=qc({tournamentRecord:a,participantFilters:{participantIds:[e]},withEvents:!0});if(!n)return{error:Y};{const t=null==n?void 0:n.individualParticipantIds.filter((t=>t!==s));if(n.draws.length){if(1===t.length){const{participant:e}=Ai({participantIds:t,tournamentRecord:a});if(!e){const e=wc({participant:{participantRole:Lu,individualParticipantIds:t,participantType:Pi},pairOverride:!0,tournamentRecord:a});if(e.error)return e}}}else if(t.length){n.individualParticipantIds=t;const e=_p({participant:n,pairOverride:!0,tournamentRecord:a});if(e.error)return e}else{const t=Nl({participantIds:[e],tournamentRecord:a});t.error&&console.log("cleanup",{result:t})}}}return La({tournamentId:null==a?void 0:a.tournamentId,matchUp:f,drawDefinition:o}),{...B,modifiedLineUp:D}},replaceTieMatchUpParticipantId:function(t){var e;const n=sm(t);if(n.error)return n;const{existingParticipantId:i,tournamentRecord:r,newParticipantId:a,drawDefinition:o}=t;if(!i||!a)return{error:"Missing participantId"};const{collectionPosition:s,teamParticipants:c,collectionId:u,dualMatchUp:d,tieMatchUp:l,tieFormat:p}=n,{matchUpType:m}=l,f=l.sides.find((t=>{var e,n,r;return(null===(e=t.participant)||void 0===e?void 0:e.participantId)===i||(null===(n=t.participant)||void 0===n||null===(r=n.individualParticipantIds)||void 0===r?void 0:r.includes(i))}));if(!f)return{error:Y};const{tournamentParticipants:h}=qc({tournamentRecord:r,participantFilters:{participantIds:[i,a]}});if(2!==h.length)return{error:"Missing participantId"};if(h[0].participantType!==h[1].participantType)return{error:"Invalid participantType"};const v=d.sides.find((({sideNumber:t})=>t===f.sideNumber));if(!v)return{error:J,existingParticipantId:i};const I=h.find((({participantId:t})=>t===i)),g=(null==I?void 0:I.individualParticipantIds)||[I.participantId],U=dm({drawDefinition:o,participantIds:g}),y=(null==U?void 0:U.teamParticipantId)||(null===(e=c.find((t=>F((null==t?void 0:t.individualParticipantIds)||[],g).length)))||void 0===e?void 0:e.participantId),S=v.lineUp||U,w=S.find((({participantId:t})=>a===t)),N=(null==S?void 0:S.map((t=>{return[i,a].includes(t.participantId)?([i,a].includes(t.participantId)&&(t.collectionAssignments=null===(e=t.collectionAssignments)||void 0===e?void 0:e.filter((t=>!(t.collectionId===u&&t.collectionPosition===s)))),t.participantId===a&&(t.collectionAssignments||(t.collectionAssignments=[]),t.collectionAssignments.push({collectionId:u,collectionPosition:s})),t):t;var e})))||[];w||N.push({participantId:a,collectionAssignments:[{collectionId:u,collectionPosition:s}]});const D=m===Jt,P=D&&S.map((t=>{var e;return(null===(e=t.collectionAssignments)||void 0===e?void 0:e.find((t=>t.collectionId===u&&t.collectionPosition===s)))&&t.participantId})).filter(Boolean),T=D&&N.map((t=>{var e;return(null===(e=t.collectionAssignments)||void 0===e?void 0:e.find((t=>t.collectionId===u&&t.collectionPosition===s)))&&t.participantId})).filter(Boolean);if(v.lineUp=N,y){const t=om({participantId:y,lineUp:N,drawDefinition:o,tieFormat:p});t.error&&console.log(t.error,{templateTeamLineUp:U})}else console.log("team participantId not found");let M,A;if(D){var E;const{tournamentRecord:e}=t;let n=Ai({participantIds:T,tournamentRecord:e});if(!n.participant){var b;const t=wc({returnParticipant:!0,pairOverride:!0,tournamentRecord:e,participant:{individualParticipantIds:T,participantType:Pi,participantRole:Lu}});if(t.error)return t;M=null===(b=t.participant)||void 0===b?void 0:b.participantId}n=Ai({participantIds:P,tournamentRecord:e});const i=null===(E=n.participant)||void 0===E?void 0:E.participantId;i&&Nl({participantIds:[i],tournamentRecord:e}).success&&(A=i)}return La({tournamentId:null==r?void 0:r.tournamentId,matchUp:d,drawDefinition:o}),{...B,participantRemoved:A,participantAdded:M}},updateTeamLineUp:om,validateLineUp:am,getTeamLineUp:Ei},Mm={allTournamentMatchUps:wa,tournamentMatchUps:Pa,allEventMatchUps:Da,getRoundMatchUps:function(t){return _i(t)},allDrawMatchUps:Na,eventMatchUps:Ta,drawMatchUps:function({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:n,participantsProfile:i,policyDefinitions:r,tournamentRecord:a,matchUpFilters:o,contextFilters:s,contextProfile:c,drawDefinition:u,nextMatchUps:d,tournamentId:l,inContext:p,context:m,event:f}){var h;if(!f)return{error:W};const{eventId:v,eventName:I,endDate:g}=f||{},U={...m,...Wt({eventId:v,eventName:I,endDate:g||(null==f?void 0:f.endDate)||(null==a?void 0:a.endDate),tournamentId:l||(null==a?void 0:a.tournamentId),indoorOutDoor:(null==f?void 0:f.indoorOutDoor)||(null==a?void 0:a.indoorOutDoor),surfaceCategory:(null==f?void 0:f.surfaceCategory)||(null==a?void 0:a.surfaceCategory)})};return null!==(h=t)&&void 0!==h&&h.length||!a||(t=Ma({participantsProfile:i,tournamentRecord:a,inContext:p})),Sa({context:U,tournamentAppliedPolicies:e,scheduleVisibilityFilters:n,tournamentParticipants:t,participantsProfile:i,policyDefinitions:r,tournamentRecord:a,drawDefinition:u,matchUpFilters:o,contextFilters:s,contextProfile:c,nextMatchUps:d,inContext:p,event:f})},credits:Zu,getEvent:function({tournamentRecord:t,drawDefinition:e,event:n,context:i}){var r;if(!t)return{error:G};if(!n)return{error:W};const a=Ht(n);return i&&Object.assign(a,i),{event:a,drawDefinition:e&&(null===(r=a.drawDefinitions)||void 0===r?void 0:r.find((({drawId:t})=>e.drawId===t)))}},getEvents:function({tournamentRecord:t,context:e,inContext:n}){if(!t)return{error:G};const{tournamentId:i}=t;return{events:(t.events||[]).map((t=>{const r=Ht(t);return e&&Object.assign(r,e),n&&Object.assign(r,{tournamentId:i}),r}))}},findEventExtension:Fn,findTournamentExtension:Ln,findParticipantExtension:function({tournamentRecord:t,participantId:e,name:n}){if(!t)return{error:G};if(!e)return{error:"Missing participantId"};const{participant:i}=Cn({tournamentRecord:t,participantId:e});return On({element:i,name:n})},findDrawDefinitionExtension:xn,getTieFormat:function({tournamentRecord:t,drawDefinition:e,structureId:n,matchUpId:i,drawId:r,event:a}){var o,s,c;if(!t)return{error:G};if(!(r||a||n||i))return{error:z};const u=Aa({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r,event:a});if(i&&null!=u&&u.error)return u;!e&&null!=u&&u.drawDefinition&&(e=null==u?void 0:u.drawDefinition);let d=null==u?void 0:u.structure;if(!d&&n&&!i){if(!e)return{error:"Missing drawId"};const t=hr({drawDefinition:e,structureId:n});if(t.error)return t;d=t.structure}const l=null===(o=d)||void 0===o?void 0:o.tieFormat,p=null===(s=e)||void 0===s?void 0:s.tieFormat,m=null==a?void 0:a.tieFormat;return{structureDefaultTieFormat:l,eventDefaultTieFormat:m,drawDefaultTieFormat:p,tieFormat:(null==u||null===(c=u.matchUp)||void 0===c?void 0:c.tieFormat)||l||p||m||void 0}},getMatchUpFormat:au,getDrawDefinition:function({tournamentRecord:t,drawDefinition:e}){return t?{drawDefinition:Ht(e)}:{error:G}},getEventProperties:function({tournamentRecord:t,event:e}){var n,i;if(!t)return{error:G};if(!e)return{error:W};const r=e.entries||[],a=t.participants||[],o=(null===(n=e.category)||void 0===n?void 0:n.categoryName)||(null===(i=e.category)||void 0===i?void 0:i.ageCategoryCode),{eventType:s}=e,c=r.map((t=>t.participantId));let u,d,l;return{entryScaleAttributes:a.filter((t=>c.includes(t.participantId))).map((t=>{var e,n,i,r,a,c;const{participantId:p,participantName:m,name:f}=t;let h={scaleType:"SEEDING",eventType:s,scaleName:o};const v=null===(e=Bc({participant:t,scaleAttributes:h}))||void 0===e||null===(n=e.scaleItem)||void 0===n?void 0:n.scaleValue;h={scaleType:"RANKING",eventType:s,scaleName:o};const I=null===(i=Bc({participant:t,scaleAttributes:h}))||void 0===i||null===(r=i.scaleItem)||void 0===r?void 0:r.scaleValue;h={scaleType:"RATING",eventType:s,scaleName:o};const g=null===(a=Bc({participant:t,scaleAttributes:h}))||void 0===a||null===(c=a.scaleItem)||void 0===c?void 0:c.scaleValue;return u=!(!u&&!v),d=!(!d&&!I),l=!(!l&&!g),{participantId:p,participantName:m||f,seed:v,ranking:I,rating:g}})),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:l}},getPositionAssignments:function({tournamentRecord:t,drawDefinition:e,structureId:n}){return t?e?n?Qr({drawDefinition:e,structureId:n}):{error:"Missing structureId"}:{error:q}:{error:G}},isValidMatchUpFormat:h,getMaxEntryPosition:function({entries:t=[],entryStatus:e,stage:n}){return Math.max(...t.filter((t=>!(n&&n!==t.entryStage||e&&t.entryStatus!==e||isNaN(t.entryPosition)))).map((({entryPosition:t})=>parseInt(t||0))),0)},findVenue:qn,getCourts:Wn,getVenuesAndCourts:Gn,findCourt:function(t){return Ht(Hn(t),!1,!0)},getEventTimeItem:po,getTournamentTimeItem:function({tournamentRecord:t,itemType:e,itemSubTypes:n,returnPreviousValues:i}){if(!t)return{error:G};if(!t.timeItems)return{message:J};const{timeItem:r,previousItems:a,message:o}=lo({element:t,itemType:e,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:a}||{message:o}},getParticipantTimeItem:function({tournamentRecord:t,participantId:e,itemType:n,itemSubTypes:i,returnPreviousValues:r}){if(!t)return{error:G};if(!e)return{error:"Missing participantId"};const a=Cn({tournamentRecord:t,participantId:e});if(a.error)return a;const{participant:o}=a;if(null==o||!o.timeItems)return{message:J};const{timeItem:s,previousItems:c,message:u}=lo({element:a.participant,itemType:n,itemSubTypes:i,returnPreviousValues:r});return s&&{timeItem:s,previousItems:c}||{message:u}},getDrawDefinitionTimeItem:function({drawDefinition:t,itemType:e,itemSubTypes:n,returnPreviousValues:i}){if(!t)return{error:"Missing drawId"};if(!t.timeItems)return{message:J};const{timeItem:r,previousItems:a,message:o}=lo({element:t,itemType:e,itemSubTypes:n,returnPreviousValues:i});return r&&{timeItem:r,previousItems:a}||{message:o}},bulkUpdatePublishedEventIds:function({tournamentRecord:t,outcomes:e}){var n;if(!t)return{error:G};if(null==e||!e.length)return{error:z,message:"Missing outcomes"};const i=e.reduce(((t,e)=>{const{drawId:n,eventId:i}=e;return i&&n&&(t[i]?t[i].includes(n)||t[i].push(n):t[i]=[n]),t}),{}),r=Object.keys(i);return{publishedEventIds:(null===(n=t.events)||void 0===n?void 0:n.filter((t=>r.includes(t.eventId)))).filter((t=>{const{timeItem:e}=po({itemType:"PUBLISH.STATUS",event:t}),n=null==e?void 0:e.itemValue,{eventId:r}=t;return i[r].filter((t=>{var e;return n&&n.PUBLIC&&(null===(e=n.PUBLIC.drawIds)||void 0===e?void 0:e.includes(t))})).length})).map((t=>t.eventId)),eventIdPublishedDrawIdsMap:i}},matchUpActions:Xu,positionActions:function({policyDefinitions:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,structureId:r,drawId:a,event:o}){const{tournamentParticipants:s}=qc({tournamentRecord:e,inContext:!0});return ip({tournamentParticipants:s,policyDefinitions:t,tournamentRecord:e,drawDefinition:n,drawPosition:i,structureId:r,drawId:a,event:o})},findMatchUp:function(t){Object.assign(t,{inContext:!0});const{matchUp:e,error:n}=Aa(t);return{matchUp:Ht(e,!0,!0),error:n}},participantScheduledMatchUps:Pc,participantScaleItem:Bc,getParticipantScaleItem:Dp,getParticipantSignInStatus:function({tournamentRecord:t,participantId:e}){if(!t)return{error:G};if(!e)return{error:"Missing participantId"};const{participant:n}=Cn({tournamentRecord:t,participantId:e});if(!n)return{error:Y};const{timeItem:i}=lo({itemType:"SIGN_IN_STATUS",element:n});return i&&i.itemValue===Rc&&Rc},getPolicyDefinitions:ms,getMatchUpScheduleDetails:wi},Am={addVenue:Sc,deleteVenue:Uc,deleteVenues:function({tournamentRecord:t,venueIds:e,force:n}){if(!t)return{error:G};if(!Array.isArray(e))return{error:$};for(const i of t.venues||[]){const{venueId:r}=i;if(e.includes(r)){const{venueId:e}=i,r=Uc({tournamentRecord:t,venueId:e,force:n});if(r.error)return r}}return B},modifyVenue:Ic,addCourt:hc,addCourts:vc,deleteCourt:function({tournamentRecord:t,drawDefinition:e,disableNotice:n,courtId:i,force:r}){const{venue:a,error:o}=Hn({tournamentRecord:t,courtId:i});if(o)return{error:o};const{matchUps:s}=uc({tournamentRecord:t,courtId:i});if(s.length&&!r)return dc({matchUpsCount:s.length});for(const c of s){const n=gc({tournamentRecord:t,drawDefinition:e,drawId:c.drawId,matchUpId:c.matchUpId});if(n.error)return n}return a.courts=(a.courts||[]).filter((t=>t.courtId!==i)),n||at({topic:"modifyVenue",payload:{venue:a},key:a.venueId}),{...B}},modifyCourt:fc,modifyCourtAvailability:mc,findVenue:function(t){return Ht(qn(t),!1,!0)}},Em=function(){const t={getState:({convertExtensions:t,removeExtensions:e}={})=>Rp({convertExtensions:t,removeExtensions:e,tournamentId:dt()}),newTournamentRecord:(t={})=>{const e=Ep(t);return e.error?e:(mt(e),ht(e.tournamentId),Object.assign({tournamentId:e.tournamentId},B))},setTournamentId:t=>ht(t)};function e(e){return null!=e&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}return t.version=()=>"0.117.10",t.reset=()=>e(vt(dt())),t.setState=(t,n,i)=>(rt(n,i),e(bp(t,n))),t.devContext=e=>(nt(e),t),t.getDevContext=t=>et(t),t.executionQueue=(e,i)=>function(e,i){if(!Array.isArray(e))return{error:$};const r=lt(dt()),a=i&&Ht(r,!1,!0),o=[];for(const s of e){if("object"!=typeof s)return{error:$};const{method:e,params:i}=s;if(!t[e])return{error:"Method not found"};const c=n(r,t[e],i,e);if(null!=c&&c.error)return a&&bp(a),{...c,rolledBack:!!a};o.push(c)}return Qc(),st(),{results:o}}(e,i),[Mm,Tm,Am,Zp,Yp,qp,Kp,Bp].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{if(et())return i(e[n],t,n);try{return i(e[n],t,n)}catch(e){const r=e.toString();console.log("ERROR",{error:r,methodName:n,params:JSON.stringify(t)}),console.log(e)}}}))})),t;function n(e,n,i,r){delete t.success,delete t.error;const a=Date.now(),o=n({...Cp(e,i),tournamentRecord:e}),s=Date.now()-a,c=et();return c.perf&&(isNaN(c.perf)||s>c.perf)&&console.log("te:",{methodName:r,elapsed:s}),c.params&&console.log({params:i}),o}function i(t,e,i){const r=(null==e?void 0:e.sandBoxRecord)||(null==e?void 0:e.sandboxRecord)||(null==e?void 0:e.sandboxTournament)||lt(dt()),a=(null==e?void 0:e.rollbackOnError)&&Ht(r,!1,!0),o=n(r,t,e,i);null!=o&&o.error&&a&&bp(a);const s=(null==o?void 0:o.success)&&!0!==(null==e?void 0:e.delayNotify)&&!0!==(null==e?void 0:e.doNotNotify);return s&&Qc(),(s||null==o||!o.success||null!=e&&e.doNotNotify)&&st(),o}}();var bm=[{firstName:"Novak",lastName:"Djokovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Rafael",lastName:"Nadal",sex:"MALE",nationalityCode:"ESP"},{firstName:"Dominic",lastName:"Thiem",sex:"MALE",nationalityCode:"AUT"},{firstName:"Roger",lastName:"Federer",sex:"MALE",nationalityCode:"SUI"},{firstName:"Stefanos",lastName:"Tsitsipas",sex:"MALE",nationalityCode:"GRE"},{firstName:"Daniil",lastName:"Medvedev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Alexander",lastName:"Zverev",sex:"MALE",nationalityCode:"GER"},{firstName:"Andrey",lastName:"Rublev",sex:"MALE",nationalityCode:"RUS"},{firstName:"Diego",lastName:"Schwartzman",sex:"MALE",nationalityCode:"ARG"},{firstName:"Matteo",lastName:"Berrettini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Gael",lastName:"Monfils",sex:"MALE",nationalityCode:"FRA"},{firstName:"Denis",lastName:"Shapovalov",sex:"MALE",nationalityCode:"CAN"},{firstName:"Roberto",lastName:"Bautista Agut",sex:"MALE",nationalityCode:"ESP"},{firstName:"David",lastName:"Goffin",sex:"MALE",nationalityCode:"BEL"},{firstName:"Pablo",lastName:"Carreno Busta",sex:"MALE",nationalityCode:"ESP"},{firstName:"Fabio",lastName:"Fognini",sex:"MALE",nationalityCode:"ITA"},{firstName:"Milos",lastName:"Raonic",sex:"MALE",nationalityCode:"CAN"},{firstName:"Karen",lastName:"Khachanov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Stan",lastName:"Wawrinka",sex:"MALE",nationalityCode:"SUI"},{firstName:"Grigor",lastName:"Dimitrov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Felix",lastName:"Auger-Aliassime",sex:"MALE",nationalityCode:"CAN"},{firstName:"Cristian",lastName:"Garin",sex:"MALE",nationalityCode:"CHI"},{firstName:"John",lastName:"Isner",sex:"MALE",nationalityCode:"USA"},{firstName:"Borna",lastName:"Coric",sex:"MALE",nationalityCode:"CRO"},{firstName:"Alex",lastName:"de Minaur",sex:"MALE",nationalityCode:"AUS"},{firstName:"Dusan",lastName:"Lajovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Casper",lastName:"Ruud",sex:"MALE",nationalityCode:"NOR"},{firstName:"Benoit",lastName:"Paire",sex:"MALE",nationalityCode:"FRA"},{firstName:"Taylor",lastName:"Fritz",sex:"MALE",nationalityCode:"USA"},{firstName:"Filip",lastName:"Krajinovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Hubert",lastName:"Hurkacz",sex:"MALE",nationalityCode:"POL"},{firstName:"Ugo",lastName:"Humbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Daniel",lastName:"Evans",sex:"MALE",nationalityCode:"GBR"},{firstName:"Jan-Lennard",lastName:"Struff",sex:"MALE",nationalityCode:"GER"},{firstName:"Reilly",lastName:"Opelka",sex:"MALE",nationalityCode:"USA"},{firstName:"Nikoloz",lastName:"Basilashvili",sex:"MALE",nationalityCode:"GEO"},{firstName:"Kei",lastName:"Nishikori",sex:"MALE",nationalityCode:"JPN"},{firstName:"Guido",lastName:"Pella",sex:"MALE",nationalityCode:"ARG"},{firstName:"Adrian",lastName:"Mannarino",sex:"MALE",nationalityCode:"FRA"},{firstName:"Miomir",lastName:"Kecmanovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Marin",lastName:"Cilic",sex:"MALE",nationalityCode:"CRO"},{firstName:"Lorenzo",lastName:"Sonego",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jannik",lastName:"Sinner",sex:"MALE",nationalityCode:"ITA"},{firstName:"Nick",lastName:"Kyrgios",sex:"MALE",nationalityCode:"AUS"},{firstName:"John",lastName:"Millman",sex:"MALE",nationalityCode:"AUS"},{firstName:"Albert",lastName:"Ramos-Vinolas",sex:"MALE",nationalityCode:"ESP"},{firstName:"Kyle",lastName:"Edmund",sex:"MALE",nationalityCode:"GBR"},{firstName:"Tennys",lastName:"Sandgren",sex:"MALE",nationalityCode:"USA"},{firstName:"Alexander",lastName:"Bublik",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Sam",lastName:"Querrey",sex:"MALE",nationalityCode:"USA"},{firstName:"Yoshihito",lastName:"Nishioka",sex:"MALE",nationalityCode:"JPN"},{firstName:"Marton",lastName:"Fucsovics",sex:"MALE",nationalityCode:"HUN"},{firstName:"Aljaz",lastName:"Bedene",sex:"MALE",nationalityCode:"SLO"},{firstName:"Laslo",lastName:"Djere",sex:"MALE",nationalityCode:"SRB"},{firstName:"Richard",lastName:"Gasquet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pablo",lastName:"Andujar",sex:"MALE",nationalityCode:"ESP"},{firstName:"Jo-Wilfried",lastName:"Tsonga",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gilles",lastName:"Simon",sex:"MALE",nationalityCode:"FRA"},{firstName:"Tommy",lastName:"Paul",sex:"MALE",nationalityCode:"USA"},{firstName:"Jordan",lastName:"Thompson",sex:"MALE",nationalityCode:"AUS"},{firstName:"Fernando",lastName:"Verdasco",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alejandro",lastName:"Davidovich Fokina",sex:"MALE",nationalityCode:"ESP"},{firstName:"Feliciano",lastName:"Lopez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Frances",lastName:"Tiafoe",sex:"MALE",nationalityCode:"USA"},{firstName:"Dominik",lastName:"Koepfer",sex:"MALE",nationalityCode:"GER"},{firstName:"Jiri",lastName:"Vesely",sex:"MALE",nationalityCode:"CZE"},{firstName:"Pablo",lastName:"Cuevas",sex:"MALE",nationalityCode:"URU"},{firstName:"Ricardas",lastName:"Berankis",sex:"MALE",nationalityCode:"LTU"},{firstName:"Lucas",lastName:"Pouille",sex:"MALE",nationalityCode:"FRA"},{firstName:"Cameron",lastName:"Norrie",sex:"MALE",nationalityCode:"GBR"},{firstName:"Steve",lastName:"Johnson",sex:"MALE",nationalityCode:"USA"},{firstName:"Jeremy",lastName:"Chardy",sex:"MALE",nationalityCode:"FRA"},{firstName:"Stefano",lastName:"Travaglia",sex:"MALE",nationalityCode:"ITA"},{firstName:"Corentin",lastName:"Moutet",sex:"MALE",nationalityCode:"FRA"},{firstName:"Juan",lastName:"Ignacio Londero",sex:"MALE",nationalityCode:"ARG"},{firstName:"Federico",lastName:"Delbonis",sex:"MALE",nationalityCode:"ARG"},{firstName:"Marco",lastName:"Cecchinato",sex:"MALE",nationalityCode:"ITA"},{firstName:"Thiago",lastName:"Monteiro",sex:"MALE",nationalityCode:"BRA"},{firstName:"Salvatore",lastName:"Caruso",sex:"MALE",nationalityCode:"ITA"},{firstName:"Lloyd",lastName:"Harris",sex:"MALE",nationalityCode:"RSA"},{firstName:"Vasek",lastName:"Pospisil",sex:"MALE",nationalityCode:"CAN"},{firstName:"Pierre-Hugues",lastName:"Herbert",sex:"MALE",nationalityCode:"FRA"},{firstName:"Egor",lastName:"Gerasimov",sex:"MALE",nationalityCode:"BLR"},{firstName:"Joao",lastName:"Sousa",sex:"MALE",nationalityCode:"POR"},{firstName:"Radu",lastName:"Albot",sex:"MALE",nationalityCode:"MDA"},{firstName:"Marcos",lastName:"Giron",sex:"MALE",nationalityCode:"USA"},{firstName:"Mikael",lastName:"Ymer",sex:"MALE",nationalityCode:"SWE"},{firstName:"Attila",lastName:"Balazs",sex:"MALE",nationalityCode:"HUN"},{firstName:"Federico",lastName:"Coria",sex:"MALE",nationalityCode:"ARG"},{firstName:"Soonwoo",lastName:"Kwon",sex:"MALE",nationalityCode:"KOR"},{firstName:"Mikhail",lastName:"Kukushkin",sex:"MALE",nationalityCode:"KAZ"},{firstName:"Dennis",lastName:"Novak",sex:"MALE",nationalityCode:"AUT"},{firstName:"Pedro",lastName:"Martinez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Philipp",lastName:"Kohlschreiber",sex:"MALE",nationalityCode:"GER"},{firstName:"Yannick",lastName:"Hanfmann",sex:"MALE",nationalityCode:"GER"},{firstName:"Gianluca",lastName:"Mager",sex:"MALE",nationalityCode:"ITA"},{firstName:"James",lastName:"Duckworth",sex:"MALE",nationalityCode:"AUS"},{firstName:"Emil",lastName:"Ruusuvuori",sex:"MALE",nationalityCode:"FIN"},{firstName:"Yasutaka",lastName:"Uchiyama",sex:"MALE",nationalityCode:"JPN"},{firstName:"Roberto",lastName:"Carballes Baena",sex:"MALE",nationalityCode:"ESP"},{firstName:"Ashleigh",lastName:"Barty",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Simona",lastName:"Halep",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Naomi",lastName:"Osaka",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Sofia",lastName:"Kenin",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Elina",lastName:"Svitolina",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Karolina",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Bianca",lastName:"Andreescu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Petra",lastName:"Kvitova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Kiki",lastName:"Bertens",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Serena",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aryna",lastName:"Sabalenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Belinda",lastName:"Bencic",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Victoria",lastName:"Azarenka",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Johanna",lastName:"Konta",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Garbine",lastName:"Muguruza",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Madison",lastName:"Keys",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Iga",lastName:"Swiatek",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Petra",lastName:"Martic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Elena",lastName:"Rybakina",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Marketa",lastName:"Vondrousova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Elise",lastName:"Mertens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Maria",lastName:"Sakkari",sex:"FEMALE",nationalityCode:"GRE"},{firstName:"Anett",lastName:"Kontaveit",sex:"FEMALE",nationalityCode:"EST"},{firstName:"Jennifer",lastName:"Brady",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelique",lastName:"Kerber",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Alison",lastName:"Riske",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Karolina",lastName:"Muchova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Yulia",lastName:"Putintseva",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Dayana",lastName:"Yastremska",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Amanda",lastName:"Anisimova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Ons",lastName:"Jabeur",sex:"FEMALE",nationalityCode:"TUN"},{firstName:"Donna",lastName:"Vekic",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Ekaterina",lastName:"Alexandrova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qiang",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Shuai",lastName:"Zhang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Svetlana",lastName:"Kuznetsova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Barbora",lastName:"Strycova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Anastasia",lastName:"Pavlyuchenkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Sloane",lastName:"Stephens",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Magda",lastName:"Linette",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Saisai",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Fiona",lastName:"Ferro",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Caroline",lastName:"Garcia",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Jelena",lastName:"Ostapenko",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Danielle",lastName:"Collins",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Veronika",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Cori",lastName:"Gauff",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Nadia",lastName:"Podoroska",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Kristina",lastName:"Mladenovic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Laura",lastName:"Siegemund",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Marie",lastName:"Bouzkova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Polona",lastName:"Hercog",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Alize",lastName:"Cornet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Anastasija",lastName:"Sevastova",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Rebecca",lastName:"Peterson",sex:"FEMALE",nationalityCode:"SWE"},{firstName:"Patricia",lastName:"Maria Tig",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Jil",lastName:"Teichmann",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Shelby",lastName:"Rogers",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Heather",lastName:"Watson",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Anna",lastName:"Blinkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Bernarda",lastName:"Pera",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Jessica",lastName:"Pegula",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alison",lastName:"Van Uytvanck",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Katerina",lastName:"Siniakova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Sara",lastName:"Sorribes Tormo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Su-Wei",lastName:"Hsieh",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Ajla",lastName:"Tomljanovic",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Kristyna",lastName:"Pliskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Paula",lastName:"Badosa",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Daria",lastName:"Kasatkina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nao",lastName:"Hibino",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Arantxa",lastName:"Rus",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lauren",lastName:"Davis",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Krejcikova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Camila",lastName:"Giorgi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Irina-Camelia",lastName:"Begu",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Danka",lastName:"Kovinic",sex:"FEMALE",nationalityCode:"MNE"},{firstName:"Venus",lastName:"Williams",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Zarina",lastName:"Diyas",sex:"FEMALE",nationalityCode:"KAZ"},{firstName:"Christina",lastName:"Mchale",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Madison",lastName:"Brengle",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Carla",lastName:"Suarez Navarro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Martina",lastName:"Trevisan",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Kirsten",lastName:"Flipkens",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Misaki",lastName:"Doi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Tamara",lastName:"Zidansek",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Sorana",lastName:"Cirstea",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Leylah",lastName:"Fernandez",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Taylor",lastName:"Townsend",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Lin",lastName:"Zhu",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Ana",lastName:"Bogdan",sex:"FEMALE",nationalityCode:"ROU"},{firstName:"Aliaksandra",lastName:"Sasnovich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Yafan",lastName:"Wang",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Jasmine",lastName:"Paolini",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Varvara",lastName:"Gracheva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Viktoria",lastName:"Kuzmova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Nina",lastName:"Stojanovic",sex:"FEMALE",nationalityCode:"SRB"},{firstName:"Anastasia",lastName:"Potapova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Andrea",lastName:"Petkovic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kaja",lastName:"Juvan",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Elsa",lastName:"Jacquemot",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Victoria",lastName:"Jimenez Kasintseva",sex:"FEMALE",nationalityCode:"AND"},{firstName:"Alexandra",lastName:"Eala",sex:"FEMALE",nationalityCode:"PHI"},{firstName:"Diane",lastName:"Parry",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Daria",lastName:"Snigur",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Polina",lastName:"Kudermetova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Robin",lastName:"Montgomery",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Alexandra",lastName:"Vecic",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Kristina",lastName:"Dmitruk",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Alexa",lastName:"Noel",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Kamilla",lastName:"Bartone",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Weronika",lastName:"Baszak",sex:"FEMALE",nationalityCode:"POL"},{firstName:"Oksana",lastName:"Selekhmeteva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Alina",lastName:"Charaeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Maria",lastName:"Bondarenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Priska",lastName:"Madelyn Nugroho",sex:"FEMALE",nationalityCode:"INA"},{firstName:"Linda",lastName:"Fruhvirtova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Dana",lastName:"Guzman",sex:"FEMALE",nationalityCode:"PER"},{firstName:"Linda",lastName:"Noskova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Hong",lastName:"Yi Cody Wong",sex:"FEMALE",nationalityCode:"HKG"},{firstName:"Zhuoxuan",lastName:"Bai",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Mell",lastName:"Reasco Gonzalez",sex:"FEMALE",nationalityCode:"ECU"},{firstName:"Matilda",lastName:"Mutavdzic",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Diana",lastName:"Shnaider",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Qinwen",lastName:"Zheng",sex:"FEMALE",nationalityCode:"CHN"},{firstName:"Alexandra",lastName:"Yepifanova",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Matilde",lastName:"Paoletti",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Melania",lastName:"Delai",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jana",lastName:"Kolodynska",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Guillermina",lastName:"Grant",sex:"FEMALE",nationalityCode:"URU"},{firstName:"Darja",lastName:"Vidmanova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Melodie",lastName:"Collard",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Elvina",lastName:"Kalieva",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Sofia",lastName:"Costoulas",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Aliona",lastName:"Falei",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Mai",lastName:"Nirundorn",sex:"FEMALE",nationalityCode:"THA"},{firstName:"Elizabeth",lastName:"Coleman",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Aubane",lastName:"Droguet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Madison",lastName:"Sieg",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Natsumi",lastName:"Kawaguchi",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Leyre",lastName:"Romero Gormaz",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Elina",lastName:"Avanesyan",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Oceane",lastName:"Babel",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ziva",lastName:"Falkner",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Julia",lastName:"Garcia",sex:"FEMALE",nationalityCode:"MEX"},{firstName:"Natalia",lastName:"Szabanin",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Erika",lastName:"Andreeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Celia",lastName:"Belle Mohr",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Ane",lastName:"Mintegi Del Olmo",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Sebastianna",lastName:"Scilipoti",sex:"FEMALE",nationalityCode:"SUI"},{firstName:"Ana",lastName:"Geller",sex:"FEMALE",nationalityCode:"ARG"},{firstName:"Dayeon",lastName:"Back",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Selena",lastName:"Janicijevic",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Romana",lastName:"Cisovska",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Amarissa",lastName:"Kiara Toth",sex:"FEMALE",nationalityCode:"HUN"},{firstName:"Mara",lastName:"Guth",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Evialina",lastName:"Laskevich",sex:"FEMALE",nationalityCode:"BLR"},{firstName:"Julia",lastName:"Avdeeva",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Beatrice",lastName:"Ricci",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Eleonora",lastName:"Alvisi",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Jessica",lastName:"Bouzas Maneiro",sex:"FEMALE",nationalityCode:"ESP"},{firstName:"Julie",lastName:"Belgraver",sex:"FEMALE",nationalityCode:"NED"},{firstName:"Lisa",lastName:"Pigato",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Ya",lastName:"Yi Yang",sex:"FEMALE",nationalityCode:"TPE"},{firstName:"Eva",lastName:"Lys",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Talia",lastName:"Gibson",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Yeon",lastName:"Ku",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Katrina",lastName:"Scott",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Barbora",lastName:"Palicova",sex:"FEMALE",nationalityCode:"CZE"},{firstName:"Alina",lastName:"Shcherbinina",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Giulia",lastName:"Morlet",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tina",lastName:"Nadine Smith",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"Sohyun",lastName:"Park",sex:"FEMALE",nationalityCode:"KOR"},{firstName:"Tara",lastName:"Wurth",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Polina",lastName:"Iatcenko",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Lauren",lastName:"Anzalotta Kynoch",sex:"FEMALE",nationalityCode:"PUR"},{firstName:"Savannah",lastName:"Broadus",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Angelina",lastName:"Wirges",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Amarni",lastName:"Banks",sex:"FEMALE",nationalityCode:"GBR"},{firstName:"Hanne",lastName:"Vandewinkel",sex:"FEMALE",nationalityCode:"BEL"},{firstName:"Jada",lastName:"Bui",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Sabina",lastName:"Zeynalova",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Pia",lastName:"Lovric",sex:"FEMALE",nationalityCode:"SLO"},{firstName:"Erika",lastName:"Matsuda",sex:"FEMALE",nationalityCode:"JPN"},{firstName:"Lyubov",lastName:"Kostenko",sex:"FEMALE",nationalityCode:"UKR"},{firstName:"Anaelle",lastName:"Leclercq",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Alessandra",lastName:"Simone",sex:"FEMALE",nationalityCode:"ITA"},{firstName:"Darja",lastName:"Semenistaja",sex:"FEMALE",nationalityCode:"LAT"},{firstName:"Daria",lastName:"Frayman",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Nastasja",lastName:"Schunk",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Olivia",lastName:"Gadecki",sex:"FEMALE",nationalityCode:"AUS"},{firstName:"India",lastName:"Houghton",sex:"FEMALE",nationalityCode:"USA"},{firstName:"Maria",lastName:"Sholokhova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Julia",lastName:"Middendorf",sex:"FEMALE",nationalityCode:"GER"},{firstName:"Petra",lastName:"Marcinko",sex:"FEMALE",nationalityCode:"CRO"},{firstName:"Radka",lastName:"Zelnickova",sex:"FEMALE",nationalityCode:"SVK"},{firstName:"Lucie",lastName:"Nguyen Tan",sex:"FEMALE",nationalityCode:"FRA"},{firstName:"Tatiana",lastName:"Barkova",sex:"FEMALE",nationalityCode:"RUS"},{firstName:"Annabelle",lastName:"Xu",sex:"FEMALE",nationalityCode:"CAN"},{firstName:"Harold",lastName:"Mayot",sex:"MALE",nationalityCode:"FRA"},{firstName:"Holger",lastName:"Vitus Nodskov Rune",sex:"MALE",nationalityCode:"DEN"},{firstName:"Dominic",lastName:"Stephan Stricker",sex:"MALE",nationalityCode:"SUI"},{firstName:"Shintaro",lastName:"Mochizuki",sex:"MALE",nationalityCode:"JPN"},{firstName:"Arthur",lastName:"Cazaux",sex:"MALE",nationalityCode:"FRA"},{firstName:"Leandro",lastName:"Riedi",sex:"MALE",nationalityCode:"SUI"},{firstName:"Martin",lastName:"Damm",sex:"MALE",nationalityCode:"USA"},{firstName:"Natan",lastName:"Rodrigues",sex:"MALE",nationalityCode:"BRA"},{firstName:"Karlis",lastName:"Ozolins",sex:"MALE",nationalityCode:"LAT"},{firstName:"Luciano",lastName:"Darderi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Hanwen",lastName:"Li",sex:"MALE",nationalityCode:"CHN"},{firstName:"Arthur",lastName:"Fery",sex:"MALE",nationalityCode:"GBR"},{firstName:"Juan",lastName:"Bautista Torres",sex:"MALE",nationalityCode:"ARG"},{firstName:"Khololwam",lastName:"Montsi",sex:"MALE",nationalityCode:"RSA"},{firstName:"Jeffrey",lastName:"Von Der Schulenburg",sex:"MALE",nationalityCode:"SUI"},{firstName:"Timo",lastName:"Legout",sex:"MALE",nationalityCode:"FRA"},{firstName:"Gustavo",lastName:"Heide",sex:"MALE",nationalityCode:"BRA"},{firstName:"Flavio",lastName:"Cobolli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Guy",lastName:"Den Ouden",sex:"MALE",nationalityCode:"NED"},{firstName:"Martin",lastName:"Breysach",sex:"MALE",nationalityCode:"FRA"},{firstName:"Toby",lastName:"Kodat",sex:"MALE",nationalityCode:"USA"},{firstName:"Lilian",lastName:"Marmousez",sex:"MALE",nationalityCode:"FRA"},{firstName:"Roman",lastName:"Andres Burruchaga",sex:"MALE",nationalityCode:"ARG"},{firstName:"Alex",lastName:"Barrena",sex:"MALE",nationalityCode:"ARG"},{firstName:"Dalibor",lastName:"Svrcina",sex:"MALE",nationalityCode:"CZE"},{firstName:"Martin",lastName:"Krumich",sex:"MALE",nationalityCode:"CZE"},{firstName:"Peter",lastName:"Fajta",sex:"MALE",nationalityCode:"HUN"},{firstName:"Lukas",lastName:"Neumayer",sex:"MALE",nationalityCode:"AUT"},{firstName:"Raphael",lastName:"Collignon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Dali",lastName:"Blanch",sex:"MALE",nationalityCode:"USA"},{firstName:"Terence",lastName:"Atmane",sex:"MALE",nationalityCode:"FRA"},{firstName:"Felix",lastName:"Gill",sex:"MALE",nationalityCode:"GBR"},{firstName:"Eliakim",lastName:"Coulibaly",sex:"MALE",nationalityCode:"CIV"},{firstName:"Hamad",lastName:"Medjedovic",sex:"MALE",nationalityCode:"SRB"},{firstName:"Jerome",lastName:"Kym",sex:"MALE",nationalityCode:"SUI"},{firstName:"Nicholas",lastName:"David Ionel",sex:"MALE",nationalityCode:"ROU"},{firstName:"Shunsuke",lastName:"Mitsui",sex:"MALE",nationalityCode:"JPN"},{firstName:"Giovanni",lastName:"Mpetshi Perricard",sex:"MALE",nationalityCode:"FRA"},{firstName:"Bu",lastName:"Yunchaokete",sex:"MALE",nationalityCode:"CHN"},{firstName:"Jack",lastName:"Pinnington Jones",sex:"MALE",nationalityCode:"GBR"},{firstName:"Alexander",lastName:"Hoogmartens",sex:"MALE",nationalityCode:"BEL"},{firstName:"Bruno",lastName:"Oliveira",sex:"MALE",nationalityCode:"BRA"},{firstName:"Maks",lastName:"Kasnikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Mikolaj",lastName:"Lorens",sex:"MALE",nationalityCode:"POL"},{firstName:"Chak",lastName:"Lam Coleman Wong",sex:"MALE",nationalityCode:"HKG"},{firstName:"Egor",lastName:"Agafonov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Mans",lastName:"Dahlberg",sex:"MALE",nationalityCode:"SWE"},{firstName:"Marat",lastName:"Sharipov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Luca",lastName:"Nardi",sex:"MALE",nationalityCode:"ITA"},{firstName:"Sean",lastName:"Cuenin",sex:"MALE",nationalityCode:"FRA"},{firstName:"Pedro",lastName:"Boscardin Dias",sex:"MALE",nationalityCode:"BRA"},{firstName:"Samuel",lastName:"Vincent Ruggeri",sex:"MALE",nationalityCode:"ITA"},{firstName:"Bruno",lastName:"Kuzuhara",sex:"MALE",nationalityCode:"USA"},{firstName:"Romain",lastName:"Faucon",sex:"MALE",nationalityCode:"BEL"},{firstName:"Elmer",lastName:"Moller",sex:"MALE",nationalityCode:"DEN"},{firstName:"Mario",lastName:"Mansilla Diez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Leonardo",lastName:"Malgaroli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Pierre",lastName:"Yves Bailly",sex:"MALE",nationalityCode:"BEL"},{firstName:"Sebastian",lastName:"Gima",sex:"MALE",nationalityCode:"ROU"},{firstName:"Ilya",lastName:"Snitari",sex:"MALE",nationalityCode:"MDA"},{firstName:"Diego",lastName:"Augusto Barreto Sanchez",sex:"MALE",nationalityCode:"ESP"},{firstName:"Alexander",lastName:"Bernard",sex:"MALE",nationalityCode:"USA"},{firstName:"Pengyu",lastName:"Lu",sex:"MALE",nationalityCode:"CHN"},{firstName:"Max",lastName:"Wiskandt",sex:"MALE",nationalityCode:"GER"},{firstName:"Max",lastName:"Westphal",sex:"MALE",nationalityCode:"FRA"},{firstName:"Lorenzo",lastName:"Claverie",sex:"MALE",nationalityCode:"VEN"},{firstName:"Axel",lastName:"Garcian",sex:"MALE",nationalityCode:"FRA"},{firstName:"Aleksander",lastName:"Orlikowski",sex:"MALE",nationalityCode:"POL"},{firstName:"Maxwell",lastName:"Mckennon",sex:"MALE",nationalityCode:"USA"},{firstName:"Rafael",lastName:"Alfonso De Alba Valdes",sex:"MALE",nationalityCode:"MEX"},{firstName:"Dev",lastName:"Javia",sex:"MALE",nationalityCode:"IND"},{firstName:"Kokoro",lastName:"Isomura",sex:"MALE",nationalityCode:"JPN"},{firstName:"Matteo",lastName:"Gigante",sex:"MALE",nationalityCode:"ITA"},{firstName:"Jack",lastName:"Anthrop",sex:"MALE",nationalityCode:"USA"},{firstName:"Pablo",lastName:"Llamas Ruiz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Biagio",lastName:"Gramaticopolo",sex:"MALE",nationalityCode:"ITA"},{firstName:"Patorn",lastName:"Hanchaikul",sex:"MALE",nationalityCode:"THA"},{firstName:"Marko",lastName:"Topo",sex:"MALE",nationalityCode:"SRB"},{firstName:"Carlos",lastName:"Alcaraz",sex:"MALE",nationalityCode:"ESP"},{firstName:"Juncheng",lastName:"Shang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Toby",lastName:"Samuel",sex:"MALE",nationalityCode:"GBR"},{firstName:"Petr",lastName:"Nesterov",sex:"MALE",nationalityCode:"BUL"},{firstName:"Mehdi",lastName:"Sadaoui",sex:"MALE",nationalityCode:"FRA"},{firstName:"Max",lastName:"Alcala Gurri",sex:"MALE",nationalityCode:"ESP"},{firstName:"Nikita",lastName:"Kashirin",sex:"MALE",nationalityCode:"RUS"},{firstName:"Aidan",lastName:"Mayo",sex:"MALE",nationalityCode:"USA"},{firstName:"Yu",lastName:"Zhang",sex:"MALE",nationalityCode:"CHN"},{firstName:"Philip",lastName:"Sekulic",sex:"MALE",nationalityCode:"AUS"},{firstName:"Lorenzo",lastName:"Rottoli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Michal",lastName:"Novansky",sex:"MALE",nationalityCode:"SVK"},{firstName:"Maikel",lastName:"De Boes",sex:"MALE",nationalityCode:"BEL"},{firstName:"Chen",lastName:"Dong",sex:"MALE",nationalityCode:"AUS"},{firstName:"Evgeny",lastName:"Philippov",sex:"MALE",nationalityCode:"RUS"},{firstName:"Damien",lastName:"Salvestre",sex:"MALE",nationalityCode:"FRA"},{firstName:"Francesco",lastName:"Maestrelli",sex:"MALE",nationalityCode:"ITA"},{firstName:"Viacheslav",lastName:"Bielinskyi",sex:"MALE",nationalityCode:"UKR"},{firstName:"Jean",lastName:"Marc Malkowski",sex:"MALE",nationalityCode:"SUI"},{firstName:"Santiago",lastName:"De La Fuente",sex:"MALE",nationalityCode:"ARG"},{firstName:"Simeon",lastName:"Terziev",sex:"MALE",nationalityCode:"BUL"},{firstName:"Benjamin",lastName:"Kittay",sex:"MALE",nationalityCode:"USA"}];function Rm({personExtensions:t,consideredDate:e,isMock:n=!0,personData:i,count:r=1,category:a,sex:o}={}){if(isNaN(r))return{error:$};let s=bm.filter((t=>!o||t.sex===o)),c=[];if(Array.isArray(i)){const t=i.filter((t=>!("string"!=typeof t.firstName||"string"!=typeof t.lastName||![Fp,xp].includes(t.sex)||t.nationalityCode&&("string"!=typeof t.nationalityCode||t.nationalityCode.length>3||!ua.find((({iso:e,ioc:n})=>[e,n].includes(t.nationalityCode))))||(t.nationalityCode&&c.push(t.nationalityCode),0))));if(!t.length)return{error:$};s=t}const u=M(s);if(u.length<r){const{maleFirstNames:t,maleLastNames:e,femaleFirstNames:n,femaleLastNames:i,nationalityCodes:a}=bm.reduce(((t,e)=>{const{firstName:n,lastName:i,nationalityCode:r}=e;return e.sex===Fp?(t.maleFirstNames.includes(n)||t.maleFirstNames.push(n),t.maleLastNames.includes(i)||t.maleLastNames.push(i)):(t.femaleFirstNames.includes(n)||t.femaleFirstNames.push(n),t.femaleLastNames.includes(i)||t.femaleLastNames.push(i)),t.nationalityCodes.includes(r)||t.nationalityCodes.push(r),t}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});O(0,r-u.length).forEach((()=>{const r=o||C([Fp,xp]),s=C(a),c={firstName:C(r===Fp?t:n),lastName:C(r===Fp?e:i),sex:r,nationalityCode:s};u.push(c)}))}const{ageMinDate:d,ageMaxDate:l}=co({consideredDate:e,category:a}),p=parseInt((null==d?void 0:d.slice(0,4))||0)||parseInt((null==l?void 0:l.slice(0,4))||0)-3,m=parseInt((null==l?void 0:l.slice(0,4))||0)||parseInt((null==d?void 0:d.slice(0,4))||0)+3,f=(d||l)&&[p,m],h=u.slice(0,r).map(((e,i)=>{const r=f&&R(O(...f)),a=R(O(0,365)),o=r&&function(t,e,n){const i=new Date(t,0);return Dt(new Date(i.setDate(e)),void 0)}(r,a);return Object.assign(Wt({extensions:t||[{name:"regionCode",value:i+1}],birthDate:o,isMock:n}),e)}));return{persons:h.length&&h||u[0],nationalityCodes:c}}function Cm(t){const{cities:e,states:n,postalCodes:i,nationalityCode:r,participantIndex:a}=t;return{city:e&&e[a],state:n&&n[a],postalCode:i&&i[a],countryCode:r}}var Om=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function Lm({count:t=1}={}){const e=M(Om).slice(0,t);return e.length<t&&O(0,t-e.length).forEach((t=>e.push(`Team ${t+1}`))),{teams:e}}var Fm=[{AL:"Alabama"},{AK:"Alaska"},{AZ:"Arizona"},{AR:"Arkansas"},{CA:"California"},{CO:"Colorado"},{CT:"Connecticut"},{DE:"Delaware"},{DC:"District of Columbia"},{FL:"Florida"},{GA:"Georgia"},{HI:"Hawaii"},{ID:"Idaho"},{IL:"Illinois"},{IN:"Indiana"},{IA:"Iowa"},{KS:"Kansas"},{KY:"Kentucky"},{LA:"Louisiana"},{ME:"Maine"},{MD:"Maryland"},{MA:"Massachusetts"},{MI:"Michigan"},{MN:"Minnesota"},{MS:"Mississippi"},{MO:"Missouri"},{MT:"Montana"},{NE:"Nebraska"},{NV:"Nevada"},{NH:"New Hampshire"},{NJ:"New Jersey"},{NM:"New Mexico"},{NY:"New York"},{NC:"North Carolina"},{ND:"North Dakota"},{OH:"Ohio"},{OK:"Oklahoma"},{OR:"Oregon"},{PA:"Pennsylvania"},{RI:"Rhode Island"},{SC:"South Carolina"},{SD:"South Dakota"},{TN:"Tennessee"},{TX:"Texas"},{UT:"Utah"},{VT:"Vermont"},{VA:"Virginia"},{WA:"Washington"},{WV:"West Virginia"},{WI:"Wisconsin"},{WY:"Wyoming"},{PR:"Puerto Rico"}],xm=["Adairsville","Ashburn","Ashland","Audubon Park","Aurora","Bay Minette","Bayville","Bean Station","Becket","Belle Isle","Bellmead","Belville","Benld","Benton","Boaz","Bolivar","Bossier City","Bremen","Brent","Brentwood","Brownsville","Burns","Cairo","Caledonia","Cambridge","Canutillo","Central Garage","Centralia","Cherry Valley","Chester Center","Chesterfield","Cibecue","Cohoe","Collinsville","Columbus","Corcoran","Cuba","Dolgeville","Douglas","Druid Hills","Dyker Heights","Eagar","East Dubuque","East Valley","Edgefield","Eliot","Elizabeth","Elmsford","Emerald Isle","Emory","Estero","Fairmount","Falcon Heights","Falmouth","Fillmore","Flower Hill","Fobes Hill","Fort Valley","Franklin","Freeport","Gardnertown","Gates Mills","Glasgow Village","Goldsboro","Grant-Valkaria","Greenfield","Gretna","Guilford Siding","Hampton Falls","Harrisonville","Hart","Haskins","Hebron","Hennepin","Highgrove","Homerville","Homewood","Hooksett","Inwood","Island Lake","Issaquah","Jasper","Jefferson","Jewell","Kaukauna","Kings Grant","Kingston","Kirkland","Kokomo","Koloa","La Center","LaBelle","Lake Placid","Lake Waccamaw","Laughlin","LaVerkin","Leadville North","Leland","Long Creek","Longmeadow","Luttrell","Magnolia","Malvern","Mar-Mac","Marana","Marble Falls","Martin","Martindale","Martinsburg","Mazomanie","Mechanicsville","Mexico Beach","Middletown","Mobile","Moravian Falls","Morehead","Mount Hermon","Mulberry","Munhall","Nettleton","Newton","North Granby","North Highlands","Northern Cambria","Northwest Harwinton","Nurillo","Oasis","Orlando","Osceola","Otis","Pacolet","Palm Beach Gardens","Paoli","Patton Village","Paw Paw Lake","Pearl River","Pine Bluffs","Pine","Pioneer","Port Hadlock-Irondale","Porter","Potsdam","Price","Princess Anne","Princeville","Red Oak","Richfield","Ridge Wood Heights","Ringwood","Robinwood","Rochester","Rockland","Rockwell City","Roland","Rolling Hills","Ruskin","Saint Anthony","Saint Robert","Salisbury","Sauk Rapids","Sayreville Junction","Sedona","Shawnee","Shenandoah","Silver Lake","South Waverly","Southwest Ranches","Southwick","Spring Green","Spring Valley","Spry","Strawberry Point","Terryville","Texico","Thomson","Tonganoxie","Townsend","Trinity","Union City","Van Buren","Verona Walk","Villa Rica","Warrenton","Warroad","Washington, D.C.","Weaverville","Wescosville","West Clarkston-Highland","West Orange","Williamsport","Windsor","Winnsboro","Woodbridge","Woodmoor","Wyoming","Zeeland"];function km({count:t=1,participantsCount:e=32}={}){const n=M(xm),i=n.slice(0,t);return{cities:O(0,e).map((e=>e<Math.min(t,n.length)?i[e]:C(i)))}}function _m({count:t=1,participantsCount:e=32}={}){const n=M(Fm),i=n.slice(0,t).map((t=>Object.keys(t))).flat();return{states:O(0,e).map((e=>e<Math.min(t,n.length)?i[e]:C(i)))}}function Bm({count:t=1,participantsCount:e=32}={}){const n=O(0,t).map((()=>O(0,5).map((()=>S(0,9))).join("")));return{postalCodes:O(0,e).map((e=>e<t?n[e]:C(n)))}}function jm({scoreString:t,tiebreakTo:e=7}){return t.split(" ").filter(Boolean).map(((t,n)=>function({set:t,setNumber:n}){const i=(null==t?void 0:t.startsWith("["))&&t.split("[")[1].split("]")[0].split("-").map((t=>parseInt(t))),r=t.includes("(")?t.split("(")[0]:t.includes("[")?t.split("[")[0]:t,a=!i&&r.split("-").map((t=>parseInt(t))),o=i?i[0]>i[1]?1:i[0]<i[1]?2:void 0:a[0]>a[1]?1:a[0]<a[1]?2:void 0,s=t.includes("(")&&t.split("(")[1].split(")")[0],c=![!1,void 0].includes(s)&&_e({isSide1:2===o,lowValue:s,tiebreakTo:e})||[],[u,d]=a||[],[l,p]=i||c||[];return{side1Score:u,side2Score:d,side1TiebreakScore:l,side2TiebreakScore:p,winningSide:o,setNumber:n}}({set:t,setNumber:n+1})))}function Vm({scoreString:t,winningSide:e,matchUpStatus:n}){if(!t)return{outcome:{...Is,winningSide:e,matchUpStatus:n}};if(e&&![1,2,void 0].includes(e))return{error:$,winningSide:e};const i=t&&jm({scoreString:t}),r={},a=In({sets:i}),o=In({sets:i,reversed:!0});return 2===e?(r.scoreStringSide1=o,r.scoreStringSide2=a):(r.scoreStringSide1=a,r.scoreStringSide2=o),r.sets=jm({scoreString:r.scoreStringSide1}),{outcome:{matchUpStatus:n,winningSide:e,score:r}}}const Gm={[pe]:2,[oe]:1,[ue]:1,[ae]:4};function qm({matchUpFormat:t="SET3-S:6/TB7",matchUpStatusProfile:e=Gm,pointsPerMinute:n=1,sideWeight:i=4,winningSide:r,defaultWithScorePercent:a=2}){if(!h(t))return{error:"Invalid matchUpFormat"};if("object"!=typeof e)return{error:$};if(a>100&&(a=100),isNaN(a)||isNaN(n)||isNaN(i))return{error:$};const o=Object.keys(e).filter((t=>Object.keys(Se).includes(t)&&t!==re));if(Object.keys(o).reduce(((t,n)=>t+e[n]),0)>100)return{error:$,matchUpStatusProfile:e};const s=o.reduce(((t,n)=>(t.pointer=t.pointer+e[n],t.valueMap.push([t.pointer,n]),t)),{pointer:0,valueMap:[]}),c=S(1,100),d=(s.valueMap.find((t=>c<=t[0]))||[100,re])[1],l={sets:[],scoreStringSide1:"",side2ScoreString:""};if([pe,ae].includes(d)){const t={score:l,winningSide:r=r||S(1,2),matchUpStatus:d};if(!(d===ae&&S(1,100)>100-a))return{outcome:t}}else if(d===oe)return{outcome:{score:l,matchUpStatus:d}};const p=u(t),{bestOf:m,setFormat:f,finalSetFormat:v}=p,I=[],g=S(0,1),U=r?[r-1]:[...O(0,i).map((()=>g)),1-g],y=[ue,ae,ce,de].includes(d)&&(R(O(1,m))||1);let w;for(const u of O(1,m+1)){const e=u===m,{set:i,incomplete:r,winningSideNumber:a}=Hm({incomplete:y===u,matchUpStatus:d,pointsPerMinute:n,setFormat:e&&v||f,setNumber:u,weightedRange:U});if(I.push(i),r){w=a;break}if(wn({matchUp:{score:{sets:I},matchUpFormat:t}}).calculatedWinningSide)break}const N=wn({matchUp:{score:{sets:I},matchUpFormat:t}}),D=w?r||w:N.calculatedWinningSide,{score:P}=rc({score:{sets:I},winningSide:D,matchUpStatus:d});return{outcome:{score:P,winningSide:D,matchUpStatus:d}}}function Hm({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:n,incomplete:i,setFormat:r,setNumber:a}){const o={setNumber:a},{setTo:s,tiebreakFormat:c,tiebreakAt:u,tiebreakSet:d,timed:l,minutes:p}=r,m=S(0,t.length-1),f=t[m];let h;if(l){const r=p*e,a=Math.round(.2*r),s=r+R([1,-1])*a,c=function(t=1,e=3,n=!0){let i=0;for(let r=0;r<e;r++)i+=Math.random()*(t/e);return n&&t>1?Math.round(i):i}(s,2),u=[c,s-c];f&&u.reverse(),h=t[m]+1;let d=u[0]>u[1]?1:u[1]>u[0]?2:0;if(i){const[t,e]=u;return Object.assign(o,{side1Score:t,side2Score:e}),ge.includes(n)?{set:o,incomplete:i,winningSideNumber:h}:{set:o,incomplete:i}}d||(u[S(0,1)]+=1),d=u[0]>u[1]?1:2,d!==h&&u.reverse();const[l,v]=u;return Object.assign(o,{side1Score:l,side2Score:v,winningSide:h}),{set:o}}if(i)return o.side1Score=S(0,u),o.side2Score=S(0,u),ge.includes(n)&&(h=t[m]+1),{set:o,incomplete:i,winningSideNumber:h};{const e=O(1,s+1).map((t=>O(0,s+2-t).map((()=>t)))).flat(),n=e[S(0,e.length-1)],i=s&&ke({isSide1:!0,tiebreakAt:u,lowValue:n,setTo:s}),a=!i,l=1===t.length&&t[m]+1;if(!a){l?(i[0]>i[1]?1:2)!==l&&i.reverse():f&&i.reverse();const[t,e]=i;Object.assign(o,{side1Score:t,side2Score:e})}const p=Sn({matchUpScoringFormat:{setFormat:r},setObject:o});let h;if(p.hasTiebreakCondition||a){const{NoAD:t,tiebreakTo:e}=c||d||{},n=O(1,e+1).map((t=>O(0,e+2-t).map((()=>t)))).flat(),i=n[S(0,n.length-1)];let r=_e({isSide1:!0,lowValue:i,tiebreakTo:e,tiebreakNoAd:t});if(a){const t=r[0]>r[1]?1:2;l?t!==l&&r.reverse():f&&r.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=r,h=r[0]>r[1]?1:2}else 2===p.leadingSide?[o.side1TiebreakScore,o.side2TiebreakScore]=r:[o.side2TiebreakScore,o.side1TiebreakScore]=r}o.winningSide=p.winningSide||p.leadingSide||l||h}return{set:o}}function Wm({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:n,tournamentRecord:i,drawDefinition:r,completionGoal:a,matchUpFormat:o,event:s}){const c=r.structures.slice().sort(fr);let u=0,{matchUps:d,matchUpsMap:l}=ya({contextFilters:{stages:[Vi]},matchUpFilters:{matchUpTypes:[Zt],roundNumbers:[1]},inContext:!0,drawDefinition:r});if(d.length){var p;const t=null===(p=d[0])||void 0===p?void 0:p.structureId,{positionAssignments:e}=Qr({drawDefinition:r,structureId:t});if(null!=e&&e.length){let{tournamentParticipants:t}=qc({participantFilters:{participantTypes:[Zt]},tournamentRecord:i});const n=n=>{const a=n.tieMatchUps.filter((({matchUpType:t})=>t===$t)),o=n.tieMatchUps.filter((({matchUpType:t})=>t===Jt));a.forEach(((n,a)=>{const o=n.matchUpId;n.sides.forEach((n=>{const{drawPosition:c}=n,u=t.find((t=>{const{participantId:n}=t;return e.find((t=>t.participantId===n)).drawPosition===c}));if(u){const t=cm({participantId:u.individualParticipantIds[a],tournamentRecord:i,drawDefinition:r,tieMatchUpId:o,event:s});t.success||console.log(t)}}))})),o.forEach(((n,a)=>{const o=n.matchUpId;n.sides.forEach((n=>{const{drawPosition:c}=n,u=t.find((t=>{const{participantId:n}=t;return e.find((t=>t.participantId===n)).drawPosition===c}));u&&u.individualParticipantIds.slice(2*a,2*a+2).forEach((t=>{const e=cm({participantId:t,tournamentRecord:i,drawDefinition:r,tieMatchUpId:o,event:s});e.success||console.log(e)}))}))}))};d.forEach(n)}}const m="string"==typeof e&&e,f=m&&re;for(const h of c){const{matchUps:e}=oa({matchUpFilters:{matchUpTypes:[Jt,$t]},tournamentRecord:i,inContext:!0,drawDefinition:r,matchUpsMap:l,structure:h,event:s}),c=e.filter((({winningSide:t})=>!t)).sort(ns).map(Fi);for(const d of c){if(!isNaN(a)&&u>=a)break;const{matchUps:e}=oa({matchUpFilters:{matchUpTypes:[Jt,$t]},tournamentRecord:i,inContext:!0,drawDefinition:r,matchUpsMap:l,structure:h,event:s}),c=e.find((t=>t.matchUpId===d)),p=c.matchUpStatus===oe;if(null!=c&&c.readyToScore&&!p){const e=Km({winningSide:!n&&1,matchUpStatusProfile:t,drawDefinition:r,targetMatchUp:c,matchUpFormat:o,matchUpStatus:f,scoreString:m});if(e.error)return e;u+=1}}}return{...B,completedCount:u}}function zm({matchUpStatusCodes:t,drawDefinition:e,targetMatchUp:n,matchUpStatus:i,matchUpFormat:r,scoreString:a,winningSide:o}){if(!n||n.matchUpStatus===ne)return;const{matchUpId:s}=n||{},{outcome:c}=Vm({matchUpStatus:i,scoreString:a,winningSide:o});return t&&(c.matchUpStatusCodes=t),ac({drawDefinition:e,matchUpFormat:r,matchUpId:s,outcome:c})}function Km(t){const{matchUpStatusProfile:e={},drawDefinition:n,matchUpStatus:i,matchUpFormat:r,targetMatchUp:a,scoreString:o,winningSide:s}=t;if(o||i)return zm(t);const{matchUpId:c}=a||{},{outcome:u}=qm({matchUpStatusProfile:e,matchUpFormat:r,winningSide:s});return ac({matchUpFormat:r,drawDefinition:n,matchUpId:c,outcome:u})}function Ym({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:n,tournamentRecord:i,drawProfiles:r,event:a}){const{flightProfile:o}=vs({event:a}),{eventName:s,eventType:c,category:u}=a,{startDate:d}=i,l=[],p=(null==u?void 0:u.categoryName)||(null==u?void 0:u.ageCategoryCode)||(null==u?void 0:u.ratingType);if(Array.isArray(null==o?void 0:o.flights))for(const[f,h]of o.flights.entries()){const{drawId:o,stage:u,drawName:v,drawEntries:I}=h;l.push(h.drawId);const g=r[f],{seedsCount:U,generate:y=!0}=g||{};if(y){var m;const l=I.filter(fs).map(Oi),h=p||s;i&&U&&U<=l.length&&O(1,U+1).forEach(((t,e)=>{let n={scaleValue:t,scaleName:h,scaleType:"SEEDING",eventType:c,scaleDate:d};const r=l[e];Pp({tournamentRecord:i,participantId:r,scaleItem:n})}));let y=fm({...g,matchUpType:c,seedingScaleName:h,tournamentRecord:i,isMock:!0,drawEntries:I,drawName:v,drawId:o,event:a,stage:u});const{drawDefinition:S,error:w}=y;if(w)return{error:w};const N=null===(m=r[f])||void 0===m?void 0:m.drawExtensions;if(Array.isArray(N)&&N.filter(Ir).forEach((t=>gr({element:S,extension:t}))),y=yc({tournamentRecord:i,drawDefinition:S,event:a}),"drawId exists"===y.error)break;if(y.error)return y;if(g.drawType===Ji&&g.drawMatic){const t=g.roundsCount||1;for(const e of O(1,t+1)){const t=Sm({generateMatchUps:!0,tournamentRecord:i,drawDefinition:S,roundNumber:e});if(t.error)return t}}if(null!=g&&g.withPlayoffs){const t=S.structures[0].structureId,e=Xd({idPrefix:g.idPrefix,...g.withPlayoffs,tournamentRecord:i,drawDefinition:S,isMock:!0,structureId:t,event:a});if(null!=e&&e.error)return e}const D=null==g?void 0:g.completionGoal;if(!1!==(null==g?void 0:g.automated)&&(e||D)){const r=null==g?void 0:g.matchUpFormat,o=Wm({completeAllMatchUps:!D&&e,matchUpStatusProfile:t,randomWinningSide:n,tournamentRecord:i,completionGoal:D,drawDefinition:S,matchUpFormat:r,event:a});if(o.error)return o;const s=o.completedCount;if((null==g?void 0:g.drawType)===ur){let o=im({structureId:S.structures.find((t=>t.stage===Vi)).structureId,tournamentRecord:i,drawDefinition:S,event:a});if(o.error)return o;const c=D?D-s:void 0;if(o=Wm({completeAllMatchUps:!D&&e,completionGoal:D?c:void 0,matchUpStatusProfile:t,randomWinningSide:n,tournamentRecord:i,drawDefinition:S,matchUpFormat:r,event:a}),o.error)return o}}}}return{...B,drawIds:l}}function $m({ratingsParameters:t=Sp,valuesInstanceLimit:e,consideredDate:n,category:i,nationalityCodesCount:r,nationalityCodeType:a,nationalityCodes:o,participantsCount:s=32,participantType:c,personIds:u,idPrefix:d,uuids:l,personExtensions:p,addressProps:m,matchUpType:f,personData:h,sex:v,inContext:I,withISO:g,rankingRange:U=[1,100],scaledParticipantsCount:y}){const w=c===Pi||f===Jt,D=c===Di||f===Di,P=s*(w?2:D?8:1),{nationalityCodes:T,persons:A,error:E}=Rm({count:P,personExtensions:p,consideredDate:n,personData:h,category:i,sex:v});if(E)return{error:E};let b=[],R=[],C=[],L=[];if("object"==typeof i){const{categoryName:e,ageCategoryCode:n,ratingType:r}=i;if(!e&&!n||r||(R=M(O(...U)).slice(0,y||S(20,30)),[Pi,Di].includes(c)&&(b=M(O(...U)).slice(0,y||S(20,30)))),r&&t[r]){let{ratingMax:e,ratingMin:n,ratingAttributes:a}=i;const o=Object.assign({},t[r],a||{}),{attributes:s={},decimalsCount:u,accessors:d,range:l,step:p}=o,m=l[0]>l[1]?2:.5,[f,h]=l.slice().sort(),v=()=>O(0,1e3).map((()=>N(f,h,m,u,p))).filter((t=>(!e||t<=e)&&(!n||t>=n))).slice(0,y||S(20,30)).map((t=>d?Object.assign({},...d.map((e=>({[e]:t}))),s):t));C=v(),[Pi,Di].includes(c)&&(L=v())}}const F=ua.filter((t=>"ISO"===a?t.iso:t.ioc)),{citiesCount:x,statesCount:k,postalCodesCount:_}=m||{},{cities:B}=km({count:x||P,participantsCount:P}),{states:j}=_m({count:k||P,participantsCount:P}),{postalCodes:V}=Bm({count:_||P,participantsCount:P}),G={cities:B,states:j,postalCodes:V},q=function(t){const n=Math.ceil(P/t);return e&&n>e?Math.ceil(P/e):t}(r),H=q?M(F).slice(0,r):o?F.filter((t=>o.includes(t.key))):F,W=M(O(0,Math.ceil(P/(q||1))).map((()=>H)).flat(1/0)),z=Lm({count:s}).teams;return{participants:O(0,s).map((t=>{const e=w?2:D?8:1,n=O(0,e).map((n=>function(t){const e=A[t],{nationalityCode:n,participantExtensions:r,participantTimeItems:o,extensions:s,firstName:c,birthDate:p,lastName:m,personId:f,sex:h}=e||{},v=c||"GivenName",I=m||"FamilyName",U=`${v} ${I}`,y=W[t],S=(null==T?void 0:T.length)&&n||y&&("ISO"===a?y.iso:y.ioc||y.iso)||n;null==W||!W.length||S||n||console.log("%c Invalid Nationality Code",{participantIndex:t,country:y});const w=Cm({...G,participantIndex:t,nationalityCode:S}),N=Wt({participantId:Zm({participantType:Ni,index:t,idPrefix:d,uuids:l}),extensions:r,timeItems:o,participantRole:Lu,participantType:Ni,participantName:U,person:{addresses:[w],personId:f||(null==u?void 0:u.length)&&u[t]||Yt(),standardFamilyName:I,standardGivenName:v,nationalityCode:S,extensions:s,birthDate:wt(p)?p:void 0,sex:h}});if(g&&S){const t=ua.find((({ioc:t})=>t===S));null!=t&&t.iso&&(N.person.isoNationalityCode=t.iso),null!=t&&t.label&&(N.person.countryName=t.label)}if(i){const e=R[t],n=b[t];Jm({scaleValue:e,eventType:gi,scaleType:kc,participant:N,category:i}),Jm({scaleValue:n,eventType:Jt,scaleType:kc,participant:N,category:i});const r=C[t],a=L[t];Jm({scaleValue:r,eventType:gi,scaleType:xc,participant:N,category:i}),Jm({scaleValue:a,eventType:Jt,scaleType:xc,participant:N,category:i})}return N}(t*e+n))),r=n.map((t=>t.participantId)),o=n.map((t=>t.person.standardFamilyName)).join("/"),s=w?Pi:Di,c={participantId:Zm({participantType:s,idPrefix:d,index:t,uuids:l}),participantRole:Lu,participantName:w?o:z[t],individualParticipantIds:r,participantType:s};return I&&(c.individualParticipants=n),w||D?[c,...n]:n})).flat()}}function Jm({scaleValue:t,participant:e,eventType:n,scaleType:i,category:r}){const a=r.categoryName||r.ratingType||r.ageCategoryCode,o={itemValue:t,itemType:[Fc,i,n,a].join(".")};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(o))}function Zm({idPrefix:t,participantType:e,index:n,uuids:i}){return t?`${t}-${e===Ni?"I":"P"}-${n}`:(null==i?void 0:i.pop())||Yt()}function Qm({alternatesCount:t=0,tieFormatName:e,tieFormat:n,drawSize:i}){var r,a;let o=0,s=0,c=0,u=0,d=0;null===(r=n="object"==typeof n?n:em({namedFormat:e}))||void 0===r||null===(a=r.collectionDefinitions)||void 0===a||a.filter(Boolean).forEach((t=>{const{category:e,collectionId:n,matchUpType:i,matchUpCount:r}=t;if(e&&(d+=1),n||(t.collectionId=Yt()),i===Jt){const t=r;u+=r,o=Math.max(o,t)}if(i===$t){const t=r;c+=r,s=Math.max(s,t)}}));const l=d?Math.max(c,2*u):Math.max(s,2*o);return{maxDoublesDraw:o*(i+t),maxSinglesDraw:s*(i+t),teamSize:l}}function Xm({participantsProfile:t={},tournamentRecord:e,eventProfiles:n,drawProfiles:i,startDate:r,uuids:a}){const{participantsCount:o,participantType:s,largestTeamDraw:c,largestTeamSize:u}=function({participantsProfile:t,eventProfiles:e,drawProfiles:n}){let{participantsCount:i,participantType:r=Ni}=t||{};const a=i||0;let o=0,s=0,c=0,u=0,d=0;const l=({alternatesCount:t=0,uniqueParticipants:e,tieFormatName:n,drawSize:i=0,eventType:r,tieFormat:a,category:l,gender:p,stage:m})=>{const f=r===Ui,h=r===yi;if(e||m===Gi||l||p)d+=f?2*(i+t):i+t;else{if(h){u=Math.max(u,i+t),a="object"==typeof a?a:em({namedFormat:n});const{teamSize:e,maxDoublesDraw:r,maxSinglesDraw:d}=Qm({alternatesCount:t,tieFormatName:n,tieFormat:a,drawSize:i});c=Math.max(c,e),o=Math.max(o,r),s=Math.max(s,d)}f&&i+t&&i+t>o&&(o=i+t),!f&&!h&&i&&i>s&&(s=i+t)}};if(null==e||e.forEach((t=>{const{tieFormatName:e,tieFormat:n,drawProfiles:i,eventType:r,category:a,gender:o}=t;if(i)for(const s of i){const{tieFormatName:t,tieFormat:i}=s;l({...s,tieFormatName:t||e,tieFormat:i||n,eventType:r,category:a,gender:o})}})),Array.isArray(n))for(const m of n)l(m);const p=Math.max(u*c,2*o,s);return o&&(r=Pi),(i||a)<p&&(i=p),i&&o&&[Pi,yi].includes(r)&&(s&&Math.floor(s/2)>o?i=Math.floor(s/2):(!s||2*o>=s)&&(i=Math.ceil(i/2))),void 0===i&&(i=null!=e&&e.length||null!=n&&n.length?0:32),i<a&&(i=a),{largestTeamDraw:u,largestTeamSize:c,participantsCount:i,participantType:r,uniqueParticipantsCount:d}}({participantsProfile:t,eventProfiles:n,drawProfiles:i}),{teamKey:d}=t||{},{participants:l}=$m({uuids:a,...t,consideredDate:r,participantsCount:o,participantType:s});let p=Nc({tournamentRecord:e,participants:l});if(!p.success)return p;if(d){const t=Lp({tournamentRecord:e,...d});if(t.error)return t}const m=l.filter((({participantType:t})=>t===Ni)).map(Oi);return Nc({tournamentRecord:e,participants:O(0,c).map((t=>{const e=m.slice(t*u,(t+1)*u);return{participantName:`Team ${t+1}`,participantRole:Lu,participantType:Di,participantId:Yt(),individualParticipantIds:e}}))})}function tf({participantsProfile:t={},uniqueParticipantsCount:e,ratingsParameters:n,tournamentRecord:i,eventProfile:r,eventIndex:a,event:o,uuids:s}){const{category:c,gender:u,eventType:d}=o,l=d===gi?Ni:d===Ui?Pi:d,p=(e[Vi]||0)+(e[Gi]||0),m=[Fp,xp].includes(u)?u:void 0,f=null!=t&&t.idPrefix?`E-${a}-${null==t?void 0:t.idPrefix}`:void 0,{participants:h}=$m({uuids:r.uuids||s,...t,scaledParticipantsCount:r.scaledParticipantsCount,consideredDate:null==i?void 0:i.startDate,rankingRange:r.rankingRange,participantType:l,participantsCount:p,ratingsParameters:n,idPrefix:f,category:c,sex:m});let v=Nc({participants:h,tournamentRecord:i});return v.error?v:{uniqueDrawParticipants:h.filter((({participantType:t})=>t===l)),uniqueParticipantIds:h.map(Oi)}}function ef({drawProfiles:t,category:e,gender:n}){const i={},r=null==t?void 0:t.reduce(((t,r)=>{const{qualifyingPositions:a=0,participantsCount:o=0,uniqueParticipants:s,stage:c=Vi,drawSize:u=0}=r||{};Object.keys(t).includes(c)||(t[c]=0);const d=(o||u)-a;return s||n||e||c===Gi?(Object.keys(i).includes(c)||(i[c]=0),i[c]+=d):t[c]=Math.max(d,t[c]),t}),{}),a=Object.keys(i);return a.forEach((t=>r[t]+=i[t])),{stageParticipantsCount:r,uniqueParticipantsCount:i,uniqueParticipantStages:a}}function nf({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:n,targetParticipants:i}){const r=e[Vi]||0,a=e[Gi]||0;return{stageParticipants:{QUALIFYING:i.filter((({participantType:t})=>t===n)).filter((({participantId:e})=>!t.includes(e))).slice(0,a),MAIN:i.filter((({participantType:t})=>t===n)).filter((({participantId:e})=>!t.includes(e))).slice(a,a+r)}}}function rf({autoEntryPositions:t,tournamentRecord:e,drawParticipants:n,drawProfile:i,event:r}){const{drawType:a=tr,qualifyingPositions:o=0,stage:s=Vi,drawSize:c=0,drawName:u,drawId:d}=i,l=c-o,p=n.slice(0,l).map(Oi);if(p.length){const n=Ol({participantIds:p,autoEntryPositions:t,tournamentRecord:e,stage:s,event:r});if(n.error)return n}const m=wm({drawName:u||a,qualifyingPositions:o,drawEntries:p.map((t=>({entryStatus:Cr,entryStage:s,participantId:t}))),drawId:d,event:r,stage:s});return m.error?m:{...B}}function af({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:n,tournamentRecord:i,drawProfiles:r,category:a,gender:o,event:s}){let c=0;for(const u of r){const{qualifyingPositions:r=0,uniqueParticipants:d,stage:l=Vi,drawSize:p=0}=u,m=p-r,f=d||o||a||l===Gi,h=f?t.slice(c,c+m):n[l||Vi]||[];f&&(c+=m);const v=rf({autoEntryPositions:e,drawParticipants:h,tournamentRecord:i,drawProfile:u,event:s});if(v.error)return v}return{...B}}function of({allUniqueParticipantIds:t,matchUpStatusProfile:e,participantsProfile:n,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:a,ratingsParameters:o,tournamentRecord:s,eventProfile:c,eventIndex:u,publish:d,uuids:l}){let p=c.gender,m=c.eventName;const{eventType:f=gi,policyDefinitions:h,drawProfiles:v=[],eventExtensions:I,surfaceCategory:g,tieFormatName:U,discipline:y,eventLevel:S,timeItems:w,ballType:N,category:D}=c,P=c.tieFormat||(f===yi?em({namedFormat:U}):void 0);let T=s.participants;for(const V of v)!p&&V.gender&&(p=null==V?void 0:V.gender);const{stageParticipantsCount:M,uniqueParticipantsCount:A,uniqueParticipantStages:E}=ef({drawProfiles:v,category:D,gender:p}),b=f===gi?Ni:f===Ui?Pi:f,{uniqueDrawParticipants:R=[],uniqueParticipantIds:C=[]}=E?tf({event:{eventType:f,category:D,gender:p},uniqueParticipantsCount:A,participantsProfile:n,ratingsParameters:o,tournamentRecord:s,eventProfile:c,eventIndex:u,uuids:l}):{};let{eventAttributes:O}=c;"object"!=typeof O&&(O={});const L=(null==D?void 0:D.categoryName)||(null==D?void 0:D.ageCategoryCode)||(null==D?void 0:D.ratingType),F=c.eventId||Yt();m=m||L||"Generated Event";const x={...O,surfaceCategory:g,discipline:y,eventLevel:S,eventName:m,eventType:f,tieFormat:P,ballType:N,category:D,eventId:F,gender:p};if(null!=I&&I.length&&Array.isArray(I)){const t=I.filter(Ir);null!=t&&t.length&&Object.assign(x,{extensions:t})}if(Array.isArray(w)&&w.forEach((t=>vo({event:_,timeItem:t}))),"object"==typeof h)for(const V of Object.keys(h))$u({policyDefinitions:{[V]:h[V]},event:x});x.category&&(x.category.categoryName=L);let k=nm({tournamentRecord:s,event:x});if(k.error)return k;const{event:_}=k,{stageParticipants:B}=nf({allUniqueParticipantIds:t,stageParticipantsCount:M,eventParticipantType:b,targetParticipants:T});if(k=af({uniqueDrawParticipants:R,autoEntryPositions:r,stageParticipants:B,tournamentRecord:s,drawProfiles:v,category:D,gender:p,event:_}),k.error)return k;if(k=Ym({completeAllMatchUps:i,matchUpStatusProfile:e,randomWinningSide:a,tournamentRecord:s,drawProfiles:v,event:_}),k.error)return k;const j=k.drawIds;return d&&Gp({tournamentRecord:s,event:_}),{drawIds:j,eventId:F,uniqueParticipantIds:C}}function sf({allUniqueParticipantIds:t=[],participantsProfile:e={},matchUpStatusProfile:n,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:a,ratingsParameters:o,tournamentRecord:s,drawProfile:c,startDate:u,drawIndex:d,goesTo:l,uuids:p}){var m;const{excessParticipantAlternates:f=!0,matchUpFormat:h=De,drawType:v=tr,tournamentAlternates:I=0,alternatesCount:g=0,qualifyingProfiles:U,generate:y=!0,eventExtensions:S,drawExtensions:w,completionGoal:N,drawSize:D=32,tieFormatName:P,seedsCount:T,timeItems:M,category:A,idPrefix:E,publish:b,gender:R,stage:C}=c,L=c.eventType||c.matchUpType||gi,x=L===Ui?Pi:Ni,k="object"==typeof c.tieFormat?c.tieFormat:L===Di?em({namedFormat:P}):void 0,_=(null==A?void 0:A.categoryName)||(null==A?void 0:A.ageCategoryCode)||(null==A?void 0:A.ratingType);let j=c.eventName||_||`Generated ${L}`,V=(null==s?void 0:s.participants)||[];const G=((null==U?void 0:U.reduce(((t,e)=>t+e.drawSize),0))||0)*(x===Ui?2:1),q=!c.participantsCount||c.participantsCount>D?D:c.participantsCount,H=Yt();let W={eventName:j,eventType:L,tieFormat:k,category:A,eventId:H};Array.isArray(M)&&M.forEach((t=>vo({event:W,timeItem:t})));let{eventAttributes:z}=c;if("object"!=typeof z&&(z={}),Object.assign(W,z),null!=S&&S.length&&Array.isArray(S)){const t=S.filter(Ir);null!=t&&t.length&&Object.assign(W,{extensions:t})}const K=[];if(G||c.uniqueParticipants||!s||R||A){let t,n=q+g+G;L===Di&&(({teamSize:t}=Qm({alternatesCount:g,tieFormatName:P,tieFormat:k,drawSize:D})),n=t*(D+G));const i=null!=e&&e.idPrefix?`D-${d}-${null==e?void 0:e.idPrefix}`:void 0,{participants:r}=$m({...e,scaledParticipantsCount:c.scaledParticipantsCount,participantsCount:n,consideredDate:null==s?void 0:s.startDate,sex:R||(null==e?void 0:e.sex),rankingRange:c.rankingRange,uuids:c.uuids||p,ratingsParameters:o,participantType:x,idPrefix:i,category:A});if(W.category&&(W.category.categoryName=_),s){const t=Nc({tournamentRecord:s,participants:r});if(t.error)return t}if(r.forEach((({participantId:t})=>K.push(t))),V=r,L===Di){const e=r.filter((({participantType:t})=>t===Ni)).map(Oi),n=O(0,D).map((n=>{const i=e.slice(n*t,(n+1)*t);return{participantName:`Team ${n+1}`,participantOtherName:`TM${n+1}`,participantRole:Lu,participantType:Di,participantId:Yt(),individualParticipantIds:i}})),i=Nc({participants:n,tournamentRecord:s});if(!i.success)return i;V=n}}const Y=t=>{const{participantType:e}=t;return L===gi&&e===Ni||L===Ui&&e===Pi||L===Di&&e===Di},$=t=>{var e,n;return!c.gender||(null===(e=t.person)||void 0===e?void 0:e.sex)===c.gender||!(null===(n=t.individualParticipantIds)||void 0===n||!n.some((t=>{const e=V.find((e=>e.participantId===t));return e&&$(e)})))||void 0},J=V.filter(Y).filter($).filter((({participantId:e})=>!t.includes(e))),Z=J.slice(0,q).map((t=>t.participantId));if(null!=Z&&Z.length){const t=Ol({autoEntryPositions:r,entryStage:C,tournamentRecord:s,participantIds:Z,event:W});if(t.error)return t}const Q=G?J.slice(q,q+G).map((t=>t.participantId)):0;if(null!=Q&&Q.length){let t=0,e=1;for(const n of U){const i=n.drawSize,a=Q.slice(t,t+i),o=Ol({entryStage:Gi,autoEntryPositions:r,tournamentRecord:s,participantIds:a,entryStageSequence:e,event:W});if(o.error)return o;t+=i,e+=1}}const X=f&&(null==s||null===(m=s.participants)||void 0===m?void 0:m.filter((({participantId:t})=>!Z.includes(t))).filter(Y).filter($).slice(0,g||D-q||I).map((t=>t.participantId)));if(null!=X&&X.length){const t=Ol({participantIds:X,autoEntryPositions:!1,entryStatus:Ar,tournamentRecord:s,event:W});if(t.error)return{error:t.error}}const tt=_||j;s&&T&&T<=Z.length&&O(1,T+1).forEach(((t,e)=>{let n={scaleValue:t,scaleName:tt,scaleType:"SEEDING",eventType:L,scaleDate:u};const i=Z[e];Pp({tournamentRecord:s,participantId:i,scaleItem:n})}));const{drawDefinition:et,error:nt}=fm({...c,tournamentRecord:s,seedingScaleName:tt,matchUpFormat:h,isMock:!0,eventId:H,goesTo:l,event:W});if(nt)return{error:nt};const it=y?et.drawId:void 0;if(Array.isArray(w)&&w.filter(Ir).forEach((t=>gr({element:et,extension:t}))),y){if(yc({drawDefinition:et,event:W}),v===Ji&&c.drawMatic){const t=c.roundsCount||1;for(const e of O(1,t+1)){const t=Sm({generateMatchUps:!0,tournamentRecord:s,drawDefinition:et,roundNumber:e});if(t.error)return t}}if(c.withPlayoffs){const t=et.structures[0].structureId,e=Xd({...c.withPlayoffs,tournamentRecord:s,drawDefinition:et,isMock:!0,structureId:t,idPrefix:E,event:W});if(null!=e&&e.error)return e}if(!1!==c.automated){if(i||N){const t=Wm({matchUpStatusProfile:n,completeAllMatchUps:i,randomWinningSide:a,tournamentRecord:s,completionGoal:N,drawDefinition:et,matchUpFormat:h,event:W});if(t.error)return t;const e=t.completedCount;if(v===ur){let t=im({structureId:et.structures.find((t=>t.stage===Vi)).structureId,tournamentRecord:s,drawDefinition:et,event:W});const r=N?N-e:void 0;if(t=Wm({completionGoal:N?r:void 0,matchUpStatusProfile:n,completeAllMatchUps:i,randomWinningSide:a,tournamentRecord:s,drawDefinition:et,matchUpFormat:h,event:W}),t.error)return t}}if(c.outcomes){const{matchUps:t}=Na({drawDefinition:et,inContext:!0,event:W});for(const e of c.outcomes){const{roundNumber:n,drawPositions:i,roundPosition:r,scoreString:a,winningSide:o,stage:s=Vi,matchUpFormat:c,stageSequence:u=1,matchUpStatus:d=re,matchUpStatusCodes:l,matchUpIndex:p=0,structureOrder:m}=e,f=t.reduce(((t,e)=>{const{structureId:n,matchUpId:i}=e;return t[n]?t[n].push(i):t[n]=[i],t}),{}),h=Object.assign({},...Object.keys(f).map(((t,e)=>({[t]:e+1})))),v=t.filter((t=>!(s&&t.stage!==s||u&&t.stageSequence!==u||n&&t.roundNumber!==n||r&&t.roundPosition!==r||m&&h[t.structureId]!==m||i&&2!==F(i,t.drawPositions).length)))[p],I=zm({matchUpStatusCodes:l,drawDefinition:et,targetMatchUp:v,matchUpFormat:c,matchUpStatus:d,scoreString:a,winningSide:o,drawId:it});if(null!=I&&I.error)return I}}}b&&Gp({tournamentRecord:s,event:W})}return{...B,event:Wt(W),uniqueParticipantIds:K,targetParticipants:V,drawDefinition:et,eventId:H,drawId:it}}function cf({tournamentRecord:t,venueProfiles:e}){const{startDate:n,endDate:i}=t;let r=[];for(const[a,o]of e.entries()){let{venueAbbreviation:e,venueId:s=Yt(),dateAvailability:c,startTime:u="07:00",endTime:d="19:00",courtTimings:l,courtsCount:p,courtNames:m,venueName:f,courtIds:h}=o,v=Sc({tournamentRecord:t,venue:{venueName:f||`Venue ${a+1}`,venueAbbreviation:e,venueId:s}});if(v.error)return v;r.push(s);const I=Mt(n,i);if(c=!Array.isArray(c)&&I.map((t=>({date:Dt(t),startTime:u,endTime:d})))||c,v=vc({tournamentRecord:t,dateAvailability:c,courtTimings:l,courtsCount:p,courtNames:m,startTime:u,courtIds:h,endTime:d,venueId:s,dates:I}),v.error)return v}return r}const uf={anonymizeTournamentRecord:function({tournamentRecord:t,tournamentName:e,personIds:n=[],tournamentId:i}){if(!t)return{error:G};t.tournamentId=i||Yt(),t.createdAt=(new Date).toISOString(),t.tournamentName=e||`Anonymized Tournament ${Dt(new Date)}`,delete t.parentOrganisation;const r=t.startDate||Dt(new Date),a=(t.participants||[]).filter((({participantType:t})=>t===Ni)),o=a.reduce(((t,e)=>{var n;const i=null===(n=e.person)||void 0===n?void 0:n.sex;return[Fp,xp].includes(i)?t[i]+=1:t.OTHER+=1,t}),{[Fp]:0,[xp]:0,OTHER:0}),s=Object.assign({},...Object.keys(o).map((t=>{var e;return{[t]:(null===(e=Rm({category:{ageCategoryCode:"O18"},count:o[t],addressProps:{citiesCount:10},personExtensions:[],consideredDate:r,sex:t}))||void 0===e?void 0:e.persons)||[]}}))),c={[Fp]:0,[xp]:0,OTHER:0},u=a.length,d=a.reduce(((t,e)=>{var n,i;const r=(null===(n=e.person)||void 0===n||null===(i=n.addresses)||void 0===i?void 0:i[0])||{},{city:a,state:o,postalCode:s}=r;return t.cities.includes(a)||t.cities.push(a),t.states.includes(o)||t.states.push(o),t.postalCodes.includes(s)||t.postalCodes.push(s),t}),{cities:[],postalCodes:[],states:[]}),l=d.postalCodes.length,p=d.cities.length,m=d.states.length,{cities:f}=km({count:p||u,participantsCount:u}),{states:h}=_m({count:m||u,participantsCount:u}),{postalCodes:v}=Bm({count:l||u,participantsCount:u}),I={cities:f,states:h,postalCodes:v};a.forEach(((t,e)=>{var i;const r=null==t?void 0:t.person,a=(null==r?void 0:r.sex)||"OTHER",o=null==r||null===(i=r.birthDate)||void 0===i?void 0:i.split("-").reverse()[0],u=c[a],d=s[a][u];if(c[a]+=1,o){var l;const[,t,e]=(null==d||null===(l=d.birthDate)||void 0===l?void 0:l.split("-"))||[],n=[o,t,e].join("-");d.birthDate=n}if(r.addresses){const t=Cm({...I,participantIndex:e,nationalityCode:d.nationalityCode});d.addresses=[t]}d.personId=(null==n?void 0:n[e])||Yt(),d.standardFamilyName=d.lastName,d.standardGivenName=d.firstName,delete d.firstName,delete d.lastName,t.person=d,t.participantName=`${d.standardGivenName} ${d.standardFamilyName}`})),(t.participants||[]).filter((({participantType:t})=>t===Pi)).forEach((t=>{const{individualParticipantIds:e}=t;t.participantName=function({individualParticipantIds:t,individualParticipants:e}){let n=e.filter((({participantId:e})=>t.includes(e))).map((({person:t})=>null==t?void 0:t.standardFamilyName)).filter(Boolean).sort().join("/");return 1===t.length&&(n+="/Unknown"),n}({individualParticipantIds:e,individualParticipants:a})}));const g=(t.participants||[]).filter((({participantType:t})=>t===Di)),U=Lm({count:g.length}).teams;return g.forEach(((t,e)=>{t.participantName=U[e]})),{...B}},modifyTournamentRecord:function({ratingsParameters:t=Sp,participantsProfile:e={},matchUpStatusProfile:n,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:a,schedulingProfile:o,tournamentRecord:s,eventProfiles:c,venueProfiles:u,autoSchedule:d,drawProfiles:l,goesTo:p,uuids:m}){var f;if(!s)return{error:G};const h=[],v=[],I=[];null==c||c.forEach((t=>{const e=s.events.find(((e,n)=>void 0!==t.eventIndex&&n===t.eventIndex||t.eventName&&e.eventName===t.eventName||t.eventId&&e.eventId===t.eventId));null!=e&&e.gender&&(t.gender=e.gender)}));const g=(null===(f=s.participants)||void 0===f?void 0:f.length)||void 0;g&&null!=e&&e.idPrefix&&(e.idPrefix=`${e.idPrefix}-${g}`);const U=Xm({startDate:s.startDate,participantsProfile:e,tournamentRecord:s,eventProfiles:c,drawProfiles:l,uuids:m});if(!U.success)return U;if(c){var y;let t=(null===(y=s.events)||void 0===y?void 0:y.length)||0;for(const o of c){let{ratingsParameters:c}=o;const u=s.events.find(((t,e)=>void 0!==o.eventIndex&&e===o.eventIndex||o.eventName&&t.eventName===o.eventName||o.eventId&&t.eventId===o.eventId));if(u){const{gender:t,category:d,eventType:l}=u,{drawProfiles:p,publish:f}=o,v=l===gi?Ac:l===Ui?Ec:l;if(p){const{stageParticipantsCount:f,uniqueParticipantsCount:g,uniqueParticipantStages:U}=ef({drawProfiles:p,category:d,gender:t}),{uniqueDrawParticipants:y=[],uniqueParticipantIds:S=[]}=U?tf({event:{eventType:l,category:d,gender:t},uniqueParticipantsCount:g,participantsProfile:e,ratingsParameters:c,tournamentRecord:s,eventProfile:o,uuids:m}):{};h.push(...S);const{stageParticipants:w}=nf({targetParticipants:s.participants||[],allUniqueParticipantIds:h,stageParticipantsCount:f,eventParticipantType:v});let N=af({uniqueDrawParticipants:y,autoEntryPositions:r,stageParticipants:w,tournamentRecord:s,drawProfiles:p,category:d,gender:t,event:u});if(N.error)return N;if(N=Ym({matchUpStatusProfile:n,completeAllMatchUps:i,randomWinningSide:a,tournamentRecord:s,drawProfiles:p,event:u}),N.error)return N;I.push(...N.drawIds)}f&&Gp({tournamentRecord:s,event:u})}else{const{error:u,eventId:d,drawIds:l,uniqueParticipantIds:p}=of({startDate:s.startDate,allUniqueParticipantIds:h,matchUpStatusProfile:n,participantsProfile:e,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:a,ratingsParameters:c,tournamentRecord:s,eventProfile:o,eventIndex:t,uuids:m});if(u)return{error:u};l&&I.push(...l),v.push(d),null!=p&&p.length&&h.push(...p),t+=1}}}if(l){let o=(s.events||[]).map((t=>{var e;return(null===(e=t.drawDefinitions)||void 0===e?void 0:e.map((()=>1)))||[]})).flat().reduce(((t,e)=>t+e),0);for(const c of l){const{drawId:u,eventId:d,event:l,error:f,uniqueParticipantIds:g}=sf({startDate:s.startDate,allUniqueParticipantIds:h,matchUpStatusProfile:n,participantsProfile:e,completeAllMatchUps:i,autoEntryPositions:r,randomWinningSide:a,ratingsParameters:t,tournamentRecord:s,drawProfile:c,drawIndex:o,goesTo:p,uuids:m});if(f)return{error:f};const U=nm({tournamentRecord:s,event:l});if(U.error)return U;u&&I.push(u),v.push(d),null!=g&&g.length&&h.push(...g),o+=1}}const S=null!=u&&u.length?cf({tournamentRecord:s,venueProfiles:u}):[];let w,N={};if(o){const t=Mu({schedulingProfile:o,tournamentRecord:s});if(t.error)return t;if(w=t.scheduledRounds,d){const{tournamentId:t}=s;N=Au({tournamentRecords:{[t]:s}})}}return{...B,drawIds:I,eventIds:v,venueIds:S,scheduledRounds:w,schedulerResult:N}}},df={generateOutcomeFromScoreString:Vm,generateTournamentRecord:function({scheduleCompletedMatchUps:t,ratingsParameters:e=Sp,tournamentName:n="Mock Tournament",tournamentExtensions:i,tournamentAttributes:r,matchUpStatusProfile:a,participantsProfile:o,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,policyDefinitions:d,schedulingProfile:l,eventProfiles:p,venueProfiles:m,drawProfiles:f,autoSchedule:h,startDate:v,endDate:I,goesTo:g,uuids:U}={}){if(v&&!wt(v)||I&&!wt(I))return{error:K};if(p&&!Array.isArray(p))return{error:$};if(!v){const t=new Date;v=Dt(I||t),I=Dt(t.setDate(t.getDate()+7))}if(!I){const t=new Date(v);I=Dt(t.setDate(t.getDate()+7))}"object"!=typeof r&&(r={});const y=Ep({...r,tournamentName:n,startDate:v,endDate:I});if(null!=i&&i.length&&Array.isArray(i)){const t=i.filter(Ir);null!=t&&t.length&&Object.assign(y,{extensions:t,isMock:!0})}if("object"==typeof d)for(const T of Object.keys(d))Yu({policyDefinitions:{[T]:d[T]},tournamentRecord:y});const S=Xm({participantsProfile:o,tournamentRecord:y,eventProfiles:p,drawProfiles:f,startDate:v,uuids:U});if(!S.success)return S;const w=[],N=[],D=[];if(Array.isArray(f)){let t=0;for(const n of f){const{drawId:i,eventId:r,event:d,error:l,uniqueParticipantIds:p}=sf({allUniqueParticipantIds:D,matchUpStatusProfile:a,participantsProfile:o,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,ratingsParameters:e,tournamentRecord:y,drawProfile:n,startDate:v,drawIndex:t,goesTo:g,uuids:U});if(l)return{error:l};const m=nm({tournamentRecord:y,event:d});if(m.error)return m;i&&w.push(i),N.push(r),null!=p&&p.length&&D.push(...p),t+=1}}if(p){let t=0;for(const n of p){const{error:i,eventId:r,drawIds:d,uniqueParticipantIds:l}=of({allUniqueParticipantIds:D,matchUpStatusProfile:a,participantsProfile:o,completeAllMatchUps:s,autoEntryPositions:c,randomWinningSide:u,ratingsParameters:e,tournamentRecord:y,eventProfile:n,eventIndex:t,startDate:v,uuids:U});if(i)return{error:i};d&&w.push(...d),N.push(r),null!=l&&l.length&&D.push(...l),t+=1}}const P=null!=m&&m.length?cf({tournamentRecord:y,venueProfiles:m,uuids:U}):[];let M,A={};if(l){const e=function({schedulingProfile:t,tournamentRecord:e}){if("object"!=typeof t)return{error:$};const n=Ls({tournamentRecord:e}).containedStructures,{matchUps:i}=wa({tournamentRecord:e}),{tournamentId:r}=e,a=[];for(const o of t){const{scheduleDate:t,venues:s=[]}=o;for(const o of s){const{rounds:s,venueId:c}=o;for(const o of s){const{drawId:s,winnerFinishingPositionRange:u,roundSegment:d}=o,l=i.filter((t=>{var e;const n=(null==u?void 0:u.indexOf("-"))>0&&u.split("-").map((t=>+t)),i=null===(e=t.finishingPositionRange)||void 0===e?void 0:e.winner;return!(t.drawId!==s||o.roundNumber&&t.roundNumber!==o.roundNumber||i&&n&&2!==F(i,n).length&&(T(i).length!==T(n).length||F(i,n).length!==T(i).length))}))[0];if(l){const{eventId:i,roundNumber:o,drawName:p,structureName:m,roundName:f}=l;let h=l.structureId;o&&!u&&(h=Object.keys(n).find((t=>n[t].includes(h)))||h);const v={tournamentId:r,structureId:h,roundNumber:o,roundSegment:d,eventId:i,drawId:s};let I=$o({tournamentRecords:{[r]:e},round:v,scheduleDate:t,venueId:c});if(I.error)return I;a.push({structureName:m,roundName:f,drawName:p,...v})}}}}return{scheduledRounds:a}}({schedulingProfile:l,tournamentRecord:y});if(e.error)return e;if(M=e.scheduledRounds,h){const{tournamentId:e}=y;A=Au({scheduleCompletedMatchUps:t,tournamentRecords:{[e]:y}})}}return Wt({tournamentRecord:y,scheduledRounds:M,schedulerResult:A,eventIds:N,venueIds:P,drawIds:w})},generateEventWithDraw:sf,generateParticipants:$m,parseScoreString:jm,generateOutcome:qm,credits:Zu};let lf=!1;const pf=function(){const t={version:()=>"0.117.10",setDeepCopy:(e,n)=>(rt(e,n),t),devContext:e=>(nt(e),lf=!0,t)};return[uf,df].forEach((e=>{Object.keys(e).forEach((n=>{t[n]=t=>{try{return function(t,e){const n=t({...e});return null!=n&&n.error||Qc(),st(),lf&&(nt(!1),lf=!1),n}(e[n],t)}catch(e){const r=e.toString();console.log("ERROR",{error:r,method:n,params:JSON.stringify(t)}),console.log(e)}}}))})),t}(),mf={activeMatchUpStatuses:Ue,auditConstants:{DELETE_EVENTS:"deleteEvents",DELETE_DRAW_DEFINITIONS:"deleteDrawDefinitions"},directingMatchUpStatuses:ve,drawDefinitionConstants:mr,entryStatusConstants:qr,errorConditionConstants:Z,eventConstants:Si,extensionConstants:Tn,flightConstants:{SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:"splitWaterfall",SPLIT_SHUTTLE:"splitShuttle"},genderConstants:kp,keyValueConstants:cn,matchUpActionConstants:{END:"END",NICKNAME:"NICKNAME",PENALTY:"PENALTY",REFEREE:"REFEREE",SCHEDULE:"SCHEDULE",SCORE:"SCORE",START:"START",STATUS:"STATUS"},matchUpStatusConstants:Se,matchUpTypes:Qt,nonDirectingMatchUpStatuses:Ie,participantConstants:Oc,participantRoles:Fu,particicipantsRequiredMatchUpStatuses:fe,participantTypes:Mi,penaltyConstants:{COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},policyConstants:{POLICY_TYPE_ROUND_ROBIN_TALLY:"roundRobinTally",POLICY_TYPE_POSITION_ACTIONS:"positionActions",POLICY_TYPE_RANKING_POINTS:"rankingPoints",POLICY_TYPE_ROUND_NAMING:"roundNaming",POLICY_TYPE_PARTICIPANT:"participant",POLICY_TYPE_SCHEDULING:"scheduling",POLICY_TYPE_AVOIDANCE:"avoidance",POLICY_TYPE_SEEDING:"seeding",POLICY_TYPE_SCORING:"scoring",POLICY_TYPE_DRAWS:"draws"},positionActionConstants:{ALTERNATE_PARTICIPANT:"ALTERNATE",WITHDRAW_PARTICIPANT:"WITHDRAW",ASSIGN_PARTICIPANT:"ASSIGN",LUCKY_PARTICIPANT:"LUCKY",REMOVE_ASSIGNMENT:"REMOVE",SWAP_PARTICIPANTS:"SWAP",ADD_NICKNAME:"NICKNAME",ADD_PENALTY:"PENALTY",ASSIGN_BYE:"BYE",SEED_VALUE:"SEED_VALUE"},ratingConstants:yp,recoveryTimeRequiredMatchUpStatuses:me,requestConstants:{DO_NOT_SCHEDULE:"DO_NOT_SCHEDULE"},resultConstants:j,scaleConstants:_c,scheduleConstants:Bn,surfaceConstants:{CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},tieFormatConstants:{COLLEGE_D3:"COLLEGE_D3",COLLEGE_DEFAULT:"COLLEGE_DEFAULT",COLLEGE_JUCO:"COLLEGE_JUCO",DOMINANT_DUO:"DOMINANT_DUO",DOMINANT_DUO_MIXED:"DOMINANT_DUO_MIXED",LAVER_CUP:"LAVER_CUP",TEAM_DOUBLES_3_AGGREGATION:"TEAM_DOUBLES_3_AGGREGATION",USTA_BREWER_CUP:"USTA_BREWER_CUP",USTA_COLLEGE:"USTA_COLLEGE",USTA_GOLD_TEAM_CHALLENGE:"USTA_GOLD_TEAM_CHALLENGE",USTA_INTERSECTIONAL:"USTA_INTERSECTIONAL",USTA_LEVEL_1:"USTA_LEVEL_1",USTA_SOUTHERN_LEVEL_5:"USTA_SOUTHERN_LEVEL_5",USTA_WTT:"USTA_WTT",USTA_ZONAL:"USTA_ZONAL"},timeItemConstants:di,topicConstants:{ADD_DRAW_DEFINITION:"addDrawDefinition",ADD_MATCHUPS:"addMatchUps",ADD_PARTICIPANTS:"addParticipants",ADD_VENUE:"addVenue",AUDIT:"audit",DELETED_DRAW_IDS:"deletedDrawIds",DELETE_PARTICIPANTS:"deleteParticipants",DELETE_VENUE:"deleteVenue",DELETED_MATCHUP_IDS:"deletedMatchUpIds",MODIFY_DRAW_DEFINITION:"modifyDrawDefinition",MODIFY_MATCHUP:"modifyMatchUp",MODIFY_PARTICIPANTS:"modifyParticipants",MODIFY_VENUE:"modifyVenue",PUBLISH_EVENT:"publishEvent",UNPUBLISH_EVENT:"unPublishEvent",PUBLISH_EVENT_SEEDING:"publishEventSeeding",UNPUBLISH_EVENT_SEEDING:"unPublishEventSeeding"},upcomingMatchUpStatuses:ye,validMatchUpStatuses:he,venueConstants:{INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"}};var ff={chunkArray:k,countValues:function(t){return e=A(t),Object.keys(e).reduce(((t,n)=>{const i=e[n];return t[i]?t[i].push(n):t[i]=[n],t}),{});var e},dateRange:Mt,dateTime:qt,garman:so,generateHashCode:function(t){if(null===t||"object"!=typeof t)return;const e=JSON.stringify(t),n=zt(t),i=e.split("").reduce(((t,e)=>t+e.charCodeAt(0)),0);return[e.length,n,i].map((t=>t.toString(36))).join("")},generateRange:O,generateTimeCode:P,instanceCount:A,intersection:F,isNumeric:U,isPowerOf2:I,JSON2CSV:function(t,e){if(e&&"object"!=typeof e)return $;const{includeTransoformAccessors:n,columnAccessors:i=[],columnTransform:r={},columnMap:a={},valuesMap:o={},context:s={},delimiter:c='"',columnJoiner:u=",",rowJoiner:d="\r\n",keyJoiner:l="."}=e||{};if(!Array.isArray(t)||!Array.isArray(i)||"object"!=typeof s||"object"!=typeof a||"object"!=typeof r||"object"!=typeof o||"string"!=typeof u||"string"!=typeof d||"string"!=typeof l||"string"!=typeof c)return $;const p=t.filter(Boolean).map((t=>uo(t,l))),m=Object.values(r).flat();n&&i.push(...m);const f=p.reduce(((t,e)=>Object.keys(e).every((e=>!t.includes(e)&&t.push(e)||!0))&&t),[]).filter((t=>!(null!=i&&i.length)||i.includes(t))),h=Object.assign({},...Object.keys(r).map((t=>r[t].map((e=>({[e]:t}))).flat())).flat()),v=f.reduce(((t,e)=>{const n=h[e];return n?t.includes(n)||t.push(n):t.push(e),t}),[]);Object.keys(a).forEach((t=>!v.includes(t)&&v.unshift(t))),Object.keys(r).forEach((t=>!v.includes(t)&&v.unshift(t))),"object"==typeof s&&Object.keys(s).forEach((t=>!v.includes(t)&&v.unshift(t)));const I=v.map((t=>a[t]||t)),g=t=>`${c}${t}${c}`,U=p.map((t=>Object.values(v.reduce(((e,n)=>{var i;const a=r[n],c=(null!=a&&a.length?t[a.find((e=>t[e]))]:t[n])||(null==s?void 0:s[n])||"",u=(null===(i=o[n])||void 0===i?void 0:i[c])||c;return e[n]=g(u),e}),{})).join(u)));return[I.map(g).join(u),...U].join(d)},makeDeepCopy:Ht,nearestPowerOf2:g,numericSort:Kt,overlap:x,parseAgeCategoryCode:co,randomMember:C,randomPop:R,shuffleArray:M,unique:T,UUID:Yt,UUIDS:function(t=1){return O(0,t).map(Yt)}}}}]);