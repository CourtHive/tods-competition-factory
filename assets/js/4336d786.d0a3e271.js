"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[514],{8738(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"engines/state-engines","title":"State Engines","description":"Competition Factory engines share a state which contains one or more tournamentRecords and any factory functions which have been imported from Governors.","source":"@site/docs/engines/state-engines.mdx","sourceDirName":"engines","slug":"/engines/state-engines","permalink":"/competition-factory/docs/engines/state-engines","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"State Engines"},"sidebar":"docs","previous":{"title":"Publishing","permalink":"/competition-factory/docs/concepts/publishing"},"next":{"title":"Engine Methods","permalink":"/competition-factory/docs/engines/engine-methods"}}');var s=t(6070),o=t(8322);const r={title:"State Engines"},a=void 0,c={},d=[{value:"Engine state",id:"engine-state",level:2},{value:"Invoking Factory Functions",id:"invoking-factory-functions",level:2},{value:"Examples",id:"examples",level:2},{value:"Execute",id:"execute",level:3},{value:"Import and Execute",id:"import-and-execute",level:3},{value:"Import and Execute by Name",id:"import-and-execute-by-name",level:3},{value:"Execution Queue",id:"execution-queue",level:3},{value:"devContext",id:"devcontext",level:2},{value:"Bypassing State",id:"bypassing-state",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Competition Factory"})," engines share a state which contains one or more ",(0,s.jsx)(n.code,{children:"tournamentRecords"})," and any factory functions which have been imported from ",(0,s.jsx)(n.a,{href:"/docs/governors/governors-overview",children:"Governors"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["All factory engines provide logging and middleware services which resolve parameters such as ",(0,s.jsx)(n.code,{children:"events"})," and ",(0,s.jsx)(n.code,{children:"drawDefinitions"})," from identifiers.\nMutation engines provide subscription/notification functionality."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"askEngine"}),": used to ",(0,s.jsx)(n.em,{children:"synchronously"})," query ",(0,s.jsx)(n.code,{children:"tournamentRecords"})," held in state."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"syncEngine"}),": used to ",(0,s.jsx)(n.em,{children:"synchronously"})," mutate ",(0,s.jsx)(n.code,{children:"tournamentRecords"})," held in state."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"asyncEngine"}),": used to ",(0,s.jsx)(n.em,{children:"asynchronously"})," mutate ",(0,s.jsx)(n.code,{children:"tournamentRecords"})," held in state."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["All engine methods which make a mutation return either ",(0,s.jsx)(n.code,{children:"{ success: true }"})," or ",(0,s.jsx)(n.code,{children:"{ error }"})]})}),"\n",(0,s.jsx)(n.h2,{id:"engine-state",children:"Engine state"}),"\n",(0,s.jsxs)(n.p,{children:['By default, a "deep copy" of ',(0,s.jsx)(n.code,{children:"tournamentRecords"})," is made as they are loaded into shared state."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"engine.setState(tournamentRecord)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"engine.setState(tournamentRecords)"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This behavior can be overridden such that engines operate directly on loaded tournamentRecords."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"engine.setState(tournamentRecord, deepCopyOptions)"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"deepCopyOptions"})," can be either a boolean or an object which configures the behavior of the deep copy."]}),"\n",(0,s.jsx)(n.h2,{id:"invoking-factory-functions",children:"Invoking Factory Functions"}),"\n",(0,s.jsx)(n.p,{children:"All state engines can be used to invoke factory functions in multiple ways:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"execute"}),": invoke a factory function directly, parameters passed into ",(0,s.jsx)(n.code,{children:"execute"})," method"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"import and execute"}),": invoke an imported function as an engine attribute"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"import and execute by name"}),": invoke an imported function by reference"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Mutation engines can submit a queue of functions to be executed in sequence."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"executionQueue"}),": invoke an imported function as part of a queue of functions"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,s.jsxs)(n.p,{children:["For each of the following examples ",(0,s.jsx)(n.code,{children:"askEngine"})," and the ",(0,s.jsx)(n.code,{children:"getParticipants"})," method are first imported from the factory."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"import { askEngine, participantGovernor: { getParticipants } } from 'tods-competition-factory';\n\n// load a tournamentRecord into state\naskEngine.setState(tournamentRecord);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"execute",children:"Execute"}),"\n",(0,s.jsxs)(n.p,{children:["Function is invoked directly, parameters passed into ",(0,s.jsx)(n.code,{children:"execute"})," method."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const { participants } = askEngine.execute({ getParticipants, ...params });\n"})}),"\n",(0,s.jsx)(n.h3,{id:"import-and-execute",children:"Import and Execute"}),"\n",(0,s.jsx)(n.p,{children:"Function is imported and invoked as an engine attribute."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"askEngine.importMethods({ getParticipants });\nconst { participants } = askEngine.getParticipants({ withIndividualParticipants: true });\n"})}),"\n",(0,s.jsx)(n.h3,{id:"import-and-execute-by-name",children:"Import and Execute by Name"}),"\n",(0,s.jsx)(n.p,{children:"Function is imported and invoked by reference."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"askEngine.importMethods({ getParticipants });\nconst { participants } = askEngine.execute({\n  params: { participantFilters: { participantTypes: [PAIR] } },\n  method: 'getParticipants',\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"execution-queue",children:"Execution Queue"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"executionQueue"})," method accepts an array of imported governor methods and associated parameters,\nallowing for multiple queries or mutations in a single API call, which is significant if a client is making a\nrequest of a server and the server needs to prepare context by loading a tournament record."]}),"\n",(0,s.jsxs)(n.p,{children:["An additional benefit of the ",(0,s.jsx)(n.code,{children:"executionQueue"})," is that subscribers to ",(0,s.jsx)(n.code,{children:"engine"})," events are not notified\nuntil all methods in the queue have completed successfully, and a failure of any one method can be used to roll back state\nwith the assurance that there are no side-effects caused by subscribers responding to notifications. This also means\nthat the server context can not be blocked by any long-running external processes."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"syncEngine.importMethods({ getParticipants });\nconst result = syncEngine.executionQueue([\n  { method: 'getParticipants', params: { participantFilters: { participantTypes: [INDIVIDUAL] } } },\n]);\nconst { participants } = result[0];\n"})}),"\n",(0,s.jsx)(n.h2,{id:"devcontext",children:"devContext"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"devConext"})," is a property of engine state which is used to store any data which is useful for development purposes."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The devContext value can be either a boolean or an object."}),"\n",(0,s.jsxs)(n.li,{children:["When there is a devContext value present, the ",(0,s.jsx)(n.code,{children:"try {} catch {}"})," block is ",(0,s.jsx)(n.strong,{children:"NOT"})," used in method invocation."]}),"\n",(0,s.jsx)(n.li,{children:"When devContext is an object it is used to configure engine logging."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"askEngine.devContext(true); // default\naskEngine.devContext(false); // do not catch internal errors\n"})}),"\n",(0,s.jsx)(n.h2,{id:"bypassing-state",children:"Bypassing State"}),"\n",(0,s.jsxs)(n.p,{children:["Passing ",(0,s.jsx)(n.code,{children:"tournamentRecord"})," as a parameter to any engine method will operate directly on the passed ",(0,s.jsx)(n.code,{children:"tournamentRecord"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"askEngine.getParticipants({ tournamentRecord });\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"tournamentRecord"})," is passed as a parameter, a temporary ",(0,s.jsx)(n.code,{children:"tournamentRecords"})," object is created and any ",(0,s.jsx)(n.code,{children:"tournamentRecords"})," in state are not referenced."]})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8322(e,n,t){t.d(n,{R:()=>r,x:()=>a});var i=t(758);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);