"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[3979],{2505(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"tmx/factory-server","title":"Competition Factory Server","description":"The Competition Factory Server is a Node.js server that provides multi-user tournament management with data persistence. It demonstrates the execution queue pattern and efficient client-server synchronization for factory-based applications.","source":"@site/docs/tmx/factory-server.md","sourceDirName":"tmx","slug":"/tmx/factory-server","permalink":"/competition-factory/docs/tmx/factory-server","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Competition Factory Server","sidebar_position":8},"sidebar":"docs","previous":{"title":"Browser Console (dev object)","permalink":"/competition-factory/docs/tmx/browser-console"},"next":{"title":"Installation","permalink":"/competition-factory/docs/installation"}}');var s=t(6070),i=t(8322);const o={title:"Competition Factory Server",sidebar_position:8},a="Competition Factory Server Architecture",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Local-First Design",id:"local-first-design",level:3},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Execution Queue Pattern",id:"execution-queue-pattern",level:3},{value:"Query vs Mutation Separation",id:"query-vs-mutation-separation",level:3},{value:"Master/Slave Modes",id:"masterslave-modes",level:3},{value:"Master Mode (Default)",id:"master-mode-default",level:4},{value:"Slave Mode",id:"slave-mode",level:4},{value:"Offline/Online Transitions",id:"offlineonline-transitions",level:3},{value:"Implementation Details",id:"implementation-details",level:2},{value:"Client-Side Queue",id:"client-side-queue",level:3},{value:"Server-Side Processing",id:"server-side-processing",level:3},{value:"Conflict Resolution",id:"conflict-resolution",level:3},{value:"Server Configuration",id:"server-configuration",level:2},{value:"Basic Server Setup",id:"basic-server-setup",level:3},{value:"WebSocket Support",id:"websocket-support",level:3},{value:"Data Persistence",id:"data-persistence",level:2},{value:"File System Storage",id:"file-system-storage",level:3},{value:"Database Storage",id:"database-storage",level:3},{value:"Execution History",id:"execution-history",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Performance",id:"performance",level:3},{value:"Reliability",id:"reliability",level:3},{value:"Security",id:"security",level:3},{value:"Scalability",id:"scalability",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Production Considerations",id:"production-considerations",level:3},{value:"Related Documentation",id:"related-documentation",level:2},{value:"Example Implementation",id:"example-implementation",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"competition-factory-server-architecture",children:"Competition Factory Server Architecture"})}),"\n",(0,s.jsx)(n.p,{children:"The Competition Factory Server is a Node.js server that provides multi-user tournament management with data persistence. It demonstrates the execution queue pattern and efficient client-server synchronization for factory-based applications."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"The factory server is optional. TMX works fully offline as a browser-only application. The server enables multi-user collaboration, data persistence, publishing, subscriptions and backup."})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The factory server provides:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multi-User Support"})," - Multiple TMX instances sharing tournament data"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Data Persistence"})," - Tournament records saved to storage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Execution Queue"})," - Efficient mutation synchronization"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Conflict Resolution"})," - Handles concurrent modifications"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Master/Slave Modes"})," - Flexible ownership models"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Offline Capability"})," - Reconnection and sync after disconnect"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Factory Instance"})," - Server-side factory for validation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Change History"})," - Audit trail of all modifications"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.h3,{id:"local-first-design",children:"Local-First Design"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  TMX Client (Browser)                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 UI Layer           \u2502   \u2502 Local Tournament   \u2502    \u2502\n\u2502  \u2502 (React)            \u2502\u2500\u2500\u25b6\u2502 Record (State)     \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502           \u2502                         \u25b2               \u2502\n\u2502           \u2502                         \u2502               \u2502\n\u2502           \u25bc                         \u2502               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 Competition Factory (Browser Instance)      \u2502    \u2502\n\u2502  \u2502                                             \u2502    \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502    \u2502\n\u2502  \u2502  \u2502 QUERIES     \u2502  \u2502 MUTATIONS          \u2502    \u2502    \u2502\n\u2502  \u2502  \u2502 (local)     \u2502  \u2502 (queued to server) \u2502    \u2502    \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                          \u2502                          \u2502\n\u2502                          \u2502 Execution Queue          \u2502\n\u2502                          \u25bc                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 WebSocket / HTTP                            \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u2502 Only mutations sent\n                          \u2502\n                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Competition Factory Server                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 WebSocket / HTTP Handler                    \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                          \u2502                          \u2502\n\u2502                          \u25bc                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 Execution Queue Processor                   \u2502    \u2502\n\u2502  \u2502 - Receives method calls with parameters     \u2502    \u2502\n\u2502  \u2502 - Executes on server factory instance       \u2502    \u2502\n\u2502  \u2502 - Validates and applies changes             \u2502    \u2502\n\u2502  \u2502 - Returns results                           \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                          \u2502                          \u2502\n\u2502                          \u25bc                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 Competition Factory (Server Instance)       \u2502    \u2502\n\u2502  \u2502 - Maintains server-side tournament record   \u2502    \u2502\n\u2502  \u2502 - Validates all operations                  \u2502    \u2502\n\u2502  \u2502 - Ensures data integrity                    \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                          \u2502                          \u2502\n\u2502                          \u25bc                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502 Data Storage                                \u2502    \u2502\n\u2502  \u2502 - Tournament records (JSON)                 \u2502    \u2502\n\u2502  \u2502 - Execution history                         \u2502    \u2502\n\u2502  \u2502 - User sessions                             \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,s.jsx)(n.h3,{id:"execution-queue-pattern",children:"Execution Queue Pattern"}),"\n",(0,s.jsxs)(n.p,{children:["Instead of sending full tournament records, TMX sends ",(0,s.jsx)(n.strong,{children:"method calls with parameters"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Client queues mutation\n{\n  method: 'addParticipant',\n  params: {\n    participant: {\n      participantType: 'INDIVIDUAL',\n      person: {\n        standardGivenName: 'John',\n        standardFamilyName: 'Doe'\n      }\n    }\n  },\n  timestamp: '2024-06-15T10:30:00Z',\n  clientId: 'client-uuid'\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Server receives queue entry\n// Executes same method on server factory\nconst result = tournamentEngine.addParticipant(params);\n\n// Returns result to client\n{\n  success: true,\n  participant: { participantId: 'uuid', ... },\n  timestamp: '2024-06-15T10:30:00.123Z'\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Efficiency"})," - Only changes transmitted, not entire records"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consistency"})," - Same factory methods on client and server"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validation"})," - Server validates all operations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"History"})," - Complete audit trail of changes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Conflict Resolution"})," - Server can detect and resolve conflicts"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"query-vs-mutation-separation",children:"Query vs Mutation Separation"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Queries (Local Only)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Fast, no network needed\nconst { participants } = tournamentEngine.getParticipants();\nconst { events } = tournamentEngine.getEvents();\nconst { matchUps } = tournamentEngine.getAllEventMatchUps({ eventId });\n\n// Instant response from local state\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Mutations (Queued to Server)"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Queued for server execution\ntournamentEngine.addParticipant({ participant });\ntournamentEngine.addEvent({ event });\ntournamentEngine.setMatchUpStatus({ matchUpId, outcome });\n\n// Applied locally (optimistic)\n// Sent to server for validation\n// Server confirms or rejects\n"})}),"\n",(0,s.jsx)(n.h3,{id:"masterslave-modes",children:"Master/Slave Modes"}),"\n",(0,s.jsx)(n.h4,{id:"master-mode-default",children:"Master Mode (Default)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Client is authoritative\n\u251c\u2500 Makes changes locally first (optimistic)\n\u251c\u2500 Sends execution queue to server\n\u251c\u2500 Server applies and stores changes\n\u2514\u2500 Server broadcasts to other clients\n"})}),"\n",(0,s.jsx)(n.h4,{id:"slave-mode",children:"Slave Mode"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Server is authoritative\n\u251c\u2500 Client requests changes\n\u251c\u2500 Server validates and applies\n\u251c\u2500 Server sends updated state to client\n\u2514\u2500 Client updates local state from server\n"})}),"\n",(0,s.jsx)(n.h3,{id:"offlineonline-transitions",children:"Offline/Online Transitions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Client goes offline\n- Continues operating with local factory\n- Queues all mutations\n- UI indicates offline status\n\n// Client comes back online\n- Reconnects to server\n- Sends queued mutations\n- Receives any missed updates\n- Resolves conflicts if any\n- Syncs to current state\n"})}),"\n",(0,s.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,s.jsx)(n.h3,{id:"client-side-queue",children:"Client-Side Queue"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"class ExecutionQueue {\n  constructor() {\n    this.queue = [];\n    this.pending = [];\n  }\n\n  // Add mutation to queue\n  enqueue(method, params) {\n    const entry = {\n      id: generateId(),\n      method,\n      params,\n      timestamp: new Date().toISOString(),\n      clientId: this.clientId,\n    };\n\n    this.queue.push(entry);\n    this.send(entry);\n    return entry.id;\n  }\n\n  // Send to server\n  async send(entry) {\n    if (!navigator.onLine) {\n      // Store for later\n      return;\n    }\n\n    this.pending.push(entry);\n\n    try {\n      const response = await fetch('/api/execute', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(entry),\n      });\n\n      const result = await response.json();\n      this.handleResult(entry.id, result);\n    } catch (error) {\n      this.handleError(entry.id, error);\n    }\n  }\n\n  // Handle server response\n  handleResult(entryId, result) {\n    const entry = this.pending.find((e) => e.id === entryId);\n\n    if (result.success) {\n      // Remove from pending\n      this.pending = this.pending.filter((e) => e.id !== entryId);\n    } else {\n      // Handle conflict or error\n      this.handleConflict(entry, result);\n    }\n  }\n\n  // Sync on reconnect\n  async sync() {\n    for (const entry of this.queue) {\n      await this.send(entry);\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"server-side-processing",children:"Server-Side Processing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Server receives execution queue entry\napp.post('/api/execute', async (req, res) => {\n  const { method, params, timestamp, clientId } = req.body;\n\n  try {\n    // Load tournament state\n    const tournamentRecord = await loadTournament(params.tournamentId);\n\n    // Set state in factory\n    tournamentEngine.setState(tournamentRecord);\n\n    // Execute method\n    const result = tournamentEngine[method](params);\n\n    if (result.success !== false) {\n      // Save updated state\n      const updated = tournamentEngine.getState();\n      await saveTournament(updated);\n\n      // Log execution\n      await logExecution({\n        method,\n        params,\n        result,\n        timestamp,\n        clientId,\n      });\n\n      // Broadcast to other clients\n      broadcastUpdate({\n        method,\n        params,\n        result,\n        excludeClient: clientId,\n      });\n\n      res.json({ success: true, result });\n    } else {\n      res.json({ success: false, error: result.error });\n    }\n  } catch (error) {\n    console.error('Execution error:', error);\n    res.status(500).json({\n      success: false,\n      error: error.message,\n    });\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"conflict-resolution",children:"Conflict Resolution"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Detect conflicts\nfunction detectConflict(entry, serverState) {\n  // Check if entry's preconditions still valid\n  const { method, params } = entry;\n\n  if (method === 'setMatchUpStatus') {\n    // Check if matchUp still exists\n    const { matchUp } = tournamentEngine.getMatchUp({\n      matchUpId: params.matchUpId,\n    });\n\n    if (!matchUp) {\n      return { conflict: true, reason: 'MatchUp not found' };\n    }\n\n    // Check if matchUp already has different score\n    if (matchUp.winningSide && matchUp.winningSide !== params.outcome.winningSide) {\n      return { conflict: true, reason: 'Different score already entered' };\n    }\n  }\n\n  return { conflict: false };\n}\n\n// Resolve conflicts\nfunction resolveConflict(entry, conflict) {\n  // Strategy depends on method and conflict type\n\n  // Last write wins\n  if (conflict.strategy === 'LAST_WRITE_WINS') {\n    return { action: 'APPLY', entry };\n  }\n\n  // Server wins\n  if (conflict.strategy === 'SERVER_WINS') {\n    return { action: 'REJECT', entry };\n  }\n\n  // Merge changes\n  if (conflict.strategy === 'MERGE') {\n    const merged = mergeChanges(entry, conflict.serverState);\n    return { action: 'APPLY', entry: merged };\n  }\n\n  // Ask user\n  return { action: 'ASK_USER', entry, conflict };\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"server-configuration",children:"Server Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"basic-server-setup",children:"Basic Server Setup"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const express = require('express');\nconst { tournamentEngine } = require('tods-competition-factory');\n\nconst app = express();\napp.use(express.json());\n\n// Store tournaments in memory (or database)\nconst tournaments = new Map();\n\n// Load tournament\napp.get('/api/tournaments/:id', (req, res) => {\n  const tournament = tournaments.get(req.params.id);\n  if (tournament) {\n    res.json(tournament);\n  } else {\n    res.status(404).json({ error: 'Tournament not found' });\n  }\n});\n\n// Execute method\napp.post('/api/execute', async (req, res) => {\n  const { tournamentId, method, params } = req.body;\n\n  // Load and set state\n  const tournament = tournaments.get(tournamentId);\n  tournamentEngine.setState(tournament);\n\n  // Execute\n  const result = tournamentEngine[method](params);\n\n  // Save updated state\n  if (result.success !== false) {\n    const updated = tournamentEngine.getState();\n    tournaments.set(tournamentId, updated);\n  }\n\n  res.json(result);\n});\n\napp.listen(3000, () => {\n  console.log('Factory server running on port 3000');\n});\n"})}),"\n",(0,s.jsx)(n.h3,{id:"websocket-support",children:"WebSocket Support"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const WebSocket = require('ws');\nconst wss = new WebSocket.Server({ port: 3001 });\n\nconst clients = new Map();\n\nwss.on('connection', (ws) => {\n  const clientId = generateId();\n  clients.set(clientId, ws);\n\n  ws.on('message', async (message) => {\n    const { type, payload } = JSON.parse(message);\n\n    if (type === 'EXECUTE') {\n      const result = await executeMethod(payload);\n\n      // Send result to requesting client\n      ws.send(JSON.stringify({ type: 'RESULT', payload: result }));\n\n      // Broadcast to other clients\n      broadcastUpdate(clientId, payload, result);\n    }\n  });\n\n  ws.on('close', () => {\n    clients.delete(clientId);\n  });\n});\n\nfunction broadcastUpdate(excludeClient, method, result) {\n  const message = JSON.stringify({\n    type: 'UPDATE',\n    payload: { method, result },\n  });\n\n  clients.forEach((client, clientId) => {\n    if (clientId !== excludeClient && client.readyState === WebSocket.OPEN) {\n      client.send(message);\n    }\n  });\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"data-persistence",children:"Data Persistence"}),"\n",(0,s.jsx)(n.h3,{id:"file-system-storage",children:"File System Storage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const fs = require('fs').promises;\nconst path = require('path');\n\nasync function saveTournament(tournamentId, tournamentRecord) {\n  const filepath = path.join('data', `${tournamentId}.json`);\n  await fs.writeFile(filepath, JSON.stringify(tournamentRecord, null, 2));\n}\n\nasync function loadTournament(tournamentId) {\n  const filepath = path.join('data', `${tournamentId}.json`);\n  const data = await fs.readFile(filepath, 'utf8');\n  return JSON.parse(data);\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"database-storage",children:"Database Storage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// MongoDB example\nasync function saveTournament(tournamentId, tournamentRecord) {\n  await db\n    .collection('tournaments')\n    .updateOne({ tournamentId }, { $set: { record: tournamentRecord, updated: new Date() } }, { upsert: true });\n}\n\nasync function loadTournament(tournamentId) {\n  const doc = await db.collection('tournaments').findOne({ tournamentId });\n  return doc?.record;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"execution-history",children:"Execution History"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Log all executions for audit trail\nasync function logExecution(entry) {\n  await db.collection('execution_log').insertOne({\n    ...entry,\n    serverTimestamp: new Date(),\n  });\n}\n\n// Query execution history\nasync function getExecutionHistory(tournamentId, options = {}) {\n  return db\n    .collection('execution_log')\n    .find({ 'params.tournamentId': tournamentId })\n    .sort({ serverTimestamp: -1 })\n    .limit(options.limit || 100)\n    .toArray();\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsx)(n.h3,{id:"performance",children:"Performance"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Keep server-side factory instance in memory"}),"\n",(0,s.jsx)(n.li,{children:"Cache tournament records"}),"\n",(0,s.jsx)(n.li,{children:"Use WebSockets for real-time updates"}),"\n",(0,s.jsx)(n.li,{children:"Batch queue entries when possible"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"reliability",children:"Reliability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Validate all method parameters"}),"\n",(0,s.jsx)(n.li,{children:"Check factory method results"}),"\n",(0,s.jsx)(n.li,{children:"Handle errors gracefully"}),"\n",(0,s.jsx)(n.li,{children:"Log all operations"}),"\n",(0,s.jsx)(n.li,{children:"Implement retry logic"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"security",children:"Security"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Authenticate clients"}),"\n",(0,s.jsx)(n.li,{children:"Validate permissions"}),"\n",(0,s.jsx)(n.li,{children:"Sanitize inputs"}),"\n",(0,s.jsx)(n.li,{children:"Rate limit requests"}),"\n",(0,s.jsx)(n.li,{children:"Encrypt connections (HTTPS/WSS)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"scalability",children:"Scalability"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use database for persistent storage"}),"\n",(0,s.jsx)(n.li,{children:"Implement caching layer"}),"\n",(0,s.jsx)(n.li,{children:"Consider message queue for high volume"}),"\n",(0,s.jsx)(n.li,{children:"Load balance multiple server instances"}),"\n",(0,s.jsx)(n.li,{children:"Separate read/write paths"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,s.jsx)(n.h3,{id:"production-considerations",children:"Production Considerations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// Configuration\nconst config = {\n  port: process.env.PORT || 3000,\n  database: process.env.DATABASE_URL,\n  redis: process.env.REDIS_URL,\n  cors: {\n    origin: process.env.ALLOWED_ORIGINS.split(','),\n    credentials: true,\n  },\n  rateLimit: {\n    windowMs: 15 * 60 * 1000, // 15 minutes\n    max: 100, // limit each IP to 100 requests per windowMs\n  },\n};\n\n// Error handling\nprocess.on('uncaughtException', (error) => {\n  console.error('Uncaught exception:', error);\n  // Log to monitoring service\n  gracefulShutdown();\n});\n\n// Graceful shutdown\nfunction gracefulShutdown() {\n  console.log('Shutting down gracefully...');\n\n  server.close(() => {\n    console.log('HTTP server closed');\n\n    // Close database connections\n    db.close();\n\n    process.exit(0);\n  });\n\n  // Force shutdown after 30 seconds\n  setTimeout(() => {\n    console.error('Forced shutdown');\n    process.exit(1);\n  }, 30000);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/competition-factory/docs/engines/engine-methods",children:"Engine Methods"})," - All factory methods"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/competition-factory/docs/engines/state-engines",children:"State Management"})," - Managing state"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/competition-factory/docs/tmx/browser-console",children:"Browser Console"})," - Client-side factory usage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/competition-factory/docs/tmx/overview",children:"TMX Overview"})," - Complete TMX architecture"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"example-implementation",children:"Example Implementation"}),"\n",(0,s.jsx)(n.p,{children:"The tmxServer in the CourtHive repository provides a complete reference implementation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd tmxServer\nnpm install\nnpm start\n"})}),"\n",(0,s.jsx)(n.p,{children:"Review the source code to see:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Complete execution queue implementation"}),"\n",(0,s.jsx)(n.li,{children:"WebSocket and HTTP endpoints"}),"\n",(0,s.jsx)(n.li,{children:"Conflict resolution strategies"}),"\n",(0,s.jsx)(n.li,{children:"Data persistence patterns"}),"\n",(0,s.jsx)(n.li,{children:"Error handling"}),"\n",(0,s.jsx)(n.li,{children:"Client synchronization"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The factory server pattern enables powerful multi-user tournament management while maintaining the benefits of local-first architecture and the simplicity of the Competition Factory API."})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8322(e,n,t){t.d(n,{R:()=>o,x:()=>a});var r=t(758);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);