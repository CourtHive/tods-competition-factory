"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[81],{1599(n,e,t){t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"concepts/publishing/publishing-data-subscriptions","title":"Data and Subscriptions","description":"Data Preparation for Publishing","source":"@site/docs/concepts/publishing/publishing-data-subscriptions.md","sourceDirName":"concepts/publishing","slug":"/concepts/publishing/publishing-data-subscriptions","permalink":"/competition-factory/docs/concepts/publishing/publishing-data-subscriptions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Data and Subscriptions"},"sidebar":"docs","previous":{"title":"Embargo and Scheduled Rounds","permalink":"/competition-factory/docs/concepts/publishing/publishing-embargo"},"next":{"title":"Workflows and Best Practices","permalink":"/competition-factory/docs/concepts/publishing/publishing-workflows"}}');var s=t(6070),i=t(8322);const r={title:"Data and Subscriptions"},o=void 0,c={},d=[{value:"Data Preparation for Publishing",id:"data-preparation-for-publishing",level:2},{value:"Event Data Payload",id:"event-data-payload",level:3},{value:"Prepared Payload Structure",id:"prepared-payload-structure",level:3},{value:"Subscriptions and Notifications",id:"subscriptions-and-notifications",level:2},{value:"Publishing Topics",id:"publishing-topics",level:3},{value:"Integration Patterns",id:"integration-patterns",level:3},{value:"Subscription Error Handling",id:"subscription-error-handling",level:3}];function l(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"data-preparation-for-publishing",children:"Data Preparation for Publishing"}),"\n",(0,s.jsx)(e.p,{children:"Publishing methods prepare optimized data payloads for public display."}),"\n",(0,s.jsx)(e.h3,{id:"event-data-payload",children:"Event Data Payload"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"const { eventData } = engine.publishEvent({\n  eventId,\n  eventDataParams: {\n    allParticipantResults: true, // Include round statistics\n    participantsProfile: {\n      withISO2: true, // Include country codes\n      withIOC: true,\n    },\n  },\n});\n\n// eventData structure optimized for visualization:\n// - drawsData: Array of draws with structures\n// - matchUps: Organized by rounds for each structure\n// - participants: Hydrated participant information\n// - venuesData: Venue and court information\n// - tournamentInfo: Tournament metadata\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"API Reference:"})," ",(0,s.jsx)(e.a,{href:"/docs/governors/publishing-governor#publishevent",children:"publishEvent"})]}),"\n",(0,s.jsxs)(e.admonition,{type:"important",children:[(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Event Data Parameters Are Not Persisted"})}),(0,s.jsxs)(e.p,{children:["The ",(0,s.jsx)(e.code,{children:"eventDataParams"})," passed to ",(0,s.jsx)(e.code,{children:"publishEvent()"})," are used to generate the ",(0,s.jsx)(e.code,{children:"eventData"})," payload ",(0,s.jsx)(e.strong,{children:"for that specific call only"}),". These parameters are ",(0,s.jsx)(e.strong,{children:"NOT stored"})," in the publish state timeItem."]}),(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Client applications must pass their own query parameters:"})}),(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"// Server-side publishing (generates payload for subscriptions)\nengine.publishEvent({\n  eventId,\n  eventDataParams: { participantsProfile: { withISO2: true } },\n});\n\n// Client application querying published data\nconst { eventData } = engine.getEventData({\n  eventId,\n  usePublishState: true, // Respects what's published\n  participantsProfile: { withISO2: true }, // Must specify params again\n});\n"})}),(0,s.jsxs)(e.p,{children:["The publish state timeItem controls ",(0,s.jsx)(e.strong,{children:"filtering"})," (which draws, structures, rounds are visible) but does not store query customization parameters. Each client application specifies its own data requirements when querying."]})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"API Reference:"})," ",(0,s.jsx)(e.a,{href:"/docs/governors/publishing-governor#publishevent",children:"publishEvent"}),", ",(0,s.jsx)(e.a,{href:"/docs/governors/query-governor#geteventdata",children:"getEventData"})]}),"\n",(0,s.jsx)(e.h3,{id:"prepared-payload-structure",children:"Prepared Payload Structure"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"{\n  eventData: {\n    eventInfo: {\n      eventId: string;\n      eventName: string;\n      // ... event metadata\n    },\n    drawsData: [{\n      drawId: string;\n      drawName: string;\n      structures: [{\n        structureId: string;\n        structureName: string;\n        roundMatchUps: {\n          [roundNumber]: matchUp[]\n        }\n      }]\n    }],\n    participants: Participant[],\n    venuesData: Venue[],\n    tournamentInfo: TournamentInfo\n  }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"subscriptions-and-notifications",children:"Subscriptions and Notifications"}),"\n",(0,s.jsxs)(e.p,{children:["Publishing actions trigger ",(0,s.jsx)(e.strong,{children:"subscription notifications"})," enabling real-time updates to public-facing systems."]}),"\n",(0,s.jsx)(e.h3,{id:"publishing-topics",children:"Publishing Topics"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"import { topicConstants } from 'tods-competition-factory';\n\nconst subscriptions = {\n  [topicConstants.PUBLISH_EVENT]: (payload) => {\n    // Event published - update public website\n    const { eventData, eventId } = payload;\n    updatePublicSite(eventData);\n  },\n\n  [topicConstants.UNPUBLISH_EVENT]: (payload) => {\n    // Event unpublished - remove from public website\n    const { eventId } = payload;\n    removeFromPublicSite(eventId);\n  },\n\n  [topicConstants.PUBLISH_EVENT_SEEDING]: (payload) => {\n    // Seeding published - update seeding displays\n    const { eventId, seedingData } = payload;\n    updateSeedingDisplay(seedingData);\n  },\n\n  [topicConstants.UNPUBLISH_EVENT_SEEDING]: (payload) => {\n    // Seeding unpublished - remove seeding information\n    const { eventId } = payload;\n    removeSeedingDisplay(eventId);\n  },\n\n  [topicConstants.PUBLISH_ORDER_OF_PLAY]: (payload) => {\n    // Order of Play published - update schedule displays\n    const { dateMatchUps } = payload;\n    updateScheduleDisplay(dateMatchUps);\n  },\n\n  [topicConstants.UNPUBLISH_ORDER_OF_PLAY]: (payload) => {\n    // Order of Play unpublished - remove schedules\n    removeScheduleDisplay();\n  },\n};\n\nengine.devContext({ subscriptions });\n"})}),"\n",(0,s.jsx)(e.h3,{id:"integration-patterns",children:"Integration Patterns"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Push to Public Website"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"[topicConstants.PUBLISH_EVENT]: async (payload) => {\n  const { eventData } = payload;\n  await fetch('https://public-site.com/api/events', {\n    method: 'POST',\n    body: JSON.stringify(eventData)\n  });\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Database Synchronization"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"[topicConstants.PUBLISH_ORDER_OF_PLAY]: async (payload) => {\n  const { dateMatchUps } = payload;\n  await database.updatePublishedSchedule(dateMatchUps);\n}\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Cache Invalidation"}),":"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"[topicConstants.UNPUBLISH_EVENT]: (payload) => {\n  const { eventId } = payload;\n  cache.invalidate(`event:${eventId}`);\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"subscription-error-handling",children:"Subscription Error Handling"}),"\n",(0,s.jsx)(e.p,{children:"Handle subscription failures gracefully:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",children:"[topicConstants.PUBLISH_EVENT]: async (payload) => {\n  try {\n    await updatePublicSite(payload.eventData);\n  } catch (error) {\n    logger.error('Failed to update public site', error);\n    // Queue for retry or alert administrators\n  }\n}\n"})})]})}function p(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(l,{...n})}):l(n)}},8322(n,e,t){t.d(e,{R:()=>r,x:()=>o});var a=t(758);const s={},i=a.createContext(s);function r(n){const e=a.useContext(i);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:r(n.components),a.createElement(i.Provider,{value:e},n.children)}}}]);